{"id":106804,"title":"20 | 生鲜速递：HTTP的缓存控制","content":"<p>缓存（Cache）是计算机领域里的一个重要概念，是优化系统性能的利器。</p><p>由于链路漫长，网络时延不可控，浏览器使用HTTP获取资源的成本较高。所以，非常有必要把“来之不易”的数据缓存起来，下次再请求的时候尽可能地复用。这样，就可以避免多次请求-应答的通信成本，节约网络带宽，也可以加快响应速度。</p><p>试想一下，如果有几十K甚至几十M的数据，不是从网络而是从本地磁盘获取，那将是多么大的一笔节省，免去多少等待的时间。</p><p>实际上，HTTP传输的每一个环节基本上都会有缓存，非常复杂。</p><p>基于“请求-应答”模式的特点，可以大致分为客户端缓存和服务器端缓存，因为服务器端缓存经常与代理服务“混搭”在一起，所以今天我先讲客户端——也就是浏览器的缓存。</p><h2>服务器的缓存控制</h2><p>为了更好地说明缓存的运行机制，下面我用“生鲜速递”作为比喻，看看缓存是如何工作的。</p><p>夏天到了，天气很热。你想吃西瓜消暑，于是打开冰箱，但很不巧，冰箱是空的。不过没事，现在物流很发达，给生鲜超市打个电话，不一会儿，就给你送来一个8斤的沙瓤大西瓜，上面还贴着标签：“保鲜期5天”。好了，你把它放进冰箱，想吃的时候随时拿出来。</p><p>在这个场景里，“生鲜超市”就是Web服务器，“你”就是浏览器，“冰箱”就是浏览器内部的缓存。整个流程翻译成HTTP就是：</p><!-- [[[read_end]]] --><ol>\n<li>浏览器发现缓存无数据，于是发送请求，向服务器获取资源；</li>\n<li>服务器响应请求，返回资源，同时标记资源的有效期；</li>\n<li>浏览器缓存资源，等待下次重用。</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/a1/5b/a1968821f214df4a3ae16c9b30f99a5b.png?wh=1876*1062\" alt=\"\"></p><p>你可以访问实验环境的URI “/20-1”，看看具体的请求-应答过程。</p><p><img src=\"https://static001.geekbang.org/resource/image/df/d8/dfd2d20670443a782443fc3193ae1cd8.png?wh=1285*1262\" alt=\"\"></p><p>服务器标记资源有效期使用的头字段是“<strong>Cache-Control</strong>”，里面的值“<strong>max-age=30</strong>”就是资源的有效时间，相当于告诉浏览器，“这个页面只能缓存30秒，之后就算是过期，不能用。”</p><p>你可能要问了，让浏览器直接缓存数据就好了，为什么要加个有效期呢？</p><p>这是因为网络上的数据随时都在变化，不能保证它稍后的一段时间还是原来的样子。就像生鲜超市给你快递的西瓜，只有5天的保鲜期，过了这个期限最好还是别吃，不然可能会闹肚子。</p><p>“Cache-Control”字段里的“max-age”和上一讲里Cookie有点像，都是标记资源的有效期。</p><p>但我必须提醒你注意，这里的max-age是“<strong>生存时间</strong>”（又叫“新鲜度”“缓存寿命”，类似TTL，Time-To-Live），时间的计算起点是响应报文的创建时刻（即Date字段，也就是离开服务器的时刻），而不是客户端收到报文的时刻，也就是说包含了在链路传输过程中所有节点所停留的时间。</p><p>比如，服务器设定“max-age=5”，但因为网络质量很糟糕，等浏览器收到响应报文已经过去了4秒，那么这个资源在客户端就最多能够再存1秒钟，之后就会失效。</p><p>“max-age”是HTTP缓存控制最常用的属性，此外在响应报文里还可以用其他的属性来更精确地指示浏览器应该如何使用缓存：</p><ul>\n<li>no-store：<strong>不允许缓存</strong>，用于某些变化非常频繁的数据，例如秒杀页面；</li>\n<li>no-cache：它的字面含义容易与no-store搞混，实际的意思并不是不允许缓存，而是<strong>可以缓存</strong>，但在使用之前必须要去服务器验证是否过期，是否有最新的版本；</li>\n<li>must-revalidate：又是一个和no-cache相似的词，它的意思是如果缓存不过期就可以继续使用，但过期了如果还想用就必须去服务器验证。</li>\n</ul><p>听的有点糊涂吧。没关系，我拿生鲜速递来举例说明一下：</p><ul>\n<li>no-store：买来的西瓜不允许放进冰箱，要么立刻吃，要么立刻扔掉；</li>\n<li>no-cache：可以放进冰箱，但吃之前必须问超市有没有更新鲜的，有就吃超市里的；</li>\n<li>must-revalidate：可以放进冰箱，保鲜期内可以吃，过期了就要问超市让不让吃。</li>\n</ul><p>你看，这超市管的还真多啊，西瓜到了家里怎么吃还得听他。不过没办法，在HTTP协议里服务器就是这样的“霸气”。</p><p>我把服务器的缓存控制策略画了一个流程图，对照着它你就可以在今后的后台开发里明确“Cache-Control”的用法了。</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/99/1b4f48bc0d8fb9a08b45d1f0deac8a99.png?wh=1100*1425\" alt=\"\"></p><h2>客户端的缓存控制</h2><p>现在冰箱里已经有了“缓存”的西瓜，是不是就可以直接开吃了呢？</p><p>你可以在Chrome里点几次“刷新”按钮，估计你会失望，页面上的ID一直在变，根本不是缓存的结果，明明说缓存30秒，怎么就不起作用呢？</p><p>其实不止服务器可以发“Cache-Control”头，浏览器也可以发“Cache-Control”，也就是说请求-应答的双方都可以用这个字段进行缓存控制，互相协商缓存的使用策略。</p><p>当你点“刷新”按钮的时候，浏览器会在请求头里加一个“<strong>Cache-Control: max-age=0</strong>”。因为max-age是“<strong>生存时间</strong>”，max-age=0的意思就是“我要一个最最新鲜的西瓜”，而本地缓存里的数据至少保存了几秒钟，所以浏览器就不会使用缓存，而是向服务器发请求。服务器看到max-age=0，也就会用一个最新生成的报文回应浏览器。</p><p>Ctrl+F5的“强制刷新”又是什么样的呢？</p><p>它其实是发了一个“<strong>Cache-Control: no-cache</strong>”，含义和“max-age=0”基本一样，就看后台的服务器怎么理解，通常两者的效果是相同的。</p><p><img src=\"https://static001.geekbang.org/resource/image/2f/49/2fc3fa639f44b98d7c19d25604c65249.png?wh=1807*1012\" alt=\"\"></p><p>那么，浏览器的缓存究竟什么时候才能生效呢？</p><p>别着急，试着点一下浏览器的“前进”“后退”按钮，再看开发者工具，你就会惊喜地发现“from disk cache”的字样，意思是没有发送网络请求，而是读取的磁盘上的缓存。</p><p>另外，如果用<a href=\"https://time.geekbang.org/column/article/105614\">第18讲</a>里的重定向跳转功能，也可以发现浏览器使用了缓存：</p><pre><code>http://www.chrono.com/18-1?dst=20-1\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/f2/06/f2a12669e997ea6dc0f2228bcaf65a06.png?wh=2090*781\" alt=\"\"></p><p>这几个操作与刷新有什么区别呢？</p><p>其实也很简单，在“前进”“后退”“跳转”这些重定向动作中浏览器不会“夹带私货”，只用最基本的请求头，没有“Cache-Control”，所以就会检查缓存，直接利用之前的资源，不再进行网络通信。</p><p>这个过程你也可以用Wireshark抓包，看看是否真的没有向服务器发请求。</p><h2>条件请求</h2><p>浏览器用“Cache-Control”做缓存控制只能是刷新数据，不能很好地利用缓存数据，又因为缓存会失效，使用前还必须要去服务器验证是否是最新版。</p><p>那么该怎么做呢？</p><p>浏览器可以用两个连续的请求组成“验证动作”：先是一个HEAD，获取资源的修改时间等元信息，然后与缓存数据比较，如果没有改动就使用缓存，节省网络流量，否则就再发一个GET请求，获取最新的版本。</p><p>但这样的两个请求网络成本太高了，所以HTTP协议就定义了一系列“<strong>If</strong>”开头的“<strong>条件请求</strong>”字段，专门用来检查验证资源是否过期，把两个请求才能完成的工作合并在一个请求里做。而且，验证的责任也交给服务器，浏览器只需“坐享其成”。</p><p>条件请求一共有5个头字段，我们最常用的是“<strong>if-Modified-Since</strong>”和“<strong>If-None-Match</strong>”这两个。需要第一次的响应报文预先提供“<strong>Last-modified</strong>”和“<strong>ETag</strong>”，然后第二次请求时就可以带上缓存里的原值，验证资源是否是最新的。</p><p>如果资源没有变，服务器就回应一个“<strong>304 Not Modified</strong>”，表示缓存依然有效，浏览器就可以更新一下有效期，然后放心大胆地使用缓存了。</p><p><img src=\"https://static001.geekbang.org/resource/image/b2/37/b239d0804be630ce182e24ea9e4ab237.png?wh=1764*879\" alt=\"\"></p><p>“Last-modified”很好理解，就是文件的最后修改时间。ETag是什么呢？</p><p>ETag是“实体标签”（Entity Tag）的缩写，<strong>是资源的一个唯一标识</strong>，主要是用来解决修改时间无法准确区分文件变化的问题。</p><p>比如，一个文件在一秒内修改了多次，但因为修改时间是秒级，所以这一秒内的新版本无法区分。</p><p>再比如，一个文件定期更新，但有时会是同样的内容，实际上没有变化，用修改时间就会误以为发生了变化，传送给浏览器就会浪费带宽。</p><p>使用ETag就可以精确地识别资源的变动情况，让浏览器能够更有效地利用缓存。</p><p>ETag还有“强”“弱”之分。</p><p>强ETag要求资源在字节级别必须完全相符，弱ETag在值前有个“W/”标记，只要求资源在语义上没有变化，但内部可能会有部分发生了改变（例如HTML里的标签顺序调整，或者多了几个空格）。</p><p>还是拿生鲜速递做比喻最容易理解：</p><p>你打电话给超市，“我这个西瓜是3天前买的，还有最新的吗？”。超市看了一下库存，说：“没有啊，我这里都是3天前的。”于是你就知道了，再让超市送货也没用，还是吃冰箱里的西瓜吧。这就是“<strong>if-Modified-Since</strong>”和“<strong>Last-modified</strong>”。</p><p>但你还是想要最新的，就又打电话：“有不是沙瓤的西瓜吗？”，超市告诉你都是沙瓤的（Match），于是你还是只能吃冰箱里的沙瓤西瓜。这就是“<strong>If-None-Match</strong>”和“<strong>弱ETag</strong>”。</p><p>第三次打电话，你说“有不是8斤的沙瓤西瓜吗？”，这回超市给了你满意的答复：“有个10斤的沙瓤西瓜”。于是，你就扔掉了冰箱里的存货，让超市重新送了一个新的大西瓜。这就是“<strong>If-None-Match</strong>”和“<strong>强ETag</strong>”。</p><p>再来看看实验环境的URI “/20-2”。它为资源增加了ETag字段，刷新页面时浏览器就会同时发送缓存控制头“max-age=0”和条件请求头“If-None-Match”，如果缓存有效服务器就会返回304：</p><p><img src=\"https://static001.geekbang.org/resource/image/30/f9/30965c97bb7433eabe10008fefaeb5f9.png?wh=1812*963\" alt=\"\"></p><p>条件请求里其他的三个头字段是“If-Unmodified-Since”“If-Match”和“If-Range”，其实只要你掌握了“if-Modified-Since”和“If-None-Match”，可以轻易地“举一反三”。</p><h2>小结</h2><p>今天我们学习了HTTP的缓存控制和条件请求，用好它们可以减少响应时间、节约网络流量，一起小结一下今天的内容吧：</p><ol>\n<li><span class=\"orange\">缓存是优化系统性能的重要手段，HTTP传输的每一个环节中都可以有缓存；</span></li>\n<li><span class=\"orange\">服务器使用“Cache-Control”设置缓存策略，常用的是“max-age”，表示资源的有效期；</span></li>\n<li><span class=\"orange\">浏览器收到数据就会存入缓存，如果没过期就可以直接使用，过期就要去服务器验证是否仍然可用；</span></li>\n<li><span class=\"orange\">验证资源是否失效需要使用“条件请求”，常用的是“if-Modified-Since”和“If-None-Match”，收到304就可以复用缓存里的资源；</span></li>\n<li><span class=\"orange\">验证资源是否被修改的条件有两个：“Last-modified”和“ETag”，需要服务器预先在响应报文里设置，搭配条件请求使用；</span></li>\n<li><span class=\"orange\">浏览器也可以发送“Cache-Control”字段，使用“max-age=0”或“no_cache”刷新数据。</span></li>\n</ol><p>HTTP缓存看上去很复杂，但基本原理说白了就是一句话：“没有消息就是好消息”，“没有请求的请求，才是最快的请求。”</p><h2>课下作业</h2><ol>\n<li>Cache 和Cookie都是服务器发给客户端并存储的数据，你能比较一下两者的异同吗？</li>\n<li>即使有“Last-modified”和“ETag”，强制刷新（Ctrl+F5）也能够从服务器获取最新数据（返回200而不是304），请你在实验环境里试一下，观察请求头和响应头，解释原因。</li>\n</ol><p>欢迎你把自己的学习体会写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><p><img src=\"https://static001.geekbang.org/resource/image/13/4b/1348aa2c81bd5d65ace3aa068b21044b.png?wh=1769*3690\" alt=\"unpreview\"></p><p></p>","comments":[{"had_liked":false,"id":113318,"user_name":"前端西瓜哥","can_delete":false,"product_type":"c1","uid":1248576,"ip_address":"","ucode":"150130C34CD1C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/0d/40/f70e5653.jpg","comment_is_top":false,"comment_ctime":1562947572,"is_pvip":false,"replies":[{"id":"41303","content":"总结的非常好。<br><br>第三点感觉有点问题，cache缓存的是完整的报文，不单单是body。","user_name":"作者回复","comment_id":113318,"uid":"1181974","ip_address":"","utype":1,"ctime":1563001790,"user_name_real":"chrono"}],"discussion_count":4,"race_medal":0,"score":"345160331252","product_id":100029001,"comment_content":"Cache 和 Cookie 的相同点是：都会保存到浏览器中，并可以设置过期时间。<br>不同点：<br>1. Cookie 会随请求报文发送到服务器，而 Cache 不会，但可能会携带 if-Modified-Since（保存资源的最后修改时间）和 If-None-Match（保存资源唯一标识） 字段来验证资源是否过期。<br>2. Cookie 在浏览器可以通过脚本获取（如果 cookie 没有设置 HttpOnly），Cache 则无法在浏览器中获取（出于安全原因）。<br>3. Cookie 通过响应报文的 Set-Cookie 字段获得，Cache 则是位于 body 中。<br>4. 用途不同。Cookie 常用于身份识别，Cache 则是由浏览器管理，用于节省带宽和加快响应速度。<br>5. Cookie 的 max-age 是从浏览器拿到响应报文时开始计算的，而 Cache 的 max-age 是从响应报文的生成时间（Date 头字段）开始计算。","like_count":80,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458165,"discussion_content":"总结的非常好。\n\n第三点感觉有点问题，cache缓存的是完整的报文，不单单是body。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563001790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136283,"discussion_content":"按照协议标准文档，cookie和cache的max-age计算方式是不同的，它们与报文的生成时间不一样，是数据的有效期。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579136980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564184,"avatar":"https://static001.geekbang.org/account/avatar/00/17/de/18/b2635f3c.jpg","nickname":"李彬","note":"","ucode":"7536C1DB114CBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9580,"discussion_content":"第5点两个max-age的时间，不是拿到报文就生成了吗，怎么还会有时间差","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568192083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1475340,"avatar":"https://static001.geekbang.org/account/avatar/00/16/83/0c/b9e39db4.jpg","nickname":"韩俊臣","note":"","ucode":"D6A15C025570D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1564184,"avatar":"https://static001.geekbang.org/account/avatar/00/17/de/18/b2635f3c.jpg","nickname":"李彬","note":"","ucode":"7536C1DB114CBC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277202,"discussion_content":"从Server端生成响应报文，到client端收到该报文，中间有传输时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591016802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":9580,"ip_address":""},"score":277202,"extra":""}]}]},{"had_liked":false,"id":113122,"user_name":"小鸟淫太","can_delete":false,"product_type":"c1","uid":1247186,"ip_address":"","ucode":"AC44F552DDF93E","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/d2/d7a200d5.jpg","comment_is_top":false,"comment_ctime":1562900144,"is_pvip":false,"replies":[{"id":"41237","content":"回答正确，之前是我弄错了。","user_name":"作者回复","comment_id":113122,"uid":"1181974","ip_address":"","utype":1,"ctime":1562937850,"user_name_real":"chrono"}],"discussion_count":2,"race_medal":0,"score":"108937082544","product_id":100029001,"comment_content":"1. cookie是方便进行身份识，cache是为了减少网络请求。<br>2. 强制刷新是因为请求头里的 If-Modified-Since 和 If-None-Match 会被清空所以会返回最新数据","like_count":25,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458068,"discussion_content":"回答正确，之前是我弄错了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1308098,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f5/c2/4e551270.jpg","nickname":"姚凯伦","note":"","ucode":"B0FC353D06E041","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362101,"discussion_content":"建议更新下文稿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616850149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113368,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1562985458,"is_pvip":true,"replies":[{"id":"41304","content":"对，没有条件请求头，那么服务器就无法处理缓存，就只能返回最新的数据。","user_name":"作者回复","comment_id":113368,"uid":"1181974","ip_address":"","utype":1,"ctime":1563001960,"user_name_real":"chrono"}],"discussion_count":3,"race_medal":1,"score":"83167364082","product_id":100029001,"comment_content":"对于第二个问题：发现强制刷新后请求头中 没有了 If-None-Match ，而且 Cache-Control: no-cache<br><br>是这个原因吗？","like_count":19,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458187,"discussion_content":"对，没有条件请求头，那么服务器就无法处理缓存，就只能返回最新的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563001960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2662715,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a1/3b/b08088bb.jpg","nickname":"@","note":"","ucode":"DDB934E4C76389","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":588772,"discussion_content":"是不是只限于HTTP1.1啊，我看HTTP2.0强制刷新和非强制刷新，都有携带if-none-match...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664093611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":458187,"ip_address":"河北"},"score":588772,"extra":""}]},{"author":{"id":1551126,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ab/16/834610e5.jpg","nickname":"Geek_ede66b","note":"","ucode":"EA05E48AB02E4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261115,"discussion_content":"没有了 If-None-Match ，而且 Cache-Control: no-cache\n就说明no-cache不能返回304呀 永远都是200最新的数据","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588941584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121367,"user_name":"DENG永青","can_delete":false,"product_type":"c1","uid":1311758,"ip_address":"","ucode":"FBBAF46E858596","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/0e/87adea1d.jpg","comment_is_top":false,"comment_ctime":1565108017,"is_pvip":false,"replies":[{"id":"44592","content":"写的非常详细，点赞。","user_name":"作者回复","comment_id":121367,"uid":"1181974","ip_address":"","utype":1,"ctime":1565135598,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"78874519345","product_id":100029001,"comment_content":"Etag的工作原理<br>Etag在服务器上生成后,客户端通过If-Match或者说If-None-Match这个条件判断请求来验证资源是否修改.我们常见的是使用If-None-Match.请求一个文件的流程可能如下：<br>新的请求<br>客户端发起HTTP GET请求一个文件(css ,image,js)；服务器处理请求,返回文件内容和一堆Header(包括Etag,例如&quot;2e681a-6-5d044840&quot;),http头状态码为为200.<br><br>同一个用户第二次这个文件的请求<br>客户端在一次发起HTTP GET请求一个文件,注意这个时候客户端同时发送一个If-None-Match头,这个头中会包括上次这个文件的Etag(例如&quot;2e681a- 6-5d044840&quot;),这时服务器判断发送过来的Etag和自己计算出来的Etag,因此If-None-Match为False,不返回200,返 回304,客户端继续使用本地缓存；<br><br>注意.服务器又设置了Cache-Control:max-age和Expires时,会同时使用,也就是说在完全匹配If-Modified-Since和If-None-Match即检查完修改时间和Etag之后,服务器才能返回304.","like_count":18,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461762,"discussion_content":"写的非常详细，点赞。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565135598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114001,"user_name":"院长。","can_delete":false,"product_type":"c1","uid":1153546,"ip_address":"","ucode":"DF56871F42A868","user_header":"https://static001.geekbang.org/account/avatar/00/11/9a/0a/da55228e.jpg","comment_is_top":false,"comment_ctime":1563202683,"is_pvip":false,"replies":[{"id":"41599","content":"1.强制刷新请求最新的资源，没有条件请求，所以不会有304，都是200。<br><br>2.每个浏览器可能会有不同，但基本的字段是一样的。<br><br>3.缓存的位置不一样，浏览器会分别存放到内存或者硬盘上，所以会显示来源不同。<br><br>4.http只规定了缓存的用法，具体如何存放如何使用就是客户端自己灵活实现了，怎么方便怎么来。<br><br>5.过期后去验证，如果服务器返回304，那么就可以继续重用缓存，而不用下载整个资源。<br><br>6.可以看一下流程图，不是所以的属性都能共存的。当然如果你要是都写上也不是不可以，那浏览器就会“精神错乱”了。","user_name":"作者回复","comment_id":114001,"uid":"1181974","ip_address":"","utype":1,"ctime":1563239959,"user_name_real":"chrono"}],"discussion_count":3,"race_medal":0,"score":"74577646715","product_id":100029001,"comment_content":"老师我有几个问题想问一下： <br>1. F5刷新的时候，请求头加上&quot;Cache-Control: max-age=0&quot;，您文章里说，服务器用一个最新生成的报文回应浏览器，那这时候响应返回的应该是&quot;200 OK&quot;吗？为什么我在极客网页版的这个页面刷新后，有个叫&quot;106804&quot;的资源返回的是&quot;304&quot;，但是强制刷新是&quot;200 ok&quot;，产生的效果好像不同呀。这里是不是应该换一种方式说？感觉强制刷新说的有些简单了。<br>2. F5刷新发送的请求头是固定的吗？还是会根据浏览器不同而产生变化？<br>3. 200（from memory cache）和200(from disk cache)是针对内存和硬盘的，他们出现的场景分别是什么呢？<br>4. HTTP缓存有标准性的流程吗？比如说从我输入URL开始，到后续刷新或者强制刷新等？<br>5.对于&quot;must-revalidate&quot;我有疑问，本身存储机制不就是如果不过期的话可以继续使用，过期的话去请求服务器吗？那这个属性还有什么意义呢？<br>6. no-cache,no-store,max-age等属性可以共存吗？<br>问题有点多，因为网上资料质量参差不齐，解释有些也不全相同，所以在这里咨询下老师，希望老师可以解答一下，或者有推荐的讲述HTTP缓存的文章也可以，谢谢老师","like_count":17,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458475,"discussion_content":"1.强制刷新请求最新的资源，没有条件请求，所以不会有304，都是200。\n\n2.每个浏览器可能会有不同，但基本的字段是一样的。\n\n3.缓存的位置不一样，浏览器会分别存放到内存或者硬盘上，所以会显示来源不同。\n\n4.http只规定了缓存的用法，具体如何存放如何使用就是客户端自己灵活实现了，怎么方便怎么来。\n\n5.过期后去验证，如果服务器返回304，那么就可以继续重用缓存，而不用下载整个资源。\n\n6.可以看一下流程图，不是所以的属性都能共存的。当然如果你要是都写上也不是不可以，那浏览器就会“精神错乱”了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563239959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1288733,"avatar":"https://static001.geekbang.org/account/avatar/00/13/aa/1d/b8fdd622.jpg","nickname":"laoergege","note":"","ucode":"559CCF36805A04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385827,"discussion_content":"第五点，我也跟你一样疑惑，过期都会请求服务器，只要有 If 条件在，服务器貌似都会验证。我发现这个 must-revalidate 主要是为了跟 proxy-revalidate 做区别，强调回源服务器做验证吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627289291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1459863,"avatar":"https://static001.geekbang.org/account/avatar/00/16/46/97/ddd4b05f.jpg","nickname":"爱上我们的微笑","note":"","ucode":"40CDB7AB0991CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1288733,"avatar":"https://static001.geekbang.org/account/avatar/00/13/aa/1d/b8fdd622.jpg","nickname":"laoergege","note":"","ucode":"559CCF36805A04","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388889,"discussion_content":"过期时间的数据也有可能在服务器那里依旧是可以继续使用的。这样减少客户端数据的下载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629028847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":385827,"ip_address":""},"score":388889,"extra":""}]}]},{"had_liked":false,"id":120492,"user_name":"Marvin","can_delete":false,"product_type":"c1","uid":1138706,"ip_address":"","ucode":"D955A98C48CBEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/60/12/268826e6.jpg","comment_is_top":false,"comment_ctime":1564911505,"is_pvip":false,"replies":[{"id":"44236","content":"刷新时发的是条件请求，不是普通的请求，所以就必须返回304，告诉浏览器内容没有过期，可以继续用缓存。<br><br>普通请求才会直接检查缓存，然后是200 cacahe from disk。","user_name":"作者回复","comment_id":120492,"uid":"1181974","ip_address":"","utype":1,"ctime":1564962249,"user_name_real":"chrono"}],"discussion_count":2,"race_medal":0,"score":"44514584465","product_id":100029001,"comment_content":"我有一个问题，就拿咱们极客时间的网页来说，会请求一个Id-00001.ts的文件，响应头中指示了cache-control: max-age= 7200， 要一个小时才过期，那么为什么每次刷新都是304, 像这种情况不应该直接200 cacahe from disk才对么？为什么明明没有过期还要去服务器协商呢？","like_count":10,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461358,"discussion_content":"刷新时发的是条件请求，不是普通的请求，所以就必须返回304，告诉浏览器内容没有过期，可以继续用缓存。\n\n普通请求才会直接检查缓存，然后是200 cacahe from disk。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564962249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1401659,"avatar":"https://static001.geekbang.org/account/avatar/00/15/63/3b/3d35196e.jpg","nickname":"青青子衿♪","note":"","ucode":"47D10DB5791728","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547078,"discussion_content":"图片资源，使用F5刷新，获取到的响应是 200 （from memory cache）呀。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642517198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113191,"user_name":"啦啦啦","can_delete":false,"product_type":"c1","uid":1131687,"ip_address":"","ucode":"6B12EC90A62525","user_header":"https://static001.geekbang.org/account/avatar/00/11/44/a7/171c1e86.jpg","comment_is_top":false,"comment_ctime":1562911874,"is_pvip":false,"replies":[{"id":"41228","content":"不一样，如果服务器返回304，是一个很小的报文，这样浏览器就可以直接重用缓存里的数据，可以节约传输带宽。<br><br>nostore每次都会传输完整的报文，成本高。","user_name":"作者回复","comment_id":113191,"uid":"1181974","ip_address":"","utype":1,"ctime":1562937109,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"40217617538","product_id":100029001,"comment_content":"老师，nocache，每次使用前都需要去浏览器问一下有没有过期，这不也是一次请求吗？那不和没有缓存一个意思吗","like_count":9,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458101,"discussion_content":"不一样，如果服务器返回304，是一个很小的报文，这样浏览器就可以直接重用缓存里的数据，可以节约传输带宽。\n\nnostore每次都会传输完整的报文，成本高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155191,"user_name":"Khirye","can_delete":false,"product_type":"c1","uid":1080985,"ip_address":"","ucode":"6C54C126FA54B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/99/c4302030.jpg","comment_is_top":false,"comment_ctime":1574659020,"is_pvip":false,"replies":[{"id":"59544","content":"这张图是“服务器”的缓存策略，也就是说服务器应该如何设置资源的缓存参数，并不是客户端判断缓存的流程。<br><br>只要不是no-store就必然会设置max-age，所以must-revalidate是max-age的一个附加条件。","user_name":"作者回复","comment_id":155191,"uid":"1181974","ip_address":"","utype":1,"ctime":1574664224,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"27344462796","product_id":100029001,"comment_content":"Hi, 我对缓存控制策略这张流程图有一些疑惑，must-revalidate是指缓存过期之后，必须要向服务器验证缓存，这一步应该是在图中”缓存最多x秒“这个判断之前的吧？<br>因为只有缓存超过了max-age的期限，才会进入”must-revalidate的判断“这一步吧？<br>烦请解惑，谢谢！","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475683,"discussion_content":"这张图是“服务器”的缓存策略，也就是说服务器应该如何设置资源的缓存参数，并不是客户端判断缓存的流程。\n\n只要不是no-store就必然会设置max-age，所以must-revalidate是max-age的一个附加条件。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574664224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115635,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1563679837,"is_pvip":false,"replies":[{"id":"42324","content":"great。","user_name":"作者回复","comment_id":115635,"uid":"1181974","ip_address":"","utype":1,"ctime":1563757298,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"27333483613","product_id":100029001,"comment_content":"小贴士的nginx计算etag我贴下测试logngx_sprintf(etag-&gt;value.data, &quot;&quot;%xT-%xO&quot;&quot;, r-&gt;headers_out.last_modified_time,<br>r-&gt;headers_out.content_length_n)相信大家看到这里更清晰明了","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459199,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563757298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282673,"user_name":"风宇殇","can_delete":false,"product_type":"c1","uid":1325879,"ip_address":"","ucode":"AA0C0477B955CB","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/37/5ae95580.jpg","comment_is_top":false,"comment_ctime":1615360903,"is_pvip":false,"replies":[{"id":"102630","content":"挺好的文章，欢迎多来这样的分享。","user_name":"作者回复","comment_id":282673,"uid":"1181974","ip_address":"","utype":1,"ctime":1615422493,"user_name_real":"罗剑锋"}],"discussion_count":1,"race_medal":0,"score":"23090197383","product_id":100029001,"comment_content":"这篇文章将缓存讲的比较容易理解。https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;cUqkG3NETmJbglDXfSf0tg","like_count":5,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516808,"discussion_content":"挺好的文章，欢迎多来这样的分享。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615422493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151755,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573785840,"is_pvip":false,"replies":[{"id":"58414","content":"缓存策略取决于服务器，它认为这个缓存只能存放在客户端，不能存放在代理上，就设置private。<br><br>与session无关。","user_name":"作者回复","comment_id":151755,"uid":"1181974","ip_address":"","utype":1,"ctime":1573800364,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"18753655024","product_id":100029001,"comment_content":"cache-control 中的 private 是如何识别的呢？是根据session吗还是什么方式开识别是私有缓存呢","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474603,"discussion_content":"缓存策略取决于服务器，它认为这个缓存只能存放在客户端，不能存放在代理上，就设置private。\n\n与session无关。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573800364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113267,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1562929286,"is_pvip":false,"replies":[{"id":"41305","content":"强etag和etag的流程都是一样的，只是计算的方式不同，（即判断是否发生变化的方式不同）。<br><br>你的理解正确。","user_name":"作者回复","comment_id":113267,"uid":"1181974","ip_address":"","utype":1,"ctime":1563002111,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"18742798470","product_id":100029001,"comment_content":"请问老师弱ETag是服务器更新时自己判断本次的更新有没有语义的变化，如果语义有变化就重新生成一个ETag，如果没有变化不重新生成直接使用原来的，请问是这样的流程吗？","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458141,"discussion_content":"强etag和etag的流程都是一样的，只是计算的方式不同，（即判断是否发生变化的方式不同）。\n\n你的理解正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563002111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226976,"user_name":"Maske","can_delete":false,"product_type":"c1","uid":1696847,"ip_address":"","ucode":"A19BB41A47E852","user_header":"https://static001.geekbang.org/account/avatar/00/19/e4/4f/df6d810d.jpg","comment_is_top":false,"comment_ctime":1592240393,"is_pvip":true,"replies":[{"id":"83613","content":"good","user_name":"作者回复","comment_id":226976,"uid":"1181974","ip_address":"","utype":1,"ctime":1592266218,"user_name_real":"罗剑锋"}],"discussion_count":1,"race_medal":0,"score":"14477142281","product_id":100029001,"comment_content":"1.cache的作用为定义浏览器对静态文件如何进行缓存控制，目的是为了有效利用可复用的资源，尽可能减少客户端的请求，优化用户体验减轻服务器响应压力。常用字段值就那么一些，并有各自的含义。cookie的作用是增加了http请求的状态性，让服务器‘认识’当前访问的用户是谁，字段key,value值都可以自定义，比较灵活。<br>2.看了下天猫首页的css., js文件，普通的刷新（F5）操作中，不会在请求头中包含cache-control、if-none-match，if-Modified-Since,刷新会命中缓存文件，属于强缓存。强制刷新（ctrl + f5）在请求头中附加了cache-control: no-cache，为协商缓存，相当于设置max-age=0;所以此时不会使用本地缓存，当前页面所有的请求均是如此","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498436,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592266218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222387,"user_name":"Larry","can_delete":false,"product_type":"c1","uid":1623342,"ip_address":"","ucode":"3495A11DE756BA","user_header":"https://static001.geekbang.org/account/avatar/00/18/c5/2e/0326eefc.jpg","comment_is_top":false,"comment_ctime":1590770493,"is_pvip":false,"replies":[{"id":"82031","content":"按协议来说，没有规定，就取决于客户端，想缓存也可以。","user_name":"作者回复","comment_id":222387,"uid":"1181974","ip_address":"","utype":1,"ctime":1590802740,"user_name_real":"罗剑锋"}],"discussion_count":1,"race_medal":0,"score":"14475672381","product_id":100029001,"comment_content":"如果响应报文什么字段都不设置，单纯的返回数据，是不是也不会缓存？","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496774,"discussion_content":"按协议来说，没有规定，就取决于客户端，想缓存也可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590802740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190924,"user_name":"游鱼","can_delete":false,"product_type":"c1","uid":1132690,"ip_address":"","ucode":"ADBB8B24B4594F","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/92/de629e17.jpg","comment_is_top":false,"comment_ctime":1584709745,"is_pvip":false,"replies":[{"id":"73714","content":"看缓存是在哪里了，因为http的传输链路很长，可能在某个节点的缓存时间长，强制刷新不生效，需要具体分析，不好直接给解决方案。","user_name":"作者回复","comment_id":190924,"uid":"1181974","ip_address":"","utype":1,"ctime":1584927157,"user_name_real":"chrono"}],"discussion_count":2,"race_medal":0,"score":"14469611633","product_id":100029001,"comment_content":"老师，开发提测后，有时需要清缓存才是最新的，强刷都不管用，这个有解决办法吗","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488080,"discussion_content":"看缓存是在哪里了，因为http的传输链路很长，可能在某个节点的缓存时间长，强制刷新不生效，需要具体分析，不好直接给解决方案。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584927157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132690,"avatar":"https://static001.geekbang.org/account/avatar/00/11/48/92/de629e17.jpg","nickname":"游鱼","note":"","ucode":"ADBB8B24B4594F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213393,"discussion_content":"谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585066596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113241,"user_name":"来自地狱的勇士","can_delete":false,"product_type":"c1","uid":1101123,"ip_address":"","ucode":"E187F51081B495","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/43/fa115929.jpg","comment_is_top":false,"comment_ctime":1562923183,"is_pvip":false,"replies":[{"id":"41231","content":"Nginx和Apache都有etag，但算法不同，但都不会用特别消耗计算资源的算法。<br><br>其他的web服务器就不太清楚了。","user_name":"作者回复","comment_id":113241,"uid":"1181974","ip_address":"","utype":1,"ctime":1562937374,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"14447825071","product_id":100029001,"comment_content":"老师，既然Etag的算法比较复杂，需要占用服务器资源，那么，实际上服务器会使用Etag吗？看到有的资料说服务器很少会用到Etag，这个说法正确吗？","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458127,"discussion_content":"Nginx和Apache都有etag，但算法不同，但都不会用特别消耗计算资源的算法。\n\n其他的web服务器就不太清楚了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321854,"user_name":"路漫漫","can_delete":false,"product_type":"c1","uid":1273044,"ip_address":"","ucode":"F70F1DC612DE9D","user_header":"https://static001.geekbang.org/account/avatar/00/13/6c/d4/85ef1463.jpg","comment_is_top":false,"comment_ctime":1637067617,"is_pvip":false,"replies":[{"id":"116919","content":"按照协议要求是这样的，不然不知道应该缓存多长时间。<br><br>如果不提供max-age，浏览器也可以估算一个时间，但使用max-age还是最规范的写法。","user_name":"作者回复","comment_id":321854,"uid":"1181974","ip_address":"","utype":1,"ctime":1637119819,"user_name_real":"罗剑锋"}],"discussion_count":0,"race_medal":0,"score":"10227002209","product_id":100029001,"comment_content":"老师，根据服务器的缓存控制那个图，如果cache-control 设置了 no-cache 或 must-revalidate 那就 必须设置 max-age喽？","like_count":2},{"had_liked":false,"id":249070,"user_name":"Joe","can_delete":false,"product_type":"c1","uid":1124962,"ip_address":"","ucode":"EAEC8ED7986545","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/62/52231841.jpg","comment_is_top":false,"comment_ctime":1600419005,"is_pvip":false,"replies":[{"id":"91398","content":"使用if系列的条件请求，用时间戳或者etag，发给服务器，服务器来判断，如果没变化就可以直接重用客户端的缓存，否则就发回新的文件。<br><br>可以再仔细看看条件请求，关键就是客户端带上一个小的验证信息，让服务器检查。","user_name":"作者回复","comment_id":249070,"uid":"1181974","ip_address":"","utype":1,"ctime":1600435821,"user_name_real":"罗剑锋"}],"discussion_count":2,"race_medal":0,"score":"10190353597","product_id":100029001,"comment_content":"老师你好，如果使用的是强缓存，比如Cache-Control: max-age=36000，那么在有效期内服务器上的文件发生了改变，客户端怎么才能及时获取最新的文件？更改文件指纹是可以获取最新的文件吗？如果可以这个请求流程是什么样的？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505820,"discussion_content":"使用if系列的条件请求，用时间戳或者etag，发给服务器，服务器来判断，如果没变化就可以直接重用客户端的缓存，否则就发回新的文件。\n\n可以再仔细看看条件请求，关键就是客户端带上一个小的验证信息，让服务器检查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600435821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124962,"avatar":"https://static001.geekbang.org/account/avatar/00/11/2a/62/52231841.jpg","nickname":"Joe","note":"","ucode":"EAEC8ED7986545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306981,"discussion_content":"只有将cache-control: no-cache才会走if系列的条件请求也就是协商缓存。我理解的如果设置cache-control: max-age=36000那么默认是走强缓存路线，那么就不会走if系列的条件请求。所以还是比较纳闷走强缓存的话是只有缓存过期才会重新请求文件，还是有其他的方案，比如文件指纹是不是能解决。不知道是不是我理解错了😂","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600437703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177515,"user_name":"青莲居士","can_delete":false,"product_type":"c1","uid":1374087,"ip_address":"","ucode":"DF269017EDD391","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/87/e7085d32.jpg","comment_is_top":false,"comment_ctime":1581408337,"is_pvip":false,"replies":[{"id":"68900","content":"if系列是条件请求，收到的通常是304这样的报文。<br><br>而max-age等描述的是缓存控制，只要是响应就可以设置，不一定是要有条件请求。<br><br>所以说两者没有必然联系，不过两者经常会同时出现，区分它们的应用场景还是很有必要的。","user_name":"作者回复","comment_id":177515,"uid":"1181974","ip_address":"","utype":1,"ctime":1581410509,"user_name_real":"chrono"}],"discussion_count":2,"race_medal":0,"score":"10171342929","product_id":100029001,"comment_content":"请问下 cache-control 头字段 与 if 系列的请求头字段有依赖关系么 ？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483450,"discussion_content":"if系列是条件请求，收到的通常是304这样的报文。\n\n而max-age等描述的是缓存控制，只要是响应就可以设置，不一定是要有条件请求。\n\n所以说两者没有必然联系，不过两者经常会同时出现，区分它们的应用场景还是很有必要的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581410509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1374087,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f7/87/e7085d32.jpg","nickname":"青莲居士","note":"","ucode":"DF269017EDD391","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167580,"discussion_content":"那么是不是只要服务器支持，第一次请求的时候响应头都会自动带上“last-modified”与“ETag”，不是因为有“cache-Control”请求头字段的原因?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581511224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171965,"user_name":"SeaYang","can_delete":false,"product_type":"c1","uid":1393840,"ip_address":"","ucode":"F44622A44CE8B9","user_header":"https://static001.geekbang.org/account/avatar/00/15/44/b0/c196c056.jpg","comment_is_top":false,"comment_ctime":1579058725,"is_pvip":false,"replies":[{"id":"66808","content":"态度非常认真，大力表扬。<br><br>关于缓存这块，虽然http协议规定的很清楚，但在实现方面，浏览器、服务器又会有各自的一套策略，去尽量做进一步的优化，而且有的可能还不按规矩来，所以会显得比较混乱。<br><br>我们在具体使用缓存的时候就要小心一些，一方面按照标准，另一方面要对不同的浏览器、服务器做测试，保证按照预想的方式处理。","user_name":"作者回复","comment_id":171965,"uid":"1181974","ip_address":"","utype":1,"ctime":1579136798,"user_name_real":"chrono"}],"discussion_count":1,"race_medal":0,"score":"10168993317","product_id":100029001,"comment_content":"观察了一些网站的资源加载情况，有一些总结，老师帮忙看看呢，辛苦了<br>一、打开一个网页，比如百度、慕课网之类的，并打开开发者工具，切换到network面板<br><br>1、勾选disable cache，刷新，页面及内嵌资源文件的请求头有Cache-Control: no-cache，并且不会发送If-Modified-Since、If-None-Match（响应头设置了Last-Modified、ETag等字段）等请求头，所以文档和内嵌资源文件都会返回完整最新的，这个相当于是强制刷新了吧<br><br>2、取消勾选disable cache，刷新，页面的请求头有Cache-Control: max-age=0，而内嵌资源文件的请求头不会有Cache-Control: max-age=0。至于文档和内嵌资源文件从哪里取分两种情况：<br><br>1）若第一次请求的响应头设置了Cache-Control: no-cache或must-revalidate，且设置了Last-Modified、ETag等字段，则走条件请求，可能返回200，也可能返回304，分别取最新的数据和取本地缓存；若没设置Last-Modified、ETag等字段，则取最新完整数据<br><br>2）若第一次请求的响应头没有设置Cache-Control: no-cache或must-revalidate，文档会获取最新的数据或者304走本地缓存（响应头设置了Last-Modified、ETag等字段）；而内嵌资源稍微有点奇怪，有的资源第一次刷新时返回304，后面刷新就返回200走本地缓存了，而有的资源是一直返回200走本地缓存，不知道为什么？<br>       举个例子，在一个新的标签页，打开开发者工具，勾选disable cache，地址栏输入：https:&#47;&#47;www.imooc.com&#47;course&#47;list，回车待页面完全load，找到图片：https:&#47;&#47;static.mukewang.com&#47;static&#47;img&#47;course&#47;course-recommend2.png，取消勾选disable cache，刷新，发现这张图片返回304，后面继续刷新就返回200取本地缓存了，而对于别的一些图片则一直返回200取的本地缓存<br><br>二、对于文档来说，响应头里面Cache-Control只设置max-age似乎没啥用，刷新的话还是取的最新数据，前进后退只走本地缓存，即使max-age过期了且指定了must-revalidate或no-cache，比如在&#47;20-1和&#47;20-2之间一直前进后退，过了30秒还是取的本地缓存。唯一不确定的是对于文档内嵌资源文件，Cache-Control只设置max-age有没有用，因为一些网站的内嵌资源文件响应头的max-age通常设置的比较大，刷新页面这些内嵌资源文件一般都走的本地缓存，就不知道max-age过期了之后再刷新页面，这些内嵌资源文件还会不会走本地缓存<br><br>三、请求头中同时有If-None-Match、If-Modified-Since、Cache-Control，对于服务器来说，If-None-Match、If-Modified-Since的优先级高，也就是即使请求头有Cache-Control: no-cache，走的也是条件请求，而不是直接返回最新完整数据","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481562,"discussion_content":"态度非常认真，大力表扬。\n\n关于缓存这块，虽然http协议规定的很清楚，但在实现方面，浏览器、服务器又会有各自的一套策略，去尽量做进一步的优化，而且有的可能还不按规矩来，所以会显得比较混乱。\n\n我们在具体使用缓存的时候就要小心一些，一方面按照标准，另一方面要对不同的浏览器、服务器做测试，保证按照预想的方式处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579136798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283499,"user_name":"刘杰","can_delete":false,"product_type":"c1","uid":2460800,"ip_address":"","ucode":"5B3A55700D6063","user_header":"https://static001.geekbang.org/account/avatar/00/25/8c/80/7310baac.jpg","comment_is_top":false,"comment_ctime":1615800238,"is_pvip":false,"replies":[{"id":"102877","content":"总结的很好。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1615853625,"ip_address":"","comment_id":283499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5910767534","product_id":100029001,"comment_content":"1、相同点是：Cache和Cookie都可以通过设置max-age设置过期时间，Cache的max-age代表的是从服务器创建报文开始计算的时间，而Cookie的max-age则代表客户端接收后开始计算。差异：Cache可以通过Cache-Control来设置是否需要缓存，no-store表示不缓存，no-cache表示可以缓存，但是需要验证缓存是否过期，must-revalidate，如果缓存不过期可以使用，过期了还想用就要去服务器验证。Cookie可以通过Expires和max-age来设置过期时间，max-age优先级高与Expires。Cache可以通过If-Modified-Since&#47;Last-Modified和If-None-Match&#47;ETag来判断缓存是否有变化，Etag更加精确<br>","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517054,"discussion_content":"总结的很好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615853625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240416,"user_name":"旅途","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1596895345,"is_pvip":false,"replies":[{"id":"88822","content":"304应该是走条件请求才返回的状态码，如果没有发if系列头，服务器应该返回200才对。<br><br>不过既然服务器这么做了，就当它是200吧，也许它内部有什么特殊的处理流程。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1597021637,"ip_address":"","comment_id":240416,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5891862641","product_id":100029001,"comment_content":"老师，问一下 服务器返回304，这个服务器是怎么返回的呢？又没有走指定的查询数据是否改变的接口","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503438,"discussion_content":"304应该是走条件请求才返回的状态码，如果没有发if系列头，服务器应该返回200才对。\n\n不过既然服务器这么做了，就当它是200吧，也许它内部有什么特殊的处理流程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597021637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226468,"user_name":"潇潇雨歇","can_delete":false,"product_type":"c1","uid":1251429,"ip_address":"","ucode":"4BD52BF0F0A084","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/65/35361f02.jpg","comment_is_top":false,"comment_ctime":1592113882,"is_pvip":false,"replies":[{"id":"83395","content":"good","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1592120986,"ip_address":"","comment_id":226468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5887081178","product_id":100029001,"comment_content":"1、cookie主要用于保存会话状态，会作为字段发送给服务端，用于身份认证。而cache是整个资源，也就是整个报文，不作为字段，但是要使用缓存需要设置相应字段。<br>2、强制刷新后：Cache-Control：no-cache，且没有If-None-Match和If-Modified-Since字段，这样就不能命中缓存了，所以会返回200；而普通刷新有这些字段，Cache-Control为max-age=0，存在If-None-Match或If-Modified-Since字段，根据情况使用强缓存协商缓存。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498252,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592120986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216237,"user_name":"海盗船长","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1589208182,"is_pvip":false,"replies":[{"id":"80050","content":"没错的，浏览器的缓存是由服务器来控制的，由服务器来下发到浏览器。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1589246086,"ip_address":"","comment_id":216237,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884175478","product_id":100029001,"comment_content":"“所以今天我先讲客户端——也就是浏览器的缓存。服务器的缓存控制”  哈哈 ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494727,"discussion_content":"没错的，浏览器的缓存是由服务器来控制的，由服务器来下发到浏览器。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589246086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215529,"user_name":"cc","can_delete":false,"product_type":"c1","uid":1697629,"ip_address":"","ucode":"114C613276C6AC","user_header":"https://static001.geekbang.org/account/avatar/00/19/e7/5d/deeb2580.jpg","comment_is_top":false,"comment_ctime":1589011519,"is_pvip":false,"replies":[{"id":"79778","content":"<br>1.强etag计算成本较高，可以自己添加，Nginx默认使用的是弱etag。<br><br>2.看rfc7234，expires用的是时间戳，-1是无效的，如果有max-age，expires也会被忽略。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1589013435,"ip_address":"","comment_id":215529,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5883978815","product_id":100029001,"comment_content":"怎么设置强Etag呢？<br>在Nginx里面配置了Expires: -1为什么HTML还会有缓存","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494467,"discussion_content":"\n1.强etag计算成本较高，可以自己添加，Nginx默认使用的是弱etag。\n\n2.看rfc7234，expires用的是时间戳，-1是无效的，如果有max-age，expires也会被忽略。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589013435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159664,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1575723250,"is_pvip":false,"replies":[{"id":"61058","content":"会获得最新的数据，但如果数据不变就直接走缓存，服务器返回304，省去了再次传输数据的成本。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1575852626,"ip_address":"","comment_id":159664,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5870690546","product_id":100029001,"comment_content":"老师，您这里这么说的：“no-cache：它的字面含义容易与 no-store 搞混，实际的意思并不是不允许缓存，而是可以缓存，但在使用之前必须要去服务器验证是否过期，是否有最新的版本”。<br>这个no-cache在这里浏览器请示服务器，如果服务器确定资源没有过期，没有新的版本，那么浏览器就是用缓存的数据了？感觉浏览器只要加上这个，就会获得最新的数据，没有走缓存吧？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477137,"discussion_content":"会获得最新的数据，但如果数据不变就直接走缓存，服务器返回304，省去了再次传输数据的成本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575852626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150051,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573454157,"is_pvip":false,"replies":[{"id":"57738","content":"是的，缓存当然是只对获取文件有效，从服务器上拿到文件然后放入本地缓存。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573457225,"ip_address":"","comment_id":150051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5868421453","product_id":100029001,"comment_content":"max-age是不是只对文件请求有效？为什么我看到的例子都是请求文件？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474050,"discussion_content":"是的，缓存当然是只对获取文件有效，从服务器上拿到文件然后放入本地缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573457225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131033,"user_name":"Bean","can_delete":false,"product_type":"c1","uid":1557853,"ip_address":"","ucode":"DC1A0C8B6BF083","user_header":"https://static001.geekbang.org/account/avatar/00/17/c5/5d/9e75eb36.jpg","comment_is_top":false,"comment_ctime":1567605768,"is_pvip":false,"replies":[{"id":"49318","content":"http标准没有规定必须要存储在内存或磁盘，如何存储都是由客户端（浏览器）自己决定的。<br><br>我觉得这种说法不准确，其实缓存都会落盘存储，但有的可能会在内存里也放一份，加快访问速度。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1567645287,"ip_address":"","comment_id":131033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862573064","product_id":100029001,"comment_content":"老师有文章说浏览器会在js和图片等文件解析执行后直接存入内存缓存中， 而css文件则会存入硬盘文件中。为什么？ 存入内存还是硬盘 是怎么触发 的","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466257,"discussion_content":"http标准没有规定必须要存储在内存或磁盘，如何存储都是由客户端（浏览器）自己决定的。\n\n我觉得这种说法不准确，其实缓存都会落盘存储，但有的可能会在内存里也放一份，加快访问速度。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567645287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121217,"user_name":"blackjuly","can_delete":false,"product_type":"c1","uid":1229068,"ip_address":"","ucode":"12B2C46F246718","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/0c/f47fd608.jpg","comment_is_top":false,"comment_ctime":1565079966,"is_pvip":false,"replies":[{"id":"44547","content":"实际的应用场景我也暂时没见到，但last-modified从运行机制上是存在这个问题的。<br><br>举个不恰当的例子，比如说某个应用的log，开放http接口获取在web上展示，如果log更新频繁，那么就应该用etag。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1565086445,"ip_address":"","comment_id":121217,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5860047262","product_id":100029001,"comment_content":"请问老师，有看到您说的一个ETag解决的问题： 一个文件在一秒内改变多次，可以用ETag来解决文件修改无法被感知到的情况；这个有场景可以举例吗？因为总感觉修改这么频繁的东西应该就不需要缓存了吧","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461686,"discussion_content":"实际的应用场景我也暂时没见到，但last-modified从运行机制上是存在这个问题的。\n\n举个不恰当的例子，比如说某个应用的log，开放http接口获取在web上展示，如果log更新频繁，那么就应该用etag。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565086445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118710,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1564419956,"is_pvip":false,"replies":[{"id":"43519","content":"cache-control是管理缓存，不是决定验证的。<br><br>验证的条件是modified-date和etag，由条件请求发起验证。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1564448249,"ip_address":"","comment_id":118710,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5859387252","product_id":100029001,"comment_content":"Cache-Control只是用来决定是否需要验证，而条件参数才是真正决定怎样验证的。如果没有条件参数，就当验证失败处理，返回新数据。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460541,"discussion_content":"cache-control是管理缓存，不是决定验证的。\n\n验证的条件是modified-date和etag，由条件请求发起验证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564448249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1676455,"avatar":"https://static001.geekbang.org/account/avatar/00/19/94/a7/43c1efaa.jpg","nickname":"笨重的企鹅","note":"","ucode":"416803E12D5829","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351876,"discussion_content":"感觉这位同学说的就是对的啊，我也是这么理解的，Cache-Control得到的值不就决定了下次请求要不要去验证么?!!!!虽然从官方解释不是这样的，但是细品就是这么回事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614509150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113146,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1562902716,"is_pvip":false,"replies":[{"id":"41306","content":"√","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1563002120,"ip_address":"","comment_id":113146,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857870012","product_id":100029001,"comment_content":"2、强制刷新，请求头里有Pragma: no-cache和Cache-Control: no-cache，没有If-Modified-Since&#47;If-None-Match，这个Pragma: no-cache的意思是禁用缓存","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458076,"discussion_content":"√","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563002120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360867,"user_name":"曾泽浩","can_delete":false,"product_type":"c1","uid":1104601,"ip_address":"上海","ucode":"A7E5CF9E1571A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","comment_is_top":false,"comment_ctime":1666925336,"is_pvip":false,"replies":[{"id":"131274","content":"两个环节都可以做，Nginx这样的作为代理服务器可以修改原始设置，这个要看具体的业务需求了。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1666929146,"ip_address":"上海","comment_id":360867,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1666925336","product_id":100029001,"comment_content":"你好，我想请教一下，服务器返回的缓存有效时间，一般是业务开发的时候设置返回Headers的吗？还是通用的服务器如Nginx，Apache去做的<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591911,"discussion_content":"两个环节都可以做，Nginx这样的作为代理服务器可以修改原始设置，这个要看具体的业务需求了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666929146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355882,"user_name":"不二","can_delete":false,"product_type":"c1","uid":1253124,"ip_address":"上海","ucode":"B018B32EDB44E5","user_header":"https://static001.geekbang.org/account/avatar/00/13/1f/04/1cddf65b.jpg","comment_is_top":false,"comment_ctime":1661827502,"is_pvip":false,"replies":[{"id":"129548","content":"<br>其实浏览器只是客户端的一种，如果我们用curl，就没有缓存这样的事情，如何处理缓存、是否缓存都在于客户端程序。当然cache-control是用来指示如何使用缓存的。<br><br>常用的确实只有几种，其他的组合基本上没意义，这也跟http协议定义的太灵活有关。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1661852177,"ip_address":"上海","comment_id":355882,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661827502","product_id":100029001,"comment_content":"老师好，有个疑问，我可以这样理解吗？<br><br>每次服务器端返回请求数据以后，浏览器都会自动对其进行缓存，而我们谈到的这些头信息只是为了控制是否可以访问缓存数据，并不是说，这些头信息是为了控制数据是否可以被缓存，<br>例如：cache-control：no-store，其实是表示下次请求的时候，不会从缓存读取（但其实浏览器还是缓存了数据的，可以这样理解吗？至于什么时候清除这些缓存，那就是浏览器内部的机制啦）<br><br>还有一个点是，服务器端cache-control一般都是通过如下这几种方式使用吧：<br>1. cache-control: no-store， 表示不使用缓存。<br>2. cache-control: no-cache， 表示可以使用缓存，但是需要先去服务端验证。<br>3. cache-control: max-age: 5000; must-validate; 表示可是使用缓存，同时先判断本地缓存是否有效，再去服务器端验证。<br><br>常见的搭配方式就以上这三种吧，不会出现no-cache,与must-validate，max-age一起返回，感觉也没什么意义。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585864,"discussion_content":"\n其实浏览器只是客户端的一种，如果我们用curl，就没有缓存这样的事情，如何处理缓存、是否缓存都在于客户端程序。当然cache-control是用来指示如何使用缓存的。\n\n常用的确实只有几种，其他的组合基本上没意义，这也跟http协议定义的太灵活有关。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661852177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344173,"user_name":"Geek_115bc8","can_delete":false,"product_type":"c1","uid":1673843,"ip_address":"","ucode":"71FBC9F02AFE1B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erXRaa98A3zjLDkOibUJV1254aQ4EYFTbSLJuEvD0nXicMNA8pLoxOfHf5kPTbGLXNicg8CPFH3Tn0mA/132","comment_is_top":false,"comment_ctime":1651323201,"is_pvip":false,"replies":[{"id":"125712","content":"great。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1651539962,"ip_address":"","comment_id":344173,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651323201","product_id":100029001,"comment_content":"1. Cache 和 Cookie 都是服务器发给客户端并存储的数据，你能比较一下两者的异同吗？<br>cache主要是通过服务器指定的缓存字段来给不长改变的静态资源做缓存。<br>cookie: 主要是服务器为了识别用户身份，向客户端发送的一个文本。并在下次请求时，携带给服务器。<br>2. 即使有“Last-modified”和“ETag”，强制刷新（Ctrl+F5）也能够从服务器获取最新数据（返回 200 而不是 304），请你在实验环境里试一下，观察请求头和响应头，解释原因。<br>因为浏览器清除了缓存资源。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569721,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651539962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340671,"user_name":"橡皮泥","can_delete":false,"product_type":"c1","uid":1786583,"ip_address":"","ucode":"75D807D5CBF566","user_header":"https://static001.geekbang.org/account/avatar/00/1b/42/d7/08486f16.jpg","comment_is_top":false,"comment_ctime":1649038565,"is_pvip":true,"replies":[{"id":"124649","content":"只要是条件请求，就必然要带上验证，不然条件就没有意义了。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1649235891,"ip_address":"","comment_id":340671,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649038565","product_id":100029001,"comment_content":"条件请求的时候，如果预先的第一次响应报文里的ETag表明资源未变化，第二次还需要带上缓存去验证资源是否最新吗","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560238,"discussion_content":"只要是条件请求，就必然要带上验证，不然条件就没有意义了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649235892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335232,"user_name":"Geek_2753cc","can_delete":false,"product_type":"c1","uid":1759808,"ip_address":"","ucode":"9A108A3E1FFC6B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRPuYmxCsTaEroajHBWnBALgPW1PFYXviarfeCpvIGap5xZ3uo6XOyW6QA4ibvuyX0w3YsW0aYRf8w/132","comment_is_top":false,"comment_ctime":1645422441,"is_pvip":false,"replies":[{"id":"122510","content":"max-age=0，就是要最新的资源，所以是200。<br><br>课程里应该解释了，可以再看看。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1645534477,"ip_address":"","comment_id":335232,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1645422441","product_id":100029001,"comment_content":"试了下实验环境的 URI “&#47;20-2”，请求头中带了Cache-Control: max-age=0，且头部带了ETag，资源没有更新的情况下响应状态码不是304，而是200，这是为什么呀？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552638,"discussion_content":"max-age=0，就是要最新的资源，所以是200。\n\n课程里应该解释了，可以再看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645534477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1759808,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRPuYmxCsTaEroajHBWnBALgPW1PFYXviarfeCpvIGap5xZ3uo6XOyW6QA4ibvuyX0w3YsW0aYRf8w/132","nickname":"Geek_2753cc","note":"","ucode":"9A108A3E1FFC6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552639,"discussion_content":"但是加了etag的话也不会走协商缓存吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645535136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552638,"ip_address":""},"score":552639,"extra":""}]}]},{"had_liked":false,"id":334295,"user_name":"hzs","can_delete":false,"product_type":"c1","uid":1808206,"ip_address":"","ucode":"6844D91F80286E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlIAZkJJZ9hflv3rMENqGGuxYRSsYE8bIpXiaQfAbfH7qVmiaJAyVEiaEj6sP9BRlIWWqRA/132","comment_is_top":false,"comment_ctime":1644852552,"is_pvip":false,"replies":[{"id":"122132","content":"这个应该是由服务器来决定的，200就是忽略缓存完全获取内容，304就表示可以使用缓存。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1644895583,"ip_address":"","comment_id":334295,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644852552","product_id":100029001,"comment_content":"请问一下，浏览器启用缓存时，分别在什么情况下返回200和304状态码呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551091,"discussion_content":"这个应该是由服务器来决定的，200就是忽略缓存完全获取内容，304就表示可以使用缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644895583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330817,"user_name":"穷精致","can_delete":false,"product_type":"c1","uid":2040934,"ip_address":"","ucode":"F5994A9F8431D7","user_header":"https://static001.geekbang.org/account/avatar/00/1f/24/66/95ef781c.jpg","comment_is_top":false,"comment_ctime":1642176533,"is_pvip":true,"replies":[{"id":"120989","content":"条件请求不是一定要返回304，200也是可以的，这种情况浏览器就会获取全部数据，而不是从缓存里拿了。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1642477052,"ip_address":"","comment_id":330817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642176533","product_id":100029001,"comment_content":"请问一下，现在看极客时间网站的network里请求的if-none-match 和 响应头的etag值相等，那这里正常情况下接口应该是304，但是现在看都是200，这是什么情况呢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546954,"discussion_content":"条件请求不是一定要返回304，200也是可以的，这种情况浏览器就会获取全部数据，而不是从缓存里拿了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642477052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318746,"user_name":"joel","can_delete":false,"product_type":"c1","uid":1550366,"ip_address":"","ucode":"46E91C3F3F1414","user_header":"https://static001.geekbang.org/account/avatar/00/17/a8/1e/4ec85e24.jpg","comment_is_top":false,"comment_ctime":1635409564,"is_pvip":true,"replies":[{"id":"115571","content":"可能跟浏览器的实现有关吧，我之前的测试是这样的行为，也许现在变了？<br><br>记得有一个网页，总结了F5按键后不同浏览器的具体行为，可惜现在找不到了，抱歉。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1635424822,"ip_address":"","comment_id":318746,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1635409564","product_id":100029001,"comment_content":"当你点“刷新”按钮的时候，浏览器会在请求头里加一个“Cache-Control: max-age=0”。<br> 我在掘金网站上发现不是这样的，想问下是有什么机制吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529369,"discussion_content":"可能跟浏览器的实现有关吧，我之前的测试是这样的行为，也许现在变了？\n\n记得有一个网页，总结了F5按键后不同浏览器的具体行为，可惜现在找不到了，抱歉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635424822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1550366,"avatar":"https://static001.geekbang.org/account/avatar/00/17/a8/1e/4ec85e24.jpg","nickname":"joel","note":"","ucode":"46E91C3F3F1414","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410698,"discussion_content":"好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635760309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318077,"user_name":"。","can_delete":false,"product_type":"c1","uid":1723580,"ip_address":"","ucode":"BFEF2648FE8A85","user_header":"https://static001.geekbang.org/account/avatar/00/1a/4c/bc/d9ef313e.jpg","comment_is_top":false,"comment_ctime":1635142672,"is_pvip":false,"replies":[{"id":"115328","content":"这个也许和浏览器的具体行为有关，对这些字段的解释不一样，不能单纯就是说协议规定不对。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1635162767,"ip_address":"","comment_id":318077,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635142672","product_id":100029001,"comment_content":"请教一下老师，我在配置openresty的时候，如果只有add_header Cache-Control &#39;no-store&#39;; 这个头访问页面的时候里面的js还是304，只有再加上add_header max-age 0;的时候js才会200。no-store不是不使用缓存吗？怎么需要两个一起组合使用？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529093,"discussion_content":"这个也许和浏览器的具体行为有关，对这些字段的解释不一样，不能单纯就是说协议规定不对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635162767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311494,"user_name":"乘风破浪","can_delete":false,"product_type":"c1","uid":2406841,"ip_address":"","ucode":"937AF15F3FEBDC","user_header":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","comment_is_top":false,"comment_ctime":1631256651,"is_pvip":false,"replies":[{"id":"112915","content":"对浏览器行为没有研究，感谢补充。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1631350032,"ip_address":"","comment_id":311494,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631256651","product_id":100029001,"comment_content":"客户端“”当你点“刷新”按钮的时候，浏览器会在请求头里加一个“Cache-Control: max-age=0”。”<br>感觉有2点需要澄清<br>1. 直接刷新的页面，和页面内嵌的资源，在浏览器点刷新行为结果是不一样的。<br>简单说，直接刷新的页面，有可能从服务器上取新的资源或返回304，而内嵌的资源，则很可能直接返回缓存200（from disk&#47;memory cache），这也符合html caching Revved resources的设计逻辑。<br>2. 客户端的cache-control设置，是要求服务器端如何使用它的缓存，max-age对标的是服务器的Age属性。<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526634,"discussion_content":"对浏览器行为没有研究，感谢补充。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631350032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311490,"user_name":"乘风破浪","can_delete":false,"product_type":"c1","uid":2406841,"ip_address":"","ucode":"937AF15F3FEBDC","user_header":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","comment_is_top":false,"comment_ctime":1631255971,"is_pvip":false,"replies":[{"id":"112916","content":"no-cache可以缓存，所以就必须要设置一个缓存时间。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1631350173,"ip_address":"","comment_id":311490,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631255971","product_id":100029001,"comment_content":"服务器的缓存控制策略画了一个流程图<br>---感觉这个图有点问题<br>对于no-cache,应该是不考虑max-age，因为它已经取服务器验证了，验证通过则直接使用缓存，否则从服务器取最新的资源。所以no-cache的yes分支，不会再回到max-age。<br>---逻辑推测而已，没有方式验证。。。。<br><br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526633,"discussion_content":"no-cache可以缓存，所以就必须要设置一个缓存时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631350173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305760,"user_name":"Libolus","can_delete":false,"product_type":"c1","uid":1371535,"ip_address":"","ucode":"CACDFBB9B81575","user_header":"https://static001.geekbang.org/account/avatar/00/14/ed/8f/493738b7.jpg","comment_is_top":false,"comment_ctime":1628151360,"is_pvip":false,"replies":[{"id":"110663","content":"浏览器的行为可能会因为版本升级而变动，而且不同的浏览器它的行为也不一致，这个没办法完全保证。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1628210940,"ip_address":"","comment_id":305760,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1628151360","product_id":100029001,"comment_content":"老师说道，浏览器刷新会带上请求头Cache-Control: no-cache，我这边实际测试了一下chrome_92，好像并不是这样的","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524502,"discussion_content":"浏览器的行为可能会因为版本升级而变动，而且不同的浏览器它的行为也不一致，这个没办法完全保证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628210940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304163,"user_name":"looping","can_delete":false,"product_type":"c1","uid":1085349,"ip_address":"","ucode":"D2F2474122779B","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/a5/eb15586d.jpg","comment_is_top":false,"comment_ctime":1627282504,"is_pvip":false,"replies":[{"id":"110062","content":"这个属于浏览器的行为了，不过这样做感觉对用户不是太友好。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1627286444,"ip_address":"","comment_id":304163,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627282504","product_id":100029001,"comment_content":"看了下，chrome现在即使 ctrl +F5 ,也会增加 If-Modified-Since 参数了。有人在问这个问题：https:&#47;&#47;stackoverflow.com&#47;questions&#47;385367&#47;what-requests-do-browsers-f5-and-ctrl-f5-refreshes-generate","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523956,"discussion_content":"这个属于浏览器的行为了，不过这样做感觉对用户不是太友好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627286444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299575,"user_name":"学不动了","can_delete":false,"product_type":"c1","uid":1235562,"ip_address":"","ucode":"6855C982ECC3A8","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/6a/6b96edbd.jpg","comment_is_top":false,"comment_ctime":1624720368,"is_pvip":true,"replies":[{"id":"108663","content":"响应头里有date字段，表示报文的生成时间，再加上max-age就是有效时间了。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1624784314,"ip_address":"","comment_id":299575,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624720368","product_id":100029001,"comment_content":"max-age=5，在传输链路中耗费4s，只在客户端保存1s，客户端是如何得知报文在传输链路中所耗费的时间？换句话说这时候客户端是如何判断缓存失效？如果是每次都发送条件请求去服务端验证缓存是否失效，那max-age的意义何在？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522479,"discussion_content":"响应头里有date字段，表示报文的生成时间，再加上max-age就是有效时间了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624784314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297866,"user_name":"乘风破浪","can_delete":false,"product_type":"c1","uid":2406841,"ip_address":"","ucode":"937AF15F3FEBDC","user_header":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","comment_is_top":false,"comment_ctime":1623824968,"is_pvip":false,"replies":[{"id":"108147","content":"应用场景可能不同，但判断的条件是可以类推的。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1623829928,"ip_address":"","comment_id":297866,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623824968","product_id":100029001,"comment_content":"条件请求里其他的三个头字段是“If-Unmodified-Since”“If-Match”和“If-Range”，其实只要你掌握了“if-Modified-Since”和“If-None-Match”，可以轻易地“举一反三”。<br>---读了一下MDN,感觉这几个字段还真不能举一反三。<br><br>比如If-Unmodified-Since针对2种主要的应用场景<br>1. 配合IF-RANGE，判断断点续传是否可以继续，还是得重传<br>2. 配合Post，判断多人更新资源是否冲突，否则返回412.<br><br>它和304没有关系，也不能举一反三。。。<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521949,"discussion_content":"应用场景可能不同，但判断的条件是可以类推的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623829928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291582,"user_name":"レイン小雨","can_delete":false,"product_type":"c1","uid":1219933,"ip_address":"","ucode":"45BED977EFE852","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/5d/3fdead91.jpg","comment_is_top":false,"comment_ctime":1620374655,"is_pvip":false,"replies":[{"id":"105628","content":"正文里好像说了，会有一个启发式算法，尽量缓存一小段时间。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1620435162,"ip_address":"","comment_id":291582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620374655","product_id":100029001,"comment_content":"如果服务器不返回任何跟缓存策略相关的头字段，那么浏览器会对资源实行怎样的缓存呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519514,"discussion_content":"正文里好像说了，会有一个启发式算法，尽量缓存一小段时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620435162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290731,"user_name":"huanshui@smile","can_delete":false,"product_type":"c1","uid":2141878,"ip_address":"","ucode":"0A334A3E20CA46","user_header":"https://static001.geekbang.org/account/avatar/00/20/ae/b6/fc1c61f8.jpg","comment_is_top":false,"comment_ctime":1619708306,"is_pvip":false,"replies":[{"id":"105356","content":"<br>1.etag变动表示资源肯定是修改了，所以就要更新，其实这个不是优先级的问题。<br><br>2.刷新就是要使缓存失效，从服务器获取最新的，所以要maxage=0，而其他时候不是刷新，缓存就可以发挥作用了。<br><br>3.http协议只是规定了这些缓存的存放和获取方式，具体如何使用就要看浏览器自己发挥了，所以有时候可能会不会如我们预期。如果我们自己写http客户端，那么就可以拿到这些头按自己的想法去使用缓存。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1619740626,"ip_address":"","comment_id":290731,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619708306","product_id":100029001,"comment_content":"罗老师，有几个问题想确认一下：<br>1. &quot;是资源的一个唯一标识，主要是用来解决修改时间无法准确区分文件变化的问题。&quot;这句话是否意味着Etag和’last-modified‘是有优先级之分的，当两者有歧义时（文件修改时间变了，但是资源的唯一标识没变），Etag的优先级会并且也应该更高。<br>2. 我想不通的一点是为什么当刷新的时候，请求头会带有“cache-control:max-age=0”字段，也就意味着将会失去强缓存，使用协商缓存。那么强缓存存在的意义又是什么呢？难道只是为了新打开一个标签页，以及浏览器前进和后退的时候进行强缓存么？但是实际情况中用户操作最多的不是刷新么。主要是想不通浏览器为什么这么设计。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519272,"discussion_content":"\n1.etag变动表示资源肯定是修改了，所以就要更新，其实这个不是优先级的问题。\n\n2.刷新就是要使缓存失效，从服务器获取最新的，所以要maxage=0，而其他时候不是刷新，缓存就可以发挥作用了。\n\n3.http协议只是规定了这些缓存的存放和获取方式，具体如何使用就要看浏览器自己发挥了，所以有时候可能会不会如我们预期。如果我们自己写http客户端，那么就可以拿到这些头按自己的想法去使用缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619740626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281483,"user_name":"笨重的企鹅","can_delete":false,"product_type":"c1","uid":1676455,"ip_address":"","ucode":"416803E12D5829","user_header":"https://static001.geekbang.org/account/avatar/00/19/94/a7/43c1efaa.jpg","comment_is_top":false,"comment_ctime":1614762588,"is_pvip":false,"replies":[{"id":"102223","content":"可以抓一下包，看看F5是否发了Catch-control，可能有的浏览器行为与课程里的不同。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1614820860,"ip_address":"","comment_id":281483,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614762588","product_id":100029001,"comment_content":"文中说F5刷新会很失望，不会有缓存，但我实际体验的效果是F5刷新是有缓存的（from  memory cache），所以缓存控制到底受不受请求头Catch-control的影响呢？我个人感觉是请求头的Catch-control只是告诉服务器现在的缓存现状，但是到底怎样缓存，还是依赖服务器返回的响应头字段，所以决定权是服务器，而不是客户端","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516412,"discussion_content":"可以抓一下包，看看F5是否发了Catch-control，可能有的浏览器行为与课程里的不同。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614820860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281180,"user_name":"小晴天","can_delete":false,"product_type":"c1","uid":1322957,"ip_address":"","ucode":"F336B97214CDE4","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/cd/4f83ce2d.jpg","comment_is_top":false,"comment_ctime":1614610677,"is_pvip":false,"replies":[{"id":"102104","content":"great。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1614648169,"ip_address":"","comment_id":281180,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614610677","product_id":100029001,"comment_content":"cookie是为了记录身份，cache则是从客户端从它这里获取资源，减少网络请求。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516315,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614648169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277099,"user_name":"s(t)","can_delete":false,"product_type":"c1","uid":1748599,"ip_address":"","ucode":"1415FAA5E0C5EB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ae/77/7066354b.jpg","comment_is_top":false,"comment_ctime":1612259633,"is_pvip":false,"replies":[{"id":"100585","content":"这个就是直接从缓存获取数据了，没有发出请求，跟https没有关系。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1612323897,"ip_address":"","comment_id":277099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612259633","product_id":100029001,"comment_content":"我正常刷新页面。会得到 status code:200(from memory cache)，这是什么意思？走的强缓存吗。下面的请求头看不到，也没法自己简单分析，不知道是不是https的原因","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514931,"discussion_content":"这个就是直接从缓存获取数据了，没有发出请求，跟https没有关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612323897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273120,"user_name":"牛","can_delete":false,"product_type":"c1","uid":2382521,"ip_address":"","ucode":"12C46025BBA2D3","user_header":"","comment_is_top":false,"comment_ctime":1610444842,"is_pvip":false,"replies":[{"id":"98989","content":"刷新当然会发送请求，只是里面的header字段不一样。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1610500165,"ip_address":"","comment_id":273120,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1610444842","product_id":100029001,"comment_content":"为什么我的浏览器普通刷新和强制刷新都是一个效果，都会发送新请求？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513500,"discussion_content":"刷新当然会发送请求，只是里面的header字段不一样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610500165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263797,"user_name":"少即是多","can_delete":false,"product_type":"c1","uid":1373366,"ip_address":"","ucode":"0BC98C7406BB24","user_header":"https://static001.geekbang.org/account/avatar/00/14/f4/b6/019bbb4d.jpg","comment_is_top":false,"comment_ctime":1606269236,"is_pvip":false,"replies":[{"id":"95701","content":"这个是由“客户端”来决定的。<br><br>对于浏览器，它就是客户端，所以如果有etag，它就会发这个If-None-Match的条件请求来尽量利用缓存。<br><br>如果是你自己写客户端发送http请求，那就需要自己手动加上这个头了。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1606280885,"ip_address":"","comment_id":263797,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1606269236","product_id":100029001,"comment_content":"请问老师一个问题： If-None-Match 需要自己加到请求头还是浏览器会自己检测ETag,然后自动添加。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510309,"discussion_content":"这个是由“客户端”来决定的。\n\n对于浏览器，它就是客户端，所以如果有etag，它就会发这个If-None-Match的条件请求来尽量利用缓存。\n\n如果是你自己写客户端发送http请求，那就需要自己手动加上这个头了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606280885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1373366,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f4/b6/019bbb4d.jpg","nickname":"少即是多","note":"","ucode":"0BC98C7406BB24","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328960,"discussion_content":"谢谢老师哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606287286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245642,"user_name":"Javatar","can_delete":false,"product_type":"c1","uid":2032840,"ip_address":"","ucode":"E216645CDF632C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","comment_is_top":false,"comment_ctime":1599015289,"is_pvip":false,"replies":[{"id":"90347","content":"是的，head方法就是get的简化版，只获取基本信息，不发送body。<br><br>不过这也得看服务器，比如有的动态资源，服务器可能就不处理head。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1599020243,"ip_address":"","comment_id":245642,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599015289","product_id":100029001,"comment_content":"“浏览器可以用两个连续的请求组成“验证动作”：先是一个 HEAD，获取资源的修改时间等元信息，然后与缓存数据比较，如果没有改动就使用缓存...”<br><br>老师在这里提到了两步验证动作，第一步是个HEAD，之前老师在http方法那一讲也提到过，HEAD方法相当于轻量级的GET，那我想问的是，只要支持GET方法的资源，就一定支持HEAD么？我试了几个sever，GET方法的资源，使用HEAD方法也都可以正常响应","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504938,"discussion_content":"是的，head方法就是get的简化版，只获取基本信息，不发送body。\n\n不过这也得看服务器，比如有的动态资源，服务器可能就不处理head。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599020243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232521,"user_name":"@_@","can_delete":false,"product_type":"c1","uid":1925632,"ip_address":"","ucode":"AE2A083919B638","user_header":"https://static001.geekbang.org/account/avatar/00/1d/62/00/35e43b9c.jpg","comment_is_top":false,"comment_ctime":1594026975,"is_pvip":false,"replies":[{"id":"85887","content":"HTTP协议里对缓存已经定义的比较明确了，但落实到浏览器里就是另外一回事了，为了优化可能会有一些自己的特殊策略。<br><br>我不是很了解具体的浏览器，恐怕在这方面帮不了你，也许可以参考一下其他浏览器相关的文章、课程。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1594083407,"ip_address":"","comment_id":232521,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594026975","product_id":100029001,"comment_content":"老师，HTTP缓存结合浏览器能不能扩展开来讲一讲，缓存策略完全不知道是怎么样的，着实让人头疼。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500678,"discussion_content":"HTTP协议里对缓存已经定义的比较明确了，但落实到浏览器里就是另外一回事了，为了优化可能会有一些自己的特殊策略。\n\n我不是很了解具体的浏览器，恐怕在这方面帮不了你，也许可以参考一下其他浏览器相关的文章、课程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594083407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232510,"user_name":"@_@","can_delete":false,"product_type":"c1","uid":1925632,"ip_address":"","ucode":"AE2A083919B638","user_header":"https://static001.geekbang.org/account/avatar/00/1d/62/00/35e43b9c.jpg","comment_is_top":false,"comment_ctime":1594024077,"is_pvip":false,"replies":[{"id":"85888","content":"是的，如果没有给cache-control、expires字段，那么可以自己根据last-modified等字段来估算一个缓存时间，这个在rfc里也有推荐算法。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1594083496,"ip_address":"","comment_id":232510,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594024077","product_id":100029001,"comment_content":"Request URL: http:&#47;&#47;xx.xx.xx.xx:8085&#47;images&#47;logo.png<br>Request Method: GET<br>Status Code: 200 OK (from memory cache)<br>Remote Address: xx.xxx.xx.xx:8085<br>Referrer Policy: no-referrer-when-downgrade<br><br>Accept-Ranges: bytes<br>Connection: keep-alive<br>Content-Length: 10161<br>Content-Type: image&#47;png<br>Date: Mon, 06 Jul 2020 08:07:35 GMT<br>ETag: &quot;5ed5f0ab-27b1&quot;<br>Last-Modified: Tue, 02 Jun 2020 06:24:43 GMT<br>Server: nginx&#47;1.12.<br><br>Provisional headers are shown. Disable cache to see full headers.<br>Referer: http:&#47;&#47;xxxx.xxxx.xxxx.xxxx&#47;login?&#47;<br>User-Agent: Mozilla&#47;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;81.0.4044.122 Safari&#47;537.36<br><br>老师，我想请问一下，这个缓存是使用了启发算法计算缓存时间了嘛？希望老师解释一下","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500671,"discussion_content":"是的，如果没有给cache-control、expires字段，那么可以自己根据last-modified等字段来估算一个缓存时间，这个在rfc里也有推荐算法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594083496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228435,"user_name":"Demon","can_delete":false,"product_type":"c1","uid":1390641,"ip_address":"","ucode":"58CD838717F36D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIUdfNDQs3eLoIjfIXDm77W66udicLfqh6NA8QX4QuZNO48UlRTfDo2Fm2jGX0z3hjnbARib8wSbxcg/132","comment_is_top":false,"comment_ctime":1592670983,"is_pvip":false,"replies":[{"id":"84246","content":"<br>http协议很灵活，很多时候两边都可以灵活变通。<br><br>缓存时间如果没有明确给出，浏览器也可以自己估算一个，算法自定。<br>","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1592722900,"ip_address":"","comment_id":228435,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1592670983","product_id":100029001,"comment_content":"缓存是由Cache-Control来控制的，该头即可以在请求报文中，也可以在响应报文中。最终浏览器是否使用缓存是二者协商的结果（取严格的那个？）<br>Cache-Control对缓存的失效性作了定义：<br>max-age=xxx是写死了一个缓存时间，到了就失效，没到就用缓存。是否使用缓存不需要再次跟服务器协商；<br>no-store 不准缓存<br>no-cache 下次访问需要先跟服务器确认是否过期，过期就不能用缓存<br>must-revalidate 有效期内直接用缓存，过期后得先问下服务器，是否能用当前这个缓存。（问题是，假如上次请求，响应头里只有Cache-Control: must-revalidate，这个时效是怎么来的呢，默认值时0？）<br><br>后两种缓存机制需要在使用时发条件请求。正常情况下先发head，根据响应头判断是否过期，再根据策略决定是否使用缓存。为了减少请求数和浏览器的责任，可以通过if-xxx头来将两个请求合而为1<br>if-Modified-Since和上次响应头中的last-modified对应，通过时间维度来确认缓存是否过期；<br>If-None-Match和上次响应头中的Etag对应，通过内容维度来确认缓存是否过期；<br><br>ETag分两种，强和弱，格式上通过起始位置有没有\\w来区分：<br>强ETag通常用于静态资源<br>弱ETag通常用于动态生成的资源，更新的标准是是否有语义上的变化（这个标准其实是由业务定的？）","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499032,"discussion_content":"\nhttp协议很灵活，很多时候两边都可以灵活变通。\n\n缓存时间如果没有明确给出，浏览器也可以自己估算一个，算法自定。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592722900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2406841,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","nickname":"乘风破浪","note":"","ucode":"937AF15F3FEBDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349314,"discussion_content":"缓存是由Cache-Control来控制的，该头即可以在请求报文中，也可以在响应报文中。最终浏览器是否使用缓存是二者协商的结果（取严格的那个？）\n---单向独立生效的，不是协商结果\nCache-Control对缓存的失效性作了定义：\nmax-age=xxx是写死了一个缓存时间，到了就失效，没到就用缓存。是否使用缓存不需要再次跟服务器协商；\n---后退，前进直接用\n---其它，要配合if字段，询问服务器。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613055320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222778,"user_name":"rongyefeng","can_delete":false,"product_type":"c1","uid":1959482,"ip_address":"","ucode":"9A15D947E9D645","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e6/3a/382cf024.jpg","comment_is_top":false,"comment_ctime":1590910426,"is_pvip":false,"replies":[{"id":"82157","content":"不发送请求，就不会有tcp连接、请求解析的成本，直接在本地缓存取结果，所以是最快的。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1590926074,"ip_address":"","comment_id":222778,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590910426","product_id":100029001,"comment_content":"“没有消息就是好消息”，“没有请求的请求，才是最快的请求。”<br>老师，能不能把这句话再白一点点呢？谢谢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496912,"discussion_content":"不发送请求，就不会有tcp连接、请求解析的成本，直接在本地缓存取结果，所以是最快的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590926074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221727,"user_name":"孟豪","can_delete":false,"product_type":"c1","uid":1427958,"ip_address":"","ucode":"644615E6AE7884","user_header":"https://static001.geekbang.org/account/avatar/00/15/c9/f6/bb90d35f.jpg","comment_is_top":false,"comment_ctime":1590576878,"is_pvip":false,"replies":[{"id":"81778","content":"是不是要设置一下照片的缓存属性，改成no-cache，每次都去服务器检查。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1590618121,"ip_address":"","comment_id":221727,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1590576878","product_id":100029001,"comment_content":"老师，咨询一个问题：<br>1. 我在azure storage 上传了一张照片，没有设置cache-control 等信息<br>2. 在页面A中这样显示它 &lt;img src=&quot;https:&#47;&#47;***.blob.core.windows.net&#47;***&#47;079aa5bd-8655-418f-99f1-c0fb19ff153c&quot; &#47;&gt;，然后它就在chrome上缓存了此照片<br>3. 然后在azure storage 删除此照片<br>4. 再次进入页面A依然显示此照片，因为直接使用了缓存，img 的src都没有发送网络请求???<br><br>我期望azure上没有删除照片的时候，页面A就是使用缓存；azure删除之后，可以让页面A的缓存失效，不显示此照片。<br>我可以怎样做达到效果，谢谢~","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496546,"discussion_content":"是不是要设置一下照片的缓存属性，改成no-cache，每次都去服务器检查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590618121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1427958,"avatar":"https://static001.geekbang.org/account/avatar/00/15/c9/f6/bb90d35f.jpg","nickname":"孟豪","note":"","ucode":"644615E6AE7884","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275081,"discussion_content":"1.上传的时候 blobCacheControl : &#39;no-cache&#39;,在azure 上查看属性，是成功设置上的。\n2. 进入页面A获取照片的时候，azure response 也返回了Cache-Control:no-cache\n3. 然后在azure storage 删除此照片\n4. 再次进入页面A依然显示此照片\n\n哪里可能出现问题，谢谢老师~~\n再次进入页面<img src=&#34;https://***.blob.core.windows.net/***/079aa5bd-8655-418f-99f1-c0fb19ff153c&#34; />，img的scr没有azure网络请求该怎样理解？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590659758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215248,"user_name":"Geek_ede66b","can_delete":false,"product_type":"c1","uid":1551126,"ip_address":"","ucode":"EA05E48AB02E4F","user_header":"https://static001.geekbang.org/account/avatar/00/17/ab/16/834610e5.jpg","comment_is_top":false,"comment_ctime":1588940731,"is_pvip":false,"replies":[{"id":"79706","content":"no-cache是服务器端用来指示客户端缓存控制的，在使用前必须去服务器校验，客户端放这个没啥用。<br><br>没有if-xxx字段，服务器也就不会校验了。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1588986180,"ip_address":"","comment_id":215248,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1588940731","product_id":100029001,"comment_content":"老师我测试no-cache并不会与服务端进行协商啊，永远返回200  并没有与服务端进行校验。<br>浏览器Network选择disablec-cache就会自动在请求头里添加 cache-control: no-cache，这种情况请求头会不带If-none-match和if-modified-sice，没有这两个字段，服务端并不会校验资源新鲜度<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494370,"discussion_content":"no-cache是服务器端用来指示客户端缓存控制的，在使用前必须去服务器校验，客户端放这个没啥用。\n\n没有if-xxx字段，服务器也就不会校验了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588986180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199427,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1585488882,"is_pvip":false,"replies":[{"id":"74796","content":"还是这么认真努力啊。<br><br>你说的对，存储的结构和机制这些没有在rfc里定义，所以就要浏览器自己灵活发挥了，这也是http的优点，不是什么都定死。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1585530591,"ip_address":"","comment_id":199427,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585488882","product_id":100029001,"comment_content":"Cache 和 Cookie 都是服务器发给客户端并存储的数据，你能比较一下两者的异同吗？<br>Cache和Cookie相同点：都是以C开头😁，缓存的数据都是存储在浏览器的作用域内，存储的信息猜测都有限制，都可以控制其存活时间。<br>Cache和Cookie不相同点：核心目标不同cache核心在于提速，cookie核心在于保持连接的状态。使用方式不同cache主要放在浏览器侧用于重复的使用，cookie主要用于来回的传递保持连接的状态。影响不同cache主要占用浏览器侧的空间，判断是否还是最新的时无须传递都有内容带宽占用少，cookie每次都会传输占用带宽多并且会降低传输效率。<br><br>缓存核心目的是提速，不过缓存结构是什么？存储具体位置在哪里？失效机制？以及缓存怎么加载进去的？这些内容也非常重要，猜测老师会说每个浏览器的实现都不相同或者这块不是HTTP的内容，三言两语也说不清，哈哈，那我就不问啦！","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489832,"discussion_content":"还是这么认真努力啊。\n\n你说的对，存储的结构和机制这些没有在rfc里定义，所以就要浏览器自己灵活发挥了，这也是http的优点，不是什么都定死。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585530591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009652,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","nickname":"钱","note":"","ucode":"2C92A243A463D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217244,"discussion_content":"年龄不小技术不好，有危机感😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585531744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186302,"user_name":"(ಡωಡ)hahaha","can_delete":false,"product_type":"c1","uid":1374075,"ip_address":"","ucode":"8EC05C5DF56770","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/7b/bd2d9d0c.jpg","comment_is_top":false,"comment_ctime":1583822191,"is_pvip":false,"replies":[{"id":"71967","content":"前端技术就真不太了解了，我一直做的是后端，sorry。<br><br>我理解可能是设置cache-control，说错勿怪。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1583831270,"ip_address":"","comment_id":186302,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1583822191","product_id":100029001,"comment_content":"其实作为前端，每次都说后台接口响应时间长让前端，进行缓存，其实我看到 这么多，感觉缓存是服务器 和浏览器的来操控的，前端到底应该 做什么","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486714,"discussion_content":"前端技术就真不太了解了，我一直做的是后端，sorry。\n\n我理解可能是设置cache-control，说错勿怪。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583831270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1377365,"avatar":"https://static001.geekbang.org/account/avatar/00/15/04/55/19943864.jpg","nickname":"要迅","note":"","ucode":"B2A75EF8090FFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362089,"discussion_content":"前端只能用本地存储或者service worker这类的，浏览器缓存就跟跨域一样，不是纯前端能解决的，肯定是服务器端设置。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616846721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1251429,"avatar":"https://static001.geekbang.org/account/avatar/00/13/18/65/35361f02.jpg","nickname":"潇潇雨歇","note":"","ucode":"4BD52BF0F0A084","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282903,"discussion_content":"至于HTTP缓存，这是客户端和服务端配合的，不过主要还是在于服务端，对资源设置合适的缓存策略。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592115181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1251429,"avatar":"https://static001.geekbang.org/account/avatar/00/13/18/65/35361f02.jpg","nickname":"潇潇雨歇","note":"","ucode":"4BD52BF0F0A084","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282902,"discussion_content":"前端更多的是本地存储，localStorge之类的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592115129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435733,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/55/92f82281.jpg","nickname":"MClink","note":"","ucode":"F479190923355C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229399,"discussion_content":"我觉得，类似业务数据缓存，就得前端操作了，例如购物车？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586628108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176447,"user_name":"、落叶为你舞","can_delete":false,"product_type":"c1","uid":1756562,"ip_address":"","ucode":"A196460774A33F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/cd/92/f75a00dd.jpg","comment_is_top":false,"comment_ctime":1581062018,"is_pvip":false,"replies":[{"id":"68494","content":"是的，发现有缓存，但过期就要发个条件请求，看缓存是否可用，再用max-age更新一下。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1581065726,"ip_address":"","comment_id":176447,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1581062018","product_id":100029001,"comment_content":"老师，服务器响应Cache-Control：no-cache，max-age=10，Etag=xxx，点击后退时，如果缓存已过期还会带上If-None-Match吗，如果没过期服务器返回后会重新设置max-age吗","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483109,"discussion_content":"是的，发现有缓存，但过期就要发个条件请求，看缓存是否可用，再用max-age更新一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581065726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173647,"user_name":"keep it simple","can_delete":false,"product_type":"c1","uid":1574739,"ip_address":"","ucode":"72B8DC00247C9E","user_header":"https://static001.geekbang.org/account/avatar/00/18/07/53/05aa9573.jpg","comment_is_top":false,"comment_ctime":1579651149,"is_pvip":false,"replies":[{"id":"67327","content":"<br>1.date就是报文离开服务器的时间，max-age依赖date字段。<br><br>2.last-modified-since和if-none-match两个条件只要给出就会验证，有变化就会返回新的。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1579676642,"ip_address":"","comment_id":173647,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1579651149","product_id":100029001,"comment_content":"请教老师两个问题：<br>1.Date字段实际不等于文件离开服务器的时刻。比如早上7:00做实验，响应报文中的date却是昨天的23点。那max-age是以7:00为起点开始计算，还是昨天23:00开始计算呢？<br>2.关于last-modified-since和if-none-match两个条件请求，是先验证时间，再验证ETag吗？以下四种情况，我的分析对吗？<br>（1）\t服务器上文件的date不变，Etag不变——回复304<br>（2）\tDate不变，etag变——浏览器重新获取，服务端回复200 ok<br>（3）\tDate变，etag不变——回复304<br>（4）\tDate变，etag变——浏览器重新获取，服务端回复200 ok","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482152,"discussion_content":"\n1.date就是报文离开服务器的时间，max-age依赖date字段。\n\n2.last-modified-since和if-none-match两个条件只要给出就会验证，有变化就会返回新的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579676642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172089,"user_name":"神三元","can_delete":false,"product_type":"c1","uid":1202089,"ip_address":"","ucode":"0FB2E7C0683599","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/a9/9abbe7a4.jpg","comment_is_top":false,"comment_ctime":1579086410,"is_pvip":false,"replies":[{"id":"66799","content":"每个服务器的etag生成算法不一样，可以参考小贴士。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1579136355,"ip_address":"","comment_id":172089,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1579086410","product_id":100029001,"comment_content":"ETag生成的原理没有讲？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481615,"discussion_content":"每个服务器的etag生成算法不一样，可以参考小贴士。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579136355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168969,"user_name":"Wr","can_delete":false,"product_type":"c1","uid":1713790,"ip_address":"","ucode":"738B316AA2AD66","user_header":"https://static001.geekbang.org/account/avatar/00/1a/26/7e/823c083e.jpg","comment_is_top":false,"comment_ctime":1578228174,"is_pvip":false,"replies":[{"id":"65565","content":"回答的很认真，赞。<br><br>1.cache是暂存的数据，本来就应该是公开的，它的目的是为了减少请求成本，提高效率，所以不需要什么api来访问。<br><br>2.对。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1578274552,"ip_address":"","comment_id":168969,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578228174","product_id":100029001,"comment_content":"问题一：<br>1、相同点：cookie和本课讲解的缓存，都是缓存在浏览器中<br>2、不同点：- cookie会随请求报文发送给服务器，cache不会，但是会发送条件请求字段对数据做校验<br>                   - Cookie 在浏览器可以通过脚本获取（如果 cookie 没有设置 HttpOnly），Cache 则无法在浏览器中获取（出于安全原因）。该点参考同学，但是cache无法从浏览器中获取这里不理解，用开发者工具不是可以在报文中很清晰的看见相关字段吗？<br>                  - 用处不同，cookie用于客户端身份校验，而cache用于请求的数据校验<br>                  - 时间计算起点不同，cookie从客户端收到响应开始计算，cache从响应报文生成时开始计算<br>问题二：<br>强刷新中请求中If-None-Match变成了Cache-Control: no-cache","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480390,"discussion_content":"回答的很认真，赞。\n\n1.cache是暂存的数据，本来就应该是公开的，它的目的是为了减少请求成本，提高效率，所以不需要什么api来访问。\n\n2.对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578274552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167828,"user_name":"啦啦啦","can_delete":false,"product_type":"c1","uid":1131687,"ip_address":"","ucode":"6B12EC90A62525","user_header":"https://static001.geekbang.org/account/avatar/00/11/44/a7/171c1e86.jpg","comment_is_top":false,"comment_ctime":1577945313,"is_pvip":false,"replies":[{"id":"65159","content":"如果确如你所说，那么就是这样了，但这种情况应该属于字段值不正确，不应该出现。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1577953998,"ip_address":"","comment_id":167828,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1577945313","product_id":100029001,"comment_content":"老师，我看了一下我们项目接口的reponse header里面的date字段值日期晚于expires字段值日期，这是啥意思呀，发送报文的日期大于过期日期，这个意思是说发送完报文就过期了吗","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480012,"discussion_content":"如果确如你所说，那么就是这样了，但这种情况应该属于字段值不正确，不应该出现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577953998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2406841,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","nickname":"乘风破浪","note":"","ucode":"937AF15F3FEBDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349356,"discussion_content":"百度首页包括了date和expires，date时间比expires新。。。,是百度的bug吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613125094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155647,"user_name":"江谢木","can_delete":false,"product_type":"c1","uid":1563403,"ip_address":"","ucode":"E1B1B0F0F03D41","user_header":"https://static001.geekbang.org/account/avatar/00/17/db/0b/f0ded153.jpg","comment_is_top":false,"comment_ctime":1574732413,"is_pvip":false,"replies":[{"id":"59782","content":"http协议里没有对缓存过期后如何处理作出规定，但一般浏览器在过期后还可以再保存更长的时间，这个时候缓存就出于stale（陈旧）状态。<br><br>浏览器也可以按照某种策略清理缓存，例如LRU，或者显得缓存的总大小。<br><br>如果本地缓存没有了，浏览器显然就不需要考虑缓存特性了，直接向服务器获取最新的数据。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1574748175,"ip_address":"","comment_id":155647,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574732413","product_id":100029001,"comment_content":"老师，max-age控制的是缓存的生存周期，那么过了这个时长，缓存是否会被浏览器自动清理掉？如果会，那么must-revalidate又是如何使用过期的缓存呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475818,"discussion_content":"http协议里没有对缓存过期后如何处理作出规定，但一般浏览器在过期后还可以再保存更长的时间，这个时候缓存就出于stale（陈旧）状态。\n\n浏览器也可以按照某种策略清理缓存，例如LRU，或者显得缓存的总大小。\n\n如果本地缓存没有了，浏览器显然就不需要考虑缓存特性了，直接向服务器获取最新的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574748175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149364,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573201917,"is_pvip":false,"replies":[{"id":"57421","content":"看发送的请求","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573205239,"ip_address":"","comment_id":149364,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573201917","product_id":100029001,"comment_content":"我的返回头部是有max-age=60的，但是我点击按钮请求数据确实还是200","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473834,"discussion_content":"看发送的请求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573205239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149341,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573198068,"is_pvip":false,"replies":[{"id":"57416","content":"可以用开发者工具观察一下http请求和响应，看看请求里是否有max-age=0这样的强制刷新字段。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573199536,"ip_address":"","comment_id":149341,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573198068","product_id":100029001,"comment_content":"我还是不太明白，比如说我想发送一个ajax请求一个json数据，想在60s内下次请求直接返回缓存中的内容应该怎么操作呢？我在后台设置了max-age=60。可以每次返回的还是200，并不是从cache或者disk返回的。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473822,"discussion_content":"可以用开发者工具观察一下http请求和响应，看看请求里是否有max-age=0这样的强制刷新字段。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573199536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149271,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573181278,"is_pvip":false,"replies":[{"id":"57413","content":"“超市”就是服务器，它必定有资源的最新版本。<br><br>还是不能完全用生活来类别http协议，这个比喻可能会让你有些误解，抱歉。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573197902,"ip_address":"","comment_id":149271,"utype":1}],"discussion_count":6,"race_medal":0,"score":"1573181278","product_id":100029001,"comment_content":"no-cache：可以放进冰箱，但吃之前必须问超市有没有更新鲜的，有就吃超市里的；<br>那如果没有新鲜的怎么办？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473801,"discussion_content":"“超市”就是服务器，它必定有资源的最新版本。\n\n还是不能完全用生活来类别http协议，这个比喻可能会让你有些误解，抱歉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573197902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136310,"discussion_content":"还是那句话，服务器上的必定是最新鲜的，不管与缓存是否一样，用no-store就是向服务器要，所以服务器就给一份，它不会也无法比较客户端的缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579137343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1373637,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f5/c5/9b06bdb5.jpg","nickname":"神执念の浅言多行","note":"","ucode":"59C0659C7E3ACC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79124,"discussion_content":"如果没有新鲜的，那不就是资源404了吗，这个比喻没问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576059479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1582673,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","nickname":"walle","note":"","ucode":"1A7A490392A773","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46719,"discussion_content":"我的意思是，如果服务器里的版本与缓存中的一样，是直接从缓存拿，还是服务器返回？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573198409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2406841,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","nickname":"乘风破浪","note":"","ucode":"937AF15F3FEBDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1582673,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","nickname":"walle","note":"","ucode":"1A7A490392A773","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349355,"discussion_content":"显然从缓存拿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613124856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":46719,"ip_address":""},"score":349355,"extra":""},{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1582673,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","nickname":"walle","note":"","ucode":"1A7A490392A773","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537055,"discussion_content":"&lt;资源没有变，服务器就回应一个“304 Not Modified”，表示缓存依然有效&gt;浏览器使用缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638947455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":46719,"ip_address":""},"score":537055,"extra":""}]}]},{"had_liked":false,"id":148970,"user_name":"walle","can_delete":false,"product_type":"c1","uid":1582673,"ip_address":"","ucode":"1A7A490392A773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ia4ZTN1ibN5ovBVIaRYBibvEJW4CxRQde4ribsRF83bGaLDy0tqenD1X4gEAocSiaeb6XA2dQR69Z9hAktHV0bgPOGQ/132","comment_is_top":false,"comment_ctime":1573119690,"is_pvip":false,"replies":[{"id":"57343","content":"验证缓存是否生效要用Chrome的开发者工具看，是否有“from cache”或者返回的是304。<br><br>只要添加了cache-control字段，缓存是肯定会生效的。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573174877,"ip_address":"","comment_id":148970,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573119690","product_id":100029001,"comment_content":"我看到这些例子都是下载文档的，要是想在平时的http请求中添加缓存应该怎么弄呢？我直接在服务端添加cache-control: max-age=30，可是每次请求还是重回重新返回数据，貌似没有生效","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473692,"discussion_content":"验证缓存是否生效要用Chrome的开发者工具看，是否有“from cache”或者返回的是304。\n\n只要添加了cache-control字段，缓存是肯定会生效的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573174877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125737,"user_name":"Geek_steven_wang","can_delete":false,"product_type":"c1","uid":1477120,"ip_address":"","ucode":"8CC8F4C9726191","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia31qc8paRg2uPSB6AuEBDricrSxvFBuTpP3NnnflekpJ7wqvN0nRrJyu7zVbzd7Lwjxw/132","comment_is_top":false,"comment_ctime":1566254478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566254478","product_id":100029001,"comment_content":"你打电话给超市，“我这个西瓜是 3 天前买的，还有最新的吗？”。超市看了一下库存，说：“没有啊，我这里都是 3 天前的。”于是你就知道了，再让超市送货也没用，还是吃冰箱里的西瓜吧。这就是“if-Modified-Since”和“Last-modified”。<br><br>但你还是想要最新的，就又打电话：“有不是沙瓤的西瓜吗？”，超市告诉你都是沙瓤的（Match），于是你还是只能吃冰箱里的沙瓤西瓜。这就是“If-None-Match”和“弱 ETag”。<br><br>第三次打电话，你说“有不是 8 斤的沙瓤西瓜吗？”，这回超市给了你满意的答复：“有个 10 斤的沙瓤西瓜”。于是，你就扔掉了冰箱里的存货，让超市重新送了一个新的大西瓜。这就是“If-None-Match”和“强 ETag”。","like_count":0},{"had_liked":false,"id":114962,"user_name":"院长。","can_delete":false,"product_type":"c1","uid":1153546,"ip_address":"","ucode":"DF56871F42A868","user_header":"https://static001.geekbang.org/account/avatar/00/11/9a/0a/da55228e.jpg","comment_is_top":false,"comment_ctime":1563439231,"is_pvip":false,"replies":[{"id":"42050","content":"这个与浏览器的实现有关，我记得有资料，对比了一些浏览器在刷新时发送的字段，不过现在找不到了。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1563498991,"ip_address":"","comment_id":114962,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563439231","product_id":100029001,"comment_content":"老师，对于刷新那里，刷新的时候，好像并不是所有的资源都会加上max-age=0;然后带上if-modified-since和if-none-match以协商缓存方式发送给服务器的，就针对您这篇文章的网页而言，chrome环境下，F5刷新大多数资源走的都是强缓存，只有个别资源（document资源）走的是协商缓存。<br>我又去试了其它页面，发现大致相同，document资源一般再刷新的时候走的都是协商缓存，而其他的css,png和js等走的一般是强缓存。当然也有例外，只是我不懂这个例外是什么我就不多说了。<br>所以在刷新的时候是什么样的缓存方式还是要看资源种类的吧。<br>您看是这样吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458903,"discussion_content":"这个与浏览器的实现有关，我记得有资料，对比了一些浏览器在刷新时发送的字段，不过现在找不到了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563498991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119490,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg","nickname":"雷霹雳的爸爸","note":"","ucode":"99BBA6D83DD11F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40491,"discussion_content":"这块儿确实被浏览器自己搞得比较玄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572223979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113152,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1562903612,"is_pvip":false,"replies":[{"id":"41226","content":"那就取决于客户端自己了，有的可能会存，但按照规范，这是无法缓存的。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562936936,"ip_address":"","comment_id":113152,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562903612","product_id":100029001,"comment_content":"老师：问个问题，如果响应头里什么缓存字段都没有，客户端对缓存是采取什么策略呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458079,"discussion_content":"那就取决于客户端自己了，有的可能会存，但按照规范，这是无法缓存的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562936936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113148,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1562903348,"is_pvip":false,"replies":[{"id":"41227","content":"说的对，要是再能多说一些就更好了。<br>","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562936975,"ip_address":"","comment_id":113148,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562903348","product_id":100029001,"comment_content":"1、Cookie和Cache的相同点：都存储在浏览器端，不同点：服务器端负责判断Cache的有效性，浏览器端负责判断Cookie的有效性","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458077,"discussion_content":"说的对，要是再能多说一些就更好了。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562936975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113086,"user_name":"1900","can_delete":false,"product_type":"c1","uid":1105774,"ip_address":"","ucode":"320D65D14817D3","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/6e/267bd6ee.jpg","comment_is_top":false,"comment_ctime":1562894780,"is_pvip":true,"replies":[{"id":"41236","content":"都是在浏览器的作用域，不是系统级别的。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562937775,"ip_address":"","comment_id":113086,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562894780","product_id":100029001,"comment_content":"客户端缓存存在本地（客户端上的所有浏览器都能访问）还是和Cookie一样，只存在客户端上具体的某个浏览器中啊？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458049,"discussion_content":"都是在浏览器的作用域，不是系统级别的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113067,"user_name":"响雨","can_delete":false,"product_type":"c1","uid":1581705,"ip_address":"","ucode":"C5FB3A3BC68F92","user_header":"https://static001.geekbang.org/account/avatar/00/18/22/89/73397ccb.jpg","comment_is_top":false,"comment_ctime":1562892906,"is_pvip":false,"replies":[{"id":"41232","content":"见tips05。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562937428,"ip_address":"","comment_id":113067,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562892906","product_id":100029001,"comment_content":"web服务怎么计算etag，作为一个后端，没有接触过。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458042,"discussion_content":"见tips05。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113053,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1562891989,"is_pvip":false,"replies":[{"id":"41233","content":"只要有cache-control，指定了生命周期，就都可以缓存。<br><br>静态资源是肯定可以缓存的，动态资源如果指定max-age=xxx，当然也可以用。<br><br>etag的算法可以自己定，条件请求时就要计算比较，注意这是在服务器上，不是缓存，而是直接对资源进行计算，不变就返回304.","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562937624,"ip_address":"","comment_id":113053,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562891989","product_id":100029001,"comment_content":"老师好!这个缓存是用在静态资源上的么?还是生命周期较长的动态资源也可以用啊?使用时需要在服务端或者nginx上做编码处理么?比如说Etag去缓冲中校验下是否存在后响应给浏览器。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458036,"discussion_content":"只要有cache-control，指定了生命周期，就都可以缓存。\n\n静态资源是肯定可以缓存的，动态资源如果指定max-age=xxx，当然也可以用。\n\netag的算法可以自己定，条件请求时就要计算比较，注意这是在服务器上，不是缓存，而是直接对资源进行计算，不变就返回304.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113033,"user_name":"开水","can_delete":false,"product_type":"c1","uid":1528555,"ip_address":"","ucode":"651491C38B925B","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/eb/eec719f3.jpg","comment_is_top":false,"comment_ctime":1562890454,"is_pvip":false,"replies":[{"id":"41234","content":"对，两者的目的、作用不同。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1562937646,"ip_address":"","comment_id":113033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562890454","product_id":100029001,"comment_content":"cookie是服务端为了快速辨识客户端身份，保存在客户端的键值对缓存；<br>cache是客户端为了避免不必要网络请求，加快响应速度，存储在本地的服务端内容。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458025,"discussion_content":"对，两者的目的、作用不同。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562937646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}