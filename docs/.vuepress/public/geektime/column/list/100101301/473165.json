{"id":473165,"title":"08 | 服务治理：Nacos集群环境搭建","content":"<p>你好，我是姚秋辰。</p><p>上节课我们对Nacos功能体系有了全面的认识。今天我们就来动手搭建Nacos服务注册中心。通过这节课，你可以知道如何搭建一个高可用的Nacos服务集群，以及如何使用MySQL作为Nacos的底层数据存储方案。这些内容可以帮助你理解什么是“高可用架构”。</p><p>我们在做系统架构的时候，首要目标就是保障系统的高可用性。不管你的系统架构多么精妙，用的技术多么先进，如果系统的可用性无法得到保障，那么你做什么都是白忙活。</p><p>这就像我们的人生一样，事业、家庭、地位都是0，健康才是一串0前面的那个1，没有1则一切皆无。所以，系统的高可用性，就是系统架构层面的那个1。</p><p>保障系统的高可用性有两个大道至简的方向。</p><ul>\n<li>\n<p><strong>避免单点故障</strong>：在做系统架构的时候，你应该假设任何服务器都有可能挂掉。如果某项任务依赖单一服务资源，那么这就会成为一个“单点”，一旦这个服务资源挂掉就表示整个功能变为不可用。所以你要尽可能消灭一切“单点”；</p>\n</li>\n<li>\n<p><strong>故障机器状态恢复</strong>：尽快将故障机器返回到故障前的状态。对于像Nacos这类中心化注册中心来说，因故障而下线的机器在重新上线后，应该有能力从某个地方获取故障发生前的服务注册列表。</p>\n</li>\n</ul><p>那Nacos是如何解决上面这两个问题，来保证自己的高可用性的呢？很简单，就是构建服务集群。集群环境不仅可以有效规避单点故障引发的问题，同时对于故障恢复的场景来说，重新上线的机器也可以从集群中的其他节点同步数据信息，恢复到故障前的状态。</p><!-- [[[read_end]]] --><p>那么，接下来我就带你手把手搭建Nacos Server的集群环境。</p><h2>下载Nacos Server</h2><p>Nacos Server的安装包可以从Alibaba官方GitHub中的<a href=\"https://github.com/alibaba/nacos/releases\">Release页面</a>下载。当前最新的稳定版本是2.0.3，我们课程的实战项目也使用该版本的Nacos做为注册中心和配置中心。</p><p>在选择Nacos版本的时候你要注意，一定要选择<strong>稳定版</strong>使用，不要选择版本号中带有BETA字样的版本（比如2.0.0-BETA）。后者通常是重大版本更新前预发布的试用版，往往会有很多潜在的Bug或者兼容性问题。</p><p>Nacos 2.0.3 Release note下方的Assets面板中包含了该版本的下载链接，你可以在nacos-server-2.0.3.tar.gz和nacos-server-2.0.3.zip这两个压缩包中任选一个下载。如果你对Nacos的源码比较感兴趣，也可以下载Source code源码包来学习。</p><p><img src=\"https://static001.geekbang.org/resource/image/12/be/12b9e8acf953d20f30c0053yyc0f07be.jpg?wh=2000x807\" alt=\"\"></p><p>下载完成后，你可以在本地将Nacos Server压缩包解压，并将解压后的目录名改为“nacos-cluster1”，再复制一份同样的文件到nacos-cluster2，我们以此来模拟一个由两台Nacos Server组成的集群。</p><p><img src=\"https://static001.geekbang.org/resource/image/52/a6/52a819b63e3f0d5281e08de6f99cdca6.jpg?wh=2000x807\" alt=\"\"></p><p>到这里，我们就完成了Nacos服务器的下载安装，接下来，我带你去修改Nacos Server的启动项参数。</p><h2>修改启动项参数</h2><p>Nacos Server的启动项位于conf目录下的application.properties文件里，别看这个文件里的配置项密密麻麻一大串，但大部分都不用你操心，直接使用默认值就好。你只需要修改这里面的服务启动端口和数据库连接串就好了。</p><p>因为你需要在一台机器上同时启动两台Nacos Server来模拟一个集群环境，所以这两台Nacos Server需要使用不同的端口，否则在启动阶段会报出端口冲突的异常信息。</p><p>Nacos Server的启动端口由server.port属性指定，默认端口是8848。我们在nacos-cluster1中仍然使用8848作为默认端口，你只需要把nacos-cluster2中的端口号改掉就可以了，这里我把它改为8948。</p><p><img src=\"https://static001.geekbang.org/resource/image/ab/4f/abb1736f537681d270bd5a9557ea6b4f.jpg?wh=2000x516\" alt=\"\"></p><p>接下来，你需要对Nacos Server的DB连接串做一些修改。在默认情况下，Nacos Server会使用Derby作为数据源，用于保存配置管理数据。Derby是Apache基金会旗下的一款非常小巧的嵌入式数据库，可以随Nacos Server在本地启动。但从系统的可用性角度考虑，我们需要将Nacos Server的数据源迁移到更加稳定的<strong>MySQL数据库</strong>中。</p><p>你需要修改三处Nacos Server的数据库配置。</p><ol>\n<li><strong>指定数据源</strong>：spring.datasource.platform=mysql这行配置默认情况下被注释掉了，它用来指定数据源为mysql，你需要将这行注释放开；</li>\n<li><strong>指定DB实例数</strong>：放开db.num=1这一行的注释；</li>\n<li><strong>修改JDBC连接串</strong>：db.url.0指定了数据库连接字符串，我指向了localhost 3306端口的nacos数据库，稍后我将带你对这个数据库做初始化工作；db.user.0和db.password.0分别指定了连接数据库的用户名和密码，我使用了默认的无密码root账户。</li>\n</ol><p>下面的图是完整的数据库配置项。</p><p><img src=\"https://static001.geekbang.org/resource/image/74/93/7492a76dbc53de8aea7573c620675e93.jpg?wh=2000x1143\" alt=\"\"></p><p>修改完数据库配置项之后，接下来我带你去MySQL中创建Nacos Server所需要用到的数据库Schema和数据库表。</p><h2>创建DB Schema和Table</h2><p>Nacos Server的数据库用来保存配置信息、Nacos Portal登录用户、用户权限等数据，下面我们分两步来创建数据库。</p><p><strong>第一步，创建Schema</strong>。你可以通过数据库控制台或者DataGrip之类的可视化操作工具，执行下面这行SQL命令，创建一个名为nacos的schema。</p><pre><code>create schema nacos;\n</code></pre><p><strong>第二步，创建数据库表</strong>。Nacos已经把建表语句准备好了，就放在你解压后的Nacos Server安装目录中。打开Nacos Server安装路径下的conf文件夹，找到里面的nacos-mysql.sql文件，你所需要的数据库建表语句都在这了。你也可以直接到源码仓库的<a href=\"https://gitee.com/banxian-yao/geekbang-coupon-center/tree/master/%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6\">资源文件</a>中获取Nacos建表语句的SQL文件。</p><p>将文件中的SQL命令复制下来，在第一步中创建的schema下执行这些SQL命令。执行完之后，你就可以在在数据库中看到这些tables了，总共有12张数据库表。</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/87/e75b4cd0yye902048406305feabbcf87.jpg?wh=2000x1047\" alt=\"\"></p><p>数据库准备妥当之后，我们还剩最后一项任务：添加集群机器列表。添加成功后就可以完成集群搭建了。</p><h2>添加集群机器列表</h2><p>Nacos Server可以从一个本地配置文件中获取所有的Server地址信息，从而实现服务器之间的数据同步。</p><p>所以现在我们要在Nacos Server的conf目录下创建cluster.conf文件，并将nacos-cluster1和nacos-cluster2这两台服务器的IP地址+端口号添加到文件中。下面是我本地的cluster.conf文件的内容。</p><pre><code>## 注意，这里的IP不能是localhost或者127.0.0.1\n192.168.1.100:8848\n192.168.1.100:8948\n</code></pre><p>这里需要注意的是，你不能在cluster.conf文件中使用localhost或者127.0.0.1作为服务器IP，否则各个服务器无法在集群环境下同步服务注册信息。这里的IP应该使用你本机分配到的内网IP地址。</p><p>如果你使用的是mac或者linux系统，可以在命令行使用 ifconfig | grep “inet” 命令来获取本机IP地址，下图中红框标出的这行inet地址192.168.1.100就是本机的IP地址。</p><p><img src=\"https://static001.geekbang.org/resource/image/c8/65/c87c972be62d4328a8ae5f595a7ff565.jpg?wh=2000x807\" alt=\"\"></p><p>到这里，我们已经完成了所有集群环境的准备工作，接下来我带你去启动Nacos Server验证一下效果。</p><h2>启动Nacos Server</h2><p>Nacos的启动脚本位于安装目录下的bin文件夹，下图是bin目录下的启动脚本。其中Windows操作系统对应的启动脚本和关闭脚本分别是startup.cmd和shutdown.cmd，Mac和Linux系统对应的启动和关闭脚本是startup.sh和shutdown.sh。</p><p><img src=\"https://static001.geekbang.org/resource/image/37/76/375f132670e5a956bf93d0a8aa780776.jpg?wh=2000x1047\" alt=\"\"></p><p>以Mac操作系统为例，如果你希望以单机模式（非集群模式）启动一台Nacos服务器，可以在bin目录下通过命令行执行下面这行命令：</p><pre><code> sh startup.sh -m standalone\n</code></pre><p>通过-m standalone参数，我指定了服务器以单机模式启动。Nacos Server在单机模式下不会主动向其它服务器同步数据，因此这个模式只能用于开发和测试阶段，对于生产环境来说，我们必须以Cluster模式启动。</p><p>如果希望将Nacos Server以集群模式启动，只需要在命令行直接执行sh startup.sh命令就可以了。这时控制台会打印以下两行启动日志。</p><pre><code>nacos is starting with cluster\nnacos is starting，you can check the /Users/banxian/workspace/dev/middleware/nacos-cluster1/logs/start.out\n</code></pre><p>这两行启动日志没有告诉你Nacos Server最终是启动成功还是失败，不过你可以在第二行日志中找到一些蛛丝马迹。这行日志告诉了我们启动日志所在的位置是nacos-cluster1/logs/start.out，在启动日志中你可以查看到一行成功消息“Nacos started successfully in cluster mode”。当然了，如果启动失败，你也可以在这里看到具体的Error Log。</p><p><img src=\"https://static001.geekbang.org/resource/image/63/6f/631aef2a8a6f741b24bc9430c960666f.jpg?wh=2000x1500\" alt=\"\"></p><p>我们用同样的方式先后启动nacos-cluster1和nacos-cluster2，如上图所示，在启动日志中显示了成功消息“started successfully in cluster mode”，这代表服务器已经成功启动了，接下来你就可以登录Nacos控制台了。</p><h2>登录Nacos控制台</h2><p>在Nacos的控制台中，我们可以看到服务注册列表、配置项管理、集群服务列表等信息。在浏览器中打开<a href=\"http://127.0.0.1:8848/nacos\">nacos-cluster1</a>或者<a href=\"http://127.0.0.1:8948/nacos\">nacos-cluster2</a>的地址，注意这两台服务器的端口分别是8848和8948。你可以看到下面的Nacos的登录页面。</p><p><img src=\"https://static001.geekbang.org/resource/image/e8/56/e8337b81f3d9f59bc3f47fed7c090356.jpg?wh=2000x1296\" alt=\"\"></p><p>你可以使用Nacos默认创建好的用户nacos登录系统，用户名和密码都是nacos。当然了，你也可以在登录后的权限控制-&gt;用户列表页面新增系统用户。成功登录后，你就可以看到Nacos控制台首页了。</p><p>为了验证集群环境处于正常状态，你可以在左侧导航栏中打开“集群管理”下的“节点列表”页面，在这个页面上显示了集群环境中所有的Nacos Server节点以及对应的状态，在下面的图中我们可以看到192.168.1.100:8848和192.168.1.100:8948两台服务器，并且它们的节点状态都是绿色的“UP”，这表示你搭建的集群环境一切正常。</p><p><img src=\"https://static001.geekbang.org/resource/image/59/64/595e5e94382f54c382ae6a7598c63a64.jpg?wh=2000x1008\" alt=\"\"></p><p>好，到这里，我们的Nacos集群环境搭建就完成了。如果你在搭建环境的过程中发现Nacos无法启动，只需要到启动日志/logs/start.out中就能找到具体的报错信息。如果你碰到了启动失败的问题，不妨先去检查以下两个地方：</p><ol>\n<li><strong>端口占用</strong>：即server.port所指定的端口已经被使用，你需要更换一个端口重新启动服务；</li>\n<li><strong>MySQL连不上</strong>：你需要检查application.properties里配置的MySQL连接信息是否正确，并确认MySQL服务处于运行状态。</li>\n</ol><p>如果是其它的异常报错，欢迎发表到评论区，我和热心的同学们都会帮替你诊断的。</p><h2>总结</h2><p>现在，我们来回顾一下这节课的重点内容。今天我们了解了如何搭建高可用的Nacos集群，在这个过程中，我将底层存储切换成了MySQL数据源，实现了配置项的持久化。</p><p>在实际的项目中，如果某个微服务Client要连接到Nacos集群做服务注册，我们并不会把Nacos集群中的所有服务器都配置在Client中，否则每次Nacos集群增加或删除了节点，我都要对所有Client做一次代码变更并重新发布。那么正确的做法是什么呢？</p><p>常见的一个做法是提供一个VIP URL给到Client，VIP URL是一个虚拟IP地址，我们可以把真实的Nacos服务器地址列表“隐藏”在虚拟IP后面，客户端只需要连接到虚IP即可，由提供虚IP的组件负责将请求转发给背后的服务器列表。这样一来，即便Nacos集群机器数量发生了变动，也不会对客户端造成任何感知。</p><p>提供虚IP的技术手段有很多，比如通过搭建Nginx+LVS或者keepalived技术实现高可用集群。如果你对这些技术感兴趣，我鼓励你尝试自己搭建一个虚IP的环境，锻炼一下技术调研能力。</p><h2>思考题</h2><p>在开始接下来的实战课之前，我们来做一些课前预习作业。请你从Nacos的<a href=\"https://nacos.io/zh-cn/docs/what-is-nacos.html\">官方文档</a>中了解Nacos的功能特性以及集成方案，欢迎在评论区留下你的自学笔记。</p><p>好啦，这节课就结束啦。欢迎你把这节课分享给更多对Spring Cloud感兴趣的朋友。我是姚秋辰，我们下节课再见！</p>","neighbors":{"left":{"article_title":"07 | Nacos体系架构：什么是服务治理？","id":472384},"right":{"article_title":"09 | 集成 Nacos：如何将服务提供者注册到 Nacos 服务器？","id":473988}},"comments":[{"had_liked":false,"id":333679,"user_name":"Unknown","can_delete":false,"product_type":"c1","uid":1736715,"ip_address":"","ucode":"E43137A064CAD8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/80/0b/7ae52ac0.jpg","comment_is_top":true,"comment_ctime":1644472673,"is_pvip":true,"replies":[{"id":"122046","content":"这个提醒很重要，我在示例里跨了很大的端口range，忘了提醒下同学们背后的原因了","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644748966,"ip_address":"","comment_id":333679,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233721372835e+18","product_id":100101301,"comment_content":"这边windows本地 搭建的时候，端口不要连续，如果连续的话，在启动时候，会报端口占用 的错误<br>nacos 中的其他服务会占用相邻的端口grpc","like_count":24,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550820,"discussion_content":"这个提醒很重要，我在示例里跨了很大的端口range，忘了提醒下同学们背后的原因了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644748966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1494622,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ce/5e/b103d538.jpg","nickname":"大明猩","note":"","ucode":"61D330B42AE3C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583314,"discussion_content":"确实，感谢大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660029236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329808,"user_name":"~","can_delete":false,"product_type":"c1","uid":2495621,"ip_address":"","ucode":"BE5E3BD6EE3665","user_header":"https://static001.geekbang.org/account/avatar/00/26/14/85/73e55be5.jpg","comment_is_top":true,"comment_ctime":1641546673,"is_pvip":false,"replies":[{"id":"120146","content":"环境问题是蛮有意思的，排查起来可能很久没头绪，最后突然间柳暗花明。<br><br>你可以把docker看做是模拟了一个虚拟网卡，当你本地访问docker容器，实际上就像是访问了一个局域网内的另一个机器，所以localhost是找不到了，这时候用docker的分配给容器的ip访问就可以。如果你想和宿主机绑定同样的地址其实也是可以的，需要在容器内部做一些配置。<br><br>考虑到大部分同学都是使用windows，而且经常搭建各种虚机，我这里有一篇收藏的文章，是很久之前我配置windows的时候参考过得，同学如果也是用windows可以试着看看 https:&#47;&#47;stackoverflow.com&#47;questions&#47;33814696&#47;how-to-connect-to-a-docker-container-from-outside-the-host-same-network-windo","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1641563747,"ip_address":"","comment_id":329808,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720470862991e+18","product_id":100101301,"comment_content":"Intel 的 mac，如果启动 nacos 时候，报错: 「找不到或无法加载主类，原因: java.lang.ClassNotFoundException」，八成是你的 jdk 版本不是 8，可以参照这个博客解决（我是按照方案 2 改动脚本，成功启动）。https:&#47;&#47;blog.csdn.net&#47;shentian885&#47;article&#47;details&#47;120718915<br>另：老师能否出个加餐讲一下使用 docker 启动的方式，或者指点我一下吗？我根据你之前评论的链接尝试安装却失败了。主要原因我认为有二：1 是我把 MySQL 也通过 docker 安装了，nacos 启动时候会报错找不到 DataSource；2 是我不知道 nacos1 和 nacos2 两个容器之间的 ip 地址改怎么设置，是使用 docker 的「内部 ip（我也不清楚是不是这么叫）」，还是 localhost 直接设置，还是用我本机分配的内网 ip？<br>还麻烦老师解答一下，谢谢老师！！","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544557,"discussion_content":"环境问题是蛮有意思的，排查起来可能很久没头绪，最后突然间柳暗花明。\n\n你可以把docker看做是模拟了一个虚拟网卡，当你本地访问docker容器，实际上就像是访问了一个局域网内的另一个机器，所以localhost是找不到了，这时候用docker的分配给容器的ip访问就可以。如果你想和宿主机绑定同样的地址其实也是可以的，需要在容器内部做一些配置。\n\n考虑到大部分同学都是使用windows，而且经常搭建各种虚机，我这里有一篇收藏的文章，是很久之前我配置windows的时候参考过得，同学如果也是用windows可以试着看看 https://stackoverflow.com/questions/33814696/how-to-connect-to-a-docker-container-from-outside-the-host-same-network-windo","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1641563747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1879290,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ac/fa/a32099e7.jpg","nickname":"Curiosity","note":"","ucode":"A6732CAE6CBE8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573452,"discussion_content":"你可以使用docker-compose","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653443033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328603,"user_name":"前行","can_delete":false,"product_type":"c1","uid":1530657,"ip_address":"","ucode":"B8B703C1F919F3","user_header":"https://static001.geekbang.org/account/avatar/00/17/5b/21/02a8d30f.jpg","comment_is_top":false,"comment_ctime":1640786536,"is_pvip":false,"replies":[{"id":"119773","content":"十分到位！","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640860601,"ip_address":"","comment_id":328603,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31705557608","product_id":100101301,"comment_content":"windows 环境下单机模拟集群部署，需要注意的是在两个 Nacos Server 的 conf 文件夹下 都配置 cluster.conf 文件，其他配置按照文章来，启动时在两个 Nacos Server 的 bin 文件下执行 .\\startup.cmd 即可。","like_count":7,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542848,"discussion_content":"十分到位！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640860601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328457,"user_name":"Sally Kang 蓝","can_delete":false,"product_type":"c1","uid":2403628,"ip_address":"","ucode":"EBAB87361E7730","user_header":"https://static001.geekbang.org/account/avatar/00/24/ad/2c/250e8aef.jpg","comment_is_top":false,"comment_ctime":1640743643,"is_pvip":false,"replies":[{"id":"119683","content":"哈哈，同学你这是玩游戏开了踢人挂。<br><br>我提示你一点你就知道为啥了。当你点完下线之后，你可以打开cluster.conf文件里看一下发生了什么变化。然后呢，不要重启server，你只要再尝试把踢掉的节点加到文件里去，之后再回到节点列表页面，观察一下变化。<br><br>再给同学一个小提示，怎么通过现象找到背后的源码，比如你可以看一下这个下线请求的url地址，然后找到nacos源码里这个地址对应的controller，顺着找下去，你就能看到更下一层的memberJoin，memberLeave的蛛丝马迹。比如-&gt;ServerMemberManager，以及nacos是如何notify其它节点变化的","user_name":"作者回复","user_name_real":"作者","uid":"2819998","ctime":1640785807,"ip_address":"","comment_id":328457,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23115580123","product_id":100101301,"comment_content":"姚老师 我有个问题需要请教。Nacos 2.0.3 集群环境搭建后，假设3个Nacos节点，点击集群管理 -&gt; 节点列表 -&gt; 任意下线某个节点后，该节点没办法重新上线(重新加入集群)。问题: 是Nacos没有提供集群节点上线功能？还是这是一个Bug？还是需要通过参数配置进行设置。","like_count":5,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542564,"discussion_content":"哈哈，同学你这是玩游戏开了踢人挂。\n\n我提示你一点你就知道为啥了。当你点完下线之后，你可以打开cluster.conf文件里看一下发生了什么变化。然后呢，不要重启server，你只要再尝试把踢掉的节点加到文件里去，之后再回到节点列表页面，观察一下变化。\n\n再给同学一个小提示，怎么通过现象找到背后的源码，比如你可以看一下这个下线请求的url地址，然后找到nacos源码里这个地址对应的controller，顺着找下去，你就能看到更下一层的memberJoin，memberLeave的蛛丝马迹。比如->ServerMemberManager，以及nacos是如何notify其它节点变化的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1640785807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2403628,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ad/2c/250e8aef.jpg","nickname":"Sally Kang 蓝","note":"","ucode":"EBAB87361E7730","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542825,"discussion_content":"姚老师 我按照你的提示, 我点完下线后 我尝试重新把下线的节点ip:port添加到cluster.conf文件中, 结果是并没有重新上线。 接着又按照您的提示 我查看了源码和输出日志信息，分析后我认为Nacos 2.0.3 集群管理存在两个Bug 1、下线后的通知机制存在死循环问题 https://github.com/alibaba/nacos/issues/6273。2、FileConfigMemberLookup 和 下线接口存在并发问题 (因为下线的死循环会一直调用memberChange方法，假设我把下线的节点ip:port添加到cluster.conf文件中时(此时变成3个节点)，FileConfigMemberLookup会调用memberChange方法，恰好这时死循环的下线接口再次被调用(又被修改成2个节点)，导致下线节点不能上线)。 希望姚老师百忙中可以验证下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640855011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342544,"user_name":"yu","can_delete":false,"product_type":"c1","uid":1138645,"ip_address":"","ucode":"56856DCC0C8387","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/d5/2fec2911.jpg","comment_is_top":false,"comment_ctime":1650334019,"is_pvip":false,"replies":[{"id":"125460","content":"同学在M1上的探索很值得其他同学借鉴。<br><br>话说M2和M3也有了：）估计后来的同学还得踩一波坑","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1651033599,"ip_address":"","comment_id":342544,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10240268611","product_id":100101301,"comment_content":"Mac M1 历经劫难，终于启动了单机nacos<br>docker pull zhusaidong&#47;nacos-server-m1:2.0.3<br><br>docker run -d -p 8848:8848 -p 9848:9848 -p 9555:9555 --name nacos-server \\<br>-e PREFER_HOST_MODE=hostname \\<br>-e MODE=standalone \\<br>-e SPRING_DATASOURCE_PLATFORM= \\<br>-e MYSQL_SERVICE_HOST=127.0.0.1 \\<br>-e MYSQL_SERVICE_DB_NAME=nacos \\<br>-e MYSQL_SERVICE_PORT=3306 \\<br>-e MYSQL_SERVICE_USER=root \\<br>-e MYSQL_SERVICE_PASSWORD= \\<br>-e MYSQL_SERVICE_DB_PARAM=allowPublicKeyRetrieval=true \\<br>--restart on-failure \\<br>zhusaidong&#47;nacos-server-m1:2.0.3<br><br>","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567949,"discussion_content":"同学在M1上的探索很值得其他同学借鉴。\n\n话说M2和M3也有了：）估计后来的同学还得踩一波坑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651033599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333879,"user_name":"Geek_ebdb72","can_delete":false,"product_type":"c1","uid":1622737,"ip_address":"","ucode":"0135C661B266B3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er3FAKeM4ZRgicxkChAh7Z9H4zwjiavFw1vQFX50DYn8dYjgP8HVHbmsAA1iaTyJjUz2OvpVU8GekVbg/132","comment_is_top":false,"comment_ctime":1644569673,"is_pvip":false,"replies":[{"id":"122052","content":"大概率是两个原因跑不了：1）db.url或者用户名密码设置的不正确 2）Docker镜像中使用localhost&#47;127.0.0.1访问不到镜像外资源，换个真实ip就好了。 同学朝这两个方向排查下吧","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644750432,"ip_address":"","comment_id":333879,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10234504265","product_id":100101301,"comment_content":"我用的docker-compose搭建的但是启动总是报no datasource set 请问有交流群么","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550827,"discussion_content":"大概率是两个原因跑不了：1）db.url或者用户名密码设置的不正确 2）Docker镜像中使用localhost/127.0.0.1访问不到镜像外资源，换个真实ip就好了。 同学朝这两个方向排查下吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644750432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1075267,"avatar":"https://static001.geekbang.org/account/avatar/00/10/68/43/1fe64086.jpg","nickname":"zero_","note":"","ucode":"14D3AD3D997112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552662,"discussion_content":"可参考文档 nacos docker 章节：https://github.com/nacos-group/nacos-docker.git  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645539520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1075267,"avatar":"https://static001.geekbang.org/account/avatar/00/10/68/43/1fe64086.jpg","nickname":"zero_","note":"","ucode":"14D3AD3D997112","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552661,"discussion_content":"我也是docker-compose，折腾了一下午，终于成功了。\n也遇到 no datasource set 问题。\n环境：一个 compose 文件部两个nacos，但是mysql是另一个compose起来的，不在nacos 的 compose文件里。\n个人觉得主要是配置文件 MYSQL_SERVICE_HOST 这里配置不正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645539353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332192,"user_name":"密码123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1643093042,"is_pvip":false,"replies":[{"id":"121427","content":"特殊字符、中文、空格，特别容易踩坑","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1643209437,"ip_address":"","comment_id":332192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10233027634","product_id":100101301,"comment_content":"遇到了一个问题，目录不能用中文，目录不能用中文，目录不能用中文。","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548481,"discussion_content":"特殊字符、中文、空格，特别容易踩坑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643209437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331295,"user_name":"kernel","can_delete":false,"product_type":"c1","uid":1109390,"ip_address":"","ucode":"511BBA152F64CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/8e/dc7e2ca6.jpg","comment_is_top":false,"comment_ctime":1642520443,"is_pvip":false,"replies":[{"id":"121037","content":"我倒是没有在腾讯云玩过，我怀疑IP地址填错了，Nacos发现当前instance不在列表里所以主动把自个儿添加了进去。同学你看下Nacos启动的时候，在启动日志里Nacos图像旁边打印的IP是什么，然后在Nacos的application.properties里通过nacos.inetutils.ip-address=你的IP，把这个固定IP绑定上去，然后在启动试试。","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1642522529,"ip_address":"","comment_id":331295,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10232455035","product_id":100101301,"comment_content":"1、用腾讯云搭建nacos集群，在配置cluster.conf 后，启动，会在配置文件中多了一个<br>内网IP+端口？这是为什么？<br>10.0.16.14:8948  --- 这个是启动后自动加上的，对应的IP是腾讯云的内网ip<br>101.42.237.141:8848<br>101.42.237.141:8948<br>2、在idea中起服务，会报这个错误 <br>failed to req API:&#47;nacos&#47;v1&#47;ns&#47;instance after all servers([101.42.237.141:8848]) tried: ErrCode:400<br>网上查是说cluster.conf文件中配置了其他nacos时，若其他未启动，则会出现上述报错！是不是那个内网ip+端口导致的？","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547098,"discussion_content":"我倒是没有在腾讯云玩过，我怀疑IP地址填错了，Nacos发现当前instance不在列表里所以主动把自个儿添加了进去。同学你看下Nacos启动的时候，在启动日志里Nacos图像旁边打印的IP是什么，然后在Nacos的application.properties里通过nacos.inetutils.ip-address=你的IP，把这个固定IP绑定上去，然后在启动试试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642522529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2112229,"avatar":"https://static001.geekbang.org/account/avatar/00/20/3a/e5/1a1b08ad.jpg","nickname":"乘风","note":"","ucode":"D25976CDD1D39B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588233,"discussion_content":"ip填错了，自动给填上了，我本地也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663600832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329548,"user_name":"wxyz2z","can_delete":false,"product_type":"c1","uid":1261694,"ip_address":"","ucode":"26CC47AD3E24A1","user_header":"https://static001.geekbang.org/account/avatar/00/13/40/7e/3f8684a4.jpg","comment_is_top":false,"comment_ctime":1641395064,"is_pvip":false,"replies":[{"id":"120023","content":"同学可以到docker hub找到民间热心群众打包的nacos-server-m1:2.0.3镜像，可以成功在m1启动","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1641401648,"ip_address":"","comment_id":329548,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10231329656","product_id":100101301,"comment_content":"m1的mac启动不了，看了日志have &#39;x86_64&#39;, need &#39;arm64e&#39;，请问老师怎么解决","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544137,"discussion_content":"同学可以到docker hub找到民间热心群众打包的nacos-server-m1:2.0.3镜像，可以成功在m1启动","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641401648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329395,"user_name":"sta","can_delete":false,"product_type":"c1","uid":1032755,"ip_address":"","ucode":"D840070850EA5B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/33/ccbf2045.jpg","comment_is_top":false,"comment_ctime":1641312162,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10231246754","product_id":100101301,"comment_content":"分享一下。Nacos启动失败，因为云主机的内存太小，Nacos集群环境启动时默认配置2g的堆内存，所以需要在startup.sh中修改堆内存的大小。","like_count":2,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544555,"discussion_content":"Nice啊！！！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641562515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1591537,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3jyEVY8d2V3dcj3tUH684qicUBXNd4ibkjaR2LI5icyUG7GwpOpvoyR5BIM52kZTKdyE7DoZE9ZkOw/132","nickname":"King","note":"","ucode":"77D20D57003224","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544094,"discussion_content":"给力，我刚好遇到这个问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641396347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335582,"user_name":"码小呆","can_delete":false,"product_type":"c1","uid":2055809,"ip_address":"","ucode":"44532D6ABF9340","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5e/81/82709d6e.jpg","comment_is_top":false,"comment_ctime":1645595246,"is_pvip":true,"replies":[{"id":"122649","content":"简直神枪手！ <br><br>我们都是神枪手，每一颗子弹消灭一个队友","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1645632417,"ip_address":"","comment_id":335582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5940562542","product_id":100101301,"comment_content":"一次就搭建成功了哇","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552915,"discussion_content":"简直神枪手！ \n\n我们都是神枪手，每一颗子弹消灭一个队友","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645632417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334243,"user_name":"Magic","can_delete":false,"product_type":"c1","uid":2137611,"ip_address":"","ucode":"4B865D0C0D4A96","user_header":"https://static001.geekbang.org/account/avatar/00/20/9e/0b/e4d80306.jpg","comment_is_top":false,"comment_ctime":1644826117,"is_pvip":true,"replies":[{"id":"122103","content":"坦克车，翻不了","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644857049,"ip_address":"","comment_id":334243,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5939793413","product_id":100101301,"comment_content":"我的是m1芯片，采用老师在评论中回复的镜像搭建的。暂时还没翻车😀<br># 拉取适合m1的镜像。<br>docker pull zhusaidong&#47;nacos-server-m1:2.0.3<br><br># nacos-cluster1<br>docker run -d \\<br>-e PREFER_HOST_MODE=hostname \\<br>-e MODE=cluster \\<br>-e NACOS_APPLICATION_PORT=8848 \\<br>-e NACOS_SERVERS=&quot;192.168.96.126:8848 192.168.96.126:8948&quot; \\<br>-e SPRING_DATASOURCE_PLATFORM=mysql \\<br>-e MYSQL_SERVICE_HOST=192.168.96.126 \\<br>-e MYSQL_SERVICE_PORT=3306 \\<br>-e MYSQL_SERVICE_USER=root \\<br>-e MYSQL_SERVICE_PASSWORD=123456 \\<br>-e MYSQL_SERVICE_DB_NAME=nacos \\<br>-e NACOS_SERVER_IP=192.168.96.126 \\<br>-p 8848:8848 \\<br>--name my-nacos1 \\<br>zhusaidong&#47;nacos-server-m1:2.0.3<br><br># nacos-cluster2<br>docker run -d \\<br>-e PREFER_HOST_MODE=hostname \\<br>-e MODE=cluster \\<br>-e NACOS_APPLICATION_PORT=8948 \\<br>-e NACOS_SERVERS=&quot;192.168.96.126:8848 192.168.96.126:8948&quot; \\<br>-e SPRING_DATASOURCE_PLATFORM=mysql \\<br>-e MYSQL_SERVICE_HOST=192.168.96.126 \\<br>-e MYSQL_SERVICE_PORT=3306 \\<br>-e MYSQL_SERVICE_USER=root \\<br>-e MYSQL_SERVICE_PASSWORD=123456 \\<br>-e MYSQL_SERVICE_DB_NAME=nacos \\<br>-e NACOS_SERVER_IP=192.168.96.126 \\<br>-p 8948:8948 \\<br>--name my-nacos2 \\<br>zhusaidong&#47;nacos-server-m1:2.0.3","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551042,"discussion_content":"坦克车，翻不了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644857049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261694,"avatar":"https://static001.geekbang.org/account/avatar/00/13/40/7e/3f8684a4.jpg","nickname":"wxyz2z","note":"","ucode":"26CC47AD3E24A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574134,"discussion_content":"为啥改成127.0.0.1，进不去管理页面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653845280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1138645,"avatar":"https://static001.geekbang.org/account/avatar/00/11/5f/d5/2fec2911.jpg","nickname":"yu","note":"","ucode":"56856DCC0C8387","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564544,"discussion_content":"请问这个启动之后怎么进入nacos管理页面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650275224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334062,"user_name":"会飞的鱼","can_delete":false,"product_type":"c1","uid":2220587,"ip_address":"","ucode":"9498D63BA769F3","user_header":"https://static001.geekbang.org/account/avatar/00/21/e2/2b/5eab1490.jpg","comment_is_top":false,"comment_ctime":1644719862,"is_pvip":false,"replies":[{"id":"122099","content":"同学是集群模式启动失败，还是nacos的单机模式下也启动失败？可以把日志贴到评论区一块看下，日志里面一定能找到蛛丝马迹","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644856599,"ip_address":"","comment_id":334062,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5939687158","product_id":100101301,"comment_content":"不知道为啥，Nacos服务端总是启动失败，控制台、日志都看不出问题来，老师可以帮忙远程看下吗<br><br>添加集群机器列表时，用到的IP地址还用到application.properties中配置吗<br>## 注意，这里的IP不能是localhost或者127.0.0.1<br>192.168.1.100:8848<br>192.168.1.100:8948","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551037,"discussion_content":"同学是集群模式启动失败，还是nacos的单机模式下也启动失败？可以把日志贴到评论区一块看下，日志里面一定能找到蛛丝马迹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644856599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003836,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/51/3c/e81e2fb1.jpg","nickname":"Zhisheng","note":"","ucode":"1714395433D906","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578208,"discussion_content":"我在mac下，端口也是这两个，第二个实例一直无法启动。最后发现端口需要相隔再远一些，最后一个8848，一个18848，启动集群成功。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656580001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332651,"user_name":"Earthkiid","can_delete":false,"product_type":"c1","uid":2777810,"ip_address":"","ucode":"1AA9DB852A0AE7","user_header":"https://static001.geekbang.org/account/avatar/00/2a/62/d2/70e414c8.jpg","comment_is_top":false,"comment_ctime":1643440312,"is_pvip":true,"replies":[{"id":"121822","content":"版本的坑排查起来特别不容易，和我版本保持一致最省心","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644324978,"ip_address":"","comment_id":332651,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5938407608","product_id":100101301,"comment_content":"mysql版本太低了也不行，搞了半天一直都无法绑定数据源，后面查看日志才发现是有表没查到，然后才发现应该是导入sql时没注意，只成功建了五六个表，有的语句貌似执行不了？然后升级到5.7再重新来一次就行了。。","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549988,"discussion_content":"版本的坑排查起来特别不容易，和我版本保持一致最省心","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644324978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331820,"user_name":"西门吹牛","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1642784178,"is_pvip":false,"replies":[{"id":"121281","content":"后面我们配置中心改造是使用mysql作为存储方案，一致性这一层下沉到DB层","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1642920912,"ip_address":"","comment_id":331820,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5937751474","product_id":100101301,"comment_content":"Nacos 可以做服务注册中心，可以做配置中心<br>注册中心以高可用为主(AP)，采用最终一致性协议，和Gossip 不一样，每个节点只负责把自己管理的数据同步给集群中其他节点<br>做配置中心以一致性为主(CP)，采用强一致性协议，基于raft 实现","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547881,"discussion_content":"后面我们配置中心改造是使用mysql作为存储方案，一致性这一层下沉到DB层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642920913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330468,"user_name":"超级芒果冰","can_delete":false,"product_type":"c1","uid":1188976,"ip_address":"","ucode":"97480FBFA4F699","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/70/4e7751f3.jpg","comment_is_top":false,"comment_ctime":1641988125,"is_pvip":false,"replies":[{"id":"120450","content":"不推荐使用derby，因为无法保证高可用性，derby只能用在本地开发测试的环节","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1642005701,"ip_address":"","comment_id":330468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5936955421","product_id":100101301,"comment_content":"nacos在使用集群部署的时候，是不是一定配置外置的mysql数据库，不能使用内置的Derby数据库","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545636,"discussion_content":"不推荐使用derby，因为无法保证高可用性，derby只能用在本地开发测试的环节","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642005702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330007,"user_name":"大反派","can_delete":false,"product_type":"c1","uid":1117339,"ip_address":"","ucode":"425D85B39D8A61","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/9b/0835caf1.jpg","comment_is_top":false,"comment_ctime":1641727288,"is_pvip":false,"replies":[{"id":"120286","content":"使用PVC持久卷做nacos线上弹性方案是比较通用的方式，同学可以参考官方项目 https:&#47;&#47;github.com&#47;nacos-group&#47;nacos-k8s.git ","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1641822015,"ip_address":"","comment_id":330007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5936694584","product_id":100101301,"comment_content":"怎么用k8s起一个nacos","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545085,"discussion_content":"使用PVC持久卷做nacos线上弹性方案是比较通用的方式，同学可以参考官方项目 https://github.com/nacos-group/nacos-k8s.git ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641822015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328965,"user_name":"_xcc","can_delete":false,"product_type":"c1","uid":1298398,"ip_address":"","ucode":"8EB4B735D36E81","user_header":"https://static001.geekbang.org/account/avatar/00/13/cf/de/85555a93.jpg","comment_is_top":false,"comment_ctime":1640959604,"is_pvip":false,"replies":[{"id":"119846","content":"恭喜通关！同学可以把碰到的坑分享出来","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640968315,"ip_address":"","comment_id":328965,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5935926900","product_id":100101301,"comment_content":"安装个nacos集群也遇到很多错, 最终还是安装好了","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543167,"discussion_content":"恭喜通关！同学可以把碰到的坑分享出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640968315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328703,"user_name":"guopop","can_delete":false,"product_type":"c1","uid":1023027,"ip_address":"","ucode":"6878A35925063D","user_header":"https://static001.geekbang.org/account/avatar/0.png","comment_is_top":false,"comment_ctime":1640848402,"is_pvip":false,"replies":[{"id":"119785","content":"完全可以，使用安装包是为了降低上手门槛。Nacos提供了docker和k8s方案，大规模线上集群也是用k8s的PVC持久卷来管理的。可以参考这个官方社区的docker项目https:&#47;&#47;github.com&#47;nacos-group&#47;nacos-docker.git","user_name":"作者回复","user_name_real":"作者","uid":"2819998","ctime":1640881538,"ip_address":"","comment_id":328703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5935815698","product_id":100101301,"comment_content":"可以docker 集群部署的方案么 和安装包比较呢","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542927,"discussion_content":"完全可以，使用安装包是为了降低上手门槛。Nacos提供了docker和k8s方案，大规模线上集群也是用k8s的PVC持久卷来管理的。可以参考这个官方社区的docker项目https://github.com/nacos-group/nacos-docker.git","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640881538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328612,"user_name":"塔矢亮的小螃蟹","can_delete":false,"product_type":"c1","uid":1170561,"ip_address":"","ucode":"5AEE1B64589D8D","user_header":"https://static001.geekbang.org/account/avatar/00/11/dc/81/76aceead.jpg","comment_is_top":false,"comment_ctime":1640789232,"is_pvip":false,"replies":[{"id":"119772","content":"java.net.BindException: Address already in use应该就是端口占用的问题，在文章里有个不太起眼的地方同学可能miss了，就是你要在启动文件里把端口号改掉，换一个port","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640860561,"ip_address":"","comment_id":328612,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5935756528","product_id":100101301,"comment_content":"Hello 老师，遇到了一个问题，尝试启动两个nacos的start.sh文件<br>其中一个能够正常启动，访问nacos控制台<br>另外一个始终启动失败，查看start.out日志，发现提示Caused by: java.net.BindException: Address already in use<br>但是lsof-i:端口号没有发现端口被占用，Google了下没有找到有用的解决办法<br>完整日志没办法贴出来，这是部分error log<br>org.springframework.context.ApplicationContextException: Unable to start web server; nested exception is org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat<br>Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat<br>Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.web.servlet.FilterRegistrationBean]<br>","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542847,"discussion_content":"java.net.BindException: Address already in use应该就是端口占用的问题，在文章里有个不太起眼的地方同学可能miss了，就是你要在启动文件里把端口号改掉，换一个port","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640860561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1449679,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1e/cf/97cd8be1.jpg","nickname":"so long","note":"","ucode":"2A6B47BB32FC18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542797,"discussion_content":"请不要使用连续的端口，例如8848、8849，改成8848、8850。\n因为nacos启动时，会根据配置的端口额外启动两个grpc端口，例如启动端口为8848，那么会额外启动端口9848和9849，你可以通过lsof -i: 9848查看","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1640847349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2878664,"avatar":"","nickname":"Geek_e93c48","note":"","ucode":"4418236B0BF4DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1449679,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1e/cf/97cd8be1.jpg","nickname":"so long","note":"","ucode":"2A6B47BB32FC18","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543456,"discussion_content":"还真是这个问题，搭建nacos双节点集群不能采用连续端口号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641140868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":542797,"ip_address":""},"score":543456,"extra":""}]}]},{"had_liked":false,"id":328491,"user_name":"Avalon","can_delete":false,"product_type":"c1","uid":1908872,"ip_address":"","ucode":"820523E3C519F0","user_header":"https://static001.geekbang.org/account/avatar/00/1d/20/88/41212eb9.jpg","comment_is_top":false,"comment_ctime":1640752817,"is_pvip":false,"replies":[{"id":"119675","content":"可以，在启动脚本里搜start.out关键字能找到路径配置的地方","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640785075,"ip_address":"","comment_id":328491,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5935720113","product_id":100101301,"comment_content":"nacos启动日志路径可以修改吗？","like_count":1,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542553,"discussion_content":"可以，在启动脚本里搜start.out关键字能找到路径配置的地方","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640785075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359773,"user_name":"Geek_3b8e3f","can_delete":false,"product_type":"c1","uid":1462704,"ip_address":"北京","ucode":"7FB2074423A328","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlN0AUA3CiaZ48S7icBeQr7t6ZbBeAQQSgCOrELcJWaP3Fg4BSOqiaxGhJSAV9IwlVvj3iaRCVpWf7gA/132","comment_is_top":false,"comment_ctime":1665852569,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665852569","product_id":100101301,"comment_content":"mac 本地启动 nacos 时，单机启动没问题，但是启动集群就会报错，有没有哪位大佬遇到过<br><br>Caused by: java.net.UnknownHostException: jmenv.tbsite.net","like_count":0},{"had_liked":false,"id":352430,"user_name":"javaadu","can_delete":false,"product_type":"c1","uid":1000519,"ip_address":"","ucode":"8C0B140F1C8992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg","comment_is_top":false,"comment_ctime":1658661815,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658661815","product_id":100101301,"comment_content":"m1的mac pro，终于搞起来了，找到一个1.8的jdk：https:&#47;&#47;www.oracle.com&#47;java&#47;technologies&#47;downloads&#47;#java8","like_count":0},{"had_liked":false,"id":342917,"user_name":"UV","can_delete":false,"product_type":"c1","uid":1029869,"ip_address":"","ucode":"CD0E7D7BB89CE3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/ed/0672d361.jpg","comment_is_top":false,"comment_ctime":1650531894,"is_pvip":true,"replies":[{"id":"126162","content":"同学干嘛用Oracle呀，贵死了，用mysql多省钱。我自己确实没用过nacos和oracle这个组合，但如果需要改的话，application.properties配置数据源的地方改成oracle的datasource和jdbc driver应该就可以，同学可以试试","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1652583918,"ip_address":"","comment_id":342917,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650531894","product_id":100101301,"comment_content":"求大神老师指导，2.x的版本，如何使用其他数据库呢，比如Oracle，有啥最简单的办法，还是说只能自己重写实现","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572046,"discussion_content":"同学干嘛用Oracle呀，贵死了，用mysql多省钱。我自己确实没用过nacos和oracle这个组合，但如果需要改的话，application.properties配置数据源的地方改成oracle的datasource和jdbc driver应该就可以，同学可以试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652583919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340862,"user_name":"王国栋","can_delete":false,"product_type":"c1","uid":1104064,"ip_address":"","ucode":"65B6A12F6632F7","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/c0/a030688d.jpg","comment_is_top":false,"comment_ctime":1649206124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649206124","product_id":100101301,"comment_content":"nacos2.0.2我们使用中偶尔会出现集群中某down的情况造成服务启动失败","like_count":0},{"had_liked":false,"id":339959,"user_name":"小雄不是小熊","can_delete":false,"product_type":"c1","uid":1048610,"ip_address":"","ucode":"0C648D73BCA96D","user_header":"https://static001.geekbang.org/account/avatar/00/10/00/22/c5296085.jpg","comment_is_top":false,"comment_ctime":1648513254,"is_pvip":true,"replies":[{"id":"124403","content":"VIP这一层也是可以做主从LVS的","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1648646108,"ip_address":"","comment_id":339959,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1648513254","product_id":100101301,"comment_content":"为了提高可用性搭建nacos集群，但是在client端是通过nginx+lvs提供vip url的，这样的话是不是又存在单点问题了","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559214,"discussion_content":"VIP这一层也是可以做主从LVS的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648646109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339131,"user_name":"宗子豪","can_delete":false,"product_type":"c1","uid":1237400,"ip_address":"","ucode":"7EA03DF1151206","user_header":"https://static001.geekbang.org/account/avatar/00/12/e1/98/c99c6d36.jpg","comment_is_top":false,"comment_ctime":1647934595,"is_pvip":false,"replies":[{"id":"124397","content":"同学的mac版本是什么，通常高版本库在低版本系统上运行才会有这个error。<br><br>我找了一个stackoverflow上类似的解决方案，看看可不可行<br>https:&#47;&#47;stackoverflow.com&#47;questions&#47;50247343&#47;dyld-symbol-not-found-zdapvm-running-king-on-mac-os-x&#47;60039685","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1648645357,"ip_address":"","comment_id":339131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647934595","product_id":100101301,"comment_content":"mac启动nacos时候一直报这个错误,  麻烦大神看看是什么原因<br>dyld: Symbol not found: ____chkstk_darwin<br>  Referenced from: &#47;private&#47;var&#47;folders&#47;1b&#47;bl11sgq122sgs0vw70n4p43c0000gn&#47;T&#47;librocksdbjni1773437395421201087.jnilib (which was built for Mac OS X 10.15)<br>  Expected in: &#47;usr&#47;lib&#47;libSystem.B.dylib","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559206,"discussion_content":"同学的mac版本是什么，通常高版本库在低版本系统上运行才会有这个error。\n\n我找了一个stackoverflow上类似的解决方案，看看可不可行\nhttps://stackoverflow.com/questions/50247343/dyld-symbol-not-found-zdapvm-running-king-on-mac-os-x/60039685","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648645357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339006,"user_name":"qwi","can_delete":false,"product_type":"c1","uid":2881048,"ip_address":"","ucode":"A11C36EE18CA6F","user_header":"https://static001.geekbang.org/account/avatar/00/2b/f6/18/97db3985.jpg","comment_is_top":false,"comment_ctime":1647855537,"is_pvip":false,"replies":[{"id":"123911","content":"看报错信息应该是mysql版本不匹配导致的，报错信息是要求jdbc url里有一个标准的serverTimezone字段，同学不妨试试给url里加上serverTimezone=GMT或者serverTimezone=UTC之类的字样再试试","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1647871457,"ip_address":"","comment_id":339006,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647855537","product_id":100101301,"comment_content":"老师我用的MySQL5.7，单个nacos一直起不来，日志里没东西<br>org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: The server time zone value &#39;?й???????&#39; is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the &#39;serverTimezone&#39; configuration property) to use a more specifc time zone value if you want to utilize time zone support.<br>        at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:82)<br>        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:371)<br>        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:523)<br>        at com.alibaba.nacos.config.server.service.datasource.ExternalDataSourceServiceImpl$SelectMasterTask.run(ExternalDataSourceServiceImpl.java:212)","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557584,"discussion_content":"看报错信息应该是mysql版本不匹配导致的，报错信息是要求jdbc url里有一个标准的serverTimezone字段，同学不妨试试给url里加上serverTimezone=GMT或者serverTimezone=UTC之类的字样再试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647871458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338494,"user_name":"一只想上进的懒狗","can_delete":false,"product_type":"c1","uid":2885705,"ip_address":"","ucode":"F9DBA8DBC3263C","user_header":"https://static001.geekbang.org/account/avatar/00/2c/08/49/087bd0cb.jpg","comment_is_top":false,"comment_ctime":1647524623,"is_pvip":false,"replies":[{"id":"123912","content":"生产级的做法是用k8s的PVC持久卷对nacos做弹性，比如用kubectl scale命令做动态扩容，扩容后kubectl exec命令获取pod中nacos集群配置文件信息","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1647871836,"ip_address":"","comment_id":338494,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647524623","product_id":100101301,"comment_content":"哈哈直接上docker-compose 布置nacos集群,好用的一笔,就是问问如何配置集群的地址,我现在是给每个<br>nacos都手动加上集群其它的ip,还有更好的办法马","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557585,"discussion_content":"生产级的做法是用k8s的PVC持久卷对nacos做弹性，比如用kubectl scale命令做动态扩容，扩容后kubectl exec命令获取pod中nacos集群配置文件信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647871836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337974,"user_name":"松鼠鱼","can_delete":false,"product_type":"c1","uid":1815185,"ip_address":"","ucode":"C0E87CCF71DB44","user_header":"","comment_is_top":false,"comment_ctime":1647198913,"is_pvip":true,"replies":[{"id":"123707","content":"1) warning在老油子眼里比info还亲切，不影响使用，直接忽略就可以。我看报错应该是和本地jdk版本有关，是不是同学下了个版本比较高的jdk？<br>2）同学的描述信息不太好定位问题，还是需要提供更多的信息才能做进一步排查，一个是log里nacos.log, nacos-cluster.log等之类的日志文件，另一个是到cluster。conf看里面有没有系统自动添加的一行记录","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1647522374,"ip_address":"","comment_id":337974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647198913","product_id":100101301,"comment_content":"老师，请教两个问题：<br>1. nacos启动时报以下warning（但可以成功启动）：<br>WARNING: An illegal reflective access operation has occurred<br>WARNING: Illegal reflective access by com.alipay.sofa.jraft.util.internal.UnsafeUtil (jar:file:&#47;D:&#47;Nacos&#47;nacos-cluster2&#47;target&#47;nacos-server.jar!&#47;BOOT-INF&#47;lib&#47;jraft-core-1.3.5.jar!&#47;) to field java.nio.Buffer.address<br>请问这个正常吗？<br>2. 两个nacos都可以起来，但是控制台上看另一个都是down，如果我手动改一下cluster.conf文件（先改一个错的ip地址，再改回来），又互相可见up了。<br>这又是怎么回事啊？","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556814,"discussion_content":"1) warning在老油子眼里比info还亲切，不影响使用，直接忽略就可以。我看报错应该是和本地jdk版本有关，是不是同学下了个版本比较高的jdk？\n2）同学的描述信息不太好定位问题，还是需要提供更多的信息才能做进一步排查，一个是log里nacos.log, nacos-cluster.log等之类的日志文件，另一个是到cluster。conf看里面有没有系统自动添加的一行记录","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647522374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336793,"user_name":"Geek_aeeb45","can_delete":false,"product_type":"c1","uid":2029641,"ip_address":"","ucode":"B366C4804BBC68","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f8/49/0c3a380d.jpg","comment_is_top":false,"comment_ctime":1646371267,"is_pvip":true,"replies":[{"id":"123094","content":"啊哈，mysql数据源配置错了嘛，我来个点到即止。<br><br>我的猜想是：docker里的nacos连接不到另一个docker或者本地安装的mysql数据库。<br><br>那么接下来问题来了，docker的IP怎么做穿透呢，留一半清醒留一半醉，就留给同学来自学了","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1646405459,"ip_address":"","comment_id":336793,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646371267","product_id":100101301,"comment_content":"docker-compose nacos集群一直报No DataSource set，希望老师帮忙指导一下","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554500,"discussion_content":"啊哈，mysql数据源配置错了嘛，我来个点到即止。\n\n我的猜想是：docker里的nacos连接不到另一个docker或者本地安装的mysql数据库。\n\n那么接下来问题来了，docker的IP怎么做穿透呢，留一半清醒留一半醉，就留给同学来自学了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646405460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336220,"user_name":"罗逸","can_delete":false,"product_type":"c1","uid":2869911,"ip_address":"","ucode":"828C36255274C0","user_header":"https://static001.geekbang.org/account/avatar/00/2b/ca/97/87f1f07c.jpg","comment_is_top":false,"comment_ctime":1646013827,"is_pvip":false,"replies":[{"id":"123082","content":"只要distro协议报错那大概率即是cluster启动的方式，cluster模式比较吃内存，我建议这样<br>1. 先试一下用单机模式启动docker，如果可行的话，说明nacos基本配置没错。<br>2. 然后你在尝试大幅增大docker的内存限制，再试一把集群模式启动","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1646404043,"ip_address":"","comment_id":336220,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646013827","product_id":100101301,"comment_content":"老师，我用docker启动nacos集群，能正常启动，浏览器能访问，服务一直注册不进去<br>com.alibaba.nacos.api.exception.NacosException: failed to req API:&#47;nacos&#47;v1&#47;ns&#47;instance after all servers([192.168.2.127:8848]) tried: ErrCode:503, ErrMsg:server is DOWNnow, detailed error message: Optional[Distro protocol is not initialized]","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554488,"discussion_content":"只要distro协议报错那大概率即是cluster启动的方式，cluster模式比较吃内存，我建议这样\n1. 先试一下用单机模式启动docker，如果可行的话，说明nacos基本配置没错。\n2. 然后你在尝试大幅增大docker的内存限制，再试一把集群模式启动","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646404043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334063,"user_name":"会飞的鱼","can_delete":false,"product_type":"c1","uid":2220587,"ip_address":"","ucode":"9498D63BA769F3","user_header":"https://static001.geekbang.org/account/avatar/00/21/e2/2b/5eab1490.jpg","comment_is_top":false,"comment_ctime":1644720452,"is_pvip":false,"replies":[{"id":"122100","content":"启动问题通常都能在启动日志里找到蛛丝马迹，同学把启动日志贴到文章里一块看一下，logs&#47;start.out这个文件里的内容","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1644856818,"ip_address":"","comment_id":334063,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644720452","product_id":100101301,"comment_content":"我Nacos服务端总是无法启动，控制台、日志都看不出问题，<br>mysql启动了，也可以正常连接，无端口占用问题，<br>配置也检查了好几遍，已确定没有问题，<br>我要崩溃了，老师能帮忙远程看下吗，灰常感谢","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551039,"discussion_content":"启动问题通常都能在启动日志里找到蛛丝马迹，同学把启动日志贴到文章里一块看一下，logs/start.out这个文件里的内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644856818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331760,"user_name":"一念之间","can_delete":false,"product_type":"c1","uid":1562957,"ip_address":"","ucode":"25C6317C111F93","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/4d/def385e9.jpg","comment_is_top":false,"comment_ctime":1642752764,"is_pvip":true,"replies":[{"id":"121284","content":"docker hub有民间热心群众打包nacos-server-m1:2.0.3镜像，可以在m1玩","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1642921188,"ip_address":"","comment_id":331760,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642752764","product_id":100101301,"comment_content":"mac 笔记本的M1 服务无法启动,还没有做兼容","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547885,"discussion_content":"docker hub有民间热心群众打包nacos-server-m1:2.0.3镜像，可以在m1玩","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642921188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329970,"user_name":"kernel","can_delete":false,"product_type":"c1","uid":1109390,"ip_address":"","ucode":"511BBA152F64CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/8e/dc7e2ca6.jpg","comment_is_top":false,"comment_ctime":1641705187,"is_pvip":false,"replies":[{"id":"120204","content":"在两个nacos的cluster.conf里都要添加","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1641727617,"ip_address":"","comment_id":329970,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641705187","product_id":100101301,"comment_content":"添加集群机器列表<br>这个在哪添加？文中配置了两个nacos，但是集群列表在哪里添加呢？任意一个cluster.conf 吗？","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544833,"discussion_content":"在两个nacos的cluster.conf里都要添加","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641727617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329924,"user_name":"Rorchachl","can_delete":false,"product_type":"c1","uid":1895320,"ip_address":"","ucode":"7AABFF65A0033C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/KiaBJsepm9fHHicfPxiahhR3RqRaR4QH6YFibIHV5o5VspTIXmH72iaiaotb4cRpWtRvLC7mnh5KH1KlSNLGWlI7wUicQ/132","comment_is_top":false,"comment_ctime":1641649668,"is_pvip":false,"replies":[{"id":"120209","content":"同学找到一处笔误，送你一朵小红花","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1641728858,"ip_address":"","comment_id":329924,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641649668","product_id":100101301,"comment_content":"Nacos Server 的启动项位于 bin 目录下的 application.properties 文件 ","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544841,"discussion_content":"同学找到一处笔误，送你一朵小红花","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641728858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328957,"user_name":"杨超伟","can_delete":false,"product_type":"c1","uid":1325843,"ip_address":"","ucode":"8E309160511DE0","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/13/19fc373b.jpg","comment_is_top":false,"comment_ctime":1640953514,"is_pvip":false,"replies":[{"id":"119845","content":"同学是启动源码的coupon服务报的错吗？是不是Application那个类没有放到项目中呢，可以拿我的gitee项目编译之后跑一下，然后和本地的项目比对一下不同之处","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640968217,"ip_address":"","comment_id":328957,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1640953514","product_id":100101301,"comment_content":"老师，启动之后日志上面报了这个错误是什么原因？<br>错误: 找不到或无法加载主类 <br>原因: java.lang.ClassNotFoundException: ","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543165,"discussion_content":"同学是启动源码的coupon服务报的错吗？是不是Application那个类没有放到项目中呢，可以拿我的gitee项目编译之后跑一下，然后和本地的项目比对一下不同之处","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640968217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2017580,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c9/2c/9ed40921.jpg","nickname":"BOB","note":"","ucode":"E86596709EAB1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543774,"discussion_content":"遇到了同样的问题，我从github上拉了nacos的源码，maven编译后可以运行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641297468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328699,"user_name":"so long","can_delete":false,"product_type":"c1","uid":1449679,"ip_address":"","ucode":"2A6B47BB32FC18","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/cf/97cd8be1.jpg","comment_is_top":false,"comment_ctime":1640846966,"is_pvip":false,"replies":[{"id":"119784","content":"对开发测来说只用配置一个类vip的地址，扩缩容无感知。对于服务端一侧来说，Nacos弹性构建也是比较成熟的方案了，借助k8s的PVC持久卷来实现。同学可以参考我贴出来的官方的guide来动手搭建，https:&#47;&#47;nacos.io&#47;zh-cn&#47;docs&#47;use-nacos-with-kubernetes.html，参考官方例子https:&#47;&#47;github.com&#47;nacos-group&#47;nacos-k8s","user_name":"作者回复","user_name_real":"编辑","uid":"2819998","ctime":1640881442,"ip_address":"","comment_id":328699,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640846966","product_id":100101301,"comment_content":"老师你好，目前nacos集群中有2个节点，如果需要新增1个节点，是不是需要把每个节点的cluster.conf配置都添加新增节点的ip+端口，如果是这么处理的话，那运维是不是很麻烦。","like_count":0,"discussions":[{"author":{"id":2819998,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/07/9e/d2de2832.jpg","nickname":"姚半仙","note":"","ucode":"4C86AA5D6D8C39","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542926,"discussion_content":"对开发测来说只用配置一个类vip的地址，扩缩容无感知。对于服务端一侧来说，Nacos弹性构建也是比较成熟的方案了，借助k8s的PVC持久卷来实现。同学可以参考我贴出来的官方的guide来动手搭建，https://nacos.io/zh-cn/docs/use-nacos-with-kubernetes.html，参考官方例子https://github.com/nacos-group/nacos-k8s","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640881442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}