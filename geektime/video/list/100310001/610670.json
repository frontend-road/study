{"id":610670,"title":"44｜文件编码：如何解决不同操作系统的文件乱码问题？","content":"<p><strong>课后习题</strong><br>\n使用 open() 函数打开任意一个文件，并观察执行结果。打开文件时，请注意根据自己的操作系统使用正确的字符集，如果你使用的是 Windows 系统则使用 GBK 字符编码，如果你使用的是 macOS 系统则使用 UTF-8 字符编码。</p><p><strong>课程代码、课件及其他相关资料地址</strong><br>\n<a href=\"https://gitee.com/wilsonyin/zero-basics-python\">https://gitee.com/wilsonyin/zero-basics-python</a></p>","comments":[{"had_liked":false,"id":366228,"user_name":"聪少 Jeff","can_delete":false,"product_type":"c3","uid":1159983,"ip_address":"广东","ucode":"C791ACA9B47679","user_header":"https://static001.geekbang.org/account/avatar/00/11/b3/2f/d08a1363.jpg","comment_is_top":false,"comment_ctime":1673493510,"is_pvip":false,"replies":[{"id":133485,"content":"早期版本有一个chardet.detect() 函数可以查看，但是新版本不准确，所以我也没推荐","user_name":"作者回复","user_name_real":"编辑","uid":1056235,"ctime":1673590941,"ip_address":"广东","comment_id":366228,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"尹老师，再不知道文件编码时，除了根据操作系统方法来预判编码外，还有没有其他方法可以预判文件编码呢？可否使用程序方式呢？就像type() 函数那样去了解到当前变量类型一样。","like_count":0,"discussions":[{"author":{"id":1056235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/eb/b2123759.jpg","nickname":"尹会生","note":"","ucode":"D1093DBD093617","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599562,"discussion_content":"早期版本有一个chardet.detect() 函数可以查看，但是新版本不准确，所以我也没推荐","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673590941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393536,"user_name":"刘立嘉","can_delete":false,"product_type":"c3","uid":2414637,"ip_address":"上海","ucode":"1241140EBE7FE3","user_header":"https://static001.geekbang.org/account/avatar/00/24/d8/2d/4b0355f3.jpg","comment_is_top":false,"comment_ctime":1724137455,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"f = open(&#39;ai_assistant.txt&#39;, mode=&#39;r&#39;, encoding=&#39;utf-8&#39;)\ndata = f.readlines()\nprint(data)\nf.close()","like_count":0},{"had_liked":false,"id":384862,"user_name":"Geek_0c747b","can_delete":false,"product_type":"c3","uid":3790728,"ip_address":"广东","ucode":"7D7251D7B98B08","user_header":"","comment_is_top":false,"comment_ctime":1701693864,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# file = open(&#39;44.txt&#39;, mode= &#39;w&#39;, encoding=&#39;GBK&#39;)\n# file.write(&#39;人生苦短，我用 Python&#39;)\n\n\nfile = open(&#39;44.txt&#39;, mode=&#39;r&#39;, encoding=&#39;GBK&#39;)\n#file = open(&#39;44.txt&#39;, mode=&#39;r&#39;, encoding=&#39;UTF-8&#39;) UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xc8 in position 0: invalid continuation byte\nprint(file.readlines())","like_count":0},{"had_liked":false,"id":380996,"user_name":"William","can_delete":false,"product_type":"c3","uid":1346215,"ip_address":"吉林","ucode":"55F5D9DEE485B1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","comment_is_top":false,"comment_ctime":1694569351,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"python3.9可以.\n\nimport chardet\n\ndef encoding_chardet():\n    #先获取到文件的编码格式\n    with open(&#39;.&#47;demo_GBK.txt&#39;, mode=&#39;rb&#39;) as f:\n        content = f.read()\n        encodingStr = chardet.detect(content)[&#39;encoding&#39;]\n        print(encodingStr)\n\n    #再根据文件的编码跟是， 打开文件\n    with open(&#39;.&#47;demo_GBK.txt&#39;, mode=&#39;r&#39;, encoding=encodingStr) as f:\n        content = f.read()\n        print(content)\n\nencoding_chardet()","like_count":0},{"had_liked":false,"id":379993,"user_name":"好困啊","can_delete":false,"product_type":"c3","uid":2094450,"ip_address":"上海","ucode":"D49429660F2DC8","user_header":"https://static001.geekbang.org/account/avatar/00/1f/f5/72/8cbc5cb3.jpg","comment_is_top":false,"comment_ctime":1692795043,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"f = open(&#39;demo_GBK.txt&#39;,mode=&#39;r&#39;,encoding=&#39;GBK&#39;)\ndata = f.readlines()\nprint(data)\nf.close()","like_count":0},{"had_liked":false,"id":377513,"user_name":"Geek_Mike","can_delete":false,"product_type":"c3","uid":3196376,"ip_address":"云南","ucode":"CFA942192C3B74","user_header":"https://static001.geekbang.org/account/avatar/00/30/c5/d8/c5509b9c.jpg","comment_is_top":false,"comment_ctime":1688618790,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"f = open(&#39;.&#47;demo_GBK.txt&#39;, mode=&#39;a&#39;)\nf.write(&#39;\\n7月4日是和花、和叶、萌兰的生日&#39;)\nf.close()\n\nf= open(&#39;.&#47;demo_GBK.txt&#39;, &#39;r&#39;, encoding=&#39;UTF-8&#39;)\ndata = f.readlines()\nprint(data)\n\n&gt;&gt;&gt;[&#39;人生苦短，我用Python\\n&#39;, &#39;7月4日是和花、和叶、萌兰的生日&#39;]\n\nf= open(&#39;.&#47;demo_GBK.txt&#39;, &#39;r&#39;, encoding=&#39;GBK&#39;)\ndata = f.readlines()\nprint(data)\n\n&gt;&gt;&gt;因为打开文件的编码不对，所以系统报错 UnicodeDecodeerror","like_count":0},{"had_liked":false,"id":371134,"user_name":"跳哥爱学习","can_delete":false,"product_type":"c3","uid":2263623,"ip_address":"四川","ucode":"59AD5282490D50","user_header":"https://static001.geekbang.org/account/avatar/00/22/8a/47/82c7c347.jpg","comment_is_top":false,"comment_ctime":1679566171,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"file = open(&quot;C:\\\\Users\\\\hz20095739\\Desktop\\\\text.txt&quot;)","like_count":0},{"had_liked":false,"id":368008,"user_name":"sunny","can_delete":false,"product_type":"c3","uid":1904632,"ip_address":"江苏","ucode":"12350F6FF873D1","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0f/f8/e1b9c1cc.jpg","comment_is_top":false,"comment_ctime":1675818330,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"import os\n\nos.chdir(&quot;c:&#47;Windows&quot;)\nf=open(&quot;TMFilter.log&quot;, mode = &#39;r&#39;, encoding= &#39;GBK&#39;)\nprint(f.readlines())\nf.close()","like_count":0},{"had_liked":false,"id":367187,"user_name":"yanyu-xin","can_delete":false,"product_type":"c3","uid":1899757,"ip_address":"广东","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1674998779,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"import os\nos.chdir(&quot;D:\\\\文档\\python\\\\2022极客PYTHON学习\\\\练习&quot;)  # 打开Windows下的目录\nfile_handler = open(&quot;demo.txt&quot;,mode=&#39;r&#39;,encoding=&#39;UTF-8&#39;) # 打开txt后缀的文件，只读，编码为UTF-8的文件\nfile_handler1 = open(&quot;demo_GBK.txt&quot;,mode=&#39;r&#39;,encoding=&#39;GBK&#39;) # 打开txt后缀的文件，只读，编码为GBK的文件\nf = file_handler.read() # 读文件内容\nf1 = file_handler1.read() \nprint(f)\nprint(f1)\nfile_handler.close() # 关闭文件\nfile_handler1.close()","like_count":0},{"had_liked":false,"id":366244,"user_name":"Cy23","can_delete":false,"product_type":"c3","uid":1591293,"ip_address":"辽宁","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1673505452,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"f = open(&#39;db.json&#39;, mode=&#39;r&#39;, encoding=&#39;GBK&#39;)\ndata = f.readlines()\nprint(data)","like_count":0},{"had_liked":false,"id":364162,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1670588344,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"# MacOS\nimport os\nos.chdir(&quot;&#47;etc&quot;)\nf = open(&quot;passwd&quot;, mode=&quot;r&quot;, encoding=&quot;UTF-8&quot;)\ndata = f.read()\nprint(data)\nf.close()","like_count":0},{"had_liked":false,"id":364009,"user_name":"On","can_delete":false,"product_type":"c3","uid":1526359,"ip_address":"陕西","ucode":"E260187B398E15","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/57/3f68946c.jpg","comment_is_top":false,"comment_ctime":1670422385,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100310001,"comment_content":"import os\nos.chdir(&#39;C:\\\\Users\\\\Administrator\\\\Desktop&#39;)\nf = open(&#39;test.txt&#39;, mode= &#39;r&#39;, encoding=&#39;GBK&#39;)\ndata = f.read()\nprint(data)\nf.close()","like_count":0}]}