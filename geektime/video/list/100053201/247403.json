{"id":247403,"title":"10 | 使用tf.keras管理Sequential模型","content":"<h1>课件和 Demo 地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/experts\">https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/experts</a></p>","comments":[{"had_liked":false,"id":227733,"user_name":"源力","can_delete":false,"product_type":"c3","uid":1919459,"ip_address":"","ucode":"66D96CF3FB51BC","user_header":"https://static001.geekbang.org/account/avatar/00/1d/49/e3/1169b513.jpg","comment_is_top":false,"comment_ctime":1592466600,"is_pvip":false,"replies":[{"id":84244,"content":"1. sparse_categorical_crossentropy 和 categorical_crossentropy 在基础课《TensorFlow 快速入门与实战》有讲。\n2. !pip install graphviz pydot 是可视化模型网络的 Python 软件依赖包，!apt-get install -y graphviz 是（系统级）依赖软件，也必须安装。\n","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1592722461,"ip_address":"","comment_id":227733,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"老师，您好！我有两个问题：\n1.损失函数：sparse_categorical_crossentropy 和 categorical_crossentropy的区别是什么呢？它们应该怎样区分来用？\n2.!apt-get install -y graphviz,这行代码的作用是什么呢？!pip install graphviz pydot安装了之后是不是还不能直接用呢？\n谢谢老师！","like_count":1,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498762,"discussion_content":"1. sparse_categorical_crossentropy 和 categorical_crossentropy 在基础课《TensorFlow 快速入门与实战》有讲。\n2. !pip install graphviz pydot 是可视化模型网络的 Python 软件依赖包，!apt-get install -y graphviz 是（系统级）依赖软件，也必须安装。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592722461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249013,"user_name":"杰洛特","can_delete":false,"product_type":"c3","uid":1098146,"ip_address":"","ucode":"46D0574654F8AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqEacia8yO1dR5Tal9B7w8PzTRrViajlAvDph96OqcuBGe29icbXOibhibGmaBcO7BfpVia0Y8ksZwsuAYQ/132","comment_is_top":false,"comment_ctime":1600401423,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"如果使用 tensorflow 2.3 版本进行这部分试验的时候，会发生模型保存后再加载失效的情况。现象就是重新加载后的模型准确率非常低，在 10% 左右，这就与没有训练完全瞎猜的准确率一样了，查了下 github 是官方承认的 bug #42459，将在新版本修正。临时解决方案是把模型中的准确率由 accuracy 替换为 sparse_categorical_accuracy，这样模型就能正确保存并加载了。","like_count":7,"discussions":[{"author":{"id":2233405,"avatar":"https://static001.geekbang.org/account/avatar/00/22/14/3d/513da9db.jpg","nickname":"LF 小时","note":"","ucode":"C57DBD297B0AEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329402,"discussion_content":" tensorflow 2.3.1也出现这个问题。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606379690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243587,"user_name":"浩天","can_delete":false,"product_type":"c3","uid":2042637,"ip_address":"","ucode":"4CCC4D75145221","user_header":"https://static001.geekbang.org/account/avatar/00/1f/2b/0d/96cacd9e.jpg","comment_is_top":false,"comment_ctime":1598200935,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"win10上保存模型后进行加载，evaluate得出的结果和上面model.evaluate结果不一致，大概差10倍，不知道是什么问题。","like_count":2,"discussions":[{"author":{"id":1187359,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1e/1f/41e35a24.jpg","nickname":"測試中……","note":"","ucode":"E7E1B46CB6D8B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318653,"discussion_content":"用 loss=&#39;sparse_categorical_crossentropy&#39;, 的时候，五轮运算跑出来正确率 20% 到 40% 之间。\n修改为 loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True), 后第一轮就是 85%。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603799785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2176796,"avatar":"","nickname":"Geek_2514bb","note":"","ucode":"022914B681FC9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306144,"discussion_content":"原因是编译模型的时候，损失函数写错了，正确的应该是：\n\n```\nmodel.compile(optimizer=&#34;adam&#34;,\n              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),\n              metrics=[&#39;accuracy&#39;])\n```\n\n改成这样之后精确度就提升了。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600180086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2032102,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLiaAOuHRFhARGrdxK0gltGibVOCrdmSzWxK1ia8e77ia7hefcMV6xJ9pB1v73pRmVBx8y8ZqVQXZCfrQ/132","nickname":"枫","note":"","ucode":"A88D6E94A52346","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330807,"discussion_content":"确实如此 差10倍 2.3.1的版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606714166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293353,"user_name":"荒野无尽","can_delete":false,"product_type":"c3","uid":1552644,"ip_address":"","ucode":"450B2707D517E3","user_header":"https://static001.geekbang.org/account/avatar/00/17/b1/04/b321c150.jpg","comment_is_top":false,"comment_ctime":1621348039,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"老师，我上条留言草率了，您在后面提到了激活函数的问题，我没看完就草率发言了，对不起","like_count":0},{"had_liked":false,"id":293351,"user_name":"荒野无尽","can_delete":false,"product_type":"c3","uid":1552644,"ip_address":"","ucode":"450B2707D517E3","user_header":"https://static001.geekbang.org/account/avatar/00/17/b1/04/b321c150.jpg","comment_is_top":false,"comment_ctime":1621347109,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"老师，模型最后一层dense层是不是要加上一个activation=‘softmax’呢？","like_count":0},{"had_liked":false,"id":238535,"user_name":"小白","can_delete":false,"product_type":"c3","uid":2049737,"ip_address":"","ucode":"B1A103B2658064","user_header":"https://static001.geekbang.org/account/avatar/00/1f/46/c9/08bb2d93.jpg","comment_is_top":false,"comment_ctime":1596189980,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"我在运行时出现这些报错，一直找不到原因InvalidArgumentError                      Traceback (most recent call last)\r\n&lt;ipython-input-8-9eaab81d20e2&gt; in &lt;module&gt;\r\n      3   tf.keras.layers.Dense(128, activation=&#39;relu&#39;),\r\n      4   tf.keras.layers.Dropout(0.2),\r\n----&gt; 5   tf.keras.layers.Dense(10)","like_count":0}]}