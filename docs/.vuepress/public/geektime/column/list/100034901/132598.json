{"id":132598,"title":"07 | åˆ†å¸ƒå¼é”å’ŒåŸå­æ€§ï¼šä½ çœ‹åˆ°çš„æœªè¯»æ¶ˆæ¯æé†’æ˜¯çœŸçš„å—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è¢æ­¦æ—ã€‚</p><p>åœ¨å‰é¢å‡ èŠ‚è¯¾ç¨‹ä¸­ï¼Œæˆ‘ç€é‡æŠŠå³æ—¶æ¶ˆæ¯åœºæ™¯ä¸­å‡ ä¸ªæ ¸å¿ƒçš„ç‰¹æ€§ï¼Œè¿›è¡Œäº†è¾ƒä¸ºè¯¦ç»†çš„è®²è§£ã€‚åœ¨å®é™…ç”¨æˆ·åœºæ™¯ä¸‹ï¼Œé™¤äº†å®æ—¶æ€§ã€å¯é æ€§ã€ä¸€è‡´æ€§ã€å®‰å…¨æ€§è¿™äº›åˆšéœ€å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåŠŸèƒ½å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼Œæ¯”å¦‚ä»Šå¤©æˆ‘è¦è®²çš„â€œæ¶ˆæ¯æœªè¯»æ•°â€ã€‚</p><p>æ¶ˆæ¯æœªè¯»æ•°å¯¹ç”¨æˆ·ä½¿ç”¨ä½“éªŒå½±å“å¾ˆå¤§ï¼Œè¿™æ˜¯å› ä¸ºâ€œæœªè¯»æ•°â€æ˜¯ä¸€ç§å¼ºæé†’æ–¹å¼ï¼Œå®ƒé€šè¿‡Appè§’æ ‡ï¼Œæˆ–è€…Appå†…éƒ¨Tabçš„æ•°å­—æ ‡ç­¾ï¼Œæ¥å‘Šè¯‰ç”¨æˆ·æ”¶åˆ°äº†æ–°çš„æ¶ˆæ¯ã€‚</p><p>å¯¹äºåœ¨å¤šä¸ªç¤¾äº¤Appæ¥å›åˆ‡æ¢çš„é‡åº¦ç”¨æˆ·æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é â€œæœªè¯»æ•°â€æ¥è·å–æ–°æ¶ˆæ¯äº‹ä»¶ï¼Œå¦‚æœâ€œæœªè¯»æ•°â€ä¸å‡†ç¡®ï¼Œä¼šå¯¹ç”¨æˆ·é€ æˆä¸å¿…è¦çš„å›°æ‰°ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬çœ‹åˆ°æŸä¸ªAppæœ‰ä¸€æ¡â€œæœªè¯»æ¶ˆæ¯æé†’â€ï¼Œç‚¹è¿›å»äº‹ä»¶å´æ²¡æœ‰ï¼Œè¿™ç§æƒ…å†µå¯¹äºâ€œå¼ºè¿«ç—‡æ‚£è€…â€å®åœ¨å±äºä¸å¯æ¥å—ï¼›æˆ–è€…æœ¬æ¥æœ‰äº†æ–°çš„æ¶ˆæ¯ï¼Œä½†æœªè¯»æ•°é”™è¯¯ï¼Œå¯¼è‡´æ²¡æœ‰æé†’åˆ°ç”¨æˆ·ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·é”™è¿‡ä¸€äº›é‡è¦çš„æ¶ˆæ¯ï¼Œä¸¥é‡é™ä½ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒã€‚æ‰€ä»¥ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºâ€œæ¶ˆæ¯æœªè¯»æ•°â€åœ¨æ•´ä¸ªæ¶ˆæ¯è§¦è¾¾ç”¨æˆ·è·¯å¾„ä¸­çš„é‡è¦åœ°ä½ã€‚</p><h2>æ¶ˆæ¯å’Œæœªè¯»ä¸ä¸€è‡´çš„åŸå› </h2><p>é‚£ä¹ˆåœ¨å³æ—¶æ¶ˆæ¯åœºæ™¯ä¸­ï¼Œç©¶ç«Ÿä¼šæœ‰å“ªäº›æƒ…å†µå¯¼è‡´æ¶ˆæ¯å’Œæœªè¯»æ•°å‡ºç°â€œä¸ä¸€è‡´â€çš„æƒ…å†µå‘¢ï¼Ÿè¦ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ä¸¤ä¸ªæ¶‰åŠæœªè¯»æ•°çš„æ¦‚å¿µï¼šâ€œæ€»æœªè¯»â€ä¸â€œä¼šè¯æœªè¯»â€ã€‚æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹ä»¥ä¸‹ä¸¤ä¸ªæ¦‚å¿µã€‚</p><!-- [[[read_end]]] --><ul>\n<li>\n<p><strong>ä¼šè¯æœªè¯»ï¼š</strong>å½“å‰ç”¨æˆ·å’ŒæŸä¸€ä¸ªèŠå¤©æ–¹çš„æœªè¯»æ¶ˆæ¯æ•°ã€‚æ¯”å¦‚ç”¨æˆ·Aæ”¶åˆ°äº†ç”¨æˆ·Bçš„2æ¡æ¶ˆæ¯ï¼Œè¿™æ—¶ï¼Œå¯¹äºç”¨æˆ·Aæ¥è¯´ï¼Œä»–å’Œç”¨æˆ·Bçš„ä¼šè¯æœªè¯»å°±æ˜¯â€œ2â€ï¼Œå½“ç”¨æˆ·Aæ‰“å¼€å’Œç”¨æˆ·Bçš„èŠå¤©å¯¹è¯é¡µæŸ¥çœ‹è¿™ä¸¤æ¡æ¶ˆæ¯æ—¶ï¼Œå¯¹äºç”¨æˆ·Aæ¥è¯´ï¼Œä»–å’Œç”¨æˆ·Bçš„ä¼šè¯æœªè¯»å°±å˜æˆ0äº†ã€‚å¯¹äºç¾¤èŠæˆ–è€…ç›´æ’­é—´æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Œä¼šè¯æœªè¯»çš„å¯¹ç«¯åªä¸è¿‡æ˜¯ä¸€ä¸ªç¾¤æˆ–è€…ä¸€ä¸ªæˆ¿é—´ã€‚</p>\n</li>\n<li>\n<p><strong>æ€»æœªè¯»ï¼š</strong>å½“å‰ç”¨æˆ·çš„æ‰€æœ‰æœªè¯»æ¶ˆæ¯æ•°ï¼Œè¿™ä¸ªä¸éš¾ç†è§£ï¼Œæ€»æœªè¯»å…¶å®å°±æ˜¯æ‰€æœ‰ä¼šè¯æœªè¯»çš„å’Œã€‚æ¯”å¦‚ç”¨æˆ·Aé™¤äº†æ”¶åˆ°ç”¨æˆ·Bçš„2æ¡æ¶ˆæ¯ï¼Œè¿˜æ”¶åˆ°äº†ç”¨æˆ·Cçš„3æ¡æ¶ˆæ¯ã€‚é‚£ä¹ˆï¼Œå¯¹äºç”¨æˆ·Aæ¥è¯´ï¼Œæ€»æœªè¯»å°±æ˜¯â€œ5â€ã€‚å¦‚æœç”¨æˆ·æŸ¥çœ‹äº†ç”¨æˆ·Bå‘ç»™ä»–çš„2æ¡æ¶ˆæ¯ï¼Œè¿™æ—¶ç”¨æˆ·Açš„æ€»æœªè¯»å°±å˜æˆäº†â€œ3â€ã€‚</p>\n</li>\n</ul><p>ä»ä¸Šé¢çš„æ¦‚å¿µæˆ‘ä»¬çŸ¥é“ï¼Œå®é™…ä¸Šæ€»æœªè¯»æ•°å°±æ˜¯æ‰€æœ‰ä¼šè¯æœªè¯»æ•°çš„æ€»å’Œï¼Œé‚£ä¹ˆï¼Œåœ¨å®ç°ä¸Šæ˜¯ä¸æ˜¯åªéœ€è¦ç»™æ¯ä¸ªç”¨æˆ·ç»´æŠ¤ä¸€å¥—ä¼šè¯æœªè¯»å°±å¯ä»¥äº†å‘¢ï¼Ÿ</p><h3>ä¼šè¯æœªè¯»å’Œæ€»æœªè¯»å•ç‹¬ç»´æŠ¤</h3><p>ç†è®ºä¸Šæ˜¯å¯ä»¥çš„ã€‚ä½†åœ¨å¾ˆå¤šå³æ—¶æ¶ˆæ¯çš„â€œæœªè¯»æ•°â€å®ç°ä¸­ï¼Œä¼šè¯æœªè¯»æ•°å’Œæ€»æœªè¯»æ•°ä¸€èˆ¬éƒ½æ˜¯å•ç‹¬ç»´æŠ¤çš„ã€‚</p><p>åŸå› åœ¨äºâ€œæ€»æœªè¯»â€åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯é‡Œä¼šè¢«é«˜é¢‘ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯æ¬¡æ¶ˆæ¯æ¨é€éœ€è¦æŠŠæ€»æœªè¯»å¸¦ä¸Šç”¨äºè§’æ ‡æœªè¯»å±•ç¤ºã€‚</p><p>å¦å¤–ï¼Œæœ‰äº›Appå†…ä¼šé€šè¿‡å®šæ—¶è½®è¯¢çš„æ–¹å¼æ¥åŒæ­¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ€»æœªè¯»æ•°ï¼Œæ¯”å¦‚å¾®åšçš„æ¶ˆæ¯æ æ€»æœªè¯»ä¸ä»…åŒ…æ‹¬å³æ—¶æ¶ˆæ¯ç›¸å…³çš„æ¶ˆæ¯æ•°ï¼Œè¿˜åŒ…æ‹¬å…¶ä»–ä¸€äº›ä¸šåŠ¡é€šçŸ¥çš„æœªè¯»æ•°ï¼Œæ‰€ä»¥é€šè¿‡æ¶ˆæ¯æ¨é€åˆ°è¾¾åçš„ç´¯åŠ æ¥è®¡ç®—æ€»æœªè¯»ï¼Œå¹¶ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œè€Œæ˜¯æ¢äº†å¦å¤–ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡è½®è¯¢æ¥åŒæ­¥æ€»æœªè¯»ã€‚</p><p>å¯¹äºé«˜é¢‘ä½¿ç”¨çš„â€œæ€»æœªè¯»â€ï¼Œå¦‚æœæ¯æ¬¡éƒ½é€šè¿‡èšåˆæ‰€æœ‰ä¼šè¯æœªè¯»æ¥è·å–ï¼Œç”¨æˆ·çš„äº’åŠ¨ä¼šè¯ä¸å¤šçš„è¯ï¼Œæ€§èƒ½è¿˜å¯ä»¥ä¿è¯ï¼›ä¸€æ—¦ä¼šè¯æ•°æ¯”è¾ƒå¤šï¼Œç”±äºéœ€è¦å¤šæ¬¡ä»å­˜å‚¨è·å–ï¼Œå®¹æ˜“å‡ºç°æŸäº›ä¼šè¯æœªè¯»ç”±äºè¶…æ—¶ç­‰åŸå› æ²¡å–åˆ°ï¼Œå¯¼è‡´æ€»æœªè¯»æ•°è®¡ç®—å°‘äº†ã€‚</p><p>è€Œä¸”ï¼Œå¤šæ¬¡è·å–ç´¯åŠ çš„æ“ä½œåœ¨æ€§èƒ½ä¸Šæ¯”è¾ƒå®¹æ˜“å‡ºç°ç“¶é¢ˆã€‚æ‰€ä»¥ï¼Œå‡ºäºä»¥ä¸Šè€ƒè™‘ï¼Œæ€»æœªè¯»æ•°å’Œä¼šè¯æœªè¯»æ•°ä¸€èˆ¬æ˜¯å•ç‹¬ç»´æŠ¤çš„ã€‚</p><h3>æœªè¯»æ•°çš„ä¸€è‡´æ€§é—®é¢˜</h3><p>å•ç‹¬ç»´æŠ¤æ€»æœªè¯»å’Œä¼šè¯æœªè¯»èƒ½è§£å†³æ€»æœªè¯»è¢«â€œé«˜é¢‘â€è®¿é—®çš„æ€§èƒ½é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼šæœªè¯»æ•°çš„ä¸€è‡´æ€§ã€‚</p><p>æœªè¯»æ•°ä¸€è‡´æ€§æ˜¯æŒ‡ï¼š<strong>ç»´æŠ¤çš„æ€»æœªè¯»æ•°å’Œä¼šè¯æœªè¯»æ•°çš„æ€»å’Œè¦ä¿æŒä¸€è‡´</strong>ã€‚å¦‚æœä¸¤ä¸ªæœªè¯»æ•°ä¸èƒ½ä¿æŒä¸€è‡´ï¼Œå°±ä¼šå‡ºç°â€œæ”¶åˆ°æ–°æ¶ˆæ¯ï¼Œä½†è§’æ ‡å’ŒAppé‡Œçš„æ¶ˆæ¯æ æ²¡æœ‰æœªè¯»æé†’â€ï¼Œæˆ–è€…â€œæœ‰æœªè¯»æé†’ï¼Œç‚¹è¿›å»æ‰¾ä¸åˆ°æ˜¯å“ªä¸ªä¼šè¯æœ‰æ–°æ¶ˆæ¯â€çš„æƒ…å†µã€‚</p><p>è¿™ä¸¤ç§å¼‚å¸¸æƒ…å†µéƒ½æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚é‚£ä¹ˆè¿™äº›å¼‚å¸¸æƒ…å†µç©¶ç«Ÿæ˜¯æ€ä¹ˆå‡ºç°çš„å‘¢ï¼Ÿ</p><p><strong>æˆ‘ä»¬æ¥çœ‹çœ‹æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªï¼š</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/1c/c5/1c65a1af8589c1b4f6e84173c6bca1c5.png?wh=1024*768\" alt=\"\"></p><p>ç”¨æˆ·Aç»™ç”¨æˆ·Bå‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·Bçš„åˆå§‹æœªè¯»çŠ¶æ€æ˜¯ï¼šå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»æ˜¯0ï¼Œæ€»æœªè¯»ä¹Ÿæ˜¯0ã€‚</p><p>æ¶ˆæ¯åˆ°è¾¾IMæœåŠ¡åï¼Œæ‰§è¡ŒåŠ æœªè¯»æ“ä½œï¼šå…ˆæŠŠç”¨æˆ·Bå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»åŠ 1ï¼Œå†æŠŠç”¨æˆ·Bçš„æ€»æœªè¯»åŠ 1ã€‚</p><p>å‡è®¾åŠ æœªè¯»æ“ä½œç¬¬ä¸€æ­¥æˆåŠŸäº†ï¼Œç¬¬äºŒæ­¥å¤±è´¥ã€‚æœ€åIMæœåŠ¡æŠŠæ¶ˆæ¯æ¨é€ç»™ç”¨æˆ·Bã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·Bçš„æœªè¯»çŠ¶æ€æ˜¯ï¼šå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»æ˜¯1ï¼Œæ€»æœªè¯»æ˜¯0ã€‚</p><p>è¿™æ ·ï¼Œç”±äºåŠ æœªè¯»ç¬¬äºŒæ­¥æ‰§è¡Œå¤±è´¥å¯¼è‡´çš„åæœæ˜¯ï¼šç”¨æˆ·Bä¸çŸ¥é“æ”¶åˆ°äº†ä¸€æ¡æ–°æ¶ˆæ¯çš„æƒ…å†µï¼Œä»è€Œå¯èƒ½æ¼æ‰æŸ¥çœ‹è¿™æ¡æ¶ˆæ¯ã€‚</p><p>é‚£ä¹ˆæ¡ˆä¾‹æ˜¯ç”±äºåœ¨åŠ æœªè¯»çš„ç¬¬äºŒæ­¥â€œåŠ æ€»æœªè¯»â€çš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´æœªè¯»å’Œæ¶ˆæ¯ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯åªè¦åŠ æœªè¯»æ“ä½œéƒ½æ­£å¸¸æ‰§è¡Œå°±æ²¡æœ‰é—®é¢˜äº†å‘¢ï¼Ÿ<strong>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹ç¬¬äºŒä¸ªæ¡ˆä¾‹ã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/fa/42/fa303ab3ddf0aba4baf2e0630a8a5542.png?wh=1024*768\" alt=\"\"></p><p>ç”¨æˆ·Aç»™ç”¨æˆ·Bå‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·Bçš„åˆå§‹æœªè¯»çŠ¶æ€æ˜¯ï¼šå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»æ˜¯0ï¼Œæ€»æœªè¯»ä¹Ÿæ˜¯0ã€‚</p><p>æ¶ˆæ¯åˆ°è¾¾IMæœåŠ¡åï¼Œæ‰§è¡ŒåŠ æœªè¯»æ“ä½œï¼šå…ˆæ‰§è¡ŒåŠ æœªè¯»çš„ç¬¬ä¸€æ­¥ï¼ŒæŠŠç”¨æˆ·Bå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»åŠ 1ã€‚</p><p>è¿™æ—¶æ‰§è¡ŒåŠ æœªè¯»æ“ä½œçš„æœåŠ¡å™¨ç”±äºæŸäº›åŸå› å˜æ…¢äº†ï¼Œæ°å¥½è¿™æ—¶ç”¨æˆ·Båœ¨Appä¸Šç‚¹å‡»æŸ¥çœ‹å’Œç”¨æˆ·Açš„èŠå¤©ä¼šè¯ï¼Œä»è€Œè§¦å‘äº†æ¸…æœªè¯»æ“ä½œã€‚</p><p>æ‰§è¡Œæ¸…æœªè¯»ç¬¬ä¸€æ­¥ï¼ŒæŠŠç”¨æˆ·Bå’Œç”¨æˆ·Açš„ä¼šè¯æœªè¯»æ¸…0ï¼Œç„¶åç»§ç»­æ‰§è¡Œæ¸…æœªè¯»ç¬¬äºŒæ­¥ï¼ŒæŠŠç”¨æˆ·Bçš„æ€»æœªè¯»ä¹Ÿæ¸…0ã€‚</p><p>æ¸…æœªè¯»çš„æ“ä½œéƒ½æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡ŒåŠ æœªè¯»æ“ä½œçš„æœåŠ¡å™¨æ‰ç»§ç»­æ¢å¤æ‰§è¡ŒåŠ æœªè¯»çš„ç¬¬äºŒæ­¥ï¼ŒæŠŠç”¨æˆ·Bçš„æ€»æœªè¯»åŠ 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†ä¸¤ä¸ªæœªè¯»ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>å¯¼è‡´çš„åæœæ˜¯ï¼šç”¨æˆ·Bé€€å‡ºä¼šè¯åï¼Œçœ‹åˆ°æœ‰ä¸€æ¡æœªè¯»æ¶ˆæ¯ï¼Œä½†æ˜¯ç‚¹è¿›å»å´æ‰¾ä¸åˆ°æ˜¯å“ªä¸ªèŠå¤©ä¼šè¯æœ‰æœªè¯»æ¶ˆæ¯ã€‚</p><p><strong>è¿™é‡Œï¼Œæˆ‘æ¥åˆ†æä¸€ä¸‹è¿™ä¸¤ç§ä¸ä¸€è‡´çš„æ¡ˆä¾‹åŸå› ï¼šå…¶å®éƒ½æ˜¯å› ä¸ºä¸¤ä¸ªæœªè¯»çš„å˜æ›´ä¸æ˜¯åŸå­æ€§çš„ï¼Œä¼šå‡ºç°æŸä¸€ä¸ªæˆåŠŸå¦ä¸€ä¸ªå¤±è´¥çš„æƒ…å†µï¼Œä¹Ÿä¼šå‡ºç°ç”±äºå¹¶å‘æ›´æ–°å¯¼è‡´æ“ä½œè¢«è¦†ç›–çš„æƒ…å†µã€‚æ‰€ä»¥è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œéœ€è¦ä¿è¯ä¸¤ä¸ªæœªè¯»æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚</strong></p><h2>ä¿è¯æœªè¯»æ›´æ–°çš„åŸå­æ€§</h2><p>é‚£ä¹ˆï¼Œåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸¤ä¸ªæœªè¯»çš„â€œåŸå­æ›´æ–°â€å‘¢ï¼Ÿä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸€ä¸ªåˆ†å¸ƒå¼é”æ¥è§£å†³ï¼Œæ¯æ¬¡ä¿®æ”¹å‰å…ˆåŠ é”ï¼Œéƒ½å˜æ›´å®Œåå†è§£å¼€ã€‚</p><h3>åˆ†å¸ƒå¼é”</h3><p>åˆ†å¸ƒå¼é”çš„å®ç°æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼Œä¾èµ–DBçš„å”¯ä¸€æ€§ã€çº¦æŸæ¥é€šè¿‡æŸä¸€æ¡å›ºå®šè®°å½•çš„æ’å…¥æˆåŠŸä¸å¦ï¼Œæ¥åˆ¤æ–­é”çš„è·å–ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›åˆ†å¸ƒå¼ç¼“å­˜æ¥å®ç°ï¼Œæ¯”å¦‚MCçš„addã€æ¯”å¦‚Redisçš„setNXç­‰ã€‚å…·ä½“å®ç°æœºåˆ¶ï¼Œæˆ‘è¿™é‡Œå°±ä¸ç»†è®²äº†ï¼Œåœ¨æˆ‘ä»¬çš„å®æˆ˜è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæœ‰ç›¸åº”çš„ä»£ç ä½“ç°ã€‚</p><p>ä¸è¿‡ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œåˆ†å¸ƒå¼é”ä¹Ÿå­˜åœ¨å®ƒè‡ªå·±çš„é—®é¢˜ã€‚ç”±äºéœ€è¦å¢åŠ ä¸€å¥—æ–°çš„èµ„æºè®¿é—®é€»è¾‘ï¼Œé”çš„å¼•å…¥ä¼šé™ä½ååï¼›åŒæ—¶å¯¹é”çš„ç®¡ç†å’Œå¼‚å¸¸çš„å¤„ç†å®¹æ˜“å‡ºç°Bugï¼Œæ¯”å¦‚éœ€è¦èµ„æºçš„å•ç‚¹é—®é¢˜ã€éœ€è¦è€ƒè™‘å®•æœºæƒ…å†µä¸‹å¦‚ä½•ä¿è¯é”æœ€ç»ˆèƒ½é‡Šæ”¾ã€‚</p><h3>æ”¯æŒäº‹åŠ¡åŠŸèƒ½çš„èµ„æº</h3><p>é™¤äº†åˆ†å¸ƒå¼é”å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€äº›æ”¯æŒäº‹åŠ¡åŠŸèƒ½çš„èµ„æºï¼Œæ¥ä¿è¯ä¸¤ä¸ªæœªè¯»çš„æ›´æ–°åŸå­æ€§ã€‚</p><p>äº‹åŠ¡æä¾›äº†ä¸€ç§â€œå°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œç„¶åä¸€æ¬¡æ€§æŒ‰é¡ºåºåœ°æ‰§è¡Œâ€çš„æœºåˆ¶ï¼Œå¹¶ä¸”äº‹åŠ¡åœ¨æ‰§è¡Œçš„æœŸé—´ä¸ä¼šä¸»åŠ¨ä¸­æ–­ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¹‹åï¼Œæ‰ä¼šç»§ç»­å¤„ç†å…¶ä»–å®¢æˆ·ç«¯çš„å…¶ä»–å‘½ä»¤ã€‚</p><p>æ¯”å¦‚ï¼šRedisé€šè¿‡ MULTIã€DISCARD ã€EXECå’ŒWATCHå››ä¸ªå‘½ä»¤æ¥æ”¯æŒäº‹åŠ¡æ“ä½œã€‚</p><p>æ¯”å¦‚æ¯æ¬¡å˜æ›´æœªè¯»å‰å…ˆwatchè¦ä¿®æ”¹çš„keyï¼Œç„¶åäº‹åŠ¡æ‰§è¡Œå˜æ›´ä¼šè¯æœªè¯»å’Œå˜æ›´æ€»æœªè¯»çš„æ“ä½œï¼Œå¦‚æœåœ¨æœ€ç»ˆæ‰§è¡Œäº‹åŠ¡æ—¶è¢«watchçš„ä¸¤ä¸ªæœªè¯»çš„keyçš„å€¼å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œé‚£ä¹ˆæœ¬æ¬¡äº‹åŠ¡ä¼šå¤±è´¥ï¼Œä¸šåŠ¡å±‚è¿˜å¯ä»¥ç»§ç»­é‡è¯•ç›´åˆ°äº‹åŠ¡å˜æ›´æˆåŠŸã€‚</p><p>ä¾æ‰˜Redisè¿™ç§æ”¯æŒäº‹åŠ¡åŠŸèƒ½çš„èµ„æºï¼Œå¦‚æœæœªè¯»æ•°æœ¬èº«å°±å­˜åœ¨è¿™ä¸ªèµ„æºé‡Œï¼Œæ˜¯èƒ½æ¯”è¾ƒç®€å•åœ°åšåˆ°ä¸¤ä¸ªæœªè¯»æ•°â€œåŸå­å˜æ›´â€çš„ã€‚</p><p>ä½†è¿™ä¸ªæ–¹æ¡ˆåœ¨æ€§èƒ½ä¸Šè¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼Œç”±äºwatchæ“ä½œå®é™…æ˜¯ä¸€ä¸ªä¹è§‚é”ç­–ç•¥ï¼Œå¯¹äºæœªè¯»å˜æ›´è¾ƒé¢‘ç¹çš„åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªå¾ˆç«çš„ç¾¤é‡Œå¤§å®¶å‘è¨€å¾ˆé¢‘ç¹ï¼‰ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡é‡è¯•æ‰å¯ä»¥æœ€ç»ˆæ‰§è¡ŒæˆåŠŸï¼Œè¿™ç§æƒ…å†µä¸‹æ‰§è¡Œæ•ˆç‡ä½ï¼Œæ€§èƒ½ä¸Šä¹Ÿä¼šæ¯”è¾ƒå·®ã€‚</p><h3>åŸå­åŒ–åµŒå…¥è„šæœ¬</h3><p>é‚£ä¹ˆæœ‰æ²¡æœ‰æ€§èƒ½ä¸é”™è¿˜èƒ½æ”¯æŒâ€œåŸå­å˜æ›´â€çš„æ–¹æ¡ˆå‘¢ï¼Ÿ</p><p>å…¶å®åœ¨å¾ˆå¤šèµ„æºçš„ç‰¹æ€§ä¸­ï¼Œéƒ½æ”¯æŒâ€œåŸå­åŒ–çš„åµŒå…¥è„šæœ¬â€æ¥æ»¡è¶³ä¸šåŠ¡ä¸Šå¯¹å¤šæ¡è®°å½•å˜æ›´é«˜ä¸€è‡´æ€§çš„éœ€æ±‚ã€‚Rediså°±æ”¯æŒé€šè¿‡åµŒå…¥Luaè„šæœ¬æ¥åŸå­åŒ–æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Luaè„šæœ¬ä¸­å®ç°æ€»æœªè¯»å’Œä¼šè¯æœªè¯»çš„åŸå­åŒ–å˜æ›´ï¼Œè€Œä¸”è¿˜èƒ½å®ç°ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æœªè¯»å˜æ›´é€»è¾‘ã€‚</p><p>æ¯”å¦‚ï¼Œæœ‰çš„æœªè¯»æ•°æˆ‘ä»¬ä¸å¸Œæœ›ä¸€ç›´å­˜åœ¨è€Œå¹²æ‰°åˆ°ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·7å¤©æ²¡æœ‰æŸ¥çœ‹æ¸…é™¤æœªè¯»ï¼Œè¿™ä¸ªæœªè¯»å¯ä»¥è¿‡æœŸå¤±æ•ˆï¼Œè¿™ç§ä¸šåŠ¡é€»è¾‘å°±æ¯”è¾ƒæ–¹ä¾¿åœ°ä½¿ç”¨Luaè„šæœ¬æ¥å®ç°â€œè¯»æ—¶åˆ¤æ–­è¿‡æœŸå¹¶æ¸…é™¤â€ã€‚</p><p>åŸå­åŒ–åµŒå…¥è„šæœ¬ä¸ä»…å¯ä»¥åœ¨å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘çš„åŸºç¡€ä¸Šï¼Œæ¥æä¾›åŸå­åŒ–çš„ä¿éšœï¼Œç›¸å¯¹äºå‰é¢åˆ†å¸ƒå¼é”å’Œwatchäº‹åŠ¡çš„æ–¹æ¡ˆï¼Œåœ¨æ‰§è¡Œæ€§èƒ½ä¸Šä¹Ÿæ›´èƒœä¸€ç­¹ã€‚</p><p>ä¸è¿‡è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºRedisæœ¬èº«æ˜¯æœåŠ¡ç«¯å•çº¿ç¨‹æ¨¡å‹ï¼ŒLuaè„šæœ¬ä¸­å°½é‡ä¸è¦æœ‰è¿œç¨‹è®¿é—®å’Œå…¶ä»–è€—æ—¶çš„æ“ä½œï¼Œä»¥å…é•¿æ—¶é—´æ‚¬æŒ‚ï¼ˆHangï¼‰ä½ï¼Œå¯¼è‡´æ•´ä¸ªèµ„æºä¸å¯ç”¨ã€‚</p><h2>å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä»¬å…ˆäº†è§£äº†æœªè¯»æ•°åœ¨å³æ—¶æ¶ˆæ¯åœºæ™¯ä¸­çš„é‡è¦æ€§ï¼Œç„¶ååˆ†æäº†é€ æˆæœªè¯»æ•°å’Œæ¶ˆæ¯ä¸ä¸€è‡´çš„åŸå› ï¼ŒåŸå› ä¸»è¦åœ¨äºï¼šâ€œæ€»æœªè¯»æ•°â€å’Œâ€œä¼šè¯æœªè¯»æ•°â€åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯ä¸­éœ€è¦èƒ½å¤Ÿç‹¬ç«‹ç»´æŠ¤ï¼Œä½†ä¸¤ä¸ªæœªè¯»æ•°çš„å˜æ›´å­˜åœ¨æˆåŠŸç‡ä¸ä¸€è‡´å’Œå¹¶å‘åœºæ™¯ä¸‹äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¢è®¨äº†å‡ ç§ä¿è¯æœªè¯»æ•°åŸå­åŒ–å˜æ›´çš„æ–¹æ¡ˆï¼Œä»¥åŠæ·±å…¥åˆ†æäº†æ¯ç§æ–¹æ¡ˆå„è‡ªçš„ä¼˜åŠ£ï¼Œä¸‰ç§æ–¹æ¡ˆåˆ†åˆ«ä¸ºï¼š</p><ul>\n<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼Œå…·å¤‡è¾ƒå¥½æ™®é€‚æ€§ï¼Œä½†æ‰§è¡Œæ•ˆç‡è¾ƒå·®ï¼Œé”çš„ç®¡ç†ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œé€‚ç”¨äºè¾ƒå°è§„æ¨¡çš„å³æ—¶æ¶ˆæ¯åœºæ™¯ï¼›</li>\n<li><strong>æ”¯æŒäº‹åŠ¡åŠŸèƒ½çš„èµ„æº</strong>ï¼Œä¸éœ€è¦é¢å¤–çš„ç»´æŠ¤é”çš„èµ„æºï¼Œå®ç°è¾ƒä¸ºç®€å•ï¼Œä½†åŸºäºä¹è§‚é”çš„watchæœºåˆ¶åœ¨è¾ƒé«˜å¹¶å‘åœºæ™¯ä¸‹å¤±è´¥ç‡è¾ƒé«˜ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒå®¹æ˜“å‡ºç°ç“¶é¢ˆï¼›</li>\n<li><strong>åŸå­åŒ–åµŒå…¥è„šæœ¬</strong>ï¼Œä¸éœ€è¦é¢å¤–çš„ç»´æŠ¤é”çš„èµ„æºï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½ä¹Ÿè¾ƒå¥½ï¼ŒåµŒå…¥è„šæœ¬çš„å¼€å‘éœ€è¦ä¸€äº›é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚</li>\n</ul><p>è¿™ä¸€ç¯‡æˆ‘ä»¬è®²åˆ°çš„å†…å®¹ï¼Œç®€å•æ¥çœ‹åªæ˜¯æ¶ˆæ¯æœªè¯»æ•°ä¸ä¸€è‡´çš„åœºæ™¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç«™åœ¨å®è§‚è§†è§’ä¸‹ï¼Œä¸éš¾çœ‹å‡ºåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå¹¶å‘æ›´æ–°çš„é—®é¢˜ã€‚</p><p>ä¸ç®¡æ˜¯åˆ†å¸ƒå¼é”ã€è¿˜æ˜¯æ”¯æŒäº‹åŠ¡åŠŸèƒ½çš„èµ„æºï¼Œä»¥åŠæˆ‘ä»¬æœ€åè®²åˆ°çš„åŸå­åŒ–çš„åµŒå…¥è„šæœ¬ï¼Œå…¶å®ä¸ä»…ä»…å¯ä»¥ç”¨æ¥è§£å†³æœªè¯»æ•°çš„é—®é¢˜ï¼Œå¯¹äºé€šç”¨çš„åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ¶‰åŠçš„éœ€è¦ä¿è¯å¤šä¸ªæ“ä½œçš„åŸå­æ€§æˆ–è€…äº‹åŠ¡æ€§çš„æ—¶å€™ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥ä½œä¸ºå¯é€‰æ–¹æ¡ˆæ¥è€ƒè™‘çš„ã€‚</p><p>æœ€åç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ï¼š<strong>ç±»ä¼¼Redis+Luaçš„åŸå­åŒ–åµŒå…¥è„šæœ¬çš„æ–¹å¼ï¼Œæ˜¯å¦çœŸçš„èƒ½å¤Ÿåšåˆ°â€œä¸‡æ— ä¸€å¤±â€çš„å˜æ›´ä¸€è‡´æ€§ï¼Ÿæ¯”å¦‚ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æœºå™¨æ‰ç”µä¼šå‡ºç°é—®é¢˜å—ï¼Ÿ</strong></p><p>ä½ å¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼Œæ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§ã€‚</p>","neighbors":{"left":{"article_title":"06 | HttpDNSå’ŒTLSï¼šä½ çš„æ¶ˆæ¯èŠå¤©çœŸçš„å®‰å…¨å—ï¼Ÿ","id":132434},"right":{"article_title":"08 | æ™ºèƒ½å¿ƒè·³æœºåˆ¶ï¼šè§£å†³ç½‘ç»œçš„ä¸ç¡®å®šæ€§","id":134231}},"comments":[{"had_liked":false,"id":137256,"user_name":"Darcy","can_delete":false,"product_type":"c1","uid":1677627,"ip_address":"","ucode":"3A78522A550376","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0wpUDw5m0LRvdDueia3uMWqKbTXqNJwYQjwXWN9dC2LLdKpbib98knPlWOQROslLPN11bvqLI1BicdFwoGiaSRLaMA/132","comment_is_top":false,"comment_ctime":1569669477,"is_pvip":false,"replies":[{"id":"52865","content":"æ˜¯çš„ï¼Œå¯¹äºéœ€è¦ä½¿ç”¨luaçš„æ•°æ®éœ€è¦ç¡®ä¿ä¸¤ä¸ªkeyèƒ½hashåˆ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569806180,"ip_address":"","comment_id":137256,"utype":1}],"discussion_count":2,"race_medal":0,"score":"78879080805","product_id":100034901,"comment_content":"redis clusteré›†ç¾¤æ¨¡å¼luaè„šæœ¬å¦‚æœæ“ä½œçš„ä¸¤ä¸ªkeyä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¥½åƒä¼šæŠ¥å¼‚å¸¸","like_count":18,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469001,"discussion_content":"æ˜¯çš„ï¼Œå¯¹äºéœ€è¦ä½¿ç”¨luaçš„æ•°æ®éœ€è¦ç¡®ä¿ä¸¤ä¸ªkeyèƒ½hashåˆ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569806180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1220552,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9f/c8/0318c83e.jpg","nickname":"Geek_b617bf","note":"","ucode":"9BAFC3B184B1D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274326,"discussion_content":"å¯ä»¥é‡‡ç”¨{}çš„æ–¹å¼åŒ…è£¹keyï¼Œ{}é‡Œçš„å†…å®¹ä¸€æ ·çš„keyä¼šè½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590568510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132901,"user_name":"ç‹æ£•ç”Ÿ","can_delete":false,"product_type":"c1","uid":1337944,"ip_address":"","ucode":"901BD0447A871E","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/58/f2c6d65b.jpg","comment_is_top":false,"comment_ctime":1568266717,"is_pvip":false,"replies":[{"id":"50940","content":"æ€è·¯æ˜¯å¥½çš„å“ˆï¼Œä¸è¿‡å¾ˆå¤šæ—¶å€™ä¸ä»…ä»…æ˜¯ç”¨æˆ·ç™»å½•çš„æ—¶å€™æ‰éœ€è¦æ€»æœªè¯»ï¼Œæ¯”å¦‚æ¯æ¥ä¸€æ¡æ¶ˆæ¯éœ€è¦è¿›è¡Œç³»ç»Ÿæ¨é€æ—¶ï¼Œç”±äºè‹¹æœçš„APNsä¸æ”¯æŒè§’æ ‡æœªè¯»çš„ç´¯åŠ ï¼Œåªèƒ½æ¯æ¬¡è·å–æ€»æœªè¯»å¸¦ä¸‹å»ã€‚å¦å¤–ï¼Œå®¢æˆ·ç«¯ç»´æŠ¤æ€»æœªè¯»è¿™ä¸ªä¹Ÿéœ€è¦è€ƒè™‘æ¯”å¦‚ç¦»çº¿æ¶ˆæ¯å¤ªå¤šï¼Œéœ€è¦æ¨æ‹‰ç»“åˆè·å–æ—¶ï¼Œåˆ°è¾¾å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ•°ä¸ä¸€å®šæ˜¯çœŸæ­£çš„æœªè¯»æ¶ˆæ¯æ•°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568288274,"ip_address":"","comment_id":132901,"utype":1}],"discussion_count":1,"race_medal":0,"score":"61697808861","product_id":100034901,"comment_content":"å¯¹äºè€å¸ˆæœ¬èŠ‚è®²è¿°çš„æœªè¯»æ•°ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘æƒ³æ˜¯å¦å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥è§£å†³ï¼š<br>1  ç”¨æˆ·çš„æœªè¯»æ•°æ˜¯åœ¨ç”¨æˆ·ç¦»çº¿çš„æ—¶å€™ï¼Œå…¶ä»–ç”¨æˆ·ç»™ä»–å‘æ¶ˆæ¯çš„æ—¶å€™äº§ç”Ÿçš„ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦ç»´æŠ¤ç”¨æˆ·ä¼šè¯æœªè¯»æ•°å³å¯ï¼›<br>2  å½“ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œå‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°MQï¼Œç”±MQè§¦å‘ç»´æŠ¤ç”¨æˆ·æ€»çš„æœªè¯»æ•°çš„æ“ä½œï¼Œå³å°†ç”¨æˆ·æ‰€æœ‰çš„ä¼šè¯æœªè¯»æ•°ç›¸åŠ åçš„æ•°å€¼æ”¾å…¥æ€»æœªè¯»æ•°å­—æ®µä¸­ã€‚<br>      è¿™æ ·çš„è®¾è®¡çš„å¥½å¤„æ—¶ï¼Œé™ä½ç»´æŠ¤ç”¨æˆ·æ€»æœªè¯»æ•°çš„å‹åŠ›ï¼Œåªåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™è¿›è¡Œç»´æŠ¤å³å¯ï¼Œä¸ç”¨æ¯æ¬¡æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯å°±ç»´æŠ¤ä¸€æ¬¡ã€‚<br>      ç„¶åç”¨æˆ·åœ¨çº¿æœŸé—´ï¼Œæ”¶åˆ°çš„æ¶ˆæ¯çš„æœªè¯»æ•°ç”±å‰ç«¯æ¥è¿›è¡Œç»´æŠ¤ï¼Œä¸ç”¨æœåŠ¡ç«¯è¿›è¡Œæ“ä½œäº†ã€‚","like_count":14,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467167,"discussion_content":"æ€è·¯æ˜¯å¥½çš„å“ˆï¼Œä¸è¿‡å¾ˆå¤šæ—¶å€™ä¸ä»…ä»…æ˜¯ç”¨æˆ·ç™»å½•çš„æ—¶å€™æ‰éœ€è¦æ€»æœªè¯»ï¼Œæ¯”å¦‚æ¯æ¥ä¸€æ¡æ¶ˆæ¯éœ€è¦è¿›è¡Œç³»ç»Ÿæ¨é€æ—¶ï¼Œç”±äºè‹¹æœçš„APNsä¸æ”¯æŒè§’æ ‡æœªè¯»çš„ç´¯åŠ ï¼Œåªèƒ½æ¯æ¬¡è·å–æ€»æœªè¯»å¸¦ä¸‹å»ã€‚å¦å¤–ï¼Œå®¢æˆ·ç«¯ç»´æŠ¤æ€»æœªè¯»è¿™ä¸ªä¹Ÿéœ€è¦è€ƒè™‘æ¯”å¦‚ç¦»çº¿æ¶ˆæ¯å¤ªå¤šï¼Œéœ€è¦æ¨æ‹‰ç»“åˆè·å–æ—¶ï¼Œåˆ°è¾¾å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ•°ä¸ä¸€å®šæ˜¯çœŸæ­£çš„æœªè¯»æ¶ˆæ¯æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568288274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132488,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1568137217,"is_pvip":false,"replies":[{"id":"50849","content":"æ²¡å…³ç³»å“ˆï¼Œäº’ç›¸æ¢è®¨çš„è¿‡ç¨‹å¸Œæœ›å¤§å®¶ä¸è¦æ‹˜è°¨ã€‚æ­£å¦‚ä½ æ‰€è¯´ï¼Œredisåœ¨æ‰§è¡Œluaè„šæœ¬è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿæ‰ç”µï¼Œæ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸¤ä¸ªæœªè¯»ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºluaè„šæœ¬åœ¨redisä¸­çš„æ‰§è¡Œåªèƒ½ä¿è¯å¤šæ¡å‘½ä»¤ä¼šåŸå­æ‰§è¡Œï¼Œæ•´ä½“æ‰§è¡Œå®Œæˆæ‰ä¼šåŒæ­¥ç»™ä»åº“å¹¶å†™å…¥aofï¼Œæ‰€ä»¥å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µï¼Œä¼šç›´æ¥å¯¼è‡´è¢«ä¸­æ–­çš„åé¢éƒ¨åˆ†çš„è„šæœ¬å¾—ä¸åˆ°æ‰§è¡Œã€‚å½“ç„¶ï¼Œ å®é™…æƒ…å†µä¸­è¿™ç§æ¦‚ç‡éå¸¸å°ã€‚ä½œä¸ºå…œåº•çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æœªè¯»å˜æ›´æ—¶å¦‚æœä¼šè¯æ¯”è¾ƒå°‘ï¼Œå¯ä»¥è·å–ä¸€æ¬¡å…¨é‡çš„ä¼šè¯æœªè¯»æ¥è¦†ç›–æ€»æœªè¯»ï¼Œä»è€Œæœ‰æœºä¼šèƒ½å¾—åˆ°æœ€ç»ˆä¸€è‡´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568200012,"ip_address":"","comment_id":132488,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40222842881","product_id":100034901,"comment_content":"      Redisä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼šå…¶å®è€å¸ˆä»Šå¤©çš„é—®é¢˜å’Œå¦å¤–ä¸€ä¸ªé—®é¢˜æœ‰ç‚¹ç±»ä¼¼ï¼›æ—¢ç„¶é—®é¢˜æ˜¯&quot;æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µæ˜¯å¦ä¼šå‡ºç°é—®é¢˜&quot;è¿™ä¸ªæç«¯åœºæ™¯ï¼šé‚£ä¹ˆæˆ‘å°±ç”¨æç«¯åœºæ™¯è§£é‡Šï¼Œè€å¸ˆçœ‹çœ‹æ˜¯å¦æœ‰ç†æˆ–è€…å¯èƒ½å•Šã€‚<br>      æˆ‘çš„ç­”æ¡ˆæ˜¯ä¼šï¼šå°¤å…¶æ˜¯æç«¯åœºæ™¯ä¸‹ä¼šï¼Œè™½ç„¶æ¦‚å¿µå¾ˆå°ï¼›å…¶å®è€å¸ˆä»Šå¤©çš„é—®é¢˜æ˜¯æç¥è€å¸ˆçš„æ¶ˆæ¯é˜Ÿåˆ—è¯¾ç¨‹ä¸­å‰å‡ å¤©çš„æœŸä¸­è€ƒé¢˜ï¼Œ&quot;æ•°æ®å†™å…¥PageCacheåæœªåšåˆ·ç›˜ï¼Œé‚£ç§æƒ…å†µä¸‹æ•°æ®ä¼šä¸¢å¤±â€œå½“æ—¶çš„ç­”æ¡ˆå°±æ˜¯æ–­ç”µã€‚<br>     å…¶å®è€å¸ˆåœ¨ææ‰ç”µæ—¶ï¼šæœªæåŠä¸€ä¸ªå‰ææ¡ä»¶ï¼›æ‰ç”µåç¡¬ä»¶æ˜¯å¦æ­£å¸¸ï¼Ÿå¦‚æœæ‰ç”µåç¡¬ä»¶æŸåäº†å‘¢ï¼Œé‚£ä¹ˆæ•°æ®è‚¯å®šå°±ä¸¢å¤±äº†ï¼Œçº¿ä¸Šæœ€æ–°çš„æ•°æ®éƒ½æ²¡äº†ï¼Œæ•°æ®è‚¯å®šå°±ä¸¢äº†ã€‚å› ä¸ºé—®é¢˜æ˜¯æç«¯åœºæ™¯ï¼Œå›ç­”å°±åªèƒ½æ˜¯æç«¯åœºæ™¯ï¼Œå¸Œæœ›è€å¸ˆä¸ä»‹æ„ï¼›è¿™å°±åƒäº‘æœåŠ¡å™¨å‚å•†å‡ ä¹éƒ½ä¼šæŸä¸ªåŒºåŸŸå‡ºç°ä¸€æ¬¡äº‹æ•…ï¼ŒAmazeäº‘å·²ç»è¿ç»­å¤šå¹´æœ‰æ¬¡äº‹æƒ…ï¼Œå¼‚åœ°ç¾å¤‡åšçš„å¥½å½“ç„¶ä¸å—å½±å“ï¼›ä¸€æ—¦å¼‚åœ°ç¾å¤‡æ²¡åšç›´æ¥çš„åæœå°±æ˜¯æ•°æ®ä¸¢å¤±ï¼Œè¿™ç§äº‹æƒ…ç›¸ä¿¡è€å¸ˆè‡ªå·±åŒæ ·å¬åˆ°åŒè¡ŒæåŠæˆ–è€…è½¬è½½è¿‡ã€‚<br>   æ•…è€Œè¿™é“é¢˜ç›®çš„ç°å®åœºæ™¯éå¸¸é‡è¦ï¼šRedisçš„å¼‚åœ°å¤šå‰¯æœ¬åšäº†-å¯èƒ½ä¸ä¼šï¼›å¤šå‰¯æœ¬æ²¡åšä¸”ç¡¬ä»¶åˆšå¥½å› ä¸ºæ‰ç”µå¯¼è‡´å‡ºç°äº†æ— æ³•æ¢å¤çš„æŸå-è‚¯å®šä¸¢å¤±ã€‚è°¢è°¢è€å¸ˆçš„åˆ†äº«ã€‚","like_count":9,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466967,"discussion_content":"æ²¡å…³ç³»å“ˆï¼Œäº’ç›¸æ¢è®¨çš„è¿‡ç¨‹å¸Œæœ›å¤§å®¶ä¸è¦æ‹˜è°¨ã€‚æ­£å¦‚ä½ æ‰€è¯´ï¼Œredisåœ¨æ‰§è¡Œluaè„šæœ¬è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿæ‰ç”µï¼Œæ˜¯å¯èƒ½ä¼šå¯¼è‡´ä¸¤ä¸ªæœªè¯»ä¸ä¸€è‡´çš„ï¼Œå› ä¸ºluaè„šæœ¬åœ¨redisä¸­çš„æ‰§è¡Œåªèƒ½ä¿è¯å¤šæ¡å‘½ä»¤ä¼šåŸå­æ‰§è¡Œï¼Œæ•´ä½“æ‰§è¡Œå®Œæˆæ‰ä¼šåŒæ­¥ç»™ä»åº“å¹¶å†™å…¥aofï¼Œæ‰€ä»¥å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µï¼Œä¼šç›´æ¥å¯¼è‡´è¢«ä¸­æ–­çš„åé¢éƒ¨åˆ†çš„è„šæœ¬å¾—ä¸åˆ°æ‰§è¡Œã€‚å½“ç„¶ï¼Œ å®é™…æƒ…å†µä¸­è¿™ç§æ¦‚ç‡éå¸¸å°ã€‚ä½œä¸ºå…œåº•çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æœªè¯»å˜æ›´æ—¶å¦‚æœä¼šè¯æ¯”è¾ƒå°‘ï¼Œå¯ä»¥è·å–ä¸€æ¬¡å…¨é‡çš„ä¼šè¯æœªè¯»æ¥è¦†ç›–æ€»æœªè¯»ï¼Œä»è€Œæœ‰æœºä¼šèƒ½å¾—åˆ°æœ€ç»ˆä¸€è‡´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568200012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132512,"user_name":"é’¢","can_delete":false,"product_type":"c1","uid":1106184,"ip_address":"","ucode":"A49848BF63A579","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/08/3dc76043.jpg","comment_is_top":false,"comment_ctime":1568159319,"is_pvip":false,"replies":[{"id":"50850","content":"ç¤ºä¾‹æŒºå¤šçš„å“ˆï¼Œç»™ä¸€ä¸ªrediså®˜ç½‘çš„ä¾‹å­ï¼š<br><br>local current<br>current = redis.call(&quot;incr&quot;,KEYS[1])<br>if tonumber(current) == 1 then<br>    redis.call(&quot;expire&quot;,KEYS[1],1)<br>end<br>","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568200456,"ip_address":"","comment_id":132512,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31632930391","product_id":100034901,"comment_content":"åŸå­åŒ–åµŒå…¥å¼è„šæœ¬æœ‰ä¾‹å­ä»‹ç»å—","like_count":8,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466982,"discussion_content":"ç¤ºä¾‹æŒºå¤šçš„å“ˆï¼Œç»™ä¸€ä¸ªrediså®˜ç½‘çš„ä¾‹å­ï¼š\n\nlocal current\ncurrent = redis.call(&amp;quot;incr&amp;quot;,KEYS[1])\nif tonumber(current) == 1 then\n    redis.call(&amp;quot;expire&amp;quot;,KEYS[1],1)\nend\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568200456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132682,"user_name":"romantic_PK","can_delete":false,"product_type":"c1","uid":1645099,"ip_address":"","ucode":"F2F0113F98F5E0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/9X0Joj8QFUYwYKfCFGsgGdkDtXibBF5kOyTRsb1HWRyAm11vYVUvEl17ibgMOomSicNg5lLeLRFzINFZTvo3Wh9rA/132","comment_is_top":false,"comment_ctime":1568191096,"is_pvip":false,"replies":[{"id":"50856","content":"è¿™ä¸ªåº”è¯¥æ˜¯å®¢æˆ·ç«¯é€»è¾‘å“ˆï¼Œç‚¹å‡»æœªè¯»æ•°å®é™…ä¸Šæ˜¯æŠŠæœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯idå¸¦è¿›å»äº†ï¼Œç«¯ä¸Šåœ¨å·²æœ‰çš„æ¶ˆæ¯é‡ŒæŸ¥è¯¢è¿™æ¡æ¶ˆæ¯å°±å¯ä»¥äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€è¿‘è”ç³»äººéœ€è¦å¸¦ä¸Šæœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568201371,"ip_address":"","comment_id":132682,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10158125688","product_id":100034901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å®ç°å¾®ä¿¡æ‰“å¼€èŠå¤©çª—å£åï¼Œç‚¹å‡»æœªè¯»æ•°å®šä½åˆ°ç¬¬ä¸€æ¡æœªè¯»æ¶ˆæ¯çš„ä½ç½®ï¼Œè¯·æŒ‡ç‚¹è¿·æ´¥ï¼Œè°¢è°¢ã€‚","like_count":2,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467067,"discussion_content":"è¿™ä¸ªåº”è¯¥æ˜¯å®¢æˆ·ç«¯é€»è¾‘å“ˆï¼Œç‚¹å‡»æœªè¯»æ•°å®é™…ä¸Šæ˜¯æŠŠæœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯idå¸¦è¿›å»äº†ï¼Œç«¯ä¸Šåœ¨å·²æœ‰çš„æ¶ˆæ¯é‡ŒæŸ¥è¯¢è¿™æ¡æ¶ˆæ¯å°±å¯ä»¥äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€è¿‘è”ç³»äººéœ€è¦å¸¦ä¸Šæœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568201371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005030,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","nickname":"GeekAmI","note":"","ucode":"232C0B6DFB9F56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24240,"discussion_content":"åŒé—®ï¼Œè¿™ä¸ªå›ç­”æˆ‘ä¹Ÿæ²¡çœ‹æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570068699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111899,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/5b/d2e7c2c4.jpg","nickname":"æ—¶éšæ—¶ç°","note":"","ucode":"DA4D622FF84920","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23028,"discussion_content":"&#34;æŠŠæœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯idå¸¦è¿›å»äº†&#34;æœ‰ç‚¹æ²¡ç†è§£ï¼Œæ˜¯æ‰¾åˆ°æœ€è€çš„ä¸€æ¡æœªè¯»ä¿¡æ¯çš„ä½ç½®ï¼Œä¸ºä½•è¦ç”¨æœ€æ–°çš„1æ¡æ¶ˆæ¯IDï¼Œåº”è¯¥æ˜¯æœ€è€çš„æœªè¯»æ¶ˆæ¯IDå§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569743683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138232,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1570109832,"is_pvip":false,"replies":[{"id":"53276","content":"1. å…¶å®å°±æ˜¯æœ‰ä¸€äº›çº³å…¥åˆ°æ€»æœªè¯»é‡Œçš„æ¶ˆæ¯ä¸ä¸€å®šä¼šè¿›è¡Œæ¶ˆæ¯ä¸‹æ¨ã€‚<br>å®¢æˆ·ç«¯ç»Ÿè®¡æ€»æœªè¯»çš„æƒ…å†µå¦‚æœæ˜¯éœ€è¦å¤šç»ˆç«¯åŒæ­¥æˆ–è€…ç¦»çº¿æ¶ˆæ¯ä¸‹æ¨é‡‡ç”¨æ¨æ‹‰ç»“åˆçš„ï¼Œä¸ä¸€å®šä¼šè¯ä¼šè¯å°±æ˜¯å…¨é‡çš„ï¼Œè¿™ç§æƒ…å†µè®¡ç®—æ€»æœªè¯»å°±ä¼šæœ‰è¯¯å·®ã€‚<br>2. ä¸éœ€è¦è¿™ä¸ªå‰æï¼Œç†è®ºä¸Šåªéœ€è¦ä¼šè¯æœªè¯»å°±å¯ä»¥ä¿è¯å‡†ç¡®ï¼Œå¢åŠ æ€»æœªè¯»æ˜¯ä¸ºäº†æå‡è¯»å–æ€§èƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570275292,"ip_address":"","comment_id":138232,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5865077128","product_id":100034901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼Œè¯·æ•™ä¸€ä¸‹ã€‚<br><br>reï¼šæ¯”å¦‚å¾®åšçš„æ¶ˆæ¯æ æ€»æœªè¯»ä¸ä»…åŒ…æ‹¬å³æ—¶æ¶ˆæ¯ç›¸å…³çš„æ¶ˆæ¯æ•°ï¼Œè¿˜åŒ…æ‹¬å…¶ä»–ä¸€äº›ä¸šåŠ¡é€šçŸ¥çš„æœªè¯»æ•°ï¼Œæ‰€ä»¥é€šè¿‡æ¶ˆæ¯æ¨é€åˆ°è¾¾åçš„ç´¯åŠ æ¥è®¡ç®—æ€»æœªè¯»ï¼Œå¹¶ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œè€Œæ˜¯æ¢äº†å¦å¤–ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡è½®è¯¢æ¥åŒæ­¥æ€»æœªè¯»ã€‚<br><br>æ²¡å¤ªç†è§£ä¸Šé¢è¿™ä¸€å°æ®µï¼š<br>1. ä¸ºä»€ä¹ˆé€šè¿‡æ¶ˆæ¯æ¨é€åˆ°è¾¾ï¼Œï¼ˆè°ï¼Ÿï¼‰ç´¯åŠ è®¡ç®—æœªè¯»æ•°ï¼Œä¸æ˜¯å¾ˆå‡†ç¡®ï¼Ÿèƒ½ä¸¾ä¸ªä¾‹å­ä¹ˆï¼Ÿ<br><br>æ–‡ç« æåˆ°ï¼ŒæœåŠ¡ç«¯èšåˆæ‰€æœ‰ä¼šè¯æœªè¯»æ•°ï¼Œå¾—åˆ°æ€»æœªè¯»æ•°ï¼Œå­˜åœ¨ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œå¦‚è·å–æŸä¸ªä¼šè¯æœªè¯»æ•°å¤±è´¥æ—¶ã€‚<br><br>ä½†æ˜¯åœ¨å®¢æˆ·ç«¯ç»Ÿè®¡æ€»æœªè¯»æ•°ï¼Œè¿™æ—¶å®¢æˆ·ç«¯çš„ä¼šè¯æœªè¯»æ•°ï¼Œä¸åº”è¯¥æ˜¯å‡†ç¡®çš„ä¹ˆï¼Œä»è€Œæ‰€ç»Ÿè®¡çš„æ€»æœªè¯»æ•°ï¼Œä¹Ÿæ˜¯å‡†ç¡®çš„ï¼Ÿ<br><br>2. ä¸ºå•¥é€šè¿‡è½®è¯¢æ¥åŒæ­¥æ€»æœªè¯»æ˜¯å‡†ç¡®çš„ï¼Ÿè¿™ä¸ªå‡†ç¡®ï¼Œæ˜¯å¦éœ€è¦ä¸€ä¸ªå‰æï¼šä¼šè¯æœªè¯»å’Œæ€»æœªè¯»ï¼Œåœ¨æœåŠ¡ç«¯å•ç‹¬ç»´æŠ¤ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469445,"discussion_content":"1. å…¶å®å°±æ˜¯æœ‰ä¸€äº›çº³å…¥åˆ°æ€»æœªè¯»é‡Œçš„æ¶ˆæ¯ä¸ä¸€å®šä¼šè¿›è¡Œæ¶ˆæ¯ä¸‹æ¨ã€‚\nå®¢æˆ·ç«¯ç»Ÿè®¡æ€»æœªè¯»çš„æƒ…å†µå¦‚æœæ˜¯éœ€è¦å¤šç»ˆç«¯åŒæ­¥æˆ–è€…ç¦»çº¿æ¶ˆæ¯ä¸‹æ¨é‡‡ç”¨æ¨æ‹‰ç»“åˆçš„ï¼Œä¸ä¸€å®šä¼šè¯ä¼šè¯å°±æ˜¯å…¨é‡çš„ï¼Œè¿™ç§æƒ…å†µè®¡ç®—æ€»æœªè¯»å°±ä¼šæœ‰è¯¯å·®ã€‚\n2. ä¸éœ€è¦è¿™ä¸ªå‰æï¼Œç†è®ºä¸Šåªéœ€è¦ä¼šè¯æœªè¯»å°±å¯ä»¥ä¿è¯å‡†ç¡®ï¼Œå¢åŠ æ€»æœªè¯»æ˜¯ä¸ºäº†æå‡è¯»å–æ€§èƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570275292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132681,"user_name":"å°ç¥º","can_delete":false,"product_type":"c1","uid":1193548,"ip_address":"","ucode":"2819BCA9E71C9F","user_header":"https://static001.geekbang.org/account/avatar/00/12/36/4c/46c43cce.jpg","comment_is_top":false,"comment_ctime":1568190801,"is_pvip":false,"replies":[{"id":"50855","content":"åˆ†å¸ƒå¼é”éœ€è¦èƒ½æ‹¿åˆ°é”å°±èƒ½ä¿è¯åŒä¸€æ—¶é—´åªæœ‰æ‹¿åˆ°é”çš„è¿›ç¨‹æ‰è¡Œæ‰§è¡Œæ“ä½œï¼Œå› ä¸ºä¼šè¯æœªè¯»å’Œæ€»æœªè¯»å˜æ›´æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ‰€ä»¥ç†è®ºä¸Šæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„ã€‚ä½†å¦‚æœåƒä½ æ‰€è¯´ï¼Œç¬¬äºŒæ¡åŠ æœªè¯»çš„å‘½ä»¤ä¸€ç›´æ‰§è¡Œå¤±è´¥è¿˜æ˜¯ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸€ä¸ªæ˜¯é‡è¯•ï¼Œå¦å¤–å°±æ˜¯å›æ»šç¬¬ä¸€ä¸ªæ“ä½œã€‚<br><br>luaè„šæœ¬è¿™ä¸ªå¯ä»¥è€ƒè™‘åœ¨è„šæœ¬ä¸­å¢åŠ ä¸€äº›ä¿®å¤æœºåˆ¶ï¼Œæ¯”å¦‚ä¼šè¯æ•°æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹èšåˆä¸€æ¬¡æœªè¯»æ¥è¦†ç›–æ€»æœªè¯»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568201275,"ip_address":"","comment_id":132681,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5863158097","product_id":100034901,"comment_content":"é¦–å…ˆï¼Œå¦‚æœä¿®æ”¹â€œä¼šè¯æœªè¯»æ•°â€œå’Œâ€œæ€»æœªè¯»æ•°â€æ˜¯æ”¾åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­è‚¯å®šæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„ï¼Œä½†æ˜¯æ•°æ®åº“æ²¡æ³•æ»¡è¶³é«˜å¹¶å‘çš„éœ€æ±‚ï¼Œæ‰€ä»¥é€šå¸¸å¯ä»¥ä½¿ç”¨Redisæ¥è§£å†³é«˜å¹¶å‘é—®é¢˜ï¼Œä¸ºäº†ä¿è¯Rediså¤šæ¡å‘½ä»¤çš„åŸå­æ€§è€å¸ˆç»™å‡ºäº†3ä¸ªæ–¹æ¡ˆã€‚<br>åˆ†å¸ƒå¼é”ï¼šæˆ‘è®¤ä¸ºåˆ†å¸ƒå¼é”åªèƒ½è§£å†³å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºç¬¬ä¸€æ¡å‘½ä»¤æˆåŠŸç¬¬äºŒæ¡å‘½ä»¤å¤±è´¥çš„æƒ…å†µä¾ç„¶å¯èƒ½å‘ç”Ÿï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿåªèƒ½ä¸æ–­çš„é‡è¯•ç¬¬äºŒæ¡å‘½ä»¤å—ï¼Ÿ<br>watchæœºåˆ¶ï¼šä¸åˆ†å¸ƒå¼é”æœ‰æƒ³åŒçš„é—®é¢˜<br>luaè„šæœ¬æœºåˆ¶ï¼šç¡®å®æ˜¯åŸå­æ“ä½œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç”±äºredisä¸»ä»å¼‚æ­¥åŒæ­¥ï¼Œæ‰ç”µæ—¶slaveåœ¨æ²¡åŒæ­¥åˆ°æœ€æ–°æ•°æ®çš„æƒ…å†µä¸‹æå‡ä¸ºmasterï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½è¯»åˆ°é”™è¯¯çš„æœªè¯»æ•°ã€‚æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆå—ï¼Ÿ<br>è¯·è€å¸ˆåˆ†åˆ«è§£ç­”ä¸€ä¸‹","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467066,"discussion_content":"åˆ†å¸ƒå¼é”éœ€è¦èƒ½æ‹¿åˆ°é”å°±èƒ½ä¿è¯åŒä¸€æ—¶é—´åªæœ‰æ‹¿åˆ°é”çš„è¿›ç¨‹æ‰è¡Œæ‰§è¡Œæ“ä½œï¼Œå› ä¸ºä¼šè¯æœªè¯»å’Œæ€»æœªè¯»å˜æ›´æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ‰€ä»¥ç†è®ºä¸Šæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„ã€‚ä½†å¦‚æœåƒä½ æ‰€è¯´ï¼Œç¬¬äºŒæ¡åŠ æœªè¯»çš„å‘½ä»¤ä¸€ç›´æ‰§è¡Œå¤±è´¥è¿˜æ˜¯ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸€ä¸ªæ˜¯é‡è¯•ï¼Œå¦å¤–å°±æ˜¯å›æ»šç¬¬ä¸€ä¸ªæ“ä½œã€‚\n\nluaè„šæœ¬è¿™ä¸ªå¯ä»¥è€ƒè™‘åœ¨è„šæœ¬ä¸­å¢åŠ ä¸€äº›ä¿®å¤æœºåˆ¶ï¼Œæ¯”å¦‚ä¼šè¯æ•°æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹èšåˆä¸€æ¬¡æœªè¯»æ¥è¦†ç›–æ€»æœªè¯»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568201275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132554,"user_name":"å¤§é­”ç‹æ±ªæ±ª","can_delete":false,"product_type":"c1","uid":1010680,"ip_address":"","ucode":"4B205CB52FC95F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/f8/b4da7936.jpg","comment_is_top":false,"comment_ctime":1568165302,"is_pvip":false,"replies":[{"id":"50852","content":"bufferç¼“å†²å’Œå¼ºä¸€è‡´æ€§æœ¬èº«å°±æ˜¯ä¸¤ä¸ªæ¯”è¾ƒå¯¹ç«‹çš„æ¦‚å¿µï¼Œæ‰€ä»¥è¦åšåˆ°æ—¢èƒ½ç¼“å†²è¯·æ±‚é¢‘ç‡åˆä¿è¯å¼ºä¸€è‡´æ€§æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œå°½é‡è®©ä¸å®¹æ˜“å®•æœºçš„ä¸€æ–¹æ¥è¿›è¡Œbufferç¼“å†²ï¼Œæ¯”å¦‚ï¼šå¦‚æœæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½ç¼“å†²ï¼Œé‚£è¿˜æ˜¯è®©æœåŠ¡ç«¯æ¥ç¼“å†²å¯èƒ½æ¯”è¾ƒå¯é ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568200731,"ip_address":"","comment_id":132554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5863132598","product_id":100034901,"comment_content":"è€å¸ˆè¯·æ•™ä¸ªé—®é¢˜ï¼Œé’ˆå¯¹äºé«˜é¢‘ä¿®æ”¹åœºæ™¯ï¼Œé¢‘ç¹çš„ä¸€ä¸ªå­—æ®µçŠ¶æ€å˜æ›´ï¼Œä¸ºäº†è§£å†³ä¸€ä¸ªæ“ä½œä¸€æ¬¡è¯·æ±‚çš„é—®é¢˜å¯ä»¥é‡‡ç”¨å®¢æˆ·ç«¯ç¼“å­˜ä¸€æ®µæ—¶é—´èŠå¤©è®°å½•ï¼Œæ‰¹é‡å‘é€ï¼Œæˆ–è€…æœåŠ¡ç«¯åˆ†åŒºæ‰¹é‡å‘é€ä»¥å‡å°‘ç½‘ç»œioæˆ–è€…dbå‹åŠ›ï¼Œä½†æ˜¯ä¸¤è€…éƒ½å­˜åœ¨å› ä¸ºcrashé€ æˆæ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ï¼Œè¯·é—®è¿™ç§æƒ…å†µæœ‰ä»€ä¹ˆæ¯”è¾ƒå¥½çš„è§£å†³å—ğŸ™","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467005,"discussion_content":"bufferç¼“å†²å’Œå¼ºä¸€è‡´æ€§æœ¬èº«å°±æ˜¯ä¸¤ä¸ªæ¯”è¾ƒå¯¹ç«‹çš„æ¦‚å¿µï¼Œæ‰€ä»¥è¦åšåˆ°æ—¢èƒ½ç¼“å†²è¯·æ±‚é¢‘ç‡åˆä¿è¯å¼ºä¸€è‡´æ€§æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œå°½é‡è®©ä¸å®¹æ˜“å®•æœºçš„ä¸€æ–¹æ¥è¿›è¡Œbufferç¼“å†²ï¼Œæ¯”å¦‚ï¼šå¦‚æœæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½ç¼“å†²ï¼Œé‚£è¿˜æ˜¯è®©æœåŠ¡ç«¯æ¥ç¼“å†²å¯èƒ½æ¯”è¾ƒå¯é ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568200731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351843,"user_name":"è–›å»ºè¾‰","can_delete":false,"product_type":"c1","uid":1165917,"ip_address":"","ucode":"17928DD8497E9C","user_header":"https://static001.geekbang.org/account/avatar/00/11/ca/5d/c35b117c.jpg","comment_is_top":false,"comment_ctime":1658224884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658224884","product_id":100034901,"comment_content":"å…³äºä¸‰ç§åŸå­åŒ–æ–¹æ¡ˆï¼Œè¯·æ•™ä¸‹è€å¸ˆï¼Œä¸»æµå¤§å‚æ˜¯ä½¿ç”¨å“ªç§ï¼Ÿè°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":320046,"user_name":"Geek_LeonSZ","can_delete":false,"product_type":"c1","uid":1904472,"ip_address":"","ucode":"1C748B3A09CD9B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/edMMg8wmu2RRIFVw2UgAytIx7Yjmx3z2sX1Apc3DfX423dIpyKO6Kg2y65bjPF2jRZVt16AbfYS74A6BAWDJGQ/132","comment_is_top":false,"comment_ctime":1636056731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636056731","product_id":100034901,"comment_content":"éº»çƒ¦é—®ä¸€ä¸‹æœªè¯»æ•°æ˜¯æ€ä¹ˆå­˜å‚¨çš„? ç¬¬ä¸€èŠ‚è¯¾è®²äº†ä¸‰ä¸ªè¡¨, å¥½åƒä¹‹åæ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨çš„, å­˜åœ¨database, è¿˜æ˜¯in-memory cache, ç­‰ç­‰çš„, å°±æ²¡æœ‰å†æ¶‰åŠåˆ°äº†.","like_count":0},{"had_liked":false,"id":274009,"user_name":"æ»©æ¶‚æ›³å°¾","can_delete":false,"product_type":"c1","uid":1187478,"ip_address":"","ucode":"40F650F2A419D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/96/c735ad6b.jpg","comment_is_top":false,"comment_ctime":1610787604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610787604","product_id":100034901,"comment_content":"è¯·é—®è€å¸ˆï¼Œæœªè¯»æ•°ä¸ºå•¥ä¸åœ¨appæœ¬åœ°ä¿å­˜å‘¢ï¼Œè€Œæ˜¯è¦æœåŠ¡ç«¯ç»´æŠ¤ï¼Ÿæˆ‘èƒ½æƒ³åˆ°çš„ä¸€ä¸ªåœºæ™¯æ˜¯ï¼ŒæœåŠ¡ç«¯ç»´æŠ¤å¯ä»¥æ”¯æŒå¤šç»ˆç«¯ç™»å½•åçŸ¥é“ç”¨æˆ·è¯»å–çš„çŠ¶æ€ï¼Œä»¥åŠç¦»çº¿æ¨é€å•¥çš„ï¼Œå¯ä»¥è¯¦ç»†è¯´è¯´æœ‰å“ªäº›åœºæ™¯å—","like_count":0},{"had_liked":false,"id":233680,"user_name":"æ…ç‹¬æ˜å¼º","can_delete":false,"product_type":"c1","uid":1965699,"ip_address":"","ucode":"DC2F7F2C0C8F60","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","comment_is_top":false,"comment_ctime":1594384617,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594384617","product_id":100034901,"comment_content":"æ—¢ç„¶ä¸èƒ½ä¿è¯äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±ä¿è¯äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§","like_count":0},{"had_liked":false,"id":221109,"user_name":"Alice","can_delete":false,"product_type":"c1","uid":1069156,"ip_address":"","ucode":"4ACF5F78AC75AE","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/64/112b28bc.jpg","comment_is_top":false,"comment_ctime":1590407470,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1590407470","product_id":100034901,"comment_content":"ä½¿ç”¨luaçš„æ•°æ®éœ€è¦ç¡®ä¿ä¸¤ä¸ªkeyèƒ½hashåˆ°ä¸€ä¸ªåˆ†ç‰‡ã€‚é‚£ä¹ˆå¦‚ä½•å°†ä¼šè¯æœªè¯»æ•°å’Œæ€»æœªè¯»æ•°ä¸€èµ·æ›´æ–°ï¼Ÿä¼šè¯æœªè¯»æ•°å’Œæ€»æœªè¯»æ•°æ²¡åŠæ³•ä½¿ç”¨åŒä¸€ä¸ªcategoryæ¥ä¿å­˜å§","like_count":0,"discussions":[{"author":{"id":1024994,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a3/e2/5cb4f43f.jpg","nickname":"laolinshi","note":"","ucode":"269B879389D7D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558637,"discussion_content":"å¯ä»¥è€ƒè™‘ç”¨redisçš„å“ˆå¸Œè¡¨æ¥ä¿å­˜ä¼šè¯æœªè¯»æ•°å’Œæ€»æœªè¯»æ•°ï¼Œå®ç°æ–¹å¼å¯ä»¥æ˜¯: å“ˆå¸Œè¡¨é€šè¿‡ç”¨æˆ·IDæ¥è·å–ï¼Œå“ˆå¸Œè¡¨ä¸­çš„itemä½¿ç”¨ä¸åŒçš„keyå€¼æ¥åŒºåˆ†æ˜¯æ€»æœªè¯»è¿˜æ˜¯å„ä¸ªç”¨æˆ·å‘é€æ¥çš„æœªè¯»æ¶ˆæ¯ï¼Œæ¯”å¦‚ä½¿ç”¨ keyä¸º-1è¡¨ç¤ºæ€»æœªè¯»æ•°ï¼Œkeyä¸ºç”¨æˆ·IDè¡¨ç¤ºè¿™ä¸ªç”¨æˆ·å‘é€è¿‡æ¥çš„æœªè¯»æ¶ˆæ¯æ•°ã€‚é€šè¿‡è¿™æ ·çš„å®ç°æ–¹å¼è®©å¯ä»¥è®©keyéƒ½åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648429442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215399,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1588986713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588986713","product_id":100034901,"comment_content":"åœ¨æ¡ˆä¾‹2ä¸­ï¼Œä¸ºä»€ä¹ˆç”¨æˆ·BæŸ¥çœ‹äº†ç”¨æˆ·Açš„ä¼šè¯åï¼Œä¼šå°†è‡ªå·±çš„æ€»è¯»æ•°æ¸…é›¶å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":214843,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1588830227,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1588830227","product_id":100034901,"comment_content":"æœªè¯»æ•°æœ€éš¾çš„åœ°æ–¹æ˜¯åœ¨ç¦»çº¿æ¨é€çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯çš„æ˜¾ç¤ºå¯ä»¥å®¢æˆ·ç«¯ç»´æŒã€‚é‚£ä¹ˆç¦»çº¿æ¨é€çš„æ—¶å€™ï¼Œå…¶å®æ›´æ€•è®¡æ•°å™¨çš„è¯¯å·®ç´¯è®¡ï¼Œæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä¿å­˜ä¸¤ä¸ªè®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯ç¡®è®¤çš„æœªè¯»æ•°å’Œç¡®è®¤åˆ°çš„æ¶ˆæ¯idï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯ä»å®¢æˆ·ç«¯çš„msgidåˆ°æœ€è¿‘çš„msgidä¹‹é—´çš„æ–°å¢æœªè¯»æ•°å’Œæ¶ˆæ¯idã€‚","like_count":0},{"had_liked":false,"id":158465,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1575377955,"is_pvip":false,"replies":[{"id":"60944","content":"å¯¹äºç‚¹å¯¹ç‚¹èŠå¤©ï¼Œç›´æ¥é€šè¿‡p2pçš„æ–¹å¼ä¸ç»è¿‡æœåŠ¡ç«¯æ¥æ”¶å‘æ¶ˆæ¯æ˜¯å¯è¡Œçš„ï¼Œå¸‚é¢ä¸Šè¾ƒæ—©å°±å·²ç»æœ‰ç±»ä¼¼çš„è½¯ä»¶äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1575627139,"ip_address":"","comment_id":158465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575377955","product_id":100034901,"comment_content":"p2pçš„æ–¹å¼å¯ä»¥ç”¨æ¥åŒæ­¥æ¶ˆæ¯ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476737,"discussion_content":"å¯¹äºç‚¹å¯¹ç‚¹èŠå¤©ï¼Œç›´æ¥é€šè¿‡p2pçš„æ–¹å¼ä¸ç»è¿‡æœåŠ¡ç«¯æ¥æ”¶å‘æ¶ˆæ¯æ˜¯å¯è¡Œçš„ï¼Œå¸‚é¢ä¸Šè¾ƒæ—©å°±å·²ç»æœ‰ç±»ä¼¼çš„è½¯ä»¶äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575627139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146681,"user_name":"éƒ‘å°","can_delete":false,"product_type":"c1","uid":1005282,"ip_address":"","ucode":"181B0FDE5E1532","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/e2/2dcab30d.jpg","comment_is_top":false,"comment_ctime":1572602806,"is_pvip":false,"replies":[{"id":"57189","content":"æœªè¯»æ•°è¿™ä¸ªå®é™…ä¸Šè®¿é—®é‡ä¸å¤§çš„è¯å®ç°ä¼šçµæ´»å¾ˆå¤šï¼Œä¸Šé¢è¿™ç§å®ç°å®é™…ä¸Šå¾—çœ‹æ¶ˆæ¯IDæ˜¯å¦éœ€è¦ç”¨åˆ°ï¼Œä¸éœ€è¦çš„è¯ä¸ç”¨å­˜å‚¨æ¶ˆæ¯IDï¼Œå¦åˆ™å¯¹å­˜å‚¨æ˜¯ä¸€ç§æµªè´¹ï¼›å¦å¤–ä¼šè¯æœªè¯»çš„è·å–å¹¶å‘å¤§çš„æ—¶å€™hgetallæ€§èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…·ä½“çœ‹ä¸šåŠ¡ä¸Šæ˜¯å¦å¤Ÿç”¨å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1573034385,"ip_address":"","comment_id":146681,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572602806","product_id":100034901,"comment_content":"è¿™éƒ¨åˆ†åœ¨æˆ‘ä»¬çš„æ¶ˆæ¯ç³»ç»Ÿä¸­è®¾è®¡çš„æ—¶å€™æ˜¯ä½¿ç”¨Redis hash æ¥å®ç°çš„<br>ç»“æ„å¦‚ä¸‹ï¼š<br>UNREAD_${userId}  messageId contactId<br><br>å†™å…¥æœªè¯»ï¼š<br>hset  UNREAD_${userId}  messageId contactId <br>è·å–æ€»çš„æœªè¯»æ•°<br>hlen UNREAD_${userId} <br>è·å–ä¼šè¯çš„æœªè¯»æ•°,å–å‡ºæ‰€æœ‰çš„æœªè¯»æ¶ˆæ¯ï¼Œç„¶ååœ¨ç¨‹åºé‡Œè¿›è¡Œè¿‡æ»¤ï¼Œç±»ä¼¼ä¸‹é¢çš„ä»£ç <br><br>            getUnreadMessages(userId)<br>                    .values()<br>                    .stream()<br>                    .filter(v -&gt; v == contactId)<br>                    .count();<br><br>è¿™æ ·å®ç°ä¸ç”¨èƒ½å¤Ÿå¹³è¡¡ä¸¤è€…çš„è¯»å–ï¼Œä¹Ÿä¸ç”¨ä½¿ç”¨åŸå­æ“ä½œï¼Œç›®å‰å·²çŸ¥çš„é—®é¢˜æ˜¯å½“æŸä¸ªç”¨æˆ·çš„æœªè¯»æ•°å¤šä¸€ä¼šï¼Œåœ¨è·å–ä¼šè¯çš„æœªè¯»æ•°æ—¶ï¼Œä¼šæ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯è·å–ä¼šè¯æœªè¯»ä¸æ˜¯é«˜é¢‘æ“ä½œï¼Œä¸”è¿™æ ·çš„ç”¨æˆ·åŸºæœ¬å±äºé•¿æ—¶é—´ä¸ä½¿ç”¨æ‰ä¼šå¯¼è‡´æœªè¯»æ•°å †ç§¯ã€‚ ç›®å‰è¿™æ ·çš„æ–¹å¼ï¼Œä¸çŸ¥é“æœ‰æ²¡ä»€ä¹ˆè€ƒè™‘ä¸è¶³çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472972,"discussion_content":"æœªè¯»æ•°è¿™ä¸ªå®é™…ä¸Šè®¿é—®é‡ä¸å¤§çš„è¯å®ç°ä¼šçµæ´»å¾ˆå¤šï¼Œä¸Šé¢è¿™ç§å®ç°å®é™…ä¸Šå¾—çœ‹æ¶ˆæ¯IDæ˜¯å¦éœ€è¦ç”¨åˆ°ï¼Œä¸éœ€è¦çš„è¯ä¸ç”¨å­˜å‚¨æ¶ˆæ¯IDï¼Œå¦åˆ™å¯¹å­˜å‚¨æ˜¯ä¸€ç§æµªè´¹ï¼›å¦å¤–ä¼šè¯æœªè¯»çš„è·å–å¹¶å‘å¤§çš„æ—¶å€™hgetallæ€§èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…·ä½“çœ‹ä¸šåŠ¡ä¸Šæ˜¯å¦å¤Ÿç”¨å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573034385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138519,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1570288899,"is_pvip":false,"replies":[{"id":"53730","content":"è¿™ä¸ªçœ‹åœºæ™¯å§ï¼Œä¸€èˆ¬æ”¯æŒå¤šç»ˆç«¯æ¶ˆæ¯åŒæ­¥çš„è¯å»ºè®®é‡‡ç”¨æ¨æ‹‰ç»“åˆçš„æ–¹å¼ï¼Œå› ä¸ºæ¶ˆæ¯ä¼šåœ¨æœåŠ¡ç«¯å­˜å‚¨ï¼ŒæŒ‰ä¼šè¯ç»´åº¦æ‹‰å–ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦å¤–ï¼Œç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€èˆ¬ç‚¹æœªè¯»æ˜¯ç›´æ¥å±•ç¤ºæœ€æ–°çš„æ¶ˆæ¯å‘€ï¼Œä¸ä¼šè·³åˆ°æœ€æ—§çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570625375,"ip_address":"","comment_id":138519,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570288899","product_id":100034901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå†è¯·æ•™ä¸‹ï¼Œå‡å¦‚ä¸€ä¸ªç”¨æˆ·çš„ç¦»çº¿æ¶ˆæ¯éå¸¸å¤šæ¯”å¦‚è¯´ä¸€ä¸‡æ¡ï¼Œé‚£ä¹ˆç­‰ç”¨æˆ·ä¸Šçº¿çš„æ—¶å€™æ˜¯å…¨é‡åŒæ­¥åˆ°æœ¬åœ°å‘¢ï¼ˆç±»ä¼¼å¾®ä¿¡ï¼‰è¿˜æ˜¯è¯´åªåŒæ­¥ä¸€éƒ¨åˆ†æ¶ˆæ¯å‰©ä¸‹çš„ç­‰ç”¨æˆ·ä¸‹æ‹‰çš„æ—¶å€™å†æ‡’åŠ è½½æ¯”è¾ƒè€çš„æ¶ˆæ¯å‘¢ï¼ˆç±»ä¼¼QQï¼‰ï¼Ÿ å¦‚æœä½¿ç”¨åè€…çš„è¯ï¼Œå½“ç”¨æˆ·ç‚¹å‡»èŠå¤©å¯¹è¯æ¡†çš„æœªè¯»æ•°å­—æ—¶éœ€è¦ç«‹å³é”šç‚¹åˆ°æœ€è€çš„é‚£ä¸ªæœªè¯»æ¶ˆæ¯ï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469553,"discussion_content":"è¿™ä¸ªçœ‹åœºæ™¯å§ï¼Œä¸€èˆ¬æ”¯æŒå¤šç»ˆç«¯æ¶ˆæ¯åŒæ­¥çš„è¯å»ºè®®é‡‡ç”¨æ¨æ‹‰ç»“åˆçš„æ–¹å¼ï¼Œå› ä¸ºæ¶ˆæ¯ä¼šåœ¨æœåŠ¡ç«¯å­˜å‚¨ï¼ŒæŒ‰ä¼šè¯ç»´åº¦æ‹‰å–ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚å¦å¤–ï¼Œç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€èˆ¬ç‚¹æœªè¯»æ˜¯ç›´æ¥å±•ç¤ºæœ€æ–°çš„æ¶ˆæ¯å‘€ï¼Œä¸ä¼šè·³åˆ°æœ€æ—§çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570625375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138346,"user_name":"æ€¡çº¢å…¬å­","can_delete":false,"product_type":"c1","uid":1679704,"ip_address":"","ucode":"2F97155A0C3C2C","user_header":"","comment_is_top":false,"comment_ctime":1570174939,"is_pvip":false,"replies":[{"id":"53286","content":"æœåŠ¡ç«¯æ¥æ”¶åˆ°æŸ¥çœ‹ä¼šè¯çš„è¯·æ±‚æ—¶ï¼Œé™¤äº†è¿”å›ä¼šè¯å†…å®¹ï¼Œè¿˜ä¼šåœ¨æœåŠ¡ç«¯è¿›è¡Œæœªè¯»æ¸…ç†ã€‚å¦å¤–è¯¾ç¨‹ä¸­è¯´çš„ç¦»çº¿æ¶ˆæ¯ä¸‹æ¨æ˜¯æŒ‡ç”¨æˆ·ç”±æ–­è¿å†é‡æ–°ä¸Šçº¿åçš„è¿‡ç¨‹ï¼Œä¸æ˜¯æŒ‡ç”¨æˆ·ç½‘ç»œç¦»çº¿ã€‚æ‰€ä»¥æ”¶åˆ°ç¦»çº¿æ¶ˆæ¯å¹¶ä¸ä¼šæ¸…æœªè¯»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570278177,"ip_address":"","comment_id":138346,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570174939","product_id":100034901,"comment_content":"è€å¸ˆæˆ‘æœ‰ç–‘é—®ï¼Œä¼šè¯æœªè¯»å’Œæ¶ˆæ¯æ€»æœªè¯»ç”±æœåŠ¡ç«¯å­˜å‚¨çš„ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯æ”¶åˆ°ç¦»çº¿æ¨é€è¿‡ç¨‹ä¹‹åï¼Œå¹¶æ²¡æœ‰åœ¨çº¿æŸ¥çœ‹ç›¸å…³æ¶ˆæ¯å†…å®¹ï¼Œè€Œåœ¨ç¦»çº¿æ¡ä»¶ä¸‹æŸ¥çœ‹ç›¸å…³ä¼šè¯ï¼Œæ­¤æ—¶ä¼šè¯æœªè¯»æ›´æ–°æ˜¯ä¸æ˜¯ä»…ä»…æ˜¯å®¢æˆ·ç«¯çš„é€»è¾‘ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯å‘é€ä¿¡ä»¤åˆ°æœåŠ¡ç«¯ï¼Ÿè¿˜æ˜¯è¯´ï¼ŒæœåŠ¡ç«¯åªè´Ÿè´£å°†ç¦»çº¿æ¶ˆæ¯æˆåŠŸæ¨ç»™å®¢æˆ·ç«¯åï¼Œå°±å°†ç›¸å…³ä¼šè¯å’Œæ€»æœªè¯»æ¸…é›¶äº†ï¼Ÿè¿™æ ·çš„è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯ä¸æ˜¯éœ€è¦æœ‰å„è‡ªçš„ä¼šè¯æœªè¯»ç®¡ç†å•Šï¼Ÿè€Œä¸”ä¸¤è€…ä¸æ˜¯åœ¨ä¸€ä¸ªçº¬åº¦ä¸Šçš„ã€‚æœåŠ¡ç«¯çš„ä¼šè¯æœªè¯»ç®¡ç†æ˜¯ç¦»çº¿è¿‡ç¨‹ä¸­æ–°æ¶ˆæ¯æ¡æ•°ï¼Œå®¢æˆ·ç«¯çš„ä¼šè¯ç®¡ç†ï¼Œæ˜¯æ–°æ¶ˆæ¯æ˜¯å¦æŸ¥çœ‹ï¼Ÿè¿˜è¯·è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼Œè‡ªå·±æƒ³æœ‰ç‚¹ä¹±å¥—äº†","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469495,"discussion_content":"æœåŠ¡ç«¯æ¥æ”¶åˆ°æŸ¥çœ‹ä¼šè¯çš„è¯·æ±‚æ—¶ï¼Œé™¤äº†è¿”å›ä¼šè¯å†…å®¹ï¼Œè¿˜ä¼šåœ¨æœåŠ¡ç«¯è¿›è¡Œæœªè¯»æ¸…ç†ã€‚å¦å¤–è¯¾ç¨‹ä¸­è¯´çš„ç¦»çº¿æ¶ˆæ¯ä¸‹æ¨æ˜¯æŒ‡ç”¨æˆ·ç”±æ–­è¿å†é‡æ–°ä¸Šçº¿åçš„è¿‡ç¨‹ï¼Œä¸æ˜¯æŒ‡ç”¨æˆ·ç½‘ç»œç¦»çº¿ã€‚æ‰€ä»¥æ”¶åˆ°ç¦»çº¿æ¶ˆæ¯å¹¶ä¸ä¼šæ¸…æœªè¯»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570278177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138171,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1570074869,"is_pvip":false,"replies":[{"id":"53273","content":"è·Ÿç€æ¶ˆæ¯å¸¦ä¸‹å»ï¼Œæˆ–è€…å»ºè¿åä»æœåŠ¡ç«¯åŒæ­¥ä¸€æ¬¡ç„¶åç«¯ä¸Šé€šè¿‡æ¥æ”¶çš„æ¶ˆæ¯è¿›è¡Œæœ¬åœ°ç´¯åŠ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570274227,"ip_address":"","comment_id":138171,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570074869","product_id":100034901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®ä¸‹ä¼šè¯é‡Œçš„æœªè¯»æ•°æ€ä¹ˆåŒæ­¥ç»™å®¢æˆ·ç«¯çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469422,"discussion_content":"è·Ÿç€æ¶ˆæ¯å¸¦ä¸‹å»ï¼Œæˆ–è€…å»ºè¿åä»æœåŠ¡ç«¯åŒæ­¥ä¸€æ¬¡ç„¶åç«¯ä¸Šé€šè¿‡æ¥æ”¶çš„æ¶ˆæ¯è¿›è¡Œæœ¬åœ°ç´¯åŠ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570274227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137895,"user_name":"ç›˜å°¼è¥¿æ—","can_delete":false,"product_type":"c1","uid":1197347,"ip_address":"","ucode":"B59569FC25144F","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/23/28311447.jpg","comment_is_top":false,"comment_ctime":1569908387,"is_pvip":false,"replies":[{"id":"53265","content":"æ˜¯çš„ï¼Œredisçš„äº‹åŠ¡å®é™…ä¸Šéœ€è¦ä½¿ç”¨æ–¹è‡ªè¡Œå¤„ç†å¤±è´¥çš„åç»­æ“ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570270669,"ip_address":"","comment_id":137895,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569908387","product_id":100034901,"comment_content":"redis çš„multi å¤šæ¡æ“ä½œï¼Œå‰é¢å‡ æ¡æ“ä½œæˆåŠŸï¼Œæœ€åä¸€æ¡å¤±è´¥ï¼Œæ— æ³•åšå·²ç»æ‰§è¡ŒæˆåŠŸè¯­å¥çš„ å›æ»šã€‚æ¯”å¦‚<br>127.0.0.1:6379&gt; get locked<br>&quot;1&quot;<br>127.0.0.1:6379&gt; watch locked<br>OK<br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379&gt; incr locked<br>QUEUED<br>127.0.0.1:6379&gt; lpop list_key<br>QUEUED<br>127.0.0.1:6379&gt; incr locked<br>QUEUED<br>127.0.0.1:6379&gt; exec<br>1) (integer) 2<br>2) (nil)<br>3) (integer) 3<br>127.0.0.1:6379&gt; get locked<br>&quot;3&quot;<br>ä¸Šé¢çš„è¯­å¥ incr ä¼šæ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯lpop æ˜¯å¤±è´¥çš„<br>","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469297,"discussion_content":"æ˜¯çš„ï¼Œredisçš„äº‹åŠ¡å®é™…ä¸Šéœ€è¦ä½¿ç”¨æ–¹è‡ªè¡Œå¤„ç†å¤±è´¥çš„åç»­æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570270669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137844,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1168220,"ip_address":"","ucode":"DF08B67EAD61E7","user_header":"https://static001.geekbang.org/account/avatar/00/11/d3/5c/796962de.jpg","comment_is_top":false,"comment_ctime":1569893841,"is_pvip":false,"replies":[{"id":"53266","content":"æ˜¯çš„ï¼ŒredisåµŒå…¥çš„luaè„šæœ¬æ˜¯ä¼šåŸå­åŒ–æ‰§è¡Œçš„ã€‚å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒrediså®˜ç½‘ç¤ºä¾‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1570270767,"ip_address":"","comment_id":137844,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569893841","product_id":100034901,"comment_content":"è¯·é—®ï¼ŒredisåµŒå…¥çš„luaè„šæœ¬éƒ½æ˜¯åŸå­åŒ–æ‰§è¡Œçš„å—ï¼Ÿ<br>è¿˜æ˜¯æœ‰ç‰¹æ®Šçš„å£°æ˜ï¼Œæˆ–åˆ™ä»€ä¹ˆè¯­æ³•ç»“æ„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469285,"discussion_content":"æ˜¯çš„ï¼ŒredisåµŒå…¥çš„luaè„šæœ¬æ˜¯ä¼šåŸå­åŒ–æ‰§è¡Œçš„ã€‚å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒrediså®˜ç½‘ç¤ºä¾‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570270767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136257,"user_name":"å¤©å¤©å¹³å®‰","can_delete":false,"product_type":"c1","uid":1119208,"ip_address":"","ucode":"C4850F9655F4DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/e8/08b829a9.jpg","comment_is_top":false,"comment_ctime":1569398585,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569398585","product_id":100034901,"comment_content":"æˆ‘æƒ³åœ¨è‡ªå·±çš„appä¸­ç›´æ¥å¼•ç”¨æ”¶è´¹çš„èŠå¤©äº§å“ï¼Œè€å¸ˆæ¨èç”¨å“ªä¸ªæ¯”è¾ƒå¥½ï¼Ÿ","like_count":0},{"had_liked":false,"id":134553,"user_name":"qijj","can_delete":false,"product_type":"c1","uid":1231369,"ip_address":"","ucode":"AAE7BAD5DABEE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLn1y9RSL9JcACGRVkkhkEmjH7z1eiag763CVKwn3Mzb3djbibwbx0fgZqyBpPozGLOicnllSfydEng/132","comment_is_top":false,"comment_ctime":1568864407,"is_pvip":false,"replies":[{"id":"51592","content":"å¯¹äºç¾¤èŠä¸šåŠ¡æ¥è¯´ï¼Œç”±äºæ¶ˆæ¯æ‰‡å‡ºé—®é¢˜ï¼Œä¸€èˆ¬å¤„ç†ä¸Šå’Œç‚¹å¯¹ç‚¹èŠå¤©ä¸å¤ªä¸€æ ·ã€‚ç¾¤èŠæ¶ˆæ¯ä¸€èˆ¬é‡‡ç”¨â€è¯»æ‰©æ•£â€œçš„æ–¹å¼ï¼Œä¸€ä¸ªç¾¤çš„æ¶ˆæ¯åªä¼šè®°å½•ä¸€ä»½ï¼Œè¿™ä¸ªç¾¤é‡Œçš„æ¯ä¸ªç”¨æˆ·åœ¨éœ€è¦æŸ¥çœ‹æ•°æ®çš„æ—¶å€™éƒ½ä»ä¼šè·å–è¿™ä¸ªç¾¤çš„æ¶ˆæ¯è®°å½•ã€‚æœªè¯»æ•°æ˜¯æ¯ä¸€ä¸ªç”¨æˆ·å•ç‹¬ä¸€ä»½çš„ï¼Œå’Œæ¶ˆæ¯ä¸ä¸€æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568877629,"ip_address":"","comment_id":134553,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1568864407","product_id":100034901,"comment_content":"è€å¸ˆï¼Œç¾¤èŠçš„æœªè¯»æ¶ˆæ¯ä¸šåŠ¡åº”è¯¥å¦‚ä½•è®¾è®¡ï¼Œåœ¨æ•°æ®åº“è¡¨è®¾è®¡æ—¶å»ºç«‹ä¸€ä¸ªå…³ç³»è¡¨ï¼Œä¸€æ¡æ¶ˆæ¯å’Œç¾¤èŠä¸­çš„æ¯ä¸ªäººçš„å¯¹åº”å…³ç³»éƒ½å­˜å…¥è¿™è¡¨ï¼Œæ˜¯ä¸æ˜¯æ•ˆç‡ä½å‘¢ï¼Œå¦‚æœç¾¤é‡Œæœ‰500äººï¼Œè¿™ä¸ªå…³ç³»è¡¨é‡Œå°±ä¼šæ’å…¥500æ¡è®°å½•ï¼Œå¾ˆå¿«è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®é‡å°±ä¼šå¾ˆå¤§å¾ˆå¤§äº†ï¼Œæ˜¯ä¸æ˜¯ä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼Ÿåº”è¯¥å¦‚ä½•è®¾è®¡èƒ½å¤Ÿæé«˜ç³»ç»Ÿçš„æ•ˆç‡ã€‚è¯·å¸®å¿™è§£ç­”ä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å›°æ‰°æˆ‘å¾ˆä¹…äº†ï¼Œè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467802,"discussion_content":"å¯¹äºç¾¤èŠä¸šåŠ¡æ¥è¯´ï¼Œç”±äºæ¶ˆæ¯æ‰‡å‡ºé—®é¢˜ï¼Œä¸€èˆ¬å¤„ç†ä¸Šå’Œç‚¹å¯¹ç‚¹èŠå¤©ä¸å¤ªä¸€æ ·ã€‚ç¾¤èŠæ¶ˆæ¯ä¸€èˆ¬é‡‡ç”¨â€è¯»æ‰©æ•£â€œçš„æ–¹å¼ï¼Œä¸€ä¸ªç¾¤çš„æ¶ˆæ¯åªä¼šè®°å½•ä¸€ä»½ï¼Œè¿™ä¸ªç¾¤é‡Œçš„æ¯ä¸ªç”¨æˆ·åœ¨éœ€è¦æŸ¥çœ‹æ•°æ®çš„æ—¶å€™éƒ½ä»ä¼šè·å–è¿™ä¸ªç¾¤çš„æ¶ˆæ¯è®°å½•ã€‚æœªè¯»æ•°æ˜¯æ¯ä¸€ä¸ªç”¨æˆ·å•ç‹¬ä¸€ä»½çš„ï¼Œå’Œæ¶ˆæ¯ä¸ä¸€æ ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568877629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"æ…ç‹¬æ˜å¼º","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290228,"discussion_content":"çœ‹äº†è€å¸ˆçš„è¯„è®ºï¼Œæœ‰ç‚¹ç±»ä¼¼äºmqçš„æ¶ˆæ¯å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œä½†æ˜¯åœ¨æœåŠ¡éƒ½å­˜å‚¨äº†æ¯ä¸ªå®¢æˆ·ç«¯çš„æ¶ˆè´¹è¿›åº¦ï¼Œé‚£ä¹ˆæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å–åˆ°å…¨é‡çš„æ¶ˆæ¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594384438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132755,"user_name":"å¢™è§’å„¿çš„èŠ±","can_delete":false,"product_type":"c1","uid":1258474,"ip_address":"","ucode":"EE5CAD76175CCF","user_header":"","comment_is_top":false,"comment_ctime":1568214105,"is_pvip":false,"replies":[{"id":"50938","content":"å¯ä»¥çš„ï¼Œé•¿è¿æ¥å…¥å±‚å’Œåé¢çš„ä¸šåŠ¡å±‚ä¹‹é—´å¯ä»¥é€šè¿‡redisçš„pub subæ¥é™ä½æ¶ˆæ¯å»¶è¿Ÿï¼Œæ¶ˆæ¯å‘é€çš„apiå±‚å’Œå…·ä½“çš„æŒä¹…åŒ–å±‚å‡ºäºæˆæœ¬è€ƒè™‘å¯ä»¥é€šè¿‡å…¶ä»–éå†…å­˜å‹æ¥å®ç°ï¼Œkafkaç”±äºæ˜¯é¡ºåºçš„è¯»å†™ï¼Œå†™å…¥å’Œè¯»å–çš„æ€§èƒ½æœ‰ç³»ç»Ÿçš„PageCacheæ¥åŠ é€Ÿï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šä¸ä¼šå·®ã€‚ä¸çŸ¥é“ä½ è¿™é‡Œè¯´çš„å»¶è¿Ÿæ‰¹é‡å‘å¸ƒæ¶ˆæ¯å…·ä½“æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568288068,"ip_address":"","comment_id":132755,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1568214105","product_id":100034901,"comment_content":"è€å¸ˆ å¯¹äºimæœåŠ¡å™¨é›†ç¾¤ï¼Œå®¢æˆ·ç«¯çš„socketå‡å¸ƒåœ¨å„ä¸ªæœåŠ¡å™¨ï¼Œç›®æ ‡socketä¸åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šæ—¶ï¼ŒæœåŠ¡å™¨é—´éœ€è¦è½¬å‘æ¶ˆæ¯ï¼Œè¿™ä¸ªåœºæ™¯éœ€è¦ä½å»¶è¿Ÿæ— éœ€æŒä¹…åŒ–ï¼ŒæœåŠ¡å™¨é—´ç”¨redisçš„å‘å¸ƒè®¢é˜…ï¼Œå› å…¶èµ°å†…å­˜è¾ƒå¿«ï¼Œå³ä½¿æ–­ç”µè¿˜å¯ä»¥èµ°åº“ã€‚imæœåŠ¡å™¨å’Œå…¥åº“æœåŠ¡é—´ç”¨å…¶ä»–mqè§£è€¦ï¼Œå› ä¸ºè¿™ä¸ªç¯èŠ‚éœ€è¦æŒä¹…åŒ–ï¼Œæ‰€ä»¥é€‰rocketmqæˆ–kafkaï¼Œä½†kafkaä¼šå»¶è¿Ÿæ‰¹é‡å‘å¸ƒæ¶ˆæ¯ æ‰€ä»¥é€‰rocketmqï¼Œè¿™ä¸¤ä¸ªç¯èŠ‚çš„mqé€‰å‹å¯è¡Œå—ã€‚","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467107,"discussion_content":"å¯ä»¥çš„ï¼Œé•¿è¿æ¥å…¥å±‚å’Œåé¢çš„ä¸šåŠ¡å±‚ä¹‹é—´å¯ä»¥é€šè¿‡redisçš„pub subæ¥é™ä½æ¶ˆæ¯å»¶è¿Ÿï¼Œæ¶ˆæ¯å‘é€çš„apiå±‚å’Œå…·ä½“çš„æŒä¹…åŒ–å±‚å‡ºäºæˆæœ¬è€ƒè™‘å¯ä»¥é€šè¿‡å…¶ä»–éå†…å­˜å‹æ¥å®ç°ï¼Œkafkaç”±äºæ˜¯é¡ºåºçš„è¯»å†™ï¼Œå†™å…¥å’Œè¯»å–çš„æ€§èƒ½æœ‰ç³»ç»Ÿçš„PageCacheæ¥åŠ é€Ÿï¼Œæ‰€ä»¥æ€§èƒ½ä¸Šä¸ä¼šå·®ã€‚ä¸çŸ¥é“ä½ è¿™é‡Œè¯´çš„å»¶è¿Ÿæ‰¹é‡å‘å¸ƒæ¶ˆæ¯å…·ä½“æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568288068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1258474,"avatar":"","nickname":"å¢™è§’å„¿çš„èŠ±","note":"","ucode":"EE5CAD76175CCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":10584,"discussion_content":"å“¦ æˆ‘æ˜¯äº†è§£åˆ°kafkaæ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¸æ˜¯ç«‹å³å‘é€ è€Œæ˜¯ç§¯æ”’ä¸€æ‰¹ æ‰¹é‡å‘é€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568296724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1111899,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/5b/d2e7c2c4.jpg","nickname":"æ—¶éšæ—¶ç°","note":"","ucode":"DA4D622FF84920","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1258474,"avatar":"","nickname":"å¢™è§’å„¿çš„èŠ±","note":"","ucode":"EE5CAD76175CCF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23031,"discussion_content":"è¿™ä¸ªå¯ä»¥é€šè¿‡producerç«¯å‚æ•°è°ƒæ•´çš„ï¼Œlinger.mså’Œbatch.size","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569744234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":10584,"ip_address":""},"score":23031,"extra":""}]}]},{"had_liked":false,"id":132569,"user_name":"å«æ±Ÿ","can_delete":false,"product_type":"c1","uid":1101226,"ip_address":"","ucode":"DE2F7A6916F1A9","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/aa/33d48789.jpg","comment_is_top":false,"comment_ctime":1568167387,"is_pvip":false,"replies":[{"id":"50854","content":"æ˜¯çš„ï¼Œrediså¯¹äºè„šæœ¬æ‰§è¡Œå¹¶æ²¡æœ‰åšåˆ°çœŸæ­£çš„äº‹åŠ¡æ€§ï¼Œluaè„šæœ¬åœ¨redisä¸­çš„æ‰§è¡Œåªèƒ½ä¿è¯å¤šæ¡å‘½ä»¤ä¼šåŸå­æ‰§è¡Œï¼Œæ•´ä½“æ‰§è¡Œå®Œæˆæ‰ä¼šåŒæ­¥ç»™ä»åº“å¹¶å†™å…¥aofï¼Œæ‰€ä»¥å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µï¼Œä¼šç›´æ¥å¯¼è‡´è¢«ä¸­æ–­çš„åé¢éƒ¨åˆ†çš„è„šæœ¬å¾—ä¸åˆ°æ‰§è¡Œã€‚luaè„šæœ¬ä¸­å¯ä»¥å¢åŠ ä¸€äº›ä¿®å¤æœºåˆ¶ï¼Œæ¯”å¦‚ä¼šè¯æ¯”è¾ƒå°‘çš„è¯å°±èšåˆä¸€æ¬¡ä¼šè¯æ¥è¦†ç›–æ€»æœªè¯»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568201027,"ip_address":"","comment_id":132569,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568167387","product_id":100034901,"comment_content":"é¦–å…ˆï¼Œæˆ‘è®¤ä¸ºredisçš„è„šæœ¬åŒ–æä¾›äº†ç±»ä¼¼äºäº‹åŠ¡çš„åŠŸèƒ½ï¼Œåªæ˜¯åŠŸèƒ½ä¸Šé¢æ›´å¼ºå¤§ï¼Œä¹Ÿæ›´ä¾¿æ·ã€‚ä½†æ˜¯åŒredisçš„äº‹åŠ¡ä¸€æ ·ï¼Œå¯¹äºäº‹åŠ¡çš„ACIDæ”¯æŒå¹¶ä¸å®Œå–„ã€‚è€å¸ˆæçš„é—®é¢˜ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µï¼Œé¦–å…ˆè¿™ä¸ªçš„æ‰§è¡Œäº‹åŠ¡è‚¯å®šæ˜¯å¤±è´¥çš„ï¼Œå³ä½¿å¼€å¯æŒä¹…åŒ–ä¹Ÿæ²¡æœ‰åŠæ³•ä¿®å¤ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°æ–­çº¿å›å¤ï¼Œæ‰€ä»¥ï¼Œå°±å¯ä»¥å½“åšå¤±è´¥å¤„ç†ï¼Œè€Œé’ˆå¯¹äºå¤±è´¥ï¼Œä¸šåŠ¡å¯ä»¥é€šè¿‡é‡è¯•æ¥è¿›è¡Œå®¹é”™ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é‡Œéœ€è¦ç‰¹åˆ«çš„è®¾è®¡ï¼Œæ¯”å¦‚é’ˆå¯¹äºæŸä¸ªç©å®¶çš„æ¶ˆæ¯æœªè¯»ç­‰ä¿¡æ¯çš„æ›´æ–°å’Œè¯»å–éœ€è¦ä¸€ç›´ä¾èµ–æŸä¸€æ¡è¿æ¥ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯é’ˆå¯¹äºè¯¥ç©å®¶çš„æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œä¸çŸ¥é“æƒ³çš„å¯¹ä¸å¯¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467013,"discussion_content":"æ˜¯çš„ï¼Œrediså¯¹äºè„šæœ¬æ‰§è¡Œå¹¶æ²¡æœ‰åšåˆ°çœŸæ­£çš„äº‹åŠ¡æ€§ï¼Œluaè„šæœ¬åœ¨redisä¸­çš„æ‰§è¡Œåªèƒ½ä¿è¯å¤šæ¡å‘½ä»¤ä¼šåŸå­æ‰§è¡Œï¼Œæ•´ä½“æ‰§è¡Œå®Œæˆæ‰ä¼šåŒæ­¥ç»™ä»åº“å¹¶å†™å…¥aofï¼Œæ‰€ä»¥å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰ç”µï¼Œä¼šç›´æ¥å¯¼è‡´è¢«ä¸­æ–­çš„åé¢éƒ¨åˆ†çš„è„šæœ¬å¾—ä¸åˆ°æ‰§è¡Œã€‚luaè„šæœ¬ä¸­å¯ä»¥å¢åŠ ä¸€äº›ä¿®å¤æœºåˆ¶ï¼Œæ¯”å¦‚ä¼šè¯æ¯”è¾ƒå°‘çš„è¯å°±èšåˆä¸€æ¬¡ä¼šè¯æ¥è¦†ç›–æ€»æœªè¯»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568201027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132563,"user_name":"bbpatience","can_delete":false,"product_type":"c1","uid":1642676,"ip_address":"","ucode":"0573DA545B2811","user_header":"","comment_is_top":false,"comment_ctime":1568166104,"is_pvip":false,"replies":[{"id":"50853","content":"å¥½åƒå’Œæçš„é—®é¢˜ä¸å¤§å¯¹çš„ä¸Šå“ˆï¼Œrediså¯¹äºè„šæœ¬çš„æ‰§è¡Œé—®é¢˜åœ¨äºå¹¶ä¸èƒ½ä¿è¯æ‰§è¡Œè¿‡ç¨‹æ‰ç”µåä»åº“æˆ–è€…aofèƒ½å¤Ÿæ„ŸçŸ¥åˆ°æ¥ç”¨äºæ¢å¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568200897,"ip_address":"","comment_id":132563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568166104","product_id":100034901,"comment_content":"æ‰ç”µä¼šå‡ºç°é—®é¢˜ï¼Œåœ¨redisåšä¸»ä»æ‹·è´æ—¶ï¼Œé”ä¿¡æ¯æœ‰å¯èƒ½æ­£å¥½æ²¡æœ‰åŒæ­¥åˆ°ä»ï¼Œè¿™äº›ä»åœ¨åˆ‡ä¸ºä¸»æ—¶ï¼Œæ²¡æœ‰é”ä¿¡æ¯ã€‚å¯ä»¥ç”¨zkæ¥è§£å†³åˆ†å¸ƒå¼é”é—®é¢˜ï¼Œå®ƒèƒ½ä¿è¯æ‰ç”µåå†é€‰ä¸¾æˆåŠŸçš„èŠ‚ç‚¹ï¼Œä¸€å®šåŒ…å«é”ä¿¡æ¯","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467010,"discussion_content":"å¥½åƒå’Œæçš„é—®é¢˜ä¸å¤§å¯¹çš„ä¸Šå“ˆï¼Œrediså¯¹äºè„šæœ¬çš„æ‰§è¡Œé—®é¢˜åœ¨äºå¹¶ä¸èƒ½ä¿è¯æ‰§è¡Œè¿‡ç¨‹æ‰ç”µåä»åº“æˆ–è€…aofèƒ½å¤Ÿæ„ŸçŸ¥åˆ°æ¥ç”¨äºæ¢å¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568200897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132535,"user_name":"äº‘å¸ˆå…„","can_delete":false,"product_type":"c1","uid":1010459,"ip_address":"","ucode":"4475AF1598FBFD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/1b/4b397b80.jpg","comment_is_top":false,"comment_ctime":1568163041,"is_pvip":false,"replies":[{"id":"50851","content":"æ˜¯çš„ï¼Œæœªè¯»æ•°è¯»å–æ˜¯ä¸€ä¸ªç›¸å¯¹é«˜é¢‘çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯æ€»æœªè¯»ã€‚æ¨é€æ—¶æ›´æ–°è§’æ ‡å’Œappä¸Šçš„æ¶ˆæ¯tabæœªè¯»è½®è¯¢éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åŸºäºæœåŠ¡ç«¯æ¥å®ç°çš„è¯ï¼Œæ¨èä½¿ç”¨redisã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1568200555,"ip_address":"","comment_id":132535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568163041","product_id":100034901,"comment_content":"è€å¸ˆè§£å†³åŸå­æ€§æ–¹æ¡ˆä¸¤ä¸ªæ˜¯ä»redisè§’åº¦æå‡ºçš„ï¼Œæ˜¯å¦å®è·µä¸­å°±æ˜¯ä½¿ç”¨rediså­˜å‚¨æ¶ˆæ¯æœªè¯»æ•°ï¼Ÿæ˜¯è€ƒè™‘æœªè¯»æ•°çš„é«˜é¢‘è¯»å†™å—","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466993,"discussion_content":"æ˜¯çš„ï¼Œæœªè¯»æ•°è¯»å–æ˜¯ä¸€ä¸ªç›¸å¯¹é«˜é¢‘çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯æ€»æœªè¯»ã€‚æ¨é€æ—¶æ›´æ–°è§’æ ‡å’Œappä¸Šçš„æ¶ˆæ¯tabæœªè¯»è½®è¯¢éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åŸºäºæœåŠ¡ç«¯æ¥å®ç°çš„è¯ï¼Œæ¨èä½¿ç”¨redisã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568200555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}