{"id":146833,"title":"41 | Linux/Mac实验环境搭建与URI查询参数","content":"<p>你好，我是Chrono。</p><p>先要说一声“抱歉”。由于工作比较紧张、项目实施频繁出差，导致原本预定的“答疑篇”迟迟没有进展，这次趁着“十一”长假，总算赶出了两期，集中回答几个同学们问得比较多的问题：Linux/Mac实验环境搭建（<a href=\"https://time.geekbang.org/column/article/100124\">第7讲</a>），URI查询参数（<a href=\"https://time.geekbang.org/column/article/102008\">第11讲</a>），还有DHE/ECDHE算法的原理（<a href=\"https://time.geekbang.org/column/article/110354\">第26讲</a>），后续有时间可能还会再陆续补充完善。</p><p>很高兴在时隔一个多月后与你再次见面，废话不多说了，让我们开始吧。</p><h2>Linux上搭建实验环境</h2><p>我们先来看一下如何在Linux上搭建课程的实验环境。</p><p>首先，需要安装OpenResty，但它在Linux上提供的不是zip压缩包，而是各种Linux发行版的预编译包，支持常见的Ubuntu、Debian、CentOS等等，而且<a href=\"http://openresty.org/cn/linux-packages.html\">官网</a>上有非常详细安装步骤。</p><p>以Ubuntu为例，只要“按部就班”地执行下面的几条命令就可以了，非常轻松：</p><pre><code># 安装导入GPG公钥所需的依赖包：\nsudo apt-get -y install --no-install-recommends wget gnupg ca-certificates\n\n\n# 导入GPG密钥：\nwget -O - https://openresty.org/package/pubkey.gpg | sudo apt-key add -\n\n\n# 安装add-apt-repository命令\nsudo apt-get -y install --no-install-recommends software-properties-common\n\n\n# 添加官方仓库：\nsudo add-apt-repository -y &quot;deb http://openresty.org/package/ubuntu $(lsb_release -sc) main&quot;\n\n\n# 更新APT索引：\nsudo apt-get update\n\n\n# 安装 OpenResty\nsudo apt-get -y install openresty\n</code></pre><p>全部完成后，OpenResty会安装到“/usr/local/openresty”目录里，可以用它自带的命令行工具“resty”来验证是否安装成功：</p><pre><code>$resty -v\nresty 0.23\nnginx version: openresty/1.15.8.2\nbuilt with OpenSSL 1.1.0k  28 May 2019\n</code></pre><p>有了OpenResty，就可以从GitHub上获取http_study项目的源码了，用“git clone”是最简单快捷的方法：</p><!-- [[[read_end]]] --><pre><code>git clone https://github.com/chronolaw/http_study\n</code></pre><p>在Git仓库的“www”目录，我为Linux环境补充了一个Shell脚本“run.sh”，作用和Windows下的start.bat、stop.bat差不多，可以简单地启停实验环境，后面可以接命令行参数start/stop/reload/list：</p><pre><code>cd http_study/www/    #脚本必须在www目录下运行，才能找到nginx.conf\n./run.sh start        #启动实验环境\n./run.sh list         #列出实验环境的Nginx进程\n./run.sh reload       #重启实验环境\n./run.sh stop         #停止实验环境\n</code></pre><p>启动OpenResty之后，就可以用浏览器或者curl来验证课程里的各个测试URI，但之前不要忘记修改“/etc/hosts”添加域名解析，例如：</p><pre><code>curl -v &quot;http://127.0.0.1/&quot;\ncurl -v &quot;http://www.chrono.com/09-1&quot;\ncurl -k &quot;https://www.chrono.com/24-1?key=1234&quot;\ncurl -v &quot;http://www.chrono.com/41-1&quot;\n</code></pre><h2>Mac上搭建实验环境</h2><p>看完了Linux，我们再来看一下Mac。</p><p>这里我用的是两个环境：Mac mini 和 MacBook Air，不过都是好几年前的“老古董”了，系统是10.13 High Sierra和10.14 Mojave（更早的版本没有测试，但应该也都可以）。</p><p>首先要保证Mac里有第三方包管理工具homebrew，可以用下面的命令安装：</p><pre><code>#先安装Mac的homebrew\n/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;\n</code></pre><p>然后，要用homebrew安装OpenResty，但它在Mac上的安装过程和Linux不同，不是预编译包，而是要下载许多相关的源码（如OpenSSL），然后再用clang本地编译，大概要花上五六分钟的时间，整体上比较慢，要有点耐心。</p><pre><code>#使用homebrew安装OpenResty\nbrew install openresty/brew/openresty\n</code></pre><p>安装完OpenResty，后续的操作就和Linux一样了，“git clone”项目源码：</p><pre><code>git clone https://github.com/chronolaw/http_study\n</code></pre><p>然后，进“http_study/www”目录，用脚本“run.sh”启停实验环境，用Safari或者curl测试。</p><h2>Linux/Mac下的抓包</h2><p>Linux和Mac里都有图形界面版本的Wireshark，抓包的用法与Windows完全一样，简单易用。</p><p>所以，今天我主要介绍命令行形式的抓包。</p><p>命令行抓包最基本的方式就是著名的tcpdump，不过我用得不是很多，所以就尽可能地“藏拙”了。</p><p>简单的抓包使用“-i lo”指定抓取本地环回地址，“port”指定端口号，“-w”指定抓包的存放位置，抓包结束时用“Ctrl+C”中断：</p><pre><code>sudo tcpdump -i lo -w a.pcap\nsudo tcpdump -i lo port 443 -w a.pcap\n</code></pre><p>抓出的包也可以用tcpdump直接查看，用“-r”指定包的名字：</p><pre><code>tcpdump -r a.pcap \ntcpdump -r 08-1.pcapng -A\n</code></pre><p>不过在命令行界面下可以用一个更好的工具——tshark，它是Wireshark的命令行版本，用法和tcpdump差不多，但更易读，功能也更丰富一些。</p><pre><code>tshark -r 08-1.pcapng \ntshark -r 08-1.pcapng -V\ntshark -r 08-1.pcapng -O tcp|less\ntshark -r 08-1.pcapng -O http|less\n</code></pre><p>tshark也支持使用keylogfile解密查看HTTPS的抓包，需要用“-o”参数指定log文件，例如：</p><pre><code>tshark -r 26-1.pcapng -O http -o ssl.keylog_file:26-1.log|less\n</code></pre><p>tcpdump、tshark和Linux里的许多工具一样，参数繁多、功能强大，你可以课后再找些资料仔细研究，这里就不做过多地介绍了。</p><h2>URI的查询参数和头字段</h2><p>在<a href=\"https://time.geekbang.org/column/article/102008\">第11讲</a>里我留了一个课下作业：</p><p>“URI的查询参数和头字段很相似，都是key-value形式，都可以任意自定义，那么它们在使用时该如何区别呢？”</p><p>从课程后的留言反馈来看，有的同学没理解这个问题的本意，误以为问题问的是这两者在表现上应该如何区分，比如查询参数是跟在“？”后面，头字段是请求头里的KV对。</p><p>这主要是怪我没有说清楚。这个问题实际上想问的是：查询参数和头字段两者的形式很相近，query是key-value，头字段也是key-value，它们有什么区别，在发送请求时应该如何正确地使用它们。</p><p>换个说法就是：<span class=\"orange\">应该在什么场景下恰当地自定义查询参数或者头字段来附加额外信息</span>。</p><p>当然了，因为HTTP协议非常灵活，这个问题也不会有唯一的、标准的答案，我只能说说我自己的理解。</p><p>因为查询参数是与URI关联在一起的，所以它针对的就是资源（URI），是长期、稳定的。而头字段是与一次HTTP请求关联的，针对的是本次请求报文，所以是短期、临时的。简单来说，就是两者的作用域和时效性是不同的。</p><p>从这一点出发，我们就可以知道在哪些场合下使用查询参数和头字段更加合适。</p><p>比如，要获取一个JS文件，而它会有多个版本，这个“版本”就是资源的一种属性，应该用查询参数来描述。而如果要压缩传输、或者控制缓存的时间，这些操作并不是资源本身固有的特性，所以用头字段来描述更好。</p><p>除了查询参数和头字段，还可以用其他的方式来向URI发送附加信息，最常用的一种方式就是POST一个JSON结构，里面能够存放比key-value复杂得多的数据，也许你早就在实际工作中这么做了。</p><p>在这种情况下，就可以完全不使用查询参数和头字段，服务器从JSON里获取所有必需的数据，让URI和请求头保持干净、整洁（^_^）。</p><p>今天的答疑就先到这里，我们下期再见，到时候再讲ECDHE算法。</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/f9/c17f3027ba3cfb45e391107a8cf04cf9.png?wh=1769*2606\" alt=\"unpreview\"></p><p></p>","comments":[{"had_liked":false,"id":320843,"user_name":"浪里淘沙的小法师","can_delete":false,"product_type":"c1","uid":2441110,"ip_address":"","ucode":"93D5AEFC0E2436","user_header":"https://static001.geekbang.org/account/avatar/00/25/3f/96/ce0b9678.jpg","comment_is_top":false,"comment_ctime":1636527964,"is_pvip":false,"replies":[{"id":"116367","content":"太高端了，都用上M1的Mac。<br><br>也可以参考GitHub里的Dockerfile，构建出基于arm的镜像。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1636549774,"ip_address":"","comment_id":320843,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48881168220","product_id":100029001,"comment_content":"讲一下用M1芯片 mac 搭建搭建环境的遇到的问题和解决方法。<br><br>1. 运行 .&#47;run.sh start 报错 &#47;usr&#47;local&#47;bin&#47;openresty: command not found<br>这是因为 M1 芯片mac 的 homebrew 安装软件的位置与以往不同，先通过 which openresty 查询 openresty 的位置 &#47;opt&#47;homebrew&#47;bin&#47;openresty，然后打开 run.sh 脚本替换一下老师写的位置<br>if [ $os != &quot;Linux&quot; ] ; then<br>    openresty=&quot;&#47;usr&#47;local&#47;bin&#47;openresty&quot;<br>fi<br>替换成<br>if [ $os != &quot;Linux&quot; ] ; then<br>    openresty=&quot;&#47;opt&#47;homebrew&#47;bin&#47;openresty&quot;<br>fi<br><br>2. 再运行 .&#47;run.sh start 报错 nginx: [emerg] could not build server_names_hash, you should increase server_names_hash_bucket_size: 32<br>网上查寻了一下，放大 bucket_size 即可，打开 www&#47;conf&#47;nginx.conf 文件添加这一句server_names_hash_bucket_size 64; 即可<br># http conf<br>http {<br>    #include     http&#47;common.conf;<br>    #include     http&#47;cache.conf;<br>    #include     http&#47;resty.conf;<br>    #include     http&#47;mime.types;<br>    server_names_hash_bucket_size 64;<br>    <br>    include     http&#47;*.conf;<br><br>    include     http&#47;servers&#47;*.conf;<br><br>}","like_count":12,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530139,"discussion_content":"太高端了，都用上M1的Mac。\n\n也可以参考GitHub里的Dockerfile，构建出基于arm的镜像。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636549774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139131,"user_name":"GitHubGanKai","can_delete":false,"product_type":"c1","uid":1477351,"ip_address":"","ucode":"BF6D6F8F3EED31","user_header":"https://static001.geekbang.org/account/avatar/00/16/8a/e7/a6c603cf.jpg","comment_is_top":false,"comment_ctime":1570551899,"is_pvip":false,"replies":[{"id":"53617","content":"we meet again.","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1570581712,"ip_address":"","comment_id":139131,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23045388379","product_id":100029001,"comment_content":"真好，又见到你了，而且我最近换个了mac，😊正愁这个。","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469804,"discussion_content":"we meet again.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570581712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2427708,"avatar":"https://static001.geekbang.org/account/avatar/00/25/0b/3c/ff1caa62.jpg","nickname":"昊瀚","note":"","ucode":"0AAA304B7F480B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360530,"discussion_content":"请问openresty上可以测试quic吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616469164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142433,"user_name":"dongge","can_delete":false,"product_type":"c1","uid":1008016,"ip_address":"","ucode":"CEFE4D0CC42907","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/90/de8c61a0.jpg","comment_is_top":false,"comment_ctime":1571367816,"is_pvip":true,"replies":[{"id":"54965","content":"这是提示Nginx要求48字节的密钥文件，按理说附带的80字节也是可以的，你可以用命令“openssl rand 48 &gt; ticket.key”重新生成www&#47;conf&#47;ssl&#47;ticket.key。<br><br>详细可参见http:&#47;&#47;nginx.org&#47;en&#47;docs&#47;http&#47;ngx_http_ssl_module.html#ssl_session_tickets<br><br>另外，你用的openresty版本太老了，用最新的1.15.8.2可能就不会出现这样的问题。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571381231,"ip_address":"","comment_id":142433,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10161302408","product_id":100029001,"comment_content":"老师好，<br>按文章指导搭建了MAC的环境：<br>openresty -v<br>nginx version: openresty&#47;1.11.2.2<br><br>在~&#47;git&#47;http_study&#47;www目录下执行<br> .&#47;run.sh start<br>Password:<br>nginx: [emerg] &quot;&#47;Users&#47;xiaodong&#47;git&#47;http_study&#47;www&#47;conf&#47;ssl&#47;ticket.key&quot; must be 48 bytes in &#47;Users&#47;xiaodong&#47;git&#47;http_study&#47;www&#47;conf&#47;nginx.conf:34<br>报了这个错误，在网上google没找到解决方法。<br>尝试在nginx.conf中注销相关代码，也会报其他错误。<br>老师能指点一下吗？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471123,"discussion_content":"这是提示Nginx要求48字节的密钥文件，按理说附带的80字节也是可以的，你可以用命令“openssl rand 48 &amp;gt; ticket.key”重新生成www/conf/ssl/ticket.key。\n\n详细可参见http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_session_tickets\n\n另外，你用的openresty版本太老了，用最新的1.15.8.2可能就不会出现这样的问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571381231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008016,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/61/90/de8c61a0.jpg","nickname":"dongge","note":"","ucode":"CEFE4D0CC42907","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36962,"discussion_content":"谢谢，您给出的两种方法都好使。\n继续体验，把课程都实践一遍。\n使用 brew 默认安装的，安装了denji/nginx/openresty。\n\nbrew info openresty\nError: Formulae found in multiple taps:\n       * denji/nginx/openresty\n       * homebrew/nginx/openresty\n如果选择homebrew/nginx/openresty就没这个问题了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571470559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197198,"user_name":"Change","can_delete":false,"product_type":"c1","uid":1161260,"ip_address":"","ucode":"FB60D2378C9F02","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/2c/0f7baf3a.jpg","comment_is_top":false,"comment_ctime":1585362946,"is_pvip":false,"replies":[{"id":"74824","content":"可能需要sudo，是否权限的问题。<br><br>可以在网上搜一下错误信息，Nginx的问题一般都有现成的解决办法。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1585532485,"ip_address":"","comment_id":197198,"utype":1}],"discussion_count":7,"race_medal":2,"score":"5880330242","product_id":100029001,"comment_content":"老师请教个问题：Mac 环境下安装以后，按照命令.&#47;run.sh start 启动后访问 localhost 显示403 Forbidden：终端返回的错误信息是下面的错误信息，这是所有端口都被占用了？我查了一下好像也没有被占用啊，不知道这是啥原因<br>nginx: [emerg] bind() to 0.0.0.0:80 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:8080 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:443 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:8443 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:440 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:441 failed (48: Address already in use)<br>nginx: [emerg] bind() to 0.0.0.0:442 failed (48: Address already in use)<br>","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489473,"discussion_content":"可能需要sudo，是否权限的问题。\n\n可以在网上搜一下错误信息，Nginx的问题一般都有现成的解决办法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585532485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161260,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b8/2c/0f7baf3a.jpg","nickname":"Change","note":"","ucode":"FB60D2378C9F02","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217207,"discussion_content":"问题看文章评论解决了，但原因还不知，在conf/nginx.conf 文件顶部添加 user 本机名 用户组；通过 ls -la html 查看本机名 用户组 的名字","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585529779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1188155,"avatar":"https://static001.geekbang.org/account/avatar/00/12/21/3b/5e742d65.jpg","nickname":"fakeowens","note":"","ucode":"DB33A069D8E908","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1161260,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b8/2c/0f7baf3a.jpg","nickname":"Change","note":"","ucode":"FB60D2378C9F02","race_medal":2,"user_type":1,"is_pvip":false},"discussion":{"id":376864,"discussion_content":"亲测有效！！！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622386062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":217207,"ip_address":""},"score":376864,"extra":""},{"author":{"id":1603785,"avatar":"https://static001.geekbang.org/account/avatar/00/18/78/c9/6ed5ad55.jpg","nickname":"超轶主","note":"","ucode":"2E6578E7FC3AF0","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1188155,"avatar":"https://static001.geekbang.org/account/avatar/00/12/21/3b/5e742d65.jpg","nickname":"fakeowens","note":"","ucode":"DB33A069D8E908","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538132,"discussion_content":"有代码可以借鉴一下不","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639331189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376864,"ip_address":""},"score":538132,"extra":""}]},{"author":{"id":1293186,"avatar":"https://static001.geekbang.org/account/avatar/00/13/bb/82/5a32de87.jpg","nickname":"泷沁心","note":"","ucode":"E811D9F1A17689","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371929,"discussion_content":"一般是端口被占用，kill掉就可以了：\nps -ef|grep nginx\n\nsudo kill 43162\n\nsudo ./run.sh  start","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1620059345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622655,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c2/7f/7b22f12b.jpg","nickname":"乔","note":"","ucode":"1286F8742B4A01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298886,"discussion_content":"查了一下原因是说这里要和nginx的启动用户一致。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597462645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622655,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c2/7f/7b22f12b.jpg","nickname":"乔","note":"","ucode":"1286F8742B4A01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298884,"discussion_content":"遇到同样的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597462201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148873,"user_name":"SmNiuhe","can_delete":false,"product_type":"c1","uid":1021481,"ip_address":"","ucode":"2589993BDD975B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/29/bcf885b9.jpg","comment_is_top":false,"comment_ctime":1573098004,"is_pvip":false,"replies":[{"id":"57298","content":"如果mac安装有问题，可以用virtualbox装个Linux虚拟机，暂解燃眉之急。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573106303,"ip_address":"","comment_id":148873,"utype":1}],"discussion_count":6,"race_medal":0,"score":"5868065300","product_id":100029001,"comment_content":"这个大家有遇到嘛，是不是资源的问题<br>brew install openresty&#47;brew&#47;openresty ：DownloadError: Failed to download resource &quot;openresty-openssl--patch&quot;<br>Download failed: https:&#47;&#47;raw.githubusercontent.com&#47;openresty&#47;openresty&#47;master&#47;patches&#47;openssl-1.1.0d-sess_set_get_cb_yield.patch","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473647,"discussion_content":"如果mac安装有问题，可以用virtualbox装个Linux虚拟机，暂解燃眉之急。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573106303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1993491,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6b/13/38a14e66.jpg","nickname":"果汁","note":"","ucode":"482168428ACE6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262219,"discussion_content":"https://www.cnblogs.com/sinferwu/p/12726833.html  用了这里面的方法，加上梯子，终于好了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589040697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1180460,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/2c/33ba4d12.jpg","nickname":"山中无老虎 😪","note":"","ucode":"594247C3A976DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311024,"discussion_content":"加个host  151.101.76.133 raw.githubusercontent.com 可以搞定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602174705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1158598,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ad/c6/9397d3e4.jpg","nickname":"Q","note":"","ucode":"85A530171FACF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":163143,"discussion_content":"你看下能不能连接raw.githubusercontent.com，如果连接不上尝试用手机热点，再不行尝试一下 sudo gem install redis 这个指令再brew，亲测可用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581052084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1292952,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ba/98/22e7df03.jpg","nickname":"繁忙的耗子","note":"","ucode":"EE7DB1CC44AAC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1158598,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ad/c6/9397d3e4.jpg","nickname":"Q","note":"","ucode":"85A530171FACF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261837,"discussion_content":"这个文件下到哪里去了呀？我可以手动下载下来，但是执行命令就会报错，我想手动放到文件要下载的地方","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589012743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":163143,"ip_address":""},"score":261837,"extra":""},{"author":{"id":1256441,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2b/f9/354a2fdc.jpg","nickname":"jayding","note":"","ucode":"29F10ADD6494AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1292952,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ba/98/22e7df03.jpg","nickname":"繁忙的耗子","note":"","ucode":"EE7DB1CC44AAC2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337287,"discussion_content":"199.232.96.133 raw.githubusercontent.com","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608863438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261837,"ip_address":""},"score":337287,"extra":""}]}]},{"had_liked":false,"id":326047,"user_name":"超轶主","can_delete":false,"product_type":"c1","uid":1603785,"ip_address":"","ucode":"2E6578E7FC3AF0","user_header":"https://static001.geekbang.org/account/avatar/00/18/78/c9/6ed5ad55.jpg","comment_is_top":false,"comment_ctime":1639330762,"is_pvip":false,"replies":[{"id":"118280","content":"后面要加参数，start|stop|reload|list。<br><br>脚本比较简单，可以用vi看看。","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1639366857,"ip_address":"","comment_id":326047,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1639330762","product_id":100029001,"comment_content":"mac环境运行 run run.sh 返回 nginx version: openresty&#47;1.19.9.1<br>format : run.sh [start|stop|reload|list]是什么情况呢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538206,"discussion_content":"后面要加参数，start|stop|reload|list。\n\n脚本比较简单，可以用vi看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639366857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308507,"user_name":"silence","can_delete":false,"product_type":"c1","uid":1540936,"ip_address":"","ucode":"92689E713088CB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/eHNmzejyQW9Ag5g3EELS1d9pTgJsvxC7CxSCxIFQqeFLXUDT52HWianQWzw14kaAT4P9UhTUSNficc9W5DlWZWJQ/132","comment_is_top":false,"comment_ctime":1629652056,"is_pvip":false,"replies":[{"id":"111691","content":"是不是没有安装好openresty，看看是哪个命令没找到，再按照课程正文是否遗漏了哪个步骤。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1629680112,"ip_address":"","comment_id":308507,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1629652056","product_id":100029001,"comment_content":"请问安装好环境后在www目录执行.&#47;run.sh start 老是command not found怎么解决","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525511,"discussion_content":"是不是没有安装好openresty，看看是哪个命令没找到，再按照课程正文是否遗漏了哪个步骤。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629680112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2441110,"avatar":"https://static001.geekbang.org/account/avatar/00/25/3f/96/ce0b9678.jpg","nickname":"浪里淘沙的小法师","note":"","ucode":"93D5AEFC0E2436","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413611,"discussion_content":"M1 芯片的 mac 默认就是 /opt/homebrew/Cellar/openresty/，我也遇到这个问题了，你解决了嘛，我还没搞定 <-_->，啊呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636525815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1540936,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/eHNmzejyQW9Ag5g3EELS1d9pTgJsvxC7CxSCxIFQqeFLXUDT52HWianQWzw14kaAT4P9UhTUSNficc9W5DlWZWJQ/132","nickname":"silence","note":"","ucode":"92689E713088CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390288,"discussion_content":"sudo: /usr/local/bin/openresty: command not found \n这个问题似乎是因为我的homebrew将openresty安装在/opt/homebrew/Cellar/openresty/目录下，从而导致的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629765155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298921,"user_name":"Miroticwillbeforever","can_delete":false,"product_type":"c1","uid":2488913,"ip_address":"","ucode":"1DDD8AECD93EA8","user_header":"https://static001.geekbang.org/account/avatar/00/25/fa/51/5da91010.jpg","comment_is_top":false,"comment_ctime":1624374955,"is_pvip":false,"replies":[{"id":"108428","content":"域名解析这个问题确实困扰了不少同学，因为我们实验环境的域名是假的，只能在本地用，所以有可能会与某些真实的域名冲突，导致输入域名跑到了外网而不是实际环境。<br><br>解决方法是改hosts文件，但因为域名会有缓存，所以有时候改了hosts也不会生效。如果遇到这种情况，最好是换个实验环境，改成虚拟机或者docker。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1624412280,"ip_address":"","comment_id":298921,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1624374955","product_id":100029001,"comment_content":"老师我有个问题。实验环境搭建好了。前两讲的实验也做成功了。<br>但是当我用浏览器 访问 www.chrono.com 时，它跳转到的 地址为 https:&#47;&#47;dp.diandongzhi.com&#47;?acct=660&amp;site=chrono.com 然后wireshark抓包并没有任何反应。我想问一下是我操作不当的原因还是怎么回事。课程大部分听完了。但是后面实验没做成挺难受的，没有去验证。等老师给个答复准备二刷！","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522277,"discussion_content":"域名解析这个问题确实困扰了不少同学，因为我们实验环境的域名是假的，只能在本地用，所以有可能会与某些真实的域名冲突，导致输入域名跑到了外网而不是实际环境。\n\n解决方法是改hosts文件，但因为域名会有缓存，所以有时候改了hosts也不会生效。如果遇到这种情况，最好是换个实验环境，改成虚拟机或者docker。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624412280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2488913,"avatar":"https://static001.geekbang.org/account/avatar/00/25/fa/51/5da91010.jpg","nickname":"Miroticwillbeforever","note":"","ucode":"1DDD8AECD93EA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380274,"discussion_content":"好。谢谢老师的回复。已经成功使用docker镜像搭建实验环境。剩下的就是愉快的学习啦。\n然后祝福老师的专栏越来越好。为老师这种敬业精神点个赞，基本很多评论我都看，老师都会不遗余力的解答。学到了很多！再次感谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624421513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284342,"user_name":"Erebus","can_delete":false,"product_type":"c1","uid":1660330,"ip_address":"","ucode":"81CC93A6D7A4BA","user_header":"https://static001.geekbang.org/account/avatar/00/19/55/aa/c79c292c.jpg","comment_is_top":false,"comment_ctime":1616203621,"is_pvip":false,"replies":[{"id":"103144","content":" 这个提示信息太模糊了，不好帮你。<br><br>可以网上搜一下错误信息，一般都能找到解决方案。或者把OpenResty、GitHub项目重新安装看看。<br><br>还是不行就改用docker试试。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1616245935,"ip_address":"","comment_id":284342,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1616203621","product_id":100029001,"comment_content":"老师你好、我安装好了openrestry后、启动服务说 nginx：invalid option：http，请问是怎么回事呀","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517315,"discussion_content":" 这个提示信息太模糊了，不好帮你。\n\n可以网上搜一下错误信息，一般都能找到解决方案。或者把OpenResty、GitHub项目重新安装看看。\n\n还是不行就改用docker试试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616245935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281293,"user_name":"小童","can_delete":false,"product_type":"c1","uid":1763395,"ip_address":"","ucode":"300444B520E79D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e8/43/f9c0faed.jpg","comment_is_top":false,"comment_ctime":1614677439,"is_pvip":false,"replies":[{"id":"102156","content":"可以先试试Wireshark能不能抓其他网络的包，然后再试试抓本地（loopback），再加上过滤器，逐步分析来缩小范围。<br><br>如果还不行，可以试着换个环境，用虚拟机+Linux或者docker，这样的环境比较单纯隔离。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1614734604,"ip_address":"","comment_id":281293,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1614677439","product_id":100029001,"comment_content":"不行啊，老师，我的那个openresty界面出来了，就是抓不到包！用的wireshark .搞了好久。那个telnet也安装了。是不是那步出错了 ，我就直接运行openresty，然后用抓包工具过滤信息，然后浏览器输入localhost，浏览器洁界面也出来了。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516346,"discussion_content":"可以先试试Wireshark能不能抓其他网络的包，然后再试试抓本地（loopback），再加上过滤器，逐步分析来缩小范围。\n\n如果还不行，可以试着换个环境，用虚拟机+Linux或者docker，这样的环境比较单纯隔离。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614734604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763395,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e8/43/f9c0faed.jpg","nickname":"小童","note":"","ucode":"300444B520E79D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352620,"discussion_content":"老师，那个telnet 我在mac环境我应该敲什么命令？telnet  localhost吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614781233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242821,"user_name":"旗木卡卡","can_delete":false,"product_type":"c1","uid":1104407,"ip_address":"","ucode":"2C05BFE91D6892","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/17/69cca649.jpg","comment_is_top":false,"comment_ctime":1597848840,"is_pvip":false,"replies":[{"id":"89534","content":"虽然都是unix，但mac的环境和Linux还是不太一样，辛苦了。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1597884880,"ip_address":"","comment_id":242821,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1597848840","product_id":100029001,"comment_content":"Mac电脑，耗费本人2个晚上的环境，终于搭好了，碰到了2个坑，第一个是dns查找不到，brew install openresty时，需要在本机的hosts文件，加上解析不到的url的ip地址，第二个是启动一直bind不上，nginx就自动启动了，但是很明显不是openresty，然后用root权限启动成功，也可以正常访问，发现是nginx.conf的user权限问题，修改成本机的用户user kaka(你的用户名) staff;即可。 ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504105,"discussion_content":"虽然都是unix，但mac的环境和Linux还是不太一样，辛苦了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597884880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1806594,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/91/02/f75b2b06.jpg","nickname":"西瓜超人","note":"","ucode":"FED187C21E44E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304642,"discussion_content":"你好，我也遇到了同样问题，能详细说一下解决步骤吗，谢啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599633370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1104407,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/17/69cca649.jpg","nickname":"旗木卡卡","note":"","ucode":"2C05BFE91D6892","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1806594,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/91/02/f75b2b06.jpg","nickname":"西瓜超人","note":"","ucode":"FED187C21E44E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305090,"discussion_content":"解决了吗？现在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599783105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304642,"ip_address":""},"score":305090,"extra":""}]}]},{"had_liked":false,"id":214973,"user_name":"Luka!3055","can_delete":false,"product_type":"c1","uid":1133179,"ip_address":"","ucode":"BCB6E7C29ED46C","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/7b/23da5db9.jpg","comment_is_top":false,"comment_ctime":1588861432,"is_pvip":false,"replies":[{"id":"79594","content":"nice","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1588888735,"ip_address":"","comment_id":214973,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1588861432","product_id":100029001,"comment_content":"记录下问题：<br><br>brew install openresty&#47;brew&#47;openresty 后，报错：<br>curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused<br>Error: An exception occurred within a child process:<br>DownloadError: Failed to download resource &quot;openresty-openssl--patch&quot;<br>Download failed: https:&#47;&#47;raw.githubusercontent.com&#47;openresty&#47;openresty&#47;master&#47;patches&#47;openssl-1.1.0d-sess_set_get_cb_yield.patch<br><br>此时把 DNS 设置为 114.114.114.114 或者 8.8.8.8 就好了，最好再挂个梯子","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494266,"discussion_content":"nice","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588888735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208958,"user_name":"Jinlee","can_delete":false,"product_type":"c1","uid":1644723,"ip_address":"","ucode":"8EDA9B0C5184EA","user_header":"https://static001.geekbang.org/account/avatar/00/19/18/b3/848ffa10.jpg","comment_is_top":false,"comment_ctime":1587473806,"is_pvip":false,"replies":[{"id":"78115","content":"nice","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1587507621,"ip_address":"","comment_id":208958,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1587473806","product_id":100029001,"comment_content":"Welcome to HTTP Study Page! 还好我看得迟，成功在ubuntu下搭建起环境😊😊😊","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492684,"discussion_content":"nice","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587507621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169033,"user_name":"test","can_delete":false,"product_type":"c1","uid":1129610,"ip_address":"","ucode":"C57A175CBC6547","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg","comment_is_top":false,"comment_ctime":1578245009,"is_pvip":false,"replies":[{"id":"65546","content":"搭好后一定要多做实验，实践出真知。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1578272499,"ip_address":"","comment_id":169033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578245009","product_id":100029001,"comment_content":"最喜欢实验环境了，之前学习就是苦于没实验环境浪费了几年时间。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480409,"discussion_content":"搭好后一定要多做实验，实践出真知。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578272499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151728,"user_name":"无名","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1573782277,"is_pvip":false,"replies":[{"id":"58329","content":"10.15是新出的，我没升级，看这些信息像是openresty在这上面安装有问题（luajit编译失败），可以向官方反应一下，只能期待官方更新包了。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1573783937,"ip_address":"","comment_id":151728,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1573782277","product_id":100029001,"comment_content":"Updating Homebrew...<br>==&gt; Auto-updated Homebrew!<br>Updated 1 tap (homebrew&#47;core).<br>==&gt; Updated Formulae<br>handbrake<br><br>==&gt; Installing openresty from openresty&#47;brew<br>==&gt; Downloading https:&#47;&#47;openresty.org&#47;download&#47;openresty-1.15.8.2.tar.gz<br>Already downloaded: &#47;Users&#47;hejunbin&#47;Library&#47;Caches&#47;Homebrew&#47;downloads&#47;4395089f0fd423261d4f1124b7beb0f69e1121e59d399e89eaa6e25b641333bc--openresty-1.15.8.2.tar.gz<br>==&gt; .&#47;configure -j8 --prefix=&#47;usr&#47;local&#47;Cellar&#47;openresty&#47;1.15.8.2 --pid-path=&#47;us<br>Last 15 lines from &#47;Users&#47;hejunbin&#47;Library&#47;Logs&#47;Homebrew&#47;openresty&#47;01.configure:<br>DYNASM    host&#47;buildvm_arch.h<br>HOSTCC    host&#47;buildvm.o<br>HOSTLINK  host&#47;buildvm<br>BUILDVM   lj_vm.S<br>BUILDVM   lj_ffdef.h<br>BUILDVM   lj_bcdef.h<br>BUILDVM   lj_folddef.h<br>BUILDVM   lj_recdef.h<br>BUILDVM   lj_libdef.h<br>BUILDVM   jit&#47;vmdef.lua<br>make[1]: *** [lj_folddef.h] Segmentation fault: 11<br>make[1]: *** Deleting file `lj_folddef.h&#39;<br>make[1]: *** Waiting for unfinished jobs....<br>make: *** [default] Error 2<br>ERROR: failed to run command: gmake -j8 TARGET_STRIP=@: CCDEBUG=-g XCFLAGS=&#39;-msse4.2 -DLUAJIT_NUMMODE=2 -DLUAJIT_ENABLE_LUA52COMPAT&#39; CC=cc PREFIX=&#47;usr&#47;local&#47;Cellar&#47;openresty&#47;1.15.8.2&#47;luajit<br><br>If reporting this issue please do so at (not Homebrew&#47;brew or Homebrew&#47;core):<br>  https:&#47;&#47;github.com&#47;openresty&#47;homebrew-brew&#47;issues<br><br>These open issues may also help:<br>Can&#39;t install openresty on macOS 10.15 https:&#47;&#47;github.com&#47;openresty&#47;homebrew-brew&#47;issues&#47;10<br>Fails to install OpenResty https:&#47;&#47;github.com&#47;openresty&#47;homebrew-brew&#47;issues&#47;5<br>The openresty-debug package should use openresty-openssl-debug instead https:&#47;&#47;github.com&#47;openresty&#47;homebrew-brew&#47;issues&#47;3<br><br>macOS 10.15.1 安装失败。参考给出的链接也没有解决问题，求老师解惑。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474590,"discussion_content":"10.15是新出的，我没升级，看这些信息像是openresty在这上面安装有问题（luajit编译失败），可以向官方反应一下，只能期待官方更新包了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573783937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205374,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/7e/ea984339.jpg","nickname":"Nicholas","note":"","ucode":"2FC42B9C579452","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":67046,"discussion_content":"解决方法：\n第一种：\nbrew edit openresty/brew/openresty\n找到此行：--with-luajit-xcflags，最后增加内容：\\ -fno-stack-check\n改完后：      --with-luajit-xcflags=-DLUAJIT_NUMMODE=2\\ -DLUAJIT_ENABLE_LUA52COMPAT\\ -fno-stack-check\n\n然后重开一个窗口，重新执行：brew install openresty/brew/openresty\n\n就可以安装成功\n\n第二种方法：（本人未测试）\n把本地的xcode更新到11.2\n\n安装成功后，进到目录：http_study/www，执行：./run.sh start 启动 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575121132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142269,"user_name":"Dream.","can_delete":false,"product_type":"c1","uid":1187286,"ip_address":"","ucode":"49B94CE5BA0D21","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/d6/76fe5259.jpg","comment_is_top":false,"comment_ctime":1571322480,"is_pvip":false,"replies":[{"id":"54890","content":"我这里没有遇到你这样的现象。<br><br>先用run.sh list看看Nginx进程是否正常运行，然后用netstat等工具检查一下监听端口，是否有防火墙什么的其他应用阻碍了服务。<br><br>可以问问周围熟悉Linux运维的同事。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571359760,"ip_address":"","comment_id":142269,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1571322480","product_id":100029001,"comment_content":"Linux-CentOS 7下，修改了&#47;etc&#47;hosts的域名与IP的映射关系后<br><br>再使用.&#47;run.sh start启动OpenResty之后<br><br>curl localhost 或者 curl http:&#47;&#47;www.chrono.com都是返回403<br><br>按之前课程里的url访问https:&#47;&#47;www.chrono.com&#47;11-1什么的，都返回404<br><br>第一次接触OpenResty，麻烦老师回复下是哪里没配置好嘛？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471052,"discussion_content":"我这里没有遇到你这样的现象。\n\n先用run.sh list看看Nginx进程是否正常运行，然后用netstat等工具检查一下监听端口，是否有防火墙什么的其他应用阻碍了服务。\n\n可以问问周围熟悉Linux运维的同事。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571359760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":153440,"discussion_content":"我在mac上也遇到403了，在第7课下面的留言中有答案：\n\n原作者：Fstar\n对 cylim 的 mac 上运行 openresty 的教程进行补充：\n按照 cylim 的做法，我遇到了访问 localhost 时，网页报 403 错误的情况，原因是没有 html/index.html 文件的访问权限。我研究并找到了解决方案：\n先 ls -la html，查看文件的权限，得到 user 和 group，我这里是 fstar 和 staff。\n\n然后在 conf/nginx.conf 文件的顶部添加\n\nuser fstar staff;\n\n然后再启动 openresty 就可以正常访问了。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1580047658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1619597,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","nickname":"dog_brother","note":"","ucode":"9F64D3C6D815FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1474356,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3F4IdQuDZrhN8ThibP85eCiaSWTYpTrcC6QB9EoAkw3IIj6otMibb1CgrS1uzITAnJmGLXQ2tgIkAQ/132","nickname":"cugphoenix","note":"","ucode":"80101AF04C00D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372488,"discussion_content":"我是Centos，按照这个方法修改好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620354691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":153440,"ip_address":""},"score":372488,"extra":""}]},{"author":{"id":1161260,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b8/2c/0f7baf3a.jpg","nickname":"Change","note":"","ucode":"FB60D2378C9F02","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217202,"discussion_content":"-rw-r--r--我的文件权限访问 localhost也是403，但按照你这个就成功了，不知道啥原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585529430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141656,"user_name":"dongge","can_delete":false,"product_type":"c1","uid":1008016,"ip_address":"","ucode":"CEFE4D0CC42907","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/90/de8c61a0.jpg","comment_is_top":false,"comment_ctime":1571208390,"is_pvip":true,"replies":[{"id":"54721","content":"答疑篇来的太晚了，没赶上当初的热度，不过总会有需要的同学看到的。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571215041,"ip_address":"","comment_id":141656,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571208390","product_id":100029001,"comment_content":"这个专栏这么好玩，留言的人这么少，真可惜。<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470839,"discussion_content":"答疑篇来的太晚了，没赶上当初的热度，不过总会有需要的同学看到的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571215041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140445,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1570944938,"is_pvip":false,"replies":[{"id":"54339","content":"nice to meet you again.","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1571015655,"ip_address":"","comment_id":140445,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570944938","product_id":100029001,"comment_content":"老师又来了，很高兴再次见到老师。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470390,"discussion_content":"nice to meet you again.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571015655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139332,"user_name":"果果","can_delete":false,"product_type":"c1","uid":1549835,"ip_address":"","ucode":"447E3A8A76FBD7","user_header":"https://static001.geekbang.org/account/avatar/00/17/a6/0b/d296c751.jpg","comment_is_top":false,"comment_ctime":1570613392,"is_pvip":false,"replies":[{"id":"53697","content":"这篇答疑来晚了，实在是抱歉。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1570613767,"ip_address":"","comment_id":139332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570613392","product_id":100029001,"comment_content":"当初费了好些时间，才在mac上搭建了环境","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469896,"discussion_content":"这篇答疑来晚了，实在是抱歉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570613767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}