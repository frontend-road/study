{"id":209520,"title":"02 | ä»£ç åŠ é”ï¼šä¸è¦è®©â€œé”â€äº‹æˆä¸ºçƒ¦å¿ƒäº‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚</p><p>åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä¸ä½ ä»‹ç»äº†ä½¿ç”¨å¹¶å‘å®¹å™¨ç­‰å·¥å…·è§£å†³çº¿ç¨‹å®‰å…¨çš„è¯¯åŒºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å¦ä¸€ç§é‡è¦æ‰‹æ®µâ€”â€”é”ï¼Œåœ¨ä½¿ç”¨ä¸Šæ¯”è¾ƒå®¹æ˜“çŠ¯å“ªäº›é”™ã€‚</p><p>æˆ‘å…ˆå’Œä½ åˆ†äº«ä¸€ä¸ªæœ‰è¶£çš„æ¡ˆä¾‹å§ã€‚æœ‰ä¸€å¤©ï¼Œä¸€ä½åŒå­¦åœ¨ç¾¤é‡Œè¯´â€œè§é¬¼äº†ï¼Œç–‘ä¼¼é‡åˆ°äº†ä¸€ä¸ªJVMçš„Bugâ€ï¼Œæˆ‘ä»¬éƒ½å¾ˆå¥½å¥‡æ˜¯ä»€ä¹ˆBugã€‚</p><p>äºæ˜¯ï¼Œä»–è´´å‡ºäº†è¿™æ ·ä¸€æ®µä»£ç ï¼šåœ¨ä¸€ä¸ªç±»é‡Œæœ‰ä¸¤ä¸ªintç±»å‹çš„å­—æ®µaå’Œbï¼Œæœ‰ä¸€ä¸ªaddæ–¹æ³•å¾ªç¯1ä¸‡æ¬¡å¯¹aå’Œbè¿›è¡Œ++æ“ä½œï¼Œæœ‰å¦ä¸€ä¸ªcompareæ–¹æ³•ï¼ŒåŒæ ·å¾ªç¯1ä¸‡æ¬¡åˆ¤æ–­aæ˜¯å¦å°äºbï¼Œæ¡ä»¶æˆç«‹å°±æ‰“å°aå’Œbçš„å€¼ï¼Œå¹¶åˆ¤æ–­a&gt;bæ˜¯å¦æˆç«‹ã€‚</p><pre><code>@Slf4j\npublic class Interesting {\n\n    volatile int a = 1;\n    volatile int b = 1;\n\n    public void add() {\n        log.info(&quot;add start&quot;);\n        for (int i = 0; i &lt; 10000; i++) {\n            a++;\n            b++;\n        }\n        log.info(&quot;add done&quot;);\n    }\n\n    public void compare() {\n        log.info(&quot;compare start&quot;);\n        for (int i = 0; i &lt; 10000; i++) {\n            //aå§‹ç»ˆç­‰äºbå—ï¼Ÿ\n            if (a &lt; b) {\n                log.info(&quot;a:{},b:{},{}&quot;, a, b, a &gt; b);\n                //æœ€åçš„a&gt;båº”è¯¥å§‹ç»ˆæ˜¯falseå—ï¼Ÿ\n            }\n        }\n        log.info(&quot;compare done&quot;);\n    }\n}\n</code></pre><p>ä»–èµ·äº†ä¸¤ä¸ªçº¿ç¨‹æ¥åˆ†åˆ«æ‰§è¡Œaddå’Œcompareæ–¹æ³•ï¼š</p><pre><code>Interesting interesting = new Interesting();\nnew Thread(() -&gt; interesting.add()).start();\nnew Thread(() -&gt; interesting.compare()).start();\n</code></pre><p>æŒ‰é“ç†ï¼Œaå’ŒbåŒæ ·è¿›è¡Œç´¯åŠ æ“ä½œï¼Œåº”è¯¥å§‹ç»ˆç›¸ç­‰ï¼Œcompareä¸­çš„ç¬¬ä¸€æ¬¡åˆ¤æ–­åº”è¯¥å§‹ç»ˆä¸ä¼šæˆç«‹ï¼Œä¸ä¼šè¾“å‡ºä»»ä½•æ—¥å¿—ã€‚ä½†ï¼Œæ‰§è¡Œä»£ç åå‘ç°ä¸ä½†è¾“å‡ºäº†æ—¥å¿—ï¼Œè€Œä¸”æ›´è¯¡å¼‚çš„æ˜¯ï¼Œcompareæ–¹æ³•åœ¨åˆ¤æ–­a&lt;bæˆç«‹çš„æƒ…å†µä¸‹è¿˜è¾“å‡ºäº†a&gt;bä¹Ÿæˆç«‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9e/1d/9ec61aada64ac6d38681dd199c0ee61d.png?wh=1884*312\" alt=\"\"></p><p>ç¾¤é‡Œä¸€ä½åŒå­¦çœ‹åˆ°è¿™ä¸ªé—®é¢˜ç¬‘äº†ï¼Œè¯´ï¼šâ€œè¿™å“ªæ˜¯JVMçš„Bugï¼Œåˆ†æ˜æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜å˜›ã€‚å¾ˆæ˜æ˜¾ï¼Œä½ è¿™æ˜¯åœ¨æ“ä½œä¸¤ä¸ªå­—æ®µaå’Œbï¼Œæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œåº”è¯¥ä¸ºaddæ–¹æ³•åŠ ä¸Šé”ï¼Œç¡®ä¿aå’Œbçš„++æ˜¯åŸå­æ€§çš„ï¼Œå°±ä¸ä¼šé”™ä¹±äº†ã€‚â€éšåï¼Œä»–ä¸ºaddæ–¹æ³•åŠ ä¸Šäº†é”ï¼š</p><!-- [[[read_end]]] --><pre><code>public synchronized void add()\n</code></pre><p>ä½†ï¼ŒåŠ é”åé—®é¢˜å¹¶æ²¡æœ‰è§£å†³ã€‚</p><p>æˆ‘ä»¬æ¥ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆé”å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜å‘¢ã€‚å› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹¿åˆ°é”ï¼Œæ‰€ä»¥åŠ é”åçš„ä»£ç ä¸­çš„èµ„æºæ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œ<strong>è¿™ä¸ªæ¡ˆä¾‹ä¸­çš„addæ–¹æ³•å§‹ç»ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œï¼Œæ˜¾ç„¶åªä¸ºaddæ–¹æ³•åŠ é”æ˜¯æ²¡ç”¨çš„</strong>ã€‚</p><p>ä¹‹æ‰€ä»¥å‡ºç°è¿™ç§é”™ä¹±ï¼Œæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹æ˜¯äº¤é”™æ‰§è¡Œaddå’Œcompareæ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”è¿™äº›ä¸šåŠ¡é€»è¾‘ä¸æ˜¯åŸå­æ€§çš„ï¼ša++å’Œb++æ“ä½œä¸­å¯ä»¥ç©¿æ’åœ¨compareæ–¹æ³•çš„æ¯”è¾ƒä»£ç ä¸­ï¼›æ›´éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œa&lt;bè¿™ç§æ¯”è¾ƒæ“ä½œåœ¨å­—èŠ‚ç å±‚é¢æ˜¯åŠ è½½aã€åŠ è½½bå’Œæ¯”è¾ƒä¸‰æ­¥ï¼Œä»£ç è™½ç„¶æ˜¯ä¸€è¡Œä½†ä¹Ÿä¸æ˜¯åŸå­æ€§çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼Œä¸ºaddå’Œcompareéƒ½åŠ ä¸Šæ–¹æ³•é”ï¼Œç¡®ä¿addæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œcompareæ— æ³•è¯»å–aå’Œbï¼š</p><pre><code>public synchronized void add()\npublic synchronized void compare()\n</code></pre><p>æ‰€ä»¥ï¼Œä½¿ç”¨é”è§£å†³é—®é¢˜ä¹‹å‰ä¸€å®šè¦ç†æ¸…æ¥šï¼Œæˆ‘ä»¬è¦ä¿æŠ¤çš„æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µåˆæ˜¯æ€æ ·çš„ã€‚</p><h2>åŠ é”å‰è¦æ¸…æ¥šé”å’Œè¢«ä¿æŠ¤çš„å¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„</h2><p>é™¤äº†æ²¡æœ‰åˆ†ææ¸…çº¿ç¨‹ã€ä¸šåŠ¡é€»è¾‘å’Œé”ä¸‰è€…ä¹‹é—´çš„å…³ç³»éšæ„æ·»åŠ æ— æ•ˆçš„æ–¹æ³•é”å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„é”™è¯¯æ˜¯ï¼Œæ²¡æœ‰ç†æ¸…æ¥šé”å’Œè¦ä¿æŠ¤çš„å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå±‚é¢çš„ã€‚</p><p>æˆ‘ä»¬çŸ¥é“<strong>é™æ€å­—æ®µå±äºç±»ï¼Œç±»çº§åˆ«çš„é”æ‰èƒ½ä¿æŠ¤ï¼›è€Œéé™æ€å­—æ®µå±äºç±»å®ä¾‹ï¼Œå®ä¾‹çº§åˆ«çš„é”å°±å¯ä»¥ä¿æŠ¤ã€‚</strong></p><p>å…ˆçœ‹çœ‹è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼šåœ¨ç±»Dataä¸­å®šä¹‰äº†ä¸€ä¸ªé™æ€çš„intå­—æ®µcounterå’Œä¸€ä¸ªéé™æ€çš„wrongæ–¹æ³•ï¼Œå®ç°counterå­—æ®µçš„ç´¯åŠ æ“ä½œã€‚</p><pre><code>class Data {\n    @Getter\n    private static int counter = 0;\n    \n    public static int reset() {\n        counter = 0;\n        return counter;\n    }\n\n    public synchronized void wrong() {\n        counter++;\n    }\n}\n</code></pre><p>å†™ä¸€æ®µä»£ç æµ‹è¯•ä¸‹ï¼š</p><pre><code>@GetMapping(&quot;wrong&quot;)\npublic int wrong(@RequestParam(value = &quot;count&quot;, defaultValue = &quot;1000000&quot;) int count) {\n    Data.reset();\n    //å¤šçº¿ç¨‹å¾ªç¯ä¸€å®šæ¬¡æ•°è°ƒç”¨Dataç±»ä¸åŒå®ä¾‹çš„wrongæ–¹æ³•\n    IntStream.rangeClosed(1, count).parallel().forEach(i -&gt; new Data().wrong());\n    return Data.getCounter();\n}\n</code></pre><p>å› ä¸ºé»˜è®¤è¿è¡Œ100ä¸‡æ¬¡ï¼Œæ‰€ä»¥æ‰§è¡Œååº”è¯¥è¾“å‡º100ä¸‡ï¼Œä½†é¡µé¢è¾“å‡ºçš„æ˜¯639242ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/77/0b/777f520e9d0be89b66e814d3e7c1a30b.png?wh=858*178\" alt=\"\"></p><p>æˆ‘ä»¬æ¥åˆ†æä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜å§ã€‚</p><p>åœ¨éé™æ€çš„wrongæ–¹æ³•ä¸ŠåŠ é”ï¼Œåªèƒ½ç¡®ä¿å¤šä¸ªçº¿ç¨‹æ— æ³•æ‰§è¡ŒåŒä¸€ä¸ªå®ä¾‹çš„wrongæ–¹æ³•ï¼Œå´ä¸èƒ½ä¿è¯ä¸ä¼šæ‰§è¡Œä¸åŒå®ä¾‹çš„wrongæ–¹æ³•ã€‚è€Œé™æ€çš„counteråœ¨å¤šä¸ªå®ä¾‹ä¸­å…±äº«ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>ç†æ¸…æ€è·¯åï¼Œä¿®æ­£æ–¹æ³•å°±å¾ˆæ¸…æ™°äº†ï¼šåŒæ ·åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªObjectç±»å‹çš„é™æ€å­—æ®µï¼Œåœ¨æ“ä½œcounterä¹‹å‰å¯¹è¿™ä¸ªå­—æ®µåŠ é”ã€‚</p><pre><code>class Data {\n    @Getter\n    private static int counter = 0;\n    private static Object locker = new Object();\n\n    public void right() {\n        synchronized (locker) {\n            counter++;\n        }\n    }\n}\n</code></pre><p>ä½ å¯èƒ½è¦é—®äº†ï¼ŒæŠŠwrongæ–¹æ³•å®šä¹‰ä¸ºé™æ€ä¸å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ—¶å€™é”æ˜¯ç±»çº§åˆ«çš„ã€‚å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†æˆ‘ä»¬ä¸å¯èƒ½ä¸ºäº†è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜æ”¹å˜ä»£ç ç»“æ„ï¼ŒæŠŠå®ä¾‹æ–¹æ³•æ”¹ä¸ºé™æ€æ–¹æ³•ã€‚</p><p>æ„Ÿå…´è¶£çš„åŒå­¦è¿˜å¯ä»¥ä»å­—èŠ‚ç ä»¥åŠJVMçš„å±‚é¢ç»§ç»­æ¢ç´¢ä¸€ä¸‹ï¼Œä»£ç å—çº§åˆ«çš„synchronizedå’Œæ–¹æ³•ä¸Šæ ‡è®°synchronizedå…³é”®å­—ï¼Œåœ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><h2>åŠ é”è¦è€ƒè™‘é”çš„ç²’åº¦å’Œåœºæ™¯é—®é¢˜</h2><p>åœ¨æ–¹æ³•ä¸ŠåŠ synchronizedå…³é”®å­—å®ç°åŠ é”ç¡®å®ç®€å•ï¼Œä¹Ÿå› æ­¤æˆ‘æ›¾çœ‹åˆ°ä¸€äº›ä¸šåŠ¡ä»£ç ä¸­å‡ ä¹æ‰€æœ‰æ–¹æ³•éƒ½åŠ äº†synchronizedï¼Œä½†è¿™ç§æ»¥ç”¨synchronizedçš„åšæ³•ï¼š</p><ul>\n<li>ä¸€æ˜¯ï¼Œæ²¡å¿…è¦ã€‚é€šå¸¸æƒ…å†µä¸‹60%çš„ä¸šåŠ¡ä»£ç æ˜¯ä¸‰å±‚æ¶æ„ï¼Œæ•°æ®ç»è¿‡æ— çŠ¶æ€çš„Controllerã€Serviceã€Repositoryæµè½¬åˆ°æ•°æ®åº“ï¼Œæ²¡å¿…è¦ä½¿ç”¨synchronizedæ¥ä¿æŠ¤ä»€ä¹ˆæ•°æ®ã€‚</li>\n<li>äºŒæ˜¯ï¼Œå¯èƒ½ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚ä½¿ç”¨Springæ¡†æ¶æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹Controllerã€Serviceã€Repositoryæ˜¯å•ä¾‹çš„ï¼ŒåŠ ä¸Šsynchronizedä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºå‡ ä¹å°±åªèƒ½æ”¯æŒå•çº¿ç¨‹ï¼Œé€ æˆæå¤§çš„æ€§èƒ½é—®é¢˜ã€‚</li>\n</ul><p><strong>å³ä½¿æˆ‘ä»¬ç¡®å®æœ‰ä¸€äº›å…±äº«èµ„æºéœ€è¦ä¿æŠ¤ï¼Œä¹Ÿè¦å°½å¯èƒ½é™ä½é”çš„ç²’åº¦ï¼Œä»…å¯¹å¿…è¦çš„ä»£ç å—ç”šè‡³æ˜¯éœ€è¦ä¿æŠ¤çš„èµ„æºæœ¬èº«åŠ é”ã€‚</strong></p><p>æ¯”å¦‚ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªArrayListå› ä¸ºä¼šè¢«å¤šä¸ªçº¿ç¨‹æ“ä½œè€Œéœ€è¦ä¿æŠ¤ï¼Œåˆæœ‰ä¸€æ®µæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼ˆä»£ç ä¸­çš„slowæ–¹æ³•ï¼‰ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œåº”è¯¥å¦‚ä½•åŠ é”å‘¢ï¼Ÿ</p><p>é”™è¯¯çš„åšæ³•æ˜¯ï¼Œç»™æ•´æ®µä¸šåŠ¡é€»è¾‘åŠ é”ï¼ŒæŠŠslowæ–¹æ³•å’Œæ“ä½œArrayListçš„ä»£ç åŒæ—¶çº³å…¥synchronizedä»£ç å—ï¼›æ›´åˆé€‚çš„åšæ³•æ˜¯ï¼ŒæŠŠåŠ é”çš„ç²’åº¦é™åˆ°æœ€ä½ï¼Œåªåœ¨æ“ä½œArrayListçš„æ—¶å€™ç»™è¿™ä¸ªArrayListåŠ é”ã€‚</p><pre><code>private List&lt;Integer&gt; data = new ArrayList&lt;&gt;();\n\n//ä¸æ¶‰åŠå…±äº«èµ„æºçš„æ…¢æ–¹æ³•\nprivate void slow() {\n    try {\n        TimeUnit.MILLISECONDS.sleep(10);\n    } catch (InterruptedException e) {\n    }\n}\n\n//é”™è¯¯çš„åŠ é”æ–¹æ³•\n@GetMapping(&quot;wrong&quot;)\npublic int wrong() {\n    long begin = System.currentTimeMillis();\n    IntStream.rangeClosed(1, 1000).parallel().forEach(i -&gt; {\n        //åŠ é”ç²’åº¦å¤ªç²—äº†\n        synchronized (this) {\n            slow();\n            data.add(i);\n        }\n    });\n    log.info(&quot;took:{}&quot;, System.currentTimeMillis() - begin);\n    return data.size();\n}\n\n//æ­£ç¡®çš„åŠ é”æ–¹æ³•\n@GetMapping(&quot;right&quot;)\npublic int right() {\n    long begin = System.currentTimeMillis();\n    IntStream.rangeClosed(1, 1000).parallel().forEach(i -&gt; {\n        slow();\n        //åªå¯¹ListåŠ é”\n        synchronized (data) {\n            data.add(i);\n        }\n    });\n    log.info(&quot;took:{}&quot;, System.currentTimeMillis() - begin);\n    return data.size();\n}\n</code></pre><p>æ‰§è¡Œè¿™æ®µä»£ç ï¼ŒåŒæ ·æ˜¯1000æ¬¡ä¸šåŠ¡æ“ä½œï¼Œæ­£ç¡®åŠ é”çš„ç‰ˆæœ¬è€—æ—¶1.4ç§’ï¼Œè€Œå¯¹æ•´ä¸ªä¸šåŠ¡é€»è¾‘åŠ é”çš„è¯è€—æ—¶11ç§’ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1c/43/1cb278c010719ee00d988dbb2a42c543.png?wh=1820*98\" alt=\"\"></p><p><strong>å¦‚æœç²¾ç»†åŒ–è€ƒè™‘äº†é”åº”ç”¨èŒƒå›´åï¼Œæ€§èƒ½è¿˜æ— æ³•æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘å¦ä¸€ä¸ªç»´åº¦çš„ç²’åº¦é—®é¢˜äº†ï¼Œå³ï¼šåŒºåˆ†è¯»å†™åœºæ™¯ä»¥åŠèµ„æºçš„è®¿é—®å†²çªï¼Œè€ƒè™‘ä½¿ç”¨æ‚²è§‚æ–¹å¼çš„é”è¿˜æ˜¯ä¹è§‚æ–¹å¼çš„é”ã€‚</strong></p><p>ä¸€èˆ¬ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¾ˆå°‘éœ€è¦è¿›ä¸€æ­¥è€ƒè™‘è¿™ä¸¤ç§æ›´ç»†ç²’åº¦çš„é”ï¼Œæ‰€ä»¥æˆ‘åªå’Œä½ åˆ†äº«å‡ ä¸ªå¤§æ¦‚çš„ç»“è®ºï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥è€ƒè™‘æ˜¯å¦æœ‰å¿…è¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</p><ul>\n<li>å¯¹äºè¯»å†™æ¯”ä¾‹å·®å¼‚æ˜æ˜¾çš„åœºæ™¯ï¼Œè€ƒè™‘ä½¿ç”¨ReentrantReadWriteLockç»†åŒ–åŒºåˆ†è¯»å†™é”ï¼Œæ¥æé«˜æ€§èƒ½ã€‚</li>\n<li>å¦‚æœä½ çš„JDKç‰ˆæœ¬é«˜äº1.8ã€å…±äº«èµ„æºçš„å†²çªæ¦‚ç‡ä¹Ÿæ²¡é‚£ä¹ˆå¤§çš„è¯ï¼Œè€ƒè™‘ä½¿ç”¨StampedLockçš„ä¹è§‚è¯»çš„ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</li>\n<li>JDKé‡ŒReentrantLockå’ŒReentrantReadWriteLockéƒ½æä¾›äº†å…¬å¹³é”çš„ç‰ˆæœ¬ï¼Œåœ¨æ²¡æœ‰æ˜ç¡®éœ€æ±‚çš„æƒ…å†µä¸‹ä¸è¦è½»æ˜“å¼€å¯å…¬å¹³é”ç‰¹æ€§ï¼Œåœ¨ä»»åŠ¡å¾ˆè½»çš„æƒ…å†µä¸‹å¼€å¯å…¬å¹³é”å¯èƒ½ä¼šè®©æ€§èƒ½ä¸‹é™ä¸Šç™¾å€ã€‚</li>\n</ul><h2>å¤šæŠŠé”è¦å°å¿ƒæ­»é”é—®é¢˜</h2><p>åˆšæ‰æˆ‘ä»¬èŠåˆ°é”çš„ç²’åº¦å¤Ÿç”¨å°±å¥½ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„ç¨‹åºé€»è¾‘ä¸­æœ‰æ—¶ä¼šå­˜åœ¨ä¸€äº›ç»†ç²’åº¦çš„é”ã€‚ä½†ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å¦‚æœæ¶‰åŠå¤šæŠŠé”ï¼Œå®¹æ˜“äº§ç”Ÿæ­»é”é—®é¢˜ã€‚</p><p>ä¹‹å‰æˆ‘é‡åˆ°è¿‡è¿™æ ·ä¸€ä¸ªæ¡ˆä¾‹ï¼šä¸‹å•æ“ä½œéœ€è¦é”å®šè®¢å•ä¸­å¤šä¸ªå•†å“çš„åº“å­˜ï¼Œæ‹¿åˆ°æ‰€æœ‰å•†å“çš„é”ä¹‹åè¿›è¡Œä¸‹å•æ‰£å‡åº“å­˜æ“ä½œï¼Œå…¨éƒ¨æ“ä½œå®Œæˆä¹‹åé‡Šæ”¾æ‰€æœ‰çš„é”ã€‚ä»£ç ä¸Šçº¿åå‘ç°ï¼Œä¸‹å•å¤±è´¥æ¦‚ç‡å¾ˆé«˜ï¼Œå¤±è´¥åéœ€è¦ç”¨æˆ·é‡æ–°ä¸‹å•ï¼Œæå¤§å½±å“äº†ç”¨æˆ·ä½“éªŒï¼Œè¿˜å½±å“åˆ°äº†é”€é‡ã€‚</p><p>ç»æ’æŸ¥å‘ç°æ˜¯æ­»é”å¼•èµ·çš„é—®é¢˜ï¼ŒèƒŒååŸå› æ˜¯æ‰£å‡åº“å­˜çš„é¡ºåºä¸åŒï¼Œå¯¼è‡´å¹¶å‘çš„æƒ…å†µä¸‹å¤šä¸ªçº¿ç¨‹å¯èƒ½ç›¸äº’æŒæœ‰éƒ¨åˆ†å•†å“çš„é”ï¼Œåˆç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾å¦ä¸€éƒ¨åˆ†å•†å“çš„é”ï¼Œäºæ˜¯å‡ºç°äº†æ­»é”é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‰–æä¸€ä¸‹æ ¸å¿ƒçš„ä¸šåŠ¡ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå•†å“ç±»å‹ï¼ŒåŒ…å«å•†å“åã€åº“å­˜å‰©ä½™å’Œå•†å“çš„åº“å­˜é”ä¸‰ä¸ªå±æ€§ï¼Œæ¯ä¸€ç§å•†å“é»˜è®¤åº“å­˜1000ä¸ªï¼›ç„¶åï¼Œåˆå§‹åŒ–10ä¸ªè¿™æ ·çš„å•†å“å¯¹è±¡æ¥æ¨¡æ‹Ÿå•†å“æ¸…å•ï¼š</p><pre><code>@Data\n@RequiredArgsConstructor\nstatic class Item {\n    final String name; //å•†å“å\n    int remaining = 1000; //åº“å­˜å‰©ä½™\n    @ToString.Exclude //ToStringä¸åŒ…å«è¿™ä¸ªå­—æ®µ \n    ReentrantLock lock = new ReentrantLock();\n}\n</code></pre><p>éšåï¼Œå†™ä¸€ä¸ªæ–¹æ³•æ¨¡æ‹Ÿåœ¨è´­ç‰©è½¦è¿›è¡Œå•†å“é€‰è´­ï¼Œæ¯æ¬¡ä»å•†å“æ¸…å•ï¼ˆitemså­—æ®µï¼‰ä¸­éšæœºé€‰è´­ä¸‰ä¸ªå•†å“ï¼ˆä¸ºäº†é€»è¾‘ç®€å•ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘æ¯æ¬¡é€‰è´­å¤šä¸ªåŒç±»å•†å“çš„é€»è¾‘ï¼Œè´­ç‰©è½¦ä¸­ä¸ä½“ç°å•†å“æ•°é‡ï¼‰ï¼š</p><pre><code>private List&lt;Item&gt; createCart() {\n    return IntStream.rangeClosed(1, 3)\n            .mapToObj(i -&gt; &quot;item&quot; + ThreadLocalRandom.current().nextInt(items.size()))\n            .map(name -&gt; items.get(name)).collect(Collectors.toList());\n}\n</code></pre><p>ä¸‹å•ä»£ç å¦‚ä¸‹ï¼šå…ˆå£°æ˜ä¸€ä¸ªListæ¥ä¿å­˜æ‰€æœ‰è·å¾—çš„é”ï¼Œç„¶åéå†è´­ç‰©è½¦ä¸­çš„å•†å“ä¾æ¬¡å°è¯•è·å¾—å•†å“çš„é”ï¼Œæœ€é•¿ç­‰å¾…10ç§’ï¼Œè·å¾—å…¨éƒ¨é”ä¹‹åå†æ‰£å‡åº“å­˜ï¼›å¦‚æœæœ‰æ— æ³•è·å¾—é”çš„æƒ…å†µåˆ™è§£é”ä¹‹å‰è·å¾—çš„æ‰€æœ‰é”ï¼Œè¿”å›falseä¸‹å•å¤±è´¥ã€‚</p><pre><code>private boolean createOrder(List&lt;Item&gt; order) {\n    //å­˜æ”¾æ‰€æœ‰è·å¾—çš„é”\n    List&lt;ReentrantLock&gt; locks = new ArrayList&lt;&gt;();\n\n    for (Item item : order) {\n        try {\n            //è·å¾—é”10ç§’è¶…æ—¶\n            if (item.lock.tryLock(10, TimeUnit.SECONDS)) {\n                locks.add(item.lock);\n            } else {\n                locks.forEach(ReentrantLock::unlock);\n                return false;\n            }\n        } catch (InterruptedException e) {\n        }\n    }\n    //é”å…¨éƒ¨æ‹¿åˆ°ä¹‹åæ‰§è¡Œæ‰£å‡åº“å­˜ä¸šåŠ¡é€»è¾‘\n    try {\n        order.forEach(item -&gt; item.remaining--);\n    } finally {\n        locks.forEach(ReentrantLock::unlock);\n    }\n    return true;\n}\n</code></pre><p>æˆ‘ä»¬å†™ä¸€æ®µä»£ç æµ‹è¯•è¿™ä¸ªä¸‹å•æ“ä½œã€‚æ¨¡æ‹Ÿåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿›è¡Œ100æ¬¡åˆ›å»ºè´­ç‰©è½¦å’Œä¸‹å•æ“ä½œï¼Œæœ€åé€šè¿‡æ—¥å¿—è¾“å‡ºæˆåŠŸçš„ä¸‹å•æ¬¡æ•°ã€æ€»å‰©ä½™çš„å•†å“ä¸ªæ•°ã€100æ¬¡ä¸‹å•è€—æ—¶ï¼Œä»¥åŠä¸‹å•å®Œæˆåçš„å•†å“åº“å­˜æ˜ç»†ï¼š</p><pre><code>@GetMapping(&quot;wrong&quot;)\npublic long wrong() {\n    long begin = System.currentTimeMillis();\n    //å¹¶å‘è¿›è¡Œ100æ¬¡ä¸‹å•æ“ä½œï¼Œç»Ÿè®¡æˆåŠŸæ¬¡æ•°\n    long success = IntStream.rangeClosed(1, 100).parallel()\n            .mapToObj(i -&gt; {\n                List&lt;Item&gt; cart = createCart();\n                return createOrder(cart);\n            })\n            .filter(result -&gt; result)\n            .count();\n    log.info(&quot;success:{} totalRemaining:{} took:{}ms items:{}&quot;,\n            success,\n            items.entrySet().stream().map(item -&gt; item.getValue().remaining).reduce(0, Integer::sum),\n            System.currentTimeMillis() - begin, items);\n    return success;\n}\n</code></pre><p>è¿è¡Œç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/14/05/141a5ed915e08e50c0f6b066bea36e05.png?wh=3038*260\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ100æ¬¡ä¸‹å•æ“ä½œæˆåŠŸäº†65æ¬¡ï¼Œ10ç§å•†å“æ€»è®¡10000ä»¶ï¼Œåº“å­˜æ€»è®¡ä¸º9805ï¼Œæ¶ˆè€—äº†195ä»¶ç¬¦åˆé¢„æœŸï¼ˆ65æ¬¡ä¸‹å•æˆåŠŸï¼Œæ¯æ¬¡ä¸‹å•åŒ…å«ä¸‰ä»¶å•†å“ï¼‰ï¼Œæ€»è€—æ—¶50ç§’ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p><p>ä½¿ç”¨JDKè‡ªå¸¦çš„VisualVMå·¥å…·æ¥è·Ÿè¸ªä¸€ä¸‹ï¼Œé‡æ–°æ‰§è¡Œæ–¹æ³•åä¸ä¹…å°±å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹Tabä¸­æç¤ºäº†æ­»é”é—®é¢˜ï¼Œæ ¹æ®æç¤ºç‚¹å‡»å³ä¾§çº¿ç¨‹DumpæŒ‰é’®è¿›è¡Œçº¿ç¨‹æŠ“å–æ“ä½œï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/ce/ff24ac10bd0635ef4bf5987038b622ce.png?wh=2784*348\" alt=\"\"></p><p>æŸ¥çœ‹æŠ“å–å‡ºçš„çº¿ç¨‹æ ˆï¼Œåœ¨é¡µé¢ä¸­éƒ¨å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/42/c32cb32eb5433aae3b392738a80bca42.png?wh=1938*420\" alt=\"\"></p><p>æ˜¾ç„¶ï¼Œ<strong>æ˜¯å‡ºç°äº†æ­»é”ï¼Œçº¿ç¨‹4åœ¨ç­‰å¾…çš„ä¸€ä¸ªé”è¢«çº¿ç¨‹3æŒæœ‰ï¼Œçº¿ç¨‹3åœ¨ç­‰å¾…çš„å¦ä¸€æŠŠé”è¢«çº¿ç¨‹4æŒæœ‰</strong>ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆä¼šæœ‰æ­»é”é—®é¢˜å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»”ç»†å›å¿†ä¸€ä¸‹è´­ç‰©è½¦æ·»åŠ å•†å“çš„é€»è¾‘ï¼Œéšæœºæ·»åŠ äº†ä¸‰ç§å•†å“ï¼Œå‡è®¾ä¸€ä¸ªè´­ç‰©è½¦ä¸­çš„å•†å“æ˜¯item1å’Œitem2ï¼Œå¦ä¸€ä¸ªè´­ç‰©è½¦ä¸­çš„å•†å“æ˜¯item2å’Œitem1ï¼Œä¸€ä¸ªçº¿ç¨‹å…ˆè·å–åˆ°äº†item1çš„é”ï¼ŒåŒæ—¶å¦ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°äº†item2çš„é”ï¼Œç„¶åä¸¤ä¸ªçº¿ç¨‹æ¥ä¸‹æ¥è¦åˆ†åˆ«è·å–item2å’Œitem1çš„é”ï¼Œè¿™ä¸ªæ—¶å€™é”å·²ç»è¢«å¯¹æ–¹è·å–äº†ï¼Œåªèƒ½ç›¸äº’ç­‰å¾…ä¸€ç›´åˆ°10ç§’è¶…æ—¶ã€‚</p><p>å…¶å®ï¼Œé¿å…æ­»é”çš„æ–¹æ¡ˆå¾ˆç®€å•ï¼Œ<strong>ä¸ºè´­ç‰©è½¦ä¸­çš„å•†å“æ’ä¸€ä¸‹åºï¼Œè®©æ‰€æœ‰çš„çº¿ç¨‹ä¸€å®šæ˜¯å…ˆè·å–item1çš„é”ç„¶åè·å–item2çš„é”ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜äº†</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘åªéœ€è¦ä¿®æ”¹ä¸€è¡Œä»£ç ï¼Œå¯¹createCartè·å¾—çš„è´­ç‰©è½¦æŒ‰ç…§å•†å“åè¿›è¡Œæ’åºå³å¯ï¼š</p><pre><code>@GetMapping(&quot;right&quot;)\npublic long right() {\n    ...\n.    \n    long success = IntStream.rangeClosed(1, 100).parallel()\n            .mapToObj(i -&gt; {\n                List&lt;Item&gt; cart = createCart().stream()\n                        .sorted(Comparator.comparing(Item::getName))\n                        .collect(Collectors.toList());\n                return createOrder(cart);\n            })\n            .filter(result -&gt; result)\n            .count();\n    ...\n    return success;\n}\n</code></pre><p>æµ‹è¯•ä¸€ä¸‹rightæ–¹æ³•ï¼Œä¸ç®¡æ‰§è¡Œå¤šå°‘æ¬¡éƒ½æ˜¯100æ¬¡æˆåŠŸä¸‹å•ï¼Œè€Œä¸”æ€§èƒ½ç›¸å½“é«˜ï¼Œè¾¾åˆ°äº†3000ä»¥ä¸Šçš„TPSï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a4/e4/a41d077eeecc8b922503409d13a465e4.png?wh=970*352\" alt=\"\"></p><p>è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œè™½ç„¶äº§ç”Ÿäº†æ­»é”é—®é¢˜ï¼Œä½†å› ä¸ºå°è¯•è·å–é”çš„æ“ä½œå¹¶ä¸æ˜¯æ— é™é˜»å¡çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é€ æˆæ°¸ä¹…æ­»é”ï¼Œä¹‹åçš„æ”¹è¿›å°±æ˜¯é¿å…å¾ªç¯ç­‰å¾…ï¼Œé€šè¿‡å¯¹è´­ç‰©è½¦çš„å•†å“è¿›è¡Œæ’åºæ¥å®ç°æœ‰é¡ºåºçš„åŠ é”ï¼Œé¿å…å¾ªç¯ç­‰å¾…ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>æˆ‘ä»¬ä¸€èµ·æ€»ç»“å›é¡¾ä¸‹ï¼Œä½¿ç”¨é”æ¥è§£å†³å¤šçº¿ç¨‹æƒ…å†µä¸‹çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å‘å§ã€‚</p><p>ç¬¬ä¸€ï¼Œä½¿ç”¨synchronizedåŠ é”è™½ç„¶ç®€å•ï¼Œä½†æˆ‘ä»¬é¦–å…ˆè¦å¼„æ¸…æ¥šå…±äº«èµ„æºæ˜¯ç±»è¿˜æ˜¯å®ä¾‹çº§åˆ«çš„ã€ä¼šè¢«å“ªäº›çº¿ç¨‹æ“ä½œï¼Œsynchronizedå…³è”çš„é”å¯¹è±¡æˆ–æ–¹æ³•åˆæ˜¯ä»€ä¹ˆèŒƒå›´çš„ã€‚</p><p>ç¬¬äºŒï¼ŒåŠ é”å°½å¯èƒ½è¦è€ƒè™‘ç²’åº¦å’Œåœºæ™¯ï¼Œé”ä¿æŠ¤çš„ä»£ç æ„å‘³ç€æ— æ³•è¿›è¡Œå¤šçº¿ç¨‹æ“ä½œã€‚å¯¹äºWebç±»å‹çš„å¤©ç„¶å¤šçº¿ç¨‹é¡¹ç›®ï¼Œå¯¹æ–¹æ³•è¿›è¡Œå¤§èŒƒå›´åŠ é”ä¼šæ˜¾è‘—é™çº§å¹¶å‘èƒ½åŠ›ï¼Œè¦è€ƒè™‘å°½å¯èƒ½åœ°åªä¸ºå¿…è¦çš„ä»£ç å—åŠ é”ï¼Œé™ä½é”çš„ç²’åº¦ï¼›è€Œå¯¹äºè¦æ±‚è¶…é«˜æ€§èƒ½çš„ä¸šåŠ¡ï¼Œè¿˜è¦ç»†åŒ–è€ƒè™‘é”çš„è¯»å†™åœºæ™¯ï¼Œä»¥åŠæ‚²è§‚ä¼˜å…ˆè¿˜æ˜¯ä¹è§‚ä¼˜å…ˆï¼Œå°½å¯èƒ½é’ˆå¯¹æ˜ç¡®åœºæ™¯ç²¾ç»†åŒ–åŠ é”æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨é€‚å½“çš„åœºæ™¯ä¸‹è€ƒè™‘ä½¿ç”¨ReentrantReadWriteLockã€StampedLockç­‰é«˜çº§çš„é”å·¥å…·ç±»ã€‚</p><p>ç¬¬ä¸‰ï¼Œä¸šåŠ¡é€»è¾‘ä¸­æœ‰å¤šæŠŠé”æ—¶è¦è€ƒè™‘æ­»é”é—®é¢˜ï¼Œé€šå¸¸çš„è§„é¿æ–¹æ¡ˆæ˜¯ï¼Œé¿å…æ— é™ç­‰å¾…å’Œå¾ªç¯ç­‰å¾…ã€‚</p><p>æ­¤å¤–ï¼Œ<strong>å¦‚æœä¸šåŠ¡é€»è¾‘ä¸­é”çš„å®ç°æ¯”è¾ƒå¤æ‚çš„è¯ï¼Œè¦ä»”ç»†çœ‹çœ‹åŠ é”å’Œé‡Šæ”¾æ˜¯å¦é…å¯¹ï¼Œæ˜¯å¦æœ‰é—æ¼é‡Šæ”¾æˆ–é‡å¤é‡Šæ”¾çš„å¯èƒ½æ€§ï¼›å¹¶ä¸”å¯¹äºåˆ†å¸ƒå¼é”è¦è€ƒè™‘é”è‡ªåŠ¨è¶…æ—¶é‡Šæ”¾äº†ï¼Œè€Œä¸šåŠ¡é€»è¾‘å´è¿˜åœ¨è¿›è¡Œçš„æƒ…å†µä¸‹ï¼Œå¦‚æœåˆ«çš„çº¿çº¿ç¨‹æˆ–è¿›ç¨‹æ‹¿åˆ°äº†ç›¸åŒçš„é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤æ‰§è¡Œ</strong>ã€‚</p><p>ä¸ºæ¼”ç¤ºæ–¹ä¾¿ï¼Œä»Šå¤©çš„æ¡ˆä¾‹æ˜¯åœ¨Controllerçš„é€»è¾‘ä¸­å¼€æ–°çš„çº¿ç¨‹æˆ–ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œå¹¶å‘æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥æ„è¯†åˆ°å“ªäº›å¯¹è±¡æ˜¯å¹¶å‘æ“ä½œçš„ã€‚ä½†å¯¹äºWebåº”ç”¨ç¨‹åºçš„å¤©ç„¶å¤šçº¿ç¨‹åœºæ™¯ï¼Œä½ å¯èƒ½æ›´å®¹æ˜“å¿½ç•¥è¿™ç‚¹ï¼Œå¹¶ä¸”ä¹Ÿå¯èƒ½å› ä¸ºè¯¯ç”¨é”é™ä½åº”ç”¨æ•´ä½“çš„ååé‡ã€‚<strong>å¦‚æœä½ çš„ä¸šåŠ¡ä»£ç æ¶‰åŠå¤æ‚çš„é”æ“ä½œï¼Œå¼ºçƒˆå»ºè®®Mockç›¸å…³å¤–éƒ¨æ¥å£æˆ–æ•°æ®åº“æ“ä½œåå¯¹åº”ç”¨ä»£ç è¿›è¡Œå‹æµ‹ï¼Œé€šè¿‡å‹æµ‹æ’é™¤é”è¯¯ç”¨å¸¦æ¥çš„æ€§èƒ½é—®é¢˜å’Œæ­»é”é—®é¢˜</strong>ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>æœ¬æ–‡å¼€å¤´çš„ä¾‹å­é‡Œï¼Œå˜é‡aã€béƒ½ä½¿ç”¨äº†volatileå…³é”®å­—ï¼Œä½ çŸ¥é“åŸå› å—ï¼Ÿæˆ‘ä¹‹å‰é‡åˆ°è¿‡è¿™æ ·ä¸€ä¸ªå‘ï¼šæˆ‘ä»¬å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹æ— é™å¾ªç¯æ¥è·‘ä¸€äº›ä»»åŠ¡ï¼Œæœ‰ä¸€ä¸ªboolç±»å‹çš„å˜é‡æ¥æ§åˆ¶å¾ªç¯çš„é€€å‡ºï¼Œé»˜è®¤ä¸ºtrueä»£è¡¨æ‰§è¡Œï¼Œä¸€æ®µæ—¶é—´åä¸»çº¿ç¨‹å°†è¿™ä¸ªå˜é‡è®¾ç½®ä¸ºäº†falseã€‚å¦‚æœè¿™ä¸ªå˜é‡ä¸æ˜¯volatileä¿®é¥°çš„ï¼Œå­çº¿ç¨‹å¯ä»¥é€€å‡ºå—ï¼Ÿä½ èƒ½å¦è§£é‡Šå…¶ä¸­çš„åŸå› å‘¢ï¼Ÿ</li>\n<li>æ–‡æœ«æˆ‘ä»¬åˆæäº†ä¸¤ä¸ªå‘ï¼Œä¸€æ˜¯åŠ é”å’Œé‡Šæ”¾æ²¡æœ‰é…å¯¹çš„é—®é¢˜ï¼ŒäºŒæ˜¯é”è‡ªåŠ¨é‡Šæ”¾å¯¼è‡´çš„é‡å¤é€»è¾‘æ‰§è¡Œçš„é—®é¢˜ã€‚ä½ æœ‰ä»€ä¹ˆæ–¹æ³•æ¥å‘ç°å’Œè§£å†³è¿™ä¸¤ç§é—®é¢˜å—ï¼Ÿ</li>\n</ol><p>åœ¨ä½¿ç”¨é”çš„è¿‡ç¨‹ä¸­ï¼Œä½ è¿˜é‡åˆ°è¿‡å…¶ä»–å‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"01 | ä½¿ç”¨äº†å¹¶å‘å·¥å…·ç±»åº“ï¼Œçº¿ç¨‹å®‰å…¨å°±é«˜æ•æ— å¿§äº†å—ï¼Ÿ","id":209494},"right":{"article_title":"03 | çº¿ç¨‹æ± ï¼šä¸šåŠ¡ä»£ç æœ€å¸¸ç”¨ä¹Ÿæœ€å®¹æ˜“çŠ¯é”™çš„ç»„ä»¶","id":210337}},"comments":[{"had_liked":false,"id":186393,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":true,"comment_ctime":1583834394,"is_pvip":true,"replies":[{"id":"71974","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":186393,"uid":"1001470","ip_address":"","utype":1,"ctime":1583836605,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"9.2233723863310008e+18","product_id":100047701,"comment_content":"æ€è€ƒä¸è®¨è®ºï¼š<br>volatileçš„é—®é¢˜ï¼šå¯è§æ€§é—®é¢˜å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚<br>å¯è§æ€§é—®é¢˜ï¼šæœ¬è´¨ä¸Šæ˜¯cpuç¼“å­˜å¤±æ•ˆï¼Œå¿…é¡»ä»ä¸»å†…å­˜è¯»å–æ•°æ®ï¼›<br>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼šx86å¤„ç†å™¨ä»…ä¸‹ï¼Œåªå®ç°äº†volatileçš„è¯»å†™å†…å­˜å±éšœï¼Œä¹Ÿå°±æ˜¯store loadï¼Œä¹Ÿå°±æ˜¯å†™è¯»ï¼Œæœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯è¯»å†™å¯è§æ€§ï¼Œhappen-beforeåŸåˆ™ã€‚<br>å®ç°åŸç†æ˜¯é€šè¿‡å¯„å­˜å™¨espå®ç°çš„ã€‚<br>å½“ç„¶ä¹Ÿä¸ä¼šé€€å‡ºå¾ªç¯ï¼Œå› ä¸ºcpuç¼“å­˜åˆ°ä¸»å†…å­˜çš„åŒæ­¥ä¸æ˜¯å®æ—¶çš„ã€‚<br><br>é”é‡Šæ”¾å’Œé‡å¤æ‰§è¡Œé—®é¢˜ï¼šé”å»ºè®®ä½¿ç”¨synchronizedï¼Œåœ¨JDK1.6åï¼Œsynchronizedä¸Lockæ€§èƒ½ä¸Šå·®è·å¾ˆå°äº†ï¼ˆä¼˜åŒ–äº†å¾ˆå¤šï¼Œè‡ªæ—‹é”ï¼Œè‡ªé€‚åº”è‡ªæ—‹é”ã€åå‘é”ï¼Œè½»é‡çº§é”ç­‰ï¼‰ï¼Œsynchronizedä¹Ÿä¸ç”¨ç¨‹åºè·å–å’Œé‡Šæ”¾é”ï¼ŒåŒæ­¥ä»£ç å—æ˜¯é€šè¿‡monitorenter monitorexitå®ç°çš„ï¼ŒåŒæ­¥æ–¹æ³•æ˜¯æ–¹æ³•å¤´ä¸­æœ‰ACC_SYNCHRONIZEDæ ‡å¿—ï¼›åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¯ä»¥è€ƒè™‘etcdï¼Œetcdæ”¯æŒé”çš„è‡ªåŠ¨ç»­æœŸç­‰ï¼›<br>é‡å¤æ‰§è¡Œï¼šé¦–å…ˆåœ¨é”çš„ä½¿ç”¨åœºæ™¯ä¸‹åšå¥½å¤„ç†ï¼Œå°½é‡é¿å…é‡å¤æ‰§è¡Œï¼Œä½†ä¸šåŠ¡å±‚é¢ä¸€å®šè¦åšå¥½å¹‚ç­‰ã€‚<br><br><br><br><br>","like_count":82,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486737,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583836605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186279,"user_name":"Seven.Linæ¾¤è€¿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1583815421,"is_pvip":false,"replies":[{"id":"71938","content":"è¿™ä¸ªå›ç­”å¤ªèµäº†ï¼","user_name":"ä½œè€…å›å¤","comment_id":186279,"uid":"1001470","ip_address":"","utype":1,"ctime":1583817080,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"233512049405","product_id":100047701,"comment_content":"1.åŠ ç¾¤è§£é”æ²¡æœ‰é…å¯¹å¯ä»¥ç”¨ä¸€äº›ä»£ç è´¨é‡å·¥å…·ååŠ©æ’æ’ï¼Œå¦‚Sonarï¼Œé›†æˆåˆ°ideå’Œä»£ç ä»“åº“ï¼Œåœ¨ç¼–ç é˜¶æ®µå‘ç°ï¼ŒåŠ ä¸Šè¶…æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…é•¿æœŸå æœ‰é”<br>2.é”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾å¯¼è‡´é‡å¤æ‰§è¡Œçš„è¯ï¼Œå¯ä»¥ç”¨é”ç»­æœŸï¼Œå¦‚redissonçš„watchdogï¼›æˆ–è€…ä¿è¯ä¸šåŠ¡çš„å¹‚ç­‰æ€§ï¼Œé‡å¤æ‰§è¡Œä¹Ÿæ²¡é—®é¢˜ã€‚","like_count":54,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486701,"discussion_content":"è¿™ä¸ªå›ç­”å¤ªèµäº†ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583817080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381321,"discussion_content":"é¢ é—®é¢˜ä¸Šå¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼Œã€‚ã€‚å¦‚æœéè¦è€ƒè™‘ é›†ç¾¤ä¸­  èŠ‚ç‚¹çš„m såŒæ­¥ï¼Œé‚£ä¹ˆå°±æ˜¯å†™ä¸€åŠä»¥ä¸Šçš„m æ‰è®¤ä¸ºæ‹¿åˆ°é”ã€‚å¦‚æœä»…ä»…æ˜¯ä¸»ä»é‚£ä¹ˆå°±æ˜¯ç­‰ä¸»ä»åŒæ­¥ä»¥å  å¦‚æœæ˜¯1ä¸»å¤šä» é‚£ä¹ˆå°±æ˜¯è‡³å°‘ä¸€åŠçš„ä»ï¼Œä¹Ÿå°±æ˜¯semi-syncçš„ç©æ³•äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625014994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1166695,"avatar":"https://static001.geekbang.org/account/avatar/00/11/cd/67/23fab87a.jpg","nickname":"å¼ é‘«","note":"","ucode":"3CE5B1077184B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297707,"discussion_content":"redissionçš„watchdogä¹Ÿä¸èƒ½ä¿è¯åˆ†å¸ƒå¼é”æ­£å¸¸å§ï¼Œæ„Ÿè§‰å¹‚ç­‰æ˜¯ä¸ªå¿…è¦æ¡ä»¶,å¦‚æœè¦æ±‚æ¯”è¾ƒé«˜çš„è¯ï¼Œå°±å¯èƒ½ä¼šå‡ºç°ä¸‹è¾¹è¿™ç§æƒ…å†µ:\n    å¦‚æœredis masterå’ŒsalveåŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œmasterå®•æœºäº†ï¼Œåååœ¨è¿™ä¹‹å‰æŸä¸ªæœåŠ¡å®ä¾‹åˆšåˆšå†™å…¥äº†ä¸€æŠŠé”ï¼Œsalveè¿˜æ²¡æœ‰åŒæ­¥åˆ°è¿™æŠŠé”ï¼Œå°±è¢«åˆ‡æ¢æˆäº†masterï¼Œé‚£ä¹ˆè¿™æ—¶å€™å¯ä»¥è¯´å°±æœ‰é—®é¢˜äº†ï¼Œå¦ä¸€ä¸ªæœåŠ¡å®ä¾‹åœ¨æ–°çš„masterä¸Šè·å–åˆ°ä¸€æŠŠæ–°é”ï¼Œè¿™æ—¶å€™å°±ä¼šå‡ºç°ä¿©å°æœåŠ¡å®ä¾‹éƒ½æŒæœ‰é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„åœºæ™¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597029351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186665,"user_name":"ç¿ç¿ç¿ç¿ç¿ç¿ã€","can_delete":false,"product_type":"c1","uid":1013729,"ip_address":"","ucode":"616B0058FCC7E0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/e1/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1583897779,"is_pvip":false,"replies":[{"id":"72047","content":"å…¶å®Java8å‡ºæ¥å·²ç»æŒºä¹…äº†ï¼Œä½¿ç”¨Lambdaå’ŒStreamå¯ä»¥æ˜¾è‘—æ”¹å–„ä»£ç å¯è¯»æ€§ï¼Œç¡®ä¿ä»£ç ç®€æ´æ€§ï¼Œå› æ­¤ä¸“æ æ˜¯å¤§é‡ä½¿ç”¨Java8çš„ä¸€äº›æ–°ç‰¹æ€§çš„ã€‚ç»™ä½ å‡ ä¸ªå»ºè®®ï¼š<br>1ã€å¯ä»¥è¿›ä¸€æ­¥è®¢é˜…æå®¢æ—¶é—´ä¸“é—¨çš„å­¦ä¹ javaçš„ä¸“æ ç³»ç»Ÿå­¦ä¹ Lambdaè¯­æ³•ï¼Œæ¯”å¦‚https:&#47;&#47;time.geekbang.org&#47;course&#47;detail&#47;181-107395ï¼Œç„¶åè‡ªå·±å¯¹ç€ç»ƒä¹ ä¸€ä¸‹<br>2ã€ä¹°ä¸€æœ¬ã€ŠJavaå®æˆ˜ç¬¬äºŒç‰ˆã€‹ç³»ç»Ÿå­¦ä¹ Java8çš„æ–¹æ–¹é¢é¢<br>3ã€å…³æ³¨ä¸€ä¸‹æœ¬ä¸“æ çš„åŠ é¤ï¼Œä¹‹åæˆ‘ä»¬ä¼šé€šè¿‡åŠ é¤ä»‹ç»ä¸‹Java8<br>4ã€é‡åˆ°å®åœ¨çœ‹ä¸æ‡‚çš„ä»£ç ï¼Œä¸‹è½½æºç åï¼Œåœ¨IDEAä¸­ç‚¹å‡»lambdaæˆ–stream APIçš„åœ°æ–¹ï¼Œåœç•™ä¸€ä¸‹ï¼Œå·¦ä¾§å¯ä»¥çœ‹åˆ°æœ‰æç¤º replace stream API with loopæˆ–replace lambda with anonymous classé€‰é¡¹ï¼Œç¿»è¯‘ä¸ºéstreamå’Œlambdaçš„è¯­æ³•ï¼Œå¸®åŠ©ä½ ç†è§£","user_name":"ä½œè€…å›å¤","comment_id":186665,"uid":"1001470","ip_address":"","utype":1,"ctime":1583902248,"user_name_real":"æœ±æ™”"}],"discussion_count":9,"race_medal":0,"score":"199152393395","product_id":100047701,"comment_content":"è€å¸ˆæˆ‘æœ‰ä¸ªæ„è§ä»£ç èƒ½å¦ä¸è¦å¤§é‡ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªè¯»è€…éƒ½æ˜¯è€å¸æœº","like_count":47,"discussions":[{"author":{"id":1216284,"avatar":"https://static001.geekbang.org/account/avatar/00/12/8f/1c/1c728388.jpg","nickname":"çš®å¡çš®å¡","note":"","ucode":"D440EEC7301C76","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203106,"discussion_content":"è¿™ä¹Ÿæ˜¯å½“è‡ªå·±èµ°å‡ºèˆ’é€‚åŒºå•Š","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1583998369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486830,"discussion_content":"å…¶å®Java8å‡ºæ¥å·²ç»æŒºä¹…äº†ï¼Œä½¿ç”¨Lambdaå’ŒStreamå¯ä»¥æ˜¾è‘—æ”¹å–„ä»£ç å¯è¯»æ€§ï¼Œç¡®ä¿ä»£ç ç®€æ´æ€§ï¼Œå› æ­¤ä¸“æ æ˜¯å¤§é‡ä½¿ç”¨Java8çš„ä¸€äº›æ–°ç‰¹æ€§çš„ã€‚ç»™ä½ å‡ ä¸ªå»ºè®®ï¼š\n1ã€å¯ä»¥è¿›ä¸€æ­¥è®¢é˜…æå®¢æ—¶é—´ä¸“é—¨çš„å­¦ä¹ javaçš„ä¸“æ ç³»ç»Ÿå­¦ä¹ Lambdaè¯­æ³•ï¼Œæ¯”å¦‚https://time.geekbang.org/course/detail/181-107395ï¼Œç„¶åè‡ªå·±å¯¹ç€ç»ƒä¹ ä¸€ä¸‹\n2ã€ä¹°ä¸€æœ¬ã€ŠJavaå®æˆ˜ç¬¬äºŒç‰ˆã€‹ç³»ç»Ÿå­¦ä¹ Java8çš„æ–¹æ–¹é¢é¢\n3ã€å…³æ³¨ä¸€ä¸‹æœ¬ä¸“æ çš„åŠ é¤ï¼Œä¹‹åæˆ‘ä»¬ä¼šé€šè¿‡åŠ é¤ä»‹ç»ä¸‹Java8\n4ã€é‡åˆ°å®åœ¨çœ‹ä¸æ‡‚çš„ä»£ç ï¼Œä¸‹è½½æºç åï¼Œåœ¨IDEAä¸­ç‚¹å‡»lambdaæˆ–stream APIçš„åœ°æ–¹ï¼Œåœç•™ä¸€ä¸‹ï¼Œå·¦ä¾§å¯ä»¥çœ‹åˆ°æœ‰æç¤º replace stream API with loopæˆ–replace lambda with anonymous classé€‰é¡¹ï¼Œç¿»è¯‘ä¸ºéstreamå’Œlambdaçš„è¯­æ³•ï¼Œå¸®åŠ©ä½ ç†è§£","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583902248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205828,"discussion_content":"Lambdaå¾ˆé¦™å‘€","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584347718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1178235,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fa/7b/f89a398b.jpg","nickname":"Charles | å§œæµ·é¾™","note":"","ucode":"17BA74D1684184","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202452,"discussion_content":"å¯¹å¯¹ï¼Œèµ¶ç´§å­¦ä¹ Lambdaå§æ²¡é‚£ä¹ˆéš¾ï¼Œç½‘ä¸Šéšä¾¿æ‰¾æ‰¾èµ„æ–™åŸºæœ¬å°±ç†è§£ä¸ªå¤§æ¦‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583919452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1023959,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/d7/18ee8352.jpg","nickname":"è¶…ç¾¤","note":"","ucode":"365D7F3A3BD73E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530386,"discussion_content":"å¯ä»¥ä½¿ç”¨LINQ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637063577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1378524,"avatar":"https://static001.geekbang.org/account/avatar/00/15/08/dc/c88e97b3.jpg","nickname":"è†ä¸–å†·æš–","note":"","ucode":"509C9FCC146136","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391088,"discussion_content":"å»ºè®®ä½¿ç”¨JDK 1.0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630290680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1974876,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUCiacuh59wMZAeeNRwLiaGaRMZHibF05IibXeiaZfjcFfkmTwJTmPszibXLAQkk2mMdx8chPjTs2yvpZg/132","nickname":"Sky1225","note":"","ucode":"6F428AF396D99D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385538,"discussion_content":"ä¸ä¼šå¾—å­¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627117631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381322,"discussion_content":"lambda ç”¨èµ·æ¥æ²¡é—®é¢˜ï¼Œã€‚æˆ‘å¯¹ä¸‹è¾¹çš„ç ”å‘å°±ä¸€å¥è¯ï¼Œè€ƒè™‘ä»£ç çš„å¥å£®æ€§ã€‚ã€‚æœ‰äº›åŒå­¦å†™ä»£ç è€ƒè™‘çš„ä¸å¤Ÿæƒé™ï¼Œé‡åˆ°lambdaå¯¼è‡´çš„bug é—®é¢˜æ’æŸ¥ä¹Ÿç¡®å®å›°éš¾ä¸å°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625015056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336543,"discussion_content":"èµ°å‡ºèˆ’é€‚åŒº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608623006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186225,"user_name":"é»„æµ·å³°","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1583804810,"is_pvip":false,"replies":[{"id":"71930","content":"æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š1. é¿å…è¶…æ—¶ï¼Œå•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹ç»™é”å»¶é•¿æœ‰æ•ˆæœŸã€‚æ¯”å¦‚è®¾ç½®é”æœ‰æ•ˆæœŸ30sï¼Œæœ‰ä¸ªçº¿ç¨‹æ¯éš”10sé‡æ–°è®¾ç½®ä¸‹é”çš„æœ‰æ•ˆæœŸã€‚  2. é¿å…é‡å¤ï¼Œä¸šåŠ¡ä¸Šå¢åŠ ä¸€ä¸ªæ ‡è®°æ˜¯å¦è¢«å¤„ç†çš„å­—æ®µã€‚æˆ–è€…å¼€ä¸€å¼ æ–°è¡¨ï¼Œä¿å­˜å·²ç»å¤„ç†è¿‡çš„æµæ°´å·ã€‚","user_name":"ä½œè€…å›å¤","comment_id":186225,"uid":"1001470","ip_address":"","utype":1,"ctime":1583807753,"user_name_real":"æœ±æ™”"}],"discussion_count":7,"race_medal":0,"score":"151907660170","product_id":100047701,"comment_content":"è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾é”åæ€ä¹ˆé¿å…é‡å¤é€»è¾‘å¥½éš¾ï¼Œé¢è¯•æ›¾è¢«å¡ï¼Œæ±‚è§£ã€‚ã€‚ã€‚","like_count":36,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486680,"discussion_content":"æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š1. é¿å…è¶…æ—¶ï¼Œå•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹ç»™é”å»¶é•¿æœ‰æ•ˆæœŸã€‚æ¯”å¦‚è®¾ç½®é”æœ‰æ•ˆæœŸ30sï¼Œæœ‰ä¸ªçº¿ç¨‹æ¯éš”10sé‡æ–°è®¾ç½®ä¸‹é”çš„æœ‰æ•ˆæœŸã€‚  2. é¿å…é‡å¤ï¼Œä¸šåŠ¡ä¸Šå¢åŠ ä¸€ä¸ªæ ‡è®°æ˜¯å¦è¢«å¤„ç†çš„å­—æ®µã€‚æˆ–è€…å¼€ä¸€å¼ æ–°è¡¨ï¼Œä¿å­˜å·²ç»å¤„ç†è¿‡çš„æµæ°´å·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583807753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217955,"avatar":"https://static001.geekbang.org/account/avatar/00/12/95/a3/0a3cde60.jpg","nickname":"leon","note":"","ucode":"97610F35D2543A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317312,"discussion_content":"é”è¦é‡Šæ”¾å‰ï¼Œåˆ¤æ–­ä¸€ä¸‹ä¸šåŠ¡é€»è¾‘æ‰§è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ˜¯æ‰§è¡Œä¸­ï¼Œåˆ™ç»­çº¦é”ã€‚å¦‚æœæ‰§è¡ŒæˆåŠŸã€å¤±è´¥ã€å¼‚å¸¸ç­‰æƒ…å†µï¼Œé‡Šæ”¾é”ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603532549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381323,"discussion_content":"redissonçš„ watchdog ç»å…¸ç©æ³•äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625015075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236895,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/9f/18810a24.jpg","nickname":"é›ªå½±ç»®ç¼˜","note":"","ucode":"BB131E1EC110DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262243,"discussion_content":"è€å¸ˆï¼Œå»¶é•¿é”çš„æœ‰æ•ˆæœŸè¿™ä¸ªæ–¹æ¡ˆï¼Œå…·ä½“å¦‚ä½•å®æ–½å‘¢ï¼Œå•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹è¿˜è¦ç¡®ä¿é”çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ª","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589055477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331080,"discussion_content":"å¯¹äºç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œé‚£å¯ä¸æ˜¯æ°¸è¿œä¸ä¼šè¶…æ—¶ï¼Œè·Ÿè®¾ä¸è®¾ç½®è¶…æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606784347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1488356,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/e4/e6faf686.jpg","nickname":"æ¡äº†ä¸ªå¤§èš‚èš±","note":"","ucode":"AD34AD4FA37371","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":339886,"discussion_content":"å› ä¸ºå¦‚æœèŠ‚ç‚¹æŒæœ‰é”å¹¶ä¸”åœ¨æ‰§è¡Œä¸šåŠ¡ï¼Œï¼Œå°±æ˜¯è¦ä¸åœç»­æœŸä¿è¯ä¸šåŠ¡æ‰§è¡Œå®Œï¼›è€Œå› ä¸ºå®•æœºé€ æˆçš„é”å ç”¨ï¼Œå°±å¯ä»¥å› ä¸ºç»­æœŸçº¿ç¨‹çš„åŒæ­¥æŒ‚æ‰è€Œä¿è¯åŠæ—¶å¯¹é”è¿›è¡Œé‡Šæ”¾","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609833255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":331080,"ip_address":""},"score":339886,"extra":""},{"author":{"id":1575056,"avatar":"https://static001.geekbang.org/account/avatar/00/18/08/90/ce429e02.jpg","nickname":"sunshine","note":"","ucode":"0CF3A7F542FA9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1488356,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/e4/e6faf686.jpg","nickname":"æ¡äº†ä¸ªå¤§èš‚èš±","note":"","ucode":"AD34AD4FA37371","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394436,"discussion_content":"æœ‰æ²¡æœ‰è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼šä¸šåŠ¡çº¿ç¨‹å¼‚å¸¸é€€å‡ºï¼Œå¯¼è‡´æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ã€‚è€Œç»­æœŸçº¿ç¨‹è¿˜ä¸æ–­çš„ç»­æœŸï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631882816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339886,"ip_address":""},"score":394436,"extra":""}]}]},{"had_liked":false,"id":186066,"user_name":"ç¼–ç¨‹ç•Œçš„å°å­¦ç”Ÿ","can_delete":false,"product_type":"c1","uid":1593289,"ip_address":"","ucode":"4A5BE9A5E877FA","user_header":"https://static001.geekbang.org/account/avatar/00/18/4f/c9/9f51fd27.jpg","comment_is_top":false,"comment_ctime":1583749163,"is_pvip":false,"replies":[{"id":"71899","content":"å—¯å¿…é¡»åŠ volatileæˆ–è€…ä½¿ç”¨AtomicBoolean&#47;AtomicReferenceç­‰ä¹Ÿè¡Œï¼Œåè€…ç›¸æ¯”volatileé™¤äº†ç¡®ä¿å¯è§æ€§è¿˜æä¾›äº†CASæ–¹æ³•ä¿è¯åŸå­æ€§","user_name":"ä½œè€…å›å¤","comment_id":186066,"uid":"1001470","ip_address":"","utype":1,"ctime":1583763980,"user_name_real":"æœ±æ™”"}],"discussion_count":4,"race_medal":0,"score":"104662964267","product_id":100047701,"comment_content":"1.ä¸èƒ½é€€å‡ºã€‚å¿…é¡»åŠ volatileï¼Œå› ä¸ºvolatileä¿è¯äº†å¯è§æ€§ã€‚æ”¹å®Œåä¼šå¼ºåˆ¶è®©å·¥ä½œå†…å­˜å¤±æ•ˆã€‚å»ä¸»å­˜æ‹¿ã€‚å¦‚æœä¸åŠ volatileçš„è¯é‚£ä¹ˆåœ¨while trueé‡Œé¢æ·»åŠ è¾“å‡ºè¯­å¥ä¹Ÿæ˜¯OKçš„ã€‚å› ä¸ºprintlnæºç åŠ é”äº†ï¼Œsyncä¼šè®©å½“å‰çº¿ç¨‹çš„å·¥ä½œå†…å­˜å¤±æ•ˆã€‚<br>è§£é‡Šçš„å¯¹å—ï¼ŸçŒ®ä¸‘äº†ã€‚","like_count":24,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486609,"discussion_content":"å—¯å¿…é¡»åŠ volatileæˆ–è€…ä½¿ç”¨AtomicBoolean/AtomicReferenceç­‰ä¹Ÿè¡Œï¼Œåè€…ç›¸æ¯”volatileé™¤äº†ç¡®ä¿å¯è§æ€§è¿˜æä¾›äº†CASæ–¹æ³•ä¿è¯åŸå­æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583763980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1215888,"avatar":"https://static001.geekbang.org/account/avatar/00/12/8d/90/ed5d203d.jpg","nickname":"linkq","note":"","ucode":"3FC807BD9CED1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214590,"discussion_content":"èƒ½ä¸èƒ½ç»™ä¸ªä¸èƒ½é€€å‡ºçš„ä¾‹å­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585211835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1045090,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/62/f873cd8f.jpg","nickname":"tongmin_tsai","note":"","ucode":"D9423E770D5846","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1215888,"avatar":"https://static001.geekbang.org/account/avatar/00/12/8d/90/ed5d203d.jpg","nickname":"linkq","note":"","ucode":"3FC807BD9CED1C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292388,"discussion_content":"public class NoExit implements Runnable {\n    boolean flag = true;\n    int i = 0;\n\n    @Override\n    public void run() {\n        while (flag) {\n            i++;\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        NoExit noExit = new NoExit();\n        new Thread(noExit).start();\n        TimeUnit.SECONDS.sleep(1);\n        noExit.flag = false;\n        System.out.println(noExit.i);\n        System.out.println(&#34;end&#34;);\n    }\n\n}\n\nå¯ä»¥è¯•è¯•ï¼Œæˆ‘çš„ç†è§£æ˜¯å¦‚æœç”¨volatileè§£å†³å¯è§æ€§é—®é¢˜ï¼Œå¦‚æœåœ¨while (flag)çš„å¾ªç¯ä½“é‡Œé¢å†æ¬¡ä½¿ç”¨ï¼ˆè¯»å–ï¼‰flagï¼Œä¹Ÿæ˜¯å¯ä»¥é€€å‡ºçš„ï¼Œä¸çŸ¥é“æˆ‘çš„ç†è§£æ˜¯å¦æ­£ç¡®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595212882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":214590,"ip_address":""},"score":292388,"extra":""}]},{"author":{"id":1063149,"avatar":"https://static001.geekbang.org/account/avatar/00/10/38/ed/72f73710.jpg","nickname":"å˜»å˜»","note":"","ucode":"C47140EF144225","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202319,"discussion_content":"æœ‰å¯èƒ½ä¸èƒ½é€€å‡º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583896522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186836,"user_name":"insight","can_delete":false,"product_type":"c1","uid":1313322,"ip_address":"","ucode":"6F4E51502D0224","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/2a/c7f5d3ac.jpg","comment_is_top":false,"comment_ctime":1583936270,"is_pvip":false,"replies":[{"id":"72102","content":"åº”è¯¥å¿«äº†ï¼Œå¤§æ¦‚æ˜¯ä¸‹å‘¨","user_name":"ä½œè€…å›å¤","comment_id":186836,"uid":"1001470","ip_address":"","utype":1,"ctime":1583971740,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"53123543822","product_id":100047701,"comment_content":"çœ‹è€å¸ˆä½¿ç”¨Lambdaè¡¨è¾¾å¼æ„Ÿè§‰å­¦åˆ°äº†éå¸¸å¤šï¼Œéå¸¸æ”¯æŒè€å¸ˆè¿™æ ·åšï¼Œæ¯•ç«Ÿç¨‹åºå‘˜å°±æ˜¯è¦ä¸æ–­èµ°å‡ºèˆ’é€‚åŒºï¼Œå­¦ä¹ æ–°ä¸œè¥¿çš„ã€‚å°±æ˜¯è€å¸ˆçš„LambdaåŠ é¤èƒ½ä¸èƒ½æ—©ä¸€ç‚¹æ¥ï¼Œå¯¹ç…§èµ·æ¥çœ‹çš„æ›´èˆ’æœä¸€äº›","like_count":12,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486892,"discussion_content":"åº”è¯¥å¿«äº†ï¼Œå¤§æ¦‚æ˜¯ä¸‹å‘¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583971740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186541,"user_name":"æ±¤æ°","can_delete":false,"product_type":"c1","uid":1645600,"ip_address":"","ucode":"1BCBA3180FCABF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pnqpjxyLtUpgJaOlrE8v57v3ZROECBdJeg96wvvPK2yK1ibHFibxRGyumOekveanVCibUcicw1EibiaBuicfkibGKuqFfw/132","comment_is_top":false,"comment_ctime":1583861875,"is_pvip":false,"replies":[{"id":"72050","content":"æŠ±æ­‰ï¼Œå› ä¸ºæœ¬æ–‡åˆ é™¤äº†åŸæ¥æœ‰çš„åˆ†å¸ƒå¼é”çš„ä¾‹å­ï¼Œæ‰€ä»¥æœ€åæ€»ç»“è¿™è¾¹çš„æè¿°è°ˆåˆ°çš„ã€é”è‡ªåŠ¨è¶…æ—¶é‡Šæ”¾é—®é¢˜ã€æœ‰ç‚¹å”çªï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ã€‚ä½ ç†è§£çš„æ²¡é”™ï¼Œé”è¿‡æœŸæ˜¯æŒ‡åˆ†å¸ƒå¼é”çš„è¿‡æœŸï¼Œæœ¬åœ°é”æ˜¯åªæœ‰ç­‰å¾…é”è¶…æ—¶","user_name":"ä½œè€…å›å¤","comment_id":186541,"uid":"1001470","ip_address":"","utype":1,"ctime":1583905231,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"53123469427","product_id":100047701,"comment_content":"å¯¹ç€ä»£ç çœ‹é”è¿‡æœŸè’™äº†åŠå¤©ï¼Œè¿˜ä»¥ä¸ºtrylockçš„æ—¶é—´ä¸æ˜¯ç­‰å¾…é”çš„æ—¶é—´ï¼Œä»¥ä¸ºæˆ‘ä¸€ç›´ç†è§£çš„æ˜¯é”™è¯¯çš„ã€‚æœ€å¥½åŠ ä¸Šç‰¹å®šçš„æ¡ä»¶ã€‚æœ¬åœ°é”å“ªæœ‰é”è¿‡æœŸå‘¢ã€‚åŸæ¥æœ‰äº›åˆ†å¸ƒå¼é”ä¸ºäº†é˜²æ­¢è°ƒç”¨æ–¹æŒ‚äº†ä¸é‡Šæ”¾é”åŠ äº†è¶…æ—¶ã€‚çœ‹åˆ°æœ‰è¯´ç”¨å®¢æˆ·ç«¯ç»­æœŸçš„ï¼Œä¸šåŠ¡ä¿è¯çš„ï¼Œä¸šåŠ¡çš„ç¡®ä¸€å®šè¦ä¿è¯çš„ï¼Œç”¨åˆ†å¸ƒå¼é”å¯ä»¥è§£å†³ä¸šåŠ¡æ•°æ®åº“å¹‚ç­‰åœ¨é«˜å¹¶å‘å†²çªå¼ºçƒˆä¸‹æ€§èƒ½é™ä½ã€‚","like_count":13,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486793,"discussion_content":"æŠ±æ­‰ï¼Œå› ä¸ºæœ¬æ–‡åˆ é™¤äº†åŸæ¥æœ‰çš„åˆ†å¸ƒå¼é”çš„ä¾‹å­ï¼Œæ‰€ä»¥æœ€åæ€»ç»“è¿™è¾¹çš„æè¿°è°ˆåˆ°çš„ã€é”è‡ªåŠ¨è¶…æ—¶é‡Šæ”¾é—®é¢˜ã€æœ‰ç‚¹å”çªï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ã€‚ä½ ç†è§£çš„æ²¡é”™ï¼Œé”è¿‡æœŸæ˜¯æŒ‡åˆ†å¸ƒå¼é”çš„è¿‡æœŸï¼Œæœ¬åœ°é”æ˜¯åªæœ‰ç­‰å¾…é”è¶…æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583905231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240228,"user_name":"éƒ‘æ€é›¨","can_delete":false,"product_type":"c1","uid":1474579,"ip_address":"","ucode":"F1F4B08FC94E7D","user_header":"https://static001.geekbang.org/account/avatar/00/16/80/13/df2a0ced.jpg","comment_is_top":false,"comment_ctime":1596796117,"is_pvip":false,"replies":[{"id":"88688","content":"èµ","user_name":"ä½œè€…å›å¤","comment_id":240228,"uid":"1001470","ip_address":"","utype":1,"ctime":1596797527,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"40251501781","product_id":100047701,"comment_content":"ä¸€ã€åŠ é”å’Œé‡Šæ”¾æ²¡æœ‰é…å¯¹ï¼š<br>lock ä¸ unlock é€šå¸¸ç»“å¯¹ä½¿ç”¨ï¼Œä½¿ç”¨æ—¶ï¼Œä¸€èˆ¬å°†unlockæ”¾åœ¨finallyä»£ç å—ä¸­ã€‚ä½†æ˜¯é‡Šæ”¾é”æ—¶æœ€å¥½å¢åŠ åˆ¤æ–­ï¼š<br>if (lock.isHeldByCurrentThread()) lock.unlock(); <br>è¿™æ ·é¿å…é”æŒæœ‰è¶…æ—¶åé‡Šæ”¾å¼•å‘IllegalMonitorStateExceptionå¼‚å¸¸ã€‚<br><br>å¦‚æœæ€•å¿˜è®°é‡Šæ”¾é”ï¼Œå¯ä»¥å°†é”å°è£…æˆä¸€ä¸ªä»£ç†æ¨¡å¼ï¼Œå¦‚ä¸‹ï¼š<br>public class AutoUnlockProxy implements Closeable {<br><br>    private Lock lock;<br><br>    public AutoUnlockProxy(Lock lock){<br>        this.lock = lock;<br>    }<br><br>    public void lock(){<br>        lock.lock();<br>    }<br><br>    public boolean tryLock(){<br>        return lock.tryLock();<br>    }<br><br>    @Override<br>    public void close() throws IOException {<br>        lock.unlock();<br>    }<br>}<br><br>ä½¿ç”¨æ—¶ï¼Œé€šè¿‡try-with-resource çš„æ–¹å¼ä½¿ç”¨ï¼Œå¯ä»¥è¾¾åˆ°è‡ªåŠ¨é‡Šæ”¾é”çš„ç›®çš„ï¼š<br>try(AutoUnlockProxy proxy = new AutoUnlockProxy(new ReentrantLock())){<br>            proxy.lock();<br>        }catch (Exception e){<br>            e.printStackTrace();<br>        }<br><br><br>äºŒã€é”è‡ªåŠ¨é‡Šæ”¾å¯¼è‡´çš„é‡å¤é€»è¾‘æ‰§è¡Œï¼ˆè¡¥å……çš„ç»†èŠ‚ç‚¹ï¼‰<br>1ã€ä»£ç å±‚é¢ï¼šå¯¹è¯·æ±‚è¿›è¡ŒéªŒé‡ï¼›<br>2ã€æ•°æ®åº“å±‚é¢ï¼šå¦‚æœæœ‰æ’å…¥æ“ä½œï¼Œå»ºè®®è®¾ç½®å”¯ä¸€ç´¢å¼•ï¼Œåœ¨æ•°æ®åº“å±‚é¢èƒ½å¢åŠ ä¸€å±‚å®‰å…¨ä¿éšœï¼›","like_count":9,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503382,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596797527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1242121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f4/09/d78fa748.jpg","nickname":"æ ¤æ«","note":"","ucode":"72C5D6EB22CA9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309144,"discussion_content":"&#34;é”è‡ªåŠ¨é‡Šæ”¾å¯¼è‡´çš„é‡å¤é€»è¾‘&#34;,ä¸ºå•¥ä¼šå¯¼è‡´é‡å¤?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601197745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194573,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1585068852,"is_pvip":false,"replies":[{"id":"74074","content":"å°±æ˜¯é”ç»­æœŸè§£å†³ å¯ä»¥çœ‹ä¸€ä¸‹redissonå®ç°","user_name":"ä½œè€…å›å¤","comment_id":194573,"uid":"1001470","ip_address":"","utype":1,"ctime":1585097924,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"27354872628","product_id":100047701,"comment_content":"å…³äºé”è¿‡æœŸé—®é¢˜ã€‚ä»¥å‰åšredisåˆ†å¸ƒå¼é”çš„æ—¶å€™ä¸€ç›´åœ¨æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚å½“æ—¶è§‰å¾—å°±æ˜¯å°½é‡è®©é”è¿‡æœŸæ—¶é—´æ¯”ç¨‹åºæ‰§è¡Œä¹‹é—´ç•¥é•¿ä¸€äº›ï¼Œä»¥ä¿è¯åŠ é”åŒºåŸŸä»£ç èƒ½å°½é‡æ‰§è¡Œå®Œæˆã€‚çœ‹åˆ°è€å¸ˆç»™å…¶ä»–åŒå­¦è¯„è®ºè¯´å¯ä»¥ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»ä¸æ–­é‡ç½®é”æ—¶é—´ï¼Œè¿™é‡Œæœ‰æˆ‘ç†è§£æ˜¯é’ˆå¯¹åƒredisè¿™ç§åˆ©ç”¨setnxå®ç°çš„åˆ†å¸ƒå¼é”å¯ä»¥è¿™ä¹ˆè§£å†³ã€‚é‚£è¿˜æœ‰å…¶ä»–åœºæ™¯å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488849,"discussion_content":"å°±æ˜¯é”ç»­æœŸè§£å†³ å¯ä»¥çœ‹ä¸€ä¸‹redissonå®ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585097924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1242121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f4/09/d78fa748.jpg","nickname":"æ ¤æ«","note":"","ucode":"72C5D6EB22CA9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309134,"discussion_content":"&#34;å°½é‡è®©é”è¿‡æœŸæ—¶é—´æ¯”ç¨‹åºæ‰§è¡Œä¹‹é—´ç•¥é•¿ä¸€äº›ï¼Œä»¥ä¿è¯åŠ é”åŒºåŸŸä»£ç èƒ½å°½é‡æ‰§è¡Œå®Œæˆ&#34;,åŠ é”åŒºåŸŸä»£ç æ²¡æ‰§è¡Œå®Œé”å°±è¿‡æœŸäº†,ä¼šè·³è¿‡é”åŒºåŸŸå†…åé¢çš„ä»£ç è·³å‡ºé”åŒºåŸŸ?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601194942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1350991,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/4f/273ffb51.jpg","nickname":"å°å“ªå’","note":"","ucode":"252087A733355C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1242121,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f4/09/d78fa748.jpg","nickname":"æ ¤æ«","note":"","ucode":"72C5D6EB22CA9F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391583,"discussion_content":"è‚¯å®šä¸ä¼šå‘€ï¼Œï¼ŒåŠ é”æ˜¯ä¸ºäº†ä¿æŠ¤å…±äº«èµ„æºï¼Œä¿è¯å¯¹å…¶è¯»å†™åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ã€‚å¦‚æœé”è¿‡æœŸï¼Œå½“å‰çº¿ç¨‹è¿˜åœ¨é”ä¿æŠ¤åŒºåŸŸå†…ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç«äº‰è·å–é” å¹¶è¿›å…¥é”ä¿æŠ¤åŒºåŸŸã€‚åŸæœ¬åº”è¯¥ä¸²è¡Œçš„é€»è¾‘å˜æˆäº†å¹¶è¡Œï¼Œè¿™å°±å‡ºé—®é¢˜äº†å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630543240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309134,"ip_address":""},"score":391583,"extra":""}]}]},{"had_liked":false,"id":186339,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1583827614,"is_pvip":false,"replies":[{"id":"71966","content":"å¯ä»¥æ— é™ç»­æœŸï¼Œæ¯”å¦‚redissonçš„RedissonLockï¼Œé”ç»­æœŸæ˜¯æ¯æ¬¡ç»­ä¸€æ®µæ—¶é—´ï¼Œæ¯”å¦‚30ç§’ï¼Œç„¶å10ç§’æ‰§è¡Œä¸€æ¬¡ç»­æœŸï¼Œè™½ç„¶æ˜¯æ— é™æ¬¡ç»­æœŸï¼Œå³ä½¿å®¢æˆ·ç«¯å´©æºƒäº†ä¹Ÿæ²¡å…³ç³»æ— æ³•è‡ªåŠ¨ç»­æœŸåè‡ªç„¶ä¼šè¶…æ—¶","user_name":"ä½œè€…å›å¤","comment_id":186339,"uid":"1001470","ip_address":"","utype":1,"ctime":1583831128,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"27353631390","product_id":100047701,"comment_content":"volatile è€ç”Ÿé•¿è°ˆçš„é—®é¢˜äº†ï¼Œå…³äºé”è¿‡æœŸï¼Œå¦‚æœå¼€å¯ä¸€ä¸ªçº¿ç¨‹ç»­æœŸï¼Œä½†æ˜¯æœ‰æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ¯”å¦‚ 5 æ¬¡ï¼Œé‚£ä¹ˆ 5 æ¬¡ä»¥åå¦‚ä½•ä¿è¯å…¶å®ƒçº¿ç¨‹æ‹¿åˆ°é”è€Œä¸ä¼šé‡å¤æ‰§è¡Œä¸šåŠ¡äº†ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486721,"discussion_content":"å¯ä»¥æ— é™ç»­æœŸï¼Œæ¯”å¦‚redissonçš„RedissonLockï¼Œé”ç»­æœŸæ˜¯æ¯æ¬¡ç»­ä¸€æ®µæ—¶é—´ï¼Œæ¯”å¦‚30ç§’ï¼Œç„¶å10ç§’æ‰§è¡Œä¸€æ¬¡ç»­æœŸï¼Œè™½ç„¶æ˜¯æ— é™æ¬¡ç»­æœŸï¼Œå³ä½¿å®¢æˆ·ç«¯å´©æºƒäº†ä¹Ÿæ²¡å…³ç³»æ— æ³•è‡ªåŠ¨ç»­æœŸåè‡ªç„¶ä¼šè¶…æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583831128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2152306,"avatar":"https://static001.geekbang.org/account/avatar/00/20/d7/72/cbef720d.jpg","nickname":"é²é¸£","note":"","ucode":"974BA3C3E64630","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307738,"discussion_content":"è‡ªåŠ¨ç»­æœŸä¼šä¸ä¼šå¯¼è‡´é¥¥é¥¿ï¼Œä¸€ç›´ä¸é‡Šæ”¾äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600746907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1575056,"avatar":"https://static001.geekbang.org/account/avatar/00/18/08/90/ce429e02.jpg","nickname":"sunshine","note":"","ucode":"0CF3A7F542FA9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394438,"discussion_content":"åŒé—®å•Šï¼Œå¦‚æœä¸šåŠ¡çº¿ç¨‹å¼‚å¸¸é€€å‡ºï¼Œå¯¼è‡´æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œè¿˜æ€ä¹ˆåŠï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631882988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188787,"user_name":"æœ¨æ§¿èŠ±å¼€","can_delete":false,"product_type":"c1","uid":1068781,"ip_address":"","ucode":"7DD06CDB91A8ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/ed/e99fc0f9.jpg","comment_is_top":false,"comment_ctime":1584415785,"is_pvip":false,"replies":[{"id":"72820","content":"ä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œä¸»è¦æ˜¯æ¼”ç¤ºé”åŒ…è£¹äº†å¹¶ä¸éœ€è¦åŠ é”çš„æ…¢æ–¹æ³•","user_name":"ä½œè€…å›å¤","comment_id":188787,"uid":"1001470","ip_address":"","utype":1,"ctime":1584419134,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14469317673","product_id":100047701,"comment_content":"è€å¸ˆå¥½ï¼š<br>&#47;&#47;ä¸æ¶‰åŠå…±äº«èµ„æºçš„æ…¢æ–¹æ³•<br>TimeUnit.MILLISECONDS.sleep(10) è¿™ä¸ªæ–¹æ³•æœ¬è´¨è°ƒç”¨çš„æ˜¯Threadçš„ public static void sleep(long millis, int nanos) è¿™æ˜¯ä¸€ä¸ªstaticçš„ç±»æ–¹æ³•,åœ¨åŠ é”ç²’åº¦å¤ªç²—çš„wrongæ–¹æ³•ä¸­,æ˜¯ä¸æ˜¯å› ä¸ºçº¿ç¨‹éƒ½å»æŠ¢Threadçš„ç±»é”æ‰å¯¼è‡´è€—æ—¶è¾ƒé•¿,Threadç±»ä¸å°±æˆå…¬å…±èµ„æºäº†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487525,"discussion_content":"ä¸æ˜¯è¿™ä¸ªåŸå› ï¼Œä¸»è¦æ˜¯æ¼”ç¤ºé”åŒ…è£¹äº†å¹¶ä¸éœ€è¦åŠ é”çš„æ…¢æ–¹æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584419134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187630,"user_name":"better","can_delete":false,"product_type":"c1","uid":1257750,"ip_address":"","ucode":"2B9BCCED753D7F","user_header":"https://static001.geekbang.org/account/avatar/00/13/31/16/f2269e73.jpg","comment_is_top":false,"comment_ctime":1584177212,"is_pvip":true,"replies":[{"id":"72417","content":"æ²¡é”™ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªçº¿ç¨‹äº¤é”™æ‰§è¡Œä¸¤ä¸ªæ–¹æ³•ï¼Œsynchronizedæ˜¯æ¯”è¾ƒç®€å•æ¸…ç†çš„è§£å†³æ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","comment_id":187630,"uid":"1001470","ip_address":"","utype":1,"ctime":1584187785,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14469079100","product_id":100047701,"comment_content":"å®è·µäº†ä¸€éadd()æ–¹æ³•å’Œcompare()æ–¹æ³•è¿™ä¸ªä¾‹å­ï¼Œç»“åˆsynchronizedçš„åº•å±‚åŸç†ï¼Œä¸çŸ¥é“ç†è§£å¾—æ­£ä¸æ­£ç¡®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­çš„ç†è§£æ˜¯ï¼Œç”±äºsynchronizedåº•å±‚æ˜¯åŸºäºmoniteræŒ‡ä»¤å’Œå¯¹è±¡é”å®ç°çš„ï¼Œæ‰€ä»¥å½“ä¸ºadd()æ–¹æ³•å’Œcompare()æ–¹æ³•åŒæ—¶åŠ é”åï¼Œinterestingè¿™ä¸ªå¯¹è±¡å°±ä½œä¸ºå¯¹è±¡é”è¢«é”ä½äº†ï¼Œè€Œæ¯æ¬¡æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡é”çš„çº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥æ‰§è¡Œadd()æ–¹æ³•çš„çº¿ç¨‹å’Œæ‰§è¡Œcompare()æ–¹æ³•çš„ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°äº†interestingè¿™ä¸ªå¯¹è±¡é”ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ–¹æ³•å°±å˜æˆä¸²è¡ŒåŒ–æ‰§è¡Œäº†ï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ä¹Ÿå°±å¾—åˆ°äº†è§£å†³ã€‚<br>ä¸çŸ¥é“è€å¸ˆç»“åˆsynchronizedåº•å±‚åŸç†ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æœ‰æ²¡æœ‰æ›´å¥½çš„ç†è§£æ–¹å¼","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487172,"discussion_content":"æ²¡é”™ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªçº¿ç¨‹äº¤é”™æ‰§è¡Œä¸¤ä¸ªæ–¹æ³•ï¼Œsynchronizedæ˜¯æ¯”è¾ƒç®€å•æ¸…ç†çš„è§£å†³æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584187785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240586,"user_name":"å°èƒ¡å­","can_delete":false,"product_type":"c1","uid":1018182,"ip_address":"","ucode":"79FEC6400D25DA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/46/0b7828a1.jpg","comment_is_top":false,"comment_ctime":1596986384,"is_pvip":false,"replies":[{"id":"88831","content":"æ’åºçš„æ˜¯è¦åŠ é”çš„å¯¹è±¡ä¸æ˜¯æ•°æ®åº“æ‰€æœ‰æ•°æ®","user_name":"ä½œè€…å›å¤","comment_id":240586,"uid":"1001470","ip_address":"","utype":1,"ctime":1597022661,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10186920976","product_id":100047701,"comment_content":"çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­å•†å“æˆåƒä¸Šä¸‡å­˜å‚¨åœ¨dbæ²¡åŠæ³•å¯¹å•†å“æ’åºæ“ä½œï¼Œé‚£æ€ä¹ˆé¿å…æ­»é”äº†å‘¢","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503495,"discussion_content":"æ’åºçš„æ˜¯è¦åŠ é”çš„å¯¹è±¡ä¸æ˜¯æ•°æ®åº“æ‰€æœ‰æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597022661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195835,"user_name":"zå°ä¿Šã€Arno","can_delete":false,"product_type":"c1","uid":1301304,"ip_address":"","ucode":"312B3DDCF15102","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/38/7ab139a3.jpg","comment_is_top":false,"comment_ctime":1585218136,"is_pvip":false,"replies":[{"id":"74347","content":"ä½ å¯èƒ½ææ··äº†ï¼Œæ¯”è¾ƒä¸‹ä¸‹é¢ä¸‰æ®µä»£ç çš„è¾“å‡ºï¼š<br> System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&gt;i%2==0).filter(result-&gt;result==true).collect(Collectors.toList()));<br>        System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&gt;i%2==0).filter(result-&gt;result).collect(Collectors.toList()));<br>        System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&gt;i%2==0).map(result-&gt;result).collect(Collectors.toList()));","user_name":"ä½œè€…å›å¤","comment_id":195835,"uid":"1001470","ip_address":"","utype":1,"ctime":1585224762,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"10175152728","product_id":100047701,"comment_content":".filter(result -&gt; result) è€å¸ˆ è¿™ä¸ªæ˜¯ä»€ä¹ˆä½œç”¨å•Šï¼Ÿ å»æ‰ï¼Œæµ‹è¯•ä»£ç é”™è¯¯çš„ç¤ºä¾‹ç»“æœä¹Ÿæ˜¯å¯¹çš„äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489169,"discussion_content":"ä½ å¯èƒ½ææ··äº†ï¼Œæ¯”è¾ƒä¸‹ä¸‹é¢ä¸‰æ®µä»£ç çš„è¾“å‡ºï¼š\n System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&amp;gt;i%2==0).filter(result-&amp;gt;result==true).collect(Collectors.toList()));\n        System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&amp;gt;i%2==0).filter(result-&amp;gt;result).collect(Collectors.toList()));\n        System.out.println(IntStream.rangeClosed(1,10).mapToObj(i-&amp;gt;i%2==0).map(result-&amp;gt;result).collect(Collectors.toList()));","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585224762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1301304,"avatar":"https://static001.geekbang.org/account/avatar/00/13/db/38/7ab139a3.jpg","nickname":"zå°ä¿Šã€Arno","note":"","ucode":"312B3DDCF15102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214686,"discussion_content":"æ˜ç™½äº†ï¼Œï¼Œå°±æ˜¯Stream<Boolean>ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585226247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188958,"user_name":"ä½•å²¸åº·","can_delete":false,"product_type":"c1","uid":1444317,"ip_address":"","ucode":"F24898244A170D","user_header":"https://static001.geekbang.org/account/avatar/00/16/09/dd/02c73bd3.jpg","comment_is_top":false,"comment_ctime":1584439746,"is_pvip":false,"replies":[{"id":"72909","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":188958,"uid":"1001470","ip_address":"","utype":1,"ctime":1584448941,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10174374338","product_id":100047701,"comment_content":"Volatileä¿è¯äº†å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚javaä¸­è¿˜æœ‰ä¸¤ä¸ªå…³é”®å­—å¯ä»¥å®ç°å¯è§æ€§ï¼Œå³synchronizedå’Œfinalã€‚<br>http:&#47;&#47;www.cs.umd.edu&#47;~pugh&#47;java&#47;memoryModel&#47;jsr-133-faq.htmlä¸­æœ‰æ¯”è¾ƒè¯¦ç»†çš„æè¿°ï¼›è‹±è¯­ä¸å¥½æˆ‘å°±ä¸ç¿»è¯‘äº†ï¼Œç›´æ¥è´´å‡ºæ¥ã€‚<br>Volatileï¼š<br>â€œVolatile fields are special fields which are used for communicating state between threads. Each read of a volatile will see the last write to that volatile by any thread; in effect, they are designated by the programmer as fields for which it is never acceptable to see a &quot;stale&quot; value as a result of caching or reordering. The compiler and runtime are prohibited from allocating them in registers. They must also ensure that after they are written, they are flushed out of the cache to main memory, so they can immediately become visible to other threads. <br>Similarly, before a volatile field is read, the cache must be invalidated so that the value in main memory, not the local processor cache, is the one seen. There are also additional restrictions on reordering accesses to volatile variables.â€<br>synchronizedï¼š<br>â€œThis means that any memory operations which were visible to a thread before exiting a synchronized block are visible to any thread after it enters a synchronized block protected by the same monitor, since all the memory operations happen before the release, and the release happens before the acquire.â€<br>finalï¼š<br>â€œThe values for an object&#39;s final fields are set in its constructor. Assuming the object is constructed &quot;correctly&quot;, once an object is constructed, the values assigned to the final fields in the constructor will be visible to all other threads without synchronization. In addition, the visible values for any other object or array referenced by those final fields will be at least as up-to-date as the final fields.â€<br>","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487578,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584448941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188389,"user_name":"mgs2002","can_delete":false,"product_type":"c1","uid":1812970,"ip_address":"","ucode":"F5931108BD509B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","comment_is_top":false,"comment_ctime":1584347993,"is_pvip":false,"replies":[{"id":"72689","content":"synchronizedä¹Ÿå¯ä»¥ç¡®ä¿å¯è§æ€§ï¼Œæœ¬ä¾‹çš„rightå®ç°ä¸­volatileä¸æ˜¯å¿…é¡»çš„ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­å°±æ²¡æœ‰å»æ‰äº†ï¼Œè€Œä¸”ä¸»è¦è¿˜ä¸ºäº†å¼•å‡ºæ€è€ƒé¢˜","user_name":"ä½œè€…å›å¤","comment_id":188389,"uid":"1001470","ip_address":"","utype":1,"ctime":1584350315,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"10174282585","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘çŸ¥é“volatileæ˜¯ä¿è¯çº¿ç¨‹é—´å˜é‡å¯è§æ€§å’Œé˜²æ­¢æŒ‡ä»¤é‡æ’åºçš„ï¼Œä¸è¿‡å¼€å¤´ä¾‹å­æˆ‘æŠŠaå’Œbçš„volatileä¿®é¥°å»æ‰æ‰§è¡Œrightæ–¹æ³•ï¼Œç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„å‘¢","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487393,"discussion_content":"synchronizedä¹Ÿå¯ä»¥ç¡®ä¿å¯è§æ€§ï¼Œæœ¬ä¾‹çš„rightå®ç°ä¸­volatileä¸æ˜¯å¿…é¡»çš„ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸€ä¸ªä¾‹å­å°±æ²¡æœ‰å»æ‰äº†ï¼Œè€Œä¸”ä¸»è¦è¿˜ä¸ºäº†å¼•å‡ºæ€è€ƒé¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584350315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206550,"discussion_content":"å“¦ï¼Œæ˜¯è¿™æ ·å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584414026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187879,"user_name":"è¯·å«æˆ‘å’Œå°š","can_delete":false,"product_type":"c1","uid":1703256,"ip_address":"","ucode":"33A8A1CDA103F9","user_header":"https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg","comment_is_top":false,"comment_ctime":1584264677,"is_pvip":false,"replies":[{"id":"72517","content":"å¯ä»¥ç»™classåŠ é”ï¼Œå¯¹æœ¬ä¾‹æ•ˆæœä¸€æ ·ã€‚æ­£å¦‚ä½ è¯´çš„ï¼ŒåŠ é”è®©è®©å¹¶è¡Œå˜ä¸ºäº†ä¸²è¡Œï¼Œæ‰€ä»¥å°½é‡è¦é”èŒƒå›´å°ä¸€ç‚¹ï¼Œæœ¬ä¾‹åªæ˜¯demoï¼ŒçœŸå®æƒ…å†µå¯¹äº++è¿™ç§æ“ä½œï¼ŒåŠ é”å°±æ²¡å¿…è¦äº†ï¼Œç”¨Atomicç±»æ›´å¥½ã€‚","user_name":"ä½œè€…å›å¤","comment_id":187879,"uid":"1001470","ip_address":"","utype":1,"ctime":1584273368,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"10174199269","product_id":100047701,"comment_content":"è€å¸ˆçš„ Synchronized Demo2 ç»™counter++ï¼Œright çš„æ–¹æ³•æ˜¯ç»™ static å˜é‡åŠ Synchronizedï¼Œä½†æ˜¯ä¸Šé¢åˆè¯´äº†æ˜¯å¤šçº¿ç¨‹å»æ‰§è¡Œ++æ–¹æ³•ï¼Œstatic æ˜¯å±äºç±»çš„ï¼Œä½ ç»™static åŠ åŒæ­¥ï¼Œæ˜¯å¦å¯ä»¥ç†è§£ä¸ºä½ ç»™ç±»åŠ äº†é”ï¼Œå¤šçº¿ç¨‹ä¸‹å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯å°±å˜ä¸ºäº†ä¸æ˜¯å¤šçº¿ç¨‹å»å¹¶è¡Œæ‰§è¡Œï¼Œè€Œæ˜¯ä¸²è¡Œå»æ‰§è¡Œäº†<br>åŒç†æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥å†™ Synchronized(Data.class){ TODO }ï¼Œ<br>ä¸€ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚ right æ–¹æ³•è¦å¤„ç†100 ä¸ªæ·»åŠ æ“ä½œï¼Œæœ¬æ¥æ˜¯å¤šçº¿ç¨‹å»å¹¶è¡Œåš 100N ä¸ªæ·»åŠ æ“ä½œï¼Œä½†æ˜¯å»ç»™ rightæ–¹æ³• é‡ŒåŠ äº†ç±»é”ï¼Œå°±å˜æˆäº†ä¸²è¡Œå»æ‰§è¡Œï¼Œ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487279,"discussion_content":"å¯ä»¥ç»™classåŠ é”ï¼Œå¯¹æœ¬ä¾‹æ•ˆæœä¸€æ ·ã€‚æ­£å¦‚ä½ è¯´çš„ï¼ŒåŠ é”è®©è®©å¹¶è¡Œå˜ä¸ºäº†ä¸²è¡Œï¼Œæ‰€ä»¥å°½é‡è¦é”èŒƒå›´å°ä¸€ç‚¹ï¼Œæœ¬ä¾‹åªæ˜¯demoï¼ŒçœŸå®æƒ…å†µå¯¹äº++è¿™ç§æ“ä½œï¼ŒåŠ é”å°±æ²¡å¿…è¦äº†ï¼Œç”¨Atomicç±»æ›´å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584273368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186157,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1583767897,"is_pvip":false,"replies":[{"id":"71928","content":"ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯å¦‚æœä¸åŒæ–¹æ³•éœ€è¦ä¸åŒçš„é”ï¼Œé‚£ä¹ˆå°±åªèƒ½ç”¨å¤šä¸ªé”å­—æ®µäº†ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":186157,"uid":"1001470","ip_address":"","utype":1,"ctime":1583807628,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"10173702489","product_id":100047701,"comment_content":" è€å¸ˆï¼Œæ˜¯ç”¨Data.classåŠ é”ï¼Œç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚<br>è¯·æ•™ä¸€ä¸‹ï¼šprivate static Object locker = new Object(); ä¸Data.classåœ¨åŠ é”æ—¶ï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å—ï¼Ÿ<br>å› ä¸ºæˆ‘è§‰å¾—ï¼šData.classç›¸å¯¹äºæ–°åˆ›å»ºçš„lockerå¯¹è±¡æ›´èŠ‚çœå†…å­˜ã€‚<br><br>   public void right1() {<br>        synchronized (Data.class) {<br>            counter++;<br>        }<br>    }<br><br>æµ‹è¯•ä»£ç <br><br>    public static void main(String[] args) throws InterruptedException {<br>        LongAdder adder = new LongAdder();<br>        for (int i = 0; i &lt; 10; i++) {<br>            Thread thread = new Thread(new Runnable() {<br>                @Override<br>                public void run() {<br>                    Data data = new Data();<br>                    for (int j = 0; j &lt; 10000; j++) {<br>&#47;&#47;                        data.wrong();<br>                        data.right1();<br>                    }<br>                    adder.increment();<br>                }<br>            });<br>            thread.start();<br>        }<br><br>        while (adder.longValue() &lt; 10){<br>            Thread.sleep(1000L);<br>        }<br><br>        System.out.println(counter);<br>    }","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486650,"discussion_content":"ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯å¦‚æœä¸åŒæ–¹æ³•éœ€è¦ä¸åŒçš„é”ï¼Œé‚£ä¹ˆå°±åªèƒ½ç”¨å¤šä¸ªé”å­—æ®µäº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583807628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201837,"discussion_content":"å¤šè°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583843402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186100,"user_name":"è¥¿è¡—æ¶äºº","can_delete":false,"product_type":"c1","uid":1046779,"ip_address":"","ucode":"0B2E195565B080","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/fb/f3a2dc4d.jpg","comment_is_top":false,"comment_ctime":1583757399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10173691991","product_id":100047701,"comment_content":"çœ‹è€å¸ˆä½¿ç”¨äº†Lombok","like_count":2},{"had_liked":false,"id":224160,"user_name":"Sam.å¼ æœ","can_delete":false,"product_type":"c1","uid":1132448,"ip_address":"","ucode":"FB20554D94B250","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/a0/f12115b7.jpg","comment_is_top":false,"comment_ctime":1591288761,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5886256057","product_id":100047701,"comment_content":"è¿™é‡Œéƒ½æ˜¯å¤§ç¥å•Šï¼Œé™¤äº†æˆ‘è¿™ä¸ªå°å…µ","like_count":1},{"had_liked":false,"id":204115,"user_name":"C10K","can_delete":false,"product_type":"c1","uid":1113158,"ip_address":"","ucode":"737829986EA941","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/46/3aa83d38.jpg","comment_is_top":false,"comment_ctime":1586334891,"is_pvip":true,"replies":[{"id":"76287","content":"å¯ä»¥å•ç‹¬ä¸‹è½½","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586337516,"ip_address":"","comment_id":204115,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881302187","product_id":100047701,"comment_content":"openJDK8 ä¸‹ æ²¡æœ‰visualVM","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491080,"discussion_content":"å¯ä»¥å•ç‹¬ä¸‹è½½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586337516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187748,"user_name":"Geek_guan","can_delete":false,"product_type":"c1","uid":1688939,"ip_address":"","ucode":"592603EB5F042D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLAia6hRmnSZyuLtKvxxXvg9vgUfwSReCOaHKGLKuRcNX2BCNdmCFSlXyBZvpSXia5LXKjAZKeBXKuw/132","comment_is_top":false,"comment_ctime":1584208301,"is_pvip":false,"replies":[{"id":"72439","content":"private static boolean b = true;<br>    public static void main(String[] args) throws InterruptedException {<br>        new Thread(()-&gt;{<br>            try {<br>                TimeUnit.SECONDS.sleep(3);<br>            } catch (InterruptedException e) { }<br>            b =false;<br>        }).start();<br>        while (b) {<br>            TimeUnit.MILLISECONDS.sleep(0);<br>        }<br>        System.out.println(&quot;done&quot;);<br>    }<br>è¿™ä¸ªè¯•è¯•ï¼Ÿ<br><br>å…¶å®æ˜¯è¿™æ ·çš„ï¼Œæœ€å¥å£®çš„ç¨‹åºè¿˜æ˜¯è¦ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œç¡®ä¿æ‰€æœ‰åœºæ™¯éƒ½ä¸å‡ºé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584233696,"ip_address":"","comment_id":187748,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5879175597","product_id":100047701,"comment_content":"1.å¯ä»¥é€€å‡ºã€‚è¯´ä¸èƒ½é€€å‡ºçš„éƒ½æ˜¯æ²¡æœ‰åšè¿‡å®éªŒçš„ã€‚å³ä½¿æ²¡æœ‰ä½¿ç”¨volatileä¹Ÿå¯ä»¥é€€å‡ºï¼Œä¸ä¿¡å¯ä»¥ç”¨ideaåšå®éªŒã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487226,"discussion_content":"private static boolean b = true;\n    public static void main(String[] args) throws InterruptedException {\n        new Thread(()-&amp;gt;{\n            try {\n                TimeUnit.SECONDS.sleep(3);\n            } catch (InterruptedException e) { }\n            b =false;\n        }).start();\n        while (b) {\n            TimeUnit.MILLISECONDS.sleep(0);\n        }\n        System.out.println(&amp;quot;done&amp;quot;);\n    }\nè¿™ä¸ªè¯•è¯•ï¼Ÿ\n\nå…¶å®æ˜¯è¿™æ ·çš„ï¼Œæœ€å¥å£®çš„ç¨‹åºè¿˜æ˜¯è¦ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œç¡®ä¿æ‰€æœ‰åœºæ™¯éƒ½ä¸å‡ºé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584233696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1364005,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d0/25/dde66856.jpg","nickname":"å­£ç§€","note":"","ucode":"552D21F3AECE6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209745,"discussion_content":"ä¸æ˜¯è¯´ä¸ä½¿ç”¨volatileå°±ä¸èƒ½é€€å‡ºï¼Œè€Œæ˜¯æœ‰å¯èƒ½ä¸é€€å‡ºã€‚æŒ‰è€å¸ˆè¯´çš„ï¼Œä¸ºäº†ä¿è¯ç¨‹åºå¥å£®æ€§ï¼Œéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584668874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1688939,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLAia6hRmnSZyuLtKvxxXvg9vgUfwSReCOaHKGLKuRcNX2BCNdmCFSlXyBZvpSXia5LXKjAZKeBXKuw/132","nickname":"Geek_guan","note":"","ucode":"592603EB5F042D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":222273,"discussion_content":"è¿™ä¸ªåœºæ™¯ç”±äºwhileå¾ªç¯å¯¼è‡´cpuå¤„äºå¿™ç¢Œä¹‹ä¸­ï¼Œæ²¡æœ‰ç©ºæ¥åŠæ—¶æ›´æ–°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå¦‚æœè®©ä¸»çº¿ç¨‹ä¼‘çœ ä¸€ä¼šï¼Œå°±èƒ½å¤Ÿé€€å‡ºäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586110322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1183090,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0d/72/38c62a8f.jpg","nickname":"slowly","note":"","ucode":"D8F1FB2B9E7534","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204901,"discussion_content":"ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå½“å¾ªç¯ä¸­çš„sleepæ—¶é—´å¤§äº0æ—¶ä¸åŠ volatileä¹Ÿå¯ä»¥é€€å‡ºå¾ªç¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584237782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187437,"user_name":"å¼ å°‘å","can_delete":false,"product_type":"c1","uid":1855708,"ip_address":"","ucode":"09DA0D3E7E0331","user_header":"","comment_is_top":false,"comment_ctime":1584109527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879076823","product_id":100047701,"comment_content":"æœ‰æ”¶è·","like_count":1},{"had_liked":false,"id":186674,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1583899952,"is_pvip":false,"replies":[{"id":"72051","content":"ä½ æ˜¯æŒ‡å“ªæ®µä»£ç ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1583905325,"ip_address":"","comment_id":186674,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5878867248","product_id":100047701,"comment_content":"è€å¸ˆï¼Œç»™listå®ä¾‹è§£é”ï¼Œé‚£æ“ä½œlistå°±ä¼šå¯¼è‡´listä¸€ç›´å˜ï¼Œé‚£é”ä¹Ÿæ˜¯ä¸€ç›´åœ¨å˜ï¼Œè¿™æ ·ä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486835,"discussion_content":"ä½ æ˜¯æŒ‡å“ªæ®µä»£ç ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583905325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214339,"discussion_content":"å¯¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585184127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067435,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/ab/6fde4a46.jpg","nickname":"Daizl","note":"","ucode":"0A6FE684E857AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209059,"discussion_content":"listé‡Œé¢çš„å…ƒç´ å˜äº†å§ï¼Ÿä½†æ˜¯listçš„å®ä¾‹åº”è¯¥è¿˜æ˜¯é‚£ä¸ªï¼Œæ²¡æœ‰å˜çš„å§ã€‚è€å¸ˆï¼Œæ˜¯è¿™æ ·çš„å§ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584604174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186586,"user_name":"ken","can_delete":false,"product_type":"c1","uid":1898282,"ip_address":"","ucode":"1D19B99EF869BF","user_header":"","comment_is_top":false,"comment_ctime":1583888811,"is_pvip":false,"replies":[{"id":"72043","content":"åˆ†å¸ƒå¼é”åŒæ ·æœ‰æ•ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1583893788,"ip_address":"","comment_id":186586,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5878856107","product_id":100047701,"comment_content":"è€å¸ˆç»™å‡ºçš„è§£å†³è´­ç‰©è½¦æ­»é”é—®é¢˜çš„ä»£ç èƒ½é€‚ç”¨äºåˆ†å¸ƒå¼å¤šä¸ªjvmçš„æƒ…å†µï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486806,"discussion_content":"åˆ†å¸ƒå¼é”åŒæ ·æœ‰æ•ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583893788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203116,"discussion_content":"ä¾‹å­é‡Œé¢çš„ä»£ç åº”è¯¥åªèƒ½å•æœºæœ‰æ•ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583999965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186179,"user_name":"é»‘æš—æµªå­","can_delete":false,"product_type":"c1","uid":1014691,"ip_address":"","ucode":"FBB8C24EBEC5BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/a3/82b2a73e.jpg","comment_is_top":false,"comment_ctime":1583771793,"is_pvip":true,"discussion_count":1,"race_medal":1,"score":"5878739089","product_id":100047701,"comment_content":"å…³äº1ï¼Œå¦‚æœä¸æ˜¯voliateï¼Œå·¥ä½œå†…å­˜é‡Œè¿™ä¸ªboolå˜é‡æ—¢æœ‰å¯èƒ½æ˜¯falseä¹Ÿæœ‰å¯èƒ½æ˜¯trueã€‚åŠ äº†voliateï¼Œå°±çœ‹ä¸»å†…å­˜äº†ï¼Œæ­¤æ—¶å¦‚æœæ˜¯falseï¼Œé‚£ä¹ˆæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è¯»å–ï¼Œä¹Ÿå°±æ˜¯æä¾›äº†å†…å­˜å¯è§æ€§ã€‚æ­¤æ—¶ä¸ºfalseï¼Œåˆ™ä¼šé€€å‡ºï¼Œå¦åˆ™å°±ä¼šæœ‰æŸäº›çº¿ç¨‹æ°¸è¿œå½“å®ƒä¸ºtrueå»æ‰§è¡Œï¼Œé€ æˆæ­»å¾ªç¯ã€‚å…³äº2ï¼Œå¦‚ä½•ä¿è¯é”ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾æ˜¯å…³é”®ã€‚æ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬è¦æŸ¥æ‰¾é”ä¸ºä»€å‘¢ä¼šè‡ªåŠ¨é‡Šæ”¾çš„åŸå› ã€‚å…¶å®è¯´åˆ°åº•ï¼Œå°±æ˜¯å†™Javaçš„äººè¦çŸ¥é“voliateè¿™ä¸ªå…³é”®å­—å’Œmesiæœºåˆ¶æœ‰ä»€ä¹ˆå…³ç³»","like_count":1,"discussions":[{"author":{"id":2924187,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/SluScDGqnhBNwmOQ774QEzuXiazk8Ab7ng8xCT81gunl9Hls9oibwB4AibCDxDtZwTe4mEib5QiaLXUqMv8iceXicXSYg/132","nickname":"Geek_080ce7","note":"","ucode":"C74D97C84983B9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561254,"discussion_content":"å½“cpuç¼“å­˜åˆ·æ–°äº†è‡ªç„¶ä¼šé‡Šæ”¾çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649586094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186164,"user_name":"ç¬¬ä¸€è£…ç”²é›†ç¾¤å¸ä»¤å…‹è±æ–¯ç‰¹","can_delete":false,"product_type":"c1","uid":1265707,"ip_address":"","ucode":"4E8FBB23AD860B","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","comment_is_top":false,"comment_ctime":1583768333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5878735629","product_id":100047701,"comment_content":"volatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Œä¸ä¿è¯åŸå­æ€§ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚","like_count":1},{"had_liked":false,"id":354362,"user_name":"æ¨æ˜","can_delete":false,"product_type":"c1","uid":1172215,"ip_address":"å¹¿ä¸œ","ucode":"6C94189823CCD0","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/f7/8625fd5d.jpg","comment_is_top":false,"comment_ctime":1660298419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660298419","product_id":100047701,"comment_content":"è€å¸ˆï¼Œä¸ºå•¥æˆ‘ç”¨Runnableèµ·çº¿ç¨‹è¿è¡Œaddå’Œcompareæ–¹æ³•ï¼Œè§¦å‘ä¸åˆ°a&lt;bï¼Ÿ","like_count":0},{"had_liked":false,"id":341395,"user_name":"å¯¹å¯¹å¯¹ï¼Œæ˜¯æˆ‘ï¼Œæ˜¯æˆ‘","can_delete":false,"product_type":"c1","uid":1182133,"ip_address":"","ucode":"4DBD73850A9B41","user_header":"https://static001.geekbang.org/account/avatar/00/12/09/b5/bbb93647.jpg","comment_is_top":false,"comment_ctime":1649578209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649578209","product_id":100047701,"comment_content":"ç¬¬äºŒä¸ªä¾‹å­è€å¸ˆä¸ºä»€ä¹ˆè¦æ¯æ¬¡å¾ªç¯éƒ½newä¸€ä¸ªDataçš„å¯¹è±¡å‘¢ï¼Ÿå¦‚æœåœ¨å¾ªç¯å¤–å®šä¹‰ä¸€ä¸ªDataçš„å¯¹è±¡ï¼Œä¸å°±å¯ä»¥é¿å…å¤šä¸ªå®ä¾‹è°ƒç”¨å®ä¾‹çº§åˆ«é”æ–¹æ³•å¤±æ•ˆçš„é—®é¢˜äº†ä¹ˆï¼Ÿ   åœ¨å¾ªç¯é‡Œnewå¯¹è±¡è¿˜å®¹æ˜“é€ æˆå†…å­˜æº¢å‡ºï¼Œå…¶å®è¿™ä¸ªå†™æ³•å¹¶ä¸å¥½ã€‚","like_count":0},{"had_liked":false,"id":336351,"user_name":"èŠ±è‡‚Seven","can_delete":false,"product_type":"c1","uid":2506417,"ip_address":"","ucode":"DBF07141BDE7A5","user_header":"https://static001.geekbang.org/account/avatar/00/26/3e/b1/46f42c7e.jpg","comment_is_top":false,"comment_ctime":1646106317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646106317","product_id":100047701,"comment_content":"lambdaé«˜æ‰‹","like_count":0},{"had_liked":false,"id":334345,"user_name":"å­å¤œæ¯ç¯","can_delete":false,"product_type":"c1","uid":1359678,"ip_address":"","ucode":"5D84BFE7832038","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/3e/cdc36608.jpg","comment_is_top":false,"comment_ctime":1644895429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644895429","product_id":100047701,"comment_content":"å­¦ä¹ æ‰“å¡:æ‰‹æ•²ä»£ç å®Œæˆclass02çš„å¤ä¹ ","like_count":0},{"had_liked":false,"id":327276,"user_name":"å‚²å¨‡çš„å°å®","can_delete":false,"product_type":"c1","uid":1493922,"ip_address":"","ucode":"C079B19BCC1B7C","user_header":"https://static001.geekbang.org/account/avatar/00/16/cb/a2/5e7c557e.jpg","comment_is_top":false,"comment_ctime":1640044494,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1640044494","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå…³äºå•†å“é”é‚£ä¸ªï¼Œå‡è®¾æˆ‘açº¿ç¨‹ä¹°çš„135å·å•†å“ï¼Œbçº¿ç¨‹ä¹°çš„567å·å•†å“ï¼Œç„¶åæˆ‘açº¿ç¨‹æƒ³è·å–5å·çš„é”ï¼Œä½†æ˜¯è¿™ä¸ªé”å¯èƒ½è¢«bæŒæœ‰å•Šï¼Œè¿™ä¸æ˜¯ä¹Ÿä¼šæ­»é”ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1014738,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLYMEPPrXDnqAgr2D7o1CEejzOVYkS4CgG5NGVVUlJVmOpzK9kib0p8q6st615cca8pz5fvyia5WZBw/132","nickname":"è»è‡¨é¾å˜¯","note":"","ucode":"35C626B5A80EDF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549342,"discussion_content":"æ²¡æœ‰å¾ªç¯ï¼Œå’‹ä¼šæ­»é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643869477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325244,"user_name":"æ¢…å­é»„æ—¶é›¨","can_delete":false,"product_type":"c1","uid":1015938,"ip_address":"","ucode":"9F788D09C2E9E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/82/3c21b30c.jpg","comment_is_top":false,"comment_ctime":1638875231,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638875231","product_id":100047701,"comment_content":"æ¶‰åŠåˆ°å¤šçº¿ç¨‹ï¼Œè¦å¯¹åº•å±‚å®ç°æœ‰ç‚¹è®¤è¯†çš„ã€‚","like_count":0},{"had_liked":false,"id":316556,"user_name":"Will","can_delete":false,"product_type":"c1","uid":1161437,"ip_address":"","ucode":"BB78C2B9B44D36","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/dd/d729557f.jpg","comment_is_top":false,"comment_ctime":1634389000,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634389000","product_id":100047701,"comment_content":"è¯•äº†å¾ˆå¤šé,ç¬¬ä¸€ä¸ªä¾‹å­åœ¨java11é‡Œa å’Œ b å§‹ç»ˆç›¸ç­‰,å³ä½¿ä¸åŠ volatile,æ€ä¹ˆè§£é‡Š,java11åšäº†è¿™æ–¹é¢çš„ä¼˜åŒ–?","like_count":0},{"had_liked":false,"id":309875,"user_name":"æ—¶å…‰ä¹‹åˆƒ","can_delete":false,"product_type":"c1","uid":1083381,"ip_address":"","ucode":"0F15CAD70BDDC3","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/f5/c6d1ffed.jpg","comment_is_top":false,"comment_ctime":1630378028,"is_pvip":true,"replies":[{"id":"112256","content":"å¯ä»¥å¤šå®£ä¼ ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1630385253,"ip_address":"","comment_id":309875,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630378028","product_id":100047701,"comment_content":"è€å¸ˆæ˜¯ä¸€ä¸ªå®å¹²å®¶ï¼Œç²‰äº†","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526050,"discussion_content":"å¯ä»¥å¤šå®£ä¼ ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630385253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302163,"user_name":"å‹¿æ›´æ”¹ä»»ä½•ä¿¡æ¯","can_delete":false,"product_type":"c1","uid":2028956,"ip_address":"","ucode":"575185C69C05A3","user_header":"","comment_is_top":false,"comment_ctime":1626101597,"is_pvip":false,"replies":[{"id":"109332","content":"è¿‡æ»¤æˆåŠŸçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1626142113,"ip_address":"","comment_id":302163,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626101597","product_id":100047701,"comment_content":"<br>@GetMapping(&quot;wrong&quot;)<br>public long wrong() {<br>    long begin = System.currentTimeMillis();<br>    &#47;&#47;å¹¶å‘è¿›è¡Œ100æ¬¡ä¸‹å•æ“ä½œï¼Œç»Ÿè®¡æˆåŠŸæ¬¡æ•°<br>    long success = IntStream.rangeClosed(1, 100).parallel()<br>            .mapToObj(i -&gt; {<br>                List&lt;Item&gt; cart = createCart();<br>                return createOrder(cart);<br>            })<br>            .filter(result -&gt; result)<br>            .count();<br>    log.info(&quot;success:{} totalRemaining:{} took:{}ms items:{}&quot;,<br>            success,<br>            items.entrySet().stream().map(item -&gt; item.getValue().remaining).reduce(0, Integer::sum),<br>            System.currentTimeMillis() - begin, items);<br>    return success;<br>}<br><br><br>è€å¸ˆä½ è¿™æ®µä»£ç filterï¼ˆresult â€”&gt;resultï¼‰å•¥æ„æ€<br>","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523200,"discussion_content":"è¿‡æ»¤æˆåŠŸçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626142113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296745,"user_name":"è¡Œåˆ™å°†è‡³","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1623142527,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1623142527","product_id":100047701,"comment_content":"è€å¸ˆï¼Œè´­ç‰©è½¦çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æµ‹è¯•å‡ºäº†æ­»é”çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨visualvmé‡Œçš„æ­»é”dumpæ—¥å¿—ä¸­ï¼Œæ²¡æœ‰çœ‹åˆ°è€å¸ˆæ ‡æ³¨å‡ºæ¥çš„æ­»é”æ—¥å¿—å•Šã€‚è¿™æ˜¯å’‹å›äº‹?","like_count":0},{"had_liked":false,"id":289706,"user_name":"å¼ æ–°äº®","can_delete":false,"product_type":"c1","uid":2406845,"ip_address":"","ucode":"B68A71CDEA551A","user_header":"https://static001.geekbang.org/account/avatar/00/24/b9/bd/7fef12c8.jpg","comment_is_top":false,"comment_ctime":1619147823,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1619147823","product_id":100047701,"comment_content":"ç¬¬ä¸€æ®µä»£ç è¿™ä¹ˆè§£å†³æ˜¯è¿èƒŒç¨‹åºåˆè¡·çš„ï¼š<br>public synchronized void add()<br>public synchronized void compare()<br>addå’Œcompareåˆ†åˆ«è¢«è°ƒç”¨ä¸€æ¬¡è€Œå·²ï¼ŒåŠ äº†é”å°±æ˜¯ç­‰åˆ°addæ‰§è¡Œå®Œæ‰èƒ½compareï¼Œæˆ–è€…compareå®Œæ‰èƒ½addï¼Œè¿™æ ·çš„compareé‚£ä¹ˆå¤šæ¬¡æœ‰æ„ä¹‰å—ï¼Ÿ<br>è§£å†³æ–¹æ¡ˆï¼š<br>å‡å°é”ç²’åº¦ï¼Œç”¨åŒä¸€æŠŠé”ï¼ŒæŠŠå†™æ“ä½œï¼ˆa++,b++)å’Œè¯»æ“ä½œï¼ˆa&lt;b)éƒ½é”ä¸Šï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½è¿›è¡Œè¯»æˆ–è€…å†™ã€‚<br>å¦å¤–ï¼Œä½¿ç”¨äº†æ­£ç¡®çš„synchronizedæˆ–è€…lockï¼Œå°±å¯ä»¥ä¿è¯å¯è§æ€§äº†ï¼Œæ— éœ€å†ç”¨volatile<br>","like_count":0},{"had_liked":false,"id":278184,"user_name":"å¢¨","can_delete":false,"product_type":"c1","uid":1303170,"ip_address":"","ucode":"9F78060AC2A7D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/82/71c4f16b.jpg","comment_is_top":false,"comment_ctime":1612792685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612792685","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼Œæœ€åä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæ’åºå¥½ä»¥åæˆ‘å‡ºç°ä¸¤æ¬¡item1ï¼Œitem2ï¼Œè€Œä¸”æ˜¯ä¸åŒçš„çº¿ç¨‹ï¼Œå½“æˆ‘ç¬¬ä¸€ä¸ªçº¿ç¨‹å»æ‹¿item1å’Œitem2çš„é”ï¼Œé‚£æˆ‘ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿæ˜¯éœ€è¦å»æ‹¿item1å’Œitem2çš„é”ï¼Œé‚£è¿™æ ·ç¬¬äºŒä¸ªçº¿ç¨‹èƒ½æ‹¿åˆ°item1å’Œitem2çš„é”ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":277478,"user_name":"è½å¶é£é€çš„æ‹","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1612427099,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612427099","product_id":100047701,"comment_content":"Volatileæ˜¯ä¸€ç§åŒæ­¥é”ï¼Œæ¯”synchronizedæˆ–è€…lockç›¸å…³ç±»æ›´è½»é‡ï¼Œå› ä¸ºä½¿ç”¨volatileå¹¶ä¸ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰å¼€é”€å¤§çš„è¡Œä¸ºã€‚<br>å¦‚æœä¸€ä¸ªå˜é‡è¢«ä¿®é¥°æˆvolatileï¼Œé‚£ä¹ˆJVMå°±çŸ¥é“è¿™ä¸ªå˜é‡å¯èƒ½ä¼šè¢«å¹¶å‘ä¿®æ”¹<br>ä½†æ˜¯å¼€é”€å°ï¼Œç›¸åº”çš„èƒ½åŠ›ä¹Ÿå°ï¼Œè™½ç„¶volatileæ˜¯ç”¨æ¥åŒæ­¥çš„ä¿è¯çº¿ç¨‹çš„å®‰å…¨ï¼Œä½†æ˜¯volatileåšä¸åˆ°synchronizedé‚£æ ·çš„åŸå­ä¿æŠ¤ï¼Œvolatileä»…åœ¨å¾ˆæœ‰é™çš„åœºæ™¯ä¸‹å‘æŒ¥ä½œç”¨ã€‚","like_count":0},{"had_liked":false,"id":269350,"user_name":"ä¸ç€è°ƒ...","can_delete":false,"product_type":"c1","uid":1669651,"ip_address":"","ucode":"00317809789C3F","user_header":"https://static001.geekbang.org/account/avatar/00/19/7a/13/3102cd23.jpg","comment_is_top":false,"comment_ctime":1608619557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608619557","product_id":100047701,"comment_content":"synchronizedæœ¬èº«å±äºåå‘é‡é‡çº§åˆ«çš„é”äº†ï¼Œæ¯æ¬¡éƒ½è¦å‘æ“ä½œç³»ç»Ÿå»ç”³è¯·ï¼Œ æœ€åº•å±‚åº”è¯¥ä¹Ÿæ˜¯ç”¨äº†CASï¼Œå¯èƒ½ä¼šç”¨cå’Œc++å»å®ç°ï¼ˆæ±‡ç¼–è¯­è¨€äº†ï¼‰ï¼Œjdk6ä»¥åé€šè¿‡æ ‡è®°markwordä¸å¿…åœ¨å‘æ“ä½œç³»ç»Ÿå»ç”³è¯·äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ¯”è¾ƒéš¾ç‚¹å“ˆå“ˆ","like_count":0},{"had_liked":false,"id":265902,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1607064917,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1607064917","product_id":100047701,"comment_content":"è€å¸ˆè¯·æ•™ä¸‹ï¼Œwebç¨‹åºä¸‹ï¼Œå¦‚æœæœ‰4ä¸ªapiæ¥å£ï¼š<br>Api1ï¼šæ›´æ–°è¡¨Açš„ä¸€æ¡è®°å½•a1<br>Api2ï¼šæ›´æ–°è¡¨Bçš„ä¸€æ¡è®°å½•b1<br>Api3ï¼šæ›´æ–°è¡¨Cçš„ä¸€æ¡è®°å½•c1<br>Api4ï¼šæ›´æ–°è¡¨A,B,Cçš„è®°å½•a1,b1,c1<br>å‡è®¾ç°åœ¨æœ‰4ä¸ªçº¿ç¨‹Thread1-Thread4åŒæ—¶åˆ†åˆ«è°ƒç”¨ï¼šApi1-Api4ï¼ˆå³Thread1è°ƒç”¨Api1, Thread2è°ƒç”¨Api2...)<br>ä¸ºäº†é˜²æ­¢å‡ºç°å¹¶å‘ï¼Œéœ€è¦åŠ é”å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘çš„ç†è§£åº”è¯¥æ˜¯ï¼šApi1ä¸­å¯¹è®°å½•a1åŠ é”ï¼ŒApi2ä¸­å¯¹b1åŠ é”ï¼ŒApi3ä¸­å¯¹c1åŠ é”ï¼Œè€ŒApi4ä¸­å¯¹a1,b1,c1æŒ‰é¡ºåºåŠ é”ã€‚<br>æˆ‘ç†è§£çš„å¯¹ä¹ˆï¼Œè¿™æ ·ä¹Ÿå°±è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè®¤çœŸåˆ†ææŸä¸ªapiå¯¹æ•°æ®çš„å˜æ›´æƒ…å†µï¼Œå¦‚æœapiå˜åŒ–äº†ï¼ŒåŠ é”ä¹Ÿè¦è·Ÿç€å˜ã€‚<br>è€å¸ˆï¼Œè¿˜æœ‰æ›´å¥½çš„å»ºè®®ä¹ˆã€‚å› ä¸ºæ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸é‡åˆ°æœ‰çš„åªæ”¹è®¢å•è¯¦æƒ…ï¼Œæœ‰çš„åªæ”¹è®¢å•ï¼Œæœ‰çš„æ”¹å®Œè®¢å•è¯¦æƒ…çš„åŒæ—¶è¦æ¥ç€æ”¹è®¢å•ã€‚<br>å¦å¤–ï¼Œå¯¹äºä¸€äº›æ— å…³ç´§è¦çš„æ•°æ®ä¿®æ”¹ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä¸åŠ é”ï¼Œæ¯”å¦‚ä¿®æ”¹æˆ‘åœ¨äº¬ä¸œä¸Šçš„ä¸ªäººä¿¡æ¯ï¼ˆå‡ºç°å¹¶å‘çš„æ¦‚ç‡å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰ã€‚<br>è°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":253830,"user_name":"JoJi","can_delete":false,"product_type":"c1","uid":2066986,"ip_address":"","ucode":"B88997A80E76AC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/8a/2a/f94db4dc.jpg","comment_is_top":false,"comment_ctime":1602908675,"is_pvip":false,"replies":[{"id":"92753","content":"å¤šçº¿ç¨‹æ²¡æœ‰å…±äº«çš„æ•°æ®","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1602998525,"ip_address":"","comment_id":253830,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1602908675","product_id":100047701,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆä¸‰å±‚æ¶æ„ æ²¡å¿…è¦ä½¿ç”¨syncä¿æŠ¤æ•°æ®å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507199,"discussion_content":"å¤šçº¿ç¨‹æ²¡æœ‰å…±äº«çš„æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602998525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245212,"user_name":"ç”°é—´ä¸€ç›´æŒ–","can_delete":false,"product_type":"c1","uid":1463224,"ip_address":"","ucode":"67D4B51FCD2B02","user_header":"https://static001.geekbang.org/account/avatar/00/16/53/b8/0fc8e9bb.jpg","comment_is_top":false,"comment_ctime":1598864573,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598864573","product_id":100047701,"comment_content":"å…³äºåˆ©ç”¨æ ‡å¿—ä½æ¥æ§åˆ¶çº¿ç¨‹é€€å‡ºçš„é—®é¢˜ï¼Œä¸ªäººæ„Ÿè§‰ä¸šåŠ¡åœºæ™¯ä¸æ¨èä½¿ç”¨ã€‚å°±ç®—èƒ½ä¿è¯æ ‡å¿—ä½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†åœ¨å­çº¿ç¨‹ä¸šåŠ¡ä¸­ï¼Œå¦‚æœæœ‰ç±»ä¼¼é˜»å¡é˜Ÿåˆ—ç­‰å¾…çš„æƒ…å†µï¼Œå°±ç®—ä¸»çº¿ç¨‹å°†æ ‡å¿—ä½ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šä½¿å­çº¿é€€å‡ºã€‚","like_count":0},{"had_liked":false,"id":238541,"user_name":"æå’Œæ¡ƒ","can_delete":false,"product_type":"c1","uid":1015877,"ip_address":"","ucode":"97E66953070EE0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/45/d719f7df.jpg","comment_is_top":false,"comment_ctime":1596192138,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596192138","product_id":100047701,"comment_content":"1ã€volatileå¯ä»¥ä¿è¯å¯è§æ€§ï¼Œæ­¤å¤„æœ‰ä¸ªhappens-beforeè§„åˆ™ã€‚volatileä¿®é¥°çš„å˜é‡è¢«ä¿®æ”¹äº†ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬éœ€è¦å¼ºåˆ¶è¯»ä¸»å†…å­˜ã€‚å¦‚æœæ²¡æœ‰volatileä¿®é¥°çš„å˜é‡å°±æ— æ³•åšåˆ°ä½¿å…¶ä»–çº¿ç¨‹åŠæ—¶å¯è§ï¼Œå¯¼è‡´å‡ºç°é—®é¢˜ã€‚<br>2ã€é”è¶…æ—¶é‡Šæ”¾ä¸€èˆ¬é‡‡ç”¨é”ç»­æœŸçš„æ–¹å¼è§£å†³ã€‚æ–¹æ³•å°½é‡ä¿è¯å¹‚ç­‰ã€‚","like_count":0},{"had_liked":false,"id":234875,"user_name":"ç‚å‘ç¼çœ¼","can_delete":false,"product_type":"c1","uid":1425953,"ip_address":"","ucode":"7D195057C8E94C","user_header":"https://static001.geekbang.org/account/avatar/00/15/c2/21/a8ef82ac.jpg","comment_is_top":false,"comment_ctime":1594816791,"is_pvip":false,"replies":[{"id":"86910","content":"å¼•ç”¨çŸ¥ä¹çš„å›å¤<br><br><br><br>volatileå’ŒMESIå·®ç€å¥½å‡ å±‚æŠ½è±¡ï¼Œä¸­é—´ä¼šç»å†javaç¼–è¯‘å™¨ï¼Œjavaè™šæ‹Ÿæœºå’ŒJITï¼Œæ“ä½œç³»ç»Ÿï¼ŒCPUæ ¸å¿ƒã€‚volatileåœ¨Javaä¸­çš„æ„å›¾æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¿…é¡»ä¿è¯1ï¼‰ç¼–è¯‘å™¨ä¸èƒ½ä¹±åºä¼˜åŒ–ï¼›2ï¼‰æŒ‡ä»¤æ‰§è¡Œåœ¨CPUä¸Šè¦ä¿è¯è¯»å†™çš„fenceã€‚å¯¹äºx86çš„ä½“ç³»ç»“æ„ï¼Œvoltileå˜é‡çš„è®¿é—®ä»£ç ä¼šè¢«javaç¼–è¯‘å™¨ç”Ÿæˆä¸ä¹±åºçš„ï¼Œå¸¦æœ‰lockæŒ‡ä»¤å‰ç¼€çš„æœºå™¨ç ã€‚è€Œlockçš„å®ç°è¿˜è¦åŒºåˆ†ï¼Œè¿™ä¸ªæ•°æ®åœ¨ä¸åœ¨CPUæ ¸å¿ƒçš„ä¸“æœ‰ç¼“å­˜ä¸­ï¼ˆä¸€èˆ¬æ˜¯æŒ‡L1&#47;L2ï¼‰ã€‚å¦‚æœåœ¨ï¼ŒMESIæ‰æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœä¸æ»¡è¶³å°±ä¼šè¦ç”¨å…¶ä»–æ‰‹æ®µã€‚è€Œè¿™äº›æ‰‹æ®µæ˜¯è™šæ‹Ÿæœºå¼€å‘è€…ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿå¼€å‘è€…éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒCPUé‡Œçš„ç¼“å­˜ï¼Œbufferï¼Œqueueæœ‰å¾ˆå¤šç§ã€‚MESIåªèƒ½åœ¨ä¸€ç§æƒ…å†µä¸‹è§£å†³æ ¸å¿ƒä¸“æœ‰Cacheä¹‹é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œå¦‚æœæœ‰äº›CPUä¸æ”¯æŒMESIåè®®ï¼Œé‚£ä¹ˆå¿…é¡»ç”¨å…¶ä»–åŠæ³•æ¥å®ç°ç­‰ä»·çš„æ•ˆæœï¼Œæ¯”å¦‚æ€»æ˜¯ç”¨é”æ€»çº¿çš„æ–¹å¼ï¼Œæˆ–è€…æ˜ç¡®çš„fenceæŒ‡ä»¤æ¥ä¿è¯volatileæƒ³è¾¾åˆ°çš„ç›®æ ‡ã€‚å¦‚æœCPUæ˜¯å•æ ¸å¿ƒçš„ï¼Œcacheæ˜¯ä¸“ä¾›è¿™ä¸ªæ ¸å¿ƒçš„ï¼ŒMESIç†è®ºä¸Šä¹Ÿå°±æ²¡æœ‰ç”¨äº†ã€‚ä½†æ˜¯ä¾ç„¶è¦è€ƒè™‘ä¸»å­˜å’ŒCacheè¢«å¤šä¸ªçº¿ç¨‹åˆ‡æ¢è®¿é—®æ—¶å¸¦æ¥çš„ä¸ä¸€è‡´é—®é¢˜ã€‚æ€»ä¹‹ï¼Œvolatileæ˜¯ä¸€ä¸ªé«˜å±‚çš„è¡¨è¾¾æ„å›¾çš„â€œæŠ½è±¡â€ï¼Œè€ŒMESIæ˜¯ä¸ºäº†å®ç°è¿™ä¸ªæŠ½è±¡ï¼Œåœ¨æŸç§ç‰¹å®šæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚ä½ å¯ä»¥æŠŠJSR-133çœ‹ä½œæ˜¯ä¸€å¥—UTçš„è§„èŒƒã€‚ä¸ç®¡åº•ä¸‹CPU&#47;ç¼–è¯‘å™¨æ€ä¹ˆæŠ˜è…¾ï¼Œåªè¦voltileä¿®é¥°çš„å˜é‡æ»¡è¶³JSR-133æ‰€æè¿°çš„æ‰€æœ‰åœºæ™¯ï¼Œå°±ç®—æ˜¯ä¸€ä¸ªå¥½çš„javaå®ç°ã€‚è€ŒåŸºäºè¿™ä¸ªè§„èŒƒï¼Œjavaå¼€å‘äººå‘˜æ‰èƒ½å®‰å¿ƒçš„å¼€å‘å¹¶å‘ä»£ç ï¼Œè€Œä¸è‡³äºè¢«åº•å±‚ç»†èŠ‚æç–¯ã€‚<br><br>ä½œè€…ï¼šå¤§å®½å®½<br>é“¾æ¥ï¼šhttps:&#47;&#47;www.zhihu.com&#47;question&#47;296949412&#47;answer&#47;760347883<br>æ¥æºï¼šçŸ¥ä¹<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1594968937,"ip_address":"","comment_id":234875,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594816791","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå¯¹äºé—®é¢˜1ï¼Œå¦‚æœæŠ›å¼€æŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ï¼Œåªæ˜¯æ›´æ–°å˜é‡æ¥é€€å‡ºå¾ªç¯çš„è¯ï¼ŒMESIåè®®å°±å·²ç»å¯ä»¥ä¿è¯ä¸€è‡´æ€§äº†ï¼Œé€€å‡ºå¾ªç¯åº”è¯¥æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„å§ï¼Œæœ›è§£é‡Šã€‚","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501534,"discussion_content":"å¼•ç”¨çŸ¥ä¹çš„å›å¤\n\n\n\nvolatileå’ŒMESIå·®ç€å¥½å‡ å±‚æŠ½è±¡ï¼Œä¸­é—´ä¼šç»å†javaç¼–è¯‘å™¨ï¼Œjavaè™šæ‹Ÿæœºå’ŒJITï¼Œæ“ä½œç³»ç»Ÿï¼ŒCPUæ ¸å¿ƒã€‚volatileåœ¨Javaä¸­çš„æ„å›¾æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¿…é¡»ä¿è¯1ï¼‰ç¼–è¯‘å™¨ä¸èƒ½ä¹±åºä¼˜åŒ–ï¼›2ï¼‰æŒ‡ä»¤æ‰§è¡Œåœ¨CPUä¸Šè¦ä¿è¯è¯»å†™çš„fenceã€‚å¯¹äºx86çš„ä½“ç³»ç»“æ„ï¼Œvoltileå˜é‡çš„è®¿é—®ä»£ç ä¼šè¢«javaç¼–è¯‘å™¨ç”Ÿæˆä¸ä¹±åºçš„ï¼Œå¸¦æœ‰lockæŒ‡ä»¤å‰ç¼€çš„æœºå™¨ç ã€‚è€Œlockçš„å®ç°è¿˜è¦åŒºåˆ†ï¼Œè¿™ä¸ªæ•°æ®åœ¨ä¸åœ¨CPUæ ¸å¿ƒçš„ä¸“æœ‰ç¼“å­˜ä¸­ï¼ˆä¸€èˆ¬æ˜¯æŒ‡L1/L2ï¼‰ã€‚å¦‚æœåœ¨ï¼ŒMESIæ‰æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœä¸æ»¡è¶³å°±ä¼šè¦ç”¨å…¶ä»–æ‰‹æ®µã€‚è€Œè¿™äº›æ‰‹æ®µæ˜¯è™šæ‹Ÿæœºå¼€å‘è€…ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿå¼€å‘è€…éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒCPUé‡Œçš„ç¼“å­˜ï¼Œbufferï¼Œqueueæœ‰å¾ˆå¤šç§ã€‚MESIåªèƒ½åœ¨ä¸€ç§æƒ…å†µä¸‹è§£å†³æ ¸å¿ƒä¸“æœ‰Cacheä¹‹é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œå¦‚æœæœ‰äº›CPUä¸æ”¯æŒMESIåè®®ï¼Œé‚£ä¹ˆå¿…é¡»ç”¨å…¶ä»–åŠæ³•æ¥å®ç°ç­‰ä»·çš„æ•ˆæœï¼Œæ¯”å¦‚æ€»æ˜¯ç”¨é”æ€»çº¿çš„æ–¹å¼ï¼Œæˆ–è€…æ˜ç¡®çš„fenceæŒ‡ä»¤æ¥ä¿è¯volatileæƒ³è¾¾åˆ°çš„ç›®æ ‡ã€‚å¦‚æœCPUæ˜¯å•æ ¸å¿ƒçš„ï¼Œcacheæ˜¯ä¸“ä¾›è¿™ä¸ªæ ¸å¿ƒçš„ï¼ŒMESIç†è®ºä¸Šä¹Ÿå°±æ²¡æœ‰ç”¨äº†ã€‚ä½†æ˜¯ä¾ç„¶è¦è€ƒè™‘ä¸»å­˜å’ŒCacheè¢«å¤šä¸ªçº¿ç¨‹åˆ‡æ¢è®¿é—®æ—¶å¸¦æ¥çš„ä¸ä¸€è‡´é—®é¢˜ã€‚æ€»ä¹‹ï¼Œvolatileæ˜¯ä¸€ä¸ªé«˜å±‚çš„è¡¨è¾¾æ„å›¾çš„â€œæŠ½è±¡â€ï¼Œè€ŒMESIæ˜¯ä¸ºäº†å®ç°è¿™ä¸ªæŠ½è±¡ï¼Œåœ¨æŸç§ç‰¹å®šæƒ…å†µä¸‹éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚ä½ å¯ä»¥æŠŠJSR-133çœ‹ä½œæ˜¯ä¸€å¥—UTçš„è§„èŒƒã€‚ä¸ç®¡åº•ä¸‹CPU/ç¼–è¯‘å™¨æ€ä¹ˆæŠ˜è…¾ï¼Œåªè¦voltileä¿®é¥°çš„å˜é‡æ»¡è¶³JSR-133æ‰€æè¿°çš„æ‰€æœ‰åœºæ™¯ï¼Œå°±ç®—æ˜¯ä¸€ä¸ªå¥½çš„javaå®ç°ã€‚è€ŒåŸºäºè¿™ä¸ªè§„èŒƒï¼Œjavaå¼€å‘äººå‘˜æ‰èƒ½å®‰å¿ƒçš„å¼€å‘å¹¶å‘ä»£ç ï¼Œè€Œä¸è‡³äºè¢«åº•å±‚ç»†èŠ‚æç–¯ã€‚\n\nä½œè€…ï¼šå¤§å®½å®½\né“¾æ¥ï¼šhttps://www.zhihu.com/question/296949412/answer/760347883\næ¥æºï¼šçŸ¥ä¹\nè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594968937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228121,"user_name":"é˜¿æ–¯è’‚èŠ¬","can_delete":false,"product_type":"c1","uid":1024164,"ip_address":"","ucode":"61D5E3BDA4EBC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","comment_is_top":false,"comment_ctime":1592560653,"is_pvip":false,"replies":[{"id":"84125","content":"https:&#47;&#47;www.cnblogs.com&#47;lovecindywang&#47;p&#47;11216570.html","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1592572454,"ip_address":"","comment_id":228121,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592560653","product_id":100047701,"comment_content":"æ‹¿ç¬¬ä¸€è®²çš„ä¾‹å­ï¼Œåˆ†åˆ«ç”¨ReentrantReadWriteLock å’Œ StampedLock è¯•äº†ä¸‹ï¼ŒStampedLock çš„æ•ˆç‡ç¡®å®è¦é«˜ä¸å°‘ï¼Œç‰¹åˆ«æ˜¯åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚æŸ¥èµ„æ–™å¾—çŸ¥StampedLockç®—æ˜¯ä¹è§‚é”çš„å®ç°ï¼Œè€ŒReentrantReadWriteLockæ˜¯æ‚²è§‚é”çš„æ€æƒ³ã€‚å¦å¤–æœ‰ä¸ªç–‘é—®ï¼ŒReentrantReadLockï¼Œåœ¨é«˜å¹¶å‘è¯»çš„æ¡ä»¶ä¸‹ï¼Œå‘ç°ç«Ÿç„¶æ¯”Synchronizedçš„æ•ˆç‡è¿˜è¦ä½ï¼Œåœ¨æˆ‘çš„æœºå™¨ä¸Šæ¥è¿‘3å€çš„å·®è·ï¼Œè™½è¯´synchronizedæœ‰ä¼˜åŒ–è¿‡ï¼Œä½†æ˜¯è¿™ä¸ªå·®è·ç¡®å®ä¹Ÿæœ‰äº›ç–‘æƒ‘ï¼Œä¸çŸ¥æ˜¯å¦æ­£å¸¸ã€‚","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498927,"discussion_content":"https://www.cnblogs.com/lovecindywang/p/11216570.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592572454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221653,"user_name":"MrCreep","can_delete":false,"product_type":"c1","uid":1026641,"ip_address":"","ucode":"E5F481B82BE3E9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/FIP7jdV0a9XzhP0ezpmDs5gCOCcIBicfYnIo9WiczG2WsmxBkvicv6ZDEOVPDHjsa5pnPzIonjYo4YYficK4WdwiaHg/132","comment_is_top":false,"comment_ctime":1590559462,"is_pvip":false,"replies":[{"id":"81730","content":"å…¶å®æ–‡ä¸­å·²æœ‰è§£é‡Šã€ä¹‹æ‰€ä»¥å‡ºç°è¿™ç§é”™ä¹±ï¼Œæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹æ˜¯äº¤é”™æ‰§è¡Œaddå’Œcompareæ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”è¿™äº›ä¸šåŠ¡é€»è¾‘ä¸æ˜¯åŸå­æ€§çš„ï¼ša++å’Œb++æ“ä½œä¸­å¯ä»¥ç©¿æ’åœ¨compareæ–¹æ³•çš„æ¯”è¾ƒä»£ç ä¸­ï¼›æ›´éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œa&lt;bè¿™ç§æ¯”è¾ƒæ“ä½œåœ¨å­—èŠ‚ç å±‚é¢æ˜¯åŠ è½½aã€åŠ è½½bå’Œæ¯”è¾ƒä¸‰æ­¥ï¼Œä»£ç è™½ç„¶æ˜¯ä¸€è¡Œä½†ä¹Ÿä¸æ˜¯åŸå­æ€§çš„ã€‚ã€<br>b-a&gt;1çš„æƒ…å†µæ˜¯å› ä¸ºï¼Œæ—¥å¿—è¾“å‡ºå–å€¼aä¹‹åï¼Œaddæ–¹æ³•å¯èƒ½è·‘äº†å¤šæ¬¡äº†ã€‚<br><br>æˆ‘è®¤ä¸ºå•å•åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynconizedçš„ä¼šå¯¼è‡´ç¨‹åºæœºå™¨ç¼“æ…¢ï¼Œä¸”æ²¡æœ‰èµ·åˆ°è¾¹åŠ è¾¹æ¯”çš„ç›®çš„ã€‚ã€‹ã€‹ æ˜¯çš„ï¼Œæˆ‘è¿™ç§è§£å†³æ–¹æ¡ˆæ˜¯ç›¸å¯¹äºå•ä¸ªæ–¹æ³•åŠ é”çš„æ–¹æ¡ˆï¼Œç²’åº¦ç²—ä¸€ç‚¹<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1590563785,"ip_address":"","comment_id":221653,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590559462","product_id":100047701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…³äºç¬¬ä¸€ä¸ªä¾‹å­<br><br>æˆ‘çœ‹è€å¸ˆæ˜¯å¯äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªadd()ï¼Œä¸€ä¸ªcompare()<br><br>Interesting interesting = new Interesting();<br>new Thread(() -&gt; interesting.add()).start();<br>new Thread(() -&gt; interesting.compare()).start();<br><br>ä¸è¿‡æœ€åè¾“å‡ºçš„æ—¥å¿—è®©æˆ‘å¾ˆç–‘æƒ‘ï¼Œ<br>addæ–¹æ³•å®é™…ä¸Šæ˜¯å•çº¿ç¨‹åœ¨è·‘ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰aï¼Œbçš„ç»å¯¹å€¼å·®å¤§äº1çš„æƒ…å†µï¼Ÿ<br><br>ä¸ºä»€ä¹ˆä¼šæœ‰bå¤§äºaçš„æƒ…å†µï¼Ÿæˆ‘çš„ç†è§£é‡Œå› ä¸ºa,béƒ½å£°æ˜äº†volatileï¼Œåº”è¯¥ä¸å­˜åœ¨a,båœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹åï¼Œbçš„å€¼åŒæ­¥åˆ°äº†ä¸»çº¿ç¨‹è€Œaæ²¡æœ‰ï¼Œä»è€Œåœ¨è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ä¹‹åï¼Œå‡ºç°bæ¯”aå¤§çš„æƒ…å†µã€‚<br><br>æˆ‘è®¤ä¸ºå•å•åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynconizedçš„ä¼šå¯¼è‡´ç¨‹åºæœºå™¨ç¼“æ…¢ï¼Œä¸”æ²¡æœ‰èµ·åˆ°è¾¹åŠ è¾¹æ¯”çš„ç›®çš„ã€‚<br>åº”è¯¥é”åœ¨<br>synchronized (locker) { a++; b++ }<br>synchronized (locker) { if (a&gt;b)....}","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496524,"discussion_content":"å…¶å®æ–‡ä¸­å·²æœ‰è§£é‡Šã€ä¹‹æ‰€ä»¥å‡ºç°è¿™ç§é”™ä¹±ï¼Œæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹æ˜¯äº¤é”™æ‰§è¡Œaddå’Œcompareæ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”è¿™äº›ä¸šåŠ¡é€»è¾‘ä¸æ˜¯åŸå­æ€§çš„ï¼ša++å’Œb++æ“ä½œä¸­å¯ä»¥ç©¿æ’åœ¨compareæ–¹æ³•çš„æ¯”è¾ƒä»£ç ä¸­ï¼›æ›´éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œa&amp;lt;bè¿™ç§æ¯”è¾ƒæ“ä½œåœ¨å­—èŠ‚ç å±‚é¢æ˜¯åŠ è½½aã€åŠ è½½bå’Œæ¯”è¾ƒä¸‰æ­¥ï¼Œä»£ç è™½ç„¶æ˜¯ä¸€è¡Œä½†ä¹Ÿä¸æ˜¯åŸå­æ€§çš„ã€‚ã€\nb-a&amp;gt;1çš„æƒ…å†µæ˜¯å› ä¸ºï¼Œæ—¥å¿—è¾“å‡ºå–å€¼aä¹‹åï¼Œaddæ–¹æ³•å¯èƒ½è·‘äº†å¤šæ¬¡äº†ã€‚\n\næˆ‘è®¤ä¸ºå•å•åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynconizedçš„ä¼šå¯¼è‡´ç¨‹åºæœºå™¨ç¼“æ…¢ï¼Œä¸”æ²¡æœ‰èµ·åˆ°è¾¹åŠ è¾¹æ¯”çš„ç›®çš„ã€‚ã€‹ã€‹ æ˜¯çš„ï¼Œæˆ‘è¿™ç§è§£å†³æ–¹æ¡ˆæ˜¯ç›¸å¯¹äºå•ä¸ªæ–¹æ³•åŠ é”çš„æ–¹æ¡ˆï¼Œç²’åº¦ç²—ä¸€ç‚¹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590563785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220114,"user_name":"è’å·ä¹‹ä¸»","can_delete":false,"product_type":"c1","uid":2000330,"ip_address":"","ucode":"12724B4B37BEB5","user_header":"https://static001.geekbang.org/account/avatar/00/1e/85/ca/e6003d08.jpg","comment_is_top":false,"comment_ctime":1590159721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590159721","product_id":100047701,"comment_content":"java8è™½ç„¶å­¦äº†ï¼Œä½†æ˜¯å¹³æ—¶å†™ä¸šåŠ¡ä»£ç éƒ½æ²¡ç”¨è¿‡ï¼Œä»Šåè¦ä¸»åŠ¨è¿ç”¨","like_count":0},{"had_liked":false,"id":219344,"user_name":"å²³å®œæ³¢","can_delete":false,"product_type":"c1","uid":1975581,"ip_address":"","ucode":"5043CA250FDCB1","user_header":"http://thirdwx.qlogo.cn/mmopen/2kpMNDYsSfCnhAYmvAsNcYKyNLUJG5iax9BKgXAJzxypEJGRVwhibjZ53S5icgEDibn8uqrqwsKcxzEXfRRUXTdqjA/132","comment_is_top":false,"comment_ctime":1589992767,"is_pvip":false,"replies":[{"id":"81028","content":"å¯ä»¥ä½¿ç”¨ä¹è§‚é” ç‰ˆæœ¬å·ä¸å¯¹ æ›´æ–°æ“ä½œä¼šå¤±è´¥ å›æ»šäº‹åŠ¡é‡è¯•å½“å‰æ“ä½œå³å¯ å»ºè®®æœ€å¤šé‡è¯•ä¸¤æ¬¡ å†ä¸è¡Œç›´æ¥ä¸‹å•å¤±è´¥ ç”±ç”¨æˆ·è¿›è¡Œé‡è¯•","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1590020424,"ip_address":"","comment_id":219344,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589992767","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå¹¶å‘é‡æ²¡é‚£ä¹ˆå¤§çš„æƒ…å†µä¸‹ï¼Œä¸‹å•æ‰£å‡åº“å­˜æ˜¯ä¸æ˜¯é€‰æ‹©ä½¿ç”¨versionä¹è§‚é”æœºåˆ¶å‘¢ï¼Œä½¿ç”¨ä¹è§‚é”å¦‚æœæ›´æ–°å¤±è´¥åº”è¯¥æ€ä¹ˆè®¾è®¡é‡è¯•ç­–ç•¥ï¼Œé¿å…ä¹è§‚é”å¼‚å¸¸é€ æˆå¶å°”ä¸‹å•å¤±è´¥çš„æƒ…å†µå‘¢","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495774,"discussion_content":"å¯ä»¥ä½¿ç”¨ä¹è§‚é” ç‰ˆæœ¬å·ä¸å¯¹ æ›´æ–°æ“ä½œä¼šå¤±è´¥ å›æ»šäº‹åŠ¡é‡è¯•å½“å‰æ“ä½œå³å¯ å»ºè®®æœ€å¤šé‡è¯•ä¸¤æ¬¡ å†ä¸è¡Œç›´æ¥ä¸‹å•å¤±è´¥ ç”±ç”¨æˆ·è¿›è¡Œé‡è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590020424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205165,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1586562581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586562581","product_id":100047701,"comment_content":"æœŸå¾…è€å¸ˆè¯´ä¸€è¯´åˆ†å¸ƒå¼é”çš„å‘ï¼Œè°¢è°¢è€å¸ˆã€‚","like_count":0},{"had_liked":false,"id":199243,"user_name":"æ°å“¥é•¿å¾—å¸…","can_delete":false,"product_type":"c1","uid":1241993,"ip_address":"","ucode":"5A7FD1794F62D7","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/89/fcfecb46.jpg","comment_is_top":false,"comment_ctime":1585484088,"is_pvip":false,"replies":[{"id":"74781","content":"å› ä¸ºaå–å€¼ä¹‹åbå–å€¼ä¹‹å‰å¯èƒ½addæ–¹æ³•å·²ç»æ‰§è¡Œå¤šæ¬¡äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585529239,"ip_address":"","comment_id":199243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585484088","product_id":100047701,"comment_content":"æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œç¬¬ä¸€æ®µä»£ç aå’Œbçš„å·®è·ï¼Œä¸ºä»€ä¹ˆèƒ½å¤§äº1","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489808,"discussion_content":"å› ä¸ºaå–å€¼ä¹‹åbå–å€¼ä¹‹å‰å¯èƒ½addæ–¹æ³•å·²ç»æ‰§è¡Œå¤šæ¬¡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585529239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198242,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1585432342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585432342","product_id":100047701,"comment_content":"å¸Œæœ›è€å¸ˆå¤šè®²è®²åˆ†å¸ƒå¼é”","like_count":0},{"had_liked":false,"id":191607,"user_name":"å¤©ä½¿æ¢¦æ³ª","can_delete":false,"product_type":"c1","uid":1235750,"ip_address":"","ucode":"782991747DD424","user_header":"https://static001.geekbang.org/account/avatar/00/12/db/26/3c8d68fb.jpg","comment_is_top":false,"comment_ctime":1584784511,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584784511","product_id":100047701,"comment_content":"é‚£ä¸ªè¾“å‡ºçš„å€¼ï¼Œæœ‰å¯èƒ½ä¼šæ¯”100 ä¸‡æ¬¡å¤§å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2305546,"avatar":"","nickname":"0xCAFEBABE","note":"","ucode":"D68D1C39E87596","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328821,"discussion_content":"åº”è¯¥ä¸å¯èƒ½ã€‚counter++æ“ä½œå…¶å®è¢«åˆ†æˆä¸‰æ­¥ï¼š\n1.è¯»å–countçš„å€¼ï¼›\n2.å¯¹countæ‰§è¡Œ+1ï¼›\n3.å°†2çš„è®¡ç®—ç»“æœé‡æ–°èµ‹å€¼ç»™countï¼›\nå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹Aã€Bï¼ŒAçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œç¬¬3æ­¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æŠŠå€¼å†™å…¥ä¸»å†…å­˜ï¼Œæ­¤æ—¶Bçº¿ç¨‹åˆšå¥½æ‰§è¡Œç¬¬1æ­¥ï¼Œä»ä¸»å†…å­˜è¯»å–countçš„å€¼åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œä½†æ˜¯è¯»å‡ºæ¥çš„å€¼ä¸æ˜¯æœ€æ–°çš„å€¼ï¼ˆå› ä¸ºAè¿˜æ²¡æœ‰æŠŠç»“æœå†™å…¥åˆ°ä¸»å†…å­˜ï¼‰ã€‚å› æ­¤ç»“æœå¿…ç„¶å°äº100ä¸‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606232630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191339,"user_name":"ä¸ä¹æ´ª","can_delete":false,"product_type":"c1","uid":1264392,"ip_address":"","ucode":"549CE57AB20B49","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg","comment_is_top":false,"comment_ctime":1584764589,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584764589","product_id":100047701,"comment_content":"è¦ç­‰ç ”ç©¶åå†çœ‹ä¸“æ ï¼Œä¸èƒ½æ€¥ã€‚","like_count":0}]}