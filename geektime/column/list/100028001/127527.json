{"id":127527,"title":"42 | ç”µå•†ç³»ç»Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡è°ƒä¼˜","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜è¶…ã€‚</p><p>ä»Šå¤©çš„åˆ†äº«ä¹Ÿæ˜¯ä»æ¡ˆä¾‹å¼€å§‹ã€‚æˆ‘ä»¬å›¢é˜Ÿæ›¾ç»é‡åˆ°è¿‡ä¸€ä¸ªéå¸¸ä¸¥é‡çš„çº¿ä¸Šäº‹æ•…ï¼Œåœ¨ä¸€æ¬¡DBAå®Œæˆå•å°æ•°æ®åº“çº¿ä¸Šè¡¥ä¸åï¼Œç³»ç»Ÿå¶å°”ä¼šå‡ºç°å¼‚å¸¸æŠ¥è­¦ï¼Œæˆ‘ä»¬çš„å¼€å‘å·¥ç¨‹å¸ˆå¾ˆå¿«å°±å®šä½åˆ°äº†æ•°æ®åº“å¼‚å¸¸é—®é¢˜ã€‚</p><p>å…·ä½“æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œå½“ç©å®¶è´­ä¹°é“å…·ä¹‹åï¼Œæ‰£é™¤é€šå®æ—¶å‡ºç°äº†å¼‚å¸¸ã€‚è¿™ç§å¼‚å¸¸åœ¨æ­£å¸¸æƒ…å†µä¸‹å‘ç”Ÿä¹‹åï¼Œåº”è¯¥æ˜¯æ•´ä¸ªè´­ä¹°æ“ä½œéƒ½éœ€è¦æ’¤é”€ï¼Œç„¶è€Œè¿™æ¬¡å¼‚å¸¸çš„ä¸¥é‡æ€§å°±æ˜¯åœ¨äºç©å®¶è´­ä¹°é“å…·æˆåŠŸåï¼Œæ²¡æœ‰æ‰£é™¤é€šå®ã€‚</p><p>ç©¶å…¶åŸå› æ˜¯ç”±äºè´­ä¹°çš„é“å…·æ›´æ–°çš„æ˜¯æ¸¸æˆæ•°æ®åº“ï¼Œè€Œé€šå®æ˜¯åœ¨ç”¨æˆ·è´¦æˆ·ä¸­å¿ƒæ•°æ®åº“ï¼Œåœ¨ä¸€æ¬¡è´­ä¹°é“å…·æ—¶ï¼Œå­˜åœ¨åŒæ—¶æ“ä½œä¸¤ä¸ªæ•°æ®åº“çš„æƒ…å†µï¼Œå±äºä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡ã€‚è€Œæˆ‘ä»¬çš„å·¥ç¨‹å¸ˆåœ¨å®Œæˆç©å®¶è·å¾—é“å…·å’Œæ‰£é™¤ä½™é¢çš„æ“ä½œæ—¶ï¼Œæ²¡æœ‰åšåˆ°äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå³åœ¨æ‰£é™¤é€šå®å¤±è´¥æ—¶ï¼Œåº”è¯¥å›æ»šå·²ç»è´­ä¹°çš„æ¸¸æˆé“å…·ã€‚</p><p><strong>ä»è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘æƒ³ä½ åº”è¯¥æ„è¯†åˆ°äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„é‡è¦æ€§ã€‚</strong></p><p>å¦‚ä»Šï¼Œå¤§éƒ¨åˆ†å…¬å¸çš„æœåŠ¡åŸºæœ¬éƒ½å®ç°äº†å¾®æœåŠ¡åŒ–ï¼Œé¦–å…ˆæ˜¯ä¸šåŠ¡éœ€æ±‚ï¼Œä¸ºäº†è§£è€¦ä¸šåŠ¡ï¼›å…¶æ¬¡æ˜¯ä¸ºäº†å‡å°‘ä¸šåŠ¡ä¸ä¸šåŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ã€‚</p><p>ç”µå•†ç³»ç»Ÿäº¦æ˜¯å¦‚æ­¤ï¼Œå¤§éƒ¨åˆ†å…¬å¸çš„ç”µå•†ç³»ç»Ÿéƒ½æ˜¯åˆ†ä¸ºäº†ä¸åŒæœåŠ¡æ¨¡å—ï¼Œä¾‹å¦‚å•†å“æ¨¡å—ã€è®¢å•æ¨¡å—ã€åº“å­˜æ¨¡å—ç­‰ç­‰ã€‚äº‹å®ä¸Šï¼Œåˆ†è§£æœåŠ¡æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œå¯ä»¥å¸¦æ¥ä¸€äº›å¼€å‘ã€æ€§èƒ½ä»¥åŠè¿ç»´ä¸Šçš„ä¼˜åŠ¿ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ ä¸šåŠ¡å¼€å‘çš„é€»è¾‘å¤æ‚åº¦ã€‚å…¶ä¸­æœ€ä¸ºçªå‡ºçš„å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p><!-- [[[read_end]]] --><p>é€šå¸¸ï¼Œå­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æœåŠ¡æ¶æ„éƒ¨ç½²æœ‰ä»¥ä¸‹ä¸¤ç§ï¼šåŒæœåŠ¡ä¸åŒæ•°æ®åº“ï¼Œä¸åŒæœåŠ¡ä¸åŒæ•°æ®åº“ã€‚æˆ‘ä»¬ä»¥å•†åŸä¸ºä¾‹ï¼Œç”¨å›¾ç¤ºè¯´æ˜ä¸‹è¿™ä¸¤ç§éƒ¨ç½²ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/11/5a/111f44892deb9919a1310d636a538f5a.jpg?wh=992*752\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/48/6c/48d448543aeac5eba4b9edd24e1bcf6c.jpg?wh=1038*1029\" alt=\"\"></p><p>é€šå¸¸ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäºç¬¬äºŒç§æ¶æ„éƒ¨ç½²å®ç°çš„ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°åœ¨è¿™ç§æœåŠ¡æ¶æ„ä¸‹ï¼Œæœ‰å…³è®¢å•æäº¤ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿ</p><h2>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ä»¬è®²è¿‡ï¼Œåœ¨å•ä¸ªæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œæ•°æ®äº‹åŠ¡æ“ä½œå…·æœ‰ACIDå››ä¸ªç‰¹æ€§ï¼Œä½†å¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ“ä½œå¤šä¸ªæ•°æ®åº“ï¼Œåˆ™æ— æ³•ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ¥ä¿è¯ä¸€è‡´æ€§ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸¤ä¸ªæ•°æ®åº“æ“ä½œæ•°æ®æ—¶ï¼Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªæ•°æ®åº“æ“ä½œæˆåŠŸï¼Œè€Œå¦ä¸€ä¸ªæ•°æ®åº“æ“ä½œå¤±è´¥çš„æƒ…å†µï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡å•ä¸ªæ•°æ®åº“äº‹åŠ¡æ¥å›æ»šä¸¤ä¸ªæ•°æ®æ“ä½œã€‚</p><p>è€Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†è§£å†³åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸‹ï¼Œä¸åŒèŠ‚ç‚¹çš„æ•°æ®åº“æ“ä½œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚åœ¨ä¸€ä¸ªäº‹åŠ¡æ“ä½œè¯·æ±‚å¤šä¸ªæœåŠ¡æˆ–å¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹æ—¶ï¼Œè¦ä¹ˆæ‰€æœ‰è¯·æ±‚æˆåŠŸï¼Œè¦ä¹ˆæ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥å›æ»šå›å»ã€‚é€šå¸¸ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æœ‰å¤šç§æ–¹å¼ï¼Œä¾‹å¦‚XAåè®®å®ç°çš„äºŒé˜¶æäº¤ï¼ˆ2PCï¼‰ã€ä¸‰é˜¶æäº¤(3PC)ï¼Œä»¥åŠTCCè¡¥å¿æ€§äº‹åŠ¡ã€‚</p><p>åœ¨äº†è§£2PCå’Œ3PCä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å…ˆæ¥äº†è§£ä¸‹XAåè®®ã€‚XAåè®®æ˜¯ç”±X/Openç»„ç»‡æå‡ºçš„ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†è§„èŒƒï¼Œç›®å‰MySQLä¸­åªæœ‰InnoDBå­˜å‚¨å¼•æ“æ”¯æŒXAåè®®ã€‚</p><h3>1. XAè§„èŒƒ</h3><p>åœ¨XAè§„èŒƒä¹‹å‰ï¼Œå­˜åœ¨ç€ä¸€ä¸ªDTPæ¨¡å‹ï¼Œè¯¥æ¨¡å‹è§„èŒƒäº†åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¨¡å‹è®¾è®¡ã€‚</p><p>DTPè§„èŒƒä¸­ä¸»è¦åŒ…å«äº†APã€RMã€TMä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­APæ˜¯åº”ç”¨ç¨‹åºï¼Œæ˜¯äº‹åŠ¡å‘èµ·å’Œç»“æŸçš„åœ°æ–¹ï¼›RMæ˜¯èµ„æºç®¡ç†å™¨ï¼Œä¸»è¦è´Ÿè´£ç®¡ç†æ¯ä¸ªæ•°æ®åº“çš„è¿æ¥æ•°æ®æºï¼›TMæ˜¯äº‹åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£äº‹åŠ¡çš„å…¨å±€ç®¡ç†ï¼ŒåŒ…æ‹¬äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œèµ„æºçš„åˆ†é…åè°ƒç­‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/67/dcbb483b62b1e0a51d03c7edfcf89767.jpg?wh=1086*676\" alt=\"\"></p><p>XAåˆ™è§„èŒƒäº†TMä¸RMä¹‹é—´çš„é€šä¿¡æ¥å£ï¼Œåœ¨TMä¸å¤šä¸ªRMä¹‹é—´å½¢æˆä¸€ä¸ªåŒå‘é€šä¿¡æ¡¥æ¢ï¼Œä»è€Œåœ¨å¤šä¸ªæ•°æ®åº“èµ„æºä¸‹ä¿è¯ACIDå››ä¸ªç‰¹æ€§ã€‚</p><p>è¿™é‡Œå¼ºè°ƒä¸€ä¸‹ï¼ŒJTAæ˜¯åŸºäºXAè§„èŒƒå®ç°çš„ä¸€å¥—Javaäº‹åŠ¡ç¼–ç¨‹æ¥å£ï¼Œæ˜¯ä¸€ç§ä¸¤é˜¶æ®µæäº¤äº‹åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<a href=\"https://github.com/nickliuchao/jta\">æºç </a>ç®€å•äº†è§£ä¸‹JTAå®ç°çš„å¤šæ•°æ®æºäº‹åŠ¡æäº¤ã€‚</p><h3>2. äºŒé˜¶æäº¤å’Œä¸‰é˜¶æäº¤</h3><p>XAè§„èŒƒå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡å±äºäºŒé˜¶æäº¤äº‹åŠ¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯é€šè¿‡ä¸¤ä¸ªé˜¶æ®µæ¥å®ç°äº‹åŠ¡çš„æäº¤ã€‚</p><p>åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºå‘äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰å‘èµ·äº‹åŠ¡è¯·æ±‚ï¼Œè€Œäº‹åŠ¡ç®¡ç†å™¨åˆ™ä¼šåˆ†åˆ«å‘å‚ä¸çš„å„ä¸ªèµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰å‘é€äº‹åŠ¡é¢„å¤„ç†è¯·æ±‚ï¼ˆPrepareï¼‰ï¼Œæ­¤æ—¶è¿™äº›èµ„æºç®¡ç†å™¨ä¼šæ‰“å¼€æœ¬åœ°æ•°æ®åº“äº‹åŠ¡ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ•°æ®åº“äº‹åŠ¡ï¼Œä½†æ‰§è¡Œå®Œæˆåå¹¶ä¸ä¼šç«‹åˆ»æäº¤äº‹åŠ¡ï¼Œè€Œæ˜¯å‘äº‹åŠ¡ç®¡ç†å™¨è¿”å›å·²å°±ç»ªï¼ˆReadyï¼‰æˆ–æœªå°±ç»ªï¼ˆNot Readyï¼‰çŠ¶æ€ã€‚å¦‚æœå„ä¸ªå‚ä¸èŠ‚ç‚¹éƒ½è¿”å›çŠ¶æ€äº†ï¼Œå°±ä¼šè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/95/2a1cf8f45675acac6fe07c172a36ec95.jpg?wh=2224*746\" alt=\"\"></p><p>åˆ°äº†ç¬¬äºŒé˜¶æ®µï¼Œå¦‚æœèµ„æºç®¡ç†å™¨è¿”å›çš„éƒ½æ˜¯å°±ç»ªçŠ¶æ€ï¼Œäº‹åŠ¡ç®¡ç†å™¨åˆ™ä¼šå‘å„ä¸ªèµ„æºç®¡ç†å™¨å‘é€æäº¤ï¼ˆCommitï¼‰é€šçŸ¥ï¼Œèµ„æºç®¡ç†å™¨åˆ™ä¼šå®Œæˆæœ¬åœ°æ•°æ®åº“çš„äº‹åŠ¡æäº¤ï¼Œæœ€ç»ˆè¿”å›æäº¤ç»“æœç»™äº‹åŠ¡ç®¡ç†å™¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/59/d5/59734e1a229ceee9df4295d0901ce2d5.jpg?wh=2212*688\" alt=\"\"></p><p>åœ¨ç¬¬äºŒé˜¶æ®µä¸­ï¼Œå¦‚æœä»»æ„èµ„æºç®¡ç†å™¨è¿”å›äº†æœªå°±ç»ªçŠ¶æ€ï¼Œæ­¤æ—¶äº‹åŠ¡ç®¡ç†å™¨ä¼šå‘æ‰€æœ‰èµ„æºç®¡ç†å™¨å‘é€äº‹åŠ¡å›æ»šï¼ˆRollbackï¼‰é€šçŸ¥ï¼Œæ­¤æ—¶å„ä¸ªèµ„æºç®¡ç†å™¨å°±ä¼šå›æ»šæœ¬åœ°æ•°æ®åº“äº‹åŠ¡ï¼Œé‡Šæ”¾èµ„æºï¼Œå¹¶è¿”å›ç»“æœé€šçŸ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/87/2f/8791dfe19fce916f77b6c5740bc32e2f.jpg?wh=2202*760\" alt=\"\"></p><p>ä½†äº‹å®ä¸Šï¼ŒäºŒé˜¶äº‹åŠ¡æäº¤ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚</p><p>ç¬¬ä¸€ï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°å„ä¸ªèµ„æºç®¡ç†å™¨èŠ‚ç‚¹å­˜åœ¨é˜»å¡ï¼Œåªæœ‰å½“æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å‡†å¤‡å®Œæˆä¹‹åï¼Œäº‹åŠ¡ç®¡ç†å™¨æ‰ä¼šå‘å‡ºè¿›è¡Œå…¨å±€äº‹åŠ¡æäº¤çš„é€šçŸ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¦‚æœå¾ˆé•¿ï¼Œåˆ™ä¼šæœ‰å¾ˆå¤šèŠ‚ç‚¹é•¿æ—¶é—´å ç”¨èµ„æºï¼Œä»è€Œå½±å“æ•´ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ã€‚</p><p>ä¸€æ—¦èµ„æºç®¡ç†å™¨æŒ‚äº†ï¼Œå°±ä¼šå‡ºç°ä¸€ç›´é˜»å¡ç­‰å¾…çš„æƒ…å†µã€‚ç±»ä¼¼é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´æ¥è§£å†³ã€‚</p><p>ç¬¬äºŒï¼Œä»ç„¶å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚ï¼Œåœ¨æœ€åé€šçŸ¥æäº¤å…¨å±€äº‹åŠ¡æ—¶ï¼Œç”±äºç½‘ç»œæ•…éšœï¼Œéƒ¨åˆ†èŠ‚ç‚¹æœ‰å¯èƒ½æ”¶ä¸åˆ°é€šçŸ¥ï¼Œç”±äºè¿™éƒ¨åˆ†èŠ‚ç‚¹æ²¡æœ‰æäº¤äº‹åŠ¡ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå‡ºç°ã€‚</p><p><strong>è€Œä¸‰é˜¶äº‹åŠ¡ï¼ˆ3PCï¼‰çš„å‡ºç°å°±æ˜¯ä¸ºäº†å‡å°‘æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿã€‚</strong></p><p>3PCæŠŠ2PCçš„å‡†å¤‡é˜¶æ®µåˆ†ä¸ºäº†å‡†å¤‡é˜¶æ®µå’Œé¢„å¤„ç†é˜¶æ®µï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µåªæ˜¯è¯¢é—®å„ä¸ªèµ„æºèŠ‚ç‚¹æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼Œè€Œåœ¨ç¬¬äºŒé˜¶æ®µï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åé¦ˆå¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼Œæ‰å¼€å§‹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œæœ€ååœ¨ç¬¬ä¸‰é˜¶æ®µæ‰§è¡Œæäº¤æˆ–å›æ»šæ“ä½œã€‚å¹¶ä¸”åœ¨äº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨ä¸­éƒ½å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœåœ¨ç¬¬ä¸‰é˜¶æ®µï¼Œèµ„æºèŠ‚ç‚¹ä¸€ç›´æ— æ³•æ”¶åˆ°æ¥è‡ªèµ„æºç®¡ç†å™¨çš„æäº¤æˆ–å›æ»šè¯·æ±‚ï¼Œå®ƒå°±ä¼šåœ¨è¶…æ—¶ä¹‹åï¼Œç»§ç»­æäº¤äº‹åŠ¡ã€‚</p><p>æ‰€ä»¥3PCå¯ä»¥é€šè¿‡è¶…æ—¶æœºåˆ¶ï¼Œé¿å…ç®¡ç†å™¨æŒ‚æ‰æ‰€é€ æˆçš„é•¿æ—¶é—´é˜»å¡é—®é¢˜ï¼Œä½†å…¶å®è¿™æ ·è¿˜æ˜¯æ— æ³•è§£å†³åœ¨æœ€åæäº¤å…¨å±€äº‹åŠ¡æ—¶ï¼Œç”±äºç½‘ç»œæ•…éšœæ— æ³•é€šçŸ¥åˆ°ä¸€äº›èŠ‚ç‚¹çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å›æ»šé€šçŸ¥ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡ç­‰å¾…è¶…æ—¶ä»è€Œé»˜è®¤æäº¤ã€‚</p><h3>3. äº‹åŠ¡è¡¥å¿æœºåˆ¶ï¼ˆTCCï¼‰</h3><p>ä»¥ä¸Šè¿™ç§åŸºäºXAè§„èŒƒå®ç°çš„äº‹åŠ¡æäº¤ï¼Œç”±äºé˜»å¡ç­‰æ€§èƒ½é—®é¢˜ï¼Œæœ‰ç€æ¯”è¾ƒæ˜æ˜¾çš„ä½æ€§èƒ½ã€ä½ååçš„ç‰¹æ€§ã€‚æ‰€ä»¥åœ¨æŠ¢è´­æ´»åŠ¨ä¸­ä½¿ç”¨è¯¥äº‹åŠ¡ï¼Œå¾ˆéš¾æ»¡è¶³ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p><p>é™¤äº†æ€§èƒ½é—®é¢˜ï¼ŒJTAåªèƒ½è§£å†³åŒä¸€æœåŠ¡ä¸‹æ“ä½œå¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œæ¢åˆ°å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå¯èƒ½å­˜åœ¨åŒä¸€ä¸ªäº‹åŠ¡æ“ä½œï¼Œåˆ†åˆ«åœ¨ä¸åŒæœåŠ¡ä¸Šè¿æ¥æ•°æ®æºï¼Œæäº¤æ•°æ®åº“æ“ä½œã€‚</p><p>è€ŒTCCæ­£æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜è€Œå‡ºç°çš„ä¸€ç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚TCCé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹å¼å®ç°äº†ä¸€ç§æŸ”æ€§åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¸XAè§„èŒƒå®ç°çš„äºŒé˜¶äº‹åŠ¡ä¸åŒçš„æ˜¯ï¼ŒTCCçš„å®ç°æ˜¯åŸºäºæœåŠ¡å±‚å®ç°çš„ä¸€ç§äºŒé˜¶äº‹åŠ¡æäº¤ã€‚</p><p>TCCåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œå³Tryã€Confirmã€Cancelä¸‰ä¸ªé˜¶æ®µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/23/a9/23f68980870465ba6c00c0f2619fcfa9.jpg?wh=1892*1300\" alt=\"\"></p><ul>\n<li>Tryé˜¶æ®µï¼šä¸»è¦å°è¯•æ‰§è¡Œä¸šåŠ¡ï¼Œæ‰§è¡Œå„ä¸ªæœåŠ¡ä¸­çš„Tryæ–¹æ³•ï¼Œä¸»è¦åŒ…æ‹¬é¢„ç•™æ“ä½œï¼›</li>\n<li>Confirmé˜¶æ®µï¼šç¡®è®¤Tryä¸­çš„å„ä¸ªæ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œç„¶åé€šè¿‡TMè°ƒç”¨å„ä¸ªæœåŠ¡çš„Confirmæ–¹æ³•ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯æäº¤é˜¶æ®µï¼›</li>\n<li>Cancelé˜¶æ®µï¼šå½“åœ¨Tryé˜¶æ®µå‘ç°å…¶ä¸­ä¸€ä¸ªTryæ–¹æ³•å¤±è´¥ï¼Œä¾‹å¦‚é¢„ç•™èµ„æºå¤±è´¥ã€ä»£ç å¼‚å¸¸ç­‰ï¼Œåˆ™ä¼šè§¦å‘TMè°ƒç”¨å„ä¸ªæœåŠ¡çš„Cancelæ–¹æ³•ï¼Œå¯¹å…¨å±€äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œå–æ¶ˆæ‰§è¡Œä¸šåŠ¡ã€‚</li>\n</ul><p>ä»¥ä¸Šæ‰§è¡Œåªæ˜¯ä¿è¯Tryé˜¶æ®µæ‰§è¡Œæ—¶æˆåŠŸæˆ–å¤±è´¥çš„æäº¤å’Œå›æ»šæ“ä½œï¼Œä½ è‚¯å®šä¼šæƒ³åˆ°ï¼Œå¦‚æœåœ¨Confirmå’ŒCancelé˜¶æ®µå‡ºç°å¼‚å¸¸æƒ…å†µï¼Œé‚£TCCè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿæ­¤æ—¶TCCä¼šä¸åœåœ°é‡è¯•è°ƒç”¨å¤±è´¥çš„Confirmæˆ–Cancelæ–¹æ³•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p><p>ä½†TCCè¡¥å¿æ€§äº‹åŠ¡ä¹Ÿæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å¯¹ä¸šåŠ¡çš„ä¾µå…¥æ€§éå¸¸å¤§ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸šåŠ¡è®¾è®¡çš„æ—¶å€™è€ƒè™‘é¢„ç•™èµ„æºï¼›ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™å¤§é‡ä¸šåŠ¡æ€§ä»£ç ï¼Œä¾‹å¦‚Tryã€Confirmã€Cancelæ–¹æ³•ï¼›æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºæ¯ä¸ªæ–¹æ³•è€ƒè™‘å¹‚ç­‰æ€§ã€‚è¿™ç§äº‹åŠ¡çš„å®ç°å’Œç»´æŠ¤æˆæœ¬éå¸¸é«˜ï¼Œä½†ç»¼åˆæ¥çœ‹ï¼Œè¿™ç§å®ç°æ˜¯ç›®å‰å¤§å®¶æœ€å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><h3>4. ä¸šåŠ¡æ— ä¾µå…¥æ–¹æ¡ˆâ€”â€”Seata(Fescar)</h3><p>Seataæ˜¯é˜¿é‡Œå»å¹´å¼€æºçš„ä¸€å¥—åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå¼€æºä¸€å¹´å¤šå·²ç»æœ‰ä¸€ä¸‡å¤šstaräº†ï¼Œå¯è§å—æ¬¢è¿ç¨‹åº¦éå¸¸ä¹‹é«˜ã€‚</p><p>Seataçš„åŸºç¡€å»ºæ¨¡å’ŒDTPæ¨¡å‹ç±»ä¼¼ï¼Œåªä¸è¿‡å‰è€…æ˜¯å°†äº‹åŠ¡ç®¡ç†å™¨åˆ†å¾—æ›´ç»†äº†ï¼ŒæŠ½å‡ºä¸€ä¸ªäº‹åŠ¡åè°ƒå™¨ï¼ˆTransaction Coordinator ç®€ç§°TCï¼‰ï¼Œä¸»è¦ç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šã€‚è€ŒTMåˆ™è´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6a/83/6ac3de014819c54fe6904c938240b183.jpg?wh=1086*896\" alt=\"\"></p><p>æŒ‰ç…§<a href=\"https://github.com/seata/seata\">Github</a>ä¸­çš„è¯´æ˜ä»‹ç»ï¼Œæ•´ä¸ªäº‹åŠ¡æµç¨‹ä¸ºï¼š</p><ul>\n<li>TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDï¼›</li>\n<li>XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼›</li>\n<li>RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼›</li>\n<li>TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼›</li>\n<li>TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</li>\n</ul><p>Seataä¸å…¶å®ƒåˆ†å¸ƒå¼æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒåœ¨ç¬¬ä¸€æäº¤é˜¶æ®µå°±å·²ç»å°†å„ä¸ªäº‹åŠ¡æ“ä½œcommitäº†ã€‚Seataè®¤ä¸ºåœ¨ä¸€ä¸ªæ­£å¸¸çš„ä¸šåŠ¡ä¸‹ï¼Œå„ä¸ªæœåŠ¡æäº¤äº‹åŠ¡çš„å¤§æ¦‚ç‡æ˜¯æˆåŠŸçš„ï¼Œè¿™ç§äº‹åŠ¡æäº¤æ“ä½œå¯ä»¥èŠ‚çº¦ä¸¤ä¸ªé˜¶æ®µæŒæœ‰é”çš„æ—¶é—´ï¼Œä»è€Œæé«˜æ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>é‚£å¦‚æœåœ¨ç¬¬ä¸€é˜¶æ®µå°±å·²ç»æäº¤äº†äº‹åŠ¡ï¼Œé‚£æˆ‘ä»¬è¿˜è°ˆä½•å›æ»šå‘¢ï¼Ÿ</p><p>Seataå°†RMæå‡åˆ°äº†æœåŠ¡å±‚ï¼Œé€šè¿‡JDBCæ•°æ®æºä»£ç†è§£æSQLï¼ŒæŠŠä¸šåŠ¡æ•°æ®åœ¨æ›´æ–°å‰åçš„æ•°æ®é•œåƒç»„ç»‡æˆå›æ»šæ—¥å¿—ï¼Œåˆ©ç”¨æœ¬åœ°äº‹åŠ¡çš„ ACID ç‰¹æ€§ï¼Œå°†ä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå›æ»šæ—¥å¿—çš„å†™å…¥åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ã€‚</p><p>å¦‚æœTCå†³è®®è¦å…¨å±€å›æ»šï¼Œä¼šé€šçŸ¥RMè¿›è¡Œå›æ»šæ“ä½œï¼Œé€šè¿‡XIDæ‰¾åˆ°å¯¹åº”çš„å›æ»šæ—¥å¿—è®°å½•ï¼Œé€šè¿‡å›æ»šè®°å½•ç”Ÿæˆåå‘æ›´æ–°SQLï¼Œè¿›è¡Œæ›´æ–°å›æ»šæ“ä½œã€‚</p><p>ä»¥ä¸Šæˆ‘ä»¬å¯ä»¥ä¿è¯ä¸€ä¸ªäº‹åŠ¡çš„åŸå­æ€§å’Œä¸€è‡´æ€§ï¼Œä½†éš”ç¦»æ€§å¦‚ä½•ä¿è¯å‘¢ï¼Ÿ</p><p>Seataè®¾è®¡é€šè¿‡äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„å…¨å±€å†™æ’å®ƒé”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„å†™éš”ç¦»ï¼Œè€Œè¯»å†™éš”ç¦»çº§åˆ«åˆ™é»˜è®¤ä¸ºæœªæäº¤è¯»çš„éš”ç¦»çº§åˆ«ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨åŒæœåŠ¡å¤šæ•°æ®æºæ“ä½œä¸åŒæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºXAè§„èŒƒå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåœ¨Springä¸­æœ‰æˆç†Ÿçš„JTAæ¡†æ¶å®ç°äº†XAè§„èŒƒçš„äºŒé˜¶äº‹åŠ¡æäº¤ã€‚äº‹å®ä¸Šï¼ŒäºŒé˜¶äº‹åŠ¡é™¤äº†æ€§èƒ½æ–¹é¢å­˜åœ¨ä¸¥é‡çš„é˜»å¡é—®é¢˜ä¹‹å¤–ï¼Œè¿˜æœ‰å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬åº”è¯¥æ…é‡è€ƒè™‘ä½¿ç”¨è¿™ç§äºŒé˜¶äº‹åŠ¡æäº¤ã€‚</p><p>åœ¨è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åŸºäºTCCå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¸¸ç”¨çš„ä¸­é—´ä»¶æœ‰TCC-Transactionã€‚TCCä¹Ÿæ˜¯åŸºäºäºŒé˜¶äº‹åŠ¡æäº¤åŸç†å®ç°çš„ï¼Œä½†TCCçš„äºŒé˜¶äº‹åŠ¡æäº¤æ˜¯æåˆ°äº†æœåŠ¡å±‚å®ç°ã€‚TCCæ–¹å¼è™½ç„¶æé«˜äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„æ•´ä½“æ€§èƒ½ï¼Œä½†ä¹Ÿç»™ä¸šåŠ¡å±‚å¸¦æ¥äº†éå¸¸å¤§çš„å·¥ä½œé‡ï¼Œå¯¹åº”ç”¨æœåŠ¡çš„ä¾µå…¥æ€§éå¸¸å¼ºï¼Œä½†è¿™æ˜¯å¤§å¤šæ•°å…¬å¸ç›®å‰æ‰€é‡‡ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><p>Seataæ˜¯ä¸€ç§é«˜æ•ˆçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè®¾è®¡åˆè¡·å°±æ˜¯è§£å†³åˆ†å¸ƒå¼å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ä»¥åŠä¾µå…¥æ€§é—®é¢˜ã€‚ä½†ç›®å‰Seataçš„ç¨³å®šæ€§æœ‰å¾…éªŒè¯ï¼Œä¾‹å¦‚ï¼Œåœ¨TCé€šçŸ¥RMå¼€å§‹æäº¤äº‹åŠ¡åï¼ŒTCä¸RMçš„è¿æ¥æ–­å¼€äº†ï¼Œæˆ–è€…RMä¸æ•°æ®åº“çš„è¿æ¥æ–­å¼€äº†ï¼Œéƒ½ä¸èƒ½ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>Seataåœ¨ç¬¬ä¸€é˜¶æ®µå·²ç»æäº¤äº†äº‹åŠ¡ï¼Œé‚£å¦‚æœåœ¨ç¬¬äºŒé˜¶æ®µå‘ç”Ÿäº†å¼‚å¸¸è¦å›æ»šåˆ°Beforeå¿«ç…§å‰ï¼Œåˆ«çš„çº¿ç¨‹è‹¥æ˜¯æ›´æ–°äº†æ•°æ®ï¼Œä¸”ä¸šåŠ¡èµ°å®Œäº†ï¼Œé‚£ä¹ˆæ¢å¤çš„è¿™ä¸ªå¿«ç…§ä¸å°±æ˜¯è„æ•°æ®äº†å—ï¼Ÿä½†äº‹å®ä¸Šï¼ŒSeataæ˜¯ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µçš„ï¼Œä½ çŸ¥é“å®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„å—ï¼Ÿ</p><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„ç­”æ¡ˆã€‚ä¹Ÿæ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·è®¨è®ºã€‚</p><p><span class=\"reference\"></span></p>","comments":[{"had_liked":false,"id":134410,"user_name":"G","can_delete":false,"product_type":"c1","uid":1206873,"ip_address":"","ucode":"35A3A0CD1FF675","user_header":"https://static001.geekbang.org/account/avatar/00/12/6a/59/ba3cad16.jpg","comment_is_top":false,"comment_ctime":1568820341,"is_pvip":false,"replies":[{"id":"51653","content":"MQå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæ˜¯TCCçš„ä¸€ç§å®ç°æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸»æµçš„ä¸€ç§åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1568895678,"ip_address":"","comment_id":134410,"utype":1}],"discussion_count":6,"race_medal":0,"score":"121827904629","product_id":100028001,"comment_content":"ç›®å‰ä¸»æµçš„åšæ³•ä¸æ˜¯é€šè¿‡å¼‚æ­¥æ¶ˆæ¯æ¥å®ç°çš„å—ã€‚ä¸‹å•åŒæ­¥è°ƒç”¨æ‰£å‡åº“å­˜æ¥å£ã€‚ç„¶åä¸šåŠ¡çº¿ç›‘å¬è®¢å•çŠ¶æ€æ¥å£å®ç°ä¸šåŠ¡ã€‚å¯¹äºæ‰£å‡åº“å­˜å¦‚æœå‘ç”Ÿè¶…æ—¶ï¼Œä¸‹å•å¤±è´¥ã€‚å•†å“ä¸­å¿ƒç›‘å¬è´¹å•æ¶ˆæ¯ï¼ŒåŠ å›åº“å­˜ã€‚æ¥å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚å…¶ä»–ä¸šåŠ¡ç±»åŒ","like_count":29,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467732,"discussion_content":"MQå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæ˜¯TCCçš„ä¸€ç§å®ç°æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸»æµçš„ä¸€ç§åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568895678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1229566,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c2/fe/038a076e.jpg","nickname":"é˜¿å§","note":"","ucode":"68C0CC25E57707","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208663,"discussion_content":"mqçš„äº‹åŠ¡æ€§æ¶ˆæ¯å±äºæ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§é€šçŸ¥å—ï¼Ÿæ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§å’Œtccæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584574320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"å‰‘å…«","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558067,"discussion_content":"è¿™é‡Œåº“å­˜æ‰£å¤±è´¥æ€ä¹ˆé€šçŸ¥ç”¨æˆ·ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648083584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"å‰‘å…«","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558065,"discussion_content":"è¿™é‡Œåº“å­˜å¼‚æ­¥ï¼Œå¤±è´¥å¦‚ä½•é€šçŸ¥ç”¨æˆ·ï¼Ÿç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648083552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2532285,"avatar":"","nickname":"Geek_926921","note":"","ucode":"51C3B0178D77E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382886,"discussion_content":"å¤§ä½¬ï¼Œé¢è¯•æ—¶å€™åˆ«äººé—®ç”¨MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ—¶å€™é•¿æ—¶é—´ç­‰å¾…çŠ¶æ€è¿”å›ï¼Œæ€ä¹ˆæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625755215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1142335,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/3f/49e5079f.jpg","nickname":"æ¥ä¼½å±±äºº","note":"","ucode":"5859C06DAC790D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2532285,"avatar":"","nickname":"Geek_926921","note":"","ucode":"51C3B0178D77E1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542634,"discussion_content":"è‡ªå·±ä¸»åŠ¨å»æ‹‰å– è¿™ç§æ˜¯å¦å¯è¡Œï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640824565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":382886,"ip_address":""},"score":542634,"extra":""}]}]},{"had_liked":false,"id":174679,"user_name":"asura","can_delete":false,"product_type":"c1","uid":1105148,"ip_address":"","ucode":"4AF66C19B4AE65","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/fc/5c3ad841.jpg","comment_is_top":false,"comment_ctime":1580346849,"is_pvip":false,"replies":[{"id":"69016","content":"æœ€æ–°ç‰ˆæœ¬çš„Seataå…¶å®å·²ç»åšçš„å¾ˆå…¨é¢äº†ï¼ŒåŒ…æ‹¬æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå•ç‚¹é—®é¢˜ï¼Œä¹Ÿæ˜¯ç‰ºç‰²äº†æ€§èƒ½æ¥æ¢å–çš„ã€‚<br><br>ä½ ä»¬é¡¹ç›®ä¸­è¿™ç§åšæ³•æ²¡é—®é¢˜ï¼Œä¸è¿‡å¾ˆå¤šå®é™…é¡¹ç›®ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯è¿™æ ·å®ç°çš„ï¼šåœ¨ä¿è¯ä¸»è®¢å•æäº¤æˆåŠŸä¹‹åï¼Œå…¶ä»–æœåŠ¡è°ƒç”¨å°±ä¼šé€šè¿‡é‡è¯•æœºåˆ¶æ¥ä¿è¯è¿™äº›è°ƒç”¨å¿…é¡»æˆåŠŸï¼Œè¿™ç§æ–¹å¼åœ¨å¹¶å‘æ€§èƒ½ä¸Šä¼šå¥½ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1581507340,"ip_address":"","comment_id":174679,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44530019809","product_id":100028001,"comment_content":"è€å¸ˆå¥½ï¼Œåˆ†å¸ƒäº‹åŠ¡åœ¨ç¨³å®šæ€§ä¸Šè¿˜å­˜æœ‰ä¸€äº›é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä»æ–‡ç« ä¸­æ¥çœ‹è€å¸ˆæ˜¯æ›´æ¨èSeataå—ï¼Ÿå¦‚æœå‡ºç°é—®é¢˜æ˜¯è¦äººå·¥å¤„ç†å—è¿˜æ˜¯ï¼Ÿæˆ‘ä»¬åœ¨å®é™…é¡¹ç›®å®æˆ˜ä¸­é‡‡ç”¨ å¦‚:ä¸‹å•è¯·æ±‚è°ƒç”¨è®¢å•æœåŠ¡ï¼ŒåŒä¸€ä¸ªè¯·æ±‚ä¸­è¿˜ä¼šè°ƒç”¨:æ‰£å‡åº“å­˜ï¼ˆå•†å“æœåŠ¡ï¼‰ã€ç”¨åˆ¸æˆ–è€…çº¢åŒ…ï¼ˆä¿ƒé”€æœåŠ¡ï¼‰ç­‰å…¶ä»–æœåŠ¡ã€‚åœ¨æ•´ä¸ªæ–¹æ³•ä½“ä¸­åšæ§åˆ¶ï¼Œå¦‚æœè°ƒç”¨çš„å…¶ä»–å¾®æœåŠ¡æ¥å£è¿”å›å¤±è´¥å°±æŠ›å¼‚å¸¸å›æ»šæ•´ä¸ªè¯·æ±‚æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œè¿™ç§è€å¸ˆæ€ä¹ˆçœ‹ï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482486,"discussion_content":"æœ€æ–°ç‰ˆæœ¬çš„Seataå…¶å®å·²ç»åšçš„å¾ˆå…¨é¢äº†ï¼ŒåŒ…æ‹¬æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå•ç‚¹é—®é¢˜ï¼Œä¹Ÿæ˜¯ç‰ºç‰²äº†æ€§èƒ½æ¥æ¢å–çš„ã€‚\n\nä½ ä»¬é¡¹ç›®ä¸­è¿™ç§åšæ³•æ²¡é—®é¢˜ï¼Œä¸è¿‡å¾ˆå¤šå®é™…é¡¹ç›®ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯è¿™æ ·å®ç°çš„ï¼šåœ¨ä¿è¯ä¸»è®¢å•æäº¤æˆåŠŸä¹‹åï¼Œå…¶ä»–æœåŠ¡è°ƒç”¨å°±ä¼šé€šè¿‡é‡è¯•æœºåˆ¶æ¥ä¿è¯è¿™äº›è°ƒç”¨å¿…é¡»æˆåŠŸï¼Œè¿™ç§æ–¹å¼åœ¨å¹¶å‘æ€§èƒ½ä¸Šä¼šå¥½ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581507340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"å‰‘å…«","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558072,"discussion_content":"æ˜¯çš„ï¼Œä¸€èˆ¬è®¾è®¡æ˜¯ä»¥æŸä¸€ä¸ªä¸šåŠ¡æ“ä½œæˆåŠŸä¸ºä¸»ï¼Œç„¶ååé¢å¯ä»¥åšäº‹åŠ¡æ¶ˆæ¯å»åš","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648084067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155838,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":false,"comment_ctime":1574764530,"is_pvip":true,"replies":[{"id":"60146","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1574943250,"ip_address":"","comment_id":155838,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35934502898","product_id":100028001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·ç†è§£ï¼ŒSeataæ˜¯é€šè¿‡TMç®¡ç†å…¨å±€äº‹åŠ¡ï¼Œæ‰€æœ‰ç”¨Seataçš„APéƒ½å¯ä»¥å®ç°å†™çš„éš”ç¦»ï¼Œä¹Ÿå°±æ˜¯å¯¹åŒä¸€è¡Œæ•°æ®æœ‰å½±å“çš„æ—¶å€™ï¼Œå¹¶ä¸å­˜åœ¨åˆ†å¸ƒçš„Aäº‹åŠ¡æ²¡æœ‰æ“ä½œå®Œæ¯•ï¼ŒBäº‹åŠ¡å°±å¼€å§‹æ“ä½œçš„æƒ…å†µã€‚<br><br>Seataé»˜è®¤é‡‡ç”¨äº†å¾ˆä¹è§‚çš„åˆ†å¸ƒå¼ç­–ç•¥ï¼ŒCAPé‡Œé¢ä¼˜å…ˆä¿è¯äº†Aï¼Œå¹¶æ²¡æœ‰å½»åº•è§£å†³è„è¯»çš„é—®é¢˜ã€‚<br><br>è€Œå¦‚æœè®¾ç½®ä¸ºè¯»â€œå·²æäº¤â€ï¼Œé‚£å°±è¦Seataåœ¨å†…å­˜è®°å½•é¢å¤–çš„æ•°æ®ï¼Œç”¨äºè¿”å›å·²æäº¤çš„&quot;æ­£ç¡®æ•°æ®&quot;ï¼Ÿè€Œè¿™ä¸ªå°±åˆæ‰¯å‡ºå†…å­˜ç®¡ç†æˆ–å´©æºƒæ—¶è¿™äº›&quot;æ­£ç¡®æ•°æ®&quot;æŒä¹…åŒ–çš„é—®é¢˜ï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦ä¸Šå‡ï¼Ÿè¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475893,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574943250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128645,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1566921713,"is_pvip":false,"replies":[{"id":"47763","content":"é»˜è®¤æƒ…å†µä¸‹ï¼Œseataè®¤ä¸ºå¤§å¤šæ•°åˆ†å¸ƒå¼ä¸šåŠ¡æ¶‰åŠåˆ°è„è¯»çš„å¯èƒ½æ€§æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¿è¯äº†å¤§å¤šæ•°åœºæ™¯ä¸‹çš„é«˜æ•ˆæ€§ã€‚<br><br>å¦‚æœéœ€è¦è¾¾åˆ°å…¨å±€çš„ è¯»å·²æäº¤ï¼Œseataä¹Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è¾¾åˆ°ç›®çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566956264,"ip_address":"","comment_id":128645,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31631692785","product_id":100028001,"comment_content":"ä¸å¤ªç†è§£seataé»˜è®¤éš”ç¦»çº§åˆ«ä¸ºå•¥æ˜¯æœªæäº¤è¯»ï¼Œä¸æ€•è„è¯»ï¼Ÿè¿˜æ˜¯ä¸ºäº†ä¿è¯æ€§èƒ½æ‰åšçš„å¦¥åï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465037,"discussion_content":"é»˜è®¤æƒ…å†µä¸‹ï¼Œseataè®¤ä¸ºå¤§å¤šæ•°åˆ†å¸ƒå¼ä¸šåŠ¡æ¶‰åŠåˆ°è„è¯»çš„å¯èƒ½æ€§æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¿è¯äº†å¤§å¤šæ•°åœºæ™¯ä¸‹çš„é«˜æ•ˆæ€§ã€‚\n\nå¦‚æœéœ€è¦è¾¾åˆ°å…¨å±€çš„ è¯»å·²æäº¤ï¼Œseataä¹Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è¾¾åˆ°ç›®çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566956264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2045659,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/36/db/03a41c33.jpg","nickname":"doosheng","note":"","ucode":"A4CDACDBEF855A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530974,"discussion_content":"è¡¥å……ä¸€ä¸‹è€å¸ˆæ‰€è¯´çš„â€œç›¸åº”çš„æœºåˆ¶â€ï¼Œç›®å‰ Seata çš„æ–¹å¼æ˜¯é€šè¿‡ SELECT FOR UPDATE è¯­å¥çš„ä»£ç†ã€‚SELECT FOR UPDATE è¯­å¥çš„æ‰§è¡Œä¼šç”³è¯· å…¨å±€é” ï¼Œå¦‚æœ å…¨å±€é” è¢«å…¶ä»–äº‹åŠ¡æŒæœ‰ï¼Œåˆ™é‡Šæ”¾æœ¬åœ°é”ï¼ˆå›æ»š SELECT FOR UPDATE è¯­å¥çš„æœ¬åœ°æ‰§è¡Œï¼‰å¹¶é‡è¯•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæŸ¥è¯¢æ˜¯è¢« block ä½çš„ï¼Œç›´åˆ° å…¨å±€é” æ‹¿åˆ°ï¼Œå³è¯»å–çš„ç›¸å…³æ•°æ®æ˜¯ å·²æäº¤ çš„ï¼Œæ‰è¿”å›ã€‚å‡ºäºæ€»ä½“æ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼ŒSeata ç›®å‰çš„æ–¹æ¡ˆå¹¶æ²¡æœ‰å¯¹æ‰€æœ‰ SELECT è¯­å¥éƒ½è¿›è¡Œä»£ç†ï¼Œä»…é’ˆå¯¹ FOR UPDATE çš„ SELECT è¯­å¥ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637198806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128488,"user_name":"è®¸ç«¥ç«¥","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1566888816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31631659888","product_id":100028001,"comment_content":"åˆ†é¡µå¼äº‹åŠ¡ä¸­å¸¸ç”¨çš„æ–¹æ³•ï¼š<br>1.äºŒé˜¶æ®µæäº¤<br>2.ä¸‰é˜¶æ®µæäº¤<br>3.TCCäº‹åŠ¡<br>4.Seataï¼ˆæœ‰å¾…éªŒè¯ï¼‰","like_count":6},{"had_liked":false,"id":128223,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1566864505,"is_pvip":false,"replies":[{"id":"47780","content":"èµï¼Œå…¨å±€å†™æ’å®ƒé”æ˜¯æ ¹æ®resourceId + table + pkså®ç°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566957377,"ip_address":"","comment_id":128223,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23041700985","product_id":100028001,"comment_content":"è€å¸ˆå¥½!<br>Seata è®¾è®¡é€šè¿‡äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„å…¨å±€å†™æ’å®ƒé”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„å†™éš”ç¦»ï¼Œè€Œè¯»å†™éš”ç¦»çº§åˆ«åˆ™é»˜è®¤ä¸ºæœªæäº¤è¯»çš„éš”ç¦»çº§åˆ«ã€‚<br>è¿™ä¸ªå…¨å±€å†™æ’ä»–é”æ”¯æŒé‚£å‡ ç§é”å•Š?<br>è¡Œé”ï¼Œè¡¨é”ï¼Œé—´éš™é”ï¼Œå…ƒæ•°æ®é”åˆ«çš„è®°ä¸èµ·æ¥äº†<br>å¦‚æœæ”¯æŒçš„é”ç²’åº¦ä¸å¤Ÿååé‡ä¹Ÿä¼šé™ä½å¾ˆå¤šå§ã€‚","like_count":5,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464853,"discussion_content":"èµï¼Œå…¨å±€å†™æ’å®ƒé”æ˜¯æ ¹æ®resourceId + table + pkså®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566957377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1367031,"avatar":"https://static001.geekbang.org/account/avatar/00/14/db/f7/29e1a022.jpg","nickname":"seustones","note":"","ucode":"66B8D7754BDB4D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46840,"discussion_content":"æ˜¯è¡Œé”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573215936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130643,"user_name":"ä»»é¹æ–Œ","can_delete":false,"product_type":"c1","uid":1104086,"ip_address":"","ucode":"34319B05EA6E74","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg","comment_is_top":false,"comment_ctime":1567500549,"is_pvip":false,"replies":[{"id":"49143","content":"ä¼šçš„ï¼Œæˆ‘åœ¨æ–‡ä¸­å·²ç»æåˆ°äº†","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1567596638,"ip_address":"","comment_id":130643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18747369733","product_id":100028001,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜é˜¿é‡Œçš„å¼€æºåˆ†å¸ƒå¼æ–¹æ¡ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨æ˜¯å•ç‚¹çš„ï¼Œå¦‚æœæŒ‚æ‰äº†ä¼šä¸ä¼šå¼•èµ·äº‹åŠ¡ä¸ä¸€è‡´ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466046,"discussion_content":"ä¼šçš„ï¼Œæˆ‘åœ¨æ–‡ä¸­å·²ç»æåˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567596638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172013,"user_name":"Alsace","can_delete":false,"product_type":"c1","uid":1702972,"ip_address":"","ucode":"2B83ACE05B688B","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFr9x9UtgJEpiaUMWxO9GOrlARIhSCAiaZe4npv4ricWYJowgl5eO3s19yZ7ibOjfGyDicfxPD6Yc8beA/132","comment_is_top":false,"comment_ctime":1579070909,"is_pvip":false,"replies":[{"id":"67217","content":"å¸¸è§„åšæ³•æ˜¯ï¼Œä¸»ä¸šåŠ¡äº‹åŠ¡å®Œæˆä¹‹åï¼Œå…¶ä»–ä¸šåŠ¡é€šè¿‡mqé€šçŸ¥ï¼Œæˆ‘ä»¬ä¸åšå›æ»šæ“ä½œï¼Œé€šè¿‡é‡è¯•æœºåˆ¶æˆ–è€…mqçš„å†…éƒ¨ackæœºåˆ¶è¦ä¿è¯mqçš„æ¶ˆæ¯èƒ½æˆåŠŸè¢«æ¶ˆè´¹æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1579523316,"ip_address":"","comment_id":172013,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14463972797","product_id":100028001,"comment_content":"æˆ‘ä¸€ç›´æœ‰ä¸ªé—®é¢˜æƒ³è¯·é—®ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åŸºäºMQå®ç°çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¦‚æœéœ€è¦å›æ»šï¼Œè¦æ€ä¹ˆæ“ä½œï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481584,"discussion_content":"å¸¸è§„åšæ³•æ˜¯ï¼Œä¸»ä¸šåŠ¡äº‹åŠ¡å®Œæˆä¹‹åï¼Œå…¶ä»–ä¸šåŠ¡é€šè¿‡mqé€šçŸ¥ï¼Œæˆ‘ä»¬ä¸åšå›æ»šæ“ä½œï¼Œé€šè¿‡é‡è¯•æœºåˆ¶æˆ–è€…mqçš„å†…éƒ¨ackæœºåˆ¶è¦ä¿è¯mqçš„æ¶ˆæ¯èƒ½æˆåŠŸè¢«æ¶ˆè´¹æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579523316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053914,"avatar":"https://static001.geekbang.org/account/avatar/00/10/14/da/0a012c26.jpg","nickname":"å­¤å¸†","note":"","ucode":"8CC9AAF28944EB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":174876,"discussion_content":"å¦‚æœæ¶ˆè´¹å¤±è´¥äº†å‘¢ï¼Ÿ\nä¹‹å‰çš„è¦æ€ä¹ˆåšè‡ªåŠ¨å›æ»šå‘¢ï¼Ÿæä¾›ä¸€ä¸ªæ¥å£ä¹ˆï¼Œæ„Ÿè§‰æœ‰ç‚¹ç´¯å•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581944769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128367,"user_name":"æ‹’ç»","can_delete":false,"product_type":"c1","uid":1335155,"ip_address":"","ucode":"CB0264C4D3FE17","user_header":"https://static001.geekbang.org/account/avatar/00/14/5f/73/bb3dc468.jpg","comment_is_top":false,"comment_ctime":1566875687,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14451777575","product_id":100028001,"comment_content":"ä¸€é˜¶æ®µæœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œéœ€è¦ç¡®ä¿å…ˆæ‹¿åˆ° å…¨å±€é” ã€‚<br>æ‹¿ä¸åˆ° å…¨å±€é” ï¼Œä¸èƒ½æäº¤æœ¬åœ°äº‹åŠ¡ã€‚<br>æ‹¿ å…¨å±€é” çš„å°è¯•è¢«é™åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œè¶…å‡ºèŒƒå›´å°†æ”¾å¼ƒï¼Œå¹¶å›æ»šæœ¬åœ°äº‹åŠ¡ï¼Œé‡Šæ”¾æœ¬åœ°é”ã€‚<br>ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ï¼š<br><br>ä¸¤ä¸ªå…¨å±€äº‹åŠ¡ tx1 å’Œ tx2ï¼Œåˆ†åˆ«å¯¹ a è¡¨çš„ m å­—æ®µè¿›è¡Œæ›´æ–°æ“ä½œï¼Œm çš„åˆå§‹å€¼ 1000ã€‚<br><br>tx1 å…ˆå¼€å§‹ï¼Œå¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œæ‹¿åˆ°æœ¬åœ°é”ï¼Œæ›´æ–°æ“ä½œ m = 1000 - 100 = 900ã€‚æœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œå…ˆæ‹¿åˆ°è¯¥è®°å½•çš„ å…¨å±€é” ï¼Œæœ¬åœ°æäº¤é‡Šæ”¾æœ¬åœ°é”ã€‚ tx2 åå¼€å§‹ï¼Œå¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œæ‹¿åˆ°æœ¬åœ°é”ï¼Œæ›´æ–°æ“ä½œ m = 900 - 100 = 800ã€‚æœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œå°è¯•æ‹¿è¯¥è®°å½•çš„ å…¨å±€é” ï¼Œtx1 å…¨å±€æäº¤å‰ï¼Œè¯¥è®°å½•çš„å…¨å±€é”è¢« tx1 æŒæœ‰ï¼Œtx2 éœ€è¦é‡è¯•ç­‰å¾… å…¨å±€é” ã€‚","like_count":3},{"had_liked":false,"id":277838,"user_name":"Geek_1c3897","can_delete":false,"product_type":"c1","uid":2353847,"ip_address":"","ucode":"C0D130DE847016","user_header":"","comment_is_top":false,"comment_ctime":1612616970,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5907584266","product_id":100028001,"comment_content":"è€å¸ˆå¥½ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸éƒ½ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆè¾ƒå¤§çš„å½±å“ï¼Œå®é™…é¡¹ç›®ä¸­å½“ä¸å¾—ä¸ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œå¦‚ä½•é¿å…å¯¹æ€§èƒ½é€ æˆè¾ƒå¤§å½±å“ï¼Ÿ","like_count":1},{"had_liked":false,"id":181686,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1582616381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877583677","product_id":100028001,"comment_content":"https:&#47;&#47;github.com&#47;nickliuchao&#47;jta&#47;blob&#47;master&#47;src&#47;main&#47;java&#47;com&#47;example&#47;demo&#47;config&#47;MyDataSourceAutoConfiguration.java <br>è€å¸ˆï¼Œä½ çš„è¿™ä¸ªä¾‹å­ï¼ŒAtomikosDataSourceBean è¿™ä¸ªç±»åˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰æ‰¾åˆ°#setXaDataSource è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘çœ‹å®ƒæ˜¯é›†æˆäº†com.atomikos.jdbc.AtomikosDataSourceBeanï¼Œè¿™ä¸ªæ–¹æ³•é‡Œï¼Œé‡Œé¢æœ‰æç¤ºæœ‰çš„#setXaDataSource è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºä»€ä¹ˆå¯¼è‡´æ˜¯ç”¨ä¸äº†çš„ï¼Œæ˜¯å› æˆ‘çš„spring bootçš„ç‰ˆå¤ªæ–°äº†ä¹ˆï¼Œ2.2.4 çš„","like_count":1},{"had_liked":false,"id":128711,"user_name":"ç¿çƒ‚æ˜å¤©","can_delete":false,"product_type":"c1","uid":1322455,"ip_address":"","ucode":"07DA56B0680D0C","user_header":"https://static001.geekbang.org/account/avatar/00/14/2d/d7/74fc8f38.jpg","comment_is_top":false,"comment_ctime":1566953564,"is_pvip":false,"replies":[{"id":"47767","content":"å¯ä»¥çš„ï¼Œç›®å‰å¾ˆå¤šå›¢é˜Ÿç”¨è¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¹Ÿæ˜¯åŸºäºTCCçš„æ€æƒ³å®ç°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566956510,"ip_address":"","comment_id":128711,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861920860","product_id":100028001,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘çœ‹ç½‘ä¸Šæœ‰äº›æ˜¯ç”¨mqæ¶ˆæ¯ä¸­é—´ä»¶æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Œå…¶å®è¿™ä¸ªæ–¹æ¡ˆèƒ½ä¸èƒ½è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„ï¼Ÿä»–çš„æ€æƒ³æ˜¯åŸºäºtccçš„å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465072,"discussion_content":"å¯ä»¥çš„ï¼Œç›®å‰å¾ˆå¤šå›¢é˜Ÿç”¨è¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¹Ÿæ˜¯åŸºäºTCCçš„æ€æƒ³å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566956510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128219,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1566864312,"is_pvip":false,"replies":[{"id":"47784","content":"å¯¹çš„ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ä½¿ç”¨é‡è¯•æœºåˆ¶ï¼Œå…¶æ¬¡ä¿è¯è®°å½•æ—¥å¿—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566957807,"ip_address":"","comment_id":128219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861831608","product_id":100028001,"comment_content":"è¯¾åä¹ é¢˜:å…¨å±€å†™é”ï¼Œç¬¬ä¸€é˜¶æ®µæ²¡æœ‰å‡†ç¡®çš„æäº¤æˆ–è€…å›æ»šå‰ï¼Œåç»­ä¸šåŠ¡æ— æ³•æŒæœ‰é”ã€‚æˆ‘æœ¬æ¥è¿˜æƒ³é—®ä¸‹è€å¸ˆè¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œä¸è¿‡è€å¸ˆæœ€åå†™äº†å˜¿å˜¿çœçš„é—®äº†ã€‚é»˜è®¤è¯»ä¸ºæäº¤ï¼Œä¸æ€•è„è¯»ä¹ˆ?<br>TCCåè®®å…·ä½“æ¯ä¸€æ­¥æ€ä¹ˆåšè®²ä¸€ä¸‹ä¹ˆè€å¸ˆ?<br>å·²è®¢å•æ”¯ä»˜ä¸ºä¾‹ï¼Œ<br>try:å°è¯•é¢„æ‰£å¤„ç†,æ€ä¹ˆé¢„æ‰£å‘¢ã€‚ç”¨redisé”åº“å­˜è¿˜æ˜¯ç›´æ¥æ€ä¹ˆé”ã€‚(æŠ¢è´­è£…å¤‡ï¼Œæ¸¸æˆå¸å’Œè£…å¤‡éƒ½åœ¨tryé˜¶æ®µé”å®šã€‚å†²çªå¤§çš„åtryï¼Œæäº¤çš„æ—¶å€™å†²çªå¤§çš„å…ˆcommit?)ã€‚<br>tryé˜¶æ®µï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ªäº‹åŠ¡è¿›è¡Œtryæ“ä½œéƒ½èƒ½tryæˆåŠŸä¹ˆ?å¦‚æœæ”¯æŒtryæˆåŠŸæ„Ÿè§‰æœ‰å¯èƒ½å‡ºç°è¯¾åé—®é¢˜çš„æƒ…å†µã€‚tryè¿™ä¸€æ­¥å¾ˆé‡è¦å•Šï¼Œéœ€è¦ä¿è¯tryä»¥åï¼Œä¸€å®šèƒ½æäº¤æˆåŠŸï¼Œä¹Ÿä¸€å®šèƒ½å›æ»šã€‚ä¼šä¸ä¼šæœ‰ä¸‡ä¸€çš„?ä¸‡ä¸€å…œåº•è§£å†³æ˜¯äººå·¥å¤„ç†ä¹ˆ?<br>","like_count":1,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464852,"discussion_content":"å¯¹çš„ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ä½¿ç”¨é‡è¯•æœºåˆ¶ï¼Œå…¶æ¬¡ä¿è¯è®°å½•æ—¥å¿—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566957807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331940,"user_name":"æ›¾æ–‡å³°","can_delete":false,"product_type":"c1","uid":2722962,"ip_address":"","ucode":"FCA525F93CE115","user_header":"","comment_is_top":false,"comment_ctime":1642911256,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642911256","product_id":100028001,"comment_content":"æƒ³é—®é—®è¿™ç§é€ æˆå…¬å¸èµ„äº§æŸå¤±çš„ç”Ÿäº§ç¯å¢ƒäº‹æ•…è¦æ‰¿æ‹…æ€ä¹ˆæ ·çš„è´£ä»»","like_count":0},{"had_liked":false,"id":301927,"user_name":"å¹³æ°‘äººä¹‹åŠ©","can_delete":false,"product_type":"c1","uid":2658705,"ip_address":"","ucode":"5CCEC0BAC08AEC","user_header":"https://static001.geekbang.org/account/avatar/00/28/91/91/428a27a3.jpg","comment_is_top":false,"comment_ctime":1625977334,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625977334","product_id":100028001,"comment_content":"ä¸ºå•¥ä¸è®²ç”¨é˜Ÿåˆ—æ¥å®ç°äº‹åŠ¡çš„åŸç†","like_count":0},{"had_liked":false,"id":291754,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1620464281,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620464281","product_id":100028001,"comment_content":"è¯»æœªæäº¤ï¼Œæœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚æ›´æ–°åçš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹å°±èƒ½è¯»å–åˆ°ã€‚<br><br>è¯»æœªæäº¤çš„éš”ç¦»çº§åˆ«ï¼Œæœ‰ç‚¹åƒ Java å¹¶å‘ï¼ˆåŸå­æ€§ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§ï¼‰ä¸­çš„å¯è§æ€§ã€‚ä¿è¯äº†å¯è§æ€§ï¼Œä¸å­˜åœ¨æœ‰åºæ€§é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æ˜¯åŸå­æ€§ã€‚<br>è§£å†³åŸå­æ€§é—®é¢˜ï¼Œæ‚²è§‚é”æˆ–è€…ä¹è§‚é”ï¼Œåº”è¯¥æ˜¯éœ€è¦è·å–åˆ°æŸä¸€æŠŠå…¨å±€é”ï¼ˆä¸èƒ½æ˜¯å¤šæŠŠé”ï¼Œæ— æ³•ä¿è¯å¤šæŠŠé”çš„åŸå­æ“ä½œï¼‰ï¼Œæ‰èƒ½æ›´æ–°æ•°æ®ã€‚","like_count":0},{"had_liked":false,"id":291731,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1620452657,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1620452657","product_id":100028001,"comment_content":"åŸæ–‡ï¼š<br>3PC åœ¨ç¬¬ä¸€é˜¶æ®µåªæ˜¯è¯¢é—®å„ä¸ªèµ„æºèŠ‚ç‚¹æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼Œè€Œåœ¨ç¬¬äºŒé˜¶æ®µï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åé¦ˆå¯ä»¥æ‰§è¡Œäº‹åŠ¡ï¼Œæ‰å¼€å§‹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œæœ€ååœ¨ç¬¬ä¸‰é˜¶æ®µæ‰§è¡Œæäº¤æˆ–å›æ»šæ“ä½œã€‚<br><br>é—®é¢˜ï¼š<br>ç¬¬ä¸€é˜¶æ®µè¯¢é—®ä¹‹åï¼Œå¾—åˆ°è‚¯å®šçš„å›å¤ï¼Œå†æ‰§è¡Œç¬¬äºŒé˜¶æ®µäº‹åŠ¡æ“ä½œã€‚é‚£ç¬¬ä¸€é˜¶æ®µçš„è¯¢é—®é€»è¾‘ï¼Œä»£ç è¦æ€ä¹ˆå®ç°ï¼Ÿå¦‚æ‰£åº“å­˜ï¼š<br><br>æ–¹æ¡ˆä¸€ï¼š<br>ç¬¬ä¸€é˜¶æ®µï¼šåªæŸ¥è¯¢åº“å­˜ï¼Œå¦‚æœå¤§äºéœ€æ±‚åˆ™å›å¤æˆåŠŸã€‚<br>ç¬¬äºŒé˜¶æ®µï¼šç›´æ¥æ‰§è¡Œæ‰£å‡åº“å­˜çš„ sqlã€‚<br>ç¬¬ä¸‰é˜¶æ®µï¼šæäº¤äº‹åŠ¡ï¼›æˆ–å›æ»šäº‹åŠ¡ï¼Œå½’è¿˜åº“å­˜ã€‚<br>è¯¥æ–¹æ¡ˆçš„ç¬¬ä¸€é˜¶æ®µå­˜åœ¨â€œå‡â€æˆåŠŸçš„æƒ…å†µï¼Œå¦‚åº“å­˜ä¸º 1ï¼Œå¤šä¸ªä¸åŒç”¨æˆ·çš„çº¿ç¨‹åŒæ—¶è¯¢é—®è¯¥åº“å­˜ï¼Œéƒ½éœ€è¦ 1 ä¸ªï¼Œç¬¬ä¸€é˜¶æ®µæˆåŠŸè€Œç¬¬äºŒé˜¶æ®µåªæœ‰ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹èƒ½æˆåŠŸï¼Œå…¶ä½™ç”¨æˆ·çº¿ç¨‹å¤±è´¥ã€‚<br><br>æ–¹æ¡ˆäºŒï¼š<br>ç¬¬ä¸€é˜¶æ®µï¼šå†»ç»“åº“å­˜ï¼Œå†»ç»“æˆåŠŸåˆ™è¿”å›æˆåŠŸã€‚<br>ç¬¬äºŒé˜¶æ®µï¼šæ‰§è¡Œä»ã€å†»ç»“åº“å­˜ã€å­—æ®µæ‰£å‡åº“å­˜çš„ sqlã€‚<br>ç¬¬ä¸‰é˜¶æ®µï¼šæäº¤äº‹åŠ¡ï¼›æˆ–å›æ»šäº‹åŠ¡ï¼Œå½’è¿˜å†»ç»“åº“å­˜åˆ°ä¸»åº“å­˜å­—æ®µã€‚<br>è¯¥ä¸ä¼šå‡ºç°æ–¹æ¡ˆä¸€çš„â€œå‡â€æˆåŠŸçš„æƒ…å†µï¼Œä½†æ˜¯å¼•å…¥äº†å½’è¿˜å†»ç»“åº“å­˜çš„æ“ä½œï¼Œéœ€è¦ä¿è¯å¼‚å¸¸æ—¶ï¼Œèƒ½æˆåŠŸå½’è¿˜å†»ç»™åº“å­˜ã€‚<br><br>æˆ–è€…è¿˜æœ‰å…¶ä»–çš„æ–¹æ¡ˆä¹ˆï¼Ÿè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1142335,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/3f/49e5079f.jpg","nickname":"æ¥ä¼½å±±äºº","note":"","ucode":"5859C06DAC790D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542645,"discussion_content":"æˆ‘çœ‹å¾ˆå¤šé—®é¢˜å¥½åƒéƒ½æ²¡æœ‰å›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640825195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291723,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1620449980,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620449980","product_id":100028001,"comment_content":"TM äº‹åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£èµ„æºçš„åˆ†é…åè°ƒç­‰ï¼ŒTM å­˜åœ¨å•ç‚¹é—®é¢˜ã€‚å¦‚æœéƒ¨ç½²å¤šå° TMï¼Œå¦‚ä¸€ä¸»å¤šä»ï¼Œè§£å†³äº†å•ç‚¹é—®é¢˜ï¼Œä½†æ˜¯åˆå¼•å…¥äº†å½“æ•°æ®åŒæ­¥ä¸åŠæ—¶ï¼Œä¸­é—´çŠ¶æ€æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼šTM master éœ€è¦é€šçŸ¥ 5 å° RMï¼Œåªé€šçŸ¥äº† 3 å° RMï¼Œæ­¤æ—¶ TM master å®•æœºï¼Œæ•°æ®æœªåŒæ­¥åˆ° TM slaveã€‚ä» slave é€‰ä¸¾æ–°çš„ masterï¼Œæ–° TM master å´ä¸çŸ¥é“å·²ç»é€šçŸ¥äº†å¤šå°‘ RMï¼Œæ— æ³•ç»§ç»­åç»­æ“ä½œã€‚<br><br>è€å¸ˆï¼Œè¯·é—®ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„åˆ†å¸ƒå¼æŠ€æœ¯æ–¹æ¡ˆä¸­ï¼Œå¦‚æœéœ€è¦äº‹åŠ¡åè°ƒè€…èŠ‚ç‚¹ï¼Œéƒ½ä¼šå­˜åœ¨ä¸Šè¿°é—®é¢˜ï¼šå•ç‚¹ï¼Œæˆ–å¤šèŠ‚ç‚¹æ•°æ®å»¶è¿Ÿå¯¼è‡´çŠ¶æ€ä¸¢å¤±é—®é¢˜ã€‚<br><br>è°¢è°¢è€å¸ˆï¼","like_count":0},{"had_liked":false,"id":270911,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1609316636,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609316636","product_id":100028001,"comment_content":"å¹¶ä¸”åœ¨äº‹åŠ¡ç®¡ç†å™¨å’Œèµ„æºç®¡ç†å™¨ä¸­éƒ½å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœåœ¨ç¬¬ä¸‰é˜¶æ®µï¼Œèµ„æºèŠ‚ç‚¹ä¸€ç›´æ— æ³•æ”¶åˆ°æ¥è‡ªèµ„æºç®¡ç†å™¨çš„æäº¤æˆ–å›æ»šè¯·æ±‚ï¼Œå®ƒå°±ä¼šåœ¨è¶…æ—¶ä¹‹åï¼Œç»§ç»­æäº¤äº‹åŠ¡ã€‚<br>æ²¡æ”¶åˆ°å°±ç»ªè¯·æ±‚è¿˜ç»§ç»­æäº¤é‚£ä¸æ˜¯å¾ˆå®¹æ˜“é€ æˆä¸ä¸€è‡´å—?","like_count":0},{"had_liked":false,"id":256740,"user_name":"torres","can_delete":false,"product_type":"c1","uid":1108761,"ip_address":"","ucode":"34DABCFC7B74EA","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/19/76b0b98c.jpg","comment_is_top":false,"comment_ctime":1603720820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603720820","product_id":100028001,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œå¯¹äºTCCæ¨¡å¼ï¼Œå¦‚æœæœ€åæäº¤é˜¶æ®µ TM æŒ‚æ‰äº†ï¼Œé‡å¯ä¹‹åï¼Œè¿˜ä¼šç»§ç»­è°ƒç”¨å„ä¸ªcomfirmæˆ–è€…cancelæ–¹æ³•å—ï¼Ÿ è¿™ç§æƒ…å†µè¿˜èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å—ï¼Ÿ<br><br>å¦å¤–ï¼ŒXAæ¨¡å¼ä¸ºä»€ä¹ˆä¸èƒ½è¿›è¡Œé‡è¯•æ¥ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿå¦‚æœTMç»™RMå‘é€commitæˆ–è€…rollbackæŒ‡ä»¤çš„æ—¶å€™ï¼Œæœ‰ç½‘ç»œé—®é¢˜ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥é€šè¿‡ç¨åé‡è¯•æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å“ˆï¼Ÿ  è¿™ä¸ªåœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹","like_count":0},{"had_liked":false,"id":253724,"user_name":"FuriousEric","can_delete":false,"product_type":"c1","uid":1138576,"ip_address":"","ucode":"0A66DA938976F7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/90/711efc88.jpg","comment_is_top":false,"comment_ctime":1602844239,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1602844239","product_id":100028001,"comment_content":"è€å¸ˆï¼Œèƒ½å¦è®²è®²æœ€åä½ ä»¬è¿™ä¸ªçº¿ä¸Šæ•…éšœæ€ä¹ˆè§£å†³çš„ï¼Ÿå…¨æ–‡éƒ½åœ¨ä»‹ç»åˆ†å¸ƒå¼æ–¹æ¡ˆï¼Œä½†æ˜¯å‰é¢æåˆ°çš„ä½ ä»¬é‡åˆ°çš„é—®é¢˜åˆæ²¡è¯´ç”¨å“ªç§è§£å†³æ–¹æ¡ˆï¼Œæ€ä¹ˆå®ç°çš„ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372794,"discussion_content":"è¯´ä¸å®šæ˜¯è™šæ‹Ÿçš„åœºæ™¯ï¼Œåªä¸ºå¼•å‡ºè¯é¢˜ã€‚\nã€Šæˆ‘çš„æœ‹å‹ç³»åˆ—ä¹‹åˆ†å¸ƒå¼äº‹åŠ¡ã€‹ğŸŒğŸŒ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620464582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248112,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1600012437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600012437","product_id":100028001,"comment_content":"è€å¸ˆ æ–‡ç« é‡Œçš„åˆ†å¸ƒå¼éƒ¨ç½²å›¾ ç¬¬ä¸€å¼ æ˜¯å•æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç¬¬äºŒå¼ æ˜¯tccé€‚ç”¨çš„å¤šä¸ªæœåŠ¡çš„é‚£ç§,æ˜¯è¿™æ ·å—?","like_count":0},{"had_liked":false,"id":232350,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1593963749,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593963749","product_id":100028001,"comment_content":"1.æœªæäº¤è¯»æ„Ÿè§‰æŒºå¤šåœºæ™¯éƒ½ä¸é€‚ç”¨ã€‚<br>2.seataå¦‚æœæ˜¯è¯»æäº¤çº§åˆ«ï¼Œé‚£ä¹ˆä¼šå› ä¸ºæœ‰å†™é”æ‹‹å¼‚å¸¸ã€‚è¿˜æ˜¯å®ç°äº†åˆ†å¸ƒå¼çš„mvccã€‚","like_count":0},{"had_liked":false,"id":225533,"user_name":"å°å¤©ç‹¼æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1055801,"ip_address":"","ucode":"555DFE4CF0A994","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/39/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1591780137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591780137","product_id":100028001,"comment_content":"æƒ³é—®ä¸‹ï¼Œseataåœ¨äº‹åŠ¡æäº¤æˆ–å›æ»šå‰ï¼Œå¯¹åº”çš„èµ„æºè¿˜æ˜¯è¦è¢«é”ä½çš„ï¼Œé‚£ç›¸å¯¹2PCæå‡çš„æ€§èƒ½åœ¨å“ªé‡Œå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":219005,"user_name":"f(x)","can_delete":false,"product_type":"c1","uid":1224568,"ip_address":"","ucode":"3680BBD50AFAE4","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/78/07d3e282.jpg","comment_is_top":false,"comment_ctime":1589932103,"is_pvip":false,"replies":[{"id":"82343","content":"æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1591101416,"ip_address":"","comment_id":219005,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589932103","product_id":100028001,"comment_content":"æ²¡å¤ªæ˜ç™½äº‹ç‰©ç®¡ç†å™¨å…·ä½“æ˜¯ä»€ä¹ˆï¼Œæ˜¯å•ç‹¬çš„æœåŠ¡è¿˜æ˜¯ä¸­é—´ä»¶ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495647,"discussion_content":"æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591101416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189077,"user_name":"Evan","can_delete":false,"product_type":"c1","uid":1344281,"ip_address":"","ucode":"B877ABD0CF4661","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/19/0a3fe8c1.jpg","comment_is_top":false,"comment_ctime":1584453757,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1584453757","product_id":100028001,"comment_content":"Saga äº‹åŠ¡æœ‰é‚£ä½åŒäº‹ä»‹ç»è¿‡ï¼Ÿ","like_count":0},{"had_liked":false,"id":181736,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1582625707,"is_pvip":false,"replies":[{"id":"70507","content":"ç»™ä½ è§£å†³é—®é¢˜èƒ½åŠ›ç‚¹ä¸ªèµ","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1582719427,"ip_address":"","comment_id":181736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582625707","product_id":100028001,"comment_content":"è€å¸ˆï¼Œæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œæ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œ å¦‚æœæ¢æˆspring-boot-parent 1.5.6 çš„å°±å¯ä»¥äº†ï¼Œæˆ‘çœ‹äº†æºç ï¼Œè‹±æ–‡Ispring-boot2.2.4 çš„å¼•å…¥çš„com.automikos çš„ç‰ˆæœ¬ä¸å¯¹ï¼Œæ˜¯4.0.6 çš„å¯¼è‡´çš„é—®é¢˜.","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485100,"discussion_content":"ç»™ä½ è§£å†³é—®é¢˜èƒ½åŠ›ç‚¹ä¸ªèµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582719427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176721,"user_name":"å¤§è±¡èš‚èš","can_delete":false,"product_type":"c1","uid":1255382,"ip_address":"","ucode":"0066D9CD979C39","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/d6/30456009.jpg","comment_is_top":false,"comment_ctime":1581150069,"is_pvip":false,"replies":[{"id":"69014","content":"æˆ‘ä»¬ä¹Ÿè®¡åˆ’åœ¨éƒ¨åˆ†ç”Ÿäº§ä¸šåŠ¡ä¸­ä½¿ç”¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1581506871,"ip_address":"","comment_id":176721,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1581150069","product_id":100028001,"comment_content":"æˆ‘å¸åˆ†å¸ƒåˆ†å¸ƒç³»ç»Ÿé¢ä¸´åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜,ä¹Ÿæ˜¯æ‰“ç®—ä½¿ç”¨TCCæ¥è§£å†³ï¼Œçœ‹äº†è€å¸ˆæåˆ°é˜¿é‡Œå¼€æºçš„Seataï¼Œæœ‰å¿…è¦è¯•ä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483190,"discussion_content":"æˆ‘ä»¬ä¹Ÿè®¡åˆ’åœ¨éƒ¨åˆ†ç”Ÿäº§ä¸šåŠ¡ä¸­ä½¿ç”¨äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581506871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145853,"user_name":"å¤©æ¶¯xj","can_delete":false,"product_type":"c1","uid":1312059,"ip_address":"","ucode":"55FC1FE3B30A70","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/3b/590ae4ea.jpg","comment_is_top":false,"comment_ctime":1572395352,"is_pvip":false,"replies":[{"id":"56516","content":"é€‚ç”¨ï¼Œä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡å„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1572518554,"ip_address":"","comment_id":145853,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572395352","product_id":100028001,"comment_content":"ä¸ºä»€ä¹ˆJTAä¸èƒ½é€‚åˆå•ä¸€æ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472600,"discussion_content":"é€‚ç”¨ï¼Œä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡å„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572518554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135367,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1569139751,"is_pvip":false,"replies":[{"id":"52260","content":"æ˜¯çš„ï¼Œseataçš„RMæå‡åˆ°äº†æœåŠ¡å±‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1569415803,"ip_address":"","comment_id":135367,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1569139751","product_id":100028001,"comment_content":"TCC ä¹Ÿæ˜¯åŸºäºäºŒé˜¶äº‹åŠ¡æäº¤åŸç†å®ç°çš„ï¼Œä½† TCC çš„äºŒé˜¶äº‹åŠ¡æäº¤æ˜¯æåˆ°äº†æœåŠ¡å±‚å®ç°ã€‚<br>Seataå°†RMä¹Ÿæå‡åˆ°äº†æœåŠ¡å±‚å®ç°ã€‚<br>--------è€å¸ˆï¼Œè¿™ä¸¤ç§æœåŠ¡å±‚å®ç°ï¼Œåº”è¯¥ä¸æ˜¯ä¸€å›äº‹å§<br>","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468158,"discussion_content":"æ˜¯çš„ï¼Œseataçš„RMæå‡åˆ°äº†æœåŠ¡å±‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569415803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134399,"user_name":"Gred","can_delete":false,"product_type":"c1","uid":1442929,"ip_address":"","ucode":"F68068880E348B","user_header":"https://static001.geekbang.org/account/avatar/00/16/04/71/853b2292.jpg","comment_is_top":false,"comment_ctime":1568819180,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568819180","product_id":100028001,"comment_content":"æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆSeaTacä¸ä¼šäº§ç”Ÿè„æ•°æ®ï¼Œç¬¬ä¸€ç‚¹å› ä¸ºå…¨å±€æ’å®ƒé”ï¼Œå…¨å±€æ’å®ƒé”çš„ç»“æ„æ˜¯ã€resourceId + table + pksã€‘ï¼Œç²¾ç¡®åˆ°æŸä¸ªèµ„æºæŸå¼ è¡¨çš„æŸä¸ªæ¡æ•°æ®ã€‚ç¬¬äºŒç‚¹ï¼Œå¦‚æœAäº‹åŠ¡å¯¹äºã€Select * from table where id = pks for updateã€‘æ•°æ®æ‰§è¡Œå¤±è´¥ï¼Œä¸”æœªå›æ»šã€resourceId+table+pkã€‘ï¼Œè¿™æ—¶å…¨å±€é”å°šæœªé‡Šæ”¾ã€‚Bäº‹åŠ¡ç”³è¯·ç›¸åŒèµ„æºçš„å…¨å±€é”ä¼šå¤±è´¥ã€‚è¯¥æ¡æ•°æ®åªèƒ½çœ‹ä¸èƒ½å¤„ç†ï¼Œä¹Ÿè¯´ä¸ä¸Šäº§ç”Ÿè„æ•°æ®äº†ã€‚","like_count":0},{"had_liked":false,"id":130829,"user_name":"å†ç»­å•¸å‚²","can_delete":false,"product_type":"c1","uid":1360184,"ip_address":"","ucode":"912987A17DCA92","user_header":"https://static001.geekbang.org/account/avatar/00/14/c1/38/e45bbb6b.jpg","comment_is_top":false,"comment_ctime":1567557864,"is_pvip":false,"replies":[{"id":"49126","content":"å¯¹çš„ï¼Œå·²ä¿®æ­£","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1567596111,"ip_address":"","comment_id":130829,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567557864","product_id":100028001,"comment_content":"æ–‡ä¸­â€œå¦‚æœ RM å†³è®®è¦å…¨å±€å›æ»šï¼Œä¼šé€šçŸ¥ RM è¿›è¡Œå›æ»šæ“ä½œâ€ï¼ŒæŒ‰ç…§å­¦ä¹ åçš„ç†è§£ï¼Œåº”è¯¥æ˜¯TCå†³å®šæ˜¯å¦è¦è¿›è¡Œå…¨å±€å›æ»šï¼Œä¸çŸ¥é“æˆ‘ç†è§£çš„æ˜¯å¦æœ‰åå·®ï¼Œå¿˜è€å¸ˆæŒ‡æ­£","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466144,"discussion_content":"å¯¹çš„ï¼Œå·²ä¿®æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567596111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130763,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1567528300,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567528300","product_id":100028001,"comment_content":"1.ç¬¬ä¸€æ¬¡å¬åˆ°TCC,æ„Ÿè§‰ä¹Ÿæ˜¯ä¸¤é˜¶æ®µæäº¤çš„æ€æƒ³ï¼Œåªæ˜¯æŠŠè¯¢é—®å˜æˆtryæ“ä½œã€‚<br>2.è‡³äºè¡¥å¿ï¼Œæ„Ÿè§‰mqçš„æ–¹å¼æ›´åƒæ˜¯åœ¨è¡¥å¿ã€‚ï¼ˆåœ¨è¿™é‡Œï¼Œå› ä¸ºmqæ˜¯æœ€ç»ˆä¸€è‡´æ‰€ä»¥ä¸ªäººè§‰å¾—æ›´åƒè¡¥å¿ï¼‰<br>3.åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶è¿˜æœ‰ä¸ªlcnï¼Œäº‹åŠ¡çš„æ¬è¿å·¥ã€‚","like_count":0},{"had_liked":false,"id":130005,"user_name":"N","can_delete":false,"product_type":"c1","uid":1133657,"ip_address":"","ucode":"3791619172D64F","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/59/c75cb36d.jpg","comment_is_top":false,"comment_ctime":1567350016,"is_pvip":false,"replies":[{"id":"48615","content":"å¯ä»¥çš„ï¼ŒSeataä¸­æœ‰ä¸ªåŸºäºdubboå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¾‹å­ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±å‚è€ƒæ‰‹åŠ¨å®è·µä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1567424723,"ip_address":"","comment_id":130005,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567350016","product_id":100028001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå¾®æœåŠ¡é—´åœ¨äº‹åŠ¡ä¸­é€šè¿‡dubboè°ƒç”¨çš„æ–¹å¼æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465759,"discussion_content":"å¯ä»¥çš„ï¼ŒSeataä¸­æœ‰ä¸ªåŸºäºdubboå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¾‹å­ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±å‚è€ƒæ‰‹åŠ¨å®è·µä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567424723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128478,"user_name":"æ™“æ°","can_delete":false,"product_type":"c1","uid":1441546,"ip_address":"","ucode":"1174C88EEBF8A6","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg","comment_is_top":false,"comment_ctime":1566886350,"is_pvip":false,"replies":[{"id":"47768","content":"é»˜è®¤æƒ…å†µä¸‹ï¼Œseataè®¤ä¸ºå¤§å¤šæ•°åˆ†å¸ƒå¼ä¸šåŠ¡æ¶‰åŠåˆ°è„è¯»çš„å¯èƒ½æ€§æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¿è¯äº†å¤§å¤šæ•°åœºæ™¯ä¸‹çš„é«˜æ•ˆæ€§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566956521,"ip_address":"","comment_id":128478,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566886350","product_id":100028001,"comment_content":"å…¨å±€å†™é”ï¼Œå¦‚æœçº¿ç¨‹è¿˜æ²¡æœ‰æäº¤æˆ–è€…å›æ»šäº‹åŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”<br>è€å¸ˆï¼Œé»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯è¯»æœªæäº¤ï¼Œä¸æ˜¯ä¼šå‘ç”Ÿè„è¯»å—ï¼Œè¿™é‡Œæ˜¯ä¸æ˜¯æœ‰é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464966,"discussion_content":"é»˜è®¤æƒ…å†µä¸‹ï¼Œseataè®¤ä¸ºå¤§å¤šæ•°åˆ†å¸ƒå¼ä¸šåŠ¡æ¶‰åŠåˆ°è„è¯»çš„å¯èƒ½æ€§æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¿è¯äº†å¤§å¤šæ•°åœºæ™¯ä¸‹çš„é«˜æ•ˆæ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566956521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128468,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1566884552,"is_pvip":false,"replies":[{"id":"48191","content":"å¯ä»¥è€ƒè™‘åŠ é¤","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1567130648,"ip_address":"","comment_id":128468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566884552","product_id":100028001,"comment_content":"è€å¸ˆï¼Œä¼šè®²Paxosç®—æ³•ä¹ˆï¼Œé¢è¯•ç»å¸¸ä¼šé—®é“","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464959,"discussion_content":"å¯ä»¥è€ƒè™‘åŠ é¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567130648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128462,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1566883840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566883840","product_id":100028001,"comment_content":"è€å¸ˆæ˜¯å…¨èƒ½ï¼","like_count":0},{"had_liked":false,"id":128371,"user_name":"æ‹’ç»","can_delete":false,"product_type":"c1","uid":1335155,"ip_address":"","ucode":"CB0264C4D3FE17","user_header":"https://static001.geekbang.org/account/avatar/00/14/5f/73/bb3dc468.jpg","comment_is_top":false,"comment_ctime":1566875902,"is_pvip":false,"replies":[{"id":"47773","content":"è¿™å¥è¯åœ¨å“ªçœ‹åˆ°çš„å‘¢ï¼Œæ²¡æœ‰å¤ªç†è§£ã€‚seataæ˜¯æ ¹æ®ä¸€ä¸ªå…¨å±€äº‹åŠ¡IDè¿›è¡Œä¸Šä¸‹æ–‡ä¼ æ’­çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566956868,"ip_address":"","comment_id":128371,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566875902","product_id":100028001,"comment_content":"seataä¸€é˜¶æ®µæäº¤æ‹¿ å…¨å±€é” å°è¯•è¢«é™åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œè¶…å‡ºèŒƒå›´å°†æ”¾å¼ƒï¼Œå¹¶å›æ»šæœ¬åœ°äº‹åŠ¡ï¼Œé‡Šæ”¾æœ¬åœ°é”ã€‚<br>è¿™å¥è¯ä¸ç†è§£ï¼Œéº»çƒ¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464925,"discussion_content":"è¿™å¥è¯åœ¨å“ªçœ‹åˆ°çš„å‘¢ï¼Œæ²¡æœ‰å¤ªç†è§£ã€‚seataæ˜¯æ ¹æ®ä¸€ä¸ªå…¨å±€äº‹åŠ¡IDè¿›è¡Œä¸Šä¸‹æ–‡ä¼ æ’­çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566956868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1335155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/5f/73/bb3dc468.jpg","nickname":"æ‹’ç»","note":"","ucode":"CB0264C4D3FE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6709,"discussion_content":"åœ¨seataçš„githubä¸Šçœ‹åˆ°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567064758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128356,"user_name":"LW","can_delete":false,"product_type":"c1","uid":1325297,"ip_address":"","ucode":"89820332658E98","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/f1/996a070d.jpg","comment_is_top":false,"comment_ctime":1566873821,"is_pvip":false,"replies":[{"id":"47774","content":"å¯¹çš„ï¼Œèµ","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566956891,"ip_address":"","comment_id":128356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566873821","product_id":100028001,"comment_content":"æ€è€ƒé¢˜ï¼šå…¨å±€äº‹åŠ¡IDï¼Œåº”è¯¥æ˜¯å‚ç…§æ•°æ®åº“çš„äº‹åŠ¡IDæ¥å®ç°ä¸€è‡´æ€§çš„å§","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464917,"discussion_content":"å¯¹çš„ï¼Œèµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566956891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128245,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1566865616,"is_pvip":false,"replies":[{"id":"47779","content":"å·®ä¸å¤šï¼Œç”±äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„å…¨å±€å†™æ’ä»–é”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„å†™éš”ç¦»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…","uid":"1228576","ctime":1566957159,"ip_address":"","comment_id":128245,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566865616","product_id":100028001,"comment_content":"é€šè¿‡æŸ¥è¯¢æœªæäº¤è¯»çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1228576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/20/19d42715.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"CD56F93596E818","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464863,"discussion_content":"å·®ä¸å¤šï¼Œç”±äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„å…¨å±€å†™æ’ä»–é”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„å†™éš”ç¦»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566957159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1186115,"avatar":"https://static001.geekbang.org/account/avatar/00/12/19/43/226ca347.jpg","nickname":"Michael ğŸ›¡YZY","note":"","ucode":"F1D2BF8489A7D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":44184,"discussion_content":"è¿™ç§å…¨å±€é”æœ‰æ²¡æœ‰ç›¸åº”çš„æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿè¿˜æ˜¯å¯ä»¥å¿½ç•¥ ä¸ªäººå¯¹æ•°æ®åº“é”è¿™æ–¹é¢è¿˜éœ€è¦åå¤æ¶ˆåŒ–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572938918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}