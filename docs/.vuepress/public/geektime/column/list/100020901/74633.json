{"id":74633,"title":"16 | 基础篇：怎么理解内存中的Buffer和Cache？","content":"<p>你好，我是倪朋飞。</p><p>上一节，我们梳理了 Linux 内存管理的基本原理，并学会了用 free 和 top 等工具，来查看系统和进程的内存使用情况。</p><p>内存和  CPU  的关系非常紧密，而内存管理本身也是很复杂的机制，所以感觉知识很硬核、很难啃，都是正常的。但还是那句话，初学时不用非得理解所有内容，继续往后学，多理解相关的概念并配合一定的实践之后，再回头复习往往会容易不少。当然，基本功不容放弃。</p><p>在今天的内容开始之前，我们先来回顾一下系统的内存使用情况，比如下面这个 free 输出界面：</p><pre><code># 注意不同版本的free输出可能会有所不同\n$ free\n              total        used        free      shared  buff/cache   available\nMem:        8169348      263524     6875352         668     1030472     7611064\nSwap:             0           0           0\n</code></pre><p>显然，这个界面包含了物理内存Mem和交换分区Swap的具体使用情况，比如总内存、已用内存、缓存、可用内存等。其中缓存是 Buffer和Cache两部分的总和 。</p><p>这里的大部分指标都比较容易理解，但 Buffer和 Cache可能不太好区分。从字面上来说，Buffer是缓冲区，而Cache是缓存，两者都是数据在内存中的临时存储。那么，你知道这两种“临时存储”有什么区别吗？</p><p>注：今天内容接下来的部分，Buffer和Cache我会都用英文来表示，避免跟文中的“缓存”一词混淆。而文中的“缓存”，则通指内存中的临时存储。</p><h2>free数据的来源</h2><!-- [[[read_end]]] --><p>在我正式讲解两个概念前，你可以先想想，你有没有什么途径来进一步了解它们？除了中文翻译直接得到概念，别忘了，Buffer和Cache还是我们用free获得的指标。</p><p>还记得我之前讲过的，碰到看不明白的指标时该怎么办吗？</p><p>估计你想起来了，不懂就去查手册。用 man 命令查询 free 的文档，就可以找到对应指标的详细说明。比如，我们执行 man free  ，就可以看到下面这个界面。</p><pre><code>buffers\n              Memory used by kernel buffers (Buffers in /proc/meminfo)\n\n       cache  Memory used by the page cache and slabs (Cached and SReclaimable in /proc/meminfo)\n\n       buff/cache\n              Sum of buffers and cache\n</code></pre><p>从free的手册中，你可以看到 buffer 和 cache 的说明。</p><ul>\n<li>\n<p>Buffers 是内核缓冲区用到的内存，对应的是  <code>/proc/meminfo</code> 中的 Buffers 值。</p>\n</li>\n<li>\n<p>Cache 是内核页缓存和Slab用到的内存，对应的是  <code>/proc/meminfo</code> 中的 Cached 与 SReclaimable 之和。</p>\n</li>\n</ul><p>这里的说明告诉我们，这些数值都来自 <code>/proc/meminfo</code>，但更具体的 Buffers、Cached和SReclaimable 的含义，还是没有说清楚。</p><p>要弄明白它们到底是什么，我估计你第一反应就是去百度或者 Google一下。虽然大部分情况下，网络搜索能给出一个答案。但是，且不说筛选信息花费的时间精力，对你来说，这个答案的准确性也是很难保证的。</p><p>要注意，网上的结论可能是对的，但是很可能跟你的环境并不匹配。最简单来说，同一个指标的具体含义，就可能因为内核版本、性能工具版本的不同而有挺大差别。这也是为什么，我总在专栏中强调通用思路和方法，而不是让你死记结论。对于案例实践来说，机器环境就是我们的最大限制。</p><p>那么，有没有更简单、更准确的方法，来查询它们的含义呢？</p><h2>proc文件系统</h2><p>我在前面 CPU 性能模块就曾经提到过，/proc 是 Linux 内核提供的一种特殊文件系统，是用户跟内核交互的接口。比方说，用户可以从 /proc 中查询内核的运行状态和配置选项，查询进程的运行状态、统计数据等，当然，你也可以通过 /proc  来修改内核的配置。</p><p>proc 文件系统同时也是很多性能工具的最终数据来源。比如我们刚才看到的 free ，就是通过读取<code>/proc/meminfo</code>，得到内存的使用情况。</p><p>继续说回<code>/proc/meminfo</code>，既然 Buffers、Cached、SReclaimable 这几个指标不容易理解，那我们还得继续查 proc 文件系统，获取它们的详细定义。</p><p>执行 <code>man proc</code>，你就可以得到 proc 文件系统的详细文档。</p><p>注意这个文档比较长，你最好搜索一下（比如搜索 meminfo），以便更快定位到内存部分。</p><pre><code>Buffers %lu\n    Relatively temporary storage for raw disk blocks that shouldn't get tremendously large (20MB or so).\n\nCached %lu\n   In-memory cache for files read from the disk (the page cache).  Doesn't include SwapCached.\n...\nSReclaimable %lu (since Linux 2.6.19)\n    Part of Slab, that might be reclaimed, such as caches.\n    \nSUnreclaim %lu (since Linux 2.6.19)\n    Part of Slab, that cannot be reclaimed on memory pressure.\n</code></pre><p>通过这个文档，我们可以看到：</p><ul>\n<li>\n<p>Buffers 是对原始磁盘块的临时存储，也就是用来<strong>缓存磁盘的数据</strong>，通常不会特别大（20MB左右）。这样，内核就可以把分散的写集中起来，统一优化磁盘的写入，比如可以把多次小的写合并成单次大的写等等。</p>\n</li>\n<li>\n<p>Cached 是从磁盘读取文件的页缓存，也就是用来<strong>缓存从文件读取的数据</strong>。这样，下次访问这些文件数据时，就可以直接从内存中快速获取，而不需要再次访问缓慢的磁盘。</p>\n</li>\n<li>\n<p>SReclaimable 是 Slab 的一部分。Slab包括两部分，其中的可回收部分，用 SReclaimable 记录；而不可回收部分，用 SUnreclaim 记录。</p>\n</li>\n</ul><p>好了，我们终于找到了这三个指标的详细定义。到这里，你是不是长舒一口气，满意地想着，总算弄明白Buffer 和 Cache了。不过，知道这个定义就真的理解了吗？这里我给你提了两个问题，你先想想能不能回答出来。</p><p>第一个问题，Buffer 的文档没有提到这是磁盘读数据还是写数据的缓存，而在很多网络搜索的结果中都会提到 Buffer 只是对<strong>将要写入磁盘数据</strong>的缓存。那反过来说，它会不会也缓存从磁盘中读取的数据呢？</p><p>第二个问题，文档中提到，Cache 是对从文件读取数据的缓存，那么它是不是也会缓存写文件的数据呢？</p><p>为了解答这两个问题，接下来，我将用几个案例来展示， Buffer 和 Cache 在不同场景下的使用情况。</p><h2>案例</h2><h3>你的准备</h3><p>跟前面实验一样，今天的案例也是基于 Ubuntu 18.04，当然，其他 Linux 系统也适用。我的案例环境是这样的。</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存。</p>\n</li>\n<li>\n<p>预先安装 sysstat 包，如 apt install sysstat。</p>\n</li>\n</ul><p>之所以要安装 sysstat  ，是因为我们要用到 vmstat  ，来观察 Buffer 和 Cache 的变化情况。虽然从 /proc/meminfo 里也可以读到相同的结果，但毕竟还是  vmstat  的结果更加直观。</p><p>另外，这几个案例使用了 dd 来模拟磁盘和文件的 I/O，所以我们也需要观测 I/O 的变化情况。</p><p>上面的工具安装完成后，你可以打开两个终端，连接到 Ubuntu 机器上。</p><p>准备环节的最后一步，为了减少缓存的影响，记得在第一个终端中，运行下面的命令来清理系统缓存：</p><pre><code># 清理文件页、目录项、Inodes等各种缓存\n$ echo 3 &gt; /proc/sys/vm/drop_caches\n</code></pre><p>这里的 <code>/proc/sys/vm/drop_caches</code> ，就是通过 proc 文件系统修改内核行为的一个示例，写入 3 表示清理文件页、目录项、Inodes等各种缓存。这几种缓存的区别你暂时不用管，后面我们都会讲到。</p><h3>场景1：磁盘和文件写案例</h3><p>我们先来模拟第一个场景。首先，在第一个终端，运行下面这个vmstat 命令：</p><pre><code># 每隔1秒输出1组数据\n$ vmstat 1\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n0  0      0 7743608   1112  92168    0    0     0     0   52  152  0  1 100  0  0\n 0  0      0 7743608   1112  92168    0    0     0     0   36   92  0  0 100  0  0\n</code></pre><p>输出界面里， 内存部分的 buff 和 cache ，以及 io 部分的 bi 和 bo 就是我们要关注的重点。</p><ul>\n<li>\n<p>buff 和 cache 就是我们前面看到的 Buffers 和 Cache，单位是 KB。</p>\n</li>\n<li>\n<p>bi 和 bo 则分别表示块设备读取和写入的大小，单位为块/秒。因为 Linux 中块的大小是 1KB，所以这个单位也就等价于 KB/s。</p>\n</li>\n</ul><p>正常情况下，空闲系统中，你应该看到的是，这几个值在多次结果中一直保持不变。</p><p>接下来，到第二个终端执行 dd 命令，通过读取随机设备，生成一个500MB大小的文件：</p><pre><code>$ dd if=/dev/urandom of=/tmp/file bs=1M count=500\n</code></pre><p>然后再回到第一个终端，观察Buffer和Cache的变化情况：</p><pre><code>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n0  0      0 7499460   1344 230484    0    0     0     0   29  145  0  0 100  0  0\n 1  0      0 7338088   1752 390512    0    0   488     0   39  558  0 47 53  0  0\n 1  0      0 7158872   1752 568800    0    0     0     4   30  376  1 50 49  0  0\n 1  0      0 6980308   1752 747860    0    0     0     0   24  360  0 50 50  0  0\n 0  0      0 6977448   1752 752072    0    0     0     0   29  138  0  0 100  0  0\n 0  0      0 6977440   1760 752080    0    0     0   152   42  212  0  1 99  1  0\n...\n 0  1      0 6977216   1768 752104    0    0     4 122880   33  234  0  1 51 49  0\n 0  1      0 6977440   1768 752108    0    0     0 10240   38  196  0  0 50 50  0\n</code></pre><p>通过观察 vmstat 的输出，我们发现，在dd命令运行时， Cache在不停地增长，而Buffer基本保持不变。</p><p>再进一步观察I/O的情况，你会看到，</p><ul>\n<li>\n<p>在 Cache 刚开始增长时，块设备 I/O 很少，bi 只出现了一次 488 KB/s，bo 则只有一次 4KB。而过一段时间后，才会出现大量的块设备写，比如 bo 变成了122880。</p>\n</li>\n<li>\n<p>当 dd 命令结束后，Cache 不再增长，但块设备写还会持续一段时间，并且，多次 I/O 写的结果加起来，才是 dd 要写的 500M 的数据。</p>\n</li>\n</ul><p>把这个结果，跟我们刚刚了解到的Cache的定义做个对比，你可能会有点晕乎。为什么前面文档上说 Cache 是文件读的页缓存，怎么现在写文件也有它的份？</p><p>这个疑问，我们暂且先记下来，接着再来看另一个磁盘写的案例。两个案例结束后，我们再统一进行分析。</p><p>不过，对于接下来的案例，我必须强调一点：</p><p>下面的命令对环境要求很高，需要你的系统配置多块磁盘，并且磁盘分区 /dev/sdb1 还要处于未使用状态。如果你只有一块磁盘，千万不要尝试，否则将会对你的磁盘分区造成损坏。</p><p>如果你的系统符合标准，就可以继续在第二个终端中，运行下面的命令。清理缓存后，向磁盘分区/dev/sdb1  写入2GB的随机数据：</p><pre><code># 首先清理缓存\n$ echo 3 &gt; /proc/sys/vm/drop_caches\n# 然后运行dd命令向磁盘分区/dev/sdb1写入2G数据\n$ dd if=/dev/urandom of=/dev/sdb1 bs=1M count=2048\n</code></pre><p>然后，再回到终端一，观察内存和I/O的变化情况：</p><pre><code>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n1  0      0 7584780 153592  97436    0    0   684     0   31  423  1 48 50  2  0\n 1  0      0 7418580 315384 101668    0    0     0     0   32  144  0 50 50  0  0\n 1  0      0 7253664 475844 106208    0    0     0     0   20  137  0 50 50  0  0\n 1  0      0 7093352 631800 110520    0    0     0     0   23  223  0 50 50  0  0\n 1  1      0 6930056 790520 114980    0    0     0 12804   23  168  0 50 42  9  0\n 1  0      0 6757204 949240 119396    0    0     0 183804   24  191  0 53 26 21  0\n 1  1      0 6591516 1107960 123840    0    0     0 77316   22  232  0 52 16 33  0\n</code></pre><p>从这里你会看到，虽然同是写数据，写磁盘跟写文件的现象还是不同的。写磁盘时（也就是bo大于  0 时），Buffer和Cache都在增长，但显然Buffer的增长快得多。</p><p>这说明，写磁盘用到了大量的Buffer，这跟我们在文档中查到的定义是一样的。</p><p>对比两个案例，我们发现，写文件时会用到 Cache 缓存数据，而写磁盘则会用到 Buffer 来缓存数据。所以，回到刚刚的问题，虽然文档上只提到，Cache是文件读的缓存，但实际上，Cache也会缓存写文件时的数据。</p><h3>场景2：磁盘和文件读案例</h3><p>了解了磁盘和文件写的情况，我们再反过来想，磁盘和文件读的时候，又是怎样的呢？</p><p>我们回到第二个终端，运行下面的命令。清理缓存后，从文件/tmp/file中，读取数据写入空设备：</p><pre><code># 首先清理缓存\n$ echo 3 &gt; /proc/sys/vm/drop_caches\n# 运行dd命令读取文件数据\n$ dd if=/tmp/file of=/dev/null\n</code></pre><p>然后，再回到终端一，观察内存和I/O的变化情况：</p><pre><code>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 0  1      0 7724164   2380 110844    0    0 16576     0   62  360  2  2 76 21  0\n 0  1      0 7691544   2380 143472    0    0 32640     0   46  439  1  3 50 46  0\n 0  1      0 7658736   2380 176204    0    0 32640     0   54  407  1  4 50 46  0\n 0  1      0 7626052   2380 208908    0    0 32640    40   44  422  2  2 50 46  0\n</code></pre><p>观察 vmstat 的输出，你会发现读取文件时（也就是bi大于0时），Buffer保持不变，而Cache则在不停增长。这跟我们查到的定义“Cache是对文件读的页缓存”是一致的。</p><p>那么，磁盘读又是什么情况呢？我们再运行第二个案例来看看。</p><p>首先，回到第二个终端，运行下面的命令。清理缓存后，从磁盘分区 /dev/sda1中读取数据，写入空设备：</p><pre><code># 首先清理缓存\n$ echo 3 &gt; /proc/sys/vm/drop_caches\n# 运行dd命令读取文件\n$ dd if=/dev/sda1 of=/dev/null bs=1M count=1024\n</code></pre><p>然后，再回到终端一，观察内存和I/O的变化情况：</p><pre><code>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n0  0      0 7225880   2716 608184    0    0     0     0   48  159  0  0 100  0  0\n 0  1      0 7199420  28644 608228    0    0 25928     0   60  252  0  1 65 35  0\n 0  1      0 7167092  60900 608312    0    0 32256     0   54  269  0  1 50 49  0\n 0  1      0 7134416  93572 608376    0    0 32672     0   53  253  0  0 51 49  0\n 0  1      0 7101484 126320 608480    0    0 32748     0   80  414  0  1 50 49  0\n</code></pre><p>观察 vmstat 的输出，你会发现读磁盘时（也就是bi大于0时），Buffer和Cache都在增长，但显然Buffer的增长快很多。这说明读磁盘时，数据缓存到了 Buffer 中。</p><p>当然，我想，经过上一个场景中两个案例的分析，你自己也可以对比得出这个结论：读文件时数据会缓存到 Cache 中，而读磁盘时数据会缓存到 Buffer 中。</p><p>到这里你应该发现了，虽然文档提供了对Buffer和Cache的说明，但是仍不能覆盖到所有的细节。比如说，今天我们了解到的这两点：</p><ul>\n<li>\n<p>Buffer既可以用作“将要写入磁盘数据的缓存”，也可以用作“从磁盘读取数据的缓存”。</p>\n</li>\n<li>\n<p>Cache既可以用作“从文件读取数据的页缓存”，也可以用作“写文件的页缓存”。</p>\n</li>\n</ul><p>这样，我们就回答了案例开始前的两个问题。</p><p>简单来说，<strong>Buffer是对磁盘数据的缓存，而Cache是文件数据的缓存，它们既会用在读请求中，也会用在写请求中</strong>。</p><h2>小结</h2><p>今天，我们一起探索了内存性能中 Buffer 和 Cache 的详细含义。Buffer和Cache分别缓存磁盘和文件系统的读写数据。</p><ul>\n<li>\n<p>从写的角度来说，不仅可以优化磁盘和文件的写入，对应用程序也有好处，应用程序可以在数据真正落盘前，就返回去做其他工作。</p>\n</li>\n<li>\n<p>从读的角度来说，既可以加速读取那些需要频繁访问的数据，也降低了频繁I/O对磁盘的压力。</p>\n</li>\n</ul><p>除了探索的内容本身，这个探索过程对你应该也有所启发。在排查性能问题时，由于各种资源的性能指标太多，我们不可能记住所有指标的详细含义。那么，准确高效的手段——查文档，就非常重要了。</p><p>你一定要养成查文档的习惯，并学会解读这些性能指标的详细含义。此外，proc 文件系统也是我们的好帮手。它为我们呈现了系统内部的运行状态，同时也是很多性能工具的数据来源，是辅助排查性能问题的好方法。</p><h2>思考</h2><p>最后，我想给你留一个思考题。</p><p>我们已经知道，可以使用 ps、top 或者 proc 文件系统，来获取进程的内存使用情况。那么，如何统计出所有进程的物理内存使用量呢？</p><p>提示：要避免重复计算多个进程同时占用的内存，像是页缓存、共享内存这类。如果你把 ps、top 得到的数据直接相加，就会出现重复计算的问题。</p><p>这里，我推荐从 <code>/proc/&lt;pid&gt;/smaps</code>  入手。前面内容里，我并没有直接讲过<code>/proc/&lt;pid&gt;/smaps</code>文件中各个指标含义，所以，需要你自己动手查 proc 文件系统的文档，解读并回答这个问题。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p>","neighbors":{"left":{"article_title":"15 | 基础篇：Linux内存是怎么工作的？","id":74272},"right":{"article_title":"17 | 案例篇：如何利用系统缓存优化程序的运行效率？","id":75242}},"comments":[{"had_liked":false,"id":54029,"user_name":"倪朋飞","can_delete":false,"product_type":"c1","uid":1001282,"ip_address":"","ucode":"F0FAC195CDE7AC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","comment_is_top":true,"comment_ctime":1545787678,"is_pvip":false,"discussion_count":18,"race_medal":0,"score":"9.2233737649773998e+18","product_id":100020901,"comment_content":"关于磁盘和文件的区别，本来以为大家都懂了，所以没有细讲。磁盘是一个块设备，可以划分为不同的分区；在分区之上再创建文件系统，挂载到某个目录，之后才可以在这个目录中读写文件。<br><br>其实 Linux 中“一切皆文件”，而文章中提到的“文件”是普通文件，磁盘是块设备文件，这些大家可以执行 &quot;ls -l &lt;路径&gt;&quot; 查看它们的区别（输出的含义如果不懂请 man ls 查询）。<br><br>在读写普通文件时，会经过文件系统，由文件系统负责与磁盘交互；而读写磁盘或者分区时，就会跳过文件系统，也就是所谓的“裸I&#47;O“。这两种读写方式所使用的缓存是不同的，也就是文中所讲的 Cache 和 Buffer 区别。<br><br>关于文件系统、磁盘以及 I&#47;O 的原理，大家不要着急，后面 I&#47;O 模块还会讲的。","like_count":403,"discussions":[{"author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239508,"discussion_content":"请教一下：一般理解下，文件通过文件系统存放在磁盘上，按照课程中的解释，buffer是针对磁盘的读写缓存，cache是针对文件的读写缓存，那么读写文件都会最终落到磁盘上，也就是说buffer始终是会有的，什么情况下只有cache没有buffer？什么情况下只有buffer没有cache？","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1587302067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1878120,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJpJXWFP3dNle88WnTkRTsEQkPJmOhepibiaTfhEtMRrbdg5EAWm4EzurA61oKxvCK2ZjMmy1QvmChw/132","nickname":"唐江","note":"","ucode":"867C9808CF7760","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359698,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616251980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239508,"ip_address":""},"score":359698,"extra":""},{"author":{"id":1047114,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/4a/23f480f5.jpg","nickname":"海一剑","note":"","ucode":"8F18D06C631EA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386814,"discussion_content":"这个问题怎么一直没有回答的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627815224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239508,"ip_address":""},"score":386814,"extra":""},{"author":{"id":2379572,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/zWLzhGrHubcMJnNFz0s0akeMpefNBVy2jic3rxetxHIjy1icPjJBXFQc78AW10icVN47BLrWicHcSm9MOfG38J2kKw/132","nickname":"Geek_278a2c","note":"","ucode":"7EC0366896F0E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560046,"discussion_content":"实际还在cache里，没有sync，也就没有写入磁盘，buffer也就不会升高。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1649144056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239508,"ip_address":""},"score":560046,"extra":""}]},{"author":{"id":1729060,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/62/24/07e2507c.jpg","nickname":"托尼斯威特","note":"","ucode":"98A1035527292E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301681,"discussion_content":"能不能举个例子，比如用c++，哪些系统调用是文件读写，哪些系统调用是磁盘读写？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598606855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294568,"discussion_content":"正准备提问呢，老师给解答了，赞赞赞","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1595929623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2587479,"avatar":"https://static001.geekbang.org/account/avatar/00/27/7b/57/e9b3d886.jpg","nickname":"阿昌","note":"","ucode":"C7AF1905B72AD3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587237,"discussion_content":"每次都叫我们不要着急，到讲的时候，还是没讲清楚。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662898394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1421242,"avatar":"https://static001.geekbang.org/account/avatar/00/15/af/ba/62fac9e1.jpg","nickname":"羽曦","note":"","ucode":"9767ECB4F8F201","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566343,"discussion_content":"磁盘是一个块设备，可以划分为不同的分区；在分区之上再创建文件系统，挂载到某个目录，之后才可以在这个目录中读写文件。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650666008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554970,"discussion_content":"还好老师讲解了一下。不然就分不清，读写磁盘与读写文件区别了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646704230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136160,"avatar":"https://static001.geekbang.org/account/avatar/00/11/56/20/669aef03.jpg","nickname":"小酒","note":"","ucode":"D3829249BC04C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552829,"discussion_content":"百度了根本没有什么磁盘文件，感觉是他自己理解 加进去的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645606224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2624876,"avatar":"https://static001.geekbang.org/account/avatar/00/28/0d/6c/f707a7ca.jpg","nickname":"咸鱼不想练肱二","note":"","ucode":"55874FA11A455E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1136160,"avatar":"https://static001.geekbang.org/account/avatar/00/11/56/20/669aef03.jpg","nickname":"小酒","note":"","ucode":"D3829249BC04C0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591140,"discussion_content":"经典百度搜不到捏\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666321272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552829,"ip_address":"上海"},"score":591140,"extra":""}]},{"author":{"id":1434941,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e5/3d/e9cf1a67.jpg","nickname":"张策","note":"","ucode":"471F3A9D1F158F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408910,"discussion_content":"直接写磁盘则只有buffer没有cache","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635341804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315665,"avatar":"https://static001.geekbang.org/account/avatar/00/14/13/51/99c88021.jpg","nickname":"成为祝福","note":"","ucode":"8C48D080E9A6A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375411,"discussion_content":"如果读写磁盘时会完全跳过文件系统，为什么cache还是会有小量的上升呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621615792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1995424,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Bz3ib78GwqQUAoqz7uU1uSkRicqhqc4ibqcJv4fTa495utaCD6luCy61RqtLH6Up2Petc966wUpNB3C53iaM5ZibwUA/132","nickname":"flydream","note":"","ucode":"568133A3846D2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356886,"discussion_content":"这么说就懂了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615697987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317696,"discussion_content":"页缓存(page cache)也是在cache吧? 可以理解cache为广义上的所有以page映射的缓存?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603589907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311731,"discussion_content":"正准备搜一下这两个的区别，谢谢老师解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602475509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1247574,"avatar":"https://static001.geekbang.org/account/avatar/00/13/09/56/2628852c.jpg","nickname":"星之所在","note":"","ucode":"03ADB0ADD5FC27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":260395,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588862688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1247574,"avatar":"https://static001.geekbang.org/account/avatar/00/13/09/56/2628852c.jpg","nickname":"星之所在","note":"","ucode":"03ADB0ADD5FC27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":253235,"discussion_content":"磁盘对应buffer普通文件对应cache","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588223118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54318,"user_name":"Geek_5258f8","can_delete":false,"product_type":"c1","uid":1209313,"ip_address":"","ucode":"4EC60AE0C23CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIbas4S4X5W15njMeoEPPSyBZRX37nrTXbMFFeHghXl4Slk6WXE7oq5yxoNnukYfcOQs00RAvUmEA/132","comment_is_top":false,"comment_ctime":1545827450,"is_pvip":false,"replies":[{"id":"19691","content":"👍 ","user_name":"作者回复","comment_id":54318,"uid":"1001282","ip_address":"","utype":1,"ctime":1545832863,"user_name_real":"倪朋飞"}],"discussion_count":11,"race_medal":0,"score":"869129221242","product_id":100020901,"comment_content":"理论上，一个文件读首先到Block Buffer, 然后到Page Cache。有了文件系统才有了Page Cache.<br>在老的Linux上这两个Cache是分开的。那这样对于文件数据，会被Cache两次。这种方案虽然简单，<br>但低效。后期Linux把这两个Cache统一了。对于文件，Page Cache指向Block Buffer，对于非文件<br>则是Block Buffer。这样就如文件实验的结果，文件操作，只影响Page Cache，Raw操作，则只影响Buffer. 比如一此VM虚拟机，则会越过File System，只接操作 Disk, 常说的Direct IO.","like_count":203,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434425,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446375,"avatar":"https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg","nickname":"book尾汁","note":"","ucode":"AE2B8DFC643ACC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256893,"discussion_content":"我就觉得读文件 buffer居然不涨不正常,看了你的留言就说的通了,cache指向了buffer只算了cache","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1588517515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1299948,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d5/ec/87d33ab7.jpg","nickname":"没有昵称","note":"","ucode":"CE20F68C5AF547","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586919,"discussion_content":"&#34;会越过File System，只接操作 Disk, 常说的Direct IO. &#34; 这种说法是错误的，越过file system的io是raw io，而direct io是指通过file system但越过cache的io。详见System Performance 2nd（性能之巅第2版），8.3.8 Raw and Direct I/O","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1662609228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2084718,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","nickname":"ming","note":"","ucode":"FF2C74CBA5E7BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302504,"discussion_content":"1、Page Cache指向Block Buffer是什么意思？ 2、哪些操作是非文件的呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598938847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2084718,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","nickname":"ming","note":"","ucode":"FF2C74CBA5E7BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317682,"discussion_content":"2.6内核后将两种重复的缓存机制统一了: 1. 就是读文件之前是使用cache, 现在也直接指向了buffer. 2. 非文件: 就是裸读磁盘的io, 直接读块设备, 不经过文件系统.","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1603588792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302504,"ip_address":""},"score":317682,"extra":""}]},{"author":{"id":1220702,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erfbtibbPk4VI9pInKXOhhH0349bic9XiaI4lrUDr8ByXOKoEicrOHeicEyfbrGjJ0RvACN7Bb0GcBPzyA/132","nickname":"keka","note":"","ucode":"687E53AF4B0F3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3547,"discussion_content":"您好，请问下，这里说的Page Cache 和kafka 里面利用的pagecache 是同一个东西？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564566974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1236573,"avatar":"https://static001.geekbang.org/account/avatar/00/12/de/5d/a7e748db.jpg","nickname":"Kim","note":"","ucode":"39CC8E1E8EFB8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1220702,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erfbtibbPk4VI9pInKXOhhH0349bic9XiaI4lrUDr8ByXOKoEicrOHeicEyfbrGjJ0RvACN7Bb0GcBPzyA/132","nickname":"keka","note":"","ucode":"687E53AF4B0F3A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349679,"discussion_content":"一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613452675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3547,"ip_address":""},"score":349679,"extra":""}]},{"author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239505,"discussion_content":"结合课程内容，听你这么一说又更明白了一些，请教一下Raw操作是什么意思？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587301918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2085676,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d3/2c/75d63490.jpg","nickname":"笔先生","note":"","ucode":"6875FA95615633","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925240,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/60/78/b74a532b.jpg","nickname":"稀释但丁","note":"","ucode":"EA7C9F0893D71A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541469,"discussion_content":"绕过文件系统，直接对块设备的读写操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640394922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239505,"ip_address":""},"score":541469,"extra":""}]},{"author":{"id":1484953,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/RzSnI5bpFSKdOsRPDhgeqvXR0SX96gqRXpcxtfibBp3EopeFC50cuAgBkua36cTGyMWiaEz5O1XzL5sOQ4F9cazA/132","nickname":"zeech","note":"","ucode":"BB4283A603ECEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20153,"discussion_content":"难道不是先读pagecache吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569284883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1081910,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/36/3c2d4416.jpg","nickname":"new","note":"","ucode":"D02D595CDB9805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14188,"discussion_content":"想问下为什么文件读先到buffer读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568731134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103443,"user_name":"croco","can_delete":false,"product_type":"c1","uid":1174302,"ip_address":"","ucode":"F6EA7616724881","user_header":"https://static001.geekbang.org/account/avatar/00/11/eb/1e/cbd63297.jpg","comment_is_top":false,"comment_ctime":1560436340,"is_pvip":false,"replies":[{"id":"37552","content":"嗯嗯","user_name":"作者回复","comment_id":103443,"uid":"1001282","ip_address":"","utype":1,"ctime":1560521578,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"203423899252","product_id":100020901,"comment_content":"我好像明白了，就是&#47;proc&#47;&lt;pid&gt;&#47;smaps中的Pss相加，因为Pss是私有内存+共享内存按比例属于自己计算的那一部分<br>比如私有内存是200k， 共享内存500k和4个其它进程共享，那么是Pss就是200k+（500&#47;（1+4））=200k+100k=300k。 这样所有进程的Pss相加就不会有重复相加的顾虑，因为Pss中已经将共享内存部分帮我们算好了<br>参考命令：awk &#39;&#47;Pss:&#47;{ sum += $2 } END { print sum }&#39; &#47;proc&#47;$$&#47;smaps","like_count":48,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453877,"discussion_content":"嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560521578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1803259,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","nickname":"linker","note":"","ucode":"6C5799F2FC2C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210280,"discussion_content":"说的没错，这时用户态进程占用的空间，不是内核态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584715779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83701,"user_name":"acm1204","can_delete":false,"product_type":"c1","uid":1183143,"ip_address":"","ucode":"D19B576378E4CD","user_header":"https://static001.geekbang.org/account/avatar/00/12/0d/a7/30e27d12.jpg","comment_is_top":false,"comment_ctime":1554706456,"is_pvip":false,"replies":[{"id":"30377","content":"cache","user_name":"作者回复","comment_id":83701,"uid":"1001282","ip_address":"","utype":1,"ctime":1554815450,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"100338954264","product_id":100020901,"comment_content":"socket buffer属于哪一类？","like_count":23,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446130,"discussion_content":"cache","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554815450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53926,"user_name":"JJ","can_delete":false,"product_type":"c1","uid":1057434,"ip_address":"","ucode":"3C9295759FAA11","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/9a/989a3d8e.jpg","comment_is_top":false,"comment_ctime":1545756296,"is_pvip":false,"replies":[{"id":"19548","content":"请参考置顶回复","user_name":"作者回复","comment_id":53926,"uid":"1001282","ip_address":"","utype":1,"ctime":1545787858,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"74560200328","product_id":100020901,"comment_content":"还是有点困惑，感觉读写磁盘上的数据不就是读写磁盘上的文件里的数据嘛，难道读磁盘上的数据可以不经过文件系统吗，可以直接读裸磁盘？有点没理解buffer是磁盘上的数据缓存，cache是文件数据缓存，求大神解答下。。","like_count":17,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434291,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545787858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54138,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1545796617,"is_pvip":false,"replies":[{"id":"19711","content":"对的","user_name":"作者回复","comment_id":54138,"uid":"1001282","ip_address":"","utype":1,"ctime":1545836407,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"70265273353","product_id":100020901,"comment_content":"数据库使用裸设备是明显的磁盘读写；如果数据库的数据文件在文件系统上就是文件读写。这样理解对么","like_count":16,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434366,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55729,"user_name":"顾仲贤","can_delete":false,"product_type":"c1","uid":1107515,"ip_address":"","ucode":"2E2516A8916716","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/3b/2d14b5e1.jpg","comment_is_top":false,"comment_ctime":1546272163,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"53085879715","product_id":100020901,"comment_content":"老师，关于buffer是对直接写磁盘的缓存，我想问下。现实中有哪些是直接写磁盘的场景。写读写文件不也最终是写到磁盘上吗？谢谢","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2317,"discussion_content":"是的，最终数据都是写到磁盘的。文件读写的主要不同是有文件系统帮你管理文件，而直接写磁盘的大多是存储系统。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1563457516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547428,"discussion_content":"oracle 中参数 FILESYSTEMIO_OPTIONS = directIO 直接路径写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642670258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62645,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1548124061,"is_pvip":false,"replies":[{"id":"22574","content":"早期的Linux会的，也就是cache两次。不过现在不会了，只会经过一层cache。","user_name":"作者回复","comment_id":62645,"uid":"1001282","ip_address":"","utype":1,"ctime":1548575466,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"44497797021","product_id":100020901,"comment_content":"老师您好，有一个疑惑：<br>数据写入到page cache。后续应用程序强制刷盘或者系统自动刷盘的时候，page cache中的数据还会经过buffer，然后再到块设备吗？还是不会经过buffer，直接刷到块设备了？<br>（读取比较好理解，读取文件直接到page cache，读取块设备先到buffer，buffer不够再到page cache）","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437288,"discussion_content":"早期的Linux会的，也就是cache两次。不过现在不会了，只会经过一层cache。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548575466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579453,"discussion_content":"没回答到点子上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657462414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":437288,"ip_address":""},"score":579453,"extra":""}]}]},{"had_liked":false,"id":54324,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1545828736,"is_pvip":false,"replies":[{"id":"19690","content":"去掉缓存的话，文件系统比磁盘又多了一层，所以有可能比直接磁盘读写慢。但文件系统也有缓存，所以大部分情况下不绕开会更快","user_name":"作者回复","comment_id":54324,"uid":"1001282","ip_address":"","utype":1,"ctime":1545832801,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"44495501696","product_id":100020901,"comment_content":"老师,是否绕开文件系统,直接对磁盘进行读写会更快呢？","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434426,"discussion_content":"去掉缓存的话，文件系统比磁盘又多了一层，所以有可能比直接磁盘读写慢。但文件系统也有缓存，所以大部分情况下不绕开会更快","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1545832801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161155,"user_name":"笃定","can_delete":false,"product_type":"c1","uid":1316173,"ip_address":"","ucode":"92E06FA13CC046","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","comment_is_top":false,"comment_ctime":1576133805,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"31640904877","product_id":100020901,"comment_content":"老师，我们公司的httpd上跑了很多个虚拟主机，每次网站打开特别的慢，我每次用free命令查看都是cache占用了80%的内存。后来加了内存，但是依然很慢cache占用内存的比例依然是80%。后来我就把buffer&#47;cache都清空了。网站速度就变快了。。。现在每次站点慢我都会手动清空buffer和cache。这是为什么老师？缓冲和缓存不是可以加快数据文件的读写吗？","like_count":7,"discussions":[{"author":{"id":2664802,"avatar":"","nickname":"Geek_ccf14e","note":"","ucode":"3678A5EDABAE74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381491,"discussion_content":"个人理解，有命中才会快，否则还是需要后端读盘，但此时缓存消耗不少了，读取新数据就需要腾地，又涉及淘汰，又带来额外消耗；清掉cache后再读或者写就容易命中了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625101641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2144197,"avatar":"https://static001.geekbang.org/account/avatar/00/20/b7/c5/83953005.jpg","nickname":"青椒炒肉丝","note":"","ucode":"479A6F276BDAA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381975,"discussion_content":"首先问题描述的不清晰，说网站打开慢 ，描述太笼统了，可以交代的详细点。\n另外排查的思路也不对呀，可以按照数据流向进行逐级排查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625327143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1171280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/df/50/ed811610.jpg","nickname":"睡着了去做梦","note":"","ucode":"1B553D695BC70D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373089,"discussion_content":"坐等后续","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620611197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2012804,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/b6/84/49c5f817.jpg","nickname":"给陈某举个例子。","note":"","ucode":"818D65EEA7B172","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331221,"discussion_content":"httpd也有缓存静态文件的开关，可以关闭再试试效果？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606810757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1173894,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e9/86/d34800a4.jpg","nickname":"heyman","note":"","ucode":"92EF9EF1B1B1B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329754,"discussion_content":"表示很好奇，有后续吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606454858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1316173,"avatar":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","nickname":"笃定","note":"","ucode":"92E06FA13CC046","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1173894,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e9/86/d34800a4.jpg","nickname":"heyman","note":"","ucode":"92EF9EF1B1B1B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330387,"discussion_content":"一开始清空了是变快了，但是之后就变得奇慢无比。问开发之后他说不能清空buffer和cached，因为很多数据都会有缓存。读缓存，写缓冲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606611151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":329754,"ip_address":""},"score":330387,"extra":""},{"author":{"id":2051085,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erGLUqIRJ2gJamFq0SbJksGTNOeHnAQzWZknhRaWFDt5vh1mPpZ9eZdrfvn0bzcRqTZo0yjMW3Ugw/132","nickname":"Jasman","note":"","ucode":"C5221E477219A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1316173,"avatar":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","nickname":"笃定","note":"","ucode":"92E06FA13CC046","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334223,"discussion_content":"那就是又回到老问题了？怎么解决的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607771770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":330387,"ip_address":""},"score":334223,"extra":""}]}]},{"had_liked":false,"id":54641,"user_name":"无名老卒","can_delete":false,"product_type":"c1","uid":1348261,"ip_address":"","ucode":"48874CE670E122","user_header":"","comment_is_top":false,"comment_ctime":1545921230,"is_pvip":false,"replies":[{"id":"19946","content":"总结的不错，不过计算方法还是不太准确。可以继续查一下PSS和PSS的区别","user_name":"作者回复","comment_id":54641,"uid":"1001282","ip_address":"","utype":1,"ctime":1546005736,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"31610692302","product_id":100020901,"comment_content":"看了这篇文章，终于理解 了buffers以及cache，之前在网上还专门查过这2者的区别，但就是像老师说的那样，文章看下来，啥也没有啥明白。<br><br>按照老师的总结，cache是针对文件系统的缓存 ，而buffers是对磁盘数据的缓存，是直接跟硬件那一层相关的，那一般来说，cache会比buffers的数量大了很多。生产环境下面看了多台机器，的确如此。<br><br>后面留的那个作业，如果要统计一个进程所占用的物理空间，我的做法是累加RSS的值。如下shell是我工作中所使用的命令，取内存占用top10的进程：<br><br>for i in $( ls &#47;proc&#47; |grep &quot;^[0-9]&quot;|awk &#39;$0 &gt;100&#39;) ;do cmd=&quot;&quot;;[ -f &#47;proc&#47;$i&#47;cmdline ] &amp;&amp; cmd=`cat &#47;proc&#47;$i&#47;cmdline`;[ &quot;$cmd&quot;X = &quot;&quot;X ] &amp;&amp; cmd=$i;awk -v i=&quot;$cmd&quot; &#39;&#47;Rss:&#47;{a=a+$2}END{printf(&quot;%s:%d\\n&quot;,i,a)}&#39; &#47;proc&#47;$i&#47;smaps 2&gt;&#47;dev&#47;null; done | sort -t: -k2nr | head -10","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434523,"discussion_content":"总结的不错，不过计算方法还是不太准确。可以继续查一下PSS和PSS的区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014615,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/57/18b61282.jpg","nickname":"dullduck","note":"","ucode":"25293558309704","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125060,"discussion_content":"同感","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578471110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306382,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ef/0e/618689da.jpg","nickname":"有人@我","note":"","ucode":"6C4F8B7092005E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1046,"discussion_content":"后面的数值的单位是什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562293762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54146,"user_name":"虎虎❤️","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1545797405,"is_pvip":false,"replies":[{"id":"19710","content":"1. 物理内存的分布由系统管理，没有类似于虚拟内存这样的分布<br>2. 不是<br>3. LRU回收的是缓存，Swap换出的是不可回收的内存，比如进程的堆内存","user_name":"作者回复","comment_id":54146,"uid":"1001282","ip_address":"","utype":1,"ctime":1545836362,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"31610568477","product_id":100020901,"comment_content":"<br>通过读csapp，又复习了下虚拟内存。其概念为 “虚拟内存组织为一个由存放在磁盘上的N个连续的字节大小的单元组成的数组。” 访问虚拟内存时，MMU通过访问页表，来索引到实际的存储地址。如果在物理内存中有缓存，直接从物理内存中读取数据。否则，从磁盘中读取，并选择牺牲一个物理页，并替换为新读取的页（当然，我觉得这种应该是在内存没有free的情况下）。如果被牺牲的页发生改变，则写回磁盘。最后更新页表。<br><br>我的问题是：<br>1. 上一节讲了虚拟内存的空间分布，那么物理内存有没有空间分布的概念？从vmstat的输出来看，物理内存是不是只包括buffer cache 和 free呢？<br>2. 这里的cache是不是等同于虚拟内存在物理内存中的缓存？<br>3. 上一节课所说的内存回收。使用LRU算法“回收缓存”，是否是我上面描述的概念？那么所谓的“回收不常访问的内存，把不常用的内存通过交换分区直接写到磁盘中”，指的是交换出哪种内存？cache？buffer？或者其他的种类？<br><br>希望得到老师回复，也欢迎各位大佬共同探讨。","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434370,"discussion_content":"1. 物理内存的分布由系统管理，没有类似于虚拟内存这样的分布\n2. 不是\n3. LRU回收的是缓存，Swap换出的是不可回收的内存，比如进程的堆内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225587,"user_name":"Tony","can_delete":false,"product_type":"c1","uid":1423011,"ip_address":"","ucode":"777ABCF55F1678","user_header":"https://static001.geekbang.org/account/avatar/00/15/b6/a3/d9ec3a30.jpg","comment_is_top":false,"comment_ctime":1591795544,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27361599320","product_id":100020901,"comment_content":"请教老师一下，我碰到一个问题，我们的服务中会有大量文件读操作，这时候cache会变很大，内存不足时也不会释放，每次需要手动释放才可以，另外这种场景下，我写个小程序去申请内存，当时free显示还有600多M，我只申请1m就是失败的，如果我改成申请500k可以成功，然后我循环20000次，每次申请500k，这个时候才会触发系统去释放cache，不晓得怎么解决了，总不能每次都去手动清cache啊，请求老师帮助","like_count":6,"discussions":[{"author":{"id":1918112,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/44/a0/16d0d300.jpg","nickname":"ZHANGPING","note":"","ucode":"7108812981C996","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555449,"discussion_content":"同问\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646907859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043375,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/eb/af/b893c7e2.jpg","nickname":"jacky","note":"","ucode":"CA680B02320539","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544022,"discussion_content":"我也碰到了，后来解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641380384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68244,"user_name":"吴林辉","can_delete":false,"product_type":"c1","uid":1222971,"ip_address":"","ucode":"56F117300FF33D","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/3b/f4ca20d8.jpg","comment_is_top":false,"comment_ctime":1550465830,"is_pvip":false,"replies":[{"id":"24522","content":"这句话来自vmstat的文档：https:&#47;&#47;linux.die.net&#47;man&#47;8&#47;vmstat<br><br>通常说的的 Block Size 是磁盘分区的块大小，的确都是 4KB 了。","user_name":"作者回复","comment_id":68244,"uid":"1001282","ip_address":"","utype":1,"ctime":1550673895,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"27320269606","product_id":100020901,"comment_content":"“因为 Linux 中块的大小是 1KB，所以这个单位也就等价于 KB&#47;s。”关于这一点，想请问下老师，linux block的大小不是4KB呢？","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439584,"discussion_content":"这句话来自vmstat的文档：https://linux.die.net/man/8/vmstat\n\n通常说的的 Block Size 是磁盘分区的块大小，的确都是 4KB 了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1550673895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579402,"discussion_content":"我觉得是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657432485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390687,"discussion_content":"所以这里的block和 Block Size是一个东西么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629973281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69410,"user_name":"杜嘉嘉","can_delete":false,"product_type":"c1","uid":1306430,"ip_address":"","ucode":"C23DE27E7886BD","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/3e/9c3a8abc.jpg","comment_is_top":false,"comment_ctime":1550736936,"is_pvip":false,"replies":[{"id":"24847","content":"通常来说都是好事，不过也不是绝对的，还要看具体的场景的。比如，内存紧张的时候，回收缓存会对性能有一定影响；不合理的应用占用大量缓存，也可能会会导致内存不足。","user_name":"作者回复","comment_id":69410,"uid":"1001282","ip_address":"","utype":1,"ctime":1550850244,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23025573416","product_id":100020901,"comment_content":"想请教一下老师，怎么看待一个系统buffer和cache使用率过高的问题。是好是坏，如果这些缓存没及时回收可能会导致，程序异常","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440106,"discussion_content":"通常来说都是好事，不过也不是绝对的，还要看具体的场景的。比如，内存紧张的时候，回收缓存会对性能有一定影响；不合理的应用占用大量缓存，也可能会会导致内存不足。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550850244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54160,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1545799186,"is_pvip":false,"replies":[{"id":"19705","content":"前面2是C库的缓存，跟系统的缓存没关系<br><br>ls的文档参考 info coreutils &#39;ls invocation&#39;","user_name":"作者回复","comment_id":54160,"uid":"1001282","ip_address":"","utype":1,"ctime":1545836012,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18725668370","product_id":100020901,"comment_content":"[D16打卡]<br>只有一块磁盘,就没轻易的试第二个案例.<br>---------------------------------------------------<br>以前应该只接触到了文件数据的缓存cache,没接触到磁盘数据的缓存buffer.<br>1.vim一个大文件,在第一次加载时较慢,之后再次打开时,会明显感觉到加载速度更快,应该就是cache的功劳.<br>2.在linux下写c程序时,打印日志printf后面习惯加fflush(stdout);<br>可以强制刷新缓冲区的内容到物理设备.在程序宕掉时可以定位到最后的输出日志.<br>如果不加fflush,可能会丢失掉部分缓冲区内的日志.<br>不知道这里的缓冲区跟系统的cache是不是一个概念.<br>---------------------------------------------------<br>ls -l 磁盘与普通文件的区别:<br># ls -l &#47;dev&#47;sda1<br>brw-rw---- 1 root disk 8, 1 12月 12 10:17 &#47;dev&#47;sda1<br># ls -ld &#47;root&#47;<br>drwx------ 12 root root 4096 12月 26 11:48 &#47;root&#47;<br>第一个字符b应该表示是磁盘类型 d就是目录类型了<br>有一列一个显示的第几块磁盘的第几个分区[8,1],一个是占用的空间大小[4096].<br>疑问:man ls 了也没看到各列具体的含义啊,这个去哪查呢?<br>---------------------------------------------------<br>老师最后的问题深入探索又是一篇长文了.哈哈!","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434375,"discussion_content":"前面2是C库的缓存，跟系统的缓存没关系\n\nls的文档参考 info coreutils &amp;#39;ls invocation&amp;#39;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54153,"user_name":"魏春河","can_delete":false,"product_type":"c1","uid":1117048,"ip_address":"","ucode":"DDD2998C157639","user_header":"https://static001.geekbang.org/account/avatar/00/11/0b/78/22410c47.jpg","comment_is_top":false,"comment_ctime":1545797975,"is_pvip":false,"replies":[{"id":"19708","content":"对的","user_name":"作者回复","comment_id":54153,"uid":"1001282","ip_address":"","utype":1,"ctime":1545836091,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":1,"score":"18725667159","product_id":100020901,"comment_content":"是不是普通文件系统最终还是要经过读写磁盘来完成保存？buffer在cache后面？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434372,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54111,"user_name":"科学Jia","can_delete":false,"product_type":"c1","uid":1080409,"ip_address":"","ucode":"95430413F82A69","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/59/26b1e65a.jpg","comment_is_top":false,"comment_ctime":1545794806,"is_pvip":false,"replies":[{"id":"19715","content":"也花了挺多时间，有些基础的原理在学校就学过了，也有很多是实践中学到的经验","user_name":"作者回复","comment_id":54111,"uid":"1001282","ip_address":"","utype":1,"ctime":1545837698,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14430696694","product_id":100020901,"comment_content":"老师，女同学我今天上班时间终于追到这里了。写的真真清楚，想知道您花了多少时间学这些?","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434360,"discussion_content":"也花了挺多时间，有些基础的原理在学校就学过了，也有很多是实践中学到的经验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545837698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53941,"user_name":"金波","can_delete":false,"product_type":"c1","uid":1315886,"ip_address":"","ucode":"A50860CA422EBB","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/2e/400913b1.jpg","comment_is_top":false,"comment_ctime":1545773385,"is_pvip":false,"replies":[{"id":"19733","content":"&#47;tmp&#47;file 是一个普通文件，确切的说是文件系统管理的文件，而没有磁盘下的哪个文件这一说。略过文件系统之后到了磁盘就都是Block了","user_name":"作者回复","comment_id":53941,"uid":"1001282","ip_address":"","utype":1,"ctime":1545840606,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14430675273","product_id":100020901,"comment_content":"请问&#47;tmp&#47;file 是磁盘下的一个文件吗？ 没详细说明，可能是内存文件系统。磁盘下和tmpfs的读对Cache是否一样？","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434293,"discussion_content":"/tmp/file 是一个普通文件，确切的说是文件系统管理的文件，而没有磁盘下的哪个文件这一说。略过文件系统之后到了磁盘就都是Block了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216920,"user_name":"suke","can_delete":false,"product_type":"c1","uid":1007753,"ip_address":"","ucode":"C0287C31A4F45B","user_header":"","comment_is_top":false,"comment_ctime":1589369198,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10179303790","product_id":100020901,"comment_content":"老师，有没有什么工具能查看单个进程的buffer和cache？，一直没找到","like_count":2,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550303,"discussion_content":"单个进程的buffer和cache--- 我个人觉得这种理解是错对. buffer 和 cache  是对应系统级别的， 可以理解为全局使用。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644478681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560081,"discussion_content":"hcache可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649163888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195670,"user_name":"LindaWang","can_delete":false,"product_type":"c1","uid":1800128,"ip_address":"","ucode":"45368868C3980B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","comment_is_top":false,"comment_ctime":1585210862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175145454","product_id":100020901,"comment_content":"倪老师，您了解的业界有没有用AI做性能优化的工具呢？","like_count":2},{"had_liked":false,"id":96564,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1558449920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10148384512","product_id":100020901,"comment_content":"有些细节未能理解，网上也找不到答案，望老师指点。<br>1，关于写硬盘，cache也有一定程度的提升， 我自己测试写硬盘2GB，cache增长幅度为430MB，请问这部分的cache增长是什么原因呢？<br>2，关于读磁盘，cache也有很轻微的增长，请问其中的原因又是？","like_count":2},{"had_liked":false,"id":60376,"user_name":"小虎","can_delete":false,"product_type":"c1","uid":1033083,"ip_address":"","ucode":"31438B30CF7910","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GkMk4gBlfZcljsY3Vqu7w8ZkxBfe8WTz1ySnPTJARKXF0FpCr3HqlicIHQlItib9m7iaxLESkmBNpoiaY81EUUzQrA/132","comment_is_top":false,"comment_ctime":1547465488,"is_pvip":false,"replies":[{"id":"22299","content":"有可能会丢失，所以很多应用还需要主动 sync","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548248542,"ip_address":"","comment_id":60376,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10137400080","product_id":100020901,"comment_content":"老是如果使用mmap进行写文件的话是先写入缓存，假如此时断电那么cache里面的数据会丢失吗？或者说系统怎么保证断电下cache的数据在恢复用电后还可以写入文件不丢失。","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436486,"discussion_content":"有可能会丢失，所以很多应用还需要主动 sync","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548248542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2303222,"avatar":"","nickname":"Geek_f7bc9b","note":"","ucode":"83EBA43585B2B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332483,"discussion_content":"写完强制刷盘，不然没办法保证不丢数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607237180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239947,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1596699130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5891666426","product_id":100020901,"comment_content":"总结要点：<br>- Buffer 既可以用作“将要写入磁盘数据的缓存”，也可以用作“从磁盘读取数据的缓存”。<br>- Cache 既可以用作“从文件读取数据的页缓存”，也可以用作“写文件的页缓存”。<br>- 简单来说，Buffer 是对磁盘数据的缓存，而 Cache 是文件数据的缓存，它们既会用在读请求中，也会用在写请求中。","like_count":1},{"had_liked":false,"id":196731,"user_name":"斑马Z","can_delete":false,"product_type":"c1","uid":1500262,"ip_address":"","ucode":"ABB55B4652452F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0K9AM6xxDzVV6pF66jyus5NuuxZzT9icad8AQDMKibwUOy3UnoZIZdyKIKd9sA06rgFnIWwiakSeOQ/132","comment_is_top":false,"comment_ctime":1585307928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880275224","product_id":100020901,"comment_content":"buffer和Cache<br><br>定义<br><br>Buffer 是对磁盘数据的缓存，而 Cache 是文件数据的缓存，它们既会用在读请求中，也会用在写请求中。<br>Buffer 既可以用作“将要写入磁盘数据的缓存”，也可以用作“从磁盘读取数据的缓存”。<br>Cache 既可以用作“写文件的页缓存”，也可以用作“从文件读取数据的页缓存”。<br>buffer对磁盘缓存 在写入磁盘时会发生变化<br>cache对文件缓存 在写入文件时会发生变化<br><br>首先清理缓存$<br> echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches<br><br>写文件<br>dd if=&#47;dev&#47;urandom of=&#47;tmp&#47;file bs=1M count=500<br>写磁盘（不要使用这个命令！！！）<br>dd if=&#47;dev&#47;urandom of=&#47;dev&#47;sdb1 bs=1M count=2048<br><br>读文件<br>dd if=&#47;tmp&#47;file of=&#47;dev&#47;null <br>读磁盘<br>dd if=&#47;dev&#47;sda1 of=&#47;dev&#47;null bs=1M count=1024<br><br>执行上述读写命令时，每次都要清理缓存，然后观察vmstat中 各项参数的变化！<br><br>优点及使用场景<br><br>从写的角度来说，不仅可以优化磁盘和文件的写入，对应用程序也有好处，应用程序可以在数据真正落盘前，就返回去做其他工作。<br>从读的角度来说，既可以加速读取那些需要频繁访问的数据，也降低了频繁 I&#47;O 对磁盘的压力。","like_count":1},{"had_liked":false,"id":161535,"user_name":"永","can_delete":false,"product_type":"c1","uid":1297269,"ip_address":"","ucode":"F1737EBDB046FB","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/75/0106cd63.jpg","comment_is_top":false,"comment_ctime":1576225025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5871192321","product_id":100020901,"comment_content":"老师你好，Buffer 是对磁盘数据的缓存，是当大小比较大时候才会执行而 Cache 是文件数据的缓存","like_count":1},{"had_liked":false,"id":107571,"user_name":"long","can_delete":false,"product_type":"c1","uid":1102969,"ip_address":"","ucode":"FFCC6AE7D3D691","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/79/e40f349d.jpg","comment_is_top":false,"comment_ctime":1561558647,"is_pvip":false,"replies":[{"id":"40096","content":"试试 man 5 proc（数字 5 的含义请查询 man man）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249706,"ip_address":"","comment_id":107571,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5856525943","product_id":100020901,"comment_content":"为什么我输入：man proc后输出如下：<br><br>proc(n)                                                        Tcl Built-In Commands                                                        proc(n)<br><br>___________________________________________________________________________________________________________________________________________________<br><br>NAME<br>       proc - Create a Tcl procedure<br><br>SYNOPSIS<br>       proc name args body<br>_________________________________________________________________<br><br>DESCRIPTION<br>       The  proc  command  creates  a  new  Tcl procedure named name, replacing any existing command or procedure there may have been by that name.<br>       Whenever the new command is invoked, the contents of body will be executed by the Tcl interpreter.  Normally, name is unqualified (does  not<br>       include  the names of any containing namespaces), and the new procedure is created in the current namespace.  If name includes any namespace<br>       qualifiers, the procedure is created in the specified namespace.  Args specifies the formal arguments to the procedure.  It  consists  of  a<br>       list,  possibly empty, each of whose elements specifies one argument.  Each argument specifier is also a list with either one or two fields.<br>       If there is only a single field in the specifier then it is the name of the argument; if there are two fields, then the first is  the  argu‐<br>       ment  name  and the second is its default value.  Arguments with default values that are followed by non-defaulted arguments become required<br>       arguments.  In 8.6 this will be considered an error.","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455564,"discussion_content":"试试 man 5 proc（数字 5 的含义请查询 man man）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579403,"discussion_content":"哈哈，还有man man的用法，之前都忘记了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657432626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74855,"user_name":"空白","can_delete":false,"product_type":"c1","uid":1147753,"ip_address":"","ucode":"65DA67B52A16B9","user_header":"https://static001.geekbang.org/account/avatar/00/11/83/69/77256c74.jpg","comment_is_top":false,"comment_ctime":1552305181,"is_pvip":false,"replies":[{"id":"27346","content":"这是系统自动管理的，应用中没法直接控制，它们用的就是物理内存，跟其他进程一起由内核来分配内存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552350381,"ip_address":"","comment_id":74855,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5847272477","product_id":100020901,"comment_content":"Buffer和Cache和其他的物理内存有什么区别呢？是位于内核空间嘛？ 应用使用时仍然需要进行映射嘛","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442709,"discussion_content":"这是系统自动管理的，应用中没法直接控制，它们用的就是物理内存，跟其他进程一起由内核来分配内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552350381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68936,"user_name":"爱学习的小学生","can_delete":false,"product_type":"c1","uid":1413556,"ip_address":"","ucode":"040AB71F0394F2","user_header":"https://static001.geekbang.org/account/avatar/00/15/91/b4/d5d9e4fb.jpg","comment_is_top":false,"comment_ctime":1550630383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5845597679","product_id":100020901,"comment_content":"打卡","like_count":1},{"had_liked":false,"id":54356,"user_name":"Scott","can_delete":false,"product_type":"c1","uid":1014800,"ip_address":"","ucode":"7E57FDCB5E5D49","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg","comment_is_top":false,"comment_ctime":1545834355,"is_pvip":false,"replies":[{"id":"19714","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545837289,"ip_address":"","comment_id":54356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840801651","product_id":100020901,"comment_content":"好像aerospike就是绕过文件系统直接写磁盘的，性能指标相当爆炸","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434434,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545837289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54330,"user_name":"腾达","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1545829617,"is_pvip":false,"replies":[{"id":"19689","content":"清缓存了吗？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545832519,"ip_address":"","comment_id":54330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840796913","product_id":100020901,"comment_content":"$ dd if=&#47;tmp&#47;file of=&#47;dev&#47;null  为什么很快就结束了？导致vmstat值变化不大","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434430,"discussion_content":"清缓存了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54157,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545798289,"is_pvip":false,"replies":[{"id":"19706","content":"系统什么版本？是不是比较老？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545836070,"ip_address":"","comment_id":54157,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5840765585","product_id":100020901,"comment_content":"# 首先清理缓存<br>$ echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches<br># 然后运行 dd 命令向磁盘分区 &#47;dev&#47;sdb1 写入 2G 数据<br>$ dd if=&#47;dev&#47;urandom of=&#47;dev&#47;sdb1 bs=1M count=2048<br>、<br>这个测试，在centos下是cache比buffer增长的快，和你说ub下正好相反，这是为什么？<br>procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 2  0  34840 213268    172 193516    0    0     0     0  952   94  0 23 77  0  0\t<br> 1  0  34840 209176    172 197624    0    0     0     0 1044   92  0 24 76  0  0\t<br> 1  0  34840 204092    172 202740    0    0     0     0 1042   97  0 24 76  0  0\t<br> 1  0  34840 200000    180 206848    0    0     0    32 1056   97  0 25 75  0  0\t<br> 1  0  34840 194792    180 211836    0    0     0     0 1060   87  0 25 75  0  0\t<br> 1  0  34840 190700    180 216068    0    0     0     0 1006   96  0 24 76  0  0\t<br> 1  0  34840 188716    180 218092    0    0     0     0  933   93  0 23 77  0  0\t<br> 1  0  34840 184624    180 222212    0    0     0     0 1057   94  0 25 75  0  0\t<br> 1  0  34840 179540    180 227196    0    0     0     0 1082  100  0 25 75  0  0\t<br> 1  0  34840 175448    180 231428    0    0     0     0 1053   94  0 25 75  0  0\t<br> 1  0  34840 170240    180 236412    0    0     0     0 1066   92  0 25 75  0  0\t<br> 1  0  34840 166148    180 240644    0    0     0     0 1055   92  0 25 75  0  0\t<br> 1  0  34840 164164    180 242668    0    0     0     0 1021  110  0 24 76  0  0\t<br> 1  0  34840 158956    180 247812    0    0     0     0 1041   86  0 25 75  0  0\t<br> 1  0  34840 154864    180 251908    0    0     0     0 1071   94  0 25 75  0  0","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434374,"discussion_content":"系统什么版本？是不是比较老？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1506549,"avatar":"https://static001.geekbang.org/account/avatar/00/16/fc/f5/6b65f63a.jpg","nickname":"大将军Leo。。","note":"","ucode":"4A6A510BA454E1","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355578,"discussion_content":"我的也是一样的问题:\n3.10.0-1062.4.1.el7.x86_64\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615454805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54151,"user_name":"JohnT3e","can_delete":false,"product_type":"c1","uid":1063982,"ip_address":"","ucode":"CF4AAAC933529C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLdWHFCr66TzHS2CpCkiaRaDIk3tU5sKPry16Q7ic0mZZdy8LOCYc38wOmyv5RZico7icBVeaPX8X2jcw/132","comment_is_top":false,"comment_ctime":1545797703,"is_pvip":false,"replies":[{"id":"19709","content":"谢谢分享。欢迎分享你的思考结果","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545836180,"ip_address":"","comment_id":54151,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840764999","product_id":100020901,"comment_content":"最后的思考题，关键点在于理解PSS项的含义。有兴趣的同学可以参考这个资料：<br>https:&#47;&#47;unix.stackexchange.com&#47;questions&#47;33381&#47;getting-information-about-a-process-memory-usage-from-proc-pid-smaps。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434371,"discussion_content":"谢谢分享。欢迎分享你的思考结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54092,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545793101,"is_pvip":false,"replies":[{"id":"19718","content":"正解","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545837939,"ip_address":"","comment_id":54092,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840760397","product_id":100020901,"comment_content":"老师，无论是文件读写还是磁盘读写都是会涉及到bi bo的变化是吧。是因为文件读写到底层还是磁盘的块读写，是这样的吗<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434350,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545837939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54000,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1196791,"ip_address":"","ucode":"D3EFE8729DDE8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/42/f7/9dce9a7b.jpg","comment_is_top":false,"comment_ctime":1545785124,"is_pvip":false,"replies":[{"id":"19725","content":"是的👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545839968,"ip_address":"","comment_id":54000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840752420","product_id":100020901,"comment_content":"另外，Linux里的块设备，可以直接访问(比如数据库应用程序)，也可以存储文件系统然后被访问吧。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434320,"discussion_content":"是的👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545839968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358794,"user_name":"斌子","can_delete":false,"product_type":"c1","uid":1305393,"ip_address":"北京","ucode":"602804C685CFAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/31/2768a6a1.jpg","comment_is_top":false,"comment_ctime":1664783317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664783317","product_id":100020901,"comment_content":"我怎么记得加块大小是4K？文中说是1k？","like_count":0},{"had_liked":false,"id":357502,"user_name":"Yon","can_delete":false,"product_type":"c1","uid":2339821,"ip_address":"美国","ucode":"0E0AD941FA1FB7","user_header":"https://static001.geekbang.org/account/avatar/00/23/b3/ed/e66a2886.jpg","comment_is_top":false,"comment_ctime":1663319079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663319079","product_id":100020901,"comment_content":"free中的buffer、cache 和CPU中的cache 有啥关系和区别呢","like_count":0},{"had_liked":false,"id":355279,"user_name":"V杨青","can_delete":false,"product_type":"c1","uid":1340256,"ip_address":"北京","ucode":"B440CA943C8898","user_header":"https://static001.geekbang.org/account/avatar/00/14/73/60/e87032de.jpg","comment_is_top":false,"comment_ctime":1661244490,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661244490","product_id":100020901,"comment_content":"老师好，我想提问下，free命令显示还剩10%，top命令显示数据库使用55.8%，剩下总的使用2%左右，想要排查32.2%是数据库没有释放吗？备注buff&#47;cache使用内存跟多","like_count":0},{"had_liked":false,"id":346232,"user_name":"Sancho","can_delete":false,"product_type":"c1","uid":1436391,"ip_address":"","ucode":"78849913082622","user_header":"https://static001.geekbang.org/account/avatar/00/15/ea/e7/9ce305ec.jpg","comment_is_top":false,"comment_ctime":1652932701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652932701","product_id":100020901,"comment_content":"写文件，写磁盘区别是？写文件，是指bi，把磁盘内容read到blocks；写磁盘，是指bo，把blocks send到磁盘？有点晕，不知这样理解对不对。。。","like_count":0},{"had_liked":false,"id":343771,"user_name":"multithinking","can_delete":false,"product_type":"c1","uid":2358810,"ip_address":"","ucode":"DAE7A808A6A3A4","user_header":"https://static001.geekbang.org/account/avatar/00/23/fe/1a/df2e73f1.jpg","comment_is_top":false,"comment_ctime":1651046883,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651046883","product_id":100020901,"comment_content":"pg数据库，buffer&#47;cache占比比较大，最后进程被oom了，这种情况怎么排查？","like_count":0},{"had_liked":false,"id":327421,"user_name":"鱼","can_delete":false,"product_type":"c1","uid":1487584,"ip_address":"","ucode":"89EC9CE3AD0281","user_header":"https://static001.geekbang.org/account/avatar/00/16/b2/e0/d856f5a4.jpg","comment_is_top":false,"comment_ctime":1640132237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640132237","product_id":100020901,"comment_content":"写文件也用到Cache的原因应该是PageCache的缓存模式是WriteBack（也称WriteBehind模式）：更新数据的时候，只更新缓存，不更新文件。采用异步的方式，将更新同步到文件。","like_count":0},{"had_liked":false,"id":323326,"user_name":"青阳","can_delete":false,"product_type":"c1","uid":2139807,"ip_address":"","ucode":"3591D366BAB0B9","user_header":"https://static001.geekbang.org/account/avatar/00/20/a6/9f/3c60fffd.jpg","comment_is_top":false,"comment_ctime":1637835032,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1637835032","product_id":100020901,"comment_content":"<br>dd if=&#47;dev&#47;urandom of=&#47;tmp&#47;file bs=1M count=500 这个没有读吗，为什么bi没有变化","like_count":0},{"had_liked":false,"id":315924,"user_name":"Ask","can_delete":false,"product_type":"c1","uid":2217510,"ip_address":"","ucode":"1FFD97000B9EFD","user_header":"https://static001.geekbang.org/account/avatar/00/21/d6/26/e5e5c817.jpg","comment_is_top":false,"comment_ctime":1634048909,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634048909","product_id":100020901,"comment_content":"除了读写普通文件，还有哪些情况会造成cache增高","like_count":0},{"had_liked":false,"id":315373,"user_name":"Ask","can_delete":false,"product_type":"c1","uid":2217510,"ip_address":"","ucode":"1FFD97000B9EFD","user_header":"https://static001.geekbang.org/account/avatar/00/21/d6/26/e5e5c817.jpg","comment_is_top":false,"comment_ctime":1633866618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633866618","product_id":100020901,"comment_content":"怎么查看cache里有哪些文件","like_count":0},{"had_liked":false,"id":305441,"user_name":"ccz 开发(谢不邀)","can_delete":false,"product_type":"c1","uid":1805809,"ip_address":"","ucode":"B8803B050AAC68","user_header":"","comment_is_top":false,"comment_ctime":1627975175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627975175","product_id":100020901,"comment_content":"&quot;下面的命令对环境要求很高，需要你的系统配置多块磁盘，并且磁盘分区 &#47;dev&#47;sdb1 还要处于未使用状态。如果你只有一块磁盘，千万不要尝试，否则将会对你的磁盘分区造成损坏&quot;——这句话是真的~~~用练习用的虚拟机机就测试就算了，千万别用主力机玩啊啊啊啊啊~","like_count":0},{"had_liked":false,"id":303515,"user_name":"万历十五年","can_delete":false,"product_type":"c1","uid":1122150,"ip_address":"","ucode":"3D8CF5DF847AE8","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg","comment_is_top":false,"comment_ctime":1626842774,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626842774","product_id":100020901,"comment_content":"转croco：单个进程内存使用大小&#47;proc&#47;&lt;pid&gt;&#47;smaps中的Pss，因为Pss是私有内存+共享内存按比例属于自己计算的那一部分比如私有内存是200k， 共享内存500k和4个其它进程共享，那么是Pss就是200k+（500&#47;（1+4））=200k+100k=300k。 这样所有进程的Pss相加就不会有重复相加的顾虑，因为Pss中已经将共享内存部分帮我们算好了<br>参考命令：awk &#39;&#47;Pss:&#47;{ sum += $2 } END { print sum }&#39; &#47;proc&#47;$$&#47;smaps","like_count":0},{"had_liked":false,"id":301172,"user_name":"出卖灵魂的教练Kerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1625562735,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625562735","product_id":100020901,"comment_content":"老师，Slab是什么？","like_count":0},{"had_liked":false,"id":299884,"user_name":"Geek_a55bf0","can_delete":false,"product_type":"c1","uid":1463944,"ip_address":"","ucode":"96FCD7B9120CA6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Nv7iaxevWVukvxaZf6TjbcNicgatCUpUcp7hTah0JQxvr7ZjMlLbopEaveichKRLQJjKXR6geB5LBntf7XCP8F4kQ/132","comment_is_top":false,"comment_ctime":1624892787,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624892787","product_id":100020901,"comment_content":"bi 和 bo 则分别表示块设备读取和写入的大小，单位为块 &#47; 秒。因为 Linux 中块的大小是 1KB，所以这个单位也就等价于 KB&#47;s。---老师好，请问下块大小不是4KB的吗","like_count":0},{"had_liked":false,"id":293526,"user_name":"渣渣","can_delete":false,"product_type":"c1","uid":2430777,"ip_address":"","ucode":"0384A5859A9D39","user_header":"https://static001.geekbang.org/account/avatar/00/25/17/39/07243e20.jpg","comment_is_top":false,"comment_ctime":1621418414,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621418414","product_id":100020901,"comment_content":"buff和cache是不是就是我们说的块缓存和页缓存的意思？","like_count":0},{"had_liked":false,"id":288256,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1618381979,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618381979","product_id":100020901,"comment_content":"比较小白，问下这一点：需要你的系统配置多块磁盘，并且磁盘分区 &#47;dev&#47;sdb1 还要处于未使用状态<br>怎么查看有多少分区？而且分区未使用<br>我晚上查询了：df -l 和 lsblk<br>是用第一个查询出来的，还是第二个查询的<br>查询出来的使用是0就是未使用吗？<br><br>","like_count":0},{"had_liked":false,"id":281908,"user_name":"Z","can_delete":false,"product_type":"c1","uid":1253772,"ip_address":"","ucode":"A0ADA997048FC8","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/8c/489792fd.jpg","comment_is_top":false,"comment_ctime":1614943269,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614943269","product_id":100020901,"comment_content":"老师，操作系统的内核缓冲区是不是对应这里讲的cache呢？","like_count":0},{"had_liked":false,"id":271975,"user_name":"…尚…","can_delete":false,"product_type":"c1","uid":1811759,"ip_address":"","ucode":"8D20B11D75C4F5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/2f/b715a7c8.jpg","comment_is_top":false,"comment_ctime":1609900675,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609900675","product_id":100020901,"comment_content":"老师，我们一个系统buffer和 cache持续缓慢增加，这该怎么分析","like_count":0},{"had_liked":false,"id":269750,"user_name":"Geek_065895","can_delete":false,"product_type":"c1","uid":2136069,"ip_address":"","ucode":"2E6FCCC78E5767","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rxz5aKicRkvqWmt6c6c7eayHvh577uibBTVQzcJKwSTqI9FaxZSRlx7NRVw4atWpqER8ncA5jErQb3wb4cPzZxlA/132","comment_is_top":false,"comment_ctime":1608776795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608776795","product_id":100020901,"comment_content":"16.<br>关键字：<br>Buffers<br>Cached<br>Slab分配器 <br>proc文件系统 <br>磁盘文件和普通文件区别<br><br>知识点：<br>Buffers:缓存磁盘数据,把分散的写集中起来统一写，也可以读<br>Cached：缓存从文件读取的数据，下次访问时无需访问磁盘，直接访问内存，也可以写<br>Slab分配器：申请内存时从伙伴系统申请，释放时并未归还伙伴系统，而是归还Slab分配器，这样子再次申请时无需从伙伴系统申请。<br>proc文件系统：可以查询内核运行状态和配置<br>磁盘文件和普通文件区别：读写普通文件会经过文件系统，读写磁盘会绕过文件系统<br><br>命令行：<br>dd<br><br>问题：<br>块设备和普通文件区别<br>读写磁盘读的是啥，写的是啥","like_count":0},{"had_liked":false,"id":267682,"user_name":"…尚…","can_delete":false,"product_type":"c1","uid":1811759,"ip_address":"","ucode":"8D20B11D75C4F5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/2f/b715a7c8.jpg","comment_is_top":false,"comment_ctime":1607870896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607870896","product_id":100020901,"comment_content":"老师，您好，free -k ,-&#47;+ buffers&#47;cache 使用缓慢增长，一段时间后增长速度变快，未能定位到问题原因！！能否排除是socket连接导致吗？","like_count":0},{"had_liked":false,"id":260559,"user_name":"jiang4357291","can_delete":false,"product_type":"c1","uid":1761912,"ip_address":"","ucode":"992E2436C69601","user_header":"","comment_is_top":false,"comment_ctime":1605060495,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605060495","product_id":100020901,"comment_content":" Linux 中块的大小是 1KB？不是512字节或者4kb吗？","like_count":0},{"had_liked":false,"id":259079,"user_name":"Geek_c6f05c","can_delete":false,"product_type":"c1","uid":2287203,"ip_address":"","ucode":"C55782050E76F3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK6Nic6V6iawbbKm3Q8nQoDF5xwZE6ZRV6daDnsoZXFr3ypfETP6CyaC1zmkYiaIcT4FFKBUFDjf3Ngw/132","comment_is_top":false,"comment_ctime":1604627525,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604627525","product_id":100020901,"comment_content":"centos 的man proc 不管用","like_count":0},{"had_liked":false,"id":253654,"user_name":"云淡风清","can_delete":false,"product_type":"c1","uid":2189657,"ip_address":"","ucode":"4F5F5C89EBF3A1","user_header":"https://static001.geekbang.org/account/avatar/00/21/69/59/fd0dcc7b.jpg","comment_is_top":false,"comment_ctime":1602819462,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1602819462","product_id":100020901,"comment_content":"在使用echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches 清理缓存时，buffer是可以完全被清理掉，但cache却不行，这会是什么原因？","like_count":0,"discussions":[{"author":{"id":1061803,"avatar":"https://static001.geekbang.org/account/avatar/00/10/33/ab/d8ba4242.jpg","nickname":"哒哒哒","note":"","ucode":"9378AD329F8AE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348331,"discussion_content":"个人的理解是有部分缓存是不可回收的，也就是slab中的不可回收部分，因此无法被清理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612514533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247822,"user_name":"汤尼房","can_delete":false,"product_type":"c1","uid":1100996,"ip_address":"","ucode":"A4D961DD9C2F74","user_header":"https://static001.geekbang.org/account/avatar/00/10/cc/c4/5ac16f31.jpg","comment_is_top":false,"comment_ctime":1599878689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599878689","product_id":100020901,"comment_content":"我的机器只有一块磁盘，无法做到老师文中说的裸IO的操作；于是想到了用dd命令创建稀疏文件，然后用losetup创建回环设备，进而尝试看是否能做到裸IO的操作，实验成功，操作步骤如下：<br># 创建稀疏文件<br>dd if=&#47;dev&#47;zero of=&#47;opt&#47;block bs=1M count=2500<br><br># 绑定到块设备上<br>losetup &#47;dev&#47;loop0 &#47;opt&#47;block<br><br># 写入该块设备<br>dd if=&#47;dev&#47;zero of=&#47;dev&#47;loop0 bs=1M count=2048 (注意of一定要写成&#47;dev&#47;loop0，否则就不是写入磁盘操作)","like_count":0},{"had_liked":false,"id":245411,"user_name":"ming","can_delete":false,"product_type":"c1","uid":2084718,"ip_address":"","ucode":"FF2C74CBA5E7BC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","comment_is_top":false,"comment_ctime":1598939449,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598939449","product_id":100020901,"comment_content":"我是否可以这样理解？读写文件系统就使用的cache，而读写磁盘就用buffer？ 如果写的文件内容需要保存到磁盘上，那可能需要先cache写文件，再通过buffer写磁盘呢？","like_count":0},{"had_liked":false,"id":245408,"user_name":"ming","can_delete":false,"product_type":"c1","uid":2084718,"ip_address":"","ucode":"FF2C74CBA5E7BC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","comment_is_top":false,"comment_ctime":1598939070,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598939070","product_id":100020901,"comment_content":"写文件虽然是通过文件系统去写的，但应该迟早会写到磁盘上吧？所以也应该会有buffer的变化？","like_count":0},{"had_liked":false,"id":245405,"user_name":"ming","can_delete":false,"product_type":"c1","uid":2084718,"ip_address":"","ucode":"FF2C74CBA5E7BC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","comment_is_top":false,"comment_ctime":1598938159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598938159","product_id":100020901,"comment_content":"buffer是读写磁盘，cache是读写文件；文件在磁盘上，那对文件操作，不就应该也会对磁盘操作吗？","like_count":0},{"had_liked":false,"id":242914,"user_name":"江湖夜雨","can_delete":false,"product_type":"c1","uid":1204399,"ip_address":"","ucode":"CC05C505FE1072","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLG44I6sZyAQWjJEibZhJ94Kdel6ljHialNWtk7p71mLUdNiaTnYCcg3lKy8mIyibALRtf75DgjMf2yQw/132","comment_is_top":false,"comment_ctime":1597891730,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597891730","product_id":100020901,"comment_content":"老师，这个buffer和cache有没有通过操作系统的配置来限制大小？","like_count":0},{"had_liked":false,"id":240960,"user_name":"酸辣土豆丝","can_delete":false,"product_type":"c1","uid":1751234,"ip_address":"","ucode":"0E3E4AFB31E1E6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b8/c2/d1904d74.jpg","comment_is_top":false,"comment_ctime":1597133348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597133348","product_id":100020901,"comment_content":"看评论学到好多","like_count":0},{"had_liked":false,"id":237864,"user_name":"青年祭司","can_delete":false,"product_type":"c1","uid":1259156,"ip_address":"","ucode":"C88EDAE3FF09AE","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/94/0b969588.jpg","comment_is_top":false,"comment_ctime":1595988924,"is_pvip":false,"discussion_count":0,"race_medal":5,"score":"1595988924","product_id":100020901,"comment_content":"感觉大部分情况下都是读写文件，裸I&#47;O的情况是不是很少","like_count":0},{"had_liked":false,"id":234488,"user_name":"为梦终醒","can_delete":false,"product_type":"c1","uid":2008722,"ip_address":"","ucode":"9784EB870F413B","user_header":"","comment_is_top":false,"comment_ctime":1594701551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594701551","product_id":100020901,"comment_content":"pagecache频繁的换入换出对性能的影响怎么样呢，实际测试结果表示，当pagecache满了以后，读写性能比直接directio都要慢。<br>请教下有什么办法可以避免这种情况吗？比如定期刷掉pagecache，防止打满。","like_count":0},{"had_liked":false,"id":231154,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593594589,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593594589","product_id":100020901,"comment_content":"buffer&#47;cache<br>\t1.buffer是对磁盘数据的缓存，既会用在读请求中，也会用在写请求中；<br>\t2.cache是文件数据的缓存，既会用在读请求中，也会用在写请求中；<br>缓冲区的好处：<br>\t1.从写的角度来说，不仅可以优化磁盘写入，对应用程序有好处，应用程序可以在数据落盘钱，就返回去做其他工作；<br>\t2.从读的角度来说，既可以加速读取那些需要频繁访问的数据，也降低了频繁 I&#47;O 对磁盘的压力；<br>通过echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches可以清空文件页，目录项，inodes等各种缓存；","like_count":0},{"had_liked":false,"id":195834,"user_name":"丁乐洪","can_delete":false,"product_type":"c1","uid":1264392,"ip_address":"","ucode":"549CE57AB20B49","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg","comment_is_top":false,"comment_ctime":1585217957,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585217957","product_id":100020901,"comment_content":"厉害了","like_count":0},{"had_liked":false,"id":192610,"user_name":"201200986","can_delete":false,"product_type":"c1","uid":1900861,"ip_address":"","ucode":"6042C42D1C904E","user_header":"","comment_is_top":false,"comment_ctime":1584863756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584863756","product_id":100020901,"comment_content":"buffer和cache的使用有没有上限呢？","like_count":0},{"had_liked":false,"id":184858,"user_name":"墨田","can_delete":false,"product_type":"c1","uid":1194703,"ip_address":"","ucode":"A1BEAF01A0F5F5","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/cf/30510276.jpg","comment_is_top":false,"comment_ctime":1583419642,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583419642","product_id":100020901,"comment_content":"直接写磁盘和文件系统， 什么情况下做什么样的选择呢？","like_count":0},{"had_liked":false,"id":181630,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1582600591,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582600591","product_id":100020901,"comment_content":"D8 打卡","like_count":0},{"had_liked":false,"id":180946,"user_name":"phantom","can_delete":false,"product_type":"c1","uid":1302631,"ip_address":"","ucode":"C4FCE4A04D32CA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/67/6db879e4.jpg","comment_is_top":false,"comment_ctime":1582447799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582447799","product_id":100020901,"comment_content":"老师，我们生产环境出现mysql库占用cache较多，因为mysql是读写文件较多，这也合理。但在cache足够多的情况下却使用了swap，这是为什么呢","like_count":0},{"had_liked":false,"id":179996,"user_name":"life_牛","can_delete":false,"product_type":"c1","uid":1150443,"ip_address":"","ucode":"39E99CD4BFA48C","user_header":"https://static001.geekbang.org/account/avatar/00/11/8d/eb/e98af40f.jpg","comment_is_top":false,"comment_ctime":1582162004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582162004","product_id":100020901,"comment_content":"buff和cache占比比较大，将内存耗尽，是否影响应用的效率？","like_count":0},{"had_liked":false,"id":175717,"user_name":"Hao","can_delete":false,"product_type":"c1","uid":1334763,"ip_address":"","ucode":"E4F3BBD3A7B173","user_header":"https://static001.geekbang.org/account/avatar/00/14/5d/eb/7bb59da7.jpg","comment_is_top":false,"comment_ctime":1580806636,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1580806636","product_id":100020901,"comment_content":"请教下，除了 echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches方式手动清理，内核有无自动清理回收cache&#47;buffer的机制","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543960,"discussion_content":"有啊，当内存不够的情况下来通过oom机制来回收","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641367424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161537,"user_name":"永","can_delete":false,"product_type":"c1","uid":1297269,"ip_address":"","ucode":"F1737EBDB046FB","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/75/0106cd63.jpg","comment_is_top":false,"comment_ctime":1576225128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576225128","product_id":100020901,"comment_content":"老师你好。Buffer 是对磁盘数据的缓存，文件比较大时才会执行 2G，而 Cache 是文件数据的缓存，文件比较小时才执行 500M 可以用这个参考吗？","like_count":0},{"had_liked":false,"id":156836,"user_name":"ouyangsheng","can_delete":false,"product_type":"c1","uid":1000623,"ip_address":"","ucode":"4D16DA1493453B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/af/79cb724c.jpg","comment_is_top":false,"comment_ctime":1574987250,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574987250","product_id":100020901,"comment_content":"buffer是用于不带文件系统的直接操作磁盘裸IO的缓存，cache是带文件系统的某个目录下的文件。目的都是积累一定的量统一读写，减少IO次数。","like_count":0},{"had_liked":false,"id":151421,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1573716467,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573716467","product_id":100020901,"comment_content":"看到cpu 结构设计中也有 cpu cache 和cpu buffer 这样的 “缓存”，buffer 是cache 之前的一次缓存(与磁盘的缓存顺序一致)。感觉这两个单词的使用有相同的地方。","like_count":0},{"had_liked":false,"id":147241,"user_name":"Mark","can_delete":false,"product_type":"c1","uid":1350902,"ip_address":"","ucode":"D60E5269080BA9","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/f6/30dfdc9f.jpg","comment_is_top":false,"comment_ctime":1572851264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572851264","product_id":100020901,"comment_content":"请教，读文件数据和读磁盘数据有什么区别？","like_count":0},{"had_liked":false,"id":143086,"user_name":"记事本","can_delete":false,"product_type":"c1","uid":1362659,"ip_address":"","ucode":"76F2CAFA309437","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/e3/447aff89.jpg","comment_is_top":false,"comment_ctime":1571628184,"is_pvip":true,"replies":[{"id":"55582","content":"试试安装手册，或者用info free试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1571840316,"ip_address":"","comment_id":143086,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571628184","product_id":100020901,"comment_content":"执行man free之后好像没看到有buffer cache的解释信息啊？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471382,"discussion_content":"试试安装手册，或者用info free试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571840316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136050,"user_name":"AB","can_delete":false,"product_type":"c1","uid":1202470,"ip_address":"","ucode":"0BB62078D5D1CA","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/26/e9594316.jpg","comment_is_top":false,"comment_ctime":1569336025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569336025","product_id":100020901,"comment_content":"写文件系统时，会缓存到cache中，如果从文件系统中写到磁盘上，会经过buffer写到磁盘么，还是直接写入磁盘","like_count":0},{"had_liked":false,"id":135809,"user_name":"zeech","can_delete":false,"product_type":"c1","uid":1484953,"ip_address":"","ucode":"BB4283A603ECEB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RzSnI5bpFSKdOsRPDhgeqvXR0SX96gqRXpcxtfibBp3EopeFC50cuAgBkua36cTGyMWiaEz5O1XzL5sOQ4F9cazA/132","comment_is_top":false,"comment_ctime":1569285049,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569285049","product_id":100020901,"comment_content":"buffer和cache，磁盘和文件缓存，directio的话可以绕过cache直接读磁盘，这样是不是直接会从buffer中读，没有命中就走磁盘io？","like_count":0},{"had_liked":false,"id":133143,"user_name":"赵国辉","can_delete":false,"product_type":"c1","uid":1166280,"ip_address":"","ucode":"390196BD3082B8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cb/c8/ff9f3ffb.jpg","comment_is_top":false,"comment_ctime":1568385446,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568385446","product_id":100020901,"comment_content":"老师，像InnoDB这样的存储引擎，是裸I&#47;O吗？麻烦老师解惑一下。","like_count":0},{"had_liked":false,"id":130877,"user_name":"Geek_27f6d8","can_delete":false,"product_type":"c1","uid":1596697,"ip_address":"","ucode":"1448853F7EE5A7","user_header":"","comment_is_top":false,"comment_ctime":1567563370,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567563370","product_id":100020901,"comment_content":"老师，请问下，我做dd if=&#47;tmp&#47;file of=&#47;dev&#47;null文件读取的时候，为什么bi并没有跟案例一样升高呢？cache有升高一点点。","like_count":0},{"had_liked":false,"id":130860,"user_name":"美美","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1567560969,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567560969","product_id":100020901,"comment_content":"可不可以简单理解，buffer等于合并写入磁盘的数据，cache是读文件数据缓存","like_count":0},{"had_liked":false,"id":128542,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1613505,"ip_address":"","ucode":"FC6E2BD6EA0637","user_header":"https://static001.geekbang.org/account/avatar/00/18/9e/c1/ff754fa8.jpg","comment_is_top":false,"comment_ctime":1566898322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566898322","product_id":100020901,"comment_content":"课后题，请大家指点错误<br>#!&#47;bin&#47;bash<br>mem=0;<br>for i in `ps aux --noheader |awk  &#39;{print $2}&#39;` ;<br>do<br>\t\tfor j in `sed -n &quot;&#47;^Pss&#47;p&quot; &#47;proc&#47;$i&#47;smaps 2&gt; &#47;dev&#47;null|awk &#39;{print $2}&#39;`;<br>\t\tdo<br>\t\t\t\tmem=$(($mem+$j));<br>\t\tdone<br>done<br>echo &quot;使用总内存为$mem&quot;;","like_count":0},{"had_liked":false,"id":121830,"user_name":"afterdream","can_delete":false,"product_type":"c1","uid":1619795,"ip_address":"","ucode":"701AD039459191","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/53/823f647c.jpg","comment_is_top":false,"comment_ctime":1565230352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565230352","product_id":100020901,"comment_content":"课后题<br>man proc，&#47;smaps查找关键字，发现如下信息<br> Accessed置位表示页被访问了，很年轻，不让换出。<br> PG_active 和 PG_referenced ，表征页的活跃程度，近期是否被访问。<br>&#47;proc&#47;&lt; pid &gt;&#47;smaps获得的内存大小，是去除了页缓存后的大小，因此更加精确<br><br>","like_count":0},{"had_liked":false,"id":121686,"user_name":"小田黑阳","can_delete":false,"product_type":"c1","uid":1615322,"ip_address":"","ucode":"86709BED0EB4CB","user_header":"https://static001.geekbang.org/account/avatar/00/18/a5/da/7dcecaa9.jpg","comment_is_top":false,"comment_ctime":1565182487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565182487","product_id":100020901,"comment_content":"倪老师，我有个疑问关于linux块大小的疑问，文章提到linux中块的大小是1KB,<br>查看centos7默认block大小为4096B即4K，如下所示：<br>[root@redis-02 ~]# xfs_growfs &#47;dev&#47;mapper&#47;centos-root<br>meta-data=&#47;dev&#47;mapper&#47;centos-root isize=512    agcount=4, agsize=1113856 blks<br>         =                       sectsz=512   attr=2, projid32bit=1<br>         =                       crc=1        finobt=0 spinodes=0<br>文中提测，拷贝500m的数据，  按1KB&#47;1个black的结论是正确的，4KB&#47;1个black的结论是错误，这个怎么解释？<br>","like_count":0},{"had_liked":false,"id":119797,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564704923,"is_pvip":true,"replies":[{"id":"44405","content":"有没有先清理缓存？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565015825,"ip_address":"","comment_id":119797,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564704923","product_id":100020901,"comment_content":"执行这个命令dd if=&#47;tmp&#47;file of=&#47;dev&#47;null ，得到的结果和你这个咋是相反的，我cache基本保持不变，buffer 组件变小<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 117080 107504 3474324    0    0     0    20  238  377  1  1 99  0  0<br> 0  0      0 117068 107504 3474332    0    0     0     0  111  213  0  0 100  0  0<br> 0  0      0 117084 107504 3474332    0    0     0     0  135  226  0  0 100  0  0<br> 0  0      0 117084 107504 3474332    0    0     0     0  121  222  0  0 100  0  0<br> 0  0      0 117084 107504 3474332    0    0     0     0   92  194  0  0 100  0  0<br> 0  1      0 148380 107408 3442816    0    0 94032    88  691  469  3  8 63 26  0<br> 0  1      0 122760 107392 3468668    0    0 106496     0  613  288  4  9 49 38  0<br> 0  1      0 113608 107304 3477624    0    0 106476    52  794  526  4 11 48 38  0<br> 0  1      0 122352 106692 3469596    0    0 110572     0  685  364  3 11 49 37  0<br> 0  1      0 106076 104532 3488492    0    0 106496     0  805  343  3 10 50 38  0<br> 0  1      0 139176  95716 3464028    0    0 107112    36  845  441  3 11 43 44  0<br> 0  1      0 133140  90324 3475664    0    0 106496     4  718  419  4 10 50 38  0<br> 0  1      0 116984  85996 3494492    0    0 107840   112  765  403  4  9 47 41  0<br> 0  1      0 140996  79804 3476896    0    0 110592     0  784  374  3 10 49 38  0<br> 0  1      0 107904  74956 3514968    0    0 103936     0  837  486  4  9 50 38  0<br> 0  1      0 116384  67268 3513988    0    0 107332     0  958  475  4 11 48 36  0<br> 0  1      0 124256  60424 3513064    0    0 110592     0  806  440  4 11 49 38  0<br> 0  1      0 123492  54248 3519804    0    0 106496    16  908  436  4  9 49 38  0<br> 0  1      0 101788  52656 3544452    0    0 102192     0 1000  470  4 10 49 38  0<br> 1  0      0 110320  49340 3539408    0    0 66968     0 1020  402  7 20 49 23  0","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461076,"discussion_content":"有没有先清理缓存？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119732,"user_name":"jaxzhai","can_delete":false,"product_type":"c1","uid":1182911,"ip_address":"","ucode":"B65A8EE7A061FC","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/bf/863d440a.jpg","comment_is_top":false,"comment_ctime":1564667407,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564667407","product_id":100020901,"comment_content":"buffer和cache长时间不回收，但是新进程的可用内存很低，我该如何查呢？","like_count":0},{"had_liked":false,"id":113427,"user_name":"昀溪","can_delete":false,"product_type":"c1","uid":1493286,"ip_address":"","ucode":"BFAF31542BC24A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","comment_is_top":false,"comment_ctime":1563005485,"is_pvip":false,"replies":[{"id":"41986","content":"不是的，写完之后buffer应该很长时间都不变。不过我的系统在测试的时候没有其他活跃的进程，不知道你的环境是不是也是这样？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563457616,"ip_address":"","comment_id":113427,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563005485","product_id":100020901,"comment_content":"老师，我在Cetnos 7.6上针对块设备的读写操作的确用到了buffer，不过结果是数据经过buffer但是不缓存。也就是说buffer从0开始出现增长，当读写操作结束后buffer回归到0，请问您的实验也是这样的么，还是说有什么区别。谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458217,"discussion_content":"不是的，写完之后buffer应该很长时间都不变。不过我的系统在测试的时候没有其他活跃的进程，不知道你的环境是不是也是这样？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563457616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109421,"user_name":"Hinimix","can_delete":false,"product_type":"c1","uid":1316937,"ip_address":"","ucode":"7994136C93BD89","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/49/b1d864e5.jpg","comment_is_top":false,"comment_ctime":1562030975,"is_pvip":false,"replies":[{"id":"39652","content":"跳过文件系统，直接读写磁盘就是裸io，比如dd","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562060215,"ip_address":"","comment_id":109421,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562030975","product_id":100020901,"comment_content":"老师，怎么能进行裸io呢，我什么操作都是在文件系统之上。分区格式化想的时候是不是裸io ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456402,"discussion_content":"跳过文件系统，直接读写磁盘就是裸io，比如dd","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562060215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108529,"user_name":"魏乐","can_delete":false,"product_type":"c1","uid":1233832,"ip_address":"","ucode":"B6D50018BE67E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d3/a8/91eed372.jpg","comment_is_top":false,"comment_ctime":1561793109,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561793109","product_id":100020901,"comment_content":"被磁盘buffer和文件cache搞懵逼了，看评论能够解惑","like_count":0},{"had_liked":false,"id":106197,"user_name":"xindoo","can_delete":false,"product_type":"c1","uid":1101718,"ip_address":"","ucode":"AEAF3208E644BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/96/251c0cee.jpg","comment_is_top":false,"comment_ctime":1561200972,"is_pvip":true,"replies":[{"id":"38368","content":"Load高说明平均活跃进程多，不代表CPU一定就高，请参考02篇平均负载的含义","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1561214020,"ip_address":"","comment_id":106197,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1561200972","product_id":100020901,"comment_content":"老师，128g的内存buffer&#47;cache占用了87g，有个java进程minflt&#47;s到了20w，24核cpu load能到25，但同时cpu使用率只有50%。看了下没有大的io，所以想问下老师这种现象可能是什么情况？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454998,"discussion_content":"Load高说明平均活跃进程多，不代表CPU一定就高，请参考02篇平均负载的含义","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561214020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544171,"discussion_content":"其实好排查，先看watch -d uptime 然后mpstat -P ALL 5 排除是否是cpu密集型和io密集型，如果是用户态高内核态低，io没有，id空闲比较低那就是cpu密集型 然后pidstat -u 3 查看去排除是否是密集进程导致cpu等待，如果%wait为0那么就是cpu密集型，下一步就是perf top -g -p pid号去详细排查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641434812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104226,"user_name":"阳光梦","can_delete":false,"product_type":"c1","uid":1283965,"ip_address":"","ucode":"55BDA128D39931","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/TTPicMEZ5s1zKiaKYecIljicRV9dibITPM0958W3VuNHXlTQic2Dj6XYGibF7dqrG3JWr0LMx7hY9zXGzuvTDNGw8KAA/132","comment_is_top":false,"comment_ctime":1560689898,"is_pvip":false,"replies":[{"id":"37820","content":"比如直接读写 &#47;dev&#47;sda 而不是读写它挂载之后某个目录中的文件","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560764620,"ip_address":"","comment_id":104226,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560689898","product_id":100020901,"comment_content":"这章听得晕。第一次听读写磁盘 和 读写文件，之前只听过读写文件。至今不清楚啥算读写磁盘？谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454178,"discussion_content":"比如直接读写 /dev/sda 而不是读写它挂载之后某个目录中的文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560764620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103441,"user_name":"croco","can_delete":false,"product_type":"c1","uid":1174302,"ip_address":"","ucode":"F6EA7616724881","user_header":"https://static001.geekbang.org/account/avatar/00/11/eb/1e/cbd63297.jpg","comment_is_top":false,"comment_ctime":1560435977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560435977","product_id":100020901,"comment_content":"https:&#47;&#47;unix.stackexchange.com&#47;questions&#47;33381&#47;getting-information-about-a-process-memory-usage-from-proc-pid-smaps<br>看了这篇文章，还是没有完全搞懂物理内存该怎么查 man proc里面对应部分描述很模糊。RSS是私有加共享看明白了。PSS就完全蒙了。 私有相加可以算出物理内存，但是公有部分就不知道该如何算了","like_count":0},{"had_liked":false,"id":101008,"user_name":"小飞","can_delete":false,"product_type":"c1","uid":1000347,"ip_address":"","ucode":"4C126548FBA94C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/9b/50927dfc.jpg","comment_is_top":false,"comment_ctime":1559700253,"is_pvip":false,"replies":[{"id":"37106","content":"buffer 6G 应该是看错了吧？第4列是free。<br><br>这里的理解是对的。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560261291,"ip_address":"","comment_id":101008,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1559700253","product_id":100020901,"comment_content":"老师的文中提及 buffer 一般20MB 左右。 查看proc 文档， 也是类似的。 <br>“Buffers %lu<br>             Relatively temporary storage for raw disk blocks that shouldn&#39;t get tremendously large (20MB or so).“<br><br>当看到真实直接写磁盘过程中， buffer 会很大。 例如<br><br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>1  0      0 7584780 153592  97436    0    0   684     0   31  423  1 48 50  2  0<br> 1  0      0 7418580 315384 101668    0    0     0     0   32  144  0 50 50  0  0<br> 1  0      0 7253664 475844 106208    0    0     0     0   20  137  0 50 50  0  0<br> 1  0      0 7093352 631800 110520    0    0     0     0   23  223  0 50 50  0  0<br> 1  1      0 6930056 790520 114980    0    0     0 12804   23  168  0 50 42  9  0<br> 1  0      0 6757204 949240 119396    0    0     0 183804   24  191  0 53 26 21  0<br> 1  1      0 6591516 1107960 123840    0    0     0 77316   22  232  0 52 16 33  0<br><br>buffer 使用已经到6GB 了。 远远超过20MB . <br>我理解buffer 和cache 本质其实都是内存，按需申请、释放。 没有明确的大小限制。 只是用途不一样而已。 <br>这样的理解对吗？<br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452775,"discussion_content":"buffer 6G 应该是看错了吧？第4列是free。\n\n这里的理解是对的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560261291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544174,"discussion_content":"你vmstat -w 就可以看的更清楚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641434938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89464,"user_name":"manatee","can_delete":false,"product_type":"c1","uid":1041112,"ip_address":"","ucode":"708D90E7A265BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg","comment_is_top":false,"comment_ctime":1556179604,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556179604","product_id":100020901,"comment_content":"老师我在进行磁盘写的实验中并没有发现buff增高，而是发现cache在涨，我是在vmware workstation中创建的ubuntu 16.04,还请老师帮忙解惑<br>dd if=&#47;dev&#47;urandom of=&#47;dev&#47;sdb1 bs=1M count=100<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 3712916   1984 169976    0    0   173    87   90  138  0  6 91  2  0<br> 1  0      0 3702624   1984 180180    0    0     0     0  331  192  0 50 50  0  0<br> 1  0      0 3693416   1984 189460    0    0     0     0  300  149  0 50 50  0  0<br> 1  0      0 3684364   1984 198616    0    0     0     0  283  121  1 50 49  0  0<br> 2  1      0 3673540   2144 208276    0    0   428     0  441  281  0 51 35 14  0<br> 1  0      0 3664768   2144 217568    0    0     4     0  332  183  0 51 49  1  0<br> 1  0      0 3654600   2144 227756    0    0     0     0  284  104  0 50 50  0  0<br> 1  0      0 3645300   2144 237088    0    0     0     0  287  111  0 50 50  0  0<br> 0  0      0 3636140   2280 246456    0    0   312     0  321  193  1 43 51  5  0<br> 0  0      0 3636140   2280 246444    0    0     0     0   71  157  0  0 100  0  0<br> 0  0      0 3636016   2288 246436    0    0     0    36   82  164  0  1 100  0  0<br> 0  0      0 3636016   2288 246448    0    0     0     0   72  150  0  0 100  0  0<br> 0  0      0 3636016   2288 246448    0    0     0     0   67  156  0  0 100  0  0<br> 0  0      0 3636016   2288 246448    0    0     0     0   56  121  0  0 100  0  0<br> 0  0      0 3636016   2288 246448    0    0     0     0   74  170  0  0 100  0  0<br> 0  0      0 3636016   2288 246448    0    0     0     0   67  138  0  0 100  0  0<br>","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560442,"discussion_content":"vmware测试不准确，我是买的物理机测试的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649330854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88917,"user_name":"火狼王","can_delete":false,"product_type":"c1","uid":1152184,"ip_address":"","ucode":"76919311EA41A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/b8/09d86400.jpg","comment_is_top":false,"comment_ctime":1556026518,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556026518","product_id":100020901,"comment_content":"dx","like_count":0},{"had_liked":false,"id":87715,"user_name":"manatee","can_delete":false,"product_type":"c1","uid":1041112,"ip_address":"","ucode":"708D90E7A265BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg","comment_is_top":false,"comment_ctime":1555668579,"is_pvip":false,"replies":[{"id":"31673","content":"请参考后面的磁盘和文件系统部分","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555856033,"ip_address":"","comment_id":87715,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555668579","product_id":100020901,"comment_content":"老师，文件和磁盘又有什么区别呢，文件不也是写在磁盘上的数据吗，小白问题，还请老师不要见笑","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447573,"discussion_content":"请参考后面的磁盘和文件系统部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555856033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85849,"user_name":"leolin","can_delete":false,"product_type":"c1","uid":1462408,"ip_address":"","ucode":"C73E5D168CEE6B","user_header":"","comment_is_top":false,"comment_ctime":1555256514,"is_pvip":false,"replies":[{"id":"31288","content":"请参考22答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555500826,"ip_address":"","comment_id":85849,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555256514","product_id":100020901,"comment_content":"思考题中的统计使用的物理内存，不可以使用 ps aux 中的 RSS 相加么？按理说 RSS 指的就是进程所占用的物理内存啊，难道是要把共享内存也算进去？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446837,"discussion_content":"请参考22答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555500826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75702,"user_name":"Sylh","can_delete":false,"product_type":"c1","uid":1147961,"ip_address":"","ucode":"F6B87D15A9AF95","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIicbH65wBhSCWa5eBF4gFaia5ngkttTzprdicJaDcOMgwAYrFbpQfJ0z6OichE6qphpicqsq87Lam0X5A/132","comment_is_top":false,"comment_ctime":1552452831,"is_pvip":false,"replies":[{"id":"28043","content":"请参考19和20篇讲SWAP的原理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552748870,"ip_address":"","comment_id":75702,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1552452831","product_id":100020901,"comment_content":"有个关于内存的问题请教下， <br><br>free命令 available字段显示 还有可用内存，但检查发现系统已经开始使用交换分区了。<br><br>Cache和buffer占用了大部分内存。<br><br>系统不会主动释放cache的内存吗<br><br>为什么会开始使用交换分区？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442988,"discussion_content":"请参考19和20篇讲SWAP的原理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552748870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544180,"discussion_content":"那肯定是没有触发oom机制回收内存，你要是把交换关闭他肯定内存不够，就会触发oom回收内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641435050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75596,"user_name":"Len","can_delete":false,"product_type":"c1","uid":1022767,"ip_address":"","ucode":"53C623CE17973F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/2f/b7a3625e.jpg","comment_is_top":false,"comment_ctime":1552438722,"is_pvip":true,"replies":[{"id":"28041","content":"挂载的都是文件系统，不再是直接磁盘读写了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552748791,"ip_address":"","comment_id":75596,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552438722","product_id":100020901,"comment_content":"🍎老师我有点不好意思，如果对当前 Linux 下各个目录中的文件进行读写，那就是普通文件的读写。如果有另一块磁盘，我们直接对这块磁盘读写，或以目录的形式挂载到当前 Linux 系统下，那这就是磁盘读写（或称作裸设备读写）。请问老师，这样理解对吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442956,"discussion_content":"挂载的都是文件系统，不再是直接磁盘读写了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552748791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70641,"user_name":"豆腐居士","can_delete":false,"product_type":"c1","uid":1100239,"ip_address":"","ucode":"F7C82FEB60C2B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/cf/af720d94.jpg","comment_is_top":false,"comment_ctime":1551151861,"is_pvip":false,"replies":[{"id":"25705","content":"这不是看到了吗，被缓存占了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551399045,"ip_address":"","comment_id":70641,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551151861","product_id":100020901,"comment_content":"top 查看16内存被吃光 但是没有看到占用内存比较高的进程是什么情况？free 查看是buffers&#47;cache占用内存比较多","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440746,"discussion_content":"这不是看到了吗，被缓存占了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551399045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67690,"user_name":"贼道","can_delete":false,"product_type":"c1","uid":1049316,"ip_address":"","ucode":"CFC6727249C815","user_header":"","comment_is_top":false,"comment_ctime":1550223270,"is_pvip":false,"replies":[{"id":"24044","content":"还没有这样的工具😓","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550326147,"ip_address":"","comment_id":67690,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1550223270","product_id":100020901,"comment_content":"老师，centos7怎么能查看系统里的cache和buffer被哪些进程占用？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439330,"discussion_content":"还没有这样的工具😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550326147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":544183,"discussion_content":"老师你写一个这样的工具吧肯定受欢迎","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641435140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":439330,"ip_address":""},"score":544183,"extra":""}]}]},{"had_liked":false,"id":65149,"user_name":"lq","can_delete":false,"product_type":"c1","uid":1112815,"ip_address":"","ucode":"1C9D741B906403","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/ef/9d3fcb40.jpg","comment_is_top":false,"comment_ctime":1549076976,"is_pvip":false,"replies":[{"id":"23136","content":"这就需要多实践总结了，实践多了自然也就记住了。另外，碰到的问题和解决方法最好记录下来，方便后续参考","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1549161050,"ip_address":"","comment_id":65149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549076976","product_id":100020901,"comment_content":"线上出问题，往往没有太多时间查手册找含义，大神有什么好的快速的思路，","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438335,"discussion_content":"这就需要多实践总结了，实践多了自然也就记住了。另外，碰到的问题和解决方法最好记录下来，方便后续参考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549161050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62845,"user_name":"阿巍-豆夫","can_delete":false,"product_type":"c1","uid":1005123,"ip_address":"","ucode":"732188848B0A85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1548171908,"is_pvip":false,"replies":[{"id":"22340","content":"没有，最大值可以理解为总内存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548252099,"ip_address":"","comment_id":62845,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548171908","product_id":100020901,"comment_content":"老师请教下，Linux下buffer 和cache 的最大值是否有相关配置。 ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437370,"discussion_content":"没有，最大值可以理解为总内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548252099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62206,"user_name":"萨拉热窝的棒小伙儿","can_delete":false,"product_type":"c1","uid":1338869,"ip_address":"","ucode":"D691CBAC4BC17A","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIU2IArYKPQ6l7DtsNERJW9NCiaHJ0uG89JRcV4M1QAiaSDPUVr6KVPbEvA24TPn1EwpRUGI7diarLFg/132","comment_is_top":false,"comment_ctime":1547982706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547982706","product_id":100020901,"comment_content":"从写的角度来说，不仅可以优化磁盘和文件的写入，对应用程序也有好处，应用程序可以在数据真正落盘前，就返回去做其他工作。<br>落盘前，就返回去做其他工作，怎么理解，能举例嘛，老师","like_count":0},{"had_liked":false,"id":58455,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1547085475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547085475","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":57340,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1546755662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546755662","product_id":100020901,"comment_content":"我是6.10的centos （3.10.5-3.el6.x86_64），但是man proc里面查找meminfo，只显示以下内容：<br> &#47;proc&#47;meminfo<br>              This file reports statistics about memory usage on the system.  It is used by free(1) to report the amount of free and used memory  (both<br>              physical and swap) on the system as well as the shared memory and buffers used by the kernel.<br><br>       &#47;proc&#47;modules<br>","like_count":0},{"had_liked":false,"id":57326,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1546748971,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546748971","product_id":100020901,"comment_content":"DAY16,打卡","like_count":0},{"had_liked":false,"id":57257,"user_name":"张挺","can_delete":false,"product_type":"c1","uid":1038954,"ip_address":"","ucode":"CDF8549440926D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/da/6a/91bd13de.jpg","comment_is_top":false,"comment_ctime":1546699957,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546699957","product_id":100020901,"comment_content":"您好，思考题里的计算所有进程的物理内存使用量，是把&#47;proc&#47;1&#47;smaps下的Rss值相加吗？","like_count":0},{"had_liked":false,"id":57082,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":1258789,"ip_address":"","ucode":"63A002997462E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/35/25/bab760a1.jpg","comment_is_top":false,"comment_ctime":1546617070,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546617070","product_id":100020901,"comment_content":"# 首先清理缓存<br>$ echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches<br># 然后运行 dd 命令向磁盘分区 &#47;dev&#47;sdb1 写入 2G 数据<br>$ dd if=&#47;dev&#47;urandom of=&#47;dev&#47;sdb1 bs=1M count=2048<br>没注意磁盘写坏了","like_count":0},{"had_liked":false,"id":56833,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1546565820,"is_pvip":false,"replies":[{"id":"21313","content":"这是vmstat文档中的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547259103,"ip_address":"","comment_id":56833,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546565820","product_id":100020901,"comment_content":"文中提到linux块的大小是1KB，请问这个如何查证？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435266,"discussion_content":"这是vmstat文档中的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547259103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55111,"user_name":"郭刚","can_delete":false,"product_type":"c1","uid":1292032,"ip_address":"","ucode":"22CB8ECE8E3DCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg","comment_is_top":false,"comment_ctime":1546045729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546045729","product_id":100020901,"comment_content":"文中因为 Linux 中块的大小是 1KB。老师，块不是默认是4K吗？","like_count":0},{"had_liked":false,"id":54984,"user_name":"zylv","can_delete":false,"product_type":"c1","uid":1210173,"ip_address":"","ucode":"D90E50E78B5B2D","user_header":"https://static001.geekbang.org/account/avatar/00/12/77/3d/d998a34f.jpg","comment_is_top":false,"comment_ctime":1545992632,"is_pvip":false,"replies":[{"id":"19911","content":"第17讲有案例，后面IO也会有","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546001662,"ip_address":"","comment_id":54984,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545992632","product_id":100020901,"comment_content":"能用实际例子去说明cache和buffer的区别吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434640,"discussion_content":"第17讲有案例，后面IO也会有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546001662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54764,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545960540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545960540","product_id":100020901,"comment_content":"mark ","like_count":0},{"had_liked":false,"id":54758,"user_name":"React","can_delete":false,"product_type":"c1","uid":1100554,"ip_address":"","ucode":"A176EF0AA242B5","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/0a/6a9e6602.jpg","comment_is_top":false,"comment_ctime":1545960286,"is_pvip":false,"replies":[{"id":"19930","content":"会的，系统会帮你回收，所以大部分情况下不需要人工介入。但偶尔也会出现不合理的缓存使用情况，比如数据库所在系统被批处理的脚本占满了缓存，这些批处理任务运行时就会影响数据库性能，这时候才需要人工清理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546003816,"ip_address":"","comment_id":54758,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545960286","product_id":100020901,"comment_content":"老师好，buffer和cache会消耗实际的物理内存吗？如果消耗，是不是需要定时清理一下buffer和cache","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434554,"discussion_content":"会的，系统会帮你回收，所以大部分情况下不需要人工介入。但偶尔也会出现不合理的缓存使用情况，比如数据库所在系统被批处理的脚本占满了缓存，这些批处理任务运行时就会影响数据库性能，这时候才需要人工清理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546003816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54721,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545957280,"is_pvip":false,"replies":[{"id":"19935","content":"2.6有点出乎我的意料了。再确认下你的系统中是不是真的有磁盘分区 sdb1？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546004747,"ip_address":"","comment_id":54721,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545957280","product_id":100020901,"comment_content":"系统是2.6的，cache 大于buffer 增长速度","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434545,"discussion_content":"2.6有点出乎我的意料了。再确认下你的系统中是不是真的有磁盘分区 sdb1？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546004747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54638,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1545920751,"is_pvip":false,"replies":[{"id":"19947","content":"这计算的有点太多了，把好多kernel的page也计算在内了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005818,"ip_address":"","comment_id":54638,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545920751","product_id":100020901,"comment_content":"cat &#47;proc&#47;*&#47;smaps | grep Size | awk &#39;{print$2}&#39; |awk &#39;{sum += $1} END {print sum&#47;1024}&#39;<br><br>对么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434521,"discussion_content":"这计算的有点太多了，把好多kernel的page也计算在内了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54637,"user_name":"zhaozheng","can_delete":false,"product_type":"c1","uid":1318961,"ip_address":"","ucode":"760BCDFCFA5064","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLHGYFKjvRiaia82t68OGkqvtIFvibZCmA3OKA1kj9vWaqQhYgKIqa94nKcmq1pbf6Efx4sO4yUHXEDA/132","comment_is_top":false,"comment_ctime":1545920409,"is_pvip":false,"replies":[{"id":"19948","content":"IO模块会介绍的，现在先理解缓存的整体概念和缓存即可","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005876,"ip_address":"","comment_id":54637,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545920409","product_id":100020901,"comment_content":"关于裸io和读写文件的io的区别，老师能不能具体描述一下。<br><br>关于读写文件的流程，里面有太多的缓存的概念了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434520,"discussion_content":"IO模块会介绍的，现在先理解缓存的整体概念和缓存即可","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54466,"user_name":"阿巍-豆夫","can_delete":false,"product_type":"c1","uid":1005123,"ip_address":"","ucode":"732188848B0A85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1545876459,"is_pvip":false,"replies":[{"id":"19956","content":"因为会把磁盘数据写坏","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546006834,"ip_address":"","comment_id":54466,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545876459","product_id":100020901,"comment_content":"案例二中要指定sdb1，你说需要两块盘， 否则对于磁盘分区有损耗，那什么会有损耗呢？ 不是不是说直接的磁盘读写本身就是损耗，有点蒙圈。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434461,"discussion_content":"因为会把磁盘数据写坏","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546006834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54413,"user_name":"金波","can_delete":false,"product_type":"c1","uid":1315886,"ip_address":"","ucode":"A50860CA422EBB","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/2e/400913b1.jpg","comment_is_top":false,"comment_ctime":1545862912,"is_pvip":false,"replies":[{"id":"19980","content":"在Linux中一般都是根分区文件系统中的一个子目录，而不是基于内存的临时文件系统。即便是基于内存，现象也是类似的，根据具体场景的不同，有可能是使用cache，也有可能使用共享内存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546044463,"ip_address":"","comment_id":54413,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545862912","product_id":100020901,"comment_content":"老师没明白我之前留言的意思，因为&#47;tmp下的文件很多都是内存文件系统，所以我问&#47;tmp&#47;file是磁盘的一个文件吗？还是基于内存的。这个没澄清。如果内存文件系统，那测试buffer&#47;Cache的结果会一样吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434448,"discussion_content":"在Linux中一般都是根分区文件系统中的一个子目录，而不是基于内存的临时文件系统。即便是基于内存，现象也是类似的，根据具体场景的不同，有可能是使用cache，也有可能使用共享内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546044463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54386,"user_name":"蒋良权","can_delete":false,"product_type":"c1","uid":1236189,"ip_address":"","ucode":"5A355D37948D59","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/dd/cf9e4ade.jpg","comment_is_top":false,"comment_ctime":1545840126,"is_pvip":false,"replies":[{"id":"19958","content":"看具体的数据库了，比如mysql使用文件系统来存储数据文件，比如binlog、数据表等等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546007359,"ip_address":"","comment_id":54386,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545840126","product_id":100020901,"comment_content":"老师，mysql等数据库使用文件系统跟使用磁盘裸IO哪个性能更好点？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434442,"discussion_content":"看具体的数据库了，比如mysql使用文件系统来存储数据文件，比如binlog、数据表等等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546007359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54276,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1545820001,"is_pvip":false,"replies":[{"id":"19693","content":"当然也有","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545832923,"ip_address":"","comment_id":54276,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545820001","product_id":100020901,"comment_content":"读取网上来的信息有缓存吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434415,"discussion_content":"当然也有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54221,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1545809548,"is_pvip":false,"replies":[{"id":"19697","content":"这是一个特殊的空洞设备，写入的任何数据都直接丢掉","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545834769,"ip_address":"","comment_id":54221,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545809548","product_id":100020901,"comment_content":"困惑老师已经置顶回复了，还有一个小问题，<br>场景：读取文件&#47;tmp&#47;file，写入到&#47;dev&#47;null<br><br>前半部分是文件读，那后半部分的写入是什么呢？（文件读写、磁盘读写）","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434397,"discussion_content":"这是一个特殊的空洞设备，写入的任何数据都直接丢掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545834769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54202,"user_name":"淸曉","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1545805122,"is_pvip":false,"replies":[{"id":"19982","content":"不能直接分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546044516,"ip_address":"","comment_id":54202,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1545805122","product_id":100020901,"comment_content":"老师您好！<br>关于您讲述的文章，我可以做成博客分享吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434392,"discussion_content":"不能直接分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546044516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544186,"discussion_content":"兄弟呀，你分享了别人不就会了，他会了你就完犊子了，不能让他知道哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641435406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54199,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1545804866,"is_pvip":false,"replies":[{"id":"19698","content":"这是版本不同导致的，不过可以用相同的方法来理解。<br><br>我一直在提查文档的方法，就是强调要以自己系统的实际情况为准","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545835024,"ip_address":"","comment_id":54199,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545804866","product_id":100020901,"comment_content":"老师您好，在我的机子上 man free ，列出的 cache  并不是 Cached 与 SReclaimable 之和，而是 Cached and  Slab，而 Slab 又分为 SReclaimable 和 SUnreclaim，这样和文章讲的不太一样呀，希望老师解释一下~<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434390,"discussion_content":"这是版本不同导致的，不过可以用相同的方法来理解。\n\n我一直在提查文档的方法，就是强调要以自己系统的实际情况为准","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545835024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54154,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545798052,"is_pvip":false,"replies":[{"id":"19707","content":"系统版本？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545836080,"ip_address":"","comment_id":54154,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545798052","product_id":100020901,"comment_content":"centos，还是有些不一样","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434373,"discussion_content":"系统版本？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545836080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54103,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1545794222,"is_pvip":false,"replies":[{"id":"19716","content":"文件的读写最终还是会反应到磁盘读写中，只不过由于缓存的存在，磁盘读写不一定是同步的。buffer没有变可能是因为系统版本比较老，用的是什么系统？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545837895,"ip_address":"","comment_id":54103,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545794222","product_id":100020901,"comment_content":"感觉实际中磁盘的写入和读不是很多，磁盘读写针对磁盘的物理卷了，只有文件的读写。我的机器上buffer数值一直没变，cache有点变化，","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434357,"discussion_content":"文件的读写最终还是会反应到磁盘读写中，只不过由于缓存的存在，磁盘读写不一定是同步的。buffer没有变可能是因为系统版本比较老，用的是什么系统？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545837895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54056,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1545789996,"is_pvip":false,"replies":[{"id":"19720","content":"磁盘读写，通常用在数据库或者文件系统的实现这些需要自己管理数据的场景中；其他大部分场景使用文件读写就足够了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545838839,"ip_address":"","comment_id":54056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545789996","product_id":100020901,"comment_content":"老师，磁盘读写和文件读写有什么区别，分别适用在什么样的场景？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434342,"discussion_content":"磁盘读写，通常用在数据库或者文件系统的实现这些需要自己管理数据的场景中；其他大部分场景使用文件读写就足够了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545838839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54049,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1545789409,"is_pvip":false,"replies":[{"id":"19566","content":"cache有个小typo😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545792072,"ip_address":"","comment_id":54049,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545789409","product_id":100020901,"comment_content":"【D15打卡补充】<br>早晨打卡，自己留言说 读写磁盘的时候，cacahe也增加了，觉得可能和文件系统有关，后面经过老师的解答和上网查资料，原来cacahe增加是因为cacahe还保存了元数据<br><br>裸磁盘的数据缓存到到buffer里，cache缓存其他的元数据<br>结论:<br>buffer缓存磁盘数据，读写都缓存<br>cacahe缓存文件系统数据，读写都缓存","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434339,"discussion_content":"cache有个小typo😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545792072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54039,"user_name":"好说","can_delete":false,"product_type":"c1","uid":1211019,"ip_address":"","ucode":"58E861D711D935","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/8b/2c81a375.jpg","comment_is_top":false,"comment_ctime":1545788201,"is_pvip":false,"replies":[{"id":"19721","content":"I&#47;O部分会讲它们的原理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545838866,"ip_address":"","comment_id":54039,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545788201","product_id":100020901,"comment_content":"老师，那什么是磁盘数据，什么又是文件数据呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434337,"discussion_content":"I/O部分会讲它们的原理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545838866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54035,"user_name":"八怪","can_delete":false,"product_type":"c1","uid":1328234,"ip_address":"","ucode":"A9200AC057BDAD","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/6a/49f026af.jpg","comment_is_top":false,"comment_ctime":1545787951,"is_pvip":false,"replies":[{"id":"19722","content":"O_DIRECT 会绕过缓存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545839356,"ip_address":"","comment_id":54035,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545787951","product_id":100020901,"comment_content":"裸盘 和 文件系统  o_direct 就不过了 ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434334,"discussion_content":"O_DIRECT 会绕过缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545839356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53996,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1196791,"ip_address":"","ucode":"D3EFE8729DDE8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/42/f7/9dce9a7b.jpg","comment_is_top":false,"comment_ctime":1545784663,"is_pvip":false,"replies":[{"id":"19547","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545787843,"ip_address":"","comment_id":53996,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545784663","product_id":100020901,"comment_content":"磁盘和文件读写区别是操作系统知识吧。我想的是，磁盘读写指ext3文件系统，标准磁盘文件系统。文件读写，指Linux的虚拟文件系统VFS，inode就是其中的单个文件。不知道对不对，求老师指正。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434317,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545787843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53990,"user_name":"Cranliu","can_delete":false,"product_type":"c1","uid":1304302,"ip_address":"","ucode":"DC2DE84B142FDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/ee/e3c4c9b3.jpg","comment_is_top":false,"comment_ctime":1545784476,"is_pvip":false,"replies":[{"id":"19728","content":"请参考置顶回复，下一期会讲两种缓存的区别","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840049,"ip_address":"","comment_id":53990,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545784476","product_id":100020901,"comment_content":"磁盘数据缓存和文件数据缓存的区别，以及引入这两个概念的意义能说一下吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434314,"discussion_content":"请参考置顶回复，下一期会讲两种缓存的区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53981,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1545783905,"is_pvip":false,"replies":[{"id":"19729","content":"新的留言已经弄明白了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840131,"ip_address":"","comment_id":53981,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545783905","product_id":100020901,"comment_content":"【D15打卡】<br>Buffer缓存磁盘数据<br>Cache缓存文件数据<br>但是写读写磁盘的时候，cache也会增长，只是没有buffer多，所以应该能验证读写磁盘是会经过文件系统的吧，不过具体的细节和原理，还有待研究","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434311,"discussion_content":"新的留言已经弄明白了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53972,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1545783412,"is_pvip":false,"replies":[{"id":"19730","content":"👍 ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840151,"ip_address":"","comment_id":53972,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545783412","product_id":100020901,"comment_content":"打卡day17<br>free中显示的buffer和cache之前单纯以为就是写缓冲与读缓存，通过今天的讲解，准确的理解应该是buffer缓存对磁盘(块设备)的读和写数据，cache是缓存对文件的读和写数据，👍","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434307,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53971,"user_name":"玉剑冰锋","can_delete":false,"product_type":"c1","uid":1214202,"ip_address":"","ucode":"8EA56A71BA5B22","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg","comment_is_top":false,"comment_ctime":1545783411,"is_pvip":false,"replies":[{"id":"19731","content":"这是我系统中没有使用的一个磁盘分区，在实践时可以换成你自己的其他分区，不过要确保确实是没用的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840214,"ip_address":"","comment_id":53971,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545783411","product_id":100020901,"comment_content":"案例二中为什么非要指定sdb1?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434306,"discussion_content":"这是我系统中没有使用的一个磁盘分区，在实践时可以换成你自己的其他分区，不过要确保确实是没用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53956,"user_name":"冰块","can_delete":false,"product_type":"c1","uid":1272694,"ip_address":"","ucode":"36DC4B5DDA267A","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/76/357291e1.jpg","comment_is_top":false,"comment_ctime":1545782024,"is_pvip":false,"replies":[{"id":"19732","content":"没有写回磁盘的称为脏页，这些脏页还在cache中。具体磁盘和文件系统的原理在I&#47;O部分讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840359,"ip_address":"","comment_id":53956,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545782024","product_id":100020901,"comment_content":"请教下老师：<br>Cached 是从磁盘读取文件的页缓存，也就是用来缓存从文件读取的数据。<br>这部分数据应该可以修改的吧 修改了之后不就是修改了磁盘上的文件数据 <br>如果没有立即写回磁盘  那这和buffer磁盘文件区别在哪里<br>还是感觉有点迷","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434301,"discussion_content":"没有写回磁盘的称为脏页，这些脏页还在cache中。具体磁盘和文件系统的原理在I/O部分讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53952,"user_name":"俊飞","can_delete":false,"product_type":"c1","uid":1137490,"ip_address":"","ucode":"A67B07520E0715","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/52/fea5ec99.jpg","comment_is_top":false,"comment_ctime":1545781001,"is_pvip":false,"replies":[{"id":"19550","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545787902,"ip_address":"","comment_id":53952,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545781001","product_id":100020901,"comment_content":"老师，文章中提到写文件时会用到 Cache 缓存数据，而写磁盘则会用到 Buffer，这里的写文件和写磁盘该如何理解呢？写文件不是也是写到磁盘上的么？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434299,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545787902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53950,"user_name":"ykkk88","can_delete":false,"product_type":"c1","uid":1068585,"ip_address":"","ucode":"A1BCFC2F0D1022","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/29/1be3dd40.jpg","comment_is_top":false,"comment_ctime":1545780446,"is_pvip":false,"replies":[{"id":"19549","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545787894,"ip_address":"","comment_id":53950,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1545780446","product_id":100020901,"comment_content":"读写文件和读写磁盘直接有啥区别呢 会造成buffer和cache的行为不一致","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434298,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545787894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}