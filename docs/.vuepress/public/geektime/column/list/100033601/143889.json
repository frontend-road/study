{"id":143889,"title":"25 | 页面性能：如何系统地优化页面？","content":"<p>在前面几篇文章中，我们分析了页面加载和DOM生成，讨论了JavaScript和CSS是如何影响到DOM生成的，还结合渲染流水线来讲解了分层和合成机制，同时在这些文章里面，我们还穿插说明了很多优化页面性能的最佳实践策略。通过这些知识点的学习，相信你已经知道渲染引擎是怎么绘制出帧的，不过之前我们介绍的内容比较零碎、比较散，那么今天我们就来将这些内容系统性地串起来。</p><p>那么怎么才能把这些知识点串起来呢？我的思路是从如何系统优化页面速度的角度来切入。</p><p><strong>这里我们所谈论的页面优化，其实就是要让页面更快地显示和响应</strong>。由于一个页面在它不同的阶段，所侧重的关注点是不一样的，所以如果我们要讨论页面优化，就要分析一个页面生存周期的不同阶段。</p><p>通常一个页面有三个阶段：<strong>加载阶段、交互阶段和关闭阶段</strong>。</p><ul>\n<li>加载阶段，是指从发出请求到渲染出完整页面的过程，影响到这个阶段的主要因素有网络和JavaScript脚本。</li>\n<li>交互阶段，主要是从页面加载完成到用户交互的整合过程，影响到这个阶段的主要因素是JavaScript脚本。</li>\n<li>关闭阶段，主要是用户发出关闭指令后页面所做的一些清理操作。</li>\n</ul><p>这里我们需要<strong>重点关注加载阶段和交互阶段</strong>，因为影响到我们体验的因素主要都在这两个阶段，下面我们就来逐个详细分析下。</p><!-- [[[read_end]]] --><h2>加载阶段</h2><p>我们先来分析如何系统优化加载阶段中的页面，还是先看一个典型的渲染流水线，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/5d/7b/5d8716586b5f4d719097dca881007a7b.jpg?wh=1142*459\" alt=\"\"></p><center><span class=\"reference\">加载阶段渲染流水线</span></center><p>观察上面这个渲染流水线，你能分析出来有哪些因素影响了页面加载速度吗？下面我们就先来分析下这个问题。</p><p>通过前面文章的讲解，你应该已经知道了并非所有的资源都会阻塞页面的首次绘制，比如图片、音频、视频等文件就不会阻塞页面的首次渲染；而JavaScript、首次请求的HTML资源文件、CSS文件是会阻塞首次渲染的，因为在构建DOM的过程中需要HTML和JavaScript文件，在构造渲染树的过程中需要用到CSS文件。</p><p>我们把<strong>这些能阻塞网页首次渲染的资源称为关键资源</strong>。基于关键资源，我们可以继续细化出来三个影响页面首次渲染的核心因素。</p><p><strong>第一个是关键资源个数</strong>。关键资源个数越多，首次页面的加载时间就会越长。比如上图中的关键资源个数就是3个，1个HTML文件、1个JavaScript和1个CSS文件。</p><p><strong>第二个是关键资源大小</strong>。通常情况下，所有关键资源的内容越小，其整个资源的下载时间也就越短，那么阻塞渲染的时间也就越短。上图中关键资源的大小分别是6KB、8KB和9KB，那么整个关键资源大小就是23KB。</p><p><strong>第三个是请求关键资源需要多少个RTT（Round Trip Time）</strong>。那什么是RTT呢？ 在<a href=\"https://time.geekbang.org/column/article/113550\">《02 | TCP协议：如何保证页面文件能被完整送达浏览器？》</a>这篇文章中我们分析过，当使用TCP协议传输一个文件时，比如这个文件大小是0.1M，由于TCP的特性，这个数据并不是一次传输到服务端的，而是需要拆分成一个个数据包来回多次进行传输的。<strong>RTT就是这里的往返时延。它是网络中一个重要的性能指标，表示从发送端发送数据开始，到发送端收到来自接收端的确认，总共经历的时延</strong>。通常1个HTTP的数据包在14KB左右，所以1个0.1M的页面就需要拆分成8个包来传输了，也就是说需要8个RTT。</p><p>我们可以结合上图来看看它的关键资源请求需要多少个RTT。首先是请求HTML资源，大小是6KB，小于14KB，所以1个RTT就可以解决了。至于JavaScript和CSS文件，这里需要注意一点，由于渲染引擎有一个预解析的线程，在接收到HTML数据之后，预解析线程会快速扫描HTML数据中的关键资源，一旦扫描到了，会立马发起请求，你可以认为JavaScript和CSS是同时发起请求的，所以它们的请求是重叠的，那么计算它们的RTT时，只需要计算体积最大的那个数据就可以了。这里最大的是CSS文件（9KB），所以我们就按照9KB来计算，同样由于9KB小于14KB，所以JavaScript和CSS资源也就可以算成1个RTT。也就是说，上图中关键资源请求共花费了2个RTT。</p><p>了解了影响加载过程中的几个核心因素之后，接下来我们就可以系统性地考虑优化方案了。<strong>总的优化原则就是减少关键资源个数，降低关键资源大小，降低关键资源的RTT次数</strong>。</p><ul>\n<li>如何减少关键资源的个数？一种方式是可以将JavaScript和CSS改成内联的形式，比如上图的JavaScript和CSS，若都改成内联模式，那么关键资源的个数就由3个减少到了1个。另一种方式，如果JavaScript代码没有DOM或者CSSOM的操作，则可以改成async或者defer属性；同样对于CSS，如果不是在构建页面之前加载的，则可以添加媒体取消阻止显现的标志。当JavaScript标签加上了async或者defer、CSSlink 属性之前加上了取消阻止显现的标志后，它们就变成了非关键资源了。</li>\n<li>如何减少关键资源的大小？可以压缩CSS和JavaScript资源，移除HTML、CSS、JavaScript文件中一些注释内容，也可以通过前面讲的取消CSS或者JavaScript中关键资源的方式。</li>\n<li>如何减少关键资源RTT的次数？可以通过减少关键资源的个数和减少关键资源的大小搭配来实现。除此之外，还可以使用CDN来减少每次RTT时长。</li>\n</ul><p>在优化实际的页面加载速度时，你可以先画出优化之前关键资源的图表，然后按照上面优化关键资源的原则去优化，优化完成之后再画出优化之后的关键资源图表。</p><h2>交互阶段</h2><p>接下来我们再来聊聊页面加载完成之后的交互阶段以及应该如何去优化。谈交互阶段的优化，其实就是在谈渲染进程渲染帧的速度，因为在交互阶段，帧的渲染速度决定了交互的流畅度。因此讨论页面优化实际上就是讨论渲染引擎是如何渲染帧的，否则就无法优化帧率。</p><p>我们先来看看交互阶段的渲染流水线（如下图）。和加载阶段的渲染流水线有一些不同的地方是，在交互阶段没有了加载关键资源和构建DOM、CSSOM流程，通常是由JavaScript触发交互动画的。</p><p><img src=\"https://static001.geekbang.org/resource/image/4a/0c/4a942e53f9358c9c4634c310335cc10c.png?wh=1142*465\" alt=\"\"></p><center><span class=\"reference\">交互阶段渲染流水线</span></center><p>结合上图，我们来一起回顾下交互阶段是如何生成一个帧的。大部分情况下，生成一个新的帧都是由JavaScript通过修改DOM或者CSSOM来触发的。还有另外一部分帧是由CSS来触发的。</p><p>如果在计算样式阶段发现有布局信息的修改，那么就会触发<strong>重排</strong>操作，然后触发后续渲染流水线的一系列操作，这个代价是非常大的。</p><p>同样如果在计算样式阶段没有发现有布局信息的修改，只是修改了颜色一类的信息，那么就不会涉及到布局相关的调整，所以可以跳过布局阶段，直接进入绘制阶段，这个过程叫<strong>重绘</strong>。不过重绘阶段的代价也是不小的。</p><p>还有另外一种情况，通过CSS实现一些变形、渐变、动画等特效，这是由CSS触发的，并且是在合成线程上执行的，这个过程称为合成。因为它不会触发重排或者重绘，而且合成操作本身的速度就非常快，所以执行合成是效率最高的方式。</p><p>回顾了在交互过程中的帧是如何生成的，那接下来我们就可以讨论优化方案了。<strong>一个大的原则就是让单个帧的生成速度变快</strong>。所以，下面我们就来分析下在交互阶段渲染流水线中有哪些因素影响了帧的生成速度以及如何去优化。</p><h3>1. 减少JavaScript脚本执行时间</h3><p>有时JavaScript函数的一次执行时间可能有几百毫秒，这就严重霸占了主线程执行其他渲染任务的时间。针对这种情况我们可以采用以下两种策略：</p><ul>\n<li>一种是将一次执行的函数分解为多个任务，使得每次的执行时间不要过久。</li>\n<li>另一种是采用Web Workers。你可以把Web Workers当作主线程之外的一个线程，在Web Workers中是可以执行JavaScript脚本的，不过Web Workers中没有DOM、CSSOM环境，这意味着在Web Workers中是无法通过JavaScript来访问DOM的，所以我们可以把一些和DOM操作无关且耗时的任务放到Web Workers中去执行。</li>\n</ul><p>总之，在交互阶段，对JavaScript脚本总的原则就是不要一次霸占太久主线程。</p><h3>2. 避免强制同步布局</h3><p>在介绍强制同步布局之前，我们先来聊聊正常情况下的布局操作。通过DOM接口执行添加元素或者删除元素等操作后，是需要重新计算样式和布局的，不过正常情况下这些操作都是在另外的任务中异步完成的，这样做是为了避免当前的任务占用太长的主线程时间。为了直观理解，你可以参考下面的代码：</p><pre><code>&lt;html&gt;\n&lt;body&gt;\n    &lt;div id=&quot;mian_div&quot;&gt;\n        &lt;li id=&quot;time_li&quot;&gt;time&lt;/li&gt;\n        &lt;li&gt;geekbang&lt;/li&gt;\n    &lt;/div&gt;\n\n    &lt;p id=&quot;demo&quot;&gt;强制布局demo&lt;/p&gt;\n    &lt;button onclick=&quot;foo()&quot;&gt;添加新元素&lt;/button&gt;\n\n    &lt;script&gt;\n        function foo() {\n            let main_div = document.getElementById(&quot;mian_div&quot;)      \n            let new_node = document.createElement(&quot;li&quot;)\n            let textnode = document.createTextNode(&quot;time.geekbang&quot;)\n            new_node.appendChild(textnode);\n            document.getElementById(&quot;mian_div&quot;).appendChild(new_node);\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>对于上面这段代码，我们可以使用Performance工具来记录添加元素的过程，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/32/c9/32b6a645646f99fc3517fb0b5e003cc9.png?wh=1142*227\" alt=\"\"></p><center><span class=\"reference\">Performance记录添加元素的执行过程</span></center><p>从图中可以看出来，执行JavaScript添加元素是在一个任务中执行的，重新计算样式布局是在另外一个任务中执行，这就是正常情况下的布局操作。</p><p>理解了正常情况下的布局操作，接下来我们就可以聊什么是强制同步布局了。</p><p><strong>所谓强制同步布局，是指JavaScript强制将计算样式和布局操作提前到当前的任务中</strong>。为了直观理解，这里我们对上面的代码做了一点修改，让它变成强制同步布局，修改后的代码如下所示：</p><pre><code>function foo() {\n    let main_div = document.getElementById(&quot;mian_div&quot;)\n    let new_node = document.createElement(&quot;li&quot;)\n    let textnode = document.createTextNode(&quot;time.geekbang&quot;)\n    new_node.appendChild(textnode);\n    document.getElementById(&quot;mian_div&quot;).appendChild(new_node);\n    //由于要获取到offsetHeight，\n    //但是此时的offsetHeight还是老的数据，\n    //所以需要立即执行布局操作\n    console.log(main_div.offsetHeight)\n}\n</code></pre><p>将新的元素添加到DOM之后，我们又调用了<code>main_div.offsetHeight</code>来获取新main_div的高度信息。如果要获取到main_div的高度，就需要重新布局，所以这里在获取到main_div的高度之前，JavaScript还需要强制让渲染引擎默认执行一次布局操作。我们把这个操作称为强制同步布局。</p><p>同样，你可以看下面通过Performance记录的任务状态：</p><p><img src=\"https://static001.geekbang.org/resource/image/ce/d9/ce951be7a38e2ef1a9a23a1c7e84b1d9.png?wh=1142*409\" alt=\"\"></p><center><span class=\"reference\">触发强制同步布局Performance图</span></center><p>从上图可以看出来，计算样式和布局都是在当前脚本执行过程中触发的，这就是强制同步布局。</p><p>为了避免强制同步布局，我们可以调整策略，在修改DOM之前查询相关值。代码如下所示：</p><pre><code>function foo() {\n    let main_div = document.getElementById(&quot;mian_div&quot;)\n    //为了避免强制同步布局，在修改DOM之前查询相关值\n    console.log(main_div.offsetHeight)\n    let new_node = document.createElement(&quot;li&quot;)\n    let textnode = document.createTextNode(&quot;time.geekbang&quot;)\n    new_node.appendChild(textnode);\n    document.getElementById(&quot;mian_div&quot;).appendChild(new_node);\n    \n}\n</code></pre><h3>3. 避免布局抖动</h3><p>还有一种比强制同步布局更坏的情况，那就是布局抖动。所谓布局抖动，是指在一次JavaScript执行过程中，多次执行强制布局和抖动操作。为了直观理解，你可以看下面的代码：</p><pre><code>function foo() {\n    let time_li = document.getElementById(&quot;time_li&quot;)\n    for (let i = 0; i &lt; 100; i++) {\n        let main_div = document.getElementById(&quot;mian_div&quot;)\n        let new_node = document.createElement(&quot;li&quot;)\n        let textnode = document.createTextNode(&quot;time.geekbang&quot;)\n        new_node.appendChild(textnode);\n        new_node.offsetHeight = time_li.offsetHeight;\n        document.getElementById(&quot;mian_div&quot;).appendChild(new_node);\n    }\n}\n</code></pre><p>我们在一个for循环语句里面不断读取属性值，每次读取属性值之前都要进行计算样式和布局。执行代码之后，使用Performance记录的状态如下所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/36/87/36159f7081e37ce4714b20ce2630e987.png?wh=1142*405\" alt=\"\"></p><center><span class=\"reference\">Performance中关于布局抖动的表现</span></center><p>从上图可以看出，在foo函数内部重复执行计算样式和布局，这会大大影响当前函数的执行效率。这种情况的避免方式和强制同步布局一样，都是尽量不要在修改DOM结构时再去查询一些相关值。</p><h3>4. 合理利用CSS合成动画</h3><p>合成动画是直接在合成线程上执行的，这和在主线程上执行的布局、绘制等操作不同，如果主线程被JavaScript或者一些布局任务占用，CSS动画依然能继续执行。所以要尽量利用好CSS合成动画，如果能让CSS处理动画，就尽量交给CSS来操作。</p><p>另外，如果能提前知道对某个元素执行动画操作，那就最好将其标记为will-change，这是告诉渲染引擎需要将该元素单独生成一个图层。</p><h3>5. 避免频繁的垃圾回收</h3><p>我们知道JavaScript使用了自动垃圾回收机制，如果在一些函数中频繁创建临时对象，那么垃圾回收器也会频繁地去执行垃圾回收策略。这样当垃圾回收操作发生时，就会占用主线程，从而影响到其他任务的执行，严重的话还会让用户产生掉帧、不流畅的感觉。</p><p>所以要尽量避免产生那些临时垃圾数据。那该怎么做呢？可以尽可能优化储存结构，尽可能避免小颗粒对象的产生。</p><h2>总结</h2><p>好了，今天就介绍到这里，下面我来总结下本文的主要内容。</p><p>我们主要讲解了如何系统优化加载阶段和交互阶段的页面。</p><p>在加载阶段，核心的优化原则是：优化关键资源的加载速度，减少关键资源的个数，降低关键资源的RTT次数。</p><p>在交互阶段，核心的优化原则是：尽量减少一帧的生成时间。可以通过减少单次JavaScript的执行时间、避免强制同步布局、避免布局抖动、尽量采用CSS的合成动画、避免频繁的垃圾回收等方式来减少一帧生成的时长。</p><h2>思考时间</h2><p>那你来分析下新浪官网（<a href=\"https://www.sina.com.cn/\">https://www.sina.com.cn/</a>  ）在加载阶段和交互阶段所存在的一些性能问题。</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p>","comments":[{"had_liked":false,"id":137861,"user_name":"HB","can_delete":false,"product_type":"c1","uid":1607795,"ip_address":"","ucode":"80D38E55C6DBDF","user_header":"https://static001.geekbang.org/account/avatar/00/18/88/73/592c8ddd.jpg","comment_is_top":false,"comment_ctime":1569902236,"is_pvip":false,"replies":[{"id":"53004","content":"争取快点把主干课程写完，然后还要整理几百条留言，来系统地答疑","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1569923363,"ip_address":"","comment_id":137861,"utype":1}],"discussion_count":2,"race_medal":0,"score":"134713888412","product_id":100033601,"comment_content":"为老师点赞，假期不断更","like_count":32,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469292,"discussion_content":"争取快点把主干课程写完，然后还要整理几百条留言，来系统地答疑","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569923363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35318,"discussion_content":"期待老师的留言解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571270080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139631,"user_name":"Luke","can_delete":false,"product_type":"c1","uid":1003156,"ip_address":"","ucode":"4060B4E2EF1D13","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/94/0b22b6a2.jpg","comment_is_top":false,"comment_ctime":1570694412,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"87470040332","product_id":100033601,"comment_content":"我们在进行优化的时候，其中有一条策略就是使用离线dom减少重排与重绘，就是将dom先隐藏再修改，修改完后再显示出来。但是浏览器的渲染策略更倾向于将一个大的任务拆分成多个小的任务进行实时多次的渲染。那么离线dom的这种优化是不是有可能成为一种负优化？将多个渲染任务都集中到一次渲染中，导致页面渲染不够及时，当前帧占用时间过长，页面也会出现卡顿？","like_count":21,"discussions":[{"author":{"id":2136469,"avatar":"https://static001.geekbang.org/account/avatar/00/20/99/95/1e332315.jpg","nickname":"Geek_2014ce","note":"","ucode":"167B4CCDA4D5BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364572,"discussion_content":"用createDocumentFragment进行离线处理测试了下。离线与不离线耗时基本一样。\n我理解的是不离线处理他也不会添加子节点马上就去更新DOM结构，前面微任务那章节就有讲到，这个时候函数里面是宏任务代码，更新DOM相关操作(回流，重绘等等)均是要在微任务里面才执行的。所以不离线处理浏览器也是要把所有的节点变动信息记录下来，最后微任务再统一处理。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1617524231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1235611,"avatar":"https://static001.geekbang.org/account/avatar/00/12/da/9b/e0ef47df.jpg","nickname":"凭实力写bug","note":"","ucode":"6F772551F18935","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":44046,"discussion_content":"你隐藏一次重排出来一次重排,感觉比直接修改还多了一次","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1572925500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1673843,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erXRaa98A3zjLDkOibUJV1254aQ4EYFTbSLJuEvD0nXicMNA8pLoxOfHf5kPTbGLXNicg8CPFH3Tn0mA/132","nickname":"Geek_115bc8","note":"","ucode":"71FBC9F02AFE1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1235611,"avatar":"https://static001.geekbang.org/account/avatar/00/12/da/9b/e0ef47df.jpg","nickname":"凭实力写bug","note":"","ucode":"6F772551F18935","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570123,"discussion_content":"但是如果大量的操作都造成重绘呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651670794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":44046,"ip_address":""},"score":570123,"extra":""}]},{"author":{"id":1292688,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b9/90/215816c2.jpg","nickname":"阿拉丁神猫","note":"","ucode":"32C76B9536B46D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549323,"discussion_content":"更新浏览器内部有相关批处理的优化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643855852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138150,"user_name":"阿哲","can_delete":false,"product_type":"c1","uid":1645276,"ip_address":"","ucode":"EFFE54F061DF64","user_header":"https://static001.geekbang.org/account/avatar/00/19/1a/dc/a07e4c69.jpg","comment_is_top":false,"comment_ctime":1570067590,"is_pvip":false,"discussion_count":10,"race_medal":0,"score":"74584511622","product_id":100033601,"comment_content":"加载阶段渲染流水线的配图中，css解析器和v8引擎是不是写反了？","like_count":18,"discussions":[{"author":{"id":1338334,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6b/de/686585ee.jpg","nickname":"小C","note":"","ucode":"27C2D021A9E21E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579856,"discussion_content":"是的，这个图我也感觉css和js的写反了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657718684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372976,"discussion_content":"js 中如果有操作dom的逻辑，则会先解析CSSOM，如果没有相应的逻辑为什么要等待css呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620553667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1987645,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/GbwKlRZ1OMWVHM15YShwHTsqIRgUMS5ia5yFWuCHgF7fYTSFw3VBFap1maxjXrborweHsjMJxKqSGcGMjxfENtw/132","nickname":"谢金燕","note":"","ucode":"BDFE9AA52C9401","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373097,"discussion_content":"老师之前讲的就是：JS引擎是在执行代码前无法判断有没有操作DOM和CSSOM，因此都会等待css的下载和CSSOM生成后才会执行js。","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1620613568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372976,"ip_address":""},"score":373097,"extra":""}]},{"author":{"id":2015181,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/bf/cd/b4d63481.jpg","nickname":"千百度","note":"","ucode":"3C69901E3AF834","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339465,"discussion_content":"1313","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609681681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147347,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/d3/f0a88806.jpg","nickname":"🍐 🍾 🔆","note":"","ucode":"1B7C90800AD4D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":280262,"discussion_content":"你说的对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591520635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1506085,"avatar":"https://static001.geekbang.org/account/avatar/00/16/fb/25/f6743e97.jpg","nickname":"进击的前端er","note":"","ucode":"9229B410F48B85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270818,"discussion_content":"我也觉得这里有点问题，和前面的讲解不一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590060094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1375551,"avatar":"https://static001.geekbang.org/account/avatar/00/14/fd/3f/96da3eec.jpg","nickname":"寄语","note":"","ucode":"16746918F57750","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259933,"discussion_content":"这里老师解答下呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588830668,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1585967,"avatar":"https://static001.geekbang.org/account/avatar/00/18/33/2f/84f7d587.jpg","nickname":"YBB","note":"","ucode":"1507DBFE008715","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":231849,"discussion_content":"感觉有点问题，先css解析 成CSSDOM 才去执行js 吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586832494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35315,"discussion_content":"我也感觉那个图 是有问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571270033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691581,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/bd/4fa01a1c.jpg","nickname":"wd2010","note":"","ucode":"E194E4EFECA013","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28978,"discussion_content":"那个图确实是有点问题，而且js应该等css加载完才执行的，上一篇有写到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570720518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138239,"user_name":"mfist","can_delete":false,"product_type":"c1","uid":1373624,"ip_address":"","ucode":"4F99F422C23FB4","user_header":"https://static001.geekbang.org/account/avatar/00/14/f5/b8/9f165f4b.jpg","comment_is_top":false,"comment_ctime":1570111398,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"53109718950","product_id":100033601,"comment_content":"加载阶段：<br>通过分析network中关键资源（html文件 js文件 css文件）的大小，个数，只找到一个可能性能问题：html文件是128kb比较大，网站本身已经开启gzip http2 多个静态资源域名、开启缓存等多个优化手段<br>交互阶段<br>新浪首页页面加载完成后，滚动页面查看次屏页面，没有太多的交互，查看performance没有发现太明显的性能问题<br>今日总结：<br>一个页面从生命周期的维度主要分为三个阶段：加载阶段、交互阶段、关闭阶段。<br>1. 加载阶段影响网页首次渲染的关键资源几个指标：个数、大小、RTT（round trip time）。通常一个HTTP的数据包在14kb左右。<br>2. 交互阶段的优化主要是指渲染进程渲染帧速度。如何让单个帧生成的速度变快呢？<br> * 减少JavaScript脚本执行时间<br> * 避免强制同步布局，添加 删除dom后计算样式布局是在另外一个任务中执行的，这时候获取样式信息，会将其变成同步任务。<br> * 避免布局抖动<br> * 合理利用CSS合成动画（标识 will-change 单独生成一个图层）<br> * 避免频繁的垃圾回收。（尽量避免临时垃圾数据，优化存储结构，避免小颗粒对象产生）","like_count":13,"discussions":[{"author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109491,"discussion_content":"避免强制同步布局，添加 删除dom后计算样式布局是在另外一个任务中执行的，这时候获取样式信息，会将其变成同步任务------------------ 是变成同步任务后，又回到了第一点JavaScript脚本执行时间过长的问题吗？还是什么原因，一个任务分成两个任务更好，这两个任务都是在主线程航母执行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577697670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215294,"user_name":"L2","can_delete":false,"product_type":"c1","uid":1991874,"ip_address":"","ucode":"C887B2B53AD47A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/64/c2/e2a0bee8.jpg","comment_is_top":false,"comment_ctime":1588949666,"is_pvip":false,"discussion_count":8,"race_medal":0,"score":"48833589922","product_id":100033601,"comment_content":"避免强制同步布局那里，我的疑问是既然需要知道offsetHeight肯定是想要最新的啊！ 如果我先获取再执行dom操作，还有什么意义？","like_count":12,"discussions":[{"author":{"id":1449227,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1d/0b/7007ec4a.jpg","nickname":"BNK","note":"","ucode":"B039DC4FF71FB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579437,"discussion_content":"同问，感觉这个真鸡肋，没啥用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657448678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1605000,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7d/88/32713a32.jpg","nickname":"南山隐者","note":"","ucode":"D934C594E4F819","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375452,"discussion_content":"我理解是：先获取 mian_div 的高度，后续添加 dom (自己已知高度) 后，可以通过 js 直接计算，这样的话，就可以 append 后不用强制布局了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621668115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372979,"discussion_content":"有可能是一个 getter 属性？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620553810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372977,"discussion_content":"哈哈哈 同问！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620553759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1594335,"avatar":"https://static001.geekbang.org/account/avatar/00/18/53/df/075734af.jpg","nickname":"NMS丶No3","note":"","ucode":"B850EF9E8F77E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356144,"discussion_content":"我理解dom上的属性是引用类型，所以后续对offsetHeight的访问，能取到最新值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615539466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1408330,"avatar":"https://static001.geekbang.org/account/avatar/00/15/7d/4a/bec4bfe2.jpg","nickname":"Jst","note":"","ucode":"B86FE968466CDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1594335,"avatar":"https://static001.geekbang.org/account/avatar/00/18/53/df/075734af.jpg","nickname":"NMS丶No3","note":"","ucode":"B850EF9E8F77E2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587129,"discussion_content":"获取到的 offsetHeight 值一定是当时的，先获取再修改得到的只会是修改前的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662804648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":356144,"ip_address":"广东"},"score":587129,"extra":""}]},{"author":{"id":2078362,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/b6/9a/74b10a86.jpg","nickname":"木兮","note":"","ucode":"8E45EEF8D818DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339366,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609645724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661356,"avatar":"https://static001.geekbang.org/account/avatar/00/19/59/ac/a2826e17.jpg","nickname":"额额","note":"","ucode":"A497B877EA6761","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326457,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605598508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139044,"user_name":"安静","can_delete":false,"product_type":"c1","uid":1532500,"ip_address":"","ucode":"76765E40621B52","user_header":"https://static001.geekbang.org/account/avatar/00/17/62/54/043195eb.jpg","comment_is_top":false,"comment_ctime":1570532603,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"40225238267","product_id":100033601,"comment_content":"请问老师：当 JavaScript 标签加上了 sync 或者 defer、CSSlink 属性之前加上了取消阻止显现的标志后，它们就变成了非关键资源了。<br>这段里面取消阻止显现标记是什么标记呀","like_count":10,"discussions":[{"author":{"id":1351722,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a0/2a/cd8bdccc.jpg","nickname":"Leo","note":"","ucode":"7ABE0E11FB0B57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220344,"discussion_content":"给 link 标签添加 media=“none” onload=“this.media=‘all’”","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1585847027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1406834,"avatar":"https://static001.geekbang.org/account/avatar/00/15/77/72/ad7056f9.jpg","nickname":"hb","note":"","ucode":"DCFA6CECF64E37","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385838,"discussion_content":"应该就是添加媒体类型或者媒体查询https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-blocking-css?hl=zh-cn","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627294793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167767,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/97/3abdd9cd.jpg","nickname":"stanny","note":"","ucode":"DD2BB91548A881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372980,"discussion_content":"preload\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620553846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154386,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9d/52/9793e3ba.jpg","nickname":"Sevens 些粉","note":"","ucode":"77B1A4319C6A71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197749,"discussion_content":"也想问这个。。老师没回答。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583426427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247212,"user_name":"Geek_fd81b3","can_delete":false,"product_type":"c1","uid":1899429,"ip_address":"","ucode":"5BF9C3C68B8178","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIE3Vw0icEQic96rOykFD2bUo6KotVx53gvtG0CDe8tUKC3pNXxIQYMuyPyrgL06Zn32UWtEXTIVWMw/132","comment_is_top":false,"comment_ctime":1599634749,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"27369438525","product_id":100033601,"comment_content":"老师，如果操作dom引起了重拍或重绘，是整个页面从0开始吗，哪些没变化的地方也会重拍重绘吗？比如我把页面最后的元素大小改变了，上面的都没发生变化，这样上面哪些没有变化的也会重拍重绘吗？","like_count":6,"discussions":[{"author":{"id":1408330,"avatar":"https://static001.geekbang.org/account/avatar/00/15/7d/4a/bec4bfe2.jpg","nickname":"Jst","note":"","ucode":"B86FE968466CDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586672,"discussion_content":"从引起重排的DOM开始，后面的所有DOM都要从 Layout 到最后渲染走一遍流程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662429172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1698735,"avatar":"https://static001.geekbang.org/account/avatar/00/19/eb/af/e49af9a8.jpg","nickname":"JC.彦","note":"","ucode":"E87C1420B140F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558022,"discussion_content":"重排是整个渲染流程重走一遍，你理解是对的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648045549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1553505,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b4/61/1db459e5.jpg","nickname":"哎姆哦剋","note":"","ucode":"D2532A348F07E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320694,"discussion_content":"应该是当前层的重拍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604453705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2286113,"avatar":"https://static001.geekbang.org/account/avatar/00/22/e2/21/60adf96b.jpg","nickname":"stone","note":"","ucode":"65816E57253D0F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1553505,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b4/61/1db459e5.jpg","nickname":"哎姆哦剋","note":"","ucode":"D2532A348F07E5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335944,"discussion_content":"如果当前层有分块的话，是否只是分块的重排呢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608398442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320694,"ip_address":""},"score":335944,"extra":""}]}]},{"had_liked":false,"id":177812,"user_name":"小蛋糕","can_delete":false,"product_type":"c1","uid":1807662,"ip_address":"","ucode":"335A6F4301CF22","user_header":"https://static001.geekbang.org/account/avatar/00/1b/95/2e/f8575abb.jpg","comment_is_top":false,"comment_ctime":1581506371,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23056342851","product_id":100033601,"comment_content":"真的不太会看，但是还是想表达一下自己的看法：<br><br>1. 加载阶段<br><br>1.1 关键资源方面<br>- 首页 html 文件体积有 500+KB，我比较了一下搜狐只有 200+KB。<br>- DCL 有 2.67s，搜狐 1.23s。<br>- 有很多外部 js 文件，但都没有发现 async 或 defer，应该不会每个都在操作 DOM 或 CSSOM 吧。<br><br>1.2 RTT<br>- 大量 14kb 以上的关键资源，所以 RTT 的次数应该比较多。<br><br>1.3 Memory<br>- 11MB 不确定好坏，搜狐 6MB<br><br>2. 交互阶段<br><br>- event: scroll 不知写了什么，每次都好几十 ms，有点小卡，而搜狐的首页 event: scroll 仅仅 1 ms 左右。<br><br>其他的交互也没啥啦，照不出来啦。","like_count":5,"discussions":[{"author":{"id":2757253,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/12/85/b7d82817.jpg","nickname":"🌙","note":"","ucode":"4946214519E2CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538241,"discussion_content":"还有很多图片和js脚本没有压缩","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639378583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2338500,"avatar":"https://static001.geekbang.org/account/avatar/00/23/ae/c4/eafb9ba1.jpg","nickname":"长寿","note":"","ucode":"5FBDF9E65D2F3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2757253,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/12/85/b7d82817.jpg","nickname":"🌙","note":"","ucode":"4946214519E2CD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585221,"discussion_content":"怎么看一个资源压没压缩啊，是看响应头里的Content-encoding吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661407754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538241,"ip_address":"辽宁"},"score":585221,"extra":""}]}]},{"had_liked":false,"id":229069,"user_name":"江霖","can_delete":false,"product_type":"c1","uid":1051487,"ip_address":"","ucode":"D197B3FD012944","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLHOZjqhVkWgUrUibLnXkiaFkhJdfWT2BZP3LldE3tArIoHASlhTSp8tiatiamLbQOjKeMcYHkAexoyCg/132","comment_is_top":false,"comment_ctime":1592891315,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18772760499","product_id":100033601,"comment_content":"这个流水线的图和前面有点不一样，不是应该先生成cssom，然后再执行，javascript么<br>另外还有一个问题就是，如果一个页面中有很多外联的css，页面中的js会等所有css加载完成生成cssom之后在执行么？","like_count":4,"discussions":[{"author":{"id":1526969,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4c/b9/de7d2102.jpg","nickname":"黄小波波","note":"","ucode":"A84268D5E37953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387506,"discussion_content":"同问，求解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628222728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2361679,"avatar":"https://static001.geekbang.org/account/avatar/00/24/09/4f/c07bc26f.jpg","nickname":"soon","note":"","ucode":"148122663905F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383726,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626224938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2530802,"avatar":"https://static001.geekbang.org/account/avatar/00/26/9d/f2/a93285b0.jpg","nickname":"Dwayne","note":"","ucode":"17714CF4011350","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382298,"discussion_content":"同问，求解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625503569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227866,"user_name":"卡尔","can_delete":false,"product_type":"c1","uid":1445936,"ip_address":"","ucode":"BD6F76BC18FF8F","user_header":"https://static001.geekbang.org/account/avatar/00/16/10/30/c07d419c.jpg","comment_is_top":false,"comment_ctime":1592498810,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18772367994","product_id":100033601,"comment_content":"新浪的关键资源index.css排队5.70s，停滞有108.13ms，Content Download有50.66ms。感觉这个文件应该有优化的空间。","like_count":3},{"had_liked":false,"id":184893,"user_name":"Sevens 些粉","can_delete":false,"product_type":"c1","uid":1154386,"ip_address":"","ucode":"77B1A4319C6A71","user_header":"https://static001.geekbang.org/account/avatar/00/11/9d/52/9793e3ba.jpg","comment_is_top":false,"comment_ctime":1583426453,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18763295637","product_id":100033601,"comment_content":"CSSlink 属性之前加上了取消阻止显现的标志后。 这个取消阻止显现的标志指？？","like_count":4,"discussions":[{"author":{"id":1239720,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ea/a8/72e43f12.jpg","nickname":"Modern","note":"","ucode":"23B741F694F7D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383339,"discussion_content":"media","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626061679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163094,"user_name":"匡晨辉","can_delete":false,"product_type":"c1","uid":1763707,"ip_address":"","ucode":"BF88FE410C20F4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e9/7b/b844f3a4.jpg","comment_is_top":false,"comment_ctime":1576655620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14461557508","product_id":100033601,"comment_content":"老师，加载阶段的那个图画是不是失误画错了？加载css生成cssod 应该是在执行js前面，应为js可能会操作css依赖cssod的生成这是前几张讲过的内容","like_count":3},{"had_liked":false,"id":153654,"user_name":"bai","can_delete":false,"product_type":"c1","uid":1462911,"ip_address":"","ucode":"C9673B7F2C896E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKf9xWMCV4ic5dsKyroQpGkYGZ32IPicVPVsF1TPENeTcspd6HhhaciaHCCmzeicaiaItZS3DahASFovJQ/132","comment_is_top":false,"comment_ctime":1574294344,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14459196232","product_id":100033601,"comment_content":"有疑惑，js文件加上defer应该也不能变成非关键资源吧。defer的js的执行时间是domcontentloaded事件之前，此时还没有执行布局和绘制，也就是首屏页面还没有展示。也就是说defer的js还是会执行之后再进行布局和绘制。","like_count":3,"discussions":[{"author":{"id":2058829,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/PBMtVAjHwoMWWrqzTPia9lGGg4bw4OxEH53kmIuicK8OiaIbvm7icl9r5auT6gP12gEicdvMt56lIEp6dZ4Ww417B1g/132","nickname":"心仔爸比","note":"","ucode":"C3FD8D0424E715","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387345,"discussion_content":"赞同，老师没来回答吗 @李兵","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628130939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138446,"user_name":"This","can_delete":false,"product_type":"c1","uid":1338696,"ip_address":"","ucode":"7FD1969C9C38D0","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/48/e04411d5.jpg","comment_is_top":false,"comment_ctime":1570246535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14455148423","product_id":100033601,"comment_content":"老师的课程是我遇到干货最满的，希望老师陆续出其他课程","like_count":3},{"had_liked":false,"id":307116,"user_name":"Liber","can_delete":false,"product_type":"c1","uid":1244231,"ip_address":"","ucode":"A5CBFDB15A7745","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/47/a4be64d8.jpg","comment_is_top":false,"comment_ctime":1628868622,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10218803214","product_id":100033601,"comment_content":"1 个 HTTP 的数据包在 14KB 左右吗，根据阮一峰写的，不应该是1400字节，即1.4KB左右吗？<br>https:&#47;&#47;www.ruanyifeng.com&#47;blog&#47;2017&#47;06&#47;tcp-protocol.html","like_count":3,"discussions":[{"author":{"id":1479642,"avatar":"https://static001.geekbang.org/account/avatar/00/16/93/da/321a9a6c.jpg","nickname":"帽子先生","note":"","ucode":"318F71A8D23160","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583013,"discussion_content":"阮一峰将的是TCP的数据包，这里将的是HTTP的数据包 一个HTTP的数据包可能会需要多个TCP数据包传递把","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659875342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098566,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c3/46/308c3958.jpg","nickname":"不蒸馒头","note":"","ucode":"EB26EC2B9CFC6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545273,"discussion_content":"应该是老师记错了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641891817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564751,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e0/4f/9e61ede1.jpg","nickname":"Geek_cc","note":"","ucode":"CF7671D79221CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414875,"discussion_content":"是的，你是对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636908231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259412,"user_name":"call me baby","can_delete":false,"product_type":"c1","uid":2064598,"ip_address":"","ucode":"D93E19B05365A9","user_header":"https://static001.geekbang.org/account/avatar/00/1f/80/d6/be31594f.jpg","comment_is_top":false,"comment_ctime":1604720086,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10194654678","product_id":100033601,"comment_content":"老师，可以回答一下，重排或者重绘是指整个dom还是只是发生改变的当前层的？","like_count":2,"discussions":[{"author":{"id":1288733,"avatar":"https://static001.geekbang.org/account/avatar/00/13/aa/1d/b8fdd622.jpg","nickname":"laoergege","note":"","ucode":"559CCF36805A04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391916,"discussion_content":"整个 dom","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630687852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1605000,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7d/88/32713a32.jpg","nickname":"南山隐者","note":"","ucode":"D934C594E4F819","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375460,"discussion_content":"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#Dirty_bit_system","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621670278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221500,"user_name":"孜孜","can_delete":false,"product_type":"c1","uid":1018203,"ip_address":"","ucode":"7EF4FB644357CE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/5b/d8f78c1e.jpg","comment_is_top":false,"comment_ctime":1590510071,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10180444663","product_id":100033601,"comment_content":"包的大小不是由mtu定的吗？为什么http一般是14kb啊？不能简单的用文件大小除以14kb吧。","like_count":2},{"had_liked":false,"id":167134,"user_name":"AMIR","can_delete":false,"product_type":"c1","uid":1782777,"ip_address":"","ucode":"65142D9669071B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","comment_is_top":false,"comment_ctime":1577697310,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"10167631902","product_id":100033601,"comment_content":"为了避免强制同步布局，我们可以调整策略，在修改 DOM 之前查询相关值，但是老师，修改之前查询的DOM值只是修改之前的啊，我要查询修改之后的不还是得放到后面？？","like_count":2,"discussions":[{"author":{"id":1177430,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f7/56/b82eeac7.jpg","nickname":"champ可口可乐了","note":"","ucode":"EA75C67E9124C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278721,"discussion_content":"因为main_div的offsetHeight属性在添加子节点后不会变化，所以可以先查询，后面修改dom的时候直接用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591230787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1553505,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b4/61/1db459e5.jpg","nickname":"哎姆哦剋","note":"","ucode":"D2532A348F07E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1177430,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f7/56/b82eeac7.jpg","nickname":"champ可口可乐了","note":"","ucode":"EA75C67E9124C7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320693,"discussion_content":"请不要强解释……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604453632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":278721,"ip_address":""},"score":320693,"extra":""}]},{"author":{"id":1270780,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er8AdNibZHbZriaqLQZrNPcX8hVOpY91o0ELl7eOq7qy3aTibjia10ymIsKUKW6Ucs9SuXBDWlg6sjahw/132","nickname":"逆舟","note":"","ucode":"B303B4B8E10E0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":244988,"discussion_content":"我感觉意思应该是 假如你不是马上要用这个值的话，尽量用的时候再去查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587645980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1037760,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIuRQaZX70dsBg6khub2VPM1eQAP9IWRWxgOFed3ia4kXyNJInFRicWJ0ibf2YmLsOvJa1sGygGpmJg/132","nickname":"胖子","note":"","ucode":"E6371346288A87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220729,"discussion_content":"同问。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585921196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260939,"user_name":"君自兰芳","can_delete":false,"product_type":"c1","uid":2029706,"ip_address":"","ucode":"780F3AFEEB9B73","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f8/8a/f7e7fd54.jpg","comment_is_top":false,"comment_ctime":1605156703,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5900123999","product_id":100033601,"comment_content":"“JavaScript 和 CSS 是同时发起请求的，所以它们的请求是重叠的，那么计算它们的 RTT 时，只需要计算体积最大的那个数据就可以了“<br><br>这里有个疑问，如果同时请求的js和css有几十个，每个都是14kb以下，那也只用了一个RTT吗？","like_count":1,"discussions":[{"author":{"id":2510131,"avatar":"https://static001.geekbang.org/account/avatar/00/26/4d/33/b33daca6.jpg","nickname":"enne","note":"","ucode":"A4D21496F16206","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361167,"discussion_content":"这应该和浏览器支持的最大连接数有关了，chrome是六个","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1616600045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156419,"user_name":"江谢木","can_delete":false,"product_type":"c1","uid":1563403,"ip_address":"","ucode":"E1B1B0F0F03D41","user_header":"https://static001.geekbang.org/account/avatar/00/17/db/0b/f0ded153.jpg","comment_is_top":false,"comment_ctime":1574869280,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5869836576","product_id":100033601,"comment_content":"老师，强制同步布局是因为是和js任务一起执行，所以多触发了一次布局而消耗性能的？ 正常情况下，可能是多个js任务执行完，再触发一次布局？","like_count":1},{"had_liked":false,"id":140760,"user_name":"stone","can_delete":false,"product_type":"c1","uid":1112708,"ip_address":"","ucode":"3FA105FB89CF5F","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/84/b91ee3a9.jpg","comment_is_top":false,"comment_ctime":1571044113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866011409","product_id":100033601,"comment_content":"能优化储存结构，尽可能避免小颗粒对象的产生 <br>老师, 这里的小颗粒对象, 可以举个例子吗? ","like_count":1},{"had_liked":false,"id":138487,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1198186,"ip_address":"","ucode":"8DA4DC1E83823A","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/6a/af249c50.jpg","comment_is_top":false,"comment_ctime":1570271549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5865238845","product_id":100033601,"comment_content":"如何减少关键资源个数那一段，应该是加上 async 或 defer 属性。两者区别是，async 可以在解析 HTML 时并行下载 JS 文件，下载完成之后，暂停 HTML 解析，执行完 JS 再接着解析；而 defer 会并行下载 JS，等 HTML 解析完之后再执行 JS","like_count":1},{"had_liked":false,"id":138055,"user_name":"柴柴","can_delete":false,"product_type":"c1","uid":1376672,"ip_address":"","ucode":"8A76B32AA270A2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Snialo4PnDQCcYtyfDT6xSy61TbwDxoCoD7mNc6XLSKZmLu5ibGfeFibgwLGZtvr8r4vFp0zVaicUmqDibDiaHTGIhvg/132","comment_is_top":false,"comment_ctime":1570001528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5864968824","product_id":100033601,"comment_content":"老师辛苦！","like_count":1},{"had_liked":false,"id":345379,"user_name":"Bupt_daydayup","can_delete":false,"product_type":"c1","uid":1248375,"ip_address":"","ucode":"5E2BBE695288B5","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/77/d855bfb2.jpg","comment_is_top":false,"comment_ctime":1652241221,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652241221","product_id":100033601,"comment_content":"从避免强制布局计算角度来看：新浪网站有一个initialize的函数，在调用该函数时触发了计算样式、布局的函数调用，是一个可供优化的参考点。","like_count":0},{"had_liked":false,"id":335038,"user_name":"Aki","can_delete":false,"product_type":"c1","uid":2807902,"ip_address":"","ucode":"B862D9A2F21480","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d8/5e/3548334f.jpg","comment_is_top":false,"comment_ctime":1645265134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645265134","product_id":100033601,"comment_content":"引用：不过在执行 JavaScript 脚本之前，如果页面中包含了外部 CSS 文件的引用，或者通过 style 标签内置了 CSS 内容，那么渲染引擎还需要将这些内容转换为 CSSOM，因为 JavaScript 有修改 CSSOM 的能力，所以在执行 JavaScript 之前，还需要依赖 CSSOM。也就是说 CSS 在部分情况下也会阻塞 DOM 的生成。<br>疑问：为什么图“加载阶段渲染流水线”, “构建CSSOM”在“执行JavaScript” 后面。是不是有错？","like_count":0},{"had_liked":false,"id":315195,"user_name":"陈布斯","can_delete":false,"product_type":"c1","uid":2663452,"ip_address":"","ucode":"9B93E009567255","user_header":"https://static001.geekbang.org/account/avatar/00/28/a4/1c/016478f7.jpg","comment_is_top":false,"comment_ctime":1633747027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633747027","product_id":100033601,"comment_content":"老师好，请问是通过内联的方式减少关键资源个数，还是利用浏览器多线程来减少一个资源的下载时间，该如何选择呢","like_count":0},{"had_liked":false,"id":311313,"user_name":"乐意","can_delete":false,"product_type":"c1","uid":2047309,"ip_address":"","ucode":"1624D4CA4AEEF4","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3d/4d/dc2da0a2.jpg","comment_is_top":false,"comment_ctime":1631169034,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631169034","product_id":100033601,"comment_content":"js改变transform这类的属性也会跳过布局绘制，从合成阶段开始吗","like_count":0},{"had_liked":false,"id":294029,"user_name":"张宗伟","can_delete":false,"product_type":"c1","uid":1374181,"ip_address":"","ucode":"1447A20C7A8982","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/e5/ec543f3b.jpg","comment_is_top":false,"comment_ctime":1621688833,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621688833","product_id":100033601,"comment_content":"新浪首页加载的时候：<br>1. 执行的内联 js 代码过多。<br>2. 加载的资源过多，而且文件大小很客观。<br>3. html 文档中注视过多。<br>由此在加载过程中引发了大量的重排，重绘与合成操作。","like_count":0},{"had_liked":false,"id":289019,"user_name":"王玄","can_delete":false,"product_type":"c1","uid":1394410,"ip_address":"","ucode":"E54ABB340D1E49","user_header":"https://static001.geekbang.org/account/avatar/00/15/46/ea/b86667b8.jpg","comment_is_top":false,"comment_ctime":1618821497,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618821497","product_id":100033601,"comment_content":"1.首先里面的单个任务执行时间过长布局抖动","like_count":0},{"had_liked":false,"id":271416,"user_name":"付伟超","can_delete":false,"product_type":"c1","uid":2383973,"ip_address":"","ucode":"2CD9A5902B1FA8","user_header":"https://static001.geekbang.org/account/avatar/00/24/60/65/0658ca66.jpg","comment_is_top":false,"comment_ctime":1609602268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609602268","product_id":100033601,"comment_content":"新浪官网:首页加载，关键资源太多，多个html页面文件size过大，内部注释等需要minify，iframe过多拉长了Loaded的时间；好在多用的http2协议，可以多路复用一个tcp连接，还有cdn加速，资源rtt时间较短；<br>交互阶段：没有大的交互事件，看不出效果","like_count":1},{"had_liked":false,"id":220409,"user_name":"sh","can_delete":false,"product_type":"c1","uid":1428920,"ip_address":"","ucode":"720991D01D50D9","user_header":"https://static001.geekbang.org/account/avatar/00/15/cd/b8/14597b01.jpg","comment_is_top":false,"comment_ctime":1590237419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590237419","product_id":100033601,"comment_content":"关键的一点是任务拆解","like_count":0},{"had_liked":false,"id":217816,"user_name":"文文呀","can_delete":false,"product_type":"c1","uid":1482985,"ip_address":"","ucode":"0FBC827A43F7C2","user_header":"https://static001.geekbang.org/account/avatar/00/16/a0/e9/675356e8.jpg","comment_is_top":false,"comment_ctime":1589619634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589619634","product_id":100033601,"comment_content":"加载阶段：<br>  关键资源个数：比如图片，js文件就有好多<br>  关键资源大小：有些大图的大小50多kb，小图虽小，个数多了，也就耗时久了<br>  请求的RTT: 看了下chrome面板中的network,从加载到渲染出来，大概有500多个request请求，共同费的大小是在13~15MB左右，这样算下来RTT会有980~1100 ？<br><br>","like_count":0},{"had_liked":false,"id":211667,"user_name":"Roy","can_delete":false,"product_type":"c1","uid":1930723,"ip_address":"","ucode":"909B8B605C317A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/75/e3/ef489d57.jpg","comment_is_top":false,"comment_ctime":1587993537,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587993537","product_id":100033601,"comment_content":"虽然以前做过chromium开发，但没有研究过性能，这个主题很解渴。","like_count":0},{"had_liked":false,"id":208790,"user_name":"穿秋裤的男孩","can_delete":false,"product_type":"c1","uid":1748640,"ip_address":"","ucode":"D0F48C66377893","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ae/a0/707350ef.jpg","comment_is_top":false,"comment_ctime":1587438964,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587438964","product_id":100033601,"comment_content":"合成动画是直接在合成线程上执行的，这和在主线程上执行的布局、绘制等操作不同，如果主线程被 JavaScript 或者一些布局任务占用，CSS 动画依然能继续执行。<br>--------------<br>这句话的意思可以这么理解吗？<br>合成线程是和渲染线程类似的线程，负责页面的绘制。区别是合成线程和主线程不互斥，渲染线程和主线程是互斥的，所以主线程不会阻塞合成线程的运行吗？","like_count":0},{"had_liked":false,"id":202194,"user_name":"胖子","can_delete":false,"product_type":"c1","uid":1037760,"ip_address":"","ucode":"E6371346288A87","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIuRQaZX70dsBg6khub2VPM1eQAP9IWRWxgOFed3ia4kXyNJInFRicWJ0ibf2YmLsOvJa1sGygGpmJg/132","comment_is_top":false,"comment_ctime":1585921052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585921052","product_id":100033601,"comment_content":"老师你好，不知道怎样去理解通过减少单次 JavaScript 的执行时间提升页面性能，因为JS 该执行的任务总归要全部执行的，总体执行时间没有减少到。","like_count":0},{"had_liked":false,"id":173891,"user_name":"时光逆行","can_delete":false,"product_type":"c1","uid":1395627,"ip_address":"","ucode":"D2D49FA034A558","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/ab/220aa56c.jpg","comment_is_top":false,"comment_ctime":1579761288,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579761288","product_id":100033601,"comment_content":"新浪在加载过程中，有强制同步布局的操作，但是间隔时间不是很大","like_count":0},{"had_liked":false,"id":163111,"user_name":"匡晨辉","can_delete":false,"product_type":"c1","uid":1763707,"ip_address":"","ucode":"BF88FE410C20F4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e9/7b/b844f3a4.jpg","comment_is_top":false,"comment_ctime":1576658149,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576658149","product_id":100033601,"comment_content":"老师，以前了解到浏览器对dom操作做了优化，就是不是每次dom操作都会立马出发重排或者重绘，可能是多个dom操作后才触发。这个机制也是为了缓存优化性能，老师您看过源码知道这个机制具体是如何的吗？是定时触发还是有个什么别的机制？","like_count":0},{"had_liked":false,"id":161504,"user_name":"-_-|||","can_delete":false,"product_type":"c1","uid":1328142,"ip_address":"","ucode":"94B21594658BF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg","comment_is_top":false,"comment_ctime":1576218816,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1576218816","product_id":100033601,"comment_content":"我在“https:&#47;&#47;chokcoco.github.io&#47;demo&#47;css3demo&#47;html&#47;index.html”对里面的动画做性能分析时发现Performance中main线程不断的进行layout和paint，在Layers中有新的层出现应该是合成层。为什么在main中有呢，不应该是合成线程的事吗，难道浏览器性能分析里面的main包含合成线程吗，没有的话合成线程在Performance中的哪里呢？","like_count":0},{"had_liked":false,"id":161497,"user_name":"-_-|||","can_delete":false,"product_type":"c1","uid":1328142,"ip_address":"","ucode":"94B21594658BF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg","comment_is_top":false,"comment_ctime":1576218241,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1576218241","product_id":100033601,"comment_content":"文中“所以要尽量利用好 CSS 合成动画，如果能让 CSS 处理动画，就尽量交给 CSS 来操作。”感觉这句话的意思时只要时css处理的动画都是合成动画，真的是这样吗？应该是类似will-change，translate等才会触发合成动画，像hover一个透明度变化应该不会合成吧？还有可以调用GPU加速的。","like_count":0},{"had_liked":false,"id":161488,"user_name":"-_-|||","can_delete":false,"product_type":"c1","uid":1328142,"ip_address":"","ucode":"94B21594658BF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg","comment_is_top":false,"comment_ctime":1576216886,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1576216886","product_id":100033601,"comment_content":"在性能分析时，哪个灰色的Task就是宏任务吗？一段一段的Task就是Event Loop吗？","like_count":0},{"had_liked":false,"id":158229,"user_name":"vianem","can_delete":false,"product_type":"c1","uid":1748290,"ip_address":"","ucode":"59A2D19426ABC4","user_header":"","comment_is_top":false,"comment_ctime":1575354213,"is_pvip":false,"replies":[{"id":"60613","content":"我不知道你怎么写的代码，你可以用同样的方式试下这个站点：https:&#47;&#47;chokcoco.github.io&#47;demo&#47;css3demo&#47;html&#47;index.html","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1575364926,"ip_address":"","comment_id":158229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575354213","product_id":100033601,"comment_content":"老师您好，我利用will-change: transform优化css动画，动画只进行了transfrom: translate()平移。在测试该动画是否会被主线程阻塞的时候出了问题：我在控制台输入while (1) {};动画直接卡住了","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476682,"discussion_content":"我不知道你怎么写的代码，你可以用同样的方式试下这个站点：https://chokcoco.github.io/demo/css3demo/html/index.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575364926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151064,"user_name":"Crack","can_delete":false,"product_type":"c1","uid":1638828,"ip_address":"","ucode":"BA9573576069C2","user_header":"https://static001.geekbang.org/account/avatar/00/19/01/ac/0a84e410.jpg","comment_is_top":false,"comment_ctime":1573649910,"is_pvip":false,"replies":[{"id":"58167","content":"不会的，gif是经过专门处理的","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1573656975,"ip_address":"","comment_id":151064,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1573649910","product_id":100033601,"comment_content":"想起一个问题，请问浏览器是如何渲染gif的，会引起页面重绘吗","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474351,"discussion_content":"不会的，gif是经过专门处理的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573656975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1638828,"avatar":"https://static001.geekbang.org/account/avatar/00/19/01/ac/0a84e410.jpg","nickname":"Crack","note":"","ucode":"BA9573576069C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":112556,"discussion_content":"这个有相关的资料吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577871662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145515,"user_name":"Geek_320111","can_delete":false,"product_type":"c1","uid":1648388,"ip_address":"","ucode":"837D86A00F9DA8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/XA9Dx0Gv5dTDjZbdRDd8m5BQWOdsXhJcib2oosKqBpkztD4G63PIna2moqndQ0Zu0WVga4wFP7arLaR2RshczwA/132","comment_is_top":false,"comment_ctime":1572309628,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572309628","product_id":100033601,"comment_content":"这里的RTT和以太网的MTU有什么关系？之前了解到MTU一般默认为1500字节。那一个0.1M的文件要拆分的数据包就不止8个了吧，望老师解答。","like_count":0,"discussions":[{"author":{"id":1098566,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c3/46/308c3958.jpg","nickname":"不蒸馒头","note":"","ucode":"EB26EC2B9CFC6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545287,"discussion_content":"MTU是最大传输单元，链路层的帧中的数据部分的最大字节数，以太网中一般为1500字节，而RTT指的是往返时延","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641894468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143009,"user_name":"Sunsmile","can_delete":false,"product_type":"c1","uid":1325937,"ip_address":"","ucode":"44398E6D58FCDC","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/71/b7094a80.jpg","comment_is_top":false,"comment_ctime":1571619899,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571619899","product_id":100033601,"comment_content":"老师给详细讲一下Performance可好？感觉性能优化这块，它很重要","like_count":0},{"had_liked":false,"id":142985,"user_name":"桃翁","can_delete":false,"product_type":"c1","uid":1044036,"ip_address":"","ucode":"CB438AF450DC00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/44/26ac883e.jpg","comment_is_top":false,"comment_ctime":1571617064,"is_pvip":false,"replies":[{"id":"55257","content":"嗯 是写错了，一会改正","user_name":"作者回复","user_name_real":"李兵","uid":"1141464","ctime":1571620967,"ip_address":"","comment_id":142985,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571617064","product_id":100033601,"comment_content":"老师，我感觉应该是 JavaScript 是加上 async 标签吧，你写的是 sync 标签，async(异步)的方式才能达到优化的效果。","like_count":0,"discussions":[{"author":{"id":1141464,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/d8/228449c9.jpg","nickname":"李兵","note":"","ucode":"3F3D3F6E20209E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471345,"discussion_content":"嗯 是写错了，一会改正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571620967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140045,"user_name":"渴望做梦","can_delete":false,"product_type":"c1","uid":1398219,"ip_address":"","ucode":"9EB47530A69C91","user_header":"https://static001.geekbang.org/account/avatar/00/15/55/cb/1efe460a.jpg","comment_is_top":false,"comment_ctime":1570795282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570795282","product_id":100033601,"comment_content":"老师，如果是因为页面里面要发送多个ajax请求导致的性能问题该如何优化呢？","like_count":0},{"had_liked":false,"id":139849,"user_name":"Aaaaaaaaaaayou","can_delete":false,"product_type":"c1","uid":1073601,"ip_address":"","ucode":"67BA315B87587D","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/c1/93031a2a.jpg","comment_is_top":false,"comment_ctime":1570756167,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570756167","product_id":100033601,"comment_content":"14kb应该是tcp的数据包吧","like_count":0},{"had_liked":false,"id":139231,"user_name":"Mr. Cheng","can_delete":false,"product_type":"c1","uid":1585737,"ip_address":"","ucode":"A6D81A7D92160E","user_header":"https://static001.geekbang.org/account/avatar/00/18/32/49/a97fc6df.jpg","comment_is_top":false,"comment_ctime":1570589217,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570589217","product_id":100033601,"comment_content":"Performance面板看着有点晕","like_count":0},{"had_liked":false,"id":138928,"user_name":"🍪","can_delete":false,"product_type":"c1","uid":1299829,"ip_address":"","ucode":"2B6D01EA82DE97","user_header":"https://static001.geekbang.org/account/avatar/00/13/d5/75/d93f9648.jpg","comment_is_top":false,"comment_ctime":1570509857,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570509857","product_id":100033601,"comment_content":"想知道老师的 14kb 怎么算出来的，发送窗口大小乘以 MTU 吗？如果这样的话，应该就不是固定的，很可能在html请求完之后，就变成更大的值了","like_count":0},{"had_liked":false,"id":138102,"user_name":"大前端洞见","can_delete":false,"product_type":"c1","uid":1010463,"ip_address":"","ucode":"1FA227A25F6056","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/1f/f7be5246.jpg","comment_is_top":false,"comment_ctime":1570024448,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1570024448","product_id":100033601,"comment_content":"老师我想问下，内联CSS和JavaScript不是也让HTML文件加载时间变长了吗？最后结果不还是一样？","like_count":0,"discussions":[{"author":{"id":1623567,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c6/0f/3937645e.jpg","nickname":"NBE01","note":"","ucode":"DF0D22D4495D54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28384,"discussion_content":"不一样 少css与javascript的网络请求整个过程。 这个过程 tcp 建立链接，然后在进行下载， 其实还是挺长的。但是inline到html内，就省略了上述的过程。而且本身 再有css + javascript的情况下  css都是需要去block html的dom tree的建立的。都是需要 等css + javascript， 那么inline与否只是在网络上节省了时间，但是也不建议所有都inline到页面上，具体的划分应该按照首屏页面部分，有js操作的 尽量inline， 非首屏区域建议 script放在页面尾部。同时我们可以 采用prefetch等技术 提前告诉浏览器引擎，我们首先加载那些重要资源，比方说你的雪碧图以及js文件等。 因为一般图片的资源请求优先级都是medium等级的，当你采用prefetch的时候能提前加载，这样你首屏需要用到的雪碧图能够第一时间去加载，不会被其他的图片资源给block住了。并且 js文件可以提升到heigh等级，主业务逻辑文件会优先加载，应该会比预扫描更快，因为你perfetch是写在head上的，比页位更早发现。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1570693434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1782777,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/33/f9/50b76abe.jpg","nickname":"AMIR","note":"","ucode":"65142D9669071B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1623567,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c6/0f/3937645e.jpg","nickname":"NBE01","note":"","ucode":"DF0D22D4495D54","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":109477,"discussion_content":"解决了我的困惑，虽然html文件变大了，但是少了建立网络连接建立的时间","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577696897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":28384,"ip_address":""},"score":109477,"extra":""},{"author":{"id":2015986,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c2/f2/b3b349a4.jpg","nickname":"OOP","note":"","ucode":"FA536DFBF793F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1623567,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c6/0f/3937645e.jpg","nickname":"NBE01","note":"","ucode":"DF0D22D4495D54","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312066,"discussion_content":"http keep-alive 避免tcp多次连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602577777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":28384,"ip_address":""},"score":312066,"extra":""}]}]}]}