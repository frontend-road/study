{"id":347446,"title":"44 | å…ˆç¹ä¸ºå¿«ï¼šHTTP/3å®éªŒç‰ˆæœ¬é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚</p><p>ä¸çŸ¥ä¸è§‰ï¼Œã€Šé€è§†HTTPåè®®ã€‹è¿™ä¸ªä¸“æ é©¬ä¸Šå°±è¦ä¸¤å‘¨å²äº†ã€‚å‰å‡ å¤©æˆ‘çœ‹äº†ä¸€ä¸‹ä¸“æ çš„ç›¸å…³ä¿¡æ¯ï¼Œè®¢é˜…æ•°åˆšå¥½ç ´ä¸‡ï¼Œéå¸¸æ„Ÿè°¢åŒ…æ‹¬ä½ åœ¨å†…çš„æ‰€æœ‰æœ‹å‹ä»¬çš„å…³å¿ƒã€æ”¯æŒã€é¼“åŠ±å’Œé­ç­–ã€‚</p><p>åœ¨ä¸“æ çš„ç»“æŸè¯­é‡Œæˆ‘æ›¾ç»è¯´è¿‡ï¼Œå¸Œæœ›HTTP/3å‘å¸ƒä¹‹æ—¶èƒ½å¤Ÿå†ç›¸ä¼šã€‚è€Œå¦‚ä»Šè™½ç„¶å®ƒè¿˜æ²¡æœ‰å‘å¸ƒï¼Œä½†ä¹Ÿä¸ºæ—¶ä¸è¿œäº†ã€‚</p><p>æ‰€ä»¥ä»Šå¤©å‘¢ï¼Œæˆ‘å°±æ¥å’Œä½ èŠèŠHTTP/3çš„ä¸€äº›äº‹ï¼Œå°±å½“æ˜¯â€œå°å°é²œâ€å§ã€‚</p><h2>HTTP/3çš„ç°çŠ¶</h2><p>ä»2019åˆ°2021çš„è¿™ä¸¤å¹´é—´ï¼Œå¤§å®¶å¯¹HTTPåè®®çš„å…³æ³¨é‡ç‚¹å·®ä¸å¤šå…¨éƒ½æ˜¯æ”¾åœ¨HTTP/3æ ‡å‡†çš„åˆ¶è®¢ä¸Šã€‚</p><p>æœ€åˆä¸“æ å¼€å§‹çš„æ—¶å€™ï¼ŒHTTP/3è‰æ¡ˆè¿˜æ˜¯ç¬¬20ç‰ˆï¼Œè€Œç°åœ¨åˆ™å·²ç»æ˜¯ç¬¬34ç‰ˆäº†ï¼Œå‘å±•çš„é€Ÿåº¦å¯ä»¥è¯´æ˜¯éå¸¸å¿«çš„ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿå˜åŠ¨å¾—éå¸¸å¤šã€‚å¾ˆæœ‰å¯èƒ½æœ€å¤šå†è¿‡ä¸€å¹´ï¼Œç”šè‡³æ˜¯ä»Šå¹´å†…ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ­£å¼çš„æ ‡å‡†ã€‚</p><p>åœ¨æ ‡å‡†æ–‡æ¡£çš„åˆ¶è®¢è¿‡ç¨‹ä¸­ï¼Œäº’è”ç½‘ä¸šå±Šä¹Ÿæ²¡æœ‰é—²ç€ï¼Œä¹Ÿåœ¨ç§¯æåœ°ä¸ºæ­¤åšå‡†å¤‡ï¼Œä»¥è‰æ¡ˆä¸ºåŸºç¡€åšå„ç§å®éªŒæ€§è´¨çš„å¼€å‘ã€‚</p><p>è¿™å…¶ä¸­æ¯”è¾ƒå¼•äººç©ç›®çš„è¦æ•°CDNå¤§å‚Cloudflareï¼Œè¿˜æœ‰Web Serveré¢†å¤´ç¾ŠNginxï¼ˆè€Œå¦ä¸€ä¸ªWeb Server Apacheå¥½åƒæ²¡ä»€ä¹ˆåŠ¨é™ï¼‰äº†ã€‚</p><p>Cloudflareå…¬å¸ç”¨Rustè¯­è¨€ç¼–å†™äº†ä¸€ä¸ªQUICæ”¯æŒåº“ï¼Œåå­—å«â€œquicheâ€ï¼Œç„¶ååœ¨ä¸Šé¢åŠ äº†ä¸€å±‚è–„è–„çš„å°è£…ï¼Œç”±æ­¤èƒ½å¤Ÿä»¥ä¸€ä¸ªCæ¨¡å—çš„å½¢å¼åŠ å…¥è¿›Nginxæ¡†æ¶ï¼Œä¸ºNginxæä¾›äº†HTTP/3çš„åŠŸèƒ½ã€‚ï¼ˆå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href=\"https://blog.cloudflare.com/zh-cn/http3-the-past-present-and-future-zh-cn/\">HTTP/3ï¼šè¿‡å»ï¼Œç°åœ¨ï¼Œè¿˜æœ‰æœªæ¥</a>ï¼‰</p><!-- [[[read_end]]] --><p>ä¸è¿‡Cloudflareçš„è¿™ä¸ªQUICæ”¯æŒåº“å±äºâ€œæ°‘é—´è¡Œä¸ºâ€ï¼Œæ²¡æœ‰å¾—åˆ°Nginxçš„è®¤å¯ã€‚Nginxçš„å®˜æ–¹HTTP/3æ¨¡å—å…¶å®ä¸€ç›´åœ¨â€œç§˜å¯†â€å¼€å‘ä¸­ï¼Œåœ¨å»å¹´çš„6æœˆä»½ï¼Œè¿™ä¸ªæ¨¡å—ç»ˆäºæ­£å¼å…¬å¸ƒäº†ï¼Œåå­—å°±å«â€œhttp_v3_moduleâ€ã€‚ï¼ˆå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href=\"https://www.nginx.com/blog/introducing-technology-preview-nginx-support-for-quic-http-3/\">Introducing a Technology Preview of NGINX Support for QUIC and HTTP/3</a>ï¼‰</p><p>ç›®å‰ï¼Œhttp_v3_moduleå·²ç»åº¦è¿‡äº†Alphaé˜¶æ®µï¼Œå¤„äºBetaçŠ¶æ€ï¼Œä½†æ”¯æŒçš„è‰æ¡ˆç‰ˆæœ¬æ˜¯29ï¼Œè€Œä¸æ˜¯æœ€æ–°çš„34ã€‚</p><p>è¿™å½“ç„¶ä¹Ÿæœ‰æƒ…å¯åŸã€‚ç›¸æ¯”äºHTTP/2ï¼ŒHTTP/3çš„å˜åŒ–å¤ªå¤§äº†ï¼ŒNginxå›¢é˜Ÿçš„ç²¾åŠ›è¿˜æ˜¯é›†ä¸­åœ¨æ ¸å¿ƒåŠŸèƒ½å®ç°ä¸Šï¼Œé€‰æ‹©ä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬æ›´æœ‰åˆ©äºå¼€å‘ï¼Œè€Œä¸”29åé¢çš„å¤šä¸ªç‰ˆæœ¬æ ‡å‡†å…¶å®å·®å¼‚éå¸¸å°ï¼ˆä»…æ–‡å­—ç¼–è¾‘å˜æ›´ï¼‰ã€‚</p><p>Nginxä¹Ÿä¸ºæµ‹è¯•HTTP/3ä¸“é—¨æ­å»ºäº†ä¸€ä¸ªç½‘ç«™ï¼š<a href=\"https://quic.nginx.org/\">quic.nginx.org</a>ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šå»æµ‹è¯•éªŒè¯HTTP/3åè®®ã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç”¨å®ƒæ¥çœ‹çœ‹HTTP/3åˆ°åº•é•¿ä»€ä¹ˆæ ·ã€‚</p><h2>åˆè¯†HTTP/3</h2><p>åœ¨ä½“éªŒä¹‹å‰ï¼Œå¾—å…ˆè¯´ä¸€ä¸‹æµè§ˆå™¨ï¼Œè¿™æ˜¯æµ‹è¯•QUICå’ŒHTTP/3çš„å…³é”®ï¼šæœ€å¥½ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„Chromeæˆ–è€…Firefoxï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯Chrome88ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨çª—å£ï¼Œè¾“å…¥æµ‹è¯•ç½‘ç«™çš„URIï¼ˆ<a href=\"https://quic.nginx.org/\">https://quic.nginx.org/</a>ï¼‰ï¼Œå¦‚æœâ€œè¿æ°”å¥½â€ï¼Œåˆ·æ–°å‡ æ¬¡å°±èƒ½å¤Ÿåœ¨ç½‘é¡µä¸Šçœ‹åˆ°å¤§å¤§çš„QUICæ ‡å¿—äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/82/e0/827d261f49f6a20eb227f851dec667e0.png?wh=986*398\" alt=\"\"></p><p>ä¸è¿‡ä½ å¾ˆå¯èƒ½â€œè¿æ°”â€æ²¡æœ‰è¿™ä¹ˆå¥½ï¼Œåœ¨ç½‘é¡µä¸Šçœ‹åˆ°çš„QUICæ ‡å¿—æ˜¯ç°è‰²çš„ã€‚è¿™æ„å‘³ç€æš‚æ—¶æ²¡æœ‰åº”ç”¨QUICå’ŒHTTP/3ï¼Œè¿™å°±éœ€è¦å¯¹Chromeåšä¸€ç‚¹è®¾ç½®ï¼Œå¼€å¯QUICçš„æ”¯æŒã€‚</p><p>é¦–å…ˆè¦åœ¨åœ°å€æ è¾“å…¥â€œchrome://flagsâ€ï¼Œæ‰“å¼€è®¾ç½®é¡µé¢ï¼Œç„¶åæœç´¢â€œQUICâ€ï¼Œæ‰¾åˆ°å¯ç”¨QUICçš„é€‰é¡¹ï¼ŒæŠŠå®ƒæ”¹ä¸ºâ€œEnabledâ€ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„å›¾ç‰‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/67/65/674ff32bf05b5859fb6985e29f8c1e65.png?wh=1724*716\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åœ¨å‘½ä»¤è¡Œé‡Œå¯åŠ¨Chromeæµè§ˆå™¨ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œä¼ é€’â€œenable-quicâ€â€œquic-versionâ€ç­‰å‚æ•°æ¥è¦æ±‚Chromeä½¿ç”¨ç‰¹å®šçš„è‰æ¡ˆç‰ˆæœ¬ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å°±æ˜¯æˆ‘åœ¨macOSä¸Šè¿è¡ŒChromeçš„å‘½ä»¤è¡Œã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒNginxç½‘ç«™ä¸Šçš„READMEæ–‡æ¡£ï¼Œåœ¨Windowsæˆ–è€…Linuxä¸Šç”¨ç±»ä¼¼çš„å½¢å¼è¿è¡ŒChromeçš„å‘½ä»¤è¡Œï¼š</p><pre><code>/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome \\\n--enable-quic --quic-version=h3-29 \\\n--origin-to-force-quic-on=quic.nginx.org:443\n</code></pre><p>å¦‚æœè¿™æ ·æ“ä½œä¹‹åç½‘é¡µä¸Šä»ç„¶æ˜¯æ˜¾ç¤ºç°è‰²æ ‡å¿—ä¹Ÿä¸è¦ç´§ï¼Œä½ è¿˜å¯ä»¥ç”¨â€œF12â€æ‰“å¼€Chromeçš„å¼€å‘è€…å·¥å…·é¢æ¿ï¼ŒæŸ¥çœ‹protocolä¸€æ ã€‚</p><p>åº”è¯¥å¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†èµ„æºæ˜¾ç¤ºçš„è¿˜æ˜¯â€œh2â€ï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯HTTP/2åè®®ï¼Œä½†æœ‰ä¸€å°éƒ¨åˆ†èµ„æºæ˜¾ç¤ºçš„æ˜¯â€œh3-29â€ï¼Œè¿™å°±è¡¨ç¤ºå®ƒæ˜¯ä½¿ç”¨HTTP/3åè®®ä¼ è¾“çš„ï¼Œè€Œåé¢çš„â€œ29â€åç¼€ï¼Œæ„æ€æ˜¯åŸºäºç¬¬29ç‰ˆè‰æ¡ˆï¼Œä¹Ÿå°±æ˜¯è¯´å¯ç”¨äº†QUIC+HTTP/3åè®®ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/e6/c3a532736412a4457ee81a280fc76be6.png?wh=1664*1320\" alt=\"\"></p><h2>WiresharkæŠ“åŒ…åˆ†æ</h2><p>å¥½äº†ï¼Œå¤§æ¦‚çœ‹äº†HTTP/3æ˜¯ä»€ä¹ˆæ ·ï¼Œæœ‰äº†æ„Ÿæ€§è®¤è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥æ¥æŠ“åŒ…åˆ†æã€‚</p><p>ç½‘ç»œæŠ“åŒ…å·¥å…·Wiresharkä½ ä¸€å®šå·²ç»æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œè¿™é‡ŒåŒæ ·è¦ç”¨æœ€æ–°çš„ï¼Œä¸ç„¶å¯èƒ½è¯†åˆ«ä¸äº†QUICå’ŒHTTP/3çš„æ•°æ®åŒ…ï¼Œæ¯”å¦‚æˆ‘ç”¨çš„å°±æ˜¯3.4.3ã€‚</p><p>QUICçš„åº•å±‚æ˜¯UDPï¼Œæ‰€ä»¥åœ¨æŠ“åŒ…çš„æ—¶å€™è¿‡æ»¤å™¨è¦è®¾ç½®æˆâ€œudp port 443â€ï¼Œç„¶åå¯åŠ¨å°±å¯ä»¥äº†ã€‚è¿™æ¬¡æˆ‘æŠ“çš„åŒ…ä¹Ÿæ”¾åˆ°äº†GitHubçš„<a href=\"https://github.com/chronolaw/http_study/tree/master/wireshark\">Wiresharkç›®å½•</a>ï¼Œæ–‡ä»¶åæ˜¯â€œ44-1.pcapngâ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6d/d4/6d217ee87e1f777d432059f81fc2f5d4.png?wh=1758*1132\" alt=\"\"></p><p>å› ä¸ºHTTP/3å†…ç½®äº†TLSåŠ å¯†ï¼ˆå¯å‚è€ƒä¹‹å‰çš„<a href=\"https://time.geekbang.org/column/article/115564\">ç¬¬32è®²</a>ï¼‰ï¼Œæ‰€ä»¥ç”¨WiresharkæŠ“åŒ…åçœ‹åˆ°çš„æ•°æ®å¤§éƒ¨åˆ†éƒ½æ˜¯ä¹±ç ï¼Œæƒ³è¦è§£å¯†çœ‹åˆ°çœŸå®æ•°æ®å°±å¿…é¡»è®¾ç½®SSLKEYLOGï¼ˆå‚è€ƒ<a href=\"https://time.geekbang.org/column/article/110354\">ç¬¬26è®²</a>ï¼‰ã€‚</p><p>ä¸è¿‡éå¸¸é—æ†¾ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ï¼Œè™½ç„¶æˆ‘å¯¼å‡ºäº†SSLKEYLOGï¼Œä½†åœ¨Wiresharké‡Œè¿˜æ˜¯æ— æ³•è§£å¯†HTTP/3çš„æ•°æ®ï¼Œæ˜¾ç¤ºè§£å¯†é”™è¯¯ã€‚ä½†åŒæ ·çš„è®¾ç½®å’Œæ“ä½œæ­¥éª¤ï¼ŒæŠ“åŒ…è§£å¯†HTTPSå’ŒHTTP/2å´æ˜¯æ­£å¸¸çš„ï¼Œä¼°è®¡å¯èƒ½æ˜¯ç›®å‰Wiresharkè‡ªèº«å¯¹HTTP/3çš„æ”¯æŒè¿˜ä¸å¤ªå®Œå–„å§ã€‚</p><p>æ‰€ä»¥ä»Šå¤©æˆ‘ä¹Ÿå°±åªèƒ½å¸¦ä½ ä¸€èµ·æ¥çœ‹QUICçš„æ¡æ‰‹é˜¶æ®µäº†ã€‚è¿™ä¸ªå…¶å®ä¸TLS1.3éå¸¸æ¥è¿‘ï¼Œåªä¸è¿‡æ˜¯å†…åµŒåœ¨äº†QUICåè®®é‡Œï¼Œå¦‚æœä½ å­¦è¿‡äº†â€œå®‰å…¨ç¯‡â€â€œé£ç¿”ç¯‡â€çš„è¯¾ç¨‹ï¼Œçœ‹QUICåº”è¯¥æ˜¯ä¸ä¼šè´¹ä»€ä¹ˆåŠ›æ°”ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹Headeræ•°æ®ï¼š</p><pre><code>[Packet Length: 1350]\n1... .... = Header Form: Long Header (1)\n.1.. .... = Fixed Bit: True\n..00 .... = Packet Type: Initial (0)\n.... 00.. = Reserved: 0\n.... ..00 = Packet Number Length: 1 bytes (0)\nVersion: draft-29 (0xff00001d)\nDestination Connection ID Length: 20\nDestination Connection ID: 3ae893fa047246e55f963ea14fc5ecac3774f61e\nSource Connection ID Length: 0\n</code></pre><p>QUICåŒ…å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ ‡å¿—ä½ï¼Œå¯ä»¥çœ‹åˆ°æœ€å¼€å§‹å»ºç«‹è¿æ¥ä¼šå‘ä¸€ä¸ªé•¿åŒ…ï¼ˆLong Headerï¼‰ï¼ŒåŒ…ç±»å‹æ˜¯åˆå§‹åŒ–ï¼ˆInitialï¼‰ã€‚</p><p>æ ‡å¿—ä½å­—èŠ‚åé¢æ˜¯4å­—èŠ‚çš„ç‰ˆæœ¬å·ï¼Œå› ä¸ºç›®å‰è¿˜æ˜¯è‰æ¡ˆï¼Œæ‰€ä»¥æ˜¾ç¤ºçš„æ˜¯â€œdraft-29â€ã€‚å†åé¢ï¼Œæ˜¯QUICçš„ç‰¹æ€§ä¹‹ä¸€â€œè¿æ¥IDâ€ï¼Œé•¿åº¦ä¸º20å­—èŠ‚çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p><p>è¿™é‡Œæˆ‘è¦ç‰¹åˆ«æé†’ä½ æ³¨æ„ï¼Œå› ä¸ºæ ‡å‡†ç‰ˆæœ¬çš„æ¼”å˜ï¼Œè¿™ä¸ªæ ¼å¼å·²ç»ä¸å½“åˆ<a href=\"https://time.geekbang.org/column/article/115564\">ç¬¬32è®²</a>çš„å†…å®¹ï¼ˆdraft-20ï¼‰å®Œå…¨ä¸ä¸€æ ·äº†ï¼Œåœ¨åˆ†ææŸ¥çœ‹çš„æ—¶å€™ä¸€å®šè¦ä½¿ç”¨<a href=\"https://tools.ietf.org/html/draft-ietf-quic-transport-28#section-17.2\">å¯¹åº”çš„RFCæ–‡æ¡£</a>ã€‚</p><p>å¾€ä¸‹å†çœ‹ï¼Œæ˜¯QUICçš„CRYPTOå¸§ï¼Œç”¨æ¥ä¼ è¾“æ¡æ‰‹æ¶ˆæ¯ï¼Œå¸§ç±»å‹æ˜¯0x06ï¼š</p><pre><code>TLSv1.3 Record Layer: Handshake Protocol: Client Hello\n    Frame Type: CRYPTO (0x0000000000000006)\n    Offset: 0\n    Length: 309\n    Crypto Data\n    Handshake Protocol: Client Hello\n</code></pre><p>CRYPTOå¸§é‡Œçš„æ•°æ®ï¼Œå°±æ˜¯QUICå†…ç½®çš„TLS â€œClient Helloâ€äº†ï¼Œæˆ‘æŠŠé‡Œé¢çš„ä¸€äº›é‡è¦ä¿¡æ¯æ‘˜äº†å‡ºæ¥ï¼š</p><pre><code>Handshake Protocol: Client Hello\n   Handshake Type: Client Hello (1)\n   Version: TLS 1.2 (0x0303)\n   Random: b4613d...\n   Cipher Suites (3 suites)\n       Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)\n       Cipher Suite: TLS_AES_256_GCM_SHA384 (0x1302)\n       Cipher Suite: TLS_CHACHA20_POLY1305_SHA256 (0x1303)\n   Extension: server_name (len=19)\n       Type: server_name (0)\n       Server Name Indication extension\n           Server Name: quic.nginx.org\n   Extension: application_layer_protocol_negotiation (len=8)\n       Type: application_layer_protocol_negotiation (16)\n       ALPN Protocol\n           ALPN Next Protocol: h3-29\n   Extension: key_share (len=38)\n       Key Share extension\n   Extension: supported_versions (len=3)\n       Type: supported_versions (43)\n       Supported Version: TLS 1.3 (0x0304)\n</code></pre><p>ä½ çœ‹ï¼Œè¿™ä¸ªå°±æ˜¯æ ‡å‡†çš„TLS1.3æ•°æ®ï¼ˆä¼ªè£…æˆäº†TLS1.2ï¼‰ï¼Œæ”¯æŒAES128ã€AES256ã€CHACHA20ä¸‰ä¸ªå¯†ç å¥—ä»¶ï¼ŒSNIæ˜¯â€œquic.nginx.orgâ€ï¼ŒALPNæ˜¯â€œh3-29â€ã€‚</p><p>æµè§ˆå™¨å‘é€å®ŒInitialæ¶ˆæ¯ä¹‹åï¼ŒæœåŠ¡å™¨å›å¤Handshakeï¼Œç”¨ä¸€ä¸ªRTTå°±å®Œæˆäº†æ¡æ‰‹ï¼ŒåŒ…çš„æ ¼å¼åŸºæœ¬ä¸€æ ·ï¼Œç”¨äº†ä¸€ä¸ªCRYPTOå¸§å’ŒACKå¸§ï¼Œæˆ‘å°±ä¸ç»†åˆ†æäº†ï¼ˆå¯å‚è€ƒ<a href=\"https://tools.ietf.org/html/draft-ietf-quic-transport-28#section-17.2\">ç›¸åº”çš„RFC</a>ï¼‰ï¼Œåªè´´ä¸€ä¸‹é‡Œé¢çš„â€œServer Helloâ€ä¿¡æ¯ï¼š</p><pre><code>Handshake Protocol: Server Hello\n    Handshake Type: Server Hello (2)\n    Version: TLS 1.2 (0x0303)\n    Random: d6aede...\n    Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)\n    Extension: key_share (len=36)\n        Key Share extension\n    Extension: supported_versions (len=2)\n        Type: supported_versions (43)\n        Supported Version: TLS 1.3 (0x0304)\n</code></pre><p>è¿™é‡ŒæœåŠ¡å™¨é€‰æ‹©äº†â€œTLS_AES_128_GCM_SHA256â€ï¼Œç„¶åå¸¦å›äº†éšæœºæ•°å’Œkey_shareï¼Œå®Œæˆäº†æ¡æ‰‹é˜¶æ®µçš„å¯†é’¥äº¤æ¢ã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼ŒQUICå’ŒHTTP/3çš„â€œæŠ¢é²œä½“éªŒâ€å°±åˆ°è¿™é‡Œå§ï¼Œæˆ‘ç®€å•å°ç»“ä¸€ä¸‹ä»Šå¤©çš„è¦ç‚¹ï¼š</p><ol>\n<li>HTTP/3çš„æœ€æ–°è‰æ¡ˆç‰ˆæœ¬æ˜¯34ï¼Œå¾ˆå¿«å°±ä¼šå‘å¸ƒæ­£å¼ç‰ˆæœ¬ã€‚</li>\n<li>Nginxæä¾›äº†å¯¹HTTP/3çš„å®éªŒæ€§è´¨æ”¯æŒï¼Œç›®å‰æ˜¯BetaçŠ¶æ€ï¼Œåªèƒ½ç”¨äºæµ‹è¯•ã€‚</li>\n<li>æœ€æ–°ç‰ˆæœ¬çš„Chromeå’ŒFirefoxéƒ½æ”¯æŒQUICå’ŒHTTP/3ï¼Œä½†å¯èƒ½éœ€è¦ä¸€äº›è®¾ç½®å·¥ä½œæ‰èƒ½å¯ç”¨ã€‚</li>\n<li>è®¿é—®ä¸“é—¨çš„æµ‹è¯•ç½‘ç«™â€œquic.nginx.orgâ€å¯ä»¥æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒQUICå’ŒHTTP/3ã€‚</li>\n<li>æŠ“åŒ…åˆ†æQUICå’ŒHTTP/3éœ€è¦ç”¨æœ€æ–°çš„Wiresharkï¼Œè¿‡æ»¤å™¨ç”¨UDPï¼Œè¿˜è¦å¯¼å‡ºSSLKEYLOGæ‰èƒ½è§£å¯†ã€‚</li>\n</ol><p>å¸Œæœ›ä½ çœ‹å®Œè¿™ä¸€è®²åè‡ªå·±å®é™…åŠ¨æ‰‹æ“ä½œä¸€ä¸‹ï¼Œè®¿é—®ç½‘ç«™å†æŠ“åŒ…ï¼Œå¦‚æœèƒ½æ­£ç¡®è§£å¯†HTTP/3æ•°æ®ï¼Œå°±æŠŠèµ„æ–™å‘å‡ºæ¥ï¼Œå’Œæˆ‘ä»¬åˆ†äº«ä¸‹ã€‚</p><p>å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ä¸€è®²çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/4f/1b4266dcedc5785f3023f47083e4894f.jpg?wh=2800*4221\" alt=\"\"></p>","neighbors":{"left":{"article_title":"43 | å¦‚ä½•è¿›è¡ŒDockerå®éªŒç¯å¢ƒæ­å»ºï¼Ÿ","id":283892},"right":{"article_title":"ç½—å‰‘é”‹è€å¸ˆå‡ºæ–°è¯¾äº†ï¼Ÿ","id":525685}},"comments":[{"had_liked":false,"id":281235,"user_name":"CC","can_delete":false,"product_type":"c1","uid":1021014,"ip_address":"","ucode":"2B732860C4231B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/94/56/4b8395f6.jpg","comment_is_top":false,"comment_ctime":1614653319,"is_pvip":true,"replies":[{"id":"102140","content":"å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦ä¹ä¹ã€‚","user_name":"ä½œè€…å›å¤","comment_id":281235,"uid":"1181974","ip_address":"","utype":1,"ctime":1614684803,"user_name_real":"ç½—å‰‘é”‹"}],"discussion_count":2,"race_medal":0,"score":"27384457095","product_id":100029001,"comment_content":"æƒŠå–œï¼Œåˆšåˆšå¥½åœ¨å­¦ä¹ ç¬¬äºŒéï¼Œçœ‹åˆ° HTTP&#47;3 çš„æ–°æ–‡ç« æ›´æ–°ã€‚è°¢è°¢è€å¸ˆã€‚","like_count":7,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516336,"discussion_content":"å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦ä¹ä¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614684803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244231,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/47/a4be64d8.jpg","nickname":"Liber","note":"","ucode":"A5CBFDB15A7745","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368027,"discussion_content":"äºŒåˆ·çš„è·¯è¿‡åŒå–œï¼ğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618543579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293085,"user_name":"æ°´æ‰‹è¾›ä¼¯è¾¾","can_delete":false,"product_type":"c1","uid":2267088,"ip_address":"","ucode":"94D8FD51FE4F8A","user_header":"https://static001.geekbang.org/account/avatar/00/22/97/d0/95eaabef.jpg","comment_is_top":false,"comment_ctime":1621210948,"is_pvip":false,"replies":[{"id":"106101","content":"æ„Ÿè°¢æ”¯æŒï¼Œå¤§å®¶å…±åŒè¿›æ­¥ã€‚","user_name":"ä½œè€…å›å¤","comment_id":293085,"uid":"1181974","ip_address":"","utype":1,"ctime":1621218492,"user_name_real":"ç½—å‰‘é”‹"}],"discussion_count":1,"race_medal":0,"score":"10211145540","product_id":100029001,"comment_content":"ç¬¬äºŒéå­¦ä¹ Chronoè€å¸ˆçš„httpåè®®ã€‚è¿™é—¨è¯¾åˆ†å±‚æ¸…æ™°ï¼Œç¯ç¯ç›¸æ‰£ï¼Œç”±ç®€å…¥ç¹ï¼Œå¯¹äºåˆä¸­çº§å‰ç«¯å’Œè¿ç»´äººå‘˜å»äº†è§£httpåè®®å¸®åŠ©æ˜¯æ¯”è¾ƒå¤§çš„ï¼æœ€éš¾èƒ½å¯è´µçš„æ˜¯ï¼Œè€å¸ˆå‰åä¸¤å¹´æ—¶é—´ä¸€ç›´åšæŒæ›´æ–°ï¼Œåˆå¢åŠ äº†dockerè¯•éªŒç¯èŠ‚å’Œhttp3çš„å‘å±•updates , åŒæ—¶ï¼Œè€å¸ˆååˆ†æ³¨æ„å’Œå­¦å‘˜çš„äº’åŠ¨ï¼Œè€Œä¸”å‡ ä¹å’Œæ¯ä¸ªç•™è¨€è¿›è¡Œç‚¹è¯„å’Œåˆ†æï¼Œè¿™äº›è¯¾åç­”ç–‘åˆæå¤§åœ°åˆ†ä¸°å¯Œäº†å¤§å®¶çš„çŸ¥è¯†ï¼Œå¢æ¶¨äº†ç»éªŒï¼Œååˆ†åº†å¹¸åœ¨æå®¢æ—¶é—´é‡Œé¢é‡åˆ°è¿™ä¹ˆä¼˜ç§€çš„è¯¾ç¨‹ï¼<br><br>ç¥è€å¸ˆå¥åº·ï¼Œé¡ºåˆ©ï¼","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520066,"discussion_content":"æ„Ÿè°¢æ”¯æŒï¼Œå¤§å®¶å…±åŒè¿›æ­¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621218492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323571,"user_name":"Omooo","can_delete":false,"product_type":"c1","uid":1138766,"ip_address":"","ucode":"FFADFDC72EC847","user_header":"https://static001.geekbang.org/account/avatar/00/11/60/4e/1c654d86.jpg","comment_is_top":false,"comment_ctime":1637996982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637996982","product_id":100029001,"comment_content":"ç‰›é€¼ï¼","like_count":0},{"had_liked":false,"id":308071,"user_name":"é˜¿æ–¯è’‚èŠ¬","can_delete":false,"product_type":"c1","uid":1024164,"ip_address":"","ucode":"61D5E3BDA4EBC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","comment_is_top":false,"comment_ctime":1629378433,"is_pvip":false,"replies":[{"id":"111608","content":"Thanks","user_name":"ä½œè€…å›å¤","comment_id":308071,"uid":"1181974","ip_address":"","utype":1,"ctime":1629440114,"user_name_real":"ç½—å‰‘é”‹"}],"discussion_count":1,"race_medal":0,"score":"1629378433","product_id":100029001,"comment_content":"ä¸ºè€å¸ˆå¯¹è¯¾ç¨‹çš„æŒç»­å…³æ³¨å’ŒæŠ€æœ¯æ›´æ–°çš„ç§‘æ™®ç‚¹èµï¼","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525382,"discussion_content":"Thanks","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629440114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284856,"user_name":"Luca","can_delete":false,"product_type":"c1","uid":1205040,"ip_address":"","ucode":"0161C4DCB9ECF4","user_header":"https://static001.geekbang.org/account/avatar/00/12/63/30/6f4b925c.jpg","comment_is_top":false,"comment_ctime":1616499313,"is_pvip":false,"replies":[{"id":"103350","content":"Chromeçš„è¡Œä¸ºç¡®å®ä»¤äººè¿·æƒ‘ï¼Œæœ‰çš„ç‰ˆæœ¬å°±ä¸è¡Œï¼Œä¸è¿‡ç›¸ä¿¡ä»¥åä¼šè¶Šæ¥è¶Šç®€å•æ–¹ä¾¿ã€‚","user_name":"ä½œè€…å›å¤","comment_id":284856,"uid":"1181974","ip_address":"","utype":1,"ctime":1616544009,"user_name_real":"ç½—å‰‘é”‹"}],"discussion_count":2,"race_medal":0,"score":"1616499313","product_id":100029001,"comment_content":"æ›´æ–°åˆ°äº†Chrome89.0.4389.90ï¼Œæ— éœ€è¿›è¡Œé¢å¤–è®¾ç½®å°±èƒ½å¤Ÿæœ‰QUICæ”¯æŒäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517489,"discussion_content":"Chromeçš„è¡Œä¸ºç¡®å®ä»¤äººè¿·æƒ‘ï¼Œæœ‰çš„ç‰ˆæœ¬å°±ä¸è¡Œï¼Œä¸è¿‡ç›¸ä¿¡ä»¥åä¼šè¶Šæ¥è¶Šç®€å•æ–¹ä¾¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616544009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2033513,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg","nickname":"Alan He","note":"","ucode":"A0780F4619D388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378054,"discussion_content":"è¯•äº†ä¸‹Chrome 91.0.4472.77\n\nflagsè®¾ç½®ä¸­ï¼ŒQUICæ‰“å¼€ã€‚ä½†æ˜¯è®¿é—®https://quic.nginx.org/è¿˜æ˜¯æ²¡æœ‰çœ‹åˆ°QUICæ”¯æŒã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623033683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281324,"user_name":"ä¹˜é£ç ´æµª","can_delete":false,"product_type":"c1","uid":2406841,"ip_address":"","ucode":"937AF15F3FEBDC","user_header":"https://static001.geekbang.org/account/avatar/00/24/b9/b9/9e4d7aa4.jpg","comment_is_top":false,"comment_ctime":1614691050,"is_pvip":false,"replies":[{"id":"102153","content":"æˆ‘ç°åœ¨æ›´æ–°åˆ°88.0.4324.192ï¼Œå°±ä¸èƒ½ç›´æ¥æ˜¾ç¤ºå‡ºquicæ”¯æŒäº†ã€‚<br><br>ç›®å‰HTTP&#47;3çš„èµ„æ–™è¿˜åªæœ‰rfcï¼Œä¸è¿‡ä¹Ÿä¸ç”¨å¤ªç€æ€¥ï¼Œç­‰æ­£å¼å‘å¸ƒåä¼°è®¡å°±ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„åˆ†æç ”ç©¶èµ„æ–™äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":281324,"uid":"1181974","ip_address":"","utype":1,"ctime":1614734293,"user_name_real":"ç½—å‰‘é”‹"}],"discussion_count":2,"race_medal":0,"score":"1614691050","product_id":100029001,"comment_content":"å®æµ‹chromeç‰ˆæœ¬ 88.0.4324.190ï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰æ— éœ€è®¾ç½®å¯ä»¥æ”¯æŒquic<br>firefox 86.0éœ€è¦ç®€å•è®¾ç½®ä¸€ä¸‹ï¼Œå…·ä½“é¡µé¢æœfirefoxï¼Œç¬¬ä¸€æ¡å°±æ˜¯<br>wireshark3.4.3æŠ“åŒ…ç»“æœå’Œå¤§å¸ˆä¸€æ ·ï¼Œpayloadè§£ä¸å‡ºæ¥<br>è¯·é—®å¤§å¸ˆï¼Œç°åœ¨å­¦ä¹ HTTP&#47;3ï¼Œç°åœ¨å¦‚æœè¦æ·±å…¥äº†è§£HTTP&#47;3,éœ€è¦çœ‹rfcå§ï¼Ÿæœ‰æ²¡æœ‰å…¶ä»–å¥½çš„èµ„æºï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516359,"discussion_content":"æˆ‘ç°åœ¨æ›´æ–°åˆ°88.0.4324.192ï¼Œå°±ä¸èƒ½ç›´æ¥æ˜¾ç¤ºå‡ºquicæ”¯æŒäº†ã€‚\n\nç›®å‰HTTP/3çš„èµ„æ–™è¿˜åªæœ‰rfcï¼Œä¸è¿‡ä¹Ÿä¸ç”¨å¤ªç€æ€¥ï¼Œç­‰æ­£å¼å‘å¸ƒåä¼°è®¡å°±ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„åˆ†æç ”ç©¶èµ„æ–™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614734293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2033513,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg","nickname":"Alan He","note":"","ucode":"A0780F4619D388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378055,"discussion_content":"Chromeå¥½è¿·ã€‚ã€‚ã€‚ã€‚ä¸€ä¼šå„¿æ”¯æŒï¼Œä¸€ä¼šå„¿ä¸æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623033733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}