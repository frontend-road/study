{"id":816759,"title":"03ï½œLLaMA 3çš„åº”ç”¨æ¢ç´¢ï¼šæŒ‡ä»¤è·Ÿéšçš„æœ€ä½³å®è·µ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tylerã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¤§æ¨¡å‹åœ¨å¤„ç†é•¿æ–‡æœ¬æ–¹é¢çš„èƒ½åŠ›ã€‚è¿™ä¸€èƒ½åŠ›è®©æˆ‘ä»¬åœ¨é¢å¯¹é•¿ç¯‡ä»£ç æ–‡ä»¶æˆ–å¤§é‡æ–‡å­—èµ„æ–™æ—¶ï¼Œèƒ½å¤Ÿå€ŸåŠ©å¤§æ¨¡å‹è¿›è¡Œé«˜æ•ˆçš„åˆ†æå’Œå¤„ç†ã€‚ç„¶è€Œï¼Œå³ä¾¿å¦‚æ­¤ï¼ŒLLaMA 3 çš„èƒ½åŠ›åœ¨ä¼ ç»Ÿçš„â€œå¯¹è¯æ¡†â€ä¸­ä»ç„¶å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚</p><h2>ä»â€œå¯¹è¯æ¡†â€åˆ°æ›´å¹¿é˜”çš„ä¸–ç•Œ</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåƒ ChatGPT è¿™æ ·çš„å·¥å…·æœ€æ—©å…¶å®åªæ˜¯ä¸€ä¸ªå¯¹è¯æœºå™¨äººï¼Œä¸»è¦æ˜¯è·ŸäººèŠå¤©ï¼ŒåŠŸèƒ½ç›¸å¯¹ç®€å•ã€‚ä½†éšç€æŠ€æœ¯çš„è¿›æ­¥ï¼Œå®ƒä¸å†å±€é™äºâ€œå¯¹è¯æ¡†â€é‡Œï¼Œå˜æˆäº†ç°åœ¨å¤šåŠŸèƒ½çš„æ™ºèƒ½åŠ©æ‰‹ã€‚èƒ½æœ‰è¿™ä¹ˆå¤§çš„è¿›æ­¥ï¼Œå…³é”®åœ¨äºå¤§æ¨¡å‹å…·å¤‡äº†æŒ‡ä»¤è·Ÿéšçš„èƒ½åŠ›ï¼ˆInstruction Followingï¼‰ã€‚ç®€å•è¯´ï¼ŒæŒ‡ä»¤è·Ÿéšèƒ½åŠ›å°±æ˜¯å¤§æ¨¡å‹å¯ä»¥æ ¹æ®ç”¨æˆ·çš„æŒ‡ä»¤ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šçš„å·¥å…·ï¼Œå®Œæˆä¸€äº›æ¯”è¾ƒå¤æ‚çš„ä»»åŠ¡ã€‚</p><p>æ¯”å¦‚ï¼Œç°åœ¨çš„ ChatGPT æ’ä»¶åŠŸèƒ½å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ä»¥å‰ ChatGPT ä¸»è¦æ˜¯é è¾“å…¥è¾“å‡ºæ–‡æœ¬è¿›è¡Œå¯¹è¯ï¼Œè€Œæ’ä»¶åŠŸèƒ½è®©å®ƒå¯ä»¥è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œå»æ‰§è¡Œå„ç§ä»»åŠ¡ã€‚ä¸ç®¡æ˜¯æŸ¥æ‰¾ä¿¡æ¯ã€è¿›è¡Œè®¡ç®—ï¼Œè¿˜æ˜¯å’Œå…¶ä»–è½¯ä»¶ååŒå·¥ä½œï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚</p><p><strong>æŒ‡ä»¤è·Ÿéšèƒ½åŠ›æ˜¯ LLaMA 3 æ‰“ç ´â€œå¯¹è¯æ¡†â€é™åˆ¶çš„æ ¸å¿ƒã€‚</strong>è¿™ç§èƒ½åŠ›ä½¿æ¨¡å‹ä¸ä»…èƒ½ç†è§£ç”¨æˆ·çš„æŒ‡ä»¤ï¼Œè¿˜èƒ½é€šè¿‡è°ƒç”¨ç‰¹å®šçš„å·¥å…·æˆ–æ¨¡å—æ¥æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡ã€‚é€šè¿‡æå‡æŒ‡ä»¤è·Ÿéšèƒ½åŠ›ï¼ŒLLaMA 3 å¯ä»¥å®ç°ä»ç®€å•å¯¹è¯æœºå™¨äººåˆ°å¤šåŠŸèƒ½æ™ºèƒ½åŠ©æ‰‹çš„è½¬å˜ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/df/0b/dfcd458404e5c9f8ebd6fae87de9e40b.png?wh=1280x616\" alt=\"å›¾ç‰‡\"></p><h2>æŒ‡ä»¤æŒ‡ä»¤è·Ÿéšèƒ½åŠ›çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå¤§è¯­è¨€æ¨¡å‹æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ’ä»¶çš„å‘¢ï¼Ÿè¿™ä¸ªèƒ½åŠ›èƒŒåçš„æŠ€æœ¯åŸºç¡€å«åšæŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œç°åœ¨å‡ ä¹æ‰€æœ‰ä¸»æµçš„å¤§æ¨¡å‹éƒ½æœ‰ä¸€ä¸ª Instruction ç‰ˆæœ¬ï¼Œè¿™å¹¶ä¸æ˜¯å·§åˆï¼Œè€Œæ˜¯å› ä¸ºæŒ‡ä»¤å¾®è°ƒå¤§å¤§å¢å¼ºäº†æ¨¡å‹çš„ä»»åŠ¡æ‰§è¡Œèƒ½åŠ›ã€‚</p><p>æŒ‡ä»¤å¾®è°ƒï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡ç‰¹å®šçš„è®­ç»ƒï¼Œè®©æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å¹¶æ‰§è¡Œå„ç§æŒ‡ä»¤ã€‚è¿™ç§æŠ€æœ¯è®©å¤§æ¨¡å‹ä¸ä»…èƒ½å¤„ç†å¤æ‚ä»»åŠ¡ï¼Œè¿˜èƒ½æ ¹æ®ä¸åŒä»»åŠ¡çš„è¦æ±‚ï¼Œçµæ´»åœ°è°ƒç”¨ä¸åŒçš„å·¥å…·æˆ–æ¨¡å—ï¼Œæœ€ç»ˆå®Œæˆé¢„æœŸçš„ç›®æ ‡ã€‚è¿™ç§èƒ½åŠ›æ˜¯å¤§æ¨¡å‹èƒ½å¤Ÿèƒœä»»å¤æ‚ä»»åŠ¡çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯å®ƒä»¬èƒ½åœ¨æ™ºèƒ½ä½“æŠ€æœ¯ä¸­å¤§å±•æ‹³è„šçš„å…³é”®ã€‚</p><p><strong>æŒ‡ä»¤å¾®è°ƒæœ¬è´¨ä¸Šæ˜¯é€šè¿‡å¤§é‡çš„å¸¦æ ‡ç­¾æ•°æ®ï¼ˆåŒ…æ‹¬äººç±»å¯¹è¯æ•°æ®ã€å·¥å…·ä½¿ç”¨æ•°æ®ç­‰ï¼‰è¿›è¡Œè®­ç»ƒï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œæ‰§è¡Œå…·ä½“çš„ä»»åŠ¡æŒ‡ä»¤ã€‚</strong>é€šè¿‡è¿™äº›æ•°æ®çš„å¾®è°ƒï¼Œæ¨¡å‹é€æ¸å­¦ä¼šå¦‚ä½•å°†å¤æ‚çš„æŒ‡ä»¤åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„æ­¥éª¤ï¼Œå¹¶å‡†ç¡®è°ƒç”¨ç›¸å…³å·¥å…·ã€‚</p><ol>\n<li>\n<p><strong>äººç±»å¯¹è¯æ•°æ®</strong>ï¼šè¿™ä¸€éƒ¨åˆ†æ•°æ®åŒ…æ‹¬å¤§é‡çš„å¯¹è¯å®ä¾‹ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£è‡ªç„¶è¯­è¨€ä¸­çš„æŒ‡ä»¤ï¼Œå¹¶èƒ½å¤Ÿåšå‡ºæ­£ç¡®çš„å›åº”ã€‚</p>\n</li>\n<li>\n<p><strong>å·¥å…·ä½¿ç”¨æ•°æ®</strong>ï¼šè¿™ä¸€éƒ¨åˆ†æ•°æ®é›†ä¸­åœ¨å¦‚ä½•ä½¿ç”¨å„ç§å·¥å…·ä¸Šï¼Œæ¯”å¦‚è°ƒç”¨ APIã€æ‰§è¡ŒæŸ¥è¯¢ç­‰ç­‰ã€‚è¿™ç±»æ•°æ®è®©æ¨¡å‹ä¸ä»…èƒ½ç†è§£æŒ‡ä»¤ï¼Œè¿˜èƒ½çœŸæ­£åœ°æ“ä½œå·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚</p>\n</li>\n</ol><p>é€šè¿‡è¿™äº›æ•°æ®çš„æ·±åº¦å­¦ä¹ ï¼ŒLLaMA ç³»åˆ—æ¨¡å‹åœ¨æ¥æ”¶åˆ°æŒ‡ä»¤æ—¶ï¼Œèƒ½è¿…é€Ÿè¯†åˆ«å‡ºä»»åŠ¡ç±»å‹ï¼Œå¹¶è°ƒç”¨ç›¸å…³çš„çŸ¥è¯†å’Œå·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚è¿™è®©æ¨¡å‹ä¸å†å±€é™äºå¯¹è¯ï¼Œè€Œæ˜¯èƒ½åœ¨æ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥ä½œç”¨ã€‚</p><h2>æŒ‡ä»¤è·Ÿéšèƒ½åŠ›çš„åº”ç”¨</h2><p>ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“èŠèŠæŒ‡ä»¤è·Ÿéšèƒ½åŠ›çš„åº”ç”¨æŠ€å·§ã€‚å¤§å¤šæ•°æ—¶å€™ï¼ŒLLM ä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜ï¼šä¸€æ˜¯å®ƒæŒæ¡çš„çŸ¥è¯†å¯èƒ½è¿‡æ—¶ï¼ŒäºŒæ˜¯ç”±äºçŸ¥è¯†é¢å¤ªå¹¿ï¼Œæœ‰æ—¶å€™ä¼šâ€œèƒ¡è¯´å…«é“â€ã€‚é€šè¿‡è®© LLM è°ƒç”¨å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒåœ¨æŸäº›é—®é¢˜ä¸Šæ›´é è°±ã€‚ä¸å…¶èŠ±è´¹å¤§é‡æ—¶é—´é€šè¿‡æç¤ºå·¥ç¨‹å¼•å¯¼æ¨¡å‹ç»™å‡ºä½ æƒ³è¦çš„ç­”æ¡ˆï¼Œä¸å¦‚ç›´æ¥è®©å®ƒè°ƒç”¨å·¥å…·ï¼ŒåŠ¨æ€è·å–ä¿¡æ¯ï¼Œå†ç»™å‡ºç­”æ¡ˆã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç›®å‰å¤§æ¨¡å‹çš„ä¸»æµæŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åé¢å°†å­¦åˆ°çš„æ™ºèƒ½ä½“æŠ€æœ¯ä¹Ÿå¥½ï¼Œæ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯ä¹Ÿç½¢ï¼Œéƒ½æ˜¯å¤§è¯­è¨€æ¨¡å‹æŒ‡ä»¤è·Ÿéšèƒ½åŠ›çš„â€œæ·±åº¦ç”¨æˆ·â€ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®© LLM ä»å¤©æ°”APIä¸­è·å–æœ€æ–°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥å›ç­”é—®é¢˜ã€‚è¿™æ ·ï¼Œå®ƒå°±å¯ä»¥å…ˆæŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œå†ç»™å‡ºå‡†ç¡®çš„å›ç­”ï¼Œè€Œä¸æ˜¯ç›´æ¥æä¾›å¯èƒ½ä¸æ­£ç¡®çš„ç­”æ¡ˆã€‚æˆ‘ä»¬è¿˜å¯ä»¥è®©å®ƒç»„åˆä½¿ç”¨å¤šä¸ªå·¥å…·ï¼Œæ¯”å¦‚å…ˆç”¨åŸå¸‚ç¼–ç å·¥å…·è·å–ç¼–ç ï¼Œç„¶åç”¨å¤©æ°”å·¥å…·æŸ¥è¯¢å®æ—¶å¤©æ°”ï¼Œæœ€åè¿”å›ç»“æœã€‚</p><p>ä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼š</p><h3>1. å¯¼å…¥å¿…è¦çš„åº“</h3><pre><code class=\"language-python\">from langchain_ollama.llms import OllamaLLM\nfrom langchain.agents import initialize_agent\nfrom langchain.tools import Tool\nimport requests\n</code></pre><ul>\n<li>\n<p><code>langchain_ollama.llms</code>ï¼šç”¨äºå¯¼å…¥ LLM æ¨¡å‹ã€‚</p>\n</li>\n<li>\n<p><code>langchain.agents</code>ï¼šç”¨äºåˆå§‹åŒ–æ™ºèƒ½ä½“ï¼ˆagentï¼‰ï¼Œå°†æ¨¡å‹ä¸å·¥å…·ç»“åˆä½¿ç”¨ã€‚</p>\n</li>\n<li>\n<p><code>langchain.tools</code>ï¼šç”¨äºå®šä¹‰å·¥å…·ã€‚</p>\n</li>\n<li>\n<p><code>requests</code>ï¼šç”¨äºå‘é€ HTTP è¯·æ±‚ä»¥è·å–å¤©æ°”æ•°æ®ã€‚</p>\n</li>\n</ul><h3></h3><h3>2. è®¾ç½® API åŸºæœ¬ä¿¡æ¯</h3><pre><code class=\"language-python\">AMAP_KEY = 'ä½ çš„åº”ç”¨key'  # æ›¿æ¢ä¸ºä½ çš„é«˜å¾·åº”ç”¨ key\nAMAP_BASE_URL = 'https://restapi.amap.com/v3'\n</code></pre><p>å®šä¹‰é«˜å¾·APIçš„åº”ç”¨å¯†é’¥å’ŒåŸºç¡€URLï¼Œåç»­è¯·æ±‚å°†ä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚</p><h3></h3><h3>3. è·å–åŸå¸‚ç¼–ç çš„å·¥å…·</h3><pre><code class=\"language-python\"># è·å–åŸå¸‚ç¼–ç çš„å·¥å…·\ndef get_city_code(city_name):\n&nbsp; &nbsp; url = f'{AMAP_BASE_URL}/config/district'\n&nbsp; &nbsp; params = {\n&nbsp; &nbsp; &nbsp; &nbsp; 'key': AMAP_KEY,\n&nbsp; &nbsp; &nbsp; &nbsp; 'keywords': city_name,\n&nbsp; &nbsp; &nbsp; &nbsp; 'subdistrict': 2,\n&nbsp; &nbsp; }\n&nbsp; &nbsp; response = fetch_data(url, params)\n&nbsp; &nbsp; return parse_city_code_response(response)\n</code></pre><p>è¯¥å‡½æ•°æ¥æ”¶åŸå¸‚åç§°å¹¶è°ƒç”¨é«˜å¾·APIä»¥è·å–å¯¹åº”çš„åŸå¸‚ç¼–ç ã€‚è¯·æ±‚å‚æ•°ä¸­åŒ…æ‹¬APIå¯†é’¥å’ŒåŸå¸‚åç§°ã€‚</p><h3></h3><h3>4. è·å–å¤©æ°”æ•°æ®çš„å·¥å…·</h3><pre><code class=\"language-python\"># è·å–å¤©æ°”æ•°æ®çš„å·¥å…·\ndef get_weather_data(city_code, forecast=False):\n&nbsp; &nbsp; url = f'{AMAP_BASE_URL}/weather/weatherInfo'\n&nbsp; &nbsp; params = {\n&nbsp; &nbsp; &nbsp; &nbsp; 'key': AMAP_KEY,\n&nbsp; &nbsp; &nbsp; &nbsp; 'city': city_code,\n&nbsp; &nbsp; &nbsp; &nbsp; 'extensions': 'all' if forecast else 'base'\n&nbsp; &nbsp; }\n&nbsp; &nbsp; response = fetch_data(url, params)\n&nbsp; &nbsp; return response\n</code></pre><p>è¯¥å‡½æ•°æ¥æ”¶åŸå¸‚ç¼–ç å¹¶è¯·æ±‚å¤©æ°”ä¿¡æ¯ã€‚å¯ä»¥é€‰æ‹©è·å–å®æ—¶å¤©æ°”ï¼ˆ<code>base</code>ï¼‰æˆ–é¢„æŠ¥å¤©æ°”ï¼ˆ<code>all</code>ï¼‰ã€‚</p><h3></h3><h3>5. å°è£… API è¯·æ±‚é€»è¾‘</h3><pre><code class=\"language-python\">def fetch_data(url, params):\n    try:\n        res = requests.get(url=url, params=params)\n        data = res.json()\n        if data.get('status') == '1':\n            return data\n        return {\"error\": \"è¯·æ±‚å¤±è´¥\"}\n    except Exception as e:\n        return {\"error\": f\"è¯·æ±‚æ—¶å‡ºé”™: {str(e)}\"}\n</code></pre><p>è¯¥å‡½æ•°è´Ÿè´£å‘é€HTTPè¯·æ±‚å¹¶å¤„ç†å“åº”ã€‚å®ƒä¼šæ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå¹¶è¿”å›ç›¸åº”çš„æ•°æ®æˆ–é”™è¯¯ä¿¡æ¯ã€‚</p><h3>6. å®šä¹‰å·¥å…·</h3><pre><code class=\"language-python\"># å®šä¹‰è·å–åŸå¸‚ç¼–ç çš„å·¥å…·\ncity_code_tool = Tool(\n&nbsp; &nbsp; name=\"GetCityCode\",\n&nbsp; &nbsp; func=get_city_code,\n&nbsp; &nbsp; description=\"æ ¹æ®åŸå¸‚åç§°è·å–å¯¹åº”çš„åŸå¸‚ç¼–ç ï¼Œå‚æ•°æ˜¯ä¸­æ–‡åŸå¸‚åç§°ï¼Œä¾‹å¦‚ï¼šä¸Šæµ·\"\n)\n\n\n# å®šä¹‰è·å–å¤©æ°”çš„å·¥å…·\nweather_tool = Tool(\n&nbsp; &nbsp; name=\"GetWeather\",\n&nbsp; &nbsp; func=get_weather_data,\n&nbsp; &nbsp; description=\"è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œå‚æ•°æ˜¯åŸå¸‚ç¼–ç å’Œæ˜¯å¦éœ€è¦é¢„æŠ¥\"\n)\n</code></pre><p>åˆ›å»º <code>Tool</code> å¯¹è±¡ï¼Œåˆ†åˆ«ç”¨äºè·å–åŸå¸‚ç¼–ç å’Œå¤©æ°”ä¿¡æ¯ï¼Œä¾¿äºåœ¨æ™ºèƒ½ä½“ä¸­ä½¿ç”¨ã€‚</p><h3>7. åˆå§‹åŒ– LLM å’Œå®šä¹‰æ™ºèƒ½ä½“</h3><pre><code class=\"language-python\"># åˆå§‹åŒ– LLM\nllm = OllamaLLM(model=\"llama3\")\n\n\n# å®šä¹‰ agent\nagent = initialize_agent(\n&nbsp; &nbsp; tools=[city_code_tool, weather_tool],&nbsp; # ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·\n&nbsp; &nbsp; llm=llm,&nbsp;\n&nbsp; &nbsp; agent_type=\"zero-shot-react-description\",&nbsp;\n&nbsp; &nbsp; verbose=True,\n&nbsp; &nbsp; agent_kwargs={\"handle_parsing_errors\": True}\n)\n</code></pre><p>å®ä¾‹åŒ– LLM æ¨¡å‹ï¼Œå¹¶åˆå§‹åŒ–æ™ºèƒ½ä½“ï¼Œå°†å®šä¹‰çš„å·¥å…·ä¸æ¨¡å‹å…³è”ï¼Œå…è®¸æ¨¡å‹æ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·è¿›è¡Œå¤„ç†ã€‚</p><h3>8. ç”¨æˆ·è¾“å…¥å’Œæ‰§è¡Œ</h3><pre><code class=\"language-python\">user_question = \"åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ\"\nprint(f\"ç”¨æˆ·é—®é¢˜ï¼š{user_question}\")\n\nresponse = agent.run(user_question)\nprint(response)\n</code></pre><p>ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå…³äºå¤©æ°”çš„é—®é¢˜ã€‚è°ƒç”¨æ™ºèƒ½ä½“çš„ <code>run</code> æ–¹æ³•å¤„ç†ç”¨æˆ·é—®é¢˜ï¼Œæ™ºèƒ½ä½“ä¼šè‡ªåŠ¨è°ƒç”¨é€‚å½“çš„å·¥å…·ï¼Œè·å–åŸå¸‚ç¼–ç å¹¶æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œæœ€åè¿”å›ç»“æœã€‚</p><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨æŒ‡ä»¤è·Ÿéšèƒ½åŠ›ï¼Œå°†ç”¨æˆ·çš„é—®é¢˜è½¬åŒ–ä¸ºå…·ä½“çš„å·¥å…·è°ƒç”¨ï¼ŒåŠ¨æ€è·å–æœ€æ–°çš„ä¿¡æ¯å¹¶æä¾›å‡†ç¡®çš„ç­”æ¡ˆã€‚é€šè¿‡ç»“åˆå¤šä¸ªå·¥å…·ï¼ŒLLaMA 3 èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å¤æ‚çš„æŸ¥è¯¢ï¼Œæä¾›æ›´é«˜è´¨é‡çš„å›ç­”ã€‚</p><h2>å°ç»“</h2><p>æˆ‘å¸Œæœ›è¿™èŠ‚è¯¾èƒ½å¤Ÿå¸®åŠ©ä½ æ¾„æ¸…RAGæŠ€æœ¯å’Œæ™ºèƒ½ä½“æŠ€æœ¯çš„å®é™…æƒ…å†µã€‚è¿™äº›æŠ€æœ¯å¹¶éç‹¬ç«‹çš„èƒ½åŠ›ï¼Œè€Œæ˜¯ç”±ä¸€ç³»åˆ—ç›¸å…³æŠ€æœ¯ç»„åˆè€Œæˆã€‚å…¶æ ¸å¿ƒåœ¨äºå¤§æ¨¡å‹çš„æŒ‡ä»¤è·ŸéšæŠ€æœ¯ï¼Œè¿™ä¸€æŠ€æœ¯ä½¿æ¨¡å‹èƒ½å¤ŸæŒ‰ç…§æŒ‡ä»¤è¿›è¡Œæœ‰æ•ˆçš„å“åº”å’Œæ“ä½œã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¤§æ¨¡å‹çš„æŒ‡ä»¤è·ŸéšæŠ€æœ¯ä¾èµ–äºå¤§é‡çš„æ•°æ®å’Œå…ˆè¿›çš„ç®—æ³•ï¼Œä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®ç†è§£å’Œæ‰§è¡Œå„ç§æŒ‡ä»¤ã€‚OpenAIçš„APIå·²ç»å®ç°äº†æ”¯æŒå®‰å…¨ç»“æ„åŒ–è¾“å‡ºçš„åŠŸèƒ½ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†æ»¡è¶³æŒ‡ä»¤è·Ÿéšåœºæ™¯çš„éœ€æ±‚ã€‚è¿™ä¸ªåŠŸèƒ½å…è®¸æ¨¡å‹ç”Ÿæˆç»è¿‡ç»“æ„åŒ–å¤„ç†çš„è¾“å‡ºï¼Œä»è€Œæé«˜å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/61/6ba3599070011a4f1da9e703b064b861.png?wh=1200x630\" alt=\"å›¾ç‰‡\"></p><p>åœ¨åç»­çš„RAGå’Œæ™ºèƒ½ä½“è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢è®¨å¦‚ä½•åœ¨LLaMAä¸­å®ç°è¿™äº›èƒ½åŠ›ã€‚æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºå¦‚ä½•åˆ©ç”¨è¿™äº›æŠ€æœ¯æ¥ä¼˜åŒ–æ¨¡å‹çš„è¡¨ç°ï¼Œå¹¶å±•ç¤ºå®é™…åº”ç”¨ä¸­çš„å…·ä½“å®ç°æ–¹æ³•ã€‚é€šè¿‡è¿™äº›å†…å®¹ï¼Œä½ å°†èƒ½å¤Ÿæ›´æ¸…æ™°åœ°ç†è§£RAGæŠ€æœ¯å’Œæ™ºèƒ½ä½“æŠ€æœ¯çš„å®é™…åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•ä¸å¤§æ¨¡å‹çš„æŒ‡ä»¤è·ŸéšæŠ€æœ¯ç´§å¯†ç»“åˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æ ¼å¼åŒ–ï¼ˆå¦‚JSONï¼‰çš„å¤§è¯­è¨€æ¨¡å‹è¾“å‡ºæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬å°†å®ƒä½œä¸ºä¸€ä¸ªå¤§æ¨¡å‹èƒ½åŠ›çš„è´¨å˜ï¼Ÿæ¬¢è¿ä½ æŠŠæ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°ç•™è¨€åŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p><h2>å®Œæ•´ç¤ºä¾‹</h2><pre><code class=\"language-python\">from langchain_ollama.llms import OllamaLLM\nfrom langchain.agents import initialize_agent\nfrom langchain.tools import Tool\nimport requests\n\n# é«˜å¾·APIçš„åŸºæœ¬ä¿¡æ¯\nAMAP_KEY = 'f1ea5fb70d21c088eb45bdbce898e8a9'&nbsp; # æ›¿æ¢ä¸ºä½ çš„é«˜å¾·åº”ç”¨ key\nAMAP_BASE_URL = 'https://restapi.amap.com/v3'\n\n\n# è·å–åŸå¸‚ç¼–ç çš„å·¥å…·\ndef get_city_code(city_name):\n&nbsp; &nbsp; url = f'{AMAP_BASE_URL}/config/district'\n&nbsp; &nbsp; params = {\n&nbsp; &nbsp; &nbsp; &nbsp; 'key': AMAP_KEY,\n&nbsp; &nbsp; &nbsp; &nbsp; 'keywords': city_name,\n&nbsp; &nbsp; &nbsp; &nbsp; 'subdistrict': 2,\n&nbsp; &nbsp; }\n&nbsp; &nbsp; response = fetch_data(url, params)\n&nbsp; &nbsp; return parse_city_code_response(response)\n\n\n# è§£æåŸå¸‚ç¼–ç è¿”å›å€¼\ndef parse_city_code_response(response):\n&nbsp; &nbsp; if response.get('status') == '1':\n&nbsp; &nbsp; &nbsp; &nbsp; districts = response.get('districts', [])\n&nbsp; &nbsp; &nbsp; &nbsp; if districts:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # å‡è®¾ adcode åœ¨ç¬¬ä¸€ä¸ª district ä¸­\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; city_info = districts[0]\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adcode = city_info.get('adcode', 'æœªçŸ¥')\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # å¦‚æœéœ€è¦è¿›ä¸€æ­¥æŸ¥æ‰¾ adcodeï¼Œå¯ä»¥éå†ä¸‹çº§è¡Œæ”¿åŒº\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if 'districts' in city_info:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for district in city_info['districts']:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if 'adcode' in district:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adcode = district['adcode']&nbsp; # æ›´æ–°ä¸ºå­çº§çš„ adcode\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return adcode\n&nbsp; &nbsp; return {\"error\": f\"æ— æ³•è·å–åŸå¸‚ç¼–ç : {response.get('info', 'æœªçŸ¥é”™è¯¯')}\"}\n\n\n\n# è·å–å¤©æ°”æ•°æ®çš„å·¥å…·\ndef get_weather_data(city_code, forecast=False):\n&nbsp; &nbsp; url = f'{AMAP_BASE_URL}/weather/weatherInfo'\n&nbsp; &nbsp; params = {\n&nbsp; &nbsp; &nbsp; &nbsp; 'key': AMAP_KEY,\n&nbsp; &nbsp; &nbsp; &nbsp; 'city': city_code,\n&nbsp; &nbsp; &nbsp; &nbsp; 'extensions': 'all' if forecast else 'base'\n&nbsp; &nbsp; }\n&nbsp; &nbsp; response = fetch_data(url, params)\n&nbsp; &nbsp; return response\n\n\n# å°è£…APIè¯·æ±‚é€»è¾‘\ndef fetch_data(url, params):\n&nbsp; &nbsp; try:\n&nbsp; &nbsp; &nbsp; &nbsp; res = requests.get(url=url, params=params)\n&nbsp; &nbsp; &nbsp; &nbsp; data = res.json()\n&nbsp; &nbsp; &nbsp; &nbsp; if data.get('status') == '1':\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return data\n&nbsp; &nbsp; &nbsp; &nbsp; return {\"error\": f\"è¯·æ±‚å¤±è´¥: {data.get('info', 'æœªçŸ¥é”™è¯¯')}\"}\n&nbsp; &nbsp; except Exception as e:\n&nbsp; &nbsp; &nbsp; &nbsp; return {\"error\": f\"è¯·æ±‚æ—¶å‡ºé”™: {str(e)}\"}\n\n\n# å®šä¹‰è·å–åŸå¸‚ç¼–ç çš„å·¥å…·\ncity_code_tool = Tool(\n&nbsp; &nbsp; name=\"GetCityCode\",\n&nbsp; &nbsp; func=get_city_code,\n&nbsp; &nbsp; description=\"æ ¹æ®åŸå¸‚åç§°è·å–å¯¹åº”çš„åŸå¸‚ç¼–ç ï¼Œå‚æ•°æ˜¯ä¸­æ–‡åŸå¸‚åç§°ï¼Œä¾‹å¦‚ï¼šä¸Šæµ·\"\n)\n\n\n# å®šä¹‰è·å–å¤©æ°”çš„å·¥å…·\nweather_tool = Tool(\n&nbsp; &nbsp; name=\"GetWeather\",\n&nbsp; &nbsp; func=get_weather_data,\n&nbsp; &nbsp; description=\"è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œå‚æ•°æ˜¯åŸå¸‚ç¼–ç å’Œæ˜¯å¦éœ€è¦é¢„æŠ¥\"\n)\n\n\n# åˆå§‹åŒ– LLM\nllm = OllamaLLM(model=\"llama3\")\n\n\n# å®šä¹‰ agent\nagent = initialize_agent(\n&nbsp; &nbsp; tools=[city_code_tool, weather_tool],&nbsp; # ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·\n&nbsp; &nbsp; llm=llm,&nbsp;\n&nbsp; &nbsp; agent_type=\"zero-shot-react-description\",&nbsp;\n&nbsp; &nbsp; verbose=True,\n&nbsp; &nbsp; agent_kwargs={\"handle_parsing_errors\": True}\n)\n\n\n# ç”¨æˆ·é—®é¢˜\nuser_question = \"åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ\"\nprint(f\"ç”¨æˆ·é—®é¢˜ï¼š{user_question}\")\n\n\n# æ‰§è¡Œå¹¶æ‰“å°ç»“æœ\nresponse = agent.run(user_question)\nprint(response)\n</code></pre>","comments":[{"had_liked":false,"id":395934,"user_name":"å°è™å­ğŸ¯","can_delete":false,"product_type":"c1","uid":2843479,"ip_address":"åŒ—äº¬","ucode":"4C9530B3FB407B","user_header":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","comment_is_top":true,"comment_ctime":1732500623,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"è¯¾ç¨‹ä»£ç åœ°å€ï¼šhttps:&#47;&#47;github.com&#47;tylerelyt&#47;LLaMa-in-Action","like_count":1},{"had_liked":false,"id":395058,"user_name":"edward","can_delete":false,"product_type":"c1","uid":1604798,"ip_address":"æ¹–å—","ucode":"09F7A5B8D2E7BD","user_header":"","comment_is_top":false,"comment_ctime":1729209710,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"è¯·é—®è€å¸ˆ å¤§æ¨¡å‹æ˜¯å¦‚ä½•åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥è°ƒç”¨ä»€ä¹ˆå·¥å…·çš„ã€‚","like_count":2},{"had_liked":false,"id":396246,"user_name":"æ‚Ÿå…‰","can_delete":false,"product_type":"c1","uid":1439777,"ip_address":"åŒ—äº¬","ucode":"E81339EBC4F492","user_header":"https://static001.geekbang.org/account/avatar/00/15/f8/21/3fa228e6.jpg","comment_is_top":false,"comment_ctime":1733742585,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"æ ¼å¼åŒ–ï¼ˆå¦‚ JSONï¼‰çš„å¤§è¯­è¨€æ¨¡å‹è¾“å‡ºæˆ‘è§‰å¾—ä¼šå¾ˆå¥½å’Œç°æœ‰çš„ç³»ç»Ÿé›†æˆï¼Œæ ‡å‡†çš„è¾“å‡ºæ ¼å¼ç±»ä¼¼ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£å·²ç»è¢«ç°æœ‰çš„ç³»ç»Ÿå¹¿æ³›ä½¿ç”¨ï¼Œç†æƒ³æƒ…å†µä¸‹å¤§æ¨¡å‹å¯ä»¥åº”ç”¨åˆ°ç°æœ‰ç³»ç»Ÿçš„ä»»ä½•ä¸€ä¸ªæ¨¡å—é‡Œé¢","like_count":1},{"had_liked":false,"id":395174,"user_name":"Geek_820805","can_delete":false,"product_type":"c1","uid":3969680,"ip_address":"åŒ—äº¬","ucode":"459E22ABAA9CD2","user_header":"","comment_is_top":false,"comment_ctime":1729658105,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"æ”¹æˆ prompt = hub.pull(&quot;hwchase17&#47;react&quot;)\ntools=[city_code_tool, weather_tool]\nagent=create_react_agent(llm, tools, prompt)\nagent_executor = AgentExecutor(agent=agent,\n            tools=tools, verbose=True,\n            agent_kwargs={&quot;handle_parsing_errors&quot;: True}\n)å¥½ç”¨äº†","like_count":1},{"had_liked":false,"id":395173,"user_name":"Geek_820805","can_delete":false,"product_type":"c1","uid":3969680,"ip_address":"åŒ—äº¬","ucode":"459E22ABAA9CD2","user_header":"","comment_is_top":false,"comment_ctime":1729657608,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100828301,"comment_content":"è¿è¡Œä»£ç ï¼Œæœ€åå‡ºç° ValueError: An output parsing error occurred. In order to pass this error back to the agent and have it try again, pass `handle_parsing_errors=True` to the AgentExecutor. This is the error: Could not parse LLM output: `The weather in Beijing isæ™´ (sunny) with a temperature of 15Â°C and humidity of 47%.`\nçœ‹èµ·æ¥toolå·²ç»è¿”å›ç»“æœäº†ï¼Œä½†æ˜¯llmè§£æç»“æœå‡ºé—®é¢˜äº†ï¼Œåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ","like_count":1}]}