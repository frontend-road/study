{"id":258035,"title":"25 | è¿‡æœŸç¼“å­˜ï¼šå¦‚ä½•é˜²æ­¢ç¼“å­˜è¢«æµé‡æ‰“ç©¿ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬å°†å¯¹ä¸€ç›´é›¶æ•£ä»‹ç»çš„ç¼“å­˜åšä¸ªå…¨é¢çš„æ€»ç»“ï¼ŒåŒæ—¶è®¨è®ºå¦‚ä½•è§£å†³ç¼“å­˜è¢«æµé‡æ‰“ç©¿çš„åœºæ™¯ã€‚</p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç¼“å­˜æ— å¤„ä¸åœ¨ã€‚æ¯”å¦‚ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜ç”¨æˆ·Cookieï¼ŒCDNä¼šç¼“å­˜å›¾ç‰‡ï¼Œè´Ÿè½½å‡è¡¡ä¼šç¼“å­˜TLSçš„æ¡æ‰‹ä¿¡æ¯ï¼ŒRedisä¼šç¼“å­˜ç”¨æˆ·çš„sessionï¼ŒMySQLä¼šç¼“å­˜selectæŸ¥è¯¢å‡ºçš„è¡Œæ•°æ®ï¼ŒHTTP/2ä¼šç”¨åŠ¨æ€è¡¨ç¼“å­˜ä¼ è¾“è¿‡çš„HTTPå¤´éƒ¨ï¼ŒTCP Socket Bufferä¼šç¼“å­˜TCPæŠ¥æ–‡ï¼ŒPage Cacheä¼šç¼“å­˜ç£ç›˜IOï¼ŒCPUä¼šç¼“å­˜ä¸»å­˜ä¸Šçš„æ•°æ®ï¼Œç­‰ç­‰ã€‚</p><p>åªè¦ç³»ç»Ÿé—´çš„è®¿é—®é€Ÿåº¦æœ‰è¾ƒå¤§å·®å¼‚ï¼Œç¼“å­˜å°±èƒ½æå‡æ€§èƒ½ã€‚å¦‚æœä½ ä¸æ¸…æ¥šç¼“å­˜çš„å­˜åœ¨ï¼Œä¸¤ä¸ªç»„ä»¶é—´é‡åˆçš„ç¼“å­˜å°±ä¼šå¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§ï¼ŒåŒæ—¶è¿˜å¢å¤§äº†æ•°æ®ä¸ä¸€è‡´å¼•å‘é”™è¯¯çš„æ¦‚ç‡ã€‚æ¯”å¦‚ï¼ŒMySQLä¸ºé¿å…è‡ªèº«ç¼“å­˜ä¸Page Cacheçš„é‡åˆï¼Œå°±ä½¿ç”¨ç›´æ¥IOç»•è¿‡äº†ç£ç›˜é«˜é€Ÿç¼“å­˜ã€‚</p><p>ç¼“å­˜æå‡æ€§èƒ½çš„å¹…åº¦ï¼Œä¸åªå–å†³äºå­˜å‚¨ä»‹è´¨çš„é€Ÿåº¦ï¼Œè¿˜å–å†³äºç¼“å­˜å‘½ä¸­ç‡ã€‚ä¸ºäº†æé«˜å‘½ä¸­ç‡ï¼Œç¼“å­˜ä¼šåŸºäºæ—¶é—´ã€ç©ºé—´ä¸¤ä¸ªç»´åº¦æ›´æ–°æ•°æ®ã€‚åœ¨æ—¶é—´ä¸Šå¯ä»¥é‡‡ç”¨LRUã€FIFOç­‰ç®—æ³•æ·˜æ±°æ•°æ®ï¼Œè€Œåœ¨ç©ºé—´ä¸Šåˆ™å¯ä»¥é¢„è¯»ã€åˆå¹¶è¿ç»­çš„æ•°æ®ã€‚å¦‚æœåªæ˜¯ç®€å•åœ°é€‰æ‹©æœ€æµè¡Œçš„ç¼“å­˜ç®¡ç†ç®—æ³•ï¼Œå°±å¾ˆå®¹æ˜“å¿½ç•¥ä¸šåŠ¡ç‰¹æ€§ï¼Œä»è€Œå¯¼è‡´ç¼“å­˜æ€§èƒ½çš„ä¸‹é™ã€‚</p><!-- [[[read_end]]] --><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç¼“å­˜æœåŠ¡ä¼šä¸ºä¸Šæ¸¸åº”ç”¨æŒ¡ä½è®¸å¤šæµé‡ã€‚å¦‚æœåªæ˜¯ç®€å•çš„åŸºäºå®šæ—¶å™¨æ·˜æ±°ç¼“å­˜ï¼Œä¸€æ—¦çƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­å¤±æ•ˆï¼Œè¶…è½½çš„æµé‡ä¼šç«‹åˆ»æ‰“å®ä¸Šæ¸¸åº”ç”¨ï¼Œå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä¼šç³»ç»Ÿåœ°ä»‹ç»ç¼“å­˜åŠå…¶æ•°æ®å˜æ›´ç­–ç•¥ï¼ŒåŒæ—¶ä¼šä»¥Nginxä¸ºä¾‹ä»‹ç»è¿‡æœŸç¼“å­˜çš„ç”¨æ³•ã€‚</p><h2>ç¼“å­˜æ˜¯æœ€æœ‰æ•ˆçš„æ€§èƒ½æå‡å·¥å…·</h2><p>åœ¨è®¡ç®—æœºä½“ç³»ä¸­ï¼Œå„ç±»ç¡¬ä»¶çš„è®¿é—®é€Ÿåº¦å¤©å·®åœ°åˆ«ã€‚æ¯”å¦‚ï¼š</p><ul>\n<li>CPUè®¿é—®ç¼“å­˜çš„è€—æ—¶åœ¨10çº³ç§’å·¦å³ï¼Œè®¿é—®å†…å­˜çš„æ—¶å»¶åˆ™ç¿»äº†10å€ï¼›</li>\n<li>å¦‚æœè®¿é—®SSDå›ºæ€ç£ç›˜ï¼Œæ—¶é—´è¿˜è¦å†ç¿»ä¸ª1000å€ï¼Œè¾¾åˆ°100å¾®ç§’ï¼›</li>\n<li>å¦‚æœè®¿é—®æœºæ¢°ç¡¬ç›˜ï¼Œå¯¹éšæœºå°IOçš„è®¿é—®è¦å†ç¿»ä¸ª100å€ï¼Œæ—¶å»¶æ¥è¿‘10æ¯«ç§’ï¼›</li>\n<li>å¦‚æœè·¨è¶Šç½‘ç»œï¼Œè®¿é—®æ—¶å»¶æ›´è¦å—åˆ¶äºä¸»æœºä¹‹é—´çš„ç‰©ç†è·ç¦»ã€‚æ¯”å¦‚æ­å·åˆ°ä¼¦æ•¦ç›¸è·9200å…¬é‡Œï¼Œpingæ—¶å»¶æ¥è¿‘200æ¯«ç§’ã€‚å½“ç„¶ï¼Œç½‘ç»œä¼ è¾“çš„å¯é æ€§ä½å¾ˆå¤šï¼Œä¸€æ—¦æŠ¥æ–‡ä¸¢å¤±ï¼ŒTCPè¿˜éœ€è¦è‡³å°‘1ç§’é’Ÿæ‰èƒ½å®ŒæˆæŠ¥æ–‡é‡ä¼ ã€‚</li>\n</ul><p>å¯è§ï¼Œæœ€å¿«çš„CPUç¼“å­˜ä¸æœ€æ…¢çš„ç½‘ç»œä¼ è¾“ï¼Œæœ‰1äº¿å€çš„é€Ÿåº¦å·®è·ï¼ä¸€æ—¦é«˜é€Ÿã€ä½é€Ÿç¡¬ä»¶ç›´æ¥äº’ç›¸è®¿é—®ï¼Œå‰è€…å°±ä¼šè¢«æ‹–æ…¢è¿è¡Œé€Ÿåº¦ã€‚å› æ­¤ï¼Œ<strong>æˆ‘ä»¬ä¼šä½¿ç”¨é«˜é€Ÿçš„å­˜å‚¨ä»‹è´¨åˆ›å»ºç¼“å†²åŒºï¼Œé€šè¿‡é¢„å¤„ç†ã€æ‰¹å¤„ç†ä»¥åŠç¼“å†²æ•°æ®çš„åå¤å‘½ä¸­ï¼Œæå‡ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚</strong></p><p>ä¸åªæ˜¯ç¡¬ä»¶å±‚é¢ï¼Œè½¯ä»¶è®¾è®¡å¯¹è®¿é—®é€Ÿåº¦çš„å½±å“æ›´å¤§ã€‚æ¯”å¦‚ï¼Œå¯¹å…³ç³»æ•°æ®åº“çš„éç´¢å¼•åˆ—åšæ¡ä»¶æŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œè€Œå¯¹MemcachedåšKey/ValueæŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦åˆ™æ˜¯O(1)ï¼Œæ‰€ä»¥åœ¨æµ·é‡æ•°æ®ä¸‹ï¼Œä¸¤è€…çš„æ€§èƒ½å·®è·è¿œé«˜äºç¡¬ä»¶ã€‚å› æ­¤ï¼ŒRabbitMQã€Kafkaè¿™æ ·çš„æ¶ˆæ¯æœåŠ¡ä¹Ÿä¼šå……å½“é«˜é€Ÿã€ä½é€Ÿåº”ç”¨é—´çš„ç¼“å­˜ã€‚</p><p>å¦‚æœä¸¤ä¸ªå®ä½“ä¹‹é—´çš„è®¿é—®æ—¶å»¶å·®è·è¿‡å¤§ï¼Œè¿˜å¯ä»¥é€šè¿‡å¤šçº§ç¼“å­˜ï¼Œé€çº§é™ä½è®¿é—®é€Ÿåº¦å·®ï¼Œæå‡æ•´ä½“æ€§èƒ½ã€‚æ¯”å¦‚<a href=\"https://time.geekbang.org/column/article/230194\">[ç¬¬1è®²]</a> æˆ‘ä»¬ä»‹ç»è¿‡CPUä¸‰çº§ç¼“å­˜ï¼Œæ¯çº§ç¼“å­˜è¶Šé è¿‘CPUé€Ÿåº¦è¶Šå¿«ï¼Œå®¹é‡ä¹Ÿè¶Šå°ï¼Œä»¥æ­¤ç¼“è§£CPUé¢‘ç‡ä¸ä¸»å­˜çš„é€Ÿåº¦å·®ï¼Œæå‡CPUçš„è¿è¡Œæ•ˆç‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/98/y9/986779b16684c3a250ded39066ea5yy9.png?wh=3749*2433\" alt=\"\"></p><p>å†æ¯”å¦‚ä¸‹å›¾çš„Webåœºæ™¯ä¸­ï¼Œæµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ã€æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„TCPç¼“å†²åŒºï¼ˆå‚è§<a href=\"https://time.geekbang.org/column/article/239176\">[ç¬¬11è®²]</a>ï¼‰ã€è´Ÿè½½å‡è¡¡ä¸­çš„TLSæ¡æ‰‹ç¼“å­˜ã€åº”ç”¨æœåŠ¡ä¸­çš„HTTPå“åº”ç¼“å­˜ã€MySQLä¸­çš„æŸ¥è¯¢ç¼“å­˜ç­‰ï¼Œæ¯ä¸€çº§ç¼“å­˜éƒ½ç¼“è§£äº†ä¸Šä¸‹æ¸¸é—´ä¸å‡è¡¡çš„è®¿é—®é€Ÿåº¦ï¼Œé€šè¿‡ç¼©çŸ­è®¿é—®è·¯å¾„é™ä½äº†è¯·æ±‚æ—¶å»¶ï¼Œé€šè¿‡å¼‚æ­¥è®¿é—®ã€æ‰¹é‡å¤„ç†æå‡äº†ç³»ç»Ÿæ•ˆç‡ã€‚å½“ç„¶ï¼Œç¼“å­˜ä½¿ç”¨äº†ç®€å•çš„Key/Valueç»“æ„ï¼Œå› æ­¤å¯ä»¥ç”¨å“ˆå¸Œè¡¨ã€æŸ¥æ‰¾æ ‘ç­‰å®¹å™¨åšç´¢å¼•ï¼Œè¿™ä¹Ÿæå‡äº†è®¿é—®é€Ÿåº¦ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/96/81/96f9fcdc192de9282830f8f7a1b75a81.png?wh=863*760\" alt=\"\"></p><p>ä»ç³»ç»Ÿåº•å±‚åˆ°ä¸šåŠ¡é«˜å±‚ï¼Œç¼“å­˜éƒ½å¤§æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚æ¯”å¦‚åœ¨Djangoè¿™ä¸ªPython Web Serverä¸­ï¼Œæ—¢å¯ä»¥ä½¿ç”¨è§†å›¾ç¼“å­˜ï¼Œå°†åŠ¨æ€çš„HTTPå“åº”ç¼“å­˜ä¸‹æ¥ï¼š</p><pre><code>from django.views.decorators.cache import cache_page\n\n@cache_page(60 * 15)\ndef my_view(request):\n    ...\n</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<a href=\"https://django-cachalot.readthedocs.io/en/latest/\">django-cachealot</a> è¿™æ ·çš„ä¸­é—´ä»¶ï¼Œå°†æ‰€æœ‰SQLæŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥:</p><pre><code>INSTALLED_APPS = [\n  ...\n  'cachalot',\n  ...\n]\n</code></pre><p>è¿˜å¯ä»¥åœ¨æ›´ç»†çš„ç²’åº¦ä¸Šï¼Œä½¿ç”¨Cache APIä¸­çš„getã€setç­‰å‡½æ•°ï¼Œå°†è¾ƒä¸ºè€—æ—¶çš„è¿ç®—ç»“æœå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼š</p><pre><code>cache.set('online_user_count', counts, 3600)\nuser_count = cache.get('online_user_count')\n</code></pre><p>è¿™äº›ç¼“å­˜çš„åº”ç”¨åœºæ™¯å¤§ç›¸å¾„åº­ï¼Œä½†æ•°æ®çš„æ›´æ–°æ–¹å¼å´å¾ˆç›¸ä¼¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ç¼“å­˜æ˜¯åŸºäºå“ªäº›åŸç†æ¥æ›´æ–°æ•°æ®çš„ã€‚</p><h2>ç¼“å­˜æ•°æ®çš„æ›´æ–°æ–¹å¼</h2><p>ç¼“å­˜çš„å­˜å‚¨å®¹é‡å¾€å¾€å°äºåŸå§‹æ•°æ®é›†ï¼Œè¿™æœ‰è®¸å¤šåŸå› ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>ç¼“å­˜ä½¿ç”¨äº†é€Ÿåº¦æ›´å¿«çš„å­˜å‚¨ä»‹è´¨ï¼Œè€Œè¿™ç±»ç¡¬ä»¶çš„å•ä½å®¹é‡æ›´æ˜‚è´µï¼Œå› æ­¤ä»ç»æµåŸå› ä¸Šåªèƒ½é€‰æ‹©æ›´å°çš„å­˜å‚¨å®¹é‡ï¼›</li>\n<li>è´Ÿè½½å‡è¡¡å¯ä»¥å°†ä¸Šæ¸¸æœåŠ¡çš„åŠ¨æ€å“åº”è½¬æ¢ä¸ºé™æ€ç¼“å­˜ï¼Œä»æ—¶é—´ç»´åº¦ä¸Šçœ‹ï¼Œä¸Šæ¸¸å“åº”æ˜¯æ— é™çš„ï¼Œè¿™æ ·è´Ÿè½½å‡è¡¡çš„ç¼“å­˜å®¹é‡å°±ä¸€å®šä¼šä¸è¶³ï¼›</li>\n<li>å³ä½¿æ¡Œé¢ä¸»æœºçš„ç£ç›˜å®¹é‡è¾¾åˆ°äº†TBçº§ï¼Œä½†æµè§ˆå™¨è¦å¯¹ç”¨æˆ·è®¿é—®çš„æ‰€æœ‰ç«™ç‚¹åšç¼“å­˜ï¼Œå°±ä¸å¯èƒ½ç¼“å­˜ä¸€ä¸ªç«™ç‚¹ä¸Šçš„å…¨éƒ¨èµ„æºï¼Œåœ¨ä¸€å¯¹å¤šçš„ç©ºé—´ç»´åº¦ä¸‹ï¼Œç¼“å­˜ä¸€æ ·æ˜¯ç¨€ç¼ºèµ„æºã€‚</li>\n</ul><p>å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯åœ¨æœ‰é™çš„ç¼“å­˜ç©ºé—´å†…ï¼Œåªå­˜æ”¾ä¼šè¢«å¤šæ¬¡è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œé€šè¿‡æé«˜å‘½ä¸­ç‡æ¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚è¦å®Œæˆè¿™ä¸ªç›®æ ‡ï¼Œå¿…é¡»ç²¾å¿ƒè®¾è®¡å‘ç¼“å­˜ä¸­æ·»åŠ å“ªäº›æ•°æ®ï¼Œç¼“å­˜æº¢å‡ºæ—¶æ·˜æ±°å‡ºå“ªäº›å†·æ•°æ®ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹å‰è€…ã€‚</p><p>é€šå¸¸ï¼Œç¼“å­˜æ•°æ®çš„æ·»åŠ æˆ–è€…æ›´æ–°ï¼Œéƒ½æ˜¯ç”±ç”¨æˆ·è¯·æ±‚è§¦å‘çš„ï¼Œè¿™å¾€å¾€å¯ä»¥å¸¦æ¥æ›´é«˜çš„å‘½ä¸­ç‡ã€‚æ¯”å¦‚ï¼Œå½“è¯»è¯·æ±‚å®Œæˆåï¼Œå°†è¯»å‡ºçš„å†…å®¹æ”¾å…¥ç¼“å­˜ï¼ŒåŸºäºæ—¶é—´å±€éƒ¨æ€§åŸç†ï¼Œå®ƒæœ‰å¾ˆé«˜çš„æ¦‚ç‡è¢«åç»­çš„è¯»è¯·æ±‚å‘½ä¸­ã€‚<a href=\"https://time.geekbang.org/column/article/242667\">[ç¬¬15è®²]</a> ä»‹ç»è¿‡çš„HTTPç¼“å­˜å°±é‡‡ç”¨äº†è¿™ç§æœºåˆ¶ã€‚</p><p>å¯¹äºç£ç›˜æ“ä½œï¼Œè¿˜å¯ä»¥åŸºäºç©ºé—´å±€éƒ¨æ€§åŸç†ï¼Œé‡‡ç”¨é¢„è¯»ç®—æ³•æ·»åŠ ç¼“å­˜æ•°æ®ï¼ˆå‚è€ƒ<a href=\"https://time.geekbang.org/column/article/232676\">[ç¬¬4è®²]</a> ä»‹ç»çš„PageCacheï¼‰ã€‚æ¯”å¦‚å½“æˆ‘ä»¬ç»Ÿè®¡å‡ºè¿ç»­ä¸¤æ¬¡è¯»IOçš„æ“ä½œèŒƒå›´ä¹Ÿæ˜¯è¿ç»­çš„ï¼Œå°±å¯ä»¥åˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªé¡ºåºè¯»IOï¼Œå¦‚æœè¿™ä¸ªè¯»IOè·å–32KBçš„æ•°æ®ï¼Œå°±å¯ä»¥åœ¨è¿™æ¬¡ç£ç›˜ä¸­ï¼Œå¤šè¯»å‡º128KBçš„æ•°æ®æ”¾åœ¨ç¼“å­˜ï¼Œè¿™ä¼šå¸¦æ¥2ä¸ªæ”¶ç›Šï¼š</p><ul>\n<li>é¦–å…ˆï¼Œé€šè¿‡å‡å°‘å®šä½æ—¶é—´æé«˜äº†ç£ç›˜å·¥ä½œæ•ˆç‡ã€‚æœºæ¢°ç£ç›˜å®¹é‡å¤§ä»·æ ¼ä½ï¼Œå®ƒçš„é¡ºåºè¯»å†™é€Ÿåº¦ç”±ç£ç›˜æ—‹è½¬é€Ÿåº¦ä¸å­˜å‚¨å¯†åº¦å†³å®šï¼Œé€šå¸¸å¯ä»¥è¾¾åˆ°100MB/så·¦å³ã€‚ç„¶è€Œï¼Œç”±äºæœºæ¢°è½¬é€Ÿéš¾ä»¥æé«˜ï¼ˆæœåŠ¡å™¨ç£ç›˜çš„è½¬é€Ÿä¹Ÿåªæœ‰10000è½¬/sï¼‰ï¼Œç£å¤´å®šä½ä¸æ—‹è½¬å»¶è¿Ÿå¤§çº¦æ¶ˆè€—äº†8æ¯«ç§’ï¼Œå› æ­¤å¯¹äºç»å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨ç£å¤´å®šä½ä¸Šçš„éšæœºå°IOï¼ˆæ¯”å¦‚4KBï¼‰ï¼Œè¯»å†™ååé‡åªæœ‰å‡ MBã€‚</li>\n<li>å…¶æ¬¡ï¼Œå½“åç»­çš„è¯»è¯·æ±‚å‘½ä¸­æå‰è¯»å…¥ç¼“å­˜çš„æ•°æ®æ—¶ï¼Œè¯·æ±‚æ—¶å»¶ä¼šå¤§å¹…åº¦é™ä½ï¼Œè¿™æå‡äº†ç”¨æˆ·ä½“éªŒã€‚</li>\n</ul><p>è€Œä¸”ï¼Œå¹¶ä¸æ˜¯åªæœ‰å•æœºè¿›ç¨‹æ‰èƒ½ä½¿ç”¨é¢„è¯»ç®—æ³•ã€‚æ¯”å¦‚å…¬æœ‰äº‘ä¸­çš„äº‘ç£ç›˜ï¼Œä¹‹æ‰€ä»¥å¯ä»¥å®æ—¶åœ°æŒ‚è½½åˆ°ä»»æ„è™šæ‹Ÿæœºä¸Šï¼Œå°±æ˜¯å› ä¸ºå®ƒå®é™…å­˜æ”¾åœ¨ç±»ä¼¼HDFSè¿™æ ·çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å› æ­¤ï¼Œäº‘æœåŠ¡ä¼šåœ¨å®¿ä¸»ç‰©ç†æœºçš„å†…å­˜ä¸­ç¼“å­˜è™šæ‹Ÿæœºå‘å‡ºçš„è¯»å†™IOï¼Œç”±äºç½‘ç»œä¼ è¾“çš„æˆæœ¬æ›´é«˜ï¼Œæ‰€ä»¥é¢„è¯»æ•ˆæœä¹Ÿæ›´å¥½ã€‚</p><p>å†™è¯·æ±‚ä¹Ÿå¯ä»¥æ›´æ–°ç¼“å­˜ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/251062\">[ç¬¬20è®²]</a> æˆ‘ä»¬ä»‹ç»è¿‡write throughå’Œwrite backæ–¹å¼ã€‚å…¶ä¸­ï¼Œwrite backé‡‡ç”¨å¼‚æ­¥è°ƒç”¨å›å†™æ•°æ®ï¼Œèƒ½é€šè¿‡æ‰¹é‡å¤„ç†æå‡æ€§èƒ½ã€‚æ¯”å¦‚Linuxåœ¨åˆå¹¶IOçš„åŒæ—¶ï¼Œä¹Ÿä¼šåƒç”µæ¢¯è¿è¡Œä¸€æ ·ï¼Œæ¯æ¬¡ä½¿ç£å¤´ä»…å‘ä¸€ä¸ªæ–¹å‘æ—‹è½¬å†™å…¥æ•°æ®ï¼Œæå‡æœºæ¢°ç£ç›˜çš„å·¥ä½œæ•ˆç‡ï¼Œå› æ­¤å¾—åä¸ºç”µæ¢¯è°ƒåº¦ç®—æ³•ã€‚</p><p>è¯´å®Œæ•°æ®çš„æ·»åŠ ï¼Œæˆ‘ä»¬å†æ¥çœ‹2ç§æœ€å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚</p><p>é¦–å…ˆæ¥çœ‹<a href=\"https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)\">FIFO</a>(First In, First Out)å…ˆå…¥å…ˆå‡ºæ·˜æ±°ç®—æ³•ã€‚<a href=\"https://time.geekbang.org/column/article/245966\">[ç¬¬16è®²]</a> ä»‹ç»çš„HTTP/2åŠ¨æ€è¡¨ï¼Œä¼šå°†HTTP/2è¿æ¥ä¸Šé¦–æ¬¡å‡ºç°çš„HTTPå¤´éƒ¨ï¼Œç¼“å­˜åœ¨å®¢æˆ·ç«¯ã€æœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚ç”±äºå®ƒä»¬åŸºäºç›¸åŒçš„è§„åˆ™ç”Ÿæˆï¼Œæ‰€ä»¥æ‹¥æœ‰ç›¸åŒçš„åŠ¨æ€è¡¨åºå·ã€‚è¿™æ ·ï¼Œä¼ è¾“1-2ä¸ªå­—èŠ‚çš„è¡¨åºå·ï¼Œè¦æ¯”ä¼ è¾“å‡ åä¸ªå­—èŠ‚çš„å¤´éƒ¨åˆ’ç®—å¾—å¤šã€‚å½“å†…å­˜å®¹é‡è¶…è¿‡SETTINGS_HEADER_TABLE_SIZEé˜ˆå€¼æ—¶ï¼Œä¼šåŸºäºFIFOç®—æ³•å°†æœ€æ—©ç¼“å­˜çš„HTTPå¤´éƒ¨æ·˜æ±°å‡ºåŠ¨æ€è¡¨ã€‚</p><p><a href=\"https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)\"><img src=\"https://static001.geekbang.org/resource/image/7b/fa/7b4ed2f6e8e0e0379a89a921b587a7fa.jpg?wh=4897*3551\" alt=\"\" title=\"å›¾ç‰‡å‚è§wikiï¼šhttps://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)\"></a></p><p>å†æ¯”å¦‚<a href=\"https://time.geekbang.org/column/article/241632\">[ç¬¬14è®²]</a> ä»‹ç»çš„TLSæ¡æ‰‹å¾ˆè€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å¯†é’¥ç¼“å­˜åœ¨å®¢æˆ·ç«¯ã€æœåŠ¡å™¨ä¸­ï¼Œç­‰å†æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œé€šè¿‡session IDè¿…é€Ÿæ¢å¤TLSä¼šè¯ã€‚ç”±äºå†…å­˜æœ‰é™ï¼ŒæœåŠ¡å™¨å¿…é¡»åŠæ—¶æ·˜æ±°è¿‡æœŸçš„å¯†é’¥ï¼Œå…¶ä¸­ï¼ŒNginxä¹Ÿæ˜¯é‡‡ç”¨FIFOé˜Ÿåˆ—æ·˜æ±°TLSç¼“å­˜çš„ã€‚</p><p>å…¶æ¬¡ï¼ŒLRU(Less Recently Used)ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ·˜æ±°ç®—æ³•ï¼Œæ¯”å¦‚RedisæœåŠ¡å°±é€šè¿‡å®ƒæ¥æ·˜æ±°æ•°æ®ï¼ŒOpenRestyåœ¨è¿›ç¨‹é—´å…±äº«æ•°æ®çš„shared_dictåœ¨è¾¾åˆ°å…±äº«å†…å­˜æœ€å¤§å€¼åï¼Œä¹Ÿä¼šé€šè¿‡LRUç®—æ³•æ·˜æ±°æ•°æ®ã€‚LRUé€šå¸¸ä½¿ç”¨åŒå‘é˜Ÿåˆ—å®ç°ï¼ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼‰ï¼Œé˜Ÿé¦–æ˜¯æœ€è¿‘è®¿é—®çš„å…ƒç´ ï¼Œé˜Ÿå°¾å°±æ˜¯æœ€å°‘è®¿é—®ã€å³å°†æ·˜æ±°çš„å…ƒç´ ã€‚å½“è®¿é—®äº†é˜Ÿåˆ—ä¸­æŸä¸ªå…ƒç´ æ—¶ï¼Œå¯ä»¥å°†å…¶ç§»åŠ¨åˆ°é˜Ÿé¦–ã€‚å½“ç¼“å­˜æº¢å‡ºéœ€è¦æ·˜æ±°å…ƒç´ æ—¶ï¼Œç›´æ¥åˆ é™¤é˜Ÿå°¾å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/21/80/21f4cfa8c5a92db8eaf358901a7f8780.png?wh=938*815\" alt=\"\"></p><p>ä»¥ä¸Šæˆ‘åªè°ˆäº†ç¼“å­˜å®¹é‡åˆ°è¾¾ä¸Šé™åçš„æ·˜æ±°ç­–ç•¥ï¼Œä¸ºäº†é¿å…ç¼“å­˜ä¸æºæ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ä¼ è¾“æˆæœ¬é«˜æ˜‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šåŸºäºè¿‡æœŸæ—¶é—´æ¥æ·˜æ±°ç¼“å­˜ã€‚æ¯”å¦‚HTTPå“åº”ä¸­çš„Cache-Controlã€Expiresæˆ–è€…Last-Modifiedå¤´éƒ¨ï¼Œéƒ½ä¼šç”¨æ¥è®¾ç½®å®šæ—¶å™¨ï¼Œå“åº”è¿‡æœŸåä¼šè¢«æ·˜æ±°å‡ºç¼“å­˜ã€‚ç„¶è€Œï¼Œä¸€æ—¦çƒ­ç‚¹æ•°æ®è¢«æ·˜æ±°å‡ºç¼“å­˜ï¼Œé‚£ä¹ˆæ¥è‡ªç”¨æˆ·çš„æµé‡å°±ä¼šç©¿é€ç¼“å­˜åˆ°è¾¾åº”ç”¨æœåŠ¡ã€‚ç”±äºç¼“å­˜æœåŠ¡æ€§èƒ½è¿œå¤§äºåº”ç”¨æœåŠ¡ï¼Œè¿‡å¤§çš„æµé‡å¾ˆå¯èƒ½ä¼šå°†åº”ç”¨å‹å®ã€‚å› æ­¤ï¼Œè¿‡æœŸç¼“å­˜å¹¶ä¸èƒ½ç®€å•åœ°æ·˜æ±°ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥Nginxä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•åˆ©ç”¨è¿‡æœŸç¼“å­˜æå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><h2>Nginxæ˜¯å¦‚ä½•é˜²æ­¢æµé‡æ‰“ç©¿ç¼“å­˜çš„ï¼Ÿ</h2><p>å½“çƒ­ç‚¹ç¼“å­˜æ·˜æ±°åï¼Œå¤§é‡çš„å¹¶å‘è¯·æ±‚ä¼šåŒæ—¶å›æºä¸Šæ¸¸åº”ç”¨ï¼Œå…¶å®è¿™æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­Nginxçš„åˆå¹¶å›æºåŠŸèƒ½å¼€å¯åï¼ŒNginxä¼šå°†å¤šä¸ªå¹¶å‘è¯·æ±‚åˆå¹¶ä¸º1æ¡å›æºè¯·æ±‚ï¼Œå¹¶é”ä½æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç›´åˆ°å›æºè¯·æ±‚è¿”å›åï¼Œæ‰ä¼šæ›´æ–°ç¼“å­˜ï¼ŒåŒæ—¶å‘æ‰€æœ‰å®¢æˆ·ç«¯è¿”å›å“åº”ã€‚ç”±äºNginxå¯ä»¥æ”¯æŒC10Mçº§åˆ«çš„å¹¶å‘è¿æ¥ï¼Œå› æ­¤å¯ä»¥å¾ˆè½»æ¾åœ°é”ä½è¿™äº›å¹¶å‘è¯·æ±‚ï¼Œé™ä½åº”ç”¨æœåŠ¡çš„è´Ÿè½½ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/2d/3ec9f8f4251af844770d24c756a6432d.png?wh=709*769\" alt=\"\"></p><p>å¯ç”¨åˆå¹¶å›æºåŠŸèƒ½å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨nginx.confä¸­æ·»åŠ ä¸‹é¢è¿™æ¡æŒ‡ä»¤å³å¯ï¼š</p><pre><code>proxy_cache_lock on;\n</code></pre><p>å½“1ä¸ªè¯·æ±‚å›æºæ›´æ–°æ—¶ï¼Œå…¶ä½™è¯·æ±‚å°†ä¼šé»˜è®¤ç­‰å¾…ï¼Œå¦‚æœ5ç§’ï¼ˆå¯ç”±proxy_cache_lock_timeoutä¿®æ”¹ï¼‰åç¼“å­˜ä¾æ—§æœªå®Œæˆæ›´æ–°ï¼Œè¿™äº›è¯·æ±‚ä¹Ÿä¼šå›æºï¼Œä½†å®ƒä»¬çš„å“åº”ä¸ä¼šç”¨äºæ›´æ–°ç¼“å­˜ã€‚åŒæ—¶ï¼Œç¬¬1ä¸ªå›æºè¯·æ±‚ä¹Ÿæœ‰æ—¶é—´é™åˆ¶ï¼Œå¦‚æœåˆ°è¾¾5ç§’ï¼ˆå¯ç”±proxy_cache_lock_ageä¿®æ”¹ï¼‰åæœªè·å¾—å“åº”ï¼Œå°±ä¼šæ”¾è¡Œå…¶ä»–å¹¶å‘è¯·æ±‚å›æºæ›´æ–°ç¼“å­˜ã€‚</p><p>å¦‚æœNginxä¸Šçš„ç¼“å­˜å·²ç»è¿‡æœŸï¼ˆæœªè¶…è¿‡proxy_cache_pathä¸­inactiveæ—¶é—´çª—å£çš„è¿‡æœŸç¼“å­˜ï¼Œå¹¶ä¸ä¼šè¢«åˆ é™¤ï¼‰ï¼Œä¸”ä¸Šæ¸¸æœåŠ¡æ­¤æ—¶å·²ä¸å¯ç”¨ï¼Œé‚£æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥é€šè¿‡Nginxæä¾›é™çº§æœåŠ¡å‘¢ï¼Ÿæ‰€è°“â€œæœåŠ¡é™çº§â€ï¼Œæ˜¯æŒ‡éƒ¨åˆ†æœåŠ¡å‡ºç°æ•…éšœåï¼Œé€šè¿‡æœ‰ç­–ç•¥åœ°æ”¾å¼ƒä¸€äº›å¯ç”¨æ€§ï¼Œæ¥ä¿éšœæ ¸å¿ƒæœåŠ¡çš„è¿è¡Œï¼Œè¿™ä¹Ÿæ˜¯<a href=\"https://time.geekbang.org/column/article/251062\">[ç¬¬20è®²]</a> BASEç†è®ºä¸­Basically Availableçš„å®è·µã€‚å¦‚æœNginxä¸ŠæŒæœ‰ç€è¿‡æœŸçš„ç¼“å­˜ï¼Œé‚£å°±å¯ä»¥é€šè¿‡ç‰ºç‰²ä¸€è‡´æ€§ï¼Œå‘ç”¨æˆ·è¿”å›è¿‡æœŸç¼“å­˜ï¼Œä»¥ä¿éšœåŸºæœ¬çš„å¯ç”¨æ€§ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ï¼ŒNginxä¼šç›´æ¥å°†è¿‡æœŸç¼“å­˜è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸€ç›´è¯•å›¾æ›´æ–°ç¼“å­˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d0/e5/d086aa5b326c21ce7609a2b7b98f86e5.png?wh=691*769\" alt=\"\"></p><p>å¼€å¯è¿‡æœŸç¼“å­˜åŠŸèƒ½ä¹Ÿå¾ˆç®€å•ï¼Œæ·»åŠ ä¸‹é¢2è¡ŒæŒ‡ä»¤å³å¯ï¼š</p><pre><code>proxy_cache_use_stale updating;\nproxy_cache_background_update on;\n</code></pre><p>å½“ç„¶ï¼Œä¸Šé¢ä¸¤æ¡NginxæŒ‡ä»¤åªæ˜¯å¼€å¯äº†æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œå¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£å®ƒä»¬çš„ç”¨æ³•ï¼Œå¯ä»¥è§‚çœ‹<a href=\"https://time.geekbang.org/course/detail/100020301-76629\">ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ç¬¬102è¯¾</a>ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬ç³»ç»Ÿåœ°æ€»ç»“äº†ç¼“å­˜çš„å·¥ä½œåŸç†ï¼Œä»¥åŠNginxè§£å†³ç¼“å­˜ç©¿é€é—®é¢˜çš„æ–¹æ¡ˆã€‚</p><p>å½“ç»„ä»¶é—´çš„è®¿é—®é€Ÿåº¦å·®è·å¾ˆå¤§æ—¶ï¼Œç›´æ¥è®¿é—®ä¼šé™ä½æ•´ä½“æ€§èƒ½ï¼Œåœ¨äºŒè€…ä¹‹é—´æ·»åŠ æ›´å¿«çš„ç¼“å­˜æ˜¯å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚æ ¹æ®æ—¶é—´å±€éƒ¨æ€§åŸç†ï¼Œå°†è¯·æ±‚ç»“æœæ”¾å…¥ç¼“å­˜ï¼Œä¼šæœ‰å¾ˆå¤§æ¦‚ç‡è¢«å†æ¬¡å‘½ä¸­ï¼Œè€Œæ ¹æ®ç©ºé—´å±€éƒ¨æ€§åŸç†ï¼Œå¯ä»¥å°†ç›¸é‚»çš„å†…å®¹é¢„å–è‡³ç¼“å­˜ä¸­ï¼Œè¿™æ ·æ—¢èƒ½é€šè¿‡æ‰¹å¤„ç†æå‡æ•ˆç‡ï¼Œä¹Ÿèƒ½é™ä½åç»­è¯·æ±‚çš„æ—¶å»¶ã€‚</p><p>ç”±äºç¼“å­˜å®¹é‡å°äºåŸå§‹æ•°æ®é›†ï¼Œå› æ­¤éœ€è¦å°†å‘½ä¸­æ¦‚ç‡è¾ƒä½çš„æ•°æ®åŠæ—¶æ·˜æ±°å‡ºå»ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ·˜æ±°ç®—æ³•æ˜¯FIFOä¸LRUï¼Œå®ƒä»¬æ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚</p><p>ç”±äºç¼“å­˜æœåŠ¡çš„æ€§èƒ½è¿œå¤§äºä¸Šæ¸¸åº”ç”¨ï¼Œä¸€æ—¦å¤§æµé‡ç©¿é€å¤±æ•ˆçš„ç¼“å­˜åˆ°è¾¾ä¸Šæ¸¸åï¼Œå°±å¯èƒ½å‹å®åº”ç”¨ã€‚Nginxä½œä¸ºHTTPç¼“å­˜ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ‰“å¼€åˆå¹¶å›æºåŠŸèƒ½ï¼Œå‡è½»ä¸Šæ¸¸å‹åŠ›ã€‚åœ¨ä¸Šæ¸¸åº”ç”¨å®•æœºåï¼Œè¿˜å¯ä»¥ä½¿ç”¨è¿‡æœŸç¼“å­˜ä¸ºç”¨æˆ·æä¾›é™çº§æœåŠ¡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç•™ç»™ä½ ä¸€é“è®¨è®ºé¢˜ã€‚ç¼“å­˜å¹¶ä¸æ€»æ˜¯åœ¨æé«˜æ€§èƒ½ï¼Œå›æƒ³ä¸€ä¸‹ï¼Œåœ¨ä½ çš„å®è·µä¸­ï¼Œæœ‰å“ªäº›æƒ…å†µæ˜¯å¢åŠ äº†ç¼“å­˜æœåŠ¡ï¼Œä½†å¹¶æ²¡æœ‰æé«˜ç³»ç»Ÿæ€§èƒ½çš„ï¼ŸåŸå› åˆæ˜¯ä»€ä¹ˆï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶ä¸€èµ·åˆ†äº«ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾è®©ä½ åŠ æ·±äº†å¯¹ç¼“å­˜çš„ç†è§£ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":232914,"user_name":"å”æœé¦–éƒ½","can_delete":false,"product_type":"c1","uid":1081233,"ip_address":"","ucode":"F72655AE0AE4CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/91/962eba1a.jpg","comment_is_top":false,"comment_ctime":1594168044,"is_pvip":true,"replies":[{"id":"90733","content":"å¯¹çš„ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599561102,"ip_address":"","comment_id":232914,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53133775596","product_id":100051201,"comment_content":"ç¼“å­˜åœ¨æ€»æ˜¯è¢«ä¿®æ”¹ã€å¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œå®¹æ˜“é€ æˆç³»ç»Ÿæ€§èƒ½ä¸å‡åé™ã€‚","like_count":12,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500811,"discussion_content":"å¯¹çš„ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599561102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233209,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594261311,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23069097791","product_id":100051201,"comment_content":"ä¸€èˆ¬çš„ç¼“å­˜éƒ½æ˜¯ä¸ºäº†å¯¹ä»˜è¯»å¤šå†™å°‘ï¼Œä½†æ˜¯mysqlçš„ChangeBufferæ˜¯è¯»å°‘å†™å¤šæ›´å®ç”¨ã€‚åŸå› æ˜¯ï¼š<br>Mysqlçš„æ™®é€šç´¢å¼•åœºæ™¯ä¸‹ï¼ŒUpdateæ›´æ–°æ“ä½œä¼šè®°å½•åœ¨ChangeBufferä¸‹ï¼Œç­‰åˆ°è®¿é—®æ•°æ®æ—¶ã€æˆ–è€…shutdownæ•°æ®åº“æ—¶ä¼šè¿›è¡Œmergeåˆå¹¶æˆè®°å½•çš„æœ€æ–°å€¼ï¼Œåå°ä¹Ÿä¼šæœ‰çº¿ç¨‹å®šæ—¶æ‰§è¡ŒMergeæ“ä½œã€‚ChangeBufferå¯¹æ›´æ–°çš„åŠ é€Ÿä½œç”¨ï¼Œåªé™äºç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹ï¼Œåªé™äºå†™å¤šè¯»å°‘çš„åœºæ™¯ä¸‹ï¼Œå› ä¸ºå†™å®Œå°±è¯»å–ä¼šè§¦å‘Mergeåˆ°åŸå§‹æ•°æ®çš„åŠ¨ä½œï¼Œå°±å¤±å»æ„ä¹‰äº†ã€‚<br><br>","like_count":5},{"had_liked":false,"id":232978,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1594179907,"is_pvip":false,"replies":[{"id":"90732","content":"ä¸ä¼šï¼ŒMySQLæœ¬èº«å°±æœ‰ç¼“å­˜ï¼Œå¾ˆé«˜æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬æ•°æ®åº“å‰ä¸åŠ ç¼“å­˜çš„ï¼Œå¦‚æœæ•°æ®åº“å‰æœ‰Proxyï¼ˆä¾‹å¦‚MyCATï¼‰ï¼Œä¸»è¦æ˜¯ç”¨æ¥åšåˆ†åº“åˆ†è¡¨çš„","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599561090,"ip_address":"","comment_id":232978,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14479081795","product_id":100051201,"comment_content":"è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜ï¼Œé€šå¸¸ç”¨redisåšmysqlçš„ç¼“å­˜ï¼ŒæŒ‰ç…§è¿™ç¯‡æ–‡ç« æ¥è¯´çš„è¯ï¼Œä¼šåœ¨mysqlä¸Šé¢å†åŠ ä¸€ä¸ªnginxå†åšä¸€å±‚ç¼“å­˜ä¹ˆï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500834,"discussion_content":"ä¸ä¼šï¼ŒMySQLæœ¬èº«å°±æœ‰ç¼“å­˜ï¼Œå¾ˆé«˜æ•ˆï¼Œæ‰€ä»¥ä¸€èˆ¬æ•°æ®åº“å‰ä¸åŠ ç¼“å­˜çš„ï¼Œå¦‚æœæ•°æ®åº“å‰æœ‰Proxyï¼ˆä¾‹å¦‚MyCATï¼‰ï¼Œä¸»è¦æ˜¯ç”¨æ¥åšåˆ†åº“åˆ†è¡¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599561090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118627,"avatar":"https://static001.geekbang.org/account/avatar/00/11/11/a3/7a2405ca.jpg","nickname":"rfyiamcool","note":"","ucode":"65FCBF05B13893","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300695,"discussion_content":"ä¸æ˜¯çš„ï¼Œnginxæ›´å¤šçš„æ˜¯åšé™æ€èµ„æºç¼“å­˜ï¼Œé™¶å¤§ä½¬æ–‡ç« ä¸­çš„åœºæ™¯ä¹Ÿæ˜¯cdnçš„åœºæ™¯ã€‚ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598234201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233110,"user_name":"Geek_007","can_delete":false,"product_type":"c1","uid":1467182,"ip_address":"","ucode":"C80107538EAA7F","user_header":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","comment_is_top":false,"comment_ctime":1594218613,"is_pvip":false,"replies":[{"id":"90727","content":"æ˜¯çš„ï¼Œåœ¨ç½‘ç»œä¼ è¾“æˆæœ¬ä¸æ–­ä¸‹é™çš„å½“ä¸‹ï¼Œéœ€è¦æ”¹è¿›","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599557522,"ip_address":"","comment_id":233110,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10184153205","product_id":100051201,"comment_content":"è¯¾åé¢˜ï¼Œå…¸å‹çš„ä¾‹å­ï¼Œdnsç¼“å­˜ï¼Œè¿™ç©æ„æ€»æ˜¯æ›´æ–°ä¸åŠæ—¶ï¼Œè€è®¨åŒäº†ã€‚éå¸¸å½±å“å¯ç”¨æ€§ğŸ˜‚","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500896,"discussion_content":"æ˜¯çš„ï¼Œåœ¨ç½‘ç»œä¼ è¾“æˆæœ¬ä¸æ–­ä¸‹é™çš„å½“ä¸‹ï¼Œéœ€è¦æ”¹è¿›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599557522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264687,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/2f/3ec98bc1.jpg","nickname":"å¹³è¡¡çš„çº¢æœ","note":"","ucode":"FC06861D00B9B1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294185,"discussion_content":"é˜¿é‡Œæœ‰ä¸ªå¼€æºçš„æ’ä»¶ï¼Œå¯ä»¥å®æ—¶æ›´æ”¹æˆ–è€…åˆ é™¤dnsç¼“å­˜çš„IPï¼Œä¹Ÿå¯ä»¥åˆ é™¤ï¼Œé’ˆå¯¹çš„æ˜¯JVMé‡Œé¢çš„DNSç¼“å­˜ï¼Œå¯ä»¥å°è¯•ç”¨ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595822487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1118627,"avatar":"https://static001.geekbang.org/account/avatar/00/11/11/a3/7a2405ca.jpg","nickname":"rfyiamcool","note":"","ucode":"65FCBF05B13893","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1264687,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/2f/3ec98bc1.jpg","nickname":"å¹³è¡¡çš„çº¢æœ","note":"","ucode":"FC06861D00B9B1","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":300684,"discussion_content":"è¿è¥å•†çš„ç¼“å­˜åŠ«æŒæ²¡åŠæ³•çš„ï¼ŒæŠ•è¯‰ä¸¾æŠ¥éƒ½ç™½æ‰¯ï¼Œå¯ä»¥ä½¿ç”¨https dns","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598233178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294185,"ip_address":""},"score":300684,"extra":""}]}]},{"had_liked":false,"id":243626,"user_name":"rfyiamcool","can_delete":false,"product_type":"c1","uid":1118627,"ip_address":"","ucode":"65FCBF05B13893","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/a3/7a2405ca.jpg","comment_is_top":false,"comment_ctime":1598233904,"is_pvip":true,"replies":[{"id":"89967","content":"å¾ˆæ£’çš„åˆ†äº«ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1598490944,"ip_address":"","comment_id":243626,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5893201200","product_id":100051201,"comment_content":"é€šå¸¸åœ¨cdnåœºæ™¯ä¸‹å»ºè®®é‡‡ç”¨é€’å¢æ–‡ä»¶åï¼Œcdnä¹Ÿæ”¯æŒé¢„ç¼“å­˜æ¥å£ï¼Œä¸Šçº¿å‰å¯ä»¥æŠŠæ–‡ä»¶æ¨è¿‡å»ï¼Œè®©cdné¢„çƒ­å¤šçº§ç¼“å­˜ã€‚å¯¹äºå¤§æ–‡ä»¶å¤§è§†é¢‘ä¹Ÿå¯åšåˆ°åˆ†ç‰‡ç¼“å­˜ï¼Œæ— éœ€ç­‰ç¼“å­˜æ›´æ–°å®Œæ¯•æ‰è¿”å›ã€‚ğŸ˜„","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504339,"discussion_content":"å¾ˆæ£’çš„åˆ†äº«ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598490944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236524,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1595447975,"is_pvip":false,"replies":[{"id":"90323","content":"æ²¡å¤ªæ˜ç™½ä½ çš„æ„æ€å“ˆã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œnginxç¼“å­˜çš„ç²’åº¦å¾ˆå¤§ï¼Œå®ƒçš„Keyæ˜¯URLï¼ŒValueæ˜¯æ–‡ä»¶æˆ–è€…å“åº”ï¼Œé€šå¸¸æ˜¯æœ€å¤–å±‚çš„ç¼“å­˜ï¼ŒRedisç¼“å­˜çš„ç²’åº¦å¾ˆå°ï¼Œä¸€èˆ¬æ˜¯OOå¯¹è±¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599010966,"ip_address":"","comment_id":236524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5890415271","product_id":100051201,"comment_content":"å¯èƒ½æœ‰ä¸€ç‚¹ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼šredis+nginxå…¶å®è¿™å¥—æ–¹æ¡ˆå¹¶ä¸å¥½ï¼Œå°¤å…¶å¦‚æœæœ‰äº›éå¸¸è€—è´¹èµ„æºçš„åº”ç”¨ä¸å¤šä¸”é‡è¦çš„è¯ã€‚<br>å…¶å®æ˜¯é€šè¿‡è¿½åŠ sftpä¹‹ç±»çš„æŠŠè¿™éƒ¨åˆ†èµ„æºè½åœ°åˆ°æœåŠ¡å™¨ï¼Œä»è€Œå‡å°‘äº†æ•°æ®ç³»ç»ŸæŸ¥è¯¢çš„èµ„æºæ¶ˆè€—ã€‚","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502110,"discussion_content":"æ²¡å¤ªæ˜ç™½ä½ çš„æ„æ€å“ˆã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œnginxç¼“å­˜çš„ç²’åº¦å¾ˆå¤§ï¼Œå®ƒçš„Keyæ˜¯URLï¼ŒValueæ˜¯æ–‡ä»¶æˆ–è€…å“åº”ï¼Œé€šå¸¸æ˜¯æœ€å¤–å±‚çš„ç¼“å­˜ï¼ŒRedisç¼“å­˜çš„ç²’åº¦å¾ˆå°ï¼Œä¸€èˆ¬æ˜¯OOå¯¹è±¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599010966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233122,"user_name":"èµ–é˜¿ç”˜","can_delete":false,"product_type":"c1","uid":1351988,"ip_address":"","ucode":"77493FE85CBAF8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICBNZjA9hW65x6g9b2iaicKUJW5gxFxtgPXH9Cqp6eyFfY1sD2hVY4dZrY5pmoK2r1KZEiaaIKocdZQ/132","comment_is_top":false,"comment_ctime":1594222012,"is_pvip":false,"replies":[{"id":"86016","content":"å“ˆå“ˆï¼Œé™¶è€å¸ˆåœ¨æå®¢æ—¶é—´å•Šï¼Œä½ åœ¨è¿™é‡Œè”ç³»ä»–","user_name":"ç¼–è¾‘å›å¤","user_name_real":"éƒ­è•¾","uid":"1000473","ctime":1594255540,"ip_address":"","comment_id":233122,"utype":2}],"discussion_count":1,"race_medal":0,"score":"5889189308","product_id":100051201,"comment_content":"é™¶è¾‰è€å¸ˆï¼Œä¹°äº†æ‚¨ä¸¤ä¸ªè¯¾ç¨‹ï¼Œè¿˜æœ‰ä¸€ä¸ªã€ŠæŠ“åŒ…å®æˆ˜ã€‹ï¼Œå¹¶ä¸”è¿˜å…³æ³¨äº†æ‚¨çš„åšå®¢ã€‚è¯´å®åœ¨ï¼Œè¢«ä½ çš„ä¸“ä¸šå’Œå¯¹äºæ‰€è®²è¯¾ç¨‹çš„æ•¬ä¸šï¼Œèƒ½çœ‹å‡ºæ¥æ‚¨è¿™æ˜¯æ¯«æ— ä¿ç•™çš„å€¾å›Šç›¸æˆã€‚å­¦ç”Ÿå¾ˆæƒ³è®¤è¯†ä½ ï¼Œä¸çŸ¥å¯ä»¥è¦ä¸€ä¸ªè”ç³»æ–¹å¼å—ï¼Œæˆ‘ä¹°äº†30å¤šä¸ªè¯¾ç¨‹ï¼Œè¿™æ˜¯æˆ‘å”¯ä¸€ä¸€æ¬¡å¤§èƒ†åœ°æ‰¾è€å¸ˆè¦è”ç³»æ–¹å¼ã€‚ä¸çŸ¥ä¸ºå•¥ï¼Œæœ‰ç§æ„Ÿè§‰ä½ åœ¨ç”Ÿæ´»ä¸­å°±æ˜¯ä¸ªäº¦å¸ˆäº¦å‹çš„è§’è‰²ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ","like_count":1,"discussions":[{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"éƒ­è•¾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500902,"discussion_content":"å“ˆå“ˆï¼Œé™¶è€å¸ˆåœ¨æå®¢æ—¶é—´å•Šï¼Œä½ åœ¨è¿™é‡Œè”ç³»ä»–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594255540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234852,"user_name":"èš‚èš","can_delete":false,"product_type":"c1","uid":1211429,"ip_address":"","ucode":"B3FEFB399536DF","user_header":"https://static001.geekbang.org/account/avatar/00/12/7c/25/7d9a2538.jpg","comment_is_top":false,"comment_ctime":1594812558,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1594812558","product_id":100051201,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸‹ï¼Œä¸¤ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œæ˜¯è¯´æ•°æ®ä¹Ÿè¦å­˜æ”¾åœ¨è¿™ä¸¤ç±»æ•°æ®ç»“æ„ä¸­å—ï¼Ÿè¿™ä¸¤ç§æ•°æ®çš„æŸ¥æ‰¾æ•ˆç‡éƒ½ä¸é«˜ï¼Œæ˜¯æˆ‘ç†è§£é”™äº†å—","like_count":0,"discussions":[{"author":{"id":1052345,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0e/b9/6a48274e.jpg","nickname":"é“¬å¤©é’S","note":"","ucode":"0D4EBA3C70FBBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577759,"discussion_content":"LRUä¸€èˆ¬ä½¿ç”¨å“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨æ¥å®ç°ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨æŸ¥è¯¢é€Ÿåº¦æ˜¯O(N)çš„é—®é¢˜ã€‚å­˜å‚¨å’Œç´¢å¼•éƒ½æ˜¯ä½¿ç”¨keyï¼Œvalueé€šè¿‡æŒ‡é’ˆæ‰¾åˆ°å°±è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656321658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}