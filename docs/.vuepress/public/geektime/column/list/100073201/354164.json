{"id":354164,"title":"08 | 聚合函数：怎么高效地进行分组统计？","content":"<p>你好，我是朱晓峰。今天，我来和你聊一聊聚合函数。</p><p>MySQL中有5种聚合函数较为常用，分别是求和函数SUM()、求平均函数AVG()、最大值函数MAX()、最小值函数MIN()和计数函数COUNT()。接下来，我就结合超市项目的真实需求，来带你掌握聚合函数的用法，帮你实现高效的分组统计。</p><p>咱们的项目需求是这样的：超市经营者提出，他们需要统计某个门店，每天、每个单品的销售情况，包括销售数量和销售金额等。这里涉及3个数据表，具体信息如下所示：</p><p>销售明细表（demo.transactiondetails)：</p><p><img src=\"https://static001.geekbang.org/resource/image/ba/4e/ba86b64760c96caf85872f362790534e.jpeg?wh=1801*678\" alt=\"\"></p><p>销售单头表（demo.transactionhead)：</p><p><img src=\"https://static001.geekbang.org/resource/image/32/50/3242decd05814f16479f2e6edb5fd050.jpeg?wh=1740*684\" alt=\"\"></p><p>商品信息表（demo.goodsmaster）：</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/1a/d72f0fb930280cb611d8f31aed98bf1a.jpeg?wh=1559*409\" alt=\"\"></p><p>要统计销售，就要用到数据求和，那么我们就先来学习下求和函数SUM()。</p><h2>SUM（）</h2><p>SUM（）函数可以返回指定字段值的和。我们可以用它来获得用户某个门店，每天，每种商品的销售总计数据：</p><pre><code>mysql&gt;  SELECT\n    -&gt;     LEFT(b.transdate, 10), -- 从关联表获取交易时间，并且通过LEFT函数，获取交易时间字符串的左边10个字符，得到年月日的数据\n    -&gt;     c.goodsname,           -- 从关联表获取商品名称\n    -&gt;     SUM(a.quantity),       -- 数量求和\n    -&gt;     SUM(a.salesvalue)      -- 金额求和\n    -&gt; FROM\n    -&gt;     demo.transactiondetails a\n    -&gt;         JOIN\n    -&gt;     demo.transactionhead b ON (a.transactionid = b.transactionid)\n    -&gt;         JOIN\n    -&gt;     demo.goodsmaster c ON (a.itemnumber = c.itemnumber)\n    -&gt; GROUP BY LEFT(b.transdate, 10) , c.goodsname      -- 分组\n    -&gt; ORDER BY LEFT(b.transdate, 10) , c.goodsname;     -- 排序\n+-----------------------+-----------+-----------------+-------------------+\n| LEFT(b.transdate, 10) | goodsname | SUM(a.quantity) | SUM(a.salesvalue) |\n+-----------------------+-----------+-----------------+-------------------+\n| 2020-12-01            | 书        |           2.000 |            178.00 |\n| 2020-12-01            | 笔        |           5.000 |             25.00 |\n| 2020-12-02            | 书        |           4.000 |            356.00 |\n| 2020-12-02            | 笔        |          16.000 |             80.00 |\n+-----------------------+-----------+-----------------+-------------------+\n4 rows in set (0.01 sec)\n</code></pre><p>可以看到，我们引入了2个关键字：LEFT 和 ORDER BY，你可能对它们不熟悉，我来具体解释下。</p><p><strong>LEFT(str，n)</strong>：表示返回字符串str最左边的n个字符。我们这里的LEFT（a.transdate,10），表示返回交易时间字符串最左边的10个字符。在MySQL中，DATETIME类型的默认格式是：YYYY-MM-DD，也就是说，年份4个字符，之后是“-”，然后是月份2个字符，之后又是“-”，然后是日2个字符，所以完整的年月日是10个字符。用户要求按照日期统计，所以，我们需要从日期时间数据中，把年月日的部分截取出来。</p><!-- [[[read_end]]] --><p><strong>ORDER BY</strong>：表示按照指定的字段排序。超市经营者指定按照日期和单品统计，那么，统计的结果按照交易日期和商品名称的顺序排序，会更加清晰。</p><p>知道了2个关键字之后，刚刚的查询就容易理解了。接下来我们就再拆解一下，看看这个查询是如何执行的。我用图表来直观地演示一下各个步骤。</p><p>第一步，完成3个表的连接（由于字段比较多，为了你理解，我省略了一些在这一步不重要的字段）：</p><p><img src=\"https://static001.geekbang.org/resource/image/95/a7/953cd3d7199a36bf070e1a481a852da7.jpeg?wh=1771*743\" alt=\"\"></p><p>第二步，对结果集按照交易时间和商品名称进行分组，我们可以分成下面4组。</p><p>第一组：</p><p><img src=\"https://static001.geekbang.org/resource/image/3a/96/3a9ee51c76802f3dd204c4b680548096.jpeg?wh=1672*388\" alt=\"\"></p><p>第二组：</p><p><img src=\"https://static001.geekbang.org/resource/image/1c/e5/1c99979d20f62a22265bd479365b91e5.jpeg?wh=1848*366\" alt=\"\"></p><p>第三组：</p><p><img src=\"https://static001.geekbang.org/resource/image/61/85/61c37518b1a8dac6d33e6e85bdc53385.jpeg?wh=1868*543\" alt=\"\"></p><p>第四组：</p><p><img src=\"https://static001.geekbang.org/resource/image/52/96/52b8bebfb9bd9ed4e866ceb2a9cef796.jpeg?wh=1762*504\" alt=\"\"></p><p>第三步，对各组的销售数量和销售金额进行统计，并且按照交易日期和商品名称排序。这样就得到了我们需要的结果，如下所示：</p><pre><code>+-----------------------+-----------+-----------------+-------------------+\n| LEFT(b.transdate, 10) | goodsname | SUM(a.quantity) | SUM(a.salesvalue) |\n+-----------------------+-----------+-----------------+-------------------+\n| 2020-12-01            | 书        |           2.000 |            178.00 |\n| 2020-12-01            | 笔        |           5.000 |             25.00 |\n| 2020-12-02            | 书        |           4.000 |            356.00 |\n| 2020-12-02            | 笔        |          16.000 |             80.00 |\n+-----------------------+-----------+-----------------+-------------------+\n4 rows in set (0.01 sec)\n</code></pre><p>如果用户需要知道全部商品销售的总计数量和总计金额，我们也可以把数据集的整体看作一个分组，进行计算。这样就不需要分组关键字GROUP BY，以及排序关键字ORDER BY了。你甚至不需要从关联表中获取数据，也就不需要连接了。就像下面这样：</p><pre><code>mysql&gt; SELECT\n    -&gt;  SUM(quantity), -- 总计数量\n    -&gt;  SUM(salesvalue)-- 总计金额\n    -&gt; FROM\n    -&gt;  demo.transactiondetails;\n+---------------+-----------------+\n| SUM(quantity) | SUM(salesvalue) |\n+---------------+-----------------+\n|        27.000 |          639.00 |\n+---------------+-----------------+\n1 row in set (0.05 sec)\n</code></pre><p>到这里呢，求和函数SUM()的使用方法我就讲完了。需要提醒你的是，求和函数获取的是分组中的合计数据，所以你要对分组的结果有准确的把握，否则就很容易搞错。这也就是说，你要知道是按什么字段进行分组的。如果是按多个字段分组，你要知道字段之间有什么样的层次关系；如果是按照以字段作为变量的某个函数进行分组的，你要知道这个函数的返回值是什么，返回值又是如何影响分组的等。</p><h2>AVG（）、MAX（）和MIN（）</h2><p>接下来，我们来计算一下分组中数据的平均值、最大值和最小值。这个时候，就要用到AVG()、MAX()和MIN()了。</p><p>1.AVG（）</p><p>首先，我们来学习下计算平均值的函数AVG（）。它的作用是，通过计算分组内指定字段值的和，以及分组内的记录数，算出分组内指定字段的平均值。</p><p>举个例子，如果用户需要计算每天、每种商品，平均一次卖出多少个、多少钱，这个时候，我们就可以用到AVG（）函数了，如下所示：</p><pre><code>mysql&gt; SELECT\n-&gt; LEFT(a.transdate, 10),\n-&gt; c.goodsname,\n-&gt; AVG(b.quantity),    -- 平均数量\n-&gt; AVG(b.salesvalue)   -- 平均金额\n-&gt; FROM\n-&gt; demo.transactionhead a\n-&gt; JOIN\n-&gt; demo.transactiondetails b ON (a.transactionid = b.transactionid)\n-&gt; JOIN\n-&gt; demo.goodsmaster c ON (b.itemnumber = c.itemnumber)\n-&gt; GROUP BY LEFT(a.transdate,10),c.goodsname\n-&gt; ORDER BY LEFT(a.transdate,10),c.goodsname;\n+-----------------------+-----------+-----------------+-------------------+\n| LEFT(a.transdate, 10) | goodsname | AVG(b.quantity) | AVG(b.salesvalue) |\n+-----------------------+-----------+-----------------+-------------------+\n| 2020-12-01 | 书 | 2.0000000 | 178.000000 |\n| 2020-12-01 | 笔 | 5.0000000 | 25.000000 |\n| 2020-12-02 | 书 | 2.0000000 | 178.000000 |\n| 2020-12-02 | 笔 | 8.0000000 | 40.000000 |\n+-----------------------+-----------+-----------------+-------------------+\n4 rows in set (0.00 sec)\n</code></pre><p>2.MAX（）和MIN（）</p><p>MAX()表示获取指定字段在分组中的最大值，MIN()表示获取指定字段在分组中的最小值。它们的实现原理差不多，下面我就重点讲一下MAX()，知道了它的用法，MIN()也就很好理解了。</p><p>我们还是来看具体的例子。假如用户要求计算每天里的一次销售的最大数量和最大金额，就可以用下面的代码，得到我们需要的结果：</p><pre><code>mysql&gt; SELECT\n-&gt; LEFT(a.transdate, 10),\n-&gt; MAX(b.quantity),     -- 数量最大值\n-&gt; MAX(b.salesvalue)    -- 金额最大值\n-&gt; FROM\n-&gt; demo.transactionhead a\n-&gt; JOIN\n-&gt; demo.transactiondetails b ON (a.transactionid = b.transactionid)\n-&gt; JOIN\n-&gt; demo.goodsmaster c ON (b.itemnumber = c.itemnumber)\n-&gt; GROUP BY LEFT(a.transdate,10)\n-&gt; ORDER BY LEFT(a.transdate,10);\n+-----------------------+-----------------+-------------------+\n| LEFT(a.transdate, 10) | MAX(b.quantity) | MAX(b.salesvalue) |\n+-----------------------+-----------------+-------------------+\n| 2020-12-01 | 5.000 | 178.00 |\n| 2020-12-02 | 10.000 | 267.00 |\n+-----------------------+-----------------+-------------------+\n2 rows in set (0.00 sec)\n</code></pre><p>代码很简单，你一看就明白了。但是，这里有个问题你要注意：千万不要以为MAX（b.quantity）和MAX（b.salesvalue）算出的结果一定是同一条记录的数据。实际上，MySQL是分别计算的。下面我们就来分析一下刚刚的查询。</p><p>查询中用到3个相互关联的表：销售流水明细表、销售流水单头表和商品信息表。这3个表连接完成之后，MySQL进行了分组。我用图示的办法给你展示出来：</p><p>第一组</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/8a/3ba226e73b81a02a294ab83c7yy0d68a.jpeg?wh=1852*476\" alt=\"\"></p><p>第二组</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/2d/6e50732ff2c59199abbea6381d083a2d.jpeg?wh=1821*609\" alt=\"\"></p><p>在第一组中，最大数量出现在第2条记录，是5；最大金额出现在第1条记录，是178。同样道理，在第二组中，最大数量出现在第4条记录，是10；最大金额则出现在第1条记录，是267。</p><p>所以，MAX（字段）这个函数返回分组集中最大的那个值。如果你要查询 MAX（字段1）和MAX（字段2），而它们是相互独立、分别计算的，你千万不要想当然地认为结果在同一条记录上。那样的话，你就掉坑里了。</p><h2>COUNT（）</h2><p>通过<strong>COUNT（）</strong>，我们可以了解数据集的大小，这对系统优化十分重要。</p><p>举个小例子，在项目实施的过程中，我们遇到了这么一个问题：由于用户的销售数据很多，而且每天都在增长，因此，在做销售查询的时候，经常会遇到卡顿的问题。这是因为，查询的数据量太大了，导致系统不得不花很多时间来处理数据，并给数据集分配资源，比如内存什么的。</p><p>怎么解决卡顿的问题呢？我们想到了一个分页的策略。</p><p>所谓的分页策略，其实就是，不把查询的结果一次性全部返回给客户端，而是根据用户电脑屏幕的大小，计算一屏可以显示的记录数，每次只返回用户电脑屏幕可以显示的数据集。接着，再通过翻页、跳转等功能按钮，实现查询目标的精准锁定。这样一来，每次查询的数据量较少，也就大大提高了系统响应速度。</p><p>这个策略能够实现的一个关键，就是要<strong>计算出符合条件的记录一共有多少条</strong>，之后才能计算出一共有几页、能不能翻页或跳转。</p><p>要计算记录数，就要用到COUNT()函数了。这个函数有两种情况。</p><ul>\n<li>COUNT（*）：统计一共有多少条记录；</li>\n<li>COUNT（字段）：统计有多少个不为空的字段值。</li>\n</ul><p>1.COUNT(*)</p><p>如果COUNT（*）与GROUP BY一起使用，就表示统计分组内有多少条数据。它也可以单独使用，这就相当于数据集全体是一个分组，统计全部数据集的记录数。</p><p>我举个小例子，假设我有个销售流水明细表如下：</p><pre><code>mysql&gt; SELECT *\n    -&gt; FROM demo.transactiondetails;\n+---------------+------------+----------+-------+------------+\n| transactionid | itemnumber | quantity | price | salesvalue |\n+---------------+------------+----------+-------+------------+\n|             1 |          1 |    2.000 | 89.00 |     178.00 |\n|             1 |          2 |    5.000 |  5.00 |      25.00 |\n|             2 |          1 |    3.000 | 89.00 |     267.00 |\n|             2 |          2 |    6.000 |  5.00 |      30.00 |\n|             3 |          1 |    1.000 | 89.00 |      89.00 |\n|             3 |          2 |   10.000 |  5.00 |      50.00 |\n+---------------+------------+----------+-------+------------+\n6 rows in set (0.00 sec)\n</code></pre><p>如果我们一屏可以显示30行，需要多少页才能显示完这个表的全部数据呢？</p><pre><code>mysql&gt; SELECT COUNT(*)\n-&gt; FROM demo.transactiondetails;\n+----------+\n| COUNT(*) |\n+----------+\n| 6 |\n+----------+\n1 row in set (0.03 sec)\n</code></pre><p>我们这里只有6条数据，一屏就可以显示了，所以一共1页。</p><p>那么，如果超市经营者想知道，每天、每种商品都有几次销售，我们就需要按天、按商品名称，进行分组查询：</p><pre><code>mysql&gt; SELECT\n-&gt; LEFT(a.transdate, 10), c.goodsname, COUNT(*) -- 统计销售次数\n-&gt; FROM\n-&gt; demo.transactionhead a\n-&gt; JOIN\n-&gt; demo.transactiondetails b ON (a.transactionid = b.transactionid)\n-&gt; JOIN\n-&gt; demo.goodsmaster c ON (b.itemnumber = c.itemnumber)\n-&gt; GROUP BY LEFT(a.transdate, 10) , c.goodsname\n-&gt; ORDER BY LEFT(a.transdate, 10) , c.goodsname;\n+-----------------------+-----------+----------+\n| LEFT(a.transdate, 10) | goodsname | COUNT(*) |\n+-----------------------+-----------+----------+\n| 2020-12-01 | 书 | 1 |\n| 2020-12-01 | 笔 | 1 |\n| 2020-12-02 | 书 | 2 |\n| 2020-12-02 | 笔 | 2 |\n+-----------------------+-----------+----------+\n4 rows in set (0.00 sec)\n</code></pre><p>运行这段代码，我们就得到了每天、每种商品有几次销售的全部结果。</p><p>2.COUNT（字段）</p><p>COUNT（字段）用来统计分组内这个字段的值出现了多少次。如果字段值是空，就不统计。</p><p>为了说明它们的区别，我举个小例子。假设我们有这样的一个商品信息表，里面包括了商品编号、条码、名称、规格、单位和售价的信息。</p><pre><code>mysql&gt; SELECT *\n-&gt; FROM demo.goodsmaster;\n+------------+---------+-----------+---------------+------+------------+\n| itemnumber | barcode | goodsname | specification | unit | salesprice |\n+------------+---------+-----------+---------------+------+------------+\n| 1 | 0001 | 书 | 16开 | 本 | 89.00 |\n| 2 | 0002 | 笔 | NULL | 支 | 5.00 |\n| 3 | 0002 | 笔 | NULL | 支 | 10.00 |\n+------------+---------+-----------+---------------+------+------------+\n3 rows in set (0.01 sec)\n</code></pre><p>如果我们要统计字段“goodsname”出现了多少次，就要用到函数COUNT（goodsname），结果是3次：</p><pre><code>mysql&gt; SELECT COUNT(goodsname) -- 统计商品名称字段\n-&gt; FROM demo.goodsmaster;\n+------------------+\n| COUNT(goodsname) |\n+------------------+\n| 3 |\n+------------------+\n1 row in set (0.00 sec)\n</code></pre><p>如果我们统计字段“specification”，用COUNT(specification)，结果是1次：</p><pre><code>mysql&gt; SELECT COUNT(specification) -- 统计规格字段\n-&gt; FROM demo.goodsmaster;\n+----------------------+\n| COUNT(specification) |\n+----------------------+\n| 1 |\n+----------------------+\n1 row in set (0.00 sec)\n</code></pre><p>你可能会问，为啥计数字段“goodsname”的结果是3，计数字段“specification”却只有1呢？其实，这里的原因就是，3条记录里面的字段“goodsname”没有空值，因此被统计了3次；而字段“specification”有2个空值，因此只统计了1次。</p><p>理解了这一点，你就可以利用计数函数对某个字段计数时，不统计空值的特点，对表中字段的非空值进行计数了。</p><h2>总结</h2><p>今天，我们学习了聚合函数SUM（）、AVG（）、MAX（）、MIN（）和COUNT（）。我们在对分组数据进行统计的时候，可以用这些函数来对分组数据求和、求平均值、最大值、最小值，以及统计分组内的记录数，或者分组内字段的值不为空的次数。</p><p>这些函数，为我们对数据库中的数据进行统计和计算提供了方便。因为计算直接在数据库中执行，比在应用层面完成相同的工作，效率高很多。</p><p>最后，我还想多说一句，不知道你注意到没有，这节课我还提到了LEFT和ORDER BY。其实，聚合函数可以和其他关键字、函数一起使用，这样会拓展它的使用场景，让原本复杂的计算变简单。所以，我建议你不仅要认真学习这节课的聚合函数，还要掌握MySQL的各种关键字的功能和用法，并且根据实际工作的需要，尝试把它们组合在一起使用，这样就能利用好数据库的强大功能，更好地满足用户的需求。</p><h2>思考题</h2><p>如果用户想要查询一下，在商品信息表中，到底是哪种商品的商品名称有重复，分别重复了几次，该如何查询呢？</p><p>欢迎在留言区写下你的思考和答案，我们一起交流讨论。如果你觉得今天的内容对你有所帮助，也欢迎你分享你的朋友或同事，我们下节课见。</p>","neighbors":{"left":{"article_title":"07 | 条件语句：WHERE 与 HAVING有什么不同?","id":353853},"right":{"article_title":"09 | 时间函数：时间类数据，MySQL是怎么处理的？","id":355699}},"comments":[{"had_liked":false,"id":289326,"user_name":"朱晓峰","can_delete":false,"product_type":"c1","uid":2356905,"ip_address":"","ucode":"D2F84F44329C29","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","comment_is_top":true,"comment_ctime":1618977391,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.223372090013399e+18","product_id":100073201,"comment_content":"你好，我是朱晓峰，下面我就来公布一下上节课思考题的答案：<br><br>上节课，我们学习了条件语句WHERE和HAVING。下面是思考题的参考答案：<br><br>HAVING后面的条件，必须是包含分组中计算函数的条件。这种说法是有道理的，主要是考虑到查询的效率。因为如果不是分组中的计算函数的条件，那么这个条件应该可以用WHERE而不是用HAVING，查询的效率就不高了。","like_count":13},{"had_liked":false,"id":286817,"user_name":"海林Lin","can_delete":false,"product_type":"c1","uid":1917715,"ip_address":"","ucode":"26333AE3DFAF9D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/43/13/649ccaa9.jpg","comment_is_top":false,"comment_ctime":1617610893,"is_pvip":false,"replies":[{"id":"106376","content":"请参考公布的思考题答案","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1621498884,"ip_address":"","comment_id":286817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18797480077","product_id":100073201,"comment_content":"思考题答案：<br>SELECT goodsname, count(goodsname)<br>FROM demo.goodsmaster<br>GROUP BY goodsname<br>HAVING count(goodsname) &gt; 1;","like_count":4,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518099,"discussion_content":"请参考公布的思考题答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621498884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285113,"user_name":"右耳朵猫咪","can_delete":false,"product_type":"c1","uid":1014984,"ip_address":"","ucode":"3AB186CC780FBB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/c8/8627f5c1.jpg","comment_is_top":false,"comment_ctime":1616632187,"is_pvip":true,"replies":[{"id":"104976","content":"还是要根据实际场景分析","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618993538,"ip_address":"","comment_id":285113,"utype":1}],"discussion_count":4,"race_medal":0,"score":"18796501371","product_id":100073201,"comment_content":"像sum()、avg()这样的函数都是统计非空的记录；文章中对group by后的字段做了函数处理，会降低性能，实际开发中不会这么搞。","like_count":4,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517589,"discussion_content":"还是要根据实际场景分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618993538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361407,"discussion_content":"这个是因为用了函数，索引会失效的原因吧。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616664237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435799,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/97/2dde32d5.jpg","nickname":"爱吃buger的布朗熊","note":"","ucode":"0B591746F6B897","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361285,"discussion_content":"能否结合实际开发中的情况，举例说明下：如果类似文章中的情况需要group by一个处理后的字段。不用函数处理的话，有什么其他好的写法么？技术交流～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616637116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1014984,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7c/c8/8627f5c1.jpg","nickname":"右耳朵猫咪","note":"","ucode":"3AB186CC780FBB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1435799,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/97/2dde32d5.jpg","nickname":"爱吃buger的布朗熊","note":"","ucode":"0B591746F6B897","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361290,"discussion_content":"用数据表里原生的字段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616637792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361285,"ip_address":""},"score":361290,"extra":""}]}]},{"had_liked":false,"id":285094,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1015222,"ip_address":"","ucode":"27EB4A725CE14E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/b6/abdebdeb.jpg","comment_is_top":false,"comment_ctime":1616603151,"is_pvip":false,"replies":[{"id":"104975","content":"既然分组，自然就会只用到分组字段和组内的计算，如果你还要用到其他字段，应该是你这个查询的需求还没有分析好","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618993448,"ip_address":"","comment_id":285094,"utype":1}],"discussion_count":5,"race_medal":0,"score":"18796472335","product_id":100073201,"comment_content":"我一直有个疑惑就是当我需要做对某些字段做group by来分组 我可能还需要其他不作为group by的字段 但是根据SQL标准 出现在select后面的字段要么是group by里的字段 要么是聚合函数 那么这种情况应该怎么处理呢？","like_count":4,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517582,"discussion_content":"既然分组，自然就会只用到分组字段和组内的计算，如果你还要用到其他字段，应该是你这个查询的需求还没有分析好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618993448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1731985,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/6d/91/9745cf49.jpg","nickname":"小天","note":"","ucode":"D24207A1148E14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382113,"discussion_content":"select 后面的字段如果不在group by分组内，会报错only_full_group_by的错，可以通过SELECT @@GLOBAL.sql_mode;查看全局参数，然后把only_full_group_by去掉，这样sql就不会报错了，但是还需要考虑这样执行出来的结果，是否正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625416920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2530127,"avatar":"https://static001.geekbang.org/account/avatar/00/26/9b/4f/9350a027.jpg","nickname":"周小宇","note":"","ucode":"7B5453CC63EF31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367356,"discussion_content":"往子查询思路靠","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618326285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005290,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","nickname":"giteebravo","note":"","ucode":"C087E8D6B5A98B","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362803,"discussion_content":"\n同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617029795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1608959,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8c/ff/9edc274f.jpg","nickname":"Jun","note":"","ucode":"48B7D8DDAE9CB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362635,"discussion_content":"如果能够保证在组内，这个字段是常量的话，可以放心对这个字段使用max或min, 即使不是数值型字段，也不会损失任何信息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616995830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285848,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1617030111,"is_pvip":false,"replies":[{"id":"104988","content":"多做项目多实践，熟能生巧","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618997210,"ip_address":"","comment_id":285848,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10206964703","product_id":100073201,"comment_content":"<br>如何像老师一样分析出这些个聚合函数分组统计的步骤？","like_count":2,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517801,"discussion_content":"多做项目多实践，熟能生巧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618997210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324637,"user_name":"之墨","can_delete":false,"product_type":"c1","uid":2686133,"ip_address":"","ucode":"300B4B9CF1703A","user_header":"https://static001.geekbang.org/account/avatar/00/28/fc/b5/db4759f1.jpg","comment_is_top":false,"comment_ctime":1638522297,"is_pvip":false,"replies":[{"id":"120733","content":"非常有必要。原因是前端的代码经常会有改动，为了确保数据的正确性，在数据表设计的时候，加上不能为空的校验是很有好处的。","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1642305812,"ip_address":"","comment_id":324637,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5933489593","product_id":100073201,"comment_content":"老师请教一个问题，一个必录字段在前端已经做了必录校验，还有必要在mysql数据库勾上不能为null的校验吗？为什么呢？","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546366,"discussion_content":"非常有必要。原因是前端的代码经常会有改动，为了确保数据的正确性，在数据表设计的时候，加上不能为空的校验是很有好处的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642305812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286190,"user_name":"上邪忘川","can_delete":false,"product_type":"c1","uid":1276588,"ip_address":"","ucode":"1C4459917B038D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","comment_is_top":false,"comment_ctime":1617182143,"is_pvip":false,"replies":[{"id":"106121","content":"这样可能会占用较大的篇幅，不够紧凑","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1621248101,"ip_address":"","comment_id":286190,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5912149439","product_id":100073201,"comment_content":"老师你好，每次有新表的时候，可否贴一下建表语句和插入的数据","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517902,"discussion_content":"这样可能会占用较大的篇幅，不够紧凑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621248101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2648425,"avatar":"https://static001.geekbang.org/account/avatar/00/28/69/69/5031b03f.jpg","nickname":"Silence","note":"","ucode":"45FF9A2BCC166B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378504,"discussion_content":"建表语句可以放一个下载链接","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1623249873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793419,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5d/8b/eeed5010.jpg","nickname":"少年宇","note":"","ucode":"25D927111D3078","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384855,"discussion_content":"非常赞成","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626773528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285291,"user_name":"Kansei","can_delete":false,"product_type":"c1","uid":1683450,"ip_address":"","ucode":"44B427B8A53A22","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI0MMdRXKH3O6QibmoKH8GjHAOM6Zz2sYmI1A0E9eWCbO978PQ4JZSCjbNk6fIbxyadSZGAYib6c5GQ/132","comment_is_top":false,"comment_ctime":1616725830,"is_pvip":false,"replies":[{"id":"104979","content":"count(*) 意思是统计表中所有的行<br>count(1) 意思是统计表的行数<br>count(列名)意思是统计表中列名字段不为NULL的数量<br>在MySQL中，count(*)和count(1)没什么区别，count(列名）不会把列名字段值为NULL的统计进去","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618995188,"ip_address":"","comment_id":285291,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5911693126","product_id":100073201,"comment_content":"老师能说说count(*) ，count(1) ，count(列名)，这3者的区别吗？","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517637,"discussion_content":"count(*) 意思是统计表中所有的行\ncount(1) 意思是统计表的行数\ncount(列名)意思是统计表中列名字段不为NULL的数量\n在MySQL中，count(*)和count(1)没什么区别，count(列名）不会把列名字段值为NULL的统计进去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618995188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367835,"discussion_content":"count(列名)，server层需要判断列名的定义是否可以为空，如果可以为空，需要把具体的列值取出来进行判断，不为空才累加，如果不能为空，取出字段值计数累加；\ncount(1)，不读取具体的数据，server层对返回的每行放一个数字1进去，判断是不能为空的，按行累加；\ncount(*)，mysql做了优化，不取具体的数据，肯定不为空，按行累加。\n最快的就是count(*)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618479622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1056982,"avatar":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","nickname":"kingcall","note":"","ucode":"508884DC684B5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365302,"discussion_content":"问就count(*) 对了，count(列名) 需要判断返回值是否为空，count(1) 也一样都需要返回到server 层去判断，但是count(*) 一定不是空，所以不需要判断的过程，所以我们可以认为count(*) 最好了，而且意思简单明了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617766198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624355,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c9/23/76511858.jpg","nickname":"洛奇","note":"","ucode":"662B4005721119","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363015,"discussion_content":"就问count(1)就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617097322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353346,"user_name":"棒棒糖","can_delete":false,"product_type":"c1","uid":2107111,"ip_address":"浙江","ucode":"7DFFE4B517FCDA","user_header":"https://static001.geekbang.org/account/avatar/00/20/26/e7/1c2c341d.jpg","comment_is_top":false,"comment_ctime":1659392855,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1659392855","product_id":100073201,"comment_content":"select count(Goodsname)  from `demo.goodsmaster` where deleted=0 group by `Goodsname` having count(*)&gt;1","like_count":0},{"had_liked":false,"id":341092,"user_name":"王睿","can_delete":false,"product_type":"c1","uid":2867913,"ip_address":"广东","ucode":"9E4C1D6C247356","user_header":"","comment_is_top":false,"comment_ctime":1649342243,"is_pvip":false,"replies":[{"id":"128773","content":"多做实操，加深理解","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1660026780,"ip_address":"广东","comment_id":341092,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649342243","product_id":100073201,"comment_content":"胃还可以哈，都消化吸收了","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583307,"discussion_content":"多做实操，加深理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660026780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333000,"user_name":"火车日记","can_delete":false,"product_type":"c1","uid":1480419,"ip_address":"","ucode":"62C57DFA6CDF74","user_header":"https://static001.geekbang.org/account/avatar/00/16/96/e3/dd40ec58.jpg","comment_is_top":false,"comment_ctime":1643949622,"is_pvip":false,"replies":[{"id":"123475","content":"count(*)与count(1）差别不大，count(1)稍微高效一点。count(字段)时，如果字段是主键，那么count(字段)更快，否则count(*),count(1)更快一些","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1647073788,"ip_address":"","comment_id":333000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1643949622","product_id":100073201,"comment_content":"count(*) 和count(1)或count(字段)哪个效率高呢？","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555784,"discussion_content":"count(*)与count(1）差别不大，count(1)稍微高效一点。count(字段)时，如果字段是主键，那么count(字段)更快，否则count(*),count(1)更快一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647073788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330610,"user_name":"枫林血舞","can_delete":false,"product_type":"c1","uid":2809867,"ip_address":"","ucode":"EE7F6DA78D21EA","user_header":"https://static001.geekbang.org/account/avatar/00/2a/e0/0b/6f667b2c.jpg","comment_is_top":false,"comment_ctime":1642067802,"is_pvip":true,"replies":[{"id":"120776","content":"请参考思考题答案","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1642309479,"ip_address":"","comment_id":330610,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642067802","product_id":100073201,"comment_content":"select <br>goodsname,<br>count(goodsname)<br>from demo.goodsmaster<br>group by goodsname<br>having count(goodsname) &gt; 1;","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546415,"discussion_content":"请参考思考题答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642309479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316116,"user_name":"longMe","can_delete":false,"product_type":"c1","uid":2181772,"ip_address":"","ucode":"A02210EDB2E163","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVegfjqa0gM0FXOlmrpMx1WjuXYWEVA7GyRms1l6UhH5ggKm3e5ibIW2F7bHN43OQKdUYF7KQkyBg/132","comment_is_top":false,"comment_ctime":1634164552,"is_pvip":false,"replies":[{"id":"116465","content":"是的","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1636615350,"ip_address":"","comment_id":316116,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634164552","product_id":100073201,"comment_content":"count(*)会统计所有的记录，只要这一条记录任意字段有值就统计，count(字段值)只统计该字段不为空，老师不知道理解对不对","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528272,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636615350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285847,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1617030029,"is_pvip":false,"replies":[{"id":"104987","content":"举个小例子，比如文稿中有这样的分组语句：<br><br>GROUP BY LEFT(transdate,10)，这个时候，你就要知道LEFT(transdate,10)返回的结果是销售时间按照格式YYYY-MM-DD的值，是按照这个值进行的分组。<br><br>文稿中的这段文字，就是提醒你，如果分组关键字GROUP BY 后面跟的是一个函数，你一定要知道函数返回什么，分组是按照返回值进行的","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618997165,"ip_address":"","comment_id":285847,"utype":1}],"discussion_count":2,"race_medal":1,"score":"1617030029","product_id":100073201,"comment_content":"<br>“如果是按照以字段作为变量的某个函数进行分组的，你要知道这个函数的返回值是什么，返回值又是如何影响分组的等”。<br><br>——这一段怎么理解呢？","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517800,"discussion_content":"举个小例子，比如文稿中有这样的分组语句：\n\nGROUP BY LEFT(transdate,10)，这个时候，你就要知道LEFT(transdate,10)返回的结果是销售时间按照格式YYYY-MM-DD的值，是按照这个值进行的分组。\n\n文稿中的这段文字，就是提醒你，如果分组关键字GROUP BY 后面跟的是一个函数，你一定要知道函数返回什么，分组是按照返回值进行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618997165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005290,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","nickname":"giteebravo","note":"","ucode":"C087E8D6B5A98B","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369310,"discussion_content":"明白了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619003012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285846,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1617029999,"is_pvip":false,"replies":[{"id":"104986","content":"这里的数据实际上是某个门店的数据，只有一个门店，所以，不需要按照门店分组了","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1618996778,"ip_address":"","comment_id":285846,"utype":1}],"discussion_count":2,"race_medal":1,"score":"1617029999","product_id":100073201,"comment_content":"<br>聚合函数 SUM 的例子中，需求是统计某个门店，每天、每个单品的销售情况，包括销售数量和销售金额等，那么分组条件是否缺少了门店信息？<br>","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517799,"discussion_content":"这里的数据实际上是某个门店的数据，只有一个门店，所以，不需要按照门店分组了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618996778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005290,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","nickname":"giteebravo","note":"","ucode":"C087E8D6B5A98B","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369311,"discussion_content":"OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619003046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285211,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1616666629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616666629","product_id":100073201,"comment_content":"之前使用MySQL函数用来截取字符串使用的是SUBSTR函数，今天这节课新学了一个LEFT函数。<br><br>不过就像右耳朵猫咪同学评论说的那样，对查询字段使用函数不恰当的话，有可能导致查询效率变慢。我的理解是索引失效。<br><br>发现老师每篇内容都是言简意赅，实操性较强。适合当一个日常开发的工具书，随时查阅。","like_count":0}]}