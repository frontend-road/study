{"id":308078,"title":"开篇词 | 一个态度两个步骤，成为容器实战高手","content":"<p>你好，我是李程远，欢迎你加入我的极客时间专栏。从今天开始，我想和你聊一聊，怎么解决容器里的各种问题。</p><p>先来介绍一下我自己吧。我毕业于浙江大学计算机系，第一份工作是开发基于Xen的Linux虚拟机，接下来的十几年，我的工作始终围绕着Linux系统。</p><p>在2013年，我加入eBay，从事云平台方面的工作，最先接触的是OpenStack云平台。</p><p>一直到了2015年的时候，我们的团队开始做Kubernetes，要用Kubernetes来管理eBay整个云平台。我们需要迁移所有eBay的应用程序，把它们从原来的物理机或者虚拟机迁移到容器的环境里。</p><p>在Kubernetes具体落地的过程中，我们碰到了形形色色的容器问题。</p><p>首先，我们都知道，容器是一种轻量级的隔离技术。而轻量级隔离造成了一些<strong>行为模式</strong>的不同，比如原来运行在虚拟机里的CPU监控程序，移到容器之后，再用原来的算法计算容器CPU使用率就不适用了。</p><p>然后呢，从<strong>隔离程度</strong>这个方面考虑，CPU、memory、IO （disk and network）真的能做到精确隔离吗？</p><p>其实还是有问题的，比如想让多个用户容器运行在一个节点上，我们就需要保证，每个容器的磁盘容量在一定的限额范围内，还需要合理分配磁盘读写性能。</p><!-- [[[read_end]]] --><p>第三个方面，就是<strong>处理性能敏感的应用。</strong>容器技术的引入，会带来新的开销，那么肯定会影响性能。</p><p>比如说，原来运行在物理机上、有极高性能要求的程序，在迁移到容器后，我们还需要对容器网络做优化，对Cgroup做优化。只有做了这样的优化，我们才能保证迁移过来的程序，当它们运行在容器里的时候，性能差异控制在2%以内（当时做迁移的标准）。</p><p>另外，如果涉及高内存使用的应用，我们做迁移的时候，还要考虑PageCache、Swap，还有HugePage等等问题，在叠加了Cgroup之后，会带来新的变化。</p><p>综合来看，我们遇到的问题有的很简单，看一下源代码，写个测试代码验证一下，一两个小时就可以搞定。但有的问题却很复杂，我们需要尝试不同的测试，反复查看各种源代码，陆陆续续花费一两个月的时间解决。</p><p>通过5年的不断努力，我和我的团队逐渐把eBay所有的业务都迁移到了容器中。现在，我们的云平台上运行着百万个容器。</p><h2>怎么理解容器的知识体系？</h2><p>可以说，从我接触容器知识到能够得心应手地解决各种容器问题，这个过程还真是有点磕磕绊绊。</p><p>一开始，我被各种各样的问题所淹没，觉得容器的内容太复杂了，没有一个系统性的解决方法。我只能是见招拆招，一个个解决，就这样，随着我解决的问题越来越多，我也开始思考，是不是有一些规律性的东西。</p><p>容器问题虽然有很多类型，既有基本功能问题，也有性能问题，还有不少稳定性问题。但大部分问题，<strong>最终都会归结到Linux操作系统上。</strong></p><p>比如，容器里进程被OOM Kill了，这个OOM Killer就是Linux里常见的内存保护机制；容器的进程引起平均负载增高，而平均负载也是在Linux里被反复讨论的概念；还有，容器使用的OverlayFS系统，看上去和Linux常用的XFS、Ext4系统不同，但是它也是Linux内核维护的一种文件系统。</p><p>我们都知道，Linux操作系统不外乎是<strong>进程管理、内存管理、文件系统、网络协议栈，再加上一些安全管理。</strong>这样一梳理，容器的问题就都可以投射到Linux操作系统这些模块上了，是不是一下子感觉清晰了很多？</p><p>当然了，容器还有自己的特殊性，Linux内核原来的特性加上Namespace和Cgroups会带来的变化。</p><p>所以，我们在对应到每个模块上分析问题的时候，还需要考虑到Namespace和Cgroups。这两个概念是容器技术的基石，我们课程中要讨论的容器相关问题，多少都会和Namespace或者Cgroups相关。</p><p>总之就是一句话，<strong>我们可以结合Linux操作系统的主要模块，把容器的知识结构系统地串联起来，同时看到Namespace和Cgroups带来的特殊性。 </strong></p><p><img src=\"https://static001.geekbang.org/resource/image/e0/21/e033032867a9cff7d399871c604ae921.jpeg?wh=3200*1800\" alt=\"\"></p><h2>怎么解决容器问题？</h2><p>心中有了容器的知识体系，我们也就能在容器实践中解决具体的问题了。结合我自己这么多年的经历，我总结了一条经验，<strong>解决容器问题需要一个态度+两个步骤。</strong></p><p>在解决容器问题的过程中，我们常见的误区就是浅尝辄止，不去挖掘问题的根本原因。我之前也碰到过这种情况，接下来我就拿一个具体的例子来说明。</p><p>有一次团队一位同学问我，怎么让Kubernetes节点上的容器，从内部触发自己的容器重启啊？</p><p>我试了一下，在容器中把第1号进程杀了，然后容器退出，Kubernetes自动地把容器带回来，就能实现类似的自动重启功能了，同事试了也可以，认为问题解决了，也挺开心的。我也没有多想，以为自己找到方法了。</p><p>后来又有一个同事和我说，这样做没有效果啊。我这才发现问题没那么简单，是我想当然了。</p><p>所以，我又花时间理了理Linux信号的基本知识，trace了一下内核代码，终于让我找到了真正的原因，那就是对于发送给1号进程的信号，内核会根据不同的类型、不同的注册状态，采取不同的处理方式。</p><p>你看，这是一个挺简单的问题，就是kill一下容器里的1号进程。你或许也遇到过，如果你也和我开始时的态度一样，就很可能会错过找到真正答案的机会。这就是我说的，解决容器问题时我们需要的一个态度：不要浅尝辄止，要刨根问底。</p><p>态度有了，那如果我们在线上碰到了更加复杂的问题，又该怎么解决呢？这就需要两个步骤了。</p><p>我们的第一步，就是<strong>化繁为简，重现问题。</strong></p><p>想要做到这一点，倒推回去，还是需要我们对基本的概念足够了解。只有对每个模块的概念都很清晰，我们才能对复杂问题做拆分。</p><p>能够对问题做拆分是不是就够了呢？其实还不够，我自己有一个判断标准，就是还要能够写模拟程序，看是否可以用最简单的程序来重现问题。<strong>如果我们能用简单的代码程序重现问题，那么问题也就解决了一半。</strong></p><p>接下来我们还需要进行第二步，就是想办法<strong>把黑盒系统变成白盒系统。</strong></p><p>我在前面提到过，容器的问题大多都会归结到Linux系统上。Linux系统从内核、库函数以及服务程序上看，虽然都是开源的，但是它运行在生产环境的时候，几乎就是一个黑盒。</p><p>之所以说系统是黑盒，一方面是因为这个系统太庞大，太复杂了；另一方面，在实际运行的时候，只有很少的log会记录运行的过程和参数。所以，在出问题的时候，我们无法知道问题对应的代码，我们也不可能在生产环境中随心所欲地加debug log。</p><p>因此，我们就需要想点办法把它变成白盒，才能去排查和解决问题。具体怎么做呢？这里需要我们熟练地掌握调试工具，这样才能把某些函数变成“白盒”，从而找到复杂问题的根本原因，再对症下药。</p><p>这里我想提醒你的是，我们熟练掌握工具有个重要前提，就是从全局上去掌握Linux系统以及容器，回归到底层原理去看问题。可以说，你把基础概念吃透了，练好了“内功心法”，有了这个底子，工具运用是水到渠成的事儿。</p><h2>我是怎么设计这门课的？</h2><p>讲到这里，估计你会有个问题，这“一个态度两个步骤”很好理解啊，我也了解到了，但是怎么才能真正地掌握这些知识、拥有解决问题的思路呢？</p><p>这就是我们这门课想要实现的目标了，那就是带你走进一个个具体的案例中，体验解决问题的全过程，在实战中习得知识和技能。</p><p>所以，在这门课程里，我会把零散的知识点体系化，按照类似操作系统的模块划分，为你讲述我所理解的容器。</p><p>我们将一起学习容器进程、容器内存、容器存储、 容器网络、容器安全这几部分内容。在每一节课中，我们都会解决一个实际问题或者研究一个现象。围绕这个问题，我会为你讲解相关的知识点，并带着你结合实际的操作做理解，最终解决问题或者解释现象。</p><p>我们要实现两个学习目标。</p><p><strong>第一，系统掌握容器核心点：Namespace和Cgroups。</strong></p><p><strong>第二，理解Namespace和Cgroups对Linux原来模块的影响，看看它们是如何影响一些传统操作系统的行为。</strong></p><p>比如Memory Cgroup，对Pagecache和Swap空间有怎样的影响；再比如在proc文件系统下，我们的网络参数应用了Network Namespace之后，需要如何重新设置等等。</p><p>当我们一起把容器知识的框架搭建起来，把里面的核心概念、底层逻辑掌握之后，你其实就可以解决容器的大部分问题了。但是，我知道，你一定还有个问题，那就是工具呢？不讲了吗？我真的可以水到渠成吗？</p><p>不要着急，这里我要做个特别说明，课程结束后，我会给你做一个专题加餐。目前，我是这么设计的，我选择了一个真实案例，就是在生产环境中容器网络延时不稳定的问题。</p><p>在这个案例中，我们会用到<strong>perf，ftrace，bcc/ebpf这几个Linux调试工具</strong>，了解它们的原理，熟悉它们在调试问题的不同阶段所发挥的作用，然后用这些工具一起来解决现实场景中复杂的容器问题。</p><p>为什么一定要把这个专题放到课程结束后呢？因为我需要给你留一段消化吸收的时间，这里我安排了一个月时间。</p><p>希望你能利用这一个月，把整个课程的内容复习一遍，把基本功打扎实，你才能在专题学习里彻底掌握这几个工具，遇到类似问题时也能有清晰的解决思路，这样这个专题的学习效率也才能更高。</p><p>之所以一定要这么安排，也是想跟你表达我的一个观点，就是工具很重要，但是工具不是最重要的。</p><p>所有学习，我们一定是先掌握知识体系，一定不能陷入唯工具论的思维框架里。我知道，这样的安排似乎只是我的一家之言，但这恰恰就是我想通过这门课交付给你的，因为这些真的是我自己的经验之谈，是我的受益点。这么学看似慢了，但其实只有这样，我们走的才是捷径。</p><p><img src=\"https://static001.geekbang.org/resource/image/36/2a/36ee722764e0c3a7e1aba7999b26b52a.jpg?wh=620*2199\" alt=\"\"></p><p>好了，介绍完了课程设计和学习目标，还有一件事特别重要，我要特别提醒下。</p><p>在这个容器课程中，每一讲里都会有一些小例子，所以需要<strong>你有一台安装有Linux的机器，或者用VirtualBox安装一个虚拟机来跑Linux。Linux的版本建议是CentOS 8 或者是Ubuntu 20.04。</strong></p><p>希望你提前做好准备，这样在学习的过程中，你就能跟着我的讲解进行一些实际的操作，对容器知识也会有更加深刻的印象。</p><p>你还可以拉上身边的小伙伴，组团来学习这门课程，共同学习、互相鼓励的氛围会让你的学习体验更好。另外，有什么想法或者疑问，你都可以通过留言区和我交流、互动。</p><p>最后，我想和你说，<strong>容器是一个很好的技术窗口，它可以帮助你在这个瞬息万变的计算机世界里看到后面那些“不变”的技术，只有掌握好那些“不变”的技术，你才可以更加从容地去接受技术的瞬息万变。</strong></p><p>我希望，这个专栏能帮你打开容器这扇窗，让你看到更精彩的风景，建立起你自己的容器知识体系。从今天开始，跟着我一起搞懂容器，提升实力，吃透原理，在技术之路上一起前进吧！</p>","comments":[{"had_liked":false,"id":261772,"user_name":"JianXu","can_delete":false,"product_type":"c1","uid":1033219,"ip_address":"","ucode":"2A61BDBB573BDC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","comment_is_top":false,"comment_ctime":1605518711,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"259303556471","product_id":100063801,"comment_content":"程远是我司Linux 内核专家，也是Kubernetes Host runtime 的负责人，对于这门课我们部门的同学都非常期待。特别是最后还要加餐以生产环境中实际碰到的案例设计练习题的部分，会很有收获的。","like_count":61,"discussions":[{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"无名无姓","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554225,"discussion_content":"受益匪浅","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646274082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261780,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1605521625,"is_pvip":false,"replies":[{"id":"95021","content":"@kimoti,<br>这是一个很好的问题！我们在把eBay的一些核心应用从物理机迁移到容器的时候，很多同事也提出过同样的问题。<br><br>不过现在再回过头看，我们可以看到的好处是：<br>1，对于应用，它容器化之后，发布和部署更加方便，特别是在扩容的时候更快了。<br>2. 对于平台，我们用一套平台kubernetes来管理所有的应用，对于硬件资源的利用率得以提高。<br><br>所以容器化后，带来的好处是，开发效率的提高，资源利用率的提高。","user_name":"作者回复","comment_id":261780,"uid":"2070138","ip_address":"","utype":1,"ctime":1605538356,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"134749507801","product_id":100063801,"comment_content":"想问老师,既然容器的问题那么多为什么还要用容器技术？跑物理机不香吗？","like_count":31,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509604,"discussion_content":"@kimoti,\n这是一个很好的问题！我们在把eBay的一些核心应用从物理机迁移到容器的时候，很多同事也提出过同样的问题。\n\n不过现在再回过头看，我们可以看到的好处是：\n1，对于应用，它容器化之后，发布和部署更加方便，特别是在扩容的时候更快了。\n2. 对于平台，我们用一套平台kubernetes来管理所有的应用，对于硬件资源的利用率得以提高。\n\n所以容器化后，带来的好处是，开发效率的提高，资源利用率的提高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605538356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200666,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/1a/55aeb44e.jpg","nickname":"GhostBaby","note":"","ucode":"22D60A4EFB276F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326205,"discussion_content":"总的一句话，降本增效","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1605541979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"无名无姓","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578464,"discussion_content":"这仅仅是其中的一部分吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656784091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262326,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1605692753,"is_pvip":false,"replies":[{"id":"95196","content":"k8s是解决容器平台控制平面的问题，比如把容器调度到一个合适的宿主机上。<br>而容器一旦在宿主机上运行起来之后，它的隔离方式是否正确，资源的限制是否合理，它自身的性能是否会出问题，它是否会影响到同一个宿主机上别的容器，或者直接影响到宿主机，这些问题的考虑，就需要容器相关知识了。","user_name":"作者回复","comment_id":262326,"uid":"2070138","ip_address":"","utype":1,"ctime":1605713705,"user_name_real":"CY"}],"discussion_count":2,"race_medal":0,"score":"61735234897","product_id":100063801,"comment_content":"有了k8s 还需要这么深入的学习容器吗？","like_count":14,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509784,"discussion_content":"k8s是解决容器平台控制平面的问题，比如把容器调度到一个合适的宿主机上。\n而容器一旦在宿主机上运行起来之后，它的隔离方式是否正确，资源的限制是否合理，它自身的性能是否会出问题，它是否会影响到同一个宿主机上别的容器，或者直接影响到宿主机，这些问题的考虑，就需要容器相关知识了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605713705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452799,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","nickname":"BertGeek","note":"","ucode":"8E1D72C9F9778C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369249,"discussion_content":"武功再强，需要内功做根基","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618987562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261832,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1605533730,"is_pvip":false,"replies":[{"id":"95067","content":"@我来也，谢谢你的支持！我们可以在后面的课程里有更多的交流！","user_name":"作者回复","comment_id":261832,"uid":"2070138","ip_address":"","utype":1,"ctime":1605585401,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"57440108578","product_id":100063801,"comment_content":"# 在9月份就开始期待老师的这门课了.<br><br>当时为了在k8s中排查类似[TCP SACK 补丁导致的发送队列报文积压](https:&#47;&#47;runsisi.com&#47;2019-12-19&#47;tcp-sack-hang)的问题,<br>期间看过了老师的3篇文章:<br>[eBay云计算“网”事｜网络超时篇](https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;ZUS94PMCKsqgZFHX9b99-g)<br>[eBay云计算“网”事｜网络丢包篇](https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;IpUr3pnVgMInqKAkBfawtA)<br>[eBay云计算“网”事｜网络重传篇](https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;mN2rDdYvxRvAqKt7aiDxkQ)<br><br>后来居然在极客时间的课程表上看到了老师的名字,到现在足足期待了2个月!<br><br># 两个步骤: 化繁为简，重现问题 + 把黑盒系统变成白盒系统<br>我是非常认同的.<br>只有化繁为简,缩小了范围,才能有针对性的分析.<br>打开内核源码,将黑盒变白盒.<br>一言不合上源码,这个是我向往的,目前还遥不可及.<br><br># 期待老师的课程内容<br>之前试读过两篇文章,先睹为快,更是期待.������<br>","like_count":13,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509627,"discussion_content":"@我来也，谢谢你的支持！我们可以在后面的课程里有更多的交流！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605585401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261784,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1605523184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35965261552","product_id":100063801,"comment_content":"ebay 多高手啊","like_count":8},{"had_liked":false,"id":262626,"user_name":"Ethan Liu","can_delete":false,"product_type":"c1","uid":1070043,"ip_address":"","ucode":"231F944F7CD56A","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/db/858337e3.jpg","comment_is_top":false,"comment_ctime":1605785032,"is_pvip":true,"replies":[{"id":"95291","content":"目前还没有。","user_name":"作者回复","comment_id":262626,"uid":"2070138","ip_address":"","utype":1,"ctime":1605791019,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"18785654216","product_id":100063801,"comment_content":"能对GPU使用cgroup和namespace吗？","like_count":4,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509903,"discussion_content":"目前还没有。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605791019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"无名无姓","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578465,"discussion_content":"现在应该已经支持了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656784164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356088,"discussion_content":"什么时候可以支持哦?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615529327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262388,"user_name":"光","can_delete":false,"product_type":"c1","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1605704966,"is_pvip":true,"replies":[{"id":"95192","content":"@光，这是一个很好的问题。<br>对于运行在kubernetes平台上的容器，其实如果可以用network volume那是最好的，这样可以做到了存储与计算分离，从系统的稳定性与维护的方便性来说都是最好的选择。不过有个前提是，需要你们自己有能力维护ceph cluster的能力。<br>用本地存储最大的好处应该是I&#47;O latency低，不过这个也要看你的应用的需求。<br><br>local PV动态扩容也是有机会的，如果local PV是基于lvm, 还是可以做一定程度的扩容，不过上限还是本地所有磁盘的容量。","user_name":"作者回复","comment_id":262388,"uid":"2070138","ip_address":"","utype":1,"ctime":1605713080,"user_name_real":"CY"}],"discussion_count":2,"race_medal":0,"score":"18785574150","product_id":100063801,"comment_content":"很期待这个课程，老师我有个实际问题问下，目前我们有些数据库需要容器化但是考虑存储性能问题最终选了localpv 方式，但是我发现这个方式存储类没法后续动态扩容，又考虑使用SSD 硬盘通过rook operator 自建ceph 存储。不知道这方面老师有什么建议——包括存储选型以及数据库本身在K8S 容器化中的一些其他性能建议。","like_count":4,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509814,"discussion_content":"@光，这是一个很好的问题。\n对于运行在kubernetes平台上的容器，其实如果可以用network volume那是最好的，这样可以做到了存储与计算分离，从系统的稳定性与维护的方便性来说都是最好的选择。不过有个前提是，需要你们自己有能力维护ceph cluster的能力。\n用本地存储最大的好处应该是I/O latency低，不过这个也要看你的应用的需求。\n\nlocal PV动态扩容也是有机会的，如果local PV是基于lvm, 还是可以做一定程度的扩容，不过上限还是本地所有磁盘的容量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605713080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284618,"avatar":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","nickname":"光","note":"","ucode":"BDA7F41566E4FE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327084,"discussion_content":"我们有些不敏感的状态应用会用nas之类的。只是个别的场景无法满足。但是localpv用的额外daemonset  provider没用办法动态扩容pvc。本身挂载磁盘是可以扩容的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605746756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261892,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1605572437,"is_pvip":false,"replies":[{"id":"95066","content":"是的，技术是想通的 :-)","user_name":"作者回复","comment_id":261892,"uid":"2070138","ip_address":"","utype":1,"ctime":1605585134,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"18785441621","product_id":100063801,"comment_content":"一个态度<br>不要浅尝辄止，要刨根问底<br><br>两个步骤<br>1化繁为简，重现问题<br>2想办法把黑盒系统变成白盒系统<br><br>这个方法同样适用其他地方","like_count":5,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509656,"discussion_content":"是的，技术是想通的 :-)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605585134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/b3/194f7f90.jpg","nickname":"没伞的孩子得使劲奔跑","note":"","ucode":"D015B4EF12E536","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327983,"discussion_content":"在哪都能看到你啊👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606034243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1004698,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","nickname":"每天晒白牙","note":"","ucode":"A1B102CD933DEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1145779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/b3/194f7f90.jpg","nickname":"没伞的孩子得使劲奔跑","note":"","ucode":"D015B4EF12E536","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":327991,"discussion_content":"打扰了😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606037537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327983,"ip_address":""},"score":327991,"extra":""}]}]},{"had_liked":false,"id":289354,"user_name":"BertGeek","can_delete":false,"product_type":"c1","uid":1452799,"ip_address":"","ucode":"8E1D72C9F9778C","user_header":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","comment_is_top":false,"comment_ctime":1618988072,"is_pvip":false,"replies":[{"id":"105122","content":"可以参考一下kubeneters liveness probe 以及 node problem detctor的检测方式，比如:<br>1. 对容器中服务端口的定期检测，<br>2.在宿主机上启动一个daemon来检测docker容器的状态。<br><br>检测出问题之后，定义可以再定一个统一的remediation策略来自动修复。","user_name":"作者回复","comment_id":289354,"uid":"2070138","ip_address":"","utype":1,"ctime":1619269844,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"14503889960","product_id":100063801,"comment_content":"一套系统通过不同容器互相依赖实现系统可用，如何发布和管控这些容器<br>1. 如果某个容器宕机了，可以自动重启<br>2. 如果这套系统，某个容器非up状态，如何发现<br>3. 目前没用到K8，应用只是通过docker 容器运行<br><br>希望听听老师高见。非常期待，谢谢！","like_count":3,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518888,"discussion_content":"可以参考一下kubeneters liveness probe 以及 node problem detctor的检测方式，比如:\n1. 对容器中服务端口的定期检测，\n2.在宿主机上启动一个daemon来检测docker容器的状态。\n\n检测出问题之后，定义可以再定一个统一的remediation策略来自动修复。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619269844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262369,"user_name":"hadoop_admin","can_delete":false,"product_type":"c1","uid":1300466,"ip_address":"","ucode":"7EAFA775505C7E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGMphabeneYXs9otkAtr67RvxJClDa7jPe7w8yExg4YaS2FGJruDKMj5yN1E90o6MFibnicH8gM0ibg/132","comment_is_top":false,"comment_ctime":1605700747,"is_pvip":false,"replies":[{"id":"95189","content":"希望这门课可以帮到你","user_name":"作者回复","comment_id":262369,"uid":"2070138","ip_address":"","utype":1,"ctime":1605710462,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"10195635339","product_id":100063801,"comment_content":"公司最近需要上docker和kube了，一头雾水呀，linux 知识薄弱，以前弄hadoop 运维，希望能在这里入门","like_count":3,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509805,"discussion_content":"希望这门课可以帮到你","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605703536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261782,"user_name":"上邪忘川","can_delete":false,"product_type":"c1","uid":1276588,"ip_address":"","ucode":"1C4459917B038D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","comment_is_top":false,"comment_ctime":1605522030,"is_pvip":false,"replies":[{"id":"95020","content":"@ 上邪忘川<br>&gt; 最后一句话太好了<br>谢谢你的认同。<br><br>&gt; 我在容器中目前比较疑惑的是容器和firewall(centos7)的关系。比如开启一个80端口的nginx容器，然后关闭firewall，清空nat规则，依旧能访问nginx容器<br><br>对于你的这个问题， 我想你这里说的firewall应该是iptables。至于 iptables nat rules, 清空之后，如何可以访问到容器中的80端口，这个需要看几个方面：<br>1. 容器的Network Namespace的配置，容器的IP地址和宿主机是一样的吗？<br>2. 容器的接口配置和宿主机上的交互方式？不一定是用nat方式<br>3. 是从哪里访问访问容器的80端口的？宿主机上还是宿主机外？<br><br>你可以提供一些更详细的信息。<br><br>还有这些问题， 我在容器网络这一章里都会讲解，到时候我们可以做更加深入的分析。","user_name":"作者回复","comment_id":261782,"uid":"2070138","ip_address":"","utype":1,"ctime":1605538309,"user_name_real":"CY"}],"discussion_count":4,"race_medal":0,"score":"10195456622","product_id":100063801,"comment_content":"最后一句话太好了，我在容器中目前比较疑惑的是容器和firewall(centos7)的关系。比如开启一个80端口的nginx容器，然后关闭firewall，清空nat规则，依旧能访问nginx容器","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509605,"discussion_content":"@ 上邪忘川\n&amp;gt; 最后一句话太好了\n谢谢你的认同。\n\n&amp;gt; 我在容器中目前比较疑惑的是容器和firewall(centos7)的关系。比如开启一个80端口的nginx容器，然后关闭firewall，清空nat规则，依旧能访问nginx容器\n\n对于你的这个问题， 我想你这里说的firewall应该是iptables。至于 iptables nat rules, 清空之后，如何可以访问到容器中的80端口，这个需要看几个方面：\n1. 容器的Network Namespace的配置，容器的IP地址和宿主机是一样的吗？\n2. 容器的接口配置和宿主机上的交互方式？不一定是用nat方式\n3. 是从哪里访问访问容器的80端口的？宿主机上还是宿主机外？\n\n你可以提供一些更详细的信息。\n\n还有这些问题， 我在容器网络这一章里都会讲解，到时候我们可以做更加深入的分析。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605538309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"莫名","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326662,"discussion_content":"iptables 规则手工清理也没关系，docker-proxy 会定期更新，不过清理之后、更新之前会影响使用。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605658199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1276588,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","nickname":"上邪忘川","note":"","ucode":"1C4459917B038D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"莫名","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326894,"discussion_content":"学习了，还有更新机制，不过我是清理完后立刻去通信的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605694694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326662,"ip_address":""},"score":326894,"extra":""}]},{"author":{"id":1276588,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","nickname":"上邪忘川","note":"","ucode":"1C4459917B038D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326588,"discussion_content":"感觉老师的回复，我雀写了一篇文档记录了实验过程和实验信息。写的比较粗糙，还望老师不要建议，链接如下：\nhttps://www.yuque.com/docs/share/d1cedbc0-66f6-4ea5-b301-6a18848a4e4b?# 《关于docker与firewalld的一些疑惑》","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605621680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263526,"user_name":"Wen","can_delete":false,"product_type":"c1","uid":1367387,"ip_address":"","ucode":"892CB242BA9C04","user_header":"https://static001.geekbang.org/account/avatar/00/14/dd/5b/5461afad.jpg","comment_is_top":false,"comment_ctime":1606170958,"is_pvip":false,"replies":[{"id":"95628","content":"@Wen,<br>你有Linux的操作经验，学习操作容器应该会很快的。 <br>你可以先练习一些容器的基本操作后，再来学习这门课。<br>","user_name":"作者回复","comment_id":263526,"uid":"2070138","ip_address":"","utype":1,"ctime":1606190837,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"5901138254","product_id":100063801,"comment_content":"李老师您好，我有两年的linux运维工作经验，目前做的是互联网产品售后的工作，容器基本是零基础，这个专栏适合我这样零基础学习吗？我以后目标是从事运维开发的工作，想从容器开始","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510224,"discussion_content":"@Wen,\n你有Linux的操作经验，学习操作容器应该会很快的。 \n你可以先练习一些容器的基本操作后，再来学习这门课。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606190837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262607,"user_name":"Sam_bo","can_delete":false,"product_type":"c1","uid":1155916,"ip_address":"","ucode":"888F4117855CF2","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/4c/ae84f80e.jpg","comment_is_top":false,"comment_ctime":1605778254,"is_pvip":false,"replies":[{"id":"95292","content":"@sam_bo, 谢谢你的建议，在完成这个基本课程的内容后，我再想一想。","user_name":"作者回复","comment_id":262607,"uid":"2070138","ip_address":"","utype":1,"ctime":1605791106,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"5900745550","product_id":100063801,"comment_content":"希望老师能加餐一些应用切换到容器的思路和套路总结之类的课程，感激不尽","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509894,"discussion_content":"@sam_bo, 谢谢你的建议，在完成这个基本课程的内容后，我再想一想。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605791106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262094,"user_name":"王建","can_delete":false,"product_type":"c1","uid":1153792,"ip_address":"","ucode":"68000818D8AA41","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/00/8c1b9631.jpg","comment_is_top":false,"comment_ctime":1605609515,"is_pvip":false,"replies":[{"id":"95096","content":"@王建，<br>可以share一下你的源代码吗？<br>是先调用ftok()生成key的吗？shmget返回失败的话，errno是什么？","user_name":"作者回复","comment_id":262094,"uid":"2070138","ip_address":"","utype":1,"ctime":1605627959,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"5900576811","product_id":100063801,"comment_content":"老师问题来了<br>COPY test  &#47;APP<br><br><br>然后调用<br>shmget  以&#47;APP&#47;test  为键值调用不成功，在裸机上是可以的！","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509691,"discussion_content":"@王建，\n可以share一下你的源代码吗？\n是先调用ftok()生成key的吗？shmget返回失败的话，errno是什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605627959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328864,"discussion_content":"这里返回的shmid应该就是0吧， errno也是正常的。\n看shmget man,  应该是shmget只是返回-1 是表示出错，0不是出错。\n\nOn success, a valid shared memory identifier is returned.  On error, -1 is returned, and errno is set to indicate the error.\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606264132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1153792,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9b/00/8c1b9631.jpg","nickname":"王建","note":"","ucode":"68000818D8AA41","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326796,"discussion_content":"#include <stdio.h>\n#include <string.h>\n#include <errno.h>\n#include <sys/ipc.h>\n#include <sys/shm.h>\n\nint getShm();\n\nint main(int argc, char *argv[]){\n    getShm();\n}\n\nint getShm()\n{\n    int shmid;\n    char path[100] = &#34;/APP/testdir&#34;;\n    shmid = shmget(ftok(path, 0x6666), sizeof(int), 0666|IPC_CREAT);\n    if(shmid <= 0)\n    {\n        printf(&#34;shmget %s error! [%d][%s]\\n&#34;, path, errno, strerror(errno) );\n        return -1;\n    }else{\n        printf(&#34;success :%s %d %d\\n&#34;, __FILE__, __LINE__, shmid);\n    }\n\n    return 0;\n}\n\n\n///////////////////Dockerfile//////////////\nFROM ubuntu:16.04\nCOPY ./testdir /APP/testdir\nCMD /APP/testdir/main\n\ndocker run --rm test_shmget\n\n////////////////////////结果//////////////\nshmget /APP/testdir error! [0][Success]\n\n\n裸机上正常\nsuccess :main.c 77 48922668\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605678662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261912,"user_name":"宋晓明","can_delete":false,"product_type":"c1","uid":1146507,"ip_address":"","ucode":"DC866DCE2FBA9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/8b/3cc461b3.jpg","comment_is_top":false,"comment_ctime":1605576743,"is_pvip":false,"replies":[{"id":"95064","content":"audit 是需要的。不过audit是通用的，不光是用在容器系统里，由于时间的关系，我只挑了两个topic介绍。","user_name":"作者回复","comment_id":261912,"uid":"2070138","ip_address":"","utype":1,"ctime":1605585074,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"5900544039","product_id":100063801,"comment_content":"容器安全就是root权限吗？公司在上容器，还需要命令审计有这个必要吗，","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509664,"discussion_content":"audit 是需要的。不过audit是通用的，不光是用在容器系统里，由于时间的关系，我只挑了两个topic介绍。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605585074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261904,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1605574523,"is_pvip":false,"replies":[{"id":"95065","content":"eBay是私有云","user_name":"作者回复","comment_id":261904,"uid":"2070138","ip_address":"","utype":1,"ctime":1605585102,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"5900541819","product_id":100063801,"comment_content":"请问老师eBay的云平台是公司自己的私有云吗？不是用AWS之类的公有云平台？","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509661,"discussion_content":"eBay是私有云","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605585102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360647,"user_name":"Codehacker1030","can_delete":false,"product_type":"c1","uid":3169308,"ip_address":"北京","ucode":"199942EA47B441","user_header":"","comment_is_top":false,"comment_ctime":1666711579,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666711579","product_id":100063801,"comment_content":"期待","like_count":0},{"had_liked":false,"id":354848,"user_name":"事已至此开始撤退","can_delete":false,"product_type":"c1","uid":2901316,"ip_address":"广东","ucode":"1076FDF53DA81D","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/44/8df79d3c.jpg","comment_is_top":false,"comment_ctime":1660820154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660820154","product_id":100063801,"comment_content":"讲的很好","like_count":0},{"had_liked":false,"id":353171,"user_name":"Lena","can_delete":false,"product_type":"c1","uid":3076276,"ip_address":"上海","ucode":"17DEB3659A0BAF","user_header":"https://static001.geekbang.org/account/avatar/00/2e/f0/b4/0dc11892.jpg","comment_is_top":false,"comment_ctime":1659233199,"is_pvip":false,"replies":[{"id":"129207","content":"是的","user_name":"作者回复","comment_id":353171,"uid":"2070138","ip_address":"上海","utype":1,"ctime":1661084822,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1659233199","product_id":100063801,"comment_content":"这是要有容器基础和实践的同学才能看懂的吗<br>","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584755,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661084822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351184,"user_name":"Jasper","can_delete":false,"product_type":"c1","uid":1202174,"ip_address":"","ucode":"A07ABF45D39089","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/fe/beab006d.jpg","comment_is_top":false,"comment_ctime":1657596641,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657596641","product_id":100063801,"comment_content":"2022打卡","like_count":0},{"had_liked":false,"id":337211,"user_name":"InSun","can_delete":false,"product_type":"c1","uid":1650938,"ip_address":"","ucode":"2AC6612A40B52C","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/fa/cb9e8696.jpg","comment_is_top":false,"comment_ctime":1646701995,"is_pvip":false,"replies":[{"id":"123836","content":"可以指定把某个gpu分配给某个容器。https:&#47;&#47;kubernetes.io&#47;docs&#47;tasks&#47;manage-gpus&#47;scheduling-gpus&#47;","user_name":"作者回复","user_name_real":"编辑","uid":"2070138","ctime":1647784619,"ip_address":"","comment_id":337211,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646701995","product_id":100063801,"comment_content":"老师好，namespace可以对计算机上的任何硬件做隔离么，比如GPU资源，在多卡的机器上，能否指定某个GPU对指定的容器可见？","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557387,"discussion_content":"可以指定把某个gpu分配给某个容器。https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647784619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332880,"user_name":"Lu | SSEINFO","can_delete":false,"product_type":"c1","uid":1045848,"ip_address":"","ucode":"389B5493CCEA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/58/9ee22cda.jpg","comment_is_top":false,"comment_ctime":1643782581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643782581","product_id":100063801,"comment_content":"一个态度+两个步骤<br>态度：刨根问底<br>步骤一：化繁为简，重现问题<br>步骤二：学会调试，白盒分析","like_count":0},{"had_liked":false,"id":312550,"user_name":"米 虫","can_delete":false,"product_type":"c1","uid":1073087,"ip_address":"","ucode":"6F35AA8BB8195B","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/bf/4bd3eb4b.jpg","comment_is_top":false,"comment_ctime":1631861447,"is_pvip":false,"replies":[{"id":"113236","content":"希望你能持之以恒，不虚此行，加油～","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1631869228,"ip_address":"","comment_id":312550,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1631861447","product_id":100063801,"comment_content":"打开第一天，提醒自己 慢慢学不要急。","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527017,"discussion_content":"希望你能持之以恒，不虚此行，加油～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631869228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304835,"user_name":"robin","can_delete":false,"product_type":"c1","uid":1072810,"ip_address":"","ucode":"34E675ECE244BB","user_header":"https://static001.geekbang.org/account/avatar/00/10/5e/aa/b29ee77d.jpg","comment_is_top":false,"comment_ctime":1627634346,"is_pvip":false,"replies":[{"id":"110980","content":"@robin,<br>如果你在容器中用kill 1可以满足你的需求，那么可以继续用。<br>当然你的程序&#47;平台可以往cloud native演进，更好的方式是通过平台来删除&#47;重建container, 比如kubectl delete pod","user_name":"作者回复","user_name_real":"CY","uid":"2070138","ctime":1628605709,"ip_address":"","comment_id":304835,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627634346","product_id":100063801,"comment_content":"老师，容器内部重启是咋操作的啊？我现在也是kill 1号进程，请教正确的操作，谢谢","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524177,"discussion_content":"@robin,\n如果你在容器中用kill 1可以满足你的需求，那么可以继续用。\n当然你的程序/平台可以往cloud native演进，更好的方式是通过平台来删除/重建container, 比如kubectl delete pod","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628605709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267945,"user_name":"戴斌","can_delete":false,"product_type":"c1","uid":1119385,"ip_address":"","ucode":"7DC53BEA432217","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/99/5b1ed92b.jpg","comment_is_top":false,"comment_ctime":1608001904,"is_pvip":false,"replies":[{"id":"97458","content":"我们在去年年初就从docker全面切换到了containerd, 我们工作记录在下面的这个blog中。<br>https:&#47;&#47;www.infoq.cn&#47;article&#47;odslclsjvo8bnx*mbrbk","user_name":"作者回复","user_name_real":"CY","uid":"2070138","ctime":1608216162,"ip_address":"","comment_id":267945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1608001904","product_id":100063801,"comment_content":"k8s放弃了Docker，能不在后文件介绍Docker和Containerd的实际使用差异、原理上的差异，以及后续学习的建议？","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511800,"discussion_content":"我们在去年年初就从docker全面切换到了containerd, 我们工作记录在下面的这个blog中。\nhttps://www.infoq.cn/article/odslclsjvo8bnx*mbrbk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608216162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266126,"user_name":"奇奇","can_delete":false,"product_type":"c1","uid":1399097,"ip_address":"","ucode":"BC86B0CB55E35A","user_header":"","comment_is_top":false,"comment_ctime":1607177932,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1607177932","product_id":100063801,"comment_content":"如果是windows容器怎么办呀","like_count":0},{"had_liked":false,"id":261847,"user_name":"Marionxue","can_delete":false,"product_type":"c1","uid":1367781,"ip_address":"","ucode":"72FBDC3B324BF5","user_header":"https://static001.geekbang.org/account/avatar/00/14/de/e5/701d67ca.jpg","comment_is_top":false,"comment_ctime":1605537117,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605537117","product_id":100063801,"comment_content":"打卡学习，浙江大学计算机好厉害👍🏻","like_count":0},{"had_liked":false,"id":261844,"user_name":"胡涛","can_delete":false,"product_type":"c1","uid":1035039,"ip_address":"","ucode":"D165BC94F8B1CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cb/1f/5838711e.jpg","comment_is_top":false,"comment_ctime":1605536681,"is_pvip":false,"replies":[{"id":"95055","content":"也可以的","user_name":"作者回复","user_name_real":"CY","uid":"2070138","ctime":1605572975,"ip_address":"","comment_id":261844,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605536681","product_id":100063801,"comment_content":"可以用centos7.6吗？","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509634,"discussion_content":"也可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605572975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}