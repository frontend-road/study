{"id":733984,"title":"02ï½œåˆå‡ºèŒ…åºï¼šæ„é€ ä¸€ä¸ªæç®€çš„HttpServer","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­å­¦ä¹ æ‰‹å†™ MiniTomcatï¼Œä»è¿™é‡Œå¼€å§‹è¦åŒæ­¥å†™ä»£ç äº†ã€‚</p><p>ä¸MiniSpringç›¸åŒï¼Œæˆ‘ä»¬ä¹Ÿä¼šä»ä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºå¼€å§‹ï¼Œä¸€æ­¥æ­¥åœ°æ¼”åŒ–è¿­ä»£ï¼Œæœ€ç»ˆå®ç°Tomcatçš„æ ¸å¿ƒåŠŸèƒ½ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥æ„é€ ç¬¬ä¸€ä¸ªç®€å•çš„WebæœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/91/80/919b493e16b8853a763d1f7997404880.png?wh=2190x972\" alt=\"\"></p><p>å¯ä»¥çœ‹å‡ºï¼Œå½“ç”¨æˆ·ä»æµè§ˆå™¨è¿™ç«¯å‘èµ·ä¸€ä¸ªé™æ€çš„è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªæç®€HTTP Serverä»…ä»…æ˜¯ç®€å•åœ°å°†æœ¬åœ°çš„é™æ€æ–‡ä»¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¹Ÿæ­£æ˜¯æˆ‘ä»¬æ‰‹å†™MiniTomcatçš„ç¬¬ä¸€æ­¥ã€‚</p><h2>Webè¯·æ±‚æµç¨‹</h2><p>ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯è¦æŒ‰ç…§HTTPåè®®çš„è§„èŒƒå¤„ç†å‰ç«¯å‘è¿‡æ¥çš„Requestå¹¶è¿”å›Responseã€‚åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬è®¡åˆ’è¯·æ±‚ <code>http://localhost:8080/test.txt</code> è¿™ä¸ªåœ°å€ï¼Œå®ç°ä¸€ä¸ªæœ€ç®€å•çš„Webåº”ç”¨æœåŠ¡å™¨ã€‚</p><p>æˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘é¡µåœ°å€ï¼Œé”®å…¥å›è½¦çš„é‚£ä¸€åˆ»ï¼Œä»è¯·æ±‚å¼€å§‹åˆ°è¯·æ±‚ç»“æŸè¿™ä¸ªè¿‡ç¨‹ä¼šç»å†å‡ æ­¥ã€‚</p><ol>\n<li>DNSè§£æï¼Œå°†åŸŸåè§£æä¸ºIPåœ°å€ã€‚</li>\n<li>ä¸ç›®æ ‡ç«¯å»ºç«‹TCPè¿æ¥ã€‚</li>\n<li>å‘é€HTTPè¯·æ±‚ã€‚</li>\n<li>æœåŠ¡å™¨è§£æHTTPè¯·æ±‚å¹¶è¿”å›å¤„ç†åçš„æŠ¥æ–‡ã€‚</li>\n<li>æµè§ˆå™¨è§£æè¿”å›çš„æŠ¥æ–‡å¹¶æ¸²æŸ“é¡µé¢ã€‚</li>\n<li>TCPè¿æ¥æ–­å¼€ã€‚</li>\n</ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤šè¯¸å¦‚ä¸‰æ¬¡æ¡æ‰‹ï¼ŒDNSè§£æé¡ºåºç­‰å…·ä½“æŠ€æœ¯ç»†èŠ‚ï¼Œå› ä¸ºä¸æ˜¯è¿™èŠ‚è¯¾çš„ä¸»è¦è®ºé¢˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†è¯¦ç»†è¯´æ˜ã€‚åœ¨ä¸Šè¿°Webè¯·æ±‚æµç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨â€œå‘é€HTTPè¯·æ±‚â€â€œæœåŠ¡å™¨è§£æHTTPè¯·æ±‚å¹¶è¿”å›å¤„ç†åçš„æŠ¥æ–‡â€ä»¥åŠâ€œæµè§ˆå™¨è§£æè¿”å›çš„æŠ¥æ–‡å¹¶æ¸²æŸ“é¡µé¢â€è¿™ä¸‰æ­¥ã€‚</p><!-- [[[read_end]]] --><h2>é¡¹ç›®ç»“æ„</h2><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰é¡¹ç›®çš„ç»“æ„ï¼Œä¸ºå‡å°‘é˜…è¯»Tomcatå®é™…æºç çš„éšœç¢ï¼Œé¡¹ç›®ç»“æ„ä»¥åŠç±»çš„åå­—ä¼šä»¿ç…§Tomcatæºç ä¸­çš„å®šä¹‰ã€‚ä½œä¸ºèµ·æ­¥ï¼Œåœ¨è¿™èŠ‚è¯¾ä¸­é¡¹ç›®ç»“æ„ç®€å•å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ server\nâ”‚  â”‚  â”œâ”€ HttpServer.java\nâ”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”œâ”€ Response.java\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ hello.txt\n</code></pre><p>å’Œåº”ç”¨æœåŠ¡å™¨æœ‰å…³çš„ä»£ç æ”¾åœ¨ <code>src/server</code> ç›®å½•ä¸‹ï¼Œè€Œwebrootç›®å½•ä¸‹ç›®å‰æ”¾äº†ä¸€ä¸ªåå«hello.txtçš„æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™ä¸ªç›®å½•ä¸‹è®¡åˆ’å­˜æ”¾è¿”å›ç»™æµè§ˆå™¨çš„é™æ€èµ„æºã€‚</p><h2>Requestè¯·æ±‚ç±»</h2><p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œå°è¯•è¾“å…¥ <code>http://localhost:8080/hello.txt</code>ï¼Œ çœ‹çœ‹è¯·æ±‚å‚æ•°æœ‰å“ªäº›å†…å®¹ã€‚</p><pre><code class=\"language-plain\">GET /hello.txt HTTP/1.1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nCache-Control: max-age=0\nConnection: keep-alive\nHost: localhost:8080\nSec-Fetch-Dest: document\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\nsec-ch-ua: \"Google Chrome\";v=\"113\", \"Chromium\";v=\"113\", \"Not-A.Brand\";v=\"24\"\n</code></pre><p>ä»¥ä¸Šæ˜¯HTTPåè®®è§„å®šçš„è¯·æ±‚æ ‡å‡†æ ¼å¼ã€‚ç”±ä¸Šè¿°å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œè¯·æ±‚æŒ‰è¡Œåˆ’åˆ†ï¼Œé¦–å…ˆå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šç¬¬ä¸€è¡Œä¸å…¶ä»–è¡Œã€‚ç¬¬ä¸€è¡Œçš„å†…å®¹ä¸­åŒ…å«è¯·æ±‚æ–¹æ³•ï¼ˆGETï¼‰ã€è¯·æ±‚è·¯å¾„ï¼ˆ/hello.txtï¼‰ã€ä½¿ç”¨çš„åè®®ä»¥åŠç‰ˆæœ¬ï¼ˆHTTP/1.1ï¼‰ã€‚ä»ç¬¬ä¸€è¡Œå¾€ä¸‹å°±æ˜¯å…·ä½“çš„è¯·æ±‚å¤´äº†ï¼Œä»¥Key-Valueé”®å€¼å¯¹çš„å½¢å¼æŒ‰è¡Œåˆ—å‡ºã€‚ä¸€èˆ¬å…³æ³¨è¾ƒå¤šçš„Keyæ˜¯Acceptã€Hostã€Content-Typeã€Authorizationç­‰ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å°±æœ‰äº†ä½œä¸ºå‚è€ƒçš„Requestç¤ºä¾‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å‚è€ƒæ ‡å‡†æ ¼å¼ï¼Œå¯¹Requestå‚æ•°è¿›è¡Œè§£æï¼Œæå–æˆ‘ä»¬éœ€è¦çš„å…³é”®å…ƒç´ ä¸ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬å®šä¹‰Request.javaç±»ï¼Œç”¨æ¥æ„é€ è¯·æ±‚å‚æ•°å¯¹è±¡ã€‚</p><pre><code class=\"language-java\">package src.server;\npublic class Request {\n    private InputStream input;\n    private String uri;\n    public Request(InputStream input) {\n        this.input = input;\n    }\n    public void parse() {\n        StringBuffer request = new StringBuffer(2048);\n        int i;\n        byte[] buffer = new byte[2048];\n        try {\n            i = input.read(buffer);\n        } catch (IOException e) {\n            e.printStackTrace();\n            i = -1;\n        }\n        for (int j = 0; j &lt; i; j++) {\n            request.append((char) buffer[j]);\n        }\n        uri = parseUri(request.toString());\n    }\n    private String parseUri(String requestString) {\n        int index1, index2;\n        index1 = requestString.indexOf(' ');\n        if (index1 != -1) {\n            index2 = requestString.indexOf(' ', index1 + 1);\n            if (index2 &gt; index1) return requestString.substring(index1 + 1, index2);\n        }\n        return null;\n    }\n    public String getUri() {\n        return uri;\n    }\n}\n</code></pre><p>Requestç±»ä¸­ç›®å‰æœ‰ä¸¤ä¸ªåŸŸï¼Œä¸€ä¸ªæ˜¯inputï¼Œç±»å‹ä¸ºInputStreamï¼Œå¦å¤–ä¸€ä¸ªæ˜¯URIï¼Œç±»å‹ä¸ºStringã€‚æˆ‘ä»¬å¸Œæœ›ä»¥æ­¤æ¥æ”¶è¯·æ±‚æ¥çš„è¾“å…¥æµï¼Œå¹¶æå–å‡ºå…¶ä¸­çš„URIæ¥ã€‚å› æ­¤ï¼ŒRequestå¯¹è±¡å¿…é¡»ç”±ä¼ å…¥çš„InputStreamè¿™ä¸€è¾“å…¥æµå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨Requestç±»ä¸­ï¼Œæœ€æ ¸å¿ƒçš„å½“æ•° <code>parse()</code> æ–¹æ³•ï¼Œä¸»è¦çš„å·¥ä½œéƒ½ç”±è¿™ä¸ªè¿‡ç¨‹å®Œæˆã€‚</p><p>åœ¨ <code>parse()</code> æ–¹æ³•ä¸­ï¼Œä¸»è¦å°†I/Oçš„è¾“å…¥æµè½¬æ¢æˆå›ºå®šçš„è¯·æ±‚æ ¼å¼ï¼ˆå‚è§å‰é¢åˆ—å‡ºçš„è¯·æ±‚ç±»ï¼‰ã€‚InputStreamå…ˆç”¨byteæ•°ç»„æ¥æ”¶ï¼Œæ‰§è¡Œ <code>input.read(buffer)</code> åï¼Œinputçš„å†…å®¹ä¼šè½¬æ¢æˆbyteæ•°ç»„ï¼Œå¡«å……bufferã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼è¡¨ç¤ºå†™å…¥bufferä¸­çš„æ€»å­—èŠ‚æ•°ï¼ˆä»£ç ä¸­çš„2048ï¼‰ã€‚éšåå°†byteæ•°ç»„çš„å†…å®¹é€šè¿‡å¾ªç¯æ‹¼æ¥è‡³StringBufferä¸­ï¼Œè½¬æ¢æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„è¯·æ±‚æ ¼å¼ã€‚</p><p>ç„¶åæˆ‘ä»¬ç”¨parseUriæ–¹æ³•ï¼Œè·å–Uriã€‚</p><pre><code class=\"language-java\">&nbsp; private String parseUri(String requestString) {\n&nbsp; &nbsp; int index1, index2;\n&nbsp; &nbsp; index1 = requestString.indexOf(' ');\n&nbsp; &nbsp; if (index1 != -1) {\n&nbsp; &nbsp; &nbsp; index2 = requestString.indexOf(' ', index1 + 1);\n&nbsp; &nbsp; &nbsp; if (index2 &gt; index1)\n&nbsp; &nbsp; &nbsp; &nbsp; return requestString.substring(index1 + 1, index2);\n&nbsp; &nbsp; }\n&nbsp; &nbsp; return null;\n&nbsp; }\n</code></pre><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒHTTPåè®®è§„å®šï¼Œåœ¨è¯·æ±‚æ ¼å¼ç¬¬ä¸€è¡Œçš„å†…å®¹ä¸­ï¼ŒåŒ…å«è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯å¾„ã€ä½¿ç”¨çš„åè®®ä»¥åŠç‰ˆæœ¬ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼åˆ†å¼€ã€‚ä¸Šè¿°ä»£ç çš„åŠŸèƒ½åœ¨äºï¼Œ<strong>è·å–ä¼ å…¥å‚æ•°ç¬¬ä¸€è¡Œä¸¤ä¸ªç©ºæ ¼ä¸­çš„ä¸€æ®µï¼Œä½œä¸ºè¯·æ±‚çš„ URIã€‚</strong>å¦‚æœæ ¼å¼ç¨å¾®æœ‰ç‚¹å‡ºå…¥ï¼Œè¿™ä¸ªè§£æå°±ä¼šå¤±è´¥ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œéµå®ˆåè®®çš„é‡è¦æ€§ã€‚</p><h2>æ„é€ æœåŠ¡å™¨</h2><p>åœ¨æ„é€ äº†HTTPè¯·æ±‚ç±»ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªHTTPè¯·æ±‚ä»¥åŠå¦‚ä½•ä¼ è¾“è¿”å›æŠ¥æ–‡çš„ã€‚</p><p>åœ¨src/serverç›®å½•ä¸‹ï¼Œå®šä¹‰HttpServer.javaç±»ã€‚</p><pre><code class=\"language-java\">package src.server;\npublic class HttpServer {\n    public static final String WEB_ROOT = System.getProperty(\"user.dir\") + File.separator + \"webroot\";\n    public static void main(String[] args) {\n        HttpServer server = new HttpServer();\n        server.await();\n    }\n    public void await() { //æœåŠ¡å™¨å¾ªç¯ç­‰å¾…è¯·æ±‚å¹¶å¤„ç†\n        ServerSocket serverSocket = null;\n        int port = 8080;\n        try {\n            serverSocket = new ServerSocket(port, 1, InetAddress.getByName(\"127.0.0.1\"));\n        } catch (IOException e) {\n            e.printStackTrace();\n            System.exit(1);\n        }\n        while (true) {\n            Socket socket = null;\n            InputStream input = null;\n            OutputStream output = null;\n            try {\n                socket = serverSocket.accept(); //æ¥æ”¶è¯·æ±‚è¿æ¥\n                input = socket.getInputStream();\n                output = socket.getOutputStream();\n                // create Request object and parse\n                Request request = new Request(input);\n                request.parse();\n                // create Response object\n                Response response = new Response(output);\n                response.setRequest(request);\n                response.sendStaticResource();\n                // close the socket\n                socket.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>main()</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ•´ä¸ªç¨‹åºçš„æ ¸å¿ƒå¯åŠ¨æ–¹æ³•ã€‚</p><pre><code class=\"language-java\">    public static void main(String[] args) {\n        HttpServer server = new HttpServer();\n        server.await();\n    }\n</code></pre><p>å¯ä»¥çœ‹åˆ°å¯åŠ¨ç±»å¾ˆç®€å•ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªHTTP Serverå¯¹è±¡åï¼Œè°ƒç”¨ <code>await()</code> æ–¹æ³•ã€‚éšåæˆ‘ä»¬çœ‹çœ‹ <code>await()</code> æ–¹æ³•å†…æœ‰ä»€ä¹ˆå¥¥ç§˜å§ï¼</p><pre><code class=\"language-java\">public void await() {\n    ServerSocket serverSocket = null;\n    int port = 8080;\n    try {\n        serverSocket = new ServerSocket(port, 1, InetAddress.getByName(\"127.0.0.1\"));\n    } catch (IOException e) {\n        e.printStackTrace();\n        System.exit(1);\n    }\n    while (true) {\n        Socket socket = null;\n        InputStream input = null;\n        OutputStream output = null;\n        try {\n            socket = serverSocket.accept();\n            input = socket.getInputStream();\n            output = socket.getOutputStream();\n            // create Request object and parse\n            Request request = new Request(input);\n            request.parse();\n            // create Response object\n            Response response = new Response(output);\n            response.setRequest(request);\n            response.sendStaticResource();\n            // close the socket\n            socket.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre><p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œæœåŠ¡å™¨ç¨‹åºã€‚å¦‚æœä½ ç†Ÿæ‚‰Javaç½‘ç»œI/Oçš„è¯ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ªServerSocketæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”ŸæˆSocketè¿æ¥ååŒ…è£…æˆRequest/Responseè¿›è¡Œå¤„ç†ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹å…·ä½“ä»£ç ã€‚</p><pre><code class=\"language-plain\">new ServerSocket(port, 1, InetAddress.getByName(\"127.0.0.1\"))\n</code></pre><p>ä½¿ç”¨ServerSocketç›‘å¬8080ç«¯å£ï¼Œä¸ºæ–¹ä¾¿æµ‹è¯•ï¼Œåœ¨è¿™ä¸ªåœ°æ–¹ç›´æ¥å†™æ­»127.0.0.1è¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ã€‚</p><p>é€šè¿‡ <code>serverSocket.accept()</code> ä¸ºæ¯ä¸€ä¸ªè¿æ¥ç”Ÿæˆä¸€ä¸ªsocketã€‚é€šè¿‡ <code>socket.getInputStream()</code> è·å–é€šè¿‡æµè§ˆå™¨ä¼ å…¥çš„è¾“å…¥æµï¼ŒåŒ…è£…æˆå‰é¢æåˆ°çš„Requestå¯¹è±¡ï¼Œè°ƒç”¨ <code>parse()</code> è§£æURIã€‚åœ¨è¿™ä¸€æ­¥æˆ‘ä»¬å®Œæˆäº†å¯¹Requestè¯·æ±‚çš„è§£æå·¥ä½œã€‚ç„¶ååˆ›å»ºä¸€ä¸ªResponseï¼Œé€šè¿‡Responseè¾“å‡ºï¼Œå…·ä½“å®ç°åé¢å†è¯´ã€‚æœ€åå…³é—­ <code>socket.close()</code>ï¼Œä¸­æ–­è¿™æ¬¡TCPè¿æ¥ï¼Œç„¶åç¨‹åºå¾ªç¯ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¿æ¥ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å°±æ„å»ºå‡ºäº†ä¸€ä¸ªæœ€ç®€å•çš„HTTP Serverï¼Œå³æ„å»ºRequest -&gt; è§£æ -&gt; æ„å»ºResponseè¾“å‡ºï¼Œè¿™æ ·æˆ‘ä»¬å°±æ¨¡æ‹Ÿå®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„Webåº”ç”¨æœåŠ¡å™¨ã€‚ç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦æ„é€ Responseå¯¹è±¡ï¼Œå°±å¯ä»¥å®Œæˆä¸€æ¬¡å®Œæ•´çš„HTTPäº¤äº’ã€‚</p><h2>Responseè¿”å›å¯¹è±¡</h2><p>å’Œæ„é€ Requestè¯·æ±‚å¯¹è±¡ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•æ¥æ„é€ Responseè¿”å›å¯¹è±¡ï¼Œå°†HTTPè¿”å›å¯¹è±¡å¤„ç†æˆæµè§ˆå™¨å¯æ¸²æŸ“ï¼Œä¾¿äºç”¨æˆ·æµè§ˆçš„æ•°æ®ã€‚</p><p>å…ˆå®šä¹‰Response.javaç±»ã€‚</p><pre><code class=\"language-java\">package src.server;\npublic class Response {\n    private static final int BUFFER_SIZE = 1024;\n    Request request;\n    OutputStream output;\n    public Response(OutputStream output) {\n        this.output = output;\n    }\n    public void setRequest(Request request) {\n        this.request = request;\n    }\n    public void sendStaticResource() throws IOException {\n        byte[] bytes = new byte[BUFFER_SIZE];\n        FileInputStream fis = null;\n        try {\n            File file = new File(HttpServer.WEB_ROOT, request.getUri());\n            if (file.exists()) {\n                fis = new FileInputStream(file);\n                int ch = fis.read(bytes, 0, BUFFER_SIZE);\n                while (ch != -1) {\n                    output.write(bytes, 0, ch);\n                    ch = fis.read(bytes, 0, BUFFER_SIZE);\n                }\n                output.flush();\n            }\n            else {\n                String errorMessage = \"HTTP/1.1 404 FIle Not Found\\r\\n\" +\n                        \"Content-Type: text/html\\r\\n\" +\n                        \"Content-Length: 23\\r\\n\" +\n                        \"\\r\\n\" +\n                        \"&lt;h1&gt;File Not Found&lt;/h1&gt;\";\n                output.write(errorMessage.getBytes());\n            }\n        }\n        catch (Exception e) {\n            System.out.println(e.toString());\n        }\n        finally {\n            if (fis != null) {\n                fis.close();\n            }\n        }\n    }\n}\n</code></pre><p>Responseç±»å’ŒRequestç±»æœ‰äº›ç±»ä¼¼ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºResponseé€šè¿‡OutputStreamè¾“å‡ºå†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨è¿™ä¸ªResponseå…¶å®åªèƒ½è¿”å›é™æ€æ–‡ä»¶æ•°æ®ã€‚åœ¨ <code>sendStaticResource()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çš„å®ç°éå¸¸ç®€å•ç²—ç³™ï¼Œå°±æ˜¯ç›´æ¥æŠŠwebrootä¸‹çš„æ–‡ä»¶å†…å®¹å®Œæ•´åœ°è¾“å‡ºäº†ã€‚</p><p>ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-java\">File file = new File(HttpServer.WEB_ROOT, request.getUri());\nif (file.exists()) {\n    fis = new FileInputStream(file);\n    int ch = fis.read(bytes, 0, BUFFER_SIZE);\n    while (ch != -1) {\n        output.write(bytes, 0, ch);\n        ch = fis.read(bytes, 0, BUFFER_SIZE);\n    }\n    output.flush();\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒResponseå®ƒå°±æ˜¯æ ¹æ®è§£æåˆ°çš„URIåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªfileï¼Œé€ä¸ªå­—èŠ‚è¯»å–fileçš„å†…å®¹ï¼Œç„¶åå†™å…¥outputé‡Œã€‚ä¸­é—´å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†ï¼Œä¹Ÿæ²¡æœ‰æŒ‰ç…§HTTPåè®®æ‹¼æ¥æ ¼å¼ä¸²ã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨åœ¨æ–‡ä»¶ä¸­å†™å‡ºå®Œæ•´çš„è¿”å›æ•°æ®æ ¼å¼ï¼Œåœ¨webrootä¸‹åˆ›å»ºhello.txtã€‚</p><pre><code class=\"language-plain\">HTTP/1.1 200 OK\nContent-Type: text/html\nContent-Length: 12\n\nHello World!\n</code></pre><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œè¿™ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹å°±æ˜¯æŒ‰ç…§HTTPè§„å®šçš„è¿”å›æ ¼å¼æ‰‹å·¥å†™å¥½çš„ã€‚å› ä¸ºè¿™æ˜¯ç¬¬ä¸€æ­¥ï¼Œå®ç°æç®€ï¼Œæˆ‘ä»¬å…ˆè¿™ä¹ˆå†™ï¼Œè¿™ä¹Ÿæ˜¯åé¢éœ€è¦ä¼˜åŒ–æ”¹é€ çš„ç‚¹ã€‚ä¸è¿‡ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ°HTTPåè®®æœ¬èº«çš„ç®€å•ï¼Œå°±æ˜¯ä¸€äº›æ–‡æœ¬å­—ç¬¦ä¸²çš„æ ¼å¼çº¦å®šã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›æ ¼å¼å’Œè¯·æ±‚æ ¼å¼æœ‰äº›ä¸ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºç¬¬ä¸€è¡Œå…ˆå±•ç¤ºåè®®åŠå…¶ç‰ˆæœ¬ï¼ˆHTTP/1.1ï¼‰ã€HTTPçŠ¶æ€ç ï¼ˆ200ï¼‰ä¸HTTPçŠ¶æ€å†…å®¹ï¼ˆOKï¼‰ã€‚åœ¨è¿”å›å¤´è®¾ç½®å®Œæ¯•åç©ºä¸€è¡Œï¼Œæ˜¾ç¤ºè¿”å›ä½“ <code>Hello World!</code>ã€‚</p><h2>æµ‹è¯•</h2><p>åœ¨ä¸Šè¿°å‡†å¤‡å·¥ä½œå®Œæ¯•åï¼Œåœ¨HttpServerç±»ä¸­è¿è¡Œ <code>main()</code> æ–¹æ³•ï¼Œç¨‹åºä¼šåœ¨æœ¬åœ°8080ç«¯å£å¯åŠ¨ä¸€ä¸ªSocketæŒç»­ç›‘å¬è¯·æ±‚ã€‚è¿™æ—¶æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­é”®å…¥ <code>http://localhost:8080/hello.txt</code>ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨é¡µé¢ä¸Šè¿”å›äº† <code>Hello Worldï¼</code>å­—æ ·ï¼Œè¯´æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªHTTPæœåŠ¡å™¨æ„å»ºæˆåŠŸäº†ï¼Œé¡ºåˆ©è¿”å›äº†hello.txtä¸­çš„è¿”å›ä½“å†…å®¹ã€‚</p><h2>å°ç»“</h2><p><img src=\"https://static001.geekbang.org/resource/image/a7/ee/a7f371690f741a6956419221766c60ee.jpg?wh=2562x2098\" alt=\"\"></p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬æ„é€ äº†ç¬¬ä¸€ä¸ªå¯è¿è¡Œçš„HttpServerã€‚æˆ‘ä»¬æŒ‰ç…§Javaç½‘ç»œç¼–ç¨‹çš„è§„ç¨‹ï¼Œå¯åŠ¨äº†ä¸€ä¸ªServerSocketåœ¨8080ç«¯å£è¿›è¡Œç›‘å¬ï¼Œå¯¹HTTPè¯·æ±‚çš„ä¼ å…¥ä¸²è¿›è¡Œäº†å°è£…ï¼Œä¸”å®ç°äº†å¯¹è¾“å…¥ä¸²çš„è§£æï¼Œæå–å‡ºäº†URIï¼Œå¹¶æ ¹æ®URIåˆ›å»ºæ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶åå†™å…¥åˆ°outputStreamä¸­ã€‚</p><p>è™½ç„¶æä¸ºç®€å•ç²—ç³™ï¼ŒåŠŸèƒ½ä¹Ÿæç®€ï¼Œä½†æ˜¯ç¡®å®æ˜¯åšåˆ°å“åº”HTTP Request -&gt; è§£æ -&gt; æ„å»ºResponseè¾“å‡ºå…¨é—­ç¯ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œè¿™ä¸ªé—­ç¯ä¸­è¯·æ±‚è¿™ä¸ªç¯èŠ‚æ˜¯ä¾é çš„æµè§ˆå™¨çš„åŠŸèƒ½ï¼Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ï¼Œå“åº”çš„æ ¼å¼ä¹Ÿæ˜¯ç”±ç”¨æˆ·è‡ªå·±åœ¨æ–‡ä»¶ä¸­å†™å¥½çš„ï¼Œä¸æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨å®Œæˆçš„ï¼Œåé¢æˆ‘ä»¬å†æ¥æ”¹è¿›ã€‚</p><p>æ³¨ï¼šç”±äºè®¸å¤šå­¦å‘˜åæ˜ GitHubä»å›½å†…è®¿é—®å¤ªæ…¢ç”šè‡³å‡ºç°è®¿é—®ä¸äº†çš„çŠ¶å†µï¼Œæˆ‘è¯·åŠ©æ‰‹å¸®æˆ‘å°†ä»£ç æ¬åˆ°å›½å†…çš„ <a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter02\">Gitee</a> ä¸Šæ¥äº†ï¼Œæ„Ÿè°¢ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„è¿™ä¸ªHTTP Serveråªèƒ½è¿”å›é™æ€èµ„æºï¼Œæ²¡æœ‰åŠ¨æ€å†…å®¹ï¼Œæ‰€ä»¥ä¸èƒ½å«åšåº”ç”¨æœåŠ¡å™¨Application Serverï¼Œé‚£ä¹ˆä»åŸç†ä¸Šå¦‚ä½•å°†å®ƒå˜æˆä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"01ï½œæŒä¹…çš„ä¼ å¥‡ï¼šTomcatçš„å‘å±•å†ç¨‹ä¸æ¡†æ¶æ¼”è¿›","id":733840},"right":{"article_title":"03ï½œåŠ¨æ€Responseï¼šæŒ‰ç…§è§„èŒƒæ„é€ è¿”å›æµ","id":734199}},"comments":[{"had_liked":false,"id":387637,"user_name":"çŒ›ç¦½ä¸æ˜¯é¸Ÿ","can_delete":false,"product_type":"c1","uid":1068707,"ip_address":"å¹¿ä¸œ","ucode":"19C1E2E558C847","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/a3/7c685adf.jpg","comment_is_top":false,"comment_ctime":1708313949,"is_pvip":false,"replies":[{"id":141239,"content":"èµğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1708491067,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":387637,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"åœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚åœ°å€å’Œå¯¹åº”å¤„ç†ç±»ã€æ–¹æ³•ã€‘çš„æ˜ å°„å…³ç³»ï¼Œç„¶ååœ¨parseè§£æå‡ºæ¥uriä¹‹åï¼Œé€šè¿‡æ˜ å°„å…³ç³»æ‰¾åˆ°å¯¹åº”çš„å¤„ç†æ–¹æ³•ã€‚","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637425,"discussion_content":"èµğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708491067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385513,"user_name":"å¬é£æœ‰ä¿¡","can_delete":false,"product_type":"c1","uid":2683430,"ip_address":"å¹¿ä¸œ","ucode":"2CCB467114FF5C","user_header":"https://static001.geekbang.org/account/avatar/00/28/f2/26/a8ac6b42.jpg","comment_is_top":false,"comment_ctime":1702863663,"is_pvip":false,"replies":[{"id":140499,"content":"è¿‡ç¨‹æ˜¯è¿™æ ·ã€‚è¿™äº›é—®é¢˜æ˜¯æ€è€ƒé¢˜ï¼Œæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œåªæ˜¯å¯å‘å¼çš„ã€‚ä»é™æ€æ–‡æœ¬åˆ°ç¨‹åºåŠ¨æ€ç”Ÿæˆï¼Œæœ€ç®€å•çš„å°±æ˜¯æä¾›ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡å™¨åŠ è½½å®ç°ç±»ï¼Œè°ƒç”¨å›ºå®šçš„æ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702903996,"ip_address":"åŒ—äº¬","comment_id":385513,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"åº”ç”¨æœåŠ¡å™¨çš„è¯ï¼Œè¦æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡å¤„ç†ç¨‹åºï¼Œæœ€åå°†ä¸šåŠ¡ç¨‹åºçš„è¾“å‡ºè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™ç§è¾“å‡ºçš„å†…å®¹æ˜¯åŠ¨æ€ç”Ÿæˆçš„ã€‚","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634014,"discussion_content":"è¿‡ç¨‹æ˜¯è¿™æ ·ã€‚è¿™äº›é—®é¢˜æ˜¯æ€è€ƒé¢˜ï¼Œæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œåªæ˜¯å¯å‘å¼çš„ã€‚ä»é™æ€æ–‡æœ¬åˆ°ç¨‹åºåŠ¨æ€ç”Ÿæˆï¼Œæœ€ç®€å•çš„å°±æ˜¯æä¾›ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡å™¨åŠ è½½å®ç°ç±»ï¼Œè°ƒç”¨å›ºå®šçš„æ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702903996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1177739,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f8/8b/74d2ab6b.jpg","nickname":"æ–œæ é’å¹´","note":"","ucode":"D7AF02B8588549","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651285,"discussion_content":"å…¶å®å¦‚æœåœ¨å¿™äºç¼–å†™ä¸šåŠ¡ä»£ç çš„åŒæ—¶åœä¸‹æ¥ï¼Œæ€è€ƒä¸€ä¸‹æ–‡æ¡£ä¸­çš„è¿™èŠ‚å†…å®¹ï¼Œä¼šè±ç„¶å¼€æœ—ï¼ŒåŸºäºæ­¤å¯ä»¥çŒœæµ‹ thymeleaf çš„å®ç°åŸç†ï¼Œä»¥åŠ JSP çš„æ¸²æŸ“é€»è¾‘ï¼Œä»¥åŠä¸ºä»€ä¹ˆç°åœ¨æ›´æ™®åŠ å‰ç«¯ Reactã€VUE çš„å•é¡µé¢ç¨‹åºï¼Œéƒ½æœ‰è¿¹å¯å¾ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726676989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385294,"user_name":"é˜¿åŠ è¥¿","can_delete":false,"product_type":"c1","uid":1181102,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"6CC27117D29D1E","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/ae/1520ad92.jpg","comment_is_top":false,"comment_ctime":1702386532,"is_pvip":false,"replies":[{"id":140434,"content":"ç»å…¸å¿…é¡»çš„ã€‚ä¸€æ­¥æ­¥è‡ªå·±å†™ä¸‹æ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702444780,"ip_address":"åŒ—äº¬","comment_id":385294,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"å‚è€ƒäº†ã€ŠHow Tomcat Worksã€‹","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633666,"discussion_content":"ç»å…¸å¿…é¡»çš„ã€‚ä¸€æ­¥æ­¥è‡ªå·±å†™ä¸‹æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702444780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387007,"user_name":"Xiaosong","can_delete":false,"product_type":"c1","uid":1883431,"ip_address":"ç¾å›½","ucode":"28A03027343F9D","user_header":"https://static001.geekbang.org/account/avatar/00/1c/bd/27/e653a220.jpg","comment_is_top":false,"comment_ctime":1706150694,"is_pvip":false,"replies":[{"id":141093,"content":"è¿™æ˜¯å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œç½‘ç»œç¨‹åºï¼Œç›´æ¥ä»æµä¸Šæ‹¿å­—èŠ‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1706230416,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":387007,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"å¥½å¥‡ä¸ºä»€ä¹ˆparseUriè¦å†™çš„è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥requestString.split(&#39; &#39;)ï¼Œæ£€æŸ¥ä¸€ä¸‹lengthï¼Œç„¶å å–ç¬¬äºŒä¸ªä¸å°±è¡Œäº†å—","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636484,"discussion_content":"è¿™æ˜¯å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œç½‘ç»œç¨‹åºï¼Œç›´æ¥ä»æµä¸Šæ‹¿å­—èŠ‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706230416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386138,"user_name":"å¥åº·çš„å°ç‰›çŠŠ","can_delete":false,"product_type":"c1","uid":2263754,"ip_address":"æ±Ÿè‹","ucode":"A63C30B602F0A5","user_header":"https://static001.geekbang.org/account/avatar/00/22/8a/ca/1afcc75b.jpg","comment_is_top":false,"comment_ctime":1704180723,"is_pvip":false,"replies":[{"id":140772,"content":"Springæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œä¸æ˜¯æœåŠ¡å™¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1704205127,"ip_address":"æ¹–å—","comment_id":386138,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"Springå’Œtomcatæ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„å‘¢ï¼ŒæŒ‰ç†è¯´tomcatæœ¬èº«å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªwebæœåŠ¡å™¨äº†ï¼Œé‚£springçš„ä½œç”¨æ˜¯å•¥å‘¢","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634944,"discussion_content":"Springæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œä¸æ˜¯æœåŠ¡å™¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704205127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103002,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d4/9a/11134ccc.jpg","nickname":"å°å››","note":"","ucode":"41BAE89BCCF047","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639390,"discussion_content":"Springæ˜¯ä¸€ä¸ªåº”ç”¨å¼€å‘æ¡†æ¶ï¼ŒåŒ…å«å¾ˆå¤šæ¨¡å—ï¼Œæ¯”å¦‚ Spring MVCï¼Œç”¨äºç®€åŒ– web å¼€å‘ã€‚\n\nç®€å•çš„è¯´ï¼Œtomcat æ˜¯ä¸€ä¸ªservlet å®¹å™¨ï¼Œè€Œspring MVC æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ª servletçš„å°è£…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710581802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3718893,"avatar":"https://static001.geekbang.org/account/avatar/00/38/be/ed/f90bd120.jpg","nickname":"Lunch","note":"","ucode":"69485D8B1893ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635845,"discussion_content":"Tomcatå°±æ˜¯ä¸€ä¸ªæœåŠ¡å¯åŠ¨ç¨‹åºï¼ŒTomcatç»™äº†æˆ‘ä»¬æ¥å£ï¼Œè®©æˆ‘ä»¬å†™é¡¹ç›®ä»£ç ï¼Œç„¶åé¡ºä¾¿å¸®æˆ‘ä»¬å¯åŠ¨é¡¹ç›®ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705294353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385430,"user_name":"Geek_50a5cc","can_delete":false,"product_type":"c1","uid":1786951,"ip_address":"åŒ—äº¬","ucode":"0F6C1C2552261F","user_header":"","comment_is_top":false,"comment_ctime":1702620847,"is_pvip":false,"replies":[{"id":140480,"content":"httpåè®®æ²¡æœ‰é™åˆ¶å“åº”æ•°æ®çš„å¤§å°ï¼Œç†è®ºä¸Šæ²¡æœ‰è§„å®šã€‚ä¸è¿‡å®é™…æœåŠ¡å™¨å’Œåº”ç”¨åœºæ™¯ï¼Œå¯ä»¥è‡ªè¡Œè§„å®šå¤§å°é™åˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702777636,"ip_address":"åŒ—äº¬","comment_id":385430,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"å¦‚æœå°†è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œæ”¾åœ¨messageé‡Œé¢è¿”å›è¿‡å»ï¼›\nString Message = &quot;HTTP&#47;1.1 404 FIle Not Found\\r\\n&quot; +\n                        &quot;Content-Type: text&#47;html\\r\\n&quot; +\n                        &quot;Content-Length: 23\\r\\n&quot; +\n                        &quot;\\r\\n&quot; +\n                        &quot;&lt;h1&gt;&quot;+\n                        result.toString() +\n                        &quot;&lt;&#47;h1&gt;&quot;;\n                output.write(Message.getBytes());\nå¦‚æœæ–‡ä»¶é‡Œ å­—ç¬¦ å¾ˆå¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªæ˜¯å¦éƒ½ä¼šå®Œå…¨è¾“å‡ºæ˜¾ç¤ºå‡ºæ¥å‘¢ï¼›\nï¼ˆresultå°±æ˜¯æ–‡ä»¶å­—èŠ‚æµè½¬æ¢çš„å­—ç¬¦ä¸²ï¼‰","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633913,"discussion_content":"httpåè®®æ²¡æœ‰é™åˆ¶å“åº”æ•°æ®çš„å¤§å°ï¼Œç†è®ºä¸Šæ²¡æœ‰è§„å®šã€‚ä¸è¿‡å®é™…æœåŠ¡å™¨å’Œåº”ç”¨åœºæ™¯ï¼Œå¯ä»¥è‡ªè¡Œè§„å®šå¤§å°é™åˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702777636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385343,"user_name":"Koyi","can_delete":false,"product_type":"c1","uid":3183457,"ip_address":"ä¸Šæµ·","ucode":"D4115B2852FCE8","user_header":"https://static001.geekbang.org/account/avatar/00/30/93/61/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1702460471,"is_pvip":false,"replies":[{"id":140436,"content":"å¾€åçœ‹ï¼Œç°åœ¨æ˜¯èµ·æ­¥çš„ç²—ç³™ç‰ˆæœ¬ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702474197,"ip_address":"åŒ—äº¬","comment_id":385343,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"Requestç±» ç¬¬13è¡Œ è¯»å–æ•°æ®æ—¶ï¼Œä½¿ç”¨ä¸€ä¸ªwhileå¾ªç¯åˆ¤æ–­è¿”å›å€¼æ˜¯å¦å¤§äº0ä»¥ä¿è¯æˆåŠŸè¯»å–å®Œæ•°æ®æ˜¯ä¸æ˜¯å¥½äº›","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633683,"discussion_content":"å¾€åçœ‹ï¼Œç°åœ¨æ˜¯èµ·æ­¥çš„ç²—ç³™ç‰ˆæœ¬ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702474197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394385,"user_name":"æ–œæ é’å¹´","can_delete":false,"product_type":"c1","uid":1177739,"ip_address":"å¹¿ä¸œ","ucode":"D7AF02B8588549","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/8b/74d2ab6b.jpg","comment_is_top":false,"comment_ctime":1726676621,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æˆ‘è‡ªå·±åœ¨å­¦ä¹  http åè®®çš„æ—¶å€™ï¼Œå°±æƒ³åˆ°äº†ï¼Œå¯ä»¥ç›´æ¥åŸºäºå­—èŠ‚ç æ¥è¿›è¡Œå¼€å§‹åˆ° socket è¿›è€Œåˆ° http åè®®ï¼Œåˆ°å¤šè·¯å¤ç”¨ï¼Œå¼‚æ­¥IOï¼Œåˆ° tomcat çš„çŸ¥è¯†ç‚¹ä¸²èµ·æ¥ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰å†³å¿ƒè¿›è¡Œæ¢³ç†ï¼Œçœ‹åˆ°è¿™ä¸ªè¯¾ç¨‹å¦‚è·çå®ï¼Œå­¦ä¼šæ­¤è¯¾ç¨‹å¯ä»¥æ˜ç™½ç†è§£ä¸ºä»€ä¹ˆå‹æµ‹çš„æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•æå‡æœåŠ¡å™¨è§„æ ¼ï¼Œæ•°æ®åº“è§„æ ¼ï¼Œååè¿˜æ˜¯ä¸Šä¸å»ï¼Œä»¥åŠå„ç§çŠ¶æ€ç ä»£è¡¨ä»€ä¹ˆï¼Œç“¶é¢ˆåœ¨TCPå±‚è¿˜æ˜¯Tomcatå±‚ï¼Œéƒ½ä¼šå¾—åˆ°ç­”æ¡ˆã€‚","like_count":0},{"had_liked":false,"id":388280,"user_name":"æ—·é‡ä¹‹å¸Œ","can_delete":false,"product_type":"c1","uid":2278431,"ip_address":"åŠ æ‹¿å¤§","ucode":"B25186DD7BF213","user_header":"https://static001.geekbang.org/account/avatar/00/22/c4/1f/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1709790139,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æ—¶éšä¾¿ä½¿ç”¨äº†ä¸€ä¸ªç«¯å£å·7000ï¼Œä¼šæŠ¥403 forbiddençš„å¼‚å¸¸ï¼Œä½†æ˜¯æ¢ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚8888å°±å¯ä»¥æ­£å¸¸è®¿é—®hello.txtäº†ï¼Œè¿™å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1177739,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f8/8b/74d2ab6b.jpg","nickname":"æ–œæ é’å¹´","note":"","ucode":"D7AF02B8588549","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651284,"discussion_content":"æœ‰å¯èƒ½æ˜¯æœ¬åœ°æœ‰å…¶ä»–çš„æœåŠ¡ä½¿ç”¨ 7000 ç«¯å£ï¼Œå®é™…æœåŠ¡å¯åŠ¨çš„ä¸æ˜¯ 7000 ç«¯å£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726676721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3619143,"avatar":"https://static001.geekbang.org/account/avatar/00/37/39/47/791d0f5e.jpg","nickname":"ä¿¡â€œè‡ªä¸ªerâ€ä¸å°±å¥½äº†","note":"","ucode":"8FFE9E61DD0285","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648533,"discussion_content":"æˆ‘æ˜¯ä¸ç®¡å•¥ç«¯å£ï¼Œé¡µé¢æ˜¾ç¤ºæ‹’ç»é“¾æ¥è¯·æ±‚ã€‚ã€‚ã€‚ã€‚é˜²ç«å¢™å·²å…³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721748632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®‰å¾½","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}