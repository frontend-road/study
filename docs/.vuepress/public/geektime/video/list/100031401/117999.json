{"id":117999,"title":"57 | EFK & Prometheus & Skywalking + Kubernetes 集成架构","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":127408,"user_name":"大维","can_delete":false,"product_type":"c3","uid":1129620,"ip_address":"","ucode":"5FEAF1F0B48876","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/94/932231c2.jpg","comment_is_top":false,"comment_ctime":1566701379,"is_pvip":false,"replies":[{"id":47226,"content":"如果企业采用spring + k8s技术栈的话，EFK + Prometheus + SkyWalking就是我推荐的监控三套件，这三个分别是日志、metrics和调用链监控的利器，是社区主流生态也好，用好就不错。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566746602,"ip_address":"","comment_id":127408,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":" 波波老师，您分享的：EFK + K8s, Prometheus+ K8s, SkyWalking + K8s 这3个监控组合组件，这三个貌似都非常不错，那在实际生产过程中，对一家中等规模的微服务业务应用，该如何选型呢？ ","like_count":10,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464477,"discussion_content":"如果企业采用spring + k8s技术栈的话，EFK + Prometheus + SkyWalking就是我推荐的监控三套件，这三个分别是日志、metrics和调用链监控的利器，是社区主流生态也好，用好就不错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566746602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235280,"user_name":"漂泊的松鼠","can_delete":false,"product_type":"c3","uid":1194545,"ip_address":"","ucode":"281CF2FAA6F904","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/31/6a127efe.jpg","comment_is_top":false,"comment_ctime":1594959442,"is_pvip":false,"replies":[{"id":86957,"content":"CAT主要为物理机&#47;虚拟机场景研发，容器环境应该也支持，但是文档资料较少。\n\n总体CAT是一个不错的产品，但是相对门槛较高，社区和文档不足。\n\n相比而言，skywalking门槛较低，社区文档好，对容器环境有明确的支持。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1595002857,"ip_address":"","comment_id":235280,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，spring + k8s技术栈的前提下，为什么不推荐用CAT来解决tracing的问题，有什么坑？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501674,"discussion_content":"CAT主要为物理机/虚拟机场景研发，容器环境应该也支持，但是文档资料较少。\n\n总体CAT是一个不错的产品，但是相对门槛较高，社区和文档不足。\n\n相比而言，skywalking门槛较低，社区文档好，对容器环境有明确的支持。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595002857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191149,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1584750297,"is_pvip":false,"replies":[{"id":73439,"content":"方法级监控可以用Promethues，但是需要对方法进行埋点，如果是Spring应用，你用MicroMeter对方法添加相应的注解即可。注意，最好在框架层统一埋点。\n\nSkywalking也可以监控到方法级，前提是需要相应的plugin支持，如果现成的plugin监控不到你的方法，你可以扩展或者自己写plugin。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1584792919,"ip_address":"","comment_id":191149,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"EFK+Ptometheus+Skywalking——日志+metrics+调用链，这是老师推荐的监控利器。\n波波老师，这里的功能包括方法粒度的监控嘛？比如调用次数、可用率、各种性能指标？\n\n","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488124,"discussion_content":"方法级监控可以用Promethues，但是需要对方法进行埋点，如果是Spring应用，你用MicroMeter对方法添加相应的注解即可。注意，最好在框架层统一埋点。\n\nSkywalking也可以监控到方法级，前提是需要相应的plugin支持，如果现成的plugin监控不到你的方法，你可以扩展或者自己写plugin。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584792919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129442,"user_name":"ROAD","can_delete":false,"product_type":"c3","uid":1515127,"ip_address":"","ucode":"7A09F8DEDB1A45","user_header":"https://static001.geekbang.org/account/avatar/00/17/1e/77/d932331a.jpg","comment_is_top":false,"comment_ctime":1567129470,"is_pvip":false,"replies":[{"id":48325,"content":"你看skywalking的版本，我知道最新版本是支持Spring Cloud Gateway的，而且是最近刚增加的支持。\n\nhttps:&#47;&#47;github.com&#47;apache&#47;skywalking&#47;blob&#47;master&#47;docs&#47;en&#47;setup&#47;service-agent&#47;java-agent&#47;Supported-list.md","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567169166,"ip_address":"","comment_id":129442,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"项目使用spring gateway作为服务网关。发现网关服务不在服务链路的拓扑图上面体现，请问波波老师这是为什么呢","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465471,"discussion_content":"你看skywalking的版本，我知道最新版本是支持Spring Cloud Gateway的，而且是最近刚增加的支持。\n\nhttps://github.com/apache/skywalking/blob/master/docs/en/setup/service-agent/java-agent/Supported-list.md","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567169166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210843,"user_name":"光","can_delete":false,"product_type":"c3","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1587835583,"is_pvip":false,"replies":[{"id":78523,"content":"不能说有明显的优势，logstash历史比较老一点，fluentd比较新一点，目前是云原生支持的项目之一。\n\n这里有一篇较新更新的两者比较文：\nhttps:&#47;&#47;logz.io&#47;blog&#47;fluentd-logstash&#47;\n\n结论是：“While there are several differences, the similarities between Logstash and Fluentd are greater than their differences. Users of either Logstash or Fluentd are miles ahead of the curve when it comes to log management.”\n\n关于微服务+K8s监控体系，可以参考本课程的补充视频，在我的B站空间上：\nhttps:&#47;&#47;www.bilibili.com&#47;video&#47;BV1ut4y1U7Tz","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587906483,"ip_address":"","comment_id":210843,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"fluentd 对比 logstash 有什么具体优势么在K8S 中","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493124,"discussion_content":"不能说有明显的优势，logstash历史比较老一点，fluentd比较新一点，目前是云原生支持的项目之一。\n\n这里有一篇较新更新的两者比较文：\nhttps://logz.io/blog/fluentd-logstash/\n\n结论是：“While there are several differences, the similarities between Logstash and Fluentd are greater than their differences. Users of either Logstash or Fluentd are miles ahead of the curve when it comes to log management.”\n\n关于微服务+K8s监控体系，可以参考本课程的补充视频，在我的B站空间上：\nhttps://www.bilibili.com/video/BV1ut4y1U7Tz","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587906483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126233,"user_name":"John","can_delete":false,"product_type":"c3","uid":1020861,"ip_address":"","ucode":"E4ADF8488953FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg","comment_is_top":false,"comment_ctime":1566351765,"is_pvip":false,"replies":[{"id":46766,"content":"elastic属于一种高性能大容量的nosql数据存储，底层基于反向索引数据结构，在大数据存储、搜索和分析方面有广泛用途。它可以做skywalking的存储，也可以做普通日志存储。关于性能稳定性和效率，elastic本身是分布式高性能设计，实际要看你的调优和运维能力，国内公司如携程，有超过50台机器做成的elastic集群，每天收集存储超过TB级别数据量。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566389727,"ip_address":"","comment_id":126233,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"很多網評說elastic不適合用數據存儲 那麼我們這個項目裡 用elastic 也相當於給skywalk做了數據庫 波波怎麼看穩定性和效率","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463898,"discussion_content":"elastic属于一种高性能大容量的nosql数据存储，底层基于反向索引数据结构，在大数据存储、搜索和分析方面有广泛用途。它可以做skywalking的存储，也可以做普通日志存储。关于性能稳定性和效率，elastic本身是分布式高性能设计，实际要看你的调优和运维能力，国内公司如携程，有超过50台机器做成的elastic集群，每天收集存储超过TB级别数据量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566389727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208253,"user_name":"Geek_d676ee","can_delete":false,"product_type":"c3","uid":1949652,"ip_address":"","ucode":"DE9510B61BADFF","user_header":"","comment_is_top":false,"comment_ctime":1587308475,"is_pvip":false,"replies":[{"id":77943,"content":"skywalking当然是可以和efk共用ElasticSearch的，它们用不同的index，实际要不要这样弄，具体要考虑业务场景&#47;容量需求等因素。集群节点个数和内存CPU建议先粗略估算，然后监控起来(ES有很多监控手段)，运行一段时间后根据监控数据优化容量规划。\n\nzipkin的trace监控是应用层的，可以和应用&#47;框架代码紧密集成，开发定制灵活性更高。istio的trace是系统层的，对应用层无倾入，但是开发人员的控制和定制弱。具体框架和运维团队要协商综合考虑，哪种更适合，当然也可以两个都用结合起来。\n\n\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587394787,"ip_address":"","comment_id":208253,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"skywalking可以和efk共用elasticsearch吗？elasticsearch集群个数和内存CPU怎么合理安排。\n因为需要使用istio的熔断流量控制，istio也有一些trace什么的zipkin,怎么选择？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492388,"discussion_content":"skywalking当然是可以和efk共用ElasticSearch的，它们用不同的index，实际要不要这样弄，具体要考虑业务场景/容量需求等因素。集群节点个数和内存CPU建议先粗略估算，然后监控起来(ES有很多监控手段)，运行一段时间后根据监控数据优化容量规划。\n\nzipkin的trace监控是应用层的，可以和应用/框架代码紧密集成，开发定制灵活性更高。istio的trace是系统层的，对应用层无倾入，但是开发人员的控制和定制弱。具体框架和运维团队要协商综合考虑，哪种更适合，当然也可以两个都用结合起来。\n\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587394787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386471,"user_name":"后天","can_delete":false,"product_type":"c3","uid":1062583,"ip_address":"北京","ucode":"B7759312DAFE1F","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/b7/4f86c818.jpg","comment_is_top":false,"comment_ctime":1704886687,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"logParser可以用Fluentd吗？","like_count":0},{"had_liked":false,"id":365115,"user_name":"（＾_＾）","can_delete":false,"product_type":"c3","uid":1435446,"ip_address":"上海","ucode":"0C414A1FE24245","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/BqNOqXNmTQylHk6drxYKVHR78YBy4KYgia6cA9VUQjdDrAYAg1QIM73C6ib5vLkXlgwOibwXjAYVhY5FLRaZIBcCw/132","comment_is_top":false,"comment_ctime":1672124922,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，请教下日志收集可以用skywalking代替efk么，新版本skywalking好像是有这个日志功能的","like_count":0}]}