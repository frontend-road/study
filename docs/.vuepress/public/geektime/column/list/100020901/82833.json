{"id":82833,"title":"40 | æ¡ˆä¾‹ç¯‡ï¼šç½‘ç»œè¯·æ±‚å»¶è¿Ÿå˜å¤§äº†ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ç¢°åˆ°åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼ˆDDoSï¼‰çš„ç¼“è§£æ–¹æ³•ã€‚ç®€å•å›é¡¾ä¸€ä¸‹ï¼ŒDDoS åˆ©ç”¨å¤§é‡çš„ä¼ªé€ è¯·æ±‚ï¼Œå¯¼è‡´ç›®æ ‡æœåŠ¡è¦è€—è´¹å¤§é‡èµ„æºï¼Œæ¥å¤„ç†è¿™äº›æ— æ•ˆè¯·æ±‚ï¼Œè¿›è€Œæ— æ³•æ­£å¸¸å“åº”æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚ã€‚</p><p>ç”±äº DDoS çš„åˆ†å¸ƒå¼ã€å¤§æµé‡ã€éš¾è¿½è¸ªç­‰ç‰¹ç‚¹ï¼Œç›®å‰ç¡®å®è¿˜æ²¡æœ‰æ–¹æ³•ï¼Œèƒ½å¤Ÿå®Œå…¨é˜²å¾¡ DDoS å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½è®¾æ³•ç¼“è§£ DDoS å¸¦æ¥çš„å½±å“ã€‚</p><p>æ¯”å¦‚ï¼Œä½ å¯ä»¥è´­ä¹°ä¸“ä¸šçš„æµé‡æ¸…æ´—è®¾å¤‡å’Œç½‘ç»œé˜²ç«å¢™ï¼Œåœ¨ç½‘ç»œå…¥å£å¤„é˜»æ–­æ¶æ„æµé‡ï¼Œåªä¿ç•™æ­£å¸¸æµé‡è¿›å…¥æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ã€‚</p><p>åœ¨ Linux æœåŠ¡å™¨ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å†…æ ¸è°ƒä¼˜ã€DPDKã€XDP ç­‰å¤šç§æ–¹æ³•ï¼Œå¢å¤§æœåŠ¡å™¨çš„æŠ—æ”»å‡»èƒ½åŠ›ï¼Œé™ä½ DDoS å¯¹æ­£å¸¸æœåŠ¡çš„å½±å“ã€‚è€Œåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯ä»¥åˆ©ç”¨å„çº§ç¼“å­˜ã€ WAFã€CDN ç­‰æ–¹å¼ï¼Œç¼“è§£ DDoS å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼Œå¦‚æœ DDoS çš„æµé‡ï¼Œå·²ç»åˆ°äº† Linux æœåŠ¡å™¨ä¸­ï¼Œé‚£ä¹ˆï¼Œå³ä½¿åº”ç”¨å±‚åšäº†å„ç§ä¼˜åŒ–ï¼Œç½‘ç»œæœåŠ¡çš„å»¶è¿Ÿä¸€èˆ¬è¿˜æ˜¯ä¼šæ¯”æ­£å¸¸æƒ…å†µå¤§å¾ˆå¤šã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¦è®© Linux æœåŠ¡å™¨ï¼Œé…åˆä¸“ä¸šçš„æµé‡æ¸…æ´—ä»¥åŠç½‘ç»œé˜²ç«å¢™è®¾å¤‡ï¼Œä¸€èµ·æ¥ç¼“è§£è¿™ä¸€é—®é¢˜ã€‚</p><p>é™¤äº† DDoS ä¼šå¸¦æ¥ç½‘ç»œå»¶è¿Ÿå¢å¤§å¤–ï¼Œæˆ‘æƒ³ï¼Œä½ è‚¯å®šè§åˆ°è¿‡ä¸å°‘å…¶ä»–åŸå› å¯¼è‡´çš„ç½‘ç»œå»¶è¿Ÿï¼Œæ¯”å¦‚</p><ul>\n<li>\n<p>ç½‘ç»œä¼ è¾“æ…¢ï¼Œå¯¼è‡´å»¶è¿Ÿï¼›</p>\n</li>\n<li>\n<p>Linux å†…æ ¸åè®®æ ˆæŠ¥æ–‡å¤„ç†æ…¢ï¼Œå¯¼è‡´å»¶è¿Ÿï¼›</p>\n</li>\n<li>\n<p>åº”ç”¨ç¨‹åºæ•°æ®å¤„ç†æ…¢ï¼Œå¯¼è‡´å»¶è¿Ÿç­‰ç­‰ã€‚</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>é‚£ä¹ˆï¼Œå½“ç¢°åˆ°è¿™äº›åŸå› çš„å»¶è¿Ÿæ—¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåˆè¯¥å¦‚ä½•å®šä½ç½‘ç»œå»¶è¿Ÿçš„æ ¹æºå‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå¸¦ä½ ä¸€èµ·çœ‹çœ‹è¿™äº›é—®é¢˜ã€‚</p><h2>ç½‘ç»œå»¶è¿Ÿ</h2><p>æˆ‘ç›¸ä¿¡ï¼Œæåˆ°<strong>ç½‘ç»œå»¶è¿Ÿ</strong>æ—¶ï¼Œä½ å¯èƒ½è½»æ¾æƒ³èµ·å®ƒçš„å«ä¹‰â€”â€”ç½‘ç»œæ•°æ®ä¼ è¾“æ‰€ç”¨çš„æ—¶é—´ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™ä¸ªæ—¶é—´å¯èƒ½æ˜¯å•å‘çš„ï¼ŒæŒ‡ä»æºåœ°å€å‘é€åˆ°ç›®çš„åœ°å€çš„å•ç¨‹æ—¶é—´ï¼›ä¹Ÿå¯èƒ½æ˜¯åŒå‘çš„ï¼Œå³ä»æºåœ°å€å‘é€åˆ°ç›®çš„åœ°å€ï¼Œç„¶ååˆä»ç›®çš„åœ°å€å‘å›å“åº”ï¼Œè¿™ä¸ªå¾€è¿”å…¨ç¨‹æ‰€ç”¨çš„æ—¶é—´ã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬æ›´å¸¸ç”¨çš„æ˜¯åŒå‘çš„å¾€è¿”é€šä¿¡å»¶è¿Ÿï¼Œæ¯”å¦‚ ping æµ‹è¯•çš„ç»“æœï¼Œå°±æ˜¯å¾€è¿”å»¶æ—¶ RTTï¼ˆRound-Trip Timeï¼‰ã€‚</p><p>é™¤äº†ç½‘ç»œå»¶è¿Ÿå¤–ï¼Œå¦ä¸€ä¸ªå¸¸ç”¨çš„æŒ‡æ ‡æ˜¯<strong>åº”ç”¨ç¨‹åºå»¶è¿Ÿ</strong>ï¼Œå®ƒæ˜¯æŒ‡ï¼Œä»åº”ç”¨ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚ï¼Œå†åˆ°å‘å›å“åº”ï¼Œå…¨ç¨‹æ‰€ç”¨çš„æ—¶é—´ã€‚é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºå»¶è¿Ÿä¹ŸæŒ‡çš„æ˜¯å¾€è¿”å»¶è¿Ÿï¼Œæ˜¯ç½‘ç»œæ•°æ®ä¼ è¾“æ—¶é—´åŠ ä¸Šæ•°æ®å¤„ç†æ—¶é—´çš„å’Œã€‚</p><p>åœ¨ <a href=\"https://time.geekbang.org/column/article/81057\">Linux ç½‘ç»œåŸºç¡€ç¯‡</a> ä¸­ï¼Œæˆ‘æ›¾ç»ä»‹ç»åˆ°ï¼Œä½ å¯ä»¥ç”¨ ping æ¥æµ‹è¯•ç½‘ç»œå»¶è¿Ÿã€‚ping åŸºäº ICMP åè®®ï¼Œå®ƒé€šè¿‡è®¡ç®— ICMP å›æ˜¾å“åº”æŠ¥æ–‡ä¸ ICMP å›æ˜¾è¯·æ±‚æŠ¥æ–‡çš„æ—¶é—´å·®ï¼Œæ¥è·å¾—å¾€è¿”å»¶æ—¶ã€‚è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦ç‰¹æ®Šè®¤è¯ï¼Œå¸¸è¢«å¾ˆå¤šç½‘ç»œæ”»å‡»åˆ©ç”¨ï¼Œæ¯”å¦‚ç«¯å£æ‰«æå·¥å…· nmapã€ç»„åŒ…å·¥å…· hping3 ç­‰ç­‰ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œå¾ˆå¤šç½‘ç»œæœåŠ¡ä¼šæŠŠ ICMP ç¦æ­¢æ‰ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´æˆ‘ä»¬æ— æ³•ç”¨ ping ï¼Œæ¥æµ‹è¯•ç½‘ç»œæœåŠ¡çš„å¯ç”¨æ€§å’Œå¾€è¿”å»¶æ—¶ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ç”¨ traceroute æˆ– hping3 çš„ TCP å’Œ UDP æ¨¡å¼ï¼Œæ¥è·å–ç½‘ç»œå»¶è¿Ÿã€‚</p><p>æ¯”å¦‚ï¼Œä»¥ baidu.com ä¸ºä¾‹ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„ hping3 å‘½ä»¤ï¼Œæµ‹è¯•ä½ çš„æœºå™¨åˆ°ç™¾åº¦æœç´¢æœåŠ¡å™¨çš„ç½‘ç»œå»¶è¿Ÿï¼š</p><pre><code># -cè¡¨ç¤ºå‘é€3æ¬¡è¯·æ±‚ï¼Œ-Sè¡¨ç¤ºè®¾ç½®TCP SYNï¼Œ-pè¡¨ç¤ºç«¯å£å·ä¸º80\n$ hping3 -c 3 -S -p 80 baidu.com\nHPING baidu.com (eth0 123.125.115.110): S set, 40 headers + 0 data bytes\nlen=46 ip=123.125.115.110 ttl=51 id=47908 sport=80 flags=SA seq=0 win=8192 rtt=20.9 ms\nlen=46 ip=123.125.115.110 ttl=51 id=6788  sport=80 flags=SA seq=1 win=8192 rtt=20.9 ms\nlen=46 ip=123.125.115.110 ttl=51 id=37699 sport=80 flags=SA seq=2 win=8192 rtt=20.9 ms\n\n--- baidu.com hping statistic ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min/avg/max = 20.9/20.9/20.9 ms\n</code></pre><p>ä» hping3 çš„ç»“æœä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œå¾€è¿”å»¶è¿Ÿ RTT ä¸º 20.9msã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ç”¨ traceroute ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ç±»ä¼¼ç»“æœï¼š</p><pre><code># --tcpè¡¨ç¤ºä½¿ç”¨TCPåè®®ï¼Œ-pè¡¨ç¤ºç«¯å£å·ï¼Œ-nè¡¨ç¤ºä¸å¯¹ç»“æœä¸­çš„IPåœ°å€æ‰§è¡Œåå‘åŸŸåè§£æ\n$ traceroute --tcp -p 80 -n baidu.com\ntraceroute to baidu.com (123.125.115.110), 30 hops max, 60 byte packets\n 1  * * *\n 2  * * *\n 3  * * *\n 4  * * *\n 5  * * *\n 6  * * *\n 7  * * *\n 8  * * *\n 9  * * *\n10  * * *\n11  * * *\n12  * * *\n13  * * *\n14  123.125.115.110  20.684 ms *  20.798 ms\n</code></pre><p>traceroute ä¼šåœ¨è·¯ç”±çš„æ¯ä¸€è·³å‘é€ä¸‰ä¸ªåŒ…ï¼Œå¹¶åœ¨æ”¶åˆ°å“åº”åï¼Œè¾“å‡ºå¾€è¿”å»¶æ—¶ã€‚å¦‚æœæ— å“åº”æˆ–è€…å“åº”è¶…æ—¶ï¼ˆé»˜è®¤5sï¼‰ï¼Œå°±ä¼šè¾“å‡ºä¸€ä¸ªæ˜Ÿå·ã€‚</p><p>çŸ¥é“äº†åŸºäº TCP æµ‹è¯•ç½‘ç»œæœåŠ¡å»¶è¿Ÿçš„æ–¹æ³•åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¥å­¦ä¹ ç½‘ç»œå»¶è¿Ÿå‡é«˜æ—¶çš„åˆ†ææ€è·¯ã€‚</p><h2>æ¡ˆä¾‹å‡†å¤‡</h2><p>ä¸‹é¢çš„æ¡ˆä¾‹ä»ç„¶åŸºäº Ubuntu 18.04ï¼ŒåŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿã€‚æˆ‘ä½¿ç”¨çš„æ¡ˆä¾‹ç¯å¢ƒæ˜¯è¿™æ ·çš„ï¼š</p><ul>\n<li>\n<p>æœºå™¨é…ç½®ï¼š2 CPUï¼Œ8GB å†…å­˜ã€‚</p>\n</li>\n<li>\n<p>é¢„å…ˆå®‰è£… dockerã€hping3ã€tcpdumpã€curlã€wrkã€Wireshark ç­‰å·¥å…·ï¼Œæ¯”å¦‚ apt-get install docker.io hping3 tcpdump curlã€‚</p>\n</li>\n</ul><p>è¿™é‡Œçš„å·¥å…·ä½ åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå…¶ä¸­ wrk çš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•åœ¨ <a href=\"https://time.geekbang.org/column/article/81497\">æ€ä¹ˆè¯„ä¼°ç³»ç»Ÿçš„ç½‘ç»œæ€§èƒ½</a> ä¸­æ›¾ç»ä»‹ç»è¿‡ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…ï¼Œè¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…å®ƒï¼š</p><pre><code>$ https://github.com/wg/wrk\n$ cd wrk\n$ apt-get install build-essential -y\n$ make\n$ sudo cp wrk /usr/local/bin/\n</code></pre><p>ç”±äºWireshark éœ€è¦å›¾å½¢ç•Œé¢ï¼Œå¦‚æœä½ çš„è™šæ‹Ÿæœºæ²¡æœ‰å›¾å½¢ç•Œé¢ï¼Œå°±å¯ä»¥æŠŠ Wireshark å®‰è£…åˆ°å…¶ä»–çš„æœºå™¨ä¸­ï¼ˆæ¯”å¦‚ Windows ç¬”è®°æœ¬ï¼‰ã€‚</p><p>æœ¬æ¬¡æ¡ˆä¾‹ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœºï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³»ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/55/63/55347dc1ec78688da5673f29b60aa863.png?wh=816*516\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œåˆ†åˆ« SSH ç™»å½•åˆ°ä¸¤å°æœºå™¨ä¸Šï¼ˆä»¥ä¸‹æ­¥éª¤ï¼Œå‡è®¾ç»ˆç«¯ç¼–å·ä¸å›¾ç¤ºVM ç¼–å·ä¸€è‡´ï¼‰ï¼Œå¹¶å®‰è£…ä¸Šé¢æåˆ°çš„è¿™äº›å·¥å…·ã€‚æ³¨æ„ï¼Œ curl å’Œ wrk åªéœ€è¦å®‰è£…åœ¨å®¢æˆ·ç«¯ VMï¼ˆå³ VM2ï¼‰ä¸­ã€‚</p><p>åŒä»¥å‰çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œä¸‹é¢çš„æ‰€æœ‰å‘½ä»¤éƒ½é»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œå¦‚æœä½ æ˜¯ç”¨æ™®é€šç”¨æˆ·èº«ä»½ç™»é™†ç³»ç»Ÿï¼Œè¯·è¿è¡Œ sudo su root å‘½ä»¤åˆ‡æ¢åˆ° root ç”¨æˆ·ã€‚</p><blockquote>\n<p>å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒåŒæ ·é¼“åŠ±ä½ å…ˆè‡ªå·±æœç´¢è§£å†³ï¼Œè§£å†³ä¸äº†çš„ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºå‘æˆ‘æé—®ã€‚å¦‚æœä½ ä»¥å‰å·²ç»å®‰è£…è¿‡äº†ï¼Œå°±å¯ä»¥å¿½ç•¥è¿™ä¸€ç‚¹äº†ã€‚</p>\n</blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¿›å…¥åˆ°æ¡ˆä¾‹æ“ä½œçš„ç¯èŠ‚ã€‚</p><h2>æ¡ˆä¾‹åˆ†æ</h2><p>ä¸ºäº†å¯¹æ¯”å¾—å‡ºå»¶è¿Ÿå¢å¤§çš„å½±å“ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªæœ€ç®€å•çš„ Nginxï¼Œä¹Ÿå°±æ˜¯ç”¨å®˜æ–¹çš„ Nginx é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚åœ¨ç»ˆç«¯ä¸€ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè¿è¡Œå®˜æ–¹ Nginxï¼Œå®ƒä¼šåœ¨ 80 ç«¯å£ç›‘å¬ï¼š</p><pre><code>$ docker run --network=host --name=good -itd nginx\nfb4ed7cb9177d10e270f8320a7fb64717eac3451114c9fab3c50e02be2e88ba2\n</code></pre><p>ç»§ç»­åœ¨ç»ˆç«¯ä¸€ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè¿è¡Œæ¡ˆä¾‹åº”ç”¨ï¼Œå®ƒä¼šç›‘å¬ 8080 ç«¯å£ï¼š</p><pre><code>$ docker run --name nginx --network=host -itd feisky/nginx:latency\nb99bd136dcfd907747d9c803fdc0255e578bad6d66f4e9c32b826d75b6812724\n</code></pre><p>ç„¶åï¼Œåœ¨ç»ˆç«¯äºŒä¸­æ‰§è¡Œ curl å‘½ä»¤ï¼ŒéªŒè¯ä¸¤ä¸ªå®¹å™¨å·²ç»æ­£å¸¸å¯åŠ¨ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š</p><pre><code># 80ç«¯å£æ­£å¸¸\n$ curl http://192.168.0.30\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n...\n&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n# 8080ç«¯å£æ­£å¸¸\n$ curl http://192.168.0.30:8080\n...\n&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬å†ç”¨ä¸Šé¢æåˆ°çš„ hping3 ï¼Œæ¥æµ‹è¯•å®ƒä»¬çš„å»¶è¿Ÿï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è¿˜æ˜¯åœ¨ç»ˆç«¯äºŒï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ†åˆ«æµ‹è¯•æ¡ˆä¾‹æœºå™¨ 80 ç«¯å£å’Œ 8080 ç«¯å£çš„å»¶è¿Ÿï¼š</p><pre><code># æµ‹è¯•80ç«¯å£å»¶è¿Ÿ\n$ hping3 -c 3 -S -p 80 192.168.0.30\nHPING 192.168.0.30 (eth0 192.168.0.30): S set, 40 headers + 0 data bytes\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=80 flags=SA seq=0 win=29200 rtt=7.8 ms\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=80 flags=SA seq=1 win=29200 rtt=7.7 ms\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=80 flags=SA seq=2 win=29200 rtt=7.6 ms\n\n--- 192.168.0.30 hping statistic ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min/avg/max = 7.6/7.7/7.8 ms\n</code></pre><pre><code># æµ‹è¯•8080ç«¯å£å»¶è¿Ÿ\n$ hping3 -c 3 -S -p 8080 192.168.0.30\nHPING 192.168.0.30 (eth0 192.168.0.30): S set, 40 headers + 0 data bytes\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=8080 flags=SA seq=0 win=29200 rtt=7.7 ms\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=8080 flags=SA seq=1 win=29200 rtt=7.6 ms\nlen=44 ip=192.168.0.30 ttl=64 DF id=0 sport=8080 flags=SA seq=2 win=29200 rtt=7.3 ms\n\n--- 192.168.0.30 hping statistic ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min/avg/max = 7.3/7.6/7.7 ms\n</code></pre><p>ä»è¿™ä¸ªè¾“å‡ºä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªç«¯å£çš„å»¶è¿Ÿå·®ä¸å¤šï¼Œéƒ½æ˜¯ 7msã€‚ä¸è¿‡ï¼Œè¿™åªæ˜¯å•ä¸ªè¯·æ±‚çš„æƒ…å†µã€‚æ¢æˆå¹¶å‘è¯·æ±‚çš„è¯ï¼Œåˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç”¨ wrk è¯•è¯•ã€‚</p><p>è¿™æ¬¡åœ¨ç»ˆç«¯äºŒä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„æ–°å‘½ä»¤ï¼Œåˆ†åˆ«æµ‹è¯•æ¡ˆä¾‹æœºå™¨å¹¶å‘ 100 æ—¶ï¼Œ 80 ç«¯å£å’Œ 8080 ç«¯å£çš„æ€§èƒ½ï¼š</p><pre><code># æµ‹è¯•80ç«¯å£æ€§èƒ½\n$ # wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30/\nRunning 10s test @ http://192.168.0.30/\n  2 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     9.19ms   12.32ms 319.61ms   97.80%\n    Req/Sec     6.20k   426.80     8.25k    85.50%\n  Latency Distribution\n     50%    7.78ms\n     75%    8.22ms\n     90%    9.14ms\n     99%   50.53ms\n  123558 requests in 10.01s, 100.15MB read\nRequests/sec:  12340.91\nTransfer/sec:     10.00MB\n</code></pre><pre><code># æµ‹è¯•8080ç«¯å£æ€§èƒ½\n$ wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30:8080/\nRunning 10s test @ http://192.168.0.30:8080/\n  2 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    43.60ms    6.41ms  56.58ms   97.06%\n    Req/Sec     1.15k   120.29     1.92k    88.50%\n  Latency Distribution\n     50%   44.02ms\n     75%   44.33ms\n     90%   47.62ms\n     99%   48.88ms\n  22853 requests in 10.01s, 18.55MB read\nRequests/sec:   2283.31\nTransfer/sec:      1.85MB\n</code></pre><p>ä»ä¸Šé¢ä¸¤ä¸ªè¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œå®˜æ–¹Nginxï¼ˆç›‘å¬åœ¨80ç«¯å£ï¼‰çš„å¹³å‡å»¶è¿Ÿæ˜¯ 9.19msï¼Œè€Œæ¡ˆä¾‹ Nginx çš„å¹³å‡å»¶è¿Ÿï¼ˆç›‘å¬åœ¨ 8080 ç«¯å£ï¼‰åˆ™æ˜¯ 43.6msã€‚ä»å»¶è¿Ÿçš„åˆ†å¸ƒä¸Šæ¥çœ‹ï¼Œå®˜æ–¹ Nginx 90% çš„è¯·æ±‚ï¼Œéƒ½å¯ä»¥åœ¨ 9msä»¥å†…å®Œæˆï¼›è€Œæ¡ˆä¾‹ Nginx 50% çš„è¯·æ±‚ï¼Œå°±å·²ç»è¾¾åˆ°äº† 44 msã€‚</p><p>å†ç»“åˆä¸Šé¢ hping3 çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°ï¼Œæ¡ˆä¾‹ Nginx åœ¨å¹¶å‘è¯·æ±‚ä¸‹çš„å»¶è¿Ÿå¢å¤§äº†å¾ˆå¤šï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>åˆ†ææ–¹æ³•æˆ‘æƒ³ä½ å·²ç»æƒ³åˆ°äº†ï¼Œä¸ŠèŠ‚è¯¾å­¦è¿‡çš„ï¼Œä½¿ç”¨ tcpdump æŠ“å–æ”¶å‘çš„ç½‘ç»œåŒ…ï¼Œåˆ†æç½‘ç»œçš„æ”¶å‘è¿‡ç¨‹æœ‰æ²¡æœ‰é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸€ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„ tcpdump å‘½ä»¤ï¼ŒæŠ“å– 8080 ç«¯å£ä¸Šæ”¶å‘çš„ç½‘ç»œåŒ…ï¼Œå¹¶ä¿å­˜åˆ° nginx.pcap æ–‡ä»¶ï¼š</p><pre><code>$ tcpdump -nn tcp port 8080 -w nginx.pcap\n</code></pre><p>ç„¶ååˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­ï¼Œé‡æ–°æ‰§è¡Œ wrk å‘½ä»¤ï¼š</p><pre><code># æµ‹è¯•8080ç«¯å£æ€§èƒ½\n$ wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30:8080/\n</code></pre><p>å½“ wrk å‘½ä»¤ç»“æŸåï¼Œå†æ¬¡åˆ‡æ¢å›ç»ˆç«¯ä¸€ï¼Œå¹¶æŒ‰ä¸‹ Ctrl+C ç»“æŸ tcpdump å‘½ä»¤ã€‚ç„¶åï¼Œå†æŠŠæŠ“å–åˆ°çš„ nginx.pcap ï¼Œå¤åˆ¶åˆ°è£…æœ‰ Wireshark çš„æœºå™¨ä¸­ï¼ˆå¦‚æœ VM1 å·²ç»å¸¦æœ‰å›¾å½¢ç•Œé¢ï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡å¤åˆ¶æ­¥éª¤ï¼‰ï¼Œå¹¶ç”¨ Wireshark æ‰“å¼€å®ƒã€‚</p><p>ç”±äºç½‘ç»œåŒ…çš„æ•°é‡æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè¿‡æ»¤ä¸€ä¸‹ã€‚æ¯”å¦‚ï¼Œåœ¨é€‰æ‹©ä¸€ä¸ªåŒ…åï¼Œä½ å¯ä»¥å•å‡»å³é”®å¹¶é€‰æ‹© â€œFollowâ€ -&gt; â€œTCP Streamâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/45/98/4590d2477d54bf9aa3d2881ff3296498.png?wh=453*372\" alt=\"\"></p><p>ç„¶åï¼Œå…³é—­å¼¹å‡ºæ¥çš„å¯¹è¯æ¡†ï¼Œå›åˆ° Wireshark ä¸»çª—å£ã€‚è¿™æ—¶å€™ï¼Œä½ ä¼šå‘ç° Wireshark å·²ç»è‡ªåŠ¨å¸®ä½ è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼ tcp.stream eq 24ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾ä¸­çœå»äº†æºå’Œç›®çš„IPåœ°å€ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f9/6e/f9fa457f95276ae4904a91619501376e.png?wh=761*295\" alt=\"\"></p><p>ä»è¿™é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ª TCP è¿æ¥ä»ä¸‰æ¬¡æ¡æ‰‹å¼€å§‹çš„æ¯ä¸ªè¯·æ±‚å’Œå“åº”æƒ…å†µã€‚å½“ç„¶ï¼Œè¿™å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œä½ å¯ä»¥ç»§ç»­ç‚¹å‡»èœå•æ é‡Œçš„ Statics -&gt; Flow Graphï¼Œé€‰ä¸­ â€œLimit to display filterâ€ å¹¶è®¾ç½® Flow type ä¸º â€œTCP Flowsâ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/cc/ff498170eb58abcdd841709fb4c036cc.png?wh=722*471\" alt=\"\"></p><p>æ³¨æ„ï¼Œè¿™ä¸ªå›¾çš„å·¦è¾¹æ˜¯å®¢æˆ·ç«¯ï¼Œè€Œå³è¾¹æ˜¯ Nginx æœåŠ¡å™¨ã€‚é€šè¿‡è¿™ä¸ªå›¾å°±å¯ä»¥çœ‹å‡ºï¼Œå‰é¢ä¸‰æ¬¡æ¡æ‰‹ï¼Œä»¥åŠç¬¬ä¸€æ¬¡ HTTP è¯·æ±‚å’Œå“åº”è¿˜æ˜¯æŒºå¿«çš„ï¼Œä½†ç¬¬äºŒæ¬¡ HTTP è¯·æ±‚å°±æ¯”è¾ƒæ…¢äº†ï¼Œç‰¹åˆ«æ˜¯å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æœåŠ¡å™¨ç¬¬ä¸€ä¸ªåˆ†ç»„åï¼Œ40ms åæ‰å‘å‡ºäº† ACK å“åº”ï¼ˆå›¾ä¸­è“è‰²è¡Œï¼‰ã€‚</p><p>çœ‹åˆ° 40ms è¿™ä¸ªå€¼ï¼Œä½ æœ‰æ²¡æœ‰æƒ³èµ·ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™æ˜¯ TCP å»¶è¿Ÿç¡®è®¤ï¼ˆDelayed ACKï¼‰çš„æœ€å°è¶…æ—¶æ—¶é—´ã€‚</p><p>è¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹å»¶è¿Ÿç¡®è®¤ã€‚è¿™æ˜¯é’ˆå¯¹ TCP ACK çš„ä¸€ç§ä¼˜åŒ–æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç”¨æ¯æ¬¡è¯·æ±‚éƒ½å‘é€ä¸€ä¸ª ACKï¼Œè€Œæ˜¯å…ˆç­‰ä¸€ä¼šå„¿ï¼ˆæ¯”å¦‚ 40msï¼‰ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰â€œé¡ºé£è½¦â€ã€‚å¦‚æœè¿™æ®µæ—¶é—´å†…ï¼Œæ­£å¥½æœ‰å…¶ä»–åŒ…éœ€è¦å‘é€ï¼Œé‚£å°±æå¸¦ç€ ACK ä¸€èµ·å‘é€è¿‡å»ã€‚å½“ç„¶ï¼Œå¦‚æœä¸€ç›´ç­‰ä¸åˆ°å…¶ä»–åŒ…ï¼Œé‚£å°±è¶…æ—¶åå•ç‹¬å‘é€ ACKã€‚</p><p>å› ä¸ºæ¡ˆä¾‹ä¸­ 40ms å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæˆ‘ä»¬æœ‰ç†ç”±æ€€ç–‘ï¼Œæ˜¯å®¢æˆ·ç«¯å¼€å¯äº†å»¶è¿Ÿç¡®è®¤æœºåˆ¶ã€‚è€Œè¿™å„¿çš„å®¢æˆ·ç«¯ï¼Œå®é™…ä¸Šå°±æ˜¯å‰é¢è¿è¡Œçš„ wrkã€‚</p><p>æŸ¥è¯¢ TCP æ–‡æ¡£ï¼ˆæ‰§è¡Œ man tcpï¼‰ï¼Œä½ å°±ä¼šå‘ç°ï¼Œåªæœ‰ TCP å¥—æ¥å­—ä¸“é—¨è®¾ç½®äº† TCP_QUICKACK ï¼Œæ‰ä¼šå¼€å¯å¿«é€Ÿç¡®è®¤æ¨¡å¼ï¼›å¦åˆ™ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé‡‡ç”¨çš„å°±æ˜¯å»¶è¿Ÿç¡®è®¤æœºåˆ¶ï¼š</p><pre><code>TCP_QUICKACK (since Linux 2.4.4)\n              Enable  quickack mode if set or disable quickack mode if cleared.  In quickack mode, acks are sent immeâ€\n              diately, rather than delayed if needed in accordance to normal TCP operation.  This flag is  not  permaâ€\n              nent,  it only enables a switch to or from quickack mode.  Subsequent operation of the TCP protocol will\n              once again enter/leave quickack mode depending on internal  protocol  processing  and  factors  such  as\n              delayed ack timeouts occurring and data transfer.  This option should not be used in code intended to be\n              portable.\n</code></pre><p>ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„çŒœæƒ³ï¼Œç¡®è®¤ wrk çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ strace ï¼Œæ¥è§‚å¯Ÿ wrk ä¸ºå¥—æ¥å­—è®¾ç½®äº†å“ªäº› TCP é€‰é¡¹ã€‚</p><p>æ¯”å¦‚ï¼Œä½ å¯ä»¥åˆ‡æ¢åˆ°ç»ˆç«¯äºŒä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code>$ strace -f wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30:8080/\n...\nsetsockopt(52, SOL_TCP, TCP_NODELAY, [1], 4) = 0\n...\n</code></pre><p>è¿™æ ·ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œwrk åªè®¾ç½®äº† TCP_NODELAY é€‰é¡¹ï¼Œè€Œæ²¡æœ‰è®¾ç½® TCP_QUICKACKã€‚è¿™è¯´æ˜ wrk é‡‡ç”¨çš„æ­£æ˜¯å»¶è¿Ÿç¡®è®¤ï¼Œä¹Ÿå°±è§£é‡Šäº†ä¸Šé¢è¿™ä¸ª40ms çš„é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œåˆ«å¿˜äº†ï¼Œè¿™åªæ˜¯å®¢æˆ·ç«¯çš„è¡Œä¸ºï¼ŒæŒ‰ç†æ¥è¯´ï¼ŒNginx æœåŠ¡å™¨ä¸åº”è¯¥å—åˆ°è¿™ä¸ªè¡Œä¸ºçš„å½±å“ã€‚é‚£æ˜¯ä¸æ˜¯æˆ‘ä»¬åˆ†æç½‘ç»œåŒ…æ—¶ï¼Œæ¼æ‰äº†ä»€ä¹ˆçº¿ç´¢å‘¢ï¼Ÿè®©æˆ‘ä»¬å›åˆ° Wireshark é‡æ–°è§‚å¯Ÿä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/72/8a/72eb14e8996147a458aa6523110c938a.png?wh=750*268\" alt=\"\"></p><p>ä»”ç»†è§‚å¯Ÿ Wireshark çš„ç•Œé¢ï¼Œå…¶ä¸­ï¼Œ 1173 å·åŒ…ï¼Œå°±æ˜¯åˆšæ‰è¯´åˆ°çš„å»¶è¿Ÿ ACK åŒ…ï¼›ä¸‹ä¸€è¡Œçš„ 1175 ï¼Œåˆ™æ˜¯ Nginx å‘é€çš„ç¬¬äºŒä¸ªåˆ†ç»„åŒ…ï¼Œå®ƒè·Ÿ 697 å·åŒ…ç»„åˆèµ·æ¥ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ HTTP å“åº”ï¼ˆACK å·éƒ½æ˜¯ 85ï¼‰ã€‚</p><p>ç¬¬äºŒä¸ªåˆ†ç»„æ²¡è·Ÿå‰ä¸€ä¸ªåˆ†ç»„ï¼ˆ697 å·ï¼‰ä¸€èµ·å‘é€ï¼Œè€Œæ˜¯ç­‰åˆ°å®¢æˆ·ç«¯å¯¹ç¬¬ä¸€ä¸ªåˆ†ç»„çš„ ACK åï¼ˆ1173 å·ï¼‰æ‰å‘é€ï¼Œè¿™çœ‹èµ·æ¥è·Ÿå»¶è¿Ÿç¡®è®¤æœ‰ç‚¹åƒï¼Œåªä¸è¿‡ï¼Œè¿™å„¿ä¸å†æ˜¯ ACKï¼Œè€Œæ˜¯å‘é€æ•°æ®ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä¼°è®¡ä½ æƒ³èµ·äº†ä¸€ä¸ªä¸œè¥¿â€”â€” Nagle ç®—æ³•ï¼ˆçº³æ ¼ç®—æ³•ï¼‰ã€‚è¿›ä¸€æ­¥åˆ†ææ¡ˆä¾‹å‰ï¼Œæˆ‘å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç®—æ³•ã€‚</p><p>Nagle ç®—æ³•ï¼Œæ˜¯ TCP åè®®ä¸­ç”¨äºå‡å°‘å°åŒ…å‘é€æ•°é‡çš„ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜å®é™…å¸¦å®½çš„åˆ©ç”¨ç‡ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“æœ‰æ•ˆè´Ÿè½½åªæœ‰ 1 å­—èŠ‚æ—¶ï¼Œå†åŠ ä¸Š TCP å¤´éƒ¨å’Œ IP å¤´éƒ¨åˆ†åˆ«å ç”¨çš„ 20 å­—èŠ‚ï¼Œæ•´ä¸ªç½‘ç»œåŒ…å°±æ˜¯ 41 å­—èŠ‚ï¼Œè¿™æ ·å®é™…å¸¦å®½çš„åˆ©ç”¨ç‡åªæœ‰ 2.4%ï¼ˆ1/41ï¼‰ã€‚å¾€å¤§äº†è¯´ï¼Œå¦‚æœæ•´ä¸ªç½‘ç»œå¸¦å®½éƒ½è¢«è¿™ç§å°åŒ…å æ»¡ï¼Œé‚£æ•´ä¸ªç½‘ç»œçš„æœ‰æ•ˆåˆ©ç”¨ç‡å°±å¤ªä½äº†ã€‚</p><p>Nagle ç®—æ³•æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒé€šè¿‡åˆå¹¶ TCP å°åŒ…ï¼Œæé«˜ç½‘ç»œå¸¦å®½çš„åˆ©ç”¨ç‡ã€‚Nagle ç®—æ³•è§„å®šï¼Œä¸€ä¸ª TCP è¿æ¥ä¸Šï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæœªè¢«ç¡®è®¤çš„æœªå®Œæˆåˆ†ç»„ï¼›åœ¨æ”¶åˆ°è¿™ä¸ªåˆ†ç»„çš„ ACK å‰ï¼Œä¸å‘é€å…¶ä»–åˆ†ç»„ã€‚è¿™äº›å°åˆ†ç»„ä¼šè¢«ç»„åˆèµ·æ¥ï¼Œå¹¶åœ¨æ”¶åˆ° ACK åï¼Œç”¨åŒä¸€ä¸ªåˆ†ç»„å‘é€å‡ºå»ã€‚</p><p>æ˜¾ç„¶ï¼ŒNagle ç®—æ³•æœ¬èº«çš„æƒ³æ³•è¿˜æ˜¯æŒºå¥½çš„ï¼Œä½†æ˜¯çŸ¥é“ Linux é»˜è®¤çš„å»¶è¿Ÿç¡®è®¤æœºåˆ¶åï¼Œä½ åº”è¯¥å°±ä¸è¿™ä¹ˆæƒ³äº†ã€‚å› ä¸ºå®ƒä»¬ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œç½‘ç»œå»¶è¿Ÿä¼šæ˜æ˜¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c5/c6/c51439692921cbf67b746a45fded2ec6.png?wh=672*934\" alt=\"\"></p><ul>\n<li>\n<p>å½“ Sever å‘é€äº†ç¬¬ä¸€ä¸ªåˆ†ç»„åï¼Œç”±äº Client å¼€å¯äº†å»¶è¿Ÿç¡®è®¤ï¼Œå°±éœ€è¦ç­‰å¾… 40ms åæ‰ä¼šå›å¤ ACKã€‚</p>\n</li>\n<li>\n<p>åŒæ—¶ï¼Œç”±äº Server ç«¯å¼€å¯äº† Nagleï¼Œè€Œè¿™æ—¶è¿˜æ²¡æ”¶åˆ°ç¬¬ä¸€ä¸ªåˆ†ç»„çš„ ACKï¼ŒServer ä¹Ÿä¼šåœ¨è¿™é‡Œä¸€ç›´ç­‰ç€ã€‚</p>\n</li>\n<li>\n<p>ç›´åˆ° 40ms è¶…æ—¶åï¼ŒClient æ‰ä¼šå›å¤ACKï¼Œç„¶åï¼ŒServer æ‰ä¼šç»§ç»­å‘é€ç¬¬äºŒä¸ªåˆ†ç»„ã€‚</p>\n</li>\n</ul><p>æ—¢ç„¶å¯èƒ½æ˜¯ Nagle çš„é—®é¢˜ï¼Œé‚£è¯¥æ€ä¹ˆçŸ¥é“ï¼Œæ¡ˆä¾‹ Nginx æœ‰æ²¡æœ‰å¼€å¯ Nagle å‘¢ï¼Ÿ</p><p>æŸ¥è¯¢ tcp çš„æ–‡æ¡£ï¼Œä½ å°±ä¼šçŸ¥é“ï¼Œåªæœ‰è®¾ç½®äº† TCP_NODELAY åï¼ŒNagle ç®—æ³•æ‰ä¼šç¦ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹ Nginx çš„ tcp_nodelay é€‰é¡¹å°±å¯ä»¥äº†ã€‚</p><pre><code>TCP_NODELAY\n              If set, disable the Nagle algorithm.  This means that segments are always sent as soon as possible, even\n              if there is only a small amount of data.  When not set, data is buffered until  there  is  a  sufficient\n              amount  to  send out, thereby avoiding the frequent sending of small packets, which results in poor utiâ€\n              lization of the network.  This option is overridden by TCP_CORK; however, setting this option forces  an\n              explicit flush of pending output, even if TCP_CORK is currently set.\n</code></pre><p>æˆ‘ä»¬å›åˆ°ç»ˆç«¯ä¸€ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹æ¡ˆä¾‹ Nginx çš„é…ç½®:</p><pre><code>$ docker exec nginx cat /etc/nginx/nginx.conf | grep tcp_nodelay\n    tcp_nodelay    off;\n</code></pre><p>æœç„¶ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¡ˆä¾‹ Nginx çš„ tcp_nodelay æ˜¯å…³é—­çš„ï¼Œå°†å…¶è®¾ç½®ä¸º on ï¼Œåº”è¯¥å°±å¯ä»¥è§£å†³äº†ã€‚</p><p>æ”¹å®Œåï¼Œé—®é¢˜æ˜¯å¦å°±è§£å†³äº†å‘¢ï¼Ÿè‡ªç„¶éœ€è¦éªŒè¯æˆ‘ä»¬ä¸€ä¸‹ã€‚ä¿®æ”¹åçš„åº”ç”¨ï¼Œæˆ‘å·²ç»æ‰“åŒ…åˆ°äº†Docker é•œåƒä¸­ï¼Œåœ¨ç»ˆç«¯ä¸€ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½ å°±å¯ä»¥å¯åŠ¨å®ƒï¼š</p><pre><code># åˆ é™¤æ¡ˆä¾‹åº”ç”¨\n$ docker rm -f nginx\n\n# å¯åŠ¨ä¼˜åŒ–åçš„åº”ç”¨\n$ docker run --name nginx --network=host -itd feisky/nginx:nodelay\n</code></pre><p>æ¥ç€ï¼Œåˆ‡æ¢åˆ°ç»ˆç«¯äºŒï¼Œé‡æ–°æ‰§è¡Œ wrk æµ‹è¯•å»¶è¿Ÿï¼š</p><pre><code>$ wrk --latency -c 100 -t 2 --timeout 2 http://192.168.0.30:8080/\nRunning 10s test @ http://192.168.0.30:8080/\n  2 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     9.58ms   14.98ms 350.08ms   97.91%\n    Req/Sec     6.22k   282.13     6.93k    68.50%\n  Latency Distribution\n     50%    7.78ms\n     75%    8.20ms\n     90%    9.02ms\n     99%   73.14ms\n  123990 requests in 10.01s, 100.50MB read\nRequests/sec:  12384.04\nTransfer/sec:     10.04MB\n</code></pre><p>æœç„¶ï¼Œç°åœ¨å»¶è¿Ÿå·²ç»ç¼©çŸ­æˆäº† 9msï¼Œè·Ÿæˆ‘ä»¬æµ‹è¯•çš„å®˜æ–¹ Nginx é•œåƒæ˜¯ä¸€æ ·çš„ï¼ˆNginx é»˜è®¤å°±æ˜¯å¼€å¯ tcp_nodelay çš„ï¼‰ ã€‚</p><p>ä½œä¸ºå¯¹æ¯”ï¼Œæˆ‘ä»¬ç”¨ tcpdump ï¼ŒæŠ“å–ä¼˜åŒ–åçš„ç½‘ç»œåŒ…ï¼ˆè¿™å„¿å®é™…ä¸ŠæŠ“å–çš„æ˜¯å®˜æ–¹ Nginx ç›‘å¬çš„ 80 ç«¯å£ï¼‰ã€‚ä½ å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/ba/b5f1643cdca33f29408881542fca4eba.png?wh=1599*621\" alt=\"\"></p><p>ä»å›¾ä¸­ä½ å¯ä»¥å‘ç°ï¼Œç”±äº Nginx ä¸ç”¨å†ç­‰ ACKï¼Œ536 å’Œ 540 ä¸¤ä¸ªåˆ†ç»„æ˜¯è¿ç»­å‘é€çš„ï¼›è€Œå®¢æˆ·ç«¯å‘¢ï¼Œè™½ç„¶ä»å¼€å¯äº†å»¶è¿Ÿç¡®è®¤ï¼Œä½†è¿™æ—¶æ”¶åˆ°äº†ä¸¤ä¸ªéœ€è¦å›å¤ ACK çš„åŒ…ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨ç­‰ 40msï¼Œå¯ä»¥ç›´æ¥åˆå¹¶å›å¤ ACKã€‚</p><p>æ¡ˆä¾‹æœ€åï¼Œä¸è¦å¿˜è®°åœæ­¢è¿™ä¸¤ä¸ªå®¹å™¨åº”ç”¨ã€‚åœ¨ç»ˆç«¯ä¸€ä¸­ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥åˆ é™¤æ¡ˆä¾‹åº”ç”¨ï¼š</p><pre><code>$ docker rm -f nginx good\n</code></pre><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ç½‘ç»œå»¶è¿Ÿå¢å¤§åçš„åˆ†ææ–¹æ³•ã€‚ç½‘ç»œå»¶è¿Ÿï¼Œæ˜¯æœ€æ ¸å¿ƒçš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡ã€‚ç”±äºç½‘ç»œä¼ è¾“ã€ç½‘ç»œåŒ…å¤„ç†ç­‰å„ç§å› ç´ çš„å½±å“ï¼Œç½‘ç»œå»¶è¿Ÿä¸å¯é¿å…ã€‚ä½†è¿‡å¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œä¼šç›´æ¥å½±å“ç”¨æˆ·çš„ä½“éªŒã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å‘ç°ç½‘ç»œå»¶è¿Ÿå¢å¤§åï¼Œä½ å¯ä»¥ç”¨ tracerouteã€hping3ã€tcpdumpã€Wiresharkã€strace ç­‰å¤šç§å·¥å…·ï¼Œæ¥å®šä½ç½‘ç»œä¸­çš„æ½œåœ¨é—®é¢˜ã€‚æ¯”å¦‚ï¼Œ</p><ul>\n<li>\n<p>ä½¿ç”¨ hping3 ä»¥åŠ wrk ç­‰å·¥å…·ï¼Œç¡®è®¤å•æ¬¡è¯·æ±‚å’Œå¹¶å‘è¯·æ±‚æƒ…å†µçš„ç½‘ç»œå»¶è¿Ÿæ˜¯å¦æ­£å¸¸ã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨ tracerouteï¼Œç¡®è®¤è·¯ç”±æ˜¯å¦æ­£ç¡®ï¼Œå¹¶æŸ¥çœ‹è·¯ç”±ä¸­æ¯ä¸€è·³ç½‘å…³çš„å»¶è¿Ÿã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨ tcpdump å’Œ Wiresharkï¼Œç¡®è®¤ç½‘ç»œåŒ…çš„æ”¶å‘æ˜¯å¦æ­£å¸¸ã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨ strace ç­‰ï¼Œè§‚å¯Ÿåº”ç”¨ç¨‹åºå¯¹ç½‘ç»œå¥—æ¥å­—çš„è°ƒç”¨æƒ…å†µæ˜¯å¦æ­£å¸¸ã€‚</p>\n</li>\n</ul><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä¾æ¬¡ä»è·¯ç”±ã€ç½‘ç»œåŒ…çš„æ”¶å‘ã€å†åˆ°åº”ç”¨ç¨‹åºç­‰ï¼Œé€å±‚æ’æŸ¥ï¼Œç›´åˆ°å®šä½é—®é¢˜æ ¹æºã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œæˆ‘æƒ³é‚€è¯·ä½ ä¸€èµ·æ¥èŠèŠï¼Œä½ æ‰€ç†è§£çš„ç½‘ç»œå»¶è¿Ÿï¼Œä»¥åŠåœ¨å‘ç°ç½‘ç»œå»¶è¿Ÿå¢å¤§æ—¶ï¼Œä½ åˆæ˜¯æ€ä¹ˆåˆ†æçš„å‘¢ï¼Ÿä½ å¯ä»¥ç»“åˆä»Šå¤©çš„å†…å®¹ï¼Œå’Œä½ è‡ªå·±çš„æ“ä½œè®°å½•ï¼Œæ¥æ€»ç»“æ€è·¯ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>","neighbors":{"left":{"article_title":"39 | æ¡ˆä¾‹ç¯‡ï¼šæ€ä¹ˆç¼“è§£ DDoS æ”»å‡»å¸¦æ¥çš„æ€§èƒ½ä¸‹é™é—®é¢˜ï¼Ÿ","id":82573},"right":{"article_title":"41 | æ¡ˆä¾‹ç¯‡ï¼šå¦‚ä½•ä¼˜åŒ– NAT æ€§èƒ½ï¼Ÿï¼ˆä¸Šï¼‰","id":83189}},"comments":[{"had_liked":false,"id":72517,"user_name":"Christmas","can_delete":false,"product_type":"c1","uid":1219172,"ip_address":"","ucode":"F48F6BE4A7595B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/64/ad837224.jpg","comment_is_top":false,"comment_ctime":1551663321,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70271140057","product_id":100020901,"comment_content":"ä»¥å‰ç»å¸¸çœ‹åˆ°tcp no delayçš„socketè®¾ç½®ï¼Œä¸€ç›´ä¸æ±‚ç”šè§£ï¼Œè¿™æ¬¡ç»ˆäºæ‡‚äº†ï¼Œnagleç®—æ³•","like_count":17},{"had_liked":false,"id":69584,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1550794500,"is_pvip":false,"replies":[{"id":"25327","content":"ğŸ˜Šè°¢è°¢åˆ†äº«ä½ çš„ç»éªŒ","user_name":"ä½œè€…å›å¤","comment_id":69584,"uid":"1001282","ip_address":"","utype":1,"ctime":1551193165,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"65975303940","product_id":100020901,"comment_content":"[D40æ‰“å¡]<br>æˆ‘ä¹‹å‰ç†è§£çš„ç½‘ç»œå»¶è¿Ÿåˆ†ä¸‰éƒ¨åˆ†ï¼šå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€»è¾‘å¤„ç†ï¼ŒæœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯åˆ°è€—æ—¶ã€‚<br><br>å…¶ä¸­æœåŠ¡ç«¯é€»è¾‘å¤„ç†çš„è€—æ—¶æ˜¯è·Ÿè‡ªèº«ç¨‹åºæœ‰å…³çš„ï¼Œå¦å¤–ä¸¤ä¸ªè€—æ—¶è·Ÿå®½å¸¦æœåŠ¡æä¾›å•†æœ‰å…³ï¼Œæƒ³æ›´çŸ­çš„è€—æ—¶å°±å¾—åŠ é’±ï¼šé€‰æ›´ä¼˜çš„çº¿è·¯æˆ–è€…åœ¨é è¿‘å®¢æˆ·ç«¯çš„åœ°æ–¹åŠ å…¥å£ã€‚<br><br>ç›®å‰æˆ‘ä»¬çº¿ä¸Šç¨‹åºæ˜¯å¯ä»¥æ¨ç®—å‡ºå•æ¬¡å“åº”çš„æ—¶é—´çš„ï¼Œå› ä¸ºåœ¨å‡ºå…¥å£çš„åœ°æ–¹æœ‰è®°å½•ã€‚ä¸ç®¡ä¸­é—´ç»è¿‡äº†å¤šå°‘æœåŠ¡çš„å¤„ç†ï¼Œéƒ½å¯ä»¥ç®—å‡ºæ€»çš„è€—æ—¶ã€‚<br><br>æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä¸­ä¹ŸåŠ äº†æ±‡æŠ¥åŠŸèƒ½ï¼Œåœ¨å®¢æˆ·ç«¯çš„æŸäº›æ¶ˆæ¯ä¸­ä¼šæ±‡æŠ¥ å®¢æˆ·ç«¯å®é™…å‘é€è¯·æ±‚-&gt;æ”¶åˆ°æœåŠ¡ç«¯å“åº” çš„æ—¶é—´å·®ã€‚è¿™æ ·ä¾¿äºæˆ‘ä»¬ç¡®è®¤å®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µã€‚<br><br>ä»æœ¬æ–‡ä¸­ï¼Œç¬¬ä¸€æ¬¡è§åˆ°äº† Nagle ç®—æ³•ã€‚ä¹ŸçŸ¥é“äº†æœåŠ¡ç«¯å…³é—­icmpæ—¶æ€ä¹ˆç”¨tcp&#47;udpæµ‹è¯•ç½‘ç»œå»¶è¿Ÿã€‚<br><br>æ–‡ä¸­çš„å†…å®¹ä¹Ÿæ˜¯è·Œå®•èµ·ä¼ï¼Œåˆ†æç€æ€ä¹ˆè¿˜æ˜¯å®¢æˆ·ç«¯çš„é—®é¢˜ï¼Œå®¢æˆ·ç«¯è®¿é—®å¦å¤–ä¸€ä¸ªæœåŠ¡è¿˜æ˜¯å¥½çš„ã€‚åŸæ¥æ˜¯æœåŠ¡ç«¯ç¨‹åºä¹Ÿæœ‰é—®é¢˜ï¼Œä¸€ä¸ªå·´æŒæ‹ä¸å“ã€‚ğŸ˜‚<br>","like_count":16,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440176,"discussion_content":"ğŸ˜Šè°¢è°¢åˆ†äº«ä½ çš„ç»éªŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77770,"user_name":"é’çŸ³","can_delete":false,"product_type":"c1","uid":1215531,"ip_address":"","ucode":"B0056AD6453322","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg","comment_is_top":false,"comment_ctime":1552996263,"is_pvip":false,"replies":[{"id":"29610","content":"å—¯","user_name":"ä½œè€…å›å¤","comment_id":77770,"uid":"1001282","ip_address":"","utype":1,"ctime":1554018905,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"31617767335","product_id":100020901,"comment_content":"ç½‘ä¸ŠæŸ¥äº†Nagleç®—æ³•çš„å®šä¹‰ï¼šä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæœªè¢«ç¡®è®¤çš„å°æ®µã€‚æ‰€è°“â€œå°æ®µâ€ï¼ŒæŒ‡çš„æ˜¯å°äºMSSå°ºå¯¸çš„æ•°æ®å—ï¼Œæ‰€è°“â€œæœªè¢«ç¡®è®¤â€ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ•°æ®å—å‘é€å‡ºå»åï¼Œæ²¡æœ‰æ”¶åˆ°å¯¹æ–¹å‘é€çš„ACKç¡®è®¤è¯¥æ•°æ®å·²æ”¶åˆ°ã€‚<br><br>å¯¹æ¯”80ç«¯å£å’Œ8080ç«¯å£çš„æŠ¥æ–‡ï¼Œ80ç«¯å£çš„æŠ¥æ–‡ä¸­ï¼Œå“åº”æ¶ˆæ¯å†å‘é€å®Œheaderåç«‹åˆ»å‘é€bodyéƒ¨åˆ†ï¼›8080ç«¯å£çš„æŠ¥æ–‡ï¼Œå“åº”æ¶ˆæ¯å†å‘é€å®Œheaderåï¼Œéœ€è¦è·å¾—ACKå“åº”åï¼Œæ‰ä¼šå‘é€bodyéƒ¨åˆ†ã€‚<br><br>8080ç«¯å£æŠ¥æ–‡ä¸­serverç«¯åœ¨è·å¾—åˆ°ACKå“åº”åæ‰å‘é€bodyéƒ¨åˆ†ï¼Œå°±æ˜¯å› ä¸ºNagleç®—æ³•å¿…é¡»ç¡®è®¤è¿™ä¸ªæ•°æ®å—è¢«æ”¶åˆ°çš„åŸå› ã€‚clientåœ¨40msåå‘é€ACKæ˜¯å› ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰å¼€å¯TCP_QUICKACKçš„ç¼˜æ•…ã€‚<br><br>è¯·é—®è€å¸ˆï¼Œè¿™æ ·ç†è§£ï¼Œå¯¹å—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443843,"discussion_content":"å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554018905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143099,"user_name":"å¾®å¾®","can_delete":false,"product_type":"c1","uid":1617044,"ip_address":"","ucode":"2C3C934AD8CF7B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MibOYDxw9TDxwBuTyI79AoHlJGeUFiabGtUmdeiaMrjxFy3FXmNFTIAVxrESMojrReIDbhOib4os01uBZdbMBZGCVg/132","comment_is_top":false,"comment_ctime":1571629741,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23046466221","product_id":100020901,"comment_content":"é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œbacklogè®¾ç½®çš„å¾ˆå¤§ï¼Œæœ‰22wï¼Œä½†æ˜¯ç”¨ss -ltnå‘½ä»¤æŸ¥çœ‹è¿™ä¸ªç›‘å¬ç«¯å£çš„Send-Qå’ŒRecv-Qéƒ½æ˜¯0ï¼Œä½†æ˜¯ç”¨å‘½ä»¤netstat -s|egrep &quot;listen|LISTEN&quot;çš„æº¢å‡ºå€¼ä¸€ç›´åœ¨ä¸Šå‡ï¼Œç»Ÿè®¡è¿™ä¸ªç«¯å£çš„è¿æ¥æ•°è¿˜ä¸åˆ°5000ï¼Œè¯·é—®å¯èƒ½ä¼šæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1101226,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cd/aa/33d48789.jpg","nickname":"å«æ±Ÿ","note":"","ucode":"DE2F7A6916F1A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":141545,"discussion_content":"æº¢å‡ºå€¼åœ¨å‡é«˜ï¼Œè¯´æ˜å…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œå…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦æ˜¯ç”±backlogä¸somaxconnå†³å®šçš„ï¼Œä¸ºmin(backlog, somaxconn)ã€‚å¯ä»¥é€šè¿‡ cat /proc/sys/net/core/somaxconn æŸ¥çœ‹å‚æ•°ã€‚","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1579430136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000439,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","nickname":"åˆ˜å†²","note":"","ucode":"0C4F66921AE76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69611,"discussion_content":"è§£å†³äº†ä¹ˆï¼Œæˆ‘ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575295214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98282,"user_name":"å¤§åç‹ç‹¸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1558948066,"is_pvip":false,"replies":[{"id":"35923","content":"ğŸ‘ è°¢è°¢åˆ†äº«","user_name":"ä½œè€…å›å¤","comment_id":98282,"uid":"1001282","ip_address":"","utype":1,"ctime":1559429172,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"18738817250","product_id":100020901,"comment_content":"é¢ ç¬¬äºŒæ¬¡å±…ç„¶curlä¸é€šäº†ã€‚ã€‚18.04 çš„é˜²ç«å¢™æ˜¯ufw ,éœ€è¦ufw allow 80&#47;tcp<br>","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451630,"discussion_content":"ğŸ‘ è°¢è°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559429172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71418,"user_name":"æ¥š","can_delete":false,"product_type":"c1","uid":1154723,"ip_address":"","ucode":"A2F59EBDD6D9EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/a3/0bfaaf13.jpg","comment_is_top":false,"comment_ctime":1551337933,"is_pvip":false,"replies":[{"id":"26308","content":"è¿™ä¸ªå› ç´ æ¯”è¾ƒå¤šï¼ŒRTOè¶…æ—¶è¯´æ˜å·²ç»å‘ç”Ÿæ¥é‡ä¼ ï¼Œæ ¹æºä¸Šè¿˜æ˜¯è¦çœ‹ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿé‡ä¼ ï¼Œæ¯”å¦‚æ˜¯å¦æœ‰ä¸¢åŒ…ã€æ˜¯å¦è¶…å‡ºäº†å†…æ ¸ä¸­çš„èµ„æºé™åˆ¶æˆ–è€…å¯¹ç«¯æ˜¯å¦æœ‰ç±»ä¼¼çš„é—®é¢˜ç­‰ç­‰ã€‚è¿™äº›æœ€å¥½ä¸¤ç«¯æŠ“åŒ…å¯¹æ¯”åˆ†æ","user_name":"ä½œè€…å›å¤","comment_id":71418,"uid":"1001282","ip_address":"","utype":1,"ctime":1551703637,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"18731207117","product_id":100020901,"comment_content":"ä½ å¥½ï¼Œæˆ‘åœ¨ç½‘ç»œç¼–ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ<br>æˆ‘ä»¬ç”¨goè¯­è¨€åšçš„æœåŠ¡è°ƒç”¨å…¶ä»–HTTPæœåŠ¡å™¨ï¼Œå‘ç°HTTPè¯·æ±‚ä¸­å¡ä½ï¼Œæ¦‚ç‡éå¸¸ä½ã€‚<br>ç„¶åæˆ‘çœ‹äº†å‘ç°writeï¼Œè¿”å›eagainï¼Œç„¶åå°±ç­‰å¾…epollé€šçŸ¥æè¿°ç¬¦æ˜¯å¦å¯ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å‘ç°ç­‰äº†å¾ˆä¹…å¾ˆä¹…éƒ½ä¸å¯ç”¨ã€‚netstataçœ‹äº†ä¸‹ï¼ŒTCPå†™bufferæœ‰æ•°æ®ä½†æ˜¯æ²¡æœ‰æ»¡ï¼Œç­‰äº†å¾ˆä¹…ä¹Ÿè²Œä¼¼å‘ç”Ÿä¸å‡ºå»ï¼Œæœ‰é‡ä¼ ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼ ä¸å‡ºå»ã€‚ç›´æ¥è¾¾åˆ°rtoæ¬¡æ•°å†…æ ¸ä¸­æ–­è¿æ¥ã€‚<br>æˆ‘ä»¬åªèƒ½å°†rtoæ”¹å¾ˆå°è®©å†…æ ¸ä¸­æ–­è¿æ¥ã€‚<br>è¯·é—®è¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯ç”±ä»€ä¹ˆåŸå› å¼•èµ·çš„å‘¢ï¼Ÿ<br>","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441141,"discussion_content":"è¿™ä¸ªå› ç´ æ¯”è¾ƒå¤šï¼ŒRTOè¶…æ—¶è¯´æ˜å·²ç»å‘ç”Ÿæ¥é‡ä¼ ï¼Œæ ¹æºä¸Šè¿˜æ˜¯è¦çœ‹ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿé‡ä¼ ï¼Œæ¯”å¦‚æ˜¯å¦æœ‰ä¸¢åŒ…ã€æ˜¯å¦è¶…å‡ºäº†å†…æ ¸ä¸­çš„èµ„æºé™åˆ¶æˆ–è€…å¯¹ç«¯æ˜¯å¦æœ‰ç±»ä¼¼çš„é—®é¢˜ç­‰ç­‰ã€‚è¿™äº›æœ€å¥½ä¸¤ç«¯æŠ“åŒ…å¯¹æ¯”åˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551703637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69593,"user_name":"å°è™¾ç±³","can_delete":false,"product_type":"c1","uid":1005528,"ip_address":"","ucode":"F543987A7FAB20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg","comment_is_top":false,"comment_ctime":1550795325,"is_pvip":false,"replies":[{"id":"24853","content":"çœ‹ç³»ç»Ÿçš„ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œåªæœ‰RHELå¯ä»¥é€šè¿‡&#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_delack_minä¿®æ”¹ï¼ˆé»˜è®¤40msï¼‰ï¼Œè€Œå…¶ä»–å‘è¡Œç‰ˆéƒ½ä¸æ”¯æŒã€‚","user_name":"ä½œè€…å›å¤","comment_id":69593,"uid":"1001282","ip_address":"","utype":1,"ctime":1550851723,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"18730664509","product_id":100020901,"comment_content":"æˆ‘è®°å¾—ä¹‹å‰ç¢°åˆ°çš„å»¶è¿Ÿackæ˜¯200msï¼Œè¿™ä¸ªæ˜¯å¯ä»¥é…ç½®çš„å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440180,"discussion_content":"çœ‹ç³»ç»Ÿçš„ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œåªæœ‰RHELå¯ä»¥é€šè¿‡/proc/sys/net/ipv4/tcp_delack_minä¿®æ”¹ï¼ˆé»˜è®¤40msï¼‰ï¼Œè€Œå…¶ä»–å‘è¡Œç‰ˆéƒ½ä¸æ”¯æŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550851723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250379,"user_name":"éª‘é©´æ‰¾ä½ ","can_delete":false,"product_type":"c1","uid":2118161,"ip_address":"","ucode":"FB9E7511C00BEA","user_header":"https://static001.geekbang.org/account/avatar/00/20/52/11/af170b65.jpg","comment_is_top":false,"comment_ctime":1601042147,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10190976739","product_id":100020901,"comment_content":"40msæœ€å°å»¶è¿Ÿç¡®è®¤æ˜¯æœ‰ä¸€ä¸ªç®—æ³•çš„ï¼Œé‚£æˆ‘è‡ªå·±çš„centos8ä¸¾ä¾‹ï¼š<br>&#47;usr&#47;src&#47;kernels&#47;4.18.0-80.el8.x86_64+debug&#47;include&#47;net&#47;tcp.hæ–‡ä»¶ä¸­è®°å½•äº†è¿™ä¸ªå˜é‡&#47;å®çš„å®šä¹‰ï¼š<br>#define TCP_DELACK_MAX  ((unsigned)(HZ&#47;5))      &#47;* maximal time to delay before sending an ACK *&#47;<br>#if HZ &gt;= 100<br>#define TCP_DELACK_MIN  ((unsigned)(HZ&#47;25))     &#47;* minimal time to delay before sending an ACK *&#47;<br>HZçš„å€¼å¯ä»¥åˆ©ç”¨è€å¸ˆä¹‹å‰è®²è¿‡çš„è½¯ä¸­æ–­ç›¸å…³çŸ¥è¯†è®¡ç®—å‡ºæ¥ï¼Œå³ç›¸éš”10sè®¡ç®—&#47;proc&#47;interruptsé‡Œé¢çš„ä¸­æ–­æ¬¡æ•°å˜åŒ–ï¼Œä¸¤æ¬¡åšå·®å†é™¤ä»¥10å°±æ˜¯æ¯ç§’çš„ä¸­æ–­æ•°ï¼Œæˆ‘è¿™è¾¹è®¡ç®—å‡ºæ¥çš„å€¼æ˜¯1005ï¼Œé‚£ä¹ˆHZå°±åº”è¯¥æ˜¯1000ï¼Œæ‰€ä»¥1000&#47;25=40ms","like_count":3},{"had_liked":false,"id":79257,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553418501,"is_pvip":false,"replies":[{"id":"29343","content":"æ˜¯ä¸æ˜¯è¿˜æœ‰å…¶ä»–æŠ¥é”™ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":79257,"uid":"1001282","ip_address":"","utype":1,"ctime":1553698940,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10143353093","product_id":100020901,"comment_content":"ä¸ºä»€ä¹ˆæ‰§è¡Œstrace -f wrk --latency -c 100 -t 2 --timeout 2 http:&#47;&#47;192.168.126.136:8080&#47;ï¼Œè¾“å‡ºç»“æœä¸­å¹¶æ²¡æœ‰TCP_NODELAYé…ç½®é€‰é¡¹å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444420,"discussion_content":"æ˜¯ä¸æ˜¯è¿˜æœ‰å…¶ä»–æŠ¥é”™ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553698940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69590,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1550795189,"is_pvip":false,"replies":[{"id":"25329","content":"å—¯ï¼Œåªæ˜¯å®¢æˆ·ç«¯æœ‰å¯èƒ½åœ¨ç”¨æˆ·é‚£å„¿ï¼Œå¯èƒ½æ— æ³•æ§åˆ¶è¿™äº›é€‰é¡¹","user_name":"ä½œè€…å›å¤","comment_id":69590,"uid":"1001282","ip_address":"","utype":1,"ctime":1551193287,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10140729781","product_id":100020901,"comment_content":"æ¡ˆä¾‹ä¸­èƒ½è®¾ç½®å®¢æˆ·ç«¯çš„TCP_QUICKACKè§£å†³å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440178,"discussion_content":"å—¯ï¼Œåªæ˜¯å®¢æˆ·ç«¯æœ‰å¯èƒ½åœ¨ç”¨æˆ·é‚£å„¿ï¼Œå¯èƒ½æ— æ³•æ§åˆ¶è¿™äº›é€‰é¡¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305716,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","comment_is_top":false,"comment_ctime":1628130629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5923097925","product_id":100020901,"comment_content":"1. hping3 -c 3 -S -p 80 baidu.com<br>traceroute --tcp -p 80 -n baidu.com<br>2.  wrk --latency -c 100 -t 2 --timeout 2 http:&#47;&#47;192.168.0.30&#47;<br>3.  tcpdump -nn tcp port 8080 -w nginx.pcap<br>4. man tcp---TCP_QUICKACK,TCP_NODELAY<br>5. strace -f wrk --latency -c 100 -t 2 --timeout 2 http:&#47;&#47;192.168.0.30:8080&#47;<br>6. Nagle ç®—æ³•ï¼Œæ˜¯ TCP åè®®ä¸­ç”¨äºå‡å°‘å°åŒ…å‘é€æ•°é‡çš„ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œå®ƒé€šè¿‡åˆå¹¶ TCP å°åŒ…,ç›®çš„æ˜¯ä¸ºäº†æé«˜å®é™…å¸¦å®½çš„åˆ©ç”¨ç‡,<br>7.  Wiresharkåˆ†æ","like_count":2},{"had_liked":false,"id":305114,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1627825430,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5922792726","product_id":100020901,"comment_content":"æœ¬æ–‡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¡ˆä¾‹ï¼Œæ¡ç†æ¸…æ™°ï¼Œã€‚æŠ›ç –å¼•ç‰ï¼Œæˆ‘åˆ†äº«ä¸€ä¸ªåˆ†ætcpæ–­è¿çš„æ¡ˆä¾‹åˆ†æï¼šhttps:&#47;&#47;mp.weixin.qq.com&#47;s&#47;XS3Jnn3Xl4_12gzg0zrSTA","like_count":2},{"had_liked":false,"id":297090,"user_name":"Geek_b85295","can_delete":false,"product_type":"c1","uid":1487998,"ip_address":"","ucode":"51CBB577C255EA","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqtXSgThiaEiaEqqic5YIJ7v469nCM3VXiccOJ4SxbYjW91ciczuYYEzcTVtYWaWXaokZqShuLdKsXjnFA/132","comment_is_top":false,"comment_ctime":1623305913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5918273209","product_id":100020901,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªè¯·æ±‚æ²¡æœ‰å»¶è¿Ÿï¼Œç¬¬äºŒä¸ªè¯·æ±‚æ‰å¼€å§‹æœ‰å»¶è¿Ÿ","like_count":1},{"had_liked":false,"id":91981,"user_name":"skye","can_delete":false,"product_type":"c1","uid":1027840,"ip_address":"","ucode":"C55C9F52C78A00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","comment_is_top":false,"comment_ctime":1557148791,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5852116087","product_id":100020901,"comment_content":"é‚£nagleç®—æ³•ç”¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394042,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631695197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69668,"user_name":"æ€€ç‰¹","can_delete":false,"product_type":"c1","uid":1072331,"ip_address":"","ucode":"3DACB205798ED3","user_header":"https://static001.geekbang.org/account/avatar/00/10/5c/cb/3ebdcc49.jpg","comment_is_top":false,"comment_ctime":1550805217,"is_pvip":true,"replies":[{"id":"25331","content":"å°±æ˜¯è¯´æ˜Ÿå·è¡¨ç¤ºæ²¡æœ‰æ”¶åˆ°è¿™ä¸€è·³çš„å“åº”","user_name":"ä½œè€…å›å¤","comment_id":69668,"uid":"1001282","ip_address":"","utype":1,"ctime":1551193429,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":2,"race_medal":0,"score":"5845772513","product_id":100020901,"comment_content":"traceroute ä¼šåœ¨è·¯ç”±çš„æ¯ä¸€è·³å‘é€ä¸‰ä¸ªåŒ…ï¼Œå¹¶åœ¨æ”¶åˆ°å“åº”åï¼Œè¾“å‡ºå¾€è¿”å»¶æ—¶ã€‚å¦‚æœæ— å“åº”æˆ–è€…å“åº”è¶…æ—¶ï¼ˆé»˜è®¤ 5sï¼‰ï¼Œå°±ä¼šè¾“å‡ºä¸€ä¸ªæ˜Ÿå·ã€‚<br>----è¿™ä¸ªåœ°æ–¹ï¼Œè¿˜æœ‰äº›ä¸æ˜ç™½ï¼Œå¸Œæœ›è€å¸ˆèƒ½åœ¨è¿™é‡Œå†è§£é‡Šå‡ å¥<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440218,"discussion_content":"å°±æ˜¯è¯´æ˜Ÿå·è¡¨ç¤ºæ²¡æœ‰æ”¶åˆ°è¿™ä¸€è·³çš„å“åº”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1405256,"avatar":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","nickname":"å‡¯","note":"","ucode":"60DB11CF72C7B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321564,"discussion_content":"å¯èƒ½æ˜¯ç¦æ­¢tractäº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604589941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347799,"user_name":"DayDayUp","can_delete":false,"product_type":"c1","uid":1610552,"ip_address":"","ucode":"9C53659518AB74","user_header":"https://static001.geekbang.org/account/avatar/00/18/93/38/71615300.jpg","comment_is_top":false,"comment_ctime":1654439969,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1654439969","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨æƒ³ï¼Œæ¡ˆä¾‹ä¸­çš„æ°å¥½æ˜¯â€œå»¶è¿Ÿå›å¤â€ + â€œNagle ç®—æ³•â€çš„â€œå¶é‡â€å¯¼è‡´äº†è¿™ä¸ªå»¶æ—¶ï¼Œå¦‚æœæœ‰å¤§é‡æ•°æ®åŒ…çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆä¸€ä¸¤ä¸ªåŒ…å¯èƒ½æ˜¯å»¶è¿Ÿçš„ï¼Œå¦‚æœæœ‰å¤§é‡æ•°æ®åŒ…çš„æƒ…å†µä¸‹åº”è¯¥å°±æ²¡æœ‰é—®é¢˜äº†å§ã€‚å› ä¸ºå®¢æˆ·ç«¯ä¼šæŠŠæ‰€æœ‰ACKæ”’é½ä¸€èµ·å‘é€ï¼Œè€ŒæœåŠ¡ç«¯ä¹Ÿæ˜¯å°†æ•°æ®åŒ…çš„æ•°æ®éƒ¨åˆ†å‡‘æ»¡å‘é€ã€‚<br><br>æ„Ÿè§‰æ•´ä½“ä¸ä¼šæœ‰ç‰¹åˆ«å¤§çš„æ—¶å»¶ã€‚","like_count":1},{"had_liked":false,"id":328181,"user_name":"jaxzhai","can_delete":false,"product_type":"c1","uid":1182911,"ip_address":"","ucode":"B65A8EE7A061FC","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/bf/863d440a.jpg","comment_is_top":false,"comment_ctime":1640591041,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640591041","product_id":100020901,"comment_content":"æˆ‘ä»¬ä¸šåŠ¡è¯·æ±‚oracleé‡åˆ°ä¸€ä¸ªåŒæ · å»¶è¿Ÿç¡®è®¤çš„é—®é¢˜ï¼Œä½†æˆ‘ä»¬å®¢æˆ·ç«¯åŠ ä¸Š TCP_NODELAY  è¿˜æ˜¯åŒæ ·çš„é—®é¢˜ï¼Œç°åœ¨ä¸çŸ¥é“æ€ä¹ˆå¼„äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":312228,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1631694507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631694507","product_id":100020901,"comment_content":"æŠ“åŒ…å°±æ˜¯çœ‹ä¸æ‡‚å“ªä¸ªè¿ç€å“ªä¸ªï¼Œè¿™ä¸ªseqå’Œackå¤ªä¹±äº†","like_count":0},{"had_liked":false,"id":294806,"user_name":"æ±Ÿ","can_delete":false,"product_type":"c1","uid":1398148,"ip_address":"","ucode":"DA8378171C959E","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIC5FK1ibcFwyTQ5TugfhJicSsZ3x5GfibRrUNTxpb8IY88wNREl4GlbJqUUibCHAhZp9wqic2eia2Dpgsw/132","comment_is_top":false,"comment_ctime":1622097246,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1622097246","product_id":100020901,"comment_content":"ä¹‹å‰é‡åˆ°è¿‡ping å†…ç½‘IPå¶å‘å»¶æ—¶å˜é«˜çš„é—®é¢˜ï¼Œåæ¥æŸ¥äº†å‘ç°å’Œç½‘å¡ä¸­æ–­æœ‰å…³ï¼›ä¸çŸ¥é“è¿™éƒ¨åˆ†è€å¸ˆæœ‰æ²¡æœ‰ç»éªŒï¼Œä¸ºå•¥ä¼šæœ‰å½±å“ã€‚","like_count":0},{"had_liked":false,"id":281899,"user_name":"Geek_392979","can_delete":false,"product_type":"c1","uid":2149562,"ip_address":"","ucode":"BE8A0B47CDF562","user_header":"","comment_is_top":false,"comment_ctime":1614938458,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1614938458","product_id":100020901,"comment_content":"è€å¸ˆï¼Œå­¦äº†è¯¾ç¨‹åï¼Œ é¢è¯•çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜: &quot;1000å°æœåŠ¡å™¨ï¼Œ 95%çš„æœåŠ¡å™¨QPSæ­£å¸¸(1000QPS), å…¶ä»–çš„æ˜¯2000QPS, cpuæ­£å¸¸, æ€ä¹ˆæ’æŸ¥ï¼Ÿ&quot;<br>æˆ‘çš„æ€è·¯æ˜¯é¦–å…ˆçœ‹å¹³å‡è´Ÿè½½ï¼Œ å¦‚æœå¹³å‡è´Ÿè½½é«˜ï¼Œçœ‹æ˜¯ä»€ä¹ˆå¯¼è‡´çš„å¹³å±€è´Ÿè½½é«˜ã€‚ä¾æ¬¡çœ‹å„ä¸ªCPUåˆ©ç”¨ç‡ï¼Œä½†é¢˜ç›®é‡Œè¯´CPUæ­£å¸¸ã€‚ç„¶åèƒ½æƒ³åˆ°çš„å°±æ˜¯ï¼š<br>1. sar -n DEV 2 10 çœ‹æ•´ä¸ªçš„ç½‘ç»œæ”¶å‘æƒ…å†µ<br>2. traceroute --tcp -p port -n xxx.xxx.com çœ‹åˆ°ç›®æ ‡æœåŠ¡çš„ç½‘ç»œå»¶æ—¶<br>3. pstackçœ‹ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç¨‹åºçš„è°ƒç”¨å †æ ˆï¼Œæ˜¯ä¸æ˜¯é˜»å¡åœ¨æŸä¸ªè°ƒç”¨ä¸Š<br>4. perf topåˆ†æç›®æ ‡åº”ç”¨ç¨‹åº<br><br>æ„Ÿè§‰è¿™æ ·çš„ç­”æ¡ˆæ²¡æœ‰è®©é¢è¯•å®˜æ»¡æ„ï¼Œ æ‰€ä»¥è€å¸ˆé‡åˆ°è¿™ç§é—®é¢˜åº”è¯¥æ€ä¹ˆåˆ†æï¼Ÿ åˆ°ç›®æ ‡æœåŠ¡å™¨çš„å»¶æ—¶é«˜å’ŒQPSä½æ˜¯æ­£ç›¸å…³çš„å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"å¤å¤©","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372139,"discussion_content":"æ²¡è¯´åˆ°ç‚¹å­ä¸Šï¼Œæœ‰è‹¥å¹²å°qps é«˜\n1.å…ˆçœ‹æœºå™¨é…ç½®æ˜¯å¦ç›¸åŒ\n2.å¦‚æœé…ç½®ç›¸åŒï¼Œè´Ÿè½½å‡è¡¡æƒé‡æ˜¯å¦ç›¸åŒ\n3.æ²¡å·®åˆ«å†åˆ†æç¨‹åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620207109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2149562,"avatar":"","nickname":"Geek_392979","note":"","ucode":"BE8A0B47CDF562","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353136,"discussion_content":"å†™é”™äº†ï¼Œæ­£å¸¸çš„QPSæ˜¯10000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615021393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281014,"user_name":"å¤§æ‹‡å“¥","can_delete":false,"product_type":"c1","uid":1161483,"ip_address":"","ucode":"888C59A8045B5B","user_header":"https://static001.geekbang.org/account/avatar/00/11/b9/0b/cdf98d11.jpg","comment_is_top":false,"comment_ctime":1614525506,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614525506","product_id":100020901,"comment_content":"æœ¬æ–‡è™½ç„¶åˆ†æå‡ºäº†åŸå› ï¼Œå¹¶ä¸”æŒ‰ç…§æ­¤åŸå› ï¼Œé‚£Nagleç®—æ³•å°±åªèƒ½åœ¨å®¢æˆ·ç«¯æ”¯æŒQUICACKçš„åœºæ™¯ä¸‹æ‰ä½¿ç”¨ï¼Œå…¶å®ƒåœºæ™¯å°±æ²¡ä»€ä¹ˆå¥½å¤„äº†ï¼Ÿæˆ–è€…è¯´æœ¬èº«Nagleè§£å†³çš„å°åŒ…å¤šæ¬¡ä¼ è¾“çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœä¸šåŠ¡åœºæ™¯ä¸­å¤šæ˜¯å°åŒ…åœºæ™¯ï¼Œé‚£å¼€å¯Nagleæ€§èƒ½å°±æ›´å¥½ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©ï¼Ÿ","like_count":0},{"had_liked":false,"id":261017,"user_name":"æµ·ç›—èˆ¹é•¿","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1605173943,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1605173943","product_id":100020901,"comment_content":"è¯·æ•™ä¸‹é£å“¥ï¼Œå¦‚æœé‡åˆ°connect: connection timed out è¿™ç§é”™è¯¯ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"å¤å¤©","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372140,"discussion_content":"åˆ†ææ˜¯å“ªä¸€æ­¥è¶…æ—¶äº†ã€‚æ˜¯ä»£ç†æœåŠ¡å™¨è¿˜æ˜¯åº”ç”¨æœåŠ¡å™¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620207188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241990,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1597552922,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597552922","product_id":100020901,"comment_content":"å¾ˆæ£’çš„ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä¸²è”èµ·æ¥é™¶è¾‰è€å¸ˆè¯¾ç¨‹ä¸­å…³äºå»¶è¿Ÿç¡®è®¤ ã€nagleç›¸å…³çŸ¥è¯†ã€‚ä¹Ÿè¢«ç§‘æ™®äº†ä¸€æ³¢ä¸ºä»€ä¹ˆä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒçš„pingéƒ½è¢«ç¦æ­¢äº†ã€‚","like_count":1},{"had_liked":false,"id":228524,"user_name":"æ™¯b","can_delete":false,"product_type":"c1","uid":1025641,"ip_address":"","ucode":"70E04E6B30432C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/69/cf2eb6be.jpg","comment_is_top":false,"comment_ctime":1592725953,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1592725953","product_id":100020901,"comment_content":"TCP Flows é‚£ä¸ªåœ°æ–¹å±•ç¤ºçš„å›¾ï¼Œæ˜¯tcpæµ  <br>æ€ä¹ˆä»è¿™ä¸ªå›¾ï¼ˆä¸Šå›¾çº¢æ¡†ç”»çš„é‚£äº›ï¼‰çŸ¥é“è¿™äº›æŠ¥æ–‡å“ªäº›æ˜¯ ç¬¬ä¸€ä¸ªhttpå“åº”çš„ç»“æŸç‚¹å’Œç¬¬äºŒä¸ªè¯·æ±‚çš„å¼€å§‹ç‚¹  <br>è¿™ä¸ªåœ°æ–¹æ²¡ææ‡‚<br>","like_count":0,"discussions":[{"author":{"id":2118161,"avatar":"https://static001.geekbang.org/account/avatar/00/20/52/11/af170b65.jpg","nickname":"éª‘é©´æ‰¾ä½ ","note":"","ucode":"FB9E7511C00BEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308716,"discussion_content":"æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯çœ‹wiresharkä¸­çš„åè®®ï¼Œè€å¸ˆçš„ä¾‹å­é‡Œè¿™ä¸ªcurlå…¶å®å°±æ˜¯ä¸€ä¸ªhttpè¯·æ±‚ï¼Œæ‰€ä»¥è¯·æ±‚çš„å¼€å§‹å°±æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œå³å›¾ç‰‡é‡Œçš„åŒ…270ï¼›è¯·æ±‚ç»“æŸçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€200çš„ç¡®è®¤ç ï¼Œå³åŒ…475ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯è¦è¿”å›ä¸€ä¸ªACKï¼Œå³åŒ…476ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è€å¸ˆä¾‹å­çš„é‡Œçš„ç¬¬ä¸€ä¸ªhttpå“åº”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601041860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2118161,"avatar":"https://static001.geekbang.org/account/avatar/00/20/52/11/af170b65.jpg","nickname":"éª‘é©´æ‰¾ä½ ","note":"","ucode":"FB9E7511C00BEA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394043,"discussion_content":"æˆ‘æƒ³ä¸Šé¢åŒå­¦é—®çš„åº”è¯¥ä¹Ÿè¿˜æœ‰TCPçš„å¼€å§‹å’Œç»“æŸï¼Œå½“ç„¶æˆ‘ä¹ŸåŒé—®ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ¯”è¾ƒè¿·ã€‚å¸Œæœ›èµæ•™ï¼Œå¤šè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631695377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308716,"ip_address":""},"score":394043,"extra":""}]}]},{"had_liked":false,"id":223024,"user_name":"Damoncui","can_delete":false,"product_type":"c1","uid":1566446,"ip_address":"","ucode":"5F09EB267F0572","user_header":"https://static001.geekbang.org/account/avatar/00/17/e6/ee/8fdbd5db.jpg","comment_is_top":false,"comment_ctime":1590982918,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590982918","product_id":100020901,"comment_content":"çœŸæ£’ï¼ï¼<br>æ‰“å¡ D12~","like_count":0},{"had_liked":false,"id":203109,"user_name":"æ€€æ£æ¢¦æƒ³çš„å­¦æ¸£","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1586140983,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586140983","product_id":100020901,"comment_content":"å¤ªå¼ºäº†ï¼Œçœ‹æ¡ˆä¾‹çš„æ—¶å€™ï¼Œæˆ‘å°±åœ¨æƒ³ï¼Œä½œè€…å±…ç„¶å¯ä»¥æƒ³åˆ°è¿™ä¹ˆå¤šç»†èŠ‚ã€‚","like_count":0},{"had_liked":false,"id":166764,"user_name":"HelloTalk","can_delete":false,"product_type":"c1","uid":1618633,"ip_address":"","ucode":"F898E6A7C61D39","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/c9/b414a77c.jpg","comment_is_top":false,"comment_ctime":1577589729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577589729","product_id":100020901,"comment_content":"ä¸ºä»€ä¹ˆ TCP Flows é‚£ä¸ªå›¾é‡Œé¢çš„ â€œç¬¬ä¸€æ¬¡è¯·æ±‚å’Œå“åº”â€ çš„ç¬¬ä¸€ä¸ªclient-&gt;serveræ˜¯ PSH+ACKçš„æŠ¥æ–‡å‘¢ï¼Ÿ<br><br>æˆ‘æ„Ÿè§‰å­ä¸€ä¸ªæŠ¥æ–‡åº”è¯¥æ˜¯çº¯packetæ‰å¯¹é˜¿ï¼Œåé¢å®¢æˆ·ç«¯å›çš„æŠ¥æ–‡æ‰æ˜¯ PSH+ACK<br>","like_count":0},{"had_liked":false,"id":127437,"user_name":"Magic Star Trace","can_delete":false,"product_type":"c1","uid":1297017,"ip_address":"","ucode":"15360D39BC32D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/79/139615aa.jpg","comment_is_top":false,"comment_ctime":1566711065,"is_pvip":false,"replies":[{"id":"47207","content":"ç”¨æœ¬æ–‡çš„æ€è·¯åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå‘ç°ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1566743361,"ip_address":"","comment_id":127437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566711065","product_id":100020901,"comment_content":"è¯·é—®ï¼šç‰©ç†æœºcentos 7 ï¼Œkvm ä¸Šè™šæ‹Ÿæœº ä¸¢åŒ…ä¸ç¨³å®šæ˜¯ä»€ä¹ˆé—®é¢˜å¯¼è‡´çš„å‘¢ï¼Ÿ<br>time å»¶è¿Ÿå¾ˆä¸ç¨³å®š","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464490,"discussion_content":"ç”¨æœ¬æ–‡çš„æ€è·¯åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå‘ç°ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566743361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106749,"user_name":"é˜³å…‰æ¢¦","can_delete":false,"product_type":"c1","uid":1283965,"ip_address":"","ucode":"55BDA128D39931","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/TTPicMEZ5s1zKiaKYecIljicRV9dibITPM0958W3VuNHXlTQic2Dj6XYGibF7dqrG3JWr0LMx7hY9zXGzuvTDNGw8KAA/132","comment_is_top":false,"comment_ctime":1561382859,"is_pvip":false,"replies":[{"id":"40444","content":"è¯•è¯•åŠ¨æ€è¿½è¸ªï¼ˆä¸“æ ç¬¬50ã€51ç¯‡ï¼‰æ€ä¹ˆæ ·ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1562509845,"ip_address":"","comment_id":106749,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561382859","product_id":100020901,"comment_content":"æ‚¨å¥½ï¼Œè¯·æ•™ä¸‹ã€‚æˆ‘é€šè¿‡å®¢æˆ·ç«¯ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼Œå¹³å‡å“åº”å»¶è¿Ÿæ˜¯30msï¼Œç»è¿‡nginxä»£ç†å“åº”å»¶è¿Ÿæ˜¯200msï¼Œæˆ‘ä½¿ç”¨çš„ngx+luaï¼Œä¸šåŠ¡é€»è¾‘æ˜¯å…ˆæŸ¥è¯¢workerè¿›ç¨‹çš„ç¼“å­˜ï¼Œæ²¡æœ‰å†æŸ¥redisï¼Œå†æ²¡æœ‰æŸ¥mysqlï¼Œç°åœ¨luaå±‚é¢å¯ä»¥ä¼˜åŒ–çš„å·²ç»ä¼˜åŒ–äº†ï¼Œå¹³å‡å“åº”å»¶è¿Ÿè¿˜æ˜¯170ms,ä¸çŸ¥é“é€šè¿‡ä»€ä¹ˆå·¥å…·èƒ½å®šä½å…·ä½“å“ªé‡Œå¯¼è‡´å“åº”å»¶è¿Ÿæ…¢å‘¢ï¼Ÿè°¢è°¢ï¼","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455205,"discussion_content":"è¯•è¯•åŠ¨æ€è¿½è¸ªï¼ˆä¸“æ ç¬¬50ã€51ç¯‡ï¼‰æ€ä¹ˆæ ·ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562509845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94958,"user_name":"å¤ä¸°","can_delete":false,"product_type":"c1","uid":1143705,"ip_address":"","ucode":"AEE94BF9B837AB","user_header":"https://static001.geekbang.org/account/avatar/00/11/73/99/eb99b2cb.jpg","comment_is_top":false,"comment_ctime":1557930191,"is_pvip":false,"replies":[{"id":"34172","content":"ä¼šçš„ï¼Œä¸æ¨èé•¿æœŸå¼€ç€","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1558095671,"ip_address":"","comment_id":94958,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557930191","product_id":100020901,"comment_content":"ä¸è€ƒè™‘ç£ç›˜é—®é¢˜ï¼Œtcpdump é•¿æœŸåœ¨ç”Ÿäº§ç¯å¢ƒæ‰“å¼€ï¼Œä¼šæœ‰ä»€ä¹ˆä¸è‰¯çš„å½±å“å—ï¼Ÿä¼šå½±å“åˆ°ç½‘ç»œæ€§èƒ½å—ï¼Ÿå¦‚ä½•å»è¯„ä¼°è¿™æ ·çš„é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450273,"discussion_content":"ä¼šçš„ï¼Œä¸æ¨èé•¿æœŸå¼€ç€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558095671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85035,"user_name":"å¤§åç‹ç‹¸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1554963026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554963026","product_id":100020901,"comment_content":"å¼€å§‹æ‡µäº†ã€‚setsocketé‚£é‡Œ æ²¡æ‰¾åˆ°ã€‚ã€‚ä¸è¿‡ ç¡®å®nginxçš„é‚£ä¸ªnodeplay  ä¸ºoff","like_count":0},{"had_liked":false,"id":83789,"user_name":"å¦‚æœ","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1554715759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554715759","product_id":100020901,"comment_content":"DAY40ï¼Œæ‰“å¡","like_count":0},{"had_liked":false,"id":73435,"user_name":"æ¥š","can_delete":false,"product_type":"c1","uid":1154723,"ip_address":"","ucode":"A2F59EBDD6D9EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/a3/0bfaaf13.jpg","comment_is_top":false,"comment_ctime":1551883448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551883448","product_id":100020901,"comment_content":"æ–‡ä¸­æ²¡æœ‰è¯´è¿‡æœ‰ä»€ä¹ˆæ–¹æ³•ã€‚è€Œä¸”æˆ‘è¿™æ˜¯æŠ“åŒ…æ ¹æœ¬çœ‹ä¸å‡ºä»€ä¹ˆã€‚åªçœ‹è§é‡ä¼ 15æ¬¡åè¿æ¥æ–­å¼€ã€‚<br>æˆ‘æƒ³è¯·æ•™çš„æ˜¯ï¼Œä¸€èˆ¬ä»€ä¹ˆåŸå› å¯¼è‡´é‡ä¼ è¿™ä¹ˆå¤šæ¬¡è¿˜æ˜¯æ²¡æœ‰é‡ä¼ æˆåŠŸå‘¢ï¼Ÿ<br>write bufferä¸€ç›´æœ‰æ•°æ®ä¸”å¤§å°ä¸å˜ï¼Œä»£è¡¨æ•°æ®ä¸€ç›´å‘ä¸å‡ºå»ã€‚<br>è€ŒTCPå¿ƒè·³åœ¨æœ‰æ•°æ®åœ¨write bufferæƒ…å†µä¸‹æ˜¯ä¸ä¼šå‘ç”Ÿå¿ƒè·³çš„ã€‚","like_count":0},{"had_liked":false,"id":73184,"user_name":"ç§‘å­¦Jia","can_delete":false,"product_type":"c1","uid":1080409,"ip_address":"","ucode":"95430413F82A69","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/59/26b1e65a.jpg","comment_is_top":false,"comment_ctime":1551836177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551836177","product_id":100020901,"comment_content":"è€å¸ˆè¿™ä¸ªæ¡ˆä¾‹éå¸¸å¥½ï¼Œå—ç›ŠåŒªæµ…ï¼Œè®©æˆ‘å†³å¿ƒå¥½å¥½å†æ¸©ä¹ ä¸‹tcpçš„åŸºç¡€çŸ¥è¯†ã€‚è¿˜æ˜¯åŸºç¡€æœ€é‡è¦ã€‚","like_count":0},{"had_liked":false,"id":72868,"user_name":"æ¥š","can_delete":false,"product_type":"c1","uid":1154723,"ip_address":"","ucode":"A2F59EBDD6D9EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/a3/0bfaaf13.jpg","comment_is_top":false,"comment_ctime":1551748726,"is_pvip":false,"replies":[{"id":"26740","content":"å—¯ï¼Œå¯ä»¥ç”¨æ–‡ä¸­çš„æ–¹æ³•åˆ†æçœ‹çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551883062,"ip_address":"","comment_id":72868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551748726","product_id":100020901,"comment_content":"ä½ å¥½ï¼Œä½†æ˜¯æ¯æ¬¡å‡ºé—®é¢˜éƒ½è¦ç­‰åˆ°é‡ä¼ 15æ¬¡ã€‚è€Œä¸”write bufferéƒ½ä¸å˜ã€‚<br>åº”è¯¥ä¸æ˜¯ç®€å•è¶…æ—¶å§ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441800,"discussion_content":"å—¯ï¼Œå¯ä»¥ç”¨æ–‡ä¸­çš„æ–¹æ³•åˆ†æçœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551883062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70556,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1551141205,"is_pvip":false,"replies":[{"id":"25363","content":"å†æ¸©ä¹ æ¸©ä¹ åŸç†å°±å¯ä»¥äº†ğŸ˜Š","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551195431,"ip_address":"","comment_id":70556,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551141205","product_id":100020901,"comment_content":"æ‰“å¡day42<br>æ¡ˆä¾‹ä¸­çš„é—®é¢˜ï¼Œå¯èƒ½æˆ‘é€šè¿‡æŠ“åŒ…ä»”ç»†çœ‹åï¼Œèƒ½å¾—å‡ºackæœ‰å¼‚å¸¸ï¼Œä½†æ˜¯æ²¡åŠæ³•è·Ÿå®¢æˆ·ç«¯é»˜è®¤çš„ackå»¶æ—¶å‘é€ï¼Œä»¥åŠnginxçš„tcp_nodelayè”ç³»èµ·æ¥ï½ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440690,"discussion_content":"å†æ¸©ä¹ æ¸©ä¹ åŸç†å°±å¯ä»¥äº†ğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70123,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1551001703,"is_pvip":false,"replies":[{"id":"25346","content":"è¿™ä¸ªæ¡ˆä¾‹çš„æ ¸å¿ƒæ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Œå®¢æˆ·ç«¯æœ‰æ²¡æœ‰é…ç½®å»¶è¿ŸACKï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551194619,"ip_address":"","comment_id":70123,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1551001703","product_id":100020901,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘æ— æ³•å‡ºç°å»¶è¿Ÿ40mså·¦å³çš„æƒ…å†µï¼Ÿ æˆ‘éƒ½æ˜¯æŒ‰ç…§è€å¸ˆçš„æ­¥éª¤æ¥çš„ã€‚æˆ‘çš„nginxç«¯ï¼ˆVM1ï¼‰æ˜¯ubuntu 18.04ï¼Œè·Ÿè€å¸ˆç‰ˆæœ¬ä¸€æ ·çš„ï¼ŒVM2ç«¯æ˜¯Ubuntu16ï¼Œwrkï¼Œcurlå·¥ä½œåœ¨æ­¤ã€‚æˆ‘ç”¨wrkè·‘ä¸‰ä¸ªnginxï¼ˆåˆ†åˆ«æ˜¯goodï¼Œnginx-latencyï¼Œnginx-nodelayï¼‰å·®ä¸å¤šï¼ŒLatency  Avgåœ¨   90msï¼Œæœ‰æ—¶å€™ï¼Œåè€Œè¿˜æ˜¯nginx-latencyæœ€å¥½ã€‚æˆ‘è§‚å¯Ÿäº†åŒ…çš„é¡ºåºï¼Œç¡®å®å¦‚è¯¾ç¨‹æ‰€è¯´çš„é‚£æ ·(è€å¸ˆèƒ½å¦å°†æœ¬è¯¾ä¸­è¯´æŠ“çš„åŒ…ä¸€èµ·ä¸Šä¼ åˆ°githubï¼Ÿ)<br>æˆ‘çš„ä¸‰ä¸ªnginxçš„é…ç½®å¦‚ä¸‹ï¼š<br><br>goodçš„é…ç½®ï¼š<br>http {<br>    include       &#47;etc&#47;nginx&#47;mime.types;<br>    default_type  application&#47;octet-stream;<br><br>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;<br>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;<br>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;<br><br>    access_log  &#47;var&#47;log&#47;nginx&#47;access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include &#47;etc&#47;nginx&#47;conf.d&#47;*.conf;<br>}<br><br><br>nginx-nodelayçš„é…ç½®ï¼š<br>http {<br>    include       &#47;etc&#47;nginx&#47;mime.types;<br>    default_type  application&#47;octet-stream;<br><br>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;<br>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;<br>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;<br><br>    access_log  &#47;var&#47;log&#47;nginx&#47;access.log  main;<br><br>    sendfile        on;<br>    tcp_nopush     off;<br>    tcp_nodelay     on;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include &#47;etc&#47;nginx&#47;conf.d&#47;*.conf;<br>}<br><br><br>nginx-latencyçš„é…ç½®ï¼š<br>http {<br>    include       &#47;etc&#47;nginx&#47;mime.types;<br>    default_type  application&#47;octet-stream;<br><br>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;<br>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;<br>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;<br><br>    access_log  &#47;var&#47;log&#47;nginx&#47;access.log  main;<br><br>    sendfile        on;<br>    tcp_nopush     off;<br>    tcp_nodelay    off;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include &#47;etc&#47;nginx&#47;conf.d&#47;*.conf;<br>}<br><br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440449,"discussion_content":"è¿™ä¸ªæ¡ˆä¾‹çš„æ ¸å¿ƒæ˜¯å®¢æˆ·ç«¯é—®é¢˜ï¼Œå®¢æˆ·ç«¯æœ‰æ²¡æœ‰é…ç½®å»¶è¿ŸACKï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1626276,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d0/a4/9f8978dc.jpg","nickname":"wangkaiyuan","note":"","ucode":"FB975EB1DB53F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575050,"discussion_content":"å®¢æˆ·ç«¯è¦å¦‚ä½•é…ç½®å»¶è¿ŸACK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654572008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":440449,"ip_address":""},"score":575050,"extra":""}]},{"author":{"id":1626276,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d0/a4/9f8978dc.jpg","nickname":"wangkaiyuan","note":"","ucode":"FB975EB1DB53F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575052,"discussion_content":"æˆ‘é‡åˆ°äº†å’Œä½ åŒæ ·çš„é—®é¢˜ï¼Œnginxè®¾ç½®tcp_nodelayçš„onå’Œoffå¯¹å»¶æ—¶æ— å½±å“ï¼Œå®¢æˆ·ç«¯é…ç½®çš„æ˜¯å»¶æ—¶ç¡®è®¤ACK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654572324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1657948,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4c/5c/9ea0f752.jpg","nickname":"ç¨‹åºçŒ¿ä¸åœ†","note":"","ucode":"BC8926A84A07C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212767,"discussion_content":"æˆ‘æŠ“çš„åŒ…å’Œå€ªè€å¸ˆçš„ä¸€æ ·ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåè€Œæ¡ˆä¾‹Nginxçš„å»¶è¿Ÿæ›´å°ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585013820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69671,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1550805629,"is_pvip":false,"replies":[{"id":"24854","content":"æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åœ¨æŠ“åŒ…åè¦æŒ‰åº”ç”¨è¿‡æ»¤ï¼ˆæ¯”å¦‚ç«¯å£å·ï¼‰ï¼Œç„¶åå†åˆ†åˆ«è¿›è¡Œåˆ†æ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1550851857,"ip_address":"","comment_id":69671,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550805629","product_id":100020901,"comment_content":"åŒä¸€å¥—ç¯å¢ƒç¢°åˆ°ä¸€ä¸ªä½å¹¶å‘é«˜å»¶æ—¶ï¼Œé«˜å¹¶å‘ä½å»¶æ—¶å¾—çš„é—®é¢˜ï¼Œè¯·é—®å€ªè€å¸ˆåƒè¿™ç§é—®é¢˜è¯¥å¦‚ä½•æ’æŸ¥?","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440219,"discussion_content":"æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åœ¨æŠ“åŒ…åè¦æŒ‰åº”ç”¨è¿‡æ»¤ï¼ˆæ¯”å¦‚ç«¯å£å·ï¼‰ï¼Œç„¶åå†åˆ†åˆ«è¿›è¡Œåˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550851857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}