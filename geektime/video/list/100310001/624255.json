{"id":624255,"title":"95｜如何批量读取 Excel 文件？","content":"<p><strong>课后习题</strong><br>\n请你编写程序，将 Excel 的每一行拆分成一个文件，并以每行第一个单元格作为文件名进行保存。</p><p><strong>课程代码、课件及其他相关资料地址</strong><br>\n<a href=\"https://gitee.com/wilsonyin/zero-basics-python\">https://gitee.com/wilsonyin/zero-basics-python</a></p>","comments":[{"had_liked":false,"id":388285,"user_name":"Guan YD","can_delete":false,"product_type":"c3","uid":2000972,"ip_address":"陕西","ucode":"76540F350800A9","user_header":"https://static001.geekbang.org/account/avatar/00/1e/88/4c/9a732f67.jpg","comment_is_top":false,"comment_ctime":1709801000,"is_pvip":false,"replies":[{"id":141414,"content":"我想你是考虑到了 打开文件放在循环外面，虽然会提高效率，但是担心进行读写的时候会被覆盖的问题\n\n我提供一个放在外面，并追加数据的代码给你，看看是否能有所帮助\n\nfrom openpyxl import load_workbook\n\n# 读取文件\nwb = load_workbook(&quot;demo.xlsx&quot;)\nws = wb.active\ndata = []\nfor row in ws.iter_rows():\n    tmp = []\n    for cell in row:\n        tmp.append(cell.value)\n    data.append(tmp)\n\n# 写入文件\nfor row in data:\n    file_name = row[0]\n    write_wb = load_workbook(f&quot;{file_name}.xlsx&quot;)\n    write_ws = write_wb.active\n    write_ws.append(row)\n    write_wb.save(f&quot;{file_name}.xlsx&quot;)\n","user_name":"作者回复","user_name_real":"编辑","uid":1056235,"ctime":1710138507,"ip_address":"广东","comment_id":388285,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"简单写了一个，是把读和写分开了，但是有一个问题，就是在写的时候，循环内容，每次都要重新启一个Workbook() 这样会不会有什么问题？但是放在外面的话，每次append()会是叠加之前数据的情况\n\n\nfrom openpyxl import Workbook, load_workbook\n\n# 读取文件\nwb = load_workbook(&quot;demo.xlsx&quot;)\n\n# 激活文件sheet页\nws = wb.active\n\n# 获取激活sheet页文件内容\ndata = []\nfor row in ws.iter_rows():\n    tmp = []\n    for cell in row:\n        tmp.append(cell.value)\n    data.append(tmp)\n\n# 写入文件\nfor row in data:\n    file_name = row[0]\n    write_wb = Workbook()\n    write_ws = write_wb.active\n    write_ws.append(row)\n\n    write_wb.save(f&quot;{file_name}.xlsx&quot;)","like_count":0,"discussions":[{"author":{"id":1056235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/eb/b2123759.jpg","nickname":"尹会生","note":"","ucode":"D1093DBD093617","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":638941,"discussion_content":"我想你是考虑到了 打开文件放在循环外面，虽然会提高效率，但是担心进行读写的时候会被覆盖的问题\n\n我提供一个放在外面，并追加数据的代码给你，看看是否能有所帮助\n\nfrom openpyxl import load_workbook\n\n# 读取文件\nwb = load_workbook(&#34;demo.xlsx&#34;)\nws = wb.active\ndata = []\nfor row in ws.iter_rows():\n    tmp = []\n    for cell in row:\n        tmp.append(cell.value)\n    data.append(tmp)\n\n# 写入文件\nfor row in data:\n    file_name = row[0]\n    write_wb = load_workbook(f&#34;{file_name}.xlsx&#34;)\n    write_ws = write_wb.active\n    write_ws.append(row)\n    write_wb.save(f&#34;{file_name}.xlsx&#34;)\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710138508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389986,"user_name":"Geek_c131f7","can_delete":false,"product_type":"c3","uid":3828103,"ip_address":"陕西","ucode":"88BB639931161E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/icniaGmw8xiboyC25ic8l7Vf62AOJ9ysHeAZSxPYMAnL8TticuELVSpnZcexwicbyaeVSCdtnN0MNWawrdBcgeLwmhdg/132","comment_is_top":false,"comment_ctime":1714037478,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 拆分sample2, 3，4，7，qty\nfrom openpyxl import load_workbook,Workbook\nwb = load_workbook(&#39;sample2.xlsx&#39;)\nws = wb.active\nrecord = []\nfor row in ws.values:\n    record.append(row)\n\nfor i in record:\n    wb_w = Workbook()\n    ws_w = wb_w.active\n    ws_w.append(i)      \n    wb_w.save(f&#39;.&#47;homework_split&#47;{i[0]}.xlsx&#39;)","like_count":0},{"had_liked":false,"id":385234,"user_name":"Geek_631607","can_delete":false,"product_type":"c3","uid":3789991,"ip_address":"广东","ucode":"EAF874838F0BE4","user_header":"","comment_is_top":false,"comment_ctime":1702301305,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"import pandas as pd\n\n# 读取 Excel 文件\ndf = pd.read_excel(&#39;sample.xlsx&#39;)\n\n# 遍历每一行\nfor index, row in df.iterrows():\n    print(row.iloc[0])\n    # 使用第一个单元格作为文件名\n    filename = str(row.iloc[0])\n    # 将这一行的数据保存到一个新的文件中\n    row.to_csv(f&#39;{filename}.csv&#39;, index=False)","like_count":0},{"had_liked":false,"id":382880,"user_name":"Geek_Mike","can_delete":false,"product_type":"c3","uid":3196376,"ip_address":"云南","ucode":"CFA942192C3B74","user_header":"https://static001.geekbang.org/account/avatar/00/30/c5/d8/c5509b9c.jpg","comment_is_top":false,"comment_ctime":1698144775,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 一次只读取表格中的一行\nimport openpyxl\n\nexcl = &#39;&#47;Users&#47;mike&#47;Desktop&#47;zero-basics-python&#47;0&#47;sample.xlsx&#39;\nworkbook = openpyxl.load_workbook(excl)\nworksheet = workbook.active\n\nfor row in worksheet.iter_rows():\n    cell_list = []\n    for cell in row:\n        cell_list.append(cell.value)\n\n        wb = openpyxl.Workbook()\n        ws = wb.active\n        ws.append(cell_list)\n    \n    wb.save(f&#39;{cell_list[0]}.xlsx&#39;)\n\n\n# 一次性把表格的所有内容读入内存\nimport openpyxl\n\nexcl = &#39;&#47;Users&#47;mike&#47;Desktop&#47;zero-basics-python&#47;0&#47;sample.xlsx&#39;\nworkbook = openpyxl.load_workbook(excl)\nworksheet = workbook.active\n\nfor row in worksheet.values:\n    wb = openpyxl.Workbook()\n    ws = wb.active\n    ws.append(row)\n    \n    wb.save(f&#39;{row[0]}.xlsx&#39;)","like_count":0},{"had_liked":false,"id":378559,"user_name":"Greenery","can_delete":false,"product_type":"c3","uid":3566765,"ip_address":"新加坡","ucode":"16111129C9EBA2","user_header":"https://static001.geekbang.org/account/avatar/00/36/6c/ad/0a694b50.jpg","comment_is_top":false,"comment_ctime":1690426564,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"#%%\nfrom openpyxl import load_workbook,Workbook\nfrom os import chdir\n\nchdir(r&#39;C:\\Projects\\python\\0base_py\\ch12\\exp2&#39;)\n#%%\nwb=load_workbook(&#39;1.xlsx&#39;)\nws=wb.active\nfor row in ws.iter_rows():\n    row_val=[]\n    for cell in row:\n        row_val.append(cell.value)\n    wb1 = Workbook()\n    ws1 = wb1.active\n    ws1.append(row_val)\n    wb1.save(row_val[1]+&quot;.xlsx&quot;)","like_count":0},{"had_liked":false,"id":370388,"user_name":"Geek_fb1a3e","can_delete":false,"product_type":"c3","uid":3185358,"ip_address":"巴勒斯坦","ucode":"8E8E196B977AB6","user_header":"","comment_is_top":false,"comment_ctime":1678779229,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from openpyxl import workbook, load_workbook\nfrom docx import Document\n\nwb = load_workbook(&#39;excel1.xlsx&#39;)\n\nws = wb.active\n\n# 获取工作表全部数据的单元格区域\ncell_area = ws[ws.calculate_dimension()]\n\nmax_column = ws.max_column\nfor row in cell_area:\n    document = Document()\n    table = document.add_table(rows=1, cols=max_column)\n    for i, cell in enumerate(row):\n        table.rows[0].cells[i].text = str(cell.value)\n    document.save(f&#39;{table.rows[0].cells[0].text}.docx&#39;)","like_count":0},{"had_liked":false,"id":367349,"user_name":"Cy23","can_delete":false,"product_type":"c3","uid":1591293,"ip_address":"辽宁","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1675155024,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"看了下其他同学写的，重新敲下执行了下\nfrom openpyxl import Workbook,load_workbook\n\nwb = load_workbook(&quot;1.xlsx&quot;)\nws = wb.active\n\nfor row in ws.values:\n    wb_part = Workbook()\n    ws_part = wb_part.active\n    ws_part.append(row)\n    wb_part.save(f&quot;{row[0]}.xlsx&quot;)","like_count":0},{"had_liked":false,"id":367104,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1674922961,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from openpyxl import Workbook,load_workbook\n\n# 打开要访问的 Excel\nwb = load_workbook(&quot;1.xlsx&quot;)\nws = wb.active\n\n# 遍历 Excel 默认 SHEET 的每一行\n# 以每一行为文件内容，第一个单元格为文件名，创建新的 Excel\nfor row in ws.values:\n    wb_part = Workbook()\n\n    ws_part = wb_part.active\n    ws_part.append(row)\n\n    wb_part.save(f&quot;{row[0]}.xlsx&quot;)","like_count":0},{"had_liked":false,"id":366975,"user_name":"PatrickL","can_delete":false,"product_type":"c3","uid":1341431,"ip_address":"上海","ucode":"EF0EC18639B9B2","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/f7/11548247.jpg","comment_is_top":false,"comment_ctime":1674724672,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"import openpyxl\nwb_read = openpyxl.load_workbook(&#39;.\\极客时间_零基础学Python_2023\\\\12\\sample2.xlsx&#39;)\nws_read = wb_read.active\nfor i in range(ws_read.max_row):\n    wb_write = openpyxl.Workbook()\n    ws_write = wb_write.active\n    for j in range(ws_read.max_column):\n        ws_write.cell(1,j+1,ws_read.cell(i+1,j+1).value)\n    name = ws_read.cell(i+1,1).value\n    wb_write.save(f&#39;零基础学Python_第95讲_{name}.xlsx&#39;)","like_count":0}]}