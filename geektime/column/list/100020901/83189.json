{"id":83189,"title":"41 | æ¡ˆä¾‹ç¯‡ï¼šå¦‚ä½•ä¼˜åŒ– NAT æ€§èƒ½ï¼Ÿï¼ˆä¸Šï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬æ¢ç©¶äº†ç½‘ç»œå»¶è¿Ÿå¢å¤§é—®é¢˜çš„åˆ†ææ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼ŒæŒæ¡äº†å¦‚ä½•ç”¨ hping3ã€tcpdumpã€Wiresharkã€strace ç­‰å·¥å…·ï¼Œæ¥æ’æŸ¥å’Œå®šä½é—®é¢˜çš„æ ¹æºã€‚</p><p>ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯æœ€æ ¸å¿ƒçš„ç½‘ç»œæ€§èƒ½æŒ‡æ ‡ã€‚ç”±äºç½‘ç»œä¼ è¾“ã€ç½‘ç»œåŒ…å¤„ç†ç­‰å„ç§å› ç´ çš„å½±å“ï¼Œç½‘ç»œå»¶è¿Ÿä¸å¯é¿å…ã€‚ä½†è¿‡å¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œä¼šç›´æ¥å½±å“ç”¨æˆ·çš„ä½“éªŒã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å‘ç°ç½‘ç»œå»¶è¿Ÿå¢å¤§çš„æƒ…å†µåï¼Œä½ å¯ä»¥å…ˆä»è·¯ç”±ã€ç½‘ç»œåŒ…çš„æ”¶å‘ã€ç½‘ç»œåŒ…çš„å¤„ç†ï¼Œå†åˆ°åº”ç”¨ç¨‹åºç­‰ï¼Œä»å„ä¸ªå±‚çº§åˆ†æç½‘ç»œå»¶è¿Ÿï¼Œç­‰åˆ°æ‰¾å‡ºç½‘ç»œå»¶è¿Ÿçš„æ¥æºå±‚çº§åï¼Œå†æ·±å…¥å®šä½ç“¶é¢ˆæ‰€åœ¨ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘å†å¸¦ä½ æ¥çœ‹çœ‹ï¼Œå¦ä¸€ä¸ªå¯èƒ½å¯¼è‡´ç½‘ç»œå»¶è¿Ÿçš„å› ç´ ï¼Œå³ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translationï¼‰ï¼Œç¼©å†™ä¸º NATã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹  NAT çš„å·¥ä½œåŸç†ï¼Œå¹¶å¼„æ¸…æ¥šå¦‚ä½•ä¼˜åŒ– NAT å¸¦æ¥çš„æ½œåœ¨æ€§èƒ½é—®é¢˜ã€‚</p><h2>NATåŸç†</h2><p>NAT æŠ€æœ¯å¯ä»¥é‡å†™ IP æ•°æ®åŒ…çš„æº IP æˆ–è€…ç›®çš„ IPï¼Œè¢«æ™®éåœ°ç”¨æ¥è§£å†³å…¬ç½‘ IP åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚å®ƒçš„ä¸»è¦åŸç†å°±æ˜¯ï¼Œç½‘ç»œä¸­çš„å¤šå°ä¸»æœºï¼Œé€šè¿‡å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€ï¼Œæ¥è®¿é—®å¤–ç½‘èµ„æºã€‚åŒæ—¶ï¼Œç”±äº NAT å±è”½äº†å†…ç½‘ç½‘ç»œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ºå±€åŸŸç½‘ä¸­çš„æœºå™¨æä¾›äº†å®‰å…¨éš”ç¦»ã€‚</p><p>ä½ æ—¢å¯ä»¥åœ¨æ”¯æŒç½‘ç»œåœ°å€è½¬æ¢çš„è·¯ç”±å™¨ï¼ˆç§°ä¸º NAT ç½‘å…³ï¼‰ä¸­é…ç½® NATï¼Œä¹Ÿå¯ä»¥åœ¨ Linux æœåŠ¡å™¨ä¸­é…ç½® NATã€‚å¦‚æœé‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ï¼ŒLinux æœåŠ¡å™¨å®é™…ä¸Šå……å½“çš„æ˜¯â€œè½¯â€è·¯ç”±å™¨çš„è§’è‰²ã€‚</p><!-- [[[read_end]]] --><p>NAT çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯å®ç°åœ°å€è½¬æ¢ã€‚æ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒï¼ŒNAT å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul>\n<li>\n<p>é™æ€ NATï¼Œå³å†…ç½‘ IP ä¸å…¬ç½‘ IP æ˜¯ä¸€å¯¹ä¸€çš„æ°¸ä¹…æ˜ å°„å…³ç³»ï¼›</p>\n</li>\n<li>\n<p>åŠ¨æ€ NATï¼Œå³å†…ç½‘ IP ä»å…¬ç½‘ IP æ± ä¸­ï¼ŒåŠ¨æ€é€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ˜ å°„ï¼›</p>\n</li>\n<li>\n<p>ç½‘ç»œåœ°å€ç«¯å£è½¬æ¢ NAPTï¼ˆNetwork Address and Port Translationï¼‰ï¼Œå³æŠŠå†…ç½‘ IP æ˜ å°„åˆ°å…¬ç½‘ IP çš„ä¸åŒç«¯å£ä¸Šï¼Œè®©å¤šä¸ªå†…ç½‘ IP å¯ä»¥å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€ã€‚</p>\n</li>\n</ul><p>NAPT æ˜¯ç›®å‰æœ€æµè¡Œçš„ NAT ç±»å‹ï¼Œæˆ‘ä»¬åœ¨ Linux ä¸­é…ç½®çš„ NAT ä¹Ÿæ˜¯è¿™ç§ç±»å‹ã€‚è€Œæ ¹æ®è½¬æ¢æ–¹å¼çš„ä¸åŒï¼Œæˆ‘ä»¬åˆå¯ä»¥æŠŠ NAPT åˆ†ä¸ºä¸‰ç±»ã€‚</p><p>ç¬¬ä¸€ç±»æ˜¯æºåœ°å€è½¬æ¢SNATï¼Œå³ç›®çš„åœ°å€ä¸å˜ï¼Œåªæ›¿æ¢æº IP æˆ–æºç«¯å£ã€‚SNAT ä¸»è¦ç”¨äºï¼Œå¤šä¸ªå†…ç½‘ IP å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP ï¼Œæ¥è®¿é—®å¤–ç½‘èµ„æºçš„åœºæ™¯ã€‚</p><p>ç¬¬äºŒç±»æ˜¯ç›®çš„åœ°å€è½¬æ¢DNATï¼Œå³æº IP ä¿æŒä¸å˜ï¼Œåªæ›¿æ¢ç›®çš„ IP æˆ–è€…ç›®çš„ç«¯å£ã€‚DNAT ä¸»è¦é€šè¿‡å…¬ç½‘ IP çš„ä¸åŒç«¯å£å·ï¼Œæ¥è®¿é—®å†…ç½‘çš„å¤šç§æœåŠ¡ï¼ŒåŒæ—¶ä¼šéšè—åç«¯æœåŠ¡å™¨çš„çœŸå® IP åœ°å€ã€‚</p><p>ç¬¬ä¸‰ç±»æ˜¯åŒå‘åœ°å€è½¬æ¢ï¼Œå³åŒæ—¶ä½¿ç”¨ SNAT å’Œ DNATã€‚å½“æ¥æ”¶åˆ°ç½‘ç»œåŒ…æ—¶ï¼Œæ‰§è¡Œ DNATï¼ŒæŠŠç›®çš„ IP è½¬æ¢ä¸ºå†…ç½‘ IPï¼›è€Œåœ¨å‘é€ç½‘ç»œåŒ…æ—¶ï¼Œæ‰§è¡Œ SNATï¼ŒæŠŠæº IP æ›¿æ¢ä¸ºå¤–éƒ¨ IPã€‚</p><p>åŒå‘åœ°å€è½¬æ¢ï¼Œå…¶å®å°±æ˜¯å¤–ç½‘ IP ä¸å†…ç½‘ IP çš„ä¸€å¯¹ä¸€æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥å¸¸ç”¨åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œä¸ºè™šæ‹Ÿæœºåˆ†é…æµ®åŠ¨çš„å…¬ç½‘ IP åœ°å€ã€‚</p><p>ä¸ºäº†å¸®ä½ ç†è§£ NAPTï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚æˆ‘ä»¬å‡è®¾ï¼š</p><ul>\n<li>\n<p>æœ¬åœ°æœåŠ¡å™¨çš„å†…ç½‘ IP åœ°å€ä¸º 192.168.0.2ï¼›</p>\n</li>\n<li>\n<p>NAT ç½‘å…³ä¸­çš„å…¬ç½‘ IP åœ°å€ä¸º 100.100.100.100ï¼›</p>\n</li>\n<li>\n<p>è¦è®¿é—®çš„ç›®çš„æœåŠ¡å™¨ baidu.com çš„åœ°å€ä¸º 123.125.115.110ã€‚</p>\n</li>\n</ul><p>é‚£ä¹ˆ SNAT å’Œ DNAT çš„è¿‡ç¨‹ï¼Œå°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/e4/c743105dc7bd955a4a300d6b55b7a0e4.png?wh=712*610\" alt=\"\"></p><p>ä»å›¾ä¸­ï¼Œä½ å¯ä»¥å‘ç°ï¼š</p><ul>\n<li>\n<p>å½“æœåŠ¡å™¨è®¿é—® baidu.com æ—¶ï¼ŒNAT ç½‘å…³ä¼šæŠŠæºåœ°å€ï¼Œä»æœåŠ¡å™¨çš„å†…ç½‘ IP 192.168.0.2 æ›¿æ¢æˆå…¬ç½‘ IP åœ°å€ 100.100.100.100ï¼Œç„¶åæ‰å‘é€ç»™ baidu.comï¼›</p>\n</li>\n<li>\n<p>å½“ baidu.com å‘å›å“åº”åŒ…æ—¶ï¼ŒNAT ç½‘å…³åˆä¼šæŠŠç›®çš„åœ°å€ï¼Œä»å…¬ç½‘ IP åœ°å€ 100.100.100.100 æ›¿æ¢æˆæœåŠ¡å™¨å†…ç½‘ IP 192.168.0.2ï¼Œç„¶åå†å‘é€ç»™å†…ç½‘ä¸­çš„æœåŠ¡å™¨ã€‚</p>\n</li>\n</ul><p>äº†è§£äº† NAT çš„åŸç†åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨ Linux ä¸­å®ç° NAT çš„åŠŸèƒ½ã€‚</p><h2>iptablesä¸NAT</h2><p>Linux å†…æ ¸æä¾›çš„ Netfilter æ¡†æ¶ï¼Œå…è®¸å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œä¿®æ”¹ï¼ˆæ¯”å¦‚ NATï¼‰å’Œè¿‡æ»¤ï¼ˆæ¯”å¦‚é˜²ç«å¢™ï¼‰ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œiptablesã€ip6tablesã€ebtables ç­‰å·¥å…·ï¼Œåˆæä¾›äº†æ›´æ˜“ç”¨çš„å‘½ä»¤è¡Œæ¥å£ï¼Œä»¥ä¾¿ç³»ç»Ÿç®¡ç†å‘˜é…ç½®å’Œç®¡ç† NATã€é˜²ç«å¢™çš„è§„åˆ™ã€‚</p><p>å…¶ä¸­ï¼Œiptables å°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§é…ç½®å·¥å…·ã€‚è¦æŒæ¡ iptables çš„åŸç†å’Œä½¿ç”¨æ–¹æ³•ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯å¼„æ¸…æ¥šï¼Œç½‘ç»œæ•°æ®åŒ…é€šè¿‡ Netfilter æ—¶çš„å·¥ä½œæµå‘ï¼Œä¸‹é¢è¿™å¼ å›¾å°±å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c6/56/c6de40c5bd304132a1b508ba669e7b56.png?wh=1415*435\" alt=\"\"><br>\nï¼ˆå›¾ç‰‡æ¥è‡ª <a href=\"https://en.wikipedia.org/wiki/Iptables\">Wikipedia</a>ï¼‰</p><p>åœ¨è¿™å¼ å›¾ä¸­ï¼Œç»¿è‰²èƒŒæ™¯çš„æ–¹æ¡†ï¼Œè¡¨ç¤ºè¡¨ï¼ˆtableï¼‰ï¼Œç”¨æ¥ç®¡ç†é“¾ã€‚Linux æ”¯æŒ 4 ç§è¡¨ï¼ŒåŒ…æ‹¬ filterï¼ˆç”¨äºè¿‡æ»¤ï¼‰ã€natï¼ˆç”¨äºNATï¼‰ã€mangleï¼ˆç”¨äºä¿®æ”¹åˆ†ç»„æ•°æ®ï¼‰ å’Œ rawï¼ˆç”¨äºåŸå§‹æ•°æ®åŒ…ï¼‰ç­‰ã€‚</p><p>è·Ÿ table ä¸€èµ·çš„ç™½è‰²èƒŒæ™¯æ–¹æ¡†ï¼Œåˆ™è¡¨ç¤ºé“¾ï¼ˆchainï¼‰ï¼Œç”¨æ¥ç®¡ç†å…·ä½“çš„ iptables è§„åˆ™ã€‚æ¯ä¸ªè¡¨ä¸­å¯ä»¥åŒ…å«å¤šæ¡é“¾ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>\n<p>filter è¡¨ä¸­ï¼Œå†…ç½® INPUTã€OUTPUT å’Œ FORWARD é“¾ï¼›</p>\n</li>\n<li>\n<p>nat è¡¨ä¸­ï¼Œå†…ç½®PREROUTINGã€POSTROUTINGã€OUTPUT ç­‰ã€‚</p>\n</li>\n</ul><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œåˆ›å»ºä½ è‡ªå·±çš„é“¾ã€‚</p><p>ç°è‰²çš„ conntrackï¼Œè¡¨ç¤ºè¿æ¥è·Ÿè¸ªæ¨¡å—ã€‚å®ƒé€šè¿‡å†…æ ¸ä¸­çš„è¿æ¥è·Ÿè¸ªè¡¨ï¼ˆä¹Ÿå°±æ˜¯å“ˆå¸Œè¡¨ï¼‰ï¼Œè®°å½•ç½‘ç»œè¿æ¥çš„çŠ¶æ€ï¼Œæ˜¯ iptables çŠ¶æ€è¿‡æ»¤ï¼ˆ-m stateï¼‰å’Œ NAT çš„å®ç°åŸºç¡€ã€‚</p><p>iptables çš„æ‰€æœ‰è§„åˆ™ï¼Œå°±ä¼šæ”¾åˆ°è¿™äº›è¡¨å’Œé“¾ä¸­ï¼Œå¹¶æŒ‰ç…§å›¾ä¸­é¡ºåºå’Œè§„åˆ™çš„ä¼˜å…ˆçº§é¡ºåºæ¥æ‰§è¡Œã€‚</p><p>é’ˆå¯¹ä»Šå¤©çš„ä¸»é¢˜ï¼Œè¦å®ç° NAT åŠŸèƒ½ï¼Œä¸»è¦æ˜¯åœ¨ nat è¡¨è¿›è¡Œæ“ä½œã€‚è€Œ nat è¡¨å†…ç½®äº†ä¸‰ä¸ªé“¾ï¼š</p><ul>\n<li>\n<p>PREROUTINGï¼Œç”¨äºè·¯ç”±åˆ¤æ–­å‰æ‰€æ‰§è¡Œçš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œå¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œ DNATã€‚</p>\n</li>\n<li>\n<p>POSTROUTINGï¼Œç”¨äºè·¯ç”±åˆ¤æ–­åæ‰€æ‰§è¡Œçš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œå¯¹å‘é€æˆ–è½¬å‘çš„æ•°æ®åŒ…è¿›è¡Œ SNAT æˆ– MASQUERADEã€‚</p>\n</li>\n<li>\n<p>OUTPUTï¼Œç±»ä¼¼äº PREROUTINGï¼Œä½†åªå¤„ç†ä»æœ¬æœºå‘é€å‡ºå»çš„åŒ…ã€‚</p>\n</li>\n</ul><p>ç†Ÿæ‚‰ iptables ä¸­çš„è¡¨å’Œé“¾åï¼Œç›¸åº”çš„ NAT è§„åˆ™å°±æ¯”è¾ƒç®€å•äº†ã€‚æˆ‘ä»¬è¿˜ä»¥ NAPT çš„ä¸‰ä¸ªåˆ†ç±»ä¸ºä¾‹ï¼Œæ¥å…·ä½“è§£è¯»ä¸€ä¸‹ã€‚</p><h3><strong>SNAT</strong></h3><p>æ ¹æ®åˆšæ‰å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒSNAT éœ€è¦åœ¨ nat è¡¨çš„ POSTROUTING é“¾ä¸­é…ç½®ã€‚æˆ‘ä»¬å¸¸ç”¨ä¸¤ç§æ–¹å¼æ¥é…ç½®å®ƒã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ˜¯ä¸ºä¸€ä¸ªå­ç½‘ç»Ÿä¸€é…ç½® SNATï¼Œå¹¶ç”± Linux é€‰æ‹©é»˜è®¤çš„å‡ºå£ IPã€‚è¿™å®é™…ä¸Šå°±æ˜¯ç»å¸¸è¯´çš„ MASQUERADEï¼š</p><pre><code>$ iptables -t nat -A POSTROUTING -s 192.168.0.0/16 -j MASQUERADE\n</code></pre><p>ç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¯ä¸ºå…·ä½“çš„ IP åœ°å€é…ç½® SNATï¼Œå¹¶æŒ‡å®šè½¬æ¢åçš„æºåœ°å€ï¼š</p><pre><code>$ iptables -t nat -A POSTROUTING -s 192.168.0.2 -j SNAT --to-source 100.100.100.100\n</code></pre><h3><strong>DNAT</strong></h3><p>å†æ¥çœ‹DNATï¼Œæ˜¾ç„¶ï¼ŒDNAT éœ€è¦åœ¨ nat è¡¨çš„ PREROUTING æˆ–è€… OUTPUT é“¾ä¸­é…ç½®ï¼Œå…¶ä¸­ï¼Œ PREROUTING é“¾æ›´å¸¸ç”¨ä¸€äº›ï¼ˆå› ä¸ºå®ƒè¿˜å¯ä»¥ç”¨äºè½¬å‘çš„åŒ…ï¼‰ã€‚</p><pre><code>$ iptables -t nat -A PREROUTING -d 100.100.100.100 -j DNAT --to-destination 192.168.0.2\n</code></pre><h3><strong>åŒå‘åœ°å€è½¬æ¢</strong></h3><p>åŒå‘åœ°å€è½¬æ¢ï¼Œå°±æ˜¯åŒæ—¶æ·»åŠ  SNAT å’Œ DNAT è§„åˆ™ï¼Œä¸ºå…¬ç½‘ IP å’Œå†…ç½‘ IP å®ç°ä¸€å¯¹ä¸€çš„æ˜ å°„å…³ç³»ï¼Œå³ï¼š</p><pre><code>$ iptables -t nat -A POSTROUTING -s 192.168.0.2 -j SNAT --to-source 100.100.100.100\n$ iptables -t nat -A PREROUTING -d 100.100.100.100 -j DNAT --to-destination 192.168.0.2\n</code></pre><p>åœ¨ä½¿ç”¨ iptables é…ç½® NAT è§„åˆ™æ—¶ï¼ŒLinux éœ€è¦è½¬å‘æ¥è‡ªå…¶ä»– IP çš„ç½‘ç»œåŒ…ï¼Œæ‰€ä»¥ä½ åƒä¸‡ä¸è¦å¿˜è®°å¼€å¯ Linux çš„ IP è½¬å‘åŠŸèƒ½ã€‚</p><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹è¿™ä¸€åŠŸèƒ½æ˜¯å¦å¼€å¯ã€‚å¦‚æœè¾“å‡ºçš„ç»“æœæ˜¯ 1ï¼Œå°±è¡¨ç¤ºå·²ç»å¼€å¯äº† IP è½¬å‘ï¼š</p><pre><code>$ sysctl net.ipv4.ip_forward\nnet.ipv4.ip_forward = 1\n</code></pre><p>å¦‚æœè¿˜æ²¡å¼€å¯ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ‰‹åŠ¨å¼€å¯ï¼š</p><pre><code>$ sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\n</code></pre><p>å½“ç„¶ï¼Œä¸ºäº†é¿å…é‡å¯åé…ç½®ä¸¢å¤±ï¼Œä¸è¦å¿˜è®°å°†é…ç½®å†™å…¥ /etc/sysctl.conf æ–‡ä»¶ä¸­ï¼š</p><pre><code>$ cat /etc/sysctl.conf | grep ip_forward\nnet.ipv4.ip_forward=1\n</code></pre><p>è®²äº†è¿™ä¹ˆå¤šçš„åŸç†ï¼Œé‚£å½“ç¢°åˆ° NAT çš„æ€§èƒ½é—®é¢˜æ—¶ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿç»“åˆæˆ‘ä»¬ä»Šå¤©å­¦è¿‡çš„ NAT åŸç†ï¼Œä½ å…ˆè‡ªå·±æƒ³æƒ³ï¼ŒåŠ¨æ‰‹è¯•è¯•ï¼Œä¸‹èŠ‚è¯¾æˆ‘ä»¬ç»§ç»­â€œåˆ†è§£â€ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº† Linux ç½‘ç»œåœ°å€è½¬æ¢ NAT çš„åŸç†ã€‚</p><p>NAT æŠ€æœ¯èƒ½å¤Ÿé‡å†™ IP æ•°æ®åŒ…çš„æº IP æˆ–ç›®çš„ IPï¼Œæ‰€ä»¥æ™®éç”¨æ¥è§£å†³å…¬ç½‘ IP åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚å®ƒå¯ä»¥è®©ç½‘ç»œä¸­çš„å¤šå°ä¸»æœºï¼Œé€šè¿‡å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€ï¼Œæ¥è®¿é—®å¤–ç½‘èµ„æºã€‚åŒæ—¶ï¼Œç”±äº NAT å±è”½äº†å†…ç½‘ç½‘ç»œï¼Œä¹Ÿä¸ºå±€åŸŸç½‘ä¸­æœºå™¨èµ·åˆ°å®‰å…¨éš”ç¦»çš„ä½œç”¨ã€‚</p><p>Linux ä¸­çš„NAT ï¼ŒåŸºäºå†…æ ¸çš„è¿æ¥è·Ÿè¸ªæ¨¡å—å®ç°ã€‚æ‰€ä»¥ï¼Œå®ƒç»´æŠ¤æ¯ä¸ªè¿æ¥çŠ¶æ€çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¸¦æ¥å¾ˆé«˜çš„æ€§èƒ½æˆæœ¬ã€‚å…·ä½“ NAT æ€§èƒ½é—®é¢˜çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹èŠ‚è¯¾ç»§ç»­å­¦ä¹ ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ã€‚MASQUERADE æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§ SNAT è§„åˆ™ï¼Œå¸¸ç”¨æ¥ä¸ºå¤šä¸ªå†…ç½‘ IP åœ°å€æä¾›å…±äº«çš„å‡ºå£ IPã€‚</p><p>å‡è®¾ç°åœ¨æœ‰ä¸€å° Linux æœåŠ¡å™¨ï¼Œä½¿ç”¨äº† MASQUERADE çš„æ–¹å¼ï¼Œä¸ºå†…ç½‘çš„æ‰€æœ‰ IP æä¾›å‡ºå£è®¿é—®åŠŸèƒ½ã€‚é‚£ä¹ˆï¼Œ</p><ul>\n<li>\n<p>å½“å¤šä¸ªå†…ç½‘ IP åœ°å€çš„ç«¯å£å·ç›¸åŒæ—¶ï¼ŒMASQUERADE è¿˜å¯ä»¥æ­£å¸¸å·¥ä½œå—ï¼Ÿ</p>\n</li>\n<li>\n<p>å¦‚æœå†…ç½‘ IP åœ°å€æ•°é‡æˆ–è¯·æ±‚æ•°æ¯”è¾ƒå¤šï¼Œè¿™ç§æ–¹å¼æœ‰æ²¡æœ‰ä»€ä¹ˆéšæ‚£å‘¢ï¼Ÿ</p>\n</li>\n</ul><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>","comments":[{"had_liked":false,"id":77823,"user_name":"é’çŸ³","can_delete":false,"product_type":"c1","uid":1215531,"ip_address":"","ucode":"B0056AD6453322","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg","comment_is_top":false,"comment_ctime":1553004666,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"267840977018","product_id":100020901,"comment_content":"é—®é¢˜1ï¼šLinuxçš„NATæ—¶ç»™äºˆå†…æ ¸çš„è¿æ¥è·Ÿè¸ªæ¨¡å—å®ç°ï¼Œä¿ç•™äº†æºIPã€æºç«¯å£ã€ç›®çš„IPã€ç›®çš„ç«¯å£ä¹‹é—´çš„å…³ç³»ï¼Œå¤šä¸ªå†…ç½‘IPåœ°å€çš„ç«¯å£ç›¸åŒï¼Œä½†æ˜¯IPä¸åŒï¼Œå†nf_conntrackä¸­å¯¹åº”ä¸åŒçš„è®°å½•ï¼Œæ‰€ä»¥MASQUERADEå¯ä»¥æ­£å¸¸å·¥ä½œã€‚<br><br>é—®é¢˜2ï¼šNATæ–¹å¼æ‰€æœ‰æµé‡éƒ½è¦ç»è¿‡NATæœåŠ¡å™¨ï¼Œæ‰€ä»¥NATæœåŠ¡å™¨æœ¬èº«çš„è½¯ä¸­æ–­å¯¼è‡´CPUè´Ÿè½½ã€ç½‘ç»œæµé‡ã€æ–‡ä»¶å¥æŸ„ã€ç«¯å£å·ä¸Šé™ã€nf_conntrack table fulléƒ½å¯èƒ½æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚","like_count":63,"discussions":[{"author":{"id":1197912,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/58/9dfd822d.jpg","nickname":"çˆ±åƒé±¼çš„çŒ«","note":"","ucode":"F08E4D3F0C64B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364664,"discussion_content":"å†…å­˜ä¹Ÿå½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617549045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2172434,"avatar":"https://static001.geekbang.org/account/avatar/00/21/26/12/b10dfa8b.jpg","nickname":"åšä¿¡å…‰æ˜å°±åœ¨è¿œæ–¹ï¼","note":"","ucode":"1723C129AB5871","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1197912,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/58/9dfd822d.jpg","nickname":"çˆ±åƒé±¼çš„çŒ«","note":"","ucode":"F08E4D3F0C64B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589956,"discussion_content":"å†…å­˜ä¸å½±å“ï¼Œnatç½‘å…³åªèµ·è½¬å‘ï¼Œåˆä¸ä¼šè§£ææ•°æ®åŒ…ï¼Œæ‹¿å‡ºæ•°æ®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665410838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364664,"ip_address":"åŒ—äº¬"},"score":589956,"extra":""}]},{"author":{"id":1086319,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","nickname":"æ…•å®¹","note":"","ucode":"BEE694935853E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283702,"discussion_content":"å…¸å‹çš„è¯¾ä»£è¡¨å•Šï¼Œ666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592350315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70275,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1551062680,"is_pvip":false,"replies":[{"id":"25352","content":"ğŸ‘ä¸¤ä¸ªå›ç­”éƒ½æ˜¯æ­£ç¡®çš„ï¼Œç¬¬äºŒä¸ªè¿˜ä¸å®Œæ•´ï¼Œå¯ä»¥å†è€ƒè™‘æ·±å…¥ä¸€ç‚¹ï¼ˆæç¤ºï¼šè¿˜æœ‰å…¶ä»–å¾ˆå¤šå†…æ ¸èµ„æºé™åˆ¶ï¼‰","user_name":"ä½œè€…å›å¤","comment_id":70275,"uid":"1001282","ip_address":"","utype":1,"ctime":1551194902,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"40205768344","product_id":100020901,"comment_content":"[D41æ‰“å¡]<br>åœ¨å·²æœ‰çš„é¡¹ç›®ç»éªŒä¸­,è¿˜æœªæ¶‰åŠåˆ°è¿‡NAT.<br>å€’æ˜¯æœ¬åœ°çš„è™šæ‹Ÿæœºç¯å¢ƒä¸‹,æˆ–è€…è·¯ç”±å™¨ä¸Š,ä¼šçœ‹åˆ°natç›¸å…³é€‰é¡¹.<br><br>é—®é¢˜ä¸€:å½“å¤šä¸ªå†…ç½‘ IP åœ°å€çš„ç«¯å£å·ç›¸åŒæ—¶ï¼ŒMASQUERADE è¿˜å¯ä»¥æ­£å¸¸å·¥ä½œå—ï¼Ÿ<br>æˆ‘è§‰å¾—æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„,è¦ä¸ç„¶å°±ä¸ä¼šå…è®¸è®¾ç½®ipåœ°å€æ®µäº†.ğŸ˜[çº¯å±çŒœæµ‹å“ˆ]<br>åœ¨è·¯ç”±å™¨ä¸Šåšç«¯å£æ˜ å°„æ—¶,ä¸€ä¸ªå¤–ç½‘ç«¯å£åªèƒ½å¯¹åº”ä¸€ä¸ªå†…ç½‘çš„IP.<br>ä½†æ˜¯åæ–¹å‘,natåœ¨è½¬æ¢æºåœ°å€æ—¶,åº”è¯¥ä¼šè®°å½•åŸæ¥çš„è¿æ¥ä¿¡æ¯å§.è¦ä¸ç„¶æ”¶åˆ°åŒ…è¯¥ç»™è°å‘å‘¢.<br><br>é—®é¢˜äºŒ:å¦‚æœå†…ç½‘ IP åœ°å€æ•°é‡æˆ–è¯·æ±‚æ•°æ¯”è¾ƒå¤šï¼Œè¿™ç§æ–¹å¼æœ‰æ²¡æœ‰ä»€ä¹ˆéšæ‚£å‘¢ï¼Ÿ<br>æ ¹æ®ä¹‹å‰çš„ç»éªŒ,åœ¨è¯·æ±‚æ•°è¿‡å¤šæ—¶,ä¼šå¯¼è‡´CPUè½¯ä¸­æ–­ä¸Šå‡.<br>å†è°·æ­Œäº†ä¸‹,æœ‰çœ‹åˆ°è¯´:<br>iptablesçš„conntrackè¡¨æ»¡äº†å¯¼è‡´è®¿é—®ç½‘ç«™å¾ˆæ…¢.[https:&#47;&#47;my.oschina.net&#47;jean&#47;blog&#47;189935]<br>    ```kernel ç”¨ ip_conntrack æ¨¡å—æ¥è®°å½• iptables ç½‘ç»œåŒ…çš„çŠ¶æ€ï¼Œå¹¶ä¿å­˜åˆ° table é‡Œï¼ˆè¿™ä¸ª table åœ¨å†…å­˜é‡Œï¼‰ï¼Œå¦‚æœç½‘ç»œçŠ¶å†µç¹å¿™ï¼Œæ¯”å¦‚é«˜è¿æ¥ï¼Œé«˜å¹¶å‘è¿æ¥ç­‰ä¼šå¯¼è‡´é€æ­¥å ç”¨è¿™ä¸ª table å¯ç”¨ç©ºé—´ã€‚```<br><br>ä¼˜åŒ–Linux NATç½‘å…³[https:&#47;&#47;tech.youzan.com&#47;linux_nat&#47;]<br>    ```net.netfilter.nfconntrackbuckets è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤æœ‰ç‚¹å°ï¼Œè¿æ¥æ•°å¤šäº†ä»¥åï¼ŒåŠ¿å¿…é€ æˆâ€œå“ˆå¸Œå†²çªâ€å¢åŠ ï¼Œâ€œå“ˆå¸Œå¤„ç†â€æ€§èƒ½ä¸‹é™ã€‚ï¼ˆ æ˜¯è¿™æ ·å—ï¼Ÿï¼‰```<br><br>","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440536,"discussion_content":"ğŸ‘ä¸¤ä¸ªå›ç­”éƒ½æ˜¯æ­£ç¡®çš„ï¼Œç¬¬äºŒä¸ªè¿˜ä¸å®Œæ•´ï¼Œå¯ä»¥å†è€ƒè™‘æ·±å…¥ä¸€ç‚¹ï¼ˆæç¤ºï¼šè¿˜æœ‰å…¶ä»–å¾ˆå¤šå†…æ ¸èµ„æºé™åˆ¶ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033219,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","nickname":"JianXu","note":"","ucode":"2A61BDBB573BDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543177,"discussion_content":"æˆ‘åœ¨æƒ³å¦‚æœä¸€ä¸ªå…¬ç½‘å…±äº«IP,  é‚£è¿™ä¸ªIP çš„Port éƒ½ç”¨å®Œäº†å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640997175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1033219,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","nickname":"JianXu","note":"","ucode":"2A61BDBB573BDC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543181,"discussion_content":"è¿æ¥æ˜¯ç”¨ä¸å®Œçš„ï¼Œä½†ç›‘å¬çš„ç«¯å£ç¡®å®åªæœ‰6w+ä¸ªï¼Œè¿™ä¸ªç»•ä¸è¿‡å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640998305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":543177,"ip_address":""},"score":543181,"extra":""}]}]},{"had_liked":false,"id":70451,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1551100788,"is_pvip":false,"replies":[{"id":"25358","content":"å—¯ï¼Œæœ‰æ·±åº¦çš„ç•™è¨€è¿˜æ˜¯å‰é¢å¤šä¸€äº›","user_name":"ä½œè€…å›å¤","comment_id":70451,"uid":"1001282","ip_address":"","utype":1,"ctime":1551195139,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"27320904564","product_id":100020901,"comment_content":"å¤§ä¼™å„¿éƒ½æ‰é˜Ÿäº†å—ï¼Ÿæœ‰æ·±åº¦çš„é—®é¢˜ç•™è¨€è¶Šæ¥è¶Šå°‘ï¼Œæœ‰ä»·å€¼çš„é—®é¢˜å›ç­”ä¹Ÿå°‘äº†ã€‚","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440641,"discussion_content":"å—¯ï¼Œæœ‰æ·±åº¦çš„ç•™è¨€è¿˜æ˜¯å‰é¢å¤šä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131308,"user_name":"Geek_b04b12","can_delete":false,"product_type":"c1","uid":1112139,"ip_address":"","ucode":"F8705A21FCDF09","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","comment_is_top":false,"comment_ctime":1567699351,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23042535831","product_id":100020901,"comment_content":"1ï¼‰iptalbesçš„ä¸‰ä¸ªè¡¨<br><br>filter è¿™ä¸ªè¡¨ä¸»è¦ç”¨äºè¿‡æ»¤åŒ…çš„ï¼Œæ˜¯ç³»ç»Ÿé¢„è®¾çš„è¡¨ï¼Œè¿™ä¸ªè¡¨ä¹Ÿæ˜¯é˜¿é“­ç”¨çš„æœ€å¤šçš„ã€‚å†…å»ºä¸‰ä¸ªé“¾INPUTã€OUTPUTä»¥åŠFORWARDã€‚INPUTä½œç”¨äºè¿›å…¥æœ¬æœºçš„åŒ…ï¼›OUTPUTä½œç”¨äºæœ¬æœºé€å‡ºçš„åŒ…ï¼›FORWARDä½œç”¨äºé‚£äº›è·Ÿæœ¬æœºæ— å…³çš„åŒ…ã€‚<br><br>nat ä¸»è¦ç”¨å¤„æ˜¯ç½‘ç»œåœ°å€è½¬æ¢ï¼Œä¹Ÿæœ‰ä¸‰ä¸ªé“¾ã€‚PREROUTING é“¾çš„ä½œç”¨æ˜¯åœ¨åŒ…åˆšåˆšåˆ°è¾¾é˜²ç«å¢™æ—¶æ”¹å˜å®ƒçš„ç›®çš„åœ°å€ï¼Œå¦‚æœéœ€è¦çš„è¯ã€‚OUTPUTé“¾æ”¹å˜æœ¬åœ°äº§ç”Ÿçš„åŒ…çš„ç›®çš„åœ°å€ã€‚POSTROUTINGé“¾åœ¨åŒ…å°±è¦ç¦»å¼€é˜²ç«å¢™ä¹‹å‰æ”¹å˜å…¶æºåœ°å€ã€‚è¯¥è¡¨é˜¿é“­ç”¨çš„ä¸å¤šï¼Œä½†æœ‰æ—¶å€™ä¼šç”¨åˆ°ã€‚<br><br>mangle è¿™ä¸ªè¡¨ä¸»è¦æ˜¯ç”¨äºç»™æ•°æ®åŒ…æ‰“æ ‡è®°ï¼Œç„¶åæ ¹æ®æ ‡è®°å»æ“ä½œå“ªäº›åŒ…ã€‚è¿™ä¸ªè¡¨å‡ ä¹ä¸æ€ä¹ˆç”¨ã€‚é™¤éä½ æƒ³æˆä¸ºä¸€ä¸ªé«˜çº§ç½‘ç»œå·¥ç¨‹å¸ˆï¼Œå¦åˆ™ä½ å°±æ²¡æœ‰å¿…è¦èŠ±è´¹å¾ˆå¤šå¿ƒæ€åœ¨å®ƒä¸Šé¢ã€‚","like_count":6},{"had_liked":false,"id":131310,"user_name":"Geek_b04b12","can_delete":false,"product_type":"c1","uid":1112139,"ip_address":"","ucode":"F8705A21FCDF09","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","comment_is_top":false,"comment_ctime":1567699397,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18747568581","product_id":100020901,"comment_content":"http:&#47;&#47;www.apelearn.com&#47;study_v2&#47;chapter16.html#id3  è¿™ä¸ªé“¾æ¥æ˜¯æˆ‘åˆæ¬¡æ¥è§¦linuxçš„æ—¶å€™å­¦ä¹ çš„è¯¾ç¨‹ï¼Œå¯¹å°ç™½è›®å‹å¥½","like_count":5,"discussions":[{"author":{"id":1238051,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e4/23/ac13d916.jpg","nickname":"åœ†å“¥å“¥å‘ä¸¶","note":"","ucode":"8E56E3E68A3836","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557913,"discussion_content":"è›®ä¸é”™çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648022806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70759,"user_name":"æé€é¥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1551176562,"is_pvip":false,"replies":[{"id":"25365","content":"ä¸æ˜¯çš„ï¼Œå†…æ ¸æœ‰è¿æ¥è·Ÿè¸ªï¼ŒçŸ¥é“æ¯ä¸ªè¯·æ±‚çš„æ¥æºå’Œç›®çš„","user_name":"ä½œè€…å›å¤","comment_id":70759,"uid":"1001282","ip_address":"","utype":1,"ctime":1551195623,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"14436078450","product_id":100020901,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œ çœ‹äº†è®¿é—®baidu.comçš„ä¾‹å­ï¼Œå‘åŒ…å’Œæ”¶æŠ¥éƒ½æ˜¯éœ€è¦NATçš„ï¼Œé‚£æ˜¯ä¸æ˜¯åªé…ç½®SNATæˆ–DNATï¼Œå°±ä¸èƒ½æ­£å¸¸è®¿é—®å¤–ç½‘æˆ–è¢«è®¿é—®äº†å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440815,"discussion_content":"ä¸æ˜¯çš„ï¼Œå†…æ ¸æœ‰è¿æ¥è·Ÿè¸ªï¼ŒçŸ¥é“æ¯ä¸ªè¯·æ±‚çš„æ¥æºå’Œç›®çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77375,"user_name":"honnkyou","can_delete":false,"product_type":"c1","uid":1026608,"ip_address":"","ucode":"FD5EC4120EE803","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg","comment_is_top":false,"comment_ctime":1552914671,"is_pvip":false,"replies":[{"id":"28214","content":"å—¯å—¯ï¼Œå¯ä»¥çš„ï¼ŒOUTPUTç”¨äºä»æœ¬æœºå‘å‡ºçš„åŒ…","user_name":"ä½œè€…å›å¤","comment_id":77375,"uid":"1001282","ip_address":"","utype":1,"ctime":1552921909,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10142849263","product_id":100020901,"comment_content":"&quot;å†æ¥çœ‹ DNATï¼Œæ˜¾ç„¶ï¼ŒDNAT éœ€è¦åœ¨ nat è¡¨çš„ PREROUTING æˆ–è€… OUTPUT é“¾ä¸­é…ç½®ï¼Œå…¶ä¸­ï¼Œ PREROUTING é“¾æ›´å¸¸ç”¨ä¸€äº›ï¼ˆå› ä¸ºå®ƒè¿˜å¯ä»¥ç”¨äºè½¬å‘çš„åŒ…ï¼‰ã€‚&quot;<br>DNATä¸æ˜¯è½¬æ¢åˆ°è¾¾åŒ…çš„ç›®çš„åœ°å€å—ï¼Ÿä¹Ÿå¯ä»¥åœ¨OUTPUTé“¾ä¸­é…ç½®å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443704,"discussion_content":"å—¯å—¯ï¼Œå¯ä»¥çš„ï¼ŒOUTPUTç”¨äºä»æœ¬æœºå‘å‡ºçš„åŒ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552921909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71703,"user_name":"æ›¾ç»çš„åå­—é•","can_delete":false,"product_type":"c1","uid":1083415,"ip_address":"","ucode":"EC9297BEC3085F","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/17/68aa48cb.jpg","comment_is_top":false,"comment_ctime":1551418419,"is_pvip":false,"replies":[{"id":"26313","content":"å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œé€šè¿‡NATè¿˜æ˜¯å¯ä»¥è®¿é—®å†…éƒ¨æœåŠ¡çš„ï¼Œå¦‚æœæœåŠ¡æœ¬èº«è®¾è®¡æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯ä¸€æ ·å—åˆ°æ”»å‡»","user_name":"ä½œè€…å›å¤","comment_id":71703,"uid":"1001282","ip_address":"","utype":1,"ctime":1551704446,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10141353011","product_id":100020901,"comment_content":"æˆ‘ä»¬æœ‰éƒ¨åˆ†ä¸šåŠ¡éœ€è¦å‘å¤–åŒæ­¥æ•°æ®ï¼Œä½†åˆå¿…é¡»ä¿è¯å†…ç½‘æœåŠ¡å™¨çš„å®‰å…¨ï¼Œæ‰€ä»¥æˆ‘å°±ä½¿ç”¨äº†natç½‘ç»œï¼Œå•çº¯çŸ¥é“å¤–ç½‘ipæ˜¯æ— æ³•æ”»å‡»çš„","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441284,"discussion_content":"å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œé€šè¿‡NATè¿˜æ˜¯å¯ä»¥è®¿é—®å†…éƒ¨æœåŠ¡çš„ï¼Œå¦‚æœæœåŠ¡æœ¬èº«è®¾è®¡æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯ä¸€æ ·å—åˆ°æ”»å‡»","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1551704446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71367,"user_name":"wwj","can_delete":false,"product_type":"c1","uid":1053787,"ip_address":"","ucode":"B98AE5F5D85A87","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLzvaL724GwtzZ5mcldUnlicicSlI8BXL9icRZbUOB10qjRMlmog7UTvwxSBHXagnPGGR1BYdjWcGGSg/132","comment_is_top":false,"comment_ctime":1551328988,"is_pvip":false,"replies":[{"id":"26300","content":"ä¸»è¦æ˜¯ç®¡ç†æ–¹å¼çš„åŒºåˆ«ï¼Œæ¯”å¦‚é™æ€è‚¯å®šæ¯”åŠ¨æ€ç®¡ç†è¦ç®€å•çš„å¤šï¼›è·Ÿè¿æ¥è·Ÿè¸ªæ²¡æœ‰ç›´æ¥å…³ç³»ï¼ˆåªæ˜¯Linuxä½¿ç”¨äº†è¿æ¥è·Ÿè¸ªï¼‰ã€‚","user_name":"ä½œè€…å›å¤","comment_id":71367,"uid":"1001282","ip_address":"","utype":1,"ctime":1551702767,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10141263580","product_id":100020901,"comment_content":"natçš„ä¸‰ç§ç±»å‹æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«ã€å’Œé“¾æ¥è¿½è¸ªçš„è”ç³»æœ‰æ˜¯ä»€ä¹ˆ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441128,"discussion_content":"ä¸»è¦æ˜¯ç®¡ç†æ–¹å¼çš„åŒºåˆ«ï¼Œæ¯”å¦‚é™æ€è‚¯å®šæ¯”åŠ¨æ€ç®¡ç†è¦ç®€å•çš„å¤šï¼›è·Ÿè¿æ¥è·Ÿè¸ªæ²¡æœ‰ç›´æ¥å…³ç³»ï¼ˆåªæ˜¯Linuxä½¿ç”¨äº†è¿æ¥è·Ÿè¸ªï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551702767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350662,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1276373,"ip_address":"","ucode":"016F1DEBA895B8","user_header":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","comment_is_top":false,"comment_ctime":1657078627,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"5952045923","product_id":100020901,"comment_content":"è€å¸ˆæœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œæ„Ÿè§‰éœ€è¦é‡æ–°è®¨è®ºä¸‹ï¼š<br><br>ç¬¬ä¸€ä¸ªå…³äº SNAT å’Œ DNAT çš„è§£é‡Šï¼š<br><br>åŸæ–‡ä¸­è¯´ï¼š<br><br>SNAT ä¸»è¦ç”¨äºï¼Œå¤šä¸ªå†…ç½‘ IP å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP ï¼Œæ¥è®¿é—®å¤–ç½‘èµ„æºçš„åœºæ™¯ã€‚<br>DNAT ä¸»è¦é€šè¿‡å…¬ç½‘ IP çš„ä¸åŒç«¯å£å·ï¼Œæ¥è®¿é—®å†…ç½‘çš„å¤šç§æœåŠ¡ï¼ŒåŒæ—¶ä¼šéšè—åç«¯æœåŠ¡å™¨çš„çœŸå® IP åœ°å€ã€‚<br><br>è¿™é‡Œç»™äººçš„æ„Ÿè§‰å¥½åƒæ˜¯ SNAT å’Œ DNAT æ˜¯ä¸¤ä¸ªä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚ä½†æˆ‘ç†è§£ï¼Œå¹¶ä¸æ˜¯è¿™æ ·ã€‚<br>é¦–å…ˆå†…ç½‘çš„æœåŠ¡å™¨æƒ³å’Œå¤–ç½‘é€šä¿¡ï¼Œä¸å¯èƒ½æ˜¯å•æ–¹å‘çš„é€šä¿¡ï¼Œå¿…å®šæ¶‰åŠåˆ°ä¸€æ¥ä¸€å›ã€‚<br><br>å¦‚æœå•å•åš SNATï¼Œè¿™é‡Œä»…ä»…è§£å†³çš„æ˜¯å‘é€æ•°æ®åŒ…æ—¶ï¼ŒæŠŠæºåœ°å€è¿›è¡Œæ›¿æ¢å’Œå¤–ç½‘é€šä¿¡ã€‚<br>ä½†å¤–ç½‘æƒ³å’Œå†…ç½‘çš„æœåŠ¡å™¨é€šä¿¡ï¼Œè¿˜æ¶‰åŠåˆ°å›åŒ…çš„è¿‡ç¨‹ï¼Œå°†å¤–ç½‘çš„ç›®çš„åœ°å€ï¼ˆä¹Ÿå°±æ˜¯å‘é€çš„æºåœ°å€ï¼‰è¿›è¡Œè½¬æ¢ï¼Œä¹Ÿå°±æ˜¯ DNATã€‚<br><br>æ‰€ä»¥é€šè¿‡ SNAT å’Œ DNAT ç»“åˆèµ·æ¥æ‰èƒ½å®ç°å†…ç½‘è®¿é—®å¤–ç½‘ï¼Œä»¥åŠéšè—åç«¯æœåŠ¡å™¨åœ°å€çš„ä½œç”¨ã€‚<br><br><br>ç¬¬äºŒä¸ªæ˜¯å…³äºä¸€ä¸ªåŒå­¦çš„æé—®ï¼š<br><br>æé—®å¦‚ä¸‹ï¼š<br>æœ‰ä¸ªç–‘é—®ï¼Œ çœ‹äº†è®¿é—®baidu.comçš„ä¾‹å­ï¼Œå‘åŒ…å’Œæ”¶æŠ¥éƒ½æ˜¯éœ€è¦NATçš„ï¼Œé‚£æ˜¯ä¸æ˜¯åªé…ç½®SNATæˆ–DNATï¼Œå°±ä¸èƒ½æ­£å¸¸è®¿é—®å¤–ç½‘æˆ–è¢«è®¿é—®äº†å‘¢ï¼Ÿ<br>è€å¸ˆå›ç­”ï¼š<br>ä½œè€…å›å¤: ä¸æ˜¯çš„ï¼Œå†…æ ¸æœ‰è¿æ¥è·Ÿè¸ªï¼ŒçŸ¥é“æ¯ä¸ªè¯·æ±‚çš„æ¥æºå’Œç›®çš„<br><br>æˆ‘å’Œè€å¸ˆçš„çœ‹æ³•ä¸ä¸€æ ·ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªåŒå­¦è¯´çš„æ˜¯å¯¹çš„ï¼Œå¦‚æœä»…ä»…é…ç½® SNAT æˆ–è€… DNAT æ˜¯æ— æ³•é€šä¿¡çš„ï¼ŒåŸå› å°±åœ¨äºä¸Šé¢çš„è§£é‡Šï¼Œé€šä¿¡æ˜¯ä¸€æ¥ä¸€å›çš„è¿‡ç¨‹ã€‚<br>é™¤éï¼Œæˆ‘ä»¬éšå« SNAT åŒ…å«äº† DNAT çš„æ­¥éª¤ï¼Œæˆ–è€… DNAT åŒ…å«äº† SNAT çš„æ­¥éª¤ã€‚<br><br>å¹¶ä¸”è¿™é‡Œåšäº†å®éªŒéªŒè¯ï¼š<br>ä½¿ç”¨ docker ä»¥ run çš„å½¢å¼èµ·äº†ä¸€ä¸ª nginx å®¹æ˜“ï¼Œå¹¶æš´éœ² 80 ç«¯å£ç»™åˆ°å¤–ç½‘ã€‚<br>è¿™æ—¶å¤–é¢æ˜¯å¯ä»¥å’Œ nginx æ­£å¸¸äº¤äº’çš„ã€‚<br><br>å¹¶ä¸”æŸ¥çœ‹ iptables ä¸­ nat è¡¨çš„ï¼ŒPREROUTING å’Œ POSTROUTING é“¾ã€‚<br>å¯ä»¥æ‰¾åˆ° PREROUTING åšäº† DNATã€‚<br>POSTROUTING åšäº†MASQUERADEï¼Œå°±æ˜¯åŠ¨æ€çš„ snat.<br><br>å½“æˆ‘æ‰‹åŠ¨æŠŠ DNAT åˆ é™¤ï¼Œå…‰ç•™ä¸‹ snat æ—¶ï¼Œè¿™æ—¶æ˜¯æ— æ³•æ­£å¸¸é€šä¿¡çš„ã€‚<br>åœ¨å®¹å™¨å†…æŠ“åŒ…åå‘ç°ï¼Œæµé‡æ ¹æœ¬è¿›å…¥ä¸åˆ°å®¹å™¨å†…ã€‚","like_count":0},{"had_liked":false,"id":305729,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","comment_is_top":false,"comment_ctime":1628134615,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5923101911","product_id":100020901,"comment_content":"1. NAT å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š<br>é™æ€ NATï¼Œå³å†…ç½‘ IP ä¸å…¬ç½‘ IP æ˜¯ä¸€å¯¹ä¸€çš„æ°¸ä¹…æ˜ å°„å…³ç³»ï¼›<br>åŠ¨æ€ NATï¼Œå³å†…ç½‘ IP ä»å…¬ç½‘ IP æ± ä¸­ï¼ŒåŠ¨æ€é€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ˜ å°„ï¼›<br>ç½‘ç»œåœ°å€ç«¯å£è½¬æ¢ NAPTï¼ˆNetwork Address and Port Translationï¼‰ï¼Œå³æŠŠå†…ç½‘ IP æ˜ å°„åˆ°å…¬ç½‘ IP çš„ä¸åŒç«¯å£ä¸Šï¼Œè®©å¤šä¸ªå†…ç½‘ IP å¯ä»¥å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€ã€‚<br><br>2.  NAPT åˆ†ä¸ºä¸‰ç±»ï¼š<br>ç¬¬ä¸€ç±»æ˜¯æºåœ°å€è½¬æ¢ SNATï¼Œå³ç›®çš„åœ°å€ä¸å˜ï¼Œåªæ›¿æ¢æº IP æˆ–æºç«¯å£ã€‚SNAT ä¸»è¦ç”¨äºï¼Œå¤šä¸ªå†…ç½‘ IP å…±äº«åŒä¸€ä¸ªå…¬ç½‘ IPæ¥è®¿é—®å¤–ç½‘èµ„æºçš„åœºæ™¯ã€‚<br>ç¬¬äºŒç±»æ˜¯ç›®çš„åœ°å€è½¬æ¢ DNATï¼Œå³æº IP ä¿æŒä¸å˜ï¼Œåªæ›¿æ¢ç›®çš„ IP æˆ–è€…ç›®çš„ç«¯å£ã€‚DNAT ä¸»è¦é€šè¿‡å…¬ç½‘ IP çš„ä¸åŒç«¯å£å·ï¼Œæ¥è®¿é—®å†…ç½‘çš„å¤šç§æœåŠ¡ï¼ŒåŒæ—¶ä¼šéšè—åç«¯æœåŠ¡å™¨çš„çœŸå® IP åœ°å€ã€‚<br>ç¬¬ä¸‰ç±»æ˜¯åŒå‘åœ°å€è½¬æ¢ï¼Œå³åŒæ—¶ä½¿ç”¨ SNAT å’Œ DNATã€‚å½“æ¥æ”¶åˆ°ç½‘ç»œåŒ…æ—¶ï¼Œæ‰§è¡Œ DNATï¼ŒæŠŠç›®çš„ IP è½¬æ¢ä¸ºå†…ç½‘ IPï¼›è€Œåœ¨å‘é€ç½‘ç»œåŒ…æ—¶ï¼Œæ‰§è¡Œ SNATï¼ŒæŠŠæº IP æ›¿æ¢ä¸ºå¤–éƒ¨ IPã€‚<br><br>3. nat è¡¨å†…ç½®äº†ä¸‰ä¸ªé“¾<br>PREROUTING`ï¼Œç”¨äºè·¯ç”±åˆ¤æ–­å‰æ‰€æ‰§è¡Œçš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œå¯¹æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡Œ DNATï¼›<br>`POSTROUTING`ï¼Œç”¨äºè·¯ç”±åˆ¤æ–­åæ‰€æ‰§è¡Œçš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œå¯¹å‘é€æˆ–è½¬å‘çš„æ•°æ®åŒ…è¿›è¡Œ SNAT æˆ– MASQUERADEã€‚<br> `OUTPUT`ï¼Œç±»ä¼¼äº PREROUTINGï¼Œä½†åªå¤„ç†ä»æœ¬æœºå‘é€å‡ºå»çš„åŒ…ã€‚<br><br>4. SNAT<br>iptables -t nat -A POSTROUTING -s 192.168.0.0&#47;16 -j MASQUERADE<br>iptables -t nat -A POSTROUTING -s 192.168.0.2 -j SNAT --to-source 100.100.100.100<br><br>5. DNAT<br>iptables -t nat -A PREROUTING -d 100.100.100.100 -j DNAT --to-destination 192.168.0.2<br><br>6. åŒå‘åœ°å€è½¬æ¢<br>$ iptables -t nat -A POSTROUTING -s 192.168.0.2 -j SNAT --to-source 100.100.100.100<br>$ iptables -t nat -A PREROUTING -d 100.100.100.100 -j DNAT --to-destination 192.168.0.2<br><br>","like_count":1},{"had_liked":false,"id":70902,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1551226152,"is_pvip":false,"replies":[{"id":"25712","content":"å—¯","user_name":"ä½œè€…å›å¤","comment_id":70902,"uid":"1001282","ip_address":"","utype":1,"ctime":1551399293,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846193448","product_id":100020901,"comment_content":"æ‰“å¡day43<br>å·¥ä½œåœºæ™¯æ²¡ç”¨åˆ°natï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäº4å±‚æˆ–7å±‚çš„åä»£<br>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯å¯ä»¥çš„ï¼Œç¬¬äºŒä¸ªé—®é¢˜ä¸å¯ä»¥ï¼Œæˆ‘è®¤ä¸ºæ˜¯æœ‰è¿æ¥è¿½è¸ªè¡¨ï¼Œæ–‡ä»¶æ•°é‡ï¼Œç«¯å£æ•°é‡çš„é™åˆ¶","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440893,"discussion_content":"å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551399293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70454,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1551101485,"is_pvip":false,"replies":[{"id":"25359","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":70454,"uid":"1001282","ip_address":"","utype":1,"ctime":1551195147,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846068781","product_id":100020901,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œæ˜¯ç”±ï¼ˆæºåœ°å€ï¼šæºç«¯å£   ç›®çš„åœ°å€ï¼šç›®çš„ç«¯å£ ï¼‰æ¥æ ‡è®°çš„<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼šä¼šæŠŠè¿™å°linuxä¸»æœºæ’‘çˆ†äº†","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440642,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70282,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1551063817,"is_pvip":false,"replies":[{"id":"25353","content":"VMé‡Œé¢å¯ä»¥é…ç½®å›ºå®šIPï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ¢å…¶ä»–æ¨¡å¼","user_name":"ä½œè€…å›å¤","comment_id":70282,"uid":"1001282","ip_address":"","utype":1,"ctime":1551194932,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5846031113","product_id":100020901,"comment_content":"vmwareä¸­è™šæ‹Ÿæœºç½‘ç»œé€‰æ‹©NATæ¨¡å¼åï¼ŒIPåœ°å€ç»å¸¸å˜åŠ¨ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•è§£å†³ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440542,"discussion_content":"VMé‡Œé¢å¯ä»¥é…ç½®å›ºå®šIPï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ¢å…¶ä»–æ¨¡å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296482,"user_name":"CHN-Lee-ç‰ç±³","can_delete":false,"product_type":"c1","uid":2068721,"ip_address":"","ucode":"0A53080F38F229","user_header":"https://static001.geekbang.org/account/avatar/00/1f/90/f1/7f2b5e16.jpg","comment_is_top":false,"comment_ctime":1622994754,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622994754","product_id":100020901,"comment_content":"æ›¾ç»é‡è¿‡å†…ç½‘å¤§é‡æœºå™¨é€šè¿‡ä¸€ä¸ªå…¬ç½‘IPåœ°å€è®¿é—®å¦ä¸€ä¸ªå…¬ç½‘IPï¼Œå¯¼è‡´ç«¯å£å·ç”¨æ»¡çš„æƒ…å†µ","like_count":0},{"had_liked":false,"id":271449,"user_name":"Wade_é˜¿ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1688629,"ip_address":"","ucode":"5AE2E846A13443","user_header":"https://static001.geekbang.org/account/avatar/00/19/c4/35/2cc10d43.jpg","comment_is_top":false,"comment_ctime":1609645211,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609645211","product_id":100020901,"comment_content":"å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå½“å¤šä¸ªå†…ç½‘ IP åœ°å€çš„ç«¯å£å·ç›¸åŒæ—¶ï¼ŒMASQUERADE è¿˜å¯ä»¥æ­£å¸¸å·¥ä½œå—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šå¯ä»¥å·¥ä½œçš„ã€‚å› ä¸ºnetfilter_conntrackä¸­è®°å½•çš„æ˜¯äº”å…ƒç»„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æºç«¯å£ã€æºIpã€ç›®çš„ç«¯å£ã€ç›®çš„ipç­‰ä¿¡æ¯ã€‚å³ä¾¿æºç«¯å£ç›¸ç­‰ï¼Œä¹Ÿèƒ½ç»„æˆä¸åŒçš„è¿æ¥è®°å½•ã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚æœå†…ç½‘ IP åœ°å€æ•°é‡æˆ–è¯·æ±‚æ•°æ¯”è¾ƒå¤šï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨æ•´ä½“çš„æ€§èƒ½ä¸‹é™ï¼ŒåŒ…æ‹¬å¯¼è‡´cpuçš„è½¯ä¸­æ–­è¿‡å¤šï¼Œnf_conntrackè¿æ¥è·Ÿè¸ªè¡¨ä¸­è®°å½•è¿‡å¤šï¼Œå¯¼è‡´è·Ÿè¸ªè¡¨æº¢å‡ºã€‚å¯¼è‡´æœåŠ¡å™¨table over fullï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨å‡ºç°å“åº”å»¶æ—¶å¹¶ä¸¢åŒ…ç­‰é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":264902,"user_name":"å…µä¸´åŸä¸‹","can_delete":false,"product_type":"c1","uid":1316592,"ip_address":"","ucode":"88294A59484F17","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/f0/3051cc84.jpg","comment_is_top":false,"comment_ctime":1606703988,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606703988","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ã€‚ç³»ç»Ÿä½¿ç”¨çš„ï¼Œé˜¿é‡Œäº‘SLBï¼ˆè´Ÿè½½ï¼‰+ECSï¼ŒECSä¸Šè®¾ç½® iptables ç¦ç”¨æŸä¸ªIPï¼Œå¦‚ä½•èƒ½å¯ä½œç”¨ï¼Ÿé»˜è®¤æ˜¯å†…ç½‘çš„SLBçš„IP","like_count":0},{"had_liked":false,"id":175412,"user_name":"HunterYuan","can_delete":false,"product_type":"c1","uid":1015256,"ip_address":"","ucode":"F8900C33D29AA7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/d8/d7c77764.jpg","comment_is_top":false,"comment_ctime":1580712892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580712892","product_id":100020901,"comment_content":"å¯¹äºé—®é¢˜1ï¼šå¯ä»¥å·¥ä½œï¼Œå› ä¸ºNATè½¬æ¢æ˜¯é€šè¿‡çŠ¶æ€è¿æ¥è¡¨çš„ï¼ŒçŠ¶æ€è¿æ¥è¡¨ä¸­ä¼šè®°å½•æ­£å‘æ•°æ®çš„çŠ¶æ€çš„äº”å…ƒç»„å’Œè¿”ç°æ•°æ®çš„äº”å…ƒç»„ï¼Œé€šè¿‡æŸ¥æ‰¾æ­¤çŠ¶æ€è¿æ¥è¿›è¡Œé€†å‘è½¬æ¢ï¼ˆä¾‹å¦‚SNATçš„åå‘è½¬æ¢ï¼‰ï¼Œå»ºç«‹ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚æœ‰äº†è¿™äº›è¡¨ç¤ºå°±å¯ä»¥è¿›è¡Œå®Œå…¨è½¬æ¢ï¼Œå¯¹äºä¸åŒå†…ç½‘IPçš„ç›¸åŒç«¯å£æ•°æ®åŒ…ï¼Œè¿›è¡ŒMASQUERADEæ—¶ï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå‡ºæ¥å£çš„IPï¼Œè‹¥æ­¤æ—¶ä¸åŒå†…ç½‘IPè®¿é—®çš„ç›®çš„IPé€šè¿‡è·¯ç”±ï¼Œéƒ½æ˜¯ä»MASQUERADEè®¾å¤‡çš„åŒä¸€ä¸ªå£å‡ºå»ï¼Œé‚£ä¹ˆä»–ä»¬åšSNATæ—¶ä¼šä½¿ç”¨ç›¸åŒçš„IPï¼Œä¸ºäº†è¾¾åˆ°ä¸€ä¸€å¯¹åº”åŒºåˆ«ä¸åŒçš„å†…ç½‘IPï¼Œæ­¤æ—¶é€‰æ‹©ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ç«¯å£è¿›è¡ŒSAPTï¼Œè¿™æ ·åå‘çš„æ•°æ®è®¿é—®ç›¸åŒçš„å¤–ç½‘IPï¼Œé€šè¿‡ä¸åŒç›®çš„ç«¯å£ï¼Œæ‰¾åˆ°ç›¸åº”å†…ç½‘IPã€‚<br>å¯¹äºé—®é¢˜2ï¼Œè‹¥æ˜¯è¯·æ±‚æ•°é‡æ¯”è¾ƒå¤šï¼Œå¯¹äºé—®é¢˜ä¸€ä¸­éœ€è¦è¿›è¡ŒSAPTçš„è¢«å ç”¨ç«¯å£æ•°å°†æ˜¯å…¶ç“¶é¢ˆï¼Œè¿˜éœ€è¦è€ƒè™‘çŠ¶æ€è¿æ¥çš„æ€»æ•°æœ€å¤§å€¼ï¼Œæ˜¯å¦ä¸ºç“¶é¢ˆã€‚<br>å¯¹äºä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯æˆ‘çš„ç†è§£ï¼Œè‹¥æœ‰é”™è¯¯ï¼Œå¸Œæœ›è€å¸ˆæŒ‡æ­£ï¼Œä¸è¦å› ä¸ºæˆ‘çš„é”™è¯¯å›ç­”ï¼Œè¯¯å¯¼é˜Ÿå‹çš„ç†è§£ã€‚è°¢è°¢è€å¸ˆï¼Œä¸åèµæ•™ã€‚","like_count":0},{"had_liked":false,"id":131313,"user_name":"Geek_b04b12","can_delete":false,"product_type":"c1","uid":1112139,"ip_address":"","ucode":"F8705A21FCDF09","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","comment_is_top":false,"comment_ctime":1567700193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567700193","product_id":100020901,"comment_content":"ä»¥å‰åœ¨å­¦ä¹ linuxçš„æ—¶å€™ï¼Œè‡ªå·±æ­å»ºè¿‡linuxçš„ä¸‹çš„nginxçš„è´Ÿè½½å‡è¡¡ï¼Œ å†…ç½‘çš„å¤„ç†åçš„ç»“æœè½¬å‘ï¼Œè®°å¾—å¥½æƒ³è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ï¼Œå…·ä½“å“ªä¸€ä¸ªå¿˜è®°äº†ï¼Œå·¥ä½œçš„æ—¶å€™ç”¨è¿‡ä¸€æ¬¡ï¼Œå°†å†…ç½‘æœåŠ¡å™¨å¤„ç†è¯·æ±‚åè½¬å‘ç»™é‚£ä¸ªå¯ä»¥ä¸Šå¤–ç½‘çš„æœåŠ¡å™¨ï¼Œç„¶åè¿”å›ç»™å¤–ç½‘ã€‚ã€‚ã€‚æœ¬èŠ‚æœ‰æœ‰å¥½å‡ ä¸ªé™Œç”Ÿçš„åè¯ã€‚ã€‚","like_count":0},{"had_liked":false,"id":90535,"user_name":"é™³å…ˆæ£®","can_delete":false,"product_type":"c1","uid":1229006,"ip_address":"","ucode":"0F7AC617E3FE90","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg","comment_is_top":false,"comment_ctime":1556549744,"is_pvip":false,"replies":[{"id":"32529","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":90535,"uid":"1001282","ip_address":"","utype":1,"ctime":1556634069,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"1556549744","product_id":100020901,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¯ä»¥çš„ï¼Œå¤–ç½‘ç«¯å£æ˜ å°„å†…ç½‘ç«¯å£æ˜¯ä¸€å¯¹å¤šã€‚å°±è·Ÿä¹‹å‰è€å¸ˆç•™è¨€çš„ä¸€æ ·ï¼ŒæœåŠ¡ç«¯å¯¹ç«¯å£æ²¡æœ‰65535ä¸ªç«¯å£é™åˆ¶ä½†æ˜¯å®¢æˆ·ç«¯æœ‰ã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ä¼šæœ‰éšæ‚£ï¼Œè¯·æ±‚æ•°é‡å¤šçš„æ—¶å€™ä¼šå¯¼è‡´è½¯è·¯ç”±æœåŠ¡å™¨çš„èµ„æºå’Œæ€§èƒ½ä¸‹é™ï¼Œç”šè‡³å»¶æ—¶å’Œè¶…æ—¶éƒ½æœ‰å¯èƒ½ä»¥è‡³äºè¾¾åˆ°ç³»ç»Ÿèµ„æºçš„ç“¶é¢ˆç³»ç»Ÿçš„è½¯è¿æ¥æ•°è¾¾åˆ°ç“¶é¢ˆæˆ–è€…æ— æ³•æ­£å¸¸å·¥ä½œ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448557,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556634069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85665,"user_name":"xierongfei","can_delete":false,"product_type":"c1","uid":1298910,"ip_address":"","ucode":"2B4F061FA93A76","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mnBC29lF1RibHdwkZdPdGM9QRAl7Y7Aicad8vpmIEialjia93IEVSAHibkKdwHwfZr6qedVHiafKUD8Yk1v2eiaibj8l0w/132","comment_is_top":false,"comment_ctime":1555167739,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1555167739","product_id":100020901,"comment_content":"é—®é¢˜1ï¼š<br>å¯ä»¥, MASQUERADE ä¸»è¦ç”¨å†…éƒ¨å¤šä¸ªIPå…¬ç”¨ä¸€ä¸ªå…¬ç½‘è®¿é—®è®¿é—®å¤–éƒ¨åœ°å€ï¼Œå‘èµ·è¿æ¥çš„æ˜¯æœ¬æœºçš„ä¸€ä¸ªéšæœºç«¯å£ï¼Œå¹¶ä¸”æ˜¯ç”¨åœ¨å…¬ç½‘IPä¸å›ºå®šæƒ…å†µä¸‹ï¼Œæ¯”å¦‚æ‹¨å·åœºæ™¯ï¼›<br>é—®é¢˜2ï¼š<br> ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚è®¿é—®ç¼“æ…¢ã€‚å®¢æˆ·ç«¯è¿‡å¤šï¼Œå¹¶ä¸”è¿æ¥è¿‡å¤šï¼Œiptables conntrackè¡¨ä¼šæ»¡ï¼Œå¹¶å‘ç”Ÿç©ºé—´æº¢å‡º","like_count":0},{"had_liked":false,"id":84136,"user_name":"å¦‚æœ","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1554791733,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554791733","product_id":100020901,"comment_content":"DAY41ï¼Œæ‰“å¡","like_count":0},{"had_liked":false,"id":70916,"user_name":"å°åº„.Jerry","can_delete":false,"product_type":"c1","uid":1222795,"ip_address":"","ucode":"72EECA77AAA1CA","user_header":"https://static001.geekbang.org/account/avatar/00/12/a8/8b/c5c234b6.jpg","comment_is_top":false,"comment_ctime":1551227930,"is_pvip":true,"replies":[{"id":"26298","content":"tcp_tw_recycleæœ¬èº«çš„å®ç°å°±æœ‰é—®é¢˜ï¼Œä¸€å®šè¦ç¦æ­¢æ‰ï¼Œå¹¶ä¸”åœ¨æ–°çš„å†…æ ¸ï¼ˆ4.1ä»¥åï¼‰é‡Œä¹Ÿè¢«ç›´æ¥åˆ é™¤äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551702476,"ip_address":"","comment_id":70916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551227930","product_id":100020901,"comment_content":"æœ€è¿‘æˆ‘ä»¬çš„ä¸€ä¸ªå®¢æˆ·ï¼Œé‡åˆ°é—®é¢˜2çš„é—®é¢˜äº†ã€‚è¯¥å…¬å¸å¾ˆå¤šç”¨æˆ·åŒæ—¶åŠ å…¥æˆ‘ä»¬çš„ä¼šè®®ç³»ç»Ÿï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®¢æˆ·ä¼šè®¿é—®æˆ‘ä»¬éƒ¨ç½²åœ¨å½“åœ°æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ï¼Œç»“æœå¾ˆå¤šç”¨æˆ·è®¿é—®åˆ°æˆ‘ä»¬æ•°æ®ç¾å›½æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨äº†ï¼Œå¯¼è‡´ç³Ÿç³•çš„ä½“éªŒã€‚<br>æˆ‘ä»¬çš„ç½‘ç»œteamç»™çš„è§£å†³æ–¹æ¡ˆ:ç¦ç”¨äº†æˆ‘ä»¬æœåŠ¡å™¨çš„tcp_tw_recycleã€‚<br>çœ‹äº†man tcpçš„ä»‹ç»ï¼Œå¯¹äºNATç½‘ç»œä¸­ï¼Œè¦æ±‚ç¦æ‰tcp_tw_recycleã€‚ä½†æ˜¯å¯¹äºä¸ªä¸­çš„åŸç†è¿˜ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå¸Œæœ›è€å¸ˆå¯ä»¥å¸®å¿™è§£é‡Šä¸‹","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440898,"discussion_content":"tcp_tw_recycleæœ¬èº«çš„å®ç°å°±æœ‰é—®é¢˜ï¼Œä¸€å®šè¦ç¦æ­¢æ‰ï¼Œå¹¶ä¸”åœ¨æ–°çš„å†…æ ¸ï¼ˆ4.1ä»¥åï¼‰é‡Œä¹Ÿè¢«ç›´æ¥åˆ é™¤äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551702476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70864,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1551196949,"is_pvip":false,"replies":[{"id":"25707","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551399061,"ip_address":"","comment_id":70864,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551196949","product_id":100020901,"comment_content":"ç»ˆäºææ˜ç™½äº†iptablesåŸç†å’Œå†™æ³•","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440871,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551399061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70832,"user_name":"å”¯ç¾","can_delete":false,"product_type":"c1","uid":1263430,"ip_address":"","ucode":"9186A5B99DFBCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/46/61f16147.jpg","comment_is_top":false,"comment_ctime":1551191896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551191896","product_id":100020901,"comment_content":"é¡¹ç›®ä¸­è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œå­¦ä¹ ä¸­","like_count":0},{"had_liked":false,"id":70650,"user_name":"æ¾èŠ±çš®è›‹me","can_delete":false,"product_type":"c1","uid":1000054,"ip_address":"","ucode":"B0846CEEF6B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/76/256bbd43.jpg","comment_is_top":false,"comment_ctime":1551156914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551156914","product_id":100020901,"comment_content":"iptablesæ€§èƒ½è¿˜æ˜¯æœ‰é—®é¢˜çš„","like_count":0}]}