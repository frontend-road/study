{"id":127773,"title":"75 | 本地测试Kubernetes部署文件剖析","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":203796,"user_name":"Sirius","can_delete":false,"product_type":"c3","uid":1593340,"ip_address":"","ucode":"0E40836A5BC4A7","user_header":"https://static001.geekbang.org/account/avatar/00/18/4f/fc/5300e7d7.jpg","comment_is_top":false,"comment_ctime":1586267940,"is_pvip":false,"replies":[{"id":76325,"content":"加油！\n\n我的B站空间有本课程补充内容，可以关注：\nhttps:&#47;&#47;space.bilibili.com&#47;518029478","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1586353378,"ip_address":"","comment_id":203796,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"一个晚上看完了k8s大部分内容，受益匪浅","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490961,"discussion_content":"加油！\n\n我的B站空间有本课程补充内容，可以关注：\nhttps://space.bilibili.com/518029478","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586353378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279722,"user_name":"༺瑞༻","can_delete":false,"product_type":"c3","uid":1806077,"ip_address":"","ucode":"496AE09A13CB01","user_header":"https://static001.geekbang.org/account/avatar/00/1b/8e/fd/59eb251a.jpg","comment_is_top":false,"comment_ctime":1613924626,"is_pvip":false,"replies":[{"id":101780,"content":"1. ingress类似传统的反向代理，常用nginx实现。faraday也可以算是一个反向代理，可以同时处理html和API请求，不过它是基于Java的，对开发者更友好。\n2. 统一认证鉴权可以通过nginx+lua实现，不过的确维护成本比较高，可以考虑开发一个类似faraday的API网关(或者引入zuul或spring cloud gateway)，躲在nginx后面，专门做API网关，实现更细粒度的鉴权功能。引入网关之后，服务注册发现是需要的，如果是基于k8s环境的话，k8s本身是支持服务注册发现的，如果是非k8s环境，就要考虑引入eureka&#47;nacos之类的注册中心，或者再部署内部nginx进行集中反向代理。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1614179624,"ip_address":"","comment_id":279722,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师好，我这边有个疑问。1、faraday网关和ingress是个什么样的关系？ \n2、我们公司的ingress是nginx加plugin实现的，只会做一些公司级统一的认证。业务侧如果想做我们自己业务线的统一认证鉴权什么的，有什么好的建议吗？\n单独写lua学习成本较高还要自己维护有点麻烦。我自己想的是一、自己开发一个类似faraday的业务网关 二、引入zuul这类的网关，但是这里是不是就要引入另一套注册发现机制 。\n","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515851,"discussion_content":"1. ingress类似传统的反向代理，常用nginx实现。faraday也可以算是一个反向代理，可以同时处理html和API请求，不过它是基于Java的，对开发者更友好。\n2. 统一认证鉴权可以通过nginx+lua实现，不过的确维护成本比较高，可以考虑开发一个类似faraday的API网关(或者引入zuul或spring cloud gateway)，躲在nginx后面，专门做API网关，实现更细粒度的鉴权功能。引入网关之后，服务注册发现是需要的，如果是基于k8s环境的话，k8s本身是支持服务注册发现的，如果是非k8s环境，就要考虑引入eureka/nacos之类的注册中心，或者再部署内部nginx进行集中反向代理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614179624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128659,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1566935522,"is_pvip":false,"replies":[{"id":47888,"content":"ifconfig","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566998491,"ip_address":"","comment_id":128659,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师 什么命令能得到本机的ip地址 mac","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465044,"discussion_content":"ifconfig","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566998491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367998,"user_name":"stargazer","can_delete":false,"product_type":"c3","uid":1441320,"ip_address":"湖南","ucode":"3D00C23AA100FF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/yiaUicDHEyicjbC7bGADbM9adZZ5rO9UeQcGK8Go8TvB3T48g5EcVBETepegFZYjYibtTEepzvUU3mzf4C4DMUwDoA/132","comment_is_top":false,"comment_ctime":1675804277,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，请问为什么DB要部署在k8s之外？","like_count":0,"discussions":[{"author":{"id":2256935,"avatar":"https://static001.geekbang.org/account/avatar/00/22/70/27/4498ce51.jpg","nickname":"huanrong","note":"","ucode":"0F522FF7371E12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625298,"discussion_content":"DB是有状态的，数据都保存在本机，如果确定了本机DB的访问地址，不用K8s来部署也可以，实现起来更加方便，不过这样就没办法利用K8s的负载均衡、弹性伸缩、高可用等能力了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691553466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367997,"user_name":"stargazer","can_delete":false,"product_type":"c3","uid":1441320,"ip_address":"湖南","ucode":"3D00C23AA100FF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/yiaUicDHEyicjbC7bGADbM9adZZ5rO9UeQcGK8Go8TvB3T48g5EcVBETepegFZYjYibtTEepzvUU3mzf4C4DMUwDoA/132","comment_is_top":false,"comment_ctime":1675804195,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，本项目为什么要把DB部署在k8s之外？不能也部署在k8s吗？","like_count":0},{"had_liked":false,"id":295077,"user_name":"正是那朵玫瑰","can_delete":false,"product_type":"c3","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1622209121,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，我搭建了k8s环境，没有mysql service这个服务，pod里面通过外面mysql的ip地址也能访问到，是怎么回事呢？","like_count":0}]}