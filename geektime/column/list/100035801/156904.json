{"id":156904,"title":"17 | 消息队列：秒杀时如何处理每秒上万次的下单请求？","content":"<p>你好，我是唐扬。</p><p>在课程一开始，我就带你了解了高并发系统设计的三个目标：性能、可用性和可扩展性，而在提升系统性能方面我们一直关注的是系统的查询性能，也用了很多的篇幅去讲解数据库的分布式改造，各类缓存的原理和使用技巧。<strong>究其原因在于我们遇到的大部分场景都是读多写少，尤其是在一个系统的初级阶段。</strong></p><p>比如一个社区的系统初期一定是只有少量的种子用户在生产内容，而大部分的用户都在“围观”别人在说什么。此时，整体的流量比较小，而写流量可能只占整体流量的百分之一，那么即使整体的QPS到了10000次/秒，写请求也只是到了每秒100次，如果要对写请求做性能优化，它的性价比确实不太高。</p><p>但随着业务发展，你可能会遇到一些存在<strong>高并发写请求的场景，其中秒杀抢购就是最典型的场景。</strong>假设你的商城策划了一期秒杀活动，活动在第五天的00:00开始，仅限前200名，那么秒杀即将开始时，后台会显示用户正在疯狂地刷新APP或者浏览器来保证自己能够尽量早的看到商品。</p><p>这时，你面对的依旧是读请求过高，<strong>那么应对的措施有哪些呢？</strong></p><p>因为用户查询的是少量的商品数据，属于查询的热点数据，你可以采用缓存策略将请求尽量挡在上层的缓存中，能被静态化的数据（比如商城里的图片和视频数据）尽量做到静态化，这样就可以命中CDN节点缓存减少Web服务器的查询量和带宽负担。Web服务器比如Nginx可以直接访问分布式缓存节点，从而避免请求到达Tomcat等业务服务器。</p><!-- [[[read_end]]] --><p>当然，你可以加上一些限流的策略，比如对短时间之内来自某一个用户、某一个IP或者某一台设备的重复请求做丢弃处理。</p><p>通过这几种方式，请求就可以尽量挡在数据库之外了。</p><p>稍微缓解了读请求之后，00:00分秒杀活动准时开始，用户瞬间向电商系统请求生成订单，扣减库存，用户的这些写操作都是不经过缓存直达数据库的。1秒钟之内，有1万个数据库连接同时达到，系统的数据库濒临崩溃，寻找能够应对如此高并发的写请求方案迫在眉睫。这时你想到了消息队列。</p><h2>我所理解的消息队列</h2><p>你应该已经了解消息队列到底是什么了，所以我不再讲解它的概念，只聊聊自己对消息队列的看法。我在历年的工作经历中，一直把消息队列看作暂时存储数据的一个容器，认为它是一个平衡低速系统和高速系统处理任务时间差的工具，<strong>我给你举个形象的例子。</strong></p><p>比如古代的臣子经常去朝见皇上陈述一些国家大事，等着皇上拍板做决策。但是大臣很多，如果同时去找皇上，你说一句我说一句，皇上肯定会崩溃。后来变成臣子到了午门之后要原地等着皇上将他们一个一个地召见进大殿商议国事，这样就可以缓解皇上处理事情的压力了。你可以把午门看作一个暂时容纳臣子的容器，也就是我们所说的消息队列。</p><p>其实你在一些组件中都会看到消息队列的影子：</p><ul>\n<li>在Java线程池中我们就会使用一个队列来暂时存储提交的任务，等待有空闲的线程处理这些任务；</li>\n<li>操作系统中，中断的下半部分也会使用工作队列来实现延后执行；</li>\n<li>我们在实现一个RPC框架时，也会将从网络上接收到的请求写到队列里，再启动若干个工作线程来处理。</li>\n<li>……</li>\n</ul><p>总之，队列是在系统设计时一种常见的组件。</p><p>那么我们如何用消息队列解决秒杀场景下的问题呢？接下来，我们结合具体的例子来看看消息队列在秒杀场景下起到的作用。</p><h2>削去秒杀场景下的峰值写流量</h2><p>刚才提到，在秒杀场景下短时间之内数据库的写流量会很高，那么依照我们以前的思路应该对数据做分库分表。如果已经做了分库分表，那么就需要扩展更多的数据库来应对更高的写流量。但是无论是分库分表还是扩充更多的数据库都会比较复杂，原因是你需要将数据库中的数据做迁移，这个时间就要按天甚至按周来计算了。</p><p>而在秒杀场景下高并发的写请求并不是持续的，也不是经常发生的，而只有在秒杀活动开始后的几秒或者十几秒时间内才会存在。为了应对这十几秒的瞬间写高峰花费几天甚至几周的时间来扩容数据库，再在秒杀之后花费几天的时间来做缩容，<strong>这无疑是得不偿失的。</strong></p><p><strong>所以我们的思路是：</strong>将秒杀请求暂存在消息队列中，然后业务服务器会响应用户“秒杀结果正在计算中”，释放了系统资源之后再处理其它用户的请求。</p><p>我们会在后台启动若干个队列处理程序消费消息队列中的消息，再执行校验库存、下单等逻辑。因为只有有限个队列处理线程在执行，所以落入后端数据库上的并发请求是有限的。而请求是可以在消息队列中被短暂地堆积，当库存被消耗完之后，消息队列中堆积的请求就可以被丢弃了。</p><p><img src=\"https://static001.geekbang.org/resource/image/de/ad/de0a7a65a0bf51e1463d40d666a034ad.jpg?wh=1142*365\" alt=\"\"></p><p>这就是消息队列在秒杀系统中最主要的作用：<strong>削峰填谷，</strong>也就是说它可以削平短暂的流量高峰，虽说堆积会造成请求被短暂延迟处理，但是只要我们时刻监控消息队列中的堆积长度，在堆积量超过一定量时，增加队列处理机数量来提升消息的处理能力就好了，而且秒杀的用户对于短暂延迟知晓秒杀的结果也是有一定容忍度的。</p><p><strong>这里需要注意一下，</strong>我所说的是“短暂”延迟，如果长时间没有给用户公示秒杀结果，那么用户可能就会怀疑你的秒杀活动有猫腻了。所以在使用消息队列应对流量峰值时，需要对队列处理的时间、前端写入流量的大小、数据库处理能力做好评估，然后根据不同的量级来决定部署多少台队列处理程序。</p><p>比如你的秒杀商品有1000件，处理一次购买请求的时间是500ms，那么总共就需要500s的时间。这时你部署10个队列处理程序，那么秒杀请求的处理时间就是50s，也就是说用户需要等待50s才可以看到秒杀的结果，这是可以接受的。这时会并发10个请求到达数据库，并不会对数据库造成很大的压力。</p><h2>通过异步处理简化秒杀请求中的业务流程</h2><p>其实在大量的写请求“攻击”你的电商系统的时候，消息队列除了发挥主要的削峰填谷的作用之外，还可以实现<strong>异步处理</strong>来简化秒杀请求中的业务流程，提升系统的性能。</p><p>你想，在刚才提到的秒杀场景下，我们在处理购买请求时需要500ms。这时你分析了一下整个的购买流程，发现<strong>这里面会有主要的业务逻辑，也会有次要的业务逻辑：</strong>比如说，主要的流程是生成订单、扣减库存；次要的流程可能是我们在下单购买成功之后会给用户发放优惠券，会增加用户的积分。</p><p>假如发放优惠券的耗时是50ms，增加用户积分的耗时也是50ms，那么如果我们将发放优惠券、增加积分的操作放在另外一个队列处理机中执行，那么整个流程就缩短到了400ms，性能提升了20%，处理这1000件商品的时间就变成了400s。如果我们还是希望能在50s之内看到秒杀结果的话，只需要部署8个队列程序就好了。</p><p>经过将一些业务流程异步处理之后，我们的秒杀系统部署结构也会有所改变：</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/aa/3b19c4b5e93eeb32fd9665e330e6efaa.jpg?wh=1142*282\" alt=\"\"></p><h2>解耦实现秒杀系统模块之间松耦合</h2><p>除了异步处理和削峰填谷以外，消息队列在秒杀系统中起到的另一个作用是解耦合。</p><p>比如数据团队对你说，在秒杀活动之后想要统计活动的数据，借此来分析活动商品的受欢迎程度、购买者人群的特点以及用户对于秒杀互动的满意程度等等指标。而我们需要将大量的数据发送给数据团队，那么要怎么做呢？</p><p><strong>一个思路是：</strong>使用HTTP或者RPC的方式来同步地调用，也就是数据团队这边提供一个接口，我们实时将秒杀的数据推送给它，<strong>但是这样调用会有两个问题：</strong></p><ul>\n<li>整体系统的耦合性比较强，当数据团队的接口发生故障时，会影响到秒杀系统的可用性。</li>\n<li>当数据系统需要新的字段，就要变更接口的参数，那么秒杀系统也要随着一起变更。</li>\n</ul><p>这时，我们可以考虑使用消息队列降低业务系统和数据系统的直接耦合度。</p><p>秒杀系统产生一条购买数据后，我们可以先把全部数据发送给消息队列，然后数据团队再订阅这个消息队列的话题，这样它们就可以接收到数据，然后再做过滤和处理了。</p><p>秒杀系统在这样解耦合之后，数据系统的故障就不会影响到秒杀系统了，同时当数据系统需要新的字段时，只需要解析消息队列中的消息，拿到需要的数据就好了。</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/f6/6e096e287f2c418f663ab201f435a5f6.jpg?wh=1142*356\" alt=\"\"></p><p><strong>异步处理、解耦合和削峰填谷</strong>是消息队列在秒杀系统设计中起到的主要作用，其中异步处理可以简化业务流程中的步骤，提升系统性能；削峰填谷可以削去到达秒杀系统的峰值流量，让业务逻辑的处理更加缓和；解耦合可以将秒杀系统和数据系统解耦开，这样两个系统的任何变更都不会影响到另一个系统，</p><p>如果你的系统想要提升写入性能实现系统的低耦合，想要抵挡高并发的写流量，那么你就可以考虑使用消息队列来完成。</p><h2>课程小结</h2><p>本节课，我结合自己的实际经验，主要带你了解了消息队列在高并发系统设计中起到的作用以及一些注意事项，你需要了解的重点如下：</p><ul>\n<li>削峰填谷是消息队列最主要的作用，但是会造成请求处理的延迟。</li>\n<li>异步处理是提升系统性能的神器，但是你需要分清同步流程和异步流程的边界，同时消息存在着丢失的风险，我们需要考虑如何确保消息一定到达。</li>\n<li>解耦合可以提升你的整体系统的鲁棒性。</li>\n</ul><p>当然，你要知道，在使用消息队列之后虽然可以解决现有的问题，但是系统的复杂度也会上升。比如上面提到的业务流程中，同步流程和异步流程的边界在哪里？消息是否会丢失，是否会重复？请求的延迟如何能够减少？消息接收的顺序是否会影响到业务流程的正常执行？如果消息处理流程失败了之后是否需要补发？<strong>这些问题都是我们需要考虑的。</strong>我会利用接下来的两节课针对最主要的两个问题来讲讲解决思路：一个是如何处理消息的丢失和重复，另一个是如何减少消息的延迟。</p><p>引入了消息队列的同时也会引入了新的问题，需要新的方案来解决，这就是系统设计的挑战，也是系统设计独有的魅力，而我们也会在这些挑战中不断提升技术能力和系统设计能力。</p><h2>一课一思</h2><p>在今天的课程中，我提到了消息队列在高并发系统设计中起到的作用。那么你在开发过程中会在什么样的场景下使用消息队列呢？欢迎在留言区与我分享你的经验。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，也欢迎你将它分享给更多的朋友。</p>","comments":[{"had_liked":false,"id":145125,"user_name":"Victor","can_delete":false,"product_type":"c1","uid":1301853,"ip_address":"","ucode":"FE02A97FF9A007","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/5d/ea2e41d0.jpg","comment_is_top":false,"comment_ctime":1572221140,"is_pvip":false,"replies":[{"id":"56285","content":"其实方法无非有几种：<br>1. 使用锁的方式，比如分布式锁，也可以利用redis本身操作原子性的特点<br>2. 写入消息队列，在消息队列中做减库存的操作，做异步校验<br>","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572393022,"ip_address":"","comment_id":145125,"utype":1}],"discussion_count":22,"race_medal":0,"score":"181960847572","product_id":100035801,"comment_content":"秒杀场景，使用消息队列的话，怎么保证秒杀产品不超卖，这块计算逻辑是怎么处理的？","like_count":43,"discussions":[{"author":{"id":1543348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/b4/318ba5ef.jpg","nickname":"OldHemp","note":"","ucode":"8F58DA0BB478F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40636,"discussion_content":"可以在网关层用“令牌桶”控制，令牌数量是固定的，超过的请求可以被网关打回","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1572246903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1413499,"avatar":"https://static001.geekbang.org/account/avatar/00/15/91/7b/2dd4d0c1.jpg","nickname":"大鸡腿🍗","note":"","ucode":"38AF8AE00F6166","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":75634,"discussion_content":"我想知道超卖跟消息队列有什么关系？？？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1575737739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1981223,"avatar":"","nickname":"雒根雄","note":"","ucode":"895923AD3F55DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257794,"discussion_content":"超卖是减库时用数据库做的检查，一句sql搞定。和消息队列没关系。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588604404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1104850,"avatar":"https://static001.geekbang.org/account/avatar/00/10/db/d2/e29f8834.jpg","nickname":"lidashuang","note":"","ucode":"560ABE8032760E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1981223,"avatar":"","nickname":"雒根雄","note":"","ucode":"895923AD3F55DD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299521,"discussion_content":"数据库性能不行啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597720775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":257794,"ip_address":""},"score":299521,"extra":""}]},{"author":{"id":1160079,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/8f/4caf7f03.jpg","nickname":"Bang","note":"","ucode":"0CB8A52B177868","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40536,"discussion_content":"同问异步，这种情况要如何处理，是先查询库存是否够？如果不够就直接提示已经卖完？如果够的话再写队列？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572231606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559906,"discussion_content":"数据库更新保证","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649049799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472253,"discussion_content":"其实方法无非有几种：\n1. 使用锁的方式，比如分布式锁，也可以利用redis本身操作原子性的特点\n2. 写入消息队列，在消息队列中做减库存的操作，做异步校验\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572393022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018972,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","nickname":"亚林","note":"","ucode":"4A5A6D24314B79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414164,"discussion_content":"隔壁用令牌桶解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636680332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1584786,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2e/92/e1c38ca6.jpg","nickname":"KamTo  Hung","note":"","ucode":"00D5A6479DB784","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364083,"discussion_content":"redis自增长","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617361425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357469,"discussion_content":"update table set stock = stock -1 where stock > 0   这样可以防止超卖不","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615810835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":8,"child_discussions":[{"author":{"id":1667714,"avatar":"https://static001.geekbang.org/account/avatar/00/19/72/82/24fb9d18.jpg","nickname":"慕然","note":"","ucode":"8622102560A80F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371093,"discussion_content":"不行。看事务隔离级别，串行级别时可以。rr级别，并发执行就不行，需要for update手动加排他锁。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619633924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":357469,"ip_address":""},"score":371093,"extra":""},{"author":{"id":1644472,"avatar":"https://static001.geekbang.org/account/avatar/00/19/17/b8/123a3775.jpg","nickname":"makise","note":"","ucode":"D88369586CE309","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667714,"avatar":"https://static001.geekbang.org/account/avatar/00/19/72/82/24fb9d18.jpg","nickname":"慕然","note":"","ucode":"8622102560A80F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":380238,"discussion_content":"for update在查询的时候加排他锁，update语句的时候会自动加排他锁，共享资源不加锁更新肯定会产生冲突，事物作用是更新的资源是否对其他事物可见。执行更新语句的时候读取的一定是数据当前最新版本否则没法回滚。\n所以不明白你这for update是什么意思","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624408826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":371093,"ip_address":""},"score":380238,"extra":""},{"author":{"id":1446512,"avatar":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","nickname":"Lywane","note":"","ucode":"2B0027AA069CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667714,"avatar":"https://static001.geekbang.org/account/avatar/00/19/72/82/24fb9d18.jpg","nickname":"慕然","note":"","ucode":"8622102560A80F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":384953,"discussion_content":"我觉得可行。这不就是典型的乐观锁应用么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626832321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":371093,"ip_address":""},"score":384953,"extra":""}]},{"author":{"id":2347153,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/48gAcAh4bJE9v8VCJl4TY93E3mKYlWII3rhHTrAFXianGI0W7EWoIqvmwibvkicd5UicBWtJMfMOGsY4QLrU96OUiag/132","nickname":"YS","note":"","ucode":"A3A587C586FFA4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332139,"discussion_content":"借用分布式锁。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607073401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2034632,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/c8/15f055d3.jpg","nickname":"图灵机","note":"","ucode":"EB02DB653AD591","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298177,"discussion_content":"这个不应该是数据库读已提交事务隔离级别来保证吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597211589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276563,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","nickname":"高志强","note":"","ucode":"68737002043752","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213897,"discussion_content":"老师我想问一下，你说的分布式锁如何实现，是借助redis实现的么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585132749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1398577,"avatar":"https://static001.geekbang.org/account/avatar/00/15/57/31/6772744d.jpg","nickname":"ちよくん","note":"","ucode":"B71E9B16E4408F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":141433,"discussion_content":"RcoketMq 集群模式下可以放消息队列，广播模式还是要加锁(分布式锁或者数据库乐观锁，因为流量已经降下来了)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579421142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145434,"user_name":"longslee","can_delete":false,"product_type":"c1","uid":1465986,"ip_address":"","ucode":"C24E32E5B1B6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","comment_is_top":false,"comment_ctime":1572272524,"is_pvip":false,"discussion_count":8,"race_medal":0,"score":"134716258700","product_id":100035801,"comment_content":"打卡。太棒了，终于来到了消息队列环节。据说，有一种处理秒杀方式，是随机让一部分用户直接失败23333.  ","like_count":32,"discussions":[{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277081,"discussion_content":"你道破了天机。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590995700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243267,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f8/83/008b7b58.jpg","nickname":"梨还羽","note":"","ucode":"F6C89EF10DFC89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323288,"discussion_content":"直接前端返回一半用户hhhhh","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604912384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1429336,"avatar":"https://static001.geekbang.org/account/avatar/00/15/cf/58/dabb0f73.jpg","nickname":"Super Ollie","note":"","ucode":"4F30DE41673C97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550453,"discussion_content":"春晚红包都是这样搞的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644548893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2354861,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIOKqNRhiab2FfaztiaVsXjOKkWAx3JWzuGQ3GrMwKOHQPvoNFJVpszgJrKqax7wZosKIL5GvQV1hzQ/132","nickname":"急急急","note":"","ucode":"1963356A230E66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410048,"discussion_content":"哈哈哈，这就是考验手速+人品了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635580831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474954,"avatar":"https://static001.geekbang.org/account/avatar/00/16/81/8a/15a96a64.jpg","nickname":"Gatsby","note":"","ucode":"5DBFDA12556BDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404285,"discussion_content":"是的，很多都是这么做的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634281498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307497,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","nickname":"书策稠浊","note":"","ucode":"A29875CE15FDA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394372,"discussion_content":"最简单的处理办法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631859387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152145,"avatar":"https://static001.geekbang.org/account/avatar/00/11/94/91/6d6ca42f.jpg","nickname":"怀草诗","note":"","ucode":"78F8B9B4628F15","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388916,"discussion_content":"因为要保证高可用性呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629040334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2312464,"avatar":"https://static001.geekbang.org/account/avatar/00/23/49/10/9f702778.jpg","nickname":"积极","note":"","ucode":"ACED706363019C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372032,"discussion_content":"卑鄙","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620135057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158686,"user_name":"jun.hai","can_delete":false,"product_type":"c1","uid":1702947,"ip_address":"","ucode":"9740C5118DE6DC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epx1w8VkC30tcu4GlOCkUZB7picI2xesBBZF3rGWVPp9tHZfJdkc5iaqhSg7LOsvtefiajkM1YPno2JA/132","comment_is_top":false,"comment_ctime":1575433683,"is_pvip":false,"replies":[{"id":"61444","content":"我理解是在下单的时候，如果不支付，一般可以设置一个定时器，定时器时间一到，就把库存加上，同时定义订单失败","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576132511,"ip_address":"","comment_id":158686,"utype":1}],"discussion_count":2,"race_medal":0,"score":"126129485267","product_id":100035801,"comment_content":"老师您好，请教个问题：就是前面同学提到的在秒杀场景一下保证产品不超卖方案用redis的原子性特点，那么这个原子性在客户下单的时候用还是支付成功后才能用到？如果客户下单的时候用了redis的原子性减库存了，一旦客户不支付后取消订单了，这时候怎么处理已减掉的库存问题呢？谢谢","like_count":30,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476809,"discussion_content":"我理解是在下单的时候，如果不支付，一般可以设置一个定时器，定时器时间一到，就把库存加上，同时定义订单失败","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576132511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1431088,"avatar":"https://static001.geekbang.org/account/avatar/00/15/d6/30/1c7f1c39.jpg","nickname":"收腹，你咋有肚子","note":"","ucode":"F51B6450B41150","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337183,"discussion_content":"如果下单不支付，延时消息队列应该是可以结果的\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608817847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149433,"user_name":"Kean","can_delete":false,"product_type":"c1","uid":1126381,"ip_address":"","ucode":"D7FE9B709655E2","user_header":"https://static001.geekbang.org/account/avatar/00/11/2f/ed/7d7825c4.jpg","comment_is_top":false,"comment_ctime":1573217724,"is_pvip":false,"replies":[{"id":"57665","content":"可以的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1573432812,"ip_address":"","comment_id":149433,"utype":1}],"discussion_count":10,"race_medal":0,"score":"104652432828","product_id":100035801,"comment_content":"比如1000件商品  系统生成1000个令牌 拿到令牌的用户可以进入消息队列，其他未拿到令牌的直接返回已抢完，这种方式是否可以？","like_count":25,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473863,"discussion_content":"可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573432812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053955,"avatar":"https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg","nickname":"考休","note":"","ucode":"968DFC00D6D0CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55962,"discussion_content":"如果这样的话，拿到令牌的用户也没必要用消息队列了吧，直接处理就好了，必然这时候压力已经很小了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574417930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1053955,"avatar":"https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg","nickname":"考休","note":"","ucode":"968DFC00D6D0CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186218,"discussion_content":"还是要的，需要异步处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582647104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55962,"ip_address":""},"score":186218,"extra":""}]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559908,"discussion_content":"这个保证适量流量进来，消息队列保证不一下子打到db，做消峰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649049992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018972,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","nickname":"亚林","note":"","ucode":"4A5A6D24314B79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414165,"discussion_content":"隔壁老师的令牌桶方案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636680381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1499380,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/6vz8MgZia6Xwdhayv9Jdnee7HfDYSAMTUtMAAVORMhiaN8bIM0QJibrQ5EDqB8o5pWE6FRuaqguwG86o5Gh90ruDw/132","nickname":"不会爬树的熊","note":"","ucode":"E417D8D9D5FED2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372077,"discussion_content":"不太好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620178802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1272825,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6b/f9/da3ee7a8.jpg","nickname":"Onyanga","note":"","ucode":"DF4D22F0D51881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306632,"discussion_content":"拿到令牌的用户处理失败了，库存又恢复了一些。用户会明明奇妙，不是抢光了么。如果不恢复，就没有卖到实际期望的量了，有失败的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600337415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1731387,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/6b/3b/dfa6ff04.jpg","nickname":"WonderMing","note":"","ucode":"8C9A3F017555B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1272825,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6b/f9/da3ee7a8.jpg","nickname":"Onyanga","note":"","ucode":"DF4D22F0D51881","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366044,"discussion_content":"这种很容易解释 用户抢到了但是超过支付时间或者不支付了呗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617948117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306632,"ip_address":""},"score":366044,"extra":""}]},{"author":{"id":1249512,"avatar":"https://static001.geekbang.org/account/avatar/00/13/10/e8/172b5915.jpg","nickname":"张珂","note":"","ucode":"E0AFA940BEAC1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":146097,"discussion_content":"你发令牌怎么发？还是用Redis的原子扣减吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579597122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1702947,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epx1w8VkC30tcu4GlOCkUZB7picI2xesBBZF3rGWVPp9tHZfJdkc5iaqhSg7LOsvtefiajkM1YPno2JA/132","nickname":"jun.hai","note":"","ucode":"9740C5118DE6DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":71557,"discussion_content":"请教一下，这个方案怎么保持原子性呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575433428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145163,"user_name":"啊啊啊哦哦","can_delete":false,"product_type":"c1","uid":1309877,"ip_address":"","ucode":"68C7153ECAAC57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132","comment_is_top":false,"comment_ctime":1572225099,"is_pvip":false,"replies":[{"id":"56127","content":"轮询查询耗费系统资源。简单的思路是电商系统一般会支持系统通知功能或者私信功能，可以给用户发一个私信：）","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572303061,"ip_address":"","comment_id":145163,"utype":1}],"discussion_count":9,"race_medal":0,"score":"83176603723","product_id":100035801,"comment_content":"用户如何知道结果轮循查询。还是长连接通知<br>","like_count":20,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472275,"discussion_content":"轮询查询耗费系统资源。简单的思路是电商系统一般会支持系统通知功能或者私信功能，可以给用户发一个私信：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572303061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1981223,"avatar":"","nickname":"雒根雄","note":"","ucode":"895923AD3F55DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257777,"discussion_content":"其实我也不知道以后一直想知道后端用队列，app端是怎么知道结果的？从实际情况看，并不是作者说的系统通知功能或私信，而是app阻塞一会后就拿到了结果。所以我觉得要么是app先拿到中间结果后做轮训拿最终结果，要么后台主流程根本没用异步队列，只有次要流程用的队列。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588603844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559909,"discussion_content":"类似java的future","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649050082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1619438,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b5/ee/f56aebe6.jpg","nickname":"猩猩","note":"","ucode":"748E447BA89B03","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553793,"discussion_content":"同问，除了通知私信，哪种才是最优的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646097872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763091,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e7/13/6f76ada6.jpg","nickname":"大龄程序员在线治掉发","note":"","ucode":"A246D4E4683589","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":104405,"discussion_content":"用tcp建立连接,处理完成就可以及时通知客户端了,就200个人抢到的人建立tcp ..","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577431554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1465986,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","nickname":"longslee","note":"","ucode":"C24E32E5B1B6F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40826,"discussion_content":"我觉得是app向网关发起请求，网关内部采取通知等待模式，后端服务处理完也向网关发起请求告知结果，然后app请求的线程可以返回","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572273084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1161146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b7/ba/ae4cabd8.jpg","nickname":"仙道","note":"","ucode":"CF35D34B484B71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1465986,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","nickname":"longslee","note":"","ucode":"C24E32E5B1B6F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45408,"discussion_content":"你这样完全不行的。 不是跟你杠。 你把流量卡在网关那，也是占了极大的资源。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573035003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":40826,"ip_address":""},"score":45408,"extra":""},{"author":{"id":1029285,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b4/a5/396268e5.jpg","nickname":"死者苏生","note":"","ucode":"830E0483DE52A6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1465986,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","nickname":"longslee","note":"","ucode":"C24E32E5B1B6F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49023,"discussion_content":"不要同步等待，异步通知，否则一样耗费系统资源","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573548880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":40826,"ip_address":""},"score":49023,"extra":""},{"author":{"id":1465986,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","nickname":"longslee","note":"","ucode":"C24E32E5B1B6F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1029285,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b4/a5/396268e5.jpg","nickname":"死者苏生","note":"","ucode":"830E0483DE52A6","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":49105,"discussion_content":"嗯，现实是要这样的。我其实是没有实现过，只是循序渐进的一种思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573555025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":49023,"ip_address":""},"score":49105,"extra":""}]}]},{"had_liked":false,"id":145169,"user_name":"撒旦的堕落","can_delete":false,"product_type":"c1","uid":1116864,"ip_address":"","ucode":"15F6AA41EE556F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0a/c0/401c240e.jpg","comment_is_top":false,"comment_ctime":1572225521,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"57406800369","product_id":100035801,"comment_content":"负责过课程建设系统  由于课程对于一家教育网站是属于基础数据  所以课程的修改 比如增加了 一个章  需要通知课程审核系统  作业考试  视频学习 日志记录  在线大学等系统  用消息系统替换了rpc调用  降低了系统的响应时间  降低了系统之间的耦合 提升了系统的可维护性","like_count":13,"discussions":[{"author":{"id":1667141,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/45/fd84cfa1.jpg","nickname":"_#","note":"","ucode":"CA891A603647C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256305,"discussion_content":"RPC 跟消息队列是个补充加强关系吧，不能直接替换吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588469547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"夜辉","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667141,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/45/fd84cfa1.jpg","nickname":"_#","note":"","ucode":"CA891A603647C9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364651,"discussion_content":"应该将同步——》异步","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617546832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":256305,"ip_address":""},"score":364651,"extra":""}]}]},{"had_liked":false,"id":145741,"user_name":"Geek_Lee","can_delete":false,"product_type":"c1","uid":1595956,"ip_address":"","ucode":"F56DF79BD7EFA1","user_header":"","comment_is_top":false,"comment_ctime":1572357968,"is_pvip":false,"replies":[{"id":"56280","content":"这个要看业务的复杂度，业务比较轻量的话，单台服务器抗2000qps没有问题，如果因为中有大量io请求，可能也就300-400qps，不能一概而论","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572392742,"ip_address":"","comment_id":145741,"utype":1}],"discussion_count":4,"race_medal":0,"score":"48816998224","product_id":100035801,"comment_content":"看过很多都是关于设计如何缓存，如何hash一致性分库分表等，，但是没有见过讲解服务容器等需求，，，希望老师能给我解答下，，比如说：10000QPS 需要多少台服务器，，需要多少tomcat类似等容器等  我的理解是 请求最终都会到达容器吧，容器扛不住，，上层设计的完美好像也不能完全解决？？？ 老师能帮我解答下吗？？谢谢","like_count":11,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472556,"discussion_content":"这个要看业务的复杂度，业务比较轻量的话，单台服务器抗2000qps没有问题，如果因为中有大量io请求，可能也就300-400qps，不能一概而论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572392742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1735876,"avatar":"","nickname":"Geek_21ec93","note":"","ucode":"825485B9EAA5D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69430,"discussion_content":"说的单台服务器是什么配置呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1575287099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1666905,"avatar":"https://static001.geekbang.org/account/avatar/00/19/6f/59/21beefcb.jpg","nickname":"YY","note":"","ucode":"9E9F9A824D6129","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120505,"discussion_content":"这时候要压测？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578278582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365278,"discussion_content":"没说硬件配置，确实不好衡量作为参考，个人认为实际中还是要结合自身业务情况做测试的得到数据～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617759829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164192,"user_name":"长期规划","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1576907332,"is_pvip":false,"replies":[{"id":"63074","content":"可以这么理解~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1577242135,"ip_address":"","comment_id":164192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40231612996","product_id":100035801,"comment_content":"我理解这个解耦是为了提高整个系统的可用性。是指将业务系统的耦合转为业务系统与消息队列的耦合。即将多个系统的耦合转为对单一系统的耦合，而且这个单一系统没有业务逻辑，只存储。这两点可大大提高系统的可用性。不解耦的话，系统的可用性=A可用性 x B可用性 x C可用性... ，只要一个子系统不可用，整个系统就宕机了。解耦后只有所用子系统都不可用时，整个系统才不可用。","like_count":9,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478677,"discussion_content":"可以这么理解~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577242135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145216,"user_name":"Bang","can_delete":false,"product_type":"c1","uid":1160079,"ip_address":"","ucode":"0CB8A52B177868","user_header":"https://static001.geekbang.org/account/avatar/00/11/b3/8f/4caf7f03.jpg","comment_is_top":false,"comment_ctime":1572231501,"is_pvip":false,"replies":[{"id":"56129","content":"1. 可以使用产品的功能来通知，比如私信<br>2. 是的，是一个死循环的程序","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572303190,"ip_address":"","comment_id":145216,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27342035277","product_id":100035801,"comment_content":"秒杀场景使用了，消息队列，那么前端如何得获得秒杀结果呢？<br>消息队列的消费者，如何编写比较好， 是一个死循环监听程序吗？<br>","like_count":6,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472295,"discussion_content":"1. 可以使用产品的功能来通知，比如私信\n2. 是的，是一个死循环的程序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572303190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164958,"user_name":"Ricky Fung","can_delete":false,"product_type":"c1","uid":1051363,"ip_address":"","ucode":"7AEA1F8EC4A088","user_header":"https://static001.geekbang.org/account/avatar/00/10/0a/e3/9637bfdb.jpg","comment_is_top":false,"comment_ctime":1577116362,"is_pvip":false,"replies":[{"id":"63048","content":"赞~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1577239795,"ip_address":"","comment_id":164958,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23051952842","product_id":100035801,"comment_content":"消息队列的应用场景：1.流量削峰（秒杀系统），2.异步处理（非核心流程异步处理 提升效率），3.系统解耦（用户下单后增加积分、通知仓储服务发货）。常用的消息中间件有rabbitmq、kafka、rocketmq。","like_count":5,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478969,"discussion_content":"赞~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577239795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107550,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/5e/62158841.jpg","nickname":"取经人","note":"","ucode":"C3668CA65200DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328880,"discussion_content":"这种大面的方案都知道，怎么把它串联起来？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606266986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1996866,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/78/42/03295e28.jpg","nickname":"刘羽禅","note":"","ucode":"E1241C44D00477","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544210,"discussion_content":"2和3  其实是同一个事.    使用了异步处理,自然也就有了系统解耦的效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641440253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1484174,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cZN9xAaxlYHXTIGibcxP7HGNLWrorU5hw3ic7b6p2fe0JyE9yynibvWPW1CUJQl3iaMib79HOVjPnOkgW8msbMFImdw/132","nickname":"金石","note":"","ucode":"1A4A246812B60F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409907,"discussion_content":"其实场景2和3出现的频率比1要高很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635528980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198897,"user_name":"阴建锋","can_delete":false,"product_type":"c1","uid":1484805,"ip_address":"","ucode":"C04E0C675C4ED2","user_header":"https://static001.geekbang.org/account/avatar/00/16/a8/05/90b5b097.jpg","comment_is_top":false,"comment_ctime":1585472541,"is_pvip":false,"replies":[{"id":"74856","content":"一般用类似es的方案？","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585538750,"ip_address":"","comment_id":198897,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18765341725","product_id":100035801,"comment_content":"若系统要将所有请求（如:接口的请求与返回报文）的日志入库,如何实现,提高性能且不影响交易？","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489763,"discussion_content":"一般用类似es的方案？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585538750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1590892,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTImmLJCKerl9CI4sTpPDNCUgswp04ybsJ4J6mpJmMlHh43Iibp1RPOLam5PpOv2ZDGcjvGrY94lNRw/132","nickname":"Varphp","note":"","ucode":"889550391E3F75","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550567,"discussion_content":"Elk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644590208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145404,"user_name":"程序水果宝","can_delete":false,"product_type":"c1","uid":1371633,"ip_address":"","ucode":"1700DDFE073A56","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132","comment_is_top":false,"comment_ctime":1572267226,"is_pvip":false,"replies":[{"id":"56124","content":"一般消息队列中间件支持堆积，也就是长度可以非常大。","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572302815,"ip_address":"","comment_id":145404,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18752136410","product_id":100035801,"comment_content":"消息队列的长度如何设计，以什么为参考？如果请求数量超过了所有消息队列的长度，怎么处理，直接丢弃就可以了吗？","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472378,"discussion_content":"一般消息队列中间件支持堆积，也就是长度可以非常大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572302815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559910,"discussion_content":"要考虑消息雪崩问题，如果是请求线程pending等结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649050176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153661,"user_name":"何磊","can_delete":false,"product_type":"c1","uid":1047604,"ip_address":"","ucode":"78934C3ED4A342","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/34/c733b116.jpg","comment_is_top":false,"comment_ctime":1574294970,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"14459196858","product_id":100035801,"comment_content":"请教两个问题：<br>1. 由于秒杀数量是有限的，那么假如商品只有1000，队列满1000后，其他请求是否应该直接拒流呢？<br>2. 用户请求入队列后，为了及时反馈结果，前端会不断轮训查询结果。查询的读求情也会消耗资源，这部分是采用缓存策略还是结合读写访问不同业务机器来处理呢？","like_count":3,"discussions":[{"author":{"id":1250828,"avatar":"https://static001.geekbang.org/account/avatar/00/13/16/0c/53f2792c.jpg","nickname":"Cheney","note":"","ucode":"6ED4F3FDBA6D54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582904,"discussion_content":"1:不能简单拒绝请求,例如抢到超时不付款的,退货的\n2:服务端可以采用短信/push消息通知方案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659771051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1414971,"avatar":"https://static001.geekbang.org/account/avatar/00/15/97/3b/c98b68c1.jpg","nickname":"AngryApe","note":"","ucode":"E0125A8D2AC84B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":178099,"discussion_content":"1. 两个思路：通过限流模块直接失败一部分请求；设定一个失败请求的比率，通过后再根据队列是否已满去做后续的操作；\n2. 请求成功后，客户端建立ws连接，服务端通过ws连接将处理结果主动通知客户端。这里不建议采用轮询的方式，会给服务端造成压力，ws只是一种方式，其他类似的服务端通知方案都可以考虑。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582126630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":144661,"discussion_content":"队列满了，就是抢完了，你入队列的时候，不是还有一个库存校验吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579531555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763091,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e7/13/6f76ada6.jpg","nickname":"大龄程序员在线治掉发","note":"","ucode":"A246D4E4683589","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":104408,"discussion_content":"1.拒绝,直接返回个\n2.只有抢到的人才入队列,前面的人都不入队列的,不管抢不抢到,都是直接返回结果的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577431830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202998,"user_name":"GaGi","can_delete":false,"product_type":"c1","uid":1099053,"ip_address":"","ucode":"CC8D22E1DD8CA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c5/2d/1eebfc3c.jpg","comment_is_top":false,"comment_ctime":1586100227,"is_pvip":false,"replies":[{"id":"78248","content":"就是哪些需要同步处理，哪些可以丢到队列处理机里面处理","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1587622481,"ip_address":"","comment_id":202998,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10176034819","product_id":100035801,"comment_content":"对于这句话 “同步流程和异步流程的边界在哪里？”，老师可以列举一些例子吗？这个不是很清楚边界是指什么？","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490726,"discussion_content":"就是哪些需要同步处理，哪些可以丢到队列处理机里面处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587622481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184124,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1140494,"ip_address":"","ucode":"8FFC6764ED327B","user_header":"https://static001.geekbang.org/account/avatar/00/11/67/0e/2a51a2df.jpg","comment_is_top":false,"comment_ctime":1583228814,"is_pvip":true,"replies":[{"id":"72210","content":"看消息队列的性能了","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1584020088,"ip_address":"","comment_id":184124,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10173163406","product_id":100035801,"comment_content":"秒杀请求数据库扛不住 转移到消息队列上的入队 那么消息队列能支撑很多并发的入队请求吗?","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485896,"discussion_content":"看消息队列的性能了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584020088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154574,"user_name":"fomy","can_delete":false,"product_type":"c1","uid":1125834,"ip_address":"","ucode":"CD87EA03B1F327","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/ca/02b0e397.jpg","comment_is_top":false,"comment_ctime":1574481773,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10164416365","product_id":100035801,"comment_content":"为了系统之间的解耦，比如要对订单金额进行统计时。<br>异步处理，比如秒杀时，用Redis扣减库存，然后再异步下单，提高并发。<br>削峰填谷，对一些高并发的请求，先缓存到队列，然后再使用固定线程池消费，降低服务器压力。","like_count":2,"discussions":[{"author":{"id":2291843,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f8/83/60e2e754.jpg","nickname":"LSH","note":"","ucode":"65F5A9F819F1B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375241,"discussion_content":"思考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621524382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145702,"user_name":"蓝魔丶","can_delete":false,"product_type":"c1","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1572348233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10162282825","product_id":100035801,"comment_content":"数据同步、消息系统、短信系统、日志系统、事件广播等","like_count":2},{"had_liked":false,"id":145362,"user_name":"stg609","can_delete":false,"product_type":"c1","uid":1073025,"ip_address":"","ucode":"FB70A75A891BB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/81/1c614f4a.jpg","comment_is_top":false,"comment_ctime":1572258153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10162192745","product_id":100035801,"comment_content":"老师，有没有哪节课会介绍下 在分布式高并发&quot;写&quot;的时候，可能遇到的问题及解决思路？<br>比如如何既保证数据的正确，又做到高性能？ 比如分布式锁的利弊？actor模式的利弊等","like_count":2},{"had_liked":false,"id":145176,"user_name":"Bug? Feature!","can_delete":false,"product_type":"c1","uid":1164531,"ip_address":"","ucode":"F8FA8A0094FBA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/c4/f3/92f654f1.jpg","comment_is_top":false,"comment_ctime":1572226276,"is_pvip":false,"replies":[{"id":"56126","content":"：）","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1572302955,"ip_address":"","comment_id":145176,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10162160868","product_id":100035801,"comment_content":"解耦，异步，削峰！<br>感谢老师的分享，谢谢！","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472279,"discussion_content":"：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572302955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286754,"user_name":"夜辉","can_delete":false,"product_type":"c1","uid":1886331,"ip_address":"","ucode":"9421385F51FF9E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","comment_is_top":false,"comment_ctime":1617552618,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5912519914","product_id":100035801,"comment_content":"秒杀活动，让用户等50s后知道结果<br>没有即时性的反馈，用户体验不好吧，又不是众筹定时开奖活动","like_count":1,"discussions":[{"author":{"id":1224391,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIqJhicJVYfLiaYDzNNJj1Tzic1J2yEanobQdaZHdT41cVPib1EaXa3bsL1ExHhcEGFfm77hFJRe4WI6g/132","nickname":"FlyYan","note":"","ucode":"EE0728B6CB59A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401801,"discussion_content":"赞同。秒杀让用户等50秒感觉有点扯，体验太差，一般都要求秒知结果！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633741974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203022,"user_name":"shen","can_delete":false,"product_type":"c1","uid":1215066,"ip_address":"","ucode":"AE5737B0C7DC4F","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/5a/b67a82e3.jpg","comment_is_top":false,"comment_ctime":1586102927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881070223","product_id":100035801,"comment_content":"我们是将库存放到redis中，扣减redis直接通过mq通知db减库存，redis扣完直接返回已经卖光，redis处理性能很高了，老师文章说让用户等50s我觉得要用户是接受不了的","like_count":2},{"had_liked":false,"id":178167,"user_name":"AllenGFLiu","can_delete":false,"product_type":"c1","uid":1221991,"ip_address":"","ucode":"90FA8A619A2629","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/67/bf286335.jpg","comment_is_top":false,"comment_ctime":1581601270,"is_pvip":false,"replies":[{"id":"69656","content":"是队列处理程序，专门消费队列数据的~","user_name":"作者回复","comment_id":178167,"uid":"1448977","ip_address":"","utype":1,"ctime":1582001330,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5876568566","product_id":100035801,"comment_content":"我们会在后台启动若干个队列处理程序消费消息队列中的消息，再执行校验库存、下单等逻辑。因为只有有限个队列处理线程在执行，所以落入后端数据库上的并发请求是有限的。<br>这句话中的“会在后台启动若干个队列”应该是“启动若干个线程”吧？","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483688,"discussion_content":"是队列处理程序，专门消费队列数据的~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582001330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175036,"user_name":"骑上我心爱的小摩托","can_delete":false,"product_type":"c1","uid":1724758,"ip_address":"","ucode":"D743115BD013F3","user_header":"https://static001.geekbang.org/account/avatar/00/1a/51/56/6a31a9b4.jpg","comment_is_top":false,"comment_ctime":1580533958,"is_pvip":false,"replies":[{"id":"68356","content":"有些章节代码不太好加","user_name":"作者回复","comment_id":175036,"uid":"1448977","ip_address":"","utype":1,"ctime":1580872554,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"5875501254","product_id":100035801,"comment_content":"要是每一章都有代码就好了","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482607,"discussion_content":"有些章节代码不太好加","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580872554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277085,"discussion_content":"要是每一章都有代码就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590996152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153937,"user_name":"SPxiaomin","can_delete":false,"product_type":"c1","uid":1014091,"ip_address":"","ucode":"F632051A83CF27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/4b/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1574334207,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5869301503","product_id":100035801,"comment_content":"秒杀系统消息处理机处理了之后，怎么通知客户端服务的？另外建立个结果队列吗？由客户端轮训拉取？","like_count":1,"discussions":[{"author":{"id":1398577,"avatar":"https://static001.geekbang.org/account/avatar/00/15/57/31/6772744d.jpg","nickname":"ちよくん","note":"","ucode":"B71E9B16E4408F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":141442,"discussion_content":"两种，一是轮训，二是websocket ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579421532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150019,"user_name":"海罗沃德","can_delete":false,"product_type":"c1","uid":1165364,"ip_address":"","ucode":"8704F1D6980FA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/c8/34/fb871b2c.jpg","comment_is_top":false,"comment_ctime":1573446180,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5868413476","product_id":100035801,"comment_content":"剛學完李玥老師的消息對列課程，再回過頭來印證今天課程中的問題，體會更深刻","like_count":1},{"had_liked":false,"id":145466,"user_name":"旅途","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1572278627,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5867245923","product_id":100035801,"comment_content":"老师，用户是怎么得知结果的呢?","like_count":1,"discussions":[{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357462,"discussion_content":"websocket 或者 私信系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615809788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1263977,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/69/c0fcf4e8.jpg","nickname":"def","note":"","ucode":"39BDBEA0560C13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212640,"discussion_content":"个人觉得，前端可以做定时轮询查询结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584982372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337289,"user_name":"发条☞橙子","can_delete":false,"product_type":"c1","uid":1092603,"ip_address":"","ucode":"D3875C267EC08D","user_header":"https://static001.geekbang.org/account/avatar/00/10/ab/fb/e1e0dbe2.jpg","comment_is_top":false,"comment_ctime":1646734957,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1646734957","product_id":100035801,"comment_content":"老师，我有不一样的看法，您看看是否正确。我觉得使用 MQ 并不能降低系统之间参数的耦合度，因为消费者仍需根据生产者提供的消息内容来设计代码","like_count":0,"discussions":[{"author":{"id":2756576,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0f/e0/b53a7701.jpg","nickname":"骑车上天空","note":"","ucode":"364365E2721122","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582619,"discussion_content":"这里说的耦合度表示系统之间是否是同步请求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659533313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299287,"user_name":"幽灵","can_delete":false,"product_type":"c1","uid":1122174,"ip_address":"","ucode":"5FDBBFC74B2C1A","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/7e/f1d369e6.jpg","comment_is_top":false,"comment_ctime":1624544215,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1624544215","product_id":100035801,"comment_content":"比如你的秒杀商品有 1000 件，处理一次购买请求的时间是 500ms，那么总共就需要 500s 的时间。这时你部署 10 个队列处理程序，那么秒杀请求的处理时间就是 50s，也就是说用户需要等待 50s 才可以看到秒杀的结果。<br><br>这里为啥用户需要等待50s呢？比如 消费者从队列取到了数据消费了 订单也都生成了 整个耗时比如1s，那用户等1.5s不就行了吗","like_count":0,"discussions":[{"author":{"id":2756576,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0f/e0/b53a7701.jpg","nickname":"骑车上天空","note":"","ucode":"364365E2721122","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582620,"discussion_content":"说的可能是最后被消费的订单的用户所等待的时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659533383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211909,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7e/05/431d380f.jpg","nickname":"鸠摩·智","note":"","ucode":"6CD93CD1DB6955","race_medal":5,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388786,"discussion_content":"50s基本可认为是从活动开始到活动结束系统处理订单的时间。当然，如果结果是实时公布的，那么等待可能不需要50s，但是如果结果是活动结束后统一公布的，那就在50s开外了，要稍微加点结果通知用户的平均时间，但这个时间应该不会很长。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628952022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446512,"avatar":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","nickname":"Lywane","note":"","ucode":"2B0027AA069CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384954,"discussion_content":"因为前一秒还有积压的消息呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626832409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278121,"user_name":"Thomas Yang","can_delete":false,"product_type":"c1","uid":1612933,"ip_address":"","ucode":"29249144F708D7","user_header":"","comment_is_top":false,"comment_ctime":1612769898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612769898","product_id":100035801,"comment_content":"Nginx反向代理，MQ可以说是反向缓存，写缓存😄","like_count":0},{"had_liked":false,"id":253639,"user_name":"小山猫","can_delete":false,"product_type":"c1","uid":1369437,"ip_address":"","ucode":"D9A5D96113063B","user_header":"https://static001.geekbang.org/account/avatar/00/14/e5/5d/b6378027.jpg","comment_is_top":false,"comment_ctime":1602817798,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602817798","product_id":100035801,"comment_content":"老师队列怎么缓存请求呢，请问有没有对应的例子","like_count":0},{"had_liked":false,"id":244176,"user_name":"gogo","can_delete":false,"product_type":"c1","uid":1003104,"ip_address":"","ucode":"E8F0F3B000020A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/60/0d5aa340.jpg","comment_is_top":false,"comment_ctime":1598418665,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1598418665","product_id":100035801,"comment_content":"老师您好，使用消息队列做秒杀，如果有100w用户参与了，商品库存1000件，队列处理机处理完库存之后，剩下的100w-1000个用户是不是也要发送站内信提示秒杀失败呢？这样的话，这些用户怎么保证通知的延迟时间呢","like_count":0,"discussions":[{"author":{"id":1024994,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a3/e2/5cb4f43f.jpg","nickname":"laolinshi","note":"","ucode":"269B879389D7D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554644,"discussion_content":"对于写请求，遵循的原则是尽量把大量无效的写请求挡在系统的上层，比如nigix或者web层，只让少量的请求穿透到数据库，这样可以缓解数据的处理压力提高系统的可靠性。这个时候的处理办法是在系统的上层部署缓存，在缓存中设置商品的库存量。对于每一个到达系统上层的请求，先去缓存中查询商品库存，如果发现库存为0，这个请求就可以直接返回给用户提示“秒杀活动已结束”。如果发现库存不为0系统就把这个请求放入消息队列等待慢慢处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646530709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233576,"user_name":"Javatar","can_delete":false,"product_type":"c1","uid":2032840,"ip_address":"","ucode":"E216645CDF632C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","comment_is_top":false,"comment_ctime":1594358455,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1594358455","product_id":100035801,"comment_content":"老师你好，课程中有提到主要业务流程结束后，发优惠卷，或者给数仓做统计，等等以及其他业务，都是发个消息出去。那我想问最后岂不是要发好多消息？有没有可能采用一种广播的方式？","like_count":0,"discussions":[{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357463,"discussion_content":"消息队列有点对点和广播模式两种，发广播就行，下游系统都去订阅广播通知","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615809967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232644,"user_name":"TiTi","can_delete":false,"product_type":"c1","uid":1127343,"ip_address":"","ucode":"58F19596A1EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/af/dda311cf.jpg","comment_is_top":false,"comment_ctime":1594078749,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1594078749","product_id":100035801,"comment_content":"老师您好！您在文中提到了将主要服务和次要服务分开 使用各自的“微服务”组件订阅同一个消息队列 再分别处理各自的逻辑 那碰到需要保证全局事务一致性的时候有没有好的办法？比如订单服务处理消息异常时 也需要回滚积分和优惠券服务相关的操作 该如何处理呢？","like_count":0,"discussions":[{"author":{"id":2756576,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0f/e0/b53a7701.jpg","nickname":"骑车上天空","note":"","ucode":"364365E2721122","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582621,"discussion_content":"次要服务执行逻辑时先check一下订单状态，n秒内订单状态就重试，超过n秒后就退出，同时保存日志做对账处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659533601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357465,"discussion_content":"我是觉得分布式事务跟业务关联性很大， 是重试还是回滚看业务需求。 这里重试就好了吧，既然都发了优惠券了，那肯定就是秒杀成功了，订单服务处理异常那就让他重试好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615810186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224194,"user_name":"范闲","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1591316583,"is_pvip":false,"replies":[{"id":"82713","content":"👍","user_name":"作者回复","comment_id":224194,"uid":"1448977","ip_address":"","utype":1,"ctime":1591538277,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"1591316583","product_id":100035801,"comment_content":"消息队列:应用在高并发写请求的时候<br>1.削峰填谷<br>2.异步处理<br>3.系统限流","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497396,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591538277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219810,"user_name":"ArtistLu","can_delete":false,"product_type":"c1","uid":1166373,"ip_address":"","ucode":"2E641A3EB4F9AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/cc/25/8c6eab2c.jpg","comment_is_top":false,"comment_ctime":1590105016,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1590105016","product_id":100035801,"comment_content":"老师，请问用阻塞队列，队列容量就是秒杀商品库存，第一次阻塞后的请求直接返回秒杀失败，这样可行吗？是否更优？","like_count":0},{"had_liked":false,"id":196834,"user_name":"Evan","can_delete":false,"product_type":"c1","uid":1344281,"ip_address":"","ucode":"B877ABD0CF4661","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/19/0a3fe8c1.jpg","comment_is_top":false,"comment_ctime":1585316580,"is_pvip":false,"replies":[{"id":"74989","content":"服务器是无状态的，基本没有热点的问题，存储的热点可以通过限流或者或者缓存来解决","user_name":"作者回复","comment_id":196834,"uid":"1448977","ip_address":"","utype":1,"ctime":1585610790,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":1,"score":"1585316580","product_id":100035801,"comment_content":"如何解决热点数据问题，按产品的数据隔离数据热点，假如有百一台服务器，如何解决热点平均分摊的问题？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489400,"discussion_content":"服务器是无状态的，基本没有热点的问题，存储的热点可以通过限流或者或者缓存来解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585610790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196018,"user_name":"宝仔","can_delete":false,"product_type":"c1","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1585230838,"is_pvip":true,"replies":[{"id":"75178","content":"削去的峰值流量都去哪了呢：）","user_name":"作者回复","comment_id":196018,"uid":"1448977","ip_address":"","utype":1,"ctime":1585700588,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"1585230838","product_id":100035801,"comment_content":"削峰填谷，削峰知道什么意思了，填谷是啥意思啊？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489206,"discussion_content":"削去的峰值流量都去哪了呢：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585700588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173560,"user_name":"张珂","can_delete":false,"product_type":"c1","uid":1249512,"ip_address":"","ucode":"E0AFA940BEAC1C","user_header":"https://static001.geekbang.org/account/avatar/00/13/10/e8/172b5915.jpg","comment_is_top":false,"comment_ctime":1579597520,"is_pvip":false,"replies":[{"id":"67354","content":"是可以的","user_name":"作者回复","comment_id":173560,"uid":"1448977","ip_address":"","utype":1,"ctime":1579694493,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"1579597520","product_id":100035801,"comment_content":"老师，秒杀场景下采用队列的话，那么入队性能必须要好一点，我想问一下这里用Redis的队列OK吗？如果不行的话就采用分布式，但不能超卖，那就得去加锁，那么问题又来了，加锁怎么设计，达到要求的加锁性能？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482116,"discussion_content":"是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579694493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173080,"user_name":"ちよくん","can_delete":false,"product_type":"c1","uid":1398577,"ip_address":"","ucode":"B71E9B16E4408F","user_header":"https://static001.geekbang.org/account/avatar/00/15/57/31/6772744d.jpg","comment_is_top":false,"comment_ctime":1579421802,"is_pvip":false,"replies":[{"id":"67362","content":"是的","user_name":"作者回复","comment_id":173080,"uid":"1448977","ip_address":"","utype":1,"ctime":1579694917,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"1579421802","product_id":100035801,"comment_content":"秒杀的MQ其实可以类比计算机CPU处理速度大于主存而中间加了一层高速缓存！","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481952,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579694917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365303,"discussion_content":"个人认为这个类比不太妥当，cpu与内存之间的高速缓存是为了缓解两者之间速度的量级差，MQ的用处不在于此～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617767078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166974,"user_name":"Sun Fei","can_delete":false,"product_type":"c1","uid":1032631,"ip_address":"","ucode":"092EC0992050BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/b7/57f153f6.jpg","comment_is_top":false,"comment_ctime":1577661713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577661713","product_id":100035801,"comment_content":"按照一定的比例，过滤流量。","like_count":0},{"had_liked":false,"id":148393,"user_name":"云师兄","can_delete":false,"product_type":"c1","uid":1010459,"ip_address":"","ucode":"4475AF1598FBFD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/1b/4b397b80.jpg","comment_is_top":false,"comment_ctime":1573001777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573001777","product_id":100035801,"comment_content":"在接入层收到请求后写入到消息队列，然后接入层直接返回给了客户端，后续处理结果不需要再经过接入层了吗？像一些网页购物秒杀，具体请求的流程老师可以详细讲一下吗","like_count":0},{"had_liked":false,"id":145575,"user_name":"小虎","can_delete":false,"product_type":"c1","uid":1359878,"ip_address":"","ucode":"66CCAB2C757B3C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDuUeF7u9lAY3qmfKSfDBQzCJuveFVyIGE7D1PEI8ZQ1kTScwvRdruYHff0zpEnJWlsYicLlWGvcTg/132","comment_is_top":false,"comment_ctime":1572318543,"is_pvip":false,"replies":[{"id":"56191","content":"下一讲等着你🤓🤓🤓🤓","user_name":"编辑回复","comment_id":145575,"uid":"1564447","ip_address":"","utype":2,"ctime":1572321396,"user_name_real":"朱会"}],"discussion_count":2,"race_medal":0,"score":"1572318543","product_id":100035801,"comment_content":"言简意赅，非常到位，如果能讲讲如何处理消息丢失和重复就更好了哈哈","like_count":0,"discussions":[{"author":{"id":1564447,"avatar":"https://static001.geekbang.org/account/avatar/00/17/df/1f/650a1d51.jpg","nickname":"小白兔奶糖","note":"","ucode":"AD0B858CFD1304","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472475,"discussion_content":"下一讲等着你🤓🤓🤓🤓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572321396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1369437,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e5/5d/b6378027.jpg","nickname":"小山猫","note":"","ucode":"D9A5D96113063B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312786,"discussion_content":"老师好，请求怎么缓存到消息队列呢。有对应的例子吗。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602817671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145564,"user_name":"👽","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1572316599,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"1572316599","product_id":100035801,"comment_content":"没有消息队列使用经验，谈谈个人理解：<br>消息队列的使用的前提：对系统的实时性不是极高，只是短暂的极高并发，不存在持续高并发（持续高并发需要通过其他方式解决）。<br>例如：类似于微信报警，需要系统在接到报警信息的瞬间就要弹出报警位置，以及给出相应告警，这种对实时要求极高的业务，就不适用于消息队列。<br>反之：各种抢票业务中，则可以用消息队列。抢票与秒杀类似，都是短暂的高并发，不会持续很久。所以可以使用消息队列来解决。","like_count":0,"discussions":[{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209376,"discussion_content":"突发流量没法所有都能及时应付得了的，除非你平时就以10倍容量冗余度来部署，你的运营成本很大。你没理解老师说的，你必须能保证后端能有这个处理能力。你搞混了两个概念。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584629137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"👽","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209692,"discussion_content":"技术是为业务服务的，你先要搞清楚业务要求。十倍冗余？我明确告诉你，十倍是不够的。很多技术，是不能用运营成本两个字来衡量的。\n有可能影响到国家安全，人生安全相关的业务，就不是成本两个字能解释的。而且这种业务，都是有一定力量来配合的。这种业通常没人黑你的服务器还是其一（因为没钱赚，罪名还重），在当地警方的硬性要求上，也会做一定的限制。这种政策上可以强制下压的业务，你竟然能用成本来说？？？你以为所有业务都是淘宝秒杀嘛？等两分钟不买就不买了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584666311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":209376,"ip_address":""},"score":209692,"extra":""},{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"👽","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209738,"discussion_content":"你先搞清楚老师说的是什么。老师说的是，在后端能力一定的时候，我们怎样做事情，怎样不要压垮后端。如果你不是这样理解，这就是我跟你的理解不一样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584668235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":209692,"ip_address":""},"score":209738,"extra":""}]},{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209032,"discussion_content":"微信报警也可以，消息队列的延迟基本是毫秒级别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584601994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"👽","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209133,"discussion_content":"并不是延迟的问题。\n假设，现在某市x路发生火灾。当地几万人同时进行微信报警。 几万人的报警信息在消息队列排队。\n这时候，y路，发生抢劫。这时候这个信息就会排在后面。这对于报警业务来说是不允许的。这种业务不允许削峰填谷，而是需要以其他合理的手段来正面处理这种并发量。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584613207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":209032,"ip_address":""},"score":209133,"extra":""},{"author":{"id":1435845,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e8/c5/8bdb0bba.jpg","nickname":"DarKnight","note":"","ucode":"B04AFD03768827","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"👽","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376920,"discussion_content":"是否可以考虑，不同类型的信息通过不同的队列来给多个消费方来处理，其实还是要紧密结合真实场景来思考解决方案，例如火灾报警信息这种场景，相当于同一地点的单价商品秒杀场景，只要有一个人上报了，后续的重复上报是不需要重复处理的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622426024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":209133,"ip_address":""},"score":376920,"extra":""}]}]},{"had_liked":false,"id":145229,"user_name":"吃饭饭","can_delete":false,"product_type":"c1","uid":1231549,"ip_address":"","ucode":"95CFA07CDA2957","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","comment_is_top":false,"comment_ctime":1572233285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572233285","product_id":100035801,"comment_content":"业界这么做的不少哇，很经典","like_count":0}]}