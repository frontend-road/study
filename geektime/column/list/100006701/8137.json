{"id":8137,"title":"ç¬¬10è®² | å¦‚ä½•ä¿è¯é›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„? ConcurrentHashMapå¦‚ä½•å®ç°é«˜æ•ˆåœ°çº¿ç¨‹å®‰å…¨ï¼Ÿ","content":"<p>æˆ‘åœ¨ä¹‹å‰ä¸¤è®²ä»‹ç»äº†Javaé›†åˆæ¡†æ¶çš„å…¸å‹å®¹å™¨ç±»ï¼Œå®ƒä»¬ç»å¤§éƒ¨åˆ†éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»…æœ‰çš„çº¿ç¨‹å®‰å…¨å®ç°ï¼Œæ¯”å¦‚Vectorã€Stackï¼Œåœ¨æ€§èƒ½æ–¹é¢ä¹Ÿè¿œä¸å°½å¦‚äººæ„ã€‚å¹¸å¥½Javaè¯­è¨€æä¾›äº†å¹¶å‘åŒ…ï¼ˆjava.util.concurrentï¼‰ï¼Œä¸ºé«˜åº¦å¹¶å‘éœ€æ±‚æä¾›äº†æ›´åŠ å…¨é¢çš„å·¥å…·æ”¯æŒã€‚</p>\n<p>ä»Šå¤©æˆ‘è¦é—®ä½ çš„é—®é¢˜æ˜¯ï¼Œ<span class=\"orange\">å¦‚ä½•ä¿è¯å®¹å™¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŸConcurrentHashMapå¦‚ä½•å®ç°é«˜æ•ˆåœ°çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></p>\n<h2>å…¸å‹å›ç­”</h2>\n<p>Javaæä¾›äº†ä¸åŒå±‚é¢çš„çº¿ç¨‹å®‰å…¨æ”¯æŒã€‚åœ¨ä¼ ç»Ÿé›†åˆæ¡†æ¶å†…éƒ¨ï¼Œé™¤äº†Hashtableç­‰åŒæ­¥å®¹å™¨ï¼Œè¿˜æä¾›äº†æ‰€è°“çš„åŒæ­¥åŒ…è£…å™¨ï¼ˆSynchronized Wrapperï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨Collectionså·¥å…·ç±»æä¾›çš„åŒ…è£…æ–¹æ³•ï¼Œæ¥è·å–ä¸€ä¸ªåŒæ­¥çš„åŒ…è£…å®¹å™¨ï¼ˆå¦‚Collections.synchronizedMapï¼‰ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯åˆ©ç”¨éå¸¸ç²—ç²’åº¦çš„åŒæ­¥æ–¹å¼ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ€§èƒ½æ¯”è¾ƒä½ä¸‹ã€‚</p>\n<p>å¦å¤–ï¼Œæ›´åŠ æ™®éçš„é€‰æ‹©æ˜¯åˆ©ç”¨å¹¶å‘åŒ…æä¾›çš„çº¿ç¨‹å®‰å…¨å®¹å™¨ç±»ï¼Œå®ƒæä¾›äº†ï¼š</p>\n<ul>\n<li>\n<p>å„ç§å¹¶å‘å®¹å™¨ï¼Œæ¯”å¦‚ConcurrentHashMapã€CopyOnWriteArrayListã€‚</p>\n</li>\n<li>\n<p>å„ç§çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼ˆQueue/Dequeï¼‰ï¼Œå¦‚ArrayBlockingQueueã€SynchronousQueueã€‚</p>\n</li>\n<li>\n<p>å„ç§æœ‰åºå®¹å™¨çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ç­‰ã€‚</p>\n</li>\n</ul>\n<p>å…·ä½“ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ŒåŒ…æ‹¬æœ‰ä»ç®€å•çš„synchronizeæ–¹å¼ï¼Œåˆ°åŸºäºæ›´åŠ ç²¾ç»†åŒ–çš„ï¼Œæ¯”å¦‚åŸºäºåˆ†ç¦»é”å®ç°çš„ConcurrentHashMapç­‰å¹¶å‘å®ç°ç­‰ã€‚å…·ä½“é€‰æ‹©è¦çœ‹å¼€å‘çš„åœºæ™¯éœ€æ±‚ï¼Œæ€»ä½“æ¥è¯´ï¼Œå¹¶å‘åŒ…å†…æä¾›çš„å®¹å™¨é€šç”¨åœºæ™¯ï¼Œè¿œä¼˜äºæ—©æœŸçš„ç®€å•åŒæ­¥å®ç°ã€‚</p>\n<h2>è€ƒç‚¹åˆ†æ</h2>\n<p>è°ˆåˆ°çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘ï¼Œå¯ä»¥è¯´æ˜¯Javaé¢è¯•ä¸­å¿…è€ƒçš„è€ƒç‚¹ï¼Œæˆ‘ä¸Šé¢ç»™å‡ºçš„å›ç­”æ˜¯ä¸€ä¸ªç›¸å¯¹å®½æ³›çš„æ€»ç»“ï¼Œè€Œä¸”ConcurrentHashMapç­‰å¹¶å‘å®¹å™¨å®ç°ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®ºã€‚</p>\n<p>å¦‚æœè¦æ·±å…¥æ€è€ƒå¹¶å›ç­”è¿™ä¸ªé—®é¢˜åŠå…¶æ‰©å±•æ–¹é¢ï¼Œè‡³å°‘éœ€è¦ï¼š</p>\n<!-- [[[read_end]]] -->\n<ul>\n<li>\n<p>ç†è§£åŸºæœ¬çš„çº¿ç¨‹å®‰å…¨å·¥å…·ã€‚</p>\n</li>\n<li>\n<p>ç†è§£ä¼ ç»Ÿé›†åˆæ¡†æ¶å¹¶å‘ç¼–ç¨‹ä¸­Mapå­˜åœ¨çš„é—®é¢˜ï¼Œæ¸…æ¥šç®€å•åŒæ­¥æ–¹å¼çš„ä¸è¶³ã€‚</p>\n</li>\n<li>\n<p>æ¢³ç†å¹¶å‘åŒ…å†…ï¼Œå°¤å…¶æ˜¯ConcurrentHashMapé‡‡å–äº†å“ªäº›æ–¹æ³•æ¥æé«˜å¹¶å‘è¡¨ç°ã€‚</p>\n</li>\n<li>\n<p>æœ€å¥½èƒ½å¤ŸæŒæ¡ConcurrentHashMapè‡ªèº«çš„æ¼”è¿›ï¼Œç›®å‰çš„å¾ˆå¤šåˆ†æèµ„æ–™è¿˜æ˜¯åŸºäºå…¶æ—©æœŸç‰ˆæœ¬ã€‚</p>\n</li>\n</ul>\n<p>ä»Šå¤©æˆ‘ä¸»è¦æ˜¯å»¶ç»­ä¸“æ ä¹‹å‰ä¸¤è®²çš„å†…å®¹ï¼Œé‡ç‚¹è§£è¯»ç»å¸¸è¢«åŒæ—¶è€ƒå¯Ÿçš„HashMapå’ŒConcurrentHashMapã€‚ä»Šå¤©è¿™ä¸€è®²å¹¶ä¸æ˜¯å¯¹å¹¶å‘æ–¹é¢çš„å…¨é¢æ¢³ç†ï¼Œæ¯•ç«Ÿè¿™ä¹Ÿä¸æ˜¯ä¸“æ ä¸€è®²å¯ä»¥ä»‹ç»å®Œæ•´çš„ï¼Œç®—æ˜¯ä¸ªå¼€èƒƒèœå§ï¼Œç±»ä¼¼CASç­‰æ›´åŠ åº•å±‚çš„æœºåˆ¶ï¼Œåé¢ä¼šåœ¨Javaè¿›é˜¶æ¨¡å—ä¸­çš„å¹¶å‘ä¸»é¢˜æœ‰æ›´åŠ ç³»ç»Ÿçš„ä»‹ç»ã€‚</p>\n<h2>çŸ¥è¯†æ‰©å±•</h2>\n<p>1.ä¸ºä»€ä¹ˆéœ€è¦ConcurrentHashMapï¼Ÿ</p>\n<p>Hashtableæœ¬èº«æ¯”è¾ƒä½æ•ˆï¼Œå› ä¸ºå®ƒçš„å®ç°åŸºæœ¬å°±æ˜¯å°†putã€getã€sizeç­‰å„ç§æ–¹æ³•åŠ ä¸Šâ€œsynchronizedâ€ã€‚ç®€å•æ¥è¯´ï¼Œè¿™å°±å¯¼è‡´äº†æ‰€æœ‰å¹¶å‘æ“ä½œéƒ½è¦ç«äº‰åŒä¸€æŠŠé”ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è¿›è¡ŒåŒæ­¥æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œå¤§å¤§é™ä½äº†å¹¶å‘æ“ä½œçš„æ•ˆç‡ã€‚</p>\n<p>å‰é¢å·²ç»æè¿‡HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶å‘æƒ…å†µä¼šå¯¼è‡´ç±»ä¼¼CPUå ç”¨100%ç­‰ä¸€äº›é—®é¢˜ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½åˆ©ç”¨Collectionsæä¾›çš„åŒæ­¥åŒ…è£…å™¨æ¥è§£å†³é—®é¢˜å‘¢ï¼Ÿ</p>\n<p>çœ‹çœ‹ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å‘ç°åŒæ­¥åŒ…è£…å™¨åªæ˜¯åˆ©ç”¨è¾“å…¥Mapæ„é€ äº†å¦ä¸€ä¸ªåŒæ­¥ç‰ˆæœ¬ï¼Œæ‰€æœ‰æ“ä½œè™½ç„¶ä¸å†å£°æ˜æˆä¸ºsynchronizedæ–¹æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯åˆ©ç”¨äº†â€œthisâ€ä½œä¸ºäº’æ–¥çš„mutexï¼Œæ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„æ”¹è¿›ï¼</p>\n<pre><code>private static class SynchronizedMap&lt;K,V&gt;\n    implements Map&lt;K,V&gt;, Serializable {\n    private final Map&lt;K,V&gt; m;     // Backing Map\n    final Object      mutex;        // Object on which to synchronize\n    // â€¦\n    public int size() {\n        synchronized (mutex) {return m.size();}\n    }\n // â€¦ \n}\n\n</code></pre>\n<p>æ‰€ä»¥ï¼ŒHashtableæˆ–è€…åŒæ­¥åŒ…è£…ç‰ˆæœ¬ï¼Œéƒ½åªæ˜¯é€‚åˆåœ¨éé«˜åº¦å¹¶å‘çš„åœºæ™¯ä¸‹ã€‚</p>\n<p>2.ConcurrentHashMapåˆ†æ</p>\n<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ConcurrentHashMapæ˜¯å¦‚ä½•è®¾è®¡å®ç°çš„ï¼Œä¸ºä»€ä¹ˆå®ƒèƒ½å¤§å¤§æé«˜å¹¶å‘æ•ˆç‡ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘è¿™é‡Œå¼ºè°ƒï¼Œ<strong>ConcurrentHashMapçš„è®¾è®¡å®ç°å…¶å®ä¸€ç›´åœ¨æ¼”åŒ–</strong>ï¼Œæ¯”å¦‚åœ¨Java 8ä¸­å°±å‘ç”Ÿäº†éå¸¸å¤§çš„å˜åŒ–ï¼ˆJava 7å…¶å®ä¹Ÿæœ‰ä¸å°‘æ›´æ–°ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘è¿™é‡Œå°†æ¯”è¾ƒåˆ†æç»“æ„ã€å®ç°æœºåˆ¶ç­‰æ–¹é¢ï¼Œå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„ä¸»è¦åŒºåˆ«ã€‚</p>\n<p>æ—©æœŸConcurrentHashMapï¼Œå…¶å®ç°æ˜¯åŸºäºï¼š</p>\n<ul>\n<li>\n<p>åˆ†ç¦»é”ï¼Œä¹Ÿå°±æ˜¯å°†å†…éƒ¨è¿›è¡Œåˆ†æ®µï¼ˆSegmentï¼‰ï¼Œé‡Œé¢åˆ™æ˜¯HashEntryçš„æ•°ç»„ï¼Œå’ŒHashMapç±»ä¼¼ï¼Œå“ˆå¸Œç›¸åŒçš„æ¡ç›®ä¹Ÿæ˜¯ä»¥é“¾è¡¨å½¢å¼å­˜æ”¾ã€‚</p>\n</li>\n<li>\n<p>HashEntryå†…éƒ¨ä½¿ç”¨volatileçš„valueå­—æ®µæ¥ä¿è¯å¯è§æ€§ï¼Œä¹Ÿåˆ©ç”¨äº†ä¸å¯å˜å¯¹è±¡çš„æœºåˆ¶ä»¥æ”¹è¿›åˆ©ç”¨Unsafeæä¾›çš„åº•å±‚èƒ½åŠ›ï¼Œæ¯”å¦‚volatile accessï¼Œå»ç›´æ¥å®Œæˆéƒ¨åˆ†æ“ä½œï¼Œä»¥æœ€ä¼˜åŒ–æ€§èƒ½ï¼Œæ¯•ç«ŸUnsafeä¸­çš„å¾ˆå¤šæ“ä½œéƒ½æ˜¯JVM intrinsicä¼˜åŒ–è¿‡çš„ã€‚</p>\n</li>\n</ul>\n<p>ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªæ—©æœŸConcurrentHashMapå†…éƒ¨ç»“æ„çš„ç¤ºæ„å›¾ï¼Œå…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨åˆ†æ®µè®¾è®¡ï¼Œåœ¨è¿›è¡Œå¹¶å‘æ“ä½œçš„æ—¶å€™ï¼Œåªéœ€è¦é”å®šç›¸åº”æ®µï¼Œè¿™æ ·å°±æœ‰æ•ˆé¿å…äº†ç±»ä¼¼Hashtableæ•´ä½“åŒæ­¥çš„é—®é¢˜ï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/d4/d9/d45bcf9a34da2ef1ef335532b0198bd9.png?wh=881*611\" alt=\"\" /></p>\n<p>åœ¨æ„é€ çš„æ—¶å€™ï¼ŒSegmentçš„æ•°é‡ç”±æ‰€è°“çš„concurrencyLevelå†³å®šï¼Œé»˜è®¤æ˜¯16ï¼Œä¹Ÿå¯ä»¥åœ¨ç›¸åº”æ„é€ å‡½æ•°ç›´æ¥æŒ‡å®šã€‚æ³¨æ„ï¼ŒJavaéœ€è¦å®ƒæ˜¯2çš„å¹‚æ•°å€¼ï¼Œå¦‚æœè¾“å…¥æ˜¯ç±»ä¼¼15è¿™ç§éå¹‚å€¼ï¼Œä¼šè¢«è‡ªåŠ¨è°ƒæ•´åˆ°16ä¹‹ç±»2çš„å¹‚æ•°å€¼ã€‚</p>\n<p>å…·ä½“æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸€äº›MapåŸºæœ¬æ“ä½œçš„<a href=\"http://hg.openjdk.java.net/jdk7/jdk7/jdk/file/9b8c96f96a0f/src/share/classes/java/util/concurrent/ConcurrentHashMap.java\">æºç </a>ï¼Œè¿™æ˜¯JDK 7æ¯”è¾ƒæ–°çš„getä»£ç ã€‚é’ˆå¯¹å…·ä½“çš„ä¼˜åŒ–éƒ¨åˆ†ï¼Œä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç›´æ¥æ³¨é‡Šåœ¨ä»£ç æ®µé‡Œï¼Œgetæ“ä½œéœ€è¦ä¿è¯çš„æ˜¯å¯è§æ€§ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»€ä¹ˆåŒæ­¥é€»è¾‘ã€‚</p>\n<pre><code>public V get(Object key) {\n        Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead\n        HashEntry&lt;K,V&gt;[] tab;\n        int h = hash(key.hashCode());\n       //åˆ©ç”¨ä½æ“ä½œæ›¿æ¢æ™®é€šæ•°å­¦è¿ç®—\n       long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;\n        // ä»¥Segmentä¸ºå•ä½ï¼Œè¿›è¡Œå®šä½\n        // åˆ©ç”¨Unsafeç›´æ¥è¿›è¡Œvolatile access\n        if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp;\n            (tab = s.table) != null) {\n           //çœç•¥\n          }\n        return null;\n    }\n</code></pre>\n<p>è€Œå¯¹äºputæ“ä½œï¼Œé¦–å…ˆæ˜¯é€šè¿‡äºŒæ¬¡å“ˆå¸Œé¿å…å“ˆå¸Œå†²çªï¼Œç„¶åä»¥Unsafeè°ƒç”¨æ–¹å¼ï¼Œç›´æ¥è·å–ç›¸åº”çš„Segmentï¼Œç„¶åè¿›è¡Œçº¿ç¨‹å®‰å…¨çš„putæ“ä½œï¼š</p>\n<pre><code> public V put(K key, V value) {\n        Segment&lt;K,V&gt; s;\n        if (value == null)\n            throw new NullPointerException();\n        // äºŒæ¬¡å“ˆå¸Œï¼Œä»¥ä¿è¯æ•°æ®çš„åˆ†æ•£æ€§ï¼Œé¿å…å“ˆå¸Œå†²çª\n        int hash = hash(key.hashCode());\n        int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;\n        if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject          // nonvolatile; recheck\n             (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) //  in ensureSegment\n            s = ensureSegment(j);\n        return s.put(key, hash, value, false);\n    }\n\n</code></pre>\n<p>å…¶æ ¸å¿ƒé€»è¾‘å®ç°åœ¨ä¸‹é¢çš„å†…éƒ¨æ–¹æ³•ä¸­ï¼š</p>\n<pre><code>final V put(K key, int hash, V value, boolean onlyIfAbsent) {\n            // scanAndLockForPutä¼šå»æŸ¥æ‰¾æ˜¯å¦æœ‰keyç›¸åŒNode\n            // æ— è®ºå¦‚ä½•ï¼Œç¡®ä¿è·å–é”\n            HashEntry&lt;K,V&gt; node = tryLock() ? null :\n                scanAndLockForPut(key, hash, value);\n            V oldValue;\n            try {\n                HashEntry&lt;K,V&gt;[] tab = table;\n                int index = (tab.length - 1) &amp; hash;\n                HashEntry&lt;K,V&gt; first = entryAt(tab, index);\n                for (HashEntry&lt;K,V&gt; e = first;;) {\n                    if (e != null) {\n                        K k;\n                        // æ›´æ–°å·²æœ‰value...\n                    }\n                    else {\n                        // æ”¾ç½®HashEntryåˆ°ç‰¹å®šä½ç½®ï¼Œå¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œè¿›è¡Œrehash\n                        // ...\n                    }\n                }\n            } finally {\n                unlock();\n            }\n            return oldValue;\n        }\n\n</code></pre>\n<p>æ‰€ä»¥ï¼Œä»ä¸Šé¢çš„æºç æ¸…æ™°çš„çœ‹å‡ºï¼Œåœ¨è¿›è¡Œå¹¶å‘å†™æ“ä½œæ—¶ï¼š</p>\n<ul>\n<li>\n<p>ConcurrentHashMapä¼šè·å–å†å…¥é”ï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ŒSegmentæœ¬èº«å°±æ˜¯åŸºäºReentrantLockçš„æ‰©å±•å®ç°ï¼Œæ‰€ä»¥ï¼Œåœ¨å¹¶å‘ä¿®æ”¹æœŸé—´ï¼Œç›¸åº”Segmentæ˜¯è¢«é”å®šçš„ã€‚</p>\n</li>\n<li>\n<p>åœ¨æœ€åˆé˜¶æ®µï¼Œè¿›è¡Œé‡å¤æ€§çš„æ‰«æï¼Œä»¥ç¡®å®šç›¸åº”keyå€¼æ˜¯å¦å·²ç»åœ¨æ•°ç»„é‡Œé¢ï¼Œè¿›è€Œå†³å®šæ˜¯æ›´æ–°è¿˜æ˜¯æ”¾ç½®æ“ä½œï¼Œä½ å¯ä»¥åœ¨ä»£ç é‡Œçœ‹åˆ°ç›¸åº”çš„æ³¨é‡Šã€‚é‡å¤æ‰«æã€æ£€æµ‹å†²çªæ˜¯ConcurrentHashMapçš„å¸¸è§æŠ€å·§ã€‚</p>\n</li>\n<li>\n<p>æˆ‘åœ¨ä¸“æ ä¸Šä¸€è®²ä»‹ç»HashMapæ—¶ï¼Œæåˆ°äº†å¯èƒ½å‘ç”Ÿçš„æ‰©å®¹é—®é¢˜ï¼Œåœ¨ConcurrentHashMapä¸­åŒæ ·å­˜åœ¨ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªæ˜æ˜¾åŒºåˆ«ï¼Œå°±æ˜¯å®ƒè¿›è¡Œçš„ä¸æ˜¯æ•´ä½“çš„æ‰©å®¹ï¼Œè€Œæ˜¯å•ç‹¬å¯¹Segmentè¿›è¡Œæ‰©å®¹ï¼Œç»†èŠ‚å°±ä¸ä»‹ç»äº†ã€‚</p>\n</li>\n</ul>\n<p>å¦å¤–ä¸€ä¸ªMapçš„sizeæ–¹æ³•åŒæ ·éœ€è¦å…³æ³¨ï¼Œå®ƒçš„å®ç°æ¶‰åŠåˆ†ç¦»é”çš„ä¸€ä¸ªå‰¯ä½œç”¨ã€‚</p>\n<p>è¯•æƒ³ï¼Œå¦‚æœä¸è¿›è¡ŒåŒæ­¥ï¼Œç®€å•çš„è®¡ç®—æ‰€æœ‰Segmentçš„æ€»å€¼ï¼Œå¯èƒ½ä¼šå› ä¸ºå¹¶å‘putï¼Œå¯¼è‡´ç»“æœä¸å‡†ç¡®ï¼Œä½†æ˜¯ç›´æ¥é”å®šæ‰€æœ‰Segmentè¿›è¡Œè®¡ç®—ï¼Œå°±ä¼šå˜å¾—éå¸¸æ˜‚è´µã€‚å…¶å®ï¼Œåˆ†ç¦»é”ä¹Ÿé™åˆ¶äº†Mapçš„åˆå§‹åŒ–ç­‰æ“ä½œã€‚</p>\n<p>æ‰€ä»¥ï¼ŒConcurrentHashMapçš„å®ç°æ˜¯é€šè¿‡é‡è¯•æœºåˆ¶ï¼ˆRETRIES_BEFORE_LOCKï¼ŒæŒ‡å®šé‡è¯•æ¬¡æ•°2ï¼‰ï¼Œæ¥è¯•å›¾è·å¾—å¯é å€¼ã€‚å¦‚æœæ²¡æœ‰ç›‘æ§åˆ°å‘ç”Ÿå˜åŒ–ï¼ˆé€šè¿‡å¯¹æ¯”Segment.modCountï¼‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™è·å–é”è¿›è¡Œæ“ä½œã€‚</p>\n<p>ä¸‹é¢æˆ‘æ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œ<strong>åœ¨Java 8å’Œä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒConcurrentHashMapå‘ç”Ÿäº†å“ªäº›å˜åŒ–å‘¢ï¼Ÿ</strong></p>\n<ul>\n<li>\n<p>æ€»ä½“ç»“æ„ä¸Šï¼Œå®ƒçš„å†…éƒ¨å­˜å‚¨å˜å¾—å’Œæˆ‘åœ¨ä¸“æ ä¸Šä¸€è®²ä»‹ç»çš„HashMapç»“æ„éå¸¸ç›¸ä¼¼ï¼ŒåŒæ ·æ˜¯å¤§çš„æ¡¶ï¼ˆbucketï¼‰æ•°ç»„ï¼Œç„¶åå†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸ªæ‰€è°“çš„é“¾è¡¨ç»“æ„ï¼ˆbinï¼‰ï¼ŒåŒæ­¥çš„ç²’åº¦è¦æ›´ç»†è‡´ä¸€äº›ã€‚</p>\n</li>\n<li>\n<p>å…¶å†…éƒ¨ä»ç„¶æœ‰Segmentå®šä¹‰ï¼Œä½†ä»…ä»…æ˜¯ä¸ºäº†ä¿è¯åºåˆ—åŒ–æ—¶çš„å…¼å®¹æ€§è€Œå·²ï¼Œä¸å†æœ‰ä»»ä½•ç»“æ„ä¸Šçš„ç”¨å¤„ã€‚</p>\n</li>\n<li>\n<p>å› ä¸ºä¸å†ä½¿ç”¨Segmentï¼Œåˆå§‹åŒ–æ“ä½œå¤§å¤§ç®€åŒ–ï¼Œä¿®æ”¹ä¸ºlazy-loadå½¢å¼ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆé¿å…åˆå§‹å¼€é”€ï¼Œè§£å†³äº†è€ç‰ˆæœ¬å¾ˆå¤šäººæŠ±æ€¨çš„è¿™ä¸€ç‚¹ã€‚</p>\n</li>\n<li>\n<p>æ•°æ®å­˜å‚¨åˆ©ç”¨volatileæ¥ä¿è¯å¯è§æ€§ã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨CASç­‰æ“ä½œï¼Œåœ¨ç‰¹å®šåœºæ™¯è¿›è¡Œæ— é”å¹¶å‘æ“ä½œã€‚</p>\n</li>\n<li>\n<p>ä½¿ç”¨Unsafeã€LongAdderä¹‹ç±»åº•å±‚æ‰‹æ®µï¼Œè¿›è¡Œæç«¯æƒ…å†µçš„ä¼˜åŒ–ã€‚</p>\n</li>\n</ul>\n<p>å…ˆçœ‹çœ‹ç°åœ¨çš„æ•°æ®å­˜å‚¨å†…éƒ¨å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°Keyæ˜¯finalçš„ï¼Œå› ä¸ºåœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸€ä¸ªæ¡ç›®çš„Keyå‘ç”Ÿå˜åŒ–æ˜¯ä¸å¯èƒ½çš„ï¼›ä¸æ­¤åŒæ—¶valï¼Œåˆ™å£°æ˜ä¸ºvolatileï¼Œä»¥ä¿è¯å¯è§æ€§ã€‚</p>\n<pre><code> static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n        final int hash;\n        final K key;\n        volatile V val;\n        volatile Node&lt;K,V&gt; next;\n        // â€¦ \n    }\n</code></pre>\n<p>æˆ‘è¿™é‡Œå°±ä¸å†ä»‹ç»getæ–¹æ³•å’Œæ„é€ å‡½æ•°äº†ï¼Œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œç›´æ¥çœ‹å¹¶å‘çš„putæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>\n<pre><code>final V putVal(K key, V value, boolean onlyIfAbsent) { if (key == null || value == null) throw new NullPointerException();\n    int hash = spread(key.hashCode());\n    int binCount = 0;\n    for (Node&lt;K,V&gt;[] tab = table;;) {\n        Node&lt;K,V&gt; f; int n, i, fh; K fk; V fv;\n        if (tab == null || (n = tab.length) == 0)\n            tab = initTable();\n        else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) {\n            // åˆ©ç”¨CASå»è¿›è¡Œæ— é”çº¿ç¨‹å®‰å…¨æ“ä½œï¼Œå¦‚æœbinæ˜¯ç©ºçš„\n            if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value)))\n                break; \n        }\n        else if ((fh = f.hash) == MOVED)\n            tab = helpTransfer(tab, f);\n        else if (onlyIfAbsent // ä¸åŠ é”ï¼Œè¿›è¡Œæ£€æŸ¥\n                 &amp;&amp; fh == hash\n                 &amp;&amp; ((fk = f.key) == key || (fk != null &amp;&amp; key.equals(fk)))\n                 &amp;&amp; (fv = f.val) != null)\n            return fv;\n        else {\n            V oldVal = null;\n            synchronized (f) {\n                   // ç»†ç²’åº¦çš„åŒæ­¥ä¿®æ”¹æ“ä½œ... \n                }\n            }\n            // Binè¶…è¿‡é˜ˆå€¼ï¼Œè¿›è¡Œæ ‘åŒ–\n            if (binCount != 0) {\n                if (binCount &gt;= TREEIFY_THRESHOLD)\n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    addCount(1L, binCount);\n    return null;\n}\n\n</code></pre>\n<p>åˆå§‹åŒ–æ“ä½œå®ç°åœ¨initTableé‡Œé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„CASä½¿ç”¨åœºæ™¯ï¼Œåˆ©ç”¨volatileçš„sizeCtlä½œä¸ºäº’æ–¥æ‰‹æ®µï¼šå¦‚æœå‘ç°ç«äº‰æ€§çš„åˆå§‹åŒ–ï¼Œå°±spinåœ¨é‚£é‡Œï¼Œç­‰å¾…æ¡ä»¶æ¢å¤ï¼›å¦åˆ™åˆ©ç”¨CASè®¾ç½®æ’ä»–æ ‡å¿—ã€‚å¦‚æœæˆåŠŸåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼›å¦åˆ™é‡è¯•ã€‚</p>\n<p>è¯·å‚è€ƒä¸‹é¢ä»£ç ï¼š</p>\n<pre><code>private final Node&lt;K,V&gt;[] initTable() {\n    Node&lt;K,V&gt;[] tab; int sc;\n    while ((tab = table) == null || tab.length == 0) {\n        // å¦‚æœå‘ç°å†²çªï¼Œè¿›è¡Œspinç­‰å¾…\n        if ((sc = sizeCtl) &lt; 0)\n            Thread.yield(); \n        // CASæˆåŠŸè¿”å›trueï¼Œåˆ™è¿›å…¥çœŸæ­£çš„åˆå§‹åŒ–é€»è¾‘\n        else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) {\n            try {\n                if ((tab = table) == null || tab.length == 0) {\n                    int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;\n                    @SuppressWarnings(&quot;unchecked&quot;)\n                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];\n                    table = tab = nt;\n                    sc = n - (n &gt;&gt;&gt; 2);\n                }\n            } finally {\n                sizeCtl = sc;\n            }\n            break;\n        }\n    }\n    return tab;\n}\n\n</code></pre>\n<p>å½“binä¸ºç©ºæ—¶ï¼ŒåŒæ ·æ˜¯æ²¡æœ‰å¿…è¦é”å®šï¼Œä¹Ÿæ˜¯ä»¥CASæ“ä½œå»æ”¾ç½®ã€‚</p>\n<p>ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œåœ¨åŒæ­¥é€»è¾‘ä¸Šï¼Œå®ƒä½¿ç”¨çš„æ˜¯synchronizedï¼Œè€Œä¸æ˜¯é€šå¸¸å»ºè®®çš„ReentrantLockä¹‹ç±»ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç°ä»£JDKä¸­ï¼Œsynchronizedå·²ç»è¢«ä¸æ–­ä¼˜åŒ–ï¼Œå¯ä»¥ä¸å†è¿‡åˆ†æ‹…å¿ƒæ€§èƒ½å·®å¼‚ï¼Œå¦å¤–ï¼Œç›¸æ¯”äºReentrantLockï¼Œå®ƒå¯ä»¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ã€‚</p>\n<p>ä¸æ­¤åŒæ—¶ï¼Œæ›´å¤šç»†èŠ‚å®ç°é€šè¿‡ä½¿ç”¨Unsafeè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚tabAtå°±æ˜¯ç›´æ¥åˆ©ç”¨getObjectAcquireï¼Œé¿å…é—´æ¥è°ƒç”¨çš„å¼€é”€ã€‚</p>\n<pre><code>static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {\n    return (Node&lt;K,V&gt;)U.getObjectAcquire(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);\n}\n\n</code></pre>\n<p>å†çœ‹çœ‹ï¼Œç°åœ¨æ˜¯å¦‚ä½•å®ç°sizeæ“ä½œçš„ã€‚<a href=\"http://hg.openjdk.java.net/jdk/jdk/file/12fc7bf488ec/src/java.base/share/classes/java/util/concurrent/ConcurrentHashMap.java\">é˜…è¯»ä»£ç </a>ä½ ä¼šå‘ç°ï¼ŒçœŸæ­£çš„é€»è¾‘æ˜¯åœ¨sumCountæ–¹æ³•ä¸­ï¼Œ é‚£ä¹ˆsumCountåšäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<pre><code>final long sumCount() {\n    CounterCell[] as = counterCells; CounterCell a;\n    long sum = baseCount;\n    if (as != null) {\n        for (int i = 0; i &lt; as.length; ++i) {\n            if ((a = as[i]) != null)\n                sum += a.value;\n        }\n    }\n    return sum;\n}\n\n</code></pre>\n<p>æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶æ€è·¯ä»ç„¶å’Œä»¥å‰ç±»ä¼¼ï¼Œéƒ½æ˜¯åˆ†è€Œæ²»ä¹‹çš„è¿›è¡Œè®¡æ•°ï¼Œç„¶åæ±‚å’Œå¤„ç†ï¼Œä½†å®ç°å´åŸºäºä¸€ä¸ªå¥‡æ€ªçš„CounterCellã€‚ éš¾é“å®ƒçš„æ•°å€¼ï¼Œå°±æ›´åŠ å‡†ç¡®å—ï¼Ÿæ•°æ®ä¸€è‡´æ€§æ˜¯æ€ä¹ˆä¿è¯çš„ï¼Ÿ</p>\n<pre><code>static final class CounterCell {\n    volatile long value;\n    CounterCell(long x) { value = x; }\n}\n</code></pre>\n<p>å…¶å®ï¼Œå¯¹äºCounterCellçš„æ“ä½œï¼Œæ˜¯åŸºäºjava.util.concurrent.atomic.LongAdderè¿›è¡Œçš„ï¼Œæ˜¯ä¸€ç§JVMåˆ©ç”¨ç©ºé—´æ¢å–æ›´é«˜æ•ˆç‡çš„æ–¹æ³•ï¼Œåˆ©ç”¨äº†<a href=\"http://hg.openjdk.java.net/jdk/jdk/file/12fc7bf488ec/src/java.base/share/classes/java/util/concurrent/atomic/Striped64.java\">Striped64</a>å†…éƒ¨çš„å¤æ‚é€»è¾‘ã€‚è¿™ä¸ªä¸œè¥¿éå¸¸å°ä¼—ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨AtomicLongï¼Œè¶³ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†åº”ç”¨çš„æ€§èƒ½éœ€æ±‚ã€‚</p>\n<p>ä»Šå¤©æˆ‘ä»çº¿ç¨‹å®‰å…¨é—®é¢˜å¼€å§‹ï¼Œæ¦‚å¿µæ€§çš„æ€»ç»“äº†åŸºæœ¬å®¹å™¨å·¥å…·ï¼Œåˆ†æäº†æ—©æœŸåŒæ­¥å®¹å™¨çš„é—®é¢˜ï¼Œè¿›è€Œåˆ†æäº†Java  7å’ŒJava  8ä¸­ConcurrentHashMapæ˜¯å¦‚ä½•è®¾è®¡å®ç°çš„ï¼Œå¸Œæœ›ConcurrentHashMapçš„å¹¶å‘æŠ€å·§å¯¹ä½ åœ¨æ—¥å¸¸å¼€å‘å¯ä»¥æœ‰æ‰€å¸®åŠ©ã€‚</p>\n<h2>ä¸€è¯¾ä¸€ç»ƒ</h2>\n<p>å…³äºä»Šå¤©æˆ‘ä»¬è®¨è®ºçš„é¢˜ç›®ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°äº†å—ï¼Ÿç•™ä¸€ä¸ªé“æ€è€ƒé¢˜ç»™ä½ ï¼Œåœ¨äº§å“ä»£ç ä¸­ï¼Œæœ‰æ²¡æœ‰å…¸å‹çš„åœºæ™¯éœ€è¦ä½¿ç”¨ç±»ä¼¼ConcurrentHashMapè¿™æ ·çš„å¹¶å‘å®¹å™¨å‘¢ï¼Ÿ</p>\n<p>è¯·ä½ åœ¨ç•™è¨€åŒºå†™å†™ä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘ä¼šé€‰å‡ºç»è¿‡è®¤çœŸæ€è€ƒçš„ç•™è¨€ï¼Œé€ç»™ä½ ä¸€ä»½å­¦ä¹ é¼“åŠ±é‡‘ï¼Œæ¬¢è¿ä½ ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p>\n<p>ä½ çš„æœ‹å‹æ˜¯ä¸æ˜¯ä¹Ÿåœ¨å‡†å¤‡é¢è¯•å‘¢ï¼Ÿä½ å¯ä»¥â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„é¢˜ç›®åˆ†äº«ç»™å¥½å‹ï¼Œæˆ–è®¸ä½ èƒ½å¸®åˆ°ä»–ã€‚</p>\n","comments":[{"had_liked":false,"id":14843,"user_name":"è”¡å…‰æ˜","can_delete":false,"product_type":"c1","uid":1158477,"ip_address":"","ucode":"7EACC0555B4F19","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/4d/e24fc9e4.jpg","comment_is_top":false,"comment_ctime":1530692866,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"851934217474","product_id":100006701,"comment_content":"1.7<br>putåŠ é”<br>é€šè¿‡åˆ†æ®µåŠ é”segmentï¼Œä¸€ä¸ªhashmapé‡Œæœ‰è‹¥å¹²ä¸ªsegmentï¼Œæ¯ä¸ªsegmenté‡Œæœ‰è‹¥å¹²ä¸ªæ¡¶ï¼Œæ¡¶é‡Œå­˜æ”¾K-Vå½¢å¼çš„é“¾è¡¨ï¼Œputæ•°æ®æ—¶é€šè¿‡keyå“ˆå¸Œå¾—åˆ°è¯¥å…ƒç´ è¦æ·»åŠ åˆ°çš„segmentï¼Œç„¶åå¯¹segmentè¿›è¡ŒåŠ é”ï¼Œç„¶ååœ¨å“ˆå¸Œï¼Œè®¡ç®—å¾—åˆ°ç»™å…ƒç´ è¦æ·»åŠ åˆ°çš„æ¡¶ï¼Œç„¶åéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œæ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­<br><br>size<br>åˆ†æ®µè®¡ç®—ä¸¤æ¬¡ï¼Œä¸¤æ¬¡ç»“æœç›¸åŒåˆ™è¿”å›ï¼Œå¦åˆ™å¯¹æ‰€ä»¥æ®µåŠ é”é‡æ–°è®¡ç®—<br><br><br>1.8<br>put CAS åŠ é”<br>1.8ä¸­ä¸ä¾èµ–ä¸segmentåŠ é”ï¼Œsegmentæ•°é‡ä¸æ¡¶æ•°é‡ä¸€è‡´ï¼›<br>é¦–å…ˆåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–åˆ©ç”¨volatileçš„sizeCtlä½œä¸ºäº’æ–¥æ‰‹æ®µï¼Œå¦‚æœå‘ç°ç«äº‰æ€§çš„åˆå§‹åŒ–ï¼Œå°±æš‚åœåœ¨é‚£é‡Œï¼Œç­‰å¾…æ¡ä»¶æ¢å¤ï¼Œå¦åˆ™åˆ©ç”¨CASè®¾ç½®æ’ä»–æ ‡å¿—ï¼ˆU.compareAndSwapInt(this, SIZECTL, sc, -1)ï¼‰;å¦åˆ™é‡è¯•<br>å¯¹key hashè®¡ç®—å¾—åˆ°è¯¥keyå­˜æ”¾çš„æ¡¶ä½ç½®ï¼Œåˆ¤æ–­è¯¥æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ©ç”¨CASè®¾ç½®æ–°èŠ‚ç‚¹<br>å¦åˆ™ä½¿ç”¨synchronizeåŠ é”ï¼Œéå†æ¡¶ä¸­æ•°æ®ï¼Œæ›¿æ¢æˆ–æ–°å¢åŠ ç‚¹åˆ°æ¡¶ä¸­<br>æœ€ååˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè½¬æ¢ä¹‹å‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹<br><br>size<br>åˆ©ç”¨LongAddç´¯åŠ è®¡ç®—","like_count":199,"discussions":[{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304604,"discussion_content":"å†æŒ‡å‡ºä¸€ç‚¹ï¼Œä¸æ˜¯ &#34;åˆ©ç”¨LongAddç´¯åŠ è®¡ç®—&#34;ï¼ˆÃ—ï¼‰è€Œæ˜¯åˆ©ç”¨å¡«å……åˆ†å¸ƒçš„cellï¼Œé€»è¾‘æ”¹ç¼–è‡ªLongAdderå’ŒStriped64è¾¾åˆ°åŸå­æ“ä½œç´¯åŠ è®¡ç®—å¤§å°ï¼Œè€Œä¸”Putæ“ä½œæ˜¯å»ºç«‹åœ¨åä½œæ‰©å®¹çš„åŸºç¡€ä¸Šæ¥è§£å†³å†²çªçš„ï¼ŒåŠ¨æ€çš„ä¿®æ”¹äº†å¤§å°æ–¹ä¾¿ç´¯åŠ è®¡ç®—","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1599624309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1178888,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg","nickname":"å°é³„é±¼","note":"","ucode":"9C30CAFB41A263","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588495,"discussion_content":"æˆ‘è¯´è€å¸ˆè´´å‡ºæ¥çš„ä»£ç ä¹Ÿæ²¡çœ‹åˆ°LongAdderçš„ç—•è¿¹å•Šï¼Œå’‹è¯´ä½¿ç”¨äº†å‘¢ï¼Ÿåªæ˜¯é€»è¾‘ä¸Šè¿™æ ·å®ç°äº†è€Œå·²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663806669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304604,"ip_address":"å¹¿ä¸œ"},"score":588495,"extra":""}]},{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37018,"discussion_content":"è¯­åºæœ‰ç‚¹ä¹±æˆ‘æ”¹äº†æ”¹ä¸çŸ¥é“å¯¹ä¸å¯¹:\né¦–å…ˆåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼ŒinitTable()åˆ©ç”¨volatileçš„sizeCtlä½œä¸ºäº’æ–¥æ‰‹æ®µ;å¦‚æœå‘ç°ç«äº‰æ€§çš„åˆå§‹åŒ–ï¼Œå°±yieldåœ¨é‚£é‡Œï¼Œç­‰å¾…æ¡ä»¶æ¢å¤;\nå¦åˆ™åˆå§‹åŒ–æ—¶åˆ©ç”¨CASè®¾ç½®æ’ä»–æ ‡å¿—sizeCtlï¼ˆU.compareAndSwapInt(this, SIZECTL, sc, -1)ï¼‰;\nå¦åˆ™é‡è¯•åˆå§‹åŒ–ï¼›\nå¦‚æœå®¹å™¨æ˜¯ä¸ä¸ºç©ºä½†çš„ bin æ˜¯ç©ºçš„ï¼Œåˆ©åˆ™ç”¨ CAS å»è¿›è¡Œæ— é”çº¿ç¨‹å®‰å…¨æ“ä½œï¼šå¯¹key hashè®¡ç®—å¾—åˆ°è¯¥keyå­˜æ”¾çš„æ¡¶ä½ç½®ï¼Œåˆ¤æ–­è¯¥æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ©ç”¨CASè®¾ç½®æ–°èŠ‚ç‚¹ï¼›\nå¦åˆ™ä½¿ç”¨synchronizeåŠ é”ï¼Œéå†æ¡¶ä¸­æ•°æ®ï¼Œæ›¿æ¢æˆ–æ–°å¢åŠ ç‚¹åˆ°æ¡¶ä¸­\næœ€ååˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè½¬æ¢ä¹‹å‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1571482277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970536,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/11/68/ac0d2b05.jpg","nickname":"æŸ¯ä¼Ÿ","note":"","ucode":"92BFAA8B85E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388590,"discussion_content":"java8åŠä¹‹åç‰ˆæœ¬ï¼šConcurrentHashMapï¼Œåœ¨putæ•°æ®æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ©ç”¨CASè¿›è¡Œåˆå§‹åŒ–ã€‚ä¸ä¸ºç©ºåˆ™åˆ¤æ–­å­˜æ”¾çš„æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ©ç”¨CASè®¾ç½®æ–°èŠ‚ç‚¹ã€‚ä¸ä¸ºç©ºåˆ™ä½¿ç”¨Synchronizedå¯¹è¯¥æ¡¶åŠ é”ï¼Œéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼ˆæˆ–æ ‘ï¼‰ï¼Œæ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1628843142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115909,"avatar":"https://static001.geekbang.org/account/avatar/00/11/07/05/0e59855d.jpg","nickname":"æ„¤æ€’çš„å°é¾™æ‰“å°é¸Ÿ","note":"","ucode":"363AF21A33CD2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240959,"discussion_content":"Segmentsçš„å¤§å°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸å˜äº†å—ï¼Ÿé»˜è®¤åˆå§‹åŒ–å¤§å°æ˜¯16å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587391964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1747918,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/ab/ce/a4d03c2c.jpg","nickname":"å¼ å¾·é›·","note":"","ucode":"788BEC93FB7971","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":180046,"discussion_content":"æ¸…æ™°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582273238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2744868,"avatar":"","nickname":"éº»èŠ±","note":"","ucode":"FCCD929A8B47DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1747918,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/ab/ce/a4d03c2c.jpg","nickname":"å¼ å¾·é›·","note":"","ucode":"788BEC93FB7971","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391998,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630755418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":180046,"ip_address":""},"score":391998,"extra":""}]}]},{"had_liked":false,"id":10164,"user_name":"å¾é‡‘é“","can_delete":false,"product_type":"c1","uid":1080462,"ip_address":"","ucode":"E13FD19FD27869","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/8e/73581062.jpg","comment_is_top":false,"comment_ctime":1527319286,"is_pvip":false,"replies":[{"id":"3222","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":10164,"uid":"1009360","ip_address":"","utype":1,"ctime":1527468754,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":6,"race_medal":0,"score":"473973721846","product_id":100006701,"comment_content":"éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ1.8ä»¥åçš„é”çš„é¢—ç²’åº¦ï¼Œæ˜¯åŠ åœ¨é“¾è¡¨å¤´ä¸Šçš„ï¼Œè¿™ä¸ªæ˜¯ä¸ªæ€è·¯ä¸Šçš„çªç ´ã€‚","like_count":111,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418369,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527468754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182516,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","nickname":"ç‹ç››æ­¦","note":"","ucode":"DE7EF246D3DCE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47207,"discussion_content":"ä¸æ˜¯å¤´ä¸Š, æ˜¯æ¯ä¸€ä¸ªNode, ä¸æ˜¯é“¾è¡¨çš„ç¬¬1ä¸ªNode","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573293886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1241770,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","nickname":"å¤±ç«çš„å¤å¤©","note":"","ucode":"10C6E66EB2A65F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1182516,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","nickname":"ç‹ç››æ­¦","note":"","ucode":"DE7EF246D3DCE8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":129344,"discussion_content":"ä½ å…¥å£å°±åªæœ‰å¤´éƒ¨çš„node.ï¼Œé”ä½å…¥å£å°±å¯ä»¥äº†ï¼Œåé¢æ ¹æœ¬å°±æ²¡åŠ é”ï¼Œæˆ‘æ€€ç–‘ä½ å°±æ²¡çœ‹æºç ","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1578674562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":47207,"ip_address":""},"score":129344,"extra":""}]},{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37024,"discussion_content":"è¯·é—®ï¼Œè¿™&#34;åŠ åœ¨é“¾è¡¨å¤´ä¸Šçš„  é”çš„é¢—ç²’åº¦&#34;æ˜¯æ€ä¹ˆçœ‹å‡ºæ¥çš„ï¼Ÿï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571483091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1241770,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","nickname":"å¤±ç«çš„å¤å¤©","note":"","ucode":"10C6E66EB2A65F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":129346,"discussion_content":"jdkæºä»£ç ï¼Œè¿›å»å°±èƒ½çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578675066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":37024,"ip_address":""},"score":129346,"extra":""},{"author":{"id":1306394,"avatar":"","nickname":"Aiome","note":"","ucode":"5D3A810C0FF56B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310425,"discussion_content":"putValéƒ¨åˆ†ä»£ç \nfor (Node<K,V>[] tab = table;;) {\n    Node<K,V> f; int n, i, fh;\n    // çœç•¥ä¸€éƒ¨åˆ†ä»£ç \n    // æ­¤æ—¶fæ˜¯tabæ¡¶ä¸­çš„nodeä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ \n    f = tabAt(tab, i = (n - 1) &amp; hash));\n    // çœç•¥ä¸€éƒ¨åˆ†ä»£ç \n    // å¯¹fåŠ é”ï¼Œæ‰€ä»¥åç»­çº¿ç¨‹å¯¹è¿™ä¸ªæ¡¶çš„æ‰€æœ‰nodeä¿®æ”¹éƒ½éœ€è¦ç­‰å¾…\n    synchronized (f) {\n    }\n}","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1601824000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":37024,"ip_address":""},"score":310425,"extra":""}]}]},{"had_liked":false,"id":10303,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":1068651,"ip_address":"","ucode":"E482059A067C84","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/6b/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1527468321,"is_pvip":false,"replies":[{"id":"3244","content":"æ­£ç¡®ï¼Œäº’ç›¸äº¤æµ<br>åå‘é”ï¼Œä¾§é‡æ˜¯ä½ç«äº‰åœºæ™¯çš„ä¼˜åŒ–ï¼Œå»æ‰å¯èƒ½ä¸å¿…è¦çš„åŒæ­¥","user_name":"ä½œè€…å›å¤","comment_id":10303,"uid":"1009360","ip_address":"","utype":1,"ctime":1527482275,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"220570800417","product_id":100006701,"comment_content":"æœ€è¿‘ç”¨ConcurrentHashMapçš„åœºæ™¯æ˜¯ï¼Œç”±äºç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¬å…±æœåŠ¡ï¼Œå…¨ç¨‹å¼‚æ­¥å¤„ç†ã€‚æœ€åä¸€ç¯èŠ‚éœ€è¦http restä¸»åŠ¨å“åº”æ¥å…¥ç³»ç»Ÿï¼Œäºæ˜¯ä¸ºäº†å®šåˆ¶åŒ–éœ€æ±‚ï¼Œåˆ©ç”¨nettyå†™äº†ä¸€ç‰ˆå¼‚æ­¥http clinetã€‚å…¶åœ¨ç¼“å­˜tcpé“¾æ¥æ—¶ç”¨åˆ°äº†ã€‚<br>çœ‹åˆ°ä¸‹é¢æœ‰ä¸€ä½æœ‹å‹è¯´èµ·äº†è‡ªæ—‹é”å’Œåå‘é”ã€‚<br>è‡ªæ—‹é”ä¸ªäººç†è§£çš„æ˜¯casçš„ä¸€ç§åº”ç”¨æ–¹å¼ã€‚å¹¶å‘åŒ…ä¸­çš„åŸå­ç±»æ˜¯å…¸å‹çš„åº”ç”¨ã€‚<br>åå‘é”ä¸ªäººç†è§£çš„æ˜¯è·å–é”çš„ä¼˜åŒ–ã€‚åœ¨ReentrantLockä¸­ç”¨äºå®ç°å·²è·å–å®Œé”çš„çš„çº¿ç¨‹é‡å…¥é—®é¢˜ã€‚<br>ä¸çŸ¥é“ç†è§£çš„æ˜¯å¦æœ‰è¯¯å·®ã€‚æ¬¢è¿æŒ‡æ­£æ¢è®¨ã€‚è°¢è°¢","like_count":52,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418431,"discussion_content":"æ­£ç¡®ï¼Œäº’ç›¸äº¤æµ\nåå‘é”ï¼Œä¾§é‡æ˜¯ä½ç«äº‰åœºæ™¯çš„ä¼˜åŒ–ï¼Œå»æ‰å¯èƒ½ä¸å¿…è¦çš„åŒæ­¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1527482275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14753,"user_name":"t","can_delete":false,"product_type":"c1","uid":1153833,"ip_address":"","ucode":"84FA886A94B603","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/29/c50118cf.jpg","comment_is_top":false,"comment_ctime":1530631978,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"181919258410","product_id":100006701,"comment_content":"å¯¹äºæˆ‘è¿™ç§èœé¸Ÿæ¥è¯´ï¼Œåº”è¯¥æ¥ä¸€æœŸè®²è®²volatileğŸ˜­","like_count":43,"discussions":[{"author":{"id":1437425,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ee/f1/16545faf.jpg","nickname":"å­¦ä¹ ","note":"","ucode":"CDFB71E0D1508B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395379,"discussion_content":"éš”å£çš„Javaå¹¶å‘ç¼–ç¨‹å†™çš„å¾ˆå¥½å•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632296684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"ä¸‹ä¸ªç›®æ ‡45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336544,"discussion_content":"è¿™ç©æ„æ˜¯çœŸçš„å¾ˆéš¾ç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608623241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10128,"user_name":"j.c.","can_delete":false,"product_type":"c1","uid":1004961,"ip_address":"","ucode":"909571207BAA63","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/a1/ed52e319.jpg","comment_is_top":false,"comment_ctime":1527304137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"147556192201","product_id":100006701,"comment_content":"æœŸå¾…unsafeå’Œcasçš„æ–‡ç« ","like_count":33},{"had_liked":false,"id":10102,"user_name":"é›·éœ¹é›³çš„çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1119490,"ip_address":"","ucode":"99BBA6D83DD11F","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg","comment_is_top":false,"comment_ctime":1527296155,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"130376315035","product_id":100006701,"comment_content":"ä»Šå¤©è¿™ä¸ªçº¯ç²¹çŸ¥è¯†ç›²ç‚¹ï¼Œçº¯èµï¼Œæºç ä¹Ÿå¾—ä¸åœçœ‹","like_count":30},{"had_liked":false,"id":10244,"user_name":"è™é£","can_delete":false,"product_type":"c1","uid":1053075,"ip_address":"","ucode":"601B864214C4F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/93/8b41390b.jpg","comment_is_top":false,"comment_ctime":1527410325,"is_pvip":true,"replies":[{"id":"3238","content":"ç›®å‰å¹¶å‘listå¥½åƒå°±é‚£ä¸€ä¸ªï¼Œæˆ‘è§‰å¾—ä¸å¿…æ‹˜æ³¥äºlistï¼Œä¸è¿˜æœ‰queueä¹‹ç±»ï¼Œçœ‹åœºæ™¯éœ€è¦çš„çœŸæ˜¯listå—","user_name":"ä½œè€…å›å¤","comment_id":10244,"uid":"1009360","ip_address":"","utype":1,"ctime":1527480805,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"83131788949","product_id":100006701,"comment_content":"è€å¸ˆåœ¨è¯¾ç¨‹é‡Œè®²åˆ°åŒæ­¥åŒ…è£…ç±»æ¯”è¾ƒä½æ•ˆï¼Œä¸å¤ªé€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ï¼Œé‚£æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œåœ¨listæ¥å£çš„å®ç°ç±»ä¸­ã€‚åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œé€‰æ‹©å“ªç§å®ç°ç±»æ¯”è¾ƒå¥½ï¼Ÿå› ä¸ºArrayListæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒåŒæ­¥åŒ…è£…ç±»åˆå¾ˆä½æ•ˆï¼ŒCopyonwriteArrayListåˆæ˜¯ä»¥å¿«ç…§çš„å½¢å¼æ¥å®ç°çš„ï¼Œåœ¨é¢‘ç¹å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå¾ˆä½æ•ˆï¼Œé‚£è¿™ä¸ªç±»å‹è¯¥æ€ä¹ˆé€‰æ‹©æ¯”è¾ƒå¥½ï¼Ÿ","like_count":19,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418409,"discussion_content":"ç›®å‰å¹¶å‘listå¥½åƒå°±é‚£ä¸€ä¸ªï¼Œæˆ‘è§‰å¾—ä¸å¿…æ‹˜æ³¥äºlistï¼Œä¸è¿˜æœ‰queueä¹‹ç±»ï¼Œçœ‹åœºæ™¯éœ€è¦çš„çœŸæ˜¯listå—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527480805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10380,"user_name":"Kyle","can_delete":false,"product_type":"c1","uid":1106079,"ip_address":"","ucode":"44198A0BEC5FB2","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/9f/9259a6b9.jpg","comment_is_top":false,"comment_ctime":1527514837,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"48772155093","product_id":100006701,"comment_content":"ä¹‹å‰ç”¨JavaFXåšä¸€ä¸ªå®¢æˆ·ç«¯IMå·¥å…·çš„æ—¶å€™ï¼Œæˆ‘å°†æ‹‰æ¥çš„æœªè¢«è¯»å–çš„ç”¨æˆ·èŠå¤©ä¿¡æ¯ç”¨ConcurrentHashMapå­˜å‚¨ï¼ˆåŒæ—¶å¼‚æ­¥å­˜å‚¨åˆ°Sqliteï¼‰ï¼ŒKeyå­˜æ”¾ç”¨æˆ·idï¼ŒValueæ”¾æœªè¯»å–çš„èŠå¤©æ¶ˆæ¯åˆ—è¡¨ã€‚å› ä¸ºæˆ‘è€ƒè™‘åˆ°å­˜æ¶ˆæ¯å’Œè¯»æ¶ˆæ¯æ˜¯ç”±ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘å¤„ç†çš„ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å…±åŒæ“ä½œä¸€ä¸ªConcurrentHashMapã€‚å¯èƒ½æ˜¯æˆ‘æ²¡å¤„ç†å¥½ï¼Œæœ€åç›´åˆ°æˆ‘ç¦»èŒäº†è¿˜æœ‰æ¶ˆæ¯é‡å¤ã€ä¹±åºçš„é—®é¢˜ã€‚è¯·é—®æˆ‘è¿™ç§åº”ç”¨åœºæ™¯æœ‰ä»€ä¹ˆé—®é¢˜å—?","like_count":10,"discussions":[{"author":{"id":1466335,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5f/df/3c4881f0.jpg","nickname":"Geek","note":"","ucode":"1B8EB2C26DE4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269545,"discussion_content":"ä¸ªäººæ„šè§ï¼Œä½ çš„valueæ”¾ç½®çš„æ˜¯ä¸€ä¸ªlistï¼Œè¿™ä¸ªliståˆæ˜¯å¦ç”¨çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Ÿç”¨ä¹‹å‰æ˜¯å¦æå‰æ ¡éªŒäº†é‡å¤æ€§ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589905435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1510177,"avatar":"https://static001.geekbang.org/account/avatar/00/17/0b/21/f1aea35b.jpg","nickname":"let_me_go","note":"","ucode":"A5936F5C5E3D65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361265,"discussion_content":"ä¸ªäººæ„šè§ï¼šConcurrentHashMapå­˜å‚¨çš„k-væ˜¯æ²¡æœ‰é¡ºåºçš„,éå†çš„æ—¶å€™ä¼šå‘ç°å¾—åˆ°çš„é¡ºåºå¹¶ä¸æ˜¯å­˜å…¥çš„é¡ºåºã€‚ConcurrentLinkedHashMapçš„k-væ˜¯æœ‰åºçš„,æ˜¯æŒ‰ç…§å­˜å…¥çš„å…ˆåé¡ºåºè¿›è¡Œå­˜å‚¨çš„,éå†å¾—åˆ°çš„é¡ºåºå°±æ˜¯å­˜å‚¨çš„é¡ºåº,æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸æ˜¯åº”è¯¥ç”¨ConcurrentLinkedHashMapæ¥ä¿è¯é¡ºåºã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616634619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1184256,"avatar":"https://static001.geekbang.org/account/avatar/00/12/12/00/9917dd6c.jpg","nickname":"Duncan","note":"","ucode":"C1CA624885FFC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1510177,"avatar":"https://static001.geekbang.org/account/avatar/00/17/0b/21/f1aea35b.jpg","nickname":"let_me_go","note":"","ucode":"A5936F5C5E3D65","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551193,"discussion_content":"ä¸ªäººæ„šè§ï¼Œæ¶ˆæ¯çš„é¡ºåºä¸åº”è¯¥æŒ‰ç…§å†™å…¥çš„é¡ºåºæ’åºï¼Œåº”è¯¥æ˜¯ç”¨æ¶ˆæ¯æœ¬èº«çš„æ—¶é—´æ’åºï¼Œå› ä¸ºåå‘çš„æ¶ˆæ¯å¯èƒ½å…ˆåˆ°ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1644922020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361265,"ip_address":""},"score":551193,"extra":""}]}]},{"had_liked":false,"id":10283,"user_name":"coderç‹","can_delete":false,"product_type":"c1","uid":1121990,"ip_address":"","ucode":"21465DC3850BCB","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/c6/6f817e6e.jpg","comment_is_top":false,"comment_ctime":1527437795,"is_pvip":false,"replies":[{"id":"3236","content":"é€šå¸¸æ˜¯çš„ï¼Œå‰ææ˜¯JDKç‰ˆæœ¬éœ€è¦æ–°ä¸€ç‚¹","user_name":"ä½œè€…å›å¤","comment_id":10283,"uid":"1009360","ip_address":"","utype":1,"ctime":1527480408,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":3,"race_medal":0,"score":"44477110755","product_id":100006701,"comment_content":"æ‚¨è¯´çš„synchronizedè¢«æ”¹è¿›å¾ˆå¤šå¾ˆå¤šäº†ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨ä¸­ï¼Œå°±ç”¨è¿™ä¸ªsynchronizedå®Œæˆä¸€äº›åŒæ­¥æ“ä½œæ˜¯ä¸æ˜¯OKï¼ŸğŸ˜","like_count":10,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418422,"discussion_content":"é€šå¸¸æ˜¯çš„ï¼Œå‰ææ˜¯JDKç‰ˆæœ¬éœ€è¦æ–°ä¸€ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527480408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1605637,"avatar":"https://static001.geekbang.org/account/avatar/00/18/80/05/5e80a2b4.jpg","nickname":"ç¬¬äºŒæ¬¡","note":"","ucode":"E0E5F3209D4378","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13496,"discussion_content":"å¤šå°‘ç‰ˆæœ¬ï¼Ÿ1.8å¯ä»¥äº†å˜›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568680647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2601059,"avatar":"","nickname":"Geek_6f20b8","note":"","ucode":"0D93F9AAF1EAA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1605637,"avatar":"https://static001.geekbang.org/account/avatar/00/18/80/05/5e80a2b4.jpg","nickname":"ç¬¬äºŒæ¬¡","note":"","ucode":"E0E5F3209D4378","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371171,"discussion_content":"å¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619675943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":13496,"ip_address":""},"score":371171,"extra":""}]}]},{"had_liked":false,"id":10500,"user_name":"Leiy","can_delete":false,"product_type":"c1","uid":1009001,"ip_address":"","ucode":"BE812F95D6089E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/69/efb57b83.jpg","comment_is_top":false,"comment_ctime":1527564636,"is_pvip":true,"replies":[{"id":"3354","content":"åŸºæœ¬æ­£ç¡®ï¼Œcasåªç”¨åœ¨éƒ¨åˆ†åœºæ™¯ï¼›<br>äº‹åçœ‹å®¹æ˜“å•Šï¼Œè¯´æ¯”åšå®¹æ˜“ï¼ŒğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":10500,"uid":"1009360","ip_address":"","utype":1,"ctime":1527607302,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"40182270300","product_id":100006701,"comment_content":"æˆ‘æ„Ÿè§‰jdk8å°±ç›¸å½“äºæŠŠsegmentåˆ†æ®µé”æ›´ç»†ç²’åº¦äº†ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å°±æ˜¯åŸæ¥ä¸€ä¸ªsegmentï¼Œé‚£å¹¶å‘åº¦å°±ç”±åŸæ¥segmentæ•°å˜ä¸ºæ•°ç»„é•¿åº¦ï¼Ÿè€Œä¸”ç”¨åˆ°äº†casä¹è§‚é”ï¼Œæ‰€ä»¥èƒ½æ”¯æŒæ›´é«˜çš„å¹¶å‘ï¼Œä¸çŸ¥é“æˆ‘è¿™ç§ç†è§£å¯¹å—ï¼Ÿå¦‚æœå¯¹çš„è¯ï¼Œæˆ‘å°±åœ¨æƒ³ï¼Œä¸ºä»€ä¹ˆå¹¶å‘å¤§ç¥ä¹‹å‰æ²¡æƒ³åˆ°è¿™ç§ï¼Œå“ˆå“ˆğŸ˜„ï¼Œæ³è¯·æŒ‡æ­£ã€‚è°¢è°¢","like_count":10,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418505,"discussion_content":"åŸºæœ¬æ­£ç¡®ï¼Œcasåªç”¨åœ¨éƒ¨åˆ†åœºæ™¯ï¼›\näº‹åçœ‹å®¹æ˜“å•Šï¼Œè¯´æ¯”åšå®¹æ˜“ï¼ŒğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527607302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10086,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1527291733,"is_pvip":false,"replies":[{"id":"3242","content":"æœ¬æ–‡å°½é‡æ¢³ç†äº†ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ç†è§£çš„éƒ¨åˆ†ï¼›æ‰©å®¹ç»†èŠ‚æˆ‘è§‰å¾—æ˜¯ä¸ªåŠ åˆ†é¡¹ï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šåœ¨ä¹é‚£ä¹ˆæ·±å…¥ï¼›çªé—¨ï¼Œå¯ä»¥è€ƒè™‘ç”»å›¾è¾…åŠ©ç†è§£ï¼Œæˆ‘æ˜¯æ¯”è¾ƒç¬¨çš„ç±»å‹ï¼Œé™¤äº†æ­»ç£•ï¼Œä¸ä¼šå¤ªå¤šçªé—¨â€¦â€¦","user_name":"ä½œè€…å›å¤","comment_id":10086,"uid":"1009360","ip_address":"","utype":1,"ctime":1527481258,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"35887030101","product_id":100006701,"comment_content":"è¿™æœŸå†…å®¹å¤ªéš¾ï¼Œåˆ†å¯¸ä¸å¥½æŠŠæ¡<br>çœ‹8çš„concurenthashmapæºç æ„Ÿè§‰æŒºå›°éš¾ï¼Œç½‘ä¸Šçš„åšæ–‡å¸®åŠ©ä¹Ÿä¸å¤§ï¼Œå°¤å…¶æ˜¯æ‰©å®¹è¿™éƒ¨åˆ†ï¼ˆä¼¼ä¹æ–‡ç« ä¸­æ²¡æï¼‰<br>æ±‚é—®æ¨å¤§æœ‰æ²¡æœ‰ä»€ä¹ˆçªé—¨ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆå¯å‘æ€§çš„paperæˆ–æ–‡ç« ï¼Ÿ<br>å¯ä»¥æ³›åŒ–æˆï¼Œé•¿æœŸå¯¹lock freeå®ç°å¤šä¸ªçŠ¶æ€ä¿®æ”¹çš„é—®é¢˜æ¯”è¾ƒå›°æƒ‘ï¼Œå¸Œæœ›å¾—åˆ°å¯å‘","like_count":8,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418338,"discussion_content":"æœ¬æ–‡å°½é‡æ¢³ç†äº†ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ç†è§£çš„éƒ¨åˆ†ï¼›æ‰©å®¹ç»†èŠ‚æˆ‘è§‰å¾—æ˜¯ä¸ªåŠ åˆ†é¡¹ï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½ä¼šåœ¨ä¹é‚£ä¹ˆæ·±å…¥ï¼›çªé—¨ï¼Œå¯ä»¥è€ƒè™‘ç”»å›¾è¾…åŠ©ç†è§£ï¼Œæˆ‘æ˜¯æ¯”è¾ƒç¬¨çš„ç±»å‹ï¼Œé™¤äº†æ­»ç£•ï¼Œä¸ä¼šå¤ªå¤šçªé—¨â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527481258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14602,"user_name":"Answer","can_delete":false,"product_type":"c1","uid":1159719,"ip_address":"","ucode":"DA68AD6407843C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b2/27/08644c40.jpg","comment_is_top":false,"comment_ctime":1530572820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23005409300","product_id":100006701,"comment_content":"Unsafeï¼Ÿ","like_count":5},{"had_liked":false,"id":14524,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1010221,"ip_address":"","ucode":"8F6A8C7920996E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/2d/ec4ed8ce.jpg","comment_is_top":false,"comment_ctime":1530508880,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23005345360","product_id":100006701,"comment_content":"è€å¸ˆï¼Œä»€ä¹ˆåªæœ‰binä¸ºç©ºçš„æ—¶å€™æ‰ä½¿ç”¨casï¼Œå…¶ä»–åœ°æ–¹ç”¨synchronized å‘¢ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1747184,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/a8/f0/529f15e9.jpg","nickname":"ç¬¬å››å•å…ƒ","note":"","ucode":"3ED9D553E1DE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388311,"discussion_content":"æˆ‘ç†è§£æ˜¯å› ä¸ºbinä¸ºç©ºçš„æ—¶å€™åªéœ€è¦casç»™ä¸€ä¸ªå˜é‡èµ‹å€¼å°±è¡Œäº†ï¼Œèƒ½ä¿è¯æ­£ç¡®æ€§ã€‚ä½†æ˜¯åé¢æœ‰ä¸€ä¸ªé“¾è¡¨çš„æ—¶å€™ï¼Œå°±æœ‰å¤šä¸ªå˜é‡å€¼çš„ä¿®æ”¹äº†ï¼Œéœ€è¦åŠ é”æ¥ä¿è¯å¹¶å‘æ­£ç¡®ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1628690996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529858,"avatar":"https://static001.geekbang.org/account/avatar/00/17/58/02/2b7ccf09.jpg","nickname":"æ°‘å·¥597","note":"","ucode":"DB6857E21E9318","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350452,"discussion_content":"åˆ›å»ºä¸æ˜¯é«˜å¹¶å‘åœºæ™¯å§ï¼Œcasæ¶ˆè€—CPUæ²¡æ³•æ”¯æŒå¾ˆå¤§çš„å¹¶å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613878662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10165,"user_name":"mongo","can_delete":false,"product_type":"c1","uid":1113124,"ip_address":"","ucode":"F39FE783793A17","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/24/7d43d807.jpg","comment_is_top":false,"comment_ctime":1527319317,"is_pvip":false,"replies":[{"id":"3247","content":"æˆ‘ç†è§£æ˜¯çš„ï¼Œåˆ¤æ–­æ˜¯ä¸ªForwardingNodeï¼Œresizeæ­£åœ¨è¿›è¡Œï¼›<br>nexttableæ˜¯æ‰©å®¹æ—¶çš„ä¸´æ—¶è¿‡æ¸¡","user_name":"ä½œè€…å›å¤","comment_id":10165,"uid":"1009360","ip_address":"","utype":1,"ctime":1527483694,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"23002155797","product_id":100006701,"comment_content":"è¯·æ•™è€å¸ˆï¼šputValæ–¹æ³•ä¸­ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿›å…¥else if ((fh=f.hash) == MOVED)åˆ†æ”¯ï¼Ÿæ˜¯è¿›è¡Œæ‰©å®¹çš„æ—¶å€™å—ï¼ŸnextTableæ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418370,"discussion_content":"æˆ‘ç†è§£æ˜¯çš„ï¼Œåˆ¤æ–­æ˜¯ä¸ªForwardingNodeï¼Œresizeæ­£åœ¨è¿›è¡Œï¼›\nnexttableæ˜¯æ‰©å®¹æ—¶çš„ä¸´æ—¶è¿‡æ¸¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527483694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10152,"user_name":"mongo","can_delete":false,"product_type":"c1","uid":1113124,"ip_address":"","ucode":"F39FE783793A17","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/24/7d43d807.jpg","comment_is_top":false,"comment_ctime":1527310686,"is_pvip":false,"replies":[{"id":"3246","content":"è¿™ä¸ªæœ‰volatile loadè¯­ä¹‰","user_name":"ä½œè€…å›å¤","comment_id":10152,"uid":"1009360","ip_address":"","utype":1,"ctime":1527483045,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":2,"race_medal":0,"score":"23002147166","product_id":100006701,"comment_content":"è¯·æ•™è€å¸ˆï¼šputValæ–¹æ³•çš„ç¬¬äºŒä¸ªifåˆ†æ”¯ï¼Œä¸ºä»€ä¹ˆè¦ç”¨tabAtï¼Ÿæˆ‘çš„è®¤è¯†é‡Œç›´æ¥æ•°ç»„ä¸‹æ ‡å¯»å€tab[i=(n-1) &amp; hash]ä¹Ÿæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œä¸æ˜¯å—ï¼ŸtabAté‡Œé¢çš„getObjectVolatleï¼ˆï¼‰æ–¹æ³•è·Ÿç›´æ¥ç”¨æ•°ç»„ä¸‹æ ‡tab[i=(n-1) &amp; hash]å¯»å€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418362,"discussion_content":"è¿™ä¸ªæœ‰volatile loadè¯­ä¹‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527483045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207774,"discussion_content":"ä¸ä¼šçš„ï¼Œvolatileåªä¿®é¥°tabå¼•ç”¨ï¼Œåªä¿è¯tabå¼•ç”¨çš„volatileè¯­ä¹‰ï¼Œå¯¹tab[i] çš„è®¿é—®å¹¶æ²¡æœ‰volatileè¯­ä¹‰ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584513514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235742,"user_name":"Arthur","can_delete":false,"product_type":"c1","uid":1222441,"ip_address":"","ucode":"FF96EEDEBF7E3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/a7/29/977c3280.jpg","comment_is_top":false,"comment_ctime":1595167938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18775037122","product_id":100006701,"comment_content":"è¿˜æœ‰å…³äºConcurrentHashMapçš„Keyå’ŒValueä¸ºä»€ä¹ˆä¸èƒ½ä¸ºnullï¼Œå› ä¸ºHashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé»˜è®¤å•çº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¦‚æœget(key)ä¸ºnullï¼Œå¯ä»¥é€šè¿‡containsKey(key) æ–¹æ³•æ¥åˆ¤æ–­è¿™ä¸ªkeyçš„valueä¸ºnullï¼Œè¿˜æ˜¯ä¸å­˜åœ¨è¿™ä¸ªkeyï¼Œè€ŒConcurrentHashMapï¼ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ åœ¨å¤šçº¿ç¨‹æ“ä½œæ—¶ï¼Œå› ä¸º ã€get(key)ã€‘å’Œ ã€containsKey(key)ã€‘ ä¸¤ä¸ªæ“ä½œå’Œåœ¨ä¸€èµ·ã€ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œã€‘ï¼Œ å¯èƒ½åœ¨æ‰§è¡Œä¸­é—´ï¼Œæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†æ•°æ®ï¼Œæ‰€ä»¥æ— æ³•åŒºåˆ†valueä¸ºnullè¿˜æ˜¯ä¸å­˜åœ¨keyã€‚","like_count":5},{"had_liked":false,"id":11851,"user_name":"Xg huang","can_delete":false,"product_type":"c1","uid":1016995,"ip_address":"","ucode":"9680FA95DE3553","user_header":"","comment_is_top":false,"comment_ctime":1528388249,"is_pvip":false,"replies":[{"id":"3893","content":"è¿™ä¸ªæ˜¯åœ¨ä»£ä»·å¯æ¥å—æƒ…å†µä¸‹ï¼Œå°½é‡å‡†ç¡®ï¼Œå°±åƒå«é‡‘é‡90%å’Œ99.9%ï¼Œ99.999%ï¼Œè¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè™½ç„¶ä¸æ˜¯ç™¾åˆ†ç™¾","user_name":"ä½œè€…å›å¤","comment_id":11851,"uid":"1009360","ip_address":"","utype":1,"ctime":1528434694,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"14413290137","product_id":100006701,"comment_content":"è¿™é‡Œæœ‰ä¸ªåœ°æ–¹æƒ³è·Ÿè€å¸ˆäº¤æµä¸€ä¸‹æƒ³æ³•, ä»æ–‡ä¸­&quot;æ‰€ä»¥ï¼ŒConcurrentHashMap çš„å®ç°æ˜¯é€šè¿‡é‡è¯•æœºåˆ¶ï¼ˆRETRIES_BEFORE_LOCKï¼ŒæŒ‡å®šé‡è¯•æ¬¡æ•° 2ï¼‰ï¼Œæ¥è¯•å›¾è·å¾—å¯é å€¼ã€‚å¦‚æœæ²¡æœ‰ç›‘æ§åˆ°å‘ç”Ÿå˜åŒ–ï¼ˆé€šè¿‡å¯¹æ¯” Segment.modCountï¼‰ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™è·å–é”è¿›è¡Œæ“ä½œã€‚&quot; å¯ä»¥çœ‹å‡º, åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹, &quot;size()&quot; æ–¹æ³•åªæ˜¯è¿”å›&quot;è¿‘ä¼¼å€¼&quot;, è€Œæˆ‘çš„é—®é¢˜æ˜¯: æ—¢ç„¶åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼, ä¸ºå•¥è¦ç”¨è¿™ç§&quot;é‡è¯•,åˆ†æ®µé”&quot; çš„å¤æ‚åšæ³•å»è®¡ç®—è¿™ä¸ªå€¼? ç›´æ¥åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹è¿”å›segment çš„size å²‚ä¸æ˜¯æ›´ç®€å•? æˆ‘èƒ½ç†è§£jdkå¼€å‘è€…æƒ³å°½ä¸€åˆ‡åŠªåŠ›åœ¨é«˜æ€§èƒ½åœ°è¿”å›æœ€ç²¾ç¡®çš„æ•°å€¼, ä½†è¿™ä¸ª&quot;ç²¾ç¡®&quot; åº¦æ— æ³•é‡åŒ–å•Š, å¯¹äºè°ƒç”¨æ–¹æ¥è¯´,è¿™ä¸ªå€¼ä¾ç„¶æ˜¯ä¸å¯é çš„å•Š. æ‰€ä»¥, åœ¨æˆ‘çœ‹æ¥,è¿™ç§åšæ³•æ”¶ç›Šå¾ˆå°(å¯èƒ½æ˜¯æˆ‘ä¹Ÿæ¯”è¾ƒæ‡’å§), æˆ–è€…æœ‰äº›è®¾è®¡ä¸Šçš„è¦ç‚¹æˆ‘æ²¡æœ‰é¢†æ‚Ÿå‡ºæ¥, å¸Œæœ›è€å¸ˆæŒ‡ç‚¹ä¸€ä¸‹.","like_count":3,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419029,"discussion_content":"è¿™ä¸ªæ˜¯åœ¨ä»£ä»·å¯æ¥å—æƒ…å†µä¸‹ï¼Œå°½é‡å‡†ç¡®ï¼Œå°±åƒå«é‡‘é‡90%å’Œ99.9%ï¼Œ99.999%ï¼Œè¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè™½ç„¶ä¸æ˜¯ç™¾åˆ†ç™¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528434694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10260,"user_name":"è¡Œè€…","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1527424913,"is_pvip":false,"replies":[{"id":"3217","content":"å¥½ï¼Œåé¢æœ‰ç« èŠ‚","user_name":"ä½œè€…å›å¤","comment_id":10260,"uid":"1009360","ip_address":"","utype":1,"ctime":1527467993,"user_name_real":"æ¨æ™“å³°"}],"discussion_count":1,"race_medal":0,"score":"14412326801","product_id":100006701,"comment_content":"è€å¸ˆéº»çƒ¦è®²è®²è‡ªæ—‹é”ï¼Œåå‘é”çš„ç‰¹ç‚¹å’ŒåŒºåˆ«å§ï¼Œä¸€ç›´ä¸å¤ªæ¸…æ¥šã€‚","like_count":3,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418415,"discussion_content":"å¥½ï¼Œåé¢æœ‰ç« èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527467993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121912,"user_name":"é¡ºå“¥èŠæˆé•¿","can_delete":false,"product_type":"c1","uid":1023328,"ip_address":"","ucode":"FEF42E951B16F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9d/60/45b3184d.jpg","comment_is_top":false,"comment_ctime":1565247944,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10155182536","product_id":100006701,"comment_content":"åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼Œå†åˆ©ç”¨ä¸€äº›åŸå­æ“ä½œï¼Œæ¥å®ç°æ— é”ç¼–ç¨‹ï¼Œåº”å¯¹é«˜å¹¶å‘ã€‚è¿™æ ·ç†è§£é è°±å—ï¼Ÿ","like_count":2},{"had_liked":false,"id":81003,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1553773142,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10143707734","product_id":100006701,"comment_content":"æˆ‘è®°å¾—concurrentHashMapçš„sizeæ–¹æ³•æ˜¯ä¸€ä¸ªåµŒå¥—å¾ªç¯ï¼š<br>1ï¼šéå†æ‰€æœ‰çš„segmentï¼›<br>2ï¼šæŠŠæ‰€æœ‰segmentå…ƒç´ ç´¯åŠ èµ·æ¥ï¼›<br>3ï¼šæŠŠæ‰€æœ‰segmentçš„ä¿®æ”¹æ¬¡æ•°ç´¯åŠ èµ·æ¥;<br>4ï¼šåˆ¤æ–­å½“æ¬¡segmentä¿®æ”¹æ¬¡æ•°æ˜¯å¦å¤§äºä¸Šæ¬¡çš„æ€»ä¿®æ”¹æ¬¡æ•°ï¼Œå¦‚æœå¤§äºï¼Œåˆ™è¯´æ˜å½“æ¬¡è¿˜æœ‰ä¿®æ”¹ï¼Œé‡æ–°ç»Ÿè®¡ï¼Œå°è¯•ä¸€æ¬¡ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯´æ˜æ²¡æœ‰ä¿®æ”¹ï¼Œåˆ™ç»“æŸï¼›<br>5ï¼šå¦‚æœå°è¯•æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™å¯¹æ¯ä¸ªsegmentåŠ é”ï¼Œé‡æ–°ç»Ÿè®¡ï¼Œæœ€ååœ¨é‡è¯•4æ­¥éª¤ï¼Œåªåˆ°æ€»ä¿®æ”¹æ¬¡æ•°å¤§äºä¸Šæ¬¡ä¿®æ”¹æ¬¡æ•°ï¼Œé‡Šæ”¾é”ï¼Œç„¶åç»Ÿè®¡ç»“æŸã€‚","like_count":2},{"had_liked":false,"id":44058,"user_name":"é™ˆå¤","can_delete":false,"product_type":"c1","uid":1044533,"ip_address":"","ucode":"DADE8D9C40B2F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f0/35/a5ded70c.jpg","comment_is_top":false,"comment_ctime":1543366782,"is_pvip":false,"replies":[{"id":"16131","content":"22ç« æœ‰ç³»ç»Ÿä»‹ç»","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1543626819,"ip_address":"","comment_id":44058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10133301374","product_id":100006701,"comment_content":"è€å¸ˆï¼Œcasæ“ä½œæœ‰æ²¡æœ‰ä»€ä¹ˆå¼Šç«¯å‘¢ï¼Ÿå› ä¸ºcasä¹Ÿå¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œæ ¹æ®æ‚¨çš„ç»éªŒï¼Œæœ‰å¼Šç«¯å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430615,"discussion_content":"22ç« æœ‰ç³»ç»Ÿä»‹ç»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543626819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10762,"user_name":"Levy","can_delete":false,"product_type":"c1","uid":1078941,"ip_address":"","ucode":"6AFCB0EA6CA183","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/9d/6dab9e0e.jpg","comment_is_top":false,"comment_ctime":1527689991,"is_pvip":false,"replies":[{"id":"3461","content":"volatileä¿è¯çš„æ˜¯æ•°ç»„ï¼Œä¸æ˜¯æ•°ç»„å…ƒç´ ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527760511,"ip_address":"","comment_id":10762,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10117624583","product_id":100006701,"comment_content":"è€å¸ˆä½ å¥½ï¼ŒtabAté‡Œé¢çš„getObjectVolatleï¼ˆï¼‰æ–¹æ³•è·Ÿç›´æ¥ç”¨æ•°ç»„ä¸‹æ ‡tab[i=(n-1) &amp; hash]å¯»å€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿä¸æ‡‚ï¼Œvolitileä¸æ˜¯å·²ç»ä¿è¯å†…å­˜å¯è§æ€§å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418591,"discussion_content":"volatileä¿è¯çš„æ˜¯æ•°ç»„ï¼Œä¸æ˜¯æ•°ç»„å…ƒç´ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527760511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10304,"user_name":"Hesher","can_delete":false,"product_type":"c1","uid":1026832,"ip_address":"","ucode":"99AB8B1704CB7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg","comment_is_top":false,"comment_ctime":1527468371,"is_pvip":false,"replies":[{"id":"3235","content":"åé¢å¹¶å‘éƒ¨åˆ†ä¼šè¯¦ç»†åˆ†æ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527479477,"ip_address":"","comment_id":10304,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10117402963","product_id":100006701,"comment_content":"å¹¶å‘åŒ…ç”¨çš„å¾ˆå°‘ï¼Œè¿™ä¸€èŠ‚å†…å®¹çš„å‰ç½®çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œå¯¹äºä½¿ç”¨ç»éªŒå°‘çš„äººæ¥è¯´è²Œä¼¼æ˜¯æœ‰ç‚¹éš¾äº†ã€‚é—®é¢˜å¾ˆå¥½ï¼Œæ­£å¥½å¯ä»¥è§è¯†ä¸€ä¸‹å„ç§ä½¿ç”¨åœºæ™¯ï¼Œä¸è¿‡ç•™è¨€å¤§éƒ¨åˆ†æ˜¯é’ˆå¯¹å†…å®¹çš„éš¾ç‚¹æé—®ï¼Œè€ŒçœŸæ­£å›ç­”é—®é¢˜çš„è¿˜æ²¡æœ‰å‡ºç°ã€‚","like_count":2,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418432,"discussion_content":"åé¢å¹¶å‘éƒ¨åˆ†ä¼šè¯¦ç»†åˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527479477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10179,"user_name":"ç°é£ç°çŒªä¸ä¼šç°é£.çƒŸç­","can_delete":false,"product_type":"c1","uid":1127314,"ip_address":"","ucode":"FF9FB4C902D1F5","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/92/99530cee.jpg","comment_is_top":false,"comment_ctime":1527325053,"is_pvip":false,"replies":[{"id":"3219","content":"æˆ‘åˆ—å‡ºæ¥çš„åŒºåˆ«ä¸æ­¢å§ï¼›<br>å­˜åœ¨é”å‡é™çº§çš„é—®é¢˜ï¼Œåé¢æœ‰ç« èŠ‚ä»‹ç»","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527468263,"ip_address":"","comment_id":10179,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10117259645","product_id":100006701,"comment_content":"jdk7å’Œ8çš„åŒºåˆ«æ„Ÿè§‰å°±æ˜¯åŠ é”ä¸ä¸€æ ·äº†ï¼Œå…¶ä»–çš„æ²¡çœ‹æ‡‚ã€‚<br>è€å¸ˆï¼Œsynchronizedå’Œlockæ˜¯ä¸æ˜¯éƒ½æ˜¯åœ¨ç±»å­—èŠ‚ç ç§æºå¸¦è‡ªæ—‹é”å’Œåå‘é”å•Šï¼Ÿ<br>ä»–ä¸¤åº•å±‚åŒºåˆ«æ˜¯å•¥å‘¢ï¼Ÿæˆ‘çŸ¥é“locké‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨","like_count":2,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418375,"discussion_content":"æˆ‘åˆ—å‡ºæ¥çš„åŒºåˆ«ä¸æ­¢å§ï¼›\nå­˜åœ¨é”å‡é™çº§çš„é—®é¢˜ï¼Œåé¢æœ‰ç« èŠ‚ä»‹ç»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527468263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293571,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1621433670,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"5916400966","product_id":100006701,"comment_content":"é«˜å¹¶å‘åœºæ™¯å¯ä»¥ç”¨concurrentHashMap","like_count":1},{"had_liked":false,"id":209225,"user_name":"æé£","can_delete":false,"product_type":"c1","uid":1555180,"ip_address":"","ucode":"930458850AA05B","user_header":"https://static001.geekbang.org/account/avatar/00/17/ba/ec/2b1c6afc.jpg","comment_is_top":false,"comment_ctime":1587521291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882488587","product_id":100006701,"comment_content":"ConcurrentHashMapçš„åœºæ™¯åº”ç”¨ï¼šåœ¨çº¿ç”¨æˆ·","like_count":1},{"had_liked":false,"id":163425,"user_name":"AAA_å¶å­","can_delete":false,"product_type":"c1","uid":1325994,"ip_address":"","ucode":"1E93617D308EE0","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/aa/e8dfcd7e.jpg","comment_is_top":false,"comment_ctime":1576719972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5871687268","product_id":100006701,"comment_content":"concurrentHashMap putæ–¹æ³• æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ ä½†æ˜¯getæ–¹æ³• ä¸èƒ½ä¿è¯ï¼Œé‡‡ç”¨çš„volatile ä¿®é¥°çš„ Node ä¿è¯å¯è§æ€§ï¼Œ å¯¹çº¢é»‘æ ‘çš„èŠ‚ç‚¹çš„get é‡‡ç”¨çš„æ˜¯åŠ é”æœºåˆ¶ã€‚","like_count":1},{"had_liked":false,"id":127414,"user_name":"æ—¥å…‰å€¾åŸ","can_delete":false,"product_type":"c1","uid":1120345,"ip_address":"","ucode":"E4329963F660DC","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/59/daeb0b6c.jpg","comment_is_top":false,"comment_ctime":1566703326,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5861670622","product_id":100006701,"comment_content":"initTableé‡Œé¢çš„Thread.yieldä»€ä¹ˆåœºæ™¯ä¸‹ä¼šè¿”å›å‘¢","like_count":1,"discussions":[{"author":{"id":1180791,"avatar":"https://static001.geekbang.org/account/avatar/00/12/04/77/b0dbd680.jpg","nickname":"Comdotwang","note":"","ucode":"505C65CB8E0B92","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125025,"discussion_content":"è¿™ä¸ªæ˜¯ä¸æ˜¯è¦çœ‹è°ƒåº¦ç³»ç»Ÿä»€ä¹ˆæ—¶å€™è°ƒåº¦è¿™ä¸ªè¿›ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578468158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1251634,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqcnUABw0V5MIDSmqbibmVWoTxflia2uApNBj2u8MTbMnYPjv1c9xFBOl1AWAVF20QL2GDQmvMEt7w/132","nickname":"æè¾–é²","note":"","ucode":"15637B4B6B5054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1180791,"avatar":"https://static001.geekbang.org/account/avatar/00/12/04/77/b0dbd680.jpg","nickname":"Comdotwang","note":"","ucode":"505C65CB8E0B92","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128555,"discussion_content":"ä¸ä¼šå µå¡åœ¨è¿™é‡Œï¼Œåªæ˜¯æŠŠæ—¶é—´ç‰‡è®©å‡ºå»ï¼Œå¸Œæœ›åˆ«çš„çº¿ç¨‹å¿«ç‚¹åˆå§‹åŒ–å®Œï¼Œæ‰§è¡Œyieldçš„çº¿ç¨‹å¥½é€€å‡ºå¾ªç¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578650014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":125025,"ip_address":""},"score":128555,"extra":""}]}]},{"had_liked":false,"id":123499,"user_name":"æœ±å°å±±","can_delete":false,"product_type":"c1","uid":1192101,"ip_address":"","ucode":"AB675896337DE0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/u0jDPGD68hsYNxhib3dQib4SibS8kic5FPEy0ib3ZxJuapbPsibNzbUoOufHws9rFOZazl5s4OrSXYHibz89IAZcHWMkA/132","comment_is_top":false,"comment_ctime":1565687405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5860654701","product_id":100006701,"comment_content":"ConcurrentHashMap <br>jdk 1.7  é‡‡ç”¨åˆ†æ®µé”å®ç°åŒæ­¥ï¼Œåˆ†æ®µé”çš„é”ç²’åº¦è¾ƒå°ï¼Œä¸€å®šç¨‹åº¦ä¿è¯äº†æ€§èƒ½ã€‚ä¸€ä¸ªHashMapåˆ†æˆè‹¥å¹²æ®µsegmentã€‚æ¯ä¸ªsegmentå«æœ‰è‹¥å¹²ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶å­˜æ”¾K_Vå½¢å¼çš„é“¾è¡¨ã€‚å½“PUTæ“ä½œæ—¶å€™ï¼Œå…ˆhashå¾—åˆ°å¯¹åº”çš„segmentï¼Œç„¶åå¯¹segmentåŠ é”ã€‚ç„¶åå†hashè®¡ç®—è¦æ·»åŠ çš„æ¡¶ï¼Œç„¶åéå†é“¾è¡¨ï¼Œæ›´æ–°åˆ°èŠ‚ç‚¹åˆ°æ¡¶ã€‚SIZEä¼šåˆ†ä¸¤æ­¥ï¼Œå…ˆè®¡ç®—æ¯ä¸ªsegmentçš„SIZEï¼Œç„¶åå†è®¡ç®—æ‰€æœ‰segmentçš„SIZEã€‚<br>jdk 1.8é‡‡ç”¨äº†synchronizedå’ŒCASå®ç°ï¼Œé”ç²’åº¦æ›´ç²¾ç»†ï¼Œæ€§èƒ½æ›´å¼ºã€‚è™½ç„¶ä»£ç ä¸­ä¿å­˜segmentï¼Œä½†æ˜¯æ²¡åœ¨ä½¿ç”¨ï¼Œä½¿ç”¨Volatileä¿è¯å¯è§æ€§ã€‚size ä½¿ç”¨atomicåŒ…ä¸‹çš„AtomicLongç±»å®ç°ç´¯åŠ è®¡ç®—","like_count":1},{"had_liked":false,"id":13825,"user_name":"bazindes","can_delete":false,"product_type":"c1","uid":1145691,"ip_address":"","ucode":"6B0830ECE27B82","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/5b/907744cf.jpg","comment_is_top":false,"comment_ctime":1530006264,"is_pvip":false,"replies":[{"id":"4645","content":"å“ˆï¼ŒæŠ±æ­‰ï¼Œæˆ‘åé¦ˆä¸€ä¸‹ï¼Œä¸»æ’­ä¹Ÿè¾›è‹¦ï¼Œä¸ä¸€å®šæ˜¯èŒä¸šç å†œ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530116847,"ip_address":"","comment_id":13825,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5824973560","product_id":100006701,"comment_content":"è€å¸ˆçš„å†…å®¹è®²çš„ä¸°å¯Œ æ·±å…¥æµ…å‡º å¸Œæœ›æé«˜ä¸€ä¸‹æœ—è¯»äººçš„è¦æ±‚å§ æ¯èŠ‚è¯¾éƒ½æ„Ÿè§‰æœ‰è¯»é”™çš„ è‹±æ–‡è¯»ä¸å‡†å°±ä¸è¯´äº† äº’æ–¥è¯»æˆäº’æ‹†å¬çš„å®åœ¨æ˜¯åˆ«æ‰­","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419774,"discussion_content":"å“ˆï¼ŒæŠ±æ­‰ï¼Œæˆ‘åé¦ˆä¸€ä¸‹ï¼Œä¸»æ’­ä¹Ÿè¾›è‹¦ï¼Œä¸ä¸€å®šæ˜¯èŒä¸šç å†œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530116847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11385,"user_name":"å®å®","can_delete":false,"product_type":"c1","uid":1083057,"ip_address":"","ucode":"C6BDF1F05A33EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/86/b1/4b5d3a3b.jpg","comment_is_top":false,"comment_ctime":1528108386,"is_pvip":false,"replies":[{"id":"3671","content":"éƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œå–ä¸ªæŠ˜è¡·","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1528157538,"ip_address":"","comment_id":11385,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5823075682","product_id":100006701,"comment_content":"åœ¨æ„é€ çš„æ—¶å€™ï¼ŒSegment çš„æ•°é‡ç”±æ‰€è°“çš„ concurrentcyLevel å†³å®šï¼Œé»˜è®¤æ˜¯ 16ï¼å¹¶å‘æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418817,"discussion_content":"éƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œå–ä¸ªæŠ˜è¡·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528157538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10431,"user_name":"æå®¢cq","can_delete":false,"product_type":"c1","uid":1128186,"ip_address":"","ucode":"3022A53D58562E","user_header":"","comment_is_top":false,"comment_ctime":1527553746,"is_pvip":false,"replies":[{"id":"3364","content":"æœ‰ä¸€å®šé“ç†ï¼Œä½†segå’ŒbuckèŒƒå›´ä¸å®Œå…¨å¯¹ç­‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527608948,"ip_address":"","comment_id":10431,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5822521042","product_id":100006701,"comment_content":"ä¸ä»å®ç°ä¸Šåªä»å›¾å½¢ç»“æ„ä¸Šçœ‹ï¼ŒConcurrentHashMapå’ŒHashMapä¸€æ ·ï¼Œä¸è¿‡æ˜¯å°†bucketsæ¢æˆäº†segmentï¼Œç„¶ååŠ é”æ–¹å¼ä»æ•´mapï¼Œä¸‹æ²‰åˆ°segmentï¼ˆbucketsï¼‰ä¸Šï¼Œè¿™æ ·ç®€å•ç†è§£æ­£ç¡®ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418476,"discussion_content":"æœ‰ä¸€å®šé“ç†ï¼Œä½†segå’ŒbuckèŒƒå›´ä¸å®Œå…¨å¯¹ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527608948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10122,"user_name":"cuzz.","can_delete":false,"product_type":"c1","uid":1112592,"ip_address":"","ucode":"671A8D1579D44D","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/10/cefb0e21.jpg","comment_is_top":false,"comment_ctime":1527302815,"is_pvip":false,"replies":[{"id":"3240","content":"è¯·é—®å…·ä½“å“ªä¸ªæ–¹é¢ï¼Ÿå¹¶å‘å·¥å…·åé¢ä¼šæœ‰ä¸“é—¨åˆ†æ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527480949,"ip_address":"","comment_id":10122,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5822270111","product_id":100006701,"comment_content":"æœ‰ç‚¹ä¸æ‡‚ã€‚ã€‚","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418351,"discussion_content":"è¯·é—®å…·ä½“å“ªä¸ªæ–¹é¢ï¼Ÿå¹¶å‘å·¥å…·åé¢ä¼šæœ‰ä¸“é—¨åˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527480949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268844,"user_name":"acqierement","can_delete":false,"product_type":"c1","uid":1234980,"ip_address":"","ucode":"AC8DA74B9CB924","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/24/f48a38f4.jpg","comment_is_top":false,"comment_ctime":1608367957,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608367957","product_id":100006701,"comment_content":"åªèƒ½å¤§æ¦‚æœ‰å°è±¡ï¼Œæƒ³è¦è‡ªå·±æ¶ˆåŒ–ï¼Œæˆ‘è¿˜æ˜¯è¦è¯¾åçœ‹æºç æ‰è¡Œã€‚","like_count":0},{"had_liked":false,"id":214373,"user_name":"hailowell","can_delete":false,"product_type":"c1","uid":1195572,"ip_address":"","ucode":"557DCAB01710AB","user_header":"","comment_is_top":false,"comment_ctime":1588732750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588732750","product_id":100006701,"comment_content":"ConcurrentHashMapçš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯<br>ç»™èµ„æºç”Ÿæˆä¸€ä¸ªåŠ¨æ€çš„idï¼Œå­˜å‚¨çœŸæ­£çš„è·¯å¾„ã€‚ç”¨æˆ·è®¿é—®æ—¶å¯ä»¥ç»Ÿä¸€è¯·æ±‚ä¸€ä¸ªè·¯å¾„ ä½¿ç”¨è¿™ä¸ªåŠ¨æ€ç”Ÿæˆçš„keyè®¿é—®å¯¹åº”çš„èµ„æºã€‚å¹¶å‘æƒ…å†µä¸‹ ä¸ºäº†ä¸€ä¸ªèµ„æºä¸€æ®µæ—¶é—´å†…åªç”Ÿæˆä¸€æ¬¡ï¼Œç”¨è¿™ä¸ªç±»å­˜å‚¨æ˜ å°„å…³ç³»","like_count":0},{"had_liked":false,"id":198530,"user_name":"Swing","can_delete":false,"product_type":"c1","uid":1330065,"ip_address":"","ucode":"55FCA9ECEFBBEB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/N0NACGUr8dNAbN6BdiagPHBaB0EnyDsI9zWpwJteqTY38apOEnTOA7JkBAQnzYKJBgxu3Q8YMUILwLAB6camn4w/132","comment_is_top":false,"comment_ctime":1585455372,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585455372","product_id":100006701,"comment_content":"è¿™ä¸€èŠ‚çš„concurrentHashMapçš„ä¼˜åŒ–è¿›ç¨‹ï¼Œéœ€è¦å…ˆå¯¹é”ä»¥åŠä¸€äº›unsafeçš„ä¸œä¸œæœ‰æ¯”è¾ƒå¥½çš„ç†è§£æ‰è¡Œ","like_count":0},{"had_liked":false,"id":185368,"user_name":"Seven.Linæ¾¤è€¿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1583568746,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583568746","product_id":100006701,"comment_content":"åœ¨äº§å“ä»£ç ä¸­ï¼Œæœ‰æ²¡æœ‰å…¸å‹çš„åœºæ™¯éœ€è¦ä½¿ç”¨ç±»ä¼¼ ConcurrentHashMap è¿™æ ·çš„å¹¶å‘å®¹å™¨å‘¢ï¼Ÿ<br>ä¹‹å‰ä¸ºäº†é…åˆé¡µé¢ä¸¤æ¬¡æ“ä½œï¼Œéœ€è¦åšä¸´æ—¶çš„ç¼“å­˜ï¼Œä¸€å¼€å§‹å¿˜è®°è€ƒè™‘å¤šçº¿ç¨‹ç”¨äº†HashMapï¼Œå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œåæ¥æ”¹ä¸ºConcurrentHashMapè§£å†³çš„","like_count":0},{"had_liked":false,"id":181811,"user_name":"yihang","can_delete":false,"product_type":"c1","uid":1012361,"ip_address":"","ucode":"A5506F085D1793","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","comment_is_top":false,"comment_ctime":1582637960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582637960","product_id":100006701,"comment_content":"å¦å¤–jdk7ä¸­ä½¿ç”¨unsafeçš„getObjectVolatileæ–¹æ³•ï¼Œè¿™è·Ÿç›´æ¥å£°æ˜volatileå˜é‡æ¥è®¿é—®èƒ½æœ‰ä»€ä¹ˆä¸åŒï¼Ÿæ„Ÿè§‰éƒ½èƒ½ä¿è¯å¯è§æ€§ï¼Ÿ","like_count":0},{"had_liked":false,"id":181810,"user_name":"yihang","can_delete":false,"product_type":"c1","uid":1012361,"ip_address":"","ucode":"A5506F085D1793","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","comment_is_top":false,"comment_ctime":1582637712,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582637712","product_id":100006701,"comment_content":"HashEntry å†…éƒ¨ä½¿ç”¨ volatile çš„ value å­—æ®µæ¥ä¿è¯å¯è§æ€§ï¼Œä¹Ÿåˆ©ç”¨äº†ä¸å¯å˜å¯¹è±¡çš„æœºåˆ¶ä»¥æ”¹è¿›åˆ©ç”¨ Unsafe æä¾›çš„åº•å±‚èƒ½åŠ›ï¼Œæ¯”å¦‚ volatile accessï¼Œå»ç›´æ¥å®Œæˆéƒ¨åˆ†æ“ä½œï¼Œä»¥æœ€ä¼˜åŒ–æ€§èƒ½ï¼Œæ¯•ç«Ÿ Unsafe ä¸­çš„å¾ˆå¤šæ“ä½œéƒ½æ˜¯ JVM intrinsic ä¼˜åŒ–è¿‡çš„ã€‚<br><br>è¿™æ®µè¯ä¸å¤ªç†è§£ï¼šå“ªé‡Œç”¨åˆ°äº†ä¸å¯å˜å¯¹è±¡æœºåˆ¶å‘¢ï¼Ÿè¿˜æœ‰ intrinsic ä¼˜åŒ–æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"ä¸‹ä¸ªç›®æ ‡45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336549,"discussion_content":"ä¸å¯å˜å¯¹è±¡æœºåˆ¶ => Nodeé“¾è¡¨é™æ€å†…éƒ¨ç±»çš„å±æ€§ç”¨finalä¿®é¥°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608623551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149567,"user_name":"ç‹ç››æ­¦","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1573276649,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573276649","product_id":100006701,"comment_content":"&quot;æ•°æ®å­˜å‚¨åˆ©ç”¨ volatile æ¥ä¿è¯å¯è§æ€§ã€‚&quot;<br>JDK1.7é‡Œçš„HashEntryçš„valueä¹Ÿæ˜¯volatile ,  ä¸ºä½•è¿™é‡Œçš„volatileä¹Ÿä½œä¸ºå·®å¼‚é¡¹å‘¢?","like_count":0},{"had_liked":false,"id":146501,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1572554849,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572554849","product_id":100006701,"comment_content":"åˆ†æ®µé”é€šè¿‡æ›´ç»†çš„æ§åˆ¶æ¥æé«˜å¹¶å‘åº¦ï¼Œè·å–é”æ˜¯é€šè¿‡é‡è¯•æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è½®è¯¢ä¸€ä¸ªæ®µèƒ½å¦è¢«å†™å…¥ã€‚","like_count":0},{"had_liked":false,"id":143744,"user_name":"æ— è¨€çš„çº¦å®š","can_delete":false,"product_type":"c1","uid":1128953,"ip_address":"","ucode":"5E8046EB6B7956","user_header":"https://static001.geekbang.org/account/avatar/00/11/39/f9/acfb9a48.jpg","comment_is_top":false,"comment_ctime":1571787885,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571787885","product_id":100006701,"comment_content":"çº¿ç¨‹å®‰å…¨æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384590,"discussion_content":"æ²¡æœ‰ä¸€è‡´æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626671962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139316,"user_name":"æ¯…æ’","can_delete":false,"product_type":"c1","uid":1635327,"ip_address":"","ucode":"83667DAFB3389E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/aeCJlOUAyLVNLUYDw2soQPjiaXUC9X9CzLTE2qrV8wgNrh22ksnGib9sB2V5oQe1LuxXp9KvvzHG1yvCquEGpRxA/132","comment_is_top":false,"comment_ctime":1570609574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570609574","product_id":100006701,"comment_content":"1.å¦‚ä½•ä¿è¯é›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„<br>é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¿®æ”¹é›†åˆï¼Œé€šè¿‡åŠ é”æ¥å®ç°ã€‚<br>2.ConcurrentHashMapå¦‚ä½•å®ç°é«˜æ•ˆåœ°çº¿ç¨‹å®‰å…¨<br>ConcurrentHashMapå°†é›†åˆçš„æ•°æ®åˆ†ä¸ºä¸€æ®µä¸€æ®µï¼ŒåŒæ—¶æ¯æ®µä¸Šæœ‰å¤šä¸ªæ¡¶ï¼Œåœ¨æ¡¶ä¸Šå­˜å‚¨é“¾è¡¨ã€‚å½“è®¿é—®é›†åˆæ—¶ï¼Œé€šè¿‡keyæ¥è®¡ç®—hashå€¼æ¥æ‰¾åˆ°å¯¹åº”çš„æ®µï¼Œä¸ºè¯¥æ®µåŠ ä¸Šé”ï¼ŒåŒæ—¶ï¼Œå¦ä¸€çº¿ç¨‹å°±å¯ä»¥è®¿é—®å…¶ä»–æ®µçš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶ä¹Ÿæ¯”hashtableé«˜æ•ˆï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®é›†åˆã€‚","like_count":0},{"had_liked":false,"id":131010,"user_name":"dylan","can_delete":false,"product_type":"c1","uid":1053737,"ip_address":"","ucode":"8A7F72C64F13CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/14/29/58e2ca3a.jpg","comment_is_top":false,"comment_ctime":1567598196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567598196","product_id":100006701,"comment_content":"tabAtæ–¹æ³•è²Œä¼¼è°ƒç”¨çš„æ˜¯Unsafeç±»çš„getObjectVolatileæ–¹æ³•ï¼Œä¸çŸ¥æ˜¯ä¸æ˜¯è€å¸ˆç¬”è¯¯","like_count":0},{"had_liked":false,"id":106845,"user_name":"ææ˜¥æ’","can_delete":false,"product_type":"c1","uid":1033066,"ip_address":"","ucode":"F2DCA19EC66DC1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/6a/3272e095.jpg","comment_is_top":false,"comment_ctime":1561397430,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561397430","product_id":100006701,"comment_content":"è°¢è°¢è€å¸ˆã€‚","like_count":0},{"had_liked":false,"id":100495,"user_name":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1559567121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559567121","product_id":100006701,"comment_content":"è¿™ç« æ¯”è¾ƒéš¾ï¼Œæºç çš„ç²¾é«“éƒ¨åˆ†ä¹Ÿæ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œéœ€è¦ä¹‹åè¡¥ä¸Š","like_count":0},{"had_liked":false,"id":100343,"user_name":"å› ç¼ºæ€å…","can_delete":false,"product_type":"c1","uid":1517365,"ip_address":"","ucode":"2B1D9E9CD8784A","user_header":"https://static001.geekbang.org/account/avatar/00/17/27/35/ba972e11.jpg","comment_is_top":false,"comment_ctime":1559531646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559531646","product_id":100006701,"comment_content":"casï¼Œunsaveæ˜¯åŸºç¡€çŸ¥è¯†ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":94358,"user_name":"å¼ èŒvv","can_delete":false,"product_type":"c1","uid":1300801,"ip_address":"","ucode":"68D8A914564309","user_header":"https://static001.geekbang.org/account/avatar/00/13/d9/41/3b698d03.jpg","comment_is_top":false,"comment_ctime":1557795742,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557795742","product_id":100006701,"comment_content":"æ€§èƒ½æµ‹è¯•å°å·¥å…·ï¼Œmä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹å­˜å‚¨åœ¨concurrenthashmapé‡Œçš„nä¸ªèµ„æºï¼Œè°ƒæ•´mï¼Œç»˜åˆ¶æ¶ˆè´¹å®Œnä¸ªèµ„æºçš„æ€§èƒ½æ›²çº¿å›¾","like_count":0},{"had_liked":false,"id":85700,"user_name":"æµæ²™å’Œå°èƒ–å‡ ","can_delete":false,"product_type":"c1","uid":1170612,"ip_address":"","ucode":"6C74B1F8478465","user_header":"","comment_is_top":false,"comment_ctime":1555206334,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555206334","product_id":100006701,"comment_content":"å¦‚æœä¸€è®²çš„å†…å®¹æœ‰ç›¸å…³è”çš„çŸ¥è¯†æ¨¡å—ï¼Œå¯ä»¥åœ¨æ–‡å°¾åŠ ä¸Šå…³è”ç« èŠ‚çš„é“¾æ¥è¯¶ï¼Œè¿™æ ·æ›´ç¬¦åˆæˆ‘ä»¬å­¦ä¹ è½¨è¿¹å§","like_count":0},{"had_liked":false,"id":84633,"user_name":"MIAN-å‹‰","can_delete":false,"product_type":"c1","uid":1123554,"ip_address":"","ucode":"AE938038C2E7D1","user_header":"https://static001.geekbang.org/account/avatar/00/11/24/e2/e5110db5.jpg","comment_is_top":false,"comment_ctime":1554888004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554888004","product_id":100006701,"comment_content":"æƒ³é—®ä¸€ä¸‹è€å¸ˆï¼Œä½¿ç”¨åˆ†æ®µé”å®ç°çš„ConcurrentHashMapï¼Œæœ‰æ²¡æœ‰å¯èƒ½å‘ç”Ÿæ­»é”","like_count":0},{"had_liked":false,"id":77748,"user_name":"Ellie","can_delete":false,"product_type":"c1","uid":1402056,"ip_address":"","ucode":"DCF2FDD56F8F74","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJRmN2LQ0g82HwAGkcgO1mL1Pta4RuAWicoKdWc5cqoDFiarBShF09XElzI7mNNJeEtOl4oCL6K1sibg/132","comment_is_top":false,"comment_ctime":1552991900,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552991900","product_id":100006701,"comment_content":"åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä½¿ç”¨synchronizedè¿˜æ˜¯æ— æ³•å®ç°åŒæ­¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"ä¸‹ä¸ªç›®æ ‡45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336553,"discussion_content":"synchronizedæ˜¯jvmçº§åˆ«çš„é”æ€ä¹ˆå»é”å…¶ä»–jvmè¿›ç¨‹çš„ä¸œè¥¿å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608623731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74630,"user_name":"åˆ˜èƒœ","can_delete":false,"product_type":"c1","uid":1251625,"ip_address":"","ucode":"487374D72543E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/19/29/f9490983.jpg","comment_is_top":false,"comment_ctime":1552269738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552269738","product_id":100006701,"comment_content":"concurrenthashmapç”¨æ¥æé«˜æ•ˆç‡çš„ï¼Œå…·ä½“ä»£ç çœ‹èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„å¯¹äºæˆ‘æ˜¯è¿™æ ·ã€‚","like_count":0},{"had_liked":false,"id":54871,"user_name":"Aitozi","can_delete":false,"product_type":"c1","uid":1118091,"ip_address":"","ucode":"B8096312BAD560","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/8b/25d118be.jpg","comment_is_top":false,"comment_ctime":1545973669,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545973669","product_id":100006701,"comment_content":"ç°ä»£ JDK ä¸­ï¼Œsynchronized å·²ç»è¢«ä¸æ–­ä¼˜åŒ–ï¼Œå¯ä»¥ä¸å†è¿‡åˆ†æ‹…å¿ƒæ€§èƒ½å·®å¼‚ï¼Œå¦å¤–ï¼Œç›¸æ¯”äº ReentrantLockï¼Œå®ƒå¯ä»¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ã€‚    ä¸ºä»€ä¹ˆè¿™ä¸ªä¼šæœ‰å†…å­˜æ¶ˆè€—çš„ä¼˜åŠ¿å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1099288,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/18/2a9c0ff6.jpg","nickname":"å­éé±¼","note":"","ucode":"9D351A6EC8A4B6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557784,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647959619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50021,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1544842559,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544842559","product_id":100006701,"comment_content":"å—¯ï¼Œæˆ‘çš„ç†è§£å¹¶å‘å·¥å…·åŒ…ä¸­çš„å¹¶å‘å¤„ç†ç±»å’Œä¼ ç»Ÿçš„çº¿ç¨‹å®‰å…¨å®¹å™¨ç›¸æ¯”ï¼Œåœ¨äºåŠ é”çš„ç²’åº¦çš„æ›´åŠ ç²¾ç»†åŒ–äº†ï¼Œæ¯”å¦‚ï¼šHashTableâ€”â€”å…¨æ®µåŠ é”ï¼ŒConcurrentHashMapâ€”â€”åˆ†æ®µåŠ é”ï¼Œæ®µå†…åŒæ­¥ï¼Œæ®µé—´å¼‚æ­¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥æé«˜æ€§èƒ½ï¼Œä¸çŸ¥é“å…¶ä»–çš„å¹¶å‘å®¹å™¨ç±»æ˜¯å¦è¿˜æ˜¯é€šè¿‡è¿™ç§æ€è·¯æ¥ä¿è¯çº¿ç¨‹å®‰å…¨å’Œå…¼é¡¾æ€§èƒ½çš„æé«˜çš„ã€‚<br>æœ‰å‡ ç‚¹å°ç»†èŠ‚è¯·æ•™ä¸€ä¸‹ï¼š<br>1ï¼šconcurrentcyLevel javaéœ€è¦å®ƒæ˜¯2çš„å¹‚æ•°å€¼ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿè®¡ç®—keyçš„æ¡¶ä½å—ï¼Ÿ<br>2ï¼šé‡å¤æ‰«æã€æ£€æµ‹å†²çªæ˜¯ ConcurrentHashMap çš„å¸¸è§æŠ€å·§ï¼Ÿè¿™ä¸ªæ²¡æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚æœæ˜¯æ®µå†…çœ‹kayæ˜¯å¦å†²çªï¼Œä¸æ˜¯æ‰€æœ‰çš„Mapéƒ½æœ‰çš„åŠ¨ä½œå—ï¼Ÿ<br>çº¿ç¨‹å®‰å…¨çš„ä¿è¯å¬çš„æœ€å¤šçš„å°±æ˜¯åŠ é”çš„æœºåˆ¶äº†ï¼Œä¸è¿‡é”è¿™ä¸ªä¸œè¥¿ä¸€ç›´æ²¡æœ‰å®Œå…¨å¼„æ˜ç™½ï¼Œä»–åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿå°±æ˜¯ä¸€ç§ä¿è¯çº¿ç¨‹å®‰å…¨çš„æœºåˆ¶çš„ç®€ç§°å—ï¼Ÿé”ï¼Œå­˜åœ¨å„ç§å„æ ·çš„ï¼Œèƒ½å¦é€šä¿—çš„è®²è§£ä¸€ä¸‹ï¼Œä»–ä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šåˆ†ç±»ï¼Ÿæ„Ÿè§‰è¿™äº›ä¸œè¥¿å¥½ç»•ï¼Œå¹¿ä¹‰ä¸Šè®²CASæ˜¯å¦ä¹Ÿæ˜¯ä¸€ç§é”çš„å®ç°æ€è·¯ï¼Œè€Œä¸æ˜¯ä»€ä¹ˆä¸åŠ é”çš„åŒæ­¥å®ç°æ–¹å¼ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1541386,"avatar":"https://static001.geekbang.org/account/avatar/00/17/85/0a/e564e572.jpg","nickname":"N_H","note":"","ucode":"109B67557AB3CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2034,"discussion_content":"å…¶å®å¯ä»¥å–æ·±å…¥çš„çœ‹çœ‹æ“ä½œç³»ç»Ÿï¼Œé”çš„åº•å±‚åº”è¯¥ç±»ä¼¼äºæŠŠå†…å­˜éš”ç¦»èµ·æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563192514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43823,"user_name":"è§è§","can_delete":false,"product_type":"c1","uid":1120579,"ip_address":"","ucode":"9F1F69C390576D","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/43/51154077.jpg","comment_is_top":false,"comment_ctime":1543304361,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543304361","product_id":100006701,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸‹ï¼Œ addCount(1L, binCount) è¿™ä¸ªå‡½æ•°ä¸­ï¼Œ æœ‰ä¸€æ®µä»£ç æ²¡æœ‰å®Œå…¨ç†è§£<br><br> if (sc &lt; 0) {<br>            if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||<br>                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||<br>                    transferIndex &lt;= 0)<br>                break;<br><br>å…¶ä¸­ï¼Œ æœ‰ä¸¤ä¸ªæ¡ä»¶  sc == rs + 1 ||  sc == rs + MAX_RESIZERS çœ‹èµ·æ¥æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²ç»æ²¡æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œæ‰©å®¹ ä»¥åŠ  æ˜¯å¦å¹¶å‘æ‰©å®¹çš„çº¿ç¨‹æ˜¯å¦å·²è¾¾ä¸Šé™ã€‚ <br><br>ä½†æ˜¯é¦–ä¸ªæ‰©å®¹çº¿ç¨‹è¿›å…¥ transfer å‡½æ•°ä¹‹å‰ï¼Œ æ˜¯é€šè¿‡  <br>U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2) <br>æ“ä½œå°† sizeCtl å˜æˆè´Ÿå€¼çš„ ã€‚ <br><br>æŒ‰ç†æ¥è¯´ å½“ sizeCtl ä¸ºè´Ÿæ—¶ï¼Œ  åº”å½“ä½¿ç”¨ sc  ==  ( rs&lt;&lt;&lt;RESIZE_STAMP_SHIFT ) +1 å’Œ <br>sc  ==  ( rs&lt;&lt;&lt;RESIZE_STAMP_SHIFT ) + MAX_RESIZERS æ¥åˆ¤æ–­æ‰å¯¹<br><br>æ­¤å¤„ç–‘ä¼¼ JDK çš„ä¸€ä¸ª bug , å¸Œæœ›è€å¸ˆå¯ä»¥å¸®åŠ©æŒ‡ç‚¹","like_count":0,"discussions":[{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207779,"discussion_content":"æ„Ÿè§‰ä½ è¿™æ˜¯å¤åˆ¶çš„åˆ«äººçš„ä¸œè¥¿ï¼Œjavaä¸­æ²¡æœ‰ <<< ï¼Œä¸è¿‡è¿™æ®µå†…å®¹æ²¡é—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªBUGï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584513777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17595,"user_name":"tim","can_delete":false,"product_type":"c1","uid":1101698,"ip_address":"","ucode":"181FF04B823DBD","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/82/a3ea8076.jpg","comment_is_top":false,"comment_ctime":1532766618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1532766618","product_id":100006701,"comment_content":"syncMap è¿˜æ˜¯æœ‰æ”¹è¿›çš„ï¼Œèµ·ç åŠ äº†synchronized ä¸ä¼šå¯¼è‡´æ‰©å®¹æ­»é”","like_count":0},{"had_liked":false,"id":11214,"user_name":"é²²é¹é£ä¹ä¸‡é‡Œ","can_delete":false,"product_type":"c1","uid":1093920,"ip_address":"","ucode":"82BD0C789DF612","user_header":"https://static001.geekbang.org/account/avatar/00/10/b1/20/8718252f.jpg","comment_is_top":false,"comment_ctime":1527944142,"is_pvip":false,"replies":[{"id":"3593","content":"å—¯...å“ªå‡ ä¸ªï¼Ÿå›å¤´æ ¹æ®åé¦ˆè¡¥å……ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527986630,"ip_address":"","comment_id":11214,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527944142","product_id":100006701,"comment_content":"å¥½å‡ ä¸ªè¯æ„Ÿè§‰ç¬¬ä¸€æ¬¡è§ï¼Œå¤§å“­ğŸ˜¹","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418756,"discussion_content":"å—¯...å“ªå‡ ä¸ªï¼Ÿå›å¤´æ ¹æ®åé¦ˆè¡¥å……ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527986630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11049,"user_name":"ç‰›åœ¨å¤©ä¸Šé£","can_delete":false,"product_type":"c1","uid":1137660,"ip_address":"","ucode":"972DAF20F085ED","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/fc/5c24080b.jpg","comment_is_top":false,"comment_ctime":1527814295,"is_pvip":false,"replies":[{"id":"3529","content":"é©¬ä¸Šå°±æœ‰ç« èŠ‚ä»‹ç»äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527839750,"ip_address":"","comment_id":11049,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527814295","product_id":100006701,"comment_content":"è€å¸ˆèƒ½è§£é‡Šä¸‹å¯é‡å…¥é”å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418690,"discussion_content":"é©¬ä¸Šå°±æœ‰ç« èŠ‚ä»‹ç»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527839750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10938,"user_name":"Miaozhe","can_delete":false,"product_type":"c1","uid":1113660,"ip_address":"","ucode":"62872E8C138B67","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/3c/13175251.jpg","comment_is_top":false,"comment_ctime":1527749862,"is_pvip":false,"replies":[{"id":"3464","content":"é‚£ä¸ªæ˜¯Runtime.availableProcessors","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527761103,"ip_address":"","comment_id":10938,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527749862","product_id":100006701,"comment_content":"æ¨è€å¸ˆï¼Œçœ‹åˆ°ConcurrentHashMapä¸­æœ‰å®šä¹‰N CPU,æƒ³é—®é—®è·ŸCPUä»€ä¹ˆå…³ç³»ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418652,"discussion_content":"é‚£ä¸ªæ˜¯Runtime.availableProcessors","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527761103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10710,"user_name":"George","can_delete":false,"product_type":"c1","uid":1103468,"ip_address":"","ucode":"6BD24945AC8253","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/6c/874ca8ad.jpg","comment_is_top":false,"comment_ctime":1527663262,"is_pvip":false,"replies":[{"id":"3423","content":"JDKå†…éƒ¨çš„ä¸€ä¸ªåŸºç¡€ç±»sun.misc.Unsafeï¼Œå¦‚æœå…¬å…±apièƒ½è§£å†³çš„é—®é¢˜ï¼Œä¸å»ºè®®ä½¿ç”¨å®ƒï¼Œå¦‚æœæ˜¯åšåº•å±‚å¼€å‘å¯èƒ½ä¼šç”¨åˆ°","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527695618,"ip_address":"","comment_id":10710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527663262","product_id":100006701,"comment_content":"æ–‡ä¸­è¯´çš„UNSAFEæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418572,"discussion_content":"JDKå†…éƒ¨çš„ä¸€ä¸ªåŸºç¡€ç±»sun.misc.Unsafeï¼Œå¦‚æœå…¬å…±apièƒ½è§£å†³çš„é—®é¢˜ï¼Œä¸å»ºè®®ä½¿ç”¨å®ƒï¼Œå¦‚æœæ˜¯åšåº•å±‚å¼€å‘å¯èƒ½ä¼šç”¨åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527695618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10580,"user_name":"Volong","can_delete":false,"product_type":"c1","uid":1111348,"ip_address":"","ucode":"640C825E92D1A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/34/45f022b3.jpg","comment_is_top":false,"comment_ctime":1527603087,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1527603087","product_id":100006701,"comment_content":"ç¬¬ä¸€ä¸ªç¤ºä¾‹ä»£ç æŠ¥è¿™ä¸ªé”™ï¼š&#39;&lt;&gt;&#39; cannot be used with anonymous classes","like_count":0},{"had_liked":false,"id":10316,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1061767,"ip_address":"","ucode":"86F679C62B90AA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epTXXDNFFe90dwTK2s5PxeuYn3MOLvfU6YLQ0uxuf9bXI8dWXgib5LRnOwk1uWiaDHqIGibOKyU4x3CQ/132","comment_is_top":false,"comment_ctime":1527471234,"is_pvip":false,"replies":[{"id":"3243","content":"ä¼šæœ‰ï¼Œæˆ‘ä¹Ÿè®°å½•ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527481445,"ip_address":"","comment_id":10316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527471234","product_id":100006701,"comment_content":"è¯·é—®è€å¸ˆä»¥åä¼šä¸ä¼šæœ‰è®²çº¿ç¨‹ä¸­æ–­çš„ä¸åŒå¤„ç†å‘¢ï¼Ÿè¿™ä¸€å—ä¸€ç›´å¯¹æˆ‘æ¥è®²éƒ½æ¯”è¾ƒæŠ½è±¡è€Œä¸”ä¸å¥½æµ‹è¯•","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418437,"discussion_content":"ä¼šæœ‰ï¼Œæˆ‘ä¹Ÿè®°å½•ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527481445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10311,"user_name":"lorancechen","can_delete":false,"product_type":"c1","uid":1114303,"ip_address":"","ucode":"2A16CFA4726AE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/00/bf/a44cde46.jpg","comment_is_top":false,"comment_ctime":1527470038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1527470038","product_id":100006701,"comment_content":"rpcè°ƒç”¨å†…éƒ¨ï¼Œå®¢æˆ·ç«¯ä¼šè®°å½•æ¯æ¬¡è¯·æ±‚çš„unique idï¼Œç”¨äºåŒ¹é…è¿”å›çš„æ•°æ®åº”è¯¥å“åº”å“ªä¸ªè¯·æ±‚ã€‚é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨concurrenthashmapåšè¿™ç§idåˆ°å›è°ƒçš„è®°å½•ã€‚","like_count":0},{"had_liked":false,"id":10270,"user_name":"èƒ–","can_delete":false,"product_type":"c1","uid":1044068,"ip_address":"","ucode":"0EA8F5343CB4F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/64/2646f6ef.jpg","comment_is_top":false,"comment_ctime":1527432405,"is_pvip":false,"replies":[{"id":"3237","content":"è‡ªå·±åšåŒæ­¥å½“ç„¶ä¹Ÿæ˜¯ä¸ªé€‰æ‹©","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527480476,"ip_address":"","comment_id":10270,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527432405","product_id":100006701,"comment_content":"å¦‚æœå¤šçº¿ç¨‹ä¸­å·²ç»åœ¨ä¸Šå±‚ä»£ç ä½¿ç”¨äº†è¯»å†™é”è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œåº•å±‚é›†åˆæ˜¯å¦å°±å¯ä»¥ä½¿ç”¨HashMapï¼Œè€Œæ²¡æœ‰å¿…è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å®¹å™¨äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418418,"discussion_content":"è‡ªå·±åšåŒæ­¥å½“ç„¶ä¹Ÿæ˜¯ä¸ªé€‰æ‹©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527480476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10192,"user_name":"æå†›","can_delete":false,"product_type":"c1","uid":1046761,"ip_address":"","ucode":"74FE3AF37E74CD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/e9/f25cce9e.jpg","comment_is_top":false,"comment_ctime":1527337328,"is_pvip":true,"replies":[{"id":"3254","content":"éœ€è¦æ›´å…·ä½“ä¸€äº›ï¼Œæ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œæœ‰ç”¨æœºå™¨å­¦ä¹ è°ƒä¼˜jvmè¿è¡Œå‚æ•°çš„ï¼›<br>jvmæ¯”è¾ƒè¿è¡Œåœºæ™¯å¤ªå¤šï¼ŒSEæ—¢å¯ä»¥è·‘åœ¨åµŒå…¥å¼ï¼Œä¹Ÿå¯ä»¥åˆ°é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œç¼©å°èŒƒå›´æ‰å¥½è¿›è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1527484857,"ip_address":"","comment_id":10192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1527337328","product_id":100006701,"comment_content":"å¯ä¸å¯ä»¥ç”¨AIè®©JVMæ›´æ™ºèƒ½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418385,"discussion_content":"éœ€è¦æ›´å…·ä½“ä¸€äº›ï¼Œæ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œæœ‰ç”¨æœºå™¨å­¦ä¹ è°ƒä¼˜jvmè¿è¡Œå‚æ•°çš„ï¼›\njvmæ¯”è¾ƒè¿è¡Œåœºæ™¯å¤ªå¤šï¼ŒSEæ—¢å¯ä»¥è·‘åœ¨åµŒå…¥å¼ï¼Œä¹Ÿå¯ä»¥åˆ°é«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œç¼©å°èŒƒå›´æ‰å¥½è¿›è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527484857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10150,"user_name":"Strom","can_delete":false,"product_type":"c1","uid":1122857,"ip_address":"","ucode":"BBB11E924F157E","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/29/b39e8f01.jpg","comment_is_top":false,"comment_ctime":1527309668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1527309668","product_id":100006701,"comment_content":"æœ‰äº›æœ¬åœ°ç¼“å­˜å°±æ˜¯åŸºäºå®ƒå®ç°çš„ã€‚","like_count":0}]}