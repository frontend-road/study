{"id":91166,"title":"04 | 分布式系统（上）：学会用服务等级协议SLA来评估你的系统","content":"<p>你好，我是蔡元楠。</p><p>从今天开始，我们进入专栏的第二模块。通过这一模块的学习，带你一起夯实大规模数据处理的基础。</p><p>首先，我将结合硅谷顶尖科技公司的<strong>最佳实践</strong> (Best Practice) ，和你一起分享在设计分布式系统架构时，我们有可能会碰到哪些雷区？又有哪些必备的基础知识？</p><p>在硅谷一线大厂所维护的系统服务中，我们经常可以看见SLA这样的承诺。</p><p>例如，在谷歌的云计算服务平台Google Cloud Platform中，他们会写着“99.9% Availability”这样的承诺。那什么是“99.9% Availability”呢？</p><p>要理解这个承诺是什么意思，首先，你需要了解到底什么是SLA？</p><p>SLA（Service-Level Agreement），也就是<strong>服务等级协议</strong>，指的是系统服务提供者（Provider）对客户（Customer）的一个服务承诺。这是衡量一个大型分布式系统是否“健康”的常见方法。</p><p><img src=\"https://static001.geekbang.org/resource/image/77/be/77361f3533c4579bb0d9661af49616be.jpg?wh=1142*640\" alt=\"\"></p><p>在开发设计系统服务的时候，无论面对的客户是公司外部的个人、商业用户，还是公司内的不同业务部门，我们都应该对自己所设计的系统服务有一个定义好的SLA。</p><p>因为SLA是一种服务承诺，所以指标可以多种多样。根据我的实践经验，给你介绍最常见的四个SLA指标，可用性、准确性、系统容量和延迟。</p><!-- [[[read_end]]] --><h2>1. 可用性（Availabilty）</h2><p>可用性指的是系统服务能正常运行所占的时间百分比。</p><p>如果我们搭建了一个拥有“100％可用性”的系统服务，那就意味着这个系统在任何时候都能正常运行。是不是很完美？但真要实现这样的目标其实非常困难，并且成本也会很高。</p><p>我们知道，即便是大名鼎鼎的亚马逊AWS云计算服务这样大型的、对用户来说极为关键的系统，也不能承诺100％的可用性，它的系统服务从推出到现在，也有过服务中断（Service Outage）的时候。</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/1a/a7d6bd2401677aca88c0623aa04d861a.jpg?wh=1920*1440\" alt=\"\"></p><p>对于许多系统而言，四个9的可用性（99.99％ Availability，或每年约50分钟的系统中断时间）即可以被认为是<strong>高可用性</strong>（High availability）。</p><p>说到这里，我来为你揭开一开始所提到的“99.9% Availability”的真实含义。</p><p>“99.9% Availability”指的是一天当中系统服务将会有大约86秒的服务间断期。服务间断也许是因为系统维护，也有可能是因为系统在更新升级系统服务。</p><p>86秒这个数字是怎么算出来的呢？</p><p>99.9%意味着有0.1%的可能性系统服务会被中断，而一天中有24小时 × 60分钟 × 60秒，也就是有(24 × 60 × 60 × 0.001) = 86.4秒的可能系统服务被中断了。而上面所说的四个9的高可用性服务就是承诺可以将一天当中的服务中断时间缩短到只有(24 × 60 × 60 × 0.0001) = 8.64秒。</p><h2>2. 准确性（Accuracy）</h2><p>准确性指的是我们所设计的系统服务中，是否允许某些数据是不准确的或者是丢失了的。如果允许这样的情况发生，用户可以接受的概率（百分比）是多少？</p><p>这该怎么衡量呢？不同的系统平台可能会用不同的指标去定义准确性。很多时候，系统架构会以<strong>错误率</strong>（Error Rate）来定义这一项SLA。</p><p>怎么计算错误率呢？可以用导致系统产生内部错误（Internal Error）的有效请求数，除以这期间的有效请求总数。</p><p><img src=\"https://static001.geekbang.org/resource/image/16/26/16c92cc68b462d469fb535aaa08b8d26.jpg?wh=1762*432\" alt=\"\"></p><p>例如，我们在一分钟内发送100个有效请求到系统中，其中有5个请求导致系统返回内部错误，那我们可以说这一分钟系统的错误率是 5 / 100 = 5%。</p><p>下面，我想带你看看硅谷一线公司所搭建的架构平台的准确性SLA。</p><p>Google Cloud Platform的SLA中，有着这样的准确性定义：每个月系统的错误率超过5%的时间要少于0.1%，以每分钟为单位来计算。</p><p>而亚马逊AWS云计算平台有着稍微不一样的准确性定义：以每5分钟为单位，错误率不会超过0.1%。</p><p>你看，我们可以用错误率来定义准确性，但具体该如何评估系统的准确性呢？一般来说，我们可以采用<strong>性能测试</strong>（Performance Test）或者是<strong>查看系统日志</strong>（Log）两种方法来评估。</p><p>具体的做法我会在后面展开讲解，今天你先理解这项指标就可以了。</p><h2>3. 系统容量（Capacity）</h2><p>在数据处理中，系统容量通常指的是<strong>系统能够支持的预期负载量是多少</strong>，一般会以每秒的请求数为单位来表示。</p><p>我们常常可以看见，某个系统的架构可以处理的QPS （Queries Per Second）是多少又或者RPS（Requests Per Second）是多少。这里的QPS或者是RPS就是指系统每秒可以响应多少请求数。</p><p>我们来看看之前Twitter发布的一项数据，Twitter系统可以响应30万的QPS来读取Twitter Timelines。这里Twitter系统给出的就是他们对于系统容量（Capacity）的SLA。</p><p>你可能会问，我要怎么给自己设计的系统架构定义出准确的QPS呢？以我的经验看，可以有下面这几种方式。</p><p>第一种，是使用<strong>限流</strong>（Throttling）的方式。</p><p>如果你是使用Java语言进行编程的，就可以使用Google Guava库中的RateLimiter类来定义每秒最多发送多少请求到后台处理。</p><p>假设我们在每台服务器都定义了一个每秒最多处理1000个请求的RateLimiter，而我们有N台服务器，在最理想的情况下，我们的QPS可以达到1000 * N。</p><p>这里要注意的雷区是，这个请求数并不是设置得越多越好。因为每台服务器的内存有限，过多的请求堆积在服务器中有可能会导致<strong>内存溢出</strong>（Out-Of-Memory）的异常发生，也就是所有请求所需要占用的内存超过了服务器能提供的内存，从而让整个服务器崩溃。</p><p>第二种，是在系统交付前进行<strong>性能测试</strong>（Performance Test）。</p><p>我们可以使用像Apache JMeter又或是LoadRunner这类型的工具对系统进行性能测试。这类工具可以测试出系统在峰值状态下可以应对的QPS是多少。</p><p>当然了，这里也是有雷区的。</p><p>有的开发者可能使用同一类型的请求参数，导致后台服务器在多数情况下<strong>命中缓存</strong>（Cache Hit）。这个时候得到的QPS可能并不是真实的QPS。</p><p>打个比方，服务器处理请求的正常流程需要查询后台数据库，得到数据库结果后再返回给用户，这个过程平均需要1秒。在第一次拿到数据库结果后，这个数据就会被保存在缓存中，而如果后续的请求都使用同一类型的参数，导致结果不需要从数据库得到，而是直接从缓存中得到，这个过程我们假设只需要0.1秒。那这样，我们所计算出来的QPS就会比正常的高出10倍。所以在生成请求的时候，要格外注意这一点。</p><p>第三种，是分析系统在实际使用时产生的<strong>日志</strong>（Log）。</p><p>系统上线使用后，我们可以得到日志文件。一般的日志文件会记录每个时刻产生的请求。我们可以通过系统每天在最繁忙时刻所接收到的请求数，来计算出系统可以承载的QPS。</p><p>不过，这种方法不一定可以得到系统可以承载的最大QPS。</p><p>在这里打个比喻，一家可以容纳上百桌客人的餐馆刚开业，因为客流量还比较小，在每天最繁忙的时候只接待了10桌客人。那我们可以说这家餐馆最多只能接待10桌客人吗？不可以。</p><p>同样的，以分析系统日志的方法计算出来的QPS并不一定是服务器能够承载的最大QPS。想要得到系统能承受的最大QPS，更多的是性能测试和日志分析相结合的手段。</p><h2>4. 延迟（Latency）</h2><p>延迟指的是<strong>系统在收到用户的请求到响应这个请求之间的时间间隔</strong>。</p><p>在定义延迟的SLA时，我们常常看到系统的SLA会有p95或者是p99这样的延迟声明。这里的p指的是percentile，也就是百分位的意思。如果说一个系统的p95 延迟是1秒的话，那就表示在100个请求里面有95个请求的响应时间会少于1秒，而剩下的5个请求响应时间会大于1秒。</p><p>下面我们用一个具体的例子来说明延迟这项指标在SLA中的重要性。</p><p>假设，我们已经设计好了一个社交软件的系统架构。这个社交软件在接收到用户的请求之后，需要读取数据库中的内容返回给用户。</p><p>为了降低系统的延迟，我们会将数据库中内容放进缓存（Cache）中，以此来减少数据库的读取时间。在系统运行了一段时间后，我们得到了一些缓存命中率（Cache Hit Ratio）的信息。有90%的请求命中了缓存，而剩下的10%的请求则需要重新从数据库中读取内容。</p><p>这时服务器所给我们的p95或者p99延迟恰恰就衡量了系统的最长时间，也就是从数据库中读取内容的时间。作为一个优秀架构师，你可以通过改进缓存策略从而提高缓存命中率，也可以通过优化数据库的Schema或者索引（Index）来降低p95或p99 延迟。</p><p>总而言之，当p95或者p99过高时，总会有5%或者1%的用户抱怨产品的用户体验太差，这都是我们要通过优化系统来避免的。</p><h2>小结</h2><p>通过今天的内容，你可以发现，定义好一个系统架构的SLA对于一个优秀的架构师来说是必不可少的一项技能，也是一种基本素养。</p><p>特别是<span class=\"orange\">当系统架构在不停迭代的时候，有了一个明确的SLA，我们可以知道下一代系统架构的改进目标以及优化好的系统架构是否比上一代的系统SLA更加优秀</span>。</p><p>我们通常会使用可用性、准确性、系统容量、延迟这四个指标来定义系统架构的SLA。</p><h2>思考题</h2><p>你可以思考一下，在自己所在的开发项目中，系统的SLA是什么呢？又有什么方面可以优化的呢？</p><p>欢迎你把答案写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><p></p>","neighbors":{"left":{"article_title":"03 | 大规模数据处理初体验：怎样实现大型电商热销榜？","id":91125},"right":{"article_title":"05 | 分布式系统（下）：架构师不得不知的三大指标","id":91647}},"comments":[{"had_liked":false,"id":89027,"user_name":"Joseph","can_delete":false,"product_type":"c1","uid":1287626,"ip_address":"","ucode":"B7FCC0D75561E2","user_header":"http://thirdwx.qlogo.cn/mmopen/PiajxSqBRaEKCTAPGcRSicRNXwftZAe1MEwUwicXsPTltc3z2liak2VicdhWx7jAasZWr0SiciaoOEueX0zWEWpiaZVickEZvNx9DlfjriaAKOmaf5X6Q/132","comment_is_top":false,"comment_ctime":1556067086,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"207714497294","product_id":100025301,"comment_content":"在实际应用SLA的时候，有两点不解：<br>1. 在设计系统之初，大家拍脑袋来定义SLA。这个时期，SLA对应需要付出的成本还不明确，这样大家都会趋于订出很高标准。这种情况有好的解决办法吗？<br>2. 虽然定义了SLA，但在架构设计的时候，如何评估架构是否能满足SLA呢？等到软件实现了再来测试，似乎有点太晚了……请教老师一般是如何处理这两个问题的呢？","like_count":49,"discussions":[{"author":{"id":1145157,"avatar":"https://static001.geekbang.org/account/avatar/00/11/79/45/05a88185.jpg","nickname":"住羽光","note":"","ucode":"11E48DEB421D9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3151,"discussion_content":"可以SLA 与 所需的人力资源挂钩起来，让大家了解越高的SLA意味着越高的成本。比如99.9%的SLA，需要20人3个月的工作量，但是99.99%的SLA，就需要50人3年的工作量。让同事能够了解高SLA的成本，这样大家做选择的时候就会趋于理性。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1564228617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89972,"user_name":"Dany","can_delete":false,"product_type":"c1","uid":1289852,"ip_address":"","ucode":"AC92B9B5D541CE","user_header":"https://static001.geekbang.org/account/avatar/00/13/ae/7c/251fc690.jpg","comment_is_top":false,"comment_ctime":1556351928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"104635567032","product_id":100025301,"comment_content":"我觉得这一节超赞。基础概念很重要，很重要，很重要。<br>实战这种事情，有的是时间去practice，而SLA这几个关键概念，会成为很多人理解的迷雾。<br>当我发现我的lead，拉着一大堆自己也还没理解清楚SLA指标去拉KPI，扛大旗的时候，我才进一步，深刻体会到这一节内容的重要性^ ^","like_count":25},{"had_liked":false,"id":88979,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1556041436,"is_pvip":false,"replies":[{"id":"31989","content":"谢谢你的建议！我在第10和第11讲里有根据所讲的基础知识展开介绍两种实战中的经典架构，也配合了一些硅谷这边的应用实例作讲解，希望能对你有所帮助。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556152126,"ip_address":"","comment_id":88979,"utype":1}],"discussion_count":1,"race_medal":0,"score":"87455387356","product_id":100025301,"comment_content":"作为一个学习大数据的新手，希望作者能用几篇文章讲解大数据处理中使用的技术如何搭建，运行，优化的，以及各个技术如何结合使用，这样新手也能玩起来","like_count":20,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447969,"discussion_content":"谢谢你的建议！我在第10和第11讲里有根据所讲的基础知识展开介绍两种实战中的经典架构，也配合了一些硅谷这边的应用实例作讲解，希望能对你有所帮助。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556152126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89079,"user_name":"sxpujs","can_delete":false,"product_type":"c1","uid":1503861,"ip_address":"","ucode":"F81931EC883D7C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/yYzf0yonEqKny7dHlvLibc7OrQJ6HszX3VP1fciaMD3hITFySbayL9vULch5hvicoqGA2EBzcPicss2ciaB7ibodgQ6w/132","comment_is_top":false,"comment_ctime":1556072394,"is_pvip":false,"replies":[{"id":"31983","content":"这都是后面马上要用到的知识。不可能纯狠操猛干而没有知识支撑的。","user_name":"作者回复","user_name_real":"Yuannan蔡元楠","uid":"1257426","ctime":1556145839,"ip_address":"","comment_id":89079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"83160451018","product_id":100025301,"comment_content":"这几节干货有点少啊，也缺少一些实战和实例。","like_count":20,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannan蔡元楠","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448006,"discussion_content":"这都是后面马上要用到的知识。不可能纯狠操猛干而没有知识支撑的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556145839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89007,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1556064254,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"57390639102","product_id":100025301,"comment_content":"这个SLA和一般服务监控指标 RED 原则有点像<br>R rate 请求速率 qps<br>E errors 错误数错误率<br>D duration 延迟 <br>再加一个 服务可用性指标等级 就是今天讲的服务等级了","like_count":13},{"had_liked":false,"id":89363,"user_name":"孙稚昊","can_delete":false,"product_type":"c1","uid":1010660,"ip_address":"","ucode":"44283BA4A577B6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/e4/afacba1c.jpg","comment_is_top":false,"comment_ctime":1556158897,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40210864561","product_id":100025301,"comment_content":"我们公司为了高并发QPS, 以前的python server 全部换成 Golang 了，Golang 做高并发是真的有优势","like_count":10},{"had_liked":false,"id":88991,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1556061803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31620832875","product_id":100025301,"comment_content":"我们系统一般可用性，系统容量有做定义也多在招投标的文件中，至于准确性和延迟更没有严格测试，准确性这个我觉得不好测试吧，如果知道出错了，干嘛不修改那，老师业界硅谷大厂如何测试准确性那？","like_count":7},{"had_liked":false,"id":89103,"user_name":"zhihai.tu","can_delete":false,"product_type":"c1","uid":1045888,"ip_address":"","ucode":"61371EA3EF6988","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/80/baddf03b.jpg","comment_is_top":false,"comment_ctime":1556077293,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"23030913773","product_id":100025301,"comment_content":"在银行做大数据平台的研发工作，也从可用性、准确性、系统容量、延迟四个指标来谈谈SLA，理解的不是很深，如有错误和不妥，请老师指导和更正：<br>1、可用性：不管是hadoop还是mppdb，数据库本身提供了本地高可用，另外，采用了双园区主备设计，提供了园区自动切换服务，保证了园区之间的高可用。<br>2、准确性：流数据处理平台，存在数据丢失的可能性。具体百分比应该是小于5%的。<br>3、系统容量：采用限流的方式，通过参数设置，从而控制最大的并发数量。<br>4、延迟：hadoop平台由于延迟较高，设计了异步处理请求及多线程技术，提高用户体验。","like_count":5},{"had_liked":false,"id":162495,"user_name":"何妨","can_delete":false,"product_type":"c1","uid":1385377,"ip_address":"","ucode":"EC3983BFF7992A","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","comment_is_top":false,"comment_ctime":1576545883,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18756415067","product_id":100025301,"comment_content":"记笔记:<br>定义SLA的四个维度<br>可用性:4个9，1日8秒<br>准确性:容错标准<br>系统容量:QPS,RPS<br>延迟:p95,p99<br>","like_count":4},{"had_liked":false,"id":89186,"user_name":"Tomcat","can_delete":false,"product_type":"c1","uid":1346364,"ip_address":"","ucode":"B270CEED693256","user_header":"https://static001.geekbang.org/account/avatar/00/14/8b/3c/0462eca7.jpg","comment_is_top":false,"comment_ctime":1556100614,"is_pvip":false,"replies":[{"id":"31982","content":"谢谢你的经验之谈！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556142637,"ip_address":"","comment_id":89186,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18735969798","product_id":100025301,"comment_content":"SLA，即服务等级协议，规定了我们的工程的质量和目标，这使得我们的工作具有可衡量的尺度。<br>以前我在中国移动做专线提供服务的时候，对这个颇为敏感，移动的专线产品，确实有许多不足之处，但是这让我构建了服务质量可以使用具体技术指标度量的理念。<br>对于现在我正在做的产品，同样也有一些苛刻的要求，所以通过本文，我构建了服务质量度量体系～","like_count":4,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448046,"discussion_content":"谢谢你的经验之谈！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556142637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89090,"user_name":"hufox","can_delete":false,"product_type":"c1","uid":1022874,"ip_address":"","ucode":"94675994D8EE16","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/9a/dcb2b713.jpg","comment_is_top":false,"comment_ctime":1556074767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14440976655","product_id":100025301,"comment_content":"今天学到了什么SLA，请问老师，大数据平台中缓存的设计重要吗？一般如何设计？希望老师后面能讲讲新手如何搭建一个大数据平台，把整个流程运行起来，帮助更好的理解大数据处理流程！","like_count":3},{"had_liked":false,"id":88993,"user_name":"wmg","can_delete":false,"product_type":"c1","uid":1070036,"ip_address":"","ucode":"BA4CED171B59E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/d4/2ed767ea.jpg","comment_is_top":false,"comment_ctime":1556062069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10145996661","product_id":100025301,"comment_content":"老师我的理解SLA更适用于衡量oltp系统，和大数据处理系统有哪些联系呢？我的理解可能有误，老师指教","like_count":2},{"had_liked":false,"id":114532,"user_name":"leesper","can_delete":false,"product_type":"c1","uid":1351104,"ip_address":"","ucode":"CC76320571BECA","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/c0/cb5341ec.jpg","comment_is_top":false,"comment_ctime":1563330222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858297518","product_id":100025301,"comment_content":"“当 p95 或者 p99 过高时，总会有 5% 或者 1%的用户抱怨产品的用户体验太差”，这个不可小视，因为很可能这1%或者5%用户就是很资深的用户，比如他&#47;她在这个平台上买过很多东西所以响应慢，这个一定要做优化","like_count":1},{"had_liked":false,"id":96738,"user_name":"滨 风暴","can_delete":false,"product_type":"c1","uid":1147065,"ip_address":"","ucode":"D4CB6FCF08B0E3","user_header":"https://static001.geekbang.org/account/avatar/00/11/80/b9/e2fbe96c.jpg","comment_is_top":false,"comment_ctime":1558495043,"is_pvip":false,"replies":[{"id":"48358","content":"的确如此","user_name":"作者回复","user_name_real":"Yuannan蔡元楠","uid":"1257426","ctime":1567212444,"ip_address":"","comment_id":96738,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853462339","product_id":100025301,"comment_content":"我的理解是为了提高SLA，系统就要达到一定的冗余度，对于大数据来说存储和计算使用的资源就更多，所以定义SLA的时候，是不是还是要考虑一下成本，或者有没有提供高SLA的轻量化系统架构？","like_count":1,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannan蔡元楠","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450997,"discussion_content":"的确如此","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567212444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95326,"user_name":"Blakemmmm","can_delete":false,"product_type":"c1","uid":1006809,"ip_address":"","ucode":"2C0BE4465D1B43","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/d9/dc6bd5d4.jpg","comment_is_top":false,"comment_ctime":1558019650,"is_pvip":false,"replies":[{"id":"34210","content":"谢谢你的提问！可用性数据一般都需要系统运行一段时间的，无论是内测也好，还是其他方式也好。如果用户量没有这么大的话，可能需要自己写Prober去模拟一些常用操作去做测试。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1558129756,"ip_address":"","comment_id":95326,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852986946","product_id":100025301,"comment_content":"请问老师可用性的数据一般是如何测出或算出的呢？内部测试时不可能测试那么长时间，而短时间的测试又无法反应随着运行时间增长导致的系统更容易出问题的概率。","like_count":1,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450413,"discussion_content":"谢谢你的提问！可用性数据一般都需要系统运行一段时间的，无论是内测也好，还是其他方式也好。如果用户量没有这么大的话，可能需要自己写Prober去模拟一些常用操作去做测试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558129756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89096,"user_name":"vic5210jp","can_delete":false,"product_type":"c1","uid":1178302,"ip_address":"","ucode":"29753FB672B97C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/be/0aef4c98.jpg","comment_is_top":false,"comment_ctime":1556076360,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5851043656","product_id":100025301,"comment_content":"有4个问题不太明白，希望可以交流一下。<br>1.系统容量和延迟可以理解为吞吐量和响应速度么？<br>2.不同的业务访问的数据量不同，因而延迟也有所不同，用p95或者是p99这样描述整个系统的延迟是否不太准确。<br>3.除了介绍的SLA服务等级协议，系统的扩展性和复杂度等这些是否也应该被纳入一个系统的评价标准中。<br>4.在高可用中，99.99%这种在系统上线前是如何测试得出的？一般我们是根据运行一段时间的情况来预估的，其实并不准确。","like_count":1},{"had_liked":false,"id":346790,"user_name":"再见理想","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1653439778,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653439778","product_id":100025301,"comment_content":"服务等级协议（SLA）指标： <br>可用性 高可用系统需要达到3个9 甚至4个9的服务可用性<br>准确性 数据一致性<br>系统容量 系统能承受的最大负载 可以用限流、性能优化等方式提升<br>延迟 可以使用缓存技术缓解","like_count":0},{"had_liked":false,"id":340669,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1649037348,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649037348","product_id":100025301,"comment_content":"老师同学好，关于文中的可用性，这个是怎么统计出来的？<br><br>有个问题，比如，一个很简单的系统网站，单体架构，在对外提供访问的一年里都很稳定，说可用性100%，不合适吧，可用性如何衡量呢？","like_count":0},{"had_liked":false,"id":312685,"user_name":"高景洋","can_delete":false,"product_type":"c1","uid":2717072,"ip_address":"","ucode":"532188513579E4","user_header":"","comment_is_top":false,"comment_ctime":1631942169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631942169","product_id":100025301,"comment_content":"对我们的系统而言，我觉得 1、覆盖率、2、更新频率 尤为重要。<br><br>1、业务方侧数据量1100W+<br>2、我们会有同步程序，将业务方侧的新数据及状态变化的数据，同步到我们的全量库（hbase）中。因为只有业务侧的数据，在我们的全量库中，数据才会参与其他信息的补充。补充信息后的数据才会参与下游的数据流转。<br>3、因为有脏数据的问题，入库前会做过滤。当前千万级的数据每天会有3000-4000条，因为脏数据问题覆盖不到，未覆盖率 0.03% - 0.04%<br>4、这个未覆盖指标 对我们尤为重要，假如这个指标超过0.1%。 就意味着，脏数据比例变高，有环节出现问题，需要让业务侧排查处理<br><br>-------------<br>5、业务侧的数据进到我们的全量库后，我们会对数据的其他信息做补充。<br>6、例：千万级的数据，我们需要半小时内补充完数据，进入下游的数据流转。<br>7、这个半小时，也是我们的一个指标。 类似课程里说的 第四点：延时。只不过课程里说的是，单个请求的延时，而我们这个指标是 数据批量处理的频率时间","like_count":0},{"had_liked":false,"id":266990,"user_name":"Phantom01","can_delete":false,"product_type":"c1","uid":1140424,"ip_address":"","ucode":"9FA50D3B0A06DB","user_header":"https://static001.geekbang.org/account/avatar/00/11/66/c8/f598a816.jpg","comment_is_top":false,"comment_ctime":1607564397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607564397","product_id":100025301,"comment_content":"是只有服务才有sla吗？软件会有sla吗？ 比如 hadoop，我们可以有吞吐量(iops)，单机容量，资源利用率。但是像可用性和错误率就不好定义。","like_count":0},{"had_liked":false,"id":259366,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1604713867,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1604713867","product_id":100025301,"comment_content":"有一个问题请教，目前在大规模集群架构下，应用使用的资源不是固定的，系统中的数据规模不是固定的，并发用户以及用户访问量不是固定的，在这种情况下，如何给出一个合理的SLA？尤其是在某些极端情况下，应用可能还没有真正在产品环境中跑起来。<br>我遇到的定义SLA的几种方式：<br>1. 和竞争对手比，与市场平均SLA看齐。<br>2. 基于内部性能测试结果。<br>3. 公司统一规定，所有应用的SLA是一样的。<br>4. 领导拍脑袋。<br><br>目前没有看到哪些项目是基于日志分析来定义SLA的。","like_count":0},{"had_liked":false,"id":186077,"user_name":"Eden2020","can_delete":false,"product_type":"c1","uid":1899158,"ip_address":"","ucode":"0DEE62F2335237","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fa/96/4a7b7505.jpg","comment_is_top":false,"comment_ctime":1583751665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583751665","product_id":100025301,"comment_content":"这一讲SLA确实对架构改进很重要，谢谢作者分享","like_count":0},{"had_liked":false,"id":107693,"user_name":"Aven","can_delete":false,"product_type":"c1","uid":1066230,"ip_address":"","ucode":"E2B1D0B57F18D1","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/f6/60f948e1.jpg","comment_is_top":false,"comment_ctime":1561597186,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1561597186","product_id":100025301,"comment_content":"老师，听了您的课，感觉自己对SLA中的可用性的理解还不是很透彻，目前我正在搭建维护一套etcd集群，通过这节所讲的知识，对照评估了下集群的正确性，容量和延迟等方面特性，但是唯独可用性不知道如何评估，可用性是不是说出现机房网络问题或者宕机的时候，恢复集群的可用性需要多久？还望老师深入解析下","like_count":0},{"had_liked":false,"id":103420,"user_name":"倪必荣","can_delete":false,"product_type":"c1","uid":1046496,"ip_address":"","ucode":"34F707BB9DDDC9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/e0/34290aa4.jpg","comment_is_top":false,"comment_ctime":1560431294,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560431294","product_id":100025301,"comment_content":"文中主要谈及3种一致性模型，强一致必须同步后才能访问，弱一致按时间发生同步与访问操作，可以同步与访问穿插，而最终一致是特别的弱一致，可以理解为用弱一致的方式达到强一致的效果，应该就是提高自动访问的频次。主要区别有2:<br><br>0.同步与访问是否可同时进行<br>1.是否自动提高访问频次","like_count":0,"discussions":[{"author":{"id":1013147,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","nickname":"技术修行者","note":"","ucode":"28CA41A1214D6B","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322253,"discussion_content":"走差场了吧😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604713221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91441,"user_name":"王众","can_delete":false,"product_type":"c1","uid":1282867,"ip_address":"","ucode":"6F857F45909CB2","user_header":"https://static001.geekbang.org/account/avatar/00/13/93/33/94d7e3ab.jpg","comment_is_top":false,"comment_ctime":1557039628,"is_pvip":false,"replies":[{"id":"32952","content":"谢谢你的支持！希望你能从专栏里学习到知识！","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1557200969,"ip_address":"","comment_id":91441,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557039628","product_id":100025301,"comment_content":"回复里看到老师“纯狠操猛干”的用语，是在和这个斯文的头像不配哈，挺适合我的头像。感谢老师对很多留言的耐烦解答与鼓励。","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448919,"discussion_content":"谢谢你的支持！希望你能从专栏里学习到知识！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557200969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89544,"user_name":"程序设计的艺术","can_delete":false,"product_type":"c1","uid":1107847,"ip_address":"","ucode":"CA3817C11CD9E6","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/87/9ad59b98.jpg","comment_is_top":false,"comment_ctime":1556200742,"is_pvip":false,"replies":[{"id":"33007","content":"可能可以参考下10介绍的lambda架构","user_name":"作者回复","user_name_real":"Yuannan蔡元楠","uid":"1257426","ctime":1557220358,"ip_address":"","comment_id":89544,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556200742","product_id":100025301,"comment_content":"你好，老师，目前的大数据处理架构该是什么样子呢？我这边有每天40多万行数据形成数据仓库，离线匹配行记录，使用什么方法可以快速处理？谢谢","like_count":0,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannan蔡元楠","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448169,"discussion_content":"可能可以参考下10介绍的lambda架构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557220358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89284,"user_name":"旭东(Frank)","can_delete":false,"product_type":"c1","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1556148843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556148843","product_id":100025301,"comment_content":"发生内部错误的时候，准确率低了，这些也算不可用吧。那这个可用性和错误率是否有一点重叠","like_count":0},{"had_liked":false,"id":89227,"user_name":"青石","can_delete":false,"product_type":"c1","uid":1215531,"ip_address":"","ucode":"B0056AD6453322","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg","comment_is_top":false,"comment_ctime":1556112134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556112134","product_id":100025301,"comment_content":"性能测试可以比较直观的看到错误率、系统容量、延迟的结果。可用性是否可以理解成集群、系统监控（故障恢复）、弹性伸缩容等方式来提升系统可用性呢？","like_count":0},{"had_liked":false,"id":89132,"user_name":"xfly","can_delete":false,"product_type":"c1","uid":1193153,"ip_address":"","ucode":"215CF53ECF2298","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/c1/255161c9.jpg","comment_is_top":false,"comment_ctime":1556087023,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556087023","product_id":100025301,"comment_content":"这就是服务的KPI","like_count":0},{"had_liked":false,"id":89115,"user_name":"kylin","can_delete":false,"product_type":"c1","uid":1351248,"ip_address":"","ucode":"3588B62A4F9534","user_header":"https://static001.geekbang.org/account/avatar/00/14/9e/50/21e0beca.jpg","comment_is_top":false,"comment_ctime":1556081477,"is_pvip":true,"replies":[{"id":"32090","content":"谢谢你的留言！这一讲中所讲述到的SLA只是常见的一些指标，你也当然可以为自己的服务定义自己公司的指标，这都是良好的习惯。","user_name":"作者回复","user_name_real":"Geek_88e0d7","uid":"1503187","ctime":1556223747,"ip_address":"","comment_id":89115,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556081477","product_id":100025301,"comment_content":"我们公司这边的SLA优化主要是对Hive处理数据，特别是源表是全量表时，要求处理时长越短越好。有的要求从1小时优化到40分钟。这里的SLA优化好像和讲的服务等级协议的四个指标关系不大吧","like_count":0,"discussions":[{"author":{"id":1503187,"avatar":"","nickname":"Geek_88e0d7","note":"","ucode":"3E2596F3EB9165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448021,"discussion_content":"谢谢你的留言！这一讲中所讲述到的SLA只是常见的一些指标，你也当然可以为自己的服务定义自己公司的指标，这都是良好的习惯。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556223747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89113,"user_name":"挖矿的小戈","can_delete":false,"product_type":"c1","uid":1503917,"ip_address":"","ucode":"2078A85139BD5D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/9chAb6SjxFiapSeicsAsGqzziaNlhX9d5aEt8Z0gUNsZJ9dICaDHqAypGvjv4Bx3PryHnj7OFnOXFOp7Ik21CVXEA/132","comment_is_top":false,"comment_ctime":1556081001,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556081001","product_id":100025301,"comment_content":"等菜老师更新课程，犹如等待喜欢的小说更新一般，准时追更，另外，希望老师能够推荐一些目前市面上比较新的技术干货","like_count":0},{"had_liked":false,"id":89031,"user_name":"mix","can_delete":false,"product_type":"c1","uid":1105827,"ip_address":"","ucode":"DD9613E6DE56E3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLlwyYTDAmicfwHqUCCB4a7iaNroEy9zlRNF3NvSWsPkJIgkQPVzwpNCAWX8qcdLY1bQzx7MwxicOO5Q/132","comment_is_top":false,"comment_ctime":1556067276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556067276","product_id":100025301,"comment_content":"我们目前最关注的是qps，也一直在这个方向上进行优化。","like_count":0}]}