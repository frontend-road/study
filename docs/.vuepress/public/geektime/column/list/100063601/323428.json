{"id":323428,"title":"18 | åœºæ™¯è”åŠ¨ï¼šæ™ºèƒ½ç”µç¯å¦‚ä½•æ„ŸçŸ¥å…‰çº¿ï¼Ÿï¼ˆä¸Šï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­æœæ–Œã€‚</p><p>åœ¨ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬æ‰“é€ äº†è‡ªå·±çš„è”ç½‘æ™ºèƒ½ç”µç¯ï¼Œä½ å¯ä»¥é€šè¿‡æ‰‹æœºå°ç¨‹åºæ¥æ§åˆ¶å®ƒçš„æ‰“å¼€å’Œå…³é—­ï¼Œä¹Ÿå°±æ˜¯å®ç°è¿œç¨‹æ§åˆ¶ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥æé«˜ä½“éªŒï¼Œè®©æ™ºèƒ½ç”µç¯å¯ä»¥åŸºäºç¯å¢ƒçš„æ˜æš—æ¥è‡ªåŠ¨åœ°æ‰“å¼€å’Œå…³é—­ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹å¹¶ä¸éš¾ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µæ˜¯æ‰“é€ ä¼ æ„Ÿå™¨è®¾å¤‡æ¥æ„ŸçŸ¥å…‰ç…§çš„å¼ºå¼±ï¼Œåˆ¤æ–­å‡ºç¯å¢ƒçš„æ˜æš—çŠ¶æ€ï¼Œç¬¬äºŒé˜¶æ®µæ˜¯åˆ›å»ºä¸€ä¸ªåœºæ™¯è”åŠ¨ï¼Œæ ¹æ®ä¼ æ„Ÿå™¨çš„æ•°å€¼æ¥æ§åˆ¶æ™ºèƒ½ç”µç¯çš„çŠ¶æ€ã€‚</p><p>è¿™ä¸€è®²ï¼Œæˆ‘å…ˆå¸¦ä½ ä¸€æ­¥ä¸€æ­¥åœ°å®ç°ç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œï¼ˆå¦‚æœ‰éœ€è¦ï¼Œä½ å¯ä»¥æ ¹æ®<a href=\"https://shimo.im/sheets/D3VVPdwcYRhhQRXh/MODOC\">è¿™ä»½æ–‡æ¡£</a>è‡ªè¡Œé‡‡è´­ç›¸å…³ç¡¬ä»¶ï¼‰ã€‚</p><h2>ç¬¬ä¸€æ­¥ï¼šé€šä¿¡æŠ€æœ¯</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºå…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡é€‰æ‹©é€šä¿¡æŠ€æœ¯ã€‚</p><p>å› ä¸ºå…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡çš„éƒ¨ç½²ä½ç½®æ¯”è¾ƒçµæ´»ï¼Œä¸å¤ªå¯èƒ½åƒæ™ºèƒ½ç”µç¯ä¸€æ ·è¿æ¥æˆ¿é—´é‡Œçš„ç”µæºçº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨ä¸€ç§æ¯”Wi-FiåŠŸè€—æ›´ä½çš„é€šä¿¡æŠ€æœ¯ã€‚è¿™æ ·çš„è¯ï¼Œå°±ç®—ä½¿ç”¨ç”µæ± ä¾›ç”µï¼Œä¹Ÿå¯ä»¥é•¿æ—¶é—´ï¼ˆä¸€å¹´ä»¥ä¸Šï¼‰æŒç»­å·¥ä½œã€‚</p><p>ç»è¿‡å¯¹æ¯”ï¼Œæˆ‘å»ºè®®é€‰æ‹© BLE ä½åŠŸè€—è“ç‰™æŠ€æœ¯ï¼ˆå…³äºé€šä¿¡æŠ€æœ¯çš„é€‰æ‹©ç­–ç•¥ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/306976\">ç¬¬2è®²</a>ï¼‰ã€‚éšç€æ™ºèƒ½æ‰‹æœºçš„å‘å±•ï¼Œè“ç‰™æ—©å·²æˆä¸ºæ‰‹æœºæ ‡é…çš„é€šä¿¡æŠ€æœ¯ï¼Œè“ç‰™èŠ¯ç‰‡å’Œåè®®æ ˆçš„æˆç†Ÿåº¦éå¸¸é«˜ï¼Œè€Œä¸”åœ¨è®¾å¤‡çš„ä¾›åº”é“¾æ–¹é¢ï¼Œè“ç‰™èŠ¯ç‰‡å¯ä»¥é€‰æ‹©çš„ä¾›åº”å•†ä¹Ÿéå¸¸å¤šã€‚</p><p>ä¸è¿‡åœ¨æ­£å¼å¼€å‘ä¹‹å‰ï¼Œæˆ‘è¿˜å¾—ä¸ºä½ è¡¥å……è¯´æ˜ä¸€äº›BLEçš„ç›¸å…³çŸ¥è¯†ã€‚</p><p>BLEè®¾å¤‡å¯ä»¥åœ¨4ç§æ¨¡å¼ä¸‹å·¥ä½œï¼š</p><!-- [[[read_end]]] --><ol>\n<li><strong>å¹¿æ’­æ¨¡å¼</strong>ï¼ˆBroadcasterï¼‰ï¼Œè¿™é‡Œç‰¹æŒ‡å•çº¯çš„å¹¿æ’­æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹è®¾å¤‡ä¸å¯ä»¥è¢«è¿æ¥ï¼Œåªèƒ½å¤Ÿä»¥ä¸€å®šçš„æ—¶é—´é—´éš”æŠŠæ•°æ®å¹¿æ’­å‡ºæ¥ï¼Œä¾›å…¶ä»–è®¾å¤‡ä½¿ç”¨ï¼Œæ¯”å¦‚æ‰‹æœºæ‰«æå¤„ç†ã€‚è“ç‰™Beaconè®¾å¤‡å°±æ˜¯å·¥ä½œåœ¨è¿™ç§æ¨¡å¼ã€‚</li>\n<li><strong>ä»æœºæ¨¡å¼</strong>ï¼ˆPeripheralï¼‰ï¼Œè¿™ç§æ¨¡å¼ä¸‹è®¾å¤‡ä»ç„¶å¯ä»¥å¹¿æ’­æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¢«è¿æ¥ã€‚å»ºç«‹è¿æ¥åï¼ŒåŒæ–¹å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ã€‚æ¯”å¦‚ä½ ç”¨æ‰‹æœºè¿æ¥ä¸€ä¸ªå…·æœ‰è“ç‰™åŠŸèƒ½çš„ä½“æ¸©è®¡ï¼Œè¿™æ—¶ä½“æ¸©è®¡å°±æ˜¯ä»æœºï¼ˆPeripheralï¼‰ã€‚</li>\n<li><strong>ä¸»æœºæ¨¡å¼</strong>ï¼ˆCentralï¼‰ï¼Œè¿™ç§æ¨¡å¼ä¸‹è®¾å¤‡ä¸è¿›è¡Œå¹¿æ’­ï¼Œä½†æ˜¯å¯ä»¥æ‰«æå‘¨å›´çš„è“ç‰™å¹¿æ’­åŒ…ï¼Œå‘ç°å…¶ä»–è®¾å¤‡ï¼Œç„¶åä¸»åŠ¨å¯¹è¿™äº›è®¾å¤‡å‘èµ·è¿æ¥ã€‚è¿˜æ˜¯åˆšæ‰é‚£ä¸ªä¾‹å­ï¼Œä¸»åŠ¨è¿æ¥è“ç‰™ä½“æ¸©è®¡çš„æ‰‹æœºå°±æ˜¯ä¸»æœºï¼ˆCentralï¼‰è§’è‰²ã€‚</li>\n<li><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼ˆObserverï¼‰ï¼Œè¿™ç§æ¨¡å¼ä¸‹è®¾å¤‡åƒä¸»æœºæ¨¡å¼ä¸€æ ·ï¼Œä¹Ÿä¸è¿›è¡Œå¹¿æ’­ï¼Œè€Œæ˜¯æ‰«æå‘¨å›´çš„è“ç‰™å¹¿æ’­åŒ…ï¼Œä½†æ˜¯ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œå®ƒä¸ä¼šä¸ä»æœºè®¾å¤‡å»ºç«‹è¿æ¥ã€‚ä¸€èˆ¬æ”¶é›†è“ç‰™è®¾å¤‡å¹¿æ’­åŒ…çš„ç½‘å…³å°±æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹å·¥ä½œçš„ï¼Œå®ƒä¼šå°†æ”¶é›†çš„å¹¿æ’­æ•°æ®é€šè¿‡ç½‘çº¿ã€Wi-Fiæˆ–è€…4Gç­‰èœ‚çªç½‘ç»œä¸Šä¼ åˆ°äº‘å¹³å°ã€‚</li>\n</ol><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æ‰“é€ çš„å…‰ç…§ä¼ æ„Ÿå™¨åªéœ€è¦æä¾›å…‰ç…§å¼ºåº¦æ•°æ®å°±è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰è®¾å¤‡åœ¨å¹¿æ’­æ¨¡å¼ä¸‹å·¥ä½œã€‚</p><h2>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©å¼€å‘æ¿</h2><p>é‚£ä¹ˆå…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡è¦é€‰æ‹©ä»€ä¹ˆå¼€å‘æ¿å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åœ¨ä¸Šä¸€è®²æ‰“é€ çš„è”ç½‘æ™ºèƒ½ç”µç¯ä¸­ä½¿ç”¨çš„NodeMCUæ˜¯åŸºäº<strong>ESP8266èŠ¯ç‰‡</strong>çš„ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œè¿™æ¬¾èŠ¯ç‰‡å¹¶ä¸æ”¯æŒä½åŠŸè€—è“ç‰™ã€‚</p><p>å¥½åœ¨å¸‚åœºä¸Šè¿˜æœ‰ä¸€æ¬¾åŸºäº<strong>ESP32èŠ¯ç‰‡</strong>çš„NodeMCUå¼€å‘æ¿ã€‚<a href=\"https://www.espressif.com/zh-hans/products/socs/esp32/overview\">ESP32</a>æ˜¯ä¹é‘«ç§‘æŠ€å‡ºå“çš„å¦ä¸€æ¬¾æ€§èƒ½ä¼˜è‰¯ä¸”æ»¡è¶³ä½åŠŸè€—çš„ç‰©è”ç½‘èŠ¯ç‰‡ï¼Œå®ƒåŒæ—¶æ”¯æŒWi-Fiå’Œä½åŠŸç‡è“ç‰™é€šä¿¡æŠ€æœ¯ï¼Œè¿˜æœ‰ä¸°å¯Œçš„ADCæ¥å£ã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼ŒMicroPythonä¹Ÿæ”¯æŒESP32èŠ¯ç‰‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä½¿ç”¨Pythonè¯­è¨€æ¥å¼€å‘äº†ã€‚</p><h2>ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡MicroPythonç¯å¢ƒ</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åœ¨NodeMCUï¼ˆESP32ï¼‰ä¸Šå®‰è£…MicroPythonå›ºä»¶ï¼Œå‡†å¤‡Pythonç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚</p><p>MicroPythonå®˜ç½‘å·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡äº†ç¼–è¯‘å¥½çš„å›ºä»¶æ–‡ä»¶ï¼Œè¿™çœæ‰äº†æˆ‘ä»¬åœ¨ç”µè„‘ä¸Šè¿›è¡Œäº¤å‰ç¼–è¯‘çš„å·¥ä½œã€‚ä½ å¯ä»¥ä»<a href=\"http://micropython.org/download/esp32/\">è¿™ä¸ªé“¾æ¥</a> ä¸­é€‰æ‹©â€œFirmware with ESP-IDF v3.xâ€ä¸‹é¢çš„â€œGENERICâ€ç±»åˆ«ï¼Œç›´æ¥ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„å›ºä»¶æ–‡ä»¶åˆ°ç”µè„‘ä¸­ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€æ ¹ USB æ•°æ®çº¿ï¼Œå°† NodeMCU å¼€å‘æ¿å’Œç”µè„‘è¿æ¥èµ·æ¥ã€‚USBæ•°æ®çº¿ä»ç„¶é€‰æ‹©ä¸€å¤´æ˜¯ USB-A æ¥å£ã€å¦ä¸€å¤´æ˜¯ Micro-USB æ¥å£ï¼Œå¹¶ä¸”æ”¯æŒæ•°æ®ä¼ è¾“çš„å®Œæ•´çº¿ç¼†ã€‚å…·ä½“ç»†èŠ‚ï¼Œä½ å¯ä»¥å†å›é¡¾<a href=\"https://time.geekbang.org/column/article/321652\">ç¬¬16è®²</a>ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨esptoolå·¥å…·æŠŠè¿™ä¸ªå›ºä»¶çƒ§å½•åˆ°NodeMCUå¼€å‘æ¿ä¸Šã€‚å…ˆåœ¨ç”µè„‘ç»ˆç«¯ä¸Šè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¸…ç©ºä¸€ä¸‹NodeMCUçš„Flashå­˜å‚¨èŠ¯ç‰‡ã€‚</p><pre><code>esptool.py --chip esp32 --port /dev/cu.usbserial-0001 erase_flash\n</code></pre><p>ä½ å¯ä»¥ä»å‘½ä»¤é‡Œçœ‹åˆ°ï¼Œå’Œä¹‹å‰æ™ºèƒ½ç”µç¯ç”¨çš„å‘½ä»¤ç›¸æ¯”ï¼Œè¿™é‡Œå¢åŠ äº†èŠ¯ç‰‡ä¿¡æ¯â€œesp32â€ã€‚å¦å¤–ï¼Œâ€œ--portâ€åé¢çš„ä¸²å£è®¾å¤‡åç§°ï¼Œéœ€è¦ä½ æ›¿æ¢ä¸ºè‡ªå·±ç”µè„‘ä¸Šå¯¹åº”çš„åç§°ã€‚</p><p>æˆåŠŸæ“¦é™¤Flashä¹‹åï¼Œå°±æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å›ºä»¶å†™å…¥FlashèŠ¯ç‰‡ã€‚</p><pre><code>esptool.py --chip esp32 --port /dev/cu.usbserial-0001 --baud 460800 write_flash -z 0x1000 esp32-idf3-20200902-v1.13.bin\n</code></pre><p>è¿™æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”µè„‘ä¸Šçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨è½¯ä»¶ï¼Œæ¯”å¦‚ SecureCRTï¼Œé€šè¿‡ä¸²å£åè®®è¿æ¥ä¸Šå¼€å‘æ¿ï¼Œæ³¨æ„æ³¢ç‰¹ç‡ï¼ˆBaud rateï¼‰è®¾ç½®ä¸º 115200ã€‚</p><p>ç„¶åä½ åº”è¯¥å°±èƒ½çœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºçš„å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œäº¤äº’ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/8b/e2a9a62bc472a7f41ddca0e5b6ca678b.png?wh=1016*734\" alt=\"\"></p><h2>ç¬¬å››æ­¥ï¼šæ­å»ºå…‰ç…§ä¼ æ„Ÿå™¨ç¡¬ä»¶ç”µè·¯</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¼€å§‹åŸºäºNodeMCUæ­å»ºå…‰ç…§ä¼ æ„Ÿå™¨çš„ç¡¬ä»¶ç”µè·¯ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å‡†å¤‡å¥½å®éªŒçš„ææ–™ï¼š</p><ol>\n<li>NodeMCUï¼ˆESP32ï¼‰å¼€å‘æ¿ä¸€ä¸ªã€‚æ³¨æ„åŒºåˆ†èŠ¯ç‰‡çš„å…·ä½“å‹å·ã€‚</li>\n<li>å…‰ç…§ä¼ æ„Ÿå™¨æ¨¡å—ä¸€ä¸ª</li>\n<li>æœé‚¦çº¿/è·³çº¿è‹¥å¹²ä¸ª</li>\n<li>é¢åŒ…æ¿ä¸€ä¸ª</li>\n</ol><p>ç„¶åï¼Œä½ å¯ä»¥æŒ‰ç…§æˆ‘ç”»çš„è¿çº¿å›¾æ¥æ­å»ºå‡ºè‡ªå·±çš„ç”µè·¯ã€‚è·Ÿè”ç½‘æ™ºèƒ½ç”µç¯çš„ç”µè·¯æ¯”èµ·æ¥ï¼Œè¿™ä¸ªè¿˜æ˜¯éå¸¸ç®€å•çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/ab/ffcd6bb49b89e3d079fc1ca5c2dd18ab.png?wh=1944*912\" alt=\"\"></p><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œåœ¨æˆ‘çš„ç”µè·¯å›¾ä¸­ï¼Œå…‰ç…§ä¼ æ„Ÿå™¨æ¨¡å—ä»å·¦åˆ°å³ï¼Œç®¡è„šåˆ†åˆ«æ˜¯å…‰å¼ºåº¦æ¨¡æ‹Ÿä¿¡å·è¾“å‡ºç®¡è„šã€ç”µæºåœ°GNDå’Œç”µæºæ­£VCCç®¡è„šã€‚ä½ éœ€è¦æ ¹æ®è‡ªå·±çš„ä¼ æ„Ÿå™¨æ¨¡å—è°ƒæ•´å…·ä½“çš„è¿çº¿ã€‚</p><p>æˆ‘é€‰æ‹©çš„æ˜¯åŸºäºPT550ç¯ä¿å‹å…‰æ•äºŒæç®¡çš„å…‰ç…§ä¼ æ„Ÿå™¨å…ƒå™¨ä»¶ï¼Œå®ƒçš„çµæ•åº¦æ›´é«˜ï¼Œæµ‹é‡èŒƒå›´æ˜¯0Luxï½6000Luxã€‚</p><p>Luxï¼ˆå‹’å…‹æ–¯ï¼‰æ˜¯å…‰ç…§å¼ºåº¦çš„å•ä½ï¼Œå®ƒå’Œå¦ä¸€ä¸ªæ¦‚å¿µLumensï¼ˆæµæ˜ï¼‰æ˜¯ä¸åŒçš„ã€‚Lumensæ˜¯æŒ‡ä¸€ä¸ªå…‰æºï¼ˆæ¯”å¦‚ç”µç¯ã€æŠ•å½±ä»ªï¼‰å‘å‡ºçš„å…‰èƒ½åŠ›çš„æ€»é‡ï¼Œè€ŒLuxæ˜¯æŒ‡ç©ºé—´å†…ä¸€ä¸ªä½ç½®æ¥æ”¶åˆ°çš„å…‰ç…§çš„å¼ºåº¦ã€‚</p><p>è¿™ä¸ªå…ƒå™¨ä»¶é€šè¿‡ä¿¡å·ç®¡è„šè¾“å‡ºæ¨¡æ‹Ÿé‡ï¼Œæˆ‘ä»¬è¯»å–NodeMCU ESP32çš„ADCæ¨¡æ•°è½¬æ¢å™¨ï¼ˆADC0ï¼Œå¯¹åº”GPIO36ï¼‰çš„æ•°å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°å…‰ç…§å¼ºåº¦ã€‚è¿™ä¸ªæ•°å€¼è¶Šå¤§ï¼Œè¡¨ç¤ºå…‰ç…§å¼ºåº¦è¶Šå¤§ã€‚</p><p>å› ä¸ºADCæ”¯æŒçš„æœ€å¤§ä½æ•°æ˜¯12bitï¼Œæ‰€ä»¥è¿™ä¸ªæ•°å€¼èŒƒå›´æ˜¯0~4095ä¹‹é—´ã€‚è¿™é‡Œæˆ‘ä»¬ç²—ç•¥åœ°æŒ‰ç…§çº¿æ€§å…³ç³»åšä¸€ä¸ªè½¬æ¢ã€‚å…·ä½“è®¡ç®—è¿‡ç¨‹ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><pre><code>from machine import ADC\nfrom machine import Pin\n\nclass LightSensor():\n\n    def __init__(self, pin):\n        self.light = ADC(Pin(pin))\n\n    def value(self):\n        value = self.light.read()\n        print(&quot;Light ADC value:&quot;,value)\n        return int(value/4095*6000)\n</code></pre><h2>ç¬¬äº”æ­¥ï¼šç¼–å†™è“ç‰™ç¨‹åº</h2><p>NodeMCU ESP32çš„å›ºä»¶å·²ç»é›†æˆäº†BLEçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œè½¯ä»¶çš„å¼€å‘ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»™å¹¿æ’­åŒ…æ•°æ®å®šä¹‰ä¸€å®šçš„æ ¼å¼ï¼Œè®©å…¶ä»–è®¾å¤‡å¯ä»¥é¡ºåˆ©åœ°è§£æä½¿ç”¨æ‰«æåˆ°çš„æ•°æ®ã€‚</p><p>é‚£ä¹ˆæ€ä¹ˆå®šä¹‰è“ç‰™å¹¿æ’­åŒ…çš„æ ¼å¼å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å°ç±³åˆ¶å®šçš„<a href=\"https://iot.mi.com/new/doc/embedded-development/ble/ble-mibeacon.html\">MiBeacon</a>è“ç‰™åè®®ã€‚</p><p><strong>MiBeaconè“ç‰™åè®®</strong>çš„å¹¿æ’­åŒ…æ ¼å¼æ˜¯åŸºäºBLEçš„GAPï¼ˆGeneric Access Profileï¼‰åˆ¶å®šçš„ã€‚GAPæ§åˆ¶äº†è“ç‰™çš„å¹¿æ’­å’Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶äº†è®¾å¤‡å¦‚ä½•è¢«å‘ç°ï¼Œä»¥åŠå¦‚ä½•äº¤äº’ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒGAPå®šä¹‰äº†ä¸¤ç§æ–¹å¼æ¥è®©è®¾å¤‡å¹¿æ’­æ•°æ®ï¼š</p><p>ä¸€ä¸ªæ˜¯å¹¿æ’­æ•°æ®ï¼ˆAdvertising Data payloadï¼‰ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œæ•°æ®é•¿åº¦æ˜¯31ä¸ªå­—èŠ‚ï¼›</p><p>å¦ä¸€ä¸ªæ˜¯æ‰«æå›å¤æ•°æ®ï¼ˆScan Response payloadï¼‰ï¼Œå®ƒåŸºäºè“ç‰™ä¸»æœºè®¾å¤‡ï¼ˆæ¯”å¦‚æ‰‹æœºï¼‰å‘å‡ºçš„æ‰«æè¯·æ±‚ï¼ˆScan Requestï¼‰æ¥å›å¤ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚æ•°æ®é•¿åº¦å’Œå¹¿æ’­æ•°æ®ä¸€æ ·ã€‚</p><p>ï¼ˆæ³¨æ„ï¼Œè“ç‰™5.0ä¸­æœ‰æ‰©å±•çš„å¹¿æ’­æ•°æ®ï¼Œæ•°æ®é•¿åº¦ç­‰ç‰¹æ€§ä¸æ­¤ä¸åŒï¼Œä½†è¿™é‡Œä¸æ¶‰åŠï¼Œæ‰€ä»¥ä¸å†ä»‹ç»ã€‚ï¼‰</p><p>æ‰€ä»¥ï¼Œåªè¦å«æœ‰ä»¥ä¸‹æŒ‡å®šä¿¡æ¯çš„å¹¿æ’­æŠ¥æ–‡ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯ç¬¦åˆMiBeaconè“ç‰™åè®®çš„ã€‚</p><ol>\n<li>Advertising Dataä¸­ Service Data (0x16) å«æœ‰Mi Service UUIDçš„å¹¿æ’­åŒ…ï¼ŒUUIDæ˜¯0xFE95ã€‚</li>\n<li>Scan Responseä¸­ Manufacturer Specific Data (0xFF)å«æœ‰å°ç±³å…¬å¸è¯†åˆ«ç çš„å¹¿æ’­åŒ…ï¼Œè¯†åˆ«ç IDæ˜¯0x038Fã€‚</li>\n</ol><p>å…¶ä¸­ï¼Œæ— è®ºæ˜¯åœ¨Advertising Dataä¸­ï¼Œè¿˜æ˜¯Scan Responseä¸­ï¼Œå‡é‡‡ç”¨ç»Ÿä¸€æ ¼å¼å®šä¹‰ã€‚</p><p>å…·ä½“çš„å¹¿æ’­æŠ¥æ–‡æ ¼å¼å®šä¹‰ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„è¡¨æ ¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/23/aa/23a2b5245717b21c4ce766bc13d69faa.jpg?wh=2700*2525\" alt=\"\"></p><p>å› ä¸ºæˆ‘ä»¬è¦ä¸ºå…‰ç…§ä¼ æ„Ÿå™¨å¢åŠ å¹¿æ’­å…‰ç…§å¼ºåº¦æ•°æ®çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸»è¦å…³æ³¨<a href=\"https://iot.mi.com/new/doc/embedded-development/ble/object-definition\">Objectçš„å®šä¹‰</a>ã€‚Objectåˆ†ä¸ºå±æ€§å’Œäº‹ä»¶ä¸¤ç§ï¼Œå…·ä½“å®šä¹‰äº†è®¾å¤‡æ•°æ®çš„å«ä¹‰ï¼Œæ¯”å¦‚ä½“æ¸©è®¡çš„æ¸©åº¦ã€åœŸå£¤çš„æ¹¿åº¦ç­‰ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/4e/a79e59c00b0ba726923910c8768f674e.jpg?wh=2700*744\" alt=\"\"></p><p>æŒ‰ç…§MiBeaconçš„å®šä¹‰ï¼Œå…‰ç…§ä¼ æ„Ÿå™¨çš„Object IDæ˜¯0x1007ï¼Œæ•°æ®é•¿åº¦3ä¸ªå­—èŠ‚ï¼Œæ•°å€¼èŒƒå›´æ˜¯0~120000ä¹‹é—´ã€‚</p><p>æˆ‘å°†ä»£ç è´´åœ¨ä¸‹é¢ï¼Œä¾›ä½ å‚è€ƒã€‚</p><pre><code>#Fileï¼šble_lightsensor.py\nimport bluetooth\nimport struct\nimport time\nfrom ble_advertising import advertising_payload\n\nfrom micropython import const\n\n_IRQ_CENTRAL_CONNECT = const(1)\n_IRQ_CENTRAL_DISCONNECT = const(2)\n_IRQ_GATTS_INDICATE_DONE = const(20)\n\n_FLAG_READ = const(0x0002)\n_FLAG_NOTIFY = const(0x0010)\n\n_ADV_SERVICE_DATA_UUID = 0xFE95\n_SERVICE_UUID_ENV_SENSE = 0x181A\n_CHAR_UUID_AMBIENT_LIGHT = 'FEC66B35-937E-4938-9F8D-6E44BBD533EE'\n\n# Service environmental sensing\n_ENV_SENSE_UUID = bluetooth.UUID(_SERVICE_UUID_ENV_SENSE)\n# Characteristic ambient light density\n_AMBIENT_LIGHT_CHAR = (\n    bluetooth.UUID(_CHAR_UUID_AMBIENT_LIGHT),\n    _FLAG_READ | _FLAG_NOTIFY ,\n)\n_ENV_SENSE_SERVICE = (\n    _ENV_SENSE_UUID,\n    (_AMBIENT_LIGHT_CHAR,),\n)\n\n# https://specificationrefs.bluetooth.com/assigned-values/Appearance%20Values.pdf\n_ADV_APPEARANCE_GENERIC_AMBIENT_LIGHT = const(1344)\n\nclass BLELightSensor:\n    def __init__(self, ble, name='Nodemcu'):\n        self._ble = ble\n        self._ble.active(True)\n        self._ble.irq(self._irq)\n        ((self._handle,),) = self._ble.gatts_register_services((_ENV_SENSE_SERVICE,))\n        self._connections = set()\n        time.sleep_ms(500)\n        self._payload = advertising_payload(\n            name=name, services=[_ENV_SENSE_UUID], appearance=_ADV_APPEARANCE_GENERIC_AMBIENT_LIGHT\n        )\n        self._sd_adv = None\n        self._advertise()\n\n    def _irq(self, event, data):\n        # Track connections so we can send notifications.\n        if event == _IRQ_CENTRAL_CONNECT:\n            conn_handle, _, _ = data\n            self._connections.add(conn_handle)\n        elif event == _IRQ_CENTRAL_DISCONNECT:\n            conn_handle, _, _ = data\n            self._connections.remove(conn_handle)\n            # Start advertising again to allow a new connection.\n            self._advertise()\n        elif event == _IRQ_GATTS_INDICATE_DONE:\n            conn_handle, value_handle, status = data\n\n    def set_light(self, light_den, notify=False):\n        self._ble.gatts_write(self._handle, struct.pack(&quot;!h&quot;, int(light_den)))\n        self._sd_adv = self.build_mi_sdadv(light_den)\n        self._advertise()\n        if notify:\n            for conn_handle in self._connections:\n                if notify:\n                    # Notify connected centrals.\n                    self._ble.gatts_notify(conn_handle, self._handle)\n\n    def build_mi_sdadv(self, density):\n        \n        uuid = 0xFE95\n        fc = 0x0010\n        pid = 0x0002\n        fcnt = 0x01\n        mac = self._ble.config('mac')\n        objid = 0x1007\n        objlen = 0x03\n        objval = density\n\n        service_data = struct.pack(&quot;&lt;3HB&quot;,uuid,fc,pid,fcnt)+mac+struct.pack(&quot;&lt;H2BH&quot;,objid,objlen,0,objval)\n        print(&quot;Service Data:&quot;,service_data)\n        \n        return advertising_payload(service_data=service_data)\n        \n    def _advertise(self, interval_us=500000):\n        self._ble.gap_advertise(interval_us, adv_data=self._payload)\n        time.sleep_ms(100)\n\n        print(&quot;sd_adv&quot;,self._sd_adv)\n        if self._sd_adv is not None:\n            print(&quot;sdddd_adv&quot;,self._sd_adv)\n            self._ble.gap_advertise(interval_us, adv_data=self._sd_adv)\n</code></pre><pre><code>#File: main.py\nfrom ble_lightsensor import BLELightSensor\nfrom lightsensor import LightSensor\nimport time\nimport bluetooth\n\ndef main():\n    ble = bluetooth.BLE()\n    ble.active(True)\n    ble_light = BLELightSensor(ble)\n\n    light = LightSensor(36)\n    light_density = light.value()\n    i = 0\n\n    while True:\n        # Write every second, notify every 10 seconds.\n        i = (i + 1) % 10\n        ble_light.set_light(light_density, notify=i == 0)\n        print(&quot;Light Lux:&quot;, light_density)\n\n        light_density = light.value()\n        time.sleep_ms(1000)\n\nif __name__ == &quot;__main__&quot;:\n    main()\n</code></pre><h2>ç¬¬å…­æ­¥ï¼šéªŒè¯å…‰ç…§ä¼ æ„Ÿå™¨</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†å…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡çš„å¼€å‘å·¥ä½œã€‚é‚£ä¹ˆæ€ä¹ˆéªŒè¯è®¾å¤‡æœ‰æ²¡æœ‰æ­£å¸¸å·¥ä½œå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹æœºä¸Šçš„è“ç‰™è°ƒè¯•è½¯ä»¶æ¥æ‰«æå‘¨å›´è“ç‰™è®¾å¤‡ï¼ŒæŸ¥çœ‹è®¾å¤‡æœ‰æ²¡æœ‰è“ç‰™å¹¿æ’­åŒ…è¾“å‡ºï¼Œèƒ½ä¸èƒ½è·Ÿæ‰‹æœºæ­£å¸¸äº¤äº’ã€‚å¸¸ç”¨çš„è½¯ä»¶æœ‰LightBlueã€nRFConnect å’Œ BLEScannerï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªå°±è¡Œäº†ã€‚</p><p>æ¯”å¦‚æˆ‘é€‰æ‹©çš„æ˜¯nRF Connectï¼Œæ‰“å¼€ä¹‹åï¼Œå®ƒä¼šè‡ªåŠ¨æ‰«æå‘¨å›´çš„è“ç‰™å¹¿æ’­åŒ…ï¼Œå°†å‘ç°çš„è®¾å¤‡ä»¥åˆ—è¡¨çš„å½¢å¼å±•ç¤ºã€‚</p><p>å¦‚æœå‘¨å›´è“ç‰™è®¾å¤‡å¾ˆå¤šçš„è¯ï¼Œä¸ºäº†æ–¹ä¾¿å‘ç°è‡ªå·±çš„å¼€å‘æ¿ï¼Œä½ å¯ä»¥ç‚¹å‡»åˆ—è¡¨ä¸Šæ–¹çš„â€œNo Filterâ€ï¼Œé€‰æ‹©å°†â€œMax.RSSIâ€æ‰“å¼€ã€‚æ‹–åŠ¨å…¶ä¸­çš„æ»‘ç«¿åˆ°åˆé€‚çš„å€¼ï¼Œæ¯”å¦‚-50dBmï¼Œå°±å¯ä»¥è¿‡æ»¤æ‰è“ç‰™ä¿¡å·å¼ºåº¦æ¯”è¾ƒå¼±ï¼ˆä¸€èˆ¬ä¹Ÿæ˜¯æ¯”è¾ƒè¿œï¼‰çš„è®¾å¤‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fb/54/fbe2863b3968e69e36c4f880714fba54.png?wh=1125*1478\" alt=\"\"></p><p>ä¸‹é¢æ˜¯æˆ‘çš„æ‰‹æœºæ‰«æåˆ°çš„åŸºäºNodeMCUå¼€å‘æ¿çš„è“ç‰™è®¾å¤‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/90/fc/90569129dbf544c3a9da37f1e2fd84fc.png?wh=1125*811\" alt=\"\"></p><p>å…¶ä¸­åç§°Nodemcuä¸‹é¢çš„å°±æ˜¯å¹¿æ’­åŒ…çš„å…·ä½“æ•°æ®ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œæˆäº†å…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡çš„å¼€å‘å·¥ä½œã€‚</p><h2>å°ç»“</h2><p>æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»‹ç»äº†å…‰ç…§ä¼ æ„Ÿå™¨çš„å¼€å‘è¿‡ç¨‹ï¼Œå¹¶ä¸”è¡¥å……äº†ä½åŠŸè€—è“ç‰™æŠ€æœ¯çš„ç›¸å…³çŸ¥è¯†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å›é¡¾ä»¥ä¸‹é‡ç‚¹ï¼š</p><ol>\n<li>å¯¹äºæ— æ³•è¿æ¥ç”µæºçº¿ã€éœ€è¦çµæ´»æ”¾ç½®ç”šè‡³ç»å¸¸ç§»åŠ¨çš„è®¾å¤‡ï¼Œä½åŠŸè€—è“ç‰™æŠ€æœ¯æ˜¯åˆé€‚çš„é€šä¿¡æŠ€æœ¯é€‰æ‹©ã€‚</li>\n<li>MiBeaconåè®®çš„å¹¿æ’­åŒ…å®šä¹‰æ˜¯åŸºäºBLEçš„GAPï¼ˆGeneric Access Profileï¼‰åˆ¶å®šçš„ï¼Œä¸»è¦æœ‰å¹¿æ’­æ•°æ®ï¼ˆAdvertising Dataï¼‰å’Œæ‰«æå›å¤æ•°æ®ï¼ˆScan Responseï¼‰ä¸¤ç§ã€‚å…¶ä¸­å¹¿æ’­æ•°æ®ä¸­Service Dataçš„UUIDæ˜¯0xFE95ï¼Œæ‰«æå›å¤æ•°æ®ä¸­Manufacturer Specific Dataçš„å‚å®¶è¯†åˆ«ç æ˜¯0x038Fã€‚</li>\n<li>åœ¨æ—¥å¸¸çš„è“ç‰™è®¾å¤‡å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è°ƒè¯•ã€æµ‹è¯•è“ç‰™åŠŸèƒ½ï¼Œè¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨æ‰‹æœºä¸Šçš„è“ç‰™è°ƒè¯•è½¯ä»¶æ¥éªŒè¯ï¼Œæ¯”å¦‚LightBlueã€nRFConnect å’Œ BLEScannerç­‰ã€‚</li>\n</ol><p>ä¸è¿‡ï¼Œå‡†å¤‡å¥½å…‰ç…§ä¼ æ„Ÿå™¨è®¾å¤‡åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œä¸ºäº†å®ç°å…‰ç…§ä¼ æ„Ÿå™¨å’Œæ™ºèƒ½ç”µç¯çš„è”åŠ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…‰ç…§ä¼ æ„Ÿå™¨æ¥å…¥ç½‘ç»œã€‚è¿™å°±éœ€è¦å€ŸåŠ©è“ç‰™ç½‘å…³è®¾å¤‡äº†ï¼Œåœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘å°†åŸºäºæ ‘è“æ´¾è®²è§£ç½‘å…³è®¾å¤‡çš„å¼€å‘è¿‡ç¨‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>åœ¨è¿™ä¸€è®²çš„å¼€å¤´ï¼Œæˆ‘æåˆ°è“ç‰™è®¾å¤‡é™¤äº†å¹¿æ’­æ•°æ®çš„èƒ½åŠ›ï¼Œè¿˜å¯ä»¥è¿æ¥è¿›è¡Œäº¤äº’ã€‚åœ¨æˆ‘æä¾›çš„ä»£ç ä¸­å…¶å®ä¹ŸåŒ…å«äº†ä¸€ä¸ªå¯ä¾›è¿æ¥è·å–æ•°æ®çš„Serviceå’ŒCharacteristicï¼Œä½ å‘ç°äº†å—ï¼Ÿä½ çŸ¥é“è¿™äº›æ˜¯åŸºäºä½åŠŸè€—è“ç‰™ä¸­çš„ä»€ä¹ˆProfileåè®®å—ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå†™ä¸‹è‡ªå·±çš„ç­”æ¡ˆå’Œæˆ‘äº¤æµä¸€ä¸‹ï¼Œä¹Ÿæ¬¢è¿ä½ å°†è¿™ä¸€è®²åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚</p>","neighbors":{"left":{"article_title":"17 | è¿œç¨‹æ§åˆ¶ï¼šæ€æ ·æ‰“é€ è”ç½‘çš„æ™ºèƒ½ç”µç¯ï¼Ÿ","id":322528},"right":{"article_title":"19 | åœºæ™¯è”åŠ¨ï¼šæ™ºèƒ½ç”µç¯å¦‚ä½•æ„ŸçŸ¥å…‰çº¿ï¼Ÿï¼ˆä¸‹ï¼‰","id":324155}},"comments":[{"had_liked":false,"id":270355,"user_name":"éƒ­æœæ–Œ","can_delete":false,"product_type":"c1","uid":2302171,"ip_address":"","ucode":"2969986E1B3851","user_header":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","comment_is_top":true,"comment_ctime":1609079360,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.2233720384638996e+18","product_id":100063601,"comment_content":"ç”±äºMicroPythonå®˜æ–¹çš„ble_advertising.pyä¸­payloadå‡½æ•°ï¼Œä¸æ”¯æŒå¹¿æ’­service dataï¼Œæ‰€ä»¥æˆ‘è¿›è¡Œäº†å¢è¡¥ï¼š<br>å¸¸é‡å®šä¹‰å¢åŠ ï¼š_ADV_TYPE_SERVICE_DATA = const(0x16)<br>advertising_payloadå‡½æ•°ä¸­å¢åŠ ï¼š<br>if service_data:<br>        _append(_ADV_TYPE_SERVICE_DATA, service_data)<br><br>å¸Œæœ›å¤§å®¶å¯ä»¥è‡ªå·±åŠ¨æ‰‹å®è·µä¸€ä¸‹å“ˆã€‚","like_count":0},{"had_liked":false,"id":336315,"user_name":"å°ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1026271,"ip_address":"","ucode":"BF17F586365E65","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/df/a206a1a2.jpg","comment_is_top":false,"comment_ctime":1646064325,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14530966213","product_id":100063601,"comment_content":"å­¦ä¹ æœ¬è®²è¯¾ç¨‹åï¼Œè¿™è¾¹åšä¸ªè¡¥å……å’Œå‹˜è¯¯ï¼š<br>1. è¡¥å……ble_advertising.pyæºæ–‡ä»¶æ¥æº(https:&#47;&#47;raw.githubusercontent.com&#47;micropython&#47;micropython&#47;master&#47;examples&#47;bluetooth&#47;ble_advertising.py)<br><br>2. ble_lightsensor.pyä¸­build_mi_sdadvæ–¹æ³•ä¸‹è¯­å¥`service_data = struct.pack(&quot;&lt;3HB&quot;,uuid,fc,pid,fcnt)+mac+struct.pack(&quot;&lt;H2BH&quot;,objid,objlen,0,objval)`é‡Œçš„macåº”ä¿®æ”¹ä¸ºmac[1];<br>åŸå› : macæ˜¯ä¸€ä¸ªtupleå¯¹è±¡ ex: (0, b&#39;4\\\\x86]\\\\xb6\\\\xeb\\\\x0e&#39;), åº”å–ç¬¬äºŒä¸ªå€¼<br><br>3. æœ¬è®²ç›¸å…³ä»£ç å·²ä¸Šä¼ githubï¼Œä¾›å¤§å®¶å‚è€ƒï¼šhttps:&#47;&#47;github.com&#47;Kevin181&#47;geektime&#47;tree&#47;main&#47;iot&#47;led&#47;light-sensor","like_count":4},{"had_liked":false,"id":269071,"user_name":"åŠ æ²¹åŠ æ²¹","can_delete":false,"product_type":"c1","uid":2032995,"ip_address":"","ucode":"4326347ED6E532","user_header":"https://static001.geekbang.org/account/avatar/00/1f/05/63/dd59ad18.jpg","comment_is_top":false,"comment_ctime":1608515902,"is_pvip":false,"replies":[{"id":"99460","content":"å¯ä»¥å…ˆè·Ÿç€å®éªŒåšä¸€ä¸‹ï¼Œç†Ÿæ‚‰èµ·æ¥ã€‚ä¸“é—¨äº†è§£ç¡¬ä»¶çš„è¯å¯ä»¥ä¹°æœ¬ä¹¦ï¼Œæ¯”å¦‚Arduino","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1610861716,"ip_address":"","comment_id":269071,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14493417790","product_id":100063601,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå…³äºå¼€å‘æ¿è¿™ç±»çš„ç¡¬ä»¶çŸ¥è¯†å¦‚ä½•å­¦ä¹ æ¯”è¾ƒå¥½ï¼Ÿæˆ‘å¹³æ—¶æ˜¯åšäº‘å¹³å°çš„ä¸šåŠ¡ï¼Œå¯¹ç¡¬ä»¶éƒ¨åˆ†æœ‰ç‚¹é™Œç”Ÿ","like_count":3,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512137,"discussion_content":"å¯ä»¥å…ˆè·Ÿç€å®éªŒåšä¸€ä¸‹ï¼Œç†Ÿæ‚‰èµ·æ¥ã€‚ä¸“é—¨äº†è§£ç¡¬ä»¶çš„è¯å¯ä»¥ä¹°æœ¬ä¹¦ï¼Œæ¯”å¦‚Arduino","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610861716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337811,"discussion_content":"æ‰¾äº›ç¡¬ä»¶DIYçš„ä¹¦ç±çœ‹æ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609079535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300847,"user_name":"A=X+Y+Z","can_delete":false,"product_type":"c1","uid":2657220,"ip_address":"","ucode":"B8820F4F0FF710","user_header":"https://static001.geekbang.org/account/avatar/00/28/8b/c4/74d67cf0.jpg","comment_is_top":false,"comment_ctime":1625403152,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10215337744","product_id":100063601,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªæŠ¥é”™ï¼Œæ¢äº†å‡ ä¸ªç‰ˆæœ¬çš„å›ºä»¶éƒ½æ²¡æœ‰ç”¨<br><br>File &quot;main.py&quot;, line 3, in &lt;module&gt;<br>  File &quot;ble_lightsensor.py&quot;, line 6, in &lt;module&gt;<br>ImportError: no module named &#39;ble_advertising&#39;<br>MicroPython v1.13 on 2020-09-02; ESP32 module with ESP32<br>","like_count":2,"discussions":[{"author":{"id":1785568,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/e0/08069dfc.jpg","nickname":"ç‰›å“¥å“¥","note":"","ucode":"2B3926008E97CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382541,"discussion_content":"è¿™ä¸ªæŠ¥é”™æ˜¯ç¼ºå°‘ble_advertisingè¿™ä¸ªåŒ…å‘€\næ‰€ä»¥è¦å¯¼å…¥è¿™ä¸ªåŒ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625628088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269423,"user_name":"Lee","can_delete":false,"product_type":"c1","uid":1047816,"ip_address":"","ucode":"472B3C88A0B0E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/08/d9906c8e.jpg","comment_is_top":false,"comment_ctime":1608640125,"is_pvip":false,"replies":[{"id":"99454","content":"fritzing","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1610860368,"ip_address":"","comment_id":269423,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5903607421","product_id":100063601,"comment_content":"è¯·é—®ç¬¬å››æ­¥çš„ç”µè·¯å›¾æ˜¯ç”¨çš„ä»€ä¹ˆè½¯ä»¶å‘€ï¼Ÿçœ‹ç€3Dæ¨¡ç»„åšçš„å¾ˆå¥½çœ‹å‘€ï¼›","like_count":1,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512267,"discussion_content":"fritzing","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610860368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337813,"discussion_content":"Fritzing","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609079585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269226,"user_name":"LDxy","can_delete":false,"product_type":"c1","uid":1188710,"ip_address":"","ucode":"956432CE7B7761","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg","comment_is_top":false,"comment_ctime":1608561374,"is_pvip":false,"replies":[{"id":"99458","content":"å®Œå…¨æ­£ç¡®ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1610860725,"ip_address":"","comment_id":269226,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5903528670","product_id":100063601,"comment_content":"åœ¨æˆ‘æä¾›çš„ä»£ç ä¸­å…¶å®ä¹ŸåŒ…å«äº†ä¸€ä¸ªå¯ä¾›è¿æ¥è·å–æ•°æ®çš„ Service å’Œ Characteristicï¼Œä½ å‘ç°äº†å—ï¼Ÿä½ çŸ¥é“è¿™äº›æ˜¯åŸºäºä½åŠŸè€—è“ç‰™ä¸­çš„ä»€ä¹ˆ Profile åè®®å—ï¼Ÿ <br><br>        self._ble.gatts_write(self._handle, struct.pack(&quot;!h&quot;, int(light_den)))<br><br>GATT (Generic Attribute Profile) æ˜¯ä¸€ä¸ªåœ¨è“ç‰™è¿æ¥ä¹‹ä¸Šçš„å‘é€å’Œæ¥æ”¶å¾ˆçŸ­çš„æ•°æ®æ®µçš„é€šç”¨è§„èŒƒï¼Œè¿™äº›å¾ˆçŸ­çš„æ•°æ®æ®µè¢«ç§°ä¸ºå±æ€§ï¼ˆAttributeï¼‰ã€‚","like_count":1,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512197,"discussion_content":"å®Œå…¨æ­£ç¡®ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610860725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337812,"discussion_content":"å®Œå…¨æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609079575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350527,"user_name":"RG","can_delete":false,"product_type":"c1","uid":1272580,"ip_address":"","ucode":"F9ADC5F2B23654","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/04/cea8eb77.jpg","comment_is_top":false,"comment_ctime":1656989434,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656989434","product_id":100063601,"comment_content":"è´­ä¹°ESP32å¦‚æœé€‰æ‹©å…¶ä»–å¼€å‘æ¿ï¼Œéœ€è¦æ³¨æ„æ˜¯ä»€ä¹ˆç³»åˆ—ï¼ŒESP32ï¼ŸEPS32-C3ï¼ŸESP32-S3ï¼ŸESP32-S2ï¼Ÿéœ€è¦æ³¨æ„è¿™ä¸ªS2ï¼Œä¸å¸¦è“ç‰™ã€‚åŒæ—¶ä¹°äº†å‡ å—ï¼Œå‘ç°s2æ²¡æœ‰è“ç‰™ï¼Œå…¶ä»–çš„éƒ½æœ‰ï¼Œçœ‹äº†ä¸€çœ¼ spec çš„ç¡®æ˜¯åªæœ‰è¿™ä¸ªs2æ²¡æœ‰","like_count":0},{"had_liked":false,"id":349847,"user_name":"ä¹ä¸‰","can_delete":false,"product_type":"c1","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"https://static001.geekbang.org/account/avatar/00/16/32/63/fa24f92e.jpg","comment_is_top":false,"comment_ctime":1656382273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656382273","product_id":100063601,"comment_content":"è·³çº¿å’Œæœé‚¦çº¿æ˜¯è¯´çš„ä¸€ä¸ªå—","like_count":0},{"had_liked":false,"id":332618,"user_name":"Geek_1bbdee","can_delete":false,"product_type":"c1","uid":2836446,"ip_address":"","ucode":"1EB65CEA584C54","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/0OaV2KicIgpZdNYqIyqcM1ZfF9QPE8QtXaVicTfGuWfx9zRgatNYJDV2DBzrUPXdl7msYsf4Jia3cY6lRThcFGspg/132","comment_is_top":false,"comment_ctime":1643378898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643378898","product_id":100063601,"comment_content":"è€å¸ˆï¼Œæˆ‘æŒ‰ç…§æ¸…å•ä¹°çš„ç¡¬ä»¶è®¾å¤‡ï¼Œç„¶åæŒ‰ç…§æ­¥éª¤ä¸€æ­¥æ­¥å»åšï¼Œæœ€åæŠŠä»£ç ä¹Ÿæ”¾åˆ°äº†ESP32ä¸Šï¼Œç¡¬ä»¶ç”µè·¯åº”è¯¥æ²¡é—®é¢˜ã€‚ä½†æ˜¯æ²¡æœ‰ç°è±¡æ˜¾ç¤ºï¼Œè¯¥å¦‚ä½•å»å®šä½é—®é¢˜å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":301255,"user_name":"ç‰›å“¥å“¥","can_delete":false,"product_type":"c1","uid":1785568,"ip_address":"","ucode":"2B3926008E97CB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/3e/e0/08069dfc.jpg","comment_is_top":false,"comment_ctime":1625591584,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1625591584","product_id":100063601,"comment_content":"çœŸçš„æœä¸åˆ°è“ç‰™ï¼Œä¹Ÿä¸ä¼šè°ƒè¯•ç¨‹åº","like_count":0,"discussions":[{"author":{"id":2657220,"avatar":"https://static001.geekbang.org/account/avatar/00/28/8b/c4/74d67cf0.jpg","nickname":"A=X+Y+Z","note":"","ucode":"B8820F4F0FF710","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383836,"discussion_content":"å¯ä»¥è¿æ¥PuTTYæŸ¥çœ‹è°ƒè¯•æƒ…å†µï¼ŒæŠ¥é”™ä¼šæ˜¾ç¤º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626251016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287541,"user_name":"CodeAllen","can_delete":false,"product_type":"c1","uid":1436590,"ip_address":"","ucode":"DC479F9F7845CA","user_header":"https://static001.geekbang.org/account/avatar/00/15/eb/ae/e4752b7e.jpg","comment_is_top":false,"comment_ctime":1618022065,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618022065","product_id":100063601,"comment_content":"å®è·µæ‰“å¡","like_count":0},{"had_liked":false,"id":279921,"user_name":"Josen","can_delete":false,"product_type":"c1","uid":2374120,"ip_address":"","ucode":"3D0AFC8AF86C98","user_header":"https://static001.geekbang.org/account/avatar/00/24/39/e8/78a9152e.jpg","comment_is_top":false,"comment_ctime":1614001814,"is_pvip":false,"replies":[{"id":"102048","content":"ç°åœ¨èµ„æ–™ä¸å¤šï¼Œå»ºè®®çœ‹çœ‹å®˜ç½‘ubluetooth serveréƒ¨åˆ†çš„ä»‹ç»ï¼Œç„¶åå°±æ˜¯æºç ï¼Œåªè¦ç†è§£è“ç‰™gattçš„åŸç†ï¼Œä»£ç å¾ˆå¥½è¯»çš„","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1614578322,"ip_address":"","comment_id":279921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614001814","product_id":100063601,"comment_content":"è€å¸ˆï¼Œæˆ‘æ˜¯ä¸€ä¸ªè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå·²ç»åœ¨è½¯ä»¶è¡Œä¸šå·¥ä½œä¸¤å¹´äº†ï¼Œæœ€è¿‘æƒ³è¿›å†›ç‰©è”ç½‘ï¼Œå¯¹ç¡¬ä»¶è¿™å—ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œä¹°äº†å—esp32 æƒ³è®©å®ƒä½œä¸ºgatt serverï¼Œç„¶åç”¨è“ç‰™è°ƒè¯•å®æµ‹è¯•èƒ½å¦è¿æ¥æˆåŠŸï¼Œä½†æ˜¯æˆ‘å‘ç°å¾ˆåƒåŠ›ï¼Œæˆ‘å»micropythonå®˜ç½‘æŸ¥çœ‹äº†esp32çš„ç›¸å…³æ–‡æ¡£ï¼Œå‘ç°è¿˜æ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œæ²¡æœ‰esp32å®Œæ•´çš„ä¾‹å­å¯ä»¥å‚è€ƒçš„ï¼Œè¯·é—®è€å¸ˆæˆ‘éœ€è¦å»å“ªé‡Œå¯»æ‰¾èµ„æºå‘¢ï¼Ÿcsdnï¼Œåšå®¢å›­è¿™äº›æˆ‘éƒ½æ‰¾äº†ï¼Œå…³äºesp32 micropythonè°ƒç”¨è“ç‰™çš„æ¡ˆä¾‹å°‘ä¹‹åˆå°‘","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515924,"discussion_content":"ç°åœ¨èµ„æ–™ä¸å¤šï¼Œå»ºè®®çœ‹çœ‹å®˜ç½‘ubluetooth serveréƒ¨åˆ†çš„ä»‹ç»ï¼Œç„¶åå°±æ˜¯æºç ï¼Œåªè¦ç†è§£è“ç‰™gattçš„åŸç†ï¼Œä»£ç å¾ˆå¥½è¯»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614578322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272695,"user_name":"åŠ æ²¹åŠ æ²¹","can_delete":false,"product_type":"c1","uid":2032995,"ip_address":"","ucode":"4326347ED6E532","user_header":"https://static001.geekbang.org/account/avatar/00/1f/05/63/dd59ad18.jpg","comment_is_top":false,"comment_ctime":1610208237,"is_pvip":false,"replies":[{"id":"99230","content":"è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¿æ¥ä¸²å£ï¼Œä½ å¯ä»¥è¿æ¥ä¸Šçœ‹çœ‹å…·ä½“è°ƒè¯•ä¿¡æ¯","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1610783322,"ip_address":"","comment_id":272695,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1610208237","product_id":100063601,"comment_content":"è€å¸ˆï¼Œç”±äºæ™šè´­ä¹°çš„å®éªŒå¥—ä»¶ï¼Œæƒ³é—®ä¸¤ä¸ªé—®é¢˜ï¼š1. æˆ‘è¿è¡Œç¨‹åºä¹‹åï¼Œè¾“å‡ºä¿¡æ¯ Light Lux: 2268<br>Light ADC value: 1553<br>Service Data: b&#39;\\x95\\xfe\\x10\\x00\\x02\\x00\\x01\\xe8\\xdb\\x84\\x01\\tj\\x07\\x10\\x03\\x00\\xe3\\x08&#39;<br>GAP procedure initiated: stop advertising.<br>GAP procedure initiated: advertise; disc_mode=2 adv_channel_map=7 own_addr_type=0 adv_filter_policy=0 adv_itvl_min=800 adv_itvl_max=800<br>sd_adv bytearray(b&#39;\\x02\\x01\\x06\\x14\\x16\\x95\\xfe\\x10\\x00\\x02\\x00\\x01\\xe8\\xdb\\x84\\x01\\tj\\x07\\x10\\x03\\x00\\xe3\\x08&#39;)<br>sdddd_adv bytearray(b&#39;\\x02\\x01\\x06\\x14\\x16\\x95\\xfe\\x10\\x00\\x02\\x00\\x01\\xe8\\xdb\\x84\\x01\\tj\\x07\\x10\\x03\\x00\\xe3\\x08&#39;)<br>GAP procedure initiated: stop advertising.<br>GAP procedure initiated: advertise; disc_mode=2 adv_channel_map=7 own_addr_type=0 adv_filter_policy=0 adv_itvl_min=800 adv_itvl_max=800   è¿™ä¸ªæ˜¯å¦æ­£å¸¸å‘¢ï¼Œæˆ‘æ‰“å¼€è½¯ä»¶æ²¡æœ‰æ‰«æåˆ°nodemcuçš„è“ç‰™  2.   æ˜¯ä¸æ˜¯esp32 è¿è¡Œè¿™ä¸ªç¨‹åºçš„æ—¶å€™ ampyè¿æ¥ä¸åˆ°ä¸²å£ æˆ‘ä¸€ç›´è¿æ¥ä¸ä¸Š","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513358,"discussion_content":"è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¿æ¥ä¸²å£ï¼Œä½ å¯ä»¥è¿æ¥ä¸Šçœ‹çœ‹å…·ä½“è°ƒè¯•ä¿¡æ¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610783322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785568,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/e0/08069dfc.jpg","nickname":"ç‰›å“¥å“¥","note":"","ucode":"2B3926008E97CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382542,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä¹Ÿé‡åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625628256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271320,"user_name":"ç‹å®","can_delete":false,"product_type":"c1","uid":1048061,"ip_address":"","ucode":"4E6258270B7BE9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/fd/1e3d14ee.jpg","comment_is_top":false,"comment_ctime":1609556658,"is_pvip":true,"replies":[{"id":"99260","content":"Mibeaconæ˜¯ä¸€ä¸ªåè®®è§„èŒƒï¼Œä¸éœ€è¦å®‰è£…","user_name":"ä½œè€…å›å¤","user_name_real":"éƒ­æœæ–Œ","uid":"2302171","ctime":1610806902,"ip_address":"","comment_id":271320,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1609556658","product_id":100063601,"comment_content":"MiBeacon éœ€è¦å®‰è£…å—ï¼Ÿæœ‰æ²¡æœ‰å®‰è£…æ­¥éª¤","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"éƒ­æœæ–Œ","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512900,"discussion_content":"Mibeaconæ˜¯ä¸€ä¸ªåè®®è§„èŒƒï¼Œä¸éœ€è¦å®‰è£…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610806902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}