{"id":42493,"title":"27 | èªæ˜çš„å¾®åˆ›æ–°ï¼šOperatorå·¥ä½œåŸç†è§£è¯»","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šèªæ˜çš„å¾®åˆ›æ–°ä¹‹Operatorå·¥ä½œåŸç†è§£è¯»ã€‚</p>\n<p>åœ¨å‰é¢çš„å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å·²ç»å’Œä½ åˆ†äº«äº†Kubernetesé¡¹ç›®ä¸­çš„å¤§éƒ¨åˆ†ç¼–æ’å¯¹è±¡ï¼ˆæ¯”å¦‚Deploymentã€StatefulSetã€DaemonSetï¼Œä»¥åŠJobï¼‰ï¼Œä¹Ÿä»‹ç»äº†â€œæœ‰çŠ¶æ€åº”ç”¨â€çš„ç®¡ç†æ–¹æ³•ï¼Œè¿˜é˜è¿°äº†ä¸ºKubernetesæ·»åŠ è‡ªå®šä¹‰APIå¯¹è±¡å’Œç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„åŸç†å’Œæµç¨‹ã€‚</p>\n<p>å¯èƒ½ä½ å·²ç»æ„Ÿè§‰åˆ°ï¼Œåœ¨Kubernetesä¸­ï¼Œç®¡ç†â€œæœ‰çŠ¶æ€åº”ç”¨â€æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œå°¤å…¶æ˜¯ç¼–å†™Podæ¨¡æ¿çš„æ—¶å€™ï¼Œæ€»æœ‰ä¸€ç§â€œåœ¨YAMLæ–‡ä»¶é‡Œç¼–ç¨‹åºâ€çš„æ„Ÿè§‰ï¼Œè®©äººå¾ˆä¸èˆ’æœã€‚</p>\n<p>è€Œåœ¨Kubernetesç”Ÿæ€ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç›¸å¯¹æ›´åŠ çµæ´»å’Œç¼–ç¨‹å‹å¥½çš„ç®¡ç†â€œæœ‰çŠ¶æ€åº”ç”¨â€çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå°±æ˜¯ï¼šOperatorã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥Etcd Operatorä¸ºä¾‹ï¼Œæ¥ä¸ºä½ è®²è§£ä¸€ä¸‹Operatorçš„å·¥ä½œåŸç†å’Œç¼–å†™æ–¹æ³•ã€‚</p>\n<p><span class=\"orange\">Etcd Operatorçš„ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸¤æ­¥å³å¯å®Œæˆï¼š</span></p>\n<p><strong>ç¬¬ä¸€æ­¥ï¼Œå°†è¿™ä¸ªOperatorçš„ä»£ç Cloneåˆ°æœ¬åœ°ï¼š</strong></p>\n<pre><code>$ git clone https://github.com/coreos/etcd-operator\n</code></pre>\n<p><strong>ç¬¬äºŒæ­¥ï¼Œå°†è¿™ä¸ªEtcd Operatoréƒ¨ç½²åœ¨Kubernetesé›†ç¾¤é‡Œã€‚</strong></p>\n<p>ä¸è¿‡ï¼Œåœ¨éƒ¨ç½²Etcd Operatorçš„Podä¹‹å‰ï¼Œä½ éœ€è¦å…ˆæ‰§è¡Œè¿™æ ·ä¸€ä¸ªè„šæœ¬ï¼š</p><!-- [[[read_end]]] -->\n<pre><code>$ example/rbac/create_role.sh\n</code></pre>\n<p>ä¸ç”¨æˆ‘å¤šè¯´ä½ ä¹Ÿèƒ½å¤Ÿæ˜ç™½ï¼šè¿™ä¸ªè„šæœ¬çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºEtcd Operatoråˆ›å»ºRBACè§„åˆ™ã€‚è¿™æ˜¯å› ä¸ºï¼ŒEtcd Operatoréœ€è¦è®¿é—®Kubernetesçš„APIServeræ¥åˆ›å»ºå¯¹è±¡ã€‚</p>\n<p>æ›´å…·ä½“åœ°è¯´ï¼Œä¸Šè¿°è„šæœ¬ä¸ºEtcd Operatorå®šä¹‰äº†å¦‚ä¸‹æ‰€ç¤ºçš„æƒé™ï¼š</p>\n<ol>\n<li>\n<p>å¯¹Podã€Serviceã€PVCã€Deploymentã€Secretç­‰APIå¯¹è±¡ï¼Œæœ‰æ‰€æœ‰æƒé™ï¼›</p>\n</li>\n<li>\n<p>å¯¹CRDå¯¹è±¡ï¼Œæœ‰æ‰€æœ‰æƒé™ï¼›</p>\n</li>\n<li>\n<p>å¯¹å±äºetcd.database.coreos.comè¿™ä¸ªAPI Groupçš„CRï¼ˆCustom Resourceï¼‰å¯¹è±¡ï¼Œæœ‰æ‰€æœ‰æƒé™ã€‚</p>\n</li>\n</ol>\n<p>è€ŒEtcd Operatoræœ¬èº«ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªDeploymentï¼Œå®ƒçš„YAMLæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: etcd-operator\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        name: etcd-operator\n    spec:\n      containers:\n      - name: etcd-operator\n        image: quay.io/coreos/etcd-operator:v0.9.2\n        command:\n        - etcd-operator\n        env:\n        - name: MY_POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: MY_POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n...\n</code></pre>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸Šè¿°çš„YAMLæ–‡ä»¶æ¥åˆ›å»ºEtcd Operatorï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ kubectl create -f example/deployment.yaml\n</code></pre>\n<p>è€Œä¸€æ—¦Etcd Operatorçš„Podè¿›å…¥äº†RunningçŠ¶æ€ï¼Œä½ å°±ä¼šå‘ç°ï¼Œæœ‰ä¸€ä¸ªCRDè¢«è‡ªåŠ¨åˆ›å»ºäº†å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ kubectl get pods\nNAME                              READY     STATUS      RESTARTS   AGE\netcd-operator-649dbdb5cb-bzfzp    1/1       Running     0          20s\n\n$ kubectl get crd\nNAME                                    CREATED AT\netcdclusters.etcd.database.coreos.com   2018-09-18T11:42:55Z\n</code></pre>\n<p>è¿™ä¸ªCRDåå«<code>etcdclusters.etcd.database.coreos.com</code> ã€‚ä½ å¯ä»¥é€šè¿‡kubectl describeå‘½ä»¤çœ‹åˆ°å®ƒçš„ç»†èŠ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ kubectl describe crd  etcdclusters.etcd.database.coreos.com\n...\nGroup:   etcd.database.coreos.com\n  Names:\n    Kind:       EtcdCluster\n    List Kind:  EtcdClusterList\n    Plural:     etcdclusters\n    Short Names:\n      etcd\n    Singular:  etcdcluster\n  Scope:       Namespaced\n  Version:     v1beta2\n  \n...\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªCRDç›¸å½“äºå‘Šè¯‰äº†Kubernetesï¼šæ¥ä¸‹æ¥ï¼Œå¦‚æœæœ‰APIç»„ï¼ˆGroupï¼‰æ˜¯<code>etcd.database.coreos.com</code>ã€APIèµ„æºç±»å‹ï¼ˆKindï¼‰æ˜¯â€œEtcdClusterâ€çš„YAMLæ–‡ä»¶è¢«æäº¤ä¸Šæ¥ï¼Œä½ å¯ä¸€å®šè¦è®¤è¯†å•Šã€‚</p>\n<p>æ‰€ä»¥è¯´ï¼Œé€šè¿‡ä¸Šè¿°ä¸¤æ­¥æ“ä½œï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨Kubernetesé‡Œæ·»åŠ äº†ä¸€ä¸ªåå«EtcdClusterçš„è‡ªå®šä¹‰èµ„æºç±»å‹ã€‚è€ŒEtcd Operatoræœ¬èº«ï¼Œå°±æ˜¯è¿™ä¸ªè‡ªå®šä¹‰èµ„æºç±»å‹å¯¹åº”çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚</p>\n<p>è€Œå½“Etcd Operatoréƒ¨ç½²å¥½ä¹‹åï¼Œæ¥ä¸‹æ¥åœ¨è¿™ä¸ªKubernetesé‡Œåˆ›å»ºä¸€ä¸ªEtcdé›†ç¾¤çš„å·¥ä½œå°±éå¸¸ç®€å•äº†ã€‚ä½ åªéœ€è¦ç¼–å†™ä¸€ä¸ªEtcdClusterçš„YAMLæ–‡ä»¶ï¼Œç„¶åæŠŠå®ƒæäº¤ç»™Kuberneteså³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ kubectl apply -f example/example-etcd-cluster.yaml\n</code></pre>\n<p>è¿™ä¸ªexample-etcd-cluster.yamlæ–‡ä»¶é‡Œæè¿°çš„ï¼Œæ˜¯ä¸€ä¸ª3ä¸ªèŠ‚ç‚¹çš„Etcdé›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè¢«æäº¤ç»™Kubernetesä¹‹åï¼Œå°±ä¼šæœ‰ä¸‰ä¸ªEtcdçš„Podè¿è¡Œèµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ kubectl get pods\nNAME                            READY     STATUS    RESTARTS   AGE\nexample-etcd-cluster-dp8nqtjznc   1/1       Running     0          1m\nexample-etcd-cluster-mbzlg6sd56   1/1       Running     0          2m\nexample-etcd-cluster-v6v6s6stxd   1/1       Running     0          2m\n</code></pre>\n<p>é‚£ä¹ˆï¼Œ<span class=\"orange\">ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Œè®©åˆ›å»ºä¸€ä¸ªEtcdé›†ç¾¤çš„å·¥ä½œå¦‚æ­¤ç®€å•å‘¢ï¼Ÿ</span></p>\n<p>æˆ‘ä»¬å½“ç„¶è¿˜æ˜¯å¾—ä»è¿™ä¸ªexample-etcd-cluster.yamlæ–‡ä»¶å¼€å§‹è¯´èµ·ã€‚</p>\n<p>ä¸éš¾æƒ³åˆ°ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œå®šä¹‰çš„ï¼Œæ­£æ˜¯EtcdClusterè¿™ä¸ªCRDçš„ä¸€ä¸ªå…·ä½“å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªCustom Resourceï¼ˆCRï¼‰ã€‚è€Œå®ƒçš„å†…å®¹éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>apiVersion: &quot;etcd.database.coreos.com/v1beta2&quot;\nkind: &quot;EtcdCluster&quot;\nmetadata:\n  name: &quot;example-etcd-cluster&quot;\nspec:\n  size: 3\n  version: &quot;3.2.13&quot;\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒEtcdClusterçš„specå­—æ®µéå¸¸ç®€å•ã€‚å…¶ä¸­ï¼Œsize=3æŒ‡å®šäº†å®ƒæ‰€æè¿°çš„Etcdé›†ç¾¤çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚è€Œversion=â€œ3.2.13â€ï¼Œåˆ™æŒ‡å®šäº†Etcdçš„ç‰ˆæœ¬ï¼Œä»…æ­¤è€Œå·²ã€‚</p>\n<p>è€ŒçœŸæ­£æŠŠè¿™æ ·ä¸€ä¸ªEtcdé›†ç¾¤åˆ›å»ºå‡ºæ¥çš„é€»è¾‘ï¼Œå°±æ˜¯Etcd Operatorè¦å®ç°çš„ä¸»è¦å·¥ä½œäº†ã€‚</p>\n<p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ åº”è¯¥å·²ç»å¯¹Operatoræœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤çŸ¥ï¼š</p>\n<p><strong>Operatorçš„å·¥ä½œåŸç†ï¼Œå®é™…ä¸Šæ˜¯åˆ©ç”¨äº†Kubernetesçš„è‡ªå®šä¹‰APIèµ„æºï¼ˆCRDï¼‰ï¼Œæ¥æè¿°æˆ‘ä»¬æƒ³è¦éƒ¨ç½²çš„â€œæœ‰çŠ¶æ€åº”ç”¨â€ï¼›ç„¶ååœ¨è‡ªå®šä¹‰æ§åˆ¶å™¨é‡Œï¼Œæ ¹æ®è‡ªå®šä¹‰APIå¯¹è±¡çš„å˜åŒ–ï¼Œæ¥å®Œæˆå…·ä½“çš„éƒ¨ç½²å’Œè¿ç»´å·¥ä½œã€‚</strong></p>\n<p>æ‰€ä»¥ï¼Œç¼–å†™ä¸€ä¸ªEtcd Operatorï¼Œä¸æˆ‘ä»¬å‰é¢ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨çš„è¿‡ç¨‹ï¼Œæ²¡ä»€ä¹ˆä¸åŒã€‚</p>\n<p>ä¸è¿‡ï¼Œè€ƒè™‘åˆ°ä½ å¯èƒ½è¿˜ä¸å¤ªæ¸…æ¥š<span class=\"orange\">Etcdé›†ç¾¤çš„ç»„å»ºæ–¹å¼</span>ï¼Œæˆ‘åœ¨è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™éƒ¨åˆ†çŸ¥è¯†ã€‚</p>\n<p><strong>Etcd Operatoréƒ¨ç½²Etcdé›†ç¾¤ï¼Œé‡‡ç”¨çš„æ˜¯é™æ€é›†ç¾¤ï¼ˆStaticï¼‰çš„æ–¹å¼</strong>ã€‚</p>\n<p>é™æ€é›†ç¾¤çš„å¥½å¤„æ˜¯ï¼Œå®ƒä¸å¿…ä¾èµ–äºä¸€ä¸ªé¢å¤–çš„æœåŠ¡å‘ç°æœºåˆ¶æ¥ç»„å»ºé›†ç¾¤ï¼Œéå¸¸é€‚åˆæœ¬åœ°å®¹å™¨åŒ–éƒ¨ç½²ã€‚è€Œå®ƒçš„éš¾ç‚¹ï¼Œåˆ™åœ¨äºä½ å¿…é¡»åœ¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå°±è§„åˆ’å¥½è¿™ä¸ªé›†ç¾¤çš„æ‹“æ‰‘ç»“æ„ï¼Œå¹¶ä¸”èƒ½å¤ŸçŸ¥é“è¿™äº›èŠ‚ç‚¹å›ºå®šçš„IPåœ°å€ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>\n<pre><code>$ etcd --name infra0 --initial-advertise-peer-urls http://10.0.1.10:2380 \\\n  --listen-peer-urls http://10.0.1.10:2380 \\\n...\n  --initial-cluster-token etcd-cluster-1 \\\n  --initial-cluster infra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380,infra2=http://10.0.1.12:2380 \\\n  --initial-cluster-state new\n  \n$ etcd --name infra1 --initial-advertise-peer-urls http://10.0.1.11:2380 \\\n  --listen-peer-urls http://10.0.1.11:2380 \\\n...\n  --initial-cluster-token etcd-cluster-1 \\\n  --initial-cluster infra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380,infra2=http://10.0.1.12:2380 \\\n  --initial-cluster-state new\n  \n$ etcd --name infra2 --initial-advertise-peer-urls http://10.0.1.12:2380 \\\n  --listen-peer-urls http://10.0.1.12:2380 \\\n...\n  --initial-cluster-token etcd-cluster-1 \\\n  --initial-cluster infra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380,infra2=http://10.0.1.12:2380 \\\n  --initial-cluster-state new\n</code></pre>\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å¯åŠ¨äº†ä¸‰ä¸ªEtcdè¿›ç¨‹ï¼Œç»„æˆäº†ä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„Etcdé›†ç¾¤ã€‚</p>\n<p>å…¶ä¸­ï¼Œè¿™äº›èŠ‚ç‚¹å¯åŠ¨å‚æ•°é‡Œçš„â€“initial-clusterå‚æ•°ï¼Œéå¸¸å€¼å¾—ä½ å…³æ³¨ã€‚å®ƒçš„å«ä¹‰ï¼Œæ­£æ˜¯<strong>å½“å‰èŠ‚ç‚¹å¯åŠ¨æ—¶é›†ç¾¤çš„æ‹“æ‰‘ç»“æ„ã€‚<strong>è¯´å¾—æ›´è¯¦ç»†ä¸€ç‚¹ï¼Œå°±æ˜¯</strong>å½“å‰è¿™ä¸ªèŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œéœ€è¦è·Ÿå“ªäº›èŠ‚ç‚¹é€šä¿¡æ¥ç»„æˆé›†ç¾¤</strong>ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šè¿°infra2èŠ‚ç‚¹çš„â€“initial-clusterçš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>...\n--initial-cluster infra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380,infra2=http://10.0.1.12:2380 \\\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œâ€“initial-clusterå‚æ•°æ˜¯ç”±â€œ&lt;èŠ‚ç‚¹åå­—&gt;=&lt;èŠ‚ç‚¹åœ°å€&gt;â€æ ¼å¼ç»„æˆçš„ä¸€ä¸ªæ•°ç»„ã€‚è€Œä¸Šé¢è¿™ä¸ªé…ç½®çš„æ„æ€å°±æ˜¯ï¼Œå½“infra2èŠ‚ç‚¹å¯åŠ¨ä¹‹åï¼Œè¿™ä¸ªEtcdé›†ç¾¤é‡Œå°±ä¼šæœ‰infra0ã€infra1å’Œinfra2ä¸‰ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>åŒæ—¶ï¼Œè¿™äº›EtcdèŠ‚ç‚¹ï¼Œéœ€è¦é€šè¿‡2380ç«¯å£è¿›è¡Œé€šä¿¡ä»¥ä¾¿ç»„æˆé›†ç¾¤ï¼Œè¿™ä¹Ÿæ­£æ˜¯ä¸Šè¿°é…ç½®ä¸­â€“listen-peer-urlså­—æ®µçš„å«ä¹‰ã€‚</p>\n<p>æ­¤å¤–ï¼Œä¸€ä¸ªEtcdé›†ç¾¤è¿˜éœ€è¦ç”¨â€“initial-cluster-tokenå­—æ®µï¼Œæ¥å£°æ˜ä¸€ä¸ªè¯¥é›†ç¾¤ç‹¬ä¸€æ— äºŒçš„Tokenåå­—ã€‚</p>\n<p>åƒä¸Šè¿°è¿™æ ·ä¸ºæ¯ä¸€ä¸ªEctdèŠ‚ç‚¹é…ç½®å¥½å®ƒå¯¹åº”çš„å¯åŠ¨å‚æ•°ä¹‹åæŠŠå®ƒä»¬å¯åŠ¨èµ·æ¥ï¼Œä¸€ä¸ªEtcdé›†ç¾¤å°±å¯ä»¥è‡ªåŠ¨ç»„å»ºèµ·æ¥äº†ã€‚</p>\n<p>è€Œæˆ‘ä»¬è¦ç¼–å†™çš„Etcd Operatorï¼Œå°±æ˜¯è¦æŠŠä¸Šè¿°è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚è¿™å…¶å®ç­‰åŒäºï¼šç”¨ä»£ç æ¥ç”Ÿæˆæ¯ä¸ªEtcdèŠ‚ç‚¹Podçš„å¯åŠ¨å‘½ä»¤ï¼Œç„¶åæŠŠå®ƒä»¬å¯åŠ¨èµ·æ¥ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å®è·µä¸€ä¸‹è¿™ä¸ªæµç¨‹ã€‚</p>\n<p>å½“ç„¶ï¼Œåœ¨ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®ŒæˆEtcdClusterè¿™ä¸ªCRDçš„å®šä¹‰ï¼Œå®ƒå¯¹åº”çš„types.goæ–‡ä»¶çš„ä¸»è¦å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>// +genclient\n// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n\ntype EtcdCluster struct {\n  metav1.TypeMeta   `json:&quot;,inline&quot;`\n  metav1.ObjectMeta `json:&quot;metadata,omitempty&quot;`\n  Spec              ClusterSpec   `json:&quot;spec&quot;`\n  Status            ClusterStatus `json:&quot;status&quot;`\n}\n\ntype ClusterSpec struct {\n // Size is the expected size of the etcd cluster.\n // The etcd-operator will eventually make the size of the running\n // cluster equal to the expected size.\n // The vaild range of the size is from 1 to 7.\n Size int `json:&quot;size&quot;`\n ... \n}\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒEtcdClusteræ˜¯ä¸€ä¸ªæœ‰Statuså­—æ®µçš„CRDã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¿…å…³å¿ƒClusterSpecé‡Œçš„å…¶ä»–å­—æ®µï¼Œåªå…³æ³¨Sizeï¼ˆå³ï¼šEtcdé›†ç¾¤çš„å¤§å°ï¼‰å­—æ®µå³å¯ã€‚</p>\n<p>Sizeå­—æ®µçš„å­˜åœ¨ï¼Œå°±æ„å‘³ç€å°†æ¥å¦‚æœæˆ‘ä»¬æƒ³è¦è°ƒæ•´é›†ç¾¤å¤§å°çš„è¯ï¼Œåº”è¯¥ç›´æ¥ä¿®æ”¹YAMLæ–‡ä»¶é‡Œsizeçš„å€¼ï¼Œå¹¶æ‰§è¡Œkubectl apply -fã€‚</p>\n<p>è¿™æ ·ï¼ŒOperatorå°±ä¼šå¸®æˆ‘ä»¬å®ŒæˆEtcdèŠ‚ç‚¹çš„å¢åˆ æ“ä½œã€‚è¿™ç§â€œscaleâ€èƒ½åŠ›ï¼Œä¹Ÿæ˜¯Etcd Operatorè‡ªåŠ¨åŒ–è¿ç»´Etcdé›†ç¾¤éœ€è¦å®ç°çš„ä¸»è¦åŠŸèƒ½ã€‚</p>\n<p>è€Œä¸ºäº†èƒ½å¤Ÿæ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°±ä¸å†åƒå‰é¢é‚£æ ·åœ¨â€“initial-clusterå‚æ•°é‡ŒæŠŠæ‹“æ‰‘ç»“æ„å›ºå®šæ­»ã€‚</p>\n<p>æ‰€ä»¥ï¼ŒEtcd Operatorçš„å®ç°ï¼Œè™½ç„¶é€‰æ‹©çš„ä¹Ÿæ˜¯é™æ€é›†ç¾¤ï¼Œä½†è¿™ä¸ªé›†ç¾¤å…·ä½“çš„ç»„å»ºè¿‡ç¨‹ï¼Œæ˜¯é€ä¸ªèŠ‚ç‚¹åŠ¨æ€æ·»åŠ çš„æ–¹å¼ï¼Œå³ï¼š</p>\n<p><strong>é¦–å…ˆï¼ŒEtcd Operatorä¼šåˆ›å»ºä¸€ä¸ªâ€œç§å­èŠ‚ç‚¹â€ï¼›</strong><br />\n<strong>ç„¶åï¼ŒEtcd Operatorä¼šä¸æ–­åˆ›å»ºæ–°çš„EtcdèŠ‚ç‚¹ï¼Œç„¶åå°†å®ƒä»¬é€ä¸€åŠ å…¥åˆ°è¿™ä¸ªé›†ç¾¤å½“ä¸­ï¼Œç›´åˆ°é›†ç¾¤çš„èŠ‚ç‚¹æ•°ç­‰äºsizeã€‚</strong></p>\n<p>è¿™å°±æ„å‘³ç€ï¼Œåœ¨ç”Ÿæˆä¸åŒè§’è‰²çš„Etcd Podæ—¶ï¼ŒOperatoréœ€è¦èƒ½å¤ŸåŒºåˆ†ç§å­èŠ‚ç‚¹ä¸æ™®é€šèŠ‚ç‚¹ã€‚</p>\n<p>è€Œè¿™ä¸¤ç§èŠ‚ç‚¹çš„ä¸åŒä¹‹å¤„ï¼Œå°±åœ¨äºä¸€ä¸ªåå«â€“initial-cluster-stateçš„å¯åŠ¨å‚æ•°ï¼š</p>\n<ul>\n<li>å½“è¿™ä¸ªå‚æ•°å€¼è®¾ä¸ºnewæ—¶ï¼Œå°±ä»£è¡¨äº†è¯¥èŠ‚ç‚¹æ˜¯ç§å­èŠ‚ç‚¹ã€‚è€Œæˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œç§å­èŠ‚ç‚¹è¿˜å¿…é¡»é€šè¿‡â€“initial-cluster-tokenå£°æ˜ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„Tokenã€‚</li>\n<li>è€Œå¦‚æœè¿™ä¸ªå‚æ•°å€¼è®¾ä¸ºexistingï¼Œé‚£å°±æ˜¯è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ™®é€šèŠ‚ç‚¹ï¼ŒEtcd Operatoréœ€è¦æŠŠå®ƒåŠ å…¥åˆ°å·²æœ‰é›†ç¾¤é‡Œã€‚</li>\n</ul>\n<p>é‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œæ¯ä¸ªEtcdèŠ‚ç‚¹çš„â€“initial-clusterå­—æ®µçš„å€¼åˆæ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿ</p>\n<p>ç”±äºè¿™ä¸ªæ–¹æ¡ˆè¦æ±‚ç§å­èŠ‚ç‚¹å…ˆå¯åŠ¨ï¼Œæ‰€ä»¥å¯¹äºç§å­èŠ‚ç‚¹infra0æ¥è¯´ï¼Œå®ƒå¯åŠ¨åçš„é›†ç¾¤åªæœ‰å®ƒè‡ªå·±ï¼Œå³ï¼šâ€“initial-cluster=infra0=http://10.0.1.10:2380ã€‚</p>\n<p>è€Œå¯¹äºæ¥ä¸‹æ¥è¦åŠ å…¥çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚infra1æ¥è¯´ï¼Œå®ƒå¯åŠ¨åçš„é›†ç¾¤å°±æœ‰ä¸¤ä¸ªèŠ‚ç‚¹äº†ï¼Œæ‰€ä»¥å®ƒçš„â€“initial-clusterå‚æ•°çš„å€¼åº”è¯¥æ˜¯ï¼šinfra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380ã€‚</p>\n<p>å…¶ä»–èŠ‚ç‚¹ï¼Œéƒ½ä»¥æ­¤ç±»æ¨ã€‚</p>\n<p>ç°åœ¨ï¼Œä½ å°±åº”è¯¥èƒ½åœ¨è„‘æµ·ä¸­æ„æ€å‡ºä¸Šè¿°ä¸‰èŠ‚ç‚¹Etcdé›†ç¾¤çš„éƒ¨ç½²è¿‡ç¨‹äº†ã€‚</p>\n<p>é¦–å…ˆï¼Œåªè¦ç”¨æˆ·æäº¤YAMLæ–‡ä»¶æ—¶å£°æ˜åˆ›å»ºä¸€ä¸ªEtcdClusterå¯¹è±¡ï¼ˆä¸€ä¸ªEtcdé›†ç¾¤ï¼‰ï¼Œé‚£ä¹ˆEtcd Operatoréƒ½åº”è¯¥å…ˆåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„ç§å­é›†ç¾¤ï¼ˆSeed Memberï¼‰ï¼Œå¹¶å¯åŠ¨è¿™ä¸ªç§å­èŠ‚ç‚¹ã€‚</p>\n<p>ä»¥infra0èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå®ƒçš„IPåœ°å€æ˜¯10.0.1.10ï¼Œé‚£ä¹ˆEtcd Operatorç”Ÿæˆçš„ç§å­èŠ‚ç‚¹çš„å¯åŠ¨å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>$ etcd\n  --data-dir=/var/etcd/data\n  --name=infra0\n  --initial-advertise-peer-urls=http://10.0.1.10:2380\n  --listen-peer-urls=http://0.0.0.0:2380\n  --listen-client-urls=http://0.0.0.0:2379\n  --advertise-client-urls=http://10.0.1.10:2379\n  --initial-cluster=infra0=http://10.0.1.10:2380\n  --initial-cluster-state=new\n  --initial-cluster-token=4b5215fa-5401-4a95-a8c6-892317c9bef8\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç§å­èŠ‚ç‚¹çš„initial-cluster-stateæ˜¯newï¼Œå¹¶ä¸”æŒ‡å®šäº†å”¯ä¸€çš„initial-cluster-tokenå‚æ•°ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªåˆ›å»ºç§å­èŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰çš„é˜¶æ®µç§°ä¸ºï¼š<strong>Bootstrap</strong>ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œ<strong>å¯¹äºå…¶ä»–æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒOperatoråªéœ€è¦æ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªæ“ä½œå³å¯</strong>ï¼Œä»¥infra1ä¸ºä¾‹ã€‚</p>\n<p>ç¬¬ä¸€æ­¥ï¼šé€šè¿‡Etcdå‘½ä»¤è¡Œæ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ï¼š</p>\n<pre><code>$ etcdctl member add infra1 http://10.0.1.11:2380\n</code></pre>\n<p>ç¬¬äºŒæ­¥ï¼šä¸ºè¿™ä¸ªæˆå‘˜èŠ‚ç‚¹ç”Ÿæˆå¯¹åº”çš„å¯åŠ¨å‚æ•°ï¼Œå¹¶å¯åŠ¨å®ƒï¼š</p>\n<pre><code>$ etcd\n    --data-dir=/var/etcd/data\n    --name=infra1\n    --initial-advertise-peer-urls=http://10.0.1.11:2380\n    --listen-peer-urls=http://0.0.0.0:2380\n    --listen-client-urls=http://0.0.0.0:2379\n    --advertise-client-urls=http://10.0.1.11:2379\n    --initial-cluster=infra0=http://10.0.1.10:2380,infra1=http://10.0.1.11:2380\n    --initial-cluster-state=existing\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºè¿™ä¸ªinfra1æˆå‘˜èŠ‚ç‚¹æ¥è¯´ï¼Œå®ƒçš„initial-cluster-stateæ˜¯existingï¼Œä¹Ÿå°±æ˜¯è¦åŠ å…¥å·²æœ‰é›†ç¾¤ã€‚è€Œå®ƒçš„initial-clusterçš„å€¼ï¼Œåˆ™å˜æˆäº†infra0å’Œinfra1ä¸¤ä¸ªèŠ‚ç‚¹çš„IPåœ°å€ã€‚</p>\n<p>æ‰€ä»¥ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸æ–­åœ°å°†infra2ç­‰åç»­æˆå‘˜æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œç›´åˆ°æ•´ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹æ•°ç›®ç­‰äºç”¨æˆ·æŒ‡å®šçš„sizeä¹‹åï¼Œéƒ¨ç½²å°±å®Œæˆäº†ã€‚</p>\n<p>åœ¨ç†Ÿæ‚‰äº†è¿™ä¸ªéƒ¨ç½²æ€è·¯ä¹‹åï¼Œæˆ‘å†ä¸ºä½ è®²è§£<span class=\"orange\">Etcd Operatorçš„å·¥ä½œåŸç†</span>ï¼Œå°±éå¸¸ç®€å•äº†ã€‚</p>\n<p>è·Ÿæ‰€æœ‰çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ä¸€æ ·ï¼ŒEtcd Operatorçš„å¯åŠ¨æµç¨‹ä¹Ÿæ˜¯å›´ç»•ç€Informerå±•å¼€çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>func (c *Controller) Start() error {\n for {\n  err := c.initResource()\n  ...\n  time.Sleep(initRetryWaitTime)\n }\n c.run()\n}\n\nfunc (c *Controller) run() {\n ...\n \n _, informer := cache.NewIndexerInformer(source, &amp;api.EtcdCluster{}, 0, cache.ResourceEventHandlerFuncs{\n  AddFunc:    c.onAddEtcdClus,\n  UpdateFunc: c.onUpdateEtcdClus,\n  DeleteFunc: c.onDeleteEtcdClus,\n }, cache.Indexers{})\n \n ctx := context.TODO()\n // TODO: use workqueue to avoid blocking\n informer.Run(ctx.Done())\n}\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>Etcd Operatorå¯åŠ¨è¦åšçš„ç¬¬ä¸€ä»¶äº‹</strong>ï¼ˆ c.initResourceï¼‰ï¼Œæ˜¯åˆ›å»ºEtcdClusterå¯¹è±¡æ‰€éœ€è¦çš„CRDï¼Œå³ï¼šå‰é¢æåˆ°çš„<code>etcdclusters.etcd.database.coreos.com</code>ã€‚è¿™æ ·Kuberneteså°±èƒ½å¤Ÿâ€œè®¤è¯†â€EtcdClusterè¿™ä¸ªè‡ªå®šä¹‰APIèµ„æºäº†ã€‚</p>\n<p>è€Œ<strong>æ¥ä¸‹æ¥ï¼ŒEtcd Operatorä¼šå®šä¹‰ä¸€ä¸ªEtcdClusterå¯¹è±¡çš„Informer</strong>ã€‚</p>\n<p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºEtcd Operatorçš„å®Œæˆæ—¶é—´ç›¸å¯¹è¾ƒæ—©ï¼Œæ‰€ä»¥å®ƒé‡Œé¢æœ‰äº›ä»£ç çš„ç¼–å†™æ–¹å¼ä¼šè·Ÿæˆ‘ä»¬ä¹‹å‰è®²è§£çš„æœ€æ–°çš„ç¼–å†™æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚åœ¨å…·ä½“å®è·µçš„æ—¶å€™ï¼Œä½ è¿˜æ˜¯åº”è¯¥ä»¥æˆ‘è®²è§£çš„æ¨¡æ¿ä¸ºä¸»ã€‚</p>\n<p>æ¯”å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä»£ç æœ€åï¼Œä½ ä¼šçœ‹åˆ°æœ‰è¿™æ ·ä¸€å¥æ³¨é‡Šï¼š</p>\n<pre><code>// TODO: use workqueue to avoid blocking\n...\n</code></pre>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒEtcd Operatorå¹¶æ²¡æœ‰ç”¨å·¥ä½œé˜Ÿåˆ—æ¥åè°ƒInformerå’Œæ§åˆ¶å¾ªç¯ã€‚è¿™å…¶å®æ­£æ˜¯æˆ‘åœ¨ç¬¬25ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/42076\">ã€Šæ·±å…¥è§£æå£°æ˜å¼APIï¼ˆäºŒï¼‰ï¼šç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‹</a>ä¸­ï¼Œç»™ä½ ç•™çš„å…³äºå·¥ä½œé˜Ÿåˆ—çš„æ€è€ƒé¢˜çš„ç­”æ¡ˆã€‚</p>\n<p>å…·ä½“æ¥è®²ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å¾ªç¯é‡Œæ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¾€å¾€æ˜¯æ¯”è¾ƒè€—æ—¶é—´çš„ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªçœŸå®çš„Etcdé›†ç¾¤ã€‚è€ŒInformerçš„WATCHæœºåˆ¶å¯¹APIå¯¹è±¡å˜åŒ–çš„å“åº”ï¼Œåˆ™éå¸¸è¿…é€Ÿã€‚æ‰€ä»¥ï¼Œæ§åˆ¶å™¨é‡Œçš„ä¸šåŠ¡é€»è¾‘å°±å¾ˆå¯èƒ½ä¼šæ‹–æ…¢Informerçš„æ‰§è¡Œå‘¨æœŸï¼Œç”šè‡³å¯èƒ½Blockå®ƒã€‚è€Œè¦åè°ƒè¿™æ ·ä¸¤ä¸ªå¿«ã€æ…¢ä»»åŠ¡çš„ä¸€ä¸ªå…¸å‹è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯å¼•å…¥ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ã€‚</p>\n<blockquote>\n<p>å¤‡æ³¨ï¼šå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç»™Etcd Operatoræä¸€ä¸ªpatchæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚æPRä¿®TODOï¼Œæ˜¯ç»™ä¸€ä¸ªå¼€æºé¡¹ç›®åšæœ‰æ„ä¹‰çš„è´¡çŒ®çš„ä¸€ä¸ªé‡è¦æ–¹å¼ã€‚</p>\n</blockquote>\n<p>ç”±äºEtcd Operatoré‡Œæ²¡æœ‰å·¥ä½œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„EventHandleréƒ¨åˆ†ï¼Œå°±ä¸ä¼šæœ‰ä»€ä¹ˆå…¥é˜Ÿæ“ä½œï¼Œè€Œç›´æ¥å°±æ˜¯æ¯ç§äº‹ä»¶å¯¹åº”çš„å…·ä½“çš„ä¸šåŠ¡é€»è¾‘äº†ã€‚</p>\n<p>ä¸è¿‡ï¼ŒEtcd Operatoråœ¨ä¸šåŠ¡é€»è¾‘çš„å®ç°æ–¹å¼ä¸Šï¼Œä¸å¸¸è§„çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ç•¥æœ‰ä¸åŒã€‚æˆ‘æŠŠåœ¨è¿™ä¸€éƒ¨åˆ†çš„å·¥ä½œåŸç†ï¼Œæç‚¼æˆäº†ä¸€ä¸ªè¯¦ç»†çš„æµç¨‹å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/e7/36/e7f2905ae46e0ccd24db47c915382536.jpg?wh=1920*1080\" alt=\"\" /></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒEtcd Operatorçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå®ƒä¸ºæ¯ä¸€ä¸ªEtcdClusterå¯¹è±¡ï¼Œéƒ½å¯åŠ¨äº†ä¸€ä¸ªæ§åˆ¶å¾ªç¯ï¼Œâ€œå¹¶å‘â€åœ°å“åº”è¿™äº›å¯¹è±¡çš„å˜åŒ–ã€‚æ˜¾ç„¶ï¼Œè¿™ç§åšæ³•ä¸ä»…å¯ä»¥ç®€åŒ–Etcd Operatorçš„ä»£ç å®ç°ï¼Œè¿˜æœ‰åŠ©äºæé«˜å®ƒçš„å“åº”é€Ÿåº¦ã€‚</p>\n<p>ä»¥æ–‡ç« ä¸€å¼€å§‹çš„example-etcd-clusterçš„YAMLæ–‡ä»¶ä¸ºä¾‹ã€‚</p>\n<p>å½“è¿™ä¸ªYAMLæ–‡ä»¶ç¬¬ä¸€æ¬¡è¢«æäº¤åˆ°Kubernetesä¹‹åï¼ŒEtcd Operatorçš„Informerï¼Œå°±ä¼šç«‹åˆ»â€œæ„ŸçŸ¥â€åˆ°ä¸€ä¸ªæ–°çš„EtcdClusterå¯¹è±¡è¢«åˆ›å»ºäº†å‡ºæ¥ã€‚æ‰€ä»¥ï¼ŒEventHandleré‡Œçš„â€œæ·»åŠ â€äº‹ä»¶ä¼šè¢«è§¦å‘ã€‚</p>\n<p>è€Œè¿™ä¸ªHandlerè¦åšçš„æ“ä½œä¹Ÿå¾ˆç®€å•ï¼Œå³ï¼šåœ¨Etcd Operatorå†…éƒ¨åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Clusterå¯¹è±¡ï¼ˆcluster.Newï¼‰ï¼Œæ¯”å¦‚æµç¨‹å›¾é‡Œçš„Cluster1ã€‚</p>\n<p>è¿™ä¸ªClusterå¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªEtcdé›†ç¾¤åœ¨Operatorå†…éƒ¨çš„æè¿°ï¼Œæ‰€ä»¥å®ƒä¸çœŸå®çš„Etcdé›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„ã€‚</p>\n<p>è€Œä¸€ä¸ªClusterå¯¹è±¡éœ€è¦å…·ä½“è´Ÿè´£çš„ï¼Œå…¶å®æœ‰ä¸¤ä¸ªå·¥ä½œã€‚</p>\n<p><strong>å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå·¥ä½œåªåœ¨è¯¥Clusterå¯¹è±¡ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸ªå·¥ä½œï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°è¿‡çš„Bootstrapï¼Œå³ï¼šåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„ç§å­é›†ç¾¤ã€‚</strong></p>\n<p>ç”±äºç§å­é›†ç¾¤åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥ç›´æ¥å°±ä¼šç”Ÿæˆä¸€ä¸ªEtcdçš„Podå¯¹è±¡ã€‚è¿™ä¸ªPodé‡Œæœ‰ä¸€ä¸ªInitContainerï¼Œè´Ÿè´£æ£€æŸ¥Podçš„DNSè®°å½•æ˜¯å¦æ­£å¸¸ã€‚å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œç”¨æˆ·å®¹å™¨ä¹Ÿå°±æ˜¯Etcdå®¹å™¨å°±ä¼šå¯åŠ¨èµ·æ¥ã€‚</p>\n<p>è€Œè¿™ä¸ªEtcdå®¹å™¨æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå½“ç„¶å°±æ˜¯å®ƒçš„å¯åŠ¨å‘½ä»¤äº†ã€‚</p>\n<p>ä»¥æˆ‘ä»¬åœ¨æ–‡ç« ä¸€å¼€å§‹éƒ¨ç½²çš„é›†ç¾¤ä¸ºä¾‹ï¼Œå®ƒçš„ç§å­èŠ‚ç‚¹çš„å®¹å™¨å¯åŠ¨å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code>/usr/local/bin/etcd\n  --data-dir=/var/etcd/data\n  --name=example-etcd-cluster-mbzlg6sd56\n  --initial-advertise-peer-urls=http://example-etcd-cluster-mbzlg6sd56.example-etcd-cluster.default.svc:2380\n  --listen-peer-urls=http://0.0.0.0:2380\n  --listen-client-urls=http://0.0.0.0:2379\n  --advertise-client-urls=http://example-etcd-cluster-mbzlg6sd56.example-etcd-cluster.default.svc:2379\n  --initial-cluster=example-etcd-cluster-mbzlg6sd56=http://example-etcd-cluster-mbzlg6sd56.example-etcd-cluster.default.svc:2380\n  --initial-cluster-state=new\n  --initial-cluster-token=4b5215fa-5401-4a95-a8c6-892317c9bef8\n</code></pre>\n<p>ä¸Šè¿°å¯åŠ¨å‘½ä»¤é‡Œçš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œæˆ‘å·²ç»åœ¨å‰é¢ä»‹ç»è¿‡ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™äº›å¯åŠ¨å‚æ•°ï¼ˆæ¯”å¦‚ï¼šinitial-clusterï¼‰é‡Œï¼ŒEtcd Operatoråªä¼šä½¿ç”¨Podçš„DNSè®°å½•ï¼Œè€Œä¸æ˜¯å®ƒçš„IPåœ°å€ã€‚</p>\n<p>è¿™å½“ç„¶æ˜¯å› ä¸ºï¼Œåœ¨Operatorç”Ÿæˆä¸Šè¿°å¯åŠ¨å‘½ä»¤çš„æ—¶å€™ï¼ŒEtcdçš„Podè¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œå®ƒçš„IPåœ°å€è‡ªç„¶ä¹Ÿæ— ä»è°ˆèµ·ã€‚</p>\n<p>è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæ¯ä¸ªClusterå¯¹è±¡ï¼Œéƒ½ä¼šäº‹å…ˆåˆ›å»ºä¸€ä¸ªä¸è¯¥EtcdClusteråŒåçš„Headless Serviceã€‚è¿™æ ·ï¼ŒEtcd Operatoråœ¨æ¥ä¸‹æ¥çš„æ‰€æœ‰åˆ›å»ºPodçš„æ­¥éª¤é‡Œï¼Œå°±éƒ½å¯ä»¥ä½¿ç”¨Podçš„DNSè®°å½•æ¥ä»£æ›¿å®ƒçš„IPåœ°å€äº†ã€‚</p>\n<blockquote>\n<p>å¤‡æ³¨ï¼šHeadless Serviceçš„DNSè®°å½•æ ¼å¼æ˜¯ï¼š<pod-name>.<svc-name>.<namespace>.svc.cluster.localã€‚å¦‚æœä½ è®°ä¸å¤ªæ¸…æ¥šäº†ï¼Œå¯ä»¥å€Ÿæ­¤å†å›é¡¾ä¸€ä¸‹ç¬¬18ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/41017\">ã€Šæ·±å…¥ç†è§£StatefulSetï¼ˆä¸€ï¼‰ï¼šæ‹“æ‰‘çŠ¶æ€ã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p>\n</blockquote>\n<p><strong>Clusterå¯¹è±¡çš„ç¬¬äºŒä¸ªå·¥ä½œï¼Œåˆ™æ˜¯å¯åŠ¨è¯¥é›†ç¾¤æ‰€å¯¹åº”çš„æ§åˆ¶å¾ªç¯ã€‚</strong></p>\n<p>è¿™ä¸ªæ§åˆ¶å¾ªç¯æ¯éš”ä¸€å®šæ—¶é—´ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡ä¸‹é¢çš„Diffæµç¨‹ã€‚</p>\n<p>é¦–å…ˆï¼Œæ§åˆ¶å¾ªç¯è¦è·å–åˆ°æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ã€å±äºè¿™ä¸ªClusterçš„Podæ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯¥Etcdé›†ç¾¤çš„â€œå®é™…çŠ¶æ€â€ã€‚</p>\n<p>è€Œè¿™ä¸ªEtcdé›†ç¾¤çš„â€œæœŸæœ›çŠ¶æ€â€ï¼Œæ­£æ˜¯ç”¨æˆ·åœ¨EtcdClusterå¯¹è±¡é‡Œå®šä¹‰çš„sizeã€‚</p>\n<p>æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæ§åˆ¶å¾ªç¯ä¼šå¯¹æ¯”è¿™ä¸¤ä¸ªçŠ¶æ€çš„å·®å¼‚ã€‚</p>\n<p>å¦‚æœå®é™…çš„Podæ•°é‡ä¸å¤Ÿï¼Œé‚£ä¹ˆæ§åˆ¶å¾ªç¯å°±ä¼šæ‰§è¡Œä¸€ä¸ªæ·»åŠ æˆå‘˜èŠ‚ç‚¹çš„æ“ä½œï¼ˆå³ï¼šä¸Šè¿°æµç¨‹å›¾ä¸­çš„addOneMemberæ–¹æ³•ï¼‰ï¼›åä¹‹ï¼Œå°±æ‰§è¡Œåˆ é™¤æˆå‘˜èŠ‚ç‚¹çš„æ“ä½œï¼ˆå³ï¼šä¸Šè¿°æµç¨‹å›¾ä¸­çš„removeOneMemberæ–¹æ³•ï¼‰ã€‚</p>\n<p>ä»¥addOneMemberæ–¹æ³•ä¸ºä¾‹ï¼Œå®ƒæ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<ol>\n<li>\n<p>ç”Ÿæˆä¸€ä¸ªæ–°èŠ‚ç‚¹çš„Podçš„åå­—ï¼Œæ¯”å¦‚ï¼šexample-etcd-cluster-v6v6s6stxdï¼›</p>\n</li>\n<li>\n<p>è°ƒç”¨Etcd Clientï¼Œæ‰§è¡Œå‰é¢æåˆ°è¿‡çš„etcdctl member add example-etcd-cluster-v6v6s6stxdå‘½ä»¤ï¼›</p>\n</li>\n<li>\n<p>ä½¿ç”¨è¿™ä¸ªPodåå­—ï¼Œå’Œå·²ç»å­˜åœ¨çš„æ‰€æœ‰èŠ‚ç‚¹åˆ—è¡¨ï¼Œç»„åˆæˆä¸€ä¸ªæ–°çš„initial-clusterå­—æ®µçš„å€¼ï¼›</p>\n</li>\n<li>\n<p>ä½¿ç”¨è¿™ä¸ªinitial-clusterçš„å€¼ï¼Œç”Ÿæˆè¿™ä¸ªPodé‡ŒEtcdå®¹å™¨çš„å¯åŠ¨å‘½ä»¤ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n</li>\n</ol>\n<pre><code>/usr/local/bin/etcd\n  --data-dir=/var/etcd/data\n  --name=example-etcd-cluster-v6v6s6stxd\n  --initial-advertise-peer-urls=http://example-etcd-cluster-v6v6s6stxd.example-etcd-cluster.default.svc:2380\n  --listen-peer-urls=http://0.0.0.0:2380\n  --listen-client-urls=http://0.0.0.0:2379\n  --advertise-client-urls=http://example-etcd-cluster-v6v6s6stxd.example-etcd-cluster.default.svc:2379\n  --initial-cluster=example-etcd-cluster-mbzlg6sd56=http://example-etcd-cluster-mbzlg6sd56.example-etcd-cluster.default.svc:2380,example-etcd-cluster-v6v6s6stxd=http://example-etcd-cluster-v6v6s6stxd.example-etcd-cluster.default.svc:2380\n  --initial-cluster-state=existing\n</code></pre>\n<p>è¿™æ ·ï¼Œå½“è¿™ä¸ªå®¹å™¨å¯åŠ¨ä¹‹åï¼Œä¸€ä¸ªæ–°çš„Etcdæˆå‘˜èŠ‚ç‚¹å°±è¢«åŠ å…¥åˆ°äº†é›†ç¾¤å½“ä¸­ã€‚æ§åˆ¶å¾ªç¯ä¼šé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ­£åœ¨è¿è¡Œçš„Podæ•°é‡ä¸EtcdClusteræŒ‡å®šçš„sizeä¸€è‡´ã€‚</p>\n<p>åœ¨æœ‰äº†è¿™æ ·ä¸€ä¸ªä¸EtcdClusterå¯¹è±¡ä¸€ä¸€å¯¹åº”çš„æ§åˆ¶å¾ªç¯ä¹‹åï¼Œä½ åç»­å¯¹è¿™ä¸ªEtcdClusterçš„ä»»ä½•ä¿®æ”¹ï¼Œæ¯”å¦‚ï¼šä¿®æ”¹sizeæˆ–è€…Etcdçš„versionï¼Œå®ƒä»¬å¯¹åº”çš„æ›´æ–°äº‹ä»¶éƒ½ä¼šç”±è¿™ä¸ªClusterå¯¹è±¡çš„æ§åˆ¶å¾ªç¯è¿›è¡Œå¤„ç†ã€‚</p>\n<p>ä»¥ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªEtcd Operatorçš„å·¥ä½œåŸç†äº†ã€‚</p>\n<p>å¦‚æœå¯¹æ¯”ä¸€ä¸‹Etcd Operatorä¸æˆ‘åœ¨ç¬¬20ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/41217\">ã€Šæ·±å…¥ç†è§£StatefulSetï¼ˆä¸‰ï¼‰ï¼šæœ‰çŠ¶æ€åº”ç”¨å®è·µã€‹</a>ä¸­è®²è§£è¿‡çš„MySQL StatefulSetçš„è¯ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚</p>\n<p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯</strong>ï¼Œåœ¨StatefulSeté‡Œï¼Œå®ƒä¸ºPodåˆ›å»ºçš„åå­—æ˜¯å¸¦ç¼–å·çš„ï¼Œè¿™æ ·å°±æŠŠæ•´ä¸ªé›†ç¾¤çš„æ‹“æ‰‘çŠ¶æ€å›ºå®šäº†ä¸‹æ¥ï¼ˆæ¯”å¦‚ï¼šä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤ä¸€å®šæ˜¯ç”±åå«web-0ã€web-1å’Œweb-2çš„ä¸‰ä¸ªPodç»„æˆï¼‰ã€‚å¯æ˜¯ï¼Œ<strong>åœ¨Etcd Operatoré‡Œï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨éšæœºåå­—å°±å¯ä»¥äº†å‘¢ï¼Ÿ</strong></p>\n<p>è¿™æ˜¯å› ä¸ºï¼ŒEtcd Operatoråœ¨æ¯æ¬¡æ·»åŠ EtcdèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œetcdctl member add &lt;Podåå­—&gt;ï¼›æ¯æ¬¡åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåˆ™ä¼šæ‰§è¡Œetcdctl member remove &lt;Podåå­—&gt;ã€‚è¿™äº›æ“ä½œï¼Œå…¶å®å°±ä¼šæ›´æ–°Etcdå†…éƒ¨ç»´æŠ¤çš„æ‹“æ‰‘ä¿¡æ¯ï¼Œæ‰€ä»¥Etcd Operatoræ— éœ€åœ¨é›†ç¾¤å¤–éƒ¨é€šè¿‡ç¼–å·æ¥å›ºå®šè¿™ä¸ªæ‹“æ‰‘å…³ç³»ã€‚</p>\n<p><strong>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰åœ¨EtcdClusterå¯¹è±¡é‡Œå£°æ˜Persistent Volumeï¼Ÿ</strong></p>\n<p>éš¾é“ï¼Œæˆ‘ä»¬ä¸æ‹…å¿ƒèŠ‚ç‚¹å®•æœºä¹‹åEtcdçš„æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ</p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼ŒEtcdæ˜¯ä¸€ä¸ªåŸºäºRaftåè®®å®ç°çš„é«˜å¯ç”¨Key-Valueå­˜å‚¨ã€‚æ ¹æ®Raftåè®®çš„è®¾è®¡åŸåˆ™ï¼Œå½“Etcdé›†ç¾¤é‡Œåªæœ‰åŠæ•°ä»¥ä¸‹ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œå°äºç­‰äºä¸€ä¸ªï¼‰çš„èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œå½“å‰é›†ç¾¤ä¾ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚æ­¤æ—¶ï¼ŒEtcd Operatoråªéœ€è¦é€šè¿‡æ§åˆ¶å¾ªç¯åˆ›å»ºå‡ºæ–°çš„Podï¼Œç„¶åå°†å®ƒä»¬åŠ å…¥åˆ°ç°æœ‰é›†ç¾¤é‡Œï¼Œå°±å®Œæˆäº†â€œæœŸæœ›çŠ¶æ€â€ä¸â€œå®é™…çŠ¶æ€â€çš„è°ƒè°å·¥ä½œã€‚è¿™ä¸ªé›†ç¾¤ï¼Œæ˜¯ä¸€ç›´å¯ç”¨çš„ ã€‚</p>\n<blockquote>\n<p>å¤‡æ³¨ï¼šå…³äºEtcdçš„å·¥ä½œåŸç†å’ŒRaftåè®®çš„è®¾è®¡æ€æƒ³ï¼Œä½ å¯ä»¥é˜…è¯»<a href=\"http://www.infoq.com/cn/articles/etcd-interpretation-application-scenario-implement-principle\">è¿™ç¯‡æ–‡ç« </a>æ¥è¿›è¡Œå­¦ä¹ ã€‚</p>\n</blockquote>\n<p>ä½†æ˜¯ï¼Œå½“è¿™ä¸ªEtcdé›†ç¾¤é‡Œæœ‰åŠæ•°ä»¥ä¸Šï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œï¼Œå¤§äºç­‰äºä¸¤ä¸ªï¼‰çš„èŠ‚ç‚¹å¤±æ•ˆçš„æ—¶å€™ï¼Œè¿™ä¸ªé›†ç¾¤å°±ä¼šä¸§å¤±æ•°æ®å†™å…¥çš„èƒ½åŠ›ï¼Œä»è€Œè¿›å…¥â€œä¸å¯ç”¨â€çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œå³ä½¿Etcd Operatoråˆ›å»ºå‡ºæ–°çš„Podå‡ºæ¥ï¼ŒEtcdé›†ç¾¤æœ¬èº«ä¹Ÿæ— æ³•è‡ªåŠ¨æ¢å¤èµ·æ¥ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¿…é¡»ä½¿ç”¨Etcdæœ¬èº«çš„å¤‡ä»½æ•°æ®æ¥å¯¹é›†ç¾¤è¿›è¡Œæ¢å¤æ“ä½œã€‚</p>\n<p>åœ¨æœ‰äº†Operatoræœºåˆ¶ä¹‹åï¼Œä¸Šè¿°Etcdçš„å¤‡ä»½æ“ä½œï¼Œæ˜¯ç”±ä¸€ä¸ªå•ç‹¬çš„Etcd Backup Operatorè´Ÿè´£å®Œæˆçš„ã€‚</p>\n<p>åˆ›å»ºå’Œä½¿ç”¨è¿™ä¸ªOperatorçš„æµç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code># é¦–å…ˆï¼Œåˆ›å»ºetcd-backup-operator\n$ kubectl create -f example/etcd-backup-operator/deployment.yaml\n\n# ç¡®è®¤etcd-backup-operatorå·²ç»åœ¨æ­£å¸¸è¿è¡Œ\n$ kubectl get pod\nNAME                                    READY     STATUS    RESTARTS   AGE\netcd-backup-operator-1102130733-hhgt7   1/1       Running   0          3s\n\n# å¯ä»¥çœ‹åˆ°ï¼ŒBackup Operatorä¼šåˆ›å»ºä¸€ä¸ªå«etcdbackupsçš„CRD\n$ kubectl get crd\nNAME                                    KIND\netcdbackups.etcd.database.coreos.com    CustomResourceDefinition.v1beta1.apiextensions.k8s.io\n\n# æˆ‘ä»¬è¿™é‡Œè¦ä½¿ç”¨AWS S3æ¥å­˜å‚¨å¤‡ä»½ï¼Œéœ€è¦å°†S3çš„æˆæƒä¿¡æ¯é…ç½®åœ¨æ–‡ä»¶é‡Œ\n$ cat $AWS_DIR/credentials\n[default]\naws_access_key_id = XXX\naws_secret_access_key = XXX\n\n$ cat $AWS_DIR/config\n[default]\nregion = &lt;region&gt;\n\n# ç„¶åï¼Œå°†ä¸Šè¿°æˆæƒä¿¡æ¯åˆ¶ä½œæˆä¸€ä¸ªSecret\n$ kubectl create secret generic aws --from-file=$AWS_DIR/credentials --from-file=$AWS_DIR/config\n\n# ä½¿ç”¨ä¸Šè¿°S3çš„è®¿é—®ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªEtcdBackupå¯¹è±¡\n$ sed -e 's|&lt;full-s3-path&gt;|mybucket/etcd.backup|g' \\\n    -e 's|&lt;aws-secret&gt;|aws|g' \\\n    -e 's|&lt;etcd-cluster-endpoints&gt;|&quot;http://example-etcd-cluster-client:2379&quot;|g' \\\n    example/etcd-backup-operator/backup_cr.yaml \\\n    | kubectl create -f -\n</code></pre>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯å½“ä½ åˆ›å»ºä¸€ä¸ªEtcdBackupå¯¹è±¡ï¼ˆ<a href=\"https://github.com/coreos/etcd-operator/blob/master/example/etcd-backup-operator/backup_cr.yaml\">backup_cr.yaml</a>ï¼‰ï¼Œå°±ç›¸å½“äºä¸ºå®ƒæ‰€æŒ‡å®šçš„Etcdé›†ç¾¤åšäº†ä¸€æ¬¡å¤‡ä»½ã€‚EtcdBackupå¯¹è±¡çš„etcdEndpointså­—æ®µï¼Œä¼šæŒ‡å®šå®ƒè¦å¤‡ä»½çš„Etcdé›†ç¾¤çš„è®¿é—®åœ°å€ã€‚</p>\n<p>æ‰€ä»¥ï¼Œåœ¨å®é™…çš„ç¯å¢ƒé‡Œï¼Œæˆ‘å»ºè®®ä½ æŠŠæœ€åè¿™ä¸ªå¤‡ä»½æ“ä½œï¼Œç¼–å†™æˆä¸€ä¸ªKubernetesçš„CronJobä»¥ä¾¿å®šæ—¶è¿è¡Œã€‚</p>\n<p>è€Œå½“Etcdé›†ç¾¤å‘ç”Ÿäº†æ•…éšœä¹‹åï¼Œä½ å°±å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªEtcdRestoreå¯¹è±¡æ¥å®Œæˆæ¢å¤æ“ä½œã€‚å½“ç„¶ï¼Œè¿™å°±æ„å‘³ç€ä½ ä¹Ÿéœ€è¦äº‹å…ˆå¯åŠ¨Etcd Restore Operatorã€‚</p>\n<p>è¿™ä¸ªæµç¨‹çš„å®Œæ•´è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre><code># åˆ›å»ºetcd-restore-operator\n$ kubectl create -f example/etcd-restore-operator/deployment.yaml\n\n# ç¡®è®¤å®ƒå·²ç»æ­£å¸¸è¿è¡Œ\n$ kubectl get pods\nNAME                                     READY     STATUS    RESTARTS   AGE\netcd-restore-operator-4203122180-npn3g   1/1       Running   0          7s\n\n# åˆ›å»ºä¸€ä¸ªEtcdRestoreå¯¹è±¡ï¼Œæ¥å¸®åŠ©Etcd Operatoræ¢å¤æ•°æ®ï¼Œè®°å¾—æ›¿æ¢æ¨¡æ¿é‡Œçš„S3çš„è®¿é—®ä¿¡æ¯\n$ sed -e 's|&lt;full-s3-path&gt;|mybucket/etcd.backup|g' \\\n    -e 's|&lt;aws-secret&gt;|aws|g' \\\n    example/etcd-restore-operator/restore_cr.yaml \\\n    | kubectl create -f -\n</code></pre>\n<p>ä¸Šé¢ä¾‹å­é‡Œçš„EtcdRestoreå¯¹è±¡ï¼ˆ<a href=\"https://github.com/coreos/etcd-operator/blob/master/example/etcd-restore-operator/restore_cr.yaml\">restore_cr.yaml</a>ï¼‰ï¼Œä¼šæŒ‡å®šå®ƒè¦æ¢å¤çš„Etcdé›†ç¾¤çš„åå­—å’Œå¤‡ä»½æ•°æ®æ‰€åœ¨çš„S3å­˜å‚¨çš„è®¿é—®ä¿¡æ¯ã€‚</p>\n<p>è€Œå½“ä¸€ä¸ªEtcdRestoreå¯¹è±¡æˆåŠŸåˆ›å»ºåï¼ŒEtcd Restore Operatorå°±ä¼šé€šè¿‡ä¸Šè¿°ä¿¡æ¯ï¼Œæ¢å¤å‡ºä¸€ä¸ªå…¨æ–°çš„Etcdé›†ç¾¤ã€‚ç„¶åï¼ŒEtcd Operatorä¼šæŠŠè¿™ä¸ªæ–°é›†ç¾¤ç›´æ¥æ¥ç®¡è¿‡æ¥ï¼Œä»è€Œé‡æ–°è¿›å…¥å¯ç”¨çš„çŠ¶æ€ã€‚</p>\n<p>EtcdBackupå’ŒEtcdRestoreè¿™ä¸¤ä¸ªOperatorçš„å·¥ä½œåŸç†ï¼Œä¸Etcd Operatorçš„å®ç°æ–¹å¼éå¸¸ç±»ä¼¼ã€‚æ‰€ä»¥ï¼Œè¿™ä¸€éƒ¨åˆ†å°±äº¤ç»™ä½ è¯¾åå»æ¢ç´¢äº†ã€‚</p>\n<h2>æ€»ç»“</h2>\n<p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¥Etcd Operatorä¸ºä¾‹ï¼Œè¯¦ç»†ä»‹ç»äº†ä¸€ä¸ªOperatorçš„å·¥ä½œåŸç†å’Œç¼–å†™è¿‡ç¨‹ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒEtcdé›†ç¾¤æœ¬èº«å°±æ‹¥æœ‰è‰¯å¥½çš„åˆ†å¸ƒå¼è®¾è®¡å’Œä¸€å®šçš„é«˜å¯ç”¨èƒ½åŠ›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒStatefulSetâ€œä¸ºPodç¼–å·â€å’Œâ€œå°†PodåŒPVç»‘å®šâ€è¿™ä¸¤ä¸ªä¸»è¦çš„ç‰¹æ€§ï¼Œå°±ä¸å¤ªæœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚</p>\n<p>è€Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒEtcd OperatoræŠŠä¸€ä¸ªEtcdé›†ç¾¤ï¼ŒæŠ½è±¡æˆäº†ä¸€ä¸ªå…·æœ‰ä¸€å®šâ€œè‡ªæ²»èƒ½åŠ›â€çš„æ•´ä½“ã€‚è€Œå½“è¿™ä¸ªâ€œè‡ªæ²»èƒ½åŠ›â€æœ¬èº«ä¸è¶³ä»¥è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªä¸“é—¨è´Ÿè´£å¤‡ä»½å’Œæ¢å¤çš„Operatorè¿›è¡Œä¿®æ­£ã€‚è¿™ç§å®ç°æ–¹å¼ï¼Œä¸ä»…æ›´åŠ è´´è¿‘Etcdçš„è®¾è®¡æ€æƒ³ï¼Œä¹Ÿæ›´åŠ ç¼–ç¨‹å‹å¥½ã€‚</p>\n<p>ä¸è¿‡ï¼Œå¦‚æœæˆ‘ç°åœ¨è¦éƒ¨ç½²çš„åº”ç”¨ï¼Œæ—¢éœ€è¦ç”¨StatefulSetçš„æ–¹å¼ç»´æŒæ‹“æ‰‘çŠ¶æ€å’Œå­˜å‚¨çŠ¶æ€ï¼Œåˆæœ‰å¤§é‡çš„ç¼–ç¨‹å·¥ä½œè¦åšï¼Œé‚£æˆ‘åˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p>\n<p>å…¶å®ï¼ŒOperatorå’ŒStatefulSetå¹¶ä¸æ˜¯ç«äº‰å…³ç³»ã€‚ä½ å®Œå…¨å¯ä»¥ç¼–å†™ä¸€ä¸ªOperatorï¼Œç„¶ååœ¨Operatorçš„æ§åˆ¶å¾ªç¯é‡Œåˆ›å»ºå’Œæ§åˆ¶StatefulSetè€Œä¸æ˜¯Podã€‚æ¯”å¦‚ï¼Œä¸šç•ŒçŸ¥åçš„<a href=\"https://github.com/coreos/prometheus-operator\">Prometheusé¡¹ç›®çš„Operator</a>ï¼Œæ­£æ˜¯è¿™ä¹ˆå®ç°çš„ã€‚</p>\n<p>æ­¤å¤–ï¼ŒCoreOSå…¬å¸åœ¨è¢«RedHatå…¬å¸æ”¶è´­ä¹‹åï¼Œå·²ç»æŠŠOperatorçš„ç¼–å†™è¿‡ç¨‹å°è£…æˆäº†ä¸€ä¸ªå«ä½œ<a href=\"https://github.com/operator-framework/operator-sdk\">Operator SDK</a>çš„å·¥å…·ï¼ˆæ•´ä¸ªé¡¹ç›®å«ä½œOperator Frameworkï¼‰ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç”ŸæˆOperatorçš„æ¡†æ¶ä»£ç ã€‚æ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è¯•ç”¨ä¸€ä¸‹ã€‚</p>\n<h2>æ€è€ƒé¢˜</h2>\n<p>åœ¨Operatorçš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡ç”¨åˆ°äº†CRDã€‚å¯æ˜¯ï¼Œä½ ä¸€å®šè¦æ˜ç™½ï¼ŒCRDå¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒæœ‰å¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ï¼Œè¿˜æœ‰æ€§èƒ½ç“¶é¢ˆã€‚ä½ èƒ½åˆ—ä¸¾å‡ºä¸€äº›ä¸é€‚ç”¨CRDçš„åœºæ™¯ä¹ˆï¼Ÿä½ çŸ¥é“é€ æˆCRDæ€§èƒ½ç“¶é¢ˆçš„åŸå› ä¸»è¦åœ¨å“ªé‡Œä¹ˆï¼Ÿ</p>\n<p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>\n<p></p>\n","comments":[{"had_liked":false,"id":40154,"user_name":"å°ç†¹","can_delete":false,"product_type":"c1","uid":1218284,"ip_address":"","ucode":"05B12C9FAC2DD4","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/ec/5c53f9e5.jpg","comment_is_top":false,"comment_ctime":1542528908,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"306485206924","product_id":100015201,"comment_content":"CRDåœ¨ETCDé‡Œé¢æ˜¯ä»¥JSONæ ¼å¼æ¥å­˜å‚¨çš„ï¼Œè€ŒK8Sçš„APIå¯¹è±¡æ˜¯ä»¥protobufæ ¼å¼å­˜å‚¨ï¼Œåœ¨èµ„æºå¯¹è±¡æ•°é‡å¤šçš„æ—¶å€™JSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚","like_count":72,"discussions":[{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"é»„å±•å¿—","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206998,"discussion_content":"Thrift æ˜¯ Facebook å¼€æºçš„é«˜æ€§èƒ½çš„åºåˆ—åŒ–åè®®ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ RPC æ¡†æ¶ï¼›Protobuf æ˜¯è°·æ­Œå¼€æºçš„åºåˆ—åŒ–åè®®ã€‚å®ƒä»¬çš„å…±åŒç‰¹ç‚¹æ˜¯æ— è®ºåœ¨ç©ºé—´ä¸Šè¿˜æ˜¯æ—¶é—´ä¸Šéƒ½æœ‰ç€å¾ˆé«˜çš„æ€§èƒ½ï¼Œç¼ºç‚¹å°±æ˜¯ç”±äº IDL å­˜åœ¨å¸¦æ¥ä¸€äº›ä½¿ç”¨ä¸Šçš„ä¸æ–¹ä¾¿.åºåˆ—åŒ–åè®®ä¾æ®å…·ä½“ä¸šåŠ¡æ¥é€‰æ‹©ã€‚å¦‚æœå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜å¯ä»¥é€‰æ‹© JSONï¼Œå¦åˆ™å¯ä»¥ä» Thrift å’Œ Protobuf ä¸­é€‰æ‹©å…¶ä¸€","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1584456712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209721,"avatar":"https://static001.geekbang.org/account/avatar/00/12/75/79/b14fc914.jpg","nickname":"æ½‡æ´’æ´’","note":"","ucode":"D24838A0A1D6B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5036,"discussion_content":"è¿™å¾—æ˜¯æœ‰å¤šå°‘èµ„æºå•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565884157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52088,"user_name":"ç¨‹åºä¿®è¡Œ","can_delete":false,"product_type":"c1","uid":1257409,"ip_address":"","ucode":"2CCD5ACAFF0E8D","user_header":"","comment_is_top":false,"comment_ctime":1545307572,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"263538312628","product_id":100015201,"comment_content":" å·²ç»åˆ°äº†çœ‹ä¸æ‡‚çš„æ—¶å€™äº†ï½ã€‚ä¸§å¿ƒ","like_count":62,"discussions":[{"author":{"id":1259323,"avatar":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","nickname":"é™ˆæ–¯ä½³","note":"","ucode":"C236F874FC767A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159821,"discussion_content":"æˆ‘ä¹Ÿæ˜¯â€¦â€¦ä¸è¿‡æˆ‘ç°åœ¨çš„ç­–ç•¥æ˜¯å…ˆçœ‹ä¸€éï¼Œæ··ä¸ªè„¸ç†Ÿï¼Œç„¶åå†åå¤çœ‹ï¼Œåå¤ç»ƒã€‚å‰æœŸè¶Šçœ‹ä¸æ‡‚å°±è¯´æ˜è¿™ä¸ªè¶Šæœ‰å¯èƒ½æˆä¸ºæˆ‘ä»¬ä»¥åçš„æŠ¤åŸæ²³ã€‚ä¸€èµ·åŠ æ²¹ :ï¼‰","likes_number":26,"is_delete":false,"is_hidden":false,"ctime":1580735766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1751859,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/bb/33/5545b42e.jpg","nickname":"Bobo","note":"","ucode":"23102FBE943515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1259323,"avatar":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","nickname":"é™ˆæ–¯ä½³","note":"","ucode":"C236F874FC767A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355649,"discussion_content":"æœ€å¼€å§‹çš„æ—¶å€™ï¼Œçœ‹çš„å¯çˆ½äº†ï¼Œè¶Šçœ‹æ„Ÿè§‰è¶Šéš¾ã€‚","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1615466543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":159821,"ip_address":""},"score":355649,"extra":""},{"author":{"id":1259323,"avatar":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","nickname":"é™ˆæ–¯ä½³","note":"","ucode":"C236F874FC767A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1751859,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/bb/33/5545b42e.jpg","nickname":"Bobo","note":"","ucode":"23102FBE943515","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404545,"discussion_content":"çœ‹äº†ç¬¬ä¸‰éï¼Œè¿˜åœ¨æŒ£æ‰ç€ æœŸå¾…ç¬¬å››éèƒ½é¡¿æ‚Ÿ ğŸ˜‚ ç»§ç»­æ··è„¸ç†Ÿä¸­â€¦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634344930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":355649,"ip_address":""},"score":404545,"extra":""}]},{"author":{"id":1928682,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/6d/ea/2c5fcdb1.jpg","nickname":"ç¡è§‰ä¹Ÿåœ¨ç¬‘","note":"","ucode":"62381E78061843","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303163,"discussion_content":"ä¸ç”¨æ€•ï¼Œå…ˆçœ‹å®Œã€‚å…ˆç†è§£ï¼Œä¸ä¼šæ“ä½œæ²¡å…³ç³»äº‘å¹³å°ä¸Šéƒ½æ˜¯ç°æˆçš„ï¼Œä¸éœ€è¦ä½ çœŸçš„éƒ½è‡ªå·±è®¾ç½®ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599172847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004953,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/99/4bdadfd3.jpg","nickname":"Chloe","note":"","ucode":"C4848ED5B35752","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33190,"discussion_content":"æœ¨äº‹ï¼Œå¾ˆæ—©æˆ‘å°±å¼€å§‹äº†è¦å¥½å‡ éæ‰èƒ½é¢†ä¼šçš„é˜¶æ®µã€‚æ¸©æ•…è€ŒçŸ¥æ–°ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1571106824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390140,"discussion_content":"ä½ ä¸æ˜¯ä¸€ä¸ªäºº ï¼Œæˆ‘ä¹Ÿçœ‹ä¸å¤ªæ˜ç™½äº†ã€‚å¾—å¤šçœ‹å‡ é ï¼Œå®é™…åŠ¨æ‰‹æ“ä½œæ‰èƒ½æ…¢æ…¢é¢†æ‚Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629686867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014873,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7c/59/dc9bbb21.jpg","nickname":"Join","note":"","ucode":"20F51EFFD8FEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380671,"discussion_content":"operatoræŒºç«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624622807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34886,"user_name":"Vincen","can_delete":false,"product_type":"c1","uid":1218185,"ip_address":"","ucode":"1029A901EC7BA0","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/89/9312b3a2.jpg","comment_is_top":false,"comment_ctime":1540345444,"is_pvip":false,"replies":[{"id":"12540","content":"åŸç†ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿","user_name":"ä½œè€…å›å¤","comment_id":34886,"uid":"1218095","ip_address":"","utype":1,"ctime":1540440086,"user_name_real":"Geek_6ef93d"}],"discussion_count":5,"race_medal":0,"score":"113209495140","product_id":100015201,"comment_content":"æ˜¯å¦å¯ä»¥å°†operatorå’Œè‡ªå®šä¹‰æ§åˆ¶å™¨åˆ’ç­‰å·","like_count":27,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427375,"discussion_content":"åŸç†ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540440086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1114356,"avatar":"https://static001.geekbang.org/account/avatar/00/11/00/f4/cc5f0896.jpg","nickname":"Jowin","note":"","ucode":"19017F7D06C22A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311137,"discussion_content":"operatorå’Œè‡ªå®šä¹‰æ§åˆ¶å™¨åŸç†ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://stackoverflow.com/questions/47848258/what-is-the-difference-between-a-kubernetes-controller-and-a-kubernetes-operator","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1602233772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2663721,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er8sYHCPqtn0TRP72qup5YicYAvTDNP7b8cuykCR0o5Yb6ViaQJFKShJbMsWahVk4sQdwDU2UQf6NiaA/132","nickname":"akai","note":"","ucode":"8D4AA48A86B71C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577049,"discussion_content":"operatoræ˜¯å®¹å™¨ä¸­è¿è¡Œï¼Œè¯¾ç¨‹ä¸­è‡ªå®šä¹‰æ§åˆ¶å™¨æ˜¯åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œçš„è¿›ç¨‹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655901765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1099720,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c7/c8/b1ea77fa.jpg","nickname":"æ¬¡æ¬¡","note":"","ucode":"8D48FA8C71693F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2663721,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er8sYHCPqtn0TRP72qup5YicYAvTDNP7b8cuykCR0o5Yb6ViaQJFKShJbMsWahVk4sQdwDU2UQf6NiaA/132","nickname":"akai","note":"","ucode":"8D4AA48A86B71C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583951,"discussion_content":"å¯åˆ«è¯¯å¯¼äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1660525384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":577049,"ip_address":"åŒ—äº¬"},"score":583951,"extra":""}]},{"author":{"id":2139471,"avatar":"https://static001.geekbang.org/account/avatar/00/20/a5/4f/772dd0f3.jpg","nickname":"zlel","note":"","ucode":"D98D44B933D6D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580778,"discussion_content":"operatorå°±æ˜¯InClusteræ–¹å¼è¿è¡Œçš„è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658371443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34867,"user_name":"å°å°ç¬‘å„¿","can_delete":false,"product_type":"c1","uid":1040354,"ip_address":"","ucode":"CA63CC50DC2091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/df/e2/823a04b4.jpg","comment_is_top":false,"comment_ctime":1540343137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74554787169","product_id":100015201,"comment_content":"æ„Ÿè§‰operatorå°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„controllerï¼Œéœ€è¦æœ‰ä¸€å®šçš„å¼€å‘èƒ½åŠ›æ¥å®ç°ã€‚","like_count":17},{"had_liked":false,"id":34846,"user_name":"ethfoo","can_delete":false,"product_type":"c1","uid":1230991,"ip_address":"","ucode":"89437AB68AF4C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/c8/8f/759b7761.jpg","comment_is_top":false,"comment_ctime":1540340090,"is_pvip":false,"replies":[{"id":"12542","content":"è¦æ˜¯å¤§éƒ¨åˆ†æ•°æ®ä¸¢å¤±å¤‡ä»½åˆä¸å®æ—¶çš„æ—¶å€™ï¼Œç”¨pvæŠŠæ•°æ®æ‰¾å›æ¥å°±èƒ½å®Œç¾workï¼Œé‚£è¿˜è¦raftå¹²å•¥ã€‚","user_name":"ä½œè€…å›å¤","comment_id":34846,"uid":"1218095","ip_address":"","utype":1,"ctime":1540440393,"user_name_real":"Geek_6ef93d"}],"discussion_count":10,"race_medal":0,"score":"48784980346","product_id":100015201,"comment_content":"etcd operatorç°åœ¨ä½¿ç”¨empty dirå­˜å‚¨etcdæ•°æ®ï¼Œä¸‡ä¸€çœŸçš„å‡ºç°å¤§éƒ¨åˆ†èŠ‚ç‚¹æŒ‚æ‰ï¼Œä½†æ˜¯æ•°æ®å¤‡ä»½åˆä¸æ˜¯å®æ—¶çš„ï¼Œä¼šå­˜åœ¨éƒ¨åˆ†æ•°æ®ä¸¢å¤±çš„æƒ…å†µå§ï¼Ÿé‚£ä¸ºä»€ä¹ˆetcd operatorä¸ä½¿ç”¨pvå‘¢ï¼Ÿ","like_count":12,"discussions":[{"author":{"id":1399098,"avatar":"https://static001.geekbang.org/account/avatar/00/15/59/3a/c3991054.jpg","nickname":"Will","note":"","ucode":"DD6A753E170FE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286145,"discussion_content":"æˆ‘è§‰å¾—ä½œè€…çš„æ„æ€ä¸»è¦æ˜¯è¯´ï¼šé€šè¿‡raftåè®®ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥å“ªæ€•æ˜¯å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æŒ‚äº†ï¼Œä¹Ÿæ˜¯å¯ä»¥ä»å°‘æ•°çš„å¥½çš„èŠ‚ç‚¹æ¥æ¢å¤æ•°æ®çš„ï¼Œæ²¡æœ‰å¿…è¦éå¾—ä»PVä¸­æ¢å¤ã€‚","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1593072880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1411566,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJRicibrZZK2F5zgOzTeGQHBKXELdqhiaabAPJMRVsfHHRmmu1W69Cqo6P9At3DvWdBoznfYIuXA1tFw/132","nickname":"kong62","note":"","ucode":"1C9F749CB379E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":156508,"discussion_content":"è¿™ä¸ªä½œè€…è¯´çš„æœ‰ç‚¹ç‰µå¼ºçš„ï¼š\nç¬¬ä¸€ï¼šé›†ç¾¤çš„ pod åŒæ—¶é‡å¯çš„è¯ï¼Œæ•°æ®ä¸¢å¤±äº†ï¼Œè€Œå¤‡ä»½è‚¯å®šä¸ä¼šé‚£ä¹ˆåŠæ—¶ï¼Œè‚¯å®šçš„æœ‰æ•°æ®ä¸¢å¤±äº†ï¼Œç”šè‡³å¦‚æœæ²¡æœ‰å¤‡ä»½å°±å®Œå…¨ä¸¢å¤±ã€‚\nç¬¬äºŒï¼šæœ‰æŒä¹…åŒ–çš„æƒ…å†µï¼Œå¦‚æœé‡åˆ°é›†ç¾¤éƒ½é‡å¯è¿™æ ·çš„é—®é¢˜ï¼Œé‚£å°±ç­‰é‡å¯å®Œå°±ç»“æŸäº†ï¼Œä½†æ˜¯å¦‚æœä¾èµ–å¤‡ä»½å’Œæ¢å¤ï¼Œé‚£ä¹ˆæ¢å¤ä¹Ÿæ˜¯ä¸ªç“¶é¢ˆæˆ–è€…å»¶é•¿äº†é›†ç¾¤å¯åŠ¨çš„æ—¶é—´","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1580372833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228136,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bd/68/3fd6428d.jpg","nickname":"Cutler","note":"","ucode":"2EDECFE039845B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339522,"discussion_content":"å¦‚æœkvçš„æ•°é‡å¾ˆå¤šçš„è¯ï¼Œæ²¡æœ‰pvä¼šå¯¼è‡´å¾ˆé•¿çš„æ•°æ®åŒæ­¥æ—¶é—´ï¼Œraftåªæ˜¯ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œä¸èƒ½è§£å†³åŒæ­¥æ—¶é—´é•¿çš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæœ‰å¤§é‡çš„kvè¦å­˜å‚¨ï¼Œetcdæ˜¯ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ¡ˆå€¼å¾—æ€è€ƒã€‚åœ¨æ•°æ®é‡å°çš„æƒ…å†µä¸‹ï¼Œè€å¸ˆè¯´çš„ä¸éœ€è¦pvçš„æ–¹æ¡ˆæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609719805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1222003,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/73/3ddc7c77.jpg","nickname":"Brave Shine","note":"","ucode":"CBB1BAF89DB936","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228136,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bd/68/3fd6428d.jpg","nickname":"Cutler","note":"","ucode":"2EDECFE039845B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557678,"discussion_content":"raftå®ç°ä¸Šéƒ½ä¼šæœ‰InstallSnapshotRPC","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647929835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339522,"ip_address":""},"score":557678,"extra":""}]},{"author":{"id":1094470,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b3/46/ec914238.jpg","nickname":"espzest","note":"","ucode":"64B1A7DEA19348","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1845,"discussion_content":"æˆ‘ä¹Ÿå¾ˆæƒ³çŸ¥é“ä¸ºå•¥ï¼Ÿ raftçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯éœ€è¦å†™ç£ç›˜ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1562985873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1131852,"avatar":"https://static001.geekbang.org/account/avatar/00/11/45/4c/99bf58d2.jpg","nickname":"æŸ³åŸ","note":"","ucode":"59DDC003FDA6F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1193,"discussion_content":"èƒ½æ­£é¢è§£é‡Šä¸€ä¸‹lzçš„é—®é¢˜ä¹ˆã€‚ä¸å®Œç¾åœ¨å“ªé‡Œï¼Œraftå¦‚ä½•èƒ½è§£å†³","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1562387613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222003,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/73/3ddc7c77.jpg","nickname":"Brave Shine","note":"","ucode":"CBB1BAF89DB936","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557681,"discussion_content":"å› ä¸ºæ²¡æœ‰å¿…è¦ï¼Œetcdæä¾›çš„å¤‡ä»½æ¢å¤æœºåˆ¶å°±æ˜¯snapshotï¼Œä½ ç”¨pvæœ€ç»ˆæ¢å¤ä¹Ÿæ˜¯ç”¨snapshotï¼Œåªä¸è¿‡å¦‚æœè¯´æ²¡æœ‰æŒ‰æ—¶å¤‡ä»½snapshoté‚£ä¹ˆåœ¨æ¢å¤çš„æ—¶å€™å¯èƒ½æ¢å¤å‡ºæ¥çš„æ•°æ®æ²¡æœ‰pvä¸Šçš„æ•°æ®æ–°ï¼ˆä½†æ˜¯pvå¯èƒ½ä¹Ÿä¼šæŸåä¸å¯ç”¨ï¼Œæ‰€ä»¥å½’æ ¹åˆ°åº•è¿˜æ˜¯å¤‡ä»½snapshotå»å‡å°‘é›†ç¾¤çº§åˆ«çš„æ•…éšœæ¢å¤æ—¶é—´ï¼‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647930649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427359,"discussion_content":"è¦æ˜¯å¤§éƒ¨åˆ†æ•°æ®ä¸¢å¤±å¤‡ä»½åˆä¸å®æ—¶çš„æ—¶å€™ï¼Œç”¨pvæŠŠæ•°æ®æ‰¾å›æ¥å°±èƒ½å®Œç¾workï¼Œé‚£è¿˜è¦raftå¹²å•¥ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1540440393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2309567,"avatar":"","nickname":"Geek_08abcc","note":"","ucode":"7F8D05D5993DEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332953,"discussion_content":"ç¡®å®ä½œè€…æœ‰ç‚¹é¿é‡å°±è½»äº†ï¼Œå¯ä»¥è¯´æ¸…æ¥šï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607401475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048441,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ff/79/f400c4d1.jpg","nickname":"douge","note":"","ucode":"A6EB1AA3D53516","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293573,"discussion_content":"éœ€ä¸éœ€è¦ pvc è¿˜æ˜¯çœ‹ä¸šåŠ¡ï¼Œä¸€èˆ¬ raft å®ç°éƒ½æœ‰ snapshot æœºåˆ¶ï¼Œå¦‚æœä¸šåŠ¡å¯¹æ•°æ®è¦æ±‚é«˜ï¼ŒæŒä¹…åŒ– snapshot å³å¯ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595584847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143570,"user_name":"Simon Wu","can_delete":false,"product_type":"c1","uid":1310029,"ip_address":"","ucode":"6B5FC98B1D57FB","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/4d/41875340.jpg","comment_is_top":false,"comment_ctime":1571734895,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44521407855","product_id":100015201,"comment_content":"Etcd operatorå·²ç»æ”¯æŒpvcäº†ï¼Œä¾é å¤‡ä»½æœºåˆ¶è¿˜æ˜¯æœ‰ä¸€æ®µæ—¶é—´çš„æ•°æ®ä¸¢å¤±ï¼Œå°±çœ‹ä½ çš„ä¸šåŠ¡å…ä¸å…è®¸ã€‚","like_count":11},{"had_liked":false,"id":48045,"user_name":"johnson.skiii","can_delete":false,"product_type":"c1","uid":1316924,"ip_address":"","ucode":"F1B6E71B54046C","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/3c/b5a00c1a.jpg","comment_is_top":false,"comment_ctime":1544329526,"is_pvip":true,"replies":[{"id":"17504","content":"æ¢å¤æ•°æ®è¿™ä¸ªæ“ä½œè¿˜æ˜¯è¦çš„","user_name":"ä½œè€…å›å¤","comment_id":48045,"uid":"1218095","ip_address":"","utype":1,"ctime":1544533451,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"40199035190","product_id":100015201,"comment_content":"å¼ å¤§ï¼Œè¯·æ•™ä¸ªé—®é¢˜ã€‚<br><br>å¦‚æœETCDæ¯ä¸ªpodä¸ç»‘å®špvçš„è¯ï¼Œé‚£ä¹ˆå½“å…¶ä¸­ä¸€ä¸ªæŒ‚æ‰çš„è¯ï¼Œetcd operatorä¼šå†å¯åŠ¨ä¸€ä¸ªpodï¼Œä½†æ˜¯å¯åŠ¨åˆ°é‚£ä¸€å°workeræœªçŸ¥ï¼›é‚£ä¹ˆï¼Œç”±äºraftæœºåˆ¶ï¼Œleaderä¼šåŒæ­¥æ•°æ®ç»™è¿™ä¸ªæ–°çš„podï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå¾ˆè€—æ—¶ï¼›<br><br>ä¸å…¶è¿™æ ·ï¼Œèƒ½å¦é™å®šè¿è¡Œetcdçš„podä½¿ç”¨ç‰¹å®šçš„pvï¼Œè¿™æ ·å½“å‡ºç°podæŒ‚æ‰çš„æƒ…å†µï¼ŒleaderåŒæ­¥æ•°æ®ä¹Ÿä¼šæ›´å¿«ã€‚","like_count":9,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432003,"discussion_content":"æ¢å¤æ•°æ®è¿™ä¸ªæ“ä½œè¿˜æ˜¯è¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544533451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57943,"user_name":"æŸ¯å¯Ÿé‡‘","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1546947914,"is_pvip":false,"replies":[{"id":"22070","content":"kubebuilder operatorsdkéƒ½æ˜¯å¸®ä½ ç®€åŒ–æ“ä½œçš„å·¥å…·","user_name":"ä½œè€…å›å¤","comment_id":57943,"uid":"1218095","ip_address":"","utype":1,"ctime":1548053926,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"27316751690","product_id":100015201,"comment_content":"æˆ‘é—®ä¸€ä¸ªé—®é¢˜ï¼Œå¹³æ—¶å¼€å‘äººå‘˜éœ€è¦ç”¨åˆ°çš„ CRD çš„åœ°æ–¹å¤šå—ï¼Œå¦‚æœè¦è‡ªå®šä¹‰çš„è¯è¿˜æ˜¯æŒºéº»çƒ¦çš„å‘¢","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435838,"discussion_content":"kubebuilder operatorsdkéƒ½æ˜¯å¸®ä½ ç®€åŒ–æ“ä½œçš„å·¥å…·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548053926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278888,"user_name":"ï¼Ÿ","can_delete":false,"product_type":"c1","uid":2030035,"ip_address":"","ucode":"3043E00A056081","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f9/d3/2cb7516e.jpg","comment_is_top":false,"comment_ctime":1613443938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18793313122","product_id":100015201,"comment_content":"æˆ‘è§‰å¾—è¿™ä¸€ç« åº”è¯¥ç®—æ‰©å±•ï¼Œéœ€è¦æœ‰ä¸€å®šåŸºç¡€ï¼Œå¹¶ä¸”ç¼–å†™è¿‡crdçš„æœ‹å‹æ¥å­¦ä¹ çš„ï¼Œæ™®é€šçš„ä½¿ç”¨è¿˜ç”¨ä¸ä¸Šcrdï¼Œæ¯•ç«Ÿå¾ˆå¤šå¼€æºé¡¹ç›®éƒ½è‡ªå®šä¹‰äº†crdï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥çœ‹ä»–ä»¬çš„æ–‡æ¡£é…ç½®å³å¯ã€‚","like_count":4},{"had_liked":false,"id":176562,"user_name":"åŒ–çŸ³","can_delete":false,"product_type":"c1","uid":1153885,"ip_address":"","ucode":"AF088A9FB76D8B","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/5d/f99d0ce6.jpg","comment_is_top":false,"comment_ctime":1581087464,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18760956648","product_id":100015201,"comment_content":"æœ€å‰é¢çš„ä¾‹å­ etcd åˆ›å»º infra0-infra2 3 ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œ--initial-cluster-state éƒ½æ˜¯ newï¼Œæ˜¯å¦å’Œåé¢çš„å†…å®¹ä¸ä¸€è‡´?","like_count":4,"discussions":[{"author":{"id":1527466,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4e/aa/42e238ea.jpg","nickname":"è®©ä»–äº¦å¯","note":"","ucode":"944C065BE7AA43","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581351,"discussion_content":"ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå·²ç»ä¸æ˜¯newäº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658736544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35007,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1540380405,"is_pvip":false,"replies":[{"id":"12534","content":"éœ€è¦è‡ªå·±æ¸…ç†","user_name":"ä½œè€…å›å¤","comment_id":35007,"uid":"1218095","ip_address":"","utype":1,"ctime":1540439809,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"18720249589","product_id":100015201,"comment_content":"è¯·æ•™è€å¸ˆï¼ŒEtcdBackupå’ŒEtcdRestoreèµ„æºåˆ›å»ºï¼ˆå¹¶è¿è¡Œï¼‰åä¼šè‡ªåŠ¨åˆ é™¤å—ï¼Ÿæ˜¯å¦éœ€è¦æ‰‹å·¥åˆ é™¤ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427413,"discussion_content":"éœ€è¦è‡ªå·±æ¸…ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540439809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34872,"user_name":"Vincen","can_delete":false,"product_type":"c1","uid":1218185,"ip_address":"","ucode":"1029A901EC7BA0","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/89/9312b3a2.jpg","comment_is_top":false,"comment_ctime":1540343478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18720212662","product_id":100015201,"comment_content":"å‰å®³äº†ï¼Œå…¨æ˜¯å¹²è´§ï¼","like_count":4},{"had_liked":false,"id":337802,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1647070404,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14531972292","product_id":100015201,"comment_content":"è¯¥æ–‡ç« ä¸­çš„ä¾‹å­å…¶å®æ˜¯åˆ›å»ºä¸æˆåŠŸçš„ï¼Œå› ä¸ºæˆ‘çš„k8sç‰ˆæœ¬æ˜¯1.23.0ï¼Œæœ€æ–°çš„apiå·²ç»ä»åŸæ¥çš„extensions&#47;v1beta1å˜ä¸ºäº†apps&#47;v1,æ‰€ä»¥è¿™é‡Œåœ¨åˆ›å»ºexample&#47;deployment.yamlæ—¶è™½ç„¶èƒ½å¤ŸæˆåŠŸï¼Œä½†æ˜¯åˆ›å»ºCRDçš„æ—¶å€™æ˜¯å¤±è´¥çš„ï¼Œæˆ‘ä»¬é€šè¿‡logä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼š<br>Could not construct reference to: &#39;&amp;v1.Endpoints{TypeMeta:v1.TypeMeta{Kind:&quot;&quot;, APIVersion:&quot;&quot;}, ObjectMeta:v1.ObjectMeta{Name:&quot;etcd-operator&quot;, GenerateName:&quot;&quot;, Namespace:&quot;default.......<br><br>time=&quot;2022-03-12T06:46:45Z&quot; level=error msg=&quot;initialization failed: fail to init CRD: failed to create CRD: the server could not find the requested resource&quot; pkg=controller<br><br>æˆ‘æƒ³è§£å†³åŠæ³•åªèƒ½æ˜¯ä¿®æ”¹æºç å§ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šgoï¼Œå¾ˆéš¾å—ğŸ˜£","like_count":3,"discussions":[{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585805,"discussion_content":"æˆ‘1.24.0ç‰ˆæœ¬ä¹Ÿæ˜¯è¿™ä¸ªé—®é¢˜ï¼Œæ— æ³•å®è·µäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661833461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é‡åº†"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229889,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1593178174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14478080062","product_id":100015201,"comment_content":"æœ‰ç‚¹éš¾äº†ï¼Œå¾—å¤šçœ‹å‡ éï¼Œç•™ä¸ªçˆª","like_count":3},{"had_liked":false,"id":324993,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638774363,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10228708955","product_id":100015201,"comment_content":"å·²ç»åˆ°äº†çœ‹ä¸æ‡‚çš„æ—¶å€™äº†   è¿™æ˜¯ä¸ªæ‚²ä¼¤çš„æ•…äº‹","like_count":2,"discussions":[{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580381,"discussion_content":"å¤šçœ‹å‡ éå°±æ˜ç™½äº†ï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹äº†ä¸‰å››éæ‰æ˜ç™½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658135145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258644,"user_name":"è‡´è‰¯çŸ¥","can_delete":false,"product_type":"c1","uid":2113915,"ip_address":"","ucode":"73C722E31B726A","user_header":"https://static001.geekbang.org/account/avatar/00/20/41/7b/cda2e622.jpg","comment_is_top":false,"comment_ctime":1604533109,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10194467701","product_id":100015201,"comment_content":"å­¦åˆ°äº† çœŸå¿ƒä¸é”™","like_count":2},{"had_liked":false,"id":229184,"user_name":"Spring.Fred","can_delete":false,"product_type":"c1","uid":1055148,"ip_address":"","ucode":"66C84150ACC304","user_header":"https://static001.geekbang.org/account/avatar/00/10/19/ac/32da70c9.jpg","comment_is_top":false,"comment_ctime":1592918832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10182853424","product_id":100015201,"comment_content":"ä¹‹å‰ç”¨StatefulSetå®ç°çš„mysqlä¸»ä»è¯»å†™åˆ†ç¦»çš„ä¾‹å­ï¼Œ èƒ½ç»™ä¸ªOperatorçš„ç¤ºä¾‹ä»£ç å—ï¼Ÿ","like_count":2},{"had_liked":false,"id":149584,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1573283020,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10163217612","product_id":100015201,"comment_content":"åº”è¯¥æ˜¯clientç«¯ä¸apiserveräº¤äº’å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ","like_count":2},{"had_liked":false,"id":93970,"user_name":"po","can_delete":false,"product_type":"c1","uid":1023905,"ip_address":"","ucode":"7DB36C278F34D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","comment_is_top":false,"comment_ctime":1557679561,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10147614153","product_id":100015201,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œetcd operator ä½¿ç”¨empty dirå­˜å‚¨etcdæ•°æ®ï¼Œé‚£ä¹ˆåœ¨é›†ç¾¤çªç„¶æ–­ç”µæˆ–è€…å…³æœºçš„æƒ…å†µä¸‹ï¼Œå†å¯åŠ¨é›†ç¾¤ï¼Œé‚£ä¹ˆæ‰€æœ‰etcdçš„podæ•°æ®éƒ½æ˜¯ä¸ºç©ºï¼Œé‚£raftç®—æ³•åœ¨è¿™ä¸ªæ—¶å€™ä¹Ÿæ²¡æ³•å·¥ä½œäº†å§ï¼Ÿè¿™ä¸ªé—®é¢˜è¦æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæˆ‘çœ‹ç°åœ¨openshifté›†ç¾¤çš„etcdå°±æ˜¯ç”¨operatoréƒ¨ç½²çš„ï¼Œè¯·è€å¸ˆè§£ç­”ä¸‹ï¼Œè°¢è°¢ã€‚","like_count":2},{"had_liked":false,"id":35391,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1540537459,"is_pvip":false,"replies":[{"id":"12621","content":"kube proxyä¸çŸ¥é“ä½ çš„æ”¹åŠ¨","user_name":"ä½œè€…å›å¤","comment_id":35391,"uid":"1218095","ip_address":"","utype":1,"ctime":1540593466,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"10130472051","product_id":100015201,"comment_content":"è€å¸ˆï¼Œåœ¨æµ‹è¯•å®˜æ–¹çš„prometheus-operatorã€‚å› ä¸ºæˆ‘çš„é›†ç¾¤æ˜¯äºŒè¿›åˆ¶éƒ¨ç½²çš„ï¼Œæˆ‘æƒ³ç›‘æ§åˆ°æˆ‘çš„ç»„ä»¶ï¼Œkube-contorller-managerå’Œkube-schedulerç»„ä»¶ï¼Œæˆ‘åšäº†ä¸€äº›ä¿®æ”¹ï¼ˆæŠŠè¿™äº›ç»„ä»¶çš„bind addressè®¾å®šä¸ºäº†0.0.0.0ï¼Œè‡ªå·±å•ç‹¬åˆ›å»ºäº†ä»–ä»¬çš„epï¼‰ã€‚å½“æ—¶æ˜¯èƒ½åœ¨prometheusçš„targetsçœ‹åˆ°ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ç›‘æ§åˆ°ã€‚ä½†æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´åï¼Œè¿™äº›svcå’Œepä¼šè‡ªåŠ¨å¤±æ•ˆã€‚è¿™ä¸ªé—®é¢˜æ€ä¹ˆæ¥æŸ¥çœ‹å‘¢ï¼Ÿ<br>","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427525,"discussion_content":"kube proxyä¸çŸ¥é“ä½ çš„æ”¹åŠ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540593466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028053,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/af/d5/6212800b.jpg","nickname":"feie22","note":"","ucode":"E51CF5576D9231","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41109,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°è¿‡ï¼Œå½“æ—¶çš„æƒ…å†µæ˜¯è‡ªå»ºçš„epå†™çš„ä¸å¯¹ï¼Œç±»å‹å†™é”™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572354523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34998,"user_name":"æ¯æ—¥éƒ½æƒ³ä¸Šç­","can_delete":false,"product_type":"c1","uid":1060466,"ip_address":"","ucode":"1DE64120C8B14A","user_header":"https://static001.geekbang.org/account/avatar/00/10/2e/72/145c10db.jpg","comment_is_top":false,"comment_ctime":1540378074,"is_pvip":false,"replies":[{"id":"12535","content":"å¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540439819,"ip_address":"","comment_id":34998,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10130312666","product_id":100015201,"comment_content":"æˆ‘æœ‰4å°masterï¼Œå…¶ä¸­ä¸€å°masteræˆ‘ç»™å®ƒç³»ç»Ÿé‡è£…ï¼Œç„¶åå†åŠ å…¥masterï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¹³æ»‘æ“ä½œï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427406,"discussion_content":"å¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540439819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34907,"user_name":"è™è™â¤ï¸","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1540350644,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10130285236","product_id":100015201,"comment_content":"ä¸é”™ï¼Œå¯ä»¥è¯•ç€æ·»åŠ  workqueue æ¥ç»ƒç»ƒæ‰‹ã€‚å¯ä»¥å¤šå¸ƒç½®äº›ä½œä¸šï¼Œæœ‰çš„æ—¶å€™è¿˜çœŸæ˜¯ä¸æ“…é•¿ç»™è‡ªå·±æ‰¾æ´»å¹²ã€‚ã€‚","like_count":2},{"had_liked":false,"id":319883,"user_name":"yingjie","can_delete":false,"product_type":"c1","uid":1635988,"ip_address":"","ucode":"AC0FAAA1299BCD","user_header":"https://static001.geekbang.org/account/avatar/00/18/f6/94/e244696a.jpg","comment_is_top":false,"comment_ctime":1635997764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5930965060","product_id":100015201,"comment_content":"è€å¸ˆï¼Œè¿™é‡Œoperatoræ‰§è¡Œçš„å‘½ä»¤æ˜¯åœ¨å“ªä¸ªé•œåƒå®¹å™¨é‡Œé¢å¯åŠ¨etcdçš„å‘½ä»¤çš„ï¼Ÿ","like_count":1},{"had_liked":false,"id":314064,"user_name":"è¨€åˆæœ¨æ‰","can_delete":false,"product_type":"c1","uid":1201009,"ip_address":"","ucode":"300BEDC1B07DF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/71/a4e9f20e.jpg","comment_is_top":false,"comment_ctime":1632822875,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5927790171","product_id":100015201,"comment_content":"æˆ‘è§‰å¾—è¿™é‡Œçš„å¤æ‚åº¦çœŸçš„æŒ‡æ•°çº§ï¼Œæ„æ€æ˜¯åœ¨k8sä¸Šè¿è¡Œä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤åº”ç”¨ï¼Œéœ€è¦å‘ä¸‹å±‚çš„k8sæ¥å£è¿›è¡Œç¼–ç¨‹ï¼Œç„¶åæä¸€å¥—è‡ªé€‚åº”çš„æ§åˆ¶å™¨æ¥æ»¡è¶³k8sçš„è°ƒåº¦ã€‚è¿™ä¸ªå¤ªå™©æ¢¦äº†å¯¹äºæ–°æ‰‹æ¥è¯´","like_count":1,"discussions":[{"author":{"id":1131300,"avatar":"https://static001.geekbang.org/account/avatar/00/11/43/24/3f9f7c70.jpg","nickname":"zixuan","note":"","ucode":"C72920DD05B074","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534628,"discussion_content":"k8såªæ˜¯æŠŠapiå¯¹è±¡çš„å˜æ›´åŒæ­¥ä¸€ä¸‹ï¼Œç›¸å½“äºç»™ä½ åšå¥½äº†æ“ä½œæ¥å£. è‡ªå·±åšä¸€å¥—è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç»´æŠ¤è„šæœ¬æ²¡æœ‰æ›´ç®€å•å§ï¼Œå¹¶ä¸”ä¸ä¸€å®šå¯é ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638243629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295731,"user_name":"StayLet","can_delete":false,"product_type":"c1","uid":1249652,"ip_address":"","ucode":"6B748CA3AF3C5B","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/74/72ffa6d6.jpg","comment_is_top":false,"comment_ctime":1622562784,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5917530080","product_id":100015201,"comment_content":"ä»¥å‰è®¤ä¸ºèƒ½æŠŠ Kubernetes è·‘èµ·æ¥ï¼Œèƒ½æŠŠåº”ç”¨éƒ¨ç½²è¿›å»å¹¶ç»´æŠ¤æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¼šäº†ã€‚ç°åœ¨å‘ç°å‰é¢çš„ç©æºœäº†åªæ˜¯å¼€å§‹ï¼Œä¼š CRDã€Operator æ‰æ˜¯çœŸçš„ä¼šã€‚","like_count":1},{"had_liked":false,"id":236610,"user_name":"è¹¦è¹¦","can_delete":false,"product_type":"c1","uid":2055624,"ip_address":"","ucode":"D20A4CA503B868","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5d/c8/7ece6f4b.jpg","comment_is_top":false,"comment_ctime":1595477445,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5890444741","product_id":100015201,"comment_content":"ä¸ºå•¥deployment.yamlé‡Œé¢æ²¡æœ‰selectorï¼Œåˆ›å»ºä¸äº†","like_count":1,"discussions":[{"author":{"id":2062232,"avatar":"","nickname":"æè½²","note":"","ucode":"73FCE8EFE136C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318548,"discussion_content":"è¿™ä¸ªå› ä¸ºç‰ˆæœ¬æ›´æ–°çš„åŸå› , extensionå·²ç»è¿‡æœŸäº†, ä½¿ç”¨apps/v1çš„è¯, é‚£ä¹ˆå°±è¦è‡ªå·±æ·»åŠ ç›¸å…³ä¿¡æ¯, ä¾‹å¦‚:\nspec:\n  selector:\n    matchLabels:\n      app: etcd-backup-operator\ntemplateé‡Œé¢çš„nameä¹Ÿè¦æ”¹æˆappæ‰å¯ä»¥åŒ¹é…:\n...\napp: etcd-backup-operator\n...\nspec:","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1603778653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61133,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1547625026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5842592322","product_id":100015201,"comment_content":"èƒ½è§£ç­”ä¸‹æ€è€ƒé¢˜ä¹ˆï¼Ÿ  ","like_count":1},{"had_liked":false,"id":35504,"user_name":"hochuenw","can_delete":false,"product_type":"c1","uid":1231781,"ip_address":"","ucode":"303B389F81508A","user_header":"","comment_is_top":false,"comment_ctime":1540629537,"is_pvip":false,"replies":[{"id":"12636","content":"æ¦‚å¿µå¾ˆå¥½çš„ï¼Œé€‚åˆäº‘ä¸Šçš„ç”¨æˆ·ç©ï¼Œä½†æ˜¯ä¸é€‚åˆè‡ªå·±å®šåˆ¶å¼€å‘","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540655750,"ip_address":"","comment_id":35504,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5835596833","product_id":100015201,"comment_content":"è€å¸ˆè¯·é—®æ€ä¹ˆçœ‹metacontrollerè¿™ä¸ªé¡¹ç›®","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427555,"discussion_content":"æ¦‚å¿µå¾ˆå¥½çš„ï¼Œé€‚åˆäº‘ä¸Šçš„ç”¨æˆ·ç©ï¼Œä½†æ˜¯ä¸é€‚åˆè‡ªå·±å®šåˆ¶å¼€å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540655750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356589,"user_name":"Season Zhangâ€”å‡¯ç¨‹","can_delete":false,"product_type":"c1","uid":2682306,"ip_address":"å¹¿ä¸œ","ucode":"63DAE127BAE7E4","user_header":"https://static001.geekbang.org/account/avatar/00/28/ed/c2/b043abf5.jpg","comment_is_top":false,"comment_ctime":1662444083,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662444083","product_id":100015201,"comment_content":"æˆ‘ä»¥ä¸ºåªæ˜¯å­¦å°‘æ—é•¿æ‹³ï¼Œè°çŸ¥é“æ•™æˆ‘é™é¾™åå…«æŒã€‚æˆ‘å¼€å¿ƒè¿˜æ˜¯ä¼¤å¿ƒï¼Ÿ","like_count":0},{"had_liked":false,"id":356354,"user_name":"Geek_c9fb2a","can_delete":false,"product_type":"c1","uid":2805700,"ip_address":"å¹¿ä¸œ","ucode":"79CD49F41FBB8A","user_header":"","comment_is_top":false,"comment_ctime":1662193559,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662193559","product_id":100015201,"comment_content":"é›†ç¾¤etcdéƒ½æŒ‚æ‰äº†ï¼ŒEtcdRestore å¯¹è±¡ä¹Ÿåˆ›å»ºä¸äº†ï¼Œæ€ä¹ˆæ¢å¤å‘¢ï¼ŒEtcdRestoreçš„ä½œç”¨å°±å¤±æ•ˆäº†å§","like_count":0},{"had_liked":false,"id":352867,"user_name":"algebra","can_delete":false,"product_type":"c1","uid":1010953,"ip_address":"é™•è¥¿","ucode":"89F57E4A50E04A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6d/09/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1658989582,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1658989582","product_id":100015201,"comment_content":"æ‰§è¡Œcreate_role.sh é‡åˆ°è¿™ä¸ªé—®é¢˜ unable to recognize &quot;STDIN&quot;: no matches for kind &quot;ClusterRole&quot; in version &quot;rbac.authorization.k8s.io&#47;v1beta1&quot;","like_count":0,"discussions":[{"author":{"id":2709653,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ygRfx93LO1ziazydV4eZRGWfnxc6ZJUo0dUcboASfduibJByytVyhKvLd7suhmPYernHv1C1jy8sOtlRTzuO36iag/132","nickname":"éä¸»æµç å†œ","note":"","ucode":"47F137CF78A849","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584751,"discussion_content":"rbac.authorization.k8s.io/v1beta1-&gt;rbac.authorization.k8s.io/v1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661083506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é‡åº†"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340639,"user_name":"æ¾ä¸‰çˆ·","can_delete":false,"product_type":"c1","uid":1367465,"ip_address":"","ucode":"4B1F6B81BC28D4","user_header":"https://static001.geekbang.org/account/avatar/00/14/dd/a9/fa4cb455.jpg","comment_is_top":false,"comment_ctime":1648984643,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648984643","product_id":100015201,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜, etcd-operatorä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºCRDå‘¢?  åœ¨é¡¹ç›®é‡Œæ²¡æœ‰çœ‹åˆ°etcd-clusterçš„yamlæ–‡ä»¶å•Š, è¿˜æ˜¯è¯´è¿™ä¸ªCRDæ˜¯è¿™ä¸ªcontainerè‡ªå¸¦åˆ›å»ºçš„ ? ","like_count":0},{"had_liked":false,"id":336680,"user_name":"çªçªå¤´","can_delete":false,"product_type":"c1","uid":1063866,"ip_address":"","ucode":"5C2635ED6484F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/ba/3b30dcde.jpg","comment_is_top":false,"comment_ctime":1646289866,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646289866","product_id":100015201,"comment_content":"æ€§èƒ½ç“¶é¢ˆè¿˜æ˜¯åœ¨æ•°æ®çš„åºåˆ—åŒ–è·Ÿååºåˆ—åŒ–å§","like_count":0},{"had_liked":false,"id":293394,"user_name":"ç½—å³°","can_delete":false,"product_type":"c1","uid":1218501,"ip_address":"","ucode":"5F3D6AF8F28322","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","comment_is_top":false,"comment_ctime":1621382757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621382757","product_id":100015201,"comment_content":"å› ä¸ºç»“åˆäº†crdï¼Œoperatorå¯ä»¥çœ‹åšæ˜¯è‡ªç”±åº¦æ›´é«˜çš„statefulsetå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":290590,"user_name":"Gekko","can_delete":false,"product_type":"c1","uid":1343498,"ip_address":"","ucode":"A3D59E7F3EAE64","user_header":"","comment_is_top":false,"comment_ctime":1619654672,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"1619654672","product_id":100015201,"comment_content":"å­¦åˆ°è¿™é‡Œï¼Œæ˜¯åœ¨å¿ä¸ä½æä¸ªå»ºè®®ã€‚åŸºäºå®é™…ä¼ä¸šè¿ç»´ç¯å¢ƒéƒ½æ˜¯æˆç†Ÿçš„Paaså¹³å°ï¼Œéº»çƒ¦åœ¨å¯¹åº”çš„åœ°æ–¹è‡³å°‘æ”¾ä¸Šç•Œé¢çœ‹ä¸€ä¸‹ç•Œé¢å¦‚ä½•æ“ä½œçš„å§ã€‚é€šç¯‡åˆ°è¿™é‡Œçš„æ„Ÿè§‰æœ‰ç‚¹æ„Ÿè§‰éƒ½åœ¨çº¸ä¸Šè°ˆå…µï¼Œè„±ç¦»å®é™…ä¼ä¸šè¿ç»´åœºæ™¯äº†ã€‚ä¸€å¼€å§‹è§‰å¾—è®²çº¯ç†è®ºæ²¡é—®é¢˜ï¼Œå‘½ä»¤ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†å®é™…ä¸Šä¼ä¸šå†…éƒ¨è¿ç»´éƒ½æ˜¯åŸºäºå¯è§†åŒ–ç•Œé¢ï¼Œå°‘éƒ¨åˆ†æ˜¯åŸºäºå®¿ä¸»æœºå‘½ä»¤çš„ã€‚æ‰€ä»¥å»ºè®®ä½œè€…åˆ°å®é™…çš„ä¼ä¸šåº”ç”¨åœºæ™¯çœ‹çœ‹ï¼Œæ‰èƒ½åšåˆ°æ–‡ç« å­¦ä»¥è‡´ç”¨ã€‚","like_count":0,"discussions":[{"author":{"id":2086973,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d8/3d/8a44993f.jpg","nickname":"OldFox","note":"","ucode":"6195262F3A9AA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380413,"discussion_content":"åŸç†ä¼šäº†ï¼Œå•¥å›¾å½¢åŸºæœ¬éƒ½æ²¡å¤ªå¤§é—®é¢˜","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1624496099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1676074,"avatar":"https://static001.geekbang.org/account/avatar/00/19/93/2a/08675e68.jpg","nickname":"skywalk_jk","note":"","ucode":"329D3E71E613F0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386967,"discussion_content":"k8sä¸æ˜¯paasï¼Œæœ¬èº«ä¹Ÿä¸æ˜¯ä¸ºäº†å®ç°å›¾å½¢ç•Œé¢æ“ä½œï¼Œå®ƒæ˜¯å¯¹è°·æ­Œåœ¨ç”Ÿäº§ç¯å¢ƒç®¡ç†å·¥ä½œè´Ÿè½½ç»éªŒçš„æŠ½è±¡ï¼Œæ–‡ç« ä¸­è®²è§£çš„operatoræœ¬èº«å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ï¼Œæ˜¯å¯¹ä¸€æ¬¾è½¯ä»¶è¿ç»´ç»éªŒçš„æŠ½è±¡ï¼Œä½ åº”è¯¥å…³æ³¨åƒkubesphereè¿™æ ·çš„é¡¹ç›®å’Œå®¹å™¨äº‘è½åœ°ç»éªŒ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627913908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1496889,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d7/39/6698b6a9.jpg","nickname":"Hector","note":"","ucode":"110CAF87ADDC01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412217,"discussion_content":"è¿™æ˜¯æ·±å…¥å‰–æå•Šï¼Œåˆçº§å®æˆ˜çœ‹çœ‹k8s in actionå°±å¤Ÿç”¨äº†ã€‚æˆ‘éƒ½ä¸çŸ¥é“çœ‹äº†å¤šå°‘æ¬¡äº†ï¼Œæœ€è¿‘è¦åšä¸ªåˆ†å¸ƒå¼å¤šç§ç±»ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œæƒ³åˆ°k8s operatorè¿™å¥—è¿˜ä¸é”™,å†æ¥å–å–ç»","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636106010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1717785,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/CccT5NgKlZRlTL8f4BsIDqfJ8tRkHPyaR3SXnfgU7acxo2OO7vGzNWjfQBuFnbPPzVYH8Lh49f1jyicuuRSndcA/132","nickname":"Md3zed","note":"","ucode":"83EAD89468ED7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385302,"discussion_content":"çœ‹è¯¾ç¨‹æ ‡é¢˜ï¼Œæ˜¯è¯´åŸç†ï¼Œä¸æ˜¯è¯´ä½¿ç”¨","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626975019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1226569,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b7/49/fe2da25a.jpg","nickname":"Jingslunt","note":"","ucode":"73178A0A61ECB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371830,"discussion_content":"å¯è§†åŒ–æ˜¯åšç»™åˆçº§äººå‘˜å’Œç ”å‘äººå‘˜ç”¨çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620011087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289547,"user_name":"åˆ‡æ…•æºªæ°´Mia","can_delete":false,"product_type":"c1","uid":1096961,"ip_address":"","ucode":"A1887EB4096596","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/01/733150df.jpg","comment_is_top":false,"comment_ctime":1619075117,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619075117","product_id":100015201,"comment_content":"CRDæ˜¯ä¸ªç­ï¼Œä»€ä¹ˆéƒ½èƒ½å¾€é‡Œè£…","like_count":0},{"had_liked":false,"id":272062,"user_name":"Geek_ce98ba","can_delete":false,"product_type":"c1","uid":2336819,"ip_address":"","ucode":"7E5B850987BDE0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZqQOhficZLCPs3Ms708L36PRA9V8RXym1yOP7ibtBictewQcUmbNticTlfCfIGxENelfsgsd6jWn0Vu1juKvbXq67g/132","comment_is_top":false,"comment_ctime":1609922998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609922998","product_id":100015201,"comment_content":"æ€§èƒ½ç“¶é¢ˆåº”è¯¥æ˜¯åœ¨k8sé«˜å¯ç”¨æ¨¡å¼ä¸Šå§ï¼Ÿk8sé«˜å¯ç”¨æ˜¯å¤šå‰¯æœ¬å•å®ä¾‹è¿è¡Œçš„","like_count":0},{"had_liked":false,"id":167643,"user_name":"moxi_moxi","can_delete":false,"product_type":"c1","uid":1199799,"ip_address":"","ucode":"76DE4F8AE8F320","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/b7/e7573f20.jpg","comment_is_top":false,"comment_ctime":1577885763,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1577885763","product_id":100015201,"comment_content":"crdè¿˜æ˜¯è¦èµ°apiserverï¼Œå¹¶ä¸”æœ‰å¯èƒ½éœ€è¦å¤šä¸ªèµ„æºå¯¹è±¡ï¼›ç”¨èšåˆåŠŸèƒ½è‡ªå®šä¹‰server, \bæ¯”crdæ€§èƒ½è¦å¥½ä¸€äº›å§","like_count":0,"discussions":[{"author":{"id":1433247,"avatar":"https://static001.geekbang.org/account/avatar/00/15/de/9f/b6c59a75.jpg","nickname":"dustï¼","note":"","ucode":"7ADCCC7985B381","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275071,"discussion_content":"crdä½¿ç”¨ç®€å•ï¼Œåº”ç”¨åœºæ™¯ä¹Ÿè¦æ¯”è‡ªå®šä¹‰api serveråœºæ™¯ç®€å•äº›ï¼Œcrdæœ‰æ€§èƒ½ç¼ºé™·ï¼Œåªé€‚åˆç®€å•ï¼è‡ªå®šä¹‰api serveråœºæ™¯é€‚ç”¨å¹¿ï¼Œç²’åº¦è¾ƒç»†ï¼Œä½†æ˜¯ç¼ºé™·å°±æ˜¯ç¼–ç¨‹å®ç°å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ï¼Œprometheus-adapterå°±æ˜¯è‡ªå®šä¹‰api serverå®ç°çš„ã€‚çœ‹æƒ…å†µï¼Œå„å–æ‰€éœ€å§ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590657935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146994,"user_name":"é˜¿ç¡•","can_delete":false,"product_type":"c1","uid":1210978,"ip_address":"","ucode":"39856C29E6614B","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/62/9b248708.jpg","comment_is_top":false,"comment_ctime":1572753320,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572753320","product_id":100015201,"comment_content":"Prometheus é¡¹ç›®çš„ Operatorå·²ç»åœ¨ä½¿ç”¨äº†ï¼Œä½†æƒ³è¦ä¿®æ”¹crdçš„é…ç½®ï¼Œæ˜¯å¦è¦ä»goæºç æäº¤ä¿®æ”¹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":123724,"user_name":"saup007","can_delete":false,"product_type":"c1","uid":1003624,"ip_address":"","ucode":"5BE1CA2E482E96","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/68/7a8aa1e1.jpg","comment_is_top":false,"comment_ctime":1565747814,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565747814","product_id":100015201,"comment_content":"operator ä¸èƒ½ç›´æ¥ç»´æŠ¤å­˜å‚¨çŠ¶æ€å—ï¼Ÿ(pod ç»‘å®š pv)ï¼Œå¿…é¡»è¦å€ŸåŠ©StatefulSetå—","like_count":0},{"had_liked":false,"id":87323,"user_name":"qingbo","can_delete":false,"product_type":"c1","uid":1283979,"ip_address":"","ucode":"A4AA89EA310C27","user_header":"https://static001.geekbang.org/account/avatar/00/13/97/8b/bd318156.jpg","comment_is_top":false,"comment_ctime":1555568012,"is_pvip":false,"replies":[{"id":"31586","content":"éœ€è¦service","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1555698080,"ip_address":"","comment_id":87323,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555568012","product_id":100015201,"comment_content":"æˆ‘çœ‹åˆ°è¿™ç§éStatefulSetçš„podæœ‰DNSè®°å½•çš„æ—¶å€™å¥½å¥‡äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯æŒ‡å®šäº†subdomainå’Œserviceåå­—ä¸€æ ·æ‰å¯ä»¥ã€‚ä¸çŸ¥é“æ˜¯åæ¥åŠ è¿›k8sçš„è¿˜æ˜¯ä¸€å¼€å§‹å°±æœ‰ï¼Œä»¥å‰è§‰å¾—é™¤äº†StatefulSetçš„podéƒ½æ²¡æœ‰DNSçš„â€¦â€¦","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447398,"discussion_content":"éœ€è¦service","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555698080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62739,"user_name":"lpf32","can_delete":false,"product_type":"c1","uid":1039717,"ip_address":"","ucode":"E1B127FDFF74BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dd/65/3b4a2930.jpg","comment_is_top":false,"comment_ctime":1548146165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548146165","product_id":100015201,"comment_content":"API Objectçš„eventæ˜¯æ— çŠ¶æ€çš„ï¼Œä¼šè¢«å¹¿æ’­åˆ°æ¯ä¸ªoperatorï¼Œæ‰€ä»¥å¤šä¸ªoperatorå¹¶æ²¡æœ‰æé«˜å¤ªå¤šæ€§èƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬åªä¼šæœ‰ä¸€ä¸ªoperatorï¼Œè¿™å°±æ˜¯æ€§èƒ½ç“¶é¢ˆçš„åŸå› å§ã€‚ä¸é€‚åˆCRDå¯èƒ½æ˜¯é‚£äº›æ›´æ–°æ¯”è¾ƒçš„å¿«çš„åœºæ™¯å§ã€‚æœ›è€å¸ˆæŒ‡æ•™ã€‚","like_count":0},{"had_liked":false,"id":62461,"user_name":"Davy Jones","can_delete":false,"product_type":"c1","uid":1351710,"ip_address":"","ucode":"99036C6DA22CBC","user_header":"https://static001.geekbang.org/account/avatar/00/14/a0/1e/f1fea846.jpg","comment_is_top":false,"comment_ctime":1548062715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548062715","product_id":100015201,"comment_content":"é—®ä¸‹ï¼Œæ—¥å¿—åœ¨å“ªé‡Œå•Šï¼Œå¦‚æœï¼Œé›†ç¾¤å‡ºäº†é—®é¢˜ï¼Œä»å“ªé‡Œæ’æŸ¥å‘¢ï¼Œkubectl apply -f example&#47;example-etcd-cluster.yamlä¹‹åï¼Œ6443å°±æ­»æ‰äº†ï¼Œsystemctl status kubelet.service -læç¤º<br>kubelet[1604]: E0121 17:14:46.952765    1604 kubelet.go:2236] node &quot;master&quot; not found<br>","like_count":0},{"had_liked":false,"id":62173,"user_name":"jfbai","can_delete":false,"product_type":"c1","uid":1087100,"ip_address":"","ucode":"D1EA101D5CEA48","user_header":"https://static001.geekbang.org/account/avatar/00/10/96/7c/3a7a9ecb.jpg","comment_is_top":false,"comment_ctime":1547968124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547968124","product_id":100015201,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œå¦‚æœä¸€ä¸ªè¢«éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œé‚£å®ƒä»¬ä¹‹é—´çš„æœ¬åœ°ç¼“å­˜æ˜¯æ€ä¹ˆä¿æŒåŒæ­¥çš„å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘ä¿®æ”¹äº†ä¸€ä¸ª etcd cluster çš„å±æ€§ï¼Œé‚£ä¹ˆåœ¨æœ‰å¤šä¸ª operator å®ä¾‹å­˜åœ¨çš„æƒ…å†µä¸‹å“ªä¸€ä¸ªå®ä¾‹ä¼šå¤„ç†è¿™ä¸ªå˜åŒ–å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":42224,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1542934444,"is_pvip":false,"replies":[{"id":"15308","content":"è¿™ä¸ªå‚æ•°æ€ä¹ˆç”Ÿæˆçš„ä¸æ˜¯æ–‡ä¸­å·²ç»è¯¦ç»†è§£é‡Šäº†ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1543042576,"ip_address":"","comment_id":42224,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1542934444","product_id":100015201,"comment_content":"ä½¿ç”¨è¿™ä¸ªoperatoråˆ›å»ºçš„etcdçš„æ¯ä¸ªèŠ‚ç‚¹â€“initial-clusterå‚æ•°å¹¶ä¸æ˜¯éƒ½ä¸€æ ·çš„å•Šï¼Œå­˜åœ¨æ‹“æ‰‘å…³ç³»ï¼Œè€Œä¸”æœ€åæ·»åŠ çš„èŠ‚ç‚¹æ‰æœ‰æ‰€æœ‰çš„åˆ—è¡¨ã€‚é‚£é—®é¢˜æ¥äº†ï¼Œå‰é¢åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦‚ä½•çŸ¥é“æ‰€æœ‰çš„èŠ‚ç‚¹å‘¢ï¼Ÿåˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™æ˜¯åªåˆ é™¤æœ€åæ·»åŠ çš„èŠ‚ç‚¹å—ï¼Ÿæˆ‘æ„Ÿè§‰è¦æ˜¯ä»»æ„åˆ é™¤çš„è¯ï¼Œä¼šå½±å“å…¶ä»–çš„èŠ‚ç‚¹ï¼Œè€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹ è°¢è°¢","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430011,"discussion_content":"è¿™ä¸ªå‚æ•°æ€ä¹ˆç”Ÿæˆçš„ä¸æ˜¯æ–‡ä¸­å·²ç»è¯¦ç»†è§£é‡Šäº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543042576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408642,"discussion_content":"æˆ‘è§‰å¾—ï¼šé›†ç¾¤å†…çš„æ—§èŠ‚ç‚¹å¯ä»¥çŸ¥é“æ–°èŠ‚ç‚¹åŠ å…¥ï¼Œå¹¶æ›´æ–°å®ƒè‡ªèº«ç»´æŠ¤çš„çš„é›†ç¾¤åˆ—è¡¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635297680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38106,"user_name":"å­™å¥æ³¢","can_delete":false,"product_type":"c1","uid":1024684,"ip_address":"","ucode":"4830CCECBC2394","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo6TmyGF3wMIRLx3lPWOlBWusQCxyianFvZvWeW6hYCABLqEow3p7tGc6XgnqUPVvf6Cbj2KUYQIiag/132","comment_is_top":false,"comment_ctime":1541939134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541939134","product_id":100015201,"comment_content":"ğŸ‘ ","like_count":0},{"had_liked":false,"id":35392,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1540537475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540537475","product_id":100015201,"comment_content":"è€å¸ˆï¼Œk8sçš„ç‰ˆæœ¬æ˜¯1.10.3","like_count":0},{"had_liked":false,"id":34973,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1540373288,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540373288","product_id":100015201,"comment_content":"é€šè¿‡applyçš„debugæ¨¡å¼çœ‹åˆ°çš„é”™è¯¯<br>server response object: [{<br>  &quot;metadata&quot;: {},<br>  &quot;status&quot;: &quot;Failure&quot;,<br>  &quot;message&quot;: &quot;error when retrieving current configuration of:\\n\\u0026{0xc4200852c0 0xc42037c9a0 default example-etcd-cluster example-etcd-cluster.yaml 0xc42000db70  false}\\nfrom server for: \\&quot;example-etcd-cluster.yaml\\&quot;: the server was unable to return a response in the time allotted, but may still be processing the request (get etcdclusters.etcd.database.coreos.com example-etcd-cluster)&quot;,<br>  &quot;reason&quot;: &quot;Timeout&quot;,<br>","like_count":0},{"had_liked":false,"id":34967,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1540371851,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540371851","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæˆ‘æµ‹è¯•åˆ›å»ºå¯¹åº”çš„example-etcd-cluster.yamlï¼ŒæŠ¥é”™å‡ºç°Error from server (Timeout): error when creating &quot;example-etcd-cluster.yaml&quot;: Timeout: request did not complete within allowed durationï¼Œè¯·æ•™ä¸‹ï¼Œè¿™ä¸ªæ˜¯å“ªé‡Œå‡ºç°çš„é—®é¢˜å‘¢ï¼Ÿå¦‚ä½•æ¥è¿›è¡Œè®¾ç½®å‘¢ï¼Ÿ","like_count":0}]}