{"id":205637,"title":"33 | 集成事件：使用RabbitMQ来实现EventBus","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":197122,"user_name":"艾roger","can_delete":false,"product_type":"c3","uid":1359790,"ip_address":"","ucode":"9F65CE9A81D6DB","user_header":"","comment_is_top":false,"comment_ctime":1585358966,"is_pvip":false,"replies":[{"id":77158,"content":"很好的建议，这里应该设计接口进行隔离","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1586875607,"ip_address":"","comment_id":197122,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"应该发布器包装下接口，不要将icappublisher等cap框架直接在领域层引入，而造成领域事件的依赖污染","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489452,"discussion_content":"很好的建议，这里应该设计接口进行隔离","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586875607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223558,"user_name":"张志炜","can_delete":false,"product_type":"c3","uid":1221549,"ip_address":"","ucode":"31643B345C5B27","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/ad/79b26eea.jpg","comment_is_top":false,"comment_ctime":1591114029,"is_pvip":false,"replies":[{"id":83289,"content":"看看组件版本的区别","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1591950287,"ip_address":"","comment_id":223558,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，在这节课遇到了3个问题：\n1、序列化的时候，提示DomainEvents序列化死循环，导致我需要增加[IgnoreDataMember]注解，可是看老师的案例里面没有这个问题，不知道为什么。\n2、在领域事件中，领域事件可以确定只推送了一次，但是Handler这边，却处理了2次，这是为什么了。\n3、在集成事件这边，事件正常发出去了，然后接收到的时候，ID和Address却反序列化失败了，直到我将ID { get; protected set; }改成了ID｛get;set;｝之后，才能成功获取，Address同样，都需要将Set设置成功Public之后才能正常获取。\n但是其他Order中的参数，Set依然是private，却没有问题？\n……\n然后我运行了老师的Demo，都没有这些问题。。可是我对比起来，总感觉代码是没有区别的。。老师能说下，这问题出在哪里么。\n或者可能出现在哪些原因上么。。","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497165,"discussion_content":"看看组件版本的区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591950287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183749,"user_name":"陈正文","can_delete":false,"product_type":"c3","uid":1107451,"ip_address":"","ucode":"D1DF7997BA4105","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/fb/5b186d20.jpg","comment_is_top":false,"comment_ctime":1583126237,"is_pvip":false,"replies":[{"id":71582,"content":"看起来像是配置没注册对，你需要引入：\nMicrosoft.EntityFrameworkCore.SqlServer\n\n将：\nbuilder.UseMySql(connectionString);\n改为：\nbuilder.UseSqlServer(connectionString);","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1583566260,"ip_address":"","comment_id":183749,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"把mysql换成sqlserver后报错如下：System.InvalidOperationException:“ValueFactory attempted to access the Value property of this instance.”\n此异常最初是在此调用堆栈中引发的:\n\tSystem.Lazy&lt;T&gt;.ViaFactory(System.Threading.LazyThreadSafetyMode)\n\tSystem.Lazy&lt;T&gt;.ExecutionAndPublication(System.LazyHelper, bool)\n\tSystem.Lazy&lt;T&gt;.CreateValue()\n\tSystem.Lazy&lt;T&gt;.Value.get()\n\tMicrosoft.Extensions.Options.OptionsCache&lt;TOptions&gt;.GetOrAdd(string, System.Func&lt;TOptions&gt;)\n\tMicrosoft.Extensions.Options.OptionsManager&lt;TOptions&gt;.Get(string)\n\tMicrosoft.Extensions.Options.OptionsManager&lt;TOptions&gt;.Value.get()\n\tDotNetCore.CAP.SqlServer.SqlServerStorageInitializer.GetPublishedTableName()\n\tDotNetCore.CAP.SqlServer.SqlServerDataStorage.SqlServerDataStorage(Microsoft.Extensions.Options.IOptions&lt;DotNetCore.CAP.CapOptions&gt;, Microsoft.Extensions.Options.IOptions&lt;DotNetCore.CAP.SqlServerOptions&gt;, DotNetCore.CAP.Persistence.IStorageInitializer)","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485769,"discussion_content":"看起来像是配置没注册对，你需要引入：\nMicrosoft.EntityFrameworkCore.SqlServer\n\n将：\nbuilder.UseMySql(connectionString);\n改为：\nbuilder.UseSqlServer(connectionString);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583566260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107451,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/fb/5b186d20.jpg","nickname":"陈正文","note":"","ucode":"D1DF7997BA4105","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195826,"discussion_content":"问题找到了，这个应该是aspnetcore.cap的一个bug,通过查看cap的原码发现，如果在EFContext中注入ICapPublisher，会导致在初始化EFContext时获取依赖项中的IOption<SqlServerOptions>时报错","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583313403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156746,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a6/8a/d6e6aab8.jpg","nickname":"秦时明月","note":"","ucode":"B76BE4440BD6EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":245689,"discussion_content":"我也是报同样的错误把options.UseEntityFramework<DomainContext>()换成options.UseSqlServer就没问题了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587691945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306154,"user_name":"👑 👑","can_delete":false,"product_type":"c3","uid":2626523,"ip_address":"","ucode":"035BB06DBBE345","user_header":"https://static001.geekbang.org/account/avatar/00/28/13/db/d5222c1c.jpg","comment_is_top":false,"comment_ctime":1628409337,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"出现 ValueFactory attempted to access the Value property of this instance.错误好像是因为初始化时不应该EFContext的构造函数中进行服务的注册。\n可以将它从构造函数中移除新建一个静态的赋值方法来进行处理。并且在Controller的构造函数中进行注册并调用该方法进行赋值。\nEFContext：\n public static void SetICapPublisher(ICapPublisher capBus)\n        {\n            _capBus = capBus;\n        }\nController：\n public UserController(IMediator mediator, ICapPublisher capBus)\n        {\n            this._mediator = mediator;\n            DomainContext.SetICapPublisher(capBus);\n        }\nStartUP：\nUserMySql修改为 UseSqlServer\n\n如果出现_capPublisher.PublishAsync方法提示“cap.published”不存在\n可能是ICapPublisher初始化时数据库连接失败，这个时候可以看一下controller构造函数中ICapPublisher赋值时它的ConnectionString是否为空。\n通常都是缺少 options.UseEntityFramework&lt;DomainContext&gt;();造成的。\nConnectionString查看：\ncapBus加入监控，Non-Public members =》_storage =&gt;Non-Public members=&gt;_initialzer=&gt;Non-Public members=&gt;_options=&gt;Value","like_count":2},{"had_liked":false,"id":246259,"user_name":"XINGHE","can_delete":false,"product_type":"c3","uid":1809135,"ip_address":"","ucode":"5B659283931B95","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9a/ef/f3567104.jpg","comment_is_top":false,"comment_ctime":1599229501,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请教老师，使用CAP框架，如果B服务接收A服务的事件，但是无法完成处理，服务A服务进行回滚，应该如何设计呢？","like_count":2},{"had_liked":false,"id":349569,"user_name":"再见理想","can_delete":false,"product_type":"c3","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1656072296,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"services.AddCap(x =&gt;\n            {\n                x.UseEntityFramework&lt;AppDbContext&gt;();\n在dbContext中 使用Icappublish 会有循环引用的问题，调试了一天最后看了一下 cap的源码，\nWe detected that you are using ICapPublisher in DbContext, please change the configuration to use the storage extension directly to avoid circular references! eg:  x.UseMySql()","like_count":1},{"had_liked":false,"id":247512,"user_name":"beReply","can_delete":false,"product_type":"c3","uid":1912096,"ip_address":"","ucode":"45B0A70397B5CA","user_header":"https://static001.geekbang.org/account/avatar/00/1d/2d/20/d7fc08ea.jpg","comment_is_top":false,"comment_ctime":1599730294,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"sqlserver数据库\n使用options.UseEntityFramework&lt;DomainContext&gt;();注册会报ValueFactory attempted to access the Value property of this instance.”\n使用options.UseSqlServer(configuration.GetConnectionString(&quot;DefaultConnection&quot;));正常运行\n在这之前对sqlServer进行了注册，\n service.AddDbContext&lt;DomainContext&gt;(options =&gt; options\n                .UseSqlServer(connectString));","like_count":1,"discussions":[{"author":{"id":2626523,"avatar":"https://static001.geekbang.org/account/avatar/00/28/13/db/d5222c1c.jpg","nickname":"👑 👑","note":"","ucode":"035BB06DBBE345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385814,"discussion_content":"牛逼啊老哥。一直觉得这里有问题，但是不懂.net core 不知道具体是哪里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627285626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301951,"user_name":"沐雪","can_delete":false,"product_type":"c3","uid":1028301,"ip_address":"","ucode":"0C42BF0D75FD9B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/cd/c54572fe.jpg","comment_is_top":false,"comment_ctime":1625993383,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"services.AddTransient&lt;ISubscriberService, SubscriberService&gt;() 这里的生命周期应该是使用 单例模式吧？","like_count":0},{"had_liked":false,"id":288528,"user_name":"饭","can_delete":false,"product_type":"c3","uid":1610573,"ip_address":"","ucode":"B3F1702D4DE604","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJKj3GbvevFibxwJibTqm16NaE8MXibwDUlnt5tt73KF9WS2uypha2m1Myxic6Q47Zaj2DZOwia3AgicO7Q/132","comment_is_top":false,"comment_ctime":1618530357,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，请教一下\n现在公司这边可能让我负责为一个大型企业的生产制造执行(mes)系统做技术框架选型和设计，主要特点是业务功能比较庞大复杂，高并发高可用不用考虑。想来想去，如果就是简单做个前后分离，再将后端设计一个三层架构，好像也不够。\n不知道一般大型的业务功能庞大复杂的mes系统，用.net都是怎么设计，都用到哪些框架，不知道您这边有没有案例和建议可供参考，","like_count":0},{"had_liked":false,"id":247758,"user_name":"魏杨杨","can_delete":false,"product_type":"c3","uid":1813738,"ip_address":"","ucode":"694BCECBDD2DDB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/ac/ea/beb8eb34.jpg","comment_is_top":false,"comment_ctime":1599819809,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"\n        public static IServiceCollection AddEventBus(this IServiceCollection services, IConfiguration configuration)\n        {\n            &#47;&#47;services.AddDbContext&lt;DomainContext&gt;(options =&gt; options.UseSqlServer(configuration.GetValue&lt;string&gt;(&quot;MySqlServer&quot;)));\n            services.AddTransient&lt;ISubscriberService, SubscriberService&gt;();\n            services.AddCap(options =&gt;\n            {\n                options.UseSqlServer(configuration.GetValue&lt;string&gt;(&quot;MySqlServer&quot;));\n                &#47;&#47;options.UseEntityFramework&lt;DomainContext&gt;();\n                &#47;&#47;options.UseSqlServer();\n\n                options.UseRabbitMQ(options =&gt;\n                {\n                    configuration.GetSection(&quot;RabbitMQ&quot;).Bind(options);\n                    &#47;&#47;options.Port\n                });\n                options.FailedRetryCount = 20; &#47;&#47;重试20次结束\n                options.FailedThresholdCallback = failed =&gt;\n                {\n                    var logger = failed.ServiceProvider.GetService&lt;ILogger&gt;();\n                    logger.LogInformation($@&quot;A message of type {failed.MessageType} failed after executing {options.FailedRetryCount} several times, \n                        requiring manual troubleshooting. Message name: {failed.Message.GetName()}&quot;);\n                };\n                options.UseDashboard();\n            });\n\n            return services;\n        }\n\n我也是报错 使用options.UseEntityFramework&lt;DomainContext&gt;();注册会报ValueFactory attempted to access the Value property of this instance.”\n public static IServiceCollection AddSqlServerDomainContext(this IServiceCollection services, string connectionString)\n        {\n            return services.AddDomainContext(builder =&gt;\n            {\n                builder.UseSqlServer(connectionString);\n            });\n        }\n改成了这个   现在项目不会报错  订阅事件接收不了","like_count":0},{"had_liked":false,"id":237582,"user_name":"张俊杰","can_delete":false,"product_type":"c3","uid":1309986,"ip_address":"","ucode":"F2CBA500DC94BD","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/22/32b95be7.jpg","comment_is_top":false,"comment_ctime":1595889990,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"老师，在webform下有什么类似cap框架 ，觉得不错的推荐下呗","like_count":0},{"had_liked":false,"id":228538,"user_name":"爱学习的大叔","can_delete":false,"product_type":"c3","uid":1085152,"ip_address":"","ucode":"91F9ABF1EC98D0","user_header":"https://static001.geekbang.org/account/avatar/00/10/8e/e0/847348b1.jpg","comment_is_top":false,"comment_ctime":1592729431,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"老师，你能讲讲rabitMQ到底在这两个地方起了个什么作用吗？\n我们的MediatR首先是把事件放到publish表，然后rabbitMQ从这里边取出来，然后subscribe端从消息队列里取数据然后消费，再把消费结果存到subscribe表里的吗？","like_count":0},{"had_liked":false,"id":208785,"user_name":"路人乙","can_delete":false,"product_type":"c3","uid":1816206,"ip_address":"","ucode":"1A8AEB9FF1CDEB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/b6/8e/2b4504a9.jpg","comment_is_top":false,"comment_ctime":1587438019,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"老师，我同一个方法中使用_capPublisher发布多次同一类型的消息（集成事件的参数不同）。如_capPublisher.PublishAsync(“CreateOrder”,order)这里每个order，的参数是不同的。多个消息发布后在数据库的发布表中可以看到成功发布了多个消息，而消费表也能消费全部的消息，但消费表执行的集成事件的参数值都是最后发布的参数。相当于发布的消息如果没来得及执行，那最终执行时会全部执行成最后发布消息时传递过来的内容。为了验证是不是因为消息为执行又发布消息引起的问题，我在发布每条消息后线程等待一秒问题就解决了。想知道这种问题要怎么解决，如果有并发出现同一时刻发布了多个同类消息，那消费端会不会就出问题了。","like_count":0,"discussions":[{"author":{"id":1816206,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/b6/8e/2b4504a9.jpg","nickname":"路人乙","note":"","ucode":"1A8AEB9FF1CDEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":244562,"discussion_content":"老师，原因我找到了。是因为集成事件传递的对象是引用类型，同时发布多个集成事件时虽然我修改了引用对象的值，但消费时是读的对象最后的状态。我有一点不解的是如果读的是最后的状态，为什么发布表的值是保存的是每次对象的值，只有消费表保存的是消费时对象的最终值。那是不是理解成消费的对象值并不是从发布表中序列化出来的，而是从内存中获取的，那发布表保存的数据意义是内存中该对象不存在时才从数据库中读取。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587612714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201215,"user_name":"王亚","can_delete":false,"product_type":"c3","uid":1810841,"ip_address":"","ucode":"765CDC2A4DF8CF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a1/99/137f5ff7.jpg","comment_is_top":false,"comment_ctime":1585733772,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"肖老师：我在本地使用sql数据库调试时  发现当程序在推送集成事件(代码：await _capPublisher.PublishAsync(&quot;OrderCreated&quot;, new OrderCreatedIntegrationEvent(notification.Order.Id));)  走到这里时， 页面提示异常(异常信息：Microsoft.Data.SqlClient.SqlException (0x80131904): “`”附近有语法错误。\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean&amp; dataReady.......))  这是什么原因呢？ ","like_count":0},{"had_liked":false,"id":197119,"user_name":"艾roger","can_delete":false,"product_type":"c3","uid":1359790,"ip_address":"","ucode":"9F65CE9A81D6DB","user_header":"","comment_is_top":false,"comment_ctime":1585358720,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"cap如何配置多个exchange?我在exchange A订阅event1后处理成功，再发布event2到另一个exchang B.这个需求如何配置实现？","like_count":0},{"had_liked":false,"id":183748,"user_name":"陈正文","can_delete":false,"product_type":"c3","uid":1107451,"ip_address":"","ucode":"D1DF7997BA4105","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/fb/5b186d20.jpg","comment_is_top":false,"comment_ctime":1583126166,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"我把mysql换成sqlserver，在启动项目时总是报错","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214271,"discussion_content":"看源码，提issue","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585156529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182995,"user_name":"顾你心安","can_delete":false,"product_type":"c3","uid":1813098,"ip_address":"","ucode":"D0080EBA52CFBB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/aa/6a/fade4619.jpg","comment_is_top":false,"comment_ctime":1582903414,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100044601,"comment_content":"听懂了  可以","like_count":0}]}