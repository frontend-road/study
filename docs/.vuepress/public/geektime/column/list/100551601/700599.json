{"id":700599,"title":"模拟面试｜缓存面试思路一图懂","content":"<p>你好，我是大明。</p><p>恭喜你学完第四章的内容，又到了要验收成果的时刻了。缓存这一章的内容很重要，知识也很系统，所以为了帮助你更好地掌握这部分内容，我们在这里设置了面试题。</p><p>你在回答的时候，最好是能够写成一个个文档，至少也要口头上说一遍。千万不要仅仅在脑海里面回忆一遍。因为在真正面试的时候，脑海中的记忆到嘴里说出的话，还需要一个转换。</p><h2>31 为什么 Redis 不立刻删除已经过期的数据？</h2><ol>\n<li>Redis 是怎么删除过期 key 的？</li>\n<li>Redis 为什么不立刻删除已经过期的 key？</li>\n<li>Redis 为什么不每个 key 都启动一个定时器，监控过期时间？</li>\n<li>Redis 是如何执行定期删除的？</li>\n<li>为什么 Redis 在定期删除的时候不一次性把所有的过期 key 都删除掉？</li>\n<li>当你从 Redis 上查询数据的时候，有可能查询到过期的数据吗？</li>\n<li>当 Redis 生成 RDB 文件的时候，会怎么处理过期的 key？</li>\n<li>当 Redis 重写 AOF 文件的时候，会怎么处理过期的 key？</li>\n<li>Redis 定期删除的循环是不是执行得越频繁就越好？</li>\n<li>如果设计一个本地缓存，你会怎么实现删除过期 key 的功能？</li>\n<li>你是怎么确定过期时间的？过期时间太长会怎样，太短又会怎样？</li>\n</ol><h2>32 缓存淘汰策略：怎么淘汰缓存命中率才不会下降？</h2><ol>\n<li>你知道什么是 LFU，什么是 LRU 吗？可不可以手写一个？</li>\n<li>什么情况下使用 LFU，什么情况下使用 LRU？</li>\n<li>Redis 支持哪些淘汰策略？你们公司的 Redis 上的淘汰策略使用了哪个？为什么用这个？</li>\n<li>你使用的本地缓存是如何控制内存使用量的？</li>\n<li>你业务里面的缓存命中率有多高？还能不能进一步提高？怎么进一步提高？</li>\n<li>假如说 A 和 B 两个业务共用一个 Redis，那么有办法控制 A 业务的 Redis 内存使用量吗？怎么控制？</li>\n<li>现在我的业务里面有普通用户和 VIP 用户。现在我希望在缓存内存不足的时候，优先淘汰普通用户的数据，该怎么做？</li>\n</ol><!-- [[[read_end]]] --><h2>33 缓存模式：缓存模式能不能解决缓存一致性问题？</h2><ol>\n<li>什么是 Cache Aside，它能不能解决数据一致性问题？</li>\n<li>什么是 Read Through，它能不能解决数据一致性问题？</li>\n<li>什么是 Write Through，它能不能解决数据一致性问题？</li>\n<li>什么是 Write Back，它有什么缺点，能不能解决一致性问题？</li>\n<li>什么是 Refresh Ahead，它能不能解决一致性问题？</li>\n<li>什么是 Singleflight 模式？你用它解决过什么问题？</li>\n<li>在具体的工作场景中，你是怎么更新数据的？会不会有数据不一致的问题？怎么解决？</li>\n<li>什么是延迟双删，使用延迟双删能不能解决数据一致性问题？</li>\n<li>你知道哪些缓存模式，用过哪些模式？</li>\n</ol><h2>34 缓存一致性问题：高并发服务如何保证缓存一致性？</h2><ol>\n<li>为什么会有数据不一致的问题？</li>\n<li>你在使用缓存的时候怎么解决数据不一致的问题？</li>\n<li>当你的数据不一致的时候，你多久能够发现？</li>\n<li>如果你使用了本地缓存和 Redis，那么更新数据的时候你怎么更新？</li>\n<li>使用分布式锁能不能解决数据一致性问题，有什么缺点？</li>\n<li>你能保证更新数据库和更新缓存同时成功吗？如果不能，你怎么解决？</li>\n<li>你有什么方法可以解决并发更新导致的数据不一致性问题？</li>\n</ol><h2>35 缓存问题：怎么解决缓存穿透、击穿和雪崩问题？</h2><ol>\n<li>什么是缓存穿透、击穿和雪崩？</li>\n<li>你平时遇到过缓存穿透、击穿和雪崩吗？什么原因引起的？最终是怎么解决的？</li>\n<li>你还遇到过什么跟缓存有关的事故？最终都是怎么解决的？</li>\n<li>在你的系统里面，如果 Redis 崩溃了会发生什么？</li>\n<li>怎么在 Redis 崩溃之后保护好数据库？</li>\n</ol><h2>36 Redis 单线程：为什么 Redis 用单线程而 Memcached 用多线程？</h2><ol>\n<li>操作系统中的上下文切换有什么开销？</li>\n<li>Redis 真的是单线程的吗？</li>\n<li>Redis 为什么后面又引入了多线程？</li>\n<li>Redis 后面的引入的多线程模型是怎么运作的？相比原本的单线程模型有什么改进？</li>\n<li>同样是缓存，为什么 Memcached 使用了多线程？</li>\n<li>什么是 epoll？和 poll、select 比起来，有什么优势？</li>\n<li>什么是 Reactor 模式？</li>\n<li>为什么 Redis 的性能那么好？</li>\n<li>你可以说说 Redis 的 IO 模型吗？</li>\n<li>为什么 Redis 可以用单线程，但是 Kafka 之类的中间件确不能使用单线程呢？</li>\n</ol><h2>37 分布式锁：如何保证Redis分布式锁的高可用和高性能？</h2><ol>\n<li>什么是分布式锁？你用过分布式锁吗？</li>\n<li>你使用的分布式锁性能如何，可以优化吗？</li>\n<li>怎么用 Redis 来实现一个分布式锁？</li>\n<li>怎么确定分布式锁的过期时间？</li>\n<li>如果分布式锁过期了，但是业务还没有执行完毕，怎么办？</li>\n<li>加锁的时候得到了超时响应，怎么办？</li>\n<li>加锁的时候如果锁被人持有了，这时候怎么办？</li>\n<li>分布式锁为什么要续约？续约失败了怎么办？如果重试一直都失败，怎么办？</li>\n<li>怎么减少分布式锁竞争？</li>\n<li>你知道 redlock 是什么吗？</li>\n</ol><h2>38 缓存综合应用：怎么用缓存来提高整个应用的性能？</h2><ol>\n<li>你是如何利用缓存来提高系统性能的？</li>\n<li>当你的缓存崩溃了的时候，你的系统会怎么样？</li>\n<li>你们公司的 Redis 是如何部署的，性能怎么样？</li>\n<li>假如说有一个服务 A 要调用服务 B，那么能不能让 A 把 B 的结果缓存下来，这样下次就不用调用了？这种做法有什么优缺点？</li>\n<li>为什么要做缓存预加载，怎么做预加载？</li>\n</ol><h2>缓存面试一图懂</h2><p><img src=\"https://static001.geekbang.org/resource/image/23/83/23e884c0da65e31fa76175dc41e68a83.jpg?wh=6309x3896\" alt=\"图片\"></p><p>最后我将这一章的内容整理成了一张图片，图片能够更好地展现知识点之间的联系，你可以参考，如果你觉得有用的话，可以把这节课的内容分享给身边的朋友，邀他一起学习，共同进步。好了，我们下一章再见吧！</p>","neighbors":{"left":{"article_title":"38｜缓存综合应用：怎么用缓存来提高整个应用的性能？","id":701317},"right":{"article_title":"39｜Elasticsearch高可用：怎么保证Elasticsearch的高可用？","id":701813}},"comments":[{"had_liked":false,"id":381281,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"北京","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1694990074,"is_pvip":false,"replies":[{"id":139048,"content":"1. 这个是语言专属概念，一些语言是没有的，所以我没有加餐讲这个的计划。\n2. 可以先自己部署，云服务太贵了！\n3. 有现成的，基本上所有的语言都有！","user_name":"作者回复","user_name_real":"编辑","uid":1176655,"ctime":1695729029,"ip_address":"广东","comment_id":381281,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100551601,"comment_content":"请教老师几个问题：\nQ1：前面讲过ThreadLocal吗？如果没有，能否加餐讲一下？\nQ2：我准备做一个网站，需要用到Redis。是自己搭建Redis还是用云服务厂商的Redis？更进一步地说，整个网站，包括服务处理的机器，是采用云服务厂商的设备还是自己搭建？\nQ3：本地缓存，有现成的框架吗？还是自己开发？","like_count":0,"discussions":[{"author":{"id":1176655,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/4f/aa916c8c.jpg","nickname":"邓小明","note":"","ucode":"02243D1F7492A6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628715,"discussion_content":"1. 这个是语言专属概念，一些语言是没有的，所以我没有加餐讲这个的计划。\n2. 可以先自己部署，云服务太贵了！\n3. 有现成的，基本上所有的语言都有！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695729029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390412,"user_name":"闫同学","can_delete":false,"product_type":"c1","uid":2415188,"ip_address":"北京","ucode":"739F505066AFE0","user_header":"https://static001.geekbang.org/account/avatar/00/24/da/54/33dabd0a.jpg","comment_is_top":false,"comment_ctime":1715303719,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100551601,"comment_content":"再分享一个常见面试题：手写一个LRU😁","like_count":1},{"had_liked":false,"id":388775,"user_name":"海浪","can_delete":false,"product_type":"c1","uid":2278559,"ip_address":"湖南","ucode":"091941B3556B4B","user_header":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","comment_is_top":false,"comment_ctime":1710855761,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100551601,"comment_content":"先mark一下，正在准备面试，希望有帮助","like_count":0}]}