{"id":151118,"title":"13 | 源码剖析：Netty对处理粘包/半包的支持","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geek_netty\">https://gitee.com/geektime-geekbang/geek_netty</a></p>","comments":[{"had_liked":false,"id":151336,"user_name":"冬渐暖","can_delete":false,"product_type":"c3","uid":1586800,"ip_address":"","ucode":"907E41AAE9A36C","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/70/00122b24.jpg","comment_is_top":false,"comment_ctime":1573701699,"is_pvip":false,"replies":[{"id":62335,"content":"因为组合的方式没有经过充分的证明：证明在所有场景下肯定比内存复制的性能要好（毕竟组合方式的指针维护复杂些，如果解码是把组合的直接能拆出来就可以用，那明显会好，例如ssl hanlder里面就有显示设置为组合方式的例子，但是大多不是如此用，仅有的测试也只是表明好一点而已)，所以自然默认就用原始的那种方式（也就是所有人一上来就会想到的通用的内存复制的方式），而不是直接切换到后来加的组合方式，只是提供了setCumulator方法让我们有切换的选择。\n总结下：不是说1+1不等于2，而是说大家都这么觉得，但是没有人去有力的证明，所以保持怀疑的态度，就保守起见了，没有改默认的。","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1576833729,"ip_address":"","comment_id":151336,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"在编码数据前，先对数据进行积累Cumulator。解码的时候先判断是否小于固定的长度，小的话就是包不全也就不去解码数据，等于的话就直接解(没问题)，大于的话就解对应长度的，多的那部分还是在积累器里面，等下次用\n\n关于Cumulator，先看看空间够不够，不够扩容，然后\n有两种方式\n1.内存复制(默认)\n2.像list一样组合起来\n内容复制：就是把数据复制到内存里面去\n关于您说内存复制是默认的，，，buff是子类的decoder搞出来的，所以不能说哪个是绝对的好，但为什么内存复制更加通用所以才选择这个啊.........................?\n\nnetty有三个编码器，对应上节的三个找边界的，\n其中有个固定长度的，可以设置偏移量等一系列参数，比如传进来的数据为“18cm不含头”，描述符为“7”  ，下次读的时候就往右偏一个字段，不读描述符的那个“7”  \n","like_count":3,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474442,"discussion_content":"因为组合的方式没有经过充分的证明：证明在所有场景下肯定比内存复制的性能要好（毕竟组合方式的指针维护复杂些，如果解码是把组合的直接能拆出来就可以用，那明显会好，例如ssl hanlder里面就有显示设置为组合方式的例子，但是大多不是如此用，仅有的测试也只是表明好一点而已)，所以自然默认就用原始的那种方式（也就是所有人一上来就会想到的通用的内存复制的方式），而不是直接切换到后来加的组合方式，只是提供了setCumulator方法让我们有切换的选择。\n总结下：不是说1+1不等于2，而是说大家都这么觉得，但是没有人去有力的证明，所以保持怀疑的态度，就保守起见了，没有改默认的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576833729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141836,"user_name":"加载中……","can_delete":false,"product_type":"c3","uid":1366948,"ip_address":"","ucode":"3E59A0A0784D0A","user_header":"https://static001.geekbang.org/account/avatar/00/14/db/a4/191be6ad.jpg","comment_is_top":false,"comment_ctime":1571234444,"is_pvip":false,"replies":[{"id":54973,"content":"不知道您这里说的上层是指什么？如果是业务层，确实是的，它先把不够数据屯起来，所以不会往外传，传也没用，因为不完整","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571387973,"ip_address":"","comment_id":141836,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师好，请教个问题。\n对于Netty来说，如果一次解码，因为长度不够没解出来，上层的处理代码是不是永远也感知不到这部分数据？","like_count":2,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470905,"discussion_content":"不知道您这里说的上层是指什么？如果是业务层，确实是的，它先把不够数据屯起来，所以不会往外传，传也没用，因为不完整","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571387973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147112,"user_name":"蓝魔丶","can_delete":false,"product_type":"c3","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1572796115,"is_pvip":false,"replies":[{"id":62336,"content":"这是个好问题，正好前面（或许是后面）也有一个人问这个问题，我直接复制下给他的回复吧：\n因为组合的方式没有经过充分的证明：证明在所有场景下肯定比内存复制的性能要好（毕竟组合方式的指针维护复杂些，如果解码是把组合的直接能拆出来就可以用，那明显会好，例如ssl hanlder里面就有显示设置为组合方式的例子，但是大多不是如此用，仅有的测试也只是表明好一点点而已)，所以自然默认就还是用原始的那种方式（也就是所有人一上来就会想到的通用的内存复制的方式），而不是直接切换到后来加的组合方式，另外提供了setCumulator方法让我们有切换的选择。\n\n总结下：不是说1+1不等于2，而是说大家都这么觉得，但是没有人去有力的证明，所以保持怀疑的态度，就保守起见了，没有改默认的。\n","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1576833857,"ip_address":"","comment_id":147112,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，视频里讲到的数据收集器有两种方式，一种内存复制，一种组合方式，这两种方式netty选择内存复制作为默认方式，视频中也说明了原因，但是感觉不够深入，听着还是没有说服力，后面会有深入分析嘛？","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473153,"discussion_content":"这是个好问题，正好前面（或许是后面）也有一个人问这个问题，我直接复制下给他的回复吧：\n因为组合的方式没有经过充分的证明：证明在所有场景下肯定比内存复制的性能要好（毕竟组合方式的指针维护复杂些，如果解码是把组合的直接能拆出来就可以用，那明显会好，例如ssl hanlder里面就有显示设置为组合方式的例子，但是大多不是如此用，仅有的测试也只是表明好一点点而已)，所以自然默认就还是用原始的那种方式（也就是所有人一上来就会想到的通用的内存复制的方式），而不是直接切换到后来加的组合方式，另外提供了setCumulator方法让我们有切换的选择。\n\n总结下：不是说1+1不等于2，而是说大家都这么觉得，但是没有人去有力的证明，所以保持怀疑的态度，就保守起见了，没有改默认的。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576833857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165634,"user_name":"delete is create","can_delete":false,"product_type":"c3","uid":1147979,"ip_address":"","ucode":"A8C751219A7746","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/4b/e4738ba8.jpg","comment_is_top":false,"comment_ctime":1577274478,"is_pvip":false,"replies":[{"id":63245,"content":"你这个问题是你自己假想的？因为最终交给底层的（jdk的）的数据类型还是byte，所以你肯定要转的，所以你的16进制最终还是要与byte互转，所以再加一层编解码就行，或者直接在已有的编解码里面转也可以。另外，DelimiterBasedFrameDecoder说是分隔符，但是还是byte：io.netty.handler.codec.DelimiterBasedFrameDecoder#delimiters","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1577341208,"ip_address":"","comment_id":165634,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"如果客户端传的是16进制字节流，用DelimiterBasedFrameDecoder做分隔符就不好使了，客户端必须发送字符串才行   老师怎么解决这个问题","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479240,"discussion_content":"你这个问题是你自己假想的？因为最终交给底层的（jdk的）的数据类型还是byte，所以你肯定要转的，所以你的16进制最终还是要与byte互转，所以再加一层编解码就行，或者直接在已有的编解码里面转也可以。另外，DelimiterBasedFrameDecoder说是分隔符，但是还是byte：io.netty.handler.codec.DelimiterBasedFrameDecoder#delimiters","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577341208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147979,"avatar":"https://static001.geekbang.org/account/avatar/00/11/84/4b/e4738ba8.jpg","nickname":"delete is create","note":"","ucode":"A8C751219A7746","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":102207,"discussion_content":"项目中挺急的   求回复😭😭😭😭😭","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577330790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165570,"user_name":"Sebastian","can_delete":false,"product_type":"c3","uid":1352305,"ip_address":"","ucode":"48850ECAC5672E","user_header":"https://static001.geekbang.org/account/avatar/00/14/a2/71/bc433eda.jpg","comment_is_top":false,"comment_ctime":1577261918,"is_pvip":false,"replies":[{"id":63193,"content":"可以先看第四章，但是直接看，就算是demo，缺乏很多背景知识也难懂，所以才把相关知识放前面了，你可以结合着看看，现在都更新完了。谢谢","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1577322124,"ip_address":"","comment_id":165570,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"不应该先写个netty使用的demo吗。从来没接触过netty的看着有点蒙","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479208,"discussion_content":"可以先看第四章，但是直接看，就算是demo，缺乏很多背景知识也难懂，所以才把相关知识放前面了，你可以结合着看看，现在都更新完了。谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577322124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274464,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/60/288023be.jpg","nickname":"YU","note":"","ucode":"4EE45D6FC2862F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266277,"discussion_content":"个人觉得先自己写下demo起再看不是更好么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589500251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158872,"user_name":"polk","can_delete":false,"product_type":"c3","uid":1165455,"ip_address":"","ucode":"1B6E948BA4DFAF","user_header":"https://static001.geekbang.org/account/avatar/00/11/c8/8f/e13a6552.jpg","comment_is_top":false,"comment_ctime":1575467697,"is_pvip":false,"replies":[{"id":60801,"content":"因为他的源码那个注释很详细，里面也有图(虽然不太好看)，所以对着源码说了，哈","user_name":"作者回复","user_name_real":"傅健","uid":1638649,"ctime":1575490117,"ip_address":"","comment_id":158872,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"讲那四个参数，打开画图或者notepad写两个例子不就一目了然了，光对着源码我又得看很多遍","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476876,"discussion_content":"因为他的源码那个注释很详细，里面也有图(虽然不太好看)，所以对着源码说了，哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575490117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146748,"user_name":"陆凌枫","can_delete":false,"product_type":"c3","uid":1349513,"ip_address":"","ucode":"622DEFC9DACDBA","user_header":"https://static001.geekbang.org/account/avatar/00/14/97/89/51f532f8.jpg","comment_is_top":false,"comment_ctime":1572627330,"is_pvip":false,"replies":[{"id":57244,"content":"推荐一本 java tcp ip socket网络编程，默认很多没有讲的前提性的基础知识可以看看这本。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573047893,"ip_address":"","comment_id":146748,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，课程看得很吃力，特别是一讲源码。想问下学习Netty之前，需要先补下nio相关知识点吗？或者是其它相关知识点？","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473004,"discussion_content":"推荐一本 java tcp ip socket网络编程，默认很多没有讲的前提性的基础知识可以看看这本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573047893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145132,"user_name":"reed7","can_delete":false,"product_type":"c3","uid":1012263,"ip_address":"","ucode":"0AD347AF4AA3C9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqUROHbmLiaBhHU4T5rHpDwqKzvSFAJwZ6qvKhRB8wMmhltQeRtFg5KWUVvW78U97K8iaicuKz6OVcicQ/132","comment_is_top":false,"comment_ctime":1572222533,"is_pvip":false,"replies":[{"id":56572,"content":"自己代码指定的，也就是你定义了你的传输信息结构，或者说叫pdu后，你就确定了你用那种解码了，然后你就找哪些支持了，显示设置下，找不到就只能自己写了。就是你告诉他怎么解他才知道，它自己不自动判断","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1572540914,"ip_address":"","comment_id":145132,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"Netty 在运行时是依据什么信息决定使用哪个 decoder 的？","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472258,"discussion_content":"自己代码指定的，也就是你定义了你的传输信息结构，或者说叫pdu后，你就确定了你用那种解码了，然后你就找哪些支持了，显示设置下，找不到就只能自己写了。就是你告诉他怎么解他才知道，它自己不自动判断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572540914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144943,"user_name":"NoBody","can_delete":false,"product_type":"c3","uid":1173766,"ip_address":"","ucode":"72E1B4FCDA2469","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/06/038a9cea.jpg","comment_is_top":false,"comment_ctime":1572109206,"is_pvip":false,"replies":[{"id":56356,"content":"这是两种学习方法，但是netty的使用真的很简单，所以才把这个顺序掉过来了😂，你可以尝试换个方法看，从后往前看，然后再反过来看下。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1572429210,"ip_address":"","comment_id":144943,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师你好，对于java网络编程没有实际经验只有了解的情况下的开发人员来说。我觉得这样的课程安排其实有点欠妥。源码层面是否应该在掌握了一些基本概念和基本使用的情况下去认识呢？","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472179,"discussion_content":"这是两种学习方法，但是netty的使用真的很简单，所以才把这个顺序掉过来了😂，你可以尝试换个方法看，从后往前看，然后再反过来看下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572429210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144301,"user_name":"WING","can_delete":false,"product_type":"c3","uid":1485200,"ip_address":"","ucode":"E4723BA4027407","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IdElofI20lsCUm1NIQPSpYFzAGLbLs41SL324FkmTb0icqnRJicW6mqX4iag1BQUSNtc7BtKJ2fEUYwU4rN47vEsQ/132","comment_is_top":false,"comment_ctime":1571890958,"is_pvip":false,"replies":[{"id":61534,"content":"后面确实有一节提及内存相关了，主要说的是堆外内存、内存池等相关的。","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1576219245,"ip_address":"","comment_id":144301,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，这节课中提到内存复制和非内存复制，后面有两节课讲内存的，会不会设计到这方面？很想了解netty作者在这方面的巧妙之处。","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471881,"discussion_content":"后面确实有一节提及内存相关了，主要说的是堆外内存、内存池等相关的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576219245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142019,"user_name":"偶然~zZ","can_delete":false,"product_type":"c3","uid":1445062,"ip_address":"","ucode":"84D0ACA932AC01","user_header":"https://static001.geekbang.org/account/avatar/00/16/0c/c6/934e3e4f.jpg","comment_is_top":false,"comment_ctime":1571279549,"is_pvip":false,"replies":[{"id":54970,"content":"这个是安排在第四章和第五章，先大体看下源码有个印象，再实战可能效果好点，所以才这么安排的","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571386500,"ip_address":"","comment_id":142019,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"希望老师多一点实战教学  一边实战 一边解读  光讲源码 映像不是很熟深刻","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470956,"discussion_content":"这个是安排在第四章和第五章，先大体看下源码有个印象，再实战可能效果好点，所以才这么安排的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571386500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176749,"user_name":"Standly","can_delete":false,"product_type":"c3","uid":1181055,"ip_address":"","ucode":"805CC5784D3F76","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/7f/a7df049a.jpg","comment_is_top":false,"comment_ctime":1581154125,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"看了源码，说下我对两种方式的Cumulator的理解。我觉得使用哪种主要看decode实现，如果decode的实现包含很多随机读（比如读取第4-8个字节这种），这种情况肯定是基于复制的Cumulator更好，因为复制方式是连续内存，随机读时间复杂度为O(1), 而组合方式是基于数组实现，由于不确定目标内容在数组的位置，所以 需要遍历数组，效率偏低。","like_count":15,"discussions":[{"author":{"id":1438212,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f2/04/993ec92d.jpg","nickname":"赵达铭","note":"","ucode":"8ED742EA118285","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318485,"discussion_content":"三级头有点厉害","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603763969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371580,"user_name":"Homto","can_delete":false,"product_type":"c3","uid":1432755,"ip_address":"四川","ucode":"EBA8CDB9FC4AFD","user_header":"https://static001.geekbang.org/account/avatar/00/15/dc/b3/1e09c2d5.jpg","comment_is_top":false,"comment_ctime":1680077279,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"和Nginx的思想是一样的","like_count":0},{"had_liked":false,"id":351368,"user_name":"归去来兮","can_delete":false,"product_type":"c3","uid":1094810,"ip_address":"","ucode":"7218D8E70FA654","user_header":"https://static001.geekbang.org/account/avatar/00/10/b4/9a/a9167c59.jpg","comment_is_top":false,"comment_ctime":1657730903,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"tcp丢包，LengthFieldBasedFrameDecoder会怎么处理？顺序是不是会乱？怎么知道那个几个字节是length？","like_count":0,"discussions":[{"author":{"id":1113292,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fc/cc/9f90b797.jpg","nickname":"77","note":"","ucode":"4D497A36896766","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635234,"discussion_content":"tcp是可靠的 有专门的机制来处理丢包","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704617471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300690,"user_name":"熊猫","can_delete":false,"product_type":"c3","uid":1080238,"ip_address":"","ucode":"23C85117A16BEF","user_header":"https://static001.geekbang.org/account/avatar/00/10/7b/ae/66ae403d.jpg","comment_is_top":false,"comment_ctime":1625307732,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"老师，不解决粘包和半包会遇到什么问题？","like_count":0,"discussions":[{"author":{"id":2420294,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ee/46/7d65ae37.jpg","nickname":"木几丶","note":"","ucode":"FFDB958DA64F8C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390226,"discussion_content":"可能会出现多读或者少读，得到的消息不是预期想要的，当然只是可能，看tcp具体传输的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629720401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271422,"user_name":"sonnyfu","can_delete":false,"product_type":"c3","uid":1124795,"ip_address":"","ucode":"8E843CE6FA207B","user_header":"https://wx.qlogo.cn/mmopen/vi_32/KJUOWgZ6tc7j6s3ofibT3WvHH0XhnZB69uT4YNZ3QKC0x2ooSLT2RC59ocp6EHW922ViaW5KlJWuRIfwkqLVRMMw/132","comment_is_top":false,"comment_ctime":1609603186,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"傅老师，您好，对于找出消息的边界，请问为什么说\nTCP 连接改成短连接的方式效率低下？","like_count":0,"discussions":[{"author":{"id":1435389,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e6/fd/9f1c9398.jpg","nickname":"陈 yi 豪","note":"","ucode":"BFBFCF8768A0B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607684,"discussion_content":"连接的创建和销毁都要消耗资源的。建立连接的时候先要三次握手，断开连接的时候又要四次挥手。\n假如要发10条消息。\n长连接模式下，只需要一轮握手建立连接，十条消息发完，只要一一轮挥手断开连接。总共只有1次建立连接和1次断开连接的操作\n改成短链接，就得 创建链接-发送消息-断开连接，以上操作重复10次。总共10次建立连接和10断开连接的操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678089210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264667,"user_name":"溪","can_delete":false,"product_type":"c3","uid":1299922,"ip_address":"","ucode":"B451ED2B70EE07","user_header":"https://static001.geekbang.org/account/avatar/00/13/d5/d2/8fc0c5b6.jpg","comment_is_top":false,"comment_ctime":1606568972,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"MERGE_CUMULATOR是通过copy实现，实际操作的是ByteBuf；COMPOSITE_CUMULATOR操作的CompositeByteBuf可以看做是对ByteBuf的封装，其维护了一个ByteBuf的List列表，每次cumulate操作其实把当前的ByteBuf放到List中。我认为这两种cumulate的性能侧重点不同，merge方式提前copy，那么读取时会更快，反之，使用composite的方式在读取时需要遍历List，读取数据时更慢。\n参考：io.netty.buffer.CompositeByteBuf#getBytes(int, byte[], int, int) ","like_count":0},{"had_liked":false,"id":258031,"user_name":"javaYJL","can_delete":false,"product_type":"c3","uid":1188249,"ip_address":"","ucode":"E326EB9AFDCE32","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/99/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1604275177,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"老师，你好！ByteToMessageDecoder的channelRead的方法里面finally里面都会 fireChannelRead(ctx, out, size);那么如果没有解析出数据还往下传这样的设计是基于哪方面的考虑\n","like_count":0},{"had_liked":false,"id":257148,"user_name":"tt","can_delete":false,"product_type":"c3","uid":1489957,"ip_address":"","ucode":"7753B79AD5A9AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","comment_is_top":false,"comment_ctime":1603863319,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"流畅，过瘾，庖丁解牛","like_count":0},{"had_liked":false,"id":178605,"user_name":"瓜瓜","can_delete":false,"product_type":"c3","uid":1108505,"ip_address":"","ucode":"F90A5135A9BB4B","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/19/14018371.jpg","comment_is_top":false,"comment_ctime":1581757937,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"lengthFieldLength是从流中取出4个字节（java中int占4个字节）作为该字段的值吗？？包括lengthFieldOffset等等字段也是一样吗？？望老师解答","like_count":0,"discussions":[{"author":{"id":1299922,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d5/d2/8fc0c5b6.jpg","nickname":"溪","note":"","ucode":"B451ED2B70EE07","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330290,"discussion_content":"lengthFieldLength是你设置的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606556810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}