{"id":564801,"title":"79｜线段编辑器：架构思路与任务拆分","content":"<p>你好，我是徐昊。从今天开始，我们就来使用TDD的方式实现一个线段编辑器（Line Editor）。</p><p>在之前的三个项目中，我们展示了如何使用TDD的方式来实现功能以及框架。接下来，我们要通过一个非常简单的项目，展示如何使用TDD的方式，实现以交互为主的功能。</p><h2>线段编辑器的功能说明</h2><p><video poster=\"https://media001.geekbang.org/337455c2769a4004916a793615d4ea2e/snapshots/fa0ca65e3ae045f1ba0a1721f82cd36e-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/56b29c53-1833154e9b4-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/8d8b998ffde040a69b21a07acf948180/01f828091d5949f99d379a3ac3df0e22-48f10f8797c14916e6e2955065229353-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>通过上面对于功能的说明，对于线段编辑器，它的功能大致有这么几点：</p><ol>\n<li>在线段上设置锚点（Anchor），当拖动锚点时，锚点的位置改变；</li>\n<li>在锚点与锚点之间，存在控制点（Control Point），当拖动控制点时，会在将控制点变成锚点；</li>\n<li>当双击锚点时，会删除这个锚点。</li>\n</ol><p>我们选择的技术栈是TypeScript + React + Konva（React-Konva），测试框架使用Vitest。package.json 如下所示：</p><pre><code class=\"language-plain\">{\n  \"name\": \"line-editor\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"tsc &amp;&amp; vite build\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"konva\": \"^8.3.12\",\n    \"react\": \"^18.2.0\",\n    \"react-dom\": \"^18.2.0\",\n    \"react-konva\": \"^18.2.1\"\n  },\n  \"devDependencies\": {\n    \"@types/react\": \"^18.0.17\",\n    \"@types/react-dom\": \"^18.0.6\",\n    \"@vitejs/plugin-react\": \"^2.0.1\",\n    \"typescript\": \"^4.6.4\",\n    \"vite\": \"^3.0.7\",\n    \"vitest\": \"^0.22.1\",\n    \"canvas\": \"^2.9.3\"\n  }\n}\n</code></pre><!-- [[[read_end]]] --><h2>架构思路与任务拆分</h2><p><video poster=\"https://media001.geekbang.org/87d60975544043deb76e92c27d7da3b9/snapshots/e91a7a11eca64b2ab4c29f801d1c80a1-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/1bbd4f23-18331249ded-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/a44f97221548461eb2a9c7d067819aed/4748fb6fd28245d1bd6d4aaffb8b88c5-79fa07bc12d67209e3959598ecb5a479-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>那么让我们分解任务列表：</p><ul>\n<li>在线段编辑器（Line Editor）上设置锚点（Anchor）\n<ul>\n<li>将线段（Line）数据，生成锚点</li>\n<li>在Line Editor重绘时，按照数据更新锚点位置</li>\n</ul>\n</li>\n<li>在锚点与锚点之间设置控制点\n<ul>\n<li>通过线段数,在两个锚点之间生成控制点（Control）</li>\n<li>在Line Editor重绘时，按照数据更新控制点位置</li>\n</ul>\n</li>\n<li>拖动锚点时，改变线段中的位置</li>\n<li>拖动控制点时，在线段上增加锚点</li>\n<li>双击锚点时，删除锚点</li>\n</ul><p>接下来让我们进入开发：</p><p><video poster=\"https://media001.geekbang.org/e07a85e4a1424db09ec68cc4c0a992c3/snapshots/ceed771346a24bd2a875aeeb82603e3d-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/5a06898a-183341126a7-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/9a8b2e5f4da64a7c887ed40c2e789924/f93bcf7c18a14284a1621d13307c2b2d-98540562ee3b0fc189502afb4ffd5fce-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><h2>思考题</h2><p>对于生成与更新锚点控制点的逻辑，要如何重构？</p><p>欢迎把你的项目代码地址分享在留言区，我们下节课再见！</p>","neighbors":{"left":{"article_title":"用户故事01｜aoe：如果把《重构》这本书拍成电视剧","id":564454},"right":{"article_title":"80｜Line Editor （2）：如何重构生成与更新锚点控制点的逻辑？","id":564811}},"comments":[{"had_liked":false,"id":395519,"user_name":"iHailong","can_delete":false,"product_type":"c1","uid":2289421,"ip_address":"北京","ucode":"58A7CD6DDEF818","user_header":"https://static001.geekbang.org/account/avatar/00/22/ef/0d/da384b06.jpg","comment_is_top":false,"comment_ctime":1731050853,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100109401,"comment_content":"徐昊老师你好，这个基于React UI的项目实战课对我帮助很大，可以继续增加一些web application得项目实战课程吗？想了解更多的关于web app中最佳的TDD模式是怎样的？比如说，如何在有web API调用的情况下去测试，或者说UI layout &amp; style方面的测试，谢谢","like_count":0},{"had_liked":false,"id":357522,"user_name":"davix","can_delete":false,"product_type":"c1","uid":1074465,"ip_address":"北京","ucode":"CBFB39BAD7938B","user_header":"https://static001.geekbang.org/account/avatar/00/10/65/21/101a7075.jpg","comment_is_top":false,"comment_ctime":1663330949,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100109401,"comment_content":"https:&#47;&#47;github.com&#47;davix&#47;geektime-tdd-line-editor\n\n覺得更新锚点的地方可以不更新，而先刪再加 （使用不可變數據）","like_count":0},{"had_liked":false,"id":357227,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"浙江","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1663079352,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100109401,"comment_content":"原来 MVP 是前端中对测试友好的一个框架","like_count":0}]}