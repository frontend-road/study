{"id":9293,"title":"第13讲 | 套接字Socket：Talk is cheap, show me the code","content":"<p>前面讲完了TCP和UDP协议，还没有上手过，这一节咱们讲讲基于TCP和UDP协议的Socket编程。</p><p>在讲TCP和UDP协议的时候，我们分客户端和服务端，在写程序的时候，我们也同样这样分。</p><p>Socket这个名字很有意思，可以作插口或者插槽讲。虽然我们是写软件程序，但是你可以想象为弄一根网线，一头插在客户端，一头插在服务端，然后进行通信。所以在通信之前，双方都要建立一个Socket。</p><p>在建立Socket的时候，应该设置什么参数呢？Socket编程进行的是端到端的通信，往往意识不到中间经过多少局域网，多少路由器，因而能够设置的参数，也只能是端到端协议之上网络层和传输层的。</p><p>在网络层，Socket函数需要指定到底是IPv4还是IPv6，分别对应设置为AF_INET和AF_INET6。另外，还要指定到底是TCP还是UDP。还记得咱们前面讲过的，TCP协议是基于数据流的，所以设置为SOCK_STREAM，而UDP是基于数据报的，因而设置为SOCK_DGRAM。</p><h2>基于TCP协议的Socket程序函数调用过程</h2><p>两端创建了Socket之后，接下来的过程中，TCP和UDP稍有不同，我们先来看TCP。</p><p>TCP的服务端要先监听一个端口，一般是先调用bind函数，给这个Socket赋予一个IP地址和端口。为什么需要端口呢？要知道，你写的是一个应用程序，当一个网络包来的时候，内核要通过TCP头里面的这个端口，来找到你这个应用程序，把包给你。为什么要IP地址呢？有时候，一台机器会有多个网卡，也就会有多个IP地址，你可以选择监听所有的网卡，也可以选择监听一个网卡，这样，只有发给这个网卡的包，才会给你。</p><!-- [[[read_end]]] --><p>当服务端有了IP和端口号，就可以调用listen函数进行监听。在TCP的状态图里面，有一个listen状态，当调用这个函数之后，服务端就进入了这个状态，这个时候客户端就可以发起连接了。</p><p>在内核中，为每个Socket维护两个队列。一个是已经建立了连接的队列，这时候连接三次握手已经完毕，处于established状态；一个是还没有完全建立连接的队列，这个时候三次握手还没完成，处于syn_rcvd的状态。</p><p>接下来，服务端调用accept函数，拿出一个已经完成的连接进行处理。如果还没有完成，就要等着。</p><p>在服务端等待的时候，客户端可以通过connect函数发起连接。先在参数中指明要连接的IP地址和端口号，然后开始发起三次握手。内核会给客户端分配一个临时的端口。一旦握手成功，服务端的accept就会返回另一个Socket。</p><p>这是一个经常考的知识点，就是监听的Socket和真正用来传数据的Socket是两个，一个叫作<strong>监听Socket</strong>，一个叫作<strong>已连接Socket</strong>。</p><p>连接建立成功之后，双方开始通过read和write函数来读写数据，就像往一个文件流里面写东西一样。</p><p>这个图就是基于TCP协议的Socket程序函数调用过程。</p><p><img src=\"https://static001.geekbang.org/resource/image/87/ea/87c8ae36ae1b42653565008fc47aceea.jpg?wh=1626*2172\" alt=\"\"></p><p>说TCP的Socket就是一个文件流，是非常准确的。因为，Socket在Linux中就是以文件的形式存在的。除此之外，还存在文件描述符。写入和读出，也是通过文件描述符。</p><p>在内核中，Socket是一个文件，那对应就有文件描述符。每一个进程都有一个数据结构task_struct，里面指向一个文件描述符数组，来列出这个进程打开的所有文件的文件描述符。文件描述符是一个整数，是这个数组的下标。</p><p>这个数组中的内容是一个指针，指向内核中所有打开的文件的列表。既然是一个文件，就会有一个inode，只不过Socket对应的inode不像真正的文件系统一样，保存在硬盘上的，而是在内存中的。在这个inode中，指向了Socket在内核中的Socket结构。</p><p>在这个结构里面，主要的是两个队列，一个是<strong>发送队列</strong>，一个是<strong>接收队列</strong>。在这两个队列里面保存的是一个缓存sk_buff。这个缓存里面能够看到完整的包的结构。看到这个，是不是能和前面讲过的收发包的场景联系起来了？</p><p>整个数据结构我也画了一张图。<br>\n<img src=\"https://static001.geekbang.org/resource/image/60/13/604f4cb37576990b3f836cb5d7527b13.jpg?wh=3646*2998\" alt=\"\"></p><h2>基于UDP协议的Socket程序函数调用过程</h2><p>对于UDP来讲，过程有些不一样。UDP是没有连接的，所以不需要三次握手，也就不需要调用listen和connect，但是，UDP的交互仍然需要IP和端口号，因而也需要bind。UDP是没有维护连接状态的，因而不需要每对连接建立一组Socket，而是只要有一个Socket，就能够和多个客户端通信。也正是因为没有连接状态，每次通信的时候，都调用sendto和recvfrom，都可以传入IP地址和端口。</p><p>这个图的内容就是基于UDP协议的Socket程序函数调用过程。<br>\n<img src=\"https://static001.geekbang.org/resource/image/6b/31/6bbe12c264f5e76a81523eb8787f3931.jpg?wh=1245*1261\" alt=\"\"></p><h2>服务器如何接更多的项目？</h2><p>会了这几个基本的Socket函数之后，你就可以轻松地写一个网络交互的程序了。就像上面的过程一样，在建立连接后，进行一个while循环。客户端发了收，服务端收了发。</p><p>当然这只是万里长征的第一步，因为如果使用这种方法，基本上只能一对一沟通。如果你是一个服务器，同时只能服务一个客户，肯定是不行的。这就相当于老板成立一个公司，只有自己一个人，自己亲自上来服务客户，只能干完了一家再干下一家，这样赚不来多少钱。</p><p>那作为老板你就要想了，我最多能接多少项目呢？当然是越多越好。</p><p>我们先来算一下理论值，也就是<strong>最大连接数</strong>，系统会用一个四元组来标识一个TCP连接。</p><pre><code>{本机IP, 本机端口, 对端IP, 对端端口}\n</code></pre><p>服务器通常固定在某个本地端口上监听，等待客户端的连接请求。因此，服务端端TCP连接四元组中只有对端IP, 也就是客户端的IP和对端的端口，也即客户端的端口是可变的，因此，最大TCP连接数=客户端IP数×客户端端口数。对IPv4，客户端的IP数最多为2的32次方，客户端的端口数最多为2的16次方，也就是服务端单机最大TCP连接数，约为2的48次方。</p><p>当然，服务端最大并发TCP连接数远不能达到理论上限。首先主要是<strong>文件描述符限制</strong>，按照上面的原理，Socket都是文件，所以首先要通过ulimit配置文件描述符的数目；另一个限制是<strong>内存</strong>，按上面的数据结构，每个TCP连接都要占用一定内存，操作系统是有限的。</p><p>所以，作为老板，在资源有限的情况下，要想接更多的项目，就需要降低每个项目消耗的资源数目。</p><h3>方式一：将项目外包给其他公司（多进程方式）</h3><p>这就相当于你是一个代理，在那里监听来的请求。一旦建立了一个连接，就会有一个已连接Socket，这时候你可以创建一个子进程，然后将基于已连接Socket的交互交给这个新的子进程来做。就像来了一个新的项目，但是项目不一定是你自己做，可以再注册一家子公司，招点人，然后把项目转包给这家子公司做，以后对接就交给这家子公司了，你又可以去接新的项目了。</p><p>这里有一个问题是，如何创建子公司，并如何将项目移交给子公司呢？</p><p>在Linux下，创建子进程使用fork函数。通过名字可以看出，这是在父进程的基础上完全拷贝一个子进程。在Linux内核中，会复制文件描述符的列表，也会复制内存空间，还会复制一条记录当前执行到了哪一行程序的进程。显然，复制的时候在调用fork，复制完毕之后，父进程和子进程都会记录当前刚刚执行完fork。这两个进程刚复制完的时候，几乎一模一样，只是根据fork的返回值来区分到底是父进程，还是子进程。如果返回值是0，则是子进程；如果返回值是其他的整数，就是父进程。</p><p>进程复制过程我画在这里。<br>\n<img src=\"https://static001.geekbang.org/resource/image/18/d0/18070c00ff5d0082yy1fbc32b84e73d0.jpg?wh=4842*3559\" alt=\"\"></p><p>因为复制了文件描述符列表，而文件描述符都是指向整个内核统一的打开文件列表的，因而父进程刚才因为accept创建的已连接Socket也是一个文件描述符，同样也会被子进程获得。</p><p>接下来，子进程就可以通过这个已连接Socket和客户端进行互通了，当通信完毕之后，就可以退出进程，那父进程如何知道子进程干完了项目，要退出呢？还记得fork返回的时候，如果是整数就是父进程吗？这个整数就是子进程的ID，父进程可以通过这个ID查看子进程是否完成项目，是否需要退出。</p><h3>方式二：将项目转包给独立的项目组（多线程方式）</h3><p>上面这种方式你应该也能发现问题，如果每次接一个项目，都申请一个新公司，然后干完了，就注销掉这个公司，实在是太麻烦了。毕竟一个新公司要有新公司的资产，有新的办公家具，每次都买了再卖，不划算。</p><p>于是你应该想到了，我们可以使用<strong>线程</strong>。相比于进程来讲，这样要轻量级的多。如果创建进程相当于成立新公司，购买新办公家具，而创建线程，就相当于在同一个公司成立项目组。一个项目做完了，那这个项目组就可以解散，组成另外的项目组，办公家具可以共用。</p><p>在Linux下，通过pthread_create创建一个线程，也是调用do_fork。不同的是，虽然新的线程在task列表会新创建一项，但是很多资源，例如文件描述符列表、进程空间，还是共享的，只不过多了一个引用而已。</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/64/a36537201678e08ac83e5410562d5f64.jpg?wh=4628*3401\" alt=\"\"></p><p>新的线程也可以通过已连接Socket处理请求，从而达到并发处理的目的。</p><p>上面基于进程或者线程模型的，其实还是有问题的。新到来一个TCP连接，就需要分配一个进程或者线程。一台机器无法创建很多进程或者线程。有个<strong>C10K</strong>，它的意思是一台机器要维护1万个连接，就要创建1万个进程或者线程，那么操作系统是无法承受的。如果维持1亿用户在线需要10万台服务器，成本也太高了。</p><p>其实C10K问题就是，你接项目接的太多了，如果每个项目都成立单独的项目组，就要招聘10万人，你肯定养不起，那怎么办呢？</p><h3>方式三：一个项目组支撑多个项目（IO多路复用，一个线程维护多个Socket）</h3><p>当然，一个项目组可以看多个项目了。这个时候，每个项目组都应该有个项目进度墙，将自己组看的项目列在那里，然后每天通过项目墙看每个项目的进度，一旦某个项目有了进展，就派人去盯一下。</p><p>由于Socket是文件描述符，因而某个线程盯的所有的Socket，都放在一个文件描述符集合fd_set中，这就是<strong>项目进度墙</strong>，然后调用select函数来监听文件描述符集合是否有变化。一旦有变化，就会依次查看每个文件描述符。那些发生变化的文件描述符在fd_set对应的位都设为1，表示Socket可读或者可写，从而可以进行读写操作，然后再调用select，接着盯着下一轮的变化。</p><h3>方式四：一个项目组支撑多个项目（IO多路复用，从“派人盯着”到“有事通知”）</h3><p>上面select函数还是有问题的，因为每次Socket所在的文件描述符集合中有Socket发生变化的时候，都需要通过轮询的方式，也就是需要将全部项目都过一遍的方式来查看进度，这大大影响了一个项目组能够支撑的最大的项目数量。因而使用select，能够同时盯的项目数量由FD_SETSIZE限制。</p><p>如果改成事件通知的方式，情况就会好很多，项目组不需要通过轮询挨个盯着这些项目，而是当项目进度发生变化的时候，主动通知项目组，然后项目组再根据项目进展情况做相应的操作。</p><p>能完成这件事情的函数叫epoll，它在内核中的实现不是通过轮询的方式，而是通过注册callback函数的方式，当某个文件描述符发送变化的时候，就会主动通知。<br>\n<img src=\"https://static001.geekbang.org/resource/image/d6/b1/d6efc5c5ee8e48dae0323de380dcf6b1.jpg?wh=4410*2335\" alt=\"\"></p><p>如图所示，假设进程打开了Socket m, n, x等多个文件描述符，现在需要通过epoll来监听是否这些Socket都有事件发生。其中epoll_create创建一个epoll对象，也是一个文件，也对应一个文件描述符，同样也对应着打开文件列表中的一项。在这项里面有一个红黑树，在红黑树里，要保存这个epoll要监听的所有Socket。</p><p>当epoll_ctl添加一个Socket的时候，其实是加入这个红黑树，同时红黑树里面的节点指向一个结构，将这个结构挂在被监听的Socket的事件列表中。当一个Socket来了一个事件的时候，可以从这个列表中得到epoll对象，并调用call  back通知它。</p><p>这种通知方式使得监听的Socket数据增加的时候，效率不会大幅度降低，能够同时监听的Socket的数目也非常的多了。上限就为系统定义的、进程打开的最大文件描述符个数。因而，<strong>epoll被称为解决C10K问题的利器</strong>。</p><h2>小结</h2><p>好了，这一节就到这里了，我们来总结一下：</p><ul>\n<li>\n<p>你需要记住TCP和UDP的Socket的编程中，客户端和服务端都需要调用哪些函数；</p>\n</li>\n<li>\n<p>写一个能够支撑大量连接的高并发的服务端不容易，需要多进程、多线程，而epoll机制能解决C10K问题。</p>\n</li>\n</ul><p>最后，给你留两个思考题：</p><ol>\n<li>\n<p>epoll是Linux上的函数，那你知道Windows上对应的机制是什么吗？如果想实现一个跨平台的程序，你知道应该怎么办吗？</p>\n</li>\n<li>\n<p>自己写Socket还是挺复杂的，写个HTTP的应用可能简单一些。那你知道HTTP的工作机制吗？</p>\n</li>\n</ol><p>欢迎你留言和我讨论。趣谈网络协议，我们下期见！</p>","neighbors":{"left":{"article_title":"第12讲 | TCP协议（下）：西行必定多妖孽，恒心智慧消磨难","id":9141},"right":{"article_title":"第14讲 | HTTP协议：看个新闻原来这么麻烦","id":9410}},"comments":[{"had_liked":false,"id":13315,"user_name":"time_qiao","can_delete":false,"product_type":"c1","uid":1130909,"ip_address":"","ucode":"66A17817357FC9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erQaN1AkcKQJRTWRop4fLpf2Z2nt1SUk9quVmw3YzIuNGAwnjGoPjQ3kC3XOAPSpFaeG1haeYfhBg/132","comment_is_top":false,"comment_ctime":1529540185,"is_pvip":false,"discussion_count":15,"race_medal":0,"score":"1131105939033","product_id":100007101,"comment_content":"刘老师看完这节，觉得您的linux功底实在太深厚了，这个系列做完能不能做个linux系列的","like_count":264,"discussions":[{"author":{"id":2382635,"avatar":"https://static001.geekbang.org/account/avatar/00/24/5b/2b/8a95e293.jpg","nickname":"朋克李PunkLi","note":"","ucode":"D46CFB329C99C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350052,"discussion_content":"预言家刀了","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1613693505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1486173,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ad/5d/abc6ba62.jpg","nickname":"最后的、魔法师","note":"","ucode":"A8E71CD285EAD7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297198,"discussion_content":"23333，笑哭我了，真的做了！！！！","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1596805428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526645,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4b/75/64ddeffe.jpg","nickname":"minions","note":"","ucode":"314A54B9396516","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212871,"discussion_content":"趣谈Linux系统","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1585026574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260141,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3a/6d/910b2445.jpg","nickname":"Wheat","note":"","ucode":"7D99EA149B6DE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346341,"discussion_content":"真的应验了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1611915310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"马以","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":227273,"discussion_content":"来刷二轮，你这个评论已经应验了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586481672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066189,"avatar":"https://static001.geekbang.org/account/avatar/00/10/44/cd/b8673fc2.jpg","nickname":"薛定谔猫🐈","note":"","ucode":"A3210DAC2CD7BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543545,"discussion_content":"🍎","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641199938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264707,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/43/150c70c2.jpg","nickname":"陈松Plus","note":"","ucode":"0074BDECFA3D1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350368,"discussion_content":"预言家","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613827098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1566210,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e6/02/64fd7497.jpg","nickname":"缪存发","note":"","ucode":"20688C432A7AA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258170,"discussion_content":"安排上了hhhh","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588658651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112747,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/ab/0d39e745.jpg","nickname":"李小四","note":"","ucode":"2A766BE16B276B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4169,"discussion_content":"满足你","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565182044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1081379,"avatar":"https://static001.geekbang.org/account/avatar/00/10/80/23/33555b32.jpg","nickname":"天涯海角","note":"","ucode":"B35E85576982ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574577,"discussion_content":"刘老师这么宠粉么 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654156937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261108,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3e/34/dd0a3c61.jpg","nickname":"爱吃彩虹糖的猫~","note":"","ucode":"9EC7A8FD4B7DB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391759,"discussion_content":"真厉害，预言家实锤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630628422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014873,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7c/59/dc9bbb21.jpg","nickname":"Join","note":"","ucode":"20F51EFFD8FEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391271,"discussion_content":"厉害了预言家","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630382281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2640817,"avatar":"","nickname":"罗俊聪","note":"","ucode":"1B0E51A8AC8A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382637,"discussion_content":"前来考古","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625651168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616022,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/d6/a6f98c5d.jpg","nickname":"Wayne","note":"","ucode":"4FA52F2E03BF02","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382271,"discussion_content":"厉害了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625493787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1040071,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/de/c7/26485903.jpg","nickname":"Yolo七夜","note":"","ucode":"7CB74C0A1DF785","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311289,"discussion_content":"没问题，哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602298630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12783,"user_name":"Jealone","can_delete":false,"product_type":"c1","uid":1025643,"ip_address":"","ucode":"08810356E0E3D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/6b/12d87713.jpg","comment_is_top":false,"comment_ctime":1529027979,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"465385495947","product_id":100007101,"comment_content":"Epoll和IOCP还是有本质区别的，IOCP是封装了IO操作的，而epoll只是一个事件通知机制，意味着IOCP的IO操作也可以由内核完成，因此IOCP算异步IO，而基于epoll的仍然是同步IO，于IOCP相对应的不是epoll而是AIO","like_count":108},{"had_liked":false,"id":13979,"user_name":"白杨","can_delete":false,"product_type":"c1","uid":1124722,"ip_address":"","ucode":"85E0DA11EBF593","user_header":"https://static001.geekbang.org/account/avatar/00/11/29/72/76838c57.jpg","comment_is_top":false,"comment_ctime":1530098094,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"379487220142","product_id":100007101,"comment_content":"我个人觉得还可以讲的更本质一些。<br>不论是同步还是异步，阻塞还是非阻塞，都是用某种方法创建了某种结构，而不同的是，是谁在执行内部的方法，是谁写了标志，是谁触发了事件，是谁在操作io，是谁在等待，是谁在返回。<br>换句话说就是，本来我在做的事情，让你来做吧，本来你在做的事情，让我来做吧。","like_count":89},{"had_liked":false,"id":12752,"user_name":"张亚","can_delete":false,"product_type":"c1","uid":1001318,"ip_address":"","ucode":"431C0D1B23B0F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/66/0218c380.jpg","comment_is_top":false,"comment_ctime":1529020894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"216277385694","product_id":100007101,"comment_content":"第一个问题，windows 上是 iocp，如果想跨平台，要么使用兼容性较好的 select，要么对不同的平台使用不同的调用，kqueue iocp等。<br>第二个问题，HTTP 是构建在 tcp 协议之上的，用 telnet 可以轻松构造一个 HTTP 请求","like_count":50},{"had_liked":false,"id":58133,"user_name":"明子","can_delete":false,"product_type":"c1","uid":1016079,"ip_address":"","ucode":"FEA1B75C99CD02","user_header":"https://static001.geekbang.org/account/avatar/00/0f/81/0f/fce9d8ea.jpg","comment_is_top":false,"comment_ctime":1547001092,"is_pvip":false,"replies":[{"id":"25777","content":"只讲了模式，细节足够一本书了","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551422210,"ip_address":"","comment_id":58133,"utype":1}],"discussion_count":5,"race_medal":0,"score":"156165823748","product_id":100007101,"comment_content":"这章看的很吃力，可能限于篇幅原因，很多细节都没讲清楚。比如，说需要两个socket（监听socket和已连接socket），但没有说为什么需要两个socket，我去查了《Unix 网络编程》才了解原因；而且需要说明的是，只有服务端需要两个socket。","like_count":37,"discussions":[{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563510,"discussion_content":"老师同学好\n个人意见：\n有些可以增加几句话，还是可以解决多数人的疑惑的，比如这里，可以看到这个地方有不少人是有疑惑的，多讲一点，我想算不上过分a。\n细节能讲一本书，话说也谁没让讲那么细呀～","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650012800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435923,"discussion_content":"只讲了模式，细节足够一本书了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1551422210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228594,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bf/32/25553aa8.jpg","nickname":"纳兰提","note":"","ucode":"95695A2E9450B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":66838,"discussion_content":"师傅引进门，修行看个人，老师棒棒的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575110255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2341231,"avatar":"https://static001.geekbang.org/account/avatar/00/23/b9/6f/b40d1acf.jpg","nickname":"mkcaptain","note":"","ucode":"0BF1BAE12B0C11","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367686,"discussion_content":"这点儿我也没懂，2个socket，是说是2个不同的端口号吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618440495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195736,"discussion_content":"是啊，这节很吃力，太多东西需要进补了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583302855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96448,"user_name":"起风了001","can_delete":false,"product_type":"c1","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1558426382,"is_pvip":false,"replies":[{"id":"49284","content":"golang好东西","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567609607,"ip_address":"","comment_id":96448,"utype":1}],"discussion_count":6,"race_medal":0,"score":"87457772302","product_id":100007101,"comment_content":"之前有专门学过epoll, 然后就特地看了一下socket和tcp连接的关系, 所以这一章看得比较清晰明白.哈哈, 技术真的是多学就能融会贯通的, 不过本章老师说的主要是linux C编程上的, 现在我用的golang写的话, 很多细节都被隐藏了, 不需要使用epoll, 直接Listen(), 然后Accept() , 有新的连接过来的话就会返回一个Conn, 然后使用golang的goroutine就可以开启一个协程处理这个连接, 一个程序可以开100万个都没压力, 所以也就没有epoll这样的概念了.","like_count":20,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450884,"discussion_content":"golang好东西","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567609607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1050412,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/2c/180075e0.jpg","nickname":"小豪","note":"","ucode":"70C75B9E5BD19E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577218,"discussion_content":"goroutine是用户态的线程调度吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655973823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228136,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bd/68/3fd6428d.jpg","nickname":"Cutler","note":"","ucode":"2EDECFE039845B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381116,"discussion_content":"golang底层其实也是通过epoll+groutine实现如此多的并发的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624895684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1925058,"avatar":"","nickname":"戚立龙","note":"","ucode":"44C9F576EDDA65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338638,"discussion_content":"那golang这种还叫异步IO吗，还是有特殊名字","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609328190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1447741,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","nickname":"zhoufeng","note":"","ucode":"6F92F7866F9EB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925058,"avatar":"","nickname":"戚立龙","note":"","ucode":"44C9F576EDDA65","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577395,"discussion_content":"golang的goroutine是同步阻塞I/O，这种I/O对开发人员最友好，但是底层也是运行在异步阻塞I/O上的（如epoll），golang自己实现了poller，实现只阻塞goroutine不阻塞运行goroutine的内核线程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656066942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338638,"ip_address":""},"score":577395,"extra":""}]},{"author":{"id":1067979,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4b/cb/f5f29d74.jpg","nickname":"f","note":"","ucode":"667723A084DFA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324712,"discussion_content":"上10万后，调度还是会有些吃力。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605157013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16766,"user_name":"自然而然","can_delete":false,"product_type":"c1","uid":1042509,"ip_address":"","ucode":"9081166809F970","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/4d/e7728500.jpg","comment_is_top":false,"comment_ctime":1532167915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70251644651","product_id":100007101,"comment_content":"这篇写的很棒，很见功底","like_count":16},{"had_liked":false,"id":62791,"user_name":"caohuan","can_delete":false,"product_type":"c1","uid":1256428,"ip_address":"","ucode":"4B092E33F3DF1E","user_header":"https://static001.geekbang.org/account/avatar/00/13/2b/ec/af6d0b10.jpg","comment_is_top":false,"comment_ctime":1548158040,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"65972667480","product_id":100007101,"comment_content":"听二遍 才懂了一点，通讯里面 确实 内容丰富、技巧很多、设计巧妙。<br><br>本篇所得：1.一台机器有多个网卡，可以选择一个或多个网卡，发送和接受包资源;<br>TCP连接数量=客户端的IP数*客户端的端口数，客户端的最大ip为2**32，客户端的端口数最大为 2**16<br>，所以TCP连接总数最大为2**48;<br><br>2.Socket可以包括 监听Socket和已连接Socket;<br><br>3.TCP的Socket连接 核心为：客户端的connect--服务端的accept---客户端的write---服务端的read---服务端的write----客户端的read;<br>UDP的Socket连接 内容主要为：客户端send to---服务端recvform---服务端sendto--客户端的recvfrom。<br><br>4.一个服务器可以连接有很多客户端进行通讯：（1）多进程，一个进程一个通讯项目;（2）多线程，一个进程对应对个项目，一个线程负责一个通讯项目;（3）多线程，一个线程负责多个通讯项目，使用轮询监听和描述 通讯的记录;（4）多线程，一个线程负责多个通讯项目，使用 注册 主动通知的方法，使用epoll解决C10k问题。<br><br>回答老师的问题：问题1  linux有epoll，window有类似IOCP，跨平台就不清楚;问题二  http使用tcp协议，使用talnet规则构建。","like_count":15},{"had_liked":false,"id":13372,"user_name":"灵魂胖子","can_delete":false,"product_type":"c1","uid":1112417,"ip_address":"","ucode":"8530F5BA256C64","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/61/0f2e4328.jpg","comment_is_top":false,"comment_ctime":1529563323,"is_pvip":false,"replies":[{"id":"4495","content":"可以","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1529576431,"ip_address":"","comment_id":13372,"utype":1}],"discussion_count":2,"race_medal":0,"score":"65954072763","product_id":100007101,"comment_content":"老师，那个UDP 协议的 Socket 程序函数调用过程中的客户端可以不用调用bind（）吧?","like_count":15,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419631,"discussion_content":"可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529576431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2171912,"avatar":"","nickname":"Geek_66e425","note":"","ucode":"0D07573C2E8246","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333738,"discussion_content":"可以，内核会自动分配一个ip和端口的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607607061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12838,"user_name":"大光头","can_delete":false,"product_type":"c1","uid":1041792,"ip_address":"","ucode":"8EF797AFD1E27C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo3DrWeV7ZwRLXrRZg4V3ic1LQYdZ3u1oicDhqPic47vMguvf5QS69roTiaJrwDr5Re3Sy2UyHDWwmsTA/132","comment_is_top":false,"comment_ctime":1529063541,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48773703797","product_id":100007101,"comment_content":"windows上有一个叫iocp，但是它还是有点不一样，它是proactor，而epoll是reactor。我觉得iocp效率会更高，epoll通知应用去读取数据，处理完之后还要返回内核发送数据，而完成端口直接在内核态进行处理数据，最后告诉应用，数据已经处理完了。","like_count":11},{"had_liked":false,"id":112333,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1562721530,"is_pvip":false,"replies":[{"id":"46722","content":"端口是一个端口。这两个socket都属于同一个进程的。内核可以区分用哪个socket接收。代码里面区分就是。就像如果你自己写代码，你就可以让socket i接收而不是socket j。","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566386548,"ip_address":"","comment_id":112333,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44512394490","product_id":100007101,"comment_content":"你好，服务端监听socket和连接socket并不是同一个socket,那是同一个端口么，如果是的话，怎么区分收到的数据是哪个socket的","like_count":10,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457680,"discussion_content":"端口是一个端口。这两个socket都属于同一个进程的。内核可以区分用哪个socket接收。代码里面区分就是。就像如果你自己写代码，你就可以让socket i接收而不是socket j。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566386548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134511,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4f/af/50c3e8dd.jpg","nickname":"登品","note":"","ucode":"DA94DA7A7CFE3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377763,"discussion_content":"是不是根据那个文件描述符区分的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622816984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66891,"user_name":"Observer","can_delete":false,"product_type":"c1","uid":1008222,"ip_address":"","ucode":"677626A9B8E55E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/5e/ef349e39.jpg","comment_is_top":false,"comment_ctime":1550038022,"is_pvip":false,"replies":[{"id":"25971","content":"对的，这是好书","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551439358,"ip_address":"","comment_id":66891,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44499710982","product_id":100007101,"comment_content":"还的继续啃 Unix 网络编程","like_count":10,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438961,"discussion_content":"对的，这是好书","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551439358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12801,"user_name":"Sam_Deep_Thinking","can_delete":false,"product_type":"c1","uid":1001152,"ip_address":"","ucode":"8E4EF6F24B821B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/c0/bf880bda.jpg","comment_is_top":false,"comment_ctime":1529042840,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"44478715800","product_id":100007101,"comment_content":"真心写的好。多谢作者。","like_count":10},{"had_liked":false,"id":73206,"user_name":"传说中的成大大","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1551840533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40206546197","product_id":100007101,"comment_content":"这篇文章，最突出的一点就是竟然把linux的epoll讲解的这么简单明了，windows下是用iocp完成端口！","like_count":9},{"had_liked":false,"id":122493,"user_name":"小可爱","can_delete":false,"product_type":"c1","uid":1470958,"ip_address":"","ucode":"5379D1F00E8796","user_header":"https://static001.geekbang.org/account/avatar/00/16/71/ee/31b19304.jpg","comment_is_top":false,"comment_ctime":1565407763,"is_pvip":false,"replies":[{"id":"46321","content":"端口","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566288386,"ip_address":"","comment_id":122493,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35925146131","product_id":100007101,"comment_content":"我有个问题就是，数据来了之后服务端怎么知道这个数据是属于哪个socket呢？","like_count":8,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462275,"discussion_content":"端口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566288386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1996252,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/75/dc/564f9143.jpg","nickname":"liyongjun","note":"","ucode":"8F34623ED02FFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373042,"discussion_content":"报文里面有端口号，socket 结构体里面也有端口号，两者进行匹配即可。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620575651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1050412,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/2c/180075e0.jpg","nickname":"小豪","note":"","ucode":"70C75B9E5BD19E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577219,"discussion_content":"如果是多张网卡的话，还得加上IP用于定位socket\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655973840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12781,"user_name":"fumeck.com🍋🌴summer sky","can_delete":false,"product_type":"c1","uid":1134567,"ip_address":"","ucode":"6349BF32257990","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/e7/7e51052a.jpg","comment_is_top":false,"comment_ctime":1529027903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35888766271","product_id":100007101,"comment_content":"每天上班路上阅读，很充实，对于菜鸟的我收益颇多","like_count":8},{"had_liked":false,"id":13109,"user_name":"灰灰","can_delete":false,"product_type":"c1","uid":1122397,"ip_address":"","ucode":"907A2FD339E158","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/5d/69170b96.jpg","comment_is_top":false,"comment_ctime":1529378604,"is_pvip":false,"replies":[{"id":"4365","content":"很多地方啊，可能都是框架做好了，但是看框架的源代码，还是能看到的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1529395044,"ip_address":"","comment_id":13109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31594149676","product_id":100007101,"comment_content":"老师，对socket这块一直理解比较抽象，什么情况下需要socket编程，我印象中从来没写过。盼复","like_count":7,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419540,"discussion_content":"很多地方啊，可能都是框架做好了，但是看框架的源代码，还是能看到的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529395044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12897,"user_name":"星文友","can_delete":false,"product_type":"c1","uid":1068162,"ip_address":"","ucode":"EE438B9C1C7B61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9RytLsauRVYGjupDIaibibAK5iaicEicONrMFc0O3icAGf5mD1buxoQ2ePPn9YurFhRbuf3AR1qJDy0GQ/132","comment_is_top":false,"comment_ctime":1529117860,"is_pvip":false,"replies":[{"id":"4295","content":"大，文件描述符更大，fdset小的多","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1529151114,"ip_address":"","comment_id":12897,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31593888932","product_id":100007101,"comment_content":"select由文件描述fd_set限制<br>epoll 由文件描述符数量限制 <br>两个差异很大吗","like_count":7,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419449,"discussion_content":"大，文件描述符更大，fdset小的多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529151114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70696,"user_name":"咖啡猫口里的咖啡猫🐱","can_delete":false,"product_type":"c1","uid":1036565,"ip_address":"","ucode":"FE2441B3A40375","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d1/15/7d47de48.jpg","comment_is_top":false,"comment_ctime":1551166091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23026002571","product_id":100007101,"comment_content":"看完tcp&#47;ip三卷 结合linux操作，再看一遍文章，刚觉老师 linux内核功力深厚。感觉书第二卷实现跟现在内核版本有些😂区别","like_count":5},{"had_liked":false,"id":36497,"user_name":"扬～","can_delete":false,"product_type":"c1","uid":1208163,"ip_address":"","ucode":"6FA7D8FE188341","user_header":"https://static001.geekbang.org/account/avatar/00/12/6f/63/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1541130204,"is_pvip":false,"replies":[{"id":"12980","content":"udp没有状态，所以不存在监听这个状态，内存里没有保存连接的任何信息，不占用资源，所以不存在连接数过多的压力，顶多是把网卡打满","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1541138373,"ip_address":"","comment_id":36497,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23015966684","product_id":100007101,"comment_content":"UDP的socket的调用过程中，为什么没有listen呢，要不应用程序怎么监听此端口？要不怎么把UDP的包发往监听此端口的应用程序呢？基于UDP的方式会不会因为连接数过多，造成服务器处理压力增大从而延迟增高呢？因为他们共用一个端口，而不是像TCP那样会复制一个套接字随机分配一个端口用于数据接受和发送。我不知道我说的对不对，希望老师能够解答一下困惑。","like_count":5,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427891,"discussion_content":"udp没有状态，所以不存在监听这个状态，内存里没有保存连接的任何信息，不占用资源，所以不存在连接数过多的压力，顶多是把网卡打满","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541138373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1385204,"avatar":"https://static001.geekbang.org/account/avatar/00/15/22/f4/9fd6f8f0.jpg","nickname":"核桃","note":"","ucode":"7AB05270CBCCCB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340279,"discussion_content":"这里不监听不代表不需要端口，udp是一对多的，只要一个socket就可以和多个客户端通信，tcp是为了严谨需要accept函数调用返回一个临时的socket给每个连接的客户端.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609942288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19596,"user_name":"徐曹植","can_delete":false,"product_type":"c1","uid":1046757,"ip_address":"","ucode":"1BEF0CFBC189DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/e5/40c4ef73.jpg","comment_is_top":false,"comment_ctime":1533900102,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23008736582","product_id":100007101,"comment_content":"请问epoll监听机制是如何实现的呢？底层本质也是轮询吗？","like_count":5,"discussions":[{"author":{"id":1655117,"avatar":"https://static001.geekbang.org/account/avatar/00/19/41/4d/f6d6d13a.jpg","nickname":"啊良梓是我","note":"","ucode":"E42FC1A60D331C","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359560,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616228291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16699,"user_name":"汪木木","can_delete":false,"product_type":"c1","uid":1095399,"ip_address":"","ucode":"A2B1EFCBBB7387","user_header":"https://static001.geekbang.org/account/avatar/00/10/b6/e7/6d49e73f.jpg","comment_is_top":false,"comment_ctime":1532101937,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23006938417","product_id":100007101,"comment_content":"这就是几种网络io的由来，bio，nio1，nio2。","like_count":5},{"had_liked":false,"id":13691,"user_name":"Hugo","can_delete":false,"product_type":"c1","uid":1136811,"ip_address":"","ucode":"40537BD2F66718","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/ab/86a51f0c.jpg","comment_is_top":false,"comment_ctime":1529931167,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23004767647","product_id":100007101,"comment_content":"老师监听的socket和已连接的socket 是每次连接两个都会创建 。      <br>还是监听的socket只创建一次   <br>每次都创建已连接的socket？","like_count":5,"discussions":[{"author":{"id":1440772,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/04/d83a555e.jpg","nickname":"Kevin⚡️Zhou","note":"","ucode":"C0FC2673705212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296335,"discussion_content":"监听的只创建一次, 存在于服务器socker的生命周期内, 已连接的socket每次客户端发起connect请求都会创建一个新的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596512745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103696,"user_name":"Geek_04e22a","can_delete":false,"product_type":"c1","uid":1184505,"ip_address":"","ucode":"B64FF12EA28BA6","user_header":"https://static001.geekbang.org/account/avatar/00/12/12/f9/7e6e3ac6.jpg","comment_is_top":false,"comment_ctime":1560493258,"is_pvip":false,"replies":[{"id":"49045","content":"是的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567584254,"ip_address":"","comment_id":103696,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18740362442","product_id":100007101,"comment_content":"学习nginx和Apache区别有一点是Apache使用select，nginx使用epoll，所以nginx性能比Apache好一些，一直认为select比较low，学了之后才发现在socket发展过程中，select机制也是一种优秀的机制。","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453969,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567584254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71803,"user_name":"zhj","can_delete":false,"product_type":"c1","uid":1311772,"ip_address":"","ucode":"65B9E222D6E075","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/1c/b0c6c009.jpg","comment_is_top":false,"comment_ctime":1551438144,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18731307328","product_id":100007101,"comment_content":"能有一些实战中常用命令方便理解就好了，比如linux下怎么看半连接全连接情况，怎么看具体某个socket的收发队列积压情况，这样结合理论和实操就更容易理解了","like_count":4},{"had_liked":false,"id":58660,"user_name":"臭猫","can_delete":false,"product_type":"c1","uid":1313181,"ip_address":"","ucode":"5C3D1ED80055B7","user_header":"https://static001.geekbang.org/account/avatar/00/14/09/9d/8af6cb1e.jpg","comment_is_top":false,"comment_ctime":1547168634,"is_pvip":false,"replies":[{"id":"25784","content":"一个","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551422875,"ip_address":"","comment_id":58660,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18727037818","product_id":100007101,"comment_content":"Udp编程中，服务端只用一个socket收发所有客户端信息好，还是为每个客户端都分配一个socket好呢？","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436154,"discussion_content":"一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551422875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12789,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1529032354,"is_pvip":false,"replies":[{"id":"4265","content":"没有，内核代码就是这样的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1529062698,"ip_address":"","comment_id":12789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18708901538","product_id":100007101,"comment_content":"老师，sk_buffer里面的数据应该是剔除掉链路层和网络层头部信息的吧?","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419410,"discussion_content":"没有，内核代码就是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529062698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246839,"user_name":"昵称C","can_delete":false,"product_type":"c1","uid":1234963,"ip_address":"","ucode":"1BB2D537942DC2","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/13/082013bc.jpg","comment_is_top":false,"comment_ctime":1599489610,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14484391498","product_id":100007101,"comment_content":"为什么说TCP是传输的是数据流而UDP传输的是数据包呢？<br>我理解，从协议上来说，TCP和UDP都是层层封装的数据包，从网络传输过程来说，他们又都是以数据流的方式在传输。请老师解惑~~~","like_count":3,"discussions":[{"author":{"id":1996252,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/75/dc/564f9143.jpg","nickname":"liyongjun","note":"","ucode":"8F34623ED02FFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373047,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620576865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99227,"user_name":"13738095165","can_delete":false,"product_type":"c1","uid":1258787,"ip_address":"","ucode":"BA328115A609A1","user_header":"","comment_is_top":false,"comment_ctime":1559179460,"is_pvip":false,"replies":[{"id":"49238","content":"红黑树是为了搜索socket块的，通知不会变动的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567605313,"ip_address":"","comment_id":99227,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14444081348","product_id":100007101,"comment_content":"老师，socket事件变化后，通知epool-entry后，调用callback，引起了红黑树节点什么变动？","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452028,"discussion_content":"红黑树是为了搜索socket块的，通知不会变动的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567605313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1300870,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d9/86/43663593.jpg","nickname":"二盼","note":"","ucode":"74CAB3A0BD5D35","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356378,"discussion_content":"二叉平衡搜索时演进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615564889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83810,"user_name":"dfx","can_delete":false,"product_type":"c1","uid":1158614,"ip_address":"","ucode":"A04D121FA8531B","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/d6/7e4e558c.jpg","comment_is_top":false,"comment_ctime":1554718887,"is_pvip":false,"replies":[{"id":"49854","content":"数组的内容是指针","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567764259,"ip_address":"","comment_id":83810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14439620775","product_id":100007101,"comment_content":"&quot;这个数组中的内容是一个指针，指向内核中所有打开的文件的列表.&quot; 这段没看懂 数组的内容怎么可能是一个指针的？ 是不是数组的内容是指针，每个指针指向一个打开的文件","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446152,"discussion_content":"数组的内容是指针","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567764259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63862,"user_name":"想当上帝的司机","can_delete":false,"product_type":"c1","uid":1239378,"ip_address":"","ucode":"D8251388854911","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/52/f07e9001.jpg","comment_is_top":false,"comment_ctime":1548563785,"is_pvip":false,"replies":[{"id":"25818","content":"是的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551424077,"ip_address":"","comment_id":63862,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433465673","product_id":100007101,"comment_content":"Epoll里的红黑树是为了快速查找监听的socket吗  我看下面有一个监听链表了","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437737,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551424077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15644,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1531358466,"is_pvip":true,"replies":[{"id":"5335","content":"应用层发起的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1531361953,"ip_address":"","comment_id":15644,"utype":1}],"discussion_count":1,"race_medal":1,"score":"14416260354","product_id":100007101,"comment_content":"老师我有个问题，socket通信需要确定是基于UDP还是TCP，而且还得知道IP，那么socket是在网络模型中，那一层发起的呢？","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420493,"discussion_content":"应用层发起的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531361953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12993,"user_name":"天","can_delete":false,"product_type":"c1","uid":1066132,"ip_address":"","ucode":"72662E02A5D1E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/94/835a2427.jpg","comment_is_top":false,"comment_ctime":1529251067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14414152955","product_id":100007101,"comment_content":"喜欢这种基于内核的分析，老师可以开一门socket内核分析的课程，从三次握手到网络通信，整个内核的流程分析，之前看过秦健老师的tcp内核追踪，但是年代比较久远，是基于2.6内核写的","like_count":3},{"had_liked":false,"id":264983,"user_name":"？","can_delete":false,"product_type":"c1","uid":2030035,"ip_address":"","ucode":"3043E00A056081","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f9/d3/2cb7516e.jpg","comment_is_top":false,"comment_ctime":1606727540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10196662132","product_id":100007101,"comment_content":"自己有一点点基础，看了这个后把我多年的困扰搞清楚了，socket=protocol+本地ip+本地端口+远程ip+远程端口，虽然本地端口+ip是固定的，但是远程的ip端口却不是固定的，所以数量会非常多，而我们用select去处理请求的时候，由于内核限制一个进程最大只能打开1024个fd，所以现在我们用到的都是epoll，相当于当我们内核的fd就绪时会调用回调，这时候我们用户端就能够从这个socket中读取已经就绪的数据了。所以理论上用epoll时socket的连接数量取决于我们的内存，就经常听到百万级长连接，其实目前我们大多是家用电脑都能够处理百万级tcp请求，只要你的应用逻辑不是特别复杂即可","like_count":2},{"had_liked":false,"id":259516,"user_name":"IT生涯路漫漫","can_delete":false,"product_type":"c1","uid":1014146,"ip_address":"","ucode":"4954D1CBEB4E44","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/82/c3cccc38.jpg","comment_is_top":false,"comment_ctime":1604739197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5899706493","product_id":100007101,"comment_content":"引用：每一个进程都有一个数据结构 task_struct，里面指向一个文件描述符数组，来列出这个进程打开的所有文件的文件描述符。文件描述符是一个整数，是这个数组的下标。最后一句话好像不对吧","like_count":1},{"had_liked":false,"id":241002,"user_name":"Nemo","can_delete":false,"product_type":"c1","uid":1657039,"ip_address":"","ucode":"2B11D18D6FA2AE","user_header":"https://static001.geekbang.org/account/avatar/00/19/48/cf/8c88e6c0.jpg","comment_is_top":false,"comment_ctime":1597146828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5892114124","product_id":100007101,"comment_content":"刘老师对做生意也很有研究","like_count":1},{"had_liked":false,"id":121691,"user_name":"李小四","can_delete":false,"product_type":"c1","uid":1112747,"ip_address":"","ucode":"2A766BE16B276B","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/ab/0d39e745.jpg","comment_is_top":false,"comment_ctime":1565184056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5860151352","product_id":100007101,"comment_content":"网络_13<br>HTTP，超文本传输协议，属于应用层，依赖于传输层(TCP就是传输层的一种协议)<br><br>由于使用简单，方便快捷，HTTP的应用非常广泛，比如浏览器网站，App等，常见的Web API服务。","like_count":1},{"had_liked":false,"id":97046,"user_name":"泰霖","can_delete":false,"product_type":"c1","uid":1169542,"ip_address":"","ucode":"756A02931B38ED","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/86/34af6df9.jpg","comment_is_top":false,"comment_ctime":1558576011,"is_pvip":false,"replies":[{"id":"49258","content":"是的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567608217,"ip_address":"","comment_id":97046,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853543307","product_id":100007101,"comment_content":"刘老师你好，请教你一个问题，socket编程可以是IO，也可以是NIO的么？","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451110,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567608217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96469,"user_name":"灯盖","can_delete":false,"product_type":"c1","uid":1482839,"ip_address":"","ucode":"0F8455A593D60C","user_header":"https://static001.geekbang.org/account/avatar/00/16/a0/57/3a729755.jpg","comment_is_top":false,"comment_ctime":1558430767,"is_pvip":false,"replies":[{"id":"49283","content":"加油","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567609573,"ip_address":"","comment_id":96469,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5853398063","product_id":100007101,"comment_content":"感谢感谢，基础知识扎实是技术提升能力提升的基石，跟着老师努力学习💪","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450891,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567609573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69660,"user_name":"Dream","can_delete":false,"product_type":"c1","uid":1071397,"ip_address":"","ucode":"D57D0E0B36D3B5","user_header":"https://static001.geekbang.org/account/avatar/00/10/59/25/0efc8b38.jpg","comment_is_top":false,"comment_ctime":1550803806,"is_pvip":false,"replies":[{"id":"50292","content":"可以看一些socket编程的书，仅仅socket编程就可以写一正本书啦。UNIX网络编程","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567839764,"ip_address":"","comment_id":69660,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845771102","product_id":100007101,"comment_content":"socket建立还没搞懂，如何建立socket能不能举个例子，纯理论的灌输确实太累了，能不能距离贴近实际编程而不是直接距离贴近生活","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440213,"discussion_content":"可以看一些socket编程的书，仅仅socket编程就可以写一正本书啦。UNIX网络编程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567839764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57423,"user_name":"东方奇骥","can_delete":false,"product_type":"c1","uid":1354850,"ip_address":"","ucode":"DEE7085F7E55A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/62/37912d51.jpg","comment_is_top":false,"comment_ctime":1546785892,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5841753188","product_id":100007101,"comment_content":"这篇真是干满满，之前没理解清楚的select，epoll搞懂了","like_count":1},{"had_liked":false,"id":43094,"user_name":"趁你还年轻233","can_delete":false,"product_type":"c1","uid":1053875,"ip_address":"","ucode":"B7CC120EF42980","user_header":"https://static001.geekbang.org/account/avatar/00/10/14/b3/b6e1817a.jpg","comment_is_top":false,"comment_ctime":1543160830,"is_pvip":false,"replies":[{"id":"15498","content":"libevent event","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1543217994,"ip_address":"","comment_id":43094,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838128126","product_id":100007101,"comment_content":"nodejs的事件驱动模型可以解决C10K问题","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430299,"discussion_content":"libevent event","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543217994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42762,"user_name":"shulin","can_delete":false,"product_type":"c1","uid":1157647,"ip_address":"","ucode":"AFA256BB2F1073","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epMgsF4cibo74JnDZHibTiaYdOUpIJI5VyT7uNywWPwY14C45bBsBgZX3SlAsNybgYSpLkGB0Aphb2Yw/132","comment_is_top":false,"comment_ctime":1543038060,"is_pvip":false,"replies":[{"id":"15316","content":"但是是两个socket，也即占用两个文件描述符","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1543056517,"ip_address":"","comment_id":42762,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5838005356","product_id":100007101,"comment_content":"一旦握手成功，服务端的 accept 就会返回另一个 Socket。这句话不理解。请问老师，我用tcp调试工具，1个server接收到2个client，服务器端公用的是同一个端口（就是监听端口）啊。老师解答下，谢谢","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430187,"discussion_content":"但是是两个socket，也即占用两个文件描述符","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543056517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1996252,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/75/dc/564f9143.jpg","nickname":"liyongjun","note":"","ucode":"8F34623ED02FFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373046,"discussion_content":"端口是同一个端口，socket 是两个 socket。端口和 socket 不是一个东西。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620576804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41035,"user_name":"Enterprize","can_delete":false,"product_type":"c1","uid":1215130,"ip_address":"","ucode":"3C120E9023B6C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg","comment_is_top":false,"comment_ctime":1542716695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837683991","product_id":100007101,"comment_content":"epoll讲的不错，真的是深入浅出","like_count":1},{"had_liked":false,"id":24485,"user_name":"Untitled","can_delete":false,"product_type":"c1","uid":1039464,"ip_address":"","ucode":"8DD6ABA3E81A2E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dc/68/006ba72c.jpg","comment_is_top":false,"comment_ctime":1537074490,"is_pvip":false,"replies":[{"id":"8960","content":"就是操作系统的方式","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1537081085,"ip_address":"","comment_id":24485,"utype":1}],"discussion_count":1,"race_medal":2,"score":"5832041786","product_id":100007101,"comment_content":"老师很形象地描述了线程和进程的区别，这个与操作系统上的cup工作机制的概念是一致的吗？","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424004,"discussion_content":"就是操作系统的方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537081085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12833,"user_name":"张立春","can_delete":false,"product_type":"c1","uid":1124382,"ip_address":"","ucode":"D8B4523B95D839","user_header":"https://static001.geekbang.org/account/avatar/00/11/28/1e/76e19bd3.jpg","comment_is_top":false,"comment_ctime":1529059544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5824026840","product_id":100007101,"comment_content":"几种方式写的逻辑清晰易懂，赞一个！","like_count":1},{"had_liked":false,"id":358666,"user_name":"小杰","can_delete":false,"product_type":"c1","uid":2853200,"ip_address":"浙江","ucode":"BBDF8E9F348F65","user_header":"https://static001.geekbang.org/account/avatar/00/2b/89/50/aee9fdab.jpg","comment_is_top":false,"comment_ctime":1664526745,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1664526745","product_id":100007101,"comment_content":"1、查了下，windows只支持select，算是多路复用里面性能最差的，而且还有最大监听1024的限制；跨平台的程序，如果只是单纯通信的话，使用基于socket编写的公共库就可以了，但是服务端尽量还是linux，这样监听socket在保证最大数目的时候，还能有较好的性能。2、http 三要素 请求头、请求行、请求体；输入客户端请求，服务端应答的协议；https加入了ssl&#47;tls的传输加密","like_count":0},{"had_liked":false,"id":357161,"user_name":"Paradise","can_delete":false,"product_type":"c1","uid":1618275,"ip_address":"四川","ucode":"9CA103A82F5F38","user_header":"https://static001.geekbang.org/account/avatar/00/18/b1/63/68239c70.jpg","comment_is_top":false,"comment_ctime":1662999381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662999381","product_id":100007101,"comment_content":"hello 各位同学我有 一个疑问，“上限就为系统定义的、进程打开的最大文件描述符个数。因而，epoll 被称为解决 C10K 问题的利器。”<br><br>假设我想实现C1000K，是不是 ulimit是不是就要开一百万呢？socket是存放在内存中的，是不是只要内存足够大，就可以开一百万呢？","like_count":0},{"had_liked":false,"id":357160,"user_name":"Paradise","can_delete":false,"product_type":"c1","uid":1618275,"ip_address":"四川","ucode":"9CA103A82F5F38","user_header":"https://static001.geekbang.org/account/avatar/00/18/b1/63/68239c70.jpg","comment_is_top":false,"comment_ctime":1662998294,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662998294","product_id":100007101,"comment_content":"老师您好！ “有个 C10K，它的意思是一台机器要维护 1 万个连接，就要创建 1 万个进程或者线程，那么操作系统是无法承受的。如果维持 1 亿用户在线需要 10 万台服务器，成本也太高了。”<br>这个地方是不是写错了啊， 1亿除一W等于1W吧？","like_count":0},{"had_liked":false,"id":344243,"user_name":"北平","can_delete":false,"product_type":"c1","uid":1792374,"ip_address":"","ucode":"01E4E646BDDDF4","user_header":"https://static001.geekbang.org/account/avatar/00/1b/59/76/4a5d6cc5.jpg","comment_is_top":false,"comment_ctime":1651392673,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651392673","product_id":100007101,"comment_content":"写的很好","like_count":0},{"had_liked":false,"id":343080,"user_name":"清","can_delete":false,"product_type":"c1","uid":2875409,"ip_address":"","ucode":"DE3CE0B9DEE83F","user_header":"https://static001.geekbang.org/account/avatar/00/2b/e0/11/a77fd9cf.jpg","comment_is_top":false,"comment_ctime":1650620066,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650620066","product_id":100007101,"comment_content":"这个一篇让我豁然开朗 了epoll 是个什么 厉害","like_count":0},{"had_liked":false,"id":332725,"user_name":"深水蓝","can_delete":false,"product_type":"c1","uid":1637933,"ip_address":"","ucode":"3E3B195DE54DE1","user_header":"https://static001.geekbang.org/account/avatar/00/18/fe/2d/e23fc6ee.jpg","comment_is_top":false,"comment_ctime":1643524898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643524898","product_id":100007101,"comment_content":"即使利用epoll实现IO多路复用，底层是否也应该根据服务器硬件的CPU内核数量来建立线程数量，所有需要监听的socket都分配到这些线程池当中呢？即使监听的socket越来越多，只应该将每个监听的线程负载逐步增加，而不是增加线程数量。线程数量太多，只会过度消耗系统资源，提升不了综合的性能。<br><br>不知道我这个看法对不对，希望老师或者楼下的高人点评一下。","like_count":0},{"had_liked":false,"id":328949,"user_name":"i_chase","can_delete":false,"product_type":"c1","uid":1795511,"ip_address":"","ucode":"09C41C863F4EA3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/65/b7/058276dc.jpg","comment_is_top":false,"comment_ctime":1640949419,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1640949419","product_id":100007101,"comment_content":"通过本节知道了，tcp和udp的socket也是不一样的。由于无连接，udp服务端只有一个socket。","like_count":0},{"had_liked":false,"id":328948,"user_name":"i_chase","can_delete":false,"product_type":"c1","uid":1795511,"ip_address":"","ucode":"09C41C863F4EA3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/65/b7/058276dc.jpg","comment_is_top":false,"comment_ctime":1640949269,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1640949269","product_id":100007101,"comment_content":"以前在学校死记硬背八股文，没有实际理解epoll和select。现在工作以后再看，其实自己梳理一下，逻辑还是很清晰的。","like_count":0},{"had_liked":false,"id":327626,"user_name":"残天噬魂","can_delete":false,"product_type":"c1","uid":1506609,"ip_address":"","ucode":"A2AD8303A4518D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132","comment_is_top":false,"comment_ctime":1640214113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640214113","product_id":100007101,"comment_content":"为什么用于监听的socket和用于数据传输的socket不能用同一个呢？","like_count":0},{"had_liked":false,"id":317090,"user_name":"剑八","can_delete":false,"product_type":"c1","uid":1297630,"ip_address":"","ucode":"0A09F41DB8A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","comment_is_top":false,"comment_ctime":1634684110,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634684110","product_id":100007101,"comment_content":"客户端与服务器的socket文件描述符，连接时是一个，连接完成是一个。其中连接完成的socket用于后续所有数据收发，以及关闭连接操作。<br>那是2个的原因是？<br>除了从功能职责更加清楚的角度去看，即：tcp三次握手连接，数据读取发送<br><br>","like_count":0},{"had_liked":false,"id":313604,"user_name":"安德森先生","can_delete":false,"product_type":"c1","uid":2564411,"ip_address":"","ucode":"482BAF82DB7390","user_header":"https://static001.geekbang.org/account/avatar/00/27/21/3b/e3edea37.jpg","comment_is_top":false,"comment_ctime":1632553693,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632553693","product_id":100007101,"comment_content":"老师功底深厚，看完感觉这部分的面试应该就没问题了，哈哈<br>","like_count":0},{"had_liked":false,"id":311766,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1631452816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631452816","product_id":100007101,"comment_content":"文中说“Socket 在 Linux 中就是以文件的形式存在的”，该怎样理解呢 ？","like_count":0},{"had_liked":false,"id":311765,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1631452487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631452487","product_id":100007101,"comment_content":"每个进程，一般情况下，会有几个 socket ?","like_count":0},{"had_liked":false,"id":309352,"user_name":"平少","can_delete":false,"product_type":"c1","uid":1218742,"ip_address":"","ucode":"EC76D35D0C2CBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/b6/0c0ed771.jpg","comment_is_top":false,"comment_ctime":1630058367,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630058367","product_id":100007101,"comment_content":"老师，请问下nginx也是使用的IO多路复用epoll模型，所以说也是通过文件描述符来操作的，每台服务器最大文件描述符是不是最多65535个呢，那nginx支持的最大并发数是不是只有65535呢？","like_count":0},{"had_liked":false,"id":308075,"user_name":"mlbjay","can_delete":false,"product_type":"c1","uid":1005618,"ip_address":"","ucode":"FB62EAB4568AFA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/32/535e5c3c.jpg","comment_is_top":false,"comment_ctime":1629381310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629381310","product_id":100007101,"comment_content":"当年自己开发了一个内网网盘的小项目，遇到只用一个socket没法又监听又发数据。<br>后来，就分为 监听和 每个客户端都有一个发送数据的socket。<br>😂<br>现在，看来是 正常思路啊。","like_count":0},{"had_liked":false,"id":307692,"user_name":"Elliot","can_delete":false,"product_type":"c1","uid":1030070,"ip_address":"","ucode":"CC58A6FD2F338C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/b6/17103195.jpg","comment_is_top":false,"comment_ctime":1629202505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629202505","product_id":100007101,"comment_content":"文件描述符不太好理解。老师能详细讲讲吗","like_count":0},{"had_liked":false,"id":305196,"user_name":"www","can_delete":false,"product_type":"c1","uid":1898338,"ip_address":"","ucode":"ADC9BC655EA16C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f7/62/947004d0.jpg","comment_is_top":false,"comment_ctime":1627873744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627873744","product_id":100007101,"comment_content":"老师这样从最底层协议讲起来，明确高层如何利用底层协议，高层协议就非常好理解了，赞","like_count":0},{"had_liked":false,"id":288363,"user_name":"mkcaptain","can_delete":false,"product_type":"c1","uid":2341231,"ip_address":"","ucode":"0BF1BAE12B0C11","user_header":"https://static001.geekbang.org/account/avatar/00/23/b9/6f/b40d1acf.jpg","comment_is_top":false,"comment_ctime":1618440866,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1618440866","product_id":100007101,"comment_content":"java的io流里面，output对应到文件，input对应从文件读，那么是否应该表示为&quot;读入，写出&quot;，而非&quot;读出，写入&quot;？<br>谢谢~","like_count":0},{"had_liked":false,"id":282858,"user_name":"胡小涵","can_delete":false,"product_type":"c1","uid":2004538,"ip_address":"","ucode":"2E750C65EC282C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/96/3a/e06f8367.jpg","comment_is_top":false,"comment_ctime":1615442138,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615442138","product_id":100007101,"comment_content":"没有源码，我真的觉得缺了点什么，有点遗憾。","like_count":0},{"had_liked":false,"id":275132,"user_name":"熊猫","can_delete":false,"product_type":"c1","uid":1080238,"ip_address":"","ucode":"23C85117A16BEF","user_header":"https://static001.geekbang.org/account/avatar/00/10/7b/ae/66ae403d.jpg","comment_is_top":false,"comment_ctime":1611318843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611318843","product_id":100007101,"comment_content":"老师，请教个问题，请求接口时，查看打印nginx日志，有时候可以到达nginx，有时候到达不了nginx(已确认只有一台nginx)这是什么原因呀","like_count":0},{"had_liked":false,"id":265987,"user_name":"ppyh","can_delete":false,"product_type":"c1","uid":1351148,"ip_address":"","ucode":"14022ADEC9B53F","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/ec/235b74c0.jpg","comment_is_top":false,"comment_ctime":1607090861,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607090861","product_id":100007101,"comment_content":"忽然想到了一个问题，问什么tcp使用四元组来标识一个socket，而udp使用二元组来标识呢？","like_count":0},{"had_liked":false,"id":252422,"user_name":"牛味浓牛味浓","can_delete":false,"product_type":"c1","uid":2113755,"ip_address":"","ucode":"0E1EDD3B13DFEF","user_header":"https://static001.geekbang.org/account/avatar/00/20/40/db/5e4aa1e6.jpg","comment_is_top":false,"comment_ctime":1602297466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602297466","product_id":100007101,"comment_content":"我一直以为epoll也是遍历。。只不过从内核返回数据的时候把有数据的fd排到前面了，由此来控制遍历的次数？","like_count":0},{"had_liked":false,"id":244841,"user_name":"Dylan","can_delete":false,"product_type":"c1","uid":1040236,"ip_address":"","ucode":"58064D0C9F9F5F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/df/6c/5af32271.jpg","comment_is_top":false,"comment_ctime":1598697221,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598697221","product_id":100007101,"comment_content":"看完刘老师的内核课程回来看网络课程，看到内核中的这部分内容倍感亲切","like_count":0},{"had_liked":false,"id":235064,"user_name":"ByteJitter","can_delete":false,"product_type":"c1","uid":1334660,"ip_address":"","ucode":"BB8EF82D5BF337","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/oXhIRH7J3Vich837bc8KcJIRviboAuQ8iaIjHAJtHox8NNYR1lF7luN5B5LVuMaml27EKR5uGRV9U5klmsuwmsGoA/132","comment_is_top":false,"comment_ctime":1594881772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594881772","product_id":100007101,"comment_content":"这是一个经常考的知识点，就是监听的 Socket 和真正用来传数据的 Socket 是两个，一个叫作监听 Socket，一个叫作已连接 Socket。<br>---------------<br>2个socket的关系和功能区别，老师能解答下么？<br>这个对于理解服务器原理很有帮助的点呗一笔带过了的。","like_count":0},{"had_liked":false,"id":227963,"user_name":"慢摇哥哥","can_delete":false,"product_type":"c1","uid":1134062,"ip_address":"","ucode":"095D81584B7DC6","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/ee/7daf0aa1.jpg","comment_is_top":false,"comment_ctime":1592530452,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592530452","product_id":100007101,"comment_content":"刘老师不仅技术功力深厚，文学底蕴和风趣幽默更是难得，感谢","like_count":0},{"had_liked":false,"id":227864,"user_name":"FF","can_delete":false,"product_type":"c1","uid":1133758,"ip_address":"","ucode":"89DB3329AAEAB2","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/be/25919d4b.jpg","comment_is_top":false,"comment_ctime":1592497895,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592497895","product_id":100007101,"comment_content":"悟了~，UDP没有C10K的最主要原因就是不用维护链接状态，不用建立多个socket，不用去担心多个socket的IO状态","like_count":0},{"had_liked":false,"id":222339,"user_name":"shanshan","can_delete":false,"product_type":"c1","uid":1022191,"ip_address":"","ucode":"F0BA8E2049F551","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/ef/bf392cc0.jpg","comment_is_top":false,"comment_ctime":1590753089,"is_pvip":false,"replies":[{"id":"83169","content":"本来一个socket分配给一个线程后，无论是否有通信，都要占着这个线程，现在是项目组也即线程数固定，谁通信就会收到一个事件，分配一个线程去做，也即多路复用","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1591840677,"ip_address":"","comment_id":222339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590753089","product_id":100007101,"comment_content":"epoll 从本质上来说，它还是一种事件通知的机制。我理解的是，它充当了一种代理的角色，它管着所有已连接的socket，这些socket 的某些事件发生的时候，它会把这种变化通过call back 通知到epoll，然后epoll 会得到是哪个socket 发生了哪些事件变化的信息，然后把这些信息再给到线程，线程便知道了要对哪些socket 做哪些操作，类比来说，类似于饭店里点了餐，然后只是不需要你在上菜窗口等着，不停的查看是否菜备好了，你只是拿了一个号，然后当饭好了以后会叫号，这个时候你再去取餐，就是说取餐的这个过程还是需要你自己来做，所以这还是没有实现异步的过程，应该还算是同步，异步应该是说是有服务员给你把餐送了过来。epoll这个过程不知道理解的对不对，希望老师指点。另外有个问题就是，是一个“项目组”对应一个epoll 吗 还是一个epoll 可以对应多个‘项目组’，他两之间又是通过什么来进行通信的呢？","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496757,"discussion_content":"本来一个socket分配给一个线程后，无论是否有通信，都要占着这个线程，现在是项目组也即线程数固定，谁通信就会收到一个事件，分配一个线程去做，也即多路复用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591840677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216363,"user_name":"罗","can_delete":false,"product_type":"c1","uid":1259157,"ip_address":"","ucode":"C71E4413130A66","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/95/a5358127.jpg","comment_is_top":false,"comment_ctime":1589246771,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589246771","product_id":100007101,"comment_content":"这节太棒了","like_count":0},{"had_liked":false,"id":211732,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1587999668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587999668","product_id":100007101,"comment_content":"更高层级的语言必然代表着更简单的入门和更容易的创建,HTTP自然比原生的Socket好使","like_count":0},{"had_liked":false,"id":205482,"user_name":"黑铁打野王","can_delete":false,"product_type":"c1","uid":1189836,"ip_address":"","ucode":"09FCB9DB732177","user_header":"https://static001.geekbang.org/account/avatar/00/12/27/cc/99349a54.jpg","comment_is_top":false,"comment_ctime":1586628000,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586628000","product_id":100007101,"comment_content":"我刚看到有关socket超时设置，read&#47;write 超时设置是一个什么样的用处呢？","like_count":0},{"had_liked":false,"id":204665,"user_name":"吃瓜胖子😂","can_delete":false,"product_type":"c1","uid":1325243,"ip_address":"","ucode":"174240CB0097A6","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/bb/e3bf1040.jpg","comment_is_top":false,"comment_ctime":1586439518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586439518","product_id":100007101,"comment_content":"经常遇到Write&#47;Read timeout的异常，是不是在读&#47;写流的时候由于网络或者数据量大的原因，导致超时？","like_count":0},{"had_liked":false,"id":203056,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1586133100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586133100","product_id":100007101,"comment_content":"套接字听起来很抽象，top&#47;ip是协议，他在操作系统具体执行的时候，需要有个执行者，套接字就是操作系统提供的，可以用代码实现top&#47;ip的接口","like_count":0},{"had_liked":false,"id":202089,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1585901402,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1585901402","product_id":100007101,"comment_content":"有深度！","like_count":0},{"had_liked":false,"id":198186,"user_name":"王楷程","can_delete":false,"product_type":"c1","uid":1938215,"ip_address":"","ucode":"C53850ECCFC42E","user_header":"https://static001.geekbang.org/account/avatar/00/1d/93/27/7d2ad04c.jpg","comment_is_top":false,"comment_ctime":1585413204,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585413204","product_id":100007101,"comment_content":"老师讲的挺好","like_count":0},{"had_liked":false,"id":193595,"user_name":"King-ZJ","can_delete":false,"product_type":"c1","uid":1915385,"ip_address":"","ucode":"7448A4BBB5A118","user_header":"https://static001.geekbang.org/account/avatar/00/1d/39/f9/b946719a.jpg","comment_is_top":false,"comment_ctime":1584931932,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584931932","product_id":100007101,"comment_content":"一直学习路由与交换，在TCP&#47;IP模型中，也是基本了解和学习了下四层（物理层、数据链路层、网络层和传输层），今天接触了TCP和UDP上的Socket编程和实现遇到的C10K问题，是之前一点都不了解的东西。从事网络方面，是觉得不用去思考编程所带来的逻辑，而今天必然去了解和学习这些过程是怎么回事。真的是在江湖上混，迟早是要还的。","like_count":0},{"had_liked":false,"id":193350,"user_name":"Geek_f0bd6b","can_delete":false,"product_type":"c1","uid":1905495,"ip_address":"","ucode":"54C2BD14F77F72","user_header":"","comment_is_top":false,"comment_ctime":1584890758,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584890758","product_id":100007101,"comment_content":"上学时学过socket编程，后来就还给老师了。突然想到一个问题，基于Linux的网络转发设备，对数据包转发时，和这讲的内容有什么关系？","like_count":0},{"had_liked":false,"id":176049,"user_name":"虫大侠","can_delete":false,"product_type":"c1","uid":1496150,"ip_address":"","ucode":"C4D52D077A4222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/THibHz67lwAAo3LPoyVATEFIVaCXzM9EP3PrRNSOlxBGOudQBeaMwBUric4ibAicluxHtpWw7YibFUTyIUuibViaFicluQ/132","comment_is_top":false,"comment_ctime":1580919417,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580919417","product_id":100007101,"comment_content":"在服务端等待的时候，客户端可以通过 connect 函数发起连接。先在参数中指明要连接的 IP 地址和端口号，然后开始发起三次握手。内核会给客户端分配一个临时的端口。一旦握手成功，服务端的 accept 就会返回另一个 Socket。<br>-------------------<br>如果分配了临时端口，防火墙没有开放端口，没有被墙，这块要怎么才能理解","like_count":0},{"had_liked":false,"id":174753,"user_name":"victor","can_delete":false,"product_type":"c1","uid":1144455,"ip_address":"","ucode":"A886AE970CEC4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/76/87/5d282406.jpg","comment_is_top":false,"comment_ctime":1580371694,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1580371694","product_id":100007101,"comment_content":"刘老师您好，每个socket内核维护两个队列，一个是握手的的队列，一个确定通信的队列，那么监听的 Socket 和真正用来传数据的 Socket 是两个，一个叫作监听 Socket，一个叫作已连接 Socket，这两个socket分别都有维护两个队列吗？","like_count":0},{"had_liked":false,"id":174752,"user_name":"victor","can_delete":false,"product_type":"c1","uid":1144455,"ip_address":"","ucode":"A886AE970CEC4C","user_header":"https://static001.geekbang.org/account/avatar/00/11/76/87/5d282406.jpg","comment_is_top":false,"comment_ctime":1580371518,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1580371518","product_id":100007101,"comment_content":"在内核中，为每个 Socket 维护两个队列，那么请问监听的 Socket 和真正用来传数据的 Socket 是两个，一个叫作监听 Socket，一个叫作已连接 Socket。这两个socket也分别维护两个处于 established 状态处于 syn_rcvd 的状态","like_count":0},{"had_liked":false,"id":172897,"user_name":"Geek_d26e63","can_delete":false,"product_type":"c1","uid":1809676,"ip_address":"","ucode":"24125CED20B6DF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fBOybgVTWXYXxaicaVEysXCjkKT13dX7icAj96KibJ815mia1FvYro9KcbA3xtwnIxmPJ38Vt6rmg6vp0auGKel93A/132","comment_is_top":false,"comment_ctime":1579353987,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579353987","product_id":100007101,"comment_content":"“如果想实现一个跨平台的程序，你知道应该怎么办吗？”用Java哈哈哈哈","like_count":0},{"had_liked":false,"id":170820,"user_name":"你是小孩","can_delete":false,"product_type":"c1","uid":1804468,"ip_address":"","ucode":"CCBDAC20C43C95","user_header":"","comment_is_top":false,"comment_ctime":1578731301,"is_pvip":false,"replies":[{"id":"66266","content":"还有epoll","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1578823223,"ip_address":"","comment_id":170820,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578731301","product_id":100007101,"comment_content":"后面讲解的Socket4种方式，其实是Linux系统中的几种IO模型：<br>方式1、2其实用的是阻塞式IO模型 &#47; 非阻塞IO模型，区别是前者是进程级、后者是线程级<br>方式3用的是Linux的多路复用select()接口<br>方式4其实用的是Linux的异步IO模型","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481125,"discussion_content":"还有epoll","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578823223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167127,"user_name":"巴西","can_delete":false,"product_type":"c1","uid":1119116,"ip_address":"","ucode":"6E68AA02011541","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/8c/c86340ca.jpg","comment_is_top":false,"comment_ctime":1577696501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577696501","product_id":100007101,"comment_content":"觉得要多看几次,当把这篇弄明白了 java的io nio也就理解的更透彻了.","like_count":0},{"had_liked":false,"id":163466,"user_name":"奔跑的码仔","can_delete":false,"product_type":"c1","uid":1609871,"ip_address":"","ucode":"AB3B02B07B8B8C","user_header":"https://static001.geekbang.org/account/avatar/00/18/90/8f/9c691a5f.jpg","comment_is_top":false,"comment_ctime":1576726665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576726665","product_id":100007101,"comment_content":"“因为复制了文件描述符列表，文件描述符都是指向整个内核统一的打开文件列表的”，理论上，每个进程都是维护各自的打开文件的列表(struct file 列表）的吗？文中所说的内核统一维护是什么意思呢？","like_count":0},{"had_liked":false,"id":157537,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1575189555,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575189555","product_id":100007101,"comment_content":"最后这段 epoll 的 Socket 事件的通知处理过程描述实在没看明白。<br><br>“当 epoll_ctl 添加一个 Socket 的时候，其实是这个 Scoket 加入这个红黑树，同时红黑树里面的节点内有个指针指向一个结构 eppoll_entry，将这个结构挂在被监听的 Socket 的事件列表（wait_queue）中。当一个 Socket 来了一个事件的时候，可以从这个列表中得到 这个 eppoll_entry 对象（图中queue 后不只一个 eppoll_entry，获取是要从wait_queue 遍历吗？），eppoll_entry 又有一个指针（epitem *）指向红黑树的节点，并调用 call back 通知它（再通知 Socket？不是处罚回调函数处理业务逻辑吗？）。”","like_count":0},{"had_liked":false,"id":156587,"user_name":"纳兰提","can_delete":false,"product_type":"c1","uid":1228594,"ip_address":"","ucode":"95695A2E9450B4","user_header":"https://static001.geekbang.org/account/avatar/00/12/bf/32/25553aa8.jpg","comment_is_top":false,"comment_ctime":1574918134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574918134","product_id":100007101,"comment_content":"太感谢老师了，看到多路复用那里，讲的简单明了，通俗易懂，这块一直了解的比较模糊","like_count":0},{"had_liked":false,"id":153582,"user_name":"有朋自远方来","can_delete":false,"product_type":"c1","uid":1083600,"ip_address":"","ucode":"23A12829DEB119","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/d0/6e75f766.jpg","comment_is_top":false,"comment_ctime":1574262614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574262614","product_id":100007101,"comment_content":"Linux 为什么不大力支持AIO呢？而是epoll呢？","like_count":0},{"had_liked":false,"id":150642,"user_name":"deepz","can_delete":false,"product_type":"c1","uid":1570088,"ip_address":"","ucode":"4BD23A44CDB384","user_header":"https://static001.geekbang.org/account/avatar/00/17/f5/28/898a6947.jpg","comment_is_top":false,"comment_ctime":1573572985,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1573572985","product_id":100007101,"comment_content":"感觉好难，也看到了网上面经里出现的很多关键字，越来越有趣了呢🐶","like_count":0},{"had_liked":false,"id":149469,"user_name":"政国胡-15558137965","can_delete":false,"product_type":"c1","uid":1734273,"ip_address":"","ucode":"FB4C4457B83779","user_header":"https://static001.geekbang.org/account/avatar/00/1a/76/81/0e6049c5.jpg","comment_is_top":false,"comment_ctime":1573226605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573226605","product_id":100007101,"comment_content":"select和epoll的对比，一个是数组查找，一个是红黑树查找，所以可以认为是存储结构不同，因此提高了速度，是吗？","like_count":0},{"had_liked":false,"id":144609,"user_name":"刘其润","can_delete":false,"product_type":"c1","uid":1389459,"ip_address":"","ucode":"613641C3C18BCE","user_header":"https://static001.geekbang.org/account/avatar/00/15/33/93/3f221bb8.jpg","comment_is_top":false,"comment_ctime":1571979708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571979708","product_id":100007101,"comment_content":"看过unp的表示，这一节讲的很nice啊，给做了个很好的梳理和总结","like_count":0},{"had_liked":false,"id":142599,"user_name":"又双叒叕是一年啊","can_delete":false,"product_type":"c1","uid":1000015,"ip_address":"","ucode":"E067320E537DEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","comment_is_top":false,"comment_ctime":1571409651,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571409651","product_id":100007101,"comment_content":"老师请教下， epoll模型的 水平触发和边缘触发指什么？不太清楚请老师帮忙解答下谢谢","like_count":0},{"had_liked":false,"id":140948,"user_name":"lyonger","can_delete":false,"product_type":"c1","uid":1313840,"ip_address":"","ucode":"E89A75DADEA2A1","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/30/bb4bfe9d.jpg","comment_is_top":false,"comment_ctime":1571098358,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571098358","product_id":100007101,"comment_content":"刘老师，请问下，那个tcp的状态机、半连接队列和全连接队列都是保存在socket结构中的sk_buff里面吗？求解答，多谢啦。","like_count":0},{"had_liked":false,"id":132952,"user_name":"FOCUS","can_delete":false,"product_type":"c1","uid":1140080,"ip_address":"","ucode":"DFE3078B632026","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/70/7e137498.jpg","comment_is_top":false,"comment_ctime":1568281935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568281935","product_id":100007101,"comment_content":"在内核中，为每个 Socket 维护两个队列。(这里的内核是指 CPU 内核？在windows 环境也是如此？)","like_count":0},{"had_liked":false,"id":132939,"user_name":"FOCUS","can_delete":false,"product_type":"c1","uid":1140080,"ip_address":"","ucode":"DFE3078B632026","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/70/7e137498.jpg","comment_is_top":false,"comment_ctime":1568279654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568279654","product_id":100007101,"comment_content":"能够设置的参数，也只能是端到端协议之上网络层和传输层的。 -- 这句话看得有点模糊，你要表达的意思是“设置的参数只能是协议之上的网络层和传输层相关的”？","like_count":0},{"had_liked":false,"id":131233,"user_name":"无名","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1567676071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567676071","product_id":100007101,"comment_content":"我安装了Ubuntu 64 18.04.2虚拟机，在&#47;etc&#47;security&#47;limits.conf配置了：<br>* soft nofile 65535<br>* hard nofile 65535<br>root soft nofile 65535<br>root hard nofile 55535<br><br>重新启动后没有效果。","like_count":0},{"had_liked":false,"id":130990,"user_name":"无名","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1567590895,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567590895","product_id":100007101,"comment_content":"老师，关于listen(int sockfd, int backlog)函数有几个疑问：<br>1、现在Linux系统中，backlog的值是未完成连接队列+已完成连接队列之和的最大值吗？<br>2、未完成连接队列中的RTT值是多少（即多久没有完成三次握手将其丢弃）？可以动态修改吗？","like_count":0},{"had_liked":false,"id":130916,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1567573956,"is_pvip":false,"replies":[{"id":"49195","content":"epoll函数是多路复用IO接口select和poll函数的增强版本。","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567602269,"ip_address":"","comment_id":130916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567573956","product_id":100007101,"comment_content":"tcp这几讲知识点真的好多 要好好消化<br><br>终于明白了 select 与 epoll原来是这样的:<br><br>select通过轮询所监听的文件描述符集合 确认是否发生io<br>epoll基于事件回调机制 发生io<br><br>是这样的吗？超哥<br><br>另外，大家都常说的poll又是怎么回事啊？","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466195,"discussion_content":"epoll函数是多路复用IO接口select和poll函数的增强版本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567602269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114957,"user_name":"小学生六年级","can_delete":false,"product_type":"c1","uid":1380399,"ip_address":"","ucode":"12A85A71709E06","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/aTnlMgdUuSFnBjQD7IlqaDibXg8UlZ8kxhj1AWwo0oWiaHRK2VkRhufmYvkt0ruHo2xP1CRPsed2h4IpNpAibn4uw/132","comment_is_top":false,"comment_ctime":1563438897,"is_pvip":false,"replies":[{"id":"46572","content":"sync_flood是一个很大的问题","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566358809,"ip_address":"","comment_id":114957,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563438897","product_id":100007101,"comment_content":"socket 维护两个队列！！！  sync_flood","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458900,"discussion_content":"sync_flood是一个很大的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566358809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112352,"user_name":"Lrwin","can_delete":false,"product_type":"c1","uid":1180503,"ip_address":"","ucode":"5E394E36419C56","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/57/31595f22.jpg","comment_is_top":false,"comment_ctime":1562722876,"is_pvip":false,"replies":[{"id":"46721","content":"谢谢","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566386457,"ip_address":"","comment_id":112352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562722876","product_id":100007101,"comment_content":"这篇文章太牛了","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457694,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566386457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99605,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1559265496,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559265496","product_id":100007101,"comment_content":"1 基本含义:socket英文插座或插槽，中文名套接字，用于在不同的应用间进行通讯，支持tcp和udp两种协议。在网络层通讯，需要设置ipv4还是ipv6，是tcp还是udp。tcp传输的是数据流，udp是数据报文。2 tcp协议的socket函数调用过程 服务端建立一个socket，绑定ip和端口，处于listen状态，客户端建立一个socket，开始进行连接，连接成功之后发送数据包。内核为每个socket建立2个队列，一个是已经完成的队列，一个是正在连接的队列，服务端调用accept函数，拿出已连接的一个队列进行处理，读取客户端发送的内容，处理之后返回给客户端。服务端游2个socket，一个监听的socket，一个传输数据的socket，已连接socket。tcp的socket就是文件流，在linux上是以文件形式存在的，udp和tcp相比，可以只有一个socket，一个socket和多个客户端连接，也需要绑定ip和端口号，sendto和recvfrom，没有连接状态。tcp最大连接数理论上线是2的48次方，由于受到内存和文件描述符的限制，达不到。支持多个socket，服务端1 创建子进程，2创建线程 3一个线程盯着所有的socket，放在文件描述符集合fd_set中，用select函数监听文件描述符，一旦有变化，就进行处理 4 epoll函数通过注册callback函数，某个文件描述符发生变化，会主动通知。","like_count":0,"discussions":[{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"尔冬橙","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1860,"discussion_content":"“内核为每个socket建立2个队列，一个是已经完成的队列，一个是正在连接的队列”这里不是很明白，文中图中不是写的收发队列么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563006273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95976,"user_name":"Build","can_delete":false,"product_type":"c1","uid":1461416,"ip_address":"","ucode":"99FBD3FF9B44C5","user_header":"https://static001.geekbang.org/account/avatar/00/16/4c/a8/2dbe1e90.jpg","comment_is_top":false,"comment_ctime":1558281735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558281735","product_id":100007101,"comment_content":"本小节讲了socket机制，在服务端会进行，create,bind,listen,当客户端发起connect时，服务端accept，连接建好后。linux如何来管理这么多连接呢，采用epool的方式。","like_count":0},{"had_liked":false,"id":90461,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1556524850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556524850","product_id":100007101,"comment_content":"这篇文章读起来有点吃力，😂","like_count":0},{"had_liked":false,"id":88080,"user_name":"mlbjay","can_delete":false,"product_type":"c1","uid":1005618,"ip_address":"","ucode":"FB62EAB4568AFA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/32/535e5c3c.jpg","comment_is_top":false,"comment_ctime":1555840680,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555840680","product_id":100007101,"comment_content":"看完了发现，这一讲明明是在讲：多进程、多线程、IO多路复用等。<br>以前，开发过一个网盘软件，就用的Python的多进程实现的。<br>用的人很少，所以没有啥性能问题，用的多了，看了就得上IO多路复用了。","like_count":0},{"had_liked":false,"id":77941,"user_name":"云学","can_delete":false,"product_type":"c1","uid":1027233,"ip_address":"","ucode":"366AE90BA06356","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg","comment_is_top":false,"comment_ctime":1553044169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553044169","product_id":100007101,"comment_content":"这篇文章一定要看，经常问到","like_count":0},{"had_liked":false,"id":66773,"user_name":"谭小谭","can_delete":false,"product_type":"c1","uid":1298631,"ip_address":"","ucode":"C7928BEDFF4EDC","user_header":"https://static001.geekbang.org/account/avatar/00/13/d0/c7/62de0458.jpg","comment_is_top":false,"comment_ctime":1550019285,"is_pvip":false,"replies":[{"id":"25970","content":"是的<br>","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551439348,"ip_address":"","comment_id":66773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550019285","product_id":100007101,"comment_content":"这一章讲的是不是就是http服务器干的事情，比如nginx","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438900,"discussion_content":"是的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551439348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63071,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1548243588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548243588","product_id":100007101,"comment_content":"我觉得 tcp 跟 udp 讲的有点简单，比较晦涩，要是能结合实际场景讲解就更好了。毕竟在实际项目开发接触到最多的就是 http tcp 协议了","like_count":0},{"had_liked":false,"id":58208,"user_name":"佳楠","can_delete":false,"product_type":"c1","uid":1008809,"ip_address":"","ucode":"A1698AE91992AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/64/a9/27d63f2e.jpg","comment_is_top":false,"comment_ctime":1547010853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547010853","product_id":100007101,"comment_content":"写跨平台的程序可以使用 libu 等抹平了操作系统底层差异的事件库。","like_count":0},{"had_liked":false,"id":57144,"user_name":"纵横","can_delete":false,"product_type":"c1","uid":1210414,"ip_address":"","ucode":"47F88205429936","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIM0sj0oP7bZ3YB2p4UYRqEZEic0p6gpsOOcVDiaYwCszLXEoYsVON1icoia7budHmnkDk0vyPaZKOia2Q/132","comment_is_top":false,"comment_ctime":1546659028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546659028","product_id":100007101,"comment_content":"哈哈","like_count":0},{"had_liked":false,"id":54463,"user_name":"C_im_Y","can_delete":false,"product_type":"c1","uid":1334465,"ip_address":"","ucode":"3655F0A90AF84F","user_header":"https://static001.geekbang.org/account/avatar/00/14/5c/c1/6d8f3e10.jpg","comment_is_top":false,"comment_ctime":1545875567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545875567","product_id":100007101,"comment_content":"监听的 Socket 和真正用来传数据的 Socket 是两个，一个叫做监听socket，一个叫做已连接socket。<br><br>老师，这句话的意思是 有两个连接吗？那么每个客户端连过来，服务端都会分配一个新的端口作为和服务端的读写连接。那如果大量客户端断开，服务端是不是会有很多 time_wait的连接？","like_count":0},{"had_liked":false,"id":51280,"user_name":"caohuan","can_delete":false,"product_type":"c1","uid":1256428,"ip_address":"","ucode":"4B092E33F3DF1E","user_header":"https://static001.geekbang.org/account/avatar/00/13/2b/ec/af6d0b10.jpg","comment_is_top":false,"comment_ctime":1545145472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545145472","product_id":100007101,"comment_content":"本篇 所得：UDP基于 数据报，TCP基于数据流。<br>socket为服务端 与 客服端 之间的通讯插口。<br>为了提高 通讯的效率 可以采用多进程的方法 1.外包项目，创建多进程，每个进程 控制一个 项目 2.在进程中 创建 线程，用线程控制项目，节省资源 3.用线程调整项目，可以做到 共享资源，让 线程的项目组 控制 项目 4.把轮询 改为 主动 通知，节省需要 记录的资源。<br><br>回答老师的问题 2.http 是基于TCP&#47;IP的协议 封装的，他具有 get post put delete 等操作。<br>","like_count":0},{"had_liked":false,"id":50184,"user_name":"xy🥝","can_delete":false,"product_type":"c1","uid":1029430,"ip_address":"","ucode":"DA1EC0789071F0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/36/d444d19e.jpg","comment_is_top":false,"comment_ctime":1544888859,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544888859","product_id":100007101,"comment_content":"这一节看的不是很懂，请同学和老师们指教哈<br>1、为了解决资源的问题（文件描述符和内存）使用了多种方式，第一种子进程的方式是怎么减少文件描述和内存的呢？看文中的描述会复制父进程的文件描述符和内存空间，那就是没有减少呢？<br>","like_count":0},{"had_liked":false,"id":50178,"user_name":"xy🥝","can_delete":false,"product_type":"c1","uid":1029430,"ip_address":"","ucode":"DA1EC0789071F0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/36/d444d19e.jpg","comment_is_top":false,"comment_ctime":1544887250,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544887250","product_id":100007101,"comment_content":"老师，请问一下TCP客户端和服务端连接的图，为何客户端不需要调用bind?<br>但是UDP的客户端和服务端连接的图，客户端就调用了bind","like_count":0,"discussions":[{"author":{"id":1040236,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/df/6c/5af32271.jpg","nickname":"Dylan","note":"","ucode":"58064D0C9F9F5F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301934,"discussion_content":"有连接的socket客户端通过调用Connect函数在socket数据结构中保存本地和远端信息，无须调用bind()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598711036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47859,"user_name":"BUG君","can_delete":false,"product_type":"c1","uid":1143211,"ip_address":"","ucode":"B7513F37026E5F","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/ab/b19a1ba2.jpg","comment_is_top":false,"comment_ctime":1544238032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544238032","product_id":100007101,"comment_content":"socket编程是不是就意味着自己去实现应用层？","like_count":0},{"had_liked":false,"id":46425,"user_name":"likun","can_delete":false,"product_type":"c1","uid":1030816,"ip_address":"","ucode":"9145ED059CCC6D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/a0/f03d20cd.jpg","comment_is_top":false,"comment_ctime":1543922795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543922795","product_id":100007101,"comment_content":"超哥 你好 复习中 想问两个问题：<br>1:在内核中，为每个 Socket 维护两个队列。一个是已连接的连接，一个是SYN_RCVDE状态的连接，这里的每个Socket应该是指监听Socket吧？<br><br>2:关于select受限fd_set的大小和spoll受限进程能打开的最大文件的个数,也就是文件描述符的个数，我查了下源码：<br>typedef struct<br>  {<br>    &#47;* XPG4.2 requires this member name.  Otherwise avoid the name<br>       from the global namespace.  *&#47;<br>#ifdef __USE_XOPEN<br>    __fd_mask fds_bits[__FD_SETSIZE &#47; __NFDBITS];<br># define __FDS_BITS(set) ((set)-&gt;fds_bits)<br>#else<br>    __fd_mask __fds_bits[__FD_SETSIZE &#47; __NFDBITS];<br># define __FDS_BITS(set) ((set)-&gt;__fds_bits)<br>#endif<br>  } fd_set;<br><br>&#47;* The fd_set member is required to be an array of longs.  *&#47;<br>typedef long int __fd_mask;<br><br>&#47;* Some versions of &lt;linux&#47;posix_types.h&gt; define this macros.  *&#47;<br>#undef\t__NFDBITS<br>&#47;* It&#39;s easier to assume 8-bit bytes than to get CHAR_BIT.  *&#47;<br>#define __NFDBITS\t(8 * (int) sizeof (__fd_mask))<br><br><br>&#47;* Number of descriptors that can fit in an `fd_set&#39;.  *&#47;<br>#define __FD_SETSIZE\t\t1024<br><br>这里FD_SETSIZE的大小是1024吧？ 而fd_set的元素个数最多也是1024吗？感觉算出来不像，应该是会很小。然而epool能管理的最大文件描述个数一般系统默认也是1024，那这里select和epool的优劣怎么比较呢？是都按1024走呢？还是考虑select的fd_set的实际最大元素个数还是epool的进程能打开的最大文件个数的配置是可以更改的更大的？<br><br>希望超哥可以抽空解惑一下，小弟会高兴坏了的😄","like_count":0},{"had_liked":false,"id":36583,"user_name":"ttxser","can_delete":false,"product_type":"c1","uid":1022694,"ip_address":"","ucode":"47C3FCB59F8027","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9a/e6/e8439f9a.jpg","comment_is_top":false,"comment_ctime":1541162033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541162033","product_id":100007101,"comment_content":"这篇写的真好<br>","like_count":0},{"had_liked":false,"id":34875,"user_name":"茫农","can_delete":false,"product_type":"c1","uid":1206365,"ip_address":"","ucode":"71F7143644C9CB","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/5d/1ccee378.jpg","comment_is_top":false,"comment_ctime":1540344342,"is_pvip":false,"replies":[{"id":"12461","content":"没有啊，都是socket","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1540357054,"ip_address":"","comment_id":34875,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540344342","product_id":100007101,"comment_content":"epoll创建的是文件描述符，socket也是文件描述符，那上限应该是系统上限&#47;2?","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427371,"discussion_content":"没有啊，都是socket","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540357054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34092,"user_name":"我要买特斯拉","can_delete":false,"product_type":"c1","uid":1211991,"ip_address":"","ucode":"23C5F02B45CE39","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTItgf0Hgz7owHWooW6KXemEtyJ9HRIsPWnlJmibAIbcTMg8VYMiccYHTLIvPIBkzTFwHkN7QggH85eg/132","comment_is_top":false,"comment_ctime":1539999348,"is_pvip":false,"replies":[{"id":"12380","content":"一个已经建立连接，一个未建立连接","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1540290491,"ip_address":"","comment_id":34092,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539999348","product_id":100007101,"comment_content":"在内核中，为每个 Socket 维护两个队列。为什么是两个？","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427115,"discussion_content":"一个已经建立连接，一个未建立连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540290491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28018,"user_name":"CharlotteWu","can_delete":false,"product_type":"c1","uid":1227084,"ip_address":"","ucode":"66F15CD979E44E","user_header":"https://static001.geekbang.org/account/avatar/00/12/b9/4c/45691efa.jpg","comment_is_top":false,"comment_ctime":1537976042,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1537976042","product_id":100007101,"comment_content":"fork可能有三种不同的返回值：<br>在父进程中，fork返回新创建子进程的进程ID；<br>在子进程中，fork返回0；<br>如果出现错误，fork返回一个负值；","like_count":0},{"had_liked":false,"id":27052,"user_name":"zclau","can_delete":false,"product_type":"c1","uid":1066530,"ip_address":"","ucode":"EC86FB34BAE923","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/22/ef002dbd.jpg","comment_is_top":false,"comment_ctime":1537805790,"is_pvip":true,"replies":[{"id":"9828","content":"查找快","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1537863981,"ip_address":"","comment_id":27052,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1537805790","product_id":100007101,"comment_content":"老师您好，为什么epoll维护保存打开的socket要用红黑树这个数据结构呢，不是很明白","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424790,"discussion_content":"查找快","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537863981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2401422,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","nickname":"geek","note":"","ucode":"FF0845140D72A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576537,"discussion_content":"具体哪一步后会去查找呢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655636004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26411,"user_name":"星星.","can_delete":false,"product_type":"c1","uid":1223251,"ip_address":"","ucode":"A8A2C2762EF053","user_header":"https://static001.geekbang.org/account/avatar/00/12/aa/53/f55283cb.jpg","comment_is_top":false,"comment_ctime":1537589821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537589821","product_id":100007101,"comment_content":"文件描述符数组是每个进程一个还是整个操作系统一个？在文字和图中好像都没说清楚","like_count":0},{"had_liked":false,"id":26149,"user_name":"简","can_delete":false,"product_type":"c1","uid":1229332,"ip_address":"","ucode":"568BDA58B63801","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/14/bfd5e94e.jpg","comment_is_top":false,"comment_ctime":1537506262,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1537506262","product_id":100007101,"comment_content":"老师跪求回答，而 epoll 机制能解决 C10K 问题？我能这样理解不，一个进程好像是能打开1024个文件描述符，一万个链接，我开十个进程是不是就可以！","like_count":0,"discussions":[{"author":{"id":1102484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/94/c804f9a9.jpg","nickname":"木桑苏","note":"","ucode":"ACD493FFB8DFF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7083,"discussion_content":"不是的，是一个进程开启一万个文件描述符","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567345216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23909,"user_name":"saikida","can_delete":false,"product_type":"c1","uid":1228928,"ip_address":"","ucode":"9D4293CA7C9362","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/80/0c92e0b8.jpg","comment_is_top":false,"comment_ctime":1536716594,"is_pvip":false,"replies":[{"id":"8731","content":"如果没有端口，tcp包里的源端口没法填，中间的链路上没办法通过五元组标识一个连接，返回的结果不知道给哪个应用","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1536718794,"ip_address":"","comment_id":23909,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1536716594","product_id":100007101,"comment_content":"当客户端发起connect函数连接时候，内核为客户端分配临时端口，这临时端口是做什么用的?为什么需要内核分配临时端口？","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423777,"discussion_content":"如果没有端口，tcp包里的源端口没法填，中间的链路上没办法通过五元组标识一个连接，返回的结果不知道给哪个应用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536718794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20117,"user_name":"燃","can_delete":false,"product_type":"c1","uid":1137201,"ip_address":"","ucode":"59B23E8439A4C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/31/14f00b1c.jpg","comment_is_top":false,"comment_ctime":1534264248,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1534264248","product_id":100007101,"comment_content":"所谓多路复用，应该说明白是对于线程的多路复用，请问老师，java nio是否是这种线程多路复用？nio的出现也说明一个问题，那就是传统每链接每线程方式其实是极其低效的，大部分cpu内存都白白耗费在维护这些线程上了","like_count":0},{"had_liked":false,"id":18955,"user_name":"忆水寒","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1533616456,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533616456","product_id":100007101,"comment_content":"Windows下是IOCP机制吧……","like_count":0},{"had_liked":false,"id":18342,"user_name":"Roy","can_delete":false,"product_type":"c1","uid":1192998,"ip_address":"","ucode":"EBC15564D57C40","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/26/abcb00fd.jpg","comment_is_top":false,"comment_ctime":1533262463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533262463","product_id":100007101,"comment_content":"很棒！谢谢老师","like_count":0},{"had_liked":false,"id":15737,"user_name":"qpzm7903","can_delete":false,"product_type":"c1","uid":1138683,"ip_address":"","ucode":"C7C14962D34BE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/fb/af061ca7.jpg","comment_is_top":false,"comment_ctime":1531443122,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1531443122","product_id":100007101,"comment_content":"跳过tcp到这里，以后再补tcp","like_count":0},{"had_liked":false,"id":13308,"user_name":"^_^","can_delete":false,"product_type":"c1","uid":1122575,"ip_address":"","ucode":"30E994A1627EB1","user_header":"https://static001.geekbang.org/account/avatar/00/11/21/0f/b61dc67e.jpg","comment_is_top":false,"comment_ctime":1529538357,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1529538357","product_id":100007101,"comment_content":"老师好，请教个问题，<br>客户端和服务端建立好多个TCP连接后，比如多个浏览器窗口，后面客户端给服务端发送数据包时，服务端根据什么内容把数据包放到不同的TCP连接的缓存中","like_count":0},{"had_liked":false,"id":13170,"user_name":"CatTalk","can_delete":false,"product_type":"c1","uid":1057350,"ip_address":"","ucode":"353780AF4848D9","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/46/df595e4a.jpg","comment_is_top":false,"comment_ctime":1529420892,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1529420892","product_id":100007101,"comment_content":"有料，干货","like_count":0},{"had_liked":false,"id":12898,"user_name":"星文友","can_delete":false,"product_type":"c1","uid":1068162,"ip_address":"","ucode":"EE438B9C1C7B61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9RytLsauRVYGjupDIaibibAK5iaicEicONrMFc0O3icAGf5mD1buxoQ2ePPn9YurFhRbuf3AR1qJDy0GQ/132","comment_is_top":false,"comment_ctime":1529117878,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1529117878","product_id":100007101,"comment_content":"select由文件描述fd_set限制<br>epoll 由文件描述符数量限制 <br>两个差异很大吗","like_count":0},{"had_liked":false,"id":12787,"user_name":"沒結果的花","can_delete":false,"product_type":"c1","uid":1132671,"ip_address":"","ucode":"A12C39ED9CCC9C","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/7f/eff2c474.jpg","comment_is_top":false,"comment_ctime":1529029977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1529029977","product_id":100007101,"comment_content":"老师，项目手机端为了写tcp长链接要循环调用select,但是这样会造成cpu超负，请问老师有什么好的建议呢","like_count":0},{"had_liked":false,"id":12764,"user_name":"skye","can_delete":false,"product_type":"c1","uid":1027840,"ip_address":"","ucode":"C55C9F52C78A00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","comment_is_top":false,"comment_ctime":1529025451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1529025451","product_id":100007101,"comment_content":"select的多路复用中，如果socket 描述符集同时有多个socket发生变化，也是需要需要开多个线程处理吗？","like_count":0}]}