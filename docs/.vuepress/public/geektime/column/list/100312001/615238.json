{"id":615238,"title":"06 | å¦‚ä½•ä½¿ç”¨å‘½åç©ºé—´éš”ç¦»å›¢é˜ŸåŠåº”ç”¨ç¯å¢ƒï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚ä»Šå¤©æ˜¯æˆ‘ä»¬ K8s æç®€å®æˆ˜æ¨¡å—çš„ç¬¬ä¸€è¯¾ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å‘½åç©ºé—´éš”ç¦»å›¢é˜ŸåŠåº”ç”¨ç¯å¢ƒã€‚</p><p>éšç€å›¢é˜Ÿå’Œåº”ç”¨è§„æ¨¡çš„æ‰©å¤§ï¼Œæˆ‘ä»¬éƒ¨ç½²çš„ K8s èµ„æºä¼šè¶Šæ¥è¶Šå¤šï¼Œç®¡ç†å’Œç»„ç»‡è¿™äº›èµ„æºæˆä¸ºäº†é¦–å…ˆè¦é¢å¯¹çš„é—®é¢˜ã€‚å¦å¤–ï¼Œå½“æˆ‘ä»¬å¯¹åŒä¸€ä¸ªåº”ç”¨æœ‰å¤šå¥—ç¯å¢ƒè¯‰æ±‚æ—¶ï¼Œéœ€è¦æœ‰ä¸€ç§éš”ç¦»æœºåˆ¶èƒ½è®©æˆ‘ä»¬åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…éƒ¨ç½²å¤šä¸ªç›¸åŒåå­—çš„å·¥ä½œè´Ÿè½½ã€‚è€Œä¸”ï¼Œä¸åŒä¸šåŠ¡çš„å·¥ä½œè´Ÿè½½ä¼šç›¸äº’ç«äº‰èµ„æºï¼Œè¿™è¿›ä¸€æ­¥å¢åŠ äº†é›†ç¾¤ç®¡ç†çš„éš¾åº¦ã€‚</p><p>è¦è§£å†³ä¸Šé¢çš„è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªæ›´é«˜ç»´åº¦çš„æŠ½è±¡ã€‚æ— è®ºæ˜¯åœ¨åŒä¸€ä¸ªé›†ç¾¤éš”ç¦»å¤šå¥—ç¯å¢ƒï¼Œè¿˜æ˜¯éš”ç¦»ä¸åŒå›¢é˜Ÿçš„èµ„æºï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯å°†é›†ç¾¤è™šæ‹Ÿæˆå‡ ä¸ªéš”ç¦»çš„â€œå­é›†ç¾¤â€æ¥ä½¿ç”¨ã€‚è¿™ç§åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­æä¾›çš„è™šæ‹Ÿâ€œå­é›†ç¾¤â€çš„éš”ç¦»èƒ½åŠ›ï¼Œæˆ‘ä»¬ç§°ä¸ºå‘½åç©ºé—´ï¼ˆNamespaceï¼‰ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘è¿˜æ˜¯ä»å®æˆ˜çš„è§’åº¦å‡ºå‘ï¼Œä¸ºä½ è¯¦ç»†ä»‹ç» K8s æç®€å®æˆ˜æ¨¡å—ä¸­çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µï¼šå‘½åç©ºé—´ã€‚</p><p>åœ¨æ­£å¼å¼€å§‹è¯¾ç¨‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å·²ç»æŒ‰ç…§ä¸Šä¸€èŠ‚<a href=\"https://time.geekbang.org/column/article/614570\">â€œç¤ºä¾‹åº”ç”¨ä»‹ç»â€</a>çš„å¼•å¯¼åœ¨æœ¬åœ° Kind é›†ç¾¤éƒ¨ç½²äº†ç¤ºä¾‹åº”ç”¨ã€‚</p><h2>åˆè¯†å‘½åç©ºé—´</h2><h3>æ¶æ„å›¾</h3><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£å‘½åç©ºé—´ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å¯ä»¥æŠŠ K8s çš„å‘½åç©ºé—´æ¯”ä½œæ˜¯â€œå­é›†ç¾¤â€ã€‚äº‹å®ä¸Šï¼Œå‘½åç©ºé—´æ˜¯é›†ç¾¤çš„ä¸€ç§â€œè½¯éš”ç¦»â€æœºåˆ¶ï¼Œå®ƒé€šè¿‡è¿™ç§éš”ç¦»æœºåˆ¶ï¼Œä¸ºæˆ‘ä»¬ç®¡ç†å’Œç»„ç»‡é›†ç¾¤èµ„æºæä¾›äº†ä¾¿åˆ©ã€‚é›†ç¾¤å’Œå‘½åç©ºé—´çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/3c/46/3c2e2dd5efe97a3be126e48556510546.jpg?wh=1920x832\" alt=\"å›¾ç‰‡\"></p><p>ä¸åŒçš„å‘½åç©ºé—´å…·å¤‡ä¸€å®šçš„éš”ç¦»æ€§ï¼Œä¸šåŠ¡åº”ç”¨çš„å·¥ä½œè´Ÿè½½ä»¥åŠå…¶ä»–çš„ K8s å¯¹è±¡å¯ä»¥éƒ¨ç½²åœ¨ç‰¹å®šçš„å‘½åç©ºé—´ä¸­ï¼Œ<strong>åœ¨ä¸åŒå‘½åç©ºé—´ä¸­ï¼Œç›¸åŒç±»å‹çš„èµ„æºå¯ä»¥é‡å</strong>ã€‚åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé›†ç¾¤è™šæ‹Ÿçš„å‘½åç©ºé—´å’Œç°å®ä¸­çš„ä¸åŒå›¢é˜Ÿã€ä¸åŒåº”ç”¨åœ¨é€»è¾‘ä¸Šè”ç³»èµ·æ¥ã€‚</p><h3>åˆ›å»ºå’Œåˆ é™¤</h3><p>åœ¨ä¸€ä¸ª K8s é›†ç¾¤ä¸­ï¼Œå‘½åç©ºé—´å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šç³»ç»Ÿçº§å‘½åç©ºé—´å’Œç”¨æˆ·è‡ªå®šä¹‰å‘½åç©ºé—´ã€‚</p><p>ç³»ç»Ÿçº§çš„å‘½åç©ºé—´æ˜¯ K8s é›†ç¾¤é»˜è®¤åˆ›å»ºçš„å‘½åç©ºé—´ï¼Œä¸»è¦ç”¨æ¥éš”ç¦»ç³»ç»Ÿçº§çš„å¯¹è±¡å’Œä¸šåŠ¡å¯¹è±¡ï¼Œç³»ç»Ÿçº§çš„å‘½åç©ºé—´ä¸‹é¢å››ç§ã€‚</p><ol>\n<li>defaultï¼šé»˜è®¤å‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸æŒ‡å®šå‘½åç©ºé—´æ—¶çš„é»˜è®¤å‘½åç©ºé—´ã€‚</li>\n<li>kube-systemï¼šK8s ç³»ç»Ÿçº§ç»„ä»¶çš„å‘½åç©ºé—´ï¼Œæ‰€æœ‰ K8s çš„å…³é”®ç»„ä»¶ï¼ˆä¾‹å¦‚ kube-proxyã€corednsã€metric-server ç­‰ï¼‰éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸‹ã€‚</li>\n<li>kube-publicï¼šå¼€æ”¾çš„å‘½åç©ºé—´ï¼Œæ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬æœªç»è®¤è¯ï¼‰çš„ç”¨æˆ·éƒ½å¯ä»¥è¯»å–ï¼Œè¿™ä¸ªå‘½åç©ºé—´æ˜¯ä¸€ä¸ªçº¦å®šï¼Œä½†ä¸æ˜¯å¿…é¡»ã€‚</li>\n<li>kube-node-leaseï¼šå’Œé›†ç¾¤æ‰©å±•ç›¸å…³çš„å‘½åç©ºé—´ã€‚</li>\n</ol><p>åœ¨è¿™å‡ ä¸ªå‘½åç©ºé—´ä¸­ï¼Œé™¤äº† default å‘½åç©ºé—´ï¼Œä½ éƒ½ä¸åº”è¯¥å°†ä¸šåŠ¡åº”ç”¨éƒ¨ç½²åœ¨å…¶ä»–ç³»ç»Ÿé»˜è®¤åˆ›å»ºçš„å‘½åç©ºé—´ä¸‹ï¼Œä¹Ÿä¸è¦å°è¯•å»åˆ é™¤å®ƒä»¬ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤å¼‚å¸¸ã€‚</p><p>åœ¨ä¸€ä¸ª K8s é›†ç¾¤ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl get ns å‘½ä»¤æ¥æŸ¥çœ‹ K8s çš„å‘½åç©ºé—´ï¼š</p><pre><code class=\"language-powershell\">$ kubectl get ns\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;STATUS&nbsp; &nbsp;AGE\ndefault&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\nexample&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\ningress-nginx&nbsp; &nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\nkube-node-lease&nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\nkube-public&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\nkube-system&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Active&nbsp; &nbsp;16h\nlocal-path-storage&nbsp; &nbsp;Active&nbsp; &nbsp;16h\n</code></pre><p>ä»è¿”å›ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç¤ºä¾‹åº”ç”¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ exampleï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ Ingress-Nginx ä¹Ÿåˆ›å»ºäº†è‡ªå·±ä¸“å±çš„å‘½åç©ºé—´ã€‚</p><p>æ­¤å¤–ï¼Œè¦è·å– Namespace çš„è¯¦æƒ…ï¼Œä¾‹å¦‚è·å–å‘½åç©ºé—´çº§åˆ«çš„èµ„æºé…é¢ç­‰è¯¦ç»†ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl describe namespace å‘½ä»¤ï¼š</p><pre><code class=\"language-yaml\">$ kubectl describe namespace example\nName:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;example\nLabels:&nbsp; &nbsp; &nbsp; &nbsp;kubernetes.io/metadata.name=example\nAnnotations:&nbsp; &lt;none&gt;\nStatus:&nbsp; &nbsp; &nbsp; &nbsp;Active\n\nNo resource quota.\n\nNo LimitRange resource.\n</code></pre><p>è¦åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl create namespace å‘½ä»¤ï¼š</p><pre><code class=\"language-powershell\">$ kubectl create namespace my-namespace\nnamespace/my-namespace created\n</code></pre><p>æ³¨æ„ï¼Œå‘½åç©ºé—´çš„åå­—éœ€è¦ç¬¦åˆ DNS-1123 è§„èŒƒï¼Œå…¶ä¸­æœ€é‡è¦çš„ç‚¹æ˜¯å­—æ¯åªæ”¯æŒå°å†™ï¼Œå¦å¤–é™¤äº†ç‰¹æ®Šå­—ç¬¦â€œ-â€ä»¥å¤–ï¼Œå…¶ä»–ä»»ä½•ç‰¹æ®Šå­—ç¬¦éƒ½æ— æ³•ä½¿ç”¨ã€‚å½“ä½ å°è¯•åˆ›å»ºä¸€ä¸ªä¸ç¬¦åˆè§„èŒƒçš„å‘½åç©ºé—´æ—¶ï¼ŒK8s å°†è¿”å›é”™è¯¯ï¼š</p><pre><code class=\"language-powershell\">$ kubectl create namespace my.namespace\nThe Namespace \"my.namespace\" is invalid: metadata.name: Invalid value: \"my.namespace\": a lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',&nbsp; or '123-abc', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?')\n</code></pre><p>é™¤äº†ä½¿ç”¨ kubectl create namespace å‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ K8s Manifest æ¥åˆ›å»ºå‘½åç©ºé—´ï¼Œä½ éœ€è¦å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º namespace.yamlï¼š</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Namespace\nmetadata:\n  name: example\n</code></pre><p>ä½¿ç”¨ kubectl apply -f namespace.yaml å‘½ä»¤åº”ç”¨è¿™æ®µ Manifestï¼Œå®ƒçš„æ•ˆæœå’Œ kubectl create namespace æ˜¯ä¸€æ ·çš„ã€‚</p><p>æœ€åï¼Œè¦åˆ é™¤å‘½åç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ kubectl delete namespace å‘½ä»¤ï¼š</p><pre><code class=\"language-yaml\">$ kubectl delete namespace my-namespace\nnamespace \"my-namespace\" deleted\n</code></pre><p>åˆ é™¤å‘½åç©ºé—´å°†ä¼šåˆ é™¤è¯¥å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰èµ„æºï¼Œæ‰€ä»¥åœ¨å®é™…é¡¹ç›®ä¸­è¯·è°¨æ…æ“ä½œã€‚å¦å¤–ï¼Œç”±äºåˆ é™¤åŠ¨ä½œæ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤åˆ é™¤ä¸­çš„å‘½åç©ºé—´çŠ¶æ€ä¼šç”±æ­£å¸¸çš„ Active è½¬å˜ä¸º Terminatingï¼Œä¹Ÿå°±æ˜¯â€œç»ˆæ­¢ä¸­çš„çŠ¶æ€â€ã€‚</p><h3>å¦‚ä½•ä½¿ç”¨</h3><p>æŒæ¡äº†å‘½åç©ºé—´çš„åˆ›å»ºå’Œåˆ é™¤ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å­¦ä¹ <strong>å¦‚ä½•ä½¿ç”¨å‘½åç©ºé—´</strong>ã€‚</p><p>é¦–å…ˆï¼Œè¦å°† K8s å¯¹è±¡éƒ¨ç½²åœ¨æˆ‘ä»¬æŒ‡å®šçš„å‘½åç©ºé—´ä¸‹ï¼Œä½ å¯ä»¥åœ¨èµ„æºçš„ Manifest ä¸­è®¾ç½® Namespace å­—æ®µï¼Œä»¥ç¤ºä¾‹åº”ç”¨çš„å‰ç«¯ Deployment å·¥ä½œè´Ÿè½½ä¸ºä¾‹ï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend\n  namespace: example   # è®¾ç½® namesapce\n  labels:\n    app: frontend\nspec:\n  ......\n</code></pre><p>ä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œmetadata.namespace å­—æ®µçš„å€¼ä¸º exampleï¼Œè¿™æ„å‘³ç€è¯¥èµ„æºå°†éƒ¨ç½²åœ¨æŒ‡å®š example å‘½åç©ºé—´ä¸‹ã€‚ç›¸åï¼Œå¦‚æœä¸æŒ‡å®šè¯¥å­—æ®µï¼Œèµ„æºå°±ä¼šè¢«éƒ¨ç½²åˆ° default å‘½åç©ºé—´ä¸‹ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§æŒ‡å®šèµ„æºå‘½åç©ºé—´çš„æ–¹æ³•ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸ŠèŠ‚è¯¾æ˜¯æ€ä¹ˆæŠŠç¤ºä¾‹åº”ç”¨éƒ¨ç½²åˆ°é›†ç¾¤çš„å—ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ kubectl apply -n å‚æ•°æŒ‡å®šå‘½åç©ºé—´ï¼š</p><pre><code class=\"language-yaml\">$ kubectl apply -f deploy -n example\n</code></pre><p>è¿™ç§æ–¹æ³•å¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šæ‰€æœ‰éƒ¨ç½² K8s èµ„æºçš„å‘½åç©ºé—´ï¼Œ<strong>è¿™æ˜¯ä¸€ç§æ›´åŠ å¸¸ç”¨çš„æ–¹æ¡ˆã€‚</strong></p><p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸ºèµ„æºæŒ‡å®šé default å‘½åç©ºé—´æ—¶ï¼Œéœ€è¦ç¡®ä¿è¿™ä¸ªå‘½åç©ºé—´å·²ç»å­˜åœ¨ï¼Œå¦åˆ™ K8s å°†ä¼šè¿”å›é”™è¯¯ã€‚</p><p>é‚£ä¹ˆï¼Œç­‰æˆ‘ä»¬æŠŠèµ„æºéƒ¨ç½²åˆ°ç‰¹å®šçš„å‘½åç©ºé—´ä¹‹åï¼Œ<strong>å¦‚ä½•æŸ¥çœ‹å®ƒä»¬å‘¢ï¼Ÿ</strong></p><p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æ˜¯æ€ä¹ˆæŸ¥çœ‹ Deployment å·¥ä½œè´Ÿè½½çš„å—ï¼Ÿä¹‹å‰çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ kubectl get deployment å‘½ä»¤ï¼Œè¿™æ¡å‘½ä»¤å®é™…ä¸Šçœç•¥äº†å‘½åç©ºé—´çš„å‚æ•°ï¼Œå®Œæ•´çš„å‘½ä»¤åº”è¯¥æ˜¯ï¼š</p><pre><code class=\"language-yaml\">$ kubectl get deployment -n defaultã€‚\n</code></pre><p>ç”±äº default æ˜¯é»˜è®¤çš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨éƒ¨ç½²ã€åˆ é™¤å’ŒæŸ¥çœ‹ K8s å¯¹è±¡æ—¶æ²¡æœ‰æŒ‡å®šå‘½åç©ºé—´ï¼Œå°±ä¼šé»˜è®¤éƒ½æŒ‡å‘ defaultã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦æŸ¥çœ‹é default å‘½åç©ºé—´ä¸‹çš„å·¥ä½œè´Ÿè½½ï¼Œè‡ªç„¶å°±éœ€è¦æŒ‡å®šå‘½åç©ºé—´äº†ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹ç¤ºä¾‹åº”ç”¨æ‰€åœ¨çš„ example å‘½åç©ºé—´ä¸‹æ‰€æœ‰ Deployment å·¥ä½œè´Ÿè½½ï¼š</p><pre><code class=\"language-yaml\">$ kubectl get deployment -n example\nNAME&nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;UP-TO-DATE&nbsp; &nbsp;AVAILABLE&nbsp; &nbsp;AGE\nbackend&nbsp; &nbsp; 2/2&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;17h\nfrontend&nbsp; &nbsp;2/2&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;17h\npostgres&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;17h\n</code></pre><h2>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‘½åç©ºé—´ï¼Ÿ</h2><p>å¯¹äºä¸€äº›å°å‹å›¢é˜Ÿæˆ–è€…å°å‹åº”ç”¨ï¼Œç›´æ¥ä½¿ç”¨ default ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚ä¸è¿‡ï¼Œå½“ä½ æœ‰ä¸‹é¢çš„éœ€æ±‚æ—¶ï¼Œæˆ‘å»ºè®®ä½ è€ƒè™‘ä½¿ç”¨å‘½åç©ºé—´ã€‚</p><ul>\n<li><strong>ç¯å¢ƒç®¡ç†</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´æ¥éš”ç¦»å¼€å‘ç¯å¢ƒã€é¢„å‘å¸ƒç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚ä¾‹å¦‚ç”¨ devã€stagingã€prod å‘½åç©ºé—´æ¥åŒºåˆ†è¿™ä¸‰ä¸ªç¯å¢ƒã€‚å‘½åç©ºé—´çš„éš”ç¦»ç‰¹æ€§å¯ä»¥è®©å¼€å‘ç¯å¢ƒçš„çš„æ“ä½œä¸ä¼šå½±å“åˆ°å…¶ä»–ç¯å¢ƒçš„å·¥ä½œã€‚å®é™…ä¸Šï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘æ›´å»ºè®®ä½¿ç”¨ä¸åŒçš„é›†ç¾¤è¿›è¡Œç¡¬éš”ç¦»ï¼Œå‘½åç©ºé—´çš„éš”ç¦»æ–¹å¼åªæ˜¯ä¸€ç§é€‰æ‹©ã€‚</li>\n<li><strong>éš”ç¦»ï¼š</strong>å½“ä½ æœ‰å¤šä¸ªå›¢é˜Ÿï¼Œæˆ–è€…å¤šä¸ªäº§å“çº¿è¿è¡Œåœ¨åŒä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½åç©ºé—´æ¥éš”ç¦»è¿™äº›å›¢é˜Ÿæˆ–è€…äº§å“çº¿ï¼Œè®©ä»–ä»¬ç›¸äº’ä¹‹é—´ä¸å—å½±å“ã€‚ä½ ç”šè‡³å¯ä»¥ä¸ºæ¯ä¸€ä¸ªå¼€å‘åˆ†é…ä¸€ä¸ªå‘½åç©ºé—´ï¼Œè®©ä»–ä»¬ç‹¬ç«‹è¿›è¡Œå¼€å‘å·¥ä½œã€‚</li>\n<li><strong>èµ„æºæ§åˆ¶ï¼š</strong>ä½ å¯ä»¥åœ¨å‘½åç©ºé—´çº§åˆ«é…ç½® CPUã€å†…å­˜ç­‰èµ„æºé…é¢ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥ä¸ºæŸä¸ªå›¢é˜Ÿæˆ–è€…æŸæ¡ä¸šåŠ¡çº¿è®¾ç½®æ€»çš„èµ„æºé…é¢ï¼Œè€Œä¸éœ€è¦å…³æ³¨ä»–ä»¬å…·ä½“åœ¨æ¯ä¸€ä¸ªå·¥ä½œè´Ÿè½½ä¸Šæ€ä¹ˆåˆ†é…è¿™äº›èµ„æºã€‚æ­¤å¤–ï¼Œå‘½åç©ºé—´çš„èµ„æºé…é¢è¿˜èƒ½å¤Ÿåˆç†ç¡®ä¿æ¯ä¸€ä¸ªé¡¹ç›®æ‰€éœ€è¦çš„èµ„æºé…é¢ï¼Œé¿å…å‡ºç°èµ„æºæ¶æ€§ç«äº‰å¯¼è‡´ä¸šåŠ¡ä¸ç¨³å®šçš„æƒ…å†µã€‚</li>\n<li><strong>æƒé™æ§åˆ¶</strong>ï¼šK8s çš„ RBAC å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹æŸä¸ªç”¨æˆ·ä»…æˆæƒä¸€ä¸ªæˆ–è€…å¤šä¸ªå‘½åç©ºé—´ï¼Œç¡®ä¿åªæœ‰ç‰¹å®šçš„ç”¨æˆ·èƒ½è®¿é—®ç‰¹å®šå‘½åç©ºé—´ä¸‹çš„èµ„æºã€‚</li>\n<li><strong>æé«˜é›†ç¾¤æ€§èƒ½ï¼š</strong>å‘½åç©ºé—´æœ‰åˆ©äºæé«˜é›†ç¾¤æ€§èƒ½ã€‚åœ¨è¿›è¡Œèµ„æºæœç´¢æ—¶ï¼Œå‘½åç©ºé—´æœ‰åˆ©äº K8s API ç¼©å°æŸ¥æ‰¾èŒƒå›´ï¼Œå¯¹å‡å°æœç´¢å»¶è¿Ÿå’Œæå‡æ€§èƒ½å…·æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚</li>\n</ul><h2>å¦‚ä½•è·¨å‘½åç©ºé—´é€šä¿¡ï¼Ÿ</h2><p>åœ¨ä½¿ç”¨å‘½åç©ºé—´éš”ç¦»èµ„æºä¹‹åï¼Œå°±ä¼šæ¶‰åŠåˆ°å¦‚ä½•é€šä¿¡çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¹‹å‰è¯´å‘½åç©ºé—´æ˜¯ä¸€ç§â€œè½¯éš”ç¦»â€æœºåˆ¶ï¼Œæ—¢ç„¶æ˜¯è½¯éš”ç¦»ï¼Œé‚£ä¹ˆä¸åŒå‘½åç©ºé—´å®Œå…¨æ˜¯å¯ä»¥ç›¸äº’é€šä¿¡çš„ã€‚</p><p>å½“ K8s åˆ›å»º Service æ—¶ï¼Œä¼šåˆ›å»ºç›¸åº”çš„ DNS è§£æè®°å½•ï¼Œæ ¼å¼ä¸ºï¼š<code>&lt;service-name&gt;.&lt;namespace-name&gt;.svc.cluster.local</code>ã€‚å½“ä¸šåŠ¡å®¹å™¨éœ€è¦å’Œ<strong>å½“å‰å‘½åç©ºé—´</strong>ä¸‹å…¶ä»–æœåŠ¡é€šä¿¡æ—¶ï¼Œåˆ™å¯ä»¥çœç•¥ <code>&lt;namespace-name&gt;.svc.cluster.local</code>ï¼Œä¹Ÿå°±æ˜¯ç¼©å†™ä¸º <code>&lt;service-name&gt;</code> å°±å¯ä»¥äº†ã€‚</p><p>åŒç†ï¼Œè¦è·¨ä¸åŒçš„å‘½åç©ºé—´é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šå®Œæ•´çš„ Service URL æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œè¦è®¿é—® dev å‘½åç©ºé—´ä¸‹çš„ backend-serviceï¼Œå®Œæ•´çš„ URL ä¸ºï¼š</p><pre><code class=\"language-yaml\">backend-service.dev.svc.cluster.lcoal\n</code></pre><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡é…ç½® K8s çš„ç½‘ç»œç­–ç•¥æ¥é™åˆ¶è¿™ç§è®¿é—®æ–¹å¼ã€‚</p><h2>å¦‚ä½•è§„åˆ’å‘½åç©ºé—´ï¼Ÿ</h2><p>åˆç†çš„å‘½åç©ºé—´è§„åˆ’å¯ä»¥è®©èµ„æºç®¡ç†å˜å¾—æ›´åŠ è½»æ¾ï¼Œå‘½åç©ºé—´å¯ä»¥å¯¹åº”åˆ°ç°å®ä¸­ä¸åŒçš„éš”ç¦»é€»è¾‘ï¼Œä¾‹å¦‚é€šè¿‡å‘½åç©ºé—´æ¥åŒºåˆ†ç¯å¢ƒã€åŒºåˆ†ä¸šåŠ¡å›¢é˜Ÿã€åŒºåˆ†ä¸šåŠ¡ç”¨é€”ç­‰ç­‰ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚ä½•åˆç†åœ°è§„åˆ’å‘½åç©ºé—´æ˜¯æˆ‘ä»¬åˆšå¼€å§‹ä½¿ç”¨ K8s å°±è¦è€ƒè™‘çš„é—®é¢˜ã€‚K8s å‘½åç©ºé—´åªæä¾›ä¸€ç§ç»„ç»‡æ–¹å¼ï¼Œåœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å›¢é˜Ÿæƒ…å†µã€ç»„ç»‡æ¶æ„ã€ä¸šåŠ¡çº¿ç­‰ç»´åº¦æ¥è¿›è¡Œåˆ’åˆ†ã€‚</p><p>ä¸ºäº†èƒ½è®©ä½ åœ¨å®é™…çš„å·¥ä½œä¸­ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä¸ºä½ æ€»ç»“äº†ä»¥ä¸‹å‡ ç§ K8s å‘½åç©ºé—´è§„åˆ’æ–¹æ¡ˆã€‚</p><h3>å•ä¸€ä¸šåŠ¡åº”ç”¨å’Œå›¢é˜Ÿ</h3><p>å½“å›¢é˜Ÿè§„æ¨¡åœ¨å‡ äººåˆ°åå‡ äººï¼Œä¸šåŠ¡åº”ç”¨åªæœ‰ 1-2 ä¸ªæ—¶ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹å›¾è¿™ç§å‘½åç©ºé—´çš„è§„åˆ’æ–¹æ¡ˆï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/02/eb/02900126d336cc80b5605533f0e084eb.jpg?wh=1920x952\" alt=\"å›¾ç‰‡\"></p><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å°† K8s é›†ç¾¤åˆ’åˆ†ä¸º 3 ä¸ªå‘½åç©ºé—´ï¼Œåˆ†åˆ«æ˜¯ devã€testing å’Œ prodã€‚</p><ul>\n<li>devï¼šå¼€å‘ç¯å¢ƒï¼Œç”¨äºå¼€å‘äººå‘˜æ—¥å¸¸å¼€å‘ã€‚</li>\n<li>testingï¼šæµ‹è¯•ç¯å¢ƒï¼Œç”¨äºè´¨é‡äººå‘˜è¿›è¡Œæµ‹è¯•å·¥ä½œã€‚</li>\n<li>prodï¼šç”Ÿäº§ç¯å¢ƒï¼Œç”¨äºå¯¹å¤–æä¾›ç”Ÿäº§æœåŠ¡ã€‚</li>\n</ul><p>æ³¨æ„ï¼Œä¸ºäº†è®© K8s Manifest èƒ½éƒ¨ç½²åˆ°å¤šä¸ªå‘½åç©ºé—´ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ç›´æ¥åœ¨ Manifest çš„ Namespace å­—æ®µé‡ŒæŒ‡å®šå‘½åç©ºé—´ï¼Œè€Œæ˜¯åœ¨å®é™…éƒ¨ç½²æ—¶æŒ‡å®šå‘½åç©ºé—´ï¼š</p><pre><code class=\"language-yaml\">$ kubectl apply -f deploy -n dev\ndeployment.apps/backend created\n......\nError from server (BadRequest): error when creating \"deploy/ingress.yaml\": admission webhook \"validate.nginx.ingress.kubernetes.io\" denied the request: host \"_\" and path \"/?(.*)\" is already defined in ingress example/frontend-ingress\n</code></pre><p>ä¸Šé¢è¿™æ®µå‘½ä»¤ï¼Œå®é™…ä¸Šæ˜¯å°†ç¤ºä¾‹åº”ç”¨éƒ¨ç½²åˆ°äº†ä¸€ä¸ªæ–°çš„ dev å‘½åç©ºé—´é‡Œã€‚ä¸è¿‡åœ¨ä½ æ‰§è¡Œæ—¶ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹è®¾ç½®äº†ç›¸åŒçš„ Ingress ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶å¿½ç•¥å®ƒã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œ<strong>ä¸åŒç¯å¢ƒçš„è®¿é—®åŸŸåæ˜¯ä¸åŒçš„</strong>ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™æ ·ï¼Œå½“éœ€è¦å°†åº”ç”¨éƒ¨ç½²åˆ° QA ç¯å¢ƒæ—¶ï¼Œåªéœ€è¦å°† -n å‚æ•°æ›¿æ¢ä¸º testing å³å¯ï¼š</p><pre><code class=\"language-yaml\">$ kubectl apply -f deploy -n testing\n</code></pre><p>æœ€åï¼Œå†å°†åº”ç”¨éƒ¨ç½²åˆ° Prod ç”Ÿäº§ç¯å¢ƒï¼Œè¿™æ ·å°±å®Œæˆäº†åº”ç”¨ä»å¼€å‘ã€æµ‹è¯•åˆ°ä¸Šçº¿çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚</p><h3>å¤šä¸šåŠ¡åº”ç”¨å’Œå›¢é˜Ÿ</h3><p>åœ¨å¤§å‹çš„ç»„ç»‡æ¶æ„ä¸‹ï¼Œå¾€å¾€ä¼šæœ‰å¤šä¸ªä¸šåŠ¡åº”ç”¨å’Œå¤šä¸ªå›¢é˜Ÿç»„æˆï¼Œä»–ä»¬å¼€å‘çš„å¯èƒ½æ˜¯åŒä¸€ä¸ªå¤§å‹ä¸šåŠ¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ç‹¬ç«‹çš„åº”ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å»ºè®®ä½ å°†å›¢é˜Ÿå’Œå‘½åç©ºé—´å…³è”èµ·æ¥ï¼Œå¹¶ä¸”åœ¨åŒºåˆ†ç¯å¢ƒæ—¶ä½¿ç”¨ä¸åŒçš„é›†ç¾¤ï¼Œå…·ä½“è§„åˆ’æ–¹æ¡ˆå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/yy/30/yye5762a3a5aafbd66a506c2b54ddf30.jpg?wh=1920x2022\" alt=\"å›¾ç‰‡\"></p><p>è¿™ä¸ªæ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ï¼Œdevã€testingã€prod ç¯å¢ƒåˆ†åˆ«ç”¨äº† 3 ä¸ªç‹¬ç«‹çš„é›†ç¾¤ï¼Œç„¶åä¼šåœ¨æ¯ä¸€ä¸ªé›†ç¾¤ä¸­ä¸ºæ¯ä¸ªç‹¬ç«‹çš„å›¢é˜Ÿåˆ†é…ä¸€ä¸ªå‘½åç©ºé—´ï¼Œè®©å›¢é˜Ÿå’Œç¯å¢ƒä¹‹é—´ç›¸äº’éš”ç¦»ã€‚å½“ç„¶ï¼Œå¦‚æœä¸åŒçš„å›¢é˜Ÿå¼€å‘çš„æ˜¯åŒä¸€ä¸ªä¸šåŠ¡ï¼Œç›¸å½“äºåªæ˜¯ç»™ä¸šåŠ¡åšäº†å¾®æœåŠ¡çš„æ‹†åˆ†ï¼Œé‚£ä¹ˆåœ¨ testing å’Œ prod ç¯å¢ƒå°±ä¸éœ€è¦å†åˆ’åˆ†ç‹¬ç«‹å‘½åç©ºé—´ï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªå‘½åç©ºé—´å°†æ‰€æœ‰å¾®æœåŠ¡æ±‡æ€»éƒ¨ç½²èµ·æ¥å³å¯ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘é€šè¿‡æ·±å…¥ä»‹ç»ç¤ºä¾‹åº”ç”¨ï¼Œåˆ†äº«äº† K8s Namespace çš„æ¦‚å¿µåŠå…¶ç”¨æ³•ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥çœ‹å’Œåˆ é™¤å‘½åç©ºé—´ã€‚å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸ºèµ„æºæŒ‡å®šéƒ¨ç½²çš„å‘½åç©ºé—´æ—¶ï¼Œå¯ä»¥åœ¨ Manifest æŒ‡å®šæˆ–è€…ä½¿ç”¨ kubectl apply -n æŒ‡å®šå‘½åç©ºé—´ã€‚</p><p>å‘½åç©ºé—´æ˜¯ K8s ä¸­æä¾›ç±»ä¼¼äºâ€œå¤šç§Ÿæˆ·â€åŠŸèƒ½çš„ä¸€ä¸ªè®¾è®¡ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç§Ÿæˆ·çš„èµ„æºåˆ’åˆ†åˆ°å¯¹åº”çš„å‘½åç©ºé—´ä¸­ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ¯ä¸ªç§Ÿæˆ·çš„èµ„æºæ˜¯éš”ç¦»çš„ã€‚</p><p>åŸºäºå‘½åç©ºé—´çš„ç‰¹æ€§ï¼Œæˆ‘è¿˜ä»‹ç»äº†ä¸šåŠ¡åº”ç”¨å¦‚ä½•è·¨å‘½åç©ºé—´è¿›è¡Œé€šä¿¡ï¼Œå®ƒæ˜¯é€šè¿‡å®Œæ•´çš„ Service URL æ¥å®ç°çš„ã€‚</p><p>æœ€åï¼Œä¸ºäº†è®©ä½ åœ¨å·¥ä½œä¸­æ›´å¥½åœ°è§„åˆ’å‘½åç©ºé—´ï¼Œæˆ‘ä¸ºä½ ä¸¾äº†ä¸¤ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ï¼Œåœ¨ä¸åŒè§„æ¨¡çš„ç»„ç»‡ä¸‹å¦‚ä½•å¯¹å‘½åç©ºé—´è¿›è¡Œåˆ†é…å’Œç®¡ç†ã€‚</p><p>K8s çš„å‘½åç©ºé—´åœ¨é›†ç¾¤çºµå‘ç»´åº¦ä¸Šçœ‹æ˜¯æœ€å¤–å±‚çš„æ¦‚å¿µï¼Œåœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨çš„é¢‘ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå¸Œæœ›ä½ èƒ½å¤šèŠ±ä¸€äº›æ—¶é—´æŒæ¡å®ƒã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>ç»“åˆä½ å¯¹å‘½åç©ºé—´çš„ç†è§£ä»¥åŠå›¢é˜Ÿç°çŠ¶ï¼Œä½ ä¼šé‡‡ç”¨ä»€ä¹ˆæ ·çš„å‘½åç©ºé—´è§„åˆ’æ–¹å¼å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"05ï½œK8s æç®€å®æˆ˜ï¼šç¤ºä¾‹åº”ç”¨ä»‹ç»","id":614570},"right":{"article_title":"07ï½œK8s æç®€å®æˆ˜ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä¸ºä¸šåŠ¡é€‰æ‹©æœ€é€‚åˆçš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼Ÿ","id":616095}},"comments":[{"had_liked":false,"id":364832,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"å¹¿ä¸œ","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1671583702,"is_pvip":true,"replies":[{"id":132856,"content":"éå¸¸æ£’çš„ç¯å¢ƒéš”ç¦»å®è·µï¼å¼€å‘ç¯å¢ƒç¡¬éš”ç¦»æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºå®ƒçš„å˜åŠ¨æœ€é¢‘ç¹ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æˆå‘˜éƒ½æœ‰è®¿é—®æƒé™ï¼Œå®¹æ˜“å‡ºç°äººä¸ºæ•…éšœã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1671589919,"ip_address":"å¹¿ä¸œ","comment_id":364832,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ä»¬å›¢é˜Ÿè§„æ¨¡é‡‡ç”¨å‘½åç©ºé—´åŒºåˆ†å„ç§ç¯å¢ƒæ˜¯å®Œå…¨è¶³å¤Ÿçš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„é›†ç¾¤å¯èƒ½ä¼šç»å¸¸è¿›è¡Œä¸€äº›ä¸šåŠ¡åº”ç”¨å’Œå®¹å™¨çš„æ–°ç‰¹æ€§è°ƒè¯•ï¼Œè€ƒè™‘å‘½åç©ºé—´åªèƒ½æä¾›è½¯éš”ç¦»ï¼Œä»¥åŠdevç¯å¢ƒä¸èƒ½å½±å“çº¿ä¸Šç¯å¢ƒçš„åŸåˆ™ï¼Œæˆ‘ä»¬é¢„å‘å¸ƒå’Œç”Ÿäº§æ˜¯åŒä¸€ä¸ªé›†ç¾¤ï¼Œé€šè¿‡å‘½åç©ºé—´éš”ç¦»ï¼Œdevåˆ™æ˜¯å•ç‹¬çš„å°é›†ç¾¤","like_count":8,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597254,"discussion_content":"éå¸¸æ£’çš„ç¯å¢ƒéš”ç¦»å®è·µï¼å¼€å‘ç¯å¢ƒç¡¬éš”ç¦»æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºå®ƒçš„å˜åŠ¨æœ€é¢‘ç¹ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æˆå‘˜éƒ½æœ‰è®¿é—®æƒé™ï¼Œå®¹æ˜“å‡ºç°äººä¸ºæ•…éšœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671589919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364835,"user_name":"Jack He","can_delete":false,"product_type":"c1","uid":1925290,"ip_address":"å¹¿ä¸œ","ucode":"764DDB1A1A0731","user_header":"https://static001.geekbang.org/account/avatar/00/1d/60/aa/c41d6104.jpg","comment_is_top":false,"comment_ctime":1671589043,"is_pvip":false,"replies":[{"id":132862,"content":"æŠŠå…³é”®ä¿¡æ¯å†™åˆ°å‘½åç©ºé—´çš„åå­—é‡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„å®è·µğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1671600740,"ip_address":"å¹¿ä¸œ","comment_id":364835,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ä»¬æ˜¯nså‘½åè§„åˆ™ï¼šã€ç¯å¢ƒã€‘-ã€ä¸šåŠ¡çº¿ã€‘","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597275,"discussion_content":"æŠŠå…³é”®ä¿¡æ¯å†™åˆ°å‘½åç©ºé—´çš„åå­—é‡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„å®è·µğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671600740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366650,"user_name":"$ä¾¯","can_delete":false,"product_type":"c1","uid":1019939,"ip_address":"æµ™æ±Ÿ","ucode":"488B1BD3924E7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","comment_is_top":false,"comment_ctime":1674013212,"is_pvip":false,"replies":[{"id":133927,"content":"æ„Ÿè°¢æŒ‡æ­£~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1675416996,"ip_address":"å¹¿ä¸œ","comment_id":366650,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"kuebctl apply -f deploy -n dev\n\nkubectl æ‰“æˆäº† kuebctl ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601834,"discussion_content":"æ„Ÿè°¢æŒ‡æ­£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675416997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366372,"user_name":"éƒ‘æµ·æˆ","can_delete":false,"product_type":"c1","uid":1192616,"ip_address":"åŒ—äº¬","ucode":"B0363EA4B2C646","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg","comment_is_top":false,"comment_ctime":1673655158,"is_pvip":true,"replies":[{"id":133499,"content":"è¿™ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¥½çš„å®è·µğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673668863,"ip_address":"å¹¿ä¸œ","comment_id":366372,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ä»¬å›¢é˜Ÿè™½ç„¶æ¯”è¾ƒå°ï¼Œä½†æ˜¯ç¯å¢ƒçš„éš”ç¦»è¿˜æ˜¯ä½¿ç”¨ä¸åŒçš„é›†ç¾¤ï¼Œå•ä¸ªé›†ç¾¤å†…é‡‡ç”¨å‘½åç©ºé—´æ¥åŒºåˆ†ä¸åŒçš„ä¸šåŠ¡çº¿","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599650,"discussion_content":"è¿™ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¥½çš„å®è·µğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673668863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365384,"user_name":"è¤”å°‡","can_delete":false,"product_type":"c1","uid":1626492,"ip_address":"å¹¿ä¸œ","ucode":"A26C280F1F5649","user_header":"https://static001.geekbang.org/account/avatar/00/18/d1/7c/201b18b8.jpg","comment_is_top":false,"comment_ctime":1672402909,"is_pvip":false,"replies":[{"id":133085,"content":"çœ‹èµ·æ¥æ˜¯å’Œä¸šåŠ¡å¾ˆåŒ¹é…çš„ä¸€ç§åˆ†é…æ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672457069,"ip_address":"å¹¿ä¸œ","comment_id":365384,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ä»¬çš„ä¸šåŠ¡çº¿å¯¹æ•°æ®éå¸¸æ•æ„Ÿ æ¯ä¸ªç‰ˆæœ¬çš„æ•°æ®éƒ½éœ€è¦æµ‹è¯• æ¯ä¸€æ¬¡éƒ½è¦å‡†å¤‡å¤šä»½æ•°æ® æ›´é€‚åˆæŒ‰æ•°æ®çš„ç‰ˆæœ¬åˆ†é…å‘½åç©ºé—´ èƒ½å¾—åˆ°æ›´é«˜çš„å¤ç”¨","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598033,"discussion_content":"çœ‹èµ·æ¥æ˜¯å’Œä¸šåŠ¡å¾ˆåŒ¹é…çš„ä¸€ç§åˆ†é…æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672457069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365050,"user_name":"çƒŸç«ä¸å ","can_delete":false,"product_type":"c1","uid":1149539,"ip_address":"å¹¿ä¸œ","ucode":"BEEE3173C66E5F","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/63/a5fda84d.jpg","comment_is_top":false,"comment_ctime":1672038725,"is_pvip":false,"replies":[{"id":132919,"content":"ä¹Ÿæ˜¯ä¸€ç§éå¸¸ä¸é”™çš„å®è·µğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672047226,"ip_address":"å¹¿ä¸œ","comment_id":365050,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘ä»¬æ˜¯ä¸åŒçš„ç¯å¢ƒä¸åŒçš„é›†ç¾¤ï¼Œé›†ç¾¤é‡Œé¢æŒ‰ç…§ä¸šåŠ¡çº¿åˆ’åˆ† ns ã€‚","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597580,"discussion_content":"ä¹Ÿæ˜¯ä¸€ç§éå¸¸ä¸é”™çš„å®è·µğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672047227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364839,"user_name":"GACÂ·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"å¹¿ä¸œ","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1671592618,"is_pvip":false,"replies":[{"id":132861,"content":"è¿™éƒ¨åˆ†å†…å®¹åœ¨13è®²ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚\n\nä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨é•œåƒé‡Œ build ä¹‹åç”¨ http server å¯åŠ¨ dist ç›®å½•ã€‚ç¬¬äºŒç§æ˜¯ä½ æåˆ°çš„ Nginx çš„æ–¹å¼ï¼Œéœ€è¦ç”¨åˆ°å¤šé˜¶æ®µæ„å»ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1671600569,"ip_address":"å¹¿ä¸œ","comment_id":364839,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è€å¸ˆå‰ç«¯é¡¹ç›®(VUEæ¡†æ¶)å¦‚ä½•åˆ¶ä½œå®¹å™¨é•œåƒå•Šï¼Ÿæˆ‘å°è¯•äº†å…ˆç¼–è¯‘ï¼Œç„¶åæŒ‚åœ¨åˆ°Nginxå®¹å™¨htmlç›®å½•ä¸‹ï¼Œæœ‰å¾ˆå¤šé—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597274,"discussion_content":"è¿™éƒ¨åˆ†å†…å®¹åœ¨13è®²ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚\n\nä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨é•œåƒé‡Œ build ä¹‹åç”¨ http server å¯åŠ¨ dist ç›®å½•ã€‚ç¬¬äºŒç§æ˜¯ä½ æåˆ°çš„ Nginx çš„æ–¹å¼ï¼Œéœ€è¦ç”¨åˆ°å¤šé˜¶æ®µæ„å»ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671600570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2314854,"avatar":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","nickname":"includestdio.h","note":"","ucode":"5027BACE9319CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597286,"discussion_content":"æˆ‘ä»¬vueé¡¹ç›®éƒ¨ç½²æ¯”è¾ƒæ€ªå¼‚ï¼Œæ˜¯ciæ„å»ºå®Œä¹‹åæ‰“åŒ…distç›®å½•ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨ï¼Œç„¶åè§¦å‘cdï¼Œé‡å¯nginx Podï¼Œé€šè¿‡poststartæŠŠä»£ç æ‹‰åˆ°å¯¹åº”ç›®å½•é‡Œé¢ï¼Œè¿™æ ·å°±èƒ½å¤šä¸ªå‰ç«¯é¡¹ç›®éƒ¨ç½²åˆ°åŒä¸€ä¸ªPodäº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1671614073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365196,"user_name":"Lugyedo","can_delete":false,"product_type":"c1","uid":1011793,"ip_address":"åŒ—äº¬","ucode":"EB5E456B638E70","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg","comment_is_top":false,"comment_ctime":1672228938,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æ¯å¹´ç»„ç»‡æ¶æ„å’Œå›¢é˜Ÿéƒ½è¦è°ƒæ•´ï¼Œç”¨å›¢é˜ŸåŒºåˆ†å‘½åç©ºé—´ä¸åˆé€‚","like_count":3},{"had_liked":false,"id":386202,"user_name":"åº„ç”Ÿ â€¢ æ™“æ¢¦ â€¢ è´è¶","can_delete":false,"product_type":"c1","uid":1101611,"ip_address":"ä¸Šæµ·","ucode":"9281045A5B3F5D","user_header":"","comment_is_top":false,"comment_ctime":1704329544,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"kube-node-lease æ˜¯è®°å½•èŠ‚ç‚¹ç§ŸæœŸçš„ï¼Œä¸æ˜¯é›†ç¾¤æ‰©å±•","like_count":0}]}