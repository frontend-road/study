{"id":206513,"title":"11 | 深度学习与硬件：GPU","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NLP\">https://gitee.com/geektime-geekbang/NLP</a></p>","comments":[{"had_liked":false,"id":185101,"user_name":"mochp","can_delete":false,"product_type":"c3","uid":1369453,"ip_address":"","ucode":"60A945DB3C341D","user_header":"https://static001.geekbang.org/account/avatar/00/14/e5/6d/fa343d91.jpg","comment_is_top":false,"comment_ctime":1583483474,"is_pvip":false,"replies":[{"id":71668,"content":"很难复现，这是最麻烦的问题。有时候就什么事情都没有，但一旦出现就很恶心。你可以部署多个模型，但建议用一个serving服务来做。","user_name":"作者回复","user_name_real":"王然","uid":1813673,"ctime":1583640289,"ip_address":"","comment_id":185101,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"王老师的课程真的是非常接地气，受益良多！关于显存污染这个问题有一些疑问\n1、GPU不做显存管理么？如果显存污染的话，一块卡只能部署一个模型，是不是一块卡上也只能有一个程序使用显卡，别的程序使用这个显卡的话会出问题\n2、目前确实尝试过在一块卡上部署了多个模型（三个yolo3,每个模型占用显存不到1G），但是没有发现什么问题（捂脸）。怎么能复现或者模拟下显存污染的场景。","like_count":5,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"王然","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486251,"discussion_content":"很难复现，这是最麻烦的问题。有时候就什么事情都没有，但一旦出现就很恶心。你可以部署多个模型，但建议用一个serving服务来做。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583640289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1347921,"avatar":"https://static001.geekbang.org/account/avatar/00/14/91/51/3da9420d.jpg","nickname":"糖糖丸","note":"","ucode":"79762E88808283","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626541,"discussion_content":"请问用一个serving服务为什么就可以避免显存污染呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693105054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1369453,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e5/6d/fa343d91.jpg","nickname":"mochp","note":"","ucode":"60A945DB3C341D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201110,"discussion_content":"感谢王老师的解答～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583761082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184165,"user_name":"paddy0914","can_delete":false,"product_type":"c3","uid":1019409,"ip_address":"","ucode":"59F197BE058F78","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/11/4e2e21bd.jpg","comment_is_top":false,"comment_ctime":1583241143,"is_pvip":false,"replies":[{"id":71271,"content":"1. 不一定能解决。如果你强制在一个GPU上部署多个模型多少有些危险。2. NVidia的方案我们试用过，主要问题是显存污染比较难以察觉和测试，所以我们虽然没发现问题，但是也确实没法说就不会出现问题（捂脸）。对于GPU的问题就是这样，特别难以发现，所以一般来说我建议都是尽可能隔离开，但是这样效率损失就很大。所以前后都是闹心...","user_name":"作者回复","user_name_real":"王然","uid":1813673,"ctime":1583241526,"ip_address":"","comment_id":184165,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"目前基于k8s来调度GPU的方案，大部分是通过Mount Bind来实现的，这种方式只是做了多块卡的隔离，是不是不会触发老师说的显存污染问题？另外像NVIDIA针对商业卡的虚拟GPU方案，是否会出现显存污染的问题？","like_count":2,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"王然","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485916,"discussion_content":"1. 不一定能解决。如果你强制在一个GPU上部署多个模型多少有些危险。2. NVidia的方案我们试用过，主要问题是显存污染比较难以察觉和测试，所以我们虽然没发现问题，但是也确实没法说就不会出现问题（捂脸）。对于GPU的问题就是这样，特别难以发现，所以一般来说我建议都是尽可能隔离开，但是这样效率损失就很大。所以前后都是闹心...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583241526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019409,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/11/4e2e21bd.jpg","nickname":"paddy0914","note":"","ucode":"59F197BE058F78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194782,"discussion_content":"感谢老师严谨的回复，看来要踩的坑还是很多，好在听了老师的课程可以先避开一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583242670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184130,"user_name":"岛乾坤","can_delete":false,"product_type":"c3","uid":1078898,"ip_address":"","ucode":"2BCE1D04BFB78D","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/72/14c6a943.jpg","comment_is_top":false,"comment_ctime":1583230833,"is_pvip":false,"replies":[{"id":71252,"content":"基本都是踩过的坑～","user_name":"作者回复","user_name_real":"王然","uid":1813673,"ctime":1583234173,"ip_address":"","comment_id":184130,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"老实这些注意事项都是实际工作中总结出来的？没有动手部署或者操作过，现在还不太好理解。希望后面老师能多分享工作中遇到的问题。","like_count":2,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"王然","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485900,"discussion_content":"基本都是踩过的坑～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583234173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267709,"user_name":"八门金锁","can_delete":false,"product_type":"c3","uid":1988225,"ip_address":"","ucode":"C4FDBEEB48E8AA","user_header":"https://static001.geekbang.org/account/avatar/00/1e/56/81/9a8c569c.jpg","comment_is_top":false,"comment_ctime":1607885700,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"硬件这三讲真的是干货。其他地方都看不到。","like_count":4},{"had_liked":false,"id":295565,"user_name":"x","can_delete":false,"product_type":"c3","uid":2021428,"ip_address":"","ucode":"BC84DA0C0282D4","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d8/34/b2a0e6a0.jpg","comment_is_top":false,"comment_ctime":1622476439,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"https:&#47;&#47;shimo.im&#47;mindmaps&#47;vJdTPkRQDxKC88gy&#47; 《11.深度学习与硬件：GPU 篇》","like_count":2},{"had_liked":false,"id":255047,"user_name":"太子长琴","can_delete":false,"product_type":"c3","uid":1090266,"ip_address":"","ucode":"0627D0FA370AD4","user_header":"https://static001.geekbang.org/account/avatar/00/10/a2/da/a8a32113.jpg","comment_is_top":false,"comment_ctime":1603257833,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"推理时只有 CPU……还没用过 GPU","like_count":2},{"had_liked":false,"id":186955,"user_name":"wonder2025","can_delete":false,"product_type":"c3","uid":1059693,"ip_address":"","ucode":"4DCCC2AF31F43F","user_header":"https://static001.geekbang.org/account/avatar/00/10/2b/6d/2e08d74f.jpg","comment_is_top":false,"comment_ctime":1583978809,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"老师说的很实际，谢谢老师","like_count":1},{"had_liked":false,"id":185160,"user_name":"qinsi","can_delete":false,"product_type":"c3","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1583501247,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"商用卡和民用卡的区别主要是ECC，但据说对深度学习没啥影响","like_count":1},{"had_liked":false,"id":184218,"user_name":"人工智能混饭人","can_delete":false,"product_type":"c3","uid":1104354,"ip_address":"","ucode":"71CF953311BD81","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/e2/d75009ef.jpg","comment_is_top":false,"comment_ctime":1583248449,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"知识点 显存污染 get！！","like_count":1},{"had_liked":false,"id":243432,"user_name":"YOLO-814","can_delete":false,"product_type":"c3","uid":1546164,"ip_address":"","ucode":"0533B654A845E3","user_header":"https://static001.geekbang.org/account/avatar/00/17/97/b4/f701255b.jpg","comment_is_top":false,"comment_ctime":1598104438,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"几十个模型，1个1080i上部署，加锁没啥问题呀， 如果一个模型一个卡， 那也太浪费资源了吧","like_count":0,"discussions":[{"author":{"id":2325199,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7a/cf/c42dd74e.jpg","nickname":"sky","note":"","ucode":"C7BA135845E1FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395119,"discussion_content":"加锁指的是？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632234097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209702,"user_name":"moslunix","can_delete":false,"product_type":"c3","uid":1030849,"ip_address":"","ucode":"AD8AEFDBFC1088","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/c1/75340c5b.jpg","comment_is_top":false,"comment_ctime":1587602776,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100046401,"comment_content":"Intel的GPU卡怎样，现在有部分的框架可以支持Intel的GPU","like_count":0},{"had_liked":false,"id":200363,"user_name":"evelyn","can_delete":false,"product_type":"c3","uid":1484324,"ip_address":"","ucode":"D64EB1CDADB37E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFgGwHiax7ZvOFyIjmLdqRicatjSdupu32Xq6TcLzeYd1xKeDbfhXATvaicq5MVQvXAt0pT0xFUbHDA/132","comment_is_top":false,"comment_ctime":1585576798,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100046401,"comment_content":"老师，tf serving可以指定占用的显存大小，比如16G的显存，只用其中8G，这样是不是可以同时跑两个模型，每个占一半？还会有显存污染的问题吗？","like_count":0},{"had_liked":false,"id":186971,"user_name":"wonder2025","can_delete":false,"product_type":"c3","uid":1059693,"ip_address":"","ucode":"4DCCC2AF31F43F","user_header":"https://static001.geekbang.org/account/avatar/00/10/2b/6d/2e08d74f.jpg","comment_is_top":false,"comment_ctime":1583980464,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100046401,"comment_content":"有个问题，既然存在显存污染的问题，那用k8s管理gpu集群，让它来负责管理训练推理的资源是否合适呢？","like_count":0}]}