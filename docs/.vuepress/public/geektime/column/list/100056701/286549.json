{"id":286549,"title":"18 | æ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„Redisï¼Ÿï¼ˆä¸Šï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å¾·é’§ã€‚</p><p>åœ¨Redisçš„å®é™…éƒ¨ç½²åº”ç”¨ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯Redisçªç„¶å˜æ…¢äº†ã€‚ä¸€æ—¦å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä¸ä»…ä¼šç›´æ¥å½±å“ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œè¿˜å¯èƒ½ä¼šå½±å“åˆ°â€œæ—äººâ€ï¼Œä¹Ÿå°±æ˜¯å’ŒRedisåœ¨åŒä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿä¸­çš„å…¶ä»–ç³»ç»Ÿï¼Œæ¯”å¦‚è¯´æ•°æ®åº“ã€‚</p><p>ä¸¾ä¸ªå°ä¾‹å­ï¼Œåœ¨ç§’æ€åœºæ™¯ä¸‹ï¼Œä¸€æ—¦Rediså˜æ…¢äº†ï¼Œå¤§é‡çš„ç”¨æˆ·ä¸‹å•è¯·æ±‚å°±ä¼šè¢«æ‹–æ…¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·æäº¤äº†ä¸‹å•ç”³è¯·ï¼Œå´æ²¡æœ‰æ”¶åˆ°ä»»ä½•å“åº”ï¼Œè¿™ä¼šç»™ç”¨æˆ·å¸¦æ¥éå¸¸ç³Ÿç³•çš„ä½¿ç”¨ä½“éªŒï¼Œç”šè‡³å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·æµå¤±ã€‚</p><p>è€Œä¸”ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒRediså¾€å¾€æ˜¯ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç¯èŠ‚ï¼ˆä¾‹å¦‚ä½œä¸ºç¼“å­˜æˆ–æ˜¯ä½œä¸ºæ•°æ®åº“ï¼‰ã€‚ä¸€æ—¦Redisä¸Šçš„è¯·æ±‚å»¶è¿Ÿå¢åŠ ï¼Œå°±å¯èƒ½å¼•èµ·ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€ä¸²å„¿â€œè¿é”ååº”â€ã€‚</p><p>æˆ‘å€ŸåŠ©ä¸€ä¸ªåŒ…å«äº†Redisçš„ä¸šåŠ¡é€»è¾‘çš„å°ä¾‹å­ï¼Œç®€å•åœ°ç»™ä½ è§£é‡Šä¸€ä¸‹ã€‚</p><p>åº”ç”¨æœåŠ¡å™¨ï¼ˆApp Serverï¼‰è¦å®Œæˆä¸€ä¸ªäº‹åŠ¡æ€§æ“ä½œï¼ŒåŒ…æ‹¬åœ¨MySQLä¸Šæ‰§è¡Œä¸€ä¸ªå†™äº‹åŠ¡ï¼Œåœ¨Redisä¸Šæ’å…¥ä¸€ä¸ªæ ‡è®°ä½ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡ç»™ç”¨æˆ·å‘é€ä¸€æ¡å®Œæˆæ¶ˆæ¯ã€‚</p><p>è¿™ä¸‰ä¸ªæ“ä½œéƒ½éœ€è¦ä¿è¯äº‹åŠ¡åŸå­æ€§ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ­¤æ—¶Redisçš„å»¶è¿Ÿå¢åŠ ï¼Œå°±ä¼šæ‹–ç´¯App Serverç«¯æ•´ä¸ªäº‹åŠ¡çš„æ‰§è¡Œã€‚è¿™ä¸ªäº‹åŠ¡ä¸€ç›´å®Œæˆä¸äº†ï¼Œåˆä¼šå¯¼è‡´MySQLä¸Šå†™äº‹åŠ¡å ç”¨çš„èµ„æºæ— æ³•é‡Šæ”¾ï¼Œè¿›è€Œå¯¼è‡´è®¿é—®MySQLçš„å…¶ä»–è¯·æ±‚è¢«é˜»å¡ã€‚å¾ˆæ˜æ˜¾ï¼ŒRediså˜æ…¢ä¼šå¸¦æ¥ä¸¥é‡çš„è¿é”ååº”ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/58/64/58555bc098b518e992136f1128430c64.jpg?wh=2572*1211\" alt=\"\"></p><p>æˆ‘ç›¸ä¿¡ï¼Œä¸å°‘äººé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œé‚£å…·ä½“è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™ï¼Œåˆ‡å¿Œâ€œç—…æ€¥ä¹±æŠ•åŒ»â€ã€‚å¦‚æœæ²¡æœ‰ä¸€å¥—è¡Œä¹‹æœ‰æ•ˆçš„åº”å¯¹æ–¹æ¡ˆï¼Œå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬åªèƒ½å„ç§å°è¯•ï¼Œåšæ— ç”¨åŠŸã€‚åœ¨å‰é¢çš„<a href=\"https://time.geekbang.org/column/article/285000\">ç¬¬16è®²</a>ã€<a href=\"https://time.geekbang.org/column/article/286082\">ç¬¬17è®²</a>ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¼šå¯¼è‡´Rediså˜æ…¢çš„æ½œåœ¨é˜»å¡ç‚¹ä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå³å¼‚æ­¥çº¿ç¨‹æœºåˆ¶å’ŒCPUç»‘æ ¸ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å› ç´ ä¼šå¯¼è‡´Rediså˜æ…¢ã€‚</p><p>æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ï¼Œæˆ‘å†å‘ä½ ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç³»ç»Ÿæ€§åœ°åº”å¯¹Rediså˜æ…¢è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä¼šä»é—®é¢˜è®¤å®šã€ç³»ç»Ÿæ€§æ’æŸ¥å’Œåº”å¯¹æ–¹æ¡ˆè¿™3ä¸ªæ–¹é¢ç»™ä½ å…·ä½“è®²è§£ã€‚å­¦å®Œè¿™ä¸¤èŠ‚è¯¾ä»¥åï¼Œä½ ä¸€å®šèƒ½å¤Ÿæœ‰ç« æ³•åœ°è§£å†³Rediså˜æ…¢çš„é—®é¢˜ã€‚</p><h2>RedisçœŸçš„å˜æ…¢äº†å—ï¼Ÿ</h2><p>åœ¨å®é™…è§£å†³é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å¼„æ¸…æ¥šï¼Œå¦‚ä½•åˆ¤æ–­Redisæ˜¯ä¸æ˜¯çœŸçš„å˜æ…¢äº†ã€‚</p><p>ä¸€ä¸ªæœ€ç›´æ¥çš„æ–¹æ³•ï¼Œå°±æ˜¯<strong>æŸ¥çœ‹Redisçš„å“åº”å»¶è¿Ÿ</strong>ã€‚</p><p>å¤§éƒ¨åˆ†æ—¶å€™ï¼ŒRediså»¶è¿Ÿå¾ˆä½ï¼Œä½†æ˜¯åœ¨æŸäº›æ—¶åˆ»ï¼Œæœ‰äº›Rediså®ä¾‹ä¼šå‡ºç°å¾ˆé«˜çš„å“åº”å»¶è¿Ÿï¼Œç”šè‡³èƒ½è¾¾åˆ°å‡ ç§’åˆ°åå‡ ç§’ï¼Œä¸è¿‡æŒç»­æ—¶é—´ä¸é•¿ï¼Œè¿™ä¹Ÿå«å»¶è¿Ÿâ€œæ¯›åˆºâ€ã€‚å½“ä½ å‘ç°Rediså‘½ä»¤çš„æ‰§è¡Œæ—¶é—´çªç„¶å°±å¢é•¿åˆ°äº†å‡ ç§’ï¼ŒåŸºæœ¬å°±å¯ä»¥è®¤å®šRediså˜æ…¢äº†ã€‚</p><p>è¿™ç§æ–¹æ³•æ˜¯çœ‹Rediså»¶è¿Ÿçš„ç»å¯¹å€¼ï¼Œä½†æ˜¯ï¼Œåœ¨ä¸åŒçš„è½¯ç¡¬ä»¶ç¯å¢ƒä¸‹ï¼ŒRedisæœ¬èº«çš„ç»å¯¹æ€§èƒ½å¹¶ä¸ç›¸åŒã€‚æ¯”å¦‚ï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œå½“å»¶è¿Ÿä¸º1msæ—¶ï¼Œæˆ‘åˆ¤å®šRediså˜æ…¢äº†ï¼Œä½†æ˜¯ä½ çš„ç¡¬ä»¶é…ç½®é«˜ï¼Œé‚£ä¹ˆï¼Œåœ¨ä½ çš„è¿è¡Œç¯å¢ƒä¸‹ï¼Œå¯èƒ½å»¶è¿Ÿæ˜¯0.2msçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥è®¤å®šRediså˜æ…¢äº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘å°±è¦è¯´ç¬¬äºŒä¸ªæ–¹æ³•äº†ï¼Œä¹Ÿå°±æ˜¯åŸºäº<strong>å½“å‰ç¯å¢ƒä¸‹çš„RedisåŸºçº¿æ€§èƒ½</strong>åšåˆ¤æ–­ã€‚æ‰€è°“çš„åŸºçº¿æ€§èƒ½å‘¢ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç³»ç»Ÿåœ¨ä½å‹åŠ›ã€æ— å¹²æ‰°ä¸‹çš„åŸºæœ¬æ€§èƒ½ï¼Œè¿™ä¸ªæ€§èƒ½åªç”±å½“å‰çš„è½¯ç¡¬ä»¶é…ç½®å†³å®šã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå…·ä½“æ€ä¹ˆç¡®å®šåŸºçº¿æ€§èƒ½å‘¢ï¼Ÿæœ‰ä»€ä¹ˆå¥½æ–¹æ³•å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œä»2.8.7ç‰ˆæœ¬å¼€å§‹ï¼Œredis-cliå‘½ä»¤æä¾›äº†â€“intrinsic-latencyé€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥ç›‘æµ‹å’Œç»Ÿè®¡æµ‹è¯•æœŸé—´å†…çš„æœ€å¤§å»¶è¿Ÿï¼Œè¿™ä¸ªå»¶è¿Ÿå¯ä»¥ä½œä¸ºRedisçš„åŸºçº¿æ€§èƒ½ã€‚å…¶ä¸­ï¼Œæµ‹è¯•æ—¶é•¿å¯ä»¥ç”¨â€“intrinsic-latencyé€‰é¡¹çš„å‚æ•°æ¥æŒ‡å®šã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæ‰“å°120ç§’å†…ç›‘æµ‹åˆ°çš„æœ€å¤§å»¶è¿Ÿã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„æœ€å¤§å»¶è¿Ÿæ˜¯119å¾®ç§’ï¼Œä¹Ÿå°±æ˜¯åŸºçº¿æ€§èƒ½ä¸º119å¾®ç§’ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿è¡Œ120ç§’å°±è¶³å¤Ÿç›‘æµ‹åˆ°æœ€å¤§å»¶è¿Ÿäº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‚æ•°è®¾ç½®ä¸º120ã€‚</p><pre><code>./redis-cli --intrinsic-latency 120\nMax latency so far: 17 microseconds.\nMax latency so far: 44 microseconds.\nMax latency so far: 94 microseconds.\nMax latency so far: 110 microseconds.\nMax latency so far: 119 microseconds.\n\n36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run).\nWorst run took 36x longer than the average latency.\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸºçº¿æ€§èƒ½å’Œå½“å‰çš„æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶é…ç½®ç›¸å…³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå’ŒRedisè¿è¡Œæ—¶çš„å»¶è¿Ÿç»“åˆèµ·æ¥ï¼Œå†è¿›ä¸€æ­¥åˆ¤æ–­Redisæ€§èƒ½æ˜¯å¦å˜æ…¢äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½ è¦æŠŠè¿è¡Œæ—¶å»¶è¿Ÿå’ŒåŸºçº¿æ€§èƒ½è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä½ è§‚å¯Ÿåˆ°çš„Redisè¿è¡Œæ—¶å»¶è¿Ÿæ˜¯å…¶åŸºçº¿æ€§èƒ½çš„2å€åŠä»¥ä¸Šï¼Œå°±å¯ä»¥è®¤å®šRediså˜æ…¢äº†ã€‚</p><p>åˆ¤æ–­åŸºçº¿æ€§èƒ½è¿™ä¸€ç‚¹ï¼Œå¯¹äºåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹è¿è¡Œçš„Redisæ¥è¯´ï¼Œéå¸¸é‡è¦ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºæˆ–å®¹å™¨ï¼‰ä¸­ï¼Œç”±äºå¢åŠ äº†è™šæ‹ŸåŒ–è½¯ä»¶å±‚ï¼Œä¸ç‰©ç†æœºç›¸æ¯”ï¼Œè™šæ‹Ÿæœºæˆ–å®¹å™¨æœ¬èº«å°±ä¼šå¼•å…¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œæ‰€ä»¥åŸºçº¿æ€§èƒ½ä¼šé«˜ä¸€äº›ã€‚ä¸‹é¢çš„æµ‹è¯•ç»“æœï¼Œæ˜¾ç¤ºçš„å°±æ˜¯æŸä¸€ä¸ªè™šæ‹Ÿæœºä¸Šè¿è¡ŒRedisæ—¶æµ‹çš„åŸºçº¿æ€§èƒ½ã€‚</p><pre><code>$ ./redis-cli --intrinsic-latency 120\nMax latency so far: 692 microseconds.\nMax latency so far: 915 microseconds.\nMax latency so far: 2193 microseconds.\nMax latency so far: 9343 microseconds.\nMax latency so far: 9871 microseconds.\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºè™šæ‹ŸåŒ–è½¯ä»¶æœ¬èº«çš„å¼€é”€ï¼Œæ­¤æ—¶çš„åŸºçº¿æ€§èƒ½å·²ç»è¾¾åˆ°äº†9.871msã€‚å¦‚æœè¯¥Rediså®ä¾‹çš„è¿è¡Œæ—¶å»¶è¿Ÿä¸º10msï¼Œè¿™å¹¶ä¸èƒ½ç®—ä½œæ€§èƒ½å˜æ…¢ï¼Œå› ä¸ºæ­¤æ—¶ï¼Œè¿è¡Œæ—¶å»¶è¿Ÿåªæ¯”åŸºçº¿æ€§èƒ½å¢åŠ äº†1.3%ã€‚å¦‚æœä½ ä¸äº†è§£åŸºçº¿æ€§èƒ½ï¼Œä¸€çœ‹åˆ°è¾ƒé«˜çš„è¿è¡Œæ—¶å»¶è¿Ÿï¼Œå°±å¾ˆæœ‰å¯èƒ½è¯¯åˆ¤Rediså˜æ…¢äº†ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯é€šè¿‡å®¢æˆ·ç«¯å’Œç½‘ç»œè®¿é—®RedisæœåŠ¡ï¼Œä¸ºäº†é¿å…ç½‘ç»œå¯¹åŸºçº¿æ€§èƒ½çš„å½±å“ï¼Œåˆšåˆšè¯´çš„è¿™ä¸ªå‘½ä»¤éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ç›´æ¥è¿è¡Œï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æˆ‘ä»¬åªè€ƒè™‘æœåŠ¡å™¨ç«¯è½¯ç¡¬ä»¶ç¯å¢ƒçš„å½±å“</strong>ã€‚</p><p>å¦‚æœä½ æƒ³äº†è§£ç½‘ç»œå¯¹Redisæ€§èƒ½çš„å½±å“ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç”¨iPerfè¿™æ ·çš„å·¥å…·ï¼Œæµ‹é‡ä»Rediså®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„ç½‘ç»œå»¶è¿Ÿã€‚å¦‚æœè¿™ä¸ªå»¶è¿Ÿæœ‰å‡ åæ¯«ç§’ç”šè‡³æ˜¯å‡ ç™¾æ¯«ç§’ï¼Œå°±è¯´æ˜ï¼ŒRedisè¿è¡Œçš„ç½‘ç»œç¯å¢ƒä¸­å¾ˆå¯èƒ½æœ‰å¤§æµé‡çš„å…¶ä»–åº”ç”¨ç¨‹åºåœ¨è¿è¡Œï¼Œå¯¼è‡´ç½‘ç»œæ‹¥å¡äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±éœ€è¦åè°ƒç½‘ç»œè¿ç»´ï¼Œè°ƒæ•´ç½‘ç»œçš„æµé‡åˆ†é…äº†ã€‚</p><h2>å¦‚ä½•åº”å¯¹Rediså˜æ…¢ï¼Ÿ</h2><p>ç»è¿‡äº†ä¸Šä¸€æ­¥ä¹‹åï¼Œä½ å·²ç»èƒ½å¤Ÿç¡®å®šRedisæ˜¯å¦å˜æ…¢äº†ã€‚ä¸€æ—¦å‘ç°å˜æ…¢äº†ï¼Œæ¥ä¸‹æ¥ï¼Œå°±è¦å¼€å§‹æŸ¥æ‰¾åŸå› å¹¶è§£å†³è¿™ä¸ªé—®é¢˜äº†ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¯Šæ–­è¿‡ç¨‹ã€‚</p><p>æ­¤æ—¶çš„ä½ å°±åƒä¸€ååŒ»ç”Ÿï¼Œè€ŒRedisåˆ™æ˜¯ä¸€ä½ç—…äººã€‚åœ¨ç»™ç—…äººçœ‹ç—…æ—¶ï¼Œä½ è¦çŸ¥é“äººä½“çš„æœºåˆ¶ï¼Œè¿˜è¦çŸ¥é“å¯èƒ½å¯¹èº«ä½“é€ æˆå½±å“çš„å¤–éƒ¨å› ç´ ï¼Œæ¯”å¦‚ä¸å¥åº·çš„é£Ÿç‰©ã€ä¸å¥½çš„æƒ…ç»ªç­‰ï¼Œç„¶åè¦æ‹CTã€å¿ƒç”µå›¾ç­‰æ‰¾å‡ºç—…å› ï¼Œæœ€åå†ç¡®å®šæ²»ç–—æ–¹æ¡ˆã€‚</p><p>åœ¨è¯Šæ–­â€œRediså˜æ…¢â€è¿™ä¸ªç—…ç—‡æ—¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¿™æ ·ã€‚ä½ è¦åŸºäºè‡ªå·±å¯¹Redisæœ¬èº«çš„å·¥ä½œåŸç†çš„ç†è§£ï¼Œå¹¶ä¸”ç»“åˆå’Œå®ƒäº¤äº’çš„æ“ä½œç³»ç»Ÿã€å­˜å‚¨ä»¥åŠç½‘ç»œç­‰å¤–éƒ¨ç³»ç»Ÿå…³é”®æœºåˆ¶ï¼Œå†å€ŸåŠ©ä¸€äº›è¾…åŠ©å·¥å…·æ¥å®šä½åŸå› ï¼Œå¹¶åˆ¶å®šè¡Œä¹‹æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><p>åŒ»ç”Ÿè¯Šæ–­ä¸€èˆ¬éƒ½æ˜¯æœ‰ç« å¯å¾ªçš„ã€‚åŒæ ·ï¼ŒRedisçš„æ€§èƒ½è¯Šæ–­ä¹Ÿæœ‰ç« å¯ä¾ï¼Œè¿™å°±æ˜¯å½±å“Redisçš„å…³é”®å› ç´ ã€‚ä¸‹é¢è¿™å¼ å›¾ä½ åº”è¯¥æœ‰å°è±¡ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/268262\">ç¬¬ä¸€èŠ‚è¯¾</a>ç”»çš„Redisæ¶æ„å›¾ã€‚ä½ å¯ä»¥é‡ç‚¹å…³æ³¨ä¸‹æˆ‘åœ¨å›¾ä¸Šæ–°å¢çš„çº¢è‰²æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯Redisè‡ªèº«çš„æ“ä½œç‰¹æ€§ã€æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿï¼Œå®ƒä»¬æ˜¯å½±å“Redisæ€§èƒ½çš„ä¸‰å¤§è¦ç´ ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/06/cd026801924e197f5c79828c368cd706.jpg?wh=4242*3039\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»è¿™ä¸‰å¤§è¦ç´ å…¥æ‰‹ï¼Œç»“åˆå®é™…çš„åº”ç”¨åœºæ™¯ï¼Œä¾æ¬¡ç»™ä½ ä»‹ç»ä»ä¸åŒè¦ç´ å‡ºå‘æ’æŸ¥å’Œè§£å†³é—®é¢˜çš„å®è·µç»éªŒã€‚è¿™èŠ‚è¯¾æˆ‘å…ˆç»™ä½ ä»‹ç»Redisçš„è‡ªèº«æ“ä½œç‰¹æ€§çš„å½±å“ï¼Œä¸‹èŠ‚è¯¾æˆ‘ä»¬å†é‡ç‚¹ç ”ç©¶æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„å½±å“ã€‚</p><h3>Redisè‡ªèº«æ“ä½œç‰¹æ€§çš„å½±å“</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸‹Redisæä¾›çš„é”®å€¼å¯¹å‘½ä»¤æ“ä½œå¯¹å»¶è¿Ÿæ€§èƒ½çš„å½±å“ã€‚æˆ‘é‡ç‚¹ä»‹ç»ä¸¤ç±»å…³é”®æ“ä½œï¼šæ…¢æŸ¥è¯¢å‘½ä»¤å’Œè¿‡æœŸkeyæ“ä½œã€‚</p><p><strong>1.æ…¢æŸ¥è¯¢å‘½ä»¤</strong></p><p>æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œå°±æ˜¯æŒ‡åœ¨Redisä¸­æ‰§è¡Œé€Ÿåº¦æ…¢çš„å‘½ä»¤ï¼Œè¿™ä¼šå¯¼è‡´Rediså»¶è¿Ÿå¢åŠ ã€‚Redisæä¾›çš„å‘½ä»¤æ“ä½œå¾ˆå¤šï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å‘½ä»¤éƒ½æ…¢ï¼Œè¿™å’Œå‘½ä»¤æ“ä½œçš„å¤æ‚åº¦æœ‰å…³ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»è¦çŸ¥é“Redisçš„ä¸åŒå‘½ä»¤çš„å¤æ‚åº¦ã€‚</p><p>æ¯”å¦‚è¯´ï¼ŒValueç±»å‹ä¸ºStringæ—¶ï¼ŒGET/SETæ“ä½œä¸»è¦å°±æ˜¯æ“ä½œRedisçš„å“ˆå¸Œè¡¨ç´¢å¼•ã€‚è¿™ä¸ªæ“ä½œå¤æ‚åº¦åŸºæœ¬æ˜¯å›ºå®šçš„ï¼Œå³O(1)ã€‚ä½†æ˜¯ï¼Œå½“Valueç±»å‹ä¸ºSetæ—¶ï¼ŒSORTã€SUNION/SMEMBERSæ“ä½œå¤æ‚åº¦åˆ†åˆ«ä¸ºO(N+M*log(M))å’ŒO(N)ã€‚å…¶ä¸­ï¼ŒNä¸ºSetä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ŒMä¸ºSORTæ“ä½œè¿”å›çš„å…ƒç´ ä¸ªæ•°ã€‚è¿™ä¸ªå¤æ‚åº¦å°±å¢åŠ äº†å¾ˆå¤šã€‚<a href=\"https://redis.io/commands/\">Rediså®˜æ–¹æ–‡æ¡£</a>ä¸­å¯¹æ¯ä¸ªå‘½ä»¤çš„å¤æ‚åº¦éƒ½æœ‰ä»‹ç»ï¼Œå½“ä½ éœ€è¦äº†è§£æŸä¸ªå‘½ä»¤çš„å¤æ‚åº¦æ—¶ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢ã€‚</p><p>é‚£è¯¥æ€ä¹ˆåº”å¯¹è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿåœ¨è¿™å„¿ï¼Œæˆ‘å°±è¦ç»™ä½ æ’æŸ¥å»ºè®®å’Œè§£å†³æ–¹æ³•äº†ï¼Œè¿™ä¹Ÿæ˜¯ä»Šå¤©çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>å½“ä½ å‘ç°Redisæ€§èƒ½å˜æ…¢æ—¶ï¼Œå¯ä»¥é€šè¿‡Redisæ—¥å¿—ï¼Œæˆ–è€…æ˜¯latency monitorå·¥å…·ï¼ŒæŸ¥è¯¢å˜æ…¢çš„è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¯¹åº”çš„å…·ä½“å‘½ä»¤ä»¥åŠå®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤ä¸‹æ˜¯å¦é‡‡ç”¨äº†å¤æ‚åº¦é«˜çš„æ…¢æŸ¥è¯¢å‘½ä»¤ã€‚</p><p>å¦‚æœçš„ç¡®æœ‰å¤§é‡çš„æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p><ol>\n<li><strong>ç”¨å…¶ä»–é«˜æ•ˆå‘½ä»¤ä»£æ›¿</strong>ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ éœ€è¦è¿”å›ä¸€ä¸ªSETä¸­çš„æ‰€æœ‰æˆå‘˜æ—¶ï¼Œä¸è¦ä½¿ç”¨SMEMBERSå‘½ä»¤ï¼Œè€Œæ˜¯è¦ä½¿ç”¨SSCANå¤šæ¬¡è¿­ä»£è¿”å›ï¼Œé¿å…ä¸€æ¬¡è¿”å›å¤§é‡æ•°æ®ï¼Œé€ æˆçº¿ç¨‹é˜»å¡ã€‚</li>\n<li><strong>å½“ä½ éœ€è¦æ‰§è¡Œæ’åºã€äº¤é›†ã€å¹¶é›†æ“ä½œæ—¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å®Œæˆï¼Œè€Œä¸è¦ç”¨SORTã€SUNIONã€SINTERè¿™äº›å‘½ä»¤ï¼Œä»¥å…æ‹–æ…¢Rediså®ä¾‹</strong>ã€‚</li>\n</ol><p>å½“ç„¶ï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘å°±æ˜¯è¦æ±‚ä½¿ç”¨æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œé‚£ä½ å¾—è€ƒè™‘é‡‡ç”¨æ€§èƒ½æ›´å¥½çš„CPUï¼Œæ›´å¿«åœ°å®ŒæˆæŸ¥è¯¢å‘½ä»¤ï¼Œé¿å…æ…¢æŸ¥è¯¢çš„å½±å“ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“å¿½ç•¥çš„æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œå°±æ˜¯KEYSã€‚å®ƒç”¨äºè¿”å›å’Œè¾“å…¥æ¨¡å¼åŒ¹é…çš„æ‰€æœ‰keyï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è¿”å›æ‰€æœ‰åŒ…å«â€œnameâ€å­—ç¬¦ä¸²çš„keysã€‚</p><pre><code>redis&gt; KEYS *name*\n1) &quot;lastname&quot;\n2) &quot;firstname&quot;\n</code></pre><p><strong>å› ä¸ºKEYSå‘½ä»¤éœ€è¦éå†å­˜å‚¨çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥æ“ä½œå»¶æ—¶é«˜</strong>ã€‚å¦‚æœä½ ä¸äº†è§£å®ƒçš„å®ç°è€Œä½¿ç”¨äº†å®ƒï¼Œå°±ä¼šå¯¼è‡´Redisæ€§èƒ½å˜æ…¢ã€‚æ‰€ä»¥ï¼Œ<strong>KEYSå‘½ä»¤ä¸€èˆ¬ä¸è¢«å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒä¸­</strong>ã€‚</p><p><strong>2.è¿‡æœŸkeyæ“ä½œ</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹è¿‡æœŸkeyçš„è‡ªåŠ¨åˆ é™¤æœºåˆ¶ã€‚å®ƒæ˜¯Redisç”¨æ¥å›æ”¶å†…å­˜ç©ºé—´çš„å¸¸ç”¨æœºåˆ¶ï¼Œåº”ç”¨å¹¿æ³›ï¼Œæœ¬èº«å°±ä¼šå¼•èµ·Redisæ“ä½œé˜»å¡ï¼Œå¯¼è‡´æ€§èƒ½å˜æ…¢ï¼Œæ‰€ä»¥ï¼Œä½ å¿…é¡»è¦çŸ¥é“è¯¥æœºåˆ¶å¯¹æ€§èƒ½çš„å½±å“ã€‚</p><p>Redisé”®å€¼å¯¹çš„keyå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæ¯100æ¯«ç§’ä¼šåˆ é™¤ä¸€äº›è¿‡æœŸkeyï¼Œå…·ä½“çš„ç®—æ³•å¦‚ä¸‹ï¼š</p><ol>\n<li>é‡‡æ ·ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPä¸ªæ•°çš„keyï¼Œå¹¶å°†å…¶ä¸­è¿‡æœŸçš„keyå…¨éƒ¨åˆ é™¤ï¼›</li>\n<li>å¦‚æœè¶…è¿‡25%çš„keyè¿‡æœŸäº†ï¼Œåˆ™é‡å¤åˆ é™¤çš„è¿‡ç¨‹ï¼Œç›´åˆ°è¿‡æœŸkeyçš„æ¯”ä¾‹é™è‡³25%ä»¥ä¸‹ã€‚</li>\n</ol><p>ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPæ˜¯Redisçš„ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯20ï¼Œé‚£ä¹ˆï¼Œä¸€ç§’å†…åŸºæœ¬æœ‰200ä¸ªè¿‡æœŸkeyä¼šè¢«åˆ é™¤ã€‚è¿™ä¸€ç­–ç•¥å¯¹æ¸…é™¤è¿‡æœŸkeyã€é‡Šæ”¾å†…å­˜ç©ºé—´å¾ˆæœ‰å¸®åŠ©ã€‚å¦‚æœæ¯ç§’é’Ÿåˆ é™¤200ä¸ªè¿‡æœŸkeyï¼Œå¹¶ä¸ä¼šå¯¹Redisé€ æˆå¤ªå¤§å½±å“ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœè§¦å‘äº†ä¸Šé¢è¿™ä¸ªç®—æ³•çš„ç¬¬äºŒæ¡ï¼ŒRediså°±ä¼šä¸€ç›´åˆ é™¤ä»¥é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚æ³¨æ„ï¼Œ<strong>åˆ é™¤æ“ä½œæ˜¯é˜»å¡çš„</strong>ï¼ˆRedis 4.0åå¯ä»¥ç”¨å¼‚æ­¥çº¿ç¨‹æœºåˆ¶æ¥å‡å°‘é˜»å¡å½±å“ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦è¯¥æ¡ä»¶è§¦å‘ï¼ŒRedisçš„çº¿ç¨‹å°±ä¼šä¸€ç›´æ‰§è¡Œåˆ é™¤ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±æ²¡åŠæ³•æ­£å¸¸æœåŠ¡å…¶ä»–çš„é”®å€¼æ“ä½œäº†ï¼Œå°±ä¼šè¿›ä¸€æ­¥å¼•èµ·å…¶ä»–é”®å€¼æ“ä½œçš„å»¶è¿Ÿå¢åŠ ï¼ŒRediså°±ä¼šå˜æ…¢ã€‚</p><p>é‚£ä¹ˆï¼Œç®—æ³•çš„ç¬¬äºŒæ¡æ˜¯æ€ä¹ˆè¢«è§¦å‘çš„å‘¢ï¼Ÿå…¶ä¸­ä¸€ä¸ªé‡è¦æ¥æºï¼Œå°±æ˜¯<strong>é¢‘ç¹ä½¿ç”¨å¸¦æœ‰ç›¸åŒæ—¶é—´å‚æ•°çš„EXPIREATå‘½ä»¤è®¾ç½®è¿‡æœŸkey</strong>ï¼Œè¿™å°±ä¼šå¯¼è‡´ï¼Œåœ¨åŒä¸€ç§’å†…æœ‰å¤§é‡çš„keyåŒæ—¶è¿‡æœŸã€‚</p><p>ç°åœ¨ï¼Œæˆ‘å°±è¦ç»™å‡ºç¬¬äºŒæ¡æ’æŸ¥å»ºè®®å’Œè§£å†³æ–¹æ³•äº†ã€‚</p><p>ä½ è¦æ£€æŸ¥ä¸šåŠ¡ä»£ç åœ¨ä½¿ç”¨EXPIREATå‘½ä»¤è®¾ç½®keyè¿‡æœŸæ—¶é—´æ—¶ï¼Œæ˜¯å¦ä½¿ç”¨äº†ç›¸åŒçš„UNIXæ—¶é—´æˆ³ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨EXPIREå‘½ä»¤ç»™æ‰¹é‡çš„keyè®¾ç½®ç›¸åŒçš„è¿‡æœŸç§’æ•°ã€‚å› ä¸ºï¼Œè¿™éƒ½ä¼šé€ æˆå¤§é‡keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œå¯¼è‡´æ€§èƒ½å˜æ…¢ã€‚</p><p>é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œåƒä¸‡ä¸è¦å«Œéº»çƒ¦ï¼Œä½ é¦–å…ˆè¦æ ¹æ®å®é™…ä¸šåŠ¡çš„ä½¿ç”¨éœ€æ±‚ï¼Œå†³å®šEXPIREATå’ŒEXPIREçš„è¿‡æœŸæ—¶é—´å‚æ•°ã€‚å…¶æ¬¡ï¼Œå¦‚æœä¸€æ‰¹keyçš„ç¡®æ˜¯åŒæ—¶è¿‡æœŸï¼Œä½ è¿˜å¯ä»¥åœ¨EXPIREATå’ŒEXPIREçš„è¿‡æœŸæ—¶é—´å‚æ•°ä¸Šï¼ŒåŠ ä¸Šä¸€ä¸ªä¸€å®šå¤§å°èŒƒå›´å†…çš„éšæœºæ•°ï¼Œè¿™æ ·ï¼Œæ—¢ä¿è¯äº†keyåœ¨ä¸€ä¸ªé‚»è¿‘æ—¶é—´èŒƒå›´å†…è¢«åˆ é™¤ï¼Œåˆé¿å…äº†åŒæ—¶è¿‡æœŸé€ æˆçš„å‹åŠ›ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘é¦–å…ˆç»™ä½ ä»‹ç»äº†Redisæ€§èƒ½å˜æ…¢å¸¦æ¥çš„é‡è¦å½±å“ï¼Œå¸Œæœ›ä½ èƒ½å……åˆ†é‡è§†è¿™ä¸ªé—®é¢˜ã€‚æˆ‘é‡ç‚¹ä»‹ç»äº†åˆ¤æ–­Rediså˜æ…¢çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯çœ‹å“åº”å»¶è¿Ÿï¼Œä¸€ä¸ªæ˜¯çœ‹åŸºçº¿æ€§èƒ½ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜ç»™äº†ä½ ä¸¤ç§æ’æŸ¥å’Œè§£å†³Rediså˜æ…¢è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼š</p><ol>\n<li>ä»æ…¢æŸ¥è¯¢å‘½ä»¤å¼€å§‹æ’æŸ¥ï¼Œå¹¶ä¸”æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ›¿æ¢æ…¢æŸ¥è¯¢å‘½ä»¤ï¼›</li>\n<li>æ’æŸ¥è¿‡æœŸkeyçš„æ—¶é—´è®¾ç½®ï¼Œå¹¶æ ¹æ®å®é™…ä½¿ç”¨éœ€æ±‚ï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚</li>\n</ol><p>æ€§èƒ½è¯Šæ–­é€šå¸¸æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šä¸èƒ½æ¯«æ— ç›®æ ‡åœ°â€œä¹±æ‰¾â€ã€‚è¿™èŠ‚è¯¾ç»™ä½ ä»‹ç»çš„å†…å®¹ï¼Œå°±æ˜¯æ’æŸ¥å’Œè§£å†³Redisæ€§èƒ½å˜æ…¢çš„ç« æ³•ï¼Œä½ ä¸€å®šè¦æŒ‰ç…§ç« æ³•é€ä¸€æ’æŸ¥ï¼Œè¿™æ ·æ‰å¯èƒ½å°½å¿«åœ°æ‰¾å‡ºåŸå› ã€‚</p><p>å½“ç„¶ï¼Œè¦çœŸæ­£æŠŠRedisç”¨å¥½ï¼Œé™¤äº†è¦äº†è§£Redisæœ¬èº«çš„åŸç†ï¼Œè¿˜è¦äº†è§£å’ŒRedisäº¤äº’çš„å„åº•å±‚ç³»ç»Ÿçš„å…³é”®æœºåˆ¶ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€äº›éš¾ä»¥æ’æŸ¥çš„é—®é¢˜æ˜¯Redisçš„ç”¨æ³•æˆ–è®¾ç½®å’Œåº•å±‚ç³»ç»Ÿçš„å·¥ä½œæœºåˆ¶ä¸åè°ƒå¯¼è‡´çš„ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä¼šç€é‡ç»™ä½ ä»‹ç»æ–‡ä»¶ç³»ç»Ÿã€æ“ä½œç³»ç»Ÿå¯¹Redisæ€§èƒ½çš„å½±å“ï¼Œä»¥åŠç›¸åº”çš„æ’æŸ¥æ–¹æ³•å’Œè§£å†³æ–¹æ¡ˆã€‚</p><h2>æ¯è¯¾ä¸€é—®</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘æåˆ°äº†KEYSå‘½ä»¤ï¼Œå› ä¸ºå®ƒçš„å¤æ‚åº¦å¾ˆé«˜ï¼Œå®¹æ˜“å¼•èµ·Redisçº¿ç¨‹æ“ä½œé˜»å¡ï¼Œä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ä½†æ˜¯ï¼ŒKEYSå‘½ä»¤æœ¬èº«æä¾›çš„åŠŸèƒ½æ˜¯ä¸Šå±‚ä¸šåŠ¡åº”ç”¨ç»å¸¸éœ€è¦çš„ï¼Œå³è¿”å›ä¸è¾“å…¥æ¨¡å¼åŒ¹é…çš„keysã€‚</p><p>è¯·æ€è€ƒä¸€ä¸‹ï¼Œåœ¨Redisä¸­ï¼Œè¿˜æœ‰å“ªäº›å…¶ä»–å‘½ä»¤å¯ä»¥ä»£æ›¿KEYSå‘½ä»¤ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½å‘¢ï¼Ÿè¿™äº›å‘½ä»¤çš„å¤æ‚åº¦ä¼šå¯¼è‡´Rediså˜æ…¢å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼Œå…±åŒå­¦ä¹ è¿›æ­¥ã€‚å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"17 | ä¸ºä»€ä¹ˆCPUç»“æ„ä¹Ÿä¼šå½±å“Redisçš„æ€§èƒ½ï¼Ÿ","id":286082},"right":{"article_title":"19 | æ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„Redisï¼Ÿï¼ˆä¸‹ï¼‰","id":287819}},"comments":[{"had_liked":false,"id":248925,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1600359310,"is_pvip":true,"discussion_count":26,"race_medal":0,"score":"1453299305358","product_id":100056701,"comment_content":"åœ¨ Redis ä¸­ï¼Œè¿˜æœ‰å“ªäº›å…¶ä»–å‘½ä»¤å¯ä»¥ä»£æ›¿ KEYS å‘½ä»¤ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½å‘¢ï¼Ÿè¿™äº›å‘½ä»¤çš„å¤æ‚åº¦ä¼šå¯¼è‡´ Redis å˜æ…¢å—ï¼Ÿ<br><br>å¦‚æœæƒ³è¦è·å–æ•´ä¸ªå®ä¾‹çš„æ‰€æœ‰keyï¼Œå»ºè®®ä½¿ç”¨SCANå‘½ä»¤ä»£æ›¿ã€‚å®¢æˆ·ç«¯é€šè¿‡æ‰§è¡ŒSCAN $cursor COUNT $countå¯ä»¥å¾—åˆ°ä¸€æ‰¹keyä»¥åŠä¸‹ä¸€ä¸ªæ¸¸æ ‡$cursorï¼Œç„¶åæŠŠè¿™ä¸ª$cursorå½“ä½œSCANçš„å‚æ•°ï¼Œå†æ¬¡æ‰§è¡Œï¼Œä»¥æ­¤å¾€å¤ï¼Œç›´åˆ°è¿”å›çš„$cursorä¸º0æ—¶ï¼Œå°±æŠŠæ•´ä¸ªå®ä¾‹ä¸­çš„æ‰€æœ‰keyéå†å‡ºæ¥äº†ã€‚<br><br>å…³äºSCANè®¨è®ºæœ€å¤šçš„é—®é¢˜å°±æ˜¯ï¼ŒRedisåœ¨åšRehashæ—¶ï¼Œä¼šä¸ä¼šæ¼keyæˆ–è¿”å›é‡å¤çš„keyã€‚<br><br>åœ¨ä½¿ç”¨SCANå‘½ä»¤æ—¶ï¼Œä¸ä¼šæ¼keyï¼Œä½†å¯èƒ½ä¼šå¾—åˆ°é‡å¤çš„keyï¼Œè¿™ä¸»è¦å’ŒRedisçš„Rehashæœºåˆ¶æœ‰å…³ã€‚Redisçš„æ‰€æœ‰keyå­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ä¸­ï¼Œå¦‚æœå­˜å…¥çš„keyæ…¢æ…¢å˜å¤šï¼Œåœ¨è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œä¸ºäº†é¿å…å“ˆå¸Œå†²çªå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨ä¼šè¿›è¡Œæ‰©å®¹ã€‚ä¸ä¹‹å¯¹åº”çš„ï¼Œkeyæ•°é‡é€æ¸å˜å°‘æ—¶ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨ä¼šç¼©å®¹ä»¥èŠ‚çœç©ºé—´ã€‚<br><br>1ã€ä¸ºä»€ä¹ˆä¸ä¼šæ¼keyï¼ŸRedisåœ¨SCANéå†å…¨å±€å“ˆå¸Œè¡¨æ—¶ï¼Œé‡‡ç”¨*é«˜ä½è¿›ä½æ³•*çš„æ–¹å¼éå†å“ˆå¸Œæ¡¶ï¼ˆå¯ç½‘ä¸ŠæŸ¥è¯¢å›¾ä¾‹ï¼Œä¸€çœ‹å°±æ˜ç™½ï¼‰ï¼Œå½“å“ˆå¸Œè¡¨æ‰©å®¹åï¼Œé€šè¿‡è¿™ç§ç®—æ³•éå†ï¼Œæ—§å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨ï¼Œä¾æ—§ä¼šä¿ç•™åŸæ¥çš„å…ˆåé¡ºåºï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯éå†æ—¶ä¸ä¼šé—æ¼ä¹Ÿä¸ä¼šé‡å¤ã€‚<br><br>2ã€ä¸ºä»€ä¹ˆSCANä¼šå¾—åˆ°é‡å¤çš„keyï¼Ÿè¿™ä¸ªæƒ…å†µä¸»è¦å‘ç”Ÿåœ¨å“ˆå¸Œè¡¨ç¼©å®¹ã€‚å·²ç»éå†è¿‡çš„å“ˆå¸Œæ¡¶åœ¨ç¼©å®¹æ—¶ï¼Œä¼šæ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨æ²¡æœ‰éå†åˆ°çš„ä½ç½®ï¼Œæ‰€ä»¥ç»§ç»­éå†å°±ä¼šå¯¹åŒä¸€ä¸ªkeyè¿”å›å¤šæ¬¡ã€‚<br><br>SCANæ˜¯éå†æ•´ä¸ªå®ä¾‹çš„æ‰€æœ‰keyï¼Œå¦å¤–Redisé’ˆå¯¹Hash&#47;Set&#47;Sorted Setä¹Ÿæä¾›äº†HSCAN&#47;SSCAN&#47;ZSCANå‘½ä»¤ï¼Œç”¨äºéå†ä¸€ä¸ªkeyä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå»ºè®®åœ¨è·å–ä¸€ä¸ªbigkeyçš„æ‰€æœ‰æ•°æ®æ—¶ä½¿ç”¨ï¼Œé¿å…å‘ç”Ÿé˜»å¡é£é™©ã€‚<br><br>ä½†æ˜¯ä½¿ç”¨HSCAN&#47;SSCAN&#47;ZSCANå‘½ä»¤ï¼Œè¿”å›çš„å…ƒç´ æ•°é‡ä¸æ‰§è¡ŒSCANé€»è¾‘å¯èƒ½ä¸åŒã€‚æ‰§è¡ŒSCAN $cursor COUNT $countæ—¶ä¸€æ¬¡æœ€å¤šè¿”å›countä¸ªæ•°çš„keyï¼Œæ•°é‡ä¸ä¼šè¶…è¿‡countã€‚<br><br>ä½†Hash&#47;Set&#47;Sorted Setå…ƒç´ æ•°é‡æ¯”è¾ƒå°‘æ—¶ï¼Œåº•å±‚ä¼šé‡‡ç”¨intset&#47;ziplistæ–¹å¼å­˜å‚¨ï¼Œå¦‚æœä»¥è¿™ç§æ–¹å¼å­˜å‚¨ï¼Œåœ¨æ‰§è¡ŒHSCAN&#47;SSCAN&#47;ZSCANå‘½ä»¤æ—¶ï¼Œä¼šæ— è§†countå‚æ•°ï¼Œç›´æ¥æŠŠæ‰€æœ‰å…ƒç´ ä¸€æ¬¡æ€§è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾—åˆ°çš„å…ƒç´ æ•°é‡æ˜¯ä¼šå¤§äºcountå‚æ•°çš„ã€‚å½“åº•å±‚è½¬ä¸ºå“ˆå¸Œè¡¨æˆ–è·³è¡¨å­˜å‚¨æ—¶ï¼Œæ‰ä¼šçœŸæ­£ä½¿ç”¨å‘countå‚æ•°ï¼Œæœ€å¤šè¿”å›countä¸ªå…ƒç´ ã€‚","like_count":339,"discussions":[{"author":{"id":1554294,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b7/76/c0f7b705.jpg","nickname":"ğŸ˜›","note":"","ucode":"98D66B91C4E4BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325253,"discussion_content":"Kaitoå°è¯¾å ‚åˆå¼€è¯¾äº†ï¼Œä¸€ä¸ªè¯¾çš„é’±å¬ä¸¤èŠ‚ï¼Œèµšåˆ°ğŸ˜","likes_number":27,"is_delete":false,"is_hidden":false,"ctime":1605256984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"å°è¢","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306936,"discussion_content":"æ¯æ¬¡ä¸‹è¯¾åéƒ½è¦å‚åŠ è¡¥ä¹ ç­çš„æ„Ÿè§‰","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1600422241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"å°è¢","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306946,"discussion_content":"å“ˆå“ˆï¼Œä½ å’‹è¿™ä¹ˆä¼˜ç§€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600425467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306936,"ip_address":""},"score":306946,"extra":""},{"author":{"id":1739070,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/89/3e/0dd8e96b.jpg","nickname":"InfoQ_å°æ±¤","note":"","ucode":"E4C30DB7A9B54C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":530753,"discussion_content":"ä¸ºä»€ä¹ˆSCANä¼šå¾—åˆ°é‡å¤çš„keyï¼Ÿè¿™ä¸ªæƒ…å†µä¸»è¦å‘ç”Ÿåœ¨å“ˆå¸Œè¡¨ç¼©å®¹ã€‚å·²ç»éå†è¿‡çš„å“ˆå¸Œæ¡¶åœ¨ç¼©å®¹æ—¶ï¼Œä¼šæ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨æ²¡æœ‰éå†åˆ°çš„ä½ç½®ï¼Œæ‰€ä»¥ç»§ç»­éå†å°±ä¼šå¯¹åŒä¸€ä¸ªkeyè¿”å›å¤šæ¬¡\n-----------------------------------------------------\næƒ³è¯·æ•™ä¸‹ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿhashè¡¨ç¼©å®¹ æœ‰é˜ˆå€¼æˆ–è€…è§¦å‘æœºåˆ¶ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637140715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306946,"ip_address":""},"score":530753,"extra":"{\"user_type\":1}"},{"author":{"id":1411419,"avatar":"https://static001.geekbang.org/account/avatar/00/15/89/5b/b014ce14.jpg","nickname":"å°äº”","note":"","ucode":"B7B1F121837CD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1739070,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/89/3e/0dd8e96b.jpg","nickname":"InfoQ_å°æ±¤","note":"","ucode":"E4C30DB7A9B54C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542969,"discussion_content":"è´Ÿè½½å› å­ä¸º 0.1 æ—¶ä¼šè§¦å‘ rehash ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640918772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":530753,"ip_address":""},"score":542969,"extra":""}]},{"author":{"id":1178634,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fc/0a/0c4b9170.jpg","nickname":"æ³ å°å¢¨","note":"","ucode":"73D296D9F42911","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312354,"discussion_content":"æ‰§è¡ŒSCAN $cursor COUNT $countæ—¶ä¸€æ¬¡æœ€å¤šè¿”å›countä¸ªæ•°çš„keyï¼Œæ•°é‡ä¸ä¼šè¶…è¿‡countã€‚  \nè¿™å¥è¯åº”è¯¥æœ‰é—®é¢˜ï¼Œ$count æŒ‡çš„æ˜¯slotçš„æ•°é‡ï¼Œä¸æ˜¯keyçš„æ•°é‡\n\n127.0.0.1:7006> keys *\n(empty list or set)\n127.0.0.1:7006> set a 1\nOK\n127.0.0.1:7006> set aa 2\nOK\n127.0.0.1:7006> set aaa 3\nOK\n127.0.0.1:7006> scan 0 count 1\n1) &#34;1&#34;\n2) 1) &#34;a&#34;\n127.0.0.1:7006> scan 0 count 2\n1) &#34;3&#34;\n2) 1) &#34;a&#34;\n   2) &#34;aaa&#34;\n   3) &#34;aa&#34;\n127.0.0.1:7006>","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1602668874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1178634,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fc/0a/0c4b9170.jpg","nickname":"æ³ å°å¢¨","note":"","ucode":"73D296D9F42911","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312389,"discussion_content":"çœ‹äº†ä¸‹æºç ï¼Œç»“æœæ•°é‡ç¡®å®æœ‰å¯èƒ½ä¼šè¶…è¿‡countã€‚\n\nscanä¼šä¸€ç›´éå†å“ˆå¸Œæ¡¶ï¼Œä¸€ä¸ªå“ˆå¸Œæ¡¶ä¼šæœ‰å¤šä¸ªå…ƒç´ ï¼Œå½“scanæ‹¿åˆ°çš„ç»“æœä¸€æ—¦è¶…è¿‡countåï¼Œå°±ä¼šåœæ­¢éå†äº†ï¼Œæ‰€ä»¥ä¼šæœ‰è¶…è¿‡countç»“æœé›†çš„æƒ…å†µã€‚","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1602675548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":312354,"ip_address":""},"score":312389,"extra":""}]},{"author":{"id":2308075,"avatar":"","nickname":"Geek_89e362","note":"","ucode":"E596C2CFE1CFAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348059,"discussion_content":"è¿˜æœ‰ä¸€ç‚¹æ˜¯ åœ¨åˆ†ç‰‡é›†ç¾¤åœºæ™¯ä¸‹ SCAN å‘½ä»¤æ˜¯æ— æ³•è·¨èŠ‚ç‚¹æ‰«æçš„ï¼Œåªèƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªèŠ‚ç‚¹çš„è¿›è¡Œæ‰«æã€‚","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1612418351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"å‡¯æ–‡å°çŒª","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2308075,"avatar":"","nickname":"Geek_89e362","note":"","ucode":"E596C2CFE1CFAF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376415,"discussion_content":"å¯¹çš„ åˆ†ç‰‡åˆ‡å‰²å¿…å®šè¦è‡ªå·±æŸ¥è¯¢ æˆ–è€…è‡ªè¡Œèšåˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622114796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348059,"ip_address":""},"score":376415,"extra":""},{"author":{"id":1780797,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2c/3d/0bd58aa4.jpg","nickname":"Em","note":"","ucode":"32012A5C603C8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2308075,"avatar":"","nickname":"Geek_89e362","note":"","ucode":"E596C2CFE1CFAF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577430,"discussion_content":"keyså¯ä»¥è·¨èŠ‚ç‚¹å—?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656094129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348059,"ip_address":""},"score":577430,"extra":""}]},{"author":{"id":1834977,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ff/e1/ea2b6cef.jpg","nickname":"æœ‰å¤´å‘çš„ç¨‹åºå‘˜","note":"","ucode":"48B9B1C5CC4E3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307007,"discussion_content":"å¹¶ä¸”6.0é‡Œé¢ scanè¿˜å¯ä»¥æŒ‡å®šç±»å‹ã€‚ è¿™æ ·å‡å°‘ç½‘ç»œä¼ è¾“çš„æ•°æ®ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1600454079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148845,"avatar":"https://static001.geekbang.org/account/avatar/00/11/87/ad/50a85a04.jpg","nickname":"hao","note":"","ucode":"997F2B57E2F556","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321849,"discussion_content":"çœ‹è¯„è®ºæ„Ÿè§‰è¯¾ç¨‹ä¹°èµšäº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1604639266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1415619,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","nickname":"é™Œå…®","note":"","ucode":"00CE47CAECD5CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553507,"discussion_content":"mark","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645939531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217712,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/b0/b073fe8b.jpg","nickname":"aMaMiMoU","note":"","ucode":"AF1E6CA541E482","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364849,"discussion_content":"è¯·æ•™å„ä½ï¼Œç°åœ¨å¾ˆå¤šäº‘å‚å•†çš„PaaS RedisæœåŠ¡ç¦ç”¨äº†scanå’Œkeysï¼Œè¿™ç§åœºæ™¯ä¸‹æ€ä¹ˆè·å–æ‰€æœ‰keyå‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617628808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2568744,"avatar":"https://static001.geekbang.org/account/avatar/00/27/32/28/078ec46c.jpg","nickname":"topå•¦å®ƒ","note":"","ucode":"1F2656293D1B9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1217712,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/b0/b073fe8b.jpg","nickname":"aMaMiMoU","note":"","ucode":"AF1E6CA541E482","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378924,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623512592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364849,"ip_address":""},"score":378924,"extra":""}]},{"author":{"id":3201606,"avatar":"","nickname":"Geek_c5eb91","note":"","ucode":"650C7D09442F51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590693,"discussion_content":"å¤§ä½¬ï¼ŒRedisTemplate æ¸è¿›å¼scan å…ƒç´ å…¼å®¹redisé›†ç¾¤å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666007641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3201606,"avatar":"","nickname":"Geek_c5eb91","note":"","ucode":"650C7D09442F51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590686,"discussion_content":"å¤ªæœ‰æ‰äº†ï¼Œè™½ç„¶ä¿ºå¬ä¸æ‡‚ï¼Œä½†ç‚¹è¯„çš„å¾ˆç‰›é€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666003746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559708,"discussion_content":"é«˜ä½è¿›ä½æ³•ï¼š\nhttps://blog.csdn.net/u014439693/article/details/108325632","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648892095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526471,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/c7/0cff4a59.jpg","nickname":"æœ¨æœ¨å¤•","note":"","ucode":"EA5D709D0DE50E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361216,"discussion_content":"ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP è¯¾ä»£è¡¨èƒ½è§£é‡Šä¸€ä¸‹è¿™ä¸ªå‚æ•°å—ï¼Ÿä¸å¤ªæ‡‚è¿™ä¸ªä»£è¡¨å•¥æ„æ€ï¼Œæ˜¯åˆ é™¤è¿™ä¸ªå‚æ•°ä¸­é…ç½®çš„è¿‡æœŸkeyæ•°é‡å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616609348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1295609,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJRFRX8kNzNet7FibNvtavbVpAwK09AhIhrib9k762qWtH6mre8ickP7hM5mgZC4ytr8NnmIfmAhxMSQ/132","nickname":"è€å¤§ä¸å°","note":"","ucode":"35BCDD3CB13467","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526471,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/c7/0cff4a59.jpg","nickname":"æœ¨æœ¨å¤•","note":"","ucode":"EA5D709D0DE50E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369564,"discussion_content":"æ˜¯çš„ï¼Œå¤§å…„å¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619082740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361216,"ip_address":""},"score":369564,"extra":""}]},{"author":{"id":1879262,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ac/de/68f35320.jpg","nickname":"å°æ¥å­","note":"","ucode":"4EDAF31E43B211","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344576,"discussion_content":"åœ¨å‡ ä¸‡ä¸ªKV(stringç±»å‹)çš„ä¸šåŠ¡åœºæ™¯ä¸­, åˆ†æ®µscanæ“ä½œåº”è¯¥å¯¹redisæ²¡æœ‰ä»€ä¹ˆå½±å“~.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611502944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148845,"avatar":"https://static001.geekbang.org/account/avatar/00/11/87/ad/50a85a04.jpg","nickname":"hao","note":"","ucode":"997F2B57E2F556","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321850,"discussion_content":":)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604639274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763046,"avatar":"","nickname":"ä¸å›å…±å‹‰","note":"","ucode":"1FB5EBFCF510A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312105,"discussion_content":"æˆ‘ä¸€ç›´åœ¨æŸ¥èµ„æ–™å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œç°åœ¨ç»ˆäºæ‰¾åˆ°äº†ï¼Œæ„Ÿè°¢è€å“¥ï¼Œé’¦ä½©ä¸å·²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602583302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"å›å“¥èŠæŠ€æœ¯","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306778,"discussion_content":"ç ”ç©¶å¤ªæ·±å…¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600388215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"å›å“¥èŠæŠ€æœ¯","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306786,"discussion_content":"ä¸æ·±å…¥ï¼Œæºç å†™çš„æ¸…æ™°ï¼Œçœ‹ä¸€ä¸‹å°±æ˜ç™½äº†å“ˆï½","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600390130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306778,"ip_address":""},"score":306786,"extra":""},{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"æ¶›å“¥å“¥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":336290,"discussion_content":"å¤ªè°¦è™šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608545322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306786,"ip_address":""},"score":336290,"extra":""}]}]},{"had_liked":false,"id":248953,"user_name":"é’é’å­è¡¿","can_delete":false,"product_type":"c1","uid":1438102,"ip_address":"","ucode":"4A388A3BA70C29","user_header":"https://static001.geekbang.org/account/avatar/00/15/f1/96/9571fa3d.jpg","comment_is_top":false,"comment_ctime":1600391519,"is_pvip":false,"discussion_count":9,"race_medal":0,"score":"280773265759","product_id":100056701,"comment_content":"å½“ä½ å‘ç° Redis æ€§èƒ½å˜æ…¢æ—¶ï¼Œå¯ä»¥é€šè¿‡ Redis æ—¥å¿—ï¼Œæˆ–è€…æ˜¯ latency monitor å·¥å…·ï¼ŒæŸ¥è¯¢å˜æ…¢çš„è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¯¹åº”çš„å…·ä½“å‘½ä»¤ä»¥åŠå®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤ä¸‹æ˜¯å¦é‡‡ç”¨äº†å¤æ‚åº¦é«˜çš„æ…¢æŸ¥è¯¢å‘½ä»¤ã€‚<br>å…¶å®è¿™ä¸ªæ’é™¤è¿‡ç¨‹æ‰æ˜¯æˆ‘ä»¬æœ€æƒ³å­¦ä¹ çš„ï¼Œå´è¢«ä½œè€…ä¸€å¸¦è€Œè¿‡äº†ã€‚ã€‚ã€‚ã€‚","like_count":66,"discussions":[{"author":{"id":1606581,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJIIibocUHNRgafeNUvibW0YI2v1qDaiaZCVQ37FcrMs0ettIDD0snhsy4Ac2ADnLmjM7KGNeznj2hrg/132","nickname":"ä¸€åå…­å¤œ","note":"","ucode":"41D4A6695B2A7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306881,"discussion_content":"æˆ‘åœ¨çœ‹esé‚£é—¨è¯¾çš„æ—¶å€™ä¹Ÿæ˜¯ï¼Œå¥½å¤šé‡è¦çš„è¿‡ç¨‹ç›´æ¥è¢«è·³è¿‡äº†","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1600410064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030449,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b9/31/636e9007.jpg","nickname":"melo","note":"","ucode":"BF381B18E75867","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335372,"discussion_content":"slowlog get","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1608175142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589905,"discussion_content":"ä½ æƒ³çŸ¥é“å¦‚ä½•æ’æŸ¥å¾—ç»§ç»­èŠ±é’±ï¼Œä¸èŠ±é’±å°±åƒå…è´¹æ‹¿åˆ°å—ï¼Ÿå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665390292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2276763,"avatar":"https://static001.geekbang.org/account/avatar/00/22/bd/9b/366bb87b.jpg","nickname":"é£é¾™","note":"","ucode":"EC83FE73985491","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582341,"discussion_content":"æœ€ç®€å•å°±æ˜¯å…ˆç”¨slowlogæŸ¥çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659403970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1488020,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","nickname":"è¿½é£ç­çš„äºº","note":"","ucode":"2993D60F94C396","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565750,"discussion_content":"é’é’å­è¡¿ï¼Œæ‚ æ‚ æˆ‘å¿ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650535000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333669,"discussion_content":"æˆ‘ä»¬æ˜¯è‡ªç ”çš„å®¢æˆ·ç«¯ç»„ä»¶ ç›‘å¬å®¢æˆ·ç«¯çš„å¹³å‡é€Ÿåº¦ã€‚ã€‚åé¦ˆåˆ°æŠ¥è­¦ä¸­å¿ƒã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607589453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033363,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c4/93/9dd4b277.jpg","nickname":"HACK_QC","note":"","ucode":"623FA185569F9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309117,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—ï¼Œä¹Ÿæ²¡æœ‰å…·ä½“çš„ä¸¾ä¾‹å­æ€ä¹ˆæ¥æ‰¾ï¼Œä¸ç„¶è·Ÿç½‘ä¸Šæ•™ç¨‹æ²¡åŒºåˆ«äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601190919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"å°è¢","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306937,"discussion_content":"è¿™ä¸ªåº”è¯¥ä¸å¤æ‚å§ã€‚æˆ‘çŒœè·Ÿmysqlçš„æ…¢æŸ¥è¯¢æ—¥å¿—ä¸€æ ·ï¼Œç½‘ä¸Šåº”è¯¥æœ‰æ•™ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600422309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1438102,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f1/96/9571fa3d.jpg","nickname":"é’é’å­è¡¿","note":"","ucode":"4A388A3BA70C29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"å°è¢","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307446,"discussion_content":"å‘ç°é—®é¢˜æ‰¾åˆ°é—®é¢˜åŸå› å¾€å¾€æ˜¯æ¯”è§£å†³é—®é¢˜æ›´é‡è¦çš„èƒ½åŠ›","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1600653224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":306937,"ip_address":""},"score":307446,"extra":""}]}]},{"had_liked":false,"id":252516,"user_name":"bbbi","can_delete":false,"product_type":"c1","uid":1682175,"ip_address":"","ucode":"9A539AEF791428","user_header":"https://static001.geekbang.org/account/avatar/00/19/aa/ff/e2c331e0.jpg","comment_is_top":false,"comment_ctime":1602325322,"is_pvip":false,"replies":[{"id":"92226","content":"Redis clusteræ¨¡å¼ä¸‹ä¸æ”¯æŒè·¨èŠ‚ç‚¹çš„SCANæ“ä½œï¼Œè¦æƒ³å¾—åˆ°æ•´ä¸ªé›†ç¾¤çš„SCANç»“æœï¼Œå¯ä»¥éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«è¿›è¡ŒSCANæ“ä½œï¼Œç„¶ååœ¨å®¢æˆ·ç«¯åˆå¹¶ç»“æœã€‚<br><br>å¦å¤–æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯å¯ä»¥ç”¨Hash Tagï¼Œä¹Ÿå°±æ˜¯åœ¨é”®å€¼å¯¹çš„keyä¸­ä½¿ç”¨èŠ±æ‹¬å·{}ï¼Œä¾‹å¦‚{user:}1, {user:}2è¿™æ ·ã€‚Redis clusterä¼šé’ˆå¯¹èŠ±æ‹¬å·ä¸­çš„éƒ¨åˆ†è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·å¯ä»¥æŠŠå…·æœ‰ç›¸åŒå‰ç¼€çš„keyåˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½é‡Œé¢ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ½œåœ¨é£é™©æ˜¯ï¼šå¤§é‡ç›¸åŒå‰ç¼€çš„keyè¢«åˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½é‡Œé¢äº†ï¼Œä¼šå¯¼è‡´æ•°æ®åœ¨å“ˆå¸Œæ§½ä¹‹é—´åˆ†å¸ƒä¸å‡è¡¡ã€‚å¦‚æœè¦ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œéœ€è¦è¯„ä¼°ä¸‹keyçš„åˆ†å¸ƒæƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è’‹å¾·é’§","uid":"1609687","ctime":1602390172,"ip_address":"","comment_id":252516,"utype":1}],"discussion_count":2,"race_medal":0,"score":"91796638538","product_id":100056701,"comment_content":"é’ˆå¯¹redis-clusterè¿˜å¯ä»¥ä½¿ç”¨scanå‘½ä»¤ä¹ˆï¼Ÿ","like_count":22,"discussions":[{"author":{"id":1609687,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8f/d7/fb60129d.jpg","nickname":"è’‹å¾·é’§","note":"","ucode":"833985C2C37C0A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506795,"discussion_content":"Redis clusteræ¨¡å¼ä¸‹ä¸æ”¯æŒè·¨èŠ‚ç‚¹çš„SCANæ“ä½œï¼Œè¦æƒ³å¾—åˆ°æ•´ä¸ªé›†ç¾¤çš„SCANç»“æœï¼Œå¯ä»¥éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«è¿›è¡ŒSCANæ“ä½œï¼Œç„¶ååœ¨å®¢æˆ·ç«¯åˆå¹¶ç»“æœã€‚\n\nå¦å¤–æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯å¯ä»¥ç”¨Hash Tagï¼Œä¹Ÿå°±æ˜¯åœ¨é”®å€¼å¯¹çš„keyä¸­ä½¿ç”¨èŠ±æ‹¬å·{}ï¼Œä¾‹å¦‚{user:}1, {user:}2è¿™æ ·ã€‚Redis clusterä¼šé’ˆå¯¹èŠ±æ‹¬å·ä¸­çš„éƒ¨åˆ†è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·å¯ä»¥æŠŠå…·æœ‰ç›¸åŒå‰ç¼€çš„keyåˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½é‡Œé¢ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ½œåœ¨é£é™©æ˜¯ï¼šå¤§é‡ç›¸åŒå‰ç¼€çš„keyè¢«åˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½é‡Œé¢äº†ï¼Œä¼šå¯¼è‡´æ•°æ®åœ¨å“ˆå¸Œæ§½ä¹‹é—´åˆ†å¸ƒä¸å‡è¡¡ã€‚å¦‚æœè¦ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œéœ€è¦è¯„ä¼°ä¸‹keyçš„åˆ†å¸ƒæƒ…å†µã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602390172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559711,"discussion_content":"è€å¸ˆåŒå­¦å¥½ï¼ŒRedis clusteræ¨¡å¼ï¼Œåœ¨ä»£ç å±‚ï¼Œä¸æ˜¯æä¾›ç»Ÿä¸€çš„æ“ä½œæ¥å£å—ï¼Œä¹Ÿå°±æ˜¯å¯¹å¼€å‘äººå‘˜æ˜¯é€æ˜çš„ï¼Œéš¾é“è¿˜éœ€è¦åœ¨ä»£ç å±‚é¢ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œscanï¼Œç„¶åèšåˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648892640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270926,"user_name":"Geek_9b08a5","can_delete":false,"product_type":"c1","uid":2392536,"ip_address":"","ucode":"CF08E141456F24","user_header":"","comment_is_top":false,"comment_ctime":1609320026,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"74623764058","product_id":100056701,"comment_content":"ç¬¬åå…«è¯¾ï¼š<br>1.ä½œè€…è®²äº†ä»€ä¹ˆï¼Ÿ<br>\tå½“redisæŸ¥è¯¢å˜æ…¢äº†æ€ä¹ˆåŠï¼Œå¦‚ä½•æ’æŸ¥ï¼Œå¦‚ä½•è¿›è¡Œå¤„ç†ï¼Ÿ<br>2.ä½œè€…æ˜¯æ€ä¹ˆæŠŠè¿™ä»¶äº‹å°†æ˜ç™½çš„ï¼Ÿ<br>\t1ã€é€šè¿‡åˆ†ærediså„ç»„ä»¶åŠç¡¬ä»¶ï¼Œæ‰¾å‡ºé—®é¢˜æ‰€åœ¨<br>3.ä¸ºäº†è®²æ˜ç™½ï¼Œä½œè€…è®²äº†å“ªäº›è¦ç‚¹ï¼Œå“ªäº›äº®ç‚¹ï¼Ÿ<br>\t1ã€äº®ç‚¹ï¼šé€šè¿‡redis-cli --intrinsic-latency 120å¯ä»¥å¾—çŸ¥redisçš„åŸºå‡†çº¿ã€‚åç»­å¯ä»¥æ ¹æ®åŸºå‡†çº¿çš„å“åº”é€Ÿåº¦è¿›è¡Œåˆ¤æ–­æ˜¯å¦æŸ¥è¯¢æ…¢ï¼Œè¿™æ˜¯æˆ‘ä¹‹å‰æ‰€ä¸çŸ¥é“çš„åˆ¤æ–­æ–¹æ³•<br>\t2ã€è¦ç‚¹ï¼šåŸºäºè‡ªå·±å¯¹ Redis æœ¬èº«çš„å·¥ä½œåŸç†çš„ç†è§£ï¼Œå¹¶ä¸”ç»“åˆå’Œå®ƒäº¤äº’çš„æ“ä½œç³»ç»Ÿã€å­˜å‚¨ä»¥åŠç½‘ç»œç­‰å¤–éƒ¨ç³»ç»Ÿå…³é”®æœºåˆ¶ï¼Œå†å€ŸåŠ©ä¸€äº›è¾…åŠ©å·¥å…·æ¥å®šä½åŸå› ï¼Œå¹¶åˆ¶å®šè¡Œä¹‹æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ<br>\t3ã€è¦ç‚¹ï¼šRedis è‡ªèº«æ“ä½œç‰¹æ€§çš„å½±å“<br>\t\t1. æ…¢æŸ¥è¯¢å‘½ä»¤ï¼šå‘½ä»¤æ“ä½œçš„å¤æ‚åº¦æœ‰å…³<br>\t\t\tæ’æŸ¥æ–¹æ³•ï¼šé€šè¿‡ Redis æ—¥å¿—ï¼Œæˆ–è€…æ˜¯ latency monitor å·¥å…·ï¼ŒæŸ¥è¯¢å˜æ…¢çš„è¯·æ±‚<br>\t\t\tè§£å†³æ–¹æ³•ï¼š1.ç”¨å…¶ä»–é«˜æ•ˆå‘½ä»¤ä»£æ›¿ã€‚å¦‚ä¸è¦ä½¿ç”¨keysæŸ¥è¯¢æ‰€æœ‰keyï¼Œå¯ä»¥ä½¿ç”¨scanè¿›è¡ŒæŸ¥è¯¢ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹<br>\t\t\t\t\t  2.å½“ä½ éœ€è¦æ‰§è¡Œæ’åºã€äº¤é›†ã€å¹¶é›†æ“ä½œæ—¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å®Œæˆï¼Œè€Œä¸è¦ç”¨ SORTã€SUNIONã€SINTER è¿™äº›å‘½ä»¤ï¼Œä»¥å…æ‹–æ…¢ Redis å®ä¾‹ã€‚<br>\t\t2.è¿‡æœŸ key æ“ä½œï¼šredisæœ¬èº«çš„å†…å­˜å›æ”¶æœºåˆ¶ä¼šé€ æˆredisæ“ä½œé˜»å¡ï¼Œå¯¼è‡´æ€§èƒ½å˜æ…¢ï¼ˆRedis 4.0 åå¯ä»¥ç”¨å¼‚æ­¥çº¿ç¨‹æœºåˆ¶æ¥å‡å°‘é˜»å¡å½±å“ï¼‰<br>\t\t    å¯¼è‡´åŸå› ï¼šå¤§æ‰¹é‡çš„keyåŒæ—¶é—´å†…è¿‡æœŸï¼Œå¯¼è‡´åˆ é™¤è¿‡æœŸkeyçš„æœºåˆ¶ä¸€ç›´è§¦å‘ï¼Œå¼•èµ·redisæ“ä½œé˜»å¡<br>\t\t\tè§£å†³æ–¹æ³•ï¼šå¯¹keyè®¾å®šè¿‡æœŸæ—¶é—´æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªåˆ é™¤çš„æ—¶é—´éšæœºæ•°ï¼Œèƒ½é¿å…keyå­˜åœ¨åŒä¸€æ—¶é—´è¿‡æœŸ<br>\t4ã€è¦ç‚¹ï¼šredisåˆ é™¤è¿‡æœŸkeyçš„æœºåˆ¶ï¼Œæ¯100æ¯«ç§’å¯¹ä¸€äº›keyè¿›è¡Œåˆ é™¤ã€‚ç®—æ³•å¦‚ä¸‹<br>\t\t1.é‡‡æ · ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP ä¸ªæ•°çš„ keyï¼Œå¹¶å°†å…¶ä¸­è¿‡æœŸçš„ key å…¨éƒ¨åˆ é™¤ï¼›<br>\t\t2.å¦‚æœè¶…è¿‡ 25% çš„ key è¿‡æœŸäº†ï¼Œåˆ™é‡å¤åˆ é™¤çš„è¿‡ç¨‹ï¼Œç›´åˆ°è¿‡æœŸ key çš„æ¯”ä¾‹é™è‡³ 25% ä»¥ä¸‹ã€‚<br><br>4.å¯¹äºä½œè€…æ‰€è®²çš„ï¼Œæˆ‘æœ‰å“ªäº›å‘æ•£æ€§æ€è€ƒï¼Ÿ<br><br>5.å°†æ¥åœ¨å“ªäº›åœºæ™¯é‡Œï¼Œæˆ‘èƒ½å¤Ÿä½¿ç”¨å®ƒï¼Ÿ<br><br>6.ç•™è¨€åŒºæ”¶è·<br>\t1.åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨scanæ›¿ä»£keyså‘½ä»¤ï¼ˆç­”æ¡ˆæ¥è‡ª@kaito å¤§ä½¬ï¼‰<br>\t\tå½“scanåœ¨Redisåœ¨åšRehashæ—¶ï¼Œä¼šä¸ä¼šæ¼keyæˆ–è¿”å›é‡å¤çš„keyï¼Ÿ<br>\t\t\t1.ä¸æ¼keysï¼šRedisåœ¨SCANéå†å…¨å±€å“ˆå¸Œè¡¨æ—¶ï¼Œé‡‡ç”¨*é«˜ä½è¿›ä½æ³•*çš„æ–¹å¼éå†å“ˆå¸Œæ¡¶ï¼ˆå¯ç½‘ä¸ŠæŸ¥è¯¢å›¾ä¾‹ï¼Œä¸€çœ‹å°±æ˜ç™½ï¼‰ï¼Œå½“å“ˆå¸Œè¡¨æ‰©å®¹åï¼Œé€šè¿‡è¿™ç§ç®—æ³•éå†ï¼Œæ—§å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨ï¼Œä¾æ—§ä¼šä¿ç•™åŸæ¥çš„å…ˆåé¡ºåºï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯éå†æ—¶ä¸ä¼šé—æ¼ä¹Ÿä¸ä¼šé‡å¤ã€‚<br>\t\t\t2.keyé‡å¤ï¼šè¿™ä¸ªæƒ…å†µä¸»è¦å‘ç”Ÿåœ¨å“ˆå¸Œè¡¨ç¼©å®¹ã€‚å·²ç»éå†è¿‡çš„å“ˆå¸Œæ¡¶åœ¨ç¼©å®¹æ—¶ï¼Œä¼šæ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨æ²¡æœ‰éå†åˆ°çš„ä½ç½®ï¼Œæ‰€ä»¥ç»§ç»­éå†å°±ä¼šå¯¹åŒä¸€ä¸ªkeyè¿”å›å¤šæ¬¡ã€‚å¤„ç†æ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯ç›´æ¥åšé‡å¤è¿‡æ»¤<br>\t2.åœ¨redis-clusterä¸­ï¼Œä¸èƒ½ä½¿ç”¨ä¸€æ¬¡scanåœ¨æ•´ä¸ªé›†ç¾¤ä¸­è·å–æ‰€æœ‰çš„keyï¼Œåªèƒ½é€šè¿‡åœ¨æ¯ä¸ªå®ä¾‹ä¸Šå•ç‹¬æ‰§è¡Œscanæ‰å¯ä»¥ï¼Œå†åˆ°å®¢æˆ·ç«¯è¿›è¡Œåˆå¹¶\t","like_count":18,"discussions":[{"author":{"id":2829144,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/2b/58/4a67284d.jpg","nickname":"ä¹æœˆæ¸…æ™¨æŸ³æˆè«","note":"","ucode":"431713477304F9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556815,"discussion_content":"éå‡¡å“¥ åé¢ä¹Ÿæ²¡çœ‹åˆ°è¯„è®ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647522419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3190922,"avatar":"","nickname":"Geek_590385","note":"","ucode":"BE5BDD9180FA0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2829144,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/2b/58/4a67284d.jpg","nickname":"ä¹æœˆæ¸…æ™¨æŸ³æˆè«","note":"","ucode":"431713477304F9","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":590460,"discussion_content":"o","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665764147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":556815,"ip_address":"æ±Ÿè¥¿"},"score":590460,"extra":""}]},{"author":{"id":1236156,"avatar":"https://static001.geekbang.org/account/avatar/00/12/dc/bc/3c5a1634.jpg","nickname":"Loyalty","note":"","ucode":"C23EE6878580C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407535,"discussion_content":"å“¥ä»¬å„¿æ€ä¹ˆæ¢IDäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635052406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248950,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1600391203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31665162275","product_id":100056701,"comment_content":"é€šå¸¸çº¿ä¸Šæ˜¯ä¸èƒ½ä½¿ç”¨keysçš„ï¼Œæ ‡å‡†æ›¿ä»£æ–¹æ¡ˆå°±æ˜¯scanã€‚scanä¸ä¼šå¯¼è‡´rediså˜æ…¢ï¼Œåªæ˜¯å¦‚æœåœ¨scanè¿‡ç¨‹ä¸­kvè¡¨æ‰©å®¹çš„è¯å¯èƒ½ä¼šé‡åˆ°é‡å¤keyã€‚<br>PSï¼šsortçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N+M*log(M)) æ˜¯å› ä¸ºéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°å­—ï¼Œå¹¶ä¸”ç”¨å¿«æ’å»æ’åºã€‚","like_count":7},{"had_liked":false,"id":265624,"user_name":"èŒƒé—²","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1606963754,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23081800234","product_id":100056701,"comment_content":"å¯ä»¥åˆ©ç”¨scanå‘½ä»¤ã€‚ä½†æ˜¯scanå¯èƒ½ä¼šè¿”å›é‡å¤keyï¼Œä½¿ç”¨æ–¹åšä¸ªå»é‡å³å¯ã€‚","like_count":5},{"had_liked":false,"id":255241,"user_name":"ç‹ç›Šæ–°","can_delete":false,"product_type":"c1","uid":1115160,"ip_address":"","ucode":"459CC11CB1DF1F","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/18/d5cb509f.jpg","comment_is_top":false,"comment_ctime":1603288710,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"14488190598","product_id":100056701,"comment_content":"&quot;é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis æ¯ 100 æ¯«ç§’ä¼šåˆ é™¤ä¸€äº›è¿‡æœŸ keyï¼Œå…·ä½“çš„ç®—æ³•å¦‚ä¸‹ï¼šé‡‡æ · ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP ä¸ªæ•°çš„ keyï¼Œå¹¶å°†å…¶ä¸­è¿‡æœŸçš„ key å…¨éƒ¨åˆ é™¤ï¼ŒACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPé»˜è®¤æ˜¯ 20ï¼Œé‚£ä¹ˆï¼Œä¸€ç§’å†…åŸºæœ¬æœ‰ 200 ä¸ªè¿‡æœŸ key ä¼šè¢«åˆ é™¤ã€‚&quot;<br><br>è¿™é‡Œçš„é‡‡æ ·æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè·å–ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPä¸ªè¿‡æœŸçš„keyå—ï¼Ÿé‚£ä¸ºä»€ä¹ˆè¯´æ˜¯å…¶ä¸­è¿‡æœŸçš„keyï¼Ÿ<br><br>å¦‚æœé‡‡æ ·å¾—åˆ°çš„ä¸å…¨æ˜¯è¿‡æœŸçš„keyï¼Œä¸€ç§’å†…æ€ä¹ˆè¿˜ä¼šæœ‰ 200 ä¸ªè¿‡æœŸ key ä¼šè¢«åˆ é™¤ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1961855,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/ef/7f/8b69e4aa.jpg","nickname":"äºŒæœˆ","note":"","ucode":"0624B1B40CDBF9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375558,"discussion_content":"ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ã€‚ã€‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621743386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028938,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/8a/dc9a23a1.jpg","nickname":"ç»­è´¹ä¸“ç”¨","note":"","ucode":"1B585A131B64B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388469,"discussion_content":"ä½œè€…å†™ä½œèƒ½åŠ›æœ‰ç‚¹å·®ã€‚ã€‚çœ‹äº†è¿™ä¹ˆå¤šï¼Œå·²ç»ä¹ æƒ¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628774595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"æ´—æ´—ç¡å§","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385540,"discussion_content":"é‡‡æ ·çš„ç»“æœä¸­æ˜¯éƒ¨åˆ†è¿‡æœŸï¼Œæç«¯æƒ…å†µå…¨éƒ¨è¿‡æœŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627119537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2105385,"avatar":"","nickname":"Geek_d421ea","note":"","ucode":"A8C2EA51542650","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325781,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605429506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248963,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1600392458,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"14485294346","product_id":100056701,"comment_content":"å‰æ®µæ—¶é—´æ—¶é—´åˆšå¥½çœ‹äº†redisé‡Œsortçš„å®ç°ï¼Œè¯´è¯´çš„æˆ‘çš„ç†è§£ã€‚sortæ˜¯åŸºäºBentley &amp; McIlroy&#39;s Engineering a Sort Functionã€‚å¯ä»¥è®¤ä¸ºæ˜¯partial qsortï¼Œåªä¿è¯æŒ‡å®šè¿”å›çš„æ•°æ®ï¼ˆå‡½æ•°å‚æ•°é‡Œçš„lrangeå’Œrrangeï¼‰æœ‰åºå³å¯ã€‚åœ¨å…ƒç´ ä¸ªæ•°å°äº7çš„æ—¶å€™ï¼Œé‡‡ç”¨æ’å…¥æ’åºï¼Œå› ä¸ºå…ƒç´ ä¸ªæ•°å°çš„æ—¶å€™ï¼Œå¿«é€Ÿæ’åºå¹¶ä¸é«˜æ•ˆã€‚å…ƒç´ ä¸ªæ•°å¤§å¤§äº7çš„æ—¶å€™ï¼Œé‡‡ç”¨å¿«é€Ÿæ’åºï¼Œç»è¿‡è¿™äº›ä¼˜åŒ–ä¹‹åï¼ŒSORTæ“ä½œå¤æ‚åº¦ä¸º O(N+M*log(M))ã€‚","like_count":3},{"had_liked":false,"id":254970,"user_name":"å”æœé¦–éƒ½","can_delete":false,"product_type":"c1","uid":1081233,"ip_address":"","ucode":"F72655AE0AE4CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/91/962eba1a.jpg","comment_is_top":false,"comment_ctime":1603243251,"is_pvip":true,"discussion_count":8,"race_medal":0,"score":"5898210547","product_id":100056701,"comment_content":"å®šæ—¶åˆ é™¤æ˜¯ä¸ªå¼‚æ­¥æµç¨‹å§ï¼Ÿä¸ºå•¥ä¼šæ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Ÿæ˜¯è¦åˆ é™¤çš„keyç‰¹åˆ«å¤šä¼šå¯¼è‡´cpuè¢«å¤§é‡å ç”¨ï¼Œå½±å“äº†ä¸»çº¿ç¨‹è°ƒç”¨ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"ä¸‹ä¸ªç›®æ ‡45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339634,"discussion_content":"å¦‚æœæ²¡æœ‰é…ç½®æƒ°æ€§åˆ é™¤çš„è¯ , é‡Šæ”¾å†…å­˜æ—¶é—´å¤æ‚åº¦å‡è®¾ä¸ºO(1)(æœ€ä¼˜æƒ…å†µ),å¤šä¸ªkeyåˆ é™¤å°±æ˜¯O(n)äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609749670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2392536,"avatar":"","nickname":"Geek_9b08a5","note":"","ucode":"CF08E141456F24","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338594,"discussion_content":"redis 4.0ç‰ˆæœ¬åæ‰æ”¯æŒçš„å¼‚æ­¥çº¿ç¨‹åˆ é™¤æœºåˆ¶ï¼Œå¦‚æœæ˜¯4.0ç‰ˆæœ¬ä¹‹å‰ï¼Œè‚¯å®šå°±åœ¨redisä¸»çº¿ç¨‹ä¸­ï¼Œé‚£å°±ä¼šé˜»å¡æ“ä½œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609319752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"æ´—æ´—ç¡å§","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385541,"discussion_content":"æˆ‘å°è±¡ä¸­æ˜¯åŒæ­¥çš„ï¼Œåœ¨redisçš„ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627119603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1738455,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/86/d7/bfd9e42a.jpg","nickname":"è½¨è¿¹","note":"","ucode":"6C9619A0B60CDD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358313,"discussion_content":"åŒé—®ï¼Œå®šæ—¶åˆ é™¤æ˜¯åå°çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆä¸ºäº§ç”Ÿé˜»å¡ï¼Ÿæ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦æŠŠé‡Šæ”¾æ‰çš„å†…å­˜å—æ’å…¥ä¸€ä¸ªç©ºé—²å†…å­˜å—çš„é“¾è¡¨ï¼Œè¿™ä¸ªæ“ä½œå¯¼è‡´çš„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615963551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124495,"avatar":"https://static001.geekbang.org/account/avatar/00/11/28/8f/f4d14c03.jpg","nickname":"Hm_","note":"","ucode":"24C176E95EEA3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337422,"discussion_content":"åŒé—®ï¼Œæˆ‘è®°å¾—çœ‹æœ‰æœ¬ä¹¦ä¸Šè¯´çš„æ˜¯åˆ é™¤åˆ†ä¸¤ç§ï¼Œå®šæ—¶åˆ é™¤å’Œè¯·æ±‚è§¦å‘çš„æƒ°æ€§åˆ é™¤ï¼Œå®šæ—¶çš„åº”è¯¥æ˜¯ä¸ªåå°ä»»åŠ¡å§ï¼Œä¸ºä»€ä¹ˆä¼šé˜»å¡å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608900341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2392536,"avatar":"","nickname":"Geek_9b08a5","note":"","ucode":"CF08E141456F24","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1124495,"avatar":"https://static001.geekbang.org/account/avatar/00/11/28/8f/f4d14c03.jpg","nickname":"Hm_","note":"","ucode":"24C176E95EEA3B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338596,"discussion_content":"å®šæ—¶åˆ é™¤ï¼šé»˜è®¤æ¯ç§’æ˜¯10æ¬¡çš„è¿‡æœŸæ‰«æ                                                         æƒ°æ€§åˆ é™¤ï¼šå½“å®¢æˆ·ç«¯è®¿é—®keyæ—¶ï¼Œå¯¹keyçš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœè¿‡æœŸå°±ç«‹å³åˆ é™¤ã€‚                        å¼‚æ­¥çº¿ç¨‹åˆ é™¤æœºåˆ¶æ˜¯åœ¨4.0ç‰ˆæœ¬åæ‰æ”¯æŒçš„                                                   ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609319952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337422,"ip_address":""},"score":338596,"extra":""},{"author":{"id":1148174,"avatar":"https://static001.geekbang.org/account/avatar/00/11/85/0e/e6640576.jpg","nickname":"é˜¿å£°","note":"","ucode":"EEA5F2E9D4FC9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1124495,"avatar":"https://static001.geekbang.org/account/avatar/00/11/28/8f/f4d14c03.jpg","nickname":"Hm_","note":"","ucode":"24C176E95EEA3B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563571,"discussion_content":"å®šæ—¶åˆ é™¤ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œåªä¸è¿‡ä¸æ˜¯æ¯æ¬¡æ‰§è¡Œå‘½ä»¤åéƒ½è¿›è¡Œæ‰«æã€åˆ é™¤ï¼Œè€Œæ˜¯æ ¹æ®é…ç½®çš„æ—¶é—´é—´éš”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650026090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337422,"ip_address":""},"score":563571,"extra":""}]},{"author":{"id":2172420,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/r2nR7Zkl5RP7LobsNKJ6wmmtyXrh4alNSAOldx1y1PSeFB1J2I14HE4I0BCgicPhubIOibPZAENzEpHEWTFjMNqg/132","nickname":"è‘£è‘£","note":"","ucode":"C222E275545158","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334797,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607994034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252715,"user_name":"å–µå–µå–µ","can_delete":false,"product_type":"c1","uid":1211713,"ip_address":"","ucode":"E3AD8BF42E19DF","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/41/3c5b770b.jpg","comment_is_top":false,"comment_ctime":1602464454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5897431750","product_id":100056701,"comment_content":"æ‰“å¡","like_count":1},{"had_liked":false,"id":359879,"user_name":"Geek_c5eb91","can_delete":false,"product_type":"c1","uid":3201606,"ip_address":"æ±Ÿè¥¿","ucode":"650C7D09442F51","user_header":"","comment_is_top":false,"comment_ctime":1666007680,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1666007680","product_id":100056701,"comment_content":"è€å¸ˆï¼ŒRedisTemplate æ¸è¿›å¼scan å…ƒç´ å…¼å®¹redisé›†ç¾¤å—","like_count":0},{"had_liked":false,"id":354397,"user_name":"Geek_b14c55","can_delete":false,"product_type":"c1","uid":2027632,"ip_address":"æµ™æ±Ÿ","ucode":"C98EAEC045F13D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/MOuCWWOnoQjOr8KjicQ84R7xu6DRcfDv3VAuHseGJ1gxXicKJboA24vOcrcJickTJPwFAU38VuwCGGkGq7f8WkTIg/132","comment_is_top":false,"comment_ctime":1660359668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660359668","product_id":100056701,"comment_content":"å¯ä»¥ä½¿ç”¨SCANæ¥ä»£æ›¿keys å‘½ä»¤ï¼ŒSCANæ˜¯å…¨è¡¨æ‰«","like_count":0},{"had_liked":false,"id":354358,"user_name":"æ—é›ªæ‰","can_delete":false,"product_type":"c1","uid":2997047,"ip_address":"ä¸Šæµ·","ucode":"9BD26FB9412D63","user_header":"","comment_is_top":false,"comment_ctime":1660297362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660297362","product_id":100056701,"comment_content":"`---ts=2022-08-12 14:39:45;thread_name=DubboServerHandler-10.11.113.168:18001-thread-32;id=2fc;is_daemon=true;priority=5;TCCL=org.springframework.boot.loader.LaunchedURLClassLoader@6aaa5eb0<br>        +---[0.00187ms] io.lettuce.core.internal.AbstractInvocationHandler$MethodTranslator:get() #62<br><br>    `---[16.727451ms] io.lettuce.core.FutureSyncInvocationHandler:handleInvocation()        +---[0.002098ms] io.lettuce.core.FutureSyncInvocationHandler:isTxControlMethod() #69<br><br>        +---[0.00123ms] io.lettuce.core.FutureSyncInvocationHandler:isTransactionActive() #69        +---[0.002434ms] io.lettuce.core.internal.AbstractInvocationHandler$MethodTranslator:get() #62<br><br>        +---[0.002282ms] io.lettuce.core.FutureSyncInvocationHandler:getTimeoutNs() #73        +---[0.007581ms] io.lettuce.core.FutureSyncInvocationHandler:isTxControlMethod() #69<br><br>        `---[15.280161ms] io.lettuce.core.internal.Futures:awaitOrCancel() #75        +---[0.005613ms] io.lettuce.core.FutureSyncInvocationHandler:isTransactionActive() #69<br><br><br>        +---[0.006147ms] io.lettuce.core.FutureSyncInvocationHandler:getTimeoutNs() #73<br>        `---[16.541098ms] io.lettuce.core.internal.Futures:awaitOrCancel() <br>æŠ•äº§å‰å‹æµ‹ï¼Œæ“ä½œredisè€—æ—¶ç‰¹åˆ«ä¹…ï¼Œè€å¸ˆæœ‰ä»€ä¹ˆæ’æŸ¥æ€è·¯å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":340413,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1648804362,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648804362","product_id":100056701,"comment_content":"æœ¬æœºã€Mac M1ã€‘è¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š<br>âœ  bin .&#47;redis-cli --intrinsic-latency 120<br>Max latency so far: 1 microseconds.<br>Max latency so far: 3 microseconds.<br>Max latency so far: 5 microseconds.<br>Max latency so far: 7 microseconds.<br>Max latency so far: 17 microseconds.<br>Max latency so far: 33 microseconds.<br>Max latency so far: 34 microseconds.<br>Max latency so far: 35 microseconds.<br>Max latency so far: 39 microseconds.<br>Max latency so far: 46 microseconds.<br>Max latency so far: 48 microseconds.<br>Max latency so far: 59 microseconds.<br>Max latency so far: 75 microseconds.<br>Max latency so far: 109 microseconds.<br>Max latency so far: 155 microseconds.<br>Max latency so far: 583 microseconds.<br>Max latency so far: 1073 microseconds.<br>Max latency so far: 1127 microseconds.<br>Max latency so far: 7119 microseconds.<br>Max latency so far: 9128 microseconds.<br><br>2686736240 total runs (avg latency: 0.0447 microseconds &#47; 44.66 nanoseconds per run).<br>Worst run took 204371x longer than the average latency.<br>âœ  bin ","like_count":0},{"had_liked":false,"id":338544,"user_name":"javaadu","can_delete":false,"product_type":"c1","uid":1000519,"ip_address":"","ucode":"8C0B140F1C8992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg","comment_is_top":false,"comment_ctime":1647567380,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1647567380","product_id":100056701,"comment_content":"çœ‹å®Œå¼€é€çš„é‚£ç¯‡ä¸‡å­—é•¿æ–‡å†æ¥çœ‹è¿™ç¯‡ï¼Œæ„Ÿè§‰ä¸é‚£ä¹ˆç´¯äº†ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1242401,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/21/17814610.jpg","nickname":"å±±ä¸œå“¥å“¥å¸…","note":"","ucode":"6BBEA84359262F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591627,"discussion_content":"æ±‚é“¾æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666713490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"å°”å†¬æ©™","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581879,"discussion_content":"æœ‰é“¾æ¥ä¹ˆå…„å¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659058037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330408,"user_name":"wedde","can_delete":false,"product_type":"c1","uid":1128756,"ip_address":"","ucode":"A49B1732CBE5DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/39/34/10fe2b93.jpg","comment_is_top":false,"comment_ctime":1641970328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641970328","product_id":100056701,"comment_content":"scanå¯ä»¥ä»£æ›¿keyså‘½ä»¤ã€‚ä½†æ˜¯scanä½¿ç”¨ä¸å½“ï¼Œä¾ç„¶ä¼šæ‹–æ…¢æ•´ä½“redisçš„å“åº”æ—¶é—´ã€‚<br>scanæ¯æ¬¡è¿”å›ä¸å¤§äºcountçš„keyæ•°é‡ï¼ŒåŒ…æ‹¬0ä¸ªkeyã€‚å¦‚æœå‘½ä»¤åé¢å¸¦äº†æ¨¡ç³ŠåŒ¹é…çš„è¯ï¼Œå¯èƒ½ä¼šè¿ç»­å¤šæ¬¡scanéƒ½è·å–åˆ°0ä¸ªå…ƒç´ ã€‚è€Œspringä½¿ç”¨è¿­ä»£å™¨å°è£…äº†scançš„å®ç°ï¼Œå½“è°ƒç”¨hasNext()åˆ¤æ–­æ—¶ï¼Œå°±æœ‰å¯èƒ½è§¦å‘è¿ç»­å¤šæ¬¡scanè°ƒç”¨ã€‚","like_count":0},{"had_liked":false,"id":327320,"user_name":"æ ‘å¿ƒ","can_delete":false,"product_type":"c1","uid":1589523,"ip_address":"","ucode":"6C329F0FF798B9","user_header":"https://static001.geekbang.org/account/avatar/00/18/41/13/ab14ad25.jpg","comment_is_top":false,"comment_ctime":1640062259,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1640062259","product_id":100056701,"comment_content":"é’ˆå¯¹è¯¾åä¹ é¢˜éƒ½è¯´ç”¨scanè§£å†³ï¼Œè¿˜æåˆ°å¦‚æœä½¿ç”¨scanæ—¶æ‰©å®¹ä¼šè¿”å›é‡å¤keyï¼Œmarkä¸€ä¸‹å¾…ç ”ç©¶ã€‚","like_count":0},{"had_liked":false,"id":316567,"user_name":"cake","can_delete":false,"product_type":"c1","uid":1966533,"ip_address":"","ucode":"55A7FC6CC1204C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/01/c5/b48d25da.jpg","comment_is_top":false,"comment_ctime":1634394604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634394604","product_id":100056701,"comment_content":"è€å¸ˆ æˆ‘æœ‰ä¸ªé—®é¢˜ï¼ŒæŒ‰åˆ°ä½ æ•´ä¸ªè¯¾ç¨‹çš„è®¾è®¡ï¼Œè¿™ä¸Šä¸‹ä¸¤ç¯‡åº”è¯¥åœ¨è®²Redis å…³é”®ç³»ç»Ÿé…ç½®å¯¹Redisçš„å½±å“ï¼Œä¸ºä»€ä¹ˆä¼šåŠ ä¸ªRedis è‡ªèº«æ“ä½œç‰¹æ€§çš„å½±å“å‘¢ï¼Ÿ ","like_count":0},{"had_liked":false,"id":316359,"user_name":"FelixFly","can_delete":false,"product_type":"c1","uid":1160461,"ip_address":"","ucode":"1D39A7C3D0E31F","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/0d/0e65dee6.jpg","comment_is_top":false,"comment_ctime":1634286613,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634286613","product_id":100056701,"comment_content":"å¦‚ä½•èƒ½çœ‹åˆ°keyçš„è¿‡æœŸæ—¶é—´åˆ†å¸ƒï¼Ÿå“åº”æ…¢äº†æ€ä¹ˆåˆ¤æ–­æ˜¯ç”±äºåˆ é™¤keyå¯¼è‡´çš„é˜»å¡ï¼Ÿ","like_count":0},{"had_liked":false,"id":306621,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1628648342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628648342","product_id":100056701,"comment_content":"å¯ä»¥åˆ©ç”¨SCANæ¥è¿›è¡Œå‘½ä»¤,å¯¹äºå…¶ä¸­å­˜åœ¨çš„é‡å¤key,ä¸Šå±‚åˆ©ç”¨setè¿™ç§å¤©ç„¶å»é‡çš„æ•°æ®ç»“æ„æ¥è¿›è¡Œæ¥æ”¶","like_count":0},{"had_liked":false,"id":304303,"user_name":"Liujun","can_delete":false,"product_type":"c1","uid":1736462,"ip_address":"","ucode":"3DB1F3CA57B5B3","user_header":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","comment_is_top":false,"comment_ctime":1627347022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627347022","product_id":100056701,"comment_content":"ç›‘æ§å®¢æˆ·ç«¯è¯„è®ºå“åº”æ—¶é—´","like_count":0},{"had_liked":false,"id":303802,"user_name":"èŠ±å„¿å°‘å¹´","can_delete":false,"product_type":"c1","uid":1318540,"ip_address":"","ucode":"CFE4F64243673B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/8c/450fe5cb.jpg","comment_is_top":false,"comment_ctime":1627006548,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1627006548","product_id":100056701,"comment_content":"å¥½åƒè¯´äº†ä»€ä¹ˆï¼Œå¥½åƒåˆä»€ä¹ˆéƒ½æ²¡è¯´<br>ç”Ÿäº§ç³»ç»Ÿä¸­å‡ºé—®é¢˜å“ªæœ‰æ—¶é—´æ•´è¿™äº›ï¼Œèµ¶ç´§æ¢å¤è€æ¿éƒ½åœ¨åé¢ç«™ç€å‘¢<br>åŒæ—¶è¿™äº›å‘½ä»¤ï¼Œkeysã€é›†åˆæ“ä½œåŸºæœ¬éƒ½æ˜¯è¢«ç¦ç”¨çš„ï¼›æ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”Ÿäº§ç³»ç»Ÿä¸­Rediså˜æ…¢ä¸€èˆ¬éƒ½æ˜¯bigkeyï¼ŒåŒæ—¶è¿‡æœŸï¼Œçƒ­ç‚¹æ•°æ®ç­‰ç­‰","like_count":1,"discussions":[{"author":{"id":1132192,"avatar":"https://static001.geekbang.org/account/avatar/00/11/46/a0/aa6d4ecd.jpg","nickname":"å¼ æ½‡èµŸ","note":"","ucode":"1A45B57F9E0723","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558578,"discussion_content":"å—¯ï¼Œè¿™ä¸ªæ˜¯å®é™…ç”Ÿäº§é—®é¢˜çš„çŠ¶æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648389351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2082118,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/P1y2k6dcoAWtlXkMcKFGeAmykTKCOKEicKsN0TX4eT6icibATfqnlsDyjicfjvo1zAa9lAS4ZGkSEGjeUUUmy9Qofg/132","nickname":"xyy_Li","note":"","ucode":"81A647AB5F757A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543227,"discussion_content":"ç¡®å®ï¼Œä½ è¯´çš„è¿™äº›å¥½åƒæ‰æ˜¯å®é™…åº”ç”¨ä¸­çš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641010512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300892,"user_name":"å‰‘å…«","can_delete":false,"product_type":"c1","uid":1297630,"ip_address":"","ucode":"0A09F41DB8A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","comment_is_top":false,"comment_ctime":1625440331,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625440331","product_id":100056701,"comment_content":"åˆ é™¤æ“ä½œå¼‚æ­¥åŒ–æ˜¯åˆé€‚çš„<br>æŸ¥è¯¢æ–¹é¢çš„ä¼˜åŒ–æ˜¯ï¼š<br>é¿å…ä½¿ç”¨é›†åˆç±»æ“ä½œï¼Œé¿å…bigkeyï¼Œé¿å…ä½¿ç”¨keysè¿™ç§éå†å…¨éƒ¨keyçš„æ“ä½œ","like_count":0},{"had_liked":false,"id":299968,"user_name":"ææ˜è½©","can_delete":false,"product_type":"c1","uid":1346388,"ip_address":"","ucode":"B576B19FCF8AD5","user_header":"https://static001.geekbang.org/account/avatar/00/14/8b/54/db56a871.jpg","comment_is_top":false,"comment_ctime":1624940133,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624940133","product_id":100056701,"comment_content":"è¯·é—®  redisæ’å…¥æ ‡è®°ä½  æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","like_count":0},{"had_liked":false,"id":299967,"user_name":"ææ˜è½©","can_delete":false,"product_type":"c1","uid":1346388,"ip_address":"","ucode":"B576B19FCF8AD5","user_header":"https://static001.geekbang.org/account/avatar/00/14/8b/54/db56a871.jpg","comment_is_top":false,"comment_ctime":1624940095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624940095","product_id":100056701,"comment_content":"redisæ’å…¥æ ‡è®°ä½","like_count":0},{"had_liked":false,"id":295015,"user_name":"å°é±¼","can_delete":false,"product_type":"c1","uid":1248115,"ip_address":"","ucode":"022B6D5D69DB68","user_header":"https://static001.geekbang.org/account/avatar/00/13/0b/73/44fe2df9.jpg","comment_is_top":false,"comment_ctime":1622183692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622183692","product_id":100056701,"comment_content":"æœ‰ä¸ªç–‘é—®çœŸçš„æ˜¯æŠŠ redisæ“ä½œ å’Œæ“ä½œæ•°æ®åº“ ä»¥åŠæ“ä½œæ¶ˆæ¯æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢åšçš„å—","like_count":0},{"had_liked":false,"id":294712,"user_name":"æ‚Ÿç©ºèŠæ¶æ„","can_delete":false,"product_type":"c1","uid":1123163,"ip_address":"","ucode":"C2F482A0CF8AF1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","comment_is_top":false,"comment_ctime":1622070111,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1622070111","product_id":100056701,"comment_content":"### å¦‚ä½•åº”å¯¹å˜æ…¢çš„ Redis<br><br>**åŸºçº¿æ€§èƒ½**ï¼šä¸€ä¸ªç³»ç»Ÿåœ¨ä½å‹åŠ›ã€æ— å¹²æ‰°ä¸‹çš„åŸºæœ¬æ€§èƒ½ï¼Œåªç”±å½“å‰çš„è½¯ç¡¬ä»¶é…ç½®å†³å®šã€‚<br><br>```<br>.&#47;redis-cli --intrinsic-latency &lt;æµ‹è¯•æ—¶é•¿&gt;<br>```<br><br>è¯¥å‘½ä»¤ä¼šæ‰“å° &lt;æµ‹è¯•æ—¶é•¿&gt; ç§’å†…ç›‘æµ‹åˆ°çš„æœ€å¤§å»¶è¿Ÿã€‚<br><br>è¿è¡Œæ—¶å»¶è¿Ÿçš„æ—¶é•¿ 2 å€äºåŸºå‡†æ—¶é•¿ï¼Œåˆ™æ˜¯ redis å˜æ…¢äº†ã€‚<br><br>å¦‚æœæƒ³æµ‹è¯• Redis å®¢æˆ·ç«¯é“ç½‘ç»œç«¯çš„å½±å“ï¼Œå¯ä»¥ç”¨`iPerf` å·¥å…·ã€‚<br><br>**å½±å“ Redis æ€§èƒ½çš„ä¸‰å¤§è¦ç´ **ï¼šRedis è‡ªèº«çš„æ“ä½œç‰¹æ€§ã€æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚<br><br>## Redis è‡ªèº«çš„æ“ä½œç‰¹æ€§<br><br>### 1.æ…¢æŸ¥è¯¢å‘½ä»¤ï¼š<br><br>å‘½ä»¤çš„æ…¢æ“ä½œå’Œæ“ä½œçš„å¤æ‚åº¦ç›¸å…³ã€‚<br><br>æ“ä½œåº¦å¤æ‚åº¦æŸ¥è¯¢ï¼šhttps:&#47;&#47;redis.io&#47;commands&#47;<br><br>å½“ä½ å‘ç° Redis æ€§èƒ½å˜æ…¢æ—¶ï¼Œå¯ä»¥é€šè¿‡ Redis æ—¥å¿—ï¼Œæˆ–è€…æ˜¯ latency monitor å·¥å…·ï¼ŒæŸ¥è¯¢å˜æ…¢çš„è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¯¹åº”çš„å…·ä½“å‘½ä»¤ä»¥åŠå®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤ä¸‹æ˜¯å¦é‡‡ç”¨äº†å¤æ‚åº¦é«˜çš„æ…¢æŸ¥è¯¢å‘½ä»¤ã€‚<br><br>å¦‚æœçš„ç¡®æœ‰å¤§é‡çš„æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼šç”¨å…¶ä»–é«˜æ•ˆå‘½ä»¤ä»£æ›¿ã€‚<br><br>- å½“éœ€è¦è¿”å›ä¸€ä¸ª SET ä¸­çš„æ‰€æœ‰æˆå‘˜æ—¶ï¼Œä¸è¦ä½¿ç”¨ SMEMBERS å‘½ä»¤ï¼Œè€Œæ˜¯è¦ä½¿ç”¨ SSCAN å¤šæ¬¡è¿­ä»£è¿”å›ï¼Œé¿å…ä¸€æ¬¡è¿”å›å¤§é‡æ•°æ®ï¼Œé€ æˆçº¿ç¨‹é˜»å¡ã€‚<br><br>- éœ€è¦æ‰§è¡Œæ’åºã€äº¤é›†ã€å¹¶é›†æ“ä½œæ—¶ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å®Œæˆï¼Œè€Œä¸è¦ç”¨ SORTã€SUNIONã€SINTER è¿™äº›å‘½ä»¤ï¼Œä»¥å…æ‹–æ…¢ Redis å®ä¾‹ã€‚<br><br>KEYS å‘½ä»¤éœ€è¦éå†å­˜å‚¨çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥æ“ä½œå»¶æ—¶é«˜ã€‚KEYS å‘½ä»¤ä¸€èˆ¬ä¸è¢«å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒä¸­<br><br>### 2. è¿‡æœŸ key æ“ä½œ<br><br>Redis ä¼šè‡ªåŠ¨åˆ é™¤è¿‡æœŸ keyï¼Œå›æ”¶å†…å­˜ç©ºé—´ï¼Œæœ¬èº«ä¼šå¼•èµ· Redis å˜æ…¢ã€‚<br><br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis æ¯ 100 ms ä¼šåˆ é™¤ä¸€äº›è¿‡æœŸ keyï¼Œç®—æ³•å¦‚ä¸‹ï¼š<br><br>- é‡‡æ ·å›ºå®šä¸ªæ•°çš„ keyï¼Œå¹¶å°†å…¶ä¸­è¿‡æœŸçš„ key å…¨éƒ¨åˆ é™¤ï¼›ï¼ˆå›ºå®šä¸ªæ•°ï¼šACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPï¼Œé»˜è®¤ 20ï¼‰<br><br>- å¦‚æœè¶…è¿‡ 25% çš„ key è¿‡æœŸäº†ï¼Œåˆ™é‡å¤åˆ é™¤çš„è¿‡ç¨‹ï¼Œç›´åˆ°è¿‡æœŸ key çš„æ¯”ä¾‹é™è‡³ 25% ä»¥ä¸‹ã€‚<br><br>ç¬¬ä¸€æ¡çš„ç®—æ³•ï¼Œå¦‚æœæ¯ç§’é’Ÿåˆ é™¤ 200 ä¸ªè¿‡æœŸ keyï¼Œå¹¶ä¸ä¼šå¯¹ Redis é€ æˆå¤ªå¤§å½±å“ã€‚<br><br>å¦‚æœè§¦å‘äº†ç¬¬äºŒæ¡ç®—æ³•ï¼Œå¯ä»¥åœ¨ EXPIREAT å’Œ EXPIRE å‘½ä»¤çš„è¿‡æœŸæ—¶é—´å‚æ•°ä¸Šï¼ŒåŠ ä¸Šä¸€ä¸ªä¸€å®šå¤§å°èŒƒå›´å†…çš„éšæœºæ•°ï¼Œè¿™æ ·ï¼Œæ—¢ä¿è¯äº† key åœ¨ä¸€ä¸ªé‚»è¿‘æ—¶é—´èŒƒå›´å†…è¢«åˆ é™¤ï¼Œåˆé¿å…äº†åŒæ—¶è¿‡æœŸé€ æˆçš„å‹åŠ›ã€‚<br><br>","like_count":0},{"had_liked":false,"id":285966,"user_name":"Geek_926921","can_delete":false,"product_type":"c1","uid":2532285,"ip_address":"","ucode":"51C3B0178D77E1","user_header":"","comment_is_top":false,"comment_ctime":1617089454,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1617089454","product_id":100056701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œ<br>127.0.0.1:6379&gt; --intrinsic-latency 120<br>(error) ERR unknown command `--intrinsic-latency`, with args beginning with: `120`,<br>æ‰§è¡Œæ–‡æ¡£ä¸­çš„æŒ‡ä»¤ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œredisç‰ˆæœ¬æ˜¯6.0.8ç‰ˆæœ¬ã€‚","like_count":0,"discussions":[{"author":{"id":2308772,"avatar":"","nickname":"é«˜æ°","note":"","ucode":"5C36D7B97B8459","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545794,"discussion_content":"ä½ è¿™æ˜¯ç™»å½•redisåæ‰§è¡Œå‘½ä»¤ã€‚ã€‚ã€‚ã€‚ã€‚æ­£ç¡®æ“ä½œæ˜¯ç”¨clientç«¯å‘½ä»¤åŠ ä¸Šè¿™ä¸ªå‚æ•°æ¥æµ‹è¯•çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642052968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124130,"avatar":"https://static001.geekbang.org/account/avatar/00/11/27/22/747289a3.jpg","nickname":"howru","note":"","ucode":"A9F6CE24B14372","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376601,"discussion_content":"è¿™æ¡å‘½ä»¤æ˜¯éœ€è¦åœ¨serverç«¯æ‰§è¡Œçš„ï¼Œä¸æ˜¯clientç«¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622208541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285958,"user_name":"Geek_926921","can_delete":false,"product_type":"c1","uid":2532285,"ip_address":"","ucode":"51C3B0178D77E1","user_header":"","comment_is_top":false,"comment_ctime":1617087471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617087471","product_id":100056701,"comment_content":"çªç„¶å‘ç°æˆ‘æ˜¯æ¥çœ‹å£çº¸çš„ï¼Œå“ˆå“ˆå“ˆå“ˆ","like_count":0},{"had_liked":false,"id":285295,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1616726995,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1616726995","product_id":100056701,"comment_content":"æ‰§è¡Œäº†ä¸€ä¸‹ redis-cli --intrinsic-latency 120 å‘½ä»¤ï¼Œå‘ç°ç»“æœæ¯”è¾ƒæœ‰æ„æ€ï¼Œä¸¤æ¬¡çš„ç»“æœå·®ä¸å¤šï¼Œä»ä¸€å¼€å§‹ 1 ms çš„å»¶è¿Ÿï¼Œä¸€ç›´åˆ°åæ¥çš„ 8000+ msã€‚æˆ‘è®¿é—®çš„æ˜¯ aliyun ä¸Šçš„ Redisã€‚<br><br>```<br>&gt; redis-cli --intrinsic-latency 120<br><br>Max latency so far: 1 microseconds.<br>Max latency so far: 9 microseconds.<br>Max latency so far: 11 microseconds.<br>Max latency so far: 15 microseconds.<br>Max latency so far: 18 microseconds.<br>Max latency so far: 96 microseconds.<br>Max latency so far: 118 microseconds.<br>Max latency so far: 122 microseconds.<br>Max latency so far: 221 microseconds.<br>Max latency so far: 1047 microseconds.<br>Max latency so far: 1677 microseconds.<br>Max latency so far: 3378 microseconds.<br>Max latency so far: 4173 microseconds.<br>Max latency so far: 8509 microseconds.<br>2085259894 total runs (avg latency: 0.0575 microseconds &#47; 57.55 nanoseconds per run).<br>Worst run took 147862x longer than the average latency.<br>```<br><br>Redis æ€§èƒ½è¯Šæ–­çš„ä¸‰ä¸ªå…³é”®ç‚¹ï¼šRedis è‡ªèº«ç‰¹æ€§ã€æ“ä½œç³»ç»Ÿã€æ–‡ä»¶ç³»ç»Ÿ<br><br>Value ç±»å‹ä¸º String æ—¶ï¼Œæ“ä½œå¤æ‚åº¦ O(1)ï¼Œè¿™ä¸ªä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæœ‰ä¸€äº›å…¬å¸ç”¨ Redis çš„æ—¶å€™ï¼ŒString åˆ°åº•ã€‚<br><br>Value ç±»å‹ä¸º Set æ—¶ï¼ŒSortã€SUNION&#47;SMEMBERS æ“ä½œå¤æ‚åº¦åˆ†åˆ«ä¸º O(N+M*log(M)) å’Œ O(N)ï¼Œåä¸€ä¸ªå¥½ç†è§£ï¼Œå‰é¢çš„é‚£ä¸ªä¼°è®¡å¾—ç¢ç£¨ä¸€ä¸‹ã€‚<br><br>ç”¨ SSCAN å¤šæ¬¡è¿­ä»£è¿”å›ä»£æ›¿ SMEMBERS è¿”å›é›†åˆä¸­æ‰€æœ‰æˆå‘˜ã€‚<br>KEYS å‘½ä»¤ä¸€èˆ¬ä¸ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚<br>ä¸è¦è®©ä¸€æ‰¹ key çš„è¿‡æœŸæ—¶é—´ç›¸åŒï¼Œå¯ä»¥åŠ ä¸€ä¸ªéšæœºæ•°<br><br>å¯¹äºè¯¾åé¢˜ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä»£æ›¿ KEYS å‘½ä»¤ï¼Œè¿”å›ä¸è¾“å…¥æ¨¡å¼åŒ¹é…çš„ keysï¼Œå¯ä»¥ä½¿ç”¨ SSCAN åˆ†æ‰¹æ¬¡è¿”å›ã€‚<br><br>æ‰§è¡Œäº†ä¸€ä¸‹ @æ³ å°å¢¨ ç•™è¨€ä¸­çš„ä¾‹å­ï¼Œç»“æœç¨å¾®æœ‰ç‚¹æ„å¤–<br><br>```<br>&gt; keys *<br> 1) &quot;1101001&quot;<br> 2) &quot;page1:uv&quot;<br> 3) &quot;aa&quot;<br> 4) &quot;comments&quot;<br> 5) &quot;aaa&quot;<br> 6) &quot;1101000&quot;<br> 7) &quot;zr&quot;<br> 8) &quot;testzset&quot;<br> 9) &quot;mqback&quot;<br>10) &quot;mylist&quot;<br>11) &quot;testkey&quot;<br>12) &quot;mqstream&quot;<br>13) &quot;a&quot;<br>14) &quot;testhash&quot;<br>15) &quot;hell&quot;<br>16) &quot;hello&quot;<br>&gt; scan 0 count 1<br>1) &quot;8&quot;<br>2) 1) &quot;1101001&quot;<br>&gt; scan 0 count 2<br>1) &quot;12&quot;<br>2) 1) &quot;1101001&quot;<br>   2) &quot;comments&quot;<br>```<br><br>åœ¨ è¯¾ä»£è¡¨ @kaito çš„æç¤ºä¸‹ï¼Œçœ‹äº†ä¸€ä¸‹ Redis åœ¨ SCAN æ—¶é‡‡ç”¨çš„ é«˜ä½è¿›ä½æ³•ï¼Œç¡®å®æµ…æ˜¾æ˜“æ‡‚ã€‚","like_count":0},{"had_liked":false,"id":270921,"user_name":"Geek_9b08a5","can_delete":false,"product_type":"c1","uid":2392536,"ip_address":"","ucode":"CF08E141456F24","user_header":"","comment_is_top":false,"comment_ctime":1609318663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609318663","product_id":100056701,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œåœ¨rediså¯¹è¿‡æœŸkeyåˆ é™¤çš„ç¬¬äºŒä¸ªé˜¶æ®µçš„åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯å½“CTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOPä¸­keyè¾¾åˆ°25%ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„åˆ é™¤æ—¶ï¼Œé‚£å¦‚æœæˆ‘çš„åœºæ™¯è®¾ç½®äº†keyè¿‡æœŸåŠ ä¸Šä¸€ä¸ªä¸€å®šå¤§å°èŒƒå›´å†…çš„éšæœºæ•°çš„ï¼Œè¿˜æ˜¯è¾¾åˆ°äº†25%ä»¥ä¸Šï¼Œè¿˜èƒ½æ€ä¹ˆå»é¿å…å‘¢ï¼Œå†æ¯”å¦‚è¯´é‡å¤åˆ é™¤æ˜¯æœ‰æ—¶é—´é—´éš”çš„è¿˜æ˜¯åªè¦ä¸Šä¸€è½®åˆ å®Œå°±è¿›è¡Œä¸‹ä¸€è½®ï¼Œä¸”å½“åˆ°è¾¾ä¸‹ä¸€æ¬¡è¿‡æœŸæ‰«ææ˜¯ä¸­æ–­å•å‰çš„é‡å¤åˆ é™¤è¿˜æ˜¯è·³è¿‡å½“æ—¶çš„è¿‡æœŸæ‰«æï¼Ÿ","like_count":0},{"had_liked":false,"id":265914,"user_name":"Geek9625","can_delete":false,"product_type":"c1","uid":2028943,"ip_address":"","ucode":"8110B0DE0432E1","user_header":"","comment_is_top":false,"comment_ctime":1607067737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607067737","product_id":100056701,"comment_content":"è¿è¡Œæ—¶å»¶è¿Ÿæ€ä¹ˆç®—çš„å‘¢","like_count":0},{"had_liked":false,"id":261800,"user_name":"é¸³é¸¯æˆæ°´è¶åŒé£","can_delete":false,"product_type":"c1","uid":2178330,"ip_address":"","ucode":"BF0B0DA16E27D5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GicvRPEGZhqFSYn00tgI08hjV10eEkOC12LY7Zxn1EaYNH2icibxyRV1M0H6YqJuIyhajD4bHBluI4Xprq3YAlF5Q/132","comment_is_top":false,"comment_ctime":1605527459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605527459","product_id":100056701,"comment_content":"å°è±¡ä¸­å®šæœŸåˆ é™¤keyçš„ç¬¬äºŒæ¡è§„åˆ™æ‰§è¡Œä¹Ÿæ˜¯æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´çš„å§ï¼Ÿ<br>ä¸ºäº†ä¿è¯è¿‡æœŸæ‰«æä¸ä¼šå‡ºç°å¾ªç¯è¿‡åº¦ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»ç°è±¡ï¼Œç®—æ³•è¿˜å¢åŠ äº†æ‰«ææ—¶<br>é—´çš„ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡ 25ms","like_count":0},{"had_liked":false,"id":260602,"user_name":"æ•°å­¦æ±¤å®¶å‡¤","can_delete":false,"product_type":"c1","uid":2029485,"ip_address":"","ucode":"DE84E777C384AD","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f7/ad/4fd4d867.jpg","comment_is_top":false,"comment_ctime":1605068551,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1605068551","product_id":100056701,"comment_content":"å°‘æ‹¿å¤šæ¬¡","like_count":0,"discussions":[{"author":{"id":1665192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/a8/1fa41264.jpg","nickname":"é©¬ä»€ä¹ˆæ¢…","note":"","ucode":"251B100AC229EE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326114,"discussion_content":"å“äºº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605525561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259950,"user_name":"spoofer","can_delete":false,"product_type":"c1","uid":1768852,"ip_address":"","ucode":"6723F64ACC3F27","user_header":"https://static001.geekbang.org/account/avatar/00/1a/fd/94/8704d2b0.jpg","comment_is_top":false,"comment_ctime":1604894348,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604894348","product_id":100056701,"comment_content":"æˆ‘æƒ³é—®å¦‚ä½•ä¿è¯è¿™ä¸ªäº‹åŠ¡çš„åŸå­æ€§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355843,"discussion_content":"TCC","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615479955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}