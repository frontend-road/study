{"id":132863,"title":"24 | 多人音视频实时通讯是怎样的架构？","content":"<p>在前面的章节里，我们通过大量的篇幅介绍了WebRTC 在浏览器上对实时通信的各种支持。WebRTC 本身提供的是1对1的通信模型，在 STUN/TURN 的辅助下，如果能实现 NAT 穿越，那么两个浏览器是可以直接进行媒体数据交换的；如果不能实现 NAT 穿越，那么只能通过 TURN服务器进行数据转发的方式实现通信。目前来看，Google 开源的用于学习和研究的项目基本都是基于 STUN/TURN 的1对1通信。</p><p>如果你想要通过 WebRTC 实现多对多通信，该如何做呢？其实，基于 WebRTC 的多对多实时通信的开源项目也有很多，综合来看，多方通信架构无外乎以下三种方案。</p><ul>\n<li><strong>Mesh方案</strong>，即多个终端之间两两进行连接，形成一个网状结构。比如 A、B、C 三个终端进行多对多通信，当A想要共享媒体（比如音频、视频）时，它需要分别向 B 和 C发送数据。同样的道理，B 想要共享媒体，就需要分别向 A、C 发送数据，依次类推。这种方案对各终端的带宽要求比较高。</li>\n<li><strong>MCU（Multipoint Conferencing Unit）方案</strong>，该方案由一个服务器和多个终端组成一个星形结构。各终端将自己要共享的音视频流发送给服务器，服务器端会将在同一个房间中的所有终端的音视频流进行混合，最终生成一个混合后的音视频流再发给各个终端，这样各终端就可以看到/听到其他终端的音视频了。实际上服务器端就是一个音视频混合器，这种方案服务器的压力会非常大。</li>\n<li><strong>SFU（Selective Forwarding Unit）方案</strong>，该方案也是由一个服务器和多个终端组成，但与MCU不同的是，SFU不对音视频进行混流，收到某个终端共享的音视频流后，就直接将该音视频流转发给房间内的其他终端。它实际上就是一个音视频路由转发器。</li>\n</ul><!-- [[[read_end]]] --><p>了解了上面几种通信架构后，接下来，我们分别论述一下这几种架构。</p><h2>1对1通信</h2><p>不过在讲解多对多架构模型之前，咱们得先回顾一下之前讲的 WebRTC 1对1通信的模型，因为只有在1对1通信模型非常清楚的情况下，你才能知道多对多通信模型的复杂度到底体现在哪儿。</p><p>在1对1通信中，WebRTC 首先尝试两个终端之间是否可以通过 P2P 直接进行通信，如果无法直接通信的话，则会通过 STUN/TURN 服务器进行中转，如下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/68/e32cd7ea6aa175c8a64739d9c95a3968.png?wh=1142*686\" alt=\"\"></p><center><span class=\"reference\">WebRTC 1对1音视频实时通话示意图</span></center><p>上面这张图咱们已经见过无数次了，相信你对它已经十分熟悉了。实际上，1对1通信模型设计的主要目标是尽量让两个终端进行直联，这样即可以节省服务器的资源，又可以提高音视频的服务质量。</p><p>如果端与端之间可以直接通信，那么上图中的 STUN/TURN服务器的作用就只是用于各终端收集 reflx 类型的 Candidate 。而如果端与端之间无法直接进行通信的话，那么STUN/TURN服务器就变成了中继服务器，可以利用它进行端与端之间数据的中转。</p><h2>Mesh方案</h2><p>1对1通信模型下，两个终端可以互相连接，那么我们是否可以让多个终端互相连接起来，从而实现多人通信呢？理论上这是完全可行的。Mesh 方案的结构如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/9b/fed9792cef39fbd99e4fa1e8ffdf5c9b.png?wh=475*324\" alt=\"\"></p><center><span class=\"reference\">Mesh方案架构图</span></center><p>在上图中，B1、B2、B3、B4 分别表示4个浏览器，它们之间两两相连，同时还分别与 STUN/TURN服务器进行连接（<strong>此时的 STUN/TURN服务器不能进行数据中转，否则情况会变得非常复杂</strong>），这样就形成了一个<strong>网格拓扑结构</strong>。</p><p>当某个浏览器想要共享它的音视频流时，它会将共享的媒体流分别发送给其他3个浏览器，这样就实现了多人通信。这种结构的优势有如下：</p><ul>\n<li>不需要服务器中转数据，STUN/TUTN只是负责 NAT 穿越，这样利用现有 WebRTC 通信模型就可以实现，而不需要开发媒体服务器。</li>\n<li>充分利用了客户端的带宽资源。</li>\n<li>节省了服务器资源，由于服务器带宽往往是专线，价格昂贵，这种方案可以很好地控制成本。</li>\n</ul><p>当然，有优势自然也有不足之处，主要表现如下：</p><ul>\n<li>共享端共享媒体流的时候，需要给每一个参与人都转发一份媒体流，这样<strong>对上行带宽的占用很大</strong>。参与人越多，占用的带宽就越大。除此之外，对 CPU、Memory 等资源也是极大的考验。一般来说，客户端的机器资源、带宽资源往往是有限的，资源占用和参与人数是线性相关的。这样导致多人通信的规模非常有限，通过实践来看，这种方案在超过4个人时，就会有非常大的问题。</li>\n<li>另一方面，在多人通信时，如果有部分人不能实现 NAT 穿越，但还想让这些人与其他人互通，就显得很麻烦，需要做出更多的可靠性设计。</li>\n</ul><h2>MCU方案</h2><p>MCU 主要的处理逻辑是：接收每个共享端的音视频流，经过解码、与其他解码后的音视频进行混流、重新编码，之后再将混好的音视频流发送给房间里的所有人。</p><p>MCU 技术在视频会议领域出现得非常早，目前技术也非常成熟，主要用在硬件视频会议领域。不过我们今天讨论的是软件MCU，它与硬件MCU的模型是一致的，只不过一个是通过硬件实现的，另一个是通过软件实现的罢了。MCU 方案的模型是一个星形结构，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/2a/a2667e1d47f689267168078d195c8d2a.png?wh=379*319\" alt=\"\"></p><center><span class=\"reference\">MCU方案架构图</span></center><p>我们来假设一个条件，B1 与 B2 同时共享音视频流，它们首先将流推送给 MCU 服务器，MCU服务器收到两路流后，分别将两路流进行解码，之后将解码后的两路流进行混流，然后再编码，编码后的流数据再分发给 B3 和 B4。</p><p>对于 B1 来说，因为它是其中的一个共享者，所以MCU给它推的是没有混合它的共享流的媒体流，在这个例子中就是直接推 B2 的流给它。同理，对于B2来说MCU给它发的是 B1 的共享流。但如果有更多的人共享音视频流，那情况就更加复杂。</p><p>MCU 主要的处理逻辑如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/0f/3baa0690d21700210ffb0f0da6d9c10f.png?wh=796*265\" alt=\"\"></p><center><span class=\"reference\">MCU处理逻辑图</span></center><p>这个处理过程如下所示：</p><ol>\n<li>接收共享端发送的音视频流。</li>\n<li>将接收到的音视频流进行解码。</li>\n<li>对于视频流，要进行重新布局，混合处理。</li>\n<li>对于音频流，要进行混音、重采样处理。</li>\n<li>将混合后的音视频进行重新编码。</li>\n<li>发送给接收客户端。</li>\n</ol><p>那MCU 的优势有哪些呢？大致可总结为如下几点：</p><ul>\n<li>技术非常成熟，在硬件视频会议中应用非常广泛。</li>\n<li>作为音视频网关，通过解码、再编码可以屏蔽不同编解码设备的差异化，满足更多客户的集成需求，提升用户体验和产品竞争力。</li>\n<li>将多路视频混合成一路，所有参与人看到的是相同的画面，客户体验非常好。</li>\n</ul><p>同样，MCU 也有一些不足，主要表现为：</p><ul>\n<li>重新解码、编码、混流，需要大量的运算，对 CPU 资源的消耗很大。</li>\n<li>重新解码、编码、混流还会带来延迟。</li>\n<li>由于机器资源耗费很大，所以 MCU 所提供的容量有限，一般十几路视频就是上限了。</li>\n</ul><h2>SFU方案</h2><p>SFU 像是一个媒体流路由器，接收终端的音视频流，根据需要转发给其他终端。SFU 在音视频会议中应用非常广泛，尤其是 WebRTC 普及以后。支持 WebRTC 多方通信的媒体服务器基本都是 SFU 结构。SFU 的拓扑机构和功能模型如下图：</p><p><img src=\"https://static001.geekbang.org/resource/image/74/ef/740a6afe38fba9636fc9c93e3717e0ef.png?wh=379*319\" alt=\"\"></p><center><span class=\"reference\">SFU方案架构图</span></center><p>在上图中，B1、B2、B3、B4 分别代表4个浏览器，每一个浏览器都会共享一路流发给 SFU，SFU 会将每一路流转发给共享者之外的3个浏览器。</p><p>下面这张图是从SFU服务器的角度展示的功能示意图：</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/3e/2a147d9a934ba53c4548b00a0a06153e.png?wh=454*265\" alt=\"\"></p><center><span class=\"reference\">SFU功能示意图</span></center><p>相比 MCU，SFU 在结构上显得简单很多，只是接收流然后转发给其他人。然而，这个简单结构也给音视频传输带来了很多便利。比如，SFU 可以根据终端下行网络状况做一些流控，可以根据当前带宽情况、网络延时情况，选择性地丢弃一些媒体数据，保证通信的连续性。</p><p>目前许多 SFU 实现都支持 SVC 模式和 Simulcast 模式，用于适配 WiFi、4G 等不同网络状况，以及 Phone、Pad、PC 等不同终端设备。</p><p>SFU 的优势有哪些呢？可总结为如下：</p><ul>\n<li>由于是数据包直接转发，不需要编码、解码，对 CPU 资源消耗很小。</li>\n<li>直接转发也极大地降低了延迟，提高了实时性。</li>\n<li>带来了很大的灵活性，能够更好地适应不同的网络状况和终端类型。</li>\n</ul><p>同样，SFU有优势，也有不足，主要表现为：</p><ul>\n<li>由于是数据包直接转发，参与人观看多路视频的时候可能会出现不同步；相同的视频流，不同的参与人看到的画面也可能不一致。</li>\n<li>参与人同时观看多路视频，在多路视频窗口显示、渲染等会带来很多麻烦，尤其对多人实时通信进行录制，多路流也会带来很多回放的困难。总之，整体在通用性、一致性方面比较差。</li>\n</ul><p>通过上面的分析和比较，我相信你已经对这三种多对多音视频通信架构有了一个非常清晰的认知了。综合它们各自的优劣情况，我们可以得出 ，<strong>SFU 是三种架构方案中优势最明显而劣势又相对较少的一种架构方案</strong>。</p><p>无论是从灵活性上，还是音视频的服务质量、负载情况等方面上，相较其他两种方案，SFU 都有明显的优势，因此这种方案也被大多数厂商广泛采用。</p><p>另外，在上面介绍 SFU 方案时，我们还提到了视频的 <strong>Simulcast</strong> 模式和 <strong>SVC</strong> 模式，下面我就这两个知识点再向你做一下讲解，来看一下这两种视频的处理模式对 SFU 架构来说都带来了哪些好处。</p><h3>1. Simulcast 模式</h3><p>所谓<strong>Simulcast模式就是指视频的共享者可以同时向 SFU 发送多路不同分辨率的视频流</strong>（一般为三路，如 1080P、720P、360P）。而 SFU 可以将接收到的三路流根据各终端的情况而选择其中某一路发送出去。例如，由于 PC 端网络特别好，给 PC 端发送 1080P 分辨率的视频；而移动网络较差，就给 Phone 发送 360P 分辨率的视频。</p><p>Simulcast 模式对移动端的终端类型非常有用，它可以灵活而又智能地适应不同的网络环境。下图就是 Simulcast 模式的示意图：</p><p><img src=\"https://static001.geekbang.org/resource/image/07/30/079b88b254bb11887c093464b5737630.png?wh=619*183\" alt=\"\"></p><center><span class=\"reference\">Simulcast模式示意图</span></center><h3>2. SVC模式</h3><p>SVC 是可伸缩的视频编码模式。与 Simulcast 模式的同时传多路流不同，SVC 模式是在视频编码时做“手脚”。</p><p>它在视频编码时将视频分成多层——核心层、中间层和扩展层。<strong>上层依赖于底层，而且越上层越清晰，越底层越模糊</strong>。在带宽不好的情况下，可以只传输底层，即核心层，在带宽充足的情况下，可以将三层全部传输过去。</p><p>如下图所示，PC1 共享的是一路视频流，编码使用 SVC 分为三层发送给 SFU。SFU 根据接收端的情况，发现PC2网络状况不错，于是将 0、1、2 三层都发给 PC2；发现 Phone 网络不好，则只将 0 层发给 Phone。这样就可以适应不同的网络环境和终端类型了。</p><p><img src=\"https://static001.geekbang.org/resource/image/ef/02/ef4e0aa7d5053e822ada4b6e8987a502.png?wh=582*182\" alt=\"\"></p><center><span class=\"reference\">SVC 模式示意图</span></center><h2>小结</h2><p>本文我向你介绍了三种多方通信的架构，分别是 Mesh、MCU和SFU。</p><p>整体来看，由于各方面限制，Mesh 架构在真实的应用场景中几乎没有人使用，一般刚学习 WebRTC 的同学才会考虑使用这种架构来实现多方通信。</p><p>MCU 架构是非常成熟的技术，在硬件视频会议中应用非常广泛。像很多做音视频会议的公司之前都会购买一套 MCU 设备，这样一套设备价格不菲，最低都要 50万，但随着互联网的发展以及音视频技术越来越成熟，硬件MCU已经逐步被淘汰。</p><p>当然现在也还有公司在使用软MCU，比较有名的项目是FreeSWITCH，但正如我们前面所分析的那样，由于MCU要进行解码、混流、重新编码的操作，这些操作对CPU消耗是巨大的。如果用硬件MCU还好，但软MCU这个劣势就很明显了，所以真正使用软MCU架构方案的公司也不多。</p><p>SFU是最近几年流行的新架构，目前 WebRTC 多方通信媒体服务器都是 SFU 架构。从上面的介绍中你也可以了解到 SFU 这种架构非常灵活，性能也非常高，再配上视频的 Simulcast 模式或 SVC 模式，则使它更加如虎添翼，因此各个公司目前基本上都使用该方案。</p><h2>思考时间</h2><p>今天我留给你的思考题是：在 SFU 方案中，该如何将多路音视频流录制下来并进行回放呢？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p><p></p>","comments":[{"had_liked":false,"id":133333,"user_name":"Derek","can_delete":false,"product_type":"c1","uid":1284664,"ip_address":"","ucode":"D5F7FD736FDE0D","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/38/f7c979e1.jpg","comment_is_top":false,"comment_ctime":1568519342,"is_pvip":false,"replies":[{"id":"51470","content":"不错！","user_name":"作者回复","comment_id":133333,"uid":"1507837","ip_address":"","utype":1,"ctime":1568780225,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"14453421230","product_id":100031801,"comment_content":"思考题：录制桌面？","like_count":3,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467354,"discussion_content":"不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568780225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132675,"avatar":"https://static001.geekbang.org/account/avatar/00/11/48/83/f008d3f9.jpg","nickname":"Han","note":"","ucode":"8590464D54D58C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554236,"discussion_content":"移动端通过SFU 进行多人语音通话，怎么进行回放录制？服务端合并一路流推rtmp？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646276130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250695,"user_name":"宇宙之王","can_delete":false,"product_type":"c1","uid":1981915,"ip_address":"","ucode":"5E6C28F8CCFF6D","user_header":"","comment_is_top":false,"comment_ctime":1601198192,"is_pvip":false,"replies":[{"id":"94548","content":"你这个应该是点播业务，可以看看阿里或腾讯的点播业务。","user_name":"作者回复","comment_id":250695,"uid":"1507837","ip_address":"","utype":1,"ctime":1605004255,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"10191132784","product_id":100031801,"comment_content":"老师您好，我的需求就是让多个用户通过浏览器观看服务器上的MP4视频时能实现边下载边播放，因为视频比较大，所以想到流媒体，搜到了咱们的教程，发现好像没有讲这方面内容，请问要实现我的需求采用什么架构比较好呢，或用什么开源的工具实现呢？谢谢老师！","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506262,"discussion_content":"你这个应该是点播业务，可以看看阿里或腾讯的点播业务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605004255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205098,"user_name":"被雨水过滤的空气","can_delete":false,"product_type":"c1","uid":1080417,"ip_address":"","ucode":"1A6316040EB6A7","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/61/76b1b888.jpg","comment_is_top":false,"comment_ctime":1586527834,"is_pvip":false,"replies":[{"id":"77612","content":"文章中不是已经介绍了medooze了吗，它就是一个开源的webrtc流媒体服务器库呀！另外，mediasoup, janus都是非常不错的webrtc流媒体服务器库","user_name":"作者回复","comment_id":205098,"uid":"1507837","ip_address":"","utype":1,"ctime":1587222166,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"10176462426","product_id":100031801,"comment_content":"怎么样让浏览器和服务器建立webrtc连接呢？有什么开源的库吗？望老师解答！","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491387,"discussion_content":"文章中不是已经介绍了medooze了吗，它就是一个开源的webrtc流媒体服务器库呀！另外，mediasoup, janus都是非常不错的webrtc流媒体服务器库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587222166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1080417,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7c/61/76b1b888.jpg","nickname":"被雨水过滤的空气","note":"","ucode":"1A6316040EB6A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228540,"discussion_content":"原来下一讲就讲了。。😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586558490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212504,"user_name":"涂滔","can_delete":false,"product_type":"c1","uid":1934631,"ip_address":"","ucode":"07264F622D5570","user_header":"","comment_is_top":false,"comment_ctime":1588138635,"is_pvip":false,"replies":[{"id":"79592","content":"可以的，这块我没讲，你可以通过h5 的player 将播出的数据转给rtc 就好了","user_name":"作者回复","comment_id":212504,"uid":"1507837","ip_address":"","utype":1,"ctime":1588866099,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"5883105931","product_id":100031801,"comment_content":"老师，请问怎么用webRTC实现播放以前录制的视频呢","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493527,"discussion_content":"可以的，这块我没讲，你可以通过h5 的player 将播出的数据转给rtc 就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588866099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1377376,"avatar":"https://static001.geekbang.org/account/avatar/00/15/04/60/20c6a3f2.jpg","nickname":"expecting","note":"","ucode":"1528740DC34DF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552567,"discussion_content":"可以使用captureStream方法捕获video播放的流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645512931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163600,"user_name":"A周峰","can_delete":false,"product_type":"c1","uid":1786554,"ip_address":"","ucode":"7139692AEB26BF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/42/ba/9183f6c2.jpg","comment_is_top":false,"comment_ctime":1576753990,"is_pvip":false,"replies":[{"id":"62482","content":"mediasoup 可以通过 piperouter来实现级联，如果你要商用的话，自己需要改造一下！","user_name":"作者回复","comment_id":163600,"uid":"1507837","ip_address":"","utype":1,"ctime":1577024483,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5871721286","product_id":100031801,"comment_content":"李老师您好！media soap 怎么实现级连！jitsi meet 好像原生支持级连，这个适合商用吗","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478469,"discussion_content":"mediasoup 可以通过 piperouter来实现级联，如果你要商用的话，自己需要改造一下！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577024483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134207,"user_name":"澈","can_delete":false,"product_type":"c1","uid":1199665,"ip_address":"","ucode":"78D094C0F8F70A","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/31/aab3f1ce.jpg","comment_is_top":false,"comment_ctime":1568775325,"is_pvip":false,"replies":[{"id":"51459","content":"许多，许多！1万个，10万个一点问题都没有，关键点不在这里，你想你应该可以想瓶颈是什么","user_name":"作者回复","comment_id":134207,"uid":"1507837","ip_address":"","utype":1,"ctime":1568779465,"user_name_real":"garrylee"}],"discussion_count":5,"race_medal":0,"score":"5863742621","product_id":100031801,"comment_content":"使用Mesh架构，如果客户端全是Native的（iOS和Android设备，不允许浏览器接入，那么允许最对的连接数是多少）","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467653,"discussion_content":"许多，许多！1万个，10万个一点问题都没有，关键点不在这里，你想你应该可以想瓶颈是什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568779465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055710,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1b/de/e63da460.jpg","nickname":"仰泳鱼","note":"","ucode":"341BE9160569CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401475,"discussion_content":"这个感觉，是否是native （安卓，苹果）与 浏览器（js）区别不大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633680148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168314,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d3/ba/75f3b73b.jpg","nickname":"Benjamin","note":"","ucode":"9650EFA8481B41","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215028,"discussion_content":"都是 native 的本地计算能力问题不大，最大问题是上下行的带宽。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585273621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019045,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8c/a5/e0d96e36.jpg","nickname":"helloa","note":"","ucode":"A230063B5998B8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35686,"discussion_content":"带宽根本撑不住","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571298493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667704,"avatar":"","nickname":"Geek_d0be2a","note":"","ucode":"D7E1E3C3680D93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33101,"discussion_content":"带宽消耗比较大吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571098051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133861,"user_name":"John","can_delete":false,"product_type":"c1","uid":1020861,"ip_address":"","ucode":"E4ADF8488953FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg","comment_is_top":false,"comment_ctime":1568685618,"is_pvip":false,"replies":[{"id":"51464","content":"没有，烧不烧钱其实与你的业务有很大关系，如果人数少的话你用Mesh方案是最省钱的。","user_name":"作者回复","comment_id":133861,"uid":"1507837","ip_address":"","utype":1,"ctime":1568779942,"user_name_real":"garrylee"}],"discussion_count":3,"race_medal":0,"score":"5863652914","product_id":100031801,"comment_content":"SFU相当于中转服务器 他的outbound bandwidth流量会消耗很大呀 很烧钱呀 李哥有没有更省钱又不影响效果的方案呢","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467537,"discussion_content":"没有，烧不烧钱其实与你的业务有很大关系，如果人数少的话你用Mesh方案是最省钱的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568779942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055710,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1b/de/e63da460.jpg","nickname":"仰泳鱼","note":"","ucode":"341BE9160569CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401479,"discussion_content":"感觉第一是根据业务来。第二感觉要跟着现有库来。 如果mesh淘汰了没有现存的库。还是得用其他方案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633680238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020861,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg","nickname":"John","note":"","ucode":"E4ADF8488953FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":15014,"discussion_content":"如果是一個老師對倆學生的自然可以用mesh \n如果像直播這種情況的 一兩個人講 幾百幾千人聽 那麼是不是只能選擇SFU了 註定會很燒錢的吧😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568795780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132097,"user_name":"小沙弥","can_delete":false,"product_type":"c1","uid":1181549,"ip_address":"","ucode":"A65746124B9010","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/6d/f2d3bb3e.jpg","comment_is_top":false,"comment_ctime":1568022362,"is_pvip":false,"replies":[{"id":"50609","content":"js里有回音消除的开关，应该是在 getUserMedia这个 API 的contraints中的音频配置中设置的，你可以将它打开。","user_name":"作者回复","comment_id":132097,"uid":"1507837","ip_address":"","utype":1,"ctime":1568088908,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5862989658","product_id":100031801,"comment_content":"老师，我想问一下，浏览器中用js可以实现回音消除吗？我在做一个sip的终端与浏览器互通的项目，噪声回音怎么处理啊？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466761,"discussion_content":"js里有回音消除的开关，应该是在 getUserMedia这个 API 的contraints中的音频配置中设置的，你可以将它打开。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568088908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132071,"user_name":"Walter","can_delete":false,"product_type":"c1","uid":1657769,"ip_address":"","ucode":"0E310BA9CC2D59","user_header":"","comment_is_top":false,"comment_ctime":1568018481,"is_pvip":false,"replies":[{"id":"50610","content":"必须的！","user_name":"作者回复","comment_id":132071,"uid":"1507837","ip_address":"","utype":1,"ctime":1568088930,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5862985777","product_id":100031801,"comment_content":"1对1 方案中的云服务器需要2M的带宽，sfu方案是不是需要更高的带宽呢？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466746,"discussion_content":"必须的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568088930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342313,"user_name":"林克盛","can_delete":false,"product_type":"c1","uid":2024163,"ip_address":"","ucode":"C5102D7A5F1AD6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJW8PREFPamKa8z1fgiaGib83l1IV6grtSxESQz832BACELvB8pDoz9icGuU4R3lbwlulzHH0L1RokZQ/132","comment_is_top":false,"comment_ctime":1650186686,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650186686","product_id":100031801,"comment_content":"mcu的c是control吧？","like_count":0},{"had_liked":false,"id":340828,"user_name":"Leeing","can_delete":false,"product_type":"c1","uid":1374118,"ip_address":"","ucode":"5264B8340DE54F","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/a6/79a835ac.jpg","comment_is_top":false,"comment_ctime":1649167279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649167279","product_id":100031801,"comment_content":"思考题：参考《04 | 可以把采集到的音视频数据录制下来吗？》","like_count":0},{"had_liked":false,"id":264059,"user_name":"三角形小于零","can_delete":false,"product_type":"c1","uid":1026174,"ip_address":"","ucode":"C2F89597662D4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/7e/c9201b20.jpg","comment_is_top":false,"comment_ctime":1606321144,"is_pvip":false,"replies":[{"id":"103817","content":"Mesh就不走服务器","user_name":"作者回复","comment_id":264059,"uid":"1507837","ip_address":"","utype":1,"ctime":1617074790,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1606321144","product_id":100031801,"comment_content":"Mesh 的方案 : 能穿过去确实可以节省服务器资源。   但如果全部走了 relay ，那此时 Mesh 应该是3种中最耗服务器资源的吗？ ","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510407,"discussion_content":"Mesh就不走服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617074790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208335,"user_name":"雨夜","can_delete":false,"product_type":"c1","uid":1326816,"ip_address":"","ucode":"0E5BA80BC98373","user_header":"https://static001.geekbang.org/account/avatar/00/14/3e/e0/f9488a9a.jpg","comment_is_top":false,"comment_ctime":1587341103,"is_pvip":false,"replies":[{"id":"77919","content":"同一路流，分成了多具层，核心层，护展层和边缘层，当带宽不足时，由上层逐渐丢弃！","user_name":"作者回复","comment_id":208335,"uid":"1507837","ip_address":"","utype":1,"ctime":1587381301,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1587341103","product_id":100031801,"comment_content":"svc里面多层是什么意思？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492423,"discussion_content":"同一路流，分成了多具层，核心层，护展层和边缘层，当带宽不足时，由上层逐渐丢弃！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587381301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142132,"user_name":"helloa","can_delete":false,"product_type":"c1","uid":1019045,"ip_address":"","ucode":"A230063B5998B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/a5/e0d96e36.jpg","comment_is_top":false,"comment_ctime":1571298583,"is_pvip":true,"replies":[{"id":"55204","content":"两种都支持，目前用 Simulcast居多。","user_name":"作者回复","comment_id":142132,"uid":"1507837","ip_address":"","utype":1,"ctime":1571586768,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1571298583","product_id":100031801,"comment_content":"目前的实际应用中，是使用Simulcast多还是SVC多呢？WebRTC支持它们吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470997,"discussion_content":"两种都支持，目前用 Simulcast居多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571586768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137713,"user_name":"tiga","can_delete":false,"product_type":"c1","uid":1484831,"ip_address":"","ucode":"390769DADD80C3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJw0VnT9fk33w0Kgic1udf85TmuzBhibIzic188HIlhJ5SLMnVuM8ia9GDpLTia5k2zy0EoXgCj9ibYzvZA/132","comment_is_top":false,"comment_ctime":1569828491,"is_pvip":false,"replies":[{"id":"52941","content":"最终是否混音&#47;混屏要看业务要求了","user_name":"作者回复","comment_id":137713,"uid":"1507837","ip_address":"","utype":1,"ctime":1569839909,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1569828491","product_id":100031801,"comment_content":"在 SFU 方案中，可以制作一个虚拟客户端接入 SFU 服务器，仅拉流，不上传流。<br>这个虚拟客户端接收每个成员的音视频流后，写入文件。<br>如果需要录制成一个文件，那虚拟客户端还要实现混屏和混音功能。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469225,"discussion_content":"最终是否混音/混屏要看业务要求了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569839909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134217,"user_name":"澈","can_delete":false,"product_type":"c1","uid":1199665,"ip_address":"","ucode":"78D094C0F8F70A","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/31/aab3f1ce.jpg","comment_is_top":false,"comment_ctime":1568776703,"is_pvip":false,"replies":[{"id":"51458","content":"可以","user_name":"作者回复","comment_id":134217,"uid":"1507837","ip_address":"","utype":1,"ctime":1568779365,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1568776703","product_id":100031801,"comment_content":"Mesh 方案如果客户端全是用 Adnroid和iOS设备不使用浏览器 是否可以支持多人连接","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467657,"discussion_content":"可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568779365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}