{"id":40729,"title":"03 | 二八原则：有针对性地处理好系统的“热点数据”","content":"<p>假设你的系统中存储有几十亿上百亿的商品，而每天有千万级的商品被上亿的用户访问，那么肯定有一部分被大量用户访问的热卖商品，这就是我们常说的“热点商品”。</p><p>这些热点商品中最极端的例子就是秒杀商品，它们在很短时间内被大量用户执行访问、添加购物车、下单等操作，这些操作我们就称为“热点操作”。那么问题来了：这些热点对系统有啥影响，我们非要关注这些热点吗？</p><h2>为什么要关注热点</h2><p>我们一定要关注热点，因为热点会对系统产生一系列的影响。</p><p>首先，热点请求会大量占用服务器处理资源，虽然这个热点可能只占请求总量的亿分之一，然而却可能抢占90%的服务器资源，如果这个热点请求还是没有价值的无效请求，那么对系统资源来说完全是浪费。</p><p>其次，即使这些热点是有效的请求，我们也要识别出来做针对性的优化，从而用更低的代价来支撑这些热点请求。</p><p>既然热点对系统来说这么重要，那么热点到底包含哪些内容呢？</p><h2>什么是“热点”</h2><p>热点分为<strong>热点操作</strong>和<strong>热点数据</strong>。所谓“热点操作”，例如大量的刷新页面、大量的添加购物车、双十一零点大量的下单等都属于此类操作。对系统来说，这些操作可以抽象为“读请求”和“写请求”，这两种热点请求的处理方式大相径庭，读请求的优化空间要大一些，而写请求的瓶颈一般都在存储层，优化的思路就是根据CAP理论做平衡，这个内容我在“减库存”一文再详细介绍。</p><!-- [[[read_end]]] --><p>而“热点数据”比较好理解，那就是用户的热点请求对应的数据。而热点数据又分为“静态热点数据”和“动态热点数据”。</p><p>所谓“静态热点数据”，就是能够提前预测的热点数据。例如，我们可以通过卖家报名的方式提前筛选出来，通过报名系统对这些热点商品进行打标。另外，我们还可以通过大数据分析来提前发现热点商品，比如我们分析历史成交记录、用户的购物车记录，来发现哪些商品可能更热门、更好卖，这些都是可以提前分析出来的热点。</p><p>所谓“动态热点数据”，就是不能被提前预测到的，系统在运行过程中临时产生的热点。例如，卖家在抖音上做了广告，然后商品一下就火了，导致它在短时间内被大量购买。</p><p>由于热点操作是用户的行为，我们不好改变，但能做一些限制和保护，所以本文我主要针对热点数据来介绍如何进行优化。</p><h2>发现热点数据</h2><p>前面，我介绍了如何对单个秒杀商品的页面数据进行动静分离，以便针对性地对静态数据做优化处理，那么另外一个关键的问题来了：如何发现这些秒杀商品，或者更准确地说，如何发现热点商品呢？</p><p>你可能会说“参加秒杀的商品就是秒杀商品啊”，没错，关键是系统怎么知道哪些商品参加了秒杀活动呢？所以，你要有一个机制提前来区分普通商品和秒杀商品。</p><p>我们从发现静态热点和发现动态热点两个方面来看一下。</p><p><span class=\"orange\">发现静态热点数据</span></p><p>如前面讲的，静态热点数据可以通过商业手段，例如强制让卖家通过报名参加的方式提前把热点商品筛选出来，实现方式是通过一个运营系统，把参加活动的商品数据进行打标，然后通过一个后台系统对这些热点商品进行预处理，如提前进行缓存。但是这种通过报名提前筛选的方式也会带来新的问题，即增加卖家的使用成本，而且实时性较差，也不太灵活。</p><p>不过，除了提前报名筛选这种方式，你还可以通过技术手段提前预测，例如对买家每天访问的商品进行大数据计算，然后统计出TOP N的商品，我们可以认为这些TOP N的商品就是热点商品。</p><p><span class=\"orange\">发现动态热点数据</span></p><p>我们可以通过卖家报名或者大数据预测这些手段来提前预测静态热点数据，但这其中有一个痛点，就是实时性较差，如果我们的系统能在秒级内自动发现热点商品那就完美了。</p><p>能够动态地实时发现热点不仅对秒杀商品，对其他热卖商品也同样有价值，所以我们需要想办法实现热点的动态发现功能。</p><p>这里我给出一个动态热点发现系统的具体实现。</p><ol>\n<li>构建一个异步的系统，它可以收集交易链路上各个环节中的中间件产品的热点Key，如Nginx、缓存、RPC服务框架等这些中间件（一些中间件产品本身已经有热点统计模块）。</li>\n<li>建立一个热点上报和可以按照需求订阅的热点服务的下发规范，主要目的是通过交易链路上各个系统（包括详情、购物车、交易、优惠、库存、物流等）访问的时间差，把上游已经发现的热点透传给下游系统，提前做好保护。比如，对于大促高峰期，详情系统是最早知道的，在统一接入层上Nginx模块统计的热点URL。</li>\n<li>将上游系统收集的热点数据发送到热点服务台，然后下游系统（如交易系统）就会知道哪些商品会被频繁调用，然后做热点保护。</li>\n</ol><p>这里我给出了一个图，其中用户访问商品时经过的路径有很多，我们主要是依赖前面的导购页面（包括首页、搜索页面、商品详情、购物车等）提前识别哪些商品的访问量高，通过这些系统中的中间件来收集热点数据，并记录到日志中。</p><p><img src=\"https://static001.geekbang.org/resource/image/b6/1f/b62bd8bbdc2d2cded2df8adb857bf01f.jpg?wh=1649*1173\" alt=\"\"></p><center><span class=\"reference\">图1  一个动态热点发现系统</span></center><p>我们通过部署在每台机器上的Agent把日志汇总到聚合和分析集群中，然后把符合一定规则的热点数据，通过订阅分发系统再推送到相应的系统中。你可以是把热点数据填充到Cache中，或者直接推送到应用服务器的内存中，还可以对这些数据进行拦截，总之下游系统可以订阅这些数据，然后根据自己的需求决定如何处理这些数据。</p><p>打造热点发现系统时，我根据以往经验总结了几点注意事项。</p><ol>\n<li>这个热点服务后台抓取热点数据日志最好采用异步方式，因为“异步”一方面便于保证通用性，另一方面又不影响业务系统和中间件产品的主流程。</li>\n<li>热点服务发现和中间件自身的热点保护模块并存，每个中间件和应用还需要保护自己。热点服务台提供热点数据的收集和订阅服务，便于把各个系统的热点数据透明出来。</li>\n<li>热点发现要做到接近实时（3s内完成热点数据的发现），因为只有做到接近实时，动态发现才有意义，才能实时地对下游系统提供保护。</li>\n</ol><h2>处理热点数据</h2><p><strong>处理热点数据通常有几种思路：一是优化，二是限制，三是隔离</strong>。</p><p>先来说说优化。优化热点数据最有效的办法就是缓存热点数据，如果热点数据做了动静分离，那么可以长期缓存静态数据。但是，缓存热点数据更多的是“临时”缓存，即不管是静态数据还是动态数据，都用一个队列短暂地缓存数秒钟，由于队列长度有限，可以采用LRU淘汰算法替换。</p><p>再来说说限制。限制更多的是一种保护机制，限制的办法也有很多，例如对被访问商品的ID做一致性Hash，然后根据Hash做分桶，每个分桶设置一个处理队列，这样可以把热点商品限制在一个请求队列里，防止因某些热点商品占用太多的服务器资源，而使其他请求始终得不到服务器的处理资源。</p><p>最后介绍一下隔离。秒杀系统设计的第一个原则就是将这种热点数据隔离出来，不要让1%的请求影响到另外的99%，隔离出来后也更方便对这1%的请求做针对性的优化。</p><p>具体到“秒杀”业务，我们可以在以下几个层次实现隔离。</p><ol>\n<li><strong>业务隔离</strong>。把秒杀做成一种营销活动，卖家要参加秒杀这种营销活动需要单独报名，从技术上来说，卖家报名后对我们来说就有了已知热点，因此可以提前做好预热。</li>\n<li><strong>系统隔离</strong>。系统隔离更多的是运行时的隔离，可以通过分组部署的方式和另外99%分开。秒杀可以申请单独的域名，目的也是让请求落到不同的集群中。</li>\n<li><strong>数据隔离</strong>。秒杀所调用的数据大部分都是热点数据，比如会启用单独的Cache集群或者MySQL数据库来放热点数据，目的也是不想0.01%的数据有机会影响99.99%数据。</li>\n</ol><p>当然了，实现隔离有很多种办法。比如，你可以按照用户来区分，给不同的用户分配不同的Cookie，在接入层，路由到不同的服务接口中；再比如，你还可以在接入层针对URL中的不同Path来设置限流策略。服务层调用不同的服务接口，以及数据层通过给数据打标来区分等等这些措施，其目的都是把已经识别出来的热点请求和普通的请求区分开。</p><h2>总结一下</h2><p>本文与数据的动静分离不一样，它从另外一个维度对数据进行了区分处理。你要明白，区分的目的主要还是对读热点数据加以优化，对照“4要1不要”原则，它可以减少请求量，也可以减少请求的路径。因为缓存的数据都是经过多个请求，或者从多个系统中获取的数据经过计算后的结果。</p><p>热点的发现和隔离不仅对“秒杀”这个场景有意义，对其他的高性能分布式系统也非常有价值，尤其是热点的隔离非常重要。我介绍了业务层面的隔离和数据层面的隔离方式，最重要最简单的方式就是独立出来一个集群，单独处理热点数据。</p><p>但是能够独立出来一个集群的前提还是首先能够发现热点，为此我介绍了发现热点的几种方式，比如人工标识、大数据统计计算，以及实时热点发现方案，希望能够给你启发。</p><p>最后，欢迎你在留言区和我交流，你也可以说说在实际工作中，还有哪些发现和解决热点问题的不同思路或方案，非常期待。</p><p></p>","neighbors":{"left":{"article_title":"02 | 如何才能做好动静分离？有哪些方案可选？","id":40727},"right":{"article_title":"04 | 流量削峰这事应该怎么做？","id":40736}},"comments":[{"had_liked":false,"id":29995,"user_name":"放羊大王","can_delete":false,"product_type":"c1","uid":1048055,"ip_address":"","ucode":"9A34441D173DA1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/f7/8c78c31d.jpg","comment_is_top":false,"comment_ctime":1538621496,"is_pvip":false,"replies":[{"id":"11689","content":"😏","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497198,"ip_address":"","comment_id":29995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"83143000120","product_id":100017501,"comment_content":"思路大概是通过日志和数据分析判断，某商品是热点，即将有大量请求到来。把商品请求移交给另外的秒杀系统，秒杀系统动静分离出html页面，和ajax请求。","like_count":19,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425804,"discussion_content":"😏","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29722,"user_name":"A星空之夜","can_delete":false,"product_type":"c1","uid":1110974,"ip_address":"","ucode":"E99D61B7827532","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/be/d8ba00d5.jpg","comment_is_top":false,"comment_ctime":1538520257,"is_pvip":false,"replies":[{"id":"10767","content":"微博我没做过，但是我觉得大体思路应该是通用的<br><br>微博的内容基本是静态数据，发了就不能修改，所以cache应该没问题，而微博的热点比较明显，所以发现热点和对热点数据进行针对性的优化比较重要<br><br>至于要怎么进行优化还要看看微博的数据结构是怎么设计的，微博内容和评论的关系已经发微博的人和关注的人关系等","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538620272,"ip_address":"","comment_id":29722,"utype":1}],"discussion_count":8,"race_medal":0,"score":"65963029697","product_id":100017501,"comment_content":"如果是微博的热点数据，应该怎么优化读操作呢","like_count":15,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425697,"discussion_content":"微博我没做过，但是我觉得大体思路应该是通用的\n\n微博的内容基本是静态数据，发了就不能修改，所以cache应该没问题，而微博的热点比较明显，所以发现热点和对热点数据进行针对性的优化比较重要\n\n至于要怎么进行优化还要看看微博的数据结构是怎么设计的，微博内容和评论的关系已经发微博的人和关注的人关系等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538620272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1192175,"avatar":"https://static001.geekbang.org/account/avatar/00/12/30/ef/41cc51aa.jpg","nickname":"子矜","note":"","ucode":"C8C0A37A769F45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398461,"discussion_content":"通过动态构建trie树的方式，维护topK的热点并做缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632795858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142025,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6d/09/ffeabc27.jpg","nickname":"任鑫","note":"","ucode":"9803EB15B634C3","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374043,"discussion_content":"胡忠想有微博相关的专栏","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620978757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walle斌","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291025,"discussion_content":"微博的问题在于 热的数据太热，冷的数据很冷，同时，热的数据会在极端的时间内爆炸式访问，挂也是挂在爆炸式增长的过程，扩容都来不及，主站流量会因为明星的各种事儿，10分钟内量提升10倍以上。。而这种完全不可预期的热，是特别难处理的，比如有明星喜欢中午头宣布，有的喜欢晚上11点 12点。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594685986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1951729,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQtNOiboVY74YK3rI22kyqwcXZFaiaic1QMNgGiak1uSuxutkVMcicoiacuaahVkia8eDUVUdRQenvr0UTA/132","nickname":"Geek_9b9391","note":"","ucode":"621B5E752C6F74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walle斌","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377760,"discussion_content":"可以让明星官宣的时候，提前通知下微博吗","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1622816353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291025,"ip_address":""},"score":377760,"extra":""},{"author":{"id":1801058,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/7b/62/ec94cee4.jpg","nickname":"彭文达","note":"","ucode":"8DCC27EC5AF263","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1951729,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQtNOiboVY74YK3rI22kyqwcXZFaiaic1QMNgGiak1uSuxutkVMcicoiacuaahVkia8eDUVUdRQenvr0UTA/132","nickname":"Geek_9b9391","note":"","ucode":"621B5E752C6F74","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406876,"discussion_content":"骚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634864224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377760,"ip_address":""},"score":406876,"extra":""}]},{"author":{"id":1161271,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","nickname":"不似旧日","note":"","ucode":"DF4C5E3AB9570C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187938,"discussion_content":"微博发的内容可以修改的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582780418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1857536,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoG6W3ugJo1XEqmLPULB9o19GribV7hDZTMuVauvcpW8gaS2QPibwMkxce4fT2xCLGqRG0rx3V9WAWA/132","nickname":"睡不醒的🐷","note":"","ucode":"E88BD4EAD6F655","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167915,"discussion_content":"内存缓存,热点缓存数据也是存在靠近用户最近的地方存储","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581523003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291105,"user_name":"wsyzwddsg111","can_delete":false,"product_type":"c1","uid":2582372,"ip_address":"","ucode":"7C59E81ECFF8AB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/sTmCOXh19off3uvUDIsDic4SYJGulgl1v6o3R4E32OZCkZAVzZw751jg9Tya8jLicxKzQWHC4Bu6o08J55YJib9oQ/132","comment_is_top":false,"comment_ctime":1620027864,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53159635416","product_id":100017501,"comment_content":"文字超多，概念超多，例子超少，你应该想象一下，买课的大多数相当于阿里p5 p6级别，怎么让这些人能听懂才是最重要的","like_count":12,"discussions":[{"author":{"id":2028948,"avatar":"","nickname":"Geek2808","note":"","ucode":"835C9691723163","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591610,"discussion_content":"讲的很通透了啊  毕竟不是写项目，主要在于思路的分享。  具体的实践，还需要在业务上实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666702864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1158156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/0c/f3e37765.jpg","nickname":"夏","note":"","ucode":"2DE213960503A8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577039,"discussion_content":"垃圾课程，纯骗钱","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655896754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37985,"user_name":"qingbusheng","can_delete":false,"product_type":"c1","uid":1053437,"ip_address":"","ucode":"40B93065442A93","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/fd/b94cd881.jpg","comment_is_top":false,"comment_ctime":1541839897,"is_pvip":false,"replies":[{"id":"14458","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542528872,"ip_address":"","comment_id":37985,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35901578265","product_id":100017501,"comment_content":"解决快速发现热点数据的另一个思路：1.在前端nginx 通过商品、下单、购物车URI 做数据镜像 2 通过nginx+lua+redis 根据不同的业务key 做计数，如果超过设定阈值则采用redis 发布订阅机制或消息中间件 通知下游Cache  模块缓存数据。感谢老师点评","like_count":8,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428547,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542528872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30038,"user_name":"爱我曲","can_delete":false,"product_type":"c1","uid":1228382,"ip_address":"","ucode":"7E6C8B326CB1CD","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/5e/796c9dd0.jpg","comment_is_top":false,"comment_ctime":1538631792,"is_pvip":false,"replies":[{"id":"11695","content":"例如对每个请求的商品id取模，让后根据取模的结果分别设置多个linkedhashmap，每个map当做一个队列","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497555,"ip_address":"","comment_id":30038,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35898370160","product_id":100017501,"comment_content":"例如对被访问商品的 ID 做一致性 Hash，然后根据 Hash 做分桶，每个分桶设置一个处理队列，这样可以把热点商品限制在一个请求队列里<br>-----------------------<br>作者，您好，这个分桶设置处理队列是怎么实现的？可以讲下实现过程吗？","like_count":8,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425826,"discussion_content":"例如对每个请求的商品id取模，让后根据取模的结果分别设置多个linkedhashmap，每个map当做一个队列","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108761,"avatar":"https://static001.geekbang.org/account/avatar/00/10/eb/19/76b0b98c.jpg","nickname":"torres","note":"","ucode":"34DABCFC7B74EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293817,"discussion_content":"前面收集了热点数据，那我们只要那商品id取redis里面查一下，是不是属于热点数据。如果是热点数据，就指定写到一个独立的一个队列中不就可以了？ 比较困惑，希望有人指点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595680780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108761,"avatar":"https://static001.geekbang.org/account/avatar/00/10/eb/19/76b0b98c.jpg","nickname":"torres","note":"","ucode":"34DABCFC7B74EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293816,"discussion_content":"这个地方一直很困惑，老师讲得太晦涩。\n我的理解是，这个地方并不能把热点商品设置到单独的处理队列中，因为我们不能根据商品id知道这个商品是不是热点商品。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595680067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30646,"user_name":"诗泽","can_delete":false,"product_type":"c1","uid":1031865,"ip_address":"","ucode":"F28BE01C3FD12F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/b9/f2481c2c.jpg","comment_is_top":false,"comment_ctime":1538964908,"is_pvip":false,"replies":[{"id":"11676","content":"不一定非要用队列，也可以用其他内存集合如hashmap都行<br>缓存数据，一般静态数据可以提前加载到内存，如通过配置系统推送的方式。动态数据可以在远程调用时零时缓存在本机中。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539495977,"ip_address":"","comment_id":30646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23013801388","product_id":100017501,"comment_content":"但是，缓存热点数据更多的是“临时”缓存，即不管是静态数据还是动态数据，都用一个队列短暂地缓存数秒钟，由于队列长度有限，可以采用 LRU 淘汰算法替换。<br><br>为什么选择用队列来缓存数据呢，队列如何做到快速读取缓存数据的呢？","like_count":5,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426058,"discussion_content":"不一定非要用队列，也可以用其他内存集合如hashmap都行\n缓存数据，一般静态数据可以提前加载到内存，如通过配置系统推送的方式。动态数据可以在远程调用时零时缓存在本机中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539495977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37017,"user_name":"rango","can_delete":false,"product_type":"c1","uid":1217320,"ip_address":"","ucode":"A3A9625EEAC465","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/28/692a12f9.jpg","comment_is_top":false,"comment_ctime":1541422130,"is_pvip":false,"replies":[{"id":"14464","content":"日志收集和存储的技术现在都比较成熟了，有很多开源的组件，例如zabbix可以学习一下他是如何实现的","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542529541,"ip_address":"","comment_id":37017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18721291314","product_id":100017501,"comment_content":"你好，想问一下通过异步采集日志的形式获取热点数据这方面的话，我想知道日志如何存储，是不是加一些特定字符串以便收集，采集的方法等技术，有没有思路或者推荐的文章等。","like_count":4,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428125,"discussion_content":"日志收集和存储的技术现在都比较成熟了，有很多开源的组件，例如zabbix可以学习一下他是如何实现的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542529541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282862,"user_name":"Geek_b9e729","can_delete":false,"product_type":"c1","uid":1609340,"ip_address":"","ucode":"E7607DE48AAA1F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmql1FP9mYRmcIg8eGibU7ibhQ1Hph3LZerO90b2ibFNtIc20laZqnfCyrrGxfPeh9WmVdKdAz6bhng/132","comment_is_top":false,"comment_ctime":1615443015,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14500344903","product_id":100017501,"comment_content":"这个课程干货太少了，建议极客教育出一个对课程评分的功能","like_count":4},{"had_liked":false,"id":35664,"user_name":"重案组之虎","can_delete":false,"product_type":"c1","uid":1152094,"ip_address":"","ucode":"4CE2CE87C4E689","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/5e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1540734423,"is_pvip":false,"replies":[{"id":"13019","content":"是不好做，隔离数据是按照一个纬度隔离的，例如隔离秒杀商品，是按照商品纬度，就是把一部分商品数据单独放到另外一个数据库，这样只要把一部分商品路由到新的隔离数据库就行了。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1541240591,"ip_address":"","comment_id":35664,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14425636311","product_id":100017501,"comment_content":"关于隔离层次的一个小问题：想了下数据隔离好像不太好实现吧？如果都是只读的，那么还好办一些，开一些只读实例专用就好，但是这样的场景肯定会有写请求，但是写的记录要和其他数据互通，最后不还得打到数据库集群里么？这好像和“启用单独的 MySQL”相悖了......请老师具体指教下，多谢！","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427616,"discussion_content":"是不好做，隔离数据是按照一个纬度隔离的，例如隔离秒杀商品，是按照商品纬度，就是把一部分商品数据单独放到另外一个数据库，这样只要把一部分商品路由到新的隔离数据库就行了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541240591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028212,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b0/74/f553f094.jpg","nickname":"Enjoystudy","note":"","ucode":"179ECDFA5F518B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46696,"discussion_content":"这里既然是隔离肯定是有一个Touting的逻辑，对于热数据的读写都Route到特定的数据库，最终通过异步的方式要么数据异构，要么数据合并，总体思想还是最终一致性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573195374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29815,"user_name":"Mr.钧👻","can_delete":false,"product_type":"c1","uid":1249939,"ip_address":"","ucode":"D781E030E79245","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg","comment_is_top":false,"comment_ctime":1538552931,"is_pvip":false,"replies":[{"id":"10761","content":"亿分之一是指热点商品指占商品用量的比例很小<br><br>占用服务器资源是指一台服务器秒杀商品的qps占了大部分请求比例","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538619129,"ip_address":"","comment_id":29815,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14423454819","product_id":100017501,"comment_content":"虽然这个热点可能只占请求总量的亿分之一，但是可能占用服务器90%的资源<br><br>这句话是什么意思呢？可以详细解释一下吗？","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425728,"discussion_content":"亿分之一是指热点商品指占商品用量的比例很小\n\n占用服务器资源是指一台服务器秒杀商品的qps占了大部分请求比例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538619129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38524,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1542071198,"is_pvip":false,"replies":[{"id":"14450","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542528165,"ip_address":"","comment_id":38524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132005790","product_id":100017501,"comment_content":"这节的重点感觉是加深对二八原理的认识，这个原理不知为何好像具有普适的感觉，各个领域都有它的用武之地。","like_count":2,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428735,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542528165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88066,"user_name":"Jefung","can_delete":false,"product_type":"c1","uid":1500983,"ip_address":"","ucode":"E286D0640A724D","user_header":"https://static001.geekbang.org/account/avatar/00/16/e7/37/0a7a27cb.jpg","comment_is_top":false,"comment_ctime":1555834037,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5850801333","product_id":100017501,"comment_content":"分桶限制还是无法理解, 这么处理才能把热点请求和正常请求区分开","like_count":1,"discussions":[{"author":{"id":1108761,"avatar":"https://static001.geekbang.org/account/avatar/00/10/eb/19/76b0b98c.jpg","nickname":"torres","note":"","ucode":"34DABCFC7B74EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293799,"discussion_content":"我也不能理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595670666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38522,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1542071039,"is_pvip":false,"replies":[{"id":"14451","content":"虽然土点，但是有效😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542528252,"ip_address":"","comment_id":38522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837038335","product_id":100017501,"comment_content":"热点数据-我们之前做过一个系统也用到热点数据，我们的思路比较简单，对于仓库生产，仓库的范围是有限的，具体到仓，从业务的角度出发北上广的仓库基本属于比较热的数据，于是就有了定时和手动往缓存中刷新热点数据的处理方式了。","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428733,"discussion_content":"虽然土点，但是有效😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542528252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30349,"user_name":"halo","can_delete":false,"product_type":"c1","uid":1094969,"ip_address":"","ucode":"D1A89B8C281DF6","user_header":"https://static001.geekbang.org/account/avatar/00/10/b5/39/1ff75b02.jpg","comment_is_top":false,"comment_ctime":1538802848,"is_pvip":false,"replies":[{"id":"11007","content":"也可以把他当成后台系统的一部分，但是中间件本身就一直存在，并不是因为热点发现系统才加入的。<br><br>中间件记录热点大部分是记录到日志里面的，但也不绝对","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538904485,"ip_address":"","comment_id":30349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5833770144","product_id":100017501,"comment_content":"图1 热点发现系统: 中间件nginx cache rpc 为什么不是后台服务的一部分呢 ？ 还是说中间件构成的异步监控系统用来日志记录？","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425951,"discussion_content":"也可以把他当成后台系统的一部分，但是中间件本身就一直存在，并不是因为热点发现系统才加入的。\n\n中间件记录热点大部分是记录到日志里面的，但也不绝对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538904485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29858,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1538567346,"is_pvip":false,"replies":[{"id":"10760","content":"热点的统计可以很简单的对访问的商品进行访问计数，然后排序<br>还有就是用通常的队列的淘汰算法如lru等都可以实现","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538618959,"ip_address":"","comment_id":29858,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5833534642","product_id":100017501,"comment_content":"发现动态热点中的第二点，建立一个热点上报。。<br>怎么判断数据是不是热点呢？是一个具体的算法没有写出来吗?这个地方看了好几遍都看不明白，请指点。","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425744,"discussion_content":"热点的统计可以很简单的对访问的商品进行访问计数，然后排序\n还有就是用通常的队列的淘汰算法如lru等都可以实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538618959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028212,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b0/74/f553f094.jpg","nickname":"Enjoystudy","note":"","ucode":"179ECDFA5F518B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46697,"discussion_content":"上报是为了分析出热点数据，是分析工具的一部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573195555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29773,"user_name":"iWill","can_delete":false,"product_type":"c1","uid":1110120,"ip_address":"","ucode":"5F29DAF5472E17","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/68/afb36ef6.jpg","comment_is_top":false,"comment_ctime":1538536910,"is_pvip":false,"replies":[{"id":"10762","content":"对秒杀这个场景，商品基本是固定的，基本都会一直在内存中","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538619201,"ip_address":"","comment_id":29773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5833504206","product_id":100017501,"comment_content":"缓存数据，LRU淘汰算法，那么缓存的这些数据会不会频繁的移动、删除，并发比较大的时候会不会成为性能的瓶颈，想了解下。","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425712,"discussion_content":"对秒杀这个场景，商品基本是固定的，基本都会一直在内存中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538619201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356983,"user_name":"码小呆","can_delete":false,"product_type":"c1","uid":2055809,"ip_address":"广东","ucode":"44532D6ABF9340","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5e/81/82709d6e.jpg","comment_is_top":false,"comment_ctime":1662788829,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662788829","product_id":100017501,"comment_content":"现在有开源的框架来监控热点吗?","like_count":0},{"had_liked":false,"id":313139,"user_name":"战国","can_delete":false,"product_type":"c1","uid":1007207,"ip_address":"","ucode":"35EE42207936DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/67/95c74229.jpg","comment_is_top":false,"comment_ctime":1632295198,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632295198","product_id":100017501,"comment_content":"挺好的，推荐一篇前公司的简单实现：<br>https:&#47;&#47;tech.youzan.com&#47;tmc&#47;<br><br>自动发现热点 并 将热点缓存访问请求前置在应用层本地缓存 的解决方案，这就是 TMC 产生的原因。","like_count":0},{"had_liked":false,"id":305477,"user_name":"石建","can_delete":false,"product_type":"c1","uid":1041013,"ip_address":"","ucode":"72339F0F3463E8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/75/94039076.jpg","comment_is_top":false,"comment_ctime":1627986905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627986905","product_id":100017501,"comment_content":"物理隔离，在实操时，会考虑哪些成本？为什么会困难？","like_count":0},{"had_liked":false,"id":293292,"user_name":"天信","can_delete":false,"product_type":"c1","uid":1232463,"ip_address":"","ucode":"4961959C9F19E9","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/4f/6afbb99a.jpg","comment_is_top":false,"comment_ctime":1621325309,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621325309","product_id":100017501,"comment_content":"关于 3s 发现热点商品有一些困惑<br>1.  如果 cache 满了，需要剔除数据，发现的热点商品和老的热点商品数据如如何做剔除策略（LRU 可以吗，或者其他更好的策略）<br>2. 3s 内如果有热点商品突发流量，cache 没有热点数据导致下游扛不住而崩溃，如何看待这类问题以及有没有好的解决方案呢","like_count":0,"discussions":[{"author":{"id":1754972,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/c7/5c/02dbb582.jpg","nickname":"lz","note":"","ucode":"6A55D6B8B0A775","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549702,"discussion_content":"1. LFU,但是应该现在线上一般没用。LRU足够，老的热点商品如果这段时间没访问是可以进行淘汰的。毕竟秒杀是个某小段时间的持续过程，老的热点商品是可以进行淘汰的\n2. 文章中有句话“热点服务发现和中间件自身的热点保护模块并存”，下游应该不能完全依赖于热点发现，同时要自身做好限流熔断保护来保证自己的应用不挂。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644216641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262676,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1605800124,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1605800124","product_id":100017501,"comment_content":"秒杀商品很有可能会成为系统的“热点”，对于那些能够提前预测的静态热点数据，相对比较容易处理（类似于动静分离里面的静态数据），而在系统运行过程中出现的，不能被提前预测到的动态热点数据，无疑会给系统带来更大的“麻烦”。<br><br>通常情况下，可能不需要去处理动态热点，而类似于双十一这样持续时间相对长一些，则可能会面临动态热点的问题。<br><br>现在比较火的“直播带货”，会带来动态热点么？我感觉一般不会。更可能是静态热点，也就是商家提前会有所准备。<br><br>感觉发现动态热点，然后进行处理，这个其实还是挺难的。微博不就一直都没能处理好么，开玩笑的说。","like_count":0},{"had_liked":false,"id":256342,"user_name":"liu","can_delete":false,"product_type":"c1","uid":1914817,"ip_address":"","ucode":"51F12E4AD09700","user_header":"https://static001.geekbang.org/account/avatar/00/1d/37/c1/280c238a.jpg","comment_is_top":false,"comment_ctime":1603603418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603603418","product_id":100017501,"comment_content":"二八定律使用范围+1","like_count":0},{"had_liked":false,"id":237083,"user_name":"torres","can_delete":false,"product_type":"c1","uid":1108761,"ip_address":"","ucode":"34DABCFC7B74EA","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/19/76b0b98c.jpg","comment_is_top":false,"comment_ctime":1595670987,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595670987","product_id":100017501,"comment_content":"再来说说限制。限制更多的是一种保护机制，限制的办法也有很多，例如对被访问商品的 ID 做一致性 Hash，然后根据 Hash 做分桶，每个分桶设置一个处理队列，这样可以把热点商品限制在一个请求队列里，防止因某些热点商品占用太多的服务器资源，而使其他请求始终得不到服务器的处理资源。<br><br>问题有2：<br>1. 这种方式为什么就能把热点商品和普通商品区分开？<br>2.所有的热点商品id取hash之后的值并不一定相同，为什么就会到一个桶里面？","like_count":0},{"had_liked":false,"id":225994,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1591925447,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591925447","product_id":100017501,"comment_content":"老师您好，咨询一下，本文开头说“这个热点可能只占请求总量的亿分之一，然而却可能抢占 90% 的服务器资源”，这个是为什么呢？ 另外我理解秒杀场景的热点数据在短时间内占请求总量也挺大的。","like_count":0},{"had_liked":false,"id":218773,"user_name":"山猫","can_delete":false,"product_type":"c1","uid":1466682,"ip_address":"","ucode":"004F622AEDA906","user_header":"https://static001.geekbang.org/account/avatar/00/16/61/3a/a259c187.jpg","comment_is_top":false,"comment_ctime":1589873856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589873856","product_id":100017501,"comment_content":"秒杀真的是神坑，特别是在防止超卖这一块。至于页面读请求可以通过缓存或者预加载能分担一些，防止超卖简直了。","like_count":0},{"had_liked":false,"id":194802,"user_name":"未命名","can_delete":false,"product_type":"c1","uid":1178114,"ip_address":"","ucode":"414CAE9E927CD3","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/02/7e70ada0.jpg","comment_is_top":false,"comment_ctime":1585107227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585107227","product_id":100017501,"comment_content":"学习打开！","like_count":0},{"had_liked":false,"id":192079,"user_name":"Mango","can_delete":false,"product_type":"c1","uid":1734886,"ip_address":"","ucode":"EC2D20BD322E22","user_header":"","comment_is_top":false,"comment_ctime":1584836942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584836942","product_id":100017501,"comment_content":"热点数据在秒杀时位置很重要","like_count":0},{"had_liked":false,"id":177894,"user_name":"睡不醒的🐷","can_delete":false,"product_type":"c1","uid":1857536,"ip_address":"","ucode":"E88BD4EAD6F655","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoG6W3ugJo1XEqmLPULB9o19GribV7hDZTMuVauvcpW8gaS2QPibwMkxce4fT2xCLGqRG0rx3V9WAWA/132","comment_is_top":false,"comment_ctime":1581523225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581523225","product_id":100017501,"comment_content":"作者,秒杀的系统数据相对来说都是静态热点数据,你这个分析的动态热点数据其实跟秒杀没多大关系吧,卖家不可能无缘无故发起一个秒杀活动,肯定像文中所说的一样是需要对此商品进行打标的行为.<br>虽然介绍了怎样收集动态热点数据的方案,还是不错的,但总体感觉上有些跑题","like_count":0},{"had_liked":false,"id":114729,"user_name":"杨晓维","can_delete":false,"product_type":"c1","uid":1434854,"ip_address":"","ucode":"4B657DD4A1E2C4","user_header":"https://static001.geekbang.org/account/avatar/00/15/e4/e6/5795b1aa.jpg","comment_is_top":false,"comment_ctime":1563371483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563371483","product_id":100017501,"comment_content":"请问老师，异步读取日志具体怎么实现？","like_count":0},{"had_liked":false,"id":111157,"user_name":"immortalCockroach","can_delete":false,"product_type":"c1","uid":1157912,"ip_address":"","ucode":"9A4F497BEA7DFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/ab/18/b01e71d1.jpg","comment_is_top":false,"comment_ctime":1562494003,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562494003","product_id":100017501,"comment_content":"热点请求会大量占用服务器处理资源，虽然这个热点可能只占请求总量的亿分之一，然而却可能抢占 90% 的服务器资源<br>这个怎么理解，请求量少为什么还会大量占用资源呢？","like_count":0},{"had_liked":false,"id":87803,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1555720041,"is_pvip":false,"replies":[{"id":"34291","content":"加过期时间也是一个好思路","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1558246406,"ip_address":"","comment_id":87803,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555720041","product_id":100017501,"comment_content":"请问下老师缓存数据，LRU淘汰算法的实现可不可以用redis加一个过期时间，如果可以的话是否需要动态的判断过期时间，如果不可以的话是什么原因不可以？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447608,"discussion_content":"加过期时间也是一个好思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558246406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77183,"user_name":"威猛小茂然","can_delete":false,"product_type":"c1","uid":1196929,"ip_address":"","ucode":"E4E9B1ED9021C0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTA5BZT4zapBbpHctcDGs2M9NFIkwEWXoicUwBsmCZSRlNzGI7NYXicZAOibLKVyE2u7ib8PuibXibel9g/132","comment_is_top":false,"comment_ctime":1552878314,"is_pvip":false,"replies":[{"id":"30092","content":"：）","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1554532667,"ip_address":"","comment_id":77183,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552878314","product_id":100017501,"comment_content":"写的挺好的","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443623,"discussion_content":"：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554532667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71344,"user_name":"李白","can_delete":false,"product_type":"c1","uid":1252278,"ip_address":"","ucode":"116222C25AD7A2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSOdlyhhLrC1VKjjRNcltY8Qic3QUviaMnA3cFNMyyib4lVibuPBO2hzfmUiaNIzkFty8b5pLOjUdfh8Q/132","comment_is_top":false,"comment_ctime":1551324396,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551324396","product_id":100017501,"comment_content":"再来说说限制。限制更多的是一种保护机制，限制的办法也有很多，例如对被访问商品的 ID 做一致性 Hash，然后根据 Hash 做分桶，每个分桶设置一个处理队列，这样可以把热点商品限制在一个请求队列里，防止因某些热点商品占用太多的服务器资源，而使其他请求始终得不到服务器的处理资源。<br>这个具体怎么操作呢?nginx可以处理吗?","like_count":0},{"had_liked":false,"id":71075,"user_name":"FreeMason","can_delete":false,"product_type":"c1","uid":1340120,"ip_address":"","ucode":"3D58AC2F9AB345","user_header":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","comment_is_top":false,"comment_ctime":1551259496,"is_pvip":false,"replies":[{"id":"26126","content":"数据库层深层优化我不是专家，建议可以参考一下MySQL的优化书籍😁","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1551525837,"ip_address":"","comment_id":71075,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551259496","product_id":100017501,"comment_content":"DB 层，如何对热点数据进行优化呢？比如：a 表的某一行的库存，是热点更新？除了把数据拦在 DB 层之外的，进入 DB 层的热点更新请求，要如何给 DB 减压呢？想到给热点行的库存分成多个减压，当缺点太多，而且对于动态热点没用。其它方案都还有那几种？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440976,"discussion_content":"数据库层深层优化我不是专家，建议可以参考一下MySQL的优化书籍😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551525837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63833,"user_name":"williamcai","can_delete":false,"product_type":"c1","uid":1158294,"ip_address":"","ucode":"B158F52C2D39BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/96/46b13896.jpg","comment_is_top":false,"comment_ctime":1548549092,"is_pvip":false,"replies":[{"id":"23142","content":"这个具体的指标要看情况，不一定就是多少次就判定是热点，也可能根据top多少来设置，到底设置多少合理，要根据其他一些因素来综合考虑，例如缓存这些热点的cache空间大小以及你对这些热点的处理方式（例如可能会限流）都会影响。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1549163601,"ip_address":"","comment_id":63833,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548549092","product_id":100017501,"comment_content":"热点发现系统，通过日志分析出热点数据，有没有判断标准说明该数据是热点，比如搜索次数达到多少，能不能给出具体的指标","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437727,"discussion_content":"这个具体的指标要看情况，不一定就是多少次就判定是热点，也可能根据top多少来设置，到底设置多少合理，要根据其他一些因素来综合考虑，例如缓存这些热点的cache空间大小以及你对这些热点的处理方式（例如可能会限流）都会影响。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549163601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62443,"user_name":"Andy_Claire","can_delete":false,"product_type":"c1","uid":1033391,"ip_address":"","ucode":"71E40160A43C0E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/af/d4dda252.jpg","comment_is_top":false,"comment_ctime":1548058909,"is_pvip":false,"replies":[{"id":"23139","content":"从效果上来说，都是为了达到保护的作用。限制是防止你越界，而隔离是不让你越界 ：）","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1549163066,"ip_address":"","comment_id":62443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548058909","product_id":100017501,"comment_content":"你好, 看到你处理热点数据的思路, 其中限制和隔离让我有点混淆, 感觉区别不大. 你给出限制的做法是根据id做hash, 然后用单独的队列处理.  我理解这也是一种维度(请求)的隔离. ","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437216,"discussion_content":"从效果上来说，都是为了达到保护的作用。限制是防止你越界，而隔离是不让你越界 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549163066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35867,"user_name":"扬夫图拉杨夫斯基","can_delete":false,"product_type":"c1","uid":1178273,"ip_address":"","ucode":"E041ED6137AD9B","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/a1/0f90dd32.jpg","comment_is_top":false,"comment_ctime":1540825655,"is_pvip":false,"replies":[{"id":"13018","content":"收集数据最好采用异步读取日志的方式，这种可以把热点收集和业务系统解藕，防止你本来是锦上添花的事情反而把正常的业务系统高挂了，那样就不好了＾０＾~","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1541240325,"ip_address":"","comment_id":35867,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540825655","product_id":100017501,"comment_content":"大佬我从你的这一节得到灵感，文中提到一个热数据收集和处理的一个反馈系统，前边的步骤对数据打标，最终有些数据会成为热数据，然后推到redis，我觉得这个系统反应一定要快，我打算去实现这个东西，那这样就会大体有三个模块，队列数据生产方，消费方，还有一个热数据收集分析模块，我叫它A模块，A会独立出来，如果我用netty去做合适吗？或者说楼主对这个系统有什么要说的嘛？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427693,"discussion_content":"收集数据最好采用异步读取日志的方式，这种可以把热点收集和业务系统解藕，防止你本来是锦上添花的事情反而把正常的业务系统高挂了，那样就不好了＾０＾~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541240325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35397,"user_name":"afeng","can_delete":false,"product_type":"c1","uid":1211696,"ip_address":"","ucode":"D17D7048879313","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIduoLOkCVsJzvbc1yX3FYI2icgic61EfRJ9fdatR22vOrMMBLYDY5KliaWNEbqeib1DxOMNnKeW7qENg/132","comment_is_top":false,"comment_ctime":1540539658,"is_pvip":false,"replies":[{"id":"12625","content":"热点发现的目标是发现现有机制下不被保护的数据，再提供额外的手段保护系统，例如增加一个内存cache队列缓存热点数据<br><br>当然在部分场景下，可能也会存在热点数据被重复发现例如在nginx层被发现的热点，那么就看你的系统怎么使用这些热点数据了，你如果也想把他加入现有的cache中，那么就要判断一下，是否已经缓存了。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540605542,"ip_address":"","comment_id":35397,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540539658","product_id":100017501,"comment_content":"根据现有的cache机制，在热点数据被发现，加入cache前，该热点数据会不会就已经在cache中了？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427526,"discussion_content":"热点发现的目标是发现现有机制下不被保护的数据，再提供额外的手段保护系统，例如增加一个内存cache队列缓存热点数据\n\n当然在部分场景下，可能也会存在热点数据被重复发现例如在nginx层被发现的热点，那么就看你的系统怎么使用这些热点数据了，你如果也想把他加入现有的cache中，那么就要判断一下，是否已经缓存了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540605542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33910,"user_name":"cici","can_delete":false,"product_type":"c1","uid":1267336,"ip_address":"","ucode":"E0C1F3C85093D3","user_header":"https://static001.geekbang.org/account/avatar/00/13/56/88/7fd0e7d8.jpg","comment_is_top":false,"comment_ctime":1539917203,"is_pvip":false,"replies":[{"id":"12227","content":"这里cache静态数据都是读数据，不会有更新，数据填充是第一次启动时完成<br><br>另外如果是库存这种临时缓存需要用concurrenthashmap","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540094628,"ip_address":"","comment_id":33910,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1539917203","product_id":100017501,"comment_content":"慕-小坏：<br>但是，缓存热点数据更多的是“临时”缓存，即不管是静态数据还是动态数据，都用一个队列短暂地缓存数秒钟，由于队列长度有限，可以采用 LRU 淘汰算法替换。<br>为什么选择用队列来缓存数据呢，队列如何做到快速读取缓存数据的呢？<br>2018-10-08<br> 作者回复<br>不一定非要用队列，也可以用其他内存集合如hashmap都行<br>缓存数据，一般静态数据可以提前加载到内存，如通过配置系统推送的方式。动态数据可以在远程调用时零时缓存在本机中。<br>cici询问：如果使用hashmap不是会存在线程不安全的问题吗？ 特别还是高并发的情况下，还是说只是一个方向，但是方向上需要考虑本场景下所引起的问题。","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427072,"discussion_content":"这里cache静态数据都是读数据，不会有更新，数据填充是第一次启动时完成\n\n另外如果是库存这种临时缓存需要用concurrenthashmap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540094628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1483912,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL4bZibSxNmZ2Ygpib7N4BWYanDZKWdX2epvXmR4G6ryHN9zsG43wUtoXb1ZtF65icTrz4SWdLiclAuicg/132","nickname":"solzs","note":"","ucode":"E8B7569A359235","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562173,"discussion_content":"看下lru的时候是双端链表+map, map可以实现O(1)获取数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649778157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30278,"user_name":"403","can_delete":false,"product_type":"c1","uid":1001867,"ip_address":"","ucode":"D9360256DFEF5D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/8b/3596a3e2.jpg","comment_is_top":false,"comment_ctime":1538753095,"is_pvip":false,"replies":[{"id":"11680","content":"数据打标的方式有很多，例如给数据库表的一个字段标识一下这个商品是否是热点数据","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539496418,"ip_address":"","comment_id":30278,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538753095","product_id":100017501,"comment_content":"数据层给数据打标怎么做和具体应用可以说说么","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425924,"discussion_content":"数据打标的方式有很多，例如给数据库表的一个字段标识一下这个商品是否是热点数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539496418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29785,"user_name":"eason2017","can_delete":false,"product_type":"c1","uid":1009422,"ip_address":"","ucode":"E070BA624FA490","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/0e/c77ad9b1.jpg","comment_is_top":false,"comment_ctime":1538539866,"is_pvip":false,"replies":[{"id":"11690","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497210,"ip_address":"","comment_id":29785,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538539866","product_id":100017501,"comment_content":"赞，学习ing。","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425717,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29742,"user_name":"成都福哥","can_delete":false,"product_type":"c1","uid":1034285,"ip_address":"","ucode":"0D3C2E5FE17E6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c8/2d/3dd499a9.jpg","comment_is_top":false,"comment_ctime":1538528554,"is_pvip":false,"replies":[{"id":"10763","content":"动态发现的热点更多的是实现保护，例如加入cache，或者放到队列中<br><br>隔离理论上也是可以做的，例如把热点数据从普通的数据库自动的迁移到热点数据库中","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538619392,"ip_address":"","comment_id":29742,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538528554","product_id":100017501,"comment_content":"动态发现的热点数据如何隔离？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425700,"discussion_content":"动态发现的热点更多的是实现保护，例如加入cache，或者放到队列中\n\n隔离理论上也是可以做的，例如把热点数据从普通的数据库自动的迁移到热点数据库中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538619392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}