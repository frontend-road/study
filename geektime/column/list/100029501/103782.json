{"id":103782,"title":"08丨什么是SQL的聚集函数，如何利用它们汇总表的数据？","content":"<p>我们上节课讲到了SQL函数，包括算术函数、字符串函数、日期函数和转换函数。实际上SQL函数还有一种，叫做聚集函数，它是对一组数据进行汇总的函数，输入的是一组数据的集合，输出的是单个值。通常我们可以利用聚集函数汇总表的数据，如果稍微复杂一些，我们还需要先对数据做筛选，然后再进行聚集，比如先按照某个条件进行分组，对分组条件进行筛选，然后得到筛选后的分组的汇总信息。</p><p>有关今天的内容，你重点需要掌握以下几个方面：</p><ol>\n<li>聚集函数都有哪些，能否在一条SELECT语句中使用多个聚集函数；</li>\n<li>如何对数据进行分组，并进行聚集统计；</li>\n<li>如何使用HAVING过滤分组，HAVING和WHERE的区别是什么。</li>\n</ol><h2>聚集函数都有哪些</h2><p>SQL中的聚集函数一共包括5个，可以帮我们求某列的最大值、最小值和平均值等，它们分别是：</p><p><img src=\"https://static001.geekbang.org/resource/image/d1/15/d101026459ffa96504ba3ebb85054415.png?wh=776*326\" alt=\"\"></p><p>这些函数你可能已经接触过，我们再来简单复习一遍。我们继续使用heros数据表，对王者荣耀的英雄数据进行聚合。</p><p>如果我们想要查询最大生命值大于6000的英雄数量。</p><pre><code>SQL：SELECT COUNT(*) FROM heros WHERE hp_max &gt; 6000\n</code></pre><p>运行结果为41。</p><p>如果想要查询最大生命值大于6000，且有次要定位的英雄数量，需要使用COUNT函数。</p><pre><code>SQL：SELECT COUNT(role_assist) FROM heros WHERE hp_max &gt; 6000\n</code></pre><p>运行结果是 23。</p><!-- [[[read_end]]] --><p>需要说明的是，有些英雄没有次要定位，即role_assist为NULL，这时<code>COUNT(role_assist)</code>会忽略值为NULL的数据行，而COUNT(*)只是统计数据行数，不管某个字段是否为NULL。</p><p>如果我们想要查询射手（主要定位或者次要定位是射手）的最大生命值的最大值是多少，需要使用MAX函数。</p><pre><code>SQL：SELECT MAX(hp_max) FROM heros WHERE role_main = '射手' or role_assist = '射手'\n</code></pre><p>运行结果为6014。</p><p>你能看到，上面的例子里，都是在一条SELECT语句中使用了一次聚集函数，实际上我们也可以在一条SELECT语句中进行多项聚集函数的查询，比如我们想知道射手（主要定位或者次要定位是射手）的英雄数、平均最大生命值、法力最大值的最大值、攻击最大值的最小值，以及这些英雄总的防御最大值等汇总数据。</p><p>如果想要知道英雄的数量，我们使用的是COUNT(*)函数，求平均值、最大值、最小值，以及总的防御最大值，我们分别使用的是AVG、MAX、MIN和SUM函数。另外我们还需要对英雄的主要定位和次要定位进行筛选，使用的是<code>WHERE role_main = '射手' or role_assist = '射手'</code>。</p><pre><code>SQL: SELECT COUNT(*), AVG(hp_max), MAX(mp_max), MIN(attack_max), SUM(defense_max) FROM heros WHERE role_main = '射手' or role_assist = '射手'\n</code></pre><p>运行结果：</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/9d/b9cbaa2af34e0b1eb74e76b60e7eaf9d.png?wh=1040*114\" alt=\"\"><br>\n需要说明的是AVG、MAX、MIN等聚集函数会自动忽略值为NULL的数据行，MAX和MIN函数也可以用于字符串类型数据的统计，如果是英文字母，则按照A—Z的顺序排列，越往后，数值越大。如果是汉字则按照全拼拼音进行排列。比如：</p><pre><code>SQL：SELECT MIN(CONVERT(name USING gbk)), MAX(CONVERT(name USING gbk)) FROM heros\n</code></pre><p>运行结果：</p><p><img src=\"https://static001.geekbang.org/resource/image/e1/71/e1fa345ebcb78e686d3dd16cb075e871.png?wh=1025*118\" alt=\"\"><br>\n需要说明的是，我们需要先把name字段统一转化为gbk类型，使用<code>CONVERT(name USING gbk)</code>，然后再使用MIN和MAX取最小值和最大值。</p><p>我们也可以对数据行中不同的取值进行聚集，先用DISTINCT函数取不同的数据，然后再使用聚集函数。比如我们想要查询不同的生命最大值的英雄数量是多少。</p><pre><code>SQL: SELECT COUNT(DISTINCT hp_max) FROM heros\n</code></pre><p>运行结果为61。</p><p>实际上在heros这个数据表中，一共有69个英雄数量，生命最大值不一样的英雄数量是61个。</p><p>假如我们想要统计不同生命最大值英雄的平均生命最大值，保留小数点后两位。首先需要取不同生命最大值，即<code>DISTINCT hp_max</code>，然后针对它们取平均值，即<code>AVG(DISTINCT hp_max)</code>，最后再针对这个值保留小数点两位，也就是<code>ROUND(AVG(DISTINCT hp_max), 2)</code>。</p><pre><code>SQL: SELECT ROUND(AVG(DISTINCT hp_max), 2) FROM heros\n</code></pre><p>运行结果为6653.84。</p><p>你能看到，如果我们不使用DISTINCT函数，就是对全部数据进行聚集统计。如果使用了DISTINCT函数，就可以对数值不同的数据进行聚集。一般我们使用MAX和MIN函数统计数据行的时候，不需要再额外使用DISTINCT，因为使用DISTINCT和全部数据行进行最大值、最小值的统计结果是相等的。</p><h2>如何对数据进行分组，并进行聚集统计</h2><p>我们在做统计的时候，可能需要先对数据按照不同的数值进行分组，然后对这些分好的组进行聚集统计。对数据进行分组，需要使用GROUP BY子句。</p><p>比如我们想按照英雄的主要定位进行分组，并统计每组的英雄数量。</p><pre><code>SQL: SELECT COUNT(*), role_main FROM heros GROUP BY role_main\n</code></pre><p>运行结果（6条记录）：</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/9c/6ba58294f85edbb37499d3f28f60719c.png?wh=785*384\" alt=\"\"></p><p>如果我们想要对英雄按照次要定位进行分组，并统计每组英雄的数量。</p><pre><code>SELECT COUNT(*), role_assist FROM heros GROUP BY role_assist\n</code></pre><p>运行结果：（6条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/08/c0/0802ba993844e2875bd6cbbc3d4fa5c0.png?wh=788*377\" alt=\"\"></p><p>你能看出如果字段为NULL，也会被列为一个分组。在这个查询统计中，次要定位为NULL，即只有一个主要定位的英雄是40个。</p><p>我们也可以使用多个字段进行分组，这就相当于把这些字段可能出现的所有的取值情况都进行分组。比如，我们想要按照英雄的主要定位、次要定位进行分组，查看这些英雄的数量，并按照这些分组的英雄数量从高到低进行排序。</p><pre><code>SELECT COUNT(*) as num, role_main, role_assist FROM heros GROUP BY role_main, role_assist ORDER BY num DESC\n</code></pre><p>运行结果：（19条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/35/8f/3504fa2cf288a50eb39028d1768d5c8f.png?wh=605*794\" alt=\"\"></p><h2>如何使用HAVING过滤分组，它与WHERE的区别是什么？</h2><p>当我们创建出很多分组的时候，有时候就需要对分组进行过滤。你可能首先会想到WHERE子句，实际上过滤分组我们使用的是HAVING。HAVING的作用和WHERE一样，都是起到过滤的作用，只不过WHERE是用于数据行，而HAVING则作用于分组。</p><p>比如我们想要按照英雄的主要定位、次要定位进行分组，并且筛选分组中英雄数量大于5的组，最后按照分组中的英雄数量从高到低进行排序。</p><p>首先我们需要获取的是英雄的数量、主要定位和次要定位，即<code>SELECT COUNT(*) as num, role_main, role_assist</code>。然后按照英雄的主要定位和次要定位进行分组，即<code>GROUP BY role_main, role_assist</code>，同时我们要对分组中的英雄数量进行筛选，选择大于5的分组，即<code>HAVING num &gt; 5</code>，然后按照英雄数量从高到低进行排序，即<code>ORDER BY num DESC</code>。</p><pre><code>SQL: SELECT COUNT(*) as num, role_main, role_assist FROM heros GROUP BY role_main, role_assist HAVING num &gt; 5 ORDER BY num DESC\n</code></pre><p>运行结果：（4条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/ca/61/ca9747ad58e8cf637fe352fb0cfd5761.png?wh=806*279\" alt=\"\"><br>\n你能看到还是上面这个分组，只不过我们按照数量进行了过滤，筛选了数量大于5的分组进行输出。如果把HAVING替换成了WHERE，SQL则会报错。对于分组的筛选，我们一定要用HAVING，而不是WHERE。另外你需要知道的是，HAVING支持所有WHERE的操作，因此所有需要WHERE子句实现的功能，你都可以使用HAVING对分组进行筛选。</p><p>我们再来看个例子，通过这个例子查看一下WHERE和HAVING进行条件过滤的区别。筛选最大生命值大于6000的英雄，按照主要定位、次要定位进行分组，并且显示分组中英雄数量大于5的分组，按照数量从高到低进行排序。</p><pre><code>SQL: SELECT COUNT(*) as num, role_main, role_assist FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main, role_assist HAVING num &gt; 5 ORDER BY num DESC\n</code></pre><p>运行结果：（2条记录）</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/3a/7b62b2a12ec9e66675b3da8b5b54093a.png?wh=805*173\" alt=\"\"></p><p>你能看到，还是针对上一个例子的查询，只是我们先增加了一个过滤条件，即筛选最大生命值大于6000的英雄。这里我们就需要先使用WHERE子句对最大生命值大于6000的英雄进行条件过滤，然后再使用GROUP BY进行分组，使用HAVING进行分组的条件判断，然后使用ORDER BY进行排序。</p><h2>总结</h2><p>今天我对SQL的聚集函数进行了讲解。通常我们还会对数据先进行分组，然后再使用聚集函数统计不同组的数据概况，比如数据行数、平均值、最大值、最小值以及求和等。我们也可以使用HAVING对分组进行过滤，然后通过ORDER BY按照某个字段的顺序进行排序输出。有时候你能看到在一条SELECT语句中，可能会包括多个子句，用WHERE进行数据量的过滤，用GROUP BY进行分组，用HAVING进行分组过滤，用ORDER BY进行排序……</p><p><strong>你要记住，在SELECT查询中，关键字的顺序是不能颠倒的，它们的顺序是：</strong></p><pre><code>SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...\n</code></pre><p>另外需要注意的是，使用GROUP BY进行分组，如果想让输出的结果有序，可以在GROUP BY后使用ORDER BY。因为GROUP BY只起到了分组的作用，排序还是需要通过ORDER BY来完成。</p><p><img src=\"\" alt=\"\"></p><p>我今天对SQL的聚集函数以及SQL查询中的关键字顺序进行了讲解，但你还是需要通过训练加深理解，基于heros数据表，请你写出下面2个SQL查询语句：</p><ol>\n<li>筛选最大生命值大于6000的英雄，按照主要定位进行分组，选择分组英雄数量大于5的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。</li>\n<li>筛选最大生命值与最大法力值之和大于7000的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。</li>\n</ol><p>欢迎你在评论区与我分享你的答案，如果你觉得这篇文章有帮助，欢迎把它分享给你的朋友或者同事，一起切磋交流一下。</p>","comments":[{"had_liked":false,"id":110208,"user_name":"grey927","can_delete":false,"product_type":"c1","uid":1202782,"ip_address":"","ucode":"833E02ED835B4A","user_header":"https://static001.geekbang.org/account/avatar/00/12/5a/5e/a897cb0d.jpg","comment_is_top":false,"comment_ctime":1562208125,"is_pvip":false,"replies":[{"id":"39984","content":"这是个好问题，ORDER BY就是对记录进行排序。如果你在前面用到了GROUP BY，实际上是一种分组的聚合方式，已经把一组的数据聚合成为了一条记录，所以再进行排序的时候，也相当于是对分的组进行排序。","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1562210499,"ip_address":"","comment_id":110208,"utype":1}],"discussion_count":2,"race_medal":0,"score":"302209918845","product_id":100029501,"comment_content":"ORDER BY 是对分的组排序还是对分组中的记录排序呢？","like_count":71,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456776,"discussion_content":"这是个好问题，ORDER BY就是对记录进行排序。如果你在前面用到了GROUP BY，实际上是一种分组的聚合方式，已经把一组的数据聚合成为了一条记录，所以再进行排序的时候，也相当于是对分的组进行排序。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562210499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073136,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/f0/a73607b3.jpg","nickname":"victor666","note":"","ucode":"20C9BE10E07D55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211579,"discussion_content":"order by是在select过滤之后 为什么排序字段可以设置和select不同的字段啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584867215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108153,"user_name":"不负","can_delete":false,"product_type":"c1","uid":1238323,"ip_address":"","ucode":"147F5860711811","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/33/ff5c52ad.jpg","comment_is_top":false,"comment_ctime":1561687338,"is_pvip":true,"replies":[{"id":"39188","content":"在执行顺序上，SELECT字段在GROUP BY和HAVING之后，不过在SELECT字段之前，已经计算了聚集函数，也就是COUNT(*) as num。聚集函数的计算在GROUP BY之后，HAVING之前","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561691880,"ip_address":"","comment_id":108153,"utype":1}],"discussion_count":4,"race_medal":1,"score":"190540248362","product_id":100029501,"comment_content":"一个发现：虽然 SELECT 的执行顺序在 GROUP BY 和 HAVING 后面，但对于SELECT中列的别名都可以使用。<br>MySQL中<br>1. &gt; SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros<br>    -&gt; WHERE hp_max&gt;6000<br>    -&gt; GROUP BY role_main<br>    -&gt; HAVING COUNT(*)&gt;5<br>    -&gt; ORDER BY COUNT(*) DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br>2. &gt; SELECT COUNT(*) num, ROUND(AVG(hp_max+mp_max), 2) avg, ROUND(MAX(hp_max+mp_max), 2) max, ROUND(MIN(hp_max+mp_max), 2) min FROM heros<br>    -&gt; WHERE (hp_max+mp_max)&gt;7000<br>    -&gt; GROUP BY attack_range<br>    -&gt; ORDER BY num DESC;<br>+-----+---------+----------+---------+<br>| num | avg     | max      | min     |<br>+-----+---------+----------+---------+<br>|  36 | 8654.42 | 11036.00 | 7117.00 |<br>|  26 | 7743.77 |  8737.00 | 7025.00 |<br>+-----+---------+----------+---------+<br>","like_count":44,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455844,"discussion_content":"在执行顺序上，SELECT字段在GROUP BY和HAVING之后，不过在SELECT字段之前，已经计算了聚集函数，也就是COUNT(*) as num。聚集函数的计算在GROUP BY之后，HAVING之前","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561691880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2962599,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","nickname":"年少挽滑稽世无双","note":"","ucode":"793DCBDE25A07B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586682,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662433867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"四川"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812646,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a8/a6/825879a0.jpg","nickname":"思密达","note":"","ucode":"82FF8EE9A37461","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350464,"discussion_content":"不过怎么讲，这种写法容易误解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613884153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1535217,"avatar":"https://static001.geekbang.org/account/avatar/00/17/6c/f1/9ab33f89.jpg","nickname":"Geek_Song","note":"","ucode":"DCC90A6683D024","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":280304,"discussion_content":"普通列的别名在having子句中也可以使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591525088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108081,"user_name":"ack","can_delete":false,"product_type":"c1","uid":1440912,"ip_address":"","ucode":"69CA1233EEA8E2","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","comment_is_top":false,"comment_ctime":1561680759,"is_pvip":false,"replies":[{"id":"39158","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561685347,"ip_address":"","comment_id":108081,"utype":1}],"discussion_count":3,"race_medal":0,"score":"87461026679","product_id":100029501,"comment_content":"练习题<br>1.SELECT COUNT(*) AS num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC; <br>2.SELECT COUNT(*) AS num,ROUND(MAX(hp_max+mp_max),2),ROUND(AVG(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE hp_max+mp_max &gt; 7000 GROUP BY attack_range ORDER BY num DESC;","like_count":20,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455817,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561685347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274680,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/38/7ef1bd5d.jpg","nickname":"Victor.","note":"","ucode":"E841D981ABEE09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46512,"discussion_content":"分组英雄的最大生命值与法力值之和的平均值、最大值和最小值 （最大值跟最小值不需要Round，跟avg函数的，应该是这样写吧：SELECT count(*) as num,ROUND(AVG(hp_max+mp_max),2),max(hp_max+mp_max),MIN(hp_max+mp_max)FROM heros WHERE (hp_max + mp_max) >7000 GROUP BY attack_range ORDER BY num desc","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573176877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1880782,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","nickname":"Flychen","note":"","ucode":"4029A8F1D3C361","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343160,"discussion_content":"order  by  后面竟然可以直接用字段的别名，涨姿势了，记得 Oracle 不行的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610960305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149021,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1573128261,"is_pvip":false,"replies":[{"id":"62676","content":"哈哈","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577082862,"ip_address":"","comment_id":149021,"utype":1}],"discussion_count":1,"race_medal":0,"score":"74587572293","product_id":100029501,"comment_content":"讲个段子   having  常用来做过滤掉那些跑来冒充程序员的人。<br>他们深深的震惊了我的认知。","like_count":17,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473711,"discussion_content":"哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577082862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108185,"user_name":"吃饭饭","can_delete":false,"product_type":"c1","uid":1231549,"ip_address":"","ucode":"95CFA07CDA2957","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","comment_is_top":false,"comment_ctime":1561691851,"is_pvip":false,"replies":[{"id":"39206","content":"谢谢！","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561694071,"ip_address":"","comment_id":108185,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44511364811","product_id":100029501,"comment_content":"讲的很详细了，入门必备","like_count":10,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455862,"discussion_content":"谢谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561694071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108079,"user_name":"安静的boy","can_delete":false,"product_type":"c1","uid":1196475,"ip_address":"","ucode":"F5F44B75228A85","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/bb/21ce60d2.jpg","comment_is_top":false,"comment_ctime":1561680612,"is_pvip":false,"replies":[{"id":"39160","content":"理解了HAVING和WHERE的区别，就了解了分组过滤和条件过滤。还有SELECT语句种的关键字的顺序：SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561685458,"ip_address":"","comment_id":108079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35921418980","product_id":100029501,"comment_content":"where先对数据进行排序，group by再进行分组。让我对数据筛选和分组恍然大悟！","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455815,"discussion_content":"理解了HAVING和WHERE的区别，就了解了分组过滤和条件过滤。还有SELECT语句种的关键字的顺序：SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561685458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130027,"user_name":"峻铭","can_delete":false,"product_type":"c1","uid":1106202,"ip_address":"","ucode":"63AB23BADACA88","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/1a/20977779.jpg","comment_is_top":false,"comment_ctime":1567353574,"is_pvip":false,"replies":[{"id":"62794","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092905,"ip_address":"","comment_id":130027,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31632124646","product_id":100029501,"comment_content":"前面老师在评论中回复过，在group by分组和having筛选分组之间还有一步使用聚集函数进行计算，在目前看到的having都是对cout聚集函数结果的筛选，想试试对其他聚集函数的筛选，然后对训练1做了点小改动：<br>select count(*) as c,role_main,avg(hp_max) as v  from heros where hp_max &gt; 6000 GROUP BY role_main HAVING c &gt; 5 and v &gt; 7000 order by c DESC;","like_count":7,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465770,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200243,"user_name":"Cookie123456","can_delete":false,"product_type":"c1","uid":1913261,"ip_address":"","ucode":"F9EF63C38F8976","user_header":"","comment_is_top":false,"comment_ctime":1585562073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27355365849","product_id":100029501,"comment_content":"第二个问题的答案刚开始写错了，where后面条件写成了sum（hp_max + mp_max ）&gt;7000,执行出错了，此时衍生了一个问题，where后面不可以写聚合函数，也就意味着having的诞生，其次SQL语句的执行顺序也表明，where后面是不可以后聚合函数的<br>SELECT<br>\t\tCOUNT( * ) AS num,<br>\t\tROUND( avg( hp_max + mp_max ),2 ),<br>\t\tROUND( max( hp_max + mp_max ), 2 ),<br>\t\tROUND( max( hp_max + mp_max ), 2 ) <br>\tFROM<br>\t\theros <br>\tWHERE<br>\t\thp_max + mp_max &gt; 7000 <br>\tGROUP BY<br>\t\tattack_range<br>\tORDER BY<br>\tnum DESC","like_count":6},{"had_liked":false,"id":124998,"user_name":"bear","can_delete":false,"product_type":"c1","uid":1168164,"ip_address":"","ucode":"EADC2BB6075EEC","user_header":"https://static001.geekbang.org/account/avatar/00/11/d3/24/58c0a3dd.jpg","comment_is_top":false,"comment_ctime":1566038695,"is_pvip":false,"replies":[{"id":"47672","content":"感谢","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1566901491,"ip_address":"","comment_id":124998,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23040875175","product_id":100029501,"comment_content":"Having 部分精彩，赞👍","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463395,"discussion_content":"感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566901491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108142,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1561686619,"is_pvip":false,"replies":[{"id":"39181","content":"您好，文章已进行更正，谢谢您的反馈。","user_name":"编辑回复","user_name_real":"何昌梅","uid":"1165037","ctime":1561688731,"ip_address":"","comment_id":108142,"utype":2}],"discussion_count":1,"race_medal":0,"score":"23036523099","product_id":100029501,"comment_content":"有个错误：<br>文中“比如，我们想要按照英雄的主要定位、次要定位进行分组，查看这些英雄的数量，并按照这些分组的英雄数量从高到低进行排序。”的SQL语句：SQL: SELECT COUNT(*), role_main, role_assist FROM heros GROUP BY role_main, role_assist ORDER BY num DESC<br><br>在MySQL里会报错：[Err] 1054 - Unknown column &#39;num&#39; in &#39;order clause&#39;<br><br>要改为：SELECT COUNT(*) as num, role_main, role_assist FROM heros GROUP BY role_main, role_assist ORDER BY num DESC;","like_count":5,"discussions":[{"author":{"id":1165037,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c6/ed/89a2dc13.jpg","nickname":"丢了个丢丢丢","note":"","ucode":"BDD7E97E0E5E96","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455840,"discussion_content":"您好，文章已进行更正，谢谢您的反馈。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561688731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108176,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1561691137,"is_pvip":false,"replies":[{"id":"39215","content":"SQL正确，最后结果贴的不太完整","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561700189,"ip_address":"","comment_id":108176,"utype":1}],"discussion_count":4,"race_medal":0,"score":"14446593025","product_id":100029501,"comment_content":"&#47;*<br>1.筛选最大生命值大于6000的英雄，按照主要定位进行分组，选择分组英雄数量大于5的分组，<br>按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>*&#47;<br>SELECT count(*) as num, role_main, AVG(hp_max)<br>FROM heros <br>WHERE hp_max &gt; 6000 <br>GROUP BY role_main <br>HAVING num &gt; 5 <br>ORDER BY num DESC <br><br>num role_main AVG(hp_max)<br>------------------------------------<br>17\t战士\t7028<br>10\t坦克\t8312.4<br>6\t法师\t6417<br><br>&#47;*<br>2.筛选最大生命值与最大法力值之和大于7000的英雄，按照攻击范围来进行分组，<br>显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，<br>并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>*&#47;<br>SELECT count(*) as num, ROUND(AVG(hp_max + mp_max), 2), MAX(hp_max + mp_max), MIN(hp_max + mp_max)<br>FROM heros <br>WHERE hp_max + mp_max &gt; 7000 <br>GROUP BY attack_range<br>HAVING num &gt; 5 <br>ORDER BY num DESC <br><br>num, ROUND(AVG(hp_max + mp_max), 2), MAX(hp_max + mp_max), MIN(hp_max + mp_max)<br>------------------------------------------------------------------------<br>62\t8272.53\t11036\t7025","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455858,"discussion_content":"SQL正确，最后结果贴的不太完整","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561700189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1208807,"avatar":"","nickname":"zcyghzy","note":"","ucode":"2B02EB5943B502","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":702,"discussion_content":"第二题没有要求要求对mun>5这个筛选吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561970428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1208807,"avatar":"","nickname":"zcyghzy","note":"","ucode":"2B02EB5943B502","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5924,"discussion_content":"是的 没要求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566538865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":702,"ip_address":""},"score":5924,"extra":""}]},{"author":{"id":1051663,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","nickname":"mickey","note":"","ucode":"8B490C2DDE4010","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559,"discussion_content":"哪里不完整？不是四个值吗？62     8272.53     11036     7025","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561706453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108157,"user_name":"Taozi","can_delete":false,"product_type":"c1","uid":1021926,"ip_address":"","ucode":"DD6567A31B3E33","user_header":"","comment_is_top":false,"comment_ctime":1561688134,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14446590022","product_id":100029501,"comment_content":"练习2中反复出现的hp_max+mp_max可以绑定到一个变量吗？","like_count":3,"discussions":[{"author":{"id":2882440,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/fb/88/00cb17bf.jpg","nickname":"潜龙","note":"","ucode":"5B77E245591D7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543587,"discussion_content":"我觉得可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641214748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172090,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","nickname":"蓦然回首","note":"","ucode":"B17658DCFE6402","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348047,"discussion_content":"SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max as t), 2), ROUND(MAX(t), 2), ROUND(MIN(t), 2)\nFROM heros\nWHERE t > 7000\nGROUP BY attack_range\nORDER BY num DESC;\n\n实验了一下，直接这样取别名，直接报错了，哈哈！\n[SQL] SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max as t), 2), ROUND(MAX(t), 2), ROUND(MIN(t), 2)\nFROM heros\nWHERE t > 7000\nGROUP BY attack_range\nORDER BY num DESC;\n[Err] 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;as t), 2), ROUND(MAX(t), 2), ROUND(MIN(t), 2)\nFROM heros\nWHERE t > 7000\nGROUP&#39; at line 1\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612413049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108147,"user_name":"圆子蛋","can_delete":false,"product_type":"c1","uid":1585794,"ip_address":"","ucode":"9E8FE5D4DAC79E","user_header":"https://static001.geekbang.org/account/avatar/00/18/32/82/273a44cd.jpg","comment_is_top":false,"comment_ctime":1561686844,"is_pvip":false,"replies":[{"id":"39189","content":"COUNT(*)后面应该有 as num","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561691899,"ip_address":"","comment_id":108147,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14446588732","product_id":100029501,"comment_content":"1.SELECT COUNT(*) as num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC; <br>2.SELECT COUNT(*) as num,ROUND(MAX(hp_max+mp_max),2),ROUND(AVG(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;<br>老师在“如何对数据进行分组，并进行聚集统计”的第三个例子里，COUNT(*) 后面没有加 as num，但是 ORDER BY 里直接出现了 num？","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455843,"discussion_content":"COUNT(*)后面应该有 as num","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561691899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279349,"user_name":"啵啵","can_delete":false,"product_type":"c1","uid":1118843,"ip_address":"","ucode":"627A3E72DBFF79","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/7b/5da66a2f.jpg","comment_is_top":false,"comment_ctime":1613726843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10203661435","product_id":100029501,"comment_content":"建议将WHERE和HAVING的区别描述更加详细一些，甚至可以增加一些示例，方便理解。<br>1、WHERE针对的是表或视图，WHERE判断的字段可以是表或视图中任意一个字段，不能使用函数运算如MAX(`hp_max`) &gt; 100等。<br>2、HAVING针对的是分组，HAVING判断的字段只能是分组的列。例如SELECT `hp_max` FROM `heros` GROUP BY `role_assist` HAVING MAX(`mp_max`) &gt; 100; 就是错误的，因为分组列中不包含`mp_max`。HAVING是可以使用函数运算的，例如SELECT `hp_max` FROM `heros` GROUP BY `role_assist` HAVING MAX(`hp_max`) &gt; 100; 就是对的。","like_count":2},{"had_liked":false,"id":108439,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1561773247,"is_pvip":false,"replies":[{"id":"39293","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561794641,"ip_address":"","comment_id":108439,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10151707839","product_id":100029501,"comment_content":"思考题 1：<br>SELECT <br>    COUNT(*) AS num, role_main, AVG(hp_max)<br>FROM<br>    heros<br>WHERE<br>    hp_max &gt; 6000<br>GROUP BY role_main<br>HAVING num &gt; 5<br>ORDER BY num DESC;<br>思考题 2：<br>SELECT <br>    COUNT(*) AS num,<br>    attack_range,<br>    ROUND(AVG(hp_max + mp_max), 2),<br>    ROUND(MAX(hp_max + mp_max), 2),<br>    ROUND(MIN(hp_max + mp_max), 2)<br>FROM<br>    heros<br>WHERE<br>    hp_max + mp_max &gt; 7000<br>GROUP BY attack_range<br>ORDER BY num DESC;","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455976,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561794641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108192,"user_name":"太精","can_delete":false,"product_type":"c1","uid":1419939,"ip_address":"","ucode":"7B0F1B090ECF0F","user_header":"https://static001.geekbang.org/account/avatar/00/15/aa/a3/0b7f0334.jpg","comment_is_top":false,"comment_ctime":1561693256,"is_pvip":false,"replies":[{"id":"39213","content":"正确 不过COUNT(*)就不需要用ROUND了","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561700097,"ip_address":"","comment_id":108192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10151627848","product_id":100029501,"comment_content":"SELECT COUNT(*) AS num, role_main, AVG(hp_max)  AS avg_max FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br>SELECT ROUND((COUNT(*)),2) AS num, ROUND((AVG(hp_max+mp_max)),2) AS heros_avg, ROUND((MAX(hp_max+mp_max)),2) AS max_avg, ROUND((MIN(hp_max+mp_max)),2) AS min_avg FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num desc;<br>","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455865,"discussion_content":"正确 不过COUNT(*)就不需要用ROUND了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561700097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280649,"user_name":"Geek_157522","can_delete":false,"product_type":"c1","uid":1989454,"ip_address":"","ucode":"B10B4A4226C66A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIZpAiabrHDmPye39vFLPibWtlkcEVlOeufJ14uYACPamfZh0urvsumJvkalFUkDodqTescgj4j7tw/132","comment_is_top":false,"comment_ctime":1614305252,"is_pvip":false,"replies":[{"id":"102013","content":"第一个正确。<br>第二个的 attack_max 改成 attack_range 可以运行成功。","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1614521178,"ip_address":"","comment_id":280649,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5909272548","product_id":100029501,"comment_content":"筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT COUNT(*) as num, role_main, AVG(hp_max)FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5  ORDER BY  num DESC<br>筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max),2)，ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2)FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_max  ORDER BY  num DESC<br><br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516164,"discussion_content":"第一个正确。\n第二个的 attack_max 改成 attack_range 可以运行成功。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614521178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359343,"user_name":"nature","can_delete":false,"product_type":"c1","uid":1235319,"ip_address":"北京","ucode":"A583DFD4F80EA6","user_header":"","comment_is_top":false,"comment_ctime":1665458846,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1665458846","product_id":100029501,"comment_content":"陈老师您好，请问有关于Sum if Count if的相关讲解吗？","like_count":0},{"had_liked":false,"id":357730,"user_name":"lgy","can_delete":false,"product_type":"c1","uid":1902819,"ip_address":"广东","ucode":"4F3997E5C259FF","user_header":"https://static001.geekbang.org/account/avatar/00/1d/08/e3/77b9a85e.jpg","comment_is_top":false,"comment_ctime":1663584957,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663584957","product_id":100029501,"comment_content":"<br>SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC","like_count":0},{"had_liked":false,"id":356577,"user_name":"年少挽滑稽世无双","can_delete":false,"product_type":"c1","uid":2962599,"ip_address":"四川","ucode":"793DCBDE25A07B","user_header":"https://static001.geekbang.org/account/avatar/00/2d/34/a7/52c4ea60.jpg","comment_is_top":false,"comment_ctime":1662434174,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662434174","product_id":100029501,"comment_content":"# 筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT COUNT(*) AS num, role_main, AVG(hp_max)<br>FROM heros WHERE hp_max &gt; 6000<br>GROUP BY role_main HAVING num &gt; 5<br>ORDER BY num DESC<br><br># 筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT COUNT(*) AS num, ROUND(AVG(hp_max + mp_max),2), ROUND(MAX(hp_max + mp_max),2), ROUND(MIN(hp_max + mp_max),2)<br>FROM heros WHERE (hp_max + mp_max) &gt; 7000<br>GROUP BY attack_range<br>ORDER BY num DESC","like_count":0},{"had_liked":false,"id":329304,"user_name":"刘元元","can_delete":false,"product_type":"c1","uid":1986190,"ip_address":"","ucode":"6BC89AD9D9221D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqGvcr3Yv6BWXnLZn0nkVG24nvEuRkwEtzBia1j36NXPrzHe0IspvsY6rsNEELbUMeOlFTkvWmXakA/132","comment_is_top":false,"comment_ctime":1641280611,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641280611","product_id":100029501,"comment_content":"对第二题的回答（DBMS：ORACLE）：<br><br>SELECT <br>\tATTACK_RANGE,<br>\tCOUNT(1) num, <br>\tROUND(AVG(HP_MAX + MP_MAX),2) avg_hm_max,<br>\tMAX(HP_MAX + MP_MAX) mx_hm_max,<br>\tMIN(HP_MAX + MP_MAX) mi_hm_max <br>FROM HEROS <br>WHERE <br>\t(HP_MAX + MP_MAX) &gt; 7000 <br>GROUP BY ATTACK_RANGE <br>ORDER BY num DESC;<br><br>查询结果：<br>ATTACK_RANGE  |  NUM |  AVG_HM_MAX  |  MX_HM_MAX  |  MI_HM_MAX<br>        近战\t              36\t    8654.42\t    11036\t              7117<br>        远程\t              26\t    7743.77\t             8737\t             7025","like_count":0},{"had_liked":false,"id":317878,"user_name":"｀ㄚαンξι","can_delete":false,"product_type":"c1","uid":2086571,"ip_address":"","ucode":"6DD34AF352F8D5","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d6/ab/cad4830c.jpg","comment_is_top":false,"comment_ctime":1635002045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635002045","product_id":100029501,"comment_content":"“另外你需要知道的是，HAVING 支持所有 WHERE 的操作，因此所有需要 WHERE 子句实现的功能，你都可以使用 HAVING 对分组进行筛选。”这句话怎么理解呢？","like_count":0},{"had_liked":false,"id":310635,"user_name":"Soul of the Dragon","can_delete":false,"product_type":"c1","uid":2438011,"ip_address":"","ucode":"21603099E51B8A","user_header":"https://static001.geekbang.org/account/avatar/00/25/33/7b/9e012181.jpg","comment_is_top":false,"comment_ctime":1630812356,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630812356","product_id":100029501,"comment_content":"练习1：SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC<br>练习2：SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max), 2), ROUND(MAX(hp_max+mp_max),2), (MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC","like_count":0},{"had_liked":false,"id":301474,"user_name":"Cy23","can_delete":false,"product_type":"c1","uid":1591293,"ip_address":"","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1625711018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625711018","product_id":100029501,"comment_content":"SELECT COUNT(*) as num, role_main, hp_max FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br><br>SELECT COUNT(*) as num, ROUND(AVG(hp_max + mp_max), 2), ROUND(MAX(hp_max + mp_max), 2), ROUND(MIN(hp_max + mp_max), 2) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;<br><br>","like_count":0},{"had_liked":false,"id":301391,"user_name":"罗","can_delete":false,"product_type":"c1","uid":2682153,"ip_address":"","ucode":"1FE714B9903109","user_header":"https://static001.geekbang.org/account/avatar/00/28/ed/29/33623ca0.jpg","comment_is_top":false,"comment_ctime":1625658877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625658877","product_id":100029501,"comment_content":"SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br><br>SELECT COUNT(*) as num, ROUND(AVG(mp_max + hp_max),2), ROUND(MAX(mp_max + hp_max), 2), ROUND(MIN(mp_max + hp_max), 2) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range HAVING num &gt; 5 ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":296718,"user_name":"郁方林","can_delete":false,"product_type":"c1","uid":1130275,"ip_address":"","ucode":"8ABEAFDA815DDE","user_header":"https://static001.geekbang.org/account/avatar/00/11/3f/23/8ff389d2.jpg","comment_is_top":false,"comment_ctime":1623129145,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623129145","product_id":100029501,"comment_content":"-- 筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT count(*) num, role_main, AVG(hp_max) FROM heros GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC<br><br>-- 筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT count(*) num, ROUND(AVG(hp_max + mp_max),2), MAX(hp_max), MAX(mp_max) FROM heros WHERE (hp_max + mp_max) &gt; 7000  GROUP BY attack_range ORDER BY num DESC","like_count":0},{"had_liked":false,"id":296278,"user_name":"ss","can_delete":false,"product_type":"c1","uid":1073156,"ip_address":"","ucode":"C1926C165FB8C5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibj1G9GJGMXkNAia83ESAqbCTgcIA5UyqUJN27yvXhAgpIeL9UyEkwY1jwsQlnqcv4iasoLdZkBbeA/132","comment_is_top":false,"comment_ctime":1622877584,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622877584","product_id":100029501,"comment_content":"交作业：<br>SELECT COUNT(*) as num, role_main, avg(hp_max) FROM heros where hp_max&gt;6000 GROUP BY role_main having num&gt;5 order BY num desc;<br><br>SELECT count(*) as num, round(avg(hp_max+mp_max),2), round( max(hp_max+mp_max),2),  round(min(hp_max+mp_max),2) from heros where hp_max+mp_max&gt;7000 group by attack_range order BY num desc;<br>","like_count":0},{"had_liked":false,"id":295838,"user_name":"张静","can_delete":false,"product_type":"c1","uid":2640790,"ip_address":"","ucode":"C3586FA4E0FD4A","user_header":"","comment_is_top":false,"comment_ctime":1622616535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622616535","product_id":100029501,"comment_content":"#练习1<br>SELECT role_main,COUNT(*) as heronum,AVG(hp_max)<br>FROM heros<br>WHERE hp_max &gt;=6000<br>GROUP BY role_main<br>HAVING heronum &gt;=5<br>ORDER BY heroum DESC<br>#练习2<br>SELECT COUNT(*) AS heronum,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2)<br>FROM heros<br>WHERE hp_max+mp_max&gt;=7000<br>GROUP BY attack_range<br>ORDER BY heronum DESC","like_count":0},{"had_liked":false,"id":294186,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1621822571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621822571","product_id":100029501,"comment_content":"mysql&gt; SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max),2), ROUND(MIN(hp_max+mp_max),2), ROUND(MAX(hp_max+mp_max),2) FROM heros<br>    -&gt; WHERE (hp_max+mp_max)&gt;7000<br>    -&gt; GROUP BY attack_range<br>    -&gt; ORDER BY num DESC;<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>| num | ROUND(AVG(hp_max+mp_max),2) | ROUND(MIN(hp_max+mp_max),2) | ROUND(MAX(hp_max+mp_max),2) |<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>|  36 |                     8654.42 |                        7117 |                       11036 |<br>|  26 |                     7743.77 |                        7025 |                        8737 |<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>2 rows in set (0.00 sec)","like_count":0},{"had_liked":false,"id":293027,"user_name":"今日安否？","can_delete":false,"product_type":"c1","uid":2620207,"ip_address":"","ucode":"9349CC7E8F386E","user_header":"https://static001.geekbang.org/account/avatar/00/27/fb/2f/57862772.jpg","comment_is_top":false,"comment_ctime":1621160183,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621160183","product_id":100029501,"comment_content":"音频读的太快了，都不带喘气的，尤其是有代码的时候，直接跳过，跟着音频根本看不过来","like_count":0},{"had_liked":false,"id":289505,"user_name":"刘鹏","can_delete":false,"product_type":"c1","uid":2064117,"ip_address":"","ucode":"518507D9F2EF58","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/lQAcCTVoe0L9qKjwibB4U60TX2oibPic2mye29IT1mrkMvadBtDme1mcxic9rQSF48YUAOicJ5fdE2cfJahJyAz5HwQ/132","comment_is_top":false,"comment_ctime":1619057185,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619057185","product_id":100029501,"comment_content":"group by那一段里，为什么group by role_assist时会显示NULL组，而group by role_main,role_assist时，role_assist列为NULL的组不显示出NULL来呢","like_count":0},{"had_liked":false,"id":286723,"user_name":"蓝色蓓蕾帽","can_delete":false,"product_type":"c1","uid":1016822,"ip_address":"","ucode":"8C28E204DE298D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/f6/a1e7403a.jpg","comment_is_top":false,"comment_ctime":1617526801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617526801","product_id":100029501,"comment_content":"select count(role_main) as num, role_main, avg(hp_max) from heros where hp_max &gt; 6000 group by role_main having num &gt; 5 order by num desc;","like_count":0},{"had_liked":false,"id":283011,"user_name":"LQL","can_delete":false,"product_type":"c1","uid":2429115,"ip_address":"","ucode":"D4169E670369A5","user_header":"https://static001.geekbang.org/account/avatar/00/25/10/bb/5d3e72ed.jpg","comment_is_top":false,"comment_ctime":1615517414,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1615517414","product_id":100029501,"comment_content":"我想要表的清单，导入SQL","like_count":0,"discussions":[{"author":{"id":2625248,"avatar":"https://static001.geekbang.org/account/avatar/00/28/0e/e0/5c64b9c4.jpg","nickname":"刘某刘","note":"","ucode":"99348284AA4373","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378784,"discussion_content":"第一章有github的地址立马有对应的建表sql语句","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623400638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282403,"user_name":"鱼夕子","can_delete":false,"product_type":"c1","uid":1747628,"ip_address":"","ucode":"8DC691FF867A60","user_header":"https://static001.geekbang.org/account/avatar/00/1a/aa/ac/77294bc1.jpg","comment_is_top":false,"comment_ctime":1615215663,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1615215663","product_id":100029501,"comment_content":"前面课程j讲的执行顺序如下：<br>执行顺序：<br>SELECT DISTINCT player_id, player_name, count(*) as num #顺序5<br>FROM player JOIN team ON player.team_id = team.team_id #顺序1<br>WHERE height &gt; 1.80 #顺序2<br>GROUP BY player.team_id #顺序3<br>HAVING num &gt; 2 #顺序4<br>ORDER BY num DESC #顺序6<br>LIMIT 2 #顺序7<br><br>对顺序4和顺序5在本节课有点疑问，如果是HAVING先执行，SELECT COUNT(*) as num后执行，如何能在顺序5执行前，顺序4能提前获取值顺序5num的值?<br>SQL: SELECT COUNT(*) as num, role_main, role_assist <br>FROM heros <br>GROUP BY role_main, role_assist <br>HAVING num &gt; 5 <br>ORDER BY num DESC","like_count":0},{"had_liked":false,"id":277441,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612413782,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612413782","product_id":100029501,"comment_content":"mysql&gt; SELECT name, role_main FROM heros GROUP BY role_main;<br>+--------+-----------+<br>| name   | role_main |<br>+--------+-----------+<br>| 夏侯惇 | 坦克      |<br>| 钟无艳 | 战士      |<br>| 芈月   | 法师      |<br>| 庄周   | 辅助      |<br>| 后羿   | 射手      |<br>| 橘石京 | 刺客      |<br>+--------+-----------+<br>6 rows in set<br>","like_count":0},{"had_liked":false,"id":277438,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612412551,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612412551","product_id":100029501,"comment_content":"老师，看到留言中这样的SQL语句：<br>SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros<br>    -&gt; WHERE hp_max&gt;6000<br>    -&gt; GROUP BY role_main<br>    -&gt; HAVING COUNT(*)&gt;5<br>    -&gt; ORDER BY COUNT(*) DESC;<br>请教一下，这里，COUNT(*)会被多次计算吗？还是说DBMS会经过优化，只计算一次？","like_count":0},{"had_liked":false,"id":277437,"user_name":"蓦然回首","can_delete":false,"product_type":"c1","uid":1172090,"ip_address":"","ucode":"B17658DCFE6402","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/7a/38a27e47.jpg","comment_is_top":false,"comment_ctime":1612412238,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612412238","product_id":100029501,"comment_content":"因为GROUP BY 最终一个分组只能显示一条记录，如果是想要把相同的字段的所有数据行显示在一起，用GROUP BY是达不到效果的，用ORDER BY 可以达到目的，实际上是排序了，但效果上是分组了！","like_count":0},{"had_liked":false,"id":275502,"user_name":"皓昊","can_delete":false,"product_type":"c1","uid":2288986,"ip_address":"","ucode":"8CCCF3700DAC3E","user_header":"https://static001.geekbang.org/account/avatar/00/22/ed/5a/a7687583.jpg","comment_is_top":false,"comment_ctime":1611565189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611565189","product_id":100029501,"comment_content":"select attack_range ,count(*) as num,<br>avg(distinct(hp_max+mp_max)),<br>max(hp_max+mp_max),<br>min(hp_max+mp_max)<br>from heros <br>where hp_max+mp_max&gt;7000<br>group by attack_range <br>order by num desc;","like_count":0},{"had_liked":false,"id":274308,"user_name":"Flychen","can_delete":false,"product_type":"c1","uid":1880782,"ip_address":"","ucode":"4029A8F1D3C361","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/ce/5638be2b.jpg","comment_is_top":false,"comment_ctime":1610960518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610960518","product_id":100029501,"comment_content":"-- 筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，<br>-- 选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，<br>-- 并显示每个分组的英雄数量、主要定位和平均最大生命值。<br><br><br>select count(*),role_main,AVG(hp_max)<br><br>from heros<br>where hp_max &gt; 6000 <br>GROUP BY role_main<br>HAVING COUNT(*) &gt; 5<br><br>order by COUNT(*) DESC;<br><br>-- ------------------------------<br>-- 筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，<br>-- 以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，<br>-- 其中聚集函数的结果包括小数点后两位。<br><br>SELECT count(*) &#39;数量&#39;,attack_range,max(hp_max),sum(mp_max),ROUND(AVG(mp_max),2),max(mp_max),min(mp_max)<br>from heros<br>where (hp_max + mp_max) &gt; 7000<br>group by attack_range<br>ORDER BY &#39;数量&#39; ;<br>","like_count":0},{"had_liked":false,"id":264351,"user_name":"novaln🍉","can_delete":false,"product_type":"c1","uid":1231695,"ip_address":"","ucode":"EC544D448DA898","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/4f/feb5528f.jpg","comment_is_top":false,"comment_ctime":1606445124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606445124","product_id":100029501,"comment_content":"SELECT COUNT(*) AS num, role_main, AVG(hp_max) FROM heros <br>WHERE hp_max &gt; 6000 <br>GROUP BY role_main <br>HAVING num &gt; 5<br>ORDER BY num DESC;<br><br><br>SELECT COUNT(*) AS num, ROUND(AVG(SUM(hp_max, fali_max)), 2), ROUND(MAX(SUM(hp_max, fali_max)), 2), ROUND(MIN(SUM(hp_max, fali_max)), 2)<br>WHERE SUM(hp_max, fali_max) &gt; 7000<br>GROUP BY attack_area<br>ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":264185,"user_name":"咱是吓大的","can_delete":false,"product_type":"c1","uid":1292324,"ip_address":"","ucode":"A47C6DA5C00C6F","user_header":"https://static001.geekbang.org/account/avatar/00/13/b8/24/039f84a2.jpg","comment_is_top":false,"comment_ctime":1606375797,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1606375797","product_id":100029501,"comment_content":"SELECT COUNT(*) as num,role_main,AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br><br>SELECT count(*) as num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE hp_max+mp_max&gt;7000 GROUP BY attack_range ORDER BY num DESC","like_count":0},{"had_liked":false,"id":264062,"user_name":"闫城哲","can_delete":false,"product_type":"c1","uid":1624846,"ip_address":"","ucode":"1903E022DF6A6F","user_header":"https://static001.geekbang.org/account/avatar/00/18/cb/0e/a9fee0b6.jpg","comment_is_top":false,"comment_ctime":1606322268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606322268","product_id":100029501,"comment_content":"select name ,count(*) as num, ROUND(max(hp_max + mp_max),2), ROUND(min(hp_max + mp_max),2),ROUND(avg(hp_max + mp_max),2) from heros where (hp_max + mp_max) &gt; 7000 GROUP BY attack_range order by num desc<br><br>夏侯惇\t36\t11036\t7117\t8654.42<br>后羿\t26\t8737\t7025\t7743.77","like_count":0},{"had_liked":false,"id":264061,"user_name":"闫城哲","can_delete":false,"product_type":"c1","uid":1624846,"ip_address":"","ucode":"1903E022DF6A6F","user_header":"https://static001.geekbang.org/account/avatar/00/18/cb/0e/a9fee0b6.jpg","comment_is_top":false,"comment_ctime":1606321898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606321898","product_id":100029501,"comment_content":"select name ,count(*) as num , role_main, avg(hp_max) from heros where hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 order by num desc;","like_count":0},{"had_liked":false,"id":257266,"user_name":"欧阳啊","can_delete":false,"product_type":"c1","uid":1868570,"ip_address":"","ucode":"CF1D0F0802713B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/83/1a/f9d9225f.jpg","comment_is_top":false,"comment_ctime":1603898219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603898219","product_id":100029501,"comment_content":"DB2数据库使用聚焦函数都必须要有GROUP BY 分组完成之后才能使用，不然直接报错。我开始还以为老师写错了呢。。","like_count":0},{"had_liked":false,"id":256399,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1603617560,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603617560","product_id":100029501,"comment_content":"通常我们还会对数据先进行分组，然后再使用聚集函数统计不同组的数据概况，比如数据行数、平均值、最大值、最小值以及求和等。我们也可以使用 HAVING 对分组进行过滤，然后通过 ORDER BY 按照某个字段的顺序进行排序输出。有时候你能看到在一条 SELECT 语句中，可能会包括多个子句，用 WHERE 进行数据量的过滤，用 GROUP BY 进行分组，用 HAVING 进行分组过滤，用 ORDER BY 进行排序……","like_count":0},{"had_liked":false,"id":256398,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1603617508,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603617508","product_id":100029501,"comment_content":"筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。","like_count":0},{"had_liked":false,"id":251681,"user_name":"Gentle Montage","can_delete":false,"product_type":"c1","uid":2154173,"ip_address":"","ucode":"337279335BB7F8","user_header":"https://static001.geekbang.org/account/avatar/00/20/de/bd/33f70754.jpg","comment_is_top":false,"comment_ctime":1601794256,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601794256","product_id":100029501,"comment_content":"如果想要查询最大生命值大于 6000，且有次要定位的英雄数量，需要使用 COUNT 函数。<br><br>可以用这种吗？<br>select count(*) from heros where hp_max&gt;6000 and assist_role is not NULL.<br><br>count函数的内容是*还是用字段名，有什么讲究嘛？","like_count":0},{"had_liked":false,"id":251281,"user_name":"盛艳明","can_delete":false,"product_type":"c1","uid":1132347,"ip_address":"","ucode":"E4C1C699572C44","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/3b/15e4490f.jpg","comment_is_top":false,"comment_ctime":1601448364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601448364","product_id":100029501,"comment_content":"1. select count(*) as num,role_main,AVG(hp_max) as avg_hp FROM heros where hp_max &gt; 6000 Group By role_main having num &gt; 5 order by num DESC;<br><br>2.select ROUND(AVG(hp_max+mp_max),2)as avg, ROUND(MAX(hp_max+mp_max),2)as max, ROUND(MIN(hp_max+mp_max),2)as min,count(*) as num FROM heros WHERE (hp_max+mp_max) &gt; 7000 Group By attack_range ORDER BY num DESC;<br>","like_count":0},{"had_liked":false,"id":250926,"user_name":"草鱼禾","can_delete":false,"product_type":"c1","uid":2184778,"ip_address":"","ucode":"06865069745DBF","user_header":"https://static001.geekbang.org/account/avatar/00/21/56/4a/6e3e0bbd.jpg","comment_is_top":false,"comment_ctime":1601282797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601282797","product_id":100029501,"comment_content":"1、SELECT COUNT(*) AS num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC<br>2、SELECT COUNT(*) AS num,attack_range,MAX(hp_max),ROUND(AVG(mp_max),1),MIN(mp_max) FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range HAVING num&gt;1 ORDER BY num DESC","like_count":0},{"had_liked":false,"id":249006,"user_name":"杯莫停","can_delete":false,"product_type":"c1","uid":1759325,"ip_address":"","ucode":"4FA1D5CBBEF702","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg","comment_is_top":false,"comment_ctime":1600400689,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600400689","product_id":100029501,"comment_content":"SELECT <br>COUNT(*) AS num,<br>role_main,<br>AVG(hp_max) <br>FROM heros <br>WHERE hp_max &gt;6000 <br>GROUP BY role_main <br>HAVING num &gt; 5 <br>ORDER BY num DESC<br><br><br>SELECT <br>COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2) AS avg_num,<br>MAX(hp_max+mp_max) AS max_num,<br>MIN(hp_max+mp_max) AS min_num <br>FROM heros <br>WHERE hp_max+mp_max &gt; 7000  <br>GROUP BY attack_range  <br>ORDER BY num DESC","like_count":0},{"had_liked":false,"id":246423,"user_name":"MengGe","can_delete":false,"product_type":"c1","uid":2131534,"ip_address":"","ucode":"9D4849CEBDA386","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8oQ7n5tkeHsOSoyvqFpp6Fg9lHhGRZ9ypqiaemHWp3eZG6PTDzJbkbFQ6L4la1sib1CFnVlCDiaRbfUWAA3VgibfIQ/132","comment_is_top":false,"comment_ctime":1599319219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599319219","product_id":100029501,"comment_content":"之前学SQL都是在网上找的一些零散资料，听了陈老师的课程后有了新的理解。毕竟有头有尾的内容更容易让人想明白。<br>对于今天的题，想和大家对下答案：<br>1.<br>SELECT COUNT(name) as nums,role_main,AVG(hp_max)<br>FROM heros<br>WHERE hp_max&gt;6000<br>GROUP BY role_main<br>HAVING nums&gt;5<br>ORDER BY nums DESC;<br><br>17\t战士\t7028<br>10\t坦克\t8312.4<br>6\t法师\t6417<br><br>2.<br>SELECT COUNT(name) as heros_nums,ROUND(AVG(hp_max+mp_max),2) as hp_mp_avg,ROUND(MAX(hp_max+mp_max),2) as hp_mp_max,ROUND(MIN(hp_max+mp_max),2) as hp_mp_min<br>FROM heros<br>WHERE (hp_max+mp_max)&gt;7000<br>GROUP BY attack_range<br>ORDER BY heros_nums DESC;<br><br>36\t8654.42\t11036.00\t7117.00<br>26\t7743.77\t8737.00\t7025.00<br>","like_count":0},{"had_liked":false,"id":245326,"user_name":"Nevin Jiang","can_delete":false,"product_type":"c1","uid":1297461,"ip_address":"","ucode":"CA5317AF239500","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/35/70bc2a53.jpg","comment_is_top":false,"comment_ctime":1598908631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598908631","product_id":100029501,"comment_content":"-- Q1<br>with hero_main_role as (<br>    select<br>        role_main,<br>        count(*) as hero_count,<br>        avg(hp_max) as avg_hp_max<br>    from<br>        heros<br>    where<br>        hp_max &gt; 6000<br>    group by<br>        1<br>)<br><br>select<br>    hero_count,<br>    role_main,<br>    avg_hp_max<br>from<br>    hero_main_role<br>where<br>    hero_count &gt; 5<br>order by<br>    1 desc<br>;<br>-- Q2<br>with hero_attack_range_group as (<br>    select<br>        attack_range,<br>        count(*) as hero_count,<br>        avg(hp_max + mp_max) as avg_hp_mp,<br>        max(hp_max + mp_max) as max_hp_mp,<br>        min(hp_max + mp_max) as min_hp_mp<br>    from<br>        heros<br>    where<br>        hp_max + mp_max &gt; 7000<br>    group by<br>        1<br>)<br><br>select<br>    hero_count,<br>    avg_hp_mp,<br>    max_hp_mp,<br>    min_hp_mp<br>from<br>    hero_attack_range_group<br>order by<br>    1 desc<br>;<br>","like_count":0},{"had_liked":false,"id":241351,"user_name":"夏天呀","can_delete":false,"product_type":"c1","uid":1673679,"ip_address":"","ucode":"1C5C060C05923B","user_header":"https://static001.geekbang.org/account/avatar/00/19/89/cf/1c7703b1.jpg","comment_is_top":false,"comment_ctime":1597275951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597275951","product_id":100029501,"comment_content":"A1:<br>mysql&gt; SELECT COUNT(*) AS num, role_main, AVG(hp_max) FROM heros<br>    -&gt; WHERE hp_max&gt;6000<br>    -&gt; GROUP BY role_main<br>    -&gt; HAVING num&gt;5<br>    -&gt; ORDER BY num DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br>3 rows in set (0.00 sec)<br><br><br>A2:<br>mysql&gt; SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max), 2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC;<br><br>+-----+-----------------------------+------------------------------+-----------------------------+<br>| num | ROUND(AVG(hp_max+mp_max),2) | ROUND(MAX(hp_max+mp_max), 2) | ROUND(MIN(hp_max+mp_max),2) |<br>+-----+-----------------------------+------------------------------+-----------------------------+<br>|  62 |                     8272.53 |                     11036.00 |                     7025.00 |<br>+-----+-----------------------------+------------------------------+-----------------------------+<br>","like_count":0},{"had_liked":false,"id":240171,"user_name":"奥佛铎","can_delete":false,"product_type":"c1","uid":1234919,"ip_address":"","ucode":"A1D544E5F22B7F","user_header":"","comment_is_top":false,"comment_ctime":1596776755,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596776755","product_id":100029501,"comment_content":"第一题：SELECT COUNT(*) as Number, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING Number &gt; 5 ORDER BY Number DESC;<br><br>第二题：<br>SELECT COUNT(*) as Number, ROUND(AVG(hp_max + mp_max),2), MAX(hp_max + mp_max), MIN(hp_max + mp_max) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range ORDER BY Number DESC;","like_count":0},{"had_liked":false,"id":239279,"user_name":"Geek_gong1zu","can_delete":false,"product_type":"c1","uid":2086659,"ip_address":"","ucode":"D629A6652AB8E2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d7/03/db060811.jpg","comment_is_top":false,"comment_ctime":1596475202,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596475202","product_id":100029501,"comment_content":"1、<br>SELECT COUNT(*) AS num,role_main,AVG(hp_max)<br>FROM heros<br>WHERE hp_max&gt;6000<br>GROUP BY role_main<br>HAVING  num&gt;5<br>ORDER BY num DESC;<br><br>2、<br>SELECT COUNT(*) AS num,<br>ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2)<br>FROM heros<br>WHERE (hp_max+mp_max)&gt;7000<br>GROUP BY attach_range<br>ORDER BY num DESC;<br>","like_count":0},{"had_liked":false,"id":238899,"user_name":"Maske","can_delete":false,"product_type":"c1","uid":1696847,"ip_address":"","ucode":"A19BB41A47E852","user_header":"https://static001.geekbang.org/account/avatar/00/19/e4/4f/df6d810d.jpg","comment_is_top":false,"comment_ctime":1596360684,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596360684","product_id":100029501,"comment_content":"1. SELECT COUNT(*) as num , role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5  ORDER BY num DESC;<br>2. SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2), ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":236668,"user_name":"Jack Zhang","can_delete":false,"product_type":"c1","uid":1315728,"ip_address":"","ucode":"E3AEAE55A9B16C","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/90/f94a6436.jpg","comment_is_top":false,"comment_ctime":1595496627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595496627","product_id":100029501,"comment_content":"重发一遍，第二题应该是按攻击范围分组，我写成了按最大攻击分组。<br>筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每A个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT COUNT(*) AS num, role_main, AVG(hp_max) AS avg_hp_max FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br><br>筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max),2) AS avg_hp_mp_max, ROUND(MAX(hp_max+mp_max),2) AS min_hp_mp_max, ROUND(MIN(hp_max+mp_max),2) AS max_hp_mp_max FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num","like_count":0},{"had_liked":false,"id":236666,"user_name":"Jack Zhang","can_delete":false,"product_type":"c1","uid":1315728,"ip_address":"","ucode":"E3AEAE55A9B16C","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/90/f94a6436.jpg","comment_is_top":false,"comment_ctime":1595496461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595496461","product_id":100029501,"comment_content":"筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT COUNT(*) AS num, role_main, AVG(hp_max) AS avg_hp_max FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br><br>筛选最大生命值与最大法力值之和大于 7000的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max),2) AS avg_hp_mp_max, ROUND(MAX(hp_max+mp_max),2) AS max_hp_mp_max, ROUND(MIN(hp_max+mp_max),2) AS min_hp_mp_max FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_max ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":229655,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":2015982,"ip_address":"","ucode":"F2CDC708F30997","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8YUnk8Z9LAaLINgWWnt8HXu8ZlyD7vLpHrJaExGeZ5YyWIrI4SYcX3joOpibAWIyuqGibqVNwq8XQ/132","comment_is_top":false,"comment_ctime":1593089007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593089007","product_id":100029501,"comment_content":"第一题<br><br>SELECT COUNT(*) AS amountOfHero ,rolemain,AVG(*) <br>FROM heroes <br>WHERE  hp_max&gt;6000<br>Group BY  role_main <br>Having amountOfHero &gt; 5<br>ORDER BY amountOfHero DESC;","like_count":0},{"had_liked":false,"id":229481,"user_name":"宁悦","can_delete":false,"product_type":"c1","uid":1901403,"ip_address":"","ucode":"68844C314FEEF8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/03/5b/3cdbc9fa.jpg","comment_is_top":false,"comment_ctime":1593010785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593010785","product_id":100029501,"comment_content":"第一问答案：<br>SELECT COUNT(*) AS num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br>第二问答案：<br> SELECT COUNT(*) AS num ,ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2),ROUND(AVG(hp_max+mp_max),2) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":223777,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1168774,"ip_address":"","ucode":"9A5B148A7E453A","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/86/5b1ff7d9.jpg","comment_is_top":false,"comment_ctime":1591178134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591178134","product_id":100029501,"comment_content":"#筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，<br>#选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，<br>#并显示每个分组的英雄数量、主要定位和平均最大生命值<br>SELECT COUNT(*) AS num, role_main, ROUND(AVG(hp_max), 2) FROM heros.heros<br>WHERE role_main IS NOT NULL<br>GROUP BY role_main<br>HAVING num &gt;= 5<br>ORDER BY num DESC;<br><br>#筛选最大生命值与最大法力值之和大于 7000的英雄，<br>#按照攻击范围来进行分组，显示分组的英雄数量，<br>#以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，<br>#并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位<br><br>SELECT COUNT(*) AS num, (hp_max+mp_max) AS hp_mp, ROUND(AVG(hp_max+mp_max), 2), MAX(hp_max+mp_max), MIN(hp_max+mp_max) FROM heros.heros<br>WHERE attack_range IS NOT NULL<br>GROUP BY attack_range<br>HAVING hp_mp &gt; 7000<br>ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":222245,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1187523,"ip_address":"","ucode":"DA641A3C6ECCFC","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/c3/c9399b2e.jpg","comment_is_top":false,"comment_ctime":1590724606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590724606","product_id":100029501,"comment_content":"SELECT ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2),COUNT(*) num  FROM heros WHERE (hp_max+mp_max) &gt;7000 GROUP BY attack_range  ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":222243,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1187523,"ip_address":"","ucode":"DA641A3C6ECCFC","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/c3/c9399b2e.jpg","comment_is_top":false,"comment_ctime":1590724325,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590724325","product_id":100029501,"comment_content":"SELECT role_main,AVG(hp_max),COUNT(*) num  FROM heros WHERE hp_max &gt;6000 GROUP BY role_main  HAVING num &gt;5   ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":220779,"user_name":"甘康艺","can_delete":false,"product_type":"c1","uid":1953633,"ip_address":"","ucode":"D06219B5C592CF","user_header":"https://static001.geekbang.org/account/avatar/00/1d/cf/61/f592700e.jpg","comment_is_top":false,"comment_ctime":1590323291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590323291","product_id":100029501,"comment_content":"#筛选最大生命值与最大法力值之和大于 7000 的英雄，<br>#按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，<br>#并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位<br>SELECT COUNT(h.name) heros, ROUND(AVG(h.hp_max+h.mp_max),2) AS hp_mp_avg, <br>MAX(h.hp_max+h.mp_max) AS hp_mp_max,<br>MIN(h.hp_max+h.mp_max) AS hp_mp_min<br>FROM heros AS h<br>WHERE (h.hp_max+h.mp_max) &gt; 7000 GROUP BY h.attack_range<br>ORDER BY heros DESC;","like_count":0},{"had_liked":false,"id":220774,"user_name":"甘康艺","can_delete":false,"product_type":"c1","uid":1953633,"ip_address":"","ucode":"D06219B5C592CF","user_header":"https://static001.geekbang.org/account/avatar/00/1d/cf/61/f592700e.jpg","comment_is_top":false,"comment_ctime":1590323022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590323022","product_id":100029501,"comment_content":"#筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，<br>#选择分组英雄数量大于 5 的分组，按照分组英雄数从高到低进行排序，<br>#并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>SELECT COUNT(h.name) AS heros, h.role_main, AVG(h.hp_max)<br>AS hp_max_avg FROM heros h <br>WHERE h.hp_max &gt; 6000 GROUP BY h.role_main<br>HAVING COUNT(h.name) &gt; 5 <br>ORDER BY heros DESC;","like_count":0},{"had_liked":false,"id":220524,"user_name":"彤彤","can_delete":false,"product_type":"c1","uid":1866382,"ip_address":"","ucode":"6058FC822EF649","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0bexhQ6hllSYOM9GoRaR0Rq99aZqOAIfBblqfNbD5YXDcWRdWcDLpaTp4R8LbSfQTaCmRhcibehHMLzTb3yQ53Q/132","comment_is_top":false,"comment_ctime":1590281286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590281286","product_id":100029501,"comment_content":"-- 筛选最大生命值与最大法力值之和大于 7000 的英雄，按照攻击范围来进行分组，显示分组的英雄数量，<br>-- 以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，并按照分组英雄数从高到低进行排序，<br>-- 其中聚集函数的结果包括小数点后两位。<br>select count(*) as num, attack_range, round(avg(hp_max + mp_max), 2), <br>round(max(hp_max + mp_max),2), round(min(hp_max + mp_max),2)  <br>from h_king.heros<br>where (hp_max + mp_max) &gt; 7000<br>group by attack_range having num&gt;5 order by num desc","like_count":0},{"had_liked":false,"id":220523,"user_name":"彤彤","can_delete":false,"product_type":"c1","uid":1866382,"ip_address":"","ucode":"6058FC822EF649","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0bexhQ6hllSYOM9GoRaR0Rq99aZqOAIfBblqfNbD5YXDcWRdWcDLpaTp4R8LbSfQTaCmRhcibehHMLzTb3yQ53Q/132","comment_is_top":false,"comment_ctime":1590281276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590281276","product_id":100029501,"comment_content":"-- 筛选最大生命值大于 6000 的英雄，按照主要定位进行分组，选择分组英雄数量大于 5 的分组，<br>-- 按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>select count(*) as num, role_main, avg(hp_max) from h_king.heros<br>where hp_max &gt; 6000<br>group by role_main having num&gt;5 order by num desc","like_count":0},{"had_liked":false,"id":204112,"user_name":"曲颀","can_delete":false,"product_type":"c1","uid":1859612,"ip_address":"","ucode":"BB2C6B4D93B6E5","user_header":"https://static001.geekbang.org/account/avatar/00/1c/60/1c/6fce1419.jpg","comment_is_top":false,"comment_ctime":1586334675,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586334675","product_id":100029501,"comment_content":"select<br>\tcount(*) as num,<br>\trole_main as &#39;主要定位&#39;,<br>\tAVG(hp_max) as &#39;平均最大生命值&#39;<br>FROM<br>\theros<br>WHERE<br>\thp_max &gt; 6000<br>GROUP BY<br>\trole_main<br>HAVING<br>\tnum &gt; 5<br>ORDER BY<br>\tnum DESC;<br>\t<br>SELECT<br>\tcount(*) as num,<br>\tROUND(AVG(hp_max + mp_max), 2) as &#39;平均值&#39;,<br>\tROUND(MAX(hp_max + mp_max), 2) as &#39;最大值&#39;,<br>\tROUND(MIN(hp_max + mp_max), 2) as &#39;最小值&#39;<br>FROM<br>\theros<br>WHERE<br>\thp_max + mp_max &gt; 7000<br>GROUP BY<br>\tattack_range<br>ORDER BY<br>\tnum desc;","like_count":0},{"had_liked":false,"id":204059,"user_name":"凌空飞起的剪刀腿","can_delete":false,"product_type":"c1","uid":1243680,"ip_address":"","ucode":"16FBBF4A3B54C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/fa/20/0f06b080.jpg","comment_is_top":false,"comment_ctime":1586326198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586326198","product_id":100029501,"comment_content":"答题<br>①SELECT COUNT(*) as num, role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC<br>②SELECT COUNT(*) as num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_max ORDER BY num DESC","like_count":0},{"had_liked":false,"id":194092,"user_name":"track6688","can_delete":false,"product_type":"c1","uid":1088040,"ip_address":"","ucode":"0A9E893F8FD379","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/28/03613c22.jpg","comment_is_top":false,"comment_ctime":1585024165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585024165","product_id":100029501,"comment_content":"问题一：<br>SELECT COUNT(*) AS num, role_main, AVG(h.hp_max) FROM heros h WHERE h.hp_max &gt; 6000 GROUP BY h.role_main HAVING num &gt; 5 ORDER BY num DESC; <br>问题二：<br>SELECT COUNT(*) AS num, h.attack_range, ROUND(AVG(h.hp_max + h.mp_max),2), ROUND(MAX(h.hp_max + h.mp_max),2), ROUND(MIN(h.hp_max+h.mp_max),2) <br>FROM heros h WHERE (h.hp_max + h.mp_max) &gt; 7000 GROUP BY h.attack_range  ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":189340,"user_name":"索旭东","can_delete":false,"product_type":"c1","uid":1139039,"ip_address":"","ucode":"BFD07BCD8C8CAE","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/5f/b279daaf.jpg","comment_is_top":false,"comment_ctime":1584502071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584502071","product_id":100029501,"comment_content":"SELECT count(*) as num, role_main, AVG(hp_max)<br>FROM heros<br>WHERE hp_max &gt; 6000<br>GROUP BY role_main<br>HAVING num &gt; 5<br>ORDER BY num DESC","like_count":0},{"had_liked":false,"id":187880,"user_name":"mumu","can_delete":false,"product_type":"c1","uid":1371095,"ip_address":"","ucode":"E409BDA36091A3","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/d7/712912a7.jpg","comment_is_top":false,"comment_ctime":1584264717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584264717","product_id":100029501,"comment_content":"老师您好，请问如何对一段时间的数据，比如2020-01-02 00:00:00 到 2020-01-03 00:00:00 按 10分钟一组进行统计呢？","like_count":0},{"had_liked":false,"id":186849,"user_name":"L.","can_delete":false,"product_type":"c1","uid":1543396,"ip_address":"","ucode":"9803C2EDC799DC","user_header":"https://static001.geekbang.org/account/avatar/00/17/8c/e4/ad3e7c39.jpg","comment_is_top":false,"comment_ctime":1583938153,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"1583938153","product_id":100029501,"comment_content":" 目的想选择hp最高的英雄和名字 (1)select name,MAX(hp_max) from heros;写法一得不到正确得答案，换成了写法(2)select name,hp_max from heros where hp_max=(select max(hp_max) from heros);  想请教写法(1)为什么不行，网上搜了一下也没找到满意的回答 ","like_count":0,"discussions":[{"author":{"id":1543396,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/e4/ad3e7c39.jpg","nickname":"L.","note":"","ucode":"9803C2EDC799DC","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202986,"discussion_content":"补充一下，主要问题是写法一为什么没有报错，且有结果，结果为 夏侯惇，9328","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583979692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180789,"user_name":"暖冬°","can_delete":false,"product_type":"c1","uid":1545663,"ip_address":"","ucode":"CE2E4A30085DDB","user_header":"https://static001.geekbang.org/account/avatar/00/17/95/bf/4a30ba94.jpg","comment_is_top":false,"comment_ctime":1582389274,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582389274","product_id":100029501,"comment_content":"现在提问，还能回答么？<br>我想问怎么在显示的结果加个姓名，就是多查一个姓名（自己琢磨了十几分钟，还是没弄出来，基础较差）<br>&#47;**<br>筛选最大生命值大于 6000 的英雄，<br>按照主要定位进行分组，<br>选择分组英雄数量大于 5 的分组，<br>按照分组英雄数从高到低进行排序，<br>并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>*&#47; SELECT<br>COUNT( * ) AS num,<br>role_main,<br>AVG( hp_max ) <br>FROM<br>\theros <br>WHERE<br>\thp_max &gt; 6000 <br>GROUP BY<br>\trole_main <br>HAVING<br>\tnum &gt; 5 <br>ORDER BY<br>\tnum DESC<br>&#47;**<br>筛选最大生命值与最大法力值之和大于 7000 的英雄，<br>按照攻击范围来进行分组，<br>显示分组的英雄数量，<br>以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，<br>并按照分组英雄数从高到低进行排序，<br>其中聚集函数的结果包括小数点后两位。<br>*&#47; SELECT<br>COUNT( * ) AS num,<br>ROUND( AVG( hp_max + mp_max ), 2 ) AS avg,<br>ROUND( SUM( hp_max + mp_max ), 2 ) AS sum,<br>ROUND( MAX( hp_max + mp_max ), 2 ) AS max,<br>ROUND( MIN( hp_max + mp_max ), 2 ) AS min<br>FROM<br>\theros <br>WHERE<br>\t( hp_max + mp_max ) &gt; 7000 <br>GROUP BY<br>\tattack_range <br>ORDER BY<br>\tnum DESC","like_count":0,"discussions":[{"author":{"id":1122734,"avatar":"https://static001.geekbang.org/account/avatar/00/11/21/ae/416a7d6d.jpg","nickname":"Moby","note":"","ucode":"A9CFD37FD8B5C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220050,"discussion_content":"加个名字：\nselect count(*) num,name,role_main,avg(hp_max) \nfrom heros where hp_max>6000 group by role_main  order by num desc; \n\n需要去掉 having num>5，不然结果为空","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585832289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177176,"user_name":"大猫当了个当","can_delete":false,"product_type":"c1","uid":1812021,"ip_address":"","ucode":"4182BF6E3B86A5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a6/35/52a6551a.jpg","comment_is_top":false,"comment_ctime":1581315447,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581315447","product_id":100029501,"comment_content":"练习题<br>SELECT COUNT(*) as sum, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING sum &gt; 5 ORDER BY sum  DESC<br><br>SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max),2), ROUND(MAX(hp_max+mp_max),2), ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE hp_max+mp_max &gt; 7000 GROUP BY attack_range ORDER BY num DESC","like_count":0},{"had_liked":false,"id":173328,"user_name":"LYEMOML","can_delete":false,"product_type":"c1","uid":1019315,"ip_address":"","ucode":"D71BDFDFCBD7CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/b3/a176ac80.jpg","comment_is_top":false,"comment_ctime":1579505495,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579505495","product_id":100029501,"comment_content":"```sql<br>SELECT COUNT(*) as count, AVG(hp_max), role_main FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING count &gt; 5 ORDER BY count desc;<br>```<br><br>```sql<br>SELECT COUNT(*) as count, ROUND(AVG(hp_max+mp_max), 2), ROUND(MAX(hp_max+mp_max), 2), ROUND(MIN(hp_max+mp_max), 2),  attack_range FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY count DESC;<br>```","like_count":0},{"had_liked":false,"id":165340,"user_name":"爬行的蜗牛","can_delete":false,"product_type":"c1","uid":1033956,"ip_address":"","ucode":"6623B62DE63CE9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QD6bf8hkS5dHrabdW7M7Oo9An1Oo3QSxqoySJMDh7GTraxFRX77VZ2HZ13x3R4EVYddIGXicRRDAc7V9z5cLDlA/132","comment_is_top":false,"comment_ctime":1577203041,"is_pvip":false,"replies":[{"id":"63759","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577531293,"ip_address":"","comment_id":165340,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577203041","product_id":100029501,"comment_content":"SELECT  COUNT(*) as num, role_main, avg(hp_max)<br>FROM heros<br>WHERE hp_max &gt; 6000 <br>GROUP BY role_main  HAVING num &gt; 5 ORDER BY num DESC; ","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479128,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577531293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164546,"user_name":"amor","can_delete":false,"product_type":"c1","uid":1347662,"ip_address":"","ucode":"77218AA29D2564","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIzcqzRzz09q1XpPFZu752t0t03qDQZBI32FwiafYibfJbHqqATrRL5iaE591wyVl5Y3eHQMnBeyZxVQ/132","comment_is_top":false,"comment_ctime":1577025400,"is_pvip":false,"replies":[{"id":"62572","content":"问题1回答正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577068421,"ip_address":"","comment_id":164546,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577025400","product_id":100029501,"comment_content":"SELECT COUNT(*) AS num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt;6000 GROUP BY role_main HAVING num &gt;5 ORDER BY num DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br>3 rows in set (0.02 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478810,"discussion_content":"问题1回答正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577068421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161763,"user_name":"高泽林","can_delete":false,"product_type":"c1","uid":1764725,"ip_address":"","ucode":"DE54EBFFF11265","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/AGicQgKibwja1SxkQ7oXQE8hYH7yCpiaicNHw3qZRuNB81aVDOQm9P1zd5F75Jbtv66G15D6ZjbbqfnoETR4321Zdw/132","comment_is_top":false,"comment_ctime":1576319500,"is_pvip":false,"replies":[{"id":"62582","content":"加油~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577070869,"ip_address":"","comment_id":161763,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576319500","product_id":100029501,"comment_content":"非常好！适合我！","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477847,"discussion_content":"加油~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577070869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161266,"user_name":"taoist","can_delete":false,"product_type":"c1","uid":1195004,"ip_address":"","ucode":"D70AFE25CD8F10","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/fc/04a75cd0.jpg","comment_is_top":false,"comment_ctime":1576160199,"is_pvip":true,"replies":[{"id":"62637","content":"SQL正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577079396,"ip_address":"","comment_id":161266,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576160199","product_id":100029501,"comment_content":"# MariaDB:<br><br>1. SELECT role_main,AVG(hp_max) as avg_hp, COUNT(*) AS count FROM  heros WHERE hp_max &gt; 6000 GROUP BY  role_main HAVING count &gt; 5 ORDER BY count DESC;<br><br>2.  SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max),2), ROUND( MAX(hp_max+mp_max), 2), ROUND(MIN(hp_max+mp_max) ,2) FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477671,"discussion_content":"SQL正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577079396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160935,"user_name":"Geek_d3a509","can_delete":false,"product_type":"c1","uid":1765573,"ip_address":"","ucode":"8A40A85D4D1A73","user_header":"","comment_is_top":false,"comment_ctime":1576064231,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576064231","product_id":100029501,"comment_content":"问题SQL：（1）SELECT COUNT(*) as num, role_main, avg(hp_max) FROM heros  WHERE hp_max &gt;6000  GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br><br>（2）SELECT COUNT(*) as num, attack_range, ROUND(avg(hp_max + mp_max),2 ) as avg ,ROUND(MAX(hp_max + mp_max),2) as max, ROUND(MIN(hp_max + mp_max),2) as min FROM heros WHERE (hp_max + mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC; ","like_count":0},{"had_liked":false,"id":158413,"user_name":"春风","can_delete":false,"product_type":"c1","uid":1103971,"ip_address":"","ucode":"76947E35A76C67","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","comment_is_top":false,"comment_ctime":1575365428,"is_pvip":false,"replies":[{"id":"62629","content":"Tony同学很细心，原因是因为编码的问题，name字段在创建的时候使用的是utf8编码，这里你可以使用<br>SELECT MIN(CONVERT(name USING utf8)), MAX(CONVERT(name USING utf8)) FROM heros<br>看下结果，和SELECT MIN(name), MAX(name) FROM heros;是一样的，result都是：不知火舞，黄忠","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577078627,"ip_address":"","comment_id":158413,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575365428","product_id":100029501,"comment_content":"SELECT MIN(name), MAX(name) FROM heros;<br>result：不知火舞，黄忠<br>SELECT MIN(CONVERT(name USING gbk)), MAX(CONVERT(name USING gbk)) FROM heros<br>result：阿珂，庄周<br>这两条查出来的结果不一样？上面那个也不是a到z啊","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476713,"discussion_content":"Tony同学很细心，原因是因为编码的问题，name字段在创建的时候使用的是utf8编码，这里你可以使用\nSELECT MIN(CONVERT(name USING utf8)), MAX(CONVERT(name USING utf8)) FROM heros\n看下结果，和SELECT MIN(name), MAX(name) FROM heros;是一样的，result都是：不知火舞，黄忠","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577078627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157024,"user_name":"坤2021牛","can_delete":false,"product_type":"c1","uid":1676097,"ip_address":"","ucode":"A26B321F300785","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/cKeYVTKJCJhrfTCBkEGla1WA7W0S9FPZrTR3ovYJFhcKo7kl72gR9VibCufhHsjOar2Z6mZlFKb8VEkkDv9lqVA/132","comment_is_top":false,"comment_ctime":1575014495,"is_pvip":false,"replies":[{"id":"62622","content":"oracle支持having，写成 having COUNT(*) &gt; 5试试","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577078247,"ip_address":"","comment_id":157024,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575014495","product_id":100029501,"comment_content":"mysql:  SELECT COUNT(*) as num, role_main, role_assist FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main, role_assist HAVING num &gt; 5 ORDER BY num DESC;<br>oracle: select count(*) as num,t.reson_code from E_STATE t where t.equi_code = &#39;R01&#39; group by t.reson_code HAVING num &gt; 5 order by num desc;<br><br>在oracle下报错，锁num无效。是不是oracle下不支持having，但是不应该啊。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476306,"discussion_content":"oracle支持having，写成 having COUNT(*) &amp;gt; 5试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577078247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144924,"user_name":"扶幽","can_delete":false,"product_type":"c1","uid":1322612,"ip_address":"","ucode":"1400EDFF8970D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg","comment_is_top":false,"comment_ctime":1572096690,"is_pvip":false,"replies":[{"id":"62692","content":"两个SQL正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577084665,"ip_address":"","comment_id":144924,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572096690","product_id":100029501,"comment_content":"作业：<br>1) SELECT COUNT(*) AS num, role_main, AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br>2) SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max), 2) AS avg, ROUND(MAX(hp_max+mp_max),2) AS max, ROUND(MIN(hp_max+mp_max), 2) AS min FROM heros<br>WHERE hp_max+mp_max&gt;7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472168,"discussion_content":"两个SQL正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577084665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142512,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571383881,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571383881","product_id":100029501,"comment_content":"1、<br>SELECT <br>    COUNT(*) AS num, role_main, AVG(hp_max)<br>FROM<br>    heros<br>WHERE hp_max&gt;6000<br>GROUP BY role_main <br>HAVING num &gt; 5<br>ORDER BY num DESC<br>2、<br>SELECT <br>    COUNT(*) AS num, ROUND( AVG(hp_max+mp_max),2), ROUND( MAX(hp_max+mp_max),2), ROUND( MIN(hp_max+mp_max),2)<br>FROM<br>    heros<br>WHERE (hp_max+mp_max)&gt;7000<br>GROUP BY attack_range <br>ORDER BY num DESC","like_count":0},{"had_liked":false,"id":142146,"user_name":"半瓶醋","can_delete":false,"product_type":"c1","uid":1282746,"ip_address":"","ucode":"8C898E244D0417","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/ba/9833f06f.jpg","comment_is_top":false,"comment_ctime":1571300299,"is_pvip":true,"replies":[{"id":"62704","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577085504,"ip_address":"","comment_id":142146,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571300299","product_id":100029501,"comment_content":"1）<br>SELECT COUNT(*) nums,role_main,AVG(hp_max) avg_hp<br>from heros<br>WHERE hp_max &gt; 6000<br>GROUP BY role_main<br>HAVING nums &gt; 5<br>ORDER BY nums DESC<br><br>2）SELECT COUNT(*) as nums,attack_range,ROUND(AVG(hp_max + mp_max),2) as avg_hp_mp,<br>\t\t\t MAX(hp_max + mp_max) as max_hp_mp,<br>\t\t\t MIN(hp_max + mp_max) as min_hp_mp<br>FROM heros<br>WHERE (hp_max + mp_max) &gt; 7000<br>GROUP BY attack_range<br>ORDER BY nums DESC","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471004,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577085504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137429,"user_name":"Cola_","can_delete":false,"product_type":"c1","uid":1264718,"ip_address":"","ucode":"99996D04CA4171","user_header":"https://static001.geekbang.org/account/avatar/00/13/4c/4e/91267714.jpg","comment_is_top":false,"comment_ctime":1569739444,"is_pvip":false,"replies":[{"id":"62786","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577092437,"ip_address":"","comment_id":137429,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569739444","product_id":100029501,"comment_content":"练习题<br>1.select count(*) as num,role_main,avg(hp_max) from heros where hp_max&gt;6000 group by role_main having num&gt;5 order by num desc;<br>2.select count(*) as num,round(avg(hp_max+mp_max),2),round(max(hp_max+mp_max),2),round(min(hp_max+mp_max),2) from heros where (hp_max+mp_max&gt;7000) group by attack_range order by num desc;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469087,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131802,"user_name":"森鱼","can_delete":false,"product_type":"c1","uid":1638587,"ip_address":"","ucode":"6AF86EB05088F4","user_header":"https://static001.geekbang.org/account/avatar/00/19/00/bb/25a29311.jpg","comment_is_top":false,"comment_ctime":1567911903,"is_pvip":false,"replies":[{"id":"53379","content":"慢慢来 多做就好了","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1570431084,"ip_address":"","comment_id":131802,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567911903","product_id":100029501,"comment_content":"课后题确实要写一下才会发现自己的错误在哪里，我竟然会忘了写FROM heros……","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466624,"discussion_content":"慢慢来 多做就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570431084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129789,"user_name":"Serendipity","can_delete":false,"product_type":"c1","uid":1370694,"ip_address":"","ucode":"E9C7B39BD8DCCD","user_header":"https://static001.geekbang.org/account/avatar/00/14/ea/46/9c9808a9.jpg","comment_is_top":false,"comment_ctime":1567251364,"is_pvip":false,"replies":[{"id":"63511","content":"两个SQL正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577515646,"ip_address":"","comment_id":129789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567251364","product_id":100029501,"comment_content":"<br>SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC<br>SELECT COUNT(*) as num, attack_range, ROUND(AVG(hp_max+mp_max), 2), ROUND(MAX(hp_max+mp_max),2), ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465651,"discussion_content":"两个SQL正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577515646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123099,"user_name":"海洋","can_delete":false,"product_type":"c1","uid":1369704,"ip_address":"","ucode":"F82635CDB2FB93","user_header":"https://static001.geekbang.org/account/avatar/00/14/e6/68/1871d6ba.jpg","comment_is_top":false,"comment_ctime":1565604793,"is_pvip":false,"replies":[{"id":"63879","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577602490,"ip_address":"","comment_id":123099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565604793","product_id":100029501,"comment_content":"作业：<br>mysql&gt; SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING COUNT(*) &gt; 5 ORDER  BY num DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br>3 rows in set (0.06 sec)<br><br>mysql&gt; SELECT ROUND(COUNT(*),2) as num, ROUND(AVG(hp_max+mp_max),2), ROUND(MAX(hp_max+mp_max),2), ROUND(MIN(hp_max+mp_max),2) FROM heros  WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>| num | ROUND(AVG(hp_max+mp_max),2) | ROUND(MAX(hp_max+mp_max),2) | ROUND(MIN(hp_max+mp_max),2) |<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>|  36 |                     8654.42 |                    11036.00 |                     7117.00 |<br>|  26 |                     7743.77 |                     8737.00 |                     7025.00 |<br>+-----+-----------------------------+-----------------------------+-----------------------------+<br>2 rows in set (0.06 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462539,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577602490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121495,"user_name":"冲","can_delete":false,"product_type":"c1","uid":1149914,"ip_address":"","ucode":"4191C8A4DF3840","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIk46cor5XVFTPZbPOnb7pViabgy450pobo46hRHFQz5nR5ocYRKIzC8vShic36vwa553H4Vj50x5wA/132","comment_is_top":false,"comment_ctime":1565148478,"is_pvip":false,"replies":[{"id":"63570","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577518518,"ip_address":"","comment_id":121495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565148478","product_id":100029501,"comment_content":"1.SELECT COUNT(*) AS num,AVG(hp_max),role_main from heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num desc<br>2.SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) <br>FROM heros<br>WHERE hp_max+mp_max &gt; 7000 GROUP BY attack_range ORDER BY num DESC  ","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461818,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577518518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120946,"user_name":"Reiser","can_delete":false,"product_type":"c1","uid":1078669,"ip_address":"","ucode":"E5DBBBA2F86FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/8d/c6a2a048.jpg","comment_is_top":false,"comment_ctime":1565016972,"is_pvip":true,"replies":[{"id":"63582","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577519015,"ip_address":"","comment_id":120946,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565016972","product_id":100029501,"comment_content":"SQL：<br>SELECT COUNT(*) AS num ,role_main,AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num &gt;5 ORDER BY num DESC;<br><br>SELECT COUNT(*) AS num, ROUND(AVG(mp_max+hp_max),2),ROUND(MAX(mp_max+hp_max),2),ROUND(MIN(mp_max+hp_max),2) FROM heros WHERE (mp_max+hp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC ;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461544,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577519015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115729,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1563706460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563706460","product_id":100029501,"comment_content":"作业：<br>1 &gt; SELECT COUNT(*) AS num, role_main, role_assist FROM heros<br>    -&gt; WHERE hp_max &gt; 6000<br>    -&gt; GROUP BY role_main<br>    -&gt; HAVING num &gt; 5<br>    -&gt; ORDER BY num DESC;<br>2 &gt; SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max),2) AS hm_avg, MAX(hp_max+mp_max) AS hm_max, MIN(hp_max+mp_max) AS hm_min FROM heros<br>    -&gt; WHERE (hp_max+mp_max) &gt; 7000<br>    -&gt; GROUP BY attack_range<br>    -&gt; ORDER BY num DESC;","like_count":0},{"had_liked":false,"id":115043,"user_name":"Fargo","can_delete":false,"product_type":"c1","uid":1018174,"ip_address":"","ucode":"434FC4C5D61750","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/3e/1976b66f.jpg","comment_is_top":false,"comment_ctime":1563460187,"is_pvip":false,"replies":[{"id":"63681","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528118,"ip_address":"","comment_id":115043,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563460187","product_id":100029501,"comment_content":"1. SELECT COUNT(*) as num , role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br><br>2. SELECT COUNT(*) as num, ROUND(AVG(hp_max+mp_max), 2), MAX(hp_max+mp_max), MIN(hp_max+mp_max) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY role_main ORDER BY num DESC;<br>+-----+------------------------------+--------------------+--------------------+<br>| num | ROUND(AVG(hp_max+mp_max), 2) | MAX(hp_max+mp_max) | MIN(hp_max+mp_max) |<br>+-----+------------------------------+--------------------+--------------------+<br>|  17 |                      7798.29 |               8898 |               7025 |<br>|  16 |                      8289.06 |               9290 |               7117 |<br>|  10 |                      9752.40 |              11036 |               8441 |<br>|   9 |                      7590.78 |               7770 |               7395 |<br>|   6 |                      8523.83 |               9843 |               7325 |<br>|   4 |                      7679.25 |               8054 |               7291 |<br>+-----+------------------------------+--------------------+--------------------+","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458943,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114573,"user_name":"蓝影闪电","can_delete":false,"product_type":"c1","uid":1276629,"ip_address":"","ucode":"0B7A42D79558E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/d5/dbcaadf0.jpg","comment_is_top":false,"comment_ctime":1563341825,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563341825","product_id":100029501,"comment_content":"SELECT role_main 主要定位,count(1) 数量,AVG(hp_max) 平均最大生命值 FROM heros<br>WHERE hp_max&gt;6000<br>GROUP BY role_main<br>HAVING count(1)&gt;5<br>ORDER BY COUNT(1) DESC;<br><br>SELECT ROUND(MIN(hp_max+mp_max),2) HPMP之和最小值,ROUND(MAX(hp_max+mp_max),2) HPMP之和最大值,ROUND(AVG(hp_max+mp_max),2) HPMP之和平均值, count(1) 英雄数量<br>FROM heros<br>WHERE (hp_max+mp_max)&gt;7000<br>GROUP BY attack_range<br>ORDER BY count(1) DESC;","like_count":0},{"had_liked":false,"id":113898,"user_name":"꯭J꯭I꯭N꯭🙃","can_delete":false,"product_type":"c1","uid":1524143,"ip_address":"","ucode":"7866E1904E02BB","user_header":"https://static001.geekbang.org/account/avatar/00/17/41/af/e5629318.jpg","comment_is_top":false,"comment_ctime":1563182271,"is_pvip":false,"replies":[{"id":"63699","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528505,"ip_address":"","comment_id":113898,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563182271","product_id":100029501,"comment_content":"#1筛选最大生命值大于6000的英雄，按照主要定位进行分组，选择分组英雄数量大于5的分组，按照分组英雄数从高到低进行排序，并显示每个分组的英雄数量、主要定位和平均最大生命值。<br>-- SELECT COUNT(*) as num, role_main, AVG(hp_max) <br>-- FROM heros <br>-- WHERE hp_max &gt; 6000<br>-- GROUP BY role_main<br>-- HAVING num &gt; 5<br>-- ORDER BY num DESC;<br><br>#2.筛选最大生命值与最大法力值之和大于7000的英雄，按照攻击范围来进行分组，显示分组的英雄数量，以及分组英雄的最大生命值与法力值之和的平均值、最大值和最小值，<br>#并按照分组英雄数从高到低进行排序，其中聚集函数的结果包括小数点后两位。<br>SELECT COUNT(*) as num, ROUND(AVG(DISTINCT (hp_max+mp_max)),2) ,ROUND(MAX(hp_max+mp_max), 2), ROUND(MIN(hp_max+mp_max), 2)<br>FROM heros<br>WHERE (hp_max+mp_max) &gt; 7000<br>GROUP BY attack_range<br>ORDER BY num desc;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458427,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113674,"user_name":"　Hail hydra","can_delete":false,"product_type":"c1","uid":1545230,"ip_address":"","ucode":"76DD13853E5888","user_header":"https://static001.geekbang.org/account/avatar/00/17/94/0e/0be827a5.jpg","comment_is_top":false,"comment_ctime":1563113895,"is_pvip":false,"replies":[{"id":"47683","content":"和嵌套查询不同，HAVING是用于GROUP BY之后的条件过滤","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1566902643,"ip_address":"","comment_id":113674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563113895","product_id":100029501,"comment_content":"having 是在原查询结果再次过滤 类似于 嵌套查询的意思吗","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458343,"discussion_content":"和嵌套查询不同，HAVING是用于GROUP BY之后的条件过滤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566902643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112785,"user_name":"Geek_70747e","can_delete":false,"product_type":"c1","uid":1309814,"ip_address":"","ucode":"A832E20E951A00","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdzXiawss5gGmlPicx9IiblxOTf4oSW16MWd696fue60zDA9NJTrGWenuLxS0COZZSzekV8QZGicyJOQ/132","comment_is_top":false,"comment_ctime":1562826188,"is_pvip":true,"replies":[{"id":"63975","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606559,"ip_address":"","comment_id":112785,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562826188","product_id":100029501,"comment_content":"作业：<br>1） SELECT<br>\tCOUNT(*) AS num,<br>\trole_main,<br>\tAVG(hp_max)<br>FROM<br>\theros<br>WHERE<br>\thp_max &gt; 6000<br>GROUP BY<br>\trole_main<br>HAVING<br>\tnum &gt; 5<br>ORDER BY<br>\tnum DESC;<br><br>2） SELECT<br>\tcount(*) AS num,<br>\tround(avg(hp_max + mp_max), 2),<br>\tround(max(hp_max + mp_max)),<br>\tround(min(hp_max + mp_max))<br>FROM<br>\theros<br>WHERE<br>\t(hp_max + mp_max) &gt; 7000<br>GROUP BY<br>\tattack_range<br>ORDER BY<br>\tnum DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457913,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112100,"user_name":"2525","can_delete":false,"product_type":"c1","uid":1180247,"ip_address":"","ucode":"2426488C258203","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/57/9b235866.jpg","comment_is_top":false,"comment_ctime":1562668752,"is_pvip":false,"replies":[{"id":"63732","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530781,"ip_address":"","comment_id":112100,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562668752","product_id":100029501,"comment_content":"作业: mysql <br>1.SELECT<br>\trole_main,<br>\tCOUNT(role_main) AS sum,<br>\tavg(hp_max) AS 平均最大生命值<br>FROM<br>\theros<br>WHERE<br>\thp_max &gt; 6000<br>GROUP BY<br>\trole_main<br>HAVING<br>\tsum &gt; 5<br>ORDER BY<br>\tsum DESC<br>2.SELECT<br>\tcount(attack_range) AS sum,<br>\tround(avg(hp_max + mp_max), 2),<br>\tround(max(hp_max + mp_max), 2),<br>\tround(min(hp_max + mp_max), 2)<br>FROM<br>\theros<br>WHERE<br>\t(hp_max + mp_max) &gt; 7000<br>GROUP BY<br>\tattack_range<br>ORDER BY<br>\tsum DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457576,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110970,"user_name":"雪飞鸿","can_delete":false,"product_type":"c1","uid":1012325,"ip_address":"","ucode":"65D7B030828809","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","comment_is_top":false,"comment_ctime":1562404573,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562404573","product_id":100029501,"comment_content":"MSSQL中HAVING子句不能使用SELECT中的聚合结果的别名","like_count":0},{"had_liked":false,"id":110639,"user_name":"一叶知秋","can_delete":false,"product_type":"c1","uid":1445189,"ip_address":"","ucode":"15A95FA86B7AE4","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/45/b88a1794.jpg","comment_is_top":false,"comment_ctime":1562308853,"is_pvip":false,"replies":[{"id":"63752","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577531144,"ip_address":"","comment_id":110639,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562308853","product_id":100029501,"comment_content":"交作业<br>1）MySQL SELECT COUNT(*) AS num, role_main, AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num;<br>执行结果：<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|   6 | 法师      |        6417 |<br>|  10 | 坦克      |      8312.4 |<br>|  17 | 战士      |        7028 |<br>+-----+-----------+-------------+<br>3 rows in set (0.00 sec)<br><br>2）MySQL  :<br>SELECT COUNT(*) AS num,<br>\t\t ROUND(AVG(hp_max+mp_max), 2) AS `average(hp+mp)`,<br>\t\t ROUND(MAX(hp_max+mp_max), 2) AS `maximum(hp+mp)`, <br>\t\t ROUND(MIN(hp_max+mp_max), 2) AS `minimum(hp+mp)`<br>FROM heros <br>WHERE (hp_max+mp_max)&gt;7000 <br>GROUP BY attack_range <br>ORDER BY num DESC;<br><br>执行结果：<br>| num | average(hp+mp) | maximum(hp+mp) | minimum(hp+mp) |<br>+-----+----------------+----------------+----------------+<br>|  36 |        8654.42 |       11036.00 |        7117.00 |<br>|  26 |        7743.77 |        8737.00 |        7025.00 |<br>+-----+----------------+----------------+----------------+<br>2 rows in set (0.00 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456981,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577531144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110414,"user_name":"虢國技醬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1562251355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562251355","product_id":100029501,"comment_content":"老师，“HAVING用于分组过滤”<br>这句是不是把HAVING说的有点小了，HAVING应该是用于中间表或者说临时表的筛选吧","like_count":0},{"had_liked":false,"id":109551,"user_name":"小美猴77","can_delete":false,"product_type":"c1","uid":1572790,"ip_address":"","ucode":"6275071FD0C832","user_header":"https://static001.geekbang.org/account/avatar/00/17/ff/b6/f84cf419.jpg","comment_is_top":false,"comment_ctime":1562056253,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562056253","product_id":100029501,"comment_content":"提问一下，老师，练习二里，能否将最大生命与最大法力之和 当做一个变量呢，类似下面这样<br>select  count(*) as num<br>(hp_max+mp_max) as sum_max<br>Round(AVG(sum_max))<br>Round(MAX(sum_max))<br>Round(MIN(sum_max))","like_count":0,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5926,"discussion_content":"我试过了 是不行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566539937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109539,"user_name":"xcoder","can_delete":false,"product_type":"c1","uid":1207135,"ip_address":"","ucode":"2C70ED36B4AC8E","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/5f/cec1e980.jpg","comment_is_top":false,"comment_ctime":1562053563,"is_pvip":false,"replies":[{"id":"63978","content":"对的 没问题","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606652,"ip_address":"","comment_id":109539,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562053563","product_id":100029501,"comment_content":"1. SELECT COUNT(*) AS num, AVG(hp_max),role_main FROM heros WHERE hp_max&gt;6000 <br>GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br>--    +-----+-------------+-----------+<br>| num | AVG(hp_max) | role_main |<br>+-----+-------------+-----------+<br>|  17    |        7028       | 战士      |<br>|  10    |      8312.4       | 坦克      |<br>|   6    |        6417        | 法师      |<br>+-----+-------------+-----------+<br><br>2.  SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2),MAX(hp_max+mp_max),MIN(hp_max+mp_max),<br>attack_range FROM heros WHERE hp_max+mp_max&gt;7000 GROUP BY attack_range ORDER BY num DESC;<br>--   +-----+-----------------------------+--------------------+--------------------+--------------+<br>| num | ROUND(AVG(hp_max+mp_max),2) | MAX(hp_max+mp_max) | MIN(hp_max+mp_max) | attack_range |<br>+-----+-----------------------------+--------------------+--------------------+--------------+<br>|  36 |                     8654.42 |              11036 |               7117 | 近战         |<br>|  26 |                     7743.77 |               8737 |               7025 | 远程         |<br>+-----+-----------------------------+--------------------+--------------------+--------------+<br>我想我的应该没有什么问题。。。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456455,"discussion_content":"对的 没问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109106,"user_name":"leol","can_delete":false,"product_type":"c1","uid":1303229,"ip_address":"","ucode":"7FA42EAAFBAEB5","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/bd/b65420ae.jpg","comment_is_top":false,"comment_ctime":1561962975,"is_pvip":false,"replies":[{"id":"63951","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605735,"ip_address":"","comment_id":109106,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561962975","product_id":100029501,"comment_content":"虽然晚一节，作业还是要交的<br>select count(*) as num,role_main ,avg(hp_max)  from heros where hp_max&gt;6000 <br>group by role_main having num&gt;5 order by num desc ;<br><br>select count(*) as num ,round(avg(hp_max+mp_max),2),round(max(hp_max+mp_max),2),round(min(hp_max+mp_max),2)  from heros where hp_max+mp_max&gt;7000<br>group by attack_range  order by num desc;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456245,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108864,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1561905017,"is_pvip":false,"replies":[{"id":"63961","content":"Good Job 赞下坚持做作业的同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577605973,"ip_address":"","comment_id":108864,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561905017","product_id":100029501,"comment_content":"SELECT COUNT(*) as num, role_main, AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br>+-----+-----------+-------------+<br>| num | role_main | AVG(hp_max) |<br>+-----+-----------+-------------+<br>|  17 | 战士      |        7028 |<br>|  10 | 坦克      |      8312.4 |<br>|   6 | 法师      |        6417 |<br>+-----+-----------+-------------+<br>3 rows in set (0.00 sec)<br><br><br>SELECT COUNT(*) as num, attack_range, ROUND(AVG(hp_max+mp_max),2) as avg_, ROUND(MAX(hp_max+mp_max),2) as max_, ROUND(MIN(hp_max+mp_max),2) as min_ FROM heros WHERE hp_max + mp_max &gt; 7000 GROUP BY attack_range ORDER BY num DESC;<br>+-----+--------------+---------+----------+---------+<br>| num | attack_range | avg_    | max_     | min_    |<br>+-----+--------------+---------+----------+---------+<br>|  36 | 近战         | 8654.42 | 11036.00 | 7117.00 |<br>|  26 | 远程         | 7743.77 |  8737.00 | 7025.00 |<br>+-----+--------------+---------+----------+---------+<br>2 rows in set (0.00 sec)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456141,"discussion_content":"Good Job 赞下坚持做作业的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108818,"user_name":"莫莫","can_delete":false,"product_type":"c1","uid":1170881,"ip_address":"","ucode":"D3A70E02A100F1","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/c1/e73d9bf1.jpg","comment_is_top":false,"comment_ctime":1561889610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561889610","product_id":100029501,"comment_content":"1、<br>SELECT COUNT(*) AS `sum`,role_main AS &#39;主要定位&#39;,AVG(hp_max) AS &#39;最大生命值&#39; FROM heros<br>WHERE hp_max&gt;6000 GROUP BY role_main HAVING `sum`&gt;5 ORDER BY `sum` DESC<br><br>2、<br>SELECT COUNT(*) AS &#39;英雄数量&#39;,ROUND(AVG(hp_max+mp_max),2) AS `avg`,ROUND(MAX(hp_max+mp_max),2) AS `max`,ROUND(MIN(hp_max+mp_max),2) AS `min`<br>FROM heros<br>WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range","like_count":0},{"had_liked":false,"id":108774,"user_name":"未来的胡先森","can_delete":false,"product_type":"c1","uid":1234682,"ip_address":"","ucode":"AFF193AC0E2E6C","user_header":"https://static001.geekbang.org/account/avatar/00/12/d6/fa/1f5bf642.jpg","comment_is_top":false,"comment_ctime":1561878896,"is_pvip":false,"replies":[{"id":"63965","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606068,"ip_address":"","comment_id":108774,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561878896","product_id":100029501,"comment_content":"交作业了<br>SELECT COUNT(*),role_main ,AVG(hp_max)<br>FROM heros<br>WHERE hp_max&gt;6000<br>GROUP BY role_main<br>HAVING COUNT(*)&gt;5<br>ORDER BY COUNT(*) DESC;<br><br>SELECT COUNT(*),ROUND( AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2)<br>FROM heros<br>WHERE hp_max+mp_max&gt;7000<br>GROUP BY attack_range<br>ORDER BY  COUNT(*) DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456110,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108763,"user_name":"Neo","can_delete":false,"product_type":"c1","uid":1070189,"ip_address":"","ucode":"A2B2E2F8780557","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/6d/c947ef55.jpg","comment_is_top":false,"comment_ctime":1561877127,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561877127","product_id":100029501,"comment_content":"1. SELECT COUNT(*) AS hero_num, role_main, AVG(hp_max) FROM heros where hp_max &gt; 6000 GROUP BY role_main HAVING hero_num &gt; 5;<br>2. SELECT COUNT(*) AS hero_num, ROUND(AVG(hp_max+mp_max), 2), MAX(hp_max+mp_max), MIN(hp_max+mp_max) FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_max ORDER BY  hero_num ASC;","like_count":0},{"had_liked":false,"id":108685,"user_name":"Hoo-Ah","can_delete":false,"product_type":"c1","uid":1306913,"ip_address":"","ucode":"823093A6C7DEE7","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/21/52e8267b.jpg","comment_is_top":false,"comment_ctime":1561855661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561855661","product_id":100029501,"comment_content":"SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...","like_count":0},{"had_liked":false,"id":108582,"user_name":"田佳伟","can_delete":false,"product_type":"c1","uid":1034087,"ip_address":"","ucode":"D31C9799F383D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/67/0077314b.jpg","comment_is_top":false,"comment_ctime":1561811347,"is_pvip":false,"replies":[{"id":"63970","content":"会的 后面有讲到","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606150,"ip_address":"","comment_id":108582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561811347","product_id":100029501,"comment_content":"老师，看了前几节课，讲述的都是sql的基本用法，没有涉及到性能问题，其实很多方式是不能用在大流量的生产环境的，以后的章节会涉及到高效查询的内容吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456051,"discussion_content":"会的 后面有讲到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108581,"user_name":"psnail","can_delete":false,"product_type":"c1","uid":1189122,"ip_address":"","ucode":"D30553D8CE9CCE","user_header":"https://static001.geekbang.org/account/avatar/00/12/25/02/93864330.jpg","comment_is_top":false,"comment_ctime":1561810689,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561810689","product_id":100029501,"comment_content":"如果将 select ... from ... where ...group by ... having..改为select ... (select. from. where. group by. )...where...是不是一样？不知道那种效率高？优化器处理逻辑是否一样？","like_count":0,"discussions":[{"author":{"id":1234682,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d6/fa/1f5bf642.jpg","nickname":"未来的胡先森","note":"","ucode":"AFF193AC0E2E6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649,"discussion_content":"子集用了分组后，外部查询使用 where 也是会报错的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561878814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108577,"user_name":"微凉","can_delete":false,"product_type":"c1","uid":1178156,"ip_address":"","ucode":"F6BD0AE11AE224","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/2c/9a0c45e6.jpg","comment_is_top":false,"comment_ctime":1561809124,"is_pvip":false,"replies":[{"id":"63983","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606809,"ip_address":"","comment_id":108577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561809124","product_id":100029501,"comment_content":"1.SELECT<br>\tCOUNT(*) AS num,<br>\trole_main,<br>\tAVG(hp_max)<br>FROM<br>\theros<br>WHERE<br>\thp_max &gt; 6000<br>GROUP BY<br>\trole_main<br>HAVING<br>\tnum &gt; 5<br>ORDER BY<br>\tnum DESC<br><br>2.SELECT<br>\tCOUNT(*) AS num,<br>\tROUND(MAX(hp_max + mp_max), 2),<br>\tROUND(AVG(hp_max + mp_max), 2),<br>\tROUND(MIN(hp_max + mp_max), 2)<br>FROM<br>\theros<br>WHERE<br>\thp_max + mp_max &gt; 7000<br>GROUP BY<br>\tattack_range<br>ORDER BY<br>\tnum DESC","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456048,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108565,"user_name":"遇见阳光","can_delete":false,"product_type":"c1","uid":1203576,"ip_address":"","ucode":"378E5D37B3CD0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/78/f011d586.jpg","comment_is_top":false,"comment_ctime":1561802912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561802912","product_id":100029501,"comment_content":"老师，您好，我有个问题问下: 按照sql执行顺序 having在select之前，按照理论来讲having应该不能使用select中的别名  但是实际是可以的。请问这是什么原因","like_count":0},{"had_liked":false,"id":108495,"user_name":"OperaX","can_delete":false,"product_type":"c1","uid":1510551,"ip_address":"","ucode":"66947CD04E3B3E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia3yumk409E65JIlGoreva1Q25icTks0XB0EDC7WJ5V0z6zuvgGkI2Zrh5cBXGS5Hea8A/132","comment_is_top":false,"comment_ctime":1561784087,"is_pvip":true,"replies":[{"id":"39292","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561794601,"ip_address":"","comment_id":108495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561784087","product_id":100029501,"comment_content":"SELECT<br>\tCOUNT(*) num,<br>\trole_main,<br>\tAVG( hp_max ) hp_avg <br>FROM<br>\theros <br>WHERE<br>\thp_max &gt; 6000 <br>GROUP BY<br>\trole_main <br>HAVING<br>\tCOUNT(*) &gt; 5 <br>ORDER BY<br>\tCOUNT(num) DESC ;<br><br>SELECT<br>\tCOUNT(*) num,<br>\tROUND(AVG(hp_max + mp_max), 2),<br>\tROUND(MAX(hp_max + mp_max), 2),<br>\tROUND(MIN(hp_max + mp_max), 2)<br>FROM<br>\theros<br>WHERE<br>\t(hp_max + mp_max) &gt; 7000<br>GROUP BY<br>\tattack_range<br>ORDER BY<br>\tCOUNT(*) desc","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456006,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561794601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108406,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1561745072,"is_pvip":false,"replies":[{"id":"39294","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561794664,"ip_address":"","comment_id":108406,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561745072","product_id":100029501,"comment_content":"1.select count(*) as num,avg(hp_max),role_main from heros where hp_max&gt;6000  group by role_main having num&gt;5 order by num desc;<br><br>2.select count(*) as num,round(max(hp_max+mp_max),2)  as max,round(avg(hp_max+mp_max),2) as avg,round(min(hp_max+mp_max),2) as min from heros where (hp_max+mp_max)&gt;7000 group by attack_range order by num desc;<br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455956,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561794664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108394,"user_name":"张昌","can_delete":false,"product_type":"c1","uid":1510451,"ip_address":"","ucode":"836821A2D3F783","user_header":"https://static001.geekbang.org/account/avatar/00/17/0c/33/5b6cdb06.jpg","comment_is_top":false,"comment_ctime":1561737328,"is_pvip":false,"replies":[{"id":"39295","content":"聚集函数主要针对数据汇总，是从多个行数据中计算出一个结果，当然也可以用于分组数据的汇总统计","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561794766,"ip_address":"","comment_id":108394,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561737328","product_id":100029501,"comment_content":"总结<br>聚集函数 主要针对数据分组<br>主要有分组，最大，最小，平均，计数<br>区分.having和where<br>前者对每一行数据筛选<br>后者对分组筛选","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455949,"discussion_content":"聚集函数主要针对数据汇总，是从多个行数据中计算出一个结果，当然也可以用于分组数据的汇总统计","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561794766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108380,"user_name":"🄽🄸🅇🅄🅂","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1561733856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561733856","product_id":100029501,"comment_content":"我有几个问题想请教一下老师:<br>1. SELECT attack_range,hp_max+mp_max AS hp_mp, <br>COUNT(*) AS num, ROUND(AVG(hp_max+mp_max),2) AS avg_hp_mp, <br>MAX(hp_max+mp_max) AS hm_max,MIN(hp_max+mp_max) AS hm_min<br>FROM heros<br>GROUP BY `attack_range` <br>HAVING hp_max+mp_max&gt;7000<br>ORDER BY num DESC<br>执行这条语句的时候, 会报错Unknown column &#39;hp_max&#39; in &#39;having clause&#39;, 这样的话, HAVING就没办法进行WHERE操作了, 但是老师在文中说, HAVING支持所有的WHERE操作, 这个是否有冲突? <br>2. 今天刚好遇到一个问题, 用到SQL自定义函数, 学到了SQL中的变量, 于是就在第二题中尝试使用:<br>SELECT attack_range, @hp_mp:=hp_max+mp_max, COUNT(*) AS num, <br>ROUND(AVG(@hp_mp),2) AS avg_hp_mp, <br>MAX(@hp_mp) AS hm_max,MIN(@hp_mp) AS hm_min<br>FROM heros<br>WHERE @hp_mp&gt;7000<br>GROUP BY `attack_range` <br>ORDER BY num DESC<br>结果发现, num这列, 加起来的和, 刚好是heros表中的记录总数, 好像WHERE的筛选没有起到应有的作用, 请老师指点下","like_count":0},{"had_liked":false,"id":108352,"user_name":"Fred","can_delete":false,"product_type":"c1","uid":1585721,"ip_address":"","ucode":"DBA8999FE43E4F","user_header":"","comment_is_top":false,"comment_ctime":1561726645,"is_pvip":false,"replies":[{"id":"63984","content":"加油~ Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606830,"ip_address":"","comment_id":108352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561726645","product_id":100029501,"comment_content":"SELECT COUNT(*) AS num, role_main, AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br>SELECT COUNT(*) AS num, ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM heros WHERE hp_max+mp_max&gt;7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455931,"discussion_content":"加油~ Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108331,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1561720778,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561720778","product_id":100029501,"comment_content":"在用dbeaver的时候，即使选的是大写的SELECT也会被转换成小写的select不知道是不是默认设置了。。。😅 ","like_count":0},{"had_liked":false,"id":108300,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1561715272,"is_pvip":false,"replies":[{"id":"63986","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577606856,"ip_address":"","comment_id":108300,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561715272","product_id":100029501,"comment_content":"作业:<br><br>1. <br><br>select count(*) as num,role_main,AVG(hp_max) from heros where hp_max&gt;6000 group by role_main having num&gt;5 order by num desc;<br><br>num|role_main|AVG(hp_max)|<br>---|---------|-----------|<br> 17|战士       |       7028|<br> 10|坦克       |     8312.4|<br>  6|法师       |       6417|<br><br>2. <br><br>select count(*) as num,round(avg(hp_max+mp_max),2) as avgnum,round(max(hp_max+mp_max),2) as maxnum,round(min(hp_max+mp_max),2) as minnum from heros where (hp_max+mp_max)&gt;7000 group by attack_range  order by num desc;<br><br>num|avgnum |maxnum|minnum|<br>---|-------|------|------|<br> 36|8654.42| 11036|  7117|<br> 26|7743.77|  8737|  7025|","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455910,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577606856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108279,"user_name":"zjajxzg","can_delete":false,"product_type":"c1","uid":1441304,"ip_address":"","ucode":"EF2FBD463F266B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKuLsA1AAjUSO7oPHIqbA8f8slVIUw7nhdiaOI4nBYH6RxlyxXyFNe2Bc0g7yMoMHxnlh2mf43aVXw/132","comment_is_top":false,"comment_ctime":1561711479,"is_pvip":false,"replies":[{"id":"63989","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577607002,"ip_address":"","comment_id":108279,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561711479","product_id":100029501,"comment_content":"1、SELECT count(*), role_main, avg(hp_max)<br>  FROM heros<br> WHERE hp_max &gt; 6000<br> GROUP BY role_main<br> HAVING COUNT(*) &gt; 5<br> ORDER BY COUNT(*) DESC<br><br> 2、SELECT COUNT(*), ROUND(AVG(hp_max + mp_max), 2), ROUND((hp_max + mp_max), 2), ROUND(MIN(hp_max + mp_max), 2)<br>   FROM heros<br>  WHERE (hp_max + mp_max) &gt; 7000<br>\tGROUP BY attack_range<br>\tORDER BY COUNT(*) DESC","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455897,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577607002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108276,"user_name":"Zh","can_delete":false,"product_type":"c1","uid":1388911,"ip_address":"","ucode":"8B0032EC876B6B","user_header":"","comment_is_top":false,"comment_ctime":1561711189,"is_pvip":false,"replies":[{"id":"63990","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577607020,"ip_address":"","comment_id":108276,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561711189","product_id":100029501,"comment_content":"1:<br>SELECT COUNT(*) AS num,hp_max,AVG(hp_max) AS hp_max_avg FROM learn.heros WHERE hp_max&gt; 6000 GROUP BY role_main HAVING num&gt; 5 ORDER BY num DESC;<br>2:<br>SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) FROM learn.heros WHERE hp_max+mp_max&gt; 7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455896,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577607020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108207,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1561697270,"is_pvip":false,"replies":[{"id":"63994","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577607078,"ip_address":"","comment_id":108207,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561697270","product_id":100029501,"comment_content":"SELECT COUNT(*) AS num,role_main,AVG(hp_max) FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC ;<br><br>SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2),MAX(hp_max+mp_max),MIN(hp_max+mp_max) FROM heros WHERE (hp_max+mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC ;<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455870,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577607078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108179,"user_name":"月牙天冲","can_delete":false,"product_type":"c1","uid":1079538,"ip_address":"","ucode":"E316AA9E23D554","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/f2/d8933ff9.jpg","comment_is_top":false,"comment_ctime":1561691314,"is_pvip":false,"replies":[{"id":"39214","content":"正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561700142,"ip_address":"","comment_id":108179,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561691314","product_id":100029501,"comment_content":"1. SELECT COUNT(*) num ,role_main,AVG(hp_max) FROM heros WHERE hp_max&gt;6000 GROUP BY role_main  HAVING num&gt;5 ORDER BY num DESC;<br><br>2. SELECT COUNT(*) num,ROUND(AVG(hp_max+mp_max),2),ROUND(MAX(hp_max+mp_max),2),ROUND(MIN(hp_max+mp_max),2) <br>FROM heros WHERE hp_max+mp_max&gt;7000 GROUP BY attack_range ORDER BY num DESC;","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455860,"discussion_content":"正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561700142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108158,"user_name":"[耶]友超","can_delete":false,"product_type":"c1","uid":1400962,"ip_address":"","ucode":"890572F77C3670","user_header":"https://static001.geekbang.org/account/avatar/00/15/60/82/9a43504b.jpg","comment_is_top":false,"comment_ctime":1561688421,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1561688421","product_id":100029501,"comment_content":"叫作业：<br>1.SELECT COUNT(*) AS num,role_main,role_assist,AVG(hp_max) AS 平均最大生命 FROM heros WHERE hp_max&gt;6000 GROUP BY role_main HAVING num&gt;5 ORDER BY num DESC;<br><br>2.SELECT COUNT(*) AS num,ROUND(AVG(hp_max+mp_max),2) AS 平均值,ROUND(MAX(hp_max+mp_max),2) AS 最大值,ROUND(MIN(hp_max+mp_max),2) AS 最小值 FROM heros WHERE (hp_max+mp_max)&gt;7000 GROUP BY attack_range ORDER BY num DESC;<br><br>","like_count":0},{"had_liked":false,"id":108156,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1561687865,"is_pvip":false,"replies":[{"id":"63995","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577607093,"ip_address":"","comment_id":108156,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561687865","product_id":100029501,"comment_content":"mysql&gt; SELECT COUNT(*) AS num, role_main, AVG(hp_max) AS avg_hp_max FROM heros WHERE hp_max &gt; 6000 GROUP BY role_main HAVING num &gt; 5 ORDER BY num DESC;<br>+-----+-----------+------------+<br>| num | role_main | avg_hp_max |<br>+-----+-----------+------------+<br>|  17 | 战士      |       7028 |<br>|  10 | 坦克      |     8312.4 |<br>|   6 | 法师      |       6417 |<br>+-----+-----------+------------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; SELECT COUNT(*) AS num, attack_range, ROUND(AVG(hp_max + mp_max), 2) AS avg_hp_mp, MAX(hp_max + mp_max) AS max_hp_mp, MIN(hp_max + mp_max) AS min_hp_mp FROM heros WHERE (hp_max + mp_max) &gt; 7000 GROUP BY attack_range ORDER BY num DESC;<br>+-----+--------------+-----------+-----------+-----------+<br>| num | attack_range | avg_hp_mp | max_hp_mp | min_hp_mp |<br>+-----+--------------+-----------+-----------+-----------+<br>|  36 | 近战         |   8654.42 |     11036 |      7117 |<br>|  26 | 远程         |   7743.77 |      8737 |      7025 |<br>+-----+--------------+-----------+-----------+-----------+<br>2 rows in set (0.00 sec)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455845,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577607093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108132,"user_name":"Samson","can_delete":false,"product_type":"c1","uid":1572899,"ip_address":"","ucode":"2114D3E2E8C5BE","user_header":"https://static001.geekbang.org/account/avatar/00/18/00/23/17868694.jpg","comment_is_top":false,"comment_ctime":1561685490,"is_pvip":false,"replies":[{"id":"39190","content":"已更正","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1561691912,"ip_address":"","comment_id":108132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561685490","product_id":100029501,"comment_content":"SQL: SELECT COUNT(*), role_main, role_assist FROM heros GROUP BY role_main, role_assist ORDER BY num DESC<br><br>这个语句中，num是从何而来的呢？是不是忘记在COUNT(*)后面忘记加AS num了？还是本就不比加，如果不必加的话，又是为什么呢？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455835,"discussion_content":"已更正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561691912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108130,"user_name":"15900513463","can_delete":false,"product_type":"c1","uid":1210696,"ip_address":"","ucode":"4B7E1F2044C6A9","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/48/36a07912.jpg","comment_is_top":false,"comment_ctime":1561685320,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561685320","product_id":100029501,"comment_content":"回复楼上，其实计算最大，最小值不需要使用ROUND()函数的，这样只会额外增加内存开销。","like_count":0,"discussions":[{"author":{"id":1388911,"avatar":"","nickname":"Zh","note":"","ucode":"8B0032EC876B6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571,"discussion_content":"虽然可以看到mp_max和hp_max都是没有小数的值，但在表中他们存储的类型是float，如果不用ROUND()，如何保证float类型的值只保存2位小数？我反倒觉得应该用ROUND()函数。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561711467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108129,"user_name":"苏籍","can_delete":false,"product_type":"c1","uid":1396252,"ip_address":"","ucode":"4FA289E084B789","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erYNBIwAj3KdIXaXbeMBUjTMz31zAToHIJSdo7oQk8bfsibwViaLobVQ8miatwBlC5spLS9kVCzHMjUA/132","comment_is_top":false,"comment_ctime":1561685299,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1561685299","product_id":100029501,"comment_content":"HAVING 后面用了NUM这个统计字段，是因为前面SELECT count（*）AS NUM吗，这个是在哪个阶段进行的呢，我记得SELECT阶段在GROUP BY之后呀","like_count":0,"discussions":[{"author":{"id":1443117,"avatar":"","nickname":"witluo","note":"","ucode":"3D9608C3DDDD95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1572,"discussion_content":"老师您好， SELECT  和 GROUP BY  ，HAVING 到底哪个先执行？   如果 GROUP BY  ，HAVING 先执行的话，应该看不到SELECT字段别名。  求老师解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562714933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000060,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","nickname":"🄽🄸🅇🅄🅂","note":"","ucode":"853763C229A5AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589,"discussion_content":"SELECT attack_range, hp_max+mp_max AS hm_max \nFROM heros \nWHERE hp_max+mp_max>7000 \nHAVING hm_max>7000\nORDER BY hm_max DESC\n在做题中, 遇到了个错误, 然后就想到, 会不会是这样:\n执行WHERE的时候, 如果使用字段别名, 即hm_max, \n会报错: Unknown column &#39;hm_max&#39; in &#39;where clause&#39;\n于是, 就把WHERE修改为hp_max+mp_max>7000, \n这时WHERE没有报错, 说明SELECT是在WHERE之后执行的, \n而HAVING和ORDER BY使用别名hm_max没报错, \n说明HAVING和ORDER BY是在SELECT之后执行的?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561734171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000060,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","nickname":"🄽🄸🅇🅄🅂","note":"","ucode":"853763C229A5AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588,"discussion_content":"在学习中我也想到这个问题了, 希望老师能解答一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561731088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}