{"id":232412,"title":"åŠ é¤ | ZABåè®®ï¼ˆä¸€ï¼‰ï¼šä¸»èŠ‚ç‚¹å´©æºƒäº†ï¼Œæ€ä¹ˆåŠï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éŸ©å¥ã€‚</p><p>å’±ä»¬éƒ½çŸ¥é“ï¼Œç³»ç»Ÿåœ¨è¿è¡Œä¸­ï¼Œä¸å¯é¿å…ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚è¿›ç¨‹å´©æºƒäº†ã€æœåŠ¡å™¨æ­»æœºäº†ï¼Œè¿™äº›é—®é¢˜ä¼šå¯¼è‡´å¾ˆä¸¥é‡çš„åæœï¼Œè®©ç³»ç»Ÿæ²¡åŠæ³•è¿è¡Œã€‚å­¦å®Œäº†15è®²åï¼Œä½ åº”è¯¥è¿˜è®°å¾—ï¼Œåœ¨ZABä¸­ï¼Œå†™è¯·æ±‚æ˜¯å¿…é¡»åœ¨ä¸»èŠ‚ç‚¹ä¸Šå¤„ç†çš„ï¼Œè€Œä¸”ææ¡ˆçš„å¹¿æ’­å’Œæäº¤ï¼Œä¹Ÿæ˜¯ç”±ä¸»èŠ‚ç‚¹æ¥å®Œæˆçš„ã€‚æ—¢ç„¶ä¸»èŠ‚ç‚¹é‚£ä¹ˆé‡è¦ï¼Œå¦‚æœå®ƒçªç„¶å´©æºƒå®•æœºäº†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯é€‰ä¸¾å‡ºæ–°çš„é¢†å¯¼è€…ï¼ˆä¹Ÿå°±æ˜¯æ–°çš„ä¸»èŠ‚ç‚¹ï¼‰ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œé¢†å¯¼è€…é€‰ä¸¾ï¼Œå…³ä¹ç€èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›å’Œé›†ç¾¤å¯ç”¨æ€§ï¼Œæ˜¯ZABåè®®éå¸¸æ ¸å¿ƒçš„è®¾è®¡ä¹‹ä¸€ã€‚ä½ æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰é¢†å¯¼è€…é€‰ä¸¾ï¼Œä¸»èŠ‚ç‚¹æ•…éšœäº†ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æ— æ³•å†™å…¥äº†ï¼Œè¿™å°†æ˜¯æå…¶ä¸¥é‡çš„ç¾éš¾æ€§æ•…éšœã€‚</p><p>è€Œå¯¹ä½ æ¥è¯´ï¼Œç†è§£é¢†å¯¼è€…é€‰ä¸¾ï¼ˆä¹Ÿå°±æ˜¯å¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾ï¼ŒFast Leader Electionï¼‰ï¼Œèƒ½æ›´åŠ æ·±åˆ»åœ°ç†è§£ZABåè®®ï¼Œå¹¶åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæ¸¸åˆƒæœ‰ä½™åœ°å¤„ç†é›†ç¾¤çš„å¯ç”¨æ€§é—®é¢˜ã€‚æ¯”å¦‚å¦‚æœå†™è¯·æ±‚æŒç»­å¤±è´¥ï¼Œå¯ä»¥å…ˆæ’æŸ¥ä¸‹é›†ç¾¤çš„èŠ‚ç‚¹çŠ¶æ€ã€‚</p><p>æ—¢ç„¶é¢†å¯¼è€…é€‰ä¸¾è¿™ä¹ˆé‡è¦ï¼Œé‚£ä¹ˆZABæ˜¯å¦‚ä½•é€‰ä¸¾é¢†å¯¼è€…çš„å‘¢ï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„å­¦ä¹ ã€‚</p><h2>ZABå¦‚ä½•é€‰ä¸¾é¢†å¯¼è€…ï¼Ÿ</h2><p>æ—¢ç„¶è¦é€‰ä¸¾é¢†å¯¼è€…ï¼Œé‚£å°±æ¶‰åŠæˆå‘˜èº«ä»½å˜æ›´ï¼Œé‚£ä¹ˆåœ¨ZABä¸­ï¼Œæ”¯æŒå“ªäº›æˆå‘˜èº«ä»½å‘¢ï¼Ÿ</p><h3>æœ‰å“ªäº›æˆå‘˜èº«ä»½ï¼Ÿ</h3><p>ZABæ”¯æŒ3ç§æˆå‘˜èº«ä»½ï¼ˆé¢†å¯¼è€…ã€è·Ÿéšè€…ã€è§‚å¯Ÿè€…ï¼‰ã€‚</p><!-- [[[read_end]]] --><ul>\n<li>\n<p>é¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼š ä½œä¸ºä¸»ï¼ˆPrimaryï¼‰èŠ‚ç‚¹ï¼Œåœ¨åŒä¸€æ—¶é—´é›†ç¾¤åªä¼šæœ‰ä¸€ä¸ªé¢†å¯¼è€…ã€‚éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰çš„å†™è¯·æ±‚éƒ½å¿…é¡»åœ¨é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>è·Ÿéšè€…ï¼ˆFollowerï¼‰ï¼šä½œä¸ºå¤‡ä»½ï¼ˆBackupï¼‰èŠ‚ç‚¹ï¼Œ é›†ç¾¤å¯ä»¥æœ‰å¤šä¸ªè·Ÿéšè€…ï¼Œå®ƒä»¬ä¼šå“åº”é¢†å¯¼è€…çš„å¿ƒè·³ï¼Œå¹¶å‚ä¸é¢†å¯¼è€…é€‰ä¸¾å’Œææ¡ˆæäº¤çš„æŠ•ç¥¨ã€‚éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œè·Ÿéšè€…å¯ä»¥ç›´æ¥å¤„ç†å¹¶å“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„è¯»è¯·æ±‚ï¼Œä½†å¯¹äºå†™è¯·æ±‚ï¼Œè·Ÿéšè€…éœ€è¦å°†å®ƒè½¬å‘ç»™é¢†å¯¼è€…å¤„ç†ã€‚</p>\n</li>\n<li>\n<p>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼šä½œä¸ºå¤‡ä»½ï¼ˆBackupï¼‰èŠ‚ç‚¹ï¼Œç±»ä¼¼è·Ÿéšè€…ï¼Œä½†æ˜¯æ²¡æœ‰æŠ•ç¥¨æƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè§‚å¯Ÿè€…ä¸å‚ä¸é¢†å¯¼è€…é€‰ä¸¾å’Œææ¡ˆæäº¤çš„æŠ•ç¥¨ã€‚ä½ å¯ä»¥å¯¹æ¯”ç€Paxosä¸­çš„å­¦ä¹ è€…æ¥ç†è§£ã€‚</p>\n</li>\n</ul><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ZABæ”¯æŒ3ç§æˆå‘˜èº«ä»½ï¼Œä½†æ˜¯å®ƒå®šä¹‰äº†4ç§æˆå‘˜çŠ¶æ€ã€‚</p><ul>\n<li>LOOKINGï¼šé€‰ä¸¾çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸‹çš„èŠ‚ç‚¹è®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰é¢†å¯¼è€…ï¼Œä¼šå‘èµ·é¢†å¯¼è€…é€‰ä¸¾ã€‚</li>\n<li>FOLLOWING ï¼šè·Ÿéšè€…çŠ¶æ€ï¼Œæ„å‘³ç€å½“å‰èŠ‚ç‚¹æ˜¯è·Ÿéšè€…ã€‚</li>\n<li>LEADING ï¼šé¢†å¯¼è€…çŠ¶æ€ï¼Œæ„å‘³ç€å½“å‰èŠ‚ç‚¹æ˜¯é¢†å¯¼è€…ã€‚</li>\n<li>OBSERVINGï¼š è§‚å¯Ÿè€…çŠ¶æ€ï¼Œæ„å‘³ç€å½“å‰èŠ‚ç‚¹æ˜¯è§‚å¯Ÿè€…ã€‚</li>\n</ul><p>ä¸ºä»€ä¹ˆå¤šäº†ä¸€ç§æˆå‘˜çŠ¶æ€å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºZABæ”¯æŒé¢†å¯¼è€…é€‰ä¸¾ï¼Œåœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠäº†ä¸€ä¸ªè¿‡æ¸¡çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯é€‰ä¸¾çŠ¶æ€ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»äº†è§£äº†æˆå‘˜èº«ä»½ï¼Œé‚£ä¹ˆåœ¨ZABä¸­æ˜¯å¦‚ä½•å˜æ›´æˆå‘˜èº«ä»½ï¼Œæ¥é€‰ä¸¾é¢†å¯¼è€…å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹é¢†å¯¼è€…çš„å…·ä½“é€‰ä¸¾è¿‡ç¨‹ã€‚</p><h3>å¦‚ä½•é€‰ä¸¾ï¼Ÿ</h3><p>ä¸ºäº†å¸®ä½ æ›´å¥½åœ°ç†è§£ZABçš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­æ¼”ç¤ºä¸€ä¸‹ï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å’Œæ›´å®¹æ˜“ç†è§£ï¼ˆæˆ‘ä»¬èšç„¦æœ€æ ¸å¿ƒçš„é¢†å¯¼è€…PKï¼‰ï¼Œå‡è®¾æŠ•ç¥¨ä¿¡æ¯çš„æ ¼å¼æ˜¯&lt;proposedLeader, proposedEpoch, proposedLastZxidï¼Œnode&gt;ï¼Œå…¶ä¸­ï¼š</p><ul>\n<li>proposedLeaderï¼ŒèŠ‚ç‚¹æè®®çš„ï¼Œé¢†å¯¼è€…çš„é›†ç¾¤IDï¼Œä¹Ÿå°±æ˜¯åœ¨é›†ç¾¤é…ç½®ï¼ˆæ¯”å¦‚myidé…ç½®æ–‡ä»¶ï¼‰æ—¶æŒ‡å®šçš„IDã€‚</li>\n<li>proposedEpochï¼ŒèŠ‚ç‚¹æè®®çš„ï¼Œé¢†å¯¼è€…çš„ä»»æœŸç¼–å·ã€‚</li>\n<li>proposedLastZxidï¼ŒèŠ‚ç‚¹æè®®çš„ï¼Œé¢†å¯¼è€…çš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯æœ€æ–°ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦ï¼‰ã€‚</li>\n<li>nodeï¼ŒæŠ•ç¥¨çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚èŠ‚ç‚¹Bã€‚</li>\n</ul><p>å‡è®¾ä¸€ä¸ªZooKeeperé›†ç¾¤ï¼Œç”±èŠ‚ç‚¹Aã€Bã€Cç»„æˆï¼Œå…¶ä¸­èŠ‚ç‚¹Aæ˜¯é¢†å¯¼è€…ï¼ŒèŠ‚ç‚¹Bã€Cæ˜¯è·Ÿéšè€…ï¼ˆä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå‡è®¾epochåˆ†åˆ«æ˜¯1å’Œ1ï¼ŒlastZxidåˆ†åˆ«æ˜¯101å’Œ102ï¼Œé›†ç¾¤IDåˆ†åˆ«ä¸º2å’Œ3ï¼‰ã€‚é‚£ä¹ˆå¦‚æœèŠ‚ç‚¹Aå®•æœºäº†ï¼Œä¼šå¦‚ä½•é€‰ä¸¾å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/46/e5/4667ae63fbdbc613e1d94667544bd0e5.jpg?wh=1142*590\" alt=\"\" title=\"å›¾1\"></p><p>é¦–å…ˆï¼Œå½“è·Ÿéšè€…æ£€æµ‹åˆ°è¿æ¥é¢†å¯¼è€…èŠ‚ç‚¹çš„è¯»æ“ä½œç­‰å¾…è¶…æ—¶äº†ï¼Œè·Ÿéšè€…ä¼šå˜æ›´èŠ‚ç‚¹çŠ¶æ€ï¼Œå°†è‡ªå·±çš„èŠ‚ç‚¹çŠ¶æ€å˜æ›´æˆLOOKINGï¼Œç„¶åå‘èµ·é¢†å¯¼è€…é€‰ä¸¾ï¼ˆä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ—¶èŠ‚ç‚¹Bã€Céƒ½å·²ç»æ£€æµ‹åˆ°äº†è¯»æ“ä½œè¶…æ—¶ï¼‰ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/2b/23/2bc48cf03938cc37d3513239da847c23.jpg?wh=2691*1472\" alt=\"\" title=\"å›¾2\"></p><p>æ¥ç€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåˆ›å»ºä¸€å¼ é€‰ç¥¨ï¼Œè¿™å¼ é€‰ç¥¨æ˜¯æŠ•ç»™è‡ªå·±çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒèŠ‚ç‚¹Bã€Céƒ½â€œè‡ªå‘Šå¥‹å‹‡â€æ¨èè‡ªå·±ä¸ºé¢†å¯¼è€…ï¼Œå¹¶åˆ›å»ºé€‰ç¥¨&lt;2, 1, 101, B&gt;å’Œ&lt;3, 1, 102, C&gt;ï¼Œç„¶åå„è‡ªå°†é€‰ç¥¨å‘é€ç»™é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒBå‘é€ç»™Bã€Cï¼ŒCä¹Ÿå‘é€ç»™Bã€Cã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼ŒèŠ‚ç‚¹ä¼šå…ˆæ¥æ”¶åˆ°è‡ªå·±å‘é€ç»™è‡ªå·±çš„é€‰ç¥¨ï¼ˆå› ä¸ºä¸éœ€è¦è·¨èŠ‚ç‚¹é€šè®¯ï¼Œä¼ è¾“æ›´å¿«ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒBä¼šå…ˆæ”¶åˆ°æ¥è‡ªBçš„é€‰ç¥¨ï¼ŒCä¼šå…ˆæ”¶åˆ°æ¥è‡ªCçš„é€‰ç¥¨ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/06/e32a08ca54943c96fb415a77f2fe7a06.jpg?wh=1142*585\" alt=\"\" title=\"å›¾3\"></p><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œé›†ç¾¤çš„å„èŠ‚ç‚¹æ”¶åˆ°é€‰ç¥¨åï¼Œä¸ºäº†é€‰ä¸¾å‡ºæ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ï¼Œå¯¹äºæ¯ä¸€å¼ æ¥æ”¶åˆ°é€‰ç¥¨ï¼ŒèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œé¢†å¯¼è€…PKï¼Œä¹Ÿå°±å°†é€‰ç¥¨æè®®çš„é¢†å¯¼è€…å’Œè‡ªå·±æè®®çš„é¢†å¯¼è€…è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºæ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…çš„èŠ‚ç‚¹ï¼Œçº¦å®šçš„è§„åˆ™å¦‚ä¸‹ï¼š</p><ul>\n<li>ä¼˜å…ˆæ£€æŸ¥ä»»æœŸç¼–å·ï¼ˆEpochï¼‰ï¼Œä»»æœŸç¼–å·å¤§çš„èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼›</li>\n<li>å¦‚æœä»»æœŸç¼–å·ç›¸åŒï¼Œæ¯”è¾ƒäº‹åŠ¡æ ‡è¯†ç¬¦çš„æœ€å¤§å€¼ï¼Œå€¼å¤§çš„èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼›</li>\n<li>å¦‚æœäº‹åŠ¡æ ‡è¯†ç¬¦çš„æœ€å¤§å€¼ç›¸åŒï¼Œæ¯”è¾ƒé›†ç¾¤IDï¼Œé›†ç¾¤IDå¤§çš„èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ã€‚</li>\n</ul><p>å¦‚æœé€‰ç¥¨æè®®çš„é¢†å¯¼è€…ï¼Œæ¯”è‡ªå·±æè®®çš„é¢†å¯¼è€…ï¼Œæ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†è°ƒæ•´é€‰ç¥¨å†…å®¹ï¼Œæ¨èé€‰ç¥¨æè®®çš„é¢†å¯¼è€…ä½œä¸ºé¢†å¯¼è€…ã€‚</p><p>å½“èŠ‚ç‚¹Bã€Cæ¥æ”¶åˆ°çš„é€‰ç¥¨åï¼Œå› ä¸ºé€‰ç¥¨æè®®çš„é¢†å¯¼è€…ä¸è‡ªå·±æè®®çš„é¢†å¯¼è€…ç›¸åŒï¼Œæ‰€ä»¥ï¼Œé¢†å¯¼è€…PKçš„ç»“æœï¼Œæ˜¯ä¸éœ€è¦è°ƒæ•´é€‰ç¥¨ä¿¡æ¯ï¼Œé‚£ä¹ˆèŠ‚ç‚¹Bã€Cï¼Œæ­£å¸¸æ¥æ”¶å’Œä¿å­˜é€‰ç¥¨å°±å¯ä»¥äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/96/4c0546cfe2dbc11ed99cab414ec12e96.jpg?wh=1142*636\" alt=\"\" title=\"å›¾4\"></p><p>æ¥ç€èŠ‚ç‚¹Bã€Cåˆ†åˆ«æ¥æ”¶åˆ°æ¥è‡ªå¯¹æ–¹çš„é€‰ç¥¨ï¼Œæ¯”å¦‚Bæ¥æ”¶åˆ°æ¥è‡ªCçš„é€‰ç¥¨ï¼ŒCæ¥æ”¶åˆ°æ¥è‡ªBçš„é€‰ç¥¨ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5d/d5/5d3fe6b30854490faf096826c62df5d5.jpg?wh=1142*573\" alt=\"\" title=\"å›¾5\"></p><p>å¯¹äºCè€Œè¨€ï¼Œå®ƒæè®®çš„é¢†å¯¼è€…æ˜¯Cï¼Œè€Œé€‰ç¥¨ï¼ˆ&lt;2, 1, 101, B&gt;ï¼‰æè®®çš„é¢†å¯¼è€…æ˜¯Bï¼Œå› ä¸ºèŠ‚ç‚¹Cçš„ä»»æœŸç¼–å·ä¸èŠ‚ç‚¹Bç›¸åŒï¼Œä½†èŠ‚ç‚¹Cçš„äº‹åŠ¡æ ‡è¯†ç¬¦çš„æœ€å¤§å€¼æ¯”èŠ‚ç‚¹Bçš„å¤§ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ç…§çº¦å®šçš„è§„åˆ™ï¼Œç›¸æ¯”èŠ‚ç‚¹Bï¼ŒèŠ‚ç‚¹Cæ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒèŠ‚ç‚¹Cä¸éœ€è¦è°ƒæ•´é€‰ç¥¨ä¿¡æ¯ï¼Œæ­£å¸¸æ¥æ”¶å’Œä¿å­˜é€‰ç¥¨å°±å¯ä»¥äº†ã€‚</p><p>ä½†å¯¹äºå¯¹äºèŠ‚ç‚¹Bè€Œè¨€ï¼Œå®ƒæè®®çš„é¢†å¯¼è€…æ˜¯Bï¼Œé€‰ç¥¨ï¼ˆ&lt;3, 1, 102, C&gt;ï¼‰æè®®çš„é¢†å¯¼è€…æ˜¯Cï¼Œå› ä¸ºèŠ‚ç‚¹Cçš„ä»»æœŸç¼–å·ä¸èŠ‚ç‚¹Bç›¸åŒï¼Œä½†èŠ‚ç‚¹Cçš„äº‹åŠ¡æ ‡è¯†ç¬¦çš„æœ€å¤§å€¼æ¯”èŠ‚ç‚¹Bçš„å¤§ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ç…§çº¦å®šçš„è§„åˆ™ï¼Œç›¸æ¯”èŠ‚ç‚¹Bï¼ŒèŠ‚ç‚¹Cåº”è¯¥ä½œä¸ºé¢†å¯¼è€…ï¼Œæ‰€ä»¥ï¼ŒèŠ‚ç‚¹Bé™¤äº†æ¥æ”¶å’Œä¿å­˜é€‰ç¥¨ä¿¡æ¯ï¼Œè¿˜ä¼šæ›´æ–°è‡ªå·±çš„é€‰ç¥¨ä¸º&lt;3, 1, 102, B&gt;ï¼Œä¹Ÿå°±æ˜¯æ¨èCä½œä¸ºé¢†å¯¼è€…ï¼Œå¹¶å°†é€‰ç¥¨é‡æ–°å‘é€ç»™èŠ‚ç‚¹Bã€Cï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/bf/77/bf70a4f1e9c28de2bbd3c134193ae577.jpg?wh=1142*605\" alt=\"\" title=\"å›¾6\"></p><p>æ¥ç€ï¼Œå½“èŠ‚ç‚¹Bã€Cæ¥æ”¶åˆ°æ¥è‡ªèŠ‚ç‚¹Bï¼Œæ–°çš„é€‰ç¥¨æ—¶ï¼Œå› ä¸ºè¿™å¼ é€‰ç¥¨ï¼ˆ&lt;3, 1, 102, B&gt;ï¼‰æè®®çš„é¢†å¯¼è€…ï¼Œä¸ä»–ä»¬æè®®çš„é¢†å¯¼è€…æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯èŠ‚ç‚¹Cï¼Œæ‰€ä»¥ï¼Œä»–ä»¬æ­£å¸¸æ¥æ”¶å’Œå­˜å‚¨è¿™å¼ é€‰ç¥¨ï¼Œå°±å¯ä»¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/04/7c/04ec7fdf75160571c8689f040292d57c.jpg?wh=1142*583\" alt=\"\" title=\"å›¾7\"></p><p>æœ€åï¼Œå› ä¸ºæ­¤æ—¶èŠ‚ç‚¹Bã€Cæè®®çš„é¢†å¯¼è€…ï¼ˆèŠ‚ç‚¹Cï¼‰èµ¢å¾—å¤§å¤šæ•°é€‰ç¥¨äº†ï¼ˆ2å¼ é€‰ç¥¨ï¼‰ï¼Œé‚£ä¹ˆï¼ŒèŠ‚ç‚¹Bã€Cå°†æ ¹æ®æŠ•ç¥¨ç»“æœï¼Œå˜æ›´èŠ‚ç‚¹çŠ¶æ€ï¼Œå¹¶é€€å‡ºé€‰ä¸¾ã€‚æ¯”å¦‚ï¼Œå› ä¸ºå½“é€‰çš„é¢†å¯¼è€…æ˜¯èŠ‚ç‚¹Cï¼Œé‚£ä¹ˆèŠ‚ç‚¹Bå°†å˜æ›´çŠ¶æ€ä¸ºFOLLOWINGï¼Œå¹¶é€€å‡ºé€‰ä¸¾ï¼Œè€ŒèŠ‚ç‚¹Cå°†å˜æ›´çŠ¶æ€ä¸ºLEADINGï¼Œå¹¶é€€å‡ºé€‰ä¸¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/03/a9113e0d2653c77ddc41778510784003.jpg?wh=1142*571\" alt=\"\" title=\"å›¾8\"></p><p>ä½ çœ‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±é€‰ä¸¾å‡ºæ–°çš„é¢†å¯¼è€…ï¼ˆèŠ‚ç‚¹Cï¼‰ï¼Œè¿™ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘åœ¨è¿™é‡Œåªæ˜¯å‡è®¾äº†ä¸€ç§é€‰ä¸¾çš„æƒ…å†µï¼Œè¿˜ä¼šå­˜åœ¨èŠ‚ç‚¹é—´äº‹åŠ¡æ ‡è¯†ç¬¦ç›¸åŒã€èŠ‚ç‚¹åœ¨å¹¿æ’­æŠ•ç¥¨ä¿¡æ¯å‰æ¥æ”¶åˆ°äº†å…¶ä»–èŠ‚ç‚¹çš„æŠ•ç¥¨ç­‰æƒ…å†µï¼Œè¿™é‡Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œè¯¾ä¸‹è‡ªå·±åŠ¨æ‰‹æ“ä½œä¸€ä¸‹ã€‚</p><p>ä¸ºäº†å¸®ä½ åœ¨çº¿ä¸‹æ›´å¥½çš„é˜…è¯»ä»£ç ï¼Œè‡ªæˆ‘å­¦ä¹ ï¼Œæˆ‘æƒ³è¡¥å……ä¸€ä¸‹ï¼Œé€»è¾‘æ—¶é’Ÿï¼ˆlogicclockï¼‰ï¼ˆä¹Ÿå°±æ˜¯é€‰ä¸¾çš„è½®æ¬¡ï¼‰ï¼Œä¼šå½±å“é€‰ç¥¨çš„æœ‰æ•ˆæ€§ï¼Œå…·ä½“æ¥è¯´ï¼Œé€»è¾‘æ—¶é’Ÿå¤§çš„èŠ‚ç‚¹ä¸ä¼šæ¥æ”¶æ¥è‡ªå€¼å°çš„èŠ‚ç‚¹çš„æŠ•ç¥¨ä¿¡æ¯ã€‚æ¯”å¦‚ï¼ŒèŠ‚ç‚¹Aã€Bçš„é€»è¾‘æ—¶é’Ÿåˆ†åˆ«ä¸º1å’Œ2ï¼Œé‚£ä¹ˆï¼ŒèŠ‚ç‚¹Bå°†æ‹’ç»æ¥æ”¶æ¥è‡ªèŠ‚ç‚¹Açš„æŠ•ç¥¨ä¿¡æ¯ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œé¢†å¯¼è€…é€‰ä¸¾çš„ç›®æ ‡ï¼Œæ˜¯ä»å¤§å¤šæ•°èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºæ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­ï¼Œäº‹åŠ¡æ ‡è¯†ç¬¦å€¼æœ€å¤§çš„èŠ‚ç‚¹ã€‚<strong>å¦å¤–ï¼ŒZABæœ¬è´¨ä¸Šæ˜¯é€šè¿‡â€œè§è´¤æ€é½ï¼Œç›¸äº’æ¨èâ€çš„æ–¹å¼æ¥é€‰ä¸¾é¢†å¯¼è€…çš„ã€‚</strong>ä¹Ÿå°±è¯´ï¼Œæ ¹æ®é¢†å¯¼è€…PKï¼ŒèŠ‚ç‚¹ä¼šé‡æ–°æ¨èæ›´åˆé€‚çš„é¢†å¯¼è€…ï¼Œæœ€ç»ˆé€‰ä¸¾å‡ºäº†å¤§å¤šæ•°èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ã€‚</p><p>å½“ç„¶äº†ï¼Œæ–‡å­—å’Œä»£ç æ˜¯2ç§ä¸åŒçš„è¡¨è¾¾ï¼Œä¸€äº›ç»†èŠ‚ï¼Œä»…ä»…é€šè¿‡æ–‡å­—æ˜¯æ— æ³•è¡¨è¾¾å‡ºæ¥çš„ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†å¸®ä½ æ›´é€šé€åœ°ç†è§£é¢†å¯¼è€…é€‰ä¸¾çš„å®ç°ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»¥æœ€æ–°ç¨³å®šç‰ˆçš„<a href=\"https://downloads.apache.org/zookeeper/zookeeper-3.6.0/apache-zookeeper-3.6.0.tar.gz\">ZooKeeper</a>ä¸ºä¾‹ï¼ˆä¹Ÿå°±æ˜¯3.6.0ï¼‰ï¼Œå…·ä½“è¯´ä¸€è¯´ä»£ç çš„å®ç°ã€‚</p><h2>ZooKeeperæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œåœ¨ZooKeeperä¸­æ˜¯å¦‚ä½•å®ç°æˆå‘˜èº«ä»½çš„ï¼Ÿ</p><p>åœ¨ZooKeeperä¸­ï¼Œæˆå‘˜çŠ¶æ€æ˜¯åœ¨QuorumPeer.javaä¸­å®ç°çš„ï¼Œä¸ºæšä¸¾å‹å˜é‡ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</p><pre><code>public enum ServerState {\n    LOOKING,\n    FOLLOWING,\n    LEADING,\n    OBSERVING\n}\n</code></pre><p>å…¶å®ï¼Œåœ¨ZooKeeperä¸­ï¼Œæ²¡æœ‰ç›´æ¥å®šä¹‰æˆå‘˜èº«ä»½ï¼Œè€Œæ˜¯ç”¨äº†å¯¹åº”çš„æˆå‘˜çŠ¶æ€æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼Œå¤„äºFOLLOWINGçŠ¶æ€çš„èŠ‚ç‚¹ä¸ºè·Ÿéšè€…ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœä½ æƒ³ç ”ç©¶ç›¸å…³æˆå‘˜çš„åŠŸèƒ½å’Œå®ç°ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠå¯¹åº”çš„æˆå‘˜çŠ¶æ€ä½œä¸ºåˆ‡å…¥ç‚¹æ¥ç ”ç©¶ï¼Œæ¯”å¦‚ï¼Œä½ æƒ³ç ”ç©¶é¢†å¯¼è€…çš„åŠŸèƒ½å®ç°ï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­æœç´¢LEADINGå…³é”®å­—ï¼Œç„¶åç ”ç©¶ç›¸åº”çš„ä¸Šä¸‹æ–‡é€»è¾‘ï¼Œå°±èƒ½å¾—åˆ°è‡ªå·±æƒ³è¦çš„ç­”æ¡ˆäº†ã€‚</p><p>å¦‚æœè·Ÿéšè€…å°†è‡ªå·±çš„çŠ¶æ€ä»è·Ÿéšè€…çŠ¶æ€å˜æ›´ä¸ºé€‰ä¸¾çŠ¶æ€ï¼Œè¿™å°±è¡¨ç¤ºè·Ÿéšè€…åœ¨å‘èµ·é¢†å¯¼è€…é€‰ä¸¾ï¼Œé‚£ä¹ˆï¼Œåœ¨ZooKeeperä¸­ï¼Œé¢†å¯¼è€…é€‰ä¸¾æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><h2>å¦‚ä½•å®ç°é€‰ä¸¾ï¼Ÿ</h2><p>é¢†å¯¼è€…é€‰ä¸¾ï¼Œæ˜¯åœ¨FastLeaderElection.lookForLeader()ä¸­å®ç°çš„ã€‚æˆ‘æ¥è®²ä¸€ä¸‹æ ¸å¿ƒçš„æµç¨‹ï¼Œå¤§æ¦‚çš„æµç¨‹ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/83/57/83c37bc2a25a4e892cf1a5c3a2c6c457.jpg?wh=1142*1251\" alt=\"\" title=\"å›¾9\"></p><p>ä¸ºå¸®åŠ©ä½ æ›´å¥½çš„ç†è§£è¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·èµ°è¯»ä¸‹æ ¸å¿ƒä»£ç ï¼ŒåŠ æ·±ä¸‹å°è±¡ã€‚</p><p>1.åœ¨é›†ç¾¤ç¨³å®šè¿è¡Œæ—¶ï¼Œå¤„äºè·Ÿéšè€…çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œåœ¨Follower.followLeader()å‡½æ•°ä¸­ï¼Œå‘¨æœŸæ€§åœ°è¯»æ•°æ®åŒ…å’Œå¤„ç†æ•°æ®åŒ…ï¼š</p><pre><code>QuorumPacket qp = new QuorumPacket();\nwhile (this.isRunning()) {\n    // è¯»å–æ•°æ®åŒ…\n    readPacket(qp);\n    // å¤„ç†æ•°æ®åŒ…\n    processPacket(qp);\n}\n</code></pre><p>2.å½“è·Ÿéšè€…æ£€æµ‹åˆ°è¿æ¥åˆ°é¢†å¯¼è€…çš„è¯»æ“ä½œè¶…æ—¶äº†ï¼ˆæ¯”å¦‚é¢†å¯¼è€…èŠ‚ç‚¹æ•…éšœäº†ï¼‰ï¼Œè¿™æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œè·³å‡ºä¸Šé¢çš„è¯»å–æ•°æ®åŒ…å’Œå¤„ç†æ•°æ®åŒ…çš„å¾ªç¯ï¼Œå¹¶æœ€ç»ˆè·Ÿéšè€…å°†èŠ‚ç‚¹çŠ¶æ€å˜æ›´ä¸ºé€‰ä¸¾çŠ¶æ€ã€‚</p><pre><code>public void run() {\n    case FOLLOWING:\n        ......\n        finally {\n            // å…³é—­è·Ÿéšè€…èŠ‚ç‚¹\n            follower.shutdown();\n            setFollower(null);\n            // è®¾ç½®çŠ¶æ€ä¸ºé€‰ä¸¾çŠ¶æ€\n            updateServerState();\n        }\n        break;\n    ......\n}\n</code></pre><p>3.å½“èŠ‚ç‚¹å¤„äºé€‰ä¸¾çŠ¶æ€æ—¶ï¼Œå°†è°ƒç”¨makeLEStrategy().lookForLeader()å‡½æ•°ï¼ˆå®é™…å¯¹åº”çš„å‡½æ•°ä¸ºFastLeaderElection.lookForLeader()ï¼‰ï¼Œå‘èµ·é¢†å¯¼è€…é€‰ä¸¾ã€‚</p><pre><code>setCurrentVote(makeLEStrategy().lookForLeader());\n</code></pre><p>4.åœ¨FastLeaderElection.lookForLeader()å‡½æ•°ä¸­ï¼ŒèŠ‚ç‚¹éœ€è¦å¯¹é€»è¾‘æ—¶é’Ÿï¼ˆä¹Ÿå°±æ˜¯é€‰ä¸¾çš„è½®æ¬¡ï¼‰çš„å€¼æ‰§è¡ŒåŠ 1æ“ä½œï¼Œè¡¨ç¤ºæˆ‘ä»¬å¼€å¯ä¸€è½®çš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œç„¶ååˆ›å»ºæŠ•ç¥¨ææ¡ˆï¼ˆé»˜è®¤æ¨èè‡ªå·±ä¸ºé¢†å¯¼è€…ï¼‰ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹ï¼š</p><pre><code>synchronized (this) {\n  // å¯¹é€»è¾‘æ—¶é’Ÿçš„å€¼æ‰§è¡ŒåŠ ä¸€æ“ä½œ\n  logicalclock.incrementAndGet();\n  // åˆ›å»ºæŠ•ç¥¨ææ¡ˆï¼Œå¹¶é»˜è®¤æ¨èè‡ªå·±ä¸ºé¢†å¯¼è€…\n  updateProposal(getInitId(), getInitLastLoggedZxid(),    \n                 getPeerEpoch());\n}\n// å¹¿æ’­æŠ•ç¥¨ä¿¡æ¯ç»™æ‰€æœ‰èŠ‚ç‚¹\nsendNotifications();\n</code></pre><p>5.å½“èŠ‚ç‚¹å¤„äºé€‰ä¸¾çŠ¶æ€æ—¶ï¼Œä¼šå‘¨æœŸæ€§åœ°ä»é˜Ÿåˆ—ä¸­è¯»å–æ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œç›´åˆ°é€‰ä¸¾æˆåŠŸã€‚</p><pre><code>while ((self.getPeerState() == ServerState.LOOKING) &amp;&amp; (!stop)) {\n   // ä»é˜Ÿåˆ—ä¸­è¯»å–æ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¿¡æ¯             \n   Notification n = recvqueue.poll(notTimeout, TimeUnit.MILLISECONDS);\n   ......\n}\n</code></pre><p>6.å½“æ¥æ”¶åˆ°æ–°çš„æŠ•ç¥¨ä¿¡æ¯æ—¶ï¼ŒèŠ‚ç‚¹ä¼šè¿›è¡Œé¢†å¯¼è€…PKï¼Œæ¥åˆ¤æ–­è°æ›´é€‚åˆå½“é¢†å¯¼è€…ï¼Œå¦‚æœæŠ•ç¥¨ä¿¡æ¯ä¸­æè®®çš„èŠ‚ç‚¹æ¯”è‡ªå·±æè®®çš„èŠ‚ç‚¹ï¼Œæ›´é€‚åˆå½“é¢†å¯¼è€…ï¼Œæ›´æ–°æŠ•ç¥¨ä¿¡æ¯ï¼Œæ¨èæŠ•ç¥¨ä¿¡æ¯ä¸­æè®®çš„èŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼Œå¹¶å¹¿æ’­ç»™æ‰€æœ‰èŠ‚ç‚¹ï¼š</p><pre><code>else if (totalOrderPredicate(n.leader, n.zxid, n.peerEpoch, proposedLeader, proposedZxid, proposedEpoch)) {\n  // æŠ•ç¥¨ä¿¡æ¯ä¸­æè®®çš„èŠ‚ç‚¹æ¯”è‡ªå·±æè®®çš„èŠ‚ç‚¹æ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…ï¼Œæ›´æ–°æŠ•ç¥¨ä¿¡æ¯ï¼Œå¹¶æ¨èæŠ•ç¥¨ä¿¡æ¯ä¸­æè®®çš„èŠ‚ç‚¹\n  updateProposal(n.leader, n.zxid, n.peerEpoch);\n  // å°†æ–°çš„æŠ•ç¥¨ä¿¡æ¯å¹¿æ’­ç»™æ‰€æœ‰èŠ‚ç‚¹\n  sendNotifications();\n}\n</code></pre><p>7.å¦‚æœè‡ªå·±æè®®çš„é¢†å¯¼è€…èµ¢å¾—å¤§å¤šæ•°é€‰ç¥¨ï¼Œåˆ™æ‰§è¡Œæ­¥éª¤8ï¼Œå˜æ›´èŠ‚ç‚¹çŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ï¼›å¦‚æœè‡ªå·±æè®®çš„é¢†å¯¼è€…ä»æœªèµ¢å¾—å¤§å¤šæ•°é€‰ç¥¨ï¼Œåˆ™æ‰§è¡Œæ­¥éª¤5ï¼Œç»§ç»­ä»æ¥æ”¶é˜Ÿåˆ—ä¸­è¯»å–æ–°çš„æŠ•ç¥¨ä¿¡æ¯ã€‚</p><p>8.æœ€åï¼Œå½“èŠ‚ç‚¹æè®®çš„é¢†å¯¼è€…èµ¢å¾—å¤§å¤šæ•°é€‰ç¥¨æ—¶ï¼Œæ ¹æ®æŠ•ç¥¨ç»“æœï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œé¢†å¯¼è€…æˆ–è·Ÿéšè€…ï¼Œå¹¶å˜æ›´èŠ‚ç‚¹çŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ã€‚</p><pre><code>if (voteSet.hasAllQuorums()) {\n  ......\n    // æ ¹æ®æŠ•ç¥¨ç»“æœï¼Œåˆ¤æ–­å¹¶è®¾ç½®èŠ‚ç‚¹çŠ¶æ€\n    setPeerState(proposedLeader, voteSet);\n    // é€€å‡ºé¢†å¯¼è€…é€‰ä¸¾\n    Vote endVote = new Vote(proposedLeader, proposedZxid, logicalclock.get(), proposedEpoch);\n    leaveInstance(endVote);\n    return endVote;\n  ......\n}\n</code></pre><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯æ¼”ç¤ºä¸€ç§é€‰ä¸¾æƒ…å†µï¼Œæ›´å¤šçš„æƒ…å†µï¼Œæ¯”å¦‚æ¥æ”¶åˆ°æ¥è‡ªé€»è¾‘æ—¶é’Ÿæ¯”å½“å‰èŠ‚ç‚¹å°çš„èŠ‚ç‚¹çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå†æ¯”å¦‚æ¥æ”¶åˆ°æ¥è‡ªé¢†å¯¼è€…çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨è¯¾ä¸‹è‡ªå·±ç ”ç©¶ä¸€ä¸‹ï¼Œé‡åˆ°é—®é¢˜æ—¶ï¼Œæ¬¢è¿ç•™è¨€ï¼Œå’±ä»¬ä¸€èµ·è®¨è®ºã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä¸»è¦å¸¦ä½ äº†è§£äº†ZABæ˜¯å¦‚ä½•é€‰ä¸¾é¢†å¯¼è€…çš„ï¼Œä»¥åŠåœ¨ZooKeeperä¸­æ˜¯å¦‚ä½•å®ç°çš„ã€‚æˆ‘å¸Œæœ›ä½ æ˜ç¡®è¿™æ ·å‡ ä¸ªé‡ç‚¹ã€‚</p><p>1.é¢†å¯¼è€…é€‰ä¸¾çš„ç›®æ ‡ï¼Œæ˜¯é€‰ä¸¾å‡ºå¤§å¤šæ•°èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­äº‹åŠ¡æ ‡è¯†ç¬¦å€¼æœ€å¤§çš„èŠ‚ç‚¹ã€‚</p><p>2.ä»»æœŸç¼–å·ã€äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ã€é›†ç¾¤IDçš„å€¼çš„å¤§å°ï¼Œå†³å®šäº†å“ªä¸ªèŠ‚ç‚¹æ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…ï¼ŒæŒ‰ç…§é¡ºåºï¼Œå€¼å¤§çš„èŠ‚ç‚¹æ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…ã€‚</p><p>å­¦åˆ°è¿™é‡Œï¼Œæœ‰åŒå­¦å¯èƒ½ä¼šè¯´ï¼šâ€œè€éŸ©ï¼Œæˆ‘ç ”ç©¶äº†ä¸€ä¸‹ï¼Œé¢†å¯¼è€…æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­ï¼Œå·²æäº¤ææ¡ˆäº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§çš„èŠ‚ç‚¹ï¼Œå› ä¸ºåœ¨é¢†å¯¼è€…é€‰ä¸¾çš„å®ç°ä¸­ï¼Œäº‹åŠ¡æ ‡è¯†ç¬¦é‡‡ç”¨çš„æ˜¯dataTree.lastProcessedZxidçš„å€¼ï¼Œè€Œè¿™ä¸ªå˜é‡æ ‡è®°çš„æ˜¯å·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ã€‚åˆ°åº•è¦æ€ä¹ˆç†è§£å‘¢ï¼Ÿâ€</p><p>æˆ‘è¦å…ˆä¸ºä½ çš„æ¢ç´¢å’Œæ€è€ƒç‚¹ä¸ªèµï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œåœ¨é¢†å¯¼è€…é€‰ä¸¾çš„å®ç°ä¸­ï¼Œäº‹åŠ¡æ ‡è¯†ç¬¦é‡‡ç”¨çš„æ˜¯dataTree.lastProcessedZxidçš„å€¼ã€‚éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨è·Ÿéšè€…èŠ‚ç‚¹æ­£å¸¸è¿è¡Œæ—¶ï¼ŒdataTree.lastProcessedZxidè¡¨ç¤ºçš„æ˜¯å·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ï¼Œä½†å½“è·Ÿéšè€…æ£€æµ‹åˆ°å¼‚å¸¸ï¼Œé€€å‡ºè·Ÿéšè€…çŠ¶æ€æ—¶ï¼ˆåœ¨follower.shutdown()å‡½æ•°ä¸­ï¼‰ï¼ŒZooKeeperä¼šå°†æ‰€æœ‰æœªæäº¤ææ¡ˆæäº¤ï¼Œå¹¶ä½¿ç”¨lastProcessedZxidè¡¨ç¤ºèŠ‚ç‚¹ä¸Šææ¡ˆï¼ˆåŒ…æ‹¬åˆšæäº¤çš„ææ¡ˆï¼‰çš„äº‹åŠ¡æ ‡è¯†ç¬¦çš„æœ€å¤§å€¼ï¼Œåœ¨æ¥ä¸‹æ¥çš„é¢†å¯¼è€…é€‰ä¸¾ä¸­ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯è¯¥å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒZABçš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œé€‰ä¸¾å‡ºçš„æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p><p>Aã€Bã€Cä¸‰èŠ‚ç‚¹ï¼ŒAæ˜¯é¢†å¯¼è€…ï¼ŒBã€Cæ˜¯è·Ÿéšè€…ï¼ŒBæœ‰2ä¸ªå·²æäº¤ææ¡ˆ(&lt;1, 1&gt;ï¼Œ&lt;1, 2&gt;)ï¼ŒCæœ‰4ä¸ªæœªæäº¤ææ¡ˆ(&lt;1, 1&gt;ï¼Œ&lt;1, 2&gt;ï¼Œ&lt;1, 3&gt;ï¼Œ&lt;1, 4&gt;)ï¼Œé‚£ä¹ˆå½“Aæ•…éšœåï¼ŒCå°±ä¼šå½“é€‰é¢†å¯¼è€…ã€‚å› ä¸ºCçš„dataTree.lastProcessedZxidå€¼ï¼ˆä¹Ÿå°±æ˜¯&lt;1, 4&gt;ï¼‰å¤§äºBçš„dataTree.lastProcessedZxidå€¼ï¼ˆä¹Ÿå°±æ˜¯&lt;1, 2&gt;ï¼‰ã€‚</p><p>æœ€åï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œæˆ‘ä¸ºå•¥ä¼šå†™è¿™ä¹ˆå¤šå†…å®¹ï¼Œæ¥åˆ†ææºç å®ç°ï¼Œé™¤äº†å› ä¸ºä»£ç ä¹Ÿæ˜¯ä¸€ç§è¡¨è¾¾ï¼Œèƒ½æœ‰æ•ˆå¼¥è¡¥æ–‡å­—çš„æ— æ³•è¡¨è¾¾çš„å†…å®¹ä¹‹å¤–ï¼Œè¿˜å› ä¸ºå¯¹äºä¸€ä¸ªè½¯ä»¶æ¥è¯´ï¼Œæœ€å‡†ç¡®ã€æœ€æ–°çš„ä½¿ç”¨æ‰‹å†Œå’ŒæŠ€æœ¯å†…å¹•å°±æ˜¯æºç ã€‚æˆ‘å¸Œæœ›ä½ ä¹Ÿèƒ½å…»æˆé˜…è¯»æºç çš„ä¹ æƒ¯ï¼Œå°†æºç å’Œæ–‡æ¡£ç»“åˆèµ·æ¥ï¼Œæ¥å‡†ç¡®ç†è§£è½¯ä»¶çš„åŠŸèƒ½å’ŒåŸç†ã€‚</p><p>é€‰ä¸¾å‡ºäº†æ–°é¢†å¯¼è€…ï¼Œå®ƒæ˜¯ä¸æ˜¯å°±å¯ä»¥å¤„ç†å†™è¯·æ±‚äº†å‘¢ï¼Ÿå½“ç„¶ä¸å¯ä»¥ï¼Œå› ä¸ºZABé›†ç¾¤è¿˜éœ€è¦é€šè¿‡æˆå‘˜å‘ç°ï¼ˆDiscoveryï¼‰å’Œæ•°æ®åŒæ­¥ï¼ˆSynchronizationï¼‰æ¥æ¢å¤æ•…éšœï¼Œç„¶åé¢†å¯¼è€…æ‰èƒ½è¡Œä½¿â€œé¢†å¯¼â€çš„èŒèƒ½ï¼Œå¤„ç†å†™è¯·æ±‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¼šåœ¨ä¸‹ä¸€è®²é‡ç‚¹å¸¦ä½ äº†è§£çš„ã€‚</p><h2>è¯¾å ‚æ€è€ƒ</h2><p>æ—¢ç„¶æˆ‘æåˆ°åœ¨ZABåè®®ä¸­ï¼ŒZABåè®®æ˜¯é€šè¿‡å¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾ï¼Œæ¥é€‰ä¸¾å‡ºæ–°çš„é¢†å¯¼è€…çš„ã€‚é‚£ä¹ˆä½ ä¸å¦¨æƒ³æƒ³ï¼Œåœ¨é€‰ä¸¾ä¸­ï¼Œä¼šå‡ºç°é€‰ç¥¨è¢«ç“œåˆ†ã€é€‰ä¸¾å¤±è´¥çš„é—®é¢˜å—ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼Œä¸æˆ‘ä¸€åŒè®¨è®ºã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™èŠ‚è¯¾è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"15 | ZABåè®®ï¼šå¦‚ä½•å®ç°æ“ä½œçš„é¡ºåºæ€§ï¼Ÿ","id":229975},"right":{"article_title":"åŠ é¤ | ZABåè®®ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä»æ•…éšœä¸­æ¢å¤ï¼Ÿ","id":237340}},"comments":[{"had_liked":false,"id":216219,"user_name":"Geek_yuanhe","can_delete":false,"product_type":"c1","uid":1981636,"ip_address":"","ucode":"8452947BBF1C36","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","comment_is_top":false,"comment_ctime":1589206482,"is_pvip":false,"replies":[{"id":"80017","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒRafté¢†å¯¼è€…é€‰ä¸¾çš„å…³é”®æ˜¯éšæœºè¶…æ—¶æ—¶é—´ã€ä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªä»»æœŸåªæœ‰ä¸€å¼ é€‰ç¥¨ã€åŸºäºä»»æœŸç¼–å·å¤§å°å’Œæ—¥å¿—å®Œæ•´åº¦æ¥æŠ•ç¥¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589231543,"ip_address":"","comment_id":216219,"utype":1}],"discussion_count":4,"race_medal":0,"score":"70308683218","product_id":100046101,"comment_content":"éŸ©è€å¸ˆæ‚¨å¥½ï¼Œraftç®—æ³•è·Ÿzabçš„é€‰ä¸¾åŒºåˆ«ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯”è¾ƒå¤§çš„åŒºåˆ«å°±æ˜¯zabæ˜¯æœ‰leader PKï¼Œè€Œraftåªæ˜¯å…ˆæ¥å…ˆå¾—ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹å·²ç»ç¡®è®¤æŠ•ç¥¨ï¼Œåé¢å³ä½¿æ¯”ä»–ä»»æœŸç¼–å·å¤§çš„é€‰ç¥¨å†æ¥è¯·æ±‚æŠ•ç¥¨ï¼Œä¹Ÿä¼šæ‹’ç»ï¼Œè¿™æ ·ç†è§£å¯¹ä¹ˆï¼Ÿ","like_count":17,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494722,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒRafté¢†å¯¼è€…é€‰ä¸¾çš„å…³é”®æ˜¯éšæœºè¶…æ—¶æ—¶é—´ã€ä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªä»»æœŸåªæœ‰ä¸€å¼ é€‰ç¥¨ã€åŸºäºä»»æœŸç¼–å·å¤§å°å’Œæ—¥å¿—å®Œæ•´åº¦æ¥æŠ•ç¥¨ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589231543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438315,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEI9Fb9tYoBrjUa8zpvOTGibnKYI9fz1QnfXO1Dy5rp5DPJ7nQOHIIXzKOXet3DMqHNYIHJHyz6bm3g/132","nickname":"èƒ¡ç²ç²","note":"","ucode":"BA8C5190A13A74","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343133,"discussion_content":"raftåº”è¯¥æ˜¯åŒä¸€ä¸ªä»»æœŸæ˜¯å…ˆæ¥å…ˆæœåŠ¡å§ï¼Œä»»æœŸå·å¤§çš„ä¼šè¿›è¡Œæ–°ä»»æœŸçš„æŠ•ç¥¨ï¼Œæ±‚æ•™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610954085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2343279,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c1/6f/b29bd6dc.jpg","nickname":"YQM","note":"","ucode":"C4875BBEB92C0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1438315,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEI9Fb9tYoBrjUa8zpvOTGibnKYI9fz1QnfXO1Dy5rp5DPJ7nQOHIIXzKOXet3DMqHNYIHJHyz6bm3g/132","nickname":"èƒ¡ç²ç²","note":"","ucode":"BA8C5190A13A74","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":531088,"discussion_content":"RaftèŠ‚ç‚¹å¦‚æœæ”¶åˆ°äº†æ¥è‡ªæ›´å¤§ä»»æœŸèŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œä¼šç«‹å³æ›´æ–°ä»»æœŸï¼Œå¹¶è½¬æ¢è§’è‰²ä¸ºfollowerï¼Œç„¶åå†å¤„ç†æ¶ˆæ¯ï¼›ä¸€ä¸ªä»»æœŸé‡Œæ¯ä¸ªRaftèŠ‚ç‚¹åªæœ‰ä¸€æ¬¡æŠ•ç¥¨æƒï¼Œå±äºå…ˆæ¥è€…å…ˆå¾—ï¼›","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637224541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":343133,"ip_address":""},"score":531088,"extra":"{\"user_type\":1}"}]},{"author":{"id":2020029,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ799HD4ehcP4QAhic0l9A5mricoiamAf8MNiaxIGUy8qUkClEKFqXGPhU33OOqdicdFQUicRFr2NTBf0hw/132","nickname":"owonder","note":"","ucode":"F3A1F9E6568285","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277099,"discussion_content":"éŸ©è€å¸ˆæ‚¨å¥½ï¼Œraftç®—æ³•è·Ÿzabçš„é€‰ä¸¾åŒºåˆ«ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯”è¾ƒå¤§çš„åŒºåˆ«å°±æ˜¯zabæ˜¯æœ‰leader PKï¼Œè€Œraftåªæ˜¯å…ˆæ¥å…ˆå¾—ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹å·²ç»ç¡®è®¤æŠ•ç¥¨ï¼Œåé¢å³ä½¿æ¯”ä»–ä»»æœŸç¼–å·å¤§çš„é€‰ç¥¨å†æ¥è¯·æ±‚æŠ•ç¥¨ï¼Œä¹Ÿä¼šæ‹’ç»ï¼Œè¿™æ ·ç†è§£å¯¹ä¹ˆï¼Ÿ è¿™ä¸ªç†è§£æ˜¯ä¸å¯¹çš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590999861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215393,"user_name":"zyz","can_delete":false,"product_type":"c1","uid":1019339,"ip_address":"","ucode":"0092F8C0FFA375","user_header":"","comment_is_top":false,"comment_ctime":1588986199,"is_pvip":false,"replies":[{"id":"79856","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå…¶å®èŠ‚ç‚¹çš„å¥‡å¶æ•°ä¸å½±å“é€‰ä¸¾ç»“æœï¼Œå½±å“çš„æ˜¯èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼Œ4èŠ‚ç‚¹é›†ç¾¤å’Œ3èŠ‚ç‚¹é›†ç¾¤çš„â€œå¤§å¤šæ•°â€åˆ†åˆ«æ˜¯3å’Œ2ï¼Œä¹Ÿå°±æ˜¯n&#47;2 + 1ï¼Œéƒ½åªèƒ½å®¹å¿1ä¸ªèŠ‚ç‚¹çš„æ•…éšœã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589118504,"ip_address":"","comment_id":215393,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53128593751","product_id":100046101,"comment_content":"æ ¹æ®è·å–é€‰ä¸¾ç¥¨æ•°è¿‡åŠæœºåˆ¶çš„åŸåˆ™ï¼ŒåŒæ—¶æœåŠ¡å™¨æ•°é‡ä¸ºå¥‡æ•°ï¼Œä¸ä¼šå‡ºç°é€‰ä¸¾å¤±è´¥çš„æƒ…å†µ","like_count":12,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494414,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå…¶å®èŠ‚ç‚¹çš„å¥‡å¶æ•°ä¸å½±å“é€‰ä¸¾ç»“æœï¼Œå½±å“çš„æ˜¯èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼Œ4èŠ‚ç‚¹é›†ç¾¤å’Œ3èŠ‚ç‚¹é›†ç¾¤çš„â€œå¤§å¤šæ•°â€åˆ†åˆ«æ˜¯3å’Œ2ï¼Œä¹Ÿå°±æ˜¯n/2 + 1ï¼Œéƒ½åªèƒ½å®¹å¿1ä¸ªèŠ‚ç‚¹çš„æ•…éšœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589118504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"æ¶›å“¥å“¥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555118,"discussion_content":"ä¸»è¦æœ€åè¿˜ä¼šæ¯”è¾ƒèŠ‚ç‚¹çš„idï¼ŒèŠ‚ç‚¹idä¸€å®šä¸ä¸€æ ·ï¼Œæ‰€ä»¥è‚¯å®šä¼šé€‰ä¸¾æˆåŠŸå•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646752282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221129,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1082132,"ip_address":"","ucode":"483350A630625E","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/14/099742ae.jpg","comment_is_top":false,"comment_ctime":1590412458,"is_pvip":false,"replies":[{"id":"88113","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªæŠ•ç¥¨æ± ï¼Œæ¯ä¸ªæŠ•ç¥¨æ± éƒ½åŒ…å«è‡ªå·±å’Œå…¶ä»–èŠ‚ç‚¹æ¨èçš„é¢†å¯¼è€…çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹èµ¢å¾—å¤§å¤šæ•°æŠ•ç¥¨ï¼Œé‚£ä¹ˆè¿™æ—¶ä¼šåˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯è‡ªå·±ï¼Œå¦‚æœæ˜¯è‡ªå·±ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†è®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸ºLEADINGçŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ï¼›å¦‚æœä¸æ˜¯è‡ªå·±ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†è®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸ºFOLLOWINGçŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596199881,"ip_address":"","comment_id":221129,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23065248938","product_id":100046101,"comment_content":"ä½ å¥½ï¼Œè¯·é—®æŠ•ç¥¨çš„ç»“æœå¦‚ä½•åŒæ­¥çš„å‘¢ï¼Ÿå½“é€‰èŠ‚ç‚¹çŸ¥é“è‡ªå·±æ˜¯ leaderï¼Œæ€ä¹ˆè®©å…¶ä»–èŠ‚ç‚¹ä¹ŸçŸ¥é“å‘¢ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496345,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªæŠ•ç¥¨æ± ï¼Œæ¯ä¸ªæŠ•ç¥¨æ± éƒ½åŒ…å«è‡ªå·±å’Œå…¶ä»–èŠ‚ç‚¹æ¨èçš„é¢†å¯¼è€…çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹èµ¢å¾—å¤§å¤šæ•°æŠ•ç¥¨ï¼Œé‚£ä¹ˆè¿™æ—¶ä¼šåˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯è‡ªå·±ï¼Œå¦‚æœæ˜¯è‡ªå·±ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†è®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸ºLEADINGçŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ï¼›å¦‚æœä¸æ˜¯è‡ªå·±ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†è®¾ç½®è‡ªå·±çš„çŠ¶æ€ä¸ºFOLLOWINGçŠ¶æ€ï¼Œé€€å‡ºé€‰ä¸¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596199881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008517,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","nickname":"å§‘å°„ä»™äºº","note":"","ucode":"3EFC1F3E592165","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354917,"discussion_content":"ä¸æ˜¯leaderä¼šçŸ¥éš¾è€Œé€€ï¼Œå‰©ä¸‹çš„å°±æ˜¯leaderäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615361953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218464,"user_name":"DullBird","can_delete":false,"product_type":"c1","uid":1110494,"ip_address":"","ucode":"80E2FD5F9687CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f1/de/3ebcbb3f.jpg","comment_is_top":false,"comment_ctime":1589805444,"is_pvip":false,"replies":[{"id":"80771","content":"åŠ ä¸€é¢—æ˜Ÿ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589822186,"ip_address":"","comment_id":218464,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23064641924","product_id":100046101,"comment_content":"ä¸ä¼šé€‰ä¸¾å¤±è´¥ã€‚å‡è®¾è¦ç“œåˆ†çš„èŠ‚ç‚¹æ˜¯2ä¸ªï¼Œé‚£ä¹ˆæœ€ç»ˆè¿™2ä¸ªè¿˜æ˜¯éœ€è¦pkä¸€è½®ã€‚å…³é”®æ˜¯zabçš„é€‰ç¥¨ä¸æ˜¯ä¸€å¼ ï¼Œæ˜¯æ”¹å˜å°±å¯ä»¥æŠ•å‡ºå»ã€‚","like_count":5,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495469,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589822186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214439,"user_name":"ç«¹é©¬å½¦å››éƒçš„å¥½æœ‹å‹å½±æ³•å¸«","can_delete":false,"product_type":"c1","uid":1475385,"ip_address":"","ucode":"A9555AEFF90CDF","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/39/f9623363.jpg","comment_is_top":false,"comment_ctime":1588750100,"is_pvip":false,"replies":[{"id":"79482","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼ŒRaftæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªç‰¹æ€§ä¸ZABçš„è®¾è®¡æœ‰å…³ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªè®¾è®¡ä¸æ˜¯å¾ˆç²¾å·§ï¼Œæˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„åŠ é¤ä¸­ï¼Œå…·ä½“è¯´è¯´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1588806582,"ip_address":"","comment_id":214439,"utype":1}],"discussion_count":5,"race_medal":0,"score":"23063586580","product_id":100046101,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ &quot;é€‰ä¸¾å‡ºäº†æ–°é¢†å¯¼è€…ï¼Œå®ƒæ˜¯ä¸æ˜¯å°±å¯ä»¥å¤„ç†å†™è¯·æ±‚äº†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œçš„ï¼Œæ¯”å¦‚è¿™ä¸ªæ—¶å€™å„èŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬è¿˜ä¸ä¸€è‡´å‘¢ï¼Œè¿™å°±éœ€è¦å¯¹æ•°æ®åšå–èˆï¼Œè§£å†³å†²çªï¼Œå®ç°æ•°æ®å‰¯æœ¬çš„ä¸€è‡´&quot;<br>é‚£æ˜¯ä¸æ˜¯raftä¹Ÿæ˜¯å¦‚æ­¤å‘¢? å°±æ˜¯è¯´rafté€‰å‡ºçš„æ–°çš„leaderä¹Ÿä¸èƒ½ç«‹å³å“åº”å†™è¯·æ±‚~ å¯¹å—?","like_count":5,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494055,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼ŒRaftæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªç‰¹æ€§ä¸ZABçš„è®¾è®¡æœ‰å…³ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªè®¾è®¡ä¸æ˜¯å¾ˆç²¾å·§ï¼Œæˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„åŠ é¤ä¸­ï¼Œå…·ä½“è¯´è¯´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588806582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1981636,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","nickname":"Geek_yuanhe","note":"","ucode":"8452947BBF1C36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263426,"discussion_content":"è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿä¸æ˜ç™½ï¼Œè€å¸ˆå¯ä»¥å…ˆè§£ç­”ä¸‹ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589206678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1564447,"avatar":"https://static001.geekbang.org/account/avatar/00/17/df/1f/650a1d51.jpg","nickname":"å°ç™½å…”å¥¶ç³–","note":"","ucode":"AD0B858CFD1304","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":1981636,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","nickname":"Geek_yuanhe","note":"","ucode":"8452947BBF1C36","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270771,"discussion_content":"è€å¸ˆåœ¨åŠ é¤ ï¼ˆä¸‰ï¼‰é‡Œè®²äº†â€¦ä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ç« â€¦ğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590051660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":263426,"ip_address":""},"score":270771,"extra":""},{"author":{"id":1981636,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","nickname":"Geek_yuanhe","note":"","ucode":"8452947BBF1C36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1564447,"avatar":"https://static001.geekbang.org/account/avatar/00/17/df/1f/650a1d51.jpg","nickname":"å°ç™½å…”å¥¶ç³–","note":"","ucode":"AD0B858CFD1304","race_medal":0,"user_type":4,"is_pvip":false},"discussion":{"id":278118,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591152670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":270771,"ip_address":""},"score":278118,"extra":""}]},{"author":{"id":1092218,"avatar":"https://static001.geekbang.org/account/avatar/00/10/aa/7a/ae8c247d.jpg","nickname":"æŒ‡å°–ä»¥ä¸œ","note":"","ucode":"1DEE134FE92FD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259685,"discussion_content":"è¿™ä¸ªæˆ‘ç†è§£å¯¹äºraftå¼ºé¢†å¯¼è€…ï¼Œå†™è¯·æ±‚é€šè¿‡ä»£ç†åˆ°é¢†å¯¼è€…èŠ‚ç‚¹çš„ï¼Œæœ¬èº«å®ƒæ˜¯æœ€å…¨çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¤„ç†å†™è¯·æ±‚äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588811108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219430,"user_name":"å°æ³¢èœ","can_delete":false,"product_type":"c1","uid":1938076,"ip_address":"","ucode":"14A53D3F2E13C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/92/9c/1312b3ca.jpg","comment_is_top":false,"comment_ctime":1590025261,"is_pvip":false,"replies":[{"id":"87940","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¥å—åˆ°æ—§çš„æŠ•ç¥¨ä¿¡æ¯ï¼›ä¼šçš„ï¼Œå…·ä½“ç»†èŠ‚ï¼Œå¯å‚è€ƒFastLeaderElection.lookForLeader() çš„å®ç°ã€‚<br>é—®é¢˜2ï¼šæ˜¯ä¸€ä¸ªAtomicLongçš„å˜é‡ï¼ˆhzxidï¼‰ï¼Œå› ä¸ºé¢†å¯¼è€…çš„å­˜åœ¨ï¼Œæ‰€ä»¥äº‹åŠ¡idï¼Œæœ¬è´¨ä¸Šæ˜¯â€œå•æœºâ€çš„ï¼ŒåŸå­å˜é‡å°±å¯ä»¥äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596045952,"ip_address":"","comment_id":219430,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14474927149","product_id":100046101,"comment_content":"â€œé€»è¾‘æ—¶é’Ÿï¼ˆlogicclockï¼‰ï¼ˆä¹Ÿå°±æ˜¯é€‰ä¸¾çš„è½®æ¬¡ï¼‰ï¼Œä¼šå½±å“é€‰ç¥¨çš„æœ‰æ•ˆæ€§ï¼Œå…·ä½“æ¥è¯´ï¼Œé€»è¾‘æ—¶é’Ÿå¤§çš„èŠ‚ç‚¹ä¸ä¼šæ¥æ”¶æ¥è‡ªå€¼å°çš„èŠ‚ç‚¹çš„æŠ•ç¥¨ä¿¡æ¯ã€‚æ¯”å¦‚ï¼ŒèŠ‚ç‚¹ Aã€B çš„é€»è¾‘æ—¶é’Ÿåˆ†åˆ«ä¸º 1 å’Œ 2ï¼Œé‚£ä¹ˆï¼ŒèŠ‚ç‚¹ B å°†æ‹’ç»æ¥æ”¶æ¥è‡ªèŠ‚ç‚¹ A çš„æŠ•ç¥¨ä¿¡æ¯ã€‚â€<br>è€å¸ˆæˆ‘æƒ³è¯·æ•™ä¸‹ï¼Œ<br>1:é€»è¾‘æ—¶é’Ÿå…·ä½“å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Œè¿™è¾¹å¦‚æœAçš„äº‹åŠ¡idå¤§äºB,Bä¹Ÿç›´æ¥æ‹’ç»å—?<br>2:äº‹åŠ¡idæ˜¯å¦‚ä½•ä¿è¯å…¨å±€å•è°ƒé€’å¢çš„ï¼Œç±»ä¼¼é›ªèŠ±ç®—æ³•å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495804,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¥å—åˆ°æ—§çš„æŠ•ç¥¨ä¿¡æ¯ï¼›ä¼šçš„ï¼Œå…·ä½“ç»†èŠ‚ï¼Œå¯å‚è€ƒFastLeaderElection.lookForLeader() çš„å®ç°ã€‚\né—®é¢˜2ï¼šæ˜¯ä¸€ä¸ªAtomicLongçš„å˜é‡ï¼ˆhzxidï¼‰ï¼Œå› ä¸ºé¢†å¯¼è€…çš„å­˜åœ¨ï¼Œæ‰€ä»¥äº‹åŠ¡idï¼Œæœ¬è´¨ä¸Šæ˜¯â€œå•æœºâ€çš„ï¼ŒåŸå­å˜é‡å°±å¯ä»¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596045952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028940,"avatar":"","nickname":"Geek6561","note":"","ucode":"D44141D4AD2587","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320928,"discussion_content":"ä»€ä¹ˆå«é€‰ä¸¾çš„è½®æ¬¡ï¼Œæ€ä¹ˆåˆ¤æ–­é€‰ä¸¾ç»è¿‡äº†ä¸€è½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604505031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230411,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1593366180,"is_pvip":false,"replies":[{"id":"88051","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥æŠŠé€»è¾‘æ—¶é’Ÿç†è§£ä¸ºé€‰ä¸¾çš„è½®æ¬¡ï¼Œä¼šå½±å“é€‰ç¥¨çš„æœ‰æ•ˆæ€§ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¥å—åˆ°æ—§çš„æŠ•ç¥¨ä¿¡æ¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596136661,"ip_address":"","comment_id":230411,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10183300772","product_id":100046101,"comment_content":"é€»è¾‘æ—¶é’Ÿåˆ°åº•æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘çœ‹åˆ°æºç æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯ä¸€ç›´æŠŠä»–å½“åšå…¶ä»–çš„åˆ¤æ–­æ¡ä»¶ï¼Œæ—¢ç„¶å’Œé€‰ç¥¨PKç±»ä¼¼ï¼Œä¸ºä»€ä¹ˆä¸æŠŠé€»è¾‘æ—¶é’Ÿæ¯”è¾ƒçš„é€»è¾‘åŠ å…¥åˆ°é€‰ç¥¨PKçš„é€»è¾‘totalOrderPredicateä¸­å‘¢ï¼Ÿè¿˜æ˜¯è¯´è¿™ä¸ªé€»è¾‘æ—¶é’Ÿåªæ˜¯ä»£è¡¨äº†æœºå™¨çš„æ ‡è¯†ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499874,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥æŠŠé€»è¾‘æ—¶é’Ÿç†è§£ä¸ºé€‰ä¸¾çš„è½®æ¬¡ï¼Œä¼šå½±å“é€‰ç¥¨çš„æœ‰æ•ˆæ€§ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…æ¥å—åˆ°æ—§çš„æŠ•ç¥¨ä¿¡æ¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596136661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215735,"user_name":"é’Ÿå‹å…µ","can_delete":false,"product_type":"c1","uid":1866454,"ip_address":"","ucode":"BFD61236BF448E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/4uiaFspOvPSF8tzalkP0DvCDme7v53eDGkDMsZsibcm31W99Sib2thFe9m3714d4t7qtIcSeyuR1HiaTXZs4TG8enQ/132","comment_is_top":false,"comment_ctime":1589090829,"is_pvip":false,"replies":[{"id":"80026","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¼•å…¥è¶…æ—¶ï¼Œæ›´ç¡®åˆ‡çš„è¯´æ˜¯è¯»è¶…æ—¶ï¼Œè¯»è¶…æ—¶ä¸”æ²¡æœ‰æ¥æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ–°çš„é€‰ç¥¨ï¼Œé‡æ–°å‘é€è‡ªå·±çš„æŠ•ç¥¨ï¼Œåœ¨ZooKeeperä¸­ï¼Œè¿™ä¸ªå€¼ï¼Œåˆå§‹å€¼ä¸º200msï¼Œä¹‹åæ¯æ¬¡è¶…æ—¶æ—¶ï¼ŒæŒ‡æ•°é€€é¿ï¼Œå¢åŠ æ—¶é•¿ï¼Œæœ€å¤§å€¼ä¸º60sï¼Œå…·ä½“çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒFastLeaderElection.lookForLeader()å‡½æ•°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589232649,"ip_address":"","comment_id":215735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10179025421","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œå¦‚æœè¯´æŠ•ç¥¨æ—¶ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ï¼Œå¯èƒ½å‡ºç°æ¥æ”¶åˆ°çš„é€‰ç¥¨å‡ºç°å»¶è¿Ÿï¼Œæ¯”å¦‚ï¼ŒèŠ‚ç‚¹Aåªæ¥å—åˆ°è‡ªèº«çš„ç¥¨ï¼Œæ²¡æœ‰æ¥æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ç¥¨ï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿå¯èƒ½å‡ºç°æ¥æ”¶åˆ°çš„ç¥¨æ•°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´å—ï¼Ÿå¦‚æœæ˜¯è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªå€¼çš„é€‰å–ä¸€èˆ¬æœ‰ä»€ä¹ˆåŸåˆ™","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494538,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¼•å…¥è¶…æ—¶ï¼Œæ›´ç¡®åˆ‡çš„è¯´æ˜¯è¯»è¶…æ—¶ï¼Œè¯»è¶…æ—¶ä¸”æ²¡æœ‰æ¥æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ–°çš„é€‰ç¥¨ï¼Œé‡æ–°å‘é€è‡ªå·±çš„æŠ•ç¥¨ï¼Œåœ¨ZooKeeperä¸­ï¼Œè¿™ä¸ªå€¼ï¼Œåˆå§‹å€¼ä¸º200msï¼Œä¹‹åæ¯æ¬¡è¶…æ—¶æ—¶ï¼ŒæŒ‡æ•°é€€é¿ï¼Œå¢åŠ æ—¶é•¿ï¼Œæœ€å¤§å€¼ä¸º60sï¼Œå…·ä½“çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒFastLeaderElection.lookForLeader()å‡½æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589232649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213835,"user_name":"å®‹è","can_delete":false,"product_type":"c1","uid":1880075,"ip_address":"","ucode":"7105B7D5B1E338","user_header":"","comment_is_top":false,"comment_ctime":1588573880,"is_pvip":false,"replies":[{"id":"79231","content":"åŠ ä¸€é¢—æ˜Ÿ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1588580860,"ip_address":"","comment_id":213835,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10178508472","product_id":100046101,"comment_content":"åœ¨ç½‘ç»œé€šè®¯æ­£å¸¸æƒ…å†µä¸‹ï¼Œå„ä¸ªèŠ‚ç‚¹éƒ½èƒ½å¤Ÿæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„é€‰ç¥¨ï¼Œæ­¤æ—¶å¿…ç„¶ä¼šé€‰å‡ºæœ€ç»ˆé¢†å¯¼è€…ï¼Œä¸ä¼šå‡ºç°é€‰ç¥¨ç“œåˆ†çš„æƒ…å†µï¼Œå› ä¸ºå³ä¾¿æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹çš„ä»»æœŸç¼–å·å’Œäº‹ç‰©æ ‡è¯†ç¬¦ä¸€æ ·ï¼Œé›†ç¾¤IDå¤§çš„ä»ç„¶ä¼šå½“é€‰ï¼Œé›†ç¾¤IDå°çš„æ ¹æ®è§„åˆ™ä¼šé€‰ä¸¾é›†ç¾¤IDå¤§çš„èŠ‚ç‚¹ä¸ºé¢†å¯¼è€…ã€‚","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493882,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588580860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315527,"avatar":"https://static001.geekbang.org/account/avatar/00/14/12/c7/a7a5df8b.jpg","nickname":"è¾¾å­ä¸ä¸€èˆ¬","note":"","ucode":"A91C8DB45184F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400743,"discussion_content":"å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½å¤Ÿæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„é€‰ç¥¨ï¼Œæ­¤æ—¶å¿…ç„¶ä¼šé€‰å‡ºæœ€ç»ˆé¢†å¯¼è€…ã€‚é‚£å°±ä¸æ˜¯å¾—åˆ°å¤§å¤šæ•°çš„æŠ•ç¥¨ï¼Œè€Œæ˜¯å¾—åˆ°æ‰€æœ‰çš„æŠ•ç¥¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633404855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341553,"user_name":"arun","can_delete":false,"product_type":"c1","uid":1145846,"ip_address":"","ucode":"1C889D0BB036C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/f6/3f8f6775.jpg","comment_is_top":false,"comment_ctime":1649688427,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5944655723","product_id":100046101,"comment_content":"è€å¸ˆ,é€»è¾‘æ—¶é’Ÿå’Œepochæ˜¯åŒä¸€ä¸ªä¹ˆ,ä»–ä»¬çš„å…³ç³»æ˜¯ä»€ä¹ˆå‘¢?é€»è¾‘æ—¶é’Ÿå¯ä»¥ç†è§£ä¸ºæ¯æ¬¡leaderæŒ‚æ‰é‡æ–°é€‰ä¸¾æ—¶,é€»è¾‘æ—¶é’Ÿä¼šé‡ç½®ä¸º0,è€Œepochæ˜¯æ¯æ¬¡è§¦å‘é€‰ä¸¾éƒ½ä¼šåŠ 1,ä¸çŸ¥é“ç†è§£çš„æ—¶å€™æ­£ç¡®,è°¢è°¢è€å¸ˆè§£ç­”","like_count":1},{"had_liked":false,"id":353224,"user_name":"Geek_c89d45","can_delete":false,"product_type":"c1","uid":2900023,"ip_address":"å¹¿ä¸œ","ucode":"43BDF15D01B1D4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJnywjwpeXxRz0ibZS0ibmhVytkVnXiaTjPuicicWNcjiaUsiaicTEGQgtR4bj3ddMnUOKUiau2zcb1UG1R99g/132","comment_is_top":false,"comment_ctime":1659280315,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1659280315","product_id":100046101,"comment_content":"ä¸ä¼šå‡ºç°é€‰ç¥¨ç“œåˆ†çš„æƒ…å†µï¼Œå› ä¸ºé¢†å¯¼è€…pkæ€»èƒ½æ¯”è¾ƒå‡ºä¼˜åŠ£ï¼Œå³ä½¿epochç›¸åŒã€zxidç›¸åŒï¼Œæœ€ç»ˆè¿˜æœ‰myidå…œåº•ï¼Œmyidæ˜¯ä¸€å®šä¸åŒçš„ã€‚","like_count":0},{"had_liked":false,"id":315144,"user_name":"å¾åŒå­¦å‘€","can_delete":false,"product_type":"c1","uid":1252813,"ip_address":"","ucode":"03383EE820514D","user_header":"https://static001.geekbang.org/account/avatar/00/13/1d/cd/3819726f.jpg","comment_is_top":false,"comment_ctime":1633701519,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1633701519","product_id":100046101,"comment_content":"åŸæ–‡ï¼šå½“è·Ÿéšè€…æ£€æµ‹åˆ°å¼‚å¸¸ï¼Œé€€å‡ºè·Ÿéšè€…çŠ¶æ€æ—¶ï¼ˆåœ¨ follower.shutdown() å‡½æ•°ä¸­ï¼‰ï¼ŒZooKeeper ä¼šå°†æ‰€æœ‰æœªæäº¤ææ¡ˆæäº¤<br><br>ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰åœ¨æºç ä¸­æ‰¾åˆ°ï¼ˆ3.7.0ï¼‰ï¼Œå“ªä½å¤§ä½¬æ‰¾åˆ°äº†å¯ä»¥è´´ä¸€ä¸‹å±€éƒ¨ä»£ç å—","like_count":0,"discussions":[{"author":{"id":1227789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","nickname":"ğŸ‘»","note":"","ucode":"1648C82AC73C1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560399,"discussion_content":"æˆ‘ä¹Ÿä¸ç†è§£è¿™å¥è¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649315312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314762,"user_name":"è¾¾å­ä¸ä¸€èˆ¬","can_delete":false,"product_type":"c1","uid":1315527,"ip_address":"","ucode":"A91C8DB45184F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/c7/a7a5df8b.jpg","comment_is_top":false,"comment_ctime":1633407419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633407419","product_id":100046101,"comment_content":"ä¸ºä»€ä¹ˆéœ€è¦é¢†å¯¼è€…pkï¼Œpkç»“æœå†è¿›è¡Œå¹¿æ’­ï¼Ÿ<br><br>ç¬¬ä¸€è½®æŠ•ç¥¨å¹¿æ’­åï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä»å…¶ä»–èŠ‚ç‚¹çš„responseä¸­çŸ¥é“è‡ªå·±æ˜¯å¦æ˜¯æ•°æ®æœ€å®Œå¤‡çš„èŠ‚ç‚¹åŠæ•°æ®æœ€å®Œå¤‡çš„èŠ‚ç‚¹æ˜¯è°ï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥æ›´æ–°LEADINGå’ŒFOLLOWINGçŠ¶æ€äº†","like_count":0},{"had_liked":false,"id":301441,"user_name":"Jia Tiancai","can_delete":false,"product_type":"c1","uid":2548102,"ip_address":"","ucode":"EF2F5FE8A0DF3E","user_header":"","comment_is_top":false,"comment_ctime":1625700885,"is_pvip":false,"discussion_count":0,"race_medal":3,"score":"1625700885","product_id":100046101,"comment_content":"1. é¢†å¯¼è€…é€‰ä¸¾çš„ç›®æ ‡ï¼Œæ˜¯é€‰ä¸¾å‡ºå¤§å¤šæ•°èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­äº‹åŠ¡æ ‡è¯†ç¬¦å€¼æœ€å¤§çš„èŠ‚ç‚¹ã€‚<br>é—®é¢˜1ï¼šå¦‚æœåªæœ‰å°‘æ•°èŠ‚ç‚¹æ•°æ®æ›´æ–°ï¼Œé€‰ä¸¾å‡ºæ¥çš„ä¸»èŠ‚ç‚¹æ•°æ®å¯èƒ½ä¸æ˜¯æœ€å®Œæ•´çš„å§ï¼Ÿ<br>é—®é¢˜2ï¼šä¸€ä¸ªä»»æœŸå†…èŠ‚ç‚¹å¯ä»¥å“åº”å¤šæ¬¡ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨å¤šä¸ªèŠ‚ç‚¹éƒ½è·å–å¤§å¤šæ•°é€‰ç¥¨ï¼Œå‡ºç°è¿™ç§æƒ…å†µæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":293538,"user_name":"amy","can_delete":false,"product_type":"c1","uid":1106631,"ip_address":"","ucode":"C6DAA11AFD3EC9","user_header":"https://static001.geekbang.org/account/avatar/00/10/e2/c7/f671bd93.jpg","comment_is_top":false,"comment_ctime":1621423667,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621423667","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œä¹Ÿå°±æ˜¯åœ¨ follower æ£€æµ‹åˆ° leader å´©æºƒé€€å‡ºåï¼Œfollower åˆ‡æ¢çŠ¶æ€ä¸ºé€‰ä¸¾çŠ¶æ€å¹¶ç”Ÿæˆåˆå§‹æŠ•ç¥¨æ—¶ï¼Œé€‰å–çš„äº‹åŠ¡ zxid æ˜¯æ‰€æœ‰æ¥æ”¶åˆ°çš„ proposal ä¸­æœ€å¤§çš„ zxidï¼Œå°½ç®¡è¿™ä¸ª proposal å¯èƒ½è¿˜æ²¡æœ‰è¢« commitã€‚ æ¯”å¦‚ï¼Œé™¤äº†åŸæ¥æ—§çš„ leader å¤–ï¼Œä¸€ä¸ª proposal ä»…ä»…åªè¢«é›†ç¾¤ä¸­çš„ä¸€ä¸ª follower æ”¶åˆ°ï¼Œåœ¨é‡æ–°é€‰ leader æ—¶ï¼Œæ‹¥æœ‰è¿™ä¸ª proposal çš„ follower ä¼šè¢«é€‰ä¸ºæ–°çš„ leader ï¼Œå› ä¸ºäº‹åŠ¡id zxid æœ€å¤§ï¼Œç„¶åè¿™ä¸ª proposal ä¼šè¢«åŒæ­¥åˆ°æ•´ä¸ªé›†ç¾¤ã€‚","like_count":0,"discussions":[{"author":{"id":1181844,"avatar":"https://static001.geekbang.org/account/avatar/00/12/08/94/2c22bd4e.jpg","nickname":"å…‹é‡Œæ–¯","note":"","ucode":"00B755C10AC1C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531965,"discussion_content":"æ–°çš„leaderä¼šæ£€æŸ¥è‡ªèº«æœ‰æ²¡æœ‰æœªè¢«æäº¤çš„ææ¡ˆï¼Œå¦‚æœæœ‰çš„ï¼Œåˆ™ä¼šå‘é›†ç¾¤ä¸­å‘é€è¯·æ±‚ï¼Œè¯¢é—®å…¶ä»–followèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨å…¶ææ¡ˆï¼Œ\nå¦‚æœè¶…è¿‡åŠæ•°å›å¤ok,åˆ™æ‰§è¡Œæäº¤æ“ä½œï¼Œä¹‹åè¿›è¡Œæ•°æ®åŒæ­¥æ“ä½œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637484226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279009,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1613540480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613540480","product_id":100046101,"comment_content":"<br>epochå’Œé€»è¾‘æ—¶é’Ÿæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿzookeeperçš„paperä¸­çš„ä¼ªä»£ç ç”¨roundè¿™ä¸ªå˜é‡æ¥ä»£è¡¨é€»è¾‘æ—¶é’Ÿï¼Œå…¶åˆ¤æ–­é€»è¾‘å’Œæ–‡ç« ä¸­è¯´çš„æ˜¯ä¸€æ ·çš„ã€‚é‚£epochè¿˜æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿèƒ½å¦èµ·åˆ°raftä¸­termç±»ä¼¼çš„ä½œç”¨ï¼Ÿæœ‰ç‚¹ç³Šæ¶‚äº†ã€‚é€»è¾‘æ—¶é’ŸçŸ¥å¦åªæœ‰åœ¨lookForLeaderæ–¹æ³•ä¸­æ‰ä¼š+1ï¼Ÿ","like_count":0},{"had_liked":false,"id":276015,"user_name":"Bachue Zhou","can_delete":false,"product_type":"c1","uid":1494491,"ip_address":"","ucode":"3175754775CA32","user_header":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","comment_is_top":false,"comment_ctime":1611746367,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1611746367","product_id":100046101,"comment_content":"æ„Ÿè§‰è¿™ä¸ªé€‰ä¸¾ç®—æ³•å¥½æ…¢ï¼Œä¸­é—´æœ‰ä¸å°‘é€šè®¯å…¶å®æ˜¯å¯ä»¥çœç•¥çš„ï¼Œè¿‡å¤šçš„é€šè®¯åœ¨ç½‘ç»œè¾ƒå·®çš„æƒ…å†µä¸‹å¿…ç„¶å‡æ…¢é€‰ä¸¾é€Ÿåº¦ï¼Œè€Œæ ¹æ®æˆ‘çš„ç†è§£ï¼Œè¿Ÿè¿Ÿé€‰ä¸å‡ºé¢†å¯¼è€…ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½å†™å…¥äº†ï¼Œä¹Ÿå°±æ˜¯è™½ç„¶æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼Œç³»ç»Ÿäº‹å®ä¸Šä¸å¯ç”¨ã€‚","like_count":0,"discussions":[{"author":{"id":2743526,"avatar":"","nickname":"Geek_0be686","note":"","ucode":"8308443BAD3B12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390939,"discussion_content":"zabåè®®æ˜¯multi paxosçš„å®è·µï¼Œåº”è¯¥å¯ä»¥çœç•¥å‡†å¤‡è¯·æ±‚é˜¶æ®µå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630163347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690353,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ca/f1/0981a55f.jpg","nickname":"BurukeYou","note":"","ucode":"AEE5D8C205ECD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359555,"discussion_content":"è¿™ä¸ªä¸æ˜¯å«å¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾ç®—æ³•å—ğŸ˜‚åº”è¯¥ä¸ä¼šæ…¢å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616227569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259094,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1604629689,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1604629689","product_id":100046101,"comment_content":"æ˜¯æ€ä¹ˆè®¡ç®—é€‰ç¥¨çš„äº†ã€‚æ¯ä¸ªlookingèŠ‚ç‚¹æ˜¯è¦è®°å½•æŠ•ç¥¨ä¿¡æ¯å—ï¼Ÿé‚£lookingèŠ‚ç‚¹æ€ä¹ˆçŸ¥é“æŠ•ç¥¨æ•°è¶…è¿‡å¤§å¤šæ•°èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯å®ƒæ€ä¹ˆçŸ¥é“å½“å‰å‚ä¸æ‰€æœ‰é€‰ä¸¾æ‰€æœ‰èŠ‚ç‚¹ä¸ªæ•°ã€‚","like_count":0},{"had_liked":false,"id":242501,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1597743345,"is_pvip":false,"replies":[{"id":"90287","content":"åŠ ä¸€é¢—æ˜Ÿ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1598966197,"ip_address":"","comment_id":242501,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1597743345","product_id":100046101,"comment_content":"ZABåè®®ä¸­,ZABåè®®æ˜¯é€šè¿‡å¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾,æ¥é€‰ä¸¾å‡ºæ–°çš„é¢†å¯¼è€…çš„,é‚£ä¹ˆä¼šå‡ºç°é€‰ç¥¨ä¼šç“œåˆ†çš„æƒ…å†µå—?<br>å¿…ç„¶å¯èƒ½å•Š,ZABæ˜¯ä¸€ç§è„±èƒäºMulti-Paxosçš„ç®—æ³•,å…¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§æŠ•ç¥¨é€‰ä¸¾,é‚£ä¹ˆå¯¹äºè¿™ç§æŠ•ç¥¨é€‰ä¸¾,è®¾ç½®ä¸åŒçš„é€‰ä¸¾æ—¶é—´æ˜¯ä¸€ç§ç›¸å¯¹è¾ƒå¥½çš„é€‰æ‹©<br>çœ‹åˆ°è¿™ä¸ªé€‰ä¸¾çªç„¶æƒ³åˆ°äº†ç½‘ç»œç¯è·¯ä¸­STPçš„ç®—æ³•è§£å†³","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504022,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598966197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028944,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/90/2caa07d0.jpg","nickname":"Geek8815","note":"","ucode":"D5102AFFA20E7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591319,"discussion_content":"ä¸ºå•¥ä¼šåŠ ä¸€é¢—æ˜Ÿï¼Œä¸æ˜¯åº”è¯¥ä¸ä¼šå‡ºç°ç“œåˆ†ç¥¨æ•°å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666495227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240757,"user_name":"è¥¿é—¨å¹ç‰›","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1597054404,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1597054404","product_id":100046101,"comment_content":"é€»è¾‘æ—¶é’Ÿæ€ä¹ˆç†è§£ï¼Œä¸æ˜¯åº”è¯¥æ‰€æœ‰èŠ‚ç‚¹éƒ½å‚ä¸é€‰ä¸¾å—ï¼Œé€‰ä¸¾ä¸€æ¬¡é€»è¾‘æ—¶é’ŸåŠ 1ï¼Œé‚£æ‰€æœ‰èŠ‚ç‚¹çš„é€»è¾‘æ—¶é’Ÿä¸æ˜¯åº”è¯¥ç›¸åŒå—","like_count":0,"discussions":[{"author":{"id":1314800,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/f0/37feaa1d.jpg","nickname":"é©¬æ—","note":"","ucode":"38AA3E2EB1CC5F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379890,"discussion_content":"ä¼šå‡ºç°é›†ç¾¤æ–°åŠ å…¥èŠ‚ç‚¹è·ŸèŠ‚ç‚¹æ•…éšœæ¢å¤çš„æƒ…å†µ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624205298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}