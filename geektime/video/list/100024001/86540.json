{"id":86540,"title":"27 | channelçš„å…³é—­å’Œå¹¿æ’­","content":"<h1>è¯¾ä»¶åŠæºä»£ç åœ°å€</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>ä¹¦ç›®æ¨è</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹</a></p>","comments":[{"had_liked":false,"id":79348,"user_name":"Harryé™ˆç¥¥","can_delete":false,"product_type":"c3","uid":1016584,"ip_address":"","ucode":"EC44D97731116D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/08/91caf5c1.jpg","comment_is_top":false,"comment_ctime":1553441637,"is_pvip":false,"replies":[{"id":28940,"content":"è¿™ä¸ªåœ¨å‰é¢çš„è¯¾ç¨‹ä¸­è®²åˆ°è¿‡ï¼Œchanæ˜¯ä¸€ä¸ªç»“æ„ï¼Œè¿™ä¸ªç»“æ„åœ¨ä¼ é€’æ—¶æ˜¯è¢«å¤åˆ¶çš„ï¼Œå…¶ä¸­çš„æŒ‡é’ˆæˆå‘˜ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°æ–°çš„chanä¸­ï¼Œæ‰€ä»¥æ–°æ—§ä¸¤ä¸ªchanä¼šæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åŒºåŸŸ","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1553470756,"ip_address":"","comment_id":79348,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚\nä¼ å‚ chançš„æ—¶å€™ï¼ŒæŒ‡é’ˆä¼ å‚å’Œå€¼ä¼ å‚ï¼Œçœ‹èµ·æ¥å¥½åƒéƒ½å¯ä»¥workï¼Œè€Œä¸”å¤ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ªé€šé“ã€‚\n\né‚£å¯¹äºchançš„å€¼ä¼ å‚ï¼Œcopyçš„æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444464,"discussion_content":"è¿™ä¸ªåœ¨å‰é¢çš„è¯¾ç¨‹ä¸­è®²åˆ°è¿‡ï¼Œchanæ˜¯ä¸€ä¸ªç»“æ„ï¼Œè¿™ä¸ªç»“æ„åœ¨ä¼ é€’æ—¶æ˜¯è¢«å¤åˆ¶çš„ï¼Œå…¶ä¸­çš„æŒ‡é’ˆæˆå‘˜ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°æ–°çš„chanä¸­ï¼Œæ‰€ä»¥æ–°æ—§ä¸¤ä¸ªchanä¼šæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åŒºåŸŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553470756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1658796,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4f/ac/80439ba7.jpg","nickname":"Aprelude","note":"","ucode":"840D3F7A35AEEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293523,"discussion_content":"é‚£ä¼ chançš„æ—¶å€™ chanæ˜¯å¤åˆ¶åœ°å€ è¿˜æ˜¯å¤åˆ¶chançš„ç»“æ„ä½“å‘¢ ï¼Œç±»ä¼¼äºåˆ‡ç‰‡è¿˜æ˜¯æ•°ç»„å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595566366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234427,"user_name":"éƒ­æ˜Ÿ","can_delete":false,"product_type":"c3","uid":1182219,"ip_address":"","ucode":"8A0F5DF80E0C61","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/0b/985d3800.jpg","comment_is_top":false,"comment_ctime":1594690480,"is_pvip":false,"replies":[{"id":87662,"content":" goè¯­è¨€æ˜¯ä¹‹ä¼ é€’çš„ï¼Œæ‰€æœ‰å¦‚æœä¸ç”¨æŒ‡é’ˆï¼Œreceiverä¸­çš„wgå°†æ˜¯ä¸€ä¸ªå‰¯æœ¬å¹¶æŒ‡å‘ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥wg.Done()å¹¶ä¸ä¼šæ˜¯å¤–éƒ¨ä¸åŒå‰¯æœ¬çš„wg.Wait()è§£é™¤ç­‰å¾…","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1595767446,"ip_address":"","comment_id":234427,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"package close\n\nimport (\n\t&quot;fmt&quot;\n\t&quot;sync&quot;\n\t&quot;testing&quot;\n)\n\n&#47;&#47; å‘å¸ƒè€…\nfunc publisher(ch chan int) {\n\tgo func() {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tch &lt;- i\n\t\t}\n\t}()\n}\n\n&#47;&#47; æ¥å—è€…\nfunc receiver(ch chan int, wg sync.WaitGroup) {\n\tgo func() {\n\t\t&#47;&#47;for {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tfmt.Println(&lt;-ch)\n\t\t}\n\t\twg.Done()\n\t}()\n}\n\nfunc TestPubRe(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tch := make(chan int)\n\tpublisher(ch)\n\twg.Add(1)\n\treceiver(ch, wg)\n\twg.Wait()\n}\nå½“WaitGroupä½¿ç”¨å€¼æ¥æ”¶æ—¶ä¸ºä»€ä¹ˆä¼šæŠ¥fatal error: all goroutines are asleep - deadlock!; ? \nä½†å½“æˆ‘ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶æ—¶,å°±ä¸ä¼šæŠ›å‡ºdeadlock","like_count":3,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501388,"discussion_content":" goè¯­è¨€æ˜¯ä¹‹ä¼ é€’çš„ï¼Œæ‰€æœ‰å¦‚æœä¸ç”¨æŒ‡é’ˆï¼Œreceiverä¸­çš„wgå°†æ˜¯ä¸€ä¸ªå‰¯æœ¬å¹¶æŒ‡å‘ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥wg.Done()å¹¶ä¸ä¼šæ˜¯å¤–éƒ¨ä¸åŒå‰¯æœ¬çš„wg.Wait()è§£é™¤ç­‰å¾…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595767446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2403351,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ac/17/430ddd05.jpg","nickname":"ğŸŸ","note":"","ucode":"F61C3F67E4A2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":542619,"discussion_content":"å•Šï¼Ÿè¿™æ˜¯ä¸ºä»€ä¹ˆå•Šï¼Ÿ å€¼ä¼ é€’çš„æƒ…å†µä¸‹ï¼Œwg è™½ç„¶ç»“æ„è¢«å¤åˆ¶äº†ä¸€ä»½ï¼Œä½†æ˜¯ç»“æ„é‡Œé¢çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜è¿˜æ˜¯åŒä¸€å—å„¿å§ï¼Ÿ æˆ‘è¿·æƒ‘äº†è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640795666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":501388,"ip_address":"","group_id":0},"score":542619,"extra":""}]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600938,"discussion_content":"wg Done å°±æ˜¯ä¸€ä¸ª è®¡æ•°å™¨è€Œå·²ï¼Œ\nfunc (wg *WaitGroup) Done() {\n\twg.Add(-1)\n}\nè¿™æœ‰å•¥è¿·æƒ‘çš„ï¼Œä½ è¦ä¿®æ”¹è¿™é‡Œé¢çš„æ•°å­—ï¼Œä½ å°±å¾—ä¼ é€’æŒ‡é’ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674963484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250890,"user_name":"Geek_427d0c","can_delete":false,"product_type":"c3","uid":1876823,"ip_address":"","ucode":"D7A04138C4B8CB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","comment_is_top":false,"comment_ctime":1601274046,"is_pvip":false,"replies":[{"id":99524,"content":"è¿™ä¸ªæˆ‘åœ¨è®²åº§ä¸­æœ‰è®²è¿‡ï¼š\n1 Goè¯­è¨€æ˜¯éƒ½æ˜¯ä¼ å€¼çš„ï¼Œ\n2 chanæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¢«å¤åˆ¶åå…¶ä¸­çš„æˆå‘˜ä»æŒ‡å‘åŒä¸€å†…å­˜åŒºåŸŸï¼Œç±»ä¼¼çš„è¿˜æœ‰sliceå’Œmap","user_name":"ä½œè€…å›å¤","user_name_real":"è”¡è¶…","uid":1008262,"ctime":1610891685,"ip_address":"","comment_id":250890,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func dataProducer(ch chan int, wg *sync.WaitGroup) è€å¸ˆï¼Œä¸ºä»€ä¹ˆä½ åªæŠŠWaitGroupçš„æŒ‡é’ˆä¼ è¿›å»ï¼Œè€Œchannelä¸ä¼ æŒ‡é’ˆå‘¢ï¼Ÿç¼–ç¨‹(ch *chan int, wg *sync.WaitGroup)?","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506327,"discussion_content":"è¿™ä¸ªæˆ‘åœ¨è®²åº§ä¸­æœ‰è®²è¿‡ï¼š\n1 Goè¯­è¨€æ˜¯éƒ½æ˜¯ä¼ å€¼çš„ï¼Œ\n2 chanæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¢«å¤åˆ¶åå…¶ä¸­çš„æˆå‘˜ä»æŒ‡å‘åŒä¸€å†…å­˜åŒºåŸŸï¼Œç±»ä¼¼çš„è¿˜æœ‰sliceå’Œmap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610891685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83184,"user_name":"Steven Fung","can_delete":false,"product_type":"c3","uid":1052952,"ip_address":"","ucode":"193D1031AA362B","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/18/bba8efd2.jpg","comment_is_top":false,"comment_ctime":1554453891,"is_pvip":false,"replies":[{"id":30063,"content":"è¿™æ˜¯å› ä¸ºä½ ç”¨çš„æ˜¯buffered chanä»–æ˜¯éé˜»å¡çš„ã€‚æ‰€ä»¥åªè¦å¤–é¢çš„ä¸»åç¨‹åœ¨é€€å‡ºå‰èƒ½æœ‰æ—¶é—´è®©ä»–è¿è¡Œå®Œï¼Œä»–å°±å¯ä»¥è¾“å‡ºã€‚\nä½ å¯ä»¥åœ¨TestSelectæœ€åé€€å‡ºå‰åŠ ä¸€ä¸ªsleep 1ç§’ï¼Œä½ å°±ä¼šå‘ç°æ›´çŸ­çš„timeoutä¸€æ ·ä¼šè¾“å‡ºé‚£äº›ä¿¡æ¯","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1554476779,"ip_address":"","comment_id":83184,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func serviceOne() string {\n\ttime.Sleep(time.Millisecond * 50)\n\treturn &quot;service 1 done&quot;\n}\n\nfunc channelserviceone_2nd() chan string {\n\tretCh := make(chan string, 1)\n\tgo func() {\n\t\tret := serviceOne()\n\t\tfmt.Println(&quot;returned result.&quot;)\n\t\tretCh &lt;- ret\n\t\tfmt.Println(&quot;service exited.&quot;)\n\t}()\n\treturn retCh\n}\n\nfunc TestSelect(t *testing.T) {\n\tselect {\n\tcase ret := &lt;-channelserviceone_2nd():\n\t\tt.Log(ret)\n\tcase &lt;-time.After(time.Millisecond * 49):\n\t\tt.Log(&quot;time out&quot;)\n\t}\n}\n\nOutput:\n=== RUN   TestSelect\nreturned result.\nservice exited.\n--- PASS: TestSelect (0.05s)\n    &#47;Users&#47;stevenfung&#47;Documents&#47;code&#47;go&#47;src&#47;github.com&#47;CrazyPassion&#47;go&#47;helloworld&#47;test&#47;goroutine&#47;goroutine_test.go:115: time out\nPASS\nok  \tgithub.com&#47;CrazyPassion&#47;go&#47;helloworld&#47;test&#47;goroutine\t0.058s\nSuccess: Tests passed.\nè€å¸ˆï¼Œè¯·æ•™ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæƒ³ä¸æ˜ç™½ã€‚æŒ‰è¯´serviceOneç­‰å¾…æ˜¯50msï¼Œ49msä¼šè¶…æ—¶ï¼Œè§‰å¾—åº”è¯¥çœ‹ä¸åˆ°channelserviceone_2ndé‡Œé¢çš„æ‰“å°ï¼Œä½†æ˜¯ç°åœ¨å¯ä»¥çœ‹åˆ°ï¼Œå¹¶ä¸”ä¹Ÿçœ‹åˆ°äº†è¶…æ—¶çš„æ‰“å°ï¼Œè¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445908,"discussion_content":"è¿™æ˜¯å› ä¸ºä½ ç”¨çš„æ˜¯buffered chanä»–æ˜¯éé˜»å¡çš„ã€‚æ‰€ä»¥åªè¦å¤–é¢çš„ä¸»åç¨‹åœ¨é€€å‡ºå‰èƒ½æœ‰æ—¶é—´è®©ä»–è¿è¡Œå®Œï¼Œä»–å°±å¯ä»¥è¾“å‡ºã€‚\nä½ å¯ä»¥åœ¨TestSelectæœ€åé€€å‡ºå‰åŠ ä¸€ä¸ªsleep 1ç§’ï¼Œä½ å°±ä¼šå‘ç°æ›´çŸ­çš„timeoutä¸€æ ·ä¼šè¾“å‡ºé‚£äº›ä¿¡æ¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554476779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600934,"discussion_content":"æ‰“å°å‡ºè¿™ä¸€å¥å¹¶ä¸ä»£è¡¨å°±åŒæ—¶æ‰§è¡Œäº†ä¸¤ä¸ª caseï¼Œè°ƒç”¨ channelserviceone_2nd() å°±ä¼šå¯åŠ¨å®ƒé‡Œé¢çš„ goroutineï¼Œè¿™ä¸ªgoroutine å®é™…ä¸Šæ²¡æœ‰æ²¡æœ‰å®Œå…¨æ‰§è¡Œå®Œï¼Œå¾—åˆ°äº†ç¬¬äºŒä¸ª case çš„è¶…æ—¶ï¼Œæ‰€ä»¥å°±è¾“å‡º time outï¼Œæˆ‘åœ¨ä¸Šä¸€ç¯‡çš„è¯„è®ºåŒºä¸­ç»™å‡ºäº†ä¾‹å­ï¼Œè¿™ä¹Ÿæ˜¯ select çš„çœŸæ­£çš„ç”¨å¤„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674963271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366268,"discussion_content":"æŒ‰ç…§è€å¸ˆæç¤ºï¼Œå°† timeout çš„æ—¶é—´æ”¹ä¸ºäº† 30 msï¼Œåœ¨ TestSelect åé¢å¢åŠ äº† sleep 1 ç§’\nfunc TestSelectAgain(t *testing.T) {\n    select {\n    case ret := <-channelserviceone_2nd():\n        t.Log(ret)\n    case <-time.After(time.Millisecond * 30):\n        t.Log(&#34;time out&#34;)\n    }\n    time.Sleep(time.Second * 1)\n}\nè¾“å‡ºå¦‚ä¸‹ï¼š\n\n=== RUN   TestSelectAgain\n   ... /src/channel_close_test.go:86: time out\nreturned result.\nservice exited.\n--- PASS: TestSelectAgain (1.04s)\n\nå¯ä»¥çœ‹åˆ°å³ä½¿æ˜¯è¶…æ—¶äº†ï¼Œä»ç„¶è¾“å‡ºäº† channelserviceone_2nd é‡Œé¢çš„æ‰“å°ã€‚\n\nå¦å¤–ï¼Œå¦‚æœå°†é€šé“æ”¹ä¸ºéé˜»å¡çš„ï¼ˆä¸å¢åŠ  sleepï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°ï¼š\n\nreturned result.\n    .../src/channel_close_test.go:86: time out\n\næ‰“å°å‡ºäº†ä¸€å¥ï¼Œç¨å¾®æœ‰ä¸€ç‚¹è¯¡å¼‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618017950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2719667,"avatar":"https://static001.geekbang.org/account/avatar/00/29/7f/b3/e50ec43e.jpg","nickname":"æŸ¥ç†å®‰","note":"","ucode":"D9432FE5E2C1AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":401019,"discussion_content":"æœ€ååªæ‰“å°å‡ºäº†ä¸€å¥æ˜¯å› ä¸ºä¸»åç¨‹æ‰§è¡Œå®Œäº†ï¼Œå‰©ä¸‹çš„&#34;service exited.&#34;æ²¡æ¥å¾—åŠæ‰§è¡Œåˆ°å°±é€€å‡ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633522823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":366268,"ip_address":"","group_id":0},"score":401019,"extra":""}]}]},{"had_liked":false,"id":143224,"user_name":"ç¢§é›ªå¤©è™¹","can_delete":false,"product_type":"c3","uid":1258359,"ip_address":"","ucode":"313CC048C7E341","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/77/0c593044.jpg","comment_is_top":false,"comment_ctime":1571651213,"is_pvip":false,"replies":[{"id":55917,"content":"é€šé“åº”è¯¥ç”±ç”Ÿäº§è€…æ¥å…³é—­ï¼Œåœ¨å…³é—­çš„channelä¸Šå‘é€æ•°æ®ç¨‹åºä¼španic","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1572178671,"ip_address":"","comment_id":143224,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ data,ok&lt;-ch æ¥åˆ¤æ–­é€šé“æ˜¯å¦å…³é—­, ç”Ÿäº§è€…å¦‚ä½•åˆ¤æ–­é€šé“æ˜¯å¦å…³é—­?\n\nfunc TestCloseChannel(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tch := make(chan int)\n\tdataProducer(ch, &amp;wg)\n\tdataReceiver(ch, &amp;wg)\n        &#47;&#47; å·²ç»å…³é—­é€šé“, ç”Ÿäº§è€…å¦‚ä½•åˆ¤æ–­\n\tclose(ch)\n\twg.Wait()\n}\n","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471431,"discussion_content":"é€šé“åº”è¯¥ç”±ç”Ÿäº§è€…æ¥å…³é—­ï¼Œåœ¨å…³é—­çš„channelä¸Šå‘é€æ•°æ®ç¨‹åºä¼španic","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572178671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250936,"user_name":"Geek_427d0c","can_delete":false,"product_type":"c3","uid":1876823,"ip_address":"","ucode":"D7A04138C4B8CB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","comment_is_top":false,"comment_ctime":1601284844,"is_pvip":false,"replies":[{"id":91843,"content":"åœ¨go testçš„è¿è¡Œç¨‹åºä¸­ä¹Ÿè¦å®ç”¨fmtè¾“å‡ºï¼Œä¸è¦ä½¿ç”¨t.log.\né€šè¿‡go test -vè¿è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1601386342,"ip_address":"","comment_id":250936,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è¯·æ•™è€å¸ˆï¼Œgo runå’Œgo testæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ æˆ‘ä¸ºäº†å®ç°æ¶ˆè´¹è€…æ¯éš”ä¸€ç§’æ‰“å°0ï¼Œ1ï¼Œ2...ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§è€…çš„åç¨‹é‡ŒåŠ äº†ä¸€ä¸ªtime.Sleepï¼Œä¹Ÿå°±æ˜¯æ¯éš”ä¸€ç§’äº§ç”Ÿä¸€ä¸ªæ•°å­—ã€‚IDEçš„debugæ¨¡å¼å’Œgo runéƒ½èƒ½æ­£å¸¸å®ç°ï¼Œä½†æ˜¯go testçœ‹èµ·æ¥å°±åƒæŠŠè¾“å‡ºç¼“å­˜èµ·æ¥ï¼Œç„¶åç­‰æœ€å¤–é¢é¢åç¨‹æ‰§è¡Œå®Œï¼Œä¸€ä¸‹å­æ‰“å°æ‰€æœ‰çš„è¾“å‡º","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506339,"discussion_content":"åœ¨go testçš„è¿è¡Œç¨‹åºä¸­ä¹Ÿè¦å®ç”¨fmtè¾“å‡ºï¼Œä¸è¦ä½¿ç”¨t.log.\né€šè¿‡go test -vè¿è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601386342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177240,"user_name":"é»„ä¸‰å¯","can_delete":false,"product_type":"c3","uid":1132988,"ip_address":"","ucode":"DDD0ED0C1E419F","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/bc/c324a7de.jpg","comment_is_top":false,"comment_ctime":1581330564,"is_pvip":false,"replies":[{"id":70076,"content":"WaitGroupç±»ä¼¼äºChannelè¿™æ ·çš„å¯¹è±¡ï¼Œä»–çš„å®šä¹‰æ˜¯ä¸€ä¸ªç»“æ„ï¼Œè™½ç„¶å¯¹è±¡å¤åˆ¶äº†ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æˆå‘˜è¿˜æ˜¯æŒ‡å‘åŒä¸€åœ°å€ç©ºé—´çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1582344385,"ip_address":"","comment_id":177240,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"æœ¬èŠ‚ä¸­çš„dataProduceræ–¹æ³•ï¼ŒwaitGroupä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œä¸ºä»€ä¹ˆåœ¨æ–¹æ³•ä½“ä¸­ä½¿ç”¨æ—¶ï¼Œä¸éœ€è¦åƒä¼ å…¥intæŒ‡é’ˆä¸€æ ·ï¼Œå†™æˆ*wg.Done()","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483356,"discussion_content":"WaitGroupç±»ä¼¼äºChannelè¿™æ ·çš„å¯¹è±¡ï¼Œä»–çš„å®šä¹‰æ˜¯ä¸€ä¸ªç»“æ„ï¼Œè™½ç„¶å¯¹è±¡å¤åˆ¶äº†ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æˆå‘˜è¿˜æ˜¯æŒ‡å‘åŒä¸€åœ°å€ç©ºé—´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582344385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136710,"user_name":"é¢å‘åŠ è–ªå­¦ä¹ ","can_delete":false,"product_type":"c3","uid":1108117,"ip_address":"","ucode":"5164A1DF058AC5","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/95/13b88119.jpg","comment_is_top":false,"comment_ctime":1569495731,"is_pvip":false,"replies":[{"id":52594,"content":"è¿™éƒ¨åˆ†ä¸ä¼šæœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1569647729,"ip_address":"","comment_id":136710,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåšçˆ¬è™«ç¨‹åºï¼Œå…¶å®ç¨‹åºå¯åŠ¨å°±æ˜¯æ­»å¾ªç¯ï¼Œåˆå§‹åŒ–channelå®¹é‡10ä¸ªï¼Œæœ‰æ–°æ•°æ®å°±æ·»åŠ åˆ°channelé‡Œï¼Œç„¶åä¸€ç›´ä¸å…³é—­ï¼Œåº”è¯¥ä¹Ÿä¸ä¼šæœ‰é—®é¢˜å§","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468766,"discussion_content":"è¿™éƒ¨åˆ†ä¸ä¼šæœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569647729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112045,"user_name":"mamba","can_delete":false,"product_type":"c3","uid":1598484,"ip_address":"","ucode":"24DB3BBFFFF8B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/64/14/13f37902.jpg","comment_is_top":false,"comment_ctime":1562659714,"is_pvip":false,"replies":[{"id":41238,"content":"è™½ç„¶ï¼Œè¯­å¥æ˜¯ä¸²è¡Œçš„ï¼Œæ˜¯çº¿ç¨‹çš„è°ƒåº¦ä¸æ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1562938229,"ip_address":"","comment_id":112045,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func TestCloseChannel(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tch := make(chan int)\n\n\twg.Add(1)\n\tdataProducer(ch, &amp;wg)\n\twg.Add(1)\n\tdataReceiver(ch, &amp;wg)\n\twg.Add(1)\n\tdataReceiver(ch, &amp;wg)\n\twg.Add(1)\n\tdataReceiver(ch, &amp;wg)\n\twg.Wait()\n}\n\næƒ³çŸ¥é“ï¼Œä¸ºä»€ä¹ˆåé¢çš„ä¸¤ä¸ª dataReceiver ä¹Ÿèƒ½å¾—åˆ°æ•°æ®ï¼Œ  éš¾é“è¿™ä¸‰ä¸ªdataReceiverä¸æ˜¯ä¸²è¡Œæ‰§è¡Œçš„å—ï¼Ÿæˆ‘çš„ç†è§£æ˜¯ç¬¬ä¸€ä¸ª dataReceiver ä¼šæŠŠ dataProducer äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®éƒ½è¯»å®Œ æ‰é€€å‡ºã€‚\n","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457550,"discussion_content":"è™½ç„¶ï¼Œè¯­å¥æ˜¯ä¸²è¡Œçš„ï¼Œæ˜¯çº¿ç¨‹çš„è°ƒåº¦ä¸æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562938229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106949,"user_name":"ç”°ä½³ä¼Ÿ","can_delete":false,"product_type":"c3","uid":1034087,"ip_address":"","ucode":"D31C9799F383D2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/67/0077314b.jpg","comment_is_top":false,"comment_ctime":1561427912,"is_pvip":false,"replies":[{"id":38770,"content":"å®é™…ä¸Šå’Œæ–¹æ³•è°ƒç”¨çš„ç›´æ¥ä¼ é€’å¤åˆ¶æ˜¯ä¸åŒçš„ï¼Œè¿˜æ˜¯é€šè¿‡chanæ¥å®Œæˆçš„","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1561470459,"ip_address":"","comment_id":106949,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œå½“å‘é€æ“ä½œåœ¨æ‰§è¡Œçš„æ—¶å€™å‘ç°ç©ºçš„é€šé“ä¸­ï¼Œæ­£å¥½æœ‰ç­‰å¾…çš„æ¥æ”¶æ“ä½œï¼Œé‚£ä¹ˆå®ƒä¼šç›´æ¥æŠŠå…ƒç´ å€¼å¤åˆ¶ç»™æ¥æ”¶æ–¹ï¼Œå®é™…æ˜¯è¿™æ ·çš„å—","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455297,"discussion_content":"å®é™…ä¸Šå’Œæ–¹æ³•è°ƒç”¨çš„ç›´æ¥ä¼ é€’å¤åˆ¶æ˜¯ä¸åŒçš„ï¼Œè¿˜æ˜¯é€šè¿‡chanæ¥å®Œæˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561470459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103497,"user_name":"æ˜¥æ˜¥å®¶çš„é›·é›·","can_delete":false,"product_type":"c3","uid":1453138,"ip_address":"","ucode":"267A4726E5F95F","user_header":"","comment_is_top":false,"comment_ctime":1560468770,"is_pvip":false,"replies":[{"id":37615,"content":"waitgroup æ–¹æ³•æ˜¯æ²¡æœ‰timeoutå¯ä»¥è®¾ç½®çš„ã€‚ä½ å¯ä»¥é€šè¿‡åé¢è¯¾ç¨‹ä»‹ç»çš„å–æ¶ˆä»»åŠ¡ç›¸å…³çš„å†…å®¹è‡ªå·±å®ç°ä¸€ä¸ªæœ‰è¶…æ—¶çš„ç­‰å¾…ï¼ˆå‚è§selectéƒ¨åˆ†å†…å®¹ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1560591461,"ip_address":"","comment_id":103497,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"wgæ˜¯ä¸æ˜¯è¦è®¾ç½®ä¸€ä¸‹è¶…æ—¶æ—¶é—´å‘¢","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453897,"discussion_content":"waitgroup æ–¹æ³•æ˜¯æ²¡æœ‰timeoutå¯ä»¥è®¾ç½®çš„ã€‚ä½ å¯ä»¥é€šè¿‡åé¢è¯¾ç¨‹ä»‹ç»çš„å–æ¶ˆä»»åŠ¡ç›¸å…³çš„å†…å®¹è‡ªå·±å®ç°ä¸€ä¸ªæœ‰è¶…æ—¶çš„ç­‰å¾…ï¼ˆå‚è§selectéƒ¨åˆ†å†…å®¹ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560591461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78090,"user_name":"Gary","can_delete":false,"product_type":"c3","uid":1218372,"ip_address":"","ucode":"12265D6A578113","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/44/3929e620.jpg","comment_is_top":false,"comment_ctime":1553069624,"is_pvip":false,"replies":[{"id":28495,"content":"å¯ä»¥çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1553087367,"ip_address":"","comment_id":78090,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"channelå¯ä»¥æ”¾è‡ªå®šä¹‰ç±»å‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443963,"discussion_content":"å¯ä»¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553087367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273852,"user_name":"Geek_d586af","can_delete":false,"product_type":"c3","uid":2161180,"ip_address":"","ucode":"2966DBC6BD9B20","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/jtNYcW0hUoI1RzVic1tpJ7mkh4nccicC3aaC4aicYQCy9R1RZBMSWn8qDxjvVKqca9LnWxCfsicEqeW0bUkX6Bogyg/132","comment_is_top":false,"comment_ctime":1610697023,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"ç–‘é—®ï¼šå¦‚æœbuffer channelè¿˜æœ‰æ²¡å–å®Œæ•°æ®ï¼Œæ­¤æ—¶å…³é—­channelï¼Œé‚£ä¹ˆæœªå–å®Œçš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ\nçŒœæµ‹ï¼šbuffer channelçš„closeæ“ä½œè‚¯å®šæ˜¯åœ¨buffer channelæœªç©ºçš„æ—¶å€™è¿›è¡Œçš„ã€‚\n\nç„¶åè¿›è¡Œä¸€ä¸‹æµ‹è¯•\nfunc pruducer(c chan int, wg *sync.WaitGroup) {\n\tgo func() {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tc &lt;- i\n\t\t}\n\t\tclose(c)\n\t\tfmt.Println(&quot;å…³é—­é€šé“&quot;)\n\t\twg.Done()\n\t}()\n}\n\nfunc consumer(c chan int, w *sync.WaitGroup) {\n\tgo func() {\n\t\tfor  {\n\t\t\ttime.Sleep(time.Microsecond*10)\n\t\t\tif i, ok := &lt;-c; ok{\n\t\t\t\tfmt.Println(i)\n\t\t\t}else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tw.Done()\n\t}()\n}\n\nfunc TestChannelClose(t *testing.T)  {\n\twg:=&amp;sync.WaitGroup{}\n\tc:=make(chan int,10)\n\twg.Add(2)\n\tpruducer(c,wg)\n\tconsumer(c,wg)\n\twg.Wait()\n}\nè¿è¡Œç»“æœï¼š\n0\n1\nå…³é—­é€šé“\n2\n3\n4\n5\n6\n7\n8\n9\n\nå¯ä»¥çœ‹å‡ºï¼Œbuffer channelçš„æ•°æ®æ²¡å–å®Œï¼Œå°±å·²ç»æ‰§è¡Œäº†close()ã€‚\né¦–å…ˆå¯ä»¥è‚¯å®šæ•°æ®æ²¡å–å®Œæ˜¯ä¸å¯èƒ½å…³é—­é€šé“çš„ï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹close()ä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œï¼Œç›¸å½“äºåç¨‹é‡Œåœ¨åˆ›å»ºä¸€ä¸ªåç¨‹ï¼Œåªæœ‰åœ¨å…¨éƒ¨å–å®Œæ•°æ®åï¼Œåœ¨å…·ä½“æ‰§è¡ŒçœŸæ­£æ„ä¹‰çš„å…³é—­é€šé“ï¼Œ","like_count":13,"discussions":[{"author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366264,"discussion_content":"æ‰“å°å‡ºæ¥â€œå…³é—­é€šé“â€ï¼Œå¹¶ä¸æ„å‘³ç€é€šé“å·²ç»å…³é—­äº†ã€‚\n\næˆ‘è§‰çš„ä½ çš„çŒœæµ‹åº”è¯¥æ˜¯å¯¹çš„ï¼Œä¼šç­‰åˆ°é€šé“ä¸­çš„å…¨éƒ¨æ•°æ®å–å®Œä¹‹åï¼Œæ‰ä¼šçœŸæ­£å…³é—­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618017430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281766,"user_name":"å…«å®","can_delete":false,"product_type":"c3","uid":1324501,"ip_address":"","ucode":"89D991A930FDEA","user_header":"https://static001.geekbang.org/account/avatar/00/14/35/d5/17833946.jpg","comment_is_top":false,"comment_ctime":1614872977,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":1,"score":3,"product_id":100024001,"comment_content":"func TestChannleClose(t *testing.T) {\n\tvar group sync.WaitGroup\n\tch := make(chan int, 10)\n\tfmt.Printf(&quot;main goroutine chan int address: %x\\n&quot;, unsafe.Pointer(&amp;ch))\n\tfmt.Printf(&quot;main goroutine waitGroup address: %x\\n&quot;, unsafe.Pointer(&amp;group))\n\tgroup.Add(1)\n\tgo func(ch1 chan int, wg *sync.WaitGroup) {\n\t\tfmt.Printf(&quot;producer chan int address: %x\\n&quot;, unsafe.Pointer(&amp;ch1))\n\t\tfmt.Printf(&quot;producer goroutine waitGroup address: %x\\n&quot;, unsafe.Pointer(wg))\n\t\tfor i := 1; i &lt; 11; i++ {\n\t\t\tch1 &lt;- i\n\t\t}\n\t\tclose(ch1)\n\t\twg.Done()\n\t}(ch, &amp;group)\n\tgroup.Add(1)\n\tgo func(ch1 *chan int, wg *sync.WaitGroup) {\n\t\tfmt.Printf(&quot;consumer chan int address: %x\\n&quot;, unsafe.Pointer(ch1))\n\t\tfmt.Printf(&quot;consumer goroutine waitGroup address: %x\\n&quot;, unsafe.Pointer(wg))\n\t\tfor {\n\t\t\tif v, ok := &lt;-*ch1; ok {\n\t\t\t\tfmt.Println(v)\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\twg.Done()\n\t}(&amp;ch, &amp;group)\n\tgroup.Wait()\n}\nè¾“å‡ºå¦‚ä¸‹ï¼š\n=== RUN   TestChannleClose\nmain goroutine chan int address: c000006048\nmain goroutine waitGroup address: c000016340\nconsumer chan int address: c000006048\nconsumer goroutine waitGroup address: c000016340\nproducer chan int address: c000086000\nproducer goroutine waitGroup address: c000016340\n\nç»“è®ºï¼š golang æ–¹æ³•ä¼ å‚éƒ½æ˜¯å€¼ä¼ é€’ï¼Œå¦‚æœä¸ä½¿ç”¨æŒ‡é’ˆä¼ é€’ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºæ–°çš„å¯¹è±¡å¹¶è¿›è¡Œå†…å®¹å¤åˆ¶","like_count":3,"discussions":[{"author":{"id":2853200,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/89/50/aee9fdab.jpg","nickname":"å°æ°","note":"","ucode":"BBDF8E9F348F65","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545363,"discussion_content":"å¥½æ£’ï¼Œè€Œä¸”æˆ‘çœ‹sync.WaitGroupç¬¬ä¸€æ¬¡çš„å¤åˆ¶ä¸èƒ½æ˜¯å€¼ï¼Œæ‰€ä»¥è€ƒè™‘ç”¨æŒ‡é’ˆä¼ é€’ã€‚å®é™…goé‡Œé¢æŒ‡é’ˆä¹Ÿåªæ˜¯copyè¿‡å»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641916294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147966,"user_name":"æˆ‘å§“è”¡ã€‚","can_delete":false,"product_type":"c3","uid":1625164,"ip_address":"","ucode":"42852793D6A945","user_header":"https://static001.geekbang.org/account/avatar/00/18/cc/4c/aea32790.jpg","comment_is_top":false,"comment_ctime":1572923406,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"å¯¹äºé€šé“çš„okidiomï¼Œokæˆ‘æ›´æ„¿æ„ç†è§£ä¸ºæ˜¯å¦æœ‰æ•°æ®å¯ä»¥æ¥æ”¶ï¼Œå¯¹äºåŒæ­¥é€šé“æ¥è¯´ï¼Œæ¥å‘éƒ½æ˜¯é˜»å¡çš„ï¼Œæ¥æ”¶æ•°æ®ä¸é˜»å¡äº†è¦ä¹ˆæ˜¯æœ‰ä¸€ç«¯å‘é€äº†æ•°æ®ï¼Œè¦ä¹ˆæ˜¯é€šé“closeäº†ï¼Œæ‰€ä»¥å¯¹äºåŒæ­¥é€šé“okä¸ºfalseï¼Œé‚£ä¹ˆå°±æ˜¯é€šé“å…³é—­äº†ï¼Œå¯¹äºå¼‚æ­¥é€šé“æ¥è¯´ï¼Œé€šé“closeäº†ï¼Œä½†æ˜¯é€šé“ä¸­è¿˜æœ‰æ•°æ®å­˜åœ¨ï¼Œè¿™ä¸ªæ—¶å€™æ¥æ”¶okè¿˜æ˜¯ä¸ºtrueï¼Œåªæœ‰å½“æ²¡æœ‰æ•°æ®å¯ä»¥æ¥æ”¶äº†ï¼Œokæ‰ä¸ºfalseã€‚\nå¯¹äºclosedå’Œnilçš„é€šé“:\n1.å¯¹äºclosedçš„é€šé“ï¼Œå‘é€æ•°æ®ä¼španic\n2.å¯¹äºclosedçš„é€šé“ï¼ŒåŒæ­¥é€šé“ä¼šè¯»å‡ºé›¶å€¼ï¼Œå¼‚æ­¥é€šé“å¦‚æœæœ‰ç¼“å­˜æ•°æ®è¯»å‡ºç¼“å­˜æ•°æ®ï¼Œæ²¡æœ‰ç¼“å­˜æ•°æ®è¯»å‡ºé›¶å€¼\n3.å¯¹äºnilé€šé“ï¼Œè¯»å’Œå†™éƒ½ä¼šé˜»å¡ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œåœ¨é€šé“å¤šè·¯é€‰æ‹©çš„æ—¶å€™ï¼Œå°†è¯»å®Œæ•°æ®çš„é€šé“ç½®ç©ºï¼Œåˆ¤æ–­æ‰€æœ‰é€šé“éƒ½ä¸ºnilä¹‹åæ‰é€€å‡ºã€‚","like_count":3},{"had_liked":false,"id":81917,"user_name":"é¢æœå¤§æµ·æ˜¥æš–èŠ±å¼€","can_delete":false,"product_type":"c3","uid":1118924,"ip_address":"","ucode":"F9F9F53D05304B","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/cc/6a08cf26.jpg","comment_is_top":false,"comment_ctime":1554082550,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"å¼€å§‹æœ‰ç‚¹å›°æ‰°ï¼Œå¦‚æœchannelé‡Œçš„æ•°æ®æ²¡æœ‰å–å®Œï¼Œè¿™æ—¶producerå…³é—­äº†channelï¼Œreceiverèƒ½ç»§ç»­å–æ•°æ®ä¹ˆï¼Ÿ\nç„¶åå®éªŒäº†ä¸€ä¸‹ï¼šå‘ç°å½“receiversä»channelå–å®Œäº†æ•°æ®ï¼Œproducerçš„colse(channel)æ‰ä¼šè¢«æ‰§è¡Œï¼Œå³close(channel)ä¼šé˜»å¡è‡³channelä¸­æ•°æ®å…¨éƒ¨è¢«å–å®Œã€‚\nä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹ã€‚å¤šè°¢ï¼","like_count":3,"discussions":[{"author":{"id":1363634,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","nickname":"æµ·ç›—èˆ¹é•¿","note":"","ucode":"ECB28BA21A4113","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320071,"discussion_content":"ä½ çš„ç»“è®ºæ˜¯å¯¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604237248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2002004,"avatar":"","nickname":"å‘¨å‹‡","note":"","ucode":"38AB0AF3654DB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265675,"discussion_content":"æˆ‘è®¤ä¸ºä¸ç®¡æœ‰æ²¡æœ‰ç¼“å­˜ï¼Œcloseçš„å…³é—­éƒ½æ˜¯åœ¨channelå…¨éƒ¨è¢«å–èµ°ä¹‹åæ‰è¿›è¡Œçš„æ“ä½œã€‚\nfunc TestCloseChannel(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tch := make(chan int)\n\twg.Add(1)\n\tgo func() {\n\t\tdataProducer(ch, &amp;wg)\n\t}()\n\n\ttime.Sleep(time.Second * 2)\n\tif _, ok := <-ch; ok {\n\t\tfmt.Println(&#34;å½“å‰é€šé“æ˜¯æ‰“å¼€çš„&#34;)\n\t} else {\n\t\tfmt.Println(&#34;å½“å‰é€šé“æ˜¯å…³é—­çš„&#34;)\n\t}\n\n\twg.Add(1)\n\tdataReceiver(ch, &amp;wg)\n\twg.Wait()\n}\n\n\nç»“æœï¼š\nå½“å‰é€šé“æ˜¯æ‰“å¼€çš„\n1\n2\n3\n4\n5\n6\n7\n8\n9","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589427637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1419723,"avatar":"https://static001.geekbang.org/account/avatar/00/15/a9/cb/a431bde5.jpg","nickname":"æœ¨å¤´å‘èŠ½","note":"","ucode":"657B381C5DA963","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":247649,"discussion_content":"ä¸å¸¦bufferçš„chanæ˜¯ä¼šé˜»å¡è‡³è¢«å–èµ°ä¸ºæ­¢çš„ï¼Œæ‰€ä»¥æ²¡æœ‰closeçš„è¿˜æ²¡å–å®Œä¹‹è¯´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587820386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359551,"user_name":"æ¶é­”æœå®","can_delete":false,"product_type":"c3","uid":1962297,"ip_address":"å¹¿ä¸œ","ucode":"691CD833C984AC","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg","comment_is_top":false,"comment_ctime":1665640792,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"x, ok := &lt;-ch\n\nä¸€ä¸ªå·²å…³é—­çš„ç®¡é“æœ‰ä¸¤ç§æƒ…å†µï¼š\n1.ç®¡é“ç¼“å†²åŒºå·²ç»æ²¡æœ‰æ•°æ®ï¼›\n2.ç®¡é“ç¼“å†²åŒºè¿˜æœ‰æ•°æ®ã€‚\n\nç¬¬ä¸€ç§æƒ…å†µï¼Œç®¡é“å·²ç»å…³é—­ä¸”ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“è¯»å–è¡¨è¾¾å¼è¿”å›çš„ç¬¬ä¸€ä¸ªå˜é‡ç›¸åº”ç±»å‹çš„é›¶å€¼ï¼Œç¬¬äºŒä¸ªå˜é‡ä¸ºfalse\n\nç¬¬äºŒç§æƒ…å†µï¼Œç®¡é“å·²ç»å…³é—­ä¸”ç¼“å†²åŒºè¿˜æœ‰æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“æ¯’æ°”è¡¨è¾¾å¼ç¬¬ä¸€ä¸ªå˜é‡ä¸ºè¯»å–åˆ°çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªå˜é‡ä¸ºtrue\n\nå¯è§ï¼Œåªæœ‰ç®¡é“å·²ç»å…³é—­ä¸”ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œç®¡é“è¯»å–è¡¨è¾¾å¼è¿”å›çš„ç¬¬äºŒä¸ªå˜é‡æ‰è·Ÿç®¡é“å…³é—­çŠ¶æ€ä¸€è‡´ã€‚","like_count":0},{"had_liked":false,"id":315107,"user_name":"é˜¿ä¿Š","can_delete":false,"product_type":"c3","uid":1049343,"ip_address":"","ucode":"3ADA1093D29D5E","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/ff/569d5904.jpg","comment_is_top":false,"comment_ctime":1633689662,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"æ„Ÿè§‰è¿™ä¸ªchanæœ‰ç‚¹åƒJavaçš„é˜»å¡é˜Ÿåˆ—","like_count":0},{"had_liked":false,"id":307327,"user_name":"braincy","can_delete":false,"product_type":"c3","uid":1467619,"ip_address":"","ucode":"B1DE2447CD5102","user_header":"https://static001.geekbang.org/account/avatar/00/16/64/e3/6e469d05.jpg","comment_is_top":false,"comment_ctime":1629030436,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œæˆ‘å°è¯•äº†ä¸‹ä¸¤ä¸ª Receiver çš„è¿è¡Œæ—¶é—´ä¸ºä»€ä¹ˆä¼šæ¯”ä¸€ä¸ª Receiver çš„æ—¶é—´é•¿ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600930,"discussion_content":"è¿™å¯èƒ½æ˜¯çº¿ç¨‹è°ƒåº¦å¼•èµ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674962871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304006,"user_name":"å±±é’","can_delete":false,"product_type":"c3","uid":1627670,"ip_address":"","ucode":"904AE3C23D3B92","user_header":"https://static001.geekbang.org/account/avatar/00/18/d6/16/107f0d04.jpg","comment_is_top":false,"comment_ctime":1627182005,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è¿™ä¸ªå¤šä¸ªreceiveræ¥æ”¶åŒä¸€ä¸ªproduceräº§ç”Ÿçš„æ•°æ®ï¼Œå¯ä»¥ä¸å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåœ°æ–¹äº§ç”Ÿæ•°æ®åï¼Œç”±äºçº¿ç¨‹ï¼ˆåç¨‹ï¼‰è°ƒåº¦ï¼Œå…¶ä¸­ä¸€ä¸ªreceiveræ¥æ”¶åˆ°æ•°æ®åï¼Œå®å¤–ä¸€ä¸ªæ¥å—è€…è¿˜å¤„äºé˜»å¡çŠ¶æ€ï¼Œåªæœ‰è°ƒåº¦åˆ°ä»–çš„åç¨‹çš„ æ—¶å€™ä»–æ‰èƒ½å»æ¥å—åˆ°ä¸‹ä¸€ä¸ªæ•°æ®ã€","like_count":0,"discussions":[{"author":{"id":2403351,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ac/17/430ddd05.jpg","nickname":"ğŸŸ","note":"","ucode":"F61C3F67E4A2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542614,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œä¸¤ä¸ªreceiver ç›¸å½“äºæ˜¯åœ¨æŠ¢å  channel é‡Œçš„æ•°æ®ï¼ŒæŠ¢åˆ°çš„ å°±æ¶ˆè´¹ï¼ŒæŠ¢ä¸åˆ°çš„ ç›¸å½“äºé¢å¯¹ä¸€ä¸ªç©ºchannelï¼Œå°±ç»§ç»­é˜»å¡å’¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640795006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304002,"user_name":"å±±é’","can_delete":false,"product_type":"c3","uid":1627670,"ip_address":"","ucode":"904AE3C23D3B92","user_header":"https://static001.geekbang.org/account/avatar/00/18/d6/16/107f0d04.jpg","comment_is_top":false,"comment_ctime":1627181024,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"æˆ‘æ„Ÿè§‰è¿™ä¸ªforå¾ªç¯é‡Œé¢ä¸€ä¸ªå‘é€ä¸€ä¸ªæ¥å— æˆ‘æ„Ÿè§‰åªæœ‰ä¸€ä¸ªreceiver ä¸€ä¸ªforå¾ªç¯å‘é€ä¸€ä¸ªfor å¾ªç¯æ¥å—  ï¼Œç›¸äº’é˜»å¡  å‘å®Œååªè¦æ”¶å®Œå°±å¯ä»¥äº† å¦‚æœæ”¶å‘æ•°é‡ä¸å¯¹ç­‰ ä¼šå‡ºç°å‘é˜»å¡æˆ–è€…æ”¶é˜»å¡","like_count":0},{"had_liked":false,"id":287534,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618018836,"is_pvip":true,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"ä¸€ä¸ªæˆ–å¤šä¸ª Producer ï¼Œé…åˆä¸€ä¸ªæˆ–å¤šä¸ª Receiverï¼Œè¯­å¥ä¸²è¡Œï¼Œçº¿ç¨‹è°ƒåº¦å¹¶è¡Œï¼ŒGo è¯­è¨€ç¡®å®æ˜¯å¤©ç”Ÿå¼‚æ­¥ã€‚\n\næˆ‘è§‰çš„ channel å…³é—­çš„æœºåˆ¶è¿˜æ˜¯æŒºå·§å¦™çš„ã€‚\n\nç»“åˆç•™è¨€ä¸­çš„ä»£ç ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ° close æ˜¯å¼‚æ­¥çš„ï¼Œä¼šç­‰é€šé“ä¸­çš„æ•°æ®è¢«å®Œå…¨è¯»å–ä¹‹åå†å…³é—­ã€‚\n\n```\nch chan int, wg *sync.WaitGroup\n```\n\nè¿™ä¸ªå‚æ•°åˆ—è¡¨å¯ä»¥è®°åœ¨å¿ƒä¸­\n\nå¦å¤–å¾—è®°ä½ channel æ˜¯ç»“æ„ä½“ï¼Œä¼ é€’çš„æ—¶å€™æ˜¯è¢«å¤åˆ¶çš„ï¼Œæ–°æ—§ä¸¤ä¸ª channel æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åŒºåŸŸã€‚\n","like_count":0,"discussions":[{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600928,"discussion_content":"?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674962840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208475,"user_name":"æ‹‰é“","can_delete":false,"product_type":"c3","uid":1224912,"ip_address":"","ucode":"4286AEAD0A6E6C","user_header":"","comment_is_top":false,"comment_ctime":1587367161,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"å½“channelå…³é—­å¹¶ä¸”ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œç»§ç»­ä»ä»channelæ¥æ”¶æ¶ˆæ¯æ‰ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚","like_count":0},{"had_liked":false,"id":121737,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c3","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1565194746,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"è·Ÿç€è€å¸ˆä¸€èµ·æ‰‹åŠ¨æ•²ä»£ç ï¼Œè¶Šç§è¶Šæ¥åŠ²","like_count":0},{"had_liked":false,"id":78228,"user_name":"å¿½ç„¶ä¹‹é—´","can_delete":false,"product_type":"c3","uid":1052876,"ip_address":"","ucode":"CA6CF7883735DE","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/cc/9226d3c8.jpg","comment_is_top":false,"comment_ctime":1553096923,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"type MyChan struct {\n\tChid int\n    Msg  string\n}\n\nfunc dataProducer1(ch chan MyChan, wg *sync.WaitGroup) {\n\tgo func() {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tch &lt;- MyChan{i, &quot;msg&quot;}\n\t\t}\n\t\tclose(ch)\n\t\twg.Done()\n\t}()\n}\n\nfunc TestCloseChannel1(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tch := make(chan MyChan)\n\twg.Add(1)\n\tdataProducer1(ch, &amp;wg)\n\twg.Add(1)\n\tdataReceiver1(ch, &amp;wg)\n\twg.Wait()\n}\n\nå…ˆæ¨¡ä»¿è€å¸ˆçš„ä»£ç ã€‚ ","like_count":0}]}