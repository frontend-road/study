{"id":424203,"title":"11 | å­˜å‚¨ç³»ç»Ÿï¼šæ•°æ®åˆ°åº•éƒ½å­˜å“ªå„¿äº†ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>æ„Ÿè°¢ä½ åœ¨å›½åº†å‡æœŸä»ç„¶åšæŒå­¦ä¹ ï¼Œä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ å­˜å‚¨ç³»ç»Ÿï¼Œä¸è°ƒåº¦ç³»ç»Ÿä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯Sparké‡è¦çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ã€‚ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šâ€œæŒæ¡Sparkåº”ç”¨å¼€å‘ï¼Œéœ€è¦å»äº†è§£è¿™ä¹ˆåº•å±‚çš„çŸ¥è¯†å—ï¼Ÿâ€å¦ç™½åœ°è¯´ï¼Œè¿˜çœŸéœ€è¦ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‰é¢å­¦äº†Shuffleç®¡ç†ã€RDD Cacheå’Œå¹¿æ’­å˜é‡ï¼Œè¿™äº›åŠŸèƒ½ä¸ç‰¹æ€§ï¼Œå¯¹Sparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½æœ‰ç€è‡³å…³é‡è¦çš„å½±å“ã€‚è€Œæƒ³è¦å®ç°è¿™äº›åŠŸèƒ½ï¼Œåº•å±‚çš„æ”¯æ’‘ç³»ç»Ÿæ­£æ˜¯Sparkå­˜å‚¨ç³»ç»Ÿã€‚</p><p>å­¦ä¹ å’Œç†Ÿæ‚‰å­˜å‚¨ç³»ç»Ÿï¼Œä¸å•å•æ˜¯ä¸ºäº†å®Œå–„æˆ‘ä»¬çš„çŸ¥è¯†ä½“ç³»ï¼Œå®ƒè¿˜èƒ½ç›´æ¥å¸®ä½ æ›´å¥½åœ°åˆ©ç”¨RDD Cacheå’Œå¹¿æ’­å˜é‡è¿™äº›ç‰¹æ€§ã€‚åœ¨æœªæ¥ï¼Œè¿™äº›çŸ¥è¯†ä¹Ÿèƒ½ä¸ºä½ åšShuffleçš„è°ƒä¼˜å¥ å®šè‰¯å¥½çš„åŸºç¡€ã€‚</p><p>æ—¢ç„¶å­˜å‚¨ç³»ç»Ÿè¿™ä¹ˆé‡è¦ï¼Œé‚£è¦æ€æ ·é«˜æ•ˆå¿«é€Ÿåœ°æŒæ¡å®ƒå‘¢ï¼Ÿæœ¬ç€å­¦ä»¥è‡´ç”¨çš„åŸåˆ™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ç³»ç»Ÿçš„æœåŠ¡å¯¹è±¡ï¼Œè¯´ç™½äº†å°±æ˜¯å­˜å‚¨ç³»ç»Ÿæ˜¯ç”¨æ¥å­˜ä»€ä¹ˆä¸œè¥¿çš„ã€‚</p><h2>æœåŠ¡å¯¹è±¡</h2><p>ç¬¼ç»Ÿåœ°è¯´ï¼Œ<strong>Sparkå­˜å‚¨ç³»ç»Ÿè´Ÿè´£ç»´æŠ¤æ‰€æœ‰æš‚å­˜åœ¨å†…å­˜ä¸ç£ç›˜ä¸­çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬Shuffleä¸­é—´æ–‡ä»¶ã€RDD Cacheä»¥åŠå¹¿æ’­å˜é‡</strong>ã€‚</p><p>å¯¹äºä¸Šè¿°ä¸‰ç±»æ•°æ®ï¼Œæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿã€‚æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯Shuffleä¸­é—´æ–‡ä»¶ï¼Œåœ¨Shuffleçš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼ŒMap Taskåœ¨Shuffle Writeé˜¶æ®µç”Ÿäº§dataä¸indexæ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®indexæ–‡ä»¶æä¾›çš„åˆ†åŒºç´¢å¼•ï¼ŒShuffle Readé˜¶æ®µçš„Reduce Taskä»ä¸åŒèŠ‚ç‚¹æ‹‰å–å±äºè‡ªå·±çš„åˆ†åŒºæ•°æ®ã€‚è€ŒShuffleä¸­é—´æ–‡ä»¶ï¼ŒæŒ‡çš„æ­£æ˜¯ä¸¤ä¸ªé˜¶æ®µä¸ºäº†å®Œæˆæ•°æ®äº¤æ¢æ‰€ä»°ä»—çš„dataä¸indexæ–‡ä»¶ã€‚</p><!-- [[[read_end]]] --><p>RDD CacheæŒ‡çš„æ˜¯åˆ†å¸ƒå¼æ•°æ®é›†åœ¨å†…å­˜æˆ–æ˜¯ç£ç›˜ä¸­çš„ç‰©åŒ–ï¼Œå®ƒå¾€å¾€æœ‰åˆ©äºæå‡è®¡ç®—æ•ˆç‡ã€‚å¹¿æ’­å˜é‡<a href=\"https://time.geekbang.org/column/article/423878\">ä¸Šä¸€è®²</a>æˆ‘ä»¬åˆšåˆšä»‹ç»è¿‡ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºä»¥Executorsä¸ºç²’åº¦åˆ†å‘å…±äº«å˜é‡ï¼Œä»è€Œå¤§å¹…å‰Šå‡æ•°æ®åˆ†å‘å¼•å…¥çš„ç½‘ç»œä¸å­˜å‚¨å¼€é”€ã€‚</p><p>æˆ‘ä»¬åˆšæ‰å¯¹è¿™ä¸‰ç±»æ•°æ®åšäº†ç®€å•å›é¡¾ï¼Œå¦‚æœä½ è§‰å¾—å“ªé‡Œä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šçš„è¯ï¼Œä¸å¦¨ç¿»å›å‰é¢å‡ è®²å†çœ‹ä¸€çœ‹ï¼Œæˆ‘ä»¬åœ¨ç¬¬7ã€8ã€10è¿™3è®²åˆ†åˆ«å¯¹å®ƒä»¬åšäº†è¯¦ç»†è®²è§£ã€‚å¥½å•¦ï¼Œäº†è§£äº†å­˜å‚¨ç³»ç»ŸæœåŠ¡çš„ä¸»è¦å¯¹è±¡ä»¥åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç»†æ•°Sparkå­˜å‚¨ç³»ç»Ÿéƒ½æœ‰å“ªäº›é‡è¦ç»„ä»¶ï¼Œçœ‹çœ‹å®ƒä»¬ä¹‹é—´åˆæ˜¯å¦‚ä½•åä½œçš„ã€‚</p><h2>å­˜å‚¨ç³»ç»Ÿçš„æ„æˆ</h2><p>ç†è®ºçš„å­¦ä¹ æ€»æ˜¯æ¯ç‡¥è€Œåˆä¹å‘³ï¼Œä¸ºäº†è®©ä½ æ›´åŠ è½»æ¾åœ°æŒæ¡å­˜å‚¨ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå’±ä»¬ä¸å¦¨è¿˜æ˜¯ç”¨æ–¯å·´å…‹å›½é™…å»ºç­‘é›†å›¢çš„ç±»æ¯”ï¼Œæ¥è®²è§£Sparkå­˜å‚¨ç³»ç»Ÿã€‚</p><p>ç›¸æ¯”è°ƒåº¦ç³»ç»Ÿå¤æ‚çš„äººäº‹å…³ç³»ï¼ˆæˆ´æ ¼ã€å¡”æ–¯å…‹ã€æ‹œè‚¯å¾·ï¼‰ï¼Œå­˜å‚¨ç³»ç»Ÿçš„äººå‘˜æ„æˆè¦ç®€å•å¾—å¤šã€‚åœ¨å†…å­˜ç®¡ç†<a href=\"https://time.geekbang.org/column/article/422400\">é‚£ä¸€è®²</a>ï¼Œæˆ‘ä»¬æŠŠèŠ‚ç‚¹å†…å­˜çœ‹ä½œæ˜¯æ–½å·¥å·¥åœ°ï¼Œè€ŒæŠŠèŠ‚ç‚¹ç£ç›˜çœ‹ä½œæ˜¯ä¸´æ—¶ä»“åº“ï¼Œé‚£ä¹ˆæ˜¾ç„¶ï¼Œç®¡ç†æ•°æ®å­˜å‚¨çš„ç»„ä»¶ï¼Œå°±å¯ä»¥çœ‹æˆæ˜¯ä»“åº“ç®¡ç†å‘˜ï¼Œç®€ç§°åº“ç®¡ã€‚</p><h3>å¸ƒåŠ³å…‹å®¶æ—</h3><p>åœ¨æ–¯å·´å…‹å»ºç­‘é›†å›¢ï¼Œåº“ç®¡è¿™ä¸ªå…³é”®è§’è‰²ï¼Œä¸€ç›´ä»¥æ¥éƒ½æ˜¯ç”±å¸ƒåŠ³å…‹å®¶æ—æŠŠæŒç€ã€‚</p><p>å¸ƒåŠ³å…‹å®¶æ—åœ¨æ–¯å·´å…‹é›†å›¢çš„åœ°ä½ä¸¾è¶³è½»é‡ï¼Œè€å¸ƒåŠ³å…‹ï¼ˆBlockManagerMasterï¼‰åé•‡é›†å›¢æ€»å…¬å¸ï¼ˆDriverï¼‰ï¼Œè€Œä»–çš„å­å—£ä»¬ã€å°å¸ƒåŠ³å…‹ï¼ˆBlockManagerï¼‰åˆ™é©»å®ˆåœ¨å„ä¸ªåˆ†å…¬å¸ï¼ˆExecutorsï¼‰ã€‚</p><p>å¯¹é›†å›¢å…¬å¸å»ºæä¸ä»“åº“çš„æ•´ä½“æƒ…å†µï¼Œè€å¸ƒåŠ³å…‹äº†å¦‚æŒ‡æŒï¼Œå½“ç„¶ï¼Œè¿™ä¸€åˆ‡è¦å½’åŠŸäºä»–ä¼—å¤šçš„å­å—£ä»¬ã€‚å„å®¶åˆ†å…¬å¸çš„å°å¸ƒåŠ³å…‹ï¼Œäº‰å…ˆæååœ°å‘è€çˆ¸æ±‡æŠ¥åˆ†å…¬å¸çš„å»ºæçŠ¶æ€ä¸ä»“åº“çŠ¶å†µã€‚å…³äºä»–ä»¬çš„çˆ¶å­å…³ç³»ï¼Œæˆ‘æ•´ç†åˆ°äº†ä¸‹é¢çš„ç¤ºæ„å›¾ä¸­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ed/13/ed719d24047909274a1dac2de9fd4313.jpg?wh=1920x926\" alt=\"å›¾ç‰‡\" title=\"å­˜å‚¨ç³»ç»Ÿï¼šå¸ƒåŠ³å…‹å®¶æ—\"></p><p><strong>ä»ä¸Šå›¾æˆ‘ä»¬èƒ½å¤Ÿçœ‹å¾—å‡ºæ¥ï¼Œå°å¸ƒåŠ³å…‹ä¸è€å¸ƒåŠ³å…‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢æ˜¯åŒå‘çš„</strong>ã€‚ä¸éš¾å‘ç°ï¼Œå¸ƒåŠ³å…‹å®¶æ—çš„å®¶é£æ˜¯å…¸å‹çš„â€œå®¶é•¿åˆ¶â€å’Œâ€œä¸€è¨€å ‚â€ã€‚å¦‚æœå°å¸ƒåŠ³å…‹éœ€è¦è·å–å…¶ä»–åˆ†å…¬å¸çš„çŠ¶æ€ï¼Œä»–å¿…é¡»è¦é€šè¿‡è€å¸ƒåŠ³å…‹æ‰èƒ½æ‹¿åˆ°è¿™äº›ä¿¡æ¯ã€‚</p><p>åœ¨å‰é¢çš„å‡ è®²ä¸­ï¼Œæˆ‘ä»¬æŠŠå»ºææ¯”ä½œæ˜¯åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œé‚£ä¹ˆï¼ŒBlockManagerMasterä¸BlockManagerä¹‹é—´äº¤æ¢çš„ä¿¡æ¯ï¼Œå®é™…ä¸Šå°±æ˜¯Executorsä¹‹ä¸Šæ•°æ®çš„çŠ¶æ€ã€‚è¯´åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ—¢ç„¶BlockManagerMasterçš„ä¿¡æ¯éƒ½æ¥è‡ªäºBlockManagerï¼Œé‚£ä¹ˆBlockManageråˆæ˜¯ä»å“ªé‡Œè·å–åˆ°è¿™äº›ä¿¡æ¯çš„å‘¢ï¼Ÿâ€è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜è¦ä»BlockManagerçš„èŒè´£è¯´èµ·ã€‚</p><p>æˆ‘ä»¬å¼€å¤´è¯´è¿‡ï¼Œå­˜å‚¨ç³»ç»Ÿçš„æœåŠ¡å¯¹è±¡æœ‰3ä¸ªï¼šåˆ†åˆ«æ˜¯Shuffleä¸­é—´æ–‡ä»¶ã€RDD Cacheä»¥åŠå¹¿æ’­å˜é‡ï¼Œè€ŒBlockManagerçš„èŒè´£ï¼Œæ­£æ˜¯åœ¨Executorsä¸­ç®¡ç†è¿™3ç±»æ•°æ®çš„å­˜å‚¨ã€è¯»å†™ä¸æ”¶å‘ã€‚å°±å­˜å‚¨ä»‹è´¨æ¥è¯´ï¼Œè¿™3ç±»æ•°æ®æ‰€æ¶ˆè€—çš„ç¡¬ä»¶èµ„æºå„ä¸ç›¸åŒã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒShuffleä¸­é—´æ–‡ä»¶æ¶ˆè€—çš„æ˜¯èŠ‚ç‚¹ç£ç›˜ï¼Œè€Œå¹¿æ’­å˜é‡ä¸»è¦å ç”¨èŠ‚ç‚¹çš„å†…å­˜ç©ºé—´ï¼ŒRDD Cacheåˆ™æ˜¯â€œè„šè¸ä¸¤æ¡èˆ¹â€ï¼Œæ—¢å¯ä»¥æ¶ˆè€—å†…å­˜ï¼Œä¹Ÿå¯ä»¥æ¶ˆè€—ç£ç›˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/55/c3/55ce43b2a9d6f7dee2aaa5b9e1c171c3.jpg?wh=1920x895\" alt=\"å›¾ç‰‡\" title=\"æœåŠ¡å¯¹è±¡ä¸å­˜å‚¨ä»‹è´¨\"></p><p>ä¸ç®¡æ˜¯åœ¨å†…å­˜ã€è¿˜æ˜¯åœ¨ç£ç›˜ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯ä»¥æ•°æ®å—ï¼ˆBlocksï¼‰ä¸ºç²’åº¦è¿›è¡Œå­˜å–ä¸è®¿é—®çš„ã€‚<strong>æ•°æ®å—çš„æ¦‚å¿µä¸RDDæ•°æ®åˆ†åŒºï¼ˆPartitionsï¼‰æ˜¯ä¸€è‡´çš„</strong>ï¼Œåœ¨RDDçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¯´åˆ°æ•°æ®åˆ’åˆ†çš„ç²’åº¦ï¼Œæˆ‘ä»¬å¾€å¾€æŠŠä¸€ä»½æ•°æ®ç§°ä½œâ€œæ•°æ®åˆ†åŒºâ€ã€‚è€Œåœ¨å­˜å‚¨ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯¹äºç»†åˆ†çš„ä¸€ä»½æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°æ®å—ã€‚</p><p>æœ‰äº†æ•°æ®å—çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–BlockManagerçš„èŒè´£ã€‚<strong>BlockManagerçš„æ ¸å¿ƒèŒè´£ï¼Œåœ¨äºç®¡ç†æ•°æ®å—çš„å…ƒæ•°æ®ï¼ˆMeta dataï¼‰ï¼Œè¿™äº›å…ƒæ•°æ®è®°å½•å¹¶ç»´æŠ¤æ•°æ®å—çš„åœ°å€ã€ä½ç½®ã€å°ºå¯¸ä»¥åŠçŠ¶æ€</strong>ã€‚ä¸ºäº†è®©ä½ ç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹å…ƒæ•°æ®ï¼Œæˆ‘æŠŠå®ƒçš„æ ·ä¾‹æ”¾åˆ°äº†ä¸‹é¢çš„ç¤ºæ„å›¾é‡Œï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/77/5be58ab54064cb50eb106a1eyy28c377.jpg?wh=1920x453\" alt=\"å›¾ç‰‡\" title=\"å…ƒæ•°æ®æ ·ä¾‹\"></p><p>åªæœ‰å€ŸåŠ©å…ƒæ•°æ®ï¼ŒBlockManageræ‰æœ‰å¯èƒ½é«˜æ•ˆåœ°å®Œæˆæ•°æ®çš„å­˜ä¸å–ã€æ”¶ä¸å‘ã€‚è¿™å°±å›ç­”äº†å‰é¢æˆ‘æå‡ºçš„é—®é¢˜ï¼ŒBlockManagerä¸æ•°æ®çŠ¶æ€æœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå…¨éƒ¨æ¥è‡ªäºå…ƒæ•°æ®çš„ç®¡ç†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼Œç»“åˆè¿™äº›å…ƒæ•°æ®ï¼ŒBlockManagerå¦‚ä½•å®Œæˆæ•°æ®çš„å­˜å–å‘¢ï¼Ÿ</p><p>ä¸ç®¡æ˜¯å·¥åœ°ä¸Šï¼Œè¿˜æ˜¯ä»“åº“é‡Œï¼Œè¿™äº›åœºæ‰€éƒ½æ˜¯å°˜åœŸé£æ‰¬ã€äººæ¥äººå¾€ï¼Œåƒå­˜å–å»ºæè¿™ç§äº‹æƒ…ï¼Œå…»å°Šå¤„ä¼˜çš„å°å¸ƒåŠ³å…‹è‡ªç„¶ä¸ä¼šäº²åŠ›äº²ä¸ºã€‚äºæ˜¯ï¼Œä»–æ‹›å‹Ÿäº†ä¸¤ä¸ªå¸®æ‰‹ï¼Œæ¥å¸®ä»–æ‰“ç†è¿™äº›è„æ´»ç´¯æ´»ã€‚</p><p>è¿™ä¸¤ä¸ªå¸®æ‰‹ä¹Ÿéƒ½ä¸æ˜¯å¤–äººï¼Œä¸€ä¸ªæ˜¯å¤§è¡¨å§è¿ˆç¾ç‘ï¼ˆMemoryStoreï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯å¤§è¡¨å“¥è¿ªæ–¯å…‹ï¼ˆDiskStoreï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œ<strong>MemoryStoreè´Ÿè´£å†…å­˜ä¸­çš„æ•°æ®å­˜å–ï¼Œè€Œç›¸åº”åœ°ï¼ŒDiskStoreåˆ™è´Ÿè´£ç£ç›˜ä¸­çš„æ•°æ®è®¿é—®</strong>ã€‚</p><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå­˜å‚¨ç³»ç»Ÿçš„é‡è¦è§’è‰²å·²ç»æ‚‰æ•°ç™»åœºï¼Œæˆ‘æŠŠä»–ä»¬æ•´ç†åˆ°äº†ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥RDD Cacheå’ŒShuffleä¸­é—´æ–‡ä»¶çš„å­˜å–ä¸ºä¾‹ï¼Œåˆ†åˆ«è¯´ä¸€è¯´è¿ˆç¾ç‘å’Œè¿ªæ–¯å…‹æ˜¯å¦‚ä½•å¸®åŠ©å°å¸ƒåŠ³å…‹æ¥æ‰“ç†æ•°æ®çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/77/8a/77dd7153fbace16ccdd2d9e43eb3838a.jpg?wh=1920x532\" alt=\"å›¾ç‰‡\" title=\"å­˜å‚¨ç³»ç»Ÿä¸»è¦è§’è‰²\"></p><h3>MemoryStoreï¼šå†…å­˜æ•°æ®è®¿é—®</h3><p>å¤§è¡¨å§è¿ˆç¾ç‘ç§€å¤–æ…§ä¸­ï¼Œåšèµ·äº‹æƒ…æ¥äº•äº•æœ‰æ¡ã€‚ä¸ºäº†ä¸è¾œè´Ÿå°å¸ƒåŠ³å…‹çš„æ‰˜ä»˜ï¼Œè¿ˆç¾ç‘éšèº«æºå¸¦ç€ä¸€æœ¬å°å†Œå­ï¼Œè¿™æœ¬å°å†Œå­å¯†å¯†éº»éº»ï¼Œè®°æ»¡äº†å…³äºæ•°æ®å—çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ä¸ªå°å†Œå­ï¼Œæ˜¯ä¸€ç§ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼šLinkedHashMap[BlockId, MemoryEntry]ã€‚é¡¾åæ€ä¹‰ï¼ŒLinkedHashMapæ˜¯ä¸€ç§Mapï¼Œå…¶ä¸­é”®å€¼å¯¹çš„Keyæ˜¯BlockIdï¼ŒValueæ˜¯MemoryEntryã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/43/f2/43de4d437b70e4659ddyyfd3cyyc68f2.jpg?wh=1920x932\" alt=\"å›¾ç‰‡\" title=\"è¿ˆç¾ç‘çš„å°å†Œå­ï¼šLinkedHashMap\"></p><p>BlockIdç”¨äºæ ‡è®°Blockçš„èº«ä»½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBlockIdä¸æ˜¯ä¸€ä¸ªä»…ä»…è®°å½•Idçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ç§è®°å½•Blockå…ƒä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚BlockIdè¿™ä¸ªæ•°æ®ç»“æ„è®°å½•çš„ä¿¡æ¯éå¸¸ä¸°å¯Œï¼ŒåŒ…æ‹¬Blockåå­—ã€æ‰€å±RDDã€Blockå¯¹åº”çš„RDDæ•°æ®åˆ†åŒºã€æ˜¯å¦ä¸ºå¹¿æ’­å˜é‡ã€æ˜¯å¦ä¸ºShuffle Blockï¼Œç­‰ç­‰ã€‚</p><p>MemoryEntryæ˜¯å¯¹è±¡ï¼Œå®ƒç”¨äºæ‰¿è½½æ•°æ®å®ä½“ï¼Œæ•°æ®å®ä½“å¯ä»¥æ˜¯æŸä¸ªRDDçš„æ•°æ®åˆ†åŒºï¼Œä¹Ÿå¯ä»¥æ˜¯å¹¿æ’­å˜é‡ã€‚å­˜å‚¨åœ¨LinkedHashMapå½“ä¸­çš„MemoryEntryï¼Œç›¸å½“äºæ˜¯é€šå¾€æ•°æ®å®ä½“çš„åœ°å€ã€‚</p><p>ä¸éš¾å‘ç°ï¼ŒBlockIdå’ŒMemoryEntryä¸€èµ·ï¼Œå°±åƒæ˜¯å±…æ°‘æˆ·å£ç°¿ä¸€æ ·ï¼Œå®Œæ•´åœ°è®°å½•äº†å­˜å–æŸä¸ªæ•°æ®å—æ‰€éœ€çš„æ‰€æœ‰å…ƒä¿¡æ¯ï¼Œç›¸å½“äºâ€œå±…æ°‘å§“åâ€ã€â€œæ‰€å±æ´¾å‡ºæ‰€â€ã€â€œå®¶åº­ä½å€â€ç­‰ä¿¡æ¯ã€‚<strong>åŸºäºè¿™äº›å…ƒä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒâ€œæŸ¥æˆ·å£â€ä¸€æ ·ï¼Œæœ‰çš„æ”¾çŸ¢ã€ç²¾å‡†å®šå‘åœ°å¯¹æ•°æ®å—è¿›è¡Œå­˜å–è®¿é—®</strong>ã€‚</p><pre><code class=\"language-scala\">val rdd: RDD[_] = _\nrdd.cache\nrdd.count\n</code></pre><p>ä»¥RDD Cacheä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°ä»£ç åˆ›å»ºRDDç¼“å­˜çš„æ—¶å€™ï¼ŒSparkä¼šåœ¨åå°å¸®æˆ‘ä»¬åšå¦‚ä¸‹3ä»¶äº‹æƒ…ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘æŠŠå®ƒæ•´ç†åˆ°äº†ä¸‹é¢çš„ç¤ºæ„å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹ã€‚</p><ol>\n<li>ä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦ï¼Œè®¡ç®—RDDæ‰§è¡Œç»“æœï¼Œç”Ÿæˆå¯¹åº”çš„æ•°æ®å—ï¼›</li>\n<li>å°†æ•°æ®å—å°è£…åˆ°MemoryEntryï¼ŒåŒæ—¶åˆ›å»ºæ•°æ®å—å…ƒæ•°æ®BlockIdï¼›</li>\n<li>å°†ï¼ˆBlockIdï¼ŒMemoryEntryï¼‰é”®å€¼å¯¹æ·»åŠ åˆ°â€œå°å†Œå­â€LinkedHashMapã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/04/fb/04f5faa135a7d5703c14a1b5e73e7dfb.jpg?wh=1920x725\" alt=\"å›¾ç‰‡\" title=\"RDD Cacheçš„è®¡ç®—è¿‡ç¨‹\"></p><p>éšç€RDD Cacheè¿‡ç¨‹çš„æ¨è¿›ï¼ŒLinkedHashMapå½“ä¸­çš„å…ƒç´ ä¼šè¶Šç§¯è¶Šå¤šï¼Œå½“è¿ˆç¾ç‘çš„å°å†Œå­å®Œæˆè®°å½•çš„æ—¶å€™ï¼ŒSparkå°±å¯ä»¥é€šè¿‡å†Œå­ä¸Šçš„â€œæˆ·å£ç°¿â€æ¥è®¿é—®æ¯ä¸€ä¸ªæ•°æ®å—ï¼Œä»è€Œå®ç°å¯¹RDD Cacheçš„è¯»å–ä¸è®¿é—®ã€‚</p><h3>DiskStoreï¼šç£ç›˜æ•°æ®è®¿é—®</h3><p>è¯´å®Œå¤§è¡¨å§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´å¤§è¡¨å“¥è¿ªæ–¯å…‹ã€‚è¿ªæ–¯å…‹çš„ä¸»è¦èŒè´£ï¼Œæ˜¯é€šè¿‡ç»´æŠ¤æ•°æ®å—ä¸ç£ç›˜æ–‡ä»¶çš„å¯¹åº”å…³ç³»ï¼Œå®ç°ç£ç›˜æ•°æ®çš„å­˜å–è®¿é—®ã€‚ç›¸æ¯”å¤§è¡¨å§çš„ä¸€ä¸ä¸è‹Ÿã€äº²åŠ›äº²ä¸ºï¼Œè¿ªæ–¯å…‹è¦â€œé¸¡è´¼â€å¾—å¤šï¼Œä»–è·Ÿå¸ƒåŠ³å…‹ä¸€æ ·ï¼Œéƒ½æ˜¯ç”©æ‰‹æŒæŸœã€‚</p><p>çœ‹åˆ°å¤§è¡¨å§æ²¡æ—¥æ²¡å¤œåœ°ç›¯ç€è‡ªå·±çš„â€œå°å†Œå­â€ï¼Œè¿ªæ–¯å…‹å¯ä¸æƒ³æ— è„‘åœ°ç»™å¸ƒåŠ³å…‹å–å‘½ï¼Œäºæ˜¯ä»–æ‹›å‹Ÿäº†ä¸€ä¸ªå¸®æ‰‹ï¼šDiskBlockManagerï¼Œæ¥å¸®ä»–ç»´æŠ¤å…ƒæ•°æ®ã€‚</p><p>æœ‰äº†DiskBlockManagerè¿™ä¸ªå¸®æ‰‹ç»™ä»–æ‰“ç†å„ç§æ‚äº‹ï¼Œè¿ªæ–¯å…‹è¿™ä¸ªå®¶ä¼™å°±å¯ä»¥å“¼ç€å°æ›²ã€å–ç€å’–å•¡ï¼Œååœ¨ä»“åº“é—¨å£æ¥å¾…æ¥æ¥å¾€å¾€çš„æ–½å·¥å·¥äººå°±å¥½äº†ã€‚è¿™äº›å·¥äººæœ‰çš„å­˜è´§ï¼Œæœ‰çš„å–è´§ï¼Œä½†ä¸è®ºæ˜¯å¹²ä»€ä¹ˆçš„ï¼Œè¿ªæ–¯å…‹ä¼šç»Ÿä¸€æŠŠä»–ä»¬æ‰“å‘åˆ°DiskBlockManageré‚£é‡Œå»ï¼Œè®©DiskBlockManagerå‘Šè¯‰ä»–ä»¬è´§ç‰©éƒ½å­˜åœ¨å“ªäº›è´§æ¶çš„ç¬¬å‡ å±‚ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/94/bbf78d73f7f202f97487f7788b417c94.jpg?wh=1920x821\" alt=\"å›¾ç‰‡\" title=\"è¿ªæ–¯å…‹çš„å¸®æ‰‹ï¼šDiskBlockManager\"></p><p>å¸®æ‰‹DiskBlockManageræ˜¯ç±»å¯¹è±¡ï¼Œå®ƒçš„getFileæ–¹æ³•ä»¥BlockIdä¸ºå‚æ•°ï¼Œè¿”å›ç£ç›˜æ–‡ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œç»™å®šæ•°æ®å—ï¼Œè¦æƒ³çŸ¥é“å®ƒå­˜åœ¨äº†å“ªä¸ªç£ç›˜æ–‡ä»¶ï¼Œéœ€è¦è°ƒç”¨getFileæ–¹æ³•å¾—åˆ°ç­”æ¡ˆã€‚<strong>æœ‰äº†æ•°æ®å—ä¸æ–‡ä»¶ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°å®Œæˆç£ç›˜ä¸­çš„æ•°æ®è®¿é—®</strong>ã€‚</p><p>ä»¥Shuffleä¸ºä¾‹ï¼Œåœ¨Shuffle Writeé˜¶æ®µï¼Œæ¯ä¸ªTaskéƒ½ä¼šç”Ÿæˆä¸€ä»½ä¸­é—´æ–‡ä»¶ï¼Œæ¯ä¸€ä»½ä¸­é—´æ–‡ä»¶éƒ½åŒ…æ‹¬å¸¦æœ‰dataåç¼€çš„æ•°æ®æ–‡ä»¶ï¼Œä»¥åŠå¸¦ç€indexåç¼€çš„ç´¢å¼•æ–‡ä»¶ã€‚é‚£ä¹ˆå¯¹äºæ¯ä¸€ä»½æ–‡ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡DiskBlockManagerçš„getFileæ–¹æ³•ï¼Œæ¥è·å–åˆ°å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/20/a1/20bd0833760yy75600d0701c9yyaeba1.jpg?wh=1920x736\" alt=\"å›¾ç‰‡\" title=\"æ ¹æ®BlockIdè·å–Shuffleä¸­é—´æ–‡ä»¶\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè·å–dataæ–‡ä»¶ä¸è·å–indexæ–‡ä»¶çš„æµç¨‹æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä»–ä»¬éƒ½æ˜¯ä½¿ç”¨BlockIdæ¥è°ƒç”¨getFileæ–¹æ³•ï¼Œä»è€Œå®Œæˆæ•°æ®è®¿é—®ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬é‡ç‚¹è®²è§£äº†Sparkå­˜å‚¨ç³»ç»Ÿã€‚å…³äºå­˜å‚¨ç³»ç»Ÿï¼Œä½ é¦–å…ˆéœ€è¦çŸ¥é“æ˜¯ï¼ŒRDD Cacheã€Shuffleä¸­é—´æ–‡ä»¶ä¸å¹¿æ’­å˜é‡è¿™ä¸‰ç±»æ•°æ®ï¼Œæ˜¯å­˜å‚¨ç³»ç»Ÿæœ€ä¸»è¦çš„æœåŠ¡å¯¹è±¡ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ä»‹ç»äº†å­˜å‚¨ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬æ˜¯åè½åœ¨Driverç«¯çš„BlockManagerMasterï¼Œä»¥åŠâ€œé©»å®ˆâ€åœ¨Executorsçš„BlockManagerã€MemoryStoreå’ŒDiskStoreã€‚BlockManagerMasterä¸ä¼—å¤šBlockManagerä¹‹é—´é€šè¿‡å¿ƒè·³æ¥å®Œæˆä¿¡æ¯äº¤æ¢ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬æ•°æ®å—çš„åœ°å€ã€ä½ç½®ã€å¤§å°å’ŒçŠ¶æ€ï¼Œç­‰ç­‰ã€‚</p><p>åœ¨Executorsä¸­ï¼ŒBlockManageré€šè¿‡MemoryStoreæ¥å®Œæˆå†…å­˜çš„æ•°æ®å­˜å–ã€‚MemoryStoreé€šè¿‡ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼šLinkedHashMapæ¥å®ŒæˆBlockIdåˆ°MemoryEntryçš„æ˜ å°„ã€‚å…¶ä¸­ï¼ŒBlockIdè®°å½•ç€æ•°æ®å—çš„å…ƒæ•°æ®ï¼Œè€ŒMemoryEntryåˆ™ç”¨äºå°è£…æ•°æ®å®ä½“ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼ŒBlockManageré€šè¿‡DiskStoreæ¥å®ç°ç£ç›˜æ•°æ®çš„å­˜å–ä¸è®¿é—®ã€‚DiskStoreå¹¶ä¸ç›´æ¥ç»´æŠ¤å…ƒæ•°æ®åˆ—è¡¨ï¼Œè€Œæ˜¯é€šè¿‡DiskBlockManagerè¿™ä¸ªå¯¹è±¡ï¼Œæ¥å®Œæˆä»æ•°æ®åº“åˆ°ç£ç›˜æ–‡ä»¶çš„æ˜ å°„ï¼Œè¿›è€Œå®Œæˆæ•°æ®è®¿é—®ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/21/a3/217f2b7493b9dbfce384c042c6574ca3.jpg?wh=1920x795\" alt=\"å›¾ç‰‡\"></p><h2>æ¯è¯¾ä¸€ç»ƒ</h2><p>LinkedHashMapæ˜¯ä¸€ç§å¾ˆç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œåœ¨ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»…ä»‹ç»äº†å®ƒåœ¨Mapæ–¹é¢çš„åŠŸç”¨ã€‚ä½ å¯ä»¥è¯•ç€è‡ªå·±æ¢³ç†ä¸€ä¸‹LinkedHashMapè¿™ç§æ•°æ®ç»“æ„çš„ç‰¹ç‚¹ä¸ç‰¹æ€§ã€‚</p><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒã€‚å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¨èä½ è½¬å‘ç»™æ›´å¤šçš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":315657,"user_name":"Geek_2dfa9a","can_delete":false,"product_type":"c1","uid":1435535,"ip_address":"","ucode":"B5FE7971F5E773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","comment_is_top":true,"comment_ctime":1633938175,"is_pvip":false,"replies":[{"id":"114423","content":"è€å¼Ÿè°¦è™šå•¦ï¼åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ çš„å›ç­”æœ€ä¸ºç²¾å½©ï¼Œæ¯æ¬¡éƒ½è®©æˆ‘å°è±¡å¾ˆæ·±ï¼ŒçœŸçš„å¾ˆæ£’ğŸ‘ï¼è€å¼Ÿå¾—ç©ºå¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼Œæˆ‘æŠŠä½ æ‹‰è¿›è¯»è€…ç¾¤~ åœ¨é‚£é‡Œå¯ä»¥è·Ÿæ›´å¤šçš„åŒå­¦æ¢è®¨ï¼Œåˆ†äº«ä½ å¯¹äºæŠ€æœ¯çš„ç†è§£å’ŒæŠŠæ¡~ <br><br>LinkedHashMapåˆ†æçš„éå¸¸åˆ°ä½ï¼Œå¾ˆæ·±å…¥ï¼Œæ»¡åˆ†ğŸ’¯ï¼Œç½®é¡¶ğŸ”ã€‚ä¸è¿‡ï¼Œæé†’ä¸€ç‚¹ï¼ŒLinkedHashMapçš„é‡‡ç”¨ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯ç”¨æ¥å®ç°RDD Cacheçš„LRUæœºåˆ¶ï¼Œè€å¼Ÿä¸å¦¨å°±è¿™ä¸€ç‚¹ï¼Œå†å±•å¼€æ€è€ƒï¼Œæˆ‘ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633965741,"ip_address":"","comment_id":315657,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720599635005e+18","product_id":100090001,"comment_content":"ä»Šå¤©çš„é¢˜å¥½åƒé¢è¯•å•Šï¼ŒLinkedHashMapæ˜¯HashMapçš„å¢å¼ºç‰ˆï¼Œç›´æ¥ç»§æ‰¿äº†HashMapç±»ï¼Œå¤šæä¾›äº†ä¸€ä¸ªå¯ä»¥æŒ‰æ’å…¥é¡ºåºçš„éå†ï¼Œè¿™ä¸ªéå†æ˜¯é€šè¿‡<br>ä¸¤æ–¹é¢å®ç°çš„ï¼š<br>1.ç›´æ¥æ‰©å±•HashMapçš„Map.Entryï¼Œå¢åŠ äº†before,afterçš„æŒ‡é’ˆï¼Œè¿™æ ·å°±åœ¨ä¸æ”¹å˜æœ¬èº«æ•°ç»„çš„ç»“æ„ä¸‹<br>ï¼ˆå“ˆå¸Œè¡¨æœ¬èº«é€šè¿‡æ•°ç»„å®ç°å¸¸æ•°çº§æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ï¼Œå› æ­¤ä¼šæ‰“ä¹±æ’å…¥é¡ºåºï¼‰ï¼Œåˆå˜æˆäº†ä¸€ä¸ªåŒé“¾è¡¨ï¼ŒåŒé“¾è¡¨çš„é¡ºåºå°±æ˜¯æ’å…¥é¡ºåºã€‚<br>2.è®°å½•é“¾å¤´ï¼Œé“¾å°¾ï¼Œè¿™æ ·å°±å¯ä»¥ä»å¤´&#47;å°¾æŒ‰é¡ºåºéå†äº†ã€‚<br>è¿™é‡ŒLinkedHashMapæ˜¯æ€ä¹ˆç»„ç»‡é“¾è¡¨çš„å€¼å¾—æä¸€ä¸‹ï¼ŒLinkedHashMapæ²¡æœ‰è¦†ç›–HashMapçš„putæ–¹æ³•ï¼ŒHashMapä½¿ç”¨äº†æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼ï¼Œ<br>å¾ˆå¥½çš„å®ç°äº†æ‰©å±•å’Œè§£è€¦ï¼Œé€šè¿‡æä¾›ç©ºæ–¹æ³•æ‰©å±•ç‚¹afterNodeAccessï¼ŒafterNodeInsertionï¼ŒafterNodeRemovalï¼Œ<br>LinkedHashMapæ˜¯é€šè¿‡é‡å†™è¿™äº›æ‰©å±•ç‚¹å®ç°äº†é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ã€‚<br>æœ€åå›ä¸€ä¸‹ä¸ŠèŠ‚è¯¾å’Œè€å¸ˆäº¤æµçš„æ‰“å¼€è§†é‡ï¼Œç›®å‰æ¥è¯´ï¼ŒSparkå¯¹æˆ‘æ¥è¯´æœ‰ç‚¹åƒç›²äººæ‘¸è±¡ï¼Œç°åœ¨åªæ‘¸åˆ°äº†è±¡è…¿ï¼Œæ‰€ä»¥è¯´å¤§è±¡åƒæ ¹æŸ±å­ï¼Œ<br>ä½†æ˜¯Sparkå¯èƒ½è¿˜æœ‰å¾ˆå¤šç²¾å½©çš„åœ°æ–¹æˆ‘æ²¡æ‘¸åˆ°ï¼ŒæœŸå¾…è€å¸ˆå¸¦æˆ‘ä»¬ä»å¤šè§’åº¦æ·±å…¥äº†è§£Sparkè¿™å¤´å¤§è±¡ã€‚","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528139,"discussion_content":"è€å¼Ÿè°¦è™šå•¦ï¼åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ çš„å›ç­”æœ€ä¸ºç²¾å½©ï¼Œæ¯æ¬¡éƒ½è®©æˆ‘å°è±¡å¾ˆæ·±ï¼ŒçœŸçš„å¾ˆæ£’ğŸ‘ï¼è€å¼Ÿå¾—ç©ºå¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼Œæˆ‘æŠŠä½ æ‹‰è¿›è¯»è€…ç¾¤~ åœ¨é‚£é‡Œå¯ä»¥è·Ÿæ›´å¤šçš„åŒå­¦æ¢è®¨ï¼Œåˆ†äº«ä½ å¯¹äºæŠ€æœ¯çš„ç†è§£å’ŒæŠŠæ¡~ \n\nLinkedHashMapåˆ†æçš„éå¸¸åˆ°ä½ï¼Œå¾ˆæ·±å…¥ï¼Œæ»¡åˆ†ğŸ’¯ï¼Œç½®é¡¶ğŸ”ã€‚ä¸è¿‡ï¼Œæé†’ä¸€ç‚¹ï¼ŒLinkedHashMapçš„é‡‡ç”¨ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯ç”¨æ¥å®ç°RDD Cacheçš„LRUæœºåˆ¶ï¼Œè€å¼Ÿä¸å¦¨å°±è¿™ä¸€ç‚¹ï¼Œå†å±•å¼€æ€è€ƒï¼Œæˆ‘ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633965741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2455712,"avatar":"https://static001.geekbang.org/account/avatar/00/25/78/a0/7a248ddc.jpg","nickname":"ç¦","note":"","ucode":"F2FC7AF5D433C6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539774,"discussion_content":"è€å“¥çœŸçš„æ˜¯å¤ªå¼ºäº†ï¼Œæ¯æ¬¡ç½®é¡¶çš„è¯„è®ºåŸºæœ¬éƒ½æ˜¯ä½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639837494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315894,"user_name":"Geek_2dfa9a","can_delete":false,"product_type":"c1","uid":1435535,"ip_address":"","ucode":"B5FE7971F5E773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","comment_is_top":false,"comment_ctime":1634034208,"is_pvip":false,"replies":[{"id":"114536","content":"åˆ†æå¾—å¾ˆé€å½»ï¼ŒmemoryStoreç¼“å­˜æ•°æ®ã€evictæ•°æ®çš„è¿‡ç¨‹è¯´å¾—å¾ˆæ¸…æ¥šï½ èµğŸ‘ï¼ï¼ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634174291,"ip_address":"","comment_id":315894,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35993772576","product_id":100090001,"comment_content":"MemoryStoreè¿™å—æ¶‰åŠå¤§é‡çš„nioï¼Œçœ‹å¾—æˆ‘å¤´çš®å‘éº»ã€‚ç®€å•ç‚¹è®²ï¼Œé‡Œé¢æœ‰ä¸ªæ ¸å¿ƒçš„å¸¸é‡LinkedHashMapï¼Œä½œä¸ºLRUç¼“å­˜ï¼Œå­˜å‚¨æ‰€æœ‰Blockã€‚<br>putBytes()è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥å†™æ•°æ®ï¼Œæ–¹æ³•å…¥å‚åˆ†åˆ«æ˜¯blockIdï¼ˆæ•°æ®å—çš„æ ‡è¯†ï¼‰ï¼Œsizeï¼ˆæ•°æ®å—é•¿åº¦ï¼‰ï¼ŒmemoryModeï¼ˆå­˜æ”¾åœ¨å †ä¸Šè¿˜æ˜¯å †å¤–ï¼‰ï¼Œ<br>_bytesï¼ˆå…·ä½“å†…å­˜åˆ†é…çš„é—­åŒ…ï¼‰ï¼Œå…·ä½“å®ç°é€»è¾‘æ˜¯ï¼Œå…ˆæ£€æŸ¥blockIdå¯¹åº”çš„æ•°æ®å—æ˜¯å¦å·²ç¼“å­˜ï¼Œç„¶åé€šè¿‡memoryManagerï¼ˆ1.6ä»¥å‰æ˜¯StaticMemoryManagerï¼Œ<br>ä¸èƒ½æ”¯æŒå †å¤–å†…å­˜ï¼Œ1.6ä»¥åé»˜è®¤UnifiedMemoryManagerï¼Œå¯ä»¥é€šè¿‡spark.memory.useLegacyModeæŒ‡å®šï¼‰ç¡®è®¤å†…å­˜æ˜¯å¦å¤Ÿç¼“å­˜ï¼Œåœ¨åé€šè¿‡<br>_bytesæŠŠæ•°æ®æ‹·è´åˆ°DirectByteBufferï¼Œå¦‚æœæ•°æ®æœ¬æ¥å°±åœ¨å †å¤–çš„è¯å°±çœç•¥è¿™ä¸ªé€»è¾‘ï¼Œæœ€åæŠŠblockIdä½œä¸ºkeyï¼ŒChunkedByteBuffer<br>ï¼ˆå°±æ˜¯ä¸€ä¸ªDirectByteBufferæ•°ç»„ï¼Œé‡Œé¢æ˜¯è¦ç¼“å­˜çš„æ•°æ®ï¼‰ä½œä¸ºSerializedMemoryEntryå­˜åˆ°LinkedHashMapé‡Œï¼Œè¿™é‡Œæ³¨æ„ï¼Œ<br>ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒLinkedHashMapéœ€è¦åŠ é”ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç»†ç²’åº¦é”åŠ åˆ°å°‘éƒ¨åˆ†ä»£ç ä¸Šå‡å°‘å¼€é”€ã€‚<br>ä¸Šé¢çš„æ˜¯ç¼“å­˜åºåˆ—åŒ–å—çš„é€»è¾‘ï¼ŒputIteratoræ—¢å¯ä»¥ç¼“å­˜åºåˆ—åŒ–çš„å€¼ï¼ˆå †å†…&#47;å †å¤–ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼“å­˜å¯¹è±¡ï¼ˆåªèƒ½å­˜æ”¾åœ¨å †å†…ï¼‰ï¼Œå…·ä½“é€»è¾‘å’ŒLinkedHashMap<br>ä¸å¤ªç›¸å…³äº†ï¼Œç¯‡å¹…æœ‰é™å°±ä¸åˆ†æäº†ã€‚<br>ä½œä¸ºä¸€ä¸ªLRUç¼“å­˜ï¼ŒSparkè‚¯å®šè¿˜è¦æœ‰ä¸€ä¸ªå®¹é‡æ»¡åçš„æ¸…é™¤æ“ä½œï¼Œè§¦å‘ç‚¹åœ¨putæ—¶æ ¡éªŒç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå…·ä½“é€»è¾‘åœ¨evictBlocksToFreeSpaceï¼Œ<br>å…¥å‚æœ‰ä¸‰ä¸ªblockIdï¼ˆå¤±æ•ˆåéœ€è¦ç¼“å­˜çš„blockï¼‰ï¼Œspaceï¼ˆéœ€è¦ç¼“å­˜çš„blockçš„é•¿åº¦ï¼‰ï¼ŒmemoryModeã€‚ç¼“å­˜å¤±æ•ˆè¿™å—å½±å“æ¯”è¾ƒå¤§ï¼Œéœ€è¦åŠ ä¸¤ä¸ªé”ï¼Œ<br>åœ¨å¤–å±‚ç»™memoryManageråŠ é”ï¼Œä¹‹åå†ç»™LinkedHashMapåŠ é”ï¼Œå› ä¸ºputçš„æ—¶å€™memoryManageræ²¡åŠ é”ï¼Œå¦‚æœæ­£åœ¨putçš„æ—¶å€™æ¸…ç†ç¼“å­˜ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼Œ<br>å› æ­¤LinkedHashMapä¹Ÿéœ€è¦åŠ é”ï¼Œä¿è¯åŒä¸€æ—¶é—´LinkedHashMapåªèƒ½æœ‰ä¸€ä¸ªæ“ä½œï¼Œä¹‹åçš„æ“ä½œå°±ç®€å•äº†ï¼Œæ‹¿åˆ°LinkedHashMapçš„è¿­ä»£å™¨ï¼Œ<br>ä»ç¬¬ä¸€ä¸ªEntryå¼€å§‹åˆ¤æ–­ï¼Œå¦‚æœå¯ä»¥å¤±æ•ˆï¼ˆï¼‰çš„è¯å°±è®°å½•ä¸‹blockIdå¹¶åœ¨blockInfoManageré’ˆå¯¹blockIdåŠ é”ï¼Œ<br>ä¸€ç›´åˆ°é‡Šæ”¾çš„å†…å­˜è¾¾åˆ°spaceã€‚æ¥ä¸‹æ¥åˆ¤æ–­å¦‚æœæ¸…ç†è¿™äº›å¤±æ•ˆçš„blockèƒ½å¦æ‹¿åˆ°éœ€è¦çš„spaceï¼Œä¸èƒ½çš„è¯å°±è¿”å›0ï¼Œè¡¨ç¤ºä¸èƒ½æ¸…ç†å‡ºæ‰€éœ€ç©ºé—´ï¼Œå¦‚æœèƒ½æ‹¿åˆ°çš„è¯ï¼Œ<br>å°±å¼€å§‹dropBlockï¼ˆï¼‰ï¼Œæœ‰äº›blockå¯èƒ½åŒæ—¶åœ¨ç£ç›˜å’Œå†…å­˜ç¼“å­˜ï¼Œå¦‚æœåªæ¸…é™¤ä¸€å¤„çš„è¯blockInfoæ— éœ€åˆ é™¤è§£é”å³å¯ï¼Œå¦‚æœç£ç›˜å’Œå†…å­˜éƒ½æ²¡æœ‰äº†åˆ™éœ€åˆ é™¤blockInfoï¼Œ<br>å¦‚æœæ¸…ç†è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æŠŠè¿˜æ²¡æ¸…ç†çš„blockInfoè§£é”ï¼ˆè¿™å—é€»è¾‘æ”¾åœ¨finallyé‡Œï¼Œå¹¶ä¸”ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æŠ€å·§æ³¨é‡Šå‡ºæ¥ï¼‰ã€‚<br>å¦å¤–æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼ŒSparkä¸ºäº†é¿å…MaxDirectMemorySizeçš„é™åˆ¶ï¼Œä½¿ç”¨äº†åå°„æ‹¿åˆ°äº†DirectByteBufferçš„ç§æœ‰æ„é€ æ–¹æ³•<br>private DirectByteBuffer(long addr, int cap)ï¼Œè¿™æ ·å°±é¿å¼€äº†allocateDirectæ–¹æ³•é‡Œé¢Bits.reserveMemoryçš„é™åˆ¶ã€‚","like_count":9,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528194,"discussion_content":"åˆ†æå¾—å¾ˆé€å½»ï¼ŒmemoryStoreç¼“å­˜æ•°æ®ã€evictæ•°æ®çš„è¿‡ç¨‹è¯´å¾—å¾ˆæ¸…æ¥šï½ èµğŸ‘ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634174291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316846,"user_name":"Alvin-L","can_delete":false,"product_type":"c1","uid":1603052,"ip_address":"","ucode":"5AC96AAB75B720","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/ec/c60b29f5.jpg","comment_is_top":false,"comment_ctime":1634567213,"is_pvip":false,"replies":[{"id":"114779","content":"é¦–å…ˆæ˜ç¡®ä¸€ç‚¹å“ˆï¼ŒSparkæ˜¯çº¯ç²¹çš„è®¡ç®—å¼•æ“ï¼Œå®ƒæœ¬èº«æ˜¯æ²¡æœ‰å­˜å‚¨å¼•æ“çš„ã€‚å½“ç„¶ï¼Œå®ƒæœ‰è‡ªå·±çš„å­˜å‚¨ç³»ç»Ÿï¼ˆBlockManageré‚£ä¸€å¥—ä½“ç³»ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªå­˜å‚¨ç³»ç»Ÿè·Ÿå­˜å‚¨å¼•æ“ï¼ˆæ¯”å¦‚S3ã€HDFSï¼‰æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼ŒSparkéœ€è¦å¤–éƒ¨å­˜å‚¨å¼•æ“æ¥è·å–æ•°æ®æºï¼ŒSparkè‡ªå·±çš„BlockManagerä»…ä»…æ˜¯ä¸ºäº†æ›´å¥½åœ°è¾…åŠ©åˆ†å¸ƒå¼è®¡ç®—ã€‚<br><br>è€å¼Ÿè¯´çš„MySQLæ•°æ®ï¼Œæˆ‘ç†è§£æ˜¯ç‰©åŒ–åˆ°ç£ç›˜çš„æ•°æ®è®°å½•ã€‚è¦æŠŠMySQLçš„æ•°æ®ï¼Œdumpåˆ°S3ï¼Œæˆ–æ˜¯HDFSï¼Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡Sparkæ¥åšï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–å¤§æ•°æ®ç»„ä»¶æ¥åšï¼Œæ¯”è¾ƒMapReduceæˆ–æ˜¯æ—©æœŸçš„Sqoopï¼Œå½“ç„¶ï¼Œç°åœ¨Sqoopé€æ¸é€€å‡ºå†å²èˆå°ã€‚<br><br>å¦‚æœè¦ç”¨Sparkåšçš„è¯ï¼Œä¹Ÿå°±æ˜¯æŠŠMySQLæ•°æ®dumpåˆ°HDFSæˆ–æ˜¯S3ï¼Œå…¶å®å°±æ˜¯read API + write APIè¿™ä¹ˆç®€å•ï¼Œä¸­é—´éƒ½æ²¡å•¥è®¡ç®—é€»è¾‘å…¶å®ï¼Œå°±æ˜¯çº¯ç²¹çš„è¯» + å†™ï¼Œæå®š~<br><br>ä¸çŸ¥é“é—®é¢˜æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼Œå’±ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634654935,"ip_address":"","comment_id":316846,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5929534509","product_id":100090001,"comment_content":"åŸæœ¬å­˜å‚¨åœ¨mysqlé‡Œçš„æ•°æ®å¦‚ä½•è½¬å­˜å‚¨åˆ°sparké‡Œï¼Ÿè€å¸ˆå¯å¦åŠ é¤è®²ä¸€è®²mysqlè½¬å­˜sparkçš„ç›¸å…³å†…å®¹","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528534,"discussion_content":"é¦–å…ˆæ˜ç¡®ä¸€ç‚¹å“ˆï¼ŒSparkæ˜¯çº¯ç²¹çš„è®¡ç®—å¼•æ“ï¼Œå®ƒæœ¬èº«æ˜¯æ²¡æœ‰å­˜å‚¨å¼•æ“çš„ã€‚å½“ç„¶ï¼Œå®ƒæœ‰è‡ªå·±çš„å­˜å‚¨ç³»ç»Ÿï¼ˆBlockManageré‚£ä¸€å¥—ä½“ç³»ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªå­˜å‚¨ç³»ç»Ÿè·Ÿå­˜å‚¨å¼•æ“ï¼ˆæ¯”å¦‚S3ã€HDFSï¼‰æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼ŒSparkéœ€è¦å¤–éƒ¨å­˜å‚¨å¼•æ“æ¥è·å–æ•°æ®æºï¼ŒSparkè‡ªå·±çš„BlockManagerä»…ä»…æ˜¯ä¸ºäº†æ›´å¥½åœ°è¾…åŠ©åˆ†å¸ƒå¼è®¡ç®—ã€‚\n\nè€å¼Ÿè¯´çš„MySQLæ•°æ®ï¼Œæˆ‘ç†è§£æ˜¯ç‰©åŒ–åˆ°ç£ç›˜çš„æ•°æ®è®°å½•ã€‚è¦æŠŠMySQLçš„æ•°æ®ï¼Œdumpåˆ°S3ï¼Œæˆ–æ˜¯HDFSï¼Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡Sparkæ¥åšï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–å¤§æ•°æ®ç»„ä»¶æ¥åšï¼Œæ¯”è¾ƒMapReduceæˆ–æ˜¯æ—©æœŸçš„Sqoopï¼Œå½“ç„¶ï¼Œç°åœ¨Sqoopé€æ¸é€€å‡ºå†å²èˆå°ã€‚\n\nå¦‚æœè¦ç”¨Sparkåšçš„è¯ï¼Œä¹Ÿå°±æ˜¯æŠŠMySQLæ•°æ®dumpåˆ°HDFSæˆ–æ˜¯S3ï¼Œå…¶å®å°±æ˜¯read API + write APIè¿™ä¹ˆç®€å•ï¼Œä¸­é—´éƒ½æ²¡å•¥è®¡ç®—é€»è¾‘å…¶å®ï¼Œå°±æ˜¯çº¯ç²¹çš„è¯» + å†™ï¼Œæå®š~\n\nä¸çŸ¥é“é—®é¢˜æˆ‘ç†è§£çš„å¯¹ä¸å¯¹å“ˆï¼Œå’±ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634654935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2611429,"avatar":"https://static001.geekbang.org/account/avatar/00/27/d8/e5/bb87e21f.jpg","nickname":"ç©Œæ»‚","note":"","ucode":"2FDBCA735052C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575195,"discussion_content":"è€å¸ˆï¼Œè¯·é—®ç”¨Spark SQLæŠŠMySQLçš„æ•°æ®å¯¼å‡ºåˆ°S3å­˜æˆParquetæ ¼å¼ä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿç”¨SizeEstimatorå¾—åˆ°çš„table sizeå¾€å¾€æ¯”å®é™…ä¸ŠMySQLé‡Œé¢çš„table sizeè¦å¤§å¥½å‡ å€ã€‚æ‰€ä»¥æ€»æ˜¯å¯¼è‡´OOMã€‚è¯·é—®è¿™ç§æƒ…å†µè¦æ€ä¹ˆå¤„ç†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654661902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314756,"user_name":"Neo-dqy","can_delete":false,"product_type":"c1","uid":1924786,"ip_address":"","ucode":"9BF300EB1DDD00","user_header":"https://static001.geekbang.org/account/avatar/00/1d/5e/b2/aceb3e41.jpg","comment_is_top":false,"comment_ctime":1633404319,"is_pvip":false,"replies":[{"id":"114119","content":"å¥½é—®é¢˜ï½ 2.0ä¹‹å‰ï¼Œsparkç”¨akkaæ¥å®ç°ä¸åŒç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚2.0ä»¥åï¼ŒsparkæŠ›å¼ƒakkaï¼ŒåŸºäºnettyå®ç°äº†è‡ªå·±çš„rpcç³»ç»Ÿï¼Œä¸»è¦å¯¹è±¡æœ‰ï¼š<br>rpcEndpointï¼Œå¯¹æ ‡akkaçš„actor<br>rpcEndpointRefï¼Œå¯¹æ ‡akkçš„actorRef<br>rpcEnvï¼Œå¯¹æ ‡akkaçš„actorSystem<br><br>Spark RPCè§£è€¦äº†Spark Coreå’Œåº•å±‚é€šä¿¡ç³»ç»Ÿï¼Œè®©sparkä¸åŒç»„ä»¶ä¹‹é—´ï¼ˆåŒ…æ‹¬å­˜å‚¨ç³»ç»Ÿï¼Œblockmanagerï¼Œç­‰ï¼‰å®ç°é«˜æ•ˆå¼‚æ­¥é€šä¿¡","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633741944,"ip_address":"","comment_id":314756,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5928371615","product_id":100090001,"comment_content":"ã€BlockManagerMaster ä¸ä¼—å¤š BlockManager ä¹‹é—´é€šè¿‡**å¿ƒè·³**æ¥å®Œæˆä¿¡æ¯äº¤æ¢ã€‘ï¼Œå¯ä»¥é—®ä¸€ä¸‹è€å¸ˆè¿™ä¸ªå¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆå‘€ï¼Ÿå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527785,"discussion_content":"å¥½é—®é¢˜ï½ 2.0ä¹‹å‰ï¼Œsparkç”¨akkaæ¥å®ç°ä¸åŒç»„ä»¶ä¹‹é—´çš„é€šä¿¡ã€‚2.0ä»¥åï¼ŒsparkæŠ›å¼ƒakkaï¼ŒåŸºäºnettyå®ç°äº†è‡ªå·±çš„rpcç³»ç»Ÿï¼Œä¸»è¦å¯¹è±¡æœ‰ï¼š\nrpcEndpointï¼Œå¯¹æ ‡akkaçš„actor\nrpcEndpointRefï¼Œå¯¹æ ‡akkçš„actorRef\nrpcEnvï¼Œå¯¹æ ‡akkaçš„actorSystem\n\nSpark RPCè§£è€¦äº†Spark Coreå’Œåº•å±‚é€šä¿¡ç³»ç»Ÿï¼Œè®©sparkä¸åŒç»„ä»¶ä¹‹é—´ï¼ˆåŒ…æ‹¬å­˜å‚¨ç³»ç»Ÿï¼Œblockmanagerï¼Œç­‰ï¼‰å®ç°é«˜æ•ˆå¼‚æ­¥é€šä¿¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633741944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314687,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1633326985,"is_pvip":true,"replies":[{"id":"114046","content":"æ­£è§£ï¼Œæ»¡åˆ†ğŸ’¯~ ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633601562,"ip_address":"","comment_id":314687,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5928294281","product_id":100090001,"comment_content":"LinkedHashMap å¯ç”¨æ¥å®ç° LRU Cache","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527763,"discussion_content":"æ­£è§£ï¼Œæ»¡åˆ†ğŸ’¯~ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633601562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351896,"user_name":"Wangyf","can_delete":false,"product_type":"c1","uid":2226219,"ip_address":"","ucode":"349068A07CB1D4","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","comment_is_top":false,"comment_ctime":1658282629,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658282629","product_id":100090001,"comment_content":"æ’ä¸ªçœ¼ã€‚<br>ä¸ºå˜›å†…å­˜çš„é‚£ä¸ª MemoryStore æ˜¯è‡ªå·±å¹²æ´»ï¼Œä½†ç£ç›˜çš„ DiskStore å´è¦ç»´æŠ¤å¦ä¸€ä¸ªå¯¹è±¡æ¥å¹²æ´»ï¼Ÿé‚£å®ƒè‡ªå·±åˆå»å¹²å˜›äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":340587,"user_name":"qingtama","can_delete":false,"product_type":"c1","uid":1069042,"ip_address":"","ucode":"765040243ECE01","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/f2/6ac3bdcf.jpg","comment_is_top":false,"comment_ctime":1648956428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648956428","product_id":100090001,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œå¦‚æœä½¿ç”¨LinkedHashMapæ˜¯ä¸ºäº†LRUçš„è¯å°±æ˜¯è¯´æ•°æ®ä¼šæœ‰è¢«æ·˜æ±°çš„æƒ…å†µï¼Œä½†æ˜¯æˆ‘ç†è§£ä¸è¿‡æ˜¯å†…å­˜çš„æ•°æ®è¿˜æ˜¯ç£ç›˜çš„æ•°æ®éƒ½ä¸èƒ½å› ä¸ºè¾¾åˆ°äº†LinkedHashMapå­˜å‚¨ä¸Šé™è€Œè¢«æ¸…ç†æ‰å§ï¼Œå°¤å…¶æ•°æ®éƒ½åœ¨è¢«ä½¿ç”¨ç€çš„æ—¶å€™ã€‚","like_count":0},{"had_liked":false,"id":318204,"user_name":"å°å¼º","can_delete":false,"product_type":"c1","uid":2398148,"ip_address":"","ucode":"C3D1215867302D","user_header":"https://static001.geekbang.org/account/avatar/00/24/97/c4/6c92c78a.jpg","comment_is_top":false,"comment_ctime":1635204942,"is_pvip":false,"replies":[{"id":"115462","content":"å¹¶ä¸æ˜¯å“ˆï¼Œshuffleä¸­é—´æ–‡ä»¶æ˜¯ç‰©åŒ–åˆ°spark.local.dirè¿™ä¸ªé…ç½®é¡¹è®¾ç½®çš„åœ°å€ï¼Œä¸»è¦æ˜¯ç£ç›˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯Ramdiskï¼ˆæŠŠå†…å­˜å½“ç£ç›˜ç”¨ï¼Œå¼€è¾Ÿå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚æ€»ä¹‹ï¼Œå…·ä½“å­˜åœ¨å“ªé‡Œï¼Œæ˜¯ç”±spark.local.dirå†³å®šçš„ï¼Œè€Œè¿™ä¸ªé…ç½®é¡¹ï¼Œå¾€å¾€æ˜¯ç£ç›˜","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635260029,"ip_address":"","comment_id":318204,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635204942","product_id":100090001,"comment_content":"è¯·é—®è€å¸ˆï¼ŒRDD Cache ä»¥åŠå¹¿æ’­å˜é‡æ˜¯å­˜å‚¨åœ¨storage memory, é‚£shuffleä¸­é—´æ–‡ä»¶æ˜¯å¦æ˜¯å­˜å‚¨åœ¨execution memoryé‡Œå•Šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529139,"discussion_content":"å¹¶ä¸æ˜¯å“ˆï¼Œshuffleä¸­é—´æ–‡ä»¶æ˜¯ç‰©åŒ–åˆ°spark.local.dirè¿™ä¸ªé…ç½®é¡¹è®¾ç½®çš„åœ°å€ï¼Œä¸»è¦æ˜¯ç£ç›˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯Ramdiskï¼ˆæŠŠå†…å­˜å½“ç£ç›˜ç”¨ï¼Œå¼€è¾Ÿå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚æ€»ä¹‹ï¼Œå…·ä½“å­˜åœ¨å“ªé‡Œï¼Œæ˜¯ç”±spark.local.dirå†³å®šçš„ï¼Œè€Œè¿™ä¸ªé…ç½®é¡¹ï¼Œå¾€å¾€æ˜¯ç£ç›˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635260029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314900,"user_name":"é’±é¹ Allen","can_delete":false,"product_type":"c1","uid":2518863,"ip_address":"","ucode":"7E95E82C0717DA","user_header":"https://static001.geekbang.org/account/avatar/00/26/6f/4f/3cf1e9c4.jpg","comment_is_top":false,"comment_ctime":1633555902,"is_pvip":true,"replies":[{"id":"114047","content":"å¯ä»¥å‚è€ƒqinsiçš„å›å¤~ LinkedHashMapç‰¹æœ‰çš„ç»“æ„ï¼ŒSparkä¸»è¦åˆ©ç”¨å®ƒå®ç°LRU","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633601629,"ip_address":"","comment_id":314900,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1633555902","product_id":100090001,"comment_content":"LinkedHashMapå¯ä»¥ç±»æ¯”HashMapå‰è€…æœ‰åºï¼Œåè€…æ— åº","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527829,"discussion_content":"å¯ä»¥å‚è€ƒqinsiçš„å›å¤~ LinkedHashMapç‰¹æœ‰çš„ç»“æ„ï¼ŒSparkä¸»è¦åˆ©ç”¨å®ƒå®ç°LRU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633601629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2518863,"avatar":"https://static001.geekbang.org/account/avatar/00/26/6f/4f/3cf1e9c4.jpg","nickname":"é’±é¹ Allen","note":"","ucode":"7E95E82C0717DA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401244,"discussion_content":"è°¢è°¢è€å¸ˆçš„æŒ‡ç‚¹ï¼Œå‘ç°è‡ªå·±çš„ä¸“ä¸šåŸºç¡€è¿˜æœ‰å¾ˆå¤§çš„æå‡ç©ºé—´ğŸŒ¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633611130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314847,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1633501141,"is_pvip":false,"replies":[{"id":"114120","content":"blockidæ˜¯å¯¹æ•°æ®å—çš„ç»Ÿä¸€å°è£…ï¼ˆç±»ï¼‰ï¼Œå¯ä»¥ä»£è¡¨rdd cache blockã€å¹¿æ’­å˜é‡blockã€shuffle blockã€‚æ˜¯å¦ä¸ºshuffle blockè¿™ä¸ªå­—æ®µï¼Œå°±æ˜¯ç”¨æ¥åˆ¤æ–­å°è£…çš„æ•°æ®å—æ˜¯ä¸æ˜¯ç”¨äºshuffleçš„ï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633742754,"ip_address":"","comment_id":314847,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1633501141","product_id":100090001,"comment_content":"è€å¸ˆåœ¨æ–‡ç« å€’æ•°ç¬¬äºŒå¼ å›¾ç‰‡é‡Œshuffleä¸­é—´æ–‡ä»¶çš„blockidé‡Œæœ‰ä¸ªå±æ€§å« æ˜¯å¦ä¸ºshuffle block ï¼Œè¿™é‡Œçš„shuffle blockæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆshuffleä¸­é—´æ–‡ä»¶ä¸å±äºshuffle block?","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527809,"discussion_content":"blockidæ˜¯å¯¹æ•°æ®å—çš„ç»Ÿä¸€å°è£…ï¼ˆç±»ï¼‰ï¼Œå¯ä»¥ä»£è¡¨rdd cache blockã€å¹¿æ’­å˜é‡blockã€shuffle blockã€‚æ˜¯å¦ä¸ºshuffle blockè¿™ä¸ªå­—æ®µï¼Œå°±æ˜¯ç”¨æ¥åˆ¤æ–­å°è£…çš„æ•°æ®å—æ˜¯ä¸æ˜¯ç”¨äºshuffleçš„ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633742754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401939,"discussion_content":"shuffleä¸­é—´æ–‡ä»¶ä¸å°±æ˜¯ç”¨æ¥shuffleçš„å— ä¸ºä»€ä¹ˆä¸å±äºshuffle blockã€‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633769335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1690884,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","nickname":"å°æ–°","note":"","ucode":"DCAD04665E2CF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534994,"discussion_content":"åŒæ ·ç–‘é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638329393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":401939,"ip_address":""},"score":534994,"extra":""}]}]}]}