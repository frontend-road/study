{"id":318978,"title":"12 | å®¹å™¨æ–‡ä»¶Quotaï¼šå®¹å™¨ä¸ºä»€ä¹ˆæŠŠå®¿ä¸»æœºçš„ç£ç›˜å†™æ»¡äº†ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚ä»Šå¤©æˆ‘ä»¬èŠä¸€èŠå®¹å™¨æ–‡ä»¶Quotaã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å®¹å™¨æ–‡ä»¶ç³»ç»ŸOverlayFSï¼Œè¿™ä¸ªOverlayFSæœ‰ä¸¤å±‚ï¼Œåˆ†åˆ«æ˜¯lowerdirå’Œupperdirã€‚lowerdiré‡Œæ˜¯å®¹å™¨é•œåƒä¸­çš„æ–‡ä»¶ï¼Œå¯¹äºå®¹å™¨æ¥è¯´æ˜¯åªè¯»çš„ï¼›upperdirå­˜æ”¾çš„æ˜¯å®¹å™¨å¯¹æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ‰€æœ‰æ”¹åŠ¨ï¼Œå®ƒæ˜¯å¯è¯»å†™çš„ã€‚</p><p>ä»å®¿ä¸»æœºçš„è§’åº¦çœ‹ï¼Œupperdirå°±æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¦‚æœå®¹å™¨ä¸æ–­å¾€å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­å†™å…¥æ•°æ®ï¼Œå®é™…ä¸Šå°±æ˜¯å¾€å®¿ä¸»æœºçš„ç£ç›˜ä¸Šå†™æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¹Ÿå°±å­˜åœ¨äºå®¿ä¸»æœºçš„ç£ç›˜ç›®å½•ä¸­ã€‚</p><p>å½“ç„¶å¯¹äºå®¹å™¨æ¥è¯´ï¼Œå¦‚æœæœ‰å¤§é‡çš„å†™æ“ä½œæ˜¯ä¸å»ºè®®å†™å…¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œä¸€èˆ¬æ˜¯éœ€è¦ç»™å®¹å™¨æŒ‚è½½ä¸€ä¸ªvolumeï¼Œç”¨æ¥æ»¡è¶³å¤§é‡çš„æ–‡ä»¶è¯»å†™ã€‚</p><p>ä½†æ˜¯ä¸èƒ½é¿å…çš„æ˜¯ï¼Œç”¨æˆ·åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ç¨‹åºæœ‰é”™è¯¯ï¼Œæˆ–è€…è¿›è¡Œäº†é”™è¯¯çš„é…ç½®ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æŠŠlogå†™åœ¨äº†å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ²¡æœ‰åšlog rotationï¼Œé‚£ä¹ˆæ—¶é—´ä¸€ä¹…ï¼Œå°±ä¼šå¯¼è‡´å®¿ä¸»æœºä¸Šçš„ç£ç›˜è¢«å†™æ»¡ã€‚è¿™æ ·å½±å“çš„å°±ä¸æ­¢æ˜¯å®¹å™¨æœ¬èº«äº†ï¼Œè€Œæ˜¯æ•´ä¸ªå®¿ä¸»æœºäº†ã€‚</p><p>é‚£å¯¹äºè¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><h2>é—®é¢˜å†ç°</h2><p>æˆ‘ä»¬å¯ä»¥è‡ªå·±å…ˆå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œä¸€èµ·è¯•è¯•ä¸æ–­åœ°å¾€å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­å†™å…¥æ•°æ®ï¼Œçœ‹çœ‹æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„æƒ…å†µã€‚</p><p>ç”¨Dockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨åï¼Œæˆ‘ä»¬çœ‹åˆ°å®¹å™¨çš„æ ¹ç›®å½•(/)ä¹Ÿå°±æ˜¯å®¹å™¨æ–‡ä»¶ç³»ç»ŸOverlayFSï¼Œå®ƒçš„å¤§å°æ˜¯160Gï¼Œå·²ç»ä½¿ç”¨äº†100Gã€‚å…¶å®è¿™ä¸ªå¤§å°ä¹Ÿæ˜¯å®¿ä¸»æœºä¸Šçš„ç£ç›˜ç©ºé—´å’Œä½¿ç”¨æƒ…å†µã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/d3/3e/d32c83e404a81b301fbf8bdfd7a9c23e.png?wh=1264*586\" alt=\"\"></p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°å®¿ä¸»æœºä¸ŠéªŒè¯ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°å®¿ä¸»æœºçš„æ ¹ç›®å½•(/)çš„å¤§å°ä¹Ÿæ˜¯160Gï¼ŒåŒæ ·æ˜¯ä½¿ç”¨äº†100Gã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/0b/b54deb08e46ff1155303581e9d1c8f0b.png?wh=1242*366\" alt=\"\"></p><p>å¥½ï¼Œé‚£ç°åœ¨æˆ‘ä»¬å†å¾€å®¹å™¨çš„æ ¹ç›®å½•é‡Œå†™å…¥10GBçš„æ•°æ®ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨çš„æ ¹ç›®å½•ä½¿ç”¨çš„å¤§å°å¢åŠ äº†ï¼Œä»åˆšæ‰çš„100Gå˜æˆç°åœ¨çš„110Gã€‚è€Œå¤šå†™å…¥çš„10Gå¤§å°çš„æ•°æ®ï¼Œå¯¹åº”çš„æ˜¯test.logè¿™ä¸ªæ–‡ä»¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c0/46/c04dcff3aa4773302495113dd2a8d546.png?wh=1704*472\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å›åˆ°å®¿ä¸»æœºä¸Šï¼Œå¯ä»¥çœ‹åˆ°å®¿ä¸»æœºä¸Šçš„æ ¹ç›®å½•(/)é‡Œä½¿ç”¨çš„å¤§å°ä¹Ÿæ˜¯110Gäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/15/9d/155d30bc20b72c0678d1948f25cbe29d.png?wh=1220*366\" alt=\"\"></p><p>æˆ‘ä»¬è¿˜æ˜¯ç»§ç»­çœ‹å®¿ä¸»æœºï¼Œçœ‹çœ‹OverlayFSé‡Œupperdirç›®å½•ä¸­æœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡/proc/mountsè¿™ä¸ªè·¯å¾„ï¼Œæ‰¾åˆ°å®¹å™¨OverlayFSå¯¹åº”çš„lowerdirå’Œupperdirã€‚å› ä¸ºå†™å…¥çš„æ•°æ®éƒ½åœ¨upperdiré‡Œï¼Œæˆ‘ä»¬å°±åªè¦çœ‹upperdirå¯¹åº”çš„é‚£ä¸ªç›®å½•å°±è¡Œäº†ã€‚æœç„¶ï¼Œé‡Œé¢å­˜æ”¾ç€å®¹å™¨å†™å…¥çš„æ–‡ä»¶test.logï¼Œå®ƒçš„å¤§å°æ˜¯10GBã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/7d/4d32334dc0f1ba69881c686037f6577d.png?wh=1920*461\" alt=\"\"></p><p>é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»éªŒè¯äº†åœ¨å®¹å™¨ä¸­å¯¹äºOverlayFSä¸­å†™å…¥æ•°æ®ï¼Œ<strong>å…¶å®å°±æ˜¯å¾€å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•ï¼ˆupperdirï¼‰é‡Œå†™æ•°æ®ã€‚</strong>æˆ‘ä»¬ç°åœ¨å·²ç»å†™äº†10GBçš„æ•°æ®ï¼Œå¦‚æœç»§ç»­åœ¨å®¹å™¨ä¸­å†™å…¥æ•°æ®ï¼Œç»“æœä¼°è®¡ä½ ä¹ŸçŸ¥é“äº†ï¼Œå°±æ˜¯ä¼šå†™æ»¡å®¿ä¸»æœºçš„ç£ç›˜ã€‚</p><p>é‚£é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h2>çŸ¥è¯†è¯¦è§£</h2><p>å®¹å™¨å†™è‡ªå·±çš„OverlayFSæ ¹ç›®å½•ï¼Œç»“æœæŠŠå®¿ä¸»æœºçš„ç£ç›˜å†™æ»¡äº†ã€‚å‘ç”Ÿè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå°±ä¼šæƒ³åˆ°éœ€è¦å¯¹å®¹å™¨åšé™åˆ¶ï¼Œé™åˆ¶å®ƒå†™å…¥è‡ªå·±OverlayFSçš„æ•°æ®é‡ï¼Œæ¯”å¦‚åªå…è®¸ä¸€ä¸ªå®¹å™¨å†™100MBçš„æ•°æ®ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬å®é™…æŸ¥çœ‹OverlayFSæ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œå°±ä¼šå‘ç°æ²¡æœ‰ç›´æ¥é™åˆ¶æ–‡ä»¶å†™å…¥é‡çš„ç‰¹æ€§ã€‚åˆ«æ‹…å¿ƒï¼Œåœ¨æ²¡æœ‰ç°æˆå·¥å…·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªè¦ææ‡‚äº†åŸç†ï¼Œå°±èƒ½æƒ³å‡ºè§£å†³åŠæ³•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹OverlayFSï¼Œå®ƒæ˜¯é€šè¿‡lowerdirå’Œupperdirä¸¤å±‚ç›®å½•è”åˆæŒ‚è½½æ¥å®ç°çš„ï¼Œlowerdiræ˜¯åªè¯»çš„ï¼Œæ•°æ®åªä¼šå†™åœ¨upperdirä¸­ã€‚</p><p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡é™åˆ¶upperdirç›®å½•å®¹é‡çš„æ–¹å¼ï¼Œæ¥é™åˆ¶ä¸€ä¸ªå®¹å™¨OverlayFSæ ¹ç›®å½•çš„å†™å…¥æ•°æ®é‡å‘¢ï¼Ÿ</p><p>æ²¿ç€è¿™ä¸ªæ€è·¯ç»§ç»­å¾€ä¸‹æƒ³ï¼Œå› ä¸ºupperdiråœ¨å®¿ä¸»æœºä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„ç›®å½•ï¼Œè¿™æ ·å°±è¦çœ‹<strong>å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¯ä»¥æ”¯æŒå¯¹ä¸€ä¸ªç›®å½•é™åˆ¶å®¹é‡äº†ã€‚</strong></p><p>å¯¹äºLinuxä¸Šæœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–‡ä»¶ç³»ç»ŸXFSå’Œext4ï¼Œå®ƒä»¬æœ‰ä¸€ä¸ªç‰¹æ€§Quotaï¼Œé‚£æˆ‘ä»¬å°±ä»¥XFSæ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹ï¼Œå­¦ä¹ ä¸€ä¸‹è¿™ä¸ªQuotaæ¦‚å¿µï¼Œç„¶åçœ‹çœ‹è¿™ä¸ªç‰¹æ€§èƒ½ä¸èƒ½é™åˆ¶ä¸€ä¸ªç›®å½•çš„ä½¿ç”¨é‡ã€‚</p><h3>XFS  Quota</h3><p>åœ¨Linuxç³»ç»Ÿé‡Œçš„XFSæ–‡ä»¶ç³»ç»Ÿç¼ºçœéƒ½æœ‰Quotaçš„ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥ä¸ºLinuxç³»ç»Ÿé‡Œçš„ä¸€ä¸ªç”¨æˆ·ï¼ˆuserï¼‰ï¼Œä¸€ä¸ªç”¨æˆ·ç»„ï¼ˆgroupï¼‰æˆ–è€…ä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰æ¥é™åˆ¶å®ƒä»¬ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„é¢åº¦ï¼ˆquotaï¼‰ï¼Œä¹Ÿå°±æ˜¯é™åˆ¶å®ƒä»¬å¯ä»¥å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æ€»é‡ã€‚</p><p>å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦é™åˆ¶ä¸€ä¸ªç›®å½•ä¸­æ€»ä½“çš„å†™å…¥æ–‡ä»¶æ•°æ®é‡ï¼Œé‚£ä¹ˆæ˜¾ç„¶ç»™ç”¨æˆ·å’Œç”¨æˆ·ç»„é™åˆ¶æ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥æ•°æ®é‡çš„æ¨¡å¼ï¼Œå¹¶ä¸é€‚åˆæˆ‘ä»¬çš„è¿™ä¸ªéœ€æ±‚ã€‚</p><p>å› ä¸ºåŒä¸€ä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„å¯ä»¥æ“ä½œå¤šä¸ªç›®å½•ï¼Œå¤šä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„ä¹Ÿå¯ä»¥æ“ä½œåŒä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·å¯¹ä¸€ä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„çš„é™åˆ¶ï¼Œå°±å¾ˆéš¾ç”¨æ¥é™åˆ¶ä¸€ä¸ªç›®å½•ã€‚</p><p>é‚£æ’é™¤äº†é™åˆ¶ç”¨æˆ·æˆ–ç”¨æˆ·ç»„çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹Projectæ¨¡å¼ã€‚Projectæ¨¡å¼æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ä½ ä¼šæ›´å¥½ç†è§£ï¼Œå¯¹Linuxç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ä¸€è¾¹æ“ä½œï¼Œä¸€è¾¹ä½“ä¼šä¸€ä¸‹å®ƒçš„å·¥ä½œæ–¹å¼ã€‚ä¸ç†Ÿæ‚‰çš„åŒå­¦ä¹Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨æˆ‘åé¢çš„è®²è§£æ€è·¯ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦ä½¿ç”¨XFS Quotaç‰¹æ€§ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½çš„æ—¶å€™åŠ ä¸Šå¯¹åº”çš„Quotaé€‰é¡¹ï¼Œæ¯”å¦‚æˆ‘ä»¬ç›®å‰éœ€è¦é…ç½®Project Quotaï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‚è½½å‚æ•°å°±æ˜¯\"pquota\"ã€‚</p><p>å¯¹äºæ ¹ç›®å½•æ¥è¯´ï¼Œ<strong>è¿™ä¸ªå‚æ•°å¿…é¡»ä½œä¸ºä¸€ä¸ªå†…æ ¸å¯åŠ¨çš„å‚æ•°\"rootflags=pquota\"ï¼Œè¿™æ ·è®¾ç½®å°±å¯ä»¥ä¿è¯æ ¹ç›®å½•åœ¨å¯åŠ¨æŒ‚è½½çš„æ—¶å€™ï¼Œå¸¦ä¸ŠXFS Quotaçš„ç‰¹æ€§å¹¶ä¸”æ”¯æŒProjectæ¨¡å¼ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥ä»/proc/mountsä¿¡æ¯é‡Œï¼Œçœ‹çœ‹æ ¹ç›®å½•æ˜¯ä¸æ˜¯å¸¦\"prjquota\"å­—æ®µã€‚å¦‚æœé‡Œé¢æœ‰è¿™ä¸ªå­—æ®µï¼Œå°±å¯ä»¥ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿå·²ç»å¸¦ä¸Šäº†æ”¯æŒprojectæ¨¡å¼çš„XFS quotaç‰¹æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/72/3d/72d653f67717fe047c98fce37156da3d.png?wh=1230*112\" alt=\"\"></p><p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»™ä¸€ä¸ªæŒ‡å®šçš„ç›®å½•æ‰“ä¸Šä¸€ä¸ªProject IDã€‚è¿™ä¸ªæ­¥éª¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨XFSæ–‡ä»¶ç³»ç»Ÿè‡ªå¸¦çš„å·¥å…· <a href=\"https://linux.die.net/man/8/xfs_quota\">xfs_quota</a> æ¥å®Œæˆï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ã€‚</p><p>æ‰§è¡Œå‘½ä»¤ä¹‹å‰ï¼Œæˆ‘å…ˆå¯¹ä¸‹é¢çš„å‘½ä»¤å’Œè¾“å‡ºåšä¸¤ç‚¹è§£é‡Šï¼Œè®©ä½ ç†è§£è¿™ä¸ªå‘½ä»¤çš„å«ä¹‰ã€‚</p><p>ç¬¬ä¸€ç‚¹ï¼Œæ–°å»ºçš„ç›®å½•/tmp/xfs_prjquotaï¼Œæˆ‘ä»¬æƒ³å¯¹å®ƒåšQuotaé™åˆ¶ã€‚æ‰€ä»¥åœ¨è¿™é‡Œè¦å¯¹å®ƒæ‰“ä¸Šä¸€ä¸ªProject IDã€‚</p><p>ç¬¬äºŒç‚¹ï¼Œé€šè¿‡xfs_quotaè¿™æ¡å‘½ä»¤ï¼Œæˆ‘ä»¬ç»™/tmp/xfs_prjquotaæ‰“ä¸ŠProject IDå€¼101ï¼Œè¿™ä¸ª101æ˜¯æˆ‘éšä¾¿é€‰çš„ä¸€ä¸ªæ•°å­—ï¼Œå°±æ˜¯ä¸ªIDæ ‡è¯†ï¼Œä½ å…ˆæœ‰ä¸ªå°è±¡ã€‚åœ¨åé¢é’ˆå¯¹Projectè¿›è¡ŒQuotaé™åˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ä¼šç”¨åˆ°è¿™ä¸ªIDã€‚</p><pre><code class=\"language-shell\"># mkdir -p  /tmp/xfs_prjquota\n# xfs_quota -x -c 'project -s -p /tmp/xfs_prjquota 101' /\nSetting up project 101 (path /tmp/xfs_prjquota)...\nProcessed 1 (/etc/projects and cmdline) paths for project 101 with recursion depth infinite (-1).\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨xfs_quotaå‘½ä»¤ï¼Œå¯¹101ï¼ˆæˆ‘ä»¬åˆšæ‰å»ºç«‹çš„è¿™ä¸ªProject IDï¼‰åšQuotaé™åˆ¶ã€‚</p><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œé‡Œé¢çš„\"-p bhard=10m 101\"å°±ä»£è¡¨é™åˆ¶101è¿™ä¸ªproject IDï¼Œé™åˆ¶å®ƒçš„æ•°æ®å—å†™å…¥é‡ä¸èƒ½è¶…è¿‡10MBã€‚</p><pre><code># xfs_quota -x -c 'limit -p bhard=10m 101' /\n</code></pre><p>åšå¥½é™åˆ¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¾€/tmp/xfs_prjquotaå†™æ•°æ®ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥è¶…è¿‡10MBã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å°è¯•å†™å…¥20MBçš„æ•°æ®åˆ°/tmp/xfs_prjquotaé‡Œã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œddå†™å…¥å‘½ä»¤ï¼Œå°±ä¼šæœ‰ä¸ªå‡ºé”™è¿”å›ä¿¡æ¯\"No space left on device\"ã€‚è¿™è¡¨ç¤ºå·²ç»ä¸èƒ½å†å¾€è¿™ä¸ªç›®å½•ä¸‹å†™å…¥æ•°æ®äº†ï¼Œè€Œæœ€åå†™å…¥æ•°æ®çš„æ–‡ä»¶test.fileå¤§å°ä¹Ÿåœç•™åœ¨äº†10MBã€‚</p><pre><code class=\"language-shell\"># dd if=/dev/zero of=/tmp/xfs_prjquota/test.file bs=1024 count=20000\ndd: error writing '/tmp/xfs_prjquota/test.file': No space left on device\n10241+0 records in\n10240+0 records out\n10485760 bytes (10 MB, 10 MiB) copied, 0.0357122 s, 294 MB/s\n\n# ls -l /tmp/xfs_prjquota/test.file\n-rw-r--r-- 1 root root 10485760 Oct 31 10:00 /tmp/xfs_prjquota/test.file\n</code></pre><p>å¥½äº†ï¼Œåšåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨XFS Quotaçš„Projectæ¨¡å¼ï¼Œç¡®å®å¯ä»¥é™åˆ¶ä¸€ä¸ªç›®å½•é‡Œçš„å†™å…¥æ•°æ®é‡ï¼Œå®ƒå®ç°çš„æ–¹å¼å…¶å®ä¹Ÿä¸éš¾ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸¤æ­¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œç»™ç›®æ ‡ç›®å½•æ‰“ä¸Šä¸€ä¸ªProject IDï¼Œè¿™ä¸ªIDæœ€ç»ˆæ˜¯å†™åˆ°ç›®å½•å¯¹åº”çš„inodeä¸Šã€‚</p><p>è¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹ï¼Œinodeæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­ç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€ä¸ªç›®å½•çš„å…ƒæ•°æ®ï¼Œé‡Œé¢åŒ…å«æ–‡ä»¶å¤§å°ï¼Œæ•°æ®å—çš„ä½ç½®ï¼Œæ–‡ä»¶æ‰€å±ç”¨æˆ·/ç»„ï¼Œæ–‡ä»¶è¯»å†™å±æ€§ä»¥åŠå…¶ä»–ä¸€äº›å±æ€§ã€‚</p><p>é‚£ä¹ˆä¸€æ—¦ç›®å½•æ‰“ä¸Šè¿™ä¸ªIDä¹‹åï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹çš„æ–°å»ºçš„æ–‡ä»¶å’Œç›®å½•ä¹Ÿéƒ½ä¼šç»§æ‰¿è¿™ä¸ªIDã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œåœ¨XFSæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»™è¿™ä¸ªproject IDè®¾ç½®ä¸€ä¸ªå†™å…¥æ•°æ®å—çš„é™åˆ¶ã€‚</p><p>æœ‰äº†IDå’Œé™åˆ¶å€¼ä¹‹åï¼Œæ–‡ä»¶ç³»ç»Ÿå°±å¯ä»¥ç»Ÿè®¡æ‰€æœ‰å¸¦è¿™ä¸ªIDæ–‡ä»¶çš„æ•°æ®å—å¤§å°æ€»å’Œï¼Œå¹¶ä¸”ä¸é™åˆ¶å€¼è¿›è¡Œæ¯”è¾ƒã€‚ä¸€æ—¦æ‰€æœ‰æ–‡ä»¶å¤§å°çš„æ€»å’Œè¾¾åˆ°é™åˆ¶å€¼ï¼Œæ–‡ä»¶ç³»ç»Ÿå°±ä¸å†å…è®¸æ›´å¤šçš„æ•°æ®å†™å…¥äº†ã€‚</p><p>ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼ŒXFS Quotaå°±æ˜¯é€šè¿‡å‰é¢è¿™ä¸¤æ­¥é™åˆ¶äº†ä¸€ä¸ªç›®å½•é‡Œå†™å…¥çš„æ•°æ®é‡ã€‚</p><h2>è§£å†³é—®é¢˜</h2><p>æˆ‘ä»¬ç†è§£äº†XFS Quotaå¯¹ç›®å½•é™æµçš„æœºåˆ¶ä¹‹åï¼Œå†å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå¦‚ä½•ç¡®ä¿å®¹å™¨ä¸ä¼šå†™æ»¡å®¿ä¸»æœºä¸Šçš„ç£ç›˜ã€‚</p><p>ä½ åº”è¯¥å·²ç»æƒ³åˆ°äº†ï¼Œæ–¹æ³•å°±æ˜¯<strong>å¯¹OverlayFSçš„upperdirç›®å½•åšXFS Quotaçš„é™æµ</strong>ï¼Œæ²¡é”™ï¼Œå°±æ˜¯è¿™ä¸ªè§£å†³åŠæ³•ï¼</p><p>å…¶å®Dockerä¹Ÿå·²ç»å®ç°äº†é™æµåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ç”¨XFS Quotaæ¥é™åˆ¶å®¹å™¨çš„OverlayFSå¤§å°ã€‚</p><p>æˆ‘ä»¬åœ¨ç”¨ <code>docker run</code> å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼ŒåŠ ä¸Šä¸€ä¸ªå‚æ•° <code>--storage-opt size= &lt;SIZE&gt;</code> ï¼Œå°±èƒ½é™åˆ¶ä½å®¹å™¨OverlayFSæ–‡ä»¶ç³»ç»Ÿå¯å†™å…¥çš„æœ€å¤§æ•°æ®é‡äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸€èµ·è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬é™åˆ¶çš„sizeæ˜¯10MBã€‚</p><p>è¿›å…¥å®¹å™¨ä¹‹åï¼Œå…ˆè¿è¡Œ <code>df -h</code> å‘½ä»¤ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•(/)overlayfsæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å°±10MBï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„160GBçš„å¤§å°äº†ã€‚è¿™æ ·å®¹å™¨åœ¨å®ƒçš„æ ¹ç›®å½•ä¸‹ï¼Œæœ€å¤šåªèƒ½å†™10MBæ•°æ®ï¼Œå°±ä¸ä¼šæŠŠå®¿ä¸»æœºçš„ç£ç›˜ç»™å†™æ»¡äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/8a/a7906f56d9d107f0a290e610b8cd6f8a.png?wh=1194*210\" alt=\"\"></p><p>å®Œæˆäº†ä¸Šé¢è¿™ä¸ªå°è¯•éªŒä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€ä¸‹Dockerçš„ä»£ç ï¼Œçœ‹çœ‹å®ƒçš„å®ç°æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ã€‚</p><p>Dockeré‡Œ<a href=\"https://github.com/moby/moby/blob/19.03/daemon/graphdriver/quota/projectquota.go#L155\">SetQuota()</a>å‡½æ•°å°±æ˜¯ç”¨æ¥å®ç°XFS Quota é™åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒé‡Œé¢æœ€é‡è¦çš„ä¸¤æ­¥ï¼Œåˆ†åˆ«æ˜¯ <code>setProjectID</code> å’Œ <code>setProjectQuota</code> ã€‚</p><p>å…¶å®ï¼Œè¿™ä¸¤æ­¥åšçš„å°±æ˜¯æˆ‘ä»¬åœ¨åŸºæœ¬æ¦‚å¿µä¸­æåˆ°çš„é‚£ä¸¤æ­¥ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œç»™ç›®æ ‡ç›®å½•æ‰“ä¸Šä¸€ä¸ªProject IDï¼›ç¬¬äºŒæ­¥ï¼Œä¸ºè¿™ä¸ªProject IDåœ¨XFSæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè®¾ç½®ä¸€ä¸ªå†™å…¥æ•°æ®å—çš„é™åˆ¶ã€‚</p><pre><code class=\"language-shell\">// SetQuota - assign a unique project id to directory and set the quota limits\n// for that project id\n\nfunc (q *Control) SetQuota(targetPath string, quota Quota) error {\n        q.RLock()\n        projectID, ok := q.quotas[targetPath]\n        q.RUnlock()\n\n        if !ok {\n                q.Lock()\n                projectID = q.nextProjectID\n\n                //\n                // assign project id to new container directory\n                //\n\n                err := setProjectID(targetPath, projectID)\n                if err != nil {\n                        q.Unlock()\n                        return err\n                }\n\n                q.quotas[targetPath] = projectID\n                q.nextProjectID++\n                q.Unlock()\n        }\n\n \n\n        //\n        // set the quota limit for the container's project id\n        //\n\n        logrus.Debugf(\"SetQuota(%s, %d): projectID=%d\", targetPath, quota.Size, projectID)\n        return setProjectQuota(q.backingFsBlockDev, projectID, quota)\n}\n</code></pre><p>é‚£ <code>setProjectID</code> å’Œ  <code>setProjectQuota</code> æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥è¿›å…¥åˆ°è¿™ä¸¤ä¸ªå‡½æ•°é‡Œçœ‹ä¸€ä¸‹ï¼Œ<strong>å®ƒä»¬åˆ†åˆ«è°ƒç”¨äº†ioctl()å’Œquotactl()è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ¥ä¿®æ”¹å†…æ ¸ä¸­XFSçš„æ•°æ®ç»“æ„ï¼Œä»è€Œå®Œæˆproject IDçš„è®¾ç½®å’ŒQuotaå€¼çš„è®¾ç½®ã€‚</strong>å…·ä½“çš„ç»†èŠ‚ï¼Œæˆ‘ä¸åœ¨è¿™é‡Œå±•å¼€äº†ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥ç»§ç»­å»æŸ¥çœ‹å†…æ ¸ä¸­å¯¹åº”çš„ä»£ç ã€‚</p><p>å¥½äº†ï¼ŒDockeré‡ŒXFS Quotaæ“ä½œçš„æ­¥éª¤å®Œå…¨å’Œæˆ‘ä»¬å…ˆå‰è®¾æƒ³çš„ä¸€æ ·ï¼Œé‚£ä¹ˆè¿˜æœ‰æœ€åä¸€ä¸ªé—®é¢˜è¦è§£å†³ï¼ŒXFS Quotaé™åˆ¶çš„ç›®å½•æ˜¯å“ªä¸€ä¸ªï¼Ÿ</p><p>è¿™ä¸ªæˆ‘ä»¬å¯ä»¥æ ¹æ®/proc/mountsä¸­å®¹å™¨çš„OverlayFS Mountä¿¡æ¯ï¼Œå†ç»“åˆDockerçš„<a href=\"https://github.com/moby/moby/blob/19.03/daemon/graphdriver/overlay2/overlay.go#L335\">ä»£ç </a>ï¼Œå°±å¯ä»¥çŸ¥é“é™åˆ¶çš„ç›®å½•æ˜¯\"/var/lib/docker/overlay2/&lt;docker_id&gt;\"ã€‚é‚£è¿™ä¸ªç›®å½•ä¸‹æœ‰ä»€ä¹ˆå‘¢ï¼Ÿæœç„¶upperdirç›®å½•ä¸­æœ‰å¯¹åº”çš„\"diff\"ç›®å½•ï¼Œå°±åœ¨é‡Œé¢ï¼</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/9f/4d4d995f052c9a8e3ff3e413c0e1199f.png?wh=1920*646\" alt=\"\"></p><p>è®²åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ä½ å·²ç»æ¸…æ¥šäº†å¯¹äºä½¿ç”¨OverlayFSçš„å®¹å™¨ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å»é˜²æ­¢å®ƒæŠŠå®¿ä¸»æœºçš„ç£ç›˜ç»™å†™æ»¡äº†å§ï¼Ÿ<strong>æ–¹æ³•å°±æ˜¯å¯¹OverlayFSçš„upperdirç›®å½•åšXFS Quotaçš„é™æµã€‚</strong></p><h2>é‡ç‚¹æ€»ç»“</h2><p>æˆ‘ä»¬è¿™ä¸€è®²çš„é—®é¢˜æ˜¯ï¼Œå®¹å™¨å†™äº†å¤§é‡æ•°æ®åˆ°OverlayFSæ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå°±ä¼šæŠŠå®¿ä¸»æœºçš„ç£ç›˜å†™æ»¡ã€‚</p><p>ç”±äºOverlayFSè‡ªå·±æ²¡æœ‰ä¸“é—¨çš„ç‰¹æ€§ï¼Œå¯ä»¥é™åˆ¶æ–‡ä»¶æ•°æ®å†™å…¥é‡ã€‚è¿™æ—¶æˆ‘ä»¬é€šè¿‡å®é™…è¯•éªŒæ‰¾åˆ°äº†è§£å†³æ€è·¯ï¼šä¾é åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„Quotaç‰¹æ€§æ¥é™åˆ¶OverlayFSçš„upperdirç›®å½•çš„å¤§å°ï¼Œè¿™æ ·å°±èƒ½å®ç°é™åˆ¶å®¹å™¨å†™ç£ç›˜çš„ç›®çš„ã€‚</p><p>åº•å±‚æ–‡ä»¶ç³»ç»ŸXFS Quotaçš„Projectæ¨¡å¼ï¼Œèƒ½å¤Ÿé™åˆ¶ä¸€ä¸ªç›®å½•çš„æ–‡ä»¶å†™å…¥é‡ï¼Œè¿™ä¸ªåŠŸèƒ½å…·ä½“æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªæ­¥éª¤å®ç°ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œç»™ç›®æ ‡ç›®å½•æ‰“ä¸Šä¸€ä¸ªProject IDã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œç»™è¿™ä¸ªProject IDåœ¨XFSæ–‡ä»¶ç³»ç»Ÿä¸­è®¾ç½®ä¸€ä¸ªå†™å…¥æ•°æ®å—çš„é™åˆ¶ã€‚</p><p>Dockeræ­£æ˜¯ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<strong>ç”¨XFS Quotaæ¥é™åˆ¶OverlayFSçš„upperdirç›®å½•</strong>ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼æ§åˆ¶å®¹å™¨OverlayFSçš„æ ¹ç›®å½•å¤§å°ã€‚</p><p>å½“æˆ‘ä»¬ç†è§£äº†è¿™ä¸ªæ–¹æ³•åï¼Œå¯¹äºä¸æ˜¯ç”¨Dockerå¯åŠ¨çš„å®¹å™¨ï¼Œæ¯”å¦‚ç›´æ¥ç”±containerdå¯åŠ¨èµ·æ¥çš„å®¹å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°XFS Quotaé™åˆ¶upperdirç›®å½•ã€‚è¿™æ ·å°±èƒ½æœ‰æ•ˆæ§åˆ¶å®¹å™¨å¯¹OverlayFSçš„å†™æ•°æ®æ“ä½œï¼Œé¿å…å®¿ä¸»æœºçš„ç£ç›˜è¢«å†™æ»¡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨æ­£æ–‡çŸ¥è¯†è¯¦è§£çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨\"xfs_quota\"ç»™ç›®å½•æ‰“äº†project IDå¹¶ä¸”é™åˆ¶äº†æ–‡ä»¶å†™å…¥çš„æ•°æ®é‡ã€‚é‚£åœ¨åšå®Œè¿™æ ·çš„é™åˆ¶ä¹‹åï¼Œæˆ‘ä»¬æ˜¯å¦èƒ½ç”¨xfs_quotaå‘½ä»¤ï¼ŒæŸ¥è¯¢åˆ°è¢«é™åˆ¶ç›®å½•çš„project IDå’Œé™åˆ¶çš„æ•°æ®é‡å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒæˆ–ç–‘é—®ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œä¸€èµ·äº¤æµå’Œå­¦ä¹ ã€‚</p>","comments":[{"had_liked":false,"id":267338,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1607684658,"is_pvip":false,"replies":[{"id":"97152","content":"@è«åï¼Œ<br>çš„ç¡®ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨çš„æ˜¯xfs, å¯¹äºext4 quotaçš„åŠŸèƒ½æ²¡æœ‰æµ‹è¯•è¿‡ã€‚<br>ä¸è¿‡æˆ‘ä¹‹å‰æœç´¢è¿‡ï¼Œ ext4åœ¨2016å¹´å°±åº”è¯¥æ”¯æŒproject quotaäº†ã€‚æˆ‘ä»¬å¯ä»¥ä¸€èµ·å†ç¡®è®¤ä¸€ä¸‹ã€‚<br><br><br>```<br>commit 689c958cbe6be4f211b40747951a3ba2c73b6715<br>Author: Li Xi &lt;pkuelelixi@gmail.com&gt;<br>Date:   Fri Jan 8 16:01:22 2016 -0500<br><br>    ext4: add project quota support<br><br>    This patch adds mount options for enabling&#47;disabling project quota<br>    accounting and enforcement. A new specific inode is also used for<br>    project quota accounting.<br><br>    [ Includes fix from Dan Carpenter to crrect error checking from dqget(). ]<br><br>    Signed-off-by: Li Xi &lt;lixi@ddn.com&gt;<br>    Signed-off-by: Dmitry Monakhov &lt;dmonakhov@openvz.org&gt;<br>    Signed-off-by: Theodore Ts&#39;o &lt;tytso@mit.edu&gt;<br>    Reviewed-by: Andreas Dilger &lt;adilger@dilger.ca&gt;<br>    Reviewed-by: Jan Kara &lt;jack@suse.cz&gt;","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607788450,"ip_address":"","comment_id":267338,"utype":1}],"discussion_count":3,"race_medal":0,"score":"83212063282","product_id":100063801,"comment_content":"å®¹å™¨ quota çš„å±€é™æ€§ï¼šå®¹å™¨é€šå¸¸é‡‡ç”¨ overlay2 driverï¼Œä»…æ”¯æŒåœ¨å®¿ä¸»æ–‡ä»¶ç³»ç»Ÿ xfs ä¸Šå¼€å¯ quota åŠŸèƒ½ã€‚æ„å‘³ç€ overlay over ext4 ä¸æ”¯æŒ quota åŠŸèƒ½ï¼Œè€Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸Š ext4 çš„ä½¿ç”¨è¿œå¤šäº xfsã€‚","like_count":20,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511601,"discussion_content":"@è«åï¼Œ\nçš„ç¡®ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨çš„æ˜¯xfs, å¯¹äºext4 quotaçš„åŠŸèƒ½æ²¡æœ‰æµ‹è¯•è¿‡ã€‚\nä¸è¿‡æˆ‘ä¹‹å‰æœç´¢è¿‡ï¼Œ ext4åœ¨2016å¹´å°±åº”è¯¥æ”¯æŒproject quotaäº†ã€‚æˆ‘ä»¬å¯ä»¥ä¸€èµ·å†ç¡®è®¤ä¸€ä¸‹ã€‚\n\n\n```\ncommit 689c958cbe6be4f211b40747951a3ba2c73b6715\nAuthor: Li Xi &amp;lt;pkuelelixi@gmail.com&amp;gt;\nDate:   Fri Jan 8 16:01:22 2016 -0500\n\n    ext4: add project quota support\n\n    This patch adds mount options for enabling/disabling project quota\n    accounting and enforcement. A new specific inode is also used for\n    project quota accounting.\n\n    [ Includes fix from Dan Carpenter to crrect error checking from dqget(). ]\n\n    Signed-off-by: Li Xi &amp;lt;lixi@ddn.com&amp;gt;\n    Signed-off-by: Dmitry Monakhov &amp;lt;dmonakhov@openvz.org&amp;gt;\n    Signed-off-by: Theodore Ts&amp;#39;o &amp;lt;tytso@mit.edu&amp;gt;\n    Reviewed-by: Andreas Dilger &amp;lt;adilger@dilger.ca&amp;gt;\n    Reviewed-by: Jan Kara &amp;lt;jack@suse.cz&amp;gt;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607788450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"è«å","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334483,"discussion_content":"æ˜¯çš„ï¼Œext4 è‡ªèº«æ”¯æŒ project quota åŠŸèƒ½ï¼ˆLinux 4.5 ç‰ˆæœ¬ä¹‹åï¼‰ã€‚ä½†æ˜¯ï¼Œoverlay2 over ext4 ä¸æ”¯æŒ project quota åŠŸèƒ½ã€‚\n\nè€å¸ˆå¯ä»¥å°è¯•ä¸‹ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š\n\ndocker: Error response from daemon: --storage-opt is supported only for overlay over xfs with &#39;pquota&#39; mount option.\n\nå®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰æåˆ°ï¼šhttps://docs.docker.com/engine/reference/commandline/run/#set-storage-driver-options-per-container\n\nFor the overlay2 storage driver, the size option is only available if the backing fs is xfs and mounted with the pquota mount option. \n\n","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1607862958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"è«å","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334484,"discussion_content":"å½“ç„¶ï¼Œå¯ä»¥æ‰‹å·¥åœ¨ /var/lib/docker/overlay2/<container id>/ ç›®å½•ï¼ˆå‡è®¾è¯¥ç›®å½•æ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿä¸º ext4 ä¸”å·²è®¾ç½® prjquota é€‰é¡¹ï¼‰è®¾ç½® project quotaã€‚è¿™æ ·å°±å¤±å»äº†çµæ´»æ€§ï¼Œä¸èƒ½ä½¿ç”¨ --storage-opt size=xxx é€‰é¡¹çš„æ–¹å¼è¿›è¡Œè®¾ç½®ã€‚","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1607864038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267245,"user_name":"Geek2014","can_delete":false,"product_type":"c1","uid":2028957,"ip_address":"","ucode":"9EB356D8DF287E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","comment_is_top":false,"comment_ctime":1607658464,"is_pvip":false,"replies":[{"id":"97151","content":"@Geek2014<br>å¯¹çš„ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨containerdå¿«ä¸¤å¹´äº†ã€‚<br>è¿™æ˜¯ä¹‹å‰æˆ‘ä»¬ç»„åšçš„åˆ†äº«ï¼š<br>https:&#47;&#47;www.infoq.cn&#47;article&#47;odslclsjvo8bnx*mbrbk","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607786964,"ip_address":"","comment_id":267245,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53147266016","product_id":100063801,"comment_content":"ä¸Šç¯‡çš„è¯„è®ºä¸­æåˆ°ï¼šâ€œæˆ‘ä»¬åœ¨2019å¹´åˆå°±ä¸ç”¨dockeräº†ã€‚â€<br>è¿™ç¯‡ä¸­ï¼Œè€å¸ˆæåˆ°äº†containerdï¼Œæ˜¯è¯´ä½ ä»¬å·²ç»ç”¨containerdæ›¿æ¢äº†dockerå—ï¼Ÿæœ‰æœºä¼šå¯¹containerdå’Œdockerä¹‹é—´çš„ä½¿ç”¨å¯¹æ¯”åšä¸ªä»‹ç»å—ï¼Ÿ","like_count":13,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511562,"discussion_content":"@Geek2014\nå¯¹çš„ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨containerdå¿«ä¸¤å¹´äº†ã€‚\nè¿™æ˜¯ä¹‹å‰æˆ‘ä»¬ç»„åšçš„åˆ†äº«ï¼š\nhttps://www.infoq.cn/article/odslclsjvo8bnx*mbrbk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607786964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028957,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","nickname":"Geek2014","note":"","ucode":"9EB356D8DF287E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334939,"discussion_content":"å¤šè°¢è€å¸ˆåˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608032280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269287,"user_name":"Sun","can_delete":false,"product_type":"c1","uid":1013638,"ip_address":"","ucode":"092D74311B8651","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/86/4ff2a872.jpg","comment_is_top":false,"comment_ctime":1608602296,"is_pvip":false,"replies":[{"id":"97762","content":"@Sun, è°¢è°¢ï¼Œå¾ˆå¥½çš„è¡¥å……ã€‚<br>k8s é€šè¿‡duæ¥æ£€æŸ¥ephemeral-storageç›¸å…³volume&#47;ç›®å½•çš„å¤§å°ï¼Œç„¶åå¦‚æœè¶…å‡ºlimitå°±evict podã€‚<br>duçš„å¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼Œevict podæ¯”è¾ƒé€‚åˆstateless podã€‚ä¸è¿‡æœ€æ–°çš„k8såº”è¯¥åœ¨ç”¨filesystem quotaæ¥é™åˆ¶emptyDirçš„å¤§å°äº†ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1608719858,"ip_address":"","comment_id":269287,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44558275256","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæˆ‘è§‰å¾—å¯ä»¥è¡¥å……ä¸‹ ç°åœ¨k8s 1.14 å¼€å§‹ï¼Œé»˜è®¤å¼€å¯ LocalStorageCapacityIsolationï¼Œ å¯ä»¥é€šè¿‡é™åˆ¶resources.limits.ephemeral-storage å’Œresources.requests.ephemeral-storage æ¥ä¿æŠ¤å®¿ä¸»æœº rootfsäº†ã€‚","like_count":11,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512218,"discussion_content":"@Sun, è°¢è°¢ï¼Œå¾ˆå¥½çš„è¡¥å……ã€‚\nk8s é€šè¿‡duæ¥æ£€æŸ¥ephemeral-storageç›¸å…³volume/ç›®å½•çš„å¤§å°ï¼Œç„¶åå¦‚æœè¶…å‡ºlimitå°±evict podã€‚\nduçš„å¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼Œevict podæ¯”è¾ƒé€‚åˆstateless podã€‚ä¸è¿‡æœ€æ–°çš„k8såº”è¯¥åœ¨ç”¨filesystem quotaæ¥é™åˆ¶emptyDirçš„å¤§å°äº†ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608719858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580926,"avatar":"","nickname":"ch_ort","note":"","ucode":"B79746E687F29E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575806,"discussion_content":"å¦‚æœ containerçš„ stdoutçš„æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œæ˜¯å¦æœ‰åŠæ³•é™åˆ¶ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655117259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267343,"user_name":"è°¢å“ˆå“ˆ","can_delete":false,"product_type":"c1","uid":2326880,"ip_address":"","ucode":"5AADE70B5AFE27","user_header":"https://static001.geekbang.org/account/avatar/00/23/81/60/71ed6ac7.jpg","comment_is_top":false,"comment_ctime":1607686868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18787556052","product_id":100063801,"comment_content":"å¯ä»¥é€šè¿‡xfs_quota -x -c &quot;report -pbih &quot; ç›®å½•åç§°æŸ¥è¯¢projectid","like_count":5},{"had_liked":false,"id":302351,"user_name":"å¾å°‘æ–‡","can_delete":false,"product_type":"c1","uid":1670331,"ip_address":"","ucode":"8E35B10DA44EE3","user_header":"https://static001.geekbang.org/account/avatar/00/19/7c/bb/635a2710.jpg","comment_is_top":false,"comment_ctime":1626176102,"is_pvip":false,"replies":[{"id":"111137","content":"cgroupé‡Œæ²¡æœ‰å¯¹ç£ç›˜å®¹é‡ä½¿ç”¨é™åˆ¶çš„æ¨¡å—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1628773902,"ip_address":"","comment_id":302351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14511077990","product_id":100063801,"comment_content":"è€å¸ˆï¼ŒCGroupå­ç³»ç»Ÿä¸­æ²¡æœ‰å¯¹ç¡¬ç›˜ä½¿ç”¨é‡è¿›è¡Œé™åˆ¶çš„åŠŸèƒ½æ¨¡å—å—ï¼Ÿé™¤äº†é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„quotaå»é™åˆ¶è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523268,"discussion_content":"cgroupé‡Œæ²¡æœ‰å¯¹ç£ç›˜å®¹é‡ä½¿ç”¨é™åˆ¶çš„æ¨¡å—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628773902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267635,"user_name":"Helios","can_delete":false,"product_type":"c1","uid":1380758,"ip_address":"","ucode":"BE6B98EE8F0D09","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132","comment_is_top":false,"comment_ctime":1607850971,"is_pvip":false,"replies":[{"id":"97301","content":"å¦‚æœç”¨æˆ·éœ€è¦ä½¿ç”¨å¤§å®¹é‡çš„ç£ç›˜ç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨volume.<br>Quotaä¸»è¦æ¥é™åˆ¶å®¹å™¨çš„rootfs, è¿™ä¸ªrootfsä¸€èˆ¬æ˜¯åœ¨hostçš„ç£ç›˜ä¼šå’Œåˆ«çš„å®¹å™¨å…±äº«ï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒåšé™åˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1608015323,"ip_address":"","comment_id":267635,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10197785563","product_id":100063801,"comment_content":"è€å¸ˆèƒ½è¯´ä¸‹ä½ ä»¬åº”ç”¨å®¹å™¨Quotaçš„åœºæ™¯ä¹ˆã€‚å¯¹äºæ— çŠ¶æ€æœåŠ¡ä¸€èˆ¬å°±æ˜¯æ—¥å¿—ä¼šå†™æ–‡ä»¶äº†ï¼Œç¦»çº¿ä»»åŠ¡æ¯”å¦‚æœºå™¨å­¦ä¹ çš„æ¨¡å‹ä¹Ÿä¸æ•¢ç»™äººå®¶é™åˆ¶å‘€ğŸ˜‚<br>","like_count":3,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511699,"discussion_content":"å¦‚æœç”¨æˆ·éœ€è¦ä½¿ç”¨å¤§å®¹é‡çš„ç£ç›˜ç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨volume.\nQuotaä¸»è¦æ¥é™åˆ¶å®¹å™¨çš„rootfs, è¿™ä¸ªrootfsä¸€èˆ¬æ˜¯åœ¨hostçš„ç£ç›˜ä¼šå’Œåˆ«çš„å®¹å™¨å…±äº«ï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒåšé™åˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608015323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534638,"discussion_content":"volume, k8s emptyDirç­‰ç­‰éƒ½æ˜¯å±äºvolume, volumeä¸€èˆ¬å¯ä»¥è¯»å†™ï¼Œrootfs å¯ä»¥é€šè¿‡k8s PSPé™åˆ¶rootfsçš„å†™å…¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638247008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268175,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1608090409,"is_pvip":false,"replies":[{"id":"98270","content":"çœ‹moby(docker)ä»£ç é‡Œï¼Œdockerè‡ªå·±å¯¹è¿™ä¸ªç›®å½•è‡ªå·±åšäº†ä¸€ä¸ªéšæœºæ•°çš„ç”Ÿæˆï¼Œå…·ä½“åŸå› ä¸æ¸…æ¥šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1609311873,"ip_address":"","comment_id":268175,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5903057705","product_id":100063801,"comment_content":"è€å¸ˆ ä¸ºä»€ä¹ˆoverlayFS å¹¶ä¸æ˜¯docker_id å‘¢ï¼Ÿ<br>[root@localhost overlay2]# docker inspect 5440662c8db<br>[<br>    {<br>        &quot;Id&quot;: &quot;5440662c8db65d5d9ab522e0be1a3911584c492527fcde334c3fdec090cd3857&quot;,<br><br>        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,<br>  <br>        &quot;GraphDriver&quot;: {<br>            &quot;Data&quot;: {<br>                &quot;LowerDir&quot;: &quot;&#47;home&#47;data&#47;docker&#47;overlay2&#47;4146b7c314a97b46695a59ccdc323709eda7177b3e91ed30d3f4f9326a061584-init&#47;diff:&#47;home&#47;data&#47;docker&#47;overlay2&#47;dc1e8c89044058319c4e0b6917603f3ed8972cd155bfced0c7c0c2509ddaae14&#47;diff&quot;,<br>                &quot;MergedDir&quot;: &quot;&#47;home&#47;data&#47;docker&#47;overlay2&#47;4146b7c314a97b46695a59ccdc323709eda7177b3e91ed30d3f4f9326a061584&#47;merged&quot;,<br>                &quot;UpperDir&quot;: &quot;&#47;home&#47;data&#47;docker&#47;overlay2&#47;4146b7c314a97b46695a59ccdc323709eda7177b3e91ed30d3f4f9326a061584&#47;diff&quot;,<br>                &quot;WorkDir&quot;: &quot;&#47;home&#47;data&#47;docker&#47;overlay2&#47;4146b7c314a97b46695a59ccdc323709eda7177b3e91ed30d3f4f9326a061584&#47;work&quot;<br>            },<br>            &quot;Name&quot;: &quot;overlay2&quot;<br>        },<br><br>    }<br>]<br>","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511868,"discussion_content":"çœ‹moby(docker)ä»£ç é‡Œï¼Œdockerè‡ªå·±å¯¹è¿™ä¸ªç›®å½•è‡ªå·±åšäº†ä¸€ä¸ªéšæœºæ•°çš„ç”Ÿæˆï¼Œå…·ä½“åŸå› ä¸æ¸…æ¥šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609311873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267205,"user_name":"å®ä»”","can_delete":false,"product_type":"c1","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1607650735,"is_pvip":true,"replies":[{"id":"97153","content":"æˆ‘æ²¡æœ‰åœ¨ext4ä¸Šæµ‹è¯•è¿‡ï¼Œä¸è¿‡é€šè¿‡å†…æ ¸ä¿¡æ¯ï¼Œè¿˜æœ‰ç½‘ä¸Šåˆ«äººçš„å°è¯•ï¼Œext4åº”è¯¥ä¹Ÿæ˜¯æ”¯æŒï¼ˆprojectï¼‰quotaçš„ã€‚<br><br>https:&#47;&#47;discuss.linuxcontainers.org&#47;t&#47;how-do-i-set-up-the-project-quota-needed-for-limiting-container-storage-size-for-the-dir-backend-on-ubuntu-18-04&#47;7311<br><br>```<br>commit 689c958cbe6be4f211b40747951a3ba2c73b6715<br>Author: Li Xi &lt;pkuelelixi@gmail.com&gt;<br>Date:   Fri Jan 8 16:01:22 2016 -0500<br><br>    ext4: add project quota support<br><br>    This patch adds mount options for enabling&#47;disabling project quota<br>    accounting and enforcement. A new specific inode is also used for<br>    project quota accounting.<br><br>    [ Includes fix from Dan Carpenter to crrect error checking from dqget(). ]<br><br>    Signed-off-by: Li Xi &lt;lixi@ddn.com&gt;<br>    Signed-off-by: Dmitry Monakhov &lt;dmonakhov@openvz.org&gt;<br>    Signed-off-by: Theodore Ts&#39;o &lt;tytso@mit.edu&gt;<br>    Reviewed-by: Andreas Dilger &lt;adilger@dilger.ca&gt;<br>    Reviewed-by: Jan Kara &lt;jack@suse.cz&gt;","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607788987,"ip_address":"","comment_id":267205,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5902618031","product_id":100063801,"comment_content":"è¿™ä¸ªæ˜¯ä¸€å®šè¦åŸºäºxfsæ–‡ä»¶ç³»ç»Ÿå—ï¼Ÿå¦‚æœæ˜¯ext4æ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511545,"discussion_content":"æˆ‘æ²¡æœ‰åœ¨ext4ä¸Šæµ‹è¯•è¿‡ï¼Œä¸è¿‡é€šè¿‡å†…æ ¸ä¿¡æ¯ï¼Œè¿˜æœ‰ç½‘ä¸Šåˆ«äººçš„å°è¯•ï¼Œext4åº”è¯¥ä¹Ÿæ˜¯æ”¯æŒï¼ˆprojectï¼‰quotaçš„ã€‚\n\nhttps://discuss.linuxcontainers.org/t/how-do-i-set-up-the-project-quota-needed-for-limiting-container-storage-size-for-the-dir-backend-on-ubuntu-18-04/7311\n\n```\ncommit 689c958cbe6be4f211b40747951a3ba2c73b6715\nAuthor: Li Xi &amp;lt;pkuelelixi@gmail.com&amp;gt;\nDate:   Fri Jan 8 16:01:22 2016 -0500\n\n    ext4: add project quota support\n\n    This patch adds mount options for enabling/disabling project quota\n    accounting and enforcement. A new specific inode is also used for\n    project quota accounting.\n\n    [ Includes fix from Dan Carpenter to crrect error checking from dqget(). ]\n\n    Signed-off-by: Li Xi &amp;lt;lixi@ddn.com&amp;gt;\n    Signed-off-by: Dmitry Monakhov &amp;lt;dmonakhov@openvz.org&amp;gt;\n    Signed-off-by: Theodore Ts&amp;#39;o &amp;lt;tytso@mit.edu&amp;gt;\n    Reviewed-by: Andreas Dilger &amp;lt;adilger@dilger.ca&amp;gt;\n    Reviewed-by: Jan Kara &amp;lt;jack@suse.cz&amp;gt;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607788987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323661,"user_name":"DayDayUp","can_delete":false,"product_type":"c1","uid":1610552,"ip_address":"","ucode":"9C53659518AB74","user_header":"https://static001.geekbang.org/account/avatar/00/18/93/38/71615300.jpg","comment_is_top":false,"comment_ctime":1638078983,"is_pvip":false,"replies":[{"id":"123843","content":"eBay cloud team.  æˆ‘ä»¬ä¸€ç›´åœ¨æ‹›äººçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2070138","ctime":1647785640,"ip_address":"","comment_id":323661,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638078983","product_id":100063801,"comment_content":"è€å¸ˆè®²çš„å¤ªå¥½äº†ï¼Œä¸çŸ¥é“é¢è¯•è´µå¸ä¼šä¸ä¼šæœ‰æœºä¼šå‘¢ï¼Ÿè€å¸ˆåœ¨eBayå“ªä¸ªteamå•Šï¼Ÿåº”å±Šç”Ÿè¦å—ï¼Ÿï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557394,"discussion_content":"eBay cloud team.  æˆ‘ä»¬ä¸€ç›´åœ¨æ‹›äººçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647785640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297329,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1623462991,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1623462991","product_id":100063801,"comment_content":"k8s ä¸­readonlyrootfs ä¹Ÿæ˜¯åŒæ ·çš„åœºæ™¯å§","like_count":0,"discussions":[{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407962,"discussion_content":"ä¸æ˜¯çš„ï¼Œè¿™ä¸ªåªæ˜¯é™åˆ¶å¾€rootfsï¼Œå†™æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635158758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271450,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1609645507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609645507","product_id":100063801,"comment_content":"ä¹‹å‰å·¥ä½œä¸­å°±ç»å¸¸å› ä¸ºesé”™è¯¯æ—¥å¿—æŠŠå®¿ä¸»æœºçš„ç£ç›˜æ’‘æ»¡ã€‚ä½†è¿˜ä»æœªå¾€è¿™ä¸ªæ–¹å‘æƒ³ï¼Œè¿˜å¯ä»¥é™åˆ¶æŸä¸ªé¡¹ç›®çš„ç£ç›˜ä½¿ç”¨é‡ã€‚ğŸ˜‚","like_count":0},{"had_liked":false,"id":267386,"user_name":"ä¸Šé‚ªå¿˜å·","can_delete":false,"product_type":"c1","uid":1276588,"ip_address":"","ucode":"1C4459917B038D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","comment_is_top":false,"comment_ctime":1607701509,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607701509","product_id":100063801,"comment_content":"[root@localhost ~]# xfs_quota -x -c &#39;report -h &#47;tmp&#47;xfs_prjquota&#39;<br>Project quota on &#47; (&#47;dev&#47;mapper&#47;centos-root)<br>                        Blocks              <br>Project ID   Used   Soft   Hard Warn&#47;Grace   <br>---------- --------------------------------- <br>#0           3.2G      0      0  00 [------]<br>#2             8K   100M   100M  00 [------]<br>#3           100M   100M   100M  00 [------]<br>#101          10M      0    10M  00 [------]<br>","like_count":1}]}