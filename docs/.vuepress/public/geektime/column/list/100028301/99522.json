{"id":99522,"title":"06 | OpenResty ä¸­ç”¨åˆ°çš„ NGINX çŸ¥è¯†","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>é€šè¿‡å‰é¢å‡ ç¯‡æ–‡ç« çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ OpenResty çš„è½®å»“å·²ç»æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„è®¤çŸ¥ã€‚ä¸‹é¢å‡ èŠ‚è¯¾é‡Œï¼Œæˆ‘ä¼šå¸¦ä½ ç†Ÿæ‚‰ä¸‹ OpenResty çš„ä¸¤ä¸ªåŸºçŸ³ï¼šNGINX å’Œ LuaJITã€‚ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ï¼ŒæŒæ¡äº›è¿™äº›åŸºç¡€çš„çŸ¥è¯†ï¼Œæ‰èƒ½æ›´å¥½åœ°å»å­¦ä¹  OpenRestyã€‚</p><p>ä»Šå¤©æˆ‘å…ˆæ¥è®² NGINXã€‚è¿™é‡Œæˆ‘åªä¼šä»‹ç»ä¸‹ï¼ŒOpenResty ä¸­å¯èƒ½ä¼šç”¨åˆ°çš„ä¸€äº› NGINX åŸºç¡€çŸ¥è¯†ï¼Œè¿™äº›ä»…ä»…æ˜¯ NGINX å¾ˆå°çš„ä¸€ä¸ªå­é›†ã€‚å¦‚æœä½ éœ€è¦ç³»ç»Ÿå’Œæ·±å…¥å­¦ä¹  NGINXï¼Œå¯ä»¥å‚è€ƒé™¶è¾‰è€å¸ˆçš„ã€ŠNGINX æ ¸å¿ƒçŸ¥è¯† 100 è®²ã€‹ï¼Œè¿™ä¹Ÿæ˜¯æå®¢æ—¶é—´ä¸Šè¯„ä»·éå¸¸é«˜çš„ä¸€é—¨è¯¾ç¨‹ã€‚</p><p>è¯´åˆ°é…ç½®ï¼Œå…¶å®ï¼Œåœ¨ OpenResty çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‹é¢å‡ ç‚¹ï¼š</p><ul>\n<li>è¦å°½å¯èƒ½å°‘åœ°é…ç½® nginx.confï¼›</li>\n<li>é¿å…ä½¿ç”¨ifã€set ã€rewrite ç­‰å¤šä¸ªæŒ‡ä»¤çš„é…åˆï¼›</li>\n<li>èƒ½é€šè¿‡ Lua ä»£ç è§£å†³çš„ï¼Œå°±åˆ«ç”¨ NGINX çš„é…ç½®ã€å˜é‡å’Œæ¨¡å—æ¥è§£å†³ã€‚</li>\n</ul><p>è¿™æ ·å¯ä»¥æœ€å¤§é™åº¦åœ°æé«˜å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><p>ä¸‹é¢è¿™æ®µ NGINX é…ç½®ï¼Œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åä¾‹ï¼Œå¯ä»¥è¯´æ˜¯æŠŠé…ç½®é¡¹å½“æˆäº†ä»£ç æ¥ä½¿ç”¨ï¼š</p><pre><code>location ~ ^/mobile/(web/app.htm) {\n            set $type $1;\n            set $orig_args $args;\n            if ( $http_user_Agent ~ &quot;(iPhone|iPad|Android)&quot; ) {\n                rewrite  ^/mobile/(.*) http://touch.foo.com/mobile/$1 last;\n            }\n            proxy_pass http://foo.com/$type?$orig_args;\n}\n</code></pre><p>è¿™æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ OpenResty è¿›è¡Œå¼€å‘æ—¶éœ€è¦é¿å…çš„ã€‚</p><h2><strong>NGINX é…ç½®</strong></h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸‹ NGINX çš„é…ç½®æ–‡ä»¶ã€‚NGINX é€šè¿‡é…ç½®æ–‡ä»¶æ¥æ§åˆ¶è‡ªèº«è¡Œä¸ºï¼Œå®ƒçš„é…ç½®å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç®€å•çš„ DSLã€‚NGINX åœ¨è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™è¯»å–é…ç½®ï¼Œå¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚<strong>å¦‚æœä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä½ é‡å¯æˆ–è€…é‡è½½ NGINXï¼Œå†æ¬¡è¯»å–åæ‰èƒ½ç”Ÿæ•ˆ</strong>ã€‚åªæœ‰ NGINX çš„å•†ä¸šç‰ˆæœ¬ï¼Œæ‰ä¼šåœ¨è¿è¡Œæ—¶, ä»¥ API çš„å½¢å¼æä¾›éƒ¨åˆ†åŠ¨æ€çš„èƒ½åŠ›ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™æ®µé…ç½®ï¼Œé‡Œé¢çš„å†…å®¹éå¸¸ç®€å•ï¼Œæˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆéƒ½èƒ½çœ‹æ‡‚ï¼š</p><pre><code>worker_processes auto;\n\npid logs/nginx.pid;\nerror_log logs/error.log notice;\n\nworker_rlimit_nofile 65535;\n\nevents {\n    worker_connections 16384;\n}\n\nhttp {\n    server {\n\tlisten 80;\n\tlisten 443 ssl;\n\n        location / {\n\t    proxy_pass https://foo.com;\n\t    }\n    }\n}\n\nstream {\n    server {\n        listen 53 udp;\n    }\n}\n</code></pre><p>ä¸è¿‡ï¼Œå³ä½¿æ˜¯ç®€å•çš„é…ç½®ï¼ŒèƒŒåä¹Ÿæ¶‰åŠåˆ°äº†ä¸€äº›å¾ˆé‡è¦çš„åŸºç¡€æ¦‚å¿µã€‚</p><p>ç¬¬ä¸€ï¼Œæ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰è‡ªå·±é€‚ç”¨çš„ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ï¼Œä¹Ÿå°±æ˜¯NGINX é…ç½®æ–‡ä»¶ä¸­æŒ‡ä»¤çš„ä½œç”¨åŸŸã€‚</p><p>æœ€ä¸Šå±‚çš„æ˜¯ mainï¼Œé‡Œé¢æ˜¯å’Œå…·ä½“ä¸šåŠ¡æ— å…³çš„ä¸€äº›æŒ‡ä»¤ï¼Œæ¯”å¦‚ä¸Šé¢å‡ºç°çš„ worker_processesã€pid å’Œ error_logï¼Œéƒ½å±äº main è¿™ä¸ªä¸Šä¸‹æ–‡ã€‚å¦å¤–ï¼Œä¸Šä¸‹æ–‡æ˜¯æœ‰å±‚çº§å…³ç³»çš„ï¼Œæ¯”å¦‚ location çš„ä¸Šä¸‹æ–‡æ˜¯ serverï¼Œserver çš„ä¸Šä¸‹æ–‡æ˜¯ httpï¼Œhttp çš„ä¸Šä¸‹æ–‡æ˜¯ mainã€‚</p><p>æŒ‡ä»¤ä¸èƒ½è¿è¡Œåœ¨é”™è¯¯çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒNGINX åœ¨å¯åŠ¨æ—¶ä¼šæ£€æµ‹ nginx.conf æ˜¯å¦åˆæ³•ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠ</p><p><code>listen 80;</code>  ä» server ä¸Šä¸‹æ–‡æ¢åˆ° main ä¸Šä¸‹æ–‡ï¼Œç„¶åå¯åŠ¨ NGINX æœåŠ¡ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æŠ¥é”™ï¼š</p><pre><code>&quot;listen&quot; directive is not allowed here ......\n</code></pre><p>ç¬¬äºŒï¼ŒNGINX ä¸ä»…å¯ä»¥å¤„ç† HTTP è¯·æ±‚ å’Œ HTTPS æµé‡ï¼Œè¿˜å¯ä»¥å¤„ç† UDP å’Œ TCP æµé‡ã€‚</p><p>å…¶ä¸­ï¼Œä¸ƒå±‚çš„æ”¾åœ¨ HTTP ä¸­ï¼Œå››å±‚çš„æ”¾åœ¨ streamä¸­ã€‚åœ¨ OpenResty é‡Œé¢ï¼Œ lua-nginx-module å’Œ stream-lua-nginx-module åˆ†åˆ«å’Œè¿™ä¿©å¯¹åº”ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œ<strong>NGINX æ”¯æŒçš„åŠŸèƒ½ï¼ŒOpenResty å¹¶ä¸ä¸€å®šæ”¯æŒï¼Œéœ€è¦çœ‹ OpenResty çš„ç‰ˆæœ¬å·</strong>ã€‚OpenResty çš„ç‰ˆæœ¬å·æ˜¯å’Œ NGINX ä¿æŒä¸€è‡´çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¯†åˆ«ã€‚æ¯”å¦‚ NGINX åœ¨ 2018 å¹´ 3 æœˆä»½å‘å¸ƒçš„ 1.13.10 ç‰ˆæœ¬ä¸­ï¼Œå¢åŠ äº†å¯¹ gRPC çš„æ”¯æŒï¼Œä½† OpenResty åœ¨ 2019 å¹´ 4 æœˆä»½æ—¶çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 1.13.6.2ï¼Œç”±æ­¤å¯ä»¥æ¨æ–­ OpenResty è¿˜ä¸æ”¯æŒ gRPCã€‚</p><p>ä¸Šé¢ nginx.conf æ¶‰åŠåˆ°çš„é…ç½®æŒ‡ä»¤ï¼Œéƒ½åœ¨ NGINX çš„æ ¸å¿ƒæ¨¡å— <a href=\"http://nginx.org/en/docs/ngx_core_module.html\">ngx_core_module</a>ã€<a href=\"http://nginx.org/en/docs/http/ngx_http_core_module.html\">ngx_http_core_module_</a> å’Œ <a href=\"http://nginx.org/en/docs/stream/ngx_stream_core_module.html\">ngx_stream_core_module_</a> ä¸­ï¼Œä½ å¯ä»¥ç‚¹å‡»è¿™å‡ ä¸ªé“¾æ¥å»æŸ¥çœ‹å…·ä½“çš„æ–‡æ¡£è¯´æ˜ã€‚</p><h2><strong>MASTER-WORKER æ¨¡å¼</strong></h2><p>äº†è§£å®Œé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ NGINX çš„å¤šè¿›ç¨‹æ¨¡å¼ã€‚è¿™é‡Œæˆ‘æ”¾äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼ŒNGINX å¯åŠ¨åï¼Œä¼šæœ‰ä¸€ä¸ª Master è¿›ç¨‹å’Œå¤šä¸ª Worker è¿›ç¨‹ï¼ˆä¹Ÿå¯ä»¥åªæœ‰ä¸€ä¸ª Worker è¿›ç¨‹ï¼Œçœ‹ä½ å¦‚ä½•é…ç½®ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/92/a7304c2c8af0e1e6c54819c97611b992.jpg?wh=1164*916\" alt=\"\"></p><p>å…ˆæ¥è¯´ Master è¿›ç¨‹ï¼Œä¸€å¦‚å…¶åï¼Œæ‰®æ¼”â€œç®¡ç†è€…â€çš„è§’è‰²ï¼Œå¹¶ä¸è´Ÿè´£å¤„ç†ç»ˆç«¯çš„è¯·æ±‚ã€‚å®ƒæ˜¯ç”¨æ¥ç®¡ç† Worker è¿›ç¨‹çš„ï¼ŒåŒ…æ‹¬æ¥å—ç®¡ç†å‘˜å‘é€çš„ä¿¡å·é‡ã€ç›‘æ§ Worker çš„è¿è¡ŒçŠ¶æ€ã€‚å½“ Worker è¿›ç¨‹å¼‚å¸¸é€€å‡ºæ—¶ï¼ŒMaster è¿›ç¨‹ä¼šé‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„ Worker è¿›ç¨‹ã€‚</p><p>Worker è¿›ç¨‹åˆ™æ˜¯â€œä¸€çº¿å‘˜å·¥â€ï¼Œç”¨æ¥å¤„ç†ç»ˆç«¯ç”¨æˆ·çš„è¯·æ±‚ã€‚å®ƒæ˜¯ä» Master è¿›ç¨‹ fork å‡ºæ¥çš„ï¼Œå½¼æ­¤ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ã€‚å¤šè¿›ç¨‹çš„æ¨¡å¼æ¯” Apache å¤šçº¿ç¨‹çš„æ¨¡å¼è¦å…ˆè¿›å¾ˆå¤šï¼Œæ²¡æœ‰çº¿ç¨‹é—´åŠ é”ï¼Œä¹Ÿæ–¹ä¾¿è°ƒè¯•ã€‚å³ä½¿æŸä¸ªè¿›ç¨‹å´©æºƒé€€å‡ºäº†ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»– Worker è¿›ç¨‹æ­£å¸¸å·¥ä½œã€‚</p><p>è€Œ OpenResty åœ¨ NGINX Master-Worker æ¨¡å¼çš„å‰æä¸‹ï¼Œåˆå¢åŠ äº†ç‹¬æœ‰çš„ç‰¹æƒè¿›ç¨‹ï¼ˆprivileged agentï¼‰ã€‚è¿™ä¸ªè¿›ç¨‹å¹¶ä¸ç›‘å¬ä»»ä½•ç«¯å£ï¼Œå’Œ NGINX çš„ Master è¿›ç¨‹æ‹¥æœ‰åŒæ ·çš„æƒé™ï¼Œæ‰€ä»¥å¯ä»¥åšä¸€äº›éœ€è¦é«˜æƒé™æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ï¼Œæ¯”å¦‚å¯¹æœ¬åœ°ç£ç›˜æ–‡ä»¶çš„ä¸€äº›å†™æ“ä½œç­‰ã€‚</p><p>å¦‚æœç‰¹æƒè¿›ç¨‹ä¸ NGINX äºŒè¿›åˆ¶çƒ­å‡çº§çš„æœºåˆ¶äº’ç›¸é…åˆï¼ŒOpenResty å°±å¯ä»¥å®ç°è‡ªæˆ‘äºŒè¿›åˆ¶çƒ­å‡çº§çš„æ•´ä¸ªæµç¨‹ï¼Œè€Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨çš„ç¨‹åºã€‚</p><p>å‡å°‘å¯¹å¤–éƒ¨ç¨‹åºçš„ä¾èµ–ï¼Œå°½é‡åœ¨ OpenResty è¿›ç¨‹å†…è§£å†³é—®é¢˜ï¼Œä¸ä»…æ–¹ä¾¿éƒ¨ç½²ã€é™ä½è¿ç»´æˆæœ¬ï¼Œä¹Ÿå¯ä»¥é™ä½ç¨‹åºå‡ºé”™çš„æ¦‚ç‡ã€‚å¯ä»¥è¯´ï¼ŒOpenResty ä¸­çš„ç‰¹æƒè¿›ç¨‹ã€ngx.pipe ç­‰åŠŸèƒ½ï¼Œéƒ½æ˜¯å‡ºäºè¿™ä¸ªç›®çš„ã€‚</p><h2><strong>æ‰§è¡Œé˜¶æ®µ</strong></h2><p>æ‰§è¡Œé˜¶æ®µä¹Ÿæ˜¯ NGINX é‡è¦çš„ç‰¹æ€§ï¼Œä¸ OpenResty çš„å…·ä½“å®ç°å¯†åˆ‡ç›¸å…³ã€‚NGINX æœ‰ 11 ä¸ªæ‰§è¡Œé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥ä» ngx_http_core_module.h çš„æºç ä¸­çœ‹åˆ°ï¼š</p><pre><code>typedef enum {\n    NGX_HTTP_POST_READ_PHASE = 0,\n\n    NGX_HTTP_SERVER_REWRITE_PHASE,\n\n    NGX_HTTP_FIND_CONFIG_PHASE,\n    NGX_HTTP_REWRITE_PHASE,\n    NGX_HTTP_POST_REWRITE_PHASE,\n\n    NGX_HTTP_PREACCESS_PHASE,\n\n    NGX_HTTP_ACCESS_PHASE,\n    NGX_HTTP_POST_ACCESS_PHASE,\n\n    NGX_HTTP_PRECONTENT_PHASE,\n\n    NGX_HTTP_CONTENT_PHASE,\n\n    NGX_HTTP_LOG_PHASE\n} ngx_http_phases;\n</code></pre><p>å¦‚æœä½ æƒ³è¯¦ç»†äº†è§£è¿™ 11 ä¸ªé˜¶æ®µçš„ä½œç”¨ï¼Œå¯ä»¥å­¦ä¹ é™¶è¾‰è€å¸ˆçš„è§†é¢‘è¯¾ç¨‹ï¼Œæˆ–è€… NGINX æ–‡æ¡£ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°ã€‚</p><p>ä¸è¿‡ï¼Œå·§åˆçš„æ˜¯ï¼ŒOpenResty ä¹Ÿæœ‰ 11 ä¸ª <code>*_by_lua</code>æŒ‡ä»¤ï¼Œå®ƒä»¬å’Œ NGINX é˜¶æ®µçš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾ç‰‡æ¥è‡ª lua-nginx-module æ–‡æ¡£ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/73/2a05cb2a679bd1c81b44508666e70273.png?wh=1005*910\" alt=\"\"></p><p>å…¶ä¸­ï¼Œ  <code>init_by_lua</code> åªä¼šåœ¨ Master è¿›ç¨‹è¢«åˆ›å»ºæ—¶æ‰§è¡Œï¼Œ<code>init_worker_by_lua</code> åªä¼šåœ¨æ¯ä¸ª Worker è¿›ç¨‹è¢«åˆ›å»ºæ—¶æ‰§è¡Œã€‚å…¶ä»–çš„ <code>*_by_lua</code> æŒ‡ä»¤åˆ™æ˜¯ç”±ç»ˆç«¯è¯·æ±‚è§¦å‘ï¼Œä¼šè¢«åå¤æ‰§è¡Œã€‚</p><p>æ‰€ä»¥åœ¨ init_by_lua é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆåŠ è½½ Lua æ¨¡å—å’Œå…¬å…±çš„åªè¯»æ•°æ®ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ COWï¼ˆcopy on writeï¼‰ç‰¹æ€§ï¼Œæ¥èŠ‚çœä¸€äº›å†…å­˜ã€‚</p><p>å¯¹äºä¸šåŠ¡ä»£ç æ¥è¯´ï¼Œå…¶å®å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½å¯ä»¥åœ¨ content_by_lua é‡Œé¢å®Œæˆï¼Œä½†æˆ‘æ›´æ¨èçš„åšæ³•ï¼Œæ˜¯æ ¹æ®ä¸åŒçš„åŠŸèƒ½æ¥è¿›è¡Œæ‹†åˆ†ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><ul>\n<li>set_by_luaï¼šè®¾ç½®å˜é‡ï¼›</li>\n<li>rewrite_by_luaï¼šè½¬å‘ã€é‡å®šå‘ç­‰ï¼›</li>\n<li>access_by_luaï¼šå‡†å…¥ã€æƒé™ç­‰ï¼›</li>\n<li>content_by_luaï¼šç”Ÿæˆè¿”å›å†…å®¹ï¼›</li>\n<li>header_filter_by_luaï¼šåº”ç­”å¤´è¿‡æ»¤å¤„ç†ï¼›</li>\n<li>body_filter_by_luaï¼šåº”ç­”ä½“è¿‡æ»¤å¤„ç†ï¼›</li>\n<li>log_by_luaï¼šæ—¥å¿—è®°å½•ã€‚</li>\n</ul><p>æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™æ ·æ‹†åˆ†çš„å¥½å¤„ã€‚æˆ‘ä»¬å‡è®¾ï¼Œä½ å¯¹å¤–æä¾›äº†å¾ˆå¤šæ˜æ–‡ APIï¼Œç°åœ¨éœ€è¦å¢åŠ è‡ªå®šä¹‰çš„åŠ å¯†å’Œè§£å¯†é€»è¾‘ã€‚é‚£ä¹ˆè¯·é—®ï¼Œä½ éœ€è¦ä¿®æ”¹æ‰€æœ‰ API çš„ä»£ç å—ï¼Ÿ</p><pre><code># æ˜æ–‡åè®®ç‰ˆæœ¬\nlocation /mixed {\n    content_by_lua '...';       # å¤„ç†è¯·æ±‚\n}\n</code></pre><p>å½“ç„¶ä¸ç”¨ã€‚äº‹å®ä¸Šï¼Œåˆ©ç”¨é˜¶æ®µçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°åœ¨ access é˜¶æ®µè§£å¯†ï¼Œåœ¨ body filter é˜¶æ®µåŠ å¯†å°±å¯ä»¥äº†ï¼ŒåŸæ¥ content é˜¶æ®µçš„ä»£ç æ˜¯ä¸ç”¨åšä»»ä½•ä¿®æ”¹çš„ï¼š</p><pre><code># åŠ å¯†åè®®ç‰ˆæœ¬\nlocation /mixed {\n    access_by_lua '...';        # è¯·æ±‚ä½“è§£å¯†\n    content_by_lua '...';       # å¤„ç†è¯·æ±‚ï¼Œä¸éœ€è¦å…³å¿ƒé€šä¿¡åè®®\n    body_filter_by_lua '...';   # åº”ç­”ä½“åŠ å¯†\n}\n</code></pre><h2><strong>äºŒè¿›åˆ¶çƒ­å‡çº§</strong></h2><p>æœ€åï¼Œæˆ‘æ¥ç®€å•è¯´ä¸€ä¸‹ NGINX çš„äºŒè¿›åˆ¶çƒ­å‡çº§ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½ ä¿®æ”¹å®Œ NGINX çš„é…ç½®æ–‡ä»¶åï¼Œè¿˜éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆã€‚ä½†åœ¨ NGINX å‡çº§è‡ªèº«ç‰ˆæœ¬çš„æ—¶å€™ï¼Œå´å¯ä»¥åšåˆ°çƒ­å‡çº§ã€‚è¿™çœ‹ä¸Šå»æœ‰ç‚¹å„¿æœ¬æœ«å€’ç½®ï¼Œä¸è¿‡ï¼Œè€ƒè™‘åˆ° NGINX æ˜¯ä»ä¼ ç»Ÿé™æ€çš„è´Ÿè½½å‡è¡¡ã€åå‘ä»£ç†ã€æ–‡ä»¶ç¼“å­˜èµ·å®¶çš„ï¼Œè¿™å€’ä¹Ÿå¯ä»¥ç†è§£ã€‚</p><p>çƒ­å‡çº§é€šè¿‡å‘æ—§çš„ Master è¿›ç¨‹å‘é€ USR2  å’Œ WINCH ä¿¡å·é‡æ¥å®Œæˆã€‚å¯¹äºè¿™ä¸¤æ­¥ï¼Œå‰è€…çš„ä½œç”¨ï¼Œæ˜¯å¯åŠ¨æ–°çš„ Master è¿›ç¨‹ï¼›åè€…çš„ä½œç”¨ï¼Œæ˜¯é€æ­¥å…³é—­ Worker è¿›ç¨‹ã€‚</p><p>æ‰§è¡Œå®Œè¿™ä¸¤æ­¥åï¼Œæ–°çš„ Master å’Œæ–°çš„ Worker å°±å·²ç»å¯åŠ¨äº†ã€‚ä¸è¿‡æ­¤æ—¶ï¼Œæ—§çš„ Master å¹¶æ²¡æœ‰é€€å‡ºã€‚ä¸é€€å‡ºçš„åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœä½ éœ€è¦å›é€€ï¼Œä¾æ—§å¯ä»¥ç»™æ—§çš„ Master å‘é€ HUP ä¿¡å·é‡ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å·²ç»ç¡®å®šä¸éœ€è¦å›é€€ï¼Œå°±å¯ä»¥ç»™æ—§ Master å‘é€ KILL ä¿¡å·é‡æ¥é€€å‡ºã€‚</p><p>è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆï¼ŒäºŒè¿›åˆ¶çš„çƒ­å‡çº§å°±å®Œæˆäº†ã€‚</p><p>å…³äºäºŒè¿›åˆ¶å‡çº§ï¼Œæˆ‘ä¸»è¦å°±è®²è¿™äº›ã€‚å¦‚æœä½ æƒ³äº†è§£è¿™æ–¹é¢æ›´è¯¦ç»†çš„èµ„æ–™ï¼Œå¯ä»¥æŸ¥é˜…<a href=\"http://nginx.org/en/docs/control.html#upgrade\">å®˜æ–¹æ–‡æ¡£</a>ç»§ç»­å­¦ä¹ ã€‚</p><h2><strong>è¯¾å¤–å»¶ä¼¸</strong></h2><p>OpenResty çš„ä½œè€…å¤šå¹´å‰å†™è¿‡ä¸€ä¸ª <a href=\"https://openresty.org/download/agentzh-nginx-tutorials-zhcn.html\">NGINX æ•™ç¨‹</a>ï¼Œå¦‚æœä½ å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œå¯ä»¥è‡ªå·±å­¦ä¹ ä¸‹ã€‚è¿™é‡Œé¢çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œå³ä½¿çœ‹ä¸æ‡‚ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå¹¶ä¸ä¼šå½±å“ä½ å­¦ä¹  OpenRestyã€‚</p><h2>å†™åœ¨æœ€å</h2><p>æ€»çš„æ¥è¯´ï¼Œåœ¨ OpenResty ä¸­ç”¨åˆ°çš„éƒ½æ˜¯ Nginx çš„åŸºç¡€çŸ¥è¯†ï¼Œä¸»è¦æ¶‰åŠåˆ°é…ç½®ã€ä¸»ä»è¿›ç¨‹ã€æ‰§è¡Œé˜¶æ®µç­‰ã€‚è€Œ<strong>å…¶ä»–èƒ½ç”¨ Lua ä»£ç è§£å†³çš„ï¼Œå°½é‡ç”¨ä»£ç æ¥è§£å†³ï¼Œè€Œéä½¿ç”¨Nginx çš„æ¨¡å—å’Œé…ç½®</strong>ï¼Œè¿™æ˜¯åœ¨å­¦ä¹  OpenResty ä¸­çš„ä¸€ä¸ªæ€è·¯è½¬å˜ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™äº†ä¸€é“å¼€æ”¾çš„æ€è€ƒé¢˜ã€‚Nginx å®˜æ–¹æ”¯æŒ NJSï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”¨ JS å†™æ§åˆ¶éƒ¨åˆ† Nginx çš„é€»è¾‘ï¼Œå’Œ OpenResty çš„æ€è·¯å¾ˆç±»ä¼¼ã€‚å¯¹æ­¤ï¼Œä½ æ˜¯æ€ä¹ˆçœ‹å¾…çš„å‘¢ï¼Ÿ</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« è½¬å‘ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"05 | [è§†é¢‘]opmé¡¹ç›®å¯¼è¯»","id":98987},"right":{"article_title":"07 | å¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ Lua","id":99830}},"comments":[{"had_liked":false,"id":101832,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1559987707,"is_pvip":true,"replies":[{"id":"36746","content":"1. OpenResty çš„ç‰ˆæœ¬å·æ˜¯è·Ÿç€å®ƒæ‰€ä½¿ç”¨çš„ Nginx æ¥ç¡®å®šçš„ï¼Œæ¯”å¦‚ OpenResty çš„ 1.15.8.1ï¼Œä½¿ç”¨çš„ Nginx ç‰ˆæœ¬å·å°±æ˜¯ 1.15.8ï¼Œæœ€åçš„ 1 æ˜¯ OpenResty è‡ªå·±çš„å°ç‰ˆæœ¬å·ï¼›<br>2. OpenResty çš„ç‰ˆæœ¬å·æ˜¯å¾€ä¸Šå¢åŠ çš„ï¼Œä¸å¤ªæ¸…æ¥šè¶Šæ¥è¶Šå°æ˜¯æ€ä¹ˆçœ‹å‡ºæ¥çš„å‘¢ï¼Ÿ<br>3. çƒ­å‡çº§æ­¥éª¤å’Œ nginx ä¸€è‡´ï¼›<br>4. è¿™é‡Œçš„å¤–éƒ¨ç¨‹åºæ˜¯æŒ‡ï¼šä½ éœ€è¦ä¸€ä¸ª nginx ä¹‹å¤–çš„è¿›ç¨‹ç»™ nginx æœ¬èº«å‘é€ä¿¡å·é‡ï¼Œnginx æ‰èƒ½å‡çº§ï¼›è€Œ OpenResty æœ‰äº†ç‰¹æƒè¿›ç¨‹ä¹‹åï¼Œå¯ä»¥è‡ªå·±ç»™master è¿›ç¨‹å‘é€ä¿¡å·é‡ï¼›<br>5. ç›¸å½“äºå…¶ä»– worker è¿›ç¨‹éƒ½å·²ç»åŠ è½½è¿‡è¿™ä¸ªæ¨¡å—ï¼Œä¸ç”¨é‡å¤åŠ è½½ï¼›ä¸€ä¸ªæ¨¡å—åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œä¸ç®¡æœ‰å¤šå°‘è¯·æ±‚æ¥è®¿é—®ï¼Œå’Œé˜¶æ®µæ— å…³ï¼›<br>6. äºŒè¿›åˆ¶çƒ­å‡çº§æ˜¯å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½ï¼Œä½† nginx æ”¯æŒäº†çƒ­éƒ¨ç½²ï¼›ä¿®æ”¹é…ç½®æ–‡ä»¶æ˜¯å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä½†å´éœ€è¦ reload æ‰èƒ½ç”Ÿæ•ˆã€‚æ²¡æœ‰æŠŠå¸¸ç”¨çš„åŠŸèƒ½åšåˆ°æè‡´ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰äº›æœ¬æœ«å€’ç½®ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":101832,"uid":"1017955","ip_address":"","utype":1,"ctime":1560060858,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"57394562555","product_id":100028301,"comment_content":"æ¸©é“­è€å¸ˆï¼Œä½ å¥½ã€‚çœ‹äº†è¿™ç¯‡æ–‡ç« ä¹‹åï¼Œæœ‰ä¸‹é¢è¿™äº›ç–‘é—®ï¼Œå¸Œæœ›è€å¸ˆç­”ç–‘è§£æƒ‘ä¸‹ã€‚<br>1.nginxå’Œopenrestyæœ‰ä»€ä¹ˆç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Ÿè®°å¾—å‰ä¸¤ä¸ªç‰ˆæœ¬å·æ˜¯ç›¸åŒçš„ã€‚<br>2.ä¸ºä»€ä¹ˆopenrestyçš„ç‰ˆæœ¬è¶Šæ¥è¶Šå°ï¼Ÿæ˜¯ä¸ºäº†è¡¨è¾¾æœ‰äº›åŠŸèƒ½ä¸æ”¯æŒäº†å—ï¼Ÿ<br>3.openrestyå¯æ‰§è¡Œæ–‡ä»¶æ˜¯nginxå¯æ‰§è¡Œæ–‡ä»¶çš„è½¯é“¾æ¥ï¼Œæœ¬èƒ½çš„ä»¥ä¸ºopenrestyçš„çƒ­å‡çº§å°±æ˜¯nginxçš„çƒ­å‡çº§ï¼Œopenrestyçš„çƒ­å‡çº§å’Œnginxçš„çƒ­å‡çº§ä¸ä¸€æ ·å—ï¼Ÿ<br>4.nginxçƒ­å‡çº§æ­¥éª¤æ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç¨‹åºï¼Œè¿™é‡Œè¯´çš„çƒ­å‡çº§ä¸­ä¾èµ–çš„å¤–éƒ¨ç¨‹åºæ˜¯æŒ‡ä»€ä¹ˆå‘¢ï¼Ÿ<br>5.init_by_luaé¢„å…ˆåŠ è½½æ¨¡å—ï¼Œåœ¨è¯·æ±‚çš„å…¶ä»–é˜¶æ®µå°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æ­¤æ—¶ç›¸å½“äºæ˜¯å…¨å±€å˜é‡ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœåœ¨ä¸€ä¸ªè¯·æ±‚çš„å¤šä¸ªé˜¶æ®µé‡å¤åŠ è½½æŸä¸€æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—ä¼šé‡å¤åŠ è½½ï¼Œè¿˜æ˜¯åªåŠ è½½ä¸€æ¬¡ï¼Ÿ<br>6.nginxä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°åŠ è½½ï¼›nginxåˆæ”¯æŒçƒ­éƒ¨ç½²ï¼Œè¯·é—®è¿™é‡Œçš„æœ¬æœ«å€’ç½®æ€ä¹ˆä¸ªè¯´æ³•ï¼Ÿ:)","like_count":14,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453135,"discussion_content":"1. OpenResty çš„ç‰ˆæœ¬å·æ˜¯è·Ÿç€å®ƒæ‰€ä½¿ç”¨çš„ Nginx æ¥ç¡®å®šçš„ï¼Œæ¯”å¦‚ OpenResty çš„ 1.15.8.1ï¼Œä½¿ç”¨çš„ Nginx ç‰ˆæœ¬å·å°±æ˜¯ 1.15.8ï¼Œæœ€åçš„ 1 æ˜¯ OpenResty è‡ªå·±çš„å°ç‰ˆæœ¬å·ï¼›\n2. OpenResty çš„ç‰ˆæœ¬å·æ˜¯å¾€ä¸Šå¢åŠ çš„ï¼Œä¸å¤ªæ¸…æ¥šè¶Šæ¥è¶Šå°æ˜¯æ€ä¹ˆçœ‹å‡ºæ¥çš„å‘¢ï¼Ÿ\n3. çƒ­å‡çº§æ­¥éª¤å’Œ nginx ä¸€è‡´ï¼›\n4. è¿™é‡Œçš„å¤–éƒ¨ç¨‹åºæ˜¯æŒ‡ï¼šä½ éœ€è¦ä¸€ä¸ª nginx ä¹‹å¤–çš„è¿›ç¨‹ç»™ nginx æœ¬èº«å‘é€ä¿¡å·é‡ï¼Œnginx æ‰èƒ½å‡çº§ï¼›è€Œ OpenResty æœ‰äº†ç‰¹æƒè¿›ç¨‹ä¹‹åï¼Œå¯ä»¥è‡ªå·±ç»™master è¿›ç¨‹å‘é€ä¿¡å·é‡ï¼›\n5. ç›¸å½“äºå…¶ä»– worker è¿›ç¨‹éƒ½å·²ç»åŠ è½½è¿‡è¿™ä¸ªæ¨¡å—ï¼Œä¸ç”¨é‡å¤åŠ è½½ï¼›ä¸€ä¸ªæ¨¡å—åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œä¸ç®¡æœ‰å¤šå°‘è¯·æ±‚æ¥è®¿é—®ï¼Œå’Œé˜¶æ®µæ— å…³ï¼›\n6. äºŒè¿›åˆ¶çƒ­å‡çº§æ˜¯å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½ï¼Œä½† nginx æ”¯æŒäº†çƒ­éƒ¨ç½²ï¼›ä¿®æ”¹é…ç½®æ–‡ä»¶æ˜¯å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä½†å´éœ€è¦ reload æ‰èƒ½ç”Ÿæ•ˆã€‚æ²¡æœ‰æŠŠå¸¸ç”¨çš„åŠŸèƒ½åšåˆ°æè‡´ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰äº›æœ¬æœ«å€’ç½®ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560060858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102115,"user_name":"TomShine","can_delete":false,"product_type":"c1","uid":1003894,"ip_address":"","ucode":"81B7B6628BCE31","user_header":"https://static001.geekbang.org/account/avatar/00/0f/51/76/bebe6133.jpg","comment_is_top":false,"comment_ctime":1560139584,"is_pvip":false,"replies":[{"id":"37361","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":102115,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410774,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"40214845248","product_id":100028301,"comment_content":"OpenResty çš„ä½œè€…NGINX æ•™ç¨‹å¯ä»¥åœ¨è¿™ä¸ªè¿æ¥ https:&#47;&#47;openresty.net.cn&#47;agentzh-nginx-guide.html è¿›è¡Œå­¦ä¹ ","like_count":9,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453267,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101626,"user_name":"John","can_delete":false,"product_type":"c1","uid":1458885,"ip_address":"","ucode":"ECACBE31D5D1A7","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","comment_is_top":false,"comment_ctime":1559893269,"is_pvip":false,"replies":[{"id":"36654","content":"æ„Ÿè§‰è¿™ä¸ªä¸ç”¨åºåˆ—åŒ–å­˜å‚¨ï¼Œä½ å¯ä»¥åœ¨ access é˜¶æ®µè°ƒç”¨é£æ§æœåŠ¡çš„ API æ¥å£ï¼ŒæŠŠ request å†…å®¹ä¼ è¿‡å»ï¼Œç­‰é£æ§è¿”å›åï¼Œæ ¹æ®ç»“æœåœ¨å†³å®šæ˜¯å‘é€åˆ°ä¸Šæ¸¸ï¼Œè¿˜æ˜¯æ‹’ç»ã€‚<br>ä½ å¯ä»¥çœ‹ä¸‹æœ¬ç« èŠ‚ OpenResty 11 ä¸ª `*_by_lua` æŒ‡ä»¤çš„å›¾ç‰‡ã€‚","user_name":"ä½œè€…å›å¤","comment_id":101626,"uid":"1017955","ip_address":"","utype":1,"ctime":1559957689,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"27329697045","product_id":100028301,"comment_content":"æˆ‘æ­£åœ¨åšä¸€ä¸ªäºŒæ¬¡éªŒè¯çš„é£æ§ï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œopå¦‚ä½•å°†ä¸€æ•´ä¸ªrequeståºåˆ—åŒ–å­˜å‚¨èµ·æ¥ï¼Œå¹¶ä¸”åœ¨é£æ§æ¡ä»¶è¾¾åˆ°åï¼Œå¦‚æ»‘åŠ¨éªŒè¯é€šè¿‡ï¼Œå†å°†å…¶ååºåˆ—åŒ–å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453041,"discussion_content":"æ„Ÿè§‰è¿™ä¸ªä¸ç”¨åºåˆ—åŒ–å­˜å‚¨ï¼Œä½ å¯ä»¥åœ¨ access é˜¶æ®µè°ƒç”¨é£æ§æœåŠ¡çš„ API æ¥å£ï¼ŒæŠŠ request å†…å®¹ä¼ è¿‡å»ï¼Œç­‰é£æ§è¿”å›åï¼Œæ ¹æ®ç»“æœåœ¨å†³å®šæ˜¯å‘é€åˆ°ä¸Šæ¸¸ï¼Œè¿˜æ˜¯æ‹’ç»ã€‚\nä½ å¯ä»¥çœ‹ä¸‹æœ¬ç« èŠ‚ OpenResty 11 ä¸ª `*_by_lua` æŒ‡ä»¤çš„å›¾ç‰‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559957689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101528,"user_name":"å¤©å¤©~","can_delete":false,"product_type":"c1","uid":1198331,"ip_address":"","ucode":"782A23AB38D39B","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/fb/eb91160d.jpg","comment_is_top":false,"comment_ctime":1559842214,"is_pvip":false,"replies":[{"id":"36655","content":"æ²¡é”™ï¼Œé™¤äº† njsï¼Œè¿˜æœ‰ PHP åµŒå…¥ nginx çš„å°è¯•ï¼Œè¿™äº›è¯­è¨€çš„æ™®åŠåº¦å’Œç”Ÿæ€æ¯” Lua å¥½å¾ˆå¤šã€‚OpenResty è¦åŠ æ²¹","user_name":"ä½œè€…å›å¤","comment_id":101528,"uid":"1017955","ip_address":"","utype":1,"ctime":1559957786,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":4,"race_medal":0,"score":"23034678694","product_id":100028301,"comment_content":"njs çš„æ„ä¹‰æ„Ÿè§‰åœ¨éƒ¨ç½²çš„æ—¶å€™å¤§å¹…åº¦ç®€åŒ–è¿ç»´çš„æ­¥éª¤ã€‚njs æˆ–è€…æ²¡æœ‰ luajit çš„æ€§èƒ½ï¼Œä½†å¯¹æ¯”ä¹‹ä¸‹ï¼Œæ¯” lua çš„ç”Ÿæ€ç¯å¢ƒå¥½å¤ªå¤šå¤ªå¤šäº†ï¼Œjs çš„ç”Ÿæ€å’Œå…¥é—¨çš„å®¹æ˜“ã€‚","like_count":5,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452999,"discussion_content":"æ²¡é”™ï¼Œé™¤äº† njsï¼Œè¿˜æœ‰ PHP åµŒå…¥ nginx çš„å°è¯•ï¼Œè¿™äº›è¯­è¨€çš„æ™®åŠåº¦å’Œç”Ÿæ€æ¯” Lua å¥½å¾ˆå¤šã€‚OpenResty è¦åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559957786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1910657,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/27/81/27c9d811.jpg","nickname":"é«˜ç‡•å†›","note":"","ucode":"AF31DDD0EE08BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582958,"discussion_content":"njsä¸ºå•¥æ²¡æœ‰luajitçš„æ€§èƒ½å‘¢ï¼Ÿv8ä¸æ˜¯ä¹Ÿå·ç§°æ€§èƒ½å¾ˆå¼ºåŠ²å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659842646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046725,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRwYJzyB6pdy4NANXiaxBEibOOHBa8KC0pQC8AGveDYloW4rfM42E4rEO6ohhQSiciaMGdDNBrkJkYtA/132","nickname":"è°¢å†›","note":"","ucode":"74A850295D58FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324371,"discussion_content":"é‚£ä¸ºå•¥è¿˜è¦å­¦openrestyå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605096053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315147,"avatar":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","nickname":"xfan","note":"","ucode":"48ED8D498D7F56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2283,"discussion_content":"è€å¸ˆï¼Œæˆ‘é—®ä¸ªé—®é¢˜ï¼Œkongå¯ä»¥æ”¯æŒtcpçš„è´Ÿè½½å‡è¡¡å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563436759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107922,"user_name":"emen","can_delete":false,"product_type":"c1","uid":1106898,"ip_address":"","ucode":"A3C0A2BF95A272","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJrvZAOiahN7YnSviaDANNu1uHIvQEEE8icl9libuibhuIZgEOt28KG2jKYqu6uRNILicibb8jM6icHicUXj0A/132","comment_is_top":false,"comment_ctime":1561634099,"is_pvip":false,"replies":[{"id":"39722","content":"body_filter_by_lua æ‰§è¡Œå¤šæ¬¡æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºå“åº”ä½“å¯èƒ½æ˜¯ chunked è¿”å›çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¦å¯¹å“åº”ä½“æ•´ä½“åŠ å¯†çš„è¯ï¼Œå°±è¦æ”¹ä¸ºä¸€æ¬¡æ€§è¿”å›ï¼Œè€Œä¸æ˜¯ chunked æ¨¡å¼ã€‚","user_name":"ä½œè€…å›å¤","comment_id":107922,"uid":"1017955","ip_address":"","utype":1,"ctime":1562084613,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"18741503283","product_id":100028301,"comment_content":"æ¸©é“­è€å¸ˆï¼Œæ‚¨å¥½ã€‚å­¦ä¹ äº†è¿™ç¯‡æ–‡ç« ä¹‹åï¼Œå¯¹body_filter_by_luaå­˜åœ¨ç–‘é—®è¯·è€å¸ˆè§£æƒ‘ã€‚æ‹Ÿæƒ³æ ¹æ®æ–‡ä¸­æ¡ˆä¾‹å¯¹è¿”å›æŠ¥æ–‡è¿›è¡ŒåŠ å¯†ï¼Œä½†å‘ç°body_filter_by_luaå­˜åœ¨æ‰§è¡Œå¤šæ¬¡çš„æƒ…å†µï¼Œé‡åˆ°æ­¤æƒ…å†µåº”å¦‚ä½•å¤„ç†ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455745,"discussion_content":"body_filter_by_lua æ‰§è¡Œå¤šæ¬¡æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºå“åº”ä½“å¯èƒ½æ˜¯ chunked è¿”å›çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¦å¯¹å“åº”ä½“æ•´ä½“åŠ å¯†çš„è¯ï¼Œå°±è¦æ”¹ä¸ºä¸€æ¬¡æ€§è¿”å›ï¼Œè€Œä¸æ˜¯ chunked æ¨¡å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562084613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068432,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/90/25b6f544.jpg","nickname":"é©¬æ–‡é¾™","note":"","ucode":"679B0F0AB402C7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555369,"discussion_content":"æ¸©é“­è€å¸ˆï¼Œå¦‚ä½•ä¿®æ”¹å“åº”ä½“è¿”å›ä¸æ˜¯chunkedæ¨¡å¼å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646884325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101696,"user_name":"å¾æ°¸å¥","can_delete":false,"product_type":"c1","uid":1188861,"ip_address":"","ucode":"8CAECEDB4F68AD","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/fd/22f45eeb.jpg","comment_is_top":false,"comment_ctime":1559918917,"is_pvip":false,"replies":[{"id":"36651","content":"éœ€è¦ reload","user_name":"ä½œè€…å›å¤","comment_id":101696,"uid":"1017955","ip_address":"","utype":1,"ctime":1559957233,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"18739788101","product_id":100028301,"comment_content":"ngxæ”¹é…ç½®ä¸éœ€è¦é‡å¯å•Šã€‚ã€‚","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453075,"discussion_content":"éœ€è¦ reload","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559957233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043720,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/08/abb7bfe3.jpg","nickname":"å¿˜å½¢é±¼","note":"","ucode":"9290BFE3D7019B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554886,"discussion_content":"reloadä¹Ÿæ˜¯çƒ­éƒ¨ç½²çš„ï¼Œå¯ä»¥ç”¨æ–°é…ç½®æ–‡ä»¶åˆ›å»ºæ–°çš„workerï¼ŒåŒæ—¶ä¼˜é›…åœ°å…³é—­åŸworkerï¼Œä¸åœæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646651050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242091,"user_name":"lidashuang","can_delete":false,"product_type":"c1","uid":1104850,"ip_address":"","ucode":"560ABE8032760E","user_header":"https://static001.geekbang.org/account/avatar/00/10/db/d2/e29f8834.jpg","comment_is_top":false,"comment_ctime":1597588372,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10187522964","product_id":100028301,"comment_content":"luaå¥½å¤„è¯­è¨€å°å·§ï¼Œjsä¼˜åŠ¿æ˜¯ç”Ÿæ€ä¸°å¯Œ","like_count":2},{"had_liked":false,"id":156889,"user_name":"nicknick","can_delete":false,"product_type":"c1","uid":1755306,"ip_address":"","ucode":"E5EA45655DA349","user_header":"","comment_is_top":false,"comment_ctime":1574992289,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10164926881","product_id":100028301,"comment_content":"æ˜¯ä¿¡å·ï¼ˆsignalï¼‰ä¸æ˜¯ä¿¡å·é‡ï¼ˆsemaphoreï¼‰","like_count":2},{"had_liked":false,"id":149010,"user_name":"å¡å¡","can_delete":false,"product_type":"c1","uid":1064855,"ip_address":"","ucode":"E696CC0386FA27","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/97/8d7a6460.jpg","comment_is_top":false,"comment_ctime":1573127086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10163061678","product_id":100028301,"comment_content":"å¯èƒ½æƒ³å¸å¼•æ›´å¤šå¼€å‘è€…ï¼Œå¦‚æœæ¨å¹¿çš„å¥½ï¼Œnode.jsä¼°è®¡æ²¡æˆäº†ï¼","like_count":2},{"had_liked":false,"id":104176,"user_name":"å®ä»”","can_delete":false,"product_type":"c1","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1560675339,"is_pvip":true,"replies":[{"id":"37913","content":"æ˜¯çš„ï¼Œå¤šè°¢æŒ‡æ­£","user_name":"ä½œè€…å›å¤","comment_id":104176,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840319,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"10150609931","product_id":100028301,"comment_content":"apacheå’Œnginxéƒ½æ˜¯å¤šè¿›ç¨‹å§ï¼åªæ˜¯apacheæœ‰é¢„å…ˆå¼€å¯å¤šå°‘ä¸ªè¿›ç¨‹æˆ–è€…åŠ¨æ€forkè¿›ç¨‹","like_count":2,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454159,"discussion_content":"æ˜¯çš„ï¼Œå¤šè°¢æŒ‡æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109133,"user_name":"æ™®ç½—ç±³ä¿®æ–¯","can_delete":false,"product_type":"c1","uid":1394030,"ip_address":"","ucode":"DDA7DE4DE371FC","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/6e/11cf22de.jpg","comment_is_top":false,"comment_ctime":1561968128,"is_pvip":false,"replies":[{"id":"39720","content":"æœ€å¥½ä¸è¦æ€ä¹ˆåšï¼Œè¿™æ ·æ— æ³•å’Œå¼€æºçš„ä¸»çº¿ä¿æŒä¸€è‡´ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æ‰€æœ‰åŠŸèƒ½æ˜¯æ­£å¸¸çš„ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯ç»™å®˜æ–¹æäº¤ PRï¼Œåˆå¹¶åˆ°ä¸»çº¿å»ã€‚","user_name":"ä½œè€…å›å¤","comment_id":109133,"uid":"1017955","ip_address":"","utype":1,"ctime":1562084215,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5856935424","product_id":100028301,"comment_content":"è€å¸ˆï¼Œopenrestyå¯ä»¥åªå‡çº§nginxå—ï¼Œå¯ä»¥ä¸å‡çº§openrestyå§â€¦â€¦å¦‚æœæœ‰ï¼Œè¯·æŒ‡ç‚¹ä¸‹ï¼Œç”Ÿäº§ç¯å¢ƒæœ‰æ¼æ´éœ€è¦æˆ‘ä¿®å¤ä¸‹ï¼Œè°¢è°¢äº†ğŸ™","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456259,"discussion_content":"æœ€å¥½ä¸è¦æ€ä¹ˆåšï¼Œè¿™æ ·æ— æ³•å’Œå¼€æºçš„ä¸»çº¿ä¿æŒä¸€è‡´ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æ‰€æœ‰åŠŸèƒ½æ˜¯æ­£å¸¸çš„ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯ç»™å®˜æ–¹æäº¤ PRï¼Œåˆå¹¶åˆ°ä¸»çº¿å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562084215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104105,"user_name":"nanyun","can_delete":false,"product_type":"c1","uid":1067105,"ip_address":"","ucode":"FF029071ACB041","user_header":"https://static001.geekbang.org/account/avatar/00/10/48/61/803d5bbf.jpg","comment_is_top":false,"comment_ctime":1560653120,"is_pvip":false,"replies":[{"id":"37677","content":"OpenResty å¯ä»¥æ— ç—›çš„æ›¿æ¢ nginxï¼ŒåŒæ—¶æä¾›äº† Lua API æ¥åšåŠ¨æ€çš„æ§åˆ¶ï¼Œè¿™ä¸ªæ˜¯å®ƒæœ€å¤§çš„ä¼˜åŠ¿ã€‚nginx unit æ˜¯ä¸ºäº†å¾®æœåŠ¡å‡ºçš„äº§å“ï¼Œä¸¤ä¸ªæ„Ÿè§‰ä¸åœ¨ä¸€ä¸ªå±‚é¢ä¸Šã€‚","user_name":"ä½œè€…å›å¤","comment_id":104105,"uid":"1017955","ip_address":"","utype":1,"ctime":1560668911,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855620416","product_id":100028301,"comment_content":"ä½ å¥½ï¼Œä¸€ç›´åœ¨å…³æ³¨restyï¼Œæƒ³é—®ä¸€ä¸‹nginxåé¢å‡ºçš„unitï¼Œå’Œå®ƒå¯¹æ¯”æœ‰å“ªäº›ä¼˜åŠ£ç‚¹ã€‚","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454126,"discussion_content":"OpenResty å¯ä»¥æ— ç—›çš„æ›¿æ¢ nginxï¼ŒåŒæ—¶æä¾›äº† Lua API æ¥åšåŠ¨æ€çš„æ§åˆ¶ï¼Œè¿™ä¸ªæ˜¯å®ƒæœ€å¤§çš„ä¼˜åŠ¿ã€‚nginx unit æ˜¯ä¸ºäº†å¾®æœåŠ¡å‡ºçš„äº§å“ï¼Œä¸¤ä¸ªæ„Ÿè§‰ä¸åœ¨ä¸€ä¸ªå±‚é¢ä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560668911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103230,"user_name":"å†²é‡","can_delete":false,"product_type":"c1","uid":1505804,"ip_address":"","ucode":"B65C3C3280493D","user_header":"https://static001.geekbang.org/account/avatar/00/16/fa/0c/ee743364.jpg","comment_is_top":false,"comment_ctime":1560400410,"is_pvip":false,"replies":[{"id":"37346","content":"ä¿ç•™æ—§çš„ master è¿›ç¨‹æ˜¯ä¸ºäº†æ–¹ä¾¿å›æ»šã€‚æ—§çš„ worker è¿›ç¨‹æ˜¯ä¸ä¿ç•™çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":103230,"uid":"1017955","ip_address":"","utype":1,"ctime":1560408271,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855367706","product_id":100028301,"comment_content":"é—®ä¸ªä½çº§çš„é—®é¢˜ï¼šçƒ­å‡çº§çš„æ—¶å€™ï¼Œå·²ç»å»ºç«‹çš„è¿æ¥æ˜¯ç»§ç»­ä¿æŒå—ï¼Ÿæ˜¯ä¸æ˜¯å› æ­¤æ‰ä¿ç•™æ—§è¿›ç¨‹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453796,"discussion_content":"ä¿ç•™æ—§çš„ master è¿›ç¨‹æ˜¯ä¸ºäº†æ–¹ä¾¿å›æ»šã€‚æ—§çš„ worker è¿›ç¨‹æ˜¯ä¸ä¿ç•™çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560408271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102150,"user_name":"life_ç‰›","can_delete":false,"product_type":"c1","uid":1150443,"ip_address":"","ucode":"39E99CD4BFA48C","user_header":"https://static001.geekbang.org/account/avatar/00/11/8d/eb/e98af40f.jpg","comment_is_top":false,"comment_ctime":1560151764,"is_pvip":false,"replies":[{"id":"37357","content":"ä½ æƒ³å®ç°ç±»ä¼¼ cloudflare çš„ Keyless åŠŸèƒ½ï¼Ÿä¸åœ¨ Nginx ä¸­é…ç½®çš„è¯ï¼Œå°±è¦å¢åŠ ä»£ç é€»è¾‘ï¼Œå¹¶åœ¨è¿œç«¯æœåŠ¡å™¨é…ç½®ï¼Œä¸ç„¶ https æ¡æ‰‹å°±å¤±è´¥äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":102150,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410580,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855119060","product_id":100028301,"comment_content":"æˆ‘æœåŠ¡æ˜¯httpsçš„ï¼Œåšåå‘ä»£ç†çš„è¯ï¼Œéœ€è¦åœ¨nginxçš„httpsæ¨¡å—å§ï¼Ÿå¦‚æœä¸åœ¨nginx é‡Œé¢é…ç½®httpsè¯ä¹¦å¦‚ä½•ç”¨httpsçš„è¯·æ±‚è®¿é—®æœåŠ¡ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453281,"discussion_content":"ä½ æƒ³å®ç°ç±»ä¼¼ cloudflare çš„ Keyless åŠŸèƒ½ï¼Ÿä¸åœ¨ Nginx ä¸­é…ç½®çš„è¯ï¼Œå°±è¦å¢åŠ ä»£ç é€»è¾‘ï¼Œå¹¶åœ¨è¿œç«¯æœåŠ¡å™¨é…ç½®ï¼Œä¸ç„¶ https æ¡æ‰‹å°±å¤±è´¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101937,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560062003,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5855029299","product_id":100028301,"comment_content":"å…³äºçœ‹å‡ºopenresty ç‰ˆæœ¬è¶Šæ¥è¶Šå°<br>æ–‡ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯ï¼š<br>æ¯”å¦‚ NGINX åœ¨ 2018 å¹´ 3 æœˆä»½å‘å¸ƒçš„ 1.13.10 ç‰ˆæœ¬ä¸­ï¼Œå¢åŠ äº†å¯¹ gRPC çš„æ”¯æŒï¼Œä½† OpenResty åœ¨ 2019 å¹´ 4 æœˆä»½æ—¶çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 1.13.6.2ï¼Œç”±æ­¤å¯ä»¥æ¨æ–­ OpenResty è¿˜ä¸æ”¯æŒ gRPCã€‚<br><br>æˆ‘æŠŠ1.13.10çœ‹æˆäº†æ˜¯openrestyçš„ç‰ˆæœ¬äº†ğŸ˜‚ <br>ä¸å¥½æ„æ€ï¼Œéº»çƒ¦è€å¸ˆäº†~","like_count":1},{"had_liked":false,"id":101884,"user_name":"å«æˆ‘å›¾å›¾å°±å¯ä»¥äº†","can_delete":false,"product_type":"c1","uid":1179211,"ip_address":"","ucode":"78AD0A45E9E412","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/4b/87219faf.jpg","comment_is_top":false,"comment_ctime":1560012556,"is_pvip":false,"replies":[{"id":"36747","content":"å¤šè°¢æŒ‡æ­£","user_name":"ä½œè€…å›å¤","comment_id":101884,"uid":"1017955","ip_address":"","utype":1,"ctime":1560060896,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854979852","product_id":100028301,"comment_content":"å¥½åƒæœ‰ç‚¹å°é”™è¯¯ï¼Œapacheæ‰æ˜¯é‚£ä¸ªå¤šè¿›ç¨‹çš„ã€‚","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453157,"discussion_content":"å¤šè°¢æŒ‡æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560060896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101782,"user_name":"mrmsl","can_delete":false,"product_type":"c1","uid":1113160,"ip_address":"","ucode":"38BBF13C98985C","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/48/b5a57b72.jpg","comment_is_top":false,"comment_ctime":1559969691,"is_pvip":true,"replies":[{"id":"36748","content":"è‡³å°‘æ–¹å‘æ˜¯å¯¹çš„","user_name":"ä½œè€…å›å¤","comment_id":101782,"uid":"1017955","ip_address":"","utype":1,"ctime":1560060913,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854936987","product_id":100028301,"comment_content":"Nginx NJS å‡ ä¹å°±è¦å˜å¾—è·Ÿ OpenResty å‡ ä¹ä¸€æ ·å•¦ï¼","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453113,"discussion_content":"è‡³å°‘æ–¹å‘æ˜¯å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560060913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101637,"user_name":"çŸ³ä»”","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1559896868,"is_pvip":false,"replies":[{"id":"36656","content":"ç™¾èŠ±é½æ”¾","user_name":"ä½œè€…å›å¤","comment_id":101637,"uid":"1017955","ip_address":"","utype":1,"ctime":1559957803,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854864164","product_id":100028301,"comment_content":"jsæœ‰å¤§æ‰¹çš„è¯­æ³•ç†Ÿæ‚‰ç”¨æˆ·ï¼Œåªè¦èƒ½åŠ›å¤Ÿèƒ½å°±èƒ½å¤§é‡å®è·µ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453046,"discussion_content":"ç™¾èŠ±é½æ”¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559957803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353828,"user_name":"é«˜ç‡•å†›","can_delete":false,"product_type":"c1","uid":1910657,"ip_address":"æ±Ÿè‹","ucode":"AF31DDD0EE08BF","user_header":"https://static001.geekbang.org/account/avatar/00/1d/27/81/27c9d811.jpg","comment_is_top":false,"comment_ctime":1659842493,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659842493","product_id":100028301,"comment_content":"åŠ è§£å¯†çš„é‚£ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ç‚¹åƒnodejsçš„webæ¡†æ¶expressä¸­çš„ä¸­é—´ä»¶æ¨¡å¼","like_count":0},{"had_liked":false,"id":106081,"user_name":"Kinga","can_delete":false,"product_type":"c1","uid":1463405,"ip_address":"","ucode":"E6B24159C5C616","user_header":"https://static001.geekbang.org/account/avatar/00/16/54/6d/53fd4a8c.jpg","comment_is_top":false,"comment_ctime":1561167601,"is_pvip":false,"replies":[{"id":"38905","content":"æˆ‘çš„æ„æ€æ˜¯é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ˜¯ä¸€ä¸ªæ›´é¢‘ç¹çš„æ“ä½œï¼Œè€ŒäºŒè¿›åˆ¶çƒ­å‡çº§å¹¶ä¸é¢‘ç¹ã€‚åº”è¯¥ä¼˜å…ˆå®ç°å‰è€…çš„çƒ­æ›´æ–°ã€‚","user_name":"ä½œè€…å›å¤","comment_id":106081,"uid":"1017955","ip_address":"","utype":1,"ctime":1561551221,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1561167601","product_id":100028301,"comment_content":"äºŒè¿›åˆ¶çƒ­å‡çº§å’Œé…ç½®æ–‡ä»¶reloadæ›´æ–°ï¼Œéƒ½éœ€è¦ç»™masterå‘ä¿¡å·ï¼Œä¸ç†è§£æœ¬æœ«å€’ç½®çš„è¯´æ³•ã€‚ä½œè€…æ˜¯å¸Œæœ›nginxèƒ½å¤Ÿè‡ªåŠ¨æ£€æŸ¥åˆ°é…ç½®æ–‡ä»¶æœ‰å˜æ›´ï¼Œç„¶åè‡ªåŠ¨é‡æ–°åŠ è½½å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454940,"discussion_content":"æˆ‘çš„æ„æ€æ˜¯é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ˜¯ä¸€ä¸ªæ›´é¢‘ç¹çš„æ“ä½œï¼Œè€ŒäºŒè¿›åˆ¶çƒ­å‡çº§å¹¶ä¸é¢‘ç¹ã€‚åº”è¯¥ä¼˜å…ˆå®ç°å‰è€…çš„çƒ­æ›´æ–°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561551221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101693,"user_name":"å°ç¾Š","can_delete":false,"product_type":"c1","uid":1000877,"ip_address":"","ucode":"50239B7052BFD2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epgKOrnIOAjzXJgb0f0ljTZLeqrMXYaHic1MKQnPbAzxSKgYxd7K2DlqRW8SibTkwV2MAUZ4OlgRnNw/132","comment_is_top":false,"comment_ctime":1559917383,"is_pvip":false,"replies":[{"id":"36652","content":"æœç„¶ï¼Œçœ‹æ¥æ˜¯å®˜ç½‘é“¾æ¥å‡ºé—®é¢˜äº†ã€‚ä½ å¯ä»¥è°·æ­Œæœç´¢æ ‡é¢˜æ‰¾ä¸‹å…¶ä»–åœ°æ–¹çš„èµ„æºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1559957355,"ip_address":"","comment_id":101693,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559917383","product_id":100028301,"comment_content":"OpenResty çš„ä½œè€…å¤šå¹´å‰å†™è¿‡ä¸€ä¸ª NGINX æ•™ç¨‹ã€‚è¿™ä¸ªé“¾æ¥ é‡Œé¢çš„ç›®å½•éƒ½æ‰“ä¸å¼€","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453074,"discussion_content":"æœç„¶ï¼Œçœ‹æ¥æ˜¯å®˜ç½‘é“¾æ¥å‡ºé—®é¢˜äº†ã€‚ä½ å¯ä»¥è°·æ­Œæœç´¢æ ‡é¢˜æ‰¾ä¸‹å…¶ä»–åœ°æ–¹çš„èµ„æºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559957355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}