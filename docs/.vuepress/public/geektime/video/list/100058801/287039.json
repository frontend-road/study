{"id":287039,"title":"21 | Flink时间概念","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":250332,"user_name":"geek2020","can_delete":false,"product_type":"c3","uid":2045843,"ip_address":"","ucode":"3E7F7F8D419A75","user_header":"","comment_is_top":false,"comment_ctime":1601027427,"is_pvip":false,"replies":[{"id":92266,"content":"默认ProcessingTime","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1602406503,"ip_address":"","comment_id":250332,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，如果代码中没有使用env.setStreamTimeCharacteristic设置时间，那datastream还会有时间的概念么？比如是否会有个默认的时间类型","like_count":1,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506188,"discussion_content":"默认ProcessingTime","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602406503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254798,"user_name":"小虞","can_delete":false,"product_type":"c3","uid":1402697,"ip_address":"","ucode":"0CD0F62E90DAD8","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/49/da88c745.jpg","comment_is_top":false,"comment_ctime":1603188163,"is_pvip":false,"replies":[{"id":93248,"content":"不太理解你说的null什么情况，以及你这种操作的意义，可以具体一点吗？基于StreamTask线程模型要通过控制信息才能控制线程的，可以往这个方面想想","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603527782,"ip_address":"","comment_id":254798,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"由于业务需要，我在flink算子中使用了wait方法，但是flink抛出了异常，原因是null不能传递给下一个算子。网上找了好久没找到答案，请问老师如何在flink算子中实现线程等待呢，感谢。","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507517,"discussion_content":"不太理解你说的null什么情况，以及你这种操作的意义，可以具体一点吗？基于StreamTask线程模型要通过控制信息才能控制线程的，可以往这个方面想想","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603527782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1402697,"avatar":"https://static001.geekbang.org/account/avatar/00/15/67/49/da88c745.jpg","nickname":"小虞","note":"","ucode":"0CD0F62E90DAD8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318250,"discussion_content":"假如我有2个算子，算子1，算子2。算子1的作用是监听MySQL的表A然后缓存到redis或者某个介质中，算子2的作用是监听MySQL的表B并且做相应的处理后发送到Kafka，算子2在处理过程中会用到表A的内容。在业务上表A对应的记录会先写入MySQL，然后才会有对应的表B的记录。所以在binlog层面上是有序的。但是算子处理的时候，可能算子1处理得慢，这会导致算子2处理表B的记录时，对应的缓存还没有，那么我如何设置算子2等待算子1一段时间呢。第二个问题是，算子1缓存的其实是元数据，数据量很小，我能不能缓存到内存呢。谢谢老师。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603687567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347392,"user_name":"Geek_dc018e","can_delete":false,"product_type":"c3","uid":2866331,"ip_address":"","ucode":"7A414A5829EF99","user_header":"","comment_is_top":false,"comment_ctime":1653986827,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"是内容太多了，老师讲的时候许多内容一语带过。。。。对0基础同学不大友好","like_count":1},{"had_liked":false,"id":349440,"user_name":"伶傅","can_delete":false,"product_type":"c3","uid":3005111,"ip_address":"","ucode":"8ECC7726C6920C","user_header":"https://static001.geekbang.org/account/avatar/00/2d/da/b7/08fb4217.jpg","comment_is_top":false,"comment_ctime":1655970534,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"FlinkKafkaProducer.Semantic.EXACTLY_ONCE 这个在Flink-connection-kafka-0.11中没有啊？这是怎么回事？","like_count":0},{"had_liked":false,"id":283223,"user_name":"Geek_5c44aa","can_delete":false,"product_type":"c3","uid":2428523,"ip_address":"","ucode":"58AB2197E00F8F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erwIgbTd3oy4ESHr6bX9iblONuwgU0MWHcgxndWwNNRQGXlhicduummSiamfTcxHsicicxR4nElxzj280Q/132","comment_is_top":false,"comment_ctime":1615626011,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，如果kafka服务器上的时间与我们本地系统的时间存在几小时的时间差的话，使用EventTime的话会不会有数据进不了timeWindow的情况？","like_count":0},{"had_liked":false,"id":279948,"user_name":"马来酸","can_delete":false,"product_type":"c3","uid":1108744,"ip_address":"","ucode":"2F33F120E76A43","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/08/54fabe39.jpg","comment_is_top":false,"comment_ctime":1614010749,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师请问可以通过assignTimestamps()将数据的eventTime设置为未来的时间吗?\n我使用.flatMap()生成预测数据, 然后.assignTime（）指定eventTime是预测出的时间,\n.flatMap() &#47;&#47; 对于每条轨迹, 预测输出其后续10s的轨迹, 比如0秒来了一条轨迹数据, 预测输出1~10秒的轨迹\n.assignTime() &#47;&#47; 将后续10s轨迹的eventTime设置为刚才预测计算的时间\n.window(1s) &#47;&#47; 比较后续 第11秒时, 12秒....20秒时时的轨迹点是否有距离过近的\n但遇到了WARN AscendingTimestampExtractor [] - Timestamp monotony violated, 1614009701000 &lt; 1614009730000\n请问可以这样写吗, 不行的话要这个逻辑怎么实现好呢，网上找了好久也没有答案。感谢老师！","like_count":0}]}