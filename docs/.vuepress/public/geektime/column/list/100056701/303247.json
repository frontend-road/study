{"id":303247,"title":"32 | Redisä¸»ä»åŒæ­¥ä¸æ•…éšœåˆ‡æ¢ï¼Œæœ‰å“ªäº›å‘ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å¾·é’§ã€‚</p><p>Redisçš„ä¸»ä»åŒæ­¥æœºåˆ¶ä¸ä»…å¯ä»¥è®©ä»åº“æœåŠ¡æ›´å¤šçš„è¯»è¯·æ±‚ï¼Œåˆ†æ‹…ä¸»åº“çš„å‹åŠ›ï¼Œè€Œä¸”è¿˜èƒ½åœ¨ä¸»åº“å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¿›è¡Œä¸»ä»åº“åˆ‡æ¢ï¼Œæä¾›é«˜å¯é æœåŠ¡ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸»ä»æœºåˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è¸©åˆ°ä¸€äº›å‘ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘å°±å‘ä½ ä»‹ç»3ä¸ªå‘ï¼Œåˆ†åˆ«æ˜¯ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œä»¥åŠé…ç½®é¡¹è®¾ç½®å¾—ä¸åˆç†ä»è€Œå¯¼è‡´æœåŠ¡æŒ‚æ‰ã€‚</p><p>ä¸€æ—¦è¸©åˆ°è¿™äº›å‘ï¼Œä¸šåŠ¡åº”ç”¨ä¸ä»…ä¼šè¯»åˆ°é”™è¯¯æ•°æ®ï¼Œè€Œä¸”å¾ˆå¯èƒ½ä¼šå¯¼è‡´Redisæ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…¨é¢åœ°æŒæ¡è¿™äº›å‘çš„æˆå› ï¼Œæå‰å‡†å¤‡ä¸€å¥—è§„é¿æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå³ä½¿ä¸å°å¿ƒæ‰è¿›äº†é™·é˜±é‡Œï¼Œä¹Ÿä¸è¦æ‹…å¿ƒï¼Œæˆ‘è¿˜ä¼šç»™ä½ ä»‹ç»ç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªå‘ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚</p><h2>ä¸»ä»æ•°æ®ä¸ä¸€è‡´</h2><p>ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œå°±æ˜¯æŒ‡å®¢æˆ·ç«¯ä»ä»åº“ä¸­è¯»å–åˆ°çš„å€¼å’Œä¸»åº“ä¸­çš„æœ€æ–°å€¼å¹¶ä¸ä¸€è‡´ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸»ä»åº“ä¹‹å‰ä¿å­˜çš„ç”¨æˆ·å¹´é¾„å€¼æ˜¯19ï¼Œä½†æ˜¯ä¸»åº“æ¥æ”¶åˆ°äº†ä¿®æ”¹å‘½ä»¤ï¼Œå·²ç»æŠŠè¿™ä¸ªæ•°æ®æ›´æ–°ä¸º20äº†ï¼Œä½†æ˜¯ï¼Œä»åº“ä¸­çš„å€¼ä»ç„¶æ˜¯19ã€‚é‚£ä¹ˆï¼Œå¦‚æœå®¢æˆ·ç«¯ä»ä»åº“ä¸­è¯»å–ç”¨æˆ·å¹´é¾„å€¼ï¼Œå°±ä¼šè¯»åˆ°æ—§å€¼ã€‚</p><p>é‚£ä¸ºå•¥ä¼šå‡ºç°è¿™ä¸ªå‘å‘¢ï¼Ÿå…¶å®è¿™æ˜¯å› ä¸º<strong>ä¸»ä»åº“é—´çš„å‘½ä»¤å¤åˆ¶æ˜¯å¼‚æ­¥è¿›è¡Œçš„</strong>ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸»ä»åº“å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»åº“æ”¶åˆ°æ–°çš„å†™å‘½ä»¤åï¼Œä¼šå‘é€ç»™ä»åº“ã€‚ä½†æ˜¯ï¼Œä¸»åº“å¹¶ä¸ä¼šç­‰åˆ°ä»åº“å®é™…æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸»åº“è‡ªå·±åœ¨æœ¬åœ°æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ç»“æœäº†ã€‚å¦‚æœä»åº“è¿˜æ²¡æœ‰æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ï¼Œä¸»ä»åº“é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</p><!-- [[[read_end]]] --><p>é‚£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä»åº“ä¼šæ»åæ‰§è¡ŒåŒæ­¥å‘½ä»¤å‘¢ï¼Ÿå…¶å®ï¼Œè¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚</p><p>ä¸€æ–¹é¢ï¼Œä¸»ä»åº“é—´çš„ç½‘ç»œå¯èƒ½ä¼šæœ‰ä¼ è¾“å»¶è¿Ÿï¼Œæ‰€ä»¥ä»åº“ä¸èƒ½åŠæ—¶åœ°æ”¶åˆ°ä¸»åº“å‘é€çš„å‘½ä»¤ï¼Œä»åº“ä¸Šæ‰§è¡ŒåŒæ­¥å‘½ä»¤çš„æ—¶é—´å°±ä¼šè¢«å»¶åã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå³ä½¿ä»åº“åŠæ—¶æ”¶åˆ°äº†ä¸»åº“çš„å‘½ä»¤ï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¼šå› ä¸ºæ­£åœ¨å¤„ç†å…¶å®ƒå¤æ‚åº¦é«˜çš„å‘½ä»¤ï¼ˆä¾‹å¦‚é›†åˆæ“ä½œå‘½ä»¤ï¼‰è€Œé˜»å¡ã€‚æ­¤æ—¶ï¼Œä»åº“éœ€è¦å¤„ç†å®Œå½“å‰çš„å‘½ä»¤ï¼Œæ‰èƒ½æ‰§è¡Œä¸»åº“å‘é€çš„å‘½ä»¤æ“ä½œï¼Œè¿™å°±ä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚è€Œåœ¨ä¸»åº“å‘½ä»¤è¢«æ»åå¤„ç†çš„è¿™æ®µæ—¶é—´å†…ï¼Œä¸»åº“æœ¬èº«å¯èƒ½åˆæ‰§è¡Œäº†æ–°çš„å†™æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“é—´çš„æ•°æ®ä¸ä¸€è‡´ç¨‹åº¦å°±ä¼šè¿›ä¸€æ­¥åŠ å‰§ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåº”å¯¹å‘¢ï¼Ÿæˆ‘ç»™ä½ æä¾›ä¸¤ç§æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œ<strong>åœ¨ç¡¬ä»¶ç¯å¢ƒé…ç½®æ–¹é¢ï¼Œæˆ‘ä»¬è¦å°½é‡ä¿è¯ä¸»ä»åº“é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½</strong>ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦é¿å…æŠŠä¸»ä»åº“éƒ¨ç½²åœ¨ä¸åŒçš„æœºæˆ¿ï¼Œæˆ–è€…æ˜¯é¿å…æŠŠç½‘ç»œé€šä¿¡å¯†é›†çš„åº”ç”¨ï¼ˆä¾‹å¦‚æ•°æ®åˆ†æåº”ç”¨ï¼‰å’ŒRedisä¸»ä»åº“éƒ¨ç½²åœ¨ä¸€èµ·ã€‚</p><p>å¦å¤–ï¼Œ<strong>æˆ‘ä»¬è¿˜å¯ä»¥å¼€å‘ä¸€ä¸ªå¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»åº“é—´çš„å¤åˆ¶è¿›åº¦</strong>ã€‚</p><p>å› ä¸ºRedisçš„INFO replicationå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»åº“æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆmaster_repl_offsetï¼‰å’Œä»åº“å¤åˆ¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆslave_repl_offsetï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å‘ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œå…ˆç”¨INFO replicationå‘½ä»¤æŸ¥åˆ°ä¸»ã€ä»åº“çš„è¿›åº¦ï¼Œç„¶åï¼Œæˆ‘ä»¬ç”¨master_repl_offsetå‡å»slave_repl_offsetï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°ä»åº“å’Œä¸»åº“é—´çš„å¤åˆ¶è¿›åº¦å·®å€¼äº†ã€‚</p><p>å¦‚æœæŸä¸ªä»åº“çš„è¿›åº¦å·®å€¼å¤§äºæˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯ä¸å†å’Œè¿™ä¸ªä»åº“è¿æ¥è¿›è¡Œæ•°æ®è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œä¸ºäº†é¿å…å‡ºç°å®¢æˆ·ç«¯å’Œæ‰€æœ‰ä»åº“éƒ½ä¸èƒ½è¿æ¥çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤åˆ¶è¿›åº¦å·®å€¼çš„é˜ˆå€¼è®¾ç½®å¾—å¤§ä¸€äº›ã€‚</p><p>æˆ‘ä»¬åœ¨åº”ç”¨Redisæ—¶ï¼Œå¯ä»¥å‘¨æœŸæ€§åœ°è¿è¡Œè¿™ä¸ªæµç¨‹æ¥ç›‘æµ‹ä¸»ä»åº“é—´çš„ä¸ä¸€è‡´æƒ…å†µã€‚ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ç”»äº†ä¸€å¼ æµç¨‹å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3a/05/3a89935297fb5b76bfc4808128aaf905.jpg?wh=3000*2048\" alt=\"\"></p><p>å½“ç„¶ï¼Œç›‘æ§ç¨‹åºå¯ä»¥ä¸€ç›´ç›‘æ§ç€ä»åº“çš„å¤åˆ¶è¿›åº¦ï¼Œå½“ä»åº“çš„å¤åˆ¶è¿›åº¦åˆèµ¶ä¸Šä¸»åº“æ—¶ï¼Œæˆ‘ä»¬å°±å…è®¸å®¢æˆ·ç«¯å†æ¬¡è·Ÿè¿™äº›ä»åº“è¿æ¥ã€‚</p><p>é™¤äº†ä¸»ä»æ•°æ®ä¸ä¸€è‡´ä»¥å¤–ï¼Œæˆ‘ä»¬æœ‰æ—¶è¿˜ä¼šåœ¨ä»åº“ä¸­è¯»åˆ°è¿‡æœŸçš„æ•°æ®ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†åˆ†æä¸€ä¸‹ã€‚</p><h2>è¯»å–è¿‡æœŸæ•°æ®</h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Redisä¸»ä»é›†ç¾¤æ—¶ï¼Œæœ‰æ—¶ä¼šè¯»åˆ°è¿‡æœŸæ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ•°æ®Xçš„è¿‡æœŸæ—¶é—´æ˜¯202010240900ï¼Œä½†æ˜¯å®¢æˆ·ç«¯åœ¨202010240910æ—¶ï¼Œä»ç„¶å¯ä»¥ä»ä»åº“ä¸­è¯»åˆ°æ•°æ®Xã€‚ä¸€ä¸ªæ•°æ®è¿‡æœŸåï¼Œåº”è¯¥æ˜¯è¢«åˆ é™¤çš„ï¼Œå®¢æˆ·ç«¯ä¸èƒ½å†è¯»å–åˆ°è¯¥æ•°æ®ï¼Œä½†æ˜¯ï¼ŒRedisä¸ºä»€ä¹ˆè¿˜èƒ½åœ¨ä»åº“ä¸­è¯»åˆ°è¿‡æœŸçš„æ•°æ®å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œè¿™æ˜¯ç”±Redisçš„è¿‡æœŸæ•°æ®åˆ é™¤ç­–ç•¥å¼•èµ·çš„ã€‚æˆ‘æ¥ç»™ä½ å…·ä½“è§£é‡Šä¸‹ã€‚</p><p><strong>RedisåŒæ—¶ä½¿ç”¨äº†ä¸¤ç§ç­–ç•¥æ¥åˆ é™¤è¿‡æœŸçš„æ•°æ®ï¼Œåˆ†åˆ«æ˜¯æƒ°æ€§åˆ é™¤ç­–ç•¥å’Œå®šæœŸåˆ é™¤ç­–ç•¥</strong>ã€‚</p><p>å…ˆè¯´æƒ°æ€§åˆ é™¤ç­–ç•¥ã€‚å½“ä¸€ä¸ªæ•°æ®çš„è¿‡æœŸæ—¶é—´åˆ°äº†ä»¥åï¼Œå¹¶ä¸ä¼šç«‹å³åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ç­‰åˆ°å†æœ‰è¯·æ±‚æ¥è¯»å†™è¿™ä¸ªæ•°æ®æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç°æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œå†åˆ é™¤è¿™ä¸ªæ•°æ®ã€‚</p><p>è¿™ä¸ªç­–ç•¥çš„å¥½å¤„æ˜¯å°½é‡å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUèµ„æºçš„ä½¿ç”¨ï¼Œå¯¹äºç”¨ä¸åˆ°çš„æ•°æ®ï¼Œå°±ä¸å†æµªè´¹æ—¶é—´è¿›è¡Œæ£€æŸ¥å’Œåˆ é™¤äº†ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªç­–ç•¥ä¼šå¯¼è‡´å¤§é‡å·²ç»è¿‡æœŸçš„æ•°æ®ç•™å­˜åœ¨å†…å­˜ä¸­ï¼Œå ç”¨è¾ƒå¤šçš„å†…å­˜èµ„æºã€‚æ‰€ä»¥ï¼ŒRedisåœ¨ä½¿ç”¨è¿™ä¸ªç­–ç•¥çš„åŒæ—¶ï¼Œè¿˜ä½¿ç”¨äº†ç¬¬äºŒç§ç­–ç•¥ï¼šå®šæœŸåˆ é™¤ç­–ç•¥ã€‚</p><p>å®šæœŸåˆ é™¤ç­–ç•¥æ˜¯æŒ‡ï¼ŒRedisæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤100msï¼‰ï¼Œå°±ä¼šéšæœºé€‰å‡ºä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œæ£€æŸ¥å®ƒä»¬æ˜¯å¦è¿‡æœŸï¼Œå¹¶æŠŠå…¶ä¸­è¿‡æœŸçš„æ•°æ®åˆ é™¤ï¼Œè¿™æ ·å°±å¯ä»¥åŠæ—¶é‡Šæ”¾ä¸€äº›å†…å­˜ã€‚</p><p>æ¸…æ¥šäº†è¿™ä¸¤ä¸ªåˆ é™¤ç­–ç•¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒä»¬ä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¯»å–åˆ°è¿‡æœŸæ•°æ®ã€‚</p><p>é¦–å…ˆï¼Œè™½ç„¶å®šæœŸåˆ é™¤ç­–ç•¥å¯ä»¥é‡Šæ”¾ä¸€äº›å†…å­˜ï¼Œä½†æ˜¯ï¼ŒRedisä¸ºäº†é¿å…è¿‡å¤šåˆ é™¤æ“ä½œå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œæ¯æ¬¡éšæœºæ£€æŸ¥æ•°æ®çš„æ•°é‡å¹¶ä¸å¤šã€‚å¦‚æœè¿‡æœŸæ•°æ®å¾ˆå¤šï¼Œå¹¶ä¸”ä¸€ç›´æ²¡æœ‰å†è¢«è®¿é—®çš„è¯ï¼Œè¿™äº›æ•°æ®å°±ä¼šç•™å­˜åœ¨Rediså®ä¾‹ä¸­ã€‚ä¸šåŠ¡åº”ç”¨ä¹‹æ‰€ä»¥ä¼šè¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œè¿™äº›ç•™å­˜æ•°æ®å°±æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚</p><p>å…¶æ¬¡ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å®ç°åï¼Œæ•°æ®åªæœ‰è¢«å†æ¬¡è®¿é—®æ—¶ï¼Œæ‰ä¼šè¢«å®é™…åˆ é™¤ã€‚å¦‚æœå®¢æˆ·ç«¯ä»ä¸»åº“ä¸Šè¯»å–ç•™å­˜çš„è¿‡æœŸæ•°æ®ï¼Œä¸»åº“ä¼šè§¦å‘åˆ é™¤æ“ä½œï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šè¯»åˆ°è¿‡æœŸæ•°æ®ã€‚ä½†æ˜¯ï¼Œä»åº“æœ¬èº«ä¸ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨ä»åº“ä¸­è®¿é—®ç•™å­˜çš„è¿‡æœŸæ•°æ®ï¼Œä»åº“å¹¶ä¸ä¼šè§¦å‘æ•°æ®åˆ é™¤ã€‚é‚£ä¹ˆï¼Œä»åº“ä¼šç»™å®¢æˆ·ç«¯è¿”å›è¿‡æœŸæ•°æ®å—ï¼Ÿ</p><p>è¿™å°±å’Œä½ ä½¿ç”¨çš„Redisç‰ˆæœ¬æœ‰å…³äº†ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Redis 3.2ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆï¼Œä»åº“åœ¨æœåŠ¡è¯»è¯·æ±‚æ—¶ï¼Œå¹¶ä¸ä¼šåˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè€Œæ˜¯ä¼šè¿”å›è¿‡æœŸæ•°æ®ã€‚åœ¨3.2ç‰ˆæœ¬åï¼ŒRedisåšäº†æ”¹è¿›ï¼Œå¦‚æœè¯»å–çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œä»åº“è™½ç„¶ä¸ä¼šåˆ é™¤ï¼Œä½†æ˜¯ä¼šè¿”å›ç©ºå€¼ï¼Œè¿™å°±é¿å…äº†å®¢æˆ·ç«¯è¯»åˆ°è¿‡æœŸæ•°æ®ã€‚æ‰€ä»¥ï¼Œ<strong>åœ¨åº”ç”¨ä¸»ä»é›†ç¾¤æ—¶ï¼Œå°½é‡ä½¿ç”¨Redis 3.2åŠä»¥ä¸Šç‰ˆæœ¬</strong>ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œåªè¦ä½¿ç”¨äº†Redis 3.2åçš„ç‰ˆæœ¬ï¼Œå°±ä¸ä¼šè¯»åˆ°è¿‡æœŸæ•°æ®äº†å—ï¼Ÿå…¶å®è¿˜æ˜¯ä¼šçš„ã€‚</p><p>ä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Ÿè¿™è·ŸRedisç”¨äºè®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤æœ‰å…³ç³»ï¼Œæœ‰äº›å‘½ä»¤ç»™æ•°æ®è®¾ç½®çš„è¿‡æœŸæ—¶é—´åœ¨ä»åº“ä¸Šå¯èƒ½ä¼šè¢«å»¶åï¼Œå¯¼è‡´åº”è¯¥è¿‡æœŸçš„æ•°æ®åˆåœ¨ä»åº“ä¸Šè¢«è¯»å–åˆ°äº†ï¼Œæˆ‘æ¥ç»™ä½ å…·ä½“è§£é‡Šä¸‹ã€‚</p><p>æˆ‘å…ˆç»™ä½ ä»‹ç»ä¸‹è¿™äº›å‘½ä»¤ã€‚è®¾ç½®æ•°æ®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ä¸€å…±æœ‰4ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬åˆ†æˆä¸¤ç±»ï¼š</p><ul>\n<li>EXPIREå’ŒPEXPIREï¼šå®ƒä»¬ç»™æ•°æ®è®¾ç½®çš„æ˜¯<strong>ä»å‘½ä»¤æ‰§è¡Œæ—¶å¼€å§‹è®¡ç®—çš„å­˜æ´»æ—¶é—´</strong>ï¼›</li>\n<li>EXPIREATå’ŒPEXPIREATï¼š<strong>å®ƒä»¬ä¼šç›´æ¥æŠŠæ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå…·ä½“çš„ä¸€ä¸ªæ—¶é—´ç‚¹</strong>ã€‚</li>\n</ul><p>è¿™4ä¸ªå‘½ä»¤çš„å‚æ•°å’Œå«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/06/e1/06e8cb2f1af320d450a29326a876f4e1.jpg?wh=2967*920\" alt=\"\"></p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç»™ä½ ä¸¾ä¸¤ä¸ªä¾‹å­ã€‚</p><p>ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯ä½¿ç”¨EXPIREå‘½ä»¤ï¼Œå½“æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å°±æŠŠtestkeyçš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º60såã€‚</p><pre><code>EXPIRE testkey 60\n</code></pre><p>ç¬¬äºŒä¸ªä¾‹å­æ˜¯ä½¿ç”¨EXPIREATå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥è®©testkeyåœ¨2020å¹´10æœˆ24æ—¥ä¸Šåˆ9ç‚¹è¿‡æœŸï¼Œå‘½ä»¤ä¸­çš„1603501200å°±æ˜¯ä»¥ç§’æ•°æ—¶é—´æˆ³è¡¨ç¤ºçš„10æœˆ24æ—¥ä¸Šåˆ9ç‚¹ã€‚</p><pre><code>EXPIREAT testkey 1603501200\n</code></pre><p>å¥½äº†ï¼ŒçŸ¥é“äº†è¿™äº›å‘½ä»¤ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›å‘½ä»¤å¦‚ä½•å¯¼è‡´è¯»åˆ°è¿‡æœŸæ•°æ®ã€‚</p><p>å½“ä¸»ä»åº“å…¨é‡åŒæ­¥æ—¶ï¼Œå¦‚æœä¸»åº“æ¥æ”¶åˆ°äº†ä¸€æ¡EXPIREå‘½ä»¤ï¼Œé‚£ä¹ˆï¼Œä¸»åº“ä¼šç›´æ¥æ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚è¿™æ¡å‘½ä»¤ä¼šåœ¨å…¨é‡åŒæ­¥å®Œæˆåï¼Œå‘ç»™ä»åº“æ‰§è¡Œã€‚è€Œä»åº“åœ¨æ‰§è¡Œæ—¶ï¼Œå°±ä¼šåœ¨å½“å‰æ—¶é—´çš„åŸºç¡€ä¸ŠåŠ ä¸Šæ•°æ®çš„å­˜æ´»æ—¶é—´ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä»åº“ä¸Šæ•°æ®çš„è¿‡æœŸæ—¶é—´å°±ä¼šæ¯”ä¸»åº“ä¸Šå»¶åäº†ã€‚</p><p>è¿™ä¹ˆè¯´å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘å†ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾å½“å‰æ—¶é—´æ˜¯2020å¹´10æœˆ24æ—¥ä¸Šåˆ9ç‚¹ï¼Œä¸»ä»åº“æ­£åœ¨åŒæ­¥ï¼Œä¸»åº“æ”¶åˆ°äº†ä¸€æ¡å‘½ä»¤ï¼šEXPIRE testkey 60ï¼Œè¿™å°±è¡¨ç¤ºï¼Œtestkeyçš„è¿‡æœŸæ—¶é—´å°±æ˜¯24æ—¥ä¸Šåˆ9ç‚¹1åˆ†ï¼Œä¸»åº“ç›´æ¥æ‰§è¡Œäº†è¿™æ¡å‘½ä»¤ã€‚</p><p>ä½†æ˜¯ï¼Œä¸»ä»åº“å…¨é‡åŒæ­¥èŠ±è´¹äº†2åˆ†é’Ÿæ‰å®Œæˆã€‚ç­‰ä»åº“å¼€å§‹æ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼Œæ—¶é—´å·²ç»æ˜¯9ç‚¹2åˆ†äº†ã€‚è€ŒEXPIREå‘½ä»¤æ˜¯æŠŠtestkeyçš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå½“å‰æ—¶é—´çš„60såï¼Œä¹Ÿå°±æ˜¯9ç‚¹3åˆ†ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨9ç‚¹2åˆ†30ç§’æ—¶åœ¨ä»åº“ä¸Šè¯»å–testkeyï¼Œä»ç„¶å¯ä»¥è¯»åˆ°testkeyçš„å€¼ã€‚ä½†æ˜¯ï¼Œtestkeyå®é™…ä¸Šå·²ç»è¿‡æœŸäº†ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ç»™ä½ çš„å»ºè®®æ˜¯ï¼Œ<strong>åœ¨ä¸šåŠ¡åº”ç”¨ä¸­ä½¿ç”¨EXPIREAT/PEXPIREATå‘½ä»¤ï¼ŒæŠŠæ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå…·ä½“çš„æ—¶é—´ç‚¹ï¼Œé¿å…è¯»åˆ°è¿‡æœŸæ•°æ®ã€‚</strong></p><p>å¥½äº†ï¼Œæˆ‘ä»¬å…ˆç®€å•åœ°æ€»ç»“ä¸‹åˆšåˆšå­¦è¿‡çš„è¿™ä¸¤ä¸ªå…¸å‹çš„å‘ã€‚</p><ul>\n<li>ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚Redisé‡‡ç”¨çš„æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œæ‰€ä»¥æ— æ³•å®ç°å¼ºä¸€è‡´æ€§ä¿è¯ï¼ˆä¸»ä»æ•°æ®æ—¶æ—¶åˆ»åˆ»ä¿æŒä¸€è‡´ï¼‰ï¼Œæ•°æ®ä¸ä¸€è‡´æ˜¯éš¾ä»¥é¿å…çš„ã€‚æˆ‘ç»™ä½ æä¾›äº†åº”å¯¹æ–¹æ³•ï¼šä¿è¯è‰¯å¥½ç½‘ç»œç¯å¢ƒï¼Œä»¥åŠä½¿ç”¨ç¨‹åºç›‘æ§ä»åº“å¤åˆ¶è¿›åº¦ï¼Œä¸€æ—¦ä»åº“å¤åˆ¶è¿›åº¦è¶…è¿‡é˜ˆå€¼ï¼Œä¸è®©å®¢æˆ·ç«¯è¿æ¥ä»åº“ã€‚</li>\n<li>å¯¹äºè¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œè¿™æ˜¯å¯ä»¥æå‰è§„é¿çš„ï¼Œä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œä½¿ç”¨Redis 3.2åŠä»¥ä¸Šç‰ˆæœ¬ï¼›å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨EXPIREAT/PEXPIREATå‘½ä»¤è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…ä»åº“ä¸Šçš„æ•°æ®è¿‡æœŸæ—¶é—´æ»åã€‚ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸‹ï¼Œ<strong>å› ä¸ºEXPIREAT/PEXPIREATè®¾ç½®çš„æ˜¯æ—¶é—´ç‚¹ï¼Œæ‰€ä»¥ï¼Œä¸»ä»èŠ‚ç‚¹ä¸Šçš„æ—¶é’Ÿè¦ä¿æŒä¸€è‡´ï¼Œå…·ä½“çš„åšæ³•æ˜¯ï¼Œè®©ä¸»ä»èŠ‚ç‚¹å’Œç›¸åŒçš„NTPæœåŠ¡å™¨ï¼ˆæ—¶é—´æœåŠ¡å™¨ï¼‰è¿›è¡Œæ—¶é’ŸåŒæ­¥</strong>ã€‚</li>\n</ul><p>é™¤äº†åŒæ­¥è¿‡ç¨‹ä¸­æœ‰å‘ä»¥å¤–ï¼Œä¸»ä»æ•…éšœåˆ‡æ¢æ—¶ï¼Œä¹Ÿä¼šå› ä¸ºé…ç½®ä¸åˆç†è€Œè¸©å‘ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å‘ä½ ä»‹ç»ä¸¤ä¸ªæœåŠ¡æŒ‚æ‰çš„æƒ…å†µï¼Œéƒ½æ˜¯ç”±ä¸åˆç†é…ç½®é¡¹å¼•èµ·çš„ã€‚</p><h2>ä¸åˆç†é…ç½®é¡¹å¯¼è‡´çš„æœåŠ¡æŒ‚æ‰</h2><p>è¿™é‡Œæ¶‰åŠåˆ°çš„é…ç½®é¡¹æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯<strong>protected-modeå’Œcluster-node-timeoutã€‚</strong></p><p><strong>1.protected-mode é…ç½®é¡¹</strong></p><p>è¿™ä¸ªé…ç½®é¡¹çš„ä½œç”¨æ˜¯é™å®šå“¨å…µå®ä¾‹èƒ½å¦è¢«å…¶ä»–æœåŠ¡å™¨è®¿é—®ã€‚å½“è¿™ä¸ªé…ç½®é¡¹è®¾ç½®ä¸ºyesæ—¶ï¼Œå“¨å…µå®ä¾‹åªèƒ½åœ¨éƒ¨ç½²çš„æœåŠ¡å™¨æœ¬åœ°è¿›è¡Œè®¿é—®ã€‚å½“è®¾ç½®ä¸ºnoæ—¶ï¼Œå…¶ä»–æœåŠ¡å™¨ä¹Ÿå¯ä»¥è®¿é—®è¿™ä¸ªå“¨å…µå®ä¾‹ã€‚</p><p>æ­£å› ä¸ºè¿™æ ·ï¼Œå¦‚æœprotected-modeè¢«è®¾ç½®ä¸ºyesï¼Œè€Œå…¶ä½™å“¨å…µå®ä¾‹éƒ¨ç½²åœ¨å…¶å®ƒæœåŠ¡å™¨ï¼Œé‚£ä¹ˆï¼Œè¿™äº›å“¨å…µå®ä¾‹é—´å°±æ— æ³•é€šä¿¡ã€‚å½“ä¸»åº“æ•…éšœæ—¶ï¼Œå“¨å…µæ— æ³•åˆ¤æ–­ä¸»åº“ä¸‹çº¿ï¼Œä¹Ÿæ— æ³•è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼Œæœ€ç»ˆRedisæœåŠ¡ä¸å¯ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸»ä»é›†ç¾¤æ—¶ï¼Œè¦æ³¨æ„å°†protected-mode é…ç½®é¡¹è®¾ç½®ä¸ºnoï¼Œå¹¶ä¸”å°†bindé…ç½®é¡¹è®¾ç½®ä¸ºå…¶å®ƒå“¨å…µå®ä¾‹çš„IPåœ°å€ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰åœ¨bindä¸­è®¾ç½®äº†IPåœ°å€çš„å“¨å…µï¼Œæ‰å¯ä»¥è®¿é—®å½“å‰å®ä¾‹ï¼Œæ—¢ä¿è¯äº†å®ä¾‹é—´èƒ½å¤Ÿé€šä¿¡è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼Œä¹Ÿä¿è¯äº†å“¨å…µçš„å®‰å…¨æ€§ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å°ä¾‹å­ã€‚å¦‚æœè®¾ç½®äº†ä¸‹é¢çš„é…ç½®é¡¹ï¼Œé‚£ä¹ˆï¼Œéƒ¨ç½²åœ¨192.168.10.3/4/5è¿™ä¸‰å°æœåŠ¡å™¨ä¸Šçš„å“¨å…µå®ä¾‹å°±å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚</p><pre><code>protected-mode no\nbind 192.168.10.3 192.168.10.4 192.168.10.5\n</code></pre><p><strong>2.cluster-node-timeouté…ç½®é¡¹</strong></p><p><strong>è¿™ä¸ªé…ç½®é¡¹è®¾ç½®äº†Redis Clusterä¸­å®ä¾‹å“åº”å¿ƒè·³æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´</strong>ã€‚</p><p>å½“æˆ‘ä»¬åœ¨Redis Clusteré›†ç¾¤ä¸­ä¸ºæ¯ä¸ªå®ä¾‹é…ç½®äº†â€œä¸€ä¸»ä¸€ä»â€æ¨¡å¼æ—¶ï¼Œå¦‚æœä¸»å®ä¾‹å‘ç”Ÿæ•…éšœï¼Œä»å®ä¾‹ä¼šåˆ‡æ¢ä¸ºä¸»å®ä¾‹ï¼Œå—ç½‘ç»œå»¶è¿Ÿå’Œåˆ‡æ¢æ“ä½œæ‰§è¡Œçš„å½±å“ï¼Œåˆ‡æ¢æ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œå°±ä¼šå¯¼è‡´å®ä¾‹çš„å¿ƒè·³è¶…æ—¶ï¼ˆè¶…å‡ºcluster-node-timeoutï¼‰ã€‚å®ä¾‹è¶…æ—¶åï¼Œå°±ä¼šè¢«Redis Clusteråˆ¤æ–­ä¸ºå¼‚å¸¸ã€‚è€ŒRedis Clusteræ­£å¸¸è¿è¡Œçš„æ¡ä»¶å°±æ˜¯ï¼Œæœ‰åŠæ•°ä»¥ä¸Šçš„å®ä¾‹éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæ‰§è¡Œä¸»ä»åˆ‡æ¢çš„å®ä¾‹è¶…è¿‡åŠæ•°ï¼Œè€Œä¸»ä»åˆ‡æ¢æ—¶é—´åˆè¿‡é•¿çš„è¯ï¼Œå°±å¯èƒ½æœ‰åŠæ•°ä»¥ä¸Šçš„å®ä¾‹å¿ƒè·³è¶…æ—¶ï¼Œä»è€Œå¯èƒ½å¯¼è‡´æ•´ä¸ªé›†ç¾¤æŒ‚æ‰ã€‚æ‰€ä»¥ï¼Œ<strong>æˆ‘å»ºè®®ä½ å°†cluster-node-timeoutè°ƒå¤§äº›ï¼ˆä¾‹å¦‚10åˆ°20ç§’ï¼‰</strong>ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Redisä¸»ä»åº“åŒæ­¥æ—¶å¯èƒ½å‡ºç°çš„3ä¸ªå‘ï¼Œåˆ†åˆ«æ˜¯ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€è¯»å–åˆ°è¿‡æœŸæ•°æ®å’Œä¸åˆç†é…ç½®é¡¹å¯¼è‡´æœåŠ¡æŒ‚æ‰ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ æŒæ¡ï¼Œæˆ‘æŠŠè¿™äº›å‘çš„æˆå› å’Œè§£å†³æ–¹æ³•æ±‡æ€»åœ¨ä¸‹é¢çš„è¿™å¼ è¡¨ä¸­ï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9f/93/9fb7a033987c7b5edc661f4de58ef093.jpg?wh=2788*1155\" alt=\"\"></p><p>æœ€åï¼Œå…³äºä¸»ä»åº“æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘è¿˜æƒ³å†ç»™ä½ æä¸€ä¸ªå°å»ºè®®ï¼šRedisä¸­çš„slave-serve-stale-dataé…ç½®é¡¹è®¾ç½®äº†ä»åº“èƒ½å¦å¤„ç†æ•°æ®è¯»å†™å‘½ä»¤ï¼Œä½ å¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºnoã€‚è¿™æ ·ä¸€æ¥ï¼Œä»åº“åªèƒ½æœåŠ¡INFOã€SLAVEOFå‘½ä»¤ï¼Œè¿™å°±å¯ä»¥é¿å…åœ¨ä»åº“ä¸­è¯»åˆ°ä¸ä¸€è‡´çš„æ•°æ®äº†ã€‚</p><p>ä¸è¿‡ï¼Œä½ è¦æ³¨æ„ä¸‹è¿™ä¸ªé…ç½®é¡¹å’Œslave-read-onlyçš„åŒºåˆ«ï¼Œslave-read-onlyæ˜¯è®¾ç½®ä»åº“èƒ½å¦å¤„ç†å†™å‘½ä»¤ï¼Œslave-read-onlyè®¾ç½®ä¸ºyesæ—¶ï¼Œä»åº“åªèƒ½å¤„ç†è¯»è¯·æ±‚ï¼Œæ— æ³•å¤„ç†å†™è¯·æ±‚ï¼Œä½ å¯ä¸è¦ææ··äº†ã€‚</p><h2>æ¯è¯¾ä¸€é—®</h2><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ç»™ä½ æä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠslave-read-onlyè®¾ç½®ä¸ºnoï¼Œè®©ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤æ•°æ®ï¼Œä»¥æ­¤æ¥é¿å…è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œä½ è§‰å¾—ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":258022,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1604247194,"is_pvip":true,"replies":[{"id":"94184","content":"æ„Ÿè°¢KaitoåŒå­¦çš„å›å¤å’Œè¯¦ç»†åˆ†æï¼å¾ˆèµï¼<br><br>æˆ‘ä¹Ÿè§£é‡Šä¸‹ï¼Œåˆ°æ—¶å‡ºè¿™é“é¢˜çš„ä¸€ä¸ªè€ƒè™‘å‡ºå‘ç‚¹ã€‚<br><br>è¿™é“é¢˜æˆ‘å…¶å®æ˜¯æƒ³é—®å¤§å®¶ï¼Œå‡è®¾ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤è¿‡æœŸæ•°æ®çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚å…¶å®ï¼Œæ˜¯æƒ³æé†’ä¸‹åŒå­¦ä»¬ï¼Œä¸»ä»å¤åˆ¶ä¸­çš„å¢åˆ æ”¹éƒ½éœ€è¦åœ¨ä¸»åº“æ‰§è¡Œï¼Œå³ä½¿ä»åº“èƒ½åšåˆ é™¤ï¼Œä¹Ÿä¸è¦åœ¨ä»åº“åˆ é™¤ã€‚å¦åˆ™ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸»ä»åº“ä¸Šéƒ½èƒ½åšå†™æ“ä½œçš„è¯ï¼Œä¸»ä»åº“ä¸Šæœ‰a:stockçš„é”®ï¼Œå®¢æˆ·ç«¯Aç»™ä¸»åº“å‘é€ä¸€ä¸ªSETå‘½ä»¤ï¼Œä¿®æ”¹a:stockçš„å€¼ï¼Œå®¢æˆ·ç«¯Bç»™ä»åº“å‘é€äº†ä¸€ä¸ªSETå‘½ä»¤ï¼Œä¹Ÿä¿®æ”¹a:stockçš„å€¼ï¼Œæ­¤æ—¶ï¼Œç›¸åŒé”®çš„å€¼å°±ä¸ä¸€æ ·äº†ã€‚æ‰€ä»¥ï¼Œè®©ä»åº“å¯ä»¥åšå†™æ“ä½œä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"è’‹å¾·é’§","uid":"1609687","ctime":1604558791,"ip_address":"","comment_id":258022,"utype":1}],"discussion_count":10,"race_medal":0,"score":"817648033434","product_id":100056701,"comment_content":"æŠŠ slave-read-only è®¾ç½®ä¸º noï¼Œè®©ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤æ•°æ®ï¼Œä»¥æ­¤æ¥é¿å…è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œè¿™ç§æ–¹æ¡ˆæ˜¯å¦å¯è¡Œï¼Ÿ<br><br>æˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªé—®é¢˜æœ‰äº›æ­§ä¹‰ï¼Œå› ä¸ºå°½ç®¡æŠŠ slave-read-only è®¾ç½®ä¸º noï¼Œå…¶å® slave ä¹Ÿä¸ä¼šä¸»åŠ¨è¿‡æœŸåˆ é™¤ä» master åŒæ­¥è¿‡æ¥çš„æ•°æ®çš„ã€‚<br><br>æˆ‘çŒœè€å¸ˆæƒ³é—®çš„åº”è¯¥æ˜¯ï¼šå‡è®¾è®© slave ä¹Ÿå¯ä»¥è‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œæ˜¯å¦å¯ä»¥ä¿è¯ä¸»ä»åº“çš„ä¸€è‡´æ€§ï¼Ÿ<br><br>å…¶å®è¿™æ ·ä¹Ÿæ— æ³•ä¿è¯ï¼Œä¾‹å¦‚ä»¥ä¸‹åœºæ™¯ï¼š<br><br>1ã€ä¸»ä»åŒæ­¥å­˜åœ¨ç½‘ç»œå»¶è¿Ÿã€‚ä¾‹å¦‚ master å…ˆæ‰§è¡Œ SET key 1 10ï¼Œè¿™ä¸ª key åŒæ­¥åˆ°äº† slaveï¼Œæ­¤æ—¶ key åœ¨ä¸»ä»åº“éƒ½æ˜¯ 10s åè¿‡æœŸï¼Œä¹‹åè¿™ä¸ª key è¿˜å‰© 1s è¿‡æœŸæ—¶ï¼Œmaster åˆæ‰§è¡Œäº† expire key 60ï¼Œé‡è®¾è¿™ä¸ª key çš„è¿‡æœŸæ—¶é—´ã€‚ä½† expire å‘½ä»¤å‘ slave åŒæ­¥æ—¶ï¼Œå‘ç”Ÿäº†ç½‘ç»œå»¶è¿Ÿå¹¶ä¸”è¶…è¿‡äº† 1sï¼Œå¦‚æœ slave å¯ä»¥è‡ªåŠ¨åˆ é™¤è¿‡æœŸ keyï¼Œé‚£ä¹ˆè¿™ä¸ª key æ­£å¥½è¾¾åˆ°è¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šè¢« slave åˆ é™¤äº†ï¼Œä¹‹å slave å†æ”¶åˆ° expire å‘½ä»¤æ—¶ï¼Œæ‰§è¡Œä¼šå¤±è´¥ã€‚æœ€åçš„ç»“æœæ˜¯è¿™ä¸ª key åœ¨ slave ä¸Šä¸¢å¤±äº†ï¼Œä¸»ä»åº“å‘ç”Ÿäº†ä¸ä¸€è‡´ã€‚<br><br>2ã€ä¸»ä»æœºå™¨æ—¶é’Ÿä¸ä¸€è‡´ã€‚åŒæ · master æ‰§è¡Œ SET key 1 10ï¼Œç„¶åæŠŠè¿™ä¸ª key åŒæ­¥åˆ° slaveï¼Œä½†æ˜¯æ­¤æ—¶ slave æœºå™¨æ—¶é’Ÿå¦‚æœå‘ç”Ÿè·³è·ƒï¼Œä¼˜å…ˆæŠŠè¿™ä¸ª key è¿‡æœŸåˆ é™¤äº†ï¼Œä¹Ÿä¼šå‘ç”Ÿä¸Šé¢è¯´çš„ä¸ä¸€è‡´é—®é¢˜ã€‚<br><br>æ‰€ä»¥ Redis ä¸ºäº†ä¿è¯ä¸»ä»åŒæ­¥çš„ä¸€è‡´æ€§ï¼Œä¸ä¼šè®© slave è‡ªåŠ¨åˆ é™¤è¿‡æœŸ keyï¼Œè€Œåªåœ¨ master åˆ é™¤è¿‡æœŸ keyï¼Œä¹‹å master ä¼šå‘ slave å‘é€ä¸€ä¸ª DELï¼Œslave å†æŠŠè¿™ä¸ª key åˆ é™¤æ‰ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è§£å†³ä¸»ä»ç½‘ç»œå»¶è¿Ÿå’Œæœºå™¨æ—¶é’Ÿä¸ä¸€è‡´å¸¦æ¥çš„å½±å“ã€‚<br><br>å†è§£é‡Šä¸€ä¸‹ slave-read-only çš„ä½œç”¨ï¼Œå®ƒä¸»è¦ç”¨æ¥æ§åˆ¶ slave æ˜¯å¦å¯å†™ï¼Œä½†æ˜¯å¦ä¸»åŠ¨åˆ é™¤è¿‡æœŸ keyï¼Œæ ¹æ® Redis ç‰ˆæœ¬ä¸åŒï¼Œæ‰§è¡Œé€»è¾‘ä¹Ÿä¸åŒã€‚<br><br>1ã€å¦‚æœç‰ˆæœ¬ä½äº Redis 4.0ï¼Œslave-read-only è®¾ç½®ä¸º noï¼Œæ­¤æ—¶ slave å…è®¸å†™å…¥æ•°æ®ï¼Œä½†å¦‚æœ key è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ª key è¿‡æœŸåï¼Œè™½ç„¶åœ¨ slave ä¸ŠæŸ¥è¯¢ä¸åˆ°äº†ï¼Œä½†å¹¶ä¸ä¼šåœ¨å†…å­˜ä¸­åˆ é™¤ï¼Œè¿™äº›è¿‡æœŸ key ä¼šä¸€ç›´å ç€ Redis å†…å­˜æ— æ³•é‡Šæ”¾ã€‚<br><br>2ã€Redis 4.0 ç‰ˆæœ¬è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œåœ¨ slave å†™å…¥å¸¦è¿‡æœŸæ—¶é—´çš„ keyï¼Œslave ä¼šè®°ä¸‹è¿™äº› keyï¼Œå¹¶ä¸”åœ¨åå°å®šæ—¶æ£€æµ‹è¿™äº› key æ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåä»å†…å­˜ä¸­åˆ é™¤ã€‚<br><br>ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ 2 ç§æƒ…å†µï¼Œslave éƒ½ä¸ä¼šä¸»åŠ¨åˆ é™¤ç”± *master åŒæ­¥è¿‡æ¥å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ key*ã€‚ä¹Ÿå°±æ˜¯ master å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ keyï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ç”± master è‡ªå·±ç»´æŠ¤ï¼Œslave ä¸ä¼šä»‹å…¥ã€‚å¦‚æœ slave è®¾ç½®äº† slave-read-only = noï¼Œè€Œä¸”æ˜¯ 4.0+ ç‰ˆæœ¬ï¼Œslave ä¹Ÿåªç»´æŠ¤ç›´æ¥å‘è‡ªå·±å†™å…¥ çš„å¸¦æœ‰è¿‡æœŸçš„ keyï¼Œè¿‡æœŸæ—¶åªåˆ é™¤è¿™äº› keyã€‚<br><br>å¦å¤–ï¼Œæˆ‘è¿˜èƒ½æƒ³åˆ°çš„ä¸»ä»åŒæ­¥çš„ 2 ä¸ªé—®é¢˜:<br><br>1ã€ä¸»ä»åº“è®¾ç½®çš„ maxmemory ä¸åŒï¼Œå¦‚æœ slave æ¯” master å°ï¼Œé‚£ä¹ˆ slave å†…å­˜å°±ä¼šä¼˜å…ˆè¾¾åˆ° maxmemroyï¼Œç„¶åå¼€å§‹æ·˜æ±°æ•°æ®ï¼Œæ­¤æ—¶ä¸»ä»åº“ä¹Ÿä¼šäº§ç”Ÿä¸ä¸€è‡´ã€‚<br><br>2ã€å¦‚æœä¸»ä»åŒæ­¥çš„ client-output-buffer-limit è®¾ç½®è¿‡å°ï¼Œå¹¶ä¸” master æ•°æ®é‡å¾ˆå¤§ï¼Œä¸»ä»å…¨é‡åŒæ­¥æ—¶å¯èƒ½ä¼šå¯¼è‡´ buffer æº¢å‡ºï¼Œæº¢å‡ºåä¸»ä»å…¨é‡åŒæ­¥å°±ä¼šå¤±è´¥ã€‚å¦‚æœä¸»ä»é›†ç¾¤é…ç½®äº†å“¨å…µï¼Œé‚£ä¹ˆå“¨å…µä¼šè®© slave ç»§ç»­å‘ master å‘èµ·å…¨é‡åŒæ­¥è¯·æ±‚ï¼Œç„¶å buffer åˆæº¢å‡ºåŒæ­¥å¤±è´¥ï¼Œå¦‚æ­¤åå¤ï¼Œä¼šå½¢æˆå¤åˆ¶é£æš´ï¼Œè¿™ä¼šæµªè´¹ master å¤§é‡çš„ CPUã€å†…å­˜ã€å¸¦å®½èµ„æºï¼Œä¹Ÿä¼šè®© master äº§ç”Ÿé˜»å¡çš„é£é™©ã€‚","like_count":191,"discussions":[{"author":{"id":1609687,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8f/d7/fb60129d.jpg","nickname":"è’‹å¾·é’§","note":"","ucode":"833985C2C37C0A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508531,"discussion_content":"æ„Ÿè°¢KaitoåŒå­¦çš„å›å¤å’Œè¯¦ç»†åˆ†æï¼å¾ˆèµï¼\n\næˆ‘ä¹Ÿè§£é‡Šä¸‹ï¼Œåˆ°æ—¶å‡ºè¿™é“é¢˜çš„ä¸€ä¸ªè€ƒè™‘å‡ºå‘ç‚¹ã€‚\n\nè¿™é“é¢˜æˆ‘å…¶å®æ˜¯æƒ³é—®å¤§å®¶ï¼Œå‡è®¾ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤è¿‡æœŸæ•°æ®çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚å…¶å®ï¼Œæ˜¯æƒ³æé†’ä¸‹åŒå­¦ä»¬ï¼Œä¸»ä»å¤åˆ¶ä¸­çš„å¢åˆ æ”¹éƒ½éœ€è¦åœ¨ä¸»åº“æ‰§è¡Œï¼Œå³ä½¿ä»åº“èƒ½åšåˆ é™¤ï¼Œä¹Ÿä¸è¦åœ¨ä»åº“åˆ é™¤ã€‚å¦åˆ™ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸»ä»åº“ä¸Šéƒ½èƒ½åšå†™æ“ä½œçš„è¯ï¼Œä¸»ä»åº“ä¸Šæœ‰a:stockçš„é”®ï¼Œå®¢æˆ·ç«¯Aç»™ä¸»åº“å‘é€ä¸€ä¸ªSETå‘½ä»¤ï¼Œä¿®æ”¹a:stockçš„å€¼ï¼Œå®¢æˆ·ç«¯Bç»™ä»åº“å‘é€äº†ä¸€ä¸ªSETå‘½ä»¤ï¼Œä¹Ÿä¿®æ”¹a:stockçš„å€¼ï¼Œæ­¤æ—¶ï¼Œç›¸åŒé”®çš„å€¼å°±ä¸ä¸€æ ·äº†ã€‚æ‰€ä»¥ï¼Œè®©ä»åº“å¯ä»¥åšå†™æ“ä½œä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚\n","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1604558791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1613760,"avatar":"https://static001.geekbang.org/account/avatar/00/18/9f/c0/86febfff.jpg","nickname":"Master","note":"","ucode":"79D0145B853C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374220,"discussion_content":"è¯¾ä»£è¡¨æ€»ç»“çš„å¾ˆæ‰¼è¦ï¼Œå¾ˆå…³é”®çš„å†…å®¹æäº†å‡ºæ¥ï¼Œä»ä¸ä¼šå¯¹ä¸»åŒæ­¥è¿‡æ¥çš„keyåšä»»ä½•å¹²é¢„ï¼Œåˆ’é‡ç‚¹æ˜‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1621067714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337880,"discussion_content":"redisçš„ä¸»ä»å« ä¸»å¤‡ä¹Ÿæ— ä¸å¯ã€‚ã€‚ã€‚å®æˆ˜ä¸­åŸºæœ¬æ²¡æœ‰é‡åˆ° ç”¨redis ä¸»ä»ä»¥å å†™ä¸»è¯»ä»çš„ï¼Œå…¨éƒ¨éƒ½æ˜¯å†™ä¸»è¯»ä¸»ã€‚ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609116182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2094925,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/f7/4d/09554c96.jpg","nickname":"iron bo","note":"","ucode":"4BFB1331637AA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371863,"discussion_content":"æˆ‘ä»¬ç”Ÿäº§ä¸Šé‡‡ç”¨çš„ä¸»ä»é›†ç¾¤ï¼Œä¸”é€šè¿‡xpipeè·¨æœºæˆ¿åŒæ­¥ã€‚è¿™é‡Œå°±æ˜¯ç”¨çš„å†™ä¸»è¯»ä»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620027694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337880,"ip_address":""},"score":371863,"extra":""},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376890,"discussion_content":"ç”¨ä»æé«˜è¯»çš„QPS","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622392438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337880,"ip_address":""},"score":376890,"extra":""},{"author":{"id":1780797,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2c/3d/0bd58aa4.jpg","nickname":"Em","note":"","ucode":"32012A5C603C8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578245,"discussion_content":"ä½ çš„ä¸šåŠ¡qpsæ²¡è¾¾åˆ°é‡","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1656598527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337880,"ip_address":""},"score":578245,"extra":""}]},{"author":{"id":1272542,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6a/de/8511211d.jpg","nickname":"Trying","note":"","ucode":"8791B6591CA216","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558304,"discussion_content":"å¤ªç²¾å½©äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648200705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1415619,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","nickname":"é™Œå…®","note":"","ucode":"00CE47CAECD5CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553727,"discussion_content":"å›ç­”çš„çœŸç²¾å½©ï¼Œmark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646041779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"å‡¯æ–‡å°çŒª","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378671,"discussion_content":"å¦‚æœä»åº“èƒ½è‡ªå·±åˆ é™¤key  é‚£ä¹ˆå°±ä¼šäº§ç”Ÿ ä»£ç ä¹Ÿèƒ½åˆ é™¤key ä¸»åº“ã€ä»åº“å„è‡ªéƒ½èƒ½åˆ é™¤keyã€‚è¿™æ˜¾ç„¶ä¼šé™·å…¥å¤šæ•°æ®ä¸€è‡´æ€§ç»´æŠ¤é—®é¢˜ è€Œè¿™ç§é—®é¢˜åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ˜¾ç„¶ä¼šé€ æˆèµ„æŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623329114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1692756,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d4/54/7263deb2.jpg","nickname":"åƒé¥­","note":"","ucode":"AF0D7165D5F049","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320596,"discussion_content":"è€å“¥å¾ˆå¼º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604409280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290527,"user_name":"è€å¤§ä¸å°","can_delete":false,"product_type":"c1","uid":1295609,"ip_address":"","ucode":"35BCDD3CB13467","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJRFRX8kNzNet7FibNvtavbVpAwK09AhIhrib9k762qWtH6mre8ickP7hM5mgZC4ytr8NnmIfmAhxMSQ/132","comment_is_top":false,"comment_ctime":1619600167,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"70339076903","product_id":100056701,"comment_content":"è€å¸ˆï¼Œslave-serve-stale-dataè¿™ä¸ªå‘½ä»¤è¯´çš„ä¸æ¸…ä¸æ¥šçš„ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ä¸æ˜å°±é‡Œã€‚<br><br>slave-serve-stale-data<br><br>è§£é‡Šï¼šå½“ä¸€ä¸ªslaveä¸masterå¤±å»è”ç³»æ—¶ï¼Œæˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œçš„æ—¶å€™ï¼Œslaveåº”å¯¹è¯·æ±‚çš„è¡Œä¸ºï¼š1) å¦‚æœä¸º yesï¼ˆé»˜è®¤å€¼ï¼‰ ï¼Œslave ä»ç„¶ä¼šåº”ç­”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä½†è¿”å›çš„æ•°æ®å¯èƒ½æ˜¯è¿‡æ—¶ï¼Œæˆ–è€…æ•°æ®å¯èƒ½æ˜¯ç©ºçš„åœ¨ç¬¬ä¸€æ¬¡åŒæ­¥çš„æ—¶å€™ï¼›2) å¦‚æœä¸º no ï¼Œåœ¨ä½ æ‰§è¡Œé™¤äº† info å’Œ salveof ä¹‹å¤–çš„å…¶ä»–å‘½ä»¤æ—¶ï¼Œslave éƒ½å°†è¿”å›ä¸€ä¸ª &quot;SYNC with master in progress&quot; çš„é”™è¯¯ã€‚<br><br><br>29ã€slave-read-only<br><br>è§£é‡Šï¼šè®¾ç½®slaveæ˜¯å¦æ˜¯åªè¯»çš„ã€‚ä»2.6ç‰ˆèµ·ï¼Œslaveé»˜è®¤æ˜¯åªè¯»çš„ã€‚<br>","like_count":17,"discussions":[{"author":{"id":1447496,"avatar":"https://static001.geekbang.org/account/avatar/00/16/16/48/01567df1.jpg","nickname":"éƒ‘æ³½æ´²","note":"","ucode":"EA1B540A040875","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572440,"discussion_content":"slave-serve-stale-dataæ˜¯å¯¹CAPç†è®ºçš„åº”ç”¨ã€‚å½“å‘ç”Ÿä¸»ä»ä¸åŒæ­¥ï¼ˆPï¼‰æ—¶å€™ï¼Œæ˜¯è¦ä¿ä¸€è‡´æ€§Cè¿˜æ˜¯ä¿å¯ç”¨æ€§Aï¼Œå¦‚æœslave-serve-stale-dataè®¾ç½®äº†yesï¼Œå°±æ˜¯ä¿Aï¼›åä¹‹å°±æ˜¯ä¿C","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652785039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1613760,"avatar":"https://static001.geekbang.org/account/avatar/00/18/9f/c0/86febfff.jpg","nickname":"Master","note":"","ucode":"79D0145B853C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374222,"discussion_content":"å­¦ä¹ åçœ‹çœ‹å¤§å®¶çš„ä¸€äº›ç‚¹è¯„è¿˜æ˜¯ä¼šæŸ¥ç¼ºè¡¥æ¼çš„ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥å½“ä½œå¤‡ä»½åº“çš„å®šä½ï¼Œä¸€ä¸ªæ˜¯ä¸»å†™ä»è¯»ï¼Œä¸»ä»æ¨¡å¼çš„ä»å†™é™åˆ¶","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621067853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258028,"user_name":"æ¨é€¸æ—","can_delete":false,"product_type":"c1","uid":1167233,"ip_address":"","ucode":"4BF3CF3E2F1AC7","user_header":"https://static001.geekbang.org/account/avatar/00/11/cf/81/96f656ef.jpg","comment_is_top":false,"comment_ctime":1604274305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27374078081","product_id":100056701,"comment_content":"ä¸æ˜¯ä¸ªå¥½æ–¹æ³•ï¼Œå¦‚æœä¸åŒå®¢æˆ·ç«¯ï¼Œå»éå½“å‰ä»åº“è¯»å–æ•°æ®æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µã€‚","like_count":6},{"had_liked":false,"id":258510,"user_name":"æ€å˜","can_delete":false,"product_type":"c1","uid":2205307,"ip_address":"","ucode":"DE73A587523739","user_header":"https://static001.geekbang.org/account/avatar/00/21/a6/7b/1b581f07.jpg","comment_is_top":false,"comment_ctime":1604469191,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23079305671","product_id":100056701,"comment_content":"è€å¸ˆæ‚¨å¥½,å…³äºbindå‚æ•°,ä¸æ˜¯è®¾ç½®redisèƒ½æ¥å—å“ªä¸ªæœ¬æœºç½‘å¡æ¥å…¥çš„è¿æ¥å—?ä¸ºä»€ä¹ˆè¦é…ç½®å¤šä¸ªå“¨å…µçš„IPå‘¢","like_count":6,"discussions":[{"author":{"id":2272571,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ad/3b/70b3ad17.jpg","nickname":"çŸ¥è¯†å¤§çˆ†ç‚¸","note":"","ucode":"4E718FB3468528","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321122,"discussion_content":"åŒé—®ï¼Œbindæ˜¯ç»‘å®šæœ¬æœºèƒ½è®¿é—®çš„ç½‘å¡ipï¼Œç»‘å®šåˆ«çš„æœºå™¨ipæ ¹æœ¬å¯åŠ¨ä¸äº†ï¼Œè€å¸ˆè¿™å—åº”è¯¥è®²é”™äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1604541163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1704677,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/02/e5/2117a869.jpg","nickname":"wwj","note":"","ucode":"7DA2C9A5491C66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360900,"discussion_content":"å› ä¸ºé»˜è®¤é…ç½®æ˜¯å¯ä»¥å¤„ç†å…¨éƒ¨è¯·æ±‚çš„ï¼Œåœ¨ç”Ÿäº§ä¸Šé¢æ˜¯ä¸å¯ä»¥è¿™æ ·é…ç½®çš„ã€‚æ‰€ä»¥æ˜¯è¦é…ç½®æœ¬æœºipï¼Œå’Œä»æœºipçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616554528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281934,"user_name":"å°ç™½ç™½ä¸ç™½","can_delete":false,"product_type":"c1","uid":1757797,"ip_address":"","ucode":"270EC3A197A8D9","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d2/65/79d89c77.jpg","comment_is_top":false,"comment_ctime":1614956285,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14499858173","product_id":100056701,"comment_content":"EXPIREã€PEXPIREå’ŒEXPIREATä¸‰ä¸ªå‘½ä»¤éƒ½ä¼šè½¬æ¢æˆPEXPIREATå‘½ä»¤æ¥æ‰§è¡Œ,éš¾é“rediså¯¹äºaofæ—¥å¿—æ–‡ä»¶æ²¡æœ‰è½¬ä¸ºPEXPIREATå—?","like_count":4,"discussions":[{"author":{"id":1644104,"avatar":"https://static001.geekbang.org/account/avatar/00/19/16/48/09493874.jpg","nickname":"èŒ¶æ²¡å–å®Œ","note":"","ucode":"D72D88C42A1258","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393125,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ï¼šå³ä½¿redisä¼šè½¬æˆpexpireAtæ‰§è¡Œï¼Œä½†æ˜¯ä¸»ä¼ æ’­å‘½ä»¤çš„æ—¶å€™ï¼Œè¿˜æ˜¯å‘é€åŸå‘½ä»¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631260951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2526420,"avatar":"https://static001.geekbang.org/account/avatar/00/26/8c/d4/c228fe2c.jpg","nickname":"é«˜æ¬§å¶å°¼å…¹","note":"","ucode":"1974C9151DBFB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380721,"discussion_content":"æ²¡æœ‰ä¿å­˜è®¾ç½®æ—¶é—´ï¼Œé‚£ä¸è¿˜æ˜¯æŒ‰æ‰§è¡Œæ—¶é—´+expireçš„æ—¶é—´æ®µæ¥ç¡®å®šå‡†ç¡®æ—¶é—´çš„å˜›\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624671197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1635034,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f2/da/2f1fd336.jpg","nickname":"æ— å¯åšéÂ°","note":"","ucode":"3BA7AC0E492FCB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378421,"discussion_content":"åŒæ ·æœ‰è¿™ä¸ªç–‘é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623217663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266443,"user_name":"èµµèŒ­èŒ­","can_delete":false,"product_type":"c1","uid":2060978,"ip_address":"","ucode":"502C8A2B10C09B","user_header":"","comment_is_top":false,"comment_ctime":1607341668,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14492243556","product_id":100056701,"comment_content":"ä¸»ä»å¤åˆ¶ ä¸æ˜¯å¤åˆ¶çš„æ˜¯rdbå— ä¸æ˜¯aofå•Š è¿™ä¸ªå’ŒæŒ‡ä»¤ å¸¦ATçš„è¿˜æœ‰æ•ˆå— è¿˜æ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜","like_count":3,"discussions":[{"author":{"id":1477612,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","nickname":"å¼ å¤©å±¹","note":"","ucode":"8BD6BD6DCF0F4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343701,"discussion_content":"ç¬¬ä¸€æ¬¡å»ºç«‹ä¸»ä»è¿æ¥çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯é€šè¿‡RDBäºŒè¿›åˆ¶æ–‡ä»¶çš„ã€‚åœ¨é¡ºåˆ©å®Œæˆç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ä»¥åï¼Œå°±æ˜¯åŸºäºé•¿è¿æ¥çš„æŒç»­å‘½ä»¤ä¼ æ’­ï¼ŒRDBä¹Ÿæ²¡åŠæ³•å¢é‡ä¼ æ’­ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1611141047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261297,"user_name":"åˆ˜æµ©","can_delete":false,"product_type":"c1","uid":1052763,"ip_address":"","ucode":"25B4B8F540D40E","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/5b/f700f9ef.jpg","comment_is_top":false,"comment_ctime":1605261289,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14490163177","product_id":100056701,"comment_content":"slave-serve-stale-dataé…ç½®äº†ä¸»ä»ä¸­æ–­åï¼Œä»åº“çš„é€»è¾‘<br>--no ï¼šä»åº“åªèƒ½åº”ç­”INFOå’ŒSLAVEOF<br>--yesé»˜è®¤ ï¼šæ­£å¸¸åº”ç­”<br>è¿™æ ·ä¸çŸ¥é“å¯¹ä¸å¯¹","like_count":3},{"had_liked":false,"id":285631,"user_name":"yu","can_delete":false,"product_type":"c1","uid":1083356,"ip_address":"","ucode":"3AFACB060085DD","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/dc/85515477.jpg","comment_is_top":false,"comment_ctime":1616927990,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10206862582","product_id":100056701,"comment_content":"redisä¸ºä½•ä¸æŠŠåº•å±‚çš„expireå®ç°æˆä¸ºexpireAtï¼Œå†å‘ç»™ä»åº“è¿›è¡ŒåŒæ­¥ï¼Œé¿å…å‡ºç°è¿‡æœŸæ•°æ®é—®é¢˜ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1644104,"avatar":"https://static001.geekbang.org/account/avatar/00/19/16/48/09493874.jpg","nickname":"èŒ¶æ²¡å–å®Œ","note":"","ucode":"D72D88C42A1258","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393126,"discussion_content":"æˆ‘è®°å¾—redisåº•å±‚ä¼šæŠŠexpire è½¬æ¢æˆexpireAt,æŠŠç§’è½¬æ¯«ç§’\nredisæ‰§è¡Œæ—¶è™½ç„¶ä¼šè½¬expireAt,ä½†æ˜¯ä¸»ä¼ æ’­å‘½ä»¤æ—¶ï¼Œåº”è¯¥è¿˜æ˜¯å‘é€åŸå‘½ä»¤","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631261034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389544,"discussion_content":"å…¼å®¹ä¸»ä»æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´çš„æƒ…å†µ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629334170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258097,"user_name":"é›¶ç‚¹999","can_delete":false,"product_type":"c1","uid":1046386,"ip_address":"","ucode":"3D0A0504AFB6EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/72/e7bc6ff1.jpg","comment_is_top":false,"comment_ctime":1604297853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10194232445","product_id":100056701,"comment_content":"åªæœ‰ä¸»åº“æä¾›æœåŠ¡ï¼Œä»åº“åªä¿è¯é«˜å¯ç”¨","like_count":2},{"had_liked":false,"id":298550,"user_name":"Geek1254","can_delete":false,"product_type":"c1","uid":2028941,"ip_address":"","ucode":"BC2F7756A0676D","user_header":"","comment_is_top":false,"comment_ctime":1624186346,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5919153642","product_id":100056701,"comment_content":"ä¸ºä»€ä¹ˆä¸åœ¨ä¸»åº“åˆ é™¤è¿‡æœŸkeyæ—¶ç»™ä»åº“å‘é€åˆ é™¤å‘½ä»¤","like_count":1},{"had_liked":false,"id":259033,"user_name":"å”æœé¦–éƒ½","can_delete":false,"product_type":"c1","uid":1081233,"ip_address":"","ucode":"F72655AE0AE4CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/91/962eba1a.jpg","comment_is_top":false,"comment_ctime":1604621305,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5899588601","product_id":100056701,"comment_content":"ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè¿™æ ·ä»åº“ä¹Ÿèƒ½å¤„ç†å†™å‘½ä»¤ï¼Œè¿™æ ·æ›´å®¹æ˜“é€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚","like_count":1},{"had_liked":false,"id":258511,"user_name":"æ€å˜","can_delete":false,"product_type":"c1","uid":2205307,"ip_address":"","ucode":"DE73A587523739","user_header":"https://static001.geekbang.org/account/avatar/00/21/a6/7b/1b581f07.jpg","comment_is_top":false,"comment_ctime":1604469291,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5899436587","product_id":100056701,"comment_content":"protected-modeæˆ‘çœ‹å‚æ•°æ–‡ä»¶çš„è§£é‡Šæ˜¯,å¦‚æœprotected-modeè®¾ç½®ä¸ºyes,å¦‚æœå®ä¾‹æœªè®¾ç½®å¯†ç ä¸”æœªè®¾ç½®bindå‚æ•°,åªèƒ½é€šè¿‡127.0.0.1è¿›è¡Œæœ¬åœ°è¿æ¥,æ˜¯æˆ‘ç†è§£çš„ä¸å¯¹å—?","like_count":1,"discussions":[{"author":{"id":2272571,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ad/3b/70b3ad17.jpg","nickname":"çŸ¥è¯†å¤§çˆ†ç‚¸","note":"","ucode":"4E718FB3468528","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321123,"discussion_content":"æˆ‘è·Ÿä½ ç†è§£ä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604541208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351199,"user_name":"Zhqqqq","can_delete":false,"product_type":"c1","uid":2411403,"ip_address":"","ucode":"CD8DE79149C0B2","user_header":"https://static001.geekbang.org/account/avatar/00/24/cb/8b/fa482708.jpg","comment_is_top":false,"comment_ctime":1657605223,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657605223","product_id":100056701,"comment_content":"è€å¸ˆé—®ä¸€ä¸‹å…³äºå¤–éƒ¨ç¨‹åºç›‘æ§ Redis INFO replication ä¸»ä»å»¶è¿Ÿä¿¡æ¯æ¥ä¸ºå®¢æˆ·ç«¯æ˜¯å¦èƒ½è®¿é—®æ”¹ä»èŠ‚ç‚¹ã€‚è¿™ä¸ªæ–¹æ¡ˆä¼¼ä¹å°±æ˜¯æŠŠ AP æ¨¡å‹æ”¹ä¸º CPã€‚è€Œä¸”å¢åŠ äº†æ¶æ„å¤æ‚åº¦ï¼Œæ¯•ç«Ÿåˆå¢åŠ äº†å¤–éƒ¨ç¨‹åºï¼Œåœ¨å®¢æˆ·ç«¯è¿›è¡Œç›‘æ§ä¸è¡Œå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":340172,"user_name":"å¼ æ½‡èµŸ","can_delete":false,"product_type":"c1","uid":1132192,"ip_address":"","ucode":"1A45B57F9E0723","user_header":"https://static001.geekbang.org/account/avatar/00/11/46/a0/aa6d4ecd.jpg","comment_is_top":false,"comment_ctime":1648641641,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648641641","product_id":100056701,"comment_content":"è€å¸ˆè¯´çš„slave-serve-stale-data è¿™ä¸ªå‚æ•°åœ¨åé¢çš„ç‰ˆæœ¬åº”è¯¥æ˜¯ä¿®æ”¹æˆäº†replica-serve-stale-dataäº†å§ã€‚å®˜æ–¹çš„é…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°slave-serve-stale-dataè¿™ä¸ªé…ç½®å‚æ•°<br>","like_count":0},{"had_liked":false,"id":322963,"user_name":"å—è¶…å‡¡","can_delete":false,"product_type":"c1","uid":2678558,"ip_address":"","ucode":"A2A160D483BBB0","user_header":"","comment_is_top":false,"comment_ctime":1637671681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637671681","product_id":100056701,"comment_content":"è€å¸ˆå¥½ï¼Œæœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸‹ã€‚ä¸»ä»åŒæ­¥ä¸æ˜¯é€šè¿‡RDBçš„æ–¹å¼è¿›è¡Œçš„å—ï¼Œä»åº“è¯»RDBçš„è¯ä¸ç”¨æ‰§è¡Œå‘½ä»¤å§ï¼Œæ˜¯ç›´æ¥è¯»çš„æ•°æ®å§ï¼Œé‚£ä»åº“ä¸ºä»€ä¹ˆè¿˜ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´å‘¢ï¼Ÿä¸æ˜¯ç›´æ¥è¯»çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":314949,"user_name":"é™ˆé˜³","can_delete":false,"product_type":"c1","uid":2653715,"ip_address":"","ucode":"C8E676C967D23A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKib3vNM6TPT1umvR3TictnLurJPKuQq4iblH5upgBB3kHL9hoN3Pgh3MaR2rjz6fWgMiaDpicd8R5wsAQ/132","comment_is_top":false,"comment_ctime":1633608666,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1633608666","product_id":100056701,"comment_content":"ä¸»ä»åº“åœ¨ä¸€ä¸ªæœºæˆ¿ä¸ä¼šé™ä½å®¹ç¾æ€§å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":309300,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1630035721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630035721","product_id":100056701,"comment_content":"è¿™ä¸ªé—®é¢˜æœ‰äº›æ²¡çœ‹æ‡‚,æ˜¯ç›´æ¥ä»ä»åº“ä¸Šåˆ é™¤æ•°æ®å—,è¿™åº”è¯¥æ˜¯ä¸è¢«å…è®¸çš„æŠŠ,ç°åœ¨åœ¨äº‘ä¸Šç”¨K8Sç®¡ç†,ä¹Ÿæ˜¯è®¾ç½®äº†å¤šä¸ªservice,ä¸€ä¸ªç”¨æ¥å†™ä¸€ä¸ªç”¨æ¥è¯»,ä»åº“åªç”¨æ¥è¯»å–æ•°æ®,ä¸åº”è¯¥è´Ÿè´£åˆ é™¤æ•°æ®<br>è€Œä¸”,å³ä½¿è®¾ç½®äº†è¿‡æœŸæ—¶é—´,ä»åº“åœ¨è¾¾åˆ°ä¹‹åä¹Ÿä¸ä¼šåˆ é™¤æ•°æ®,åªæ˜¯è¿”å›ç©º,åªæœ‰æ¥åˆ°ä¸»åº“åˆ é™¤æ“ä½œæ‰ä¼šè¿›è¡Œåˆ é™¤","like_count":0},{"had_liked":false,"id":304646,"user_name":"ç„å¢¨","can_delete":false,"product_type":"c1","uid":2681445,"ip_address":"","ucode":"B181ECDF7ECCAC","user_header":"https://static001.geekbang.org/account/avatar/00/28/ea/65/ab8748c5.jpg","comment_is_top":false,"comment_ctime":1627530761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627530761","product_id":100056701,"comment_content":"è¿‡æœŸé”®è„è¯»é—®é¢˜,æœ‰ä¸ªç–‘æƒ‘:è€å¸ˆå»ºè®®ä½¿ç”¨expireat å’Œpexpireat å› ä¸ºåé¢è·Ÿçš„æ˜¯æ—¶é—´æˆ³,è€Œä¸æ˜¯å½“å‰æœåŠ¡æ—¶é—´+è¿‡æœŸæ—¶é—´.ä½†æ˜¯å®é™…ä¸Šrediså†…éƒ¨åœ¨é…ç½®è¿‡æœŸæ—¶é—´ä¹‹å,ä¸æ˜¯éƒ½è½¬æ¢æˆäº†pexpireatå¹¶å­˜å‚¨åˆ°è¿‡æœŸå­—å…¸ä¸­å—?æ‰€ä»¥è¿™å‡ ä¸ªå‘½ä»¤æœ€ååœ¨redisè¿‡æœŸå­—å…¸ä¸­ç†è®ºä¸Šè¡¨ç°æ˜¯ä¸€è‡´çš„,ä¸åº”è¯¥å‡ºç°è€å¸ˆè¯´çš„å› ä¸ºå‘½ä»¤ä¸ä¸€æ ·è€Œå‡ºç°è„è¯»ç°è±¡å§.éº»çƒ¦è€å¸ˆè§£è¯»ä¸‹ğŸ™","like_count":0},{"had_liked":false,"id":304403,"user_name":"ç’©é›·","can_delete":false,"product_type":"c1","uid":1120703,"ip_address":"","ucode":"BBAC0933BB7C92","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/bf/415023b5.jpg","comment_is_top":false,"comment_ctime":1627388443,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627388443","product_id":100056701,"comment_content":"ä»åº“ä¸èƒ½æ‰§è¡Œå†™æ“ä½œï¼Œè¿‡æœŸçš„æ•°æ®æ˜¯å¦‚ä½•è¢«åˆ é™¤çš„å‘¢ï¼Ÿå…·ä½“è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":295470,"user_name":"n0thing","can_delete":false,"product_type":"c1","uid":1197977,"ip_address":"","ucode":"9B44E34712C535","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/99/aefe1b12.jpg","comment_is_top":false,"comment_ctime":1622442790,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622442790","product_id":100056701,"comment_content":"ä¸ç®¡redisè‡ªèº«è¿˜æ˜¯å“¨å…µçš„protected-modeï¼Œ çœ‹å®˜æ–¹é…ç½®è§£é‡Šï¼Œä»å®‰å…¨æ€§ä¸Šè€ƒè™‘è®¾ç½®ä¸ºyeså¯èƒ½æ›´åŠ åˆç†ï¼Ÿçœ‹ä¸Šå»åªç”¨åŠ ä¸Šå¯†ç å’ŒBindæœ¬æœºredis listençš„å¯¹å¤–IPå’Œæ–¹ä¾¿æœ¬åœ°è¿æ¥çš„127.0.0.1å³å¯ã€‚ä¸ç”¨Bindå¦å¤–ä¸¤å°å“¨å…µçš„å¯¹å¤–IPã€‚","like_count":0},{"had_liked":false,"id":286349,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1617264699,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1617264699","product_id":100056701,"comment_content":"Redis ä¸»ä»åŒæ­¥æœ‰ä¸‰ä¸ªå‘ï¼šä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€è¯»åˆ°è¿‡æœŸæ•°æ®ã€é…ç½®ä¸åˆç†æœåŠ¡æŒ‚æ‰ã€‚<br><br>ä¸ºäº†é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œä¸€æ–¹é¢è¦ä¿è¯ä¸»ä»ä¹‹é—´çš„ç½‘ç»œçŠ¶å†µè‰¯å¥½ï¼Œå¦å¤–ä¸»ä»æœåŠ¡å™¨çš„é…ç½®ä¹Ÿä¸èƒ½ç›¸å·®å¤ªè¿œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥å†™ä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œç›‘æ§ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®å€¼ï¼Œå¦‚æœå·®å€¼è¿‡å¤§ï¼Œå°±å…ˆä¸è®©å®¢æˆ·ç«¯å’Œè¿™ä¸ªä»åº“è¿æ¥ã€‚<br><br>è¯»åˆ°è¿‡æœŸæ•°æ®æ˜¯å› ä¸º Redis æœ¬èº«çš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼ˆæƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ï¼‰å¼•èµ·çš„ï¼Œä¸»åº“ä¸Šçš„è¿‡æœŸæ•°æ®è¢«æƒ°æ€§åˆ é™¤äº†ï¼Œä½†æ˜¯ä»åº“ä¸Šæ²¡æœ‰ï¼ˆä»åº“åªè¯»ï¼‰ã€‚<br><br>ä¸ºäº†é¿å…è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œä¸€æ–¹é¢æ˜¯å°½é‡ä½¿ç”¨ Redis 3.2 ä»¥åçš„ç‰ˆæœ¬ï¼Œå¦å¤–ä¸€æ¡å°±æ˜¯å°½é‡ä½¿ç”¨ EXPIREAT&#47;PEXPIREAT å‘½ä»¤ï¼ŒæŒ‡å®šå…·ä½“çš„è¿‡æœŸæ—¶é—´ç‚¹ã€‚<br><br>å› ä¸ºé…ç½®ä¸å½“ï¼Œå¯¼è‡´åœ¨ä¸»ä»åˆ‡æ¢çš„è¿‡ç¨‹ä¸­æœåŠ¡æŒ‚æ‰çš„å‚æ•°ä¸»è¦æ˜¯ä¸¤ä¸ªï¼Œprotected-mode å’Œ cluster-node-timeoutã€‚<br><br>ä¸ºäº†è®©å“¨å…µä¹‹é—´å¯ä»¥äº’ç›¸è®¿é—®ï¼Œé‚£ä¹ˆ protected-mode éœ€è¦è®¾ç½®ä¸º noï¼Œå¹¶ä¸”å°†å“¨å…µçš„ IP éƒ½åˆ—åœ¨ bind é‡Œã€‚<br><br>ä¸ºäº†é¿å…å®ä¾‹ä¸»ä»åˆ‡æ¢ï¼Œå¯¼è‡´é›†ç¾¤å¿ƒè·³è¶…æ—¶ï¼Œéœ€è¦æŠŠ cluster-node-timeout é…ç½®çš„å¤§ä¸€ç‚¹ ï¼ˆ10~20 ç§’ï¼‰<br><br>æœ€åï¼Œå°† slave-serve-stale-data è®¾ç½®ä¸º noï¼Œä»åº“åªèƒ½æœåŠ¡ INFOã€SLAVEOF å‘½ä»¤ï¼Œå¯ä»¥é¿å…ä»åº“ä¸­è¯»åˆ°ä¸ä¸€è‡´çš„æ•°æ®ï¼›è€Œ slave-save-only è®¾ç½®ä¸º yesï¼Œä»åº“åªèƒ½å¤„ç†è¯»è¯·æ±‚ã€‚<br><br>å¯¹äºè¯¾åé¢˜ï¼Œå°† slave-read-only è®¾ç½®ä¸º noï¼Œä»åº“ä¹Ÿèƒ½å¤„ç†å†™å‘½ä»¤ï¼Œè‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œè¿™æ ·ä¸€æ¥ä¸»ä»ä¹‹é—´çš„åŒæ­¥å°±å˜å¾—å¤æ‚æ— æ¯”ï¼Œæˆ–è€…è¯´å°±å¹²è„†å˜æˆäº†åŒä¸»ç»“æ„äº†ã€‚<br><br>è¯¾ä»£è¡¨è¡¥å……ï¼Œslave ä¸ä¼šä¸»åŠ¨åˆ é™¤ç”±  master åŒæ­¥è¿‡æ¥çš„å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ keyï¼Œåˆ é™¤ç”± master è‡ªå·±ç»´æŠ¤ã€‚<br><br>è€å¸ˆçš„è¡¥å……ï¼Œä¸»ä»å¤åˆ¶ä¸­çš„å¢åˆ æ”¹éƒ½éœ€è¦åœ¨ä¸»åº“æ‰§è¡Œã€‚","like_count":0},{"had_liked":false,"id":280813,"user_name":"å–ƒå¯»","can_delete":false,"product_type":"c1","uid":1565085,"ip_address":"","ucode":"E31B3660726671","user_header":"https://static001.geekbang.org/account/avatar/00/17/e1/9d/3ec0adec.jpg","comment_is_top":false,"comment_ctime":1614402202,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1614402202","product_id":100056701,"comment_content":"è¯¾åé¢˜: ä¸èƒ½è®©ä»åº“æ‰§è¡Œå†™æ“ä½œï¼Œå¦åˆ™ä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚","like_count":0},{"had_liked":false,"id":277196,"user_name":"æ³Š","can_delete":false,"product_type":"c1","uid":1557092,"ip_address":"","ucode":"3E9275288F1B0D","user_header":"https://static001.geekbang.org/account/avatar/00/17/c2/64/5cd6efa0.jpg","comment_is_top":false,"comment_ctime":1612315405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612315405","product_id":100056701,"comment_content":"å¦‚æœè¿‡æœŸæ•°æ®å¾ˆå¤šï¼Œå¹¶ä¸”ä¸€ç›´æ²¡æœ‰å†è¢«è®¿é—®çš„è¯ï¼Œè¿™äº›æ•°æ®å°±ä¼šç•™å­˜åœ¨ Redis å®ä¾‹ä¸­ã€‚ä¸šåŠ¡åº”ç”¨ä¹‹æ‰€ä»¥ä¼šè¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œè¿™äº›ç•™å­˜æ•°æ®å°±æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚  <br>è¿™é‡Œä¸å¤ªæ˜ç™½ï¼Œå¦‚æœä¸šåŠ¡åº”ç”¨å†æ¬¡è¯»å–æ•°æ®çš„è¯å¦‚æœæ•°æ®è¿‡æœŸçš„è¯ä¸åº”è¯¥ä¼šæƒ°æ€§åˆ é™¤å—ï¼Œæ€ä¹ˆè¿˜ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®å‘¢ï¼Ÿè¿˜æœ‰ä»åº“ä¸ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œçš„è¯å®ƒå†…å­˜ç›´å¢ä¸å‡å—ï¼Œä¸€ç›´ç­‰åˆ°lruå›æ”¶å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":265658,"user_name":"èŒƒé—²","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1606974635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606974635","product_id":100056701,"comment_content":"å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚<br>å¢åˆ æ”¹éƒ½åº”è¯¥åœ¨ä¸»åº“åšã€‚å¦‚æœåœ¨ä»åº“å¤„ç†ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå‡ºç°ã€‚","like_count":0},{"had_liked":false,"id":265269,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1014886,"ip_address":"","ucode":"E826A17A40B971","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/66/719292c3.jpg","comment_is_top":false,"comment_ctime":1606835303,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606835303","product_id":100056701,"comment_content":"Redisä¸»ä»æ¨¡å¼éƒ¨ç½²æ—¶ï¼Œå¦‚01ä¸ºä¸»ï¼Œ02ä¸ºä»ï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥è¯»å†™æ•°æ®æ—¶æ˜¯éœ€è¦è‡ªè¡ŒæŒ‡å®šIPå˜›ï¼Ÿ åƒè¿™ç§ä¸»ä»è¯»å†™çš„æƒ…å†µï¼Œå¸¸è§çš„å¼€æºå®¢æˆ·ç«¯æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œå¦‚Javaä¸­çš„redissionå’Œ.netä¸­çš„stackexchang.redis.","like_count":0},{"had_liked":false,"id":263207,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1606047145,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606047145","product_id":100056701,"comment_content":"é—®é¢˜ï¼šslave-read-only è®¾ç½®ä¸º noï¼Œè®©ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤æ•°æ®ï¼Œä»¥æ­¤æ¥é¿å…è¯»åˆ°è¿‡æœŸæ•°æ®<br>è§£ç­”ï¼šè¿™ä¸ªé…ç½®å¹¶ä¸èƒ½ä½¿ä»åº“å…·å¤‡åˆ é™¤è¿‡æœŸæ•°æ®çš„èƒ½åŠ›å§ã€‚<br>è¿™ä¸ªé…ç½®æ˜¯è¦è®©ä»åº“å…·å¤‡å†™åŠŸèƒ½å—ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œåªä¼šåŠ å‰§ä¸»ä»çš„æ•°æ®ä¸ä¸€è‡´","like_count":0},{"had_liked":false,"id":261821,"user_name":"è“å£«é’¦","can_delete":false,"product_type":"c1","uid":1229516,"ip_address":"","ucode":"726EB5C8EF1249","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/cc/ca22bb7c.jpg","comment_is_top":false,"comment_ctime":1605531803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605531803","product_id":100056701,"comment_content":"ä¸ºäº†ä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨ï¼Œæ€•å‡ºæ•…éšœï¼Œé‡‡ç”¨åŒå†™åˆ°ä¸¤ä¸ªMasterï¼Œç„¶åä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å»åšRedisé—´çš„åŒæ­¥ã€‚æƒ³é—®ä¸€ä¸‹è¿™ç§çš„å‘æ˜¯ä¸æ˜¯æ¯”ä¸»ä»æ¨¡å¼æ›´å®¹æ˜“åŸ‹ä¸‹éšæ‚£ï¼Ÿå› ä¸ºè¿˜æ˜¯ä¼šæœ‰å¤åˆ¶å»¶è¿Ÿï¼Œä¸¢å¤±æ•°æ®ã€‚<br>ä¸»è¦æ€•å‡ºæ•…éšœæ—¶æœåŠ¡å®Œå…¨ä¸å¯ç”¨ï¼Œæ‰€ä»¥å…¨é‡æ•°æ®åŒå†™ã€åŒå¤‡ï¼ŒåŒå‘åŒæ­¥ã€‚<br>ä¸äº†è§£é›†ç¾¤çš„Redisæ•…éšœåä¸»ä»åˆ‡æ¢æ˜¯ä¸æ˜¯è‡ªåŠ¨çš„ï¼Œå‡ºæ•…éšœååˆ‡æ¢çš„æ—¶é—´è¦å¤šä¹…ï¼Œå®¢æˆ·ç«¯æœ‰æ„ŸçŸ¥å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":258574,"user_name":"DKSky","can_delete":false,"product_type":"c1","uid":1336009,"ip_address":"","ucode":"69371A81033949","user_header":"https://static001.geekbang.org/account/avatar/00/14/62/c9/7da27891.jpg","comment_is_top":false,"comment_ctime":1604487672,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604487672","product_id":100056701,"comment_content":"å…³äºprotected modeçš„é—®é¢˜ï¼Œå¦‚æœè®¾ç½®äº†yesï¼Œéœ€è¦è®¾ç½®authå’Œbindï¼Œæ‰å¯ä»¥è¿œç¨‹è®¿é—®å§ï¼Ÿ<br>Protected mode is a layer of security protection, in order to avoid that<br>Redis instances left open on the internet are accessed and exploited.<br><br>When protected mode is on and if:<br><br>1) The server is not binding explicitly to a set of addresses using the<br>   &quot;bind&quot; directive.<br>2) No password is configured.<br><br>The server only accepts connections from clients connecting from the<br>IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain<br>sockets.<br><br>By default protected mode is enabled. You should disable it only if<br>you are sure you want clients from other hosts to connect to Redis<br>even if no authentication is configured, nor a specific set of interfaces<br>are explicitly listed using the &quot;bind&quot; directive.<br>","like_count":0},{"had_liked":false,"id":258497,"user_name":"è‚–é¹","can_delete":false,"product_type":"c1","uid":1302602,"ip_address":"","ucode":"BE1B8BD7053B9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/4a/c0a3cb3f.jpg","comment_is_top":false,"comment_ctime":1604462411,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604462411","product_id":100056701,"comment_content":"æœ‰ä¸ªæ— å…³é—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼Œredis cluster,æ¯éš”ä¸€å°æ—¶ï¼Œå‘ç°è¿æ¥æ•°ä¼šæœ‰ä¸€ä¸ªå‡¸èµ·ï¼Œå¢åŠ 1600å·¦å³ï¼Œç„¶åå†é™ä½åˆ°æ­£å¸¸æ°´å¹³ï¼Œæ²¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1102245,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d1/a5/2bbedc3b.jpg","nickname":"over","note":"","ucode":"FE272AC19842D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385769,"discussion_content":"è¿æ¥è¶…æ—¶é‡è¿ï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627267435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258211,"user_name":"Geek_9a0c9f","can_delete":false,"product_type":"c1","uid":2159835,"ip_address":"","ucode":"2A6078F740881F","user_header":"","comment_is_top":false,"comment_ctime":1604326284,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604326284","product_id":100056701,"comment_content":"æˆ‘ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œredisçš„è¯»å†™æ˜¯åˆ†ç¦»çš„ä¹ˆï¼Œä¹‹å‰è®²çš„ä¸æ˜¯ä¸»åº“è¯»å†™éƒ½è¡Œï¼Œä»åº“åªèƒ½è¯»ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1477612,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg","nickname":"å¼ å¤©å±¹","note":"","ucode":"8BD6BD6DCF0F4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343702,"discussion_content":"æ˜¯åªèƒ½è¯»å•Šï¼Œä½†æ˜¯å› ä¸ºåŒæ­¥æœ‰å»¶è¿Ÿï¼Œä¸»åº“åˆšåˆšå†™å…¥/åˆ é™¤çš„æ•°æ®ï¼Œå¯¹äºä»åº“ä¸èƒ½ç«‹å³å¯è§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611141123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258095,"user_name":"yeek","can_delete":false,"product_type":"c1","uid":1020629,"ip_address":"","ucode":"A1C71023113CB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/d5/699384a0.jpg","comment_is_top":false,"comment_ctime":1604295644,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604295644","product_id":100056701,"comment_content":"ä¸»ä»åŒå†™ä¼šå¸¦æ¥ä¸å°‘é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨è¿›è¡Œrediså‚ç›´æ‹†åˆ†çš„æ—¶å€™ï¼Œçº¿ä¸Šä¸åœæœæ›´æ–°ï¼Œä¼šçŸ­æš‚æ‰“å¼€ä»åº“å†™åŠŸèƒ½","like_count":0,"discussions":[{"author":{"id":2253496,"avatar":"","nickname":"Geek_3d87cb","note":"","ucode":"F09334D60C3BC8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378444,"discussion_content":"ä»åº“å†™æ€ä¹ˆåŒæ­¥åˆ°ä¸»åº“å‘¢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623223781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258090,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1604293357,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604293357","product_id":100056701,"comment_content":"slave-serve-stale-dataæ˜¯åœ¨ä¸»ä»å¤åˆ¶ä¸­ä»æœåŠ¡å™¨æ˜¯å¦å¯ä»¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œslave-read-only æ˜¯è®¾ç½®ä»åº“èƒ½å¦å¤„ç†å†™å‘½ä»¤ã€‚<br><br>æŠŠ slave-read-only è®¾ç½®ä¸º noï¼Œè®©ä»åº“ä¹Ÿèƒ½ç›´æ¥åˆ é™¤æ•°æ®ï¼Œä¼šé€ æˆä¸»ä»ä¸ä¸€è‡´ï¼Œä¸æ¨èä½¿ç”¨ã€‚<br><br>","like_count":0}]}