{"id":184039,"title":"28 | MongoDB监控最佳实践","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":174066,"user_name":"月迷津渡","can_delete":false,"product_type":"c3","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1579939913,"is_pvip":false,"replies":[{"id":67801,"content":"db.oplog.rs.find() 返回的是一个游标，不是最终的数据。\n\n需要从游标取数据，就要调用cursor.next() 方法。\n\n参见\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;tutorial&#47;iterate-a-cursor&#47;","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580253908,"ip_address":"","comment_id":174066,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师问个问题 ops window这块 命令为啥要next 呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482288,"discussion_content":"db.oplog.rs.find() 返回的是一个游标，不是最终的数据。\n\n需要从游标取数据，就要调用cursor.next() 方法。\n\n参见\nhttps://docs.mongodb.com/manual/tutorial/iterate-a-cursor/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580253908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168819,"user_name":"注意力$","can_delete":false,"product_type":"c3","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1578192710,"is_pvip":false,"replies":[{"id":66772,"content":"mongostat 可以看到实时的每秒性能指标。\n更多的就要用一些外部监控工具，如MongoDB官方的Ops Manager 或者 Percona 的监控工具。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579132470,"ip_address":"","comment_id":168819,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师 serverstatus（）的监控信息是累计数据，如果上去排查性能问题，故障时需要看当时的性能情况，那这些数据库的指标应该怎么看呢","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480345,"discussion_content":"mongostat 可以看到实时的每秒性能指标。\n更多的就要用一些外部监控工具，如MongoDB官方的Ops Manager 或者 Percona 的监控工具。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579132470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142316,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","nickname":"注意力$","note":"","ucode":"7FB3399A1EAB72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120507,"discussion_content":"好的谢谢朋友","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578278732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119817,"discussion_content":"定期取值然后做减法。比如zabbix就可以满足要求。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578237298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167991,"user_name":"撑伞也是雨中人。","can_delete":false,"product_type":"c3","uid":1610634,"ip_address":"","ucode":"743F23626ACF53","user_header":"https://static001.geekbang.org/account/avatar/00/18/93/8a/2b78f44d.jpg","comment_is_top":false,"comment_ctime":1577972965,"is_pvip":false,"replies":[{"id":66840,"content":"不太明白你的问题？监控的文本指的是？","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579167914,"ip_address":"","comment_id":167991,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师 能够提供一下这些监控的文本吗 我也是db版本也是4.2.2，貌似不能按照PPT内容获取到对应的值","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480089,"discussion_content":"不太明白你的问题？监控的文本指的是？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579167914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309984,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","nickname":"cheriston","note":"","ucode":"617CBFCE0925C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":115518,"discussion_content":"PMM  percona 提供的开源的监控工具 mongodb  mysql\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578017287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1309984,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","nickname":"cheriston","note":"","ucode":"617CBFCE0925C4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119893,"discussion_content":"大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578238167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":115518,"ip_address":"","group_id":0},"score":119893,"extra":""}]}]},{"had_liked":false,"id":331933,"user_name":"po","can_delete":false,"product_type":"c3","uid":1023905,"ip_address":"","ucode":"7DB36C278F34D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","comment_is_top":false,"comment_ctime":1642905866,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"新增的从节点数据复制也是用复制时间窗的机制吗？如果是，那么很长时间的数据不是没法复制了？","like_count":1},{"had_liked":false,"id":275185,"user_name":"Geek_32772e","can_delete":false,"product_type":"c3","uid":1446158,"ip_address":"","ucode":"2850EF64F4775F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoribOUgcicu1sOqZZVtPqpSDSS43vicxW0GesxQeBRjUC47CzulKSzYNj2aMg9YOZDdjPdAZxS3jNcQ/132","comment_is_top":false,"comment_ctime":1611375946,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"如何能找到访问MongoDB的IP信息，访问的IP地址、开始结束时长、访问方式等等？后端怀疑我们经常查他们的MongoDB，但是又不确定是我们的机器访问的，总是让我们给他们发同步数据的时间，导致我们也很麻烦","like_count":0,"discussions":[{"author":{"id":1998387,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/7e/33/b16f6c0a.jpg","nickname":"黄叶舞东风","note":"","ucode":"4E6F5C37819420","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389145,"discussion_content":"查日志","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629157784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270698,"user_name":"噜噜噜","can_delete":false,"product_type":"c3","uid":1984457,"ip_address":"","ucode":"B37C2CD3B836DB","user_header":"https://static001.geekbang.org/account/avatar/00/1e/47/c9/1bf79dfa.jpg","comment_is_top":false,"comment_ctime":1609222370,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师有没有讲过chunk细节相关的，比如分裂和迁移","like_count":0},{"had_liked":false,"id":190739,"user_name":"海上魔术师","can_delete":false,"product_type":"c3","uid":1717086,"ip_address":"","ucode":"393A68DD284A15","user_header":"https://static001.geekbang.org/account/avatar/00/1a/33/5e/6354d6f5.jpg","comment_is_top":false,"comment_ctime":1584688796,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师，如果是分片集，连接数的这个监控指标，是不是在mongos下获取更加准确呢？ ","like_count":0}]}