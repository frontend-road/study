{"id":140079,"title":"38 | å¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•æé«˜äº¤ä»˜è´¨é‡ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆèˆªã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ä½ åˆ†äº«äº†å¦‚ä½•åˆ†æå¹¶ä¼˜åŒ–Flutteråº”ç”¨çš„æ€§èƒ½é—®é¢˜ã€‚é€šè¿‡åœ¨çœŸæœºä¸Šä»¥åˆ†ææ¨¡å¼è¿è¡Œåº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºæ€§èƒ½å›¾å±‚çš„å¸®åŠ©ï¼Œæ‰¾åˆ°å¼•èµ·æ€§èƒ½ç“¶é¢ˆçš„ä¸¤ç±»é—®é¢˜ï¼Œå³GPUæ¸²æŸ“é—®é¢˜å’ŒCPUæ‰§è¡Œè€—æ—¶é—®é¢˜ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Flutteræä¾›çš„æ¸²æŸ“å¼€å…³å’ŒCPUå¸§å›¾ï¼ˆç«ç„°å›¾ï¼‰ï¼Œæ¥æ£€æŸ¥åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨è¿‡åº¦æ¸²æŸ“æˆ–æ˜¯ä»£ç æ‰§è¡Œè€—æ—¶é•¿çš„æƒ…å†µï¼Œä»è€Œå»å®šä½å¹¶ç€æ‰‹è§£å†³åº”ç”¨çš„æ€§èƒ½é—®é¢˜äº†ã€‚</p><p>åœ¨å®Œæˆäº†åº”ç”¨çš„å¼€å‘å·¥ä½œï¼Œå¹¶è§£å†³äº†ä»£ç ä¸­çš„é€»è¾‘é—®é¢˜å’Œæ€§èƒ½é—®é¢˜ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦æµ‹è¯•éªŒæ”¶åº”ç”¨çš„å„é¡¹åŠŸèƒ½è¡¨ç°äº†ã€‚ç§»åŠ¨åº”ç”¨çš„æµ‹è¯•å·¥ä½œé‡é€šå¸¸å¾ˆå¤§ï¼Œè¿™æ˜¯å› ä¸ºä¸ºäº†éªŒè¯çœŸå®ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œæµ‹è¯•å¾€å¾€éœ€è¦è·¨è¶Šå¤šä¸ªå¹³å°ï¼ˆAndroid/iOSï¼‰åŠä¸åŒçš„ç‰©ç†è®¾å¤‡æ‰‹åŠ¨å®Œæˆã€‚</p><p>éšç€äº§å“åŠŸèƒ½ä¸æ–­è¿­ä»£ç´¯ç§¯ï¼Œæµ‹è¯•å·¥ä½œé‡å’Œå¤æ‚åº¦ä¹Ÿéšä¹‹å¤§å¹…å¢é•¿ï¼Œæ‰‹åŠ¨æµ‹è¯•å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚é‚£ä¹ˆï¼Œåœ¨ä¸ºäº§å“æ·»åŠ æ–°åŠŸèƒ½ï¼Œæˆ–è€…ä¿®æ”¹å·²æœ‰åŠŸèƒ½æ—¶ï¼Œå¦‚ä½•æ‰èƒ½ç¡®ä¿åº”ç”¨å¯ä»¥ç»§ç»­æ­£å¸¸å·¥ä½œå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œé€šè¿‡ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>æ‰€è°“è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ˜¯æŠŠç”±äººé©±åŠ¨çš„æµ‹è¯•è¡Œä¸ºæ”¹ä¸ºç”±æœºå™¨æ‰§è¡Œã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç”±æœºå™¨æŒ‰ç…§æ‰§è¡Œæ­¥éª¤å¯¹åº”ç”¨è¿›è¡Œè‡ªåŠ¨æµ‹è¯•ï¼Œå¹¶è¾“å‡ºæ‰§è¡Œç»“æœï¼Œæœ€åæ ¹æ®æµ‹è¯•ç”¨ä¾‹å®šä¹‰çš„è§„åˆ™ç¡®å®šç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><!-- [[[read_end]]] --><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å°†é‡å¤çš„ã€æœºæ¢°çš„äººå·¥æ“ä½œå˜ä¸ºè‡ªåŠ¨åŒ–çš„éªŒè¯æ­¥éª¤ï¼Œæå¤§çš„èŠ‚çœäººåŠ›ã€æ—¶é—´å’Œç¡¬ä»¶èµ„æºï¼Œä»è€Œæé«˜äº†æµ‹è¯•æ•ˆç‡ã€‚</p><p>åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™ä¸Šï¼ŒFlutteræä¾›äº†åŒ…æ‹¬å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•çš„èƒ½åŠ›ã€‚å…¶ä¸­ï¼Œå•å…ƒæµ‹è¯•å¯ä»¥æ–¹ä¾¿åœ°éªŒè¯å•ä¸ªå‡½æ•°ã€æ–¹æ³•æˆ–ç±»çš„è¡Œä¸ºï¼Œè€ŒUIæµ‹è¯•åˆ™æä¾›äº†ä¸Widgetè¿›è¡Œäº¤äº’çš„èƒ½åŠ›ï¼Œç¡®è®¤å…¶åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…·ä½“çœ‹çœ‹è¿™ä¸¤ç§è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹çš„ç”¨æ³•å§ã€‚</p><h2>å•å…ƒæµ‹è¯•</h2><p>å•å…ƒæµ‹è¯•æ˜¯æŒ‡ï¼Œå¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡ŒéªŒè¯çš„æ–¹å¼ï¼Œå¹¶é€šè¿‡éªŒè¯ç»“æœæ¥ç¡®å®šæœ€å°å•å…ƒçš„è¡Œä¸ºæ˜¯å¦ä¸é¢„æœŸä¸€è‡´ã€‚æ‰€è°“æœ€å°å¯æµ‹è¯•å•å…ƒï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå°±æ˜¯äººä¸ºè§„å®šçš„ã€æœ€å°çš„è¢«æµ‹åŠŸèƒ½æ¨¡å—ï¼Œæ¯”å¦‚è¯­å¥ã€å‡½æ•°ã€æ–¹æ³•æˆ–ç±»ã€‚</p><p>åœ¨Flutterä¸­ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨pubspec.yamlæ–‡ä»¶ä¸­ä½¿ç”¨teståŒ…æ¥å®Œæˆã€‚å…¶ä¸­ï¼ŒteståŒ…æä¾›äº†ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„æ ¸å¿ƒæ¡†æ¶ï¼Œå³å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå°±æ˜¯teståŒ…çš„ç”¨æ³•ï¼š</p><pre><code>dev_dependencies:\n  test:\n</code></pre><blockquote>\n<p>å¤‡æ³¨ï¼šteståŒ…çš„å£°æ˜éœ€è¦åœ¨dev_dependenciesä¸‹å®Œæˆï¼Œåœ¨è¿™ä¸ªæ ‡ç­¾ä¸‹é¢å®šä¹‰çš„åŒ…åªä¼šåœ¨å¼€å‘æ¨¡å¼ç”Ÿæ•ˆã€‚</p>\n</blockquote><p>ä¸Flutteråº”ç”¨é€šè¿‡mainå‡½æ•°å®šä¹‰ç¨‹åºå…¥å£ç›¸åŒï¼ŒFlutterå•å…ƒæµ‹è¯•ç”¨ä¾‹ä¹Ÿæ˜¯é€šè¿‡mainå‡½æ•°æ¥å®šä¹‰æµ‹è¯•å…¥å£çš„ã€‚ä¸è¿‡ï¼Œ<strong>è¿™ä¸¤ä¸ªç¨‹åºå…¥å£çš„ç›®å½•ä½ç½®æœ‰äº›åŒºåˆ«</strong>ï¼šåº”ç”¨ç¨‹åºçš„å…¥å£ä½äºå·¥ç¨‹ä¸­çš„libç›®å½•ä¸‹ï¼Œè€Œæµ‹è¯•ç”¨ä¾‹çš„å…¥å£ä½äºå·¥ç¨‹ä¸­çš„testç›®å½•ä¸‹ã€‚</p><p>ä¸€ä¸ªæœ‰ç€å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„Flutterå·¥ç¨‹ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/43/f7/436f402015d289528725e69f42ec9ef7.png?wh=942*472\" alt=\"\"></p><center><span class=\"reference\">å›¾1 Flutterå·¥ç¨‹ç›®å½•ç»“æ„</span></center><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨main.dartä¸­å£°æ˜ä¸€ä¸ªç”¨æ¥æµ‹è¯•çš„ç±»äº†ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªè®¡æ•°å™¨ç±»Counterï¼Œè¿™ä¸ªç±»å¯ä»¥æ”¯æŒä»¥é€’å¢æˆ–é€’å‡çš„æ–¹å¼ä¿®æ”¹è®¡æ•°å€¼countï¼š</p><pre><code>class Counter {\n  int count = 0;\n  void increase() =&gt; count++;\n  void decrease() =&gt; count--;\n}\n</code></pre><p>å®ç°å®Œå¾…æµ‹è¯•çš„ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºå®ƒç¼–å†™æµ‹è¯•ç”¨ä¾‹äº†ã€‚<strong>åœ¨Flutterä¸­ï¼Œæµ‹è¯•ç”¨ä¾‹çš„å£°æ˜åŒ…å«å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯ä¸‰ä¸ªéƒ¨åˆ†ï¼š</strong>å®šä¹‰å’Œæ‰§è¡Œå†³å®šäº†è¢«æµ‹è¯•å¯¹è±¡æä¾›çš„ã€éœ€è¦éªŒè¯çš„æœ€å°å¯æµ‹å•å…ƒï¼›è€ŒéªŒè¯åˆ™éœ€è¦ä½¿ç”¨expectå‡½æ•°ï¼Œå°†æœ€å°å¯æµ‹å•å…ƒçš„æ‰§è¡Œç»“æœä¸é¢„æœŸè¿›è¡Œæ¯”è¾ƒã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨Flutterä¸­ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹ä¸¤å¤§æ­¥éª¤ï¼š</p><ol>\n<li>å®ç°ä¸€ä¸ªåŒ…å«å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯æ­¥éª¤çš„æµ‹è¯•ç”¨ä¾‹ï¼›</li>\n<li>å°†å…¶åŒ…è£…åœ¨testå†…éƒ¨ï¼Œtestæ˜¯Flutteræä¾›çš„æµ‹è¯•ç”¨ä¾‹å°è£…ç±»ã€‚</li>\n</ol><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªç”¨ä¾‹ç”¨æ¥éªŒè¯è°ƒç”¨increaseå‡½æ•°åçš„è®¡æ•°å™¨å€¼æ˜¯å¦ä¸º1ï¼Œè€Œç¬¬äºŒä¸ªç”¨ä¾‹åˆ™ç”¨æ¥åˆ¤æ–­1+1æ˜¯å¦ç­‰äº2ï¼š</p><pre><code>import 'package:test/test.dart';\nimport 'package:flutter_app/main.dart';\n\nvoid main() {\n  //ç¬¬ä¸€ä¸ªç”¨ä¾‹ï¼Œåˆ¤æ–­Counterå¯¹è±¡è°ƒç”¨increaseæ–¹æ³•åæ˜¯å¦ç­‰äº1\n  test('Increase a counter value should be 1', () {\n    final counter = Counter();\n    counter.increase();\n    expect(counter.value, 1);\n  });\n  //ç¬¬äºŒä¸ªç”¨ä¾‹ï¼Œåˆ¤æ–­1+1æ˜¯å¦ç­‰äº2\n  test('1+1 should be 2', () {\n    expect(1+1, 2);\n  });\n}\n</code></pre><p>é€‰æ‹©widget_test.dartæ–‡ä»¶ï¼Œåœ¨å³é”®å¼¹å‡ºçš„èœå•ä¸­é€‰æ‹©â€œRun â€˜tests in widget_testâ€™â€ï¼Œå°±å¯ä»¥å¯åŠ¨æµ‹è¯•ç”¨ä¾‹äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c0/c2/c0f59369d9af26b3705daee16da352c2.png?wh=846*1314\" alt=\"\"></p><center><span class=\"reference\">å›¾2 å¯åŠ¨æµ‹è¯•ç”¨ä¾‹å…¥å£</span></center><p>ç¨ç­‰ç‰‡åˆ»ï¼Œæ§åˆ¶å°å°±ä¼šè¾“å‡ºæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œç»“æœäº†ã€‚å½“ç„¶ï¼Œè¿™ä¸¤ä¸ªç”¨ä¾‹éƒ½èƒ½é€šè¿‡æµ‹è¯•ï¼š</p><pre><code>22:05\tTests passed: 2\n</code></pre><p><strong>å¦‚æœæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œç»“æœæ˜¯ä¸é€šè¿‡ï¼ŒFlutterä¼šç»™æˆ‘ä»¬æ€æ ·çš„æç¤ºå‘¢ï¼Ÿ</strong>æˆ‘ä»¬è¯•ç€ä¿®æ”¹ä¸€ä¸‹ç¬¬ä¸€ä¸ªè®¡æ•°å™¨é€’å¢çš„ç”¨ä¾‹ï¼Œå°†å®ƒçš„æœŸæœ›ç»“æœæ”¹ä¸º2ï¼š</p><pre><code>test('Increase a counter value should be 1', () {\n  final counter = Counter();\n  counter.increase();\n  expect(counter.value, 2);//åˆ¤æ–­Counterå¯¹è±¡è°ƒç”¨increaseåæ˜¯å¦ç­‰äº2\n});\n</code></pre><p>è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒFlutteråœ¨æ‰§è¡Œå®Œè®¡æ•°å™¨çš„é€’å¢æ–¹æ³•åï¼Œå‘ç°å…¶ç»“æœ1ä¸é¢„æœŸçš„2ä¸åŒ¹é…ï¼Œäºæ˜¯æŠ¥é”™ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/40/fe030c283a78c133787d03eca8a3f240.png?wh=1052*290\" alt=\"\"></p><center><span class=\"reference\">å›¾3 å•å…ƒæµ‹è¯•å¤±è´¥ç¤ºæ„å›¾</span></center><p>ä¸Šé¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å•ä¸ªæµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™æ–¹æ³•ï¼Œè€Œ<strong>å¦‚æœæœ‰å¤šä¸ªæµ‹è¯•ç”¨ä¾‹</strong>ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å­˜åœ¨å…³è”å…³ç³»çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€å¤–å±‚ä½¿ç”¨groupå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†è®¡æ•°å™¨é€’å¢å’Œè®¡æ•°å™¨é€’å‡ä¸¤ä¸ªç”¨ä¾‹ï¼ŒéªŒè¯é€’å¢çš„ç»“æœæ˜¯å¦ç­‰äº1çš„åŒæ—¶åˆ¤æ–­é€’å‡çš„ç»“æœæ˜¯å¦ç­‰äº-1ï¼Œå¹¶æŠŠå®ƒä»¬ç»„åˆåœ¨äº†ä¸€èµ·ï¼š</p><pre><code>import 'package:test/test.dart';\nimport 'package:counter_app/counter.dart';\nvoid main() {\n  //ç»„åˆæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ¤æ–­Counterå¯¹è±¡è°ƒç”¨increaseæ–¹æ³•åæ˜¯å¦ç­‰äº1ï¼Œå¹¶ä¸”åˆ¤æ–­Counterå¯¹è±¡è°ƒç”¨decreaseæ–¹æ³•åæ˜¯å¦ç­‰äº-1\n  group('Counter', () {\n    test('Increase a counter value should be 1', () {\n      final counter = Counter();\n      counter.increase();\n      expect(counter.value, 1);\n    });\n\n    test('Decrease a counter value should be -1', () {\n      final counter = Counter();\n      counter.decrease();\n      expect(counter.value, -1);\n    });\n  });\n}\n</code></pre><p>åŒæ ·çš„ï¼Œè¿™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œç»“æœä¹Ÿæ˜¯é€šè¿‡ã€‚</p><p><strong>åœ¨å¯¹ç¨‹åºçš„å†…éƒ¨åŠŸèƒ½è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½éœ€è¦ä»å¤–éƒ¨ä¾èµ–ï¼ˆæ¯”å¦‚WebæœåŠ¡ï¼‰è·å–éœ€è¦æµ‹è¯•çš„æ•°æ®ã€‚</strong>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼ŒTodoå¯¹è±¡çš„åˆå§‹åŒ–å°±æ˜¯é€šè¿‡WebæœåŠ¡è¿”å›çš„JSONå®ç°çš„ã€‚è€ƒè™‘åˆ°è°ƒç”¨WebæœåŠ¡çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¤„ç†äº†è¯·æ±‚ç ä¸ç­‰äº200çš„å…¶ä»–å¼‚å¸¸æƒ…å†µï¼š</p><pre><code>import 'package:http/http.dart' as http;\n\nclass Todo {\n  final String title;\n  Todo({this.title});\n  //å·¥å‚ç±»æ„é€ æ–¹æ³•ï¼Œå°†JSONè½¬æ¢ä¸ºå¯¹è±¡\n  factory Todo.fromJson(Map&lt;String, dynamic&gt; json) {\n    return Todo(     \n      title: json['title'],\n    );\n  }\n}\n\nFuture&lt;Todo&gt; fetchTodo(http.Client client) async {\n  final response =\n  await client.get('https://xxx.com/todos/1');\n\n  if (response.statusCode == 200) {\n    //è¯·æ±‚æˆåŠŸï¼Œè§£æJSON\n    return Todo.fromJson(json.decode(response.body));\n  } else {\n    //è¯·æ±‚å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸\n    throw Exception('Failed to load post');\n  }\n}\n</code></pre><p>è€ƒè™‘åˆ°è¿™äº›å¤–éƒ¨ä¾èµ–å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ç¨‹åºæ‰€èƒ½æ§åˆ¶çš„ï¼Œå› æ­¤å¾ˆéš¾è¦†ç›–æ‰€æœ‰å¯èƒ½çš„æˆåŠŸæˆ–å¤±è´¥æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼Œå¯¹äºä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„WebæœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸å¯èƒ½æµ‹è¯•å‡ºfetchTodoè¿™ä¸ªæ¥å£æ˜¯å¦‚ä½•åº”å¯¹403æˆ–502çŠ¶æ€ç çš„ã€‚å› æ­¤ï¼Œæ›´å¥½çš„ä¸€ä¸ªåŠæ³•æ˜¯ï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹ä¸­â€œæ¨¡æ‹Ÿâ€è¿™äº›å¤–éƒ¨ä¾èµ–ï¼ˆå¯¹åº”æœ¬ä¾‹å³ä¸ºhttp.clientï¼‰ï¼Œè®©è¿™äº›å¤–éƒ¨ä¾èµ–å¯ä»¥è¿”å›ç‰¹å®šç»“æœã€‚</p><p>åœ¨å•å…ƒæµ‹è¯•ç”¨ä¾‹ä¸­æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼Œæˆ‘ä»¬éœ€è¦åœ¨pubspec.yamlæ–‡ä»¶ä¸­ä½¿ç”¨mockitoåŒ…ï¼Œä»¥æ¥å£å®ç°çš„æ–¹å¼å®šä¹‰å¤–éƒ¨ä¾èµ–çš„æ¥å£ï¼š</p><pre><code>dev_dependencies:\n  test: \n  mockito:\n</code></pre><p>è¦<strong>ä½¿ç”¨mockitoåŒ…æ¥æ¨¡æ‹ŸfetchTodoçš„ä¾èµ–http.client</strong>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ªMockï¼ˆè¿™ä¸ªç±»å¯ä»¥æ¨¡æ‹Ÿä»»ä½•å¤–éƒ¨ä¾èµ–ï¼‰ï¼Œå¹¶ä»¥æ¥å£å®šä¹‰çš„æ–¹å¼å®ç°äº†http.clientçš„æ¨¡æ‹Ÿç±»ï¼›ç„¶åï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹çš„å£°æ˜ä¸­ï¼Œä¸ºå…¶åˆ¶å®šä»»æ„çš„æ¥å£è¿”å›ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ¨¡æ‹Ÿç±»MockClientï¼Œè¿™ä¸ªç±»ä»¥æ¥å£å£°æ˜çš„æ–¹å¼è·å–åˆ°äº†http.Clientçš„å¤–éƒ¨æ¥å£ã€‚éšåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨whenè¯­å¥ï¼Œåœ¨å…¶è°ƒç”¨WebæœåŠ¡æ—¶ï¼Œä¸ºå…¶æ³¨å…¥ç›¸åº”çš„æ•°æ®è¿”å›äº†ã€‚åœ¨ç¬¬ä¸€ä¸ªç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºå…¶æ³¨å…¥äº†JSONç»“æœï¼›è€Œåœ¨ç¬¬äºŒä¸ªç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ºå…¶æ³¨å…¥äº†ä¸€ä¸ª403çš„å¼‚å¸¸ã€‚</p><pre><code>import 'package:mockito/mockito.dart';\nimport 'package:http/http.dart' as http;\n\nclass MockClient extends Mock implements http.Client {}\n\nvoid main() {\n  group('fetchTodo', () {\n  test('returns a Todo if successful', () async {\n    final client = MockClient();\n\n    //ä½¿ç”¨Mockitoæ³¨å…¥è¯·æ±‚æˆåŠŸçš„JSONå­—æ®µ\n    when(client.get('https://xxx.com/todos/1'))\n        .thenAnswer((_) async =&gt; http.Response('{&quot;title&quot;: &quot;Test&quot;}', 200));\n    //éªŒè¯è¯·æ±‚ç»“æœæ˜¯å¦ä¸ºTodoå®ä¾‹\n    expect(await fetchTodo(client), isInstanceOf&lt;Todo&gt;());\n  });\n\n  test('throws an exception if error', () {\n    final client = MockClient();\n\n    //ä½¿ç”¨Mockitoæ³¨å…¥è¯·æ±‚å¤±è´¥çš„Error\n    when(client.get('https://xxx.com/todos/1'))\n        .thenAnswer((_) async =&gt; http.Response('Forbidden', 403));\n    //éªŒè¯è¯·æ±‚ç»“æœæ˜¯å¦æŠ›å‡ºå¼‚å¸¸\n    expect(fetchTodo(client), throwsException);\n  });\n});\n}\n</code></pre><p>è¿è¡Œè¿™æ®µæµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨æ²¡æœ‰è°ƒç”¨çœŸå®WebæœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒæˆåŠŸæ¨¡æ‹Ÿå‡ºäº†æ­£å¸¸å’Œå¼‚å¸¸ä¸¤ç§ç»“æœï¼ŒåŒæ ·ä¹Ÿæ˜¯é¡ºåˆ©é€šè¿‡éªŒè¯äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹UIæµ‹è¯•å§ã€‚</p><h2>UIæµ‹è¯•</h2><p>UIæµ‹è¯•çš„ç›®çš„æ˜¯æ¨¡ä»¿çœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œå³ä»¥çœŸå®ç”¨æˆ·çš„èº«ä»½å¯¹åº”ç”¨ç¨‹åºæ‰§è¡ŒUIäº¤äº’æ“ä½œï¼Œå¹¶æ¶µç›–å„ç§ç”¨æˆ·æµç¨‹ã€‚ç›¸æ¯”äºå•å…ƒæµ‹è¯•ï¼ŒUIæµ‹è¯•çš„è¦†ç›–èŒƒå›´æ›´å¹¿ã€æ›´å…³æ³¨æµç¨‹å’Œäº¤äº’ï¼Œå¯ä»¥æ‰¾åˆ°å•å…ƒæµ‹è¯•æœŸé—´æ— æ³•æ‰¾åˆ°çš„é”™è¯¯ã€‚</p><p>åœ¨Flutterä¸­ç¼–å†™UIæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨pubspec.yamlä¸­ä½¿ç”¨flutter_teståŒ…ï¼Œæ¥æä¾›ç¼–å†™<strong>UIæµ‹è¯•çš„æ ¸å¿ƒæ¡†æ¶</strong>ï¼Œå³å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯ï¼š</p><ul>\n<li>\n<p>å®šä¹‰ï¼Œå³é€šè¿‡æŒ‡å®šè§„åˆ™ï¼Œæ‰¾åˆ°UIæµ‹è¯•ç”¨ä¾‹éœ€è¦éªŒè¯çš„ã€ç‰¹å®šçš„å­Widgetå¯¹è±¡ï¼›</p>\n</li>\n<li>\n<p>æ‰§è¡Œï¼Œæ„å‘³ç€æˆ‘ä»¬è¦åœ¨æ‰¾åˆ°çš„å­Widgetå¯¹è±¡ä¸­ï¼Œæ–½åŠ ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼›</p>\n</li>\n<li>\n<p>éªŒè¯ï¼Œè¡¨ç¤ºåœ¨æ–½åŠ äº†äº¤äº’äº‹ä»¶åï¼Œåˆ¤æ–­å¾…éªŒè¯çš„Widgetå¯¹è±¡çš„æ•´ä½“è¡¨ç°æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>\n</li>\n</ul><p>å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œå°±æ˜¯flutter_teståŒ…çš„ç”¨æ³•ï¼š</p><pre><code>dev_dependencies:\n  flutter_test:\n    sdk: flutter\n\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¥Flutteré»˜è®¤çš„è®¡æ—¶å™¨åº”ç”¨æ¨¡æ¿ä¸ºä¾‹ï¼Œä¸ä½ è¯´æ˜<strong>UIæµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™æ–¹æ³•</strong>ã€‚</p><p>åœ¨è®¡æ•°å™¨åº”ç”¨ä¸­ï¼Œæœ‰ä¸¤å¤„åœ°æ–¹ä¼šå“åº”å¤–éƒ¨äº¤äº’äº‹ä»¶ï¼ŒåŒ…æ‹¬å“åº”ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºçš„æŒ‰é’®Iconï¼Œä¸å“åº”æ¸²æŸ“åˆ·æ–°äº‹ä»¶çš„æ–‡æœ¬Textã€‚æŒ‰é’®ç‚¹å‡»åï¼Œè®¡æ•°å™¨ä¼šç´¯åŠ ï¼Œæ–‡æœ¬ä¹Ÿéšä¹‹åˆ·æ–°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/55/03/5510a86c0d7a25a3c1f3366e485f4c03.png?wh=828*1792\" alt=\"\"></p><center><span class=\"reference\">å›¾4 è®¡æ•°å™¨ç¤ºä¾‹</span></center><p>ä¸ºç¡®ä¿ç¨‹åºçš„åŠŸèƒ½æ­£å¸¸ï¼Œæˆ‘ä»¬å¸Œæœ›ç¼–å†™ä¸€ä¸ªUIæµ‹è¯•ç”¨ä¾‹ï¼Œæ¥éªŒè¯æŒ‰é’®çš„ç‚¹å‡»è¡Œä¸ºæ˜¯å¦ä¸æ–‡æœ¬çš„åˆ·æ–°è¡Œä¸ºå®Œå…¨åŒ¹é…ã€‚</p><p>ä¸å•å…ƒæµ‹è¯•ä½¿ç”¨testå¯¹ç”¨ä¾‹è¿›è¡ŒåŒ…è£…ç±»ä¼¼ï¼Œ<strong>UIæµ‹è¯•ä½¿ç”¨testWidgetså¯¹ç”¨ä¾‹è¿›è¡ŒåŒ…è£…</strong>ã€‚testWidgetsæä¾›äº†testerå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå®ä¾‹æ¥æ“ä½œéœ€è¦æµ‹è¯•çš„Widgetå¯¹è±¡ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬<strong>é¦–å…ˆ</strong>å£°æ˜äº†éœ€è¦éªŒè¯çš„MyAppå¯¹è±¡ã€‚åœ¨é€šè¿‡pumpWidgetè§¦å‘å…¶å®Œæˆæ¸²æŸ“åï¼Œä½¿ç”¨find.textæ–¹æ³•åˆ†åˆ«æŸ¥æ‰¾äº†å­—ç¬¦ä¸²æ–‡æœ¬ä¸º0å’Œ1çš„Textæ§ä»¶ï¼Œç›®çš„æ˜¯éªŒè¯å“åº”åˆ·æ–°äº‹ä»¶çš„æ–‡æœ¬Textçš„åˆå§‹åŒ–çŠ¶æ€æ˜¯å¦ä¸º0ã€‚</p><p><strong>éšå</strong>ï¼Œæˆ‘ä»¬é€šè¿‡find.byIconæ–¹æ³•æ‰¾åˆ°äº†æŒ‰é’®æ§ä»¶ï¼Œå¹¶é€šè¿‡tester.tapæ–¹æ³•å¯¹å…¶æ–½åŠ äº†ç‚¹å‡»è¡Œä¸ºã€‚åœ¨å®Œæˆäº†ç‚¹å‡»åï¼Œæˆ‘ä»¬ä½¿ç”¨tester.pumpæ–¹æ³•å¼ºåˆ¶è§¦å‘å…¶å®Œæˆæ¸²æŸ“åˆ·æ–°ã€‚<strong>æœ€å</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸éªŒè¯Textåˆå§‹åŒ–çŠ¶æ€åŒæ ·çš„è¯­å¥ï¼Œåˆ¤æ–­åœ¨å“åº”äº†åˆ·æ–°äº‹ä»¶åçš„æ–‡æœ¬Textå…¶çŠ¶æ€æ˜¯å¦ä¸º1ï¼š</p><pre><code>import 'package:flutter_test/flutter_test.dart';\nimport 'package:flutter_app_demox/main.dart';\n\nvoid main() {\n  testWidgets('Counter increments UI test', (WidgetTester tester) async {\n  //å£°æ˜æ‰€éœ€è¦éªŒè¯çš„Widgetå¯¹è±¡(å³MyApp)ï¼Œå¹¶è§¦å‘å…¶æ¸²æŸ“\n  await tester.pumpWidget(MyApp());\n\n  //æŸ¥æ‰¾å­—ç¬¦ä¸²æ–‡æœ¬ä¸º'0'çš„Widgetï¼ŒéªŒè¯æŸ¥æ‰¾æˆåŠŸ\n  expect(find.text('0'), findsOneWidget);\n  //æŸ¥æ‰¾å­—ç¬¦ä¸²æ–‡æœ¬ä¸º'1'çš„Widgetï¼ŒéªŒè¯æŸ¥æ‰¾å¤±è´¥\n  expect(find.text('1'), findsNothing);\n\n  //æŸ¥æ‰¾'+'æŒ‰é’®ï¼Œæ–½åŠ ç‚¹å‡»è¡Œä¸º\n  await tester.tap(find.byIcon(Icons.add));\n  //è§¦å‘å…¶æ¸²æŸ“\n  await tester.pump();\n\n  //æŸ¥æ‰¾å­—ç¬¦ä¸²æ–‡æœ¬ä¸º'0'çš„Widgetï¼ŒéªŒè¯æŸ¥æ‰¾å¤±è´¥\n  expect(find.text('0'), findsNothing);\n  //æŸ¥æ‰¾å­—ç¬¦ä¸²æ–‡æœ¬ä¸º'1'çš„Widgetï¼ŒéªŒè¯æŸ¥æ‰¾æˆåŠŸ\n  expect(find.text('1'), findsOneWidget);\n});\n}\n</code></pre><p>è¿è¡Œè¿™æ®µUIæµ‹è¯•ç”¨ä¾‹ä»£ç ï¼ŒåŒæ ·ä¹Ÿé¡ºåˆ©é€šè¿‡éªŒè¯äº†ã€‚</p><p>é™¤äº†ç‚¹å‡»äº‹ä»¶ä¹‹å¤–ï¼Œtesterè¿˜æ”¯æŒå…¶ä»–çš„äº¤äº’è¡Œä¸ºï¼Œæ¯”å¦‚æ–‡å­—è¾“å…¥enterTextã€æ‹–åŠ¨dragã€é•¿æŒ‰longPressç­‰ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†ä¸€ä¸€èµ˜è¿°äº†ã€‚å¦‚æœä½ æƒ³æ·±å…¥ç†è§£è¿™äº›å†…å®¹ï¼Œå¯ä»¥å‚è€ƒWidgetTesterçš„<a href=\"https://api.flutter.dev/flutter/flutter_test/WidgetTester-class.html\">å®˜æ–¹æ–‡æ¡£</a>è¿›è¡Œå­¦ä¹ ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„ä¸»è¦å†…å®¹å§ã€‚</p><p>åœ¨Flutterä¸­ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å¯ä»¥åˆ†ä¸ºå•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•ã€‚</p><p>å•å…ƒæµ‹è¯•çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯ã€‚é€šè¿‡å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯å•ä¸ªå‡½æ•°ã€æ–¹æ³•æˆ–ç±»ï¼Œå…¶è¡Œä¸ºè¡¨ç°æ˜¯å¦ä¸é¢„æœŸä¸€è‡´ã€‚è€ŒUIæµ‹è¯•çš„æ­¥éª¤ï¼ŒåŒæ ·æ˜¯åŒ…æ‹¬å®šä¹‰ã€æ‰§è¡Œå’ŒéªŒè¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡ä»¿çœŸå®ç”¨æˆ·çš„è¡Œä¸ºï¼Œå¯¹åº”ç”¨è¿›è¡Œäº¤äº’æ“ä½œï¼Œè¦†ç›–æ›´å¹¿çš„æµç¨‹ã€‚</p><p>å¦‚æœæµ‹è¯•å¯¹è±¡å­˜åœ¨åƒWebæœåŠ¡è¿™æ ·çš„å¤–éƒ¨ä¾èµ–ï¼Œä¸ºäº†è®©å•å…ƒæµ‹è¯•è¿‡ç¨‹æ›´ä¸ºå¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mockitoä¸ºå…¶å®šåˆ¶ä»»æ„çš„æ•°æ®è¿”å›ï¼Œå®ç°æ­£å¸¸å’Œå¼‚å¸¸ä¸¤ç§æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡UIæµ‹è¯•æ‰©å¤§äº†åº”ç”¨çš„æµ‹è¯•èŒƒå›´ï¼Œå¯ä»¥æ‰¾åˆ°å•å…ƒæµ‹è¯•æœŸé—´æ— æ³•æ‰¾åˆ°çš„é”™è¯¯ï¼Œä¸è¿‡ç›¸æ¯”äºå•å…ƒæµ‹è¯•ç”¨ä¾‹æ¥è¯´ï¼ŒUIæµ‹è¯•ç”¨ä¾‹çš„å¼€å‘å’Œç»´æŠ¤ä»£ä»·éå¸¸é«˜ã€‚å› ä¸ºä¸€ä¸ªç§»åŠ¨åº”ç”¨æœ€ä¸»è¦çš„åŠŸèƒ½å…¶å®å°±æ˜¯UIï¼Œè€ŒUIçš„å˜åŒ–éå¸¸é¢‘ç¹ï¼ŒUIæµ‹è¯•éœ€è¦ä¸æ–­çš„ç»´æŠ¤æ‰èƒ½ä¿æŒç¨³å®šå¯ç”¨çš„çŠ¶æ€ã€‚</p><p>â€œæŠ•å…¥å’Œå›æŠ¥â€æ°¸è¿œæ˜¯è€ƒè™‘æ˜¯å¦é‡‡ç”¨UIæµ‹è¯•ï¼Œä»¥åŠé‡‡ç”¨ä½•ç§çº§åˆ«çš„UIæµ‹è¯•ï¼Œéœ€è¦æœ€ä¼˜å…ˆè€ƒè™‘çš„é—®é¢˜ã€‚æˆ‘æ¨èçš„åŸåˆ™æ˜¯ï¼Œé¡¹ç›®è¾¾åˆ°ä¸€å®šçš„è§„æ¨¡ï¼Œå¹¶ä¸”ä¸šåŠ¡ç‰¹å¾å…·æœ‰ä¸€å®šçš„å»¶ç»­è§„å¾‹æ€§åï¼Œå†è€ƒè™‘UIæµ‹è¯•çš„å¿…è¦æ€§ã€‚</p><p>æˆ‘æŠŠä»Šå¤©åˆ†äº«æ¶‰åŠçš„çŸ¥è¯†ç‚¹æ‰“åŒ…åˆ°äº†<a href=\"https://github.com/cyndibaby905/38_test_app\">GitHub</a>ä¸­ï¼Œä½ å¯ä»¥ä¸‹è½½ä¸‹æ¥ï¼Œåå¤è¿è¡Œå‡ æ¬¡ï¼ŒåŠ æ·±ç†è§£ä¸è®°å¿†ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†SharedPreferencesçš„æ›´æ–°å’Œé€’å¢æ–¹æ³•ã€‚è¯·ä½ ä½¿ç”¨mockitoæ¨¡æ‹ŸSharedPreferencesçš„æ–¹å¼ï¼Œæ¥ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•å®ç°å¯¹åº”çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚</p><pre><code>Future&lt;bool&gt;updateSP(SharedPreferences prefs, int counter) async {\n  bool result = await prefs.setInt('counter', counter);\n  return result;\n}\n\nFuture&lt;int&gt;increaseSPCounter(SharedPreferences prefs) async {\n  int counter = (prefs.getInt('counter') ?? 0) + 1;\n  await updateSP(prefs, counter);\n  return counter;\n}\n</code></pre><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ç­‰å¾…ä½ ï¼æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","comments":[{"had_liked":false,"id":135858,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1569289347,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"14454191235","product_id":100031001,"comment_content":"å®Œå…¨ç…§æ¬äº†Androidçš„testå’ŒandroidTestä¸¤ä¸ªç›®å½•çš„ä½œç”¨ã€‚ã€‚ã€‚æœç„¶æ˜¯Googleå‡ºå“","like_count":2,"discussions":[{"author":{"id":1048531,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ff/d3/f249eefe.jpg","nickname":"iHTC","note":"","ucode":"22065449F54F40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318463,"discussion_content":"iOSä¹Ÿä¸€æ ·ï¼Œåº”è¯¥æ˜¯æ‰€æœ‰çš„å‰ç«¯æµ‹è¯•éƒ½æ˜¯å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•2å¤§ç±»ï¼ŒğŸ¥µ æ¯•ç«Ÿæ˜¯æ¡†æ¶å†…çš„ç¯å¢ƒè¿˜æ˜¯å¯¹åº”ç¯å¢ƒç»´æŠ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603760933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136189,"user_name":"èˆ’å¤§é£","can_delete":false,"product_type":"c1","uid":1313651,"ip_address":"","ucode":"5CC2E0F8C40E38","user_header":"https://static001.geekbang.org/account/avatar/00/14/0b/73/4f1c9676.jpg","comment_is_top":false,"comment_ctime":1569379765,"is_pvip":true,"replies":[{"id":"52564","content":"ç½‘ç»œè°ƒç”¨çš„æ‰§è¡Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„å¦å¤–çš„åº•å±‚çº¿ç¨‹åšçš„ï¼Œå’ŒDartå°±æ²¡å…³ç³»äº†ã€‚event queueé‡Œåªä¼šæ”¾ä¸€ä¸ªç½‘ç»œè°ƒç”¨çš„æœ€ç»ˆæ‰§è¡Œç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰åŠå“åº”æ‰§è¡Œç»“æœçš„å¤„ç†å›è°ƒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åœŸè±†ç›’å­","uid":"1088582","ctime":1569582822,"ip_address":"","comment_id":136189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864347061","product_id":100031001,"comment_content":"æƒ³è¯·æ•™ä¸‹ï¼Œçœ‹äº†dartçš„å•çº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåƒfutureè¿™ç§æ‰§è¡Œç½‘ç»œè¯·æ±‚çš„è¯ï¼Œç›´æ¥æŠŠä»»åŠ¡æ”¾è¿›event queueåŒæ­¥æ‰§è¡Œï¼Œé‚£ä¹ˆthençš„ä»»åŠ¡å¦‚ä½•å¤„ç†ï¼Œç­‰ç½‘ç»œè¯·æ±‚è¿”å›å†æ”¾è¿›event queue?å…·ä½“æ•´ä¸ªè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Œå¸Œæœ›è§£ç­”ä¸€ä¸‹ï¼Œè°¢è°¢","like_count":2,"discussions":[{"author":{"id":1088582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/46/0b29b188.jpg","nickname":"åœŸè±†ç›’å­","note":"","ucode":"A910F88CAC0A87","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468501,"discussion_content":"ç½‘ç»œè°ƒç”¨çš„æ‰§è¡Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„å¦å¤–çš„åº•å±‚çº¿ç¨‹åšçš„ï¼Œå’ŒDartå°±æ²¡å…³ç³»äº†ã€‚event queueé‡Œåªä¼šæ”¾ä¸€ä¸ªç½‘ç»œè°ƒç”¨çš„æœ€ç»ˆæ‰§è¡Œç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰åŠå“åº”æ‰§è¡Œç»“æœçš„å¤„ç†å›è°ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569582822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135961,"user_name":"å°å¸ˆå¼Ÿ","can_delete":false,"product_type":"c1","uid":1604954,"ip_address":"","ucode":"33FCC0E8879906","user_header":"https://static001.geekbang.org/account/avatar/00/18/7d/5a/0709cc86.jpg","comment_is_top":false,"comment_ctime":1569315279,"is_pvip":false,"replies":[{"id":"53510","content":"èµğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"åœŸè±†ç›’å­","uid":"1088582","ctime":1570515933,"ip_address":"","comment_id":135961,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864282575","product_id":100031001,"comment_content":"group(&#39;SharesPreferences&#39;, () {<br>  test(&#39;updateSP&#39;, () async {<br>    final prefs = MockPreferences();<br>    int counter = 1;<br>    when(prefs.setInt(&#39;counter&#39;, counter)).thenAnswer((_) async =&gt; true);<br>    expect(await updateSP(prefs, counter), true);<br>  });<br>  test(&#39;increaseSPCounter&#39;, () async {<br>    final prefs = MockPreferences();<br>    when(prefs.getInt(&#39;counter&#39;)).thenAnswer((_) =&gt; 2);<br>    expect(await increaseSPCounter(prefs), 3);<br>  });<br>});","like_count":1,"discussions":[{"author":{"id":1088582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/46/0b29b188.jpg","nickname":"åœŸè±†ç›’å­","note":"","ucode":"A910F88CAC0A87","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468403,"discussion_content":"èµğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570515933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176171,"user_name":"IF-Processing","can_delete":false,"product_type":"c1","uid":1205736,"ip_address":"","ucode":"8298C3C9320D94","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/e8/d1e52dbb.jpg","comment_is_top":false,"comment_ctime":1580978020,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1580978020","product_id":100031001,"comment_content":"å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥ä½¿ç”¨ç±»ä¼¼å¤šçœŸæœºçš„é€‚é…æ€§æµ‹è¯•å’ŒåŠŸèƒ½æ€§æµ‹è¯•å‘¢ï¼Ÿè¿™æ ·çš„æµ‹è¯•ï¼Œä¸€èˆ¬ä¸Šæ˜¯ä¸æ˜¯ä¼šç”¨ç±»ä¼¼Jenkinsï¼Œgitlabç­‰å¸¦æœ‰CIåŠŸèƒ½çš„é›†æˆç®¡ç†ç¯å¢ƒè¿›è¡Œæµ‹è¯•å‘¢ï¼Ÿflutteræ€ä¹ˆä¸è¿™äº›å·¥å…·è¿›è¡Œé›†æˆï¼Œèƒ½å¦ä»‹ç»äº›å®é™…ä¸Šç”Ÿäº§ä¸­ä½¿ç”¨çš„CI&#47;CDå·¥å…·ï¼Œä»¥åŠFlutteråœ¨å…¶ä¸Šè¿›è¡Œæµ‹è¯•çš„ä¾‹å­å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1048531,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ff/d3/f249eefe.jpg","nickname":"iHTC","note":"","ucode":"22065449F54F40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318466,"discussion_content":"CI å°±æ”¹ä¸ºä½¿ç”¨å‘½ä»¤è¡Œæ‰§è¡Œæµ‹è¯•å•Šã€‚ä½ è¯´çš„CIä¾‹å­æœ¬èº«å±äºJenkinsé…ç½®ï¼Œåº”è¯¥æ‰¾ç›¸å…³çš„èµ„æ–™ğŸ¥µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603761010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141366,"user_name":"imp","can_delete":false,"product_type":"c1","uid":1005293,"ip_address":"","ucode":"7FD85AF40775AC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ed/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1571145381,"is_pvip":false,"replies":[{"id":"57701","content":"æ–‡ç« ä¸­ä»‹ç»çš„æµ‹è¯•æ›´å¤šçš„æ˜¯åŸºäºåŠŸèƒ½å•å…ƒå’Œæ¸²æŸ“æ¨¡å‹çš„ï¼ŒéªŒè¯çš„æ˜¯é€»è¾‘å’Œäº¤äº’çš„æ­£ç¡®æ€§ã€‚å¦‚æœä½ æƒ³åœ¨çœŸæœºä¸Šè‡ªåŠ¨çš„æµ‹è¯•åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œéœ€è¦ä½¿ç”¨é›†æˆæµ‹è¯•ï¼šhttps:&#47;&#47;flutter.cn&#47;docs&#47;cookbook&#47;testing&#47;integration&#47;introductionï¼Œä½¿ç”¨æ–¹å¼å’ŒUIæµ‹è¯•ç±»ä¼¼<br>","user_name":"ä½œè€…å›å¤","user_name_real":"åœŸè±†ç›’å­","uid":"1088582","ctime":1573446551,"ip_address":"","comment_id":141366,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571145381","product_id":100031001,"comment_content":"åˆšå­¦ä¹ flutterï¼Œè¿è¡ŒUI æµ‹è¯•ç”¨ä¾‹ï¼ˆå·²è¿æ¥çœŸæœºï¼‰ï¼Œæ²¡æœ‰çœ‹åˆ°ç¨‹åºå¯åŠ¨å’Œç‚¹å‡»æ¸²æŸ“åŠ¨ä½œï¼Œæƒ³äº†è§£ä¸‹ Flutteråº”ç”¨çš„ UI æµ‹è¯•å°±æ˜¯è¿™æ ·çš„ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/46/0b29b188.jpg","nickname":"åœŸè±†ç›’å­","note":"","ucode":"A910F88CAC0A87","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470734,"discussion_content":"æ–‡ç« ä¸­ä»‹ç»çš„æµ‹è¯•æ›´å¤šçš„æ˜¯åŸºäºåŠŸèƒ½å•å…ƒå’Œæ¸²æŸ“æ¨¡å‹çš„ï¼ŒéªŒè¯çš„æ˜¯é€»è¾‘å’Œäº¤äº’çš„æ­£ç¡®æ€§ã€‚å¦‚æœä½ æƒ³åœ¨çœŸæœºä¸Šè‡ªåŠ¨çš„æµ‹è¯•åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œéœ€è¦ä½¿ç”¨é›†æˆæµ‹è¯•ï¼šhttps://flutter.cn/docs/cookbook/testing/integration/introductionï¼Œä½¿ç”¨æ–¹å¼å’ŒUIæµ‹è¯•ç±»ä¼¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573446551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136058,"user_name":"æ°´æœ¨å¹´å","can_delete":false,"product_type":"c1","uid":1446205,"ip_address":"","ucode":"84B925B21F0381","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/3d/58ac17a0.jpg","comment_is_top":false,"comment_ctime":1569337384,"is_pvip":false,"replies":[{"id":"52448","content":"æŒ‰ç…§é”™è¯¯æç¤ºçœ‹ï¼Œä½ åº”è¯¥éœ€è¦æ‰“å¼€iosç›®å½•ä¸‹çš„Runner.xcworkspaceæ–‡ä»¶ï¼Œç‚¹å‡»buildæŒ‰é’®","user_name":"ä½œè€…å›å¤","user_name_real":"åœŸè±†ç›’å­","uid":"1088582","ctime":1569500957,"ip_address":"","comment_id":136058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569337384","product_id":100031001,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨vscodeé‡Œé¢æƒ³è¦ æ‰“æ–­ç‚¹è°ƒè¯•ä»£ç ï¼Œ æ˜¾ç¤ºå¦‚ä¸‹æŠ¥é”™ï¼Œæ˜¯å‡ºç°äº†ä»€ä¹ˆé—®é¢˜å‘¢<br>Could not install build&#47;ios&#47;iphoneos&#47;Runner.app on 792911392a7daaf2c375d213cd31d9c5389ef79c.<br>Try launching Xcode and selecting &quot;Product &gt; Run&quot; to fix the problem:<br>  open ios&#47;Runner.xcworkspace","like_count":0,"discussions":[{"author":{"id":1088582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/46/0b29b188.jpg","nickname":"åœŸè±†ç›’å­","note":"","ucode":"A910F88CAC0A87","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468436,"discussion_content":"æŒ‰ç…§é”™è¯¯æç¤ºçœ‹ï¼Œä½ åº”è¯¥éœ€è¦æ‰“å¼€iosç›®å½•ä¸‹çš„Runner.xcworkspaceæ–‡ä»¶ï¼Œç‚¹å‡»buildæŒ‰é’®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569500957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}