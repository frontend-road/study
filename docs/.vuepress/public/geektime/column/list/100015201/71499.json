{"id":71499,"title":"46 | è§£è¯» CRI ä¸ å®¹å™¨è¿è¡Œæ—¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šè§£è¯» CRI ä¸ å®¹å™¨è¿è¡Œæ—¶ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºä½ è¯¦ç»†è®²è§£äº† kubelet çš„å·¥ä½œåŸç†å’Œ CRI çš„æ¥é¾™å»è„‰ã€‚åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥è¿›ä¸€æ­¥åœ°ã€æ›´æ·±å…¥åœ°äº†è§£ä¸€ä¸‹ CRI çš„è®¾è®¡ä¸å·¥ä½œåŸç†ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥ç®€è¦å›é¡¾ä¸€ä¸‹æœ‰äº† CRI ä¹‹åï¼ŒKubernetes çš„æ¶æ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/70/38/7016633777ec41da74905bfb91ae7b38.png?wh=1940*1183\" alt=\"\"><br>\nåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä¹Ÿæåˆ°äº†ï¼ŒCRI æœºåˆ¶èƒ½å¤Ÿå‘æŒ¥ä½œç”¨çš„æ ¸å¿ƒï¼Œå°±åœ¨äºæ¯ä¸€ç§å®¹å™¨é¡¹ç›®ç°åœ¨éƒ½å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ª CRI shimï¼Œè‡ªè¡Œå¯¹ CRI è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ï¼ŒKubernetes å°±æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„å®¹å™¨æŠ½è±¡å±‚ï¼Œä½¿å¾—ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶å¯ä»¥è‡ªç”±åœ°å¯¹æ¥è¿›å…¥ Kubernetes å½“ä¸­ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œè¿™é‡Œçš„ CRI shimï¼Œå°±æ˜¯å®¹å™¨é¡¹ç›®çš„ç»´æŠ¤è€…ä»¬è‡ªç”±å‘æŒ¥çš„â€œåœºåœ°â€äº†ã€‚è€Œé™¤äº† dockershimä¹‹å¤–ï¼Œå…¶ä»–å®¹å™¨è¿è¡Œæ—¶çš„ CRI shimï¼Œéƒ½æ˜¯éœ€è¦é¢å¤–éƒ¨ç½²åœ¨å®¿ä¸»æœºä¸Šçš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ã€‚CNCF é‡Œçš„ containerd é¡¹ç›®ï¼Œå°±å¯ä»¥æä¾›ä¸€ä¸ªå…¸å‹çš„ CRI shim çš„èƒ½åŠ›ï¼Œå³ï¼šå°†Kubernetes å‘å‡ºçš„ CRI è¯·æ±‚ï¼Œè½¬æ¢æˆå¯¹ containerd çš„è°ƒç”¨ï¼Œç„¶ååˆ›å»ºå‡º runC å®¹å™¨ã€‚è€Œ runCé¡¹ç›®ï¼Œæ‰æ˜¯è´Ÿè´£æ‰§è¡Œæˆ‘ä»¬å‰é¢è®²è§£è¿‡çš„è®¾ç½®å®¹å™¨ Namespaceã€Cgroupså’Œchroot ç­‰åŸºç¡€æ“ä½œçš„ç»„ä»¶ã€‚æ‰€ä»¥ï¼Œè¿™å‡ å±‚çš„ç»„åˆå…³ç³»ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ç¤ºæ„å›¾æ¥æè¿°ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/62/3d/62c591c4d832d44fed6f76f60be88e3d.png?wh=916*700\" alt=\"\"><br>\n<strong>è€Œä½œä¸ºä¸€ä¸ª CRI shimï¼Œcontainerd å¯¹ CRI çš„å…·ä½“å®ç°ï¼Œåˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</strong></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ CRI è¿™ä¸ªæ¥å£çš„å®šä¹‰ã€‚ä¸‹é¢è¿™å¹…ç¤ºæ„å›¾ï¼Œå°±å±•ç¤ºäº† CRI é‡Œä¸»è¦çš„å¾…å®ç°æ¥å£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/16/f7e86505c09239b80ad05aecfb032e16.png?wh=980*576\" alt=\"\"><br>\nå…·ä½“åœ°è¯´ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æŠŠ CRI åˆ†ä¸ºä¸¤ç»„ï¼š</strong></p><ul>\n<li>\n<p>ç¬¬ä¸€ç»„ï¼Œæ˜¯ RuntimeServiceã€‚å®ƒæä¾›çš„æ¥å£ï¼Œä¸»è¦æ˜¯è·Ÿå®¹å™¨ç›¸å…³çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œåˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ã€åˆ é™¤å®¹å™¨ã€æ‰§è¡Œ exec å‘½ä»¤ç­‰ç­‰ã€‚</p>\n</li>\n<li>\n<p>è€Œç¬¬äºŒç»„ï¼Œåˆ™æ˜¯ ImageServiceã€‚å®ƒæä¾›çš„æ¥å£ï¼Œä¸»è¦æ˜¯å®¹å™¨é•œåƒç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚æ‹‰å–é•œåƒã€åˆ é™¤é•œåƒç­‰ç­‰ã€‚</p>\n</li>\n</ul><p>å…³äºå®¹å™¨é•œåƒçš„æ“ä½œæ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æš‚ä¸”ç•¥è¿‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸»è¦ä¸ºä½ è®²è§£ä¸€ä¸‹RuntimeServiceéƒ¨åˆ†ã€‚</p><p><strong>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼ŒCRI è®¾è®¡çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼Œå°±æ˜¯ç¡®ä¿è¿™ä¸ªæ¥å£æœ¬èº«ï¼Œåªå…³æ³¨å®¹å™¨ï¼Œä¸å…³æ³¨ Podã€‚</strong>è¿™æ ·åšçš„åŸå› ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚</p><p><strong>ç¬¬ä¸€</strong>ï¼ŒPod æ˜¯ Kubernetes çš„ç¼–æ’æ¦‚å¿µï¼Œè€Œä¸æ˜¯å®¹å™¨è¿è¡Œæ—¶çš„æ¦‚å¿µã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å‡è®¾æ‰€æœ‰ä¸‹å±‚å®¹å™¨é¡¹ç›®ï¼Œéƒ½èƒ½å¤Ÿæš´éœ²å‡ºå¯ä»¥ç›´æ¥æ˜ å°„ä¸º Pod çš„ APIã€‚</p><p><strong>ç¬¬äºŒ</strong>ï¼Œå¦‚æœ CRI é‡Œå¼•å…¥äº†å…³äº Pod çš„æ¦‚å¿µï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åªè¦ Pod API å¯¹è±¡çš„å­—æ®µå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆCRI å°±å¾ˆæœ‰å¯èƒ½éœ€è¦å˜æ›´ã€‚è€Œåœ¨ Kubernetes å¼€å‘çš„å‰æœŸï¼ŒPod å¯¹è±¡çš„å˜åŒ–è¿˜æ˜¯æ¯”è¾ƒé¢‘ç¹çš„ï¼Œä½†å¯¹äºCRI è¿™æ ·çš„æ ‡å‡†æ¥å£æ¥è¯´ï¼Œè¿™ä¸ªå˜æ›´é¢‘ç‡å°±æœ‰ç‚¹éº»çƒ¦äº†ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ CRI çš„è®¾è®¡é‡Œï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç›´æ¥åˆ›å»º Pod æˆ–è€…å¯åŠ¨ Pod çš„æ¥å£ã€‚</p><p>ä¸è¿‡ï¼Œç›¸ä¿¡ä½ ä¹Ÿå·²ç»æ³¨æ„åˆ°äº†ï¼ŒCRI é‡Œè¿˜æ˜¯æœ‰ä¸€ç»„å«ä½œRunPodSandbox çš„æ¥å£çš„ã€‚</p><p>è¿™ä¸ª PodSandboxï¼Œå¯¹åº”çš„å¹¶ä¸æ˜¯ Kubernetes é‡Œçš„ Pod API å¯¹è±¡ï¼Œè€Œåªæ˜¯æŠ½å–äº† Pod é‡Œçš„ä¸€éƒ¨åˆ†ä¸å®¹å™¨è¿è¡Œæ—¶ç›¸å…³çš„å­—æ®µï¼Œæ¯”å¦‚HostNameã€DnsConfigã€CgroupParent ç­‰ã€‚æ‰€ä»¥è¯´ï¼ŒPodSandbox è¿™ä¸ªæ¥å£æè¿°çš„ï¼Œå…¶å®æ˜¯ Kubernetes å°† Pod è¿™ä¸ªæ¦‚å¿µæ˜ å°„åˆ°å®¹å™¨è¿è¡Œæ—¶å±‚é¢æ‰€éœ€è¦çš„å­—æ®µï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªPod å¯¹è±¡å­é›†ã€‚</p><p>è€Œä½œä¸ºå…·ä½“çš„å®¹å™¨é¡¹ç›®ï¼Œä½ å°±éœ€è¦è‡ªå·±å†³å®šå¦‚ä½•ä½¿ç”¨è¿™äº›å­—æ®µæ¥å®ç°ä¸€ä¸ª Kubernetes æœŸæœ›çš„ Podæ¨¡å‹ã€‚è¿™é‡Œçš„åŸç†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ç¤ºæ„å›¾æ¥è¡¨ç¤ºæ¸…æ¥šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/61/d9fb7404c5dc9e0b5c902f74df9d7a61.png?wh=1825*824\" alt=\"\"><br>\næ¯”å¦‚ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ kubectl run åˆ›å»ºäº†ä¸€ä¸ªåå« foo çš„ã€åŒ…æ‹¬äº† Aã€B ä¸¤ä¸ªå®¹å™¨çš„ Pod ä¹‹åã€‚è¿™ä¸ªPod çš„ä¿¡æ¯æœ€åæ¥åˆ° kubeletï¼Œkubelet å°±ä¼šæŒ‰ç…§å›¾ä¸­æ‰€ç¤ºçš„é¡ºåºæ¥è°ƒç”¨ CRI æ¥å£ã€‚</p><p>åœ¨å…·ä½“çš„ CRI shim ä¸­ï¼Œè¿™äº›æ¥å£çš„å®ç°æ˜¯å¯ä»¥å®Œå…¨ä¸åŒçš„ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯ Docker é¡¹ç›®ï¼Œdockershim å°±ä¼šåˆ›å»ºå‡ºä¸€ä¸ªåå« foo çš„ Infraå®¹å™¨ï¼ˆpause å®¹å™¨ï¼‰ï¼Œç”¨æ¥â€œholdâ€ä½æ•´ä¸ª Pod çš„ Network Namespaceã€‚</p><p>è€Œå¦‚æœæ˜¯åŸºäºè™šæ‹ŸåŒ–æŠ€æœ¯çš„å®¹å™¨ï¼Œæ¯”å¦‚ Kata Containers é¡¹ç›®ï¼Œå®ƒçš„ CRI å®ç°å°±ä¼šç›´æ¥åˆ›å»ºå‡ºä¸€ä¸ªè½»é‡çº§è™šæ‹Ÿæœºæ¥å……å½“ Podã€‚</p><p>æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ RunPodSandbox è¿™ä¸ªæ¥å£çš„å®ç°ä¸­ï¼Œä½ è¿˜éœ€è¦è°ƒç”¨networkPlugin.SetUpPod(â€¦) æ¥ä¸ºè¿™ä¸ª Sandbox è®¾ç½®ç½‘ç»œã€‚è¿™ä¸ª SetUpPod(â€¦) æ–¹æ³•ï¼Œå®é™…ä¸Šå°±åœ¨æ‰§è¡Œ CNI æ’ä»¶é‡Œçš„add(â€¦) æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨å‰é¢ä¸ºä½ è®²è§£è¿‡çš„ CNI æ’ä»¶ä¸º Pod åˆ›å»ºç½‘ç»œï¼Œå¹¶ä¸”æŠŠ Infra å®¹å™¨åŠ å…¥åˆ°ç½‘ç»œä¸­çš„æ“ä½œã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬34ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/67351\">ã€ŠKubernetesç½‘ç»œæ¨¡å‹ä¸CNIç½‘ç»œæ’ä»¶ã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p>\n</blockquote><p>æ¥ä¸‹æ¥ï¼Œkubelet ç»§ç»­è°ƒç”¨ CreateContainer å’Œ StartContainer æ¥å£æ¥åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ Aã€Bã€‚å¯¹åº”åˆ° dockershimé‡Œï¼Œå°±æ˜¯ç›´æ¥å¯åŠ¨Aï¼ŒBä¸¤ä¸ª Docker å®¹å™¨ã€‚æ‰€ä»¥æœ€åï¼Œå®¿ä¸»æœºä¸Šä¼šå‡ºç°ä¸‰ä¸ª Docker å®¹å™¨ç»„æˆè¿™ä¸€ä¸ª Podã€‚</p><p>è€Œå¦‚æœæ˜¯ Kata Containers çš„è¯ï¼ŒCreateContainerå’ŒStartContaineræ¥å£çš„å®ç°ï¼Œå°±åªä¼šåœ¨å‰é¢åˆ›å»ºçš„è½»é‡çº§è™šæ‹Ÿæœºé‡Œåˆ›å»ºä¸¤ä¸ª Aã€B å®¹å™¨å¯¹åº”çš„ Mount Namespaceã€‚æ‰€ä»¥ï¼Œæœ€ååœ¨å®¿ä¸»æœºä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªå«ä½œ foo çš„è½»é‡çº§è™šæ‹Ÿæœºåœ¨è¿è¡Œã€‚å…³äºåƒ Kata Containers æˆ–è€… gVisor è¿™ç§æ‰€è°“çš„å®‰å…¨å®¹å™¨é¡¹ç›®ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚</p><p>é™¤äº†ä¸Šè¿°å¯¹å®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„å®ç°ä¹‹å¤–ï¼ŒCRI shim è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å·¥ä½œï¼Œå°±æ˜¯å¦‚ä½•å®ç° execã€logs ç­‰æ¥å£ã€‚è¿™äº›æ¥å£è·Ÿå‰é¢çš„æ“ä½œæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¸åŒï¼Œå°±æ˜¯è¿™äº›gRPC æ¥å£è°ƒç”¨æœŸé—´ï¼Œkubelet éœ€è¦è·Ÿå®¹å™¨é¡¹ç›®ç»´æŠ¤ä¸€ä¸ªé•¿è¿æ¥æ¥ä¼ è¾“æ•°æ®ã€‚è¿™ç§ APIï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºStreaming APIã€‚</p><p>CRI shim é‡Œå¯¹ Streaming API çš„å®ç°ï¼Œä¾èµ–äºä¸€å¥—ç‹¬ç«‹çš„ Streaming Server æœºåˆ¶ã€‚è¿™ä¸€éƒ¨åˆ†åŸç†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ç¤ºæ„å›¾æ¥ä¸ºä½ æè¿°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/ef/a8e7ff6a6b0c9591a0a4f2b8e9e9bdef.png?wh=1937*695\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå®¹å™¨æ‰§è¡Œ kubectl exec å‘½ä»¤çš„æ—¶å€™ï¼Œè¿™ä¸ªè¯·æ±‚é¦–å…ˆäº¤ç»™ API Serverï¼Œç„¶å API Server å°±ä¼šè°ƒç”¨ kubelet çš„ Exec APIã€‚</p><p>è¿™æ—¶ï¼Œkubeletå°±ä¼šè°ƒç”¨ CRI çš„ Exec æ¥å£ï¼Œè€Œè´Ÿè´£å“åº”è¿™ä¸ªæ¥å£çš„ï¼Œè‡ªç„¶å°±æ˜¯å…·ä½“çš„ CRI shimã€‚</p><p>ä½†åœ¨è¿™ä¸€æ­¥ï¼ŒCRI shim å¹¶ä¸ä¼šç›´æ¥å»è°ƒç”¨åç«¯çš„å®¹å™¨é¡¹ç›®ï¼ˆæ¯”å¦‚ Docker ï¼‰æ¥è¿›è¡Œå¤„ç†ï¼Œè€Œåªä¼šè¿”å›ä¸€ä¸ª URL ç»™ kubeletã€‚è¿™ä¸ª URLï¼Œå°±æ˜¯è¯¥ CRI shim å¯¹åº”çš„ Streaming Server çš„åœ°å€å’Œç«¯å£ã€‚</p><p>è€Œ kubelet åœ¨æ‹¿åˆ°è¿™ä¸ª URL ä¹‹åï¼Œå°±ä¼šæŠŠå®ƒä»¥ Redirect çš„æ–¹å¼è¿”å›ç»™ API Serverã€‚æ‰€ä»¥è¿™æ—¶å€™ï¼ŒAPI Server å°±ä¼šé€šè¿‡é‡å®šå‘æ¥å‘ Streaming Server å‘èµ·çœŸæ­£çš„ /exec è¯·æ±‚ï¼Œä¸å®ƒå»ºç«‹é•¿è¿æ¥ã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ª Streaming Server æœ¬èº«ï¼Œæ˜¯éœ€è¦é€šè¿‡ä½¿ç”¨ SIG-Node ä¸ºä½ ç»´æŠ¤çš„ Streaming API åº“æ¥å®ç°çš„ã€‚å¹¶ä¸”ï¼ŒStreaming Server ä¼šåœ¨ CRI shim å¯åŠ¨æ—¶å°±ä¸€èµ·å¯åŠ¨ã€‚æ­¤å¤–ï¼ŒStream Server è¿™ä¸€éƒ¨åˆ†å…·ä½“æ€ä¹ˆå®ç°ï¼Œå®Œå…¨å¯ä»¥ç”± CRI shim çš„ç»´æŠ¤è€…è‡ªè¡Œå†³å®šã€‚æ¯”å¦‚ï¼Œå¯¹äºDocker é¡¹ç›®æ¥è¯´ï¼Œdockershim å°±æ˜¯ç›´æ¥è°ƒç”¨ Docker çš„ Exec API æ¥ä½œä¸ºå®ç°çš„ã€‚</p><p>ä»¥ä¸Šï¼Œå°±æ˜¯CRI çš„è®¾è®¡ä»¥åŠå…·ä½“çš„å·¥ä½œåŸç†äº†ã€‚</p><h1>æ€»ç»“</h1><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºä½ è¯¦ç»†è§£è¯»äº† CRI çš„è®¾è®¡å’Œå…·ä½“å·¥ä½œåŸç†ï¼Œå¹¶ä¸ºä½ æ¢³ç†äº†å®ç°CRI æ¥å£çš„æ ¸å¿ƒæµç¨‹ã€‚</p><p>ä»è¿™äº›è®²è§£ä¸­ä¸éš¾çœ‹å‡ºï¼ŒCRI è¿™ä¸ªæ¥å£çš„è®¾è®¡ï¼Œå®é™…ä¸Šè¿˜æ˜¯æ¯”è¾ƒå®½æ¾çš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œä½œä¸ºå®¹å™¨é¡¹ç›®çš„ç»´æŠ¤è€…ï¼Œæˆ‘åœ¨å®ç° CRI çš„å…·ä½“æ¥å£æ—¶ï¼Œå¾€å¾€æ‹¥æœ‰ç€å¾ˆé«˜çš„è‡ªç”±åº¦ï¼Œè¿™ä¸ªè‡ªç”±åº¦ä¸ä»…åŒ…æ‹¬äº†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä¹ŸåŒ…æ‹¬äº†å¦‚ä½•å°† Pod æ˜ å°„æˆä¸ºæˆ‘è‡ªå·±çš„å®ç°ï¼Œè¿˜åŒ…æ‹¬äº†å¦‚ä½•è°ƒç”¨ CNI æ’ä»¶æ¥ä¸º Pod è®¾ç½®ç½‘ç»œçš„è¿‡ç¨‹ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå½“ä½ å¯¹å®¹å™¨è¿™ä¸€å±‚æœ‰ç‰¹æ®Šçš„éœ€æ±‚æ—¶ï¼Œæˆ‘ä¸€å®šä¼˜å…ˆå»ºè®®ä½ è€ƒè™‘å®ç°ä¸€ä¸ªè‡ªå·±çš„ CRI shim ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ kubelet ç”šè‡³å®¹å™¨é¡¹ç›®çš„ä»£ç ã€‚è¿™æ ·é€šè¿‡æ’ä»¶çš„æ–¹å¼å®šåˆ¶ Kubernetes çš„åšæ³•ï¼Œä¹Ÿæ˜¯æ•´ä¸ª Kubernetes ç¤¾åŒºæœ€é¼“åŠ±å’Œæ¨å´‡çš„ä¸€ä¸ªæœ€ä½³å®è·µã€‚è¿™ä¹Ÿæ­£æ˜¯ä¸ºä»€ä¹ˆåƒ Kata Containersã€gVisor ç”šè‡³è™šæ‹Ÿæœºè¿™æ ·çš„â€œéå…¸å‹â€å®¹å™¨ï¼Œéƒ½å¯ä»¥æ— ç¼æ¥å…¥åˆ° Kubernetes é¡¹ç›®é‡Œçš„é‡è¦åŸå› ã€‚</p><h1>æ€è€ƒé¢˜</h1><p>è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘å‰é¢è®²è§£è¿‡çš„Device Plugin ä¸ºå®¹å™¨åˆ†é…çš„ GPU ä¿¡æ¯ï¼Œæ˜¯é€šè¿‡ CRI çš„å“ªä¸ªæ¥å£ä¼ é€’ç»™ dockershimï¼Œæœ€åäº¤ç»™ Docker API çš„å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","comments":[{"had_liked":false,"id":48569,"user_name":"å‹¤åŠ³çš„å°èƒ–å­-libo","can_delete":false,"product_type":"c1","uid":1158344,"ip_address":"","ucode":"5BB20CD5A56568","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/c8/4b1c0d40.jpg","comment_is_top":false,"comment_ctime":1544490101,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"126098541685","product_id":100015201,"comment_content":"DevicePluginä¸­çš„allocateå‡½æ•°æ˜¯æ˜¯åœ¨container creatingçš„æ—¶å€™è¢«è°ƒç”¨ï¼Œä»è€Œdevice pluginå¯ä»¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œæ¯”å¦‚attachè®¾å¤‡ä»¥åŠé©±åŠ¨ç›®å½•ã€‚<br>æ‰€ä»¥åº”è¯¥æ˜¯ä½¿ç”¨åˆ°äº†ï¼š<br>Createcontainer()è¿™ä¸ªæ¥å£<br>","like_count":30,"discussions":[{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586280,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662088015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47806,"user_name":"åˆå­¦è€…","can_delete":false,"product_type":"c1","uid":1042833,"ip_address":"","ucode":"9471A905D07CE1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/91/4219d305.jpg","comment_is_top":false,"comment_ctime":1544203991,"is_pvip":true,"replies":[{"id":"17507","content":"å·²ç»é›†æˆå•¦","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1544533522,"ip_address":"","comment_id":47806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57378778839","product_id":100015201,"comment_content":"kubelet å¯ä»¥ç›´æ¥å¯¹æ¥contained ? ä¸­é—´ä¸éœ€è¦é¢å¤–å®ç°cri shim ï¼Ÿè¿˜æ˜¯containerd ä¸­å·²ç»é›†æˆäº†cri shimï¼Ÿ","like_count":14,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431893,"discussion_content":"å·²ç»é›†æˆå•¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544533522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114138,"user_name":"å°è°¢åŒå­¦","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1563241827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31628012899","product_id":100015201,"comment_content":"containerdåº”è¯¥ä¼šæŠŠè¯·æ±‚äº¤ç»™contained-shimï¼Œç„¶åå†è°ƒrunCå§","like_count":8},{"had_liked":false,"id":269418,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1608638206,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18788507390","product_id":100015201,"comment_content":"è°ƒåº¦å™¨å°†Podè°ƒåº¦åˆ°æŸä¸€ä¸ªNodeä¸Šåï¼ŒNodeä¸Šçš„Kubeletå°±éœ€è¦è´Ÿè´£å°†è¿™ä¸ªPodæ‹‰èµ·æ¥ã€‚åœ¨Kuberentesç¤¾åŒºä¸­ï¼ŒKubeletä»¥åŠCRIç›¸å…³çš„å†…å®¹ï¼Œéƒ½å±äºSIG-Nodeã€‚<br><br>Kubeletä¹Ÿæ˜¯é€šè¿‡æ§åˆ¶å¾ªç¯æ¥å®Œæˆå„ç§å·¥ä½œçš„ã€‚kubeletè°ƒç”¨ä¸‹å±‚å®¹å™¨è¿è¡Œæ—¶é€šè¿‡ä¸€ç»„å«ä½œCRIçš„gRPCæ¥å£æ¥é—´æ¥æ‰§è¡Œçš„ã€‚é€šè¿‡CRIï¼Œ kubeletä¸å…·ä½“çš„å®¹å™¨è¿è¡Œæ—¶è§£è€¦ã€‚åœ¨ç›®å‰çš„kubeletå®ç°é‡Œï¼Œå†…ç½®äº†dockershimè¿™ä¸ªCRIçš„å®ç°ï¼Œä½†è¿™éƒ¨åˆ†å®ç°æœªæ¥è‚¯å®šä¼šè¢«kubeletç§»é™¤ã€‚æœªæ¥æ›´æ™®éçš„æ–¹æ¡ˆæ˜¯åœ¨å®¿ä¸»æœºä¸Šå®‰è£…è´Ÿè´£å“åº”çš„CRIç»„ä»¶ï¼ˆCRI shimï¼‰ï¼Œkubeletè´Ÿè´£è°ƒç”¨CRI shimï¼ŒCRI shimæŠŠå…·ä½“çš„è¯·æ±‚â€œç¿»è¯‘â€æˆå¯¹åç«¯å®¹å™¨é¡¹ç›®çš„è¯·æ±‚æˆ–è€…æ“ä½œ ã€‚<br><br>ä¸åŒçš„CRI shimæœ‰ä¸åŒçš„å®¹å™¨å®ç°æ–¹å¼ï¼Œä¾‹å¦‚ï¼šåˆ›å»ºäº†ä¸€ä¸ªåå«fooçš„ã€åŒ…æ‹¬äº†Aã€Bä¸¤ä¸ªå®¹å™¨çš„Pod<br><br>Docker: åˆ›å»ºå‡ºä¸€ä¸ªåå«fooçš„Infraå®¹å™¨æ¥holdä½æ•´ä¸ªpodï¼Œæ¥ç€å¯åŠ¨Aï¼ŒBä¸¤ä¸ªDockerå®¹å™¨ã€‚æ‰€ä»¥æœ€åï¼Œå®¿ä¸»æœºä¸Šä¼šå‡ºç°ä¸‰ä¸ªDockerå®¹å™¨ç»„æˆè¿™ä¸€ä¸ªPod<br><br>Kata container: åˆ›å»ºå‡ºä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºæ¥holdä½æ•´ä¸ªpodï¼Œæ¥ç€åˆ›å»ºAã€Bå®¹å™¨å¯¹åº”çš„ Mount Namespaceã€‚æ‰€ä»¥ï¼Œæœ€ååœ¨å®¿ä¸»æœºä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªå«åšfooçš„è½»é‡çº§è™šæ‹Ÿæœºåœ¨è¿è¡Œ<br><br><br>","like_count":5},{"had_liked":false,"id":67815,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1550284443,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14435186331","product_id":100015201,"comment_content":"docker shim æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£æˆremote+CRI shimçš„ä¸€ä¸ªk8så†…éƒ¨é›†æˆçš„ä¸€ç§å®ç°","like_count":3,"discussions":[{"author":{"id":1628712,"avatar":"https://static001.geekbang.org/account/avatar/00/18/da/28/b09d3747.jpg","nickname":"Frame","note":"","ucode":"57865AC3A1BAD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262316,"discussion_content":"åº”è¯¥æ˜¯çš„ï¼Œdockershimå’ŒremoteRuntimeServiceåœ¨åŒä¸€å±‚è¢«è°ƒç”¨ï¼Œä½†å®Œæˆäº†æ›´å…·ä½“çš„shimå·¥ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589074087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47644,"user_name":"Vinsec","can_delete":false,"product_type":"c1","uid":1227766,"ip_address":"","ucode":"BFD541E05D3AD7","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/f6/af833125.jpg","comment_is_top":false,"comment_ctime":1544171013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14429072901","product_id":100015201,"comment_content":"å¤©å†·é€‚åˆæå­¦ä¹  æ‰“å¡","like_count":3},{"had_liked":false,"id":241454,"user_name":"å°è°¢åŒå­¦","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1597299547,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10187234139","product_id":100015201,"comment_content":"Containerd ä¸­çš„cri-shimå’Œç”¨æ¥æ§åˆ¶runCçš„containerd-shimæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1628712,"avatar":"https://static001.geekbang.org/account/avatar/00/18/da/28/b09d3747.jpg","nickname":"Frame","note":"","ucode":"57865AC3A1BAD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310912,"discussion_content":"Cri-containerd æ˜¯å®ç°äº† CRI æ¥å£çš„ shim å±‚ï¼Œæ‹¼æ¥çš„æ˜¯ kubelet å’Œ containerdï¼Œé…åˆ kubelet çš„ remoteRuntimeService ä¸€èµ·å°±ä¸ dockershim å¤„äºå¹³è¡Œå…³ç³»ï¼›containerd-shim åˆ™æ˜¯ä½äº containerd å’Œ runc ä¹‹é—´ï¼Œå¯¹æ¥çš„æ˜¯ OCI (Open Container Initiative, å…¸å‹å®ç°å¦‚ runc)ï¼Œè·Ÿ kubelet æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚Kubelet CRI åˆ° OCI ä¹‹é—´çš„ç»„ä»¶æ¶æ„å¯ä»¥æœ‰å¥½å¤šç§ï¼ˆæ¯”å¦‚ CRI-Oï¼‰ï¼Œäº†è§£ä¸‹åå°±å¤§æ¦‚æ˜ç™½è¿™ä¸ªé—®é¢˜äº†ã€‚","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1602125922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"ä¸ç»æ„é—´","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384640,"discussion_content":"Containerdæ˜¯ä¸€ä¸ªcri-shmçš„å®ç°ï¼Œæ¯”å¦‚ï¼šdockerã€ Kata Containers æˆ–è€… gVisor ï¼›runCæ˜¯Containerdè®¾ç½®å®¹å™¨ Namespaceã€Cgroups å’Œ chroot ç­‰åŸºç¡€æ“ä½œçš„ç»„ä»¶ã€‚æ˜¯ä¸¤ä¸ªæ¦‚å¿µä¸Šçš„ç†è§£ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626685452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"ä¸ç»æ„é—´","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384644,"discussion_content":"k8sæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å®¹å™¨æŠ½è±¡å±‚ï¼Œä½ å¯ä»¥æ ¹æ®è¿™ä¸ªåšè‡ªå·±çš„cri-shmã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626685650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47434,"user_name":"éƒ‘ç„¶","can_delete":false,"product_type":"c1","uid":1013340,"ip_address":"","ucode":"3E749A3363F01C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/5c/416bcce6.jpg","comment_is_top":false,"comment_ctime":1544144017,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10134078609","product_id":100015201,"comment_content":"è€å¸ˆè¯·æ•™ä¸¤ä¸ªé—®é¢˜: <br>1. ä¸ºä»€ä¹ˆkubeletè¦ç»™apiserverè¿”å›redirect urlå‘¢? è¿™æ ·åšæœ‰ä»€ä¹ˆç‰¹æ®Šè€ƒè™‘å—?<br>2. é•œåƒæœåŠ¡, ä»¥åŠä¸‹è½½å®Œé•œåƒä¹‹å, å¦‚ä½•å’Œcreatecontaineræ¥å£å‘ç”Ÿå…³è”çš„, è¿™å—çš„ç»†èŠ‚èƒ½è®²è®²å—?","like_count":2,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319392,"discussion_content":"1. æˆ‘çš„ç†è§£æ˜¯ StreamingServer è¿”å›ç»™ kubelet ä¸€ä¸ª RedirectURL çš„ responseï¼Œç„¶å kubelet å°†è¿™ä¸€ä¸ª response ç›´æ¥è¿”å›ç»™ apiserverï¼›åç»­ apiserver å°±å¯ä»¥ç›´æ¥ä¸ StreamingServer é€šä¿¡äº†ï¼Œä¸éœ€è¦å†ç»è¿‡ kubelet ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604022502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326443,"user_name":"Join","can_delete":false,"product_type":"c1","uid":1014873,"ip_address":"","ucode":"20F51EFFD8FEDE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/59/dc9bbb21.jpg","comment_is_top":false,"comment_ctime":1639531162,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5934498458","product_id":100015201,"comment_content":"å¯¹CRIçš„è®¤è¯†æ›´è¿›ä¸€å±‚äº†","like_count":2},{"had_liked":false,"id":353536,"user_name":"çªçªå¤´","can_delete":false,"product_type":"c1","uid":1063866,"ip_address":"åŒ—äº¬","ucode":"5C2635ED6484F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/ba/3b30dcde.jpg","comment_is_top":false,"comment_ctime":1659525757,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1659525757","product_id":100015201,"comment_content":"CreateContaineræˆ–è€…RunPodSandboxå§","like_count":0},{"had_liked":false,"id":320049,"user_name":"é™ˆæ–¯ä½³","can_delete":false,"product_type":"c1","uid":1259323,"ip_address":"","ucode":"C236F874FC767A","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","comment_is_top":false,"comment_ctime":1636064716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636064716","product_id":100015201,"comment_content":"ç¬¬å››åå››è¯¾:è§£è¯»CRIä¸å®¹å™¨è¿è¡Œæ—¶<br>CRIæœºåˆ¶èƒ½å¤Ÿå‘æŒ¥ä½œç”¨çš„æ ¸å¿ƒï¼Œå°±åœ¨äºæ¯ä¸ªå®¹å™¨é¡¹ç›®ç°åœ¨éƒ½èƒ½è‡ªå·±å®ç°ä¸€ä¸ªCRI shimï¼Œè‡ªè¡Œå¯¹CRIè¯·æ±‚è¿›è¡Œå¤„ç†ã€‚<br><br>CRIå¯ä»¥åˆ†ä¸ºä¸¤ç»„ï¼Œç¬¬ä¸€ç»„æ˜¯RuntimeServiceã€‚å®ƒæä¾›çš„æ¥å£ä¸»è¦æ˜¯è·Ÿå®¹å™¨ç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºæˆ–å¯åŠ¨å®¹å™¨ï¼Œåˆ é™¤å®¹å™¨ï¼Œå’Œæ‰§è¡Œexecå‘½ä»¤ç­‰ã€‚è¿™ç»„çš„è®¾è®¡åŸåˆ™æ˜¯ç¡®ä¿è¿™ä¸ªæ¥å£æœ¬èº«åªå…³æ³¨å®¹å™¨ã€‚ç¬¬äºŒç»„æ˜¯ImageServiceï¼Œå®ƒæä¾›çš„æ¥å£ä¸»è¦æ˜¯å®¹å™¨é•œåƒç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚æ‹‰å–å’Œåˆ é™¤é•œåƒç­‰ã€‚","like_count":0},{"had_liked":false,"id":311875,"user_name":"lttzzlll","can_delete":false,"product_type":"c1","uid":1105387,"ip_address":"","ucode":"FA160F7C02ABAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","comment_is_top":false,"comment_ctime":1631518899,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1631518899","product_id":100015201,"comment_content":"k8sä¸­æ˜¯å¦å¯ä»¥åŒæ—¶å­˜åœ¨ docker, containerd, gVisor ç­‰ä¸åŒçš„å®¹å™¨ï¼Ÿæ ¹æ®labelåˆ†é…ä¸åŒçš„ä»»åŠ¡ã€‚","like_count":0,"discussions":[{"author":{"id":2345670,"avatar":"https://static001.geekbang.org/account/avatar/00/23/ca/c6/50b93802.jpg","nickname":"ç¥è¿‡","note":"","ucode":"4DAC8518996ED2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576421,"discussion_content":"å®ç°ä¸€å¥—cri shimï¼Œæ ¹æ®labelæ¥å†³å®šä½¿ç”¨åº•å±‚å“ªä¸ªå®¹å™¨å¼•æ“","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655535278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2924042,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/9e/0a/daa4b702.jpg","nickname":"AganiPPE","note":"","ucode":"3BD88D641CEA7C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567647,"discussion_content":"è¿™ä¸ªå¯èƒ½éœ€è¦é‡æ„æ‰€æœ‰çš„æ§åˆ¶å™¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650965888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2924042,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/9e/0a/daa4b702.jpg","nickname":"AganiPPE","note":"","ucode":"3BD88D641CEA7C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586282,"discussion_content":"ä¸ç”¨çš„ï¼Œæˆ‘ç†è§£çš„æ˜¯è‡ªå·±å®ç°ä¸€å¥—criæ¥å£çš„å®ç°ï¼Œ ä½ å¯ä»¥ç»™ä»–éšä¾¿æœŸåå­—ï¼Œç„¶åé€šè¿‡ä½ å®ç°çš„criè¿™ä¸ªæ¥å£æŠŠdocker, containerd, gVisoræè¿›æ¥å°±è¡Œï¼Œæ— éå°±æ˜¯åŠ ä¸ªlabelè€Œå·²ï¼Œæ ¹æ®labelçš„ä¸åŒæ¥åˆ¤æ–­è°ƒç”¨å…·ä½“çš„å“ªä¸ªcri-shim","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662088351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":567647,"ip_address":"åŒ—äº¬"},"score":586282,"extra":""}]}]}]}