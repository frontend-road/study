{"id":775105,"title":"14ï½œæ•°æ®ä¸ŠæŠ¥æ–¹æ¡ˆï¼šå¦‚ä½•åœ¨ä¸å½±å“ç”¨æˆ·ä½“éªŒä¸‹å®ç°æ•°æ®ä¸ŠæŠ¥ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸‰æ¡¥ã€‚</p><p>å‰é¢å‡ èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¸€ç›´å­¦ä¹ å¦‚ä½•åœ¨å‰ç«¯åº”ç”¨ä¸­æ•è·å‰ç«¯å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶åŸºäºå…¨é“¾è·¯æ•°æ®ç»“æ„æŠŠä¿¡æ¯å­˜å‚¨èµ·æ¥ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸‹åº”è¯¥å¦‚ä½•ç”¨æœ€ä¼˜çš„æ–¹æ³•ï¼ŒæŠŠå¼‚å¸¸ä¿¡æ¯ä¸ŠæŠ¥åˆ°åç«¯æœåŠ¡ã€‚</p><p>ä¸å°‘å‰ç«¯åŒå­¦éƒ½éå¸¸ç†Ÿæ‚‰ç›‘æ§å¹³å°SDKä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®çš„æµç¨‹ï¼Œé‚£åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬æ¢ä¸ªè§’åº¦æ¢è®¨3ä¸ªé‡è¦çš„é€»è¾‘ï¼Œåˆ†åˆ«æ˜¯é€‰æ‹©ä¸ŠæŠ¥æ–¹å¼ã€å®ç°ç®€æ˜“çš„ä¸ŠæŠ¥æ¥å£ä»¥åŠé€‰æ‹©ä¸ŠæŠ¥æ—¶æœºã€‚</p><h2>å‰ç«¯åŸ‹ç‚¹ä¸ŠæŠ¥çš„æ–¹å¼</h2><p>å®é™…ä¸Šï¼Œå‰ç«¯å…¨é“¾è·¯çš„åŸ‹ç‚¹ä¸ŠæŠ¥æ–¹æ¡ˆå’Œå‰ç«¯ç›‘æ§åŸ‹ç‚¹çš„æ–¹æ¡ˆæ˜¯ç›¸åŒçš„ã€‚ç›®å‰ä¸»æµçš„å‰ç«¯ç›‘æ§å¹³å°éƒ½æ˜¯ä½¿ç”¨GIFè¿›è¡ŒåŸ‹ç‚¹ï¼Œä¾‹å¦‚ç™¾åº¦ç»Ÿè®¡ã€è°·æ­Œç»Ÿè®¡ç­‰ã€‚</p><p>ä»€ä¹ˆæ˜¯ä¸ŠæŠ¥å‘¢ï¼Ÿå°±æ˜¯å½“å‰ç«¯é¡µé¢äº§ç”Ÿé“¾è·¯æ—¥å¿—åï¼Œå°†æ—¥å¿—æ•°æ®ä¼ é€’ç»™æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦èƒ½å°†æ•°æ®ä¸ŠæŠ¥åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯GIFè¯·æ±‚è¿˜æ˜¯Fetchè¯·æ±‚ï¼Œç›‘æ§æœåŠ¡å™¨æ˜¯ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„ä¸ŠæŠ¥æ–¹å¼çš„ã€‚</p><p>ä¸è¿‡é€‰æ‹©ä¸ŠæŠ¥æ–¹å¼ä¹Ÿå¾ˆé‡è¦ã€‚åœ¨è¯´å¦‚ä½•é€‰æ‹©ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹ä¸‰ç§å¸¸è§çš„è¯·æ±‚ä¸ŠæŠ¥æ–¹å¼ã€‚</p><h3>ä¸ºä»€ä¹ˆä¸ç”¨Fetchå’Œxhrï¼Ÿ</h3><p>è™½ç„¶ä½¿ç”¨Fetchç‰¹æ€§ä¸ŠæŠ¥åŸ‹ç‚¹æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼Œä½†å¹¶ä¸æ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚æœ‰ä¸‰ä¸ªåŸå› ã€‚</p><p>ç¬¬ä¸€ï¼ŒFetchéœ€è¦éµå¾ªåŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè·¨åŸŸè¯·æ±‚å¯èƒ½ä¼šå› ä¸ºæµè§ˆå™¨çš„é™åˆ¶è€Œè¯·æ±‚å¤±è´¥ã€‚</p><p>ç¬¬äºŒï¼ŒFetchæ˜¯æ–°Webæµè§ˆå™¨çš„ç‰¹æ€§å’Œæ ‡å‡†ï¼Œè¦æ»¡è¶³å…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨ï¼Œå°±éœ€è¦é‡‡ç”¨polyfillçš„æ–¹å¼è§£å†³å…¼å®¹é—®é¢˜ï¼Œæ— å½¢ä¸­ç»™SDKå¢åŠ äº†ä¸å°‘å…¼å®¹æ€§ä»£ç ï¼Œé€ æˆè´Ÿæ‹…ã€‚</p><!-- [[[read_end]]] --><p>ç¬¬ä¸‰ï¼Œç›´æ¥ä½¿ç”¨Fetchå¯èƒ½ä¼šå—åˆ°ç½‘ç»œæ³¢åŠ¨æˆ–è¯·æ±‚è¶…æ—¶ç­‰å› ç´ å½±å“ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ä¸å‡†ç¡®ã€‚</p><p>å¦å¤–æä¸€å¥ï¼ŒXMLHttpRequestæ˜¯æœ€æ—©æ”¯æŒå‰ç«¯ä»£ç è¯·æ±‚çš„æ–¹æ³•ï¼Œä½†éœ€è¦å°è£…æ›´å¤šçš„ä»£ç ï¼Œè€Œä¸”è¿˜ä¸æ”¯æŒPromiseã€‚ä½†å› ä¸ºå®ƒå¯¹ä½ç«¯æµè§ˆå™¨çš„å…¼å®¹æ€§æ˜¯æœ€å¥½çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä½œä¸ºå‘ä¸‹çš„å…¼å®¹æ–¹æ¡ˆã€‚</p><h3>ä½¿ç”¨sendBeaconçš„åˆ©å¼Š</h3><p>ç¬¬äºŒç§æ–¹æ¡ˆåˆ©ç”¨äº†æµè§ˆå™¨Beacon APIèƒ½åŠ›ã€‚å®ƒå¯ä»¥ç»™æœåŠ¡å™¨å‘é€å¼‚æ­¥å’Œéé˜»å¡è¯·æ±‚ï¼Œè¿™ç±»è¯·æ±‚æ˜¯ä¸éœ€è¦å“åº”ç»“æœçš„ã€‚å®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯æµè§ˆå™¨ä¼šåœ¨ä¿è¯é¡µé¢å¸è½½å‰å°±æŠŠè¯·æ±‚å‘é€å®Œæˆã€‚æ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šåˆ©ç”¨å®ƒå°†åˆ†ææ•°æ®å‘é€ç»™æœåŠ¡å™¨ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨sendBeaconçš„å®ç°ä»£ç ã€‚</p><pre><code class=\"language-typescript\">// src/core/util.ts\n\nexport function sendBeacon(url: string, data: TraceData) {\n&nbsp; if (typeof navigator === 'undefined') return\n&nbsp; navigator.sendBeacon &amp;&amp; navigator.sendBeacon(url, JSON.stringify(data))\n}\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBeacon APIå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚å…¼å®¹æ€§é—®é¢˜ï¼Œåƒå¾®ä¿¡å†…ç½®æµè§ˆå™¨å’Œå¾®ä¿¡å°ç¨‹åºè¿™ä¸¤ç§åœºæ™¯ï¼ŒBeacon APIå°±æ— æ³•ä½¿ç”¨äº†ï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨å…¶å®ƒæ–¹æ¡ˆã€‚</p><h3>ä½¿ç”¨GIFå›¾ç‰‡</h3><p>ç¬¬ä¸‰ç§æ–¹æ¡ˆæ˜¯é€šè¿‡å›¾ç‰‡è¯·æ±‚çš„æ–¹å¼å®Œæˆæ•°æ®çš„ä¸ŠæŠ¥ï¼Œåªè¦åˆ›å»ºä¸€ä¸ªImageå¯¹è±¡ï¼Œå¹¶å°†å…¶srcå±æ€§è®¾ä¸ºâ€œéœ€è¦ä¸ŠæŠ¥çš„URLâ€å°±å¯ä»¥äº†ã€‚</p><p>è¿™æ˜¯ä¸€ç§æ—¢ç®€å•åˆå¿«é€Ÿçš„æ–¹å¼ã€‚å®ƒè§£å†³äº†å‰é¢ä¸¤ä¸ªæŠ€æœ¯çš„å…¼å®¹æ€§é—®é¢˜å’Œè·¨åŸŸé—®é¢˜ï¼Œç”šè‡³è¿˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ä¸ä¼šé˜»å¡é¡µé¢åŠ è½½ï¼Œå³ä½¿è¯·æ±‚å¤±è´¥ä¹Ÿä¸ä¼šå½±å“ç”¨æˆ·å¯¹é¡µé¢çš„æ­£å¸¸äº¤äº’ä½“éªŒã€‚æ‰€ä»¥ï¼Œå‰ç«¯ç›‘æ§å¹³å°é€šå¸¸ä¼šé‡‡ç”¨è¿™ç§æ–¹æ¡ˆã€‚</p><p>é‚£æ€ä¹ˆä½¿ç”¨å›¾ç‰‡æ‰æ˜¯æœ€ä¼˜çš„æ–¹æ¡ˆå‘¢ï¼Ÿæˆ‘ä»¬å…ˆé€‰æ‹©1x1åƒç´ çš„é€æ˜å›¾ç‰‡ï¼Œä¹Ÿæ˜¯æœ€å°çš„åˆæ³•å›¾ç‰‡ã€‚æ¥ç€ï¼Œæˆ‘ä»¬é€‰æ‹©GIFæ ¼å¼ï¼Œå› ä¸ºå®ƒçš„ä½“ç§¯æ¯”BMPã€PNGæ ¼å¼è¿˜è¦å°ï¼Œæ‰€ä»¥èƒ½èŠ‚çœç”¨æˆ·çš„æµé‡ã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨å›¾ç‰‡ä¸ŠæŠ¥çš„é€»è¾‘å®ç°ä»£ç ã€‚</p><pre><code class=\"language-typescript\">// src/core/util.ts\n\nexport function sendByImg(url: string, data: TraceData) {\n&nbsp; const spliceStr = url.indexOf('?') === -1 ? '?' : '&amp;'\n&nbsp; const imageUrl = `${url}${spliceStr}data=${encodeURIComponent(safeStringify(data))}`;\n&nbsp; let img = new Image()\n&nbsp; img.src = imageUrl\n&nbsp; img.onload = function() {\n&nbsp; &nbsp; console.log(\"Tracking data sent successfully!\");\n&nbsp; &nbsp; img = null\n&nbsp; };\n&nbsp; img.onerror = function() {\n&nbsp; &nbsp; console.error(\"Failed to send tracking data.\");\n&nbsp; &nbsp; img = null\n&nbsp; };\n}\n</code></pre><p>é€šè¿‡å¯¹æ¯”ä¸‰ç§å¸¸è§çš„è¯·æ±‚æ–¹å¼ï¼Œæœ€ç»ˆæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨GIFå›¾ç‰‡ä½œä¸ºåŸ‹ç‚¹ä¸ŠæŠ¥çš„æ–¹æ¡ˆã€‚è‡³äºå…¶å®ƒæ–¹æ¡ˆï¼Œåœ¨çœŸæ­£éœ€è¦ç”¨åˆ°çš„æ—¶å€™å†å»å…¼å®¹å³å¯ã€‚</p><h2>ç®€æ˜“çš„ä¸ŠæŠ¥æ¥å£</h2><p>æœ‰äº›åŒå­¦å¯èƒ½ä¼šå¥½å¥‡ï¼Œå‰ç«¯ä½¿ç”¨GIFå›¾ç‰‡ä¸ŠæŠ¥åŸ‹ç‚¹çš„æ–¹å¼ï¼Œåç«¯æœåŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿä¸ºä»€ä¹ˆå‘èµ·ä¸€æ¬¡å›¾ç‰‡è¯·æ±‚ï¼Œå°±å¯ä»¥æŠŠå‚æ•°å¸¦å›æœåŠ¡å™¨ç«¯ï¼Œå¹¶ä¸”è¿˜èƒ½æŠŠæ•°æ®ä¿å­˜èµ·æ¥ï¼Ÿ</p><p>è¿™é‡Œè™½ç„¶æ¶‰åŠä¸€äº›åç«¯çš„çŸ¥è¯†ï¼Œä½†å¹¶ä¸éš¾ç†è§£ã€‚å®é™…ä¸Šï¼Œå®ç°åŸ‹ç‚¹ä¸ŠæŠ¥æ¥å£ï¼Œä»£ç é€»è¾‘ä¸ä¼šå¾ˆå¤šï¼Œåè€Œæ˜¯æœ€å®¹æ˜“å®ç°çš„æ¥å£ã€‚</p><h3>æ¥å£çš„å®ç°</h3><p>æˆ‘ä»¬ä»¥å‰ç«¯åŒå­¦ç†Ÿæ‚‰çš„Node.jsä¸ºä¾‹ï¼Œç»“åˆExpressæ¡†æ¶ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ä¸ŠæŠ¥æ¥å£ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">const express = require('express');\nconst app = express();\nconst port = 3000;\n\napp.get('/track.gif', (req, res) =&gt; {\n&nbsp; &nbsp; const data = req.query.data; // è·å–URLä¸­çš„dataå‚æ•°\n\n&nbsp; &nbsp; // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥å°†dataå­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ—¥å¿—æ–‡ä»¶ä¸­\n&nbsp; &nbsp; console.log(\"Received tracking data: \", data);\n\n&nbsp; &nbsp; // è¿”å›ä¸€ä¸ª1x1åƒç´ çš„é€æ˜GIFå›¾ç‰‡\n&nbsp; &nbsp; const img = Buffer.from('R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==', 'base64');\n&nbsp; &nbsp; res.writeHead(200, {\n&nbsp; &nbsp; &nbsp; &nbsp; 'Content-Type': 'image/gif',\n&nbsp; &nbsp; &nbsp; &nbsp; 'Content-Length': img.length\n&nbsp; &nbsp; });\n&nbsp; &nbsp; res.end(img);\n});\n\napp.listen(port, () =&gt; {\n&nbsp; &nbsp; console.log(`Server running at http://localhost:${port}`);\n});\n</code></pre><p>è¿™å‡ è¡Œä»£ç æœ‰ä¸‰ä¸ªé‡ç‚¹ã€‚</p><p>ç¬¬ä¸€æ˜¯ä½¿ç”¨track.gifåå­—ä½œä¸ºæ¥å£è·¯å¾„ï¼Œæ¨¡æ‹Ÿå‡ºgifæ ¼å¼çš„URLåœ°å€ã€‚è¿™ä¸ªå¸¦æœ‰gifåç¼€çš„åœ°å€ç›¸å½“äºè¯´æ˜äº†è¿™ä¸ªURLæ˜¯ä¸ºäº†è®©å‰ç«¯ä»£ç å‘èµ·ä¸€ä¸ªå›¾ç‰‡æ ¼å¼çš„è¯·æ±‚ã€‚</p><p>ç¬¬äºŒï¼Œåˆ›å»ºä¸€ä¸ª1x1åƒç´ çš„é€æ˜GIFå›¾ç‰‡ã€‚å…¶é€»è¾‘æ˜¯æŠŠè¦ç¼–ç çš„å­—ç¬¦ä¸²ä»¥Base64ç¼–ç æ ¼å¼ç”ŸæˆBufferå¯¹è±¡ã€‚</p><p>ç¬¬ä¸‰ï¼Œåœ¨è¿”å›ç»“æœå‰ï¼Œç»™æ¥å£çš„å“åº”ç±»å‹è®¾ç½®ä¸ºgifæ ¼å¼ï¼Œå³â€œimage/gifâ€ã€‚å†æŠŠå“åº”å¤´çš„å†…å®¹é•¿åº¦è®¾ç½®ä¸ºå›¾ç‰‡çš„é•¿åº¦ã€‚æœ€åé€šè¿‡res.endæ–¹æ³•æŠŠç”Ÿæˆçš„å›¾ç‰‡å¯¹è±¡è¿”å›ç»™å‰ç«¯ã€‚</p><p>è¿™ä¸‰ä¸ªé‡ç‚¹ï¼Œæ„æˆäº†æœ€ç®€å•çš„æ¨¡æ‹ŸGIFæ ¼å¼æ¥å£çš„æ ¸å¿ƒé€»è¾‘ã€‚</p><h3>æ—¥å¿—å­˜å‚¨çš„æ–¹æ¡ˆ</h3><p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¿™é‡Œçš„æ¥å£å¹¶æ²¡æœ‰å®ç°å¤„ç†é“¾è·¯æ—¥å¿—çš„é€»è¾‘ã€‚å› ä¸ºï¼Œè¿™é‡Œå°±çœŸæ­£æ¶‰åŠåç«¯çš„é€»è¾‘äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®éƒ½æ˜¯ä½¿ç”¨MySQLå…³ç³»å‹æ•°æ®åº“æ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ—¥å¿—å°±ä¸èƒ½è¿™æ ·å­˜å‚¨äº†ã€‚å› ä¸ºå‰ç«¯é¡µé¢ä¼šäº§ç”Ÿå¤§é‡çš„é“¾è·¯æ—¥å¿—æ•°æ®ï¼Œå¦‚æœä½¿ç”¨å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ï¼Œé¢‘ç¹çš„å†™å…¥æ“ä½œä¼šç›´æ¥å½±å“æ•°æ®åº“çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå½±å“æ›´å¤§ã€‚</p><p>é‚£æ€ä¹ˆåšæ‰èƒ½æœ‰æ•ˆåœ°å­˜å‚¨å…¨é“¾è·¯æ—¥å¿—å‘¢ï¼Ÿ</p><p>å­˜å‚¨æ—¥å¿—æœ€å¸¸è§çš„åšæ³•æ˜¯æŠŠæ—¥å¿—å­˜å‚¨åœ¨æ—¥å¿—æœåŠ¡æˆ–NoSQLæ•°æ®åº“ä¸­ã€‚å…·ä½“çš„æ–¹æ³•æœ‰4ç§ï¼Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨ã€NoSQLæ•°æ®åº“ã€åˆ†å¸ƒå¼æ—¥å¿—å­˜å‚¨ç³»ç»Ÿå’Œæ—¥å¿—åˆ†æå¹³å°ã€‚</p><ul>\n<li>æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨ã€‚è¿™ç§æ–¹æ¡ˆå°±æ˜¯å°†å‰ç«¯åŸ‹ç‚¹çš„æ—¥å¿—æ•°æ®å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åé€šè¿‡å®šæ—¶ï¼Œå°†æ—¥å¿—æ–‡ä»¶ä¸Šä¼ åˆ°æ—¥å¿—å­˜å‚¨ç³»ç»Ÿã€‚ä¸è¿‡è¿™ç§æ–¹æ¡ˆè¿˜éœ€è¦å¤„ç†æ—¥å¿—æ–‡ä»¶ï¼Œé¢å¤–å·¥ä½œæ¯”è¾ƒå¤šï¼Œå› æ­¤å¹¶ä¸é€‚åˆå…¨é“¾è·¯æ—¥å¿—ã€‚</li>\n<li>NoSQLæ•°æ®åº“ã€‚è¿™ç§æ•°æ®åº“å…·æœ‰è‰¯å¥½çš„æ¨ªå‘æ‰©å±•æ€§å’Œé«˜æ€§èƒ½ï¼Œæ¯”è¾ƒé€‚åˆå­˜å‚¨å¤§è§„æ¨¡çš„æ—¥å¿—æ•°æ®ã€‚ä½†å®ƒæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹äºå¤æ‚æŸ¥è¯¢çš„å¤„ç†èƒ½åŠ›æ¯”è¾ƒå¼±ã€‚å¯¹äºå…¨é“¾è·¯æ—¥å¿—æ¥è¯´ï¼Œå¦‚æœæ— æ³•æ»¡è¶³å¤æ‚çš„æŸ¥è¯¢éœ€æ±‚ï¼Œé‚£ä¹ˆå­˜å‚¨çš„æ„ä¹‰ä¹Ÿä¸å¤§äº†ã€‚</li>\n<li>åˆ†å¸ƒå¼æ—¥å¿—å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚Kafkaã€‚è¿™ç±»ç³»ç»Ÿä¸“é—¨ç”¨äºæ”¶é›†ã€å­˜å‚¨å’Œåˆ†æé«˜ååé‡çš„æ—¥å¿—ï¼Œè¿™äº›ç³»ç»Ÿé€šå¸¸éƒ½æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”æœ‰è¾ƒé«˜çš„å­¦ä¹ æˆæœ¬å’Œé…ç½®å·¥ä½œï¼ŒåŒæ—¶è¿˜æœ‰å¯èƒ½éœ€è¦é¢å¤–çš„ç»´æŠ¤å’Œç›‘æ§ã€‚</li>\n<li>æ—¥å¿—åˆ†æå¹³å°ã€‚è¿™ç±»å¹³å°æœ€å¤§çš„äº®ç‚¹æ˜¯æä¾›äº†å¼ºå¤§çš„æ—¥å¿—åˆ†æå’ŒæŸ¥è¯¢èƒ½åŠ›ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®æ—¶ç›‘æ§å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚åŒæ ·åœ°ï¼Œå…¶éƒ¨ç½²å’Œç»´æŠ¤æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œä¹Ÿæœ‰è¾ƒé«˜çš„å­¦ä¹ æˆæœ¬ã€‚</li>\n</ul><p>é‚£è¿™4ç§æ–¹æ³•ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</p><p>å¯¹äºå°è§„æ¨¡çš„å‰ç«¯åº”ç”¨ï¼Œæˆ‘å»ºè®®ç›´æ¥ä½¿ç”¨NoSQLæ•°æ®åº“å°±è¶³å¤Ÿäº†ã€‚</p><p>å¦‚æœå‰ç«¯åº”ç”¨éœ€è¦ç›‘æ§å¤§é‡å®æ—¶æ—¥å¿—æ•°æ®ï¼Œä¾‹å¦‚ç›´æ’­åº”ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼æ—¥å¿—å­˜å‚¨ç³»ç»Ÿã€‚</p><p>æˆ‘å»ºè®®å‰ç«¯åº”ç”¨å¯ä»¥è€ƒè™‘æ¥å…¥å›½å†…äº‘å‚å•†çš„æ—¥å¿—æœåŠ¡ï¼Œä¾‹å¦‚é˜¿é‡Œäº‘çš„SLSæ—¥å¿—æœåŠ¡ã€è…¾è®¯äº‘çš„CLSæ—¥å¿—æœåŠ¡ä»¥åŠåä¸ºäº‘çš„LTSäº‘æ—¥å¿—æœåŠ¡ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å°†ä»¥å­˜å‚¨æ—¥å¿—æ–‡ä»¶ä¸ºä¾‹è¯´æ˜ã€‚</p><p>é¦–å…ˆå¼•å…¥log4jsæ—¥å¿—åº“ï¼Œå¹¶é…ç½®æ—¥å¿—æ–‡ä»¶ä¸ºtrack.logã€‚ç¨å¾®æ”¹é€ ä¸€ä¸‹å‰é¢çš„ä»£ç ï¼Œæœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">const express = require('express');\nconst log4js = require('log4js');\nconst app = express();\nconst port = 3000;\n\nlog4js.configure({\n  appenders: { track: { type: 'file', filename: 'track.log' } },\n  categories: { default: { appenders: ['track'], level: 'info' } }\n});\nconst logger = log4js.getLogger('track');\n\napp.get('/track.gif', (req, res) =&gt; {\n&nbsp; &nbsp; const data = req.query.data; // è·å–URLä¸­çš„dataå‚æ•°\n\n&nbsp; &nbsp; // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯ä»¥å°†dataå­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ—¥å¿—æ–‡ä»¶ä¸­\n&nbsp; &nbsp; // console.log(\"Received tracking data: \", data);\n    logger.info(data);\n\n&nbsp; &nbsp; // è¿”å›ä¸€ä¸ª1x1åƒç´ çš„é€æ˜GIFå›¾ç‰‡\n&nbsp; &nbsp; const img = Buffer.from('R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==', 'base64');\n&nbsp; &nbsp; res.writeHead(200, {\n&nbsp; &nbsp; &nbsp; &nbsp; 'Content-Type': 'image/gif',\n&nbsp; &nbsp; &nbsp; &nbsp; 'Content-Length': img.length\n&nbsp; &nbsp; });\n&nbsp; &nbsp; res.end(img);\n});\n\napp.listen(port, () =&gt; {\n&nbsp; &nbsp; console.log(`Server running at http://localhost:${port}`);\n});\n</code></pre><h2>æ¥å£ä¸ŠæŠ¥è§¦å‘æ—¶æœº</h2><p>å¥½äº†ï¼Œè¯´å®ŒåŸ‹ç‚¹æ¥å£åï¼Œæˆ‘ä»¬å°±æ¥æ¢è®¨æ¥å£è§¦å‘çš„æ—¶æœºã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨ä»€ä¹ˆæ—¶é—´å’Œä»€ä¹ˆåœºæ™¯ä¸‹æŠŠé“¾è·¯æ—¥å¿—æ•°æ®ä¸ŠæŠ¥åˆ°æœåŠ¡å™¨ã€‚</p><p>æˆ‘ä»¬åœ¨å‰é¢å‡ èŠ‚è¯¾å­¦åˆ°ï¼Œè§¦å‘è®°å½•é“¾è·¯æ—¥å¿—çš„äº‹ä»¶æœ‰5ç§ï¼Œå…¨å±€Erroräº‹ä»¶ã€å…¨å±€unhandlerejectionäº‹ä»¶ã€è‡ªå®šä¹‰æ—¥å¿—äº‹ä»¶ã€ç½‘é¡µæŒ‡æ ‡äº‹ä»¶ã€æ¥å£å¼‚å¸¸äº‹ä»¶ã€‚</p><p>ç½‘é¡µæŒ‡æ ‡äº‹ä»¶åœ¨æ­¤å‰å·²ç»é€šè¿‡é¡µé¢pageHideäº‹ä»¶å’Œvisibilitychangeäº‹ä»¶è‡ªåŠ¨è§¦å‘ä¸ŠæŠ¥ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¸ç»§ç»­æ¢è®¨äº†ã€‚</p><p>è‡ªå®šä¹‰æ—¥å¿—äº‹ä»¶çš„ä¸»è¦åŠŸèƒ½æ˜¯æä¾›ç»™ä¸šåŠ¡å±‚ä½¿ç”¨ï¼Œé€šè¿‡try-catchæˆ–ç‰¹å®šé€»è¾‘è¿›è¡Œæ—¥å¿—è®°å½•ã€‚ä»é€»è¾‘è§’åº¦æ¥çœ‹ï¼Œè¿™ç§äº‹ä»¶å¹¶ä¸æ˜¯é«˜é¢‘è§¦å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æä¾›å®æ—¶ä¸ŠæŠ¥çš„åŠ¨ä½œã€‚</p><p>ä»ä»£ç é€»è¾‘çš„è§’åº¦çœ‹ï¼Œå…¨å±€Errorã€å…¨å±€unhandlerejectionå’Œæ¥å£å¼‚å¸¸åº”è¯¥æ˜¯è§¦å‘æœ€é¢‘ç¹çš„äº‹ä»¶ï¼Œå¦‚æœæ¯æ¬¡äº‹ä»¶è§¦å‘å°±è‡ªåŠ¨ä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ï¼Œå¯èƒ½åœ¨æŸä¸ªæ—¶é—´ç‚¹å‡ºç°å¤§é‡çš„å›¾ç‰‡è¯·æ±‚çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸ä»…ä¼šå½±å“ç”¨æˆ·çš„ä½“éªŒï¼Œè¿˜å¯èƒ½ä¼šç»™æ—¥å¿—æœåŠ¡å¸¦æ¥å‹åŠ›ï¼Œå¾—ä¸å¿å¤±ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å»¶è¿Ÿä¸ŠæŠ¥çš„æ–¹æ³•ã€‚</p><p>é€šè¿‡ä¸‹å›¾è¡¨æ ¼ï¼Œä½ èƒ½æ›´åŠ ç›´è§‚åœ°äº†è§£æ¯ä¸€ç§äº‹ä»¶çš„ä¸ŠæŠ¥æ—¶æœºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/d7/b0a2d8862eb27178338006db0343b9d7.jpg?wh=2126x714\" alt=\"å›¾ç‰‡\"></p><p>é‚£æ€ä¹ˆåšæ‰èƒ½æ»¡è¶³å»¶è¿Ÿä¸ŠæŠ¥çš„èƒ½åŠ›å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªqueueé˜Ÿåˆ—å±æ€§ï¼Œç”¨äºå­˜å‚¨éœ€è¦å»¶è¿Ÿä¸ŠæŠ¥çš„é“¾è·¯æ—¥å¿—æ•°æ®ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å†è®¾å®šä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œè§„å®šæ¯éš”å¤šé•¿æ—¶é—´ä¸ŠæŠ¥ä¸€æ¬¡æ•°æ®ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">// src/baseTrace.ts\n\nexport class BaseTrace implements BaseTraceInterface {\n\t// å­˜å‚¨é“¾è·¯æ—¥å¿—æ•°æ®\n&nbsp; public queue: TraceData[] = []\n&nbsp; // å‘é€è¯·æ±‚æ—¶é—´é—´éš”\n&nbsp; public sendTimer = 1000\n}\n</code></pre><p>ç„¶åï¼Œè®¾ç½®é»˜è®¤æ—¶é—´é—´éš”ä¸º1000æ¯«ç§’ï¼Œä»queueä¸­æå–æ—¥å¿—æ•°æ®ï¼Œå‘é€åˆ°åç«¯æœåŠ¡ã€‚å…·ä½“çš„å®ç°é€»è¾‘æ˜¯ï¼Œåœ¨SDKåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨setIntervalå‡½æ•°å¢åŠ ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç›‘å¬queueé˜Ÿåˆ—æ•°ç»„æ˜¯å¦æœ‰æ—¥å¿—æ•°æ®ï¼Œå¦‚æœæœ‰å°±æå–æ•°æ®å¹¶å‘é€ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">// src/baseTrace.ts\n\nexport class BaseTrace implements BaseTraceInterface {\n&nbsp; // åˆå§‹åŒ–å®ä¾‹\n&nbsp; public static init(options: TraceOptions): BaseTrace {\n\t&nbsp; const traceSdk = new BaseTrace(options)\n\t&nbsp; // ...çœç•¥éƒ¨åˆ†ä»£ç \n\tsetInterval(() =&gt; {\n&nbsp; &nbsp; &nbsp; const data = traceSdk.queue.shift()\n&nbsp; &nbsp; &nbsp; if (data) sendByImg(traceSdk.dsn, data)\n&nbsp; &nbsp; }, traceSdk.sendTimer)\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; window.traceSdk = traceSdk\n&nbsp; &nbsp; return traceSdk\n&nbsp; }\n}\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é’ˆå¯¹ä¸‰ç§ä¸åŒçš„äº‹ä»¶ï¼Œå°†é”™è¯¯äº‹ä»¶çš„é“¾è·¯æ—¥å¿—æ•°æ®å­˜å‚¨åœ¨queueé˜Ÿåˆ—ä¸­ã€‚å…·ä½“å®ç°çš„ä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">// src/baseTrace.ts\n\nexport class BaseTrace implements BaseTraceInterface {\n\t// å­˜å‚¨é“¾è·¯æ—¥å¿—æ•°æ®\n&nbsp; public queue: TraceData[] = []\n&nbsp; // å‘é€è¯·æ±‚æ—¶é—´é—´éš”\n&nbsp; public sendTimer = 1000\n&nbsp;&nbsp;\n&nbsp; public setTraceData(data: TraceTypeData | TracePerf) {\n&nbsp; &nbsp; let type = TraceTypes.CONSOLE\n&nbsp; &nbsp; let level = TraceLevelType.Debug\n&nbsp; &nbsp; let _data = null\n&nbsp; &nbsp; let perf = null\n\n&nbsp; &nbsp; if (!!(data as TraceTypeData).dataId) {\n&nbsp; &nbsp; &nbsp; type = getTraceDataType((data as TraceTypeData).type)\n&nbsp; &nbsp; &nbsp; level = getTraceDataLevel((data as TraceTypeData).level)\n&nbsp; &nbsp; &nbsp; _data = data as TraceTypeData\n&nbsp; &nbsp; }\n&nbsp; &nbsp; if (!!(data as TracePerf).id) {\n&nbsp; &nbsp; &nbsp; type = TraceTypes.PERF\n&nbsp; &nbsp; &nbsp; level = getPerfLevel(data as TracePerf)\n&nbsp; &nbsp; &nbsp; perf = data as TracePerf\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; const traceData: TraceData = {\n&nbsp; &nbsp; &nbsp; type,\n&nbsp; &nbsp; &nbsp; level,\n&nbsp; &nbsp; &nbsp; createdAt: getTimestamp(),\n&nbsp; &nbsp; &nbsp; updatedAt: getTimestamp(),\n&nbsp; &nbsp; &nbsp; data: _data,\n&nbsp; &nbsp; &nbsp; perf,\n&nbsp; &nbsp; &nbsp; breadcrumbs: this.breadcrumb,\n&nbsp; &nbsp; &nbsp; traceId: uuid(),\n&nbsp; &nbsp; &nbsp; ua: this.userAgent,\n&nbsp; &nbsp; &nbsp; bt: this.browserType,\n&nbsp; &nbsp; &nbsp; fpId: this.fpId,\n&nbsp; &nbsp; &nbsp; appId: '',\n&nbsp; &nbsp; &nbsp; clientType: TraceClientTypes.BROWSER_H5,\n&nbsp; &nbsp; &nbsp; url: document.URL,\n&nbsp; &nbsp; &nbsp; pid: this.pageId,\n&nbsp; &nbsp; }\n&nbsp; &nbsp; return traceData\n&nbsp; }\n\n&nbsp; public send(data: TraceTypeData | TracePerf) {\n&nbsp; &nbsp; const traceData = this.setTraceData(data)\n&nbsp; &nbsp; sendByImg(this.dsn, traceData)\n&nbsp; }\n&nbsp;&nbsp;\n&nbsp; public saveError(event: ErrorEvent) {\n\t\t// ...çœç•¥éƒ¨åˆ†ä»£ç \n&nbsp; &nbsp; if (!isResTarget) {\n\t\t\t// ...çœç•¥éƒ¨åˆ†ä»£ç \n&nbsp; &nbsp; &nbsp; this.queue.push(this.setTraceData(traceData))\n&nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; // ...çœç•¥éƒ¨åˆ†ä»£ç \n&nbsp; &nbsp; &nbsp; this.queue.push(this.setTraceData(traceData))\n&nbsp; &nbsp; }\n&nbsp; }\n&nbsp;&nbsp;\n&nbsp; public onFetchError(message: OnFetchError) {\n&nbsp; &nbsp; // ...çœç•¥éƒ¨åˆ†ä»£ç \n&nbsp; &nbsp; this.queue.push(this.setTraceData(errorData))\n&nbsp; }\n&nbsp;&nbsp;\n&nbsp;&nbsp;\n}\n</code></pre><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®ç°äº†å»¶è¿Ÿä¸ŠæŠ¥çš„åŠŸèƒ½ï¼Œå‡ºç°å¤§é‡é”™è¯¯æ—¥å¿—çš„æ—¶å€™ï¼Œå°±ä¸ä¼šä¸€æ¬¡æ€§å‘èµ·å¤§é‡å›¾ç‰‡è¯·æ±‚äº†ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬é‡ç‚¹æ¢è®¨äº†å…¨é“¾è·¯åŸ‹ç‚¹ä¸­3ä¸ªé‡è¦çŸ¥è¯†ç‚¹ï¼Œå¦‚ä½•é€‰æ‹©ä¸ŠæŠ¥æ–¹å¼ï¼Œå®ç°ä¸ŠæŠ¥æ¥å£ä»¥åŠç¡®å®šä¸ŠæŠ¥æ—¶æœºã€‚</p><p>å…³äºå‰ç«¯åŸ‹ç‚¹çš„ä¸ŠæŠ¥ï¼Œæˆ‘ä»¬å¯¹æ¯”äº†ä¸‰ç§æ–¹æ¡ˆï¼ŒFetchå’Œxhrã€Beacon APIå’ŒGIFå›¾ç‰‡ã€‚Fetchå’Œxhrç”±äºå—åˆ°åŒæºç­–ç•¥å’Œå…¼å®¹æ€§é—®é¢˜çš„é™åˆ¶ï¼Œå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚å¦å¤–ï¼Œè™½ç„¶sendBeaconå¯ä»¥åœ¨æµè§ˆå™¨åå°å¼‚æ­¥å‘é€æ•°æ®ï¼Œä½†å¯èƒ½ä¼šå› æµè§ˆå™¨åœ¨å‘é€å‰å…³é—­é¡µé¢è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å¹¸å¥½GIFå›¾ç‰‡ä¸ŠæŠ¥æ–¹æ¡ˆç›¸å¯¹ç®€å•å¿«é€Ÿï¼Œè§£å†³äº†å…¼å®¹æ€§é—®é¢˜å’Œè·¨åŸŸé—®é¢˜ï¼Œå³ä½¿è¯·æ±‚å¤±è´¥ä¹Ÿä¸ä¼šå½±å“ç”¨æˆ·å’Œé¡µé¢çš„æ­£å¸¸äº¤äº’ä½“éªŒã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©ä½¿ç”¨GIFå›¾ç‰‡ä½œä¸ºåŸ‹ç‚¹ä¸ŠæŠ¥æ–¹å¼ã€‚</p><p>è‡³äºä¸ŠæŠ¥æ—¶æœºï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µï¼Œç»“åˆäº‹ä»¶ç±»å‹æ¥å†³å®šæ˜¯ç«‹å³ä¸ŠæŠ¥è¿˜æ˜¯å»¶è¿Ÿä¸ŠæŠ¥ã€‚</p><p>æˆ‘ä»¬è¿˜åˆ©ç”¨Node.jså’ŒExpressæ¡†æ¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ª1x1åƒç´ é€æ˜GIFå›¾ç‰‡çš„URLæ¥å£åœ°å€ï¼Œå¹¶ä»¥æ—¥å¿—æ–‡ä»¶å­˜å‚¨ä¸ºä¾‹å±•ç¤ºäº†é“¾è·¯æ—¥å¿—æ•°æ®çš„å­˜å‚¨æ–¹å¼ã€‚</p><p>éœ€è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼Œæ”¶é›†ç”¨æˆ·é“¾è·¯æ—¥å¿—å¿…ç„¶æ¶‰åŠä¸€äº›ç”¨æˆ·éšç§æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä¸ŠæŠ¥æ•°æ®å‰å°±è¿›è¡Œæ•æ„Ÿæ•°æ®çš„è„±æ•ã€‚å¦‚æœä¸è¿›è¡Œè„±æ•æ“ä½œï¼Œé‚£ä¸€äº›æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚tokenï¼‰å°±ä¼šè¢«äººåˆ©ç”¨ï¼Œç”šè‡³ç¯¡æ”¹æ•°æ®ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ç°åœ¨ç»™ä½ å¸ƒç½®ä¸¤é“æ€è€ƒé¢˜ã€‚</p><p>ç¬¬ä¸€é¢˜ï¼Œå¦‚æœå‰ç«¯åŸ‹ç‚¹çš„é“¾è·¯æ—¥å¿—ä¸­å­˜åœ¨æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ‰‹æœºå·ã€å¯†ç ã€tokenç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšæ‰èƒ½è„±æ•å‘¢ï¼Ÿè„±æ•çš„ç®—æ³•åˆæ˜¯æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>ç¬¬äºŒé¢˜ï¼Œè¯¾ç¨‹ä¸­æåˆ°äº†ç«‹å³ä¸ŠæŠ¥å’Œå»¶è¿Ÿä¸ŠæŠ¥ä¸¤ç§ä¸ŠæŠ¥æ–¹æ³•ã€‚é‚£å¦‚æœä½¿ç”¨æ‰¹é‡æ—¥å¿—ä¸ŠæŠ¥ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è¿™æ®µä»£ç é€»è¾‘ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµã€‚å¦‚æœè§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿå¯ä»¥æŠŠè¯¾ç¨‹åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","comments":[{"had_liked":false,"id":392581,"user_name":"è‹æœæœ","can_delete":false,"product_type":"c1","uid":2852467,"ip_address":"åŒ—äº¬","ucode":"12A62ED032F345","user_header":"https://static001.geekbang.org/account/avatar/00/2b/86/73/5190bbde.jpg","comment_is_top":true,"comment_ctime":1721270766,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"å®Œæ•´æºç å…¥å£ï¼š\nhttps:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course","like_count":0},{"had_liked":false,"id":392086,"user_name":"è°¢è°¢","can_delete":false,"product_type":"c1","uid":2901593,"ip_address":"åŒ—äº¬","ucode":"94470FD72641B3","user_header":"https://static001.geekbang.org/account/avatar/00/2c/46/59/c5fcd89a.jpg","comment_is_top":false,"comment_ctime":1719906893,"is_pvip":false,"replies":[{"id":142681,"content":"æ˜¯çš„ï¼Œåªè¦ç”¨æˆ·èƒ½ä¸»åŠ¨å…³é—­é¡µé¢ï¼Œå…¶ä»–ä¸¤ç§ä¸ŠæŠ¥æ–¹å¼ä¹Ÿä¼šé‡åˆ°æ•°æ®ä¸¢å¤±çš„ã€‚\nåªè¦ä¿è¯ç½‘ç»œé€šç•…ï¼Œå›¾ç‰‡ä¸ŠæŠ¥å’ŒBeaconä¸ŠæŠ¥éƒ½ä¸éœ€è¦ç­‰å¾…æ¥æ”¶è¿”å›ã€‚\næ¯”èµ·å›¾ç‰‡ä¸ŠæŠ¥ï¼ŒBeaconæœ‰ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯å…¼å®¹æ€§ä¸å¤ªå¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1327155,"ctime":1721351221,"ip_address":"å¹¿ä¸œ","comment_id":392086,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"ä½ å¥½ï¼Œè¯·é—®ä¸‹ï¼Œåœ¨æ€»ç»“é‡Œçœ‹åˆ° sendBeacon æ˜¯ä½†å¯èƒ½ä¼šå› æµè§ˆå™¨åœ¨å‘é€å‰å…³é—­é¡µé¢è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¿™ä¸æ˜¯  sendBeacon çš„ä¼˜åŠ¿å—ï¼Ÿè€Œä¸”å…¶ä»–ä¸¤ç§ä¸ŠæŠ¥æ–¹å¼æ˜¯å¦ä¹Ÿä¼šé‡åˆ°æµè§ˆå™¨å…³é—­æˆ–è€…é¡µé¢å¸è½½çš„æ—¶å€™ï¼Œæ•°æ®ä¸¢å¤±çš„æƒ…å†µå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1327155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/33/11e434ba.jpg","nickname":"ä¸‰æ©‹sankyu ğŸ©","note":"","ucode":"2129405EA8D3D7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648293,"discussion_content":"æ˜¯çš„ï¼Œåªè¦ç”¨æˆ·èƒ½ä¸»åŠ¨å…³é—­é¡µé¢ï¼Œå…¶ä»–ä¸¤ç§ä¸ŠæŠ¥æ–¹å¼ä¹Ÿä¼šé‡åˆ°æ•°æ®ä¸¢å¤±çš„ã€‚\nåªè¦ä¿è¯ç½‘ç»œé€šç•…ï¼Œå›¾ç‰‡ä¸ŠæŠ¥å’ŒBeaconä¸ŠæŠ¥éƒ½ä¸éœ€è¦ç­‰å¾…æ¥æ”¶è¿”å›ã€‚\næ¯”èµ·å›¾ç‰‡ä¸ŠæŠ¥ï¼ŒBeaconæœ‰ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯å…¼å®¹æ€§ä¸å¤ªå¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721351221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396045,"user_name":"å¤©å¤©","can_delete":false,"product_type":"c1","uid":2000254,"ip_address":"å››å·","ucode":"2B9414A72EB338","user_header":"https://static001.geekbang.org/account/avatar/00/1e/85/7e/dc5ee66c.jpg","comment_is_top":false,"comment_ctime":1732799437,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"æ˜¯å¯ä»¥å»¶è¿Ÿå‘é€æ—¥å¿—ï¼Œä¸ŠæŠ¥æ—¶æœºå’Œä¸ŠæŠ¥æ•°æ®è®²éœ€è¦è€ƒè™‘","like_count":1},{"had_liked":false,"id":390863,"user_name":"JuneRain","can_delete":false,"product_type":"c1","uid":3688751,"ip_address":"å¹¿ä¸œ","ucode":"2A92727BF9F6DE","user_header":"https://static001.geekbang.org/account/avatar/00/38/49/2f/590142fb.jpg","comment_is_top":false,"comment_ctime":1716513092,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"æœ‰ä¸ªé—®é¢˜ï¼Œå›¾ç‰‡æ–¹å¼ä¸Šç©¿æ—¥å¿—æ˜¯GETè¯·æ±‚ï¼Œå¦‚æœæ—¥å¿—æ•°æ®é‡å¤§ï¼Œå­—ç¬¦ä¸²åŒ–åæ‹¼æ¥çš„URLé•¿åº¦è¶…é™åˆ¶æ€ä¹ˆåŠï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1158637,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ad/ed/115f6d69.jpg","nickname":"è‡­æ£‹ç¯“å­","note":"","ucode":"5121296D78352B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645800,"discussion_content":"å®åœ¨å¤ªé•¿å¯ä»¥å‹ç¼©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1716805179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3688751,"avatar":"https://static001.geekbang.org/account/avatar/00/38/49/2f/590142fb.jpg","nickname":"JuneRain","note":"","ucode":"2A92727BF9F6DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1158637,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ad/ed/115f6d69.jpg","nickname":"è‡­æ£‹ç¯“å­","note":"","ucode":"5121296D78352B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646101,"discussion_content":"è¯·æ•™ä¸‹æ€ä¹ˆå…·ä½“è¿›è¡Œå‹ç¼©å‘¢ã€‚æ—¥å¿—å¯¹è±¡è½¬base64åå†è¿›è¡Œå‹ç¼©ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1717375487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":645800,"ip_address":"å¹¿ä¸œ","group_id":0},"score":646101,"extra":""}]}]},{"had_liked":false,"id":396157,"user_name":"å¤©å¤©","can_delete":false,"product_type":"c1","uid":2000254,"ip_address":"å››å·","ucode":"2B9414A72EB338","user_header":"https://static001.geekbang.org/account/avatar/00/1e/85/7e/dc5ee66c.jpg","comment_is_top":false,"comment_ctime":1733307424,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"ä¸€èˆ¬æ€ä¹ˆè„±æ•å‘¢ï¼Œè€å¸ˆçš„ç­”æ¡ˆå¯ä»¥ç»™ä¸€ä¸‹å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":395540,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1687571,"ip_address":"æ¹–åŒ—","ucode":"A316CBB3CAB97B","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/13/52cd5ea8.jpg","comment_is_top":false,"comment_ctime":1731148673,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"ä¸¤ä¸ªæ€è€ƒé¢˜çš„ç­”æ¡ˆæœ‰äº†å—ï¼Ÿæ€¥éœ€è§£æƒ‘","like_count":0},{"had_liked":false,"id":390925,"user_name":"Alexé…±","can_delete":false,"product_type":"c1","uid":1008941,"ip_address":"é‡åº†","ucode":"52FB12BF10843D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/2d/7394c6f5.jpg","comment_is_top":false,"comment_ctime":1716774379,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"å¦‚æœæ¥æ”¶ç«¯é…ç½®äº†kafkaçš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥ä¸ç”¨é˜Ÿåˆ—å­˜å‚¨çš„æ–¹å¼å‘¢ï¼Ÿ","like_count":0}]}