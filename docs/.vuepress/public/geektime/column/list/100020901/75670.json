{"id":75670,"title":"18 | æ¡ˆä¾‹ç¯‡ï¼šå†…å­˜æ³„æ¼äº†ï¼Œæˆ‘è¯¥å¦‚ä½•å®šä½å’Œå¤„ç†ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>é€šè¿‡å‰å‡ èŠ‚å¯¹å†…å­˜åŸºç¡€çš„å­¦ä¹ ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯¹ Linux å†…å­˜çš„å·¥ä½œåŸç†ï¼Œå·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚</p><p>å¯¹æ™®é€šè¿›ç¨‹æ¥è¯´ï¼Œèƒ½çœ‹åˆ°çš„å…¶å®æ˜¯å†…æ ¸æä¾›çš„è™šæ‹Ÿå†…å­˜ï¼Œè¿™äº›è™šæ‹Ÿå†…å­˜è¿˜éœ€è¦é€šè¿‡é¡µè¡¨ï¼Œç”±ç³»ç»Ÿæ˜ å°„ä¸ºç‰©ç†å†…å­˜ã€‚</p><p>å½“è¿›ç¨‹é€šè¿‡ malloc() ç”³è¯·è™šæ‹Ÿå†…å­˜åï¼Œç³»ç»Ÿå¹¶ä¸ä¼šç«‹å³ä¸ºå…¶åˆ†é…ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯åœ¨é¦–æ¬¡è®¿é—®æ—¶ï¼Œæ‰é€šè¿‡ç¼ºé¡µå¼‚å¸¸é™·å…¥å†…æ ¸ä¸­åˆ†é…å†…å­˜ã€‚</p><p>ä¸ºäº†åè°ƒ CPU ä¸ç£ç›˜é—´çš„æ€§èƒ½å·®å¼‚ï¼ŒLinux è¿˜ä¼šä½¿ç”¨ Cache å’Œ Buffer ï¼Œåˆ†åˆ«æŠŠæ–‡ä»¶å’Œç£ç›˜è¯»å†™çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚</p><p>å¯¹åº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒåŠ¨æ€å†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼Œæ˜¯æ—¢æ ¸å¿ƒåˆå¤æ‚çš„ä¸€ä¸ªé€»è¾‘åŠŸèƒ½æ¨¡å—ã€‚ç®¡ç†å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‘ç”Ÿå„ç§å„æ ·çš„â€œäº‹æ•…â€ï¼Œæ¯”å¦‚ï¼Œ</p><ul>\n<li>\n<p>æ²¡æ­£ç¡®å›æ”¶åˆ†é…åçš„å†…å­˜ï¼Œå¯¼è‡´äº†æ³„æ¼ã€‚</p>\n</li>\n<li>\n<p>è®¿é—®çš„æ˜¯å·²åˆ†é…å†…å­˜è¾¹ç•Œå¤–çš„åœ°å€ï¼Œå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œç­‰ç­‰ã€‚</p>\n</li>\n</ul><p>ä»Šå¤©æˆ‘å°±å¸¦ä½ æ¥çœ‹çœ‹ï¼Œå†…å­˜æ³„æ¼åˆ°åº•æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Œä»¥åŠå‘ç”Ÿå†…å­˜æ³„æ¼ä¹‹åè¯¥å¦‚ä½•æ’æŸ¥å’Œå®šä½ã€‚</p><p>è¯´èµ·å†…å­˜æ³„æ¼ï¼Œè¿™å°±è¦å…ˆä»å†…å­˜çš„åˆ†é…å’Œå›æ”¶è¯´èµ·äº†ã€‚</p><h2>å†…å­˜çš„åˆ†é…å’Œå›æ”¶</h2><p>å…ˆå›é¡¾ä¸€ä¸‹ï¼Œä½ è¿˜è®°å¾—åº”ç”¨ç¨‹åºä¸­ï¼Œéƒ½æœ‰å“ªäº›æ–¹æ³•æ¥åˆ†é…å†…å­˜å—ï¼Ÿç”¨å®Œåï¼Œåˆè¯¥æ€ä¹ˆé‡Šæ”¾è¿˜ç»™ç³»ç»Ÿå‘¢ï¼Ÿ</p><p>å‰é¢è®²è¿›ç¨‹çš„å†…å­˜ç©ºé—´æ—¶ï¼Œæˆ‘æ›¾ç»æåˆ°è¿‡ï¼Œç”¨æˆ·ç©ºé—´å†…å­˜åŒ…æ‹¬å¤šä¸ªä¸åŒçš„å†…å­˜æ®µï¼Œæ¯”å¦‚åªè¯»æ®µã€æ•°æ®æ®µã€å †ã€æ ˆä»¥åŠæ–‡ä»¶æ˜ å°„æ®µç­‰ã€‚è¿™äº›å†…å­˜æ®µæ­£æ˜¯åº”ç”¨ç¨‹åºä½¿ç”¨å†…å­˜çš„åŸºæœ¬æ–¹å¼ã€‚</p><!-- [[[read_end]]] --><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ åœ¨ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•´æ•°æ•°ç»„ <em>int data[64]</em>  ï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥å­˜å‚¨ 64 ä¸ªæ•´æ•°çš„å†…å­˜æ®µã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå®ƒä¼šä»å†…å­˜ç©ºé—´çš„æ ˆä¸­åˆ†é…å†…å­˜ã€‚</p><p>æ ˆå†…å­˜ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œç®¡ç†ã€‚ä¸€æ—¦ç¨‹åºè¿è¡Œè¶…å‡ºäº†è¿™ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸï¼Œæ ˆå†…å­˜å°±ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å›æ”¶ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p><p>å†æ¯”å¦‚ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬äº‹å…ˆå¹¶ä¸çŸ¥é“æ•°æ®å¤§å°ï¼Œæ‰€ä»¥ä½ å°±è¦ç”¨åˆ°æ ‡å‡†åº“å‡½æ•° <em>malloc()</em> _ï¼Œ_åœ¨ç¨‹åºä¸­åŠ¨æ€åˆ†é…å†…å­˜ã€‚è¿™æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šä»å†…å­˜ç©ºé—´çš„å †ä¸­åˆ†é…å†…å­˜ã€‚</p><p>å †å†…å­˜ç”±åº”ç”¨ç¨‹åºè‡ªå·±æ¥åˆ†é…å’Œç®¡ç†ã€‚é™¤éç¨‹åºé€€å‡ºï¼Œè¿™äº›å †å†…å­˜å¹¶ä¸ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œæ˜¯éœ€è¦åº”ç”¨ç¨‹åºæ˜ç¡®è°ƒç”¨åº“å‡½æ•° <em>free()</em> æ¥é‡Šæ”¾å®ƒä»¬ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾å †å†…å­˜ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>è¿™æ˜¯ä¸¤ä¸ªæ ˆå’Œå †çš„ä¾‹å­ï¼Œé‚£ä¹ˆï¼Œå…¶ä»–å†…å­˜æ®µæ˜¯å¦ä¹Ÿä¼šå¯¼è‡´å†…å­˜æ³„æ¼å‘¢ï¼Ÿç»è¿‡æˆ‘ä»¬å‰é¢çš„å­¦ä¹ ï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾å›ç­”ã€‚</p><ul>\n<li>\n<p>åªè¯»æ®µï¼ŒåŒ…æ‹¬ç¨‹åºçš„ä»£ç å’Œå¸¸é‡ï¼Œç”±äºæ˜¯åªè¯»çš„ï¼Œä¸ä¼šå†å»åˆ†é…æ–°çš„å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>\n</li>\n<li>\n<p>æ•°æ®æ®µï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†å¤§å°ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>\n</li>\n<li>\n<p>æœ€åä¸€ä¸ªå†…å­˜æ˜ å°„æ®µï¼ŒåŒ…æ‹¬åŠ¨æ€é“¾æ¥åº“å’Œå…±äº«å†…å­˜ï¼Œå…¶ä¸­å…±äº«å†…å­˜ç”±ç¨‹åºåŠ¨æ€åˆ†é…å’Œç®¡ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœç¨‹åºåœ¨åˆ†é…åå¿˜äº†å›æ”¶ï¼Œå°±ä¼šå¯¼è‡´è·Ÿå †å†…å­˜ç±»ä¼¼çš„æ³„æ¼é—®é¢˜ã€‚</p>\n</li>\n</ul><p><strong>å†…å­˜æ³„æ¼çš„å±å®³éå¸¸å¤§ï¼Œè¿™äº›å¿˜è®°é‡Šæ”¾çš„å†…å­˜ï¼Œä¸ä»…åº”ç”¨ç¨‹åºè‡ªå·±ä¸èƒ½è®¿é—®ï¼Œç³»ç»Ÿä¹Ÿä¸èƒ½æŠŠå®ƒä»¬å†æ¬¡åˆ†é…ç»™å…¶ä»–åº”ç”¨</strong>ã€‚å†…å­˜æ³„æ¼ä¸æ–­ç´¯ç§¯ï¼Œç”šè‡³ä¼šè€—å°½ç³»ç»Ÿå†…å­˜ã€‚</p><p>è™½ç„¶ï¼Œç³»ç»Ÿæœ€ç»ˆå¯ä»¥é€šè¿‡ OOM ï¼ˆOut of Memoryï¼‰æœºåˆ¶æ€æ­»è¿›ç¨‹ï¼Œä½†è¿›ç¨‹åœ¨ OOM å‰ï¼Œå¯èƒ½å·²ç»å¼•å‘äº†ä¸€è¿ä¸²çš„ååº”ï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼Œå…¶ä»–éœ€è¦å†…å­˜çš„è¿›ç¨‹ï¼Œå¯èƒ½æ— æ³•åˆ†é…æ–°çš„å†…å­˜ï¼›å†…å­˜ä¸è¶³ï¼Œåˆä¼šè§¦å‘ç³»ç»Ÿçš„ç¼“å­˜å›æ”¶ä»¥åŠ SWAP æœºåˆ¶ï¼Œä»è€Œè¿›ä¸€æ­¥å¯¼è‡´ I/O çš„æ€§èƒ½é—®é¢˜ç­‰ç­‰ã€‚</p><p>å†…å­˜æ³„æ¼çš„å±å®³è¿™ä¹ˆå¤§ï¼Œé‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆæ£€æµ‹è¿™ç§é—®é¢˜å‘¢ï¼Ÿç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ å·²ç»å‘ç°äº†å†…å­˜æ³„æ¼ï¼Œè¯¥å¦‚ä½•å®šä½å’Œå¤„ç†å‘¢ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç”¨ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ¡ˆä¾‹ï¼Œæ¥çœ‹çœ‹å†…å­˜æ³„æ¼é—®é¢˜çš„å®šä½å’Œå¤„ç†æ–¹æ³•ã€‚</p><p>æ–æ³¢é‚£å¥‘æ•°åˆ—æ˜¯ä¸€ä¸ªè¿™æ ·çš„æ•°åˆ—ï¼š0ã€1ã€1ã€2ã€3ã€5ã€8â€¦ï¼Œä¹Ÿå°±æ˜¯é™¤äº†å‰ä¸¤ä¸ªæ•°æ˜¯0å’Œ1ï¼Œå…¶ä»–æ•°éƒ½ç”±å‰é¢ä¸¤æ•°ç›¸åŠ å¾—åˆ°ï¼Œç”¨æ•°å­¦å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯ F(n)=F(n-1)+F(n-2)ï¼Œï¼ˆn&gt;=2ï¼‰ï¼ŒF(0)=0, F(1)=1ã€‚</p><h2>æ¡ˆä¾‹</h2><p>ä»Šå¤©çš„æ¡ˆä¾‹åŸºäº Ubuntu 18.04ï¼Œå½“ç„¶ï¼ŒåŒæ ·é€‚ç”¨å…¶ä»–çš„ Linux ç³»ç»Ÿã€‚</p><ul>\n<li>\n<p>æœºå™¨é…ç½®ï¼š2 CPUï¼Œ8GB å†…å­˜</p>\n</li>\n<li>\n<p>é¢„å…ˆå®‰è£… sysstatã€Docker ä»¥åŠ bcc è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚ï¼š</p>\n</li>\n</ul><pre><code># install sysstat docker\nsudo apt-get install -y sysstat docker.io\n\n# Install bcc\nsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4052245BD4284CDD\necho &quot;deb https://repo.iovisor.org/apt/bionic bionic main&quot; | sudo tee /etc/apt/sources.list.d/iovisor.list\nsudo apt-get update\nsudo apt-get install -y bcc-tools libbcc-examples linux-headers-$(uname -r)\n</code></pre><p>å…¶ä¸­ï¼Œsysstat å’Œ Docker æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚sysstat è½¯ä»¶åŒ…ä¸­çš„ vmstat ï¼Œå¯ä»¥è§‚å¯Ÿå†…å­˜çš„å˜åŒ–æƒ…å†µï¼›è€Œ Docker å¯ä»¥è¿è¡Œæ¡ˆä¾‹ç¨‹åºã€‚</p><p><a href=\"https://github.com/iovisor/bcc\">bcc</a> è½¯ä»¶åŒ…å‰é¢ä¹Ÿä»‹ç»è¿‡ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„ Linux æ€§èƒ½åˆ†æå·¥å…·ï¼Œå¸¸ç”¨æ¥åŠ¨æ€è¿½è¸ªè¿›ç¨‹å’Œå†…æ ¸çš„è¡Œä¸ºã€‚æ›´å¤šå·¥ä½œåŸç†ä½ å…ˆä¸ç”¨æ·±ç©¶ï¼Œåé¢å­¦ä¹ æˆ‘ä»¬ä¼šé€æ­¥æ¥è§¦ã€‚è¿™é‡Œä½ åªéœ€è¦è®°ä½ï¼ŒæŒ‰ç…§ä¸Šé¢æ­¥éª¤å®‰è£…å®Œåï¼Œå®ƒæä¾›çš„æ‰€æœ‰å·¥å…·éƒ½ä½äº /usr/share/bcc/tools è¿™ä¸ªç›®å½•ä¸­ã€‚</p><blockquote>\n<p>æ³¨æ„ï¼šbcc-toolséœ€è¦å†…æ ¸ç‰ˆæœ¬ä¸º4.1æˆ–è€…æ›´é«˜ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯CentOS7ï¼Œæˆ–è€…å…¶ä»–å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒæ—§çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰‹åŠ¨<a href=\"https://github.com/iovisor/bcc/issues/462\">å‡çº§å†…æ ¸ç‰ˆæœ¬åå†å®‰è£…</a>ã€‚</p>\n</blockquote><p>æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼ŒSSH ç™»å½•åˆ°æœºå™¨ä¸Šï¼Œå®‰è£…ä¸Šè¿°å·¥å…·ã€‚</p><p>åŒä»¥å‰çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œä¸‹é¢çš„æ‰€æœ‰å‘½ä»¤éƒ½é»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œå¦‚æœä½ æ˜¯ç”¨æ™®é€šç”¨æˆ·èº«ä»½ç™»é™†ç³»ç»Ÿï¼Œè¯·è¿è¡Œ sudo su root å‘½ä»¤åˆ‡æ¢åˆ° root ç”¨æˆ·ã€‚</p><p>å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒåŒæ ·é¼“åŠ±ä½ å…ˆè‡ªå·±æœç´¢è§£å†³ï¼Œè§£å†³ä¸äº†çš„ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºå‘æˆ‘æé—®ã€‚å¦‚æœä½ ä»¥å‰å·²ç»å®‰è£…è¿‡äº†ï¼Œå°±å¯ä»¥å¿½ç•¥è¿™ä¸€ç‚¹äº†ã€‚</p><p>å®‰è£…å®Œæˆåï¼Œå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œæ¡ˆä¾‹ï¼š</p><pre><code>$ docker run --name=app -itd feisky/app:mem-leak\n</code></pre><p>æ¡ˆä¾‹æˆåŠŸè¿è¡Œåï¼Œä½ éœ€è¦è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œç¡®è®¤æ¡ˆä¾‹åº”ç”¨å·²ç»æ­£å¸¸å¯åŠ¨ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š</p><pre><code>$ docker logs app\n2th =&gt; 1\n3th =&gt; 2\n4th =&gt; 3\n5th =&gt; 5\n6th =&gt; 8\n7th =&gt; 13\n</code></pre><p>ä»è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ¡ˆä¾‹ä¼šè¾“å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¸€ç³»åˆ—æ•°å€¼ã€‚å®é™…ä¸Šï¼Œè¿™äº›æ•°å€¼æ¯éš” 1 ç§’è¾“å‡ºä¸€æ¬¡ã€‚</p><p>çŸ¥é“äº†è¿™äº›ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆæ£€æŸ¥å†…å­˜æƒ…å†µï¼Œåˆ¤æ–­æœ‰æ²¡æœ‰æ³„æ¼å‘ç”Ÿå‘¢ï¼Ÿä½ é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯ top å·¥å…·ï¼Œä¸è¿‡ï¼Œtop è™½ç„¶èƒ½è§‚å¯Ÿç³»ç»Ÿå’Œè¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µï¼Œä½†ä»Šå¤©çš„æ¡ˆä¾‹å¹¶ä¸é€‚åˆã€‚å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæˆ‘ä»¬æ›´åº”è¯¥å…³æ³¨å†…å­˜ä½¿ç”¨çš„å˜åŒ–è¶‹åŠ¿ã€‚</p><p>æ‰€ä»¥ï¼Œå¼€å¤´æˆ‘ä¹Ÿæåˆ°äº†ï¼Œä»Šå¤©æ¨èçš„æ˜¯å¦ä¸€ä¸ªè€ç†Ÿäººï¼Œ vmstat å·¥å…·ã€‚</p><p>è¿è¡Œä¸‹é¢çš„ vmstat ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè§‚å¯Ÿå†…å­˜çš„å˜åŒ–æƒ…å†µã€‚å¦‚æœå¿˜äº† vmstat é‡Œå„æŒ‡æ ‡çš„å«ä¹‰ï¼Œè®°å¾—å¤ä¹ å‰é¢å†…å®¹ï¼Œæˆ–è€…æ‰§è¡Œ man vmstat æŸ¥è¯¢ã€‚</p><pre><code># æ¯éš”3ç§’è¾“å‡ºä¸€ç»„æ•°æ®\n$ vmstat 3\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\nr  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n0  0      0 6601824  97620 1098784    0    0     0     0   62  322  0  0 100  0  0\n0  0      0 6601700  97620 1098788    0    0     0     0   57  251  0  0 100  0  0\n0  0      0 6601320  97620 1098788    0    0     0     3   52  306  0  0 100  0  0\n0  0      0 6601452  97628 1098788    0    0     0    27   63  326  0  0 100  0  0\n2  0      0 6601328  97628 1098788    0    0     0    44   52  299  0  0 100  0  0\n0  0      0 6601080  97628 1098792    0    0     0     0   56  285  0  0 100  0  0 \n</code></pre><p>ä»è¾“å‡ºä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜çš„ free åˆ—åœ¨ä¸åœçš„å˜åŒ–ï¼Œå¹¶ä¸”æ˜¯ä¸‹é™è¶‹åŠ¿ï¼›è€Œ buffer å’Œ cache åŸºæœ¬ä¿æŒä¸å˜ã€‚</p><p>æœªä½¿ç”¨å†…å­˜åœ¨é€æ¸å‡å°ï¼Œè€Œ buffer å’Œ cache åŸºæœ¬ä¸å˜ï¼Œè¿™è¯´æ˜ï¼Œç³»ç»Ÿä¸­ä½¿ç”¨çš„å†…å­˜ä¸€ç›´åœ¨å‡é«˜ã€‚ä½†è¿™å¹¶ä¸èƒ½è¯´æ˜æœ‰å†…å­˜æ³„æ¼ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºè¿è¡Œä¸­éœ€è¦çš„å†…å­˜ä¹Ÿå¯èƒ½ä¼šå¢å¤§ã€‚æ¯”å¦‚è¯´ï¼Œç¨‹åºä¸­å¦‚æœç”¨äº†ä¸€ä¸ªåŠ¨æ€å¢é•¿çš„æ•°ç»„æ¥ç¼“å­˜è®¡ç®—ç»“æœï¼Œå ç”¨å†…å­˜è‡ªç„¶ä¼šå¢é•¿ã€‚</p><p>é‚£æ€ä¹ˆç¡®å®šæ˜¯ä¸æ˜¯å†…å­˜æ³„æ¼å‘¢ï¼Ÿæˆ–è€…æ¢å¥è¯è¯´ï¼Œæœ‰æ²¡æœ‰ç®€å•æ–¹æ³•æ‰¾å‡ºè®©å†…å­˜å¢é•¿çš„è¿›ç¨‹ï¼Œå¹¶å®šä½å¢é•¿å†…å­˜ç”¨åœ¨å“ªå„¿å‘¢ï¼Ÿ</p><p>æ ¹æ®å‰é¢å†…å®¹ï¼Œä½ åº”è¯¥æƒ³åˆ°äº†ç”¨ top æˆ–ps æ¥è§‚å¯Ÿè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç„¶åæ‰¾å‡ºå†…å­˜ä½¿ç”¨ä¸€ç›´å¢é•¿çš„è¿›ç¨‹ï¼Œæœ€åå†é€šè¿‡ pmap æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒã€‚</p><p>ä½†è¿™ç§æ–¹æ³•å¹¶ä¸å¤ªå¥½ç”¨ï¼Œå› ä¸ºè¦åˆ¤æ–­å†…å­˜çš„å˜åŒ–æƒ…å†µï¼Œè¿˜éœ€è¦ä½ å†™ä¸€ä¸ªè„šæœ¬ï¼Œæ¥å¤„ç† top æˆ–è€… ps çš„è¾“å‡ºã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»‹ç»ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ£€æµ‹å†…å­˜æ³„æ¼çš„å·¥å…·ï¼Œmemleakã€‚memleak å¯ä»¥è·Ÿè¸ªç³»ç»Ÿæˆ–æŒ‡å®šè¿›ç¨‹çš„å†…å­˜åˆ†é…ã€é‡Šæ”¾è¯·æ±‚ï¼Œç„¶åå®šæœŸè¾“å‡ºä¸€ä¸ªæœªé‡Šæ”¾å†…å­˜å’Œç›¸åº”è°ƒç”¨æ ˆçš„æ±‡æ€»æƒ…å†µï¼ˆé»˜è®¤5 ç§’ï¼‰ã€‚</p><p>å½“ç„¶ï¼Œmemleak æ˜¯ bcc è½¯ä»¶åŒ…ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬ä¸€å¼€å§‹å°±è£…å¥½äº†ï¼Œæ‰§è¡Œ <em>/usr/share/bcc/tools/memleak</em> å°±å¯ä»¥è¿è¡Œå®ƒã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code># -a è¡¨ç¤ºæ˜¾ç¤ºæ¯ä¸ªå†…å­˜åˆ†é…è¯·æ±‚çš„å¤§å°ä»¥åŠåœ°å€\n# -p æŒ‡å®šæ¡ˆä¾‹åº”ç”¨çš„PIDå·\n$ /usr/share/bcc/tools/memleak -a -p $(pidof app)\nWARNING: Couldn't find .text section in /app\nWARNING: BCC can't handle sym look ups for /app\n    addr = 7f8f704732b0 size = 8192\n    addr = 7f8f704772d0 size = 8192\n    addr = 7f8f704712a0 size = 8192\n    addr = 7f8f704752c0 size = 8192\n    32768 bytes in 4 allocations from stack\n        [unknown] [app]\n        [unknown] [app]\n        start_thread+0xdb [libpthread-2.27.so] \n</code></pre><p>ä» memleak çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œæ¡ˆä¾‹åº”ç”¨åœ¨ä¸åœåœ°åˆ†é…å†…å­˜ï¼Œå¹¶ä¸”è¿™äº›åˆ†é…çš„åœ°å€æ²¡æœ‰è¢«å›æ”¶ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒCouldnâ€™t find .text section in /appï¼Œæ‰€ä»¥è°ƒç”¨æ ˆä¸èƒ½æ­£å¸¸è¾“å‡ºï¼Œæœ€åçš„è°ƒç”¨æ ˆéƒ¨åˆ†åªèƒ½çœ‹åˆ° [unknown] çš„æ ‡å¿—ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé”™è¯¯å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™æ˜¯ç”±äºæ¡ˆä¾‹åº”ç”¨è¿è¡Œåœ¨å®¹å™¨ä¸­å¯¼è‡´çš„ã€‚memleak å·¥å…·è¿è¡Œåœ¨å®¹å™¨ä¹‹å¤–ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®¿é—®è¿›ç¨‹è·¯å¾„ /appã€‚</p><p>æ¯”æ–¹è¯´ï¼Œåœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œ ls å‘½ä»¤ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªè·¯å¾„çš„ç¡®ä¸å­˜åœ¨ï¼š</p><pre><code>$ ls /app\nls: cannot access '/app': No such file or directory\n</code></pre><p>ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘åœ¨ CPU æ¨¡å—ä¸­çš„ <a href=\"https://time.geekbang.org/column/article/73738\">perf ä½¿ç”¨æ–¹æ³•</a>ä¸­å·²ç»æåˆ°å¥½å‡ ä¸ªè§£å†³æ€è·¯ã€‚æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨å®¹å™¨å¤–éƒ¨æ„å»ºç›¸åŒè·¯å¾„çš„æ–‡ä»¶ä»¥åŠä¾èµ–åº“ã€‚è¿™ä¸ªæ¡ˆä¾‹åªæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥åªè¦æŠŠæ¡ˆä¾‹åº”ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åˆ° /app è·¯å¾„ä¸­ï¼Œå°±å¯ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼Œä½ å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠ app äºŒè¿›åˆ¶æ–‡ä»¶ä»å®¹å™¨ä¸­å¤åˆ¶å‡ºæ¥ï¼Œç„¶åé‡æ–°è¿è¡Œ memleak å·¥å…·ï¼š</p><pre><code>$ docker cp app:/app /app\n$ /usr/share/bcc/tools/memleak -p $(pidof app) -a\nAttaching to pid 12512, Ctrl+C to quit.\n[03:00:41] Top 10 stacks with outstanding allocations:\n    addr = 7f8f70863220 size = 8192\n    addr = 7f8f70861210 size = 8192\n    addr = 7f8f7085b1e0 size = 8192\n    addr = 7f8f7085f200 size = 8192\n    addr = 7f8f7085d1f0 size = 8192\n    40960 bytes in 5 allocations from stack\n        fibonacci+0x1f [app]\n        child+0x4f [app]\n        start_thread+0xdb [libpthread-2.27.so] \n</code></pre><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç»ˆäºçœ‹åˆ°äº†å†…å­˜åˆ†é…çš„è°ƒç”¨æ ˆï¼ŒåŸæ¥æ˜¯ fibonacci() å‡½æ•°åˆ†é…çš„å†…å­˜æ²¡é‡Šæ”¾ã€‚</p><p>å®šä½äº†å†…å­˜æ³„æ¼çš„æ¥æºï¼Œä¸‹ä¸€æ­¥è‡ªç„¶å°±åº”è¯¥æŸ¥çœ‹æºç ï¼Œæƒ³åŠæ³•ä¿®å¤å®ƒã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹æ¡ˆä¾‹åº”ç”¨çš„æºä»£ç  <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/mem-leak/app.c\">app.c</a>ï¼š</p><pre><code>$ docker exec app cat /app.c\n...\nlong long *fibonacci(long long *n0, long long *n1)\n{\n    //åˆ†é…1024ä¸ªé•¿æ•´æ•°ç©ºé—´æ–¹ä¾¿è§‚æµ‹å†…å­˜çš„å˜åŒ–æƒ…å†µ\n    long long *v = (long long *) calloc(1024, sizeof(long long));\n    *v = *n0 + *n1;\n    return v;\n}\n\n\nvoid *child(void *arg)\n{\n    long long n0 = 0;\n    long long n1 = 1;\n    long long *v = NULL;\n    for (int n = 2; n &gt; 0; n++) {\n        v = fibonacci(&amp;n0, &amp;n1);\n        n0 = n1;\n        n1 = *v;\n        printf(&quot;%dth =&gt; %lld\\n&quot;, n, *v);\n        sleep(1);\n    }\n}\n... \n</code></pre><p>ä½ ä¼šå‘ç°ï¼Œ child() è°ƒç”¨äº† fibonacci() å‡½æ•°ï¼Œä½†å¹¶æ²¡æœ‰é‡Šæ”¾ fibonacci() è¿”å›çš„å†…å­˜ã€‚æ‰€ä»¥ï¼Œæƒ³è¦ä¿®å¤æ³„æ¼é—®é¢˜ï¼Œåœ¨ child() ä¸­åŠ ä¸€ä¸ªé‡Šæ”¾å‡½æ•°å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ï¼š</p><pre><code>void *child(void *arg)\n{\n    ...\n    for (int n = 2; n &gt; 0; n++) {\n        v = fibonacci(&amp;n0, &amp;n1);\n        n0 = n1;\n        n1 = *v;\n        printf(&quot;%dth =&gt; %lld\\n&quot;, n, *v);\n        free(v);    // é‡Šæ”¾å†…å­˜\n        sleep(1);\n    }\n} \n</code></pre><p>æˆ‘æŠŠä¿®å¤åçš„ä»£ç æ”¾åˆ°äº† <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/mem-leak/app-fix.c\">app-fix.c</a>ï¼Œä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ª Docker é•œåƒã€‚ä½ å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯ä¸€ä¸‹å†…å­˜æ³„æ¼æ˜¯å¦ä¿®å¤ï¼š</p><pre><code># æ¸…ç†åŸæ¥çš„æ¡ˆä¾‹åº”ç”¨\n$ docker rm -f app\n\n# è¿è¡Œä¿®å¤åçš„åº”ç”¨\n$ docker run --name=app -itd feisky/app:mem-leak-fix\n\n# é‡æ–°æ‰§è¡Œ memleakå·¥å…·æ£€æŸ¥å†…å­˜æ³„æ¼æƒ…å†µ\n$ /usr/share/bcc/tools/memleak -a -p $(pidof app)\nAttaching to pid 18808, Ctrl+C to quit.\n[10:23:18] Top 10 stacks with outstanding allocations:\n[10:23:23] Top 10 stacks with outstanding allocations:\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œæ¡ˆä¾‹åº”ç”¨å·²ç»æ²¡æœ‰é—ç•™å†…å­˜ï¼Œè¯æ˜æˆ‘ä»¬çš„ä¿®å¤å·¥ä½œæˆåŠŸå®Œæˆã€‚</p><h2>å°ç»“</h2><p>æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚</p><p>åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„ç”¨æˆ·å†…å­˜ç©ºé—´ï¼Œç”±åªè¯»æ®µã€æ•°æ®æ®µã€å †ã€æ ˆä»¥åŠæ–‡ä»¶æ˜ å°„æ®µç­‰ç»„æˆã€‚å…¶ä¸­ï¼Œå †å†…å­˜å’Œæ–‡ä»¶æ˜ å°„æ®µï¼Œéœ€è¦åº”ç”¨ç¨‹åºæ¥åŠ¨æ€ç®¡ç†å†…å­˜æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°å¿ƒå¤„ç†ã€‚ä¸ä»…è¦ä¼šç”¨æ ‡å‡†åº“å‡½æ•° <em>malloc()</em>  æ¥åŠ¨æ€åˆ†é…å†…å­˜ï¼Œè¿˜è¦è®°å¾—åœ¨ç”¨å®Œå†…å­˜åï¼Œè°ƒç”¨åº“å‡½æ•° <em>free()</em> æ¥é‡Šæ”¾å®ƒä»¬ã€‚</p><p>ä»Šå¤©çš„æ¡ˆä¾‹æ¯”è¾ƒç®€å•ï¼Œåªç”¨åŠ ä¸€ä¸ª <em>free()</em> è°ƒç”¨å°±èƒ½ä¿®å¤å†…å­˜æ³„æ¼ã€‚ä¸è¿‡ï¼Œå®é™…åº”ç”¨ç¨‹åºå°±å¤æ‚å¤šäº†ã€‚æ¯”å¦‚è¯´ï¼Œ</p><ul>\n<li>\n<p>malloc() å’Œ free() é€šå¸¸å¹¶ä¸æ˜¯æˆå¯¹å‡ºç°ï¼Œè€Œæ˜¯éœ€è¦ä½ ï¼Œåœ¨æ¯ä¸ªå¼‚å¸¸å¤„ç†è·¯å¾„å’ŒæˆåŠŸè·¯å¾„ä¸Šéƒ½é‡Šæ”¾å†…å­˜ ã€‚</p>\n</li>\n<li>\n<p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­åˆ†é…çš„å†…å­˜ï¼Œå¯èƒ½ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è®¿é—®å’Œé‡Šæ”¾ã€‚</p>\n</li>\n<li>\n<p>æ›´å¤æ‚çš„æ˜¯ï¼Œåœ¨ç¬¬ä¸‰æ–¹çš„åº“å‡½æ•°ä¸­ï¼Œéšå¼åˆ†é…çš„å†…å­˜å¯èƒ½éœ€è¦åº”ç”¨ç¨‹åºæ˜¾å¼é‡Šæ”¾ã€‚</p>\n</li>\n</ul><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å…»æˆè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œæ¯”å¦‚åˆ†é…å†…å­˜åï¼Œä¸€å®šè¦å…ˆå†™å¥½å†…å­˜é‡Šæ”¾çš„ä»£ç ï¼Œå†å»å¼€å‘å…¶ä»–é€»è¾‘ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼Œæœ‰å€Ÿæœ‰è¿˜ï¼Œæ‰èƒ½é«˜æ•ˆè¿è½¬ï¼Œå†å€Ÿä¸éš¾ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœå·²ç»å®Œæˆäº†å¼€å‘ä»»åŠ¡ï¼Œä½ è¿˜å¯ä»¥ç”¨ memleak å·¥å…·ï¼Œæ£€æŸ¥åº”ç”¨ç¨‹åºçš„è¿è¡Œä¸­ï¼Œå†…å­˜æ˜¯å¦æ³„æ¼ã€‚å¦‚æœå‘ç°äº†å†…å­˜æ³„æ¼æƒ…å†µï¼Œå†æ ¹æ® memleak è¾“å‡ºçš„åº”ç”¨ç¨‹åºè°ƒç”¨æ ˆï¼Œå®šä½å†…å­˜çš„åˆ†é…ä½ç½®ï¼Œä»è€Œé‡Šæ”¾ä¸å†è®¿é—®çš„å†…å­˜ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ã€‚</p><p>ä»Šå¤©çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ  <em>free()</em> è°ƒç”¨ï¼Œé‡Šæ”¾å‡½æ•° <em>fibonacci()</em> åˆ†é…çš„å†…å­˜ï¼Œä¿®å¤äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å°±è¿™ä¸ªæ¡ˆä¾‹è€Œè¨€ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–æ›´å¥½çš„ä¿®å¤æ–¹æ³•å‘¢ï¼Ÿç»“åˆå‰é¢å­¦ä¹ å’Œä½ è‡ªå·±çš„å·¥ä½œç»éªŒï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½æœ‰æ›´å¤šæ›´å¥½çš„æ–¹æ¡ˆã€‚</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘è®¨è®º ï¼Œå†™ä¸‹ä½ çš„ç­”æ¡ˆå’Œæ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p>","neighbors":{"left":{"article_title":"17 | æ¡ˆä¾‹ç¯‡ï¼šå¦‚ä½•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ä¼˜åŒ–ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Ÿ","id":75242},"right":{"article_title":"19 | æ¡ˆä¾‹ç¯‡ï¼šä¸ºä»€ä¹ˆç³»ç»Ÿçš„Swapå˜é«˜äº†ï¼ˆä¸Šï¼‰","id":75797}},"comments":[{"had_liked":false,"id":55911,"user_name":"Scott","can_delete":false,"product_type":"c1","uid":1014800,"ip_address":"","ucode":"7E57FDCB5E5D49","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg","comment_is_top":false,"comment_ctime":1546345946,"is_pvip":false,"replies":[{"id":"20276","content":"å¦ä¸€ä¸ªç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯valgrind","user_name":"ä½œè€…å›å¤","comment_id":55911,"uid":"1001282","ip_address":"","utype":1,"ctime":1546424629,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"242064514522","product_id":100020901,"comment_content":"æˆ‘æ¯”è¾ƒå…³å¿ƒè€ç‰ˆæœ¬çš„Linuxæ€ä¹ˆåšåŒæ ·çš„äº‹ï¼Œæ¯•ç«Ÿæ²¡æœ‰åŠæ³•å‡çº§å…¬å¸æœåŠ¡å™¨çš„å†…æ ¸ã€‚","like_count":56,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434879,"discussion_content":"å¦ä¸€ä¸ªç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯valgrind","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546424629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1602650,"avatar":"","nickname":"Geek_e2b0f9","note":"","ucode":"CAB31078DDB515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588290,"discussion_content":"java è°ƒç”¨nativeæ–¹æ³•(.soæ–‡ä»¶) å‡ºç°çš„oom æ€ä¹ˆæ’æŸ¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663653764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2251657,"avatar":"https://static001.geekbang.org/account/avatar/00/22/5b/89/8e0924c4.jpg","nickname":"init 3","note":"","ucode":"681FA943D99672","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348842,"discussion_content":"https://github.com/iovisor/bcc/issues/462\nè€å¸ˆè´´çš„è¿™ä¸ªé“¾æ¥åº•éƒ¨æœ‰é’ˆå¯¹centos6çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612751136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235877,"user_name":"ç¡åœ¨åºŠæ¿ä¸‹","can_delete":false,"product_type":"c1","uid":1267832,"ip_address":"","ucode":"69BF52FF9C8A0C","user_header":"https://static001.geekbang.org/account/avatar/00/13/58/78/fe19274b.jpg","comment_is_top":false,"comment_ctime":1595233076,"is_pvip":false,"replies":[{"id":"87253","content":"è°¢è°¢åˆ†äº«ï¼çš„ç¡®ï¼Œå®Œå–„çš„ç›‘æ§å’Œæ—¥å¿—å¯ä»¥æ›´å¿«æ’æŸ¥å’Œå®šä½é—®é¢˜ï¼Œæˆ‘ä»¬ä¸“æ åé¢ä¹Ÿæœ‰æ–‡ç« æåˆ°ç›‘æ§çš„ä¸€äº›æ€è·¯ã€‚","user_name":"ä½œè€…å›å¤","comment_id":235877,"uid":"1001282","ip_address":"","utype":1,"ctime":1595343123,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":5,"race_medal":0,"score":"104674448180","product_id":100020901,"comment_content":"è°ˆè°ˆè‡ªå·±ç”Ÿäº§ç¯å¢ƒè¿è¡Œ3ä¸ªæœˆçš„å†…å­˜æ³„éœ²ç»éªŒå§ï¼š<br>ç°è±¡ï¼šæœåŠ¡ç¨‹åºè¿è¡Œ90å¤©ï¼Œç›‘æ§ç³»ç»Ÿå‘Šè­¦å†…å­˜è¾¾åˆ°é˜ˆå€¼ï¼Œå†…å­˜æ³„æ¼800Mã€‚ç°å®ï¼šç”Ÿäº§ç¯å¢ƒã€éš¾å¤ç°ã€‚<br><br>- ä¿å­˜coreæ–‡ä»¶ã€‚ ç»Ÿè®¡top10 å¤§å°å—å†…å­˜åˆ†é…ç™¾åˆ†æ¯”<br><br>- å‘ç°20å­—èŠ‚å¤§å°å†…å­˜ç”³è¯·äº† 3700wæ¬¡ï¼Œå¤§æ¦‚700M<br><br>- é€šè¿‡å·¥å…·æœç´¢å·²æœ‰ç¬¦å·æ–‡ä»¶ä¸­å¤§å°ä¸º20å­—èŠ‚çš„ç»“æ„ä½“ã€ç±»ï¼Œä½†æ˜¯å¯èƒ½åŒ…å«ç¬¬ä¸‰æ–¹åº“ã€ç»„ä»¶æ²¡æœ‰ç¬¦å·æ–‡ä»¶ï¼Œå¯¼è‡´åˆ†æé‡é˜»ï¼Œæœªæœ<br><br>- é€šè¿‡éšæœºæŠ½æŸ¥20å­—èŠ‚å†…å­˜åœ°å€å†…å®¹ï¼Œå¸Œæœ›æ‰¾åˆ°æœ‰æ•ˆä¿¡æ¯ï¼Œä½†å‡ ä¹éƒ½æ˜¯ 0x00 0x10 0x00 ï¼Œ æ²¡å­—ç¬¦ä¸²ï¼ŒçŒœä¸å‡ºä»€ä¹ˆå†…å®¹ï¼Œæœªæœ<br><br>- é€šè¿‡3700wæ¬¡æ•°ç”³è¯·ï¼Œå¹³å‡æ¯å°æ—¶17000æ¬¡å·¦å³ã€‚ é€šè¿‡å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œåˆ†æ1w~3wé‡çº§çš„æ¶ˆæ¯ï¼Œå¤§æ¦‚4ä¸ªï¼Œreviewä»£ç ï¼Œé—®é¢˜è§£å†³<br><br>- é—®é¢˜å®šä½æ€»å…±èŠ±è´¹äº†4ä¸ªå°æ—¶å·¦å³ã€‚åˆ†æå†…å­˜æ³„æ¼å·¥å…·ã€æ–¹æ³•å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘è§‰çš„æ›´é‡è¦çš„æ˜¯å®Œå–„çš„ç›‘æ§ç³»ç»Ÿå’Œæ—¥å¿—ç³»ç»Ÿã€‚<br><br>","like_count":24,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501859,"discussion_content":"è°¢è°¢åˆ†äº«ï¼çš„ç¡®ï¼Œå®Œå–„çš„ç›‘æ§å’Œæ—¥å¿—å¯ä»¥æ›´å¿«æ’æŸ¥å’Œå®šä½é—®é¢˜ï¼Œæˆ‘ä»¬ä¸“æ åé¢ä¹Ÿæœ‰æ–‡ç« æåˆ°ç›‘æ§çš„ä¸€äº›æ€è·¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1240168,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ert8UYzoypaI9wMPZQV2ibThQ2zKsoge5R25qxHP10eia5pMYOV1mq6G9bft5LoygnyR6bn8RERwQDg/132","nickname":"Geek_2b6807","note":"","ucode":"4C1D0B7F283554","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559824,"discussion_content":"è¿™æ³„æ¼800Må°±å†…å­˜å‘Šè­¦äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648989758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1045025,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/21/00600713.jpg","nickname":"å°ä¾ ","note":"","ucode":"A35A61061E41B2","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355494,"discussion_content":"åŒé—®ï¼šä¿å­˜coreæ–‡ä»¶ã€‚ ç»Ÿè®¡top10 å¤§å°å—å†…å­˜åˆ†é…ç™¾åˆ†æ¯”â€--ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå·¥å…·ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615443200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1105816,"avatar":"https://static001.geekbang.org/account/avatar/00/10/df/98/670d96c0.jpg","nickname":"æµå¹´ä¼¼æ°´","note":"","ucode":"048D320AFB576A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1045025,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/21/00600713.jpg","nickname":"å°ä¾ ","note":"","ucode":"A35A61061E41B2","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":584343,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660781925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":355494,"ip_address":"æ±Ÿè‹"},"score":584343,"extra":""}]},{"author":{"id":2051085,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erGLUqIRJ2gJamFq0SbJksGTNOeHnAQzWZknhRaWFDt5vh1mPpZ9eZdrfvn0bzcRqTZo0yjMW3Ugw/132","nickname":"Jasman","note":"","ucode":"C5221E477219A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334296,"discussion_content":"è¯·é—®â€œ- ä¿å­˜coreæ–‡ä»¶ã€‚ ç»Ÿè®¡top10 å¤§å°å—å†…å­˜åˆ†é…ç™¾åˆ†æ¯”â€è¿™ç§æ˜¯ç”¨çš„å·¥å…·ï¼Ÿæ¬¢è¿ç»™ä»‹ç»ä»‹ç»å®šä½çš„è¯¦ç»†è¿‡ç¨‹ï¼Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607788127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55847,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1546327270,"is_pvip":true,"discussion_count":7,"race_medal":0,"score":"87445673190","product_id":100020901,"comment_content":"è€å¸ˆï¼š<br>é‡åˆ°äº†ä¸ªé—®é¢˜ï¼Œgoogleä¹ŸæŸ¥ä¸å‡ºæ‰€ä»¥ç„¶ï¼š<br>1ã€ubuntu 18.04ï¼Œå†…æ ¸4.15.0-29-generic<br>2ã€è¿è¡Œ memleak -a -p $(pidof app)ï¼ŒæŠ¥é”™ï¼š<br>Attaching to pid 14069, Ctrl+C to quit.<br>perf_event_open(&#47;sys&#47;kernel&#47;debug&#47;tracing&#47;events&#47;uprobes&#47;p__lib_x86_64_linux_gnu_libc_2_27_so_0x97070_14069_bcc_14199&#47;id): Input&#47;output error<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 416, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 406, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 952, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe","like_count":20,"discussions":[{"author":{"id":2291160,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f5/d8/121e4b68.jpg","nickname":"Woa ğŸ¤","note":"","ucode":"6033F496082F3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553352,"discussion_content":"è‡ªè¡Œç¼–è¯‘ä¸€ä¸‹bccè¯•è¯•å§ã€‚ä¸€èˆ¬æ˜¯pythonå®‰è£…å¥½äº†ï¼Œä½†æ˜¯å†…æ ¸ä»€ä¹ˆçš„ä¸åŒ¹é…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645858737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1659261,"avatar":"https://static001.geekbang.org/account/avatar/00/19/51/7d/2772ec9a.jpg","nickname":"é£è¿‡ç•™ç—•","note":"","ucode":"F13405AD8511B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339372,"discussion_content":"ç¼–è¾‘ /etc/apt/sources.list\n$ vi /etc/apt/sources.list\næ³¨é‡Šæ‰deb cdromå¼€å¤´çš„é‚£ä¸€è¡Œ\n# deb cdrom:\næ›´æ–°debä»“åº“ä¿¡æ¯\n$ sudo apt update\n\näº²æµ‹æœ‰ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609648333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1659261,"avatar":"https://static001.geekbang.org/account/avatar/00/19/51/7d/2772ec9a.jpg","nickname":"é£è¿‡ç•™ç—•","note":"","ucode":"F13405AD8511B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367549,"discussion_content":" æœ¬èº«å°±æ²¡æœ‰cdromç›¸å…³çš„æºä¹Ÿä¼šæŠ¥é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618389846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339372,"ip_address":""},"score":367549,"extra":""}]},{"author":{"id":1145907,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","nickname":"englefly","note":"","ucode":"E3FCF19E618718","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333327,"discussion_content":"æˆ‘ç”¨ snap å®‰è£…çš„bccé‡åˆ°è¿™ç›¸åŒé—®é¢˜ï¼Œåæ¥æ”¹ç”¨apté‡è£…çš„bccå°±æ²¡è¿™ä¸ªé—®é¢˜äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607502096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324925,"discussion_content":"è‡ªè¡Œå˜ä¸€ä¸‹bccå°±å¯ä»¥äº†ï¼Œæˆ‘ä¹Ÿé‡åˆ°ç›¸åŒçš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605191118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311784,"discussion_content":"å±…ç„¶ä¸ç™¾åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602488804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304580,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e8/04/eb81e2ff.jpg","nickname":"ä¸è½é“¶æ²³ä¹‹ç¿¼","note":"","ucode":"13603DE99E7ACA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":111,"discussion_content":"å…ˆæ‰§è¡Œsudo su rootå°±å¯ä»¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561109190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56040,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1546389624,"is_pvip":false,"replies":[{"id":"20272","content":"Java çœ‹åˆ°çš„æ˜¯JVM çš„å †æ ˆã€‚å…¶å®ï¼Œjmapè¿™äº›JavaåŸç”Ÿçš„å·¥å…·æ›´å¥½ç”¨","user_name":"ä½œè€…å›å¤","comment_id":56040,"uid":"1001282","ip_address":"","utype":1,"ctime":1546424262,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":4,"race_medal":0,"score":"83150768248","product_id":100020901,"comment_content":"å¦‚æœæ˜¯javaåº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•å®šä½ä¹ˆï¼Ÿ","like_count":19,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434920,"discussion_content":"Java çœ‹åˆ°çš„æ˜¯JVM çš„å †æ ˆã€‚å…¶å®ï¼Œjmapè¿™äº›JavaåŸç”Ÿçš„å·¥å…·æ›´å¥½ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1602650,"avatar":"","nickname":"Geek_e2b0f9","note":"","ucode":"CAB31078DDB515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":589052,"discussion_content":"javaè¿›ç¨‹ Resä¸æ–­å¢å¤§  çŒœæµ‹jniå†…å­˜æ³„æ¼ æ€ä¹ˆå®šä½å…·ä½“ä½ç½® ä½¿ç”¨valgrindæœ‰éƒ¨åˆ†è¾“å‡ºä¿¡æ¯æ˜¯â€œï¼Ÿï¼Ÿï¼Ÿâ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664369511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":434920,"ip_address":"åŒ—äº¬"},"score":589052,"extra":""}]},{"author":{"id":1261634,"avatar":"https://static001.geekbang.org/account/avatar/00/13/40/42/d5c23178.jpg","nickname":"jackhance","note":"","ucode":"934B0D20CCD06C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305150,"discussion_content":"å†…å­˜æ–¹é¢ï¼Œjdkæä¾›çš„å·¥å…·æ›´åŠ ç»™åŠ›ï¼Œjmapã€jstatã€jcmd","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599796187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"å‡¯æ–‡å°çŒª","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387376,"discussion_content":"javaç”¨jmap -histo:live [pid] |lessåˆ†æ æˆ–è€…ç›´æ¥å¯¼å‡ºdumpåˆ†ægc root","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628142831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55534,"user_name":"è§è‘£","can_delete":false,"product_type":"c1","uid":1341895,"ip_address":"","ucode":"7AD87DE458F5B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqvaPTSYCtlXUc9DZxe6MWHeRJEKEr9fNPXMveWtia4Kic3BOicwCuRK6SVKymvvw9PZ5unxiaSukvSXQ/132","comment_is_top":false,"comment_ctime":1546224956,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"83150603580","product_id":100020901,"comment_content":"memleakè¾“å‡ºä¸­ä¸€ç›´æœ‰addrå°±æ˜¯å†…å­˜æ²¡æœ‰é‡Šæ”¾å—","like_count":19,"discussions":[{"author":{"id":1078067,"avatar":"https://static001.geekbang.org/account/avatar/00/10/73/33/97769a70.jpg","nickname":"Niccr","note":"","ucode":"3D0CDE7117F0C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332227,"discussion_content":"outstanding allocations æœªé‡Šæ”¾çš„åˆ†é…é¢","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1607099512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330766,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606705174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297753,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597047721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047114,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/4a/23f480f5.jpg","nickname":"æµ·ä¸€å‰‘","note":"","ucode":"8F18D06C631EA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164869,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581227445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1604645,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7c/25/70134099.jpg","nickname":"è®¸å‡¯","note":"","ucode":"4F11AD41CB0244","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107842,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577611409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148574,"user_name":"Dym","can_delete":false,"product_type":"c1","uid":1205036,"ip_address":"","ucode":"7E521F01A4D823","user_header":"","comment_is_top":false,"comment_ctime":1573032561,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"74587476593","product_id":100020901,"comment_content":"1ã€å†…å­˜æ³„éœ²<br><br>å‘ç”Ÿçš„å†…å­˜åŒºåŸŸåœ¨å †åŒºï¼Œå› ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºçš„å¯¹è±¡éƒ½åœ¨å†…å­˜å †ä¸­ï¼Œå½“åˆ›å»ºäº†å¯¹è±¡åï¼Œä½¿ç”¨å®Œäº†åæ­¤å¯¹è±¡å°†å¤±å»äº†ä½œç”¨ï¼ŒæŒ‰æ­£å¸¸é€»è¾‘æ˜¯ä¼šè¢«GCå›æ”¶çš„ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨ä¸æ°å½“ä¼šå¯¼è‡´è¯¥å¯¹è±¡ä¸€ç›´è¢«å¼•ç”¨ï¼Œä½†æ˜¯ä»¥åéƒ½ä¸ä¼šå†ä½¿ç”¨è¯¥å¯¹è±¡ï¼Œè¿™å°±å‡ºç°äº†å†…å­˜æ³„éœ²ç°è±¡<br><br><br>2ã€å¦‚ä½•æ’æŸ¥<br><br>å¯¹äºå…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨ bccä¸­çš„memleak æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜åˆ†é…æƒ…å†µï¼Œå¦‚æœåªçœ‹åˆ°å†…å­˜ä¸€ç›´éƒ½åœ¨åˆ†é…çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰é‡Šæ”¾è¡¨æ˜å­˜åœ¨å†…å­˜æ³„éœ²<br><br>å¯¹javaè¿›ç¨‹å¯ä»¥å…ˆé€šè¿‡ jstat -gc pid 1s  æ¯éš”1s æŸ¥çœ‹å½“å‰è¿›ç¨‹gcæƒ…å†µï¼Œå¦‚æœå­˜åœ¨å†…å­˜æ³„éœ²çš„è¯ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å­˜æ´»æ—¶é—´ä¼šå¾ˆé•¿å½“ç„¶ä¼šæ™‹å‡åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥é€šè¿‡çœ‹è€å¹´ä»£å˜åŒ–è¶‹åŠ¿ï¼Œå¦‚æœå¢å¤§çš„è¯ï¼Œæˆ‘ä»¬å†ä½¿ç”¨jmap -histo:live  pid  æŸ¥çœ‹è¿›ç¨‹ä¸­heapåŒºå¯¹è±¡çš„ä¸ªæ•°å’Œå ç”¨çš„ç©ºé—´å¤§å°ï¼Œæ‰¾å‡ºæ•°é‡å¤§çš„å¯¹è±¡ç„¶åæ‰¾åˆ°å¯¹åº”çš„ç±»æŸ¥çœ‹ä»£ç ï¼Œæ˜¯å¦ä¼šå­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜ã€‚<br><br>æ³¨æ„ï¼šå¯ä»¥å°†jmap -histo:live pid &gt; data.txt å¯¼å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡sort æ ¹æ®å¯¹è±¡ä¸ªæ•°æˆ–å ç”¨ç©ºé—´è¿›è¡Œæ’åº<br><br><br>3ã€ThreadLocalä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´å†…å­˜æ³„éœ²<br><br>å½“ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è®¾ç½®localå€¼   threadLoacl.set(obj) åæ²¡æœ‰é€šè¿‡ threadLoacl.remove()å°±ä¼šå¯¼è‡´å†…å­˜æ³„éœ²<br><br>æ ¹æ®ThreadLocalå®ç°ä»£ç ä¸Šçœ‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½ä¼šæœ‰ä¸ªThreadLocalMap è¿™ä¸ªmapä¸­çš„keyä¸ºThreadLocalå¯¹è±¡ï¼Œvalueå°±æ˜¯å¯¹åº”setçš„å€¼ï¼Œå½“ç¦»å¼€äº†ä½œç”¨åŸŸthreadLocalå°±ä¸ä¼šå†æŒ‡å‘ThreadLocalå¯¹è±¡ï¼Œç”±äºThreadLocalMapä¸­çš„keyä¸ºWeakReference å½“è¯¥å¯¹è±¡åªæœ‰å®ƒè‡ªå·±æŒ‡å‘æ—¶å°±ä¼šå¯¼è‡´keyå˜æˆäº†nullï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ˜¯åœ¨çº¿ç¨‹æ± ä¸­æ˜¯ä¼šä¸€ç›´å­˜æ´»çš„ï¼Œä¹Ÿå°±æ˜¯mapä¸­çš„valueå€¼ä¼šä¸€ç›´æŒ‡å‘å †çš„å¯¹è±¡ï¼Œä»è€Œå¯¼è‡´äº†å†…å­˜æ³„éœ²","like_count":17,"discussions":[{"author":{"id":1447569,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","nickname":"è„±ç¼°çš„é‡é©¬__","note":"","ucode":"D5F993E7232C61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377753,"discussion_content":"Javaå†…å­˜æ³„æ¼æ’æŸ¥æˆ‘ä¸ªäººç»éªŒï¼šä¸»è¦æ¶‰åŠä¸¤ä¸ªå‘½ä»¤ï¼š\nâ‘  jstat -gcutil pid 2000ï¼šæ¯2ç§’æŸ¥çœ‹gcçš„æƒ…å†µï¼Œå¦‚æœè€å¹´ä»£åœ¨æŒç»­å¢é•¿ï¼Œå¹¶ä¸”FGCä¹Ÿæœ‰è§„å¾‹å‘ç”Ÿï¼Œå¯èƒ½ä¼šå­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå› ä¸ºå‡ºç°å†…å­˜æ³„æ¼çš„æ—¶å€™ï¼Œå¯¹è±¡ä¸ä¼šå¾—åˆ°å›æ”¶ï¼Œå¯¹è±¡å¦‚æœåˆå§‹åˆ†é…åœ¨å¹´è½»ä»£ç»è¿‡å¤šæ¬¡GCåæ™‹å‡åˆ°è€å¹´ä»£ï¼Œä»è€Œå¯¼è‡´è€å¹´ä»£å†…å­˜ä½¿ç”¨æŒç»­å¢åŠ ï¼Œä»è€Œå¯¼è‡´FGCï¼›\nâ‘¡ä½¿ç”¨jmap -dump:format=b,file=/tmp/name.hpof pidï¼šè¿™ä¸ªå‘½ä»¤æ˜¯å°†æ‰§è¡Œè¯¥å‘½ä»¤çš„è¿™ä¸ªæ—¶é—´ç‚¹çš„å†…å­˜å¿«ç…§è®°å½•åˆ°fileæŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä¸‹è½½ä¸‹æ¥åä½¿ç”¨matå·¥å…·æ‰“å¼€è¿›è¡Œåˆ†æå †å†…å­˜ä¸­çš„å¯¹è±¡æƒ…å†µï¼Œæ³¨æ„ï¼šè¿™é‡Œåªèƒ½è®°å½•æŸä¸€æ—¶åˆ»çš„ï¼Œå¦‚æœè¦çœ‹æ˜¯å¦å†…å­˜æ³„æ¼ï¼Œéœ€è¦ç»Ÿè®¡æœ€å°‘ä¸¤ä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§ä¿¡æ¯ï¼Œå¯ä»¥åœ¨æœåŠ¡åˆšé‡æ–°å¯åŠ¨ä¸ä¹…è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œç„¶åè¿‡æ®µæ—¶é—´å†ç»Ÿè®¡ä¸€ä¸‹ï¼Œä½¿ç”¨matå·¥å…·è¿›è¡Œå¯¹æ¯”åˆ†æï¼Œå¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºå“ªäº›å¯¹è±¡ä¸€ç›´å¢é•¿å¹¶ä¸”æ²¡è¢«å›æ”¶\nå¦‚æœä¸‹è½½.hpofæœ‰é—®é¢˜çœ‹ä¸‹è¿™ä¸ªï¼š https://blog.csdn.net/xiaolinnulidushu/article/details/113870948ï¼Œ matå·¥å…·ä¸å¤ªä¼šç”¨å¯ä»¥çœ‹ä¸‹ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œå¤šä½¿ç”¨å‡ æ¬¡å°±ç†Ÿæ‚‰äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1622807637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202730,"user_name":"ä¸‡å†åäº”å¹´","can_delete":false,"product_type":"c1","uid":1122150,"ip_address":"","ucode":"3D8CF5DF847AE8","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg","comment_is_top":false,"comment_ctime":1586058966,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"70305535702","product_id":100020901,"comment_content":"å†…å­˜æ³„éœ²æ˜¯ç¨‹åºå¼€å‘ä¸­å¾ˆå¸¸è§çš„äº‹ï¼Œå¦‚ä½•æ·±å…¥åˆ†æå’Œå®šä½å†…å­˜æ³„éœ²æ˜¯å¯ä»¥å¤§æ”¾å¼ å½©çš„ä¸€ç¯‡ã€‚è¿™ç¯‡æ–‡ç« è€å¸ˆå†™çš„æœ‰ç‚¹å¤ªç®€å•äº†ã€‚","like_count":16,"discussions":[{"author":{"id":2068424,"avatar":"","nickname":"Geek_9815f1","note":"","ucode":"34EE8566A53F10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291806,"discussion_content":"å…„å¼Ÿï¼Œå¯ä»¥è¯•è¯•gpreftools å·¥å…·å®šä½ä¸€ä¸‹ï¼Œä¸è¿‡è¦é‡æ–°ç¼–è¯‘ã€‚å¹¶ä¸”å¾ˆè€—åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1594958427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390903,"discussion_content":"æ¬¢è¿å„è·¯å¤§å’–è¿‡æ¥è¡¥å……åˆ†äº«æ–¹æ³•ã€‚åœ¨æ­¤æ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630133619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56976,"user_name":"é˜¿å¡ç‰›","can_delete":false,"product_type":"c1","uid":1022247,"ip_address":"","ucode":"0BC43A904C3199","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","comment_is_top":false,"comment_ctime":1546591539,"is_pvip":false,"replies":[{"id":"22283","content":"å»æ‰è¿›ç¨‹å·é€‰é¡¹","user_name":"ä½œè€…å›å¤","comment_id":56976,"uid":"1001282","ip_address":"","utype":1,"ctime":1548246321,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"48791231795","product_id":100020901,"comment_content":"è€å¸ˆï¼Œä½ è¿™ä¸ªä¾‹å­æ˜¯å·²ç»çŸ¥é“å“ªä¸ªè¿›ç¨‹æœ‰å†…å­˜æ³„éœ²äº†ï¼Œè¯·é—®å¦‚ä½•æ‰¾å‡ºå“ªä¸ªè¿›ç¨‹å‘¢ï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435344,"discussion_content":"å»æ‰è¿›ç¨‹å·é€‰é¡¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548246321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2291160,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f5/d8/121e4b68.jpg","nickname":"Woa ğŸ¤","note":"","ucode":"6033F496082F3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553353,"discussion_content":"ç¬‘æ­»ï¼Œå»æ‰ä¹‹åç›´æ¥çˆ†ç‚¸ğŸ’¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645858801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142316,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","nickname":"æ³¨æ„åŠ›$","note":"","ucode":"7FB3399A1EAB72","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279726,"discussion_content":"æ˜¯æŒ‡è¿™æ ·å—ï¼Ÿmemleak -a -p $(pidof app)  å»æ‰-p $(pidof app)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591405602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55496,"user_name":"ä»˜ç›¼æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1055542,"ip_address":"","ucode":"E0E4B74E8B361F","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/36/abe6d066.jpg","comment_is_top":false,"comment_ctime":1546219181,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40200924845","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œè¿™é‡Œçš„å †æ ˆå’Œjavaè™šæ‹Ÿæœºçš„å †æ ˆæ˜¯å¯¹åº”èµ·æ¥çš„ä¹ˆï¼Ÿ","like_count":9},{"had_liked":false,"id":55565,"user_name":"éƒ­æ±Ÿä¼Ÿ","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1546232743,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31611003815","product_id":100020901,"comment_content":"æœ¬ä¾‹ä¸­å°†åŠ¨æ€åˆ†é…å†…å­˜æ”¹ä¸ºä½¿ç”¨æ•°ç»„ï¼Œç„¶åå°±ä¸éœ€è¦è‡ªå·±freeäº†ï¼›<br>å°†app.cæ‹·è´ä¸ºapp2.c  åšå¦‚ä¸‹ä¿®æ”¹ï¼Œå› ä¸ºç¯‡å¹…æœ‰é™æ²¡æ³•è´´å®Œå…¨ä»£ç ï¼š<br>long long fibonacci(long long *n0, long long *n1)<br>{<br>\t&#47;&#47;åˆ†é…1024ä¸ªé•¿æ•´æ•°ç©ºé—´æ–¹ä¾¿è§‚æµ‹å†…å­˜çš„å˜åŒ–æƒ…å†µ<br>&#47;&#47;\tlong long *v = (long long *) calloc(1024, sizeof(long long));<br>         long long v[1024];<br>ç„¶åæ‰§è¡Œmemleak<br>gjw@gjw:~$ sudo &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak  -p $(pidof app2c)<br>Attaching to pid 3463, Ctrl+C to quit.<br>[13:02:24] Top 10 stacks with outstanding allocations:<br>[13:02:29] Top 10 stacks with outstanding allocations:<br>^Cgjw@gjw:~$ sudo &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak  -p $(pidof app2c)<br>Attaching to pid 3463, Ctrl+C to quit.<br>[13:02:43] Top 10 stacks with outstanding allocations:<br>[13:02:48] Top 10 stacks with outstanding allocations:<br>[13:02:53] Top 10 stacks with outstanding allocations:<br>[13:02:58] Top 10 stacks with outstanding allocations:<br>","like_count":7,"discussions":[{"author":{"id":1620836,"avatar":"https://static001.geekbang.org/account/avatar/00/18/bb/64/f88a1fa8.jpg","nickname":"machh-186","note":"","ucode":"B0027D2AE85AA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3688,"discussion_content":"è¿”å›å€¼æ­£ç¡®å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564709684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256329,"user_name":"evan","can_delete":false,"product_type":"c1","uid":1543040,"ip_address":"","ucode":"491B073D5AFEDE","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","comment_is_top":false,"comment_ctime":1603599803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23078436283","product_id":100020901,"comment_content":"æä¸ªå»ºè®®..å½“ç„¶å·²ç»åè¯äº†..<br>è€å¸ˆä¸‹æ¬¡åšè¯¾ä»¶å¯ä»¥ç›´æ¥æŠŠä½¿ç”¨çš„ç¯å¢ƒæ‰“åŒ…åˆ°dockeré‡Œ,<br>ç„¶åç›´æ¥æ“ä½œdocker=ä¸­çš„os...ç¯å¢ƒé—®é¢˜çœŸçš„å¾ˆå¤´ç–¼...","like_count":5},{"had_liked":false,"id":179808,"user_name":"èµµç”Ÿ","can_delete":false,"product_type":"c1","uid":1828283,"ip_address":"","ucode":"DA3CC6E316C500","user_header":"","comment_is_top":false,"comment_ctime":1582102962,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23056939442","product_id":100020901,"comment_content":"æƒ³é—®ä¸‹è€å¸ˆï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¾ˆå¤šç³»ç»Ÿéƒ½æ˜¯3.10ç‰ˆæœ¬çš„å†…æ ¸ï¼Œä¸èƒ½å‡çº§åˆ°4.1ï¼Œå¦‚ä½•æ’æŸ¥å†…å­˜æ³„éœ²çš„é—®é¢˜å‘¢ï¼Ÿ","like_count":5},{"had_liked":false,"id":55773,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1546305687,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23021142167","product_id":100020901,"comment_content":"é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œåœ¨cä¸­æœ€å¥½è®©mallocå’Œfreeæˆå¯¹å‡ºç°ï¼Œä¸è¦åœ¨å‡½æ•°ä¸­åˆ†é…ï¼Œåœ¨å‡½æ•°å¤–é‡Šæ”¾ï¼Œè¿™æ ·ä¸€ä¸ç•™ç¥å°±å¿˜äº†ï¼Œæ£€æŸ¥æ—¶ä¹Ÿä¸å®¹æ˜“å‘ç°ã€‚ä¹Ÿå¯ä½¿ç”¨ä¸€äº›æºä»£ç å†…å­˜æ³„éœ²æ£€æµ‹å·¥å…·ã€‚åœ¨C++ä¸­é™¤äº†æˆå¯¹å‡ºç°å¤–è¿˜è¦æ³¨æ„newå’Œdeleteä½¿ç”¨çš„ä¸€äº›è¦ç‚¹ã€‚æ›¾é‡åˆ°è¿‡ä¸€ä¸ªæŠ•èµ„æ•°åƒä¸‡çš„å¤§é¡¹ç›®ï¼Œjavaåšçš„ï¼Œå› å†…å­˜æ³„éœ²ä¸èƒ½æŸ¥æ˜åŸå› ï¼ŒæœåŠ¡å™¨ä¸å¾—ä¸æ¯æœˆæ€æ‰æœåŠ¡è¿›ç¨‹ï¼Œé‡æ–°å¯åŠ¨ã€‚","like_count":5},{"had_liked":false,"id":55607,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1546241982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23021078462","product_id":100020901,"comment_content":"[D18æ‰“å¡]<br>æƒ³ä¸åˆ°åˆæœ‰ç¥å™¨å¯ä»¥ç›´æ¥åˆ†æå‡ºæ˜¯å“ªä¸ªå‡½æ•°å¯¼è‡´äº†å†…å­˜æ³„éœ²ã€‚<br>ä»¥å‰éƒ½æ˜¯åœ¨ç”³è¯·å’Œé‡Šæ”¾çš„åœ°æ–¹åŠ æ ‡è®°ï¼Œç„¶åç”¨å·¥å…·å»åˆ†æã€‚<br>æ€è€ƒé¢˜ï¼š<br>ä¸€èˆ¬èƒ½é¢„åˆ†é…çš„ç©ºé—´éƒ½æ²¡å¿…è¦å»åŠ¨æ€ç”³è¯·ã€‚<br>è¿™ä¸ªæ¡ˆä¾‹å¯ä»¥æŠŠå­˜æ”¾ç»“æœçš„å€¼å…ˆå®šä¹‰å¥½ï¼Œå‡½æ•°å‚æ•°ä¸­ç”¨æŒ‡é’ˆè¿‡å»ï¼Œè¿™æ ·å°±æ²¡å¿…è¦ç”³è¯·å†…å­˜äº†ã€‚<br>","like_count":5},{"had_liked":false,"id":55503,"user_name":"espzest","can_delete":false,"product_type":"c1","uid":1094470,"ip_address":"","ucode":"64B1A7DEA19348","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/46/ec914238.jpg","comment_is_top":false,"comment_ctime":1546220967,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18726090151","product_id":100020901,"comment_content":"ç¨‹åºé•¿æœŸè¿è¡Œåï¼ŒVSZä¸€ç›´å¢é•¿ï¼Œå…¶ä¸­å¾ˆç»å¤§å¤šæ•°æ˜¯åŒ¿åé¡µå¯¼è‡´çš„ï¼Œæœ‰æ²¡æœ‰æ²¡æ³•ç¡®å®šè¿™äº›åŒ¿åé¡µæ˜¯ä¾ç„¶åœ¨ç”¨ï¼Ÿ  å¦‚æœæ²¡æœ‰å†ç”¨ï¼Œèƒ½æœ‰åŠæ³•å¼ºåˆ¶é‡Šæ”¾ä»–ä»¬ï¼Ÿ ","like_count":4},{"had_liked":false,"id":245367,"user_name":"ming","can_delete":false,"product_type":"c1","uid":2084718,"ip_address":"","ucode":"FF2C74CBA5E7BC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","comment_is_top":false,"comment_ctime":1598925833,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14483827721","product_id":100020901,"comment_content":"1ã€$(pidof appï¼‰æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿéš¾é“æ˜¯è¿›ç¨‹pidå—ï¼Ÿ é‚£&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p $(pidof app)æ‰§è¡Œï¼Œå²‚ä¸æ˜¯æ—©å°±çŸ¥é“æ˜¯$(pidof app)å¯¼è‡´çš„æ³„éœ²ï¼Ÿ<br><br>2ã€æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½çŸ¥é“æ˜¯$(pidof appï¼‰è¿™ä¸ªè¿›ç¨‹å¯¼è‡´çš„æ³„éœ²å‘¢ï¼Ÿ<br><br>","like_count":3},{"had_liked":false,"id":157599,"user_name":"airmyä¸¶","can_delete":false,"product_type":"c1","uid":1299673,"ip_address":"","ucode":"41959C9F5B4B65","user_header":"https://static001.geekbang.org/account/avatar/00/13/d4/d9/c3296187.jpg","comment_is_top":false,"comment_ctime":1575209289,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"14460111177","product_id":100020901,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹æˆ‘å»æ‰-pé€‰é¡¹ç›´æ¥è¿è¡Œmemleak -a ï¼Œä¸‹é¢çš„ç»“æœæ˜¾ç¤ºå¾ˆå¤šæ²¡æœ‰é‡Šæ”¾çš„å†…å­˜ å…¨éƒ¨æ¥è‡ª [kernel] è¿™ä¸ªæ˜¯ä¸æ­£å¸¸çš„å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1049208,"avatar":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","nickname":"james","note":"","ucode":"5701899403917C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333837,"discussion_content":"ä¸åŠ -p å®Œå…¨ä¸çŸ¥é“æ˜¯å“ªä¸ªè¿›ç¨‹ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607647901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55742,"user_name":"é»„æ™ºå¯¿","can_delete":false,"product_type":"c1","uid":1249951,"ip_address":"","ucode":"43685DE62F720B","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/9f/b6eb3471.jpg","comment_is_top":false,"comment_ctime":1546276579,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"14431178467","product_id":100020901,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¯¹äºgolangæˆ–è€…pythonä¹‹ç±»çš„è¿›ç¨‹æœ‰æ²¡æœ‰ç›¸åº”çš„å·¥å…·åˆ†æå†…å­˜æ³„éœ²","like_count":3,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317799,"discussion_content":"go pprof","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603600218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92212,"user_name":"å§œå°é±¼","can_delete":false,"product_type":"c1","uid":1317762,"ip_address":"","ucode":"3E2076E20289BF","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/82/69581d8a.jpg","comment_is_top":false,"comment_ctime":1557201972,"is_pvip":false,"replies":[{"id":"33112","content":"ä¹Ÿæ”¯æŒå†…æ ¸çš„ï¼Œçœ‹å®ƒçš„æºç å¯ä»¥å‘ç°ï¼Œkmalloc&#47;kfree&#47;kmem_cache_allocç­‰ç­‰ä¹Ÿéƒ½åœ¨TRACEPOINT_PROBEé‡Œé¢","user_name":"ä½œè€…å›å¤","comment_id":92212,"uid":"1001282","ip_address":"","utype":1,"ctime":1557324634,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10147136564","product_id":100020901,"comment_content":"è€å¸ˆï¼Œmemleakåªèƒ½æ£€æµ‹ç”¨æˆ·ç¨‹åºçš„å†…å­˜æ³„æ¼å§ï¼Ÿå¦‚æœæ£€æµ‹å†…æ ¸æ€è°‹å’Œæ¨¡å—å†…å­˜æ³„æ¼å‘¢ï¼ŒKmemleakèƒ½å¦è®²ä¸€ä¸‹å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449179,"discussion_content":"ä¹Ÿæ”¯æŒå†…æ ¸çš„ï¼Œçœ‹å®ƒçš„æºç å¯ä»¥å‘ç°ï¼Œkmalloc/kfree/kmem_cache_allocç­‰ç­‰ä¹Ÿéƒ½åœ¨TRACEPOINT_PROBEé‡Œé¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557324634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75377,"user_name":"å”¯å®‰æ ¼","can_delete":false,"product_type":"c1","uid":1334982,"ip_address":"","ucode":"72653918FC434E","user_header":"https://static001.geekbang.org/account/avatar/00/14/5e/c6/78e515ee.jpg","comment_is_top":false,"comment_ctime":1552384995,"is_pvip":false,"replies":[{"id":"28067","content":"å»æ‰è¿›ç¨‹å·é€‰é¡¹-pè¯•è¯•ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":75377,"uid":"1001282","ip_address":"","utype":1,"ctime":1552751689,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"10142319587","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘è¿è¡Œï¼š$ &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p $(pidof app) å¹¶æ²¡æœ‰çœ‹åˆ°å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚ä¹‹åè¿˜çœ‹äº†appçš„æºç ã€‚æºç å†…çš„ç¡®æ²¡æœ‰è°ƒç”¨free()å‡½æ•°ã€‚è¯·é—®è¿™å¯èƒ½æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ<br>root@ubuntu:&#47;# &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -p $(pidof app) -a<br>Attaching to pid 84307, Ctrl+C to quit.<br>[02:42:22] Top 10 stacks with outstanding allocations:<br>[02:42:27] Top 10 stacks with outstanding allocations:<br>[02:42:32] Top 10 stacks with outstanding allocations:<br>[02:42:37] Top 10 stacks with outstanding allocations:<br>[02:42:43] Top 10 stacks with outstanding allocations:<br>[02:42:48] Top 10 stacks with outstanding allocations:<br>[02:42:53] Top 10 stacks with outstanding allocations:<br>[02:42:58] Top 10 stacks with outstanding allocations:<br>[02:43:03] Top 10 stacks with outstanding allocations:<br>^Croot@ubuntu:&#47;# docker exec app cat &#47;app.c<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;pthread.h&gt;<br>#include &lt;unistd.h&gt;<br><br>long long *fibonacci(long long *n0, long long *n1)<br>{<br>\tlong long *v = (long long *) calloc(1024, sizeof(long long));<br>\t*v = *n0 + *n1;<br>\treturn v;<br>}<br><br>void *child(void *arg)<br>{<br>\tlong long n0 = 0;<br>\tlong long n1 = 1;<br>\tlong long *v = NULL;<br>\tfor (int n = 2; n &gt; 0; n++) {<br>\t\tv = fibonacci(&amp;n0, &amp;n1);<br>\t\tn0 = n1;<br>\t\tn1 = *v;<br>\t\tprintf(&quot;%dth =&gt; %lld\\n&quot;, n, *v);<br>\t\tsleep(1);<br>\t}<br>}<br><br><br>int main(void)<br>{<br>\tpthread_t tid;<br>\tpthread_create(&amp;tid, NULL, child, NULL);<br>\tpthread_join(tid, NULL);<br>\tprintf(&quot;main thread exit\\n&quot;);<br>\treturn 0;<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442876,"discussion_content":"å»æ‰è¿›ç¨‹å·é€‰é¡¹-pè¯•è¯•ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552751689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69905,"user_name":"VickyğŸ£ğŸ£ğŸ£","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1550900945,"is_pvip":false,"replies":[{"id":"25338","content":"çœ‹ä¸€ä¸‹å†…æ ¸é…ç½®å¼€å¯CONFIG_UPROBE_EVENTSäº†å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551194221,"ip_address":"","comment_id":69905,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10140835537","product_id":100020901,"comment_content":"1. å¦‚æœæ‰§è¡Œ&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p [pid] å°±ä¼šæŠ¥é”™Exception: Failed to attach BPF to uprobe<br>ä½†æ˜¯æ‰§è¡Œ&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -aï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯é‡Œé¢å¹¶æ²¡æœ‰å’Œappç›¸å…³å‡½æ•°<br>2. freeè§‚å¯Ÿæƒ…å†µå¦‚ä¸‹ï¼Œæ–°æœºå™¨ï¼Œå¹¶æ²¡æœ‰ä»»ä½•å…¶ä»–é«˜å ç”¨å†…å­˜çš„è¿›ç¨‹ï¼Œå¾ˆæ˜¯å¥‡æ€ª<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 218244 112044 463144    0    0    21    31  148  344  1  0 99  0  0<br> 0  0      0 218268 112044 463144    0    0     0     0  168  402  0  1 99  0  0<br> 0  0      0 217928 112044 463144    0    0     0     7  182  427  1  0 99  0  0<br> 0  0      0 217836 112044 463228    0    0    23     0  317  730  1  1 98  0  0<br> 0  0      0 217836 112048 463236    0    0     0    17  186  437  1  0 99  0  0<br> 0  0      0 215804 112052 463232    0    0     0    19  202  476  1  1 98  0  0<br> 0  0      0 215860 112052 463240    0    0     0     5  221  490  1  1 99  0  0<br> 0  0      0 217040 112056 463244    0    0     0    15  207  481  1  0 99  0  0<br> 0  0      0 217040 112056 463244    0    0     0     0  156  363  0  0 100  0  0<br> 0  0      0  76976 112056 463296    0    0    24    12  221  546 11  3 86  0  0<br> 0  0      0  77008 112060 463316    0    0     0    11  178  407  1  1 98  0  0<br> 0  0      0  75140 112060 463324    0    0     0    27  176  812  2  3 95  0  0<br> 0  0      0  74584 112060 463328    0    0     0     7  174  819  1  1 98  0  0<br> 0  0      0  74616 112060 463332    0    0     0     0  183  417  0  0 99  0  0<br> 0  0      0 216884 112060 463332    0    0     0    83  176  403  1  0 98  1  0<br> 0  0      0 216884 112064 463328    0    0     0     9  180  448  0  1 99  0  0<br> 0  0      0 217012 112064 463336    0    0     0     4  193  452  0  1 99  0  0<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440345,"discussion_content":"çœ‹ä¸€ä¸‹å†…æ ¸é…ç½®å¼€å¯CONFIG_UPROBE_EVENTSäº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2690189,"avatar":"https://static001.geekbang.org/account/avatar/00/29/0c/8d/90bee755.jpg","nickname":"å¯„å±…ä¸èŸ¹","note":"","ucode":"3D254E5E2C9966","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576060,"discussion_content":"è¿™ä¸ªæ€ä¹ˆé…ç½®å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655263368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1844881,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoxLCjetepOZibacqBnhoibSlgGxAribic2AJPicVEic7M7DAFfuuJ7QvTXpiawO06tFdSpdnARibSVZ5R7Kg/132","nickname":"Geek_ç‰§é©¬äºº","note":"","ucode":"F26A43AF9C5164","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575331,"discussion_content":"ä¸çŸ¥é“æ€ä¹ˆé…ç½® éƒ½æ²¡æ‰¾åˆ°è¿™ä¸ªé…ç½®åœ¨å“ªä¸ªæ–‡ä»¶\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654754221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69899,"user_name":"VickyğŸ£ğŸ£ğŸ£","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1550899991,"is_pvip":false,"replies":[{"id":"25337","content":"å†…æ ¸ä¸­éœ€è¦å¼€å¯ CONFIG_UPROBE_EVENTS=y","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551194190,"ip_address":"","comment_id":69899,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10140834583","product_id":100020901,"comment_content":"è€å¸ˆï¼Œå¾ˆå¤šåŒå­¦éƒ½é—®è¿™ä¸ªé—®é¢˜äº†ï¼Œéº»çƒ¦è§£ç­”ä¸€ä¸‹å§<br>ubuntu 4.15.0-29<br># &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p 21642<br>Attaching to pid 21642, Ctrl+C to quit.<br>perf_event_open(&#47;sys&#47;kernel&#47;debug&#47;tracing&#47;events&#47;uprobes&#47;p__lib_x86_64_linux_gnu_libc_2_27_so_0x97070_21642_bcc_21882&#47;id): Input&#47;output error<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 416, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 406, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 989, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440341,"discussion_content":"å†…æ ¸ä¸­éœ€è¦å¼€å¯ CONFIG_UPROBE_EVENTS=y","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1633437,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jDG4trQm3t6licZym9TayWRk4zzNHibwnUnib606U5dP1DwR9fk1HGUHkl5Bg3Xpic34vqAXpapEMzMvreKJSAeKXA/132","nickname":"Geek_e8bbe6","note":"","ucode":"3A959141236658","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345377,"discussion_content":"è¯·é—®å†…æ ¸ä¸­éœ€æ€ä¹ˆæ‰èƒ½å¼€å¯ CONFIG_UPROBE_EVENTS=yå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611715032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1865399,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ic8eLTo5rntDE6LxCxOFXnibvzbEarEr5jPBLPOAdgUmfKVmoAMtN3a3xXN6x7DfzjAwuiaMvJW1w/132","nickname":"éŸ©å°‘å®‰","note":"","ucode":"02AA70C63C015F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318882,"discussion_content":"è¯·é—®å†…æ ¸ä¸­éœ€æ€ä¹ˆæ‰èƒ½å¼€å¯ CONFIG_UPROBE_EVENTS=yå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603874055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543320,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8c/98/ddd4513c.jpg","nickname":"èŒ¶åšå£«","note":"","ucode":"2E49324AC13DA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296025,"discussion_content":"è¯·é—®å†…æ ¸ä¸­éœ€æ€ä¹ˆæ‰èƒ½å¼€å¯ CONFIG_UPROBE_EVENTS=yå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596431189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56249,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1546411728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10136346320","product_id":100020901,"comment_content":"è€å¸ˆï¼Œç°åœ¨å¤§éƒ¨åˆ†ä¼ä¸šå…¬å¸çº¿ä¸Šå·¥ç¨‹è¿è¡Œçš„éƒ½æ˜¯centosç³»ç»Ÿï¼Œcentosä¸€èˆ¬ç”¨valgrindæ¥æ’æŸ¥ï¼Œæˆ‘ä¹‹å‰é‡åˆ°ä¸€ä¸ªå› ä¸ºtcpè¿æ¥çš„fdé‡åˆ°å¼‚å¸¸æƒ…å†µä¸‹æ²¡æœ‰closeå¯¼è‡´å†…å­˜æ³„éœ²ï¼Œä½†æ˜¯valgrindæ— æ³•æ£€æµ‹å‡ºæ¥ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹ä¸‹é‡åˆ°è¿™ç§æƒ…å†µä¸‹æ€ä¹ˆæ’æŸ¥","like_count":2},{"had_liked":false,"id":55596,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1546239728,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10136174320","product_id":100020901,"comment_content":"åšæŒåˆè¡·ï¼Œæ­»ç£•å°±è¡Œï¼Œä¸é€€ç¼©ï¼Œä¸æ”¾å¼ƒï¼","like_count":2,"discussions":[{"author":{"id":2348507,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/db/f59b288b.jpg","nickname":"é¢å¯¹ç–¾é£å§","note":"","ucode":"FB87423BB7AEE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343863,"discussion_content":"æ€ä¹ˆæ ·äº†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611198682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297755,"discussion_content":"çœ‹å®Œäº†å—  ä½ çš„flag","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597047767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358508,"user_name":"Geek_e2b0f9","can_delete":false,"product_type":"c1","uid":1602650,"ip_address":"åŒ—äº¬","ucode":"CAB31078DDB515","user_header":"","comment_is_top":false,"comment_ctime":1664369368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5959336664","product_id":100020901,"comment_content":"java jniæœ¬åœ°æ–¹æ³•å†…å­˜æ³„æ¼ æ€ä¹ˆå®šä½å…·ä½“ä½ç½® ä½¿ç”¨valgrind æœ‰éƒ¨åˆ†è¾“å‡ºæ˜¯â€œï¼Ÿï¼Ÿï¼Ÿâ€ æ˜¯æŒ‡å‘çš„.soä¸å¯¹å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":69645,"user_name":"å…ƒå¤©å¤«","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550801340,"is_pvip":false,"replies":[{"id":"24856","content":"4.4.7æ˜¯Red Hatäº§å“çš„ç‰ˆæœ¬ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯2.6.32","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1550851996,"ip_address":"","comment_id":69645,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5845768636","product_id":100020901,"comment_content":"è¿˜æœ‰ä¸€ä¸ªå¾ˆlowçš„é—®é¢˜ï¼ŒLinux version 2.6.32-504.23.4.el6.x86_64 (mockbuild@c6b9.bsys.dev.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-11)ï¼Œè¿™ä¸ªæ˜¯æˆ‘æŸ¥çœ‹çš„å†…æ ¸ä¿¡æ¯ï¼Œè¿™ä¸ªæ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬æ˜¯4.4.7å¯¹å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440201,"discussion_content":"4.4.7æ˜¯Red Hatäº§å“çš„ç‰ˆæœ¬ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯2.6.32","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550851996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009228,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/4c/39a6829c.jpg","nickname":"é¹","note":"","ucode":"243E408E2094E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49094,"discussion_content":"è¿™ä¸ª4.4.7 åº”è¯¥æ˜¯GCCçš„ç‰ˆæœ¬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573553746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69643,"user_name":"å…ƒå¤©å¤«","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550801076,"is_pvip":false,"replies":[{"id":"25330","content":"çœ‹åœºæ™¯ï¼Œæ¯”å¦‚ä¸€èˆ¬çš„I&#47;Oå¯†é›†å‹çš„åº”ç”¨ï¼Œè„é¡µå¤§ä¸€äº›å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼›ä½†æœ‰äº›æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ¯”ä»·é«˜çš„åº”ç”¨ï¼Œå¯èƒ½å¸Œæœ›å°½å¯èƒ½å¿«çš„å°†æ•°æ®è½ç›˜","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551193396,"ip_address":"","comment_id":69643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845768372","product_id":100020901,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œpmap -xä¸‹ï¼Œçœ‹åˆ°æœ‰çš„è¾“å‡ºé¡¹çš„è„é¡µæ•°æ¯”è¾ƒå¤§ï¼Œæœ‰104ä¸‡ï¼Œè¿™ä¸ªç®—å¤§å—","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440199,"discussion_content":"çœ‹åœºæ™¯ï¼Œæ¯”å¦‚ä¸€èˆ¬çš„I/Oå¯†é›†å‹çš„åº”ç”¨ï¼Œè„é¡µå¤§ä¸€äº›å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼›ä½†æœ‰äº›æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ¯”ä»·é«˜çš„åº”ç”¨ï¼Œå¯èƒ½å¸Œæœ›å°½å¯èƒ½å¿«çš„å°†æ•°æ®è½ç›˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61481,"user_name":"____çš„æˆ‘","can_delete":false,"product_type":"c1","uid":1061683,"ip_address":"","ucode":"8A4F5468136E48","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/33/30fb3ac3.jpg","comment_is_top":false,"comment_ctime":1547706428,"is_pvip":false,"replies":[{"id":"22571","content":"ä½ æ˜¯è¯´æ‰¾å‡ºåœ¨å“ªé‡Œåˆ†é…çš„ï¼Ÿè¿™ä¸ªåº”è¯¥æ²¡æœ‰åŠæ³•ï¼Œé™¤éè¿˜æ˜¯ç»§ç»­åœ¨ä¸åœçš„åˆ†é…å’Œé‡Šæ”¾ã€‚è¿™æ—¶å€™å¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548574113,"ip_address":"","comment_id":61481,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842673724","product_id":100020901,"comment_content":"è€å¸ˆ æˆ‘æœ‰ä¸€ä¸ªè¿›ç¨‹å†…å­˜ä½¿ç”¨è¶…å‡ºæ­£å¸¸èŒƒå›´ ç”¨pmapå‘½ä»¤çœ‹åˆ°æœ‰è¾ƒå¤š8mb 60mbçš„åŒ¿åå†…å­˜æ®µä½¿ç”¨ è¿™ä¸ªæœ‰ä»€ä¹ˆå¥½çš„æ–¹å¼å®šä½è¿™äº›å†…å­˜æ®µæ˜¯æ€ä¹ˆåˆ†é…æ¥çš„å—","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436884,"discussion_content":"ä½ æ˜¯è¯´æ‰¾å‡ºåœ¨å“ªé‡Œåˆ†é…çš„ï¼Ÿè¿™ä¸ªåº”è¯¥æ²¡æœ‰åŠæ³•ï¼Œé™¤éè¿˜æ˜¯ç»§ç»­åœ¨ä¸åœçš„åˆ†é…å’Œé‡Šæ”¾ã€‚è¿™æ—¶å€™å¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548574113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56964,"user_name":"ä»²é¬¼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1546588053,"is_pvip":false,"replies":[{"id":"22281","content":"æ²¡æœ‰ä¸“é—¨è®²å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸è¿‡å¾ˆå®¹æ˜“æŸ¥åˆ°å®ƒçš„ä½¿ç”¨æ‰‹å†Œ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548246149,"ip_address":"","comment_id":56964,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841555349","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œä¹‹å‰å“ªèŠ‚è¯¾è®²è¿‡pmapï¼Ÿå¹¶æ²¡æœ‰æ‰¾åˆ°","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435334,"discussion_content":"æ²¡æœ‰ä¸“é—¨è®²å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸è¿‡å¾ˆå®¹æ˜“æŸ¥åˆ°å®ƒçš„ä½¿ç”¨æ‰‹å†Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548246149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56717,"user_name":"æ±Ÿæ¹–ä¸­äºº","can_delete":false,"product_type":"c1","uid":1053485,"ip_address":"","ucode":"9E464AE9CC62EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/13/2d/ad1bfe92.jpg","comment_is_top":false,"comment_ctime":1546527087,"is_pvip":false,"replies":[{"id":"22277","content":"æ˜¯æœ‰é—®é¢˜ï¼Œå·²ç»åœ¨ä»£ç é‡Œé¢ä¿®å¤äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548245837,"ip_address":"","comment_id":56717,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841494383","product_id":100020901,"comment_content":"æœ‰ä¸ªç–‘é—®è¯·æ•™ä¸‹ï¼š<br>for (int n = 2; n &gt; 0; n++) {<br>        v = fibonacci(&amp;n0, &amp;n1);<br>        n0 = n1;<br>        n1 = *v;<br>        free(v);    &#47;&#47; é‡Šæ”¾å†…å­˜<br>        printf(&quot;%dth =&gt; %lld\\n&quot;, n, *v);<br>        sleep(1);<br>    }<br>è¿™æ®µä»£ç ä¸­ï¼Œåœ¨free(v)ä¹‹å¾Œï¼Œprintfä¸­ä»ç”¨åˆ°äº†vä¸­å­˜å‚¨çš„æ•°æ®ï¼Œä¸ä¼šæœ‰é—®é¢˜å—","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435191,"discussion_content":"æ˜¯æœ‰é—®é¢˜ï¼Œå·²ç»åœ¨ä»£ç é‡Œé¢ä¿®å¤äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548245837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56271,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1546414718,"is_pvip":false,"replies":[{"id":"20336","content":"è¿˜æ˜¯éœ€è¦ç•™ç€ï¼Œå»æ‰å°±ä¸å®¹æ˜“åŒºåˆ†æ³¨é‡Šã€å‘½ä»¤å’Œè¾“å‡ºäº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546445284,"ip_address":"","comment_id":56271,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841382014","product_id":100020901,"comment_content":"è€å¸ˆï¼Œä»£ç æ®µé‡Œé¢å¯å¦æŠŠ  ä»£ç å‰é¢çš„ $ æˆ– # å·ï¼Œå»æ‰ã€‚å¸¦ç€è¿˜çš„æ‰‹åŠ¨å»æ‰ä¸‹æ‰èƒ½æ‰§è¡Œä»£ç ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434969,"discussion_content":"è¿˜æ˜¯éœ€è¦ç•™ç€ï¼Œå»æ‰å°±ä¸å®¹æ˜“åŒºåˆ†æ³¨é‡Šã€å‘½ä»¤å’Œè¾“å‡ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56124,"user_name":"åˆ’æ—¶ä»£","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1546394396,"is_pvip":false,"replies":[{"id":"20268","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546423944,"ip_address":"","comment_id":56124,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5841361692","product_id":100020901,"comment_content":"memleakå¥½åƒè¦æ¯”valgrindè¿›è¡Œå†…å­˜æ³„æ¼æ£€æµ‹è¦æ–¹ä¾¿å¾ˆå¤šã€‚","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434939,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2039139,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/1d/63/35c38c6c.jpg","nickname":"dyh","note":"","ucode":"4E20FDA64495C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351564,"discussion_content":"memleakä½ å†…æ ¸å“ªä¸ªç‰ˆæœ¬å¼•è¿›çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614325961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55713,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1546266634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841233930","product_id":100020901,"comment_content":"è€å¸ˆè®²çš„éƒ½æ˜¯è¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„å†…å­˜é—®é¢˜ï¼Œæˆ‘æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆå¦‚æœæ˜¯è¿›ç¨‹é‡Œé¢æœ‰å¤šçº¿ç¨‹ï¼Œå¦‚æœæ€€ç–‘å‘ç”Ÿäº†å†…å­˜æ³„æ¼ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å¤„ç†æˆ–åˆ†æ","like_count":1},{"had_liked":false,"id":55511,"user_name":"æ¹–æ¹˜å¿—","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1546221622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841188918","product_id":100020901,"comment_content":"D18","like_count":1},{"had_liked":false,"id":348606,"user_name":"ä»£ç ä¸¸å­","can_delete":false,"product_type":"c1","uid":1161081,"ip_address":"","ucode":"E41351DEA2118D","user_header":"https://static001.geekbang.org/account/avatar/00/11/b7/79/a74d1e60.jpg","comment_is_top":false,"comment_ctime":1655253161,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1655253161","product_id":100020901,"comment_content":"å†…å­˜æ³„éœ²æ˜¯ä¸ªå¤æ‚çš„ä¸»é¢˜ï¼Œè€å¸ˆè¿™ä¸€ç« èŠ‚å¯ä»¥å†æ·±å…¥è®²è§£çš„ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šé‡åˆ°åƒæ–‡ç« ç¤ºä¾‹è¿™ä¹ˆç®€å•çš„æƒ…å†µï¼Œå·¥å…·ä¹Ÿæ˜¯æ£€æŸ¥ä¸å‡ºæ¥çš„","like_count":0},{"had_liked":false,"id":348275,"user_name":"Geek_f353f5","can_delete":false,"product_type":"c1","uid":3023982,"ip_address":"","ucode":"C25A04D9A2B2D5","user_header":"","comment_is_top":false,"comment_ctime":1654924428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654924428","product_id":100020901,"comment_content":"æ–‡ä¸­è¯´æ˜¯app.cæºç ä¸­æœªé‡Šæ”¾å†…å­˜å¯¼è‡´ï¼Œä½†æˆ‘çœ‹fixçš„dockerä¸­app.cä¸­ä¹Ÿæ²¡æœ‰æ·»åŠ free(v)é‡Šæ”¾å†…å­˜ï¼Œåˆ°åº•ä¿®å¤äº†å“ªé‡Œï¼Ÿ<br>root@lhtest01:~# docker ps<br>CONTAINER ID   IMAGE                     COMMAND   CREATED          STATUS          PORTS     NAMES<br>bcd836cb2fc9   feisky&#47;app:mem-leak-fix   &quot;&#47;app&quot;    11 minutes ago   Up 11 minutes             app<br>root@lhtest01:~# docker exec -it app cat app.c<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;pthread.h&gt;<br>#include &lt;unistd.h&gt;<br><br>long long *fibonacci(long long *n0, long long *n1)<br>{<br>\tlong long *v = (long long *) calloc(1024, sizeof(long long));<br>\t*v = *n0 + *n1;<br>\treturn v;<br>}<br><br>void *child(void *arg)<br>{<br>\tlong long n0 = 0;<br>\tlong long n1 = 1;<br>\tlong long *v = NULL;<br>\tfor (int n = 2; n &gt; 0; n++) {<br>\t\tv = fibonacci(&amp;n0, &amp;n1);<br>\t\tn0 = n1;<br>\t\tn1 = *v;<br>\t\tprintf(&quot;%dth =&gt; %lld\\n&quot;, n, *v);<br>\t\tsleep(1);<br>\t}<br>}<br><br><br>int main(void)<br>{<br>\tpthread_t tid;<br>\tpthread_create(&amp;tid, NULL, child, NULL);<br>\tpthread_join(tid, NULL);<br>\tprintf(&quot;main thread exit\\n&quot;);<br>\treturn 0;","like_count":0},{"had_liked":false,"id":345809,"user_name":"é£æ¸…æ‰¬","can_delete":false,"product_type":"c1","uid":2104708,"ip_address":"","ucode":"0505791F8EA497","user_header":"https://static001.geekbang.org/account/avatar/00/20/1d/84/c35e492e.jpg","comment_is_top":false,"comment_ctime":1652607340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652607340","product_id":100020901,"comment_content":"&#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;include&#47;linux&#47;compiler-clang.h:43:9: warning: &#39;__HAVE_BUILTIN_BSWAP16__&#39; macro redefined<br>      [-Wmacro-redefined]<br>#define __HAVE_BUILTIN_BSWAP16__<br>        ^<br>&lt;command line&gt;:3:9: note: previous definition is here<br>#define __HAVE_BUILTIN_BSWAP16__ 1<br>        ^<br>In file included from &#47;virtual&#47;main.c:2:<br>In file included from &#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;include&#47;uapi&#47;linux&#47;ptrace.h:153:<br>In file included from &#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;ptrace.h:5:<br>&#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;segment.h:255:2: error: expected &#39;(&#39; after &#39;asm&#39;<br>        alternative_io (&quot;lsl %[seg],%[p]&quot;,<br>        ^<br>&#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;alternative.h:247:2: note: expanded from macro &#39;alternative_io&#39;<br>        asm_inline volatile (ALTERNATIVE(oldinstr, newinstr, feature)   \\<br>        ^<br>&#47;lib&#47;modules&#47;5.17.7-1.el7.elrepo.x86_64&#47;build&#47;include&#47;linux&#47;compiler_types.h:281:24: note: expanded from macro &#39;asm_inline&#39;<br>#define asm_inline asm __inline<br><br>Linux 5.17.7-1.el7.elrepo.x86_64 x86_64<br><br>bccæŒ‰ç…§ä¸€ç›´å¤±è´¥","like_count":0},{"had_liked":false,"id":344789,"user_name":"Nevercome","can_delete":false,"product_type":"c1","uid":1489652,"ip_address":"","ucode":"E9C1EDDC0EC0B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/ba/f4/49389d0c.jpg","comment_is_top":false,"comment_ctime":1651768185,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651768185","product_id":100020901,"comment_content":"valgrind bcc çš„ memleak è¿˜æœ‰ Google çš„ leak sannitizerï¼Œè¿™äº›å·¥å…·çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢..","like_count":0},{"had_liked":false,"id":340117,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1648610564,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1648610564","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ç”¨memleakæ¥æ£€æµ‹php çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ‰“å°çš„éƒ½æ˜¯ unknown ,æœ‰ä»€ä¹ˆåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜å—","like_count":0},{"had_liked":false,"id":334230,"user_name":"ä¸äº†å³°","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1644822848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644822848","product_id":100020901,"comment_content":"è¯·æ•™ä¸€ä¸‹ï¼Œä¸æ˜¯æœ‰swap å—ï¼Œå†…åœ¨ä¸è¶³å°±äº¤æ¢åˆ°ç£ç›˜ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜ä¼š oomï¼Œæ— æ³•åˆ†é…å†…å­˜ã€‚<br>åœŸåœŸçš„é—®é¢˜ ï¼šï¼‰","like_count":0},{"had_liked":false,"id":324617,"user_name":"lanru666","can_delete":false,"product_type":"c1","uid":2796588,"ip_address":"","ucode":"83064A6AEDD34F","user_header":"https://static001.geekbang.org/account/avatar/00/2a/ac/2c/d2742c9a.jpg","comment_is_top":false,"comment_ctime":1638519840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638519840","product_id":100020901,"comment_content":"bccä¸€æ ·æŠ¥é”™ï¼Œgithubä¸Šæç¤ºè¦å¼€å¯CONFIG_KPROBE_EVENTS_ON_NOTRACEï¼Œè¦é‡æ–°ç¼–è¯‘å†…æ ¸<br>Enabling CONFIG_KPROBE_EVENTS_ON_NOTRACE probably the only solutiion, I guess.<br><br>https:&#47;&#47;github.com&#47;iovisor&#47;bcc&#47;issues&#47;2509<br>æŸ¥çœ‹æˆ‘çš„æœºå™¨CONFIG_KPROBE_EVENTS_ON_NOTRACEæœªå¼€å¯<br>cat config-5.11.0-41-generic|grep CONFIG_KPROBE_EVENTS_ON_NOTRACE<br># CONFIG_KPROBE_EVENTS_ON_NOTRACE is not set<br><br>è°ƒè¯•è¾“å‡º:<br> bcc.memleak  -p  $(pidof perf_examples)<br>Attaching to pid 1510059, Ctrl+C to quit.<br>cannot attach uprobe, Invalid argument<br>Traceback (most recent call last):<br>  File &quot;&#47;snap&#47;bcc&#47;159&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 449, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;snap&#47;bcc&#47;159&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 439, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;snap&#47;bcc&#47;159&#47;usr&#47;lib&#47;python3&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 1358, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe<br><br>æŸ¥çœ‹ç³»ç»Ÿè°ƒè¯•æ—¥å¿—<br>tail -f &#47;sys&#47;kernel&#47;debug&#47;tracing&#47;error_log<br><br>[196902.568409] trace_uprobe: error: Event name is too long<br>  Command: p:uprobes&#47;p__proc_1510059_root_usr_lib_x86_64_linux_gnu_libc_2_31_so_0x9d260_1510059_bcc_1511705 &#47;proc&#47;1510059&#47;root&#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libc-2.31.so:0x9d26","like_count":0},{"had_liked":false,"id":320065,"user_name":"robonix","can_delete":false,"product_type":"c1","uid":1212323,"ip_address":"","ucode":"866EC82EDA455B","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/a3/23540579.jpg","comment_is_top":false,"comment_ctime":1636074343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636074343","product_id":100020901,"comment_content":"ç”¨æ™ºèƒ½æŒ‡é’ˆå‘€","like_count":0},{"had_liked":false,"id":310493,"user_name":"shalan","can_delete":false,"product_type":"c1","uid":2698347,"ip_address":"","ucode":"14CB8531207892","user_header":"https://static001.geekbang.org/account/avatar/00/29/2c/6b/1b3e1c97.jpg","comment_is_top":false,"comment_ctime":1630679729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630679729","product_id":100020901,"comment_content":"æˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹è€å¸ˆï¼Œå¦‚æœæˆ‘å†…å­˜å°±æ˜¯ä¸å¤Ÿï¼Œæ¯”å¦‚2gï¼Œç³»ç»Ÿå°±æ˜¯ä¸å¤Ÿç”¨ï¼Œåº”ç”¨ç¨‹åºå¼€å¤šäº†ç³»ç»Ÿå°±ä¼šå¡æ­»ï¼Œè¿™ç§æƒ…å†µæˆ‘æ€ä¹ˆä¼˜åŒ–ç³»ç»Ÿä¸å¡æ­»ï¼Ÿæˆ–è€…è¯´æœ‰å“ªäº›å¸¸ç”¨æ‰‹æ®µè§„é¿è¿™ç§æƒ…å†µï¼Ÿè°¢è°¢","like_count":0},{"had_liked":false,"id":309435,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1630133489,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630133489","product_id":100020901,"comment_content":"è€å¸ˆï¼Œè¯¥å·¥å…·èƒ½å¯¼å‡ºæ–‡ä»¶ï¼Œæ”¾åˆ°æœ‰ç¯å¢ƒçš„æœºå™¨ä¸Šè¿›è¡ŒæŸ¥çœ‹åˆ†æçš„åŠæ³•å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":301513,"user_name":"ç«é”…å°ç‹å­","can_delete":false,"product_type":"c1","uid":1053262,"ip_address":"","ucode":"7D1BF39C437A99","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/4e/ff0702fc.jpg","comment_is_top":false,"comment_ctime":1625724768,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625724768","product_id":100020901,"comment_content":"è€å¸ˆ  è¿™æ˜¯æˆ‘çš„ç¯å¢ƒï¼š<br>Ubuntu 20.04.2 LTS (GNU&#47;Linux 5.4.0-73-generic x86_64)<br>å®‰è£…å®Œæ¯•åç›®å‰ç”¨åˆ°çš„å‘½ä»¤éƒ½ä¸æ”¯æŒï¼Œè¿™ä¸ªå¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;cachetop&quot;, line 261, in &lt;module&gt;<br>    curses.wrapper(handle_loop, args)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;curses&#47;wrapper.py&quot;, line 43, in wrapper<br>    return func(stdscr, *args, **kwds)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;cachetop&quot;, line 169, in handle_loop<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text","like_count":0},{"had_liked":false,"id":287193,"user_name":"è°¨å…®è°¨å…®","can_delete":false,"product_type":"c1","uid":1376885,"ip_address":"","ucode":"55712DD3852169","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","comment_is_top":false,"comment_ctime":1617809994,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617809994","product_id":100020901,"comment_content":"ä½ åº”è¯¥æƒ³åˆ°äº†ç”¨ top æˆ– ps æ¥è§‚å¯Ÿè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç„¶åæ‰¾å‡ºå†…å­˜ä½¿ç”¨ä¸€ç›´å¢é•¿çš„è¿›ç¨‹ï¼Œæœ€åå†é€šè¿‡ pmap æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒã€‚è¿™ä¸ªå…·ä½“æ€ä¹ˆæŸ¥  memleakç”Ÿäº§ç¯å¢ƒæ²¡æœ‰","like_count":0},{"had_liked":false,"id":283019,"user_name":"å°äº”","can_delete":false,"product_type":"c1","uid":1240616,"ip_address":"","ucode":"991063EF42D820","user_header":"https://static001.geekbang.org/account/avatar/00/12/ee/28/9a2ce9f4.jpg","comment_is_top":false,"comment_ctime":1615520644,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1615520644","product_id":100020901,"comment_content":"æˆ‘ä¸€ç›´mallocä¸ºä»€ä¹ˆå¢é•¿çš„æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œrssç¼ºæ²¡ä»€ä¹ˆå˜åŒ–","like_count":0,"discussions":[{"author":{"id":2616028,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","nickname":"å®å…¸","note":"","ucode":"63953F36596C28","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395344,"discussion_content":"mallocæ²¡æœ‰å®é™…åˆ†é…ç‰©ç†å†…å­˜ã€‚mallocçš„æ—¶å€™èµ‹å€¼ä¸€ä¸‹ï¼Œç¼ºé¡µå¼‚å¸¸æ‰ä¼šåˆ†é…ç‰©ç†å†…å­˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632288562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282914,"user_name":"æ˜Ÿè¾°å¤§æµ·","can_delete":false,"product_type":"c1","uid":2126441,"ip_address":"","ucode":"C11B75F3EF931E","user_header":"https://static001.geekbang.org/account/avatar/00/20/72/69/0a342bfe.jpg","comment_is_top":false,"comment_ctime":1615461429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615461429","product_id":100020901,"comment_content":"[wubozhen01@bm07v ~]$ sh &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -p 21294 -a<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 14: from: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 15: from: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 16: from: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 17: import: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 18: import: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 19: import: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 20: import: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 21: import: command not found<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 23: syntax error near unexpected token `(&#39;<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak: line 23: `class Allocation(object):&#39;<br><br>å®‰è£…bccåæ‰§è¡ŒæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸Šï¼Œè¯·è€å¸ˆçœ‹ä¸‹","like_count":0},{"had_liked":false,"id":281841,"user_name":"geek","can_delete":false,"product_type":"c1","uid":2401422,"ip_address":"","ucode":"FF0845140D72A9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","comment_is_top":false,"comment_ctime":1614920563,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614920563","product_id":100020901,"comment_content":"è€å¸ˆï¼Œåƒæ•°ç»„è®¿é—®è¶Šç•Œï¼Œä½†ç¨‹åºæ²¡æœ‰coreæ–‡ä»¶ è¿™ç§é—®é¢˜ï¼Œæœ‰ç›¸åº”çš„å·¥å…·å¯ä»¥ç”¨æ¥æ’æŸ¥å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":259135,"user_name":"Geek_42e1f8","can_delete":false,"product_type":"c1","uid":2292455,"ip_address":"","ucode":"4D8988EC5D1F63","user_header":"","comment_is_top":false,"comment_ctime":1604636386,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604636386","product_id":100020901,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæˆ‘ç”¨memleak -p $(pidof test1) -aè·Ÿè¸ªæ˜¾ç¤ºä¸åˆ°å…·ä½“çš„å‡½æ•°åå‘¢ã€‚ä¾‹å­å¾ˆç®€å•ï¼š<br>oid mem_leak_fun()<br>{<br>   for(int i=0;i&lt;100;i++)<br>   {<br>       char *p = new char;<br>   }<br><br>}<br><br>int main()<br>{<br>   int a = 0;<br>   sleep(10);<br>   <br>   mem_leak_fun();<br>   sleep(10);<br>   &#47;&#47;while(1);<br>}<br><br>æ˜¾ç¤ºå¦‚ä¸‹ï¼š<br>\taddr = 12917f0 size = 1<br>\taddr = 1291030 size = 1<br>\t100 bytes in 100 allocations from stack<br>\t\toperator new(unsigned long)+0x1d [libstdc++.so.6.0.19]<br>\t\tmain+0x31 [test1]<br>\t\t__libc_start_main+0xf5 [libc-2.17.so]<br>ç³»ç»Ÿæ˜¯centos7.8ï¼Œå†…æ ¸æ˜¯5.8.5ç‰ˆæœ¬ï¼Œè¯·é—®æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ<br><br>","like_count":0},{"had_liked":false,"id":257959,"user_name":"ç¨‹åºå‘˜å¤§å¤©åœ°","can_delete":false,"product_type":"c1","uid":1249001,"ip_address":"","ucode":"7A21F15FEE2D5B","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/e9/98b6ea61.jpg","comment_is_top":false,"comment_ctime":1604223774,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604223774","product_id":100020901,"comment_content":"memleak å·¥å…·æ‰¾ä¸å‡ºgolangä»£ç çš„å†…å­˜æ³„æ¼å—ï¼Ÿè¿›ç¨‹ç‰©ç†å†…å­˜ä¸€ç›´åœ¨ä¸Šæ¶¨ï¼Œæ²¡æœ‰ä¸‹é™ï¼Œä½†æ˜¯å·¥å…·æ˜¾ç¤ºæ²¡æœ‰å†…å­˜æ³„æ¼","like_count":0},{"had_liked":false,"id":257403,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1603959157,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603959157","product_id":100020901,"comment_content":"æ‰“å¡<br>åŠ¨æ€å†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼š<br>1ã€æ²¡æ­£ç¡®å›æ”¶åˆ†é…åçš„å†…å­˜ï¼Œå¯¼è‡´äº†æ³„æ¼ã€‚<br>ï¼ˆ1ï¼‰å †å†…å­˜ç”±åº”ç”¨ç¨‹åºè‡ªå·±æ¥åˆ†é…å’Œç®¡ç†ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾å †å†…å­˜ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼<br>ï¼ˆ2ï¼‰å†…å­˜æ˜ å°„æ®µï¼ŒåŒ…æ‹¬åŠ¨æ€é“¾æ¥åº“å’Œå…±äº«å†…å­˜ï¼Œå…¶ä¸­å…±äº«å†…å­˜ç”±ç¨‹åºåŠ¨æ€åˆ†é…å’Œç®¡ç†ã€‚å¦‚æœç¨‹åºåœ¨åˆ†é…åå¿˜äº†å›æ”¶ï¼Œå°±ä¼šå¯¼è‡´è·Ÿå †å†…å­˜ç±»ä¼¼çš„æ³„æ¼é—®é¢˜ã€‚<br>2ã€è®¿é—®çš„æ˜¯å·²åˆ†é…å†…å­˜è¾¹ç•Œå¤–çš„åœ°å€ï¼Œå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºï¼Œç­‰ç­‰ã€‚","like_count":0},{"had_liked":false,"id":255261,"user_name":"14155084066","can_delete":false,"product_type":"c1","uid":2245375,"ip_address":"","ucode":"EF5BFE8773578C","user_header":"https://static001.geekbang.org/account/avatar/00/22/42/ff/2a067d5d.jpg","comment_is_top":false,"comment_ctime":1603291575,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603291575","product_id":100020901,"comment_content":"æˆ‘é‡åˆ°çš„æœ€å¥‡è‘©çš„ä¸€ä¸ªoomé—®é¢˜æ˜¯c++ stlçš„å†…å­˜åˆ†é…è¡Œä¸ºã€‚ä½ç‰ˆæœ¬ç¼–è¯‘çš„c++ç¨‹åºåˆ†é…çš„å†…å­˜ä¸ä¼šè¢«å…¨éƒ¨é‡Šæ”¾ï¼Œåè€Œä¼šè¶Šæ¥è¶Šå¤§ã€‚è¿™ä¹Ÿä¸æ˜¯å†…å­˜æ³„éœ²ï¼Œæ˜¯æ•…æ„ä¸é‡Šæ”¾ï¼Œèµ·ç¼“å­˜ä½œç”¨ã€‚æ¢é«˜ç‰ˆæœ¬g++ç¼–è¯‘ï¼Œç¨‹åºç”¨åˆ°çš„vectorå°±ä¼šè¢«ç«‹å³é‡Šæ”¾ã€‚","like_count":0,"discussions":[{"author":{"id":1918112,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/44/a0/16d0d300.jpg","nickname":"ZHANGPING","note":"","ucode":"7108812981C996","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555887,"discussion_content":"stl åˆ†é…çš„å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ï¼Œè¿™ç§å¯ä»¥é‡‡ç”¨swapæ–¹å¼æ¥é¿å…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647092785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254957,"user_name":"ä¼Ÿå•Šä¼Ÿ","can_delete":false,"product_type":"c1","uid":1876981,"ip_address":"","ucode":"32F9F89668CF4E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/a3/f5/458d277b.jpg","comment_is_top":false,"comment_ctime":1603241568,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603241568","product_id":100020901,"comment_content":"çœ‹å®šä½æœ‰ä¸ªé—®é¢˜ã€‚ç”Ÿäº§ç¯å¢ƒå¾ˆå¤šéƒ½å—é™ã€‚æœ‰æ²¡æœ‰åŸç”Ÿå¯ç”¨çš„å·¥å…·å‘¢ï¼Ÿæœ€å¥½æ˜¯ centos ç¯å¢ƒä¸‹çš„ã€‚æ¯•ç«Ÿç”Ÿäº§ç¯å¢ƒä¸å¯æ”¹å˜","like_count":0},{"had_liked":false,"id":253490,"user_name":"ç¨‹åºå‘˜å¤§å¤©åœ°","can_delete":false,"product_type":"c1","uid":1249001,"ip_address":"","ucode":"7A21F15FEE2D5B","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/e9/98b6ea61.jpg","comment_is_top":false,"comment_ctime":1602752607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602752607","product_id":100020901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒLinux è¿›ç¨‹VIRT&#47;RESä¸€ç›´åœ¨å‡é«˜ï¼Œä½†æ˜¯ç”¨memleakå·¥å…·åˆ†ææ˜¯æ²¡æœ‰æ³„æ¼ï¼Œpmapå·¥å…·çœ‹æœ‰å¾ˆå¤šdirtyé¡¹ï¼Œè¿˜æœ‰ä¸‹ä¸€æ­¥çš„åˆ†ææ–¹å‘å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":246298,"user_name":"west","can_delete":false,"product_type":"c1","uid":2080899,"ip_address":"","ucode":"B42BF349E55900","user_header":"https://static001.geekbang.org/account/avatar/00/1f/c0/83/ca1c44d5.jpg","comment_is_top":false,"comment_ctime":1599270189,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1599270189","product_id":100020901,"comment_content":"memleak ç†è§£æ˜¯ä¸æ˜¯åªèƒ½çœ‹åˆ°å†…å­˜åˆ†é…çš„è°ƒç”¨æ ˆï¼Œå¹¶ä¸èƒ½æ£€æµ‹å†…å­˜æ³„æ¼äº†ï¼Ÿ<br>æ¯”å¦‚å¦‚ä¸‹ï¼š<br><br>  for(int i=0; i &lt; 100; ++i){<br>    ptrarr[i] = (int*)malloc(4);<br>    ++i;<br>    sleep(1);<br>  }<br>  for(int i=0; i &lt; 100; ++i){<br>    if (ptrarr[i] != NULL) {<br>      free(ptrarr[i]);<br>    }<br>  }<br>ä½¿ç”¨memleakçš„æ—¶ï¼Œä¼šè¾“å‡º<br>addr = 7fd6f8000980 size = 4<br>        addr = 7fd6f80009a0 size = 4<br>        addr = 7fd6f8000960 size = 4<br>        addr = 7fd6f8000940 size = 4<br>        16 bytes in 4 allocations from stack<br>                child2(void*)+0x1f [app]<br>                start_thread+0xc5 [libpthread-2.17.so]<br><br>ä½†æ˜¯ç¨‹åºå¹¶æ²¡æœ‰å†…å­˜æ³„éœ²äº†å‘€","like_count":0,"discussions":[{"author":{"id":2616028,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","nickname":"å®å…¸","note":"","ucode":"63953F36596C28","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395348,"discussion_content":"memleakæœ‰ä¸ªå‚æ•°ï¼Œ-oå‚æ•°ï¼š\nTo avoid false positives, allocations younger than a certain age (500ms by\ndefault) are not printed. To change this threshold, use the -o switch.\n\né»˜è®¤500msã€‚åˆ†é…è¶…è¿‡500msæœªé‡Šæ”¾çš„ä¼šæ‰“å°å¤„ç†ã€‚ ä½ å¯ä»¥è°ƒè¯•-oå‚æ•°è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632289054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242376,"user_name":"per","can_delete":false,"product_type":"c1","uid":2112515,"ip_address":"","ucode":"DC156A3C7AA1BD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLpuXh4ibibw0eAZyW8Yqd51ictib0fLS2rd69ictFVibBBmEDuaYDuoJIT6Glh045BthwJL3S6gDQkQicwA/132","comment_is_top":false,"comment_ctime":1597705281,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597705281","product_id":100020901,"comment_content":"è€å¸ˆï¼Œmemleakå·¥å…·å¦‚ä½•å®‰è£…","like_count":0},{"had_liked":false,"id":239057,"user_name":"èŒ¶åšå£«","can_delete":false,"product_type":"c1","uid":1543320,"ip_address":"","ucode":"2E49324AC13DA9","user_header":"https://static001.geekbang.org/account/avatar/00/17/8c/98/ddd4513c.jpg","comment_is_top":false,"comment_ctime":1596424012,"is_pvip":false,"replies":[{"id":"88793","content":"æ˜¯ä¸æ˜¯å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒè€å¯¼è‡´çš„ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1596978070,"ip_address":"","comment_id":239057,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596424012","product_id":100020901,"comment_content":"é‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼Œè¯·è€å¸ˆå¸®å¿™è§£ç­”<br>[root@localhost ~]# &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p $(pidof app)<br>Attaching to pid 25180, Ctrl+C to quit.<br>perf_event_open(&#47;sys&#47;kernel&#47;debug&#47;tracing&#47;events&#47;uprobes&#47;p__lib_x86_64_linux_gnu_libc_2_27_so_0x97070_25180_bcc_32282&#47;id): Invalid argument<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 441, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 431, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 1015, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502960,"discussion_content":"æ˜¯ä¸æ˜¯å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒè€å¯¼è‡´çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596978070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238280,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1596110158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596110158","product_id":100020901,"comment_content":"ä½¿ç”¨æ ˆå†…å­˜","like_count":0},{"had_liked":false,"id":238236,"user_name":"Dayu","can_delete":false,"product_type":"c1","uid":1132370,"ip_address":"","ucode":"6926EDC6FB1A90","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/52/1a3201c9.jpg","comment_is_top":false,"comment_ctime":1596099740,"is_pvip":false,"replies":[{"id":"88784","content":"æ˜¯ä¸æ˜¯å†…æ ¸ç‰ˆæœ¬å¤ªè€äº†ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1596977298,"ip_address":"","comment_id":238236,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1596099740","product_id":100020901,"comment_content":"could not open bpf map: stack_traces, error: Invalid argument<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 411, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br>è€å¸ˆå•Šï¼Œæˆ‘è¿™ä¸ªæ˜¯æ€ä¹ˆå›äº‹å•Šï¼Œåœ¨ç½‘ä¸Šä¹Ÿæ²¡æ‰¾éƒ½æ–¹æ³•","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502680,"discussion_content":"æ˜¯ä¸æ˜¯å†…æ ¸ç‰ˆæœ¬å¤ªè€äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596977298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368711,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œä½ çš„é—®é¢˜è§£å†³äº†å—\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618813517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367531,"discussion_content":"è¯·é—®é—®é¢˜è§£å†³äº†å—?\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618388583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236107,"user_name":"ç”Ÿæ´»ä¸å¦‚è¯—","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1595318411,"is_pvip":false,"replies":[{"id":"87246","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1595342556,"ip_address":"","comment_id":236107,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595318411","product_id":100020901,"comment_content":"ç”¨æˆ·ç©ºé—´å†…å­˜åŒ…æ‹¬å¤šä¸ªå†…å­˜æ®µï¼š<br>\t1. åªè¯»æ®µï¼›åªè¯»æ®µï¼ŒåŒ…æ‹¬ç¨‹åºçš„ä»£ç å’Œå¸¸é‡ï¼Œç”±äºæ˜¯åªè¯»çš„ï¼Œä¸ä¼šå†å»åˆ†é…æ–°çš„å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚<br>\t2. å †ï¼šå †å†…å­˜ç”±åº”ç”¨ç¨‹åºè‡ªå·±æ¥åˆ†é…å’Œç®¡ç†ã€‚é™¤éç¨‹åºé€€å‡ºï¼Œè¿™äº›å †å†…å­˜å¹¶ä¸ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œæ˜¯éœ€è¦åº”ç”¨ç¨‹åºæ˜ç¡®è°ƒç”¨åº“å‡½æ•° free() æ¥é‡Šæ”¾å®ƒä»¬ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®é‡Šæ”¾å †å†…å­˜ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚<br>\t3. æ ˆï¼šæ ˆå†…å­˜ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œç®¡ç†ã€‚ä¸€æ—¦ç¨‹åºè¿è¡Œè¶…å‡ºäº†è¿™ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸï¼Œæ ˆå†…å­˜å°±ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å›æ”¶ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„é—®é¢˜<br>\t4. æ–‡ä»¶æ˜ å°„ï¼šåŒ…æ‹¬åŠ¨æ€é“¾æ¥åº“å’Œå…±äº«å†…å­˜ï¼Œå…¶ä¸­å…±äº«å†…å­˜ç”±ç¨‹åºåŠ¨æ€åˆ†é…å’Œç®¡ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœç¨‹åºåœ¨åˆ†é…åå¿˜äº†å›æ”¶ï¼Œå°±ä¼šå¯¼è‡´è·Ÿå †å†…å­˜ç±»ä¼¼çš„æ³„æ¼é—®é¢˜ã€‚<br>\t5. æ•°æ®æ®µï¼šæ•°æ®æ®µï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†å¤§å°ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚<br>æ ¹æ®ä»¥ä¸Šå†…å®¹ï¼Œèƒ½å¤Ÿå¼•èµ·å†…å­˜æº¢å‡ºçš„åŒ…æ‹¬å †å†…å­˜ï¼Œæ–‡ä»¶æ˜ å°„åŒº<br><br>åˆ†æå†…å­˜æŒç»­å¢é•¿çš„æ€è·¯ï¼š<br>1. é€šè¿‡vmstatè§‚å¯Ÿå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå†…å­˜ä½¿ç”¨ç‡ä¸€ç›´å¢é«˜ï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³äº†ï¼›<br>2. é€šè¿‡topæŠ“å–å†…å­˜ä½¿ç”¨ç‡æœ€é«˜çš„åº”ç”¨ï¼Œåˆ†æRESæƒ…å†µï¼›<br>3. é€šè¿‡memleak -a -p {pid}æŠ“å–è¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ†æå¯¼è‡´å†…å­˜æº¢å‡ºçš„å‡½æ•°ï¼›<br>4. åˆ†ææºä»£ç ï¼Œæ‰¾åˆ°å¹¶ä¿®å¤é—®é¢˜ï¼›","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501946,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235275,"user_name":"Geek_9815f1","can_delete":false,"product_type":"c1","uid":2068424,"ip_address":"","ucode":"34EE8566A53F10","user_header":"","comment_is_top":false,"comment_ctime":1594957276,"is_pvip":false,"replies":[{"id":"87273","content":"å¯ä»¥ï¼Œä¸è¿‡å®ƒä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼š<br>1ï¼‰è¦æ±‚å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒæ–°ã€‚<br>2ï¼‰åŠŸèƒ½ç‰¹æ€§æ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬è¿˜éœ€è¦äºŒæ¬¡å¼€å‘ï¼Œå¢åŠ è‡ªå·±éœ€è¦çš„åŠŸèƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1595344526,"ip_address":"","comment_id":235275,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594957276","product_id":100020901,"comment_content":"è€å¸ˆï¼Œ è¿™memleak é€‚åˆåœ¨å¤§å‹äº’è”ç½‘çš„åº”ç”¨ç¨‹åºç”¨å—ï¼Ÿ æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”¨gperftools å·¥å…·çš„","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501671,"discussion_content":"å¯ä»¥ï¼Œä¸è¿‡å®ƒä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼š\n1ï¼‰è¦æ±‚å†…æ ¸ç‰ˆæœ¬æ¯”è¾ƒæ–°ã€‚\n2ï¼‰åŠŸèƒ½ç‰¹æ€§æ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬è¿˜éœ€è¦äºŒæ¬¡å¼€å‘ï¼Œå¢åŠ è‡ªå·±éœ€è¦çš„åŠŸèƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595344526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226493,"user_name":"charmingz","can_delete":false,"product_type":"c1","uid":1032248,"ip_address":"","ucode":"ECE330B93ABCB0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/38/e2139556.jpg","comment_is_top":false,"comment_ctime":1592121715,"is_pvip":false,"replies":[{"id":"86953","content":"å¯èƒ½æ˜¯å†…æ ¸ç‰ˆæœ¬ä¸æ»¡è¶³è¦æ±‚ï¼Œä½ çš„å†…æ ¸æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1594995553,"ip_address":"","comment_id":226493,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1592121715","product_id":100020901,"comment_content":"å°è¯•äº†å„ç§æ–¹æ³•ï¼Œmemleakè¿˜æ˜¯æ— æ³•æ­£å¸¸è·‘èµ·æ¥ï¼Œä¸€ç›´æŠ¥é”™ï¼š<br>could not open bpf map: events, error: Operation not permitted<br>Traceback (most recent call last):<br>  File &quot;.&#47;opensnoop&quot;, line 180, in &lt;module&gt;<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 325, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498262,"discussion_content":"å¯èƒ½æ˜¯å†…æ ¸ç‰ˆæœ¬ä¸æ»¡è¶³è¦æ±‚ï¼Œä½ çš„å†…æ ¸æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594995553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367794,"discussion_content":"å†…æ ¸æ˜¯4.4.0-116-generic.è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618470948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209483,"user_name":"liebzz","can_delete":false,"product_type":"c1","uid":1434970,"ip_address":"","ucode":"0378507E7F50F4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZJjl8bEt5zdqufZ304Ra0QlibJv9cljd3ek9x8nWvOoVOaRJPKiayY9TmUDxa9wGeq7KibX7H9P1iaHjib01pJpNGog/132","comment_is_top":false,"comment_ctime":1587557771,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587557771","product_id":100020901,"comment_content":"è€å¸ˆï¼š<br>æˆ‘æœ‰ä¸ªå…³äºOOMçš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä¸€å°æœåŠ¡å™¨éƒ¨ç½²äº†MySQLæ•°æ®åº“ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼Œbuff&#47;cacheå ç”¨äº†å¤§é‡å†…å­˜ï¼Œavailableæ˜¾ç¤ºè¿˜æœ‰102Gï¼Œæœ‰å¯èƒ½å‘ç”ŸOOMå—ï¼Ÿ<br>                   total        used        free      shared  buff&#47;cache   available<br>Mem:           125G         18G        512M        4.2G        106G        102G<br>Swap:          511M        186M        325M","like_count":0},{"had_liked":false,"id":207225,"user_name":"ç—å­èƒ¥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1587028931,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587028931","product_id":100020901,"comment_content":"è€å¸ˆï¼Œä½ è¿™ä¸ªä¾‹å­æ˜¯å·²ç»çŸ¥é“å“ªä¸ªè¿›ç¨‹æœ‰å†…å­˜æ³„éœ²äº†ï¼Œè¯·é—®å¦‚ä½•æ‰¾å‡ºå“ªä¸ªè¿›ç¨‹å‘¢ï¼Ÿ<br><br>ä½œè€…å›å¤: å»æ‰è¿›ç¨‹å·é€‰é¡¹<br><br>å»æ‰è¿›ç¨‹å· ç›´æ¥æ˜¾ç¤ºè¿æ¥çš„éƒ½æ˜¯å†…æ ¸çš„ä¸œè¥¿äº† è¿˜æ˜¯æŸ¥ä¸åˆ°å“ªä¸ªè¿›ç¨‹å¯¼è‡´å†…å­˜æ³„éœ²å•Š","like_count":0},{"had_liked":false,"id":193830,"user_name":"linker","can_delete":false,"product_type":"c1","uid":1803259,"ip_address":"","ucode":"6C5799F2FC2C82","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","comment_is_top":false,"comment_ctime":1584971384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584971384","product_id":100020901,"comment_content":"æˆ‘è§‰å¾—å¯ä»¥æŒ‡å®šfibonacciï¼ˆï¼‰ç¬¬ä¸‰ä¸ªå‚æ•°è¿”å›vï¼Œè¿™æ ·åœ¨childé‡Œé¢åˆ†é…ä¸freeå†…å®¹ä¸å®¹æ˜“å¿˜è®°ï¼Œæ˜¯ä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":191861,"user_name":"å®‹èƒ–èƒ–","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1584800843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584800843","product_id":100020901,"comment_content":"å¦‚ä½•å®‰è£…bccè½¯ä»¶åŒ…","like_count":0},{"had_liked":false,"id":189236,"user_name":"æ±Ÿæ¹–å¤œé›¨","can_delete":false,"product_type":"c1","uid":1204399,"ip_address":"","ucode":"CC05C505FE1072","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLG44I6sZyAQWjJEibZhJ94Kdel6ljHialNWtk7p71mLUdNiaTnYCcg3lKy8mIyibALRtf75DgjMf2yQw/132","comment_is_top":false,"comment_ctime":1584492177,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584492177","product_id":100020901,"comment_content":"è€å¸ˆå’¨è¯¢ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒ32gå†…å­˜ï¼Œfree -mæŸ¥çœ‹  cachedå äº†24gï¼Œfreeå‰©äº†200m, å¦‚ä½•å®šä½æ˜¯å“ªä¸ªè¿›ç¨‹å¯¼è‡´çš„cachedå¦‚æ­¤ä¹‹å¤§","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"ç½—è¾‘æ€ç»´","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220665,"discussion_content":"ä¸“æ æè¿‡æ²¡åŠæ³•å®šä½åˆ°å…·ä½“ä½¿ç”¨buffer/cachedçš„è¿›ç¨‹ã€‚TOPå‘½ä»¤å†æŒ‰ä¸‹å¤§å†™MæŒ‰ç…§å†…å­˜æ’åºï¼Œå‚è€ƒä¸‹RESæŒ‡æ ‡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585913993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188321,"user_name":"åˆ˜å‹æ·™","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1584339923,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584339923","product_id":100020901,"comment_content":"D8 æ‰“å¡","like_count":0},{"had_liked":false,"id":183078,"user_name":"é£˜äº‘","can_delete":false,"product_type":"c1","uid":1446494,"ip_address":"","ucode":"C6FE0310D6853C","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/5e/77b67a85.jpg","comment_is_top":false,"comment_ctime":1582949111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582949111","product_id":100020901,"comment_content":"é™¤äº†å·¥å…·ï¼Œè€å¸ˆæœ‰æ²¡æœ‰å…¶ä»–åˆ†æå†…å­˜æ³„éœ²çš„æ€è·¯å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":178118,"user_name":"tangerrine","can_delete":false,"product_type":"c1","uid":1218944,"ip_address":"","ucode":"CAAD6274C5570C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/VQniaFZTiagBQPZpH6sZY0pfBWoqAdyibCcoRAVAukSHA76MicMJIsXrCjLYL6Orv1sxHIsBw9ViaN4yibE810HUT62A/132","comment_is_top":false,"comment_ctime":1581589978,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581589978","product_id":100020901,"comment_content":"æˆ‘çœ‹å¾ˆå¤šåŒå­¦ç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ¯”è¾ƒæ™®éï¼Œéº»çƒ¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼š<br>ç³»ç»Ÿæ˜¯ubuntu 18.04ï¼Œå†…æ ¸ç‰ˆæœ¬5.3.0-28ï¼Œå†…æ ¸å·²å¼€å¯CONFIG_UPROBE_EVENTSã€‚<br>è¿è¡Œfeisky&#47;app:mem-leakä»¥åï¼Œmemleak -a -p $(pidof app)çœ‹ä¸åˆ°å†…å­˜æ³„éœ²çš„æƒ…å†µ<br>ä½†ç”¨memleak -a èƒ½çœ‹åˆ°å¾ˆå¤škernelçš„å†…å­˜åˆ†é…","like_count":0},{"had_liked":false,"id":172686,"user_name":"ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1579251765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579251765","product_id":100020901,"comment_content":"è€å¸ˆå†™çš„å¤ªå¥½äº†","like_count":0},{"had_liked":false,"id":157177,"user_name":"ouyangsheng","can_delete":false,"product_type":"c1","uid":1000623,"ip_address":"","ucode":"4D16DA1493453B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/af/79cb724c.jpg","comment_is_top":false,"comment_ctime":1575073790,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575073790","product_id":100020901,"comment_content":"å †ä¸­çš„å†…å­˜å“ªäº›æƒ…å†µæ²¡æœ‰freeåˆ°ï¼Ÿ1æœ‰äº›æ‰§è¡Œè·¯å¾„æ²¡è€ƒè™‘åˆ°ï¼Œ2ç¬¬ä¸‰æ–¹åº“å‡½æ•°éšå«äº†mallocï¼Œ3å¤šçº¿ç¨‹è·¯å¾„ã€‚å¯ä»¥ç”¨vmstatï¼Œä»¥åŠbccä¸­memleakæ£€æµ‹ã€‚","like_count":0},{"had_liked":false,"id":148468,"user_name":"é»„å±•å¿—","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1573012431,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1573012431","product_id":100020901,"comment_content":"[root@app180-110 tools]# memleak -a -p `pidof app`<br>Attaching to pid 24550, Ctrl+C to quit.<br>perf_event_open(&#47;sys&#47;kernel&#47;debug&#47;tracing&#47;events&#47;uprobes&#47;p__lib_x86_64_linux_gnu_libc_2_27_so_0x97070_24550_bcc_24813&#47;id): Invalid argument<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 424, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 414, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 992, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe<br>[root@app180-110 tools]# cat &#47;etc&#47;redhat-release <br>CentOS Linux release 7.6.1810 (Core) <br>[root@app180-110 tools]# uname -a<br>Linux app180-110 3.10.0-957.12.2.el7.x86_64 #1 SMP Tue May 14 21:24:32 UTC 2019 x86_64 x86_64 x86_64 GNU&#47;Linux<br><br><br>å€ªè€å¸ˆï¼Œæˆ‘çš„ç¯å¢ƒæ˜¯è¿™ä¸ªï¼Œè¿è¡Œmemleakå‡ºé”™äº†ï¼Œåœ¨ç½‘ä¸Šä¹Ÿæ‰¾ä¸åˆ°ç­”æ¡ˆï¼Œéº»çƒ¦å¸®çœ‹çœ‹","like_count":0,"discussions":[{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"é»„å±•å¿—","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45346,"discussion_content":"ä¸€å®šè¦å†…æ ¸ä¸­å¼€å¯ CONFIG_UPROBE_EVENTS=y ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573026123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133252,"user_name":"scorpiozj","can_delete":false,"product_type":"c1","uid":1031677,"ip_address":"","ucode":"C66EA76809F9BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bd/fd/3f5d5db5.jpg","comment_is_top":false,"comment_ctime":1568465018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568465018","product_id":100020901,"comment_content":"å’¨è¯¢ä¸‹ï¼Œmemleakè¿è¡Œåå‡ºé”™ï¼Œæç¤ºå¦‚ä¸‹ï¼š<br><br># &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a<br>Attaching to kernel allocators, Ctrl+C to quit.<br>[20:40:08] Top 10 stacks with outstanding allocations:<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 538, in &lt;module&gt;<br>    print_outstanding()<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 482, in print_outstanding<br>    show_module=True, show_offset=True))<br>  File &quot;&#47;usr&#47;lib&#47;python3.4&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 1251, in sym<br>    offset = b&quot;+0x%x&quot; % offset if show_offset and name is not None else b&quot;&quot;<br>TypeError: unsupported operand type(s) for %: &#39;bytes&#39; and &#39;int&#39;<br><br>googleä¸‹æ²¡æœ‰æ‰¾åˆ°æ€è·¯ï¼Œç³»ç»Ÿä¿¡æ¯ï¼š<br>cat &#47;proc&#47;version<br>Linux version 5.2.11-1.el7.elrepo.x86_64 (mockbuild@Build64R7) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)) #1 SMP Thu Aug 29 08:10:52 EDT 2019","like_count":0},{"had_liked":false,"id":126391,"user_name":"å—å®«è½©è¯º","can_delete":false,"product_type":"c1","uid":1364939,"ip_address":"","ucode":"4A62D2895DA857","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVwuRvAuze6NsLGr4qwVa7IJcib3YdQVqlicuEicP8FmGR2qo8Wia1BXtnnbVeDxH41EkLmOmNiac5nQQ/132","comment_is_top":false,"comment_ctime":1566379685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566379685","product_id":100020901,"comment_content":"å€ªè€å¸ˆï¼Œæœ‰å‡ ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼š1ï¼‰ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œå‘ç”Ÿoom-killçš„åˆ¤æ–­æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯freeå‘½ä»¤çœ‹åˆ°çš„å¯ç”¨å†…å­˜ä¸è¶³å—ï¼Ÿå¦‚æœä¸€ä¸ªè¿›ç¨‹topçœ‹åˆ°çš„RESå†…å­˜å¾ˆå¤§ï¼Œä½†æ˜¯freeçœ‹åˆ°çš„å¯ç”¨å†…å­˜è¿˜æœ‰å¾ˆå¤šï¼Œè¯¥è¿›ç¨‹åº”è¯¥ä¸ä¼šè¢«killå§     2ï¼‰æŒ‚è½½ç½‘ç»œç£ç›˜çš„ioè´Ÿè½½çŠ¶æ€åº”è¯¥å¦‚ä½•æŸ¥çœ‹å‘¢ï¼Œiostatçœ‹ä¸åˆ°   3ï¼‰æŒ‚è½½ç½‘ç»œç›˜æ˜¯å¦ä¹Ÿå­˜åœ¨ç¼“å­˜å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":121848,"user_name":"afterdream","can_delete":false,"product_type":"c1","uid":1619795,"ip_address":"","ucode":"701AD039459191","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/53/823f647c.jpg","comment_is_top":false,"comment_ctime":1565234008,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565234008","product_id":100020901,"comment_content":"ã€è¯¾åé¢˜ã€‘<br>æˆ‘ä¸€ç›´å¾ˆå°‘ä½¿ç”¨mallocï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯æŒ‡é’ˆ+æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´å®šä¹‰ä¸€ä¸ª1024å¤§å°çš„æ•°ç»„ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªæŒ‡å‘è¯¥æ•°ç»„çš„æŒ‡é’ˆï¼Œå¦‚æœé‡åˆ°å¾ªç¯ï¼Œæˆ‘å°±ä¼šé€šè¿‡è°ƒæ•´æŒ‡é’ˆæŒ‡å‘ï¼Œé˜²æ­¢æŒ‡é’ˆéæ³•ã€‚","like_count":0},{"had_liked":false,"id":120623,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564963302,"is_pvip":true,"replies":[{"id":"44392","content":"kernel-develå®‰è£…äº†å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1565014654,"ip_address":"","comment_id":120623,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1564963302","product_id":100020901,"comment_content":"ä»Šå¤©åˆé‡æ–°å®‰è£…bccè¯•äº†ä¸€æ¬¡ï¼Œè¿˜æ˜¯é‚£ä¸ªé—®é¢˜<br>[root@VM_0_17_centos tools]# .&#47;cachetop<br>Traceback (most recent call last):<br>  File &quot;.&#47;cachetop&quot;, line 263, in &lt;module&gt;<br>    curses.wrapper(handle_loop, args)<br>  File &quot;&#47;usr&#47;lib64&#47;python2.7&#47;curses&#47;wrapper.py&quot;, line 43, in wrapper<br>    return func(stdscr, *args, **kwds)<br>  File &quot;.&#47;cachetop&quot;, line 171, in handle_loop<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 318, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br>ç‰ˆæœ¬å†…æ ¸ï¼š<br>5.2.5-1.el7.elrepo.x86_64","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461408,"discussion_content":"kernel-develå®‰è£…äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565014654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618206,"avatar":"","nickname":"yayuyo","note":"","ucode":"1A4BE4F0DE675B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4947,"discussion_content":"ä¸çŸ¥é“åŸpoæ˜¯å¦å·²ç»è§£å†³ï¼Œæˆ‘ä¸ªäººä¹Ÿé‡åˆ°è¿™é—®é¢˜ï¼Œç³»ç»Ÿä½¿ç”¨ubuntu 14.04 LTSï¼Œkernelæ›´æ–°åˆ°4.8.0å°±å¯ä»¥ä½¿ç”¨ã€‚å¯ä»¥å˜—è©¦ä»¥ä¸‹æŒ‡ä»¤ï¼š\n$ sudo apt-get install linux-image-4.8.0-46-generic \n$ sudo update-initramfs -u -k all\n$ sudo reboot","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565856361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120467,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564908299,"is_pvip":true,"replies":[{"id":"44395","content":"è¯•è¯•å®‰è£…kernel-devel","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1565014692,"ip_address":"","comment_id":120467,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564908299","product_id":100020901,"comment_content":"è¿˜æ˜¯bccå¾—é—®é¢˜ï¼Œè£…ä¸Šè¿è¡Œå°±æŠ¥é”™<br>[root@VM_0_17_centos tools]# .&#47;cachetop<br>Traceback (most recent call last):<br>  File &quot;.&#47;cachetop&quot;, line 263, in &lt;module&gt;<br>    curses.wrapper(handle_loop, args)<br>  File &quot;&#47;usr&#47;lib64&#47;python2.7&#47;curses&#47;wrapper.py&quot;, line 43, in wrapper<br>    return func(stdscr, *args, **kwds)<br>  File &quot;.&#47;cachetop&quot;, line 171, in handle_loop<br>    b = BPF(text=bpf_text)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 318, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461346,"discussion_content":"è¯•è¯•å®‰è£…kernel-devel","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565014692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120460,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564907178,"is_pvip":true,"replies":[{"id":"44409","content":"æ£€æŸ¥ä¸‹å®‰è£…çš„ kernel-devel è·Ÿè¿è¡Œå†…æ ¸çš„ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1565016382,"ip_address":"","comment_id":120460,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1564907178","product_id":100020901,"comment_content":"æ¯æ¬¡éƒ½è¦æŠ¥è¿™ä¸ªé”™ï¼Œæ— è®ºyumå®‰è£…è¿˜æ˜¯ç¼–è¯‘å®‰è£…éƒ½è¦æŠ¥è¿™ä¸ªé”™<br>root@VM_0_17_centos tools]# .&#47;cachestat<br>In file included from &lt;built-in&gt;:3:<br>In file included from &#47;virtual&#47;include&#47;bcc&#47;helpers.h:23:<br>In file included from &#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;include&#47;linux&#47;log2.h:12:<br>In file included from &#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;include&#47;linux&#47;bitops.h:19:<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;bitops.h:209:9: error: &#39;asm goto&#39; constructs are not supported yet<br>        return GEN_BINARY_RMWcc(LOCK_PREFIX __ASM_SIZE(bts), *addr, c, &quot;Ir&quot;, nr);<br>               ^<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;rmwcc.h:60:32: note: expanded from macro &#39;GEN_BINARY_RMWcc&#39;<br>#define GEN_BINARY_RMWcc(X...) RMWcc_CONCAT(GEN_BINARY_RMWcc_, RMWcc_ARGS(X))(X)<br>                               ^<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;rmwcc.h:10:28: note: expanded from macro &#39;RMWcc_CONCAT&#39;<br>#define RMWcc_CONCAT(a, b) __RMWcc_CONCAT(a, b)<br>                           ^<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;rmwcc.h:9:30: note: expanded from macro &#39;__RMWcc_CONCAT&#39;<br>#define __RMWcc_CONCAT(a, b) a ## b<br>                             ^<br>note: (skipping 2 expansions in backtrace; use -fmacro-backtrace-limit=0 to see all)<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;rmwcc.h:54:2: note: expanded from macro &#39;GEN_BINARY_RMWcc_6&#39;<br>        __GEN_RMWcc(op &quot; %[val], &quot; arg0, var, cc,                       \\<br>        ^<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;arch&#47;x86&#47;include&#47;asm&#47;rmwcc.h:21:2: note: expanded from macro &#39;__GEN_RMWcc&#39;<br>        asm_volatile_goto (fullop &quot;; j&quot; #cc &quot; %l[cc_label]&quot;             \\<br>        ^<br>&#47;lib&#47;modules&#47;5.2.5-1.el7.elrepo.x86_64&#47;build&#47;include&#47;linux&#47;compiler_types.h:187:37: note: expanded from macro &#39;asm_volatile_goto&#39;<br>#define asm_volatile_goto(x...) asm goto(x)<br>                                    ^<br>In file included from &lt;built-in&gt;:3:","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461343,"discussion_content":"æ£€æŸ¥ä¸‹å®‰è£…çš„ kernel-devel è·Ÿè¿è¡Œå†…æ ¸çš„ç‰ˆæœ¬æ˜¯ä¸€è‡´çš„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565016382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611745,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","nickname":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","note":"","ucode":"BD92741A11D3CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3991,"discussion_content":"ä½†æ˜¯æˆ‘æ²¡æ‰¾åˆ° kernl-devel 5.2.5 è¿™ä¸ªç‰ˆæœ¬çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565050071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611745,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","nickname":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","note":"","ucode":"BD92741A11D3CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3990,"discussion_content":"ä¸æ˜¯ï¼Œç°åœ¨æ˜¯ uname -r\n5.2.5-1.el7.elrepo.x86_64","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565050019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119931,"user_name":"suke","can_delete":false,"product_type":"c1","uid":1007753,"ip_address":"","ucode":"C0287C31A4F45B","user_header":"","comment_is_top":false,"comment_ctime":1564733060,"is_pvip":false,"replies":[{"id":"44401","content":"è£¸æœºå’Œè™šæ‹Ÿæœºéƒ½é€‚ç”¨çš„ï¼Œä¹Ÿæœ‰ä¸å°‘ç¯‡å¹…éƒ½æåˆ°äº†å®¹å™¨çš„å¤„ç†æ–¹æ³•ï¼ˆæ¯•ç«Ÿæˆ‘ä»¬çš„å¾ˆå¤šæ¡ˆä¾‹éƒ½æ˜¯åŸºäºå®¹å™¨çš„ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1565015240,"ip_address":"","comment_id":119931,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564733060","product_id":100020901,"comment_content":"è€å¸ˆ,çœ‹äº†æ‚¨å¥½å¤šç‰‡æ–‡ç« ,æ‚¨çš„å¯¹é—®é¢˜çš„å¤„ç†æ–¹æ³•éƒ½æ˜¯åŸºäºè£¸æœºçš„,ç°åœ¨å…¬å¸å¥½å¤šéƒ½æ˜¯åŸºäºå®¹å™¨,åŸºäºè™šæ‹Ÿç¯å¢ƒçš„,å¥½å¤šå‘½ä»¤å’Œå·¥å…·ä¸æ˜¯é‚£ä¹ˆèµ·ä½œç”¨,èƒ½ä¸èƒ½è¿™æ–¹é¢å¤šå†™ä¸€äº›","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461136,"discussion_content":"è£¸æœºå’Œè™šæ‹Ÿæœºéƒ½é€‚ç”¨çš„ï¼Œä¹Ÿæœ‰ä¸å°‘ç¯‡å¹…éƒ½æåˆ°äº†å®¹å™¨çš„å¤„ç†æ–¹æ³•ï¼ˆæ¯•ç«Ÿæˆ‘ä»¬çš„å¾ˆå¤šæ¡ˆä¾‹éƒ½æ˜¯åŸºäºå®¹å™¨çš„ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117038,"user_name":"åˆºçŒ¬","can_delete":false,"product_type":"c1","uid":1201479,"ip_address":"","ucode":"79685DAB7020C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/47/c412f973.jpg","comment_is_top":false,"comment_ctime":1563958320,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563958320","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæˆ‘å°è¯•äº†app-fixçš„é•œåƒï¼Œå†…å­˜æ³„æ¼çš„é—®é¢˜æ²¡æœ‰äº†ï¼Œä½†æ˜¯è²Œä¼¼é‡Œé¢çš„app.cæ²¡æœ‰å˜ï¼Œæ²¡æœ‰æ·»åŠ freeå‡½æ•°ã€‚","like_count":0},{"had_liked":false,"id":107859,"user_name":"Romantic","can_delete":false,"product_type":"c1","uid":1349815,"ip_address":"","ucode":"DCA26BBE4B4489","user_header":"https://static001.geekbang.org/account/avatar/00/14/98/b7/c8a179c2.jpg","comment_is_top":false,"comment_ctime":1561624903,"is_pvip":false,"replies":[{"id":"39097","content":"æ–‡ä¸­ç®€å•æäº†ä¸€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨topæˆ–è€…topæ‰¾å‡ºå†…å­˜å¢é•¿çš„è¿›ç¨‹ï¼Œmemleakä¸åŠ è¿›ç¨‹å·ä¹Ÿå¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1561647909,"ip_address":"","comment_id":107859,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1561624903","product_id":100020901,"comment_content":"æ‰§è¡Œå®Œvmstatï¼Œä»‹ç»å®Œmemleakè¿™ä¸ªå‘½ä»¤ï¼Œç›´æ¥å°±åˆ†æäº†app(&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -p $(pidof app),è€å¸ˆå¹¶æ²¡æœ‰è®²è§£å¦‚ä½•åˆ†æå®šä½æ˜¯appå¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œè¿™ä¸ªåœ°æ–¹å¾ˆè’™","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455710,"discussion_content":"æ–‡ä¸­ç®€å•æäº†ä¸€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨topæˆ–è€…topæ‰¾å‡ºå†…å­˜å¢é•¿çš„è¿›ç¨‹ï¼Œmemleakä¸åŠ è¿›ç¨‹å·ä¹Ÿå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561647909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2348507,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/db/f59b288b.jpg","nickname":"é¢å¯¹ç–¾é£å§","note":"","ucode":"FB87423BB7AEE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331785,"discussion_content":"top ç„¶åå¤§å†™Må¯ä»¥æŒ‰ç…§å†…å­˜æ¥æ’åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606976842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107051,"user_name":"Geek_638ba5","can_delete":false,"product_type":"c1","uid":1579914,"ip_address":"","ucode":"B395689CA7CF3C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlN0AUA3CiaZzorL5Jq1oWPqxOYJwBxnHETFQ7DQFwA7EpQS5tS6mCHribW0rnsyFia88Z0eyqqNYdA/132","comment_is_top":false,"comment_ctime":1561448946,"is_pvip":true,"replies":[{"id":"40453","content":"ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æä¾›ä¸€ä¸ªmetricsæ¥å£ï¼Œæ–¹ä¾¿åœ¨å¤–éƒ¨å®æ—¶æŸ¥è¯¢å®ƒçš„å†…å­˜åˆ†é…æƒ…å†µ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1562511844,"ip_address":"","comment_id":107051,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1561448946","product_id":100020901,"comment_content":"è€å¸ˆ æœ‰ä¸ªé—®é¢˜è®¨è®ºä¸‹<br>æˆ‘ä»¬çš„ç¯å¢ƒè·‘äº†ä¸€ä¸ªhttpçš„ç¼“å­˜è¿›ç¨‹ï¼Œå½“å¤§é‡httpè¯·æ±‚è¿‡æ¥æ—¶å€™ï¼Œç¼“å­˜è¿›ç¨‹çš„å†…å­˜ä¸€ç›´åœ¨æ¶¨ï¼Œå³ä½¿ç¼“å­˜è¿‡æœŸäº†ä¹Ÿæ²¡æœ‰æ˜æ˜¾é™ä¸‹å»ã€‚ å¯¹äºè¿™ç§å®ˆæŠ¤è¿›ç¨‹çš„æƒ…å†µï¼Œå¦‚ä½•åˆ¤æ–­å†…å­˜å¢é•¿ç©¶ç«Ÿæ˜¯ç”±äºå†…å­˜æ³„æ¼è¿˜æ˜¯å†…å­˜ç¢ç‰‡è¿˜æ˜¯å…¶ä»–åŸå› ï¼Ÿ(æ­¤æ¡ˆä¾‹ä¸­valgrindä¸å¯ç”¨ï¼Œå› ä¸ºè¿™ä¸ªè¿›ç¨‹æ˜¯fork()ä¹‹åè°ƒç”¨exec()äº§ç”Ÿçš„ï¼Œè€Œvalgrindä¸æ”¯æŒæ­¤ç§æƒ…å†µå¤šè¿›ç¨‹çš„è¿½è¸ª)","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455341,"discussion_content":"ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æä¾›ä¸€ä¸ªmetricsæ¥å£ï¼Œæ–¹ä¾¿åœ¨å¤–éƒ¨å®æ—¶æŸ¥è¯¢å®ƒçš„å†…å­˜åˆ†é…æƒ…å†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562511844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2055993,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/5f/39/8d2c61d3.jpg","nickname":"Kiddy","note":"","ucode":"D07AAEE69BE504","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290045,"discussion_content":"Mallocä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä»è€Œå¼•èµ·å“ªæ€•è½¯ä»¶é‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿæ— æ³•å›æ”¶ã€‚è¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡tcmallocè§£å†³ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594308982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104000,"user_name":"croco","can_delete":false,"product_type":"c1","uid":1174302,"ip_address":"","ucode":"F6EA7616724881","user_header":"https://static001.geekbang.org/account/avatar/00/11/eb/1e/cbd63297.jpg","comment_is_top":false,"comment_ctime":1560586359,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560586359","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼šmemleak æ— æ³•è¿è¡Œï¼Œæ— æ³•æŸ¥çœ‹å¸®åŠ©ï¼Œæˆ‘æ˜¯ç”¨yum install gcc gcc-toolså®‰è£…çš„<br>[root@VM_0_17_centos ~]# memleak <br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 14, in &lt;module&gt;<br>    from bcc import BPF<br>ModuleNotFoundError: No module named &#39;bcc&#39;<br>[root@VM_0_17_centos ~]# <br>[root@VM_0_17_centos ~]# uname -a<br>Linux VM_0_17_centos 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU&#47;Linux<br>","like_count":0},{"had_liked":false,"id":102229,"user_name":"ğŸ’–æäº¬æ½¼ğŸ’–","can_delete":false,"product_type":"c1","uid":1284775,"ip_address":"","ucode":"8337BC784D9674","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/a7/51cf1a9e.jpg","comment_is_top":false,"comment_ctime":1560165046,"is_pvip":false,"replies":[{"id":"37083","content":"ä¸€èˆ¬æ˜¯ç¼ºå°‘è°ƒè¯•ä¿¡æ¯å¯¼è‡´çš„ã€‚å¯ä»¥çœ‹çœ‹æ˜¯ä¸æ˜¯åº”ç”¨ç¨‹åºæŠŠè°ƒè¯•ä¿¡æ¯ä¼˜åŒ–æ‰äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1560259163,"ip_address":"","comment_id":102229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560165046","product_id":100020901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ€è¿‘ç”¨æ‚¨æœ¬èŠ‚è¯¾æåˆ°çš„memleakæŸ¥äº†æˆ‘ä»¬é¡¹ç›®ä¸­çš„å†…å­˜æ³„æ¼çš„æƒ…å†µï¼ŒæœåŠ¡æ˜¯ç›´æ¥è·‘åœ¨ubuntu18.04ä¸­çš„ï¼Œæ²¡æœ‰ä½¿ç”¨dockerï¼Œä½†å…¶ä¸­è¿˜æ˜¯æœ‰ä¸€äº›ã€unknownã€‘ï¼Œæƒ³è¯·æ•™ä¸€ä¸‹è¿™äº›unknownè¯¥å¦‚ä½•å»åˆ†æï¼Œå…¶ä»–çš„å°±å¾ˆæ˜æ˜¾æ˜¯åŠ¨æ€åº“ä¸­çš„mallocå¯¼è‡´çš„ã€‚è°¢è°¢è€å¸ˆï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        62976 bytes in 8 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]<br>                [unknown]<br>                [unknown]<br>        670923 bytes in 24 allocations from stack<br>                av_buffer_realloc+0x160 [libqcap.x64.164.so]<br>        3284580 bytes in 633 allocations from stack<br>                av_malloc+0x60 [libqcap.x64.164.so]","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453300,"discussion_content":"ä¸€èˆ¬æ˜¯ç¼ºå°‘è°ƒè¯•ä¿¡æ¯å¯¼è‡´çš„ã€‚å¯ä»¥çœ‹çœ‹æ˜¯ä¸æ˜¯åº”ç”¨ç¨‹åºæŠŠè°ƒè¯•ä¿¡æ¯ä¼˜åŒ–æ‰äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560259163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91513,"user_name":"å°è´_No_7","can_delete":false,"product_type":"c1","uid":1063224,"ip_address":"","ucode":"84C39D64EF04C3","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/38/4c962666.jpg","comment_is_top":false,"comment_ctime":1557046342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557046342","product_id":100020901,"comment_content":"memleak -a -p 4493<br>Attaching to pid 4493, Ctrl+C to quit.<br>[16:38:27] Top 10 stacks with outstanding allocations:<br>[16:38:32] Top 10 stacks with outstanding allocations:<br>[16:38:37] Top 10 stacks with outstanding allocations:<br><br>å¥½åƒæœ‰äººé—®è¿‡è¿™ä¸ªé—®é¢˜äº†ã€‚æˆ‘è¿™è¾¹æ²¡æœ‰è¾“å‡ºã€‚ä½†æ˜¯å¦‚æœä¸æŒ‡å®š-pä»¥åŠè¿›ç¨‹å·, è¿˜æ˜¯èƒ½ç›‘æ§åˆ°å…¶ä»–çš„ã€‚é—®é¢˜å°±åœ¨äºæŒ‡å®šè¿›ç¨‹å°±ä¸è¡Œã€‚å¯¹äº†æˆ‘çš„ç¯å¢ƒä¹Ÿæ˜¯ubuntu18.04. ","like_count":0},{"had_liked":false,"id":91034,"user_name":"æ«æ—å±…å£«","can_delete":false,"product_type":"c1","uid":1134586,"ip_address":"","ucode":"1BDC77B9F7FC8C","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/fa/921a2a38.jpg","comment_is_top":false,"comment_ctime":1556810975,"is_pvip":false,"replies":[{"id":"33122","content":"ä»€ä¹ˆç‰ˆæœ¬çš„å†…æ ¸ï¼Ÿæ³¨æ„ bcc éœ€è¦æ–°ç‰ˆæœ¬çš„å†…æ ¸æ‰å¯ä»¥ä½¿ç”¨(4.1)","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1557325737,"ip_address":"","comment_id":91034,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1556810975","product_id":100020901,"comment_content":"Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 401, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 318, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br>æŠ¥çš„æ˜¯è¿™ä¸ªé”™ï¼Œè€å¸ˆè¯·é—®ä¸‹è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448771,"discussion_content":"ä»€ä¹ˆç‰ˆæœ¬çš„å†…æ ¸ï¼Ÿæ³¨æ„ bcc éœ€è¦æ–°ç‰ˆæœ¬çš„å†…æ ¸æ‰å¯ä»¥ä½¿ç”¨(4.1)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557325737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367805,"discussion_content":"https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md\n\nä¸Šé¢é“¾æ¥é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹:\nPre-alloc map memory by default \t4.6 \t6c9059817432\n\nåº”è¯¥æ˜¯è¯´æ˜  4.6å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨.\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618471928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90997,"user_name":"zhang","can_delete":false,"product_type":"c1","uid":1517047,"ip_address":"","ucode":"650C292030057B","user_header":"https://static001.geekbang.org/account/avatar/00/17/25/f7/4cc60573.jpg","comment_is_top":false,"comment_ctime":1556778895,"is_pvip":false,"replies":[{"id":"33124","content":"ä¸€èˆ¬æ˜¯ç”¨é daemon æ–¹å¼å¯åŠ¨æ¥è°ƒè¯•","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1557326034,"ip_address":"","comment_id":90997,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556778895","product_id":100020901,"comment_content":"æ‰“å¡ç¬¬4å¤©ã€‚<br><br>è€å¸ˆï¼Œè¯·é—®valgrindå¦‚ä½•è°ƒè¯•æ°¸ä¸é€€å‡ºçš„è¿›ç¨‹å‘¢ï¼Ÿ  å°±æ¯”å¦‚nginxçš„workerè¿›ç¨‹ï¼Œvalgrindéœ€è¦è¿›ç¨‹ä¸­æŒ‡ï¼Œæ‰å›è¿›è¡Œç»Ÿè®¡å§ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448756,"discussion_content":"ä¸€èˆ¬æ˜¯ç”¨é daemon æ–¹å¼å¯åŠ¨æ¥è°ƒè¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557326034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88736,"user_name":"ä¸ç³»ä¹‹èˆŸ","can_delete":false,"product_type":"c1","uid":1005689,"ip_address":"","ucode":"EC10937D9C031A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/79/e7bbd28e.jpg","comment_is_top":false,"comment_ctime":1555988027,"is_pvip":true,"replies":[{"id":"31957","content":"å‡çº§å†…æ ¸å°±æœ‰äº†ï¼Œ4.11ä»¥å","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1556113713,"ip_address":"","comment_id":88736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555988027","product_id":100020901,"comment_content":"é‡åˆ°åŒæ ·çš„æŠ¥é”™ï¼šException: Failed to attach BPF to uprobe<br>debian9 ä¸‹åªæœ‰CONFIG_UPROBE_EVENTï¼Œè€Œæ²¡æœ‰CONFIG_UPROBE_EVENTS<br>cat &#47;boot&#47;config-4.9.0-3-amd64 | grep UPROBE<br>CONFIG_ARCH_SUPPORTS_UPROBES=y<br>CONFIG_UPROBES=y<br>CONFIG_UPROBE_EVENT=y","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447885,"discussion_content":"å‡çº§å†…æ ¸å°±æœ‰äº†ï¼Œ4.11ä»¥å","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556113713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87721,"user_name":"åå­91","can_delete":false,"product_type":"c1","uid":1000884,"ip_address":"","ucode":"68E792FB90CDDA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/b4/afa76165.jpg","comment_is_top":false,"comment_ctime":1555670341,"is_pvip":false,"replies":[{"id":"31672","content":"memleak æ˜¯æ£€æµ‹å†…å­˜æ³„æ¼çš„å †æ ˆï¼Œfibonacciæ˜¯æ ˆé¡¶çš„å‡½æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1555856014,"ip_address":"","comment_id":87721,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555670341","product_id":100020901,"comment_content":"è€å¸ˆï¼Œâ€è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç»ˆäºçœ‹åˆ°äº†å†…å­˜åˆ†é…çš„è°ƒç”¨æ ˆï¼ŒåŸæ¥æ˜¯ fibona...â€œè¿™é‡Œå¦‚ä½•çœ‹åˆ°æ˜¯è¿™å‡½æ•°æœªé‡Šæ”¾å‘¢ï¼Ÿè¾“å‡ºå¯å¦è§£é‡Šä¸‹å‘¢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447577,"discussion_content":"memleak æ˜¯æ£€æµ‹å†…å­˜æ³„æ¼çš„å †æ ˆï¼Œfibonacciæ˜¯æ ˆé¡¶çš„å‡½æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555856014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78691,"user_name":"woniu","can_delete":false,"product_type":"c1","uid":1427802,"ip_address":"","ucode":"95FB0A660D759D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIe7XMR0W1B8wWNm18KvfMyLUaMLdsD8bcvfhjpN3tRCuBFTE1Mr3ibdNq54t9QgZe4Hv8WC0Ikpaw/132","comment_is_top":false,"comment_ctime":1553218928,"is_pvip":false,"replies":[{"id":"29064","content":"syscallä¸ä¸€å®šå›å¯¼è‡´ç”¨æˆ·æ€CPUå‡é«˜ã€‚å»ºè®®ä½¿ç”¨perfåˆ†æä¸‹çƒ­ç‚¹å‡½æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1553527455,"ip_address":"","comment_id":78691,"utype":1}],"discussion_count":1,"race_medal":4,"score":"1553218928","product_id":100020901,"comment_content":"æœ€è¿‘åœ¨çº¿ä¸Šé‡åˆ°ç”¨æˆ·æ€cpuå¾ˆé«˜çš„é—®é¢˜ã€‚apache+phpçš„ç¯å¢ƒï¼Œç”¨strace è¿½è¸ªå‘ç°80%ä»¥ä¸Šçš„ç³»ç»Ÿsyscalléƒ½æ˜¯brk,ä½†æ˜¯ç³»ç»Ÿçš„å†…å­˜å ç”¨å¾ˆä½å¹¶ä¸”å¾ˆå¹³ç¨³ã€‚æ€€ç–‘æ˜¯phpä»£ç é€ æˆçš„å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯apacheå›æ”¶äº†å†…å­˜ã€‚è¯·è€å¸ˆæŒ‡ç‚¹ä¸€ä¸‹ï¼","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444192,"discussion_content":"syscallä¸ä¸€å®šå›å¯¼è‡´ç”¨æˆ·æ€CPUå‡é«˜ã€‚å»ºè®®ä½¿ç”¨perfåˆ†æä¸‹çƒ­ç‚¹å‡½æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553527455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76158,"user_name":"äºç«¶","can_delete":false,"product_type":"c1","uid":1219827,"ip_address":"","ucode":"4A74417B0727A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/f3/e01dfe3a.jpg","comment_is_top":false,"comment_ctime":1552539354,"is_pvip":true,"replies":[{"id":"28056","content":"å¯ä»¥è¯•è¯• ngx_debug_pool æ¨¡å—æˆ–è€… pmap çœ‹çœ‹å †æ ˆï¼Œå½“ç„¶æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯åœ¨å¼€å‘ç¯å¢ƒé‡ç°åå†è¿›è¡Œåˆ†æ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1552750519,"ip_address":"","comment_id":76158,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552539354","product_id":100020901,"comment_content":"ç›®å‰é‡åˆ°ä¸€ä¸ªç–‘ä¼¼å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼šnginxä»£ç†è¿è¡Œåå†…å­˜ä¼šä¸æ–­çš„å‡å°‘ï¼›æ¯æ¬¡reloadä¹‹åï¼Œå†…å­˜åˆä¼šé‡Šæ”¾ã€‚ç”±äºæœåŠ¡å™¨ä¹Ÿä¸èƒ½éšä¾¿å‡çº§å†…æ ¸å®‰è£…memleakç­‰è¿™äº›é¢å¤–å·¥å…·ï¼Œç›®å‰ä¹Ÿè¿˜æ²¡å®šä½åˆ°å…·ä½“åŸå› åœ¨å“ªã€‚æ€€ç–‘æ˜¯ä¸æ˜¯å› ä¸ºnginxé…ç½®ä¸­æœ‰äº›å˜é‡èµ‹å€¼å’Œifåˆ¤æ–­çš„é…ç½®å¯¼è‡´çš„ã€‚æƒ³è¯·æ•™ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½ç»™äº›æ€è·¯ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443203,"discussion_content":"å¯ä»¥è¯•è¯• ngx_debug_pool æ¨¡å—æˆ–è€… pmap çœ‹çœ‹å †æ ˆï¼Œå½“ç„¶æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯åœ¨å¼€å‘ç¯å¢ƒé‡ç°åå†è¿›è¡Œåˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552750519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69986,"user_name":"missing","can_delete":false,"product_type":"c1","uid":1316598,"ip_address":"","ucode":"3FC438D387779A","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/f6/b864cf41.jpg","comment_is_top":false,"comment_ctime":1550927255,"is_pvip":false,"replies":[{"id":"25342","content":"å—¯å—¯ï¼Œæœ‰äº›ç‰¹æ€§éœ€è¦æ–°ç‰ˆæœ¬çš„å†…æ ¸æ‰æ”¯æŒã€‚å…·ä½“çš„å†…æ ¸ç‰ˆæœ¬æ”¯æŒå¯ä»¥å‚è€ƒå®ƒçš„æ–‡æ¡£ https:&#47;&#47;github.com&#47;iovisor&#47;bcc&#47;blob&#47;master&#47;docs&#47;kernel-versions.md","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551194466,"ip_address":"","comment_id":69986,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1550927255","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼æˆ‘çš„ç³»ç»Ÿæ˜¯ubuntu 14.04,å†…æ ¸ç‰ˆæœ¬æ˜¯4.4.0-31-genericï¼Œå¯ä»¥è·‘cachetop,cachestatï¼Œä½†ä¸€è·‘memleakå°±ä¼šæŠ¥é”™ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š<br>oot@ubuntu:~# memleak -a -p $(pidof mysqld)<br>&#47;virtual&#47;main.c:18:1: error: could not open bpf map: Invalid argument<br>is maps&#47;stacktrace map type enabled in your kernel?<br>BPF_STACK_TRACE(stack_traces, 10240);<br>^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:220:3: note: expanded from macro &#39;BPF_STACK_TRACE&#39;<br>  BPF_TABLE(&quot;stacktrace&quot;, int, struct bpf_stacktrace, _name, roundup_pow_of_two(_max_entries))<br>  ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:75:76: note: expanded from macro &#39;BPF_TABLE&#39;<br>#define BPF_TABLE(_table_type, _key_type, _leaf_type, _name, _max_entries) \\<br>                                                                           ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:71:4: note: expanded from macro &#39;\\<br>BPF_F_TABLE&#39;<br>}; \\<br>   ^<br>&#47;virtual&#47;main.c:83:25: error: bpf_table stack_traces failed to open<br>        info.stack_id = stack_traces.get_stackid(ctx, BPF_F_REUSE_STACKID|BPF_F_USER_STACK);<br>                        ^<br>2 errors generated.<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 394, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 320, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br><br>è¯·é—®æ˜¯ä»€ä¹ˆåŸå› å‘¢?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440387,"discussion_content":"å—¯å—¯ï¼Œæœ‰äº›ç‰¹æ€§éœ€è¦æ–°ç‰ˆæœ¬çš„å†…æ ¸æ‰æ”¯æŒã€‚å…·ä½“çš„å†…æ ¸ç‰ˆæœ¬æ”¯æŒå¯ä»¥å‚è€ƒå®ƒçš„æ–‡æ¡£ https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367803,"discussion_content":"https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md\n\nä¸Šé¢é“¾æ¥é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹:\nPre-alloc map memory by default \t4.6 \t6c9059817432\n\nåº”è¯¥æ˜¯è¯´æ˜  4.6å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨.\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618471870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64582,"user_name":"é£ä¸€æ ·çš„ç”·å­","can_delete":false,"product_type":"c1","uid":1357985,"ip_address":"","ucode":"F02E87D5630DAB","user_header":"","comment_is_top":false,"comment_ctime":1548828936,"is_pvip":false,"replies":[{"id":"22981","content":"ä¹Ÿæ˜¯æœ‰çš„ï¼Œä½†ä¸å®Œå…¨ä¸€æ ·ï¼Œæ¯”å¦‚ jprofiler ä¹‹ç±»çš„å·¥å…·","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548943540,"ip_address":"","comment_id":64582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548828936","product_id":100020901,"comment_content":"è€å¸ˆï¼Œjava webåº”ç”¨æœ‰æ²¡æœ‰ç±»ä¼¼memleakå¯ä»¥å®šä½ä»£ç çš„å¥½ç”¨å·¥å…·ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438085,"discussion_content":"ä¹Ÿæ˜¯æœ‰çš„ï¼Œä½†ä¸å®Œå…¨ä¸€æ ·ï¼Œæ¯”å¦‚ jprofiler ä¹‹ç±»çš„å·¥å…·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548943540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64283,"user_name":"marvinren","can_delete":false,"product_type":"c1","uid":1325147,"ip_address":"","ucode":"F7F7EEE0ED7588","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/5b/26539a0b.jpg","comment_is_top":false,"comment_ctime":1548734065,"is_pvip":false,"replies":[{"id":"22968","content":"æ„Ÿè§‰åº”è¯¥è¿˜æœ‰å…¶ä»–è¿›ç¨‹åœ¨æ“ä½œå†…å­˜ã€‚è¿™ä¸ªæ¡ˆä¾‹å†…å­˜æ³„æ¼çš„æ¯”è¾ƒæ…¢ï¼Œå¦‚æœæœ‰å…¶ä»–å¤§é‡åˆ†é…å’Œå›æ”¶å†…å­˜çš„åº”ç”¨ï¼Œé‚£ç”¨ vmstat å°±è§‚å¯Ÿä¸æ˜æ˜¾äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548942380,"ip_address":"","comment_id":64283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548734065","product_id":100020901,"comment_content":"æˆ‘åœ¨è¯•ç”¨é˜¿é‡Œäº‘å‘ç°å†…å­˜å¹¶æ²¡æœ‰å‡å°‘ï¼Œè¿™æ˜¯å› ä¸ºæœ‰å…¶ä»–æœºåˆ¶ä¿æŠ¤å†…å­˜æ³„éœ²äº†ä¹ˆï¼Ÿ<br>root@iZhp35alkngu5crtmh4wjaZ:~&#47;mylab# vmstat 5<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 6445872 692400 810976    0    0  1351     7   15    4  0  1 98  1  0<br> 0  0      0 6444344 692400 810996    0    0     0     2  579 1071  1  2 97  0  0<br> 0  0      0 6444348 692400 810968    0    0     0     2  644 1177  1  2 96  0  0<br> 0  0      0 6462500 692400 810976    0    0     0     3  610 1048  1  2 97  0  0<br> 0  0      0 6462876 692400 810976    0    0     0     2  663 1131  1  2 97  0  0<br> 0  0      0 6462692 692400 810996    0    0     0     3  644 1088  1  2 97  0  0<br> 0  0      0 6462496 692404 810988    0    0     0     2  662 1186  1  2 97  0  0<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437937,"discussion_content":"æ„Ÿè§‰åº”è¯¥è¿˜æœ‰å…¶ä»–è¿›ç¨‹åœ¨æ“ä½œå†…å­˜ã€‚è¿™ä¸ªæ¡ˆä¾‹å†…å­˜æ³„æ¼çš„æ¯”è¾ƒæ…¢ï¼Œå¦‚æœæœ‰å…¶ä»–å¤§é‡åˆ†é…å’Œå›æ”¶å†…å­˜çš„åº”ç”¨ï¼Œé‚£ç”¨ vmstat å°±è§‚å¯Ÿä¸æ˜æ˜¾äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548942380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64253,"user_name":"å¹³å°‘","can_delete":false,"product_type":"c1","uid":1218742,"ip_address":"","ucode":"EC76D35D0C2CBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/b6/0c0ed771.jpg","comment_is_top":false,"comment_ctime":1548727205,"is_pvip":false,"replies":[{"id":"22967","content":"æ˜¯ç”¨çš„ centos å—ï¼Ÿçœ‹èµ·æ¥è·Ÿ https:&#47;&#47;github.com&#47;iovisor&#47;bcc&#47;issues&#47;1530#issuecomment-358035538 æ¯”è¾ƒåƒ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1548942083,"ip_address":"","comment_id":64253,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1548727205","product_id":100020901,"comment_content":"è€å¸ˆï¼Œå¸®å¿™çœ‹ä¸‹æˆ‘çš„memleakè¿è¡ŒæŠ±ç€ä¸ªé”™è¯¯è¯·é—®æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Œå†…æ ¸æ˜¯4.20çš„<br>[root@localhost sa]# memleak <br>&#47;virtual&#47;main.c:291:70: error: no member named &#39;page&#39; in &#39;struct tracepoint__kmem__mm_page_alloc&#39;<br>        return gen_alloc_exit2((struct pt_regs *)args, (size_t)args-&gt;page);<br>                                                               ~~~~  ^<br>&#47;virtual&#47;main.c:300:69: error: no member named &#39;page&#39; in &#39;struct tracepoint__kmem__mm_page_free&#39;<br>        return gen_free_enter((struct pt_regs *)args, (void *)args-&gt;page);<br>                                                              ~~~~  ^<br>2 errors generated.<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 401, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;site-packages&#47;bcc&#47;__init__.py&quot;, line 318, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br>[root@localhost sa]# <br>[root@localhost sa]# uname -r<br>4.20.5-1.el7.elrepo.x86_64<br>[root@localhost sa]# ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437924,"discussion_content":"æ˜¯ç”¨çš„ centos å—ï¼Ÿçœ‹èµ·æ¥è·Ÿ https://github.com/iovisor/bcc/issues/1530#issuecomment-358035538 æ¯”è¾ƒåƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548942083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367804,"discussion_content":"https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md\n\nä¸Šé¢é“¾æ¥é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹:\nPre-alloc map memory by default \t4.6 \t6c9059817432\n\nåº”è¯¥æ˜¯è¯´æ˜  4.6å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨.\n\n\næ¯”è¾ƒå¥½å¥‡çš„æ˜¯, ä¸ºä»€ä¹ˆ4.20çš„å†…æ ¸ç‰ˆæœ¬ è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜???","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618471895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330999,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","nickname":"é“é•¿","note":"","ucode":"15B2E9CEF84634","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331096,"discussion_content":"æ‚¨å¥½ï¼ä½ è¿™é—®é¢˜è§£å†³äº†å—ï¼Ÿæˆ‘ä¹Ÿé‡åˆ°è¿™é—®é¢˜äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606786546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61181,"user_name":"å¦‚æœ","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1547632721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547632721","product_id":100020901,"comment_content":"DAY18ï¼Œæ‰“å¡ï¼›<br>getåˆ°ä¸€ä¸ªæ–°çš„å†…å­˜æŸ¥çœ‹å·¥å…·ï¼ï¼","like_count":0},{"had_liked":false,"id":59422,"user_name":"è¥¿çº¢æŸ¿ç‰›è…©","can_delete":false,"product_type":"c1","uid":1152898,"ip_address":"","ucode":"DEC94B4A647A92","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/82/394c88ad.jpg","comment_is_top":false,"comment_ctime":1547367954,"is_pvip":false,"replies":[{"id":"21519","content":"dockerå†…éƒ¨ç›´æ¥æ“ä½œæ˜¯ä¸è¡Œçš„ï¼Œä¸€ä¸ªæ˜¯éœ€è¦å¤§é‡çš„ç¬¦å·ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªè¿˜éœ€è¦å®¹å™¨è¿è¡Œåœ¨ç‰¹æƒæ¨¡å¼ã€‚æ‰€ä»¥ï¼Œæ¨èåœ¨å®¹å™¨å¤–éƒ¨è¿è¡Œè¿™ä¸ªå·¥å…·","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1547447755,"ip_address":"","comment_id":59422,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547367954","product_id":100020901,"comment_content":"è€å¸ˆï¼Œéº»çƒ¦è¯·æ•™ä¸‹åœ¨dockerä¸­æ‰§è¡Œä¼šå‡ºé”™çš„é—®é¢˜ï¼š<br>ç³»ç»Ÿç‰ˆæœ¬Ubuntu18.04.1<br>å†…æ ¸ï¼šLinux top 4.15.0-43-generic #46-Ubuntu SMP Thu Dec 6 14:45:28 UTC 2018 x86_64 x86_64 x86_64 GNU&#47;Linux<br>åœ¨æ‰§è¡Œå®Œï¼š<br>docker run --name=app -itd feisky&#47;app:mem-leak<br>docker logs app<br>æ‰§è¡Œ<br>&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p $(pidof app)<br>å¼€å§‹æŠ¥é”™ï¼š<br>root@top:~&#47;app# &#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak -a -p $(pidof app)<br>&#47;virtual&#47;main.c:18:1: error: could not open bpf map: Cannot allocate memory<br>is maps&#47;stacktrace map type enabled in your kernel?<br>BPF_STACK_TRACE(stack_traces, 10240);<br>^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:220:3: note: expanded from macro &#39;BPF_STACK_TRACE&#39;<br>  BPF_TABLE(&quot;stacktrace&quot;, int, struct bpf_stacktrace, _name, roundup_pow_of_two(_max_entries))<br>  ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:75:76: note: expanded from macro &#39;BPF_TABLE&#39;<br>#define BPF_TABLE(_table_type, _key_type, _leaf_type, _name, _max_entries) \\<br>                                                                           ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:71:4: note: expanded from macro &#39;\\<br>BPF_F_TABLE&#39;<br>}; \\<br>   ^<br>&#47;virtual&#47;main.c:83:25: error: bpf_table stack_traces failed to open<br>        info.stack_id = stack_traces.get_stackid(ctx, BPF_F_REUSE_STACKID|BPF_F_USER_STACK);<br>                        ^<br>2 errors generated.<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 394, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 320, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br><br>ä½†æ˜¯æˆ‘æŠŠapp.cå’Œapp-fix.cå•ç‹¬æ‹¿å‡ºæ¥ï¼Œè‡ªè¡Œç¼–è¯‘è¿è¡Œæ—¶ï¼Œæ‰§è¡Œmemleakï¼Œå°±å·¥ä½œæ­£å¸¸äº†ã€‚å¯¹dockeræ“ä½œä¸ç†Ÿï¼Œæä¸æ‡‚ä¸ºä»€ä¹ˆï¼Œè¿˜è¯·è€å¸ˆæœ‰æ—¶é—´æŒ‡æ•™ä¸€ä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436337,"discussion_content":"dockerå†…éƒ¨ç›´æ¥æ“ä½œæ˜¯ä¸è¡Œçš„ï¼Œä¸€ä¸ªæ˜¯éœ€è¦å¤§é‡çš„ç¬¦å·ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªè¿˜éœ€è¦å®¹å™¨è¿è¡Œåœ¨ç‰¹æƒæ¨¡å¼ã€‚æ‰€ä»¥ï¼Œæ¨èåœ¨å®¹å™¨å¤–éƒ¨è¿è¡Œè¿™ä¸ªå·¥å…·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547447755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367802,"discussion_content":"https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md\n\nä¸Šé¢é“¾æ¥é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹:\nPre-alloc map memory by default \t4.6 \t6c9059817432\n\nåº”è¯¥æ˜¯è¯´æ˜  4.6å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨.\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618471792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57387,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1546774246,"is_pvip":false,"replies":[{"id":"20769","content":"å—¯ï¼Œç³»ç»Ÿçº§çš„å†…å­˜æ³„æ¼ä¸€ä¸ªmemleakå°±å¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546854501,"ip_address":"","comment_id":57387,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546774246","product_id":100020901,"comment_content":"1,å¦‚ä½•åˆ¤æ–­ç›®å‰ç³»ç»Ÿç¯å¢ƒæ˜¯å¦å·²ç»å‘ç”Ÿäº†å†…å­˜æ³„éœ²<br>2,å¦‚ä½•åˆ¤æ–­æ˜¯å“ªä¸ªè¿›ç¨‹å‘ç”Ÿäº†å†…å­˜æ³„éœ²","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435554,"discussion_content":"å—¯ï¼Œç³»ç»Ÿçº§çš„å†…å­˜æ³„æ¼ä¸€ä¸ªmemleakå°±å¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546854501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57349,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1546760627,"is_pvip":false,"replies":[{"id":"20772","content":"æ²¡æœ‰è®²ç©¶ï¼Œåªæ˜¯ä¸ªæ¡ˆä¾‹ï¼Œç”¨ä¸ç”¨çº¿ç¨‹éƒ½æ²¡å…³ç³»","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546854690,"ip_address":"","comment_id":57349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546760627","product_id":100020901,"comment_content":"é—®ä¸€ä¸‹ï¼Œmemleakè¿™ä¸ªç¨‹åºç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ¥æ¼”ç¤ºé—®é¢˜ï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆè®²ç©¶å—ï¼Ÿæ˜¯ä¸æ˜¯æ•…æ„ä¸ºä¹‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435537,"discussion_content":"æ²¡æœ‰è®²ç©¶ï¼Œåªæ˜¯ä¸ªæ¡ˆä¾‹ï¼Œç”¨ä¸ç”¨çº¿ç¨‹éƒ½æ²¡å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546854690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57269,"user_name":"noma","can_delete":false,"product_type":"c1","uid":1334774,"ip_address":"","ucode":"ADB9D589B9A798","user_header":"","comment_is_top":false,"comment_ctime":1546702401,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1546702401","product_id":100020901,"comment_content":"ubuntu <br>linux kernel: 4.4.0-21-generic<br>æ‰§è¡Œmemleakä¹ŸæŠ¥é”™ï¼š<br>virtual&#47;main.c:18:1: error: could not open bpf map: Invalid argument<br>is maps&#47;stacktrace map type enabled in your kernel?<br>BPF_STACK_TRACE(stack_traces, 10240);<br>^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:199:3: note: expanded from macro &#39;BPF_STACK_TRACE&#39;<br>  BPF_TABLE(&quot;stacktrace&quot;, int, struct bpf_stacktrace, _name, roundup_pow_of_two(_max_entries))<br>  ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:60:76: note: expanded from macro &#39;BPF_TABLE&#39;<br>#define BPF_TABLE(_table_type, _key_type, _leaf_type, _name, _max_entries) \\<br>                                                                           ^<br>&#47;virtual&#47;include&#47;bcc&#47;helpers.h:56:4: note: expanded from macro &#39;\\<br>BPF_F_TABLE&#39;<br>}; \\<br>   ^<br>&#47;virtual&#47;main.c:83:25: error: bpf_table stack_traces failed to open<br>        info.stack_id = stack_traces.get_stackid(ctx, BPF_F_REUSE_STACKID|BPF_F_USER_STACK);<br>                        ^<br>2 errors generated.<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 394, in &lt;module&gt;<br>    bpf = BPF(text=bpf_source)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 318, in __init__<br>    raise Exception(&quot;Failed to compile BPF text&quot;)<br>Exception: Failed to compile BPF text<br><br>çœ‹è¿™ä¸ªblogä½œè€…çš„å›å¤ï¼š<br>http:&#47;&#47;blogs.microsoft.co.il&#47;sasha&#47;2016&#47;02&#47;14&#47;two-new-ebpf-tools-memleak-and-argdist&#47;<br><br>æ„æ€åº”è¯¥æ˜¯ç°åœ¨çš„memleakç‰ˆæœ¬éœ€è¦å†…æ ¸æ”¯æŒ BPF stack traceï¼Œ4.6ç‰ˆæœ¬çš„å†…æ ¸åº”è¯¥å¯ä»¥ã€‚ç„¶ååœ¨4.4ç‰ˆæœ¬çš„å†…æ ¸ä¸Šï¼Œåœ¨&#47;usr&#47;share&#47;bcc&#47;tools&#47;old&#47;memleakåº”è¯¥èƒ½work, å—¯ï¼Œæˆ‘è¯•äº†è¿˜æ˜¯æŠ¥åŒæ ·çš„é”™è¯¯:(","like_count":0,"discussions":[{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367801,"discussion_content":"https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md\n\nä¸Šé¢é“¾æ¥é‡Œé¢æœ‰å¦‚ä¸‹å†…å®¹:\nPre-alloc map memory by default \t4.6 \t6c9059817432\n\nåº”è¯¥æ˜¯è¯´æ˜  4.6å†…æ ¸ç‰ˆæœ¬æ‰æ”¯æŒè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨.\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618471774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57051,"user_name":"æ¢¦èˆŸ","can_delete":false,"product_type":"c1","uid":1365662,"ip_address":"","ucode":"0D766D9BDCE13E","user_header":"https://static001.geekbang.org/account/avatar/00/14/d6/9e/27c476e1.jpg","comment_is_top":false,"comment_ctime":1546608489,"is_pvip":false,"replies":[{"id":"20574","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546612213,"ip_address":"","comment_id":57051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546608489","product_id":100020901,"comment_content":"éå¸¸ä¸é”™","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435379,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546612213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56825,"user_name":"JohnT3e","can_delete":false,"product_type":"c1","uid":1063982,"ip_address":"","ucode":"CF4AAAC933529C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLdWHFCr66TzHS2CpCkiaRaDIk3tU5sKPry16Q7ic0mZZdy8LOCYc38wOmyv5RZico7icBVeaPX8X2jcw/132","comment_is_top":false,"comment_ctime":1546564956,"is_pvip":false,"replies":[{"id":"21162","content":"å—¯ï¼Œå†…ç½®ç±»å‹æ²¡å¿…è¦å»åˆ†é…åŠ¨æ€å†…å­˜","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1547125197,"ip_address":"","comment_id":56825,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546564956","product_id":100020901,"comment_content":"æ€è€ƒé¢˜ï¼šfibonacciå‡½æ•°ç›´æ¥è¿”å›å€¼ï¼Œæˆ–è€…åœ¨childå‡½æ•°ä¸­åˆ†é…å±€éƒ¨å˜é‡vï¼Œfibonacciå‡½æ•°å¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œä¼ å…¥å±€éƒ¨å˜é‡vçš„åœ°å€ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435259,"discussion_content":"å—¯ï¼Œå†…ç½®ç±»å‹æ²¡å¿…è¦å»åˆ†é…åŠ¨æ€å†…å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547125197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56535,"user_name":"holen","can_delete":false,"product_type":"c1","uid":1104199,"ip_address":"","ucode":"2C7D342AFE4DF0","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/47/247fd305.jpg","comment_is_top":false,"comment_ctime":1546483600,"is_pvip":false,"replies":[{"id":"21144","content":"æ®æˆ‘æ‰€çŸ¥ï¼Œbccè¿™å¥—å·¥å…·æ˜¯æœ€å¥½ç”¨çš„ï¼Œå…¶ä»–çš„å·¥å…·éƒ½æœ‰å¾ˆå¤šé™åˆ¶ï¼ˆæ¯”å¦‚ä¸å¥½ç”¨ï¼Œæˆ–è€…æ”¶è´¹ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1547123562,"ip_address":"","comment_id":56535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546483600","product_id":100020901,"comment_content":"è€å¸ˆï¼Œ æœ‰æ²¡æœ‰ centos ä¸‹ä¸ç”¨å‡çº§å†…æ ¸å°±å¯ä»¥æ£€æµ‹å†…å­˜çš„å·¥å…·ï¼Œåƒ valgrind å·¥å…·æ²¡åŠæ³•æŒ‡å®š pid æ£€æµ‹,   æœ‰æ²¡æœ‰æ›´å¥½çš„å·¥å…·æ¨èä¸‹å‘¢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435100,"discussion_content":"æ®æˆ‘æ‰€çŸ¥ï¼Œbccè¿™å¥—å·¥å…·æ˜¯æœ€å¥½ç”¨çš„ï¼Œå…¶ä»–çš„å·¥å…·éƒ½æœ‰å¾ˆå¤šé™åˆ¶ï¼ˆæ¯”å¦‚ä¸å¥½ç”¨ï¼Œæˆ–è€…æ”¶è´¹ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56508,"user_name":"nomoshen","can_delete":false,"product_type":"c1","uid":1043083,"ip_address":"","ucode":"7EA7C4FECFA7C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/8b/613c162e.jpg","comment_is_top":false,"comment_ctime":1546479491,"is_pvip":false,"replies":[{"id":"21142","content":"valgrindä¸èƒ½æŒ‡å®šPIDåˆ†æï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯é€šè¿‡ç›‘æ§ç³»ç»Ÿå‘ç°æœ‰å†…å­˜é—®é¢˜åï¼Œåˆ°çº¿ä¸‹ç”¨ valgrind åˆ†æã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1547123437,"ip_address":"","comment_id":56508,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546479491","product_id":100020901,"comment_content":"ç›®å‰æˆ‘å¸ç”¨çš„å†…æ ¸ç‰ˆæœ¬è¿˜æ˜¯2.6çš„ï¼›è€Œä¸”ç”¨valgrindä¼šå¯¹çº¿ä¸Šæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºæœ‰å¾ˆå¤§æ€§èƒ½å½±å“å§ï¼›å¯¹å†…å­˜æ³„éœ²è¿™å—è¿˜æ˜¯å¾ˆéš¾æŠŠæ¡çš„ï¼›å¸Œæœ›è€å¸ˆèƒ½xç»†èŠè¿™å—","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435080,"discussion_content":"valgrindä¸èƒ½æŒ‡å®šPIDåˆ†æï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯é€šè¿‡ç›‘æ§ç³»ç»Ÿå‘ç°æœ‰å†…å­˜é—®é¢˜åï¼Œåˆ°çº¿ä¸‹ç”¨ valgrind åˆ†æã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56507,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1546479489,"is_pvip":false,"replies":[{"id":"21141","content":"ğŸ‘è°¢è°¢åˆ†äº«","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1547123305,"ip_address":"","comment_id":56507,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546479489","product_id":100020901,"comment_content":"valgrindä¸æ˜¯å®æ—¶çš„æŸ¥çœ‹å‘½ä»¤ï¼ŒæŠŠæ£€æŸ¥ç»“æœå­˜å…¥åˆ°ä¸€ä¸ªæ–‡æœ¬ä¸­ã€‚<br>valgrind --tool=memcheck --leak-check=full --xtree-leak=yes --show-mismatched-frees=yes test.txt","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435079,"discussion_content":"ğŸ‘è°¢è°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56383,"user_name":"äºŒä¸‰å­ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1546433222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546433222","product_id":100020901,"comment_content":"Flag ","like_count":0},{"had_liked":false,"id":56364,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1546429528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546429528","product_id":100020901,"comment_content":"addr = 7f5d902f66d0 size = 8192<br>æœ‰ä»€ä¹ˆå·¥å…·èƒ½çŸ¥é“7f5d902f66d0è¿™ä¸ªåœ°å€ä¸Šæ˜¯ä»€ä¹ˆå†…å®¹å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":56319,"user_name":"è…¾è¾¾","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1546421429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546421429","product_id":100020901,"comment_content":"åœ¨é€šè¿‡make run å¯åŠ¨è¿è¡Œdockeråï¼Œå°è¯•ä½¿ç”¨memleakå‡ºç°â€Failed to attach BPF to uprobeâ€œï¼Œè¿™ä¸ªé”™è¯¯ï¼Œè‡ªå·±googleäº†ä¸€ä¸‹ï¼Œæœªå‘ç°æ˜æ˜¾çš„è§£å†³æ–¹æ¡ˆï¼Œè¯·é—®è¿™ä¸ªè¦å¦‚ä½•å¤„ç†ï¼Ÿå¦‚æœè‡ªå·±ç›´æ¥ gccç¼–è¯‘ app.cï¼Œä¸ç”¨dockerï¼Œå¯ä»¥è¿è¡Œmemleak<br>root@abbott-VirtualBox:~# memleak -a -p $(pidof app)<br>Attaching to pid 5877, Ctrl+C to quit.<br>perf_event_open(&#47;sys&#47;kernel&#47;debug&#47;tracing&#47;events&#47;uprobes&#47;p__lib_x86_64_linux_gnu_libc_2_27_so_0x97070_5877_bcc_5949&#47;id): Input&#47;output error<br>Traceback (most recent call last):<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 416, in &lt;module&gt;<br>    attach_probes(&quot;malloc&quot;)<br>  File &quot;&#47;usr&#47;share&#47;bcc&#47;tools&#47;memleak&quot;, line 406, in attach_probes<br>    pid=pid)<br>  File &quot;&#47;usr&#47;lib&#47;python2.7&#47;dist-packages&#47;bcc&#47;__init__.py&quot;, line 952, in attach_uprobe<br>    raise Exception(&quot;Failed to attach BPF to uprobe&quot;)<br>Exception: Failed to attach BPF to uprobe<br>","like_count":0},{"had_liked":false,"id":56254,"user_name":"å°è€é¼ ","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1546412157,"is_pvip":false,"replies":[{"id":"20337","content":"æ˜¯çš„ï¼Œä½†è¦æ³¨æ„é‡Šæ”¾å¯¹è±¡çš„å¼•ç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546445442,"ip_address":"","comment_id":56254,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546412157","product_id":100020901,"comment_content":"ç”¨javaå°±ä¸è¦ç”¨freeäº†å§","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434965,"discussion_content":"æ˜¯çš„ï¼Œä½†è¦æ³¨æ„é‡Šæ”¾å¯¹è±¡çš„å¼•ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56248,"user_name":"æ·¸æ›‰","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1546411595,"is_pvip":false,"replies":[{"id":"20264","content":"æ˜¯çš„ å¯ä»¥åˆ°githubæŸ¥çœ‹æ¡ˆä¾‹æºç  https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546423537,"ip_address":"","comment_id":56248,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546411595","product_id":100020901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼æ‚¨åœ¨æ–‡ä¸­ä»å‰é¢å‡ ç¯‡é™åˆ°å‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯åœ¨ä½ æ‰“åŒ…çš„æ–‡ä»¶ä¸­å—ï¼Ÿè¯¥æ€ä¹ˆå»æŸ¥çœ‹åˆ†æï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434964,"discussion_content":"æ˜¯çš„ å¯ä»¥åˆ°githubæŸ¥çœ‹æ¡ˆä¾‹æºç  https://github.com/feiskyer/linux-perf-examples","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56244,"user_name":"æ·¸æ›‰","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1546411281,"is_pvip":false,"replies":[{"id":"20265","content":"å—¯ ä¸é”™çš„å»ºè®®ã€‚æ¡ˆä¾‹å’Œå·¥å…·é‡Œé¢æœ‰å¾ˆå¤šåŸºç¡€çš„ä¸œè¥¿æ²¡æœ‰å±•å¼€ç»†è¯´ï¼Œä¸è¿‡å…³é”®çš„åœ°æ–¹çš„ç¡®æ ‡æ³¨ä¸‹æ›´æœ‰åŠ©äºåˆå­¦è€…ç†è§£","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546423702,"ip_address":"","comment_id":56244,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546411281","product_id":100020901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼å…³äºmemleakæˆ–å…¶ä»–å·¥å…·ï¼Œè¾“å‡ºçš„å†…å®¹é‡Œï¼Œæ‚¨å¯ä»¥æ ‡æ³¨ä¸€ä¸‹é‡è¦è¯­å¥ã€å‚æ•°ã€ä»£ç çš„åŠŸèƒ½å—ï¼Ÿæ¯”å¦‚ï¼šè¿™æ¬¡çš„memleakï¼Œ$(pidof app)ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Ÿè¾“å‡ºçš„å†…å®¹ä¸­ï¼Œä»å“ªé‡ŒæŸ¥çœ‹åˆ†æå†…å­˜åˆ†é…å›æ”¶ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434962,"discussion_content":"å—¯ ä¸é”™çš„å»ºè®®ã€‚æ¡ˆä¾‹å’Œå·¥å…·é‡Œé¢æœ‰å¾ˆå¤šåŸºç¡€çš„ä¸œè¥¿æ²¡æœ‰å±•å¼€ç»†è¯´ï¼Œä¸è¿‡å…³é”®çš„åœ°æ–¹çš„ç¡®æ ‡æ³¨ä¸‹æ›´æœ‰åŠ©äºåˆå­¦è€…ç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56155,"user_name":"Brownç¾Šç¾Š","can_delete":false,"product_type":"c1","uid":1315332,"ip_address":"","ucode":"354EC478E57DEE","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/04/5837b21c.jpg","comment_is_top":false,"comment_ctime":1546398182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546398182","product_id":100020901,"comment_content":"å·¥å…·å¯¹å†…æ ¸è¦æ±‚è¿˜æ˜¯è›®é«˜çš„","like_count":0},{"had_liked":false,"id":56131,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1546395360,"is_pvip":false,"replies":[{"id":"20267","content":"æœ‰çš„ å¯ä»¥ç”¨valgrind","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546423936,"ip_address":"","comment_id":56131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546395360","product_id":100020901,"comment_content":"æœ‰æ²¡æœ‰ä½ç«¯ç‰ˆæœ¬çš„å·¥å…·æ¥æ£€æµ‹å†…å­˜æ³„æ¼çš„ã€‚ç°åœ¨çº¿ä¸Šçš„æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬å¼€å‘æµ‹è¯•çš„æœåŠ¡å™¨éƒ½ä¸å¯èƒ½å»å‡çº§å†…æ ¸ã€‚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434943,"discussion_content":"æœ‰çš„ å¯ä»¥ç”¨valgrind","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56092,"user_name":"æ·¸æ›‰","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1546392531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546392531","product_id":100020901,"comment_content":"è€å¸ˆï¼Œèƒ½å†™ä¸€ä¸ªcentos7å®‰è£…bcc çš„æ–‡æœ¬å—ï¼Ÿä»€ä¹ˆéƒ½å‡†å¤‡å¥½äº†ï¼Œå°±æ˜¯åˆ°ä¸‹è½½bccæ—¶å°±ä¸€ç›´æ— æ³•å®‰è£…ã€‚","like_count":0},{"had_liked":false,"id":56027,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1546388007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546388007","product_id":100020901,"comment_content":"æ‰“å¡day19<br>ä¸Šç­ç¬¬ä¸€å¤©ï¼Œå•ƒä¸¤ç¯‡æ–‡ç« ï¼Œé…¸çˆ½","like_count":0},{"had_liked":false,"id":55982,"user_name":"é£é£˜ï¼Œå¾ç‹¬æ€","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1546359465,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546359465","product_id":100020901,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":55848,"user_name":"æ— åè€å’","can_delete":false,"product_type":"c1","uid":1348261,"ip_address":"","ucode":"48874CE670E122","user_header":"","comment_is_top":false,"comment_ctime":1546327588,"is_pvip":false,"replies":[{"id":"20279","content":"è¿™äº›warningæ˜¯æ­£å¸¸çš„ï¼ŒåŸå› æ˜¯ä¾èµ–åº“åœ¨å®¹å™¨é‡Œé¢çš„è·¯å¾„è·Ÿå¤–é¢ä¸åŒ","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1546424880,"ip_address":"","comment_id":55848,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546327588","product_id":100020901,"comment_content":"è€å¸ˆï¼Œå¯¹è¿™ä¸ªä¸æ˜¯å¾ˆæ˜ç™½ï¼Œæˆ‘çš„ç¯å¢ƒæ˜¯centos 7&#47;4.20çš„å†…æ ¸ï¼Œä½¿ç”¨memleakæ¥æŸ¥çœ‹ï¼Œä¹Ÿæ˜¯æœ‰æç¤ºCouldn&#39;t find .text section in &#47;appï¼Œä½†åé¢è¿˜æ˜¯æ˜¾ç¤ºäº†fibonacciï¼›å¦å¤–ï¼Œå°†docker cpåˆ°&#47;appä¸‹é¢ä¹‹åï¼Œåé¢çš„å‡ è¡ŒWARNINGè¿˜æ˜¯å­˜åœ¨ï¼Œæ˜¯ç¼ºå°‘äº†å“ªäº›æ–‡ä»¶å—ï¼Ÿ<br><br>```<br>[root@linjx ~]# memleak -a -p `pidof app`<br>Attaching to pid 15541, Ctrl+C to quit.<br>[01:59:23] Top 10 stacks with outstanding allocations:<br>WARNING: Couldn&#39;t find .text section in &#47;app<br>WARNING: BCC can&#39;t handle sym look ups for &#47;appWARNING: Couldn&#39;t find .text section in WARNING: BCC can&#39;t handle sym look ups for &#47;lib&#47;x86_64-linux-gnu&#47;libc-2.27.soWARNING: Couldn&#39;t find .text section in &#47;lib&#47;x86_64-linux-gnu&#47;libpthread-2.27.so<br>WARNING: BCC can&#39;t handle sym look ups for &#47;lib&#47;x86_64-linux-gnu&#47;libpthread-2.27.soWARNING: Couldn&#39;t find .text section in &#47;lib&#47;x86_64-linux-gnu&#47;ld-2.27.so<br>WARNING: BCC can&#39;t handle sym look ups for &#47;lib&#47;x86_64-linux-gnu&#47;ld-2.27.so\taddr = 7f901c147960 size = 8192<br>\taddr = 7f901c145950 size = 8192<br>\taddr = 7f901c149970 size = 8192<br>\taddr = 7f901c143940 size = 8192<br>\t32768 bytes in 4 allocations from stack<br>\t\tfibonacci+0x17 [app]<br>\t\tchild+0x47 [app]<br>\t\tstart_thread+0xd3 [libpthread-2.27.so]<br>```","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434859,"discussion_content":"è¿™äº›warningæ˜¯æ­£å¸¸çš„ï¼ŒåŸå› æ˜¯ä¾èµ–åº“åœ¨å®¹å™¨é‡Œé¢çš„è·¯å¾„è·Ÿå¤–é¢ä¸åŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55837,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1546322954,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546322954","product_id":100020901,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸€äº›ç–‘é—®<br>1.æˆ‘åœ¨centoså’ŒUbuntuç›´æ¥ç¼–è¯‘è¿è¡Œè¿™ä¸ªcç¨‹åºï¼Œç„¶åstrace -ff è¿™ä¸ªç¨‹åºï¼Œå‘ç°ç¨‹åºåœ¨ä¸æ–­çš„è°ƒç”¨mprotect()å‡½æ•°ï¼Œä½†å´æ²¡æœ‰mmap()ï¼Œä¸¤ä¸ªç³»ç»Ÿéƒ½æ˜¯è¿™æ ·çš„ã€‚<br>ç”³è¯·å†…å­˜æœ€ç»ˆä¸æ˜¯è¦è°ƒç”¨brk()æˆ–è€…mmap()å—ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œstraceåå´æ²¡æœ‰è°ƒç”¨å‘¢ï¼Ÿ<br><br>2.é€šè¿‡memlekçœ‹åˆ°ç¨‹åºä¸æ–­ç”³è¯·çš„å†…å­˜åœ°å€ï¼Œç„¶åcatè¿›ç¨‹çš„smapï¼Œå¯¹åº”çš„åœ°å€åº”è¯¥æ˜¯æ–‡ä»¶æ˜ å°„æ®µï¼Œé‚£ä¹ˆheapæ®µå’Œæ–‡ä»¶æ˜ å°„æ®µåˆ°åº•æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Œå°±æ˜¯å› ä¸ºmmapåˆ†é…çš„å†…å­˜éƒ½è¢«åˆ†åˆ°æ–‡ä»¶æ˜ å°„æ®µï¼Œbrkéƒ½è¢«åˆ†é…åˆ°heapï¼Ÿç›´æ¥åˆ†é…åˆ°heapæ®µä¸è¡Œå—<br>æˆ‘çœ‹heapæ®µåé¢å°±ç›´æ¥è·Ÿäº†æ–‡ä»¶æ˜ å°„æ®µäº†ï¼Œä¸ºä»€ä¹ˆå†…å­˜åˆ†é…ä¸ç›´æ¥åˆ†åˆ°heapæ®µå†…<br><br>3.è¿™ä¸ªç¨‹åºæ€æ ·æ‰ç®—æŠŠå†…å­˜ç”¨æ»¡å‘¢ï¼Œæ˜¯æ–‡ä»¶æ˜ å°„æ®µï¼Œä¸€ç›´å¢é•¿ï¼Œæ¶¨åˆ°å·²ç»åˆ°stackæ®µäº†ï¼Œç„¶åå°±æ²¡æ³•åˆ†é…å†…å­˜äº†ï¼Œç„¶åæŠ¥é”™ï¼Ÿ<br><br>4.ç³»ç»Ÿåˆ†é…å†…å­˜æœ‰ä¼™ä¼´ç³»ç»Ÿå’Œslabæœºåˆ¶ï¼Œå¯ä»¥é˜²æ­¢å†…å­˜ç¢ç‰‡ï¼Œä¸ºä»€ä¹ˆjavaè¿˜è¦è‡ªå·±æä¸€å¥—å†…å­˜ç®¡ç†ï¼Œè¿˜æœ‰ä¸€å †gcç®—æ³•ï¼Ÿ","like_count":0},{"had_liked":false,"id":55791,"user_name":"Geek_33409b","can_delete":false,"product_type":"c1","uid":1112756,"ip_address":"","ucode":"9C64C42F799403","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/b4/6892eabe.jpg","comment_is_top":false,"comment_ctime":1546309379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546309379","product_id":100020901,"comment_content":"æœ€è¿‘å†™goï¼Œæœ‰ä¸ªç¨‹åºè¿è¡Œä¹‹åï¼Œè™šå­˜ä¸€ç›´åœ¨å¢é•¿ï¼Œå¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹","like_count":0},{"had_liked":false,"id":55532,"user_name":"Tech","can_delete":false,"product_type":"c1","uid":1018736,"ip_address":"","ucode":"83D3C69B0AA03F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8b/70/ab68020f.jpg","comment_is_top":false,"comment_ctime":1546224750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546224750","product_id":100020901,"comment_content":"è€å¸ˆï¼Œfreeå¹¶ä¸çœŸæ­£é‡Šæ”¾å†…å­˜ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹å¼å¼ºåˆ¶é‡Šæ”¾å‘¢ï¼Ÿ","like_count":0}]}