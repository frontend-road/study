{"id":627587,"title":"109｜怎样设计人脸识别系统？","content":"<p><strong>课后习题</strong><br>\n请你 OpenCV 实现特定人脸识别功能，识别用户为 A 时，终端输出用户 A，识别出是其他用户时，输出其他用户。</p><p><strong>课程代码、课件及其他相关资料地址</strong><br>\n<a href=\"https://gitee.com/wilsonyin/zero-basics-python\">https://gitee.com/wilsonyin/zero-basics-python</a></p>","comments":[{"had_liked":false,"id":368101,"user_name":"Cy23","can_delete":false,"product_type":"c3","uid":1591293,"ip_address":"辽宁","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1675906885,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"import os\nimport cv2\nfrom PIL import Image, ImageDraw, ImageFont\nimport numpy as np\nfrom pathlib import Path\n\n# 加载训练数据\nrecogizer=cv2.face.LBPHFaceRecognizer_create()\nrecogizer.read(&#39;trainer&#47;trainer.yml&#39;)\n\nnames=[&quot;Boss&quot;] # 名字\nidn = [1] # 标签\n\n# 识别图片\ndef face_detect_demo(img):\n\n    gray=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)\n    # 调用人脸分类器\n    face_detector = cv2.CascadeClassifier(r&#39;d:\\programdata\\anaconda3\\envs\\py3110\\lib\\site-packages\\cv2\\data\\haarcascade_frontalface_default.xml&#39;)\n    \n    # 读取人脸特征并返回人脸坐标\n    face=face_detector.detectMultiScale(gray,1.1,5,0,(100,100),(800,800))\n    for x,y,w,h in face:\n        # 标记人脸\n        cv2.rectangle(img,(x,y),(x+w,y+h),color=(0,0,255),thickness=2)\n        # 识别人脸\n        ids, confidence = recogizer.predict(gray[y:y + h, x:x + w])\n        if confidence &gt; 60:\n            print(&quot;其他用户&quot;)\n        else:\n            print(&quot;用户A&quot;)\n    cv2.imshow(&#39;result&#39;, img)\n\n\ncap=cv2.VideoCapture(0)\n\nwhile True:\n    flag,frame=cap.read()\n    if not flag:\n        break\n    face_detect_demo(frame)\n    if ord(&#39; &#39;) == cv2.waitKey(10):\n        break\ncv2.destroyAllWindows()\ncap.release()","like_count":1},{"had_liked":false,"id":394256,"user_name":"远游","can_delete":false,"product_type":"c3","uid":2103322,"ip_address":"北京","ucode":"73792ED128D57C","user_header":"https://static001.geekbang.org/account/avatar/00/20/18/1a/5f36bb6e.jpg","comment_is_top":false,"comment_ctime":1726241303,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"实现了，挺有意思~","like_count":0},{"had_liked":false,"id":385286,"user_name":"Geek_631607","can_delete":false,"product_type":"c3","uid":3789991,"ip_address":"广东","ucode":"EAF874838F0BE4","user_header":"","comment_is_top":false,"comment_ctime":1702378190,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"你可以使用 OpenCV 和 face_recognition 库来实现特定人脸识别功能。以下是一个简单的示例代码：\n\n```python\nimport cv2\nimport face_recognition\n\n# 加载已知的用户 A 的图片并获取面部编码\nimage_of_user_A = face_recognition.load_image_file(&quot;user_A.jpg&quot;)\nuser_A_face_encoding = face_recognition.face_encodings(image_of_user_A)[0]\n\n# 创建已知面部编码和面部名称的数组\nknown_face_encodings = [user_A_face_encoding]\nknown_face_names = [&quot;用户 A&quot;]\n\n# 加载要检测的图片\nunknown_image = face_recognition.load_image_file(&quot;unknown.jpg&quot;)\n\n# 找到图片中所有面部的面部编码\nface_locations = face_recognition.face_locations(unknown_image)\nface_encodings = face_recognition.face_encodings(unknown_image, face_locations)\n\n# 遍历每个面部\nfor (top, right, bottom, left), face_encoding in zip(face_locations, face_encodings):\n    # 看看面部是否与已知面部匹配\n    matches = face_recognition.compare_faces(known_face_encodings, face_encoding)\n\n    name = &quot;其他用户&quot;\n\n    # 如果找到匹配，就使用第一个匹配的面部\n    if True in matches:\n        first_match_index = matches.index(True)\n        name = known_face_names[first_match_index]\n\n    # 输出匹配的结果\n    print(name)\n```\n\n这段代码会加载已知的用户 A 的图片和一个未知的图片，然后找到未知图片中所有面部的面部编码，并与已知的用户 A 的面部编码进行比较。如果找到匹配，就输出 &quot;用户 A&quot;，否则输出 &quot;其他用户&quot;。\n\n**注意**：这段代码需要在你的本地环境中运行，因为它需要访问你的文件系统。在运行这段代码之前，请确保你已经安装了 face_recognition 库（你可以使用 `pip install face_recognition` 命令来安装）。希望这个答案对你有所帮助！","like_count":0}]}