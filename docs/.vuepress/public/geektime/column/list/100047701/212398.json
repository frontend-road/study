{"id":212398,"title":"32 | åŠ é¤2ï¼šå¸¦ä½ åƒé€è¯¾ç¨‹ä¸­Java 8çš„é‚£äº›é‡è¦çŸ¥è¯†ç‚¹ï¼ˆäºŒï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚</p><p>ä¸Šä¸€è®²çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œå…¶å®éƒ½æ¶‰åŠäº†Stream APIçš„æœ€åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚ä»Šå¤©ï¼Œæˆ‘ä¼šä¸ä½ è¯¦ç»†ä»‹ç»å¤æ‚ã€åŠŸèƒ½å¼ºå¤§çš„Stream APIã€‚</p><p>Streamæµå¼æ“ä½œï¼Œç”¨äºå¯¹é›†åˆè¿›è¡ŒæŠ•å½±ã€è½¬æ¢ã€è¿‡æ»¤ã€æ’åºç­‰ï¼Œæ›´è¿›ä¸€æ­¥åœ°ï¼Œè¿™äº›æ“ä½œèƒ½é“¾å¼ä¸²è”åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œç±»ä¼¼äºSQLè¯­å¥ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ã€‚å¯ä»¥è¯´ï¼ŒStreamæ“ä½œæ˜¯Java 8ä¸­æœ€é‡è¦çš„å†…å®¹ï¼Œä¹Ÿæ˜¯è¿™ä¸ªè¯¾ç¨‹å¤§éƒ¨åˆ†ä»£ç éƒ½ä¼šç”¨åˆ°çš„æ“ä½œã€‚</p><p>æˆ‘å…ˆè¯´æ˜ä¸‹ï¼Œæœ‰äº›æ¡ˆä¾‹å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œå»ºè®®ä½ å¯¹ç€ä»£ç é€ä¸€åˆ°æºç ä¸­æŸ¥çœ‹Streamæ“ä½œçš„æ–¹æ³•å®šä¹‰ï¼Œä»¥åŠJDKä¸­çš„ä»£ç æ³¨é‡Šã€‚</p><h2>Streamæ“ä½œè¯¦è§£</h2><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£Streamçš„å„ç§æ“ä½œï¼Œä»¥åŠåé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘å…ˆæŠŠè¿™èŠ‚è¯¾æ¶‰åŠçš„Streamæ“ä½œæ±‡æ€»åˆ°äº†ä¸€å¼ å›¾ä¸­ã€‚ä½ å¯ä»¥å…ˆç†Ÿæ‚‰ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/44/04/44a6f4cb8b413ef62c40a272cb474104.jpg?wh=3521*2617\" alt=\"\"></p><p>åœ¨æ¥ä¸‹æ¥çš„è®²è¿°ä¸­ï¼Œæˆ‘ä¼šå›´ç»•è®¢å•åœºæ™¯ï¼Œç»™å‡ºå¦‚ä½•ä½¿ç”¨Streamçš„å„ç§APIå®Œæˆè®¢å•çš„ç»Ÿè®¡ã€æœç´¢ã€æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå’Œä½ ä¸€èµ·å­¦ä¹ Streamæµå¼æ“ä½œçš„å„ç§æ–¹æ³•ã€‚ä½ å¯ä»¥ç»“åˆä»£ç ä¸­çš„æ³¨é‡Šç†è§£æ¡ˆä¾‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¿è¡Œæºç è§‚å¯Ÿè¾“å‡ºã€‚</p><p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªè®¢å•ç±»ã€ä¸€ä¸ªè®¢å•å•†å“ç±»å’Œä¸€ä¸ªé¡¾å®¢ç±»ï¼Œç”¨ä½œåç»­Demoä»£ç çš„æ•°æ®ç»“æ„ï¼š</p><pre><code>//è®¢å•ç±»\n@Data\npublic class Order {\n    private Long id;\n    private Long customerId;//é¡¾å®¢ID\n    private String customerName;//é¡¾å®¢å§“å\n    private List&lt;OrderItem&gt; orderItemList;//è®¢å•å•†å“æ˜ç»†\n    private Double totalPrice;//æ€»ä»·æ ¼\n    private LocalDateTime placedAt;//ä¸‹å•æ—¶é—´\n}\n//è®¢å•å•†å“ç±»\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class OrderItem {\n    private Long productId;//å•†å“ID\n    private String productName;//å•†å“åç§°\n    private Double productPrice;//å•†å“ä»·æ ¼\n    private Integer productQuantity;//å•†å“æ•°é‡\n}\n//é¡¾å®¢ç±»\n@Data\n@AllArgsConstructor\npublic class Customer {\n    private Long id;\n    private String name;//é¡¾å®¢å§“å\n}\n</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªorderså­—æ®µä¿å­˜äº†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ï¼Œç±»å‹æ˜¯List<order>ã€‚è¿™é‡Œï¼Œæˆ‘å°±ä¸è´´å‡ºç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„ä»£ç äº†ã€‚è¿™ä¸ä¼šå½±å“ä½ ç†è§£åé¢çš„ä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½æºç é˜…è¯»ã€‚</order></p><!-- [[[read_end]]] --><h3>åˆ›å»ºæµ</h3><p>è¦ä½¿ç”¨æµï¼Œå°±è¦å…ˆåˆ›å»ºæµã€‚åˆ›å»ºæµä¸€èˆ¬æœ‰äº”ç§æ–¹å¼ï¼š</p><ul>\n<li>é€šè¿‡streamæ–¹æ³•æŠŠListæˆ–æ•°ç»„è½¬æ¢ä¸ºæµï¼›</li>\n<li>é€šè¿‡Stream.ofæ–¹æ³•ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ æ„æˆä¸€ä¸ªæµï¼›</li>\n<li>é€šè¿‡Stream.iterateæ–¹æ³•ä½¿ç”¨è¿­ä»£çš„æ–¹å¼æ„é€ ä¸€ä¸ªæ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°ï¼›</li>\n<li>é€šè¿‡Stream.generateæ–¹æ³•ä»å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªæä¾›å…ƒç´ çš„Supplieræ¥æ„é€ æ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°ï¼›</li>\n<li>é€šè¿‡IntStreamæˆ–DoubleStreamæ„é€ åŸºæœ¬ç±»å‹çš„æµã€‚</li>\n</ul><pre><code>//é€šè¿‡streamæ–¹æ³•æŠŠListæˆ–æ•°ç»„è½¬æ¢ä¸ºæµ\n@Test\npublic void stream()\n{\n    Arrays.asList(&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;).stream().forEach(System.out::println);\n    Arrays.stream(new int[]{1, 2, 3}).forEach(System.out::println);\n}\n\n//é€šè¿‡Stream.ofæ–¹æ³•ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ æ„æˆä¸€ä¸ªæµ\n@Test\npublic void of()\n{\n    String[] arr = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;};\n    Stream.of(arr).forEach(System.out::println);\n    Stream.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;).forEach(System.out::println);\n    Stream.of(1, 2, &quot;a&quot;).map(item -&gt; item.getClass().getName()).forEach(System.out::println);\n}\n\n//é€šè¿‡Stream.iterateæ–¹æ³•ä½¿ç”¨è¿­ä»£çš„æ–¹å¼æ„é€ ä¸€ä¸ªæ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°\n@Test\npublic void iterate()\n{\n    Stream.iterate(2, item -&gt; item * 2).limit(10).forEach(System.out::println);\n    Stream.iterate(BigInteger.ZERO, n -&gt; n.add(BigInteger.TEN)).limit(10).forEach(System.out::println);\n}\n\n//é€šè¿‡Stream.generateæ–¹æ³•ä»å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªæä¾›å…ƒç´ çš„Supplieræ¥æ„é€ æ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°\n@Test\npublic void generate()\n{\n    Stream.generate(() -&gt; &quot;test&quot;).limit(3).forEach(System.out::println);\n    Stream.generate(Math::random).limit(10).forEach(System.out::println);\n}\n\n//é€šè¿‡IntStreamæˆ–DoubleStreamæ„é€ åŸºæœ¬ç±»å‹çš„æµ\n@Test\npublic void primitive()\n{\n    //æ¼”ç¤ºIntStreamå’ŒDoubleStream\n    IntStream.range(1, 3).forEach(System.out::println);\n    IntStream.range(0, 3).mapToObj(i -&gt; &quot;x&quot;).forEach(System.out::println);\n\n    IntStream.rangeClosed(1, 3).forEach(System.out::println);\n    DoubleStream.of(1.1, 2.2, 3.3).forEach(System.out::println);\n\n    //å„ç§è½¬æ¢ï¼Œåé¢æ³¨é‡Šä»£è¡¨äº†è¾“å‡ºç»“æœ\n    System.out.println(IntStream.of(1, 2).toArray().getClass()); //class [I\n    System.out.println(Stream.of(1, 2).mapToInt(Integer::intValue).toArray().getClass()); //class [I\n    System.out.println(IntStream.of(1, 2).boxed().toArray().getClass()); //class [Ljava.lang.Object;\n    System.out.println(IntStream.of(1, 2).asDoubleStream().toArray().getClass()); //class [D\n    System.out.println(IntStream.of(1, 2).asLongStream().toArray().getClass()); //class [J\n\n    //æ³¨æ„åŸºæœ¬ç±»å‹æµå’Œè£…ç®±åçš„æµçš„åŒºåˆ«\n    Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;).stream()   // Stream&lt;String&gt;\n            .mapToInt(String::length)       // IntStream\n            .asLongStream()                 // LongStream\n            .mapToDouble(x -&gt; x / 10.0)     // DoubleStream\n            .boxed()                        // Stream&lt;Double&gt;\n            .mapToLong(x -&gt; 1L)             // LongStream\n            .mapToObj(x -&gt; &quot;&quot;)              // Stream&lt;String&gt;\n            .collect(Collectors.toList());\n}\n</code></pre><h3>filter</h3><p>filteræ–¹æ³•å¯ä»¥å®ç°è¿‡æ»¤æ“ä½œï¼Œç±»ä¼¼SQLä¸­çš„whereã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç ï¼Œé€šè¿‡filteræ–¹æ³•å®ç°æŸ¥è¯¢æ‰€æœ‰è®¢å•ä¸­æœ€è¿‘åŠå¹´é‡‘é¢å¤§äº40çš„è®¢å•ï¼Œé€šè¿‡è¿ç»­å åŠ filteræ–¹æ³•è¿›è¡Œå¤šæ¬¡æ¡ä»¶è¿‡æ»¤ï¼š</p><pre><code>//æœ€è¿‘åŠå¹´çš„é‡‘é¢å¤§äº40çš„è®¢å•\norders.stream()\n        .filter(Objects::nonNull) //è¿‡æ»¤nullå€¼\n        .filter(order -&gt; order.getPlacedAt().isAfter(LocalDateTime.now().minusMonths(6))) //æœ€è¿‘åŠå¹´çš„è®¢å•\n        .filter(order -&gt; order.getTotalPrice() &gt; 40) //é‡‘é¢å¤§äº40çš„è®¢å•\n        .forEach(System.out::println);\t\n</code></pre><p>å¦‚æœä¸ä½¿ç”¨Streamçš„è¯ï¼Œå¿…ç„¶éœ€è¦ä¸€ä¸ªä¸­é—´é›†åˆæ¥æ”¶é›†è¿‡æ»¤åçš„ç»“æœï¼Œè€Œä¸”æ‰€æœ‰çš„è¿‡æ»¤æ¡ä»¶ä¼šå †ç§¯åœ¨ä¸€èµ·ï¼Œä»£ç å†—é•¿ä¸”ä¸æ˜“è¯»ã€‚</p><h3>map</h3><p>mapæ“ä½œå¯ä»¥åšè½¬æ¢ï¼ˆæˆ–è€…è¯´æŠ•å½±ï¼‰ï¼Œç±»ä¼¼SQLä¸­çš„selectã€‚ä¸ºäº†å¯¹æ¯”ï¼Œæˆ‘ç”¨ä¸¤ç§æ–¹å¼ç»Ÿè®¡è®¢å•ä¸­æ‰€æœ‰å•†å“çš„æ•°é‡ï¼Œå‰ä¸€ç§æ˜¯é€šè¿‡ä¸¤æ¬¡éå†å®ç°ï¼Œåä¸€ç§æ˜¯é€šè¿‡ä¸¤æ¬¡mapToLong+sumæ–¹æ³•å®ç°ï¼š</p><pre><code>//è®¡ç®—æ‰€æœ‰è®¢å•å•†å“æ•°é‡\n//é€šè¿‡ä¸¤æ¬¡éå†å®ç°\nLongAdder longAdder = new LongAdder();\norders.stream().forEach(order -&gt;\n        order.getOrderItemList().forEach(orderItem -&gt; longAdder.add(orderItem.getProductQuantity())));\n\n//ä½¿ç”¨ä¸¤æ¬¡mapToLong+sumæ–¹æ³•å®ç°\nassertThat(longAdder.longValue(), is(orders.stream().mapToLong(order -&gt;\n        order.getOrderItemList().stream()\n                .mapToLong(OrderItem::getProductQuantity).sum()).sum()));\n</code></pre><p>æ˜¾ç„¶ï¼Œåä¸€ç§æ–¹å¼æ— éœ€ä¸­é—´å˜é‡longAdderï¼Œæ›´ç›´è§‚ã€‚</p><p>è¿™é‡Œå†è¡¥å……ä¸€ä¸‹ï¼Œä½¿ç”¨forå¾ªç¯ç”Ÿæˆæ•°æ®ï¼Œæ˜¯æˆ‘ä»¬å¹³æ—¶å¸¸ç”¨çš„æ“ä½œï¼Œä¹Ÿæ˜¯è¿™ä¸ªè¯¾ç¨‹ä¼šå¤§é‡ç”¨åˆ°çš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€è¡Œä»£ç ä½¿ç”¨IntStreamé…åˆmapToObjæ›¿ä»£forå¾ªç¯æ¥ç”Ÿæˆæ•°æ®ï¼Œæ¯”å¦‚ç”Ÿæˆ10ä¸ªProductå…ƒç´ æ„æˆListï¼š</p><pre><code>//æŠŠIntStreamé€šè¿‡è½¬æ¢Stream&lt;Project&gt;\nSystem.out.println(IntStream.rangeClosed(1,10)\n        .mapToObj(i-&gt;new Product((long)i, &quot;product&quot;+i, i*100.0))\n        .collect(toList()));\n</code></pre><h3>flatMap</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹flatMapå±•å¼€æˆ–è€…å«æ‰å¹³åŒ–æ“ä½œï¼Œç›¸å½“äºmap+flatï¼Œé€šè¿‡mapæŠŠæ¯ä¸€ä¸ªå…ƒç´ æ›¿æ¢ä¸ºä¸€ä¸ªæµï¼Œç„¶åå±•å¼€è¿™ä¸ªæµã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰è®¢å•çš„æ€»ä»·æ ¼ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul>\n<li>ç›´æ¥é€šè¿‡åŸå§‹å•†å“åˆ—è¡¨çš„å•†å“ä¸ªæ•°*å•†å“å•ä»·ç»Ÿè®¡çš„è¯ï¼Œå¯ä»¥å…ˆæŠŠè®¢å•é€šè¿‡flatMapå±•å¼€æˆå•†å“æ¸…å•ï¼Œä¹Ÿå°±æ˜¯æŠŠOrderæ›¿æ¢ä¸ºStream<orderitem>ï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªOrderItemç”¨mapToDoubleè½¬æ¢è·å¾—å•†å“æ€»ä»·ï¼Œæœ€åè¿›è¡Œä¸€æ¬¡sumæ±‚å’Œï¼›</orderitem></li>\n<li>åˆ©ç”¨flatMapToDoubleæ–¹æ³•æŠŠåˆ—è¡¨ä¸­æ¯ä¸€é¡¹å±•å¼€æ›¿æ¢ä¸ºä¸€ä¸ªDoubleStreamï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æŠŠæ¯ä¸€ä¸ªè®¢å•è½¬æ¢ä¸ºæ¯ä¸€ä¸ªå•†å“çš„æ€»ä»·ï¼Œç„¶åæ±‚å’Œã€‚</li>\n</ul><pre><code>//ç›´æ¥å±•å¼€è®¢å•å•†å“è¿›è¡Œä»·æ ¼ç»Ÿè®¡\nSystem.out.println(orders.stream()\n        .flatMap(order -&gt; order.getOrderItemList().stream())\n        .mapToDouble(item -&gt; item.getProductQuantity() * item.getProductPrice()).sum());\n\n//å¦ä¸€ç§æ–¹å¼flatMap+mapToDouble=flatMapToDouble\nSystem.out.println(orders.stream()\n        .flatMapToDouble(order -&gt;\n                order.getOrderItemList()\n                        .stream().mapToDouble(item -&gt; item.getProductQuantity() * item.getProductPrice()))\n        .sum());\n</code></pre><p>è¿™ä¸¤ç§æ–¹å¼å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œå¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚</p><h3>sorted</h3><p>sortedæ“ä½œå¯ä»¥ç”¨äºè¡Œå†…æ’åºçš„åœºæ™¯ï¼Œç±»ä¼¼SQLä¸­çš„order byã€‚æ¯”å¦‚ï¼Œè¦å®ç°å¤§äº50å…ƒè®¢å•çš„æŒ‰ä»·æ ¼å€’åºå–å‰5ï¼Œå¯ä»¥é€šè¿‡Order::getTotalPriceæ–¹æ³•å¼•ç”¨ç›´æ¥æŒ‡å®šéœ€è¦æ’åºçš„ä¾æ®å­—æ®µï¼Œé€šè¿‡reversed()å®ç°å€’åºï¼š</p><pre><code>//å¤§äº50çš„è®¢å•,æŒ‰ç…§è®¢å•ä»·æ ¼å€’åºå‰5\norders.stream().filter(order -&gt; order.getTotalPrice() &gt; 50)\n        .sorted(comparing(Order::getTotalPrice).reversed())\n        .limit(5)\n        .forEach(System.out::println);\t\n</code></pre><h3>distinct</h3><p>distinctæ“ä½œçš„ä½œç”¨æ˜¯å»é‡ï¼Œç±»ä¼¼SQLä¸­çš„distinctã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å®ç°ï¼š</p><ul>\n<li>æŸ¥è¯¢å»é‡åçš„ä¸‹å•ç”¨æˆ·ã€‚ä½¿ç”¨mapä»è®¢å•æå–å‡ºè´­ä¹°ç”¨æˆ·ï¼Œç„¶åä½¿ç”¨distinctå»é‡ã€‚</li>\n<li>æŸ¥è¯¢è´­ä¹°è¿‡çš„å•†å“åã€‚ä½¿ç”¨flatMap+mapæå–å‡ºè®¢å•ä¸­æ‰€æœ‰çš„å•†å“åï¼Œç„¶åä½¿ç”¨distinctå»é‡ã€‚</li>\n</ul><pre><code>//å»é‡çš„ä¸‹å•ç”¨æˆ·\nSystem.out.println(orders.stream().map(order -&gt; order.getCustomerName()).distinct().collect(joining(&quot;,&quot;)));\n\n//æ‰€æœ‰è´­ä¹°è¿‡çš„å•†å“\nSystem.out.println(orders.stream()\n        .flatMap(order -&gt; order.getOrderItemList().stream())\n        .map(OrderItem::getProductName)\n        .distinct().collect(joining(&quot;,&quot;)));\n</code></pre><h3>skip &amp; limit</h3><p>skipå’Œlimitæ“ä½œç”¨äºåˆ†é¡µï¼Œç±»ä¼¼MySQLä¸­çš„limitã€‚å…¶ä¸­ï¼Œskipå®ç°è·³è¿‡ä¸€å®šçš„é¡¹ï¼Œlimitç”¨äºé™åˆ¶é¡¹æ€»æ•°ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¸¤æ®µä»£ç ï¼š</p><ul>\n<li>æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢å‰2ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´ï¼›</li>\n<li>æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢ç¬¬3å’Œç¬¬4ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´ã€‚</li>\n</ul><pre><code>//æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢å‰2ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´\norders.stream()\n        .sorted(comparing(Order::getPlacedAt))\n        .map(order -&gt; order.getCustomerName() + &quot;@&quot; + order.getPlacedAt())\n        .limit(2).forEach(System.out::println);\n//æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢ç¬¬3å’Œç¬¬4ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´\norders.stream()\n        .sorted(comparing(Order::getPlacedAt))\n        .map(order -&gt; order.getCustomerName() + &quot;@&quot; + order.getPlacedAt())\n        .skip(2).limit(2).forEach(System.out::println);\n</code></pre><h3>collect</h3><p>collectæ˜¯æ”¶é›†æ“ä½œï¼Œå¯¹æµè¿›è¡Œç»ˆç»“ï¼ˆç»ˆæ­¢ï¼‰æ“ä½œï¼ŒæŠŠæµå¯¼å‡ºä¸ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç»“æ„ã€‚â€œç»ˆç»“â€æ˜¯æŒ‡ï¼Œå¯¼å‡ºåï¼Œæ— æ³•å†ä¸²è”ä½¿ç”¨å…¶ä»–ä¸­é—´æ“ä½œï¼Œæ¯”å¦‚filterã€mapã€flatmapã€sortedã€distinctã€limitã€skipã€‚</p><p>åœ¨Streamæ“ä½œä¸­ï¼Œcollectæ˜¯æœ€å¤æ‚çš„ç»ˆç»“æ“ä½œï¼Œæ¯”è¾ƒç®€å•çš„ç»ˆç»“æ“ä½œè¿˜æœ‰forEachã€toArrayã€minã€maxã€countã€anyMatchç­‰ï¼Œæˆ‘å°±ä¸å†å±•å¼€äº†ï¼Œä½ å¯ä»¥æŸ¥è¯¢<a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html\">JDKæ–‡æ¡£</a>ï¼Œæœç´¢terminal operationæˆ–intermediate operationã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡6ä¸ªæ¡ˆä¾‹ï¼Œæ¥æ¼”ç¤ºä¸‹å‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„collectæ“ä½œï¼š</p><ul>\n<li>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå®ç°äº†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œç”Ÿæˆä¸€å®šä½æ•°çš„éšæœºå­—ç¬¦ä¸²ã€‚</li>\n<li>ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toSeté™æ€æ–¹æ³•æ”¶é›†ä¸ºSetå»é‡ï¼Œå¾—åˆ°å»é‡åçš„ä¸‹å•ç”¨æˆ·ï¼Œå†é€šè¿‡Collectors.joiningé™æ€æ–¹æ³•å®ç°å­—ç¬¦ä¸²æ‹¼æ¥ã€‚</li>\n<li>ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toCollectioné™æ€æ–¹æ³•è·å¾—æŒ‡å®šç±»å‹çš„é›†åˆï¼Œæ¯”å¦‚æŠŠList<order>è½¬æ¢ä¸ºLinkedList<order>ã€‚</order></order></li>\n<li>ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toMapé™æ€æ–¹æ³•å°†å¯¹è±¡å¿«é€Ÿè½¬æ¢ä¸ºMapï¼ŒKeyæ˜¯è®¢å•IDã€Valueæ˜¯ä¸‹å•ç”¨æˆ·åã€‚</li>\n<li>ç¬¬äº”ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toMapé™æ€æ–¹æ³•å°†å¯¹è±¡è½¬æ¢ä¸ºMapã€‚Keyæ˜¯ä¸‹å•ç”¨æˆ·åï¼ŒValueæ˜¯ä¸‹å•æ—¶é—´ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½å¤šæ¬¡ä¸‹å•ï¼Œæ‰€ä»¥ç›´æ¥åœ¨è¿™é‡Œè¿›è¡Œäº†åˆå¹¶ï¼Œåªè·å–æœ€è¿‘ä¸€æ¬¡çš„ä¸‹å•æ—¶é—´ã€‚</li>\n<li>ç¬¬å…­ä¸ªæ¡ˆä¾‹ï¼Œä½¿ç”¨Collectors.summingIntæ–¹æ³•å¯¹å•†å“æ•°é‡æ±‚å’Œï¼Œå†ä½¿ç”¨Collectors.averagingIntæ–¹æ³•å¯¹ç»“æœæ±‚å¹³å‡å€¼ï¼Œä»¥ç»Ÿè®¡æ‰€æœ‰è®¢å•å¹³å‡è´­ä¹°çš„å•†å“æ•°é‡ã€‚</li>\n</ul><pre><code>//ç”Ÿæˆä¸€å®šä½æ•°çš„éšæœºå­—ç¬¦ä¸²\nSystem.out.println(random.ints(48, 122)\n    .filter(i -&gt; (i &lt; 57 || i &gt; 65) &amp;&amp; (i &lt; 90 || i &gt; 97))\n    .mapToObj(i -&gt; (char) i)\n    .limit(20)\n    .collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)\n    .toString());\n\n//æ‰€æœ‰ä¸‹å•çš„ç”¨æˆ·ï¼Œä½¿ç”¨toSetå»é‡åå®ç°å­—ç¬¦ä¸²æ‹¼æ¥\nSystem.out.println(orders.stream()\n    .map(order -&gt; order.getCustomerName()).collect(toSet())\n    .stream().collect(joining(&quot;,&quot;, &quot;[&quot;, &quot;]&quot;)));\n\n//ç”¨toCollectionæ”¶é›†å™¨æŒ‡å®šé›†åˆç±»å‹\nSystem.out.println(orders.stream().limit(2).collect(toCollection(LinkedList::new)).getClass());\n\n//ä½¿ç”¨toMapè·å–è®¢å•ID+ä¸‹å•ç”¨æˆ·åçš„Map\norders.stream()\n    .collect(toMap(Order::getId, Order::getCustomerName))\n    .entrySet().forEach(System.out::println);\n\n//ä½¿ç”¨toMapè·å–ä¸‹å•ç”¨æˆ·å+æœ€è¿‘ä¸€æ¬¡ä¸‹å•æ—¶é—´çš„Map\norders.stream()\n    .collect(toMap(Order::getCustomerName, Order::getPlacedAt, (x, y) -&gt; x.isAfter(y) ? x : y))\n    .entrySet().forEach(System.out::println);\n\n//è®¢å•å¹³å‡è´­ä¹°çš„å•†å“æ•°é‡\nSystem.out.println(orders.stream().collect(averagingInt(order -&gt;\n    order.getOrderItemList().stream()\n            .collect(summingInt(OrderItem::getProductQuantity)))));\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™6ä¸ªæ“ä½œä½¿ç”¨Streamæ–¹å¼ä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°ï¼Œä½†ä½¿ç”¨éStreamæ–¹å¼å®ç°çš„è¯ï¼Œéƒ½éœ€è¦å‡ è¡Œç”šè‡³åå‡ è¡Œä»£ç ã€‚</p><p>æœ‰å…³Collectorsç±»çš„ä¸€äº›å¸¸ç”¨é™æ€æ–¹æ³•ï¼Œæˆ‘æ€»ç»“åˆ°äº†ä¸€å¼ å›¾ä¸­ï¼Œä½ å¯ä»¥å†æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5a/de/5af5ba60d7af2c8780b69bc6c71cf3de.png?wh=2923*2375\" alt=\"\"></p><p>å…¶ä¸­ï¼ŒgroupByå’ŒpartitionByæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å’Œä½ ä¸¾ä¾‹ä»‹ç»ã€‚</p><h3>groupBy</h3><p>groupByæ˜¯åˆ†ç»„ç»Ÿè®¡æ“ä½œï¼Œç±»ä¼¼SQLä¸­çš„group byå­å¥ã€‚å®ƒå’Œåé¢ä»‹ç»çš„partitioningByéƒ½æ˜¯ç‰¹æ®Šçš„æ”¶é›†å™¨ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç»ˆç»“æ“ä½œã€‚åˆ†ç»„æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¸ºå¸®ä½ ç†è§£å¾—æ›´é€å½»ï¼Œæˆ‘å‡†å¤‡äº†8ä¸ªæ¡ˆä¾‹ï¼š</p><ul>\n<li>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨Collectors.countingæ–¹æ³•ç»Ÿè®¡æ¯ä¸ªäººçš„ä¸‹å•æ•°é‡ï¼Œå†æŒ‰ç…§ä¸‹å•æ•°é‡å€’åºè¾“å‡ºã€‚</li>\n<li>ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨Collectors.summingDoubleæ–¹æ³•ç»Ÿè®¡è®¢å•æ€»é‡‘é¢ï¼Œå†æŒ‰æ€»é‡‘é¢å€’åºè¾“å‡ºã€‚</li>\n<li>ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨ä¸¤æ¬¡Collectors.summingIntæ–¹æ³•ç»Ÿè®¡å•†å“é‡‡è´­æ•°é‡ï¼Œå†æŒ‰æ€»æ•°é‡å€’åºè¾“å‡ºã€‚</li>\n<li>ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œç»Ÿè®¡è¢«é‡‡è´­æœ€å¤šçš„å•†å“ã€‚å…ˆé€šè¿‡flatMapæŠŠè®¢å•è½¬æ¢ä¸ºå•†å“ï¼Œç„¶åæŠŠå•†å“åä½œä¸ºKeyã€Collectors.summingIntä½œä¸ºValueåˆ†ç»„ç»Ÿè®¡é‡‡è´­æ•°é‡ï¼Œå†æŒ‰Valueå€’åºè·å–ç¬¬ä¸€ä¸ªEntryï¼Œæœ€åæŸ¥è¯¢Keyå°±å¾—åˆ°äº†å”®å‡ºæœ€å¤šçš„å•†å“ã€‚</li>\n<li>ç¬¬äº”ä¸ªæ¡ˆä¾‹ï¼ŒåŒæ ·ç»Ÿè®¡é‡‡è´­æœ€å¤šçš„å•†å“ã€‚ç›¸æ¯”ç¬¬å››ä¸ªæ¡ˆä¾‹æ’åºMapçš„æ–¹å¼ï¼Œè¿™æ¬¡ç›´æ¥ä½¿ç”¨Collectors.maxByæ”¶é›†å™¨è·å¾—æœ€å¤§çš„Entryã€‚</li>\n<li>ç¬¬å…­ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡ç”¨æˆ·ä¸‹çš„é‡‘é¢æœ€é«˜çš„è®¢å•ã€‚Keyæ˜¯ç”¨æˆ·åï¼ŒValueæ˜¯Orderï¼Œç›´æ¥é€šè¿‡Collectors.maxByæ–¹æ³•æ‹¿åˆ°é‡‘é¢æœ€é«˜çš„è®¢å•ï¼Œç„¶åé€šè¿‡collectingAndThenå®ç°Optional.getçš„å†…å®¹æå–ï¼Œæœ€åéå†Key/Valueå³å¯ã€‚</li>\n<li>ç¬¬ä¸ƒä¸ªæ¡ˆä¾‹ï¼Œæ ¹æ®ä¸‹å•å¹´æœˆåˆ†ç»„ç»Ÿè®¡è®¢å•IDåˆ—è¡¨ã€‚Keyæ˜¯æ ¼å¼åŒ–æˆå¹´æœˆåçš„ä¸‹å•æ—¶é—´ï¼ŒValueç›´æ¥é€šè¿‡Collectors.mappingæ–¹æ³•è¿›è¡Œäº†è½¬æ¢ï¼ŒæŠŠè®¢å•åˆ—è¡¨è½¬æ¢ä¸ºè®¢å•IDæ„æˆçš„Listã€‚</li>\n<li>ç¬¬å…«ä¸ªæ¡ˆä¾‹ï¼Œæ ¹æ®ä¸‹å•å¹´æœˆ+ç”¨æˆ·åä¸¤æ¬¡åˆ†ç»„ç»Ÿè®¡è®¢å•IDåˆ—è¡¨ï¼Œç›¸æ¯”ä¸Šä¸€ä¸ªæ¡ˆä¾‹å¤šäº†ä¸€æ¬¡åˆ†ç»„æ“ä½œï¼Œç¬¬äºŒæ¬¡åˆ†ç»„æ˜¯æŒ‰ç…§ç”¨æˆ·åè¿›è¡Œåˆ†ç»„ã€‚</li>\n</ul><pre><code>//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡ä¸‹å•æ•°é‡\nSystem.out.println(orders.stream().collect(groupingBy(Order::getCustomerName, counting()))\n        .entrySet().stream().sorted(Map.Entry.&lt;String, Long&gt;comparingByValue().reversed()).collect(toList()));\n\n//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•æ€»é‡‘é¢\nSystem.out.println(orders.stream().collect(groupingBy(Order::getCustomerName, summingDouble(Order::getTotalPrice)))\n        .entrySet().stream().sorted(Map.Entry.&lt;String, Double&gt;comparingByValue().reversed()).collect(toList()));\n\n//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡å•†å“é‡‡è´­æ•°é‡\nSystem.out.println(orders.stream().collect(groupingBy(Order::getCustomerName,\n        summingInt(order -&gt; order.getOrderItemList().stream()\n                .collect(summingInt(OrderItem::getProductQuantity)))))\n        .entrySet().stream().sorted(Map.Entry.&lt;String, Integer&gt;comparingByValue().reversed()).collect(toList()));\n\n//ç»Ÿè®¡æœ€å—æ¬¢è¿çš„å•†å“ï¼Œå€’åºåå–ç¬¬ä¸€ä¸ª\norders.stream()\n        .flatMap(order -&gt; order.getOrderItemList().stream())\n        .collect(groupingBy(OrderItem::getProductName, summingInt(OrderItem::getProductQuantity)))\n        .entrySet().stream()\n        .sorted(Map.Entry.&lt;String, Integer&gt;comparingByValue().reversed())\n        .map(Map.Entry::getKey)\n        .findFirst()\n        .ifPresent(System.out::println);\n\n//ç»Ÿè®¡æœ€å—æ¬¢è¿çš„å•†å“çš„å¦ä¸€ç§æ–¹å¼ï¼Œç›´æ¥åˆ©ç”¨maxBy\norders.stream()\n        .flatMap(order -&gt; order.getOrderItemList().stream())\n        .collect(groupingBy(OrderItem::getProductName, summingInt(OrderItem::getProductQuantity)))\n        .entrySet().stream()\n        .collect(maxBy(Map.Entry.comparingByValue()))\n        .map(Map.Entry::getKey)\n        .ifPresent(System.out::println);\n\n//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œé€‰ç”¨æˆ·ä¸‹çš„æ€»é‡‘é¢æœ€å¤§çš„è®¢å•\norders.stream().collect(groupingBy(Order::getCustomerName, collectingAndThen(maxBy(comparingDouble(Order::getTotalPrice)), Optional::get)))\n        .forEach((k, v) -&gt; System.out.println(k + &quot;#&quot; + v.getTotalPrice() + &quot;@&quot; + v.getPlacedAt()));\n\n//æ ¹æ®ä¸‹å•å¹´æœˆåˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•IDåˆ—è¡¨\nSystem.out.println(orders.stream().collect\n        (groupingBy(order -&gt; order.getPlacedAt().format(DateTimeFormatter.ofPattern(&quot;yyyyMM&quot;)),\n                mapping(order -&gt; order.getId(), toList()))));\n\n//æ ¹æ®ä¸‹å•å¹´æœˆ+ç”¨æˆ·åä¸¤æ¬¡åˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•IDåˆ—è¡¨\nSystem.out.println(orders.stream().collect\n        (groupingBy(order -&gt; order.getPlacedAt().format(DateTimeFormatter.ofPattern(&quot;yyyyMM&quot;)),\n                groupingBy(order -&gt; order.getCustomerName(),\n                        mapping(order -&gt; order.getId(), toList())))));\n</code></pre><p>å¦‚æœä¸å€ŸåŠ©Streamè½¬æ¢ä¸ºæ™®é€šçš„Javaä»£ç ï¼Œå®ç°è¿™äº›å¤æ‚çš„æ“ä½œå¯èƒ½éœ€è¦å‡ åè¡Œä»£ç ã€‚</p><h3>partitionBy</h3><p>partitioningByç”¨äºåˆ†åŒºï¼Œåˆ†åŒºæ˜¯ç‰¹æ®Šçš„åˆ†ç»„ï¼Œåªæœ‰trueå’Œfalseä¸¤ç»„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·æŒ‰ç…§æ˜¯å¦ä¸‹å•è¿›è¡Œåˆ†åŒºï¼Œç»™partitioningByæ–¹æ³•ä¼ å…¥ä¸€ä¸ªPredicateä½œä¸ºæ•°æ®åˆ†åŒºçš„åŒºåˆ†ï¼Œè¾“å‡ºæ˜¯Map&lt;Boolean, List&lt;T&gt;&gt;ï¼š</p><pre><code>public static &lt;T&gt;\nCollector&lt;T, ?, Map&lt;Boolean, List&lt;T&gt;&gt;&gt; partitioningBy(Predicate&lt;? super T&gt; predicate) {\n    return partitioningBy(predicate, toList());\n}\n</code></pre><p>æµ‹è¯•ä¸€ä¸‹ï¼ŒpartitioningByé…åˆanyMatchï¼Œå¯ä»¥æŠŠç”¨æˆ·åˆ†ä¸ºä¸‹è¿‡è®¢å•å’Œæ²¡ä¸‹è¿‡è®¢å•ä¸¤ç»„ï¼š</p><pre><code>//æ ¹æ®æ˜¯å¦æœ‰ä¸‹å•è®°å½•è¿›è¡Œåˆ†åŒº\nSystem.out.println(Customer.getData().stream().collect(\n        partitioningBy(customer -&gt; orders.stream().mapToLong(Order::getCustomerId)\n                .anyMatch(id -&gt; id == customer.getId()))));\n</code></pre><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘ç”¨äº†å¤§é‡çš„ç¯‡å¹…å’Œæ¡ˆä¾‹ï¼Œå’Œä½ å±•å¼€ä»‹ç»äº†Streamä¸­å¾ˆå¤šå…·ä½“çš„æµå¼æ“ä½œæ–¹æ³•ã€‚æœ‰äº›æ¡ˆä¾‹å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘å»ºè®®ä½ å¯¹ç€ä»£ç é€ä¸€åˆ°æºç ä¸­æŸ¥çœ‹è¿™äº›æ“ä½œçš„æ–¹æ³•å®šä¹‰ï¼Œä»¥åŠJDKä¸­çš„ä»£ç æ³¨é‡Šã€‚</p><p>æœ€åï¼Œæˆ‘å»ºè®®ä½ æ€è€ƒä¸‹ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­è¿˜ä¼šä½¿ç”¨SQLç»Ÿè®¡å“ªäº›ä¿¡æ¯ï¼Œè¿™äº›SQLæ˜¯å¦ä¹Ÿå¯ä»¥ç”¨Streamæ¥æ”¹å†™å‘¢ï¼ŸStreamçš„APIåšå¤§ç²¾æ·±ï¼Œä½†å…¶ä¸­åˆæœ‰è§„å¾‹å¯å¾ªã€‚è¿™å…¶ä¸­çš„è§„å¾‹ä¸»è¦å°±æ˜¯ï¼Œç†æ¸…æ¥šè¿™äº›APIä¼ å‚çš„å‡½æ•°å¼æ¥å£å®šä¹‰ï¼Œå°±èƒ½ææ˜ç™½åˆ°åº•æ˜¯éœ€è¦æˆ‘ä»¬æä¾›æ•°æ®ã€æ¶ˆè´¹æ•°æ®ã€è¿˜æ˜¯è½¬æ¢æ•°æ®ç­‰ã€‚é‚£ï¼ŒæŒæ¡Streamçš„æ–¹æ³•ä¾¿æ˜¯ï¼Œå¤šæµ‹è¯•å¤šç»ƒä¹ ï¼Œä»¥å¼ºåŒ–è®°å¿†ã€åŠ æ·±ç†è§£ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>ä½¿ç”¨Streamå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹Liståšå„ç§æ“ä½œï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å®ç°åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è§‚å¯Ÿæ•°æ®å˜åŒ–å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæˆ‘ä»¬è¿›è¡Œfilter+mapæ“ä½œï¼Œå¦‚ä½•è§‚å¯Ÿfilteråmapçš„åŸå§‹æ•°æ®å‘¢ï¼Ÿ</li>\n<li>Collectorsç±»æä¾›äº†å¾ˆå¤šç°æˆçš„æ”¶é›†å™¨ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•å®ç°è‡ªå®šä¹‰çš„æ”¶é›†å™¨å‘¢ï¼Ÿæ¯”å¦‚ï¼Œå®ç°ä¸€ä¸ªMostPopularCollectorï¼Œæ¥å¾—åˆ°Listä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ ï¼Œæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</li>\n</ol><pre><code>assertThat(Stream.of(1, 1, 2, 2, 2, 3, 4, 5, 5).collect(new MostPopularCollector&lt;&gt;()).get(), is(2));\nassertThat(Stream.of('a', 'b', 'c', 'c', 'c', 'd').collect(new MostPopularCollector&lt;&gt;()).get(), is('c'));\n</code></pre><p>å…³äºJava 8ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆä½¿ç”¨å¿ƒå¾—å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"31 | åŠ é¤1ï¼šå¸¦ä½ åƒé€è¯¾ç¨‹ä¸­Java 8çš„é‚£äº›é‡è¦çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰","id":212374},"right":{"article_title":"33 | åŠ é¤3ï¼šå®šä½åº”ç”¨é—®é¢˜ï¼Œæ’é”™å¥—è·¯å¾ˆé‡è¦","id":221982}},"comments":[{"had_liked":false,"id":188835,"user_name":"æµ·æ‹‰é²","can_delete":false,"product_type":"c1","uid":1048681,"ip_address":"","ucode":"6E3493295CED6F","user_header":"https://static001.geekbang.org/account/avatar/00/10/00/69/3b1375ca.jpg","comment_is_top":true,"comment_ctime":1584423926,"is_pvip":true,"replies":[{"id":"72851","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584424913,"ip_address":"","comment_id":188835,"utype":1}],"discussion_count":2,"race_medal":1,"score":"9.2233720813889004e+18","product_id":100047701,"comment_content":"ä¸ºäº†å†™ä½œä¸šåˆå»ç¿»äº†ã€ŠJava 8 å®æˆ˜ã€‹ï¼Œæµ‹è¯•ç»ˆäºé€šè¿‡äº†<br>public class MostPopularCollector<br>        implements Collector&lt;Object,   &#47;&#47; æ”¶é›†Stringæµ<br>        Map&lt;Object, Integer&gt;,         &#47;&#47; ç´¯åŠ å™¨æ˜¯ä¸€ä¸ªMapï¼Œkeyä¸ºå­—ç¬¦ï¼Œvalueä¸ºå‡ºç°çš„æ¬¡æ•°<br>        Optional&gt;                     &#47;&#47; è¿”å›çš„æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦<br>{<br><br>    &#47;**<br>     * è¿”å›ä¸€ä¸ªåœ¨è°ƒç”¨æ—¶åˆ›å»ºçš„ç´¯åŠ å™¨<br>     * @return<br>     *&#47;<br>    public Supplier&lt;Map&lt;Object, Integer&gt;&gt; supplier() {<br>        return () -&gt; new HashMap&lt;&gt;();<br>    }<br><br>    &#47;**<br>     * å®šä¹‰æ”¶é›†æµä¸­æ•°æ®é€»è¾‘<br>     * @return<br>     *&#47;<br>    public BiConsumer&lt;Map&lt;Object, Integer&gt;, Object&gt; accumulator() {<br>        return (Map&lt;Object, Integer&gt; acc, Object chart) -&gt;<br>            acc.compute(chart, (key, val) -&gt; val == null ? 1 : val + 1); &#47;&#47; å¦‚æœå½“å‰å­—ç¬¦æœªç»Ÿè®¡åˆ™ç»Ÿè®¡ä¸º1ï¼Œå¦åˆ™+1<br>    }<br><br>    &#47;**<br>     * å¤„ç†å¹¶è¡Œæ“ä½œï¼Œå…¶å®å°±æ˜¯å°†ä¸¤ä¸ªmapåˆæˆä¸€ä¸ªï¼ŒæŠŠvalueåŠ èµ·æ¥<br>     * @return<br>     *&#47;<br>    public BinaryOperator&lt;Map&lt;Object, Integer&gt;&gt; combiner() {<br>        return (Map&lt;Object, Integer&gt; m1,<br>                Map&lt;Object, Integer&gt; m2) -&gt; {<br>            Map&lt;Object, Integer&gt; all = new HashMap&lt;&gt;(m1);<br>            m2.forEach((chart, count) -&gt; all.merge(chart, count, Integer::sum));<br>            return all;<br>        };<br>    }<br><br>    public Function&lt;Map&lt;Object, Integer&gt;, Optional&gt; finisher() {<br>        return (Map&lt;Object, Integer&gt; acc) -&gt; Optional.ofNullable(acc.entrySet()<br>                .stream()<br>                .max(Map.Entry.comparingByValue())<br>                .get().getKey());<br>    }<br><br><br>    public Set&lt;Characteristics&gt; characteristics() {<br>        return Collections.unmodifiableSet(EnumSet.of(Characteristics.CONCURRENT));<br>    }<br>}<br>","like_count":10,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487544,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584424913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1992424,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep3sqfTQey7eKYgGibLnAvaNj9k8gVvIYKVADicOA3DxmXZcDrAkeM8iaJLruiblmEVUr3q2LOVLvYicTw/132","nickname":"éƒ‘å…ˆç”Ÿ","note":"","ucode":"AA0BA751C4F132","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285614,"discussion_content":"// ç•¥å¾®åšäº†ç‚¹æ”¹åŠ¨ï¼Œç»“åˆè€å¸ˆä¹‹å‰è®²çš„ç»Ÿè®¡ä¸ªæ•°çš„æ¡ˆä¾‹ï¼Œæ„Ÿè§‰è¿™æ ·æ›´ç¬¦åˆè€å¸ˆè¦æ±‚å§ï¼Œä¸ªäººæ„šè§>~<\n// Collector<T, A, R>ï¼šT ä¸­é—´æ“ä½œç±»å‹ï¼ŒA ç»“æœç±»å‹ï¼ŒR æœ€ç»ˆè¿”å›ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒA=R\npublic class MostPopularCollector2<T>\n        implements Collector<T, // æ”¶é›†Stringæµ\n        Map<T, LongAdder>, // ç´¯åŠ å™¨æ˜¯ä¸€ä¸ªMapï¼Œkeyä¸ºå­—ç¬¦ï¼Œvalueä¸ºå‡ºç°çš„æ¬¡æ•°\n        Optional<T> > // è¿”å›çš„æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦\n{\n\n    /**\n     * è¿”å›ä¸€ä¸ªåœ¨è°ƒç”¨æ—¶åˆ›å»ºçš„ç´¯åŠ å™¨ // æºæ•°æ®å¯¹è±¡ç±»å‹ï¼ˆä¸­é—´æ“ä½œå¯¹è±¡ç±»å‹ï¼‰\n     */\n    public Supplier<Map<T, LongAdder>> supplier() {\n        return ConcurrentHashMap::new;\n    }\n\n    /**\n     * å®šä¹‰æ”¶é›†æµä¸­æ•°æ®é€»è¾‘ // T ä¸­é—´æ“ä½œç±»å‹\n     */\n    public BiConsumer<Map<T, LongAdder>, T> accumulator() {\n        return (Map<T, LongAdder> acc, T t) ->\n                acc.computeIfAbsent(t, k -> new LongAdder()).increment();\n    }\n\n    /**\n     * å¤„ç†å¹¶è¡Œæ“ä½œï¼Œå…¶å®å°±æ˜¯å°†ä¸¤ä¸ªmapåˆæˆä¸€ä¸ªï¼ŒæŠŠvalueåŠ èµ·æ¥ //åˆå¹¶éƒ¨åˆ†ç»“æœ\n     */\n    public BinaryOperator<Map<T, LongAdder>> combiner() {\n        return (m1, m2) -> {\n            m1.forEach((key, val) -> m2.computeIfAbsent(key, k -> new LongAdder()).add(val.longValue()));\n            return m2;\n        };\n    }\n\n    /**\n     * å¯é€‰ï¼Œå¯¹ç»“æœé›†çš„è½¬æ¢\n     */\n    public Function<Map<T, LongAdder>, Optional<T>> finisher() {\n        return acc -> Optional.ofNullable(acc.entrySet()\n                .stream()\n                .max(Comparator.comparingLong(val -> val.getValue().longValue()))\n                .get().getKey());\n    }\n\n    /**\n     *  å½“å‰æ”¶é›†å™¨çš„ç‰¹æ€§\n     *   CONCURRENT,// å¹¶å‘\n     *   UNORDERED,// æ”¶é›†æ“ä½œä¸èƒ½ä¿è¯ä¿ç•™é¡ºåº\n     *   IDENTITY_FINISH // æ ‡è¯† finisher å°±æ˜¯ identityï¼ˆåŒä¸€æ€§ï¼‰ å‡½æ•°ï¼Œç±»å‹è½¬æ¢è¦æ±‚å¿…é¡»æˆåŠŸã€‚ A=Ræ—¶è®¾ç½®ï¼Œæ­¤æ—¶finisherä¸æ‰§è¡Œ\n     */\n    public Set<Characteristics> characteristics() {\n        return Collections.unmodifiableSet(EnumSet.of(Characteristics.CONCURRENT));\n    }","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1592894516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188742,"user_name":"Wiggle Wiggle","can_delete":false,"product_type":"c1","uid":1036052,"ip_address":"","ucode":"EFE746551BA998","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cf/14/384258ba.jpg","comment_is_top":true,"comment_ctime":1584410230,"is_pvip":false,"replies":[{"id":"72802","content":"æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ­¤å¤–IDEAå·²ç»å¢åŠ äº†éå¸¸æ–¹ä¾¿çš„Streamè°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒhttps:&#47;&#47;www.jetbrains.com&#47;help&#47;idea&#47;analyze-java-stream-operations.html","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584411773,"ip_address":"","comment_id":188742,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720685040005e+18","product_id":100047701,"comment_content":"Stream API æœ‰ä¸ª peek æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ª consumer æ¥æ‰“å°æ•°æ®ï¼Œå¯ä»¥æ¥åœ¨ä»»æ„ transformation æ“ä½œåé¢æŸ¥çœ‹æ•°æ®","like_count":7,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487505,"discussion_content":"æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ­¤å¤–IDEAå·²ç»å¢åŠ äº†éå¸¸æ–¹ä¾¿çš„Streamè°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒhttps://www.jetbrains.com/help/idea/analyze-java-stream-operations.html","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584411773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190818,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":true,"comment_ctime":1584695661,"is_pvip":false,"replies":[{"id":"73333","content":"<br>private static List&lt;Map&gt; getNoRoomList(List&lt;Map&gt; inspectRooms, List&lt;Map&gt; items) {<br>        return items.stream().filter(item-&gt;inspectRooms.stream().noneMatch(inspectRoom-&gt;inspectRoom.get(&quot;project&quot;).equals(item.get(&quot;checkItem&quot;))))<br>                .collect(Collectors.toList());<br>    }","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584706312,"ip_address":"","comment_id":190818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720556192993e+18","product_id":100047701,"comment_content":"private List&lt;Map&gt; getNoRoomList(List&lt;Map&gt; inspectRooms, List&lt;Map&gt; items) {<br>    boolean flag = false;<br>    List&lt;Map&gt; noInspectRoom = new ArrayList&lt;&gt;();<br>    for (Map item: items) {<br>        for (Map inspectRoom: inspectRooms) {<br>            if (inspectRoom.get(&quot;project&quot;).equals(item.get(&quot;checkItem&quot;))) {<br>                flag = true;<br>                break;<br>            }<br>        }<br>        if (!flag) {<br>            noInspectRoom.add(item);<br>        }else {<br>            flag = false;<br>        }<br>    }<br>    return noInspectRoom;<br>}<br><br>æˆ‘ç›´æ¥è´´æˆ‘å†™çš„å¤„ç†ä»£ç å§ï¼Œåº”è¯¥å¯ä»¥ç†è§£æˆ‘çš„æƒ³æ³•ï¼Œè¿™æµ‹è¯•ç”¨ä¾‹è¿˜çœŸä¸å¥½å†™ã€‚","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488060,"discussion_content":"\nprivate static List&amp;lt;Map&amp;gt; getNoRoomList(List&amp;lt;Map&amp;gt; inspectRooms, List&amp;lt;Map&amp;gt; items) {\n        return items.stream().filter(item-&amp;gt;inspectRooms.stream().noneMatch(inspectRoom-&amp;gt;inspectRoom.get(&amp;quot;project&amp;quot;).equals(item.get(&amp;quot;checkItem&amp;quot;))))\n                .collect(Collectors.toList());\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584706312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190385,"user_name":"é™ˆå¤©æŸ±","can_delete":false,"product_type":"c1","uid":1696225,"ip_address":"","ucode":"917BFDC845760D","user_header":"https://static001.geekbang.org/account/avatar/00/19/e1/e1/441df85d.jpg","comment_is_top":false,"comment_ctime":1584634814,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35944373182","product_id":100047701,"comment_content":"è€å¸ˆæŠŠstreamçš„å¸¸ç”¨apiä¸sqlæ“ä½œè”ç³»èµ·æ¥ï¼Œç®€ç›´æ˜¯å¤ªâ€œäº²æ°‘â€äº†ï¼","like_count":8},{"had_liked":false,"id":188937,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1584436052,"is_pvip":true,"replies":[{"id":"72888","content":"éå¸¸å¥½","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584438820,"ip_address":"","comment_id":188937,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35944174420","product_id":100047701,"comment_content":"ä»¥å‰çœŸæ²¡æœ‰ç‰¹æ„å»å…³æ³¨æ”¶é›†å™¨ï¼Œçœ‹äº†åšäº†ï¼Œå‚è€ƒäº†2ç‰‡æ–‡ç« ï¼š<br>https:&#47;&#47;www.cnblogs.com&#47;yw0219&#47;p&#47;9589124.html<br>https:&#47;&#47;my.oschina.net&#47;piorcn&#47;blog&#47;424375<br>æœ€ç»ˆæå®šï¼Œè¯·è€å¸ˆæŒ‡ç‚¹<br><br>https:&#47;&#47;github.com&#47;y645194203&#47;geektime-java-100&#47;blob&#47;master&#47;MostPopularCollector.java","like_count":8,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487571,"discussion_content":"éå¸¸å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584438820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188703,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1584406348,"is_pvip":false,"replies":[{"id":"72801","content":"IDEAå·²ç»å¢åŠ äº†éå¸¸æ–¹ä¾¿çš„Streamè°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒhttps:&#47;&#47;www.jetbrains.com&#47;help&#47;idea&#47;analyze-java-stream-operations.html","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584411760,"ip_address":"","comment_id":188703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23059242828","product_id":100047701,"comment_content":"æˆ‘ç›®å‰æƒ³åˆ°çš„æ•°æ®è§‚å¯Ÿçš„æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œä¸€ç§æ˜¯é€šè¿‡logæ‰“å°ï¼Œä¸€ç§æ˜¯debugã€‚ä½†æˆ‘è‚¯å®šè¿™éƒ½ä¸æ˜¯å•¥å¥½åŠæ³•ï¼Œå¸Œæœ›è€å¸ˆå‘ŠçŸ¥è§£æ”¾ç”Ÿäº§åŠ›çš„æ–¹æ³•ã€‚","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487494,"discussion_content":"IDEAå·²ç»å¢åŠ äº†éå¸¸æ–¹ä¾¿çš„Streamè°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒhttps://www.jetbrains.com/help/idea/analyze-java-stream-operations.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584411760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210104,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1587687877,"is_pvip":false,"replies":[{"id":"78325","content":"è¿˜æ˜¯éœ€è¦è‡ªå·±æƒ³æ¡ˆä¾‹å®é™…å†™ä¸€ä¸‹ä»£ç ","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1587692357,"ip_address":"","comment_id":210104,"utype":1}],"discussion_count":2,"race_medal":1,"score":"18767557061","product_id":100047701,"comment_content":"æ¯å¤©æ™šä¸Šå›å»æ•²ä¸€ç‚¹ï¼ŒèŠ±äº†å¥½å‡ ä¸ªæ™šä¸Šï¼Œç»ˆäºæŠŠè¿™ä¸¤èŠ‚ä¸­çš„æ‰€æœ‰ä»£ç è¿è¡Œäº†ä¸€éï¼Œåªä¸è¿‡ä¼¼æ‡‚éæ‡‚ï¼Œè¿˜è¦ç»§ç»­ç»ƒä¹ ã€‚å·²ç»å¼€å§‹åœ¨å·¥ä½œä¸­è¿ç”¨ä¸€äº›ç®€å•çš„äº†ï¼Œè¯»å®Œè¿™ç¯‡æ–‡ç« å¯èƒ½åªéœ€è¦20åˆ†é’Ÿï¼Œä½†æŠŠæ‰€æœ‰ä»£ç éƒ½ç»ƒä¹ ä¸€éï¼Œå°±ä¸æ˜¯20åˆ†é’Ÿçš„äº‹äº†ï¼Œè¦æŒç»­å­¦ä¹ æ‰è¡Œã€‚ğŸ’ªğŸ½","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492949,"discussion_content":"è¿˜æ˜¯éœ€è¦è‡ªå·±æƒ³æ¡ˆä¾‹å®é™…å†™ä¸€ä¸‹ä»£ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587692357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":245794,"discussion_content":"æ”¶åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587700135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205520,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1586662583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18766531767","product_id":100047701,"comment_content":"Idea åœ¨debugæ¨¡å¼æœ‰ä¸ªTrace Current Stream ChainåŠŸèƒ½ï¼Œå¯ä»¥å¾ˆå¥½çš„æŸ¥çœ‹æ•°æ®å˜åŒ–","like_count":5},{"had_liked":false,"id":219147,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1589955726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10179890318","product_id":100047701,"comment_content":"ä¸ªäººè®¤ä¸ºï¼Œå®¢æˆ·ç«¯ä¸å®‰å…¨çš„ä¸»è¦åŸå› æ˜¯ï¼Œè®¡ç®—æœºç½‘ç»œåè®®ã€‚<br>ç½‘ç»œç¯å¢ƒä¸­ä¸€åˆ‡éƒ½æ˜¯ä¸å¯é¢„çŸ¥ï¼Œåˆ‡ä¸å®‰å…¨çš„ã€‚<br>æ— æ³•ä¿è¯ä½ å‘å‡ºå»çš„æ•°æ®ï¼Œå°±æ˜¯æœåŠ¡å™¨è¦çš„æ•°æ®ï¼›ä¹Ÿæ— æ³•ä¿è¯ä½ å‘çš„æ•°æ®é¡ºåºæ˜¯1ï¼Œ2ï¼Œ3æœåŠ¡å™¨æ”¶åˆ°çš„å°±æ˜¯1ï¼Œ2ï¼Œ3.æœ‰å¯èƒ½æœåŠ¡å™¨æ”¶åˆ°çš„æ˜¯ã€3ï¼Œ2ï¼Œ1ã€‘  ã€ 2ï¼Œ1ï¼Œ3ã€‘ ã€ 3ï¼Œ1ï¼Œ2ã€‘ï¼Œç”šè‡³æœ‰å¯èƒ½ã€111ã€‘æˆ–è€…å‹æ ¹æ”¶ä¸åˆ°ã€‚<br>åœ¨ç½‘ç»œä¸­ï¼Œä¼ è¾“æ•°æ®çš„æ–¹å¼ï¼Œæ–¹å¼æ˜¯å¹¿æ’­ï¼Œæ— æ¡ä»¶è½¬å‘ï¼Œå°±æ˜¯ä»»ä½•äººéƒ½æœ‰å¯èƒ½æ”¶åˆ°ï¼Œæ‰€ä»¥å¿…è¦çš„å°±æ˜¯åŠ å¯†ã€‚é˜²æ­¢å¯¹æ–¹çŸ¥é“ã€‚<br>ä»»ä½•äººéƒ½èƒ½æ”¶åˆ°ï¼Œä»»ä½•äººä¹Ÿéƒ½æœ‰æƒåŠ›ç»§ç»­è½¬å‘ï¼Œè°éƒ½ä¸æ•¢ä¿è¯ï¼Œè½¬å‘çš„æ—¶å€™ä¼šä¸ä¼šç»™ä½ å¢åŠ äº›ä¸å®‰å…¨çš„ä¿¡æ¯ã€‚è¿™ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯éœ€è¦æ ¡éªŒã€‚","like_count":2},{"had_liked":false,"id":197636,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1585388952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175323544","product_id":100047701,"comment_content":"æˆ‘æ„Ÿè§‰ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ï¼Œfunction,optional,consumer,supplier,predicateæ¥å£ã€‚åœ¨streamçš„å­¦ä¹ ä¸­ï¼Œé€šè¿‡å•è¯çŒœç”¨æ³•ã€‚","like_count":2},{"had_liked":false,"id":196469,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1585284016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175218608","product_id":100047701,"comment_content":"å®ç”¨ï¼","like_count":2},{"had_liked":false,"id":190032,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1584595905,"is_pvip":false,"replies":[{"id":"73134","content":"æŠŠæµ‹è¯•ç”¨ä¾‹å¸–ä¸€ä¸‹ï¼Œä¸å¤ªæ˜ç™½l1å’Œl2æ˜¯å•¥ã€‚ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584599070,"ip_address":"","comment_id":190032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174530497","product_id":100047701,"comment_content":"List&lt;Map&gt; l1ï¼ŒList&lt;Map&gt; l2ï¼Œä¸¤ä¸ªlistï¼Œl1ä¸­æœ‰å››ä¸ªmapï¼Œå…¶ä¸­æœ‰keyåˆ†åˆ«ä¸º1ã€2ã€3ã€4çš„å››ä¸ªå­—æ®µï¼Œl2æœ‰ä¸¤ä¸ªmapï¼Œå…¶ä¸­æœ‰keyåˆ†åˆ«ä¸º1ï¼Œ2çš„l1ä¸­ä¸€æ ·çš„å­—æ®µï¼Œæ€ä¹ˆç­›é€‰æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªlistï¼Œåªæœ‰keyä¸º3ã€4å¯¹åº”çš„ä¸¤ä¸ªmapï¼Ÿå†™çš„æ¯”è¾ƒä¹±ï¼Œè¿˜è¯·è€å¸ˆè§è°…ï¼Œæˆ‘æƒ³äº†ä¸‹æ²¡æƒ³å‡ºæ¥ï¼Œæœ€åforå¾ªç¯åšçš„ã€‚","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487859,"discussion_content":"æŠŠæµ‹è¯•ç”¨ä¾‹å¸–ä¸€ä¸‹ï¼Œä¸å¤ªæ˜ç™½l1å’Œl2æ˜¯å•¥ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584599070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189712,"user_name":"åˆè§","can_delete":false,"product_type":"c1","uid":1305062,"ip_address":"","ucode":"14540A66AB6277","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/e6/ec76a623.jpg","comment_is_top":false,"comment_ctime":1584542016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10174476608","product_id":100047701,"comment_content":"ç°åœ¨åœ¨ç”Ÿäº§å®è·µç”¨ç”¨äº†å¾ˆå¤šstreamï¼Œçœ‹äº†æ–‡ç¨¿ä»¥åï¼Œå‘ç°è‡ªå·±åœ¨æœ‰äº›ä½¿ç”¨ä¸Šä¸²è”çš„ä¸å¤Ÿæ·±å…¥ï¼Œç­‰æœ‰æ—¶é—´é’ˆå¯¹é‚£äº›æ“ä½œè¿›è¡Œæ·±å…¥çš„çš„ä¸²è”","like_count":2},{"had_liked":false,"id":189672,"user_name":"insight","can_delete":false,"product_type":"c1","uid":1313322,"ip_address":"","ucode":"6F4E51502D0224","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/2a/c7f5d3ac.jpg","comment_is_top":false,"comment_ctime":1584539919,"is_pvip":false,"replies":[{"id":"73042","content":"çœ‹ä¸€ä¸‹toArrayçš„è¿”å›ç±»å‹å¯¹æ¯”ä¸€ä¸‹è¾“å‡ºå°±çŸ¥é“äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584540426,"ip_address":"","comment_id":189672,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174474511","product_id":100047701,"comment_content":" &#47;&#47;å„ç§è½¬æ¢ï¼Œåé¢æ³¨é‡Šä»£è¡¨äº†è¾“å‡ºç»“æœ    <br>System.out.println(IntStream.of(1, 2).toArray().getClass()); &#47;&#47;class [I    <br>System.out.println(Stream.of(1, 2).mapToInt(Integer::intValue).toArray().getClass()); &#47;&#47;class [I    System.out.println(IntStream.of(1, 2).boxed().toArray().getClass()); &#47;&#47;class [Ljava.lang.Object;    System.out.println(IntStream.of(1, 2).asDoubleStream().toArray().getClass()); &#47;&#47;class [D    System.out.println(IntStream.of(1, 2).asLongStream().toArray().getClass()); &#47;&#47;class [J<br><br>è€å¸ˆï¼Œè¿™ä¸€æ®µä»£ç çš„è¾“å‡ºç»“æœä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„å‘€ï¼Ÿæ²¡çœ‹æ‡‚ï¼Œæ±‚æŒ‡æ•™ï¼","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487764,"discussion_content":"çœ‹ä¸€ä¸‹toArrayçš„è¿”å›ç±»å‹å¯¹æ¯”ä¸€ä¸‹è¾“å‡ºå°±çŸ¥é“äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584540426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250662,"user_name":"é²é¸£","can_delete":false,"product_type":"c1","uid":2152306,"ip_address":"","ucode":"974BA3C3E64630","user_header":"https://static001.geekbang.org/account/avatar/00/20/d7/72/cbef720d.jpg","comment_is_top":false,"comment_ctime":1601189030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5896156326","product_id":100047701,"comment_content":"å‘ç°ä½¿ç”¨çš„æ—¶å€™ï¼Œç»å¸¸ä¼šä¸çŸ¥é“åˆ°åº•è¯¥ä¼ å…¥ä¸€ä¸ªä»€ä¹ˆæ ·å­çš„å‡½æ•°æˆ–è€…lamdaè¡¨è¾¾å¼","like_count":1},{"had_liked":false,"id":250659,"user_name":"é²é¸£","can_delete":false,"product_type":"c1","uid":2152306,"ip_address":"","ucode":"974BA3C3E64630","user_header":"https://static001.geekbang.org/account/avatar/00/20/d7/72/cbef720d.jpg","comment_is_top":false,"comment_ctime":1601188233,"is_pvip":false,"replies":[{"id":"91752","content":"https:&#47;&#47;stackoverflow.com&#47;questions&#47;23699371&#47;java-8-distinct-by-property&#47;27872852#27872852","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1601198265,"ip_address":"","comment_id":250659,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5896155529","product_id":100047701,"comment_content":"åœ¨å®é™…ä¸­ï¼Œå‘ç°distinctéœ€è¦æ ¹æ®å…ƒç´ ç±»å‹çš„å±æ€§è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ«çš„æ–¹å¼äº†","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506253,"discussion_content":"https://stackoverflow.com/questions/23699371/java-8-distinct-by-property/27872852#27872852","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601198265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219208,"user_name":"å¤§èƒ–å­å‘€ã€","can_delete":false,"product_type":"c1","uid":1258251,"ip_address":"","ucode":"4BADF8096254BE","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/0b/fd18c8ab.jpg","comment_is_top":false,"comment_ctime":1589966650,"is_pvip":false,"replies":[{"id":"80975","content":"æŒ‰ç…§å®¢æˆ·ç›´æ¥è¿›è¡Œåˆ†ç»„èšåˆä¸æ˜¯æ›´ç®€å•","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1589969795,"ip_address":"","comment_id":219208,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5884933946","product_id":100047701,"comment_content":"å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œè®¡ç®—è¿è´¹ï¼šå…ˆä»è¿è´¹é›†åˆä¸­æ‰¾å‡ºåŒä¸€ä¸ªå®¢æˆ·çš„æ•°æ®ï¼Œç„¶åç±»ä¼¼äºç´¯åŠ æ•°é‡ï¼ˆè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é€»è¾‘ï¼‰è®¡ç®—å‡ºè¿è´¹ï¼ˆå› ä¸ºç›¸åŒçš„å®¢æˆ·æ•°é‡è¶…è¿‡ä¸€å®šæ•°å€¼ä¼šæœ‰ä¼˜æƒ ï¼‰ã€‚æœ€åæŠŠè®¡ç®—å‡ºæ¥çš„è¿è´¹æ•°æ®æ’å…¥åˆ°æ•°æ®åº“é‡Œã€‚<br><br>æˆ‘çš„åšæ³•æ˜¯ï¼šä»¥ç¬¬ä¸€æ¡æ•°æ®çš„å®¢æˆ·ä¸ºåŸºå‡†ï¼Œå¾ªç¯æ‰¾å‡ºç›¸åŒå®¢æˆ·çš„æ•°æ®ï¼Œä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ï¼ŒåŒæ—¶ä»åŸæ•°æ®é›†åˆé‡Œç§»é™¤è¿™æ¡æ•°æ®ï¼Œæœ€åè®¡ç®—å‡ºæ–°é›†åˆé‡Œçš„è¿è´¹å°±å¯ä»¥äº†ã€‚<br><br>æ„Ÿè§‰è¿™ç§éœ€æ±‚çš„è¯ï¼Œå¥½åƒå°±æ²¡åŠæ³•ç”¨è€å¸ˆä»‹ç»çš„æµæ–¹æ³•æ¥éå†è®¡ç®—äº†ï¼Œå› ä¸ºä¸èƒ½åˆ é™¤æ•°æ®ï¼Œä¸çŸ¥é“æˆ‘è®¤ä¸ºçš„æ˜¯ä¸æ˜¯å¯¹çš„ã€‚<br><br>å¦å¤–å°±æˆ‘çš„å®ç°æ¥è¯´ï¼Œä¼šä¸ä¼šå‡ºç°é—®é¢˜ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495717,"discussion_content":"æŒ‰ç…§å®¢æˆ·ç›´æ¥è¿›è¡Œåˆ†ç»„èšåˆä¸æ˜¯æ›´ç®€å•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589969795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283167,"discussion_content":"æœ‰ä¸ªé—®é¢˜æ˜¯ï¼ŒåŸæ•°æ®éœ€è¦å…¶ä»–å¤„ç†å—ï¼Œä¸ºä»€ä¹ˆè¦åˆ é™¤ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592202091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1258251,"avatar":"https://static001.geekbang.org/account/avatar/00/13/33/0b/fd18c8ab.jpg","nickname":"å¤§èƒ–å­å‘€ã€","note":"","ucode":"4BADF8096254BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1882517,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b9/95/cabab54b.jpg","nickname":"tong","note":"","ucode":"966DEDE81081D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283228,"discussion_content":"å¦‚æœä¸åˆ é™¤ï¼Œç¬¬äºŒä¸ªæ•°æ®å’Œç¬¬ä¸€ä¸ªæ•°æ®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡å¾ªç¯å°±ä¼šæŠŠé™¤äº†ç¬¬ä¸€ä¸ªæ•°æ®ä»¥å¤–å…¶ä»–çš„æ•°æ®é‡æ–°éå†ä¸€éï¼Œè®¡ç®—å‡ºé‡å¤çš„ç»“æœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592216315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":283167,"ip_address":""},"score":283228,"extra":""}]}]},{"had_liked":false,"id":216470,"user_name":"203ã€‚","can_delete":false,"product_type":"c1","uid":1903586,"ip_address":"","ucode":"25D508AB07A2FE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0b/e2/a4eddbe6.jpg","comment_is_top":false,"comment_ctime":1589266921,"is_pvip":false,"replies":[{"id":"80108","content":"æ¯”å¦‚ä¸‹é¢çš„ç±»ï¼Œid1å’Œid2é‡å¤è®¤ä¸ºæ˜¯é‡å¤çš„ï¼Œid3ä¸éœ€è¦è€ƒè™‘<br>@Data<br>    @Builder<br>    @NoArgsConstructor<br>    @AllArgsConstructor<br>    static class Test {<br>        private String id1;<br>        private String id2;<br>        @EqualsAndHashCode.Exclude<br>        private String id3;<br>    }<br><br>é€šè¿‡Setå»é‡æˆ–è€…é€šè¿‡distinctå»é‡å³å¯ï¼š<br><br>List&lt;Test&gt; list = new ArrayList&lt;&gt;();<br>        list.add(new Test(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;));<br>        list.add(new Test(&quot;a&quot;,&quot;b&quot;,&quot;d&quot;));<br>        System.out.println(list.stream().collect(Collectors.toSet()));<br>        System.out.println(list.stream().distinct().collect(Collectors.toList()));","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1589269971,"ip_address":"","comment_id":216470,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884234217","product_id":100047701,"comment_content":"è€å¸ˆ æˆ‘è¿™é‡Œæœ‰ä¸ªé—®é¢˜ å…³äºStreamçš„ï¼Œä¸šåŠ¡éœ€æ±‚é‡Œéœ€è¦æŒ‰æŸå‡ ä¸ªå­—æ®µå»é‡(acctId,billingCycleId,prodInstId,offerId)<br>æˆ‘è¿™é‡Œæƒ³åˆ°äº†éå†é›†åˆareaDatas åç”¨containsæ–¹æ³•åˆ¤æ–­ é‡å†™AcctItemYzfBeanå®ä½“ç±»çš„equalsæ–¹æ³•å®ç°ï¼Œ<br>è¯·é—®æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿ ä»£ç å¦‚ä¸‹<br><br>List&lt;AcctItemYzfBean&gt; newList = new CopyOnWriteArrayList&lt;&gt;();<br>&#47;&#47;å¾ªç¯è¿‡æ»¤ã€å¢å¼ºç¿¼æ”¯ä»˜æ•°æ®<br>Optional.ofNullable(areaDatas)&#47;&#47;é›†åˆåˆ¤ç©º<br>\t\t.orElse(new ArrayList&lt;&gt;())<br>\t\t.stream()&#47;&#47;è½¬åŒ–ä¸ºæµ ä¾¿äºä¸‹é¢è¿‡æ»¤å’Œå¢å¼ºæ•°æ®<br>\t\t.filter(Objects::nonNull)&#47;&#47;å…ƒç´ åˆ¤ç©º<br>\t\t.filter(yzfBean -&gt; this.judgeIfOfferId(yzfBean))&#47;&#47;åˆ¤æ–­é”€å”®å“IDæ˜¯å¦ç›¸åŒ<br>\t\t.filter(yzfBean -&gt; this.enhanceYzfBean(yzfBean))&#47;&#47;å¢å¼ºè¿‡æ»¤accNbrå’ŒacctId<br>\t\t.filter(yzfBean -&gt; this.judgeIfArrears(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸æ¬ è´¹<br>\t\t.filter(yzfBean -&gt; this.judgeIfCancel(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦é”€è´¦é‡‘é¢å¤§äº0<br>\t\t.filter(yzfBean -&gt; this.judgeIfReturn(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸Šæœˆæœªè¿”è¿˜<br>\t\t.forEach(yzfBean -&gt; {<br>\t\t\t&#47;&#47;å»é‡ é‡å†™AcctItemYzfBean.equalsæ–¹æ³•<br>\t\t\tif(!newList.contains(yzfBean)) {<br>\t\t\t\t&#47;&#47;å¢å¼ºlatnName<br>\t\t\t\tyzfBean.setLatnName(commonRegionMap.get(yzfBean.getRegionId()));<br>\t\t\t\t&#47;&#47;å¢å¼ºareaCode<br>\t\t\t\tyzfBean.setAreaCode(areaCode);<br>\t\t\t\t&#47;&#47;æ•°æ®å°è£…<br>\t\t\t\tnewList.add(yzfBean);<br>\t\t\t}<br>\t\t});<br><br>é‡å†™çš„equalsæ–¹æ³•\t\t<br>@Override<br>public boolean equals(Object yzfBeanObj) {<br>\tif(yzfBeanObj instanceof AcctItemYzfBean) {<br>\t\tAcctItemYzfBean yzfBean = (AcctItemYzfBean) yzfBeanObj;<br>\t\tif(Tools.isEmpty(yzfBean.getAcctId(), yzfBean.getBillingCycleId(), yzfBean.getProdInstId(),  yzfBean.getOfferId())) {<br>\t\t\treturn false;<br>\t\t}<br>\t\tif(yzfBean.getAcctId().equals(this.acctId) &amp;&amp; yzfBean.getBillingCycleId().equals(this.billingCycleId)<br>\t\t\t\t&amp;&amp; yzfBean.getProdInstId().equals(this.prodInstId) &amp;&amp; yzfBean.getOfferId().equals(this.offerId)) {<br>\t\t\treturn true;<br>\t\t}<br>\t}<br>\treturn super.equals(yzfBeanObj);<br>}","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494831,"discussion_content":"æ¯”å¦‚ä¸‹é¢çš„ç±»ï¼Œid1å’Œid2é‡å¤è®¤ä¸ºæ˜¯é‡å¤çš„ï¼Œid3ä¸éœ€è¦è€ƒè™‘\n@Data\n    @Builder\n    @NoArgsConstructor\n    @AllArgsConstructor\n    static class Test {\n        private String id1;\n        private String id2;\n        @EqualsAndHashCode.Exclude\n        private String id3;\n    }\n\né€šè¿‡Setå»é‡æˆ–è€…é€šè¿‡distinctå»é‡å³å¯ï¼š\n\nList&amp;lt;Test&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();\n        list.add(new Test(&amp;quot;a&amp;quot;,&amp;quot;b&amp;quot;,&amp;quot;c&amp;quot;));\n        list.add(new Test(&amp;quot;a&amp;quot;,&amp;quot;b&amp;quot;,&amp;quot;d&amp;quot;));\n        System.out.println(list.stream().collect(Collectors.toSet()));\n        System.out.println(list.stream().distinct().collect(Collectors.toList()));","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589269971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201172,"user_name":"è¯·å«æˆ‘å’Œå°š","can_delete":false,"product_type":"c1","uid":1703256,"ip_address":"","ucode":"33A8A1CDA103F9","user_header":"https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg","comment_is_top":false,"comment_ctime":1585727891,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5880695187","product_id":100047701,"comment_content":"è¿™ä¸ªæ–‡ç« ç®—æ˜¯æˆ‘è¯»èµ·æ¥æœ€åƒåŠ›çš„ä¸€ç¯‡äº†ï¼Œå“ˆå“ˆå“ˆï¼Œå¤šè¯»è¯»ï¼Œä¸€æ—¶é—´è‚¯å®šä¸èƒ½æ¶ˆåŒ–","like_count":1},{"had_liked":false,"id":194732,"user_name":"é˜¿æ€ª","can_delete":false,"product_type":"c1","uid":1348349,"ip_address":"","ucode":"323F6F737DFD4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/92/fd/e507a8fb.jpg","comment_is_top":false,"comment_ctime":1585100366,"is_pvip":false,"replies":[{"id":"74084","content":"è§‰å¾—å¥½å¯ä»¥å¤šåˆ†äº«","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585103217,"ip_address":"","comment_id":194732,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5880067662","product_id":100047701,"comment_content":"æ¯å¤©ä¸Šä¸‹ç­é˜…è¯»ï¼Œæ”¶è·æ»¡æ»¡","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488883,"discussion_content":"è§‰å¾—å¥½å¯ä»¥å¤šåˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585103217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189533,"user_name":"å©·","can_delete":false,"product_type":"c1","uid":1612372,"ip_address":"","ucode":"1264B8F777B7CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/9a/54/5d51fda4.jpg","comment_is_top":false,"comment_ctime":1584526033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879493329","product_id":100047701,"comment_content":"æ‰“å¡ ä»Šå¤©æ”¶è·åˆä¸å°‘ æ„Ÿè°¢è€å¸ˆ","like_count":1},{"had_liked":false,"id":351719,"user_name":"æ°¸è¿œä¸è¦ä½ä¼°ä¸€é¢—å† å†›çš„å¿ƒ","can_delete":false,"product_type":"c1","uid":1339230,"ip_address":"","ucode":"FF0DD7382CD3CA","user_header":"https://static001.geekbang.org/account/avatar/00/14/6f/5e/3f7e9ccd.jpg","comment_is_top":false,"comment_ctime":1658127021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658127021","product_id":100047701,"comment_content":" orders å­—æ®µä¿å­˜äº†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®åœ¨å“ªé‡Œå¯ä»¥ä¸‹è½½å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":334658,"user_name":"jacy","can_delete":false,"product_type":"c1","uid":1103456,"ip_address":"","ucode":"0022A8759DDCE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg","comment_is_top":false,"comment_ctime":1645061467,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1645061467","product_id":100047701,"comment_content":".collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)<br>è€å¸ˆï¼Œè¿™é‡Œæ²¡æœ‰å¤ªæ‡‚ï¼Œ ä¸ºå•¥éœ€è¦ä¸¤æ¬¡StringBuilder::appendå‘¢","like_count":0},{"had_liked":false,"id":328673,"user_name":"SharpBB","can_delete":false,"product_type":"c1","uid":2014573,"ip_address":"","ucode":"D30C5B798B8E8C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/bd/6d/7010f98e.jpg","comment_is_top":false,"comment_ctime":1640832154,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1640832154","product_id":100047701,"comment_content":"å¤ªç§€äº† æ²¡æƒ³åˆ°ä¼šæœ‰è¿™äº›æ“ä½œ","like_count":0},{"had_liked":false,"id":278097,"user_name":"å¤ç›®ğŸ³","can_delete":false,"product_type":"c1","uid":1101227,"ip_address":"","ucode":"4ED932E1F66F76","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/ab/1c3dc64b.jpg","comment_is_top":false,"comment_ctime":1612759536,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612759536","product_id":100047701,"comment_content":"å¦‚æœè®¢å•é‡‘é¢æ˜¯BigDecimalï¼Œæ€ä¹ˆåœ¨åˆ†ç»„çš„æ—¶å€™åˆå¹¶é‡‘é¢å‘¢&#47;&#47;æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•æ€»é‡‘é¢<br>System.out.println(orders.stream().collect(groupingBy(Order::getCustomerName, summingDouble(Order::getTotalPrice)))","like_count":0}]}