{"id":473400,"title":"10ï½œæ ‡å‡†åº“ï¼šå­—ç¬¦ã€å­—ç¬¦ä¸²å¤„ç†ä¸æ•°å­¦è®¡ç®—","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯äºèˆªã€‚ä»è¿™ä¸€è®²å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥åˆ° C å·¥ç¨‹å®æˆ˜ç¯‡çš„å­¦ä¹ ã€‚</p><p>åœ¨ä¸Šä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä¸»è¦å›´ç»•ç€ C è¯­è¨€çš„ä¸ƒå¤§å…³é”®è¯­æ³•ï¼Œä»‹ç»äº†å®ƒä»¬åœ¨æœºå™¨æŒ‡ä»¤å±‚é¢çš„å®ç°ç»†èŠ‚ã€‚è€Œæ¥ä¸‹æ¥ï¼Œèµ°å‡ºè¯­æ³•ï¼Œä»å¾®è§‚åˆ°å®è§‚ï¼Œæˆ‘ä»¬å°†å¼€å§‹è¿›ä¸€æ­¥æ¢ç´¢ C è¯­æ³•ä¹‹å¤–ï¼Œé‚£äº›å¯ä»¥ç”¨æ¥æ”¯æ’‘å¤§å‹ C é¡¹ç›®æ„å»ºçš„ç‰¹æ€§å’ŒæŠ€æœ¯ã€‚</p><p>å› æ­¤ï¼Œåœ¨è¿™ä¸€æ¨¡å—ä¸­ï¼Œæˆ‘ä¼šä»‹ç»å’Œ C è¯­è¨€æ ‡å‡†åº“ã€å·¥ç¨‹åŒ–ï¼Œä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­‰ç›¸å…³çš„å†…å®¹ã€‚C æ ‡å‡†åº“æ˜¯é™¤ C åŸºæœ¬æ ¸å¿ƒè¯­æ³•å¤–ï¼ŒC è¯­è¨€çš„å¦ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚C æ ‡å‡†åº“ä¸­æä¾›äº†ä¼—å¤šçš„ç±»å‹ã€å‡½æ•°å’Œå®ï¼Œå¯ä¾›æˆ‘ä»¬ç›´æ¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ã€‚è¿™äº›â€œæ„å»ºå•å…ƒâ€çš„åŠŸèƒ½æ¶µç›–äº†å¤šä¸ªæ–¹é¢ï¼Œä»ç®€å•çš„æ–‡æœ¬å­—ç¬¦å¤„ç†ï¼Œåˆ°å¤æ‚çš„çº¿ç¨‹æ“ä½œã€å†…å­˜ç®¡ç†ç­‰ã€‚åœ¨ç»§ç»­åé¢çš„å†…å®¹ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆç²—ç•¥æµè§ˆä¸‹å›¾ï¼Œä»¥å¯¹ C æ ‡å‡†åº“æä¾›çš„åŸºæœ¬åŠŸèƒ½æœ‰ä¸ªå¤§è‡´çš„å°è±¡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6d/54/6dda718fc700a7c8f503e59daf442554.jpg?wh=1920x1732\" alt=\"å›¾ç‰‡\"></p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹ C æ ‡å‡†åº“ä¸­ä¸å­—ç¬¦ã€å­—ç¬¦ä¸²å¤„ç†ï¼Œä»¥åŠæ•°å­¦è¿ç®—ç›¸å…³çš„å†…å®¹ã€‚</p><h2>C è¯­è¨€ä¸­çš„å­—ç¬¦å’Œå­—ç¬¦ä¸²</h2><p>åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ç”¨å•å¼•å·è¡¨ç¤ºï¼Œå­—ç¬¦ä¸²ç”¨åŒå¼•å·è¡¨ç¤ºã€‚æ¯”å¦‚åœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ä¾¿å®šä¹‰æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå®ƒä»¬åˆ†åˆ«å­˜æ”¾äº†ä¸€ä¸ªå­—ç¬¦ç±»å‹å’Œä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚</p><pre><code class=\"language-c++\">char c = 'a';\nconst char* str = \"Hello, geek!\";\n</code></pre><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥åˆ†åˆ«çœ‹çœ‹ä¸è¿™ä¸¤ç§ç±»å‹æœ‰å…³çš„é‡è¦ç‰¹æ€§ã€‚</p><h3>å­—ç¬¦</h3><p>åœ¨ C è¯­è¨€æ ‡å‡†ä¸­ï¼Œä¸åŒäºå…¶ä»–æ•´æ•°ç±»å‹ï¼ˆæ¯”å¦‚ <code>int</code>ï¼‰ï¼Œå­—ç¬¦ç±»å‹ <code>char</code> å¹¶æ²¡æœ‰è¢«è§„å®šé»˜è®¤çš„ç¬¦å·æ€§ï¼Œè€Œå…¶å…·ä½“ç¬¦å·æ€§åˆ™æ˜¯ç”±ç¼–è¯‘å™¨å’Œæ‰€åœ¨å¹³å°å†³å®šçš„ã€‚è™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šé€‰æ‹©å°†é»˜è®¤æƒ…å†µä¸‹çš„ <code>char</code> ç±»å‹è§†ä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œä½†è€ƒè™‘åˆ°ç¨‹åºçš„å¯ç”¨æ€§ä¸å¯ç§»æ¤æ€§ï¼Œåœ¨å®é™…ç¼–ç ä¸­è¿˜æ˜¯å»ºè®®<strong>æ˜¾å¼æŒ‡å®šå‡ºæ‰€å®šä¹‰å­—ç¬¦å˜é‡çš„ç¬¦å·æ€§</strong>ã€‚</p><!-- [[[read_end]]] --><p>C æ ‡å‡†ä¸­ä¹‹æ‰€ä»¥è¿™æ ·è§„å®šï¼Œä¸»è¦æºäºå…¶å†å²åŸå› ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ä¸€ç§è¯´æ³•æ˜¯ï¼šC è¯­è¨€åœ¨è®¾è®¡ä¹‹åˆå‚è€ƒäº†å®ƒçš„â€œå‰è¾ˆâ€ B è¯­è¨€ã€‚B è¯­è¨€äº 1969 å¹´ç”± Ken Thompson åœ¨è´å°”å®éªŒå®¤å¼€å‘ã€‚ä½œä¸ºä¸€ç§æ— ç±»å‹è¯­è¨€ï¼Œå®ƒçš„å­—ç¬¦ç±»å‹ä»…ç”¨äºå­˜æ”¾å­—ç¬¦ï¼Œè€Œä¸ä½œæ•°å­¦è¿ç®—ä¹‹ç”¨ã€‚å› æ­¤ï¼Œå¹¶ä¸éœ€è¦ç‰¹åˆ«åŒºåˆ†ç¬¦å·æ€§ã€‚æ‰€ä»¥åœ¨ C è¯­è¨€ä¸­ï¼Œä½œè€…ä¹Ÿæ²¡æœ‰ä¸ºå­—ç¬¦ç±»å‹è§„å®šé»˜è®¤çš„ç¬¦å·æ€§ã€‚</p><p>å¦å¤–ï¼Œæœ‰å…³å­—ç¬¦ç±»å‹çš„å¦ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼ŒC è¯­è¨€ä¿è¯ <code>char</code> ç±»å‹åªå ç”¨ä¸€ä¸ªå­—èŠ‚å¤§å°ï¼Œå› æ­¤åœ¨ä½¿ç”¨ <code>sizeof</code> è¿ç®—ç¬¦è®¡ç®—è¯¥ç±»å‹å¤§å°æ—¶ï¼Œå°†æ°¸è¿œå¾—åˆ°ç»“æœ 1ã€‚ä½†äº‹å®ä¸Šï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è®¡ç®—æœºä½“ç³»éƒ½ä½¿ç”¨ 8 ä½çš„å­—èŠ‚å¤§å°ã€‚å¯¹äºæŸäº›è¾ƒä¸ºå¤è€çš„è®¡ç®—æœºä½“ç³»ï¼Œä¸€ä¸ªå­—èŠ‚å¯èƒ½å¯¹åº”å¤§äºæˆ–å°äº 8 ä½ã€‚</p><p>å¯¹äºæŸäº›ç‰¹æ®Šçš„ä¸šåŠ¡éœ€æ±‚å’ŒåŠŸèƒ½åœºæ™¯ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®æ ‡å‡†åº“ä¸­å®šä¹‰çš„å¸¸é‡ CHAR_BIT ï¼Œæ¥æ£€æŸ¥å½“å‰ä½“ç³»ä¸‹ä¸€ä¸ªå­—ç¬¦ç±»å‹æ‰€å ç”¨çš„ä½æ•°ï¼Œè¯¥å¸¸é‡çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-c++\">#include &lt;limits.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; printf(\"char type has %lu byte.\\n\", sizeof(char));&nbsp; // ...1.\n&nbsp; printf(\"char type has %d bits.\", CHAR_BIT);&nbsp; // ...8.\n}\n</code></pre><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ª C89 ä»¥æ¥çš„æ ‡å‡†ä¸­è§„å®šï¼ŒCHAR_BIT çš„å€¼ä¸èƒ½å°äº 8ï¼Œå› æ­¤å¯¹äºå•ä¸ªå­—èŠ‚æ•°å°äº 8 ä½çš„ä½“ç³»æ¶æ„ï¼Œè¯¥å¸¸é‡å¹¶ä¸èƒ½åæ˜ çœŸå®æƒ…å†µã€‚</p><p>æœ€åä»‹ç»ä¸€ä¸ªç¼–ç æ–¹é¢çš„ç‰¹æ€§ã€‚C è¯­è¨€ä¸­çš„ <code>char</code> å­—ç¬¦ç±»å‹å˜é‡åœ¨æŒ‰ç…§å­—ç¬¦ç±»å‹æ‰“å°æ—¶ï¼ˆæ¯”å¦‚ä½¿ç”¨ printf å‡½æ•°ï¼Œé…åˆ â€œ%câ€ å ä½ç¬¦ï¼‰ï¼Œä¼šä½¿ç”¨ ASCII ç¼–ç æ¥å¯¹æ•°å­—å€¼è¿›è¡Œå­—ç¬¦æ˜ å°„ã€‚è¿™æ„å‘³ç€ï¼Œä¸€ä¸ªå­˜å‚¨æœ‰æ•´æ•° 65 çš„å­—ç¬¦ç±»å‹å˜é‡ï¼Œåœ¨å°†å…¶æ‰“å°è¾“å‡ºæ—¶ï¼Œä¼šåœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥å¾—åˆ°å­—ç¬¦ â€œAâ€ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿéœ€è¦ç¡®ä¿å‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„ç¼–ç è®¾ç½®ä¸º UTF-8ï¼Œä»¥ä¸ ASCII ç¼–ç ç›¸å…¼å®¹ã€‚</p><p>é™¤äº† <code>char</code> ç±»å‹ä»¥å¤–ï¼ŒC è¯­è¨€è¿˜åœ¨ C90 å’Œ C11 æ ‡å‡†ä¸­æ–°å¢äº†å¯ç”¨äºå®½å­—ç¬¦çš„ç±»å‹ï¼Œè¯¸å¦‚ <code>wchar_t</code>ã€<code>char16_t</code>ã€<code>char32_t</code> ç­‰ã€‚å…¶ä¸­ï¼Œ<code>wchar_t</code> ç±»å‹çš„å¤§å°ç”±å…·ä½“çš„ç¼–è¯‘å™¨å®ç°å†³å®šã€‚è€Œ <code>char16_t</code> å’Œ <code>char32_t</code> ç±»å‹ï¼Œå…¶å€¼åˆ™å›ºå®šå ç”¨å¯¹åº”çš„ 16 å’Œ 32 ä½ã€‚</p><h3>å­—ç¬¦ä¸²</h3><p>åœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼æ¥å®šä¹‰å­—ç¬¦ä¸²ç±»å‹çš„å˜é‡ï¼Œä¸€ç§æ˜¯æŒ‡é’ˆå½¢å¼ï¼Œå¦ä¸€ç§æ˜¯æ•°ç»„å½¢å¼ã€‚å½“ç„¶ï¼Œè¿™é‡Œç¤ºä¾‹ä»£ç ä¸­æˆ‘ä»¬å®šä¹‰çš„æ˜¯åªè¯»å­—ç¬¦ä¸²ï¼š</p><pre><code class=\"language-c++\">// read-only string.\nconst char strA[] = \"Hello, geek!\";&nbsp; \nconst char* strB = \"Hello\" \", geek!\";\n</code></pre><p>å…¶ä¸­ï¼Œç”±åŒå¼•å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†ä¸€èˆ¬ç§°ä¸ºâ€œå­—ç¬¦ä¸²å­—é¢é‡â€ã€‚C æ ‡å‡†ä¸­è§„å®šï¼Œè¿ç»­å‡ºç°çš„å­—ç¬¦ä¸²å­—é¢é‡ä¹‹é—´å¦‚æœä»…ç”±ç©ºæ ¼åˆ†éš”ï¼Œåˆ™ä¼šå°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªæ•´ä½“ã€‚æ‰€ä»¥ <code>strA</code> ä¸ <code>strB</code> è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å±•ç¤ºå‡ºäº†å­—ç¬¦ä¸²åœ¨ C è¯­è¨€ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ï¼Œå³â€œå¸¦æœ‰ç»ˆæ­¢ç¬¦çš„å­—ç¬¦æ•°ç»„â€ã€‚</p><p>å…³äºä¸Šè¿°å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥ç›´è§‚åœ°ç†è§£ä¸€ä¸‹ã€‚å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œå­—ç¬¦ä¸²æ•°æ®è¢«å­˜æ”¾åœ¨è¿ç»­çš„å†…å­˜æ®µä¸Šï¼Œä¸”æ¯ä¸ªå­—ç¬¦ä¸²æ•°æ®çš„æœ€åéƒ½ä»¥ç©ºå­—ç¬¦ï¼ˆ<strong>\\0</strong>ï¼‰ä½œä¸ºè¡¨ç¤ºç»“æŸçš„ç»ˆæ­¢ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ï¼Œå­—ç¬¦ä¸²å¹¶ä¸æ˜¯å•çº¯çš„å­—ç¬¦æ•°ç»„ï¼Œè€Œæ˜¯å¸¦æœ‰éšå¼ï¼ˆå®šä¹‰æ—¶ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šï¼‰ç»ˆæ­¢ç¬¦çš„å­—ç¬¦æ•°ç»„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/39/3d/3944500a60ac5cdc067816b65f7c3e3d.jpg?wh=1920x638\" alt=\"å›¾ç‰‡\"></p><p>è™½ç„¶é€šè¿‡ä¸Šé¢è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®šä¹‰å­—ç¬¦ä¸²ï¼Œä½†å®é™…ä¸Šï¼Œ<strong>ä¸åŒçš„å®šä¹‰æ–¹å¼åœ¨ä¸åŒæƒ…å†µä¸‹å¯èƒ½ä¼šå¯¹ç¨‹åºè¿è¡Œäº§ç”Ÿä¸åŒçš„å½±å“ã€‚</strong>è¿™é‡Œä½ å¯ä»¥å…ˆæ€è€ƒä¸‹ï¼šå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹è¿™æ®µä»£ç ï¼Œå®ƒåœ¨è¿è¡Œæ—¶ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿå¦‚æœæœ‰ï¼Œé‚£åº”è¯¥æ€æ ·æ”¹æ­£ï¼Ÿ</p><pre><code class=\"language-c++\">#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main (void) {&nbsp; &nbsp;\n&nbsp; /* get the first token */\n&nbsp; const char* token = strtok(\"Hello, geek!\", \"geek\");\n&nbsp; printf(\"%s\", token);\n&nbsp; return 0;\n}\n</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œå¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœã€‚æ¯”å¦‚åœ¨ Linux ä¸Šï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°åä¸º â€œSegmentation faultâ€ çš„ç³»ç»Ÿé”™è¯¯ã€‚å¦‚æœè¿›ä¸€æ­¥ç”¨ LLDB è¿›è¡Œè°ƒè¯•ï¼Œä½ ä¼šå‘ç°é”™è¯¯åŸå› æ˜¯ï¼šâ€œsignal SIGSEGV: address access protectedâ€ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯è®¿é—®äº†å—ä¿æŠ¤çš„åœ°å€ã€‚é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚</p><p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„å†…å®¹ä¸­æ›¾æåˆ°è¿‡ï¼Œå­—ç¬¦ä¸²å¸¸é‡ä¸€èˆ¬ä¼šè¢«å­˜æ”¾åœ¨è¿›ç¨‹ VAS çš„ .rodata Sectionï¼ˆä¸‹æ–‡ç®€ç§° .rodataï¼‰ä¸­ï¼Œä½äºæ­¤å¤„çš„æ•°æ®ä¸€èˆ¬å¯ä»¥åœ¨ç¨‹åºä¸­è¢«å¤šæ¬¡å¼•ç”¨ã€‚è€Œå½“æ•°æ®éœ€è¦è¢«ä¿®æ”¹ï¼Œæˆ–ä»¥è¾ƒçŸ­ç”Ÿå‘½å‘¨æœŸçš„å½¢å¼ï¼ˆå¦‚å±€éƒ¨å˜é‡ï¼‰å­˜åœ¨æ—¶ï¼Œå…¶å¼•ç”¨çš„ç›¸å…³æ•°æ®å¯èƒ½éœ€è¦ä» .rodata ä¸­è¢«å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ã€‚è€Œä¸Šè¿°è¿™ä¸¤ç§å­—ç¬¦ä¸²å®šä¹‰æ–¹å¼ä¾¿å¯¹åº”äºè¿™ä¸¤ç§æƒ…å†µã€‚</p><p>ä»¥æœ¬å°èŠ‚å¼€å¤´çš„ä»£ç ä¸ºä¾‹ï¼Œä½¿ç”¨æŒ‡é’ˆå½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸² strB ï¼Œå®é™…ä¸Šç›´æ¥å¼•ç”¨äº† .rodata ä¸­è¯¥å­—ç¬¦ä¸²çš„æ‰€åœ¨ä½ç½®ï¼Œå³å­—ç¬¦æŒ‡é’ˆ strB çš„å€¼ä¸ºè¯¥ä½ç½®å¯¹åº”çš„å†…å­˜åœ°å€ã€‚è€Œä½¿ç”¨æ•°ç»„å½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸² strA ï¼Œåˆ™æ˜¯å°†è¯¥å­—ç¬¦ä¸²çš„æ•°æ®ä» .rodata ä¸­å¤åˆ¶åˆ°äº†å…¶ä»–åœ°æ–¹ï¼ŒstrA çš„å€¼ä¸ºå¤åˆ¶åè¯¥å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€åœ¨åœ°å€ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ¥éªŒè¯è¿™ä¸ªç»“è®ºã€‚</p><pre><code class=\"language-c++\">// string.c\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; const char strA[] = \"Hello, geek!\";\n&nbsp; const char* strB = \"Hello, geek!\";\n&nbsp; printf(\"%p\\n%p\", strA, strB);  \n  /**\n    Output:\n    0x7ffee84d3d0b\n    0x4006c8\n  */\n}\n</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ â€œ%pâ€ æ ¼å¼ç¬¦æ¥æ‰“å°å˜é‡ strA ä¸ strB è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“åœ¨ Linux ä¸‹æ‰§è¡Œè¿™æ®µä»£ç æ—¶ï¼Œå˜é‡ strA ä¸ strB åˆ†åˆ«å¯¹åº”ä¸¤ä¸ªå®Œå…¨ä¸åŒé•¿åº¦çš„åœ°å€ï¼ˆå‚è€ƒä»£ç åçš„æ³¨é‡Šï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ VAS åˆ†å¸ƒæƒ…å†µã€‚</p><pre><code class=\"language-shell\">pgrep string | xargs -I {} cat /proc/{}/maps\n</code></pre><p>å‘½ä»¤æ‰§è¡Œåï¼Œä¼šå¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ea/c3/eae6c0f6290b309fecbd90cdcc46a8c3.png?wh=1560x688\" alt=\"å›¾ç‰‡\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä»¥å­—ç¬¦æ•°ç»„å½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œå…¶å¯¹åº”å˜é‡ strA çš„æ•°æ®å®é™…ä¸Šä¼šä» .rodata ä¸­è¢«å¤åˆ¶åˆ°å½“å‰è¿›ç¨‹ VAS çš„æ ˆå†…å­˜ä¸­ã€‚è€Œå½“ç¨‹åºè¿è¡Œè„±ç¦» strA æ‰€åœ¨çš„ä½œç”¨åŸŸæ—¶ï¼Œè¯¥æ•°ç»„å¯¹åº”çš„å€¼å°†ä¼šè¢«é‡Šæ”¾ã€‚åè§‚ä»¥æŒ‡é’ˆå½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸² strBï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¯å®å…¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ä¸º .rodataã€‚</p><pre><code class=\"language-shell\">objdump -s string | grep .rodata -A 10\n</code></pre><p>è¯¥å‘½ä»¤ä¼šç›´æ¥æ‰“å°å‡ºå½“å‰ç¨‹åº .rodata çš„ç›¸å…³æƒ…å†µã€‚å¯ä»¥çœ‹åˆ°ï¼Œæœ€å³ä¾§è§£ç åçš„ ASCII å­—ç¬¦ä¸² â€œHello, geek!â€ æ­£å¯¹åº”ç€å€¼ä¸º 0x4006c8 çš„èµ·å§‹åœ°å€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cc/05/cc8f619b54f1a4e38595342dd1908e05.png?wh=1136x194\" alt=\"å›¾ç‰‡\"></p><p>æœ€åæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ã€‚ä½¿ç”¨æ•°ç»„å’ŒæŒ‡é’ˆå½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œå…¶åº•å±‚çš„æ•°æ®å¼•ç”¨æ–¹å¼ä¼šæœ‰æ‰€åŒºåˆ«ã€‚å…¶ä¸­æ•°ç»„æ–¹å¼ä¼šå°†å­—ç¬¦ä¸²æ•°æ®ä» .rodata ä¸­æ‹·è´åˆ°å…¶ä»–ä½ç½®ï¼ˆæ¯”å¦‚æ ˆå†…å­˜ï¼‰ï¼Œå› æ­¤ä¿®æ”¹è¿™äº›æ•°æ®ä¸ä¼šæ”¹å˜å­˜åœ¨äºåŸå§‹ .rodata ä¸­çš„å‰¯æœ¬ã€‚è€Œä½¿ç”¨å¸¸é‡æŒ‡é’ˆå½¢å¼å®šä¹‰çš„æ•°ç»„ï¼Œè¯¥æŒ‡é’ˆä¼šç›´æ¥å¼•ç”¨ä½äº .rodata ä¸­çš„å­—ç¬¦ä¸²æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå½“ä½¿ç”¨é const æŒ‡é’ˆå¼•ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œé€šè¿‡è¯¥æŒ‡é’ˆä¿®æ”¹å­—ç¬¦ä¸²çš„å€¼ï¼Œå¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–ä½¿ç”¨æŒ‡é’ˆå½¢å¼å¼•ç”¨ç›¸åŒå­—ç¬¦ä¸²çš„ä»£ç ä½ç½®ä¸Šçš„å®é™…å­—ç¬¦ä¸²å€¼ã€‚å½“ç„¶åœ¨ C æ ‡å‡†ä¸­ï¼Œè¿™ç§ä¿®æ”¹æ–¹å¼æœ¬èº«æ˜¯ä¸€ç§æœªå®šä¹‰è¡Œä¸ºï¼Œå…¶äº§ç”Ÿçš„å…·ä½“å½±å“å°†ç”±ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿå†³å®šã€‚ä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥è¡Œä¸ºéƒ½ä¼šäº§ç”Ÿè¯¸å¦‚ â€œSegmentation faultâ€ ä»¥åŠ â€œBus errorâ€ ä¹‹ç±»çš„ç³»ç»Ÿé”™è¯¯ã€‚</p><h2>C æ ‡å‡†åº“ä¸­çš„å­—ç¬¦ã€å­—ç¬¦ä¸²å¤„ç†</h2><p>C æ ‡å‡†åº“ä¸­æä¾›äº†ä¼—å¤šçš„å‡½æ•°ï¼Œå¯ä¾›æˆ‘ä»¬ç›´æ¥å¯¹å­—ç¬¦å’Œå­—ç¬¦ä¸²æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©æ€§åœ°ä»‹ç»å…¶ä¸­çš„ä¸€äº›å¸¸è§ç”¨ä¾‹ã€‚å¯¹äºè¿™äº› C æ ‡å‡†åº“å‡½æ•°çš„æ›´è¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨<a href=\"https://www.cplusplus.com/reference/\">è¿™é‡Œ</a>æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚</p><h3>ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦</h3><pre><code class=\"language-c++\">#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; const char str[10] = \"Hi\";\n&nbsp; printf(\"%zu\\n\", strlen(str));&nbsp; // 2.\n}\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„ <code>strlen</code> å‡½æ•°ï¼Œ<strong>è¯¥å‡½æ•°ä¸ä¼šè®¡å…¥å­—ç¬¦ä¸²ä¸­å¤šä½™çš„ç»ˆæ­¢ç¬¦</strong>ã€‚</p><h3>æ‹¼æ¥å­—ç¬¦ä¸²</h3><pre><code class=\"language-c++\">#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#define STRLEN 14\nint main(void) {\n&nbsp; char strA[STRLEN] = \"Hello,\";\n&nbsp; char strB[] = \" world!\";\n&nbsp; strncat(strA, strB, STRLEN - strlen(strA) - 1);\n&nbsp; printf(\"%s\\n\", strA);&nbsp;\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ <code>strncat</code> å‡½æ•°æ¥è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚è¯¥å‡½æ•°ç›¸è¾ƒäº <code>strcat</code> å‡½æ•°ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¢«æ‹¼æ¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä»¥é˜²è¢«æ‹¼æ¥å­—ç¬¦ä¸²è¿‡é•¿å¯¼è‡´çš„æ‹¼æ¥å­—ç¬¦ä¸²æ•°ç»„æº¢å‡ºã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨è®¡ç®— <code>strncat</code> å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¢«æ‹¼æ¥å­—ç¬¦ä¸²é•¿åº¦è¿™ä¸ªå‚æ•°æ—¶ï¼Œéœ€è¦ä¸ºå­—ç¬¦ä¸²æœ€åçš„ç»ˆæ­¢ç¬¦é¢„ç•™å‡º 1 ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚</p><h3>æ‹·è´å­—ç¬¦ä¸²</h3><pre><code class=\"language-c++\">#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; char strA[] = \"aaaaaa\";\n&nbsp; char strB[] = \"bbbbbbb\";\n&nbsp; printf(\"%s\\n\", strncpy(strA, strB, strlen(strA)));&nbsp; // \"bbbbbb\".\n}\n</code></pre><p>æ‹·è´å­—ç¬¦ä¸²å‡½æ•° <code>strncpy</code> çš„ç”¨æ³•ä¸ <code>strncat</code> åŸºæœ¬ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å…¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ¥å†³å®šå°†å¤šå°‘å­—ç¬¦æ‹·è´åˆ°ç›®çš„å­—ç¬¦ä¸²çš„æ•°ç»„ä¸­ã€‚è¿™é‡Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªå°é—®é¢˜ï¼šå¦‚æœæŠŠ <code>strncpy</code> å‡½æ•°ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨çš„ <code>strlen</code> å‡½æ•°æ›´æ¢æˆ <code>sizeof</code>ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä½ å¯ä»¥åœ¨è¯„è®ºåŒºå’Œæˆ‘äº¤æµè®¨è®ºã€‚</p><h3>æ ¼å¼åŒ–å­—ç¬¦ä¸²</h3><pre><code class=\"language-c++\">#include &lt;stdio.h&gt;\n#define LEN 128\nint main(void) {\n&nbsp; char dest[LEN];\n&nbsp; const char strA[] = \"Hello, \";\n&nbsp; sprintf(dest, \"%sworld!\", strA);\n&nbsp; printf(\"%s\\n\", dest);\n}\n</code></pre><p>å‡½æ•° <code>sprintf</code> å¯ç”¨äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ç¬¬äºŒä¸ªå‚æ•°çš„å½¢å¼ä¸ <code>printf</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€è‡´ï¼Œåªæ˜¯åè€…ä¼šå°†å†…å®¹è¾“å‡ºåˆ°å‘½ä»¤è¡Œä¸­ï¼Œè€Œ <code>sprintf</code> ä¼šå°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ä¿å­˜åˆ°é€šè¿‡å…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ•°ç»„ä¸­ã€‚</p><h3>å­—ç¬¦çš„åˆ¤æ–­ä¸è½¬æ¢</h3><p>åœ¨ C æ ‡å‡†åº“å¤´æ–‡ä»¶ ctype.h ä¸­åŒ…å«æœ‰ä¼—å¤šå¯ç”¨äºå­—ç¬¦åˆ¤æ–­å’Œè½¬æ¢çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è‡ªèº«çš„åç§°ç›´æ¥è¯´æ˜äº†å®ƒä»¬çš„å…·ä½“åŠŸèƒ½ï¼Œä½¿ç”¨æ–¹å¼ååˆ†ç®€å•ã€‚å…·ä½“ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªå®ä¾‹ã€‚</p><pre><code class=\"language-c++\">#include &lt;ctype.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; char c = 'a';\n&nbsp; printf(\"%d\\n\", isalnum(c));&nbsp; // 1.\n&nbsp; printf(\"%d\\n\", isalpha(c));&nbsp; // 1.\n&nbsp; printf(\"%d\\n\", isblank(c));&nbsp; // 0.\n&nbsp; printf(\"%d\\n\", isdigit(c));&nbsp; // 0.\n&nbsp; printf(\"%c\\n\", toupper(c));&nbsp; // 'A'.\n}\n</code></pre><h2>C æ ‡å‡†åº“ä¸­çš„æ•°å­¦è¿ç®—</h2><p>ä¸Šé¢æˆ‘ä»‹ç»äº† C æ ‡å‡†åº“ä¸­ä¸å­—ç¬¦å’Œå­—ç¬¦ä¸²å¤„ç†ç›¸å…³å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒC æ ‡å‡†åº“ä¸­è¿˜æä¾›äº†ä¸æ•°å­¦è¿ç®—æœ‰å…³çš„å·¥å…·å‡½æ•°ï¼ŒåŸºæœ¬ä¸Šä½ éƒ½å¯ä»¥é€šè¿‡å¼•å…¥ math.h å’Œ stdlib.h è¿™ä¸¤ä¸ªå¤´æ–‡ä»¶æ¥ä½¿ç”¨ã€‚è¿™äº›å‡½æ•°çš„ä½¿ç”¨æ–¹å¼éƒ½ååˆ†ç®€å•ï¼Œä½ å¯ä»¥åœ¨<a href=\"https://en.cppreference.com/w/c/numeric/math\">è¿™é‡Œ</a>æ‰¾åˆ°å¯¹å®ƒä»¬ç”¨æ³•çš„è¯¦ç»†è¯´æ˜ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šåœ¨ç¼–è¯‘æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸ºé“¾æ¥å™¨æŒ‡å®š â€œ-lmâ€ å‚æ•°ä»¥é“¾æ¥æ‰€éœ€çš„æ•°å­¦åº“ã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ ‡å‡†åº“ä¸­çš„æ±‚ç»å¯¹å€¼å‡½æ•°ã€‚</p><pre><code class=\"language-c++\">#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n  long double num = -10.1;\n  printf(\"%.1Lf\\n\", fabsl(num));\n}\n</code></pre><p>ä¸ºäº†å‡å°‘ç¼–ç çš„å·¥ä½œé‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°å¯¹åº”çš„æ³›å‹ç‰ˆæœ¬ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥æ‰‹åŠ¨é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼ˆæ¯”å¦‚è¿™é‡Œçš„ <code>fabsl</code> å‡½æ•°ï¼Œå®ƒçš„åç¼€ â€œlâ€ è¡¨ç¤º â€œlongâ€ï¼‰ã€‚æ¯”å¦‚ï¼Œå¯¹äºæ‰€æœ‰æµ®ç‚¹ç±»å‹çš„æ•°å­—å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨åä¸º <code>fabs</code> çš„å®å‡½æ•°ã€‚è¯¥å®åœ¨å±•å¼€æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸ºä½ åŒ¹é…å¯¹åº”çš„ç±»å‹ç²¾ç¡®ç‰ˆæœ¬ã€‚ä¸è¿‡ï¼Œä¸ºäº†ä½¿ç”¨è¿™äº›æ³›å‹å®ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸæ¥çš„å¤´æ–‡ä»¶ math.h æ›¿æ¢ä¸º tgmath.hï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre><code class=\"language-c++\">#include &lt;tgmath.h&gt;\n#include &lt;stdio.h&gt;\nint main(void) {\n&nbsp; long double num = -10.1;\n&nbsp; printf(\"%.1Lf\\n\", fabs(num));\n}\n</code></pre><p>å…³äºè¿™äº›æ ‡å‡†åº“å‡½æ•°çš„å®ç°æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥æ¥çœ‹ï¼Œä¼šå‘ç°å¹¶éæ‰€æœ‰å‡½æ•°éƒ½æ˜¯æŒ‰ç…§ç›¸åº”çš„æ•°å­¦ç®—æ³•æ¥å®ç°è®¡ç®—è¿‡ç¨‹çš„ã€‚</p><p>è¿™é‡Œç”¨ä¸€ä¸ªå¸¸è§çš„æ•°å­¦è¿ç®—â€œæ±‚å¹³æ–¹æ ¹â€ä¸¾ä¾‹å­ï¼šé€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•ï¼Œä»¥è½¯ä»¶ç®—æ³•çš„å½¢å¼è®¡ç®—ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹å€¼ã€‚ä½†å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬ä»¥ musl è¿™ä¸ª C æ ‡å‡†åº“ä¸ºä¾‹ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹å…¶æŸç‰ˆæœ¬çš„å®ç°æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒåœ¨ i386 æ¶æ„ä¸‹ç›´æ¥ä½¿ç”¨äº† FPUï¼ˆæµ®ç‚¹è¿ç®—å•å…ƒï¼‰æä¾›çš„æœºå™¨æŒ‡ä»¤ <code>fsqrt</code> æ¥è®¡ç®—å¹³æ–¹æ ¹çš„å€¼ï¼Œè€Œå¹¶æ²¡æœ‰ä½¿ç”¨è½¯ä»¶ç®—æ³•ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™å¯ä»¥æå¤§æå‡è®¡ç®—æ€§èƒ½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/7d/c9ba68891c4ae6a3818ab8afcba72f7d.png?wh=1290x456\" alt=\"å›¾ç‰‡\"></p><p>å› æ­¤ï¼Œä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨ç¡¬ä»¶å¸¦æ¥çš„è®¡ç®—æ€§èƒ½ä¼˜åŠ¿ï¼Œåœ¨å‡†å¤‡è‡ªè¡Œç¼–å†™ç›¸åº”ç®—æ³•æ—¶ï¼Œå¯ä»¥å…ˆçœ‹çœ‹èƒ½å¦ç›´æ¥åˆ©ç”¨æ ‡å‡†åº“æä¾›çš„å‡½æ•°æ¥å®Œæˆä½ çš„å·¥ä½œã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œè®²åˆ°è¿™é‡Œï¼Œä»Šå¤©çš„å†…å®¹ä¹Ÿå°±åŸºæœ¬ç»“æŸäº†ã€‚æœ€åæˆ‘æ¥ç»™ä½ æ€»ç»“ä¸€ä¸‹ã€‚</p><p>ä»Šå¤©æˆ‘ä¸»è¦ä»‹ç»äº† C è¯­è¨€æ ‡å‡†åº“ä¸­ä¸å­—ç¬¦ã€å­—ç¬¦ä¸²å¤„ç†ï¼Œä»¥åŠæ•°å­¦è¿ç®—æœ‰å…³çš„å†…å®¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»‹ç»äº† C è¯­è¨€ä¸­å­—ç¬¦å’Œå­—ç¬¦ä¸²ç±»å‹å˜é‡çš„å®šä¹‰æ–¹å¼ã€‚å­—ç¬¦ä»¥å•å¼•å·å½¢å¼å®šä¹‰ï¼Œè€Œå­—ç¬¦ä¸²ä»¥åŒå¼•å·å½¢å¼å®šä¹‰ã€‚å­—ç¬¦ä¸²çš„ä¸åŒå®šä¹‰æ–¹å¼è¿˜å¯èƒ½å¯¹ç¨‹åºçš„è¿è¡Œç»†èŠ‚å¸¦æ¥å½±å“ã€‚å…¶ä¸­ï¼Œä»¥å­—ç¬¦æ•°ç»„å½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸²åŒ…å«æœ‰åŸå§‹å­—ç¬¦ä¸²åœ¨ .rodata ä¸­çš„æ‹·è´ï¼›è€Œä»¥æŒ‡é’ˆå½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸²å˜é‡åˆ™ç›´æ¥å¼•ç”¨äº† .rodata ä¸­çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œä¸”å…¶å€¼é€šå¸¸æ— æ³•åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«åŠ¨æ€ä¿®æ”¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å¿«é€Ÿä»‹ç»äº† C æ ‡å‡†åº“ä¸­ä¸å­—ç¬¦ã€å­—ç¬¦ä¸²å¤„ç†ç›¸å…³çš„ä¸€äº›å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ã€‚æœ€åï¼Œæˆ‘ä»‹ç»äº† C æ ‡å‡†åº“ä¸­ä¸æ•°å­¦è¿ç®—ç›¸å…³çš„å‡½æ•°ï¼Œmath.h å¤´æ–‡ä»¶ä¸­åŒ…å«æœ‰è¿™äº›å‡½æ•°çš„ç²¾ç¡®ç±»å‹ç‰ˆæœ¬ï¼Œè€Œ tgmath.h å¤´æ–‡ä»¶ä¸­åˆ™æä¾›äº†å¯¹åº”çš„æ³›å‹å®å‡½æ•°ç‰ˆæœ¬ã€‚è¿™äº›å‡½æ•°çš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼šæŸäº›å¸¸ç”¨çš„æ•°å­¦è¿ç®—ä¼šè¢«ç›´æ¥æ˜ å°„åˆ°å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œå’Œä½¿ç”¨çº¯è½¯ä»¶ç®—æ³•çš„å®ç°ç›¸æ¯”ï¼Œè¿™é€šå¸¸å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·äº†è§£ä¸€ä¸‹ C æ ‡å‡†åº“ä¸­ <code>strtok</code> å‡½æ•°çš„å®ç°ï¼Œå¹¶æ€è€ƒæ˜¯å“ªä¸€æ­¥å¼•èµ·äº†æ–‡ä¸­å®ä¾‹çš„ â€œSegmentation faultâ€ é”™è¯¯ã€‚ç„¶åï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œå¯ä»¥å°è¯•å®ç°ä¸€ä¸ªè‡ªå·±çš„ç‰ˆæœ¬ï¼Œæ‹¥æœ‰ä¸ <code>strtok</code> å‡½æ•°ä¸€æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸ä¿®æ”¹ä¼ å…¥çš„æºå­—ç¬¦ä¸²ã€‚</p><p>ä»Šå¤©çš„è¯¾ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œä¹Ÿå¸Œæœ›ä½ åœ¨ä¸‹æ–¹çš„ç•™è¨€åŒºå’Œæˆ‘ä¸€èµ·è®¨è®ºã€‚åŒæ—¶ï¼Œæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€‚</p>","comments":[{"had_liked":false,"id":337951,"user_name":"ppd0705","can_delete":false,"product_type":"c1","uid":1155646,"ip_address":"","ucode":"EB63D4E3FD1E9A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","comment_is_top":true,"comment_ctime":1647177442,"is_pvip":false,"replies":[{"id":"123708","content":"å¯ä»¥å°è¯•çœ‹çœ‹ musl ä¸­çš„å®ç°ï¼šhttp:&#47;&#47;git.musl-libc.org&#47;cgit&#47;musl&#47;tree&#47;include&#47;tgmath.h","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1647522546,"ip_address":"","comment_id":337951,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720385020006e+18","product_id":100100701,"comment_content":"çœ‹äº†åŠå¤©ä¹Ÿæ²¡çœ‹æ‡‚ tgmath.h æ€ä¹ˆå®ç°æ³›å‹çš„ï¼Œæœ‰å¤§ä½¬å¸®å¿™æŒ‡ç‚¹ä¸€äºŒå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556816,"discussion_content":"å¯ä»¥å°è¯•çœ‹çœ‹ musl ä¸­çš„å®ç°ï¼šhttp://git.musl-libc.org/cgit/musl/tree/include/tgmath.h","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647522546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557135,"discussion_content":"è°¢è°¢è€å¸ˆï¼Œ æˆ‘æƒ³å…¶å®è¿˜æ˜¯é€šè¿‡ä¸‰å…ƒè¿ç®—åˆ¤æ–­å‚æ•°ç±»å‹æ¥è½¬æ¢åˆ°å¯¹åº”çš„å‡½æ•°ä¸Šå»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647670866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328829,"user_name":"liu_liu","can_delete":false,"product_type":"c1","uid":1019138,"ip_address":"","ucode":"24283806A07759","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/02/6a16058a.jpg","comment_is_top":false,"comment_ctime":1640915220,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31705686292","product_id":100100701,"comment_content":"<br><br>strtok çš„åŸå‹å¦‚ä¸‹ï¼š<br><br>char *strtok(char *src, char *delim)ï¼›<br><br>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æºå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆ†éš”ç¬¦ã€‚<br><br><br>æœ€ä¸»è¦çš„åŸå› åœ¨äºï¼Œstrtok ä¼šå°†ä¿®æ”¹æºå­—ç¬¦ä¸²ï¼Œå°†æºå­—ç¬¦ä¸²ä¸­å‡ºç°çš„ delim æ›¿æ¢ä¸º &#39;\\0&#39;ã€‚è€Œä¾‹å­ä¸­ä¼ å…¥çš„æºå­—ç¬¦ä¸²æ˜¯ä¸ªå¸¸é‡ï¼Œå…¶åœ°å€æ˜¯ .rodata æ®µé‡Œé¢çš„åœ°å€ï¼Œä¸å¯ä¿®æ”¹çš„ï¼Œå› æ­¤è¿è¡Œä¼šæŠ¥é”™ã€‚","like_count":7},{"had_liked":false,"id":332811,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1643679650,"is_pvip":false,"replies":[{"id":"122216","content":"å›ç­”æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1645018998,"ip_address":"","comment_id":332811,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23118516130","product_id":100100701,"comment_content":"å¦‚æœæŠŠ strncpy å‡½æ•°ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨çš„ strlen å‡½æ•°æ›´æ¢æˆ sizeofï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ<br>ä¼šå¾—åˆ° 14 ä¸ªè¿ç»­çš„ bã€‚è¿™æ˜¯ç”±äº sizeof å¾—åˆ°çš„é•¿åº¦ä¸º 7ï¼Œä¼šå¯¼è‡´ strA çš„ç»ˆæ­¢ç¬¦è¢«æ›¿æ¢æˆ bï¼Œåé¢å†æ¬¡è¯»å– strA çš„æ—¶å€™ç”±äºæ— æ³•è¯†åˆ«åˆ°ç»ˆæ­¢ç¬¦ï¼Œä¼šç»§ç»­è¯»å–ï¼Œç›´åˆ°è¯»å–åˆ° strB çš„ç»ˆæ­¢ç¬¦æ‰ç»“æŸã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²åŠ èµ·æ¥å°±æ˜¯ 14 ä¸ª bã€‚","like_count":5,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551456,"discussion_content":"å›ç­”æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645018999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1000076,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","nickname":"é¾è¦","note":"","ucode":"BE1D500833F070","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":554107,"discussion_content":"strA æ˜¯ 6 ä¸ª aï¼ŒstrB æ˜¯ 7 ä¸ª bï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„åˆ°è¿™å·®å¼‚ã€‚ä»¥ä¸ºé•¿åº¦ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646216094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":551456,"ip_address":""},"score":554107,"extra":""}]},{"author":{"id":1613105,"avatar":"","nickname":"ä½•æ—","note":"","ucode":"34362DFA77E7AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588150,"discussion_content":"ç¡®å®šï¼Ÿæ¢æˆsizeof,æ€ä¹ˆæ‰§è¡Œç»“æœä¸ºç»“æœæ˜¯7ä¸ªb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663575406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328492,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1640753423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14525655311","product_id":100100701,"comment_content":"ä¸é”™ï¼Œå°±å–œæ¬¢è¿™ç§è®²ç»†èŠ‚çš„è¯¾ç¨‹ã€‚","like_count":4},{"had_liked":false,"id":328443,"user_name":"ç™½èŠ±é£ä¿¡å­","can_delete":false,"product_type":"c1","uid":2850941,"ip_address":"","ucode":"89CA70180EA326","user_header":"https://static001.geekbang.org/account/avatar/00/2b/80/7d/51914d34.jpg","comment_is_top":false,"comment_ctime":1640741749,"is_pvip":false,"replies":[{"id":"119638","content":"ä¼šçš„å“ˆï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ä¸ªæ¨¡å—ä¸­ä»‹ç»çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1005890","ctime":1640747103,"ip_address":"","comment_id":328443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14525643637","product_id":100100701,"comment_content":"å­¦åˆ°å¥½å¤šç»†èŠ‚ï¼ä¸è¿‡è€å¸ˆä¼šåœ¨åé¢å†æ·±å…¥ææelfæ–‡ä»¶æ˜¯æ€ä¹ˆåŠ è½½çš„å˜›qwqã€‚","like_count":3,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542425,"discussion_content":"ä¼šçš„å“ˆï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ä¸ªæ¨¡å—ä¸­ä»‹ç»çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640747103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328484,"user_name":"Ping","can_delete":false,"product_type":"c1","uid":1812754,"ip_address":"","ucode":"FC4743D8FEF61C","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/12/e041e7b2.jpg","comment_is_top":false,"comment_ctime":1640750288,"is_pvip":false,"replies":[{"id":"119759","content":"musl å…¶å®è·Ÿæˆ‘ä»¬å¸¸ç”¨çš„ glibcï¼ˆGNU C Libraryï¼‰ç±»ä¼¼ï¼Œä¸¤è€…åŒå±äº C æ ‡å‡†åº“ï¼ˆlibcï¼‰çš„ä¸€ç§å®ç°ã€‚åªæ˜¯ç›¸å¯¹æ¥è¯´ï¼Œglibc å®ç°è¾ƒä¸ºè‡ƒè‚¿ï¼Œå¥å£®æ€§ç¨å·®ï¼Œå­˜åœ¨çš„æ½œåœ¨æ¼æ´ä¹Ÿå¤šã€‚ä½†æ˜¯å®ç°çš„åŠŸèƒ½ä¼—å¤šï¼ˆæœ‰å¾ˆå¤š C æ ‡å‡†ä»¥å¤–çš„ï¼‰ï¼Œä¸”ä½¿ç”¨ä¹Ÿå¾ˆå¹¿æ³›ã€‚è€Œ musl åˆ™æ—¨åœ¨æä¾›ä¸€ä¸ªè½»é‡çº§çš„ã€ABI ç¨³å®šçš„ã€ä¸”é€‚ç”¨äºç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼ç³»ç»Ÿçš„ libc å®ç°ã€‚å®ƒæ”¯æŒçš„åŠŸèƒ½ä¸Šåˆ™å¯¹æ ‡ C æ ‡å‡†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1640834014,"ip_address":"","comment_id":328484,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10230684880","product_id":100100701,"comment_content":"è€å¸ˆèƒ½ä¸èƒ½ä»‹ç»ä¸€ä¸‹muslè¿™ä¸ªåº“çš„ç‰¹ç‚¹å’Œç”¨é€”ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542752,"discussion_content":"musl å…¶å®è·Ÿæˆ‘ä»¬å¸¸ç”¨çš„ glibcï¼ˆGNU C Libraryï¼‰ç±»ä¼¼ï¼Œä¸¤è€…åŒå±äº C æ ‡å‡†åº“ï¼ˆlibcï¼‰çš„ä¸€ç§å®ç°ã€‚åªæ˜¯ç›¸å¯¹æ¥è¯´ï¼Œglibc å®ç°è¾ƒä¸ºè‡ƒè‚¿ï¼Œå¥å£®æ€§ç¨å·®ï¼Œå­˜åœ¨çš„æ½œåœ¨æ¼æ´ä¹Ÿå¤šã€‚ä½†æ˜¯å®ç°çš„åŠŸèƒ½ä¼—å¤šï¼ˆæœ‰å¾ˆå¤š C æ ‡å‡†ä»¥å¤–çš„ï¼‰ï¼Œä¸”ä½¿ç”¨ä¹Ÿå¾ˆå¹¿æ³›ã€‚è€Œ musl åˆ™æ—¨åœ¨æä¾›ä¸€ä¸ªè½»é‡çº§çš„ã€ABI ç¨³å®šçš„ã€ä¸”é€‚ç”¨äºç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼ç³»ç»Ÿçš„ libc å®ç°ã€‚å®ƒæ”¯æŒçš„åŠŸèƒ½ä¸Šåˆ™å¯¹æ ‡ C æ ‡å‡†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640834014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328671,"user_name":"èµµå²©æ¾","can_delete":false,"product_type":"c1","uid":2032451,"ip_address":"","ucode":"596694E4360482","user_header":"https://static001.geekbang.org/account/avatar/00/1f/03/43/ed0dcb27.jpg","comment_is_top":false,"comment_ctime":1640832094,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5935799390","product_id":100100701,"comment_content":"ç»ˆäºåˆ°äº†æˆ‘æœŸå¾…çš„è®²æ ‡å‡†åº“çš„ç¯èŠ‚","like_count":1},{"had_liked":false,"id":357408,"user_name":"èŒƒæ–‡é¾™","can_delete":false,"product_type":"c1","uid":1027214,"ip_address":"åŒ—äº¬","ucode":"E77A5AF5BDBE6C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/8e/cb4cf9cb.jpg","comment_is_top":false,"comment_ctime":1663231078,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663231078","product_id":100100701,"comment_content":"å¦‚æœæŠŠ strncpy å‡½æ•°ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨çš„ strlen å‡½æ•°æ›´æ¢æˆ sizeofï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ<br>åœ¨X64 GCC8.1 æµ‹è¯•è¾“å‡º7ä¸ªbï¼ŒåŸå› æ˜¯strAçš„åœ°å€å¤§äºstrBçš„åœ°å€ï¼Œå¤åˆ¶åä¸ä¼šå’ŒstrBçš„å†…å®¹è¿èµ·æ¥ã€‚<br>å¦‚æœæŒ‰ç…§å¦‚ä¸‹ä¿®æ”¹ï¼Œè¾“å‡º14ä¸ªbï¼š<br>#include &lt;string.h&gt;<br>#include &lt;stdio.h&gt;<br>int main(void) {<br>  char strB[] = &quot;bbbbbbb&quot;;<br>  char strA[] = &quot;aaaaaa&quot;;<br>  printf(&quot;%s\\n&quot;, strncpy(strA, strB, sizeof(strA)));  &#47;&#47; &quot;bbbbbb&quot;.<br>}","like_count":0},{"had_liked":false,"id":353737,"user_name":"fei","can_delete":false,"product_type":"c1","uid":2126331,"ip_address":"æµ™æ±Ÿ","ucode":"36D802EB42FEF3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOUjOGRlYNY1TDZpso7LQEhMyqmgUqEW3sm5xWTHqhU5rUol8NeEOxLMQA5ib09Y8Yg97ziaqsKduA/132","comment_is_top":false,"comment_ctime":1659710746,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1659710746","product_id":100100701,"comment_content":"pgrep string | xargs -I {} cat &#47;proc&#47;{}&#47;maps<br>è¿™æ¡å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œstringè¿›ç¨‹è€æ—©é€€å‡ºäº†ã€‚è¿™ä¸ªå®éªŒè¦æ€ä¹ˆæ¥åšå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":348335,"user_name":"å¾é›…æ¸…","can_delete":false,"product_type":"c1","uid":1925507,"ip_address":"","ucode":"323818E7A11847","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIvc0wApgEPKYdf4T8eh0MpFxE3edvlKM9ibOPS09x9Wiavcj76ic3XpXQEpibmehC9srh7TKq2EgeK8Q/132","comment_is_top":false,"comment_ctime":1655003907,"is_pvip":false,"replies":[{"id":"127248","content":"å¾ˆå¥½çš„é—®é¢˜ï¼éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…ä¸ŠåŒ…æ‹¬ isalpha åœ¨å†…çš„ä¸€ç³»åˆ—å­—ç¬¦åˆ¤æ–­å‡½æ•°ï¼Œå®ƒä»¬çš„è¡Œä¸ºæ˜¯åœ¨æ»¡è¶³å‡½æ•°æ ¼å¼è¦æ±‚çš„æƒ…å†µä¸‹è¿”å›â€œéé›¶å€¼â€ï¼Œå¦åˆ™è¿”å› 0ã€‚è€Œè¿™é‡Œçš„éé›¶å€¼å…·ä½“æ˜¯å¤šå°‘åˆ™è§†ä¸åŒçš„ç¼–è¯‘å™¨è€Œå®šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1656224305,"ip_address":"","comment_id":348335,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655003907","product_id":100100701,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘åœ¨çº¿ç¼–è¯‘ï¼Œisalpha(c)çš„ç»“æœæ˜¯1024å‘¢ï¼Œå¤åˆ¶çš„è€å¸ˆçš„ä»£ç ","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577600,"discussion_content":"å¾ˆå¥½çš„é—®é¢˜ï¼éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…ä¸ŠåŒ…æ‹¬ isalpha åœ¨å†…çš„ä¸€ç³»åˆ—å­—ç¬¦åˆ¤æ–­å‡½æ•°ï¼Œå®ƒä»¬çš„è¡Œä¸ºæ˜¯åœ¨æ»¡è¶³å‡½æ•°æ ¼å¼è¦æ±‚çš„æƒ…å†µä¸‹è¿”å›â€œéé›¶å€¼â€ï¼Œå¦åˆ™è¿”å› 0ã€‚è€Œè¿™é‡Œçš„éé›¶å€¼å…·ä½“æ˜¯å¤šå°‘åˆ™è§†ä¸åŒçš„ç¼–è¯‘å™¨è€Œå®šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656224305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336558,"user_name":"é¾è¦","can_delete":false,"product_type":"c1","uid":1000076,"ip_address":"","ucode":"BE1D500833F070","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","comment_is_top":false,"comment_ctime":1646213218,"is_pvip":true,"replies":[{"id":"123038","content":"â€œæ•°ç»„å½¢å¼å®šä¹‰ï¼Œåº”è¯¥æ˜¯åœ¨æ ˆä¸Šç›´æ¥å®šä¹‰å±€éƒ¨å˜é‡å§ï¼Ÿâ€æ˜¯çš„å“ˆã€‚æˆ‘ä»¬è¿™é‡Œæ–‡ä¸­æåˆ°çš„â€œå¤åˆ¶â€æ˜¯æŒ‡å¯¹åŒæ ·çš„è¿™æ®µæ•°æ®ï¼Œç¼–è¯‘å™¨ä¼šé€šè¿‡å…¶ä»–çš„æ–¹å¼ä½¿ç”¨ï¼Œå¹¶ä¸æ˜¯è¯´åœ¨æœºå™¨æŒ‡ä»¤å±‚é¢æœ‰å¤åˆ¶çš„è¿‡ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1646309530,"ip_address":"","comment_id":336558,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646213218","product_id":100100701,"comment_content":"è€Œä½¿ç”¨æ•°ç»„å½¢å¼å®šä¹‰çš„å­—ç¬¦ä¸² strA ï¼Œåˆ™æ˜¯å°†è¯¥å­—ç¬¦ä¸²çš„æ•°æ®ä» .rodata ä¸­å¤åˆ¶åˆ°äº†å…¶ä»–åœ°æ–¹ï¼ŒstrA çš„å€¼ä¸ºå¤åˆ¶åè¯¥å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€åœ¨åœ°å€ã€‚<br><br>è€å¸ˆï¼Œæ•°ç»„å½¢å¼å®šä¹‰ï¼Œåº”è¯¥æ˜¯åœ¨æ ˆä¸Šç›´æ¥å®šä¹‰å±€éƒ¨å˜é‡å§ï¼Ÿ<br><br>#include &lt;stdio.h&gt;<br>int main(void) {<br>  const char strA[] = &quot;a&quot;;<br>  const char* strB = &quot;a&quot;;<br>  return 0;<br>}<br><br>.LC0:<br>        .string &quot;a&quot;<br>main:<br>        push    rbp<br>        mov     rbp, rsp<br>        mov     WORD PTR [rbp-10], 97<br>        mov     QWORD PTR [rbp-8], OFFSET FLAT:.LC0<br>        mov     eax, 0<br>        pop     rbp<br>        ret<br>","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554306,"discussion_content":"â€œæ•°ç»„å½¢å¼å®šä¹‰ï¼Œåº”è¯¥æ˜¯åœ¨æ ˆä¸Šç›´æ¥å®šä¹‰å±€éƒ¨å˜é‡å§ï¼Ÿâ€æ˜¯çš„å“ˆã€‚æˆ‘ä»¬è¿™é‡Œæ–‡ä¸­æåˆ°çš„â€œå¤åˆ¶â€æ˜¯æŒ‡å¯¹åŒæ ·çš„è¿™æ®µæ•°æ®ï¼Œç¼–è¯‘å™¨ä¼šé€šè¿‡å…¶ä»–çš„æ–¹å¼ä½¿ç”¨ï¼Œå¹¶ä¸æ˜¯è¯´åœ¨æœºå™¨æŒ‡ä»¤å±‚é¢æœ‰å¤åˆ¶çš„è¿‡ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646309530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336019,"user_name":"shk1230","can_delete":false,"product_type":"c1","uid":1701572,"ip_address":"","ucode":"9E39279C23FF8F","user_header":"https://static001.geekbang.org/account/avatar/00/19/f6/c4/e14686d4.jpg","comment_is_top":false,"comment_ctime":1645849652,"is_pvip":true,"replies":[{"id":"122793","content":"è¿™é‡Œå®é™…ä¸Šå°±æ˜¯å¯¹ tgmath.h ä¸­çš„è¿™äº›æ”¯æŒæ³›å‹å‚æ•°çš„å®å‡½æ•°ç®€ç§°å“ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1645875174,"ip_address":"","comment_id":336019,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645849652","product_id":100100701,"comment_content":"ä»€ä¹ˆå«æ³›å‹å®ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553395,"discussion_content":"è¿™é‡Œå®é™…ä¸Šå°±æ˜¯å¯¹ tgmath.h ä¸­çš„è¿™äº›æ”¯æŒæ³›å‹å‚æ•°çš„å®å‡½æ•°ç®€ç§°å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645875174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330989,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1642343360,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642343360","product_id":100100701,"comment_content":"æ‹·è´å­—ç¬¦ä¸²ï¼š strlen ä¸åŒ…å«ç»ˆæ­¢ç¬¦ï¼Œ sizeof ä¼šåŒ…å«ç»ˆæ­¢ç¬¦ï¼Œæ‰€ä»¥ä¼šå¤šæ‹·è´ä¸€ä¸ªå­—ç¬¦","like_count":0},{"had_liked":false,"id":329915,"user_name":"=","can_delete":false,"product_type":"c1","uid":2600127,"ip_address":"","ucode":"104232A8292220","user_header":"https://static001.geekbang.org/account/avatar/00/27/ac/bf/f549183e.jpg","comment_is_top":false,"comment_ctime":1641641564,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641641564","product_id":100100701,"comment_content":"å­—ç¬¦ä¸²å¸¸é‡ä¼šè¢«ä¿å­˜åœ¨.rodataæ®µä¸­ï¼Œä¸”å…¶å€¼ä¸å¯æ”¹å˜ã€‚<br>æ–‡ä¸­åœ¨strtokå‡½æ•°çš„ç¬¬ä¸€å‚æ•°ä¸Šï¼Œå³æºå­—ç¬¦ä¸²å¤„ä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œç„¶è€Œstrtokå‡½æ•°ä¼šæ”¹å˜æºå­—ç¬¦ä¸²çš„å€¼ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚","like_count":0},{"had_liked":false,"id":328569,"user_name":"ppm","can_delete":false,"product_type":"c1","uid":2550034,"ip_address":"","ucode":"A52733E4654270","user_header":"https://static001.geekbang.org/account/avatar/00/26/e9/12/a1d173fe.jpg","comment_is_top":false,"comment_ctime":1640774378,"is_pvip":false,"replies":[{"id":"120863","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1642340713,"ip_address":"","comment_id":328569,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640774378","product_id":100100701,"comment_content":"å†™äº†ä¸€ä¸ªstrtok https:&#47;&#47;gist.github.com&#47;goog&#47;f41b7b7fcdb7e9de93606c370c9d22b5","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546569,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642340713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328519,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1640761258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640761258","product_id":100100701,"comment_content":"å­¦åˆ°äº†.","like_count":0},{"had_liked":false,"id":328414,"user_name":"ppm","can_delete":false,"product_type":"c1","uid":2550034,"ip_address":"","ucode":"A52733E4654270","user_header":"https://static001.geekbang.org/account/avatar/00/26/e9/12/a1d173fe.jpg","comment_is_top":false,"comment_ctime":1640708506,"is_pvip":false,"replies":[{"id":"119646","content":"å—¯ï¼ŒæŸ¥äº†ä¸€ä¸‹æ‰å‘ç° snprintf æ¯” sprintf å‡½æ•°æ›´å®‰å…¨ä¸€äº›ã€‚æ–°çŸ¥è¯†å¾ˆåˆ°ä½ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1640750808,"ip_address":"","comment_id":328414,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640708506","product_id":100100701,"comment_content":"æ€ä¹ˆæ²¡æœ‰snprintfçš„ä¾‹å­","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542448,"discussion_content":"å—¯ï¼ŒæŸ¥äº†ä¸€ä¸‹æ‰å‘ç° snprintf æ¯” sprintf å‡½æ•°æ›´å®‰å…¨ä¸€äº›ã€‚æ–°çŸ¥è¯†å¾ˆåˆ°ä½ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640750808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}