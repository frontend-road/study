{"id":195330,"title":"17 | 为选项数据添加验证：避免错误配置的应用接收用户流量","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":180400,"user_name":"木风","can_delete":false,"product_type":"c3","uid":1339677,"ip_address":"","ucode":"3BAA80C2F1FB68","user_header":"https://static001.geekbang.org/account/avatar/00/14/71/1d/8d1d27b2.jpg","comment_is_top":false,"comment_ctime":1582274552,"is_pvip":false,"replies":[{"id":70473,"content":"当配置比较简单，且验证逻辑仅仅是对单个值的简单验证时，推荐DataAnnotations。\n\nDataAnnotations不满足时，推荐验证函数，在设计组件的配置读取时推荐这种写法。\n\n实现验证接口的方式，一般是验证逻辑较为复杂时，或验证逻辑依赖其它服务时。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582696276,"ip_address":"","comment_id":180400,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问三种验证方法在实操过程中，那种用得最多？谢谢","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484647,"discussion_content":"当配置比较简单，且验证逻辑仅仅是对单个值的简单验证时，推荐DataAnnotations。\n\nDataAnnotations不满足时，推荐验证函数，在设计组件的配置读取时推荐这种写法。\n\n实现验证接口的方式，一般是验证逻辑较为复杂时，或验证逻辑依赖其它服务时。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582696276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220797,"user_name":"Geek_ee4d86","can_delete":false,"product_type":"c3","uid":2013090,"ip_address":"","ucode":"983008639F0C44","user_header":"","comment_is_top":false,"comment_ctime":1590324833,"is_pvip":false,"replies":[{"id":82222,"content":" configuration.Bind(opt);   这句的作用就是将配置的值绑定到option上","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1591006508,"ip_address":"","comment_id":220797,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，你在\nservices.AddOptions&lt;OrderServiceOptions&gt;().Configure(opt =&gt; { configuration.Bind(opt); })\n                .Validate(opt =&gt; opt.MaxOrderCount &lt;= 100);\n绑定的应该是OrderServiceOptions类，所以值是从默认设置的值过来的，不是从配置文件中过来的，\n另外这种写法如何绑定配置文件？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496241,"discussion_content":" configuration.Bind(opt);   这句的作用就是将配置的值绑定到option上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591006508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210007,"user_name":"Geek_ae287d","can_delete":false,"product_type":"c3","uid":1974714,"ip_address":"","ucode":"7B627A8B1EF9FE","user_header":"","comment_is_top":false,"comment_ctime":1587650876,"is_pvip":false,"replies":[{"id":80608,"content":"感谢支持，可以在源码的github上交流","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1589685413,"ip_address":"","comment_id":210007,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"感觉可以当中api参考文档 demo  作者基础很扎实 视频没废话. 希望出深入一点的微服务项目实战课程","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492915,"discussion_content":"感谢支持，可以在源码的github上交流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589685413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182912,"user_name":"学习者","can_delete":false,"product_type":"c3","uid":1880838,"ip_address":"","ucode":"7B176FAE22C9E6","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b3/06/ab52e221.jpg","comment_is_top":false,"comment_ctime":1582889336,"is_pvip":false,"replies":[{"id":71003,"content":"你应该使用services.AddOptions&lt;OrderServiceOptions&gt;().Bind","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1583046079,"ip_address":"","comment_id":182912,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"你好，肖老师： services.Configure&lt;OrderServiceOptions&gt;(configuration) 变成  \n        services.AddOptions&lt;OrderServiceOptions&gt;().Configure(options =&gt;\n            {\n                configuration.Bind(options);\n            }) ....\n   之后，修改json文件里 maxordercount值，options.OnChange 不执行了，为什么?","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485503,"discussion_content":"你应该使用services.AddOptions&amp;lt;OrderServiceOptions&amp;gt;().Bind","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583046079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1552436,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b0/34/a1f5b643.jpg","nickname":"生亦何欢","note":"","ucode":"2DCC6FA1F53D00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269766,"discussion_content":"我觉得 services.AddOptions<OrderServiceOptions>().Bind 这个才是主流的使用方式，因为验证就是要验证后面的改动，没有人会在初始配置的时候 出错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589947463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1600512,"avatar":"https://static001.geekbang.org/account/avatar/00/18/6c/00/4f8bf010.jpg","nickname":"Alan","note":"","ucode":"4934BCA1990F1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203111,"discussion_content":"为什么这是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583998957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1880838,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b3/06/ab52e221.jpg","nickname":"学习者","note":"","ucode":"7B176FAE22C9E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192089,"discussion_content":"谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583062619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179937,"user_name":"顾你心安","can_delete":false,"product_type":"c3","uid":1813098,"ip_address":"","ucode":"D0080EBA52CFBB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/aa/6a/fade4619.jpg","comment_is_top":false,"comment_ctime":1582124095,"is_pvip":false,"replies":[{"id":70272,"content":"趁机充充电也不错","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582520263,"ip_address":"","comment_id":179937,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"疫情让大家都很难受","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484455,"discussion_content":"趁机充充电也不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582520263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180399,"user_name":"木风","can_delete":false,"product_type":"c3","uid":1339677,"ip_address":"","ucode":"3BAA80C2F1FB68","user_header":"https://static001.geekbang.org/account/avatar/00/14/71/1d/8d1d27b2.jpg","comment_is_top":false,"comment_ctime":1582274540,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问三种验证方法在实操过程中，那种用得最多？谢谢","like_count":1},{"had_liked":false,"id":176677,"user_name":"不深刻，不痛快！","can_delete":false,"product_type":"c3","uid":1808288,"ip_address":"","ucode":"873A7F3961BFF9","user_header":"https://static001.geekbang.org/account/avatar/00/1b/97/a0/9973bbaf.jpg","comment_is_top":false,"comment_ctime":1581136625,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"等疫情结束后去校宝面试[笑脸]","like_count":1},{"had_liked":false,"id":279672,"user_name":"RH999","can_delete":false,"product_type":"c3","uid":2209570,"ip_address":"","ucode":"7C927A58CCA850","user_header":"","comment_is_top":false,"comment_ctime":1613899523,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"            1. services.Configure&lt;OrderServiceOptions&gt;(configuration);\n            2. services.AddOptions&lt;OrderServiceOptions&gt;().Configure(options =&gt;\n            {\n                configuration.Bind(options);\n            });\n\n老師你好，在影片中有提到這兩種寫法相同，不過我剛才測試過第二種寫法是無法監聽到配置變化的，請問在有驗證又有監聽的需求時，該如何設計呢?","like_count":0},{"had_liked":false,"id":272616,"user_name":"达叔灬","can_delete":false,"product_type":"c3","uid":2404887,"ip_address":"","ucode":"5CCBAF13548F02","user_header":"https://static001.geekbang.org/account/avatar/00/24/b2/17/3161b49c.jpg","comment_is_top":false,"comment_ctime":1610175915,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖大神  配置了验证后 发现 IOptionsMonitor.OnChange()方法酒不起作用了 ","like_count":0}]}