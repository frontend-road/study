{"id":733840,"title":"01ï½œæŒä¹…çš„ä¼ å¥‡ï¼šTomcatçš„å‘å±•å†ç¨‹ä¸æ¡†æ¶æ¼”è¿›","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ï¼Œä»ä»Šå¤©å¼€å§‹æˆ‘ä»¬æ¥å­¦ä¹ æ‰‹å†™ MiniTomcatã€‚</p><p>ä½œä¸ºä½¿ç”¨Javaè¯­è¨€è¿›è¡ŒWebç¨‹åºå¼€å‘çš„äººæ¥è¯´ï¼Œå¯¹Tomcatæƒ³å¿…æ˜¯ä¸é™Œç”Ÿçš„ã€‚Tomcatæ˜¯ä¸€æ¬¾è½»é‡çº§çš„Javaåº”ç”¨æœåŠ¡å™¨ï¼Œæœ€æ—©æ˜¯Sunå…¬å¸åœ¨1998å¹´å¼€å‘çš„ã€‚å½“æ—¶å¼€å‘Tomcatçš„ç›®æ ‡æ˜¯æˆä¸ºSunå…¬å¸çš„Java Servletå’ŒJSPè§„èŒƒçš„å‚è€ƒå®ç°ã€‚</p><p>å¦‚ä»ŠTomcatæ˜¯ä¸šåŠ¡å¼€å‘é¦–é€‰çš„å¼€æºWebåº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨Spring MVCé¡¹ç›®ä¸­ä¼šæŠŠå®ƒä½œä¸ºç¨‹åºçš„å¯åŠ¨å®¹å™¨ï¼Œç”šè‡³åœ¨Spring Bootæ¡†æ¶ä¸­ç›´æ¥å°†Tomcatå†…ç½®ä¸ºWebåº”ç”¨çš„å¯åŠ¨å®¹å™¨ï¼Œä¸å†éœ€è¦ç¨‹åºå¼€å‘è€…è‡ªè¡Œé…ç½®ï¼Œè¿›ä¸€æ­¥ç®€åŒ–äº†å¼€å‘é—¨æ§›ã€‚å¯ä»¥è¯´ï¼Œè™½ç„¶Tomcatä¸æ˜¯WebæœåŠ¡å™¨çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ä¹Ÿå’ŒSpringä¸€æ ·ï¼Œæˆä¸ºäº†Javaå¼€å‘é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ã€‚äºŒåäº”å¹´ä»¥æ¥é•¿ç››ä¸è¡°ï¼Œåœ¨æ—¥æ–°æœˆå¼‚çš„ITé¢†åŸŸï¼Œå¯è°“æ˜¯æŒä¹…çš„ä¼ å¥‡ã€‚</p><h2>ç‰ˆæœ¬å˜åŒ–</h2><p>è·Ÿä»»ä½•ä¸€ä¸ªæˆåŠŸçš„äº§å“ä¸€æ ·ï¼ŒTomcatä¹Ÿä¸æ˜¯ä¸€è¯ç”Ÿå°±æ˜¯ç°åœ¨è¿™ä¸ªæ ·å­çš„ï¼Œå®ƒä¹Ÿæ˜¯ç»å†äº†é€æ¸å®Œå–„å’Œå¼ºå¤§çš„å‘å±•å†ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/yy/ce/yy534ab3e199fe942495da89ab56bece.png?wh=1920x981\" alt=\"å›¾ç‰‡\" title=\"å›¾ç‰‡æºè‡ªç½‘ç»œ\"></p><p>Tomcatçš„å‘æ˜äººæ˜¯James Duncan Davidsonã€‚ä»–åœ¨1997å¹´åŠ å…¥Sunå…¬å¸ï¼Œç„¶åå¼€å§‹åŠ¨æ‰‹å†™Tomcatï¼Œè¿™æ˜¯Sunå¯¹å¤–æä¾›çš„ä¸€ä¸ªServletå®¹å™¨çš„å‚è€ƒå®ç°ï¼Œåæ¥å¤§åé¼é¼çš„Springå‘æ˜äººRod Johnsonä¹Ÿæ˜¯Servletä¸“å®¶ç»„æˆå‘˜ã€‚1998å¹´å¯¹å¤–å…¬å¼€çš„æ—¶å€™æ ‡è®°ä¸º2.0ç‰ˆæœ¬ï¼Œåˆ°äº†1999å¹´ï¼ŒSunå…¬å¸å°±æŠŠå®ƒæèµ ç»™äº†ApacheåŸºé‡‘ä¼šã€‚</p><!-- [[[read_end]]] --><p>ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§å‘å¸ƒæ—¶é—´æ¥æ¢³ç†ä¸€ä¸‹Tomcatçš„ä¸»è¦ç‰ˆæœ¬ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ey/17/eyy97a8bec58d154e3edf356cb8f2d17.png?wh=5120x2190\" alt=\"\"></p><p>ç›®å‰æ­£åœ¨å¼€å‘ä¸­çš„ç‰ˆæœ¬æ˜¯11ã€‚</p><h2>ç¨‹åºå†…éƒ¨ç»“æ„</h2><p>ä½œä¸ºç¨‹åºå‘˜ï¼Œé™¤äº†äº†è§£ç‰ˆæœ¬å‘å¸ƒæƒ…å†µä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´è¦ä»”ç»†ç¢ç£¨Tomcatç¨‹åºçš„å†…éƒ¨ç»“æ„ï¼Œå› ä¸ºä»å†…éƒ¨ç»“æ„ä¸­æˆ‘ä»¬å¯ä»¥æ”¶è·æ›´å¤šçš„æŠ€æœ¯æ€æƒ³ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„å®è§‚ç»“æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/37/8424cda2303f030e15c0f162f16e7737.png?wh=1920x1072\" alt=\"å›¾ç‰‡\"></p><p>ä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºï¼ŒTomcatçš„ç»“æ„å‡ºå¥‡åœ°ç®€å•è‡ªç„¶ï¼Œä»æœ€é¡¶å±‚æ¥çœ‹ï¼Œå°±æ˜¯ä¸€ä¸ªServeræä¾›Serviceï¼Œåœ¨å†…éƒ¨é€šè¿‡å®¹å™¨ç®¡ç†Servletï¼Œå¯¹å¤–é€šè¿‡Connectoræ¥å—å®¢æˆ·ç«¯çš„è®¿é—®ã€‚</p><p>å¦‚æœä½ å†™è¿‡æœåŠ¡å™¨ç¨‹åºï¼Œé‚£ä¹ˆä½ åº”è¯¥å¯¹è¿™ä¸ªç»“æ„ä¸€ç‚¹éƒ½ä¸é™Œç”Ÿï¼Œå‡ ä¹æ‰€æœ‰çš„Serverè½¯ä»¶éƒ½æ˜¯è¿™ä¸ªç»“æ„ã€‚å¾€å†…éƒ¨å†ç»†åˆ†ï¼Œä¸€èˆ¬å°±æ˜¯é€šè¿‡Socketå®Œæˆå®¢æˆ·ç«¯çš„è¿æ¥ç®¡ç†ï¼Œç”±ä¸€ä¸ªå†…éƒ¨å®¹å™¨æŒ‰ç…§è§„å®šçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†Servletã€‚</p><p>æˆ‘ä»¬å†ä»”ç»†ç‚¹ï¼Œçœ‹çœ‹Tomcatæ˜¯å¦‚ä½•å“åº”è¯·æ±‚çš„ã€‚</p><ol>\n<li>ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼Œè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæŒ‰ç…§Socketæ¨¡å‹ï¼Œè¿™ä¸ªè®¿é—®è¢«ä¸€ä¸ªç«¯å£é©»å®ˆçš„ç¨‹åºæ”¶åˆ°ï¼Œå¦‚8080ã€‚åœ¨Tomcatä¸­ï¼Œè´Ÿè´£è¿™ä¸€å—çš„æ˜¯åœ¨é‚£é‡Œç›‘å¬çš„Coyote Connectorã€‚</li>\n<li>Connectorè§£æSocketæ¥çš„è¯·æ±‚æµï¼Œå†å°†è¯¥è¯·æ±‚äº¤ç»™å®ƒæ‰€åœ¨çš„Serviceçš„Engineæ¥å¤„ç†ï¼Œå¹¶ç­‰å¾…Engineçš„å›åº”ã€‚</li>\n<li>Engineè·å¾—è¯·æ±‚URIï¼ŒåŒ¹é…åˆ°åˆé€‚çš„è™šæ‹Ÿä¸»æœºHostã€‚</li>\n<li>è¿™ä¸ªHostè·å¾—è¯·æ±‚ä¸²ï¼ŒåŒ¹é…åˆ°åˆé€‚çš„Contextã€‚</li>\n<li>åœ¨Contextä¸­å¯»æ‰¾å‡ºå¯¹åº”çš„Servletï¼ˆå…¶å®æ˜¯ä¸€ä¸ªWrapperï¼‰ å¤„ç†æ•°æ®ã€‚</li>\n<li>å°†æ„é€ HttpServletRequestå¯¹è±¡å’ŒHttpServletResponseå¯¹è±¡ï¼Œä½œä¸ºå‚æ•°è°ƒç”¨Servletçš„ <code>service()</code> æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€æ•°æ®å­˜å‚¨ç­‰ç¨‹åºã€‚</li>\n<li>ContextæŠŠæ‰§è¡Œå®Œä¹‹åçš„HttpServletResponseå¯¹è±¡è¿”å›ç»™Hostã€‚</li>\n<li>HostæŠŠHttpServletResponseå¯¹è±¡è¿”å›ç»™Engineã€‚</li>\n<li>EngineæŠŠHttpServletResponseå¯¹è±¡è¿”å›Connectorã€‚</li>\n<li>ConnectoræŠŠHttpServletResponseå¯¹è±¡åºåˆ—åŒ–è¿”å›ç»™æµè§ˆå™¨ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/3e/df/3e9479e9ff9c440a5710c140b5c4a4df.png?wh=1920x950\" alt=\"å›¾ç‰‡\"></p><p>ä»¥ä¸Šå°±æ˜¯ Tomcat å¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚çš„å®Œæ•´æµç¨‹ã€‚</p><p>æ ¸å¿ƒé“ç†å¾ˆç®€å•ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªSocket Serverï¼Œä½†æ˜¯å¯¹åº”åˆ°å·¥ç¨‹ä¸Šå´å¹¶ä¸å®¹æ˜“ã€‚å¦‚æœè¿™ä¸ªæœåŠ¡å™¨åªéœ€è¦å“åº”ä¸€æ¬¡è¯·æ±‚ï¼Œç¡®å®æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯åšçš„ï¼Œä½†æ˜¯ç°å®ä¸–ç•Œå¹¶ä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘ä¸€äº›å•°å—¦äº‹ã€‚</p><ol>\n<li>å¦‚ä½•ç®¡ç†å¤šä¸ªServletï¼Ÿ</li>\n<li>å¦‚ä½•æ”¯æŒå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Ÿ</li>\n<li>å¤§é‡ç”¨æˆ·è¯·æ±‚çš„æ€§èƒ½é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ</li>\n</ol><p>ä½œä¸ºä¸€æ¬¾å®ç”¨çš„Servletåº”ç”¨æœåŠ¡å™¨ï¼Œè€ƒè™‘åˆ°è¿™äº›äº‹é¡¹ï¼Œå†…éƒ¨çš„ç¨‹åºç»“æ„ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚è¿™äº›åœ¨æˆ‘ä»¬å­¦ä¹ äº†Tomcatçš„æºç åï¼Œä¼šæœ‰å¾ˆå¤šçš„å¯å‘ã€‚</p><h2>ç¨‹åºç»“æ„çš„æ¼”åŒ–</h2><p>æ²¡æœ‰äººèƒ½ä¸€æ­¥åˆ°è¾¾ç»ˆç‚¹ï¼Œè½¯ä»¶çš„æ¼”åŒ–è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šäº‰è®ºå¦¥åï¼Œæœ‰çš„è®¾è®¡åˆ°åé¢åˆè¢«æŠ›å¼ƒäº†ï¼Œååå¤å¤ã€‚Tomcatä¹Ÿèµ°è¿‡äº†åŒæ ·çš„è·¯ï¼Œç¼–ç¨‹çš„é¡¶çº§é«˜æ‰‹ä¹Ÿæ˜¯è¦å‘•å¿ƒæ²¥è¡€æ‰èƒ½ä¿®å¾—æ­£æœçš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ï¼ŒTomcatæ˜¯å¦‚ä½•ä¸€æ­¥æ­¥æ¼”åŒ–çš„ã€‚</p><h4>ç¬¬ä¸€æ­¥ï¼šè®¾è®¡ä¸€ä¸ªç®€å•çš„Socket Server</h4><p>è®¾è®¡ä¸€ä¸ªSocket Serverï¼Œå¯åŠ¨åè´Ÿè´£ç›‘å¬ç½‘ç»œæ¥çš„è¯·æ±‚ï¼Œè·å¾—ä¸€ä¸ªSocketè¿æ¥ã€‚ç„¶åè¿™ä¸ªServerè¦è§£æè¯·æ±‚ä¸²ï¼ŒçŸ¥é“éœ€è¦å¤„ç†ä»€ä¹ˆäº‹æƒ…ï¼Œç„¶åè°ƒç”¨ç›¸å…³çš„ç¨‹åºå®Œæˆç›¸å…³ä»»åŠ¡ã€‚æœ€åå¾—åˆ°è¿”å›å¤„ç†ç»“æœï¼Œå°†è¿™ä¸ªç»“æœå†é€šè¿‡Socketä¼ å›å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä¸ªç®€å•çš„ç»“æ„å¾ˆæœ‰æ•ˆï¼Œä¹Ÿå¾ˆç®€æ˜ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼šè¯·æ±‚ç›‘å¬å’Œå¤„ç†é€»è¾‘æ”¾åœ¨ä¸€èµ·æ‰©å±•æ€§å¾ˆå·®ã€‚å¤„ç†æ˜¯ä¸€ä¸ªä¸€ä¸ªä¸²è¡Œå®Œæˆçš„ï¼Œæ€§èƒ½ä¸å¥½ã€‚</p><h4>ç¬¬äºŒæ­¥ï¼šå°†è¿æ¥ä¸å¤„ç†åˆ†ç¦»</h4><p>å› ä¸ºç¬¬ä¸€æ­¥æ˜¾è€Œæ˜“è§çš„ç¼ºç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠServeræ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼šConnectorå’ŒProcessorã€‚Serveråªæ˜¯ä¸€ä¸ªå¤–å£³ï¼Œè´Ÿè´£å¯åŠ¨ã€‚Connectoræ¥è´Ÿè´£ç›‘å¬ç½‘ç»œæ¥çš„è¯·æ±‚ï¼Œè·å¾—ä¸€ä¸ªSocketè¿æ¥ï¼Œè§£æè¯·æ±‚åå‘ç»™Processorï¼Œç„¶åProcessorè°ƒç”¨ç›¸å…³çš„ç¨‹åºå®Œæˆç›¸å…³ä»»åŠ¡ï¼Œæœ€åå¾—åˆ°è¿”å›å¤„ç†ç»“æœï¼Œå°†è¿™ä¸ªç»“æœè¿”å›ç»™Connectorï¼ŒConnectorå†é€šè¿‡Socketä¼ å›ç½‘ç»œå®¢æˆ·ç«¯ã€‚</p><p>ç»è¿‡è¿™ä¸€æ­¥çš„åˆ†å·¥ï¼ŒServerçš„ç¨‹åºç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå„å¸å…¶èŒã€‚ä½†ä¹‹å‰çš„ç¼ºç‚¹å¹¶æ²¡æœ‰å®Œå…¨ä¼˜åŒ–ï¼Œæ€§èƒ½é—®é¢˜è¿˜æ²¡æœ‰è§£å†³ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œéœ€è¦è®¾è®¡å¤šä¸ªProcessorï¼Œæ”¾åˆ°ä¸€ä¸ªæ± ä¸­ï¼Œæ”¯æŒå¹¶å‘æ‰§è¡Œã€‚</p><h4>ç¬¬ä¸‰æ­¥ï¼šå¤šå±‚å®¹å™¨Container</h4><p>ä¸ºäº†è¿›ä¸€æ­¥æ‰©å±•ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬è¦æŠŠåé¢å¯¹Servletçš„å¤„ç†åˆ†æˆå¤šå±‚å®¹å™¨ï¼Œé¦–å…ˆæ˜¯ç›´æ¥åŒ…è£…Servletçš„Wrapperï¼Œç„¶åå¯¹åº”ä¸€ä¸ªåº”ç”¨Contextï¼Œä¸€ä¸ªContextå¯¹è±¡ä¼šåŒ…å«å¤šä¸ªWrapperå¯¹è±¡ï¼Œç”¨äºåˆ†åˆ«ç®¡ç†å¤šä¸ª Servletï¼Œè€ŒContextä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œå†å¾€ä¸ŠæŠ½è±¡å‡ºHostå’ŒEngineã€‚</p><p>ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/9d/d9a7502b8a368f75cb0d36454119e19d.png?wh=1920x1110\" alt=\"å›¾ç‰‡\"></p><ul>\n<li>Engineï¼šè¿™ä¸ªæ˜¯Tomcatçš„é¡¶å±‚å®¹å™¨ï¼Œå­—å¦‚å…¶ä¹‰ï¼Œä¸€ä¸ª Engineå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Servlet å¼•æ“ï¼Œå®ƒæ¥æ”¶æ¥è‡ªConnectorçš„è¯·æ±‚ï¼Œå¹¶ä¼ ç»™åˆé€‚çš„Hostæ¥å¤„ç†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™Connectorã€‚</li>\n<li>Hostï¼šè¡¨ç¤ºä¸€ä¸ªä¸»æœºï¼Œå³ä¸€ä¸ªTomcatå¯ä»¥ç®¡ç†å¤šä¸ªè™šæ‹Ÿçš„ä¸»æœºã€‚</li>\n<li>Contextï¼šè¡¨ç¤ºä¸€ä¸ªWebåº”ç”¨ï¼Œå³WebAppä¸‹çš„åº”ç”¨ã€‚ä¸€ä¸ªHostå¯ä»¥æœ‰å¤šä¸ªContextã€‚</li>\n<li>Wrapperï¼šè¡¨ç¤ºä¸€ä¸ªServletï¼Œç”¨æ¥å…·ä½“å¤„ç†ç›¸åº”è¯·æ±‚ã€‚ä¸€ä¸ªContextå¯ä»¥æœ‰å¤šä¸ªWrapperã€‚</li>\n</ul><p>è¿™ä¸ªå¤šå±‚åµŒå¥—çš„Containerç»“æ„ä¸€ç›´ä¿ç•™ç€ï¼Œä¸è¿‡ä»å®é™…æ•ˆæœä¸Šçœ‹ï¼ŒEngineå’ŒHostå…¶å®æ„ä¹‰ä¸å¤§äº†ï¼ŒDockeræŠ€æœ¯çš„å‡ºç°ï¼Œå°†Tomcatçš„è¿™ä¸ªè®¾è®¡å˜æˆäº†é¸¡è‚‹ã€‚</p><h4>ç¬¬å››æ­¥ï¼šService</h4><p>ç°åœ¨æ¼”åŒ–åˆ°äº†Connecter + å¤šå±‚Containerè¿™ä¸ªç»“æ„ï¼Œç»§ç»­æ‰©å±•ã€‚ç”¨Serviceè¿™ä¸ªæ¦‚å¿µæŠŠConnectorå’ŒContaineråŒ…å«è¿›å»äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/bc/f894c7c0c8ea457cb861a6854yy904bc.png?wh=1920x1154\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ ·åœ¨ä¸€ä¸ªServerä¸­å¯ä»¥åŒ…å«å¤šä¸ªServiceï¼Œæ¯ä¸€ä¸ªServiceéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚ä¸€ä¸ªServiceè´Ÿè´£ç»´æŠ¤å¤šä¸ªConnectorå’Œä¸€ä¸ªé¡¶å±‚Containerã€‚å½“éœ€è¦ä½¿ç”¨å¤šä¸ªç«¯å£æ—¶ï¼Œåªéœ€è¦é…ç½®å¤šä¸ªServiceã€‚</p><p>Tomcaté»˜è®¤ä¼šå¯åŠ¨ä¸€ä¸ªåä¸ºCatalinaçš„Serviceã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/23/fa/23662f5cbb3abb5f347d7f5b72df27fa.png?wh=1920x944\" alt=\"å›¾ç‰‡\"></p><h4>ç¬¬äº”æ­¥ï¼šç”Ÿå‘½å‘¨æœŸï¼ˆLifeCycleï¼‰</h4><p>Tomcatä¸­æ¯ä¸ªç»„ä»¶éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸã€‚Connectorå’ŒContaineréƒ½å®ç°äº†LifeCycleæ¥å£ã€‚ç”Ÿå‘½å‘¨æœŸæœ‰BEFORE_INIT_EVENTã€AFTER_INIT_EVENTã€START_EVENTç­‰çŠ¶æ€ã€‚ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•æœ‰init()ã€start()ã€stopã€getState()ç­‰ã€‚</p><h4>ç¬¬å…­æ­¥ï¼šå¼•å…¥NIO</h4><p>ä¸ºäº†æ”¯æŒé«˜å¹¶å‘ï¼Œåœ¨åŸæœ‰çš„BIOæ¨¡å¼ä¸‹å·²ç»å¾ˆéš¾ç»§ç»­æ‰©å±•è¿™ä¸ªèƒ½åŠ›ï¼Œäºæ˜¯Tomcat 6.0ä¹‹åå¼•å…¥äº†NIOçš„æ”¯æŒã€‚ç»“æ„å›¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/27/48/27368da773161e4b110a231e517b3948.png?wh=1920x605\" alt=\"å›¾ç‰‡\"></p><p>å¯¹NIOçš„æ”¯æŒï¼Œå®è§‚ä¸Šä¸»è¦å½±å“çš„æ˜¯Connectorè¿™ä¸€éƒ¨åˆ†ã€‚å®ƒæ˜¯ç°ä»£Tomcatå¯¹é«˜å¹¶å‘æä¾›æ”¯æŒçš„è®¾è®¡ï¼ŒTomcat 6.0ä¸­å°±æä¾›äº†æ”¯æŒï¼Œæ—©æœŸçš„server.xmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€ä¸ªé…ç½®ï¼š</p><pre><code class=\"language-plain\">&lt;Connector connectionTimeout=\"20000\" maxThreads=\"1000\" port=\"8080\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" redirectPort=\"8443\"/&gt;\n</code></pre><p>è¿™å°±è¡¨æ˜å®ƒä½¿ç”¨äº†NIOæ¨¡å¼ã€‚</p><p>æ€»ä½“æ¥çœ‹ï¼Œå¯¹å¤§è§„æ¨¡ä¼ä¸šåº”ç”¨ï¼ŒNIOæ€§èƒ½ä¸Šä¼šæ˜æ˜¾ä¼˜äºBIOï¼Œæ‰€ä»¥Tomcat 9.0ä¹‹åå¹²è„†å°±ä¸æ”¯æŒBIOæ¨¡å¼äº†ã€‚ç¨‹åºæ¨¡å¼ç”±BIOæ¼”åŒ–åˆ°NIOï¼Œæ˜¯ä¸ºäº†å¤šè·¯å¤ç”¨ï¼ŒæŠ€æœ¯ä¸Šæ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œä»å®é™…è¿‡ç¨‹æ¥å›é¡¾ï¼Œè¿™ä¸€éƒ¨åˆ†çš„è®¾è®¡ä¹Ÿç»å†äº†åå¤ã€‚</p><p>å¼€å§‹çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/24/a5/2446a998f9b243ebb7565842bfdcfda5.png?wh=1920x923\" alt=\"å›¾ç‰‡\"></p><p>è¿™ä¸ªç»“æ„å¾ˆåºå¤§ï¼Œæœ‰å¤šä¸ªAcceptorå’Œå¤šä¸ªPollerï¼Œç¨‹åºå¤æ‚æ€§ä¹Ÿé«˜ã€‚ç”±äºå¤æ‚æ€§ä»¥åŠå®é™…æ•ˆæœï¼Œåé¢çš„ç‰ˆæœ¬å°†è¿™ä¸ªè®¾è®¡ç¼©äº†å›æ¥ï¼Œä»Tomcat 9.0å¼€å§‹ï¼ŒNioEndpointç»“æ„ä¸­Acceptorä¸Pollerä»…æ”¯æŒå®šä¹‰å•ä¸ªAcceptorå’Œå•ä¸ªPollerã€‚ä¹Ÿå°±æ˜¯è¯´å¼€å§‹çš„æ„æ€æœ‰ç‚¹è¿‡åº¦è®¾è®¡äº†ï¼Œå¯è§é«˜æ‰‹ä¹Ÿä¸æ˜¯ä¸€æ¬¡æ€§èƒ½æŠŠäº‹æƒ…å¼„å¥½çš„ï¼Œå‡¡äº‹éƒ½è¦ä¸æ–­åˆ‡ç£‹ã€‚ç°åœ¨çš„ç‰ˆæœ¬è¿›ä¸€æ­¥å°†NIOå˜æˆäº†NIO2ï¼Œæˆäº†å®Œå…¨çš„å¼‚æ­¥æ¨¡å¼ã€‚</p><h2>MiniTomcatçš„è·¯å¾„</h2><p>æˆ‘ä»¬è‡ªå·±æ‰‹å†™MiniTomcatçš„ç›®çš„æ˜¯å­¦ä¹ Tomcatï¼Œæ›´å¥½åœ°å¼„æ‡‚å®ƒã€‚æˆ‘ä»¬ä¹Ÿä¼šæŒ‰ç…§ç”±ç®€åˆ°ç¹çš„è¿‡ç¨‹ä¸€æ­¥æ­¥æ„å»ºï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“äº†Tomcatæœ¬èº«çš„å‘å±•è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¹ŸæŒ‰ç…§å®ƒçš„è¿‡ç¨‹ä¸€æ­¥æ­¥èµ°è¿‡æ¥ã€‚è‡ªå·±æ‰‹å†™ä¸€éæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åªä¼šèµ°åˆ°ç¬¬å››æ­¥ï¼Œä¹Ÿå°±æ˜¯Connector + å¤šå±‚Containerã€‚è¿™ä¹ˆè€ƒè™‘çš„åŸå› æ˜¯åé¢çš„å†…å®¹éš¾åº¦æ¯”è¾ƒé«˜ï¼Œç¯‡å¹…ä¹Ÿå¤šï¼Œåº”å½“å•ç‹¬æˆä¹¦ï¼Œæœªæ¥æœ‰æœºä¼šæˆ‘ä»¬å†å…¬å¸ƒå‡ºæ¥ã€‚åˆ°äº†ç¬¬å››æ­¥ï¼ŒTomcatæ—©æœŸç‰ˆæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†ä¹Ÿéƒ½åŒ…å«è¿›æ¥äº†ï¼Œå¯¹åº”ç€Tomcat 6.0ä¹‹å‰çš„çŠ¶å†µã€‚</p><p>æˆ‘ä»¬åœ¨ä»Šåçš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¿ƒé‡Œè¦æœ‰è¿™ä¸ªå¤§å›¾æ™¯ã€‚</p><h2>å°ç»“</h2><p>Tomcatè·å¾—äº†æŒä¹…çš„æˆåŠŸï¼Œå¯¹ä¸šç•Œå½±å“æ·±è¿œã€‚è¿™é‡Œçš„å…³é”®å°±åœ¨äºåˆ›å§‹è€…James Duncan Davidsonï¼Œä»–ç«‹æ„é«˜è¿œï¼Œçœ¼ç•Œå®å¤§ï¼Œç»ˆæˆæ•°åå¹´ä»¥æ¥çš„â€œåé—¨æ­£æ´¾â€ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œé¡¶çº§ç¨‹åºå‘˜ä¹Ÿä¸æ˜¯ç¥ä»™ï¼Œå¹¶ä¸èƒ½ä¸€æ¬¡æ€§æ„å»ºå¥½ä¸€ä¸ªServerï¼Œä¹Ÿéœ€è¦ä¸æ–­å°è¯•ï¼Œä¸æ–­æ¥å—çœŸå®ä¸–ç•Œçš„åé¦ˆå¹¶è°ƒæ•´è®¾è®¡æ–¹æ¡ˆï¼ŒNIOå®ç°ä¸­çš„Acceptorå’ŒPolleræ± æœ€ç»ˆè¢«åºŸå¼ƒå°±æ˜¯æ˜è¯ã€‚</p><p>æˆ‘ä»¬ä½œä¸ºåå­¦è€…è¦å­¦ä¼šæ²¿ç€å·¨äººçš„è„šæ­¥ï¼Œä¸€æ­¥æ­¥å‰è¿›ã€‚å¯¹æŠ€æœ¯çš„é«˜å³°ï¼Œæˆ–è®¸â€œè™½ä¸èƒ½è‡³ï¼Œè€Œå¿ƒå‘å¾€ç„‰â€ï¼Œç›¸ä¿¡æ²¿é€”ä¹Ÿä¼šæ”¶è·å¾ˆå¤šæ‚Ÿé“çš„å–œæ‚¦ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä½ å¯ä»¥è¯´ä¸€è¯´Tomcatçš„å†…éƒ¨æ„é€ æ˜¯æ€æ ·çš„å—ï¼Œå…±åŒ…å«å“ªå‡ éƒ¨åˆ†ï¼Ÿæ¬¢è¿ä½ æŠŠç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":385324,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1702448281,"is_pvip":false,"replies":[{"id":140438,"content":"Peterï¼Œé«˜å…´å†è§åˆ°ä½ ã€‚ä½ çš„é—®é¢˜æ¶µç›–äº†å…¨è¯¾ç¨‹ï¼Œåé¢å­¦äº†éƒ½æœ‰è®²åˆ°ã€‚è¿™é‡Œæˆ‘åªè¯•ç€å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒJSPç¡®å®åŸºæœ¬è¢«åºŸå¼ƒäº†ï¼Œæœ€è¿‘äº›å¹´ï¼Œç”¨å•é¡µé¢åº”ç”¨å®ç°å‰åç«¯åˆ†ç¦»ã€‚ä½†æ˜¯TomcatæœåŠ¡å™¨ä¸»è¦ä¸ºäº†å…¼å®¹å†å²ï¼Œè¿˜æ˜¯ä¿ç•™äº†å¯¹JSPçš„æ”¯æŒï¼Œæ¬¡è¦çš„åŸå› ï¼ŒJSPä¸èƒ½ä¸€æ¦‚æŠ›å¼ƒï¼Œä»»ä½•ä¸€é—¨æŠ€æœ¯éƒ½æœ‰é€‚ç”¨èŒƒå›´ï¼Œå¯¹äºç®€å•çš„å°åº”ç”¨ï¼ŒJSPæ˜¯å¾ˆé€‚åˆçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702521773,"ip_address":"åŒ—äº¬","comment_id":385324,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šTomcatä¸ºä»€ä¹ˆè¿˜æ”¯æŒJSPï¼Ÿ\nç¬¬01è¯¾ä¸­æåˆ°äº†Tomcatçš„å‘å±•å†å²ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æ”¯æŒJSPï¼ŒåŒ…æ‹¬æœ€æ–°çš„ç‰ˆæœ¬10ã€‚ä½†JSPåŸºæœ¬å·²ç»è¢«åºŸå¼ƒï¼Œæ²¡æœ‰äººç”¨JSPäº†ã€‚ä¸ºä»€ä¹ˆè¿˜è¦æ”¯æŒJSPï¼Ÿ\nQ2ï¼šTomcatä¸­Engineåªæœ‰ä¸€ä¸ªå®ä¾‹å—ï¼Ÿ\nQ3ï¼šä¸€ä¸ªcontextå¯¹åº”ä¸€ä¸ªwebåº”ç”¨ï¼Œcontextä¸‹é¢æœ‰å¤šä¸ªservletã€‚é‚£ä¹ˆï¼Œcontextä¸‹é¢çš„servletæ•°é‡æ˜¯æ€ä¹ˆå†³å®šçš„ï¼Ÿ\nQ4ï¼šç«¯å£å’Œserviceå¯¹åº”å—ï¼Ÿå³ä¸€ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªservice?\nQ5ï¼šNIOå®ç°ä¸­ï¼Œä¸ºä»€ä¹ˆæŠ›å¼ƒå¤šä¸ªAcceptorå’ŒPollerçš„æ–¹æ¡ˆè€Œé‡‡ç”¨å•ä¾‹çš„æ–¹æ¡ˆï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633709,"discussion_content":"Peterï¼Œé«˜å…´å†è§åˆ°ä½ ã€‚ä½ çš„é—®é¢˜æ¶µç›–äº†å…¨è¯¾ç¨‹ï¼Œåé¢å­¦äº†éƒ½æœ‰è®²åˆ°ã€‚è¿™é‡Œæˆ‘åªè¯•ç€å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒJSPç¡®å®åŸºæœ¬è¢«åºŸå¼ƒäº†ï¼Œæœ€è¿‘äº›å¹´ï¼Œç”¨å•é¡µé¢åº”ç”¨å®ç°å‰åç«¯åˆ†ç¦»ã€‚ä½†æ˜¯TomcatæœåŠ¡å™¨ä¸»è¦ä¸ºäº†å…¼å®¹å†å²ï¼Œè¿˜æ˜¯ä¿ç•™äº†å¯¹JSPçš„æ”¯æŒï¼Œæ¬¡è¦çš„åŸå› ï¼ŒJSPä¸èƒ½ä¸€æ¦‚æŠ›å¼ƒï¼Œä»»ä½•ä¸€é—¨æŠ€æœ¯éƒ½æœ‰é€‚ç”¨èŒƒå›´ï¼Œå¯¹äºç®€å•çš„å°åº”ç”¨ï¼ŒJSPæ˜¯å¾ˆé€‚åˆçš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1702521774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","nickname":"HHğŸ·ğŸ ","note":"","ucode":"C50172BDA604D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633712,"discussion_content":"Q5ä¸ªäººçŒœæƒ³æ˜¯å¤šä¸ªç»´æŠ¤ä»£ç éš¾åº¦å¤§ï¼Œ è€Œä¸”æ€§èƒ½å¹¶ä¸æ¯”å•ä¸ªé«˜å¤šå°‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702527566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385380,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1702536025,"is_pvip":false,"replies":[{"id":140447,"content":"åœ¨å‡†å¤‡ï¼Œå·²ç»ç»™å‡ ä¸ªç ”ç©¶ç”Ÿè¯•è®²è¿‡äº†ï¼Œè¿˜æ²¡æ•´ç†ã€‚ä¹‹åå†å•†é‡å…¬å¼€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702560260,"ip_address":"åŒ—äº¬","comment_id":385380,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"ğŸŒğŸŒçœ‹äº†æœ¬æ–‡æ›´åŠ æœŸå¾…è€å¸ˆçš„ç¬¬äº”å’Œç¬¬å…­éƒ¨åˆ†ï¼Œ ä¸çŸ¥é“è€å¸ˆæ˜¯å¦æœ‰è®¡åˆ’ï¼Œé‚£éƒ¨åˆ†ä¹Ÿæ˜¯é‡å¤´æˆã€‚","like_count":2,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633749,"discussion_content":"åœ¨å‡†å¤‡ï¼Œå·²ç»ç»™å‡ ä¸ªç ”ç©¶ç”Ÿè¯•è®²è¿‡äº†ï¼Œè¿˜æ²¡æ•´ç†ã€‚ä¹‹åå†å•†é‡å…¬å¼€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702560260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1133678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","nickname":"HHğŸ·ğŸ ","note":"","ucode":"C50172BDA604D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":633777,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702615461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":633749,"ip_address":"å¹¿ä¸œ","group_id":0},"score":633777,"extra":""}]}]},{"had_liked":false,"id":385390,"user_name":"Geek_50a5cc","can_delete":false,"product_type":"c1","uid":1786951,"ip_address":"åŒ—äº¬","ucode":"0F6C1C2552261F","user_header":"","comment_is_top":false,"comment_ctime":1702548275,"is_pvip":false,"replies":[{"id":140446,"content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702560178,"ip_address":"åŒ—äº¬","comment_id":385390,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æ ¹æ®8.0çš„Server.xml æ¥çœ‹å’Œè€å¸ˆè®²è§£ çš„ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åˆ†ä¸º Server,Service,Connector,Egine,Host,(Listenerï¼ŒRealm,Valueä¸€äº›å°ç»„ä»¶),Context,Servlet(Wrapper);","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633748,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702560179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385333,"user_name":"Martito","can_delete":false,"product_type":"c1","uid":3171426,"ip_address":"å±±ä¸œ","ucode":"6C29938DB2A92B","user_header":"https://static001.geekbang.org/account/avatar/00/30/64/62/8b20c551.jpg","comment_is_top":false,"comment_ctime":1702455646,"is_pvip":false,"replies":[{"id":140442,"content":"èµï¼é‡è¦çš„åœ°æ–¹è®°ä¸‹æ¥","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1702538989,"ip_address":"åŒ—äº¬","comment_id":385333,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"Containerï¼š ç”¨äºç®¡ç† Servlet å’Œ JSP çš„ç”Ÿå‘½å‘¨æœŸã€‚\n\nEngineï¼š Engine æ˜¯æœ€é«˜çº§åˆ«çš„å®¹å™¨ï¼Œä»£è¡¨æ•´ä¸ª Tomcat æœåŠ¡å™¨ã€‚ä¸€ä¸ª Tomcat å®ä¾‹å¯ä»¥åŒ…å«å¤šä¸ª Engineï¼Œæ¯ä¸ª Engine é€šå¸¸å¯¹åº”ä¸€ä¸ªè™šæ‹Ÿä¸»æœºhostã€‚\n\nHostï¼š Host å®šä¹‰äº†ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥åŒ…å«å¤šä¸ª Contextã€‚\n\nContextï¼š Context è¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ª Context å®šä¹‰äº†ç‰¹å®š Web åº”ç”¨çš„é…ç½®ä¿¡æ¯ã€‚\n\nServletï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å­˜å‚¨çš„ç»„ä»¶ï¼Œé€šè¿‡ HttpServletRequest å’Œ HttpServletResponse ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ã€‚","like_count":1,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633731,"discussion_content":"èµï¼é‡è¦çš„åœ°æ–¹è®°ä¸‹æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702538990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385979,"user_name":"é£ç¿”","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"ç¾å›½","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1703756778,"is_pvip":false,"replies":[{"id":140670,"content":"ä½ çš„å»ºè®®å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703821383,"ip_address":"æ¹–å—","comment_id":385979,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è€å¸ˆ å¸Œæœ›æŠŠæ‰‹å†™ç³»åˆ—å»¶ç»­å‡ºå» ä¹‹åè¿˜ä¼šæ‰‹å†™ä»€ä¹ˆä¸­é—´ä»¶å˜›","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634698,"discussion_content":"ä½ çš„å»ºè®®å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703821383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":2789996,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKw8ictgYcqf6vA0VtY9iabwS2nuZ4b46RvTW8FTe9VdjouiarROhqzxdia7H65tUw65tkibyeu8a4AHDw/132","nickname":"Geek_b0e84e","note":"","ucode":"CA160DDE5A2845","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":635254,"discussion_content":"minredisæˆ–è€…kafkaä¸­é—´ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704640642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":634698,"ip_address":"å®‰å¾½","group_id":0},"score":635254,"extra":""}]},{"author":{"id":1006884,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/24/1ffe5724.jpg","nickname":"çˆ±ä¸Šæ˜Ÿäº‘","note":"","ucode":"658529DC4D6295","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634765,"discussion_content":"æ‰‹å†™MQ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703906901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385431,"user_name":"å¼ ç¿€","can_delete":false,"product_type":"c1","uid":1241064,"ip_address":"å››å·","ucode":"835A01424FDD5E","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/e8/076a6f59.jpg","comment_is_top":false,"comment_ctime":1702621312,"is_pvip":false,"replies":[{"id":140468,"content":"ä¸ä¼šè¯¦ç»†è®²ï¼Œåé¢ä¼šç®€å•æ¢è®¨ä¸€ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†åº”å•ç‹¬æˆä¹¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702688119,"ip_address":"åŒ—äº¬","comment_id":385431,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·é—®æœ¬ç³»åˆ—è¯¾ç¨‹ä¼šè®²è§£Tomcatçš„nioå®ç°å’ŒAprç­‰å®ç°å—","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633863,"discussion_content":"ä¸ä¼šè¯¦ç»†è®²ï¼Œåé¢ä¼šç®€å•æ¢è®¨ä¸€ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†åº”å•ç‹¬æˆä¹¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702688119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}