{"id":620065,"title":"12ï½œå¦‚ä½•è‡ªåŠ¨æ£€æŸ¥ä¸šåŠ¡çœŸå®çš„å¥åº·çŠ¶æ€ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚ä»Šå¤©æ˜¯ kubernetes æç®€å®æˆ˜è¿™ä¸€ç« çš„æœ€åä¸€è¯¾ã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä¸ºå·¥ä½œè´Ÿè½½é…ç½®èµ„æºé…é¢ï¼Œè¿˜è¯¦ç»†ä»‹ç»äº†èµ„æº Request å’Œ Limit çš„å«ä¹‰å’Œç”¨æ³•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é‡ç‚¹å­¦ä¹ äº†å¦‚ä½•ä¸ºä¸šåŠ¡é…ç½®æ°´å¹³æ‰©å®¹ï¼ˆHPAï¼‰ï¼Œå½“ä¸šåŠ¡é¢ä¸´è¾ƒå¤§çš„è¯·æ±‚æµé‡æ—¶ï¼Œå®ƒèƒ½å¤Ÿå®ç°è‡ªåŠ¨æ‰©å®¹ã€‚</p><p>å½“è§¦å‘è‡ªåŠ¨æ‰©å®¹æ—¶ï¼Œå·¥ä½œè´Ÿè½½çš„ Replicas å­—æ®µå°†è¢«è°ƒæ•´ï¼Œç„¶å ReplicaSets å¯¹è±¡å°†åˆ›å»ºæ–°çš„ Pod å‰¯æœ¬ï¼Œè¿™äº›å‰¯æœ¬åœ¨æœªå°±ç»ªï¼ˆReadyï¼‰ä¹‹å‰ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°çš„ç°è±¡æ˜¯ kubernetes ä¸ä¼šå°†æµé‡è½¬å‘åˆ°è¿™äº› Pod ä¸Šã€‚é‚£ä¹ˆï¼Œä½ æœ‰æ²¡æœ‰è€ƒè™‘è¿‡ï¼Œkubernetes æ˜¯æ€ä¹ˆåˆ¤æ–­æ–°åˆ›å»ºçš„ Pod æ˜¯å¦å·²ç»å¤„äºâ€œå°±ç»ªâ€çŠ¶æ€çš„å‘¢ï¼Ÿ</p><p>å¯¹äºå¯åŠ¨æ—¶é—´æ¯”è¾ƒæ…¢çš„ä¸šåŠ¡åº”ç”¨æ¥è¯´ï¼Œå¯åŠ¨é˜¶æ®µå¹¶ä¸ç­‰äºå°±ç»ªï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„åœºæ™¯ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬æ€ä¹ˆå‘Šè¯‰ kubernetes ä»€ä¹ˆæ—¶å€™å¯ä»¥æ¥æ”¶è¯·æ±‚æµé‡ï¼Ÿ</p><p>å†è¯´å¦ä¸€ä¸ªæˆ‘ä»¬ä¸ŠèŠ‚è¯¾æåˆ°çš„åœºæ™¯ï¼Œå¦‚æœä¸šåŠ¡åº”ç”¨æ²¡æœ‰åšå¥½åƒåœ¾å›æ”¶æˆ–è€…äº§ç”Ÿæ­»é”ï¼Œé‚£ä¹ˆå†è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå®ƒçš„å†…å­˜å’Œ CPU æ¶ˆè€—ä¼šè¿…é€Ÿé£™å‡ã€‚æ˜¾ç„¶ï¼Œè¿™æ—¶å€™ Pod å·²ç»å¤„äºä¸å¥åº·çŠ¶æ€äº†ï¼Œæ€ä¹ˆè®© kubernetes è¯†åˆ«å¹¶å°†å®ƒé‡å¯å‘¢ï¼Ÿ</p><p>è¦è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°<strong>kubernetes çš„å¥åº·æ£€æŸ¥</strong>ã€‚</p><!-- [[[read_end]]] --><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šé¦–å…ˆå¸¦ä½ å­¦ä¹  Pod çš„çŠ¶æ€æœºåˆ¶ï¼Œç„¶åé€šè¿‡ç¤ºä¾‹åº”ç”¨ï¼Œè¿›ä¸€æ­¥ä»‹ç»æ€ä¹ˆä¸ºå·¥ä½œè´Ÿè½½é…ç½®å¥åº·æ£€æŸ¥ï¼Œæœ€ç»ˆè§£å†³æˆ‘ä»¬åˆšæ‰æå‡ºçš„è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>é€šè¿‡å·¥ä½œè´Ÿè½½çš„å¥åº·æ£€æŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ kubernetes æä¾›ä¸šåŠ¡çš„çœŸå®çŠ¶æ€ï¼Œæœ‰äº†è¿™äº›çœŸå®çŠ¶æ€ï¼Œkubernetes å°±å¯ä»¥çŸ¥é“ Pod ä»€ä¹ˆæ—¶å€™å·²ç»å‡†å¤‡å¥½æ¥æ”¶å¤–éƒ¨æµé‡ï¼Œä»€ä¹ˆæ—¶å€™å­˜åœ¨å¼‚å¸¸éœ€è¦é‡å¯äº†ã€‚</p><p>kubernetes çš„å¥åº·æ£€æŸ¥ç±»å‹ä¸€å…±æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šReadinessã€Livenesså’ŒStartupProbeã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è¿›ä¸€æ­¥çœ‹çœ‹å®ƒä»¬çš„åŠŸèƒ½å’Œé…ç½®æ–¹æ³•ã€‚</p><h2>Pod å’Œå®¹å™¨çš„çŠ¶æ€</h2><p>è¦æƒ³å¼„æ‡‚ kubernetes çš„å¥åº·æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Pod å’Œå®¹å™¨çš„çŠ¶æ€ã€‚</p><p>Pod çš„ç”Ÿå‘½å‘¨æœŸä¸€å…±æœ‰ä¸‹é¢è¿™ 5 ä¸ªçŠ¶æ€ã€‚</p><ul>\n<li>Pendingï¼šæ­£åœ¨åˆ›å»º Podï¼Œä¾‹å¦‚è°ƒåº¦ Pod å’Œæ‹‰å–é•œåƒçš„é˜¶æ®µã€‚</li>\n<li>Runningï¼šè¿è¡Œé˜¶æ®µï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨å¯åŠ¨æˆ–è¿è¡Œã€‚</li>\n<li>Succeededï¼šè¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸”ä¸ä¼šé‡æ–°å¯åŠ¨ï¼Œä¾‹å¦‚ Job åˆ›å»ºçš„ Podã€‚</li>\n<li>Failedï¼šPod çš„æ‰€æœ‰å®¹å™¨éƒ½åœæ­¢äº†ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºçŠ¶æ€ç é 0ã€‚</li>\n<li>Unknownï¼šæ— æ³•è·å– Pod çš„çŠ¶æ€ã€‚</li>\n</ul><p>æˆ‘ä»¬æœ€å¸¸æ¥è§¦åˆ°çš„ Pod çŠ¶æ€æ˜¯ Pending å’Œ Runningã€‚Pending ä»£è¡¨ Pod æ­£åœ¨åˆ›å»ºä¸­ï¼Œè€Œ Running çŠ¶æ€åˆ™è¦æ±‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨å¯åŠ¨ä¸­æˆ–è€…æ­£åœ¨è¿è¡Œã€‚</p><p>è€Œå¯¹äº Pod ä¸­çš„å®¹å™¨ï¼Œä¹Ÿæœ‰ä¸‹é¢ 3 ç§çŠ¶æ€ã€‚</p><ul>\n<li>Waitingï¼šå®¹å™¨ç­‰å¾…ä¸­ï¼Œä¾‹å¦‚æ­£åœ¨æ‹‰å–é•œåƒã€‚</li>\n<li>Runningï¼šå®¹å™¨è¿è¡Œä¸­ï¼ŒPID=1 çš„ä¸šåŠ¡è¿›ç¨‹æ­£åœ¨å¯åŠ¨æˆ–è¿è¡Œã€‚</li>\n<li>Terminatedï¼šå®¹å™¨ç»ˆæ­¢ä¸­ï¼Œä¾‹å¦‚æ­£åœ¨åˆ é™¤ Podã€‚</li>\n</ul><p>æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹æ··ä¹±ï¼Ÿæ²¡å…³ç³»ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å…³æ³¨ Pod å’Œå®¹å™¨åŒæ—¶å¤„äº Running çš„çŠ¶æ€ï¼Œå…¶ä»–çš„æš‚æ—¶å¿½ç•¥å°±å¯ä»¥ã€‚</p><p>å½“ Pod å¤„äº Running çŠ¶æ€æ—¶ï¼Œä»£è¡¨è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤„äºå¯åŠ¨æˆ–è¿è¡ŒçŠ¶æ€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å®¹å™¨çš„ Running çŠ¶æ€å°±å¯ä»¥é—´æ¥å†³å®š Pod çš„çŠ¶æ€ã€‚è€Œå½“å®¹å™¨çŠ¶æ€ä¸º Running æ—¶ï¼Œä»£è¡¨ PID=1 çš„ä¸šåŠ¡è¿›ç¨‹æ­£åœ¨å¯åŠ¨æˆ–è¿è¡Œã€‚</p><p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸šåŠ¡è¿›ç¨‹è¿˜å¤„äºå¯åŠ¨è¿‡ç¨‹æ—¶ï¼ŒPod å’Œå®¹å™¨éƒ½å¤„äº Running çŠ¶æ€ï¼Œä½†ç”±äºä¸šåŠ¡å¹¶æ²¡æœ‰å®Œæˆå¯åŠ¨ï¼Œæ‰€ä»¥è¿˜ä¸å…·å¤‡æ¥æ”¶å¤–éƒ¨æµé‡çš„æ¡ä»¶ã€‚</p><p>è¿™æ—¶å€™ï¼Œå…‰æœ‰ä¸€ä¸ª Running çŠ¶æ€æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæè¿° Pod æ˜¯å¦å·²ç»å°±ç»ªå¹¶å‡†å¤‡å¥½æ¥æ”¶å¤–éƒ¨è¯·æ±‚çš„æ ‡è¯†ï¼Œ<strong>å®ƒå°±æ˜¯ Pod çš„ Ready å­—æ®µã€‚</strong></p><h3>Ready çŠ¶æ€</h3><p>åœ¨ kubernetes ä¸­ï¼ŒPod çš„ Ready å­—æ®µç”¨æ¥æ ‡è¯†æ˜¯å¦å·²ç»å°±ç»ªï¼Œå®ƒæ˜¯ç”± kubelet ç›´æ¥ç®¡ç†çš„ï¼Œ Ready çŠ¶æ€è¢«è®°å½•åœ¨äº† Pod Manifest çš„ status.conditions å­—æ®µä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c2/2d/c20419d8a29fe35c8b590556704ac82d.png?wh=982x870\" alt=\"å›¾ç‰‡\"></p><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ kubectl get pods æ¥æŸ¥çœ‹ Pod æ˜¯å¦å¤„äº Ready çŠ¶æ€ã€‚</p><pre><code class=\"language-powershell\">$ kubectl get pods -n example\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; RESTARTS&nbsp; &nbsp; &nbsp; &nbsp; AGE\nbackend-5969f76d6c-jf9lq&nbsp; &nbsp; 0/1&nbsp; &nbsp; &nbsp;Pending&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;102m\nbackend-86d76d8764-cl2pf&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;109m\nbackend-86d76d8764-pgvhd&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;109m\nfrontend-fc597b5d9-qcbfb&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;2 (5h32m ago)&nbsp; &nbsp;19h\npostgres-7745b57d5d-5lbzz&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;3 (5h32m ago)&nbsp; &nbsp;15d\n</code></pre><p>åœ¨è¿”å›ç»“æœçš„ Ready å­—æ®µä¸­ï¼Œ1/1 è¡¨ç¤ºè¿è¡Œä¸­çš„å®¹å™¨æ•°é‡å’Œæ€»å®¹å™¨æ•°é‡ï¼Œå½“è¿™ä¸¤è€…æ•°é‡ç›¸ç­‰æ—¶ï¼Œä»£è¡¨ Pod å¤„äº Ready çŠ¶æ€ï¼Œè¯´æ˜ Pod å·²ç»å°±ç»ªå¹¶å‡†å¤‡å¥½äº†æ¥æ”¶å¤–éƒ¨æµé‡ã€‚</p><p>äº†è§£äº† Ready çŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬å›åˆ°å¥åº·æ£€æŸ¥çš„é—®é¢˜ä¸Šæ¥ã€‚</p><h2>å¥åº·æ£€æŸ¥</h2><p>è¿˜è®°å¾—æˆ‘åœ¨æœ€å¼€å§‹æåˆ°çš„ä¸€ä¸ªä¾‹å­å—ï¼Ÿç°åœ¨æ¥è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬ä¸ºæŸä¸ªä¸šåŠ¡é…ç½®äº† CPU é™åˆ¶ï¼Œä¸šåŠ¡è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œç”±äºä¸šåŠ¡åº”ç”¨æ²¡æœ‰åšå¥½åƒåœ¾å›æ”¶ç”šè‡³äº§ç”Ÿæ­»é”çš„æƒ…å†µï¼Œå¯¼è‡´å®ƒçš„ CPU å ç”¨ç‡ä¸€ç›´å¤„åœ¨é™åˆ¶å€¼é™„è¿‘ã€‚æ­¤æ—¶ï¼Œè™½ç„¶ Pod çš„ä¸šåŠ¡è¿›ç¨‹ä»åœ¨è¿è¡Œï¼Œä½†å®é™…ä¸Šå®ƒå·²ç»æ— æ³•å¾—åˆ°æ›´å¤šçš„ CPU æ—¶é—´ç‰‡äº†ã€‚</p><p>æˆ‘çš„é—®é¢˜æ˜¯ï¼Œè¿™æ—¶å€™å®ƒèƒ½æ­£å¸¸å¤„ç†ä¸šåŠ¡è¯·æ±‚å—ï¼Ÿæ¯«æ— ç–‘é—®ï¼Œå®ƒå¤„ç†ä¸šåŠ¡ä¼šéå¸¸ç¼“æ…¢ï¼Œç”šè‡³ä¼šå®Œå…¨ä¸å¯ç”¨ã€‚</p><p>é™¤äº†å› ä¸ºèµ„æºä¸è¶³å¯¼è‡´ä¸šåŠ¡ä¸å¯ç”¨ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç±»å…¸å‹çš„åœºæ™¯ï¼šåœ¨è¿›è¡Œæ°´å¹³æ‰©å®¹æ—¶ï¼Œç”±äºæ–°åˆ›å»ºçš„ Pod çš„ä¸šåŠ¡è¿›ç¨‹éœ€è¦çš„å¯åŠ¨æ—¶é—´è¾ƒé•¿ï¼ˆä¾‹å¦‚å¯¹äºå¤§å‹çš„ Java åº”ç”¨ï¼Œå¾€å¾€éœ€è¦æ•°åˆ†é’Ÿçš„å¯åŠ¨æ—¶é—´ï¼‰ï¼Œå¦‚æœåœ¨ä¸šåŠ¡å¯åŠ¨æ—¶å°±å°† Pod æ ‡è®°ä¸º Ready çŠ¶æ€å¹¶æ¥æ”¶å¤–éƒ¨è¯·æ±‚æµé‡ï¼Œå°†ä¼šæœ‰éƒ¨åˆ†è¯·æ±‚å¾—åˆ°é”™è¯¯çš„è¿”å›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/59/22/594974b7f2fe428a411c818ac9bb2722.jpg?wh=1920x1536\" alt=\"\"></p><p>æ‰€ä»¥ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½å¼•å‡ºäº†ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„åœºæ™¯ï¼šå› ä¸ºä¸šåŠ¡è¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼ŒPod å’Œå®¹å™¨ä¹Ÿå¤„äº Running çŠ¶æ€ï¼Œæ‰€ä»¥ kubernetes ä¼šè®¤ä¸ºå½“å‰ Pod æ˜¯å°±ç»ªçš„ã€‚ä½†å®é™…ä¸Šï¼Œä¸šåŠ¡å¯èƒ½æ­£å¤„äºâ€œå¯åŠ¨ä¸­â€æˆ–è€…å‡ºç°â€œèµ„æºä¸è¶³â€çš„æƒ…å†µï¼Œæš‚æ—¶æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>è¿™ä¸¤ä¸ªä¾‹å­å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>Podå°±ç»ªï¼ˆReadyï¼‰ä¸ç­‰äºä¸šåŠ¡å¥åº·ã€‚</strong></p><p>é‚£ä¹ˆï¼Œå¦‚ä½•æ‰èƒ½è®© kubernetes æ„ŸçŸ¥åˆ°ä¸šåŠ¡çœŸå®çš„å¥åº·çŠ¶æ€å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° kubernetes æ¢é’ˆã€‚</p><h3>æ¢é’ˆçš„æ£€æŸ¥æ–¹å¼</h3><p>kubernetes æ¢é’ˆä¸€å…±æœ‰ä¸‰ç§æ–¹å¼æ¥å‘ Pod å‘èµ·å¥åº·æ£€æŸ¥ã€‚</p><ul>\n<li>HTTP è¯·æ±‚ï¼Œé€šè¿‡å‘å®¹å™¨å‘èµ· HTTP è¯·æ±‚ï¼Œå¹¶è¯†åˆ«è¯·æ±‚å“åº”ä»£ç æ¥åˆ¤æ–­ä¸šåŠ¡çŠ¶æ€ã€‚</li>\n<li>åœ¨å®¹å™¨å†…è¿è¡Œå‘½ä»¤ï¼Œé€šè¿‡åœ¨å®¹å™¨é‡Œè¿è¡Œä¸€æ¡å‘½ä»¤å¹¶æ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç æ¥åˆ¤æ–­ä¸šåŠ¡å¥åº·çŠ¶æ€ã€‚</li>\n<li>TCP ç«¯å£çŠ¶æ€åˆ¤æ–­ï¼Œé€šè¿‡æ˜¯å¦èƒ½å¤Ÿå’ŒæŒ‡å®šç«¯å£å»ºç«‹è¿æ¥æ¥åˆ¤æ–­ä¸šåŠ¡å¥åº·çŠ¶æ€ã€‚</li>\n</ul><p>åœ¨è¿™ä¸‰ç§å¥åº·æ£€æŸ¥æ–¹å¼ä¸­ï¼ŒHTTP è¯·æ±‚çš„æ£€æŸ¥æ–¹å¼æ˜¯æˆ‘ä»¬åœ¨æ—¥å¸¸å·¥ä½œä¸­æœ€å¸¸ç”¨åˆ°çš„ä¸€ç§ã€‚å­¦ä¼šäº†è¿™ä¸€ç§ï¼Œå…¶ä»–ä¸¤ç§è¦é…ç½®èµ·æ¥ä¹ŸåŸºæœ¬æ²¡é—®é¢˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥å®ƒä¸ºä¾‹åšæ·±å…¥ä»‹ç»ã€‚</p><p>è‡³äºåä¸¤ç§æ£€æŸ¥æ–¹å¼å‘¢ï¼Œæˆ‘ä¼šå¸®ä½ åˆ—å‡ºå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ä¾›ä½ äº†è§£ï¼Œåœ¨æœªæ¥å·¥ä½œä¸­ï¼Œå¦‚æœæœ‰éœ€è¦ä½ å¯ä»¥å†æŸ¥æ‰¾ç›¸å…³èµ„æ–™æ¥åšé…ç½®ã€‚å®ƒä»¬çš„ä¸»è¦ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ã€‚</p><ul>\n<li>å¦‚æœä¸šåŠ¡è¿›ç¨‹åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­éœ€è¦ä¾èµ– Pod å†…çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„è¿è¡ŒçŠ¶æ€ï¼Œä¾‹å¦‚åˆ¤æ–­å®¹å™¨å†…æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è¿è¡Œå‘½ä»¤çš„å¥åº·æ£€æŸ¥æ–¹å¼æ¥è¿›è¡Œåˆ¤æ–­ã€‚</li>\n<li>å¦‚æœä¸šåŠ¡è¿›ç¨‹æ— æ³•æä¾› HTTP è¯·æ±‚ï¼Œä¾‹å¦‚æœåŠ¡å¯¹å¤–æä¾› GRPCã€RPC æ¥å£æ—¶ï¼ŒTCP ç«¯å£åˆ¤æ–­çš„æ–¹å¼å°±éå¸¸æœ‰ç”¨ã€‚</li>\n</ul><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¸‰ç§ kubernetes æ¢é’ˆï¼ˆReadinessã€Livenessã€StartupProbeï¼‰ï¼Œä»¥åŠæ€ä¹ˆé…ç½® HTTP çš„å¥åº·çŠ¶æ€æ£€æŸ¥ã€‚</p><h3>Readiness</h3><p>Readiness åˆç§°ä¸ºå°±ç»ªæ¢é’ˆï¼Œå®ƒç”¨æ¥ç¡®å®š Pod æ˜¯å¦ä¸ºå°±ç»ªï¼ˆReadyï¼‰çŠ¶æ€ï¼Œä»¥åŠæ˜¯å¦èƒ½å¤Ÿæ¥æ”¶å¤–éƒ¨æµé‡ã€‚ä¾‹å¦‚ï¼Œå½“æŸä¸€äº› Pod å‡ºç°çŸ­æš‚çš„å»¶è¿Ÿæˆ–ä¸å¯ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒä¸æ¥æ”¶å¤–éƒ¨æµé‡ï¼Œè¿™æ—¶å€™ Readiness å°±éå¸¸æœ‰ç”¨ã€‚</p><p>Readiness æ¢é’ˆèƒ½å¤Ÿè¯†åˆ«ä¸šåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¹¶é€šè¿‡å¥åº·çŠ¶æ€æ¥æ§åˆ¶ Pod æ˜¯å¦æ¥å—å¤–éƒ¨è¯·æ±‚æµé‡ã€‚</p><p>æˆ‘ä»¬ä»¥ç¤ºä¾‹åº”ç”¨ Backend Deployment æœåŠ¡ä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹æ€ä¹ˆä¸ºå·¥ä½œè´Ÿè½½é…ç½® Readiness æ¢é’ˆã€‚ä¸‹é¢æ˜¯ Backend Deployment Manifest çš„éƒ¨åˆ†å†…å®¹ã€‚</p><pre><code class=\"language-powershell\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: backend\n  ......\nspec:\n  ......\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999/backend:latest\n        ......\n        readinessProbe: \n          httpGet:\n            path: /healthy\n            port: 5000\n            scheme: HTTP\n          initialDelaySeconds: 10\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n</code></pre><p>è¿™é‡Œè¦é‡ç‚¹å…³æ³¨ readinessProbe å­—æ®µï¼Œå®ƒä¸º kubernetes Readiness æ¢é’ˆæä¾›äº†å¿…è¦çš„ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ 14 è¡Œçš„ httpGet ä¸‹çš„å‡ ä¸ªå­—æ®µï¼Œpath å­—æ®µçš„å«ä¹‰æ˜¯â€œé€šè¿‡è¯·æ±‚ healthy æ¥å£æ¥åˆ¤æ–­â€ï¼ŒPort å­—æ®µæŒ‡å®šäº† Python åç«¯æœåŠ¡çš„ç›‘å¬ç«¯å£ 5000ï¼Œscheme å­—æ®µä»£è¡¨åè®®ã€‚æ¢é’ˆè¯·æ±‚çš„å®Œæ•´è·¯å¾„ä¸ºï¼š<a href=\"http://PodIP:5000/healthy\">http://PodIP:5000/healthy</a>ï¼Œç›¸å½“äºä»¥ Get çš„æ–¹å¼ä¸»åŠ¨è®¿é—®ä¸šåŠ¡æ¥å£ï¼Œå½“æ¥å£è¿”å› 200-399 çŠ¶æ€ç æ—¶ï¼Œåˆ™è§†ä¸ºæœ¬æ¬¡æ¢é’ˆè¯·æ±‚æˆåŠŸã€‚</p><p>initialDelaySeconds çš„å«ä¹‰æ˜¯åœ¨å®¹å™¨å¯åŠ¨ä¹‹åï¼Œå»¶è¿Ÿ 10 ç§’é’Ÿå†è¿›è¡Œç¬¬ä¸€æ¬¡æ¢é’ˆæ£€æŸ¥ã€‚</p><p>failureThreshold çš„å«ä¹‰æ˜¯ï¼Œå¦‚æœè¿ç»­ 5 æ¬¡æ¢é’ˆå¤±è´¥åˆ™ä»£è¡¨ Readiness æ¢é’ˆå¤±è´¥ï¼ŒPod çŠ¶æ€ä¸º NotReadyï¼Œæ­¤æ—¶ Pod ä¸ä¼šæ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚</p><p>periodSeconds çš„å«ä¹‰æ˜¯æ¢é’ˆæ¯ 10 ç§’é’Ÿè½®è¯¢æ£€æµ‹ 1 æ¬¡ã€‚</p><p>successThreshold çš„å«ä¹‰æ˜¯åªè¦æ¢é’ˆæˆåŠŸ 1 æ¬¡å°±ä»£è¡¨æ¢é’ˆæˆåŠŸäº†ï¼ŒPod çŠ¶æ€ä¸º Ready è¡¨ç¤ºå¯ä»¥æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚</p><p>timeoutSeconds ä»£è¡¨æ¢é’ˆçš„è¶…æ—¶æ—¶é—´ä¸º 1 ç§’ã€‚</p><p>ç»¼åˆè¿™äº›é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå‡ ä¸ªé‡è¦çš„æ•°å­—ã€‚åœ¨ Pod å¯åŠ¨ä¹‹åï¼Œå¦‚æœåœ¨ 60ç§’å†…ï¼ˆinitialDelaySeconds + failureThreshold * periodSecondsï¼‰ ä¸èƒ½é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œ Pod å°†å¤„äºéå°±ç»ªçŠ¶æ€ã€‚</p><p>å½“ Pod å¤„äºæ­£å¸¸çš„è¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¦‚æœä¸šåŠ¡çªç„¶äº§ç”Ÿæ•…éšœï¼Œå¥åº·æ£€æŸ¥ä¼šåœ¨50ç§’å†…ï¼ˆfailureThreshold * periodSecondsï¼‰ è¯†åˆ«å‡ºä¸šåŠ¡çš„ä¸å¥åº·çŠ¶æ€ï¼›å½“ Pod ä¸šåŠ¡æ¢å¤å¥åº·æ—¶ï¼Œå¥åº·æ£€æŸ¥ä¼šåœ¨ 10ç§’å†…ï¼ˆsuccessThreshold * periodSecondsï¼‰ è¯†åˆ«å‡ºä¸šåŠ¡å·²æ¢å¤ã€‚</p><p>Readiness æ¢é’ˆçš„ä¸€ä¸ªéå¸¸é‡è¦çš„ä½œç”¨æ˜¯ï¼Œå®ƒè´Ÿè´£æ‰¾å‡ºä¸šåŠ¡çŠ¶æ€ä¸å¥åº·çš„ Podï¼Œå¹¶ä¸”å°†å®ƒä» Service EndPoints åˆ—è¡¨ç§»é™¤ï¼Œä½¿å®ƒæ— æ³•æ¥æ”¶åˆ°å¤–éƒ¨è¯·æ±‚ã€‚å¦‚æœ Pod çš„ Readiness æ¢é’ˆä¸€ç›´æ— æ³•é€šè¿‡ï¼Œé‚£ä¹ˆ Pod å°†ä¸€ç›´æ— æ³•æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/22/9a449ee9fae913877c19e98864bb6222.jpg?wh=1920x1290\" alt=\"\"></p><p>è¯·æ³¨æ„ï¼Œå½“ Readiness æ¢é’ˆå‘ä¸šåŠ¡åº”ç”¨å‘å‡ºè¯·æ±‚æ—¶ï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œæˆ–è€…æ”¶åˆ°çš„å›å¤çš„çŠ¶æ€ç å¤§äº 400ï¼Œé‚£ä¹ˆè®¤ä¸ºæœ¬æ¬¡æ¢æµ‹å¤±è´¥ã€‚</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™æ—¶å€™ä¸šåŠ¡å·²ç»æ— æ³•è‡ªè¡Œæ¢å¤äº†ï¼Œæ¯”å¦‚äº§ç”Ÿäº†æ­»é”ï¼Œæ­¤æ—¶ Readiness æ¢é’ˆä¹Ÿå·²ç»æ„ŸçŸ¥åˆ°ä¸šåŠ¡ä¸å¯ç”¨äº†ï¼Œé‚£æˆ‘ä»¬èƒ½å¦æ›´è¿›ä¸€æ­¥ï¼Œè®© kubernetes å¸®æˆ‘ä»¬è‡ªåŠ¨é‡å¯ Pod æ¥æ¢å¤ä¸šåŠ¡å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘æ¥ä¸‹æ¥è¦ä»‹ç»çš„ Liveness æ¢é’ˆã€‚</p><h3>Liveness</h3><p>Liveness åˆç§°ä¸ºå­˜æ´»æ¢é’ˆï¼Œç›¸æ¯” Readiness æ¢é’ˆï¼Œå®ƒè¿˜èƒ½å¤Ÿåœ¨æ£€æµ‹åˆ° Pod å¤„äºä¸å¥åº·çŠ¶æ€æ—¶è‡ªåŠ¨å°† Pod é‡å¯ã€‚</p><p>åœ¨ç¤ºä¾‹åº”ç”¨ Backend Deployment ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå®šä¹‰äº† Liveness æ¢é’ˆã€‚</p><pre><code class=\"language-powershell\">spec:\n  ......\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999/backend:latest\n        ......\n        livenessProbe: \n          httpGet:\n            path: /healthy\n            port: 5000\n            scheme: HTTP\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n</code></pre><p>Liveness æ¢é’ˆå’Œ Readiness æ¢é’ˆéå¸¸ç±»ä¼¼ï¼ŒLiveness æ¢é’ˆæ˜¯é€šè¿‡ livenessProbe å­—æ®µæ¥é…ç½®çš„ï¼ŒlivenessProbe å­—æ®µä¸‹é¢çš„æ¯ä¸ªå­—æ®µçš„ä½œç”¨å’Œ Readiness æ¢é’ˆéƒ½å‡ ä¹ä¸€è‡´ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>å½“ Liveness æ¢é’ˆå¤±è´¥æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨é‡å¯ä¸šåŠ¡ä¸å¥åº·çš„ Podï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/16/9f/16ef9ed84c1144a6f9e35edb9d80b59f.jpg?wh=1920x1113\" alt=\"\"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLiveness å’Œ Readiness æ¢é’ˆæ˜¯<strong>ç‹¬ç«‹å¹¶è¡Œ</strong>çš„ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰ç›¸äº’ç­‰å¾…å…³ç³»ã€‚</p><h3>StartupProbe</h3><p>ç›¸æ¯”è¾ƒ Liveness å’Œ Readiness æ¢é’ˆåœ¨è¿è¡Œé˜¶æ®µçš„æ¢æµ‹ç‰¹æ€§ï¼ŒStartupProbe æ˜¯ä¸€ç§ä¸“é—¨é’ˆå¯¹ä¸šåŠ¡åœ¨å¯åŠ¨é˜¶æ®µè®¾è®¡çš„æ¢é’ˆã€‚è¿˜è®°å¾—æˆ‘åœ¨ä¹‹å‰æåˆ°çš„ä¸€ä¸ªåœºæ™¯å—ï¼Ÿå¯¹äºä¸€äº›å¤§å‹çš„ Java åº”ç”¨æ¥è¯´ï¼Œå¾€å¾€éœ€è¦æ•°åˆ†é’Ÿæ—¶é—´æ‰èƒ½å¤Ÿå®Œæˆå¯åŠ¨ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå¯¹äºå¯åŠ¨éå¸¸æ…¢çš„å¤§å‹åº”ç”¨ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­æ¥é…ç½® Readiness å’Œ Liveness æ¢é’ˆï¼ŒPod å°†å› ä¸ºæ¢é’ˆå¤±è´¥è€Œæ°¸è¿œæ— æ³•å¯åŠ¨ã€‚</p><p>é‚£ä¹ˆï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½ å¯èƒ½é¦–å…ˆä¼šæƒ³åˆ°ï¼Œæ˜¯ä¸æ˜¯è°ƒæ•´æ¢é’ˆç¬¬ä¸€æ¬¡æ¢æµ‹çš„å»¶è¿Ÿæ—¶é—´å°±å¯ä»¥äº†ï¼Ÿæ¯”å¦‚å°† initialDelaySeconds å­—æ®µçš„å€¼ä» 10 ç§’é’Ÿä¿®æ”¹åˆ° 120 ç§’ã€‚è¿™å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†å¦‚æœå¯åŠ¨æ—¶é—´ä¸æ˜¯ 120 ç§’ï¼Œæˆ–è€…ä½ ä¸å¤ªç¡®å®šå‘¢ï¼Ÿé‚£ä¼¼ä¹å¯ä»¥åœ¨ä¿®æ”¹äº† initialDelaySeconds çš„åŸºç¡€ä¸Šå†å°†å¤±è´¥æ¬¡æ•° failureThreshold æˆ–è€…æ¢æµ‹é—´éš” periodSeconds åŠ å¤§ã€‚</p><p>è¿™ç§åšæ³•è™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¯æ˜æ˜¾çš„ï¼Œä¸ºäº†å…¼å®¹åº”ç”¨å¯åŠ¨æ…¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸»åŠ¨é™ä½äº† kubernetes æ£€æµ‹ Pod å¥åº·çŠ¶æ€çš„é¢‘ç‡ï¼Œè¿™ä¼šå»¶è¿Ÿ kubernetes æ„ŸçŸ¥æ•…éšœçš„é€Ÿåº¦ã€‚</p><p>å…¶å®ï¼ŒReadiness å’Œ Liveness ä¸»è¦ç”¨æ¥æ£€æŸ¥çš„æ˜¯å¤„äºè¿è¡Œè¿‡ç¨‹ä¸­ä¸šåŠ¡ï¼Œå› ä¸ºå¯åŠ¨è¿‡æ…¢çš„é—®é¢˜è€Œå»è°ƒæ•´ Readiness å’Œ Liveness å‚æ•°å¹¶ä¸æ˜¯æœ€ä½³å®è·µã€‚è¿™ç±»é—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡ StartupProbe æ¥è§£å†³ã€‚</p><p>StartupProbe æ¢é’ˆç‰¹åˆ«é€‚ç”¨äºä¸šåŠ¡åº”ç”¨å¯åŠ¨æ…¢çš„åœºæ™¯ã€‚å½“ Pod å¯åŠ¨æ—¶ï¼Œå¦‚æœé…ç½®äº† StartupProbeï¼Œé‚£ä¹ˆ Readiness å’Œ Liveness æ¢é’ˆéƒ½å°†è¢«ä¸´æ—¶ç¦ç”¨ï¼Œç›´åˆ° StartupProbe æ¢é’ˆè¿”å›æˆåŠŸæ‰ä¼šå¯ç”¨ Readiness å’Œ Liveness æ¢é’ˆï¼Œè¿™ä¹Ÿå°±é¿å…äº† Readiness å’Œ Liveness åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µé€ æˆçš„å¹²æ‰°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦ä¸ºä¸šåŠ¡é…ç½®åˆç†çš„ StartupProbe æ¢é’ˆï¼Œå°±å¯ä»¥è§£å†³åº”ç”¨å¯åŠ¨æ…¢å¯¼è‡´å…¶ä»–æ¢é’ˆè®¤ä¸º Pod ä¸å¥åº·çš„é—®é¢˜ã€‚</p><p>StartupProbe æ¢é’ˆçš„é…ç½®æ–¹æ³•å’Œ Readinessã€Liveness æ¢é’ˆä¹Ÿéå¸¸ç±»ä¼¼ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹åº”ç”¨ Backend Deployment Manifest çš„éƒ¨åˆ†å†…å®¹ã€‚</p><pre><code class=\"language-powershell\">spec:\n  ......\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999/backend:latest\n        ......\n        startupProbe: \n          httpGet:\n            path: /healthy\n            port: 5000\n            scheme: HTTP\n          initialDelaySeconds: 10\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n</code></pre><p>StartupProbe æ˜¯é€šè¿‡ startupProbe å­—æ®µæ¥é…ç½®çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPod å¯åŠ¨ä¹‹å 10 ç§’ä¼šå¼€å§‹ç¬¬ä¸€æ¬¡æ¢æµ‹ï¼Œå¦‚æœè‡³å°‘æœ‰ 1 æ¬¡æ¢æµ‹æˆåŠŸï¼Œé‚£ä¹ˆ StartupProbe æ¢é’ˆå°±æˆåŠŸï¼Œæ¥ä¸‹æ¥æ‰ä¼šç»§ç»­å¯åŠ¨ Readiness å’Œ Liveness æ¢é’ˆã€‚</p><p>åœ¨æˆ‘ä»¬åˆšæ‰æåˆ°çš„ Java åº”ç”¨çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º StartupProbe é…ç½®è¶³å¤Ÿå¤§çš„ initialDelaySeconds æ¥è®©ä¸šåŠ¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å®Œæˆå¯åŠ¨è¿‡ç¨‹ã€‚</p><p>å¦‚æœä¸€ä¸ªå·¥ä½œè´Ÿè½½å†…åŒæ—¶å®šä¹‰äº†è¿™ä¸‰ç§æ¢é’ˆï¼Œæƒ…å†µä¼šå˜å¾—æœ‰äº›å¤æ‚ï¼Œä½ å¯ä»¥ç»“åˆä¸‹é¢è¿™å¼ å›¾æ¥ç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/48/bf/4888e047ff9b3e35d50c8902aa78fabf.jpg?wh=1920x1167\" alt=\"\"></p><p>Pod å¯åŠ¨æ—¶ï¼Œä¸‰ç§æ¢é’ˆçš„æ‰§è¡Œé¡ºåºä¸»è¦å¯ä»¥åˆ†æˆä¸‰ä¸ªé˜¶æ®µã€‚</p><ul>\n<li>ç¬¬ä¸€é˜¶æ®µï¼šPod å·²å¯åŠ¨ï¼Œå®¹å™¨å·²å¯åŠ¨ï¼Œä¸šåŠ¡è¿›ç¨‹æ­£åœ¨å¯åŠ¨ä¸­ï¼Œæ­¤æ—¶ StartupProbe å¼€å§‹å·¥ä½œï¼Œç”±äº StartupProbe è¿˜æœªæˆåŠŸï¼Œå½“å‰ Pod çš„å®¹å™¨å¤„äº Not Ready(0/1) çš„çŠ¶æ€ã€‚</li>\n<li>ç¬¬äºŒé˜¶æ®µï¼šéšç€æ—¶é—´æ¨ç§»ï¼ŒStartupProbe æ¢é’ˆæˆåŠŸï¼ŒReadine å’Œ Liveness æ¢é’ˆå¼€å§‹å¹¶è¡Œå·¥ä½œï¼Œæ­¤æ—¶ç”±äº Readine æ¢é’ˆè¿˜æœªæˆåŠŸï¼Œå½“å‰ Pod çš„å®¹å™¨ä»ç„¶å¤„äº Not Ready(0/1) çš„çŠ¶æ€ã€‚</li>\n<li>ç¬¬ä¸‰é˜¶æ®µï¼šéšç€ Readine å’Œ Liveness çš„æ¢æµ‹æˆåŠŸï¼Œå½“å‰ Pod çš„å®¹å™¨è½¬ä¸º Ready(1/1) çš„çŠ¶æ€ï¼ŒService EndPoints å°† Pod åŠ å…¥åˆ°åˆ—è¡¨å½“ä¸­ï¼ŒPod å¼€å§‹æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚</li>\n</ul><p>åœ¨ä¸ºä¸šåŠ¡åº”ç”¨é…ç½®äº†æ¢é’ˆä¹‹åï¼Œå†ç»“åˆæˆ‘ä»¬ä¸ŠèŠ‚è¯¾ä»‹ç»çš„èµ„æºé…é¢å’Œæ°´å¹³æ‰©å®¹ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥ä¿è¯ä¸šåŠ¡åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§äº†ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº† kubernetes çš„ä¸‰ç§å¥åº·æ£€æŸ¥æ¢é’ˆã€‚å…¶ä¸­ï¼ŒReadiness å°±ç»ªæ¢é’ˆå¯ä»¥è®© kubernetes æ„ŸçŸ¥åˆ°ä¸šåŠ¡çš„çœŸå®å¯ç”¨çŠ¶æ€ï¼Œkubernetes å°†æ ¹æ®ä¸šåŠ¡çš„çŠ¶æ€åˆ¤æ–­ Pod æ˜¯å¦å¤„äº Ready å°±ç»ªçŠ¶æ€ï¼Œä»¥æ­¤æ¥æ§åˆ¶ä»€ä¹ˆæ—¶å€™å°† Pod åŠ å…¥åˆ° EndPoints åˆ—è¡¨ä¸­æ¥æ”¶å¤–éƒ¨æµé‡ã€‚</p><p>Liveness å­˜æ´»æ¢é’ˆåˆ™æ›´åŠ å½»åº•ï¼Œå½“å®ƒæ„ŸçŸ¥åˆ° Pod ä¸å¥åº·æ—¶ï¼Œä¼šé‡å¯ Podã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒLiveness å¯ä»¥å®ç°å¯¹ä¸šåŠ¡æ— æ„Ÿçš„æœåŠ¡é‡å¯ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´å‘ç°æ•…éšœçš„åŒæ—¶è‡ªåŠ¨æ¢å¤ä¸šåŠ¡ï¼Œæå¤§æå‡äº†ä¸šåŠ¡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>æœ€åï¼ŒStartupProbe æ¢é’ˆä¸»è¦ç”¨æ¥è§£å†³æœåŠ¡å¯åŠ¨æ…¢çš„é—®é¢˜ï¼Œå¯¹äºä¸€äº›å¤§å‹çš„åº”ç”¨ä¾‹å¦‚ Java æœåŠ¡ï¼Œæˆ‘å»ºè®®ä½ ä¸ºå®ƒä»¬é…ç½® StartupProbeï¼Œä»¥ç¡®ä¿åœ¨æœåŠ¡å¯åŠ¨å®Œæˆåå†å¯¹å®ƒè¿›è¡Œå¸¸è§„çš„å°±ç»ªå’Œå­˜æ´»å¥åº·æ£€æŸ¥ã€‚</p><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ ä¸ºä¸šåŠ¡å·¥ä½œè´Ÿè½½é…ç½®è¿™ä¸‰ç§æ¢é’ˆï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°ä¿éšœä¸šåŠ¡çš„é«˜å¯ç”¨å’Œç¨³å®šæ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜å§ã€‚</p><ol>\n<li>åœ¨é kubernetes æ¶æ„ä½“ç³»ä¸‹ï¼Œé€šå¸¸æˆ‘ä»¬æœ‰å“ªäº›æ–¹æ¡ˆæ£€æŸ¥åº”ç”¨çš„å¥åº·çŠ¶æ€å‘¢ï¼Ÿè¯·ä½ åˆ†äº«ä½ äº†è§£çš„æŠ€æœ¯æ–¹æ¡ˆã€‚</li>\n<li>è¯·ä½ å°è¯•å°†åç«¯ Deployment çš„ Readiness å°±ç»ªæ¢é’ˆç”± HTTP çš„æ–¹å¼ä¿®æ”¹ä¸º TCP çš„æ£€æŸ¥æ–¹å¼ã€‚</li>\n</ol><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":368154,"user_name":"Geek_9190ca","can_delete":false,"product_type":"c1","uid":3075823,"ip_address":"ç¦å»º","ucode":"44D9ED046928EE","user_header":"https://static001.geekbang.org/account/avatar/00/2e/ee/ef/2b8d8049.jpg","comment_is_top":false,"comment_ctime":1675938175,"is_pvip":false,"replies":[{"id":134040,"content":"å¾ˆå¥½çš„å»ºè®®ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1675944543,"ip_address":"å¹¿ä¸œ","comment_id":368154,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"k8sæç®€å®è·µå¸Œæœ›åŠ ä¸Šå­˜å‚¨ç« èŠ‚","like_count":3,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603105,"discussion_content":"å¾ˆå¥½çš„å»ºè®®ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675944543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366620,"user_name":"éƒ‘æµ·æˆ","can_delete":false,"product_type":"c1","uid":1192616,"ip_address":"åŒ—äº¬","ucode":"B0363EA4B2C646","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg","comment_is_top":false,"comment_ctime":1674002501,"is_pvip":true,"replies":[{"id":133580,"content":"éå¸¸æ­£ç¡®ï¼Œä¼ ç»Ÿæ¶æ„ä¸‹è¦æŠŠè¿™äº›èƒ½åŠ›ä¸²èµ·æ¥ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚K8s å®é™…ä¸ŠæŠŠè¿™äº›é—®é¢˜éƒ½æŠ½è±¡æˆèƒ½åŠ›äº†ï¼Œè¿™äº›å¼€ç®±å³ç”¨çš„èƒ½åŠ›å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå¼¹æ€§ï¼Œé«˜å¯ç”¨çš„ä¸šåŠ¡ç³»ç»Ÿã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1674007299,"ip_address":"å¹¿ä¸œ","comment_id":366620,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"1. ék8sæ¶æ„ä¸‹å…¶å®ä¹Ÿæ˜¯é€šè¿‡æ¢æµ‹æ¥å®ç°çš„åªä¸è¿‡æ¢æµ‹å·¥å…·æ˜¯è‡ªå·±çš„è„šæœ¬å’Œå·¥å…·ä¸ä¸€æ ·ã€‚æ¯”å¦‚startupProbeå¯ä»¥é€šè¿‡æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨ã€ç«¯å£åˆ¤æ–­å¦å¯åŠ¨ï¼›readinessProbeå¯ä»¥é€šè¿‡ä¸šåŠ¡æš´éœ²çš„æ¢æ´»æ¥å£ã€çœŸå®ä¸šåŠ¡æ¥å£æ¥åˆ¤æ–­ï¼Œä½†æ˜¯æ‘˜é™¤æµé‡éœ€è¦ä¾èµ–è´Ÿè½½å‡è¡¡å™¨çš„èƒ½åŠ›ï¼›livenessProbeä¹Ÿå¯ä»¥é€šè¿‡æ¥å£æ¥åˆ¤æ–­ä½†æ˜¯é‡å¯å°±éœ€è¦è‡ªå·±é€šè¿‡è„šæœ¬æ¥å®ç°ã€‚åœ¨k8sæ¶æ„ä¸‹kubeletå°±åƒä¸€ä½ä½ çš„è¿ç»´åŒäº‹å¸®ä½ æŠŠè¿™äº›æ´»å„¿ç»™åšäº†","like_count":3,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600080,"discussion_content":"éå¸¸æ­£ç¡®ï¼Œä¼ ç»Ÿæ¶æ„ä¸‹è¦æŠŠè¿™äº›èƒ½åŠ›ä¸²èµ·æ¥ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚K8s å®é™…ä¸ŠæŠŠè¿™äº›é—®é¢˜éƒ½æŠ½è±¡æˆèƒ½åŠ›äº†ï¼Œè¿™äº›å¼€ç®±å³ç”¨çš„èƒ½åŠ›å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºå¼¹æ€§ï¼Œé«˜å¯ç”¨çš„ä¸šåŠ¡ç³»ç»Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674007299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377583,"user_name":"xmr","can_delete":false,"product_type":"c1","uid":1009622,"ip_address":"å¹¿ä¸œ","ucode":"1BBF165F91F10B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg","comment_is_top":false,"comment_ctime":1688785750,"is_pvip":false,"replies":[{"id":137617,"content":"æ˜¯çš„ï¼Œè¿˜å¯ä»¥ç»“åˆ crontabã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1688898221,"ip_address":"å¹¿ä¸œ","comment_id":377583,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"1.é€šè¿‡è„šæœ¬å®šæ—¶æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œè¿›ç¨‹ä¸å­˜åœ¨åˆ™æ‹‰å»","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622983,"discussion_content":"æ˜¯çš„ï¼Œè¿˜å¯ä»¥ç»“åˆ crontabã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688898221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368935,"user_name":"Geek_28f561","can_delete":false,"product_type":"c1","uid":3541684,"ip_address":"åŒ—äº¬","ucode":"E0DEF66AC6D77F","user_header":"","comment_is_top":false,"comment_ctime":1676917055,"is_pvip":false,"replies":[{"id":134361,"content":"Node èŠ‚ç‚¹åŠ¨æ€æ‰©å®¹ï¼ˆcluster-autoscaleï¼‰ä¸€èˆ¬ç”±äº‘å‚å•†ç›´æ¥å®ç°ï¼Œå…·ä½“ç”¨æ³•ä½ å¯ä»¥çœ‹è¿™ä¸ªæ–‡æ¡£ï¼šhttps:&#47;&#47;github.com&#47;kubernetes&#47;autoscaler&#47;tree&#47;master&#47;cluster-autoscaler","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676939760,"ip_address":"å¹¿ä¸œ","comment_id":368935,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è€å¸ˆä¸Šç« èŠ‚æ‚¨è®²HPAæ ¹æ®cpuæˆ–å†…å­˜ä½¿ç”¨ç‡æ‰©å®¹podã€‚è¯·æ•™ä¸€ä¸‹ï¼Œå¦‚ä½•é€šè¿‡è‡ªå®šä¹‰æŒ‡æ ‡æ‰©å®¹nodeä¸»æœºèŠ‚ç‚¹å‘¢ã€‚","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606091,"discussion_content":"Node èŠ‚ç‚¹åŠ¨æ€æ‰©å®¹ï¼ˆcluster-autoscaleï¼‰ä¸€èˆ¬ç”±äº‘å‚å•†ç›´æ¥å®ç°ï¼Œå…·ä½“ç”¨æ³•ä½ å¯ä»¥çœ‹è¿™ä¸ªæ–‡æ¡£ï¼šhttps://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676939760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365602,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"å¹¿ä¸œ","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/547439f1.jpg","comment_is_top":false,"comment_ctime":1672820275,"is_pvip":false,"replies":[{"id":133177,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672881254,"ip_address":"å¹¿ä¸œ","comment_id":365602,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100312001,"comment_content":"1. Pod çš„ç”Ÿå‘½å‘¨æœŸä¸€å…±æœ‰ä¸‹é¢è¿™ 5 ä¸ªçŠ¶æ€ï¼š\n - Pendingï¼šæ­£åœ¨åˆ›å»º Podï¼Œä¾‹å¦‚è°ƒåº¦ Pod å’Œæ‹‰å–é•œåƒçš„é˜¶æ®µã€‚\n - Runningï¼šè¿è¡Œé˜¶æ®µï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨å¯åŠ¨æˆ–è¿è¡Œã€‚\n - Succeededï¼šè¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸”ä¸ä¼šé‡æ–°å¯åŠ¨ï¼Œä¾‹å¦‚ Job åˆ›å»ºçš„ Podã€‚\n - Failedï¼šPod çš„æ‰€æœ‰å®¹å™¨éƒ½åœæ­¢äº†ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºçŠ¶æ€ç é 0ã€‚Unknownï¼šæ— æ³•è·å– Pod çš„çŠ¶æ€ã€‚\n\n 2. Pod ä¸­çš„å®¹å™¨ï¼Œä¹Ÿæœ‰ä¸‹é¢ 3 ç§çŠ¶æ€ï¼š\n - `Waiting`ï¼šå®¹å™¨ç­‰å¾…ä¸­ï¼Œä¾‹å¦‚æ­£åœ¨æ‹‰å–é•œåƒã€‚\n - `Running`ï¼šå®¹å™¨è¿è¡Œä¸­ï¼ŒPID=1 çš„ä¸šåŠ¡è¿›ç¨‹æ­£åœ¨å¯åŠ¨æˆ–è¿è¡Œã€‚\n - `Terminated`ï¼šå®¹å™¨ç»ˆæ­¢ä¸­ï¼Œä¾‹å¦‚æ­£åœ¨åˆ é™¤ Podã€‚\n\n\n3. Podå…·æœ‰PodStatusï¼Œè¯¥çŠ¶æ€å…·æœ‰`PodConditions`æ•°ç»„ ï¼Œè¯¥Podå·²é€šè¿‡æˆ–æœªé€šè¿‡ã€‚PodConditionæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…­ä¸ªå¯èƒ½çš„å­—æ®µï¼š\n - è¯¥`lastProbeTime`å­—æ®µæä¾›ä¸Šæ¬¡æ¢æµ‹Podæ¡ä»¶çš„æ—¶é—´æˆ³ã€‚\n - è¯¥`lastTransitionTime`å­—æ®µæä¾›Podä¸Šä¸€æ¬¡ä»ä¸€ç§çŠ¶æ€è½¬æ¢ä¸ºå¦ä¸€ç§çŠ¶æ€çš„æ—¶é—´æˆ³ã€‚\n - è¯¥`message`å­—æ®µæ˜¯äººç±»å¯è¯»çš„æ¶ˆæ¯ï¼ŒæŒ‡ç¤ºæœ‰å…³è¿‡æ¸¡çš„è¯¦ç»†ä¿¡æ¯ã€‚\n - è¯¥`reason`å­—æ®µæ˜¯æ¡ä»¶æœ€åä¸€æ¬¡è½¬æ¢çš„å”¯ä¸€å•è¯CamelCaseåŸå› ã€‚\n - è¯¥`status`å­—æ®µæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯èƒ½çš„å€¼ä¸ºâ€œ Trueâ€ï¼Œâ€œ Falseâ€å’Œâ€œ Unknownâ€ã€‚\n - è¯¥`type`å­—æ®µæ˜¯å…·æœ‰ä»¥ä¸‹å¯èƒ½å€¼çš„å­—ç¬¦ä¸²ï¼š\n    - PodScheduledï¼šPodå·²è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼›\n    - Readyï¼šPodèƒ½å¤Ÿå¤„ç†è¯·æ±‚ï¼Œåº”å°†å…¶æ·»åŠ åˆ°æ‰€æœ‰åŒ¹é…æœåŠ¡çš„è´Ÿè½½å¹³è¡¡æ± ä¸­ï¼›\n    - Initializedï¼šæ‰€æœ‰åˆå§‹åŒ–å®¹å™¨ å·²æˆåŠŸå¯åŠ¨ï¼›\n    - Unschedulableï¼šä¾‹å¦‚ï¼Œç”±äºç¼ºä¹èµ„æºæˆ–å…¶ä»–é™åˆ¶ï¼Œè°ƒåº¦ç¨‹åºæ— æ³•ç«‹å³è°ƒåº¦Podï¼›\n    - ContainersReadyï¼šPodä¸­çš„æ‰€æœ‰å®¹å™¨å·²å‡†å¤‡å°±ç»ªã€‚\n\n\n","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598496,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672881254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365561,"user_name":"Ãªï½—Ä›ï½","can_delete":false,"product_type":"c1","uid":1066707,"ip_address":"å¹¿ä¸œ","ucode":"5000233111BEFA","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d3/e25d104a.jpg","comment_is_top":false,"comment_ctime":1672765270,"is_pvip":false,"replies":[{"id":133157,"content":"å¯ä»¥ç”¨ Liveness æ¢é’ˆæ¥æ£€æŸ¥å­˜æ´»çŠ¶æ€ï¼Œå¦‚æœä¸šåŠ¡æ— æ³•è¿”å› 200 é‚£ä¹ˆ K8s ä¼šè‡ªåŠ¨é‡å¯å®ƒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672801092,"ip_address":"å¹¿ä¸œ","comment_id":365561,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å¦‚æœæœåŠ¡æ¥å—æµé‡åè§¦å‘äº†bugï¼Œå¯¼è‡´å‡æ­»ï¼Œè¿™ç§å¦‚ä½•å¿«é€Ÿå‘ç°å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598380,"discussion_content":"å¯ä»¥ç”¨ Liveness æ¢é’ˆæ¥æ£€æŸ¥å­˜æ´»çŠ¶æ€ï¼Œå¦‚æœä¸šåŠ¡æ— æ³•è¿”å› 200 é‚£ä¹ˆ K8s ä¼šè‡ªåŠ¨é‡å¯å®ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672801092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366070,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"å¹¿ä¸œ","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1673357709,"is_pvip":false,"replies":[{"id":133381,"content":"è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„çœŸå®åœºæ™¯ï¼Œä½ æåˆ°çš„åšæ³•å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæ›´å¥½çš„åšæ³•å¯èƒ½æ˜¯ç»“åˆ istio é…ç½®ç†”æ–­æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸šåŠ¡é«˜å³°çš„æ—¶å€™ä¿æŠ¤åç«¯æœåŠ¡ï¼Œé¿å…é›ªå´©ã€‚æ¯”å¦‚ä¸€äº›ç½‘ç«™åœ¨åŒ11æµé‡é«˜å³°çš„æ—¶å€™å¯¹äºæ–°çš„æµé‡ä¼šç›´æ¥æç¤ºäººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•ã€‚\n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥ç»“åˆ HPAï¼Œé…ç½®ä½ä¸€ç‚¹çš„é˜ˆå€¼ï¼Œåœ¨ä¸šåŠ¡é«˜å³°æ¥ä¹‹å‰å¿«é€ŸæŠŠå‰¯æœ¬æ•°é‡æ‹‰é«˜ï¼Œå¦‚æœæ˜¯ä¸šåŠ¡é«˜ä½å³°éå¸¸æ˜æ˜¾çš„ä¸šåŠ¡ï¼Œå¯ä»¥å®šæ—¶è¿›è¡Œæ‰©ç¼©å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673403509,"ip_address":"å¹¿ä¸œ","comment_id":366070,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å¦‚æœå­˜æ´»å’Œå°±ç»ªé…ç½®ä¸€æ ·ï¼Œå°±ä¼šå¯¼è‡´ä¸šåŠ¡å‹åŠ›ä¸Šæ¥åæœ¬æ¥åº”è¯¥æ‘˜é™¤æµé‡ï¼Œç»“æœä¸šåŠ¡é‡å¯äº†ï¼Œè¿™æ ·åœºæ™¯æœ‰ä»€ä¹ˆæœ€ä½³å®è·µå—ï¼Ÿæ˜¯é»˜è®¤å­˜æ´»æ¯”å°±ç»ªé…ç½®çš„ä¹…æ£€æŸ¥ä¸€äº›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599207,"discussion_content":"è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„çœŸå®åœºæ™¯ï¼Œä½ æåˆ°çš„åšæ³•å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæ›´å¥½çš„åšæ³•å¯èƒ½æ˜¯ç»“åˆ istio é…ç½®ç†”æ–­æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸šåŠ¡é«˜å³°çš„æ—¶å€™ä¿æŠ¤åç«¯æœåŠ¡ï¼Œé¿å…é›ªå´©ã€‚æ¯”å¦‚ä¸€äº›ç½‘ç«™åœ¨åŒ11æµé‡é«˜å³°çš„æ—¶å€™å¯¹äºæ–°çš„æµé‡ä¼šç›´æ¥æç¤ºäººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•ã€‚\n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥ç»“åˆ HPAï¼Œé…ç½®ä½ä¸€ç‚¹çš„é˜ˆå€¼ï¼Œåœ¨ä¸šåŠ¡é«˜å³°æ¥ä¹‹å‰å¿«é€ŸæŠŠå‰¯æœ¬æ•°é‡æ‹‰é«˜ï¼Œå¦‚æœæ˜¯ä¸šåŠ¡é«˜ä½å³°éå¸¸æ˜æ˜¾çš„ä¸šåŠ¡ï¼Œå¯ä»¥å®šæ—¶è¿›è¡Œæ‰©ç¼©å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673403509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365603,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"å¹¿ä¸œ","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/547439f1.jpg","comment_is_top":false,"comment_ctime":1672820302,"is_pvip":false,"replies":[{"id":133178,"content":"æ­£ç¡®","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672881271,"ip_address":"å¹¿ä¸œ","comment_id":365603,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100312001,"comment_content":"4. æ¢é’ˆï¼š\n - Readinessï¼šåˆç§°ä¸ºå°±ç»ªæ¢é’ˆï¼Œå®ƒç”¨æ¥ç¡®å®š Pod æ˜¯å¦ä¸ºå°±ç»ªï¼ˆReadyï¼‰çŠ¶æ€ï¼Œä»¥åŠæ˜¯å¦èƒ½å¤Ÿæ¥æ”¶å¤–éƒ¨æµé‡ã€‚\n - Livenessï¼š åˆç§°ä¸ºå­˜æ´»æ¢é’ˆï¼Œç›¸æ¯” Readiness æ¢é’ˆï¼Œå®ƒè¿˜èƒ½å¤Ÿåœ¨æ£€æµ‹åˆ° Pod å¤„äºä¸å¥åº·çŠ¶æ€æ—¶è‡ªåŠ¨å°† Pod é‡å¯ï¼Œï¼ˆé‡å¯æ¡ä»¶éœ€è¦restartPolicyæ˜¯ Alwaysæˆ–OnFailureï¼Œé»˜è®¤æ˜¯ Alwaysï¼‰\n - StartupProbeï¼šé€‚ç”¨äºä¸šåŠ¡åº”ç”¨å¯åŠ¨æ…¢çš„åœºæ™¯ã€‚å½“ Pod å¯åŠ¨æ—¶ï¼Œå¦‚æœé…ç½®äº† StartupProbeï¼Œé‚£ä¹ˆ Readiness å’Œ Liveness æ¢é’ˆéƒ½å°†è¢«ä¸´æ—¶ç¦ç”¨ï¼Œç›´åˆ° StartupProbe æ¢é’ˆè¿”å›æˆåŠŸæ‰ä¼šå¯ç”¨ Readiness å’Œ Liveness æ¢é’ˆ\n\nå‚æ•°ï¼š\n - `initialDelaySeconds` çš„å«ä¹‰æ˜¯åœ¨å®¹å™¨å¯åŠ¨ä¹‹åï¼Œå»¶è¿Ÿ 10 ç§’é’Ÿå†è¿›è¡Œç¬¬ä¸€æ¬¡æ¢é’ˆæ£€æŸ¥ã€‚\n - `failureThreshold` çš„å«ä¹‰æ˜¯ï¼Œå¦‚æœè¿ç»­ 5 æ¬¡æ¢é’ˆå¤±è´¥åˆ™ä»£è¡¨ Readiness æ¢é’ˆå¤±è´¥ï¼ŒPod çŠ¶æ€ä¸º NotReadyï¼Œæ­¤æ—¶ Pod ä¸ä¼šæ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚\n - `periodSeconds` çš„å«ä¹‰æ˜¯æ¢é’ˆæ¯ 10 ç§’é’Ÿè½®è¯¢æ£€æµ‹ 1 æ¬¡ã€‚\n - `successThreshold` çš„å«ä¹‰æ˜¯åªè¦æ¢é’ˆæˆåŠŸ 1 æ¬¡å°±ä»£è¡¨æ¢é’ˆæˆåŠŸäº†ï¼ŒPod çŠ¶æ€ä¸º Ready è¡¨ç¤ºå¯ä»¥æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚\n - `timeoutSeconds` ä»£è¡¨æ¢é’ˆçš„è¶…æ—¶æ—¶é—´ä¸º 1 ç§’ã€‚\n\n\n5. TCP æ¢æµ‹:\nspec:\n  containers:\n  - name: flask-backend\n    image: lyzhang1999&#47;backend:latest\n    ports:\n    - containerPort: 5000\n    readinessProbe:\n      tcpSocket:\n        port: 5000\n      initialDelaySeconds: 10\n      failureThreshold: 5\n      periodSeconds: 10\n      successThreshold: 1\n      timeoutSeconds: 1\n    livenessProbe:\n      tcpSocket:\n        port: 5000\n      initialDelaySeconds: 10\n      failureThreshold: 5\n      periodSeconds: 10\n      successThreshold: 1\n      timeoutSeconds: 1","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598497,"discussion_content":"æ­£ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672881271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365589,"user_name":"æ©™æ±","can_delete":false,"product_type":"c1","uid":1332257,"ip_address":"å¹¿ä¸œ","ucode":"EC3FF10D708C9D","user_header":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","comment_is_top":false,"comment_ctime":1672804881,"is_pvip":false,"replies":[{"id":133162,"content":"æ„Ÿè°¢ä½ çš„è®¤å¯ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672807400,"ip_address":"å¹¿ä¸œ","comment_id":365589,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å‘ç°ä¸‰å¤„äº®ç‚¹\n1.podå’Œå®¹å™¨çš„çŠ¶æ€åˆ†åˆ«è¿›è¡Œä»‹ç»ï¼Œè¿™å·®è· ä»¥å‰çš„æ–‡ç« éƒ½æ˜¯podçŠ¶æ€å¤šå°‘å¤šå°‘ç§ï¼ŒåŸºæœ¬æ²¡æœ‰æå®¹å™¨çŠ¶æ€ï¼Œè¿™ä¹ˆä¸€çœ‹ç†è§£æ›´æ¸…æ™°\n2.ä»¥å‰ç¢°åˆ°è¿‡deploymentè¿›è¡Œæ›´æ–°æ—¶ï¼Œä¼šå‡ºç°podå¹¶æœªå°±ç»ªå°±åŠ å…¥åˆ°endpointé‡Œé¢ï¼Œçœ‹å®Œæ–‡ç« åŸæ¥è¿˜æ˜¯å¥åº·æ£€æŸ¥æœªç†è§£\n3.åŸæ¥å¥åº·æ£€æŸ¥ä»£è¡¨ä½ çš„å¯ç”¨æ€§ï¼Œæ˜¯æœ‰æ•°æ®æ”¯æŒçš„ æ¯”å¦‚æ£€æµ‹æ¬¡æ•° é—´éš”å¤šä¹…ï¼Œè¿™æ ·è¯´å•¥éƒ½æœ‰æ•°æ®æ¥æ”¯æ’‘\nçœŸtmåŠ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598395,"discussion_content":"æ„Ÿè°¢ä½ çš„è®¤å¯ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672807400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365577,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"å¹¿ä¸œ","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1672794741,"is_pvip":true,"replies":[{"id":133158,"content":"æ˜¯çš„ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç±»ä¼¼äºäº‘ç›‘æ§çš„äº§å“ä¹Ÿèƒ½åšå¥åº·æ£€æŸ¥ï¼Œä¸è¿‡è¿™ä¸¤ç§å¥åº·æ£€æŸ¥éƒ½ä¸èƒ½å’Œé‡å¯ç­–ç•¥ç›´æ¥å…³é”®èµ·æ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672801564,"ip_address":"å¹¿ä¸œ","comment_id":365577,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"1. åœ¨æˆ‘å°è±¡é‡Œæˆ‘æœ€åˆæ¥è§¦åˆ°çš„å¥åº·æ£€æŸ¥æ–¹å¼æ˜¯Nginx upstream_check_module å¼€æºæ¨¡å—å®ç°çš„ï¼Œä¸€èˆ¬æ˜¯åœ¨ Nginx ä½œä¸ºåä»£çš„æ—¶å€™ä¼šç”¨åˆ°\n\n2.    readinessProbe: \n          tcpSocket:\n            port: 5000","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598386,"discussion_content":"æ˜¯çš„ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç±»ä¼¼äºäº‘ç›‘æ§çš„äº§å“ä¹Ÿèƒ½åšå¥åº·æ£€æŸ¥ï¼Œä¸è¿‡è¿™ä¸¤ç§å¥åº·æ£€æŸ¥éƒ½ä¸èƒ½å’Œé‡å¯ç­–ç•¥ç›´æ¥å…³é”®èµ·æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672801564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365857,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"é™•è¥¿","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1673152066,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"å»ºè®®é…ç½®ä¸‰ç§å¥åº·æ£€æŸ¥. æ£€æŸ¥é¡ºåºStartupProbe æ¢é’ˆå°±æˆåŠŸï¼Œæ‰ä¼šç»§ç»­å¯åŠ¨ Readiness å’Œ Liveness æ¢é’ˆï¼\n\nStartupProbe æ¢é’ˆç‰¹åˆ«é€‚ç”¨äºä¸šåŠ¡åº”ç”¨å¯åŠ¨æ…¢çš„åœºæ™¯ã€‚å½“ Pod å¯åŠ¨æ—¶ï¼Œå¦‚æœé…ç½®äº† StartupProbeï¼Œé‚£ä¹ˆ Readiness å’Œ Liveness æ¢é’ˆéƒ½å°†è¢«ä¸´æ—¶ç¦ç”¨ï¼Œç›´åˆ° StartupProbe æ¢é’ˆè¿”å›æˆåŠŸæ‰ä¼šå¯ç”¨ Readiness å’Œ Liveness æ¢é’ˆï¼Œè¿™ä¹Ÿå°±é¿å…äº† Readiness å’Œ Liveness åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µé€ æˆçš„å¹²æ‰°.","like_count":1},{"had_liked":false,"id":393965,"user_name":"æ–¯è’‚èŠ¬.èµµ","can_delete":false,"product_type":"c1","uid":1200179,"ip_address":"å±±ä¸œ","ucode":"AA0FF2DA654418","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/33/9dcd30c4.jpg","comment_is_top":false,"comment_ctime":1725448720,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"æœ‰ç‚¹ç–‘é—®ï¼Œé’ˆå¯¹é‚£äº›å¯åŠ¨æ¯”è¾ƒæ…¢çš„åº”ç”¨ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­æ¥é…ç½® Readiness å’Œ Liveness æ¢é’ˆï¼ŒPod å°†å› ä¸ºæ¢é’ˆå¤±è´¥è€Œæ°¸è¿œæ— æ³•å¯åŠ¨ï¼Œæ–‡ç« è¯´ç”¨StartupProbeæ¢é’ˆæ¥è§£å†³ï¼Œæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œé…ç½®äº†StartupProbeæ¢é’ˆï¼Œä½†æ˜¯å¯åŠ¨æ¢é’ˆä¹Ÿæ¢æµ‹å¤±è´¥äº†ï¼Œæ¯”å¦‚æœåŠ¡å¯åŠ¨éœ€è¦120sï¼Œç„¶åStartupProbeæ¢æµ‹éœ€è¦60s,è¿™æ ·çš„è¯ä¹Ÿä¼šæœ‰é—®é¢˜å§ï¼\n","like_count":0},{"had_liked":false,"id":390671,"user_name":"å‡¡ä¹‹","can_delete":false,"product_type":"c1","uid":2863876,"ip_address":"åŒ—äº¬","ucode":"1EA24BB5780C5C","user_header":"https://static001.geekbang.org/account/avatar/00/2b/b3/04/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1715927417,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"è€å¸ˆï¼Œæˆ‘çš„å®æˆ˜ç»éªŒå¾—çŸ¥ï¼ŒstartupProbe ä¹Ÿä¸èƒ½ç®€å•çš„é…ç½®ï¼Œè¦ç»™startupProbeä¸€ä¸ªåˆé€‚æœ€é•¿çš„å¯åŠ¨æ—¶é—´ã€‚ç»™å¤šäº†ï¼Œå¦‚æœå®¹å™¨å¯åŠ¨ä¸€ç›´æŠ¥é”™ï¼Œä¸åˆ©äºåŠæ—¶å¤„ç†é—®é¢˜ï¼Œç»™å°‘äº†ï¼Œå®¹å™¨åˆ™ä¸€ç›´é‡å¯ã€‚\nå»ºè®®ï¼šå¯ä»¥é…åˆæ—¥å¿—æœåŠ¡åˆ†æä¸‹æœåŠ¡æ¯æ¬¡çš„å¯åŠ¨æ—¶é—´ã€‚å–æœ€é•¿å¯åŠ¨æ—¶é—´ï¼Œå†å¤šç»™ä»–20-30sçš„æ—¶é—´ã€‚\nå¦‚æœå¯åŠ¨æ¢é’ˆçš„é…ç½®æ˜¯ï¼š\nstartupProbe:\n      httpGet:\n        path: &#47;healthz\n        port: 8080\n      failureThreshold: 30\n      initialDelaySeconds: 5\n      periodSeconds: 10\næˆ‘ä»¬å¯ä»¥è®¡ç®—å‡º Kubernetes ç»™å®šå®¹å™¨çš„æœ€é•¿å¯åŠ¨æ—¶é—´å¦‚ä¸‹ï¼š\n\nåˆå§‹å»¶è¿Ÿï¼ˆinitialDelaySecondsï¼‰ï¼š5ç§’\næ¢æµ‹å‘¨æœŸï¼ˆperiodSecondsï¼‰ï¼š10ç§’\nå¤±è´¥é˜ˆå€¼ï¼ˆfailureThresholdï¼‰ï¼š30æ¬¡\nKubernetes å°†åœ¨ initialDelaySeconds ä¹‹åå¼€å§‹è¿›è¡Œ startupProbe æ¢æµ‹ã€‚å¦‚æœæ¢æµ‹å¤±è´¥ï¼ŒKubernetes å°†ç­‰å¾… periodSeconds å†æ¬¡è¿›è¡Œæ¢æµ‹ã€‚å¦‚æœè¿ç»­æ¢æµ‹å¤±è´¥ï¼Œå¹¶ä¸”å¤±è´¥æ¬¡æ•°è¾¾åˆ° failureThresholdï¼ŒKubernetes å°†é‡å¯å®¹å™¨ã€‚\n\nå› æ­¤ï¼Œæœ€é•¿å¯åŠ¨æ—¶é—´å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼š\n\næœ€é•¿å¯åŠ¨æ—¶é—´\n=\nåˆå§‹å»¶è¿Ÿ\n+\n(\næ¢æµ‹å‘¨æœŸ\nÃ—\n(\nå¤±è´¥é˜ˆå€¼\nâˆ’\n1\n)\n)\næœ€é•¿å¯åŠ¨æ—¶é—´=åˆå§‹å»¶è¿Ÿ+(æ¢æµ‹å‘¨æœŸÃ—(å¤±è´¥é˜ˆå€¼âˆ’1))\n\nå°†æ‚¨çš„é…ç½®å€¼ä»£å…¥å…¬å¼ï¼š\n\næœ€é•¿å¯åŠ¨æ—¶é—´\n=\n5\nç§’\n+\n(\n10\nç§’\nÃ—\n(\n30\nâˆ’\n1\n)\n)\næœ€é•¿å¯åŠ¨æ—¶é—´=5ç§’+(10ç§’Ã—(30âˆ’1))\næœ€é•¿å¯åŠ¨æ—¶é—´\n=\n5\nç§’\n+\n(\n10\nç§’\nÃ—\n29\n)\næœ€é•¿å¯åŠ¨æ—¶é—´=5ç§’+(10ç§’Ã—29)\næœ€é•¿å¯åŠ¨æ—¶é—´\n=\n5\nç§’\n+\n290\nç§’\næœ€é•¿å¯åŠ¨æ—¶é—´=5ç§’+290ç§’\næœ€é•¿å¯åŠ¨æ—¶é—´\n=\n295\nç§’\næœ€é•¿å¯åŠ¨æ—¶é—´=295ç§’\n\næ‰€ä»¥ï¼Œè¿™ä¸ªé…ç½®æœ€å¤šç»™äº†å®¹å™¨ 295 ç§’ï¼ˆçº¦ 4 åˆ† 55 ç§’ï¼‰çš„å¯åŠ¨æ—¶é—´ã€‚è¿™æ„å‘³ç€å¦‚æœå®¹å™¨åœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å“åº”æˆåŠŸçš„å¥åº·æ£€æŸ¥ï¼ŒKubernetes å°†æ ¹æ® startupProbe çš„é…ç½®é‡å¯è¯¥å®¹å™¨ã€‚\n","like_count":0},{"had_liked":false,"id":388099,"user_name":"æ˜Ÿç©º","can_delete":false,"product_type":"c1","uid":1302360,"ip_address":"åŒ—äº¬","ucode":"0F6A556FC7B40F","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/58/5b73780a.jpg","comment_is_top":false,"comment_ctime":1709349476,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"â€œç¬¬ä¸‰é˜¶æ®µï¼šéšç€ Readine å’Œ Liveness çš„æ¢æµ‹æˆåŠŸï¼Œå½“å‰ Pod çš„å®¹å™¨è½¬ä¸º Ready(1&#47;1) çš„çŠ¶æ€ï¼ŒService EndPoints å°† Pod åŠ å…¥åˆ°åˆ—è¡¨å½“ä¸­ï¼ŒPod å¼€å§‹æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚â€\n\nè€å¸ˆï¼Œéº»çƒ¦é—®ä¸‹å¦‚æœåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒsprintbootæœåŠ¡ä½œä¸ºæä¾›æ–¹å·²ç»å°†è‡ªå·±çš„ipæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒé‡Œé¢äº†ï¼Œä½†æ˜¯æ­¤åˆ»Service EndPoints è¿˜æ²¡å°† Pod åŠ å…¥åˆ°å¯ç”¨åˆ—è¡¨å½“ä¸­ï¼Œé‚£ä¹ˆè¿™æ—¶å€™è°ƒç”¨æ–¹ä»æ³¨å†Œä¸­å¿ƒå‘ç°äº†è¿™ä¸ªipè¿˜èƒ½æ­£å¸¸è°ƒç”¨å—","like_count":0},{"had_liked":false,"id":365571,"user_name":"æ— åæ— å§“","can_delete":false,"product_type":"c1","uid":2621412,"ip_address":"åŒ—äº¬","ucode":"487BD5AA2CD305","user_header":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","comment_is_top":false,"comment_ctime":1672792678,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"ä¸‰ç§çŠ¶æ€","like_count":0}]}