{"id":491227,"title":"32ï½œå®¹å™¨é‡Œçš„å†…å­˜ç®¡ç†ï¼šåˆ†é…å™¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>ä¸Šä¸€è®²é‡Œæˆ‘ä»¬è®¨è®ºäº† C++ é‡Œå†…å­˜ç®¡ç†çš„åŸºæœ¬å·¥å…·ï¼Œåˆ†é…å’Œé‡Šæ”¾å‡½æ•°ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹å®¹å™¨é‡Œç®¡ç†å†…å­˜çš„æœºåˆ¶â€”â€”åˆ†é…å™¨ï¼ˆallocatorï¼‰ã€‚</p><h2>ä¸€ç‚¹ç‚¹å†å²</h2><p>ä»ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°çš„ SGI STL çš„æ–‡æ¡£ <span class=\"orange\">[1]</span> ä¸­èƒ½å¤Ÿçœ‹åˆ°ï¼Œåœ¨ C++ æ ‡å‡†åŒ–ä¹‹å‰ï¼ŒSTL å·²ç»å¼•å…¥äº†åˆ†é…å™¨çš„æ¦‚å¿µï¼Œå¹¶ä¸”è¿˜å¼•å…¥äº†å¤šç§åˆ†é…å™¨ï¼Œä¸ºä¸åŒçš„ä½¿ç”¨åœºæ™¯è¿›è¡Œä¼˜åŒ–ï¼š</p><ul>\n<li><code>alloc</code>ï¼šçº¿ç¨‹å®‰å…¨çš„é»˜è®¤åˆ†é…å™¨ï¼›é»˜è®¤å¯¹å°äº 128 å­—èŠ‚çš„åˆ†é…è¦æ±‚ä½¿ç”¨å†…å­˜æ± ï¼Œè¶…è¿‡åˆ™ä½¿ç”¨ <code>malloc_alloc</code></li>\n<li><code>pthread_alloc</code>ï¼šæ¯çº¿ç¨‹ä½¿ç”¨ç‹¬ç«‹å†…å­˜æ± çš„åˆ†é…å™¨</li>\n<li><code>single_client_alloc</code>ï¼šçº¿ç¨‹ä¸å®‰å…¨çš„å¿«é€Ÿåˆ†é…å™¨</li>\n<li><code>malloc_alloc</code>ï¼šè°ƒç”¨ <code>malloc</code> å’Œ <code>free</code> æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„åˆ†é…å™¨</li>\n</ul><p>åˆ†é…å™¨çš„ç›®çš„æ˜¯åˆ†ç¦»å¯¹è±¡çš„æ„é€ å’Œå†…å­˜åˆ†é…ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æŠŠå†…å­˜åˆ†é…çš„å†³ç­–äº¤ç»™äº†å®¹å™¨ï¼ˆè€Œéå¯¹è±¡ï¼‰ï¼Œå¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œæ€§èƒ½ä¸Šä¹Ÿæœ‰å¥½å¤„ï¼Œå› æ­¤è¾ƒæ—©çš„ C++ æ ‡å‡†åº“çš„å®ç°ä¹Ÿéƒ½æ²¿è¢­äº† SGI STL é‡Œçš„è¿™äº›åˆ†é…å™¨ã€‚</p><p>ä¸è¿‡ï¼Œéšç€æ—¶é—´çš„å‘å±•ï¼Œå¤§å®¶ä¹Ÿæ…¢æ…¢æ”¾å¼ƒäº† SGI STL å®ç°é‡Œçš„è¿™äº›ä¸åŒçš„åˆ†é…å™¨ï¼Œè€Œåªä½¿ç”¨ C++ æ ‡å‡†é‡Œå®šä¹‰çš„ <code>std::allocator</code> äº†ã€‚é™¤äº†æ ‡å‡†é‡Œå®šä¹‰çš„åˆ†é…å™¨å’Œ SGI STL çš„æ¥å£ä¸åŒå¤–ï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› ææ€•æ˜¯åˆ†é…å™¨æ˜¯å®¹å™¨ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä½¿ç”¨ä¸åŒåˆ†é…å™¨çš„å®¹å™¨æ˜¯ä¸åŒçš„ç±»å‹ï¼šä¸€ä¸ªè¦æ±‚ <code>vector&lt;int&gt;&amp;</code> ä½œä¸ºå½¢å‚ç±»å‹çš„å‡½æ•°ï¼Œæ˜¯ä¸èƒ½æ¥å— <code>vector&lt;int, single_client_alloc&lt;int&gt; &gt;</code> ä½œä¸ºå®å‚ç±»å‹çš„ã€‚è¿™ä¸ªé—®é¢˜è¦åˆ° C++17 å¼•å…¥å¤šæ€åˆ†é…å™¨ï¼ˆ<code>polymorphic_allocator</code>ï¼‰æ‰ç®—éƒ¨åˆ†å¾—åˆ°è§£å†³ã€‚</p><!-- [[[read_end]]] --><p>åœ¨ SGI STL çš„å®ç°é‡Œï¼Œåˆ†é…å™¨éœ€è¦æä¾›ä¸¤ä¸ªé™æ€æˆå‘˜å‡½æ•°ï¼š</p><ul>\n<li><code>static void* allocate(size_t n)</code></li>\n<li><code>static void deallocate(void* p, size_t n)</code></li>\n</ul><p>è¿™è·Ÿæˆ‘ä»¬ä¸Šä¸€è®²è®¨è®ºçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°éå¸¸ç›¸ä¼¼ï¼Œåªé™¤äº†ä¸€ç‚¹â€”â€”è¿™é‡Œçš„ <code>deallocate</code> æ˜¯å¯ä»¥çœ‹åˆ°é‡Šæ”¾çš„å†…å­˜å—çš„å¤§å°çš„ã€‚è¿™å½“ç„¶å¯¹æ€§èƒ½å¾ˆæœ‰å¥½å¤„ï¼šæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ ¹æ®å†…å­˜å—çš„å¤§å°æ¥å®ç°å†…å­˜æ± ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ <code>allocate</code> å’Œ <code>deallocate</code> éƒ½æ˜¯é™æ€æˆå‘˜å‡½æ•°ï¼Œå› æ­¤ SGI STL é‡Œçš„åˆ†é…å™¨åªæœ‰å…¨å±€çŠ¶æ€ï¼Œä¸èƒ½æ ¹æ®å®ä¾‹æ¥åŒºåˆ†çŠ¶æ€ã€‚</p><p>C++98 çš„åˆ†é…å™¨é‡Œæœ€é‡è¦çš„æˆå‘˜å‡½æ•°åŒæ ·æ˜¯ <code>allocate</code> å’Œ <code>deallocate</code>ï¼Œä½†å½¢å¼å’Œè¯­ä¹‰éƒ½è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¹¶ä¸”ä¸å†æ˜¯é™æ€æˆå‘˜å‡½æ•°ï¼Œå› è€Œç†è®ºä¸Šå®ƒä»¬å¯ä»¥æ‹¥æœ‰éå…¨å±€çš„çŠ¶æ€ã€‚å¯æƒœçš„æ˜¯ï¼Œâ€œå°½ç®¡ä¸è¦æ±‚è‡ªå®šä¹‰åˆ†é…å™¨ä¸ºæ— çŠ¶æ€ï¼Œæ ‡å‡†åº“ä¸­æ˜¯å¦åŠå¦‚ä½•æ”¯æŒåˆ†é…å™¨æ˜¯å®ç°å®šä¹‰çš„ã€‚è‹¥å®ç°ä¸æ”¯æŒä½¿ç”¨ä¸ç›¸ç­‰çš„åˆ†é…å™¨å€¼ï¼Œåˆ™è¿™ç§ä½¿ç”¨å¯èƒ½å¯¼è‡´å®ç°å®šä¹‰çš„è¿è¡Œæ—¶é”™è¯¯æˆ–æœªå®šä¹‰è¡Œä¸ºâ€ <span class=\"orange\">[2]</span>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ C++98 çš„å¹´ä»£é‡Œï¼Œä½ æœ€å¥½ä½¿ç”¨è·Ÿ SGI STL åˆ†é…å™¨ä¸€æ ·ä¸æºå¸¦çŠ¶æ€çš„åˆ†é…å™¨ï¼Œå¦åˆ™å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>C++98 çš„åˆ†é…å™¨é‡Œå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯æœ‰ç‚¹è¿‡åº¦è®¾è®¡äº†ã€‚åˆ†é…å™¨ä¸ä»…è¦è´Ÿè´£å¯¹è±¡çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè¿˜è¦è´Ÿè´£æ„é€ å’Œææ„â€”â€”åˆ†é…å™¨éœ€è¦æœ‰æˆå‘˜å‡½æ•° <code>construct</code> å’Œ <code>destroy</code>ã€‚è¿™ä¸ªåŠŸèƒ½ä¸èƒ½è¯´ä¸€ç‚¹ç”¨éƒ½æ²¡æœ‰ï¼ˆæ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è·Ÿè¸ªæŸç§å¯¹è±¡åœ¨å®¹å™¨ä¸­è¢«æ„é€ äº†å¤šå°‘æ¬¡ï¼‰ï¼Œä½†ç”¨å¤„çœŸçš„ä¸å¤§ï¼Œè·Ÿåˆ†é…å™¨çš„å…³ç³»ä¹Ÿæœ‰ç‚¹è¿œã€‚</p><p>ä» C++11 å¼€å§‹ï¼Œåœ¨ <code>allocator_traits</code> çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥è¿›ä¸€æ­¥æŠ›å¼€ä¸€äº›ä¸å¿…è¦çš„ç»†èŠ‚ï¼Œåœ¨ä¿ç•™å‘åå…¼å®¹æ€§çš„åŒæ—¶ï¼Œç®€å•è€Œå¿«é€Ÿåœ°å®ç°å‡ºè‡ªå·±éœ€è¦çš„åˆ†é…å™¨ã€‚åˆ†é…å™¨ä¹Ÿæ˜ç¡®è§„å®šäº†<strong>å¯ä»¥</strong>æœ‰è‡ªå·±çš„çŠ¶æ€ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä»¥ C++17 é‡Œçš„åˆ†é…å™¨è¦æ±‚ä¸ºåŸºç¡€æ¥è®¨è®ºä¸€ä¸‹åˆ†é…å™¨çš„å®ç°ã€‚</p><h2>æ ‡å‡†åˆ†é…å™¨</h2><p>æ ‡å‡†åˆ†é…å™¨ <code>std::allocator</code> æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åˆ†é…å™¨ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä¸€èµ·çœ‹ä¸€ä¸ªæ ‡å‡†åˆ†é…å™¨çš„ç¤ºä¾‹å®ç°ï¼Œæ¥äº†è§£ä¸€ä¸‹åˆ†é…å™¨é‡Œçš„å¿…è¦æˆå‘˜ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nclass allocator {\npublic:\n  using size_type = size_t;\n  using difference_type = ptrdiff_t;\n  using value_type = T;\n\n  using is_always_equal = true_type;\n  using propagate_on_container_move_assignment =\n    true_type;\n\n  template &lt;class U&gt;\n  struct rebind {\n    using other = allocator&lt;U&gt;;\n  };\n\n  allocator() = default;\n\n  template &lt;class U&gt;\n  allocator(\n    const allocator&lt;U&gt;&amp;) noexcept\n  {}\n\n  T* allocate(size_t n)\n  {\n    return static_cast&lt;T*&gt;(\n      ::operator new(n *\n                     sizeof(T)));\n  }\n\n  void deallocate(T* p,\n                  size_t n) noexcept\n  {\n    ::operator delete(p);\n  }\n};\n</code></pre><p>å¤´ä¸‰ä¸ªç±»å‹åˆ«ååŸºæœ¬ä¸Šæ°¸è¿œè¿™æ ·å†™ï¼Œä¸éœ€è¦ä¿®æ”¹ã€‚æŠŠ <code>is_always_equal</code> å®šä¹‰ä¸º <code>true_type</code>ï¼Œæ„å‘³ç€è¿™ä¸ªåˆ†é…å™¨æ˜¯æ²¡æœ‰å†…éƒ¨çŠ¶æ€çš„ï¼Œæ‰€æœ‰çš„æ ‡å‡†åˆ†é…å™¨éƒ½ç›¸ç­‰ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬æŠŠ <code>propagate_on_container_move_assignment</code> å®šä¹‰ä¸º <code>true_type</code>ï¼Œæ„å‘³ç€åœ¨å®¹å™¨ç§»åŠ¨çš„æ—¶å€™ç›®æ ‡å®¹å™¨å¯ä»¥å–å¾—æºå†…å­˜çš„æ‰€æœ‰æƒï¼Œè¿™æ ·å¯ä»¥é«˜æ•ˆåœ°è¿›è¡Œç§»åŠ¨ï¼ˆå¦åˆ™ç›®æ ‡å®¹å™¨å³ä½¿åœ¨ç§»åŠ¨èµ‹å€¼æ—¶ä»ç„¶åªèƒ½å¯¹æ‰€æœ‰å…ƒç´ é€ä¸ªæ„é€ æˆ–èµ‹å€¼ï¼‰ã€‚ç±»ä¼¼çš„ç‰¹å¾æˆå‘˜è¿˜æœ‰ <code>propagate_on_container_copy_assignment</code> å’Œ <code>propagate_on_container_swap</code>ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªæˆ‘ä»¬å–é»˜è®¤å€¼ <code>false_type</code> å°±è¡Œï¼ˆè¿™äº›ç‰¹å¾çš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ <span class=\"orange\">[2]</span>ï¼‰ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬æåˆ°ç±»ç‰¹å®šçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°çš„ä¸€ä¸ªå¤§é—®é¢˜æ˜¯ï¼Œå½“å¯¹è±¡æ”¾åˆ°å®¹å™¨é‡Œçš„æ—¶å€™ï¼Œå¯¹è±¡çš„å†…å­˜ç©ºé—´ä¸€èˆ¬æ˜¯å’Œæ‰€éœ€çš„å…¶ä»–æ•°æ®ä¸€èµ·åˆ†é…çš„ã€‚ä»¥ GCC 11 æ ‡å‡†åº“çš„ <code>std::set</code> ä¸ºä¾‹ï¼šå½“ä½ åˆ›å»º <code>set&lt;Obj&gt;</code> çš„æ—¶å€™ï¼Œç»“ç‚¹çš„çœŸæ­£ç±»å‹æ˜¯ <code>std::_Rb_tree_node&lt;Obj&gt;</code>ï¼Œè€Œç”¨æˆ·å¯¹è±¡åˆ™å­˜å‚¨åœ¨è¿™ä¸ªç»“ç‚¹å¯¹è±¡çš„å†…å­˜é‡Œã€‚å› æ­¤ï¼Œç±»ç‰¹å®šçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°å¯¹æ­¤æ˜¯æ— æ•ˆçš„ã€‚</p><p>åˆ†é…å™¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼æ˜¯ <code>rebind</code>ï¼ˆé‡æ–°ç»‘å®šï¼‰æˆå‘˜ç±»æ¨¡æ¿ã€‚ä»¥ <code>set&lt;Obj&gt;</code> ä¸ºä¾‹ï¼Œå®ƒçš„é»˜è®¤æ¨¡æ¿å‚æ•°è§„å®šäº†é»˜è®¤åˆ†é…å™¨æ˜¯ <code>allocator&lt;Obj&gt;</code>ï¼Œåœ¨ <code>set</code> çš„å®ç°é‡Œå®é™…ä½¿ç”¨çš„åˆ†é…å™¨ç±»å‹æœ€ç»ˆä¼šå˜æˆ <code>allocator&lt;Obj&gt;::rebind&lt;_Rb_tree_node&lt;Obj&gt;&gt;::other</code>ï¼Œç”¨è¿™ä¸ªåˆ†é…å™¨åˆ†é…å‡ºæ¥çš„å†…å­˜å¤§å°å°±æ˜¯çº¢é»‘æ ‘çš„ç»“ç‚¹å¤§å°ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å¯¹è±¡çš„å¤§å°äº†ã€‚</p><p>æ ‡å‡†åˆ†é…å™¨æ²¡æœ‰æ•°æ®æˆå‘˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ç¼ºçœçš„é»˜è®¤æ„é€ å‡½æ•°å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬éœ€è¦æ˜¾å¼å£°æ˜ç¼ºçœçš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªå¯ä»¥æ¥å—ä½¿ç”¨å…¶ä»–æ¨¡æ¿å‚æ•°çš„ <code>std::allocator</code> çš„æ„é€ å‡½æ•°ã€‚å®ƒä¹Ÿä¸éœ€è¦å®é™…åšä»»ä½•äº‹æƒ…ã€‚</p><p>çœŸæ­£éœ€è¦å¹²æ´»çš„ï¼Œå°±æ˜¯ <code>allocate</code> å’Œ <code>deallocate</code> å‡½æ•°äº†ã€‚è·Ÿ SGI STL çš„åˆ†é…å™¨ä¸åŒï¼Œæ ‡å‡†åº“é‡Œçš„åˆ†é…å™¨æ˜¯çŸ¥é“è‡ªå·±è¦ä¸ºä»€ä¹ˆç±»å‹åˆ†é…å†…å­˜çš„ï¼Œæ‰€ä»¥ <code>allocate</code> çš„å‚æ•°ä¸æ˜¯è¦åˆ†é…å†…å­˜çš„å¯¹è±¡çš„å¤§å°ï¼Œè€Œæ˜¯è¦åˆ†é…å†…å­˜çš„å¯¹è±¡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªæœ€ç®€å•çš„ <code>std::allocator</code> é‡Œï¼Œé‚£å°±æ˜¯ç®€å•åœ°è®¡ç®—å‡ºæ‰€éœ€åˆ†é…çš„å†…å­˜çš„å¤§å°ï¼Œç„¶åè°ƒç”¨å…¨å±€çš„ <code>operator new</code> æ¥åˆ†é…å†…å­˜äº†ã€‚ç±»ä¼¼åœ°ï¼Œ<code>deallocate</code> ä¼šå¾—åˆ°éœ€è¦é‡Šæ”¾çš„æŒ‡é’ˆå’Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„æ•°é‡ã€‚ç”±äºç›®å‰æˆ‘ä»¬çš„å®ç°åªæ˜¯ç®€å•åœ°è°ƒç”¨ <code>operator delete</code> æ¥é‡Šæ”¾å†…å­˜ï¼Œæ•°é‡è¿™ä¸ªå‚æ•°ä¹Ÿå°±ä¸ä½¿ç”¨äº†ã€‚</p><h3>åˆ†é…å™¨ç‰¹å¾</h3><p>æˆ‘ä¸Šé¢ç»™å‡ºçš„ <code>allocator</code> è·Ÿç›®å‰ C++17 é‡Œçš„æ ‡å‡†åˆ†é…å™¨è¿˜æ˜¯æœ‰ç‚¹å°åŒºåˆ«ï¼Œæœ€ä¸»è¦å°±æ˜¯åœ¨ C++17 é‡Œæ ‡å‡†åˆ†é…å™¨ä»ç„¶æœ‰ <code>construct</code> å’Œ <code>destroy</code> ç­‰æˆå‘˜ï¼Œè™½ç„¶å®ƒä»¬å·²ç»æ˜¯ä¸å¿…è¦çš„äº†ã€‚ä»¥è¿™ä¸¤ä¸ªæˆå‘˜å‡½æ•°ä¸ºä¾‹ï¼Œå®ƒä»¬çš„å®šä¹‰éå¸¸ç®€å•ï¼š</p><pre><code class=\"language-cpp\">template &lt;class T&gt;\nclass allocator {\npublic:\n  â€¦\n  template &lt;typename U,\n            typename... Args&gt;\n  void\n  construct(U* p, Args&amp;&amp;... args) noexcept(\n    std::is_nothrow_constructible&lt;\n      U, Args...&gt;::value)\n  {\n    ::new((void*)p) U(\n      std::forward&lt;Args&gt;(args)...);\n  }\n\n  template &lt;typename U&gt;\n  void destroy(U* p) noexcept(\n    std::is_nothrow_destructible&lt;\n      U&gt;::value)\n  {\n    p-&gt;~U();\n  }\n};\n</code></pre><p>ç›¸ä¿¡ä½ åœ¨å­¦è¿‡äº†å®Œç¾è½¬å‘ï¼ˆ<a href=\"https://time.geekbang.org/column/article/169268\">ç¬¬ 3 è®²</a>ï¼‰ã€type traitsï¼ˆ<a href=\"https://time.geekbang.org/column/article/181608\">ç¬¬ 13 è®²</a>ï¼‰ã€å¯å˜æ¨¡æ¿ï¼ˆ<a href=\"https://time.geekbang.org/column/article/185899\">ç¬¬ 18 è®²</a>ï¼‰å’Œåˆ†é…å‡½æ•°ï¼ˆ<a href=\"https://time.geekbang.org/column/article/489409\">ä¸Šä¸€è®²</a>ï¼‰ä¹‹åï¼Œç†è§£ä¸Šé¢çš„ä»£ç åº”è¯¥å·²ç»æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚å”¯ä¸€éœ€è¦ç•¥åŠ è¯´æ˜ä¸€ä¸‹çš„æ˜¯ï¼Œ<code>noexcept</code> è¯´æ˜é‡Œçš„ç¼–è¯‘æœŸå¸ƒå°”è¡¨è¾¾å¼æ˜¯ç”¨æ¥è®¡ç®—å½“å‰å‡½æ•°æ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸çš„ã€‚è¿™æ ·ï¼Œå¦‚æœèƒ½ç”¨ <code>Args...</code> æ¥æ— å¼‚å¸¸åœ°æ„é€  <code>U</code> å¯¹è±¡ï¼Œé‚£ <code>construct</code> å‡½æ•°ä¹Ÿèƒ½ä¿è¯ä¸æŠ›å¼‚å¸¸ï¼›å¦‚æœ <code>U</code> çš„ææ„èƒ½å¤Ÿä¸æŠ›å¼‚å¸¸ï¼Œé‚£ <code>destroy</code> å‡½æ•°ä¹Ÿèƒ½ä¿è¯ä¸æŠ›å¼‚å¸¸ã€‚</p><p>è¿™ä¸¤ä¸ªå‡½æ•°åœ¨ C++17 é‡Œè¢«æ ‡ä¸ºåºŸå¼ƒï¼Œåœ¨ C++20 é‡Œè¢«æ­£å¼ç§»é™¤ã€‚æˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå°±æ˜¯åœ¨åˆ†é…å™¨æ²¡æœ‰æä¾›æŸä¸ªæˆå‘˜çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åˆ†é…å™¨ç‰¹å¾ï¼ˆ<code>allocator_traits</code>ï¼‰æä¾›é»˜è®¤ç‰ˆæœ¬ã€‚åŸºæœ¬æŠ€å·§å°±æ˜¯æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/181636\">ç¬¬ 14 è®²</a>è®¨è®ºçš„ SFINAEã€‚æ¯”å¦‚ï¼Œåœ¨ GCC çš„å¤´æ–‡ä»¶ bits/alloc_traits.h ä½ å¯ä»¥æ‰¾åˆ°åˆ«åæ¨¡æ¿ <code>__has_construct</code>ï¼Œå°±æ˜¯ç”¨æ¥æ£€æµ‹åˆ†é…å™¨æ˜¯ä¸æ˜¯æœ‰å‚æ•°å½¢å¼åŒ¹é…çš„ <code>construct</code> æˆå‘˜å‡½æ•°ã€‚ç•¥å» <code>noexcept</code> çš„å¤„ç†ï¼Œ<code>allocator_traits</code> é‡Œå¯¹ <code>construct</code> çš„å¤„ç†å¤§è‡´å¦‚ä¸‹ï¼š</p><pre><code class=\"language-cpp\">template &lt;typename Alloc&gt;\nstruct allocator_traits {\n  â€¦\n  template &lt;typename T,\n            typename... Args&gt;\n  using __has_construct = â€¦;\n  template &lt;typename T,\n            typename... Args&gt;\n  static enable_if_t&lt;\n    __has_construct&lt;T,\n                    Args...&gt;::value&gt;\n  construct(Alloc&amp; a, T* p,\n            Args&amp;&amp;... args)\n  { // Alloc é‡Œé¢æœ‰ construct çš„æƒ…å†µ\n    a.construct(\n      p, forward&lt;Args&gt;(args)...);\n  }\n  template &lt;typename T,\n            typename... Args&gt;\n  static enable_if_t&lt;\n    !__has_construct&lt;T,\n                     Args...&gt;::value&gt;\n  construct(Alloc&amp; a, T* p,\n            Args&amp;&amp;... args)\n  { // Alloc é‡Œé¢æ²¡æœ‰ construct çš„æƒ…å†µ\n    new(p) T(forward&lt;Args&gt;(args)...);\n  }\n};\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨æ‹¥æœ‰æŸä¸ªåˆ†é…å™¨ <code>Alloc</code>ã€å®ƒçš„å®ä¾‹ <code>a</code> å’ŒæŸå¯¹è±¡çš„ç›®çš„åœ°å€ <code>p</code>ï¼Œå¹¶éœ€è¦æ„é€ ä¸€ä¸ªè¯¥å¯¹è±¡çš„æ—¶å€™ï¼Œåªè¦è°ƒç”¨ <code>allocator_traits&lt;Alloc&gt;::construct(a, p, â€¦)</code> å³å¯ã€‚<code>allocator_traits</code> ä¼šæ ¹æ®åˆ†é…å™¨é‡Œæ˜¯å¦æœ‰æˆå‘˜å‡½æ•° <code>construct</code> æ¥å†³å®šæ˜¯å¦è¦ä½¿ç”¨æŸç§ç‰¹æ®Šçš„æ–¹å¼æ¥æ„é€ å¯¹è±¡ã€‚</p><p>å¯¹äºå…¶ä»–å¯èƒ½ç¼ºå¤±çš„æˆå‘˜çš„å¤„ç†ä¹Ÿå¤§è‡´å¦‚æ­¤ã€‚</p><h2>å¤šæ€åˆ†é…å™¨</h2><p>æˆ‘ä»¬å‰é¢å·²ç»æåˆ°ï¼Œåˆ†é…å™¨æ˜¯å®¹å™¨çš„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› è€ŒåŒç§å®¹å™¨æœ‰ä¸åŒçš„åˆ†é…å™¨ä¹Ÿè¢«è§†ä½œä¸åŒçš„ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨äº†ä¸åŒçš„åˆ†é…å™¨ï¼Œåˆå¸Œæœ›å¿½ç•¥åˆ†é…å™¨çš„ä¸åŒï¼Œç‰¹åˆ«æ˜¯åœ¨å‡½æ•°çš„å½¢å‚ä¹‹ä¸­ï¼Œé‚£å¤šæ€åˆ†é…å™¨å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚</p><p>åœ¨å¤šæ€åˆ†é…å™¨é‡Œï¼ŒæŠŠå†…å­˜ç®¡ç†çš„åŠŸèƒ½æ”¾åœ¨ä¸€ä¸ªæŠ½è±¡ç±» <code>memory_resource</code>ï¼ˆå†…å­˜èµ„æºï¼›<span class=\"orange\">[3]</span>ï¼‰é‡Œé¢ã€‚å®ƒæä¾›ä¸‹é¢è¿™ä¸‰ä¸ªä¸»è¦æ¥å£ï¼š</p><ul>\n<li><code>void* allocate(size_t bytes, size_t alignment = alignof(max_align_t));</code></li>\n<li><code>void deallocate(void* p, size_t bytes, size_t alignment = alignof(max_align_t));</code></li>\n<li><code>bool is_equal(const memory_resource&amp; other) const noexcept;</code></li>\n</ul><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¥å£åˆå›åˆ°äº† SGI STL é‚£ç§çº¯ç²¹çš„å†…å­˜åˆ†é…çš„æ ·å­ã€‚ä¸è¿‡ï¼Œé‡Œé¢åŠ ä¸Šäº†æ–°çš„å¯¹é½å‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯è·Ÿå¹³å°æœ€å¤§çš„æ ‡é‡ç±»å‹ä¸€è‡´ã€‚å¦å¤–ï¼Œä¸“é—¨æœ‰ä¸€ä¸ªæ¥å£ç”¨æ¥å¤šæ€åœ°æ£€æŸ¥ä¸¤ä¸ª <code>memory_resource</code> æ˜¯å¦ç›¸ç­‰ã€‚</p><p>è¿™ä¸‰ä¸ªæ¥å£éƒ½æ˜¯éœ€è¦å­ç±»æ¥â€œå®ç°â€çš„ã€‚ä½†è¿™ä¸‰ä¸ªå‡½æ•°æœ¬èº«ä¸æ˜¯è™šå‡½æ•°â€”â€”å®ƒä»¬ä¼šè°ƒç”¨å‰é¢åŠ ä¸Š <code>do_</code> å‰ç¼€çš„ä¿æŠ¤æˆå‘˜å‡½æ•°ï¼Œè¿™æ‰æ˜¯å­ç±»é‡Œéœ€è¦è¦†ç›–çš„ã€‚ä¸€ä¸ªç®€å•èƒ½å®é™…å¹²æ´»çš„å­ç±»å¯èƒ½é•¿è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-cpp\">class new_delete_alloc_resource\n  : public pmr::memory_resource {\nprotected:\n  void* do_allocate(\n    size_t bytes,\n    size_t alignment) override\n  {\n    return ::operator new(\n      bytes, align_val_t{alignment});\n  }\n\n  void do_deallocate(\n    void* p, size_t bytes,\n    size_t alignment) override\n  {\n    ::operator delete(\n      p, align_val_t{alignment});\n  }\n\n  bool do_is_equal(\n    const pmr::memory_resource&amp;\n      other) const noexcept override\n  {\n    return dynamic_cast&lt;\n      const new_delete_alloc_resource*&gt;(\n      &amp;other);\n  }\n};\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è°ƒç”¨å…¨å±€çš„ <code>operator new</code> å’Œ <code>operator delete</code> æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼›è€Œä»»ä½•ä¸¤ä¸ª <code>new_delete_alloc_resource</code> éƒ½è¢«è§†ä½œç›¸ç­‰ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>dynamic_cast</code> æ£€æŸ¥ <code>other</code> ä¹Ÿæ˜¯ä¸ª <code>new_delete_alloc_resource</code> å°±å¯ä»¥äº†ã€‚</p><p>å¦å¤–ï¼Œ<code>pmr</code> åç©ºé—´é‡Œä¹Ÿæä¾›äº†é’ˆå¯¹ä¸¤ä¸ª <code>memory_resource</code> çš„ç›¸ç­‰å’Œä¸ç­‰è¿ç®—ç¬¦ã€‚ç›¸ç­‰å®šä¹‰ä¸ºï¼š</p><pre><code class=\"language-cpp\">inline bool operator==(\n  const memory_resource&amp; a,\n  const memory_resource&amp; b) noexcept\n{\n  return &amp;a == &amp;b || a.is_equal(b);\n}\n</code></pre><p>å³ï¼Œä¸¤ä¸ª <code>memory_resource</code> æ˜¯åŒä¸€ä¸ªï¼Œæˆ–è€… <code>is_equal</code> å‡½æ•°è¿”å›çœŸã€‚</p><p>ä¸ç­‰è¿ç®—ç¬¦ä» C++20 å¼€å§‹èƒ½æ ¹æ®ç›¸ç­‰è¿ç®—ç¬¦è‡ªåŠ¨æä¾›ï¼Œåœ¨ C++20 ä¹‹å‰æ€»æ˜¯å®šä¹‰æˆç›¸ç­‰è¿ç®—ç¬¦çš„å¦æ“ä½œï¼ˆ<code>!(a == b)</code>ï¼‰ã€‚</p><p>æˆ‘ä»¬å®šä¹‰çš„ <code>new_delete_alloc_resource</code> æ˜¯ä¸€ä¸ª <code>memory_resource</code>ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª <code>memory_resource</code> æ³¨å…¥åˆ° <code>polymorphic_allocator</code>ï¼ˆå¤šæ€åˆ†é…å™¨ï¼›<span class=\"orange\">[4]</span>ï¼‰é‡Œæ‰èƒ½çœŸæ­£ä½¿ç”¨ã€‚<code>polymorphic_allocator</code> é‡Œé¢åªä¿å­˜ä¸€ä¸ª <code>memory_resource</code> çš„æŒ‡é’ˆï¼Œå®ƒçš„æˆå‘˜å‡½æ•°åŸºæœ¬ä¸Šä¹Ÿåªæ˜¯è½¬å‘è°ƒç”¨ <code>memory_resource</code> çš„æˆå‘˜å‡½æ•°ã€‚å‘ <code>polymorphic_allocator</code> æ³¨å…¥çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol>\n<li>\n<p>è°ƒç”¨ <code>polymorphic_allocator</code> çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚è¿™ç›¸å½“äºè°ƒç”¨ <code>pmr::get_default_resource</code> <span class=\"orange\">[5]</span> å‡½æ•°æ¥è·å¾—ç³»ç»Ÿé»˜è®¤çš„å†…å­˜èµ„æºçš„æŒ‡é’ˆï¼Œå¹¶ä½¿ç”¨è¯¥æŒ‡é’ˆæ¥è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</p>\n</li>\n<li>\n<p>è°ƒç”¨ä½¿ç”¨ <code>memory_resource</code> æŒ‡é’ˆçš„å•å‚æ•° <code>polymorphic_allocator</code> æ„é€ å‡½æ•°ã€‚è¿™ä¸ªæŒ‡é’ˆä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œä¾›åé¢çš„æˆå‘˜å‡½æ•°ä½¿ç”¨ã€‚</p>\n</li>\n</ol><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¤šåŠéœ€è¦ä½¿ç”¨å‡½æ•° <code>pmr::set_default_resource</code> <span class=\"orange\">[6]</span> æ¥ä¿®æ”¹é»˜è®¤çš„å†…å­˜èµ„æºã€‚é»˜è®¤å€¼æ˜¯ <code>new_delete_resource()</code> <span class=\"orange\">[7]</span> è¿”å›çš„ <code>memory_resource</code> æŒ‡é’ˆï¼Œä½¿ç”¨ <code>new</code> å’Œ <code>delete</code> æ¥è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼ŒåŠŸèƒ½ä¸Šåƒæˆ‘ä¸Šé¢å®šä¹‰çš„ <code>new_delete_alloc_resource</code>ã€‚æ³¨æ„è¿™ä¸€ä¿®æ”¹æ˜¯å…¨å±€çš„ï¼Œä¼šå½±å“æ‰€æœ‰åé¢çš„ <code>polymorphic_allocator</code> çš„é»˜è®¤æ„é€ ï¼Œå› è€Œå­˜åœ¨æ½œåœ¨çš„å¤šçº¿ç¨‹å†²çªé—®é¢˜ã€‚</p><p>æ— è®ºæ˜¯ä¸Šé¢å“ªç§æƒ…å†µï¼Œç¨‹åºå‘˜éƒ½éœ€è¦ç¡®ä¿å†…å­˜èµ„æºå¯¹è±¡åœ¨å¤šæ€åˆ†é…å™¨çš„å­˜ç»­æœŸé—´ä¹Ÿä¸€ç›´å­˜åœ¨ï¼Œå¦åˆ™å³ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚å› æ­¤ï¼Œå†…å­˜èµ„æºå¯¹è±¡å¸¸å¸¸ä¼šè¢«å®ç°ä¸ºä¸€ä¸ªå•ä»¶ï¼Œå¦‚æ ‡å‡†åº“ä¸­ <code>new_delete_resource</code> å’Œ <code>null_memory_resource</code> <span class=\"orange\">[8]</span> å‡½æ•°è¿”å›çš„å†…å­˜èµ„æºå¯¹è±¡å°±æ˜¯å¦‚æ­¤ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¦‚æœå°å¿ƒç®¡ç†å†…å­˜çš„è¯ï¼Œç”Ÿå‘½æœŸæ›´çŸ­çš„å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ ‡å‡†åº“æä¾›çš„å†…å­˜æ± å†…å­˜èµ„æº <span class=\"orange\">[9]</span>ã€<span class=\"orange\">[10]</span> å’Œå•è°ƒç¼“å†²åŒºå†…å­˜èµ„æº <span class=\"orange\">[11]</span>ï¼Œå°±å±•ç¤ºäº†ä¸€äº›æ›´å¤§çš„çµæ´»æ€§ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨å•çº¿ç¨‹æ— ä¿æŠ¤å†…å­˜æ±  <span class=\"orange\">[10]</span> çš„ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class=\"language-cpp\">pmr::unsynchronized_pool_resource\n  res;\npmr::polymorphic_allocator&lt;int&gt;\n  a{&amp;res};\n\n{\n  set&lt;int, less&lt;int&gt;,\n      pmr::polymorphic_allocator&lt;int&gt;&gt;\n    s(a);\n  // ä½¿ç”¨ sï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨å†…å­˜æ± \n} // s çš„ç”Ÿå‘½å‘¨æœŸä¸å¯é•¿äº res\n</code></pre><p>åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å·²ç»çœ‹åˆ°å¤šæ€å†…å­˜æ± çš„å¼ºå¤§åŠŸèƒ½äº†ã€‚ä¸è¿‡ï¼Œæœ‰ä¸€ä¸ªä½¿ç”¨å¤šæ€å†…å­˜æ± çš„åæœä¸çŸ¥é“ä½ ç•™æ„åˆ°äº†æ²¡æœ‰ï¼šè·ŸæŠŠ <code>propagate_on_container_move_assignment</code> è®¾ä¸º <code>false_type</code> ä¸€æ ·ï¼Œç§»åŠ¨çš„è¡Œä¸ºå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä½¿ç”¨é»˜è®¤åˆ†é…å™¨æ—¶ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ª <code>vector</code> ç§»åŠ¨èµ‹å€¼åˆ°å¦å¤–ä¸€ä¸ª <code>vector</code>ï¼Œç¼–è¯‘å™¨ä¸ä¼šäº§ç”Ÿå…ƒç´ å¯¹è±¡ç§»åŠ¨çš„ä»£ç ï¼Œå› ä¸ºåªéœ€è¦è°ƒæ•´ä¸€ä¸‹ <code>vector</code> æœ¬èº«çš„æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚è€Œç°åœ¨åªæœ‰åœ¨åˆ†é…å™¨ç›¸ç­‰çš„æƒ…å†µä¸‹æ‰èƒ½è¿™æ ·åšäº†ï¼›åœ¨ä¸ç›¸ç­‰æ—¶ï¼Œå°±åªèƒ½ä¸¤ä¸ª <code>vector</code> å„è‡ªä½¿ç”¨åˆ†é…å™¨åˆ†é…å†…å­˜ï¼Œç„¶åæŠŠæº <code>vector</code> é‡Œé¢çš„å…ƒç´ é€ä¸ªç§»åŠ¨è¿‡å»â€¦â€¦</p><p>æ­¤å¤–ï¼Œä½¿ç”¨åˆ†é…å™¨çš„æ ‡å‡†å®¹å™¨åœ¨ <code>pmr</code> åç©ºé—´ä¸‹éƒ½å­˜åœ¨åˆ«åæ¨¡æ¿ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>std::pmr::set&lt;int&gt;</code>ï¼Œè€Œä¸æ˜¯åˆè‡­åˆé•¿çš„ <code>std::set&lt;int, std::less&lt;int&gt;, std::pmr::polymorphic_allocator&lt;int&gt;&gt;</code>ã€‚è¿™è®©æˆ‘ä»¬åœ¨å®¹å™¨ä¸­ä½¿ç”¨å¤šæ€åˆ†é…å™¨ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p><p>æœ€åå†è¡¥å……ä¸€å¥ï¼Œä½¿ç”¨å¤šæ€åˆ†é…å™¨æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œæ¯•ç«Ÿ <code>std::vector&lt;int&gt;</code> å’Œ <code>std::pmr::vector&lt;int&gt;</code> ä»ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚è¿™ä¹Ÿæ˜¯ç›®å‰å¤šæ€åˆ†é…å™¨ä»æ²¡æœ‰è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸»è¦åŸå› ä¹‹ä¸€å§ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬è®²æˆ‘ä»¬è¯¦ç»†è®²è§£äº†åˆ†é…å™¨è¿™ä¸€æ¦‚å¿µï¼ŒåŒ…æ‹¬æ ‡å‡†å‰çš„ SGI STL åˆ†é…å™¨ã€æ ‡å‡†çš„åˆ†é…å™¨ã€åˆ†é…å™¨ç‰¹å¾å’Œå¤šæ€åˆ†é…å™¨ã€‚è¿™äº›åŠŸèƒ½ä¸€èµ·ä¸ºå†…å­˜ç®¡ç†æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>è¯·é˜…è¯»ä¸€ä¸‹ä½ ä½¿ç”¨çš„ C++ æ ‡å‡†åº“é‡Œçš„åˆ†é…å™¨ç›¸å…³æºç ï¼Œå¹¶è€ƒè™‘ä¸€ä¸‹æ´‹è‘±åŸåˆ™åœ¨ç›¸å…³è®¾è®¡é‡Œçš„ä½“ç°ã€‚æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³åæ§½çš„åœ°æ–¹ï¼Œæ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ã€‚</p><h2><span class=\"reference\">å‚è€ƒèµ„æ–™</span></h2><p><span class=\"reference\">[1] SGI, â€œStandard Template Library programmerâ€™s guideâ€. <a href=\"https://web.archive.org/web/20140805212355/http://www.sgi.com/tech/stl/\">https://web.archive.org/web/20140805212355/http://www.sgi.com/tech/stl/</a> åŸæœ¬å±äº SGI ç½‘ç«™çš„ä¸€éƒ¨åˆ†ï¼Œåå±äºæƒ æ™®åˆ†æ‹†å‡ºæ¥çš„ HPEï¼›HPE åœ¨ 2018 å¹´åˆå®£å¸ƒå°†å…¶ä¸‹çº¿ï¼Œç›®å‰åªèƒ½é€šè¿‡ Internet Archive è®¿é—®â€”â€”åœ¨å›½å†…ç›´æ¥è®¿é—®å¯èƒ½æœ‰é—®é¢˜</span></p><p><span class=\"reference\">[2] cppreference.com, â€œC++ named requirements: Allocatorâ€. <a href=\"https://en.cppreference.com/w/cpp/named_req/Allocator\">https://en.cppreference.com/w/cpp/named_req/Allocator</a></span></p><p><span class=\"reference\">[2a] cppreference.com, â€œC++ å…·åè¦æ±‚ï¼šåˆ†é…å™¨ (Allocator)â€. <a href=\"https://zh.cppreference.com/w/cpp/named_req/Allocator\">https://zh.cppreference.com/w/cpp/named_req/Allocator</a></span></p><p><span class=\"reference\">[3] cppreference.com, â€œstd::pmr::memory_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/memory_resource\">https://en.cppreference.com/w/cpp/memory/memory_resource</a></span></p><p><span class=\"reference\">[3a] cppreference.com, â€œstd::pmr::memory_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/memory_resource\">https://zh.cppreference.com/w/cpp/memory/memory_resource</a></span></p><p><span class=\"reference\">[4] cppreference.com, â€œstd::pmr::polymorphic_allocatorâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/polymorphic_allocator\">https://en.cppreference.com/w/cpp/memory/polymorphic_allocator</a></span></p><p><span class=\"reference\">[4a] cppreference.com, â€œstd::pmr::polymorphic_allocatorâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/polymorphic_allocator\">https://zh.cppreference.com/w/cpp/memory/polymorphic_allocator</a></span></p><p><span class=\"reference\">[5] cppreference.com, â€œstd::pmr::get_default_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/get_default_resource\">https://en.cppreference.com/w/cpp/memory/get_default_resource</a></span></p><p><span class=\"reference\">[5a] cppreference.com, â€œstd::pmr::set_default_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/set_default_resource\">https://zh.cppreference.com/w/cpp/memory/set_default_resource</a></span></p><p><span class=\"reference\">[6] cppreference.com, â€œstd::pmr::set_default_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/set_default_resource\">https://en.cppreference.com/w/cpp/memory/set_default_resource</a></span></p><p><span class=\"reference\">[6a] cppreference.com, â€œstd::pmr::set_default_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/set_default_resource\">https://zh.cppreference.com/w/cpp/memory/set_default_resource</a></span></p><p><span class=\"reference\">[7] cppreference.com, â€œstd::pmr::new_delete_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/new_delete_resource\">https://en.cppreference.com/w/cpp/memory/new_delete_resource</a></span></p><p><span class=\"reference\">[7a] cppreference.com, â€œstd::pmr::new_delete_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/new_delete_resource\">https://zh.cppreference.com/w/cpp/memory/new_delete_resource</a></span></p><p><span class=\"reference\">[8] cppreference.com, â€œstd::pmr::null_memory_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/null_memory_resource\">https://en.cppreference.com/w/cpp/memory/null_memory_resource</a></span></p><p><span class=\"reference\">[8a] cppreference.com, â€œstd::pmr::null_memory_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/null_memory_resource\">https://zh.cppreference.com/w/cpp/memory/null_memory_resource</a></span></p><p><span class=\"reference\">[9] cppreference.com, â€œstd::pmr::synchronized_pool_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/synchronized_pool_resource\">https://en.cppreference.com/w/cpp/memory/synchronized_pool_resource</a></span></p><p><span class=\"reference\">[9a] cppreference.com, â€œstd::pmr::synchronized_pool_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/synchronized_pool_resource\">https://zh.cppreference.com/w/cpp/memory/synchronized_pool_resource</a></span></p><p><span class=\"reference\">[10] cppreference.com, â€œstd::pmr::unsynchronized_pool_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/unsynchronized_pool_resource\">https://en.cppreference.com/w/cpp/memory/unsynchronized_pool_resource</a></span></p><p><span class=\"reference\">[10a] cppreference.com, â€œstd::pmr::unsynchronized_pool_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/unsynchronized_pool_resource\">https://zh.cppreference.com/w/cpp/memory/unsynchronized_pool_resource</a></span></p><p><span class=\"reference\">[11] cppreference.com, â€œstd::pmr::monotonic_buffer_resourceâ€. <a href=\"https://en.cppreference.com/w/cpp/memory/monotonic_buffer_resource\">https://en.cppreference.com/w/cpp/memory/monotonic_buffer_resource</a></span></p><p><span class=\"reference\">[11a] cppreference.com, â€œstd::pmr::monotonic_buffer_resourceâ€. <a href=\"https://zh.cppreference.com/w/cpp/memory/monotonic_buffer_resource\">https://zh.cppreference.com/w/cpp/memory/monotonic_buffer_resource</a></span></p>","comments":[{"had_liked":false,"id":349653,"user_name":"æ˜“è½»å°˜","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1656208553,"is_pvip":false,"replies":[{"id":127280,"content":"ğŸ˜\n\næˆ‘å†™èµ·æ¥ä¹ŸèŠ±äº†æŒºä¹…ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1656302527,"ip_address":"","comment_id":349653,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è¿™ä¸€ç¯‡çœŸæ˜¯å¤ªå¹²äº†ï¼Œè¯»äº†å¥½ä¹…","like_count":3},{"had_liked":false,"id":383874,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1699856199,"is_pvip":false,"replies":[{"id":140075,"content":"æœ‰ç‚¹åƒã€‚ä½†æˆ‘è§‰å¾—æ‹¿å¤šæ€ã€ç»§æ‰¿ã€è™šå‡½æ•°é‚£å¥—æ¥ç†è§£æ›´å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1699941522,"ip_address":"å¹¿ä¸œ","comment_id":383874,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œ polymorphic_allocator ä¸ memory resource çš„å…³ç³»æ„Ÿè§‰å¾ˆåƒæ˜¯pimplè®¾è®¡æ¨¡å¼ï¼Œè€å¸ˆæ‚¨çœ‹æˆ‘è¿™æ ·ç†è§£æ­£ç¡®å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577709,"discussion_content":"ğŸ˜\n\næˆ‘å†™èµ·æ¥ä¹ŸèŠ±äº†æŒºä¹…ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656302528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373690,"user_name":"coming","can_delete":false,"product_type":"c1","uid":1262181,"ip_address":"ä¸Šæµ·","ucode":"7625CE61D9A2D2","user_header":"https://static001.geekbang.org/account/avatar/00/13/42/65/5bfd0a65.jpg","comment_is_top":false,"comment_ctime":1683018065,"is_pvip":false,"replies":[{"id":136582,"content":"éœ€è¦å†™ã€è¯¥å†™çš„æ—¶å€™å†™ï¼ˆå¤§éƒ¨åˆ†äººç¡®å®ä¸éœ€è¦ï¼‰ã€‚æˆ‘åœ¨é¡¹ç›®é‡Œå†™è¿‡å†…å­˜æ± åˆ†é…å™¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1683246412,"ip_address":"ä¸Šæµ·","comment_id":373690,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ´‹è‘±ç†å¿µ, ç”¨å®ƒå°±å¥½, åˆ«å¤šæƒ³, è¦ä¸ä½ ä¼šè¾£çœ¼ç›çš„","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631762,"discussion_content":"æœ‰ç‚¹åƒã€‚ä½†æˆ‘è§‰å¾—æ‹¿å¤šæ€ã€ç»§æ‰¿ã€è™šå‡½æ•°é‚£å¥—æ¥ç†è§£æ›´å¥½ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1699941522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368272,"user_name":"Cafba","can_delete":false,"product_type":"c1","uid":3018755,"ip_address":"ç”˜è‚ƒ","ucode":"29BD3BD7143D41","user_header":"","comment_is_top":false,"comment_ctime":1676088652,"is_pvip":false,"replies":[{"id":134104,"content":"ä¹¦æ˜¯æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†å¥½åƒä¹Ÿæ²¡æœ‰æ›´å¥½çš„ä¹¦å‡ºæ¥ã€‚äº†è§£äº†STLçš„åŸºæœ¬ç†å¿µå’Œæ¨¡æ¿çš„é«˜çº§ç”¨æ³•åï¼ŒSTLä»£ç è¿˜æ˜¯å¯ä»¥çœ‹æ‡‚çš„ã€‚å»ºè®®çœ‹libc++çš„æºç ï¼ˆLLVMé‡Œï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1676179085,"ip_address":"å¹¿ä¸œ","comment_id":368272,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œè¯·é—®ç›®å‰STLæºç ç›¸å…³çš„ä¹¦ç±æœ‰ä»€ä¹ˆæ¨èçš„å—ï¼Œæˆ–è€…è¯´æ‰‹å†™STLå¦‚ä½•å…¥é—¨å‘¢ï¼ŒSTLæºç å‰–æè¿™æœ¬ä¹¦æœ‰äº›è¿‡æ—¶ï¼Œç°åœ¨è¿˜æœ‰å¿…è¦çœ‹å—","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603378,"discussion_content":"ä¹¦æ˜¯æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†å¥½åƒä¹Ÿæ²¡æœ‰æ›´å¥½çš„ä¹¦å‡ºæ¥ã€‚äº†è§£äº†STLçš„åŸºæœ¬ç†å¿µå’Œæ¨¡æ¿çš„é«˜çº§ç”¨æ³•åï¼ŒSTLä»£ç è¿˜æ˜¯å¯ä»¥çœ‹æ‡‚çš„ã€‚å»ºè®®çœ‹libc++çš„æºç ï¼ˆLLVMé‡Œï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676179085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345797,"user_name":"jcy","can_delete":false,"product_type":"c1","uid":1264411,"ip_address":"","ucode":"7C3E10C4E0FA87","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/1b/e3b3bcff.jpg","comment_is_top":false,"comment_ctime":1652601255,"is_pvip":false,"replies":[{"id":126187,"content":"æŠ±æ­‰ï¼Œæˆ‘çœŸçš„è¿˜æ²¡è§è¿‡â€¦â€¦\n\nä½†è‚¯å®šæœ‰å…¬å¸åœ¨ç”¨ç±»ä¼¼çš„ä¸œè¥¿ã€‚è¿™ä¸œè¥¿çš„ææ¡ˆæ–¹æˆ‘è®°å¾—æ˜¯ Bloombergï¼Œä»–ä»¬å°±ç”¨äº†ç±»ä¼¼çš„ä¸œè¥¿ï¼Œè™½ç„¶ä¸æ˜¯æ ‡å‡†åº“çš„è¿™ä¸ªâ€”â€”ä»–ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½æ ‡å‡†åŒ–ä¹‹å‰å°±å·²ç»å®ç°äº†è‡ªå·±çš„å¤šæ€åˆ†é…å™¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1652606693,"ip_address":"","comment_id":345797,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆï¼Œæƒ³äº†è§£ä¸€ä¸‹æœ‰å“ªäº›æœ‰åçš„é¡¹ç›®ä½¿ç”¨äº†å¤šæ€åˆ†é…å™¨ï¼Ÿåœ¨ç›®å‰å·¥ä¸šç•Œä½¿ç”¨æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572118,"discussion_content":"æŠ±æ­‰ï¼Œæˆ‘çœŸçš„è¿˜æ²¡è§è¿‡â€¦â€¦\n\nä½†è‚¯å®šæœ‰å…¬å¸åœ¨ç”¨ç±»ä¼¼çš„ä¸œè¥¿ã€‚è¿™ä¸œè¥¿çš„ææ¡ˆæ–¹æˆ‘è®°å¾—æ˜¯ Bloombergï¼Œä»–ä»¬å°±ç”¨äº†ç±»ä¼¼çš„ä¸œè¥¿ï¼Œè™½ç„¶ä¸æ˜¯æ ‡å‡†åº“çš„è¿™ä¸ªâ€”â€”ä»–ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½æ ‡å‡†åŒ–ä¹‹å‰å°±å·²ç»å®ç°äº†è‡ªå·±çš„å¤šæ€åˆ†é…å™¨äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652606693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343114,"user_name":"ç¦¾æ¡ƒ","can_delete":false,"product_type":"c1","uid":1477855,"ip_address":"","ucode":"9FE85C34A9E9E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/df/77acb793.jpg","comment_is_top":false,"comment_ctime":1650634316,"is_pvip":false,"replies":[{"id":125507,"content":"å…·ä½“å®ç°åˆ°æºç é‡Œé¢æ‰¾ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1651069157,"ip_address":"","comment_id":343114,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"template &lt;typename T,\n            typename... Args&gt;\n  using __has_construct = â€¦;\n\nè¿™ä¸ªçœ‹ä¸Šå»å¥½é…·ï¼Œå¾ˆç¥å¥‡","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568130,"discussion_content":"å…·ä½“å®ç°åˆ°æºç é‡Œé¢æ‰¾ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651069157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338721,"user_name":"Vä¸‡èƒ½çš„å°é»‘V","can_delete":false,"product_type":"c1","uid":2436694,"ip_address":"","ucode":"262051F1B7847A","user_header":"https://static001.geekbang.org/account/avatar/00/25/2e/56/6f38de90.jpg","comment_is_top":false,"comment_ctime":1647684361,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æˆ‘å‘ç°ä¸ä½†å¯ä»¥å’Œè€å¸ˆå­¦æŠ€æœ¯ï¼Œè¿˜èƒ½å­¦è‹±è¯­å“ˆå“ˆå“ˆâ€¦â€¦","like_count":2},{"had_liked":false,"id":337088,"user_name":"é‚µå¹´ç´§æ—¶","can_delete":false,"product_type":"c1","uid":1156097,"ip_address":"","ucode":"608A830659EB93","user_header":"https://static001.geekbang.org/account/avatar/00/11/a4/01/ed3218c4.jpg","comment_is_top":false,"comment_ctime":1646617318,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆçœŸè‰¯å¿ƒã€‚","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568130,"discussion_content":"å…·ä½“å®ç°åˆ°æºç é‡Œé¢æ‰¾ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651069157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349653,"user_name":"æ˜“è½»å°˜","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1656208553,"is_pvip":false,"replies":[{"id":127280,"content":"ğŸ˜\n\næˆ‘å†™èµ·æ¥ä¹ŸèŠ±äº†æŒºä¹…ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1656302527,"ip_address":"","comment_id":349653,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è¿™ä¸€ç¯‡çœŸæ˜¯å¤ªå¹²äº†ï¼Œè¯»äº†å¥½ä¹…","like_count":3,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577709,"discussion_content":"ğŸ˜\n\næˆ‘å†™èµ·æ¥ä¹ŸèŠ±äº†æŒºä¹…ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656302528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383874,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1699856199,"is_pvip":false,"replies":[{"id":140075,"content":"æœ‰ç‚¹åƒã€‚ä½†æˆ‘è§‰å¾—æ‹¿å¤šæ€ã€ç»§æ‰¿ã€è™šå‡½æ•°é‚£å¥—æ¥ç†è§£æ›´å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1699941522,"ip_address":"å¹¿ä¸œ","comment_id":383874,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œ polymorphic_allocator ä¸ memory resource çš„å…³ç³»æ„Ÿè§‰å¾ˆåƒæ˜¯pimplè®¾è®¡æ¨¡å¼ï¼Œè€å¸ˆæ‚¨çœ‹æˆ‘è¿™æ ·ç†è§£æ­£ç¡®å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631762,"discussion_content":"æœ‰ç‚¹åƒã€‚ä½†æˆ‘è§‰å¾—æ‹¿å¤šæ€ã€ç»§æ‰¿ã€è™šå‡½æ•°é‚£å¥—æ¥ç†è§£æ›´å¥½ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1699941522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373690,"user_name":"coming","can_delete":false,"product_type":"c1","uid":1262181,"ip_address":"ä¸Šæµ·","ucode":"7625CE61D9A2D2","user_header":"https://static001.geekbang.org/account/avatar/00/13/42/65/5bfd0a65.jpg","comment_is_top":false,"comment_ctime":1683018065,"is_pvip":false,"replies":[{"id":136582,"content":"éœ€è¦å†™ã€è¯¥å†™çš„æ—¶å€™å†™ï¼ˆå¤§éƒ¨åˆ†äººç¡®å®ä¸éœ€è¦ï¼‰ã€‚æˆ‘åœ¨é¡¹ç›®é‡Œå†™è¿‡å†…å­˜æ± åˆ†é…å™¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1683246412,"ip_address":"ä¸Šæµ·","comment_id":373690,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ´‹è‘±ç†å¿µ, ç”¨å®ƒå°±å¥½, åˆ«å¤šæƒ³, è¦ä¸ä½ ä¼šè¾£çœ¼ç›çš„","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616989,"discussion_content":"éœ€è¦å†™ã€è¯¥å†™çš„æ—¶å€™å†™ï¼ˆå¤§éƒ¨åˆ†äººç¡®å®ä¸éœ€è¦ï¼‰ã€‚æˆ‘åœ¨é¡¹ç›®é‡Œå†™è¿‡å†…å­˜æ± åˆ†é…å™¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683246413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368272,"user_name":"Cafba","can_delete":false,"product_type":"c1","uid":3018755,"ip_address":"ç”˜è‚ƒ","ucode":"29BD3BD7143D41","user_header":"","comment_is_top":false,"comment_ctime":1676088652,"is_pvip":false,"replies":[{"id":134104,"content":"ä¹¦æ˜¯æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†å¥½åƒä¹Ÿæ²¡æœ‰æ›´å¥½çš„ä¹¦å‡ºæ¥ã€‚äº†è§£äº†STLçš„åŸºæœ¬ç†å¿µå’Œæ¨¡æ¿çš„é«˜çº§ç”¨æ³•åï¼ŒSTLä»£ç è¿˜æ˜¯å¯ä»¥çœ‹æ‡‚çš„ã€‚å»ºè®®çœ‹libc++çš„æºç ï¼ˆLLVMé‡Œï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1676179085,"ip_address":"å¹¿ä¸œ","comment_id":368272,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œè¯·é—®ç›®å‰STLæºç ç›¸å…³çš„ä¹¦ç±æœ‰ä»€ä¹ˆæ¨èçš„å—ï¼Œæˆ–è€…è¯´æ‰‹å†™STLå¦‚ä½•å…¥é—¨å‘¢ï¼ŒSTLæºç å‰–æè¿™æœ¬ä¹¦æœ‰äº›è¿‡æ—¶ï¼Œç°åœ¨è¿˜æœ‰å¿…è¦çœ‹å—","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616989,"discussion_content":"éœ€è¦å†™ã€è¯¥å†™çš„æ—¶å€™å†™ï¼ˆå¤§éƒ¨åˆ†äººç¡®å®ä¸éœ€è¦ï¼‰ã€‚æˆ‘åœ¨é¡¹ç›®é‡Œå†™è¿‡å†…å­˜æ± åˆ†é…å™¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683246413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345797,"user_name":"jcy","can_delete":false,"product_type":"c1","uid":1264411,"ip_address":"","ucode":"7C3E10C4E0FA87","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/1b/e3b3bcff.jpg","comment_is_top":false,"comment_ctime":1652601255,"is_pvip":false,"replies":[{"id":126187,"content":"æŠ±æ­‰ï¼Œæˆ‘çœŸçš„è¿˜æ²¡è§è¿‡â€¦â€¦\n\nä½†è‚¯å®šæœ‰å…¬å¸åœ¨ç”¨ç±»ä¼¼çš„ä¸œè¥¿ã€‚è¿™ä¸œè¥¿çš„ææ¡ˆæ–¹æˆ‘è®°å¾—æ˜¯ Bloombergï¼Œä»–ä»¬å°±ç”¨äº†ç±»ä¼¼çš„ä¸œè¥¿ï¼Œè™½ç„¶ä¸æ˜¯æ ‡å‡†åº“çš„è¿™ä¸ªâ€”â€”ä»–ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½æ ‡å‡†åŒ–ä¹‹å‰å°±å·²ç»å®ç°äº†è‡ªå·±çš„å¤šæ€åˆ†é…å™¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1652606693,"ip_address":"","comment_id":345797,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆï¼Œæƒ³äº†è§£ä¸€ä¸‹æœ‰å“ªäº›æœ‰åçš„é¡¹ç›®ä½¿ç”¨äº†å¤šæ€åˆ†é…å™¨ï¼Ÿåœ¨ç›®å‰å·¥ä¸šç•Œä½¿ç”¨æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603378,"discussion_content":"ä¹¦æ˜¯æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†å¥½åƒä¹Ÿæ²¡æœ‰æ›´å¥½çš„ä¹¦å‡ºæ¥ã€‚äº†è§£äº†STLçš„åŸºæœ¬ç†å¿µå’Œæ¨¡æ¿çš„é«˜çº§ç”¨æ³•åï¼ŒSTLä»£ç è¿˜æ˜¯å¯ä»¥çœ‹æ‡‚çš„ã€‚å»ºè®®çœ‹libc++çš„æºç ï¼ˆLLVMé‡Œï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676179085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343114,"user_name":"ç¦¾æ¡ƒ","can_delete":false,"product_type":"c1","uid":1477855,"ip_address":"","ucode":"9FE85C34A9E9E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/df/77acb793.jpg","comment_is_top":false,"comment_ctime":1650634316,"is_pvip":false,"replies":[{"id":125507,"content":"å…·ä½“å®ç°åˆ°æºç é‡Œé¢æ‰¾ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1651069157,"ip_address":"","comment_id":343114,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"template &lt;typename T,\n            typename... Args&gt;\n  using __has_construct = â€¦;\n\nè¿™ä¸ªçœ‹ä¸Šå»å¥½é…·ï¼Œå¾ˆç¥å¥‡","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572118,"discussion_content":"æŠ±æ­‰ï¼Œæˆ‘çœŸçš„è¿˜æ²¡è§è¿‡â€¦â€¦\n\nä½†è‚¯å®šæœ‰å…¬å¸åœ¨ç”¨ç±»ä¼¼çš„ä¸œè¥¿ã€‚è¿™ä¸œè¥¿çš„ææ¡ˆæ–¹æˆ‘è®°å¾—æ˜¯ Bloombergï¼Œä»–ä»¬å°±ç”¨äº†ç±»ä¼¼çš„ä¸œè¥¿ï¼Œè™½ç„¶ä¸æ˜¯æ ‡å‡†åº“çš„è¿™ä¸ªâ€”â€”ä»–ä»¬åœ¨è¿™ä¸ªåŠŸèƒ½æ ‡å‡†åŒ–ä¹‹å‰å°±å·²ç»å®ç°äº†è‡ªå·±çš„å¤šæ€åˆ†é…å™¨äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652606693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338721,"user_name":"Vä¸‡èƒ½çš„å°é»‘V","can_delete":false,"product_type":"c1","uid":2436694,"ip_address":"","ucode":"262051F1B7847A","user_header":"https://static001.geekbang.org/account/avatar/00/25/2e/56/6f38de90.jpg","comment_is_top":false,"comment_ctime":1647684361,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æˆ‘å‘ç°ä¸ä½†å¯ä»¥å’Œè€å¸ˆå­¦æŠ€æœ¯ï¼Œè¿˜èƒ½å­¦è‹±è¯­å“ˆå“ˆå“ˆâ€¦â€¦","like_count":2},{"had_liked":false,"id":337088,"user_name":"é‚µå¹´ç´§æ—¶","can_delete":false,"product_type":"c1","uid":1156097,"ip_address":"","ucode":"608A830659EB93","user_header":"https://static001.geekbang.org/account/avatar/00/11/a4/01/ed3218c4.jpg","comment_is_top":false,"comment_ctime":1646617318,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆçœŸè‰¯å¿ƒã€‚","like_count":1}]}