{"id":105112,"title":"15 | 消费者组到底是什么？","content":"<p>你好，我是胡夕。今天我要和你分享的主题是：Kafka的消费者组。</p><p>消费者组，即Consumer Group，应该算是Kafka比较有亮点的设计了。那么何谓Consumer Group呢？用一句话概括就是：<strong>Consumer Group是Kafka提供的可扩展且具有容错性的消费者机制</strong>。既然是一个组，那么组内必然可以有多个消费者或消费者实例（Consumer Instance），它们共享一个公共的ID，这个ID被称为Group ID。组内的所有消费者协调在一起来消费订阅主题（Subscribed Topics）的所有分区（Partition）。当然，每个分区只能由同一个消费者组内的一个Consumer实例来消费。个人认为，理解Consumer Group记住下面这三个特性就好了。</p><ol>\n<li>Consumer Group下可以有一个或多个Consumer实例。这里的实例可以是一个单独的进程，也可以是同一进程下的线程。在实际场景中，使用进程更为常见一些。</li>\n<li>Group ID是一个字符串，在一个Kafka集群中，它标识唯一的一个Consumer Group。</li>\n<li>Consumer Group下所有实例订阅的主题的单个分区，只能分配给组内的某个Consumer实例消费。这个分区当然也可以被其他的Group消费。</li>\n</ol><!-- [[[read_end]]] --><p>你应该还记得我在专栏<a href=\"https://time.geekbang.org/column/article/98948\">第1期</a>中提到的两种消息引擎模型吧？它们分别是<strong>点对点模型和发布/订阅模型</strong>，前者也称为消费队列。当然，你要注意区分很多架构文章中涉及的消息队列与这里的消息队列。国内很多文章都习惯把消息中间件这类框架统称为消息队列，我在这里不评价这种提法是否准确，只是想提醒你注意这里所说的消息队列，特指经典的消息引擎模型。</p><p>好了，传统的消息引擎模型就是这两大类，它们各有优劣。我们来简单回顾一下。传统的消息队列模型的缺陷在于消息一旦被消费，就会从队列中被删除，而且只能被下游的一个Consumer消费。严格来说，这一点不算是缺陷，只能算是它的一个特性。但很显然，这种模型的伸缩性（scalability）很差，因为下游的多个Consumer都要“抢”这个共享消息队列的消息。发布/订阅模型倒是允许消息被多个Consumer消费，但它的问题也是伸缩性不高，因为每个订阅者都必须要订阅主题的所有分区。这种全量订阅的方式既不灵活，也会影响消息的真实投递效果。</p><p>如果有这么一种机制，既可以避开这两种模型的缺陷，又兼具它们的优点，那就太好了。幸运的是，Kafka的Consumer Group就是这样的机制。当Consumer Group订阅了多个主题后，组内的每个实例不要求一定要订阅主题的所有分区，它只会消费部分分区中的消息。</p><p>Consumer Group之间彼此独立，互不影响，它们能够订阅相同的一组主题而互不干涉。再加上Broker端的消息留存机制，Kafka的Consumer Group完美地规避了上面提到的伸缩性差的问题。可以这么说，<strong>Kafka仅仅使用Consumer Group这一种机制，却同时实现了传统消息引擎系统的两大模型</strong>：如果所有实例都属于同一个Group，那么它实现的就是消息队列模型；如果所有实例分别属于不同的Group，那么它实现的就是发布/订阅模型。</p><p>在了解了Consumer Group以及它的设计亮点之后，你可能会有这样的疑问：在实际使用场景中，我怎么知道一个Group下该有多少个Consumer实例呢？<strong>理想情况下，Consumer实例的数量应该等于该Group订阅主题的分区总数。</strong></p><p>举个简单的例子，假设一个Consumer Group订阅了3个主题，分别是A、B、C，它们的分区数依次是1、2、3（总共是6个分区），那么通常情况下，为该Group设置6个Consumer实例是比较理想的情形，因为它能最大限度地实现高伸缩性。</p><p>你可能会问，我能设置小于或大于6的实例吗？当然可以！如果你有3个实例，那么平均下来每个实例大约消费2个分区（6 / 3 = 2）；如果你设置了8个实例，那么很遗憾，有2个实例（8 – 6 = 2）将不会被分配任何分区，它们永远处于空闲状态。因此，在实际使用过程中一般不推荐设置大于总分区数的Consumer实例。设置多余的实例只会浪费资源，而没有任何好处。</p><p>好了，说完了Consumer Group的设计特性，我们来讨论一个问题：针对Consumer Group，Kafka是怎么管理位移的呢？你还记得吧，消费者在消费的过程中需要记录自己消费了多少数据，即消费位置信息。在Kafka中，这个位置信息有个专门的术语：位移（Offset）。</p><p>看上去该Offset就是一个数值而已，其实对于Consumer Group而言，它是一组KV对，Key是分区，V对应Consumer消费该分区的最新位移。如果用Java来表示的话，你大致可以认为是这样的数据结构，即Map&lt;TopicPartition, Long&gt;，其中TopicPartition表示一个分区，而Long表示位移的类型。当然，我必须承认Kafka源码中并不是这样简单的数据结构，而是要比这个复杂得多，不过这并不会妨碍我们对Group位移的理解。</p><p>我在专栏<a href=\"https://time.geekbang.org/column/article/100285\">第4期</a>中提到过Kafka有新旧客户端API之分，那自然也就有新旧Consumer之分。老版本的Consumer也有消费者组的概念，它和我们目前讨论的Consumer Group在使用感上并没有太多的不同，只是它管理位移的方式和新版本是不一样的。</p><p>老版本的Consumer Group把位移保存在ZooKeeper中。Apache ZooKeeper是一个分布式的协调服务框架，Kafka重度依赖它实现各种各样的协调管理。将位移保存在ZooKeeper外部系统的做法，最显而易见的好处就是减少了Kafka Broker端的状态保存开销。现在比较流行的提法是将服务器节点做成无状态的，这样可以自由地扩缩容，实现超强的伸缩性。Kafka最开始也是基于这样的考虑，才将Consumer Group位移保存在独立于Kafka集群之外的框架中。</p><p>不过，慢慢地人们发现了一个问题，即ZooKeeper这类元框架其实并不适合进行频繁的写更新，而Consumer Group的位移更新却是一个非常频繁的操作。这种大吞吐量的写操作会极大地拖慢ZooKeeper集群的性能，因此Kafka社区渐渐有了这样的共识：将Consumer位移保存在ZooKeeper中是不合适的做法。</p><p>于是，在新版本的Consumer Group中，Kafka社区重新设计了Consumer Group的位移管理方式，采用了将位移保存在Kafka内部主题的方法。这个内部主题就是让人既爱又恨的__consumer_offsets。我会在专栏后面的内容中专门介绍这个神秘的主题。不过，现在你需要记住新版本的Consumer Group将位移保存在Broker端的内部主题中。</p><p>最后，我们来说说Consumer Group端大名鼎鼎的重平衡，也就是所谓的Rebalance过程。我形容其为“大名鼎鼎”，从某种程度上来说其实也是“臭名昭著”，因为有关它的bug真可谓是此起彼伏，从未间断。这里我先卖个关子，后面我会解释它“遭人恨”的地方。我们先来了解一下什么是Rebalance。</p><p><strong>Rebalance本质上是一种协议，规定了一个Consumer Group下的所有Consumer如何达成一致，来分配订阅Topic的每个分区</strong>。比如某个Group下有20个Consumer实例，它订阅了一个具有100个分区的Topic。正常情况下，Kafka平均会为每个Consumer分配5个分区。这个分配的过程就叫Rebalance。</p><p>那么Consumer Group何时进行Rebalance呢？Rebalance的触发条件有3个。</p><ol>\n<li>组成员数发生变更。比如有新的Consumer实例加入组或者离开组，抑或是有Consumer实例崩溃被“踢出”组。</li>\n<li>订阅主题数发生变更。Consumer Group可以使用正则表达式的方式订阅主题，比如consumer.subscribe(Pattern.compile(\"t.*c\"))就表明该Group订阅所有以字母t开头、字母c结尾的主题。在Consumer Group的运行过程中，你新创建了一个满足这样条件的主题，那么该Group就会发生Rebalance。</li>\n<li>订阅主题的分区数发生变更。Kafka当前只能允许增加一个主题的分区数。当分区数增加时，就会触发订阅该主题的所有Group开启Rebalance。</li>\n</ol><p>Rebalance发生时，Group下所有的Consumer实例都会协调在一起共同参与。你可能会问，每个Consumer实例怎么知道应该消费订阅主题的哪些分区呢？这就需要分配策略的协助了。</p><p>当前Kafka默认提供了3种分配策略，每种策略都有一定的优势和劣势，我们今天就不展开讨论了，你只需要记住社区会不断地完善这些策略，保证提供最公平的分配策略，即每个Consumer实例都能够得到较为平均的分区数。比如一个Group内有10个Consumer实例，要消费100个分区，理想的分配策略自然是每个实例平均得到10个分区。这就叫公平的分配策略。如果出现了严重的分配倾斜，势必会出现这种情况：有的实例会“闲死”，而有的实例则会“忙死”。</p><p>我们举个简单的例子来说明一下Consumer Group发生Rebalance的过程。假设目前某个Consumer Group下有两个Consumer，比如A和B，当第三个成员C加入时，Kafka会触发Rebalance，并根据默认的分配策略重新为A、B和C分配分区，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/c0/b3b0a5917b03886d31db027b466200c0.jpg?wh=3605*2018\" alt=\"\"></p><p>显然，Rebalance之后的分配依然是公平的，即每个Consumer实例都获得了2个分区的消费权。这是我们希望出现的情形。</p><p>讲完了Rebalance，现在我来说说它“遭人恨”的地方。</p><p>首先，Rebalance过程对Consumer Group消费过程有极大的影响。如果你了解JVM的垃圾回收机制，你一定听过万物静止的收集方式，即著名的stop the world，简称STW。在STW期间，所有应用线程都会停止工作，表现为整个应用程序僵在那边一动不动。Rebalance过程也和这个类似，在Rebalance过程中，所有Consumer实例都会停止消费，等待Rebalance完成。这是Rebalance为人诟病的一个方面。</p><p>其次，目前Rebalance的设计是所有Consumer实例共同参与，全部重新分配所有分区。其实更高效的做法是尽量减少分配方案的变动。例如实例A之前负责消费分区1、2、3，那么Rebalance之后，如果可能的话，最好还是让实例A继续消费分区1、2、3，而不是被重新分配其他的分区。这样的话，实例A连接这些分区所在Broker的TCP连接就可以继续用，不用重新创建连接其他Broker的Socket资源。</p><p>最后，Rebalance实在是太慢了。曾经，有个国外用户的Group内有几百个Consumer实例，成功Rebalance一次要几个小时！这完全是不能忍受的。最悲剧的是，目前社区对此无能为力，至少现在还没有特别好的解决方案。所谓“本事大不如不摊上”，也许最好的解决方案就是避免Rebalance的发生吧。</p><h2>小结</h2><p>总结一下，今天我跟你分享了Kafka Consumer Group的方方面面，包括它是怎么定义的，它解决了哪些问题，有哪些特性。同时，我们也聊到了Consumer Group的位移管理以及著名的Rebalance过程。希望在你开发Consumer应用时，它们能够助你一臂之力。</p><p><img src=\"https://static001.geekbang.org/resource/image/60/f5/60478ddbf101b19a747d8110ae019ef5.jpg?wh=2069*2569\" alt=\"\"></p><h2>开放讨论</h2><p>今天我貌似说了很多Consumer Group的好话（除了Rebalance），你觉得这种消费者组设计的弊端有哪些呢？</p><p>欢迎写下你的思考和答案，我们一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p>","neighbors":{"left":{"article_title":"14 | 幂等生产者和事务生产者是一回事吗？","id":103974},"right":{"article_title":"16 | 揭开神秘的“位移主题”面纱","id":105473}},"comments":[{"had_liked":false,"id":116676,"user_name":"耿斌","can_delete":false,"product_type":"c1","uid":1237588,"ip_address":"","ucode":"6535D0B012D78E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e2/54/f836054a.jpg","comment_is_top":true,"comment_ctime":1563888902,"is_pvip":false,"replies":[{"id":"42645","content":"感谢纠正：）<br>可以任意指定创建","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563891852,"ip_address":"","comment_id":116676,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720641885e+18","product_id":100029201,"comment_content":"“显然，Rebalance 之后的分配依然是公平的，即每个 Consumer 实例都获得了 3 个分区的消费权。”<br>这里应该是每个Consumer实例都获得了2个分区的消费权<br>有个问题，Consumer group是可以任意指定创建的？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459633,"discussion_content":"感谢纠正：）\n可以任意指定创建","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563891852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2739957,"avatar":"","nickname":"Geek_39299b","note":"","ucode":"908C2FC4DECD33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389436,"discussion_content":"任意时刻创建那岂不是 任意时刻 reblance了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629276579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110921,"user_name":"October","can_delete":false,"product_type":"c1","uid":1137879,"ip_address":"","ucode":"CEDA78F4A5F8B1","user_header":"https://static001.geekbang.org/account/avatar/00/11/5c/d7/e4673fde.jpg","comment_is_top":false,"comment_ctime":1562394889,"is_pvip":false,"replies":[{"id":"40508","content":"如果使用assign，则表明该consumer是独立consumer（standalone consumer），它不属于任何消费者组。独立consumer可以订阅任何分区，彼此之间也没有关系，即两个独立consumer可以订阅并消费相同的分区","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546769,"ip_address":"","comment_id":110921,"utype":1}],"discussion_count":2,"race_medal":0,"score":"276440301833","product_id":100029201,"comment_content":"消费组中的消费者个数如果超过topic的分区数，就会有消费者消费不到数据。但如果是同一个消费组里的两个消费者通过assign方法订阅了同一个TopicPartition，是不是会有一个消费者不能消费到消息？","like_count":65,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457123,"discussion_content":"如果使用assign，则表明该consumer是独立consumer（standalone consumer），它不属于任何消费者组。独立consumer可以订阅任何分区，彼此之间也没有关系，即两个独立consumer可以订阅并消费相同的分区","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193653,"avatar":"https://static001.geekbang.org/account/avatar/00/12/36/b5/0d380faf.jpg","nickname":"Slash","note":"","ucode":"0A22A28794F20B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568591,"discussion_content":"如果是同一个消费组里的两个消费者通过assign方法订阅了同一个TopicPartition,不能说完全没有关系，他们会共用还是同一个OFFSET吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651165072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146941,"user_name":"注定非凡","can_delete":false,"product_type":"c1","uid":1113597,"ip_address":"","ucode":"80673056E131B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/fd/fd/326be9bb.jpg","comment_is_top":false,"comment_ctime":1572709202,"is_pvip":true,"replies":[{"id":"56777","content":"专栏结束了把你的分享笔记share出来吧：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1572769139,"ip_address":"","comment_id":146941,"utype":1}],"discussion_count":4,"race_medal":0,"score":"237795910482","product_id":100029201,"comment_content":"Consumer Group ：Kafka提供的可扩展且具有容错性的消息者机制。<br><br>1，重要特征：<br>\tA：组内可以有多个消费者实例（Consumer Instance）。<br>\tB：消费者组的唯一标识被称为Group ID，组内的消费者共享这个公共的ID。<br>\tC：消费者组订阅主题，主题的每个分区只能被组内的一个消费者消费<br>\tD：消费者组机制，同时实现了消息队列模型和发布&#47;订阅模型。<br><br>2，重要问题：<br>\tA：消费组中的实例与分区的关系：<br>\t\t消费者组中的实例个数，最好与订阅主题的分区数相同，否则多出的实例只会被闲置。一个分区只能被一个消费者实例订阅。<br>\tB：消费者组的位移管理方式：<br>\t\t（1）对于Consumer Group而言，位移是一组KV对，Key是分区，V对应Consumer消费该分区的最新位移。<br>（2）Kafka的老版本消费者组的位移保存在Zookeeper中，好处是Kafka减少了Kafka Broker端状态保存开销。但ZK是一个分布式的协调框架，不适合进行频繁的写更新，这种大吞吐量的写操作极大的拖慢了Zookeeper集群的性能。<br>（3）Kafka的新版本采用了将位移保存在Kafka内部主题的方法。<br>\t<br>\tC：消费者组的重平衡：<br>\t\t（1）重平衡：本质上是一种协议，规定了消费者组下的每个消费者如何达成一致，来分配订阅topic下的每个分区。<br>\t\t（2）触发条件：<br>\t\t\ta，组成员数发生变更<br>\t\t\tb，订阅主题数发生变更<br>\t\t\tc，定阅主题分区数发生变更<br>\t\t（3）影响：<br>\t\t\tRebalance 的设计是要求所有consumer实例共同参与，全部重新分配所有用分区。并且Rebalance的过程比较缓慢，这个过程消息消费会中止。<br>","like_count":55,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473064,"discussion_content":"专栏结束了把你的分享笔记share出来吧：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572769139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1339409,"avatar":"https://static001.geekbang.org/account/avatar/00/14/70/11/42cf8f9d.jpg","nickname":"chenjia","note":"","ucode":"61983C29FF4987","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366868,"discussion_content":"宁就是课代表？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618209357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283866,"discussion_content":"老兄的笔记做的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592385981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1212632,"avatar":"https://static001.geekbang.org/account/avatar/00/12/80/d8/17a5e3ec.jpg","nickname":"花开漫夏","note":"","ucode":"D903EC2D5D5A75","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":174471,"discussion_content":"仁兄，求分享笔记","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581920787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111331,"user_name":"电光火石","can_delete":false,"product_type":"c1","uid":1013160,"ip_address":"","ucode":"3AD33BB4AA940F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/a8/dfe4cade.jpg","comment_is_top":false,"comment_ctime":1562546126,"is_pvip":false,"replies":[{"id":"40519","content":"网络断了，心跳中断，consumer被踢出组，也属于第一种情况","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562547451,"ip_address":"","comment_id":111331,"utype":1}],"discussion_count":3,"race_medal":0,"score":"130411565006","product_id":100029201,"comment_content":"如何避免rebalance发生？我发现线上在没有这三种情况也会发生，我猜是网络瞬断导致的，但不知道kafka是否会发生定时的rebalance？谢谢了","like_count":30,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457308,"discussion_content":"网络断了，心跳中断，consumer被踢出组，也属于第一种情况","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562547451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248076,"discussion_content":"gc 了也会","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587829959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2071279,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/9a/ef/6162b0e0.jpg","nickname":"Rangarok","note":"","ucode":"D13AF6E247EFCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575789,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655107920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119191,"user_name":"张珮磊想静静","can_delete":false,"product_type":"c1","uid":1084732,"ip_address":"","ucode":"2E582ED7BB178E","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/3c/9025c2ca.jpg","comment_is_top":false,"comment_ctime":1564535764,"is_pvip":true,"replies":[{"id":"43868","content":"非常可能存在","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564627765,"ip_address":"","comment_id":119191,"utype":1}],"discussion_count":9,"race_medal":0,"score":"108938718164","product_id":100029201,"comment_content":"会不会存在这样一个情况：一个consumer正在消费一个分区的一条消息，还没有消费完，发生了rebalance(加入了一个consumer)，从而导致这条消息没有消费成功，rebalance后，另一个consumer又把这条消息消费一遍","like_count":25,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460783,"discussion_content":"非常可能存在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564627765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543985,"discussion_content":"太可能出现这种情况了，尤其是结合flink的时候，每次rebalance后，flink作业可能就挂了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641373386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329015,"discussion_content":"单靠kafka 不太可能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606297484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329014,"discussion_content":"这种 消费者业务 肯定是要在幂等的吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606297472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1050508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","nickname":"蚂蚁内推+v","note":"","ucode":"24B10AEE54B3FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84073,"discussion_content":"这种情况下如何解决Consumer端重复消费的问题？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576485695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1160644,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/c4/9148b40d.jpg","nickname":"SunshineBoy","note":"","ucode":"FC54CD1815CCBA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1050508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","nickname":"蚂蚁内推+v","note":"","ucode":"24B10AEE54B3FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211545,"discussion_content":"可以在producer推送时，业务层面对消息增加隐式幂等字段","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1584863218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":84073,"ip_address":""},"score":211545,"extra":""},{"author":{"id":1802337,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/80/61/ae3bb67c.jpg","nickname":"毛毛虫大帝","note":"","ucode":"1EBB026121C060","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160644,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/c4/9148b40d.jpg","nickname":"SunshineBoy","note":"","ucode":"FC54CD1815CCBA","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":337689,"discussion_content":"简单的搞可以自己实现ConsumerRebalanceListener在订阅主题的时候加入，内部实现在rebalance发生的时候保存或者提交当前消费位点，这样rebalance之后可以做相应的位点恢复，比如从保存的位点开始消费或者从上一次rebalance提交的位点继续消费。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1609044724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":211545,"ip_address":""},"score":337689,"extra":""}]},{"author":{"id":1283945,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/69/80945634.jpg","nickname":"罐头瓶子","note":"","ucode":"B14CAA526AB01A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5643,"discussion_content":"请问在这种情况下怎么添加新的consumer?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566399244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1283945,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/69/80945634.jpg","nickname":"罐头瓶子","note":"","ucode":"B14CAA526AB01A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389855,"discussion_content":"new 一个 KafkaConsumer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629451501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5643,"ip_address":""},"score":389855,"extra":""}]}]},{"had_liked":false,"id":163578,"user_name":"东风第一枝","can_delete":false,"product_type":"c1","uid":1402697,"ip_address":"","ucode":"0CD0F62E90DAD8","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/49/864dba17.jpg","comment_is_top":false,"comment_ctime":1576748371,"is_pvip":false,"replies":[{"id":"62278","content":"总结得非常全面了：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576802822,"ip_address":"","comment_id":163578,"utype":1}],"discussion_count":6,"race_medal":0,"score":"104655963475","product_id":100029201,"comment_content":"传统消息引擎的弊端<br><br>传统的消息引擎主要有2种模式：点对点模式 和 发布&#47;订阅模式<br><br>但是不管是点对点模式，还是发布&#47;订阅模式，队列发消息的能力是一定的：即某队列发完积压的所有消息的时间是有上限的，最短的时间是：消息数量*发送单个消息的时间<br><br>并且，传统消息引擎的“弹性”比较差，如果是消息引擎主动推送消息，很有可能会造成消费者端积压了很多的消息，那么，这和消息引擎的初衷“削峰填谷”是相违背的。如果是消费者主动拉取消息，可能造成多个消费者抢一条消息的情况。<br><br>另一个方面是，传统消息队列的容错性比较差。消息发送完成，就从队列移除了，没有办法重新消费。<br><br>Kafka是如何解决的<br><br>Kafka引入了主题，分区，消费者组，消费者，位移的概念，来解决扩展性和容错性问题。<br><br>试想，如果我们要提高传统消息引擎的TPS，在计算机I&#47;O能力一定的情况下，只能通过增加节点的方式，使得多个节点构成一个消息队列。那么对应到Kafka里面，节点就是分区，消息队列就是主题。<br><br>同时引入位移的概念，解决了消费者端消息积压的问题。并且有多个消费者组成消费者组，提高消费能力。这也就解释了，为什么kafka某个主题下的单个分区只能分配给消费者组内的一个消费者。从逻辑上讲，如果分配给同组内的2个消费者，就相当于重复发送了2次消息，这是没有必要的。<br><br>Kafka这么做相当于把原本&quot;串行&quot;的消息发送&quot;并行&quot;化，因此TPS大大提升。<br><br>Kafka的缺点<br><br>缺点主要是Rebalance 过程，耗费的时间巨大，并且目前也没有什么好的解决办法，最好就是尽量减少Rebalance 的过程。<br><br>最后<br><br>也不是说传统消息引擎就该淘汰了，还是得看具体的业务场景。但是在大数据处理方便，Kafka是具有优势的。<br>（不知道理解的对不对，还望老师指正）","like_count":24,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478462,"discussion_content":"总结得非常全面了：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576802822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2455712,"avatar":"https://static001.geekbang.org/account/avatar/00/25/78/a0/7a248ddc.jpg","nickname":"福","note":"","ucode":"F2FC7AF5D433C6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538327,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639398781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2039032,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/1c/f8/7a1fc693.jpg","nickname":"十二万伏特皮卡丘","note":"","ucode":"D12411535B3C5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373441,"discussion_content":"总结的太好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620729320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1503506,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg","nickname":"你为啥那么牛","note":"","ucode":"1ABC604A54A8F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343745,"discussion_content":"有力的补充，送你一朵小红花","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611145852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118111,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","nickname":"见南山","note":"","ucode":"6A8BB82B7573CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283080,"discussion_content":"文中这块我没看透，你讲透了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592178914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1190060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/ac/37a2a265.jpg","nickname":"弱水穿云天","note":"","ucode":"80DC528A23ED7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282586,"discussion_content":"厉害","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592021562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112695,"user_name":"永光","can_delete":false,"product_type":"c1","uid":1102702,"ip_address":"","ucode":"0C54531ABED1B0","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/6e/281b85aa.jpg","comment_is_top":false,"comment_ctime":1562807570,"is_pvip":false,"replies":[{"id":"41134","content":"1. 不会。每个订阅者分配一部分分区消费<br>2. 没有什么规定要求什么场景下需要订阅多个主题。事实上，对于默认的分区策略，一个组订阅多个主题的做法会导致分配的极不均匀，但我们依然还是能够找出一些场景，使得这么做是有意义的。比如消费者组订阅多组传感器的数据，我们不确定未来新增传感器的主题名到底是什么，但可以约定所有传感器的主题名以sensor开头，那么此时让group订阅以sensor开头的所有主题就能动态地检测后续新增的主题。这个场景是不是有意义些？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562893335,"ip_address":"","comment_id":112695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"104642022674","product_id":100029201,"comment_content":"发布 &#47; 订阅模型倒是允许消息被多个 Consumer 消费，但它的问题也是伸缩性不高，因为每个订阅者都必须要订阅主题的所有分区。这种全量订阅的方式既不灵活，也会影响消息的真实投递效果。<br>问题：<br>1、每个订阅者都必须要订阅主题的所有分区，是否意味着每个订阅者都需要消费所有的分区的所有消息？<br>2、我理解一个主题下进行分区消费就可以满足日需求了，Consumer Group为什么设计成可以订阅多个主题，什么样的场景会使订阅多个主题？<br>谢谢。","like_count":24,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457861,"discussion_content":"1. 不会。每个订阅者分配一部分分区消费\n2. 没有什么规定要求什么场景下需要订阅多个主题。事实上，对于默认的分区策略，一个组订阅多个主题的做法会导致分配的极不均匀，但我们依然还是能够找出一些场景，使得这么做是有意义的。比如消费者组订阅多组传感器的数据，我们不确定未来新增传感器的主题名到底是什么，但可以约定所有传感器的主题名以sensor开头，那么此时让group订阅以sensor开头的所有主题就能动态地检测后续新增的主题。这个场景是不是有意义些？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562893335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121224,"user_name":"DC","can_delete":false,"product_type":"c1","uid":1250344,"ip_address":"","ucode":"EC0E7E86056FA6","user_header":"https://static001.geekbang.org/account/avatar/00/13/14/28/9e3edef0.jpg","comment_is_top":false,"comment_ctime":1565080511,"is_pvip":false,"replies":[{"id":"44620","content":"社区2.3引入了static consumer，这样consumer程序正常的停机重启不会rebalance，值得一试：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565138563,"ip_address":"","comment_id":121224,"utype":1}],"discussion_count":2,"race_medal":0,"score":"65989589951","product_id":100029201,"comment_content":"Rebalance无法避免，又很慢，如果只是站在使用者的角度看的话，那这kafka怎么感觉很不行啊，在考虑技术栈的时候难道放弃它？","like_count":15,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461690,"discussion_content":"社区2.3引入了static consumer，这样consumer程序正常的停机重启不会rebalance，值得一试：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565138563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1231713,"avatar":"https://static001.geekbang.org/account/avatar/00/12/cb/61/b62d8a3b.jpg","nickname":"张立华","note":"","ucode":"173B938DD9478A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557711,"discussion_content":"静态消费者 go的sarama 暂时不支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647938818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112154,"user_name":"末北。","can_delete":false,"product_type":"c1","uid":1246109,"ip_address":"","ucode":"6C6C06416E77D3","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/9d/a245af6a.jpg","comment_is_top":false,"comment_ctime":1562675849,"is_pvip":false,"replies":[{"id":"40835","content":"rebalance时会回收所有consumer负责的分区，也就是所谓的revoked。查一下为什么会频繁地出现rebalance吧","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562721196,"ip_address":"","comment_id":112154,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53102283401","product_id":100029201,"comment_content":"老师请问我的程序经常出现partitions revoked:这种会是什么原因导致的那","like_count":12,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457601,"discussion_content":"rebalance时会回收所有consumer负责的分区，也就是所谓的revoked。查一下为什么会频繁地出现rebalance吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562721196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112104,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1562670054,"is_pvip":false,"replies":[{"id":"40840","content":"好好设置max.poll.interval.ms的值。实在不行可以尝试使用standalone consumer","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562721654,"ip_address":"","comment_id":112104,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53102277606","product_id":100029201,"comment_content":"请问老师有啥好办法避免发生rebalance呢？感觉热rebalance的触发条件很容易发生啊，消费者组中的一台服务器出问题不就rebalance了，那整个组不可用了不是变相的把问题扩大化了吗？","like_count":13,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457578,"discussion_content":"好好设置max.poll.interval.ms的值。实在不行可以尝试使用standalone consumer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562721654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111380,"user_name":"曹操","can_delete":false,"product_type":"c1","uid":1104259,"ip_address":"","ucode":"CCE34BD1C054DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/83/7c3ba3dc.jpg","comment_is_top":false,"comment_ctime":1562549330,"is_pvip":false,"replies":[{"id":"40697","content":"有，KafkaConsumer有offsetsForTimes方法","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562637291,"ip_address":"","comment_id":111380,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48807189586","product_id":100029201,"comment_content":"请问一下老师，kafka有基于时间戳的消费方式吗？比如我想从某个时间点之后投入kafka的数据开始消费？","like_count":11,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457326,"discussion_content":"有，KafkaConsumer有offsetsForTimes方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562637291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50134,"discussion_content":"马克. 好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573663214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215596,"user_name":"Geek_81eb3d","can_delete":false,"product_type":"c1","uid":1994558,"ip_address":"","ucode":"3C92E7DB24E6B7","user_header":"","comment_is_top":false,"comment_ctime":1589028351,"is_pvip":false,"replies":[{"id":"79802","content":"嗯嗯，社区一直在改进这个rebalance。要么你可以使用standalone consumer，要么可以采用2.4版本的consumer group，支持静态成员","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589035680,"ip_address":"","comment_id":215596,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40243734015","product_id":100029201,"comment_content":"感觉rebalance的触发条件2和3都可以通过早期设定的方式避免，关键是条件1，没法避免呀。比如我有多台生产服务器（同个消费组），我发布的时候怎么弄？发布总有先后，难道我发布也影响整个消息服务？那影响也太大了，怎么敢投产，求解。","like_count":9,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494489,"discussion_content":"嗯嗯，社区一直在改进这个rebalance。要么你可以使用standalone consumer，要么可以采用2.4版本的consumer group，支持静态成员","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589035680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110902,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1562385588,"is_pvip":false,"replies":[{"id":"40510","content":"专栏后面有专门的内容：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546856,"ip_address":"","comment_id":110902,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40217091252","product_id":100029201,"comment_content":"请老师讲讲手动管理consumer offset的工程实践","like_count":9,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457116,"discussion_content":"专栏后面有专门的内容：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181241,"user_name":"HZ","can_delete":false,"product_type":"c1","uid":1371862,"ip_address":"","ucode":"883D79CEEA9C66","user_header":"https://static001.geekbang.org/account/avatar/00/14/ee/d6/0142c3a3.jpg","comment_is_top":false,"comment_ctime":1582524861,"is_pvip":false,"replies":[{"id":"70340","content":"1. 目前只要group新增consumer实例就会触发rebalance，和consumer订阅什么分区无关<br>2. 移除idle consumer也会触发","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1582593490,"ip_address":"","comment_id":181241,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35942263229","product_id":100029201,"comment_content":"老师，以下两种情况会出发重平衡吗？ 1. 每个consumer只有一个分区，然后我们新增一个consumer。 2. 假如consumer group里面 有几个idle的consumer，移除这些idle consumer。","like_count":8,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484972,"discussion_content":"1. 目前只要group新增consumer实例就会触发rebalance，和consumer订阅什么分区无关\n2. 移除idle consumer也会触发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582593490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329020,"discussion_content":"新增的应该是不分配分区吧！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606297930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389856,"discussion_content":"不 rebalance 一下，Kafka 怎么死心呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629451833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":329020,"ip_address":""},"score":389856,"extra":""}]}]},{"had_liked":false,"id":169947,"user_name":"芒果","can_delete":false,"product_type":"c1","uid":1124278,"ip_address":"","ucode":"5AD71E7F9FC738","user_header":"https://static001.geekbang.org/account/avatar/00/11/27/b6/e53c17ee.jpg","comment_is_top":false,"comment_ctime":1578480135,"is_pvip":false,"replies":[{"id":"66078","content":"会的。目前rebalance（2.4, 2.5版本之前）是stop-the-world操作，rebalance期间暂停所有consumer消费","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1578619261,"ip_address":"","comment_id":169947,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31643251207","product_id":100029201,"comment_content":"您好，请问如果一开始通过正则订阅了topic.*，找到了topic01，后来新增了一个topic02，触发了rebalance，topic01并没有变化，消费者数量也不变，rebalance期间也会导致消费者在topic01上的消费全部停止吗？","like_count":7,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480780,"discussion_content":"会的。目前rebalance（2.4, 2.5版本之前）是stop-the-world操作，rebalance期间暂停所有consumer消费","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578619261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103208,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d5/68/2201b6b9.jpg","nickname":"归零","note":"","ucode":"C99B8E93009A46","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336443,"discussion_content":"kafka的这样子操作还是挺奇怪的，影响了topic01的正常运行\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608597779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110986,"user_name":"东方奇骥","can_delete":false,"product_type":"c1","uid":1354850,"ip_address":"","ucode":"DEE7085F7E55A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/62/37912d51.jpg","comment_is_top":false,"comment_ctime":1562411218,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"31627182290","product_id":100029201,"comment_content":"难得一个双休，今天终于学习到这篇了，好想实战上手玩一玩Kafka。老师，最后一个章节才会有实战Demo吗？","like_count":7,"discussions":[{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":268702,"discussion_content":"官网有..","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589813885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110830,"user_name":"nightmare","can_delete":false,"product_type":"c1","uid":1056314,"ip_address":"","ucode":"EF2E51C2122A86","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg","comment_is_top":false,"comment_ctime":1562369637,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31627140709","product_id":100029201,"comment_content":"什么时候来个consumer端手动管理offset的方案","like_count":7,"discussions":[{"author":{"id":1502074,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKb5BzdGZbSYHxq88kicdDtBh0yBtJpDAD81wruIsTsLdBysDZztrm8tYb4mBYvAI1ZE4lorKuvmgw/132","nickname":"java_lunsong","note":"","ucode":"180EEE6C8BCAA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3996,"discussion_content":"可以通过consumer.seek方法手动管理，将位移存储在第三方 如db啥的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1565053090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303757,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e4/cd/fc140973.jpg","nickname":"小徐","note":"","ucode":"522B5CD3732313","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1242,"discussion_content":"这个想法不错，否则消费就没有办法二次消费","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562461547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205446,"user_name":"阿刚","can_delete":false,"product_type":"c1","uid":1351518,"ip_address":"","ucode":"9FB7F9759BEAD5","user_header":"https://static001.geekbang.org/account/avatar/00/14/9f/5e/4f7ab1de.jpg","comment_is_top":false,"comment_ctime":1586619159,"is_pvip":false,"replies":[{"id":"76937","content":"嗯，300+个consumer都会重平衡。。。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1586764242,"ip_address":"","comment_id":205446,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27356422935","product_id":100029201,"comment_content":"老师，我遇到一个生产上的问题：一个消费组(大概有300多个消费者)订阅了3个topic，如topic1 ,tipic2，topic3 ， 增加一个topic4，然后在这个消费组里面增加消费者来消费topic4的数据。<br>问题：是整个消费组发生重平衡吗？还是只是订阅topic4的消费者发生重平衡？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491484,"discussion_content":"嗯，300+个consumer都会重平衡。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586764242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143523,"user_name":"maben996","can_delete":false,"product_type":"c1","uid":1705386,"ip_address":"","ucode":"95390116090D23","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/usX58SweWDFqjCmtkvPOWIfjqN2GqydQYqW53bIcFI4DGBmp6O2LZxZL1UYsVPRuEP03dEJcK3d9jHdYZVn8ug/132","comment_is_top":false,"comment_ctime":1571724596,"is_pvip":false,"replies":[{"id":"55480","content":"可以的。虽然在实际使用中可能更多的还是同一个group的多个实例订阅相同的topic。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1571791880,"ip_address":"","comment_id":143523,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27341528372","product_id":100029201,"comment_content":"文中提到，同一个Group中的不同Consumer实例负责消费Topic的不同分区。<br>有一个问题，同一个Group中的不同Consumer实例可以订阅不同的Topic吗？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471576,"discussion_content":"可以的。虽然在实际使用中可能更多的还是同一个group的多个实例订阅相同的topic。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571791880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182802,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","nickname":"长脖子树","note":"","ucode":"D9090EF67EEB1B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287568,"discussion_content":"从下面这个回答看起来, 同一个consumer group 中的消费者订阅不同主题, 可能无法消费到这个 consumer 没有订阅的主题, 导致某个 consumer 挂掉之后, 有些消息无法消费\nConsumers with the same group name subscribed to different topics \nwill NOT consume messages from other topics, because the key is (topic, group)\n参考:\nhttps://stackoverflow.com/questions/57753211/kafka-use-common-consumer-group-to-access-multiple-topics","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593483329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1016599,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/83/17/74c6e081.jpg","nickname":"cocos","note":"","ucode":"6DCA74033FFBEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282277,"discussion_content":"同一个Group中的不同Consumer实例订阅不同的Topic，这样会导致消息丢失吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591934923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112356,"user_name":"末北。","can_delete":false,"product_type":"c1","uid":1246109,"ip_address":"","ucode":"6C6C06416E77D3","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/9d/a245af6a.jpg","comment_is_top":false,"comment_ctime":1562723090,"is_pvip":false,"replies":[{"id":"40868","content":"重平衡是指consumer group级别的，不是主题级别的。Rebalance时所有consumer都不能消费，等结束后才能继续消费","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562725405,"ip_address":"","comment_id":112356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27332526866","product_id":100029201,"comment_content":"老师你好，如果一个topic的consumer产生变化，那么进行重平衡的时候，只是这一个topic发生重平衡还是所有topic都会发生重平衡，这时候所有的消息都不能消费是吗？等重平衡结束才能再次消费吗？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457696,"discussion_content":"重平衡是指consumer group级别的，不是主题级别的。Rebalance时所有consumer都不能消费，等结束后才能继续消费","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562725405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110884,"user_name":"QQ怪","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1562383593,"is_pvip":false,"replies":[{"id":"40512","content":"嗯嗯，不就是每个consumer分配两个吗？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562547007,"ip_address":"","comment_id":110884,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27332187369","product_id":100029201,"comment_content":"老师最后那个Rebalance例子有问题吧，最后每个consumer只有两个而不是三个吧","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457110,"discussion_content":"嗯嗯，不就是每个consumer分配两个吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562547007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013283,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","nickname":"空知","note":"","ucode":"C448E98238DD36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1407,"discussion_content":"Rebalance 之后的分配依然是公平的，即每个 Consumer 实例都获得了 3 个分区的消费权。这是我们希望出现的情形     \n是这句话吧, 重分配之后 应该是每个实例获取2个分区的消费权","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562600922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1231549,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","nickname":"吃饭饭","note":"","ucode":"95CFA07CDA2957","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1205,"discussion_content":"我也感觉有问题，作者大大解答一波","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562402469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110878,"user_name":"骨汤鸡蛋面","can_delete":false,"product_type":"c1","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1562382724,"is_pvip":true,"replies":[{"id":"40514","content":"嗯，会的。减少consumer个数也有缩短rebalance。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562547143,"ip_address":"","comment_id":110878,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27332186500","product_id":100029201,"comment_content":"我们现在服务是3个topic，每个topic有64个分区，6个消费实例，每次服务重新部署（6个实例依次关闭启动）都会导致长时间的rebalance，是否减少topic的分区数可以减少服务部署时rebalance的时间呢？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457106,"discussion_content":"嗯，会的。减少consumer个数也有缩短rebalance。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562547143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544005,"discussion_content":"分区数是减少不了的，但你如果每个topic有64个分区说明至少高峰时流量特别大，个人认为就是先将所有服务全部停止（可以优雅停）后再一起启动，这样rebalance会比一个启动完成后再启动下一个要快很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641379003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153181,"user_name":"man1s","can_delete":false,"product_type":"c1","uid":1466953,"ip_address":"","ucode":"FFDB6B52F65A1B","user_header":"https://static001.geekbang.org/account/avatar/00/16/62/49/6332c99b.jpg","comment_is_top":false,"comment_ctime":1574175406,"is_pvip":false,"replies":[{"id":"58852","content":"目前不会","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1574210878,"ip_address":"","comment_id":153181,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23049011886","product_id":100029201,"comment_content":"那我如果有100个分区，100个同组消费者，在启动这100个消费者过程中会发生100次rebalace吗","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475073,"discussion_content":"目前不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574210878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544006,"discussion_content":"虽然不会100次，但你100个消费者肯定有先后顺序启动，估计rebalance时间也不会短","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641379106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329031,"discussion_content":"猜猜我是谁？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606300278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140794,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1043558,"ip_address":"","ucode":"96D4716E5E6C66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/66/0eab4211.jpg","comment_is_top":false,"comment_ctime":1571049920,"is_pvip":false,"replies":[{"id":"54552","content":"如果你没有实现ConsumerRebalanceListener接口中的方法显式从MySQL中恢复offset，那么rebalance回来后会从Broker中读取Kafka这边保存的已知的最新位移，但很可能不是你MySQL中保存的位移，因此此时调用commitSync没有什么效果。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1571104854,"ip_address":"","comment_id":140794,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23045886400","product_id":100029201,"comment_content":"胡老师好，有一个rebalance的问题请教一下：<br>假设一个topic有P1和P2两个分区， 由同一消费者组中的C1和C2消费， C1消费P1, C2消费P2。<br>C1和C2都是手动管理offset的，消息消费后，会将offset保存到mysql中，然后commit到broker<br>某一时刻，C1 offset到100 消费完成后保存mysql, 但是没有调用commitSync()<br>C2 offset到200, 消费完成后保存offset到mysql,  但是没有调用commitSync()<br>然后发生了rebalance， rebalance后，C1分配到P2分区，C2分配到P1分区。<br>之后，C1和C2调用commitSync(), （其实是commit rebalance前的分区的offset）,会发生什么情况？<br>","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470562,"discussion_content":"如果你没有实现ConsumerRebalanceListener接口中的方法显式从MySQL中恢复offset，那么rebalance回来后会从Broker中读取Kafka这边保存的已知的最新位移，但很可能不是你MySQL中保存的位移，因此此时调用commitSync没有什么效果。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571104854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"夏天","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534063,"discussion_content":"肯定有问题，consumer 为什么不绑定分区消费来避免这个问题？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638086078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"夏天","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":544008,"discussion_content":"对于可动态扩容消费者实例来说，你们是怎么绑定分区的？我们在docker上的应用实例每次重启都是一个新的pod，没法对于单个实例来设置分区号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641379268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":534063,"ip_address":""},"score":544008,"extra":""}]}]},{"had_liked":false,"id":112106,"user_name":"玉剑冰锋","can_delete":false,"product_type":"c1","uid":1214202,"ip_address":"","ucode":"8EA56A71BA5B22","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg","comment_is_top":false,"comment_ctime":1562670224,"is_pvip":false,"replies":[{"id":"40839","content":"1. 几乎没办法。。。。<br>2. 失败原因只能看日志，通常都是因为topic被删除了或有分区不可用导致的。该命令提供了throttle来限速，可以一用。我们在实际生产环境中也用了这个来限制贷款","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562721602,"ip_address":"","comment_id":112106,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23037506704","product_id":100029201,"comment_content":"请教老师两个问题1.关于删除topic，由于采集端使用filebeat(线上几百台)，现在发现topic异常，我想删除重新创建，由于filebeat不停地在写入数据，删除后立刻创建出来导致无法删除，想问一下如果我不停止filebeat有没有其他办法彻底删除;2.关于在线迁移或者添加副本，使用kafka-reassign-partitions.sh添加topic副本，分区数据量很小，持续好几天了一直还有in progress，这是什么原因导致的，另外通过什么参数可以调整迁移速率，谢谢","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457579,"discussion_content":"1. 几乎没办法。。。。\n2. 失败原因只能看日志，通常都是因为topic被删除了或有分区不可用导致的。该命令提供了throttle来限速，可以一用。我们在实际生产环境中也用了这个来限制贷款","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562721602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"凯文小猪","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398049,"discussion_content":"对于1来说kafka本身是解决不了 但不代表这个问题本身处理不了。比方说用nginx截获这段时间内的消息往其他topic暂存 等处理完了再恢复之前配置。而日志因为本身是带着时间戳的 所以不存在一定要按照逻辑上的时间语义消费。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632724152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111721,"user_name":"济沧海","can_delete":false,"product_type":"c1","uid":1179960,"ip_address":"","ucode":"DB1D3B27043B37","user_header":"https://static001.geekbang.org/account/avatar/00/12/01/38/04aae3fc.jpg","comment_is_top":false,"comment_ctime":1562590040,"is_pvip":false,"replies":[{"id":"40690","content":"可以删除。使用kafka-consumer-groups命令","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562635663,"ip_address":"","comment_id":111721,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23037426520","product_id":100029201,"comment_content":"想请问一下consumer group可以删除吗？或者有其他命令管理吗？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457426,"discussion_content":"可以删除。使用kafka-consumer-groups命令","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562635663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201041,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1168663,"ip_address":"","ucode":"F0A9B06219D5CD","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/17/6efa2501.jpg","comment_is_top":false,"comment_ctime":1585708713,"is_pvip":false,"replies":[{"id":"75364","content":"先查看一下consumer数与分区数的关系。如果consumer数&gt;分区数可能出现这种情况，第二就是更换一下分区策略。有些极端情况下会出现分区分配的严重倾斜，使得某些consumer拿不到分区","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1585792645,"ip_address":"","comment_id":201041,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18765577897","product_id":100029201,"comment_content":"消费者启动后有时候分配不到消费分区有时候能分配到，分配不到到时候日志显示partitions assigned:[],有同学处理过这种问题吗？github也搜不到答案。","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490221,"discussion_content":"先查看一下consumer数与分区数的关系。如果consumer数&amp;gt;分区数可能出现这种情况，第二就是更换一下分区策略。有些极端情况下会出现分区分配的严重倾斜，使得某些consumer拿不到分区","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585792645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168663,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d5/17/6efa2501.jpg","nickname":"Ryan","note":"","ucode":"F0A9B06219D5CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326845,"discussion_content":"按照提供的思路找到问题了，感谢。topic只有一个分区，在DEV、ST、UAT环境各布置了一个消费者实例，这点被忽略掉了，本地环境启动的时候就很难重平衡被分配到分区。consumer数为4，分区数为1，总有三个消费者是分配不到分区的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605687344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184058,"user_name":"狼暴暴","can_delete":false,"product_type":"c1","uid":1401191,"ip_address":"","ucode":"B7B4DE5C532A76","user_header":"https://static001.geekbang.org/account/avatar/00/15/61/67/c4ceb86f.jpg","comment_is_top":false,"comment_ctime":1583214970,"is_pvip":false,"replies":[{"id":"71294","content":"如果A提交了位移，那么rebalance过后B从A提交的位移处继续消费。如果A没有提交过位移，那么视consumer端参数auto.offset.reset值而定","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1583281918,"ip_address":"","comment_id":184058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18763084154","product_id":100029201,"comment_content":"开始分区1被消费者A消费，rebalance 后被消费者B消费，那么消费者B是对分区从头开始消费还是继承消费者A的位移继续消费？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485871,"discussion_content":"如果A提交了位移，那么rebalance过后B从A提交的位移处继续消费。如果A没有提交过位移，那么视consumer端参数auto.offset.reset值而定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583281918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169249,"user_name":"vivi","can_delete":false,"product_type":"c1","uid":1632728,"ip_address":"","ucode":"1A02D8396F538B","user_header":"https://static001.geekbang.org/account/avatar/00/18/e9/d8/026493cc.jpg","comment_is_top":false,"comment_ctime":1578300977,"is_pvip":true,"replies":[{"id":"65687","content":"Coordinator不可用不会引发rebalance。这个异常也不一定就表示Coordinator真的不可用了。或者说可能表示consumer自己连不上Coordinator而已，如果是后者，则可能引发rebalance","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1578358924,"ip_address":"","comment_id":169249,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18758170161","product_id":100029201,"comment_content":"胡老师，今天我们在线上发现这样一个日志Group coordinator xxx is unavailable or invalid, will attempt rediscovery  随后出现rebalance  协调者不可用和rebalance有必然联系吗?希望老师能抽时间解答一下 谢谢老师","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480480,"discussion_content":"Coordinator不可用不会引发rebalance。这个异常也不一定就表示Coordinator真的不可用了。或者说可能表示consumer自己连不上Coordinator而已，如果是后者，则可能引发rebalance","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578358924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157153,"user_name":"愚人","can_delete":false,"product_type":"c1","uid":1355952,"ip_address":"","ucode":"40DE41849EF9EA","user_header":"https://static001.geekbang.org/account/avatar/00/14/b0/b0/30b29949.jpg","comment_is_top":false,"comment_ctime":1575043207,"is_pvip":false,"replies":[{"id":"60320","content":"不会的。分配的原则还是要考虑每个consumer的订阅情况。不可能把你没订阅的分区分给你","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1575112496,"ip_address":"","comment_id":157153,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18754912391","product_id":100029201,"comment_content":"订阅topic是在消费者程序中实现的，如果一个group内多个消费者分别订阅了不同的topic，是不是所有这些topic下的全部分区都会统一分配这个group内的消费者？比如group内消费者A只订阅topic1，但是topic2（被另一个消费者订阅）下的某一个分区却分配给了消费者A？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476342,"discussion_content":"不会的。分配的原则还是要考虑每个consumer的订阅情况。不可能把你没订阅的分区分给你","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575112496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117011,"user_name":"老鱼","can_delete":false,"product_type":"c1","uid":1221974,"ip_address":"","ucode":"2C873D9E34CB00","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/56/d1f70c0d.jpg","comment_is_top":false,"comment_ctime":1563954423,"is_pvip":false,"replies":[{"id":"42899","content":"是个不错的思路：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564015681,"ip_address":"","comment_id":117011,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18743823607","product_id":100029201,"comment_content":"rebalance时，全部实例都要参与重新分配。是否能参考  一致性哈希算法，尽量减少对全局的影响？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459777,"discussion_content":"是个不错的思路：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564015681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447741,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","nickname":"zhoufeng","note":"","ucode":"6F92F7866F9EB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279490,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591354911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111412,"user_name":"Xiao","can_delete":false,"product_type":"c1","uid":1179212,"ip_address":"","ucode":"71FFCCEEDE09E1","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/4c/46eb517a.jpg","comment_is_top":false,"comment_ctime":1562554369,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"18742423553","product_id":100029201,"comment_content":"老师，rebalance的时候可以不可以这样做，如果是consumer挂掉导致，那不做group的rebalance，仅仅是将挂掉节点上的partition重新分配给别的consume让，只有在consumer消费特别不均匀的情况下才做group的rebalance；<br>如果是添加节点导致rebalance，那也不用一次性就做，可以分阶段，比如说先把消费压力大的consumer上的partition分一部分给新进来的consumer！","like_count":4,"discussions":[{"author":{"id":1283945,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/69/80945634.jpg","nickname":"罐头瓶子","note":"","ucode":"B14CAA526AB01A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5644,"discussion_content":"这个思路很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566399633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111124,"user_name":"☆appleう","can_delete":false,"product_type":"c1","uid":1101071,"ip_address":"","ucode":"54F4A73057E02A","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/0f/fa810f69.jpg","comment_is_top":false,"comment_ctime":1562483496,"is_pvip":false,"replies":[{"id":"40500","content":"如果它们都属于同一个消费者组，那么不能。消费者组订阅的分区只能被组内一个consumer实例消费。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546166,"ip_address":"","comment_id":111124,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18742352680","product_id":100029201,"comment_content":"举个简单的例子，假设一个 Consumer Group 订阅了 3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3，那么通常情况下，为该 Group 设置 6 个 Consumer 实例是比较理想的情形，因为它能最大限度地实现高伸缩性。<br><br>你可能会问，我能设置小于或大于 6 的实例吗？当然可以！如果你有 3 个实例，那么平均下来每个实例大约消费 2 个分区（6 &#47; 3 = 2）；如果你设置了 8 个实例，那么很遗憾，有 2 个实例（8 – 6 = 2）将不会被分配任何分区，它们永远处于空闲状态。因此，在实际使用过程中一般不推荐设置大于总分区数的 Consumer 实例。设置多余的实例只会浪费资源，而没有任何好处。<br><br><br>老师，针对上面这段例子有一个问题: 如果8个实例，6个分区，每个实例负责分配一个分区，多出来的2个实例不能与其他消费实例共同负责一个分区吗？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457239,"discussion_content":"如果它们都属于同一个消费者组，那么不能。消费者组订阅的分区只能被组内一个consumer实例消费。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329025,"discussion_content":"那不就重复消费了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606298701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447741,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","nickname":"zhoufeng","note":"","ucode":"6F92F7866F9EB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279486,"discussion_content":"同一个消费者组的多个实例消费同一个分区，会造成重复读取。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591354052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214202,"user_name":"wang","can_delete":false,"product_type":"c1","uid":1270262,"ip_address":"","ucode":"C1A3BCACCB188E","user_header":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","comment_is_top":false,"comment_ctime":1588675779,"is_pvip":false,"replies":[{"id":"79339","content":"clientId是客户端程序为了区分其他客户端程序所用的一个标识，无实际意义，仅仅用于区分consumer之用。<br>memberId是消费者在broker端生成的一个标记，为kafka broker所用，用户无法控制memberId的生成。<br>groupId是消费者组的Id，这个是用户必须指定的字段","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1588724792,"ip_address":"","comment_id":214202,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14473577667","product_id":100029201,"comment_content":"我其实想问 一个对于go 连接kafka consumer 端的一个问题：<br>groupId ， clientId ， memberId 是什么关系啊？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493982,"discussion_content":"clientId是客户端程序为了区分其他客户端程序所用的一个标识，无实际意义，仅仅用于区分consumer之用。\nmemberId是消费者在broker端生成的一个标记，为kafka broker所用，用户无法控制memberId的生成。\ngroupId是消费者组的Id，这个是用户必须指定的字段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588724792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179988,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1582157346,"is_pvip":true,"replies":[{"id":"70005","content":"你只能启动消费者实例，group同名的消费者自动构成一个消费者组。所以，该消费者组会订阅A&#47;B&#47;C三个主题，前面启动的消费者是可能消费C主题的。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1582247604,"ip_address":"","comment_id":179988,"utype":1}],"discussion_count":2,"race_medal":2,"score":"14467059234","product_id":100029201,"comment_content":"想问下老师，比如有个消费者组，订阅了 A，B 两个主题；之后我又启动了同名的消费者组，订阅了 A、B、C 三个主题。<br>此时对于这个消费者组来说，会发生什么情况呢？是订阅了 A、B、C 三个消费者么，前一个启动的消费者组（只订阅 A、B），在重平衡的时候有可能受到 C 主题的消息么？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484480,"discussion_content":"你只能启动消费者实例，group同名的消费者自动构成一个消费者组。所以，该消费者组会订阅A/B/C三个主题，前面启动的消费者是可能消费C主题的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582247604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389868,"discussion_content":"先去用一下 API，你就知道你这种想法，根本不存在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629455573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151202,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1573665261,"is_pvip":false,"replies":[{"id":"58196","content":"可能出现gc导致rebalance的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573694587,"ip_address":"","comment_id":151202,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14458567149","product_id":100029201,"comment_content":"请问下老师,单消费实例在gc下会出现重平衡吗.<br>还是因为重平衡导致gc出现","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474396,"discussion_content":"可能出现gc导致rebalance的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573694587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50280,"discussion_content":"好的，谢谢老师回答。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573698826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150501,"user_name":"张洋","can_delete":false,"product_type":"c1","uid":1182914,"ip_address":"","ucode":"549BE5DEEF8417","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/c2/bad34a50.jpg","comment_is_top":false,"comment_ctime":1573546461,"is_pvip":true,"replies":[{"id":"57964","content":"社区希望对所有的东西都能有掌控度，而不是依赖其他第三方组件","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573609629,"ip_address":"","comment_id":150501,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14458448349","product_id":100029201,"comment_content":"老师 既然kafka 曾经独立出zk来存储consumer group 的offset 是有好处的，仅仅因为zk不太适合做频繁的更新，才又整合到kafka中，为什么不考虑另外一种工具适合做频繁的更新操作去存储它。","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474177,"discussion_content":"社区希望对所有的东西都能有掌控度，而不是依赖其他第三方组件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573609629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130220,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1567406507,"is_pvip":true,"replies":[{"id":"48674","content":"非做不可，毕竟要重新分配分区。只是的确如你所说，并不是所有情况下都要触发rebalance。Rebalance时各个consumer成员要重新加入组，然后等待leader consumer成员制定消费分配方案，之后每个consumer成员拿到自己的方案后开始正常消费。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567473041,"ip_address":"","comment_id":130220,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14452308395","product_id":100029201,"comment_content":"老师可以讲解下rebanlance会涉及到哪些操作吗？如此重的一个操作kafka为什么要这么设计是有什么非做不可的原因吗？比如最简单的，消费组增加减少，主题增加减少和分区增加减少对应的都是一个消费组中每个消费实例所需要处理的分区数的变化，完全可以通过对各个主题分区的分配策略进行操作来实现均衡消费和高性能，这个操作代价感觉不是那么重量级啊？生产环境中没用过kafka，所以只是自己的一些想法，希望老师能够帮忙指正。","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465863,"discussion_content":"非做不可，毕竟要重新分配分区。只是的确如你所说，并不是所有情况下都要触发rebalance。Rebalance时各个consumer成员要重新加入组，然后等待leader consumer成员制定消费分配方案，之后每个consumer成员拿到自己的方案后开始正常消费。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567473041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128139,"user_name":"北冥Master","can_delete":false,"product_type":"c1","uid":1014142,"ip_address":"","ucode":"EBCCEC79AFC5DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/7e/c38ac02f.jpg","comment_is_top":false,"comment_ctime":1566834868,"is_pvip":false,"replies":[{"id":"47546","content":"kafka增加了分区手动迁移的话也要迁移数据的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566869318,"ip_address":"","comment_id":128139,"utype":1}],"discussion_count":5,"race_medal":0,"score":"14451736756","product_id":100029201,"comment_content":"elasticsearch在增加分片和减少分片时也有类似的重平衡的过程。es需要迁移数据所以时间会很长，kafka又不用迁移数据为什么要几个小时?看起来只是分区ID重新哈希一下?耗时主要在哪里？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464807,"discussion_content":"kafka增加了分区手动迁移的话也要迁移数据的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566869318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"涛哥哥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547346,"discussion_content":"ES不能减少分片。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642645264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"夏天","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534065,"discussion_content":"实际测试当 consumer group有上百个成员时，rebalance 最多也就1到2分钟，没有那么夸张几个小时。毕竟内部要等所有 consumer 协调一致，也就是取决于最坏的 consumer。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638086982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1466953,"avatar":"https://static001.geekbang.org/account/avatar/00/16/62/49/6332c99b.jpg","nickname":"man1s","note":"","ucode":"FFDB6B52F65A1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53558,"discussion_content":"老师答非所问呀，由于增加消费者导致的rebalance，broken应该不需要迁移数据呀，只是计算哪些broken由哪些消费者消费，为什么会耗时几小时呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574175914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1412220,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIaTvOKvUt4WnuSjkBp0tjd6O6vvVyw5fcib3UgZibE8tz2ICbTfkwbzs8MHNMJjV6W2mLjywLsvBibg/132","nickname":"火力全开","note":"","ucode":"8CE1733A2F618C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35566,"discussion_content":"Kafka增加分区时为什么会发生迁移数据呢？把其它分区的数据迁移到新分区吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571289326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112508,"user_name":"丘壑","can_delete":false,"product_type":"c1","uid":1118203,"ip_address":"","ucode":"ECFEDA5A93828D","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/fb/68196d4c.jpg","comment_is_top":false,"comment_ctime":1562748516,"is_pvip":false,"replies":[{"id":"40980","content":"group和standalone consumer都可以适用于大体量的消费啊。使用Group仅仅是为了利用它的自动分区分配功能。不是说group方式的consumer性能就要好或不好<br> ","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562804381,"ip_address":"","comment_id":112508,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14447650404","product_id":100029201,"comment_content":"看完更困惑了，那依据老师的观点，就是在多分区，多消费者的情况下，就不建议使用kafka-group的方式进行消费了，而是手动指定消费分区避免rebalance，这种多分区多消费者的场景不就是消息量非常大的场景吗？这不就是kafka的优势项目吗？难道kafka的优势在大量消息的场景就这么不堪吗？求大厂真相","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457771,"discussion_content":"group和standalone consumer都可以适用于大体量的消费啊。使用Group仅仅是为了利用它的自动分区分配功能。不是说group方式的consumer性能就要好或不好\n ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562804381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389870,"discussion_content":"大厂真相告诉你，大厂都不用 Kafka","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629455811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1307184,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/30/960fbed7.jpg","nickname":"那些年D盘里","note":"","ucode":"BFF643E6A2E13A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548735,"discussion_content":"年轻了不是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643350524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389870,"ip_address":""},"score":548735,"extra":""}]}]},{"had_liked":false,"id":110891,"user_name":"wykkx","can_delete":false,"product_type":"c1","uid":1122358,"ip_address":"","ucode":"ABCDF49E7A95C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","comment_is_top":false,"comment_ctime":1562384111,"is_pvip":false,"replies":[{"id":"40511","content":"0.9版本引入了新版本consumer。新版本将位移保存在__consumer_offsets中，不需要额外配置。如果你想保存在外部的Zk集群中，那么设置consumer端参数enable.auto.commit=false，然后自己调用ZooKeeper API提交位移到Zk即可。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546943,"ip_address":"","comment_id":110891,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14447285999","product_id":100029201,"comment_content":"“在新版本的 Consumer Group 中，Kafka 社区重新设计了 Consumer Group 的位移管理方式”老师 请问这是在哪个版本以后算是你 说的新版本，这里要如何进行配置是使用内部的还是使用外部的zk集群，在新版本里。","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457112,"discussion_content":"0.9版本引入了新版本consumer。新版本将位移保存在__consumer_offsets中，不需要额外配置。如果你想保存在外部的Zk集群中，那么设置consumer端参数enable.auto.commit=false，然后自己调用ZooKeeper API提交位移到Zk即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1244,"discussion_content":"记得是在0.9以后版本切换的，不用配置，新版本直接吧offset保存在broker上","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562463434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154101,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg","nickname":"你好旅行者","note":"","ucode":"5C72A428DC28F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1198,"discussion_content":"之前是把位移的信息放在zk里，后来是把位移的信息放在了一个叫consumer_offset的主题当中，由Kafka的broker来存放吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562396168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267468,"user_name":"will","can_delete":false,"product_type":"c1","uid":1071114,"ip_address":"","ucode":"FDEBE8C288AB6F","user_header":"https://static001.geekbang.org/account/avatar/00/10/58/0a/1a96a681.jpg","comment_is_top":false,"comment_ctime":1607759468,"is_pvip":false,"replies":[{"id":"97243","content":"确实是这样。不过社区于2.4引入了静态成员变量，可以规避这个问题","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1607908817,"ip_address":"","comment_id":267468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10197694060","product_id":100029201,"comment_content":"那是不是意味着我们每次重启一个服务，都会产生下线一次rebalance，上线一次rebalance？不会这么搓吧？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511652,"discussion_content":"确实是这样。不过社区于2.4引入了静态成员变量，可以规避这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607908817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243393,"user_name":"单朋荣","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1598084756,"is_pvip":false,"replies":[{"id":"89763","content":"可以了解下静态消费者组的实现。避免了部分的stw","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1598232504,"ip_address":"","comment_id":243393,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10188019348","product_id":100029201,"comment_content":"这个rebalance时要stop the world，我虽然不清楚，但感觉做法有点夸张，尤其时连接数多的时候。哈哈，突然感觉kafka不香了。<br>言归正传，我觉得rebalance策略是不是可以做成一个“异步控制”循环，通过“探针”的方式来检测连接状态，再结合元数据信息，进行重分配计算并更新控器循环所维护的状态机状态；由consumer group定期检测变化，并按照“状态机”返回的数据，激活某个broker的连接进程，创建新连接。删除连接的话，同理。<br>还没有读胡老师的“源码篇”，不知道有没有实现的可能。。","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504273,"discussion_content":"可以了解下静态消费者组的实现。避免了部分的stw","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598232504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187287,"user_name":"Geek_ab3d9a","can_delete":false,"product_type":"c1","uid":1550553,"ip_address":"","ucode":"1AFEE5FA59D470","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eol8MiawYVfCtkaFL9DFGoWpuajsKicwyt7IWm07JfrLMDuksEZJqia4Rbicw0biayokhgvSK0rUXIAngQ/132","comment_is_top":false,"comment_ctime":1584074631,"is_pvip":false,"replies":[{"id":"72309","content":"没有任何影响。client id仅仅用于日志和监控之用，对实际业务没有作用","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1584091945,"ip_address":"","comment_id":187287,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174009223","product_id":100029201,"comment_content":"老师  请问同一个消费者组消费同一个topic，clientd相同或不同，对rebalance有什么影响?","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487059,"discussion_content":"没有任何影响。client id仅仅用于日志和监控之用，对实际业务没有作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584091945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172691,"user_name":"td901105","can_delete":false,"product_type":"c1","uid":1348830,"ip_address":"","ucode":"32D42A4F36FA02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","comment_is_top":false,"comment_ctime":1579252024,"is_pvip":false,"replies":[{"id":"67066","content":"不要求一样。分配取决于你用什么策略，默认策略你基本上可以认为是平均分配。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1579394082,"ip_address":"","comment_id":172691,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10169186616","product_id":100029201,"comment_content":"老师,一个consumer group中的consumer中订阅的topic必须是完全一样的吗?如果可以自行订阅,那么分配topic分区的时候是怎么分配的?比如consumer group包含consumer1,consumer2,consumer3,其中只有consumer3订阅了topic3,那topic3的分区是会只分配给consumer3还是会平均分配给consumer1,consumer2,consumer3?","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481820,"discussion_content":"不要求一样。分配取决于你用什么策略，默认策略你基本上可以认为是平均分配。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579394082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144211,"user_name":"十字路口发传单","can_delete":false,"product_type":"c1","uid":1166707,"ip_address":"","ucode":"1DFA7F101C460A","user_header":"https://static001.geekbang.org/account/avatar/00/11/cd/73/5767729e.jpg","comment_is_top":false,"comment_ctime":1571878663,"is_pvip":false,"replies":[{"id":"55697","content":"您指的分组是指consumer group吗？如果是，最新版本的AdminClient支持deleteConsumerGroups方法","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1571965030,"ip_address":"","comment_id":144211,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10161813255","product_id":100029201,"comment_content":"想问一下目前新版本的分组，在没有消费者的情况下如何删除分组","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471849,"discussion_content":"您指的分组是指consumer group吗？如果是，最新版本的AdminClient支持deleteConsumerGroups方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571965030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113001,"user_name":"趁早","can_delete":false,"product_type":"c1","uid":1031970,"ip_address":"","ucode":"949FB3AA250D80","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg","comment_is_top":false,"comment_ctime":1562864017,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10152798609","product_id":100029201,"comment_content":"写的很透彻的一门kafka的专栏","like_count":2,"discussions":[{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389872,"discussion_content":"其实很多文章写得都很一般","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629456068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2585808,"avatar":"https://static001.geekbang.org/account/avatar/00/27/74/d0/727f9ef1.jpg","nickname":"三戒","note":"","ucode":"0F18E5DB274F13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403247,"discussion_content":"哥们 你的评论 很犀利 我很喜欢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634039253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389872,"ip_address":""},"score":403247,"extra":""}]}]},{"had_liked":false,"id":112107,"user_name":"大倪(Xin Jun)","can_delete":false,"product_type":"c1","uid":1351059,"ip_address":"","ucode":"698FD0DABA498E","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/93/51c4cf0f.jpg","comment_is_top":false,"comment_ctime":1562670307,"is_pvip":false,"replies":[{"id":"40838","content":"专栏后面有专门讨论如何避免rebalance：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562721484,"ip_address":"","comment_id":112107,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10152604899","product_id":100029201,"comment_content":"老师可以说说如何避免rebalance，比如设置什么参数来延长心跳时间，避免被错误踢掉导致频繁rebalance","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457580,"discussion_content":"专栏后面有专门讨论如何避免rebalance：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562721484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312193,"user_name":"Geek_a948e5","can_delete":false,"product_type":"c1","uid":1446750,"ip_address":"","ucode":"D7530FB93AD602","user_header":"","comment_is_top":false,"comment_ctime":1631677179,"is_pvip":false,"replies":[{"id":"114446","content":"不是不能扩展。是consumer group自动帮你做了很多事情，比如failover，work rebalancing这些。你当然可以自己实现这些，但consumer group开箱即用","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1634004827,"ip_address":"","comment_id":312193,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5926644475","product_id":100029201,"comment_content":"为什么有了 Consumer Group 后 Kafka 就拥有更好的可扩展性了？能举个例子吗？没有 Group 之前是怎么扩展的？有了 Group 后是怎么扩展的？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526891,"discussion_content":"不是不能扩展。是consumer group自动帮你做了很多事情，比如failover，work rebalancing这些。你当然可以自己实现这些，但consumer group开箱即用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634004827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253435,"user_name":"贤伟","can_delete":false,"product_type":"c1","uid":1496738,"ip_address":"","ucode":"02E467263201DF","user_header":"https://static001.geekbang.org/account/avatar/00/16/d6/a2/be61c162.jpg","comment_is_top":false,"comment_ctime":1602739775,"is_pvip":false,"replies":[{"id":"92793","content":"1. 查看这个分区还有没有新的消息可供消费<br>2. 看下这个分区的消息是否有格式损坏（corrupted）的消息，导致consumer别卡住了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1603073706,"ip_address":"","comment_id":253435,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5897707071","product_id":100029201,"comment_content":"你好，consumer突然不消费topic下的某个分区一般是什么原因？<br><br>我有一个consumer 消费一个topic下的3个分区，但是运行一段时间后发现，其中的一个分区不再被消费，另外2个仍正常被消费。<br><br>请帮忙给个思路如何去查找问题原因","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507071,"discussion_content":"1. 查看这个分区还有没有新的消息可供消费\n2. 看下这个分区的消息是否有格式损坏（corrupted）的消息，导致consumer别卡住了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603073706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1496738,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d6/a2/be61c162.jpg","nickname":"贤伟","note":"","ucode":"02E467263201DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318542,"discussion_content":"应该是kafka-clients 2.3.0的一个bug，https://github.com/apache/kafka/pull/7511\n\nheartbeat线程和consumer线程同步问题","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603776980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1496738,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d6/a2/be61c162.jpg","nickname":"贤伟","note":"","ucode":"02E467263201DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314614,"discussion_content":"老师你好：1. 分区有新的消息。在kafka-manager里这个partition的lag一直在增加，说明有新消息，但没有被消费。另外使用脚本 kafka-console-consumer.sh --topic xxx --bootstrap-server xxx:9092   --property key.separator=&#34;-&#34;  --partition 1 可以看出分区1输出新的消息。\n2. 这个topic我只有一个consumer，这个线程应该是正常在运行的，因为有分区0，2，4还在正常消费。（分区1和3没有消费）。\n\n一般程序运行一段时间后发生问题（时间不定）。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603177581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1496738,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d6/a2/be61c162.jpg","nickname":"贤伟","note":"","ucode":"02E467263201DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318571,"discussion_content":"该bug实际导致consumer停止从某个broker获取消息了（不是partition）","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603783150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249090,"user_name":"尚小树","can_delete":false,"product_type":"c1","uid":2165300,"ip_address":"","ucode":"9BCB0DF0F3C8E4","user_header":"https://static001.geekbang.org/account/avatar/00/21/0a/34/3e29eb5a.jpg","comment_is_top":false,"comment_ctime":1600426144,"is_pvip":false,"replies":[{"id":"91431","content":"这就是standalone consumer的原理。让consumer直接指定要消费哪些分区，从而避免了rebalance。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1600523330,"ip_address":"","comment_id":249090,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5895393440","product_id":100029201,"comment_content":"老师，如果让每个消费者都指定分区消费能解决rebalance的问题么？如果有consumer挂掉通过监控报警提醒，挂掉的去暂时不消费。","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505824,"discussion_content":"这就是standalone consumer的原理。让consumer直接指定要消费哪些分区，从而避免了rebalance。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600523330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218525,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1589813990,"is_pvip":false,"replies":[{"id":"80801","content":"不是。broker挂了，其他broker上的副本依然可以正常工作，该分区仍然视为可用状态。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589850500,"ip_address":"","comment_id":218525,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884781286","product_id":100029201,"comment_content":"请问老师.<br>一个主题2个分区,分别在不同的broker上;<br>其中一个broker刚好挂了,是不是意味着消费实例订阅的主题的分区数减少了,然后导致重平衡.","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495499,"discussion_content":"不是。broker挂了，其他broker上的副本依然可以正常工作，该分区仍然视为可用状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589850500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179802,"user_name":"Dave","can_delete":false,"product_type":"c1","uid":1501982,"ip_address":"","ucode":"BF683DAB4DEF02","user_header":"https://static001.geekbang.org/account/avatar/00/16/eb/1e/28c5557f.jpg","comment_is_top":false,"comment_ctime":1582102292,"is_pvip":true,"replies":[{"id":"69871","content":"“所有消费者在同一消费者组，消息会负载均衡到消费者实例” ---- 所有配置有相同group.id的消费者共同构成一个group消费订阅的分区。比如group下有5个消费者，一共订阅了20个分区，那么平均情况下（指一般情况下）每个消费者消费4个分区，故实现负载均衡~<br><br>“消费者在不同组的情况，消费者会广播给所有消费者实例” --- 感觉语句不通顺：） 它想说的意思是如果是不同group的消费者，它们不会像上面那种情况那样分担消费任务，它们彼此是独立的，没有任何合作或关联。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1582158290,"ip_address":"","comment_id":179802,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5877069588","product_id":100029201,"comment_content":"有看到这样一句话，不是特别理解，还请老师在解释一下<br>所有消费者在同一消费者组，消息会负载均衡到消费者实例<br>消费者在不同组的情况，消费者会广播给所有消费者实例","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484404,"discussion_content":"“所有消费者在同一消费者组，消息会负载均衡到消费者实例” ---- 所有配置有相同group.id的消费者共同构成一个group消费订阅的分区。比如group下有5个消费者，一共订阅了20个分区，那么平均情况下（指一般情况下）每个消费者消费4个分区，故实现负载均衡~\n\n“消费者在不同组的情况，消费者会广播给所有消费者实例” --- 感觉语句不通顺：） 它想说的意思是如果是不同group的消费者，它们不会像上面那种情况那样分担消费任务，它们彼此是独立的，没有任何合作或关联。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582158290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164045,"user_name":"燃着的半支烟","can_delete":false,"product_type":"c1","uid":1230837,"ip_address":"","ucode":"23C7B588F400A7","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/f5/4e9a82e9.jpg","comment_is_top":false,"comment_ctime":1576849234,"is_pvip":false,"replies":[{"id":"62536","content":"两个consumer实例，属于同一个group<br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1577062388,"ip_address":"","comment_id":164045,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5871816530","product_id":100029201,"comment_content":"老师，我咨询一个问题。。。比如某个微服务两台负载，那这两台负载配置的是同一个groupId，那么这两台负载，是同一个consumer 还是说，是cunsumerA  和 consumerB ？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478624,"discussion_content":"两个consumer实例，属于同一个group\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577062388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389871,"discussion_content":"只要 groupId 相同，不管 KafkaConsumer 在哪都是一个组","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629455982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149050,"user_name":"惜昔","can_delete":false,"product_type":"c1","uid":1441589,"ip_address":"","ucode":"B3478E40B612FC","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/35/b744c027.jpg","comment_is_top":false,"comment_ctime":1573131067,"is_pvip":false,"replies":[{"id":"57346","content":"“Consumer group是第一个消费者订阅的时候创建的吗” --- 我觉得你可以这么理解。<br><br>“后面订阅该topic的消费者会不会自动加入该消费者组” --- 如果这个消费者设置了相同的groupID，那么不论是否订阅该topic，都会属于这个消费者组。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573176020,"ip_address":"","comment_id":149050,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5868098363","product_id":100029201,"comment_content":"请问老师Consumer group是第一个消费者订阅的时候创建的吗？后面订阅该topic的消费者会不会自动加入该消费者组","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473721,"discussion_content":"“Consumer group是第一个消费者订阅的时候创建的吗” --- 我觉得你可以这么理解。\n\n“后面订阅该topic的消费者会不会自动加入该消费者组” --- 如果这个消费者设置了相同的groupID，那么不论是否订阅该topic，都会属于这个消费者组。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573176020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130908,"user_name":"谢特","can_delete":false,"product_type":"c1","uid":1248684,"ip_address":"","ucode":"9C30DBFECFE649","user_header":"https://static001.geekbang.org/account/avatar/00/13/0d/ac/09678490.jpg","comment_is_top":false,"comment_ctime":1567570573,"is_pvip":false,"replies":[{"id":"49118","content":"嗯嗯，这个是Confluent Kafka提供的功能，Apache Kafka是没有的。咱们这个专栏还是主要覆盖社区版Kafka的功能。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567595779,"ip_address":"","comment_id":130908,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5862537869","product_id":100029201,"comment_content":"Kafka Schema Registry这个可以讲一下吗","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466191,"discussion_content":"嗯嗯，这个是Confluent Kafka提供的功能，Apache Kafka是没有的。咱们这个专栏还是主要覆盖社区版Kafka的功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567595779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1248684,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0d/ac/09678490.jpg","nickname":"谢特","note":"","ucode":"9C30DBFECFE649","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7694,"discussion_content":"kafka sink connect这个可以讲一下吗，渴求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567619890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124199,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565833841,"is_pvip":false,"replies":[{"id":"45636","content":"1. 如果你的client端机器非常强劲，只启动一个consumer实例单线程消费未免有些浪费，你可以以启动多个线程的方式来充分利用资源。<br>2. 消息被删除。具体流程因不同框架而定<br>3.  1个consumer必须订阅所有分区，这是不必要的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565876298,"ip_address":"","comment_id":124199,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5860801137","product_id":100029201,"comment_content":"老师好，我有以下几个疑问，请帮忙解答一下，多谢!<br>1：请问老师，什么场景下消费者组中的一个实例会是一个进程中的线程呢？<br><br>2：传统的消息队列模型的缺陷在于消息一旦被消费，就会从队列中被删除，而且只能被下游的一个 Consumer 消费。<br>请问老师，这里描述的删除操作，具体是什么操作？将消息从队列中移出？还是移动位移标识此位置可以使用？这些操作应该是内存中的吧！对于落盘的消息以及副本中的消息也有删除的动作吧？删除一个消息的完整流程是怎么样的呢？<br><br>3：发布 &#47; 订阅模型倒是允许消息被多个 Consumer 消费，但它的问题也是伸缩性不高，因为每个订阅者都必须要订阅主题的所有分区。这种全量订阅的方式既不灵活，也会影响消息的真实投递效果。<br>如果一个主题可以有多个分区，也能增加分区数据，如果消费能力不足，可以增加消费者，这种方式没理解怎么伸缩性就不高了？不是一个consumer实例只能消费主题下的一个分区嘛？<br>","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463054,"discussion_content":"1. 如果你的client端机器非常强劲，只启动一个consumer实例单线程消费未免有些浪费，你可以以启动多个线程的方式来充分利用资源。\n2. 消息被删除。具体流程因不同框架而定\n3.  1个consumer必须订阅所有分区，这是不必要的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565876298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329266,"discussion_content":"一个主题 多个分区 被一个消费者订阅这个主题，消费者消费分区的顺序是轮询的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606356031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121068,"user_name":"锋芒","can_delete":false,"product_type":"c1","uid":1320419,"ip_address":"","ucode":"BB5284E3C8D78D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ach5TNuIu8T4Of8ibvfWM4JPic5uQn9Y7TgGjBHLp2iar4icxJzs14bpUXV9OdYiciblvJl14zSqXjwtDffHnSTqbD6g/132","comment_is_top":false,"comment_ctime":1565054242,"is_pvip":false,"replies":[{"id":"44527","content":"在消费者组机制下是这样的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565070954,"ip_address":"","comment_id":121068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5860021538","product_id":100029201,"comment_content":"老师，请教一下： 一个分区 同一时间段 只会有一个consumer 在消费消息对吗 ？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461605,"discussion_content":"在消费者组机制下是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565070954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119388,"user_name":"ProgramGeek","can_delete":false,"product_type":"c1","uid":1008217,"ip_address":"","ucode":"3F0E3963C4FB57","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/59/a01a5ddd.jpg","comment_is_top":false,"comment_ctime":1564576133,"is_pvip":false,"replies":[{"id":"43867","content":"不会的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564627744,"ip_address":"","comment_id":119388,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5859543429","product_id":100029201,"comment_content":"broker发生变化也是同样会发生reblance吧，虽然和consumer数目变化一样","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460883,"discussion_content":"不会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564627744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323580,"discussion_content":"broker发生变化，topic可能被分到其他的broker了，但是topic分区数没变，不用rebalance","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604970634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50128,"discussion_content":"马克,原来broker变化是不会导致重平衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573662857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117540,"user_name":"百越平民","can_delete":false,"product_type":"c1","uid":1194846,"ip_address":"","ucode":"1F26D94EC757D6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epc3H0jvwelJoMUbPdcXDibTkdnjlytYW9KiaNoUG8XHxtoWkkia6kfTLLHrEmMGQkFVZuqY1QBvz8jg/132","comment_is_top":false,"comment_ctime":1564069685,"is_pvip":false,"replies":[{"id":"43054","content":"是的。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564102167,"ip_address":"","comment_id":117540,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5859036981","product_id":100029201,"comment_content":"老师，是不是同一个group内，同一个topic，同一个分区，最终只会被一个consumer消费（不论是进程还是线程）","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460016,"discussion_content":"是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564102167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116404,"user_name":"金hb.Ryan 冷空氣駕到","can_delete":false,"product_type":"c1","uid":1222233,"ip_address":"","ucode":"CAD363576696E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","comment_is_top":false,"comment_ctime":1563846956,"is_pvip":false,"replies":[{"id":"42580","content":"offset保存在哪和rebalance关系不大的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563849783,"ip_address":"","comment_id":116404,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858814252","product_id":100029201,"comment_content":"请问 像kafka flink消费程序，offset保存在hdfs中是不是避免rebalance？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459524,"discussion_content":"offset保存在哪和rebalance关系不大的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563849783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114289,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1563266630,"is_pvip":false,"replies":[{"id":"41683","content":"不是。多个进程的consumer，只要有相同的groupID，就能参与主题所有分区的消费。主要是看KafkaConsumer实例的个数","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563274286,"ip_address":"","comment_id":114289,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858233926","product_id":100029201,"comment_content":"前面有同学提问--老师：今天试了下，同一个消费者组，不同进程下的消费者实例，消费同一个主题，只有一个进程能够消费，而在多线程下，却是可以消费同一主题，不同分区下的消息，是这样的吗？<br>感觉老师理解错问题了。  我这实验结果是：不同进程的消费者组用同一个groupID，确实随机到其中的一个进程消费。 多线程的情况没有试。","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458596,"discussion_content":"不是。多个进程的consumer，只要有相同的groupID，就能参与主题所有分区的消费。主要是看KafkaConsumer实例的个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563274286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114143,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1563242301,"is_pvip":false,"replies":[{"id":"41687","content":"不能说没有，但我见到的不多","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563274540,"ip_address":"","comment_id":114143,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858209597","product_id":100029201,"comment_content":"消费者 group 订阅多个 topic 的情况多吗，感觉订阅多个 topic 的话，处理逻辑不是一样的","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458531,"discussion_content":"不能说没有，但我见到的不多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563274540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113279,"user_name":"星期八","can_delete":false,"product_type":"c1","uid":1185504,"ip_address":"","ucode":"34A37F73A48E7F","user_header":"https://static001.geekbang.org/account/avatar/00/12/16/e0/7abad3cc.jpg","comment_is_top":false,"comment_ctime":1562932813,"is_pvip":false,"replies":[{"id":"41429","content":"应该不是这样的。只要是多个KafkaConsumer实例配置了相同的group.id，就应该能够同时消费不同的主题分区","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563157705,"ip_address":"","comment_id":113279,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857900109","product_id":100029201,"comment_content":"老师：今天试了下，同一个消费者组，不同进程下的消费者实例，消费同一个主题，只有一个进程能够消费，而在多线程下，却是可以消费同一主题，不同分区下的消息，是这样的吗？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458148,"discussion_content":"应该不是这样的。只要是多个KafkaConsumer实例配置了相同的group.id，就应该能够同时消费不同的主题分区","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563157705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112157,"user_name":"快跑","can_delete":false,"product_type":"c1","uid":1564645,"ip_address":"","ucode":"90ED7E6D40C58E","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg","comment_is_top":false,"comment_ctime":1562676205,"is_pvip":false,"replies":[{"id":"40834","content":"0.9版本开始的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562721160,"ip_address":"","comment_id":112157,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857643501","product_id":100029201,"comment_content":"老师，你好<br>新版本位移保存在内部主题。这里说的新版本，是从哪个版本开始的？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457602,"discussion_content":"0.9版本开始的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562721160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111790,"user_name":"莫","can_delete":false,"product_type":"c1","uid":1108415,"ip_address":"","ucode":"E68B0FA0CFFD2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/e9/bf/fddb8b9f.jpg","comment_is_top":false,"comment_ctime":1562599876,"is_pvip":false,"replies":[{"id":"40688","content":"可能的原因太多了。。。最好给出详细的描述","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562635467,"ip_address":"","comment_id":111790,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857567172","product_id":100029201,"comment_content":"老师，使用kafka 的时候，发现消费者进程依然存在，但是不进行消费，这会是什么问题导致","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457448,"discussion_content":"可能的原因太多了。。。最好给出详细的描述","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562635467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111452,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1562559921,"is_pvip":false,"replies":[{"id":"40691","content":"默认560个分区，3个副本。可以设置也可以自行创建","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562635703,"ip_address":"","comment_id":111452,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5857527217","product_id":100029201,"comment_content":"老师，请教下，这个保存位移的分区有多少个分区多少个副本那？我们可以设置吗？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457361,"discussion_content":"默认560个分区，3个副本。可以设置也可以自行创建","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562635703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303965,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLfogWrXZbZJjau0Z5fGhw04QIHAnZ3DJyvmQ96P1surczqUROeApu3ia9aAIIccKa1uDiaald58jGQ/132","nickname":"Geek_66cfcf","note":"","ucode":"DA38468CCAFFE4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581000,"discussion_content":"50个分区 三个副本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658457629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1070261,"avatar":"https://static001.geekbang.org/account/avatar/00/10/54/b5/310dae7b.jpg","nickname":"小刀","note":"","ucode":"785923D8F0D46A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":262502,"discussion_content":"60个分区吧，不是560","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589107179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50131,"discussion_content":"马克.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573663082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111046,"user_name":"外星人","can_delete":false,"product_type":"c1","uid":1132861,"ip_address":"","ucode":"D8469B13F2AB37","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg","comment_is_top":false,"comment_ctime":1562430864,"is_pvip":false,"replies":[{"id":"40503","content":"reassign操作很容易出错，不只是对__consumer_offsets。我个人的建议哈：1. 业务低峰时段做；2. 不要topic级别整体迁移，最好按照分区级别来做。比如一次迁移几个分区这样","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546534,"ip_address":"","comment_id":111046,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857398160","product_id":100029201,"comment_content":"老师，你好，我们最近集群扩容，需要对__consumer_offset这个topic进行reassign，请问有没有坑啊？需要注意哪些事项呢？期待您的回答，谢谢","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457196,"discussion_content":"reassign操作很容易出错，不只是对__consumer_offsets。我个人的建议哈：1. 业务低峰时段做；2. 不要topic级别整体迁移，最好按照分区级别来做。比如一次迁移几个分区这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355546,"user_name":"Geek_a4eff8","can_delete":false,"product_type":"c1","uid":2278072,"ip_address":"上海","ucode":"70B6B09BBE98C3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJhyK1QiaqyNo88IclpG9qnVqw9ibBXibdTOM8n1xaaLhDgwNnRkViaXqFbunbEVbThvgErky4gzP2QRQ/132","comment_is_top":false,"comment_ctime":1661484792,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661484792","product_id":100029201,"comment_content":"有一个消费者生产者启动顺序的问题。<br>1.我从生产者将数据写入一个新的topic，这个topic通过代码自动创建<br>2.在生产者发送消息后，使用消费者消费不到上面创建的数据，无论我是否指定了消费者组。<br>3.如果先启动消费者实例，却可以消费到新建的主题。","like_count":0},{"had_liked":false,"id":354843,"user_name":"张诚","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"湖北","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1660816707,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660816707","product_id":100029201,"comment_content":"那每次正常版本迭代发布上线的时候岂不是都会进行rebalance?<br>或者一个实例心跳异常，下线后又恢复","like_count":0},{"had_liked":false,"id":345867,"user_name":"破晓长空","can_delete":false,"product_type":"c1","uid":1260175,"ip_address":"","ucode":"0A5EB522046602","user_header":"https://static001.geekbang.org/account/avatar/00/13/3a/8f/b2ee20f5.jpg","comment_is_top":false,"comment_ctime":1652666015,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1652666015","product_id":100029201,"comment_content":"请问，目前新版本，rebalance的问题解决了吗？","like_count":0},{"had_liked":false,"id":340776,"user_name":"胡健","can_delete":false,"product_type":"c1","uid":2199280,"ip_address":"","ucode":"F11CACB2F7C4F1","user_header":"https://static001.geekbang.org/account/avatar/00/21/8e/f0/1a220cba.jpg","comment_is_top":false,"comment_ctime":1649133408,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649133408","product_id":100029201,"comment_content":"这个rebalance 我碰到过，很恶心😷消费者那边消费之后需要处理消息，但是处理时间特别长，然后kafka就认为消费者掉线了，就开始rebalance，然后就都卡住了，重均衡完了后，又开始消费了，又掉线又卡住了………………","like_count":0},{"had_liked":false,"id":333173,"user_name":"戒酒的李白","can_delete":false,"product_type":"c1","uid":2166073,"ip_address":"","ucode":"744E1A22761647","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","comment_is_top":false,"comment_ctime":1644157172,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644157172","product_id":100029201,"comment_content":"rebalance 应该很快吧？","like_count":0},{"had_liked":false,"id":330269,"user_name":"小仙","can_delete":false,"product_type":"c1","uid":1866677,"ip_address":"","ucode":"9F94043DFCEC3A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq6pWvKsV4rzQ62z5MDEjaEU5MbDfmzbA62kUgoqia2tgKIIxw4ibkDhF7W48iat5dT8UB9Adky2NuzQ/132","comment_is_top":false,"comment_ctime":1641888609,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641888609","product_id":100029201,"comment_content":"这种 consumer 对应分区的设计，限制了 consumer 的并发数量上限，相当于最多只有分区数的消费者，而其他的消息中间件比如 rabbitmq ，就没有这个问题，消息会负债均衡到各个消费者上。","like_count":0},{"had_liked":false,"id":329498,"user_name":"贝影","can_delete":false,"product_type":"c1","uid":1054827,"ip_address":"","ucode":"19545C8DCBF8A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","comment_is_top":false,"comment_ctime":1641373831,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641373831","product_id":100029201,"comment_content":"老师你好，可能2022年才订阅的发表的留言你看不到了。<br>我们有业务是需要对同一个topic的内容进行消费做不同的处理，那就要在这个topic上分配不同的消费者组了，之所以用消费组而不是assign是因为这个topic的量很大，同一个组下需要多个消费者。那么如果消费者组过多，是否对该topic在磁盘上的日志大小占用会有很大影响？","like_count":0},{"had_liked":false,"id":329368,"user_name":"🍀 栀夏37℃","can_delete":false,"product_type":"c1","uid":1330089,"ip_address":"","ucode":"F91895814FCECE","user_header":"https://static001.geekbang.org/account/avatar/00/14/4b/a9/72b4d58a.jpg","comment_is_top":false,"comment_ctime":1641302555,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641302555","product_id":100029201,"comment_content":"max.poll.interval.ms 这个配置是在哪儿设置呢？在github.com&#47;Shopify&#47;sarama中没有找到","like_count":0},{"had_liked":false,"id":324009,"user_name":"Geek_cec0e4","can_delete":false,"product_type":"c1","uid":2833242,"ip_address":"","ucode":"DEEAFAE8190EFF","user_header":"","comment_is_top":false,"comment_ctime":1638255685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638255685","product_id":100029201,"comment_content":"老师我看文章有人说<br>使用RoundRobin策略有两个前提条件必须满足：<br><br>同一个消费者组里面的所有消费者的num.streams（消费者消费线程数）必须相等；<br>每个消费者订阅的主题必须相同。<br>然后又说<br>RoundRobin的两种情况<br>如果同一个消费组内所有的消费者的订阅信息都是相同的，那么RoundRobinAssignor策略的分区分配会是均匀的。<br><br>举例，假设消费组中有2个消费者C0和C1，都订阅了主题t0和t1，并且每个主题都有3个分区，那么所订阅的所有分区可以标识为：t0p0、t0p1、t0p2、t1p0、t1p1、t1p2。最终的分配结果为：<br><br>消费者C0：t0p0、t0p2、t1p1<br>消费者C1：t0p1、t1p0、t1p2<br><br>如果同一个消费组内的消费者所订阅的信息是不相同的，那么在执行分区分配的时候就不是完全的轮询分配，有可能会导致分区分配的不均匀。如果某个消费者没有订阅消费组内的某个topic，那么在分配分区的时候此消费者将分配不到这个topic的任何分区。<br><br>举例，假设消费组内有3个消费者C0、C1和C2，它们共订阅了3个主题：t0、t1、t2，这3个主题分别有1、2、3个分区，即整个消费组订阅了t0p0、t1p0、t1p1、t2p0、t2p1、t2p2这6个分区。具体而言，消费者C0订阅的是主题t0，消费者C1订阅的是主题t0和t1，消费者C2订阅的是主题t0、t1和t2，那么最终的分配结果为：<br><br>消费者C0：t0p0<br>消费者C1：t1p0<br>消费者C2：t1p1、t2p0、t2p1、t2p2<br><br><br>这里一会要求消费者消费主题相同一会又不相同是什么情况啊","like_count":0},{"had_liked":false,"id":318150,"user_name":"KW💤","can_delete":false,"product_type":"c1","uid":1109389,"ip_address":"","ucode":"290DD7016F4EE0","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/8d/377c106a.jpg","comment_is_top":false,"comment_ctime":1635164144,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635164144","product_id":100029201,"comment_content":"stw什么意思？我的应用只要启动了kafka的consumer，当rebalance时我整个应用都会停顿了？我的应用还有其他业务啊，消息订阅只是其中一个小功能需求","like_count":0},{"had_liked":false,"id":306252,"user_name":"受超凡","can_delete":false,"product_type":"c1","uid":2678558,"ip_address":"","ucode":"A2A160D483BBB0","user_header":"","comment_is_top":false,"comment_ctime":1628473405,"is_pvip":false,"replies":[{"id":"112538","content":"增加分区会导致rebalance，不过毕竟这个操作不经常发生","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1630810853,"ip_address":"","comment_id":306252,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1628473405","product_id":100029201,"comment_content":"胡老板好，kafka的扩展性是通过增加分区来实现的，增加分区对应增加消费实例，以此提高消费能力，但增加分区会进行rebalance，可能会导致各种问题。是这样吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524684,"discussion_content":"增加分区会导致rebalance，不过毕竟这个操作不经常发生","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630810853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301227,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1625581694,"is_pvip":false,"replies":[{"id":"109459","content":"提交失败","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1626242377,"ip_address":"","comment_id":301227,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625581694","product_id":100029201,"comment_content":"老师，冲平衡的时候，这个时候有消费者开始提交位移，是阻塞等待重平衡结束再提交还是直接返回提交失败？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522934,"discussion_content":"提交失败","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626242377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290567,"user_name":"石栖","can_delete":false,"product_type":"c1","uid":1496443,"ip_address":"","ucode":"35600F645A479F","user_header":"https://static001.geekbang.org/account/avatar/00/16/d5/7b/c512da6a.jpg","comment_is_top":false,"comment_ctime":1619621418,"is_pvip":false,"replies":[{"id":"105703","content":"1. 执行完毕。kafka没有os那种中断机制<br>2. 取决于怎么写的代码。如果是在同一线程中循环处理消息，那么会处理完","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1620614609,"ip_address":"","comment_id":290567,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619621418","product_id":100029201,"comment_content":"您好，如果一个consumer已经获取了500条message，然后正在处理了其中第300条的时候，发生rebalance（比如：max.poll.interval.ms到期了）。那么我有两个问题（1）第300条message，consumer中后续的处理代码是否会继续执行？还是被强行停止？（2）然后后面200条，还会处理吗？还说，停止consumer中所有操作。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519235,"discussion_content":"1. 执行完毕。kafka没有os那种中断机制\n2. 取决于怎么写的代码。如果是在同一线程中循环处理消息，那么会处理完","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620614609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289383,"user_name":"不懂就问","can_delete":false,"product_type":"c1","uid":2257687,"ip_address":"","ucode":"2AAE0EDC2D0433","user_header":"","comment_is_top":false,"comment_ctime":1618993566,"is_pvip":false,"replies":[{"id":"105288","content":"重启consumer就会触发rebalance<br>","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1619600048,"ip_address":"","comment_id":289383,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618993566","product_id":100029201,"comment_content":"订阅主题的分区数发生变更，重启消费者服务，是不是可以避免rebalance呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518901,"discussion_content":"重启consumer就会触发rebalance\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619600048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285969,"user_name":"beifengzhishen001","can_delete":false,"product_type":"c1","uid":2109853,"ip_address":"","ucode":"77D42B7DD9E754","user_header":"","comment_is_top":false,"comment_ctime":1617089653,"is_pvip":false,"replies":[{"id":"104159","content":"严格说这不是容错性，不过你大致也可以这么理解啦","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1617671203,"ip_address":"","comment_id":285969,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1617089653","product_id":100029201,"comment_content":"老师，请问消费者群组的容错性体现在什么地方呢？是可以保证某个消费者退出后它原本消费的分区可以被同一组里的其他成员接管么？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517835,"discussion_content":"严格说这不是容错性，不过你大致也可以这么理解啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617671203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285421,"user_name":"Dave_854e95","can_delete":false,"product_type":"c1","uid":1298259,"ip_address":"","ucode":"B06BEE0776C9E7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/c8s3YZTcniaE34wSjeZtVTnILWYka4wFT4PBtEKymsVF3fXMQHzPHYgxGVpQMAYgYJwlicrOHKYIGCqUUCVMKFGw/132","comment_is_top":false,"comment_ctime":1616805348,"is_pvip":false,"replies":[{"id":"103777","content":"可以多做几个consumer实例，没问题的：）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1617067658,"ip_address":"","comment_id":285421,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1616805348","product_id":100029201,"comment_content":"消费组的成员为什么不能进行冗余设计，设计备用消费者成员，如果有成员变化，分区增加，topic增加，备份成员可以直接顶上","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517670,"discussion_content":"可以多做几个consumer实例，没问题的：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617067658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285036,"user_name":"Allan","can_delete":false,"product_type":"c1","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1616587223,"is_pvip":false,"replies":[{"id":"103528","content":"嗯，不必要求一定要是用消费者组机制","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1616720383,"ip_address":"","comment_id":285036,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1616587223","product_id":100029201,"comment_content":"一个组下的消费者是平均分配partition的，平均分配了数据。感觉容易出错，比如A接了消息做了某个业务，结果B也接了消息做了另一个业务，结果数据都不是完整的。必须是都属于不同组才能解决。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517558,"discussion_content":"嗯，不必要求一定要是用消费者组机制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616720383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271686,"user_name":"K菌无惨","can_delete":false,"product_type":"c1","uid":2194764,"ip_address":"","ucode":"97A532D588FD49","user_header":"","comment_is_top":false,"comment_ctime":1609755542,"is_pvip":false,"replies":[{"id":"98755","content":"是的：）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1610089530,"ip_address":"","comment_id":271686,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1609755542","product_id":100029201,"comment_content":"是不是和RocketMQ的集群消费和广播消费类似","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513003,"discussion_content":"是的：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610089530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269630,"user_name":"undefined","can_delete":false,"product_type":"c1","uid":2275808,"ip_address":"","ucode":"953AF612BBF0F7","user_header":"https://static001.geekbang.org/account/avatar/00/22/b9/e0/47f8c89e.jpg","comment_is_top":false,"comment_ctime":1608720377,"is_pvip":false,"replies":[{"id":"97802","content":"应该会重新rebalance","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1608772698,"ip_address":"","comment_id":269630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1608720377","product_id":100029201,"comment_content":"请教个问题，在docker容器里部署了consumer消费服务，如果容器销毁，重新创建，docker容器里的服务启动后会触发Rebalance吗？groupId没变。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512339,"discussion_content":"应该会重新rebalance","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608772698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264224,"user_name":"黄婷婷","can_delete":false,"product_type":"c1","uid":1467134,"ip_address":"","ucode":"8B65636C9197A2","user_header":"https://static001.geekbang.org/account/avatar/00/16/62/fe/6d2fa6b9.jpg","comment_is_top":false,"comment_ctime":1606383888,"is_pvip":false,"replies":[{"id":"95850","content":"我的意思是只能增加分区不能减少分区","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1606439326,"ip_address":"","comment_id":264224,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606383888","product_id":100029201,"comment_content":"&quot;Kafka 当前只能允许增加一个主题的分区数&quot;<br>老师，这句话不知道具体怎么理解，是一个组订阅的所有主题中只能有一个主题的分区数是允许改变的，当有超过一个主题的分区数发生变更时不允许的吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510470,"discussion_content":"我的意思是只能增加分区不能减少分区","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606439326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":257677,"user_name":"Stony.修行僧","can_delete":false,"product_type":"c1","uid":1061277,"ip_address":"","ucode":"0F2368F7D93E4A","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/9d/daad92d2.jpg","comment_is_top":false,"comment_ctime":1604054910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604054910","product_id":100029201,"comment_content":"二刷 Kafka，没想到Kafka的精髓在 consumer group","like_count":0},{"had_liked":false,"id":254983,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1603244650,"is_pvip":false,"replies":[{"id":"93052","content":"三个主题，分区数分别是1，2和3，总的分区数是6。。。不知道是不是没说清楚？？","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1603354253,"ip_address":"","comment_id":254983,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1603244650","product_id":100029201,"comment_content":"这个6是怎么算出来的呢？  <br>&quot;Consumer 实例的数量应该等于该 Group 订阅主题的分区总数。&quot;<br>这个怎么算也不等于6啊。。。<br><br><br>理想情况下，Consumer 实例的数量应该等于该 Group 订阅主题的分区总数。<br>举个简单的例子，假设一个 Consumer Group 订阅了 3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3，那么通常情况下，为该 Group 设置 6 个","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507576,"discussion_content":"三个主题，分区数分别是1，2和3，总的分区数是6。。。不知道是不是没说清楚？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603354253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254425,"user_name":"浮石沉木","can_delete":false,"product_type":"c1","uid":2223167,"ip_address":"","ucode":"D585768321B84A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mQddXC7nRiaKHTwdficicTB3bH0q5ic5UoSab51Omic7eyLBz0SNcvbLpQnNib7zP1yJFm7xxx4ia81iahfibRVnbTwHmhw/132","comment_is_top":false,"comment_ctime":1603114980,"is_pvip":true,"replies":[{"id":"93057","content":"要是单台机器负载还okay的话，可以考虑多线程消费。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1603354527,"ip_address":"","comment_id":254425,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1603114980","product_id":100029201,"comment_content":"对于给定的Topic，假设有3个分区，如果因为业务需要，消息需要存放在某个指定分区；而这个分区比其他两个分区消息数目大一个数量级；同时下游接入的是一个消费者组，对于一个分区只能指定给消费者组内某个consumer实例来消费的前提下，我有一些疑惑：<br>1.这个consumer实例单位时间内消化不了这么多消息，是不是只能通过增加机器配置的方式解决？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507391,"discussion_content":"要是单台机器负载还okay的话，可以考虑多线程消费。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603354527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246087,"user_name":"prepared","can_delete":false,"product_type":"c1","uid":1194853,"ip_address":"","ucode":"00E54A5C7CDCBE","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/65/3a4fc8cf.jpg","comment_is_top":false,"comment_ctime":1599176025,"is_pvip":false,"replies":[{"id":"90472","content":"一个group有10个consumer，这10个consumer共订阅了10个topic，每个topic 1个分区。那么这10个分区分别分配给10个consumer。每个consumer消费一个分区。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1599205511,"ip_address":"","comment_id":246087,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599176025","product_id":100029201,"comment_content":"| Consumer Group 下所有实例订阅的主题的单个分区，只能分配给组内的某个 Consumer 实例消费<br>这句话什么意思？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505057,"discussion_content":"一个group有10个consumer，这10个consumer共订阅了10个topic，每个topic 1个分区。那么这10个分区分别分配给10个consumer。每个consumer消费一个分区。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599205511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241391,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1597283674,"is_pvip":false,"replies":[{"id":"89377","content":"group下有多少consumer是你定的，多少都可以。只是最佳实践是consumer数等同于订阅的总分区数（注意是总分区数而不是总topic数）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1597628564,"ip_address":"","comment_id":241391,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1597283674","product_id":100029201,"comment_content":"这个数是怎么算的？<br><br>一个group订阅了3个分区    groyp内的consumer不是等于3么？怎么等于6呢<br><br>理想情况下，Consumer 实例的数量应该等于该 Group 订阅主题的分区总数。<br>举个简单的例子，假设一个 Consumer Group 订阅了 3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3，那么通常情况下，为该 Group 设置 6 个 Consumer 实例是比较理想的情形，因为它能最大限度地实现高伸缩性。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503733,"discussion_content":"group下有多少consumer是你定的，多少都可以。只是最佳实践是consumer数等同于订阅的总分区数（注意是总分区数而不是总topic数）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597628564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234865,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1594815264,"is_pvip":false,"replies":[{"id":"86714","content":"无限消息流怎么做到全局的优先级获取呢？因为我们永远不能知道下一条消息的优先级。所以能否详细解释下你这里的优先级获取的含义、","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1594860391,"ip_address":"","comment_id":234865,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594815264","product_id":100029201,"comment_content":"您好，我实现在同一个topic中，通过优先级获取消息，这个具体怎么实现呢？请老师指点下思路","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501531,"discussion_content":"无限消息流怎么做到全局的优先级获取呢？因为我们永远不能知道下一条消息的优先级。所以能否详细解释下你这里的优先级获取的含义、","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594860391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230036,"user_name":"Pyer","can_delete":false,"product_type":"c1","uid":1159237,"ip_address":"","ucode":"8287EFD2268211","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/45/f0a63850.jpg","comment_is_top":false,"comment_ctime":1593245844,"is_pvip":false,"replies":[{"id":"84952","content":"是的。只要你使用消费者组机制，就会受制于这个rebalance：）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1593304815,"ip_address":"","comment_id":230036,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593245844","product_id":100029201,"comment_content":"老师好，kafka消费端的rebalance是默认自动开启么?","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499744,"discussion_content":"是的。只要你使用消费者组机制，就会受制于这个rebalance：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593304815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228751,"user_name":"水银湖","can_delete":false,"product_type":"c1","uid":1179011,"ip_address":"","ucode":"28BB2E47D8C30A","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/83/48cc0d83.jpg","comment_is_top":false,"comment_ctime":1592799085,"is_pvip":false,"replies":[{"id":"84417","content":"消费者组可以消费多个主题。常见的场景是比如消费以business1开头的所有主题这种用法。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1592874910,"ip_address":"","comment_id":228751,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1592799085","product_id":100029201,"comment_content":"如果有这么一种机制，既可以避开这两种模型的缺陷，又兼具它们的优点，那就太好了。幸运的是，Kafka 的 Consumer Group 就是这样的机制。当 Consumer Group 订阅了多个主题后，组内的每个实例不要求一定要订阅主题的所有分区，它只会消费部分分区中的消息。<br><br>消费组为什么能对应多个主题？好处是啥呢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499175,"discussion_content":"消费者组可以消费多个主题。常见的场景是比如消费以business1开头的所有主题这种用法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592874910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329272,"discussion_content":"为啥订阅多个主题，还是看业务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606357312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179011,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fd/83/48cc0d83.jpg","nickname":"水银湖","note":"","ucode":"28BB2E47D8C30A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285549,"discussion_content":"感谢解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592876822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228749,"user_name":"水银湖","can_delete":false,"product_type":"c1","uid":1179011,"ip_address":"","ucode":"28BB2E47D8C30A","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/83/48cc0d83.jpg","comment_is_top":false,"comment_ctime":1592798827,"is_pvip":false,"replies":[{"id":"84418","content":"一个消费者组可以消费多个主题的消息。多个主题也能被多个消费者组消费。从这个角度看，说是多对多也算成立","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1592874944,"ip_address":"","comment_id":228749,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592798827","product_id":100029201,"comment_content":"看描述，是说主题与消费组是多对多关系？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499173,"discussion_content":"一个消费者组可以消费多个主题的消息。多个主题也能被多个消费者组消费。从这个角度看，说是多对多也算成立","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592874944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227644,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1592448290,"is_pvip":false,"replies":[{"id":"83936","content":"👍","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1592472829,"ip_address":"","comment_id":227644,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592448290","product_id":100029201,"comment_content":"Kafka对Consumer Group的位移管理<br>消费者在消费的过程中需要记录自己消费了多少数据，即消费位置信息。在 Kafka 中，这个位置信息有个专门的术语：位移（Offset）。<br>位移数据结构<br>对于 Consumer Group 而言，它是一组 K-V 对，Key 是分区，V 对应 Consumer 消费该分区的最新位移。<br>简单理解为：Map&lt;TopicPartition, Long&gt;，其中 TopicPartition 表示一个分区，而 Long 表示位移的类型。<br>位移存储位置<br>新版本的 Consumer Group 中，Kafka 社区重新设计了 Consumer Group 的位移管理方式，采用了将位移保存在 Kafka  Broker端的内部主题------__consumer_offsets中。<br><br>Consumer Group的Rebalance<br>Rebalance 本质上是一种协议，规定了一个 Consumer Group 下的所有 Consumer 如何达成一致，来分配订阅 Topic 的每个分区。比如某个 Group 下有 20 个 Consumer 实例，它订阅了一个具有 100 个分区的 Topic。正常情况下，Kafka 平均会为每个 Consumer 分配 5 个分区。这个分配的过程就叫 Rebalance。<br>消费者组Rebalance的缺陷<br>● 在Rebalance 发生时，Group 下所有的 Consumer 实例都会协调在一起共同参与，全部被重新分配所有分区。<br>● 在 Rebalance 过程中，所有 Consumer 实例都会停止消费，等待 Rebalance 完成。<br>● Reblance过程本身比较慢，几百个 Consumer 实例，成功 Rebalance 一次要几个小时！<br>","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498733,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592472829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225525,"user_name":"耿嘉艺","can_delete":false,"product_type":"c1","uid":2023401,"ip_address":"","ucode":"727A22BD41E8AF","user_header":"","comment_is_top":false,"comment_ctime":1591776787,"is_pvip":false,"replies":[{"id":"83109","content":"元数据信息保存在__consumer_offsets主题中。瓦特是指？","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1591797481,"ip_address":"","comment_id":225525,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1591776787","product_id":100029201,"comment_content":"consumer group中的消费者元数据信息保存在哪里？怎么判断有一个消费者瓦特了","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497880,"discussion_content":"元数据信息保存在__consumer_offsets主题中。瓦特是指？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591797481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379599,"discussion_content":"他是上海银","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624005422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218539,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1589815092,"is_pvip":false,"replies":[{"id":"80800","content":"没太懂您的意思。总之消费者实例会分享订阅的所有分区。至于这个实例是进程还是线程，不会影响这个分配。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589850466,"ip_address":"","comment_id":218539,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589815092","product_id":100029201,"comment_content":"看了下评论,有些疑惑.<br>请问老师,<br>设置同一个group.id,三个不同进程(项目),这三个实例就是消费同一个主题不同分区.<br>同一个进程三个线程,那三个实例也是消费同一个主题不同分区吗","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495506,"discussion_content":"没太懂您的意思。总之消费者实例会分享订阅的所有分区。至于这个实例是进程还是线程，不会影响这个分配。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589850466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210832,"user_name":"胡小禾","can_delete":false,"product_type":"c1","uid":1132315,"ip_address":"","ucode":"1C23B7492C0C9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","comment_is_top":false,"comment_ctime":1587831108,"is_pvip":false,"replies":[{"id":"78456","content":"多个consumer订阅同一个消息队列所以伸缩性差，改用发布&#47;订阅之后会有所缓解，但多是全量订阅~","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1587865594,"ip_address":"","comment_id":210832,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1587831108","product_id":100029201,"comment_content":"传统消息队列，为啥  多个consumer 会抢一个消息，会产生 伸缩性的问题","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493120,"discussion_content":"多个consumer订阅同一个消息队列所以伸缩性差，改用发布/订阅之后会有所缓解，但多是全量订阅~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587865594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","nickname":"胡小禾","note":"","ucode":"1C23B7492C0C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249426,"discussion_content":"老师的意思是 ： 这个消息队列没有类似卡夫卡的分区特性，可以支持横向伸缩？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587918466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207675,"user_name":"firstblood","can_delete":false,"product_type":"c1","uid":1015168,"ip_address":"","ucode":"B53CC5FAECA34D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqjbwXwF3YUcSw7A8v6f0sAYzQMloOWg62aciaGfzZWibRw2jjTja1Vwh5CLVGZdseM6gSBnC1hRzEQ/132","comment_is_top":false,"comment_ctime":1587134665,"is_pvip":false,"replies":[{"id":"77811","content":"“每个partition就poll一个消息回来” --- 你是说每次poll回来只有1条消息？看看max.poll.records的取值，没有显式设置成1吧？？<br><br>另外，你用的是什么go客户端啊？是Confluent公司的吗？还是那个？","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1587345976,"ip_address":"","comment_id":207675,"utype":1}],"discussion_count":6,"race_medal":0,"score":"1587134665","product_id":100029201,"comment_content":"老师您好，我遇到一个奇怪的线上问题，环境时一个topic有12个partition，只有一个消费者，也注册了消费者组，但消费消息时候，每个partition就poll一个消息回来，下一次就会换一个partition再poll消息，这个导致消费的性能非常差，想问一下是什么导致的。消费者的程序是go写的，初始化时候就填写了brokers，groupid，topic，其他的都是用默认的","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492205,"discussion_content":"“每个partition就poll一个消息回来” --- 你是说每次poll回来只有1条消息？看看max.poll.records的取值，没有显式设置成1吧？？\n\n另外，你用的是什么go客户端啊？是Confluent公司的吗？还是那个？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587345976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1141254,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/06/66831563.jpg","nickname":"阡陌","note":"","ucode":"58634836C8E03F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294869,"discussion_content":"我理解的是，12个partition保存的是不同的数据，单个消费者要依次消费所有的数据","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596019940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1015168,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqjbwXwF3YUcSw7A8v6f0sAYzQMloOWg62aciaGfzZWibRw2jjTja1Vwh5CLVGZdseM6gSBnC1hRzEQ/132","nickname":"firstblood","note":"","ucode":"B53CC5FAECA34D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1141254,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6a/06/66831563.jpg","nickname":"阡陌","note":"","ucode":"58634836C8E03F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332664,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607302444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294869,"ip_address":""},"score":332664,"extra":""}]},{"author":{"id":1270262,"avatar":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","nickname":"wang","note":"","ucode":"C1A3BCACCB188E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258301,"discussion_content":"我之前也遇到过这个情况，可以看一下，这个库的这个方法是不是真正实现了ConsumerGroup 的，还是仅仅显示的去获得某一个parition 消费的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588676150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1015168,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqjbwXwF3YUcSw7A8v6f0sAYzQMloOWg62aciaGfzZWibRw2jjTja1Vwh5CLVGZdseM6gSBnC1hRzEQ/132","nickname":"firstblood","note":"","ucode":"B53CC5FAECA34D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1270262,"avatar":"https://static001.geekbang.org/account/avatar/00/13/61/f6/1d6b548a.jpg","nickname":"wang","note":"","ucode":"C1A3BCACCB188E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258419,"discussion_content":"嗯嗯，我仔细读读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588686352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":258301,"ip_address":""},"score":258419,"extra":""}]},{"author":{"id":1015168,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqjbwXwF3YUcSw7A8v6f0sAYzQMloOWg62aciaGfzZWibRw2jjTja1Vwh5CLVGZdseM6gSBnC1hRzEQ/132","nickname":"firstblood","note":"","ucode":"B53CC5FAECA34D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248352,"discussion_content":"是segment的库，我看了看初始化client时候的配置里没有records这个配置，但有一个minbytes和maxbytes，默认是10kb和1mb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587865173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205330,"user_name":"星期八","can_delete":false,"product_type":"c1","uid":1185504,"ip_address":"","ucode":"34A37F73A48E7F","user_header":"https://static001.geekbang.org/account/avatar/00/12/16/e0/7abad3cc.jpg","comment_is_top":false,"comment_ctime":1586594196,"is_pvip":false,"replies":[{"id":"76724","content":"hmmm.... 我倒没觉得这两个有相似之处，哈哈哈","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1586609625,"ip_address":"","comment_id":205330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586594196","product_id":100029201,"comment_content":"Rebalance怎么有点类似hash和一致性hash，当遇到数据迁移hash要计算每一个数据，达到平衡，一致性则不用","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491449,"discussion_content":"hmmm.... 我倒没觉得这两个有相似之处，哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586609625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184378,"user_name":"张丽娜","can_delete":false,"product_type":"c1","uid":1032331,"ip_address":"","ucode":"D70CFF68E72DAF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/8b/0371baee.jpg","comment_is_top":false,"comment_ctime":1583303301,"is_pvip":false,"replies":[{"id":"71364","content":"因为分区数总共是6个，每个consumer实例读取一个分区数是最理想的情况。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1583368763,"ip_address":"","comment_id":184378,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1583303301","product_id":100029201,"comment_content":"举个简单的例子，假设一个 Consumer Group 订阅了 3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3，那么通常情况下，为该 Group 设置 6 个 Consumer 实例是比较理想的情形，因为它能最大限度地实现高伸缩性。为什么6个理想的情形？有些不理解呢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485993,"discussion_content":"因为分区数总共是6个，每个consumer实例读取一个分区数是最理想的情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583368763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1080210,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7b/92/0f1a7fd6.jpg","nickname":"[發][發][發][發]","note":"","ucode":"848C71253925ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290776,"discussion_content":"3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3\n\n这样的话不是应该有 9 个分区嘛？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594603918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172433,"user_name":"tony007","can_delete":false,"product_type":"c1","uid":1784317,"ip_address":"","ucode":"B7856A57D34EF5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmq56WXiabfEE8NyyAHLicMpa6pxuSIxVb4BBp5k3vukp27DYsRYVibicp8ZyQZMQvUn7TYw89jUk4gA/132","comment_is_top":false,"comment_ctime":1579175925,"is_pvip":false,"replies":[{"id":"67067","content":"没太懂你的意思。。你是想让某个consumer实例完整地消费主题的所有分区吗？如果是，那么不能采用consumer group机制，需要采用standalone consumer","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1579394197,"ip_address":"","comment_id":172433,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1579175925","product_id":100029201,"comment_content":"Consumer Group 下所有实例订阅的主题的单个分区，那么一个主题有多个分区，如何针对主题进行消费？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481739,"discussion_content":"没太懂你的意思。。你是想让某个consumer实例完整地消费主题的所有分区吗？如果是，那么不能采用consumer group机制，需要采用standalone consumer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579394197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329273,"discussion_content":"Topicpartion对象里面肯定会封装，主题名和分区信息的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606357584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170416,"user_name":"l241025097","can_delete":false,"product_type":"c1","uid":1734693,"ip_address":"","ucode":"93CE6FEF490980","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaFd63wtL3jSS51Wqlzeibpgn0KTg2S5FtJODcsBUV0Cpx6KMibTLOO8TFGRQLf1eltEs9uibaoNnUNdvGh4lIsqVg/132","comment_is_top":false,"comment_ctime":1578601229,"is_pvip":false,"replies":[{"id":"66073","content":"python api确实接触比较少，更不必说是非Confluent python api了。恐怕我能提供的建议非常少，我只能建议你去对应的github上去看看是否存在相同的问题了。通常来说这些诡异的问题都是因为client端自己代码问题造成的。。。。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1578618882,"ip_address":"","comment_id":170416,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1578601229","product_id":100029201,"comment_content":"老师好，我一直在用kafka python api，是不是比较冷门。。。之前碰到消息送生产者时延时很大的问题，搜了半天都说是这个api的问题，推荐去用confluent-kafka python api，由于有一种先入为主的观念，也担心是自己哪个参数没设置对，就坚持各种修改配置来尝试，最后是在检测到数据量突增时开启多个进程来向broker发送来解决这问题的，看了参数那一节，感觉应该是broker message max bytes影响的，不知道对不对，在生产环境中也没再去试了。之后还是这个api该碰到了消费者group id和client id配置不一致造成不同组消费混乱问题，起初没问题，但是在消费一段时间后，不同组的两个消费组相互影响，停掉一个组后，另一个组才能消费，有说是该api的问题，在将client id和group id设置成相同值后确实这个问题就不再出现了，这也是自己对kafka架构甚至是对zookeeper的不理解，始终没能定位到问题，老师对这个问题怎么看。我们小团队又开发又运维又测试，可能没有太多时间去实验去细究，一旦正常了就不会再去破坏这个平衡了。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480977,"discussion_content":"python api确实接触比较少，更不必说是非Confluent python api了。恐怕我能提供的建议非常少，我只能建议你去对应的github上去看看是否存在相同的问题了。通常来说这些诡异的问题都是因为client端自己代码问题造成的。。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578618882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1734693,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaFd63wtL3jSS51Wqlzeibpgn0KTg2S5FtJODcsBUV0Cpx6KMibTLOO8TFGRQLf1eltEs9uibaoNnUNdvGh4lIsqVg/132","nickname":"l241025097","note":"","ucode":"93CE6FEF490980","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214443,"discussion_content":"关于python kafka生产者接口的写到kafka慢的问题，之前使用的是搜索出来排序第一的kafka-python包，使用过程中发现随着一次写入的数据增加，写入到kafka的时间也线性增加，因此之前解决的办法是判断数据量突增时，启动多个进程来对数据分批次同时写入。\n现在发现另外一个包: confluent-kafka。confluent果然是面向企业级的解决方案，虽然他的kafka项目收费，但是这个python包是免费的。如果是linux或mac平台，pip安装时直接内置了librdkafka c语言库，性能超强。把kafka-python换成confluent-kafka后，不用再启用多个进程，直接解决写入kafka延迟问题。\n如果是用python开发生产者的小团队，直接使用confluent-kafka这个python包。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585193680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1734693,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaFd63wtL3jSS51Wqlzeibpgn0KTg2S5FtJODcsBUV0Cpx6KMibTLOO8TFGRQLf1eltEs9uibaoNnUNdvGh4lIsqVg/132","nickname":"l241025097","note":"","ucode":"93CE6FEF490980","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":130701,"discussion_content":"非常感谢老师的回答，还是要培养读源码的能力啊，我到github上找找。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578787552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147039,"user_name":"注定非凡","can_delete":false,"product_type":"c1","uid":1113597,"ip_address":"","ucode":"80673056E131B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/fd/fd/326be9bb.jpg","comment_is_top":false,"comment_ctime":1572772626,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1572772626","product_id":100029201,"comment_content":"好的，老师😁","like_count":0},{"had_liked":false,"id":142201,"user_name":"Kong","can_delete":false,"product_type":"c1","uid":1699383,"ip_address":"","ucode":"713F121F1CF103","user_header":"https://static001.geekbang.org/account/avatar/00/19/ee/37/f17451cc.jpg","comment_is_top":false,"comment_ctime":1571309123,"is_pvip":false,"replies":[{"id":"54915","content":"分别是 A、B、C，它们的分区数依次是 1、2、3，6个分区啊。可能没表述清楚","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1571361481,"ip_address":"","comment_id":142201,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1571309123","product_id":100029201,"comment_content":"三个主题，三个分区不应该是9个消费者实例嘛，为什么是6个。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471027,"discussion_content":"分别是 A、B、C，它们的分区数依次是 1、2、3，6个分区啊。可能没表述清楚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571361481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1699383,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ee/37/f17451cc.jpg","nickname":"Kong","note":"","ucode":"713F121F1CF103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36313,"discussion_content":"不是应该每个消费者实例对应一个分区嘛，，三个主题，每个主题都有三个分区，3*3不是9嘛，6是怎么出来的，能不能详细说说，我刚学kafka。谢谢老师了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571361832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1080210,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7b/92/0f1a7fd6.jpg","nickname":"[發][發][發][發]","note":"","ucode":"848C71253925ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1699383,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ee/37/f17451cc.jpg","nickname":"Kong","note":"","ucode":"713F121F1CF103","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290778,"discussion_content":"同样蒙 +1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594604035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36313,"ip_address":""},"score":290778,"extra":""}]}]},{"had_liked":false,"id":138863,"user_name":"😈😈😈😈😈","can_delete":false,"product_type":"c1","uid":1197447,"ip_address":"","ucode":"A563EC007FEB7D","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/87/b32dc1ea.jpg","comment_is_top":false,"comment_ctime":1570495040,"is_pvip":false,"replies":[{"id":"53498","content":"单个消费者获取数据不全，但是所有消费者聚在一起就全了啊，这有什么问题吗？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1570503464,"ip_address":"","comment_id":138863,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570495040","product_id":100029201,"comment_content":"消费者组中的每个消费者实例，只能消费一部分数据，这样会导致导致单个消费者实例获取的数据不全！！这样不会有问题吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469674,"discussion_content":"单个消费者获取数据不全，但是所有消费者聚在一起就全了啊，这有什么问题吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570503464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138050,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1569998947,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569998947","product_id":100029201,"comment_content":"我唯一能想到的消费组的弊端就是 一条消息能被消费多次，多个消费组解消息的代码部分是重复^_^","like_count":0},{"had_liked":false,"id":130369,"user_name":"giantbroom","can_delete":false,"product_type":"c1","uid":1059516,"ip_address":"","ucode":"7258784193C302","user_header":"","comment_is_top":false,"comment_ctime":1567435928,"is_pvip":true,"replies":[{"id":"48675","content":"目前Kafka消费的最小粒度就是分区，因此一旦consumer实例数大于分区数，必然有空闲consumer的。你的后一个问题没有太明白。。。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567473103,"ip_address":"","comment_id":130369,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1567435928","product_id":100029201,"comment_content":"我认为当消费者实例说多于分区数是，多余的实例处于空闲的设计是有问题的，应该能够参与消费分区消息，这样能够极大提高TPS，当然前提是消费端是无状态的。另外关于rebalance有一点不解，按照目前的逻辑，岂不是要求任何一个消费者实例有能力处理所有topic的逻辑，这岂不是很不合理？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465927,"discussion_content":"目前Kafka消费的最小粒度就是分区，因此一旦consumer实例数大于分区数，必然有空闲consumer的。你的后一个问题没有太明白。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567473103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1059516,"avatar":"","nickname":"giantbroom","note":"","ucode":"7258784193C302","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7541,"discussion_content":"我开始的思路是多个消费者进程共同消费同一分区的主题，后面看到多线程，多进程相比就太重了。第二个问题，应该是我对消费者组理解有误，一个消费者只能消费一个主题，不能夸主题，是吗？如果是这样，可以忽略第二个问题了，翻篇。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567560931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118314,"user_name":"金hb.Ryan 冷空氣駕到","can_delete":false,"product_type":"c1","uid":1222233,"ip_address":"","ucode":"CAD363576696E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","comment_is_top":false,"comment_ctime":1564319424,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564319424","product_id":100029201,"comment_content":"@楼主，我看一下 应该是统一配置成roundrobin 吧","like_count":0},{"had_liked":false,"id":117544,"user_name":"早起的鸟儿","can_delete":false,"product_type":"c1","uid":1083332,"ip_address":"","ucode":"EDB4C51C379EE0","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/c4/50c8a490.jpg","comment_is_top":false,"comment_ctime":1564071072,"is_pvip":false,"replies":[{"id":"43055","content":"可能没写清楚。我是说有3个主题，它们的分区数分别是1，2，3，总共6个分区。。。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564102270,"ip_address":"","comment_id":117544,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1564071072","product_id":100029201,"comment_content":"举个简单的例子，假设一个 Consumer Group 订阅了 3 个主题，分别是 A、B、C，它们的分区数依次是 1、2、3，那么通常情况下，为该 Group 设置 6 个 Consumer 实例是比较理想的情形，因为它能最大限度地实现高伸缩性。<br>老师你好，这个地方没太理解，每个主题只有3个分区，为什么要设置6个consumer实例，如果每个consumer实例消费主题的一个分区，3个分区只需要3个consumer实例，这样不是会多出3个consumer实例吗？还望解答，谢谢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460018,"discussion_content":"可能没写清楚。我是说有3个主题，它们的分区数分别是1，2，3，总共6个分区。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564102270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1096984,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bd/18/2af6bf4b.jpg","nickname":"兔2🐰🍃","note":"","ucode":"1FEDA044BB6CBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7176,"discussion_content":"原来是每个主题的分区个数，我也理解为序号了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567416258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1080210,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7b/92/0f1a7fd6.jpg","nickname":"[發][發][發][發]","note":"","ucode":"848C71253925ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1096984,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bd/18/2af6bf4b.jpg","nickname":"兔2🐰🍃","note":"","ucode":"1FEDA044BB6CBD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290779,"discussion_content":"原来是这样。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594604131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7176,"ip_address":""},"score":290779,"extra":""}]}]},{"had_liked":false,"id":117301,"user_name":"金hb.Ryan 冷空氣駕到","can_delete":false,"product_type":"c1","uid":1222233,"ip_address":"","ucode":"CAD363576696E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","comment_is_top":false,"comment_ctime":1564020365,"is_pvip":false,"replies":[{"id":"43014","content":"是否所有的consumer都统一使用了roundrobin?","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564062235,"ip_address":"","comment_id":117301,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564020365","product_id":100029201,"comment_content":"前面打错了。。。前两天我们一个场景‘一个topic八个partition，一个consumergroup三台服务器，原先是默认range的分配，可改成roundrobin分配以后一直在做rebalance，改回range又好了，kafka版本0.10，有遇到过这种场景么，这个consumergroup还在消费另外两个topic数据不知道有没有关系","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459902,"discussion_content":"是否所有的consumer都统一使用了roundrobin?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564062235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116398,"user_name":"金hb.Ryan 冷空氣駕到","can_delete":false,"product_type":"c1","uid":1222233,"ip_address":"","ucode":"CAD363576696E4","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","comment_is_top":false,"comment_ctime":1563846643,"is_pvip":false,"replies":[{"id":"42579","content":"“原先是默认range的分配，可改成range分配以后一直在做rebalance，改回range又好了”。。。 我有点凌乱了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563849765,"ip_address":"","comment_id":116398,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563846643","product_id":100029201,"comment_content":"前两天我们一个场景‘一个topic八个partition，一个consumergroup三台服务器，原先是默认range的分配，可改成range分配以后一直在做rebalance，改回range又好了，kafka版本0.10，有遇到过这种场景么","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459521,"discussion_content":"“原先是默认range的分配，可改成range分配以后一直在做rebalance，改回range又好了”。。。 我有点凌乱了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563849765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112564,"user_name":"Algoric","can_delete":false,"product_type":"c1","uid":1298722,"ip_address":"","ucode":"78D9850A88C254","user_header":"https://static001.geekbang.org/account/avatar/00/13/d1/22/706c492e.jpg","comment_is_top":false,"comment_ctime":1562760351,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562760351","product_id":100029201,"comment_content":"看了重平衡，希望大佬后面能够讲下副本在broker上具体如何分配，以及生产环境下分区平衡怎么实现","like_count":0},{"had_liked":false,"id":112510,"user_name":"丘壑","can_delete":false,"product_type":"c1","uid":1118203,"ip_address":"","ucode":"ECFEDA5A93828D","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/fb/68196d4c.jpg","comment_is_top":false,"comment_ctime":1562748878,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562748878","product_id":100029201,"comment_content":"以前搞过一个车联网项目，最初就是采用的指定分区进行消费，但是由于消息量太大，导致了消费者实例有时出现了问题，比如内存溢出，程序半夜可能出现问题，这个时候由于各种原因处理不了，这样就导致了某几个分区没有消费者消费，当时就想改造为按group的方式进行消费，借助kafka-Rebalance可以有其他消费者顶替，减少运维负担，按照本讲中的思想，这种大数据量的消息场景完全不能使用group的Rebalance进行消费啊，这。。。。。。。忘解惑，","like_count":0},{"had_liked":false,"id":112151,"user_name":"双叶","can_delete":false,"product_type":"c1","uid":1009260,"ip_address":"","ucode":"6DA1D477F9D580","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/6c/4a68a916.jpg","comment_is_top":false,"comment_ctime":1562675653,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562675653","product_id":100029201,"comment_content":"最后的例子中，如果不同 topic 的流量差异很大，那么就可能会造成机器之间负载差异较大？","like_count":0},{"had_liked":false,"id":111866,"user_name":"bunny","can_delete":false,"product_type":"c1","uid":1513004,"ip_address":"","ucode":"EB5A8447708CE6","user_header":"https://static001.geekbang.org/account/avatar/00/17/16/2c/243c354a.jpg","comment_is_top":false,"comment_ctime":1562632899,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562632899","product_id":100029201,"comment_content":"胡老师，在你举的rebalance好几个小时的例子中，假如事先知道是增加实例还是减少实例，那么这样做是不是好些：先停止所有消费者实例，然后再启动！当然如果是其他未知的因素导致rebalance，那就控制不了了","like_count":0},{"had_liked":false,"id":111796,"user_name":"空知","can_delete":false,"product_type":"c1","uid":1013283,"ip_address":"","ucode":"C448E98238DD36","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","comment_is_top":false,"comment_ctime":1562601236,"is_pvip":false,"replies":[{"id":"40687","content":"1. 不会重置，如果这个分区由组内其他consumer分配了，也是接着之前的进度继续消费。<br>2. 可以","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562635445,"ip_address":"","comment_id":111796,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1562601236","product_id":100029201,"comment_content":"老师请教下<br>1、消费者位移 是记录 分区和偏移量的 没有记录是哪个消费者,这样的话下一个消费者来消费这个分区时候 偏移量是重置的嘛?<br>2、多个group订阅同一个topic时候 不同group可以同时访问一个leader分区嘛?","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457450,"discussion_content":"1. 不会重置，如果这个分区由组内其他consumer分配了，也是接着之前的进度继续消费。\n2. 可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562635445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130646,"avatar":"https://static001.geekbang.org/account/avatar/00/11/40/96/1e8697ec.jpg","nickname":"Garfield","note":"","ucode":"2865B698A88421","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1604,"discussion_content":"还是没有理解，多个group的consumer可以消费同一个主题和分区，并且同一条消息会分发到不同组，这个位移怎么管理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562726875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1348830,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","nickname":"td901105","note":"","ucode":"32D42A4F36FA02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1130646,"avatar":"https://static001.geekbang.org/account/avatar/00/11/40/96/1e8697ec.jpg","nickname":"Garfield","note":"","ucode":"2865B698A88421","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":138597,"discussion_content":"位移管理里面应该有groupId的字段的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579255503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1604,"ip_address":""},"score":138597,"extra":""}]}]},{"had_liked":false,"id":111737,"user_name":"gogogo","can_delete":false,"product_type":"c1","uid":1273993,"ip_address":"","ucode":"D7B7A9AA2D4CE5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wonzX0yIia5NFoB0TZPdIPqVicIuSvzMtowownIkO9VwYpkPWJP2tpEcv5RXMn0ayuEGkAp2GBualL5sFQs0ibQJQ/132","comment_is_top":false,"comment_ctime":1562592588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562592588","product_id":100029201,"comment_content":"rebalance需要客户端编码支持吗？","like_count":0},{"had_liked":false,"id":111451,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1562559767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562559767","product_id":100029201,"comment_content":"我觉得不好地方：一是限制了并发度消费者个数最大只能和kafka的分数数一样；如果kafka的数据再分区中不平衡就导致了只能等一个消费者慢慢消费；多个消费者组那就要保存多个消费组的位移信息，这个也蛮坑的，那个消费组位移的topic我记得是不是也有坑。","like_count":0},{"had_liked":false,"id":111403,"user_name":"Geek_jacky","can_delete":false,"product_type":"c1","uid":1564542,"ip_address":"","ucode":"F6ABD94A03BE7B","user_header":"","comment_is_top":false,"comment_ctime":1562552913,"is_pvip":false,"replies":[{"id":"40693","content":"没有什么不同，至少对于Kafka而言","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562636634,"ip_address":"","comment_id":111403,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562552913","product_id":100029201,"comment_content":"老师好，多进程同一个消费组去消费同一个topic，会出现有的进程消费不到的问题。同时一个进程多个线程消费同一个topic是可以的，那这个多线程与多进程同消费组消费同一个topic这两个之间有什么不一样？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457337,"discussion_content":"没有什么不同，至少对于Kafka而言","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562636634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111392,"user_name":"外星人","can_delete":false,"product_type":"c1","uid":1132861,"ip_address":"","ucode":"D8469B13F2AB37","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg","comment_is_top":false,"comment_ctime":1562550826,"is_pvip":false,"replies":[{"id":"40695","content":"会影响位移提交啊","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562636754,"ip_address":"","comment_id":111392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562550826","product_id":100029201,"comment_content":"那也就是说__consumer_offset这个topic和其他的topic做reassign的时候可以一样对待，没有特殊需要考虑或注意的地方是吗？consumer的groupcoordinator不是根据partition  leader所在的broker来确定的吗？做reassign会不会影响消费端啊？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457332,"discussion_content":"会影响位移提交啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562636754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111348,"user_name":"老醋","can_delete":false,"product_type":"c1","uid":1308401,"ip_address":"","ucode":"D6DF921AAB9E7A","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/f1/5ccbe3fe.jpg","comment_is_top":false,"comment_ctime":1562547093,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562547093","product_id":100029201,"comment_content":"不行吧，Kafka为了消除多个consumer消费同一分区进行的同步操作，组内不同consumer不能消费同一分区","like_count":0},{"had_liked":false,"id":111066,"user_name":"蒙开强","can_delete":false,"product_type":"c1","uid":1317706,"ip_address":"","ucode":"61B3183781B9F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/4a/f9df2d06.jpg","comment_is_top":false,"comment_ctime":1562462214,"is_pvip":false,"replies":[{"id":"40502","content":"没有一个参数来设置此事。主要看启动了多少个具有相同group.id的consumer实例。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546392,"ip_address":"","comment_id":111066,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562462214","product_id":100029201,"comment_content":"老师，你好，怎么设置消费组里的消费实例个数呢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457208,"discussion_content":"没有一个参数来设置此事。主要看启动了多少个具有相同group.id的consumer实例。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"朴素柠檬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329275,"discussion_content":"一个consumer实例中开启多个线程，每个线程也会被视为一个consumer实例的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606357784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110929,"user_name":"October","can_delete":false,"product_type":"c1","uid":1137879,"ip_address":"","ucode":"CEDA78F4A5F8B1","user_header":"https://static001.geekbang.org/account/avatar/00/11/5c/d7/e4673fde.jpg","comment_is_top":false,"comment_ctime":1562398270,"is_pvip":false,"replies":[{"id":"40507","content":"嗯。如果单个分区依然数据很多，可以考虑多加一些分区，将数据分散到更多的分区上，降低单个分区的负载。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562546697,"ip_address":"","comment_id":110929,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562398270","product_id":100029201,"comment_content":"一个TopicPatition的消息只能被消费组的某个消费者所消费，当出现数据倾斜时（比如某个key的消息的特别多就会导致数据倾斜），可能一个消费者的的消费速度不足以应付业务对消息处理延迟的要求，不知道这算不算一个缺点。请老师指正。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457128,"discussion_content":"嗯。如果单个分区依然数据很多，可以考虑多加一些分区，将数据分散到更多的分区上，降低单个分区的负载。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562546697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1059579,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/fb/e2b29825.jpg","nickname":"Bing","note":"","ucode":"1A9745BBF0CDDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1243,"discussion_content":"这个数据倾斜跟consumer group没关系，应该要重新设计repartition算法","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562463253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110918,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1562394079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562394079","product_id":100029201,"comment_content":"看的我都stop the word ！一口气看完！看觉一下子吸收了不少功法套路！","like_count":0}]}