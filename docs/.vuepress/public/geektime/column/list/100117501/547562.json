{"id":547562,"title":"06ï½œå¦‚ä½•ä½¿ç”¨ ffprobe åˆ†æéŸ³è§†é¢‘å‚æ•°ä¸å†…å®¹ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜æ­§ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/546485\">ä¸Šä¸€èŠ‚è¯¾</a>æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨FFmpegå’ŒOBSåšç›´æ’­æ¨æµï¼Œå½“æ—¶æˆ‘ç»™ä½ ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ï¼Œæ€ä¹ˆç¡®è®¤æ’­æ”¾çš„æµæ˜¯æˆ‘ä»¬è‡ªå·±æ¨çš„é‚£ä¸ªç›´æ’­æµå‘¢ï¼Ÿæƒ³å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„è¿™ä¸ªè§†é¢‘ä¿¡æ¯åˆ†æç¥å™¨â€”â€”ffprobeã€‚å®ƒæ˜¯FFmpegæä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œèƒ½å¤Ÿç”¨æ¥åˆ†æéŸ³è§†é¢‘å®¹å™¨æ ¼å¼ã€éŸ³è§†é¢‘æµä¿¡æ¯ã€éŸ³è§†é¢‘åŒ…ä»¥åŠéŸ³è§†é¢‘å¸§ç­‰ä¿¡æ¯ï¼Œåœ¨æˆ‘ä»¬åšéŸ³è§†é¢‘è½¬ç ã€æ•…éšœåˆ†ææ—¶ï¼Œè¿™ä¸ªå·¥å…·èƒ½æä¾›å¾ˆå¤§çš„å¸®åŠ©ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨ffprobeæ¥åˆ†æéŸ³è§†é¢‘ç›¸å…³ä¿¡æ¯ã€‚</p><h2>éŸ³è§†é¢‘å®¹å™¨æ ¼å¼åˆ†æ</h2><p>å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ã€ä¸€ä¸ªè§†é¢‘ç›´æ’­URLé“¾æ¥æ—¶ï¼Œé€šå¸¸çš„æ“ä½œæ˜¯æ’­æ”¾ï¼Œæˆ–è€…æ˜¯åˆ†æå…¶éŸ³è§†é¢‘å®¹å™¨æ ¼å¼çš„ä¿¡æ¯ã€‚æ’­æ”¾æ“ä½œæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œå¦‚æœæƒ³è¦åˆ†æéŸ³è§†é¢‘å®¹å™¨æ ¼å¼çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>å…¶å®ä½¿ç”¨<strong>ffprobeçš„-show_format</strong>å‚æ•°å°±èƒ½å¾—åˆ°å¯¹åº”çš„ä¿¡æ¯äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºçš„å†…å®¹ã€‚</p><pre><code class=\"language-plain\">[FORMAT]\nfilename=/Users/liuqi/Movies/Test/ToS-4k-1920.mov\nnb_streams=2\nnb_programs=0\nformat_name=mov,mp4,m4a,3gp,3g2,mj2\nformat_long_name=QuickTime / MOV\nstart_time=0.000000\nduration=734.167000\nsize=738876331\nbit_rate=8051316\nprobe_score=100\nTAG:major_brand=qt\nTAG:minor_version=512\nTAG:compatible_brands=qt\nTAG:encoder=Lavf54.29.104\n[/FORMAT]\n</code></pre><!-- [[[read_end]]] --><p>æˆ‘ä»¬æ¥é€ä¸€åœ°è§£è¯»ä¸€ä¸‹é‡Œé¢è•´å«çš„ä¿¡æ¯ã€‚</p><p>ä»è¾“å‡ºä¿¡æ¯ç¬¬äºŒè¡Œçš„åç¼€å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªmovæ–‡ä»¶ã€‚nb_streamsæ˜¾ç¤ºçš„æ˜¯2ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå®¹å™¨æ ¼å¼é‡Œæœ‰ä¸¤ä¸ªæµï¼›nb_programsæ˜¯0ï¼Œè¡¨ç¤ºè¿™é‡Œé¢ä¸å­˜åœ¨programä¿¡æ¯ï¼Œè¿™ä¸ªprogramä¿¡æ¯å¸¸è§äºå¹¿ç”µç”¨çš„mpegtsæµé‡Œï¼Œæ¯”å¦‚æŸä¸ªå«è§†é¢‘é“çš„èŠ‚ç›®ï¼›start_timeæ˜¯è¿™ä¸ªå®¹å™¨é‡Œæ­£å¸¸çš„æ˜¾ç¤ºå¼€å§‹çš„æ—¶é—´0.00000ï¼›durationæ˜¯è¿™ä¸ªå®¹å™¨æ–‡ä»¶çš„æ€»æ—¶é•¿734.167ç§’ï¼›æ¥ç€å°±æ˜¯sizeè¡¨ç¤ºè¿™ä¸ªmovæ–‡ä»¶å¤§å°ï¼›bit_rateæ˜¯è¿™ä¸ªæ–‡ä»¶çš„ç ç‡ã€‚</p><p>ç„¶åä¸‹é¢å°±æ˜¯probeæŸ¥æ‰¾å®¹å™¨æ ¼å¼çš„å¾—åˆ†ï¼ŒFFmpegåœ¨probeè¿™ä¸ªæ–‡ä»¶ä¸­å¯¹åº”çš„å¾—åˆ†æ˜¯100ï¼Œè¿™ä¸ªå¾—åˆ†é€šå¸¸ç”¨æ¥ç¡®å®šä½¿ç”¨å“ªä¸ªå®¹å™¨æ¨¡å—æ¥è§£æè¿™ä¸ªprobeæ–‡ä»¶ã€‚æœ€åå°±æ˜¯å¯¹åº”å®¹å™¨çš„TAGã€‚</p><p>å…¶å®åˆ†æå®¹å™¨æ ¼å¼çš„è¯ï¼Œå¾—åˆ°çš„ä¿¡æ¯å¹¶ä¸æ˜¯ç‰¹åˆ«å…¨ï¼Œä½†æ˜¯å®¹å™¨æ ¼å¼é‡Œé¢çš„è¿™äº›ä¿¡æ¯æ˜¯å…·æœ‰ä¸€å®šçš„å‚è€ƒä»·å€¼çš„ï¼Œå¦‚æœæƒ³è¦è·å¾—å®¹å™¨æ ¼å¼é‡Œä¸€äº›æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¿˜éœ€è¦å¯¹å®¹å™¨æ ¼å¼é‡Œé¢çš„éŸ³è§†é¢‘æµè¿›è¡Œåˆ†æã€‚</p><h2>éŸ³è§†é¢‘æµåˆ†æ</h2><p>éŸ³è§†é¢‘æµçš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>ffprobeçš„-show_streams</strong>è·å–åˆ°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é€šè¿‡show_streamsèƒ½å¾—åˆ°å“ªäº›å†…å®¹å‘¢ï¼Ÿæˆ‘ä»¬ä»¥è§†é¢‘æ–‡ä»¶ä¸­çš„è§†é¢‘æµä¸ºä¾‹æ¥åˆ†æä¸€ä¸‹ï¼Œå¦‚æœä½ å¯¹éŸ³é¢‘æµæœ‰å…´è¶£ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æˆ‘ä»¬åˆ†æè§†é¢‘æµçš„æ–¹å¼åˆ†æä¸€ä¸‹éŸ³é¢‘æµã€‚</p><pre><code class=\"language-plain\">[STREAM]\nindex=0 //æµçš„ç´¢å¼•å·\ncodec_name=h264 //æµçš„ç¼–ç å\ncodec_long_name=H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 //æµçš„ç¼–ç è¯¦ç»†æè¿°\nprofile=High //æµçš„profile\ncodec_type=video //æµçš„codecç±»å‹\ncodec_tag_string=avc1 // æµçš„codec tag å­—ç¬¦ä¸²\ncodec_tag=0x31637661 // æµçš„codec tagï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œåªä¸è¿‡ä»¥16è¿›åˆ¶æ–¹å¼å­˜å‚¨\nwidth=1920 //è§†é¢‘çš„å®½ï¼Œæµå†…å®¹éƒ¨åˆ†\nheight=800 //è§†é¢‘çš„é«˜ï¼Œæµå†…å®¹éƒ¨åˆ†\ncoded_width=1920 // ç¼–ç è§†é¢‘çš„å®½ï¼Œç¼–è§£ç æ—¶çš„éƒ¨åˆ†ï¼Œå¯¹é½çš„æ•°æ®ï¼Œæ˜¾ç¤ºæ—¶ä¸ç”¨\ncoded_height=800 // ç¼–ç è§†é¢‘çš„é«˜ï¼Œç¼–è§£ç æ—¶çš„éƒ¨åˆ†ï¼Œå¯¹é½çš„æ•°æ®ï¼Œæ˜¾ç¤ºæ—¶ä¸ç”¨\nhas_b_frames=2 // IPB å¸§æ’åˆ—æ—¶ä¸¤ä¸ªPä¹‹é—´åŒ…å«ä¸¤ä¸ªB\nsample_aspect_ratio=1:1 //åƒç´ ç‚¹é‡‡æ ·æ¯”ä¾‹\ndisplay_aspect_ratio=12:5 // æ˜¾ç¤ºå›¾åƒæ¯”ä¾‹\npix_fmt=yuv420p // åƒç´ ç‚¹æ ¼å¼\nlevel=40 // ä¸profileä¸€èµ·å‡ºç°ï¼Œå¯¹åº”çš„æ˜¯å‚è€ƒæ ‡å‡†ä¸­æœ‰å¯¹åº”çš„å‚æ•°æè¿°\ncolor_range=unknown //è°ƒè‰²å¿…å¤‡å‚æ•°\ncolor_space=unknown //è°ƒè‰²å¿…å¤‡å‚æ•°\ncolor_transfer=unknown  //è°ƒè‰²å¿…å¤‡å‚æ•°\ncolor_primaries=unknown //è°ƒè‰²å¿…å¤‡å‚æ•°\nfield_order=progressive // éš”è¡Œæ‰«æé€è¡Œæ‰«ææ ‡è¯†\nr_frame_rate=24/1  // å®é™…å¸§ç‡\navg_frame_rate=24/1 // å¹³å‡å¸§ç‡\ntime_base=1/24 //æ—¶é—´åŸºï¼Œé€šå¸¸å’Œå¸§ç‡æœ‰å¯¹åº”å…³ç³»\nstart_pts=0 // å¼€å§‹æ—¶é—´æˆ³\nstart_time=0.000000 // å¼€å§‹æ—¶é—´\nduration_ts=17620 //duration æ—¶é—´æˆ³\nduration=734.166667 // duration æ—¶é—´\nbit_rate=7862427 // ç ç‡\nmax_bit_rate=N/A // æœ€å¤§ç ç‡\nbits_per_raw_sample=8 // åŸå§‹æ•°æ®æ¯ä¸ªé‡‡æ ·å ä½\nnb_frames=17620 // æ€»å¸§æ•°\nextradata_size=42 // extradata å¤§å°\nTAG:language=eng // è¿™ä¸ªæ˜¯TAGï¼Œä¸»è¦æ˜¯å±•ç¤ºè¯­ç§\nTAG:handler_name=VideoHandle // å¥æŸ„å\nTAG:vendor_id=FFMP // ç”ŸæˆMP4æ–‡ä»¶çš„å·¥å…·\nTAG:encoder=libx264 // è§†é¢‘ç¼–ç å™¨æ ‡è¯†\n[/STREAM]\n</code></pre><p>ä»æˆ‘ä»¬è·å–çš„è¿™ä¸ªè§†é¢‘æµçš„å†…å®¹ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒéŸ³è§†é¢‘æµçš„ä¿¡æ¯ï¼Œç”¨[STREAM]æ ‡ç­¾æ‹¬èµ·æ¥äº†ï¼Œæ ‡ç­¾é‡Œé¢çš„å†…å®¹æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®codec_typeæ¥åŒºåˆ†è¿™ä¸ªæµæ˜¯éŸ³é¢‘è¿˜æ˜¯è§†é¢‘ã€‚é€šè¿‡codec_nameæ¥ç¡®å®šè¿™ä¸ªæµæ˜¯ä»€ä¹ˆç¼–ç çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬è¿™ä¸ªæµæ˜¯H.264ç¼–ç çš„è§†é¢‘æµã€‚è€Œè¿™ä¸ªæµçš„profileæ˜¯High profileï¼ŒLevelæ˜¯40ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„4.0ã€‚H.264ç¼–ç ä¸ä»…ä»…æœ‰High Profileï¼Œè¿˜æœ‰Main Profileã€Baseline Profileï¼Œå„ç§Profileè¿˜å¯ä»¥é…åˆå¤šç§Levelï¼Œä¸åŒç»„åˆæ ‡å‡†çš„ç¼–ç å‚æ•°ä¿¡æ¯ä¼šæœ‰ä¸€äº›ä¸åŒï¼Œåº”ç”¨åœºæ™¯ä¹Ÿä¼šæœ‰å·®åˆ«ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯ä½ å¯ä»¥æŸ¥çœ‹H.264çš„å‚è€ƒæ ‡å‡†æ–‡æ¡£çš„é™„å½•Aéƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬å›æ¥ç»§ç»­çœ‹è¿™ä¸ªæµä¿¡æ¯ï¼Œæ³¨æ„è¿™ä¸ªcodecçš„tag_stringæ˜¯avc1ï¼Œå› ä¸ºè§†é¢‘ç¼–ç ä¼šå°è£…åˆ°å®¹å™¨ä¸­ï¼Œä¸åŒçš„å®¹å™¨å¯¹tag_stringçš„æ”¯æŒä¹Ÿä¸åŒï¼Œæˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„æ˜¯H.264ï¼Œå…¶å®åœ¨HLSçš„å‚è€ƒæ ‡å‡†é‡Œï¼Œfragment mp4é‡ŒHEVCç¼–ç çš„tag_stringå°±ä¸åªæ˜¯avc1ä¸€ç§TAGäº†ï¼ŒHEVCç¼–ç è¢«å°è£…åˆ°fragment mp4çš„è¯è¿˜å¯ä»¥æ”¯æŒHVC1ã€HEV1ã€‚è€Œåœ¨HLSçš„fragment mp4é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šå°è£…æˆHVC1çš„tag_stringæ‰å¯ä»¥è¢«æ­£å¸¸åœ°æ’­æ”¾å‡ºæ¥ï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬æ’æŸ¥é—®é¢˜æ—¶ä¹Ÿæ˜¯éœ€è¦ç”¨åˆ°çš„ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯å®½é«˜ä¿¡æ¯ï¼Œæ˜¯å¦åŒ…å«Bå¸§ï¼Œæ¯ä¸ªGOPï¼ˆå›¾åƒç»„ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªå…³é”®å¸§ä¸­é—´çš„æ•°æ®ï¼ŒåŒ…å«å›¾åƒç»„çš„å¤´éƒ¨å…³é”®å¸§ï¼‰ä¹‹é—´åŒ…å«å¤šå°‘ä¸ªBå¸§ã€‚sample_aspect_ratioï¼ˆSARï¼‰æ•°æ®é‡‡æ ·å®½é«˜æ¯”ï¼Œdisplay_aspect_ratioï¼ˆDARï¼‰æ˜¾ç¤ºå®½é«˜æ¯”ï¼Œè¿™ä¸¤ä¸ªæ•°å€¼ä¸­é—´å¦‚æœæœ‰å·®åˆ«çš„è¯ï¼Œè‚¯å®šæœ‰ä¸€ä¸ªå› ç´ ï¼Œå°±æ˜¯åƒç´ ç‚¹ä¸æ˜¯çŸ©å½¢çš„ï¼Œä¸æ˜¯1æ¯”1çš„å•ä¸ªåƒç´ ç‚¹ã€‚è¿™å°±äº§ç”Ÿäº†Pixel Aspect Ratioï¼ˆPARï¼‰åƒç´ å®½é«˜æ¯”ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£å®ƒä»¬çš„å…³ç³»ï¼š</p><p>$$DAR = SAR \\times PAR$$</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°pix_fmtæ˜¯yuv420pï¼Œåœ¨<a href=\"https://time.geekbang.org/column/article/546485\">ç¬¬5èŠ‚è¯¾</a>ä¸­ï¼Œæˆ‘ä»¬å­¦æ¨æµç¼–ç æ—¶åƒç´ ç‚¹ç”¨çš„ä¹Ÿæ˜¯yuv420pï¼Œå› ä¸ºåœ¨è§†é¢‘é¢†åŸŸå®ƒçš„å…¼å®¹æ€§æ›´å¥½ã€‚é€šå¸¸äº’è”ç½‘ä¸Šçš„è§†é¢‘æµå¯¹åº”çš„åƒç´ ç‚¹æ ¼å¼ï¼Œæœ€å¸¸è§çš„ä¹Ÿæ˜¯yuv420pã€‚</p><p>ç„¶ååœ¨è§†é¢‘æµçš„ä¿¡æ¯é‡Œé¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä¸€äº›è§†é¢‘è‰²å½©ç©ºé—´å¯¹åº”çš„ä¿¡æ¯ï¼Œåœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ²¡æœ‰è§£ææ­£ç¡®çš„ï¼Œå…¨éƒ½æ˜¯unkownã€‚</p><p>è§†é¢‘çš„åœºç¼–ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­—æ®µæ˜¯field_order=progressiveï¼Œä¹Ÿå°±æ˜¯é€è¡Œç¼–ç ã€‚å…³äºåœºç¼–ç ï¼Œæˆ‘ä»¬<a href=\"https://time.geekbang.org/column/article/541546\">ç¬¬1èŠ‚è¯¾</a>è¯´è¿‡ï¼Œå› ä¸ºä»¥å‰æ˜¾ç¤ºè®¾å¤‡åˆ·æ–°èƒ½åŠ›æœ‰é™ï¼Œåœ¨ç¼–ç å’Œè§£ç çš„æ—¶å€™éœ€è¦æ”¯æŒé¡¶åœºå’Œåº•åœºçš„éš”è¡Œæ‰«æç¼–è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ‹¿åˆ°çš„è¿™ä¸ªè§†é¢‘æµä¸æ˜¯éš”è¡Œæ‰«æäº†ï¼Œè€Œæ˜¯é€è¡Œæ‰«æã€‚å› ä¸ºåˆ†è¾¨ç‡æ˜¯1920x800çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç§°ä¹‹ä¸º1080pã€‚</p><p>è§†é¢‘çš„start_timeä¸å®¹å™¨æ ¼å¼ä¸­ä¸€æ ·ï¼Œæ˜¯0.000000ã€‚durationåˆ™ä¸å®¹å™¨æ ¼å¼é‡Œé¢çš„durationæœ‰äº›ä¸åŒäº†ï¼Œduration=734.166667ï¼Œå› ä¸ºå®¹å™¨æ ¼å¼å’Œè§†é¢‘æµæ˜¯ä¸¤ä¸ªä¿¡æ¯å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥éš¾å…ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚è§†é¢‘ç ç‡æ˜¯7862427ï¼Œå¸§ç‡å…±åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼šå®é™…ä¸Šæœ€åŸºç¡€çš„å¸§ç‡ r_frame_rate=24/1ï¼›å®é™…ä¸Šå¹³å‡å¸§ç‡ avg_frame_rate=24/1ï¼›æ—¶é—´åŸºï¼Œé€šå¸¸ç§°ä¹‹ä¸ºtimebaseï¼Œtime_base=1/24ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šå¸§ç‡è¡¨ç¤ºå‘¢ï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬åœ¨ç»™è§†é¢‘ç¼–ç å¯¹åº”æˆè§†é¢‘æµï¼Œå°è£…åˆ°å®¹å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šæœ‰å¤šä¸ªåœ°æ–¹è®°å½•è§†é¢‘å¸§ä¿¡æ¯ï¼ŒåŠ ä¸Šè§†é¢‘æµæœ‰å¯èƒ½æ˜¯å¯å˜å¸§ç‡çš„ï¼Œå› æ­¤éœ€è¦å¤šä¸ªå‚è€ƒå€¼ã€‚åœ¨è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šä¸ªå€¼æå–å‡ºæ¥ï¼Œåˆ†æå“ªä¸ªæ›´é€‚åˆæˆ‘ä»¬è‡ªå·±çš„ä½¿ç”¨åœºæ™¯ï¼Œå½“ç„¶å¹¶ä¸æ˜¯å›ºå®šæŸä¸€ä¸ªå°±è‚¯å®šæ˜¯å‡†ç¡®çš„ï¼Œå¸§ç‡åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹å¾ˆå®¹æ˜“å‡ºç°å„ç§è¯¡å¼‚çš„é—®é¢˜ï¼ŒFFmpegèƒ½åšçš„å°±æ˜¯æŠŠå„ä¸ªèŠ‚ç‚¹çš„å¸§ç‡ä¿¡æ¯å°½é‡å…¨é¢åœ°æä¾›ç»™æˆ‘ä»¬ã€‚</p><p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè§†é¢‘æµé‡Œé¢ä¸€å…±åŒ…å«äº†17620å¸§å›¾åƒï¼Œè¿™ä¸ªæ•°æ®æœ‰äº›å®¹å™¨ä¸ä¸€å®šèƒ½æ‹¿å¾—åˆ°ï¼Œæœ‰äº›ä¸ä¸€å®šèƒ½æ‹¿å¾—å‡†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™¤äº†é€šè¿‡show_streamsè·å–è¿™äº›ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å•ç‹¬å¯¹è§†é¢‘åŒ…è¿›è¡Œé€åŒ…æŸ¥çœ‹ä¸åˆ†æï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆç”¨ffprobeå‚æ•°æ¥æŸ¥çœ‹éŸ³è§†é¢‘åŒ…çš„ä¿¡æ¯ã€‚</p><h2>éŸ³è§†é¢‘åŒ…åˆ†æ</h2><p>åœ¨æˆ‘ä»¬æ‹¿åˆ°è§†é¢‘æ–‡ä»¶æˆ–è§†é¢‘æµURLä¹‹åï¼Œä¸ºäº†æ›´ç²¾å‡†åœ°åˆ†æé—®é¢˜ï¼Œä¹Ÿä¼šç»å¸¸ç”¨åˆ°<strong>ffprobeçš„-show_packets</strong>å‚æ•°ï¼Œffprobeçš„show_packetså‚æ•°å¯ä»¥å°†éŸ³è§†é¢‘çš„æ‰€æœ‰åŒ…éƒ½åˆ—å‡ºæ¥ã€‚</p><p>å› ä¸ºéŸ³é¢‘åŒ…å’Œè§†é¢‘åŒ…æ”¾åœ¨ä¸€èµ·äº¤é”™æ˜¾ç¤ºï¼Œçœ‹ä¸Šå»ä¼šæ¯”è¾ƒå¤æ‚å¹¶ä¸”è´¹åŠ²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨select_streams væ¥åªè¯»å–è§†é¢‘æµçš„åŒ…ã€‚ffprobeé»˜è®¤è¾“å‡ºå†…å®¹æ˜¯å¹³é“ºæ¨¡å¼çš„ï¼Œæ‰€ä»¥ä¸€å±åªèƒ½è¾“å‡ºå‡ ä¸ªåŒ…çš„ä¿¡æ¯ï¼Œä¸ºäº†ä¸€å±èƒ½å¤Ÿè¾“å‡ºæ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨-ofæ¥å®šåˆ¶è¾“å‡ºçš„ä¿¡æ¯æ ¼å¼ï¼Œä¾‹å¦‚xmlï¼Œé‚£ä¹ˆè¾“å‡ºçš„packetä¿¡æ¯æ ¼å¼å°±æ˜¯è¿™æ ·ï¼š</p><pre><code class=\"language-plain\">&lt;packets&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"0\" pts_time=\"0.000000\" dts=\"-2\" dts_time=\"-0.083333\" duration=\"1\" duration_time=\"0.041667\" size=\"5264\" pos=\"36\" flags=\"K_\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"4\" pts_time=\"0.166667\" dts=\"-1\" dts_time=\"-0.041667\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"5300\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"2\" pts_time=\"0.083333\" dts=\"0\" dts_time=\"0.000000\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"5313\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"1\" pts_time=\"0.041667\" dts=\"1\" dts_time=\"0.041667\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"6382\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"3\" pts_time=\"0.125000\" dts=\"2\" dts_time=\"0.083333\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"7417\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"8\" pts_time=\"0.333333\" dts=\"3\" dts_time=\"0.125000\" duration=\"1\" duration_time=\"0.041667\" size=\"17\" pos=\"8378\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"6\" pts_time=\"0.250000\" dts=\"4\" dts_time=\"0.166667\" duration=\"1\" duration_time=\"0.041667\" size=\"15\" pos=\"9407\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"5\" pts_time=\"0.208333\" dts=\"5\" dts_time=\"0.208333\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"9933\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"7\" pts_time=\"0.291667\" dts=\"6\" dts_time=\"0.250000\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"10913\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"12\" pts_time=\"0.500000\" dts=\"7\" dts_time=\"0.291667\" duration=\"1\" duration_time=\"0.041667\" size=\"17\" pos=\"11884\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"10\" pts_time=\"0.416667\" dts=\"8\" dts_time=\"0.333333\" duration=\"1\" duration_time=\"0.041667\" size=\"15\" pos=\"12907\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"9\" pts_time=\"0.375000\" dts=\"9\" dts_time=\"0.375000\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"13927\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"11\" pts_time=\"0.458333\" dts=\"10\" dts_time=\"0.416667\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"14450\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"16\" pts_time=\"0.666667\" dts=\"11\" dts_time=\"0.458333\" duration=\"1\" duration_time=\"0.041667\" size=\"17\" pos=\"15482\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"14\" pts_time=\"0.583333\" dts=\"12\" dts_time=\"0.500000\" duration=\"1\" duration_time=\"0.041667\" size=\"15\" pos=\"16480\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"13\" pts_time=\"0.541667\" dts=\"13\" dts_time=\"0.541667\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"17462\" flags=\"__\"/&gt;\n        &lt;packet codec_type=\"video\" stream_index=\"0\" pts=\"15\" pts_time=\"0.625000\" dts=\"14\" dts_time=\"0.583333\" duration=\"1\" duration_time=\"0.041667\" size=\"13\" pos=\"18478\" flags=\"__\"/&gt;\n</code></pre><p>ä»è¾“å‡ºçš„å†…å®¹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œshow_packetsé‡Œé¢åŒ…å«äº†å¤šä¸ªpacketåŒ…ï¼Œå› ä¸ºæˆ‘ä»¬é€‰æ‹©çš„æ˜¯è§†é¢‘æµï¼Œæ‰€ä»¥codec_typeæ˜¯è§†é¢‘codecï¼Œæµçš„ç´¢å¼•æ˜¯0ã€‚åé¢å°±æ˜¯ptsä¸pts_timeã€dtsä¸dts_timeã€duratrionå’Œduration_timeã€åŒ…çš„sizeå¤§å°ã€åŒ…çš„æ•°æ®æ‰€åœ¨æ–‡ä»¶çš„åç§»ä½ç½®ï¼Œæœ€åæ˜¯æŸ¥çœ‹è¿™ä¸ªæ•°æ®åŒ…æ˜¯Keyframeå…³é”®å¸§è¿˜æ˜¯æ™®é€šå¸§ï¼Œæ˜¯ä¸æ˜¯DiscardåŒ…ç­‰ã€‚</p><p>DiscardåŒ…é€šå¸¸ä¼šåœ¨è§£ç æˆ–è€…æ’­æ”¾çš„æ—¶å€™è¢«ä¸¢å¼ƒï¼Œè¿™ä¸ªæ˜¯éœ€è¦æ³¨æ„çš„ï¼Œåˆ†æé—®é¢˜çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µã€‚åœ¨è¿™äº›ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å‘ç°ptsè¿˜æœ‰å¯¹åº”çš„pts_timeï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºptsæ˜¯è·Ÿstreamçš„timebaseåšæ—¶é—´è½¬æ¢ä¹‹å‰çš„æ•°å€¼ï¼Œè€Œpts_timeè¿™ä¸ªå€¼æ˜¯ä¸streamçš„timebaseåšæ—¶é—´è½¬æ¢ä¹‹åçš„å€¼ï¼Œptsã€dtsã€durationæ˜¯int64çš„ç±»å‹ï¼Œpts_timeã€dts_timeã€duration_timeæ˜¯doubleæµ®ç‚¹ç±»å‹ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œptsä¸dtsæ•°å€¼çš„æ’åˆ—é¡ºåºæœ‰äº›ä¸å¤ªä¸€æ ·ï¼Œdtsæ˜¯é¡ºåºæ’åˆ—çš„ï¼Œptsæ˜¯å‰åè·³çš„ï¼Œè¿™æ˜¯å› ä¸ºç¼–ç çš„æ—¶å€™è§†é¢‘æ•°æ®ä¸­æœ‰Bå¸§ï¼Œè§£ç çš„æ—¶å€™å¯ä»¥é¡ºåºè§£ç ï¼Œä½†æ˜¯æ˜¾ç¤ºçš„æ—¶å€™éœ€è¦é‡æ–°æŒ‰ç…§ptsçš„é¡ºåºæ˜¾ç¤ºã€‚ç”¨show_packetæˆ‘ä»¬èƒ½çœ‹åˆ°ptsä¸dtsçš„é¡ºåºä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¹Ÿèƒ½çœ‹åˆ°æ˜¯å¦æ˜¯keyframeï¼Œä½†æ— æ³•ç¡®è®¤packetæ˜¯Iå¸§ã€På¸§è¿˜æ˜¯Bå¸§ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿç¡®è®¤è¿™äº›ä¿¡æ¯ï¼Œé™¤äº†show_packetsä¹‹å¤–ï¼Œffprobeè¿˜å¯ä»¥é€šè¿‡show_framesæ¥æŸ¥çœ‹å¸§ç±»å‹ç­‰ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹éŸ³è§†é¢‘çš„å¸§åˆ†æã€‚</p><h2>éŸ³è§†é¢‘å¸§åˆ†æ</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å®¹å™¨æ ¼å¼åˆ†æã€éŸ³è§†é¢‘æµåˆ†æä»¥åŠéŸ³è§†é¢‘åŒ…åˆ†æä¸‰ç§åˆ†ææ–¹æ³•ï¼Œå…¶å®ä»¥ä¸Šä¸‰ä¸ªç»´åº¦çš„åˆ†ææ˜¯å¯ä»¥æ‹¿åˆ°éŸ³è§†é¢‘å¸§ä»¥å¤–çš„ä¿¡æ¯çš„ã€‚å¦‚æœæƒ³è¦æ‹¿åˆ°éŸ³è§†é¢‘å¸§ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡éŸ³è§†é¢‘å¸§çš„ä¿¡æ¯æ¥åˆ†æçš„ï¼Œä¾‹å¦‚å¯ä»¥åˆ†æå‡ºå½“å‰è¿™ä¸ªè§†é¢‘å¸§æ˜¯Iå¸§ã€På¸§è¿˜æ˜¯Bå¸§ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ç”¨è§†é¢‘æ¥ä¸¾ä¾‹ï¼Œå­¦å®Œä¹‹åä½ å¯ä»¥æ ¹æ®è¿™èŠ‚è¯¾å­¦åˆ°çš„æŠ€èƒ½ç”¨éŸ³é¢‘æ¥ç»ƒä¹ ã€‚æˆ‘ä»¬ç”¨<strong>ffprobeçš„-show_frames</strong>æ¥çœ‹ä¸€ä¸‹æ‹¿åˆ°çš„å¸§ä¿¡æ¯éƒ½æœ‰å“ªäº›ã€‚</p><pre><code class=\"language-plain\"> &lt;frames&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"1\" pts=\"0\" pts_time=\"0.000000\" pkt_dts=\"0\" pkt_dts_time=\"0.000000\" best_effort_timestamp=\"0\" best_effort_timestamp_time=\"0.000000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"36\" pkt_size=\"5264\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"I\" coded_picture_number=\"0\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"&gt;\n            &lt;side_data_list&gt;\n                &lt;side_data side_data_type=\"H.26[45] User Data Unregistered SEI message\"/&gt;\n            &lt;/side_data_list&gt;\n        &lt;/frame&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"1\" pts_time=\"0.041667\" pkt_dts=\"1\" pkt_dts_time=\"0.041667\" best_effort_timestamp=\"1\" best_effort_timestamp_time=\"0.041667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"6382\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"3\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"2\" pts_time=\"0.083333\" pkt_dts=\"2\" pkt_dts_time=\"0.083333\" best_effort_timestamp=\"2\" best_effort_timestamp_time=\"0.083333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"5313\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"2\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"3\" pts_time=\"0.125000\" pkt_dts=\"3\" pkt_dts_time=\"0.125000\" best_effort_timestamp=\"3\" best_effort_timestamp_time=\"0.125000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"7417\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"4\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"4\" pts_time=\"0.166667\" pkt_dts=\"4\" pkt_dts_time=\"0.166667\" best_effort_timestamp=\"4\" best_effort_timestamp_time=\"0.166667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"5300\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"P\" coded_picture_number=\"1\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"5\" pts_time=\"0.208333\" pkt_dts=\"5\" pkt_dts_time=\"0.208333\" best_effort_timestamp=\"5\" best_effort_timestamp_time=\"0.208333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"9933\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"7\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"6\" pts_time=\"0.250000\" pkt_dts=\"6\" pkt_dts_time=\"0.250000\" best_effort_timestamp=\"6\" best_effort_timestamp_time=\"0.250000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"9407\" pkt_size=\"15\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"6\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"7\" pts_time=\"0.291667\" pkt_dts=\"7\" pkt_dts_time=\"0.291667\" best_effort_timestamp=\"7\" best_effort_timestamp_time=\"0.291667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"10913\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"8\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"8\" pts_time=\"0.333333\" pkt_dts=\"8\" pkt_dts_time=\"0.333333\" best_effort_timestamp=\"8\" best_effort_timestamp_time=\"0.333333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"8378\" pkt_size=\"17\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"P\" coded_picture_number=\"5\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"9\" pts_time=\"0.375000\" pkt_dts=\"9\" pkt_dts_time=\"0.375000\" best_effort_timestamp=\"9\" best_effort_timestamp_time=\"0.375000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"13927\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"11\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"10\" pts_time=\"0.416667\" pkt_dts=\"10\" pkt_dts_time=\"0.416667\" best_effort_timestamp=\"10\" best_effort_timestamp_time=\"0.416667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"12907\" pkt_size=\"15\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"10\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"11\" pts_time=\"0.458333\" pkt_dts=\"11\" pkt_dts_time=\"0.458333\" best_effort_timestamp=\"11\" best_effort_timestamp_time=\"0.458333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"14450\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"12\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"12\" pts_time=\"0.500000\" pkt_dts=\"12\" pkt_dts_time=\"0.500000\" best_effort_timestamp=\"12\" best_effort_timestamp_time=\"0.500000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"11884\" pkt_size=\"17\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"P\" coded_picture_number=\"9\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"13\" pts_time=\"0.541667\" pkt_dts=\"13\" pkt_dts_time=\"0.541667\" best_effort_timestamp=\"13\" best_effort_timestamp_time=\"0.541667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"17462\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"15\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"14\" pts_time=\"0.583333\" pkt_dts=\"14\" pkt_dts_time=\"0.583333\" best_effort_timestamp=\"14\" best_effort_timestamp_time=\"0.583333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"16480\" pkt_size=\"15\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"14\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"15\" pts_time=\"0.625000\" pkt_dts=\"15\" pkt_dts_time=\"0.625000\" best_effort_timestamp=\"15\" best_effort_timestamp_time=\"0.625000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"18478\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"16\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"16\" pts_time=\"0.666667\" pkt_dts=\"16\" pkt_dts_time=\"0.666667\" best_effort_timestamp=\"16\" best_effort_timestamp_time=\"0.666667\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"15482\" pkt_size=\"17\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"P\" coded_picture_number=\"13\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"0\" pts=\"17\" pts_time=\"0.708333\" pkt_dts=\"17\" pkt_dts_time=\"0.708333\" best_effort_timestamp=\"17\" best_effort_timestamp_time=\"0.708333\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"24496\" pkt_size=\"13\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"B\" coded_picture_number=\"18\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        &lt;frame media_type=\"video\" stream_index=\"0\" key_frame=\"1\" pts=\"18\" pts_time=\"0.750000\" pkt_dts=\"18\" pkt_dts_time=\"0.750000\" best_effort_timestamp=\"18\" best_effort_timestamp_time=\"0.750000\" pkt_duration=\"1\" pkt_duration_time=\"0.041667\" pkt_pos=\"18961\" pkt_size=\"4554\" width=\"1920\" height=\"800\" pix_fmt=\"yuv420p\" sample_aspect_ratio=\"1:1\" pict_type=\"I\" coded_picture_number=\"17\" display_picture_number=\"0\" interlaced_frame=\"0\" top_field_first=\"0\" repeat_pict=\"0\" chroma_location=\"left\"/&gt;\n        \n</code></pre><p>ä»è§†é¢‘å¸§ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªkeyframeä¸­æºå¸¦ç€side_dataï¼Œæ˜¯å…³äºH.264çš„ç¼–ç å™¨ç›¸å…³çš„ç”¨æˆ·ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨å¼€æºçš„x264åšè§†é¢‘ç¼–ç çš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°x264çš„æ ‡è¯†ä¿¡æ¯ã€‚</p><p>è¿™ä¸€æ®µè¾“å‡ºä¿¡æ¯ä¸­å¸§ä¿¡æ¯æœ‰ä¸¤ä¸ªkeyframeï¼Œä¹Ÿå¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªGOPå¤§å°çš„å¸§ï¼Œè¿™ä¸ªå¸§çš„ä¸ªæ•°ä¸æˆ‘ä»¬ç”¨show_packetså‚æ•°æ—¶çœ‹åˆ°çš„packetçš„æ•°é‡ï¼Œåº”è¯¥æ˜¯èƒ½åŒ¹é…å¾—ä¸Šçš„ï¼Œä½†å·®åˆ«æ˜¯è¿™é‡Œçš„ptsæ˜¯é¡ºåºæ’åˆ—çš„ï¼Œä¹Ÿèƒ½çœ‹åˆ°å¯¹åº”çš„packet sizeå’Œpacket posï¼Œè€Œä¸”è¿™é‡Œè¿˜èƒ½çœ‹åˆ°å¸§çš„ç±»å‹ã€å›¾åƒå®½é«˜ã€åƒç´ ç‚¹æ ¼å¼ã€å®½é«˜æ¯”ç­‰åœºç¼–ç ä¸€ç±»çš„ä¿¡æ¯ã€‚show_packetsä¸show_framesæ­é…ä¸€èµ·åˆ†æéŸ³è§†é¢‘æ•°æ®åŒ…ï¼Œä¼šç²¾ç¡®å¾ˆå¤šã€‚</p><p>ä»ä¸Šé¢çš„ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ç°ä¸€ä¸ªå…±åŒçš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸ä¼šæ‹¿åˆ°ä¸€å¤§å †æˆ‘ä»¬å¯èƒ½å¹¶ä¸éœ€è¦çš„å­—æ®µï¼Œä¸ºäº†ç²¾å‡†åœ°è·å¾—è‡ªå·±éœ€è¦çš„å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ffprobeä¸­çš„-show_entriesæ¥æŒ‡å®šè‡ªå·±æƒ³è¦çš„å­—æ®µï¼Œä¾‹å¦‚é…åˆshow_packetï¼Œæˆ‘æƒ³æ‹¿åˆ°packetçš„pts_timeã€dts_timeå’Œflagsï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨show_packetsä¸show_entriesæ¥æ“ä½œã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">ffprobe -show_packets -select_streams v -of xml -show_entries packet=pts_time,dts_time,flags  ~/Movies/Test/ToS-4k-1920.mov\n</code></pre><p>ç„¶åè¾“å‡ºçš„å†…å®¹å°±ä¼šç²¾ç®€å¾ˆå¤šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">    &lt;packets&gt;\n        &lt;packet pts_time=\"0.000000\" dts_time=\"-0.083333\" flags=\"K_\"/&gt;\n        &lt;packet pts_time=\"0.166667\" dts_time=\"-0.041667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.083333\" dts_time=\"0.000000\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.041667\" dts_time=\"0.041667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.125000\" dts_time=\"0.083333\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.333333\" dts_time=\"0.125000\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.250000\" dts_time=\"0.166667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.208333\" dts_time=\"0.208333\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.291667\" dts_time=\"0.250000\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.500000\" dts_time=\"0.291667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.416667\" dts_time=\"0.333333\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.375000\" dts_time=\"0.375000\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.458333\" dts_time=\"0.416667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.666667\" dts_time=\"0.458333\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.583333\" dts_time=\"0.500000\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.541667\" dts_time=\"0.541667\" flags=\"__\"/&gt;\n        &lt;packet pts_time=\"0.625000\" dts_time=\"0.583333\" flags=\"__\"/&gt;\n</code></pre><p>å…³äºéŸ³è§†é¢‘å°è£…å®¹å™¨ã€éŸ³è§†é¢‘æµã€éŸ³è§†é¢‘åŒ…ã€éŸ³è§†é¢‘å¸§ä¹‹é—´å¯¹åº”çš„å…³ç³»ï¼Œæˆ‘ä»¬ç”¨å›¾ç‰‡æ¥è¡¨ç¤ºä¼šæ›´ç›´è§‚ä¸€äº›ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/70/2aa125f394e765d15250e52bc6589c70.png?wh=1418x666\" alt=\"å›¾ç‰‡\"></p><p>ä»¥MPEGTSå°è£…ä¸ºä¾‹ï¼Œå°è£…é‡Œé¢åŒ…å«3ä¸ªæµï¼Œåˆ†åˆ«æ˜¯è§†é¢‘æµï¼ŒéŸ³é¢‘æµï¼Œå­—å¹•æµï¼Œè§†é¢‘æµä¸­éœ€è¦å­˜å‚¨å¯¹åº”çš„è§†é¢‘ç¼–ç å‚æ•°ä¿¡æ¯ï¼Œç”¨æ¥åœ¨è§£ç å™¨è§£ç æ—¶ä½¿ç”¨ï¼Œè€Œè§†é¢‘ã€éŸ³é¢‘å’Œå­—å¹•æµåœ¨å­˜å‚¨æˆ–è€…ä¼ è¾“çš„æ—¶å€™æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚æœåå·®å¤ªå¤§çš„è¯ä¼šé€ æˆéŸ³è§†é¢‘ä¸åŒæ­¥é—®é¢˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/47/b8be33dd1e3acf2e46ca0c93d7466447.png?wh=1698x624\" alt=\"å›¾ç‰‡\"></p><p>è€Œæˆ‘ä»¬åˆšæ‰è®²åˆ°çš„éŸ³è§†é¢‘åŒ…å’ŒéŸ³è§†é¢‘å¸§ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªAVPacketå¯¹åº”ä¸€ä¸ªAVFrameï¼Œå¯¹ç…§ç€å›¾ç‰‡ç†è§£ä¼šæ›´æ¸…æ™°ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ ä½¿ç”¨ffprobeæ¥åˆ†æéŸ³è§†é¢‘çš„å®¹å™¨æ ¼å¼ã€éŸ³è§†é¢‘çš„æµã€éŸ³è§†é¢‘çš„åŒ…ã€éŸ³è§†é¢‘çš„å¸§ä¿¡æ¯ã€‚æ‹¿åˆ°è¿™äº›ä¿¡æ¯ä¹‹åæˆ‘ä»¬å¯ä»¥ç²¾ç¡®åœ°åˆ†æéŸ³è§†é¢‘å¤šä¸ªç»´åº¦çš„ä¿¡æ¯ï¼Œæ— è®ºæ˜¯åšéŸ³è§†é¢‘è½¬ç ã€æ•…éšœåˆ†æç­‰ï¼Œéƒ½ä¼šæœ‰å¾ˆå¤§çš„ç”¨å¤„ã€‚</p><p>å› ä¸ºffprobeçš„é»‘ç§‘æŠ€å‚æ•°è¿˜æœ‰å¾ˆå¤šï¼Œæ›´ç»†èŠ‚çš„å†…å®¹ï¼Œè¿˜éœ€è¦ä½ å‚è€ƒFFmpegçš„å®˜æ–¹æ‰‹å†Œä¸­çš„<a href=\"https://ffmpeg.org/ffprobe-all.html\">ffprobeé¡µé¢</a>ï¼Œè‡ªå·±åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å»æ¢ç´¢ã€æŒ–æ˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/35/10/35a37b1cd76f05969171yyd1c6f0fb10.png?wh=1871x839\" alt=\"å›¾ç‰‡\"></p><h2>æ€è€ƒé¢˜</h2><p>å¦‚æœä½ æ‹¿åˆ°ä¸€ä¸ªç”µå½±è§†é¢‘ï¼Œæƒ³åšåˆ†ç‰‡è½¬ç ï¼Œæ ¹æ®å­¦è¿‡çš„å†…å®¹ï¼Œä½ è¯¥æ€ä¹ˆåˆ†ç‰‡å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"05ï½œå¦‚ä½•ä½¿ç”¨ FFmpeg ä¸ OBS è¿›è¡Œç›´æ’­æ¨æµï¼Ÿ","id":546485},"right":{"article_title":"07 | å¦‚ä½•é«˜æ•ˆæŸ¥æ‰¾å¹¶ä½¿ç”¨FFmpegå¸¸ç”¨å‚æ•°ï¼Ÿ","id":548420}},"comments":[{"had_liked":false,"id":353792,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"ä¸Šæµ·","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1659784236,"is_pvip":false,"replies":[{"id":128629,"content":"1 æ˜¾ç¤ºè®¾å¤‡ä¸åŒçœ‹åˆ°çš„ä¸åŒï¼Œæœ‰çš„æ˜¯çŸ©å½¢ æœ‰çš„æ˜¯æ–¹å— åªæ˜¯æˆ‘ä»¬ç°åœ¨è§åˆ°çš„å¤§å¤šæ•°æ˜¯æ–¹å—äº†ï¼Œåœ¨ä¸€äº›è¶…å¤§å±å¹•ä¸Šçœ‹åˆ°çš„è¿˜æ˜¯æœ‰çŸ©å½¢çš„ç‚¹çš„\n\n2 æ­£å¸¸æƒ…å†µä¸‹1ä¸ªvideo packetå¯¹åº”ä¸€ä¸ªvideo frame è¯¥å›¾åªè¦æ˜¯ä¸ºäº†å¯¹åº”ç†è§£\n\n3 æœ‰äº›è®¾å¤‡è¾“å‡ºæ˜¯yuvï¼Œycbcrè¿™ç§è§„æ ¼ï¼Œæ¯”å¦‚ç”µè§†æœºç°åœ¨åº”è¯¥è¿˜ä¿ç•™ç€è¿™ç§è§„æ ¼çš„ è¿˜æœ‰å°éœ¸ç‹æ¸¸æˆæœºçš„è¾“å‡º\n\n4 yuv420 æ˜¯2è¡Œ2åˆ—å››ä¸ªåƒç´ ç‚¹ç”¨4ä¸ªy ä¸€ä¸ªuv \n\n5  4:2:0å¹¶ä¸æ„å‘³ç€åªæœ‰Yï¼ŒCbè€Œæ²¡æœ‰Cråˆ†é‡ã€‚å®ƒæŒ‡å¾—æ˜¯å¯¹æ¯è¡Œæ‰«æçº¿æ¥è¯´ï¼Œåªæœ‰ä¸€ç§è‰²åº¦åˆ†é‡ä»¥2:1çš„æŠ½æ ·ç‡å­˜å‚¨ã€‚ç›¸é‚»çš„æ‰«æè¡Œå­˜å‚¨ä¸åŒçš„è‰²åº¦åˆ†é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€è¡Œæ˜¯4:2:0çš„è¯ï¼Œä¸‹ä¸€è¡Œå°±æ˜¯4:0:2ï¼Œå†ä¸‹ä¸€è¡Œæ˜¯4:2:0ä»¥æ­¤ç±»æ¨ã€‚å¯¹æ¯ä¸ªè‰²åº¦åˆ†é‡æ¥è¯´ï¼Œæ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘çš„æŠ½æ ·ç‡éƒ½æ˜¯2:1ï¼Œæ‰€ä»¥å¯ä»¥è¯´è‰²åº¦çš„æŠ½æ ·ç‡æ˜¯4:1ã€‚å¯¹éå‹ç¼©çš„8æ¯”ç‰¹é‡åŒ–çš„æ¥è¯´ï¼Œæ¯ä¸ªç”±2x2ä¸ª2è¡Œ2åˆ—ç›¸é‚»çš„åƒç´ ç»„æˆçš„å®åƒç´ éœ€è¦å ç”¨6å­—èŠ‚å†…å­˜ã€‚\nä¸‹é¢å…«ä¸ªåƒç´ ä¸ºï¼š[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]\n[Y5 U5 V5] [Y6 U6 V6] [Y7U7 V7] [Y8 U8 V8]\nå­˜æ”¾çš„ç æµä¸ºï¼šY0 U0 Y1 Y2 U2 Y3\nY5 V5 Y6 Y7 V7 Y8\næ˜ å°„å‡ºçš„åƒç´ ç‚¹ä¸ºï¼š[Y0 U0 V5] [Y1 U0 V5] [Y2 U2 V7] [Y3 U2 V7]\n[Y5 U0 V5] [Y6 U0 V5] [Y7U2 V7] [Y8 U2 V7]","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1287929,"ctime":1659854041,"ip_address":"ä¸Šæµ·","comment_id":353792,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"è¯·æ•™è€å¸ˆå§é—®é¢˜ï¼š\nQ1ï¼šåƒç´ ä¸æ˜¯ä¸€ä¸ªç‚¹å—ï¼Ÿæ€ä¹ˆä¼šæ˜¯çŸ©å½¢ï¼Ÿ\næ–‡ä¸­æœ‰è¿™æ ·ä¸€å¥è¯ï¼šâ€œè‚¯å®šæœ‰ä¸€ä¸ªå› ç´ ï¼Œå°±æ˜¯åƒç´ ç‚¹ä¸æ˜¯çŸ©å½¢çš„ï¼Œä¸æ˜¯ 1 æ¯” 1 çš„å•ä¸ªåƒç´ ç‚¹ã€‚è¿™å°±äº§ç”Ÿäº† Pixel Aspect Ratioï¼ˆPARï¼‰åƒç´ å®½é«˜æ¯”â€ã€‚æˆ‘ä»¥å‰ä¸€ç›´è®¤ä¸ºåƒç´ å°±æ˜¯ä¸€ä¸ªç‚¹ï¼Œéš¾é“å®é™…ä¸Šåƒç´ æ˜¯æŒ‰çŸ©å½¢å¤„ç†çš„å—ï¼Ÿ\nQ2ï¼šæ–‡ä¸­æœ€åä¸€ä¸ªå›¾ï¼Œå…³äºH.264çš„ï¼Œè§†é¢‘æ–‡ä»¶ä¸­æ˜¯åŒæ—¶å­˜åœ¨Video Packetå’ŒVideo Frameå—ï¼Ÿæˆ–è€…è¯´ï¼ŒVideo Packetå’ŒVideo Frameåªå­˜åœ¨ä¸€ç§ï¼Œå›¾ä¸­ä¸¤ä¸ªéƒ½åˆ—å‡ºæ¥åªæ˜¯ä¸ºäº†è¯´æ˜ï¼Ÿ\nQ3ï¼šYUVæ ¼å¼èƒ½ç”¨æ¥å®é™…æ˜¾ç¤ºå—ï¼Ÿ æˆ‘çš„ç†è§£æ˜¯ï¼šYUVä¸èƒ½ç”¨æ¥æ˜¾ç¤ºï¼Œéœ€è¦è½¬æ¢ä¸ºRGBæ‰èƒ½æ˜¾ç¤ºã€‚\nQ4ï¼š01è®²ä¸­ï¼ŒYUV420çš„å›¾ä¸­ï¼ŒY4ä¸ªå­—èŠ‚ï¼ŒUå’ŒVå„ä¸€ä¸ªå­—èŠ‚ã€‚æ€»å…±6ä¸ªå­—èŠ‚ã€‚è¿™å…­ä¸ªå­—èŠ‚è¡¨ç¤ºå‡ ä¸ªåƒç´ ï¼Ÿæˆ‘è®¤ä¸ºæ˜¯è¡¨ç¤º4ä¸ªåƒç´ ï¼Œä¸æ˜¯6ä¸ªåƒç´ ã€‚\nQ5ï¼šYUV420æ ¼å¼ï¼ŒVæ˜¯0ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä¸€ä¸ªå­—èŠ‚ï¼ŸæŒ‰é“ç†æ˜¯0ä¸ªå­—èŠ‚å•Šã€‚","like_count":6,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582966,"discussion_content":"1 æ˜¾ç¤ºè®¾å¤‡ä¸åŒçœ‹åˆ°çš„ä¸åŒï¼Œæœ‰çš„æ˜¯çŸ©å½¢ æœ‰çš„æ˜¯æ–¹å— åªæ˜¯æˆ‘ä»¬ç°åœ¨è§åˆ°çš„å¤§å¤šæ•°æ˜¯æ–¹å—äº†ï¼Œåœ¨ä¸€äº›è¶…å¤§å±å¹•ä¸Šçœ‹åˆ°çš„è¿˜æ˜¯æœ‰çŸ©å½¢çš„ç‚¹çš„\n\n2 æ­£å¸¸æƒ…å†µä¸‹1ä¸ªvideo packetå¯¹åº”ä¸€ä¸ªvideo frame è¯¥å›¾åªè¦æ˜¯ä¸ºäº†å¯¹åº”ç†è§£\n\n3 æœ‰äº›è®¾å¤‡è¾“å‡ºæ˜¯yuvï¼Œycbcrè¿™ç§è§„æ ¼ï¼Œæ¯”å¦‚ç”µè§†æœºç°åœ¨åº”è¯¥è¿˜ä¿ç•™ç€è¿™ç§è§„æ ¼çš„ è¿˜æœ‰å°éœ¸ç‹æ¸¸æˆæœºçš„è¾“å‡º\n\n4 yuv420 æ˜¯2è¡Œ2åˆ—å››ä¸ªåƒç´ ç‚¹ç”¨4ä¸ªy ä¸€ä¸ªuv \n\n5  4:2:0å¹¶ä¸æ„å‘³ç€åªæœ‰Yï¼ŒCbè€Œæ²¡æœ‰Cråˆ†é‡ã€‚å®ƒæŒ‡å¾—æ˜¯å¯¹æ¯è¡Œæ‰«æçº¿æ¥è¯´ï¼Œåªæœ‰ä¸€ç§è‰²åº¦åˆ†é‡ä»¥2:1çš„æŠ½æ ·ç‡å­˜å‚¨ã€‚ç›¸é‚»çš„æ‰«æè¡Œå­˜å‚¨ä¸åŒçš„è‰²åº¦åˆ†é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€è¡Œæ˜¯4:2:0çš„è¯ï¼Œä¸‹ä¸€è¡Œå°±æ˜¯4:0:2ï¼Œå†ä¸‹ä¸€è¡Œæ˜¯4:2:0ä»¥æ­¤ç±»æ¨ã€‚å¯¹æ¯ä¸ªè‰²åº¦åˆ†é‡æ¥è¯´ï¼Œæ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘çš„æŠ½æ ·ç‡éƒ½æ˜¯2:1ï¼Œæ‰€ä»¥å¯ä»¥è¯´è‰²åº¦çš„æŠ½æ ·ç‡æ˜¯4:1ã€‚å¯¹éå‹ç¼©çš„8æ¯”ç‰¹é‡åŒ–çš„æ¥è¯´ï¼Œæ¯ä¸ªç”±2x2ä¸ª2è¡Œ2åˆ—ç›¸é‚»çš„åƒç´ ç»„æˆçš„å®åƒç´ éœ€è¦å ç”¨6å­—èŠ‚å†…å­˜ã€‚\nä¸‹é¢å…«ä¸ªåƒç´ ä¸ºï¼š[Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]\n[Y5 U5 V5] [Y6 U6 V6] [Y7U7 V7] [Y8 U8 V8]\nå­˜æ”¾çš„ç æµä¸ºï¼šY0 U0 Y1 Y2 U2 Y3\nY5 V5 Y6 Y7 V7 Y8\næ˜ å°„å‡ºçš„åƒç´ ç‚¹ä¸ºï¼š[Y0 U0 V5] [Y1 U0 V5] [Y2 U2 V7] [Y3 U2 V7]\n[Y5 U0 V5] [Y6 U0 V5] [Y7U2 V7] [Y8 U2 V7]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659854042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369401,"user_name":"Geek_c9cd4c","can_delete":false,"product_type":"c1","uid":2446852,"ip_address":"ä¸Šæµ·","ucode":"253A79E31AF61A","user_header":"","comment_is_top":false,"comment_ctime":1677497693,"is_pvip":false,"replies":[{"id":134842,"content":"VPSåº”è¯¥æ˜¯HEVCå¼€å§‹å¼•å…¥çš„ï¼Œè€Œä¸”å¹¶ä¸ä¸€å®šä¼šå‡ºç°åœ¨streamé‡Œé¢ï¼ŒSPSæ˜¯ç¼–ç çš„åºåˆ—å‚æ•°é›†ï¼Œç”¨æ¥è®°å½•ç¼–ç è§„åˆ™çš„å‚æ•°ä¸ºä¸»ã€‚PPSæ˜¯å›¾åƒç¼–ç å‚æ•°ï¼Œç”¨æ¥è®°å½•å›¾åƒå±æ€§ç›¸å…³å‚æ•°ä¸ºä¸»ï¼ŒSPSå’ŒPPSæ›´å¸¸è§ä¸€äº›ï¼Œè¿™ä¸¤ä¸ªåˆ‡æ¢åè¿˜éœ€è¦IDRåšä¸€ä¸‹åˆ·æ–°æ“ä½œã€‚SEIè®°å½•ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç¼–ç å™¨è‡ªå®šä¹‰ä¸€äº›ä¿¡æ¯ï¼Œæˆ–è€…ç”¨æˆ·åœ¨ç¼–ç æ—¶å€™åŠ ä¸€äº›ç§äººå®šåˆ¶çš„å‚æ•°ä¿¡æ¯ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒç¼–ç å‚è€ƒæ ‡å‡†ï¼Œé‡Œé¢æè¿°æ¯”æˆ‘ä»¬çŸ­çŸ­çš„å›å¤è¯¦ç»†å¾ˆå¤š","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1678117483,"ip_address":"åŒ—äº¬","comment_id":369401,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"PPS ã€SPSã€VPSã€SEIèƒ½ä»‹ç»ä¸€ä¸‹å—","like_count":1,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607803,"discussion_content":"VPSåº”è¯¥æ˜¯HEVCå¼€å§‹å¼•å…¥çš„ï¼Œè€Œä¸”å¹¶ä¸ä¸€å®šä¼šå‡ºç°åœ¨streamé‡Œé¢ï¼ŒSPSæ˜¯ç¼–ç çš„åºåˆ—å‚æ•°é›†ï¼Œç”¨æ¥è®°å½•ç¼–ç è§„åˆ™çš„å‚æ•°ä¸ºä¸»ã€‚PPSæ˜¯å›¾åƒç¼–ç å‚æ•°ï¼Œç”¨æ¥è®°å½•å›¾åƒå±æ€§ç›¸å…³å‚æ•°ä¸ºä¸»ï¼ŒSPSå’ŒPPSæ›´å¸¸è§ä¸€äº›ï¼Œè¿™ä¸¤ä¸ªåˆ‡æ¢åè¿˜éœ€è¦IDRåšä¸€ä¸‹åˆ·æ–°æ“ä½œã€‚SEIè®°å½•ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç¼–ç å™¨è‡ªå®šä¹‰ä¸€äº›ä¿¡æ¯ï¼Œæˆ–è€…ç”¨æˆ·åœ¨ç¼–ç æ—¶å€™åŠ ä¸€äº›ç§äººå®šåˆ¶çš„å‚æ•°ä¿¡æ¯ï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒç¼–ç å‚è€ƒæ ‡å‡†ï¼Œé‡Œé¢æè¿°æ¯”æˆ‘ä»¬çŸ­çŸ­çš„å›å¤è¯¦ç»†å¾ˆå¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678117484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353660,"user_name":"askxionghu","can_delete":false,"product_type":"c1","uid":1230367,"ip_address":"ä¸Šæµ·","ucode":"14C6BD44E559CE","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/1f/7431e82e.jpg","comment_is_top":false,"comment_ctime":1659665320,"is_pvip":false,"replies":[{"id":128602,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1659681601,"ip_address":"ä¸Šæµ·","comment_id":353660,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"ffprobe çš„ -show_formatsæ”¹ä¸º-show_format","like_count":1,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582804,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659681602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369400,"user_name":"Geek_c9cd4c","can_delete":false,"product_type":"c1","uid":2446852,"ip_address":"ä¸Šæµ·","ucode":"253A79E31AF61A","user_header":"","comment_is_top":false,"comment_ctime":1677496981,"is_pvip":false,"replies":[{"id":134838,"content":"ä¸ä¸€å®šï¼Œåœ¨OpenGOPç¼–ç æƒ…å¢ƒä¸‹Iä¸æ˜¯IDRï¼Œä¹Ÿå¯ä»¥ç†è§£Iä¸æ˜¯keyframe","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1678117022,"ip_address":"åŒ—äº¬","comment_id":369400,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"Iå¸§ä¸æ˜¯keyframeå—","like_count":0,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607793,"discussion_content":"ä¸ä¸€å®šï¼Œåœ¨OpenGOPç¼–ç æƒ…å¢ƒä¸‹Iä¸æ˜¯IDRï¼Œä¹Ÿå¯ä»¥ç†è§£Iä¸æ˜¯keyframe","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678117022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355040,"user_name":"Geek_e2e4e9","can_delete":false,"product_type":"c1","uid":1585508,"ip_address":"åŒ—äº¬","ucode":"4FA7B065226823","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/HWfgYFkH80yh2yCWEAK430aZ1e9BbvQI4DN9q8ib4Czc8DTHeWmmIuep74wBIRGARhJd6eY6Tpt3QUSpAicDIHNw/132","comment_is_top":false,"comment_ctime":1660997497,"is_pvip":false,"replies":[{"id":129216,"content":"æ²¡é—®é¢˜ï¼Œè¿™ç§æ¥è¿‘çš„ä½ è·Ÿäººå®¶èœé¸Ÿè¯´1920x800äººå®¶å¬ç€æ¯”è¾ƒç›´æ¥ï¼Œä½†æ˜¯ä½ è¯´æ˜¯1080p äººå®¶ä¹Ÿèƒ½ç†è§£æ˜¯é«˜æ¸…çš„æ„æ€ï¼Œè¯·è®¤çœŸçœ‹å†…å®¹å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1661136180,"ip_address":"åŒ—äº¬","comment_id":355040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"â€œå› ä¸ºåˆ†è¾¨ç‡æ˜¯ 1920x800 çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç§°ä¹‹ä¸º 1080pâ€è¿™å¥è¯æœ‰é—®é¢˜ï¼Œ1080påº”è¯¥æ˜¯1920x1080çš„åˆ†è¾¨ç‡","like_count":0,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584790,"discussion_content":"æ²¡é—®é¢˜ï¼Œè¿™ç§æ¥è¿‘çš„ä½ è·Ÿäººå®¶èœé¸Ÿè¯´1920x800äººå®¶å¬ç€æ¯”è¾ƒç›´æ¥ï¼Œä½†æ˜¯ä½ è¯´æ˜¯1080p äººå®¶ä¹Ÿèƒ½ç†è§£æ˜¯é«˜æ¸…çš„æ„æ€ï¼Œè¯·è®¤çœŸçœ‹å†…å®¹å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661136180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354354,"user_name":"jcy","can_delete":false,"product_type":"c1","uid":1264411,"ip_address":"åŒ—äº¬","ucode":"7C3E10C4E0FA87","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/1b/e3b3bcff.jpg","comment_is_top":false,"comment_ctime":1660295268,"is_pvip":false,"replies":[{"id":128880,"content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1660299686,"ip_address":"åŒ—äº¬","comment_id":354354,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"è¿™ä¸ªå¾—åˆ†é€šå¸¸ç”¨æ¥ç¡®å®šä½¿ç”¨å“ªä¸ªå®¹å™¨æ¨¡å—æ¥è§£æè¿™ä¸ª probe æ–‡ä»¶ \nè¿™é‡Œ è¿™ä¸ª probe æ–‡ä»¶ æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯ è¿™ä¸ª mov æ–‡ä»¶ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583703,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660299686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353942,"user_name":"è¥¿æ ¼ç›","can_delete":false,"product_type":"c1","uid":2616564,"ip_address":"åŒ—äº¬","ucode":"95DE1B8A8ACD8F","user_header":"https://static001.geekbang.org/account/avatar/00/27/ec/f4/3c569056.jpg","comment_is_top":false,"comment_ctime":1659942193,"is_pvip":false,"replies":[{"id":128751,"content":"åŠ ä¸Šselect_streams v åªçœ‹è§†é¢‘æµ å¦‚æœéŸ³è§†é¢‘äº¤é”™çš„è¯ä¸ä¸€å®šèƒ½é¡ºåº","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1287929,"ctime":1660011471,"ip_address":"åŒ—äº¬","comment_id":353942,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"è€å¸ˆä½ å¥½ï¼Œç»è¿‡åšå®éªŒæˆ‘å‘ç°å’Œæ‚¨çš„æè¿°æœ‰ç‚¹å‡ºå…¥ï¼š\nffprobe -show_frames -of xml xxx.mp4è¿™ä¸ªç»“æœé‡Œé¢çš„pkt_ptså’Œpkt_pts_timeæ˜¯ä¸æŒ‰ç…§é¡ºåºçš„ï¼Œä½†æ˜¯\nffprobe -show_packets -of xml  xxx.mp4çš„ptsæ˜¯æŒ‰ç…§é¡ºåºçš„","like_count":0,"discussions":[{"author":{"id":1287929,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/f9/79cad962.jpg","nickname":"æ‚Ÿç©º@OnVideo","note":"","ucode":"C320167A9A17B8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583273,"discussion_content":"åŠ ä¸Šselect_streams v åªçœ‹è§†é¢‘æµ å¦‚æœéŸ³è§†é¢‘äº¤é”™çš„è¯ä¸ä¸€å®šèƒ½é¡ºåº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660011471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385792,"user_name":"ifelse","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1703397121,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":3,"score":2,"product_id":100117501,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0},{"had_liked":false,"id":357798,"user_name":"Geek_wad2tx","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"ä¸Šæµ·","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1663646410,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100117501,"comment_content":"åˆ†ç‰‡è½¬ç ä¸»è¦æ˜¯æ ¹æ®videoæµç‰¹æ€§è¿›è¡Œåˆ†ç‰‡è½¬ç ï¼Œåˆ†ç‰‡ä»¥gopä½œä¸ºåˆ’åˆ†ç‚¹","like_count":0}]}