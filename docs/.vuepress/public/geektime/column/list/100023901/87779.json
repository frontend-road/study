{"id":87779,"title":"14 | Lockå’ŒConditionï¼ˆä¸Šï¼‰ï¼šéšè—åœ¨å¹¶å‘åŒ…ä¸­çš„ç®¡ç¨‹","content":"<p>Java SDKå¹¶å‘åŒ…å†…å®¹å¾ˆä¸°å¯Œï¼ŒåŒ…ç½—ä¸‡è±¡ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ€æ ¸å¿ƒçš„è¿˜æ˜¯å…¶å¯¹ç®¡ç¨‹çš„å®ç°ã€‚å› ä¸ºç†è®ºä¸Šåˆ©ç”¨ç®¡ç¨‹ï¼Œä½ å‡ ä¹å¯ä»¥å®ç°å¹¶å‘åŒ…é‡Œæ‰€æœ‰çš„å·¥å…·ç±»ã€‚åœ¨å‰é¢<a href=\"https://time.geekbang.org/column/article/86089\">ã€Š08 | ç®¡ç¨‹ï¼šå¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™ã€‹</a>ä¸­æˆ‘ä»¬æåˆ°è¿‡åœ¨å¹¶å‘ç¼–ç¨‹é¢†åŸŸï¼Œæœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šä¸€ä¸ªæ˜¯<strong>äº’æ–¥</strong>ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›å¦ä¸€ä¸ªæ˜¯<strong>åŒæ­¥</strong>ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚<strong>Java SDKå¹¶å‘åŒ…é€šè¿‡Lockå’ŒConditionä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­Lockç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒConditionç”¨äºè§£å†³åŒæ­¥é—®é¢˜</strong>ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬é‡ç‚¹ä»‹ç»Lockçš„ä½¿ç”¨ï¼Œåœ¨ä»‹ç»Lockçš„ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä¸ªé—®é¢˜éœ€è¦ä½ é¦–å…ˆæ€è€ƒä¸€ä¸‹ï¼šJavaè¯­è¨€æœ¬èº«æä¾›çš„synchronizedä¹Ÿæ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°ï¼Œæ—¢ç„¶Javaä»è¯­è¨€å±‚é¢å·²ç»å®ç°äº†ç®¡ç¨‹äº†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦åœ¨SDKé‡Œæä¾›å¦å¤–ä¸€ç§å®ç°å‘¢ï¼Ÿéš¾é“Javaæ ‡å‡†å§”å‘˜ä¼šè¿˜èƒ½åŒæ„â€œé‡å¤é€ è½®å­â€çš„æ–¹æ¡ˆï¼Ÿå¾ˆæ˜¾ç„¶å®ƒä»¬ä¹‹é—´æ˜¯æœ‰å·¨å¤§åŒºåˆ«çš„ã€‚é‚£åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿå¦‚æœèƒ½æ·±å…¥ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œå¯¹ä½ ç”¨å¥½Lockå¸®åŠ©å¾ˆå¤§ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·æ¥å‰–æä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p><h2>å†é€ ç®¡ç¨‹çš„ç†ç”±</h2><p>ä½ ä¹Ÿè®¸æ›¾ç»å¬åˆ°è¿‡å¾ˆå¤šè¿™æ–¹é¢çš„ä¼ è¯´ï¼Œä¾‹å¦‚åœ¨Javaçš„1.5ç‰ˆæœ¬ä¸­ï¼Œsynchronizedæ€§èƒ½ä¸å¦‚SDKé‡Œé¢çš„Lockï¼Œä½†1.6ç‰ˆæœ¬ä¹‹åï¼Œsynchronizedåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå°†æ€§èƒ½è¿½äº†ä¸Šæ¥ï¼Œæ‰€ä»¥1.6ä¹‹åçš„ç‰ˆæœ¬åˆæœ‰äººæ¨èä½¿ç”¨synchronizedäº†ã€‚é‚£æ€§èƒ½æ˜¯å¦å¯ä»¥æˆä¸ºâ€œé‡å¤é€ è½®å­â€çš„ç†ç”±å‘¢ï¼Ÿæ˜¾ç„¶ä¸èƒ½ã€‚å› ä¸ºæ€§èƒ½é—®é¢˜ä¼˜åŒ–ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œå®Œå…¨æ²¡å¿…è¦â€œé‡å¤é€ è½®å­â€ã€‚</p><!-- [[[read_end]]] --><p>åˆ°è¿™é‡Œï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œä½ æ˜¯å¦èƒ½å¤Ÿæƒ³å‡ºä¸€æ¡ç†ç”±æ¥å‘¢ï¼Ÿå¦‚æœä½ ç»†å¿ƒçš„è¯ï¼Œä¹Ÿè®¸èƒ½æƒ³åˆ°ä¸€ç‚¹ã€‚é‚£å°±æ˜¯æˆ‘ä»¬å‰é¢åœ¨ä»‹ç»<a href=\"https://time.geekbang.org/column/article/85001\">æ­»é”é—®é¢˜</a>çš„æ—¶å€™ï¼Œæå‡ºäº†ä¸€ä¸ª<strong>ç ´åä¸å¯æŠ¢å æ¡ä»¶</strong>æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆsynchronizedæ²¡æœ‰åŠæ³•è§£å†³ã€‚åŸå› æ˜¯synchronizedç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚ä½†æˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼š</p><blockquote>\n<p>å¯¹äºâ€œä¸å¯æŠ¢å â€è¿™ä¸ªæ¡ä»¶ï¼Œå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºï¼Œè¿™æ ·ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶å°±ç ´åæ‰äº†ã€‚</p>\n</blockquote><p>å¦‚æœæˆ‘ä»¬é‡æ–°è®¾è®¡ä¸€æŠŠäº’æ–¥é”å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£è¯¥æ€ä¹ˆè®¾è®¡å‘¢ï¼Ÿæˆ‘è§‰å¾—æœ‰ä¸‰ç§æ–¹æ¡ˆã€‚</p><ol>\n<li><strong>èƒ½å¤Ÿå“åº”ä¸­æ–­</strong>ã€‚synchronizedçš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é”Aåï¼Œå¦‚æœå°è¯•è·å–é”Bå¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”Aã€‚è¿™æ ·å°±ç ´åäº†ä¸å¯æŠ¢å æ¡ä»¶äº†ã€‚</li>\n<li><strong>æ”¯æŒè¶…æ—¶</strong>ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚</li>\n<li><strong>éé˜»å¡åœ°è·å–é”</strong>ã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚</li>\n</ol><p>è¿™ä¸‰ç§æ–¹æ¡ˆå¯ä»¥å…¨é¢å¼¥è¡¥synchronizedçš„é—®é¢˜ã€‚åˆ°è¿™é‡Œç›¸ä¿¡ä½ åº”è¯¥ä¹Ÿèƒ½ç†è§£äº†ï¼Œè¿™ä¸‰ä¸ªæ–¹æ¡ˆå°±æ˜¯â€œé‡å¤é€ è½®å­â€çš„ä¸»è¦åŸå› ï¼Œä½“ç°åœ¨APIä¸Šï¼Œå°±æ˜¯Lockæ¥å£çš„ä¸‰ä¸ªæ–¹æ³•ã€‚è¯¦æƒ…å¦‚ä¸‹ï¼š</p><pre><code>// æ”¯æŒä¸­æ–­çš„API\nvoid lockInterruptibly() \n  throws InterruptedException;\n// æ”¯æŒè¶…æ—¶çš„API\nboolean tryLock(long time, TimeUnit unit) \n  throws InterruptedException;\n// æ”¯æŒéé˜»å¡è·å–é”çš„API\nboolean tryLock();\n</code></pre><h2>å¦‚ä½•ä¿è¯å¯è§æ€§</h2><p>Java SDKé‡Œé¢Lockçš„ä½¿ç”¨ï¼Œæœ‰ä¸€ä¸ªç»å…¸çš„èŒƒä¾‹ï¼Œå°±æ˜¯<code>try{}finally{}</code>ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯åœ¨finallyé‡Œé¢é‡Šæ”¾é”ã€‚è¿™ä¸ªèŒƒä¾‹æ— éœ€å¤šè§£é‡Šï¼Œä½ çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œé‚£å°±æ˜¯å¯è§æ€§æ˜¯æ€ä¹ˆä¿è¯çš„ã€‚ä½ å·²ç»çŸ¥é“Javaé‡Œå¤šçº¿ç¨‹çš„å¯è§æ€§æ˜¯é€šè¿‡Happens-Beforeè§„åˆ™ä¿è¯çš„ï¼Œè€Œsynchronizedä¹‹æ‰€ä»¥èƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œä¹Ÿæ˜¯å› ä¸ºæœ‰ä¸€æ¡synchronizedç›¸å…³çš„è§„åˆ™ï¼šsynchronizedçš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚é‚£Java SDKé‡Œé¢Locké ä»€ä¹ˆä¿è¯å¯è§æ€§å‘¢ï¼Ÿä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œçº¿ç¨‹T1å¯¹valueè¿›è¡Œäº†+=1æ“ä½œï¼Œé‚£åç»­çš„çº¿ç¨‹T2èƒ½å¤Ÿçœ‹åˆ°valueçš„æ­£ç¡®ç»“æœå—ï¼Ÿ</p><pre><code>class X {\n  private final Lock rtl =\n  new ReentrantLock();\n  int value;\n  public void addOne() {\n    // è·å–é”\n    rtl.lock();  \n    try {\n      value+=1;\n    } finally {\n      // ä¿è¯é”èƒ½é‡Šæ”¾\n      rtl.unlock();\n    }\n  }\n}\n</code></pre><p>ç­”æ¡ˆå¿…é¡»æ˜¯è‚¯å®šçš„ã€‚<strong>Java SDKé‡Œé¢é”</strong>çš„å®ç°éå¸¸å¤æ‚ï¼Œè¿™é‡Œæˆ‘å°±ä¸å±•å¼€ç»†è¯´äº†ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯éœ€è¦ç®€å•ä»‹ç»ä¸€ä¸‹ï¼šå®ƒæ˜¯<strong>åˆ©ç”¨äº†volatileç›¸å…³çš„Happens-Beforeè§„åˆ™</strong>ã€‚Java SDKé‡Œé¢çš„ReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ªvolatile çš„æˆå‘˜å˜é‡stateï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¼šè¯»å†™stateçš„å€¼ï¼›è§£é”çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¯»å†™stateçš„å€¼ï¼ˆç®€åŒ–åçš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤ºï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œvalue+=1ä¹‹å‰ï¼Œç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡volatileå˜é‡stateï¼Œåœ¨æ‰§è¡Œvalue+=1ä¹‹åï¼Œåˆè¯»å†™äº†ä¸€æ¬¡volatileå˜é‡stateã€‚æ ¹æ®ç›¸å…³çš„Happens-Beforeè§„åˆ™ï¼š</p><ol>\n<li><strong>é¡ºåºæ€§è§„åˆ™</strong>ï¼šå¯¹äºçº¿ç¨‹T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œunlock()ï¼›</li>\n<li><strong>volatileå˜é‡è§„åˆ™</strong>ï¼šç”±äºstate = 1ä¼šå…ˆè¯»å–stateï¼Œæ‰€ä»¥çº¿ç¨‹T1çš„unlock()æ“ä½œHappens-Beforeçº¿ç¨‹T2çš„lock()æ“ä½œï¼›</li>\n<li><strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼šçº¿ç¨‹ T1çš„value+=1  Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚</li>\n</ol><pre><code>class SampleLock {\n  volatile int state;\n  // åŠ é”\n  lock() {\n    // çœç•¥ä»£ç æ— æ•°\n    state = 1;\n  }\n  // è§£é”\n  unlock() {\n    // çœç•¥ä»£ç æ— æ•°\n    state = 0;\n  }\n}\n</code></pre><p>æ‰€ä»¥è¯´ï¼Œåç»­çº¿ç¨‹T2èƒ½å¤Ÿçœ‹åˆ°valueçš„æ­£ç¡®ç»“æœã€‚å¦‚æœä½ è§‰å¾—ç†è§£èµ·æ¥è¿˜æœ‰ç‚¹å›°éš¾ï¼Œå»ºè®®ä½ é‡æ¸©ä¸€ä¸‹å‰é¢æˆ‘ä»¬è®²è¿‡çš„<a href=\"https://time.geekbang.org/column/article/84017\">ã€Š02 | Javaå†…å­˜æ¨¡å‹ï¼šçœ‹Javaå¦‚ä½•è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ã€‹</a>é‡Œé¢çš„ç›¸å…³å†…å®¹ã€‚</p><h2>ä»€ä¹ˆæ˜¯å¯é‡å…¥é”</h2><p>å¦‚æœä½ ç»†å¿ƒè§‚å¯Ÿï¼Œä¼šå‘ç°æˆ‘ä»¬åˆ›å»ºçš„é”çš„å…·ä½“ç±»åæ˜¯ReentrantLockï¼Œè¿™ä¸ªç¿»è¯‘è¿‡æ¥å«<strong>å¯é‡å…¥é”</strong>ï¼Œè¿™ä¸ªæ¦‚å¿µå‰é¢æˆ‘ä»¬ä¸€ç›´æ²¡æœ‰ä»‹ç»è¿‡ã€‚<strong>æ‰€è°“å¯é‡å…¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”</strong>ã€‚ä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­ï¼Œå½“çº¿ç¨‹T1æ‰§è¡Œåˆ° â‘  å¤„æ—¶ï¼Œå·²ç»è·å–åˆ°äº†é” rtl ï¼Œå½“åœ¨ â‘  å¤„è°ƒç”¨ get()æ–¹æ³•æ—¶ï¼Œä¼šåœ¨ â‘¡ å†æ¬¡å¯¹é” rtl æ‰§è¡ŒåŠ é”æ“ä½œã€‚æ­¤æ—¶ï¼Œå¦‚æœé” rtl æ˜¯å¯é‡å…¥çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹T1å¯ä»¥å†æ¬¡åŠ é”æˆåŠŸï¼›å¦‚æœé” rtl æ˜¯ä¸å¯é‡å…¥çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹T1æ­¤æ—¶ä¼šè¢«é˜»å¡ã€‚</p><p>é™¤äº†å¯é‡å…¥é”ï¼Œå¯èƒ½ä½ è¿˜å¬è¯´è¿‡å¯é‡å…¥å‡½æ•°ï¼Œå¯é‡å…¥å‡½æ•°æ€ä¹ˆç†è§£å‘¢ï¼ŸæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è°ƒç”¨ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œæ‰€è°“<strong>å¯é‡å…¥å‡½æ•°ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è°ƒç”¨è¯¥å‡½æ•°</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½èƒ½å¾—åˆ°æ­£ç¡®ç»“æœï¼›åŒæ—¶åœ¨ä¸€ä¸ªçº¿ç¨‹å†…æ”¯æŒçº¿ç¨‹åˆ‡æ¢ï¼Œæ— è®ºè¢«åˆ‡æ¢å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯æ­£ç¡®çš„ã€‚å¤šçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œè¿˜æ”¯æŒçº¿ç¨‹åˆ‡æ¢ï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿçº¿ç¨‹å®‰å…¨å•Šã€‚æ‰€ä»¥ï¼Œå¯é‡å…¥å‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><pre><code>class X {\n  private final Lock rtl =\n  new ReentrantLock();\n  int value;\n  public int get() {\n    // è·å–é”\n    rtl.lock();         â‘¡\n    try {\n      return value;\n    } finally {\n      // ä¿è¯é”èƒ½é‡Šæ”¾\n      rtl.unlock();\n    }\n  }\n  public void addOne() {\n    // è·å–é”\n    rtl.lock();  \n    try {\n      value = 1 + get(); â‘ \n    } finally {\n      // ä¿è¯é”èƒ½é‡Šæ”¾\n      rtl.unlock();\n    }\n  }\n}\n</code></pre><h2>å…¬å¹³é”ä¸éå…¬å¹³é”</h2><p>åœ¨ä½¿ç”¨ReentrantLockçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ReentrantLockè¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¼ å…¥fairå‚æ•°çš„æ„é€ å‡½æ•°ã€‚fairå‚æ•°ä»£è¡¨çš„æ˜¯é”çš„å…¬å¹³ç­–ç•¥ï¼Œå¦‚æœä¼ å…¥trueå°±è¡¨ç¤ºéœ€è¦æ„é€ ä¸€ä¸ªå…¬å¹³é”ï¼Œåä¹‹åˆ™è¡¨ç¤ºè¦æ„é€ ä¸€ä¸ªéå…¬å¹³é”ã€‚</p><pre><code>//æ— å‚æ„é€ å‡½æ•°ï¼šé»˜è®¤éå…¬å¹³é”\npublic ReentrantLock() {\n    sync = new NonfairSync();\n}\n//æ ¹æ®å…¬å¹³ç­–ç•¥å‚æ•°åˆ›å»ºé”\npublic ReentrantLock(boolean fair){\n    sync = fair ? new FairSync() \n                : new NonfairSync();\n}\n</code></pre><p>åœ¨å‰é¢<a href=\"https://time.geekbang.org/column/article/86089\">ã€Š08 | ç®¡ç¨‹ï¼šå¹¶å‘ç¼–ç¨‹çš„ä¸‡èƒ½é’¥åŒ™ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡å…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œé”éƒ½å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è·å¾—é”ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœæ˜¯å…¬å¹³é”ï¼Œå”¤é†’çš„ç­–ç•¥å°±æ˜¯è°ç­‰å¾…çš„æ—¶é—´é•¿ï¼Œå°±å”¤é†’è°ï¼Œå¾ˆå…¬å¹³ï¼›å¦‚æœæ˜¯éå…¬å¹³é”ï¼Œåˆ™ä¸æä¾›è¿™ä¸ªå…¬å¹³ä¿è¯ï¼Œæœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­çš„çº¿ç¨‹åè€Œå…ˆè¢«å”¤é†’ã€‚</p><h2>ç”¨é”çš„æœ€ä½³å®è·µ</h2><p>ä½ å·²ç»çŸ¥é“ï¼Œç”¨é”è™½ç„¶èƒ½è§£å†³å¾ˆå¤šå¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯é£é™©ä¹Ÿæ˜¯æŒºé«˜çš„ã€‚å¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼Œä¹Ÿå¯èƒ½å½±å“æ€§èƒ½ã€‚è¿™æ–¹é¢æœ‰æ˜¯å¦æœ‰ç›¸å…³çš„æœ€ä½³å®è·µå‘¢ï¼Ÿæœ‰ï¼Œè¿˜å¾ˆå¤šã€‚ä½†æ˜¯æˆ‘è§‰å¾—æœ€å€¼å¾—æ¨èçš„æ˜¯å¹¶å‘å¤§å¸ˆDoug Leaã€ŠJavaå¹¶å‘ç¼–ç¨‹ï¼šè®¾è®¡åŸåˆ™ä¸æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­ï¼Œæ¨èçš„ä¸‰ä¸ªç”¨é”çš„æœ€ä½³å®è·µï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><blockquote>\n<ol>\n<li>æ°¸è¿œåªåœ¨æ›´æ–°å¯¹è±¡çš„æˆå‘˜å˜é‡æ—¶åŠ é”</li>\n<li>æ°¸è¿œåªåœ¨è®¿é—®å¯å˜çš„æˆå‘˜å˜é‡æ—¶åŠ é”</li>\n<li>æ°¸è¿œä¸åœ¨è°ƒç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•æ—¶åŠ é”</li>\n</ol>\n</blockquote><p>è¿™ä¸‰æ¡è§„åˆ™ï¼Œå‰ä¸¤æ¡ä¼°è®¡ä½ ä¸€å®šä¼šè®¤åŒï¼Œæœ€åä¸€æ¡ä½ å¯èƒ½ä¼šè§‰å¾—è¿‡äºä¸¥è‹›ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯å€¾å‘äºä½ å»éµå®ˆï¼Œå› ä¸ºè°ƒç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•ï¼Œå®åœ¨æ˜¯å¤ªä¸å®‰å…¨äº†ï¼Œä¹Ÿè®¸â€œå…¶ä»–â€æ–¹æ³•é‡Œé¢æœ‰çº¿ç¨‹sleep()çš„è°ƒç”¨ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰å¥‡æ…¢æ— æ¯”çš„I/Oæ“ä½œï¼Œè¿™äº›éƒ½ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œâ€œå…¶ä»–â€ç±»çš„æ–¹æ³•å¯èƒ½ä¹Ÿä¼šåŠ é”ï¼Œç„¶ååŒé‡åŠ é”å°±å¯èƒ½å¯¼è‡´æ­»é”ã€‚</p><p><strong>å¹¶å‘é—®é¢˜ï¼Œæœ¬æ¥å°±éš¾ä»¥è¯Šæ–­ï¼Œæ‰€ä»¥ä½ ä¸€å®šè¦è®©ä½ çš„ä»£ç å°½é‡å®‰å…¨ï¼Œå°½é‡ç®€å•ï¼Œå“ªæ€•æœ‰ä¸€ç‚¹å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œéƒ½è¦åŠªåŠ›é¿å…ã€‚</strong></p><h2>æ€»ç»“</h2><p>Java SDK å¹¶å‘åŒ…é‡Œçš„Lockæ¥å£é‡Œé¢çš„æ¯ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥æ„Ÿå—åˆ°ï¼Œéƒ½æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ã€‚é™¤äº†æ”¯æŒç±»ä¼¼synchronizedéšå¼åŠ é”çš„lock()æ–¹æ³•å¤–ï¼Œè¿˜æ”¯æŒè¶…æ—¶ã€éé˜»å¡ã€å¯ä¸­æ–­çš„æ–¹å¼è·å–é”ï¼Œè¿™ä¸‰ç§æ–¹å¼ä¸ºæˆ‘ä»¬ç¼–å†™æ›´åŠ å®‰å…¨ã€å¥å£®çš„å¹¶å‘ç¨‹åºæä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚å¸Œæœ›ä½ ä»¥ååœ¨ä½¿ç”¨é”çš„æ—¶å€™ï¼Œä¸€å®šè¦ä»”ç»†æ–Ÿé…Œã€‚</p><p>é™¤äº†å¹¶å‘å¤§å¸ˆDoug Leaæ¨èçš„ä¸‰ä¸ªæœ€ä½³å®è·µå¤–ï¼Œä½ ä¹Ÿå¯ä»¥å‚è€ƒä¸€äº›è¯¸å¦‚ï¼šå‡å°‘é”çš„æŒæœ‰æ—¶é—´ã€å‡å°é”çš„ç²’åº¦ç­‰ä¸šç•Œå¹¿ä¸ºäººçŸ¥çš„è§„åˆ™ï¼Œå…¶å®æœ¬è´¨ä¸Šå®ƒä»¬éƒ½æ˜¯ç›¸é€šçš„ï¼Œä¸è¿‡æ˜¯åœ¨è¯¥åŠ é”çš„åœ°æ–¹åŠ é”è€Œå·²ã€‚ä½ å¯ä»¥è‡ªå·±ä½“ä¼šï¼Œè‡ªå·±æ€»ç»“ï¼Œæœ€ç»ˆæ€»ç»“å‡ºè‡ªå·±çš„ä¸€å¥—æœ€ä½³å®è·µæ¥ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>ä½ å·²ç»çŸ¥é“ tryLock() æ”¯æŒéé˜»å¡æ–¹å¼è·å–é”ï¼Œä¸‹é¢è¿™æ®µå…³äºè½¬è´¦çš„ç¨‹åºå°±ä½¿ç”¨åˆ°äº† tryLock()ï¼Œä½ æ¥çœ‹çœ‹ï¼Œå®ƒæ˜¯å¦å­˜åœ¨æ­»é”é—®é¢˜å‘¢ï¼Ÿ</p><pre><code>class Account {\n  private int balance;\n  private final Lock lock\n          = new ReentrantLock();\n  // è½¬è´¦\n  void transfer(Account tar, int amt){\n    while (true) {\n      if(this.lock.tryLock()) {\n        try {\n          if (tar.lock.tryLock()) {\n            try {\n              this.balance -= amt;\n              tar.balance += amt;\n            } finally {\n              tar.lock.unlock();\n            }\n          }//if\n        } finally {\n          this.lock.unlock();\n        }\n      }//if\n    }//while\n  }//transfer\n}\n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","comments":[{"had_liked":false,"id":81386,"user_name":"ã€€","can_delete":false,"product_type":"c1","uid":1267107,"ip_address":"","ucode":"246CD8612E84EA","user_header":"https://static001.geekbang.org/account/avatar/00/13/55/a3/88cbb981.jpg","comment_is_top":false,"comment_ctime":1553885879,"is_pvip":true,"replies":[{"id":"29567","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":81386,"uid":"1269969","ip_address":"","utype":1,"ctime":1553991901,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":7,"race_medal":0,"score":"474000288439","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—:ä¸ä¼šå‡ºç°æ­»é”ï¼Œä½†ä¼šå‡ºç°æ´»é”","like_count":111,"discussions":[{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363120,"discussion_content":"æ´»é”å°±æ˜¯æŒ‡çº¿ç¨‹ä¸€ç›´å¤„äºè¿è¡Œï¼ˆRUNNABLEï¼‰çŠ¶æ€ï¼Œä½†å´æ˜¯åœ¨åšæ— ç”¨åŠŸï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æœ¬èº«è¦å®Œæˆçš„ä»»åŠ¡å´ä¸€ç›´æ— æ³•è¿›å±•ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1617113814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1346215,"avatar":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","nickname":"William","note":"","ucode":"55F5D9DEE485B1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300166,"discussion_content":"äº’ç›¸è°¦è®©ï¼Œå¯¼è‡´åŒä¸€æ—¶åˆ»é‡æ–°è¿›å…¥ç›¸åŒè·å–å¯¹æ–¹é”çŠ¶æ€.","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1597974386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445175,"discussion_content":"ğŸ‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1553991901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2410092,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c6/6c/a400175a.jpg","nickname":"FARO_Z","note":"","ucode":"B33BCC36C2A74E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570948,"discussion_content":"è¿™ä¸ªæ´»é”æœ‰å¯èƒ½æ¶ˆè§£å—ï¼Ÿæ¯”å¦‚è¯´åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­ï¼ŒT1ï¼ŒT2çº¿ç¨‹å› ä¸ºå–ä¸åˆ°å¯¹æ–¹æŒæœ‰çš„é”ï¼Œè€Œé‡Šæ”¾è‡ªå·±çš„é”ï¼Œå¼€å¯ç¬¬äºŒè½®å¾ªç¯ï¼Œä½†æ˜¯ç¬¬äºŒè½®å¾ªç¯ä¸­ï¼ŒT1çº¿ç¨‹ç‡å…ˆè·å–ä¸¤ä¸ªé”ï¼Œå®Œæˆä»»åŠ¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652003324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1475385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/83/39/f9623363.jpg","nickname":"ç«¹é©¬å½¦å››éƒçš„å¥½æœ‹å‹å½±æ³•å¸«","note":"","ucode":"A9555AEFF90CDF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349340,"discussion_content":"çœŸçš®ğŸ˜œ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613103737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1400962,"avatar":"https://static001.geekbang.org/account/avatar/00/15/60/82/9a43504b.jpg","nickname":"[è€¶]å‹è¶…î–","note":"","ucode":"890572F77C3670","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3586,"discussion_content":"ä¸ºå•¥å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564621897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1115302,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/a6/18c4f73c.jpg","nickname":"Airsaid","note":"","ucode":"5B90BC0044F376","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1400962,"avatar":"https://static001.geekbang.org/account/avatar/00/15/60/82/9a43504b.jpg","nickname":"[è€¶]å‹è¶…î–","note":"","ucode":"890572F77C3670","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":197076,"discussion_content":"æ²¡æœ‰å¼•å…¥éšæœºæ€§ï¼Œå¯¼è‡´çº¿ç¨‹åœ¨é‡Šæ”¾é”åé©¬ä¸Šåˆé‡æ–°å»è·å–ï¼Œè€Œæ­¤æ—¶å¦å¤–çš„çº¿ç¨‹å¯èƒ½ä¹Ÿæ­£åœ¨è¿™æ ·åšï¼Œäº’ç›¸åˆéƒ½è·å–ä¸åˆ°é”ã€‚","likes_number":21,"is_delete":false,"is_hidden":false,"ctime":1583404057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3586,"ip_address":""},"score":197076,"extra":""}]}]},{"had_liked":false,"id":81489,"user_name":"å°å","can_delete":false,"product_type":"c1","uid":1402795,"ip_address":"","ucode":"902E7ED95D73BA","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/ab/facff632.jpg","comment_is_top":false,"comment_ctime":1553925077,"is_pvip":false,"replies":[{"id":"29558","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":81489,"uid":"1269969","ip_address":"","utype":1,"ctime":1553989017,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":5,"race_medal":0,"score":"383806014421","product_id":100023901,"comment_content":"æœ‰å¯èƒ½æ´»é”ï¼ŒAï¼ŒBä¸¤è´¦æˆ·ç›¸äº’è½¬è´¦ï¼Œå„è‡ªæŒæœ‰è‡ªå·±lockçš„é”ï¼Œéƒ½ä¸€ç›´åœ¨å°è¯•è·å–å¯¹æ–¹çš„é”ï¼Œå½¢æˆäº†æ´»é”","like_count":90,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445227,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553989017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1189580,"avatar":"https://static001.geekbang.org/account/avatar/00/12/26/cc/719aec6d.jpg","nickname":"24","note":"","ucode":"F09DF49B6254E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361244,"discussion_content":"è™½ç„¶ç»“è®ºè¯´çš„æ˜¯æ´»é”ï¼Œä½†æ˜¯æè¿°çš„æ„æ€æ˜¯æ­»é”å•Šï¼ŒæŒæœ‰è‡ªå·±çš„é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„èµ„æºã€‚é‡ç‚¹åº”è¯¥æ˜¯éé˜»å¡å§ã€‚","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1616632776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2527545,"avatar":"https://static001.geekbang.org/account/avatar/00/26/91/39/acba72ca.jpg","nickname":"JohnCoding","note":"","ucode":"23FF4A45AA2F27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1189580,"avatar":"https://static001.geekbang.org/account/avatar/00/12/26/cc/719aec6d.jpg","nickname":"24","note":"","ucode":"F09DF49B6254E8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390271,"discussion_content":"æˆ‘è§‰å¾—ä½ è¯´å¾—å¯¹ï¼Œæ˜¯ä¸€ä¸ªéé˜»å¡çš„æ­»é”è¿™æ ·ç†è§£æ¯”è¾ƒå¥½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629735274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361244,"ip_address":""},"score":390271,"extra":""}]},{"author":{"id":1252848,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1d/f0/59702429.jpg","nickname":"idea","note":"","ucode":"621921030982C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293071,"discussion_content":"ä¸€å¼€å§‹çœ‹è¿™ä»£ç çœ‹ä¸å‡ºå•¥é—®é¢˜ï¼Œè¢«è¿™ä¹ˆä¸€è¯´ç»™ç‚¹æ˜ç™½äº†ï¼Œå­¦ä¹ äº†+1","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595426470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK2Az5uTh9ZGVA7yQCj1BXtXuicPRkvJicA97AoN9xX3bnPcUYglTMXJeZeoVbPQeJA7ICvQhR3KQ0w/132","nickname":"æ—¥ä¸è½å¸å›½","note":"","ucode":"6A11ABBD8AC438","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6189,"discussion_content":"å­¦ä¹ å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566774370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81536,"user_name":"xiyi","can_delete":false,"product_type":"c1","uid":1447833,"ip_address":"","ucode":"E368673D610D91","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIBarfQrgZjEW8uUgvQckubEIFwNCJL93OygIgx3fCkObgRzSdo2baVWRd1C8mV6VDGKuoBFic4ZZA/132","comment_is_top":false,"comment_ctime":1553938169,"is_pvip":false,"replies":[{"id":"29556","content":"ğŸ‘ğŸ‘ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":81536,"uid":"1269969","ip_address":"","utype":1,"ctime":1553988962,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"302201648889","product_id":100023901,"comment_content":"å­˜åœ¨æ´»é”ã€‚è¿™ä¸ªä¾‹å­å¯ä»¥ç¨å¾®æ”¹ä¸‹ï¼ŒæˆåŠŸè½¬è´¦ååº”è¯¥è·³å‡ºå¾ªç¯ã€‚åŠ ä¸ªéšæœºé‡è¯•æ—¶é—´é¿å…æ´»é”","like_count":70,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445243,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553988962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81409,"user_name":"bing","can_delete":false,"product_type":"c1","uid":1067589,"ip_address":"","ucode":"6ADAA36B2B732C","user_header":"https://static001.geekbang.org/account/avatar/00/10/4a/45/04a13bf9.jpg","comment_is_top":false,"comment_ctime":1553906443,"is_pvip":false,"replies":[{"id":"29576","content":"æ˜¯çš„ï¼Œé«˜æ‰‹ğŸ‘ğŸ‘ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":81409,"uid":"1269969","ip_address":"","utype":1,"ctime":1553999207,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":5,"race_medal":0,"score":"285021747979","product_id":100023901,"comment_content":"æ–‡ä¸­è¯´çš„å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œæ˜¯ä¸æŒ‰ç…§æ’é˜Ÿçš„é¡ºåºè¢«å”¤é†’ï¼Œæˆ‘è®°å¾—éå…¬å¹³é”çš„åœºæ™¯åº”è¯¥æ˜¯çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œå¦‚æœæ¥äº†ä¸€ä¸ªçº¿ç¨‹è·å–é”ï¼Œä»–ä¸å¿…å»æ’é˜Ÿç›´æ¥è·å–åˆ°ï¼Œåº”è¯¥ä¸ä¼šå…¥é˜Ÿå§ã€‚è·å–ä¸åˆ°æ‰è¿›å§","like_count":66,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445185,"discussion_content":"æ˜¯çš„ï¼Œé«˜æ‰‹ğŸ‘ğŸ‘ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553999207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1481811,"avatar":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","nickname":"ub8","note":"","ucode":"0D937C3EAEB781","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391372,"discussion_content":"è¯¯äººå­å¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630420862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2046055,"avatar":"","nickname":"æœæ€»","note":"","ucode":"C6600875A265E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286499,"discussion_content":"æ²¡è·å–åˆ°é”çš„çº¿ç¨‹ä¼šæ”¾åˆ°aqsé˜Ÿåˆ—å°¾éƒ¨ï¼Œç­‰åˆ°å¤´èŠ‚ç‚¹çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¼šé€šçŸ¥å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å‡ºé˜Ÿåˆ—æ‰§è¡Œï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯ç­‰å¾…ä¸æ˜¯é˜»å¡ï¼Œè¿è¡Œè‚¯å®šæ˜¯runnableçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593186385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":175472,"discussion_content":"æƒ³é—®ä¸€ä¸‹ ä¹‹å‰çš„æ’é˜Ÿçš„çº¿ç¨‹å µå¡ æ˜¯å¦‚ä½•è¢«å”¤é†’çš„ å°±æ˜¯é”æ± é‡Œé¢æ²¡æœ‰æŠ¢åˆ°å¯¹è±¡é”çš„çº¿ç¨‹ï¼Œå½“è¿›å»çš„å¯¹è±¡è¢«wait()ä»¥å é‡Šæ”¾æ‰å¯¹è±¡é”å  é‚£é”æ± é‡Œé¢çš„çº¿ç¨‹æ˜¯ç›´æ¥ä»blocked å˜æˆrunnableå—ï¼Ÿ  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581955348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2308075,"avatar":"","nickname":"Geek_89e362","note":"","ucode":"E596C2CFE1CFAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326838,"discussion_content":"æ˜¯WAITINGçŠ¶æ€ï¼ŒAQSé˜Ÿåˆ—çš„å¤´ç»“ç‚¹åœ¨é‡Šæ”¾é”æ—¶ï¼Œä¼šå”¤é†’å…¶åç»­å¤„äºWAITINGçš„èŠ‚ç‚¹ï¼Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605686291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":175472,"ip_address":""},"score":326838,"extra":""}]}]},{"had_liked":false,"id":118329,"user_name":"æ±Ÿæ¹–å¤œé›¨","can_delete":false,"product_type":"c1","uid":1282575,"ip_address":"","ucode":"C64913C7000899","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/0f/cff30522.jpg","comment_is_top":false,"comment_ctime":1564323530,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"267852295882","product_id":100023901,"comment_content":"ç»ˆäºç†è§£æœ€åä¸€é“é¢˜å‡ºç°æ´»é”é—®é¢˜äº†ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒäº‹æ‰§è¡Œï¼Œçº¿ç¨‹Aè·å–äº†u1.trylockï¼Œçº¿ç¨‹Bè·å–äº†u2.trylockï¼Œçº¿ç¨‹Aå°è¯•è·å–u2.trylockï¼Œä¸èƒ½æˆåŠŸï¼Œçº¿ç¨‹Aç»“æŸï¼ŒåŒæ—¶çº¿ç¨‹Bå°è¯•è·å–u1.trylockï¼Œä¸èƒ½æˆåŠŸï¼Œçº¿ç¨‹Bç»“æŸï¼Œåˆå¼€å§‹æ–°çš„ä¸€è½®ï¼Œè¿™æ ·ä¸€ç›´å¾ªç¯ä¸‹å»ï¼","like_count":62,"discussions":[{"author":{"id":1387088,"avatar":"","nickname":"å†æ¬¡é‡è§ä½ ","note":"","ucode":"09FC74C305F870","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552827,"discussion_content":"æˆ‘çš„ç†è§£è·Ÿä½ ä¸€è‡´","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645605372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2963434,"avatar":"","nickname":"Geek_94fa0e","note":"","ucode":"15BC7D4E130E80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560871,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649475611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2867465,"avatar":"","nickname":"Geek_73484e","note":"","ucode":"BFBF8878F186C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553859,"discussion_content":"ä¼šå¯¼è‡´é¥¥é¥¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646120136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2410092,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c6/6c/a400175a.jpg","nickname":"FARO_Z","note":"","ucode":"B33BCC36C2A74E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2867465,"avatar":"","nickname":"Geek_73484e","note":"","ucode":"BFBF8878F186C0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580121,"discussion_content":"ä¸æ˜¯é¥¥é¥¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657880305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":553859,"ip_address":""},"score":580121,"extra":""}]},{"author":{"id":1552958,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b2/3e/13c2b1c9.jpg","nickname":"Geek_600c87","note":"","ucode":"795A81C36CE3AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551441,"discussion_content":"æ„Ÿï¼Œçª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645017426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2403622,"avatar":"https://static001.geekbang.org/account/avatar/00/24/ad/26/d46f4394.jpg","nickname":"Owen","note":"","ucode":"FDE0D574B8ED5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348452,"discussion_content":"æ„Ÿåˆ† çªé¡¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612580576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289364,"discussion_content":"æ„Ÿè°¢åˆ†äº«ï¼Œçªç„¶é¡¿æ‚Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594081896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81561,"user_name":"J.M.Liu","can_delete":false,"product_type":"c1","uid":1200037,"ip_address":"","ucode":"B2CB84B8E923A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg","comment_is_top":false,"comment_ctime":1553945954,"is_pvip":false,"replies":[{"id":"29562","content":"ğŸ‘ğŸ‘ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":81561,"uid":"1269969","ip_address":"","utype":1,"ctime":1553990408,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"130402964834","product_id":100023901,"comment_content":"1.è¿™ä¸ªæ˜¯ä¸ªæ­»å¾ªç¯å•Šï¼Œæœ‰é”æ²¡ç¾¤ï¼Œéƒ½å‡ºä¸æ¥ã€‚<br>2.å¦‚æœæŠ›å¼€æ­»å¾ªç¯ï¼Œä¹Ÿä¼šé€ æˆæ´»é”ï¼ŒçŠ¶æ€ä¸ç¨³å®šã€‚å½“ç„¶è¿™ä¸ªä¹Ÿçœ‹åœºæ™¯ï¼Œå‡å¦‚å†²çªçª—å£å¾ˆå°ï¼Œåˆåœ¨å•æœºå¤šæ ¸çš„è¯ï¼Œæ´»é”çš„å¯èƒ½æ€§è¿˜æ˜¯å¾ˆå°çš„ï¼Œå¯ä»¥æ¥å—","like_count":30,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445253,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553990408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110375,"user_name":"æ£®å‘¢","can_delete":false,"product_type":"c1","uid":1239193,"ip_address":"","ucode":"B3D07ACF710B11","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/99/0ea71e63.jpg","comment_is_top":false,"comment_ctime":1562245194,"is_pvip":false,"replies":[{"id":"40165","content":"æ„Ÿè°¢è¡¥å……ğŸ˜„stateå¿…é¡»æ˜¯volatileå˜é‡ï¼Œå¦åˆ™æ˜¯ä¸ä¼šæœ‰unlock&gt;lockçš„ï¼Œæˆ‘æ¯”ä½ æ›´ç´§å¼ ğŸ˜‚","user_name":"ä½œè€…å›å¤","comment_id":110375,"uid":"1269969","ip_address":"","utype":1,"ctime":1562289747,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"104641460298","product_id":100023901,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¿™æ˜¯æˆ‘ç¬¬äºŒéç ”è¯»ä½ çš„è¯¾ç¨‹äº†ï¼Œæ¯ä¸€ééƒ½æ”¶è·å¾ˆå¤§ã€‚ç¬¬ä¸€æ¬¡å†™ç•™è¨€æœ‰ç‚¹ç´§å¼ ã€‚<br>ä½ ä¸Šé¢å†™çš„jdkåˆ©ç”¨å†…å­˜æ¨¡å‹çš„ä¸‰æ¡è§„åˆ™æ¥ä¿è¯å¯è§æ€§ï¼Œæ˜¯æ­£ç¡®çš„ã€‚ä½†æˆ‘è§‰å¾—å¥½åƒæè¿°çš„ç†ç”±å¥½åƒä¸å……åˆ†ï¼Œæˆ‘ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ï¼Œè¯·è€å¸ˆè§£ç­”ä¸€ä¸‹<br>æˆ‘çš„ç†è§£åº”è¯¥æ˜¯ ï¼š1ï¼‰é‡Šæ”¾é”æˆåŠŸåï¼Œå†™stateçš„å€¼ ï¼ˆunlock&gt;state-=1ï¼‰ é¡ºåºæ€§<br>2ï¼‰è·å–é”å‰ï¼Œè¯»stateå€¼ï¼ˆstate&gt;lockï¼‰é¡ºåºæ€§<br>3ï¼‰ä¼ é€’æ€§  unlock&gt;lock<br><br>ä¸‹é¢æ˜¯jdkçš„æºç <br>final boolean nonfairTryAcquire(int acquires) {<br>    final Thread current = Thread.currentThread();&#47;&#47;è·å–å½“å‰çº¿ç¨‹å®ä¾‹<br>    int c = getState();&#47;&#47;è·å–stateå˜é‡çš„å€¼,å³å½“å‰é”è¢«é‡å…¥çš„æ¬¡æ•°<br>    if (c == 0) {   &#47;&#47;stateä¸º0,è¯´æ˜å½“å‰é”æœªè¢«ä»»ä½•çº¿ç¨‹æŒæœ‰<br>        if (compareAndSetState(0, acquires)) { &#47;&#47;ä»¥casæ–¹å¼è·å–é”<br>            setExclusiveOwnerThread(current);  &#47;&#47;å°†å½“å‰çº¿ç¨‹æ ‡è®°ä¸ºæŒæœ‰é”çš„çº¿ç¨‹<br>            return true;&#47;&#47;è·å–é”æˆåŠŸ,éé‡å…¥<br>        }<br>    }<br>    else if (current == getExclusiveOwnerThread()) { &#47;&#47;å½“å‰çº¿ç¨‹å°±æ˜¯æŒæœ‰é”çš„çº¿ç¨‹,è¯´æ˜è¯¥é”è¢«é‡å…¥äº†<br>        int nextc = c + acquires;&#47;&#47;è®¡ç®—stateå˜é‡è¦æ›´æ–°çš„å€¼<br>        if (nextc &lt; 0) &#47;&#47; overflow<br>            throw new Error(&quot;Maximum lock count exceeded&quot;);<br>        setState(nextc);&#47;&#47;éåŒæ­¥æ–¹å¼æ›´æ–°stateå€¼<br>        return true;  &#47;&#47;è·å–é”æˆåŠŸ,é‡å…¥<br>    }<br>    return false;     &#47;&#47;èµ°åˆ°è¿™é‡Œè¯´æ˜å°è¯•è·å–é”å¤±è´¥<br>}<br><br>","like_count":24,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456845,"discussion_content":"æ„Ÿè°¢è¡¥å……ğŸ˜„stateå¿…é¡»æ˜¯volatileå˜é‡ï¼Œå¦åˆ™æ˜¯ä¸ä¼šæœ‰unlock&amp;gt;lockçš„ï¼Œæˆ‘æ¯”ä½ æ›´ç´§å¼ ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562289747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1239193,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e8/99/0ea71e63.jpg","nickname":"æ£®å‘¢","note":"","ucode":"B3D07ACF710B11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1083,"discussion_content":"è€å¸ˆè¯´çš„å¯¹ï¼Œæ¼äº†ï¼Œåº”è¯¥æ˜¯ï¼š\n1ï¼‰é‡Šæ”¾é”æˆåŠŸåï¼Œå†™stateçš„å€¼ ï¼ˆunlock>state-=1ï¼‰ é¡ºåºæ€§\n2ï¼‰è·å–é”å‰ï¼Œè¯»stateå€¼ï¼ˆstate>lockï¼‰é¡ºåºæ€§\n3ï¼‰å†™volatileçš„state>è¯»volatile stateçš„å€¼\n4ï¼‰ä¼ é€’æ€§ unlock>lock","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1562313856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2445017,"avatar":"https://static001.geekbang.org/account/avatar/00/25/4e/d9/a559e58c.jpg","nickname":"éƒ­æ©™è¼-","note":"","ucode":"2B61A22448E5DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411030,"discussion_content":"666å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635835083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1477324,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8a/cc/da9adc82.jpg","nickname":"å°å¤ªé˜³","note":"","ucode":"3B1C90425E485D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294593,"discussion_content":"çœ‹äº†ä½ çš„ç•™è¨€æˆ‘ç»ˆäºå¼„æ‡‚äº†unlock>lockçš„åŸå› äº†ï¼å¤šè°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595937324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83487,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1554622719,"is_pvip":false,"replies":[{"id":"30170","content":"ç‚¹ä¸ªå¤§å¤§çš„èµï¼ä¸è¿‡è¿˜å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå¦‚æœé˜»å¡åœ¨tar.lock.tryLockä¸Šä¸€æ®µæ—¶é—´ï¼Œthis.lockæ˜¯ä¸èƒ½é‡Šæ”¾çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":83487,"uid":"1269969","ip_address":"","utype":1,"ctime":1554633518,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":15,"race_medal":0,"score":"104633837823","product_id":100023901,"comment_content":"class Account {<br>  private int balance;<br>  private final Lock lock<br>          = new ReentrantLock();<br>  &#47;&#47; è½¬è´¦<br>  void transfer(Account tar, int amt){<br>\tboolean flag = true;<br>    while (flag) {<br>      if(this.lock.tryLock(éšæœºæ•°ï¼ŒNANOSECONDS)) {<br>        try {<br>          if (tar.lock.tryLock(éšæœºæ•°ï¼ŒNANOSECONDS)) {<br>            try {<br>              this.balance -= amt;<br>              tar.balance += amt;<br>\t      flag = false;<br>            } finally {<br>              tar.lock.unlock();<br>            }<br>          }&#47;&#47;if<br>        } finally {<br>          this.lock.unlock();<br>        }<br>      }&#47;&#47;if<br>    }&#47;&#47;while<br>  }&#47;&#47;transfer<br>}<br>æ„Ÿè§‰å¯ä»¥è¿™æ ·æ“ä½œ","like_count":24,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446044,"discussion_content":"ç‚¹ä¸ªå¤§å¤§çš„èµï¼ä¸è¿‡è¿˜å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå¦‚æœé˜»å¡åœ¨tar.lock.tryLockä¸Šä¸€æ®µæ—¶é—´ï¼Œthis.lockæ˜¯ä¸èƒ½é‡Šæ”¾çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554633518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004342,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/36/2c449c71.jpg","nickname":"å¶ç‰æ—","note":"","ucode":"C72E88613DB992","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53096,"discussion_content":"this.lock ä¸éœ€è¦éšæœºæ—¶é—´ï¼Œtar.lock.éœ€è¦éšæœºæ—¶é—´ æˆ‘ç†è§£çš„æ˜¯è¿™æ ·ï¼Œæˆ‘æŒæœ‰ä¸åˆ°å¯¹æ–¹çš„é”ï¼Œä¸ç«‹å³è¿”å›è€Œæ˜¯ç­‰å¾…ä¸€ä¼š","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1574132050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004342,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/36/2c449c71.jpg","nickname":"å¶ç‰æ—","note":"","ucode":"C72E88613DB992","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293442,"discussion_content":"åº”è¯¥æ˜¯å¤–å±‚åŠ éšæœºæ—¶é—´","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595549334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53096,"ip_address":""},"score":293442,"extra":""},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004342,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/36/2c449c71.jpg","nickname":"å¶ç‰æ—","note":"","ucode":"C72E88613DB992","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363146,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœæ˜¯å¤–å±‚éšæœºæ—¶é—´çš„è¯ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒAè½¬Bï¼ŒBè½¬Aï¼Œè·å–åˆ°å„è‡ªçš„thisï¼ŒåŒæ—¶è·å–tarçš„æ—¶å€™ç”±äºéƒ½æ²¡æœ‰é‡Šæ”¾é”å°±ä¼šç»“æŸç»§ç»­ä¸‹ä¸€è½®ï¼Œä¸€ç›´è·‘ä½†æ˜¯ä¸èƒ½å®Œæˆè½¬è´¦è¿˜æ˜¯å­˜åœ¨æ´»é”é—®é¢˜ã€‚\ntryLockæ–¹æ³•æè¿° {@code true} if the lock was free and was acquired by the current thread, or the lock was already held by the current thread; and {@code false} if the waiting time elapsed before the lock could be acquired","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1617116316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53096,"ip_address":""},"score":363146,"extra":""},{"author":{"id":1662987,"avatar":"https://static001.geekbang.org/account/avatar/00/19/60/0b/d7dddf19.jpg","nickname":"çš®çš®","note":"","ucode":"8C986AA546B44E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570023,"discussion_content":"å¤–å±‚åŠ éšæœºæ—¶é—´æ²¡ç”¨å•Šï¼Œçº¿ç¨‹æ‰§è¡Œåˆ°è¿™é‡Œå°±å¯ä»¥æ‹¿åˆ°é”ï¼Œåé¢è¿˜æ˜¯æœ‰æ´»é”é—®é¢˜","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1651639208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293442,"ip_address":""},"score":570023,"extra":""}]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293441,"discussion_content":"è€å¸ˆçš„æ„æ€åº”è¯¥æ˜¯å¦‚æœé˜»å¡åœ¨å†…å±‚ï¼Œå†…å±‚é”æ‹¿ä¸åˆ°ç­‰ä¸€æ®µæ—¶é—´ï¼Œæ­¤æ—¶å¤–å±‚é”æ˜¯æ²¡é‡Šæ”¾çš„ï¼Œè¿™æ®µæ—¶é—´å¯èƒ½å½¢æˆæ­»é”ï¼›ç ´è§£æ´»é”ä¸€ä¸ªéšæœºæ—¶é—´å°±å¤Ÿäº†","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1595549242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1533266,"avatar":"https://static001.geekbang.org/account/avatar/00/17/65/52/07c09c7f.jpg","nickname":"josancpp","note":"","ucode":"0CDC39B3E716A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275125,"discussion_content":"this.lockè¿˜æ˜¯è¦é‡Šæ”¾çš„ã€‚\nå¦‚æœAè½¬è´¦Bï¼ŒBè½¬è´¦Aï¼Œä¸¤ä¸ªé”éƒ½æ‹¿ä¸ªå„è‡ªçš„thisé”ï¼Œå¦‚æœä¸é‡Šæ”¾é”ï¼Œä¼šå‡ºç°æ­»é”","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590667491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293443,"discussion_content":"å¤–å±‚åŠ éšæœºæ—¶é—´ï¼Œå†…å±‚ä¸åŠ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595549359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580185,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1c/99/5e1a2118.jpg","nickname":"mylife","note":"","ucode":"D802160BFB29FC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591224,"discussion_content":"ä¸ªäººç†è§£ï¼šåªéœ€è¦1ä¸ªåœ°æ–¹åŠ éšæœºæ•°å°±å¯ä»¥äº†ã€‚åœ¨æ¡ä»¶ä¸æˆç«‹çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©é”çš„æŒæœ‰æ—¶é—´æœ€å°‘ï¼Œå¦‚æœæ˜¯åœ¨å†…å±‚éšæœºè¶…æ—¶æ—¶é—´çš„è¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸Šå±‚çš„é”æ˜¯æ²¡é‡Šæ”¾çš„ï¼Œå¦‚æœåŒæ–¹éƒ½è¿›å…¥åˆ°å†…å±‚çš„æ—¶å€™ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨æ­»é”çš„è¿‡ç¨‹ç›´åˆ°è¶…æ—¶æ—¶é—´ç ´åï¼›å¦‚æœåœ¨å¤–å±‚åŠ éšæœºçš„è¯ï¼Œå†…å±‚æ²¡è·å–å°±ç«‹åˆ»éƒ½é‡Šæ”¾ï¼Œåªéœ€è¦å¤–å±‚éšæœºä¸ä¸€æ ·ï¼Œå†æ¬¡è¿›æ¥åå°±ä¼šæˆåŠŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666410163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068432,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/90/25b6f544.jpg","nickname":"é©¬æ–‡é¾™","note":"","ucode":"679B0F0AB402C7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351308,"discussion_content":"å¤§å®¶è®¨è®ºäº†ä¸€ç•ªåï¼Œæ˜¯ä¸æ˜¯ä¸ç®¡é‡Œå¤–ï¼Œåªè¦æœ‰ä¸€å±‚åŠ éšæœºæ—¶é—´å°±å¤Ÿäº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614237867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1068432,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/90/25b6f544.jpg","nickname":"é©¬æ–‡é¾™","note":"","ucode":"679B0F0AB402C7","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":380463,"discussion_content":"æ˜¯çš„ï¼Œåªéœ€è¦é”™å¼€ä¸€ä¸ªäººçš„æ—¶é—´ï¼Œå°±é™ä½äº†æ´»é”çš„æ¦‚ç‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624517319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351308,"ip_address":""},"score":380463,"extra":""}]},{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294148,"discussion_content":"åªéœ€è¦å†…å±‚ä¸åŠ ç­‰å¾…æ—¶é—´å°±å¥½äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595810411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43380,"discussion_content":"æ˜¯è¯´ç¬¬äºŒä¸ªä¸ç”¨ç”¨éšæœºæ—¶é—´ trylockçš„æ„æ€å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572871173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43377,"discussion_content":"å¤§ä½¬ï¼Œè¯·æ•™ä¸€ä¸‹å•Šï¼Œè¿™ä¸ªè€å¸ˆè¯´çš„this.lockä¸èƒ½é‡Šæ”¾ï¼Œè¿™ä¸ªè¦å’‹ä¸ªä¼˜åŒ–ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572870977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177681,"user_name":"CDz","can_delete":false,"product_type":"c1","uid":1114779,"ip_address":"","ucode":"A23BEE1C4A5922","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/9b/b1a3c60d.jpg","comment_is_top":false,"comment_ctime":1581473039,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"96070753551","product_id":100023901,"comment_content":"ä»€ä¹ˆæ˜¯æ´»é”ï¼Ÿ<br>ç»“æœå’Œæ´»é”ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ï¼Œæ´»é”æ²¡æœ‰å µå¡ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œæœ‰æ•ˆä»£ç ã€‚<br><br>è¿™é‡Œä¸ºä»€ä¹ˆä¼šå‡ºç°æ´»é”ï¼Ÿ<br>å¯èƒ½å¯¼è‡´æ´»é” ï¼Œå¹¶ä¸ä¸€å®šä¼šæ´»é”ã€‚<br>åŸå› ï¼šåŒæ–¹åŒæ—¶ä¸ºå¯¹æ–¹è½¬è´¦æ—¶ï¼ŒåŒæ—¶è¿›å…¥ç¬¬ä¸€ä¸ªé”ï¼Œä½†æ˜¯å‘ç°è·å–ä¸åˆ°ç¬¬äºŒä¸ªé”ï¼Œäºæ˜¯é‡Šæ”¾ï¼Œè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ã€‚<br>ä¸‹ä¸€æ¬¡å¾ªç¯åŒæ ·çš„ç»“æœï¼Œè¿™å°±æ˜¯å‡ºç°äº†æ´»é”ã€‚<br><br>è§£å†³åŠæ³•ï¼š<br>å¼•å…¥éšæœºæ—¶é—´","like_count":23,"discussions":[{"author":{"id":2997759,"avatar":"","nickname":"Geek_85f669","note":"","ucode":"62E5C58B9CEDF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571532,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652259102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1652099,"avatar":"https://static001.geekbang.org/account/avatar/00/19/35/83/f2d7beac.jpg","nickname":"ç²‰çº¢çŒª","note":"","ucode":"355C1B87D3D0DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560435,"discussion_content":"è¿˜æœ‰æˆ‘ï¼Œæˆ‘æ˜¯åºŸç‰©(à²¥ï¹à²¥)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649328770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1900550,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqpYdydSevQVgL0xkj7REG9efRYeesEKnMlzSLVzcMxstvib1jD40BFqhXcJaiaX2AOeO69bf2SUx8Q/132","nickname":"æ˜¯æ„›ä¸æ˜¯çˆ±","note":"","ucode":"7577081245E620","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291372,"discussion_content":"çœ‹åˆ°ä½ è¿™é‡Œæˆ‘æ‰é¡¿æ‚Ÿï¼Œæˆ‘æ˜¯ä¸æ˜¯æ²¡æ•‘äº†o(â•¥ï¹â•¥)o","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594795402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1428043,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ca/4b/c1ace3aa.jpg","nickname":"èšä¸é±¿é±¼","note":"","ucode":"5DB98E406F1D3E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1900550,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqpYdydSevQVgL0xkj7REG9efRYeesEKnMlzSLVzcMxstvib1jD40BFqhXcJaiaX2AOeO69bf2SUx8Q/132","nickname":"æ˜¯æ„›ä¸æ˜¯çˆ±","note":"","ucode":"7577081245E620","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306652,"discussion_content":"æ²¡æ•‘çš„ä¸æ­¢ä½ ä¸€ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600340974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291372,"ip_address":""},"score":306652,"extra":""}]}]},{"had_liked":false,"id":81500,"user_name":"æµ·é¸¿","can_delete":false,"product_type":"c1","uid":1104275,"ip_address":"","ucode":"7074EF94EA70AD","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/93/098e5ef5.jpg","comment_is_top":false,"comment_ctime":1553928474,"is_pvip":false,"replies":[{"id":"29543","content":"å¯¹","user_name":"ä½œè€…å›å¤","comment_id":81500,"uid":"1269969","ip_address":"","utype":1,"ctime":1553950370,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"74568372506","product_id":100023901,"comment_content":"çªç„¶æœ‰ä¸ªé—®é¢˜ï¼š<br>cpuå±‚é¢çš„åŸå­æ€§æ˜¯å•æ¡cpuæŒ‡ä»¤ã€‚<br>javaå±‚é¢çš„äº’æ–¥ï¼ˆç®¡ç¨‹ï¼‰ä¿è¯äº†åŸå­æ€§ã€‚<br>è¿™ä¸¤ä¸ªåŸå­æ€§æ„ä¹‰åº”è¯¥ä¸ä¸€æ ·å§ï¼Ÿ<br>æˆ‘çš„ç†è§£æ˜¯cpuçš„åŸå­æ€§æ˜¯ä¸å—çº¿ç¨‹è°ƒåº¦å½±å“ï¼ŒæŒ‡ä»¤è¦ä¸æ‰§è¡Œäº†ï¼Œè¦ä¹ˆæ²¡æ‰§è¡Œã€‚è€Œjavaå±‚é¢çš„åŸå­æ€§æ˜¯åœ¨é”çš„æœºåˆ¶ä¸‹ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå…¶ä½™ç­‰å¾…ï¼Œæ­¤æ—¶cpuè¿˜æ˜¯å¯ä»¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œä½¿è¿è¡Œä¸­çš„é‚£ä¸ªçº¿ç¨‹è®©å‡ºcpuæ—¶é—´ï¼Œå½“ç„¶äº†è¯¥çº¿ç¨‹è¿˜æ˜¯æŒæ¡é”ã€‚<br>æˆ‘è¿™æ ·ç†è§£å¯¹å§ï¼Ÿ","like_count":17,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445230,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553950370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294430,"discussion_content":"ä½ ç†è§£çš„æ˜¯æ­£ç¡®çš„ï¼Œå¯æ˜¯è¿™æ ·çš„è¯ï¼Œä¸ºä»€ä¹ˆåŠ äº†é”è€å¸ˆè¿˜è¯´æœ‰å¯è§æ€§é—®é¢˜å‘¢ï¼ŸåŠ äº†é”ä¹‹åï¼Œä¿è¯åŸå­æ€§ï¼Œå˜é‡çš„å€¼å·²ç»åˆ·æ–°åˆ°å†…å­˜ä¸­äº†å•Šã€‚å…¶ä»–å¯è®¿é—®è¿™ä¸ªå˜é‡çš„çº¿ç¨‹ä¹Ÿå°±å¯¹è¿™ä¸ªå˜é‡å¯è§äº†å•Šã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595893036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1855112,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIYj6Zv3ibicLebxo7lsPMEwpBynHkYp8pLc3FcltUfmOBSRxpmicEwIAgP9OvSKnGGdaxwsZ7yiciaSsQ/132","nickname":"å†¯ç£Š","note":"","ucode":"4FFB8B984269FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383188,"discussion_content":"åŸå­æ€§å’Œå¯è§æ€§æ˜¯ä¸¤ä¸ªç°è±¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625974683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294430,"ip_address":""},"score":383188,"extra":""}]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289639,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594170503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81520,"user_name":"å§œæˆˆ","can_delete":false,"product_type":"c1","uid":1058972,"ip_address":"","ucode":"45C4BE93C8E4CC","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/9c/73e76b19.jpg","comment_is_top":false,"comment_ctime":1553933932,"is_pvip":false,"replies":[{"id":"29563","content":"ç”¨conditionä¼šæ›´å¤æ‚<br>","user_name":"ä½œè€…å›å¤","comment_id":81520,"uid":"1269969","ip_address":"","utype":1,"ctime":1553990530,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"61683476076","product_id":100023901,"comment_content":"æˆ‘ä¹Ÿè§‰å¾—æ˜¯å­˜åœ¨æ´»é”ï¼Œè€Œéæ­»é”ã€‚å­˜åœ¨è¿™ç§å¯èƒ½æ€§ï¼šäº’ç›¸æŒæœ‰å„è‡ªçš„é”ï¼Œå‘ç°éœ€è¦çš„å¯¹æ–¹çš„é”éƒ½è¢«å¯¹æ–¹æŒæœ‰ï¼Œå°±ä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„é”ï¼Œå¯¼è‡´å¤§å®¶éƒ½åœ¨ä¸åœæŒé”ï¼Œé‡Šæ”¾é”ï¼Œä½†äº‹æƒ…è¿˜æ²¡åšã€‚å½“ç„¶è¿˜æ˜¯ä¼šå­˜åœ¨è½¬è´¦æˆåŠŸçš„æƒ…æ™¯ï¼Œä¸è¿‡æ•ˆç‡ä½ä¸‹ã€‚æˆ‘è§‰å¾—æ­¤æ—¶éœ€è¦å¼•å…¥Conditionï¼Œåè°ƒä¸¤è€…åŒæ­¥å¤„ç†è½¬è´¦ï¼","like_count":14,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445239,"discussion_content":"ç”¨conditionä¼šæ›´å¤æ‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553990530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81384,"user_name":"Qå®çš„å®","can_delete":false,"product_type":"c1","uid":1219139,"ip_address":"","ucode":"55C575755A4905","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/43/d6291e76.jpg","comment_is_top":false,"comment_ctime":1553881047,"is_pvip":false,"replies":[{"id":"29485","content":"ç«çœ¼é‡‘ç›ğŸ‘ğŸ‘ğŸ‘ğŸ‘ï¼Œè¿™å°±æ”¹è¿‡æ¥<br>","user_name":"ä½œè€…å›å¤","comment_id":81384,"uid":"1269969","ip_address":"","utype":1,"ctime":1553904418,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"61683423191","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæœ¬æ–‡åœ¨è®²è¿°å¦‚ä½•ä¿è¯å¯è§æ€§æ—¶ï¼Œåˆ†æç¤ºä¾‹--â€œçº¿ç¨‹ T1 å¯¹ value è¿›è¡Œäº† +=1 æ“ä½œåï¼Œåç»­çš„çº¿ç¨‹ T2 èƒ½å¦çœ‹åˆ° value çš„æ­£ç¡®ç»“æœï¼Ÿâ€œæ—¶ï¼Œæåˆ°ä¸‰æ¡Happen-Beforeè§„åˆ™ï¼Œè¿™é‡Œåœ¨è§£é‡Šç¬¬2æ¡å’Œç¬¬3æ¡è§„åˆ™æ—¶ï¼Œä¼¼ä¹è¯´åäº†ï¼Œæ­£ç¡®çš„åº”è¯¥æ˜¯ï¼Œæ ¹æ®volatileå˜é‡è§„åˆ™ï¼Œçº¿ç¨‹T1çš„unlock()æ“ä½œHappen-Beforeäºçº¿ç¨‹T2çš„lock()æ“ä½œï¼Œæ‰€ä»¥ï¼Œæ ¹æ®ä¼ é€’æ€§è§„åˆ™ï¼Œçº¿ç¨‹ T1 çš„ value+=1æ“ä½œHappen-Beforeäºçº¿ç¨‹T2çš„lock()æ“ä½œã€‚è¯·è€å¸ˆæŒ‡æ­£ã€‚","like_count":14,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445174,"discussion_content":"ç«çœ¼é‡‘ç›ğŸ‘ğŸ‘ğŸ‘ğŸ‘ï¼Œè¿™å°±æ”¹è¿‡æ¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553904418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1654600,"avatar":"","nickname":"xanxus","note":"","ucode":"FFF1EFD2ABCBAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312142,"discussion_content":"happend-beforeä¸­çš„é”çš„è§„åˆ™è·Ÿå¹¶å‘åŒ…é‡Œé¢çš„æ²¡æœ‰å…³ç³»å§ï¼Œå½“ç„¶å¹¶å‘åŒ…é‡Œé¢çš„åŒæ ·æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œä½†æ˜¯ç”¨è¿™ä¸ªå¤ªæ¨ç†çš„è¯ï¼Œæ„Ÿè§‰æœ‰ç‚¹å› æœå€’ç½®çš„æ„Ÿè§‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602594960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3003,"discussion_content":"è€å¸ˆæ˜¯ä¸æ˜¯å†æ•…æ„è€ƒéªŒæˆ‘ä»¬è‡ªå·±ç†è§£ç¨‹åº¦ï½ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564107129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81380,"user_name":"ç¾Šä¸‰","can_delete":false,"product_type":"c1","uid":1103221,"ip_address":"","ucode":"59F03ED302A734","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/75/75dab2b3.jpg","comment_is_top":false,"comment_ctime":1553879246,"is_pvip":false,"replies":[{"id":"29569","content":"æ˜¯çš„<br>","user_name":"ä½œè€…å›å¤","comment_id":81380,"uid":"1269969","ip_address":"","utype":1,"ctime":1553992002,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"44503552206","product_id":100023901,"comment_content":"ç”¨éé˜»å¡çš„æ–¹å¼å»è·å–é”ï¼Œç ´åäº†ç¬¬äº”ç« æ‰€è¯´çš„äº§ç”Ÿæ­»é”çš„å››ä¸ªæ¡ä»¶ä¹‹ä¸€çš„â€œä¸å¯æŠ¢å â€ã€‚æ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚<br><br>ç”¨é”çš„æœ€ä½³å®è·µï¼Œç¬¬ä¸‰ä¸ªâ€œæ°¸è¿œä¸åœ¨è°ƒç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•æ—¶åŠ é”â€ï¼Œæˆ‘ç†è§£å…¶å®æ˜¯åœ¨å·¥ç¨‹è§„èŒƒä¸Šé¿å…å¯èƒ½å‡ºç°çš„é”ç›¸å…³é—®é¢˜ã€‚","like_count":10,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445171,"discussion_content":"æ˜¯çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553992002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81504,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1553929349,"is_pvip":false,"replies":[{"id":"29565","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":81504,"uid":"1269969","ip_address":"","utype":1,"ctime":1553991646,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"35913667717","product_id":100023901,"comment_content":"1 ä¸ä¼šå‡ºç°æ­»é”ï¼Œå› ä¸ºä¸å­˜åœ¨é˜»å¡çš„æƒ…å†µ<br>2 çº¿ç¨‹è¾ƒå¤šçš„æƒ…å†µä¼šå¯¼è‡´éƒ¨åˆ†çº¿ç¨‹å§‹ç»ˆæ— æ³•è·å–åˆ°é”ï¼Œå¯¼è‡´æ´»é”","like_count":9,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445232,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553991646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136248,"user_name":"å¼ é‘«","can_delete":false,"product_type":"c1","uid":1166695,"ip_address":"","ucode":"3CE5B1077184B2","user_header":"https://static001.geekbang.org/account/avatar/00/11/cd/67/23fab87a.jpg","comment_is_top":false,"comment_ctime":1569395701,"is_pvip":true,"replies":[{"id":"52395","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":136248,"uid":"1269969","ip_address":"","utype":1,"ctime":1569495102,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"31634166773","product_id":100023901,"comment_content":"å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œå…¬å¹³é”å”¤é†’ç­–ç•¥å°±æ˜¯è°ç­‰å¾…æ—¶é—´é•¿ï¼Œå°±å”¤é†’è°ã€‚éå…¬å¹³é”ï¼Œæœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­ã€‚<br>å¯¹äºå…¬å¹³é”å’Œéå…¬å¹³é”æˆ‘æœ‰ä¸åŒçš„ç†è§£ã€‚<br><br>ä¸ªäººç†è§£ï¼šå…¬å¹³é”æ˜¯ç›´æ¥å…ˆè¿›å…¥AQSåŒæ­¥é˜Ÿåˆ—ï¼ŒæŠ¢å é”ã€‚éå…¬å¹³é”ï¼Œæ˜¯å…ˆæŠ¢å é”ï¼Œè‹¥æ²¡æœ‰æŠ¢åˆ°åˆ™è¿›å…¥AQSåŒæ­¥é˜Ÿåˆ—ï¼Œç­‰å¾…å”¤é†’ã€‚<br><br>éå…¬å¹³é”ä»£ç ï¼š<br>\tfinal void lock() {<br>            if (compareAndSetState(0, 1))<br>                setExclusiveOwnerThread(Thread.currentThread());<br>            else<br>                acquire(1);<br>        }<br>å…¬å¹³é”ï¼š<br>\t final void lock() {<br>            acquire(1);<br>        }<br><br>acquire(1)æ˜¯å½“å‰çº¿ç¨‹æŠ¢å é”ï¼Œè‹¥æ²¡æœ‰æŠ¢åˆ°åˆ™åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚å…¬å¹³é”å’Œéå…¬å¹³é”é€»è¾‘ä¸€è‡´ã€‚","like_count":7,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468525,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569495102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81454,"user_name":"æœ±å°è±ª","can_delete":false,"product_type":"c1","uid":1311234,"ip_address":"","ucode":"9177EF1DDFF346","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/02/1080b30c.jpg","comment_is_top":false,"comment_ctime":1553917351,"is_pvip":false,"replies":[{"id":"29561","content":"åŠ äº†breakï¼Œä¹Ÿä¼šæœ‰æ´»é”é—®é¢˜ï¼Œä¸åŠ çš„è¯æˆ‘è§‰å¾—ä¹Ÿæ˜¯æ´»é”ï¼Œå› ä¸ºé”éƒ½ä¼šé‡Šæ”¾<br>","user_name":"ä½œè€…å›å¤","comment_id":81454,"uid":"1269969","ip_address":"","utype":1,"ctime":1553989455,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"31618688423","product_id":100023901,"comment_content":"åº”è¯¥æ˜¯å°‘äº†ä¸ªbreakè·³å‡ºå¾ªç¯ï¼Œç„¶åè¿™ä¸ªä¾‹å­æ˜¯ä¼šäº§ç”Ÿæ­»é”çš„ï¼Œå› ä¸ºæ»¡è¶³äº†æ­»é”äº§ç”Ÿçš„æ¡ä»¶ã€‚","like_count":7,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445205,"discussion_content":"åŠ äº†breakï¼Œä¹Ÿä¼šæœ‰æ´»é”é—®é¢˜ï¼Œä¸åŠ çš„è¯æˆ‘è§‰å¾—ä¹Ÿæ˜¯æ´»é”ï¼Œå› ä¸ºé”éƒ½ä¼šé‡Šæ”¾\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553989455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126171,"user_name":"zyz","can_delete":false,"product_type":"c1","uid":1019339,"ip_address":"","ucode":"0092F8C0FFA375","user_header":"","comment_is_top":false,"comment_ctime":1566345602,"is_pvip":false,"replies":[{"id":"46577","content":"æ˜¯ç®¡ç¨‹çš„å®ç°","user_name":"ä½œè€…å›å¤","comment_id":126171,"uid":"1269969","ip_address":"","utype":1,"ctime":1566359269,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"27336149378","product_id":100023901,"comment_content":"è€å¸ˆï¼Œlockæ˜¯ç”¨aqså®ç°çš„ï¼Œaqsæ˜¯ç”¨äº†volatileï¼‹casæ“ä½œç³»ç»ŸåŸå­æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ç®¡ç¨‹å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463863,"discussion_content":"æ˜¯ç®¡ç¨‹çš„å®ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566359269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114509,"user_name":"å°äºˆ","can_delete":false,"product_type":"c1","uid":1442580,"ip_address":"","ucode":"3F5EAEE1746074","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/14/e9ca2d09.jpg","comment_is_top":false,"comment_ctime":1563327143,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18743196327","product_id":100023901,"comment_content":"1ã€è½¬è´¦æˆåŠŸè·³å‡ºå¾ªç¯ï¼Œé¿å…æ­»å¾ªç¯<br>2ã€é”è‡ªå·±è´¦æˆ·æ—¶ï¼ŒåŠ ä¸€ä¸ªéšæœºç­‰å¾…æ—¶é—´ï¼Œé¿å…æ´»é”<br>3ã€é”ç›®æ ‡è´¦æˆ·æ—¶ï¼Œé”ä¸åˆ°åˆ™ç›´æ¥è§£é”<br>class Account {<br>\tprivate int balance;<br>\tprivate final Lock lock = new ReentrantLock();<br>    &#47;&#47; è½¬è´¦<br>    void transfer(Account tar, int amt){<br>\t\twhile (true) {<br>\t\t    if(this.lock.tryLock(éšæœºæ•°ï¼ŒNANOSECONDS)) {<br>\t\t\t\ttry {<br>\t\t\t\t\tif (tar.lock.tryLock()) {<br>\t\t\t\t\t\ttry {<br>\t\t\t\t\t\t\tthis.balance -= amt;<br>\t\t\t\t\t\t\ttar.balance += amt;<br>\t\t\t\t\t\t\t&#47;&#47; è½¬è´¦æˆåŠŸç»“æŸå¾ªç¯<br>\t\t\t\t\t\t\tbreak;<br>\t\t\t\t\t\t} finally {<br>\t\t\t\t\t\t\ttar.lock.unlock();<br>\t\t\t\t\t\t}<br>\t\t\t\t\t}&#47;&#47;if<br>\t\t\t\t} finally {<br>\t\t\t\t\tthis.lock.unlock();<br>\t\t\t\t}<br>\t\t\t}&#47;&#47;if<br>\t\t}&#47;&#47;while<br>    }&#47;&#47;transfer<br>}","like_count":4,"discussions":[{"author":{"id":1621470,"avatar":"https://static001.geekbang.org/account/avatar/00/18/bd/de/e0c994b3.jpg","nickname":"ååœ°é“çš„ç¨‹åºå‘˜","note":"","ucode":"A04A239D173E2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5248,"discussion_content":"æˆ‘è§‰å¾—ä½ è¿™æ ·çš„ä¼˜åŒ–ï¼ŒåŒæ ·å­˜åœ¨æ´»é”çš„å¯èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566114503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94880,"user_name":"tdytaylor","can_delete":false,"product_type":"c1","uid":1181214,"ip_address":"","ucode":"5B4919FDFE91A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/1e/51ad425f.jpg","comment_is_top":false,"comment_ctime":1557914801,"is_pvip":false,"replies":[{"id":"33934","content":"æƒ³æƒ³å¯¹é¢ç›¸é‡çš„ä¸¤ä¸ªäººäº’ç›¸è°¦è®©çš„ä¾‹å­çœ‹çœ‹","user_name":"ä½œè€…å›å¤","comment_id":94880,"uid":"1269969","ip_address":"","utype":1,"ctime":1557929657,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"18737783985","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ€è€ƒä¹‹åè§‰å¾—ä¸ä¼šå‡ºç°æ­»é”ï¼Œä½†æ˜¯æ²¡çœ‹å‡ºä¸ºä»€ä¹ˆä¼šå‡ºç°æ´»é”","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450243,"discussion_content":"æƒ³æƒ³å¯¹é¢ç›¸é‡çš„ä¸¤ä¸ªäººäº’ç›¸è°¦è®©çš„ä¾‹å­çœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557929657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228393,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/69/5404e5a3.jpg","nickname":"momo","note":"","ucode":"3B2CB1EC9BC601","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361744,"discussion_content":"cpuç‰‡æ•ˆç‡æœ‰é‚£ä¹ˆå·®å— AtryLock è¿›å…¥ä¸‹æ¬¡å¾ªç¯å‰ Bä¸ä¼šæœ‰ä¸€ç¬é—´å‘ç°çš„æœºä¼šï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616742905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1428043,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ca/4b/c1ace3aa.jpg","nickname":"èšä¸é±¿é±¼","note":"","ucode":"5DB98E406F1D3E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306653,"discussion_content":"å…¬äº¤è½¦åªå‰©ä¸€ä¸ªä½å­ï¼Œä¸¤ä¸ªäººä¸€ç›´ä¸åœäº’ç›¸è®©åº§ï¼Œç„¶åé‚£ä¸ªä½ç½®å°±ä¸€ç›´ç©ºç€äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600341075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81446,"user_name":"æœ±å°è±ª","can_delete":false,"product_type":"c1","uid":1311234,"ip_address":"","ucode":"9177EF1DDFF346","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/02/1080b30c.jpg","comment_is_top":false,"comment_ctime":1553915626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18733784810","product_id":100023901,"comment_content":"æœ¬æ–‡æœ€åçš„ä¾‹å­ï¼Œä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦ç”¨while trueè€Œä¸”æ²¡æœ‰è·³å‡ºå¾ªç¯ï¼Œè¿™ä¸æ˜¯æ­»å¾ªç¯å—","like_count":4},{"had_liked":false,"id":210313,"user_name":"nodlee","can_delete":false,"product_type":"c1","uid":1155871,"ip_address":"","ucode":"C1D36A5A72A0D1","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/1f/c94facb8.jpg","comment_is_top":false,"comment_ctime":1587718811,"is_pvip":false,"replies":[{"id":"78692","content":"æ²¡é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1588032652,"ip_address":"","comment_id":210313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14472620699","product_id":100023901,"comment_content":"T1                    T2<br>lock(1)               lock(1)<br>  \tgetState              getState<br>value += 1;           value += 1;<br>unlock(1);            unlock(1); <br>\tgetState              getState<br>\tsetState              setState<br>T1 å’Œ T2 çš„æ“ä½œåºåˆ—å¯ä»¥ç®€åŒ–ä¸ºä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘çš„ç†è§£ï¼šT1 unlock æœ€åä¼šå†™ state, è€Œ T2 çš„ lock é¦–å…ˆè¯» state, æ ¹æ® volatile å†™ä¼˜å…ˆäºè¯»çš„åŸåˆ™ï¼Œæ‰€ä»¥ T1 çš„ unlock() æ“ä½œ Happens-Before T2 çš„ lock() æ“ä½œï¼› ä¸çŸ¥é“è¿™æ ·ç†è§£æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493002,"discussion_content":"æ²¡é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588032652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131417,"user_name":"å…”2ğŸ°ğŸƒ","can_delete":false,"product_type":"c1","uid":1096984,"ip_address":"","ucode":"1FEDA044BB6CBD","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/18/2af6bf4b.jpg","comment_is_top":false,"comment_ctime":1567744006,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14452645894","product_id":100023901,"comment_content":"volatile å˜é‡è§„åˆ™ï¼šã€unlock()å¯¹stateçš„å†™æ“ä½œ happens-beforeå…¶ä»–çº¿ç¨‹lock() å¯¹ stateçš„è¯»æ“ä½œï¼Œã€‘æ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼› <br>è¿™æ ·ä¼šä¸ä¼šæ›´å®¹æ˜“ç†è§£äº›ï¼Ÿ","like_count":3},{"had_liked":false,"id":83035,"user_name":"æ˜“å„¿æ˜“","can_delete":false,"product_type":"c1","uid":1242864,"ip_address":"","ucode":"B15D1031CA841E","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132","comment_is_top":false,"comment_ctime":1554378674,"is_pvip":false,"replies":[{"id":"30070","content":"æ˜¯çš„ï¼Œéƒ½è¢«å”¤é†’ã€‚ç†è®ºä¸Šæ˜¯åŒæ—¶è¿›å…¥å…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…æ—¶é—´æ˜¯ç›¸åŒçš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554479267,"ip_address":"","comment_id":83035,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14439280562","product_id":100023901,"comment_content":"è€å¸ˆï¼ŒnotifyAll()åœ¨é¢å¯¹å…¬å¹³é”å’Œéå…¬å¹³é”çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯æ•ˆæœå°±ä¸€æ ·äº†ï¼Ÿæ‰€æœ‰ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…¨éƒ¨è¢«å”¤é†’ï¼Œç»Ÿç»Ÿåˆ°å…¥å£ç­‰å¾…é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Ÿè¿™äº›è¢«å”¤é†’çš„çº¿ç¨‹ä¸ç”¨æ ¹æ®ç­‰å¾…æ—¶é—´æ’é˜Ÿå†æ”¾å…¥å…¥å£ç­‰å¾…é˜Ÿåˆ—ä¸­äº†å§ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445827,"discussion_content":"æ˜¯çš„ï¼Œéƒ½è¢«å”¤é†’ã€‚ç†è®ºä¸Šæ˜¯åŒæ—¶è¿›å…¥å…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…æ—¶é—´æ˜¯ç›¸åŒçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554479267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81800,"user_name":"å³è€³å¬æµ·","can_delete":false,"product_type":"c1","uid":1022011,"ip_address":"","ucode":"E0B9F1083F4F98","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/3b/5af90c80.jpg","comment_is_top":false,"comment_ctime":1554037987,"is_pvip":false,"replies":[{"id":"29663","content":"=1ä¹‹å‰æœ‰ä¸€æ®µä»£ç ä¼šæŸ¥çœ‹çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œæ˜¾ç„¶ä¸èƒ½ä¸‰ä¸ƒäºŒåä¸€ç›´æ¥è®¾ç½®<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554078886,"ip_address":"","comment_id":81800,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14438939875","product_id":100023901,"comment_content":"è¯·é—®state=1å…ˆè¯»å–æ˜¯æ€ä¹ˆå¾—å‡ºæ¥çš„ï¼Œè¿˜æœ‰lockå’Œunlockçš„æ–¹æ³•å¯¹stateéƒ½æ˜¯å†™æ“ä½œï¼Œæ€ä¹ˆç”¨åˆ°valiateè§„åˆ™çš„ï¼Œvaliateè§„åˆ™ä¸æ˜¯è¯»å–æ“ä½œå…ˆä¸å†™æ“ä½œå—ï¼Œè¿™ä¸ªåœ°æ–¹ä¸¤ä¸ªéƒ½æ˜¯å†™æ“ä½œ","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445352,"discussion_content":"=1ä¹‹å‰æœ‰ä¸€æ®µä»£ç ä¼šæŸ¥çœ‹çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œæ˜¾ç„¶ä¸èƒ½ä¸‰ä¸ƒäºŒåä¸€ç›´æ¥è®¾ç½®\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554078886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135601,"user_name":"Wangxi","can_delete":false,"product_type":"c1","uid":1211790,"ip_address":"","ucode":"C25A9A14179930","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/8e/bb16d414.jpg","comment_is_top":false,"comment_ctime":1569226141,"is_pvip":true,"replies":[{"id":"53610","content":"æœ€ç»ˆéƒ½ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„APIï¼Œçº¿ç¨‹éƒ½ä¼šè¢«æŒ‚èµ·ï¼Œæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦çœ‹éƒ½æ˜¯é‡é‡çº§çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1570580819,"ip_address":"","comment_id":135601,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10159160733","product_id":100023901,"comment_content":"è¯·é—®è€å¸ˆä¸€ä¸ªé—®é¢˜ã€‚AQSå®ç°çš„é”ï¼Œé˜»å¡å”¤é†’çº¿ç¨‹ä½¿ç”¨çš„æ˜¯park&#47;unparkæ–¹æ³•ã€‚synchronizedå…³é”®å­—å®ç°çš„é”ï¼Œåœ¨åº•å±‚ä¹Ÿæ˜¯park&#47;unparkã€‚è¿™ä¸¤ç§é”åº•å±‚å®ç°å¯ä»¥è®¤ä¸ºæ˜¯ä¸€è‡´çš„å—ã€‚å¦‚æœæ˜¯ä¸€è‡´çš„ã€‚é‚£ä¹ˆlockæ¥å£ä¹Ÿæ˜¯é‡é‡çº§é”äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468262,"discussion_content":"æœ€ç»ˆéƒ½ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„APIï¼Œçº¿ç¨‹éƒ½ä¼šè¢«æŒ‚èµ·ï¼Œæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦çœ‹éƒ½æ˜¯é‡é‡çº§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570580819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127325,"user_name":"xinglichea","can_delete":false,"product_type":"c1","uid":1176447,"ip_address":"","ucode":"986DA07BF3CA89","user_header":"https://static001.geekbang.org/account/avatar/00/11/f3/7f/2dd9409b.jpg","comment_is_top":false,"comment_ctime":1566655059,"is_pvip":false,"replies":[{"id":"47167","content":"ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½èƒ½ä»£æ›¿ï¼Œé‡æ–°æƒ³æƒ³å¹¶å‘ä¸‹i++","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1566712027,"ip_address":"","comment_id":127325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10156589651","product_id":100023901,"comment_content":"2.æ°¸è¿œåªåœ¨è®¿é—®å¯å˜çš„æˆå‘˜å˜é‡æ—¶åŠ é”<br><br>è€å¸ˆï¼Œè¯·é—®ä¸‹ï¼Œè®¿é—®å¯å˜çš„æˆå‘˜å˜é‡æ—¶åŠ é”æ–¹æ¡ˆï¼Œèƒ½å¦ç”¨volatileå˜é‡æ›¿ä»£ï¼Ÿå¦‚æœå¯ä»¥ï¼Œåœ¨å¹¶å‘èƒ½åŠ›ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464442,"discussion_content":"ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½èƒ½ä»£æ›¿ï¼Œé‡æ–°æƒ³æƒ³å¹¶å‘ä¸‹i++","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566712027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127120,"user_name":"é™æ°´æµæ·±","can_delete":false,"product_type":"c1","uid":1339724,"ip_address":"","ucode":"644F05EFBD2E7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/71/4c/2cefec07.jpg","comment_is_top":false,"comment_ctime":1566559525,"is_pvip":false,"replies":[{"id":"47077","content":"è¿™ä¸ªå»ºè®®æˆ‘è§‰å¾—éå¸¸å¥½ğŸ˜ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1566617555,"ip_address":"","comment_id":127120,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10156494117","product_id":100023901,"comment_content":"ä»¥å‰å­¦å¹¶å‘ç¼–ç¨‹æ—¶å€™å¾ˆåƒåŠ›ï¼Œå°±æ˜¯åšæŒå­¦å®Œäº†æœ¬ç« åï¼Œæˆ‘æœ‰ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ï¼è°¢è°¢è€å¸ˆï¼è¿™ä¸ªä¸“æ ï¼Œå¼ºçƒˆå»ºè®®æ¶¨ä»·ï¼ï¼","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464328,"discussion_content":"è¿™ä¸ªå»ºè®®æˆ‘è§‰å¾—éå¸¸å¥½ğŸ˜ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566617555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1860513,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/63/a1/e281d530.jpg","nickname":"ç‹æ™¨æ—­","note":"","ucode":"AB7364E1809126","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205895,"discussion_content":"ä½ å¯ä»¥å¤šä¹°å‡ ç« é€äºº ä»¥æ˜¾ç¤ºä½ åœŸè±ªçš„èº«ä»½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584355015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1987202,"avatar":"","nickname":"Geek_783cc7","note":"","ucode":"C43F76B1978FA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325736,"discussion_content":"ä½ æ˜¯é­”é¬¼å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605418451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87834,"user_name":"é”¦","can_delete":false,"product_type":"c1","uid":1468298,"ip_address":"","ucode":"CB0EB4B68C468B","user_header":"https://static001.geekbang.org/account/avatar/00/16/67/8a/babd74dc.jpg","comment_is_top":false,"comment_ctime":1555726655,"is_pvip":false,"replies":[{"id":"31617","content":"SDKçš„æ®µä½å’ŒJVMå·®è·è¿˜æ˜¯æŒºå¤§çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555746881,"ip_address":"","comment_id":87834,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10145661247","product_id":100023901,"comment_content":"æ–‡ä¸­æåˆ°JAVA SDK é‡Œé¢Lockä¹Ÿæ˜¯JAVAå¯¹ç®¡ç¨‹çš„å¦ä¸€ç§å®ç°ï¼Œé‚£ä¹ˆæƒ³å¿…ä¹Ÿæ˜¯ç¬¦åˆç®¡ç¨‹çš„å·¥ä½œåŸç†ï¼Œå³å†…éƒ¨å°è£…å…±äº«å˜é‡å’Œæ¡ä»¶å˜é‡ç­‰å¾…é˜Ÿåˆ—å’Œæ“ä½œæ–¹æ³•ã€‚é‚£ä¹ˆå…¶å¯è§æ€§ä¸ºä»€ä¹ˆä¸èƒ½é€šè¿‡ç®¡ç¨‹ä¸­é”çš„happens-beforeè§„åˆ™æ¥ä¿è¯å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447618,"discussion_content":"SDKçš„æ®µä½å’ŒJVMå·®è·è¿˜æ˜¯æŒºå¤§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555746881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81702,"user_name":"æ‹’ç»","can_delete":false,"product_type":"c1","uid":1335155,"ip_address":"","ucode":"CB0264C4D3FE17","user_header":"https://static001.geekbang.org/account/avatar/00/14/5f/73/bb3dc468.jpg","comment_is_top":false,"comment_ctime":1554012627,"is_pvip":false,"replies":[{"id":"29624","content":"åŠ ä¸ªéšæœºçº¿ç¨‹ç¡çœ æ—¶é—´å°±å¯ä»¥äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554030865,"ip_address":"","comment_id":81702,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10143947219","product_id":100023901,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br>   é‚£åœ¨è§£å†³è¿™ä¸ªæ´»é”é—®é¢˜æ—¶ï¼Œæ˜¯åœ¨è·å–å…¶ä»–å¯¹è±¡é”å‰é¢ï¼ˆtar.lock.tryLock()ï¼‰åŠ ä¸ªéšæœºçº¿ç¨‹ç¡çœ æ—¶é—´ï¼Ÿè¿˜æ˜¯ã€Šjavaç¼–ç¨‹ï¼šè®¾è®¡åŸåˆ™ä¸æ¨¡å¼ã€‹ä¸­çš„ç¬¬ä¸‰æ¡ï¼Œæ°¸è¿œä¸åœ¨è°ƒç”¨å…¶ä»–å¯¹è±¡æ—¶åŠ é”ï¼›å»æ‰ï¼ˆtar.lock.tryLock()ï¼‰ è¿™ä¸ªé”æ¥è§£å†³æ´»é”å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445306,"discussion_content":"åŠ ä¸ªéšæœºçº¿ç¨‹ç¡çœ æ—¶é—´å°±å¯ä»¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554030865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346483,"user_name":"Bumblebee","can_delete":false,"product_type":"c1","uid":2051293,"ip_address":"","ucode":"B879C8A511D08D","user_header":"https://static001.geekbang.org/account/avatar/00/1f/4c/dd/c6035349.jpg","comment_is_top":false,"comment_ctime":1653192601,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5948159897","product_id":100023901,"comment_content":"ä»Šæ—¥æ€»ç»“ï¼Œæ€»ç»“çš„ä¸å¯¹çš„å¸Œæœ›è€å¸ˆåŒå­¦ä»¬å¤šå¤šæŒ‡æ­£ã€‚<br><br><br>ä¸€ã€Javaæœ¬èº«æœ‰äº†synchronizedä¸ºä»€ä¹ˆè¿˜æœ‰æä¾›Lockå®ç°ï¼Ÿ<br><br>â‘   é¦–å…ˆå›é¡¾ä¸€ä¸‹å‘ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼›<br>      1ï¼‰çº¿ç¨‹å¯¹èµ„æºçš„è®¿é—®æ˜¯äº’æ–¥çš„ï¼›<br>      2ï¼‰å æœ‰ä¸”ç­‰å¾…ï¼ˆçº¿ç¨‹åœ¨è·å–æŸä¸ªèµ„æºå¤±è´¥æ—¶ï¼Œä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œè‡ªå·±å·²ç»æŒæœ‰çš„èµ„æºï¼‰ï¼›<br>      3ï¼‰ä¸å¯ä¸­æ–­ï¼ˆçº¿ç¨‹æ— æ³•å“åº”å…¶ä»–çº¿ç¨‹çš„ä¸­æ–­ï¼‰ï¼›<br>      4ï¼‰å¾ªç¯ç­‰å¾…ï¼ˆçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼‰ï¼›<br>â‘¡  è¦ç ´åæ­»é”ä»»æ„ç ´åæ­»é”å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªå³å¯ï¼›<br>â‘¢  å› æ­¤jdkçš„Lockå®ç°æä¾›äº†ä¸‹é¢å‡ ä¸ªæ–¹æ³•æ¥è§£å†³æ­»é”é—®é¢˜ï¼›<br>    1ï¼‰æ”¯æŒä¸­æ–­çš„APIï¼›<br>          void lockInterruptibly() throws  InterruptedException;ï¼ˆæŒæœ‰synchronizedéšå¼é”çº¿ç¨‹è¢«é˜»å¡åæ— æ³•å“åº”ä¸­æ–­ï¼Œè€ŒæŒæœ‰Locké”çš„çº¿ç¨‹åœ¨é˜»å¡çŠ¶æ€ä¸‹æ˜¯èƒ½å¤Ÿå“åº”ä¸­æ–­çš„ï¼Œè¿™æ ·è¢«é˜»å¡çš„çº¿ç¨‹æ‰æœ‰æœºä¼šé‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”ï¼‰ï¼›<br><br>    2ï¼‰æ”¯æŒè¶…æ—¶çš„APIï¼›<br>          boolean tryLock(long time, TimeUnit unit)   throws InterruptedExceptionï¼ˆåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œçº¿ç¨‹ä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€è€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ ·çº¿ç¨‹å°±å¯ä»¥é‡Šæ”¾è‡ªå·±å·²ç»æŒæœ‰çš„èµ„æºï¼Œç ´åäº†æ­»é”ä¸­ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶ï¼‰ï¼›<br><br>    3ï¼‰æ”¯æŒéé˜»å¡è·å–é”çš„APIï¼›<br>           boolean tryLock()ï¼ˆå¦‚æœå°è¯•è·å–é”å¤±è´¥çº¿ç¨‹ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œè¿™æ ·çº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾è‡ªå·±æŒæœ‰çš„èµ„æºï¼Œç ´äº†æ­»é”ä¸­ä¸å¯æŠ¢å è¿™ä¸ªæ¡ä»¶ï¼‰ï¼›<br><br>äºŒ   ã€ReentrantLockï¼Œæ˜¯å¦‚ä½•ä¿è¯å¯è§æ€§çš„ï¼Ÿ<br> â‘   ReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ªè¢«volatileä¿®é¥°çš„æˆå‘˜å˜é‡ï¼›<br> â‘¡   åˆ©ç”¨äº† volatile ç›¸å…³çš„ Happens-Before è§„åˆ™ï¼Œèƒ½ä¿å­˜å¯è§æ€§ï¼›<br><br>ä¸‰ã€ç”¨é”çš„æœ€ä½³å®è·µï¼Ÿ<br>â‘   æ°¸è¿œåªåœ¨æ›´æ–°å¯¹è±¡æˆå‘˜å˜é‡çš„æ—¶å€™åŠ é”ï¼›<br>â‘¡  æ°¸è¿œåªåœ¨è®¿é—®å¯å˜æˆå‘˜å˜é‡æ—¶åŠ é”ï¼›<br>â‘¢  æ°¸è¿œä¸è¦åœ¨è°ƒç”¨å…¶ä»–å¯¹è±¡æ–¹æ³•æ—¶åŠ é”ï¼›<br><br><br>","like_count":1},{"had_liked":false,"id":319344,"user_name":"Geek_7a9e2c","can_delete":false,"product_type":"c1","uid":1265132,"ip_address":"","ucode":"00DC77B9C85EE3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er78PmxPDq4a3vNuvvX10fiaBC4FZ7XXuOX1nMjhCIqiaHWfpjfd5CDoVVB0GRGveChNmkSmuy7smxQ/132","comment_is_top":false,"comment_ctime":1635753904,"is_pvip":false,"replies":[{"id":"116131","content":"éå…¬å¹³é”ä¸ç®¡æœ‰æ²¡æœ‰ç­‰å¾…çš„ï¼Œå…ˆå»è·å–é”ï¼Œèƒ½è·å–å°±ç”¨ï¼Œç›¸å½“äºæ’é˜Ÿï¼›å…¬å¹³é”æ˜¯å…ˆå»æ’é˜Ÿã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1636264640,"ip_address":"","comment_id":319344,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930721200","product_id":100023901,"comment_content":"å…³äºéå…¬å¹³é”çš„è§£é‡Šä¸å…¶ä»–çš„èµ„æ–™æœ‰ç‚¹å‡ºå…¥ï¼Œå…¶ä»–èµ„æ–™è®²éå…¬å¹³é”çš„åœºæ™¯æ˜¯å½“é”é‡Šæ”¾åï¼Œå¦‚æœåˆšå¥½æœ‰ä¸ªçº¿ç¨‹åœ¨å°è¯•è·å–é”ï¼Œåˆ™ç›´æ¥ç»™è¿™ä¸ªçº¿ç¨‹ï¼Œè€Œä¸ç”¨åœ¨é˜Ÿåˆ—é‡Œå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºå”¤é†’ä¸€ä¸ªçº¿ç¨‹éœ€è¦çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œè€Œä½ ä¸¾ä¾‹çš„åœºæ™¯æ˜¯å”¤é†’çš„å¯èƒ½ä¸æ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å”¤é†’ï¼Œè€Œæ˜¯éšæœºä»é˜Ÿåˆ—é‡Œæ‹¿å‡ºæ¥ä¸€ä¸ªçº¿ç¨‹","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529600,"discussion_content":"éå…¬å¹³é”ä¸ç®¡æœ‰æ²¡æœ‰ç­‰å¾…çš„ï¼Œå…ˆå»è·å–é”ï¼Œèƒ½è·å–å°±ç”¨ï¼Œç›¸å½“äºæ’é˜Ÿï¼›å…¬å¹³é”æ˜¯å…ˆå»æ’é˜Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636264640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277489,"user_name":"Owen","can_delete":false,"product_type":"c1","uid":2403622,"ip_address":"","ucode":"FDE0D574B8ED5A","user_header":"https://static001.geekbang.org/account/avatar/00/24/ad/26/d46f4394.jpg","comment_is_top":false,"comment_ctime":1612429568,"is_pvip":false,"replies":[{"id":"100816","content":"Lockæ˜¯SDKåˆ©ç”¨volatileè§„åˆ™å®ç°çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1612599628,"ip_address":"","comment_id":277489,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5907396864","product_id":100023901,"comment_content":"â€œè§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”â€ï¼Œè¿™ä¸ªåŸåˆ™æ˜¯åªé’ˆå¯¹synchronizedï¼Œä¸Lockæ— å…³å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515068,"discussion_content":"Lockæ˜¯SDKåˆ©ç”¨volatileè§„åˆ™å®ç°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612599628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262286,"user_name":"å°¼å¤æ‹‰æ–¯","can_delete":false,"product_type":"c1","uid":2026074,"ip_address":"","ucode":"82EE35B505C09A","user_header":"","comment_is_top":false,"comment_ctime":1605684521,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5900651817","product_id":100023901,"comment_content":"while (true) æ²¡æœ‰ç»“æŸæ¡ä»¶ï¼Œè™½ç„¶ä¸æ˜¯é‡ç‚¹","like_count":1},{"had_liked":false,"id":237363,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1595809902,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5890777198","product_id":100023901,"comment_content":"è€å¸ˆï¼Œçœ‹åˆ°å¯è§æ€§é‚£é‡Œæˆ‘æœ‰ä¸ªç–‘æƒ‘ã€‚é”å¯ä»¥ä¿è¯å˜é‡æ“ä½œçš„åŸå­æ€§ã€‚è€Œå˜é‡çš„ä¸€æ¡å¢åŠ æ“ä½œï¼ŒæŒ‡çš„æ˜¯ï¼Œ1.å…ˆä»å†…å­˜è·å–å€¼åˆ°ç¼“å­˜ä¸­ã€‚2.ä¿®æ”¹å€¼ã€‚3.å°†ä¿®æ”¹åçš„å€¼ä»ç¼“å­˜å†™å…¥åˆ°å†…å­˜ä¸­ã€‚æ—¢ç„¶å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œæ€ä¹ˆè¿˜ä¼šæœ‰å¯è§æ€§é—®é¢˜å‘¢ã€‚ä¸æ˜¯å¾ˆç†è§£è¿™é‡Œã€‚","like_count":1,"discussions":[{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294765,"discussion_content":"æˆ‘ç»ˆäºæ‡‚äº†ã€‚åœ¨è®²åŸå­æ€§çš„æ—¶å€™è¯´çš„å†™å…¥å†…å­˜è¯´çš„æ˜¯å¯¹äºè¿™æ¡çº¿ç¨‹è€Œè¨€ï¼Œå†™å…¥è‡ªå·±çš„å·¥ä½œå†…å­˜ã€‚è¿™é‡Œå¹¶ä¸åŒ…æ¶µå†™å…¥ä¸»å†…å­˜ä¸­ã€‚è€Œvolatileå’Œhappen-before é€‰æ‹©æ˜¯ä¿è¯å°†å·¥ä½œå†…å­˜ä¸­çš„å˜é‡å€¼å†™å…¥åˆ°ä¸»å†…å­˜ä¸­çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595991611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191234,"user_name":"é›·åˆš","can_delete":false,"product_type":"c1","uid":1655725,"ip_address":"","ucode":"115FE2BE1AAB61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pTD8nS0SsORKiaRD3wB0NK9Bpd0wFnPWtYLPfBRBhvZ68iaJErMlM2NNSeEibwQfY7GReILSIYZXfT9o8iaicibcyw3g/132","comment_is_top":false,"comment_ctime":1584756971,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879724267","product_id":100023901,"comment_content":"çœ‹äº†ä¸€ä¸‹è¯„è®ºåŒºçš„ç•™è¨€ï¼Œå†ä»”ç»†çœ‹äº†ä¸€ä¸‹ä»£ç ï¼Œç¡®å®ä¸ä¼šäº§ç”Ÿæ­»é”ï¼Œå´å¯èƒ½ä¼šäº§ç”Ÿæ´»é”ã€‚ä¸è¿‡ç”Ÿäº§ä¸­ï¼Œæˆ‘å®æ„¿åŠ ä¸€æŠŠå¤§é”ä¹Ÿä¸ä¼šè¿™ä¹ˆå†™ä»£ç ï¼Œä¸ç„¶å¤ªéš¾è¯»äº†ï¼Œå¯èƒ½ä¸€äº›æ¡†æ¶çš„åº•å±‚ä¼šè¿™ä¹ˆå†™ã€‚","like_count":1},{"had_liked":false,"id":129854,"user_name":"Geek_8a997f","can_delete":false,"product_type":"c1","uid":1508407,"ip_address":"","ucode":"60B2CD8695F36B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0NwSicic81RbxQPraALLtK44KOSahvRlvic8B5yD0RX43xKaMDGMibJZnhBe0BY0IibWFpErzXPuyZNg/132","comment_is_top":false,"comment_ctime":1567306057,"is_pvip":true,"replies":[{"id":"48441","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1567311773,"ip_address":"","comment_id":129854,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862273353","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘æƒ‘è¯·æ•™ä¸€ä¸‹ï¼Œæ‚¨çš„æ–‡ç« ä¸­æåˆ°ï¼Œsynchronizedä¸èƒ½å“åº”ä¸­æ–­ï¼Œæ˜¯æŒ‡çº¿ç¨‹è¢«ä¸­æ–­ï¼Œéœ€è¦è‡ªå·±è¯»å–ä¸­æ–­æ ‡å¿—å¹¶è‡ªè¡Œå¤„ç†ç»ˆæ­¢ï¼Œè¿™ç§çš„ä¸ç®—å“åº”ä¸­æ–­ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465680,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567311773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119663,"user_name":"Fortune","can_delete":false,"product_type":"c1","uid":1508654,"ip_address":"","ucode":"6B9465AC996523","user_header":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","comment_is_top":false,"comment_ctime":1564648449,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5859615745","product_id":100023901,"comment_content":"å”‰ï¼Œåˆ°å®è·µéƒ¨åˆ†å°±æ‡µé€¼äº†ï¼Œå‰é¢ç†è®ºè¿˜æ²¡æ¶ˆåŒ–ï¼Œå®è·µéƒ¨åˆ†ç†è§£ä¸æ˜¯å¾ˆé€ï¼Œä¸é€‚åˆæ²¡æœ‰ç”¨è¿‡æˆ–è€…æ²¡æœ‰å¯¹å¹¶å‘åŒ…APIç†è§£çš„äººï¼Œæˆ‘å¤ªéš¾äº†ã€‚ã€‚ã€‚ã€‚","like_count":1},{"had_liked":false,"id":111010,"user_name":"å€šæ¢¦æµ","can_delete":false,"product_type":"c1","uid":1435045,"ip_address":"","ucode":"7CB442D629534B","user_header":"https://static001.geekbang.org/account/avatar/00/15/e5/a5/fae40ac3.jpg","comment_is_top":false,"comment_ctime":1562420484,"is_pvip":false,"replies":[{"id":"40426","content":"ğŸ‘åŠ ä¸ªéšæœºç­‰å¾…å°±æ›´å¥½äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1562494141,"ip_address":"","comment_id":111010,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5857387780","product_id":100023901,"comment_content":"ä¼šå‡ºç°æ´»é”å’Œæ­»å¾ªç¯ï¼Œè€å¸ˆä½ å¥½ï¼Œè¿™æ˜¯æˆ‘çš„ä¼˜åŒ–åçš„ä»£ç ï¼Œè¿ç”¨äº†ä¹‹å‰å­¦è¿‡çš„çŸ¥è¯†ï¼Œä¼˜å…ˆè·å–idå€¼æ¯”è¾ƒå°çš„èµ„æºï¼Œè¯·è€å¸ˆæŒ‡ç‚¹æ˜¯å¦æœ‰ä¸è¶³ä¹‹å¤„ï¼Œè°¢è°¢ï¼<br>    void transfer6(Account tar,int amt){<br>        boolean isOver=false;<br>        Account left=this;<br>        Account right=tar;<br>        if(left.id&gt;right.id){<br>            left=tar;<br>            right=this;<br>        }<br>        Thread th=Thread.currentThread();<br>        while (!th.isInterrupted() &amp;&amp; !isOver){<br>            if(left.lock.tryLock()){<br>                try{<br>                    if(right.lock.tryLock()){<br>                        try{<br>                            System.out.println(&quot;è´¦å·ï¼š&quot;+this.id+&quot;å¼€å§‹è½¬è´¦å•¦ï¼,è½¬å‡ºé‡‘é¢ï¼š&quot;+amt);<br>                            if(this.balance&gt;=amt){<br>                                this.balance-=amt;<br>                                tar.balance+=amt;<br>                                System.out.println(&quot;è½¬è´¦æˆåŠŸï¼&quot;);<br>                            }else{<br>                                System.out.println(&quot;è½¬è´¦å¤±è´¥ï¼Œä½™é¢ä¸è¶³ï¼&quot;);<br>                            }<br>                            isOver=true;<br>                            System.out.println(&quot;è½¬å…¥è´¦å·:&quot;+this.id+&quot; ä½™é¢ï¼š&quot;+this.balance);<br>                            System.out.println(&quot;è½¬å‡ºè´¦å·:&quot;+tar.id+&quot; ä½™é¢ï¼š&quot;+tar.balance);<br>                            System.out.println(&quot;è½¬è´¦ç»“æŸï¼&quot;);<br>                        }finally {<br>                            right.lock.unlock();<br>                        }<br>                    }<br>                }finally {<br>                    left.lock.unlock();<br>                }<br>            }<br>        }<br>    }","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457174,"discussion_content":"ğŸ‘åŠ ä¸ªéšæœºç­‰å¾…å°±æ›´å¥½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562494141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1196266,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ5ricEp2SDpA2d2iaw6TOVaPfmeicDicP34bamibX1JbHEkJl8wDQOK3ia4vic9WacKjFia9wibeG3nwOIiafA/132","nickname":"hunter","note":"","ucode":"EFBF6071BFCE10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546189,"discussion_content":"éƒ½åœ¨å¤–å±‚åŠ éšæœº è¿˜æ˜¯é’ˆå¯¹ä¸€æŠŠé”åŠ éšæœºï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642214013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004192,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/a0/d308434e.jpg","nickname":"StarKing","note":"","ucode":"EB825CFA70AC1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24023,"discussion_content":"1.é¡ºåºè§£å†³äº†é”æ–¹å‘ã€‚\n2.æœ€å¥½åŠ éšæœºé”æ—¶é—´è§£å†³ç¢°æ’é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569983537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1448974,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/0e/42b357cd.jpg","nickname":"Xiky","note":"","ucode":"C9E8D8C7024CA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2280,"discussion_content":"æ„Ÿè§‰æ˜¯ä¸æ˜¯ä¸éœ€è¦éšæœºç­‰å¾…äº†ï¼ŒåŠ é”çš„é¡ºåºå·²ç»è®©idçš„æ’åºä¿è¯äº†ï¼Ÿè¯·è€å¸ˆæŒ‡æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563436244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85143,"user_name":"å°¹åœ£","can_delete":false,"product_type":"c1","uid":1163547,"ip_address":"","ucode":"C276A01B4910F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/c1/1b/e08d42f8.jpg","comment_is_top":false,"comment_ctime":1554988465,"is_pvip":false,"replies":[{"id":"30522","content":"ä¸çŸ¥é“ä½ è¯´çš„ä¸å®‰å…¨æ˜¯æŒ‡å“ªé‡Œï¼Œstate ä½ åªæ˜¯å†™äº†ï¼Œæ²¡æœ‰è¯»ï¼Œè€Œä¸”account++ä¹Ÿä¸æ˜¯äº’æ–¥çš„æ“ä½œã€‚<br>javaå¹¶å‘åŒ…é‡Œç”¨volatileä¿è¯å¯è§æ€§ï¼Œè¿˜ç”¨aqså®ç°äº†äº’æ–¥ã€‚ä¿è¯çº¿ç¨‹å®‰å…¨ä¸æ˜¯è¿™ä¹ˆç®€å•çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554989771,"ip_address":"","comment_id":85143,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849955761","product_id":100023901,"comment_content":"public class Main {<br><br>    static volatile int state = 0;<br><br>    public static long account = 0;<br><br>    public static void main(String[] args) throws InterruptedException {<br><br>        for (int i = 0; i &lt; 100000; i++) {<br>            new Thread(() -&gt; {<br>                new Main().addAccount();<br>            }).start();<br>        }<br><br>        Thread.sleep(6000);<br>        System.out.println(account);<br>    }<br><br>    private void addAccount() {<br>        &#47;&#47;  çº¿ç¨‹ä¸å®‰å…¨<br>        state = 1;   &#47;&#47;----1<br>        account++;   &#47;&#47;----2<br>        state = 0;   &#47;&#47;----3<br>    }<br>}<br><br>è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœæŒ‰ç…§volatileçš„Happens-Beforeè¿™é‡Œçš„ç¨‹åºä¹Ÿåº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å®é™…ä¸Šä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé—®é¢˜å‡ºåœ¨å“ªå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446572,"discussion_content":"ä¸çŸ¥é“ä½ è¯´çš„ä¸å®‰å…¨æ˜¯æŒ‡å“ªé‡Œï¼Œstate ä½ åªæ˜¯å†™äº†ï¼Œæ²¡æœ‰è¯»ï¼Œè€Œä¸”account++ä¹Ÿä¸æ˜¯äº’æ–¥çš„æ“ä½œã€‚\njavaå¹¶å‘åŒ…é‡Œç”¨volatileä¿è¯å¯è§æ€§ï¼Œè¿˜ç”¨aqså®ç°äº†äº’æ–¥ã€‚ä¿è¯çº¿ç¨‹å®‰å…¨ä¸æ˜¯è¿™ä¹ˆç®€å•çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554989771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81886,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1554078917,"is_pvip":false,"replies":[{"id":"29664","content":"ç”¨å¯é‡å…¥é”å¯ä»¥å®ç°ï¼Œè¿˜æœ‰äº›æ— é”çš„ç®—æ³•ä¹Ÿå¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554079435,"ip_address":"","comment_id":81886,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849046213","product_id":100023901,"comment_content":"å¯é‡å…¥å‡½æ•°çš„çº¿ç¨‹å®‰å…¨æ˜¯ä¸æ˜¯ç”±å‡½æ•°å†…éƒ¨çš„å¯é‡å…¥é”ä¿è¯çš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445380,"discussion_content":"ç”¨å¯é‡å…¥é”å¯ä»¥å®ç°ï¼Œè¿˜æœ‰äº›æ— é”çš„ç®—æ³•ä¹Ÿå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554079435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81622,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1553966702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5848933998","product_id":100023901,"comment_content":"ä¸ä¼šæ­»é”å› ä¸ºï¼Œæ‰“ç ´äº†ä¸é‡Šæ”¾çš„åŸåˆ™ã€‚","like_count":1},{"had_liked":false,"id":345811,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1652607712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652607712","product_id":100023901,"comment_content":"éå…¬å¹³é”ä¸æ˜¯æŒ‰ç…§è°ç­‰å¾…çš„æ—¶é—´é•¿å»å”¤é†’çš„å§ã€‚æ˜¯æŒ‰ç…§é¡ºåºå”¤é†’çš„ã€‚","like_count":0},{"had_liked":false,"id":345810,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1652607663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652607663","product_id":100023901,"comment_content":"ä¸ä¼šå¼•èµ·æ­»é”ï¼Œä½†ä¼šä¸€ç›´æ­»å¾ªç¯ï¼Œä¹Ÿå°±æ˜¯ä¼šäº§ç”Ÿæ´»é”ã€‚<br>2æ¬¡é”ï¼Œ2ä¸ªlockå¯¹è±¡éƒ½ä¸ä¸€æ ·ï¼Œéƒ½ä¼šlock unlockï¼Œå¤–é¢ä¸€ç›´æ­»å¾ªç¯ï¼Œä¸€ç›´å¦‚æ­¤ï¼Œä¸åœçš„åŠ é”ï¼Œé‡Šæ”¾é”ã€‚","like_count":0},{"had_liked":false,"id":339169,"user_name":"ğŸ“Dream-seeker","can_delete":false,"product_type":"c1","uid":2100403,"ip_address":"","ucode":"3C8477DE9DD766","user_header":"https://static001.geekbang.org/account/avatar/00/20/0c/b3/7e13920b.jpg","comment_is_top":false,"comment_ctime":1647954182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647954182","product_id":100023901,"comment_content":"é‡ç‚¹æ˜¯è¿™ä¸ªifæ¡ä»¶ï¼Œä¸¤æ¡çº¿ç¨‹éƒ½çŸ¥é“å¯¹æ–¹çš„é”è¢«å ç”¨äº†ï¼Œå°±å»é‡Šæ”¾é”ï¼Œç»“æœæ˜¯è°ä¹Ÿæ‹¿ä¸åˆ°é”ä¸€ç›´å¾ªç¯å¾€å¤ è¿™å±äºæ´»é”","like_count":0},{"had_liked":false,"id":330838,"user_name":"hunter","can_delete":false,"product_type":"c1","uid":1196266,"ip_address":"","ucode":"EFBF6071BFCE10","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ5ricEp2SDpA2d2iaw6TOVaPfmeicDicP34bamibX1JbHEkJl8wDQOK3ia4vic9WacKjFia9wibeG3nwOIiafA/132","comment_is_top":false,"comment_ctime":1642213329,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642213329","product_id":100023901,"comment_content":"å…¥å£ç­‰å¾…é˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—æ˜¯ä»€ä¹ˆå…³ç³»","like_count":0},{"had_liked":false,"id":328776,"user_name":"hello","can_delete":false,"product_type":"c1","uid":1649057,"ip_address":"","ucode":"4F42DAA5DB5C38","user_header":"https://static001.geekbang.org/account/avatar/00/19/29/a1/41607383.jpg","comment_is_top":false,"comment_ctime":1640876263,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1640876263","product_id":100023901,"comment_content":"æˆ‘åœ¨æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œsynchronized å’ŒLock æ˜¯ä¸æ˜¯éƒ½ä¸èƒ½ç ´åâ€œå æœ‰ä¸”ç­‰å¾…â€ å’Œâ€œå¾ªç¯ç­‰å¾…â€ï¼Œå®ƒä»¬åªèƒ½ç”¨ä¸€æ¬¡æ€§ç”³è¯·èµ„æºå’Œæ’åºæ¥è§£å†³æ­»é”çš„é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":315191,"user_name":"å®˜å®å„¿","can_delete":false,"product_type":"c1","uid":2110827,"ip_address":"","ucode":"03B4312475A984","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5eicXFWltiaF9ibsEh2nNC80OYoHibhhE0X1hPHZ5KuAtY4Yxp5dQ4LsciaDxUHFBPlJM7kgQwkspzsQ/132","comment_is_top":false,"comment_ctime":1633746501,"is_pvip":false,"replies":[{"id":"114499","content":"æ„Ÿè§‰è¿™ä¸ªæ˜¯æ­»å¾ªç¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1634123202,"ip_address":"","comment_id":315191,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633746501","product_id":100023901,"comment_content":"ä¿©ä¸ªé”è¢«ä¿©ä¸ªçº¿ç¨‹æ— é™çš„å„æ‰§ä¸€æŠŠå¯¼è‡´ä¿©ä¸ªçº¿ç¨‹æ°¸è¿œæ‹¿ä¸åˆ°ä¿©æŠŠé”ï¼Œè¿™ç§æƒ…å†µç®—æ­»é”å—","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527897,"discussion_content":"æ„Ÿè§‰è¿™ä¸ªæ˜¯æ­»å¾ªç¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634123202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308027,"user_name":"Geek_059c01","can_delete":false,"product_type":"c1","uid":2617415,"ip_address":"","ucode":"DE2D22FD0270BA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJvgMafguPrOkiagvnPDkNzakYkoauIKI43bBlmenhrjLOiaNF4ic0gHUHv5AYz2qGX4MxEGt8HPJHuw/132","comment_is_top":false,"comment_ctime":1629361961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629361961","product_id":100023901,"comment_content":"ä¼šå‡ºç°æ­»é”ï¼Œè€å¸ˆå¯ä¸å¯ä»¥è´´å‡ºæ ‡å‡†çš„ä¸å‡ºç°æ­»é”çš„ä½¿ç”¨Lockæ–¹æ¡ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":292860,"user_name":"gsz","can_delete":false,"product_type":"c1","uid":1147531,"ip_address":"","ucode":"8FD1B41E884B18","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/8b/5340fb27.jpg","comment_is_top":false,"comment_ctime":1621041331,"is_pvip":false,"replies":[{"id":"106777","content":"éå…¬å¹³é”æ€§èƒ½å¥½ï¼Œä½†æ˜¯ä¸ªåˆ«çº¿ç¨‹ç­‰å¾…æ—¶é—´æœ‰å¯èƒ½ä¼šå¾ˆé•¿ã€‚å¦‚æœå¯¹å®æ—¶æ€§æœ‰è¦æ±‚ï¼Œå°±éœ€è¦ç”¨å…¬å¹³é”ï¼Œå…¬å¹³é”+é™æµåŸºæœ¬ä¸Šå°±èƒ½ä¿è¯å¤„ç†çš„ç¨³å®šæ€§","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1621900876,"ip_address":"","comment_id":292860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1621041331","product_id":100023901,"comment_content":"è€å¸ˆ ä»€ä¹ˆæƒ…å†µä¸‹æ¯”è¾ƒé€‚åˆç”¨å…¬å¹³é”ï¼Œä»€ä¹ˆæƒ…å†µä¸‹æ¯”è¾ƒé€‚åˆç”¨éå…¬å¹³é”","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519987,"discussion_content":"éå…¬å¹³é”æ€§èƒ½å¥½ï¼Œä½†æ˜¯ä¸ªåˆ«çº¿ç¨‹ç­‰å¾…æ—¶é—´æœ‰å¯èƒ½ä¼šå¾ˆé•¿ã€‚å¦‚æœå¯¹å®æ—¶æ€§æœ‰è¦æ±‚ï¼Œå°±éœ€è¦ç”¨å…¬å¹³é”ï¼Œå…¬å¹³é”+é™æµåŸºæœ¬ä¸Šå°±èƒ½ä¿è¯å¤„ç†çš„ç¨³å®šæ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621900876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289823,"user_name":"ä¸€è·¯å‘åŒ—","can_delete":false,"product_type":"c1","uid":1370932,"ip_address":"","ucode":"B688B1C748D019","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/34/9756d116.jpg","comment_is_top":false,"comment_ctime":1619190159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619190159","product_id":100023901,"comment_content":"ä»£ç æ‰§è¡Œå†…å®¹ï¼šå¯åŠ¨çº¿ç¨‹Aï¼šå®Œæˆaç»™cè½¬è´¦ï¼Œå¯åŠ¨çº¿ç¨‹Bå®Œæˆbç»™cè½¬è´¦ï¼Œçº¿ç¨‹AæŒæœ‰lockA,çº¿ç¨‹BæŒæœ‰lockB,ABçº¿ç¨‹æŠ¢å¤ºlockC,è°æŠ¢åˆ°è°æ‰§è¡Œï¼Œæ­»å¾ªç¯è¿è¡Œï¼Œä¸ä¼šç»ˆæ­¢<br><br><br>","like_count":0},{"had_liked":false,"id":288135,"user_name":"å¼ æ»”","can_delete":false,"product_type":"c1","uid":1322636,"ip_address":"","ucode":"87ABAFF0E861E0","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/8c/b261e15a.jpg","comment_is_top":false,"comment_ctime":1618315863,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618315863","product_id":100023901,"comment_content":"volatile å˜é‡è§„åˆ™ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚è¿™æ¡è§„åˆ™æ²¡æ˜ç™½ï¼Œä¸æ˜¯è¯´å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œï¼Œ Happens-Before äºåç»­å¯¹è¿™ä¸ª volatile å˜é‡çš„è¯»æ“ä½œå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":285164,"user_name":"Laughing","can_delete":false,"product_type":"c1","uid":1002134,"ip_address":"","ucode":"F68F1E000CA800","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/96/99466a06.jpg","comment_is_top":false,"comment_ctime":1616651943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616651943","product_id":100023901,"comment_content":"å¦‚æœAã€Bä¸¤ä¸ªè´¦æˆ·äº’ç›¸è½¬è´¦çš„æƒ…å†µä¸‹ï¼ŒAã€Bä¸¤ä¸ªè´¦æˆ·éƒ½åœ¨å°è¯•æ‹¿åˆ°å¯¹æ–¹è´¦æˆ·çš„é”ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨æœ¬èŠ‚ä¸­æåˆ°çš„ä¸‰ä¸ªæ–¹æ¡ˆè®¾è®¡ä¸€æŠŠäº’æ–¥é”ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":284653,"user_name":"å¨å…ˆæ£®","can_delete":false,"product_type":"c1","uid":1687656,"ip_address":"","ucode":"5F445C6832274B","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","comment_is_top":false,"comment_ctime":1616403604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616403604","product_id":100023901,"comment_content":"1. é¡ºåºæ€§è§„åˆ™ï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock()ï¼›<br>2. volatile å˜é‡è§„åˆ™ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼›<br>3. ä¼ é€’æ€§è§„åˆ™ï¼šçº¿ç¨‹ T1 çš„ value+=1 Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚<br>è¿™ä¸ªç¬¬äºŒæ¡å†™çš„ç¨å¾®éš¾ç†è§£äº†ä¸€ç‚¹ï¼Œæœ‰ç‚¹åƒç®¡ç¨‹ä¸­é”çš„è§„åˆ™+volatile å˜é‡è§„åˆ™çš„ç»“åˆäº†","like_count":0},{"had_liked":false,"id":283838,"user_name":"é»‘å±±è€å¦–","can_delete":false,"product_type":"c1","uid":1115958,"ip_address":"","ucode":"A1659F99C5BE1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/07/36/d677e741.jpg","comment_is_top":false,"comment_ctime":1615951598,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615951598","product_id":100023901,"comment_content":"ç»“æœå’Œæ´»é”ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ï¼Œæ´»é”æ²¡æœ‰å µå¡ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œæœ‰æ•ˆä»£ç ã€‚<br>","like_count":0},{"had_liked":false,"id":283444,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1615784977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615784977","product_id":100023901,"comment_content":"ä¸¤ä¸ªè´¦æˆ·äº’ç›¸ä¸ºå¯¹æ–¹è½¬è´¦çš„æ—¶å€™ä¼šæ´»é”ï¼","like_count":0},{"had_liked":false,"id":281577,"user_name":"å»–æ¢“æ¥·","can_delete":false,"product_type":"c1","uid":1433574,"ip_address":"","ucode":"5EB427453F8D22","user_header":"https://static001.geekbang.org/account/avatar/00/15/df/e6/d7638e29.jpg","comment_is_top":false,"comment_ctime":1614817025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614817025","product_id":100023901,"comment_content":"å¦‚æœè´¦æˆ·Aè½¬è´¦ç»™è´¦æˆ·B,è´¦æˆ·BåŒæ—¶è½¬è´¦ç»™è´¦æˆ·A,åˆ™å¯èƒ½å­˜åœ¨æ´»é”ã€‚è§£å†³æ–¹æ¡ˆï¼štryLockåŠ ä¸ªéšæœºç­‰å¾…æ—¶é—´ï¼Œåˆ™èƒ½ä»æ¦‚ç‡ä¸Šé™ä½è¿™ç§æƒ…å†µçš„å‘ç”Ÿ","like_count":0},{"had_liked":false,"id":266249,"user_name":"Geek_e56b38","can_delete":false,"product_type":"c1","uid":2229257,"ip_address":"","ucode":"40625CF22A974C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erRCf8vWbWibaiaKibNyTC3BMLWDIPK7xUlEy2oVBykrcSIjS5PP4xTDDZRYBicMfK44ia7uWV5cxugVHg/132","comment_is_top":false,"comment_ctime":1607255577,"is_pvip":false,"replies":[{"id":"96738","content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1607297976,"ip_address":"","comment_id":266249,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607255577","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—ç‰¹æ€§é‡Œåº”è¯¥è¿˜å¯ä»¥åŠ ä¸€æ¡ï¼ŒLockå¯ä»¥å¾ˆå¥½çš„æ”¯æŒç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶é˜»å¡é˜Ÿåˆ—ï¼Œä½†æ˜¯synchronizedå°±å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511189,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607297976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262567,"user_name":"èŒ¶æ²¡å–å®Œ","can_delete":false,"product_type":"c1","uid":1644104,"ip_address":"","ucode":"D72D88C42A1258","user_header":"https://static001.geekbang.org/account/avatar/00/19/16/48/09493874.jpg","comment_is_top":false,"comment_ctime":1605770621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605770621","product_id":100023901,"comment_content":"ä¸ä¼šæ­»é”ï¼Œè·å–ä¸åˆ°ç¬¬äºŒæŠŠé”ï¼Œä¼šä¸»åŠ¨é‡Šæ”¾ç¬¬ä¸€æŠŠå·²ç»è·å–åˆ°åˆ°é”ï¼Œå¯èƒ½ä¼šå‡ºç°æ´»è·ƒã€‚","like_count":0},{"had_liked":false,"id":255466,"user_name":"halo","can_delete":false,"product_type":"c1","uid":1138057,"ip_address":"","ucode":"782892605CC855","user_header":"https://static001.geekbang.org/account/avatar/00/11/5d/89/93b837d6.jpg","comment_is_top":false,"comment_ctime":1603352004,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603352004","product_id":100023901,"comment_content":"æˆ‘åœ¨ä¹¦ä¸Šçœ‹è¿‡å¯¹  åŒæ­¥äº’æ–¥  çš„æè¿°ï¼ŒåŒæ­¥æ˜¯ç›®çš„ï¼Œäº’æ–¥æ˜¯æ‰‹æ®µã€‚åŒæ­¥æ˜¯ åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºã€‚   è·Ÿæœ¬èŠ‚è¯¾ä¸­è§£é‡Šçš„æœ‰å·®å¼‚ï¼Œå„ä½çœ‹å®˜è§‰å¾—é‚£ç§è¯´æ³•å¯¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364371,"discussion_content":"ä½ è¿™ç†è§£æœ‰ç‚¹ç‹­éš˜ï¼ŒåŒæ­¥æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„ååŒï¼šä»»ä½•äº’æ–¥æ‰‹æ®µ å¦‚synchronized ã€lockç­‰éƒ½æ˜¯ä¸ºäº†ç›¸äº’ååŒï¼Œè€Œä¸æ˜¯ä¸ºäº†äº’æ–¥è€Œäº’æ–¥ã€‚ä½ æŠŠåŒæ­¥æ¢æˆååŒï¼Œå°±å¥½ç†è§£äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617459214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255413,"user_name":"æå­Ÿ","can_delete":false,"product_type":"c1","uid":1006768,"ip_address":"","ucode":"AD2349CB12F130","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/b0/77e5f8c8.jpg","comment_is_top":false,"comment_ctime":1603338355,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1603338355","product_id":100023901,"comment_content":"@Data<br>public class Account {<br>   private int balance;<br>   private final Lock lock = new ReentrantLock();<br><br>    public Account(int balance) {<br>        this.balance = balance;<br>    }<br><br>    public void transfer(Account tar, int amt) throws InterruptedException {<br>        boolean flag = true;<br>        Random random = new Random();<br>        while (flag){<br>           if(this.lock.tryLock(random.nextInt(1000)+1, TimeUnit.MILLISECONDS)) {<br>               try {<br>               if (tar.lock.tryLock())<br>               {<br>                   try {<br>                       this.balance -= amt;<br>                       tar.balance += amt;<br>                       flag = false;<br>                   }<br>                   finally {<br>                       tar.lock.unlock();<br>                   }<br>               }&#47;&#47;if<br>               } finally {<br>                   this.lock.unlock();<br>               }<br>           }<br>       }<br>   }<br><br>    public static void main(String[] args) throws InterruptedException {<br><br>        for (int i = 0; i &lt; 10000; i++) {<br>            Account a = new Account(200);<br>            Account b = new Account(200);<br>            Account c = new Account(200);<br><br>            Thread t1 = new Thread(()-&gt;{<br>                try {<br>                    a.transfer(b,100);<br>                } catch (InterruptedException e) {<br>                    e.printStackTrace();<br>                }<br>            });<br><br><br><br>            Thread t2 = new Thread(()-&gt;{<br>                try {<br>                    b.transfer(c,100);<br>                } catch (InterruptedException e) {<br>                    e.printStackTrace();<br>                }<br>            });<br>            t1.start();<br>            t2.start();<br><br><br>            t2.join();<br><br>            System.out.println(a.getBalance());<br>            System.out.println(b.getBalance());<br>            System.out.println(c.getBalance());<br>            System.out.println(&quot;---------------&quot;);<br><br>        }<br><br>    }<br><br>}<br>","like_count":0},{"had_liked":false,"id":253092,"user_name":"xanxus","can_delete":false,"product_type":"c1","uid":1654600,"ip_address":"","ucode":"FFF1EFD2ABCBAA","user_header":"","comment_is_top":false,"comment_ctime":1602594802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602594802","product_id":100023901,"comment_content":"ç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼›  happen-before ä¸­çš„lockå’Œunlock æ˜¯é’ˆå¯¹synchronizeçš„é”å§ï¼Œè·ŸJUCä¸­çš„æ²¡æœ‰å…³ç³»å§","like_count":0},{"had_liked":false,"id":245575,"user_name":"ç½—æ¨±ç½‚","can_delete":false,"product_type":"c1","uid":2045997,"ip_address":"","ucode":"9072E79E625ED1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/38/2d/f3c6493e.jpg","comment_is_top":false,"comment_ctime":1598986590,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598986590","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹aqsçš„å„ç§é˜Ÿåˆ—çŸ¥è¯†ç‚¹åœ¨å“ªä¸€ç« æœ‰ä»‹ç»ï¼Ÿï¼ˆå¯¹ä¸èµ·è·³ç€çœ‹çš„ã€‚ã€‚æ„Ÿè§‰æ‰¾äº†è®¸ä¹…ã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":243987,"user_name":"fightingD","can_delete":false,"product_type":"c1","uid":1443637,"ip_address":"","ucode":"AD2876CED5D5AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwViav94kcF50CxA0Jw7icicxociaVzut97iacy3b2ciacFqXuFWdiakVq304YcI8pt4HT5A1Yvp8EkYCpw/132","comment_is_top":false,"comment_ctime":1598345949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598345949","product_id":100023901,"comment_content":"ä¸ä¼šæ­»é”ï¼Œè·å–ä¸åˆ°é”çš„æ—¶å€™è¿”å›false,ä¼šé‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”ã€‚","like_count":0},{"had_liked":false,"id":243981,"user_name":"fightingD","can_delete":false,"product_type":"c1","uid":1443637,"ip_address":"","ucode":"AD2876CED5D5AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwViav94kcF50CxA0Jw7icicxociaVzut97iacy3b2ciacFqXuFWdiakVq304YcI8pt4HT5A1Yvp8EkYCpw/132","comment_is_top":false,"comment_ctime":1598344822,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598344822","product_id":100023901,"comment_content":"æ²¡æœ‰æ­»é”çš„é—®é¢˜äº†ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰æ´»é”çš„é—®é¢˜ï¼Œæœ€å¥½ä½¿ç”¨tryLock(long time, TimeUnit unit) æ–¹æ³•ï¼Œå¹¶ç»™time è®¾ç½®ä¸€ä¸ªéšæœºæ•°ã€‚","like_count":0},{"had_liked":false,"id":238125,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1596074749,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596074749","product_id":100023901,"comment_content":"æ„Ÿè§‰è¿™ä¸ªå¯é‡å…¥é”æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰å•Š","like_count":0},{"had_liked":false,"id":237822,"user_name":"æƒ˜ é—»","can_delete":false,"product_type":"c1","uid":1181650,"ip_address":"","ucode":"C5909F034BF072","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","comment_is_top":false,"comment_ctime":1595983337,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1595983337","product_id":100023901,"comment_content":"å¦‚æœåˆ›å»ºçš„æ˜¯å…¬å¹³é”ï¼Œè¿™ä¸ªé”åˆ›å»ºçš„conditionçš„æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—æ˜¯å…¬å¹³çš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364372,"discussion_content":"æ¡ä»¶é˜Ÿåˆ—ä¸åŒæ­¥é˜Ÿåˆ—ä½ åˆ†å¾—æ¸…ä¸ï¼Ÿå…¬ä¸å…¬å¹³æ˜¯é’ˆå¯¹åŒæ­¥é˜Ÿåˆ—æ¥è¯´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617459316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364747,"discussion_content":"èƒ½è¯¦ç»†è®²ä¸€ä¸‹å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617591496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364372,"ip_address":""},"score":364747,"extra":""},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364795,"discussion_content":"æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—éƒ½æ˜¯å…¬å¹³çš„å‘€ï¼Œè¢«é˜»å¡çš„éƒ½æ”¾åˆ°æ¡ä»¶é˜Ÿåˆ—åé¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617609108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364747,"ip_address":""},"score":364795,"extra":""},{"author":{"id":1181650,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg","nickname":"æƒ˜ é—»","note":"","ucode":"C5909F034BF072","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365189,"discussion_content":"çŸ¥é“äº†ï¼Œå¤šè°¢ã€‚Lockçš„æœ¬è´¨æ˜¯AQSï¼ŒAQSè‡ªå·±ç»´æŠ¤çš„é˜Ÿåˆ—æ˜¯å½“å‰ç­‰å¾…èµ„æºçš„é˜Ÿåˆ—ï¼ŒAQSä¼šåœ¨èµ„æºè¢«é‡Šæ”¾åï¼Œä¾æ¬¡å”¤é†’é˜Ÿåˆ—ä¸­ä»å‰åˆ°åçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½¿ä»–ä»¬å¯¹åº”çš„çº¿ç¨‹æ¢å¤æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚è€ŒConditionè‡ªå·±ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—çš„ä½œç”¨æ˜¯ç»´æŠ¤ä¸€ä¸ªç­‰å¾…signalä¿¡å·çš„é˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ªé˜Ÿåˆ—çš„ä½œç”¨ä¸åŒçš„ï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸ªçº¿ç¨‹ä¹Ÿä»…ä»…ä¼šåŒæ—¶å­˜åœ¨ä»¥ä¸Šä¸¤ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617722253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364795,"ip_address":""},"score":365189,"extra":""}]}]},{"had_liked":false,"id":235865,"user_name":"non","can_delete":false,"product_type":"c1","uid":1306912,"ip_address":"","ucode":"F765CC7DDDC7F4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlII9AEfK3Zh3k3wlh6HTemyxZ4Z5DicxYITk8YgYEGM8K1xOt2Puic9xoGCQev7JOZ7bA/132","comment_is_top":false,"comment_ctime":1595229425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595229425","product_id":100023901,"comment_content":"å› ä¸ºé¢˜ä¸­çš„trylockä¸ä¼šå æœ‰é”åç­‰å¾…ï¼Œç ´åäº†å æœ‰ç­‰å¾…çš„æ¡ä»¶å› æ­¤ä¸ä¼šå‡ºç°æ­»é”ï¼Œä½†å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªè´¦æˆ·åŒæ—¶è·å–åˆ°è‡ªå·±çš„lockä¹‹åè·å–ä¸åˆ°å¯¹æ–¹è´¦æˆ·çš„lockè€Œäº§ç”Ÿæ´»é”","like_count":0},{"had_liked":false,"id":235347,"user_name":"ç¬¬ä¸€è£…ç”²é›†ç¾¤å¸ä»¤å…‹è±æ–¯ç‰¹","can_delete":false,"product_type":"c1","uid":1265707,"ip_address":"","ucode":"4E8FBB23AD860B","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","comment_is_top":false,"comment_ctime":1594979120,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594979120","product_id":100023901,"comment_content":"å¯é‡å…¥é”ï¼Œåˆå«é€’å½’é”ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯çº¿ç¨‹è·å–é”ï¼Œæ‰§è¡Œå¤–å±‚å‡½æ•°ï¼Œå¤–å±‚å‡½æ•°å†…è°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œè¿™æ—¶å€™ï¼Œçº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥å†…å±‚å‡½æ•°ï¼Œä¸é˜»å¡ï¼Œé€’å½’é‡å…¥ã€‚","like_count":0},{"had_liked":false,"id":224516,"user_name":"Just","can_delete":false,"product_type":"c1","uid":2022626,"ip_address":"","ucode":"35FA6917DE1D04","user_header":"https://static001.geekbang.org/account/avatar/00/1e/dc/e2/a3abd320.jpg","comment_is_top":false,"comment_ctime":1591427011,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591427011","product_id":100023901,"comment_content":"æŒæœ‰çš„é”ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€ä»¥ä¸å­˜åœ¨æ­»é”ï¼Œä½†æ˜¯å¦‚æœåŒæ—¶è·å–é”ï¼ŒåŒæ—¶é‡Šæ”¾é”å°±å­˜åœ¨æ´»é”ï¼Œå¯ä»¥åŠ ä¸ªéšæœºæ—¶é—´æ¥é¿å…","like_count":0},{"had_liked":false,"id":222010,"user_name":"å‘å“¥","can_delete":false,"product_type":"c1","uid":1281495,"ip_address":"","ucode":"E2BA6621422D08","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/d7/eeceb2d5.jpg","comment_is_top":false,"comment_ctime":1590655475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590655475","product_id":100023901,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœé˜»å¡åœ¨tar.lock.tryLockä¸Šä¸€æ®µæ—¶é—´ï¼Œåº”è¯¥æ˜¯ä¸èƒ½é‡Šæ”¾tar.lockå§ï¼Ÿ","like_count":0},{"had_liked":false,"id":217367,"user_name":"UniqueDirt","can_delete":false,"product_type":"c1","uid":2001375,"ip_address":"","ucode":"1E5555EE495733","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkDobVTaXD0oWouJBHQQSvnicJnzfZ7cSKmZeV20svZ7uWKGkibnL8xXiaOPRPYP7IibVIWPaCBDhjMw/132","comment_is_top":false,"comment_ctime":1589470569,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589470569","product_id":100023901,"comment_content":"ä¼šå­˜åœ¨æ´»é”  ä½†T1è¿›å…¥finallyé‡Šæ”¾é”çš„åŒæ—¶T2æœ‰å¯èƒ½åˆšå¥½è·å–åˆ°T1é‡Šæ”¾çš„é”  æ‰€ä»¥è½¬è´¦æ“ä½œæœ‰å‡ ç‡æˆåŠŸçš„","like_count":0},{"had_liked":false,"id":216877,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1589360470,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589360470","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå…³äºå¯é‡å…¥é”æœ‰ä¸ªç–‘é—®ï¼Œæ—¢ç„¶synchronizedä¹Ÿæ˜¯å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”çš„ï¼Œæ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜ä¹ˆï¼Ÿè¯·è€å¸ˆæŒ‡æ•™<br><br>public class ReentrantLockDemo {<br><br><br>    private static int v = 0;<br><br>    @Test<br>    public void test() {<br>        addOne();<br>        try {<br>            Thread.sleep(1000);<br>        } catch (InterruptedException e) {<br>            e.printStackTrace();<br>        }<br>        System.out.println(&quot;vçš„å€¼ä¸ºï¼š&quot; + this.v);<br>    }<br><br>    private synchronized void addOne() {<br>        this.v = get() + 1;<br>    }<br><br>    private synchronized int get() {<br>        return v;<br>    }<br><br><br>}<br><br>æ‰§è¡Œç»“æœä¹Ÿæ˜¯1ï¼Œæˆ‘ç”¨å¤šä¸ªçº¿ç¨‹è°ƒaddOne()æ–¹æ³•ä¹Ÿæ²¡æœ‰é˜»å¡ï¼Œç»“æœä¹Ÿæ˜¯æ­£ç¡®çš„","like_count":0},{"had_liked":false,"id":212560,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1588149056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588149056","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå¯¹æ€è€ƒé¢˜æœ‰ä¸ªç–‘é—®ï¼Œè¿™æ˜¯ä¸ªè½¬è´¦ä¸šåŠ¡ï¼Œç”¨syè§£å†³å¹¶å‘æ—¶å°±æ²¡æœ‰ç”¨while (true)  ï¼Œä¸ºä»€ä¹ˆç”¨lockè§£å†³å¹¶å‘æ—¶è¦ç”¨while (true) å‘¢ï¼Ÿè¿™ä¸ªä¾‹å­å¯ä»¥æŠŠwhile (true) å»æ‰ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":210794,"user_name":"è§å—å±±","can_delete":false,"product_type":"c1","uid":1118111,"ip_address":"","ucode":"6A8BB82B7573CA","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","comment_is_top":false,"comment_ctime":1587826016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587826016","product_id":100023901,"comment_content":"çº¿ç¨‹abåŒæ—¶æ‰§è¡Œï¼ŒåŒæ—¶è·å–å¯¹æ–¹çš„é”ï¼ŒåˆåŒæ—¶è·å–ä¸åˆ°ï¼ŒåˆåŒæ—¶é‡Šæ”¾ï¼Œå¦‚æ­¤å¾€è¿”ï¼Œå½¢æˆæ­»é”","like_count":0},{"had_liked":false,"id":208320,"user_name":"åˆ˜è€³æ€»","can_delete":false,"product_type":"c1","uid":1271724,"ip_address":"","ucode":"6D157E6E960075","user_header":"https://static001.geekbang.org/account/avatar/00/13/67/ac/af895343.jpg","comment_is_top":false,"comment_ctime":1587339808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587339808","product_id":100023901,"comment_content":"å¯é‡å…¥é”æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼Œæ¯”å¦‚ï¼š<br>ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä¸€ä¸ªå¸¦é”çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆè°ƒç”¨äº†å¦ä¸€ä¸ªéœ€è¦ç›¸åŒé”çš„æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥æ‰§è¡Œè°ƒç”¨çš„æ–¹æ³•ï¼Œè€Œæ— éœ€é‡æ–°è·å¾—é”ï¼›<br><br>å¯é‡å…¥é”æ˜¯é’ˆå¯¹åŒä¸€çº¿ç¨‹å•Šï¼Œå·®ç‚¹æ‡µé€¼äº†","like_count":0},{"had_liked":false,"id":192523,"user_name":"é›·åˆš","can_delete":false,"product_type":"c1","uid":1655725,"ip_address":"","ucode":"115FE2BE1AAB61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pTD8nS0SsORKiaRD3wB0NK9Bpd0wFnPWtYLPfBRBhvZ68iaJErMlM2NNSeEibwQfY7GReILSIYZXfT9o8iaicibcyw3g/132","comment_is_top":false,"comment_ctime":1584857100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584857100","product_id":100023901,"comment_content":"å…³äº synchronized é”å‡çº§ï¼Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹ç–‘é—®ã€‚synchronized å¯ä»¥ä»æ— é” -&gt; åå‘é” -&gt; è½»é‡çº§é”  -&gt; é‡é‡çº§é”ï¼Œä½†é”åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚ç°åœ¨æˆ‘ä»¬å¼€å‘ä¸€èˆ¬éƒ½ä½¿ç”¨ Spring IoCï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å•ä¾‹ï¼Œè¿™æ ·ç³»ç»Ÿè¿è¡Œæ—¶é—´é•¿åï¼Œå¯èƒ½ synchronized é”å¤§éƒ¨åˆ†éƒ½ä¼šå‡çº§æˆé‡é‡çº§é”ï¼Œæ„Ÿè§‰ synchronized é”å‡çº§å¥½åƒåœ¨è¿™ç§åœºæ™¯ä¸æ˜¯å¤ªå®ç”¨ã€‚ä¸çŸ¥é“ä¼šä¸ä¼šæœ‰è¿™ç§é—®é¢˜ï¼Ÿ","like_count":0},{"had_liked":false,"id":191869,"user_name":"zhangchao","can_delete":false,"product_type":"c1","uid":1508339,"ip_address":"","ucode":"E665D153A85DE0","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/f3/0bd094ad.jpg","comment_is_top":false,"comment_ctime":1584801623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584801623","product_id":100023901,"comment_content":"çœ‹æ¥è¦å­¦ä¹ ä¸‹AQSäº†","like_count":0},{"had_liked":false,"id":191850,"user_name":"zhangchao","can_delete":false,"product_type":"c1","uid":1508339,"ip_address":"","ucode":"E665D153A85DE0","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/f3/0bd094ad.jpg","comment_is_top":false,"comment_ctime":1584800068,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584800068","product_id":100023901,"comment_content":"æ€è€ƒé¢˜å¯èƒ½å‡ºç°æ´»é”","like_count":0},{"had_liked":false,"id":184792,"user_name":"Airsaid","can_delete":false,"product_type":"c1","uid":1115302,"ip_address":"","ucode":"5B90BC0044F376","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/a6/18c4f73c.jpg","comment_is_top":false,"comment_ctime":1583404530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583404530","product_id":100023901,"comment_content":"å†™äº†ä¸€æ®µä»£ç éªŒè¯äº†ä¸‹ ReentrantLock çš„å¯è§æ€§ï¼Œå‘ç°åœ¨ lock() å’Œ unlock() å¤–æ“ä½œå…±äº«å˜é‡æœç„¶ä¼šå¯¼è‡´å˜é‡ä¸å‡†ç¡®ï¼ˆåˆšå¼€å§‹æ²¡åŠ åŠ¨æ€çš„åˆ¤æ–­ï¼Œå‘ç°ä¾ç„¶ä¸€è‡´ï¼Œäºæ˜¯çŒœæµ‹å¯èƒ½æ˜¯ä¼˜åŒ–å¯¼è‡´ï¼ŒåŠ ä¸ŠåŠ¨æ€çš„åˆ¤æ–­åé‡æ–°å°è¯•ï¼Œå‘ç°åœ¨å†…åœ¨å¤–çš„ç»“æœæœç„¶ä¸ä¸€æ ·ï¼‰ï¼š<br><br>class ReentrantLockExample {<br>  private val lock = ReentrantLock()<br>  private var value = 0<br>  private var unsafeValue = 0<br><br>  fun get(): IntArray {<br>    lock.lock()<br>    try {<br>      return intArrayOf(value, unsafeValue)<br>    } finally {<br>      lock.unlock()<br>    }<br>  }<br><br>  fun addOne() {<br>    lock.lock()<br>    try {<br>      value++<br>    } finally {<br>      lock.unlock()<br>    }<br>    &#47;&#47; å¢åŠ æ°¸è¿œä¸º true çš„åŠ¨æ€åˆ¤æ–­ï¼Œé¿å…ç¼–è¯‘å™¨ä¼˜åŒ–<br>    if (System.currentTimeMillis() &gt; Random.nextInt(100))<br>      unsafeValue++<br>  }<br>}<br><br>fun main() {<br>  val threadPool = Executors.newFixedThreadPool(10)<br>  val latch = CountDownLatch(1)<br><br>  val example = ReentrantLockExample()<br><br>  &#47;&#47; å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æ•°æ®å†™å…¥ï¼Œç„¶åæ‰§è¡Œå®Œæ¯•åçœ‹æœ€ç»ˆæ•ˆæœ<br>  repeat(10000) {<br>    threadPool.submit {<br>      latch.await()<br>      example.addOne()<br>      println(&quot;${Thread.currentThread().name}-value: ${Arrays.toString(example.get())}&quot;)<br>    }<br>  }<br><br>  latch.countDown()<br>  threadPool.shutdown()<br>}","like_count":0},{"had_liked":false,"id":182267,"user_name":"Asha","can_delete":false,"product_type":"c1","uid":1796527,"ip_address":"","ucode":"69F227707A9EDD","user_header":"https://static001.geekbang.org/account/avatar/00/1b/69/af/ceb4450c.jpg","comment_is_top":false,"comment_ctime":1582753260,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582753260","product_id":100023901,"comment_content":"è€å¸ˆ ä½ å¥½ æˆ‘æƒ³é—®ä¸‹ç ´åä¸å¯æŠ¢å é”æ˜¯ä¸ºäº†ä½¿å¾—ä¹‹å‰å·²ç»è·å¾—çš„é”é‡Šæ”¾ï¼Œæˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆ synchronizeä¸èƒ½è§£å†³ æˆ‘ç†è§£ä¹‹å‰è®²çš„waitæ“ä½œå°±æ˜¯æŠŠä¹‹å‰è·å–çš„èµ„æºç»™é‡Šæ”¾äº†ï¼Œéº»çƒ¦è€å¸ˆæŒ‡æ­£æˆ‘ç†è§£å“ªé‡Œé”™äº†","like_count":0,"discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380530,"discussion_content":"åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624546553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175802,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1580829016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580829016","product_id":100023901,"comment_content":"æ€è€ƒé¢˜è¿˜çœŸæ˜¯æ´»é” å¦‚æœæŠŠtryLock()æ”¹ä¸ºlock()å°±å˜ä¸ºæ´»é”äº†","like_count":0},{"had_liked":false,"id":158086,"user_name":"æ¢¦å€šæ æ†","can_delete":false,"product_type":"c1","uid":1095857,"ip_address":"","ucode":"BDEB97F2822445","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","comment_is_top":false,"comment_ctime":1575330629,"is_pvip":false,"replies":[{"id":"65379","content":"jdké‡Œæ²¡æœ‰çš„å°±å»jvmé‡Œçœ‹çœ‹ï¼Œæˆ‘å·²ç»çœ‹ä¸åŠ¨äº†ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1578133794,"ip_address":"","comment_id":158086,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1575330629","product_id":100023901,"comment_content":"è€å¸ˆï¼Œunsafeç±»æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿçœ‹ç€è€å¸ˆè¯´çš„å¾ˆç®€å•ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹æ‡µé€¼ï¼Œäºæ˜¯å°±çœ‹äº†locké‡Œåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆã€‚é‡Œé¢æœ€ç»ˆçœ‹åˆ°å°±æ˜¯ä¸€ä¸ªunsafe.<br> return unsafe.compareAndSwapObject(this, headOffset, null, update);","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476625,"discussion_content":"jdké‡Œæ²¡æœ‰çš„å°±å»jvmé‡Œçœ‹çœ‹ï¼Œæˆ‘å·²ç»çœ‹ä¸åŠ¨äº†ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578133794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364379,"discussion_content":"unsafe æ˜¯ä¸ªæœ¬åœ°æ–¹æ³•ç±»ï¼Œéƒ½æ˜¯ç”¨ C++ å®ç°çš„ç›´æ¥ä¸æ“ä½œç³»ç»Ÿæ‰“äº¤é“çš„ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥ç†è§£æˆå¯¹åœ°åŸæ–¹æ³•çš„ä¸€äº›å°è£…ï¼Œä¸ç”¨å…³å¿ƒé‡Œé¢ã€‚çŸ¥é“æ¯ä¸ªæ–¹æ³•çš„ä½œç”¨æ¥å£ï¼Œæ¯”å¦‚ä½ ä¸¾å¾—ä¾‹å­ï¼šunsafe.compareAndSwapObject å°±æ˜¯ CAS å•Šï¼Œå› ä¸º CAS æœ€ç»ˆæ˜¯è¦é€šè¿‡æ“ä½œç³»ç»Ÿå»å®ç°çš„ï¼Œè¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„äº‹æƒ…JAVA è¯­è¨€å±‚é¢åˆåšä¸åˆ°ï¼Œæ‰€ä»¥éœ€è¦ unsafeã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617460303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1212902,"avatar":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","nickname":"æ—…é€”","note":"","ucode":"5022477E8E9441","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":160795,"discussion_content":"çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨çš„cas","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580828053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147435,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1572863779,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572863779","product_id":100023901,"comment_content":"æ˜¯ AbstractQueuedSynchronizer è¿™ä¸ªé‡Œé¢çš„ state è¿™ä¸ªæˆå‘˜å±æ€§å§","like_count":0},{"had_liked":false,"id":144560,"user_name":"é»‘è‰²æ¯›è¡£","can_delete":false,"product_type":"c1","uid":1135912,"ip_address":"","ucode":"FF7E235F91BA5C","user_header":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","comment_is_top":false,"comment_ctime":1571968647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571968647","product_id":100023901,"comment_content":"æˆ‘çŸ¥é“äº†ä¸Šä¸€ç« çš„è¿™ä¸ªæ€»ç»“ï¼š<br>åœ¨ Java è¯­è¨€é‡Œé¢ï¼ŒHappens-Before çš„è¯­ä¹‰æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¯è§æ€§ï¼ŒA Happens-Before B æ„å‘³ç€ A äº‹ä»¶å¯¹ B äº‹ä»¶æ¥è¯´æ˜¯å¯è§çš„ï¼Œæ— è®º A äº‹ä»¶å’Œ B äº‹ä»¶æ˜¯å¦å‘ç”Ÿåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œã€‚<br><br>ä¾‹å¦‚ A äº‹ä»¶å‘ç”Ÿåœ¨çº¿ç¨‹ 1 ä¸Šï¼ŒB äº‹ä»¶å‘ç”Ÿåœ¨çº¿ç¨‹ 2 ä¸Šï¼ŒHappens-Before è§„åˆ™ä¿è¯çº¿ç¨‹ 2 ä¸Šä¹Ÿèƒ½çœ‹åˆ° A äº‹ä»¶çš„å‘ç”Ÿã€‚<br><br>æˆ‘æ„Ÿè§‰è¿™ç§è§„åˆ™ä¼°è®¡æ˜¯åœ¨ç¼–è¯‘ç¯å¢ƒçš„ä¼˜åŒ–ã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":144556,"user_name":"é»‘è‰²æ¯›è¡£","can_delete":false,"product_type":"c1","uid":1135912,"ip_address":"","ucode":"FF7E235F91BA5C","user_header":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","comment_is_top":false,"comment_ctime":1571968379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571968379","product_id":100023901,"comment_content":"è¯·æ•™è€å¸ˆå’Œå…¶ä»–åŒå­¦ä¸€ä¸ªé—®é¢˜ï¼š<br><br>- **é¡ºåºæ€§è§„åˆ™**ï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock()ï¼›<br>- **volatile å˜é‡è§„åˆ™**ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼›<br>- **ä¼ é€’æ€§è§„åˆ™**ï¼šçº¿ç¨‹ T1 çš„ value+=1  Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œã€‚<br><br>é¡ºåºæ€§è§„åˆ™æ˜¯åœ¨çº¿ç¨‹å†…éƒ¨çš„ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·ç†è§£ï¼š<br><br>a = 5ï¼›&#47;&#47; æ™®é€š<br><br>b = 5; &#47;&#47; volatile ä¿®é¥°<br><br>ä¸€æ—¦ä¿®æ”¹äº† volatile å˜é‡ b çš„è¯ï¼Œé‚£ä¹ˆä»–å‰é¢çš„ä¿®æ”¹çš„ç»“æœï¼ˆa = 5ï¼‰ä¹Ÿä¼šåˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Ÿï¼Ÿï¼Ÿ<br><br>é¡ºåºæ€§åªæ˜¯çº¿ç¨‹å†…éƒ¨çš„ï¼Œè€Œä¼ é€’æ€§è·¨è¶Šäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ„Ÿè§‰ä¸å¯¹å§ï¼Œæ˜¯æˆ‘å“ªé‡Œç†è§£é”™äº†å—ï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":141392,"user_name":"é™Œè‡£","can_delete":false,"product_type":"c1","uid":1643898,"ip_address":"","ucode":"EC1B2DA7483F11","user_header":"https://static001.geekbang.org/account/avatar/00/19/15/7a/db9879e1.jpg","comment_is_top":false,"comment_ctime":1571147385,"is_pvip":false,"replies":[{"id":"54749","content":"çœ‹13ç« ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1571227673,"ip_address":"","comment_id":141392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571147385","product_id":100023901,"comment_content":"æœ‰ä¸ªå°é—®é¢˜ä¸è§£ï¼Œè€å¸ˆåœ¨ä»‹ç»å¯é‡å…¥é”ä¾‹å­æ—¶ç”¨finalä¿®é¥°ï¼Œprivate final Lock rtl = = new ReentrantLock(); æ˜¯ä¸ºäº†ä¿è¯å˜é‡rtlä¸ä¼šè¢«ä¿®æ”¹å—ï¼Ÿå¦‚æœæ˜¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œæ˜¯æœ‰å…¶ä»–æ„ä¹‰å—ï¼Ÿæ±‚è§£ç­”","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470743,"discussion_content":"çœ‹13ç« ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571227673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140910,"user_name":"245864982","can_delete":false,"product_type":"c1","uid":1238485,"ip_address":"","ucode":"AC47075A95B759","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/d5/680402fd.jpg","comment_is_top":false,"comment_ctime":1571075138,"is_pvip":false,"replies":[{"id":"54611","content":"å¦‚æœa(),b()éƒ½æ˜¯åŒæ­¥æ–¹æ³•ï¼Œc()ä¹Ÿæ˜¯åŒæ­¥æ–¹æ³•ä¸”å†…éƒ¨éœ€è¦è°ƒç”¨a,bï¼Œè¿™æ—¶å€™å°±éœ€è¦å¯é‡å…¥é”ã€‚ç†è®ºä¸Šæœ‰éå…¬å¹³é”ä¸€ç›´ä¸è¢«å”¤é†’çš„å¯èƒ½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1571142748,"ip_address":"","comment_id":140910,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1571075138","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå¯¹äºå¯é‡å…¥é”ï¼Œä¸ç†è§£è¿™æ ·è®¾è®¡æœ‰ä»€ä¹ˆç”¨é€”çš„ã€‚ä¸¤ä¸ªæ–¹æ³•ç”¨ä¸¤æŠŠé”ä¸å°±å¯ä»¥äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡æˆå¯é‡å…¥çš„ã€‚è¿˜æœ‰å…¬å¹³é”æ˜¯ç­‰å¾…æ—¶é—´é•¿çš„å…ˆè¿›å”¤é†’è°ï¼Œé‚£ä¹ˆéå…¬å¹³é”å‘¢ï¼Ÿæ˜¯éšæœºå—ï¼Ÿéå…¬å¹³é”ä¼šå¯¼è‡´æœ‰çš„çº¿ç¨‹ä¸€ç›´ä¸è¢«å”¤é†’å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470620,"discussion_content":"å¦‚æœa(),b()éƒ½æ˜¯åŒæ­¥æ–¹æ³•ï¼Œc()ä¹Ÿæ˜¯åŒæ­¥æ–¹æ³•ä¸”å†…éƒ¨éœ€è¦è°ƒç”¨a,bï¼Œè¿™æ—¶å€™å°±éœ€è¦å¯é‡å…¥é”ã€‚ç†è®ºä¸Šæœ‰éå…¬å¹³é”ä¸€ç›´ä¸è¢«å”¤é†’çš„å¯èƒ½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571142748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"æ°´ç›®æ²¾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364384,"discussion_content":"å¯¹äºä½ ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—é‡å…¥è¿™ä¸ªè¯æœ‰ç‚¹ç³Šå¼„äººäº†ï¼Œã€‚æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œä½ ä¸€ä¸‹å°±æ˜ç™½äº†ï¼š\nprivate void synchronized recursion(int n) {\n  n--;\n  recursion(n);\n};\nè¿™ä¸ªé€’å½’æ–¹æ³•ï¼Œä½ æ¥è¯´è¯´å¦‚æœ synchronized ä¸æ”¯æŒé‡å…¥ï¼Œè¿™æ–¹æ³•è¿˜èƒ½æ‰§è¡Œå—ï¼Ÿ\næ‰€è°“çš„é‡å…¥æ˜¯ä¸ºäº†é˜²æ­¢è‡ªå·±å’Œè‡ªå·±äº‰æŠ¢é”ã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜ï¼šåœ¨è®¨è®ºå…¬å¹³ä¸éå…¬å¹³çš„æ—¶å€™ï¼Œä½ æŠŠç›®å…‰æ”¾åœ¨äº†é˜Ÿåˆ—ä¸Šï¼ˆå¾ˆå¤šäººéƒ½è¿™æ ·ï¼‰ï¼Œå…¶å®å…¬ä¸å…¬å¹³å¾ˆå¥½ç†è§£çš„ç†è§£çš„ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œä½ è¦å»é£Ÿå ‚æ‰“é¥­ï¼Œå¾ˆå¤šäººåœ¨æ’é˜Ÿã€‚\nå…¬å¹³é”ï¼šä½ çœ‹åˆ°æœ‰é˜Ÿä¼ï¼Œç›´æ¥ç«™åœ¨é˜Ÿåˆ—åé¢ã€‚æŒ‰é¡ºåºä¾æ¬¡ç»™ä½ ä»¬æ‰“é¥­ï¼Œè¿™ä¸å°±å¾ˆå…¬å¹³å—ï¼Ÿ\néå…¬å¹³é”ï¼šä½ ç›´æ¥å†²ä¸Šå»æ’åˆ°ç¬¬ä¸€æ’è®©é˜¿å§¨ç»™ä½ æ‰“é¥­ï¼Œé˜¿å§¨ä¹Ÿç»™ä½ æ‰“ï¼Œè¿™å°±æ˜¯ä¸å…¬å¹³äº†å•Šã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617461039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134947,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1568960630,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1568960630","product_id":100023901,"comment_content":"ä¸ä¼šäº§ç”Ÿæ­»é”ï¼Œä½†æ˜¯ä¼šæœ‰æ´»é”ï¼Œä»£ç é‡Œæœ‰ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œè½¬è´¦æ‰§è¡ŒæˆåŠŸç›´æ¥é€€å‡ºå¾ªç¯å°±å¯ä»¥ç»“æŸäº†ã€‚<br>Java AQSçš„stateå’Œç­‰å¾…é˜Ÿåˆ—ä¹‹å‰çœ‹è¿‡ï¼Œç°åœ¨æ‰çŸ¥é“åŸæ¥æ˜¯ç®¡ç¨‹çš„æ€æƒ³ï¼Œå—æ•™äº†ã€‚","like_count":0},{"had_liked":false,"id":133567,"user_name":"Wangxi","can_delete":false,"product_type":"c1","uid":1211790,"ip_address":"","ucode":"C25A9A14179930","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/8e/bb16d414.jpg","comment_is_top":false,"comment_ctime":1568609650,"is_pvip":true,"replies":[{"id":"51312","content":"å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯é‡Œè®²çš„å¾ˆå¥½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ï¼Œè¿™ä¸ªä¸“æ ä¸»è¦è¿˜æ˜¯å…¥é—¨å’Œä½¿ç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1568633242,"ip_address":"","comment_id":133567,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1568609650","product_id":100023901,"comment_content":"å»ºè®®è€å¸ˆåŠ ä¸Šaqsçš„è®²è§£ï¼ŒjucåŒ…çš„åŸºç¡€ï¼Œç†è§£äº†è¿™ä¸ªï¼Œå¯¹jucç†è§£ä¼šæ›´æ·±","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467429,"discussion_content":"å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯é‡Œè®²çš„å¾ˆå¥½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ï¼Œè¿™ä¸ªä¸“æ ä¸»è¦è¿˜æ˜¯å…¥é—¨å’Œä½¿ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568633242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108159,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e8/bf/39042a46.jpg","nickname":"ç‰™åŒ»","note":"","ucode":"27791DFF11EF45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242281,"discussion_content":"CAS+park/unpark?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587474014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126773,"user_name":"å†‰é‡","can_delete":false,"product_type":"c1","uid":1137353,"ip_address":"","ucode":"2CAEA424996876","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/c9/933ee0a8.jpg","comment_is_top":false,"comment_ctime":1566470514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566470514","product_id":100023901,"comment_content":"å¦‚æœæ¢æˆsynchronizedæ¥é”ä½å¯¹è±¡ï¼Œå‡ºç°çš„å°±æ˜¯æ­»é”äº†å§ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œè€å¸ˆ æˆ‘æœ‰ä¸ªåœ°æ–¹ä¸å¤ªæ˜ç™½ï¼Œæ˜¯å› ä¸ºtryLockæ”¯æŒå°è¯•è·å–é”è€Œéä¸€ç›´é˜»å¡è€Œä¸ä¼šå¯¼è‡´æ­»é”å—ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":126614,"user_name":"é€†æµçš„é±¼","can_delete":false,"product_type":"c1","uid":1258399,"ip_address":"","ucode":"AA3DDE44A83C40","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/9f/8dbd9558.jpg","comment_is_top":false,"comment_ctime":1566436425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566436425","product_id":100023901,"comment_content":"å›é¡¾æ­»é”æ¡ä»¶ï¼š<br>1.èµ„æºäº’æ–¥2.å ç”¨ä¸”ç­‰å¾…3.ä¸å¯æŠ¢å 4.å¾ªç¯ç­‰å¾…<br>ä¸ªäººè®¤ä¸ºï¼Œèƒ½å“åº”ä¸­æ–­å±äº3ï¼Œæ”¯æŒè¶…æ—¶å’Œéé˜»å¡çš„è·å–é”å±äº2","like_count":0},{"had_liked":false,"id":126361,"user_name":"æ—¥æ‹±ä¸€å…µ","can_delete":false,"product_type":"c1","uid":1437158,"ip_address":"","ucode":"D6386E5CD7C061","user_header":"https://static001.geekbang.org/account/avatar/00/15/ed/e6/75a32708.jpg","comment_is_top":false,"comment_ctime":1566371630,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566371630","product_id":100023901,"comment_content":"A,B ä¸¤ä¸ªè´¦æˆ·äº’è½¬ä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":126341,"user_name":"æ–‡","can_delete":false,"product_type":"c1","uid":1090847,"ip_address":"","ucode":"E2DBA62248052E","user_header":"https://static001.geekbang.org/account/avatar/00/10/a5/1f/d2f6a1f7.jpg","comment_is_top":false,"comment_ctime":1566367891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566367891","product_id":100023901,"comment_content":"è€å¸ˆæˆ‘è®°å¾—locké‡Œé¢ç»“ç‚¹åŠ å…¥é˜Ÿåˆ—åä¼šè°ƒç”¨LockSupport.parkï¼Œéå¯ä¸­æ–­åŠ é”é‡Œçš„ä»£ç ","like_count":0},{"had_liked":false,"id":117177,"user_name":"èµµå°æ´›","can_delete":false,"product_type":"c1","uid":1592232,"ip_address":"","ucode":"A326C12B1A1ABA","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/a8/14b8a860.jpg","comment_is_top":false,"comment_ctime":1563982315,"is_pvip":false,"replies":[{"id":"42967","content":"ç±»ä¼¼é”™å³°å‡ºè¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1564027594,"ip_address":"","comment_id":117177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563982315","product_id":100023901,"comment_content":"è€å¸ˆ ä¸ºä»€ä¹ˆåŠ ä¸Šéšæœºç­‰å¾…å°±èƒ½è§£å†³æ´»é”çš„æƒ…å†µã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459848,"discussion_content":"ç±»ä¼¼é”™å³°å‡ºè¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564027594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116932,"user_name":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1563941102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563941102","product_id":100023901,"comment_content":"---æ€»ç»“---<br>1. Lockå‡ºç°çš„ä¸€ä¸ªåŸå› ï¼šé¿å…æ­»é”ï¼Œç ´åä¸å¯æŠ¢å æ¡ä»¶ï¼Œå…¶æ”¯æŒä¸­æ–­å“åº”ã€è¶…æ—¶è®¾ç½®ã€éé˜»å¡åœ°è·å–é”<br>2. Lockå¯¹äºå¯è§æ€§çš„ä¿è¯ï¼šé€šè¿‡åŠ é”å’Œè§£é”æ—¶è®¾ç½®voliateçš„stateå˜é‡ï¼Œåˆ©ç”¨Happens-beforeåŸåˆ™<br>3. Lockæ”¯æŒçš„å±æ€§ï¼šå¯é‡å…¥é”ã€å…¬å¹³é”ä¸éå…¬å¹³é”ã€è¯»å†™é”<br>4. é”çš„æœ€ä½³å®è·µï¼šåªåœ¨è®¿é—®æˆ–æ›´æ–°å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡æ—¶åŠ é”","like_count":0},{"had_liked":false,"id":113946,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1563192029,"is_pvip":false,"replies":[{"id":"41577","content":"éœ€è¦è‡ªå·±æ ¹æ®å®é™…åœºæ™¯å®ç°ï¼Œæœ€åçš„ä¾‹å­è®¤çœŸä½“ä¼šä¸€ä¸‹å§","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1563235236,"ip_address":"","comment_id":113946,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563192029","product_id":100023901,"comment_content":"è€å¸ˆæˆ‘æƒ³é—®ä¸‹lockè·å–ä¸åˆ°é”ä¸»åŠ¨é‡Šæ”¾èµ„æºåœ¨å“ªé‡Œä½“ç°å‘¢ï¼Œæ˜¯åº•å±‚å·²ç»å†™å¥½äº†ä¹ˆ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458449,"discussion_content":"éœ€è¦è‡ªå·±æ ¹æ®å®é™…åœºæ™¯å®ç°ï¼Œæœ€åçš„ä¾‹å­è®¤çœŸä½“ä¼šä¸€ä¸‹å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563235236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113472,"user_name":"é½","can_delete":false,"product_type":"c1","uid":1486566,"ip_address":"","ucode":"378B273955095D","user_header":"https://static001.geekbang.org/account/avatar/00/16/ae/e6/58f30bb3.jpg","comment_is_top":false,"comment_ctime":1563024998,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1563024998","product_id":100023901,"comment_content":"å¯èƒ½ä¼šå‡ºç°æ­»å¾ªç¯å»è·å–é”ï¼Œå³æ´»é”é—®é¢˜","like_count":0},{"had_liked":false,"id":108542,"user_name":"ken","can_delete":false,"product_type":"c1","uid":1206552,"ip_address":"","ucode":"436DB0F6909E67","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep5kj3SLkkQQEVzETBHokoOKYdOtlOGXd8Qk8LXv8QNDhbiazHMCj057eicKtFmFk07UnzLian81jrGA/132","comment_is_top":false,"comment_ctime":1561797103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561797103","product_id":100023901,"comment_content":"å‰é¢è€å¸ˆè®²è¿‡å¤„äºwaiting blockedçŠ¶æ€çš„çº¿ç¨‹ï¼Œå¦‚æœè¢«åˆ«çš„çº¿ç¨‹è°ƒç”¨å…¶interruptæ–¹æ³•ï¼Œå°±ä¼šåœ¨è¢«è°ƒç”¨çº¿ç¨‹è§¦å‘ä¸­æ–­å¼‚å¸¸ï¼Œé‚£æŒæœ‰synchronizedçš„é”è¢«é˜»å¡çš„çº¿ç¨‹ä¹Ÿä¼šæ”¶åˆ°ï¼Œä¸å°±æ»¡è¶³äº†æ¡ä»¶ä¸€ï¼Œå¯ä»¥è¢«ä¸­æ–­å³æœ‰æœºä¼šé‡Šæ”¾æŒæœ‰çš„é”èµ„æºäº†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":104898,"user_name":"å°å°é€—æ¯”","can_delete":false,"product_type":"c1","uid":1327840,"ip_address":"","ucode":"883DA37098FD6D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1JqTt1GcfIzsRFejCKibrHXejcFvhp86mo2lOnqpWEXCgxibnXiaibKOYNoItR58Uyn3q0hDsCFjr3BAX0r60vgydQ/132","comment_is_top":false,"comment_ctime":1560866230,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560866230","product_id":100023901,"comment_content":"this.lock å’Œ tar.lock æ˜¯ä¸¤ä¸ªé”, çº¿ç¨‹è·å–thisé”å,ç»§ç»­è·å–taré”,æ‰§è¡Œæ“ä½œ,ç„¶åé‡Šæ”¾taré” ,å†é‡Šæ”¾thisé”,å½“å‰å¾ªç¯çš„ä»£ç æ‰§è¡Œç»“æŸ, ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯, å› ä¸ºä¸¤ä¸ªé”éƒ½å·²ç»é‡Šæ”¾,æ‰€ä»¥ä¼šæ— é™å¾ªç¯ä¸‹å»","like_count":0},{"had_liked":false,"id":104663,"user_name":"æ™´å¤©å¬å¤œæ›²","can_delete":false,"product_type":"c1","uid":1245813,"ip_address":"","ucode":"D0099EC299A18C","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/75/96a111c1.jpg","comment_is_top":false,"comment_ctime":1560816278,"is_pvip":false,"replies":[{"id":"38256","content":"å¯ä»¥å‚ä¸ä¸€äº›å¼€æºçš„é¡¹ç›®","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1561076985,"ip_address":"","comment_id":104663,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560816278","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå…‰çœ‹ç†è®ºæˆ‘è§‰å¾—å°è±¡ä¸æ˜¯å¾ˆæ·±åˆ»ï¼Ÿéœ€è¦é…åˆä¸€äº›ç»ƒä¹ é¢˜ä»€ä¹ˆçš„ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆå¥½çš„æ¨èã€‚ã€‚ç›®å‰å…¬å¸å‡ ä¹ä¸æ€ä¹ˆå†™å¤šçº¿ç¨‹åœºæ™¯çš„ä»£ç ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454365,"discussion_content":"å¯ä»¥å‚ä¸ä¸€äº›å¼€æºçš„é¡¹ç›®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561076985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100244,"user_name":"JGOS","can_delete":false,"product_type":"c1","uid":1237592,"ip_address":"","ucode":"46A905A169408F","user_header":"https://static001.geekbang.org/account/avatar/00/12/e2/58/2468a5e9.jpg","comment_is_top":false,"comment_ctime":1559497530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559497530","product_id":100023901,"comment_content":"è€å¸ˆ å¦‚æœçº¿ç¨‹t2 , ä¸åŠ é”ç›´æ¥è¯»value,æ˜¯ä¸æ˜¯ä¼šè¯»åˆ°æ—§æ•°æ®?","like_count":0},{"had_liked":false,"id":99359,"user_name":"å‡è£…è‡ªå·±ä¸èƒ–","can_delete":false,"product_type":"c1","uid":1412994,"ip_address":"","ucode":"308F1BAA96CDA5","user_header":"https://static001.geekbang.org/account/avatar/00/15/8f/82/374f43a1.jpg","comment_is_top":false,"comment_ctime":1559199298,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559199298","product_id":100023901,"comment_content":"  if(this.lock.tryLock()) {<br>                try {<br>                    this.balance -= amt;<br>                    if (tar.lock.tryLock()) {<br>                        try {<br>                            tar.balance += amt;<br>                        } finally {<br>                            tar.lock.unlock();<br>                        }<br>                    }&#47;&#47;if<br>                } finally {<br>                    this.lock.unlock();<br>                }<br>            }&#47;&#47;if<br><br><br>è¦æ˜¯è¿™æ ·å‘¢","like_count":0},{"had_liked":false,"id":95852,"user_name":"Hour","can_delete":false,"product_type":"c1","uid":1448748,"ip_address":"","ucode":"AA1045ACABC0BB","user_header":"https://static001.geekbang.org/account/avatar/00/16/1b/2c/6b3c0911.jpg","comment_is_top":false,"comment_ctime":1558231190,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1558231190","product_id":100023901,"comment_content":"è€å¸ˆå¥½ï¼Œå¯¹äºå¯é‡å…¥é”æœ‰ä¸ªç–‘é—®ï¼Œæ‰§è¡ŒaddOne å‡½æ•°æ—¶å¾—åˆ°å¯é‡å…¥é”åç›´æ¥å¯è¿›å…¥get å‡½æ•°ï¼Œå¯åœ¨getå‡½æ•°finallyä¸­åˆæŠŠé”ç»™é‡Šæ”¾æ‰äº†ï¼Œé‚£å†å›åˆ°addOne å‡½æ•°ä¸­æ—¶è¿˜ä¼šæŒæœ‰é”å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1439904,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f8/a0/0512ab62.jpg","nickname":"å¤§å·","note":"","ucode":"23D37AE82F8767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":744,"discussion_content":"https://www.cnblogs.com/dj3839/p/6580765.html è¿™é‡Œé¢æœ‰ä¸ªä¾‹å­  ä½ çœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562033127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93900,"user_name":"è‹èŒ«å¤§åœ°","can_delete":false,"product_type":"c1","uid":1010515,"ip_address":"","ucode":"7EA9DF22931ABB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/53/a102d6a5.jpg","comment_is_top":false,"comment_ctime":1557656880,"is_pvip":false,"replies":[{"id":"34435","content":"æˆ‘æ„Ÿè§‰ä¸ä¸€å®šå§","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558358319,"ip_address":"","comment_id":93900,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557656880","product_id":100023901,"comment_content":"åœ¨è·å–ç¬¬ä¸€æŠŠé”æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒæˆåŠŸè·å–åˆ°ç¬¬ä¸€æŠŠé”åï¼Œå¾ªç¯è·å–ç¬¬äºŒæŠŠé”ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ€§èƒ½æœ€å¥½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449821,"discussion_content":"æˆ‘æ„Ÿè§‰ä¸ä¸€å®šå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558358319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92816,"user_name":"Barry","can_delete":false,"product_type":"c1","uid":1191473,"ip_address":"","ucode":"454C22BB075D56","user_header":"https://static001.geekbang.org/account/avatar/00/12/2e/31/1fd134eb.jpg","comment_is_top":false,"comment_ctime":1557330054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557330054","product_id":100023901,"comment_content":"å¯é‡å…¥é”çš„ä½¿ç”¨åœºæ™¯å…·ä½“æœ‰å“ªäº›ï¼Ÿ","like_count":0},{"had_liked":false,"id":87903,"user_name":"Cancer","can_delete":false,"product_type":"c1","uid":1128051,"ip_address":"","ucode":"DF44879B27760C","user_header":"https://static001.geekbang.org/account/avatar/00/11/36/73/3a652c41.jpg","comment_is_top":false,"comment_ctime":1555747647,"is_pvip":false,"replies":[{"id":"31711","content":"sleepæ”¾å›åˆç»“æŸå‰ä¼šæ›´å¥½ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½sleep<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555894357,"ip_address":"","comment_id":87903,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555747647","product_id":100023901,"comment_content":"\t&#47;&#47; è½¬è´¦<br>\tvoid transfer(Account tar, int amt) {<br>\t\tboolean success = false;<br>\t\tThread th = Thread.currentThread();<br>\t\twhile (!th.isInterrupted() &amp;&amp; !success) {<br>\t\t\tif (this.lock.tryLock()) {&#47;&#47;â‘ <br>\t\t\t\ttry {<br>\t\t\t\t\ttry {<br>\t\t\t\t\t\tThread.sleep(new Random().nextInt(10));&#47;&#47;éšæœºç¡çœ ï¼Œæ‰“ä¸ªæ—¶é—´å·®ï¼Œè§£å†³æ´»é”<br>\t\t\t\t\t} catch (InterruptedException e) {<br>\t\t\t\t\t\tThread.currentThread().interrupt();<br>\t\t\t\t\t}<br>\t\t\t\t\tif (tar.lock.tryLock()) {&#47;&#47;â‘¡<br>\t\t\t\t\t\ttry {<br>\t\t\t\t\t\t\tthis.balance -= amt;<br>\t\t\t\t\t\t\ttar.balance += amt;<br>\t\t\t\t\t\t\tsuccess = true;<br>\t\t\t\t\t\t} finally {<br>\t\t\t\t\t\t\ttar.lock.unlock();<br>\t\t\t\t\t\t}<br>\t\t\t\t\t}<br>\t\t\t\t} finally {<br>\t\t\t\t\tthis.lock.unlock();<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}<br>\t}<br>è€å¸ˆï¼Œæ˜¯ä¸æ˜¯ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³æ´»é”é—®é¢˜äº†å‘¢ï¼Ÿåˆšåˆšçœ‹åˆ°è¿™ä¸€èŠ‚ï¼Œéº»çƒ¦è€å¸ˆæœ‰ç©ºå›å¤ä¸‹ï¼Œè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447640,"discussion_content":"sleepæ”¾å›åˆç»“æŸå‰ä¼šæ›´å¥½ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½sleep\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555894357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84749,"user_name":"speedy9","can_delete":false,"product_type":"c1","uid":1196256,"ip_address":"","ucode":"558A338D54626E","user_header":"https://static001.geekbang.org/account/avatar/00/12/40/e0/2f1816a8.jpg","comment_is_top":false,"comment_ctime":1554902159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554902159","product_id":100023901,"comment_content":"å…³äºæ€è€ƒé¢˜ï¼Œjavaçš„è®¿é—®ä½œç”¨åŸŸä¿®é¥°ç¬¦ï¼Œéƒ½æ˜¯ä¿®é¥°åœ¨ç±»ä¸Šï¼Œä¸åœ¨å®ä¾‹ä¸Šï¼Œå› æ­¤å¯ä»¥äº’ç›¸è®¿é—®privateæˆå‘˜ã€‚","like_count":0},{"had_liked":false,"id":83598,"user_name":"Sunqc","can_delete":false,"product_type":"c1","uid":1473717,"ip_address":"","ucode":"2C54659635403F","user_header":"https://static001.geekbang.org/account/avatar/00/16/7c/b5/4a7a2bd4.jpg","comment_is_top":false,"comment_ctime":1554682775,"is_pvip":false,"replies":[{"id":"30263","content":"æœ‰å¯èƒ½","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554702679,"ip_address":"","comment_id":83598,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554682775","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæ˜¯ä¸æ˜¯å¯èƒ½ä¸æ–­è·å–å¤šé”ï¼Œåˆæœ‰å¯èƒ½å‘ç”Ÿè½¬è´¦æˆåŠŸ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446088,"discussion_content":"æœ‰å¯èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554702679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82740,"user_name":"æœç„¶å¦‚æ­¤","can_delete":false,"product_type":"c1","uid":1210003,"ip_address":"","ucode":"C7543BD0A67505","user_header":"https://static001.geekbang.org/account/avatar/00/12/76/93/c78a132a.jpg","comment_is_top":false,"comment_ctime":1554292827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554292827","product_id":100023901,"comment_content":"æ´»é”è¿˜æ˜¯æ¯”æ­»é”å®¹æ˜“è§£å†³ï¼ŒåŠ ä¸ªéšæœºç­‰å¾…æ—¶é—´æˆ–å®¢æˆ·ç«¯æ‰‹åŠ¨é‡è¯•ï¼","like_count":0},{"had_liked":false,"id":82596,"user_name":"aguan(^ï½¥ï½ªï½¥^)","can_delete":false,"product_type":"c1","uid":1107177,"ip_address":"","ucode":"04833EF2D18E1A","user_header":"https://static001.geekbang.org/account/avatar/00/10/e4/e9/0dd3829f.jpg","comment_is_top":false,"comment_ctime":1554256111,"is_pvip":false,"replies":[{"id":"29896","content":"å…ˆè¯»ä¹Ÿæ²¡å…³ç³»ï¼Œé‡è¦çš„æ˜¯å†™å®Œåï¼Œå…¶ä»–çº¿ç¨‹èƒ½çœ‹åˆ°<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554293214,"ip_address":"","comment_id":82596,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554256111","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå¯¹äºå¯è§æ€§çš„ä¾‹å­æœ‰ä¸ªç–‘é—®<br>ä¸ºå•¥T1çš„unlockå°±å…ˆäºT2çš„lockå‘¢ï¼Ÿstate=0ä¸æ˜¯ä¹Ÿè¦å…ˆè¯»å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445654,"discussion_content":"å…ˆè¯»ä¹Ÿæ²¡å…³ç³»ï¼Œé‡è¦çš„æ˜¯å†™å®Œåï¼Œå…¶ä»–çº¿ç¨‹èƒ½çœ‹åˆ°\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554293214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81833,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1554046376,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1554046376","product_id":100023901,"comment_content":"tar.lock tar.balence  Acountçš„è¿™ä¸¤ä¸ªå±æ€§ä¸æ˜¯privateçš„å—ï¼Ÿè¿˜æ˜¯æˆ‘ç†è§£æœ‰è¯¯å•Š","like_count":0},{"had_liked":false,"id":81644,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1553995499,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553995499","product_id":100023901,"comment_content":"çœ‹äº†å…¶å®ƒä»–äººçš„ç•™è¨€ï¼Œç¡®è®¤ä¼šå‘ç”Ÿæ´»é”ã€‚æ”¹è¿›æ–¹æ¡ˆ1ï¼‰å¯¹ä¸¤ä¸ªè´¦æˆ·æ’åºï¼ŒæŒ‰é¡ºåºåŠ é”ã€‚2ï¼‰æ‹¿åˆ°ç¬¬ä¸€æŠŠé”ï¼Œæ‹¿ç¬¬äºŒæŠŠé”å¤±è´¥ï¼Œæ ¹æ®ä¸¤ä¸ªè´¦æˆ·çš„æ¯”è¾ƒç»“æœé€‰æ‹©æ€§é‡Šæ”¾è¿˜æ˜¯æŒæœ‰","like_count":0},{"had_liked":false,"id":81582,"user_name":"senekis","can_delete":false,"product_type":"c1","uid":1446025,"ip_address":"","ucode":"CD88681F0278FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erTlRJ6skf7iawAeqNfIT1PPgjD7swUdRIRkX1iczjj97GNrxnsnn3QuOhkVbCLgFYAm7sMZficNTSbA/132","comment_is_top":false,"comment_ctime":1553952948,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1553952948","product_id":100023901,"comment_content":"è°¢è°¢è€å¸ˆæ¨èã€ŠJavaå¹¶å‘ç¼–ç¨‹: è®¾è®¡åŸåˆ™ä¸æ¨¡å¼ã€‹è¿™æœ¬ä¹¦å•Šï¼Œä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ï¼Œå·²ç»ç»ç‰ˆäº†ï¼Œæ€ªä¸å¾—ä»¥å‰ä¸Šäºšé©¬é€Šæœç´¢æ—¶éƒ½æ²¡æœ‰æœåˆ°è¿‡ï¼Œè¦ä¸æ˜¯è€å¸ˆæ¨èï¼Œå°±è¦é”™è¿‡å¤§ç¥å†™çš„è¿™éƒ¨ç»å…¸äº†ï¼","like_count":0},{"had_liked":false,"id":81558,"user_name":"è‘£å°šæ–Œ","can_delete":false,"product_type":"c1","uid":1195545,"ip_address":"","ucode":"9582217F65C1C7","user_header":"https://static001.geekbang.org/account/avatar/00/12/3e/19/873abe8a.jpg","comment_is_top":false,"comment_ctime":1553945072,"is_pvip":false,"replies":[{"id":"29574","content":"ä¸ä¼šæ­»é”ä½†æ˜¯æœ‰æ´»é”<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553998757,"ip_address":"","comment_id":81558,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553945072","product_id":100023901,"comment_content":"ä¸ä¼šäº§ç”Ÿæ­»é”ï¼Œå› ä¸ºæ˜¯é‡å…¥é”ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡ä¹Ÿèƒ½è·å–å¾—åˆ°ï¼Œæœ€é‡Œé¢çš„é‡Šæ”¾äº†é”ï¼Œå¯¼è‡´é”é‡Šæ”¾äº†ã€‚<br>---ç­‰ç­‰<br>å¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆæœ€å¤–å±‚çš„é”å²‚ä¸æ˜¯æœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œç†è®ºä¸Šï¼Œä½†æ˜¯ç†è®ºä¸Šï¼Œè¿™ä¸ªé—®é¢˜ç›¸å½“äºï¼Œæˆ‘æœ¬åœ°é”äº†ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œç»“æœä»–å’Œæˆ‘è·å–çš„æ˜¯åŒä¸€ä¸ªé”ã€‚<br>å†™æ³•æ²¡é”™ã€‚<br>æˆ‘è¿˜æ˜¯è®¤ä¸ºä¸ä¼šæ­»é”ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445252,"discussion_content":"ä¸ä¼šæ­»é”ä½†æ˜¯æœ‰æ´»é”\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553998757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81535,"user_name":"ä¸€é“é˜³å…‰","can_delete":false,"product_type":"c1","uid":1239557,"ip_address":"","ucode":"F35207CCCEC6E2","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg","comment_is_top":false,"comment_ctime":1553938122,"is_pvip":false,"replies":[{"id":"29575","content":"ä¼š<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553998836,"ip_address":"","comment_id":81535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553938122","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œä¾‹å­ä¸­ä¸¤ä¸ªifè¯­å¥ä¹‹é—´åŠ ä¸ŠæŸäº›æ“ä½œï¼Œå¦‚æœçº¿ç¨‹è·å–ç¬¬äºŒæŠŠé”å¤±è´¥ï¼Œé‡Šæ”¾æ›¾ç»è·å–çš„é”ï¼Œç„¶åå†æ¬¡é‡æ–°è·å–ç¬¬ä¸€æŠŠé”ä¹‹åï¼Œç¬¬äºŒæŠŠé”ä¹‹å‰ï¼Œè¿™äº›æ“ä½œä¼šé‡å¤æ‰§è¡Œä¸€éå§ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445242,"discussion_content":"ä¼š\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553998836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81506,"user_name":"èŠ±è›‹å£³","can_delete":false,"product_type":"c1","uid":1111006,"ip_address":"","ucode":"917BB219120BD2","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/de/c6509355.jpg","comment_is_top":false,"comment_ctime":1553930195,"is_pvip":false,"replies":[{"id":"29557","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553988993,"ip_address":"","comment_id":81506,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553930195","product_id":100023901,"comment_content":"trylockæ˜¯éé˜»å¡çš„ï¼Œå°è¯•è·å–é”å¤±è´¥ä¼šç«‹å³è¿”å›ï¼Œæ‰€ä»¥ä¸åº”è¯¥ä¼šå‡ºç°æ­»é”é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445233,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553988993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81487,"user_name":"ç¨‹åºå‘˜äººç”Ÿ","can_delete":false,"product_type":"c1","uid":1113668,"ip_address":"","ucode":"C5C5073D89AAA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/44/3e3040ac.jpg","comment_is_top":false,"comment_ctime":1553923968,"is_pvip":false,"replies":[{"id":"29559","content":"è¿˜æœ‰ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553989040,"ip_address":"","comment_id":81487,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553923968","product_id":100023901,"comment_content":"Condition å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445226,"discussion_content":"è¿˜æœ‰ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553989040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81473,"user_name":"ykkk88","can_delete":false,"product_type":"c1","uid":1068585,"ip_address":"","ucode":"A1BCFC2F0D1022","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/29/1be3dd40.jpg","comment_is_top":false,"comment_ctime":1553921090,"is_pvip":false,"replies":[{"id":"29566","content":"æˆ‘è¿™ç§å¯èƒ½<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553991678,"ip_address":"","comment_id":81473,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1553921090","product_id":100023901,"comment_content":"è€å¸ˆ reemtrantlockå¦‚æœæ˜¯éå…¬å¹³é”çš„è¯ ä¼šä¸ä¼šé€ æˆé¥¿æ­» æ¯”å¦‚readwritereentrantlock","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445216,"discussion_content":"æˆ‘è¿™ç§å¯èƒ½\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553991678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81443,"user_name":"å§œå°ç™½","can_delete":false,"product_type":"c1","uid":1449131,"ip_address":"","ucode":"83B2D2A9FA295D","user_header":"https://static001.geekbang.org/account/avatar/00/16/1c/ab/23816951.jpg","comment_is_top":false,"comment_ctime":1553914609,"is_pvip":false,"replies":[{"id":"29544","content":"trylockæ˜¯éé˜»å¡çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553950418,"ip_address":"","comment_id":81443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553914609","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—trylockæ–¹æ³•åº”è¯¥ç”¨é‚£ä¸ªåŠ è¶…æ—¶æ—¶é—´çš„ï¼Œä¸ç„¶ä¼šä¸€ç›´è‡ªæ—‹ä¸‹å»ã€‚æ´»é”äº†","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445199,"discussion_content":"trylockæ˜¯éé˜»å¡çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553950418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81423,"user_name":"é˜¿å†²","can_delete":false,"product_type":"c1","uid":1062514,"ip_address":"","ucode":"06BF66D9009659","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKg7RjNMzSrIwUnjYstbdicVv5MawrQLTHc6rdpwm0Q04b7icj7eAb0F8zSxe8gmM99QBvTECK5KvrQ/132","comment_is_top":false,"comment_ctime":1553911338,"is_pvip":false,"replies":[{"id":"29560","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553989097,"ip_address":"","comment_id":81423,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553911338","product_id":100023901,"comment_content":"æœ‰å¯èƒ½ä¸€ç›´é™·å…¥æ­»å¾ªç¯","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445192,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553989097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81405,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1553905142,"is_pvip":false,"replies":[{"id":"29665","content":"è¿™é‡Œæ‹¿ä¸åˆ°åˆ«äººé”ä¼šé‡Šæ”¾è‡ªå·±çš„é”<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554079732,"ip_address":"","comment_id":81405,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553905142","product_id":100023901,"comment_content":"äº’ç›¸è½¬è´¦æ—¶ï¼Œæœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚å¯é‡å…¥é”æŒ‡çš„æ˜¯å¯¹åŒä¸€æŠŠé”çš„åŠ é”æ“ä½œï¼Œè½¬è´¦è¿™ä¸ªæ˜¾ç„¶æ˜¯2æŠŠä¸åŒçš„é”ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445183,"discussion_content":"è¿™é‡Œæ‹¿ä¸åˆ°åˆ«äººé”ä¼šé‡Šæ”¾è‡ªå·±çš„é”\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554079732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81403,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1553904375,"is_pvip":false,"replies":[{"id":"29666","content":"æˆ‘ä¹Ÿè§‰å¾—ä¸ä¼šæœ‰æ­»é”<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554079760,"ip_address":"","comment_id":81403,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553904375","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—ä¸ä¼šæ­»é”ï¼ŒT1è·å–taré”å’ŒT2è·å–thisé”æœ‰å¯èƒ½åŒæ—¶æ‰§è¡Œï¼Œä½†æ˜¯äº’ç›¸tryLockéƒ½å¤±è´¥ï¼Œè¿›å…¥å¾ªç¯ï¼Œä¸‹ä¸€æ¬¡å†é‡æ–°æ‹¿é”ï¼Œéšç€çº¿ç¨‹çš„æ‰§è¡Œï¼Œæ€»æœ‰æœºä¼šä¸¤ä¸ªçº¿ç¨‹é”™å¼€æ‰§è¡Œåˆ°æ‹¿é”é‚£å¥ï¼Œæ‰€ä»¥ä¸ä¼šæ­»é”ã€‚è¯·è€å¸ˆæŒ‡æ­£ï¼","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445182,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—ä¸ä¼šæœ‰æ­»é”\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554079760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81402,"user_name":"ä¸€é“é˜³å…‰","can_delete":false,"product_type":"c1","uid":1239557,"ip_address":"","ucode":"F35207CCCEC6E2","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg","comment_is_top":false,"comment_ctime":1553904350,"is_pvip":false,"replies":[{"id":"29568","content":"ğŸ‘ğŸ‘ğŸ‘æ”¹è¿‡æ¥äº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553991953,"ip_address":"","comment_id":81402,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553904350","product_id":100023901,"comment_content":"æ­»é”ä¸ä¼šå‡ºç°ï¼Œå¤šæ ¸CPUä¸‹ä¼šå‡ºç°æ´»é”ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ç›¸å»è¯•å›¾è·å–ï¼Œéƒ½æ²¡æœ‰æˆåŠŸï¼Œå°±è¿”å›ã€‚<br>å¦å¤–è€å¸ˆè®²lockè§„åˆ™çš„å¯è§æ€§æ—¶ï¼Œåº”è¯¥æ˜¯çº¿ç¨‹T1çš„lockæ“ä½œä¼šhappens-beforeäºçº¿ç¨‹T2çš„lockæ“ä½œã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445181,"discussion_content":"ğŸ‘ğŸ‘ğŸ‘æ”¹è¿‡æ¥äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553991953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}