{"id":100402,"title":"08 | LuaJITåˆ†æ”¯å’Œæ ‡å‡†Luaæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ OpenResty çš„å¦ä¸€å—åŸºçŸ³ï¼šLuaJITã€‚ä»Šå¤©ä¸»è¦çš„ç¯‡å¹…ï¼Œæˆ‘ä¼šç•™ç»™ Lua å’Œ LuaJIT ä¸­é‡è¦å’Œé²œä¸ºäººçŸ¥çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚è€Œæ›´å¤š Lua è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ï¼Œä½ å¯ä»¥é€šè¿‡æœç´¢å¼•æ“æˆ–è€… Lua çš„ä¹¦ç±è‡ªå·±æ¥å­¦ä¹ ï¼Œè¿™é‡Œæˆ‘æ¨è Lua ä½œè€…ç¼–å†™çš„ã€ŠLua ç¨‹åºè®¾è®¡ã€‹è¿™æœ¬ä¹¦ã€‚</p><p><strong>å½“ç„¶ï¼Œåœ¨ OpenResty ä¸­ï¼Œå†™å‡ºæ­£ç¡®çš„ LuaJIT ä»£ç çš„é—¨æ§›å¹¶ä¸é«˜ï¼Œä½†è¦å†™å‡ºé«˜æ•ˆçš„ LuaJIT ä»£ç ç»éæ˜“äº‹</strong>ï¼Œè¿™é‡Œçš„å…³é”®å†…å®¹ï¼Œæˆ‘ä¼šåœ¨åé¢ OpenResty æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ LuaJIT åœ¨ OpenResty æ•´ä½“æ¶æ„ä¸­çš„ä½ç½®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/ef/cdef970a60810548b9c297e6959671ef.png?wh=1180*874\" alt=\"\"></p><p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒOpenResty çš„ worker è¿›ç¨‹éƒ½æ˜¯ fork master è¿›ç¨‹è€Œå¾—åˆ°çš„ï¼Œ å…¶å®ï¼Œ master è¿›ç¨‹ä¸­çš„ LuaJIT è™šæ‹Ÿæœºä¹Ÿä¼šä¸€èµ· fork è¿‡æ¥ã€‚åœ¨åŒä¸€ä¸ª worker å†…çš„æ‰€æœ‰åç¨‹ï¼Œéƒ½ä¼šå…±äº«è¿™ä¸ª LuaJIT è™šæ‹Ÿæœºï¼ŒLua ä»£ç çš„æ‰§è¡Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªè™šæ‹Ÿæœºä¸­å®Œæˆçš„ã€‚</p><p>è¿™å¯ä»¥ç®—æ˜¯ OpenResty çš„åŸºæœ¬åŸç†ï¼Œåé¢è¯¾ç¨‹æˆ‘ä»¬å†è¯¦ç»†èŠèŠã€‚ä»Šå¤©æˆ‘ä»¬å…ˆæ¥ç†é¡º Lua å’Œ LuaJIT çš„å…³ç³»ã€‚</p><h2>æ ‡å‡† Lua å’Œ LuaJIT çš„å…³ç³»</h2><p>å…ˆæŠŠé‡è¦çš„äº‹æƒ…æ”¾åœ¨å‰é¢è¯´ï¼š</p><p><strong><span class=\"orange\">æ ‡å‡† Lua å’Œ LuaJIT æ˜¯ä¸¤å›äº‹å„¿ï¼ŒLuaJIT åªæ˜¯å…¼å®¹äº† Lua 5.1 çš„è¯­æ³•ã€‚</span></strong></p><!-- [[[read_end]]] --><p>æ ‡å‡† Lua ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 5.3ï¼ŒLuaJIT çš„æœ€æ–°ç‰ˆæœ¬åˆ™æ˜¯ 2.1.0-beta3ã€‚åœ¨ OpenResty å‡ å¹´å‰çš„è€ç‰ˆæœ¬ä¸­ï¼Œç¼–è¯‘çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨æ ‡å‡† Lua VM ï¼Œæˆ–è€… LuaJIT VM æ¥ä½œä¸ºæ‰§è¡Œç¯å¢ƒï¼Œä¸è¿‡ï¼Œç°åœ¨å·²ç»å»æ‰äº†å¯¹æ ‡å‡† Lua çš„æ”¯æŒï¼Œåªæ”¯æŒ LuaJITã€‚</p><p>LuaJIT çš„è¯­æ³•å…¼å®¹ Lua 5.1ï¼Œå¹¶å¯¹ Lua 5.2 å’Œ 5.3 åšäº†é€‰æ‹©æ€§æ”¯æŒã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å…ˆå­¦ä¹  Lua 5.1 çš„è¯­æ³•ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå­¦ä¹  LuaJIT çš„ç‰¹æ€§ã€‚ä¸ŠèŠ‚è¯¾æˆ‘å·²ç»å¸¦ä½ å…¥é—¨äº† Luaçš„åŸºç¡€è¯­æ³•ï¼Œä»Šå¤©åªæåŠLuaçš„ä¸€äº›ç‰¹åˆ«ä¹‹å¤„ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒOpenResty å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ LuaJIT å®˜æ–¹æä¾›çš„ 2.1.0-beta3 ç‰ˆæœ¬ï¼Œè€Œæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ‰©å±•äº†è‡ªå·±çš„ fork: [openresty-luajit2]ï¼š</p><blockquote>\n<p>OpenResty ç»´æŠ¤äº†è‡ªå·±çš„ LuaJIT åˆ†æ”¯ï¼Œå¹¶æ‰©å±•äº†å¾ˆå¤šç‹¬æœ‰çš„ APIã€‚</p>\n</blockquote><p>è¿™äº›ç‹¬æœ‰çš„ APIï¼Œéƒ½æ˜¯åœ¨å®é™…å¼€å‘ OpenResty çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘è€Œå¢åŠ çš„ã€‚<strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬åé¢æåˆ°çš„ LuaJITï¼Œç‰¹æŒ‡ OpenResty è‡ªå·±ç»´æŠ¤çš„ LuaJIT åˆ†æ”¯ã€‚</strong></p><h2>ä¸ºä»€ä¹ˆé€‰æ‹© LuaJITï¼Ÿ</h2><p>è¯´äº†è¿™ä¹ˆå¤š LuaJITå’ŒLua çš„å…³ç³»ï¼Œä½ å¯èƒ½ä¼šçº³é—·å„¿ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨Luaï¼Œè€Œæ˜¯è¦ç”¨è‡ªå·±ç»´æŠ¤çš„LuaJITå‘¢ï¼Ÿå…¶å®ï¼Œæœ€ä¸»è¦çš„åŸå› ï¼Œè¿˜æ˜¯LuaJITçš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><p>å…¶å®æ ‡å‡† Lua å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¹Ÿå†…ç½®äº†è™šæ‹Ÿæœºï¼Œæ‰€ä»¥ Lua ä»£ç å¹¶ä¸æ˜¯ç›´æ¥è¢«è§£é‡Šæ‰§è¡Œçš„ï¼Œè€Œæ˜¯å…ˆç”± Lua ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼ˆByte Codeï¼‰ï¼Œç„¶åå†ç”± Lua è™šæ‹Ÿæœºæ‰§è¡Œã€‚</p><p>è€Œ LuaJIT çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œé™¤äº†ä¸€ä¸ªæ±‡ç¼–å®ç°çš„ Lua è§£é‡Šå™¨å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯ä»¥ç›´æ¥ç”Ÿæˆæœºå™¨ä»£ç çš„ JIT ç¼–è¯‘å™¨ã€‚å¼€å§‹çš„æ—¶å€™ï¼ŒLuaJITå’Œæ ‡å‡† Lua ä¸€æ ·ï¼ŒLua ä»£ç è¢«ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå­—èŠ‚ç è¢« LuaJIT çš„è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚</p><p>ä½†ä¸åŒçš„æ˜¯ï¼ŒLuaJITçš„è§£é‡Šå™¨ä¼šåœ¨æ‰§è¡Œå­—èŠ‚ç çš„åŒæ—¶ï¼Œè®°å½•ä¸€äº›è¿è¡Œæ—¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯ä¸ª Lua å‡½æ•°è°ƒç”¨å…¥å£çš„å®é™…è¿è¡Œæ¬¡æ•°ï¼Œè¿˜æœ‰æ¯ä¸ª Lua å¾ªç¯çš„å®é™…æ‰§è¡Œæ¬¡æ•°ã€‚å½“è¿™äº›æ¬¡æ•°è¶…è¿‡æŸä¸ªéšæœºçš„é˜ˆå€¼æ—¶ï¼Œä¾¿è®¤ä¸ºå¯¹åº”çš„ Lua å‡½æ•°å…¥å£æˆ–è€…å¯¹åº”çš„ Lua å¾ªç¯è¶³å¤Ÿçƒ­ï¼Œè¿™æ—¶ä¾¿ä¼šè§¦å‘ JIT ç¼–è¯‘å™¨å¼€å§‹å·¥ä½œã€‚</p><p>JIT ç¼–è¯‘å™¨ä¼šä»çƒ­å‡½æ•°çš„å…¥å£æˆ–è€…çƒ­å¾ªç¯çš„æŸä¸ªä½ç½®å¼€å§‹ï¼Œå°è¯•ç¼–è¯‘å¯¹åº”çš„ Lua ä»£ç è·¯å¾„ã€‚ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œæ˜¯æŠŠ LuaJIT å­—èŠ‚ç å…ˆè½¬æ¢æˆLuaJIT è‡ªå·±å®šä¹‰çš„ä¸­é—´ç ï¼ˆIRï¼‰ï¼Œç„¶åå†ç”Ÿæˆé’ˆå¯¹ç›®æ ‡ä½“ç³»ç»“æ„çš„æœºå™¨ç ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æ‰€è°“ LuaJIT çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è®©å°½å¯èƒ½å¤šçš„ Lua ä»£ç å¯ä»¥è¢« JIT ç¼–è¯‘å™¨ç”Ÿæˆæœºå™¨ç ï¼Œè€Œä¸æ˜¯å›é€€åˆ° Lua è§£é‡Šå™¨çš„è§£é‡Šæ‰§è¡Œæ¨¡å¼</strong>ã€‚æ˜ç™½äº†è¿™ä¸ªé“ç†ï¼Œä½ æ‰èƒ½ç†è§£åé¢å­¦åˆ°çš„OpenResty æ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨ã€‚</p><h2>Lua ç‰¹åˆ«ä¹‹å¤„</h2><p>æ­£å¦‚æˆ‘ä»¬ä¸ŠèŠ‚è¯¾ä»‹ç»çš„ä¸€æ ·ï¼ŒLua è¯­è¨€ç›¸å¯¹ç®€å•ã€‚å¯¹äºæœ‰å…¶ä»–å¼€å‘è¯­è¨€èƒŒæ™¯çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæ³¨æ„ åˆ°Lua ä¸­ä¸€äº›ç‹¬ç‰¹çš„åœ°æ–¹åï¼Œä½ å°±èƒ½å¾ˆå®¹æ˜“çš„çœ‹æ‡‚ä»£ç é€»è¾‘ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹Luaè¯­è¨€æ¯”è¾ƒç‰¹åˆ«çš„å‡ ä¸ªåœ°æ–¹ã€‚</p><h3>1. Lua çš„ä¸‹æ ‡ä» 1 å¼€å§‹</h3><p>Lua æ˜¯æˆ‘çŸ¥é“çš„å”¯ä¸€ä¸€ä¸ªä¸‹æ ‡ä» 1 å¼€å§‹çš„ç¼–ç¨‹è¯­è¨€ã€‚è¿™ä¸€ç‚¹ï¼Œè™½ç„¶å¯¹äºéç¨‹åºå‘˜èƒŒæ™¯çš„äººæ¥è¯´æ›´å¥½ç†è§£ï¼Œä½†å´å®¹æ˜“å¯¼è‡´ç¨‹åºçš„ bugã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>$ resty -e 't={100}; ngx.say(t[0])'\n</code></pre><p>ä½ è‡ªç„¶æœŸæœ›æ‰“å°å‡º <code>100</code>ï¼Œæˆ–è€…æŠ¥é”™è¯´ä¸‹æ ‡ 0 ä¸å­˜åœ¨ã€‚ä½†ç»“æœå‡ºä¹æ„æ–™ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰æ‰“å°å‡ºæ¥ï¼Œä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬åŠ ä¸Š <code>type</code> å‘½ä»¤ï¼Œæ¥çœ‹ä¸‹è¾“å‡ºåˆ°åº•æ˜¯ä»€ä¹ˆï¼š</p><pre><code>$ resty -e 't={100};ngx.say(type(t[0]))'\nnil\n</code></pre><p>åŸæ¥æ˜¯ç©ºå€¼ã€‚äº‹å®ä¸Šï¼Œåœ¨ OpenResty ä¸­ï¼Œå¯¹äºç©ºå€¼çš„åˆ¤æ–­å’Œå¤„ç†ä¹Ÿæ˜¯ä¸€ä¸ªå®¹æ˜“è®©äººè¿·æƒ‘çš„ç‚¹ï¼Œåé¢æˆ‘ä»¬è®²åˆ° OpenResty çš„æ—¶å€™å†ç»†èŠã€‚</p><h3>2. ä½¿ç”¨ <code>..</code> æ¥æ‹¼æ¥å­—ç¬¦ä¸²</h3><p>è¿™ä¸€ç‚¹ï¼Œä¸ŠèŠ‚è¯¾æˆ‘ä¹Ÿæåˆ°è¿‡ã€‚å’Œå¤§éƒ¨åˆ†è¯­è¨€ä½¿ç”¨ <code>+</code> ä¸åŒï¼ŒLua ä¸­ä½¿ç”¨ä¸¤ä¸ªç‚¹å·æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼š</p><pre><code>$ resty -e &quot;ngx.say('hello' .. ', world')&quot;\nhello, world\n</code></pre><p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¤šç§å¼€å‘è¯­è¨€ï¼Œè€ŒLua è¿™ç§ä¸èµ°å¯»å¸¸è·¯çš„è®¾è®¡ï¼Œæ€»æ˜¯ä¼šè®©å¼€å‘è€…çš„æ€ç»´ï¼Œåœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™å¡é¡¿ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯è®©äººå“­ç¬‘ä¸å¾—ã€‚</p><h3>3. åªæœ‰ <code>table</code> è¿™ä¸€ç§æ•°æ®ç»“æ„</h3><p>ä¸åŒäº Python è¿™ç§å†…ç½®æ•°æ®ç»“æ„ä¸°å¯Œçš„è¯­è¨€ï¼ŒLua ä¸­åªæœ‰ä¸€ç§æ•°æ®ç»“æ„ï¼Œé‚£å°±æ˜¯ tableï¼Œå®ƒé‡Œé¢å¯ä»¥åŒ…æ‹¬æ•°ç»„å’Œå“ˆå¸Œè¡¨ï¼š</p><pre><code>local color = {first = &quot;red&quot;, &quot;blue&quot;, third = &quot;green&quot;, &quot;yellow&quot;}\nprint(color[&quot;first&quot;])                 --&gt; output: red\nprint(color[1])                         --&gt; output: blue\nprint(color[&quot;third&quot;])                --&gt; output: green\nprint(color[2])                         --&gt; output: yellow\nprint(color[3])                         --&gt; output: nil\n</code></pre><p>å¦‚æœä¸æ˜¾å¼åœ°ç”¨<code>_é”®å€¼å¯¹_</code>çš„æ–¹å¼èµ‹å€¼ï¼Œtable å°±ä¼šé»˜è®¤ç”¨æ•°å­—ä½œä¸ºä¸‹æ ‡ï¼Œä» 1 å¼€å§‹ã€‚æ‰€ä»¥ <code>color[1]</code> å°±æ˜¯ blueã€‚</p><p>å¦å¤–ï¼Œæƒ³åœ¨ table ä¸­è·å–åˆ°æ­£ç¡®é•¿åº¦ï¼Œä¹Ÿæ˜¯ä¸€ä»¶ä¸å®¹æ˜“çš„äº‹æƒ…ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™äº›ä¾‹å­ï¼š</p><pre><code>local t1 = { 1, 2, 3 }\nprint(&quot;Test1 &quot; .. table.getn(t1))\n\nlocal t2 = { 1, a = 2, 3 }\nprint(&quot;Test2 &quot; .. table.getn(t2))\n\nlocal t3 = { 1, nil }\nprint(&quot;Test3 &quot; .. table.getn(t3))\n\nlocal t4 = { 1, nil, 2 }\nprint(&quot;Test4 &quot; .. table.getn(t4))\n</code></pre><p>ä½¿ç”¨ <code>resty</code> è¿è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š</p><pre><code>Test1 3\nTest2 2\nTest3 1\nTest4 1\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªè¿”å›é•¿åº¦ä¸º 3 çš„æµ‹è¯•æ¡ˆä¾‹å¤–ï¼Œåé¢çš„æµ‹è¯•éƒ½æ˜¯æˆ‘ä»¬é¢„æœŸä¹‹å¤–çš„ç»“æœã€‚äº‹å®ä¸Šï¼Œæƒ³è¦åœ¨Lua ä¸­è·å– table é•¿åº¦ï¼Œå¿…é¡»æ³¨æ„åˆ°ï¼Œåªæœ‰åœ¨ table æ˜¯ <code>_åºåˆ—_</code> çš„æ—¶å€™ï¼Œæ‰èƒ½è¿”å›æ­£ç¡®çš„å€¼ã€‚</p><p>é‚£ä»€ä¹ˆæ˜¯åºåˆ—å‘¢ï¼Ÿé¦–å…ˆåºåˆ—æ˜¯æ•°ç»„ï¼ˆarrayï¼‰çš„å­é›†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œtable ä¸­çš„å…ƒç´ éƒ½å¯ä»¥ç”¨æ­£æ•´æ•°ä¸‹æ ‡è®¿é—®åˆ°ï¼Œä¸å­˜åœ¨é”®å€¼å¯¹çš„æƒ…å†µã€‚å¯¹åº”åˆ°ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé™¤äº† t2 å¤–ï¼Œå…¶ä»–çš„ table éƒ½æ˜¯ arrayã€‚</p><p>å…¶æ¬¡ï¼Œåºåˆ—ä¸­ä¸åŒ…å«ç©ºæ´ï¼ˆholeï¼‰ï¼Œå³ nilã€‚ç»¼åˆè¿™ä¸¤ç‚¹æ¥çœ‹ï¼Œä¸Šé¢çš„ table ä¸­ï¼Œ t1 æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œè€Œ t3 å’Œ t4 æ˜¯ arrayï¼Œå´ä¸æ˜¯åºåˆ—ï¼ˆsequenceï¼‰ã€‚</p><p>åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆ t4 çš„é•¿åº¦ä¼šæ˜¯ 1 å‘¢ï¼Ÿå…¶å®è¿™æ˜¯å› ä¸ºï¼Œåœ¨é‡åˆ° nil æ—¶ï¼Œè·å–é•¿åº¦çš„é€»è¾‘å°±ä¸ç»§ç»­å¾€ä¸‹è¿è¡Œï¼Œè€Œæ˜¯ç›´æ¥è¿”å›äº†ã€‚</p><p>ä¸çŸ¥é“ä½ å®Œå…¨çœ‹æ‡‚äº†å—ï¼Ÿè¿™éƒ¨åˆ†ç¡®å®ç›¸å½“å¤æ‚ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è·å–åˆ°æˆ‘ä»¬æƒ³è¦çš„ table é•¿åº¦å‘¢ï¼Ÿè‡ªç„¶æ˜¯æœ‰çš„ï¼ŒOpenResty åœ¨è¿™æ–¹é¢åšäº†æ‰©å±•ï¼Œåœ¨åé¢ä¸“é—¨çš„ table ç« èŠ‚æˆ‘ä¼šè®²åˆ°ï¼Œè¿™é‡Œå…ˆç•™ä¸€ä¸ªæ‚¬å¿µã€‚</p><h3>4. é»˜è®¤æ˜¯å…¨å±€å˜é‡</h3><p>æˆ‘æƒ³å…ˆå¼ºè°ƒä¸€ç‚¹ï¼Œé™¤éä½ ç›¸å½“ç¡®å®šï¼Œå¦åˆ™åœ¨ Lua ä¸­å£°æ˜å˜é‡æ—¶ï¼Œå‰é¢éƒ½è¦åŠ ä¸Š <code>local</code>ï¼š</p><pre><code>local s = 'hello'\n</code></pre><p>è¿™æ˜¯å› ä¸ºåœ¨ Lua ä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯å…¨å±€çš„ï¼Œä¼šè¢«æ”¾åˆ°åä¸º <code>_G</code> çš„ table ä¸­ã€‚ä¸åŠ  local çš„å˜é‡ä¼šåœ¨å…¨å±€è¡¨ä¸­æŸ¥æ‰¾ï¼Œè¿™æ˜¯æ˜‚è´µçš„æ“ä½œã€‚å¦‚æœå†åŠ ä¸Šä¸€äº›å˜é‡åçš„æ‹¼å†™é”™è¯¯ï¼Œå°±ä¼šé€ æˆéš¾ä»¥å®šä½çš„ bugã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ OpenResty ç¼–ç¨‹ä¸­ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ æ€»æ˜¯ä½¿ç”¨ <code>local</code> æ¥å£°æ˜å˜é‡ï¼Œå³ä½¿åœ¨ require module çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p><pre><code>-- Recommended \nlocal xxx = require('xxx')\n\n-- Avoid\nrequire('xxx')\n</code></pre><h2>LuaJIT</h2><p>æ˜ç™½äº†Luaè¿™å››ç‚¹ç‰¹åˆ«ä¹‹å¤„ï¼Œæˆ‘ä»¬ç»§ç»­æ¥è¯´LuaJITã€‚é™¤äº†å…¼å®¹ Lua 5.1 çš„è¯­æ³•å¹¶æ”¯æŒ JIT å¤–ï¼ŒLuaJIT è¿˜ç´§å¯†ç»“åˆäº† FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå¯ä»¥è®©ä½ ç›´æ¥åœ¨ Lua ä»£ç ä¸­è°ƒç”¨å¤–éƒ¨çš„ C å‡½æ•°å’Œä½¿ç”¨ C çš„æ•°æ®ç»“æ„ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š</p><pre><code>local ffi = require(&quot;ffi&quot;)\nffi.cdef[[\nint printf(const char *fmt, ...);\n]]\nffi.C.printf(&quot;Hello %s!&quot;, &quot;world&quot;)\n</code></pre><p>çŸ­çŸ­è¿™å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ Lua ä¸­è°ƒç”¨ C çš„ <code>printf</code> å‡½æ•°ï¼Œæ‰“å°å‡º <code>Hello world!</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>resty</code> å‘½ä»¤æ¥è¿è¡Œå®ƒï¼Œçœ‹ä¸‹æ˜¯å¦æˆåŠŸã€‚</p><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ FFI æ¥è°ƒç”¨ NGINXã€OpenSSL çš„ C å‡½æ•°ï¼Œæ¥å®Œæˆæ›´å¤šçš„åŠŸèƒ½ã€‚å®é™…ä¸Šï¼ŒFFI æ–¹å¼æ¯”ä¼ ç»Ÿçš„ Lua/C API æ–¹å¼çš„æ€§èƒ½æ›´ä¼˜ï¼Œè¿™ä¹Ÿæ˜¯ <code>lua-resty-core</code> é¡¹ç›®å­˜åœ¨çš„æ„ä¹‰ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°±æ¥ä¸“é—¨è®²è®² FFI å’Œ <code>lua-resty-core</code>ã€‚</p><p>æ­¤å¤–ï¼Œå‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼ŒLuaJIT è¿˜æ‰©å±•äº† table çš„ç›¸å…³å‡½æ•°ï¼š<code>table.new</code> å’Œ <code>table.clear</code>ã€‚<strong>è¿™æ˜¯ä¸¤ä¸ªåœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢éå¸¸é‡è¦çš„å‡½æ•°</strong>ï¼Œåœ¨ OpenResty çš„ lua-resty åº“ä¸­ä¼šè¢«é¢‘ç¹ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œç”±äºç›¸å…³æ–‡æ¡£è—å¾—éå¸¸æ·±ï¼Œè€Œä¸”æ²¡æœ‰ç¤ºä¾‹ä»£ç ï¼Œæ‰€ä»¥ç†Ÿæ‚‰å®ƒä»¬çš„å¼€å‘è€…å¹¶ä¸å¤šã€‚æˆ‘ä»¬ç•™åˆ°æ€§èƒ½ä¼˜åŒ–ç« èŠ‚ä¸“é—¨æ¥è®²å®ƒä»¬ã€‚</p><h2>å†™åœ¨æœ€å</h2><p>è®©æˆ‘ä»¬æ¥å›é¡¾ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚</p><p>OpenResty å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œé€‰æ‹©äº† LuaJIT è€Œä¸æ˜¯æ ‡å‡† Luaï¼Œå¹¶ä¸”ç»´æŠ¤äº†è‡ªå·±çš„ LuaJIT åˆ†æ”¯ã€‚è€Œ LuaJIT åŸºäº Lua 5.1 çš„è¯­æ³•ï¼Œå¹¶é€‰æ‹©æ€§åœ°å…¼å®¹äº†éƒ¨åˆ† Lua5.2 å’Œ Lua5.3 çš„è¯­æ³•ï¼Œå½¢æˆäº†è‡ªå·±çš„ä½“ç³»ã€‚è‡³äºä½ éœ€è¦æŒæ¡çš„Lua è¯­æ³•ï¼Œåœ¨ä¸‹æ ‡ã€å­—ç¬¦ä¸²æ‹¼æ¥ã€æ•°æ®ç»“æ„å’Œå˜é‡ä¸Šï¼Œéƒ½æœ‰è‡ªå·±é²œæ˜çš„ç‰¹ç‚¹ï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™ä½ åº”è¯¥ç‰¹åˆ«ç•™æ„ã€‚</p><p>ä½ åœ¨å­¦ä¹  Lua å’Œ LuaJIT çš„æ—¶å€™ï¼Œæ˜¯å¦é‡åˆ°ä¸€äº›é™·é˜±å’Œå‘å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€ä¸€èµ·æ¥èŠä¸€èŠï¼Œæˆ‘åœ¨åé¢ä¹Ÿä¸“é—¨å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œæ¥åˆ†äº«æˆ‘é‡åˆ°è¿‡çš„é‚£äº›å‘ã€‚ä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·è¿›æ­¥ã€‚</p><p></p>","neighbors":{"left":{"article_title":"07 | å¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ Lua","id":99830},"right":{"article_title":"09 | ä¸ºä»€ä¹ˆ lua-resty-core æ€§èƒ½æ›´é«˜ä¸€äº›ï¼Ÿ","id":100564}},"comments":[{"had_liked":false,"id":102834,"user_name":"è½¨è¿¹","can_delete":false,"product_type":"c1","uid":1026737,"ip_address":"","ucode":"B212E2582B38CE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/b1/52d2871f.jpg","comment_is_top":false,"comment_ctime":1560310238,"is_pvip":false,"replies":[{"id":"37350","content":"å¤šè°¢è¡¥å…… ï¼šï¼‰","user_name":"ä½œè€…å›å¤","comment_id":102834,"uid":"1017955","ip_address":"","utype":1,"ctime":1560409707,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"65984819678","product_id":100028301,"comment_content":"è€å¸ˆå¯ä»¥è®²ä¸€ä¸‹tableçš„å†…éƒ¨ç»“æ„ï¼ŒæŠŠåŸç†ææ¸…æ¥šï¼Œå°±æ¯”è¾ƒå®¹æ˜“äº†ã€‚<br>è­¬å¦‚è¿™ä¸ªæ–‡ç« ï¼šhttps:&#47;&#47;blog.csdn.net&#47;wwlcsdn000&#47;article&#47;details&#47;81291756<br>ç®€å•çš„å°±æ˜¯ä¸¤ç‚¹ï¼š<br>1ã€ä¸¤ç§å­˜å‚¨ï¼Œå“ˆå¸Œå’Œæ•°ç»„ã€‚<br>2ã€æ•°ç»„ä»¥ä¸‹æ ‡è¦†ç›–åˆ°å“ˆå¸Œï¼Œå¦‚æœé‡åˆ°keyå†²çªï¼Œæ•°ç»„è¦†ç›–å“ˆå¸Œçš„valueã€‚<br>æˆ‘ä¸ªäººæ„Ÿè§‰å°±æ›´å¥½ä¸€ç‚¹ã€‚","like_count":16,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453607,"discussion_content":"å¤šè°¢è¡¥å…… ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560409707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103184,"user_name":"ç©ºçŸ¥","can_delete":false,"product_type":"c1","uid":1013283,"ip_address":"","ucode":"C448E98238DD36","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","comment_is_top":false,"comment_ctime":1560392960,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31625164032","product_id":100028301,"comment_content":"resty -e &quot;local t = {1, nil, name=&#39;cjf&#39;, 2} print(table.getn(t))&quot;<br>3<br><br>è€å¸ˆ æµ‹è¯•ä¸‹è¿™ä¸ª å’‹ä¼šå‡ºæ¥3å‘¢ ä¸æ˜¯é‡è§nilå°±åœæ­¢äº†å—","like_count":7,"discussions":[{"author":{"id":1235193,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d8/f9/9ccc17c6.jpg","nickname":"æ«ç¥ç–","note":"","ucode":"94DE9FF0A5FA50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2428,"discussion_content":"resty -e &#34;local t = {1, 2,3,nil,4,5,6} print(table.getn(t))&#34;\n3\nresty -e &#34;local t = {1, 2,3,nil,4,5,6,7} print(table.getn(t))&#34;\n8\nçœ‹èµ·æ¥å’Œnilå‰åçš„é•¿åº¦è¿˜æœ‰å…³ç³»","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563604042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1036636,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d1/5c/ef7f625a.jpg","nickname":"ğŸ‘Š ğŸ‘Š","note":"","ucode":"8A04740808B47C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1235193,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d8/f9/9ccc17c6.jpg","nickname":"æ«ç¥ç–","note":"","ucode":"94DE9FF0A5FA50","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584328,"discussion_content":"å•¥æ„æ€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660750327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2428,"ip_address":"æµ™æ±Ÿ"},"score":584328,"extra":""}]},{"author":{"id":1501593,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ5Hnw1tL9EWGdzhibCw89hibKjibwcyUBCSJsQWaxxfGu5AkBibibV0anaKqw3nf3ZP0UWy5BaEYyw2Q/132","nickname":"smilekaka","note":"","ucode":"C01D8020019FDC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580294,"discussion_content":"è¿™æ˜¯é—¹å“ªæ ·ï¼Ÿï¼Ÿä»€ä¹ˆæƒ…å†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658067530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102840,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1560311167,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23035147647","product_id":100028301,"comment_content":"ä¾‹å­è®²çš„è¿˜æ˜¯æŒºæ¸…æ¥šçš„ï¼Œå¸Œæœ›ç»§ç»­è®²ä¸€ä¸‹å…·ä½“openrestyå®é™…é¡¹ç›®çš„ä½¿ç”¨åœºæ™¯æ¡ˆä¾‹","like_count":5},{"had_liked":false,"id":111750,"user_name":"é€é¥","can_delete":false,"product_type":"c1","uid":1599553,"ip_address":"","ucode":"46ED5477B7FE87","user_header":"https://static001.geekbang.org/account/avatar/00/18/68/41/86b109fb.jpg","comment_is_top":false,"comment_ctime":1562594006,"is_pvip":true,"replies":[{"id":"40857","content":"æœ‰ä¸¤ä¸ªåŸå› ï¼šä¸€ä¸ªæ˜¯ LuaJIT çš„ä½œè€…åŸºæœ¬å¤„äºé€€ä¼‘çŠ¶æ€ï¼Œåªä¿® bugï¼Œä¸æ€ä¹ˆåŠ æ–°åŠŸèƒ½ï¼Œå…³äº LuaJIT çš„ bugï¼ŒOpenResty è¿˜æ˜¯ä¼šæäº¤ç»™LuaJIT å®˜æ–¹çš„ï¼›ç¬¬äºŒä¸ªæ˜¯æ–°å¢çš„ä¸»è¦æ˜¯ OpenResty ä¼˜åŒ–ä¸­é‡åˆ°çš„ APIï¼Œè‡ªå·±ç»´æŠ¤æ›´å®¹æ˜“æ§åˆ¶ç‰ˆæœ¬å’ŒèŠ‚å¥ã€‚","user_name":"ä½œè€…å›å¤","comment_id":111750,"uid":"1017955","ip_address":"","utype":1,"ctime":1562723119,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"18742463190","product_id":100028301,"comment_content":"openrestyä¸ºä»€ä¹ˆè¦ç»´æŠ¤è‡ªå·±çš„luajitåˆ†æ”¯å‘¢ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç”¨luajit","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457435,"discussion_content":"æœ‰ä¸¤ä¸ªåŸå› ï¼šä¸€ä¸ªæ˜¯ LuaJIT çš„ä½œè€…åŸºæœ¬å¤„äºé€€ä¼‘çŠ¶æ€ï¼Œåªä¿® bugï¼Œä¸æ€ä¹ˆåŠ æ–°åŠŸèƒ½ï¼Œå…³äº LuaJIT çš„ bugï¼ŒOpenResty è¿˜æ˜¯ä¼šæäº¤ç»™LuaJIT å®˜æ–¹çš„ï¼›ç¬¬äºŒä¸ªæ˜¯æ–°å¢çš„ä¸»è¦æ˜¯ OpenResty ä¼˜åŒ–ä¸­é‡åˆ°çš„ APIï¼Œè‡ªå·±ç»´æŠ¤æ›´å®¹æ˜“æ§åˆ¶ç‰ˆæœ¬å’ŒèŠ‚å¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562723119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102696,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1560297937,"is_pvip":true,"replies":[{"id":"37349","content":"è¿™é‡Œçš„å­—èŠ‚ç æ˜¯ LuaJIT è™šæ‹Ÿæœºæ‰§è¡Œçš„ä¸€ç§æŒ‡ä»¤æ ¼å¼ï¼›æœºå™¨ç æ˜¯æŒ‡ CPU å¯ä»¥è¯»å–çš„æŒ‡ä»¤æ ¼å¼ã€‚","user_name":"ä½œè€…å›å¤","comment_id":102696,"uid":"1017955","ip_address":"","utype":1,"ctime":1560409666,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"14445199825","product_id":100028301,"comment_content":"ä¸Šé¢è¯´çš„ luajit å…ˆæŠŠ å­—èŠ‚ç è½¬ä¸ºä¸­é—´ç çˆ±è½¬ä¸º æœºå™¨ç <br>è¿™ä¸ªæœ‰ä¸ªä»¥ä¸ºä½ ï¼Œå­—èŠ‚ç ä¸å°±æ˜¯æœºå™¨ç å—ï¼Ÿ ä¸éƒ½æ˜¯äºŒè¿›åˆ¶çš„ä¸œè¥¿å—","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453536,"discussion_content":"è¿™é‡Œçš„å­—èŠ‚ç æ˜¯ LuaJIT è™šæ‹Ÿæœºæ‰§è¡Œçš„ä¸€ç§æŒ‡ä»¤æ ¼å¼ï¼›æœºå™¨ç æ˜¯æŒ‡ CPU å¯ä»¥è¯»å–çš„æŒ‡ä»¤æ ¼å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560409666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113431,"user_name":"å²æœˆå¦‚æ­Œ","can_delete":false,"product_type":"c1","uid":1428828,"ip_address":"","ucode":"1AEBD6F79941B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QFE00aXGzaS6ibbfJSJsDrpIkqs0OrIYjzZv6L9vZmMhOlut2j24iaeZb0MCQazToE6FRXN960nNiaTrsmw09YjGw/132","comment_is_top":false,"comment_ctime":1563006587,"is_pvip":false,"replies":[{"id":"42848","content":"æˆ‘å»ºè®®å¤§å®¶ç»•ç€èµ°ï¼ŒæŠŠ nil æ”¹ä¸º ngx.null æ¥å¡«å……æ•°ç»„ã€‚ä¸åŒçš„ lua ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œæˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šã€‚","user_name":"ä½œè€…å›å¤","comment_id":113431,"uid":"1017955","ip_address":"","utype":1,"ctime":1563974311,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":5,"race_medal":0,"score":"5857973883","product_id":100028301,"comment_content":"@ç©ºçŸ¥ æå‡ºçš„é—®é¢˜ æœ‰ç›¸åŒçš„ç–‘é—®ï¼Ÿ<br>ã€<br>resty -e &quot;local t = {1, nil, name=&#39;cjf&#39;, 2} print(table.getn(t))&quot;<br>3<br><br>è€å¸ˆ æµ‹è¯•ä¸‹è¿™ä¸ª å’‹ä¼šå‡ºæ¥3å‘¢ ä¸æ˜¯é‡è§nilå°±åœæ­¢äº†å—<br>ã€‘ <br>","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458221,"discussion_content":"æˆ‘å»ºè®®å¤§å®¶ç»•ç€èµ°ï¼ŒæŠŠ nil æ”¹ä¸º ngx.null æ¥å¡«å……æ•°ç»„ã€‚ä¸åŒçš„ lua ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œæˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563974311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013493,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","nickname":"å®ä»”","note":"","ucode":"A0F17DFF99DB21","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161141,"discussion_content":"resty -e &#34;local t = {1,ngx.null,name=&#39;cjf&#39;,2} print(table.getn(t))&#34; è€å¸ˆï¼ŒæŠŠnilæ”¹ä¸ºäº†ngx.nullï¼Œè¿˜æ˜¯æ‰“å°å‡ºæ¥3","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580871182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1066996,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/f4/a7389cd3.jpg","nickname":"superkong","note":"","ucode":"D43F0D6B236B7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1013493,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","nickname":"å®ä»”","note":"","ucode":"A0F17DFF99DB21","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":351966,"discussion_content":"ç¡®å®æ˜¯3ï¼Œä½†print(t[2])æ‰“å°å‡ºæ¥çš„æ˜¯ç©ºå€¼\n$ resty -e &#34;local t = {1, nil, name=&#39;cjf&#39;, 2} print(table.getn(t)) print(t[1]) print(t[2]) print(t[3]) print(t[4])&#34;\n3\n1\n\n2\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614530492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":161141,"ip_address":""},"score":351966,"extra":""}]},{"author":{"id":1501593,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ5Hnw1tL9EWGdzhibCw89hibKjibwcyUBCSJsQWaxxfGu5AkBibibV0anaKqw3nf3ZP0UWy5BaEYyw2Q/132","nickname":"smilekaka","note":"","ucode":"C01D8020019FDC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580295,"discussion_content":"ç¥å¥‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658067627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013493,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","nickname":"å®ä»”","note":"","ucode":"A0F17DFF99DB21","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161142,"discussion_content":"ä½†æ˜¯å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œresty -e &#34;local t = {1, nil, name=&#39;cjf&#39;} print(table.getn(t))&#34;è¿™æ®µä»£ç è¾“å‡ºå°±æ˜¯1ï¼Œä½†æ˜¯å¦‚æœåé¢åœ¨åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå³resty -e &#34;local t = {1, nil, name=&#39;cjf&#39;, 2} print(table.getn(t))&#34;è¾“å‡ºå°±æ˜¯3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580871315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102649,"user_name":"æ—ºæ—º","can_delete":false,"product_type":"c1","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1560272105,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855239401","product_id":100028301,"comment_content":"1.&quot;åœ¨åŒä¸€ä¸ª worker å†…çš„æ‰€æœ‰åç¨‹&quot;,åç¨‹å°±æ˜¯å¸¸è¯´çš„çº¿ç¨‹å§ï¼Ÿ<br>2.$ resty -e &#39;t={100}; ngx.say(t[0])&#39;<br>è¿™ä»£ç ï¼Œå˜é‡å®šä¹‰å‰é¢éœ€è¦åŠ localæ‰èƒ½è¿è¡Œã€‚<br>3.â€œå¯¹åº”åˆ°ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé™¤äº† t2 å¤–ï¼Œå…¶ä»–çš„ table éƒ½æ˜¯ arrayã€‚â€<br>è¿™å¥è¯å†™åäº†å§ï¼Œåº”è¯¥æ˜¯â€œé™¤äº† t2 å¤–ï¼Œå…¶ä»–çš„ table éƒ½æ˜¯ åºåˆ—ã€‚â€å§<br>","like_count":1},{"had_liked":false,"id":346355,"user_name":"æ—æ½‡","can_delete":false,"product_type":"c1","uid":1182886,"ip_address":"","ucode":"8B204A3986363C","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/a6/f2d8b68e.jpg","comment_is_top":false,"comment_ctime":1653042783,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653042783","product_id":100028301,"comment_content":"å­¦ä¹ luaçš„æ—¶å€™é‡åˆ°å‡ ä¸ªä¸ä¸€æ ·çš„åœ°æ–¹ï¼š<br>1. ifå¿…é¡»è¦æœ‰endï¼Œåœ¨pythonå’Œluaä¹‹é—´åˆ‡æ¢ä¼šå¾ˆä¸ä¹ æƒ¯ã€‚<br>2. ä¸€èˆ¬ä¸€ä¸ªå¯¹è±¡è®¿é—®å±æ€§æ˜¯ç”¨å†’å·:ï¼Œè€Œä¸æ˜¯ç‚¹.ï¼Œä¹Ÿä¼šç»å¸¸æ€§å†™é”™ã€‚","like_count":0},{"had_liked":false,"id":324286,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2858431,"ip_address":"","ucode":"24D1E66E284411","user_header":"","comment_is_top":false,"comment_ctime":1638356815,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638356815","product_id":100028301,"comment_content":"æˆ‘é‡åˆ°çš„å‘æ˜¯åœ¨åˆ é™¤tableçš„æ—¶å€™ï¼Œç”¨æ•°ç»„ä¸‹æ ‡å¾ªç¯åˆ é™¤æˆå‘˜æ—¶ï¼Œæ¯æ¬¡åªåˆ é™¤ä¸€ä¸ªè¿˜å¥½ï¼Œå½“åˆ é™¤ä¸¤ä¸ªè¿ç»­æˆå‘˜çš„æ—¶å€™å°±ä¼šæˆé—®é¢˜<br>åæ¥å‘ç°äº†ï¼Œæ£€æµ‹ç¬¬äºŒä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå·²ç»å› ä¸ºä¸Šä¸€ä¸ªå…ƒç´ çš„åˆ é™¤ï¼Œå¯¼è‡´åä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ å¾€å‰çªœäº†ä¸€ä¸ªï¼Œå°±æƒ³é˜Ÿåˆ—ä¸€æ ·ï¼Œå¯¼è‡´å…ƒç´ å˜é‡ç´¢å¼•å‡1ï¼Œå¯¼è‡´åˆ ä¸æ‰çš„bug<br>åæ¥ç½‘ä¸Šæ‰¾äº†ä¸‹æˆåŠŸç»éªŒï¼ŒæŠŠé˜Ÿåˆ—æ¨¡å‹æ”¹æˆå †æ ˆæ¨¡å‹ï¼Œå¾ªç¯ä»å°å˜å¤§çš„è§„åˆ™ï¼Œæ”¹æˆä»å¤§åˆ°å°å¾ªç¯ï¼Œå³ä¾¿å½“å‰ç´¢å¼•çš„å…ƒç´ åˆ æ‰ï¼Œæœ€å¤šå½±å“å¤„ç†å®Œçš„æ•°æ®ä¸‹æ ‡å‘ç”Ÿå˜åŒ–ï¼Œä¸ä¼šå½±å“åˆ°æœªå¤„ç†çš„å…ƒç´ ï¼ŒæŒºæœ‰æ„æ€çš„ã€‚","like_count":0},{"had_liked":false,"id":291942,"user_name":"Geek_xiaoer","can_delete":false,"product_type":"c1","uid":1693884,"ip_address":"","ucode":"DF77DF5ACCD83F","user_header":"","comment_is_top":false,"comment_ctime":1620619064,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620619064","product_id":100028301,"comment_content":"è¯·é—®ï¼ŒLuaè™šæ‹Ÿæœºè·ŸLuaè§£é‡Šå™¨æ˜¯ä¸€æ ·çš„å—ï¼Œåªæ˜¯è¡¨è¿°ä¸åŒï¼Ÿ","like_count":0},{"had_liked":false,"id":289214,"user_name":"wedvefv","can_delete":false,"product_type":"c1","uid":2185258,"ip_address":"","ucode":"5AC8CF0DC1380D","user_header":"https://static001.geekbang.org/account/avatar/00/21/58/2a/fec1ff54.jpg","comment_is_top":false,"comment_ctime":1618918773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618918773","product_id":100028301,"comment_content":"æ¥å£æ–‡ä»¶å’Œæ¨¡å—æ–‡ä»¶éƒ½éœ€è¦ local print=printå—ï¼Ÿ  ä¸ºäº†é¿å…å†²å…¨å±€è¡¨æ‰¾å˜é‡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":242087,"user_name":"å•","can_delete":false,"product_type":"c1","uid":1210890,"ip_address":"","ucode":"8F08E2CB81C4C3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/0a/0ce5c232.jpg","comment_is_top":false,"comment_ctime":1597587637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597587637","product_id":100028301,"comment_content":"è¿™ä¸ªluajitï¼Œä¸æ˜¯å’Œjavaçš„hotspotä¸€æ ·ä¹ˆï¼Œjust-in-time,ä¸€äº›æ˜¯è§£é‡Šæ‰§è¡Œï¼Œç„¶åå¯¹äºä¸€äº›çƒ­ç‚¹ä»£ç ï¼Œè¿›è¡Œç¼–è¯‘æ‰§è¡Œï¼Œè¿™æ˜¯å’Œjava hotspotè™šæ‹Ÿæœºä¸€æ ·çš„æœºåˆ¶ï¼Œä¸çŸ¥é“æ˜¯è°å­¦ä¹ çš„è°","like_count":0},{"had_liked":false,"id":236869,"user_name":"é›ªç²®","can_delete":false,"product_type":"c1","uid":1158275,"ip_address":"","ucode":"363A83AC7CE8B6","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/83/2f143a22.jpg","comment_is_top":false,"comment_ctime":1595572166,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595572166","product_id":100028301,"comment_content":"å¯¹äºLuaJIT VMï¼Œ å¯ä»¥ç†è§£ä¸ºMasterè¿›ç¨‹å’Œå®ƒForkçš„æ¯ä¸ªå­è¿›ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„LuaJIT VMå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":142921,"user_name":"HelloTalk","can_delete":false,"product_type":"c1","uid":1618633,"ip_address":"","ucode":"F898E6A7C61D39","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/c9/b414a77c.jpg","comment_is_top":false,"comment_ctime":1571586819,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571586819","product_id":100028301,"comment_content":"åŸæ¥é»˜è®¤å†™lua çš„æ—¶å€™ï¼Œéœ€è¦åšäºŒè¿›åˆ¶ ä½ç§»ã€æŠ‘æˆ–çš„æ“ä½œï¼Œä¸ºæ­¤è‡ªå·±å†™äº†ä¸€ä¸ªbitopçš„åº“ï¼Œå‘ç°æ€§èƒ½æ›´ä¸ä¸Šï¼Œåé¢ä¸Šäº† luajitï¼Œæµ‹è¯•å¿«äº†å¾ˆå¤šã€‚","like_count":0},{"had_liked":false,"id":117101,"user_name":"KoALa","can_delete":false,"product_type":"c1","uid":1021648,"ip_address":"","ucode":"378E0A7DBC14A6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/d0/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1563968199,"is_pvip":true,"replies":[{"id":"42820","content":"ä¸»è¦æ˜¯OpenResty ä¸­ç©ºå€¼çš„æƒ…å†µæ¯”è¾ƒå¤š","user_name":"ä½œè€…å›å¤","comment_id":117101,"uid":"1017955","ip_address":"","utype":1,"ctime":1563972997,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1563968199","product_id":100028301,"comment_content":"lua ifè¯­å¥çš„åˆ¤æ–­æ–¹å¼å’Œrubyè²Œä¼¼ä¸€æ ·ï¼Œnilå’Œfalseæ‰ä¸ºå‡ï¼Œå…¶ä»–éƒ½ä¸ºçœŸï¼Œç”¨å¤šäº†ä¸ªäººè§‰å¾—è¿™ç§åˆ¤æ–­æ–¹å¼æ›´åˆç†~~","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459823,"discussion_content":"ä¸»è¦æ˜¯OpenResty ä¸­ç©ºå€¼çš„æƒ…å†µæ¯”è¾ƒå¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563972997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113020,"user_name":"æ¨ä¸","can_delete":false,"product_type":"c1","uid":1008597,"ip_address":"","ucode":"D469B0BCA86587","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/d5/a300899a.jpg","comment_is_top":false,"comment_ctime":1562888663,"is_pvip":false,"replies":[{"id":"41173","content":"åé¢æœ‰ä¸“é—¨çš„é™æµé™é€Ÿç« èŠ‚","user_name":"ä½œè€…å›å¤","comment_id":113020,"uid":"1017955","ip_address":"","utype":1,"ctime":1562904456,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562888663","product_id":100028301,"comment_content":"å†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œèµã€‚è€å¸ˆä»€ä¹ˆæ—¶å€™å‡ºä¸ªé™æµçš„å®æˆ˜å§","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458018,"discussion_content":"åé¢æœ‰ä¸“é—¨çš„é™æµé™é€Ÿç« èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562904456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103909,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560563164,"is_pvip":true,"replies":[{"id":"37675","content":"åœ¨ lua-resty-redis é‡Œé¢ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªkey çš„æ—¶å€™ï¼š<br>local res, err = red:get(&quot;dog&quot;)<br>å¦‚æœè¿”å›å€¼ res æ˜¯ nilï¼Œå°±è¯´æ˜å‡½è°ƒç”¨å¤±è´¥äº†ï¼›å¦‚æœ res æ˜¯ ngx.null å°±è¯´æ˜redis ä¸­ä¸å­˜åœ¨ dog è¿™ä¸ªkeyã€‚<br>è€Œåœ¨å¤„ç† cjson çš„æ—¶å€™ï¼Œåˆæœ‰cjson.nullè¿™ä¸ªå€¼ã€‚<br>æ‰€ä»¥è¿˜æ˜¯è¦æ ¹æ®å¯¹åº”åº“çš„æ–‡æ¡£æ¥åšç©ºå€¼çš„åˆ¤æ–­å’ŒåŒºåˆ†ã€‚<br>åœ¨å†™ç±»ä¼¼ if not res then è¿™æ ·çš„ä»£ç çš„æ—¶å€™ï¼Œè¦ç‰¹åˆ«ç•™æ„ä¸‹ï¼Œæœ€å¥½æ”¹æˆæ˜ç¡®çš„ï¼š if res ~= nil and res ~= false then ï¼Œç±»ä¼¼è¿™æ ·çš„ï¼Œå¹¶æœ‰å¯¹åº”çš„æµ‹è¯•æ¡ˆä¾‹è¦†ç›–ã€‚","user_name":"ä½œè€…å›å¤","comment_id":103909,"uid":"1017955","ip_address":"","utype":1,"ctime":1560668727,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1560563164","product_id":100028301,"comment_content":"æœ‰é‡åˆ°ä¸€äº›è®©äººå›°æƒ‘çš„åœ°æ–¹æ˜¯ngx.nullã€nilã€nullã€â€œâ€ã€‚åœ¨ç½‘ä¸Šæœç´¢çš„æ—¶å€™ï¼Œæœ‰çœ‹åˆ°è¯´nullæ˜¯ngx.nullçš„ä¸€ä¸ªå®šä¹‰ã€‚redisçš„è¿”å›å€¼çš„æ—¶å€™ï¼Œç»å¸¸ä¼šåˆ¤æ–­è¿”å›ç»“æœæ˜¯å¦ä¸ºç©ºï¼Œåˆ¤æ–­çš„æ—¶å€™æ˜¯å’Œå“ªä¸ªå€¼è¿›è¡Œæ¯”è¾ƒå‘¢ï¼Ÿå…³äºè¿™äº›ä¸ªå€¼æœ‰æ²¡æœ‰å…¶ä»–ä¸€äº›ä½¿ç”¨ä¸Šçš„å‘å‘¢ï¼Ÿä¸€ç›´ä»¥æ¥éƒ½æ²¡æœ‰æœ‰ä¸€ä¸ªæ˜ç¡®çš„è®¤è¯†ï¼Œæ‰€ä»¥å’Œè€å¸ˆç¡®è®¤ä¸€ä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454051,"discussion_content":"åœ¨ lua-resty-redis é‡Œé¢ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªkey çš„æ—¶å€™ï¼š\nlocal res, err = red:get(&amp;quot;dog&amp;quot;)\nå¦‚æœè¿”å›å€¼ res æ˜¯ nilï¼Œå°±è¯´æ˜å‡½è°ƒç”¨å¤±è´¥äº†ï¼›å¦‚æœ res æ˜¯ ngx.null å°±è¯´æ˜redis ä¸­ä¸å­˜åœ¨ dog è¿™ä¸ªkeyã€‚\nè€Œåœ¨å¤„ç† cjson çš„æ—¶å€™ï¼Œåˆæœ‰cjson.nullè¿™ä¸ªå€¼ã€‚\næ‰€ä»¥è¿˜æ˜¯è¦æ ¹æ®å¯¹åº”åº“çš„æ–‡æ¡£æ¥åšç©ºå€¼çš„åˆ¤æ–­å’ŒåŒºåˆ†ã€‚\nåœ¨å†™ç±»ä¼¼ if not res then è¿™æ ·çš„ä»£ç çš„æ—¶å€™ï¼Œè¦ç‰¹åˆ«ç•™æ„ä¸‹ï¼Œæœ€å¥½æ”¹æˆæ˜ç¡®çš„ï¼š if res ~= nil and res ~= false then ï¼Œç±»ä¼¼è¿™æ ·çš„ï¼Œå¹¶æœ‰å¯¹åº”çš„æµ‹è¯•æ¡ˆä¾‹è¦†ç›–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560668727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103906,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560562675,"is_pvip":true,"replies":[{"id":"37674","content":"LuaJIT æ˜¯ä¼šè®°å½•å¹¶ç»Ÿè®¡ä»£ç çš„è¿è¡Œæ¬¡æ•°ï¼Œæ‰èƒ½çŸ¥é“å“ªäº›æ˜¯çƒ­å‡½æ•°å’Œçƒ­å¾ªç¯ï¼Œè¿™å°±æ˜¯â€œå°è¯•â€çš„å«ä¹‰ï¼›<br>å¦‚æœæœ‰äº›å‡½æ•°åªè°ƒç”¨äº†ä¸€ä¸¤æ¬¡ï¼Œå°±æ²¡æœ‰ç¼–è¯‘çš„å¿…è¦æ€§äº†ï¼›<br>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘çš„çŒœæµ‹å¯èƒ½æ˜¯å¤„äºå®‰å…¨æˆ–è€…ç±»ä¼¼çš„è€ƒè™‘ï¼Œå°±æ²¡æœ‰å†™æ­»ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯éšæœºã€‚","user_name":"ä½œè€…å›å¤","comment_id":103906,"uid":"1017955","ip_address":"","utype":1,"ctime":1560668277,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"1560562675","product_id":100028301,"comment_content":"æ¸©é“­è€å¸ˆï¼Œä½ å¥½~<br>åœ¨â€œä¸ºä»€ä¹ˆé€‰æ‹©luaJITâ€çš„è®²è§£ä¸­ï¼Œè®²åˆ°å¦‚æœluaå‡½æ•°å…¥å£æˆ–è€…luaå¾ªç¯è¶³å¤Ÿçƒ­ï¼ŒJITç¼–è¯‘å™¨ä¼šä»çƒ­å‡½æ•°çš„å…¥å£æˆ–è€…çƒ­å¾ªç¯çš„æŸä¸ªä½ç½®å¼€å§‹å°è¯•ç¼–è¯‘ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹è€å¸ˆã€‚<br>1.è¿™é‡Œçš„â€œå°è¯•â€ç¼–è¯‘çš„æ„æ€æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„çƒ­å‡½æ•°æˆ–è€…çƒ­å¾ªç¯éƒ½å¯ä»¥è¢«ç¼–è¯‘ï¼Œæ˜¯å§ï¼Ÿ<br>2.å¦ä¸€ä¸ªç–‘é—®æ˜¯ä¸ºä»€ä¹ˆä¸€å¼€å§‹ä¸å¯¹æ‰€æœ‰çš„å¯ä»¥è¢«JITç¼–è¯‘çš„å‡½æ•°æˆ–è€…å¾ªç¯ç›´æ¥è¿›è¡Œç¼–è¯‘å‘¢ï¼Ÿ<br>3.ç°åœ¨çš„JITå‘ç°çƒ­ç‚¹ç„¶åè¿›è¡Œç¼–è¯‘ï¼Œä¸ºä»€ä¹ˆåˆ¤æ–­æ˜¯å¦æ˜¯çƒ­ç‚¹æ—¶çš„ç»Ÿè®¡ï¼Œæ˜¯æ ¹æ®ä¸€ä¸ªéšæœºçš„é˜ˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…¶ä»–ï¼Œæ¯”å¦‚ç»è¿‡æµ‹è¯•è®¤ä¸ºæ¯”è¾ƒåˆç†çš„å€¼ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454049,"discussion_content":"LuaJIT æ˜¯ä¼šè®°å½•å¹¶ç»Ÿè®¡ä»£ç çš„è¿è¡Œæ¬¡æ•°ï¼Œæ‰èƒ½çŸ¥é“å“ªäº›æ˜¯çƒ­å‡½æ•°å’Œçƒ­å¾ªç¯ï¼Œè¿™å°±æ˜¯â€œå°è¯•â€çš„å«ä¹‰ï¼›\nå¦‚æœæœ‰äº›å‡½æ•°åªè°ƒç”¨äº†ä¸€ä¸¤æ¬¡ï¼Œå°±æ²¡æœ‰ç¼–è¯‘çš„å¿…è¦æ€§äº†ï¼›\nç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘çš„çŒœæµ‹å¯èƒ½æ˜¯å¤„äºå®‰å…¨æˆ–è€…ç±»ä¼¼çš„è€ƒè™‘ï¼Œå°±æ²¡æœ‰å†™æ­»ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯éšæœºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560668277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306092,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ61zTDmLk7IhLJn6seBPOwsVaKIWUWaxk5YmsdYBZUOYMQCsyl9iaQVSg9U5qJVLLOCFUoLUuYnRA/132","nickname":"fjpcode","note":"","ucode":"C32C5E3ECB9A90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4352,"discussion_content":"è€å¸ˆï¼Œé’ˆå¯¹è¿™ä½åŒå­¦çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä¹Ÿæœ‰åŒæ ·çš„ç–‘é—®ï¼Œå¦‚æœä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰å¯ä»¥è¢«JITç¼–è¯‘çš„ä»£ç è·¯å¾„å…¨éƒ½ç¼–è¯‘å®Œæˆï¼Œä¸ä»…å¯ä»¥çœå»ç»Ÿè®¡çƒ­å¸¦ç çš„ä»£ä»·ï¼Œè€Œä¸”æ•´ä½“æ•ˆç‡æ€§èƒ½ä¸Šä¹Ÿæ˜¯åªå¢ä¸å‡ã€‚ ä¸ºä»€ä¹ˆä¸è¿™æ ·åšå‘¢ï¼Ÿ æ—¢ç„¶æ–‡ä¸­è¯´  &#34;è®©å°½å¯èƒ½å¤šçš„Luaä»£ç è¢«JITç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œè€Œä¸æ˜¯è§£é‡Šæ‰§è¡Œ&#34;ã€‚ æˆ‘è§‰å¾—è¿™ä¹ˆåšå¤šä¹Ÿç¬¦åˆè¿™å¥è¯çš„åŸåˆ™ï¼Œè¿˜æœ›è€å¸ˆæŒ‡ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565331608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102934,"user_name":"shineyyl","can_delete":false,"product_type":"c1","uid":1507069,"ip_address":"","ucode":"96BEAB67B0A19B","user_header":"https://static001.geekbang.org/account/avatar/00/16/fe/fd/28fd7e5f.jpg","comment_is_top":false,"comment_ctime":1560330981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560330981","product_id":100028301,"comment_content":"$ resty -e &#39;local t; t={100}; ngx.say(t[1]);print(type(t[1]))&#39;<br>100<br>number<br>$ resty -e &#39;local t; t={100}; ngx.say(t[0]);print(type(t[0]))&#39;<br>       #ç©º<br>nil    #nilï¼Œéœ€è¦printæ‰“å°å‡ºæ¥tçš„æ•°æ®ç±»å‹<br>","like_count":0},{"had_liked":false,"id":102685,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1560296989,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1560296989","product_id":100028301,"comment_content":"è€å¸ˆ æ–‡ä¸­è¯´äº†   åºåˆ—ä¸åº”è¯¥å«æœ‰  nilçš„ï¼Œarray æ˜¯å¯ä»¥åŒ…å« nil","like_count":0}]}