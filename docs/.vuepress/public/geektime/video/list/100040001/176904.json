{"id":176904,"title":"24 | MongoDB开发最佳实践","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":232952,"user_name":"开心哥","can_delete":false,"product_type":"c3","uid":1705468,"ip_address":"","ucode":"D44C1F03B23C5A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","comment_is_top":false,"comment_ctime":1594176974,"is_pvip":false,"replies":[{"id":88167,"content":"简单的skip功能okay，但是skip多的时候有性能问题。因为在服务端mongo如果你skip 10万条，它真的会load 10万条到内存一条条跳过直到10万条开始返回数据。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596278318,"ip_address":"","comment_id":232952,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"分页可以用skip吗？\n如果每页50个，那skip(n*50).limit(50).","like_count":6,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500824,"discussion_content":"简单的skip功能okay，但是skip多的时候有性能问题。因为在服务端mongo如果你skip 10万条，它真的会load 10万条到内存一条条跳过直到10万条开始返回数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596278318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2761647,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/23/af/16545faf.jpg","nickname":"　　　　　　　　","note":"","ucode":"9746B6479AD959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394130,"discussion_content":"n—>n-1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631754087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164321,"user_name":"lee 杰克","can_delete":false,"product_type":"c3","uid":1089429,"ip_address":"","ucode":"1B452A05B77307","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/95/f656688d.jpg","comment_is_top":false,"comment_ctime":1576935833,"is_pvip":true,"replies":[{"id":62953,"content":"这个有非常多的案例。比较著名的是有最大的一个共享单车，国内最大的汽车制造厂之一，以及最著名的电动车厂都是用mongo来记录车辆GPS位置。放心去用吧。\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577182622,"ip_address":"","comment_id":164321,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问唐老师，MongoDB适合存储车辆GPS信息吗？比如十万辆车，每辆车每十秒上传一次GPS信息（时间，坐标，方向，位置，速度等），MongoDB可以支持这种量级的数据吗？还要考虑车辆位置实时监控，历史时间段轨迹查询等应用。","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478721,"discussion_content":"这个有非常多的案例。比较著名的是有最大的一个共享单车，国内最大的汽车制造厂之一，以及最著名的电动车厂都是用mongo来记录车辆GPS位置。放心去用吧。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577182622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061214,"avatar":"https://static001.geekbang.org/account/avatar/00/10/31/5e/d7cdc1d6.jpg","nickname":"江厚宏","note":"","ucode":"00A5A0995C6D75","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":94719,"discussion_content":"这个比较适合时序数据库，可以看看最近国人刚开源的TDengine","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576982981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164287,"user_name":"注意力$","can_delete":false,"product_type":"c3","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1576924230,"is_pvip":false,"replies":[{"id":62955,"content":"可以参考下这个文档：\n\nhttps:&#47;&#47;docs.atlas.mongodb.com&#47;connection-limits&#47;index.html\n\nmongodb atlas云服务里面的规格和AWS机器规格对应：\n\nM30 m4.large\nM40 m4.xlarge\nM50 m4.2xlarge\nM60 m4.4xlarge\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577183353,"ip_address":"","comment_id":164287,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师请问MongoDB复制集的连接数 和机器的配置应该怎么换算？怎么样达到合理的连接数","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478709,"discussion_content":"可以参考下这个文档：\n\nhttps://docs.atlas.mongodb.com/connection-limits/index.html\n\nmongodb atlas云服务里面的规格和AWS机器规格对应：\n\nM30 m4.large\nM40 m4.xlarge\nM50 m4.2xlarge\nM60 m4.4xlarge\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577183353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178515,"user_name":"sjtuhy","can_delete":false,"product_type":"c3","uid":1662927,"ip_address":"","ucode":"02151EB1AF2133","user_header":"https://static001.geekbang.org/account/avatar/00/19/5f/cf/d661881d.jpg","comment_is_top":false,"comment_ctime":1581732756,"is_pvip":false,"replies":[{"id":70083,"content":"MongoClient本身设计就是个Singleton 类，自己维护了连接池（java默认100个）。如果你用10个MongoClient实例，就是100x10个连接，对mongo服务器压力会太大。\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582347673,"ip_address":"","comment_id":178515,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"使用MongoClient对象连接到MongoDB实例时总是应该保证它单例，并且在整个生命周期中都从它获取其他操作对象。老师 这块为什么一定要是单例","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483856,"discussion_content":"MongoClient本身设计就是个Singleton 类，自己维护了连接池（java默认100个）。如果你用10个MongoClient实例，就是100x10个连接，对mongo服务器压力会太大。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582347673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166879,"user_name":"Never End","can_delete":false,"product_type":"c3","uid":1181565,"ip_address":"","ucode":"0528265D5AAD66","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/7d/08ab5206.jpg","comment_is_top":false,"comment_ctime":1577622261,"is_pvip":false,"replies":[{"id":66777,"content":"MongoDB哪个版本？4.0以后在均衡方面性能有不错的提升。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579133260,"ip_address":"","comment_id":166879,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，目前我们公司物联网准备用mongodb或hbase ，有一些聚合计算，更倾向用mongodb，可是目前遇到问题20亿2个分片，16核32G内存，现在总是分片均衡特别慢，6000个分片，一个2000多，一个3000多，所有服务都停了，均衡一周了还没均衡完，还差好几百个分片没均衡，找了好多看了监控一直找不到原因，","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479664,"discussion_content":"MongoDB哪个版本？4.0以后在均衡方面性能有不错的提升。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579133260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165670,"user_name":"bb","can_delete":false,"product_type":"c3","uid":1770466,"ip_address":"","ucode":"9E480BA11D4D89","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM4fPb1ic9W9IHrz4fxE9t2y9BqRxdibllS5pQfnNiabvib7kc6Ql7YJnVh2PPzxrpXqN3eMsCyvoZrxfw/132","comment_is_top":false,"comment_ctime":1577281215,"is_pvip":false,"replies":[{"id":65212,"content":"目前只支持格林威治时间。。。没法设置。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577970785,"ip_address":"","comment_id":165670,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"在MongoDB中怎么设置本地时间，在查询时间，显示的时间比本地时间慢8个小时","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479253,"discussion_content":"目前只支持格林威治时间。。。没法设置。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577970785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184727,"user_name":"冷脚","can_delete":false,"product_type":"c3","uid":1101601,"ip_address":"","ucode":"C693E75F417D3C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/21/87888b61.jpg","comment_is_top":false,"comment_ctime":1583392122,"is_pvip":false,"replies":[{"id":72151,"content":"你应该用replicaset的模式连，这样换主也可以继续工作。\n\nmongodb:&#47;&#47;host1:27017,host2:27017,host3:27017&#47;mydb?replicaSet=myset","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584004058,"ip_address":"","comment_id":184727,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问一下我默认只连接主节点，不知道为什么主节点变成从节点了，这样最终导致程序只能读不能写了，这种情况怎么处理呢？我现在是手动把原来连的节点重新配置成主节点来解决的","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486109,"discussion_content":"你应该用replicaset的模式连，这样换主也可以继续工作。\n\nmongodb://host1:27017,host2:27017,host3:27017/mydb?replicaSet=myset","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584004058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101601,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cf/21/87888b61.jpg","nickname":"冷脚","note":"","ucode":"C693E75F417D3C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":199128,"discussion_content":"要用ReplicaSet连接方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583557770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166601,"user_name":"Leo","can_delete":false,"product_type":"c3","uid":1779898,"ip_address":"","ucode":"4A8EA8CFE5BB8D","user_header":"https://static001.geekbang.org/account/avatar/00/1b/28/ba/35e4340e.jpg","comment_is_top":false,"comment_ctime":1577514627,"is_pvip":false,"replies":[{"id":65197,"content":"谢谢鼓励加油！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577967552,"ip_address":"","comment_id":166601,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师 加油！","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479553,"discussion_content":"谢谢鼓励加油！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577967552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166514,"user_name":"奔奔奔跑","can_delete":false,"product_type":"c3","uid":1210265,"ip_address":"","ucode":"F86EC205DCAACE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Gswh7ibY4tubXhp0BXOmV2pXZ3XsXic1d942ZMAEgWrRSF99bDskOTsG1g172ibORXxSCWTn9HWUX5vSSUVWU5I4A/132","comment_is_top":false,"comment_ctime":1577462154,"is_pvip":false,"replies":[{"id":66851,"content":"这个没有太好的办法，在mongo里面，就是要去库里查一下。\n除非你的count是不带任何条件，只是全表count，那个是没有性能影响的。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579170305,"ip_address":"","comment_id":166514,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师您好，您的第二章讲的非常好，我每节都有做笔记，十二分钟的视频，消化思考需要接近一个钟，哈哈。\n还有，关于那个count计数的问题，我想请教一下，前端要count数量来做分页显示，这个没法不使用count，还是另外一个集合记录其他集合的count数量，每次需要count的时候去记录集合取？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479522,"discussion_content":"这个没有太好的办法，在mongo里面，就是要去库里查一下。\n除非你的count是不带任何条件，只是全表count，那个是没有性能影响的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579170305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165900,"user_name":"金刚","can_delete":false,"product_type":"c3","uid":1199081,"ip_address":"","ucode":"EF0F1891A50330","user_header":"https://static001.geekbang.org/account/avatar/00/12/4b/e9/a23f3151.jpg","comment_is_top":false,"comment_ctime":1577342760,"is_pvip":false,"replies":[{"id":65206,"content":"这个看上去是跟config服务器的通讯出了问题。检查下你的配置服务器是否状态正常，网络是否okay\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577968856,"ip_address":"","comment_id":165900,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问唐老师,这个报错该怎么进行优化呢？\ncom.mongodb.MongoExecutionTimeoutException: Failed to load chunks due to Operation timed out, request was RemoteCommand 579279","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479311,"discussion_content":"这个看上去是跟config服务器的通讯出了问题。检查下你的配置服务器是否状态正常，网络是否okay\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577968856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165689,"user_name":"bb","can_delete":false,"product_type":"c3","uid":1770466,"ip_address":"","ucode":"9E480BA11D4D89","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM4fPb1ic9W9IHrz4fxE9t2y9BqRxdibllS5pQfnNiabvib7kc6Ql7YJnVh2PPzxrpXqN3eMsCyvoZrxfw/132","comment_is_top":false,"comment_ctime":1577282852,"is_pvip":false,"replies":[{"id":65211,"content":"理论上都可以 - 用户可以在admin库里，也可以在用户库里。我们一般建议建在admin库里方便统一管理","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577970756,"ip_address":"","comment_id":165689,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"请问MongoDB的用户是在库上来配置的吗，还是只是在admin库里配置的","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479259,"discussion_content":"理论上都可以 - 用户可以在admin库里，也可以在用户库里。我们一般建议建在admin库里方便统一管理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577970756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165578,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1577262628,"is_pvip":false,"replies":[{"id":65227,"content":"少数不均衡不是问题（比如说5-10% 的差别）。多了不均衡，要看看是不是有下面问题？\n1） Jumbo chunk \n2） balancer 是不是停了？ sh.getBalancerState()\n3)   写入太频繁，超过IO能力","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577973984,"ip_address":"","comment_id":165578,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"请问唐老师,MongoDB集群分片数据分配不均衡，怎么办 ？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479211,"discussion_content":"少数不均衡不是问题（比如说5-10% 的差别）。多了不均衡，要看看是不是有下面问题？\n1） Jumbo chunk \n2） balancer 是不是停了？ sh.getBalancerState()\n3)   写入太频繁，超过IO能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577973984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309984,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","nickname":"cheriston","note":"","ucode":"617CBFCE0925C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":115297,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578009881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299092,"user_name":"makermade","can_delete":false,"product_type":"c3","uid":1133194,"ip_address":"","ucode":"03386B90CB8F20","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/8a/c1069412.jpg","comment_is_top":false,"comment_ctime":1624455013,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师好，大collection(超1亿)做count()很慢，是不是mongodb不适合这种场景下分页","like_count":0},{"had_liked":false,"id":194943,"user_name":"追忆似水年华","can_delete":false,"product_type":"c3","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1585122868,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"看了这一节的视频，知道了连接字符串最好设置 maxWaitTime 和 writeConcern，保证业务和数据的稳定可靠。\n最后使用分页的几点技巧也很有收获，感谢唐老师。","like_count":0},{"had_liked":false,"id":183809,"user_name":"长脖子树","can_delete":false,"product_type":"c3","uid":1182802,"ip_address":"","ucode":"D9090EF67EEB1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","comment_is_top":false,"comment_ctime":1583138161,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师, 我在最佳实践中看到利用批量写入提升性能的, 比如说 IOT 的数据, 但是感觉不好对这些数据做缓存, 还可能出现数据丢失的情况  怎么能利用好批量写入, 提升写入性能呢?","like_count":0},{"had_liked":false,"id":177767,"user_name":"cording","can_delete":false,"product_type":"c3","uid":1786385,"ip_address":"","ucode":"82063AEC231613","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlllSKrpQkhSXyNj0glDoCiaMKp23ey4Fw0nr54MKKhYAIxxU7toQuukJe2qZjwUC990ojdNmeicVQ/132","comment_is_top":false,"comment_ctime":1581494823,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师你好，我需要将以&#47;A开头的字段值批量替换成&#47;B开头，用JAVA怎么写最好呢？","like_count":0},{"had_liked":false,"id":177700,"user_name":"WING","can_delete":false,"product_type":"c3","uid":1485200,"ip_address":"","ucode":"E4723BA4027407","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IdElofI20lsCUm1NIQPSpYFzAGLbLs41SL324FkmTb0icqnRJicW6mqX4iag1BQUSNtc7BtKJ2fEUYwU4rN47vEsQ/132","comment_is_top":false,"comment_ctime":1581476627,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，我看了京东商城的搜索，能对搜索的结果集做复杂排序，分页，跳页，而且很快（例如我在搜索框输入‘U盘’，下面会有页数列表，还能输入跳到第几页），这是怎么做到的？我知道京东肯定是用了复杂的搜索技术，但我在网上看很多文章都说无论elasticsearch也好，mongodb也好，在做这种深度分页都有很大的性能问题。可是京东淘宝这些都做到了高性能。老师能讲解一下原理吗?（这个问题可能有点超出这门课程的范围，但仍然希望老师能解一下惑，万分感谢）","like_count":0,"discussions":[{"author":{"id":2714469,"avatar":"","nickname":"小贱贱","note":"","ucode":"436BD03904BEE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566636,"discussion_content":"搜索用开源的基本都是elasticsearch，不会用MongoDB做搜索，两者的定位不一样，淘宝好像是有分页限制，同一条件下5000页之后就不能再翻页了，正常人手工翻不到这么多页的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650725600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}