{"id":617792,"title":"09ï½œå¦‚ä½•è¿ç§»åº”ç”¨é…ç½®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Service æ¥è§£å†³åº”ç”¨çš„æœåŠ¡å‘ç°é—®é¢˜ã€‚é€šè¿‡ Service URLï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œè¿˜èƒ½å¤Ÿè·å¾—å¤šå‰¯æœ¬è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚</p><p>é™¤äº†æœåŠ¡å‘ç°ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä¸šåŠ¡åº”ç”¨è¦æƒ³é¡ºåˆ©å¯åŠ¨å¾€å¾€è¿˜éœ€è¦ä¸€äº›ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡æˆ–è€…ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚è®°å½•äº†æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€æ‰€ä¾èµ–çš„å¾®æœåŠ¡ URLã€ç¬¬ä¸‰æ–¹åº”ç”¨çš„å‡­æ®ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚</p><p>åœ¨åº”ç”¨è¿ç§»åˆ° Kubernetes çš„è¿‡ç¨‹ä¸­ï¼Œè¿™äº›é…ç½®ä¿¡æ¯æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¦‚ä½•å¯¹è¿™äº›é…ç½®ä¿¡æ¯è¿›è¡Œç®¡ç†ä»¥åŠå¦‚ä½•è®©åº”ç”¨é¡ºåˆ©è¯»å–åˆ°é…ç½®ä¿¡æ¯æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚</p><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ Kubernetes åº”ç”¨è¯»å–é…ç½®ä¿¡æ¯çš„æœ€ä½³å®è·µã€‚æˆ‘ä»¬è¿˜æ˜¯ä»ç¤ºä¾‹åº”ç”¨å‡ºå‘ï¼Œçœ‹çœ‹ Kubernetes çš„ Envã€ConfigMap å’Œ Secret åˆ°åº•æ˜¯å¦‚ä½•è§£å†³åº”ç”¨çš„é…ç½®é—®é¢˜çš„ã€‚</p><p>åœ¨è¯¾ç¨‹æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å·²ç»æŒ‰ç…§<a href=\"https://time.geekbang.org/column/article/614570\">ç¬¬5è®²</a>çš„å¼•å¯¼åœ¨æœ¬åœ° Kind é›†ç¾¤éƒ¨ç½²äº†ç¤ºä¾‹åº”ç”¨ã€‚</p><h2>å¦‚ä½•ç®¡ç†é…ç½®ï¼Ÿ</h2><p>Kubernetes ç¯å¢ƒä¸‹å¦‚ä½•ç®¡ç†åº”ç”¨é…ç½®å‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘å…ˆæä¸€ä¸ªé—®é¢˜ã€‚å½“ä¸šåŠ¡æ²¡æœ‰è¿›è¡Œå®¹å™¨åŒ–ï¼Œä¹Ÿæ²¡æœ‰è¿ç§»åˆ° Kubernetes çš„æ—¶å€™ï¼Œé…ç½®éƒ½æ˜¯æ€ä¹ˆç®¡ç†çš„ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¯èƒ½æ˜¯éå¸¸å¤šæ ·çš„ï¼Œä¸è¿‡å¤§è‡´å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><!-- [[[read_end]]] --><ul>\n<li>ä»¥é…ç½®æ–‡ä»¶çš„å½¢å¼å’Œä¸šåŠ¡ä»£ç ä¸€å¹¶å­˜å‚¨ï¼›</li>\n<li>åˆ©ç”¨é…ç½®ä¸­å¿ƒå­˜å‚¨åº”ç”¨é…ç½®ã€‚</li>\n</ul><p>å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä¸€ç§<strong>é™æ€çš„é…ç½®ç®¡ç†æ–¹å¼</strong>ï¼Œè¿™ç§ç®¡ç†æ–¹å¼åœ¨å°å‹ä¸šåŠ¡ä¸­æ¯”è¾ƒå¸¸è§ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šå°†é…ç½®æ–‡ä»¶æ”¾åœ¨è™šæ‹Ÿæœºçš„æŸä¸ªç›®å½•ä¸‹ï¼Œè¿™ç±»å‹çš„ä¸šåŠ¡è™šæ‹Ÿæœºæ•°é‡ä¸€èˆ¬è¾ƒå°‘ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œæ‰‹å·¥ç®¡ç†çš„æ–¹å¼æ¥å®ç°ã€‚</p><p>ä½†éšç€ä¸šåŠ¡å¢é•¿ï¼Œå°¤å…¶æ˜¯å½“è™šæ‹Ÿæœºä»å‡ å°å¢é•¿åˆ°å‡ åä¸Šç™¾å°ä¹‹åï¼Œé…ç½®æ–‡ä»¶çš„ç®¡ç†æ–¹å¼åœ¨çµæ´»æ€§æ–¹é¢å°±æœ‰æ‰€ä¸è¶³äº†ã€‚ä¾‹å¦‚å½“æˆ‘ä»¬éœ€è¦æ›´æ–°ä¸šåŠ¡åº”ç”¨æ—¶ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹æ‰€æœ‰è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶ï¼Œè¿™ç§åšæ³•åœ¨é…ç½®çƒ­æ›´æ–°ã€å®¡è®¡å’Œå®¹ç¾æ–¹é¢æœ‰æ˜æ˜¾çš„ç¼ºé™·ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢è¿™äº›é—®é¢˜ï¼Œä¸­å¤§å‹çš„åº”ç”¨ä¸€èˆ¬ä¼šé‡‡ç”¨é…ç½®ä¸­å¿ƒç®¡ç†é…ç½®ã€‚<strong>é…ç½®ä¸­å¿ƒæ˜¯ä¸€ç§è¿è¡Œæ—¶çš„åŠ¨æ€é…ç½®ç®¡ç†æ–¹å¼ï¼Œ</strong>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé…ç½®æ–‡ä»¶å¹¶ä¸ä¼šåƒç¬¬ä¸€ç§æ–¹å¼ä¸€æ ·å’Œä¸šåŠ¡ä¸€èµ·æ‰“åŒ…ï¼Œé…ç½®ä¿¡æ¯ä¼šè¢«å­˜å‚¨åœ¨ä¸€å¥—å¤–éƒ¨çš„ä¸­å¿ƒç³»ç»Ÿä¸Šã€‚è¿™ç§æ–¹å¼åœ¨é…ç½®ç®¡ç†ä¸Šéå¸¸çµæ´»ï¼Œä½†ä»æ¶æ„ä¸Šæ¥çœ‹ä¹Ÿå¼•å…¥äº†æ›´å¤šçš„å¤æ‚æ€§ã€‚é…ç½®ä¸­å¿ƒå’Œä¸šåŠ¡åº”ç”¨çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/be/a5/be3c379823b9c35aed24f8b0845bcca5.jpg?wh=1920x839\" alt=\"å›¾ç‰‡\"></p><p>è¿™å¼ æ¶æ„å›¾ä»£è¡¨äº†ä¸€ç§å…¸å‹çš„åœºæ™¯ï¼Œå½“ä¸šåŠ¡åº”ç”¨å¯åŠ¨åï¼Œå®ƒå°†ä¸»åŠ¨è¿æ¥åˆ°é…ç½®ä¸­å¿ƒå¹¶ä¸”æ‹‰å–é…ç½®ä¿¡æ¯ï¼ŒåŒæ—¶å…·å¤‡é…ç½®çƒ­æ›´æ–°çš„èƒ½åŠ›ã€‚</p><p><strong>ç°åœ¨æˆ‘ä»¬ç»§ç»­å›åˆ°å®¹å™¨åŒ–çš„åº”ç”¨ä¸Šã€‚</strong></p><p>ç±»æ¯”ç¬¬ä¸€ç§â€œä»¥é…ç½®æ–‡ä»¶çš„å½¢å¼å’Œä»£ç ä¸€å¹¶å­˜å‚¨â€çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¦æƒ³è®©ä¸šåŠ¡åº”ç”¨èƒ½åœ¨å®¹å™¨é‡Œè¯»å–åˆ°é…ç½®æ–‡ä»¶ï¼Œå®¹æ˜“æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œæ„å»ºé•œåƒæ—¶ä¸€å¹¶å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°é•œåƒé‡Œã€‚è¿™æ ·åœ¨ Pod å¯åŠ¨åï¼Œå®¹å™¨é‡Œè‡ªç„¶ä¼šæœ‰ä¸€ä»½é…ç½®æ–‡ä»¶ä»¥ä¾›è½½å…¥ä¸šåŠ¡è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Dockerfile ä¸­ä½¿ç”¨ COPY ï¼Œå°† config.conf é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒå†…ï¼š</p><pre><code class=\"language-yaml\"># syntax=docker/dockerfile:1\n\nFROM python:3.8-slim-buster\n......\nWORKDIR /app\n......\nCOPY config.conf config.conf  # å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°é•œåƒ\n......\nCMD [ \"python3\", \"-m\" , \"flask\", \"run\", \"--host=0.0.0.0\"]\n</code></pre><p>å› ä¸ºæ‰€æœ‰ Pod éƒ½ä½¿ç”¨åŒä¸€ä¸ªé•œåƒï¼Œæ‰€ä»¥å®ƒä»¬è‡ªç„¶éƒ½èƒ½è¯»å–åˆ°é…ç½®æ–‡ä»¶ã€‚ä½†è¿™æ˜¯æœ€ä½³å®è·µå—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä¸ºä»€ä¹ˆä¸å»ºè®®è¿™ä¹ˆåšå‘¢ï¼Ÿæˆ‘è®¤ä¸ºæœ‰ä¸‰ä¸ªåŸå› ã€‚</p><p>é¦–å…ˆï¼Œé•œåƒå¾€å¾€ä»£è¡¨çš„æ˜¯ä¸€ä¸ªä¸šåŠ¡è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“æˆ‘ä»¬ä¿®æ”¹äº†ä¸šåŠ¡çš„æºç åï¼Œæ‰æœ‰å¿…è¦é‡æ–°æ„å»ºé•œåƒã€‚è€Œé…ç½®æ–‡ä»¶ä¸€èˆ¬å¹¶ä¸ä¼šç»å¸¸å˜æ›´ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ²¡å¿…è¦å°†ç›¸å¯¹å›ºå®šçš„é…ç½®æ–‡ä»¶ä¸€å¹¶å¤åˆ¶åˆ°å®¹å™¨é‡Œã€‚</p><p>å…¶æ¬¡ï¼Œå½“é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹åï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå¸Œæœ›é…ç½®èƒ½å¤Ÿå°½å¿«ç”Ÿæ•ˆï¼Œè€Œé‡æ–°æ„å»ºé•œåƒã€æ¨é€é•œåƒä»¥åŠæ›´æ–° Pod é•œåƒç‰ˆæœ¬çš„è¿‡ç¨‹è¾ƒé•¿ï¼Œå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬å¯¹é…ç½®æ–‡ä»¶æ›´æ–°æ—¶æ•ˆä¸Šçš„è¯‰æ±‚ã€‚</p><p>æœ€åï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œé…ç½®æ–‡ä»¶é‡Œé¢è®°å½•çš„ä¸€èˆ¬æ˜¯å’Œè¿ç»´ç›¸å…³çš„æœºå¯†ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸åº”è¯¥å‘å¼€å‘è€…æš´éœ²ï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬éå¸¸æœ‰å¿…è¦å°†é•œåƒå’Œé…ç½®ä¿¡æ¯è¿›è¡Œè§£è€¦ã€‚</strong></p><p>æ—¢ç„¶åœ¨è§£è€¦åé•œåƒå†…å¹¶æ²¡æœ‰è¿™ä»½é…ç½®æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å‚è€ƒä¹‹å‰æåˆ°çš„ç¬¬äºŒç§â€œé…ç½®ä¸­å¿ƒâ€çš„åŠ¨æ€æ–¹æ¡ˆå‘¢ï¼Ÿä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ Pod å¯åŠ¨æ—¶å°†å¿…è¦çš„ä¿¡æ¯â€œåŠ¨æ€æ³¨å…¥â€åˆ°å®¹å™¨é‡Œï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±å®ç°äº†é…ç½®ä¸­å¿ƒçš„æ•ˆæœå‘¢ï¼Ÿ</p><p>æ˜¯çš„ï¼ŒKubernetes ä¸ºæˆ‘ä»¬æä¾›äº†<strong>ç¯å¢ƒå˜é‡ã€ConfigMap å’Œ Secret</strong>æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³ä¸šåŠ¡åº”ç”¨çš„é…ç½®é—®é¢˜ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿæ˜¯ç®¡ç†åº”ç”¨é…ç½®ä¿¡æ¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬éƒ½æ¯”ä½œæ˜¯ Kubernetes çš„â€œåº”ç”¨é…ç½®ä¸­å¿ƒâ€ã€‚</p><h2>Kubernetes â€œåº”ç”¨é…ç½®ä¸­å¿ƒâ€</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ç»§ç»­ä»¥å®æˆ˜åº”ç”¨ä¸ºä¾‹ï¼Œä»‹ç» Kubernetes åº”ç”¨é…ç½®çš„ä¸‰ç§æ–¹æ¡ˆã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul>\n<li>Env ç¯å¢ƒå˜é‡</li>\n<li>ConfigMap</li>\n<li>Secret</li>\n</ul><p>å…¶ä¸­ï¼ŒEnv å¯ä»¥å‘ Pod æ³¨å…¥ç¯å¢ƒå˜é‡ï¼Œä½¿å¾—ä¸šåŠ¡åº”ç”¨åœ¨å®¹å™¨å†…å¯ä»¥ç›´æ¥è¯»å–å®ƒä»¬ã€‚ConfigMap ç»å¸¸ç”¨äºä¸º Pod æ³¨å…¥é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ iniã€confã€.env é…ç½®æ–‡ä»¶ç­‰ã€‚Secret ä¸€èˆ¬ç”¨æ¥å‘ Pod æ³¨å…¥æœºå¯†ä¿¡æ¯ï¼Œä¾‹å¦‚ç¬¬ä¸‰æ–¹åº”ç”¨çš„ Token ç­‰ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ æœ€ç®€å•çš„é…ç½®æ–¹å¼ï¼ŒEnv ç¯å¢ƒå˜é‡ã€‚</p><h3>Env</h3><p>ç¯å¢ƒå˜é‡æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„åº”ç”¨è¯»å–é…ç½®çš„æ–¹å¼ï¼Œåœ¨éå®¹å™¨åŒ–åº”ç”¨çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸ºè™šæ‹Ÿæœºé…ç½®ç¯å¢ƒå˜é‡ä»¥ä¾¿ä¸šåŠ¡ç¨‹åºè¿›è¡Œè¯»å–ã€‚åœ¨ Kubernetes ç¯å¢ƒä¸‹ï¼Œä¸šåŠ¡è¿›ç¨‹æ˜¯è¿è¡Œåœ¨å®¹å™¨é‡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœäº†ã€‚</p><p>æ­¤å¤–ï¼Œç”±äºå®¹å™¨æ˜¯ç”± Pod ç®¡ç†çš„ï¼Œè€Œæˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­åˆä¸ä¼šç›´æ¥ä½¿ç”¨åˆ° Pod ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ›´ä¸Šå±‚çš„å·¥ä½œè´Ÿè½½ï¼Œä¾‹å¦‚ Deploymentã€‚æ‰€ä»¥ï¼Œè¦ä¸º Pod é…ç½®ç¯å¢ƒå˜é‡ï¼Œå°±å˜æˆäº†ä¸ºä¸Šå±‚çš„å·¥ä½œè´Ÿè½½ä¾‹å¦‚ Deployment é…ç½®ç¯å¢ƒå˜é‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¥ç¤ºä¾‹åº”ç”¨çš„åç«¯æœåŠ¡ backend ä¸ºä¾‹ï¼Œè¿›ä¸€æ­¥è§£é‡Šç¯å¢ƒå˜é‡çš„é…ç½®æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ backend Deployment Manifest çš„éƒ¨åˆ†å†…å®¹ï¼š</p><pre><code class=\"language-powershell\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: backend\n  ......\nspec:\n  replicas: 1\n  ......\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999/backend:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 5000\n        env:\n        - name: DATABASE_URI\n          value: pg-service\n        - name: DATABASE_USERNAME\n          value: postgres\n        - name: DATABASE_PASSWORD\n          value: postgres\n</code></pre><p>æ³¨æ„ä¸€ä¸‹ Containers ä¸‹çš„ Env å­—æ®µã€‚åœ¨è¿™æ®µ Manifest ä¸­ï¼Œæˆ‘ä»¬ä¸º flask-backend å®¹å™¨é…ç½®äº†ä¸‰ä¸ªç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«æ˜¯ DATABASE_URIã€DATABASE_USERNAME å’Œ DATABASE_PASSWORDï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨æ•°æ®åº“è¿æ¥åœ°å€ã€è´¦å·å’Œå¯†ç ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ kubectl exec è¿›å…¥åˆ°å…¶ä¸­ä¸€ä¸ªåç«¯æœåŠ¡çš„å®¹å™¨ç»ˆç«¯è¿›è¡ŒéªŒè¯ï¼š</p><pre><code class=\"language-powershell\">$ kubectl exec -it $(kubectl get pods --selector=app=backend -n example -o jsonpath=\"{.items[0].metadata.name}\") -n example -- sh\n# env | grep DATABASE\nDATABASE_URI=pg-service\nDATABASE_USERNAME=postgres\nDATABASE_PASSWORD=postgres\n</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œ backend å®¹å™¨å†…æ–°å¢äº†å¯¹åº”çš„ç¯å¢ƒå˜é‡ï¼ŒåŒæ—¶å€¼ä¹Ÿç¬¦åˆé¢„æœŸï¼Œè¯´æ˜ç¯å¢ƒå˜é‡é…ç½®æˆåŠŸã€‚</p><p>åœ¨ä¸º backend Deployment å·¥ä½œè´Ÿè½½é…ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œå®ƒç®¡ç†çš„æ‰€æœ‰ Pod éƒ½ä¼šè¢«æ³¨å…¥ç›¸åº”çš„ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œä¸ç®¡æ˜¯è§¦å‘å¼¹æ€§ä¼¸ç¼©åˆ›å»ºæ–°çš„ Pod æˆ–è€… Pod è¢«é‡å¯æ—¶ï¼Œè¿™äº› Pod çš„ç¯å¢ƒå˜é‡éƒ½å°†ä¿æŒä¸€è‡´ã€‚ä¸‹å›¾è¡¨ç¤ºçš„æ˜¯ Deployment å’Œ Pod ç¯å¢ƒå˜é‡çš„ä»å±å…³ç³»ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/13/21/1333c712b736f40ffaae011778ff7821.jpg?wh=1920x884\" alt=\"å›¾ç‰‡\"></p><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPod å†…çš„ç¯å¢ƒå˜é‡ DATABASE_URI çš„å€¼æ˜¯ pg-serviceï¼Œå®ƒä»£è¡¨çš„æ˜¯ Postgres æ•°æ®åº“çš„è¿æ¥åœ°å€ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šä¸€è®²æåˆ°çš„ Service URL å—ï¼Ÿå› ä¸ºæ•°æ®åº“å’Œåç«¯æœåŠ¡åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹ï¼Œæ‰€ä»¥è¿™é‡Œçš„ pg-service ä¹Ÿå°±æ˜¯ Service çš„åç§°ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¨ç§°ï¼špg-service.example.svc.cluster.localã€‚</p><p>å½“å®¹å™¨å†…æœ‰è¿™ä¸ªç¯å¢ƒå˜é‡ä¹‹åï¼Œä¸šåŠ¡ä»£ç å°±å¯ä»¥ç›´æ¥è¯»å–äº†ã€‚è¿™é‡Œä»¥ç¤ºä¾‹åº”ç”¨çš„ Python åç«¯ app.py ä¸ºä¾‹ï¼š</p><pre><code class=\"language-powershell\">import os\ndb_uri = os.environ.get('DATABASE_URI')\n</code></pre><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é…ç½®å¤šä¸ªç¯å¢ƒå˜é‡ï¼Œç”±äºå®é™…ä¸Š Env æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œæ‰€ä»¥ä½ å®Œå…¨å¯ä»¥åœ¨ Deployment çš„ Manifest é‡Œä¸º Pod é…ç½®å¤šä¸ªç¯å¢ƒå˜é‡ã€‚</p><p>Env çš„é…ç½®æ–¹å¼å…¼å®¹äº†ä¸€äº›ä¸šåŠ¡åº”ç”¨éœ€è¦è¯»å–ç‰¹å®šç¯å¢ƒå˜é‡çš„æƒ…å†µï¼Œå½“æˆ‘ä»¬æƒ³è¦å°†è¿™äº›ç±»å‹çš„åº”ç”¨å®¹å™¨åŒ–å¹¶è¿ç§»åˆ° Kubernetes ä¸­æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æä¾›ç¯å¢ƒå˜é‡ã€‚è€Œä¸”ï¼Œè¿™å¯¹ä¸šåŠ¡æ¥è¯´ä¹Ÿæ²¡æœ‰ä»»ä½•ä¾µå…¥æ€§ï¼Œæ˜¯ä¸€ç§å€¼å¾—æ¨èçš„é…ç½®ç®¡ç†æ–¹å¼ã€‚</p><p>è¿™ä¹ˆçœ‹ï¼ŒEnv ç¯å¢ƒå˜é‡æ˜¯ä¸æ˜¯æœ‰ä¸€ç‚¹åƒæˆ‘ä»¬å‰é¢ä»‹ç»çš„é…ç½®ä¸­å¿ƒçš„ä¾‹å­å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæ‰€æœ‰ Pod çš„ç¯å¢ƒå˜é‡äº‹å®ä¸Šéƒ½æ˜¯ä» Deployment å·¥ä½œè´Ÿè½½çš„ Env å­—æ®µç»§æ‰¿çš„ï¼Œæˆ‘ä»¬åœ¨ Deployment é‡Œç”³æ˜çš„ Env å­—æ®µï¼Œå°±åƒæ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„é…ç½®ä¸­å¿ƒï¼Œè´Ÿè´£å¯¹å®ƒè‡ªèº«ç®¡ç†çš„æ‰€æœ‰ Pod ä¸‹å‘é…ç½®ã€‚å½“æˆ‘ä»¬è¦ä¿®æ”¹ç¯å¢ƒå˜é‡æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ Deployment çš„ Env å­—æ®µï¼Œå°±å¯ä»¥æ›´æ–°æ‰€æœ‰ Pod çš„ç¯å¢ƒå˜é‡äº†ã€‚</p><h3>ConfigMap</h3><p>è™½ç„¶ Env å¯ä»¥ä¸º Pod é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œæœ‰ä¸€äº›ä¸šåŠ¡åº”ç”¨å¹¶ä¸æ˜¯ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ä¿¡æ¯ï¼Œè€Œæ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼è½½å…¥é…ç½®ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œç¯å¢ƒå˜é‡æ˜¾ç„¶æ˜¯ä¸é€‚ç”¨çš„ã€‚</p><p>è¿™æ—¶ï¼Œç”¨ ConfigMap å°±éå¸¸é€‚åˆäº†ã€‚</p><p>ConfigMap æ˜¯ä¸€ç§ç±»ä¼¼äºé…ç½®ä¸­å¿ƒçš„â€œè¿è¡Œæ—¶â€åŠ¨æ€é…ç½®ç®¡ç†æ–¹å¼ï¼Œå®ƒèƒ½å¤Ÿåœ¨ Pod å¯åŠ¨æ—¶ï¼Œå°† ConfigMap çš„å†…å®¹ä»¥æ–‡ä»¶çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œè¿™æ ·ï¼Œä¸šåŠ¡è¿›ç¨‹å°±èƒ½å¤Ÿé¡ºåˆ©è¯»å–é…ç½®æ–‡ä»¶ä¿¡æ¯äº†ã€‚</p><p><strong>ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆå›åˆ°ç¤ºä¾‹åº”ç”¨çš„æ•°æ®åº“</strong>ï¼Œä¹Ÿå°±æ˜¯ Postgres Deploymentã€‚</p><p>åœ¨ä»‹ç»ç¤ºä¾‹åº”ç”¨æ—¶æˆ‘ä»¬æœ‰æåˆ°è¿‡ï¼Œåœ¨ç¤ºä¾‹åº”ç”¨çš„é¦–é¡µè¾“å…¥çš„ä»»ä½•å†…å®¹ï¼Œå®é™…ä¸Šéƒ½ä¼šä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚é‚£ä¹ˆï¼Œä½ ä¸€å®šä¼šéå¸¸å¥½å¥‡è¿™ä¸ªæ•°æ®åº“çš„è¡¨ç»“æ„å’Œå­—æ®µæ˜¯æ€ä¹ˆè¢«åˆå§‹åŒ–çš„å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œç¤ºä¾‹åº”ç”¨çš„æ•°æ®åº“å°±ä½¿ç”¨äº† ConfigMapï¼Œå®ƒå°†ä¸€æ®µåˆå§‹åŒ–è¡¨ç»“æ„çš„ SQL ä»¥æ–‡ä»¶çš„æ–¹å¼æŒ‚è½½åˆ°äº†å®¹å™¨å†…éƒ¨çš„ä¸€ä¸ªç‰¹æ®Šçš„è·¯å¾„ä¸Šï¼ŒPostgres åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿è¡Œè¯¥ç›®å½•çš„ SQL æ¥åˆå§‹åŒ–è¡¨ç»“æ„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¥ç¤ºä¾‹åº”ç”¨çš„æ•°æ®åº“ä¸ºä¾‹ï¼Œå¸¦ä½ è¿›ä¸€æ­¥å­¦ä¹  ConfigMap å’Œå®ƒçš„ä½¿ç”¨æ–¹æ³•ã€‚åœ¨éƒ¨ç½²ç¤ºä¾‹åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å·²ç»éƒ¨ç½²äº†ä¸€ä¸ªåä¸º pg-init-script çš„ ConfigMap åˆ°é›†ç¾¤ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ kubectl get å‘½ä»¤è·å–è¿™ä¸ª ConfigMap çš„å†…å®¹ï¼š</p><pre><code class=\"language-yaml\">$ kubectl get configmap pg-init-script -n example -o yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: pg-init-script\n  ......\ndata:\n  CreateDB.sql: |-\n    CREATE TABLE text (\n        id serial PRIMARY KEY,\n        text VARCHAR ( 100 ) UNIQUE NOT NULL\n    );\n</code></pre><p>è¿™æ®µ ConfigMap ä¸»è¦æè¿°äº†ä¸¤ä¸ªé‡è¦çš„ä¿¡æ¯ã€‚é¦–å…ˆï¼ŒConfigMap çš„åç§°ä¸º pg-init-scriptï¼Œå®ƒæ˜¯è¿™æ®µ ConfigMap åç§°æ ‡è¯†ã€‚å…¶æ¬¡ï¼Œdata å­—æ®µæŒ‡å®šäº† Key å’Œ Value é”®å€¼å¯¹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒCreateDB.sql å®é™…ä¸Šæ˜¯ Keyï¼ŒValue å€¼æ˜¯ä¸€æ®µ SQL ä»£ç ï¼Œè¿™æ®µ SQL ä»£ç éå¸¸ç®€å•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ª text è¡¨ï¼Œå¹¶å®šä¹‰äº† id å’Œ text å­—æ®µã€‚</p><p>è¿™æ®µ ConfigMap å…¶å®å°±å¯ä»¥è®¤ä¸ºæ˜¯ä¸šåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬å°†è¿™æ®µ ConfigMap åº”ç”¨åˆ°é›†ç¾¤ä¹‹åï¼Œå°±å¯ä»¥åœ¨å·¥ä½œè´Ÿè½½ä¸­è¿›è¡Œå¼•ç”¨äº†ã€‚å¼•ç”¨çš„æ–¹å¼å¯ä»¥å‚è€ƒç¤ºä¾‹åº”ç”¨ Postgres Deploymentï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: Postgres\n  ......\nspec:\n  ......\n  template:\n    ......\n    spec:\n      containers:\n      - name: Postgres\n        image: Postgres\n        volumeMounts:\n        - name: sqlscript\n          mountPath: /docker-entrypoint-initdb.d\n        ......\n      volumes:\n        - name: sqlscript\n          configMap:\n            name: pg-init-script\n</code></pre><p>è¦åœ¨å·¥ä½œè´Ÿè½½å¼•ç”¨ ConfigMapï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°å·¥ä½œè´Ÿè½½çš„ Volumes ï¼Œä¹Ÿå°±æ˜¯å·çš„æœºåˆ¶ã€‚</p><p>è¿™é‡Œè¯·ä½ é‡ç‚¹å…³æ³¨ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯ volumes å­—æ®µå’Œ volumeMounts å­—æ®µã€‚volumes å­—æ®µä»£è¡¨çš„å«ä¹‰æ˜¯ä»¥å·çš„æ–¹å¼ä½¿ç”¨ pg-init-script ConfigMapï¼Œå¹¶å°†å·å‘½åä¸º sqlscriptã€‚volumeMounts å­—æ®µå’Œ volumes ä¸€èˆ¬æˆå¯¹å‡ºç°ï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯å°† sqlscript å·æŒ‚è½½åˆ°å®¹å™¨çš„ /docker-entrypoint-initdb.d ç›®å½•ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å£°æ˜çš„ ConfigMap å†…å®¹å°†ä»¥æ–‡ä»¶çš„æ–¹å¼æŒ‚è½½åˆ°å®¹å™¨å†…ã€‚å…·ä½“åˆ°è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®¹å™¨çš„ /docker-entrypoint-initdb.d ç›®å½•å°†ä¼šå‡ºç° CreateDB.sql æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ ConfigMap çš„ SQL è¯­å¥ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯é€šè¿‡ ConfigMap æŒ‚è½½çš„æ–¹å¼â€œåŠ¨æ€æ³¨å…¥â€åˆ°å®¹å™¨å†…çš„ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘ä¸ºä½ ç”»äº†ä¸€å¼  Deploymentã€Volumes å’Œ ConfigMap ä¹‹é—´çš„æ¶æ„å›¾ï¼Œä¾›ä½ å‚è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/e6/c97b022f9c82240b9148b632ee6c8ee6.jpg?wh=1920x636\" alt=\"å›¾ç‰‡\"></p><p>ä»æ¶æ„å›¾ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå®¹å™¨å†…éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿçš„ CreateDB.sql æ¥è‡ªäºæˆ‘ä»¬åœ¨ Deployment å£°æ˜çš„ Volumesï¼Œè€Œ Volumes çš„æ–‡ä»¶å†…å®¹åˆæ¥è‡ªäº ConfigMapã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥ Postgres å®¹å™¨æ¥æŸ¥çœ‹ CreateDB.sql æ–‡ä»¶çš„å†…å®¹ï¼ŒéªŒè¯è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦å’Œ ConfigMap çš„å†…å®¹ä¸€è‡´ã€‚ä½ å¯ä»¥ä½¿ç”¨ kubectl exec å‘½ä»¤è¿›å…¥åˆ° Postgres Deployment çš„å®¹å™¨å†…éƒ¨ï¼Œå¹¶ä½¿ç”¨ ls å’Œ cat å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶åŠå…¶å†…å®¹ï¼š</p><pre><code class=\"language-yaml\">$ kubectl exec -it $(kubectl get pods --selector=app=database -n example -o jsonpath=\"{.items[0].metadata.name}\") -n example -- sh\n# ls&nbsp; /docker-entrypoint-initdb.d\nCreateDB.sql\n# cat /docker-entrypoint-initdb.d/CreateDB.sql\nCREATE TABLE text (\n&nbsp; &nbsp; id serial PRIMARY KEY,\n&nbsp; &nbsp; text VARCHAR ( 100 ) UNIQUE NOT NULL\n);\n</code></pre><p>é€šè¿‡è¿”å›ç»“æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒConfigMap çš„å†…å®¹å·²ç»è¢«æŒ‚è½½ä¸ºæ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹ä¹Ÿç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚æ‰€ä»¥ï¼Œå½“ Postgres å·¥ä½œè´Ÿè½½å¯åŠ¨åï¼ŒSQL è¯­å¥å°†è¢«è‡ªåŠ¨è¿è¡Œï¼Œæ•°æ®è¡¨ç»“æ„ä¹Ÿä¼šè¢«åˆå§‹åŒ–ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªåŠ¨åˆå§‹åŒ– SQL åªæ˜¯ Postgres é•œåƒçš„è¡Œä¸ºï¼Œå¹¶ä¸” /docker-entrypoint-initdb.d ç›®å½•ä¹Ÿæ˜¯ Postgres é•œåƒçº¦å®šçš„ç”¨äºå­˜æ”¾è‡ªåŠ¨åˆå§‹åŒ– SQL çš„ç›®å½•ä½ç½®ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ ConfigMap çš„ç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯ã€‚ConfigMap å’Œä¹‹å‰æåˆ°çš„é…ç½®ä¸­å¿ƒä¹Ÿéå¸¸ç±»ä¼¼ï¼Œåœ¨å£°æ˜ ConfigMap é…ç½®ä¹‹åï¼Œåœ¨å·¥ä½œè´Ÿè½½ä¸­ä¹Ÿå¯ä»¥å°†å®ƒä»¥æ–‡ä»¶çš„æ–¹å¼æŒ‚è½½åˆ° Pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚æ­¤å¤–ï¼Œä»¥æ–‡ä»¶æŒ‚è½½çš„æ–¹å¼ä½¿ç”¨ ConfigMap ä¹Ÿæ”¯æŒçƒ­æ›´æ–°ï¼Œè¿™å°±æ„å‘³ç€æ›´æ–°é…ç½®ä¸éœ€è¦é‡å¯ Pod å°±èƒ½å®æ—¶ç”Ÿæ•ˆäº†ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å½“ä¸šåŠ¡åº”ç”¨éœ€è¦é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒConfigMap åº”å½“æ˜¯æˆ‘ä»¬çš„é¦–é€‰ç±»å‹ã€‚</strong></p><h3>Secret</h3><p>å†æ¥çœ‹æœ€åä¸€ç§é…ç½®æ–¹æ¡ˆï¼šSecretã€‚</p><p>Secret é¡¾åæ€ä¹‰æ˜¯å¯†é’¥çš„æ„æ€ï¼Œå®ƒä¸»è¦ç”¨æ¥ä¿å­˜ä¸€äº›åº”ç”¨çš„æœºå¯†ä¿¡æ¯ã€‚Secret å’Œ ConfigMap éå¸¸ç›¸ä¼¼ï¼Œå®ƒä¹Ÿèƒ½å¤Ÿä»¥æ–‡ä»¶çš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œä¸ºä¸šåŠ¡åº”ç”¨æä¾›é…ç½®æ–‡ä»¶ã€‚ä½†å®ƒåœ¨å†…å®¹å½¢å¼ä¸Šä¸ ConfigMap æœ‰æ‰€ä¸åŒï¼ŒConfigMap æ˜¯æ˜æ–‡ä¿å­˜ï¼ŒSecret æ˜¯åŠ å¯†çš„ã€‚</p><p>Secret çš„åŠ å¯†èƒ½åŠ›ç›¸å¯¹è–„å¼±ï¼Œå®ƒæ˜¯ä»¥ Base64 æ¥åŠ å¯†å†…å®¹çš„ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡ä¸­ä½¿ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚ä¸è¿‡ç”±äºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹ä¸€äº›â€œæœºå¯†â€çš„é…ç½®ä¿¡æ¯åšæƒé™æ§åˆ¶ï¼Œå¹¶ä¸” Kubernetes ä¹Ÿæ˜¯ä½¿ç”¨ Secret æ¥å­˜å‚¨é•œåƒæ‹‰å–å‡­æ®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç®€å•äº†è§£ Secret çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å°è¯•å°† pg-init-script ConfigMap ä¿®æ”¹ä¸º Secret ç±»å‹ï¼Œå¹¶åœ¨ Postgres Deployment ä¸­å¼•ç”¨ Secretï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦ä¹ ä½¿ç”¨ Secret ç±»å‹ã€‚</p><p>è¦å°† pg-init-script ConfigMap ä¿®æ”¹ä¸º Secret éå¸¸ç®€å•ï¼Œåªéœ€è¦å°† Kind ç±»å‹ä¿®æ”¹ä¸º Secretï¼Œå¹¶å°† Data çš„ Value å€¼è¿›è¡Œ Base64 ç¼–ç å³å¯ï¼š</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Secret\nmetadata:\n  name: pg-init-script\n  namespace: example\ntype: Opaque\ndata:\n  CreateDB.sql: |-\n    Q1JFQVRFIFRBQkxFIHRleHQgKAogICAgaWQgc2VyaWFsIFBSSU1BUlkgS0VZLAogICAgdGV4dCBWQVJDSEFSICggMTAwICkgVU5JUVVFIE5PVCBOVUxMCik7\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„å†…å®¹ä¿å­˜ä¸º secret.yaml æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ kubectl apply -f åº”ç”¨åˆ°é›†ç¾¤å†…ï¼š</p><pre><code class=\"language-yaml\">$ kubectl apply -f secret.yaml&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;\nsecret/pg-init-script created\n</code></pre><p>ç„¶åï¼Œä½¿ç”¨ kubectl edit ç›´æ¥ç¼–è¾‘é›†ç¾¤å†…çš„ Postgres Deployment å·¥ä½œè´Ÿè½½ï¼Œå°† volumes å­—æ®µä»åŸæ¥å¼•ç”¨ ConfigMap ä¿®æ”¹ä¸ºä» Secret å¼•ç”¨ï¼ŒSecretName ä¸º pg-init-scriptï¼š</p><pre><code class=\"language-yaml\">$ kubectl edit deployment postgres -n example\n......\nvolumes:\n&nbsp; - secret:\n&nbsp; &nbsp;   secretName: pg-init-script\n&nbsp; &nbsp; name: sqlscript\n......\n</code></pre><p>æ³¨æ„ï¼Œé€šè¿‡ kubectl edit deployment ä¿®æ”¹å·¥ä½œè´Ÿè½½æ—¶ï¼Œåœ¨ Mac å’Œ Linux ç¯å¢ƒä¸‹ä¼šè¿›å…¥ VIM ç¼–è¾‘å™¨ã€‚ä½ éœ€è¦è¾“å…¥â€œiâ€ è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¿®æ”¹å®Œæˆåï¼ŒæŒ‰ä¸‹ â€œESCâ€ é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥â€œ:wqâ€ ï¼Œä¿å­˜åé€€å‡ºã€‚æ­¤æ—¶ï¼Œä¿®æ”¹ä¼šå®æ—¶æäº¤åˆ° Kubernetes é›†ç¾¤ã€‚è€Œåœ¨ Windows ç¯å¢ƒä¸‹åˆ™å°†ä¼šå¼¹å‡ºè®°äº‹æœ¬ï¼Œä½ å¯ä»¥ç¼–è¾‘å†…å®¹ï¼Œä¿å­˜åå³å¯ç”Ÿæ•ˆã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬é‡æ–°è¿›å…¥ Postgres å®¹å™¨ï¼ŒéªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯å·²ç»æŠŠ Secret æŒ‚è½½åˆ°äº†æ–‡ä»¶ç³»ç»Ÿï¼š</p><pre><code class=\"language-yaml\">$ kubectl exec -it $(kubectl get pods --selector=app=database -n example -o jsonpath=\"{.items[0].metadata.name}\") -n example -- sh\n# ls docker-entrypoint-initdb.d\nCreateDB.sql\n# cat /docker-entrypoint-initdb.d/CreateDB.sql\nCREATE TABLE text (\n&nbsp; &nbsp; id serial PRIMARY KEY,\n&nbsp; &nbsp; text VARCHAR ( 100 ) UNIQUE NOT NULL\n);\n</code></pre><p>ä» cat å‘½ä»¤è¿”å›çš„å†…å®¹æˆ‘ä»¬å¯ä»¥ç¡®è®¤ï¼Œåœ¨å°† Secret æŒ‚è½½ä¸ºæ–‡ä»¶æ—¶ï¼ŒKubernetes è‡ªåŠ¨å°† Secret è¿›è¡Œäº† Base64 è§£ç æ“ä½œï¼Œè¿™ç§æ–¹å¼å’Œä½¿ç”¨ ConfigMap æŒ‚è½½æ–‡ä»¶çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><p>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ Secret æ˜¯ Opaque ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ç§å¸¸ç”¨äºä¸šåŠ¡åº”ç”¨ Base64 ç¼–ç çš„ç±»å‹ã€‚æ­¤å¤–ï¼ŒSecret è¿˜æœ‰ä¸‹é¢ä¸¤ç§ç±»å‹ã€‚</p><ul>\n<li>kubernetes.io/dockerconfigjson ï¼šå¯ä¾›å­˜å‚¨ Docker Registry ç§æœ‰ä»“åº“ä¿¡æ¯ï¼Œç”¨äºä¸º Kubernetes æä¾›é•œåƒæ‹‰å–å‡­æ®ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“æ—¶ï¼Œéœ€è¦åˆ›å»ºæ­¤ç±»å‹çš„ Secretã€‚</li>\n<li>kubernetes.io/service-account-token ï¼šå¯ä¾›å·¥ä½œè´Ÿè½½çš„ Service Account å¼•ç”¨ã€‚</li>\n</ul><p>å…¶ä¸­ï¼Œkubernetes.io/dockerconfigjson ç±»å‹çš„ Secret æˆ‘ä»¬åœ¨åç»­æ­å»ºç§æœ‰é•œåƒä»“åº“æ—¶è¿˜ä¼šè¿›ä¸€æ­¥ä»‹ç»ï¼Œè€Œè¯´åˆ° kubernetes.io/service-account-token ç±»å‹ï¼Œæ™®é€šçš„ä¸šåŠ¡åº”ç”¨å‡ ä¹ä¸ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥ç¨ä½œäº†è§£å³å¯ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨ Kubernetes ç¯å¢ƒä¸‹ä¸ºä¸šåŠ¡åº”ç”¨æä¾›é…ç½®ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸ºäº†å°†ä¸šåŠ¡å’Œé…ç½®è§£è€¦ï¼Œå¢å¼ºåº”ç”¨çš„å¯ç§»æ¤æ€§å’Œå®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¹¶ä¸æ¨èå°†é…ç½®æ–‡ä»¶å’Œä¸šåŠ¡ä¸€èµ·æ‰“åŒ…åˆ°é•œåƒä¸­ï¼Œè€Œæ˜¯å»ºè®®é€šè¿‡ Envã€ConfigMap å’Œ Secret æ¥ä¸ºä¸šåŠ¡æä¾›é…ç½®ä¿¡æ¯ã€‚</p><p>å…¶ä¸­ï¼ŒEnv å¯ä»¥ä¸º Pod æä¾›ç¯å¢ƒå˜é‡ï¼Œå®ƒä»¥é”®å€¼å¯¹çš„æ–¹å¼æ³¨å…¥ Podï¼Œå¯¹äºéœ€è¦ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®ä¿¡æ¯çš„ä¸šåŠ¡åº”ç”¨æ¥è¯´ï¼Œè¿™æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚</p><p>è€Œå¯¹äºéœ€è¦è¯»å–é…ç½®æ–‡ä»¶çš„ä¸šåŠ¡ï¼Œæˆ‘ä»¬æ¨èå°†é…ç½®æ–‡ä»¶å†…å®¹å†™å…¥åˆ° ConfigMapï¼Œå¹¶åœ¨å·¥ä½œè´Ÿè½½ä¸­ä»¥æ–‡ä»¶çš„æ–¹å¼å°† ConfigMap æŒ‚è½½åˆ° Pod çš„æ–‡ä»¶ç³»ç»Ÿå†…ï¼Œä»¥æ­¤æ¥ä¸ºä¸šåŠ¡æä¾›é…ç½®ã€‚ConfigMap çš„å†…å®¹å¯ä»¥æ˜¯é”®å€¼å¯¹ï¼Œä¹Ÿå¯ä»¥æ˜¯çº¯æ–‡æœ¬å†…å®¹ï¼Œæ— è®ºä½ çš„ä¸šåŠ¡åº”ç”¨é…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œç†è®ºä¸Šæ¥è¯´éƒ½é€‚ç”¨ã€‚</p><p>ä½¿ç”¨ ConfigMap çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºå”¯ä¸€çš„é…ç½®ä¿¡æ¯æ¥æºï¼Œæˆ‘ä»¬ç®¡ç†èµ·é…ç½®æ¥éå¸¸æ–¹ä¾¿ã€‚æ­¤å¤–ï¼ŒConfigMap è¿˜æ”¯æŒçƒ­åŠ è½½ï¼Œå¯¹ä¸šåŠ¡åº”ç”¨éå¸¸å‹å¥½ã€‚</p><p>æœ€åå…³äº Secretï¼Œæˆ‘ä»¬ä¸€å…±ä»‹ç»äº†ä¸‰ç§ç±»å‹ã€‚å…¶ä¸­ Opaque ç±»å‹æ˜¯ä¸šåŠ¡åº”ç”¨æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œå®é™…ä¸Šå®ƒåœ¨ä½¿ç”¨çš„æ—¶å€™å’Œ ConfigMap å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œåªæ˜¯ Secret çš„å†…å®¹æ˜¯ Base64 ç¼–ç çš„ã€‚è€Œ kubernetes.io/dockerconfigjson ç±»å‹å¯ä»¥ä¸º Kubernetes æä¾›ç§æœ‰ä»“åº“æ‹‰å–é•œåƒçš„å‡­æ®ï¼Œæˆ‘ä»¬åé¢çš„è¯¾ç¨‹è¿˜ä¼šè¿›è¡Œä»‹ç»ã€‚</p><h2>è¯¾åé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸¤é“è¯¾åé¢˜å§ã€‚</p><ol>\n<li>ä¸º Deployment æŒ‡å®š Env ç¯å¢ƒå˜é‡é™¤äº†é€šè¿‡å£°æ˜å•ä¸ªé”®å€¼å¯¹ä»¥å¤–ï¼Œè¿˜å¯ä»¥å¼•ç”¨ ConfigMapã€‚è¯·ä½ æŸ¥é˜…ç›¸å…³èµ„æ–™ï¼Œç»“åˆæœ¬èŠ‚è¯¾æ‰€å­¦çš„å†…å®¹ï¼Œå°è¯•å†™å‡ºå¯¹åº”çš„ ConfigMap å’Œ Deployment æ ·ä¾‹ã€‚ï¼ˆæç¤ºï¼šDeployment çš„ envFrom å­—æ®µã€‚ï¼‰</li>\n<li>å¯¹äºä¸€äº›å¤æ‚çš„ä¸šåŠ¡åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œæ‰‹åŠ¨å°†å†…å®¹è¿ç§»åˆ° ConfigMap å¯èƒ½å¹¶ä¸å®¹æ˜“ï¼Œè¯·ä½ æŸ¥é˜…ç›¸å…³èµ„æ–™ï¼Œå¹¶å°è¯•ä½¿ç”¨ kubectl create configmap --from-file ä»å·²æœ‰çš„é…ç½®æ–‡ä»¶åˆ›å»º ConfigMapã€‚ï¼ˆæç¤ºï¼šä½ å¯ä»¥é€šè¿‡ kubectl create configmap --help æ¥è·å¾—ä¸€äº›ç¤ºä¾‹ä¿¡æ¯ã€‚ï¼‰</li>\n</ol><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":365198,"user_name":"é»„å ƒå¥","can_delete":false,"product_type":"c1","uid":2037522,"ip_address":"å¹¿ä¸œ","ucode":"B4AD5250A41B3A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/YbUxEV3741vKZAiasOXggWucQbmicJwIjg3HDE58oyibYXbSop9QQFqZ7X6OhynDoo6rDHwzK8njSeJjN9hx3pJXg/132","comment_is_top":false,"comment_ctime":1672231003,"is_pvip":false,"replies":[{"id":133032,"content":"æ˜¯çš„ï¼Œéå¸¸æ­£ç¡®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672281261,"ip_address":"å¹¿ä¸œ","comment_id":365198,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"åªæœ‰é€šè¿‡ç›®å½•æŒ‚è½½çš„configmapæ‰å…·å¤‡çƒ­æ›´æ–°èƒ½åŠ›ï¼Œå…¶ä½™é€šè¿‡ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡subPathæŒ‚è½½çš„æ–‡ä»¶éƒ½ä¸èƒ½åŠ¨æ€æ›´æ–°ã€‚ å¹¶ä¸”æœ‰ä¸€ä¸ªå»¶è¿Ÿã€‚ä¸€èˆ¬å°±æ˜¯kubeletçš„å®šæ—¶æ›´æ–°é¢‘ç‡","like_count":4,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597847,"discussion_content":"æ˜¯çš„ï¼Œéå¸¸æ­£ç¡®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672281261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365257,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"å¹¿ä¸œ","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1672301878,"is_pvip":true,"replies":[{"id":133047,"content":"å¾ˆå®Œæ•´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672303361,"ip_address":"å¹¿ä¸œ","comment_id":365257,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å¤§è‡´åˆ†3ç§ä½¿ç”¨æ–¹å¼ï¼Œå®˜ç½‘æ–‡æ¡£ä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†\n1.ä½¿ç”¨ ConfigMap æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡ï¼š\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;#define-container-environment-variables-using-configmap-data\n2.å°† ConfigMap ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡ï¼š\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;#configure-all-key-value-pairs-in-a-configmap-as-container-environment-variables\n3.åœ¨ Pod å‘½ä»¤ä¸­ä½¿ç”¨ ConfigMap å®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼š\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;#use-configmap-defined-environment-variables-in-pod-commands\n\nä½¿ç”¨ kubectl create configmap åˆ›å»º ConfigMap\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;#create-a-configmap-using-kubectl-create-configmap","like_count":3,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597894,"discussion_content":"å¾ˆå®Œæ•´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672303361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365173,"user_name":"PeiHongbing","can_delete":false,"product_type":"c1","uid":1635932,"ip_address":"å¹¿ä¸œ","ucode":"F115AD8740B0DC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSEVQdSoW2SwDic2U3uIibsa1bH3qSSzCvYTN5xHC5ppGDS2DBxL1KcbuxZ6Ez6kyOGj1F4toiaiazBA/132","comment_is_top":false,"comment_ctime":1672214054,"is_pvip":false,"replies":[{"id":132987,"content":"éå¸¸æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672223349,"ip_address":"å¹¿ä¸œ","comment_id":365173,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è¯¾åé¢˜1å¦‚ä¸‹ï¼š\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: backend-env\ndata:\n  DATABASE_URI: pg-service\n  DATABASE_USERNAME: postgres\n  DATABASE_PASSWORD: postgres\n\n---\n\napiVersion: apps&#47;v1\nkind: Deployment\nmetadata:\n  name: backend\n  labels:\n    app: backend\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: backend\n  template:\n    metadata:\n      labels:\n        app: backend\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999&#47;backend:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 5000\n        envFrom:\n        - configMapRef:\n            name: backend-env","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597774,"discussion_content":"éå¸¸æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672223350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1635932,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSEVQdSoW2SwDic2U3uIibsa1bH3qSSzCvYTN5xHC5ppGDS2DBxL1KcbuxZ6Ez6kyOGj1F4toiaiazBA/132","nickname":"PeiHongbing","note":"","ucode":"F115AD8740B0DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":597840,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672276679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":597774,"ip_address":"è¾½å®","group_id":0},"score":597840,"extra":""}]}]},{"had_liked":false,"id":366433,"user_name":"å¤§åœ†åœ†é’å™¬","can_delete":false,"product_type":"c1","uid":1703403,"ip_address":"é™•è¥¿","ucode":"2D1D83BA371776","user_header":"https://static001.geekbang.org/account/avatar/00/19/fd/eb/5e3bfed5.jpg","comment_is_top":false,"comment_ctime":1673777661,"is_pvip":false,"replies":[{"id":133518,"content":"æ­£ç¡®ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673785850,"ip_address":"å¹¿ä¸œ","comment_id":366433,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"Create secret for PSQL init sql scritps, \n\nkubectl create secret generic ads-db-secret --from-file createdb.sql  --dry-run=client -o yaml\napiVersion: v1\ndata:\n  createdb.sql: Q1JFQVRFIFRBQkxFIHRleHQgKAogICAgaWQgc2VyaWFsIFBSSU1BUlkgS0VZLAogICAgdGV4dCBWQVJDSEFSICggMTAwICkgVU5JUVVFIE5PVCBOVUxMCik7Cg==\nkind: Secret\nmetadata:\n  creationTimestamp: null\n  name: ads-db-secret\n","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599781,"discussion_content":"æ­£ç¡®ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673785850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379805,"user_name":"RRR","can_delete":false,"product_type":"c1","uid":1014991,"ip_address":"æ–°åŠ å¡","ucode":"F32A579D201EC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/cf/d5382404.jpg","comment_is_top":false,"comment_ctime":1692545323,"is_pvip":false,"replies":[{"id":138359,"content":"æˆ–è€…é€šè¿‡å·¥ä½œè´Ÿè½½çš„ env å­—æ®µè¦†å†™","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1692598569,"ip_address":"å¹¿ä¸œ","comment_id":379805,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"åªæœ‰é€šè¿‡ volume æŒ‚è½½çš„ configmap æ‰èƒ½å®æ—¶æ›´æ–°ï¼Œè¢«å·²è¿è¡Œçš„å®¹å™¨æ„ŸçŸ¥åˆ°ã€‚\n\nå¦‚æœ env æ–¹å¼ï¼Œåªèƒ½é‡æ–°æ„å»ºé•œåƒäº†","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626145,"discussion_content":"æˆ–è€…é€šè¿‡å·¥ä½œè´Ÿè½½çš„ env å­—æ®µè¦†å†™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692598570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370689,"user_name":"quietwater","can_delete":false,"product_type":"c1","uid":1055029,"ip_address":"åŒ—äº¬","ucode":"C25E2CD356D3F9","user_header":"https://static001.geekbang.org/account/avatar/00/10/19/35/be8372be.jpg","comment_is_top":false,"comment_ctime":1679110085,"is_pvip":false,"replies":[{"id":135264,"content":"å¯ä»¥é€šè¿‡åŠ å¯† Secret æ¥å®ç°ï¼Œå‚è€ƒç¬¬29è®²çš„å†…å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1679206075,"ip_address":"å¹¿ä¸œ","comment_id":370689,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è€å¸ˆSecretæ˜¯Base64ç¼–ç ï¼Œå®‰å…¨æ€§ä½ã€‚åƒæ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç è¿™æ ·è¦æ±‚é«˜å®‰å…¨çš„é…ç½®ä¿¡æ¯ï¼Œæœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ³•å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609776,"discussion_content":"å¯ä»¥é€šè¿‡åŠ å¯† Secret æ¥å®ç°ï¼Œå‚è€ƒç¬¬29è®²çš„å†…å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679206075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368747,"user_name":"èŒƒé£æ‰¬","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"ä¸Šæµ·","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b3edcc09.jpg","comment_is_top":false,"comment_ctime":1676641523,"is_pvip":false,"replies":[{"id":134303,"content":"æ„Ÿè°¢æŒ‡æ­£ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676648431,"ip_address":"å¹¿ä¸œ","comment_id":368747,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æœ‰å°çš„æ‹¼å†™é”™è¯¯ï¼šâ€œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ›´ä¸Šå±‚çš„å·¥ä½œè´Ÿè½½ï¼Œä¾‹å¦‚ Daeploymentâ€","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605478,"discussion_content":"æ„Ÿè°¢æŒ‡æ­£ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676648431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365856,"user_name":"æå¤š","can_delete":false,"product_type":"c1","uid":2806068,"ip_address":"å¹¿ä¸œ","ucode":"974E2C405C2CE7","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg","comment_is_top":false,"comment_ctime":1673151861,"is_pvip":false,"replies":[{"id":133279,"content":"æ­£ç¡®ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673191147,"ip_address":"å¹¿ä¸œ","comment_id":365856,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è¯¾åé¢˜2ï¼š\n\n&#47;&#47; ç›´æ¥é€šè¿‡æ–‡ä»¶ç”Ÿæˆ\n# cat local-config.yaml\nservice=conf\nport=8081\n\n# k create configmap local-config --from-file=local-config.yaml\nconfigmap&#47;local-config created\n\n# k get configmap local-config -o yaml\napiVersion: v1\ndata:\n  local-config.yaml: |\n    service=conf\n    port=8081\nkind: ConfigMap\nmetadata:\n  creationTimestamp: &quot;2023-01-08T04:09:55Z&quot;\n  name: local-config\n  namespace: default\n  resourceVersion: &quot;372705&quot;\n  uid: c88ae816-99f1-4d4f-8fe5-2a528916bde7\n\n&#47;&#47; æ­¤å¤–ï¼Œè¿˜æœ‰åˆ©ç”¨ kustomization ï¼Œä»æ–‡ä»¶ä¸­ç”Ÿæˆé…ç½®ã€‚æˆ‘ç†è§£çš„ kustomization ç±»ä¼¼äº helmï¼Œå¯ä»¥ç”¨æ¨¡æ¿å¯¹é…ç½®è¿›è¡Œç»„è£…æˆ–è€…ä¿®æ”¹ã€‚è¿™é‡Œå°±ä¸è¿‡å¤šæ¼”ç¤º kustomize äº†ï¼Œåªæ˜¯æ„Ÿè§‰ ä» kustomize ç”Ÿæˆé…ç½®æ˜¯ä¸æ˜¯æŒºé‡è¦çš„ï¼Œæˆ‘ä¹Ÿæ²¡åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨è¿‡ã€‚\n\n# cat &lt;&lt;EOF &gt;.&#47;kustomization.yaml\nconfigMapGenerator:\n- name: local-game-config\n  files:\n  - local-config.yaml\nEOF\n\n# k apply -k .\nconfigmap&#47;local-game-config-c65b9b9f5t created\n\np# k get configmap local-game-config-c65b9b9f5t  -o yaml\napiVersion: v1\ndata:\n  local-config.yaml: |\n    service=conf\n    port=8081\nkind: ConfigMap\nmetadata:\n  annotations:\n    kubectl.kubernetes.io&#47;last-applied-configuration: |\n      {&quot;apiVersion&quot;:&quot;v1&quot;,&quot;data&quot;:{&quot;local-config.yaml&quot;:&quot;service=conf\\nport=8081\\n&quot;},&quot;kind&quot;:&quot;ConfigMap&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;local-game-config-c65b9b9f5t&quot;,&quot;namespace&quot;:&quot;default&quot;}}\n  creationTimestamp: &quot;2023-01-08T04:12:45Z&quot;\n  name: local-game-config-c65b9b9f5t\n  namespace: default\n  resourceVersion: &quot;373080&quot;\n  uid: 33feff4b-eec2-45db-ad92-77065f67fb22\n\nå‚è€ƒï¼šhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;#create-a-configmap-using-kubectl-create-configmap\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598902,"discussion_content":"æ­£ç¡®ğŸ‘ğŸ»","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673191147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365161,"user_name":"PeiHongbing","can_delete":false,"product_type":"c1","uid":1635932,"ip_address":"å¹¿ä¸œ","ucode":"F115AD8740B0DC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSEVQdSoW2SwDic2U3uIibsa1bH3qSSzCvYTN5xHC5ppGDS2DBxL1KcbuxZ6Ez6kyOGj1F4toiaiazBA/132","comment_is_top":false,"comment_ctime":1672205899,"is_pvip":false,"replies":[{"id":132985,"content":"æ˜¯çš„ï¼Œå·²ä¿®æ­£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672213005,"ip_address":"å¹¿ä¸œ","comment_id":365161,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"app.pyä¸­çš„å¦‚ä¸‹ä»£ç æ˜¯ä¸æ˜¯å†™é”™äº†ï¼š\n\ndb_username = os.environ.get(&#39;DATABASE_URI&#39;)\ndb_password = os.environ.get(&#39;DATABASE_URI&#39;)\n\ndb_usernameå¯¹åº”DATABASE_USERNAME\ndb_passwordå¯¹åº”DATABASE_PASSWORD\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597759,"discussion_content":"æ˜¯çš„ï¼Œå·²ä¿®æ­£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672213005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365146,"user_name":"æ©™æ±","can_delete":false,"product_type":"c1","uid":1332257,"ip_address":"å¹¿ä¸œ","ucode":"EC3FF10D708C9D","user_header":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","comment_is_top":false,"comment_ctime":1672194202,"is_pvip":false,"replies":[{"id":132975,"content":"ConfigMap ä½œä¸ºå­è·¯å¾„æŒ‚è½½ä¸ä¼šå®æ—¶æ›´æ–°ï¼Œå¦å¤–ä½œä¸º Env ä¹Ÿæ— æ³•å®æ—¶æ›´æ–°ï¼Œéœ€è¦é‡å¯ Podã€‚\n\nå®æ—¶æ›´æ–°è¿˜ä¾èµ–ä¸šåŠ¡ç¨‹åºï¼Œä¸šåŠ¡éœ€è¦èƒ½æ„ŸçŸ¥åˆ°é…ç½®å˜æ›´å¹¶è‡ªåŠ¨è½½å…¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1275456,"ctime":1672199276,"ip_address":"å¹¿ä¸œ","comment_id":365146,"utype":1}],"discussion_count":7,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è®°å¾—configmapåœ¨ç›¸åº”ä¿®æ”¹äº†æŸäº›ä¿¡æ¯åï¼Œçƒ­æ›´æ–°ä¼šæœ‰é—®é¢˜ã€‚å¿˜è®°æ˜¯å•¥äº†ï¼Œå¦‚æœçƒ­æ›´æ–°å¤±æ•ˆè®°å¾—å»æœä¸‹ï¼Œåˆ«ä¸€ç›´æ­»å®ˆconfigmapçƒ­æ›´æ–°æ¥å›éƒ¨ç½²åˆ é™¤","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597734,"discussion_content":"ConfigMap ä½œä¸ºå­è·¯å¾„æŒ‚è½½ä¸ä¼šå®æ—¶æ›´æ–°ï¼Œå¦å¤–ä½œä¸º Env ä¹Ÿæ— æ³•å®æ—¶æ›´æ–°ï¼Œéœ€è¦é‡å¯ Podã€‚\n\nå®æ—¶æ›´æ–°è¿˜ä¾èµ–ä¸šåŠ¡ç¨‹åºï¼Œä¸šåŠ¡éœ€è¦èƒ½æ„ŸçŸ¥åˆ°é…ç½®å˜æ›´å¹¶è‡ªåŠ¨è½½å…¥ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1672199276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1332257,"avatar":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","nickname":"æ©™æ±","note":"","ucode":"EC3FF10D708C9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":597735,"discussion_content":"ç‰›çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672199334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":597734,"ip_address":"åŒ—äº¬","group_id":0},"score":597735,"extra":""}]},{"author":{"id":1336328,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","nickname":"äº‰å…‰ Alan","note":"","ucode":"338534F909AF03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599153,"discussion_content":"cmä¼šè‡ªåŠ¨æ›´æ–°åˆ°å®¹å™¨å†…ï¼Œä¸šåŠ¡æƒ³çƒ­æ›´å°±ç›‘å¬ä¸‹é…ç½®æ–‡ä»¶å˜åŒ–äº‹ä»¶è¿›è¡Œå¯¹åº”å¤„ç†ä¸å°±è¡Œäº†ï¼Ÿç›¸æ¯”è¾ƒé›†æˆapolloç­‰çš„æ”¹é€ æ„Ÿè§‰ä»£ä»·æ›´å°ï¼Œä»¥æ–‡ä»¶æ¥è§£è€¦æ„Ÿè§‰ä¹Ÿè¿˜æ›´çµæ´»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673357249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1095291,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b6/7b/bebb4587.jpg","nickname":"Impressw","note":"","ucode":"536F818BEC8A93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598570,"discussion_content":"configMap çƒ­æ›´æ–°å¯ä»¥ç”¨ reloader.yaml ï¼Œæˆ–è€…sidercaræ–¹å¼æ¥å®ç°å¯¹podçš„é‡å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672911136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1332257,"avatar":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","nickname":"æ©™æ±","note":"","ucode":"EC3FF10D708C9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597839,"discussion_content":"è¡¥å……ä¸‹ æ ¹æ®ä½œè€…å›å¤æŸ¥äº†ä¸‹ï¼Œå­è·¯å¾„å¯¹åº”é…ç½®æ˜¯subpath æˆ‘é¡¹ç›®ä¸­å°±æ˜¯è¿™ä¹ˆå†™çš„ï¼Œå¦‚æœä½ æƒ³å®æ—¶æ›´æ–°å³éœ€è¦é¡¹ç›®æ”¯æŒä¹Ÿéœ€è¦ç›¸åº”çš„ä¸­é—´ä»¶æ”¯æŒï¼ŒåŒæ—¶å¼€å‘äººå‘˜è¿˜å¾—æ„¿æ„æ”¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672276258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1023930,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/ba/5a9cb72f.jpg","nickname":"ä¸¹æ«æŸ“ç§‹è‰²","note":"","ucode":"4E9A35439B615F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597829,"discussion_content":"è¿™ä¸ªå°±éœ€è¦çœŸæ­£æ„ä¹‰ä¸Šçš„â€œé…ç½®ä¸­å¿ƒâ€äº†å§ï¼Œæ¯”å¦‚Apollo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672243506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"æ— åæ— å§“","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597736,"discussion_content":"æ„Ÿè§‰è¿™é‡Œé¢æ˜¯ä¸ªå‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672199402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388409,"user_name":"BertGeek","can_delete":false,"product_type":"c1","uid":1452799,"ip_address":"é™•è¥¿","ucode":"8E1D72C9F9778C","user_header":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","comment_is_top":false,"comment_ctime":1710144876,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"1.  ConfigMap å’Œ Deployment éƒ¨ç½²backend åº”ç”¨\nå‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š\nå°† ConfigMap ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: backend-env-config\ndata:\n  DATABASE_URI: pg-service\n  DATABASE_USERNAME: postgres\n  DATABASE_PASSWORD: postgres\n  \n---\napiVersion: apps&#47;v1\nkind: Deployment\nmetadata:\n  name: backend\n  labels:\n    app: backend\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: backend\n  template:\n    metadata:\n      labels:\n        app: backend\n    spec:\n      containers:\n      - name: flask-backend\n        image: lyzhang1999&#47;backend:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 5000\n        envFrom:\n        - configMapRef:\n            name: backend-env-config\n        resources:\n          requests:\n            memory: &quot;128Mi&quot;\n            cpu: &quot;128m&quot;\n          limits:\n            memory: &quot;256Mi&quot;\n            cpu: &quot;256m&quot;\n        readinessProbe: \n          httpGet:\n            path: &#47;healthy\n            port: 5000\n            scheme: HTTP\n          initialDelaySeconds: 10\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n        livenessProbe: \n          httpGet:\n            path: &#47;healthy\n            port: 5000\n            scheme: HTTP\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n        startupProbe: \n          httpGet:\n            path: &#47;healthy\n            port: 5000\n            scheme: HTTP\n          initialDelaySeconds: 10\n          failureThreshold: 5\n          periodSeconds: 10\n          successThreshold: 1\n          timeoutSeconds: 1\n\n\n2. åŸºäºæ–‡ä»¶åˆ›å»º ConfigMap\nå‚è€ƒå®˜ç½‘ï¼š\nåŸºäºæ–‡ä»¶åˆ›å»º ConfigMap\nhttps:&#47;&#47;kubernetes.io&#47;zh-cn&#47;docs&#47;tasks&#47;configure-pod-container&#47;configure-pod-configmap&#47;\nkubectl create configmap message-cmp-yaml --from-file application.yml \n","like_count":0}]}