{"id":113809,"title":"44 | 理解IO_WAIT：I/O性能到底是怎么回事儿？","content":"<p>在专栏一开始的时候，我和你说过，在计算机组成原理这门课里面，很多设计的核心思路，都来源于性能。在前面讲解CPU的时候，相信你已经有了切身的感受了。</p><p>大部分程序员开发的都是应用系统。在开发应用系统的时候，我们遇到的性能瓶颈大部分都在I/O上。在<a href=\"https://time.geekbang.org/column/article/107447\">第36讲</a>讲解局部性原理的时候，我们一起看了通过把内存当作是缓存，来提升系统的整体性能。在<a href=\"https://time.geekbang.org/column/article/107477\">第37讲</a>讲解CPU Cache的时候，我们一起看了CPU Cache和主内存之间性能的巨大差异。</p><p>然而，我们知道，并不是所有问题都能靠利用内存或者CPU Cache做一层缓存来解决。特别是在这个“大数据”的时代。我们在硬盘上存储了越来越多的数据，一个MySQL数据库的单表有个几千万条记录，早已经不算是什么罕见现象了。这也就意味着，用内存当缓存，存储空间是不够用的。大部分时间，我们的请求还是要打到硬盘上。那么，这一讲我们就来看看硬盘I/O性能的事儿。</p><h2>IO性能、顺序访问和随机访问</h2><p>如果去看硬盘厂商的性能报告，通常你会看到两个指标。一个是<strong>响应时间</strong>（Response Time），另一个叫作<strong>数据传输率</strong>（Data Transfer Rate）。没错，这个和我们在专栏的一开始讲的CPU的性能一样，前面那个就是响应时间，后面那个就是吞吐率了。</p><!-- [[[read_end]]] --><p>我们先来看一看后面这个指标，数据传输率。</p><p>我们现在常用的硬盘有两种。一种是HDD硬盘，也就是我们常说的机械硬盘。另一种是SSD硬盘，一般也被叫作固态硬盘。现在的HDD硬盘，用的是SATA 3.0的接口。而SSD硬盘呢，通常会用两种接口，一部分用的也是SATA 3.0的接口；另一部分呢，用的是PCI Express的接口。</p><p>现在我们常用的SATA 3.0的接口，带宽是6Gb/s。这里的“b”是比特。这个带宽相当于每秒可以传输768MB的数据。而我们日常用的HDD硬盘的数据传输率，差不多在200MB/s左右。</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/ff/a227f1a299a3774c4e1067436decf7ff.png?wh=498*464\" alt=\"\"></p><center><span class=\"reference\">这是在我自己的电脑上，运行AS SSD测算SATA接口SSD硬盘性能的结果，第一行的Seq就是顺序读写硬盘得到的数据传输率的实际结果</span></center><p>当我们换成SSD的硬盘，性能自然会好上不少。比如，我最近刚把自己电脑的HDD硬盘，换成了一块Crucial MX500的SSD硬盘。它的数据传输速率能到差不多500MB/s，比HDD的硬盘快了一倍不止。不过SATA接口的硬盘，差不多到这个速度，性能也就到顶了。因为SATA接口的速度也就这么快。</p><p><img src=\"https://static001.geekbang.org/resource/image/57/a4/57443821861f73e4d04ab4d64e6908a4.png?wh=496*468\" alt=\"\"></p><p>不过，实际SSD硬盘能够更快，所以我们可以换用PCI Express的接口。我自己电脑的系统盘就是一块使用了PCI Express的三星SSD硬盘。它的数据传输率，在读取的时候就能做到2GB/s左右，差不多是HDD硬盘的10倍，而在写入的时候也能有1.2GB/s。</p><p>除了数据传输率这个吞吐率指标，另一个我们关心的指标响应时间，其实也可以在AS SSD的测试结果里面看到，就是这里面的Acc.Time指标。</p><p>这个指标，其实就是程序发起一个硬盘的写入请求，直到这个请求返回的时间。可以看到，在上面的两块SSD硬盘上，大概时间都是在几十微秒这个级别。如果你去测试一块HDD的硬盘，通常会在几毫秒到十几毫秒这个级别。这个性能的差异，就不是10倍了，而是在几十倍，乃至几百倍。</p><p>光看响应时间和吞吐率这两个指标，似乎我们的硬盘性能很不错。即使是廉价的HDD硬盘，接收一个来自CPU的请求，也能够在几毫秒时间返回。一秒钟能够传输的数据，也有200MB左右。你想一想，我们平时往数据库里写入一条记录，也就是1KB左右的大小。我们拿200MB去除以1KB，那差不多每秒钟可以插入20万条数据呢。但是这个计算出来的数字，似乎和我们日常的经验不符合啊？这又是为什么呢？</p><p>答案就来自于硬盘的读写。在<strong>顺序读写</strong>和<strong>随机读写</strong>的情况下，硬盘的性能是完全不同的。</p><p>我们回头看一下上面的AS SSD的性能指标。你会看到，里面有一个“4K”的指标。这个指标是什么意思呢？它其实就是我们的程序，去随机读取磁盘上某一个4KB大小的数据，一秒之内可以读取到多少数据。</p><p>你会发现，在这个指标上，我们使用SATA 3.0接口的硬盘和PCI Express接口的硬盘，性能差异变得很小。这是因为，在这个时候，接口本身的速度已经不是我们硬盘访问速度的瓶颈了。更重要的是，你会发现，即使我们用PCI Express的接口，在随机读写的时候，数据传输率也只能到40MB/s左右，是顺序读写情况下的几十分之一。</p><p>我们拿这个40MB/s和一次读取4KB的数据算一下。</p><center>40MB / 4KB = 10,000</center><p>也就是说，一秒之内，这块SSD硬盘可以随机读取1万次的4KB的数据。如果是写入的话呢，会更多一些，90MB /4KB 差不多是2万多次。</p><p>这个每秒读写的次数，我们称之为<a href=\"https://en.wikipedia.org/wiki/IOPS\">IOPS</a>，也就是每秒输入输出操作的次数。事实上，比起响应时间，我们更关注IOPS这个性能指标。IOPS和DTR（Data Transfer Rate，数据传输率）才是输入输出性能的核心指标。</p><p>这是因为，我们在实际的应用开发当中，对于数据的访问，更多的是随机读写，而不是顺序读写。我们平时所说的服务器承受的“并发”，其实是在说，会有很多个不同的进程和请求来访问服务器。自然，它们在硬盘上访问的数据，是很难顺序放在一起的。这种情况下，随机读写的IOPS才是服务器性能的核心指标。</p><p>好了，回到我们引出IOPS这个问题的HDD硬盘。我现在要问你了，那一块HDD硬盘能够承受的IOPS是多少呢？其实我们应该已经在第36讲说过答案了。</p><p>HDD硬盘的IOPS通常也就在100左右，而不是在20万次。在后面讲解机械硬盘的原理和性能优化的时候，我们还会再来一起看一看，这个100是怎么来的，以及我们可以有哪些优化的手段。</p><h2>如何定位IO_WAIT？</h2><p>我们看到，即使是用上了PCI Express接口的SSD硬盘，IOPS也就是在2万左右。而我们的CPU的主频通常在2GHz以上，也就是每秒可以做20亿次操作。</p><p>即使CPU向硬盘发起一条读写指令，需要很多个时钟周期，一秒钟CPU能够执行的指令数，和我们硬盘能够进行的操作数，也有好几个数量级的差异。这也是为什么，我们在应用开发的时候往往会说“性能瓶颈在I/O上”。因为很多时候，CPU指令发出去之后，不得不去“等”我们的I/O操作完成，才能进行下一步的操作。</p><p>那么，在实际遇到服务端程序的性能问题的时候，我们怎么知道这个问题是不是来自于CPU等I/O来完成操作呢？别着急，我们接下来，就通过top和iostat这些命令，一起来看看CPU到底有没有在等待io操作。</p><pre><code># top\n</code></pre><p>你一定在Linux下用过 top 命令。对于很多刚刚入门Linux的同学，会用top去看服务的负载，也就是load average。不过，在top命令里面，我们一样可以看到CPU是否在等待IO操作完成。</p><pre><code>top - 06:26:30 up 4 days, 53 min,  1 user,  load average: 0.79, 0.69, 0.65\nTasks: 204 total,   1 running, 203 sleeping,   0 stopped,   0 zombie\n%Cpu(s): 20.0 us,  1.7 sy,  0.0 ni, 77.7 id,  0.0 wa,  0.0 hi,  0.7 si,  0.0 st\nKiB Mem:   7679792 total,  6646248 used,  1033544 free,   251688 buffers\nKiB Swap:        0 total,        0 used,        0 free.  4115536 cached Mem\n</code></pre><center><span class=\"reference\">top命令的输出结果</span></center><p>在top命令的输出结果里面，有一行是以%CPU开头的。这一行里，有一个叫作wa的指标，这个指标就代表着iowait，也就是CPU等待IO完成操作花费的时间占CPU的百分比。下一次，当你自己的服务器遇到性能瓶颈，load很大的时候，你就可以通过top看一看这个指标。</p><p>知道了iowait很大，那么我们就要去看一看，实际的I/O操作情况是什么样的。这个时候，你就可以去用iostat这个命令了。我们输入“iostat”，就能够看到实际的硬盘读写情况。</p><pre><code>$ iostat\n</code></pre><pre><code>avg-cpu:  %user   %nice %system %iowait  %steal   %idle\n          17.02    0.01    2.18    0.04    0.00   80.76\nDevice:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn\nsda               1.81         2.02        30.87     706768   10777408\n</code></pre><p>你会看到，这个命令里，不仅有iowait这个CPU等待时间的百分比，还有一些更加具体的指标了，并且它还是按照你机器上安装的多块不同的硬盘划分的。</p><p>这里的tps指标，其实就对应着我们上面所说的硬盘的IOPS性能。而kB_read/s和kB_wrtn/s指标，就对应着我们的数据传输率的指标。</p><p>知道实际硬盘读写的tps、kB_read/s和kb_wrtn/s的指标，我们基本上可以判断出，机器的性能是不是卡在I/O上了。那么，接下来，我们就是要找出到底是哪一个进程是这些I/O读写的来源了。这个时候，你需要“iotop”这个命令。</p><pre><code>$ iotop\n</code></pre><pre><code>Total DISK READ :       0.00 B/s | Total DISK WRITE :      15.75 K/s\nActual DISK READ:       0.00 B/s | Actual DISK WRITE:      35.44 K/s\n  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND                                             \n  104 be/3 root        0.00 B/s    7.88 K/s  0.00 %  0.18 % [jbd2/sda1-8]\n  383 be/4 root        0.00 B/s    3.94 K/s  0.00 %  0.00 % rsyslogd -n [rs:main Q:Reg]\n 1514 be/4 www-data    0.00 B/s    3.94 K/s  0.00 %  0.00 % nginx: worker process\n</code></pre><p>通过iotop这个命令，你可以看到具体是哪一个进程实际占用了大量I/O，那么你就可以有的放矢，去优化对应的程序了。</p><p>上面的这些示例里，不管是wa也好，tps也好，它们都很小。那么，接下来，我就给你用Linux下，用stress命令，来模拟一个高I/O复杂的情况，来看看这个时候的iowait是怎么样的。</p><p>我在一台云平台上的单个CPU核心的机器上输入“stress -i 2”，让stress这个程序模拟两个进程不停地从内存里往硬盘上写数据。</p><pre><code>$ stress -i 2\n</code></pre><pre><code>$ top\n</code></pre><p>你会看到，在top的输出里面，CPU就有大量的sy和wa，也就是系统调用和iowait。</p><pre><code>top - 06:56:02 up 3 days, 19:34,  2 users,  load average: 5.99, 1.82, 0.63\nTasks:  88 total,   3 running,  85 sleeping,   0 stopped,   0 zombie\n%Cpu(s):  3.0 us, 29.9 sy,  0.0 ni,  0.0 id, 67.2 wa,  0.0 hi,  0.0 si,  0.0 st\nKiB Mem :  1741304 total,  1004404 free,   307152 used,   429748 buff/cache\nKiB Swap:        0 total,        0 free,        0 used.  1245700 avail Mem \n</code></pre><pre><code>$ iostat 2 5\n</code></pre><p>如果我们通过iostat，查看硬盘的I/O，你会看到，里面的tps很快就到了4万左右，占满了对应硬盘的IOPS。</p><pre><code>avg-cpu:  %user   %nice %system %iowait  %steal   %idle\n           5.03    0.00   67.92   27.04    0.00    0.00\nDevice:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn\nsda           39762.26         0.00         0.00          0          0\n</code></pre><p>如果这个时候我们去看一看iotop，你就会发现，我们的I/O占用，都来自于stress产生的两个进程了。</p><pre><code>$ iotop\n</code></pre><pre><code>Total DISK READ :       0.00 B/s | Total DISK WRITE :       0.00 B/s\nActual DISK READ:       0.00 B/s | Actual DISK WRITE:       0.00 B/s\n  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND                                             \n29161 be/4 xuwenhao    0.00 B/s    0.00 B/s  0.00 % 56.71 % stress -i 2\n29162 be/4 xuwenhao    0.00 B/s    0.00 B/s  0.00 % 46.89 % stress -i 2\n    1 be/4 root        0.00 B/s    0.00 B/s  0.00 %  0.00 % init\n</code></pre><p>相信到了这里，你也应该学会了怎么通过top、iostat以及iotop，一步一步快速定位服务器端的I/O带来的性能瓶颈了。你也可以自己通过Linux的man命令，看一看这些命令还有哪些参数，以及通过stress来模拟其他更多不同的性能压力，看看我们的机器负载会发生什么变化。</p><h2>总结延伸</h2><p>这一讲里，我们从硬盘的两个核心指标，响应时间和数据传输率，来理解和研究I/O的性能问题。你也自己可以通过as ssd这样的性能评测软件，看一看自己的硬盘性能。</p><p>在顺序读取的情况下，无论是HDD硬盘还是SSD硬盘，性能看起来都是很不错的。不过，等到进行随机读取测试的时候，硬盘的性能才能见了真章。因为在大部分的应用开发场景下，我们关心的并不是在顺序读写下的数据量，而是每秒钟能够进行输入输出的操作次数，也就是IOPS这个核心性能指标。</p><p>你会发现，即使是使用PCI Express接口的SSD硬盘，IOPS也就只是到了2万左右。这个性能，和我们CPU的每秒20亿次操作的能力比起来，可就差得远了。所以很多时候，我们的程序对外响应慢，其实都是CPU在等待I/O操作完成。</p><p>在Linux下，我们可以通过top这样的命令，来看整个服务器的整体负载。在应用响应慢的时候，我们可以先通过这个指令，来看CPU是否在等待I/O完成自己的操作。进一步地，我们可以通过iostat这个命令，来看到各个硬盘这个时候的读写情况。而 iotop 这个命令，能够帮助我们定位到到底是哪一个进程在进行大量的I/O操作。</p><p>这些命令的组合，可以快速帮你定位到是不是我们的程序遇到了I/O的瓶颈，以及这些瓶颈来自于哪些程序，你就可以根据定位的结果来优化你自己的程序了。</p><h2>推荐阅读</h2><p>关于IO_WAIT的文章，在互联网上已经有不少了。你可以读一读这一篇<a href=\"https://louwrentius.com/understanding-iops-latency-and-storage-performance.html\">Understanding IOPS Latency and Storage Performance</a>，进一步理解一下什么是IOPS和IO_WAIT。</p><h2>课后思考</h2><p>你能去下载一个AS SSD软件，测试一下你自己硬盘的性能吗？特别是如果你手上还有HDD硬盘的话，可以尝试测试一下HDD硬盘的性能是怎么样的。</p><p>在上面的性能指标上，我们已经讲解了Seq，4K以及Acc.Time这三个指标，那么4K-Thrd这个指标又是什么意思呢？测试这个指标对应的应用场景又是怎么样的呢？</p><p>请你研究一下，把你得到的答案写在留言区，和大家一起分享讨论吧。另外，如果有收获，也欢迎你把这篇文章分享给你的朋友。</p><p></p>","neighbors":{"left":{"article_title":"43 | 输入输出设备：我们并不是只能用灯泡显示“0”和“1”","id":113361},"right":{"article_title":"45 | 机械硬盘：Google早期用过的“黑科技”","id":116104}},"comments":[{"had_liked":false,"id":121572,"user_name":"bro.","can_delete":false,"product_type":"c1","uid":1124948,"ip_address":"","ucode":"D65283CD869804","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/54/c9990105.jpg","comment_is_top":false,"comment_ctime":1565160886,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"194838689206","product_id":100026001,"comment_content":"4K-64Thrd是随机64队列深度测试，软件则会生成64个16MB大小的测试文件（共计1GB），然后同时以4KB的单位尺寸，同时在这64个文件中进行写入和读取测试，最后依然以平均成绩为结果!","like_count":46},{"had_liked":false,"id":121487,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1565146509,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"91759459725","product_id":100026001,"comment_content":"才注意到，硬盘的随机读的性能是不如随机写的。我以前一直以为是反过来的，但是为什么呢？按这个现象，原来硬盘类设备是“写多读少”的设计思路？","like_count":22,"discussions":[{"author":{"id":1388479,"avatar":"https://static001.geekbang.org/account/avatar/00/15/2f/bf/85b957fc.jpg","nickname":"咕咕咕","note":"","ucode":"5D35932F7118EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251951,"discussion_content":"就像在笔记本上写笔记，读的时候，找一条你想要的难，写的时候，找个空白地方就行。","likes_number":31,"is_delete":false,"is_hidden":false,"ctime":1588128356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1191069,"avatar":"https://static001.geekbang.org/account/avatar/00/12/2c/9d/cc150980.jpg","nickname":"崔巍","note":"","ucode":"1EE10CE5A3CECD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1388479,"avatar":"https://static001.geekbang.org/account/avatar/00/15/2f/bf/85b957fc.jpg","nickname":"咕咕咕","note":"","ucode":"5D35932F7118EC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548734,"discussion_content":"个人这个比喻不太恰当，你说的读隐含搜索的功能，这里说的读是从明确的位置读取","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1643350013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":251951,"ip_address":""},"score":548734,"extra":""}]},{"author":{"id":1014800,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg","nickname":"Scott","note":"","ucode":"7E57FDCB5E5D49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4293,"discussion_content":"磁盘内部也是有WAL队列，只需要把write request写入这个队列就可以了，但是读如果cache不命中就没有任何懒可偷。","likes_number":25,"is_delete":false,"is_hidden":false,"ctime":1565278656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1301286,"avatar":"https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg","nickname":"靠人品去赢","note":"","ucode":"7A20F9EBE847E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4282,"discussion_content":"感觉类似查询和增加数据一样，磁盘不满的时候增加一条容易，但是你要找到一条你曾将写入的就有点麻烦了","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1565271258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2016514,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c5/02/9981f2ad.jpg","nickname":"心怀架构","note":"","ucode":"631CC20A30E5F4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371064,"discussion_content":"是不是因为读的时候需要寻址？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619621692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126445,"user_name":"活的潇洒","can_delete":false,"product_type":"c1","uid":1238830,"ip_address":"","ucode":"666C30CA894754","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg","comment_is_top":false,"comment_ctime":1566387171,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"31631158243","product_id":100026001,"comment_content":"工作经常遇到IO_WAIT的案例 老师讲的正好可以用上<br>day44 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11363137.html","like_count":7,"discussions":[{"author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"忆水寒","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314834,"discussion_content":"你怎么不把极客时间app买下呢？省的搬运文章了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603201868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1411096,"avatar":"https://static001.geekbang.org/account/avatar/00/15/88/18/9744d5ec.jpg","nickname":"小超人","note":"","ucode":"0D8A433F3E3737","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"忆水寒","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400867,"discussion_content":"有道理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633448361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314834,"ip_address":""},"score":400867,"extra":""},{"author":{"id":2178501,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3d/c5/f43fa619.jpg","nickname":"🍀柠檬鱼也是鱼","note":"","ucode":"DCF033636465F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"忆水寒","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406093,"discussion_content":"这种人真ex，直接搬运，还当成自己的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634699503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314834,"ip_address":""},"score":406093,"extra":""},{"author":{"id":2119325,"avatar":"https://static001.geekbang.org/account/avatar/00/20/56/9d/4b2a7d29.jpg","nickname":"ryanxw","note":"","ucode":"0B91EAC8D06EED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2178501,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3d/c5/f43fa619.jpg","nickname":"🍀柠檬鱼也是鱼","note":"","ucode":"DCF033636465F3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535924,"discussion_content":"每篇下面都有这个人搬运，还写一堆废话在前面，讨厌死了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638609097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":406093,"ip_address":""},"score":535924,"extra":""}]}]},{"had_liked":false,"id":227029,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1592269641,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23067106121","product_id":100026001,"comment_content":"top 中 %CPU的wa是实时CPU等待io占用百分比。若是要收集一段时间内的io耗时占比呢？比如一周","like_count":5,"discussions":[{"author":{"id":1619597,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","nickname":"dog_brother","note":"","ucode":"9F64D3C6D815FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394384,"discussion_content":"使用监控组件，例如zabbix","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631863843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2665302,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ab/56/8c415a12.jpg","nickname":"沈金龙","note":"","ucode":"1490BA96DEEAEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380052,"discussion_content":"很实用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624320109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176322,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/c8680841.jpg","comment_is_top":false,"comment_ctime":1581033449,"is_pvip":false,"replies":[{"id":"68636","content":"钱晓明同学，<br><br>你好，在应用开发层面，的确只要append only直接写文件就OK了。<br><br>是的，这种先写日志，再commit到实际的数据库内部的存储结构的WAL（Write Ahead Logging）日志的方式，其实也就是AOF（Append Only File）的方式。","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1581220823,"ip_address":"","comment_id":176322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18760902633","product_id":100026001,"comment_content":"请问下顺序IO在开发上是怎么实现的？比如对于C开发，就是以append only的方式打开一个文件直接写就行了？还是说有什么特别的控制指令？<br>我看挺多数据库软件写日志的时候用的都是所谓的AOF文件，说顺序写完日志再应用到库里，是不是也是同样的方式？","like_count":4,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483078,"discussion_content":"钱晓明同学，\n\n你好，在应用开发层面，的确只要append only直接写文件就OK了。\n\n是的，这种先写日志，再commit到实际的数据库内部的存储结构的WAL（Write Ahead Logging）日志的方式，其实也就是AOF（Append Only File）的方式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581220823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193915,"user_name":"草帽路飞","can_delete":false,"product_type":"c1","uid":1401733,"ip_address":"","ucode":"7416D1D82E3456","user_header":"https://static001.geekbang.org/account/avatar/00/15/63/85/9ccf1b19.jpg","comment_is_top":false,"comment_ctime":1584980861,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14469882749","product_id":100026001,"comment_content":"您好，老师程序中如果直接写文件是顺序读写么？","like_count":3},{"had_liked":false,"id":122742,"user_name":"Knight²º¹⁸","can_delete":false,"product_type":"c1","uid":1089754,"ip_address":"","ucode":"BDCB830B6A730F","user_header":"https://static001.geekbang.org/account/avatar/00/10/a0/da/4f50f1b2.jpg","comment_is_top":false,"comment_ctime":1565510653,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10155445245","product_id":100026001,"comment_content":"一直有个问题，在Linux的IO模型中无论是BIO、NIO、IO多路复用实际上在等待IO响应的时候用户线程基本上都是没干啥事的，要么是空跑要么是阻塞。这些个IO模型对应用程序来讲实际并没有提升单个线程的执行效率，那么些IO模型要解决的问题点在哪里，提升的是哪部分的性能？提升应用程序的吞吐量？","like_count":2,"discussions":[{"author":{"id":2822027,"avatar":"","nickname":"caijialiang","note":"","ucode":"59586CA3291DA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558403,"discussion_content":"等待的时候线程都被挂起了，然后资源让出来cpu去执行别的任务，并不是一直等着啥都不干","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648285518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2115387,"avatar":"https://static001.geekbang.org/account/avatar/00/20/47/3b/70198ceb.jpg","nickname":"Aibo","note":"","ucode":"2CE3E77BD2D014","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351233,"discussion_content":"io多路复用不是可以一个线程处理多个请求吗，减少创建、销毁线程开销，减少了gc次数。资源开销少了，性能有所提升。\n提升应该指得是整体性能的提升，io的次数和性能应该和这个无关吧。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614182576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1215219,"avatar":"https://static001.geekbang.org/account/avatar/00/12/8a/f3/7c89d00e.jpg","nickname":"Presley","note":"","ucode":"D8F125835F4903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36835,"discussion_content":"吞吐率吧，单个没提升，吞吐量提升了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571449854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121438,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1565140133,"is_pvip":true,"replies":[{"id":"53169","content":"we同学，<br><br>你好，硬件设备日新月异，而且现在云平台下的SSD硬件都很不错的，你可以自己用stress压压看。","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1570085465,"ip_address":"","comment_id":121438,"utype":1}],"discussion_count":5,"race_medal":0,"score":"10155074725","product_id":100026001,"comment_content":"pci-e 的ssd 磁盘iops 才20000。那云平台的云磁盘是不是更低了。","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461791,"discussion_content":"we同学，\n\n你好，硬件设备日新月异，而且现在云平台下的SSD硬件都很不错的，你可以自己用stress压压看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570085465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264707,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/43/150c70c2.jpg","nickname":"陈松Plus","note":"","ucode":"0074BDECFA3D1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349945,"discussion_content":"公司电脑，已经5年，iops 1000.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613638030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207687,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6d/87/21e516ec.jpg","nickname":"林杨","note":"","ucode":"FE192D8D6FF036","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350943,"discussion_content":"你可以多挂几个盘分担io啊，iops就成倍增长了。现在云上存储，是由许多硬盘迟化后，创建出的虚拟块存储，iops可以根据容量大小分散到多块盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614079535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356077,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/2d/661132f3.jpg","nickname":"佚名","note":"","ucode":"A4E35B21AC3C31","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212294,"discussion_content":"我压过阿里云的学生机了，iops峰值不到3000，2500-3000浮动","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584956770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1207687,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6d/87/21e516ec.jpg","nickname":"林杨","note":"","ucode":"FE192D8D6FF036","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1356077,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/2d/661132f3.jpg","nickname":"佚名","note":"","ucode":"A4E35B21AC3C31","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":350944,"discussion_content":"阿里云有hdd ssd的云盘，现在还有essd，极限可以达到100万iops，这个时候底层有几十块硬盘为你服务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614079589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":212294,"ip_address":""},"score":350944,"extra":""}]}]},{"had_liked":false,"id":198222,"user_name":"大头爸爸","can_delete":false,"product_type":"c1","uid":1276613,"ip_address":"","ucode":"131E25DB04D222","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","comment_is_top":false,"comment_ctime":1585419402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880386698","product_id":100026001,"comment_content":"&quot;我们在实际的应用开发当中，对于数据的访问，更多的是随机读写，而不是顺序读写。我们平时所说的服务器承受的“并发”&quot;<br>这个要看具体应用。对于视频，复制&#47;备份这样的应用主要就是顺序读写。对于数据库访问则主要是随机读写。","like_count":1},{"had_liked":false,"id":161099,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1576118839,"is_pvip":false,"replies":[{"id":"69415","content":"loser同学，<br><br>你好，这个由文件系统来控制，而不是由上层的应用API来控制。","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1581839041,"ip_address":"","comment_id":161099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5871086135","product_id":100026001,"comment_content":"老师，怎么能控制磁盘的顺序读写和随机读写，操作系统有什么api 吗。一直没有找到","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477597,"discussion_content":"loser同学，\n\n你好，这个由文件系统来控制，而不是由上层的应用API来控制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581839041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144002,"user_name":"随心而至","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1571822823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866790119","product_id":100026001,"comment_content":"A server orientated measure of a drives ability to write 64 files in parallel.<br><br>4K 64 thread write speed is a measure of how well a device can write random 4K blocks of data at a queue depth of 64. General consumer computer disks rarely need to service more than one or two requests at a time making this measure particularly well suited to servers.<br><br>https:&#47;&#47;ssd.userbenchmark.com&#47;Faq&#47;What-is-4K-64-thread-write-speed&#47;59","like_count":1},{"had_liked":false,"id":121581,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565161857,"is_pvip":false,"replies":[{"id":"52703","content":"你可以用我在这一讲的stress命令压一下。不过云主机大家现在都是超卖的，而且可能存在别人的应用也在运行的情况。有时候测出来数据会有波动。","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1569666309,"ip_address":"","comment_id":121581,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5860129153","product_id":100026001,"comment_content":"老师你好，我有一台云主机，怎么样才能测出硬盘的性能，比如最大的IOPS？","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461861,"discussion_content":"你可以用我在这一讲的stress命令压一下。不过云主机大家现在都是超卖的，而且可能存在别人的应用也在运行的情况。有时候测出来数据会有波动。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569666309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582097,"discussion_content":"fio 了解一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659228623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121571,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565160867,"is_pvip":false,"replies":[{"id":"52704","content":"能贴一下具体的指令么？","user_name":"作者回复","user_name_real":"徐文浩","uid":"1053568","ctime":1569666333,"ip_address":"","comment_id":121571,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5860128163","product_id":100026001,"comment_content":"老师你好，我在CENTOS下用Stress命令，IO_WAIT并没有上去，是什么原因？","like_count":1,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461857,"discussion_content":"能贴一下具体的指令么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569666333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318664,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1f/08/7b5bfbc7.jpg","nickname":"追风少年","note":"","ucode":"C172E9CFA3FB3E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4145,"discussion_content":"应该是多核的cpu吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565165569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1003005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","nickname":"许童童","note":"","ucode":"4B799C0C6BC678","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318664,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1f/08/7b5bfbc7.jpg","nickname":"追风少年","note":"","ucode":"C172E9CFA3FB3E","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":4159,"discussion_content":"是多核 要用什么命令？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565175453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4145,"ip_address":""},"score":4159,"extra":""}]},{"author":{"id":1516991,"avatar":"https://static001.geekbang.org/account/avatar/00/17/25/bf/1e9c853f.jpg","nickname":"Cue","note":"","ucode":"A5CB460B54FDB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9521,"discussion_content":"可以用streess-ng 这个可以更好的测出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568181580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354890,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"北京","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1660868076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660868076","product_id":100026001,"comment_content":"总结:后续 iops是根据传输速率除以数据块大小，计算得来","like_count":0},{"had_liked":false,"id":354888,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"北京","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1660867882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660867882","product_id":100026001,"comment_content":"总结:硬盘的设计考虑两点，一个是吞吐量，一个是响应时间，围绕这两个指标，硬盘分hdd机械硬盘和ssd固态硬盘，hdd的最大速度是700多兆，支持c接口，而支持pci express接口的hdd最大能到2g&#47;s，这是顺序读写，随机读写的性能会差好多，有一个核心指标iops，也就是每秒写入和读取磁盘的次数。使用一些命令top，iostat可以看等待io时长和占用io的线程，做定位","like_count":0},{"had_liked":false,"id":347612,"user_name":"范超","can_delete":false,"product_type":"c1","uid":1035926,"ip_address":"","ucode":"A90F9490111A8B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/96/a0132d15.jpg","comment_is_top":false,"comment_ctime":1654224834,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1654224834","product_id":100026001,"comment_content":"老师，IOPS中的请求次数，是读写请求都包括吗，还是只包括某一种请求的次数呢，我看您计算的时候是用的读请求的DTR来计算的","like_count":0},{"had_liked":false,"id":343918,"user_name":"小杰","can_delete":false,"product_type":"c1","uid":2853200,"ip_address":"","ucode":"BBDF8E9F348F65","user_header":"https://static001.geekbang.org/account/avatar/00/2b/89/50/aee9fdab.jpg","comment_is_top":false,"comment_ctime":1651117978,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1651117978","product_id":100026001,"comment_content":"64个文件，同时已4k的单位进行读写，计算平均结果","like_count":0},{"had_liked":false,"id":297320,"user_name":"Tank","can_delete":false,"product_type":"c1","uid":1523608,"ip_address":"","ucode":"1F20DC27EF7702","user_header":"https://static001.geekbang.org/account/avatar/00/17/3f/98/fbcd02e4.jpg","comment_is_top":false,"comment_ctime":1623435304,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623435304","product_id":100026001,"comment_content":"CPU空闲并且等待I&#47;O操作完成的时间比例。","like_count":0},{"had_liked":false,"id":204898,"user_name":"微秒","can_delete":false,"product_type":"c1","uid":1249195,"ip_address":"","ucode":"65A2E8B565B191","user_header":"https://static001.geekbang.org/account/avatar/00/13/0f/ab/9748f40b.jpg","comment_is_top":false,"comment_ctime":1586488314,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586488314","product_id":100026001,"comment_content":"现在的I&#47;O设备与CPU总线间是通过接口连接起来的，那两者必须都有接口电路吗？还是总的只要求一个接口就好了。","like_count":0},{"had_liked":false,"id":203422,"user_name":"re","can_delete":false,"product_type":"c1","uid":1275541,"ip_address":"","ucode":"AA565C2B6EA105","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/95/86a5c281.jpg","comment_is_top":false,"comment_ctime":1586187896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586187896","product_id":100026001,"comment_content":"我想问下 这个iowait也就是wa占比 算不算在cpu真实占用率里面<br>","like_count":0},{"had_liked":false,"id":191781,"user_name":"知行合一","can_delete":false,"product_type":"c1","uid":1090784,"ip_address":"","ucode":"563C4A71D80DA1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJwQvLGE4dMsF4JU0svW3DtGbodpjskbY65FdwF13JdtBYZfgL2IXHlHrdejWzHdjT0RibEIfib4QYA/132","comment_is_top":false,"comment_ctime":1584796427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584796427","product_id":100026001,"comment_content":"牛逼","like_count":0},{"had_liked":false,"id":156609,"user_name":"czh","can_delete":false,"product_type":"c1","uid":1159078,"ip_address":"","ucode":"649FE5C9269D69","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/a6/3f15ba2f.jpg","comment_is_top":false,"comment_ctime":1574922780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574922780","product_id":100026001,"comment_content":"重点：iostat iotop top三个命令 判断io等待原因","like_count":0},{"had_liked":false,"id":141621,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1571202955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571202955","product_id":100026001,"comment_content":"计算机的cpu主频很好，所以很快。硬盘的吞吐率和响应时间比较小，所以性能主要卡在这里。<br>lunix 下 可以用，top  iostat  iotop  快速定位计算机的性能卡在哪个io进程。","like_count":0},{"had_liked":false,"id":121598,"user_name":"humor","can_delete":false,"product_type":"c1","uid":1181867,"ip_address":"","ucode":"9B48C4C7BEC92C","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg","comment_is_top":false,"comment_ctime":1565164544,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1565164544","product_id":100026001,"comment_content":"我实验的结果也是sy高，但是wa是0.0。不知道为什么","like_count":1,"discussions":[{"author":{"id":1619597,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","nickname":"dog_brother","note":"","ucode":"9F64D3C6D815FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394385,"discussion_content":"跟你一样，我甚至加到了 `stress -i 100`，wa还是0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631863918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121577,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565161237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565161237","product_id":100026001,"comment_content":"那么 4K-Thrd 这个指标又是什么意思呢？测试这个指标对应的应用场景又是怎么样的呢？<br>这个指标是同时读写64个文件时的吞吐量，应用场景主要是服务器端需要处理大量并发请求。","like_count":0},{"had_liked":false,"id":121505,"user_name":"haer","can_delete":false,"product_type":"c1","uid":1146728,"ip_address":"","ucode":"0216267E645431","user_header":"","comment_is_top":false,"comment_ctime":1565149371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565149371","product_id":100026001,"comment_content":"关于 stress -i 2 命令<br>在VMware虚拟机中测试，99 sy，0.0 wa<br>在vps中测试，24.3 sy，73.1 wa<br>为什么会这样呢?","like_count":0},{"had_liked":false,"id":121464,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1565142985,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1565142985","product_id":100026001,"comment_content":"我在本地虚拟机里面测试，iowait 没有升高。而是平均负载与sy 特别高。","like_count":0},{"had_liked":false,"id":121451,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1565141258,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1565141258","product_id":100026001,"comment_content":"老师，stress 命令在centos 下有三个类似的包。是哪个呢？ stress-ng,http ress,","like_count":0,"discussions":[{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4117,"discussion_content":"还有 stress","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565143008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}