{"id":225398,"title":"23 | MySQLç»å¸¸é‡åˆ°çš„é«˜å¯ç”¨ã€åˆ†ç‰‡é—®é¢˜ï¼ŒNewSQLæ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æç¥ã€‚</p><p>åœ¨è¿™ä¸ªç³»åˆ—è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®²çš„éƒ½æ˜¯å¦‚ä½•è§£å†³ç”Ÿäº§ç³»ç»Ÿä¸­é¢ä¸´çš„ä¸€äº›å­˜å‚¨ç³»ç»Ÿç›¸å…³çš„é—®é¢˜ã€‚åœ¨æœ€åä¸¤èŠ‚è¯¾é‡Œé¢ï¼Œæˆ‘ä»¬æ¥è¯´ç‚¹å„¿æ–°ä¸œè¥¿ï¼Œçœ‹ä¸€ä¸‹å­˜å‚¨è¿™ä¸ªæŠ€æœ¯é¢†åŸŸï¼Œå¯èƒ½ä¼šæœ‰å“ªäº›å€¼å¾—å…³æ³¨çš„æ–°æŠ€æœ¯ã€‚å½“ç„¶ï¼ŒæŠ€æœ¯åœˆæ¯å¤©éƒ½æœ‰å¾ˆå¤šæ–°çš„æŠ€æœ¯å‡ºç°ï¼Œä¹Ÿä¼šç»å¸¸å‘å¾ˆå¤šè®ºæ–‡ï¼Œå‡ºç°å¾ˆå¤šçš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›å¤§å¤šæ•°éƒ½ä¸å¤ªé è°±å„¿ã€‚</p><p>ä»Šå¤©æˆ‘ç»™ä½ è¦è¯´çš„è¿™ä¸ªNew SQLï¼Œå®ƒæ˜¯æˆ‘ä¸ªäººè®¤ä¸ºéå¸¸é è°±ï¼Œç”šè‡³åœ¨æœªæ¥å¯èƒ½ä¼šå–ä»£MySQLè¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“çš„ä¸€ä¸ªæŠ€æœ¯ã€‚MySQLæ˜¯å‡ ä¹æ¯ä¸€ä¸ªåç«¯å¼€å‘äººå‘˜å¿…é¡»è¦ç²¾é€šçš„æ•°æ®åº“ï¼Œæ—¢ç„¶New SQLéå¸¸æœ‰å¯èƒ½åœ¨å°†æ¥æ›¿ä»£MySQLï¼Œé‚£æˆ‘ä»¬å°±éå¸¸æœ‰å¿…è¦æå‰å»äº†è§£ä¸€ä¸‹äº†ã€‚</p><h2>ä»€ä¹ˆæ˜¯New SQLï¼Ÿ</h2><p>ä»€ä¹ˆæ˜¯New SQLï¼Ÿè¿™ä¸ªè¯´æ¥è¯é•¿äº†ï¼Œè¿˜è¦ä»å­˜å‚¨æŠ€æœ¯å‘å±•çš„å†å²æ¥è§£è¯»ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ—©æœŸåªæœ‰åƒMySQLè¿™æ ·çš„å…³ç³»æ•°æ®åº“ï¼Œè¿™ç§å…³ç³»å‹æ•°æ®åº“å› ä¸ºæ”¯æŒSQLè¯­è¨€ï¼Œåæ¥è¢«å«åšSQLæˆ–è€…Old SQLã€‚</p><p>ç„¶åï¼Œå‡ºç°äº†Rediså’Œå¾ˆå¤šKVå­˜å‚¨ç³»ç»Ÿï¼Œæ€§èƒ½ä¸Šå„ç§åŠæ‰“MySQLï¼Œè€Œä¸”å› ä¸ºå­˜å‚¨ç»“æ„ç®€å•ï¼Œæ‰€ä»¥æ¯”è¾ƒå®¹æ˜“ç»„æˆåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¹¶ä¸”èƒ½å¤Ÿåšåˆ°æ°´å¹³æ‰©å±•ã€é«˜å¯é ã€é«˜å¯ç”¨ã€‚å› ä¸ºè¿™äº›KVå­˜å‚¨ä¸æ”¯æŒSQLï¼Œä¸ºäº†ä»¥ç¤ºåŒºåˆ†ï¼Œè¢«ç»Ÿç§°ä¸ºNo SQLã€‚</p><p>No SQLæœ¬æ¥å¸Œæœ›èƒ½å‡­å€Ÿé«˜æ€§èƒ½å’Œé›†ç¾¤çš„ä¼˜åŠ¿ï¼Œæ›¿ä»£æ‰Old SQLã€‚ä½†ç”¨æˆ·æ˜¯ç”¨è„šæŠ•ç¥¨çš„ï¼Œè¿™ä¹ˆå¤šå¹´å®è·µè¯æ˜ï¼Œä½ ç‰ºç‰²äº†SQLè¿™ç§å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›å’ŒACIDäº‹åŠ¡æ”¯æŒï¼Œç”¨æˆ·æ ¹æœ¬ä¸ä¹°è´¦ï¼Œç›´åˆ°ä»Šå¤©ï¼ŒOld SQLè¿˜æ˜¯ç”Ÿäº§ç³»ç»Ÿä¸­æœ€ä¸»æµçš„æ•°æ®åº“ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸ªæ—¶å€™ï¼Œå¤§å®¶éƒ½å¼€å§‹æ˜ç™½äº†ï¼Œæ— è®ºä½ å…¶ä»–æ–¹é¢åšçš„æ¯”Old SQLå¥½å†å¤šï¼ŒSQLå’ŒACIDæ˜¯åˆšéœ€ï¼Œè¿™ä¸ªå‘½ä½ é©ä¸æ‰çš„ã€‚ä½ ä¸æ”¯æŒSQLï¼Œå°±ä¸ä¼šæœ‰å¤šå°‘äººç”¨ã€‚æ‰€ä»¥ä½ çœ‹ï¼Œè¿‘å‡ å¹´å¾ˆå¤šä¹‹å‰ä¸æ”¯æŒSQLçš„æ•°æ®åº“ï¼Œéƒ½å¼€å§‹æ”¯æŒSQLäº†ï¼Œç”šè‡³äºåƒSparkã€Flinkè¿™æ ·çš„æµè®¡ç®—å¹³å°ï¼Œä¹Ÿéƒ½å¼€å§‹æ”¯æŒSQLã€‚å½“ç„¶ï¼Œè™½ç„¶è¯´æ”¯æŒSQLï¼Œä½†è¿™é‡Œé¢å„ä¸ªäº§å“çš„æ”¯æŒç¨‹åº¦æ˜¯å‚å·®ä¸é½çš„ï¼Œå¤šå¤šå°‘å°‘éƒ½æœ‰ä¸€äº›ç¼©æ°´ã€‚å¯¹äºACIDçš„æ”¯æŒï¼ŒåŸºæœ¬ä¸Šç­‰åŒäºå°±æ²¡æœ‰ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼ŒNew SQLå®ƒæ¥äº†ï¼ç®€å•åœ°è¯´ï¼ŒNew SQLå°±æ˜¯å…¼é¡¾äº†Old SQLå’ŒNo SQLçš„ä¼˜ç‚¹ï¼š</p><ul>\n<li>å®Œæ•´åœ°æ”¯æŒSQLå’ŒACIDï¼Œæä¾›å’ŒOld SQLéš”ç¦»çº§åˆ«ç›¸å½“çš„äº‹åŠ¡èƒ½åŠ›ï¼›</li>\n<li>é«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å¯ç”¨ï¼Œæ”¯æŒæ°´å¹³æ‰©å®¹ã€‚</li>\n</ul><p>åƒGoogleçš„Cloud Spannerã€å›½äº§çš„OceanBaseä»¥åŠå¼€æºçš„<a href=\"https://github.com/cockroachdb/cockroach\">CockroachDB</a>éƒ½å±äºNew SQLæ•°æ®åº“ã€‚Cockroachè¿™ä¸ªè‹±æ–‡å•è¯æ˜¯èŸ‘è‚çš„æ„æ€ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éƒ½æŠŠCockroachDBä¿—ç§°ä¸ºå°å¼ºæ•°æ®åº“ã€‚</p><p>è¿™äº›New SQLå‡­ä»€ä¹ˆå°±èƒ½åšåˆ°Old SQLå’ŒNo SQLåšä¸åˆ°çš„è¿™äº›ç‰¹æ€§å‘¢ï¼Ÿé‚£æˆ‘ä»¬å°±ä»¥å¼€æºçš„CockroachDBä¸ºä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹New SQLæ˜¯ä¸æ˜¯çœŸçš„è¿™ä¹ˆå‰å®³ã€‚</p><h2>CockroachDBæ˜¯å¦‚ä½•å®ç°æ•°æ®åˆ†ç‰‡å’Œå¼¹æ€§æ‰©å®¹çš„ï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸€èµ·å…ˆæ¥ç®€å•çœ‹ä¸€ä¸‹CockroachDBçš„æ¶æ„ï¼Œä»æ¶æ„å±‚é¢åˆ†æä¸€ä¸‹ï¼Œå®ƒæ˜¯ä¸æ˜¯çœŸçš„åƒå®£ä¼ çš„é‚£ä¹ˆå‰å®³ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒçš„æ¶æ„å›¾(å›¾ç‰‡æ¥è‡ªäº<a href=\"https://github.com/cockroachdb/cockroach/blob/master/docs/design.md\">å®˜æ–¹æ–‡æ¡£</a>)ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/82/8c78db973e66bb62b23c8e85afe78082.jpg?wh=1004*676\" alt=\"\"></p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„åˆ†å±‚æ¶æ„ï¼Œæˆ‘ä»¬ä»ä¸Šå¾€ä¸‹çœ‹ã€‚æœ€ä¸Šå±‚æ˜¯SQLå±‚ï¼ŒSQLå±‚æ”¯æŒå’Œå…³ç³»å‹æ•°æ®åº“ç±»ä¼¼çš„é€»è¾‘æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚è¯´åº“ã€è¡¨ã€è¡Œå’Œåˆ—è¿™äº›é€»è¾‘æ¦‚å¿µã€‚SQLå±‚å‘ä¸‹è°ƒç”¨çš„æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¥å£å±‚Structured Data APIï¼Œå®é™…å®ç°è¿™ä¸ªAPIçš„æ˜¯ä¸‹é¢ä¸€å±‚ï¼šDistributed, Monolithic KV Storeï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„KVå­˜å‚¨ç³»ç»Ÿã€‚</p><p>æˆ‘ä»¬å…ˆä¸æ·±å…¥è¿›å»çœ‹ç»†èŠ‚ï¼Œä»å®è§‚å±‚é¢ä¸Šåˆ†æä¸€ä¸‹è¿™ä¸ªæ¶æ„ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¶æ„ä»ç„¶æ˜¯æˆ‘ä»¬ä¹‹é—´è®²è¿‡çš„ï¼Œå¤§éƒ¨åˆ†æ•°æ®åº“éƒ½é‡‡ç”¨çš„äºŒå±‚æ¶æ„ï¼šæ‰§è¡Œå™¨å’Œå­˜å‚¨å¼•æ“ã€‚å®ƒçš„SQLå±‚å°±æ˜¯æ‰§è¡Œå™¨ï¼Œä¸‹é¢çš„åˆ†å¸ƒå¼KVå­˜å‚¨é›†ç¾¤å°±æ˜¯å®ƒçš„å­˜å‚¨å¼•æ“ã€‚</p><p>é‚£æˆ‘ä»¬çŸ¥é“ï¼ŒMySQLçš„å­˜å‚¨å¼•æ“InnoDBï¼Œå®é™…ä¸Šæ˜¯åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„B+æ ‘ï¼ŒåƒHiveå’ŒHBaseï¼Œå®ƒä»¬çš„å­˜å‚¨å¼•æ“éƒ½æ˜¯åŸºäºHDFSæ„å»ºçš„ã€‚é‚£CockroachDBè¿™ç§ï¼Œä½¿ç”¨åˆ†å¸ƒå¼KVå­˜å‚¨æ¥ä½œä¸ºå­˜å‚¨å¼•æ“çš„è®¾è®¡ï¼Œç†è®ºä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«éš¾ä»¥é€¾è¶Šçš„æŠ€æœ¯å£å’ã€‚</p><p>è€Œä¸”ï¼Œä½¿ç”¨åˆ†å¸ƒå¼KVå­˜å‚¨ä½œä¸ºå­˜å‚¨å¼•æ“ï¼Œå®ç°é«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å¯ç”¨ï¼Œä»¥åŠæ”¯æŒæ°´å¹³æ‰©å®¹è¿™äº›ç‰¹æ€§ï¼Œå°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹å„¿äº†ï¼Œå…¶ä¸­å¾ˆå¤šåˆ†å¸ƒå¼KVå­˜å‚¨ç³»ç»Ÿå·²ç»åšåˆ°äº†ï¼Œè¿™é‡Œé¢ä½¿ç”¨çš„ä¸€äº›æŠ€æœ¯å’Œæ–¹æ³•ï¼Œå¤§å¤šæˆ‘ä»¬åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ä¹Ÿéƒ½è®²åˆ°è¿‡ã€‚CockroachDBåœ¨å®ç°å®ƒçš„å­˜å‚¨å¼•æ“è¿™ä¸€å±‚ï¼Œå°±æ˜¯å¤§é‡åœ°å€Ÿé‰´ï¼Œç”šè‡³æ˜¯ç›´æ¥ä½¿ç”¨äº†å·²æœ‰çš„ä¸€äº›æˆç†ŸæŠ€æœ¯ã€‚</p><p>å®ƒçš„åˆ†ç‰‡ç®—æ³•é‡‡ç”¨çš„æ˜¯èŒƒå›´åˆ†ç‰‡ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿè®²åˆ°è¿‡ï¼ŒèŒƒå›´åˆ†ç‰‡å¯¹æŸ¥è¯¢æ˜¯æœ€å‹å¥½çš„ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ”¯æŒèŒƒå›´æ‰«æè¿™ä¸€ç±»çš„æ“ä½œï¼Œè¿™æ ·æœ‰åˆ©äºå®ƒæ”¯æ’‘ä¸Šå±‚çš„SQLæŸ¥è¯¢ã€‚</p><p>å®ƒé‡‡ç”¨<a href=\"https://raft.github.io/\">Raft</a>ä¸€è‡´æ€§åè®®æ¥å®ç°æ¯ä¸ªåˆ†ç‰‡çš„é«˜å¯é ã€é«˜å¯ç”¨å’Œå¼ºä¸€è‡´ã€‚è¿™ä¸ªRaftåè®®ï¼Œå®ƒçš„ä¸€ä¸ªç†è®ºåŸºç¡€ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è®²çš„å¤åˆ¶çŠ¶æ€æœºï¼Œå¹¶ä¸”åœ¨å¤åˆ¶çŠ¶æ€æœºçš„åŸºç¡€ä¸Šï¼ŒRaftå®ç°äº†é›†ç¾¤è‡ªæˆ‘ç›‘æ§å’Œè‡ªæˆ‘é€‰ä¸¾æ¥è§£å†³é«˜å¯ç”¨çš„é—®é¢˜ã€‚Raftä¹Ÿæ˜¯ä¸€ä¸ªè¢«å¹¿æ³›é‡‡ç”¨çš„ã€éå¸¸æˆç†Ÿçš„ä¸€è‡´æ€§åè®®ï¼Œæ¯”å¦‚etcdä¹Ÿæ˜¯åŸºäºRaftæ¥å®ç°çš„ã€‚</p><p>CockroachDBçš„å…ƒæ•°æ®ç›´æ¥åˆ†å¸ƒåœ¨æ‰€æœ‰çš„å­˜å‚¨èŠ‚ç‚¹ä¸Šï¼Œä¾é æµè¨€åè®®æ¥ä¼ æ’­ï¼Œè¿™ä¸ªæµè¨€åè®®ï¼Œæˆ‘ä»¬åœ¨ã€Š<a href=\"https://time.geekbang.org/column/article/217590\">16 | ç”¨Redisæ„å»ºç¼“å­˜é›†ç¾¤çš„æœ€ä½³å®è·µæœ‰å“ªäº›ï¼Ÿ</a>ã€‹è¿™èŠ‚è¯¾ä¸­ä¹Ÿè®²åˆ°è¿‡ï¼Œåœ¨Redis Clusterä¸­ä¹Ÿæ˜¯ç”¨æµè¨€åè®®æ¥ä¼ æ’­å…ƒæ•°æ®å˜åŒ–çš„ã€‚</p><p>CockroachDBç”¨ä¸Šé¢è¿™äº›æˆç†Ÿçš„æŠ€æœ¯è§£å†³äº†é›†ç¾¤é—®é¢˜ï¼Œåœ¨å•æœºçš„å­˜å‚¨å¼•æ“ä¸Šï¼Œæ›´æ˜¯ç›´æ¥ä½¿ç”¨äº†RocksDBä½œä¸ºå®ƒçš„KVå­˜å‚¨å¼•æ“ã€‚RocksDBä¹Ÿæ˜¯å€¼å¾—å¤§å®¶å…³æ³¨çš„ä¸€ä¸ªæ–°çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¸‹èŠ‚è¯¾æˆ‘ä»¬ä¼šä¸“é—¨è®²RocksDBã€‚</p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒCockroachDBçš„å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„åˆ†å¸ƒå¼KVå­˜å‚¨é›†ç¾¤ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå¤§çš„åˆ›æ–°ï¼Œå°±æ˜¯é‡ç”¨äº†å·²æœ‰çš„ä¸€äº›æˆç†Ÿçš„æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯åœ¨æˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„å…¶ä»–å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œå…¨éƒ¨éƒ½è§åˆ°è¿‡ã€‚æˆ‘è®²è¿™äº›å¹¶æ²¡æœ‰è´¬ä½CockroachDBçš„æ„æ€ï¼Œç›¸åï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæ‰èƒ½çœ‹å¾—æ›´è¿œï¼Œé£å¾—æ›´é«˜ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸åŠ¡å®çš„åšæ³•ã€‚</p><h2>CockroachDBèƒ½æä¾›é‡‘èçº§çš„äº‹åŠ¡éš”ç¦»æ€§ä¹ˆï¼Ÿ</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯´ä¸€ä¸‹CockroachDBæ˜¯æ€ä¹ˆå®ç°ACIDçš„ï¼Œå®ƒçš„ACIDæ˜¯ä¸æ˜¯ç±»ä¼¼äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ®‹è¡€ç‰ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„é—®é¢˜ï¼Œç›´æ¥å½±å“åˆ°å®ƒæœ‰æ²¡æœ‰å¯èƒ½åœ¨æœªæ¥å–ä»£MySQLã€‚</p><p>åœ¨è¯´ACIDä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ç®€å•è¯´ä¸€ä¸‹CockroachDBæ˜¯æ€ä¹ˆè§£æå’Œæ‰§è¡ŒSQLçš„ã€‚æˆ‘ä»¬åœ¨ã€Š<a href=\"https://time.geekbang.org/column/article/213176\">10 | èµ°è¿›é»‘ç›’ï¼šSQLæ˜¯å¦‚ä½•åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œçš„ï¼Ÿ</a>ã€‹è¿™èŠ‚è¯¾ä¸­è®²è¿‡SQLæ˜¯å¦‚ä½•åœ¨MySQLä¸­æ‰§è¡Œçš„ï¼Œåœ¨CockroachDBä¸­ï¼Œè¿™ä¸ªæ‰§è¡Œçš„æµç¨‹ä¹Ÿæ˜¯å·®ä¸å¤šçš„ã€‚åŒæ ·æ˜¯å…ˆè§£æSQLç”Ÿæˆè¯­æ³•æ ‘ï¼Œè½¬æ¢æˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼Œå†è½¬æ¢ä¸ºç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œä¼˜åŒ–åï¼Œæ‰§è¡Œç‰©ç†æ‰§è¡Œè®¡åˆ’è¿”å›æŸ¥è¯¢ç»“æœï¼Œè¿™æ ·ä¸€ä¸ªæµç¨‹ã€‚</p><p>åªæ˜¯åœ¨CockroachDBä¸­ï¼Œç‰©ç†æ‰§è¡Œè®¡åˆ’å°±æ›´åŠ å¤æ‚äº†ï¼Œå› ä¸ºå®ƒçš„ç‰©ç†æ‰§è¡Œè®¡åˆ’é¢å¯¹çš„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼KVå­˜å‚¨ç³»ç»Ÿï¼Œåœ¨æ¶‰åŠåˆ°æŸ¥æ‰¾ã€èšåˆè¿™ç±»æ“ä½œçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½éœ€è¦æ¶‰åŠåˆ°å¤šä¸ªåˆ†ç‰‡ï¼ˆRangeï¼‰ã€‚å¤§è‡´è¿‡ç¨‹å°±æ˜¯ç±»ä¼¼äºMap-Reduceçš„é€»è¾‘ï¼Œå…ˆæŸ¥æ‰¾å…ƒæ•°æ®ç¡®å®šå¯èƒ½æ¶‰åŠåˆ°çš„åˆ†ç‰‡ï¼Œç„¶åæŠŠç‰©ç†æ‰§è¡Œè®¡åˆ’è½¬æ¢æˆæ¯ä¸ªåˆ†ç‰‡ä¸Šçš„ç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œåœ¨æ¯ä¸ªåˆ†ç‰‡ä¸Šå»å¹¶è¡Œæ‰§è¡Œï¼Œæœ€åï¼Œå†å¯¹è¿™äº›æ‰§è¡Œç»“æœåšæ±‡æ€»ã€‚</p><p>ç„¶åæˆ‘ä»¬å†æ¥è¯´CockroachDBçš„ACIDã€‚æˆ‘ä»¬åœ¨ã€Š<a href=\"https://time.geekbang.org/column/article/206544\">04 | äº‹åŠ¡ï¼šè´¦æˆ·ä½™é¢æ€»æ˜¯å¯¹ä¸ä¸Šè´¦ï¼Œæ€ä¹ˆåŠï¼Ÿ</a>ã€‹è¿™èŠ‚è¯¾ä¸­è®²åˆ°è¿‡å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯RUã€RCã€RRå’ŒSERIALIZABLEï¼Œé‚£CockroachDBèƒ½æä¾›å“ªç§éš”ç¦»çº§åˆ«å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä»¥ä¸Šå››ç§éƒ½ä¸æ˜¯ã€‚</p><p>CockroachDBæä¾›äº†å¦å¤–ä¸¤ç§éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>Snapshot Isolation (SI)</strong> å’Œ <strong>Serializable Snapshot Isolation (SSI)</strong>ï¼Œå…¶ä¸­SSIæ˜¯CockroachDBé»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚</p><p>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«å’Œä¹‹å‰æåˆ°çš„å››ç§éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™å¼ è¡¨ï¼Œå’ŒMySQLé»˜è®¤çš„éš”ç¦»çº§åˆ«RRåšä¸€ä¸ªå¯¹æ¯”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/20/67/20e20d983ad7519e6eae11821a3f1567.jpg?wh=2284*1313\" alt=\"\"></p><p>é¦–å…ˆæˆ‘ä»¬çœ‹SIè¿™ä¸€è¡Œã€‚æˆ‘ä»¬ä¹‹å‰è®²åˆ°è¿‡ï¼ŒRRè¿™ç§éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥å¾ˆå¥½åœ°è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œè™½ç„¶å¯èƒ½ä¼šäº§ç”Ÿå¹»è¯»ï¼Œä½†å®é™…ä¸Šå¯¹ç»å¤§å¤šæ•°äº‹åŠ¡å½±å“ä¸å¤§ã€‚SIä¸ä¼šå‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå¹»è¯»çš„æƒ…å†µï¼Œè¿™ä¸ªéš”ç¦»çº§åˆ«ä¼¼ä¹æ¯”RRè¿˜è¦å¥½ã€‚</p><p>ä½†ä½ è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™ä¸ªè¡¨æ ¼æ¯”ä¹‹å‰é‚£ä¸ªè¡¨æ ¼å¤šäº†ä¸€åˆ—ï¼šå†™å€¾æ–œã€‚å¯ä»¥çœ‹åˆ°ï¼ŒRRæ˜¯ä¸ä¼šå‡ºç°å†™å€¾æ–œé—®é¢˜çš„ï¼Œä½†æ˜¯SIä¼šæœ‰å†™å€¾æ–œé—®é¢˜ã€‚</p><p>ä»€ä¹ˆæ˜¯å†™å€¾æ–œï¼Ÿæˆ‘ä»¬è¿˜æ˜¯æ‹¿è´¦æˆ·ä½™é¢çš„ä¾‹å­æ¥è¯´æ˜ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬çš„è´¦æˆ·éœ€è¦æ”¯æŒä¸»å‰¯å¡ï¼Œä¸»å¡å’Œå‰¯å¡éƒ½åˆ†åˆ«æœ‰è‡ªå·±çš„ä½™é¢ï¼Œå¹¶ä¸”è¿™ä¸ªä½™é¢æ˜¯å¯ä»¥é€æ”¯çš„ï¼Œåªè¦æ»¡è¶³ä¸»å‰¯å¡çš„ä½™é¢ä¹‹å’Œå¤§äº0å°±è¡Œäº†ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ç»™ä¸»å¡æ”¯å‡º100å…ƒï¼Œé‚£SQLåªè¦è¿™æ ·å†™å°±å¯ä»¥äº†ï¼š</p><pre><code>update account\nset balance = balance - 100 -- åœ¨ä¸»å¡ä¸­æ‰£å‡100å…ƒ\nwhere id = ? and\n  (select balance from account where id = ?) -- ä¸»å¡ä½™é¢\n  +\n  (select balance from account where id = ?) -- é™„å¡ä½™é¢\n  &gt;= 100; -- ä¸»å‰¯å¡ä½™é¢ä¹‹å’Œå¿…é¡»å¤§äº100å…ƒ\n</code></pre><p>åœ¨ä¼ ç»Ÿçš„RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œç”±äºæ›´æ–°æ•°æ®æ—¶ä¼šå¯¹è®°å½•åŠ é”ï¼Œå³ä½¿æ›´æ–°ä¸»å‰¯å¡çš„ä¸¤ä¸ªSQLåˆ†åˆ«åœ¨ä¸¤ä¸ªäº‹åŠ¡ä¸­å¹¶å‘æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šå‡ºç°æŠŠä¸»å‰¯å¡çš„ä½™é¢ä¹‹å’Œæ‰£å‡æˆè´Ÿæ•°çš„æƒ…å†µã€‚</p><p>ä½†æ˜¯åœ¨SIçº§åˆ«ä¸‹ï¼Œç”±äºå®ƒæ²¡æœ‰åŠ é”ï¼Œè€Œæ˜¯é‡‡ç”¨å¿«ç…§çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡çš„éš”ç¦»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœå¹¶å‘åœ°å»æ›´æ–°ä¸»å‰¯å¡ä½™é¢ï¼Œæ˜¯æœ‰å¯èƒ½å‡ºç°æŠŠä¸»å‰¯å¡ä½™é¢ä¹‹å’Œæ‰£å‡ä¸ºè´Ÿæ•°çš„æƒ…å†µçš„ã€‚è¿™ç§æƒ…å†µç§°ä¸º<strong>å†™å€¾æ–œ</strong>ã€‚è¿™é‡Œé¡ºä¾¿æä¸€å¥ï¼Œå†™å€¾æ–œæ˜¯æ™®éçš„è¯‘æ³•ï¼Œæˆ‘ä¸ªäººè§‰å¾—â€œå€¾æ–œâ€è¿™ä¸ªè¯ç¿»è¯‘å¾—å¹¶ä¸å‡†ç¡®ï¼Œå®é™…ä¸Šå®ƒè¡¨è¾¾çš„ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰æ£€æµ‹è¯»å†™å†²çªï¼Œä¹Ÿæ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´æ•°æ®å†™é”™äº†ã€‚</p><p>SSIéš”ç¦»çº§åˆ«åœ¨SIçš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†å†²çªæ£€æµ‹çš„æœºåˆ¶ï¼Œé€šè¿‡æ£€æµ‹è¯»å†™å†²çªï¼Œç„¶åå›æ»šäº‹åŠ¡çš„æ–¹å¼æ¥è§£å†³å†™å€¾æ–œçš„é—®é¢˜ï¼Œå½“ç„¶è¿™ç§æ–¹å¼ä»˜å‡ºçš„ä»£ä»·æ˜¯é™ä½æ€§èƒ½ï¼Œå¹¶ä¸”å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œä¼šé¢‘ç¹åœ°å‡ºç°äº‹åŠ¡å›æ»šã€‚</p><p>ä»ç†è®ºä¸Šæ¥è¯´ï¼ŒCockroachDBæ”¯æŒçš„SIå’ŒSSIè¿™ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œèƒ½æä¾›çš„äº‹åŠ¡éš”ç¦»æ€§ï¼Œå·²ç»ä¸ä¼ ç»Ÿçš„RCå’ŒRRéš”ç¦»çº§åˆ«ä¸ç›¸ä¸Šä¸‹äº†ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœ¨çº¿äº¤æ˜“ç±»ç³»ç»Ÿå¯¹ACIDçš„è¦æ±‚ã€‚</p><h2>å°ç»“</h2><p>New SQLæ˜¯æ–°ä¸€ä»£çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå®ƒå…·å¤‡åŸç”Ÿåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿé«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å¯ç”¨å’Œå¼¹æ€§æ‰©å®¹çš„èƒ½åŠ›ï¼ŒåŒæ—¶è¿˜å…¼é¡¾äº†ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„SQLæ”¯æŒã€‚æ›´å‰å®³çš„æ˜¯ï¼Œå®ƒè¿˜æä¾›äº†å’Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¸ç›¸ä¸Šä¸‹çš„ã€çœŸæ­£çš„äº‹åŠ¡æ”¯æŒï¼Œå…·å¤‡äº†æ”¯æ’‘åœ¨çº¿äº¤æ˜“ç±»ä¸šåŠ¡çš„èƒ½åŠ›ã€‚</p><p>CockroachDBæ˜¯å¼€æºçš„New SQLæ•°æ®åº“ã€‚å®ƒçš„å­˜å‚¨å¼•æ“æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼KVå­˜å‚¨é›†ç¾¤ï¼Œæ‰§è¡Œå™¨åˆ™å¤§é‡å€Ÿé‰´äº†PostgreSQLçš„ä¸€äº›è®¾è®¡å’Œå®ç°ï¼Œæ˜¯ä¸€ä¸ªé›†å¾ˆå¤šç°æœ‰æ•°æ®åº“å’Œåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»ŸæŠ€æœ¯äºä¸€èº«ï¼Œè¿™æ ·çš„ä¸€ä¸ªæ•°æ®åº“äº§å“ã€‚</p><p>ä»è®¾è®¡ä¸Šæ¥çœ‹ï¼ŒCockroachDBè¿™ç±»New SQLæ•°æ®åº“ï¼Œæœ‰éå¸¸å¤§çš„æ½œè´¨å¯ä»¥çœŸæ­£åœ°å–ä»£MySQLè¿™ç±»ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿåº”è¯¥çœ‹åˆ°ï¼Œç›®å‰è¿™äº›New SQLæ•°æ®åº“éƒ½è¿˜å¤„äºé«˜é€Ÿå‘å±•é˜¶æ®µï¼Œå¹¶æ²¡æœ‰è¢«å¤§è§„æ¨¡åœ°åº”ç”¨åˆ°ç”Ÿäº§ç³»ç»Ÿä¸­å»ã€‚æˆ‘ä¹Ÿä¸å»ºè®®ä½ åšå°ç™½é¼ ï¼Œåœ¨é‡è¦çš„ç³»ç»Ÿä¸Šå»ä½¿ç”¨å®ƒã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯¾åè¯·ä½ å»çœ‹ä¸€ä¸‹<a href=\"https://raft.github.io/\">Raft</a>ä¸€è‡´æ€§åè®®ï¼Œç„¶åç®€å•æ€»ç»“ä¸€ä¸‹ï¼ŒCockroachDBæ˜¯å¦‚ä½•åˆ©ç”¨Raftåè®®å®ç°Rangeé«˜å¯ç”¨ã€é«˜å¯é å’Œå¼ºä¸€è‡´çš„ã€‚æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘è®¨è®ºã€‚</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"22 | é¢å¯¹æµ·é‡æ•°æ®ï¼Œå¦‚ä½•æ‰èƒ½æŸ¥å¾—æ›´å¿«?","id":224344},"right":{"article_title":"24 | RocksDBï¼šä¸ä¸¢æ•°æ®çš„é«˜æ€§èƒ½KVå­˜å‚¨","id":225400}},"comments":[{"had_liked":false,"id":207883,"user_name":"æç¥","can_delete":false,"product_type":"c1","uid":1501046,"ip_address":"","ucode":"B19E91EE248591","user_header":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","comment_is_top":true,"comment_ctime":1587205192,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.223372154406101e+18","product_id":100046801,"comment_content":"<br>Hiï¼Œæˆ‘æ˜¯æç¥ã€‚<br><br>è¿™é‡Œå›é¡¾ä¸€ä¸‹ä¸ŠèŠ‚è¯¾çš„æ€è€ƒé¢˜ï¼š<br><br>æˆ‘ä»¬è¦åšä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œæ”¶é›†å…¨å…¬å¸æ‰€æœ‰ç³»ç»Ÿçš„å…¨é‡ç¨‹åºæ—¥å¿—ï¼Œç»™å¼€å‘å’Œè¿ç»´äººå‘˜æä¾›æ—¥å¿—çš„æŸ¥è¯¢å’Œåˆ†ææœåŠ¡ï¼Œä½ ä¼šé€‰æ‹©ç”¨ä»€ä¹ˆå­˜å‚¨ç³»ç»Ÿæ¥å­˜å‚¨è¿™äº›æ—¥å¿—ï¼ŸåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ<br><br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä»ç„¶éœ€è¦æ ¹æ®ä¸šåŠ¡å¯¹æ•°æ®çš„æŸ¥è¯¢æ–¹å¼ï¼Œåæ¨æ•°æ®åº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨ç³»ç»Ÿã€‚å¯¹äºæ—¥å¿—çš„æŸ¥è¯¢ï¼Œæœ€å¸¸ç”¨çš„äºŒç§æ–¹å¼å°±æ˜¯æŒ‰ç…§å…³é”®å­—å»æŸ¥è¯¢æˆ–è€…æŒ‡å®šä¸€ä¸ªæ—¶é—´å’ŒIPå»æµè§ˆã€‚<br><br>å¦‚æœè¯´ï¼Œæ—¥å¿—çš„é‡çº§ä¸è¶…è¿‡TBçº§åˆ«ï¼Œç›´æ¥æ”¾åˆ°ESé‡Œé¢æœ€çœäº‹ï¼Œå¯¹äºäºŒç§æŸ¥è¯¢æ–¹å¼éƒ½å¯ä»¥è·å¾—è¿˜ä¸é”™çš„æŸ¥è¯¢æ€§èƒ½ã€‚å¦‚æœè§„æ¨¡å¤ªå¤§äº†ï¼ŒESä¹Ÿæ‰›ä¸ä½çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘æŠŠæ—¥å¿—æ”¾åˆ°HDFSä¸­ï¼Œå¯¹äºæµè§ˆçš„æŸ¥è¯¢éœ€æ±‚ï¼Œç›´æ¥å®šä½çš„å…·ä½“çš„æ—¥å¿—æ–‡ä»¶è¿”å›æ˜¯æ¯”è¾ƒå¿«çš„ã€‚å¯¹äºå…³é”®å­—æŸ¥è¯¢çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç°Map-Reduceä»»åŠ¡ï¼Œå¹¶è¡ŒæŸ¥è¯¢ç„¶åèšåˆçš„æ–¹å¼æ¥å®ç°ã€‚","like_count":28},{"had_liked":false,"id":207714,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1587151351,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"40241857015","product_id":100046801,"comment_content":"ä¸çŸ¥é“è€å¸ˆæ˜¯å¦æœ‰å‘ç°ä¸€ç‚¹ï¼Œç°åœ¨å¤§é‡çš„Analyze DBåœ¨å¯¹ä¹‹å‰çš„MYSQLæˆ–PG SQLåšè¡¥å……ï¼›é¦–å½“å…¶å†²çš„åº”å½“æ˜¯é˜¿é‡Œæœ€è¿‘æ¨å‡ºçš„æ­¤ç±»DBï¼›tidbåšä¸ºå›½äº§æ•°æ®åº“-ç›®å‰å‡ ä¹èšé›†äº†å›½å†…å¤§å¤šæ‰€æœ‰çš„RMDBæ–¹é¢çš„ç¥äººï¼Œåº”å½“æ˜¯ç»§OceanBaseä¹‹ååˆä¸€ä¸ªå›½å†…çœŸæ­£æ±‡èšé¡¶çº§DBç›¸å…³äººæ‰æ‰“é€ çš„æ•°æ®åº“ã€‚è€å¸ˆå¦‚ä½•å»çœ‹å¾…tidb?<br>è°¢è°¢è€å¸ˆçš„åˆ†äº«ï¼ŒæœŸå¾…åç»­çš„ç»§ç»­åˆ†äº«ã€‚","like_count":9,"discussions":[{"author":{"id":1011437,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6e/ed/22ea0e68.jpg","nickname":"Gordon","note":"","ucode":"BC22D73AF990ED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279248,"discussion_content":"å¬è¯´ä½ å®ç°æ¢¦æƒ³æˆ‘8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591316571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109041,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ec/31/644fc4cd.jpg","nickname":"æœ‰è¯¾å­¦","note":"","ucode":"9A8D5E9B9FDA62","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264006,"discussion_content":"æˆ‘ä¹Ÿæƒ³é—®æ¥ç€ï¼Œçœ‹è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯ä¸æ˜¯è¦æå‰å»äº†è§£ä¸‹ TiDB?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589279403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207868,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1587200797,"is_pvip":true,"replies":[{"id":"77834","content":"æ˜¯çš„ï¼Œåº•å±‚çš„åˆ†å¸ƒå¼å­˜å‚¨å¼•æ“ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯KVã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1587351433,"ip_address":"","comment_id":207868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31651971869","product_id":100046801,"comment_content":"New SQL æ•°æ®åº“æ˜¯ä¸æ˜¯éƒ½æ˜¯è¿™æ ·è®¾è®¡çš„ï¼Ÿ æ‰§è¡Œå™¨æ”¯æŒ SQLï¼Œç„¶ååº•å±‚çš„å­˜å‚¨ç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Ÿ åŒºåˆ«åœ¨ä¸åº•å±‚çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿå®ç°çš„åŸç†ä¸ä¸€æ ·ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492264,"discussion_content":"æ˜¯çš„ï¼Œåº•å±‚çš„åˆ†å¸ƒå¼å­˜å‚¨å¼•æ“ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯KVã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587351433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217285,"user_name":"è‹—","can_delete":false,"product_type":"c1","uid":1088710,"ip_address":"","ucode":"5ECCC6C855E541","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/c6/05a6798f.jpg","comment_is_top":false,"comment_ctime":1589454679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27359258455","product_id":100046801,"comment_content":"mongodb 4.2.6ä¹Ÿæ”¯æŒrcå’Œrrçº§åˆ«çš„äº‹åŠ¡äº†ï¼›è€å¸ˆä¼¼ä¹å¾ˆå°‘æåˆ°mongodbã€‚","like_count":7},{"had_liked":false,"id":211344,"user_name":"çœŸåä¸å«é»„é‡‘","can_delete":false,"product_type":"c1","uid":1174066,"ip_address":"","ucode":"FB611FC98F5BA7","user_header":"https://static001.geekbang.org/account/avatar/00/11/ea/32/1fd102ec.jpg","comment_is_top":false,"comment_ctime":1587950607,"is_pvip":false,"replies":[{"id":"78788","content":"æˆ‘ä»¬å€’ä¸ç”¨çº ç»“è¿™ä¸ªæ¦‚å¿µï¼ŒæŒ‰ä½ è®¾å®šçš„åœºæ™¯ï¼Œç¡®å®ä¼šå‡ºç°ä¸æ»¡è¶³ä¸šåŠ¡çº¦æŸçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸€å®šè¦æŠŠçº¦æŸå†™åˆ°æ›´æ–°è¯­å¥ä¸­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1588049823,"ip_address":"","comment_id":211344,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18767819791","product_id":100046801,"comment_content":"è€å¸ˆè®²å¾—éå¸¸å¥½~<br>ä¸è¿‡æˆ‘æœ‰ä¸€ä¸ªå°é—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œæ–‡ä¸­è¯´åˆ°MySQLçš„RRçº§åˆ«æ˜¯æ²¡æœ‰Write Skewçš„ï¼Œä½†æ˜¯RRä½¿ç”¨çš„æ˜¯MVCCè¯»ï¼Œä¹Ÿæ˜¯å¿«ç…§è¯»ï¼Œç†è®ºä¸Šä¹Ÿä¼šæœ‰Write Skewé—®é¢˜ï¼Œæˆ‘åˆšåˆšæµ‹è¯•äº†ä¸€ä¸‹ï¼ŒRRçš„äº‹åŠ¡ä¸­è¿›è¡Œè¯»å–ï¼Œæ˜¯å¿«ç…§è¯»ä¸åŠ é”ï¼Œå¦‚æœå°†è€å¸ˆæ–‡ä¸­çš„å­æŸ¥è¯¢æ‹†åˆ†å‡ºæ¥ï¼Œå‘ä¸Šæï¼Œå…ˆè¿›è¡Œå­æŸ¥è¯¢çš„ä½™é¢æ£€æŸ¥ï¼Œå†è¿›è¡Œæ›´æ–°ï¼Œå¼€å¯2ä¸ªäº‹åŠ¡åˆ†åˆ«æ›´æ–°çˆ¶å­è´¦æˆ·ï¼Œçˆ¶è´¦æˆ·å…ˆè¯»å–æ£€æŸ¥ä½™é¢ï¼Œäººä¸ºæ²¡é—®é¢˜ï¼Œç„¶åå­è´¦æˆ·è¯»å–æ£€æŸ¥ä½™é¢ï¼Œä¹Ÿè®¤ä¸ºæ²¡é—®é¢˜ï¼Œç„¶åå­è´¦æˆ·æ›´æ–°ä½™é¢å¹¶æäº¤ï¼Œçˆ¶è´¦æˆ·æ›´æ–°ä½™é¢å†æäº¤ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½å¯ä»¥æˆåŠŸï¼Œä½†ä½™é¢ä¸æ»¡è¶³ä¸šåŠ¡çº¦æŸäº†ï¼Œä¹Ÿå°±æ˜¯Write Skewäº†ï¼Œæ‰€ä»¥è¯´æˆ‘çš„ç†è§£æ˜¯ï¼ŒRRæ˜¯å¯èƒ½ä¼šå‡ºç°Write Skewçš„ï¼Œä¸çŸ¥é“ç†è§£æœ‰æ²¡æœ‰é—®é¢˜","like_count":4,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493255,"discussion_content":"æˆ‘ä»¬å€’ä¸ç”¨çº ç»“è¿™ä¸ªæ¦‚å¿µï¼ŒæŒ‰ä½ è®¾å®šçš„åœºæ™¯ï¼Œç¡®å®ä¼šå‡ºç°ä¸æ»¡è¶³ä¸šåŠ¡çº¦æŸçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸€å®šè¦æŠŠçº¦æŸå†™åˆ°æ›´æ–°è¯­å¥ä¸­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588049823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1461075,"avatar":"https://static001.geekbang.org/account/avatar/00/16/4b/53/f797f031.jpg","nickname":"æ— é“win","note":"","ucode":"0C026BB03A53EA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304841,"discussion_content":"é‚£ä¸¤ä¸ªæŸ¥è¯¢å†™åˆ°æ›´æ–°è¯­å¥ä¸­å°±æ˜¯å½“å‰è¯»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599696202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207716,"user_name":"icyricky","can_delete":false,"product_type":"c1","uid":1302556,"ip_address":"","ucode":"D63C285165309D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","comment_is_top":false,"comment_ctime":1587161123,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"18767030307","product_id":100046801,"comment_content":"å…¬å¸æœ‰ç”¨TiDBâ€¦æ„Ÿè§‰æ¶æ„å¾ˆåƒâ€¦è¿˜æ˜¯leaderä»»æœŸä¹‹åçš„ç»­ç§Ÿè¿˜æ˜¯é€‰ä¸¾ï¼Œå¤šæ•°ç¥¨åŒæ„é€‰å‡ºleaderï¼Œfollowerä»leaderå¤åˆ¶æ•°æ®â€¦æ£€æµ‹å¿ƒè·³â€¦åœ¨leaderå®•æœºä¹‹åå‘èµ·æ–°ä¸€è½®é€‰ä¸¾ï¼›leaderå¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´","like_count":5,"discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366586,"discussion_content":"å…¬å¸ç”¨TiDBæ˜¯CTOå†³å®šçš„å˜›ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618126265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1433535,"avatar":"https://static001.geekbang.org/account/avatar/00/15/df/bf/96b50d1e.jpg","nickname":"ğŸ˜š 46","note":"","ucode":"EED0EBBBF80A43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239197,"discussion_content":"æœ‰å‘å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587283721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1433535,"avatar":"https://static001.geekbang.org/account/avatar/00/15/df/bf/96b50d1e.jpg","nickname":"ğŸ˜š 46","note":"","ucode":"EED0EBBBF80A43","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240141,"discussion_content":"æ–°äº§å“ï¼Œè‚¯å®šæœ‰å‘å‘€â€¦ä¸è¿‡é—®é¢˜ä¿®å¤çš„ä¹Ÿæ¯”è¾ƒå¿«â€¦ç¤¾åŒºä¹Ÿåœ¨åŠªåŠ›å»ºè®¾ä¸­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587343420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239197,"ip_address":""},"score":240141,"extra":""},{"author":{"id":1109041,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ec/31/644fc4cd.jpg","nickname":"æœ‰è¯¾å­¦","note":"","ucode":"9A8D5E9B9FDA62","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264007,"discussion_content":"èƒ½è¯´è¯´éƒ½æœ‰å“ªäº›å‘ä¹ˆï¼Œä¸¥é‡ä¸ï¼Ÿæƒ³å…¥å‘ï¼Œå“ˆå“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589279459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":240141,"ip_address":""},"score":264007,"extra":""},{"author":{"id":1302556,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e0/1c/aa50dc27.jpg","nickname":"icyricky","note":"","ucode":"D63C285165309D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1109041,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ec/31/644fc4cd.jpg","nickname":"æœ‰è¯¾å­¦","note":"","ucode":"9A8D5E9B9FDA62","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":281959,"discussion_content":"ç°åœ¨å¥½å¾ˆå¤šäº†â€¦æ¯ä¸ªç‰ˆæœ¬å‘å¸ƒçš„bug fixå¾ˆå¤šéƒ½æ˜¯æˆ‘çš„è¡€æ³ªå²â€¦æœ‰é—®é¢˜æäº¤ç¤¾åŒºä¿®å¤æ¯”è¾ƒå¿«â€¦å‰é¢ä¸»è¦æ˜¯åŠŸèƒ½çš„ä¸€äº›bugè¿˜æœ‰ç»„ä»¶panicé—®é¢˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1591847818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":264007,"ip_address":""},"score":281959,"extra":""}]}]},{"had_liked":false,"id":217253,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1589449348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10179383940","product_id":100046801,"comment_content":"æˆ‘é¡¹ç›®ç”¨çš„å°±æ˜¯å°å¼ºdbï¼Œçš„ç¡®æ˜¯æœ‰å†™æ€§èƒ½æ¯”ä¸ä¸Šmysqlï¼Œä¹Ÿå‡ºç°äº†ç›¸å…³çš„é”ç«äº‰å¯¼è‡´äº‹åŠ¡å›æ»šçš„é—®é¢˜ï¼Œè§£å†³äº†äº‹åŠ¡é—®é¢˜å¾€å¾€å¸¦æ¥äº†å…¶ä»–æ–°çš„é—®é¢˜ï¼Œæ‰€ä»¥è¯´newSQLå¹¶ä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯é“¶å¼¹:-D","like_count":3},{"had_liked":false,"id":207764,"user_name":"Lukia","can_delete":false,"product_type":"c1","uid":1028698,"ip_address":"","ucode":"C19472337BCCC6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b2/5a/574f5bb0.jpg","comment_is_top":false,"comment_ctime":1587176297,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5882143593","product_id":100046801,"comment_content":"ä¸çŸ¥é“cockroachçš„ä¸¤ç§éš”ç¦»çº§åˆ«æ˜¯ä¸æ˜¯å€Ÿé‰´äº†postgresçš„åšæ³•","like_count":2,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237961,"discussion_content":"åº”è¯¥æ˜¯çš„ï¼Œå€Ÿé‰´äº†å¥½å¤š\nè€Œä¸”æ”¯æŒ PostgreSQL çš„åè®®ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨\nCockroachDB supports the PostgreSQL wire protocol, so you can use any available PostgreSQL client drivers to connect from various languages.","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1587201115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339120,"user_name":"anthony","can_delete":false,"product_type":"c1","uid":1032896,"ip_address":"","ucode":"BA716F89900570","user_header":"","comment_is_top":false,"comment_ctime":1647932451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647932451","product_id":100046801,"comment_content":"è€å¸ˆ mysql çš„åˆ†åŒºè¡¨æŠ€æœ¯ç°åœ¨åœ¨ä¼ä¸šé‡Œé¢ç”¨çš„å¤šå— oracle çš„åˆ†åŒºæŠ€æœ¯åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ä½¿ç”¨çš„éå¸¸å¤š","like_count":0},{"had_liked":false,"id":287725,"user_name":"å¤œè¾‰","can_delete":false,"product_type":"c1","uid":1886331,"ip_address":"","ucode":"9421385F51FF9E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","comment_is_top":false,"comment_ctime":1618126390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618126390","product_id":100046801,"comment_content":"å†²çªæ£€æµ‹æœºåˆ¶æ˜¯æ–°æŠ€æœ¯å§","like_count":0},{"had_liked":false,"id":249673,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1600753658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600753658","product_id":100046801,"comment_content":"raftåè®®ï¼Œè¦æ±‚å…¨ç³»ç»Ÿçš„èŠ‚ç‚¹å…¨è¿æ¥ã€‚æŒ‰ç…§æŠ•ç¥¨æ•°æœ€å¤šçš„åŸåˆ™é€‰ä¸¾ä¸»èŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹å»ä¸»åŠ¨åŒæ­¥ä»èŠ‚ç‚¹çš„æ•°æ®ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚å¦‚æœä¸»èŠ‚ç‚¹failï¼ˆè¶…æ—¶æˆ–stopï¼‰åˆ™é‡æ–°é€‰ä¸¾ä¸»èŠ‚ç‚¹ã€‚é€‰ä¸¾æ—¶ï¼Œå€™é€‰èŠ‚ç‚¹ä¼šå¹¿æ’­RequestVoteè¯·æ±‚ã€‚","like_count":0},{"had_liked":false,"id":211554,"user_name":"ä¸€å‰‘","can_delete":false,"product_type":"c1","uid":1022127,"ip_address":"","ucode":"93ADD5B5215D4C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/af/3945cea4.jpg","comment_is_top":false,"comment_ctime":1587982239,"is_pvip":false,"replies":[{"id":"78787","content":"è¿™é‡Œé¢ä¸ä¼šå‘ç”Ÿæ­»é”ï¼Œä¸»å¡å’Œå‰¯å¡åˆ†åˆ«æ˜¯äºŒä¸ªè´¦æˆ·ï¼Œè€Œä¸”ä¸éœ€è¦åŒæ—¶æŒæœ‰è¿™2ä¸ªè´¦æˆ·çš„é”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1588049628,"ip_address":"","comment_id":211554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587982239","product_id":100046801,"comment_content":"ä¾‹å­ä¸­ï¼Œä¸»å¡æ›´æ–°å’Œå‰¯å¡æ›´æ–°åŒæ—¶åœ¨ä¸¤ä¸ªäº‹åŠ¡é‡Œæ‰§è¡Œï¼Œå®¹æ˜“å¯¼è‡´æ­»é”å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493296,"discussion_content":"è¿™é‡Œé¢ä¸ä¼šå‘ç”Ÿæ­»é”ï¼Œä¸»å¡å’Œå‰¯å¡åˆ†åˆ«æ˜¯äºŒä¸ªè´¦æˆ·ï¼Œè€Œä¸”ä¸éœ€è¦åŒæ—¶æŒæœ‰è¿™2ä¸ªè´¦æˆ·çš„é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588049628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}