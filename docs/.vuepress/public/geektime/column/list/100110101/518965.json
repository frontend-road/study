{"id":518965,"title":"21ï½œæ··åˆåº”ç”¨ï¼šå¦‚ä½•ä»é›¶å¼€å§‹é›†æˆ React Nativeï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥ React Native åŸºç¡€è®¾æ–½å»ºè®¾ç¯‡çš„å­¦ä¹ ã€‚æˆ‘ä¹Ÿç‰¹åœ°é‚€è¯·äº†å¤šå¹´ä»¥æ¥å’Œæˆ‘ä¸€èµ·åš 58RN åŸºå»ºçš„ä¸¤ä½è€æ­æ¡£ï¼š58RN Android è´Ÿè´£äººå†µä¼—æ–‡å’Œ58RN iOS è´Ÿè´£äººæœ´æƒ å§ä¸€èµ·æ¥è®²è§£ã€‚</p><p>åœ¨åŸºç¡€è®¾æ–½å»ºè®¾ç¯‡ä¸­ï¼Œä¼—æ–‡è€å¸ˆã€æƒ å§è€å¸ˆä¼šå’Œæˆ‘ä¸€èµ·ä¸ºä½ è¯¦ç»†ä»‹ç»æ€ä¹ˆæ­å»º React Native æ··åˆåº”ç”¨ã€æ€ä¹ˆåˆ›å»ºæ–°æ¶æ„çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œä»¥åŠæ€ä¹ˆè‡ªç ”çƒ­æ›´æ–°å¹³å°ï¼Œåˆæ€ä¹ˆè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><p>æ— è®ºä½ æ˜¯ FEã€Android è¿˜æ˜¯ iOSï¼Œç›¸ä¿¡åŸºå»ºç¯‡çš„å†…å®¹éƒ½èƒ½è®©ä½ å¤§æœ‰æ”¶è·ï¼Œç”šè‡³å¸®åŠ©ä½ åœ¨å…¬å¸ä¸­æ™‹çº§ã€‚å¥½äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ­£å¼å¼€å¯åŸºå»ºç¯‡çš„å­¦ä¹ ã€‚</p><hr><p>ä½ å¥½ï¼Œæˆ‘æ˜¯å†µä¼—æ–‡ï¼Œæ˜¯ 58RN è´Ÿè´£Android ç«¯çš„åŒå­¦ã€‚æ¥ä¸‹æ¥åŸºç¡€è®¾æ–½å»ºè®¾ç¯‡ä¸­ç§»åŠ¨ç«¯ç›¸å…³çš„å‡ è®²ï¼Œå°†ç”±æˆ‘å’Œæˆ‘çš„åŒäº‹ï¼Œè´Ÿè´£iOS ç«¯çš„åŒå­¦æœ´æƒ å§ä¸€èµ·æ¥è®²è§£ã€‚</p><p>è¿™å‡ è®²æ˜¯ã€Šæ··åˆåº”ç”¨ï¼šå¦‚ä½•ä»é›¶å¼€å§‹é›†æˆ React Nativeï¼Ÿã€‹ã€ã€Šè‡ªå®šä¹‰ç»„ä»¶ï¼šå¦‚ä½•æ»¡è¶³ä¸šåŠ¡çš„ä¸ªæ€§åŒ–éœ€æ±‚ï¼Ÿã€‹ï¼Œä»¥åŠã€Šå®¢æˆ·ç«¯ä¼˜åŒ–ï¼šå¦‚ä½•æŠŠæ€§èƒ½æå‡åˆ°æè‡´ï¼Ÿã€‹ã€‚åœ¨è¿™ä¸‰è®²ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆè‡ªå·±åœ¨ React Native å¼€å‘çš„å®é™…ç»éªŒï¼Œä»¥åŠçœŸå®çš„ä¸šåŠ¡æ¡ˆä¾‹ï¼Œå’Œä½ ä¸€èµ·å¾ªåºæ¸è¿›åœ°èµ°å…¥æ··åˆå¼€å‘çš„ä¸–ç•Œã€‚</p><p>è€Œä¸”ï¼Œæˆ‘ä»¬è¿™å‡ è®²å°†ä½¿ç”¨ React Native æœ€æ–°æ¡†æ¶æ¥è®²è§£ï¼Œä½ ä¹Ÿå¯ä»¥å€Ÿæ­¤äº†è§£ Fabricã€TurboModulesã€CodeGenã€JSIã€Hermes ç­‰æ–°æ¦‚å¿µã€‚</p><!-- [[[read_end]]] --><p>ä½†åœ¨æ­£å¼å¼€å§‹è®²è§£æ€ä¹ˆåšæ··åˆå¼€å‘ä¹‹å‰ï¼Œæƒ³å…ˆç”¨ä¸€äº›ç¯‡å¹…ï¼Œç®€å•è·Ÿä½ ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ··åˆåº”ç”¨ä¸æ··åˆå¼€å‘ï¼Œä»¥åŠæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™éœ€è¦ç”¨åˆ°æ··åˆå¼€å‘ã€‚</p><h2>App æ··åˆå¼€å‘æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>App æ··åˆå¼€å‘ï¼ŒæŒ‡çš„æ˜¯<strong>ä¸€ä¸ª App éƒ¨åˆ†åŠŸèƒ½ç”¨ Native æ„å»ºï¼Œéƒ¨åˆ†åŠŸèƒ½ç”¨è·¨ç«¯æ¡†æ¶æ„å»º</strong>ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„è·¨ç«¯æ¡†æ¶æœ‰ H5ã€React Nativeã€Flutterã€å¸ƒå±€åŠ¨æ€åŒ–ç­‰ã€‚å½“ç„¶æˆ‘ä»¬è¿™é—¨è¯¾ä¸»è¦æ˜¯å›´ç»•ç€React Nativeæ¥è¿›è¡Œè®²è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/be/24/bed77cfbc69b490ae759a3166fb88b24.png?wh=1854x594\" alt=\"\"></p><p>ä»¥ Native ä¸ React Native æ··åˆå¼€å‘ä¸ºä¾‹ï¼Œåœ¨åŒä¸€ä¸ª App ä¸­ï¼Œé€šå¸¸å­˜åœ¨ä»¥ä¸‹å‡ ç§å½¢æ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/db/fc/db3e0383979b499652d6dfef81a051fc.jpg?wh=1755x818\" alt=\"å›¾ç‰‡\"></p><p>é‚£ä¹ˆï¼ŒNative ä¸ React Native æ··åˆå¼€å‘ä¸€èˆ¬ä¼šç”¨åœ¨å“ªå„¿å‘¢ï¼Ÿ</p><p>é¦–å…ˆæ˜¯ä¸€äº›å¤§å‹Appä¸­ï¼Œæ¯”å¦‚ç¾å›¢ã€æºç¨‹ã€äº¬ä¸œã€58ç­‰ã€‚è¿™äº›å¤§å‹ App ä¸€èˆ¬éƒ½éå¸¸å¤æ‚ï¼Œæ•´ä¸ªæ¡†æ¶éœ€è¦åŒ…å«æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–ã€æ’ä»¶åŒ–ã€è·¨ç«¯ç­‰èƒ½åŠ›ã€‚ç›¸æ¯”çº¯ React Native å·¥ç¨‹ï¼Œå¤§å‹Appçš„å®é™…ä¸šåŠ¡å¼€å‘è¿˜éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨å·²æœ‰åŸç”Ÿé¡¹ç›®ä¸­å¼•å…¥ React Nativeï¼Œä½œä¸ºåŸç”Ÿæ¡†æ¶çš„æ‰©å±•èƒ½åŠ›ã€‚æ¯”å¦‚ï¼Œéƒ¨åˆ†ä¸šåŠ¡å¯èƒ½å¯¹å¼€å‘æ•ˆç‡ã€å¤šç«¯ä¸€è‡´æ€§ã€åŠ¨æ€æ›´æ–°èƒ½åŠ›æœ‰è¾ƒå¼ºè¦æ±‚ï¼Œå°±å¯ä»¥ä½¿ç”¨ React Native æ¥å®ç°ã€‚</p><p>é™¤äº†å¤§å‹ App å¤–ï¼Œå¦‚æœä½ è¦å¯¹å·²ä¸Šçº¿çš„é¡¹ç›®å¼•å…¥ React Native ä¹Ÿéœ€è¦ä½¿ç”¨æ··åˆæ¨¡å¼ã€‚å› ä¸ºåŸç”Ÿæ”¹é€ æˆ React Native å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿå¼€å‘è¯­è¨€ã€é¡µé¢ç®¡ç†ã€æ¨¡å—ç®¡ç†å®Œå…¨æ˜¯å¦ä¸€å¥—ä¸œè¥¿ï¼Œè€Œä¸”ä¸€äº›åŸç”Ÿé¡µé¢ï¼Œå¦‚å¯åŠ¨é¡µã€é¦–é¡µç­‰ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå¤§éƒ½è¿˜æ˜¯ä¼šé€‰æ‹©åŸç”Ÿæ¥å®ç°ã€‚</p><p>å½“ç„¶ä¸€äº›æ–°å¼€å‘çš„è½»é‡çº§ Appï¼Œå»ºè®®ä½ é€‰æ‹©çº¯ React Native æ¨¡å¼ã€‚å› ä¸ºæ–°å¼€å‘çš„ App æ²¡æœ‰æŠ€æœ¯å€ºï¼Œå¯ä»¥ä»0åˆ°1äº«å— React Native è·¨ç«¯çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚é¡¹ç›®æœ€å…³å¿ƒçš„å¼€å‘æˆæœ¬ã€‚</p><p>é‚£ä¹ˆæ··åˆå¼€å‘åˆæœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼Ÿç®€å•è¯´æœ‰è¿™å‡ ç‚¹ï¼š</p><ul>\n<li>å¼€å‘æ•ˆç‡é«˜ï¼Œä¸€å¥—ä»£ç å¯ä»¥åœ¨ Androidã€iOS ä¸Šè¿è¡Œï¼›</li>\n<li>æ›´æ–°éƒ¨ç½²æ–¹ä¾¿ï¼Œæ— é¡»ä¾èµ–åº”ç”¨å¸‚åœºå‘ç‰ˆï¼Œè¿­ä»£æ›´æ–°é€Ÿåº¦å¿«ï¼›</li>\n<li>å…·å¤‡åŠ¨æ€æ›´æ–°èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯å›½å†… Appï¼Œä»¥ Android ä¸ºä¾‹ï¼Œå—é™äº Google Playï¼Œæ— æ³•ä½¿ç”¨ Android App bundleï¼Œè€Œæ’ä»¶åŒ–æ¡†æ¶åˆå­˜åœ¨ç¨³å®šæ€§é—®é¢˜ã€‚è€Œä¸šåŠ¡å¿«é€Ÿè¿­ä»£ã€Bug å“åº”é€Ÿåº¦éƒ½å¯¹åŠ¨æ€æ›´æ–°èƒ½åŠ›æœ‰å¼ºçƒˆçš„éœ€æ±‚ã€‚</li>\n</ul><p>ä½†æ··åˆå¼€å‘ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä½ è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><ul>\n<li><strong>æ€§èƒ½ä¸ä½³</strong>ã€‚H5 æ¸²æŸ“é“¾è·¯é•¿ï¼›React Native ä¾æ‰˜äº JS bridge äº¤äº’ ï¼ˆæŒ‡æ—§ç‰ˆï¼Œæœ€æ–°æ¶æ„ä½¿ç”¨ JSIï¼‰ï¼›è™½ç„¶ Flutter ç»˜åˆ¶æµç¨‹ç›´æ¥ä½¿ç”¨ Skiaï¼Œä½†ä¾èµ–äºåŸç”Ÿçš„èƒ½åŠ›ä»éœ€å¼‚æ­¥äº¤äº’ï¼›</li>\n<li><strong>å…¼å®¹æ€§å·®</strong>ã€‚Androidã€iOS å„ç‰ˆæœ¬éƒ½å­˜åœ¨å„ç§å…¼å®¹æ€§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ Android ç¢ç‰‡åŒ–ä¸¥é‡ï¼›</li>\n<li><strong>é—®é¢˜æ’æŸ¥æˆæœ¬é«˜</strong>ã€‚è·¨ç«¯æ¡†æ¶ä¸€èˆ¬æ¶‰åŠ Nativeã€FEã€Serverï¼Œä¸­é—´åšäº†å¤§é‡çš„æ¡¥æ¥è½¬æ¢ï¼Œæ’æŸ¥é“¾è·¯æ¯”çº¯ Native é•¿ï¼›</li>\n<li><strong>åŠ¨æ€åŒ–èƒ½åŠ›å—é™</strong>ã€‚ç›¸æ¯”çº¯åŸç”Ÿçš„æ’ä»¶åŒ–ï¼Œè·¨ç«¯æ¡†æ¶åŠ¨æ€æ›´æ–°çš„ä¸šåŠ¡å¦‚æœæ¶‰åŠ Native éƒ¨åˆ†çš„ç»„ä»¶æ›´æ–°ï¼Œéœ€è¦ä¾èµ– App å‘ç‰ˆã€‚</li>\n</ul><p>ç°åœ¨ä¸€èˆ¬å¤§å‹ App éƒ½æ˜¯å¤šå¥—è·¨ç«¯æ¡†æ¶å¹¶å­˜çš„ï¼Œæ¯”å¦‚ H5 + React Native + å¸ƒå±€åŠ¨æ€åŒ–ï¼Œæˆ– H5 + Flutterï¼Œå…·ä½“é€‰å‹ä¸»è¦ä»¥ä¸šåŠ¡åœºæ™¯ã€åŒ…å¤§å°ã€æ€§èƒ½ã€è¿è¡Œå†…å­˜ã€åŠ¨æ€æ›´æ–°èƒ½åŠ›ä¸ºæ ‡å‡†è¿›è¡Œã€‚ä½†è¿™ä¸€è®²æˆ‘ä»¬ä¼šä» React Nativeè§†è§’å¸¦ä½ ä¸€æ­¥æ­¥æ„å»ºæ··åˆåº”ç”¨ã€‚</p><p>åœ¨React Nativeçš„æ··åˆå¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸‹é¢è¿™å‡ ä¸ªä¸»è¦é—®é¢˜å’Œæµç¨‹ï¼š</p><ul>\n<li>å¦‚ä½•ä» 0ï½1 è¿›è¡Œç¯å¢ƒé…ç½®ï¼›</li>\n<li>é€šç”¨çš„ React Native è½½ä½“é¡µå¦‚ä½•è®¾è®¡ï¼Œéœ€è¦åŒ…å«å“ªäº›èƒ½åŠ›ï¼›</li>\n<li>å¦‚ä½•è°ƒè¯•æ‰“åŒ…å‘å¸ƒï¼›</li>\n<li>é‡åˆ°æ··åˆå¼€å‘çš„ bug å¦‚ä½•è¿›è¡Œæ’æŸ¥ä¸ä¿®å¤ã€‚</li>\n</ul><p>è¿™äº›é—®é¢˜å’Œæµç¨‹ï¼Œæˆ‘ä»¬å°†ä» Android &amp; iOS ä¸¤ç«¯é€æ­¥è®²è§£ã€‚</p><h2>ç¯å¢ƒé…ç½®</h2><p>æˆ‘ä»¬å…ˆä» Native ç¯å¢ƒé…ç½®å¼€å§‹ï¼Œå…ˆçœ‹çœ‹å¦‚ä½•åœ¨ Android ç«¯è¿›è¡Œæ··åˆå·¥ç¨‹ä¸‹çš„ React Native ç¯å¢ƒé…ç½®ã€‚</p><h3>Android</h3><h4>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœ¬åœ°å·¥ç¨‹</h4><p>æˆ‘ä»¬ä½¿ç”¨ Android Studio åˆ›å»ºä¸€ä¸ªæ–°çš„ App é¡¹ç›®ï¼Œå¦‚æœä½ å·²ç»æœ‰äº†æœ¬åœ°é¡¹ç›®ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚å¡«å†™å®Œé¡¹ç›®åç§°ã€åŒ…åã€é¡¹ç›®æœ¬åœ°è·¯å¾„åï¼Œç‚¹å‡» â€œFinishâ€ æŒ‰é’®ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªé¡¹ç›®åç§°å–åä¸º â€œGeekTimeRNAndroidâ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/00/78/00693ac394ea2b67f8b99913fc51fd78.jpg?wh=1792x1338\" alt=\"å›¾ç‰‡\"></p><p>åˆ›å»ºå¥½çš„å·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7f/da/7fe5fe8662cce3e513ed0b89e2aa78da.jpg?wh=954x902\" alt=\"å›¾ç‰‡\"></p><h4>ç¬¬äºŒæ­¥ï¼šæ·»åŠ ä¾èµ–</h4><p>åˆ›å»ºå¥½æœ¬åœ°å·¥ç¨‹åï¼Œæˆ‘ä»¬å°±è¦ç»™å®ƒæ·»åŠ ä¾èµ–ã€‚å…¶å®ï¼ŒReact Nativeå®˜æ–¹å¯¹é›†æˆåˆ°ç°æœ‰çš„åŸç”Ÿåº”ç”¨æä¾›äº†ç›¸åº”çš„<a href=\"https://reactnative.cn/docs/integration-with-existing-apps\">æ–‡æ¡£</a>ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚</p><p>æ–‡æ¡£æç¤ºï¼Œæˆ‘ä»¬éœ€è¦â€œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ç”¨äºå­˜æ”¾ React Native é¡¹ç›®ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª /android å­ç›®å½•ï¼ŒæŠŠä½ ç°æœ‰çš„ Android é¡¹ç›®æ‹·è´åˆ° /android å­ç›®å½•ä¸­â€ã€‚</p><p>å½“ç„¶ï¼Œå®˜æ–¹æä¾›çš„æ–¹å¼æ˜¯éå¸¸ä¸é”™çš„ï¼Œå®ƒæ›´åå‘äº React Native çš„å·¥ç¨‹ç®¡ç†æ¨¡å¼ã€‚è€Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯å·²ç»ä¸Šçº¿çš„é¡¹ç›®é‡Œé¢ï¼ŒReact Native åŠŸèƒ½å’Œå…¶ä»–ä¸šåŠ¡åŠŸèƒ½ä¸€æ ·ï¼Œä¸€èˆ¬ä¼šè¢«å½“æˆåŸç”Ÿå·¥ç¨‹çš„å­æ¨¡å—æ¥ç®¡ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹é€‰æ‹©<strong>åå‘æ··åˆå·¥ç¨‹ç®¡ç†æ–¹å¼</strong>æ¥é›†æˆã€‚</p><p>è¿™é‡Œï¼Œç»™ä½ ç”»äº†ä¸€å¼ å‡ ç§æ¨¡å¼çš„å¯¹æ¯”å›¾ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/13/af/13e5c0527c254bc75a48ffb031ea36af.png?wh=766x1218\" alt=\"å›¾ç‰‡\"></p><p>å¯¹æ¯”å®˜æ–¹æ¨¡å¼ï¼Œæˆ‘ä»¬é‡‡ç”¨æ··åˆå·¥ç¨‹æ¨¡å¼ï¼Œæ˜¯åŸºäºä»¥ä¸‹å‡ ç‚¹è€ƒè™‘çš„ï¼š</p><ul>\n<li>å¯ä»¥ä¸ä¾µå…¥ç°æœ‰å·¥ç¨‹ç»“æ„ï¼ŒReact Native æ¨¡å—ä¼šä½œä¸ºç°æœ‰å·¥ç¨‹çš„ä¸€éƒ¨åˆ†è¿›è¡Œç»„ç»‡ç®¡ç†ã€‚</li>\n<li>ä¸ä¼šå½±å“ä»£ç ä»“åº“ç®¡ç†ï¼Œä¸ç”¨æŠŠAndroidã€iOS æ”¾åœ¨åŒä¸€ä»£ç ä»“åº“ä¸‹è¿›è¡Œç®¡ç†ã€‚</li>\n<li>æ··åˆæ¨¡å¼æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç»„ä»¶åŠŸèƒ½å¤ç”¨ï¼Œä½ å¯ä»¥å°† React Native æ¨¡å—ç‹¬ç«‹æˆç»„ä»¶ï¼Œæä¾›ç»™å…¶ä»– App å¹³å°ä½¿ç”¨ã€‚</li>\n</ul><p>é‚£ä¹ˆï¼ŒåŸºäºæ··åˆå·¥ç¨‹æ¨¡å¼é›†æˆ React Native æ¨¡å—éœ€è¦å“ªäº›ä¾èµ–é¡¹å‘¢ï¼Ÿæˆ‘ä»¬ç»“åˆ<a href=\"https://reactnative.cn/docs/integration-with-existing-apps\">æ–‡æ¡£</a>æ¥çœ‹ä¸‹ï¼Œä¸»è¦æ˜¯ï¼š</p><ul>\n<li><strong>react-native</strong>ï¼šReact Native çš„æ ¸å¿ƒæ¡†æ¶ï¼›</li>\n<li><strong>JavaScript å¼•æ“</strong>ï¼šå¯é€‰ JSCã€Hermesï¼Œç”¨äºæ‰§è¡Œ JavaScriptã€‚<br>\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‚è€ƒæ–‡æ¡£è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</li>\n</ul><pre><code class=\"language-plain\"># åˆ‡æ¢åˆ°åˆšåˆšæ–°å»ºå¥½çš„å·¥ç¨‹ç›®å½•\ncd /Users/kuangzhongwen/Desktop/project/GeekTimeRNAndroid\n\n# æ‰§è¡Œæ·»åŠ  react-native å‘½ä»¤ï¼Œyarn æˆ– npm éƒ½å¯ä»¥\nyarn add react-native\n</code></pre><p>æ‰§è¡Œ yarn add react-native å‘½ä»¤åï¼Œé»˜è®¤ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ React Native åŒ…ã€‚</p><p>å› ä¸ºæˆ‘ä»¬è¿™ä¸ªä¸“æ ä¸»è¦æ˜¯å›´ç»• React Native æ–°æ¶æ„è®²è§£çš„ï¼Œæ‰€ä»¥è¿™è¾¹æˆ‘ä»¬é€‰æ‹© React Native 0.68.0-rc3 ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŒ‡å®š 0.68.0-rc3 è¿™ä¸ªç‰ˆæœ¬ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š(<a href=\"https://github.com/facebook/react-native/tags\">è¿™é‡Œ</a>å¯æŸ¥çœ‹ react-native ç‰ˆæœ¬)ï¼š</p><pre><code class=\"language-plain\">yarn add react-native@0.68.0-rc3\n</code></pre><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç° GeekTimeRNAndroid å·¥ç¨‹ä¸‹å¤šäº†ä¸€ä¸ª node_modules ç›®å½•ï¼Œé‡Œé¢ä¸ä»…æœ‰ react-native æ¡†æ¶ï¼Œè¿˜æœ‰ JavaScript å¼•æ“ç¼–è¯‘å¥½çš„äº§ç‰©ï¼ŒåŒ…æ‹¬ aar å’Œ pom ä¾èµ–æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜æ–¹æä¾›çš„æ–¹å¼ï¼Œå°† node_modules ç›®å½•é…ç½®ä¸º repositoryï¼Œç„¶ååœ¨å·¥ç¨‹ä¸­å¼•å…¥ç›¸å…³ä¾èµ–ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸å¤ªæ¨èï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦ react-native å’Œ JavaScript å¼•æ“è¿™ä¸¤ä¸ªäº§ç‰©å°±å¯ä»¥äº†ã€‚è·å–è¿™ä¸¤ä¸ªäº§ç‰©åï¼Œåœ¨ Android è‡ªå·±è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œç„¶åå‘å¸ƒåˆ°å…¬å¸çš„è¿œç¨‹ä»“åº“ï¼Œå°±ä¸ç”¨å¿å—ä¸€å¤§å †æ— ç”¨çš„æ–‡ä»¶å­˜æ”¾åœ¨é¡¹ç›®ä¸­äº† ï¼ˆè™½ç„¶å¯ä»¥ç”¨ git ignore å¿½ç•¥ï¼‰ã€‚</p><p>ç›®å‰node_modules ç›®å½•é‡Œæœ‰è¿™å‡ ä¸ªå†…å®¹ï¼š</p><ol>\n<li>\n<p>â€¦/GeekTimeRNAndroid/node_modules/react-nativeï¼ˆæœ¬åœ°å®‰è£…å¥½çš„ node_module ä¸­çš„ react-native æ¡†æ¶ç¼–è¯‘äº§ç‰©ï¼‰ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/07/95/07fc4f77e3e9beef92d3bbd3a5b51e95.png?wh=904x1008\" alt=\"å›¾ç‰‡\"></p>\n</li>\n<li>\n<p>â€¦/GeekTimeRNAndroid/node_modules/JavaScriptc-androidï¼ˆæœ¬åœ°å®‰è£…å¥½çš„ node_module ä¸­çš„ JSC å¼•æ“ç¼–è¯‘äº§ç‰©ï¼‰ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/94/a5/943210c6d1ea945e04eb736ca0826ba5.png?wh=792x996\" alt=\"å›¾ç‰‡\"></p>\n</li>\n<li>\n<p>â€¦/GeekTimeRNAndroid/node_modules/hermes-engineï¼ˆæœ¬åœ°å®‰è£…å¥½çš„ node_module ä¸­çš„ Hermes å¼•æ“ç¼–è¯‘äº§ç‰©ï¼‰ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/yy/1f/yy5e3402386d417d0ebe39de48f8fa1f.png?wh=708x480\" alt=\"å›¾ç‰‡\"></p>\n</li>\n</ol><p>å…¶ä¸­åªæœ‰ react-native æ¡†æ¶æ˜¯å¿…éœ€çš„ï¼Œè€Œå…·ä½“é€‰æ‹© JSC å¼•æ“è¿˜æ˜¯ Hermes å¼•æ“ï¼Œä½ å¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š</p><ul>\n<li>åœ¨å¯åŠ¨æ€§èƒ½ä¸Šï¼ŒHermes æ¯” JSC æ›´å¿«ã€‚Hermes é‡‡ç”¨çš„æ˜¯ AOT æå‰ç¼–è¯‘çš„æ–¹æ¡ˆï¼Œå®ƒæ”¯æŒå­—èŠ‚ç æ–‡ä»¶ï¼Œç›¸æ¯”äº JSCï¼ŒHermes ä¸ç”¨å…ˆå°† JavaScript æ–‡æœ¬ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼ŒèŠ‚çº¦äº†ç¼–è¯‘å­—èŠ‚ç çš„è€—æ—¶ï¼Œè‡ªç„¶å¯åŠ¨æ€§èƒ½æ›´å¥½ã€‚</li>\n<li>åœ¨è¿è¡Œæ€§èƒ½ä¸Šï¼ŒJSC æ¯” Herems æ›´å¿«ã€‚JSC ä½¿ç”¨çš„æ˜¯ JIT å³æ—¶ç¼–è¯‘æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆæ”¯æŒåŠ¨æ€ç¼“å­˜çƒ­ç‚¹ä»£ç ï¼Œå› æ­¤è¿è¡Œæ€§èƒ½ä¸Šæ›´å¿«ã€‚</li>\n</ul><p>ä½†æ•´ä½“è€Œè¨€ï¼Œç”±äº Hermes å¼•æ“æ˜¯ä¸“é—¨ä¸ºç§»åŠ¨ç«¯å®šåˆ¶çš„ï¼Œ<a href=\"https://www.callstack.com/blog/hermes-performance-on-ios\">åœ¨å¼•æ“å¤§å°ã€å¯åŠ¨é€Ÿåº¦ã€è¿è¡Œå†…å­˜ã€é€šä¿¡æ€§èƒ½ç­‰æ–¹é¢éƒ½ä¼˜äº JSC</a>ã€‚å¦‚æœä½ çš„æ˜¯æ–°é¡¹ç›®ï¼Œæ²¡æœ‰å†å²è´Ÿæ‹…ï¼Œå»ºè®®ä½ ç›´æ¥ä½¿ç”¨ Hermes å¼•æ“ã€‚å¦‚æœæ˜¯ä¹‹å‰å·²ä½¿ç”¨ JSC å¼•æ“ä¸Šçº¿çš„é¡¹ç›®ï¼Œå¯ä»¥å¾€ Hermes å¼•æ“è¿›è¡Œå‡çº§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç»™ GeekTimeRNAndroid å·¥ç¨‹æ·»åŠ  react native ç›¸å…³çš„ä¾èµ–ï¼ŒåŒ…æ‹¬ï¼š</p><ol>\n<li>react-native.arr æ–‡ä»¶ï¼›</li>\n<li>react-native.aar ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼›</li>\n<li>JavaScript å¼•æ“ aar æ–‡ä»¶ã€‚</li>\n</ol><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥æ·»åŠ  react-native.arr æ–‡ä»¶ã€‚æˆ‘ä»¬å°† â€¦/GeekTimeRNAndroid/node_modules/react-native/ ç›®å½•ä¸‹çš„ react-native-0.68.0-rc.3.aar æ‹·è´æ”¾ç½®åˆ° GeekTimeRNAndroid/libs ç›®å½•ã€‚æ³¨æ„ï¼ŒAndroid å¼•å…¥æœ¬åœ° aar æ–‡ä»¶éœ€è¦åœ¨å·¥ç¨‹æ ¹ç›®å½• build.gradle æ·»åŠ  flatDir é…ç½®ï¼š</p><pre><code class=\"language-plain\">allprojects {\n    repositories {\n        google()\n        jcenter()\n        // æ·»åŠ  flatDir é…ç½®\n        flatDir {\n            dirs 'libs'\n        }\n    }\n}\n</code></pre><p>ç„¶ååœ¨ GeekTimeRNAndroid/app æ¨¡å—ä¸‹çš„ build.gradle æ·»åŠ ä¾èµ–ï¼š</p><pre><code class=\"language-plain\">implementation(name:'react-native-0.68.0-rc.3', ext:'aar')\n</code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬å†å°† â€¦/GeekTimeRNAndroid/node_modules/react-native/ ç›®å½•ä¸‹çš„ react-native-0.68.0-rc.3.pom ä¸­çš„ä¾èµ–åº“ï¼ŒæŒ‰ç…§ android gradle ä¾èµ–çš„æ–¹å¼è¿›è¡Œæ·»åŠ ï¼Œè¿™äº›ä¾èµ–ä¸»è¦æ˜¯ react-native aar æœ¬èº«è¿œç¨‹ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ã€‚æ·»åŠ å¥½çš„ app build.gradle å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">dependencies {\n    implementation(name:'react-native-0.68.0-rc.3', ext:'aar')\n    \n    implementation 'com.facebook.infer.annotation:infer-annotation:0.18.0'\n    implementation 'javax.inject:javax.inject:1'\n    implementation 'androidx.appcompat:appcompat:1.0.2'\n    implementation 'com.facebook.fresco:imagepipeline-okhttp3:2.5.0'\n    implementation 'com.facebook.fresco:fresco:2.5.0'\n    implementation 'com.facebook.soloader:soloader:0.10.3'\n    implementation 'com.google.code.findbugs:jsr305:3.0.2'\n    implementation 'com.squareup.okhttp3:okhttp:4.9.2'\n    implementation 'com.squareup.okhttp3:okhttp-urlconnection:4.9.2'\n    implementation 'com.squareup.okio:okio:2.9.0'\n}\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬æ·»åŠ ä¸‹ JavaScript å¼•æ“ aar å°±å¯ä»¥äº†ã€‚è¿™è¾¹æˆ‘ä»¬ä½¿ç”¨ JSC å¼•æ“ (Hermes å¼•æ“åˆ™æ˜¯å°† â€¦/GeekTimeRNAndroid/node_modules/hermes-engine ä¸‹çš„ hermes-cppruntime-release.aar &amp; hermes-release.aar æ‹·è´åˆ° libs ç›®å½•ï¼Œå¹¶åœ¨ build.gradle ä¸­æ·»åŠ ä¾èµ–)ã€‚<br>\nJSC aar ä½äº â€¦/GeekTimeRNAndroid/node_modules/jsc-android ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯ jsc çš„ so åŠ¨æ€åº“ï¼Œå°† android-jsc-r250230.aar æ‹·è´åˆ° GeekTimeRNAndroid/libs ç›®å½•ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/82/e718eaea509be293b4070e343a478282.png?wh=654x276\" alt=\"å›¾ç‰‡\"></p><p>å®Œæ•´çš„ GeekTimeRNAndroid/app/build.gradle ä¾èµ–é…ç½®å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">dependencies {\n    implementation(name:'react-native-0.68.0-rc.3', ext:'aar')\n    implementation(name:'android-jsc-r250230', ext:'aar')\n\n    implementation 'com.facebook.infer.annotation:infer-annotation:0.18.0'\n    implementation 'javax.inject:javax.inject:1'\n    implementation 'androidx.appcompat:appcompat:1.0.2'\n    implementation 'com.facebook.fresco:imagepipeline-okhttp3:2.5.0'\n    implementation 'com.facebook.fresco:fresco:2.5.0'\n    implementation 'com.facebook.soloader:soloader:0.10.3'\n    implementation 'com.google.code.findbugs:jsr305:3.0.2'\n    implementation 'com.squareup.okhttp3:okhttp:4.9.2'\n    implementation 'com.squareup.okhttp3:okhttp-urlconnection:4.9.2'\n    implementation 'com.squareup.okio:okio:2.9.0'\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼ŒReact Native ç›¸å…³çš„ä¾èµ–é…ç½®å·²ç»å®Œæˆï¼Œè¿™æ—¶å€™ä½ å¯ä»¥å°† GeekTimeRNAndroid/node_modules åˆ é™¤äº†ã€‚</p><h4>ç¬¬ä¸‰æ­¥ï¼šé…ç½®æƒé™</h4><p>é…ç½®å¥½ç›¸å…³çš„ä¾èµ–åº“åï¼Œæˆ‘ä»¬éœ€è¦æ¥æ·»åŠ ä¸‹æƒé™å’Œæ¸…å•é…ç½®ã€‚è¿™ä¸ªå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ GeekTimeRNAndroid/app çš„ AndroidManifest.xml æ¸…å•æ–‡ä»¶ä¸­å£°æ˜ç½‘ç»œæƒé™å°±å¥½äº†ï¼š</p><pre><code class=\"language-plain\">&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;\n</code></pre><p>ä¸è¿‡ï¼Œå¦‚æœä½ è¿˜éœ€è¦è®¿é—®å¼€å‘è€…èœå•ç•Œé¢ï¼Œå°±éœ€è¦åœ¨ AndroidManifest.xml ä¸­å£°æ˜ï¼š</p><pre><code class=\"language-plain\">&lt;activity android:name=\"com.facebook.react.devsupport.DevSettingsActivity\" /&gt;\n</code></pre><p>è‡³æ­¤ï¼ŒAndroid æ··åˆå·¥ç¨‹ä¸­çš„ React Native ç¯å¢ƒé…ç½®å°±å·²ç»å®Œæˆäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨ iOS ä¸­è¿›è¡Œ React Native ç¯å¢ƒé…ç½®ã€‚</p><h3>iOS</h3><h4>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœ¬åœ°å·¥ç¨‹</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·Ÿç€ React Native å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªå¯¹åº”ç‰ˆæœ¬çš„ React Native å·¥ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾é¡¹ç›®éœ€è¦ 0.68.1 ç‰ˆæœ¬ï¼š</p><pre><code class=\"language-plain\"># é¦–å…ˆå®‰è£… react-native-cli, å¦åˆ™æ— æ³•ä½¿ç”¨ react-native å‘½ä»¤\nsudo npm install -g react-native-cli\n\n# projectName ä¸ºå·¥ç¨‹åç§°\nreact-native init projectName --version 0.68.1\n</code></pre><p>åˆ›å»ºå¥½åï¼Œæˆ‘ä»¬å†æ‰“å¼€å·¥ç¨‹ï¼Œåœ¨å·¥ç¨‹ node_modules/react-native/template/ ç›®å½•ä¸‹æ‰§è¡Œ npm installï¼Œç„¶åè¿›å…¥ /ios/ ç›®å½•ä¸‹æ‰§è¡Œ pod installï¼Œç»“æŸåå†æ‰“å¼€ react native workspace å·¥ç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/48/c3288c994c5a9d63e4a92c79452de648.png?wh=1568x1344\" alt=\"å›¾ç‰‡\"></p><p>è¿™å°±æ˜¯iOSä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹ï¼Œæ¥å…¥React NativeåŠŸèƒ½çš„æ–¹æ¡ˆã€‚é‚£æˆ‘ä»¬å¦‚ä½•åœ¨å·²æœ‰çš„iOSå·¥ç¨‹ä¸­æ¥å…¥React Nativeå‘¢ï¼Ÿå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å°†ä»¥ä¸‹ä¸‰ä¸ªReact Nativeæºç å¼•å…¥åˆ°iOSå·¥ç¨‹ä¸­ï¼Œè¿™ä¸‰ä¸ªæºç åˆ†åˆ«ä¸ºLibrariesã€Reactï¼Œä»¥åŠReact Commonï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/04/f9/04aa50941fyy62c76cd48de5585a1cf9.png?wh=241x419\" alt=\"å›¾ç‰‡\"></p><p>ç„¶åä½ å°†è¿™ä¸‰ä¸ªéƒ¨åˆ†ä½œä¸ºReact NativeåŠŸèƒ½æ¨¡å—ï¼Œç›´æ¥å‚è€ƒå®˜æ–¹æä¾›çš„podspecï¼ˆä¸‰ä¸ªä¸åŒæ¨¡å—çš„podspecè¯·å‚è€ƒ<a href=\"https://github.com/facebook/react-native\">https://github.com/facebook/react-native</a>ï¼‰ï¼Œå¹¶ç»“åˆè‡ªå·±å·¥ç¨‹ï¼Œé€‰æ‹©åˆç†çš„æ¥å…¥æ–¹æ¡ˆï¼Œé›†æˆåˆ°iOSå·¥ç¨‹ä¸­å°±å¯ä»¥äº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8a/f6/8a278d85112d0b0c9d721b6d5369d0f6.png?wh=304x100\" alt=\"å›¾ç‰‡\"></p><h4>ç¬¬äºŒæ­¥ï¼šæ·»åŠ iOSç«¯ä¾èµ–çš„åº“</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹Podfileï¼Œæ¥å¼•ç”¨å…¶ä»–ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒåŒ…æ‹¬DoubleConverisonã€glogã€RCT_Follyã€libeventï¼Œç­‰ç­‰ã€‚podspecé…ç½®æ–‡ä»¶åˆ™ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„æ–‡ä»¶ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/33/a62d416f3497493d23b2605dc32b4133.png?wh=1268x274\" alt=\"å›¾ç‰‡\"></p><p>ä¹‹åï¼Œæˆ‘ä»¬å†æ‰§è¡Œpod installå¹¶æ„å»ºå·¥ç¨‹æ–‡ä»¶xcworkspaceï¼Œå¹¶æ‰“å¼€å·¥ç¨‹æ–‡ä»¶ï¼Œè¿›è¡Œç¼–è¯‘å°±å¯ä»¥äº†ã€‚</p><p>å¯¹æ¯”ä¸¤ç«¯çš„æ“ä½œï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼ŒAndroid ä¸ iOS ä¸­ React Native æ··åˆåº”ç”¨çš„å·¥ç¨‹ç»„ç»‡ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚ä¸ React Native æ–°é¡¹ç›®ä¸åŒï¼Œåœ¨å·²æœ‰ Android å’Œ iOS é¡¹ç›®ä¸­æ¥å…¥ React Nativeï¼Œéƒ½æ˜¯æŠŠ React Native å½“æˆå­æ¨¡å—è¿›è¡Œå¼•å…¥çš„ã€‚</p><p>ä¸è¿‡ï¼Œç¯å¢ƒé…ç½®æµç¨‹ä¸­ï¼ŒAndroid ä¾§é‡äºä¾èµ– React Native çš„æ¡†æ¶ aarï¼Œä»¥åŠ JavaScript å¼•æ“ aarï¼Œè€Œ iOS åˆ™æ˜¯ä½¿ç”¨æºç æ–¹å¼é›†æˆ React Native ç›¸å…³çš„ä¾èµ–åº“ã€‚ä¸¤æ–¹çš„æ ¸å¿ƒéƒ½æ˜¯ä¾èµ– React Native æ¡†æ¶ã€JavaScript å¼•æ“ï¼Œä»¥åŠæ¡†æ¶æœ¬èº«ä¾èµ–çš„å…¶ä»–åº“ã€‚</p><h2>è½½ä½“é¡µè®¾è®¡</h2><p>æ­å»ºå¥½å·¥ç¨‹ç¯å¢ƒé…ç½®åï¼Œæˆ‘ä»¬å°±è¦æ¥è®¾è®¡ä¸€ä¸ª React Native è½½ä½“é¡µäº†ã€‚è½½ä½“é¡µæ˜¯åŠ è½½æ¸²æŸ“ React Native çš„å®¹å™¨ï¼Œåœ¨ Android ä¸­ä¸º Activity/Fragmentï¼Œåœ¨ iOS ä¸­ä¸º ViewControllerã€‚</p><p>æŒ‰ç…§å®˜æ–¹çš„<a href=\"https://reactnative.cn/docs/integration-with-existing-apps\">æ–‡æ¡£</a>ï¼Œä¸€ä¸ªç®€å•çš„è½½ä½“é¡µåªéœ€è¦åˆå§‹åŒ–ã€åŠ è½½æ¸²æŸ“ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ç»„ä»¶æ³¨å†Œèƒ½åŠ›å³å¯ã€‚ä»¥ Android ä¸ºä¾‹ï¼Œæ­å»ºä¸€ä¸ª Activityï¼Œæ„å»º ReactRootViewï¼Œåˆå§‹åŒ– ReactInstanceManager å°±å¯ä»¥åŠ è½½æœ¬åœ°çš„ bundle æ–‡ä»¶äº†ã€‚ä½ å¯ä»¥æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œå¿«é€Ÿæ­å»ºä¸€ä¸ª React Native è½½ä½“é¡µè¯•è¯•ã€‚</p><p>ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ React Nativeï¼Œé™¤äº†çœ‹ä¸­å®ƒè·¨å¹³å°çš„ä¼˜åŠ¿å¤–ï¼Œè¿˜éœ€è¦å®ƒçš„çƒ­æ›´æ–°èƒ½åŠ›ã€‚å¹¶ä¸”ï¼Œä¸ºäº†è¿›è¡ŒBugè°ƒè¯•å’Œåˆ†æï¼Œéœ€è¦å…·å¤‡é”™è¯¯å¤„ç†ã€ä¸ŠæŠ¥èƒ½åŠ›ï¼Œä»¥åŠå¤æ‚ä¸šåŠ¡ä¸­ï¼ŒNative & JavaScript é€šä¿¡è¿˜éœ€è¦æä¾›é€šä¿¡èƒ½åŠ›ã€‚ç”šè‡³ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œè¿˜éœ€è¦æä¾›ä¸€äº›é€šç”¨å†…ç½®ç»„ä»¶ã€ç»„ä»¶æ³¨å†Œèƒ½åŠ›ï¼Œç­‰ç­‰ã€‚</p><p>æ‰€ä»¥<strong>ä¸€ä¸ªå¯ç”¨äºå•†ä¸šä¸Šçº¿çš„è½½ä½“é¡µ</strong>ï¼Œéœ€è¦æä¾›åˆå§‹åŒ–ã€åŠ è½½æ¸²æŸ“ React Native é¡µé¢ã€çƒ­æ›´æ–°ã€ç¼“å­˜ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€Native & JavaScript é€šä¿¡ã€é”™è¯¯å¤„ç†ã€é”™è¯¯ä¸ŠæŠ¥ã€å†…ç½®åŸºç¡€ç»„ä»¶ã€ç»„ä»¶æ³¨å†Œç­‰èƒ½åŠ›ã€‚æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åŸºäºæ­¤æ¥è¿›è¡Œè½½ä½“é¡µçš„æ•´ä½“è®¾è®¡ã€‚</p><h3>è½½ä½“é¡µæ•´ä½“è®¾è®¡</h3><p>è¿™é‡Œï¼Œç›´æ¥æ ¹æ®ä¸Šè¿°è¦æ±‚è®¾è®¡å¥½äº†ä¸€ä¸ªè½½ä½“é¡µï¼Œä½ å…ˆæ•´ä½“çœ‹ä¸€çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/53/79/53d89b657d6532f86563c19e7a7a0e79.jpg?wh=1482x1116\" alt=\"å›¾ç‰‡\"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªå®Œæ•´çš„è½½ä½“é¡µè®¾è®¡ï¼Œåº”è¯¥åŒ…å«ä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul>\n<li><strong>UI ç»“æ„</strong>ï¼šåœ¨æ··åˆå¼€å‘ä¸­ï¼ŒReact Native å¤§éƒ¨åˆ†ä»¥ç‹¬ç«‹é¡µé¢å­˜åœ¨ï¼Œè½½ä½“é¡µå¯ä»¥åŒ…å«é€šç”¨æ ‡é¢˜æ å’Œ React Native å®¹å™¨ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æš´éœ²å®¹å™¨è§†å›¾ï¼Œç”±ä½¿ç”¨æ–¹åŠ¨æ€è¿›è¡Œæ·»åŠ ï¼›</li>\n<li><strong>å¯¹å¤–èƒ½åŠ›</strong>ï¼šåŒ…å«ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€Native ä¸ JavaScript é€šä¿¡èƒ½åŠ›ã€å†…ç½®çš„åŸºç¡€ä¸šåŠ¡ç»„ä»¶ã€ç»„ä»¶æ³¨å†Œèƒ½åŠ›ã€å¼‚å¸¸å›è°ƒã€é”™è¯¯ä¸ŠæŠ¥ç­‰ï¼ŒåŒæ—¶è¿˜éœ€è¦æä¾›çƒ­æ›´æ–°ã€åŠ è½½ bundle çš„èƒ½åŠ›ï¼›</li>\n<li><strong>çƒ­æ›´æ–°</strong>ï¼šè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨è·å–å¯¹åº” bundle æ˜¯å¦æœ‰æœ€æ–°ç‰ˆæœ¬ã€‚æœ‰æœ€æ–°ç‰ˆæœ¬åˆ™ä¸‹è½½å¹¶è¿›è¡Œç¼“å­˜ï¼Œæ— æœ€æ–°ç‰ˆæœ¬åˆ™ä½¿ç”¨ç¼“å­˜è¿›è¡ŒåŠ è½½ (æ— ç¼“å­˜åˆ™å…ˆä¸‹è½½)ï¼Œå…¶ä¸­åŒ…å«é¢„åŠ è½½ã€å¼‚æ­¥æ›´æ–°ç­‰ä¸šåŠ¡ç­–ç•¥æå‡åŠ è½½æ€§èƒ½ã€‚</li>\n<li><strong>ç¼“å­˜ç®¡ç†</strong>ï¼šé€šå¸¸ bundle åŒ…éšç€ä¸šåŠ¡ä½“é‡å¢åŠ ï¼Œä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬çš„å¸¸ç”¨ç­–ç•¥æ˜¯æ‹†åŒ…ã€æŒ‰éœ€åŠ è½½ï¼Œbundle åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œ zip å‹ç¼©ã€åŠ å¯†ï¼Œä¸‹è½½æˆåŠŸåè¿›è¡Œè§£å‹ã€æ ¡éªŒã€‚æ¯ä¸ª bundle æ–‡ä»¶éƒ½æœ‰å¯¹åº”çš„ idã€ç‰ˆæœ¬å·ã€content hashï¼›</li>\n<li><strong>bundle åŠ è½½</strong>ï¼šJavaScript å¼•æ“è¯»å– bundle æ–‡ä»¶ï¼Œå¸¸ç”¨å¼•æ“åŒ…æ‹¬ JSCã€Hermesï¼›</li>\n<li><strong>React Native è¿è¡Œç¯å¢ƒ</strong>ï¼šæ•´ä¸ª React Native è¿è¡Œç¯å¢ƒåŒ…å«è´Ÿè´£æ¸²æŸ“çš„ RootViewï¼Œæ¡†æ¶å†…ç½®æ ¸å¿ƒç»„ä»¶ã€ä¸šåŠ¡å®šåˆ¶ç»„ä»¶ï¼Œæ‰§è¡Œè„šæœ¬çš„ JavaScript å¼•æ“ï¼Œè´Ÿè´£ Native ä¸ JavaScript äº¤äº’çš„ bridge/JSIã€‚</li>\n</ul><h3>å¦‚ä½•åˆå§‹åŒ–è½½ä½“é¡µï¼Ÿ</h3><p>è®²å®Œäº†è½½ä½“é¡µè®¾è®¡åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹è½½ä½“é¡µè¿›è¡Œåˆå§‹åŒ–ã€‚è¿™é‡Œæˆ‘ä»¬è¯´çš„åˆå§‹åŒ–ï¼Œé™¤äº†è‡ªèº«ä¸šåŠ¡å°è£…çš„åˆå§‹åŒ–å¤–ï¼Œæ ¸å¿ƒè¿˜æ˜¯ React Native æ¡†æ¶æœ¬èº«çš„åˆå§‹åŒ–ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¾ç„¶åˆ†æˆ Androidã€iOS ä¸¤ç«¯æ¥åˆ†æã€‚</p><h4>Android</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ Android ç«¯çš„åˆå§‹åŒ–ã€‚ä¸è¿‡ä¸ºäº†æ–¹ä¾¿åç»­ä»£ç çš„è®²è§£ï¼Œéœ€è¦å…ˆå¸¦ä½ äº†è§£ä¸‹ React Native Android ä¸­å‡ ä¸ªå¸¸ç”¨ç±»çš„ä½œç”¨ï¼š</p><ul>\n<li><strong>ReactContext</strong>ï¼šç»§æ‰¿äº ContextWrapperï¼Œæ˜¯ React Native åº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œç®¡ç†ç€ CatalystInstance ä»¥åŠä¸‰å¤§çº¿ç¨‹ ï¼ˆUIThreadã€NativeModulesThreadã€JSThreadï¼‰ï¼›</li>\n<li><strong>ReactInstanceManager</strong>ï¼šæ€»çš„ç®¡ç†ç±»ï¼Œç®¡ç† ReactPackageã€ReactContextã€ReactRootViewã€æ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¾ç½® JavaScript å¼•æ“ï¼›</li>\n<li><strong>ReactRootView</strong>ï¼šReact Native æ¸²æŸ“çš„åŸç”Ÿå®¹å™¨ï¼Œç»§æ‰¿äº FrameLayoutï¼›</li>\n<li><strong>CatalystInstance</strong>ï¼šJava å±‚ã€C++ å±‚ã€JavaScript å±‚é€šä¿¡çš„æ€»ç®¡ç†ç±»ï¼Œç®¡ç†ç€ Java å±‚ã€JavaScript å±‚ Module æ˜ å°„è¡¨ä¸å›è°ƒï¼Œæ˜¯ä¸‰ç«¯é€šä¿¡çš„æ¡¥æ¢ã€‚å®ç°ç±»ä¸º CatalystInstanceImplï¼Œæ”¯æŒå‘ JavaScript æ³¨å…¥å…¨å±€å˜é‡ã€åŠ¨æ€åŠ è½½è„šæœ¬æ–‡ä»¶ã€è·å– NativeModules &amp; JSModulesï¼›</li>\n<li><strong>JavaScriptModule</strong>ï¼šJS Moduleï¼Œè´Ÿè´£ JavaScript åˆ° Java çš„æ˜ å°„è°ƒç”¨æ ¼å¼å£°æ˜ï¼Œç”±CatalystInstance ç»Ÿä¸€ç®¡ç†ï¼›</li>\n<li><strong>NativeModule</strong>ï¼šJava Moduleï¼Œè´Ÿè´£ Java åˆ° JavaScript çš„æ˜ å°„è°ƒç”¨æ ¼å¼å£°æ˜ï¼Œç”±CatalystInstance ç»Ÿä¸€ç®¡ç†ï¼›</li>\n<li><strong>UIManager</strong>: å¤„ç† UI çš„æ¸²æŸ“ï¼ŒJavaScript å±‚é€šè¿‡ C++ å±‚æŠŠåˆ›å»º View çš„è¯·æ±‚å‘é€ç»™ Java å±‚çš„UIManagerModuleã€‚</li>\n</ul><p>åˆå§‹åŒ–çš„æ ¸å¿ƒæ˜¯é€šè¿‡ ReactInstanceManagerBuilder æ„å»º ReactInstanceManagerï¼Œ<a href=\"https://reactnative.cn/docs/integration-with-existing-apps\">å®˜æ–¹</a>æä¾›äº†å¯¹ ReactInstanceManager çš„æ„å»ºè¯´æ˜ã€‚æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€æ®µ Demoï¼š</p><pre><code class=\"language-plain\">ReactInstanceManagerBuilder builder = ReactInstanceManager.builder();\n// è®¾ç½® application ä¸Šä¸‹æ–‡\nbuilder.setApplication((Application) context.getApplicationContext());\n\n// æ·»åŠ åŒ…ï¼Œä¸€ä¸ª package ç”±å¤šä¸ªç»„ä»¶æ„æˆï¼Œä¸Šè¿°ä»£ç ä¸­çš„ MainReactPackage æ˜¯ RN å†…ç½®çš„ package \nbuilder.addPackage(new MainReactPackage());\n\n// JS å¼‚å¸¸å›è°ƒå¤„ç†å®ç°ï¼Œåœ¨è¿™ä¸ªå®ç°ä¸­æˆ‘ä»¬å¯ä»¥æ‰“å° JS å¼‚å¸¸æ—¥å¿—ï¼Œä¸ŠæŠ¥é”™è¯¯\nbuilder.setRedBoxHandler(mRedBoxHandler); \n\n// native module å¼‚å¸¸å›è°ƒå¤„ç†å®ç°ï¼Œåœ¨è¿™ä¸ªå®ç°ä¸­æˆ‘ä»¬å¯ä»¥æ‰“å° native module å¼‚å¸¸æ—¥å¿—ï¼Œä¸ŠæŠ¥é”™è¯¯\nbuilder.setNativeModuleCallExceptionHandler(mNativeModuleExceptionHandler);\n\n// JS bundle ä¸­ä¸»å…¥å£çš„æ–‡ä»¶åï¼Œdemo ä¸­ \"index\" è¡¨ç¤ºå…¥å£æ–‡ä»¶åä¸º index.js\nbuilder.setJSMainModulePath(\"index\");\n\n// æ˜¯å¦å¼€å¯ dev æ¨¡å¼\nbuilder.setUseDeveloperSupport(true);\n\n// è®¾ç½®åˆ›å»ºæ—¶æœº\nbuilder.setInitialLifecycleState(LifecycleState.BEFORE_CREATE); \n\n// è®¾ç½® JS å¼•æ“ï¼Œå¦‚æœæƒ³ä½¿ç”¨ Hermes å¼•æ“ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼Œéœ€è¦å¼•å…¥ Hermes ç›¸å…³çš„ so åº“\n// builder.setJavaScriptExecutorFactory(new HermesExecutorFactory());\n\nReactInstanceManager reactInstanceManager = builder.build();\n</code></pre><p>ç„¶åæˆ‘ä»¬è¦è·å– ReactContextï¼ŒReactContext åœ¨åç»­åŠ è½½æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ï¼š</p><pre><code class=\"language-plain\">reactInstanceManager.addReactInstanceEventListener(new ReactInstanceManager.ReactInstanceEventListener() {\n    @Override\n    public void onReactContextInitialized(ReactContext reactContext) {\n       mReactContext = reactContext;\n    }\n});\n</code></pre><p>è‡³æ­¤ï¼ŒAndroid ç«¯çš„åˆå§‹åŒ–å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸‹ iOS ç«¯çš„åˆå§‹åŒ–é€»è¾‘ã€‚</p><h4>iOS</h4><p>iOS ç«¯åˆå§‹åŒ–è½½ä½“é¡µæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ä¸‹é¢å‡ ä¸ªæ­¥éª¤ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª Bridgeã€‚åœ¨ React Native ä¸­ï¼Œé€šè¿‡ Bridge å®ç°äº† JavaScript ä¸åŸç”Ÿæ¡†æ¶ä¹‹é—´çš„é€šä¿¡ï¼Œè°ƒç”¨ React Native æä¾›çš„ API ï¼Œå°±ç›¸å½“äºé€šè¿‡ Bridge è°ƒç”¨åŸç”Ÿçš„APIã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Bridgeï¼Œä¸è½½ä½“é¡µä¸€å¯¹ä¸€ç»‘å®šã€‚</p><pre><code class=\"language-plain\">&nbsp;RCTBridge *carrierBridge = [[RCTBridge alloc] initWithDelegate:self \n                                               launchOptions:nil];\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª RCTRootViewï¼Œç”¨äºå±•ç¤º React Native è§†å›¾çš„ç»„ä»¶RCTRootViewï¼Œåœ¨ JavaScript ä»£ç ä¸­ render() éƒ¨åˆ†çš„ UI ç»„ä»¶å‡ä¼šæ¸²æŸ“åˆ°è¯¥ View ä¸­ï¼Œåˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">&nbsp;RCTRootView *rctView = [[RCTRootView alloc] initWithBridge:bridge \n                                             moduleName:moduleName \n                                             initialProperties:nil];\n [self.view addSubview:rctView];\n</code></pre><p>åˆ°æ­¤ï¼Œ iOS ç«¯åˆå§‹åŒ–å‡†å¤‡è¿‡ç¨‹å°±å®Œæˆäº†ã€‚ä½ çœ‹ï¼Œç¡®å®æ¯”è¾ƒç®€å•å§ï¼Ÿ</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å– React Native ä»£ç åŒ…ï¼Œä¹Ÿå°±æ˜¯ JS Bundle èµ„æºã€‚é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆåŠ¨æ€ä¸‹è½½ JS Bundleèµ„æºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨çƒ­æ›´æ–°ç­–ç•¥ï¼ŒåŠ¨æ€ä¸‹è½½ JS bundle èµ„æºã€‚æ¯ä¸ªä¸åŒçš„ JS bundleåŒ…éƒ½æœ‰å®ƒè‡ªå·±çš„æ ‡è¯† idï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¯¥ id ä»æœåŠ¡å™¨ä¸­è·å–è¯¥ JS bundle èµ„æºå¯¹åº”çš„æœ€æ–°ç‰ˆæœ¬å·ï¼Œä»¥åŠæœ€æ–°èµ„æºä¸‹è½½åœ°å€ã€‚</p><p>åœ¨è·å– JS Bundle çš„æœ€æ–°ç‰ˆæœ¬å·åï¼Œå¦‚æœç”¨æˆ·ä¹‹å‰æµè§ˆè¿‡å½“å‰ React Native é¡µé¢ï¼Œè¿˜å­˜åœ¨ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ£€æµ‹ç¼“å­˜ç‰ˆæœ¬å·æ˜¯å¦ä¸æœ€æ–°ç‰ˆæœ¬å·ç›¸åŒã€‚å¦‚æœæ˜¯ç›¸åŒçš„ï¼Œå°±ä¸éœ€è¦é‡å¤ä¸‹è½½äº†ï¼›å¦‚æœä¸ç›¸åŒï¼Œé‚£ä½ è¿˜è¦æ ¹æ®æœ€æ–°èµ„æºä¸‹è½½åœ°å€ï¼Œä¸‹è½½æœ€æ–°çš„èµ„æºåŒ…ï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ°ã€‚</p><p>è¦æ˜¯ç”¨æˆ·ä¹‹å‰å¹¶æ²¡æœ‰æµè§ˆè¿‡å½“å‰ React Native é¡µé¢ï¼Œæˆ–è€…ç¼“å­˜å·²è¢«æ¸…ç©ºï¼Œä½ å¯ä»¥ç›´æ¥æ ¹æ®æœ€æ–°èµ„æºä¸‹è½½åœ°å€ï¼Œä¸‹è½½æœ€æ–°çš„èµ„æºåŒ…ï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ°ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸€ä¸‹è¿™å¼ æ•´ä½“æµç¨‹å›¾åŠ æ·±ç†è§£ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/24/49/24560021a3f881746b0b2d76aa71bb49.jpg?wh=1052x874\" alt=\"å›¾ç‰‡\"></p><h3>åŠ è½½æ¸²æŸ“</h3><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å°±èƒ½åˆ›å»ºå¥½è½½ä½“é¡µå¹¶æˆåŠŸä¸‹è½½ JS bundleäº†ï¼Œé‚£ä¹ˆç°åœ¨å°±å¯ä»¥å‡†å¤‡å¼€å§‹æ‰§è¡Œ JavaScript ä»£ç å¹¶æ¸²æŸ“ React Native é¡µé¢äº†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ Android ç«¯æ˜¯å¦‚ä½•åŠ è½½ JS bundle æ–‡ä»¶çš„ã€‚</p><h4>åŠ è½½JS bundleï¼ˆAndroidï¼‰</h4><p>Android ç«¯é€šè¿‡ ReactContext è·å– CatalystInstance å¯¹è±¡ï¼ŒCatalystInstance å®ç°ç±»ä¸º CatalystInstanceImpã€‚CatalystInstanceImpl æœ‰ä¸€ä¸ªé public æ–¹æ³• loadScriptFromFile()ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥åŠ¨æ€åŠ è½½æœ¬åœ°çš„ bundle æ–‡ä»¶äº†ã€‚ä¸è¿‡ï¼Œç”±äº loadScriptFromFile() ä¸ºé publicï¼Œæ‰€ä»¥éœ€è¦åå°„è·å–è°ƒç”¨ï¼š</p><pre><code class=\"language-plain\">CatalystInstance catalystInstance = mReactContext.getCatalystInstance();\nMethod loadScripFromFileMethod = CatalystInstanceImpl.class.getDeclaredMethod(\"loadScriptFromFile\", String.class, String.class, boolean.class);\nloadScripFromFileMethod.setAccessible(true);\n// fileName å’Œ sourceURL ä¼ å…¥æœ¬åœ°ç¼“å­˜çš„ bundle è·¯å¾„ï¼ŒloadSynchronously ä¸ºæ˜¯å¦åŒæ­¥åŠ è½½\nloadScripFromFileMethod.invoke(catalystInstance, fileName, sourceURL, loadSynchronously);\n</code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬å†è°ƒç”¨ ReactRootView startReactApplication å°±å¯ä»¥å¼€å§‹åŠ è½½æ¸²æŸ“ React Native é¡µé¢äº†ã€‚è¿™é‡Œè¦æ³¨æ„ï¼ŒstartReactApplication() ä¸­çš„å‚æ•° moduleName å¿…é¡»å¯¹åº” â€œindex.jsâ€ ä¸­çš„ â€œAppRegistry.registerComponent()â€ çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š</p><pre><code class=\"language-plain\">reactRootView.startReactApplication(reactInstanceManager, moduleName, launchOption);\n</code></pre><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ catalystInstance.setGlobalVariable() è®¾ç½®å…¨å±€å˜é‡ã€‚è®¾ç½®å¥½åï¼ŒJavaScript è¿è¡Œæ—¶å¯è·å–åˆ°è¿™äº›å…¨å±€å˜é‡äº†ï¼š</p><pre><code class=\"language-plain\">catalystInstance.setGlobalVariable(\"xxx\", xxx)\n</code></pre><p>åˆ°è¿™é‡Œï¼ŒAndroid ç«¯åŠ¨æ€åŠ è½½ bundle å°±è®²å®Œäº†ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ iOS åŠ è½½ bundle çš„æµç¨‹ã€‚</p><h4>åŠ è½½JS bundleï¼ˆiOSï¼‰</h4><p>å…¶å®ï¼ŒiOS ç«¯å¯ä»¥åœ¨åŒ…ä¸‹è½½å®Œæˆååˆå§‹åŒ– Bridgeï¼ˆæ³¨ï¼š Bridge åœ¨æºç ä¸­æ˜¯ JS Bridge æˆ–è€… JSI çš„ç»Ÿç§°ï¼‰ã€‚Bridgeåˆå§‹åŒ–åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åŠ è½½ä¸‹è½½å¥½çš„ JavaScript åŒ…äº†ã€‚</p><p>æ•´ä½“çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul>\n<li>åœ¨åˆå§‹åŒ–Bridgeæ—¶ï¼Œåœ¨ setup çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šè°ƒç”¨ bridge çš„ä»£ç†æ–¹æ³• (NSURL *)sourceURLForBridge : (RCTBridge *)bridge æ–¹æ³•ï¼ŒæŒ‡å®šè·å– JS bundle çš„è·¯å¾„ï¼š</li>\n</ul><pre><code class=\"language-plain\">&nbsp;-(NSURL *)sourceURLForBridge:(RCTBridge *)bridge{\n    NSString *bundlePath = [self getCurrentBundlePath:bundleid];\n    return bundlePath;\n}\n</code></pre><ul>\n<li>ç¡®å®š URL ä¹‹åï¼Œbridge ä¼šè°ƒç”¨ start æ–¹æ³•ï¼Œå¼€å§‹åŠ è½½ JS bundle å¹¶è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</li>\n</ul><pre><code class=\"language-plain\">&nbsp;[self loadSource:^(NSError *error, RCTSource *source) {\n&nbsp; &nbsp; if (error) {\n&nbsp; &nbsp; &nbsp; [weakSelf handleError:error];\n&nbsp; &nbsp; }\n    ...\n ]\n</code></pre><ul>\n<li>æ¥ä¸‹æ¥ä¼šè°ƒç”¨ bridge çš„ä»£ç†æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­æ‰‹åŠ¨æ³¨å…¥ä¸€äº›ä¸šåŠ¡å‚æ•°ï¼š</li>\n</ul><pre><code class=\"language-plain\">- (void)loadSourceForBridge:(RCTBridge *)bridge\n&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onProgress:(RCTSourceLoadProgressBlock)onProgress\n&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onComplete:(RCTSourceLoadBlock)loadCallback{\n  [RCTJavaScriptLoader loadBundleAtURL:bridge.bundleURL onProgress:onProgress onComplete:^(NSError *error, RCTSource *source) {\n      //æ‰‹åŠ¨æ³¨å…¥ä¸€äº›ä¸šåŠ¡å‚æ•°\n     &nbsp;NSString *string = \";this.__xxx___ = 'yyy';\"\n      NSData *stringData = [string dataUsingEncoding:NSUTF8StringEncoding];\n      \n      NSMutableData *newData = [NSMutableData dataWithData:stringData];\n      [newData appendData:source.data];\n      \n      //ç”Ÿæˆæ–°çš„Sourceå»åŠ è½½\n      RCTSource * newSource = [RCTJavaScriptLoader getNewRCTSourceURL:source.url data:newData];\n&nbsp; &nbsp; &nbsp; loadCallback(error,newSource);\n  }];\n}\n</code></pre><p>ä¹‹åï¼Œbridge ä¼šè´Ÿè´£æ‰§è¡Œè¯¥ newSourceï¼Œæ‰§è¡Œ JavaScript ä»£ç å¹¶æ¸²æŸ“å‡ºé¡µé¢ã€‚</p><h2>React Native é—®é¢˜æ’æŸ¥ä¸æ¡†æ¶ Bug ä¿®å¤</h2><p>React Native æ¶‰åŠ Nativeã€FEã€Server ä¸‰ç«¯ï¼Œä¸­é—´ç»è¿‡ JavaScript ç¯å¢ƒã€Server æ•°æ®ã€Native ç¯å¢ƒçš„è½¬æ¢ï¼Œå¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œæ’æŸ¥é“¾è·¯å¾ˆé•¿ã€‚</p><p>è€Œä¸”ï¼ŒReact Native æ¡†æ¶çš„ä¸åŒç‰ˆæœ¬åœ¨ Androidã€iOS ç«¯éƒ½å­˜åœ¨å…¼å®¹æ€§ bugï¼Œç‰¹åˆ«æ˜¯ç”¨äºæ··åˆå·¥ç¨‹æ—¶è¿™ä¸ªé—®é¢˜ä¼šæ›´åŠ æ˜æ˜¾ã€‚å› ä¸ºï¼ŒReact Native çš„è®¸å¤šè®¾è®¡éƒ½æ˜¯ä»¥çº¯ React Native å·¥ç¨‹ä¸ºå‡ºå‘ç‚¹çš„ï¼Œæ··åˆå·¥ç¨‹ä¸­éšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œå†…å­˜å ç”¨ã€å…¼å®¹é—®é¢˜ã€å¤šçº¿ç¨‹é—®é¢˜éƒ½ä¼šæš´éœ²å‡ºæ¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸‹åœ¨ Androidã€iOS ç«¯åˆ†åˆ«è¦æ€ä¹ˆè¿›è¡Œ React Native é—®é¢˜æ’æŸ¥ä¸æ¡†æ¶ Bug ä¿®å¤ã€‚</p><h3>Android é—®é¢˜æ’æŸ¥ä¸æ¡†æ¶ bug ä¿®å¤</h3><p>æˆ‘ä»¬çš„é—®é¢˜æ’æŸ¥æ€è·¯å¾ˆç®€å•ï¼šåªè¦æœ‰è¶³å¤Ÿå¤šçš„æ—¥å¿—ï¼Œå°±èƒ½å¸®æˆ‘ä»¬è¶³å¤Ÿå¿«åœ°å®šä½é—®é¢˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦<strong>æ·»åŠ æ—¥å¿—è¾“å‡º</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ ReactInstanceManagerBuilder è·å– JavaScriptã€native è¿è¡Œé”™è¯¯ï¼š</p><pre><code class=\"language-plain\">ReactInstanceManagerBuilder builder = ReactInstanceManager.builder();\nbuilder.setApplication((Application) context.getApplicationContext())\n       .setRedBoxHandler(mExceptionHandler)\n       .setNativeModuleCallExceptionHandler(mExceptionHandler);\n        \nprivate static class ExceptionHandler implements NativeModuleCallExceptionHandler, RedBoxHandler {\n\n  @Override\n  public void handleException(Exception e) {\n    // å¤„ç† Native å¼‚å¸¸\n  }\n\n  @Override\n  public void handleRedbox(String s, StackFrame[] stackFrames, ErrorType errorType) {\n    // å¤„ç† JS å¼‚å¸¸\n  }\n  \n  @Override\n  public boolean isReportEnabled() {\n    return false;\n  }\n  \n  @Override\n  public void reportRedbox(Context context, String s, StackFrame[] stackFrames, String s1, ReportCompletedListener reportCompletedListener) {\n  }\n}\n</code></pre><p>æ¥ç€ï¼Œç”¨ AOP åˆ‡ç‰‡çš„æ–¹å¼æ‹¦æˆª ReactNative JavaMethodWrapper è°ƒç”¨ï¼Œå¹¶ä½¿ç”¨ AspectJ åœ¨ç¼–è¯‘æœŸå¯¹ ReactNative æ¡†æ¶å­—èŠ‚ç è¿›è¡Œæ’æ¡©ï¼š</p><pre><code class=\"language-plain\">@Aspect\npublic class NativeModuleMethodInvokeAspect extends BaseAspect&lt;INativeModuleMethodInvokePointcut&gt; {\n\n    // å¯¹ JavaMethodWrapper.invoke æ–¹æ³•è°ƒç”¨è¿›è¡Œæ’æ¡©\n    @Around(\"execution (* com.facebook.react.bridge.JavaMethodWrapper.invoke(..))\")\n    public Object invokeNativeModuleMethod(ProceedingJoinPoint joinPoint) throws Throwable {\n        INativeModuleMethodInvokePointcut pointcut = getPointcut();\n        if(pointcut == null){\n            return joinPoint.proceed(joinPoint.getArgs());\n        }\n        return pointcut.pointcut(joinPoint);\n    }\n}\n</code></pre><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯é’ˆå¯¹ Native Module çš„è°ƒç”¨åšä»£ç æ’æ¡©ï¼Œæ•è· JavaScript è°ƒç”¨ Native Module çš„å¼‚å¸¸ï¼š</p><pre><code>public class ModuleMethodInvokePointcut implements INativeModuleMethodInvokePointcut {\n    @Override\n    public Object pointcut(ProceedingJoinPoint proceedingJoinPoint) {\n        Object object;\n        Object target = proceedingJoinPoint.getTarget();\n        try {\n            object = proceedingJoinPoint.proceed();\n        } catch (Throwable throwable) {\n            // å¼‚å¸¸æ—¶ï¼Œé€šè¿‡ target åå°„è·å–å¯¹åº”çš„ module åç§°å’Œæ–¹æ³•\n            throwable.printStackTrace();\n            return null;\n        }\n        return object;\n    }\n}\n</code></pre><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸¤ä¸ªå‘½ä»¤æŸ¥çœ‹ React Native è¿è¡Œæ—¥å¿—äº†ï¼š</p><pre><code class=\"language-plain\">adb logcat | grep React\n</code></pre><p>æœ€åï¼Œå¦‚æœæœ‰å¼‚å¸¸æ—¥å¿—å°±ä¼šä¸ŠæŠ¥åˆ°åå°ï¼Œæ—¥å¿—ä¿¡æ¯ä¼šåŒ…å«ç³»ç»Ÿã€æœºå‹ã€è¿è¡Œç¯å¢ƒï¼Œä»¥åŠä¸šåŠ¡æ ‡è¯†ç­‰ã€‚æœ‰äº†å¼‚å¸¸æ—¥å¿—ç»™æˆ‘ä»¬æä¾›çš„è¿™äº›ä¿¡æ¯ï¼Œä½ å°±å¯ä»¥é€šè¿‡çº¿ä¸‹ã€çº¿ä¸Šæ‰‹æ®µï¼Œå¿«é€Ÿæ’æŸ¥ React Native ç›¸å…³çš„ bug äº†ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹React Nativeæ¡†æ¶çš„Bugè¿›è¡Œä¿®å¤å‘¢ï¼Ÿ</p><p>åœ¨ Android æ··åˆå·¥ç¨‹ä¸­ï¼ŒReact Native æ˜¯ä»¥ aar æ–¹å¼å¼•å…¥çš„ã€‚æ‰€ä»¥å»ºè®®ä½ å¯¹å®ƒè¿›è¡ŒåŒ…è£…ï¼Œè‡ªè¡Œå‘å¸ƒ aar ç®¡ç†ã€‚ä¸è¿‡æºç ç¼–è¯‘æ–¹å¼å¤æ‚ï¼Œä½ å¯ä»¥é€šè¿‡ç¼–è¯‘æœŸæ’æ¡©çš„æ–¹å¼å¯¹ React Native aar è¿›è¡Œæ’æ¡©ï¼Œæ¥ä¿®å¤ bugã€‚</p><p>å¸¸ç”¨çš„æ’æ¡©æ–¹å¼åŒ…æ‹¬ ASMã€Javasistã€AspectJ è¿™å‡ ç§ã€‚æˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨ AspectJ åŒ¹é…å…·ä½“ç±»çš„å…·ä½“æ–¹æ³•è¿›è¡Œæ’æ¡©ï¼Œå®ç° bug ä¿®å¤ã€‚é€‰æ‹© AspectJ çš„åŸå› æ˜¯ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€è¦å¯¹ React Native çš„ä¸€äº›å¼‚å¸¸æ–¹æ³•åšåˆ‡ç‰‡ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹é‡Œé¢çš„é€»è¾‘ï¼Œå®ƒè¶³ä»¥æ»¡è¶³æˆ‘ä»¬ä¿®æ”¹ React Native æ¡†æ¶é—®é¢˜çš„éœ€è¦ã€‚å¹¶ä¸”ï¼Œ AspectJ åœ¨æ˜“ç”¨æ€§ã€å¯è¯»æ€§ä¸Šæ¯” ASMã€Javasist éƒ½æ›´ä¼˜ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ Android ç«¯è¿›è¡Œ React Native çš„é—®é¢˜æ’æŸ¥ä¸æ¡†æ¶ Bug ä¿®å¤çš„å¸¸ç”¨æ‰‹æ®µï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹ iOS ç«¯çš„ã€‚</p><h3>iOS é—®é¢˜æ’æŸ¥</h3><p>åœ¨iOSä¸­ï¼Œå¦‚æœ React Native é¡µé¢åœ¨åŠ è½½è¿‡ç¨‹ä¸­æˆ–è€…è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€é€šè¿‡ typedef void (^RCTFatalHandler)(NSError *error); æ¥è¿›è¡Œæ‹¦æˆªã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦å¯¹åŸç”Ÿçš„ RCTFatalHandler ä¸­ error å‚æ•°è¿›è¡Œæ”¹é€ ï¼Œè®© error ä¸­å¸¦ä¸Š bridge ä¿¡æ¯ã€‚å…·ä½“æ”¹é€ ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">- (void)error{\n    //æ”¹é€ errorä¸­å¸¦æœ‰bridge\n   &nbsp;NSError *newError = [self getWBErrorBridge:error];\n&nbsp; &nbsp; RCTFatal(newError);\n}\n\n//errorä¿¡æ¯é‡Œå¸¦ä¸ŠBridge\n- (NSError *)getWBErrorBridge:(NSError *)error{\n&nbsp; &nbsp; NSMutableDictionary *errorDic = [NSMutableDictionary dictionaryWithDictionary:error.userInfo];\n&nbsp; &nbsp; [errorDic setObject:self-&gt;_parentBridge forKey:@\"ErrorBridgeTag\"];\n&nbsp; &nbsp; NSError *newErr = [[NSError alloc]initWithDomain:error.domain code:error.code userInfo:errorDic];\n&nbsp; &nbsp; return newErr;\n}\n</code></pre><p>å‡ºç°å¼‚å¸¸åï¼Œæˆ‘ä»¬è¦ä» Error ä¸­è·å– bridge ï¼Œå¹¶æ‰¾å‡ºå‘ç”Ÿå¼‚å¸¸çš„è½½ä½“é¡µä¿¡æ¯ï¼Œè·å–å¯¹åº”çš„ JS Bundle çš„ ID ï¼Œä»¥ç¡®å®šåˆ°åº•å“ªä¸€ä¸ªé¡µé¢å‡ºç°äº†å¼‚å¸¸ï¼š</p><pre><code class=\"language-plain\">&nbsp;RCTSetFatalHandler(^(NSError *error) {\n&nbsp; &nbsp; dispatch_async(dispatch_get_main_queue(), ^{\n        RNViewController *rnVC = nil;\n        RCTBridge *bridge = (RCTBridge *)error.userInfo[@\"ErrorBridgeTag\"];\n        if (bridge) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;carrierVC = (RNViewController *)bridge.delegate;\n&nbsp; &nbsp; &nbsp; &nbsp; }\n        NSString *descriptions = error.localizedDescription;\n        NSLog(@\"error --- %@ --- %@\", rnVC.rnModel.bundleID, descriptions);\n    }\n}\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ‹¦æˆªå¼‚å¸¸åï¼Œå¯¹é¡µé¢è¿›è¡Œå±•ç¤ºé”™è¯¯é¡µé¢ã€è‡ªåŠ¨ä¿®å¤ã€æ¸…ç©ºå¼‚å¸¸çš„ JS bundle ç¼“å­˜ç­‰ä¸€ç³»åˆ—æ“ä½œäº†ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©çš„è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç³»ç»Ÿåœ°è®²è§£äº†æ··åˆå¼€å‘çš„å…¨æµç¨‹ã€‚ä½ å¯ä»¥æ ¹æ®å®˜æ–¹æ–‡æ¡£å¿«é€Ÿæ­å»ºèµ· React Native æ··åˆå·¥ç¨‹ã€‚æˆ‘ä»¬è¿™ä¸€è®²æ˜¯åœ¨å®˜æ–¹æ•™ç¨‹çš„åŸºç¡€ä¸Šï¼Œç»“åˆçœŸå®é¡¹ç›®ä¸­çš„å®æˆ˜å¼€å‘ç»éªŒï¼Œä»ç¯å¢ƒæ­å»ºã€è½½ä½“é¡µè®¾è®¡ã€è°ƒè¯•æ‰“åŒ…å‘å¸ƒã€é—®é¢˜æ’æŸ¥ä¸æ¡†æ¶ Bug ä¿®å¤å‡ ä¸ªæ–¹é¢æ¥è¿›è¡Œè®²è§£çš„ã€‚è¿™é‡Œæˆ‘ä»¬å†ç®€å•å¤ä¹ ä¸‹å‡ ä¸ªé‡è¦çŸ¥è¯†ç‚¹ã€‚</p><p>å…³äºçº¯ React Native å·¥ç¨‹å’Œæ··åˆå·¥ç¨‹åˆ†åˆ«åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨æ¥å…¥ React Native æ—¶å¦‚ä½•è¿›è¡Œé€‰æ‹©çš„é—®é¢˜ï¼Œæ ¸å¿ƒè¿˜æ˜¯åœ¨äº<strong>é¡¹ç›®æœ‰æ²¡æœ‰å†å²åŒ…è¢±</strong>ã€‚</p><p>å¦‚æœæ˜¯ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œéœ€è¦åšåˆ°å¿«é€Ÿææ•ˆï¼Œå¹¶ä¸”ä¸éœ€è¦å¤æ‚çš„æ¶æ„ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥é€‰æ‹©çº¯ React Native æ¨¡å¼ã€‚å¦‚æœæ˜¯å·²ä¸Šçº¿é¡¹ç›®æ¥æ¥å…¥ React Nativeï¼Œæ¶æ„å¤æ‚ï¼Œæˆ–è€…éœ€è¦å°† React Native å½“æˆä¸€ç§åŸºç¡€èƒ½åŠ›æä¾›ç»™å…¶ä»–ä¸šåŠ¡/App ä½¿ç”¨ï¼Œå°±éœ€è¦ä½¿ç”¨æ··åˆæ¨¡å¼ã€‚</p><p>é‡åˆ°é—®é¢˜æ—¶å¦‚ä½•å¿«é€Ÿæ’æŸ¥å®šä½ï¼Œæ˜¯æˆ‘ä»¬å®é™…å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„é—®é¢˜ã€‚ç”±äº React Native çš„é“¾è·¯æ¯”è¾ƒé•¿ã€æ¶‰åŠå®¢æˆ·ç«¯ã€å‰ç«¯ã€åç«¯ï¼Œä¸” React Native æ¡†æ¶è¾“å‡ºçš„æ—¥å¿—ä¸å¤Ÿå¤šï¼Œæ’æŸ¥é—®é¢˜æ¯”è¾ƒå›°éš¾ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•è· React Native è¿è¡Œå¼‚å¸¸ã€åœ¨ React Native æ¡†æ¶å†…åŠ å…¥è¶³å¤Ÿçš„æ—¥å¿—ï¼Œå¸®åŠ©æˆ‘ä»¬æ¥å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p><p>å…¶å®æ··åˆå¼€å‘å¹¶æ²¡æœ‰é‚£ä¹ˆéš¾ï¼Œåªè¦ç†è§£äº†ä»¥ä¸Šçš„ä¸€äº›å…³é”®ç‚¹ï¼Œå°±è¶³ä»¥è®©ä½ åº”å¯¹æ—¥å¸¸çš„ React Native æ··åˆå¼€å‘éœ€æ±‚äº†ã€‚</p><h2>ä½œä¸š</h2><ol>\n<li>è®¾è®¡ä¸€ä¸ªç®€å•çš„è½½ä½“é¡µï¼ŒåŒ…å«åˆå§‹åŒ–ã€åŠ è½½æœ¬åœ° bundle æ–‡ä»¶ã€å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚</li>\n</ol><p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•å’Œç»éªŒï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ã€‚</p>","neighbors":{"left":{"article_title":"20ï½œSentryï¼šçº¿ä¸Šé”™è¯¯ä¸æ€§èƒ½ç›‘æ§æ€ä¹ˆå¤„ç†ï¼Ÿ","id":518009},"right":{"article_title":"22ï½œè‡ªå®šä¹‰ç»„ä»¶ï¼šå¦‚ä½•æ»¡è¶³ä¸šåŠ¡çš„ä¸ªæ€§åŒ–éœ€æ±‚ï¼Ÿ","id":519819}},"comments":[{"had_liked":false,"id":346919,"user_name":"é£˜é€¸è·‘é…·","can_delete":false,"product_type":"c1","uid":2071511,"ip_address":"","ucode":"FD6CBBF5456FE1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9b/d7/13d8bf91.jpg","comment_is_top":false,"comment_ctime":1653537542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14538439430","product_id":100110101,"comment_content":"æ¥æ³¢æºç ï¼Œå‚ç…§ä¸€ä¸‹","like_count":3},{"had_liked":false,"id":345876,"user_name":"ä¸‹ä¸€åˆ»ã€‚","can_delete":false,"product_type":"c1","uid":1161123,"ip_address":"","ucode":"8D2C7CF81FF8F9","user_header":"https://thirdqq.qlogo.cn/qqapp/101423631/0FD57A9C0C5BFBDA3DA69AE26B3514FB/100","comment_is_top":false,"comment_ctime":1652671888,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14537573776","product_id":100110101,"comment_content":"iOS æœŸæœ›å¯ä»¥è®²è§£ä¸€ä¸‹ï¼Œç±»ä¼¼Android arrçš„æ··åˆæ¨¡å¼ã€‚æŠŠiOS RNéƒ¨åˆ†æ‰“åŒ…æˆframeworkã€‚","like_count":3},{"had_liked":false,"id":346220,"user_name":"å°æ€ªå…½","can_delete":false,"product_type":"c1","uid":1822766,"ip_address":"","ucode":"9ADCC89022A9BD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIdLUtkvdNcLalw2PUxJaXY7Giacj4ZnGSPPTJkauHpoSG1jurGxxFXXf5zV52r1oRLzOuEBdmdGEA/132","comment_is_top":false,"comment_ctime":1652926143,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5947893439","product_id":100110101,"comment_content":"ä¸ç”¨æ·»åŠ react.gradleè„šæœ¬å—","like_count":1,"discussions":[{"author":{"id":1161123,"avatar":"https://thirdqq.qlogo.cn/qqapp/101423631/0FD57A9C0C5BFBDA3DA69AE26B3514FB/100","nickname":"ä¸‹ä¸€åˆ»ã€‚","note":"","ucode":"8D2C7CF81FF8F9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572880,"discussion_content":"react.gradleè„šæœ¬ä¸»è¦æ˜¯æ‰“åŒ…RN Bundleäº§ç‰©ï¼Œæ··åˆå¼€å‘ä¸€èˆ¬å•ç‹¬å†™è„šæœ¬åšæ‰“åŒ…è¿™ä¸€æ­¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653027642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345877,"user_name":"ä¸‹ä¸€åˆ»ã€‚","can_delete":false,"product_type":"c1","uid":1161123,"ip_address":"","ucode":"8D2C7CF81FF8F9","user_header":"https://thirdqq.qlogo.cn/qqapp/101423631/0FD57A9C0C5BFBDA3DA69AE26B3514FB/100","comment_is_top":false,"comment_ctime":1652671974,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5947639270","product_id":100110101,"comment_content":"å®‰å“ä½¿ç”¨arræ··åˆæ¨¡å¼åï¼Œå¯ä»¥æŠ›å¼ƒnode_modulesï¼Œé‚£ä¹ˆå¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨åˆ°ä¸€äº›åŸç”Ÿç¬¬ä¸‰æ–¹åº“ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2414909,"avatar":"","nickname":"Geek_bae193","note":"","ucode":"CA0203A3D98331","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572329,"discussion_content":"å¯¹äºç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥å•ç‹¬å»ºmoduleæ‰˜ç®¡ï¼Œå‘å¸ƒaarã€‚å¦‚æœç›´æ¥ä¾èµ–æˆ–linkï¼Œé‚£ä¹ˆRNä½œä¸ºé€šç”¨æ¨¡å—æˆ–SDKå‘å¸ƒä¼šä¼šç¼ºå¤±ç±»ã€‚\n\nå½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­ä½¿ç”¨RNï¼Œå¯ä»¥ä½¿ç”¨node_modulesæ‰˜ç®¡ä¸€èµ·æ‰“åŒ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652710323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354916,"user_name":"songyq","can_delete":false,"product_type":"c1","uid":2427725,"ip_address":"ç¾å›½","ucode":"0A95EBA8D2F16A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLib4GiaK4KB3UvnnzIkMAD4QzKBAkOzdntPwsb8RX1xjHYgr2w0GLWhmoPdwy3iby3zOHbeTBR2DgRQ/132","comment_is_top":false,"comment_ctime":1660879272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660879272","product_id":100110101,"comment_content":" RCTSetFatalHandler(^(NSError *error) {<br>    dispatch_async(dispatch_get_main_queue(), ^{<br>        RNViewController *rnVC = nil;<br>        RCTBridge *bridge = (RCTBridge *)error.userInfo[@&quot;ErrorBridgeTag&quot;];<br>        if (bridge) {<br>           carrierVC = (RNViewController *)bridge.delegate;<br>        }<br>        NSString *descriptions = error.localizedDescription;<br>        NSLog(@&quot;error --- %@ --- %@&quot;, rnVC.rnModel.bundleID, descriptions);<br>    }<br>}<br>æŒ‡å‡ºä¸€å¤„é”™è¯¯<br>carrierVC åç§°é”™è¯¯äº†ï¼Œåº”è¯¥æ˜¯rnVC","like_count":0},{"had_liked":false,"id":354915,"user_name":"songyq","can_delete":false,"product_type":"c1","uid":2427725,"ip_address":"ç¾å›½","ucode":"0A95EBA8D2F16A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLib4GiaK4KB3UvnnzIkMAD4QzKBAkOzdntPwsb8RX1xjHYgr2w0GLWhmoPdwy3iby3zOHbeTBR2DgRQ/132","comment_is_top":false,"comment_ctime":1660879150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660879150","product_id":100110101,"comment_content":"RNViewController *rnVC = nil; RCTBridge *bridge = (RCTBridge *)error.userInfo[@&quot;ErrorBridgeTag&quot;]; if (bridge) { carrierVC = (RNViewController *)bridge.delegate; } NSString *des","like_count":0},{"had_liked":false,"id":351734,"user_name":"Geek_444dfb","can_delete":false,"product_type":"c1","uid":2998678,"ip_address":"","ucode":"4782E3AE0086DD","user_header":"","comment_is_top":false,"comment_ctime":1658136073,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658136073","product_id":100110101,"comment_content":"å¤§ä½¬ï¼Œæœ‰æ²¡æœ‰ç²¾ç®€çš„demoå‘¢ï¼Œå¸Œæœ›èƒ½æ¥ä¸€ä»½ğŸ˜","like_count":0},{"had_liked":false,"id":351331,"user_name":"èµ±å‰æœˆæœˆé³¥","can_delete":false,"product_type":"c1","uid":1119301,"ip_address":"","ucode":"DC1B908AF9E0EF","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/45/788e2e12.jpg","comment_is_top":false,"comment_ctime":1657706935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657706935","product_id":100110101,"comment_content":"è¿™é‡Œæ²¡çœ‹æ‡‚ï¼šç„¶åä½ å°†è¿™ä¸‰ä¸ªéƒ¨åˆ†ä½œä¸º React Native åŠŸèƒ½æ¨¡å—ï¼Œç›´æ¥å‚è€ƒå®˜æ–¹æä¾›çš„ podspec","like_count":0},{"had_liked":false,"id":350606,"user_name":"Geek_4a10b1","can_delete":false,"product_type":"c1","uid":2885799,"ip_address":"","ucode":"4E5DE55035E5D9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTISicpsLbj7rPDKW5HpUVExAT3ljKKVHvMSgFm3hWzZBSFiaHNteUuuicEdySFopjL0U4FQJb7PxkBicQ/132","comment_is_top":false,"comment_ctime":1657034218,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657034218","product_id":100110101,"comment_content":"å…³äºæ··åˆå¼€å‘çš„ç¯å¢ƒé›†æˆè¿™å—å„¿æœ‰ä¸ªé—®é¢˜å’¨è¯¢ä¸‹ï¼Œå¦‚æœAndroidé¡¹ç›®é›†æˆæ–°ç‰ˆæœ¬æ¶æ„ï¼Œæˆ‘çœ‹å®˜ç½‘ä»‹ç»éœ€è¦ä¾èµ–nodemoduleé‡Œçš„react-native-gradle-pluginï¼Œnodemoduleéƒ½è¢«åˆ äº†çš„è¯ï¼Œè¿™ä¸€æ­¥ä½ ä»¬æ˜¯æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå¦å¤–å¦‚æœè¦ç”¨TuboModuleå’ŒFabricï¼Œéœ€è¦ç”Ÿæˆå„ç§c++æ–‡ä»¶ä½¿ç”¨NDKè¿›è¡Œç¼–è¯‘ï¼Œé‡‡ç”¨æ··åˆå¼€å‘è¿™ç§é›†æˆæ–¹å¼çš„è¯è¿™ä¸€æ­¥åˆè¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":348554,"user_name":"Forest","can_delete":false,"product_type":"c1","uid":1707743,"ip_address":"","ucode":"B75CB4919FF25A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0e/df/a64b3146.jpg","comment_is_top":false,"comment_ctime":1655193420,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655193420","product_id":100110101,"comment_content":"è€å¸ˆï¼Œå¦‚ä½•ä½¿ç”¨ RN æ„å»ºä¸€ä¸ªå¤šè·¯ç”±è§†å›¾çš„RN SDKå‘¢ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":348422,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1667101,"ip_address":"","ucode":"EED137B5B96EA3","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/1d/c59e0b59.jpg","comment_is_top":false,"comment_ctime":1655096699,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655096699","product_id":100110101,"comment_content":"è¯·é—®ä¸‹ï¼Œçº¯RNçš„å®¢æˆ·ç«¯å¦‚ä½•é…ç½®çƒ­æ›´æ–°ï¼Ÿå¦‚æœèƒ½å…·ä½“äº›ï¼Œéå¸¸æ„Ÿè°¢ï¼æœŸæœ›æ˜¯æ­é…23ç« CDNæ–¹æ¡ˆå®ç°","like_count":0}]}