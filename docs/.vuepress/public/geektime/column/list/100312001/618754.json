{"id":618754,"title":"10 | K8s æç®€å®æˆ˜ï¼ˆäº”ï¼‰ï¼šå¦‚ä½•å°†é›†ç¾¤çš„ä¸šåŠ¡æœåŠ¡æš´éœ²å¤–ç½‘è®¿é—®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Envã€ConfigMap å’Œ Secret ä¸‰ç§ç®¡ç†åº”ç”¨é…ç½®çš„æ–¹æ³•ï¼Œäº†è§£äº†å®ƒä»¬çš„é€‚ç”¨åœºæ™¯ã€‚</p><p>å½“æˆ‘ä»¬å°†åº”ç”¨é¡ºåˆ©è¿ç§»åˆ° Kubernetes ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç”¨æˆ·å¦‚ä½•è®¿é—®é›†ç¾¤å†…éƒ¨çš„ä¸šåŠ¡æœåŠ¡å‘¢ï¼Ÿå› ä¸ºæ— è®ºæ˜¯ Pod è¿˜æ˜¯ Serviceï¼Œå®ƒçš„ IP åœ°å€éƒ½æ˜¯é›†ç¾¤å†…çš„è™šæ‹Ÿ IP åœ°å€ï¼Œä¹Ÿå«åš VIPï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå†…ç½‘ IP åœ°å€ï¼Œåªèƒ½æä¾›é›†ç¾¤å†…çš„è®¿é—®èƒ½åŠ›ï¼Œå¹¶ä¸èƒ½åœ¨å…¬ç½‘ç¯å¢ƒä¸‹è¿›è¡Œè®¿é—®ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å…ˆæ¥æ¸©ä¹ ä¸€ä¸‹ä¼ ç»Ÿåº”ç”¨æš´éœ²å…¬ç½‘çš„æ–¹å¼ï¼Œç„¶åç»“åˆç¤ºä¾‹åº”ç”¨ï¼Œè¿›ä¸€æ­¥å­¦ä¹ å¦‚ä½•å¯¹å¤–æš´éœ² Kubernetes é›†ç¾¤å†…çš„åº”ç”¨æœåŠ¡ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å·²ç»æŒ‰ç…§<a href=\"https://time.geekbang.org/column/article/614570\">ç¬¬5è®²</a>â€œç¤ºä¾‹åº”ç”¨ä»‹ç»â€çš„å¼•å¯¼åœ¨æœ¬åœ° Kind é›†ç¾¤éƒ¨ç½²äº†ç¤ºä¾‹åº”ç”¨ã€‚</p><h2>ä¼ ç»Ÿåº”ç”¨çš„æœåŠ¡æš´éœ²</h2><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„å¾®æœåŠ¡åº”ç”¨æ˜¯å¦‚ä½•å¯¹å¤–æš´éœ²çš„ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå…¸å‹çš„å¾®æœåŠ¡åº”ç”¨åœ¨ç³»ç»Ÿçš„æœ€å¤–å±‚ä¼šä½¿ç”¨ç½‘å…³æˆ–è€…è´Ÿè½½å‡è¡¡å™¨ä½œä¸ºç³»ç»Ÿçš„å…¥å£ï¼Œç„¶åï¼Œæ ¹æ®è·¯ç”±è§„åˆ™å’ŒæœåŠ¡å‘ç°æœºåˆ¶å°†æµé‡è½¬å‘åˆ°å®é™…çš„åç«¯å¾®æœåŠ¡ä¸­ï¼ˆä¸€èˆ¬æ˜¯ä¸šåŠ¡è¿›ç¨‹æ‰€åœ¨çš„è™šæ‹Ÿæœºä¸Šï¼‰ã€‚æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b6/63/b63f9b18a7698190817e4e6d35bd8763.jpg?wh=1920x872\" alt=\"å›¾ç‰‡\"></p><p>åœ¨è¿™ä¸ªå…¸å‹çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ<strong>ç½‘å…³æ˜¯ç³»ç»Ÿå”¯ä¸€çš„å…¥å£ã€‚</strong>å®ƒå°†é€šè¿‡ä¸€ä¸ªå¤–ç½‘ IP æš´éœ²ä¸šåŠ¡ç³»ç»Ÿï¼Œé™¤äº†ç½‘å…³ä»¥å¤–ï¼Œæ•´ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡éƒ½åœ¨ç§æœ‰ç½‘ç»œä¸‹ï¼Œå½¼æ­¤é€šè¿‡ VIP è¿›è¡Œé€šä¿¡ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®é™¤äº†ç½‘å…³ä»¥å¤–çš„ä»»ä½•æœåŠ¡ã€‚é€šå¸¸ï¼Œç”±äºç”¨æˆ·è®¿é—®ä¸šåŠ¡ç³»ç»Ÿä¸€èˆ¬æ˜¯ä½¿ç”¨åŸŸåï¼Œæ‰€ä»¥åœ¨ç½‘å…³å‰é¢è¿˜ä¼šæœ‰ DNS è§£ææ­¥éª¤ã€‚</p><!-- [[[read_end]]] --><p>æ˜¾ç„¶ï¼Œåœ¨è¿™ç§æ¶æ„ä½“ç³»ä¸‹ï¼Œå¯¹å¤–æš´éœ²ä¸šåŠ¡åªéœ€è¦èµ‹äºˆç½‘å…³æœåŠ¡ä¸€ä¸ªå…¬ç½‘ IP åœ°å€å°±å¯ä»¥è¾¾åˆ°ç›®çš„äº†ã€‚</p><h2>Kubernetes æœåŠ¡æš´éœ²</h2><p>é‚£ä¹ˆï¼Œåœ¨ Kubernetes é‡Œé¢æœ‰æ²¡æœ‰ç±»ä¼¼çš„æœºåˆ¶å‘¢ï¼Ÿç»“åˆ Kubernetes Service å¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬èƒ½èµ‹äºˆ Service ä¸€ä¸ªå…¬ç½‘ IPï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æš´éœ² Service é€‰æ‹©å™¨æ‰€å…³è”çš„ Pod äº†å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ€è·¯å®Œå…¨æ­£ç¡®ï¼Œä½†æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è®© Service è·å¾—ä¸€ä¸ªå…¬ç½‘ IP å‘¢ï¼Ÿ</p><p>åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯·ä½ å›æƒ³ä¸€ä¸‹<a href=\"https://time.geekbang.org/column/article/617028\">ç¬¬8è®²</a>çš„å†…å®¹ã€‚åœ¨è®²è§£å¦‚ä½•è§£å†³æœåŠ¡å‘ç°é—®é¢˜æ—¶ï¼Œæˆ‘æœ‰æåˆ°è¿‡ Service çš„ä¸¤ç§ç±»å‹ï¼Œæˆ‘æœ‰æåˆ°è¿‡ Service çš„ä¸¤ç§ç±»å‹ï¼Œ<strong>åˆ†åˆ«æ˜¯ NodePort å’Œ Loadbalancer</strong>ã€‚è¿™ä¸¤ç§ç±»å‹éƒ½å¯ä»¥ä¸º Service èµ‹äºˆå…¬ç½‘ IPã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹è¿™ä¸¤ç§ Service ç±»å‹ã€‚</p><h3>NodePort</h3><p>å½“ Service è¢«é…ç½®ä¸º NodePort ç±»å‹ä¹‹åï¼ŒKubernetes ä¼šåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šç›‘å¬æŒ‡å®šçš„ç«¯å£ï¼ˆä¸€èˆ¬æ˜¯30000-32767ï¼‰ï¼Œå½“é€šè¿‡èŠ‚ç‚¹çš„å…¬ç½‘ IP + ç«¯å£å·çš„å½¢å¼è®¿é—®æ—¶ï¼Œè¯·æ±‚ä¼šè¢«è½¬å‘åˆ°å¯¹åº”çš„ Service å½“ä¸­ã€‚ä½ å¯ä»¥ç†è§£ä¸ºï¼ŒNodePort ç±»å‹å¯ä»¥ç›´æ¥è®© Service åœ¨èŠ‚ç‚¹å±‚é¢å¯¹å¤–æš´éœ²ã€‚</p><p>åœ¨ä¹‹å‰éƒ¨ç½²ç¤ºä¾‹åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä¸º Kind é›†ç¾¤å®‰è£…äº† Ingress-Nginx ç»„ä»¶ï¼Œåœ¨ Kind ç¯å¢ƒä¸‹ï¼Œè¿™ä¸ªç»„ä»¶å…¶å®å°±æ˜¯é€šè¿‡ NodePort çš„æ–¹å¼æš´éœ²çš„ã€‚ä½ å¯ä»¥é€šè¿‡ kubectl get service æ¥è·å– Ingress-Nginx çš„ Service Manifestã€‚</p><pre><code class=\"language-yaml\">$ kubectl get service ingress-nginx-controller -n ingress-nginx -o yaml\napiVersion: v1\nkind: Service\nmetadata:\n  ......\n&nbsp; name: ingress-nginx-controller\n&nbsp; namespace: ingress-nginx\nspec:\n&nbsp; ......\n  ports:\n&nbsp; - appProtocol: http\n&nbsp; &nbsp; name: http\n&nbsp; &nbsp; nodePort: 31844\n&nbsp; &nbsp; port: 80\n&nbsp; &nbsp; protocol: TCP\n&nbsp; &nbsp; targetPort: http\n&nbsp; - appProtocol: https\n&nbsp; &nbsp; name: https\n&nbsp; &nbsp; nodePort: 32606\n&nbsp; &nbsp; port: 443\n&nbsp; &nbsp; protocol: TCP\n&nbsp; &nbsp; targetPort: https\n&nbsp; selector:\n&nbsp; &nbsp; app.kubernetes.io/component: controller\n&nbsp; &nbsp; app.kubernetes.io/instance: ingress-nginx\n&nbsp; &nbsp; app.kubernetes.io/name: ingress-nginx\n&nbsp; type: NodePort\n</code></pre><p>åœ¨è¿™æ®µ Manifest å†…å®¹ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ Selector&nbsp;å­—æ®µï¼Œè¿˜æœ‰ Ports å­—æ®µä¸‹çš„ <strong>NodePortã€Port å’Œ TargetPort</strong>ã€‚</p><p>Selector æ˜¯é€‰æ‹©å™¨ï¼Œå®ƒå°†åŒ¹é… Pod æ¨¡æ¿é‡Œçš„ Labelsï¼Œä½œç”¨æ˜¯æŠ½è±¡ä¸€ç»„ Pod æœåŠ¡å¹¶å°†æµé‡åœ¨è¿™äº› Pod ä¸­åšè´Ÿè½½å‡è¡¡ã€‚</p><p>Ports å­—æ®µä¸‹å®šä¹‰äº†ä¸¤ä¸ªæ•°ç»„ã€‚</p><p>ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­çš„ Port å­—æ®µä»£è¡¨ Service çš„è®¿é—®ç«¯å£ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯ Service åœ¨é›†ç¾¤å†…éƒ¨çš„æš´éœ²ç«¯å£ã€‚TargetPort è¡¨ç¤ºç›®æ ‡ç«¯å£ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ Service å°†è¯·æ±‚è½¬å‘åˆ° Pod çš„å“ªä¸ªç«¯å£ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯ä¸šåŠ¡è¿›ç¨‹åœ¨å®¹å™¨é‡Œçš„ç›‘å¬ç«¯å£ã€‚æ˜¾ç„¶ Nginx åœ¨å®¹å™¨å†…çš„ç›‘å¬ç«¯å£æ˜¯ 80ã€‚æœ€åä¹Ÿæ˜¯æœ€é‡è¦çš„ NodePort å­—æ®µï¼Œå®ƒè¡¨ç¤ºéœ€è¦å°†æœåŠ¡æš´éœ²åœ¨ Kubernetes èŠ‚ç‚¹çš„ä»€ä¹ˆç«¯å£ï¼Œè¿™é‡Œå…·ä½“çš„å«ä¹‰æ˜¯å°†æœåŠ¡æš´éœ²åœ¨ Kubernetes èŠ‚ç‚¹çš„ 31844 ç«¯å£ä¸Šã€‚</p><p>åŒç†ï¼ŒPorts çš„ç¬¬äºŒä¸ªæ•°ç»„ä¹Ÿæ˜¯ä»£è¡¨ç±»ä¼¼çš„å«ä¹‰ã€‚</p><p>æœ€åï¼Œè¿™æ®µ Service Manifest å®ç°çš„æ•ˆæœæ˜¯ï¼Œè®¿é—® Kubernetes <strong>ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹</strong>çš„å…¬ç½‘ IP+31844 ç«¯å£æˆ– 32606 ç«¯å£ï¼Œè¯·æ±‚æµé‡éƒ½ä¼šè¢«è½¬å‘åˆ° Ingress-Nginx Pod çš„ 80 ç«¯å£æˆ– 443 ç«¯å£ä¸Šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/88/1f/8889b24b003d628ee7e6e473d456021f.jpg?wh=1920x878\" alt=\"å›¾ç‰‡\"></p><p>NodePort çš„æš´éœ²æ–¹å¼è™½ç„¶å¯ä»¥ç›´æ¥å¤ç”¨ Kubernetes èŠ‚ç‚¹çš„å…¬ç½‘ IPï¼Œä½†æˆ‘å¹¶<strong>ä¸æ¨èä½ åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨</strong>å®ƒã€‚ä¸»è¦çš„åŸå› æœ‰ä¸¤ä¸ªã€‚</p><p>é¦–å…ˆï¼Œç›´æ¥å¯¹å¤–æš´éœ²æœåŠ¡ä¸åˆ©äºç»Ÿä¸€ç®¡ç†å¤–éƒ¨è¯·æ±‚æµé‡ã€‚</p><p>å…¶æ¬¡ï¼Œä¸€ä¸ªç«¯å£åªèƒ½ç»‘å®šä¸€ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”é»˜è®¤çš„ç«¯å£èŒƒå›´æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥åœ¨è¾ƒå¤§è§„æ¨¡åœºæ™¯æ—¶ä½¿ç”¨å®¹æ˜“äº§ç”Ÿç«¯å£å†²çªã€‚å¦‚æœä½ å¸Œæœ›ä¸´æ—¶è®¿é—®é›†ç¾¤å†…çš„ä¸šåŠ¡æœåŠ¡ï¼Œå»ºè®®ä½ ä½¿ç”¨ç«¯å£è½¬å‘è¿›è¡Œè®¿é—®ï¼Œå®ƒé€‚ç”¨äºå¤§å¤šæ•°çš„ä¸´æ—¶åœºæ™¯ã€‚</p><h3>Loadbalancer</h3><p>é™¤äº† NodePort ç±»å‹ï¼Œ Loadbalancer ç±»å‹ä¹Ÿå¯ä»¥å¯¹å¤–æš´éœ² Service æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è´Ÿè½½å‡è¡¡å™¨ç±»å‹ã€‚</p><p>Loadbalancer ç±»å‹ä¸€èˆ¬ä¾èµ–äºäº‘å‚å•†å®ç°ã€‚å½“ Service è¢«å£°æ˜ä¸ºè´Ÿè½½å‡è¡¡å™¨ç±»å‹æ—¶ï¼Œäº‘å‚å•†ä¼šåˆ›å»ºä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨å®ä¾‹å¹¶å’Œé›†ç¾¤çš„ Service å…³è”ï¼Œå€ŸåŠ©è´Ÿè½½å‡è¡¡å™¨çš„å¤–ç½‘ IP åœ°å€ï¼Œå®ç° Service çš„å¯¹å¤–æš´éœ²ã€‚æ­¤æ—¶ï¼Œç›¸å½“äºæ¯ä¸€ä¸ª Loadbalancer ç±»å‹çš„ Service éƒ½å…·æœ‰ä¸€ä¸ªå¤–ç½‘ IP åœ°å€ï¼Œæ‰€æœ‰æµé‡å…ˆé€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œå†è½¬å‘åˆ°å¯¹åº”çš„ Service å½“ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/09/b08912yy502a52dd73282c12d1233c09.jpg?wh=1920x772\" alt=\"å›¾ç‰‡\"></p><p>Loadbalancer ç±»å‹ç›¸æ¯”è¾ƒ NodePort æœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚æ¯”å¦‚ï¼Œç†è®ºä¸Šæ¥è¯´å®ƒæš´éœ²æœåŠ¡çš„æ•°é‡ä¸ä¼šå—åˆ°ç«¯å£æ•°é‡çš„é™åˆ¶ã€‚ä»æ¶æ„è®¾è®¡ä¸Šæ¥è¯´ï¼Œæš´éœ²æœåŠ¡å’Œ Kubernetes èŠ‚ç‚¹å®ç°äº†è§£è€¦ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰å‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯å£°æ˜ä¸€ä¸ª Loadbalancer ç±»å‹çš„ Serviceï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è´Ÿè½½å‡è¡¡å™¨å®ä¾‹ï¼Œè´Ÿè½½å‡è¡¡å™¨ç”±äºå…·æœ‰å›ºå®š IP åœ°å€ï¼Œæ‰€ä»¥è´¹ç”¨ä¹Ÿç›¸å¯¹è¾ƒé«˜ï¼Œå¹¶ä¸”è¿˜éœ€è¦ä¸ºæµé‡é¢å¤–ä»˜è´¹ã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ç›´æ¥ç”¨ Loadbalancer ç±»å‹å¯¹å¤–æš´éœ²æœåŠ¡ï¼Œè€Œæ˜¯é€šè¿‡<strong>ç½‘å…³</strong>æ¥å®ç°æœåŠ¡æš´éœ²ï¼Œè¿™å’Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ä¼ ç»Ÿåº”ç”¨çš„æœåŠ¡æš´éœ²æ–¹å¼éå¸¸ç±»ä¼¼ã€‚è¿™æ—¶å€™ï¼Œå°±ä¸å¾—ä¸æåˆ°Ingress äº†ã€‚</p><h2>Ingress</h2><p>Ingress æ˜¯ Kubernetes çš„ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œé€šå¸¸æˆ‘ä»¬æŠŠ Ingress çœ‹ä½œ <strong>Service ä¹‹ä¸Šçš„ Serviceã€‚</strong>Ingress å¯¹è±¡åªç”¨æ¥å£°æ˜è·¯ç”±ç­–ç•¥ï¼Œå¹¶ä¸å¤„ç†å…·ä½“çš„æµé‡è½¬å‘ã€‚è¦ä½¿å¾— Ingress ç”Ÿæ•ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦é¢å¤–å®‰è£… Ingress-Controllerï¼Œä¾‹å¦‚ Ingress-Nginxã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒIngress-Nginx ä¸€èˆ¬å°±æ˜¯ä»¥ Loadbalancer ç±»å‹æ¥å¯¹å¤–æš´éœ²çš„ï¼ŒIngress-Nginx å®é™…ä¸Šå……å½“çš„æ˜¯ç½‘å…³çš„è§’è‰²ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œ<strong>æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨å®ä¾‹ï¼Œé€šè¿‡è·¯ç”±ç­–ç•¥ï¼Œå°±å¯ä»¥å¯¹å¤–æš´éœ²æ‰€æœ‰çš„ä¸šåŠ¡æœåŠ¡ã€‚</strong></p><h3>ç¤ºä¾‹åº”ç”¨çš„ Ingress</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ç¤ºä¾‹åº”ç”¨æ¥è¿›ä¸€æ­¥ç†è§£ Ingress å¯¹è±¡ã€‚åœ¨éƒ¨ç½²ç¤ºä¾‹åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å·²ç»ä¸ºæœ¬åœ°é›†ç¾¤éƒ¨ç½²äº† Ingress-Nginxï¼Œå¹¶ä¸”å°† Ingress å¯¹è±¡éƒ¨ç½²åˆ°äº†é›†ç¾¤ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ kuebctl get ingress æ¥è·å– Manifestã€‚</p><pre><code class=\"language-powershell\">$ kubectl get ingress frontend-ingress -n example -o yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n&nbsp; ......\n&nbsp; name: frontend-ingress\n&nbsp; namespace: example\nspec:\n&nbsp; ingressClassName: nginx\n&nbsp; rules:\n&nbsp; - http:\n&nbsp; &nbsp; &nbsp; paths:\n&nbsp; &nbsp; &nbsp; - backend:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: frontend-service\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number: 3000\n&nbsp; &nbsp; &nbsp; &nbsp; path: /?(.*)\n&nbsp; &nbsp; &nbsp; &nbsp; pathType: Prefix\n&nbsp; &nbsp; &nbsp; - backend:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: backend-service\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number: 5000\n&nbsp; &nbsp; &nbsp; &nbsp; path: /api/?(.*)\n&nbsp; &nbsp; &nbsp; &nbsp; pathType: Prefix\n</code></pre><p>åœ¨è¿™æ®µ Ingress é…ç½®ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ Paths å­—æ®µä¸‹çš„ Path å’Œ Backend å­—æ®µã€‚</p><p>Paths å­—æ®µä¸‹æœ‰ä¸¤ä¸ªæ•°ç»„ã€‚ç¬¬ä¸€ä¸ªæ•°ç»„ä»£è¡¨çš„è·¯ç”±ç­–ç•¥æ˜¯ï¼Œå½“ URL åŒ…å« / å‰ç¼€åŒ¹é…æ—¶ï¼Œé‚£ä¹ˆå°†è¯·æ±‚è½¬å‘åˆ° Backend å­—æ®µçš„é…ç½®çš„æœåŠ¡ä¸­ï¼Œä¹Ÿå°±æ˜¯è½¬å‘åˆ° frontend-service çš„ 3000 ç«¯å£ã€‚åŒç†ï¼Œç¬¬äºŒä¸ªæ•°ç»„çš„å«ä¹‰æ˜¯ï¼Œå½“ URL åŒ…å« /api å‰ç¼€åŒ¹é…æ—¶ï¼Œé‚£ä¹ˆå°†è¯·æ±‚è½¬å‘åˆ° backend-service çš„ 5000 ç«¯å£ã€‚</p><p>ç»†å¿ƒçš„ä½ åº”è¯¥ä¼šå‘ç°ï¼ŒIngress æŒ‡å®šçš„ Service ç«¯å£å·å…¶å®å°±æ˜¯ Service å¯¹è±¡çš„ Port å­—æ®µï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»“åˆ frontend-service çš„å†…å®¹è¿›è¡Œå¯¹æ¯”ã€‚</p><pre><code class=\"language-powershell\">apiVersion: v1\nkind: Service\nmetadata:\n  name: frontend-service\nspec:\n  type: ClusterIP\n  selector:\n    app: frontend\n  ports:\n  - port: 3000\n    targetPort: 3000\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ Paths ç¬¬ä¸€ä¸ªæ•°ç»„çš„è·¯ç”±ç­–ç•¥ä¸ºä¾‹ï¼Œå½“ Service æ¥æ”¶åˆ° Ingress è½¬å‘è¿‡æ¥çš„æµé‡ä¹‹åï¼ŒService ä¼šç»§ç»­å°†æµé‡è½¬å‘åˆ°ç¬¦åˆé€‰æ‹©å™¨ Labals app=frontend Pod çš„ 3000 ç«¯å£ä¸Šï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚é“¾è·¯ã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ç”»äº†å¼ æµé‡çš„é“¾è·¯å›¾ï¼Œä½ å¯ä»¥ç»“åˆå›¾ä¾‹æ¥è¿›è¡Œç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/21/74/21b8bdc1fa63e8193289cfaed9f5d674.jpg?wh=1920x862\" alt=\"å›¾ç‰‡\"></p><p>ä½ éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨æœ¬åœ°çš„ Kind æµ‹è¯•é›†ç¾¤å’Œç¤ºä¾‹åº”ç”¨ä¸­ï¼ŒIngress-Nginx æ˜¯é€šè¿‡ NodePort çš„æ–¹å¼å¯¹å¤–æš´éœ²çš„ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æœ¬åœ° Kind é›†ç¾¤ä¸­å®‰è£…çš„æ˜¯ç‰¹æ®Šç‰ˆæœ¬çš„ Ingress-Nginxï¼Œè€Œç”Ÿäº§ç‰ˆæœ¬çš„ Ingress-Nginx ä¸€èˆ¬æ˜¯é€šè¿‡ LoadBalancer å¯¹å¤–æš´éœ²çš„ã€‚</p><h3>ç”Ÿäº§ç¯å¢ƒä¸‹éƒ¨ç½² Ingress-Nginx</h3><p>é€šå¸¸ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨äº‘å‚å•†ç›´æ¥æä¾›çš„ Kubernetes é›†ç¾¤å’Œéƒ¨ç½²ç”Ÿäº§ç‰ˆæœ¬çš„ Ingress-Nginxã€‚è¦éƒ¨ç½²ç”Ÿäº§ç‰ˆæœ¬çš„ Ingress-Nginx å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚</p><pre><code class=\"language-powershell\">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.1/deploy/static/provider/cloud/deploy.yaml\n</code></pre><p>éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ kubectl get svc æ¥è·å– Ingress-Nginx çš„å¤–ç½‘ IP åœ°å€ã€‚æ³¨æ„ï¼Œéœ€è¦æŒ‡å®š ingress-nginx å‘½åç©ºé—´ã€‚</p><pre><code class=\"language-powershell\">$ kubectl get svc -n ingress-nginx\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TYPE&nbsp; &nbsp; &nbsp; &nbsp;   CLUSTER-IP&nbsp; &nbsp; &nbsp;EXTERNAL-IP&nbsp; &nbsp;PORT(S)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AGE\ningress-nginx-controller&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LoadBalancer  10.96.146.9&nbsp; &nbsp; 18.176.38.12&nbsp; 80:32192/TCP,443:30400/TCP&nbsp; &nbsp;13m\n</code></pre><p>å…¶ä¸­ï¼ŒEXTERNAL-IP å°±æ˜¯ Ingress-Nginx çš„å¤–ç½‘ IP åœ°å€ï¼Œè¿™ä¸ª IP ä¹Ÿå°±æ˜¯ä¸šåŠ¡ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒé…ç½®åˆ° DNS åŸŸåè§£æçš„è®°å½•ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡åŸŸåçš„æ–¹å¼æ¥è®¿é—®ä¸šåŠ¡åº”ç”¨äº†ã€‚</p><p><strong>åœ¨å¤šæ•°å®é™…é¡¹ç›®ä¸­ï¼ŒIngress éƒ½æ˜¯æœåŠ¡æš´éœ²çš„æœ€ä½³å®è·µã€‚</strong></p><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†ä¼ ç»Ÿå¾®æœåŠ¡åº”ç”¨çš„æš´éœ²æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯ï¼Œåœ¨æœ€å¤–å±‚éƒ¨ç½²ä¸€ä¸ªç½‘å…³ï¼ŒæŠŠå®ƒä½œä¸ºä¸šåŠ¡ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ã€‚è¿™ç§æœåŠ¡æš´éœ²æ–¹å¼å…·æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä¾‹å¦‚å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»Ÿä¸€ç®¡ç†è¿›å…¥ä¸šåŠ¡ç³»ç»Ÿçš„æµé‡ï¼Œç½‘å…³å±‚é¢ä¹Ÿå¯ä»¥åšä¸€äº›ç»Ÿä¸€çš„è®¤è¯å’Œæˆæƒç­‰ã€‚</p><p>åœ¨ Kubernetes ç¯å¢ƒä¸‹ï¼Œå¯¹å¤–æš´éœ²æœåŠ¡åˆ™éœ€è¦é€šè¿‡ Service æ¥å®ç°ã€‚ç”±äº Service çš„ IP é»˜è®¤æ˜¯ä¸€ä¸ªé›†ç¾¤å†…çš„ IPï¼Œæ— æ³•ä»å¤–éƒ¨è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸º Service èµ‹äºˆå¤–ç½‘ IP åœ°å€ã€‚å…¶ä¸­ï¼ŒNodePort ç±»å‹å¯ä»¥é€šè¿‡ Kubernetes èŠ‚ç‚¹å¤–ç½‘ IP + ç«¯å£å·çš„æ–¹å¼æä¾›å¤–ç½‘è®¿é—®èƒ½åŠ›ï¼Œä¸è¿‡å¹¶ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p><p>LoadBalancer ç±»å‹åˆ™éœ€è¦ä¾èµ–äº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸€èˆ¬ç”±äº‘å‚å•†å®ç°ã€‚åœ¨å¯¹ Service é…ç½®ä¸º LoadBalancer ç±»å‹åï¼Œäº‘å‚å•†å°†ä¼šå¼‚æ­¥åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨å®ä¾‹ï¼Œè¿™ç§æ–¹å¼å°†æš´éœ²æœåŠ¡å’Œ Kubernetes èŠ‚ç‚¹è¿›è¡Œäº†è§£è€¦ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„æœåŠ¡æš´éœ²æ–¹å¼ã€‚</p><p>ä¸è¿‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸æ¨èä»¥ LoadBalancer çš„æ–¹å¼æš´éœ²æ‰€æœ‰éœ€è¦åœ¨å¤–ç½‘è®¿é—®çš„ä¸šåŠ¡æœåŠ¡ï¼Œå› ä¸ºè¿™ä¸åˆ©äºç»Ÿä¸€ç®¡ç†è®¿é—®æµé‡ï¼Œå¹¶ä¸”è¿˜è¦ä¸ºå¤šä¸ªè´Ÿè½½å‡è¡¡å™¨å®ä¾‹æ”¯ä»˜é«˜æ˜‚çš„è´¹ç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† Ingress æ¥æš´éœ²æœåŠ¡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¦ä½¿ç”¨ Ingress é™¤äº†å£°æ˜ Ingress å¯¹è±¡ä»¥å¤–ï¼Œè¿˜éœ€è¦ä¸ºé›†ç¾¤å®‰è£… Ingress-Controllerï¼Œä¾‹å¦‚æœ€å¸¸è§çš„ Ingress-Nginxã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒIngress-Nginx æ­£æ˜¯é€šè¿‡ LoadBalancer ç±»å‹çš„ Service æ¥è‡ªèº«æš´éœ²åœ¨å…¬ç½‘ç¯å¢ƒçš„ã€‚</p><p><strong>é€šè¿‡ Ingress æš´éœ²æœåŠ¡çš„æ–¹å¼æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡æš´éœ²çš„æœ€ä½³å®è·µã€‚</strong></p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜å§ã€‚</p><ol>\n<li>ä½ èƒ½ç®€å•åˆ†äº«ç›®å‰é¡¹ç›®ä½¿ç”¨çš„æœåŠ¡æš´éœ²æ–¹å¼å—ï¼Ÿå¯ä»¥ä½¿ç”¨æ–‡å­—æè¿°ä¹Ÿå¯ä»¥å°è¯•ç”»ä¸€ä¸ªæ¶æ„å›¾ã€‚</li>\n<li>è¯·ä½ å°†ç›®å‰å·¥ä½œä¸­ä¸šåŠ¡æœåŠ¡çš„æš´éœ²æ–¹å¼å’Œ Kubernetes Ingress æœåŠ¡æš´éœ²æ–¹å¼åšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒã€‚ä½ è®¤ä¸ºå®ƒä»¬çš„ä¼˜åŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n</ol><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"09ï½œå¦‚ä½•è¿ç§»åº”ç”¨é…ç½®ï¼Ÿ","id":617792},"right":{"article_title":"11ï½œK8s æç®€å®æˆ˜ï¼ˆå…­ï¼‰ï¼šå¦‚ä½•ä¿éšœä¸šåŠ¡èµ„æºéœ€æ±‚å’Œè‡ªåŠ¨å¼¹æ€§æ‰©å®¹ï¼Ÿ","id":619621}},"comments":[{"had_liked":false,"id":365859,"user_name":"æå¤š","can_delete":false,"product_type":"c1","uid":2806068,"ip_address":"å¹¿ä¸œ","ucode":"974E2C405C2CE7","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg","comment_is_top":false,"comment_ctime":1673154346,"is_pvip":false,"replies":[{"id":133280,"content":"éå¸¸ä¸é”™çš„é¡¹ç›®ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673191197,"ip_address":"å¹¿ä¸œ","comment_id":365859,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è¿™é‡Œæ¨èä¸€ä¸ªå¼€æºé¡¹ç›®ï¼šMetalLB ã€‚ä¹‹å‰åœ¨åšå®éªŒçš„æ—¶å€™ï¼Œæ‹‰å–çš„å¾®æœåŠ¡yamlå¾ˆå¤šéƒ½ç”¨äº†LBã€‚ä½†æ˜¯è¿™äº›é€šå¸¸éœ€è¦ç§Ÿç”¨äº‘å‚å•†çš„k8sé›†ç¾¤æ‰èƒ½æœ‰ã€‚å°±æ‰¾åˆ°äº† MetalLB è¿™ä¸ªé¡¹ç›®ï¼Œæ”¯æŒåœ¨æœ¬åœ°é›†ç¾¤ã€è£¸é‡‘å±é›†ç¾¤ä¸Šé¢éƒ¨ç½²LBã€‚åœ¨å¼€å‘æµ‹è¯•æˆ–è€…å®éªŒç¯å¢ƒä¹Ÿèƒ½ä½¿ç”¨ LoadBalancer ç±»å‹çš„æœåŠ¡æš´éœ²äº†ã€‚æˆ‘åœ¨ç”¨ä¸‹æ¥æ„Ÿè§‰é…ç½®ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•ï¼Œå¥½ä¸Šæ‰‹ã€‚\n\nhttps:&#47;&#47;github.com&#47;metallb&#47;metallb\nhttps:&#47;&#47;metallb.universe.tf&#47;","like_count":9,"discussions":[{"author":{"id":1026502,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a9/c6/30b29c22.jpg","nickname":"é‚£é£åœ¨æå®¢","note":"","ucode":"132B9263006BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599092,"discussion_content":"æˆ‘çš„å®éªŒç¯å¢ƒä¹Ÿåœ¨ç”¨è¿™ä¸ª","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673334309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598903,"discussion_content":"éå¸¸ä¸é”™çš„é¡¹ç›®ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673191197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009622,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg","nickname":"xmr","note":"","ucode":"1BBF165F91F10B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622876,"discussion_content":"å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688750237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610369,"discussion_content":"ä¸‹æ¥è¯•è¯•ï¼Œæ„Ÿè°¢åˆ†äº«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679541826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®‰å¾½","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365303,"user_name":"GACÂ·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"å¹¿ä¸œ","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1672359134,"is_pvip":false,"replies":[{"id":133068,"content":"å¯ä»¥è¿™ä¹ˆåšã€‚\n\nä¸è¿‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸€èˆ¬ ingress-nginx HA æˆ‘ä»¬ä¼šè¿™ä¹ˆåšï¼š\n\n1. åœ¨å‡ å°é«˜é…èŠ‚ç‚¹ä¸Šéƒ¨ç½²ç‹¬å çš„å®ä¾‹ï¼Œå¹¶é…ç½®ç›¸åŒçš„èµ„æºé…é¢å’Œé™åˆ¶ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸šåŠ¡ç³»ç»Ÿæªæˆ˜èµ„æºä»¥åŠ ingress-nginx è¢«é©±é€ã€‚\n2. ä¸º ingress-nginx é…ç½® HPA ç­–ç•¥\n\nè¿™æ ·å°±å¯ä»¥å¾—åˆ°é«˜å¯ç”¨ç½‘å…³ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672370506,"ip_address":"å¹¿ä¸œ","comment_id":365303,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è€å¸ˆï¼ŒåŸŸååªèƒ½ç»‘åœ¨ä¸€ä¸ªIPä¸Šï¼Œåªä½¿ç”¨ingressåšä¸ºæµé‡å…¥å£ä¼šé€ æˆå•ç‚¹æ•…éšœã€‚å¦‚æœåœ¨ingresså‰é¢å†åŠ ä¸€ä¸ªLBï¼ŒåŸŸåç»‘åœ¨LBä¸Šï¼Œåˆ©ç”¨LBå°†æµé‡åˆ†å‘åˆ°ingressä¸Šï¼Œè¿™æ ·å¯ä»¥å—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597954,"discussion_content":"å¯ä»¥è¿™ä¹ˆåšã€‚\n\nä¸è¿‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸€èˆ¬ ingress-nginx HA æˆ‘ä»¬ä¼šè¿™ä¹ˆåšï¼š\n\n1. åœ¨å‡ å°é«˜é…èŠ‚ç‚¹ä¸Šéƒ¨ç½²ç‹¬å çš„å®ä¾‹ï¼Œå¹¶é…ç½®ç›¸åŒçš„èµ„æºé…é¢å’Œé™åˆ¶ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸šåŠ¡ç³»ç»Ÿæªæˆ˜èµ„æºä»¥åŠ ingress-nginx è¢«é©±é€ã€‚\n2. ä¸º ingress-nginx é…ç½® HPA ç­–ç•¥\n\nè¿™æ ·å°±å¯ä»¥å¾—åˆ°é«˜å¯ç”¨ç½‘å…³ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1672370506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":610371,"discussion_content":"è€å¸ˆï¼Œç‹¬å çš„å®ä¾‹æ˜¯æŒ‡ DaemonSet å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679541870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":597954,"ip_address":"å®‰å¾½","group_id":0},"score":610371,"extra":""},{"author":{"id":1009622,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg","nickname":"xmr","note":"","ucode":"1BBF165F91F10B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622875,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688750197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":610371,"ip_address":"å¹¿ä¸œ","group_id":0},"score":622875,"extra":""}]}]},{"had_liked":false,"id":367225,"user_name":"å°è·¯é£ğŸ˜","can_delete":false,"product_type":"c1","uid":1282445,"ip_address":"æ–°ç–†","ucode":"9EC780CF1D9687","user_header":"https://static001.geekbang.org/account/avatar/00/13/91/8d/0134973d.jpg","comment_is_top":false,"comment_ctime":1675052122,"is_pvip":false,"replies":[{"id":133905,"content":"ä¹Ÿæ˜¯éå¸¸ä¸é”™çš„æŠ€æœ¯é€‰å‹ï¼ŒTraefik ä¹Ÿéå¸¸æˆç†Ÿäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1675415362,"ip_address":"å¹¿ä¸œ","comment_id":367225,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æˆ‘è¿™è¾¹çš„äº‘å¹³å°ï¼Œé‡‡ç”¨traefik","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601810,"discussion_content":"ä¹Ÿæ˜¯éå¸¸ä¸é”™çš„æŠ€æœ¯é€‰å‹ï¼ŒTraefik ä¹Ÿéå¸¸æˆç†Ÿäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675415362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366403,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"å†…è’™å¤","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1673707519,"is_pvip":false,"replies":[{"id":133507,"content":"éƒ¨ç½²çš„ ingress ç‰ˆæœ¬çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œå¯ä»¥å°è¯• kubectl describe service ingress-nginx-controller -n ingress-nginx æŸ¥çœ‹ä¸€ä¸‹äº‹ä»¶ã€‚å¦å¤–å¯ä»¥å»è…¾è®¯äº‘æ§åˆ¶å°æ‰“å¼€è´Ÿè½½å‡è¡¡å™¨ï¼Œæ£€æŸ¥å®ä¾‹åˆå§‹åŒ–çš„æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673739840,"ip_address":"å¹¿ä¸œ","comment_id":366403,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"\n\nåœ¨è…¾è®¯äº‘æ­å»ºäº†1ä¸ªmasterèŠ‚ç‚¹ï¼Œ2ä¸ªnodeèŠ‚ç‚¹çš„å®éªŒç¯å¢ƒã€‚\nâœ  ingress git:(master) kubectl get svc -n ingress-nginx\n\nNAME                                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx-controller             LoadBalancer   10.97.238.89    &lt;pending&gt;     80:32446&#47;TCP,443:31186&#47;TCP   18m\ningress-nginx-controller-admission   ClusterIP      10.105.63.105   &lt;none&gt;        443&#47;TCP    \n\nå¤–ç½‘IPå§‹ç»ˆæ˜¯pendingï¼Ÿ\nè¯·é—®è€å¸ˆï¼Œingress-nginx-controller å„ä¸ªäº‘æœåŠ¡å•†éƒ½æ˜¯éƒ¨ç½²è¿™ä¸ªé“¾æ¥çš„yamlæ–‡ä»¶å—ï¼š\nhttps:&#47;&#47;raw.githubusercontent.com&#47;kubernetes&#47;ingress-nginx&#47;controller-v1.3.1&#47;deploy&#47;static&#47;provider&#47;cloud&#47;deploy.yaml","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599716,"discussion_content":"éƒ¨ç½²çš„ ingress ç‰ˆæœ¬çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œå¯ä»¥å°è¯• kubectl describe service ingress-nginx-controller -n ingress-nginx æŸ¥çœ‹ä¸€ä¸‹äº‹ä»¶ã€‚å¦å¤–å¯ä»¥å»è…¾è®¯äº‘æ§åˆ¶å°æ‰“å¼€è´Ÿè½½å‡è¡¡å™¨ï¼Œæ£€æŸ¥å®ä¾‹åˆå§‹åŒ–çš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673739840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155913,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","nickname":"å†œæ°‘å›­ä¸","note":"","ucode":"6A91EBBC9DCE6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599830,"discussion_content":"è€å¸ˆï¼Œè¿˜æ˜¯ä¸èƒ½è·å–å¤–ç½‘IPï¼Œæˆ‘ç”¨çš„æ˜¯è…¾è®¯è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼Œæ²¡æœ‰è´­ä¹°è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸çŸ¥é“å’Œè¿™ä¸ªæœ‰æ²¡æœ‰å…³ç³»ã€‚\nkubectl describe svc -n ingress-nginx æ˜¾ç¤ºeventsï¼šNone\n\nkubectl describe pod -n ingress-nginx æ˜¾ç¤ºçš„events\n\nEvents:\n  Type     Reason       Age                    From                      Message\n  ----     ------       ----                   ----                      -------\n  Normal   Scheduled    8m22s                  default-scheduler         Successfully assigned ingress-nginx/ingress-nginx-controller-5fbf49f7d7-48dxr to k8s-node02\n  Warning  FailedMount  8m21s (x2 over 8m22s)  kubelet                   MountVolume.SetUp failed for volume &#34;webhook-cert&#34; : secret &#34;ingress-nginx-admission&#34; not found\n  Normal   Pulling      8m20s                  kubelet                   Pulling image &#34;registry.k8s.io/ingress-nginx/controller:v1.3.1@sha256:54f7fe2c6c5a9db9a0ebf1131797109bb7a4d91f56b9b362bde2abd237dd1974&#34;\n  Normal   Pulled       8m19s                  kubelet                   Successfully pulled image &#34;registry.k8s.io/ingress-nginx/controller:v1.3.1@sha256:54f7fe2c6c5a9db9a0ebf1131797109bb7a4d91f56b9b362bde2abd237dd1974&#34; in 160.191266ms\n  Normal   Created      8m19s                  kubelet                   Created container controller\n  Normal   Started      8m19s                  kubelet                   Started container controller\n  Normal   RELOAD       6m34s (x2 over 8m18s)  nginx-ingress-controller  NGINX reload triggered due to a change in configuration\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673837579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å†…è’™å¤","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155913,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","nickname":"å†œæ°‘å›­ä¸","note":"","ucode":"6A91EBBC9DCE6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599842,"discussion_content":"\nâœ  kubernetes-example git:(main) âœ— kubectl get secret -A|grep ingress\ningress-nginx     default-token-kwk98                              kubernetes.io/service-account-token   3      4m5s\ningress-nginx     ingress-nginx-admission                          Opaque                                3      4m4s\ningress-nginx     ingress-nginx-admission-token-5h9nq              kubernetes.io/service-account-token   3      4m5s\ningress-nginx     ingress-nginx-token-vhgh9                        kubernetes.io/service-account-token   3      4m5s\nnginx-ingress     default-server-secret                            kubernetes.io/tls                     2      52m\nnginx-ingress     default-token-vvzjj                              kubernetes.io/service-account-token   3      52m\nnginx-ingress     nginx-ingress-token-jh78m                        kubernetes.io/service-account-token   3      52m\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673839467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å†…è’™å¤","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155913,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","nickname":"å†œæ°‘å›­ä¸","note":"","ucode":"6A91EBBC9DCE6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599832,"discussion_content":"âœ  kubernetes-example git:(main) âœ— kubectl get pod -n ingress-nginx\n\nNAME                                        READY   STATUS      RESTARTS   AGE\ningress-nginx-admission-create-m8tf5        0/1     Completed   0          13m\ningress-nginx-admission-patch-2jg6r         0/1     Completed   0          13m\ningress-nginx-controller-5fbf49f7d7-48dxr   1/1     Running     0          13m\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673837699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å†…è’™å¤","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366243,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"å†…è’™å¤","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1673504744,"is_pvip":false,"replies":[{"id":133451,"content":"æ˜¯çš„ï¼Œå‰ææ˜¯éœ€è¦æŒ‡å®š config.yaml æš´éœ² 80 ç«¯å£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1673525463,"ip_address":"å¹¿ä¸œ","comment_id":366243,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"å¦‚æœæ˜¯Kindåˆ›å»ºçš„clusterï¼Œå°±æ˜¯ä»å®¿ä¸»æœºçš„80ç«¯å£-æš´-éœ²-çš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599453,"discussion_content":"æ˜¯çš„ï¼Œå‰ææ˜¯éœ€è¦æŒ‡å®š config.yaml æš´éœ² 80 ç«¯å£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673525463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375091,"user_name":"gxxc","can_delete":false,"product_type":"c1","uid":1351752,"ip_address":"ä¸Šæµ·","ucode":"519A2C05146DE9","user_header":"https://static001.geekbang.org/account/avatar/00/14/a0/48/a10fa801.jpg","comment_is_top":false,"comment_ctime":1684898217,"is_pvip":false,"replies":[{"id":136932,"content":"éå¸¸å¥½çš„é—®é¢˜ã€‚\nç¬¬ä¸€ç‚¹ï¼Œå¯¹äºäº‘å‚å•†çš„é›†ç¾¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ LB ç±»å‹æ¥æš´éœ² Ingress-Nginxã€‚å¯¹äºè‡ªå»ºé›†ç¾¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ MetalLB + LB çš„æ–¹å¼æ¥æš´éœ²ã€‚\nç¬¬äºŒç‚¹ï¼Œå…¶å®å¤§å®¶è¿™ä¹ˆè¯´çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºå®é™…ç”Ÿäº§ä¸Š Ingress-Nginx ä¸€èˆ¬éƒ½æ˜¯ä»¥ LB æ–¹å¼æš´éœ²çš„ï¼Œè¿™æ ·çš„è¯æµé‡çš„å…¥å£æ˜¯ç›´æ¥ä» LB æ‰“åˆ° Ingress-Nginx Pod ä¸Šï¼Œç„¶åè¿›è¡Œè½¬å‘ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯æµé‡å…¥å£ã€‚NodePort çš„æš´éœ²æ–¹å¼æ˜¯å› ä¸ºå®éªŒç¯å¢ƒæ²¡æœ‰ LB çš„æ”¯æŒï¼Œæ‰€ä»¥ç”¨è¯¥æ–¹å¼ä»£æ›¿ï¼Œä½ ç”»çš„æµé‡é“¾è·¯å¯ä»¥è¿™ä¹ˆç†è§£ã€‚\næœ€åå…³äº 2 ä¸ªèŠ‚ç‚¹éœ€è¦ HA è¿™å—æˆ‘æ²¡ç†è§£ï¼Œå¯ä»¥è¡¥å……ä¸€ä¸‹å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1685070853,"ip_address":"å¹¿ä¸œ","comment_id":375091,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æœ‰å‡ ä¸ªé—®é¢˜è¯·æ•™ï¼š \n1. nodePortçš„ingress-nginx-controlleræ˜¯ç›‘å¬äº†3ä¸‡ä¹‹åçš„ç«¯å£ï¼Œä½†å¤–éƒ¨ç”¨æˆ·åªä¼šä½¿ç”¨é»˜è®¤çš„80&#47;443è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªç½‘å…³æŠŠæµé‡ä»80&#47;443å‘é€åˆ°å¯¹åº”çš„nodePortä¸Šã€‚åœ¨è‡ªå»ºé›†ç¾¤é‡Œï¼Œé™¤äº†åœ¨æœ€å‰ç«¯å¢åŠ HAproxyç­‰åå‘ä»£ç†ï¼Œè¿˜æœ‰ä»€ä¹ˆå…¶ä»–åŠæ³•ä¹ˆï¼Ÿ\n\n2. è™½ç„¶å¤§å®¶éƒ½åœ¨è¯´â€œingressæ˜¯æœ€å‰ç«¯çš„ç½‘å…³â€ï¼Œä½†å®é™…å¥½åƒå¹¶ä¸æ˜¯è¿™æ ·ï¼Œingresså¥½åƒåªæ˜¯ingress-nginxå¤„ç†è·¯ç”±çš„é…ç½®æ–‡ä»¶ï¼Œæ­£å¦‚æ–‡ä¸­æ‰€è¯´çš„â€œingressåªç”¨æ¥å£°æ˜è·¯ç”±ç­–ç•¥â€ã€‚\nä»ingress-nginxçœ‹ï¼Œå¯¹å¤–çš„nodePortæ˜¯SVC-ingress-nginx-controlleræš´éœ²çš„ã€‚é‚£ä¹ˆæµé‡è·¯å¾„åº”è¯¥å¦‚ä¸‹ï¼š\nå®¢æˆ·æµé‡ ----&gt; NodePortï¼ˆSVC-ingress-nginx-controllerï¼‰----&gt; è·¯ç”±å¤„ç†ï¼ˆPOD-ingress-nginx-controllerï¼‰ ----&gt; å¯¹åº”æœåŠ¡ï¼ˆSVC-frontend-serviceï¼‰----&gt; çœŸå®è´Ÿè½½ï¼ˆPOD-frontend-6b48fbbc48-ks9brï¼‰\n\nå¦‚æœä¸Šè¿°æµé‡è·¯å¾„æ­£ç¡®ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹å‡ºå®é™…ä¸Šä»ç„¶åªæœ‰SVCå’ŒPODï¼Œåªä¸è¿‡äººä»¬æŠŠå¤„ç†è·¯ç”±çš„ç½‘å…³ç§°ä¸ºingressã€‚\nè¿™ä¸ªè·¯å¾„é‡Œæœ‰2ä¸ªèŠ‚ç‚¹ç‚¹æ˜¯éœ€è¦HAçš„ï¼Œç¬¬ä¸€æ˜¯POD-ingress-nginx-controllerï¼Œç¬¬äºŒæ˜¯çœŸå®è´Ÿè½½PODã€‚æ‰€ä»¥è€å¸ˆåœ¨ç¬¬ä¸€ä¸ªè¯„è®ºé‡Œå›å¤æ˜¯â€œä¸º ingress-nginx é…ç½® HPA ç­–ç•¥â€ï¼Œå¯¹å—ï¼Ÿ \n\n\n\n\n","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619408,"discussion_content":"éå¸¸å¥½çš„é—®é¢˜ã€‚\nç¬¬ä¸€ç‚¹ï¼Œå¯¹äºäº‘å‚å•†çš„é›†ç¾¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ LB ç±»å‹æ¥æš´éœ² Ingress-Nginxã€‚å¯¹äºè‡ªå»ºé›†ç¾¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ MetalLB + LB çš„æ–¹å¼æ¥æš´éœ²ã€‚\nç¬¬äºŒç‚¹ï¼Œå…¶å®å¤§å®¶è¿™ä¹ˆè¯´çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºå®é™…ç”Ÿäº§ä¸Š Ingress-Nginx ä¸€èˆ¬éƒ½æ˜¯ä»¥ LB æ–¹å¼æš´éœ²çš„ï¼Œè¿™æ ·çš„è¯æµé‡çš„å…¥å£æ˜¯ç›´æ¥ä» LB æ‰“åˆ° Ingress-Nginx Pod ä¸Šï¼Œç„¶åè¿›è¡Œè½¬å‘ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯æµé‡å…¥å£ã€‚NodePort çš„æš´éœ²æ–¹å¼æ˜¯å› ä¸ºå®éªŒç¯å¢ƒæ²¡æœ‰ LB çš„æ”¯æŒï¼Œæ‰€ä»¥ç”¨è¯¥æ–¹å¼ä»£æ›¿ï¼Œä½ ç”»çš„æµé‡é“¾è·¯å¯ä»¥è¿™ä¹ˆç†è§£ã€‚\næœ€åå…³äº 2 ä¸ªèŠ‚ç‚¹éœ€è¦ HA è¿™å—æˆ‘æ²¡ç†è§£ï¼Œå¯ä»¥è¡¥å……ä¸€ä¸‹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685070853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1351752,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a0/48/a10fa801.jpg","nickname":"gxxc","note":"","ucode":"519A2C05146DE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":619610,"discussion_content":"å—¯ï¼Œè°¢è°¢è€å¸ˆã€‚æˆ‘è¯´â€œ2ä¸ªèŠ‚ç‚¹éœ€è¦HAâ€æ˜¯è¿™ä¹ˆç†è§£çš„ï¼š \nå°±æ˜¯æŒ‡ &#34;Ingress-Nginx Pod&#34; å’Œ &#34;çœŸå®ä¸šåŠ¡å®¹å™¨&#34; éœ€è¦å¤šä¸ªå‰¯æœ¬ï¼ŒçœŸå®ä¸šåŠ¡ä¸ç”¨è¯´ï¼Œå…³é”®æ˜¯ä¸å¯ä»¥å› ä¸ºæ¯ä¸ªK8SèŠ‚ç‚¹éƒ½å¯ä»¥æ¥æ”¶æµé‡è€Œåªç”Ÿæˆä¸€ä¸ªIngress-Nginx Podï¼Œè€Œæ˜¯åº”è¯¥è‡³å°‘2ä¸ªï¼Œå¹¶ä¸”è®¾ç½®HPAç­–ç•¥ï¼Œæœ‰ç‚¹åºŸè¯æ–‡å­¦äº†^ ^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685337723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":619408,"ip_address":"ä¸Šæµ·","group_id":0},"score":619610,"extra":""}]}]},{"had_liked":false,"id":365413,"user_name":"JDLYyear","can_delete":false,"product_type":"c1","uid":1807838,"ip_address":"å¹¿ä¸œ","ucode":"8F9BB765D0683E","user_header":"https://static001.geekbang.org/account/avatar/00/1b/95/de/bddd9a57.jpg","comment_is_top":false,"comment_ctime":1672475175,"is_pvip":false,"replies":[{"id":133114,"content":"è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„æ˜¯ Ingress-Nginxï¼Œæµé‡å®é™…ä¸Šå…ˆæ˜¯ç”±Nginx è½¬å‘åˆ° Service çš„ï¼Œç„¶å Service è½¬å‘åˆ°ä¸šåŠ¡ Pod é‡Œçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672534754,"ip_address":"å¹¿ä¸œ","comment_id":365413,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"è€å¸ˆï¼Œæ–‡ä¸­è¯´ï¼šIngress å¯¹è±¡åªç”¨æ¥å£°æ˜è·¯ç”±ç­–ç•¥ï¼Œå¹¶ä¸å¤„ç†å…·ä½“çš„æµé‡è½¬å‘ã€‚\né‚£æµé‡è½¬å‘å®é™…ä¸Šè¿˜æ˜¯serviceæ¥åšå—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598092,"discussion_content":"è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„æ˜¯ Ingress-Nginxï¼Œæµé‡å®é™…ä¸Šå…ˆæ˜¯ç”±Nginx è½¬å‘åˆ° Service çš„ï¼Œç„¶å Service è½¬å‘åˆ°ä¸šåŠ¡ Pod é‡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672534754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365336,"user_name":"0ck0","can_delete":false,"product_type":"c1","uid":1167324,"ip_address":"å¹¿ä¸œ","ucode":"6DCD6ECE7B9BF0","user_header":"https://static001.geekbang.org/account/avatar/00/11/cf/dc/f119f657.jpg","comment_is_top":false,"comment_ctime":1672371225,"is_pvip":false,"replies":[{"id":133071,"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹éƒ¨ç½²çš„ ingress-nginx æ˜¯ LoadBalancer ç±»å‹çš„ Serviceï¼Œäº‘å‚å•†ä¼šè‡ªåŠ¨åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨å¹¶è¿›è¡Œå…³è”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672372534,"ip_address":"å¹¿ä¸œ","comment_id":365336,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"ç”Ÿäº§ç¯å¢ƒä¸‹éƒ¨ç½² Ingress-Nginx, å…¬ç½‘ ip æ˜¯å¦‚ä½•åˆ†é…ç»™ Ingress-Nginx ï¼Ÿ ","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597963,"discussion_content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹éƒ¨ç½²çš„ ingress-nginx æ˜¯ LoadBalancer ç±»å‹çš„ Serviceï¼Œäº‘å‚å•†ä¼šè‡ªåŠ¨åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨å¹¶è¿›è¡Œå…³è”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672372534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365316,"user_name":"æ©™æ±","can_delete":false,"product_type":"c1","uid":1332257,"ip_address":"å¹¿ä¸œ","ucode":"EC3FF10D708C9D","user_header":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","comment_is_top":false,"comment_ctime":1672367882,"is_pvip":false,"replies":[{"id":133070,"content":"ğŸ‘ğŸ»æ˜¯çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹äº‘å‚å•†ä¼šå®ç° lb ç±»å‹çš„ ingressï¼Œæ‰€ä»¥å°±ä¼šæœ‰å¤–ç½‘ IPï¼Œæœ¬åœ° kind é›†ç¾¤æ˜¯æ²¡æœ‰çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672370734,"ip_address":"å¹¿ä¸œ","comment_id":365316,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"æ–‡ç« ä¸­æ¼”ç¤ºçš„åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ingressï¼Œæ„Ÿè§‰å¤§å®¶ä¸ç†è§£åˆ«çº ç»“ çœ‹çœ‹äº‘å‚å•†çš„æ¯”å¦‚é˜¿é‡Œ æœ‰ç»„ä»¶éƒ¨ç½²åä¼šç›´æ¥ä¸slbé“¾æ¥ï¼Œè‡ªåŠ¨ç”ŸæˆIPåœ°å€ï¼Œç›´æ¥é…ç½®ingressè§„åˆ™å³å¯ï¼Œæˆ‘çŒœè€å¸ˆæ¼”ç¤ºçš„ä¹Ÿæ˜¯åœ¨äº‘æœåŠ¡å™¨ä¸Šä¸ç„¶ä¸ä¼šå‡ºæ¥å…¬ç½‘åœ°å€ã€‚","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597958,"discussion_content":"ğŸ‘ğŸ»æ˜¯çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹äº‘å‚å•†ä¼šå®ç° lb ç±»å‹çš„ ingressï¼Œæ‰€ä»¥å°±ä¼šæœ‰å¤–ç½‘ IPï¼Œæœ¬åœ° kind é›†ç¾¤æ˜¯æ²¡æœ‰çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672370734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1167324,"avatar":"https://static001.geekbang.org/account/avatar/00/11/cf/dc/f119f657.jpg","nickname":"0ck0","note":"","ucode":"6DCD6ECE7B9BF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597962,"discussion_content":"éå…¬æœ‰äº‘ç¯å¢ƒï¼Œå…¬ç½‘ ip çš„æµé‡å¦‚ä½•æ‰“åˆ° ingress-nginx ä¸Šé¢å‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1672371340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374707,"user_name":"fan","can_delete":false,"product_type":"c1","uid":2698201,"ip_address":"å¹¿ä¸œ","ucode":"B421876B78283C","user_header":"https://static001.geekbang.org/account/avatar/00/29/2b/d9/33a8df89.jpg","comment_is_top":false,"comment_ctime":1684332606,"is_pvip":false,"replies":[{"id":136738,"content":"å¦‚æœæ˜¯ä½¿ç”¨ K8s çš„æœåŠ¡å‘ç°ï¼Œå°±ä¸éœ€è¦å†…ç½‘çš„ gateway äº†ï¼Œå¦‚æœæœåŠ¡å‘ç°æœ‰ä¸“é—¨çš„æœåŠ¡ï¼Œé‚£å°±è¿˜æ˜¯éœ€è¦ gatewayã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1684380118,"ip_address":"å¹¿ä¸œ","comment_id":374707,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"ä¼ ç»Ÿå¾®æœåŠ¡æ¶æ„\nnginxï¼ˆæœ‰å¤–ç½‘IPï¼‰ -&gt; gateway(å†…ç½‘IP) -&gt; nacos -&gt; ä¸šåŠ¡å¾®æœåŠ¡\nk8sä¸­ï¼Œä¸éœ€è¦gateway è¿™ä¸ªå¾®æœåŠ¡äº†å—?\nè¿˜æ˜¯è¯¥æ€ä¹ˆç†è§£ï¼Œè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618604,"discussion_content":"å¦‚æœæ˜¯ä½¿ç”¨ K8s çš„æœåŠ¡å‘ç°ï¼Œå°±ä¸éœ€è¦å†…ç½‘çš„ gateway äº†ï¼Œå¦‚æœæœåŠ¡å‘ç°æœ‰ä¸“é—¨çš„æœåŠ¡ï¼Œé‚£å°±è¿˜æ˜¯éœ€è¦ gatewayã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684380118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371169,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"å®‰å¾½","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1679619621,"is_pvip":false,"replies":[{"id":135430,"content":"Loadbalancer ç±»å‹çš„ Service èƒ½åŠ›åªèƒ½åœ¨äº‘å‚å•†çš„é›†ç¾¤ä½¿ç”¨ï¼Œå¼€é€šä¸€å° TKE å³å¯ã€‚\næœ¬åœ° Kind æ˜¯é€šè¿‡ NodePort çš„æ–¹å¼æš´éœ²çš„ï¼Œè€Œä¸æ˜¯ Loadbalancerã€‚\n\nå…¶å®æœ¬è´¨ä¸Šä½ åœ¨å£°æ˜ LB çš„ Service ä¹‹åï¼Œé›†ç¾¤é‡Œæœ‰ä¸€ä¸ªäº‘å‚å•†çš„æ§åˆ¶å™¨åœ¨èƒŒåå¸®ä½ å¼€é€šäº†è´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶åå’Œ Service IP å…³é”®èµ·æ¥äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1679656377,"ip_address":"å¹¿ä¸œ","comment_id":371169,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œæ‚¨åœ¨è…¾è®¯äº‘ä¸Šç”¨çš„æœºå™¨æ˜¯ TKE é›†ç¾¤å—ï¼Œå°±æ˜¯å®šåˆ¶è¿‡çš„ Kubernetes ç¯å¢ƒã€‚\n\næˆ‘åœ¨è…¾è®¯äº‘ä¸Šä¹°çš„æ˜¯è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼Œå®‰è£…å¥½äº† Kind é›†ç¾¤ï¼Œç„¶ååˆä¹°äº†è´Ÿè½½å‡è¡¡å®ä¾‹ï¼ŒæŒ‰ç…§è¿™èŠ‚è¯¾æœ€åçš„è„šæœ¬å®‰è£… ingress åï¼Œingress å¯¹åº”çš„ Service ä¸€ç›´æ˜¯ Pending çŠ¶æ€ã€‚\n\næˆ‘ç†è§£è¿™æ ·æ˜¯æ— æ³•ç»‘å®šåˆ°å¯¹åº”çš„è´Ÿè½½å‡è¡¡å®ä¾‹çš„ï¼Œåº”è¯¥è¦è´­ä¹° TKE é›†ç¾¤æ‰è¡Œï¼ˆå³éœ€è¦å®šåˆ¶åçš„ Kubernetes æ”¯æŒï¼‰ï¼Œæ‰€ä»¥é—®é—®è€å¸ˆçš„ Kind é›†ç¾¤æ˜¯åœ¨è…¾è®¯äº‘ä¸Šå“ªç±»æœºå™¨ä¸Šè·‘çš„ã€‚\n\næˆ‘æäº†ä¸€ä¸ªå·¥å•ï¼Œå¯¹æ–¹åŒå­¦çš„å›å¤æ˜¯ï¼š â€œè´Ÿè½½å‡è¡¡å™¨ç­‰æ“ä½œï¼Œéƒ½éœ€è¦æ‚¨é€šè¿‡è‡ªå»ºåº•å±‚æ¥å®Œæˆï¼Œè½»é‡æœåŠ¡å™¨æœ¬èº«æœ‰ç‰¹æ€§é™åˆ¶ï¼Œæ²¡æœ‰ç§æœ‰ç½‘ç»œçš„å±æ€§ï¼Œæ‰€ä»¥åƒEIPï¼Œclbä¸€ç±»éœ€è¦ç§æœ‰ç½‘ç»œæ”¯æŒçš„äº§å“æ²¡æœ‰åŠæ³•å¯¹æ¥åˆ°è½»é‡æœåŠ¡å™¨ä½¿ç”¨ï¼Œå¦‚æœåœ¨ä¸é€‚ç”¨tkeé›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œéƒ¨ç½²çº¯å‡€Kubernetes ç»“åˆäº‘ä¸Šçš„clbç­‰ä½¿ç”¨ï¼Œå»ºè®®è€ƒè™‘ä½¿ç”¨äº‘æœåŠ¡å™¨ã€‚ä½†æ˜¯åŒæ ·çš„ï¼Œç›¸å…³è‡ªå»ºæ–¹é¢æ˜¯æ²¡æœ‰å‚è€ƒæ–‡æ¡£ï¼Œå»ºè®®æ‚¨å¯é€šè¿‡äº‘ç¤¾åŒºä¸ç›¸å…³çš„äº‘æŠ€æœ¯çˆ±å¥½è€…è¿›è¡Œæ²Ÿé€šæé—®ä¸‹ã€‚â€","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610635,"discussion_content":"Loadbalancer ç±»å‹çš„ Service èƒ½åŠ›åªèƒ½åœ¨äº‘å‚å•†çš„é›†ç¾¤ä½¿ç”¨ï¼Œå¼€é€šä¸€å° TKE å³å¯ã€‚\næœ¬åœ° Kind æ˜¯é€šè¿‡ NodePort çš„æ–¹å¼æš´éœ²çš„ï¼Œè€Œä¸æ˜¯ Loadbalancerã€‚\n\nå…¶å®æœ¬è´¨ä¸Šä½ åœ¨å£°æ˜ LB çš„ Service ä¹‹åï¼Œé›†ç¾¤é‡Œæœ‰ä¸€ä¸ªäº‘å‚å•†çš„æ§åˆ¶å™¨åœ¨èƒŒåå¸®ä½ å¼€é€šäº†è´Ÿè½½å‡è¡¡å™¨ï¼Œç„¶åå’Œ Service IP å…³é”®èµ·æ¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679656377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369117,"user_name":"quietwater","can_delete":false,"product_type":"c1","uid":1055029,"ip_address":"åŒ—äº¬","ucode":"C25E2CD356D3F9","user_header":"https://static001.geekbang.org/account/avatar/00/10/19/35/be8372be.jpg","comment_is_top":false,"comment_ctime":1677123776,"is_pvip":false,"replies":[{"id":134467,"content":"ç›¸æ¯”è¾ƒ Nginx ingressï¼ŒAPISIX ç¡®å®åŠŸèƒ½ä¼šæ›´åŠ ä¸°å¯Œã€‚ä¸è¿‡ä¸»è¦è¿˜æ˜¯çœ‹ä¸šåŠ¡å®é™…æƒ…å†µï¼Œä¸€èˆ¬æ¥è¯´ Nginx Ingress å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡éœ€æ±‚ï¼Œå‘å±•æ—¶é—´ä¹…ï¼Œç¨³å®šæ€§æ–¹é¢æ¯”è¾ƒæœ‰ä¿è¯ã€‚\nåœ¨é K8s æ¶æ„ä¸‹ï¼Œç›¸æ¯”è¾ƒ Nginxï¼ŒAPISIX æœ‰å¾ˆå¤§çš„çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚é‰´æƒè¿™é‡Œæ”¯æŒä¸°å¯Œçš„ç±»å‹ï¼Œè€Œä¸”æœ‰å¾ˆå¤šæ’ä»¶ã€‚\nå…·ä½“çš„åŒºåˆ«å’Œä¼˜åŠ¿ä½ å¯ä»¥æŸ¥çœ‹è¿™ç¯‡å®˜æ–¹å‘çš„æ–‡ç« ï¼šhttps:&#47;&#47;apisix.apache.org&#47;zh&#47;blog&#47;2023&#47;01&#47;11&#47;apisix-ingress-vs-ingress-nginx&#47;","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1677130150,"ip_address":"å¹¿ä¸œ","comment_id":369117,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸ªIngressé€‰å‹çš„é—®é¢˜ã€‚Kong Ingressï¼ŒAPISIX Ingressï¼Œ Nginx Ingresså‡ ä¸ªIngressæ¯”è¾ƒäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰APISIXåº”è¯¥æ›´å¼ºå¤§ä¸€äº›ï¼Œæ‚¨èƒ½ä¸èƒ½é’ˆå¯¹Ingressé€‰å‹åŠ ä¸ªé¤ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606404,"discussion_content":"ç›¸æ¯”è¾ƒ Nginx ingressï¼ŒAPISIX ç¡®å®åŠŸèƒ½ä¼šæ›´åŠ ä¸°å¯Œã€‚ä¸è¿‡ä¸»è¦è¿˜æ˜¯çœ‹ä¸šåŠ¡å®é™…æƒ…å†µï¼Œä¸€èˆ¬æ¥è¯´ Nginx Ingress å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡éœ€æ±‚ï¼Œå‘å±•æ—¶é—´ä¹…ï¼Œç¨³å®šæ€§æ–¹é¢æ¯”è¾ƒæœ‰ä¿è¯ã€‚\nåœ¨é K8s æ¶æ„ä¸‹ï¼Œç›¸æ¯”è¾ƒ Nginxï¼ŒAPISIX æœ‰å¾ˆå¤§çš„çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚é‰´æƒè¿™é‡Œæ”¯æŒä¸°å¯Œçš„ç±»å‹ï¼Œè€Œä¸”æœ‰å¾ˆå¤šæ’ä»¶ã€‚\nå…·ä½“çš„åŒºåˆ«å’Œä¼˜åŠ¿ä½ å¯ä»¥æŸ¥çœ‹è¿™ç¯‡å®˜æ–¹å‘çš„æ–‡ç« ï¼šhttps://apisix.apache.org/zh/blog/2023/01/11/apisix-ingress-vs-ingress-nginx/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677130151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368788,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"åŒ—äº¬","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1676709460,"is_pvip":false,"replies":[{"id":134325,"content":"å¦‚æœæ˜¯äº‘å‚å•†çš„ Loadbalancer ï¼Œé«˜å¯ç”¨é«˜å¹¶å‘éƒ½åšå¥½äº†ï¼Œä½ éœ€è¦é€‰æ‹©é€‚åˆä¸šåŠ¡çš„å®ä¾‹å¤§å°å°±è¡Œã€‚å¦‚æœæ˜¯è‡ªå»ºçš„ï¼Œå¯èƒ½ä¼šå‡ºç°ä½ è¯´çš„å‹åŠ›å¤ªå¤§çš„æƒ…å†µï¼Œéœ€è¦è‡ªè¡Œç»´æŠ¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1676771132,"ip_address":"å¹¿ä¸œ","comment_id":368788,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"æœ‰ä¸€ç‚¹ä¸ç†è§£ï¼Œæ‰€æœ‰æµé‡éƒ½èµ°ä¸€ä¸ªEXTERNAL-IPï¼Œèƒ½æŠ—ä½å‹åŠ›å—","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":605586,"discussion_content":"å¦‚æœæ˜¯äº‘å‚å•†çš„ Loadbalancer ï¼Œé«˜å¯ç”¨é«˜å¹¶å‘éƒ½åšå¥½äº†ï¼Œä½ éœ€è¦é€‰æ‹©é€‚åˆä¸šåŠ¡çš„å®ä¾‹å¤§å°å°±è¡Œã€‚å¦‚æœæ˜¯è‡ªå»ºçš„ï¼Œå¯èƒ½ä¼šå‡ºç°ä½ è¯´çš„å‹åŠ›å¤ªå¤§çš„æƒ…å†µï¼Œéœ€è¦è‡ªè¡Œç»´æŠ¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676771132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":605621,"discussion_content":"è‡ªå»ºk8sçš„è¯ï¼Œæ¯”å¦‚è¯´èŠ‚ç‚¹è§„æ¨¡æ˜¯å‡ åƒå°æœåŠ¡å™¨ï¼Œæ˜¯ä¸æ˜¯é€‰æ‹©å…¶ä¸­å‡ åå°æœºå™¨é…ç½®å¤§æµé‡ç½‘å¡ï¼Œå°†ingressé€šè¿‡NodePortçš„æ–¹å¼éƒ¨ç½²åœ¨è¿™äº›æœºå™¨ä¸Šï¼Œç„¶åä¸Šå±‚å†æ¥å…¥lvsè´Ÿè½½å‡è¡¡é›†ç¾¤å°±å¯ä»¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676796271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":605586,"ip_address":"åŒ—äº¬","group_id":0},"score":605621,"extra":""}]}]},{"had_liked":false,"id":365373,"user_name":"PeiHongbing","can_delete":false,"product_type":"c1","uid":1635932,"ip_address":"å¹¿ä¸œ","ucode":"F115AD8740B0DC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSEVQdSoW2SwDic2U3uIibsa1bH3qSSzCvYTN5xHC5ppGDS2DBxL1KcbuxZ6Ez6kyOGj1F4toiaiazBA/132","comment_is_top":false,"comment_ctime":1672391628,"is_pvip":false,"replies":[{"id":133074,"content":"Kind æ¯”è¾ƒç‰¹æ®Šï¼Œä»–çš„èŠ‚ç‚¹æ˜¯ç”± Docker å®¹å™¨æ¨¡æ‹Ÿçš„ï¼Œä½ å¯ä»¥é€šè¿‡ docker ps æŸ¥çœ‹ï¼Œç„¶åè¿›å…¥å®¹å™¨é‡Œè¿›ä¸€æ­¥æ£€æŸ¥çœ‹çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1275456,"ctime":1672395569,"ip_address":"å¹¿ä¸œ","comment_id":365373,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"# kubectl -n ingress-nginx get svc\nNAME                                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx-controller             NodePort    10.96.133.249   &lt;none&gt;        80:32542&#47;TCP,443:32255&#47;TCP   4d2h\n\nä¸ºå•¥åœ¨èŠ‚ç‚¹æŸ¥çœ‹ç«¯å£32542å’Œ32255æœªè¢«ç›‘å¬ã€‚","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"ç‹ç‚œ","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597991,"discussion_content":"Kind æ¯”è¾ƒç‰¹æ®Šï¼Œä»–çš„èŠ‚ç‚¹æ˜¯ç”± Docker å®¹å™¨æ¨¡æ‹Ÿçš„ï¼Œä½ å¯ä»¥é€šè¿‡ docker ps æŸ¥çœ‹ï¼Œç„¶åè¿›å…¥å®¹å™¨é‡Œè¿›ä¸€æ­¥æ£€æŸ¥çœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672395569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367226,"user_name":"å°è·¯é£ğŸ˜","can_delete":false,"product_type":"c1","uid":1282445,"ip_address":"æ–°ç–†","ucode":"9EC780CF1D9687","user_header":"https://static001.geekbang.org/account/avatar/00/13/91/8d/0134973d.jpg","comment_is_top":false,"comment_ctime":1675052840,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘è¿™è¾¹çš„å®¹å™¨å¹³å° gateway é‡‡ç”¨traefik proxyç»„ä»¶\né€šè¿‡å®šä¹‰hosts ä¸ route è¿›é¡¹è®¾ç½®ï¼Œå®é™…ä¸Šå°±æ˜¯å°†ingressè¿›è¡Œæ‹†åˆ†æˆä¸¤ä¸ªkind\nå‰æœŸå·¥ä½œä¸­ï¼ŒæœåŠ¡éœ€è¦å¯¹å¤–è®¿é—®ï¼Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼šå†…ç½‘ ç½‘å…³å•ç‚¹éƒ¨ç½²ï¼Œç»‘å®šmaster å…¶ä¸­ä¸€ä¸ªipï¼Œç½‘å…³ç«¯å£ä¸º80ä¸443ï¼Œè¿›è¡Œæƒé™ç”³è¯·\nä»¥åŠç™½åå•æˆ–è€…ç½‘ç»œç­–ç•¥æ”¾é€šï¼Œmaster ip  (80&#47;443) --- &gt; å…¬ç½‘ip (80&#47;443) --- &gt; åŸŸå(80&#47;443)\nåç»­ç¯å¢ƒå‡ºç°æ•…éšœï¼Œå†…ç½‘ç»‘å®šmaster å•ç‚¹æ•…éšœé—®é¢˜ï¼Œåç»­å¯åŠ¨äº†ï¼ŒåŸå…ˆé›†ç¾¤çš„vip ipï¼Œvip ip ç»‘å®šäº† ä¸‰ä¸ª master ipï¼Œä¾‹å¦‚ 172.xxx.xxx.88ç»‘å®š172.xxx.xxx.83~85\né¦–å…ˆå‡çº§ç½‘å…³å¤šå‰¯æœ¬ï¼Œmaster å•ç‹¬æ ‡è®°ä¸€ä¸ªç½‘å…³æ ‡ç­¾ï¼Œæ¯ä¸ªgatewayéƒ½åœ¨masterèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªï¼Œè®¿é—®æµç¨‹ï¼švip ip (80&#47;443) --- &gt; å…¬ç½‘ip (80&#47;443) --- &gt; åŸŸå(80&#47;443)\nä½†æ˜¯è¿‘æœŸåœ¨é€‚é…çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å†…ç½‘ip å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä»¥åŠå®¿ä¸»æœºæ·»åŠ hosts å¡«å†™vip ipï¼Œç»‘å®šåŸŸåï¼Œè¿›è¡Œè®¿é—®ä¸šåŠ¡æµç¨‹å‡æ— é—®é¢˜ï¼Œä½†æ˜¯å…¬ç½‘è®¿é—®404 page not found\ntraefik ç½‘å…³ï¼Œåœ¨æ—¥å¸¸é…ç½®å…¬ç½‘æš´éœ²æœåŠ¡æ—¶ï¼Œç›´æ¥é€šè¿‡å®šä¹‰ä¸»æœºä»¥åŠè·¯ç”±ï¼Œå‡æ˜¯é€šè¿‡åŸŸåæ ¼å¼å»å®šä¹‰ï¼Œæœ¬åœ°ç¯å¢ƒé€šè¿‡hostsæ‰‹åŠ¨ç»‘å®šï¼ŒåŸŸåè®¿é—®ç­–ç•¥ç”Ÿæ•ˆã€‚æš‚æ—¶æœ‰ç‚¹æ€€ç–‘\næˆ‘çš„vip ip åç»­å‡çº§å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œè¿‘æœŸå‡†å¤‡åˆ‡æ¢è‡³ä»¥å‰å•ç‚¹æ¨¡å¼ï¼Œå•ä¸ªmaster ip --- &gt; å…¬ç½‘ --- &gt; åŸŸåã€‚ ","like_count":1},{"had_liked":false,"id":393356,"user_name":"jntv","can_delete":false,"product_type":"c1","uid":2133637,"ip_address":"ç¾å›½","ucode":"320EFA463E2F59","user_header":"","comment_is_top":false,"comment_ctime":1723600925,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"&quot;ä½ å¯ä»¥é€šè¿‡ kuebctl get ingress æ¥è·å– Manifestã€‚&quot; Manifestä¸­pathsä¸­çš„-backendæ˜¯ä¸æ˜¯åº”è¯¥æ›¿æ¢æˆ-path?","like_count":0},{"had_liked":false,"id":365372,"user_name":"PeiHongbing","can_delete":false,"product_type":"c1","uid":1635932,"ip_address":"è¾½å®","ucode":"F115AD8740B0DC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSEVQdSoW2SwDic2U3uIibsa1bH3qSSzCvYTN5xHC5ppGDS2DBxL1KcbuxZ6Ez6kyOGj1F4toiaiazBA/132","comment_is_top":false,"comment_ctime":1672391563,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"# kubectl -n ingress-nginx get svc\nNAME                                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx-controller             NodePort    10.96.133.249   &lt;none&gt;        80:32542&#47;TCP,443:32255&#47;TCP   4d2h","like_count":0}]}