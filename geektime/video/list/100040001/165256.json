{"id":165256,"title":"06 | MongoDB基本操作","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":158010,"user_name":"长期规划","can_delete":false,"product_type":"c3","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1575297626,"is_pvip":false,"replies":[{"id":60775,"content":"remove是mongo shell下的命令。deleteOne deleteMany是程序语言下的API。做的是类似的事情。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575468106,"ip_address":"","comment_id":158010,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，看3.6的官方文档，删除是用deleteOne, deleteMany，这跟remove有什么区分吗","like_count":10,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476605,"discussion_content":"remove是mongo shell下的命令。deleteOne deleteMany是程序语言下的API。做的是类似的事情。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575468106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207474,"user_name":"~尘曦~","can_delete":false,"product_type":"c3","uid":1175695,"ip_address":"","ucode":"BFA7E7DBD9047B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/8f/ca9fded0.jpg","comment_is_top":false,"comment_ctime":1587090923,"is_pvip":false,"replies":[{"id":77482,"content":"db.getCollection(&quot;customer&quot;) 就是 db.customer\n\ndb.getCollection(&quot;customer&#39;).find 就是 db.customer.find() ","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587095620,"ip_address":"","comment_id":207474,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"db.getCollection().find 什么意思啊？getCollection(表名)","like_count":7,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492143,"discussion_content":"db.getCollection(&amp;quot;customer&amp;quot;) 就是 db.customer\n\ndb.getCollection(&amp;quot;customer&amp;#39;).find 就是 db.customer.find() ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587095620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202623,"user_name":"苗","can_delete":false,"product_type":"c3","uid":1088710,"ip_address":"","ucode":"5ECCC6C855E541","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/c6/05a6798f.jpg","comment_is_top":false,"comment_ctime":1586016601,"is_pvip":false,"replies":[{"id":75821,"content":"filming_locations 必须是个数组类型。你这个不是数组。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586085886,"ip_address":"","comment_id":202623,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，我用了$elemMatch，但是查不到结果。\ndb.fruit.find()返回：\n{ &quot;_id&quot; : ObjectId(&quot;5e88ad16d0156d6e7035b343&quot;), &quot;name&quot; : &quot;orange&quot;, &quot;filming_locations&quot; : { &quot;city&quot; : &quot;Rome&quot;, &quot;country&quot; : &quot;Italy&quot; } }\n{ &quot;_id&quot; : ObjectId(&quot;5e88ad66d0156d6e7035b344&quot;), &quot;name&quot; : &quot;pie&quot;, &quot;filming_locations&quot; : { &quot;city&quot; : &quot;Newyork&quot;, &quot;country&quot; : &quot;Usa&quot; } }\n\n用了下面语句查不到结果：\ndb.fruit.find({&quot;filming_locations&quot;:{$elemMatch:{&quot;city&quot;:&quot;Rome&quot;,&quot;country&quot;:&quot;Italy&quot;}}});\n\n","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490634,"discussion_content":"filming_locations 必须是个数组类型。你这个不是数组。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586085886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167399,"user_name":"Geek_6297e5","can_delete":false,"product_type":"c3","uid":1797137,"ip_address":"","ucode":"4F68D87A77D976","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/HkCrjVzmP0czTN1x8Rb8YAh4kvbantib9mjxIj0ECkzThRJlricnUjC4iaVDQDupo3XiaiaU1ITo0oX0cOwEvapgACw/132","comment_is_top":false,"comment_ctime":1577783103,"is_pvip":false,"replies":[{"id":65221,"content":"$elemMatch表示一个数组元素同时满足两个条件\n分开写表示一个元素满足一个条件，另一个元素满足另一个条件也算数\n举例来说：\ndb.test.insert({array: [{a: 1, b: 1}, {a: 2, b: 2}]})\ndb.test.find({&quot;array.a&quot;: 1, &quot;array.b&quot;: 2}); &#47;&#47; 有结果，因为一个元素满足了a=1，另一个元素满足了b=2\ndb.test.find({array: {$elemMatch: {a: 1, b: 2}}}); &#47;&#47; 没有结果，因为没有一个元素同时满足a=1并且b=2","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577972968,"ip_address":"","comment_id":167399,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问，elematch和分开写有什么区别？","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479849,"discussion_content":"$elemMatch表示一个数组元素同时满足两个条件\n分开写表示一个元素满足一个条件，另一个元素满足另一个条件也算数\n举例来说：\ndb.test.insert({array: [{a: 1, b: 1}, {a: 2, b: 2}]})\ndb.test.find({&amp;quot;array.a&amp;quot;: 1, &amp;quot;array.b&amp;quot;: 2}); // 有结果，因为一个元素满足了a=1，另一个元素满足了b=2\ndb.test.find({array: {$elemMatch: {a: 1, b: 2}}}); // 没有结果，因为没有一个元素同时满足a=1并且b=2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577972968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2056201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","nickname":"SandCarving","note":"","ucode":"6B97DB71613A46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352446,"discussion_content":"elemMatch要满足对象的所有成员，而分开写只需要满足其中之一","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614741232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2354474,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/UNC7eWZWvRyAPWUpIJicgZBWLNpkljMbgeaFVWU3QNmWgaibchc8aGFfAG7gWh7eghHSrtSuSqMDp2ibVnvE2eLJg/132","nickname":"Geek_a88948","note":"","ucode":"C7FF3099A180D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334836,"discussion_content":"分开写是或，elemMatch是且","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608004531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207661,"user_name":"大鹏","can_delete":false,"product_type":"c3","uid":1948131,"ip_address":"","ucode":"74AE10B4F3CB19","user_header":"https://static001.geekbang.org/account/avatar/00/1d/b9/e3/12a3f04e.jpg","comment_is_top":false,"comment_ctime":1587132238,"is_pvip":false,"replies":[{"id":78492,"content":"可以尝试 minio ","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587880960,"ip_address":"","comment_id":207661,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，文件分布式的文件存储也会选用MongoDB么？除了MongoDB还有其他的解决方案吗？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492196,"discussion_content":"可以尝试 minio ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587880960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154643,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1574498554,"is_pvip":false,"replies":[{"id":65220,"content":"简单来说，wildcard index对于下面这样的结构：\n\n{\n &quot;_id&quot; : 1,\n &quot;data&quot; : {\n  &quot;a&quot; : 1728,\n  &quot;b&quot; : 6740,\n  &quot;c&quot; : 6481,\n  &quot;d&quot; : 2066,\n  &quot;e&quot; : 3173\n }\n}\n\n可以一条命令（一个索引）同时对a&#47;b&#47;c&#47;d&#47;e 5个字段做索引\n\ndb.wildcardIndex.createIndex({&quot;data.$**&quot;:1});\n\n甚至你将来在这个子文档里增加新的字段，也会自动索引。这样省去你单独创建很多个索引。\n\n但是。。。性能上有人测试过，这种比单独建每个索引还是要更加耗资源，差不多是两倍。 所以方便的代价是资源的更多消耗\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577972902,"ip_address":"","comment_id":154643,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师能详细介绍一下 MongoDB 4.2 的新特性通配符索引（Wildcard Indexes）吗？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475534,"discussion_content":"简单来说，wildcard index对于下面这样的结构：\n\n{\n &amp;quot;_id&amp;quot; : 1,\n &amp;quot;data&amp;quot; : {\n  &amp;quot;a&amp;quot; : 1728,\n  &amp;quot;b&amp;quot; : 6740,\n  &amp;quot;c&amp;quot; : 6481,\n  &amp;quot;d&amp;quot; : 2066,\n  &amp;quot;e&amp;quot; : 3173\n }\n}\n\n可以一条命令（一个索引）同时对a/b/c/d/e 5个字段做索引\n\ndb.wildcardIndex.createIndex({&amp;quot;data.$**&amp;quot;:1});\n\n甚至你将来在这个子文档里增加新的字段，也会自动索引。这样省去你单独创建很多个索引。\n\n但是。。。性能上有人测试过，这种比单独建每个索引还是要更加耗资源，差不多是两倍。 所以方便的代价是资源的更多消耗\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577972902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":116182,"discussion_content":"好的，谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578056331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153208,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1574181767,"is_pvip":false,"replies":[{"id":59398,"content":"数据格式转换是4.0才开始支持的功能，本质上所有的转换都可以用`$convert`完成，但是转换为不同的数据类型时又有不同的简化版本。例如`$toInt`，`$toBool`，`$toDate`等。以下以使用最`$toDate`为例举例说明使用方式：\n\n```javascript\n&#47;&#47; 测试数据\ndb.convertTest.insertMany([{\n    date: new Date().getTime()\n}, {\n    date: new Date().getTime() - 3600000\n}, {\n    date: new Date().getTime() - 7200000\n}]);\n```\n在`$project`中直接使用`$toDate`即可将epoch时间转换为日期类型：\n\n```javascript\ndb.convertTest.aggregate([{\n    $project: {\n        date: {\n            $toDate: &quot;$date&quot;\n        }\n    }\n}]);\n```\n\n参考：\n\n- `$convert`: https:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;operator&#47;aggregation&#47;convert&#47;\n- `$toInt`: https:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;operator&#47;aggregation&#47;toInt&#47;\n- `$toBool`: https:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;operator&#47;aggregation&#47;toBool&#47;\n- `$toDate`: https:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;operator&#47;aggregation&#47;toDate&#47;\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574521542,"ip_address":"","comment_id":153208,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"投影（projection）里面是不是可以对某个属性的表示形式做变换呢？比如将一个整数属性（保存的为1970年1月1日开始的毫秒数）转为日期格式表示？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475083,"discussion_content":"数据格式转换是4.0才开始支持的功能，本质上所有的转换都可以用`$convert`完成，但是转换为不同的数据类型时又有不同的简化版本。例如`$toInt`，`$toBool`，`$toDate`等。以下以使用最`$toDate`为例举例说明使用方式：\n\n```javascript\n// 测试数据\ndb.convertTest.insertMany([{\n    date: new Date().getTime()\n}, {\n    date: new Date().getTime() - 3600000\n}, {\n    date: new Date().getTime() - 7200000\n}]);\n```\n在`$project`中直接使用`$toDate`即可将epoch时间转换为日期类型：\n\n```javascript\ndb.convertTest.aggregate([{\n    $project: {\n        date: {\n            $toDate: &amp;quot;$date&amp;quot;\n        }\n    }\n}]);\n```\n\n参考：\n\n- `$convert`: https://docs.mongodb.com/manual/reference/operator/aggregation/convert/\n- `$toInt`: https://docs.mongodb.com/manual/reference/operator/aggregation/toInt/\n- `$toBool`: https://docs.mongodb.com/manual/reference/operator/aggregation/toBool/\n- `$toDate`: https://docs.mongodb.com/manual/reference/operator/aggregation/toDate/\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574521542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159196,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","nickname":"旺旺","note":"","ucode":"FE2CF90F446BFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":56925,"discussion_content":"感谢老师耐心解答，🙏","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574525465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153202,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1574180153,"is_pvip":false,"replies":[{"id":59034,"content":"这个表示查找一个JSON文档，这个文档有一个字段叫做 from， 并且 from字段的内容就是  {country: &quot;China&quot;} ，不多也不少。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574297259,"ip_address":"","comment_id":153202,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"db.fruit.find( { &quot;from&quot; : {country: &quot;China&quot;} } )，这个到底是在查什么呢？查一个json对象字段from的值是“{country: &quot;China&quot;}”吗？好像不是这样的。","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475081,"discussion_content":"这个表示查找一个JSON文档，这个文档有一个字段叫做 from， 并且 from字段的内容就是  {country: &amp;quot;China&amp;quot;} ，不多也不少。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574297259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159196,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","nickname":"旺旺","note":"","ucode":"FE2CF90F446BFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55349,"discussion_content":"作者回复: 这个表示查找一个JSON文档，这个文档有一个字段叫做 from， 并且 from字段的内容就是 {country: &#34;China&#34;} ，不多也不少。\n→\n我理解：这个查询表示查找JSON文档，这个文档有一个字段叫做 from， 而且from字段内容也是一个JSON文档，这个文档只有一个country属性，值为&#34;China&#34;。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574351057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1159196,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","nickname":"旺旺","note":"","ucode":"FE2CF90F446BFB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218223,"discussion_content":"是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585632404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55349,"ip_address":"","group_id":0},"score":218223,"extra":""}]}]},{"had_liked":false,"id":242630,"user_name":"逍遥子","can_delete":false,"product_type":"c3","uid":1518695,"ip_address":"","ucode":"CEA25CA20DC99D","user_header":"https://static001.geekbang.org/account/avatar/00/17/2c/67/04888812.jpg","comment_is_top":false,"comment_ctime":1597800593,"is_pvip":false,"replies":[{"id":89749,"content":"4.4 貌似支持了 Query Union，你看看是否可以满足你的需求。\n\n4.4 之前可以用lookup 但是条件是A&#47;B&#47;C之间有类似主外键的关联关系","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1598223529,"ip_address":"","comment_id":242630,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师你好，请问是否可以多个集合叠加起来一起查询，比如，集合A\\B\\C，有几个属性是一样的：a1、a2，我需要从这A&#47;B&#47;C 3个集合中查询出属性值为a1的所有文档，MongoDB是否支持这样的语法？多谢","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504055,"discussion_content":"4.4 貌似支持了 Query Union，你看看是否可以满足你的需求。\n\n4.4 之前可以用lookup 但是条件是A/B/C之间有类似主外键的关联关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598223529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206875,"user_name":"jeephy","can_delete":false,"product_type":"c3","uid":1953749,"ip_address":"","ucode":"59FBE4AB5A4989","user_header":"https://static001.geekbang.org/account/avatar/00/1d/cf/d5/74c89500.jpg","comment_is_top":false,"comment_ctime":1586948424,"is_pvip":false,"replies":[{"id":77500,"content":"这个阈值应该是在80%（64MB * 80%）的时候，就会把块一分为二。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587100607,"ip_address":"","comment_id":206875,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师好，请问分片集群的chunk分裂阈值有哪些？shard key与chunk的分裂阈值是什么关系？如何避免按shard key做chunk分裂时出现超出chunkSize的chunk块？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491930,"discussion_content":"这个阈值应该是在80%（64MB * 80%）的时候，就会把块一分为二。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587100607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1953749,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/cf/d5/74c89500.jpg","nickname":"jeephy","note":"","ucode":"59FBE4AB5A4989","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237902,"discussion_content":"谢谢老师！那是不是说，chunk的分裂只跟chunkSize相关，约80%时就会分裂？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587196037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187581,"user_name":"DZZ","can_delete":false,"product_type":"c3","uid":1516167,"ip_address":"","ucode":"C8E4C4B089BCE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","comment_is_top":false,"comment_ctime":1584163646,"is_pvip":false,"replies":[{"id":73188,"content":"机构和月份是否有做复合索引？\n\n能否给更多的内存保证索引+用到的数据都在内存中？\n\n使用readPreference 分散到多个节点去做\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584625318,"ip_address":"","comment_id":187581,"utype":1}],"discussion_count":4,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"TJ老师，有个问题想咨询您，就是我目前遇到这样一个场景：从mongo库里的一个大集合（100多个G，6000万文档，每个文档有100多个字段）中通过聚合筛选出符合筛选条件（条件里有两个字段有索引，是机构和月份，不过索引可能不太好，重复值多 ）的临时集合（几万-几十万），一般需要5分钟以上才能执行完。这种聚合操作有时候会在同一时间段执行二三十个，导致mongo库的CPU和内存会瞬间达到100%，并且会持续到这些查询执行完 才会释放资源。是否能有什么优化方法，降低CPU的消耗和提高查询速度？给其他字段加索引可能不行，因为每个查询的字段除了机构和月份外都可能不同。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487154,"discussion_content":"机构和月份是否有做复合索引？\n\n能否给更多的内存保证索引+用到的数据都在内存中？\n\n使用readPreference 分散到多个节点去做\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584625318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1516167,"avatar":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","nickname":"DZZ","note":"","ucode":"C8E4C4B089BCE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209323,"discussion_content":"第一个没有复合索引，都是单独的索引\n第二个内存100g,整个集合的数据有130g，已无法再扩展内存\n第三个不了解，我去学习看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584627428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1516167,"avatar":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","nickname":"DZZ","note":"","ucode":"C8E4C4B089BCE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204370,"discussion_content":"希望老师能提供一些建议，由衷感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584164066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1516167,"avatar":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","nickname":"DZZ","note":"","ucode":"C8E4C4B089BCE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204369,"discussion_content":"内存100g左右，一般热数据会有80g，执行此聚合时也会持续使用到100g,聚会完了会回到80","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584164023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164439,"user_name":"firek","can_delete":false,"product_type":"c3","uid":1273501,"ip_address":"","ucode":"FFFDBFB34688EF","user_header":"https://static001.geekbang.org/account/avatar/00/13/6e/9d/29feea6f.jpg","comment_is_top":false,"comment_ctime":1576990430,"is_pvip":false,"replies":[{"id":62947,"content":"mongodb有类似的oplog。但是那个要求你对全量的oplog都要保存，才能够从oplog里完全恢复被误删的表。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577182397,"ip_address":"","comment_id":164439,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，mongodb删除了数据、表、数据库是没法恢复的么，有没有类似mysql有个日志记录的机制去回滚的？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478767,"discussion_content":"mongodb有类似的oplog。但是那个要求你对全量的oplog都要保存，才能够从oplog里完全恢复被误删的表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577182397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159608,"user_name":"于先生","can_delete":false,"product_type":"c3","uid":1220475,"ip_address":"","ucode":"ED740977652D72","user_header":"https://static001.geekbang.org/account/avatar/00/12/9f/7b/e1e8ebff.jpg","comment_is_top":false,"comment_ctime":1575703544,"is_pvip":false,"replies":[{"id":66764,"content":"在使用MMAP引擎的时候删除集合不会回收存储空间。在WiredTiger引擎是直接回收存储空间的。 你可以在shell下面再尝试下这个操作看看是否robo 3t相关。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579130783,"ip_address":"","comment_id":159608,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐老师您好，我在使用Robo 3T这个工具的过程中，对集合右键执行了  Drup Collection，执行之后，show collections 已经看不到那个集合，但是此前占用的存储空间没有变化。 请问下这个集合是否还存在？ 如果存在是否可以恢复？  如果不存在，如何释放存储空间？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477118,"discussion_content":"在使用MMAP引擎的时候删除集合不会回收存储空间。在WiredTiger引擎是直接回收存储空间的。 你可以在shell下面再尝试下这个操作看看是否robo 3t相关。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579130783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157633,"user_name":"★遠飛★","can_delete":false,"product_type":"c3","uid":1402144,"ip_address":"","ucode":"847C9B7D735EAC","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/20/11cf22de.jpg","comment_is_top":false,"comment_ctime":1575216657,"is_pvip":false,"replies":[{"id":60810,"content":"关于1）比较难以判断实际情况。\n2）\n\n首先要把mongodb安装成service，参考Redhat的安装：\n\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;tutorial&#47;install-mongodb-on-red-hat&#47;\n\n然后用chkconfig命令启用开机自启动，这里有教程：\n\nhttps:&#47;&#47;blog.csdn.net&#47;u013554213&#47;article&#47;details&#47;78792686\n\n分布式环境下也是一样。如果你是说希望有那种中央化的管控，那你可以使用OpsManager，可以通过GUI对全部节点进行起停控制，并且是会在服务器宕机时候自动重启服务。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575502117,"ip_address":"","comment_id":157633,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"最近遇到一个怪事，请教一下老师。最近我在六台主机上部署了一备二，三个分片的mongo分布式，开启了认证机制！在内网中完成了部署并能正常使用，但是当把内网网线拔掉，接上生产网络后，访问mongo却出现了认证失败错误！？为什么？全部重新启动mongo可恢复。另外分布式环境中，mongo如何做开机自启？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476487,"discussion_content":"关于1）比较难以判断实际情况。\n2）\n\n首先要把mongodb安装成service，参考Redhat的安装：\n\nhttps://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/\n\n然后用chkconfig命令启用开机自启动，这里有教程：\n\nhttps://blog.csdn.net/u013554213/article/details/78792686\n\n分布式环境下也是一样。如果你是说希望有那种中央化的管控，那你可以使用OpsManager，可以通过GUI对全部节点进行起停控制，并且是会在服务器宕机时候自动重启服务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575502117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153834,"user_name":"月迷津渡","can_delete":false,"product_type":"c3","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1574315192,"is_pvip":false,"replies":[{"id":67863,"content":"没错，lt&#47;gt用到索引的话就是在B树的叶子层进行遍历","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580281620,"ip_address":"","comment_id":153834,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师有个疑问说是MongoDB用的是B树来构建索引，那就像问下类似lt gt这种操作是基于B树的类似前中后序遍历来做范围查询么。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475292,"discussion_content":"没错，lt/gt用到索引的话就是在B树的叶子层进行遍历","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580281620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152667,"user_name":"肖大保健","can_delete":false,"product_type":"c3","uid":1306868,"ip_address":"","ucode":"E3209A00C1B954","user_header":"https://static001.geekbang.org/account/avatar/00/13/f0/f4/22dbe2d9.jpg","comment_is_top":false,"comment_ctime":1574060006,"is_pvip":false,"replies":[{"id":58797,"content":"你是不是要这个：\n\ndb.orders.find({\n &quot;orderLines&quot;: {\n  $elemMatch: {\n   &quot;sku&quot;: &quot;1400&quot;,\n   &quot;qty&quot;: 62\n  }\n }\n}, {\n &quot;_id&quot;: 0,\n &quot;orderLines.$&quot;: 1\n})\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574141440,"ip_address":"","comment_id":152667,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"&gt; db.orders.find({&quot;orderLines&quot;:{$elemMatch:{&quot;sku&quot;:&quot;1400&quot;,&quot;qty&quot;:62}}},{&quot;_id&quot;:0,&quot;orderLines.sku&quot;:1,&quot;orderLines.qty&quot;:1})\n{ &quot;orderLines&quot; : [ { &quot;sku&quot; : &quot;9569&quot;, &quot;qty&quot; : 75 }, { &quot;sku&quot; : &quot;1400&quot;, &quot;qty&quot; : 62 }, { &quot;sku&quot; : &quot;6156&quot;, &quot;qty&quot; : 43 }, { &quot;sku&quot; : &quot;5983&quot;, &quot;qty&quot; : 36 }, { &quot;sku&quot; : &quot;9183&quot;, &quot;qty&quot; : 34 }, { &quot;sku&quot; : &quot;1145&quot;, &quot;qty&quot; : 93 }, { &quot;sku&quot; : &quot;2056&quot;, &quot;qty&quot; : 19 }, { &quot;sku&quot; : &quot;8706&quot;, &quot;qty&quot; : 1 }, { &quot;sku&quot; : &quot;6951&quot;, &quot;qty&quot; : 10 }, { &quot;sku&quot; : &quot;5129&quot;, &quot;qty&quot; : 58 }, { &quot;sku&quot; : &quot;2069&quot;, &quot;qty&quot; : 96 } ] }\n&gt; \n&gt; \n是我语法有问题吗,用orders库,后面带了条件以后查询到的结果不匹配呢","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474891,"discussion_content":"你是不是要这个：\n\ndb.orders.find({\n &amp;quot;orderLines&amp;quot;: {\n  $elemMatch: {\n   &amp;quot;sku&amp;quot;: &amp;quot;1400&amp;quot;,\n   &amp;quot;qty&amp;quot;: 62\n  }\n }\n}, {\n &amp;quot;_id&amp;quot;: 0,\n &amp;quot;orderLines.$&amp;quot;: 1\n})\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574141440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152176,"user_name":"jeffery","can_delete":false,"product_type":"c3","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1573898771,"is_pvip":false,"replies":[{"id":58804,"content":"请把问题描述清楚。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574143270,"ip_address":"","comment_id":152176,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"mongo后天怎么启动","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474738,"discussion_content":"请把问题描述清楚。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574143270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1219438,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","nickname":"蓝魔丶","note":"","ucode":"2AE4359E263558","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53247,"discussion_content":"fork=true","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574150161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160499,"user_name":"Geek_862694","can_delete":false,"product_type":"c3","uid":1366022,"ip_address":"","ucode":"977B4195C7CFB1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLBP7piae8iaHU7w2a4TyLKPFI7xiaia3Hias2ibMPftnFEic0lqGU315U70peQs7X3Kyd3bDgJjF6nBQg7xA/132","comment_is_top":false,"comment_ctime":1575965463,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"这一节跟着唐老师学会了删库跑路.删库是掌握了,跑路还不是很熟悉具体流程,懂流程的可以指点一下","like_count":41,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218211,"discussion_content":"具体流程就是跑到哪里都会被捉，然后罚完再判。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585630816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151069,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1573650422,"is_pvip":false,"replies":null,"discussion_count":8,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"这个MongoDB删除collection的时候，占用的存储空间也是立即就释放了的吗？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49928,"discussion_content":"是的空间会释放","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573650811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1743661,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/9b/2d/f7fca208.jpg","nickname":"fedwing","note":"","ucode":"2DFF902FD190C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":50010,"discussion_content":"但是其实分配的空间并不回收吧？比如看mongo的磁盘空间并不变，只是后续新建collection会复用这部分空间，对吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573656349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":49928,"ip_address":"","group_id":0},"score":50010,"extra":""},{"author":{"id":1645665,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/61/0ca1ca43.jpg","nickname":"蒋腾飞同学","note":"","ucode":"AF72D93DDAC536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1743661,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/9b/2d/f7fca208.jpg","nickname":"fedwing","note":"","ucode":"2DFF902FD190C7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50119,"discussion_content":"应该不会复用吧，与内存块的逻辑不同～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573661942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50010,"ip_address":"","group_id":0},"score":50119,"extra":""},{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1743661,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/9b/2d/f7fca208.jpg","nickname":"fedwing","note":"","ucode":"2DFF902FD190C7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50279,"discussion_content":"2.x时候是这种行为，删除后还是被占用。3.x以后删除表以后空间会还给操作系统。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573698823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50010,"ip_address":"","group_id":0},"score":50279,"extra":""}]}]},{"had_liked":false,"id":180819,"user_name":"徐云天","can_delete":false,"product_type":"c3","uid":1212091,"ip_address":"","ucode":"D48DBF0B3C2CA3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/bb/019c18fc.jpg","comment_is_top":false,"comment_ctime":1582421978,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"这个remove操作也太危险了吧，写程序不小心忘了条件，，，，，","like_count":1,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218214,"discussion_content":"现在生产中进行remove的场景比较少，一般都是软删除。如果实在有这种需求，那就要充分测试后再搞了。做好备份。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585631202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379800,"user_name":"无昂","can_delete":false,"product_type":"c3","uid":1942414,"ip_address":"北京","ucode":"32E88B3D5B8DC0","user_header":"https://static001.geekbang.org/account/avatar/00/1d/a3/8e/518835da.jpg","comment_is_top":false,"comment_ctime":1692536316,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"直接能搜索数组结构很吸引人，这周搜索的性能怎么样呢？ 时间复杂度是多少","like_count":0},{"had_liked":false,"id":365841,"user_name":"非洲黑猴子","can_delete":false,"product_type":"c3","uid":2639724,"ip_address":"美国","ucode":"F5FEAC07D562E0","user_header":"https://static001.geekbang.org/account/avatar/00/28/47/6c/78184d19.jpg","comment_is_top":false,"comment_ctime":1673117594,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":4,"product_id":100040001,"comment_content":"7:27 第二条fruit查询必须写成db.fruit.find({&quot;from&quot;: {country: &#39;China&#39;, province: &#39;Guangdong&#39;}})才能查出来结果","like_count":0},{"had_liked":false,"id":365840,"user_name":"非洲黑猴子","can_delete":false,"product_type":"c3","uid":2639724,"ip_address":"美国","ucode":"F5FEAC07D562E0","user_header":"https://static001.geekbang.org/account/avatar/00/28/47/6c/78184d19.jpg","comment_is_top":false,"comment_ctime":1673117370,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":4,"product_id":100040001,"comment_content":"小坑：06:57 这里第二个查询语句中的“from”，必须加引号，否则会报语法错误","like_count":0},{"had_liked":false,"id":333277,"user_name":"rOMEo罗密欧","can_delete":false,"product_type":"c3","uid":1074365,"ip_address":"","ucode":"9C7BF6E1274D26","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/bd/cbcdc4a6.jpg","comment_is_top":false,"comment_ctime":1644243069,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"请问一下在mongo中有没有SQL类似字符通配符(LIKE)的查询语法？例如在SQL可以select * from table where name like &quot;sys*&quot;","like_count":0,"discussions":[{"author":{"id":1806542,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/90/ce/10df47f9.jpg","nickname":"安","note":"","ucode":"8B845F931CC8E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613525,"discussion_content":"只能用正则实现喽","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681374650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"天津","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320184,"user_name":"Jesson","can_delete":false,"product_type":"c3","uid":1212313,"ip_address":"","ucode":"EBADA87D9E5AE6","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/99/6a92ff95.jpg","comment_is_top":false,"comment_ctime":1636110655,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师，一个db 最多能建多少个集合啊？，wiredtiger 引擎的情况下。","like_count":0},{"had_liked":false,"id":267969,"user_name":"Geek_a88948","can_delete":false,"product_type":"c3","uid":2354474,"ip_address":"","ucode":"C7FF3099A180D6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/UNC7eWZWvRyAPWUpIJicgZBWLNpkljMbgeaFVWU3QNmWgaibchc8aGFfAG7gWh7eghHSrtSuSqMDp2ibVnvE2eLJg/132","comment_is_top":false,"comment_ctime":1608012924,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"TJ您好，find时查询条件只涉及一个字段时，是否可以使用in替换or呢？\n例如：\ndb.updates.find({$or:[{ios:&quot;1.0.10&quot;},{ios:&quot;1.0.12&quot;}]});  \ndb.updates.find({ios:{$in:[&quot;1.0.10&quot;,&quot;1.0.12&quot;]}});","like_count":0},{"had_liked":false,"id":232788,"user_name":"乌云下的风","can_delete":false,"product_type":"c3","uid":1541522,"ip_address":"","ucode":"5FF34726A9519D","user_header":"https://static001.geekbang.org/account/avatar/00/17/85/92/9f7c43ef.jpg","comment_is_top":false,"comment_ctime":1594117322,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"飘过飘过","like_count":0},{"had_liked":false,"id":223076,"user_name":"GLADIATOR","can_delete":false,"product_type":"c3","uid":1448564,"ip_address":"","ucode":"6FE14E0BCD6240","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/74/8f7f8786.jpg","comment_is_top":false,"comment_ctime":1590995833,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"\n老师您好，我把dump.tar.gz解压之后，进行导入报如下错误\n[root@orcl2 dump]# mongorestore -h localhost:27017 \n2020-06-01T15:14:23.763+0800\tusing default &#39;dump&#39; directory\n2020-06-01T15:14:23.767+0800\ttry &#39;mongorestore --help&#39; for more information\n2020-06-01T15:14:23.772+0800\tFailed: mongorestore target &#39;dump&#39; invalid: stat dump: no such file or directory\n2020-06-01T15:14:23.774+0800\t0 document(s) restored successfully. 0 document(s) failed to restore.\n[root@orcl2 dump]# \n","like_count":0,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"奕","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291164,"discussion_content":"进到 dump 目录下， 执行 mongorestore --dir .","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594721447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162372,"user_name":"Keep","can_delete":false,"product_type":"c3","uid":1178075,"ip_address":"","ucode":"ADFD481F03AB84","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/db/51457469.jpg","comment_is_top":false,"comment_ctime":1576505516,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师请问一下：mongodb在查询的时候什么情况下会使用到索引？整体查询性能怎么样？","like_count":0},{"had_liked":false,"id":160585,"user_name":"丁丁历险记","can_delete":false,"product_type":"c3","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1575980207,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"终于学会了跑路大法。","like_count":0},{"had_liked":false,"id":154036,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1574351434,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100040001,"comment_content":"对于传统SQL语句中类似update user set a=b 这种语句，在v4.2.1支持如下的写法：db.members.updateMany({},[{$set: {misc1: &quot;$misc2&quot;}}])来将一个属性中的值设到另一个属性中，在v4.0版本中则不支持。","like_count":0}]}