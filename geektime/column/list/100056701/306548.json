{"id":306548,"title":"35 | Codis VS Redis Clusterï¼šæˆ‘è¯¥é€‰æ‹©å“ªä¸€ä¸ªé›†ç¾¤æ–¹æ¡ˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å¾·é’§ã€‚</p><p>Redisçš„åˆ‡ç‰‡é›†ç¾¤ä½¿ç”¨å¤šä¸ªå®ä¾‹ä¿å­˜æ•°æ®ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚åœ¨<a href=\"https://time.geekbang.org/column/article/275337\">ç¬¬8è®²</a>ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Rediså®˜æ–¹æä¾›çš„åˆ‡ç‰‡é›†ç¾¤æ–¹æ¡ˆRedis Clusterï¼Œè¿™ä¸ºä½ æŒæ¡åˆ‡ç‰‡é›†ç¾¤æ‰“ä¸‹äº†åŸºç¡€ã€‚ä»Šå¤©ï¼Œæˆ‘å†æ¥å¸¦ä½ è¿›é˜¶ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸‹Redis Clusteræ–¹æ¡ˆæ­£å¼å‘å¸ƒå‰ï¼Œä¸šç•Œå·²ç»å¹¿æ³›ä½¿ç”¨çš„Codisã€‚</p><p>æˆ‘ä¼šå…·ä½“è®²è§£Codisçš„å…³é”®æŠ€æœ¯å®ç°åŸç†ï¼ŒåŒæ—¶å°†Codiså’ŒRedis Clusterè¿›è¡Œå¯¹æ¯”ï¼Œå¸®ä½ é€‰å‡ºæœ€ä½³çš„é›†ç¾¤æ–¹æ¡ˆã€‚</p><p>å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹Codisçš„æ•´ä½“æ¶æ„å’Œæµç¨‹ã€‚</p><h2>Codisçš„æ•´ä½“æ¶æ„å’ŒåŸºæœ¬æµç¨‹</h2><p>Codisé›†ç¾¤ä¸­åŒ…å«äº†4ç±»å…³é”®ç»„ä»¶ã€‚</p><ul>\n<li>codis serverï¼šè¿™æ˜¯è¿›è¡Œäº†äºŒæ¬¡å¼€å‘çš„Rediså®ä¾‹ï¼Œå…¶ä¸­å¢åŠ äº†é¢å¤–çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒæ•°æ®è¿ç§»æ“ä½œï¼Œä¸»è¦è´Ÿè´£å¤„ç†å…·ä½“çš„æ•°æ®è¯»å†™è¯·æ±‚ã€‚</li>\n<li>codis proxyï¼šæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚è½¬å‘ç»™codis serverã€‚</li>\n<li>Zookeeperé›†ç¾¤ï¼šä¿å­˜é›†ç¾¤å…ƒæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®ä½ç½®ä¿¡æ¯å’Œcodis proxyä¿¡æ¯ã€‚</li>\n<li>codis dashboardå’Œcodis feï¼šå…±åŒç»„æˆäº†é›†ç¾¤ç®¡ç†å·¥å…·ã€‚å…¶ä¸­ï¼Œcodis dashboardè´Ÿè´£æ‰§è¡Œé›†ç¾¤ç®¡ç†å·¥ä½œï¼ŒåŒ…æ‹¬å¢åˆ codis serverã€codis proxyå’Œè¿›è¡Œæ•°æ®è¿ç§»ã€‚è€Œcodis feè´Ÿè´£æä¾›dashboardçš„Webæ“ä½œç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬ç›´æ¥åœ¨Webç•Œé¢ä¸Šè¿›è¡Œé›†ç¾¤ç®¡ç†ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>æˆ‘ç”¨ä¸€å¼ å›¾æ¥å±•ç¤ºä¸‹Codisé›†ç¾¤çš„æ¶æ„å’Œå…³é”®ç»„ä»¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/a5/c726e3c5477558fa1dba13c6ae8a77a5.jpg?wh=2913*1835\" alt=\"\"></p><p>æˆ‘æ¥ç»™ä½ å…·ä½“è§£é‡Šä¸€ä¸‹Codisæ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†è®©é›†ç¾¤èƒ½æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ï¼Œæˆ‘ä»¬è¦å…ˆä½¿ç”¨codis dashboard è®¾ç½®codis serverå’Œcodis proxyçš„è®¿é—®åœ°å€ï¼Œå®Œæˆè®¾ç½®åï¼Œcodis serverå’Œcodis proxyæ‰ä¼šå¼€å§‹æ¥æ”¶è¿æ¥ã€‚</p><p>ç„¶åï¼Œå½“å®¢æˆ·ç«¯è¦è¯»å†™æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ç›´æ¥å’Œcodis proxyå»ºç«‹è¿æ¥ã€‚ä½ å¯èƒ½ä¼šæ‹…å¿ƒï¼Œæ—¢ç„¶å®¢æˆ·ç«¯è¿æ¥çš„æ˜¯proxyï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œæ‰èƒ½è®¿é—®proxyï¼Ÿå…¶å®ï¼Œä½ ä¸ç”¨æ‹…å¿ƒï¼Œcodis proxyæœ¬èº«æ”¯æŒRedisçš„RESPäº¤äº’åè®®ï¼Œæ‰€ä»¥ï¼Œå®¢æˆ·ç«¯è®¿é—®codis  proxyæ—¶ï¼Œå’Œè®¿é—®åŸç”Ÿçš„Rediså®ä¾‹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒåŸæœ¬è¿æ¥å•å®ä¾‹çš„å®¢æˆ·ç«¯å°±å¯ä»¥è½»æ¾åœ°å’ŒCodisé›†ç¾¤å»ºç«‹èµ·è¿æ¥äº†ã€‚</p><p>æœ€åï¼Œcodis proxyæ¥æ”¶åˆ°è¯·æ±‚ï¼Œå°±ä¼šæŸ¥è¯¢è¯·æ±‚æ•°æ®å’Œcodis serverçš„æ˜ å°„å…³ç³»ï¼Œå¹¶æŠŠè¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„codis serverè¿›è¡Œå¤„ç†ã€‚å½“codis serverå¤„ç†å®Œè¯·æ±‚åï¼Œä¼šæŠŠç»“æœè¿”å›ç»™codis proxyï¼Œproxyå†æŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>æˆ‘æ¥ç”¨ä¸€å¼ å›¾å±•ç¤ºè¿™ä¸ªå¤„ç†æµç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/e5/f76df33a4eba1ebddfd5450745yy83e5.jpg?wh=2620*1817\" alt=\"\"></p><p>å¥½äº†ï¼Œäº†è§£äº†Codisé›†ç¾¤æ¶æ„å’ŒåŸºæœ¬æµç¨‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°±å›´ç»•å½±å“åˆ‡ç‰‡é›†ç¾¤ä½¿ç”¨æ•ˆæœçš„4æ–¹é¢æŠ€æœ¯å› ç´ ï¼šæ•°æ®åˆ†å¸ƒã€é›†ç¾¤æ‰©å®¹å’Œæ•°æ®è¿ç§»ã€å®¢æˆ·ç«¯å…¼å®¹æ€§ã€å¯é æ€§ä¿è¯ï¼Œæ¥å’Œä½ èŠèŠå®ƒä»¬çš„å…·ä½“è®¾è®¡é€‰æ‹©å’ŒåŸç†ï¼Œå¸®ä½ æŒæ¡Codisçš„å…·ä½“ç”¨æ³•ã€‚</p><h2>Codisçš„å…³é”®æŠ€æœ¯åŸç†</h2><p>ä¸€æ—¦æˆ‘ä»¬ä½¿ç”¨äº†åˆ‡ç‰‡é›†ç¾¤ï¼Œé¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œ<strong>æ•°æ®æ˜¯æ€ä¹ˆåœ¨å¤šä¸ªå®ä¾‹ä¸Šåˆ†å¸ƒçš„</strong>ã€‚</p><h3>æ•°æ®å¦‚ä½•åœ¨é›†ç¾¤é‡Œåˆ†å¸ƒï¼Ÿ</h3><p>åœ¨Codisé›†ç¾¤ä¸­ï¼Œä¸€ä¸ªæ•°æ®åº”è¯¥ä¿å­˜åœ¨å“ªä¸ªcodis serverä¸Šï¼Œè¿™æ˜¯é€šè¿‡é€»è¾‘æ§½ï¼ˆSlotï¼‰æ˜ å°„æ¥å®Œæˆçš„ï¼Œå…·ä½“æ¥è¯´ï¼Œæ€»å…±åˆ†æˆä¸¤æ­¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼ŒCodisé›†ç¾¤ä¸€å…±æœ‰1024ä¸ªSlotï¼Œç¼–å·ä¾æ¬¡æ˜¯0åˆ°1023ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›Slotæ‰‹åŠ¨åˆ†é…ç»™codis serverï¼Œæ¯ä¸ªserverä¸ŠåŒ…å«ä¸€éƒ¨åˆ†Slotã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©codis dashboardè¿›è¡Œè‡ªåŠ¨åˆ†é…ï¼Œä¾‹å¦‚ï¼ŒdashboardæŠŠ1024ä¸ªSlotåœ¨æ‰€æœ‰serverä¸Šå‡åˆ†ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå½“å®¢æˆ·ç«¯è¦è¯»å†™æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨CRC32ç®—æ³•è®¡ç®—æ•°æ®keyçš„å“ˆå¸Œå€¼ï¼Œå¹¶æŠŠè¿™ä¸ªå“ˆå¸Œå€¼å¯¹1024å–æ¨¡ã€‚è€Œå–æ¨¡åçš„å€¼ï¼Œåˆ™å¯¹åº”Slotçš„ç¼–å·ã€‚æ­¤æ—¶ï¼Œæ ¹æ®ç¬¬ä¸€æ­¥åˆ†é…çš„Slotå’Œserverå¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ•°æ®ä¿å­˜åœ¨å“ªä¸ªserverä¸Šäº†ã€‚</p><p>æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚ä¸‹å›¾æ˜¾ç¤ºçš„å°±æ˜¯æ•°æ®ã€Slotå’Œcodis serverçš„æ˜ å°„ä¿å­˜å…³ç³»ã€‚å…¶ä¸­ï¼ŒSlot 0å’Œ1è¢«åˆ†é…åˆ°äº†server1ï¼ŒSlot 2åˆ†é…åˆ°server2ï¼ŒSlot 1022å’Œ1023è¢«åˆ†é…åˆ°server8ã€‚å½“å®¢æˆ·ç«¯è®¿é—®key 1å’Œkey 2æ—¶ï¼Œè¿™ä¸¤ä¸ªæ•°æ®çš„CRC32å€¼å¯¹1024å–æ¨¡åï¼Œåˆ†åˆ«æ˜¯1å’Œ1022ã€‚å› æ­¤ï¼Œå®ƒä»¬ä¼šè¢«ä¿å­˜åœ¨Slot  1å’ŒSlot  1022ä¸Šï¼Œè€ŒSlot  1å’ŒSlot  1022å·²ç»è¢«åˆ†é…åˆ°codis server 1å’Œ8ä¸Šäº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œkey 1å’Œkey 2çš„ä¿å­˜ä½ç½®å°±å¾ˆæ¸…æ¥šäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/77/yy/77cb1b860cfa5aac9f0a0f7b780fbeyy.jpg?wh=2621*1259\" alt=\"\"></p><p>æ•°æ®keyå’ŒSlotçš„æ˜ å°„å…³ç³»æ˜¯å®¢æˆ·ç«¯åœ¨è¯»å†™æ•°æ®å‰ç›´æ¥é€šè¿‡CRC32è®¡ç®—å¾—åˆ°çš„ï¼Œè€ŒSlotå’Œcodis serverçš„æ˜ å°„å…³ç³»æ˜¯é€šè¿‡åˆ†é…å®Œæˆçš„ï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨ä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿä¿å­˜ä¸‹æ¥ï¼Œå¦åˆ™ï¼Œå¦‚æœé›†ç¾¤æœ‰æ•…éšœäº†ï¼Œæ˜ å°„å…³ç³»å°±ä¼šä¸¢å¤±ã€‚</p><p>æˆ‘ä»¬æŠŠSlotå’Œcodis serverçš„æ˜ å°„å…³ç³»ç§°ä¸ºæ•°æ®è·¯ç”±è¡¨ï¼ˆç®€ç§°è·¯ç”±è¡¨ï¼‰ã€‚æˆ‘ä»¬åœ¨codis dashboardä¸Šåˆ†é…å¥½è·¯ç”±è¡¨åï¼Œdashboardä¼šæŠŠè·¯ç”±è¡¨å‘é€ç»™codis proxyï¼ŒåŒæ—¶ï¼Œdashboardä¹Ÿä¼šæŠŠè·¯ç”±è¡¨ä¿å­˜åœ¨Zookeeperä¸­ã€‚codis-proxyä¼šæŠŠè·¯ç”±è¡¨ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“å®ƒæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œç›´æ¥æŸ¥è¯¢æœ¬åœ°çš„è·¯ç”±è¡¨ï¼Œå°±å¯ä»¥å®Œæˆæ­£ç¡®çš„è¯·æ±‚è½¬å‘äº†ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸‹è¿™å¼ å›¾ï¼Œå®ƒæ˜¾ç¤ºäº†è·¯ç”±è¡¨çš„åˆ†é…å’Œä½¿ç”¨è¿‡ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d1/b1/d1a53f8b23d410f320ef145fd47c97b1.jpg?wh=2861*1864\" alt=\"\"></p><p>åœ¨æ•°æ®åˆ†å¸ƒçš„å®ç°æ–¹æ³•ä¸Šï¼ŒCodiså’ŒRedis Clusterå¾ˆç›¸ä¼¼ï¼Œéƒ½é‡‡ç”¨äº†keyæ˜ å°„åˆ°Slotã€Slotå†åˆ†é…åˆ°å®ä¾‹ä¸Šçš„æœºåˆ¶ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>Codisä¸­çš„è·¯ç”±è¡¨æ˜¯æˆ‘ä»¬é€šè¿‡codis dashboardåˆ†é…å’Œä¿®æ”¹çš„ï¼Œå¹¶è¢«ä¿å­˜åœ¨Zookeeperé›†ç¾¤ä¸­ã€‚ä¸€æ—¦æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–ï¼ˆä¾‹å¦‚æœ‰å®ä¾‹å¢å‡ï¼‰ï¼Œè·¯ç”±è¡¨è¢«ä¿®æ”¹äº†ï¼Œcodis dashbaordå°±ä¼šæŠŠä¿®æ”¹åçš„è·¯ç”±è¡¨å‘é€ç»™codis proxyï¼Œproxyå°±å¯ä»¥æ ¹æ®æœ€æ–°çš„è·¯ç”±ä¿¡æ¯è½¬å‘è¯·æ±‚äº†ã€‚</p><p>åœ¨Redis Clusterä¸­ï¼Œæ•°æ®è·¯ç”±è¡¨æ˜¯é€šè¿‡æ¯ä¸ªå®ä¾‹ç›¸äº’é—´çš„é€šä¿¡ä¼ é€’çš„ï¼Œæœ€åä¼šåœ¨æ¯ä¸ªå®ä¾‹ä¸Šä¿å­˜ä¸€ä»½ã€‚å½“æ•°æ®è·¯ç”±ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±éœ€è¦åœ¨æ‰€æœ‰å®ä¾‹é—´é€šè¿‡ç½‘ç»œæ¶ˆæ¯è¿›è¡Œä¼ é€’ã€‚æ‰€ä»¥ï¼Œå¦‚æœå®ä¾‹æ•°é‡è¾ƒå¤šçš„è¯ï¼Œå°±ä¼šæ¶ˆè€—è¾ƒå¤šçš„é›†ç¾¤ç½‘ç»œèµ„æºã€‚</p><p>æ•°æ®åˆ†å¸ƒè§£å†³äº†æ–°æ•°æ®å†™å…¥æ—¶è¯¥ä¿å­˜åœ¨å“ªä¸ªserverçš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå½“ä¸šåŠ¡æ•°æ®å¢åŠ åï¼Œå¦‚æœé›†ç¾¤ä¸­çš„ç°æœ‰å®ä¾‹ä¸è¶³ä»¥ä¿å­˜æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹é›†ç¾¤è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å­¦ä¹ ä¸‹Codisé’ˆå¯¹é›†ç¾¤æ‰©å®¹çš„å…³é”®æŠ€æœ¯è®¾è®¡ã€‚</p><h3>é›†ç¾¤æ‰©å®¹å’Œæ•°æ®è¿ç§»å¦‚ä½•è¿›è¡Œ?</h3><p>Codisé›†ç¾¤æ‰©å®¹åŒ…æ‹¬äº†ä¸¤æ–¹é¢ï¼šå¢åŠ codis serverå’Œå¢åŠ codis proxyã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹å¢åŠ codis serverï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ¶‰åŠåˆ°ä¸¤æ­¥æ“ä½œï¼š</p><ol>\n<li>å¯åŠ¨æ–°çš„codis serverï¼Œå°†å®ƒåŠ å…¥é›†ç¾¤ï¼›</li>\n<li>æŠŠéƒ¨åˆ†æ•°æ®è¿ç§»åˆ°æ–°çš„serverã€‚</li>\n</ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æ•°æ®è¿ç§»æ˜¯ä¸€ä¸ªé‡è¦çš„æœºåˆ¶ï¼Œæ¥ä¸‹æ¥æˆ‘æ¥é‡ç‚¹ä»‹ç»ä¸‹ã€‚</p><p>Codisé›†ç¾¤æŒ‰ç…§Slotçš„ç²’åº¦è¿›è¡Œæ•°æ®è¿ç§»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿ç§»çš„åŸºæœ¬æµç¨‹ã€‚</p><ol>\n<li>åœ¨æºserverä¸Šï¼ŒCodisä»è¦è¿ç§»çš„Slotä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°æ®ï¼Œå‘é€ç»™ç›®çš„serverã€‚</li>\n<li>ç›®çš„serverç¡®è®¤æ”¶åˆ°æ•°æ®åï¼Œä¼šç»™æºserverè¿”å›ç¡®è®¤æ¶ˆæ¯ã€‚è¿™æ—¶ï¼Œæºserverä¼šåœ¨æœ¬åœ°å°†åˆšæ‰è¿ç§»çš„æ•°æ®åˆ é™¤ã€‚</li>\n<li>ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥å°±æ˜¯å•ä¸ªæ•°æ®çš„è¿ç§»è¿‡ç¨‹ã€‚Codisä¼šä¸æ–­é‡å¤è¿™ä¸ªè¿ç§»è¿‡ç¨‹ï¼Œç›´åˆ°è¦è¿ç§»çš„Slotä¸­çš„æ•°æ®å…¨éƒ¨è¿ç§»å®Œæˆã€‚</li>\n</ol><p>æˆ‘ç”»äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œæ˜¾ç¤ºäº†æ•°æ®è¿ç§»çš„æµç¨‹ï¼Œä½ å¯ä»¥çœ‹ä¸‹åŠ æ·±ç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/6b/e01c7806b51b196097c393a079436d6b.jpg?wh=2083*1875\" alt=\"\"></p><p>é’ˆå¯¹åˆšæ‰ä»‹ç»çš„å•ä¸ªæ•°æ®çš„è¿ç§»è¿‡ç¨‹ï¼ŒCodiså®ç°äº†ä¸¤ç§è¿ç§»æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯åŒæ­¥è¿ç§»å’Œå¼‚æ­¥è¿ç§»ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸‹ã€‚</p><p>åŒæ­¥è¿ç§»æ˜¯æŒ‡ï¼Œåœ¨æ•°æ®ä»æºserverå‘é€ç»™ç›®çš„serverçš„è¿‡ç¨‹ä¸­ï¼Œæºserveræ˜¯é˜»å¡çš„ï¼Œæ— æ³•å¤„ç†æ–°çš„è¯·æ±‚æ“ä½œã€‚è¿™ç§æ¨¡å¼å¾ˆå®¹æ˜“å®ç°ï¼Œä½†æ˜¯è¿ç§»è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠå¤šä¸ªæ“ä½œï¼ˆåŒ…æ‹¬æ•°æ®åœ¨æºserveråºåˆ—åŒ–ã€ç½‘ç»œä¼ è¾“ã€åœ¨ç›®çš„serverååºåˆ—åŒ–ï¼Œä»¥åŠåœ¨æºserveråˆ é™¤ï¼‰ï¼Œå¦‚æœè¿ç§»çš„æ•°æ®æ˜¯ä¸€ä¸ªbigkeyï¼Œæºserverå°±ä¼šé˜»å¡è¾ƒé•¿æ—¶é—´ï¼Œæ— æ³•åŠæ—¶å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚</p><p>ä¸ºäº†é¿å…æ•°æ®è¿ç§»é˜»å¡æºserverï¼ŒCodiså®ç°çš„ç¬¬äºŒç§è¿ç§»æ¨¡å¼å°±æ˜¯å¼‚æ­¥è¿ç§»ã€‚å¼‚æ­¥è¿ç§»çš„å…³é”®ç‰¹ç‚¹æœ‰ä¸¤ä¸ªã€‚</p><p>ç¬¬ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå½“æºserveræŠŠæ•°æ®å‘é€ç»™ç›®çš„serveråï¼Œå°±å¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚æ“ä½œäº†ï¼Œä¸ç”¨ç­‰åˆ°ç›®çš„serverçš„å‘½ä»¤æ‰§è¡Œå®Œã€‚è€Œç›®çš„serverä¼šåœ¨æ”¶åˆ°æ•°æ®å¹¶ååºåˆ—åŒ–ä¿å­˜åˆ°æœ¬åœ°åï¼Œç»™æºserverå‘é€ä¸€ä¸ªACKæ¶ˆæ¯ï¼Œè¡¨æ˜è¿ç§»å®Œæˆã€‚æ­¤æ—¶ï¼Œæºserveråœ¨æœ¬åœ°æŠŠåˆšæ‰è¿ç§»çš„æ•°æ®åˆ é™¤ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿ç§»çš„æ•°æ®ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œæ‰€ä»¥ï¼Œæºserverä¸Šçš„æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå‡ºç°â€œå’Œç›®çš„serverä¸Šçš„æ•°æ®ä¸ä¸€è‡´â€çš„é—®é¢˜äº†ã€‚</p><p>ç¬¬äºŒä¸ªç‰¹ç‚¹æ˜¯ï¼Œå¯¹äºbigkeyï¼Œå¼‚æ­¥è¿ç§»é‡‡ç”¨äº†æ‹†åˆ†æŒ‡ä»¤çš„æ–¹å¼è¿›è¡Œè¿ç§»ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œå¯¹bigkeyä¸­æ¯ä¸ªå…ƒç´ ï¼Œç”¨ä¸€æ¡æŒ‡ä»¤è¿›è¡Œè¿ç§»ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªbigkeyè¿›è¡Œåºåˆ—åŒ–åå†æ•´ä½“ä¼ è¾“ã€‚è¿™ç§åŒ–æ•´ä¸ºé›¶çš„æ–¹å¼ï¼Œå°±é¿å…äº†bigkeyè¿ç§»æ—¶ï¼Œå› ä¸ºè¦åºåˆ—åŒ–å¤§é‡æ•°æ®è€Œé˜»å¡æºserverçš„é—®é¢˜ã€‚</p><p>æ­¤å¤–ï¼Œå½“bigkeyè¿ç§»äº†ä¸€éƒ¨åˆ†æ•°æ®åï¼Œå¦‚æœCodiså‘ç”Ÿæ•…éšœï¼Œå°±ä¼šå¯¼è‡´bigkeyçš„ä¸€éƒ¨åˆ†å…ƒç´ åœ¨æºserverï¼Œè€Œå¦ä¸€éƒ¨åˆ†å…ƒç´ åœ¨ç›®çš„serverï¼Œè¿™å°±ç ´åäº†è¿ç§»çš„åŸå­æ€§ã€‚</p><p>æ‰€ä»¥ï¼ŒCodisä¼šåœ¨ç›®æ ‡serverä¸Šï¼Œç»™bigkeyçš„å…ƒç´ è®¾ç½®ä¸€ä¸ªä¸´æ—¶è¿‡æœŸæ—¶é—´ã€‚å¦‚æœè¿ç§»è¿‡ç¨‹ä¸­å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆï¼Œç›®æ ‡serverä¸Šçš„keyä¼šåœ¨è¿‡æœŸåè¢«åˆ é™¤ï¼Œä¸ä¼šå½±å“è¿ç§»çš„åŸå­æ€§ã€‚å½“æ­£å¸¸å®Œæˆè¿ç§»åï¼Œbigkeyå…ƒç´ çš„ä¸´æ—¶è¿‡æœŸæ—¶é—´ä¼šè¢«åˆ é™¤ã€‚</p><p>æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬è¦è¿ç§»ä¸€ä¸ªæœ‰1ä¸‡ä¸ªå…ƒç´ çš„Listç±»å‹æ•°æ®ï¼Œå½“ä½¿ç”¨å¼‚æ­¥è¿ç§»æ—¶ï¼Œæºserverå°±ä¼šç»™ç›®çš„serverä¼ è¾“1ä¸‡æ¡RPUSHå‘½ä»¤ï¼Œæ¯æ¡å‘½ä»¤å¯¹åº”äº†Listä¸­ä¸€ä¸ªå…ƒç´ çš„æ’å…¥ã€‚åœ¨ç›®çš„serverä¸Šï¼Œè¿™1ä¸‡æ¡å‘½ä»¤å†è¢«ä¾æ¬¡æ‰§è¡Œï¼Œå°±å¯ä»¥å®Œæˆæ•°æ®è¿ç§»ã€‚</p><p>è¿™é‡Œï¼Œæœ‰ä¸ªåœ°æ–¹éœ€è¦ä½ æ³¨æ„ä¸‹ï¼Œä¸ºäº†æå‡è¿ç§»çš„æ•ˆç‡ï¼ŒCodisåœ¨å¼‚æ­¥è¿ç§»Slotæ—¶ï¼Œå…è®¸æ¯æ¬¡è¿ç§»å¤šä¸ªkeyã€‚<strong>ä½ å¯ä»¥é€šè¿‡å¼‚æ­¥è¿ç§»å‘½ä»¤SLOTSMGRTTAGSLOT-ASYNCçš„å‚æ•°numkeysè®¾ç½®æ¯æ¬¡è¿ç§»çš„keyæ•°é‡</strong>ã€‚</p><p>åˆšåˆšæˆ‘ä»¬å­¦ä¹ çš„æ˜¯codis serverçš„æ‰©å®¹å’Œæ•°æ®è¿ç§»æœºåˆ¶ï¼Œå…¶å®ï¼Œåœ¨Codisé›†ç¾¤ä¸­ï¼Œé™¤äº†å¢åŠ codis serverï¼Œæœ‰æ—¶è¿˜éœ€è¦å¢åŠ codis proxyã€‚</p><p>å› ä¸ºåœ¨Codisé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯æ˜¯å’Œcodis proxyç›´æ¥è¿æ¥çš„ï¼Œæ‰€ä»¥ï¼Œå½“å®¢æˆ·ç«¯å¢åŠ æ—¶ï¼Œä¸€ä¸ªproxyæ— æ³•æ”¯æ’‘å¤§é‡çš„è¯·æ±‚æ“ä½œï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¢åŠ proxyã€‚</p><p>å¢åŠ proxyæ¯”è¾ƒå®¹æ˜“ï¼Œæˆ‘ä»¬ç›´æ¥å¯åŠ¨proxyï¼Œå†é€šè¿‡codis dashboardæŠŠproxyåŠ å…¥é›†ç¾¤å°±è¡Œã€‚</p><p>æ­¤æ—¶ï¼Œcodis proxyçš„è®¿é—®è¿æ¥ä¿¡æ¯éƒ½ä¼šä¿å­˜åœ¨Zookeeperä¸Šã€‚æ‰€ä»¥ï¼Œå½“æ–°å¢äº†proxyåï¼ŒZookeeperä¸Šä¼šæœ‰æœ€æ–°çš„è®¿é—®åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±å¯ä»¥ä»Zookeeperä¸Šè¯»å–proxyè®¿é—®åˆ—è¡¨ï¼ŒæŠŠè¯·æ±‚å‘é€ç»™æ–°å¢çš„proxyã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯çš„è®¿é—®å‹åŠ›å°±å¯ä»¥åœ¨å¤šä¸ªproxyä¸Šåˆ†æ‹…å¤„ç†äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/70/23/707767936a6fb2d7686c84d81c048423.jpg?wh=3000*1617\" alt=\"\"></p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±äº†è§£äº†Codisé›†ç¾¤ä¸­çš„æ•°æ®åˆ†å¸ƒã€é›†ç¾¤æ‰©å®¹å’Œæ•°æ®è¿ç§»çš„æ–¹æ³•ï¼Œè¿™éƒ½æ˜¯åˆ‡ç‰‡é›†ç¾¤ä¸­çš„å…³é”®æœºåˆ¶ã€‚</p><p>ä¸è¿‡ï¼Œå› ä¸ºé›†ç¾¤æä¾›çš„åŠŸèƒ½å’Œå•å®ä¾‹æä¾›çš„åŠŸèƒ½ä¸åŒï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨é›†ç¾¤æ—¶ï¼Œä¸ä»…è¦å…³æ³¨åˆ‡ç‰‡é›†ç¾¤ä¸­çš„å…³é”®æœºåˆ¶ï¼Œè¿˜éœ€è¦å…³æ³¨å®¢æˆ·ç«¯çš„ä½¿ç”¨ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼šä¸šåŠ¡åº”ç”¨é‡‡ç”¨çš„å®¢æˆ·ç«¯èƒ½å¦ç›´æ¥å’Œé›†ç¾¤äº¤äº’å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥èŠä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p><h3>é›†ç¾¤å®¢æˆ·ç«¯éœ€è¦é‡æ–°å¼€å‘å—?</h3><p>ä½¿ç”¨Rediså•å®ä¾‹æ—¶ï¼Œå®¢æˆ·ç«¯åªè¦ç¬¦åˆRESPåè®®ï¼Œå°±å¯ä»¥å’Œå®ä¾‹è¿›è¡Œäº¤äº’å’Œè¯»å†™æ•°æ®ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤æ—¶ï¼Œæœ‰äº›åŠŸèƒ½æ˜¯å’Œå•å®ä¾‹ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚é›†ç¾¤ä¸­çš„æ•°æ®è¿ç§»æ“ä½œï¼Œåœ¨å•å®ä¾‹ä¸Šæ˜¯æ²¡æœ‰çš„ï¼Œè€Œä¸”è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è®¿é—®è¯·æ±‚å¯èƒ½è¦è¢«é‡å®šå‘ï¼ˆä¾‹å¦‚Redis Clusterä¸­çš„MOVEå‘½ä»¤ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œå®¢æˆ·ç«¯éœ€è¦å¢åŠ å’Œé›†ç¾¤åŠŸèƒ½ç›¸å…³çš„å‘½ä»¤æ“ä½œçš„æ”¯æŒã€‚å¦‚æœåŸæ¥ä½¿ç”¨å•å®ä¾‹å®¢æˆ·ç«¯ï¼Œæƒ³è¦æ‰©å®¹ä½¿ç”¨é›†ç¾¤ï¼Œå°±éœ€è¦ä½¿ç”¨æ–°å®¢æˆ·ç«¯ï¼Œè¿™å¯¹äºä¸šåŠ¡åº”ç”¨çš„å…¼å®¹æ€§æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«å‹å¥½ã€‚</p><p>Codisé›†ç¾¤åœ¨è®¾è®¡æ—¶ï¼Œå°±å……åˆ†è€ƒè™‘äº†å¯¹ç°æœ‰å•å®ä¾‹å®¢æˆ·ç«¯çš„å…¼å®¹æ€§ã€‚</p><p>Codisä½¿ç”¨codis  proxyç›´æ¥å’Œå®¢æˆ·ç«¯è¿æ¥ï¼Œcodis proxyæ˜¯å’Œå•å®ä¾‹å®¢æˆ·ç«¯å…¼å®¹çš„ã€‚è€Œå’Œé›†ç¾¤ç›¸å…³çš„ç®¡ç†å·¥ä½œï¼ˆä¾‹å¦‚è¯·æ±‚è½¬å‘ã€æ•°æ®è¿ç§»ç­‰ï¼‰ï¼Œéƒ½ç”±codis proxyã€codis dashboardè¿™äº›ç»„ä»¶æ¥å®Œæˆï¼Œä¸éœ€è¦å®¢æˆ·ç«¯å‚ä¸ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œä¸šåŠ¡åº”ç”¨ä½¿ç”¨Codisé›†ç¾¤æ—¶ï¼Œå°±ä¸ç”¨ä¿®æ”¹å®¢æˆ·ç«¯äº†ï¼Œå¯ä»¥å¤ç”¨å’Œå•å®ä¾‹è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ—¢èƒ½åˆ©ç”¨é›†ç¾¤è¯»å†™å¤§å®¹é‡æ•°æ®ï¼Œåˆé¿å…äº†ä¿®æ”¹å®¢æˆ·ç«¯å¢åŠ å¤æ‚çš„æ“ä½œé€»è¾‘ï¼Œä¿è¯äº†ä¸šåŠ¡ä»£ç çš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹é›†ç¾¤å¯é æ€§çš„é—®é¢˜ã€‚å¯é æ€§æ˜¯å®é™…ä¸šåŠ¡åº”ç”¨çš„ä¸€ä¸ªæ ¸å¿ƒè¦æ±‚ã€‚<strong>å¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒçš„å¯é æ€§å’Œç³»ç»Ÿä¸­çš„ç»„ä»¶ä¸ªæ•°æœ‰å…³ï¼šç»„ä»¶è¶Šå¤šï¼Œæ½œåœ¨çš„é£é™©ç‚¹ä¹Ÿå°±è¶Šå¤š</strong>ã€‚å’ŒRedis ClusteråªåŒ…å«Rediså®ä¾‹ä¸ä¸€æ ·ï¼ŒCodisé›†ç¾¤åŒ…å«çš„ç»„ä»¶æœ‰4ç±»ã€‚é‚£ä½ å°±ä¼šé—®äº†ï¼Œè¿™ä¹ˆå¤šç»„ä»¶ä¼šé™ä½Codisé›†ç¾¤çš„å¯é æ€§å—ï¼Ÿ</p><h3>æ€ä¹ˆä¿è¯é›†ç¾¤å¯é æ€§ï¼Ÿ</h3><p>æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸‹Codisä¸åŒç»„ä»¶çš„å¯é æ€§ä¿è¯æ–¹æ³•ã€‚</p><p>é¦–å…ˆæ˜¯codis serverã€‚</p><p>codis serverå…¶å®å°±æ˜¯Rediså®ä¾‹ï¼Œåªä¸è¿‡å¢åŠ äº†å’Œé›†ç¾¤æ“ä½œç›¸å…³çš„å‘½ä»¤ã€‚Redisçš„ä¸»ä»å¤åˆ¶æœºåˆ¶å’Œå“¨å…µæœºåˆ¶åœ¨codis serverä¸Šéƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ï¼ŒCodiså°±ä½¿ç”¨ä¸»ä»é›†ç¾¤æ¥ä¿è¯codis serverçš„å¯é æ€§ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼ŒCodisç»™æ¯ä¸ªserveré…ç½®ä»åº“ï¼Œå¹¶ä½¿ç”¨å“¨å…µæœºåˆ¶è¿›è¡Œç›‘æ§ï¼Œå½“å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸»ä»åº“å¯ä»¥è¿›è¡Œåˆ‡æ¢ï¼Œä»è€Œä¿è¯äº†serverçš„å¯é æ€§ã€‚</p><p>åœ¨è¿™ç§é…ç½®æƒ…å†µä¸‹ï¼Œæ¯ä¸ªserverå°±æˆä¸ºäº†ä¸€ä¸ªserver groupï¼Œæ¯ä¸ªgroupä¸­æ˜¯ä¸€ä¸»å¤šä»çš„serverã€‚æ•°æ®åˆ†å¸ƒä½¿ç”¨çš„Slotï¼Œä¹Ÿæ˜¯æŒ‰ç…§groupçš„ç²’åº¦è¿›è¡Œåˆ†é…çš„ã€‚åŒæ—¶ï¼Œcodis proxyåœ¨è½¬å‘è¯·æ±‚æ—¶ï¼Œä¹Ÿæ˜¯æŒ‰ç…§æ•°æ®æ‰€åœ¨çš„Slotå’Œgroupçš„å¯¹åº”å…³ç³»ï¼ŒæŠŠå†™è¯·æ±‚å‘åˆ°ç›¸åº”groupçš„ä¸»åº“ï¼Œè¯»è¯·æ±‚å‘åˆ°groupä¸­çš„ä¸»åº“æˆ–ä»åº“ä¸Šã€‚</p><p>ä¸‹å›¾å±•ç¤ºçš„æ˜¯é…ç½®äº†server groupçš„Codisé›†ç¾¤æ¶æ„ã€‚åœ¨Codisé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡éƒ¨ç½²server groupå’Œå“¨å…µé›†ç¾¤ï¼Œå®ç°codis serverçš„ä¸»ä»åˆ‡æ¢ï¼Œæå‡é›†ç¾¤å¯é æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/02/4a/0282beb10f5c42c1f12c89afbe03af4a.jpg?wh=3000*1992\" alt=\"\"></p><p>å› ä¸ºcodis proxyå’ŒZookeeperè¿™ä¸¤ä¸ªç»„ä»¶æ˜¯æ­é…åœ¨ä¸€èµ·ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªç»„ä»¶çš„å¯é æ€§ã€‚</p><p>åœ¨Codisé›†ç¾¤è®¾è®¡æ—¶ï¼Œproxyä¸Šçš„ä¿¡æ¯æºå¤´éƒ½æ˜¯æ¥è‡ªZookeeperï¼ˆä¾‹å¦‚è·¯ç”±è¡¨ï¼‰ã€‚è€ŒZookeeperé›†ç¾¤ä½¿ç”¨å¤šä¸ªå®ä¾‹æ¥ä¿å­˜æ•°æ®ï¼Œåªè¦æœ‰è¶…è¿‡åŠæ•°çš„Zookeeperå®ä¾‹å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œ Zookeeperé›†ç¾¤å°±å¯ä»¥æä¾›æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä¿è¯è¿™äº›æ•°æ®çš„å¯é æ€§ã€‚</p><p>æ‰€ä»¥ï¼Œcodis proxyä½¿ç”¨Zookeeperé›†ç¾¤ä¿å­˜è·¯ç”±è¡¨ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨Zookeeperçš„é«˜å¯é æ€§ä¿è¯æ¥ç¡®ä¿codis proxyçš„å¯é æ€§ï¼Œä¸ç”¨å†åšé¢å¤–çš„å·¥ä½œäº†ã€‚å½“codis proxyå‘ç”Ÿæ•…éšœåï¼Œç›´æ¥é‡å¯proxyå°±è¡Œã€‚é‡å¯åçš„proxyï¼Œå¯ä»¥é€šè¿‡codis dashboardä»Zookeeperé›†ç¾¤ä¸Šè·å–è·¯ç”±è¡¨ï¼Œç„¶åï¼Œå°±å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œè½¬å‘äº†ã€‚è¿™æ ·çš„è®¾è®¡ï¼Œä¹Ÿé™ä½äº†Codisé›†ç¾¤æœ¬èº«çš„å¼€å‘å¤æ‚åº¦ã€‚</p><p>å¯¹äºcodis dashboardå’Œcodis feæ¥è¯´ï¼Œå®ƒä»¬ä¸»è¦æä¾›é…ç½®ç®¡ç†å’Œç®¡ç†å‘˜æ‰‹å·¥æ“ä½œï¼Œè´Ÿè½½å‹åŠ›ä¸å¤§ï¼Œæ‰€ä»¥ï¼Œå®ƒä»¬çš„å¯é æ€§å¯ä»¥ä¸ç”¨é¢å¤–è¿›è¡Œä¿è¯äº†ã€‚</p><h2>åˆ‡ç‰‡é›†ç¾¤æ–¹æ¡ˆé€‰æ‹©å»ºè®®</h2><p>åˆ°è¿™é‡Œï¼ŒCodiså’ŒRedis Clusterè¿™ä¸¤ç§åˆ‡ç‰‡é›†ç¾¤æ–¹æ¡ˆæˆ‘ä»¬å°±å­¦å®Œäº†ï¼Œæˆ‘æŠŠå®ƒä»¬çš„åŒºåˆ«æ€»ç»“åœ¨äº†ä¸€å¼ è¡¨é‡Œï¼Œä½ å¯ä»¥å¯¹æ¯”çœ‹ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/b8/8fec8c2f76e32647d055ae6ed8cfbab8.jpg?wh=2880*1166\" alt=\"\"></p><p>æœ€åï¼Œåœ¨å®é™…åº”ç”¨çš„æ—¶å€™ï¼Œå¯¹äºè¿™ä¸¤ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿæˆ‘å†ç»™ä½ æ4æ¡å»ºè®®ã€‚</p><ol>\n<li>\n<p>ä»ç¨³å®šæ€§å’Œæˆç†Ÿåº¦æ¥çœ‹ï¼ŒCodisåº”ç”¨å¾—æ¯”è¾ƒæ—©ï¼Œåœ¨ä¸šç•Œå·²ç»æœ‰äº†æˆç†Ÿçš„ç”Ÿäº§éƒ¨ç½²ã€‚è™½ç„¶Codiså¼•å…¥äº†proxyå’ŒZookeeperï¼Œå¢åŠ äº†é›†ç¾¤å¤æ‚åº¦ï¼Œä½†æ˜¯ï¼Œproxyçš„æ— çŠ¶æ€è®¾è®¡å’ŒZookeeperè‡ªèº«çš„ç¨³å®šæ€§ï¼Œä¹Ÿç»™Codisçš„ç¨³å®šä½¿ç”¨æä¾›äº†ä¿è¯ã€‚è€ŒRedis Clusterçš„æ¨å‡ºæ—¶é—´æ™šäºCodisï¼Œç›¸å¯¹æ¥è¯´ï¼Œæˆç†Ÿåº¦è¦å¼±äºCodisï¼Œå¦‚æœä½ æƒ³é€‰æ‹©ä¸€ä¸ªæˆç†Ÿç¨³å®šçš„æ–¹æ¡ˆï¼ŒCodisæ›´åŠ åˆé€‚äº›ã€‚</p>\n</li>\n<li>\n<p>ä»ä¸šåŠ¡åº”ç”¨å®¢æˆ·ç«¯å…¼å®¹æ€§æ¥çœ‹ï¼Œè¿æ¥å•å®ä¾‹çš„å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥è¿æ¥codis proxyï¼Œè€ŒåŸæœ¬è¿æ¥å•å®ä¾‹çš„å®¢æˆ·ç«¯è¦æƒ³è¿æ¥Redis Clusterçš„è¯ï¼Œå°±éœ€è¦å¼€å‘æ–°åŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡åº”ç”¨ä¸­å¤§é‡ä½¿ç”¨äº†å•å®ä¾‹çš„å®¢æˆ·ç«¯ï¼Œè€Œç°åœ¨æƒ³åº”ç”¨åˆ‡ç‰‡é›†ç¾¤çš„è¯ï¼Œå»ºè®®ä½ é€‰æ‹©Codisï¼Œè¿™æ ·å¯ä»¥é¿å…ä¿®æ”¹ä¸šåŠ¡åº”ç”¨ä¸­çš„å®¢æˆ·ç«¯ã€‚</p>\n</li>\n<li>\n<p>ä»ä½¿ç”¨Redisæ–°å‘½ä»¤å’Œæ–°ç‰¹æ€§æ¥çœ‹ï¼ŒCodis serveræ˜¯åŸºäºå¼€æºçš„Redis 3.2.8å¼€å‘çš„ï¼Œæ‰€ä»¥ï¼ŒCodiså¹¶ä¸æ”¯æŒRedisåç»­çš„å¼€æºç‰ˆæœ¬ä¸­çš„æ–°å¢å‘½ä»¤å’Œæ•°æ®ç±»å‹ã€‚å¦å¤–ï¼ŒCodiså¹¶æ²¡æœ‰å®ç°å¼€æºRedisç‰ˆæœ¬çš„æ‰€æœ‰å‘½ä»¤ï¼Œæ¯”å¦‚BITOPã€BLPOPã€BRPOPï¼Œä»¥åŠå’Œä¸äº‹åŠ¡ç›¸å…³çš„MUTLIã€EXECç­‰å‘½ä»¤ã€‚<a href=\"https://github.com/CodisLabs/codis/blob/release3.2/doc/unsupported_cmds.md\">Codiså®˜ç½‘</a>ä¸Šåˆ—å‡ºäº†ä¸è¢«æ”¯æŒçš„å‘½ä»¤åˆ—è¡¨ï¼Œä½ åœ¨ä½¿ç”¨æ—¶è®°å¾—å»æ ¸æŸ¥ä¸€ä¸‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¼€æºRedis ç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼ŒRedis Clusteræ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚</p>\n</li>\n<li>\n<p>ä»æ•°æ®è¿ç§»æ€§èƒ½ç»´åº¦æ¥çœ‹ï¼ŒCodisèƒ½æ”¯æŒå¼‚æ­¥è¿ç§»ï¼Œå¼‚æ­¥è¿ç§»å¯¹é›†ç¾¤å¤„ç†æ­£å¸¸è¯·æ±‚çš„æ€§èƒ½å½±å“è¦æ¯”ä½¿ç”¨åŒæ­¥è¿ç§»çš„å°ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨åº”ç”¨é›†ç¾¤æ—¶ï¼Œæ•°æ®è¿ç§»æ¯”è¾ƒé¢‘ç¹çš„è¯ï¼ŒCodisæ˜¯ä¸ªæ›´åˆé€‚çš„é€‰æ‹©ã€‚</p>\n</li>\n</ol><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Redisåˆ‡ç‰‡é›†ç¾¤çš„Codisæ–¹æ¡ˆã€‚Codisé›†ç¾¤åŒ…å«codis serverã€codis proxyã€Zookeeperã€codis dashboardå’Œcodis feè¿™å››å¤§ç±»ç»„ä»¶ã€‚æˆ‘ä»¬å†æ¥å›é¡¾ä¸‹å®ƒä»¬çš„ä¸»è¦åŠŸèƒ½ã€‚</p><ul>\n<li>codis proxyå’Œcodis serverè´Ÿè´£å¤„ç†æ•°æ®è¯»å†™è¯·æ±‚ï¼Œå…¶ä¸­ï¼Œcodis proxyå’Œå®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥æ”¶è¯·æ±‚ï¼Œå¹¶è½¬å‘è¯·æ±‚ç»™codis serverï¼Œè€Œcodis serverè´Ÿè´£å…·ä½“å¤„ç†è¯·æ±‚ã€‚</li>\n<li>codis dashboardå’Œcodis feè´Ÿè´£é›†ç¾¤ç®¡ç†ï¼Œå…¶ä¸­ï¼Œcodis dashboardæ‰§è¡Œç®¡ç†æ“ä½œï¼Œè€Œcodis feæä¾›Webç®¡ç†ç•Œé¢ã€‚</li>\n<li>Zookeeperé›†ç¾¤è´Ÿè´£ä¿å­˜é›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è·¯ç”±è¡¨ã€proxyå®ä¾‹ä¿¡æ¯ç­‰ã€‚è¿™é‡Œï¼Œæœ‰ä¸ªåœ°æ–¹éœ€è¦ä½ æ³¨æ„ï¼Œé™¤äº†ä½¿ç”¨Zookeeperï¼ŒCodisè¿˜å¯ä»¥ä½¿ç”¨etcdæˆ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¿å­˜å…ƒæ•°æ®ä¿¡æ¯ã€‚</li>\n</ul><p>å…³äºCodiså’ŒRedis Clusterçš„é€‰å‹è€ƒè™‘ï¼Œæˆ‘ä»ç¨³å®šæ€§æˆç†Ÿåº¦ã€å®¢æˆ·ç«¯å…¼å®¹æ€§ã€Redisæ–°ç‰¹æ€§ä½¿ç”¨ä»¥åŠæ•°æ®è¿ç§»æ€§èƒ½å››ä¸ªæ–¹é¢ç»™ä½ æä¾›äº†å»ºè®®ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚</p><p>æœ€åï¼Œæˆ‘å†ç»™ä½ æä¾›ä¸€ä¸ªCodisä½¿ç”¨ä¸Šçš„å°å»ºè®®ï¼šå½“ä½ æœ‰å¤šæ¡ä¸šåŠ¡çº¿è¦ä½¿ç”¨Codisæ—¶ï¼Œå¯ä»¥å¯åŠ¨å¤šä¸ªcodis dashboardï¼Œæ¯ä¸ªdashboardç®¡ç†ä¸€éƒ¨åˆ†codis serverï¼ŒåŒæ—¶ï¼Œå†ç”¨ä¸€ä¸ªdashboardå¯¹åº”è´Ÿè´£ä¸€ä¸ªä¸šåŠ¡çº¿çš„é›†ç¾¤ç®¡ç†ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªCodisé›†ç¾¤å®ç°å¤šæ¡ä¸šåŠ¡çº¿çš„éš”ç¦»ç®¡ç†äº†ã€‚</p><h2>æ¯è¯¾ä¸€é—®</h2><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä¼šç»™ä½ æä¸ªå°é—®é¢˜ã€‚å‡è®¾Codisé›†ç¾¤ä¸­ä¿å­˜çš„80%çš„é”®å€¼å¯¹éƒ½æ˜¯Hashç±»å‹ï¼Œæ¯ä¸ªHashé›†åˆçš„å…ƒç´ æ•°é‡åœ¨10ä¸‡ï½20ä¸‡ä¸ªï¼Œæ¯ä¸ªé›†åˆå…ƒç´ çš„å¤§å°æ˜¯2KBã€‚ä½ è§‰å¾—ï¼Œè¿ç§»ä¸€ä¸ªè¿™æ ·çš„Hashé›†åˆæ•°æ®ï¼Œä¼šå¯¹Codisçš„æ€§èƒ½é€ æˆå½±å“å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":260495,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1605025269,"is_pvip":true,"discussion_count":20,"race_medal":0,"score":"663029988853","product_id":100056701,"comment_content":"å‡è®¾ Codis é›†ç¾¤ä¸­ä¿å­˜çš„ 80% çš„é”®å€¼å¯¹éƒ½æ˜¯ Hash ç±»å‹ï¼Œæ¯ä¸ª Hash é›†åˆçš„å…ƒç´ æ•°é‡åœ¨ 10 ä¸‡ ï½ 20 ä¸‡ä¸ªï¼Œæ¯ä¸ªé›†åˆå…ƒç´ çš„å¤§å°æ˜¯ 2KBã€‚è¿ç§»ä¸€ä¸ªè¿™æ ·çš„ Hash é›†åˆæ•°æ®ï¼Œæ˜¯å¦ä¼šå¯¹ Codis çš„æ€§èƒ½é€ æˆå½±å“ï¼Ÿ<br><br>ä¸ä¼šæœ‰æ€§èƒ½å½±å“ã€‚<br><br>Codis åœ¨è¿ç§»æ•°æ®æ—¶ï¼Œè®¾è®¡çš„æ–¹æ¡ˆå¯ä»¥ä¿è¯è¿ç§»æ€§èƒ½ä¸å—å½±å“ã€‚<br><br>1ã€å¼‚æ­¥è¿ç§»ï¼šæºèŠ‚ç‚¹æŠŠè¿ç§»çš„æ•°æ®å‘é€ç»™ç›®æ ‡èŠ‚ç‚¹åå°±è¿”å›ï¼Œä¹‹åæ¥ç€å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿™ä¸ªé˜¶æ®µä¸ä¼šé•¿æ—¶é—´é˜»å¡æºèŠ‚ç‚¹ã€‚ç›®æ ‡èŠ‚ç‚¹åŠ è½½è¿ç§»çš„æ•°æ®æˆåŠŸåï¼Œå‘æºèŠ‚ç‚¹å‘é€ ACK å‘½ä»¤ï¼Œå‘ŠçŸ¥å…¶è¿ç§»æˆåŠŸã€‚<br><br>2ã€æºèŠ‚ç‚¹å¼‚æ­¥é‡Šæ”¾ keyï¼šæºèŠ‚ç‚¹æ”¶åˆ°ç›®æ ‡èŠ‚ç‚¹ ACK åï¼Œåœ¨æºå®ä¾‹åˆ é™¤è¿™ä¸ª keyï¼Œé‡Šæ”¾ key å†…å­˜çš„æ“ä½œï¼Œä¼šæ”¾åˆ°åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡æºå®ä¾‹ã€‚ï¼ˆæ²¡é”™ï¼ŒCodis æ¯” Redis æ›´æ—©åœ°æ”¯æŒäº† lazy-freeï¼Œåªä¸è¿‡åªç”¨åœ¨äº†æ•°æ®è¿ç§»ä¸­ï¼‰ã€‚<br><br>3ã€å°å¯¹è±¡åºåˆ—åŒ–ä¼ è¾“ï¼šå°å¯¹è±¡ä¾æ—§é‡‡ç”¨åºåˆ—åŒ–æ–¹å¼è¿ç§»ï¼ŒèŠ‚çœç½‘ç»œæµé‡ã€‚<br><br>4ã€bigkey åˆ†æ‰¹è¿ç§»ï¼šbigkey æ‹†åˆ†æˆä¸€æ¡æ¡å‘½ä»¤ï¼Œæ‰“åŒ…åˆ†æ‰¹è¿ç§»ï¼ˆåˆ©ç”¨äº† Pipeline çš„ä¼˜åŠ¿ï¼‰ï¼Œæå‡è¿ç§»é€Ÿåº¦ã€‚<br><br>5ã€ä¸€æ¬¡è¿ç§»å¤šä¸ª keyï¼šä¸€æ¬¡å‘é€å¤šä¸ª key è¿›è¡Œè¿ç§»ï¼Œæå‡è¿ç§»æ•ˆç‡ã€‚<br><br>6ã€è¿ç§»æµé‡æ§åˆ¶ï¼šè¿ç§»æ—¶ä¼šæ§åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œé¿å…å æ»¡ç½‘ç»œå¸¦å®½ã€‚<br><br>7ã€bigkey è¿ç§»åŸå­æ€§ä¿è¯ï¼ˆå…¼å®¹è¿ç§»å¤±è´¥æƒ…å†µï¼‰ï¼šè¿ç§»å‰å…ˆå‘ä¸€ä¸ª DEL å‘½ä»¤åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼ˆé‡è¯•å¯ä¿è¯å¹‚ç­‰æ€§ï¼‰ï¼Œç„¶åæŠŠ bigkey æ‹†åˆ†æˆä¸€æ¡æ¡å‘½ä»¤ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªä¸´æ—¶è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢è¿ç§»å¤±è´¥åœ¨ç›®æ ‡èŠ‚ç‚¹é—ç•™åƒåœ¾æ•°æ®ï¼‰ï¼Œè¿ç§»æˆåŠŸååœ¨ç›®æ ‡èŠ‚ç‚¹è®¾ç½®çœŸå®çš„è¿‡æœŸæ—¶é—´ã€‚<br><br>Codis åœ¨æ•°æ®è¿ç§»æ–¹é¢è¦æ¯” Redis Cluster åšå¾—æ›´ä¼˜ç§€ï¼Œè€Œä¸” Codis è¿˜å¸¦äº†ä¸€ä¸ªéå¸¸å‹å¥½çš„è¿ç»´ç•Œé¢ï¼Œæ–¹ä¾¿ DBA æ‰§è¡Œå¢åˆ èŠ‚ç‚¹ã€ä¸»ä»åˆ‡æ¢ã€æ•°æ®è¿ç§»ç­‰æ“ä½œã€‚<br><br>æˆ‘å½“æ—¶åœ¨å¯¹ Codis å¼€å‘æ–°çš„ç»„ä»¶æ—¶ï¼Œè¢« Codis çš„ä¼˜ç§€è®¾è®¡æ·±æ·±æŠ˜æœã€‚å½“ç„¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç»„ä»¶æ¯”è¾ƒå¤šï¼Œéƒ¨ç½²ç•¥å¤æ‚ã€‚å¦å¤–ï¼Œå› ä¸ºæ˜¯åŸºäº Redis 3.2.8 åšçš„äºŒæ¬¡å¼€å‘ï¼Œæ‰€ä»¥å‡çº§ Redis Server æ¯”è¾ƒå›°éš¾ï¼Œæ–°ç‰¹æ€§ä¹Ÿå°±è‡ªç„¶æ— æ³•ä½¿ç”¨ã€‚<br><br>ç°åœ¨ Codis å·²ç»ä¸å†ç»´æŠ¤ï¼Œä½†æ˜¯ä½œä¸ºå›½äººå¼€å‘çš„ Redis é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œå…¶è®¾è®¡æ€æƒ³è¿˜æ˜¯éå¸¸å€¼å¾—å­¦ä¹ çš„ã€‚ä¹Ÿæ¨è Go å¼€å‘è€…ï¼Œè¯»ä¸€è¯» Codis æºç ï¼Œè´¨é‡éå¸¸é«˜ï¼Œå¯¹äº Go è¯­è¨€çš„è¿›é˜¶ä¹Ÿä¼šæœ‰å¾ˆå¤§æ”¶è·ï¼","like_count":155,"discussions":[{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337896,"discussion_content":"æˆ‘è§‰å¾—é—æ¼äº†ä¸€ä¸ª codisçš„å·¨å¤§ä¼˜åŠ¿ï¼Œå°±æ˜¯ mgetç±»ä¼¼è¿™ç§æ‰¹é‡å‘½ä»¤ï¼Œcodisçš„ proxy ä¼šå¤šçº¿ç¨‹æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æ“ä½œï¼Œè€Œredis-cluster  å¯¹è¿™ç§mgetæ“ä½œæ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œ å®¢æˆ·ç«¯ç ”å‘çš„è¯ æˆæœ¬è‚¯å®šä¸å¦‚proxyç©å¾—è½¬é‚£ã€‚","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1609119962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337905,"discussion_content":"å—¯è¿™ä¹Ÿç®—æ˜¯ä¸ªä¼˜åŠ¿ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609121409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337896,"ip_address":""},"score":337905,"extra":""}]},{"author":{"id":2250114,"avatar":"https://static001.geekbang.org/account/avatar/00/22/55/82/985411a8.jpg","nickname":"xyx","note":"","ucode":"1AECC9DDAC3D11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349506,"discussion_content":"codiså·²ç»é€‚é…äº†4.0.1 ä½†æ˜¯è¿ç§»é€»è¾‘æœ‰bug å·²æäº¤äº†prâ€¦","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1613274084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2120877,"avatar":"https://static001.geekbang.org/account/avatar/00/20/5c/ad/3934e3cc.jpg","nickname":"æ–°å¹´å¿«ä¹å•Š","note":"","ucode":"50811438BFAFA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327225,"discussion_content":"è¯¾ä»£è¡¨ä½ å¥½ï¼Œæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œè€å¸ˆçš„åŸæ–‡ï¼š\n\nâ€œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿ç§»çš„æ•°æ®ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œæ‰€ä»¥ï¼Œæº server ä¸Šçš„æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå‡ºç°â€œå’Œç›®çš„ server ä¸Šçš„æ•°æ®ä¸ä¸€è‡´â€çš„é—®é¢˜äº†â€\n\nå¼‚æ­¥è¿ç§»æ—¶æ•°æ®ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œé‚£å¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å…³äºè¯¥æ•°æ®çš„å†™è¯·æ±‚ï¼Œè¯¥æ˜¯æ€ä¹ˆå¤„ç†åº”å¯¹çš„ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1605771364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2120877,"avatar":"https://static001.geekbang.org/account/avatar/00/20/5c/ad/3934e3cc.jpg","nickname":"æ–°å¹´å¿«ä¹å•Š","note":"","ucode":"50811438BFAFA5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327293,"discussion_content":"å¥½é—®é¢˜ï¼Œè¿™å—æ˜¯è¿ç§»çš„ç»†èŠ‚ã€‚\n\nè§£å†³æ–¹æ¡ˆæ˜¯é‡è¯•ï¼Œç­‰å¾…è¿ç§»åˆ°æ–°èŠ‚ç‚¹åï¼Œåœ¨æ–°çš„èŠ‚ç‚¹å†™ã€‚Redisæ•°æ®åœ¨è¿ç§»æ—¶è¿‡ç¨‹ä¸­ï¼Œä¼šç»´æŠ¤çŠ¶æ€ï¼Œå¤–éƒ¨é€šè¿‡å‘½ä»¤å¯ä»¥æ‹¿åˆ°ï¼Œç„¶åæ ¹æ®çŠ¶æ€é‡è¯•ã€‚\n\nä½ å¯ä»¥æŸ¥ä¸€ä¸‹Codiså¼‚æ­¥è¿ç§»çš„æ–‡ç« ï¼Œç»†èŠ‚å¾ˆå¤šï¼Œç†è§£åŸç†ä¹‹åä½ ä¹Ÿä¼šè§‰å¾—Codisè®¾è®¡å¾—å¾ˆä¼˜ç§€ã€‚","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1605786439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327225,"ip_address":""},"score":327293,"extra":""},{"author":{"id":2120877,"avatar":"https://static001.geekbang.org/account/avatar/00/20/5c/ad/3934e3cc.jpg","nickname":"æ–°å¹´å¿«ä¹å•Š","note":"","ucode":"50811438BFAFA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":327526,"discussion_content":"è°¢è°¢è°¢è°¢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605857128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":327293,"ip_address":""},"score":327526,"extra":""}]},{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"çº¦ä¹¦äºš","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347954,"discussion_content":"è¿ç§»çš„éƒ¨åˆ†æ²¡çœ‹æ‡‚ï¼Œä¸ç®¡æ˜¯åŒæ­¥è¿ç§»è¿˜æ˜¯å¼‚æ­¥è¿ç§»ï¼Œåœ¨è¿ç§»ä¸­slotçš„keyï¼Œproxyè¦å¦‚ä½•çŸ¥é“æ­¤keyå½“å‰æ˜¯åœ¨æºserverè¿˜æ˜¯ç›®æ ‡serverä¸Šå‘¢ï¼Ÿ\nå¦å¤–ï¼Œå¼‚æ­¥è¿ç§»æåˆ°äº†è¿ç§»è¿‡ç¨‹ä¸­åªè¯»ï¼Œæ˜¯æŒ‡ä»…ä»…æŸä¸ªkeyåœ¨è¿ç§»æ—¶åªè¯»ï¼Œè€Œä¸æ˜¯æ•´ä¸ªslotæ˜¯å§ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1612398844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1116403,"avatar":"https://static001.geekbang.org/account/avatar/00/11/08/f3/35773693.jpg","nickname":"éå¸¸éå¸¸éå¸¸éå¸¸çš„æ™®é€šä¸­ä¸‹","note":"","ucode":"4D15549F5055D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"çº¦ä¹¦äºš","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387733,"discussion_content":"è¿ç§»æœ‰åŸå­æ€§ï¼Œè¿ç§»ä¸­çš„æ•°æ®åº”è¯¥åœ¨æºserver","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628390198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":347954,"ip_address":""},"score":387733,"extra":""}]},{"author":{"id":1004092,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","nickname":"å¼ ä¸‰","note":"","ucode":"1155528FAE1546","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325854,"discussion_content":"https://kaito-kidd.com/2020/07/07/redis-cluster-codis-twemproxy/\nè¿™ä¸ªæ˜¯æ‚¨çš„ä¸ªäººåšå®¢ï¼Ÿè¯ä¹¦è¿‡æœŸå•¦ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605444746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1004092,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","nickname":"å¼ ä¸‰","note":"","ucode":"1155528FAE1546","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327182,"discussion_content":"httpè®¿é—®ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605761488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":325854,"ip_address":""},"score":327182,"extra":""}]},{"author":{"id":1411096,"avatar":"https://static001.geekbang.org/account/avatar/00/15/88/18/9744d5ec.jpg","nickname":"å°è¶…äºº","note":"","ucode":"0D8A433F3E3737","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339589,"discussion_content":"codis  å¤§ä½¬è·‘å»å¼€å‘ tidb äº†\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609742534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2550743,"avatar":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","nickname":"if...else...","note":"","ucode":"D0565908C99695","race_medal":4,"user_type":1,"is_pvip":false},"reply_author":{"id":1411096,"avatar":"https://static001.geekbang.org/account/avatar/00/15/88/18/9744d5ec.jpg","nickname":"å°è¶…äºº","note":"","ucode":"0D8A433F3E3737","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383870,"discussion_content":"æ˜¯ä¸­å›½äººå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626262603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339589,"ip_address":""},"score":383870,"extra":""}]},{"author":{"id":1415619,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","nickname":"é™Œå…®","note":"","ucode":"00CE47CAECD5CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553751,"discussion_content":"ç²¾å½©ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646050585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007405,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5f/2d/d294a2d2.jpg","nickname":"nzb","note":"","ucode":"2CAE41EDB5C910","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365547,"discussion_content":"å¤§ç¥ï¼Œå¯¹äºæºèŠ‚ç‚¹å¼‚æ­¥é‡Šæ”¾keyæœ‰ç‚¹ç–‘é—®ï¼Œå¦‚æœæºèŠ‚ç‚¹æ”¶åˆ°ç›®æ ‡èŠ‚ç‚¹ACKåï¼Œå°±ç›´æ¥åˆ é™¤è¿™ä¸ªkeyï¼Œå› ä¸ºè¿ç§»æ˜¯å¼‚æ­¥çš„ï¼Œç›®æ ‡èŠ‚ç‚¹å›å¤ACKï¼Œå¹¶ä¸è¡¨ç¤ºè¿ç§»åŠ¨ä½œå·²ç»å®Œæˆï¼Œå¯èƒ½åœ¨è¿ç§»ä¸­ï¼Œå¦‚æœåœ¨è¿ç§»ä¸­ï¼Œç›´æ¥åˆ é™¤ï¼Œè¿™ä¸ªä¼šä¸ä¼šå¯¼è‡´é—®é¢˜ï¼Œæ²¡å¤ªæ˜ç™½codieså¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617837827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1007405,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5f/2d/d294a2d2.jpg","nickname":"nzb","note":"","ucode":"2CAE41EDB5C910","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365598,"discussion_content":"ç›®æ ‡èŠ‚ç‚¹åœ¨åŠ è½½å®Œæˆkeyåï¼Œè¡¨ç¤ºè¿™ä¸ªkeyè¿ç§»å®Œæˆï¼Œæ‰ä¼šç»™æºèŠ‚ç‚¹å›å¤ACKçš„ï¼ŒæºèŠ‚ç‚¹æ­¤æ—¶åˆ é™¤æ²¡é—®é¢˜ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1617848208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":365547,"ip_address":""},"score":365598,"extra":""}]},{"author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334145,"discussion_content":"å¤§ç¥ï¼Œè¯·é—®ä¸‹ï¼Œcodisæ—¢ç„¶å·²ç»å¼•å…¥äº†ZKï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ZKæ¥åšä¸»ä»çš„é€‰ä¸»ï¼Œè¿˜è¦å¼•å…¥å“¨å…µå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607750811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337894,"discussion_content":"codis å†å²ç»å†è¿‡Nå¤šæ¬¡å¤§ç‰ˆæœ¬å˜æ›´ï¼Œæˆ‘çŒœæ˜¯é™ä½å¤æ‚åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609119857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334145,"ip_address":""},"score":337894,"extra":""},{"author":{"id":1023101,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9c/7d/774e07f9.jpg","nickname":"studyçš„ç¨‹åºå‘˜","note":"","ucode":"E5AE9037D24429","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371787,"discussion_content":"å“¨å…µæ˜¯ç°æˆçš„ï¼Œä¸ºå•¥ä¸ç”¨ğŸ˜‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619967902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334145,"ip_address":""},"score":371787,"extra":""},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377033,"discussion_content":"è®¾è®¡å‡å°‘å¯¹å¤–éƒ¨çš„åŠŸèƒ½ä¾èµ–å§\nåªæ˜¯å¼•å…¥ZKä¿å­˜æ˜ å°„åˆ†ç‰‡ä¿¡æ¯ï¼Œè¿™æ ·è¿˜å¯ä»¥æ›¿æ¢ä¸ºetcdä¹‹ç±»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622470394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334145,"ip_address":""},"score":377033,"extra":""}]}]},{"had_liked":false,"id":260797,"user_name":"æ¨é€¸æ—","can_delete":false,"product_type":"c1","uid":1167233,"ip_address":"","ucode":"4BF3CF3E2F1AC7","user_header":"https://static001.geekbang.org/account/avatar/00/11/cf/81/96f656ef.jpg","comment_is_top":false,"comment_ctime":1605108258,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"57439683106","product_id":100056701,"comment_content":"æˆ‘ç®€å•ç”¨ Google æœäº†ä¸‹ï¼Œä¸»æµçš„ Redis é›†ç¾¤æ–¹æ¡ˆå¤§æ¦‚åˆ†ä¸ºä¸‰ç§ï¼š<br>1. Redis Cluster<br>2. å¤§å‚&#47;å°é¡¹ç›®ç»„ å¼€æºçš„è§£å†³æ–¹æ¡ˆâ€”â€” Twitter å¼€æºçš„ Twemproxyã€Codis<br>3. ä¹°ä¸“æœ‰çš„ Redis æœåŠ¡å™¨â€”â€” Aliyun AparaCacheï¼ˆè¿™ä¸ªå¼€æºçš„æ²¡æœ‰ slot çš„å®ç°ï¼‰ã€AWS ElasticCache<br><br>ç¬¬äºŒç§çš„è¯ï¼Œæˆ‘çœ‹äº†ä¸‹ä»–ä»¬çš„ Github å¯¹åº”çš„ Repositoryï¼Œä¸Šä¸€æ¬¡æ›´æ–°æ˜¯ä¸¤å¹´å‰ã€‚ç°åœ¨è¦å¥½ç”¨ï¼ˆèƒ½ç”¨ Redis çš„æ–°ç‰¹æ€§ï¼Œå¹¶ä¸”èƒ½è½»æ¾æ‰©å®¹ï¼‰çš„é›†ç¾¤æ–¹æ¡ˆï¼Œåªèƒ½è‡ªç ”æˆ–è€…ä¹°äº‘å‚å•†çš„å—ï¼Ÿ<br><br>ä¸»è¦å‚è€ƒäº†è¿™ä¸‰ä¸ª<br>https:&#47;&#47;cloud.tencent.com&#47;developer&#47;article&#47;1701574<br>https:&#47;&#47;www.cnblogs.com&#47;me115&#47;p&#47;9043420.html<br>https:&#47;&#47;www.zhihu.com&#47;question&#47;21419897<br><br>ç¬¬ä¸€ä¸ªé¡µé¢æ˜¯è½¬è½½è‡ª Kaito çš„ä¸ªäººåšå®¢ç½‘ç«™ï¼Œæˆ‘æ˜¯æƒ³ä¸åˆ°çš„ï¼Œå¯¹åº”çš„é¡µé¢ä¸Šæœ‰äººè¯´æ–¹æ¡ˆå¤ªè€äº†ã€‚<br>é¡ºä¾¿æä¸€ä¸‹ï¼Œæˆ‘çš„ä¹Ÿæ˜¯ç”¨çš„ Hexoï¼Œä¹Ÿæ˜¯åŸºäº Next ä¸»é¢˜æ”¹çš„ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ã€‚","like_count":13,"discussions":[{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337897,"discussion_content":"æ˜¯ã€‚ã€‚ã€‚ä¸­å°å…¬å¸ç›´æ¥ä¹°æˆç†Ÿæ–¹æ¡ˆï¼Œä¸­å¤§å‹å…¬å¸ä¸€èˆ¬éƒ½è‡ªç ”ã€‚ã€‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609120005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269569,"user_name":"å¤©æ°”","can_delete":false,"product_type":"c1","uid":1356918,"ip_address":"","ucode":"6DEB8177703C4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/b4/76/5ca1718e.jpg","comment_is_top":false,"comment_ctime":1608704157,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"27378507933","product_id":100056701,"comment_content":"redis clusteræ€ä¹ˆä½¿ç”¨éƒ½æ²¡ä»‹ç»å•Š","like_count":7,"discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377012,"discussion_content":"Spring RedisTemplate","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622464948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261264,"user_name":"Geek_f00f74","can_delete":false,"product_type":"c1","uid":2179830,"ip_address":"","ucode":"7A0E89CB0AF499","user_header":"","comment_is_top":false,"comment_ctime":1605253914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27375057690","product_id":100056701,"comment_content":"è¿ç§»çš„æ•°æ®ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œå¦‚æœè¿ç§»è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯¹è¿ç§»æ•°æ®çš„å†™æ“ä½œï¼Œä¼šå¯¼è‡´redisè¯»å†™çº¿ç¨‹é˜»å¡å—ï¼Ÿ","like_count":6},{"had_liked":false,"id":293093,"user_name":"rfyiamcool","can_delete":false,"product_type":"c1","uid":1118627,"ip_address":"","ucode":"65FCBF05B13893","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/a3/7a2405ca.jpg","comment_is_top":false,"comment_ctime":1621214804,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"23096051284","product_id":100056701,"comment_content":"ä¸å»ºè®®ä½¿ç”¨codisï¼Œredisçš„ç‰ˆæœ¬å¤ªè€ï¼Œåœ¨å¾ˆå¤šç‰¹æ€§å’Œæ€§èƒ½ä¸Šéƒ½æœ‰ä½“ç°ï¼Œcodisåœ¨å¤§æµé‡ä¸‹æ€§èƒ½è¡°å‡å¾ˆå‰å®³ï¼Œå¦å¤–codisçš„ç®¡é“æœ‰æ€§èƒ½å’Œå…¼å®¹é—®é¢˜ã€‚","like_count":5,"discussions":[{"author":{"id":1050993,"avatar":"https://static001.geekbang.org/account/avatar/00/10/09/71/b6638c96.jpg","nickname":"æŒ¤æŒ¤","note":"","ucode":"38135B9453E597","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396023,"discussion_content":"codis å¥½åƒä¸å†ç»´æŠ¤äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632382217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286580,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1617408072,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"14502309960","product_id":100056701,"comment_content":"åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œå¦‚æœæ¡ä»¶å…è®¸ï¼Œä¸»è¦æ˜¯ Redis çš„ç‰ˆæœ¬ï¼Œå¦å¤–è¿˜æœ‰ä¸šåŠ¡éœ€è¦ï¼Œå½“ç„¶æ˜¯é€‰æ‹© Redis Cluster å®˜æ–¹çš„é›†ç¾¤æ–¹æ¡ˆã€‚<br><br>Codis æœ‰ 1024 ä¸ªé€»è¾‘æ§½ Slotï¼Œå®¢æˆ·ç«¯è¯»å–æ—¶ï¼Œä½¿ç”¨ CRC32 ç®—æ³•è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”å¯¹ 1024 å–æ¨¡ï¼Œä½™æ•°å¯¹åº” slot ç¼–å·ï¼Œå†é€šè¿‡ Slot å’Œ server çš„å¯¹åº”å…³ç³»ï¼Œæ‰¾åˆ°æ•°æ®æ‰€åœ¨æœåŠ¡å™¨ã€‚<br><br>æ•°æ®è·¯ç”±è¡¨ç”± Codis dashboard é…ç½®ï¼Œä¿å­˜åœ¨ codis proxy ä¸Šï¼ŒåŒæ—¶ä¹Ÿä¿å­˜åœ¨ Zookeeper ä¸­ã€‚<br><br>Redis Cluster æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ Hash Slotï¼Œé‡‡ç”¨ CRC16 ç®—æ³•è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯¹ 16384 å–æ¨¡ã€‚æ•°æ®è·¯ç”±è¡¨é€šè¿‡å®ä¾‹é—´ç›¸åŒé€šä¿¡ä¼ é€’ï¼Œæ¯ä¸ªå®ä¾‹ä¸Šä¿å­˜ä¸€ä»½ã€‚<br><br>ä»è€å¸ˆçš„æ¨èæ¥çœ‹ï¼Œæ˜¯æ¯”è¾ƒåçˆ± Codis çš„ï¼Œä½†æ˜¯ Codis ä¼¼ä¹ä¸å†æ›´æ–°äº†ã€‚<br><br>å¯¹äºè¯¾åé¢˜ï¼Œ20 ä¸‡ä¸ª 2KB å…ƒç´ çš„ Hash ç±»å‹æ•°æ®ï¼Œåº”è¯¥å·²ç»ç®—æ˜¯ bigkey äº†ï¼Œè¿ç§»è¿™æ ·çš„ Hash é›†åˆæ•°æ®ï¼Œå¦‚æœé‡‡ç”¨ Codis çš„å¼‚æ­¥è¿ç§»ï¼Œæ„Ÿè§‰ä¼¼ä¹é—®é¢˜ä¸å¤§ã€‚å¦‚æœæ˜¯è¯»å¤šå†™å°‘çš„ç¼“å­˜åº”ç”¨ï¼Œåº”è¯¥å°±æ›´æ²¡æœ‰é—®é¢˜äº†ã€‚<br><br>çœ‹äº†è¯¾ä»£è¡¨çš„æé†’ï¼Œæ‰çŸ¥é“ Codis æ˜¯ Go è¯­è¨€å¼€å‘çš„ï¼Œæœ€è¿‘æ­£å‡†å¤‡å…¥å‘ Let&#39;s Go","like_count":3},{"had_liked":false,"id":261162,"user_name":"yeek","can_delete":false,"product_type":"c1","uid":1020629,"ip_address":"","ucode":"A1C71023113CB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/d5/699384a0.jpg","comment_is_top":false,"comment_ctime":1605231911,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14490133799","product_id":100056701,"comment_content":"æœ‰å‡ ä¸ªç–‘é—®ï¼š<br>1ã€å¯¹äºè¿ç§»è¿‡ç¨‹ä¸­ï¼Œcodisçš„åªè¯»ç‰¹æ€§ï¼Œå¯¹äºé›†åˆç±»å‹ï¼Œæ˜¯æ•´ä¸ªkeyåªè¯»ï¼Œè¿˜æ˜¯å·²è¿ç§»çš„éƒ¨åˆ†æ˜¯åªè¯»çš„ï¼›<br>2ã€codisåˆ†æ‰¹è¿ç§»çš„è¿‡æœŸæ—¶é—´æ˜¯æ€ä¹ˆè®¾ç½®çš„ï¼Œå¤ªé•¿ä¼šé•¿æœŸé©»ç•™ï¼Œå¤ªçŸ­ä¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­å¤±æ•ˆä¹ˆï¼Ÿ<br>3ã€codisä½¿ç”¨zkä¿å­˜å¤šproxyä¿¡æ¯ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æœ¬åœ°ä¼šç¼“å­˜å¤šproxyä¿¡æ¯å—ï¼Ÿä»è€Œé€‰æ‹©ä¸åŒproxyè¿›è¡Œè¿æ¥","like_count":3},{"had_liked":false,"id":260562,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1605060842,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"14489962730","product_id":100056701,"comment_content":"è€å¸ˆå¥½~ ç›®å‰å…¬å¸åœ¨ç”¨twemproxyç»´æŠ¤Redisé›†ç¾¤ï¼Œèƒ½ç®€å•å¯¹æ¯”ä¸‹codiså’Œtwemproxyçš„ä¼˜åŠ£å—ï¼Ÿ","like_count":4},{"had_liked":false,"id":265505,"user_name":"zenk","can_delete":false,"product_type":"c1","uid":1013669,"ip_address":"","ucode":"B235D5EBCF49BC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/a5/c5ae871d.jpg","comment_is_top":false,"comment_ctime":1606917833,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"10196852425","product_id":100056701,"comment_content":"åªè¯»æ—¶é—´ä¼šä¸ä¼šå¤ªé•¿å¯¼è‡´keyä¸å¯å†™","like_count":3,"discussions":[{"author":{"id":1036468,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d0/b4/a6c27fd0.jpg","nickname":"John","note":"","ucode":"449164FE4255CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363687,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617262285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275575,"user_name":"æŸ³ç£Š","can_delete":false,"product_type":"c1","uid":1178502,"ip_address":"","ucode":"FC1513ECDA3604","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/86/a380cbad.jpg","comment_is_top":false,"comment_ctime":1611587528,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5906554824","product_id":100056701,"comment_content":"å…³äºâ€œé›†ç¾¤å®¢æˆ·ç«¯éœ€è¦é‡æ–°å¼€å‘å—?â€æœ‰ç‚¹ç–‘é—®ï¼Œè™½ç„¶codis proxy æ˜¯å’Œå•å®ä¾‹å®¢æˆ·ç«¯å…¼å®¹çš„ï¼Œä½†åº”è¯¥ä¸æ”¯æŒcodis proxyçš„HAå§ï¼Ÿæˆ‘çœ‹codiså®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ï¼Œéœ€è¦ä½¿ç”¨Jodis å®¢æˆ·ç«¯ï¼ˆåœ¨Jediså¢åŠ äº†codis proxy HAï¼‰ï¼Œæ‰€ä»¥æˆ‘ç†è§£ç”Ÿäº§çº§çš„ä½¿ç”¨è¿˜æ˜¯éœ€è¦æ¢å®¢æˆ·ç«¯çš„å§ï¼Ÿ<br>","like_count":1,"discussions":[{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377035,"discussion_content":"codis proxyæ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆå®ƒçš„é«˜å¯ç”¨æ€§ç›´æ¥å¤šå‰¯æœ¬éƒ¨ç½²å³å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622470558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354645,"user_name":"é£é¾™","can_delete":false,"product_type":"c1","uid":2276763,"ip_address":"å¹¿ä¸œ","ucode":"EC83FE73985491","user_header":"https://static001.geekbang.org/account/avatar/00/22/bd/9b/366bb87b.jpg","comment_is_top":false,"comment_ctime":1660636470,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660636470","product_id":100056701,"comment_content":"è¿˜æ²¡æœ‰ç”¨è¿‡redis cluster","like_count":0},{"had_liked":false,"id":335773,"user_name":"å€šå¤©ç…§æµ·","can_delete":false,"product_type":"c1","uid":1465407,"ip_address":"","ucode":"84EC611D00C9EC","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/3f/a263f551.jpg","comment_is_top":false,"comment_ctime":1645685113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645685113","product_id":100056701,"comment_content":"redisæŒ‰slotè¿›è¡Œæ•°æ®è¿ç§»æ—¶ï¼Œå¦‚ä½•çŸ¥é“å“ªäº›keyæ˜¯å±äºè¯¥slotçš„å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":334844,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1645153904,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645153904","product_id":100056701,"comment_content":"æ€»æ„Ÿè§‰redis çš„ cluster ä¸é è°±","like_count":0},{"had_liked":false,"id":333469,"user_name":"Geek_064e72","can_delete":false,"product_type":"c1","uid":2900973,"ip_address":"","ucode":"D627BACE46C37C","user_header":"","comment_is_top":false,"comment_ctime":1644375838,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644375838","product_id":100056701,"comment_content":"rediså®¢æˆ·ä¸ç›´æ¥è¿æ¥redis clusterï¼Œè€Œæ˜¯è¿æ¥redis cluster proxyï¼Œ ç”±redis cluster proxyçœŸæ­£è¯·æ±‚åå°çš„redis cluster serverï¼Œå¹¶ä¸”å¤„ç†MOVEDè¯·æ±‚ï¼Œè¿™æ ·åˆæ˜¯ä¸€ç§é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä¸”è¿˜ä¸ç”¨zookeeperäº†ã€‚","like_count":0},{"had_liked":false,"id":331368,"user_name":"Geek_9bd7ef","can_delete":false,"product_type":"c1","uid":2649828,"ip_address":"","ucode":"E68C656EE1EBAC","user_header":"https://static001.geekbang.org/account/avatar/00/28/6e/e4/9901994d.jpg","comment_is_top":false,"comment_ctime":1642563441,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642563441","product_id":100056701,"comment_content":"è¯·é—®ä¸‹ è€å¸ˆ  å…³äº â€åœ¨ Redis Cluster ä¸­ï¼Œæ•°æ®è·¯ç”±è¡¨æ˜¯é€šè¿‡æ¯ä¸ªå®ä¾‹ç›¸äº’é—´çš„é€šä¿¡ä¼ é€’çš„ï¼Œæœ€åä¼šåœ¨æ¯ä¸ªå®ä¾‹ä¸Šä¿å­˜ä¸€ä»½â€œè¿™é‡Œçš„ è·¯ç”±è¡¨ä¿¡æ¯åœ¨å„ä¸ªå®ä¾‹ä¹‹é—´çš„ä¸€è‡´æ€§æ˜¯æ€ä¹ˆä¿è¯çš„å‘¢~ï¼Ÿ","like_count":0},{"had_liked":false,"id":310071,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1630479242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630479242","product_id":100056701,"comment_content":"æˆ‘è§‰ç€ä¸ä¼šé€ æˆå½±å“,å› ä¸ºåœ¨Codisä¸­,å¯¹äºbigkeyçš„è¿ç§»,æ˜¯å¼‚æ­¥ä¸”æ‹†åˆ†çš„,å°†é›†åˆå¯¹è±¡æ‹†åˆ†ä¸ºæ›´ä¸ºç»†ç²’åº¦çš„å•ä¸ªå¯¹è±¡è¿›è¡Œä¼ è¾“,é¿å…äº†ä¼ è¾“è¿‡ç¨‹ä¸­çš„é˜»å¡é—®é¢˜","like_count":0},{"had_liked":false,"id":296302,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1622891392,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622891392","product_id":100056701,"comment_content":"åŸæ–‡ï¼š<br>æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬è¦è¿ç§»ä¸€ä¸ªæœ‰ 1 ä¸‡ä¸ªå…ƒç´ çš„ List ç±»å‹æ•°æ®ï¼Œå½“ä½¿ç”¨å¼‚æ­¥è¿ç§»æ—¶ï¼Œæº server å°±ä¼šç»™ç›®çš„ server ä¼ è¾“ 1 ä¸‡æ¡ RPUSH å‘½ä»¤ï¼Œæ¯æ¡å‘½ä»¤å¯¹åº”äº† List ä¸­ä¸€ä¸ªå…ƒç´ çš„æ’å…¥ã€‚åœ¨ç›®çš„ server ä¸Šï¼Œè¿™ 1 ä¸‡æ¡å‘½ä»¤å†è¢«ä¾æ¬¡æ‰§è¡Œï¼Œå°±å¯ä»¥å®Œæˆæ•°æ®è¿ç§»ã€‚<br><br>æœ‰2ä¸ªç–‘é—®ï¼š<br>1. æº server å¦‚ä½•ç¡®è®¤ bigkey è¿ç§»å®Œæˆï¼Œç„¶ååˆ é™¤ bigkeyï¼Ÿ<br>æ–‡ç« æåˆ°ï¼Œåœ¨è¿ç§»å®Œæˆä¹‹å‰ï¼Œåœ¨ç›®æ ‡ server çš„ä¸­é—´çŠ¶æ€çš„æ•°æ®ï¼Œæ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œå› æ­¤ä¸å¯èƒ½è¿ç§» bigkey ä¸€ä¸ªå…ƒç´ ï¼Œå°±åœ¨æº server åˆ é™¤ bigkey å¯¹åº”çš„å…ƒç´ ã€‚<br>å°±ä¸Šè¿°ä¾‹å­ï¼Œåº”è¯¥æ˜¯æº server åœ¨è‡ªè¡Œç»´æŠ¤ä¸€ä¸‡æ¡å‘½ä»¤çš„ ackï¼Œåˆ¤æ–­ ack çš„æ•°é‡å’Œè¿ç§»å‘½ä»¤æ•°é‡ä¸€è‡´ï¼Œåˆ™è®¤ä¸º bigkey è¿ç§»å®Œæˆã€‚æ˜¯è¿™æ ·ä¹ˆï¼Ÿ<br><br>2. è¿™ä¸€ä¸‡æ¡ RPUSH å‘½ä»¤ï¼Œå¦‚ä½•ä¿è¯é¡ºåºå–ï¼Œå³è¿ç§»ä¹‹åï¼ŒList é“¾è¡¨å…ƒç´ çš„é¡ºåºå’Œè¿ç§»ä¹‹å‰æ˜¯ä¸€è‡´çš„ï¼Ÿ<br>è¿™ä¸€ä¸‡æ¡å‘½ä»¤å¯¹åº”ä¸€ä¸‡æ¬¡ requestï¼Œæ¯”å¦‚å…¶ä¸­ä¸€ä¸ª request ç½‘ç»œå»¶è¿Ÿï¼Œåé¢çš„ request å…ˆåˆ°è¾¾ç›®çš„ serverã€‚<br>è¿˜æ˜¯è¯´å¿…é¡»è¦ç­‰å‰é¢å‘½ä»¤çš„ request ack åï¼Œæ‰å‘é€ä¸‹ä¸€æ¡ RPUSH å‘½ä»¤çš„ request è¯·æ±‚ï¼Ÿ<br><br>è°¢è°¢è€å¸ˆï¼ï¼","like_count":0},{"had_liked":false,"id":295883,"user_name":"BertGeek","can_delete":false,"product_type":"c1","uid":1452799,"ip_address":"","ucode":"8E1D72C9F9778C","user_header":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","comment_is_top":false,"comment_ctime":1622629489,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622629489","product_id":100056701,"comment_content":"è¯·é—®è€å¸ˆï¼Œcodiesæ•°æ®è¿ç§»ï¼Œå°†binkeyæ‹†åˆ†ä»¥å…ƒç´ è¿ç§»ï¼Œæ˜¯æ•´ä¸ªbinkeyè¿ç§»å®Œå°±å¯ä»¥è¯»å†™ï¼Œè¿˜æ˜¯è¯´ï¼Œè¿ç§»ä¸€éƒ¨åˆ†å°±å¯ä»¥å†ç›®æ ‡serverè®¿é—®ï¼Œè¿”å›ackï¼Œåˆ é™¤binkey è¿ç§»è¿‡çš„å…ƒç´ ä¿¡æ¯","like_count":0},{"had_liked":false,"id":295323,"user_name":"Geek_7bb784","can_delete":false,"product_type":"c1","uid":2063920,"ip_address":"","ucode":"5DF4B955A266F3","user_header":"","comment_is_top":false,"comment_ctime":1622365123,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1622365123","product_id":100056701,"comment_content":"redis clusteræœ‰16384ä¸ªslotï¼Œcodisæœ‰1024ä¸ªã€‚ç›¸åŒæ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œclusterä¸­æ¯ä¸ªslotä¸­çš„æ•°æ®é‡æ›´å°ï¼Œåœ¨æ•°æ®è¿ç§»çš„æ—¶å€™éš¾é“ä¸æ¯”codisæ›´æœ‰æ•ˆç‡å˜›ï¼Ÿ<br><br>ä½œè€…æ˜¯å¦å¯ä»¥æä¾›ç›¸åŒæ•°æ®é‡æƒ…å†µä¸‹ï¼Œcodisæ‰©å®¹å’Œclusteræ‰©å®¹çš„æ€§èƒ½å¯¹æ¯”æ•°æ®å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2450893,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/L8EpqHoAnmvkzCIsdOkv5QvhIzu5tMaF2FDusXShqukv5ZBkS8DbicWaErjnYydibiaqBrs70wQ8P6axvC2FbWpbQ/132","nickname":"Geek_d3928c","note":"","ucode":"7CB09FD1F7CB23","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386876,"discussion_content":"ä¸€ä¸ªredis-serverå¯èƒ½æœ‰å¤šä¸ªæ§½å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627872107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291573,"user_name":"Super~çªçª","can_delete":false,"product_type":"c1","uid":1039225,"ip_address":"","ucode":"5A0FCD19B24EAF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/db/79/9426c6ce.jpg","comment_is_top":false,"comment_ctime":1620370599,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1620370599","product_id":100056701,"comment_content":"è€å¸ˆæˆ‘çœ‹è¿™ä¸ªcodis ç°åœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¹Ÿæ˜¯åœ¨2018å¹´ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ä¸æ˜¯å·²ç»è¢«æ”¾å¼ƒäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1050993,"avatar":"https://static001.geekbang.org/account/avatar/00/10/09/71/b6638c96.jpg","nickname":"æŒ¤æŒ¤","note":"","ucode":"38135B9453E597","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396024,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632382234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277454,"user_name":"Geek_8cf0a3","can_delete":false,"product_type":"c1","uid":2109366,"ip_address":"","ucode":"D1ACDE82193AA2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLn1rhQ7nlmQgyEZhgfgH0s9BicusXhTG7J6Tcxib2oDVoKVTbia9CcNIkicj2L2a2xqQRicF4FhPepjqA/132","comment_is_top":false,"comment_ctime":1612420464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612420464","product_id":100056701,"comment_content":"æ•°æ®è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªslotä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®åœ¨æ–°serverï¼Œå¦ä¸€éƒ¨åˆ†åœ¨æ—§serverï¼Œproxyå¦‚æœæ¥åˆ°å¯¹è¿™ä¸ªslotä¸­çš„æ•°æ®çš„è¯»å–è¯·æ±‚ï¼Œæ€ä¹ˆçŸ¥é“æ•°æ®åœ¨å“ªä¸ªserveré‡Œï¼Ÿ","like_count":0},{"had_liked":false,"id":267173,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1607618689,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1607618689","product_id":100056701,"comment_content":"è€å¸ˆ æˆ‘åƒé—®ä¸€ä¸‹codisé›†ç¾¤çš„å…¥å£ç½‘å…³åœ¨å“ªï¼Ÿproxyä¸æ˜¯å¯ä»¥æœ‰å¤šä¸ª,é…ç½®å“ªä¸ª?","like_count":0,"discussions":[{"author":{"id":2246468,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLznbabggYaVjEDuGIsSdFvblfULWicTQAK1PKicYD8e2dlAeua1Ryibc8PCkhq6jXJ4YzUryayg7Ejw/132","nickname":"å¤©æµ·æ™´ç©º","note":"","ucode":"7A17B3C01A56B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333990,"discussion_content":"è¿™ä¸ªé—®é¢˜å°±åƒæ˜¯nginxé›†ç¾¤ä»£ç†ä¸€æ ·ï¼Œä½ æ˜¯æ€ä¹ˆé…ç½®çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607685866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263216,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1606049299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606049299","product_id":100056701,"comment_content":"é‡‡ç”¨å¼‚æ­¥è¿ç§»å½±å“ä¸å¤§ï¼Œé‡‡ç”¨åŒæ­¥è¿ç§»ä¼šæœ‰å½±å“","like_count":0},{"had_liked":false,"id":261218,"user_name":"çƒ«çƒ«çƒ«","can_delete":false,"product_type":"c1","uid":1386818,"ip_address":"","ucode":"C06018670DE76A","user_header":"https://static001.geekbang.org/account/avatar/00/15/29/42/43d4b1a8.jpg","comment_is_top":false,"comment_ctime":1605242455,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1605242455","product_id":100056701,"comment_content":"æˆ‘è§‰å¾—ä¼šæœ‰å½±å“ã€‚æ¯ä¸ªHashé›†åˆå…ƒç´ æ•°é‡ä»¥15ä¸‡æ¥ç®—ï¼Œåˆ™å¤§å°ä¸º 15w * 2KB = 300MBï¼Œå¦‚æœæ˜¯åƒå…†ç½‘ï¼Œè€—æ—¶çº¦300 &#47; (1000 &#47; 8) â‰ˆ 2.4sã€‚å°½ç®¡è¿ç§»æ—¶bigkeyä¼šè¢«æ‹†åˆ†ä¼ è¾“ï¼Œä½†ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®æ˜¯åªè¯»çš„ï¼Œå†™æ“ä½œè¿˜æ˜¯ä¼šè¢«é˜»å¡ï¼Œæ‰€ä»¥ä¼šæœ‰å½±å“ã€‚","like_count":1,"discussions":[{"author":{"id":1718746,"avatar":"","nickname":"æ—æ–°æ½œ","note":"","ucode":"386EA326AD1009","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348671,"discussion_content":"æˆ‘ä¹Ÿè§‰å¾—è¿™æ ·ï¼Œå†™æ“ä½œåº”è¯¥è¿˜æ˜¯ä¼šé˜»å¡åˆ°å…¨éƒ¨è¿ç§»å®Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612674645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203114,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5b/aa/777d7f88.jpg","nickname":"è°è°","note":"","ucode":"9651913B7B7ECC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332397,"discussion_content":"bigkeyä¸ä¼šä¸€ä¸‹éƒ½å‘è¿‡å»ï¼Œæ˜¯åˆ†æ‹†å¼€å‘çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä½ è¯´çš„å¤§keyé˜»å¡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607179728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261019,"user_name":"å€ªå¤§äºº","can_delete":false,"product_type":"c1","uid":1193052,"ip_address":"","ucode":"4798D69F3E86FB","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg","comment_is_top":false,"comment_ctime":1605174245,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605174245","product_id":100056701,"comment_content":"â€œç¬¬äºŒä¸ªç‰¹ç‚¹æ˜¯ï¼Œå¯¹äº bigkeyï¼Œå¼‚æ­¥è¿ç§»é‡‡ç”¨äº†æ‹†åˆ†æŒ‡ä»¤çš„æ–¹å¼è¿›è¡Œè¿ç§»ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œå¯¹ bigkey ä¸­æ¯ä¸ªå…ƒç´ ï¼Œç”¨ä¸€æ¡æŒ‡ä»¤è¿›è¡Œè¿ç§»ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ª bigkey è¿›è¡Œåºåˆ—åŒ–åå†æ•´ä½“ä¼ è¾“ã€‚â€<br><br>æ±‚é—®è€å¸ˆï¼Œæ‹†åˆ†è¿ç§»bigKeyçš„æ—¶å€™ï¼Œæºserverä¸Šçš„è¿™ä¸ªkeyæ˜¯ä¸æ˜¯ä¹Ÿæ˜¯åªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Ÿ<br>å¦‚æœæ˜¯çš„è¯ï¼Œé‚£è¿ç§»çš„è¿‡ç¨‹ä¸­è¿™ä¸ªkeyçš„ä¿®æ”¹è¯·æ±‚ä¼šè¢«é˜»å¡ï¼Œæ€§èƒ½ä¼šå—åˆ°å½±å“ï¼Ÿ<br>å¦‚æœä¸æ˜¯çš„è¯ï¼Œæ€ä¹ˆä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":260636,"user_name":"snailshen","can_delete":false,"product_type":"c1","uid":1436839,"ip_address":"","ucode":"C4875C476649B1","user_header":"https://static001.geekbang.org/account/avatar/00/15/ec/a7/7d44c655.jpg","comment_is_top":false,"comment_ctime":1605075759,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1605075759","product_id":100056701,"comment_content":"è€å¸ˆï¼Œcodisçš„keyå’Œslotçš„æ˜ å°„æ˜¯crc16,å¹¶ä¸”zookeeperä¿å­˜çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œåªæ˜¯proxyçš„ä¿¡æ¯ï¼Œå¹¶ä¸å­˜å‚¨slotä¿¡æ¯å§","like_count":0,"discussions":[{"author":{"id":1476323,"avatar":"https://static001.geekbang.org/account/avatar/00/16/86/e3/a31f6869.jpg","nickname":"î‡ å°¿å¸ƒ","note":"","ucode":"D1C8BDA7540962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324660,"discussion_content":"æœ‰å¾…æ±‚è¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605149272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260622,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1605072643,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"1605072643","product_id":100056701,"comment_content":"é€šè¿‡å­¦å®Œè¿™ç¯‡æ–‡ç« ï¼Œä¸ªäººæ„Ÿè§‰é›†ç¾¤æ›´å€¾å‘äº Codis","like_count":0,"discussions":[{"author":{"id":1675882,"avatar":"https://static001.geekbang.org/account/avatar/00/19/92/6a/dd37a054.jpg","nickname":"å¼ y .","note":"","ucode":"85918469492F4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413345,"discussion_content":"éƒ½ä¸ç»´æŠ¤äº†ï¼Œç°åœ¨ç›´æ¥ä¸Š é›†ç¾¤ç‰ˆ Rediså°±è¡Œäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636452327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121697,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/a1/41f4b0af.jpg","nickname":"ç§‹","note":"","ucode":"CD86105A68D625","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343081,"discussion_content":"ç‰ˆæœ¬é—®é¢˜æ€ä¹ˆè§£å†³å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610939612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}