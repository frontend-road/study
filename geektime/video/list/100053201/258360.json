{"id":258360,"title":"28 | 应用：使用TensorFlow 2训练RetinaNet","content":"<h1>课件和 Demo 地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/experts\">https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/experts</a></p>","comments":[{"had_liked":false,"id":237969,"user_name":"子曰","can_delete":false,"product_type":"c3","uid":1161256,"ip_address":"","ucode":"34127192DD8876","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/28/8c83d109.jpg","comment_is_top":false,"comment_ctime":1596016621,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"最新的的Keras 版本 keras.optimizers.adam 改为 keras.optimizers.Adam了\ntrain.py中的一处修改","like_count":2},{"had_liked":false,"id":385535,"user_name":"刘勇","can_delete":false,"product_type":"c3","uid":1590033,"ip_address":"广东","ucode":"D38D925FB932E0","user_header":"https://static001.geekbang.org/account/avatar/00/18/43/11/5e221c05.jpg","comment_is_top":false,"comment_ctime":1702892522,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"训练好的h5模型能否提供？这样就可以不用等结果，继续后面的内容了。\nabu820@qq.com","like_count":0},{"had_liked":false,"id":371314,"user_name":"李增阳","can_delete":false,"product_type":"c3","uid":3572750,"ip_address":"北京","ucode":"8DD15137CB268C","user_header":"","comment_is_top":false,"comment_ctime":1679795842,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"请问老师，训练模型阶段，这个问题怎么解决: File &quot;&#47;tensorflow_python&#47;workspace&#47;tensorflow-101-master&#47;experts&#47;code_sample&#47;chapter-456&#47;keras-retinanet&#47;keras_retinanet&#47;bin&#47;..&#47;..&#47;keras_retinanet&#47;models&#47;resnet.py&quot;, line 37, in retinanet\n    return resnet_retinanet(*args, backbone=self.backbone, **kwargs)\n  File &quot;&#47;tensorflow_python&#47;workspace&#47;tensorflow-101-master&#47;experts&#47;code_sample&#47;chapter-456&#47;keras-retinanet&#47;keras_retinanet&#47;bin&#47;..&#47;..&#47;keras_retinanet&#47;models&#47;resnet.py&quot;, line 98, in resnet_retinanet\n    resnet = keras_resnet.models.ResNet50(inputs, include_top=False, freeze_bn=True)\n  File &quot;&#47;home&#47;ps&#47;anaconda3&#47;envs&#47;tf2_gpu&#47;lib&#47;python3.8&#47;site-packages&#47;keras_resnet&#47;models&#47;_2d.py&quot;, line 233, in __init__\n    super(ResNet2D50, self).__init__(\n  File &quot;&#47;home&#47;ps&#47;anaconda3&#47;envs&#47;tf2_gpu&#47;lib&#47;python3.8&#47;site-packages&#47;keras_resnet&#47;models&#47;_2d.py&quot;, line 76, in __init__\n    x = keras.layers.Conv2D(64, (7, 7), strides=(2, 2), use_bias=False, name=&quot;conv1&quot;, padding=&quot;same&quot;)(inputs)\n  File &quot;&#47;home&#47;ps&#47;anaconda3&#47;envs&#47;tf2_gpu&#47;lib&#47;python3.8&#47;site-packages&#47;keras&#47;backend&#47;tensorflow_backend.py&quot;, line 75, in symbolic_fn_wrapper\n    return func(*args, **kwargs)\n  File &quot;&#47;home&#47;ps&#47;anaconda3&#47;envs&#47;tf2_gpu&#47;lib&#47;python3.8&#47;site-packages&#47;keras&#47;engine&#47;base_layer.py&quot;, line 446, in __call__\n    self.assert_input_compatibility(inputs)\n  File &quot;&#47;home&#47;ps&#47;anaconda3&#47;envs&#47;tf2_gpu&#47;lib&#47;python3.8&#47;site-packages&#47;keras&#47;engine&#47;base_layer.py&quot;, line 312, in assert_input_compatibility\n    raise ValueError(&#39;Layer &#39; + self.name + &#39; was called with &#39;\nValueError: Layer conv1 was called with an input that isn&#39;t a symbolic tensor. Received type: &lt;class &#39;tensorflow.python.keras.engine.keras_tensor.KerasTensor&#39;&gt;. Full input: [&lt;KerasTensor: shape=(None, None, None, 3) dtype=float32 (created by layer &#39;input_1&#39;)&gt;]. All inputs to the layer should be tensors.","like_count":0},{"had_liked":false,"id":347424,"user_name":"赵启明","can_delete":false,"product_type":"c3","uid":3012204,"ip_address":"","ucode":"96AFD073DCF129","user_header":"","comment_is_top":false,"comment_ctime":1654006041,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"Traceback (most recent call last):\n  File &quot;keras-retinanet&#47;keras-retinanet&#47;keras_retinanet&#47;bin&#47;train.py&quot;, line 34, in &lt;module&gt;\n    from .. import layers  # noqa: F401\n  File &quot;keras-retinanet&#47;keras-retinanet&#47;keras_retinanet&#47;bin\\..\\..\\keras_retinanet\\layers\\__init__.py&quot;, line 1, in &lt;module&gt;\n    from ._misc import RegressBoxes, UpsampleLike, Anchors, ClipBoxes  # noqa: F401\n  File &quot;keras-retinanet&#47;keras-retinanet&#47;keras_retinanet&#47;bin\\..\\..\\keras_retinanet\\layers\\_misc.py&quot;, line 20, in &lt;module&gt;\n    from ..utils import anchors as utils_anchors\n  File &quot;keras-retinanet&#47;keras-retinanet&#47;keras_retinanet&#47;bin\\..\\..\\keras_retinanet\\utils\\anchors.py&quot;, line 20, in &lt;module&gt;\n    from ..utils.compute_overlap import compute_overlap\nImportError: DLL load failed: 找不到指定的模块。\n老师能帮看看什么问题吗","like_count":0},{"had_liked":false,"id":347422,"user_name":"赵启明","can_delete":false,"product_type":"c3","uid":3012204,"ip_address":"","ucode":"96AFD073DCF129","user_header":"","comment_is_top":false,"comment_ctime":1654005444,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"ModuleNotFoundError: No module named &#39;keras_retinanet.utils.compute_overlap&#39;,执行过程中出现这个错误如何解决","like_count":0},{"had_liked":false,"id":251264,"user_name":"Phil","can_delete":false,"product_type":"c3","uid":2033590,"ip_address":"","ucode":"C81C6A48E8C2DD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/07/b6/d35ef85c.jpg","comment_is_top":false,"comment_ctime":1601444788,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"老师，用NVIDIA Quadro P620训练显示内存不足，该怎么处理，GPU内存是2G的","like_count":0},{"had_liked":false,"id":241308,"user_name":"Chandler","can_delete":false,"product_type":"c3","uid":1440896,"ip_address":"","ucode":"A6D97CFF01FF70","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/80/4d1369bc.jpg","comment_is_top":false,"comment_ctime":1597243421,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"请问老师，怎么讲keras_retinanet 训练出来的h5转化为tflite?\n\nmodel = tf.keras.models.load_model(&#39;models&#47;resnet50_csv_02.h5&#39;)\nconverter = tf.lite.TFLiteConverter.from_keras_model(model)\ntflite_model = converter.convert()\nopen(&quot;converted_model.tflite&quot;, &quot;wb&quot;).write(tflite_model)\n\n这段代码会报TypeError: (&#39;Keyword argument not understood:&#39;, &#39;freeze&#39;) 错误","like_count":0},{"had_liked":false,"id":239454,"user_name":"Mr. Z","can_delete":false,"product_type":"c3","uid":1145108,"ip_address":"","ucode":"D5EE1168215783","user_header":"https://static001.geekbang.org/account/avatar/00/11/79/14/bfeae652.jpg","comment_is_top":false,"comment_ctime":1596535565,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"在train_info里报了一个这样的错误,ValueError: invalid CSV class file: data&#47;baijiu\\class.csv: line 2: format should be &#39;class_name,class_id&#39; 找了很久没找到怎么解决","like_count":0,"discussions":[{"author":{"id":1440896,"avatar":"https://static001.geekbang.org/account/avatar/00/15/fc/80/4d1369bc.jpg","nickname":"Chandler","note":"","ucode":"A6D97CFF01FF70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298068,"discussion_content":"查一下是不是生成的数据多了一行空格，将gen_csv.py中的open(class_csv_path, &#34;w&#34;） 改成 open(class_csv_path, &#34;w&#34;, newline=&#39;&#39;) 就可以了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597160673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237965,"user_name":"子曰","can_delete":false,"product_type":"c3","uid":1161256,"ip_address":"","ucode":"34127192DD8876","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/28/8c83d109.jpg","comment_is_top":false,"comment_ctime":1596015207,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"最新版本里好像找不到 keras.initializers.normal，官方文档中给到的是initializers.RandomNormal","like_count":0},{"had_liked":false,"id":234164,"user_name":"小黑🐷","can_delete":false,"product_type":"c3","uid":1991504,"ip_address":"","ucode":"08A8C68801EFE9","user_header":"https://static001.geekbang.org/account/avatar/00/1e/63/50/3efb3dba.jpg","comment_is_top":false,"comment_ctime":1594607786,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100053201,"comment_content":"老师，关于RetinaNet的训练出现一个error，安装github上测试的例子，“ResNet-50-model.keras.h5”已下载并放在当前目录，进入python命令行，执行如下：\nfrom keras_retinanet.models import load_model\nmodel = load_model(&#39;ResNet-50-model.keras.h5&#39;,backbone_name=&#39;resnet50&#39;)\n报：\n    &#47;root&#47;.local&#47;lib&#47;python3.7&#47;site-packages&#47;keras_resnet&#47;layers&#47;_batch_normalization.py:17 call  *\n        return super(BatchNormalization, self).call(training=(not self.freeze), *args, **kwargs)\n\n    TypeError: type object got multiple values for keyword argument &#39;training&#39;","like_count":0,"discussions":[{"author":{"id":1082951,"avatar":"https://static001.geekbang.org/account/avatar/00/10/86/47/e40e3a70.jpg","nickname":"李维靖","note":"","ucode":"537E1DF61A34A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295160,"discussion_content":"版本的问题，tensorflow==2.2.0， keras==2.3.1，就可以正常执行了","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1596107053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234129,"user_name":"@.@","can_delete":false,"product_type":"c3","uid":1244750,"ip_address":"","ucode":"6E45DD91FC9150","user_header":"https://static001.geekbang.org/account/avatar/00/12/fe/4e/176c7eab.jpg","comment_is_top":false,"comment_ctime":1594602008,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100053201,"comment_content":"老师，能不能说下之前提的那个如果某个类别检测效果比较差，如何对这个类别数据做二次训练的具体流程方法。假如我有10个类别其中两个效果比较差，那我在当前模型的基础上单独训练这两个类别的数据，我训练完后，是不是还要切回到10个类别的数据再去训练几轮，然后这个模型才能用。","like_count":0}]}