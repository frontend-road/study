{"id":213872,"title":"17  | Hashicorp Raftï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•è·¨è¿‡ç†è®ºå’Œä»£ç ä¹‹é—´çš„é¸¿æ²Ÿï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éŸ©å¥ã€‚</p><p>å¾ˆå¤šåŒå­¦åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰è¿™æ ·çš„æ„Ÿè§‰ï¼šæ˜æ˜è‡ªå·±çœ‹äº†å¾ˆå¤šèµ„æ–™ï¼ŒæŒæ¡äº†æŠ€æœ¯èƒŒåçš„åŸç†ï¼Œå¯åœ¨å¼€å‘å’Œè°ƒè¯•çš„æ—¶å€™è¿˜æ˜¯å¾ˆåƒåŠ›ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸ºç†è®ºå’Œå®è·µæœ¬æ¥å°±æ˜¯ä¸¤å›äº‹ï¼Œå®è·µä¸ä»…éœ€è¦æŒæ¡APIæ¥å£çš„ç”¨æ³•ï¼Œè¿˜éœ€è¦ç†è§£APIèƒŒåçš„ä»£ç å®ç°ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨Raftå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶å€™ï¼Œä»…ä»…é˜…è¯»Raftè®ºæ–‡æˆ–è€…Raftå®ç°çš„APIæ‰‹å†Œï¼Œæ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚ä½ è¿˜è¦åƒé€APIèƒŒåçš„ä»£ç å®ç°ï¼Œâ€œä¸ä»…çŸ¥å…¶ç„¶ï¼Œä¹Ÿè¦çŸ¥å…¶æ‰€ä»¥ç„¶â€ï¼Œè¿™æ ·æ‰èƒ½â€œä¸€åˆ‡å°½åœ¨æŒæ¡ä¸­â€ï¼Œä»è€Œå¼€å‘å®ç°èƒ½ç¨³å®šè¿è¡Œçš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚é‚£ä¹ˆæ€ä¹ˆåšæ‰èƒ½åƒé€Raftçš„ä»£ç å®ç°å‘¢ï¼Ÿ</p><p>è¦çŸ¥é“ï¼Œä»»ä½•Raftå®ç°éƒ½æ‰¿è½½äº†ä¸¤ä¸ªç›®æ ‡ï¼šå®ç°Raftç®—æ³•çš„åŸç†ï¼Œè®¾è®¡æ˜“ç”¨çš„APIæ¥å£ã€‚æ‰€ä»¥ï¼Œä½ ä¸ä»…è¦ä»ç®—æ³•åŸç†çš„è§’åº¦ç†è§£ä»£ç å®ç°ï¼Œè€Œä¸”è¦ä»åœºæ™¯ä½¿ç”¨çš„è§’åº¦ç†è§£APIæ¥å£çš„ç”¨æ³•ã€‚</p><p>è€Œæˆ‘ä¼šç”¨ä¸¤èŠ‚è¯¾çš„æ—¶é—´ï¼Œ<strong>ä»ä»£ç å®ç°å’Œæ¥å£ä½¿ç”¨ä¸¤ä¸ªè§’åº¦ï¼Œ</strong>å¸¦ä½ å¾ªåºæ¸è¿›åœ°æŒæ¡å½“å‰æµè¡Œçš„ä¸€ä¸ªRaftå®ç°ï¼š<a href=\"https://github.com/hashicorp/raft\">Hashicorp Raft</a>ï¼ˆä»¥æœ€æ–°ç¨³å®šç‰ˆv1.1.1ä¸ºä¾‹ï¼‰ã€‚å¸Œæœ›ä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é›†ä¸­æ³¨æ„åŠ›ï¼Œå‹¾åˆ’é‡ç‚¹ï¼Œä»¥ä¾¿æé«˜å­¦ä¹ æ•ˆç‡ï¼Œåƒé€åŸç†å¯¹åº”çš„æŠ€æœ¯å®ç°ï¼Œå½»åº•æŒæ¡Raftç®—æ³•çš„å®æˆ˜æŠ€å·§ã€‚</p><p>æœ¬èŠ‚è¯¾ï¼Œæˆ‘ä¼šä»ç®—æ³•åŸç†çš„è§’åº¦ï¼ŒèŠä¸€èŠRaftç®—æ³•çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆé¢†å¯¼è€…é€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶ï¼‰åœ¨Hashicorp Raftä¸­æ˜¯å¦‚ä½•å®ç°çš„ã€‚ï¼ˆå¦‚æœRaftç®—æ³•çš„åŸç†ä½ å·²ç»å¿˜å¾—å·®ä¸å¤šäº†ï¼Œé‚£ä½ å¯ä»¥å…ˆå›é¡¾ä¸‹7ï½9è®²ï¼ŒåŠ æ·±å°è±¡ä¹‹åï¼Œå†è¿›å…¥ä»Šå¤©çš„å­¦ä¹ ã€‚ï¼‰</p><!-- [[[read_end]]] --><h2>Hashicorp Raftå¦‚ä½•å®ç°é¢†å¯¼è€…é€‰ä¸¾ï¼Ÿ</h2><p><strong>åœ¨æˆ‘çœ‹æ¥ï¼Œé˜…è¯»æºç çš„å…³é”®ï¼Œåœ¨äºæ‰¾åˆ°ä»£ç çš„å…¥å£å‡½æ•°ï¼Œ</strong>æ¯”å¦‚åœ¨Golangä»£ç ä¸­ï¼Œç¨‹åºçš„å…¥å£å‡½æ•°ä¸€èˆ¬ä¸ºmain()å‡½æ•°ï¼Œé‚£ä¹ˆé¢†å¯¼è€…é€‰ä¸¾çš„å…¥å£å‡½æ•°æ˜¯å“ªä¸ªå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå…¸å‹çš„é¢†å¯¼è€…é€‰ä¸¾åœ¨æœ¬è´¨ä¸Šæ˜¯èŠ‚ç‚¹çŠ¶æ€çš„å˜æ›´ã€‚å…·ä½“åˆ°Hashicorp Raftæºç ä¸­ï¼Œé¢†å¯¼è€…é€‰ä¸¾çš„å…¥å£å‡½æ•°run()ï¼Œåœ¨raft.goä¸­ä»¥ä¸€ä¸ªå•ç‹¬çš„åç¨‹è¿è¡Œï¼Œæ¥å®ç°èŠ‚ç‚¹çŠ¶æ€å˜è¿ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ï¼š</p><pre><code>func (r *Raft) run() {\n        for {\n                select {\n                // å…³é—­èŠ‚ç‚¹\n                case &lt;-r.shutdownCh:\n                        r.setLeader(&quot;&quot;)\n                        return\n                default:\n                }\n\n                switch r.getState() {\n                // è·Ÿéšè€…\n                case Follower:\n                        r.runFollower()\n                // å€™é€‰äºº\n                case Candidate:\n                        r.runCandidate()\n                // é¢†å¯¼è€…\n                case Leader:\n                        r.runLeader()\n                }\n        }\n}\n</code></pre><p>ä»ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œä½ èƒ½çœ‹åˆ°ï¼ŒFollowerï¼ˆè·Ÿéšè€…ï¼‰ã€Candidateï¼ˆå€™é€‰äººï¼‰ã€Leaderï¼ˆé¢†å¯¼è€…ï¼‰ä¸‰ä¸ªèŠ‚ç‚¹çŠ¶æ€å¯¹åº”çš„åŠŸèƒ½ï¼Œéƒ½è¢«æŠ½è±¡æˆä¸€ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯runFollower()ã€runCandidate()å’ŒrunLeader()ã€‚</p><h3>æ•°æ®ç»“æ„</h3><p>åœ¨<a href=\"https://time.geekbang.org/column/article/204472\">07è®²</a>ä¸­ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ äº†èŠ‚ç‚¹çŠ¶æ€ï¼Œä¸è¿‡ä¸»è¦ä¾§é‡ç†è§£èŠ‚ç‚¹çŠ¶æ€çš„åŠŸèƒ½ä½œç”¨ï¼ˆæ¯”å¦‚è¯´ï¼Œè·Ÿéšè€…ç›¸å½“äºæ™®é€šç¾¤ä¼—ï¼Œé¢†å¯¼è€…æ˜¯éœ¸é“æ€»è£ï¼‰ï¼Œå¹¶æ²¡æœ‰å…³æ³¨å®ƒåœ¨å®é™…ä»£ç ä¸­æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨Hashicorp Raftä¸­æ˜¯å¦‚ä½•å®ç°èŠ‚ç‚¹çŠ¶æ€çš„ã€‚</p><p>èŠ‚ç‚¹çŠ¶æ€ç›¸å…³çš„æ•°æ®ç»“æ„å’Œå‡½æ•°ï¼Œæ˜¯åœ¨state.goä¸­å®ç°çš„ã€‚è·Ÿéšè€…ã€å€™é€‰äººå’Œé¢†å¯¼è€…çš„3ä¸ªçŠ¶æ€ï¼Œæ˜¯ç”±RaftStateå®šä¹‰çš„ï¼Œä¸€ä¸ªæ— ç¬¦å·32ä½çš„åªè¯»æ•´å‹æ•°å€¼ï¼ˆuint32ï¼‰ï¼š</p><pre><code>type RaftState uint32\nconst (\n        // è·Ÿéšè€…\n        Follower RaftState = iota\n        // å€™é€‰äºº\n        Candidate\n        // é¢†å¯¼è€…\n        Leader\n        // å…³é—­çŠ¶æ€\n        Shutdown\n)\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¹Ÿå­˜åœ¨ä¸€äº›éœ€è¦ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼çš„èŠ‚ç‚¹çŠ¶æ€çš„åœºæ™¯ï¼ˆæ¯”å¦‚æ—¥å¿—è¾“å‡ºï¼‰ï¼Œ</strong>è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨RaftState.String()å‡½æ•°ã€‚</p><p>ä½ åº”è¯¥è¿˜è®°å¾—ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å±äºæœ¬èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ä»»æœŸç¼–å·ï¼‰ï¼Œé‚£ä¹ˆåœ¨ä»£ç ä¸­å¦‚ä½•å®ç°è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿè¿™å°±è¦è¯´åˆ°raftStateæ•°æ®ç»“æ„äº†ã€‚</p><p>raftStateå±äºç»“æ„ä½“ç±»å‹ï¼Œæ˜¯è¡¨ç¤ºèŠ‚ç‚¹ä¿¡æ¯çš„ä¸€ä¸ªå¤§æ•°æ®ç»“æ„ï¼Œé‡Œé¢åŒ…å«äº†åªå±äºæœ¬èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„å½“å‰ä»»æœŸç¼–å·ã€æœ€æ–°æäº¤çš„æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼ã€å­˜å‚¨ä¸­æœ€æ–°æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼å’Œä»»æœŸç¼–å·ã€å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€ç­‰ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ï¼š</p><pre><code>type raftState struct {\n        // å½“å‰ä»»æœŸç¼–å·\n        currentTerm uint64\n\n        // æœ€å¤§è¢«æäº¤çš„æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼\n        commitIndex uint64\n\n        // æœ€æ–°è¢«åº”ç”¨åˆ°çŠ¶æ€æœºçš„æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼\n        lastApplied uint64\n\n        // å­˜å‚¨ä¸­æœ€æ–°çš„æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼å’Œä»»æœŸç¼–å·  \n        lastLogIndex uint64\n        lastLogTerm  uint64\n\n        // å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€\n        state RaftState\n\n        ......\n}\n</code></pre><p>èŠ‚ç‚¹çŠ¶æ€ä¸èŠ‚ç‚¹ä¿¡æ¯çš„å®šä¹‰å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œè¿™é‡Œæˆ‘å°±ä¸å¤šè¯´äº†ã€‚è€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¦å®ç°é¢†å¯¼è€…é€‰ä¸¾ï¼Œæ›´é‡è¦çš„ä¸€å±‚å†…å®¹æ˜¯å®ç°RPCæ¶ˆæ¯ï¼Œå› ä¸ºé¢†å¯¼è€…é€‰ä¸¾çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªRPCé€šè®¯çš„è¿‡ç¨‹ã€‚</p><p>åœ¨ç†è®ºç¯‡ä¸­æˆ‘è¯´è¿‡ï¼ŒRaftç®—æ³•ä¸­æ”¯æŒå¤šç§RPCæ¶ˆæ¯ï¼ˆæ¯”å¦‚è¯·æ±‚æŠ•ç¥¨RPCæ¶ˆæ¯ã€æ—¥å¿—å¤åˆ¶RPCæ¶ˆæ¯ï¼‰ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€çœ‹ï¼Œåœ¨Hashicorp Raftä¸­åˆæ˜¯æ€æ ·å®ç°RPCæ¶ˆæ¯çš„ã€‚åˆå› ä¸ºåœ¨ä¸€ä¸ªRPCæ¶ˆæ¯ä¸­ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†å°±æ˜¯æ¶ˆæ¯çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹RPCæ¶ˆæ¯å¯¹åº”çš„æ•°æ®ç»“æ„ã€‚</p><p>RPCæ¶ˆæ¯ç›¸å…³çš„æ•°æ®ç»“æ„æ˜¯åœ¨commands.goä¸­å®šä¹‰çš„ï¼Œæ¯”å¦‚ï¼Œæ—¥å¿—å¤åˆ¶RPCçš„è¯·æ±‚æ¶ˆæ¯ï¼Œå¯¹åº”çš„æ•°æ®ç»“æ„ä¸ºAppendEntriesRequestã€‚è€ŒAppendEntriesRequestæ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œé‡Œé¢åŒ…å«äº†Raftç®—æ³•è®ºæ–‡ä¸­çº¦å®šçš„å­—æ®µï¼Œæ¯”å¦‚ä»¥ä¸‹è¿™äº›å†…å®¹ã€‚</p><ul>\n<li>Termï¼šå½“å‰çš„ä»»æœŸç¼–å·ã€‚</li>\n<li>PrevLogEntryï¼šè¡¨ç¤ºå½“å‰è¦å¤åˆ¶çš„æ—¥å¿—é¡¹ï¼Œå‰é¢ä¸€æ¡æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼ã€‚</li>\n<li>PrevLogTermï¼šè¡¨ç¤ºå½“å‰è¦å¤åˆ¶çš„æ—¥å¿—é¡¹ï¼Œå‰é¢ä¸€æ¡æ—¥å¿—é¡¹çš„ä»»æœŸç¼–å·ã€‚</li>\n<li>Entriesï¼šæ–°æ—¥å¿—é¡¹ã€‚</li>\n</ul><p>å…·ä½“çš„ç»“æ„ä¿¡æ¯ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ï¼š</p><pre><code>type AppendEntriesRequest struct {\n        // å½“å‰çš„ä»»æœŸç¼–å·ï¼Œå’Œé¢†å¯¼è€…ä¿¡æ¯ï¼ˆåŒ…æ‹¬æœåŠ¡å™¨IDå’Œåœ°å€ä¿¡æ¯ï¼‰\n        Term   uint64\n        Leader []byte\n\n        // å½“å‰è¦å¤åˆ¶çš„æ—¥å¿—é¡¹ï¼Œå‰é¢ä¸€æ¡æ—¥å¿—é¡¹çš„ç´¢å¼•å€¼å’Œä»»æœŸç¼–å·\n        PrevLogEntry uint64\n        PrevLogTerm  uint64\n\n        // æ–°æ—¥å¿—é¡¹\n        Entries []*Log\n\n        // é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šçš„å·²æäº¤çš„æ—¥å¿—é¡¹çš„æœ€å¤§ç´¢å¼•å€¼\n        LeaderCommitIndex uint64\n}\n</code></pre><p>æˆ‘å»ºè®®ä½ å¯ä»¥é‡‡ç”¨ä¸Šé¢çš„æ€è·¯ï¼Œå¯¹ç…§ç€ç®—æ³•åŸç†å»å­¦ä¹ å…¶ä»–RPCæ¶ˆæ¯çš„å®ç°ï¼Œè¿™æ ·ä¸€æ¥ä½ å°±èƒ½æŒæ¡ç‹¬ç«‹å­¦ä¹ çš„èƒ½åŠ›äº†ã€‚å…¶ä»–RPCæ¶ˆæ¯çš„æ•°æ®ç»“æ„æˆ‘å°±ä¸ä¸€ä¸€æè¿°äº†ï¼ˆå¦‚æœä½ é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºç•™è¨€ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»äº†è§£äº†èŠ‚ç‚¹çŠ¶æ€å’ŒRPCæ¶ˆæ¯çš„æ ¼å¼ï¼ŒæŒæ¡äº†è¿™äº›åŸºç¡€çŸ¥è¯†åï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œçœ‹çœ‹åœ¨Hashicorp Raftä¸­æ˜¯å¦‚ä½•è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾çš„ã€‚</p><h3>é€‰ä¸¾é¢†å¯¼è€…</h3><p>é¦–å…ˆï¼Œåœ¨åˆå§‹çŠ¶æ€ä¸‹ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å¤„äºè·Ÿéšè€…çŠ¶æ€ï¼Œå‡½æ•°runFollower()è¿è¡Œï¼Œå¤§è‡´çš„æ‰§è¡Œæ­¥éª¤ï¼Œå°±åƒä¸‹å›¾çš„æ ·å­ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/28/15/28753c692659fa4017c6a943c3d05b15.jpg?wh=1142*723\" alt=\"\"></p><p>æˆ‘å¸¦ä½ èµ°ä¸€éè¿™äº”ä¸ªæ­¥éª¤ï¼Œä¾¿äºä½ åŠ æ·±å°è±¡ã€‚</p><ol>\n<li>æ ¹æ®é…ç½®ä¸­çš„å¿ƒè·³è¶…æ—¶æ—¶é•¿ï¼Œè°ƒç”¨randomTimeout()å‡½æ•°æ¥è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç”¨ä»¥è®¾ç½®å¿ƒè·³è¶…æ—¶æ—¶é—´é—´éš”ã€‚</li>\n<li>è¿›å…¥åˆ°forå¾ªç¯ä¸­ï¼Œé€šè¿‡selectå®ç°å¤šè·¯IOå¤ç”¨ï¼Œå‘¨æœŸæ€§åœ°è·å–æ¶ˆæ¯å’Œå¤„ç†ã€‚å¦‚æœæ­¥éª¤1ä¸­è®¾ç½®çš„å¿ƒè·³è¶…æ—¶æ—¶é—´é—´éš”å‘ç”Ÿäº†è¶…æ—¶ï¼Œæ‰§è¡Œæ­¥éª¤3ã€‚</li>\n<li>å¦‚æœç­‰å¾…å¿ƒè·³ä¿¡æ¯æœªè¶…æ—¶ï¼Œæ‰§è¡Œæ­¥éª¤4ï¼Œå¦‚æœç­‰å¾…å¿ƒè·³ä¿¡æ¯è¶…æ—¶ï¼Œæ‰§è¡Œæ­¥éª¤5ã€‚</li>\n<li>æ‰§è¡Œcontinueè¯­å¥ï¼Œå¼€å§‹ä¸€æ¬¡æ–°çš„forå¾ªç¯ã€‚</li>\n<li>è®¾ç½®èŠ‚ç‚¹çŠ¶æ€ä¸ºå€™é€‰äººï¼Œå¹¶é€€å‡ºrunFollower()å‡½æ•°ã€‚</li>\n</ol><p>å½“èŠ‚ç‚¹æ¨ä¸¾è‡ªå·±ä¸ºå€™é€‰äººä¹‹åï¼Œå‡½æ•°runCandidate()æ‰§è¡Œï¼Œå¤§è‡´çš„æ‰§è¡Œæ­¥éª¤ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/98/4d/989efd10cdff6825356b8a4310e5704d.jpg?wh=1142*784\" alt=\"\"></p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬èµ°ä¸€éè¿™ä¸ªè¿‡ç¨‹ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡ã€‚</p><ol>\n<li>é¦–å…ˆè°ƒç”¨electSelf()å‘èµ·é€‰ä¸¾ï¼Œç»™è‡ªå·±æŠ•ä¸€å¼ é€‰ç¥¨ï¼Œå¹¶å‘å…¶ä»–èŠ‚ç‚¹å‘é€è¯·æ±‚æŠ•ç¥¨RPCæ¶ˆæ¯ï¼Œè¯·æ±‚ä»–ä»¬é€‰ä¸¾è‡ªå·±ä¸ºé¢†å¯¼è€…ã€‚ç„¶åè°ƒç”¨randomTimeout()å‡½æ•°ï¼Œè·å–ä¸€ä¸ªéšæœºå€¼ï¼Œè®¾ç½®é€‰ä¸¾è¶…æ—¶æ—¶é—´ã€‚</li>\n<li>è¿›å…¥åˆ°forå¾ªç¯ä¸­ï¼Œé€šè¿‡selectå®ç°å¤šè·¯IOå¤ç”¨ï¼Œå‘¨æœŸæ€§åœ°è·å–æ¶ˆæ¯å’Œå¤„ç†ã€‚å¦‚æœå‘ç”Ÿäº†é€‰ä¸¾è¶…æ—¶ï¼Œæ‰§è¡Œæ­¥éª¤3ï¼Œå¦‚æœå¾—åˆ°äº†æŠ•ç¥¨ä¿¡æ¯ï¼Œæ‰§è¡Œæ­¥éª¤4ã€‚</li>\n<li>å‘ç°äº†é€‰ä¸¾è¶…æ—¶ï¼Œé€€å‡ºrunCandidate()å‡½æ•°ï¼Œç„¶åå†é‡æ–°æ‰§è¡ŒrunCandidate()å‡½æ•°ï¼Œå‘èµ·æ–°ä¸€è½®çš„é€‰ä¸¾ã€‚</li>\n<li>å¦‚æœå€™é€‰äººåœ¨æŒ‡å®šæ—¶é—´å†…èµ¢å¾—äº†å¤§å¤šæ•°é€‰ç¥¨ï¼Œé‚£ä¹ˆå€™é€‰äººå°†å½“é€‰ä¸ºé¢†å¯¼è€…ï¼Œè°ƒç”¨setState()å‡½æ•°ï¼Œå°†è‡ªå·±çš„çŠ¶æ€å˜æ›´ä¸ºé¢†å¯¼è€…ï¼Œå¹¶é€€å‡ºrunCandidate()å‡½æ•°ã€‚</li>\n</ol><p>å½“èŠ‚ç‚¹å½“é€‰ä¸ºé¢†å¯¼è€…åï¼Œå‡½æ•°runLeader()å°±æ‰§è¡Œäº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/17/3e/17619089bc683d8a1a2bd20bf678503e.jpg?wh=1142*998\" alt=\"\"></p><p>æ•´ä¸ªè¿‡ç¨‹ï¼Œä¸»è¦æœ‰4ä¸ªæ­¥éª¤ã€‚</p><ol>\n<li>è°ƒç”¨startStopReplication()ï¼Œæ‰§è¡Œæ—¥å¿—å¤åˆ¶åŠŸèƒ½ã€‚</li>\n<li>ç„¶åå¯åŠ¨æ–°çš„åç¨‹ï¼Œè°ƒç”¨replicate()å‡½æ•°ï¼Œæ‰§è¡Œæ—¥å¿—å¤åˆ¶åŠŸèƒ½ã€‚</li>\n<li>æ¥ç€åœ¨replicate()å‡½æ•°ä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œè°ƒç”¨heartbeat()å‡½æ•°ï¼Œæ‰§è¡Œå¿ƒè·³åŠŸèƒ½ã€‚</li>\n<li>åœ¨heartbeat()å‡½æ•°ä¸­ï¼Œå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³ä¿¡æ¯ï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹ï¼Œæˆ‘æ˜¯é¢†å¯¼è€…ï¼Œæˆ‘è¿˜æ´»ç€ï¼Œä¸éœ€è¦ä½ ä»¬å‘èµ·æ–°çš„é€‰ä¸¾ã€‚</li>\n</ol><p>å…¶å®ï¼Œåœ¨Hashicorp Raftä¸­å®ç°é¢†å¯¼è€…é€‰ä¸¾å¹¶ä¸éš¾ï¼Œä½ åªè¦å……åˆ†ç†è§£ä¸Šè¿°æ­¥éª¤ï¼Œå¹¶è®°ä½ï¼Œé¢†å¯¼è€…é€‰ä¸¾æœ¬è´¨ä¸Šæ˜¯èŠ‚ç‚¹çŠ¶æ€å˜è¿ï¼Œè·Ÿéšè€…ã€å€™é€‰äººã€é¢†å¯¼è€…å¯¹åº”çš„åŠŸèƒ½å‡½æ•°åˆ†åˆ«ä¸ºrunFollower()ã€runCandidate()ã€runLeader()ï¼Œå°±å¯ä»¥äº†ã€‚</p><h2>Hashicorp Raftå¦‚ä½•å¤åˆ¶æ—¥å¿—ï¼Ÿ</h2><p>å­¦ä¹ <a href=\"https://time.geekbang.org/column/article/205784\">08</a>è®²ä¹‹åï¼Œä½ åº”è¯¥çŸ¥é“äº†æ—¥å¿—å¤åˆ¶çš„é‡è¦æ€§ï¼Œå› ä¸ºRaftæ˜¯åŸºäºå¼ºé¢†å¯¼è€…æ¨¡å‹å’Œæ—¥å¿—å¤åˆ¶ï¼Œæœ€ç»ˆå®ç°å¼ºä¸€è‡´æ€§çš„ã€‚é‚£ä¹ˆä½ è¯¥å¦‚ä½•å­¦ä¹ æ—¥å¿—å¤åˆ¶çš„ä»£ç å®ç°å‘¢ï¼Ÿå’Œå­¦ä¹ â€œå¦‚ä½•å®ç°é¢†å¯¼è€…é€‰ä¸¾â€ä¸€æ ·ï¼Œä½ éœ€è¦å…ˆäº†è§£äº†æ—¥å¿—ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œé˜…è¯»æ—¥å¿—å¤åˆ¶ç›¸å…³çš„ä»£ç ã€‚</p><p>å­¦ä¹ äº†ç†è®ºç¯‡åï¼Œä½ åº”è¯¥è¿˜è®°å¾—æ—¥å¿—å¤åˆ¶æ˜¯ç”±é¢†å¯¼è€…å‘èµ·çš„ï¼Œè·Ÿéšè€…æ¥æ¥æ”¶çš„ã€‚å¯èƒ½æœ‰åŒå­¦å·²ç»æƒ³åˆ°äº†ï¼Œé¢†å¯¼è€…å¤åˆ¶æ—¥å¿—å’Œè·Ÿéšè€…æ¥æ”¶æ—¥å¿—çš„å…¥å£å‡½æ•°ï¼Œåº”è¯¥åˆ†åˆ«åœ¨runLeader()å’ŒrunFollower()å‡½æ•°ä¸­è°ƒç”¨çš„ã€‚èµï¼ç†è§£æ­£ç¡®ï¼</p><ul>\n<li>é¢†å¯¼è€…å¤åˆ¶æ—¥å¿—çš„å…¥å£å‡½æ•°ä¸ºstartStopReplication()ï¼Œåœ¨runLeader()ä¸­ï¼Œä»¥r.startStopReplication()å½¢å¼è¢«è°ƒç”¨ï¼Œä½œä¸ºä¸€ä¸ªå•ç‹¬åç¨‹è¿è¡Œã€‚</li>\n<li>è·Ÿéšè€…æ¥æ”¶æ—¥å¿—çš„å…¥å£å‡½æ•°ä¸ºprocessRPC()ï¼Œåœ¨runFollower()ä¸­ä»¥r.processRPC(rpc)å½¢å¼è¢«è°ƒç”¨ï¼Œæ¥å¤„ç†æ—¥å¿—å¤åˆ¶RPCæ¶ˆæ¯ã€‚</li>\n</ul><p>ä¸è¿‡ï¼Œåœ¨åˆ†ææ—¥å¿—å¤åˆ¶çš„ä»£ç å®ç°ä¹‹å‰ï¼Œå’±ä»¬å…ˆæ¥èŠèŠæ—¥å¿—ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œä¾¿äºä½ æ›´å¥½åœ°ç†è§£ä»£ç å®ç°ã€‚</p><h3>æ•°æ®ç»“æ„</h3><p>08è®²ä¸­æˆ‘æåˆ°è¿‡ï¼Œä¸€æ¡æ—¥å¿—é¡¹ä¸»è¦åŒ…å«äº†3ç§ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯æŒ‡ä»¤ã€ç´¢å¼•å€¼ã€ä»»æœŸç¼–å·ï¼Œè€Œåœ¨Hashicorp Raftå®ç°ä¸­ï¼Œæ—¥å¿—å¯¹åº”çš„æ•°æ®ç»“æ„å’Œå‡½æ•°æ¥å£æ˜¯åœ¨log.goä¸­å®ç°çš„ï¼Œå…¶ä¸­ï¼Œæ—¥å¿—é¡¹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ç»“æ„ä½“ç±»å‹çš„ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ï¼š</p><pre><code>type Log struct {\n        // ç´¢å¼•å€¼\n        Index uint64\n\n        // ä»»æœŸç¼–å·\n        Term uint64\n\n        // æ—¥å¿—é¡¹ç±»åˆ«\n        Type LogType\n\n        // æŒ‡ä»¤\n        Data []byte\n\n        // æ‰©å±•ä¿¡æ¯\n        Extensions []byte\n}\n</code></pre><p>æˆ‘å¼ºè°ƒä¸€ä¸‹ï¼Œä¸åè®®ä¸­çš„å®šä¹‰ä¸åŒï¼Œæ—¥å¿—é¡¹å¯¹åº”çš„æ•°æ®ç»“æ„ä¸­ï¼ŒåŒ…å«äº†LogTypeå’ŒExtensionsä¸¤ä¸ªé¢å¤–çš„å­—æ®µï¼š</p><ul>\n<li>LogTypeå¯ç”¨äºæ ‡è¯†ä¸åŒç”¨é€”çš„æ—¥å¿—é¡¹ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨LogCommandæ ‡è¯†æŒ‡ä»¤å¯¹åº”çš„æ—¥å¿—é¡¹ï¼Œä½¿ç”¨LogConfigurationè¡¨ç¤ºæˆå‘˜å˜æ›´é…ç½®å¯¹åº”çš„æ—¥å¿—é¡¹ã€‚</li>\n<li>Extensionså¯ç”¨äºåœ¨æŒ‡å®šæ—¥å¿—é¡¹ä¸­å­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚<strong>è¿™ä¸ªå­—æ®µä½¿ç”¨çš„æ¯”è¾ƒå°‘ï¼Œåœ¨è°ƒè¯•ç­‰åœºæ™¯ä¸­å¯èƒ½ä¼šç”¨åˆ°ï¼Œä½ çŸ¥é“æœ‰è¿™ä¹ˆä¸ªå­—æ®µå°±å¯ä»¥äº†ã€‚</strong><br>\nè¯´å®Œæ—¥å¿—å¤åˆ¶å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åˆ†æ­¥éª¤çœ‹ä¸€ä¸‹ï¼Œåœ¨Hashicorp Raftä¸­æ˜¯å¦‚ä½•å®ç°æ—¥å¿—å¤åˆ¶çš„ã€‚</li>\n</ul><h3>é¢†å¯¼è€…å¤åˆ¶æ—¥å¿—</h3><p>æ—¥å¿—å¤åˆ¶æ˜¯ç”±é¢†å¯¼è€…å‘èµ·ï¼Œåœ¨runLeader()å‡½æ•°ä¸­æ‰§è¡Œçš„ï¼Œä¸»è¦æœ‰è¿™æ ·å‡ ä¸ªæ­¥éª¤ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c2/63/c2aa9f2c31571e8cdc4dbe13ef210663.jpg?wh=1142*540\" alt=\"\"></p><ol>\n<li>åœ¨ runLeader()å‡½æ•°ä¸­ï¼Œè°ƒç”¨startStopReplication()å‡½æ•°ï¼Œæ‰§è¡Œæ—¥å¿—å¤åˆ¶åŠŸèƒ½ã€‚</li>\n<li>å¯åŠ¨ä¸€ä¸ªæ–°åç¨‹ï¼Œè°ƒç”¨replicate()å‡½æ•°ï¼Œæ‰§è¡Œæ—¥å¿—å¤åˆ¶ç›¸å…³çš„åŠŸèƒ½ã€‚</li>\n<li>åœ¨replicate()å‡½æ•°ä¸­ï¼Œè°ƒç”¨replicateTo()å‡½æ•°ï¼Œæ‰§è¡Œæ­¥éª¤4ï¼Œå¦‚æœå¼€å¯äº†æµæ°´çº¿å¤åˆ¶æ¨¡å¼ï¼Œæ‰§è¡Œæ­¥éª¤5ã€‚</li>\n<li>åœ¨replicateTo()å‡½æ•°ä¸­ï¼Œè¿›è¡Œæ—¥å¿—å¤åˆ¶å’Œæ—¥å¿—ä¸€è‡´æ€§æ£€æµ‹ï¼Œå¦‚æœæ—¥å¿—å¤åˆ¶æˆåŠŸï¼Œåˆ™è®¾ç½®s.allowPipeline = trueï¼Œå¼€å¯æµæ°´çº¿å¤åˆ¶æ¨¡å¼ã€‚</li>\n<li>è°ƒç”¨pipelineReplicate()å‡½æ•°ï¼Œé‡‡ç”¨æ›´é«˜æ•ˆçš„æµæ°´çº¿æ–¹å¼ï¼Œè¿›è¡Œæ—¥å¿—å¤åˆ¶ã€‚</li>\n</ol><p>åœ¨è¿™é‡Œæˆ‘å¼ºè°ƒä¸€ä¸‹ï¼Œåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹å¼€å¯äº†æµæ°´çº¿å¤åˆ¶æ¨¡å¼ï¼Œå¾ˆå¤šåŒå­¦å¯èƒ½ä¼šåœ¨è¿™ä¸€å—å„¿äº§ç”Ÿå›°æƒ‘ï¼Œå› ä¸ºä»£ç é€»è¾‘ä¸Šæœ‰ç‚¹å„¿ç»•ã€‚<strong>ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ˜¯åœ¨ä¸éœ€è¦è¿›è¡Œæ—¥å¿—ä¸€è‡´æ€§æ£€æµ‹ï¼Œå¤åˆ¶åŠŸèƒ½å·²æ­£å¸¸è¿è¡Œçš„æ—¶å€™ï¼Œå¼€å¯äº†æµæ°´çº¿å¤åˆ¶æ¨¡å¼ï¼Œ</strong>ç›®æ ‡æ˜¯åœ¨ç¯å¢ƒæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œæå‡æ—¥å¿—å¤åˆ¶æ€§èƒ½ï¼Œå¦‚æœåœ¨æ—¥å¿—å¤åˆ¶è¿‡ç¨‹ä¸­å‡ºé”™äº†ï¼Œå°±è¿›å…¥RPCå¤åˆ¶æ¨¡å¼ï¼Œç»§ç»­è°ƒç”¨replicateTo()å‡½æ•°ï¼Œè¿›è¡Œæ—¥å¿—å¤åˆ¶ã€‚</p><h3>è·Ÿéšè€…æ¥æ”¶æ—¥å¿—</h3><p>é¢†å¯¼è€…å¤åˆ¶å®Œæ—¥å¿—åï¼Œè·Ÿéšè€…ä¼šæ¥æ”¶æ—¥å¿—å¹¶å¼€å§‹å¤„ç†æ—¥å¿—ã€‚è·Ÿéšè€…æ¥æ”¶å’Œå¤„ç†æ—¥å¿—ï¼Œæ˜¯åœ¨runFollower()å‡½æ•°ä¸­æ‰§è¡Œçš„ï¼Œä¸»è¦æœ‰è¿™æ ·å‡ ä¸ªæ­¥éª¤ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/96/99458f26ef6387bc8b20b16380d46896.jpg?wh=1142*573\" alt=\"\"></p><ol>\n<li>åœ¨runFollower()å‡½æ•°ä¸­ï¼Œè°ƒç”¨processRPC()å‡½æ•°ï¼Œå¤„ç†æ¥æ”¶åˆ°çš„RPCæ¶ˆæ¯ã€‚</li>\n<li>åœ¨processRPC()å‡½æ•°ä¸­ï¼Œè°ƒç”¨appendEntries()å‡½æ•°ï¼Œå¤„ç†æ¥æ”¶åˆ°çš„æ—¥å¿—å¤åˆ¶RPCè¯·æ±‚ã€‚</li>\n<li>appendEntries()å‡½æ•°ï¼Œæ˜¯è·Ÿéšè€…å¤„ç†æ—¥å¿—çš„æ ¸å¿ƒå‡½æ•°ã€‚åœ¨æ­¥éª¤3.1ä¸­ï¼Œæ¯”è¾ƒæ—¥å¿—ä¸€è‡´æ€§ï¼›åœ¨æ­¥éª¤3.2ä¸­ï¼Œå°†æ–°æ—¥å¿—é¡¹å­˜æ”¾åœ¨æœ¬åœ°ï¼›åœ¨æ­¥éª¤3.3ä¸­ï¼Œæ ¹æ®é¢†å¯¼è€…æœ€æ–°æäº¤çš„æ—¥å¿—é¡¹ç´¢å¼•å€¼ï¼Œæ¥è®¡ç®—å½“å‰éœ€è¦è¢«åº”ç”¨çš„æ—¥å¿—é¡¹ï¼Œå¹¶åº”ç”¨åˆ°æœ¬åœ°çŠ¶æ€æœºã€‚</li>\n</ol><p>è®²åˆ°è¿™å„¿ï¼Œä½ åº”è¯¥å¯ä»¥äº†è§£æ—¥å¿—å¤åˆ¶çš„ä»£ç å®ç°äº†å§ã€‚å…³äºæ›´å¤šçš„RaftåŸç†çš„ä»£ç å®ç°ï¼Œä½ å¯ä»¥ç»§ç»­é˜…è¯»æºç æ¥å­¦ä¹ ï¼Œå¦‚æœåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰ç–‘é—®ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä¸»è¦å¸¦ä½ äº†è§£äº†å¦‚ä½•ä»ç®—æ³•åŸç†çš„è§’åº¦ç†è§£Hashicorp Raftå®ç°ï¼Œæœ‰å‡ ä¸ªé‡ç‚¹æˆ‘æƒ³å¼ºè°ƒä¸€ä¸‹ï¼š</p><ol>\n<li>\n<p>è·Ÿéšè€…ã€å€™é€‰äººã€é¢†å¯¼è€…3ç§èŠ‚ç‚¹çŠ¶æ€éƒ½æœ‰åˆ†åˆ«å¯¹åº”çš„åŠŸèƒ½å‡½æ•°ï¼Œå½“éœ€è¦æŸ¥çœ‹å„èŠ‚ç‚¹çŠ¶æ€ç›¸å…³çš„åŠŸèƒ½å®ç°æ—¶ï¼ˆæ¯”å¦‚ï¼Œè·Ÿéšè€…å¦‚ä½•æ¥æ”¶å’Œå¤„ç†æ—¥å¿—ï¼‰ï¼Œéƒ½å¯ä»¥å°†å¯¹åº”çš„å‡½æ•°ä½œä¸ºå…¥å£å‡½æ•°ï¼Œæ¥é˜…è¯»ä»£ç å’Œç ”ç©¶åŠŸèƒ½å®ç°ã€‚</p>\n</li>\n<li>\n<p>raft.goæ˜¯Hashicorp Raftçš„æ ¸å¿ƒä»£ç æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†çš„æ ¸å¿ƒåŠŸèƒ½éƒ½æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å®ç°çš„ï¼Œå¹³æ—¶å¯ä»¥å¤šç ”ç©¶è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç ï¼Œç›´åˆ°å½»åº•åƒé€ï¼ŒæŒæ¡ã€‚</p>\n</li>\n<li>\n<p>åœ¨Hashicorp Raftä¸­ï¼Œæ”¯æŒä¸¤ç§èŠ‚ç‚¹é—´é€šè®¯æœºåˆ¶ï¼Œå†…å­˜å‹å’ŒTCPåè®®å‹ï¼Œå…¶ä¸­ï¼Œå†…å­˜å‹é€šè®¯æœºåˆ¶ï¼Œä¸»è¦ç”¨äºæµ‹è¯•ï¼Œ2ç§é€šè®¯æœºåˆ¶çš„ä»£ç å®ç°ï¼Œåˆ†åˆ«åœ¨æ–‡ä»¶inmem_transport.goå’Œtcp_transport.goä¸­ã€‚</p>\n</li>\n<li>\n<p>Hashicorp Raftå®ç°ï¼Œæ˜¯å¸¸ç”¨çš„Golangç‰ˆRaftç®—æ³•çš„å®ç°ï¼Œè¢«ä¼—å¤šæµè¡Œè½¯ä»¶ä½¿ç”¨ï¼Œå¦‚Consulã€InfluxDBã€IPFSç­‰ï¼Œç›¸ä¿¡ä½ å¯¹å®ƒå¹¶ä¸é™Œç”Ÿã€‚å…¶ä»–çš„å®ç°è¿˜æœ‰<a href=\"https://github.com/goraft/raft\">Go-Raft</a>ã€<a href=\"https://github.com/logcabin/logcabin\">LogCabin</a>ã€<a href=\"https://github.com/willemt/raft\">Willemt-Raft</a>ç­‰ï¼Œä¸è¿‡æˆ‘å»ºè®®ä½ åœ¨åç»­å¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œä¼˜å…ˆè€ƒè™‘Hashicorp Raftï¼Œå› ä¸ºHashicorp Raftå®ç°ï¼ŒåŠŸèƒ½å®Œå–„ã€ä»£ç ç®€æ´é«˜æ•ˆã€æµè¡Œåº¦é«˜ï¼Œå¯ç”¨æ€§å’Œç¨³å®šæ€§è¢«å……åˆ†æ‰“ç£¨ã€‚</p>\n</li>\n</ol><p>æœ€åï¼Œå…³äºå¦‚ä½•é«˜æ•ˆåœ°é˜…è¯»æºç ï¼Œæˆ‘è¿˜æƒ³å¤šè¯´ä¸€è¯´ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œé«˜æ•ˆé˜…è¯»æºç çš„å…³é”®åœ¨äºæŠ“ä½é‡ç‚¹ï¼Œè¦æœ‰â€œåº•çº¿â€ï¼Œä¸è¦èŠéº»å’Œè¥¿ç“œä¸€æŠŠæŠ“ï¼Œä»€ä¹ˆéƒ½æƒ³è¦ï¼Œæœ€ç»ˆé™·å…¥åˆ°æèŠ‚çç¢çš„ç»†èŠ‚ä¸­å‡ºä¸æ¥ã€‚ä»€ä¹ˆæ˜¯é‡ç‚¹å‘¢ï¼Ÿæˆ‘è®¤ä¸ºé‡ç‚¹æ˜¯æ•°æ®ç»“æ„å’Œå…³é”®çš„ä»£ç æ‰§è¡Œæµç¨‹ï¼Œæ¯”å¦‚åœ¨Hashicorp Raftæºç ä¸­ï¼Œæ—¥å¿—é¡¹å¯¹åº”çš„æ•°æ®ç»“æ„ã€RPCæ¶ˆæ¯å¯¹åº”çš„æ•°æ®ç»“æ„ã€é€‰ä¸¾é¢†å¯¼è€…çš„æµç¨‹ã€æ—¥å¿—å¤åˆ¶çš„æµç¨‹ç­‰ï¼Œè¿™äº›å°±æ˜¯é‡ç‚¹ã€‚</p><p>æœ‰çš„åŒå­¦å¯èƒ½è¿˜æœ‰ç–‘é—®ï¼šåœ¨é˜…è¯»æºç çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°ä¸æ˜¯å¾ˆæ˜ç™½çš„ä»£ç ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘å»ºè®®ä½ å¯ä»¥é€šè¿‡æ‰“å°æ—¥å¿—æˆ–GDBå•æ­¥è°ƒè¯•çš„æ–¹å¼ï¼ŒæŸ¥çœ‹ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡çš„å†…å®¹ã€ä»£ç æ‰§è¡Œé€»è¾‘ç­‰ï¼Œå¸®åŠ©ç†è§£ã€‚</p><h2>è¯¾å ‚æ€è€ƒ</h2><p>åœ¨Hashicorp Raftå®ç°ä¸­ï¼Œæˆ‘è®²äº†å¦‚ä½•å®ç°é€‰ä¸¾é¢†å¯¼è€…ï¼Œä»¥åŠå¦‚ä½•å¤åˆ¶æ—¥å¿—ç­‰ï¼Œé‚£ä¹ˆåœ¨Hashicorp Raftä¸­ï¼Œç½‘ç»œé€šè®¯æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼Œä¸æˆ‘ä¸€åŒè®¨è®ºã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"16 | InfluxDBä¼ä¸šç‰ˆä¸€è‡´æ€§å®ç°å‰–æï¼šä»–å±±ä¹‹çŸ³ï¼Œå¯ä»¥æ”»ç‰","id":212394},"right":{"article_title":"18 | Hashicorp Raftï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä»¥â€œé›†ç¾¤èŠ‚ç‚¹â€ä¸ºä¸­å¿ƒä½¿ç”¨APIï¼Ÿ","id":215116}},"comments":[{"had_liked":false,"id":196737,"user_name":"å§œå·","can_delete":false,"product_type":"c1","uid":1684311,"ip_address":"","ucode":"0F8A349623EAB5","user_header":"https://static001.geekbang.org/account/avatar/00/19/b3/57/2d92cf9a.jpg","comment_is_top":false,"comment_ctime":1585308933,"is_pvip":false,"replies":[{"id":"75556","content":"åŠ ä¸€é¢—æ˜Ÿ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1585934505,"ip_address":"","comment_id":196737,"utype":1}],"discussion_count":2,"race_medal":0,"score":"83189687557","product_id":100046101,"comment_content":"Javaç‰ˆå¯ä»¥çœ‹dledger ","like_count":20,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489372,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585934505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388973,"discussion_content":"æˆ‘æ“¦ ä½ è¿™æ˜¯ æ•‘å‘½ç•™è¨€å•Šï¼ï¼ï¼ï¼ Top1 ;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629080561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190558,"user_name":"å´å°æ™º","can_delete":false,"product_type":"c1","uid":1310798,"ip_address":"","ucode":"C7C9F58B5C9F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","comment_is_top":false,"comment_ctime":1584668637,"is_pvip":false,"replies":[{"id":"76013","content":"å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒRaftæ˜¯é€šè¿‡å®ç°å„èŠ‚ç‚¹æ—¥å¿—çš„ä¸€è‡´ç­‰ï¼Œæœ€ç»ˆå®ç°äº†å¼ºä¸€è‡´æ€§ï¼Œèƒ½ä¿è¯å†™æ“ä½œå®Œæˆåï¼Œå°±èƒ½ç«‹å³å’Œä¸€ç›´è¯»åˆ°æ–°æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯Consulä»–ä»¬æ‰€éœ€è¦çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586202414,"ip_address":"","comment_id":190558,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35944407005","product_id":100046101,"comment_content":"Raft è¯´åˆ°åº•å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„æ—¥å¿—ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨  Consulã€InfluxDBã€IPFS ä¸­ï¼ŒRaft åˆæ˜¯æ€ä¹ˆè¢«ä½¿ç”¨çš„å‘¢ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488004,"discussion_content":"å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒRaftæ˜¯é€šè¿‡å®ç°å„èŠ‚ç‚¹æ—¥å¿—çš„ä¸€è‡´ç­‰ï¼Œæœ€ç»ˆå®ç°äº†å¼ºä¸€è‡´æ€§ï¼Œèƒ½ä¿è¯å†™æ“ä½œå®Œæˆåï¼Œå°±èƒ½ç«‹å³å’Œä¸€ç›´è¯»åˆ°æ–°æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯Consulä»–ä»¬æ‰€éœ€è¦çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586202414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"å´å°æ™º","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211624,"discussion_content":"https://github.com/tinylcy/rastore æ‰¾åˆ°ä¸€ä¸ªåŸºäº Raft çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå€¼å¾—ä¸€çœ‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584870856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190966,"user_name":"æ²‰æ·€çš„æ¢¦æƒ³","can_delete":false,"product_type":"c1","uid":1177315,"ip_address":"","ucode":"BCB7C26F9D214B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","comment_is_top":false,"comment_ctime":1584713936,"is_pvip":false,"replies":[{"id":"77967","content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œå‘ã€æ”¶åˆ†ç¦»ï¼ŒæŒç»­å¼‚æ­¥å‘é€æ—¥å¿—é¡¹ï¼Œä¸é˜»å¡ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘æ—¥å¿—ä¸ä¸€è‡´ç­‰å¼‚å¸¸æƒ…å†µï¼Œçº¯å¤åˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1587406489,"ip_address":"","comment_id":190966,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31649485008","product_id":100046101,"comment_content":"æµæ°´çº¿å¤åˆ¶æ˜¯å¦‚ä½•ä¼˜åŒ–æ—¥å¿—å¤åˆ¶çš„æ€§èƒ½çš„å‘¢ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488090,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œå‘ã€æ”¶åˆ†ç¦»ï¼ŒæŒç»­å¼‚æ­¥å‘é€æ—¥å¿—é¡¹ï¼Œä¸é˜»å¡ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘æ—¥å¿—ä¸ä¸€è‡´ç­‰å¼‚å¸¸æƒ…å†µï¼Œçº¯å¤åˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587406489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"å´å°æ™º","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213031,"discussion_content":"çœ‹äº†ä¸€ä¸‹ï¼Œåˆ†ç¦»å‘é€ä¸æ¥æ”¶çš„æ“ä½œï¼Œå³åœ¨å¤åˆ¶æ—¥å¿—çš„æ—¶å€™ï¼Œå‘é€æ—¥å¿—å¤åˆ¶è¯·æ±‚ç»™ follower ï¼Œç„¶åå¼‚æ­¥ç­‰å¾…ç›¸åº”ï¼Œæ—¢å¯ä»¥ä¸æ–­çš„å‘é€è¯·æ±‚ï¼›éæµæ°´çº¿çš„è¯ï¼Œæ˜¯å‘é€æ—¥å¿—å¤åˆ¶è¯·æ±‚åï¼Œé˜»å¡ç­‰å¾…ç›¸åº”ï¼Œæ‰èƒ½å‘ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585044215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194270,"user_name":"å´å°æ™º","can_delete":false,"product_type":"c1","uid":1310798,"ip_address":"","ucode":"C7C9F58B5C9F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","comment_is_top":false,"comment_ctime":1585044427,"is_pvip":false,"replies":[{"id":"76005","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œè°ƒç”¨match()å‡½æ•°ï¼Œæ¥ç»Ÿè®¡æ—¥å¿—å¤åˆ¶ç»“æœå’Œåˆ¤æ–­å¤§å¤šæ•°çš„ï¼Œå¹¶å°†ç»“æœå‘é€åˆ°commitChï¼Œæœ€ç»ˆåœ¨leaderLoop()ä¸­å¤„ç†committedæ—¥å¿—é¡¹çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586199456,"ip_address":"","comment_id":194270,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23059880907","product_id":100046101,"comment_content":"Leader æ”¶åˆ° client è¯·æ±‚ï¼Œç„¶åæŠŠæ—¥å¿—å†™åˆ°è‡ªå·±çš„ disk ä¸­ï¼Œç„¶åé€šçŸ¥ Follower å¤åˆ¶æ—¥å¿—ï¼Œç„¶å leader ç­‰å¾…ç›¸åº”ï¼Œæ”¶åˆ°å¤§å¤šæ•°ç›¸åº”åï¼Œcommit è¯¥æ¡æ—¥å¿—ï¼›åœ¨ä»£ç ä¸­ï¼Œåªæ‰¾åˆ°äº† â€œLeader æ”¶åˆ° client è¯·æ±‚ï¼Œç„¶åæŠŠæ—¥å¿—å†™åˆ°è‡ªå·±çš„ disk ä¸­ï¼Œç„¶åé€šçŸ¥ Follower å¤åˆ¶æ—¥å¿—â€ï¼Œæ²¡æ‰¾åˆ° leader æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰å¤§å¤šæ•°ç›¸åº”ï¼Œä¸”æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ commit çš„ã€‚å¸Œæœ›è€å¸ˆå¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ï¼Ÿ<br>PSï¼šæºä»£ç ä¸­çš„ chan é€šä¿¡ï¼ŒçœŸçš„æŠ˜ç£¨äººã€‚","like_count":6,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488799,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œè°ƒç”¨match()å‡½æ•°ï¼Œæ¥ç»Ÿè®¡æ—¥å¿—å¤åˆ¶ç»“æœå’Œåˆ¤æ–­å¤§å¤šæ•°çš„ï¼Œå¹¶å°†ç»“æœå‘é€åˆ°commitChï¼Œæœ€ç»ˆåœ¨leaderLoop()ä¸­å¤„ç†committedæ—¥å¿—é¡¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586199456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300192,"user_name":"Ricky Fung","can_delete":false,"product_type":"c1","uid":1051363,"ip_address":"","ucode":"7AEA1F8EC4A088","user_header":"https://static001.geekbang.org/account/avatar/00/10/0a/e3/9637bfdb.jpg","comment_is_top":false,"comment_ctime":1625040744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14509942632","product_id":100046101,"comment_content":"c++ å®ç°å¯ä»¥çœ‹ç™¾åº¦å¼€æºçš„ braftï¼šhttps:&#47;&#47;github.com&#47;baidu&#47;braft<br>javaå®ç°å¯ä»¥çœ‹èš‚èšé‡‘æœå¼€æºçš„sofa-jraftï¼šhttps:&#47;&#47;github.com&#47;sofastack&#47;sofa-jraft","like_count":4},{"had_liked":false,"id":229037,"user_name":"Ethan Liu","can_delete":false,"product_type":"c1","uid":1070043,"ip_address":"","ucode":"231F944F7CD56A","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/db/858337e3.jpg","comment_is_top":false,"comment_ctime":1592883520,"is_pvip":true,"replies":[{"id":"88047","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ¡ä»¶1ï¼Œå½“å‰é›†ç¾¤åªæœ‰å®ƒä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸éœ€è¦è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ï¼›æ¡ä»¶2ï¼šè¯¥èŠ‚ç‚¹ä¸å…·æœ‰æŠ•ç¥¨æƒï¼Œä¸èƒ½è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596135437,"ip_address":"","comment_id":229037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10182818112","product_id":100046101,"comment_content":"è€å¸ˆ runFollower()é‡Œé¢è¿™ä¸¤ä¸ªåˆ¤æ–­ if r.configurations.latestIndex == 0 å’Œ if r.configurations.latestIndex == r.configurations.committedIndex &amp;&amp; !hasVote(r.configurations.latest, r.localID) åŸç†æ˜¯ä»€ä¹ˆå•Šï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499306,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæ¡ä»¶1ï¼Œå½“å‰é›†ç¾¤åªæœ‰å®ƒä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸éœ€è¦è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ï¼›æ¡ä»¶2ï¼šè¯¥èŠ‚ç‚¹ä¸å…·æœ‰æŠ•ç¥¨æƒï¼Œä¸èƒ½è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596135437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199292,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1585485943,"is_pvip":true,"replies":[{"id":"75452","content":"Hashicorp Raftæ˜¯ä¸ªpackageï¼Œå¯ä»¥å°†å®ƒç†è§£æˆåº“ï¼ˆlibï¼‰ï¼Œæ˜¯æ²¡æœ‰mainå‡½æ•°çš„ï¼Œå¯ä»¥é€šè¿‡APIå‡½æ•°ï¼ˆæ¯”å¦‚AddVoter()ï¼‰æˆ–è€…æ ¸å¿ƒå‡½æ•°ï¼ˆæ¯”å¦‚run()ï¼‰ï¼Œä½œä¸ºå…¥å£å‡½æ•°ï¼Œæ¥è¿›ä¸€æ­¥å­¦ä¹ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1585844622,"ip_address":"","comment_id":199292,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10175420535","product_id":100046101,"comment_content":"Hashicorp Raft  æ‰¾äº†åŠå¤© æ²¡æœ‰æ‰¾åˆ°å…¥å£ main å‡½æ•°","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489816,"discussion_content":"Hashicorp Raftæ˜¯ä¸ªpackageï¼Œå¯ä»¥å°†å®ƒç†è§£æˆåº“ï¼ˆlibï¼‰ï¼Œæ˜¯æ²¡æœ‰mainå‡½æ•°çš„ï¼Œå¯ä»¥é€šè¿‡APIå‡½æ•°ï¼ˆæ¯”å¦‚AddVoter()ï¼‰æˆ–è€…æ ¸å¿ƒå‡½æ•°ï¼ˆæ¯”å¦‚run()ï¼‰ï¼Œä½œä¸ºå…¥å£å‡½æ•°ï¼Œæ¥è¿›ä¸€æ­¥å­¦ä¹ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585844622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192874,"user_name":"å¤","can_delete":false,"product_type":"c1","uid":1010922,"ip_address":"","ucode":"74E6838226A405","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/ea/ce9854a5.jpg","comment_is_top":false,"comment_ctime":1584877149,"is_pvip":false,"replies":[{"id":"75568","content":"packageæ˜¯æ— æ³•ç›´æ¥ç¼–è¯‘çš„ï¼Œéœ€è¦åœ¨ç¨‹åºçš„main()ä¸­è¢«è°ƒç”¨åï¼Œæ‰èƒ½ç¼–è¯‘ã€‚å¯ä»¥ç¼–è¯‘ã€ç ”ç©¶ä¸‹20è®²çš„ç¨‹åºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1585937140,"ip_address":"","comment_id":192874,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174811741","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œæ‚¨å¥½ï¼Œhashicorp å®ç°çš„raft package, æˆ‘çœ‹githubä¸Šçš„æ ‡ç­¾æ˜¯build failed, æˆ‘è¯•è¿‡å¤šä¸ªtagéƒ½æ˜¯ä¸€æ ·çš„ã€‚","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488478,"discussion_content":"packageæ˜¯æ— æ³•ç›´æ¥ç¼–è¯‘çš„ï¼Œéœ€è¦åœ¨ç¨‹åºçš„main()ä¸­è¢«è°ƒç”¨åï¼Œæ‰èƒ½ç¼–è¯‘ã€‚å¯ä»¥ç¼–è¯‘ã€ç ”ç©¶ä¸‹20è®²çš„ç¨‹åºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585937140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190465,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1584662674,"is_pvip":false,"replies":[{"id":"75707","content":"åŠ æ²¹ï¼æœ‰é—®é¢˜å¤šäº¤æµ:)","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586019782,"ip_address":"","comment_id":190465,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10174597266","product_id":100046101,"comment_content":"å¥½ï¼Œä¸‹å»ç»“åˆä¹‹å‰çš„ç†è®ºçœ‹çœ‹æºç ","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487986,"discussion_content":"åŠ æ²¹ï¼æœ‰é—®é¢˜å¤šäº¤æµ:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586019782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300193,"user_name":"Ricky Fung","can_delete":false,"product_type":"c1","uid":1051363,"ip_address":"","ucode":"7AEA1F8EC4A088","user_header":"https://static001.geekbang.org/account/avatar/00/10/0a/e3/9637bfdb.jpg","comment_is_top":false,"comment_ctime":1625042063,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5920009359","product_id":100046101,"comment_content":"javaå®ç°å¯å‚è€ƒèš‚èšé‡‘æœå¼€æºçš„ sofa-jraftï¼šhttps:&#47;&#47;github.com&#47;sofastack&#47;sofa-jraft<br>c++å®ç°å¯å‚è€ƒç™¾åº¦å¼€æºçš„ braftï¼šhttps:&#47;&#47;github.com&#47;baidu&#47;braft","like_count":2,"discussions":[{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388975,"discussion_content":"SOFAJRaft æ˜¯ä»ç™¾åº¦çš„ braft ç§»æ¤è€Œæ¥ï¼Œåšäº†ä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œæ„Ÿè°¢ç™¾åº¦ braft å›¢é˜Ÿå¼€æºäº†å¦‚æ­¤ä¼˜ç§€çš„ C++ RAFT å®ç° å†å®³å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629080939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221753,"user_name":"cyq","can_delete":false,"product_type":"c1","uid":1656802,"ip_address":"","ucode":"958972090C4447","user_header":"https://static001.geekbang.org/account/avatar/00/19/47/e2/cfbeb06c.jpg","comment_is_top":false,"comment_ctime":1590583627,"is_pvip":false,"replies":[{"id":"87264","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå­˜åœ¨é¢†å¯¼è€…ï¼Œæˆ–è€…å®ƒå‘ç°äº†æœ‰æ¯”å®ƒæ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…çš„èŠ‚ç‚¹ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¥æ”¶åˆ°é¢†å¯¼è€…çš„å¿ƒè·³ï¼Œæˆ–è€…æ¥æ”¶åˆ°çš„æŠ•ç¥¨è¯·æ±‚çš„å“åº”ä¸­çš„ä»»æœŸç¼–å·ï¼Œæ¯”å®ƒçš„å¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595343685,"ip_address":"","comment_id":221753,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5885550923","product_id":100046101,"comment_content":"å¯¹äºhashicorp&#47;raftçš„ä»£ç ä¸­ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯candidateçŠ¶æ€ã€‚é‚£ä¹ˆä»–æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä¼šæ¢å¤ä¸ºFollowerçš„èº«ä»½?","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496553,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå­˜åœ¨é¢†å¯¼è€…ï¼Œæˆ–è€…å®ƒå‘ç°äº†æœ‰æ¯”å®ƒæ›´é€‚åˆä½œä¸ºé¢†å¯¼è€…çš„èŠ‚ç‚¹ï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¥æ”¶åˆ°é¢†å¯¼è€…çš„å¿ƒè·³ï¼Œæˆ–è€…æ¥æ”¶åˆ°çš„æŠ•ç¥¨è¯·æ±‚çš„å“åº”ä¸­çš„ä»»æœŸç¼–å·ï¼Œæ¯”å®ƒçš„å¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388979,"discussion_content":"å‡å¦‚å¼€åœº A(1s) B(2s) C(3s) ï¼Œç„¶åAçš„1sè½¬å®Œäº†ï¼Œå‘ç°è¿˜æ²¡æœ‰é¢†å¯¼ï¼Œå°±æŠ•äº†è‡ªå·±ä¸€ç¥¨ ä»»æœŸä¸º1 å¦å¤–è½¬å‘RPC ç»™  B C èŠ‚ç‚¹ï¼Œè¿™æ—¶B C èŠ‚ç‚¹è¿˜åœ¨è‡ªè½¬å‘¢ï¼›ç”±äºç½‘ç»œé˜»å¡ï¼ŒAå‘ç»™Bçš„RPC æ²¡æœ‰åŠæ—¶åˆ°Bï¼ŒBè‡ªå·±çš„2sè½¬å®Œäº†(C è¿˜åœ¨è½¬3sä¸­)ï¼Œä¹Ÿå‘ç°æ²¡æœ‰é¢†å¯¼è€…ï¼Œä¹Ÿå°±è‡ªå·±æŠ•äº†è‡ªå·±çš„ä¸€ç¥¨ï¼Œä»»æœŸä¸º1ï¼Œå†è½¬å‘RPCç»™A BèŠ‚ç‚¹ , è¿™æ—¶å±€é¢ è¯¥å’‹åŠå‘¢ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629081599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193458,"user_name":"Michael Tesla","can_delete":false,"product_type":"c1","uid":1033053,"ip_address":"","ucode":"C627F090293608","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/5d/ced9b5c2.jpg","comment_is_top":false,"comment_ctime":1584894227,"is_pvip":false,"replies":[{"id":"75565","content":"åŠ ä¸€é¢—æ˜Ÿ:)ã€‚æˆ‘æ¨èï¼Œå…ˆå¤§æ¦‚äº†è§£ä¸‹ç®—æ³•çš„åŸç†ï¼Œç„¶åå°†Raftå®ç°ï¼ˆæ¯”å¦‚Hashicorp Raftï¼‰ä½¿ç”¨èµ·æ¥ï¼Œæœ‰äº†æ„Ÿè§‰åï¼Œå†å°†ä»£ç å’Œè®ºæ–‡ç»“åˆç€å­¦ä¹ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1585936660,"ip_address":"","comment_id":193458,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5879861523","product_id":100046101,"comment_content":"è€å¸ˆï¼Œæ˜¯ä¸æ˜¯å¾—å…ˆæŠŠå¤§è®ºæ–‡çœ‹ä¸€éï¼Œå†çœ‹ä»£ç ï¼Œæ•ˆæœæ¯”è¾ƒå¥½ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488561,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ã€‚æˆ‘æ¨èï¼Œå…ˆå¤§æ¦‚äº†è§£ä¸‹ç®—æ³•çš„åŸç†ï¼Œç„¶åå°†Raftå®ç°ï¼ˆæ¯”å¦‚Hashicorp Raftï¼‰ä½¿ç”¨èµ·æ¥ï¼Œæœ‰äº†æ„Ÿè§‰åï¼Œå†å°†ä»£ç å’Œè®ºæ–‡ç»“åˆç€å­¦ä¹ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585936660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190511,"user_name":"å†·ç¬‘çš„èŠ±çŒ«","can_delete":false,"product_type":"c1","uid":1119029,"ip_address":"","ucode":"6C368FBB577470","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/35/45391914.jpg","comment_is_top":false,"comment_ctime":1584666109,"is_pvip":false,"replies":[{"id":"76171","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šé‡æ–°å‘èµ·æ–°çš„é€‰ä¸¾ã€‚é—®é¢˜2ï¼šä¸»è¦æ˜¯ä»»æœŸç¼–å·ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒä¸‹07è®²çš„å†…å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586279878,"ip_address":"","comment_id":190511,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5879633405","product_id":100046101,"comment_content":"é€‰ä¸¾leaderé‚£æ®µï¼Œå…ˆæŠ•è‡ªå·±ä¸€ç¥¨ï¼Œç„¶åé€šè¿‡rpcè®©å…¶å®ƒèŠ‚ç‚¹æŠ•ç¥¨ç»™è‡ªå·±ã€‚æœ‰äº›ä¸ç†è§£ï¼Œ1  å¦‚æœéšæœºæ—¶é—´æ²¡æ”¶åˆ°æŠ•ç¥¨æ€ä¹ˆåŠï¼Ÿ2  å…¶å®ƒèŠ‚ç‚¹æ˜¯å¦‚ä½•å›åº”è¿™ä¸ªæŠ•ç¥¨ä¿¡æ¯çš„ï¼ŒåŸºäºä»€ä¹ˆæ ‡å‡†å†³å®šæŠ•è¿˜æ˜¯ä¸æŠ•ï¼Ÿ è°¢è°¢","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487995,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šé‡æ–°å‘èµ·æ–°çš„é€‰ä¸¾ã€‚é—®é¢˜2ï¼šä¸»è¦æ˜¯ä»»æœŸç¼–å·ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒä¸‹07è®²çš„å†…å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586279878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342352,"user_name":"tinyğŸŒ¾","can_delete":false,"product_type":"c1","uid":1119851,"ip_address":"","ucode":"7A4DE00381D1F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/6b/af7c7745.jpg","comment_is_top":false,"comment_ctime":1650205270,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650205270","product_id":100046101,"comment_content":"åªæœ‰ä¸€ä¸ªé¢†å¯¼èŠ‚ç‚¹èƒ½å†™ï¼Œé‚£æ€ä¹ˆä¿è¯æ€§èƒ½äº†ï¼Ÿ å¦‚æœå†™æ€§èƒ½æ‰›ä¸ä½æ€ä¹ˆåŠå•Š","like_count":0},{"had_liked":false,"id":313190,"user_name":"DavidJiang","can_delete":false,"product_type":"c1","uid":1643779,"ip_address":"","ucode":"92EBF337569A1B","user_header":"https://static001.geekbang.org/account/avatar/00/19/15/03/682bd618.jpg","comment_is_top":false,"comment_ctime":1632304545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632304545","product_id":100046101,"comment_content":"è¿™ä¸ªæ—¥å¿—å¤åˆ¶å¤åˆ¶çš„å…·ä½“æ˜¯å•¥?å’Œmysqlä¸­çš„binlogæœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«,çœ‹ä¸Šå»éƒ½æ˜¯æŒ‡ä»¤åœ¨æœ¬åœ°æ‰§è¡Œ.é‚£ä¹ˆæ˜¯å¦ä¹Ÿä¼šé¢ä¸´binlogå¤åˆ¶çš„é—®é¢˜?","like_count":0},{"had_liked":false,"id":288230,"user_name":"Geek_a2ca6c","can_delete":false,"product_type":"c1","uid":2149579,"ip_address":"","ucode":"B22D001F1CD8A2","user_header":"","comment_is_top":false,"comment_ctime":1618371682,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618371682","product_id":100046101,"comment_content":"æˆ‘çœ‹è¿™ä¸ªå®ç°çš„æºä»£ç é‡Œï¼Œrequestvoteå‡½æ•°ï¼Œå…ˆæ˜¯æ£€æŸ¥æœ¬åœ°çŠ¶æ€æœºçš„leaderä¿¡æ¯æœ‰æ²¡æœ‰ï¼Œå¦‚æœæœ‰leaderä¿¡æ¯ï¼Œå¹¶ä¸”å’Œå‘èµ·æŠ•ç¥¨çš„èŠ‚ç‚¹ä¸ä¸€è‡´ï¼Œå°±æ‹’ç»æœ¬æ¬¡æŠ•ç¥¨ã€‚é‚£æ˜¯ä¸æ˜¯è¯´å¹¶ä¸æ˜¯æœ€å…ˆè¶…æ—¶å‘èµ·æŠ•ç¥¨çš„èŠ‚ç‚¹ä¸ä¸€å®šæˆä¸ºä¸»å‡ ç‚¹ï¼Œçš„é›†ç¾¤å¤§å¤šæ•°äººè¶…æ—¶åå¤±å»leaderä¿¡æ¯åï¼Œæ‰ä¼šå‘èµ·æŠ•ç¥¨å—ã€‚","like_count":0},{"had_liked":false,"id":286318,"user_name":"David","can_delete":false,"product_type":"c1","uid":1044324,"ip_address":"","ucode":"8A5F064C911714","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/64/5b71bb14.jpg","comment_is_top":false,"comment_ctime":1617253845,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617253845","product_id":100046101,"comment_content":"è€å¸ˆå¥½ï¼Œè®¢é˜…è¿™é—¨è¯¾ç¨‹æœ‰æ”¶è·ï¼Œè°¢è°¢ï¼<br>åœ¨é˜…è¯»Raftæºä»£ç æ—¶ï¼Œæœ‰ä¸ªç–‘é—®ï¼ˆå¯èƒ½æ˜¯è¿˜æ²¡æœ‰çœ‹æ˜ç™½åŸå› ï¼‰ï¼šfolloweræ¥æ”¶æŠ•ç¥¨è¯·æ±‚æ—¶ï¼Œä¼šåšäº›å‚æ•°éªŒè¯ï¼Œå…·ä½“ä»£ç æ˜¯è¿™å‡ è¡Œï¼š<br>if leader := r.Leader(); leader != &quot;&quot; &amp;&amp; leader != candidate &amp;&amp; !req.LeadershipTransfer {<br>\t\tr.logger.Warn(fmt.Sprintf(&quot;Rejecting vote request from %v since we have a leader: %v&quot;,<br>\t\t\tcandidate, leader))<br>\t\treturn<br>\t}<br>æˆ‘çš„ç–‘é—®æ˜¯è¿™æ ·çš„ï¼šæŸå€™é€‰è€…è¿›å…¥æ‹‰ç¥¨é˜¶æ®µæ—¶ï¼Œå› æ¯ä¸ªfollowerçš„timeoutä¸ä¸€æ ·ï¼Œè¿™è¡Œä»£ç :<br>leader := r.Leader(); leader != &quot;&quot; &amp;&amp; leader != candidate &amp;&amp; !req.LeadershipTransfer æœ‰æ¦‚ç‡ä¼¼ä¹ä¸ºtrueçš„ï¼Œè¯·é—®è€å¸ˆè¿™é‡Œæ€ä¹ˆç†è§£å‘¢ï¼Œéå¸¸æ„Ÿè°¢ï¼<br>\t","like_count":0},{"had_liked":false,"id":261010,"user_name":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1605172526,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1605172526","product_id":100046101,"comment_content":"æœ€è¿‘æ­£å¥½å­¦ä¹ äº†goï¼ŒçœŸæ˜¯å¹²è´§æ»¡æ»¡ã€‚","like_count":0},{"had_liked":false,"id":230058,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1593248517,"is_pvip":false,"replies":[{"id":"87385","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸åŒçš„å‡½æ•°å°è£…ï¼Œreplicateå‡½æ•°æ˜¯åœ¨startStopReplicationå‡½æ•°ä¸­è¢«è°ƒç”¨çš„ï¼Œå¯ä»¥ç»“åˆæºç æ¥ç†è§£å“ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595439369,"ip_address":"","comment_id":230058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593248517","product_id":100046101,"comment_content":"startStopReplicationå’Œreplicateå‡½æ•°åŒºåˆ«æ˜¯å•¥ï¼Ÿæ€ä¹ˆéƒ½æ˜¯æ—¥å¿—å¤åˆ¶ç›¸å…³åŠŸèƒ½...","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499750,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸åŒçš„å‡½æ•°å°è£…ï¼Œreplicateå‡½æ•°æ˜¯åœ¨startStopReplicationå‡½æ•°ä¸­è¢«è°ƒç”¨çš„ï¼Œå¯ä»¥ç»“åˆæºç æ¥ç†è§£å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595439369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208596,"user_name":"cbping","can_delete":false,"product_type":"c1","uid":1608798,"ip_address":"","ucode":"16D891E80A352B","user_header":"https://static001.geekbang.org/account/avatar/00/18/8c/5e/8cb6fad1.jpg","comment_is_top":false,"comment_ctime":1587388334,"is_pvip":false,"replies":[{"id":"77947","content":"æ–‡ç« å¼€å§‹å¤„æœ‰é“¾æ¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘æ˜¾å¼è´´ä¸‹ï¼šhttps:&#47;&#47;github.com&#47;hashicorp&#47;raft","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1587397526,"ip_address":"","comment_id":208596,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587388334","product_id":100046101,"comment_content":"æºç åœ¨å“ªé‡Œå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492530,"discussion_content":"æ–‡ç« å¼€å§‹å¤„æœ‰é“¾æ¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘æ˜¾å¼è´´ä¸‹ï¼šhttps://github.com/hashicorp/raft","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587397526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203058,"user_name":"é˜¿é¼","can_delete":false,"product_type":"c1","uid":1042634,"ip_address":"","ucode":"EE763513563F50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/ca/2a7cc193.jpg","comment_is_top":false,"comment_ctime":1586133515,"is_pvip":false,"replies":[{"id":"75944","content":"éœ€è¦åšå…¨é¢çš„ç›‘æ§èƒ½åŠ›ï¼Œç›‘æ§æ˜¯ä¸šåŠ¡ä¹‹çœ¼ï¼Œéœ€è¦åšå¥½åŸºç¡€ç›‘æ§ã€ç»Ÿè®¡ä¸ŠæŠ¥ã€åŸ‹ç‚¹ä¸ŠæŠ¥å’Œå‘Šè­¦ï¼Œæ¯”å¦‚ï¼ŒCPUã€å†…å­˜ã€è¿›ç¨‹è¿è¡Œã€å†™è¯·æ±‚æ•°æ®ã€è¯»è¯·æ±‚æ•°ã€å†™å¤±è´¥æ•°ã€ä¸šåŠ¡æ—¥å¿—ç­‰ï¼Œå¦å¤–ï¼Œå¯ä»¥è€ƒè™‘åšå…¨é“¾è·¯ç›‘æ§ã€‚åŸºç¡€å·¥å…·ï¼Œå¯ä»¥è€ƒè™‘InfluxDBã€Grafanaã€ESç­‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586167308,"ip_address":"","comment_id":203058,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586133515","product_id":100046101,"comment_content":"è¯·é—®è€å¸ˆï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ—¥å¿—åˆ†æ•£ï¼Œæ’æŸ¥é—®é¢˜æœ‰ä»€ä¹ˆç»éªŒï¼Ÿæœ‰ä»€ä¹ˆåŸºç¡€å·¥å…·å¯ä»¥è¿ç”¨ã€‚","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490749,"discussion_content":"éœ€è¦åšå…¨é¢çš„ç›‘æ§èƒ½åŠ›ï¼Œç›‘æ§æ˜¯ä¸šåŠ¡ä¹‹çœ¼ï¼Œéœ€è¦åšå¥½åŸºç¡€ç›‘æ§ã€ç»Ÿè®¡ä¸ŠæŠ¥ã€åŸ‹ç‚¹ä¸ŠæŠ¥å’Œå‘Šè­¦ï¼Œæ¯”å¦‚ï¼ŒCPUã€å†…å­˜ã€è¿›ç¨‹è¿è¡Œã€å†™è¯·æ±‚æ•°æ®ã€è¯»è¯·æ±‚æ•°ã€å†™å¤±è´¥æ•°ã€ä¸šåŠ¡æ—¥å¿—ç­‰ï¼Œå¦å¤–ï¼Œå¯ä»¥è€ƒè™‘åšå…¨é“¾è·¯ç›‘æ§ã€‚åŸºç¡€å·¥å…·ï¼Œå¯ä»¥è€ƒè™‘InfluxDBã€Grafanaã€ESç­‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586167308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}