{"id":73951,"title":"169 | Prometheus监控集成(Code Review)","content":"","comments":[{"had_liked":false,"id":215400,"user_name":"Allen","can_delete":false,"product_type":"c3","uid":1152017,"ip_address":"","ucode":"232B5F33D68C8C","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/11/d53d9c6f.jpg","comment_is_top":false,"comment_ctime":1588986911,"is_pvip":false,"replies":[{"id":79978,"content":"不需要单独去监控p99，一般监控接口延迟即可(用Histogram类型)，平均&#47;最大&#47;最小&#47;p95&#47;p99等等后续是可以通过promethues提供的函数表达式推导出来。\n\n例如百分位可以参考函数histogram_quantile：\nhttps:&#47;&#47;prometheus.io&#47;docs&#47;prometheus&#47;latest&#47;querying&#47;functions&#47;#histogram_quantile\nhttps:&#47;&#47;prometheus.io&#47;docs&#47;concepts&#47;metric_types&#47;#histogram","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1589204386,"ip_address":"","comment_id":215400,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"如何监控接口的p99呢\n","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494416,"discussion_content":"不需要单独去监控p99，一般监控接口延迟即可(用Histogram类型)，平均/最大/最小/p95/p99等等后续是可以通过promethues提供的函数表达式推导出来。\n\n例如百分位可以参考函数histogram_quantile：\nhttps://prometheus.io/docs/prometheus/latest/querying/functions/#histogram_quantile\nhttps://prometheus.io/docs/concepts/metric_types/#histogram","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589204386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152017,"avatar":"https://static001.geekbang.org/account/avatar/00/11/94/11/d53d9c6f.jpg","nickname":"Allen","note":"","ucode":"232B5F33D68C8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285091,"discussion_content":"http接口的需要手动埋点？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592737387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152017,"avatar":"https://static001.geekbang.org/account/avatar/00/11/94/11/d53d9c6f.jpg","nickname":"Allen","note":"","ucode":"232B5F33D68C8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265053,"discussion_content":"老师，教程中要讲么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589371197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59167,"user_name":"Habit","can_delete":false,"product_type":"c3","uid":1021884,"ip_address":"","ucode":"C3ABA308EA87A9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoK1xxtSs1RKRYO7q9J1PG0cqoxKzXg0VWu5mzghzjHvKzLhNv7IZb6glVW8ULjibPtwkJpDcrJMHg/132","comment_is_top":false,"comment_ctime":1547310600,"is_pvip":false,"replies":[{"id":21535,"content":"你好，我本地检查启动是ok的，eureka registry主要依赖apollo，请确保apollo配置正确，eureka正常启动，可以看启动日志，如还有问题，请微信(bulldog2015)进一步交流。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547452625,"ip_address":"","comment_id":59167,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"你好老师，我启动registry服务，访问http:&#47;&#47;localhost:8761&#47;出现404如下：\nWhitelabel Error Page\nThis application has no explicit mapping for &#47;error, so you are seeing this as a fallback.\n\nSun Jan 13 00:26:59 CST 2019\nThere was an unexpected error (type=Not Found, status=404).\nNo message available","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436306,"discussion_content":"你好，我本地检查启动是ok的，eureka registry主要依赖apollo，请确保apollo配置正确，eureka正常启动，可以看启动日志，如还有问题，请微信(bulldog2015)进一步交流。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547452625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54456,"user_name":"大毛","can_delete":false,"product_type":"c3","uid":1207241,"ip_address":"","ucode":"92614BE20DB5E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/c9/9b207f2b.jpg","comment_is_top":false,"comment_ctime":1545874383,"is_pvip":false,"replies":[{"id":19824,"content":"课程演示为了简单硬编码了服务地址，实际场景中需使用prometheus的服务发现（service discovery）机制，课程中有专门提到，比较可惜prometheus的服务发现目前还不支持eureka，需自己扩展，也可参考网上方案，比如http:&#47;&#47;blog.kail.xyz&#47;post&#47;2018-10-08&#47;cncf&#47;prometheus-file-sd.html，工作量不大。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545925145,"ip_address":"","comment_id":54456,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"貌似课程里讲的都是Prometheus静态写死微服务地址去监控，当服务一多就不合适了，那么Prometheus如何自动服务发现eureka里的服务，这个好像没提到，请问如何做到啊？Prometheus也没有提供类似的eureka exporter ","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434458,"discussion_content":"课程演示为了简单硬编码了服务地址，实际场景中需使用prometheus的服务发现（service discovery）机制，课程中有专门提到，比较可惜prometheus的服务发现目前还不支持eureka，需自己扩展，也可参考网上方案，比如http://blog.kail.xyz/post/2018-10-08/cncf/prometheus-file-sd.html，工作量不大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545925145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}