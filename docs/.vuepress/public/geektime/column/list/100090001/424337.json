{"id":424337,"title":"12 | åŸºç¡€é…ç½®è¯¦è§£ï¼šå“ªäº›å‚æ•°ä¼šå½±å“åº”ç”¨ç¨‹åºç¨³å®šæ€§ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>å›½åº†å‡æœŸå³å°†ç»“æŸï¼Œæˆ‘ä»¬çš„åŸºç¡€æ¨¡å—ä¹Ÿå³å°†æ”¶å°¾ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†RDDç¼–ç¨‹æ¨¡å‹ã€Sparkåˆ†å¸ƒå¼éƒ¨ç½²ã€Sparkå·¥ä½œåŸç†ï¼Œä»¥åŠRDDå¸¸ç”¨ç®—å­ã€‚æ­å–œä½ ï¼Œåˆ°è¿™é‡Œï¼Œå¯ä»¥è¯´ä½ å·²ç»å®Œå…¨è·¨å…¥äº†Sparkåˆ†å¸ƒå¼åº”ç”¨å¼€å‘çš„å¤§é—¨ã€‚æœ‰äº†ç°åœ¨çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå¯¹äºå¤§å¤šæ•°çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ç›¸ä¿¡ä½ éƒ½èƒ½å¾ˆå¿«åœ°å®ç°ã€‚</p><p>ä¸è¿‡ï¼Œå¿«é€Ÿç”¨ä»£ç å®ç°å„å¼å„æ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè¿™è¿˜åªæ˜¯ç¬¬ä¸€æ­¥ã€‚æˆ‘ä»¬ä¸å…‰è¦è®©ä»£ç è·‘èµ·æ¥ï¼Œè¿˜éœ€è¦è®©ä»£ç è·‘å¾—åˆå¿«åˆç¨³ã€‚</p><p>è¦æƒ³åšåˆ°è¿™äº›ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®é¡¹æ¥å¸®å¿™ã€‚å¦‚æœæŠŠSparkçœ‹ä½œæ˜¯ä¸€éƒ¨F1èµ›è½¦çš„è¯ï¼Œé‚£ä¹ˆé…ç½®é¡¹å°±æ˜¯èµ›è½¦è½¦èº«çš„å„é¡¹é…ç½®å‚æ•°ï¼Œå¦‚å‘åŠ¨æœºç¼¸æ•°ã€æœ€å¤§è½¬çŸ©ã€è½¦èº«è½´è·ã€æ‚¬æŒ‚æ–¹å¼ã€æ•´è½¦è£…å¤‡è´¨é‡ï¼Œç­‰ç­‰ã€‚åªæœ‰åˆç†åœ°é…ç½®è½¦èº«å‚æ•°ï¼Œæ‰èƒ½è®©è½¦å­æœ¬èº«çš„ç¨³å®šæ€§å’Œæ€§èƒ½å¾—åˆ°ä¿éšœï¼Œä¸ºé€‰æ‰‹çš„å‡ºè‰²å‘æŒ¥å¥ å®šåŸºç¡€ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±æ¥è¯´ä¸€è¯´Sparkéƒ½æœ‰å“ªäº›é…ç½®é¡¹ï¼Œä»¥åŠè¿™äº›é…ç½®é¡¹çš„å«ä¹‰ä¸ä½œç”¨ã€‚</p><h2>é…ç½®é¡¹</h2><p>æ‰“å¼€Sparkå®˜ç½‘çš„<a href=\"http://spark.apache.org/docs/latest/configuration.html\">Configurationé¡µé¢</a>ï¼Œåœ¨è¿™é‡Œä½ èƒ½æ‰¾åˆ°å…¨éƒ¨çš„Sparké…ç½®é¡¹ã€‚</p><p>ä¸è¿‡ï¼Œè®©äººæ²®ä¸§çš„æ˜¯ï¼Œé…ç½®é¡¹æ•°ç›®è¿‡äºåºå¤§ï¼Œç§ç±»ç¹å¤šï¼Œæœ‰çš„éœ€è¦è®¾ç½®true/falseï¼Œæœ‰çš„åˆ™éœ€è¦æˆ‘ä»¬ç»™å‡ºæ˜ç¡®çš„æ•°å€¼ï¼Œè®©äººçœ‹ä¸Šå»çœ¼èŠ±ç¼­ä¹±ã€æ— æ‰€é€‚ä»ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b2/4c/b28bd6e736f3634yy5ee74bd3027624c.png?wh=793x646\" alt=\"å›¾ç‰‡\" title=\"é…ç½®é¡¹ç¤ºæ„å›¾\"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œé¢å¯¹è¿™ä¹ˆå¤šçš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬åº”è¯¥ä»å“ªé‡Œå…¥æ‰‹å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œæ—¢ç„¶æˆ‘ä»¬çš„ç›®çš„æ˜¯è®©è½¦å­â€œè·‘å¾—ç¨³â€ã€â€œè·‘å¾—å¿«â€ï¼Œé‚£å’±ä»¬ä¸å¦¨ä»è¿™ä¸¤ä¸ªè§’åº¦å‡ºå‘ï¼Œæ¥æ•´ç†é‚£äº›æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„é…ç½®é¡¹ã€‚</p><!-- [[[read_end]]] --><p>åœ¨è¿™ä¸€è®²ï¼Œå’±ä»¬å…ˆæ¥æ¢³ç†é‚£äº›<strong>èƒ½è®©Sparkè·‘å¾—ç¨³çš„é…ç½®é¡¹</strong>ï¼Œè€Œåœ¨åç»­ä»‹ç»Spark SQLçš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å»å…³æ³¨é‚£äº›ä¸â€œè·‘å¾—å¿«â€æœ‰å…³çš„éƒ¨åˆ†ã€‚</p><p>å…³äºè·‘å¾—ç¨³è¿™ä»¶äº‹ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šâ€œä¸€èˆ¬çš„è½¦å­ï¼Œå‡ºå‚å°±èƒ½å¼€ï¼Œå¹¶ä¸éœ€è¦ç‰¹åˆ«è°ƒæ•´ä»€ä¹ˆè½¦è¾†å‚æ•°ã€‚åŒç†ï¼Œå¤§éƒ¨åˆ†Sparké…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œå¼€å‘è€…ä½¿ç”¨å‡ºå‚è®¾ç½®ã€çœå»è°ƒå‚çš„éº»çƒ¦ï¼Œå®ƒä¸é¦™å—ï¼Ÿâ€ é—æ†¾çš„æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯æ¥è¯´ï¼Œåœ¨é»˜è®¤çš„å‚æ•°è®¾ç½®ä¸‹ï¼ŒSparkè¿˜çœŸå°±è·‘ä¸èµ·æ¥ã€‚</p><p>ä»¥spark.executor.memoryè¿™ä¸ªé…ç½®é¡¹ä¸ºä¾‹ï¼Œå®ƒç”¨äºæŒ‡å®šExecutor memoryï¼Œä¹Ÿå°±æ˜¯Executorå¯ç”¨å†…å­˜ä¸Šé™ã€‚è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯1GBï¼Œæ˜¾ç„¶ï¼Œå¯¹äºåŠ¨è¾„ä¸Šç™¾GBã€ç”šè‡³ä¸ŠTBé‡çº§çš„å·¥ä¸šçº§æ•°æ®æ¥è¯´ï¼Œè¿™æ ·çš„è®¾ç½®å¤ªä½äº†ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡å¾ˆå®¹æ˜“å› ä¸ºOOMï¼ˆå†…å­˜æº¢å‡ºï¼ŒOut of memoryï¼‰è€Œä¸­æ–­ã€‚</p><p>ä½ çœ‹ï¼Œä¸ºäº†èƒ½è®©Sparkè·‘å¾—ç¨³ï¼Œå’±ä»¬è¿˜æ˜¯å¾—èŠ±äº›å¿ƒæ€ã€‚å¯¹äºåˆšæ‰è¯´çš„æƒ…å†µï¼Œå¦‚æœä½ ä»¥ä¸ºç›´æ¥æŠŠå†…å­˜å‚æ•°è®¾ç½®åˆ°ä¸Šç™¾GBï¼Œå°±å¯ä»¥ä¸€åŠ³æ°¸é€¸ï¼Œé‚£æœªå…æœ‰äº›è‰ç‡ã€‚å•çº¯ä»èµ„æºä¾›ç»™çš„è§’åº¦å»è°ƒæ•´é…ç½®é¡¹å‚æ•°ï¼Œæ˜¯ä¸€ç§â€œç®€å•ç²—æš´â€çš„åšæ³•ï¼Œå¹¶ä¸å¯å–ã€‚<strong>å®é™…ä¸Šï¼Œåº”ç”¨ç¨‹åºè¿è¡Œå¾—ç¨³å®šä¸å¦ï¼Œå–å†³äºç¡¬ä»¶èµ„æºä¾›ç»™ä¸è®¡ç®—éœ€è¦æ˜¯å¦åŒ¹é…</strong>ã€‚</p><p>è¿™å°±å¥½æ¯”æ˜¯èµ›è½¦ç»„è£…ï¼Œè¦å¾—åˆ°ä¸€è¾†é«˜æ€§èƒ½çš„è½¦å­ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ¯ä¸€ä¸ªéƒ¨ä»¶éƒ½è¾¾åˆ°â€œé¡¶é…â€çš„è¦æ±‚ï¼Œè€Œæ˜¯è¦è®©ç»„è£…é…ä»¶ä¹‹é—´ç›¸äº’å¥‘åˆã€åŒ¹é…ï¼Œæ‰èƒ½è®©è½¦å­è¾¾åˆ°é¢„æœŸçš„é©¬åŠ›è¾“å‡ºã€‚</p><p>å› æ­¤ï¼Œå’±ä»¬ä¸å¦¨ä»ç¡¬ä»¶èµ„æºçš„è§’åº¦åˆ‡å…¥ï¼Œå»æ¢ç´¢å¼€å‘è€…å¿…é¡»è¦å…³æ³¨çš„é…ç½®é¡¹éƒ½æœ‰å“ªäº›ã€‚æ—¢ç„¶ä¸Šé¢æˆ‘ä»¬ç”¨å†…å­˜ä¸¾ä¾‹ï¼Œè€Œä¸”å…³äºå†…å­˜çš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬åœ¨å†…å­˜ç®¡ç†é‚£ä¸€è®²ç®€å•æè¿‡ï¼Œä½ å¯èƒ½è¿˜æœ‰ä¸€äº›å°è±¡ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»å†…å­˜å…¥æ‰‹ï¼Œè¯´ä¸€è¯´å’Œå®ƒæœ‰å…³çš„é…ç½®é¡¹ã€‚</p><h3>å†…å­˜</h3><p>è¯´èµ·å†…å­˜ï¼Œå’±ä»¬ä¸å¦¨å…ˆæ¥å›é¡¾ä¸€ä¸‹Sparkçš„å†…å­˜åˆ’åˆ†ã€‚å¯¹äºç»™å®šçš„Executor Memoryï¼ŒSparkå°†JVM Heapåˆ’åˆ†ä¸º4ä¸ªåŒºåŸŸï¼Œåˆ†åˆ«æ˜¯Reserved Memoryã€User Memoryã€Execution Memoryå’ŒStorage Memoryï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>ä¸åŒå†…å­˜åŒºåŸŸçš„å«ä¹‰å’Œå®ƒä»¬çš„è®¡ç®—å…¬å¼ï¼Œæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/422400\">ç¬¬8è®²</a>åšè¿‡è¯¦ç»†è®²è§£ï¼Œå¦‚æœä½ å°è±¡ä¸æ·±äº†å¯ä»¥å›é¡¾ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹åˆ†æä¸€ä¸‹è¿™äº›å†…å­˜é…ç½®é¡¹æ•°å€¼çš„è®¾ç½®æ€è·¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/f0/9c2fd81c42cdab915f9a388683602df0.jpg?wh=1920x737\" alt=\"å›¾ç‰‡\" title=\"å†…å­˜é…ç½®é¡¹\"></p><p>ç»“åˆå›¾è§£ï¼Œå…¶ä¸­Reserved Memoryå¤§å°å›ºå®šä¸º300MBï¼Œå…¶ä»–3ä¸ªåŒºåŸŸçš„ç©ºé—´å¤§å°ï¼Œåˆ™æœ‰3ä¸ªé…ç½®é¡¹æ¥åˆ’å®šï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯spark.executor.memoryã€spark.memory.fractionã€spark.memory.storageFractionã€‚</p><p>ä¸ºäº†åç»­å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ†åˆ«æŠŠå®ƒä»¬ç®€ç§°ä¸ºMã€mfå’Œsfï¼Œå…¶ä¸­å¤§å†™çš„Mæ˜¯ç»å¯¹å€¼ï¼Œè€Œå°å†™çš„mfå’Œsféƒ½æ˜¯æ¯”ä¾‹å€¼ï¼Œè¿™ä¸€ç‚¹éœ€è¦ä½ æ³¨æ„ã€‚</p><p>å…¶ä¸­ï¼ŒMç”¨äºæŒ‡å®šåˆ’åˆ†ç»™Executorè¿›ç¨‹çš„JVM Heapå¤§å°ï¼Œä¹Ÿå³æ˜¯Executor Memoryã€‚Executor Memoryç”±Execution Memoryã€Storage Memoryå’ŒUser Memoryâ€œè¿™ä¸‰å®¶â€ç“œåˆ†ã€‚</p><p>ï¼ˆM â€“ 300ï¼‰* mfåˆ’åˆ†ç»™Execution Memoryå’ŒStorage Memoryï¼Œè€ŒUser Memoryç©ºé—´å¤§å°ç”±ï¼ˆM â€“ 300ï¼‰*ï¼ˆ1 - mfï¼‰è¿™ä¸ªå…¬å¼åˆ’å®šï¼Œå®ƒç”¨äºå­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ï¼ŒRDDç®—å­ä¸­åŒ…å«çš„å„ç±»å®ä¾‹åŒ–å¯¹è±¡æˆ–æ˜¯é›†åˆç±»å‹ï¼ˆå¦‚æ•°ç»„ã€åˆ—è¡¨ç­‰ï¼‰ï¼Œéƒ½å±äºè¿™ä¸ªèŒƒç•´ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä½ çš„åˆ†å¸ƒå¼åº”ç”¨ï¼Œå¹¶ä¸éœ€è¦é‚£ä¹ˆå¤šè‡ªå®šä¹‰å¯¹è±¡æˆ–é›†åˆæ•°æ®ï¼Œä½ åº”è¯¥æŠŠmfçš„å€¼è®¾ç½®å¾—è¶Šæ¥è¿‘1è¶Šå¥½ï¼Œè¿™æ ·User Memoryæ— é™è¶‹è¿‘äº0ï¼Œå¤§é¢ç§¯çš„å¯ç”¨å†…å­˜å°±å¯ä»¥éƒ½ç•™ç»™Execution Memoryå’ŒStorage Memoryäº†ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨1.6ç‰ˆæœ¬ä¹‹åï¼Œ<strong>Sparkæ¨å‡ºäº†ç»Ÿä¸€çš„åŠ¨æ€å†…å­˜ç®¡ç†æ¨¡å¼</strong>ï¼Œåœ¨å¯¹æ–¹èµ„æºæœªè¢«ç”¨å°½çš„æ—¶å€™ï¼ŒExecution Memoryä¸Storage Memoryä¹‹é—´å¯ä»¥äº’ç›¸è¿›è¡ŒæŠ¢å ã€‚ä¸è¿‡ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦sfè¿™ä¸ªé…ç½®é¡¹æ¥åˆ’å®šå®ƒä»¬ä¹‹é—´çš„é‚£æ¡è™šçº¿ï¼Œä»è€Œæ˜ç¡®å‘ŠçŸ¥Sparkæˆ‘ä»¬å¼€å‘è€…æ›´å€¾å‘äºâ€œåè¢’â€å“ªä¸€æ–¹ã€‚</p><p>é‚£ä¹ˆå¯¹äºsfçš„è®¾ç½®ï¼Œå¼€å‘è€…è¯¥å¦‚ä½•è¿›è¡Œå–èˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯çœ‹æ•°æ®çš„å¤ç”¨é¢‘æ¬¡ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬åˆ†åœºæ™¯ä¸¾ä¾‹æ¥è¯´ã€‚</p><p>å¯¹äºETLï¼ˆExtractã€Transformã€Loadï¼‰ç±»å‹çš„ä½œä¸šæ¥è¯´ï¼Œæ•°æ®å¾€å¾€éƒ½æ˜¯æŒ‰ç…§æ—¢å®šçš„ä¸šåŠ¡é€»è¾‘ä¾åºå¤„ç†ï¼Œå…¶ä¸­ç»å¤§å¤šæ•°çš„æ•°æ®å½¢æ€åªéœ€è®¿é—®ä¸€éï¼Œå¾ˆå°‘æœ‰é‡å¤å¼•ç”¨çš„æƒ…å†µã€‚</p><p>å› æ­¤ï¼Œåœ¨ETLä½œä¸šä¸­ï¼ŒRDD Cacheå¹¶ä¸èƒ½èµ·åˆ°æå‡æ‰§è¡Œæ€§èƒ½çš„ä½œç”¨ï¼Œé‚£ä¹ˆè‡ªç„¶æˆ‘ä»¬ä¹Ÿå°±æ²¡å¿…è¦ä½¿ç”¨ç¼“å­˜äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±åº”å½“æŠŠsfçš„å€¼è®¾ç½®å¾—ä½ä¸€äº›ï¼Œå‹ç¼©Storage Memoryå¯ç”¨ç©ºé—´ï¼Œä»è€Œå°½é‡æŠŠå†…å­˜ç©ºé—´ç•™ç»™Execution Memoryã€‚</p><p>ç›¸åï¼Œå¦‚æœä½ çš„åº”ç”¨åœºæ™¯æ˜¯æœºå™¨å­¦ä¹ ã€æˆ–æ˜¯å›¾è®¡ç®—ï¼Œè¿™äº›è®¡ç®—ä»»åŠ¡å¾€å¾€éœ€è¦åå¤æ¶ˆè€—ã€è¿­ä»£åŒä¸€ä»½æ•°æ®ï¼Œå¤„ç†æ–¹å¼å°±ä¸ä¸€æ ·äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå’±ä»¬è¦å……åˆ†åˆ©ç”¨RDD Cacheæä¾›çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œè‡ªç„¶å°±è¦æŠŠsfè¿™ä¸ªå‚æ•°è®¾ç½®å¾—ç¨å¤§ä¸€äº›ï¼Œä»è€Œè®©Storage Memoryæœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œæ¥å®¹çº³éœ€è¦é¢‘ç¹è®¿é—®çš„åˆ†å¸ƒå¼æ•°æ®é›†ã€‚</p><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜çš„3ä¸ªé…ç½®é¡¹ï¼Œæˆ‘ä»¬åˆ†åˆ«è§£è¯»äº†å®ƒä»¬çš„å«ä¹‰ï¼Œä»¥åŠè®¾ç½®çš„ä¸€èˆ¬æ€§åŸåˆ™ã€‚ä½ éœ€è¦æ ¹æ®ä½ çš„åº”ç”¨åœºæ™¯ï¼Œåˆç†è®¾ç½®è¿™äº›é…ç½®é¡¹ï¼Œè¿™æ ·ç¨‹åºè¿è¡Œæ‰ä¼šé«˜é€Ÿã€ç¨³å®šã€‚å­¦ä¼šäº†è¿™äº›ï¼Œå†…å­˜é…ç½®é¡¹è¿™ä¸€å…³ï¼Œä½ åŸºæœ¬ä¸Šå·²ç»æ‹¿åˆ°80åˆ†äº†ã€‚è€Œå‰©ä¸‹çš„20åˆ†ï¼Œéœ€è¦ä½ ä»æ—¥å¸¸å¼€å‘çš„åå¤å®è·µä¸­å»è·å–ï¼ŒæœŸå¾…ä½ æ€»ç»“å½’çº³å‡ºæ›´å¤šçš„é…ç½®ç»éªŒã€‚</p><p>åœ¨ç¡¬ä»¶èµ„æºæ–¹é¢ï¼Œå†…å­˜çš„æœåŠ¡å¯¹è±¡æ˜¯CPUã€‚å†…å­˜çš„æœ‰æ•ˆé…ç½®ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æ›´å¥½åœ°å®¹çº³æ•°æ®ï¼Œå¦ä¸€æ–¹é¢ï¼Œæ›´é‡è¦çš„å°±æ˜¯æå‡CPUçš„åˆ©ç”¨ç‡ã€‚é‚£è¯´å®Œå†…å­˜ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹CPUã€‚</p><h3>CPU</h3><p>ä¸CPUç›´æ¥ç›¸å…³çš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯spark.executor.instanceså’Œspark.executor.coresã€‚å…¶ä¸­å‰è€…æŒ‡å®šäº†é›†ç¾¤å†…Executorsçš„ä¸ªæ•°ï¼Œè€Œåè€…åˆ™æ˜ç¡®äº†æ¯ä¸ªExecutorså¯ç”¨çš„CPU Coresï¼ˆCPUæ ¸æ•°ï¼‰ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªCPU Coreåœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå› æ­¤ï¼Œ<strong>spark.executor.instancesä¸spark.executor.coresçš„ä¹˜ç§¯å®é™…ä¸Šå†³å®šäº†é›†ç¾¤çš„å¹¶å‘è®¡ç®—èƒ½åŠ›ï¼Œè¿™ä¸ªä¹˜ç§¯ï¼Œæˆ‘ä»¬æŠŠå®ƒå®šä¹‰ä¸ºâ€œå¹¶å‘åº¦â€ï¼ˆDegree of concurrencyï¼‰</strong>ã€‚</p><p>è¯´åˆ°å¹¶å‘åº¦ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è¯´å¦å¤–ä¸€ä¸ªæ¦‚å¿µï¼šå¹¶è¡Œåº¦ï¼ˆDegree of parallismï¼‰ã€‚ç›¸æ¯”å¹¶å‘åº¦ï¼Œå¹¶è¡Œåº¦æ˜¯ä¸€ä¸ªé«˜åº¦ç›¸å…³ã€ä½†åˆå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚å¹¶è¡Œåº¦ç”¨äºå®šä¹‰åˆ†å¸ƒå¼æ•°æ®é›†åˆ’åˆ†çš„ä»½æ•°ä¸ç²’åº¦ï¼Œå®ƒç›´æ¥å†³å®šäº†åˆ†å¸ƒå¼ä»»åŠ¡çš„è®¡ç®—è´Ÿè½½ã€‚å¹¶è¡Œåº¦è¶Šé«˜ï¼Œæ•°æ®çš„ç²’åº¦è¶Šç»†ï¼Œæ•°æ®åˆ†ç‰‡è¶Šå¤šï¼Œæ•°æ®è¶Šåˆ†æ•£ã€‚</p><p>è¿™ä¹Ÿå°±è§£é‡Šäº†ï¼Œå¹¶è¡Œåº¦ä¸ºä»€ä¹ˆæ€»æ˜¯è·Ÿåˆ†åŒºæ•°é‡ã€åˆ†ç‰‡æ•°é‡ã€Partitions è¿™äº›å±æ€§ç›¸ä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç¬¬9è®²æˆ‘ä»¬å°±è¯´è¿‡ï¼Œå¹¶è¡Œåº¦å¯¹åº”ç€RDDçš„æ•°æ®åˆ†åŒºæ•°é‡ã€‚</p><p>ä¸å¹¶è¡Œåº¦ç›¸å…³çš„é…ç½®é¡¹ä¹Ÿæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯spark.default.parallelismå’Œspark.sql.shuffle.partitionsã€‚å…¶ä¸­å‰è€…å®šä¹‰äº†ç”±SparkContext.parallelize APIæ‰€ç”ŸæˆRDDçš„é»˜è®¤å¹¶è¡Œåº¦ï¼Œè€Œåè€…åˆ™ç”¨äºåˆ’å®šShuffleè¿‡ç¨‹ä¸­Shuffle Readé˜¶æ®µï¼ˆReduceé˜¶æ®µï¼‰çš„é»˜è®¤å¹¶è¡Œåº¦ã€‚</p><p>å¯¹æ¯”ä¸‹æ¥ï¼Œå¹¶å‘åº¦çš„å‡ºå‘ç‚¹æ˜¯è®¡ç®—èƒ½åŠ›ï¼Œå®ƒä¸æ‰§è¡Œå†…å­˜ä¸€èµ·ï¼Œå…±åŒæ„æˆäº†è®¡ç®—èµ„æºçš„ä¾›ç»™æ°´å¹³ï¼Œè€Œå¹¶è¡Œåº¦çš„å‡ºå‘ç‚¹æ˜¯æ•°æ®ï¼Œå®ƒå†³å®šç€æ¯ä¸ªä»»åŠ¡çš„è®¡ç®—è´Ÿè½½ï¼Œå¯¹åº”ç€è®¡ç®—èµ„æºçš„éœ€æ±‚æ°´å¹³ã€‚ä¸€ä¸ªæ˜¯ä¾›ç»™ï¼Œä¸€ä¸ªæ˜¯éœ€æ±‚ï¼Œä¾›éœ€çš„å¹³è¡¡ä¸å¦ï¼Œç›´æ¥å½±å“ç€ç¨‹åºè¿è¡Œçš„ç¨³å®šæ€§ã€‚</p><h3>CPUã€å†…å­˜ä¸æ•°æ®çš„å¹³è¡¡</h3><p>ç”±æ­¤å¯è§ï¼Œæ‰€è°“ä¾›éœ€çš„å¹³è¡¡ï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‡CPUã€å†…å­˜ä¸æ•°æ®ä¹‹é—´çš„å¹³è¡¡ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆé‡åŒ–çš„åŠæ³•ï¼Œæ¥è®©ä¸‰è€…ä¹‹é—´è¾¾åˆ°ä¾›éœ€ä¹‹é—´å¹³è¡¡çš„çŠ¶æ€å‘¢ï¼Ÿå…¶å®ï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„å…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠç”±é…ç½®é¡¹spark.executor.coresæŒ‡å®šçš„CPU Coresè®°ä¸ºcï¼ŒæŠŠExecution Memoryå†…å­˜å¤§å°è®°ä¸ºmï¼Œè¿˜è®°å¾—å—ï¼Ÿmçš„å°ºå¯¸ç”±å…¬å¼ï¼ˆM - 300ï¼‰* mf *ï¼ˆ1 - sfï¼‰ç»™å‡ºã€‚ä¸éš¾å‘ç°ï¼Œcå’Œmï¼Œä¸€åŒé‡åŒ–äº†ä¸€ä¸ªExecutorçš„å¯ç”¨è®¡ç®—èµ„æºã€‚</p><p>é‡åŒ–å®Œèµ„æºä¾›ç»™ï¼Œæˆ‘ä»¬æ¥ç€å†æ¥è¯´æ•°æ®ã€‚å¯¹äºä¸€ä¸ªå¾…è®¡ç®—çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæˆ‘ä»¬æŠŠå®ƒçš„å­˜å‚¨å°ºå¯¸è®°ä¸ºDï¼Œè€ŒæŠŠå…¶å¹¶è¡Œåº¦è®°å½•ä¸ºPã€‚ç»™å®šDå’ŒPï¼Œä¸éš¾æ¨å‡ºï¼ŒD/På°±æ˜¯åˆ†å¸ƒå¼æ•°æ®é›†çš„åˆ’åˆ†ç²’åº¦ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªæ•°æ®åˆ†ç‰‡çš„å­˜å‚¨å¤§å°ã€‚</p><p>å­¦ä¹ è¿‡è°ƒåº¦ç³»ç»Ÿï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Sparkåˆ†å¸ƒå¼è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæ•°æ®åˆ†ç‰‡å¯¹åº”ç€ä¸€ä¸ªTaskï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡ï¼‰ï¼Œè€Œä¸€ä¸ªTaskåˆå¯¹åº”ç€ä¸€ä¸ªCPU Coreã€‚å› æ­¤ï¼ŒæŠŠæ•°æ®çœ‹ä½œæ˜¯è®¡ç®—çš„éœ€æ±‚æ–¹ï¼Œè¦æƒ³è¾¾åˆ°CPUã€å†…å­˜ä¸æ•°æ®è¿™ä¸‰è€…ä¹‹é—´çš„å¹³è¡¡ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯æ¯ä¸ªTaskéƒ½æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ¥è®©CPUå¤„ç†å¯¹åº”çš„æ•°æ®åˆ†ç‰‡ã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦è®©æ•°æ®åˆ†ç‰‡å¤§å°ä¸Taskå¯ç”¨å†…å­˜ä¹‹é—´ä¿æŒåœ¨åŒä¸€é‡çº§ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼æ¥è¿›è¡Œé‡åŒ–ã€‚</p><pre><code class=\"language-scala\">D/P ~ m/c\n</code></pre><p>å…¶ä¸­ï¼Œæ³¢æµªçº¿çš„å«ä¹‰ï¼Œæ˜¯å…¶å·¦ä¾§ä¸å³ä¾§çš„è¡¨è¾¾å¼åœ¨åŒä¸€é‡çº§ã€‚å·¦ä¾§çš„è¡¨è¾¾å¼D/Pä¸ºæ•°æ®åˆ†ç‰‡å¤§å°ï¼Œå³ä¾§çš„m/cä¸ºæ¯ä¸ªTaskåˆ†åˆ°çš„å¯ç”¨å†…å­˜ã€‚ä»¥è¿™ä¸ªå…¬å¼ä¸ºæŒ‡å¯¼ï¼Œç»“åˆåˆ†å¸ƒå¼æ•°æ®é›†çš„å­˜å‚¨å¤§å°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰çš„æ”¾çŸ¢ã€æœ‰è¿¹å¯å¾ªåœ°å¯¹ä¸Šè¿°çš„3ç±»é…ç½®é¡¹è¿›è¡Œè®¾ç½®æˆ–è°ƒæ•´ï¼Œä¹Ÿå°±æ˜¯ä¸CPUã€å†…å­˜å’Œå¹¶è¡Œåº¦æœ‰å…³çš„é‚£å‡ ä¸ªé…ç½®é¡¹ã€‚</p><h3>ç£ç›˜</h3><p>è¯´å®Œäº†CPUå’Œå†…å­˜ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ç£ç›˜ã€‚ä¸å‰ä¸¤è€…ç›¸æ¯”ï¼Œç£ç›˜çš„é…ç½®é¡¹ç›¸å¯¹è¦ç®€å•å¾—å¤šï¼Œå€¼å¾—æˆ‘ä»¬å…³æ³¨çš„ï¼Œä»…æœ‰spark.local.dirè¿™ä¸€ä¸ªé…ç½®é¡¹ï¼Œä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œåç»­æˆ‘ä»¬æŠŠå®ƒç®€ç§°ä¸ºldã€‚è¿™ä¸ªé…ç½®é¡¹çš„å€¼å¯ä»¥æ˜¯ä»»æ„çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯/tmpç›®å½•ã€‚</p><p>ldå‚æ•°å¯¹åº”çš„ç›®å½•ç”¨äºå­˜å‚¨å„ç§å„æ ·çš„ä¸´æ—¶æ•°æ®ï¼Œå¦‚Shuffleä¸­é—´æ–‡ä»¶ã€RDD Cacheï¼ˆå­˜å‚¨çº§åˆ«åŒ…å«â€œdiskâ€ï¼‰ï¼Œç­‰ç­‰ã€‚è¿™äº›ä¸´æ—¶æ•°æ®ï¼Œå¯¹ç¨‹åºèƒ½å¦ç¨³å®šè¿è¡Œï¼Œæœ‰ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p><p>ä¾‹å¦‚ï¼ŒShuffleä¸­é—´æ–‡ä»¶æ˜¯Reduceé˜¶æ®µä»»åŠ¡æ‰§è¡Œçš„åŸºç¡€å’Œå‰æï¼Œå¦‚æœä¸­é—´æ–‡ä»¶ä¸¢å¤±ï¼ŒSparkåœ¨Reduceé˜¶æ®µå°±ä¼šæŠ›å‡ºâ€œShuffle data not foundâ€å¼‚å¸¸ï¼Œä»è€Œä¸­æ–­åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚</p><p>æ—¢ç„¶è¿™äº›ä¸´æ—¶æ•°æ®ä¸å¯æˆ–ç¼ºï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç›²ä»é»˜è®¤é€‰é¡¹äº†ï¼Œè€Œæ˜¯æœ‰å¿…è¦å…ˆè€ƒå¯Ÿä¸‹/tmpç›®å½•çš„æƒ…å†µã€‚é—æ†¾çš„æ˜¯ï¼Œldå‚æ•°é»˜è®¤çš„/tmpç›®å½•ä¸€æ¥å­˜å‚¨ç©ºé—´æœ‰é™ï¼ŒäºŒæ¥è¯¥ç›®å½•æœ¬èº«çš„ç¨³å®šæ€§ä¹Ÿå€¼å¾—æ‹…å¿§ã€‚å› æ­¤ï¼Œåœ¨å·¥ä¸šçº§åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¸èƒ½æ¥å—ä½¿ç”¨/tmpç›®å½•æ¥è®¾ç½®ldé…ç½®é¡¹ã€‚</p><p>äº†è§£äº†ldè¿™ä¸ªé…ç½®é¡¹çš„ä½œç”¨ä¹‹åï¼Œæˆ‘ä»¬è‡ªç„¶å°±èƒ½æƒ³åˆ°ï¼Œåº”è¯¥æŠŠå®ƒè®¾ç½®åˆ°ä¸€ä¸ªå­˜å‚¨ç©ºé—´å……æ²›ã€ç”šè‡³æ€§èƒ½æ›´æœ‰ä¿éšœçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ç©ºé—´è¶³å¤Ÿå¤§çš„SSDï¼ˆSolid State Diskï¼‰æ–‡ä»¶ç³»ç»Ÿç›®å½•ã€‚</p><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»‹ç»äº†ä¸CPUã€å†…å­˜ã€ç£ç›˜æœ‰å…³çš„é…ç½®é¡¹ï¼Œä»¥åŠå®ƒä»¬çš„å«ä¹‰ã€ä½œç”¨ä¸è®¾ç½®æŠ€å·§ã€‚è¯´åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½æœ‰äº›æŒ‰æºä¸ä½ï¼šâ€œè¿™äº›é…ç½®é¡¹çš„é‡è¦æ€§æˆ‘å·²ç»getåˆ°äº†ï¼Œé‚£æˆ‘åº”è¯¥åœ¨å“ªé‡Œè®¾ç½®å®ƒä»¬å‘¢ï¼Ÿâ€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­æ¥è¯´è¯´ï¼Œå¼€å‘è€…éƒ½å¯ä»¥é€šè¿‡å“ªäº›é€”å¾„æ¥è®¾ç½®é…ç½®é¡¹ã€‚</p><h2>é…ç½®é¡¹çš„è®¾ç½®é€”å¾„</h2><p>ä¸ºäº†æ»¡è¶³ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼ŒSparkä¸ºå¼€å‘è€…æä¾›äº†3ç§é…ç½®é¡¹è®¾ç½®æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°å’ŒSparkConfå¯¹è±¡ï¼Œè¿™äº›æ–¹å¼éƒ½ä»¥ï¼ˆKeyï¼ŒValueï¼‰é”®å€¼å¯¹çš„å½¢å¼è®°å½•å¹¶è®¾ç½®é…ç½®é¡¹ã€‚</p><p>é…ç½®æ–‡ä»¶æŒ‡çš„æ˜¯spark-defaults.confï¼Œè¿™ä¸ªæ–‡ä»¶å­˜å‚¨åœ¨Sparkå®‰è£…ç›®å½•ä¸‹é¢çš„confå­ç›®å½•ã€‚è¯¥æ–‡ä»¶ä¸­çš„å‚æ•°è®¾ç½®é€‚ç”¨äºé›†ç¾¤èŒƒå›´å†…æ‰€æœ‰çš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤å®ƒçš„ç”Ÿæ•ˆèŒƒå›´æ˜¯å…¨å±€æ€§çš„ã€‚å¯¹äºä»»æ„ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰é€šè¿‡å…¶ä»–æ–¹å¼è®¾ç½®é…ç½®é¡¹ï¼Œé‚£ä¹ˆåº”ç”¨å°†é»˜è®¤é‡‡ç”¨spark-defaults.confä¸­çš„å‚æ•°å€¼ä½œä¸ºåŸºç¡€è®¾ç½®ã€‚</p><p>åœ¨spark-defaults.confä¸­è®¾ç½®é…ç½®é¡¹ï¼Œä½ åªéœ€è¦ç”¨ç©ºæ ¼æŠŠé…ç½®é¡¹çš„åå­—å’Œå®ƒçš„è®¾ç½®å€¼åˆ†éš”å¼€å³å¯ã€‚æ¯”å¦‚ï¼Œä»¥spark.executor.coresã€spark.executor.memoryå’Œspark.local.dirè¿™3ä¸ªé…ç½®é¡¹ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼å¯¹å®ƒä»¬çš„å€¼è¿›è¡Œè®¾ç½®ã€‚</p><pre><code class=\"language-scala\">spark.executor.cores 2\nspark.executor.memory 4g\nspark.local.dir /ssd_fs/large_dir\n</code></pre><p>ä¸è¿‡ï¼Œåœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œä¸åŒåº”ç”¨å¯¹äºèµ„æºçš„è¯‰æ±‚æ˜¯ä¸ä¸€æ ·çš„ï¼šæœ‰äº›éœ€è¦æ›´å¤šçš„CPU Coresï¼Œæœ‰äº›åˆ™éœ€è¦æ›´é«˜çš„å¹¶è¡Œåº¦ï¼Œå‡¡æ­¤ç§ç§ã€ä¸ä¸€è€Œè¶³ï¼Œå¯è°“æ˜¯ä¼—å£éš¾è°ƒï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªä¾èµ–spark-defaults.confæ¥è¿›è¡Œå…¨å±€è®¾ç½®å°±ä¸çµäº†ã€‚</p><p>ä¸ºæ­¤ï¼ŒSparkä¸ºå¼€å‘è€…æä¾›äº†ä¸¤ç§åº”ç”¨çº§åˆ«çš„è®¾ç½®æ–¹å¼ï¼Œä¹Ÿå³å‘½ä»¤è¡Œå‚æ•°å’ŒSparkConfå¯¹è±¡ï¼Œå®ƒä»¬çš„ç”Ÿæ•ˆèŒƒå›´ä»…é™äºåº”ç”¨æœ¬èº«ï¼Œæˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹è¿™ä¸¤ç§æ–¹å¼å…·ä½“æ€ä¹ˆç”¨ã€‚</p><p>å…ˆè¯´å‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨è¿è¡Œäº†spark-shellæˆ–æ˜¯spark-submitå‘½ä»¤ä¹‹åï¼Œé€šè¿‡â€“confå…³é”®å­—æ¥è®¾ç½®é…ç½®é¡¹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œspark-shellç”¨äºå¯åŠ¨äº¤äº’å¼çš„åˆ†å¸ƒå¼è¿è¡Œç¯å¢ƒï¼Œè€Œspark-submitåˆ™ç”¨äºå‘Sparkè®¡ç®—é›†ç¾¤æäº¤åˆ†å¸ƒå¼ä½œä¸šã€‚</p><p>è¿˜æ˜¯ä»¥åˆšåˆšçš„3ä¸ªé…ç½®é¡¹ä¸ºä¾‹ï¼Œä»¥å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼è¿›è¡Œè®¾ç½®çš„è¯ï¼Œä½ éœ€è¦åœ¨æäº¤spark-shellæˆ–æ˜¯spark-submitå‘½ä»¤çš„æ—¶å€™ï¼Œä»¥â€“conf Key=Valueçš„å½¢å¼å¯¹å‚æ•°è¿›è¡Œèµ‹å€¼ã€‚</p><pre><code class=\"language-shell\">spark-shell --master local[*] --conf spark.executor.cores=2 --conf spark.executor.memory=4g --conf spark.local.dir=/ssd_fs/large_dir\n</code></pre><p>ä¸éš¾å‘ç°ï¼Œå°½ç®¡è¿™ç§æ–¹å¼èƒ½è®©å¼€å‘è€…åœ¨åº”ç”¨çº§åˆ«çµæ´»åœ°è®¾ç½®é…ç½®é¡¹ï¼Œä½†å®ƒçš„ä¹¦å†™æ–¹å¼è¿‡äºç¹çï¼Œæ¯ä¸ªé…ç½®é¡¹éƒ½éœ€è¦ä»¥â€“confä½œå‰ç¼€ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå‘½ä»¤è¡Œå‚æ•°çš„è®¾ç½®æ–¹å¼ä¸åˆ©äºä»£ç ç®¡ç†ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‚æ•°å€¼çš„è®¾ç½®å¾ˆå¯èƒ½ä¼šéšç€æ•°æ®é‡æˆ–æ˜¯é›†ç¾¤å®¹é‡çš„å˜åŒ–è€Œå˜åŒ–ï¼Œä½†æ˜¯è¿™ä¸ªå˜åŒ–çš„è¿‡ç¨‹å´å¾ˆéš¾è¢«è®°å½•å¹¶ç»´æŠ¤ä¸‹æ¥ï¼Œè€Œè¿™æ— ç–‘ä¼šå¢åŠ å¼€å‘è€…ä¸è¿ç»´åŒå­¦çš„è¿ç»´æˆæœ¬ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸è®ºæ˜¯éš”ç¦»æ€§è¿˜æ˜¯å¯ç»´æŠ¤æ€§ï¼ŒSparkConfå¯¹è±¡çš„è®¾ç½®æ–¹å¼éƒ½æ›´èƒœä¸€ç­¹ã€‚åœ¨ä»£ç å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰SparkConfå¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶setæ–¹æ³•æ¥å¯¹é…ç½®é¡¹è¿›è¡Œè®¾ç½®ã€‚è€è§„çŸ©ï¼Œè¿˜æ˜¯ç”¨åˆšåˆšçš„CPUã€å†…å­˜å’Œç£ç›˜3ä¸ªé…ç½®é¡¹æ¥ä¸¾ä¾‹ã€‚</p><pre><code class=\"language-scala\">import org.apache.spark.SparkConf\nval conf = new SparkConf()\nconf.set(\"spark.executor.cores\", \"2\")\nconf.set(\"spark.executor.memory\", \"4g\")\nconf.set(\"spark.local.dir\", \"/ssd_fs/large_dir\")&nbsp; &nbsp;\n</code></pre><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢³ç†äº†CPUã€å†…å­˜ã€ç£ç›˜çš„ç›¸å…³é…ç½®é¡¹ï¼Œå¹¶é‡ç‚¹å¼ºè°ƒäº†CPUã€å†…å­˜ä¸æ•°æ®ä¹‹é—´çš„ä¾›éœ€å¹³è¡¡ã€‚æŒæ¡äº†è¿™äº›è®¾ç½®æ–¹æ³•ä¸è¦ç‚¹ä¹‹åï¼Œä½ ä¸å¦¨è‡ªå·±åŠ¨æ‰‹å»è¯•è¯•è¿™äº›é…ç½®é¡¹ï¼Œå¯ä»¥æ‹¿ä¹‹å‰çš„Word Countå°ä¾‹å­ç»ƒç»ƒæ‰‹ï¼Œå·©å›ºä¸€ä¸‹ä»Šå¤©æ‰€å­¦çš„å†…å®¹ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»CPUã€å†…å­˜å’Œç£ç›˜ä¸‰ä¸ªæ–¹é¢ï¼Œè®²è§£äº†å½±å“åº”ç”¨ç¨‹åºç¨³å®šæ€§çš„å‡ ä¸ªé‡è¦å‚æ•°ã€‚ä½ éœ€è¦æŒæ¡å®ƒä»¬çš„å«ä¹‰ã€ä½œç”¨è¿˜æœ‰é€‚ç”¨åœºæ™¯ï¼Œä¸ºäº†æ–¹ä¾¿ä½ è®°å¿†ï¼Œæˆ‘æŠŠå®ƒä»¬æ•´ç†åˆ°åé¢çš„è¡¨æ ¼é‡Œï¼Œä½ å¯ä»¥éšæ—¶æ‹¿æ¥å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/89/31/8999f0916b187768e35a4e0e5fdf9d31.jpg?wh=1920x1259\" alt=\"å›¾ç‰‡\" title=\"é…ç½®é¡¹åŠå…¶å«ä¹‰\"></p><p>ç†Ÿæ‚‰äº†è¿™äº›å…³é”®é…ç½®é¡¹ä¹‹åï¼Œä½ è¿˜éœ€è¦äº†è§£å®ƒä»¬çš„è®¾ç½®æ–¹å¼ã€‚Sparkæä¾›äº†3ç§é…ç½®é¡¹è®¾ç½®é€”å¾„ï¼Œåˆ†åˆ«æ˜¯spark-defaults.confé…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°å’ŒSparkConfå¯¹è±¡ã€‚å…¶ä¸­ç¬¬ä¸€ç§æ–¹å¼ç”¨äºå…¨å±€è®¾ç½®ï¼Œè€Œåä¸¤è€…çš„é€‚ç”¨èŒƒå›´æ˜¯åº”ç”¨æœ¬èº«ã€‚</p><p>å¯¹äºè¿™3ç§æ–¹å¼ï¼Œ<strong>Sparkä¼šæŒ‰ç…§â€œSparkConfå¯¹è±¡ -&gt; å‘½ä»¤è¡Œå‚æ•° -&gt; é…ç½®æ–‡ä»¶â€çš„é¡ºåºï¼Œä¾æ¬¡è¯»å–é…ç½®é¡¹çš„å‚æ•°å€¼</strong>ã€‚å¯¹äºé‡å¤è®¾ç½®çš„é…ç½®é¡¹ï¼ŒSparkä»¥å‰é¢çš„å‚æ•°å–å€¼ä¸ºå‡†ã€‚</p><h2>æ¯è¯¾ä¸€ç»ƒ</h2><p>è¯·ä½ ç²—ç•¥åœ°è¿‡ä¸€éSparkå®˜ç½‘ä¸­çš„ <a href=\"http://spark.apache.org/docs/latest/configuration.html\">Configurationé¡µé¢</a>ï¼Œè¯´ä¸€è¯´ï¼Œå…¶ä¸­å“ªäº›é…ç½®é¡¹é€‚åˆåœ¨spark-defaults.confä¸­è¿›è¡Œè®¾ç½®ï¼Œè€Œå“ªäº›é…ç½®é¡¹ä½¿ç”¨SparkConfå¯¹è±¡çš„æ–¹å¼æ¥è®¾ç½®æ¯”è¾ƒå¥½ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµã€‚å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¨èä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æœ‰éœ€è¦çš„çš„åŒäº‹ã€æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p>","comments":[{"had_liked":false,"id":315983,"user_name":"Geek_2dfa9a","can_delete":false,"product_type":"c1","uid":1435535,"ip_address":"","ucode":"B5FE7971F5E773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","comment_is_top":true,"comment_ctime":1634093570,"is_pvip":false,"replies":[{"id":"114521","content":"å…ˆä¸è¯´æ¯ä¸€ç±»é…ç½®é¡¹çš„è®¾ç½®ä½ç½®æ˜¯å¦åˆç†ï¼Œå•è¯´è€å¼Ÿæ·±å…¥é’»ç ”çš„ç²¾ç¥ï¼Œå°¤ä¸ºå¯å˜‰ï¼ï¼ï¼é¡ºä¾¿ä¸€æï¼ŒIDå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œè¿™æ ·å¤§å®¶å¯¹ä½ å°è±¡æ›´æ·±~<br><br>ä¸ºäº†é™ä½å¤§å®¶çš„å­¦ä¹ æˆæœ¬ï¼Œå’±ä»¬ç¡®å®æ²¡æœ‰é€ä¸ªè®²è§£æ¯ä¸€ç±»é…ç½®é¡¹ï¼ŒConfigurationé¡µé¢ç¡®å®æä¾›äº†ç§ç±»ç¹å¤šçš„é…ç½®é€‰é¡¹ï¼Œå¯¹äºåˆšå…¥é—¨çš„åŒå­¦éå¸¸ä¸å‹å¥½ã€‚è€å¼Ÿè®¤çœŸåœ°æŠŠæ¯ä¸€ç±»éƒ½è¿‡äº†ä¸€éï¼Œè€Œä¸”éƒ½åˆ†æäº†é…ç½®é¡¹çš„è®¾ç½®é¡ºåºï¼ŒçœŸçš„å¾ˆèµğŸ‘ï¼ï¼ï¼<br><br>è¿™é‡Œå’±ä»¬ä¸å»æ·±ç©¶å…·ä½“æ¯ä¸€ç±»åˆ°åº•åº”è¯¥è®¾ç½®åœ¨å“ªä¸ªlevelï¼Œå…¶å®åªè¦æŠŠæ¡ä½é…ç½®é¡¹çš„ä¸€åŠè®¾ç½®åŸåˆ™ï¼ŒåŸºæœ¬ä¸Šå°±ä¸ä¼šæœ‰å¤ªå¤§çš„é—®é¢˜ã€‚å¯¹äºä¸åŒï¼ˆç§ç±»ï¼‰çš„é…ç½®é¡¹ï¼Œå¯ä»¥followä¸‹é¢çš„è®¾ç½®åŸåˆ™ï¼ˆå…¶å®ä½ æŠŠä½ åˆ†æçš„æ¯ä¸ªç¯èŠ‚æ±‡æ€»ï¼Œèƒ½å¾—å‡ºä¸€æ ·çš„ç»“è®ºï¼‰ï¼š<br>1. ç¡¬ä»¶èµ„æºç±»çš„ï¼ˆèµ„æºä¾›ç»™ç±»ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œï¼‰ï¼Œspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼›<br>2. å…¨å±€æœåŠ¡ç±»çš„ï¼ˆæ¯”å¦‚åŠ¨æ€æ‰©å®¹ã€External shuffle servicesï¼Œå®‰å…¨ï¼Œå‹ç¼©ï¼ŒSpark UIï¼Œç­‰ç­‰ï¼‰ï¼Œspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼›<br>3. ä»»åŠ¡ç²’åº¦çš„é…ç½®ï¼ˆå¦‚Taské‡è¯•ã€locality waitã€æ˜¯å¦æ¨æ–­speculative taskï¼Œç­‰ç­‰ï¼‰ï¼Œç”¨å‘½ä»¤è¡Œï¼Œæˆ–æ˜¯SparkConfï¼Œæ¨èç”¨SparkConfï¼Œå‘½ä»¤è¡Œä¸å¥½ç®¡ç†~","user_name":"ä½œè€…å›å¤","comment_id":315983,"uid":"1043100","ip_address":"","utype":1,"ctime":1634137885,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"9.223372072848599e+18","product_id":100090001,"comment_content":"å…³äºä½•æ—¶ä½•å¤„é…ç½®Propertyè¿™ä¸€å—ï¼Œå®˜ç½‘æ–‡æ¡£æœ‰æåŠï¼Œå±æ€§ä¸»è¦åˆ†ä¸ºä¸¤å—ï¼šdeployç›¸å…³å’ŒSpark Runtime Controlï¼ˆä¸ªäººç†è§£æ˜¯ä»»åŠ¡è¿è¡Œç›¸å…³ï¼Œ<br>å³Driverï¼Œä»»åŠ¡åŠå…¶ç›¸å…³èµ„æºï¼‰ç›¸å…³ã€‚å‰é¢çš„æ¯”å¦‚â€œspark.driver.memoryâ€, â€œspark.executor.instancesâ€ï¼Œé€‚åˆæ”¾åœ¨spark-defaults.conf<br>åé¢çš„æ¯”å¦‚â€œspark.task.maxFailuresâ€ï¼Œé€‚åˆåœ¨SparkConfï¼ˆDriverï¼‰&#47;spark-submitå‘½ä»¤ä¸­æŒ‡å®šã€‚å…³äºä¸¤å¤„å±æ€§çš„è¦†ç›–é—®é¢˜ï¼š<br>é€šå¸¸æƒ…å†µä¼˜å…ˆçº§æœ€é«˜çš„æ˜¯SparkConfï¼Œå…¶æ¬¡æ˜¯spark-submitï¼Œæœ€åæ˜¯spark-defaults.confï¼Œå½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œâ€œspark.driver.memoryâ€, <br>â€œspark.executor.instancesâ€è¿™ä¸¤ä¸ªå±æ€§åœ¨SparkConfè®¾ç½®ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚<br>å±æ€§æ˜¯ä¹Ÿæ˜¯ç»†åˆ†çš„ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£åˆ†ç±»ï¼š<br>Application Properties è¿™å—ä¸»è¦æ˜¯ä»»åŠ¡ç›¸å…³çš„ï¼Œåº”è¯¥å¯¹åº”å¼€å‘è‡ªå·±è®¾ç½®ï¼Œä»ç”Ÿäº§è§’åº¦æ¥çœ‹ï¼Œæˆ‘è§‰å¾—æ¯ä¸ªä»»åŠ¡å¿…é¡»è®¾ç½®ï¼Œç”šè‡³ä¸åº”è¯¥æœ‰é»˜è®¤å€¼ã€‚<br>Runtime Environment ä»»åŠ¡è¿è¡Œç›¸å…³ï¼Œæ¯”å¦‚ä¾èµ–å­˜æ”¾çš„ä½ç½®ï¼Œè¿™å—å¯ä»¥ç»Ÿä¸€è®¾ç½®ï¼ŒæŒ‰éœ€åœ¨ä»»åŠ¡é‡Œè¦†ç›–<br>Shuffle Behavior shuffleè¡Œä¸ºï¼Œå¤§éƒ¨åˆ†åspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼Œâ€œspark.shuffle.service.enabledâ€é…ç½®å€¼å¾—ä¸€æï¼Œ<br>å¼€å¯åå¯ä»¥ç”±ç»Ÿä¸€æœåŠ¡ç»´æŠ¤shuffleçš„æ•°æ®æ–‡ä»¶ï¼Œé¿å…Executor shuffleæ—¶æ„å¤–ç»ˆæ­¢å¯¼è‡´çš„æ‰¾ä¸åˆ°shuffleæ–‡ä»¶ã€‚<br>Spark UI<br>Compression and Serialization å‹ç¼©å’Œåºåˆ—åŒ–ï¼Œåœ¨ä»»åŠ¡é‡ŒæŒ‰éœ€è®¾ç½®ï¼Œä¸»è¦é™ä½ç½‘ç»œIOè´Ÿè½½ï¼Œä½†æ˜¯è‚¯å®šä¼šå¸¦æ¥CPUé¢å¤–å¼€é”€<br>Memory Management å†…å­˜ï¼Œç»Ÿä¸€è®¾ç½®ï¼ŒæŒ‰éœ€åœ¨ä»»åŠ¡é‡Œè¦†ç›–<br>Execution Behavior æ‰§è¡Œç›¸å…³ï¼Œç»Ÿä¸€è®¾ç½®ï¼ŒæŒ‰éœ€åœ¨ä»»åŠ¡é‡Œè¦†ç›–<br>Executor Metrics æ‰§è¡ŒæŒ‡æ ‡ï¼Œç»Ÿä¸€è®¾ç½®ï¼ŒæŒ‰éœ€åœ¨ä»»åŠ¡é‡Œè¦†ç›–ï¼Œè¿™å—æ˜¯ä¸æ˜¯ç”¨æ¥åˆ†ææ€§èƒ½ç“¶é¢ˆçš„ï¼Ÿ<br>Networkingå’ŒSchedulingéƒ½æ˜¯åspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼Œæ„Ÿè§‰æ²¡å•¥å¯ä»¥åœ¨ä»»åŠ¡é‡Œè®¾ç½®çš„<br>Barrier Execution Modeè¿™å—æˆ‘åˆ†æåº”è¯¥æ˜¯é¢å‘MPIæ¨¡å‹ï¼ˆæ¨¡å‹è®­ç»ƒï¼‰å’ŒBSPæ¨¡å‹ï¼ˆå›¾è®¡ç®—ï¼‰çš„ï¼Œåº”è¯¥ä¹Ÿæ˜¯å’Œä»»åŠ¡ç›¸å…³çš„ï¼Œè¯´å®è¯åé¢éƒ½ä¸æ€ä¹ˆçœ‹å¾—æ‡‚äº†ï¼Œéƒ½æ˜¯çŒœçš„<br>Dynamic Allocationï¼ŒThread Configurations è¿™ä¸¤ä¸ªæä¸å¤ªæ¸…æ¥š<br>Security å®‰å…¨ï¼Œåé›†ç¾¤éƒ¨ç½²æ–¹å‘çš„é…ç½®å¤šï¼Œå¯ä»¥ç»Ÿä¸€é…ç½®","like_count":9,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528224,"discussion_content":"å…ˆä¸è¯´æ¯ä¸€ç±»é…ç½®é¡¹çš„è®¾ç½®ä½ç½®æ˜¯å¦åˆç†ï¼Œå•è¯´è€å¼Ÿæ·±å…¥é’»ç ”çš„ç²¾ç¥ï¼Œå°¤ä¸ºå¯å˜‰ï¼ï¼ï¼é¡ºä¾¿ä¸€æï¼ŒIDå¯ä»¥æ”¹ä¸€ä¸‹ï¼Œè¿™æ ·å¤§å®¶å¯¹ä½ å°è±¡æ›´æ·±~\n\nä¸ºäº†é™ä½å¤§å®¶çš„å­¦ä¹ æˆæœ¬ï¼Œå’±ä»¬ç¡®å®æ²¡æœ‰é€ä¸ªè®²è§£æ¯ä¸€ç±»é…ç½®é¡¹ï¼ŒConfigurationé¡µé¢ç¡®å®æä¾›äº†ç§ç±»ç¹å¤šçš„é…ç½®é€‰é¡¹ï¼Œå¯¹äºåˆšå…¥é—¨çš„åŒå­¦éå¸¸ä¸å‹å¥½ã€‚è€å¼Ÿè®¤çœŸåœ°æŠŠæ¯ä¸€ç±»éƒ½è¿‡äº†ä¸€éï¼Œè€Œä¸”éƒ½åˆ†æäº†é…ç½®é¡¹çš„è®¾ç½®é¡ºåºï¼ŒçœŸçš„å¾ˆèµğŸ‘ï¼ï¼ï¼\n\nè¿™é‡Œå’±ä»¬ä¸å»æ·±ç©¶å…·ä½“æ¯ä¸€ç±»åˆ°åº•åº”è¯¥è®¾ç½®åœ¨å“ªä¸ªlevelï¼Œå…¶å®åªè¦æŠŠæ¡ä½é…ç½®é¡¹çš„ä¸€åŠè®¾ç½®åŸåˆ™ï¼ŒåŸºæœ¬ä¸Šå°±ä¸ä¼šæœ‰å¤ªå¤§çš„é—®é¢˜ã€‚å¯¹äºä¸åŒï¼ˆç§ç±»ï¼‰çš„é…ç½®é¡¹ï¼Œå¯ä»¥followä¸‹é¢çš„è®¾ç½®åŸåˆ™ï¼ˆå…¶å®ä½ æŠŠä½ åˆ†æçš„æ¯ä¸ªç¯èŠ‚æ±‡æ€»ï¼Œèƒ½å¾—å‡ºä¸€æ ·çš„ç»“è®ºï¼‰ï¼š\n1. ç¡¬ä»¶èµ„æºç±»çš„ï¼ˆèµ„æºä¾›ç»™ç±»ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œï¼‰ï¼Œspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼›\n2. å…¨å±€æœåŠ¡ç±»çš„ï¼ˆæ¯”å¦‚åŠ¨æ€æ‰©å®¹ã€External shuffle servicesï¼Œå®‰å…¨ï¼Œå‹ç¼©ï¼ŒSpark UIï¼Œç­‰ç­‰ï¼‰ï¼Œspark-defaults.confç»Ÿä¸€è®¾ç½®ï¼›\n3. ä»»åŠ¡ç²’åº¦çš„é…ç½®ï¼ˆå¦‚Taské‡è¯•ã€locality waitã€æ˜¯å¦æ¨æ–­speculative taskï¼Œç­‰ç­‰ï¼‰ï¼Œç”¨å‘½ä»¤è¡Œï¼Œæˆ–æ˜¯SparkConfï¼Œæ¨èç”¨SparkConfï¼Œå‘½ä»¤è¡Œä¸å¥½ç®¡ç†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634137885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435535,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","nickname":"Geek_2dfa9a","note":"","ucode":"B5FE7971F5E773","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403526,"discussion_content":"è¿™é‡Œè®²ä¸‹ï¼Œæˆ‘çœŸçš„åªæ˜¯ç²—ç•¥çœ‹äº†ä¸‹ï¼Œå¤§éƒ¨åˆ†å‚æ•°æˆ‘éƒ½æ²¡ç”¨è¿‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634098313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335916,"user_name":"Ebdaoli","can_delete":false,"product_type":"c1","uid":1722878,"ip_address":"","ucode":"E45C113C1AFD12","user_header":"https://static001.geekbang.org/account/avatar/00/1a/49/fe/48846a6d.jpg","comment_is_top":false,"comment_ctime":1645769641,"is_pvip":false,"replies":[{"id":"122828","content":"å¥½é—®é¢˜~ è¿™é‡Œä¸å¿…æ‹˜æ³¥äºæ–‡ä¸­ç»™å‡ºçš„2~3å€ï¼Œè¿™æ˜¯ä¸ªéå¸¸generalã€è€å¥—çš„ç»éªŒä¹‹è°ˆã€‚2~3å€ï¼Œä»…ä»…æ˜¯ä¸ªèµ·ç‚¹ï¼Œæˆ–è€…è¯´è®¾ç½®å¹¶è¡Œåº¦çš„æ€è·¯ï¼Œå®é™…ä¸Šå¹¶è¡Œåº¦çš„è®¾ç½®ï¼Œå‚è€ƒcoresæ€»æ•°å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„ï¼Œæœ€ä½³çš„æ€è·¯ï¼Œè¿˜æ˜¯å‚è€ƒæ•°æ®åˆ†ç‰‡å¤§å°ã€‚å¦‚æœèƒ½å¤ŸæŠŠåˆ†ç‰‡å¤§å°æ§åˆ¶åœ¨200MBå·¦å³ï¼Œå¹¶è¡Œåº¦å®é™…ä¸Šå°±æ˜¯D&#47;200MBï¼Œå…¶ä¸­Dæ˜¯æ•°æ®é›†æ€»å¤§å°ã€‚ç›®çš„è¿˜æ˜¯å……åˆ†åˆ©ç”¨CPUã€åƒä½ è¯´çš„ï¼šâ€œé¿å…åœ¨æŸäº›æ‰§è¡Œè¿‡å¿«çš„taskåœ¨æ‰§è¡Œå®Œæœ¬æ¬¡ä»»åŠ¡åï¼Œè¿˜æœ‰å…¶ä»–çš„ä»»åŠ¡å¯ä»¥æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤çš„èµ„æºâ€ã€‚ä¸è€ƒè™‘æ•°æ®é›†æ€»å¤§å°Dï¼Œå•çº¯åœ°è®¾ç½®2~3å€ï¼Œæˆ–æ˜¯4~5å€ï¼Œå…¶å®æ˜¯æ²¡æœ‰æ„ä¹‰çš„~ å…³äºå¹¶è¡Œåº¦çš„è®¾ç½®ï¼Œå†…å­˜ã€CPUè®¾ç½®ï¼Œè€å¼Ÿå¯ä»¥å‚è€ƒæ€§èƒ½è°ƒä¼˜ç¯‡çš„â€œä¸‰è¶³é¼ç«‹â€å“ˆ~","user_name":"ä½œè€…å›å¤","comment_id":335916,"uid":"1043100","ip_address":"","utype":1,"ctime":1645890576,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5940736937","product_id":100090001,"comment_content":"å…³äº 1 core 1 task , é›†ç¾¤ä¸­æ€»core ä¸º executors * cores è¿™ä¸€å—ï¼Œåœ¨SparkSQL ä¸­è®¾ç½® spark.shuffle.partitions æ—¶ï¼Œéµç…§æ€»çš„å¹¶è¡Œåº¦ è®¾ç½®ä¸º æ€»core æ•°çš„ 2~3 å€, é¿å…åœ¨æŸäº›æ‰§è¡Œè¿‡å¿«çš„taskåœ¨æ‰§è¡Œå®Œæœ¬æ¬¡ä»»åŠ¡åï¼Œè¿˜æœ‰å…¶ä»–çš„ä»»åŠ¡å¯ä»¥æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤çš„èµ„æºï¼Œè¿™é‡Œå¦‚æœè®¾ç½®æˆ4~5å€æˆ–è€…æ›´å¤§çš„å€æ•°ä¼šå¯¹æ€§èƒ½é€ æˆä»€ä¹ˆå½±å“ï¼Œæ˜¯å¥½çš„è¿˜æ˜¯åçš„ï¼Ÿç†è®ºæ¥è¯´å¦‚æœ å¹¶è¡Œåº¦æ›´å¤šäº†ï¼Œé›†ç¾¤èµ„æºä¹Ÿæ˜¯èƒ½å……åˆ†åˆ©ç”¨ï¼Œæ¯ä¸ªtask å¤„ç†çš„æ•°æ®é‡è¿˜ä¼šæ›´å°‘ï¼Œè¿™é‡Œæœ‰äº›å›°æƒ‘å¯¹äº 2~3 å€çš„å¹¶è¡Œåº¦è®¾ç½®çš„ç†è§£ï¼Œæ‰€ä»¥èƒ½è¯·è€å¸ˆå¸®å¿™åˆ†æä¸‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553469,"discussion_content":"å¥½é—®é¢˜~ è¿™é‡Œä¸å¿…æ‹˜æ³¥äºæ–‡ä¸­ç»™å‡ºçš„2~3å€ï¼Œè¿™æ˜¯ä¸ªéå¸¸generalã€è€å¥—çš„ç»éªŒä¹‹è°ˆã€‚2~3å€ï¼Œä»…ä»…æ˜¯ä¸ªèµ·ç‚¹ï¼Œæˆ–è€…è¯´è®¾ç½®å¹¶è¡Œåº¦çš„æ€è·¯ï¼Œå®é™…ä¸Šå¹¶è¡Œåº¦çš„è®¾ç½®ï¼Œå‚è€ƒcoresæ€»æ•°å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„ï¼Œæœ€ä½³çš„æ€è·¯ï¼Œè¿˜æ˜¯å‚è€ƒæ•°æ®åˆ†ç‰‡å¤§å°ã€‚å¦‚æœèƒ½å¤ŸæŠŠåˆ†ç‰‡å¤§å°æ§åˆ¶åœ¨200MBå·¦å³ï¼Œå¹¶è¡Œåº¦å®é™…ä¸Šå°±æ˜¯D/200MBï¼Œå…¶ä¸­Dæ˜¯æ•°æ®é›†æ€»å¤§å°ã€‚ç›®çš„è¿˜æ˜¯å……åˆ†åˆ©ç”¨CPUã€åƒä½ è¯´çš„ï¼šâ€œé¿å…åœ¨æŸäº›æ‰§è¡Œè¿‡å¿«çš„taskåœ¨æ‰§è¡Œå®Œæœ¬æ¬¡ä»»åŠ¡åï¼Œè¿˜æœ‰å…¶ä»–çš„ä»»åŠ¡å¯ä»¥æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤çš„èµ„æºâ€ã€‚ä¸è€ƒè™‘æ•°æ®é›†æ€»å¤§å°Dï¼Œå•çº¯åœ°è®¾ç½®2~3å€ï¼Œæˆ–æ˜¯4~5å€ï¼Œå…¶å®æ˜¯æ²¡æœ‰æ„ä¹‰çš„~ å…³äºå¹¶è¡Œåº¦çš„è®¾ç½®ï¼Œå†…å­˜ã€CPUè®¾ç½®ï¼Œè€å¼Ÿå¯ä»¥å‚è€ƒæ€§èƒ½è°ƒä¼˜ç¯‡çš„â€œä¸‰è¶³é¼ç«‹â€å“ˆ~","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645890576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324723,"user_name":"William","can_delete":false,"product_type":"c1","uid":2086573,"ip_address":"","ucode":"EC29D9CD616183","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d6/ad/850992a5.jpg","comment_is_top":false,"comment_ctime":1638589868,"is_pvip":false,"replies":[{"id":"117818","content":"è€å¼Ÿå®é™…ä¸Šé—®çš„æ˜¯spark.default.parallelism å’Œ spark.sql.shuffle.partitionsçš„åŒºåˆ«ã€‚<br>1ï¼‰spark.default.parallelismï¼Œè¿™ä¸ªç”¨æ¥æ§åˆ¶RDDçš„é»˜è®¤å¹¶è¡Œåº¦ï¼ŒHadoopRDDæ˜¯è‡ªå¸¦å¹¶è¡Œåº¦çš„ï¼ˆä¸HDFSæ–‡ä»¶åˆ†ç‰‡ä¸€è‡´ï¼‰ï¼Œè€Œç”¨parallelizeåˆ›å»ºçš„RDDï¼Œåœ¨æ²¡æœ‰æŒ‡å®šå¹¶è¡Œåº¦çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ç”¨spark.default.parallelism<br>2ï¼‰spark.sql.shuffle.partitionsï¼Œè¿™ä¸ªæ˜¯reduceé˜¶æ®µé»˜è®¤çš„å¹¶è¡Œåº¦ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰æ˜ç¡®æŒ‡å®šçš„è¯<br><br>å›åˆ°åŸæ¥çš„é—®é¢˜ï¼ŒD&#47;P ~ m&#47;cï¼Œè¿™é‡Œçš„Pï¼ŒæŒ‡çš„æ˜¯å¼€å‘è€…è¦è®¾ç½®çš„å¹¶è¡Œåº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé‚£é»˜è®¤å°±æ˜¯ä¸Šé¢é‚£ä¸¤ç§æƒ…å†µã€‚åœ¨D&#47;P ~ m&#47;cè¿™ä¸ªå¼å­é‡Œé¢ï¼ŒDæ˜¯å›ºå®šçš„ï¼Œæ˜¯æ•°æ®åŸå§‹å¤§å°ï¼ŒPã€mã€cï¼Œéƒ½éœ€è¦å¼€å‘è€…è®¾å®šï¼Œè€Œä»–ä»¬3ä¸ªçš„è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªå…¬å¼ï¼Œåšåˆ°â€œä¸‰è¶³é¼ç«‹â€ï¼Œå°½é‡è®©ç­‰å¼ä¸¤è¾¹å¹³è¡¡","user_name":"ä½œè€…å›å¤","comment_id":324723,"uid":"1043100","ip_address":"","utype":1,"ctime":1638610977,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5933557164","product_id":100090001,"comment_content":"<br>D&#47;P ~ m&#47;c<br>è€å¸ˆï¼Œå…¬å¼ä¸­çš„Pä¸æ˜¯ spark.default.parallelism å’Œ spark.sql.shuffle.partitionsæœ‰å…³ï¼Œè¿™é‡Œçš„Pä¸è¿™ä¸¤è€…çš„å…³ç³»å…·ä½“æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå…·ä½“æ˜¯ä»¥é‚£ä¸ªä¸ºå‡†å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535928,"discussion_content":"è€å¼Ÿå®é™…ä¸Šé—®çš„æ˜¯spark.default.parallelism å’Œ spark.sql.shuffle.partitionsçš„åŒºåˆ«ã€‚\n1ï¼‰spark.default.parallelismï¼Œè¿™ä¸ªç”¨æ¥æ§åˆ¶RDDçš„é»˜è®¤å¹¶è¡Œåº¦ï¼ŒHadoopRDDæ˜¯è‡ªå¸¦å¹¶è¡Œåº¦çš„ï¼ˆä¸HDFSæ–‡ä»¶åˆ†ç‰‡ä¸€è‡´ï¼‰ï¼Œè€Œç”¨parallelizeåˆ›å»ºçš„RDDï¼Œåœ¨æ²¡æœ‰æŒ‡å®šå¹¶è¡Œåº¦çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ç”¨spark.default.parallelism\n2ï¼‰spark.sql.shuffle.partitionsï¼Œè¿™ä¸ªæ˜¯reduceé˜¶æ®µé»˜è®¤çš„å¹¶è¡Œåº¦ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰æ˜ç¡®æŒ‡å®šçš„è¯\n\nå›åˆ°åŸæ¥çš„é—®é¢˜ï¼ŒD/P ~ m/cï¼Œè¿™é‡Œçš„Pï¼ŒæŒ‡çš„æ˜¯å¼€å‘è€…è¦è®¾ç½®çš„å¹¶è¡Œåº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé‚£é»˜è®¤å°±æ˜¯ä¸Šé¢é‚£ä¸¤ç§æƒ…å†µã€‚åœ¨D/P ~ m/cè¿™ä¸ªå¼å­é‡Œé¢ï¼ŒDæ˜¯å›ºå®šçš„ï¼Œæ˜¯æ•°æ®åŸå§‹å¤§å°ï¼ŒPã€mã€cï¼Œéƒ½éœ€è¦å¼€å‘è€…è®¾å®šï¼Œè€Œä»–ä»¬3ä¸ªçš„è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªå…¬å¼ï¼Œåšåˆ°â€œä¸‰è¶³é¼ç«‹â€ï¼Œå°½é‡è®©ç­‰å¼ä¸¤è¾¹å¹³è¡¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638610977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324213,"user_name":"å°æ–°","can_delete":false,"product_type":"c1","uid":1690884,"ip_address":"","ucode":"DCAD04665E2CF8","user_header":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","comment_is_top":false,"comment_ctime":1638338785,"is_pvip":false,"replies":[{"id":"117758","content":"å¯ä»¥çš„ï¼Œè€å¼Ÿè¯´çš„åœºæ™¯ï¼Œå…¶å®æŒºæ™®éçš„ï¼Œæ¯”å¦‚æœºå™¨å­¦ä¹ æµæ°´çº¿å°±æ˜¯è¿™æ ·ï¼Œå‰æœŸETLåšç‰¹å¾å·¥ç¨‹ã€æ ·æœ¬å·¥ç¨‹ï¼ŒåæœŸMLlibåšæ¨¡å‹è®­ç»ƒã€‚æŠŠåº”ç”¨åˆ†å¼€å°±å¥½äº†ï¼Œæ¯ä¸ªåº”ç”¨å†…éƒ¨ï¼Œé€šè¿‡SparkConfæ¥å•ç‹¬è®¾ç½®å‚æ•°å€¼ï¼Œä»è€Œåœ¨åº”ç”¨å±‚é¢å¯¹é…ç½®é¡¹åšéš”ç¦»è®¾ç½®","user_name":"ä½œè€…å›å¤","comment_id":324213,"uid":"1043100","ip_address":"","utype":1,"ctime":1638458365,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5933306081","product_id":100090001,"comment_content":"ç›¸åï¼Œå¦‚æœä½ çš„åº”ç”¨åœºæ™¯æ˜¯æœºå™¨å­¦ä¹ ã€æˆ–æ˜¯å›¾è®¡ç®—ï¼Œè¿™äº›è®¡ç®—ä»»åŠ¡å¾€å¾€éœ€è¦åå¤æ¶ˆè€—ã€è¿­ä»£åŒä¸€ä»½æ•°æ®ï¼Œå¤„ç†æ–¹å¼å°±ä¸ä¸€æ ·äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå’±ä»¬è¦å……åˆ†åˆ©ç”¨ RDD Cache æä¾›çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œè‡ªç„¶å°±è¦æŠŠ sf è¿™ä¸ªå‚æ•°è®¾ç½®å¾—ç¨å¤§ä¸€äº›ï¼Œä»è€Œè®© Storage Memory æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œæ¥å®¹çº³éœ€è¦é¢‘ç¹è®¿é—®çš„åˆ†å¸ƒå¼æ•°æ®é›†ã€‚<br><br>å°±è¿™ä¸ªé—®é¢˜ï¼Œæƒ³é—®ä¸€ä¸‹ï¼Œå¦‚æœæ•´ä¸ªåº”ç”¨å‰æœŸæ˜¯ETLï¼Œ åæœŸä½¿ç”¨MLlibè¿›è¡Œæœºå™¨å­¦ä¹ ï¼Œé‚£ä¸ªå‚æ•°å¯ä»¥ä»£ç é‡Œæ‰‹åŠ¨è°ƒæ•´å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535535,"discussion_content":"å¯ä»¥çš„ï¼Œè€å¼Ÿè¯´çš„åœºæ™¯ï¼Œå…¶å®æŒºæ™®éçš„ï¼Œæ¯”å¦‚æœºå™¨å­¦ä¹ æµæ°´çº¿å°±æ˜¯è¿™æ ·ï¼Œå‰æœŸETLåšç‰¹å¾å·¥ç¨‹ã€æ ·æœ¬å·¥ç¨‹ï¼ŒåæœŸMLlibåšæ¨¡å‹è®­ç»ƒã€‚æŠŠåº”ç”¨åˆ†å¼€å°±å¥½äº†ï¼Œæ¯ä¸ªåº”ç”¨å†…éƒ¨ï¼Œé€šè¿‡SparkConfæ¥å•ç‹¬è®¾ç½®å‚æ•°å€¼ï¼Œä»è€Œåœ¨åº”ç”¨å±‚é¢å¯¹é…ç½®é¡¹åšéš”ç¦»è®¾ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638458365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346955,"user_name":"Geek_2de9af","can_delete":false,"product_type":"c1","uid":2982764,"ip_address":"","ucode":"C951A8EB714FFD","user_header":"","comment_is_top":false,"comment_ctime":1653558565,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653558565","product_id":100090001,"comment_content":"è€å¸ˆå…³äºD&#47;P ~ m&#47;c ,æˆ‘æœ‰ä¸ªé—®é¢˜å‘æ‚¨è¯·æ•™ä¸‹ã€‚åƒæºæ–‡ä»¶æ•°æ®2Tï¼Œæœ€åç»è¿‡è¿‡æ»¤ã€å»é‡ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œç”Ÿæˆç»“æœæ•°æ®3gï¼ŒæŒ‰ç…§D&#47;P ~ m&#47;cè®¾ç½®ï¼Œç»“æœæ•°æ®ä¼šéƒ½æ˜¯å¾ˆå¤šå°æ–‡ä»¶ï¼Œè¿™ç§è¯¥æ€ä¹ˆåŠï¼","like_count":0},{"had_liked":false,"id":336677,"user_name":"Zhenng","can_delete":false,"product_type":"c1","uid":1859721,"ip_address":"","ucode":"48BB40DF266533","user_header":"https://static001.geekbang.org/account/avatar/00/1c/60/89/1f424b14.jpg","comment_is_top":false,"comment_ctime":1646287644,"is_pvip":true,"replies":[{"id":"123250","content":"æ˜¯çš„ï¼Œæ²¡é”™~","user_name":"ä½œè€…å›å¤","comment_id":336677,"uid":"1043100","ip_address":"","utype":1,"ctime":1646725177,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1646287644","product_id":100090001,"comment_content":"spark.executor.instanceså‚æ•°æ˜¯åœ¨Yarnçš„Sparké›†ç¾¤ä¸­ä½¿ç”¨çš„ï¼Œåœ¨Standaloneé›†ç¾¤ä¸­executorçš„ä¸ªæ•°æ˜¯ç”±spark.cores.max&#47;spark.executor.cores è¿™ä¸¤ä¸ªå‚æ•°å†³å®šçš„ã€‚æˆ‘åœ¨Standaloneé›†ç¾¤ä¸­ä¿®æ”¹spark.executor.instanceså‚æ•°å¹¶ä¸èµ·ä½œç”¨","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555037,"discussion_content":"æ˜¯çš„ï¼Œæ²¡é”™~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646725177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330704,"user_name":"å°æ","can_delete":false,"product_type":"c1","uid":1903790,"ip_address":"","ucode":"30BD251EE1B1E2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/iaQgtbE98VGIVIyribdo6dgLOnaNoe7ZdUuPr60ibsduibscrzQCTzdW2AfL9nxwe8YlSK75gOnK3YbAJKTaFPxibdg/132","comment_is_top":false,"comment_ctime":1642126161,"is_pvip":false,"replies":[{"id":"120672","content":"Dçš„è¯ï¼Œå¯ä»¥ç²¾ç¡®ä¼°è®¡ï¼Œä¹Ÿå³åŠ è½½åˆ°å†…å­˜åcacheï¼Œç„¶åé€šè¿‡æ‰§è¡Œè®¡åˆ’æ¥çœ‹å®é™…å†…å­˜æ¶ˆè€—ï¼›å¦ä¸€ç§å°±æ˜¯ç²—ç•¥ä¼°è®¡ï¼Œæ¯”è¾ƒæŒ‰ç…§å‹ç¼©æ¯”ï¼Œå¤§è‡´ç®—ä¸€ä¸ªæ•°å­—ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„~","user_name":"ä½œè€…å›å¤","comment_id":330704,"uid":"1043100","ip_address":"","utype":1,"ctime":1642257169,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":1,"score":"1642126161","product_id":100090001,"comment_content":"å¯¹äºD&#47;P ~ m&#47;cï¼Œå…¶ä¸­å¯¹äºpå’Œcæ¯”è¾ƒå¥½é‡åŒ–ï¼Œå­˜å‚¨å°ºå¯¸Dï¼ˆè‹¥æ˜¯å‹ç¼©å­˜å‚¨ï¼‰åŠ¿å¿…åŠ è½½åˆ°å†…å­˜ä¼šæœ‰è†¨èƒ€çš„æƒ…å†µï¼Œè¿™å¯¹äºExecution Memoryï¼ˆmï¼‰çš„è®¾ç½®æ˜¯å¦ä¼šä¸å¥½æŠŠæ¡ï¼ˆéœ€è¦åŠ è½½ä¸€ä¸‹æ•°æ®çœ‹ä¸€ä¸‹å®é™…å ç”¨çš„å†…å­˜å¤§å°ï¼‰ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546256,"discussion_content":"Dçš„è¯ï¼Œå¯ä»¥ç²¾ç¡®ä¼°è®¡ï¼Œä¹Ÿå³åŠ è½½åˆ°å†…å­˜åcacheï¼Œç„¶åé€šè¿‡æ‰§è¡Œè®¡åˆ’æ¥çœ‹å®é™…å†…å­˜æ¶ˆè€—ï¼›å¦ä¸€ç§å°±æ˜¯ç²—ç•¥ä¼°è®¡ï¼Œæ¯”è¾ƒæŒ‰ç…§å‹ç¼©æ¯”ï¼Œå¤§è‡´ç®—ä¸€ä¸ªæ•°å­—ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642257169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324219,"user_name":"å°æ–°","can_delete":false,"product_type":"c1","uid":1690884,"ip_address":"","ucode":"DCAD04665E2CF8","user_header":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","comment_is_top":false,"comment_ctime":1638340929,"is_pvip":false,"replies":[{"id":"117759","content":"æŒ‡çš„æ˜¯æ•°æ®é›†å¤§å°ã€å¹¶è¡Œåº¦ï¼Œä¸èµ„æºè®¾ç½®ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œå‚è€ƒè¿™ä¸ªå…¬å¼ï¼š<br>D&#47;P ~m&#47;c<br>æœ‰åˆ©äºåšåˆ°æ•°æ®åˆ†åŒºä¹‹é—´ï¼Œtaskä¸taskä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œä»è€Œä¸ºåº”ç”¨çš„æ‰§è¡Œæ€§èƒ½æ‰“ä¸‹å¾ˆå¥½çš„åŸºç¡€ã€‚<br>å…¶ä¸­Dæ˜¯æ•°æ®é›†å¤§å°ï¼ŒPæ˜¯å¹¶è¡Œåº¦ï¼Œmæ˜¯æ¯ä¸ªExecutorsçš„å†…å­˜å¤§å°ï¼Œcæ˜¯CPUæ ¸æ•°ã€‚å…¬å¼çš„æ„æ€æ˜¯è¯´ï¼Œå•ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œä¸å•ä¸ªtaskèƒ½æ‹¿åˆ°çš„å†…å­˜ï¼Œæ˜¯åœ¨åŒä¸€ä¸ªæ•°é‡çº§ï¼Œæ˜¯ç›¸åŒ¹é…çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œtaskä¸æ•°æ®é‡ç›¸åŒ¹é…ï¼Œåº”ç”¨æ•´ä½“çš„è®¡ç®—æ•ˆç‡ï¼Œå°±ä¸ä¼šå·®åˆ°å“ªé‡Œå»","user_name":"ä½œè€…å›å¤","comment_id":324219,"uid":"1043100","ip_address":"","utype":1,"ctime":1638458535,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1638340929","product_id":100090001,"comment_content":"D&#47;P ~m&#47;cä¸å‰é¢è®²çš„ä¸€èˆ¬æŠŠå¹¶å‘æ•°è®¾ç½®ä¸ºé›†ç¾¤coresçš„2~3å€ï¼Œæœ‰ä½•å…³è”ã€‚ä¸€ä¸ªæ˜¯è®²å±€éƒ¨Executor, ä¸€ä¸ªæ˜¯æ•´ä½“ä¼˜åŒ–æ¦‚å¿µæ˜¯å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535539,"discussion_content":"æŒ‡çš„æ˜¯æ•°æ®é›†å¤§å°ã€å¹¶è¡Œåº¦ï¼Œä¸èµ„æºè®¾ç½®ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œå‚è€ƒè¿™ä¸ªå…¬å¼ï¼š\nD/P ~m/c\næœ‰åˆ©äºåšåˆ°æ•°æ®åˆ†åŒºä¹‹é—´ï¼Œtaskä¸taskä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œä»è€Œä¸ºåº”ç”¨çš„æ‰§è¡Œæ€§èƒ½æ‰“ä¸‹å¾ˆå¥½çš„åŸºç¡€ã€‚\nå…¶ä¸­Dæ˜¯æ•°æ®é›†å¤§å°ï¼ŒPæ˜¯å¹¶è¡Œåº¦ï¼Œmæ˜¯æ¯ä¸ªExecutorsçš„å†…å­˜å¤§å°ï¼Œcæ˜¯CPUæ ¸æ•°ã€‚å…¬å¼çš„æ„æ€æ˜¯è¯´ï¼Œå•ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œä¸å•ä¸ªtaskèƒ½æ‹¿åˆ°çš„å†…å­˜ï¼Œæ˜¯åœ¨åŒä¸€ä¸ªæ•°é‡çº§ï¼Œæ˜¯ç›¸åŒ¹é…çš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œtaskä¸æ•°æ®é‡ç›¸åŒ¹é…ï¼Œåº”ç”¨æ•´ä½“çš„è®¡ç®—æ•ˆç‡ï¼Œå°±ä¸ä¼šå·®åˆ°å“ªé‡Œå»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638458535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315017,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1633659908,"is_pvip":false,"replies":[{"id":"114414","content":"ä¸æ˜¯ï¼Œè¿™æ˜¯ä¸ªé…ç½®é¡¹ï¼Œå¯ä»¥é…ç½®åˆ°ä»»æ„æ“ä½œç³»ç»Ÿç›®å½•ï¼Œç”¨æ¥æ”¹å–„Shuffleä¸­é—´æ–‡ä»¶å­˜å‚¨ï¼Œä»¥åŠRDD Cacheç£ç›˜å­˜å‚¨ã€‚","user_name":"ä½œè€…å›å¤","comment_id":315017,"uid":"1043100","ip_address":"","utype":1,"ctime":1633962260,"user_name_real":"å´ç£Š"}],"discussion_count":4,"race_medal":0,"score":"1633659908","product_id":100090001,"comment_content":"è€å¸ˆ é—®ä¸‹spark.local.diræ˜¯sparkå®‰è£…ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹å—","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527859,"discussion_content":"ä¸æ˜¯ï¼Œè¿™æ˜¯ä¸ªé…ç½®é¡¹ï¼Œå¯ä»¥é…ç½®åˆ°ä»»æ„æ“ä½œç³»ç»Ÿç›®å½•ï¼Œç”¨æ¥æ”¹å–„Shuffleä¸­é—´æ–‡ä»¶å­˜å‚¨ï¼Œä»¥åŠRDD Cacheç£ç›˜å­˜å‚¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633962260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401938,"discussion_content":"æˆ‘çŸ¥é“å•Š æˆ‘æ˜¯æƒ³é—®è¿™ä¸ªå‚æ•°æŒ‡å®šçš„æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„æ˜¯ä»€ä¹ˆ æ¯”å¦‚spark.local.dir=/tmpé‚£è¿™ä¸ªtmpæ–‡ä»¶å¤¹æ˜¯åœ¨sparkå®‰è£…ç›®å½•ä¸‹å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633769127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1796916,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ribDhYiajmzh6OQ4t1IM2anjyDeQj77NR4VhD0UBFh0TPdFCpfsib38U6icg3ba2UUicbVHRnrYbtWtq0L5PNXAZibQA/132","nickname":"æ›¾å…ˆç”Ÿ","note":"","ucode":"1D719A3B2FB821","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409034,"discussion_content":"/tmpæ˜¯æ“ä½œç³»ç»Ÿä¸‹çš„ç›®å½•","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635354470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":401938,"ip_address":""},"score":409034,"extra":""}]},{"author":{"id":2620662,"avatar":"","nickname":"Iwandy","note":"","ucode":"AD9E3701D8095C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401620,"discussion_content":"è€å¸ˆæ–‡ç« ä¸­è¯´çš„å¾ˆæ¸…æ¥šäº†å•Šï¼Œæ˜¯ç”¨æ¥ä¿å­˜shuffleä¸­é—´æ–‡ä»¶å’ŒRDD cacheçš„ æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç›®å½•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633700035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}