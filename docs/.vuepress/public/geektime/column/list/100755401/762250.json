{"id":762250,"title":"09｜LLM辅助建模（一）：构造反馈循环","content":"<p>你好，我是徐昊，今天我们来继续学习AI时代的软件工程。</p><p>上节课，我们介绍了如何使用LLM辅助进行模型展开，从而应用业务知识。具体做法是通过Mermaid将业务模型转化为大语言模型（Large Language Model，LLM）易于理解的方式，再用半结构化自然语言补充上下文，让思维链的构造更加简单。</p><p>但是如果我们没有模型要怎么处理呢？利用LLM辅助建模是否也能比传统建模方法更有效率呢？这是我们今天要讨论的问题。</p><h2>构造反馈循环</h2><p>建模的过程，是学习业务知识并提炼知识的过程。我们在<a href=\"https://time.geekbang.org/column/article/760312\">第六节课</a>提到使用LLM时，可以通过缩短反馈周期提高知识学习的效率。那么我们可以通过构造一个反馈循环，使用LLM帮助我们完成建模的过程。</p><p>在反馈循环的过程中，我们处在复杂的认知模式下，也就是遵循<strong>探测（Probe）- 感知（Sense）- 响应（Respond）</strong>的认知行为模式。</p><p>我们之前提到过，由于<strong>探测</strong>环节费力费时，往往会成为整个反馈周期的瓶颈。但是有了LLM的辅助，我们可以在<strong>探测</strong>阶段快速产生初始结果，或是根据反馈重新执行任务。那么<strong>感知</strong>这一环节就可能会成为新的瓶颈。</p><p>在我们前面课程的例子里，我们希望LLM帮助我们把一个基于关系型数据的解决方案，改造为使用MongoDB的解决方案。<strong>感知</strong>就比较直接了：将LLM生成的代码直接执行就可以了。但对于模型就没有这么简单了。</p><!-- [[[read_end]]] --><p><strong>模型是对于现实世界的抽象，</strong>是没有对错之分的，只有不同的角度和抽象的方式。我们评价一个模型，首先看能否适用于业务场景，然后是能否应对业务场景的变化。<strong>那么我们可以通过模型展开验证模型的适用度，以及应对变化的能力</strong>。</p><p>正如我们在<a href=\"https://time.geekbang.com/column/article/761647\">上节课</a>的演示，这个过程也可以通过LLM辅助。因而，我们使用LLM辅助建模的过程，就是利用LLM快速构建一个模型，并在不同的业务场景中展开这个模型，收集反馈再让LLM帮助我们调整模型。</p><p><img src=\"https://static001.geekbang.org/resource/image/2f/72/2fa32e8f37b9d0dc1ae08b15bd151a72.jpg?wh=1920x1080\" alt=\"\"></p><p>如上图所示，在这里我们需要利用两个LLM的会话（Session），一个用于生成模型，一个用于模型展开。同样我们也需要两个任务模板，一个负责建模，一个负责模型的展开。</p><p>但是这里还有一点需要注意，上一节课我们介绍模型展开的时候，不涉及模型的修改。只需要在特定的上下文中，使用模型中的概念给出解释就行了。</p><p>但是在建模的过程中，不可能一次就建模正确。我们很可能碰到<strong>概念缺失</strong>的情况，也就是在用户故事或其他业务上下文中提及的概念，在模型中不存在。或是<strong>关系错置</strong>的情况，也就是模型中对象间的关联关系不正确的情况。因而在展开之前，我们可以先行反馈这些问题。于是，我们最终的反馈循环看起来是这个样子的：</p><p><img src=\"https://static001.geekbang.org/resource/image/7e/cd/7e7b5fb2937700a96d375815e96508cd.jpg?wh=1920x1080\" alt=\"\"></p><p>我们使用的三个模板分别如下。</p><p>建模任务模板：</p><pre><code class=\"language-plain\">业务描述\n=======\n{context}\n\n任务\n====\n根据业务描述，为系统建立模型。可以添加你认为必要的实体和关系。并将模型表示为mermaid的class diagram\n</code></pre><p>模型检查任务模板：</p><pre><code>```plain\n领域模型\n======\n```mermaid\n{model}\n```\n\n用户故事\n======\n{user_story}\n\n验收场景\n======\n{ac}\n\n任务\n===\n针对这个用户故事和验收场景，领域模型中缺少哪些概念？或者存在哪些不正确的关联关系。\n请用文字表示缺失的概念是什么？以及存在哪些不正确的关联。\n```\n</code></pre><p>模型展开任务模板：</p><pre><code>```plain\n领域模型\n======\n```mermaid\n{model}\n```\n\n用户故事\n======\n{user_story}\n\n验收场景\n======\n{ac}\n\n任务\n===\n数据都以yaml格式给出。\n首先，请根据领域模型理解用户故事中的场景，并针对验收场景中Given的部分，给出样例数据。\n然后，参看验收场景中When的部分，给出样例数据会产生怎样的改变。\n```\n</code></pre><p>在模型展开的模板中，我们需要用户故事和验收场景。同样，我们可以使用上一节课中的用户故事和验收条件。</p><blockquote>\n<p><strong>作为</strong>学校的教职员工（<strong>As</strong> a faculty），<br>\n<strong>我希望</strong>学生可以根据录取通知将学籍注册到教学计划上（<strong>I want</strong> the student to be able to enroll in an academic program with given offer），<br>\n<strong>从而</strong>我可以跟踪他们的获取学位的进度（<strong>So that</strong> I can track their progress）</p>\n</blockquote><blockquote>\n<p><strong>如果</strong>获取了录取通知的学生没有注册学籍时（<strong>Given</strong> student with offer hasn’t enrolled any program），<br>\n<strong>当</strong>这个学生注册时（<strong>When</strong> the student enroll），<br>\n<strong>那么</strong>这个学生将能成功注册学籍到录取通知指定的教学计划中（<strong>Then</strong> the student will successfully enroll the program specified in the offer）x</p>\n</blockquote><p>下面让我们使用这两个模板，通过反馈循环，对这个系统进行建模。</p><h2>使用反馈循环完成建模</h2><p>首先，让我们先描述一下我们要建模的业务系统，因为我们存在一个让ChatGPT检查的环节，出于展示的目的，我们不需要放入太多的内容。但在正常的使用过程中，更多的上下文总是会产生更好的结果。</p><pre><code class=\"language-plain\">这是一个教学学籍管理系统\n</code></pre><p>我们套入模板，先让ChatGPT帮我们建模。我这里使用了ChatGPT-4的插件，可以直接显示模型图。如果没有插件的话，可以根据ChatGPT生成的Mermaid在使用在线编辑器看图。</p><p><img src=\"https://static001.geekbang.org/resource/image/9d/20/9dfb1091a4f5908a7f8a17769ce59e20.jpg?wh=1325x2611\" alt=\"\"></p><p>可以看到，结果跟我们建模的结果相去甚远。因为我们并没有给出具体的业务描述，ChatGPT只能根据对于学籍管理的泛泛理解，完成建模的过程。那么我们可以把这次生成的结果，代入到模型检查的任务模板中去。</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/a4/e2110f341bac99f85c32455dc9fc16a4.jpg?wh=1374x1238\" alt=\"\"></p><p>ChatGPT给出了对于概念缺失的提示。我们可以根据这个反馈，修改对于业务的描述。一个简单的办法是，我们可以列出当前业务中的核心概念，让LLM重新生成模型：</p><pre><code class=\"language-plain\">这是一个教学学籍管理系统。系统中应该包含以下的核心概念：\n- 教学计划: 一系列相关课程和活动，这些课程和活动旨在培养特定领域的知识和技能。比如，计算机科学与技术学士学位教学计划，或是计算机科学与技术硕士学位教学计划\n- 录取通知: 学生需要根据录取通知注册学籍。录取通知应该包含学生被录取的信息，如录取的教学计划\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/e5/d4/e533f66467727f25da019b9f0b4663d4.jpg?wh=1356x3259\" alt=\"\"></p><p>我们可以看到，这次已经非常接近我们之前给出的结果了。让我们再继续验证一下这个模型。</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/f3/1f6cc2f54ed3b1a41a8yy61f602947f3.jpg?wh=1352x1661\" alt=\"\"><br>\n可以看到ChatGPT给出的建议非常类似我们前面课程中给出的模型。接下来，我们继续补充需要的核心概念：</p><pre><code class=\"language-plain\">这是一个教学学籍管理系统。系统中应该包含以下的核心概念：\n- 教学计划: 一系列相关课程和活动，这些课程和活动旨在培养特定领域的知识和技能。比如，计算机科学与技术学士学位教学计划，或是计算机科学与技术硕士学位教学计划\n- 录取通知: 学生需要根据录取通知注册学籍。录取通知应该包含学生被录取的信息，如录取的教学计划\n- 学籍：当学生注册之后，学籍记录学生在校将按照哪个教学计划学习\n- 学生\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d9/18/d925330ba9b7541878cf3f651f04ba18.jpg?wh=1270x3053\" alt=\"\"></p><p>已经非常接近了。让我们再检查一次：</p><p><img src=\"https://static001.geekbang.org/resource/image/aa/62/aa2233b8b37728edbb30f22fb048f062.jpg?wh=1402x1441\" alt=\"\"></p><p>好了，现在对于实体已经没有遗漏了，只有对于关联关系的建议，这些目前我们并不需要非常关注，我们建模第一步先把实体找清楚，然后再来看建模关系。下面让我们进行模型展开：</p><p><img src=\"https://static001.geekbang.org/resource/image/e8/1d/e8897a43b1340c6ecd5d5084de8c931d.jpg?wh=1344x3569\" alt=\"\"></p><p>至此为止，我们就通过LLM辅助，借助反馈循环得到了与之前类似的模型，并且这个模型也可以解释当前的业务。</p><h2>小结</h2><p>今天我们介绍了如何通过构造反馈循环，并使用LLM加速反馈循环中不同的环节，辅助我们完成建模的过程。</p><p><img src=\"https://static001.geekbang.org/resource/image/7e/cd/7e7b5fb2937700a96d375815e96508cd.jpg?wh=1920x1080\" alt=\"图10\"></p><p>我们首先描述了系统的大致情况，然后通过LLM在不同的业务上下文中，验证模型的完备性，提出缺失的概念。之后将缺失的概念添加回业务上下文中，再做模型改进。利用这种方法，我们哪怕预先不知道太多业务上下文，也可以仅仅通过LLM的反馈来辅助建模。</p><p>我们展示的方式，也是知识工程的一个基本模式，<strong>构造复杂认知模式的反馈循环并通过LLM加速</strong>。在后面的课程中，我们会反复看到这个模式的应用。</p><h2>思考题</h2><p>有没有其他的方式构造反馈的循环？</p><p>欢迎你在留言区分享自己的思考或疑惑，我们会把精彩内容置顶供大家学习讨论。</p><h2></h2><h2></h2><h2></h2><h2></h2>","neighbors":{"left":{"article_title":"08｜使用LLM辅助业务理解","id":761647},"right":{"article_title":"10｜LLM辅助建模（二）：构造思维链","id":762934}},"comments":[{"had_liked":false,"id":389292,"user_name":"赫伯伯","can_delete":false,"product_type":"c1","uid":1154294,"ip_address":"北京","ucode":"85722DBCB88E9C","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/f6/eca921d9.jpg","comment_is_top":false,"comment_ctime":1712041111,"is_pvip":false,"replies":[{"id":141633,"content":"对于llm 重点都不在 做 而是在验证他做的是对的","user_name":"作者回复","user_name_real":"编辑","uid":2537798,"ctime":1712098836,"ip_address":"浙江","comment_id":389292,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"能不能直接给大模型用户故事？让他根据用户故事建模","like_count":5,"discussions":[{"author":{"id":2537798,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b9/46/758ecf4a.jpg","nickname":"徐八叉","note":"","ucode":"DA6D1EB08A7396","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641029,"discussion_content":"对于llm 重点都不在 做 而是在验证他做的是对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712098836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1154294,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/f6/eca921d9.jpg","nickname":"赫伯伯","note":"","ucode":"85722DBCB88E9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2537798,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b9/46/758ecf4a.jpg","nickname":"徐八叉","note":"","ucode":"DA6D1EB08A7396","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":641528,"discussion_content":"懂了，做出来很快，对不对就另说了🥺","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712736881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":641029,"ip_address":"河北","group_id":0},"score":641528,"extra":""}]}]},{"had_liked":false,"id":389066,"user_name":"术子米德","can_delete":false,"product_type":"c1","uid":1898023,"ip_address":"浙江","ucode":"382EA7E2AF0B56","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f6/27/c27599ae.jpg","comment_is_top":false,"comment_ctime":1711494313,"is_pvip":true,"replies":[{"id":141577,"content":"用户故事 as&#47;id like to&#47;so that 不可能是clear","user_name":"作者回复","user_name_real":"编辑","uid":2537798,"ctime":1711503429,"ip_address":"浙江","comment_id":389066,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"🤔☕️🤔☕️🤔\n【R】建模时处于复杂认知模式，构造复杂认知模式的反馈循环，通过LLM加速建模过程、以及认知负担下降。\n模板 = 建模任务 + 模型检查 + 模型展开。\n关键 = 用户故事 + 反馈循环。\n【.I.】建模 = 实体 + 关系 = 概要设计 = 总体设计 = 用户故事从自然语言、转变成结构化描述 = 对代码实现而言的半结构化描述。\n【Q】用户故事，如果Clear，那么建模是否为Complicated，如果用户故事本身也Complicated，那么建模才是Complex？\n— by 术子米德@2024年3月27日","like_count":1,"discussions":[{"author":{"id":2537798,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b9/46/758ecf4a.jpg","nickname":"徐八叉","note":"","ucode":"DA6D1EB08A7396","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640451,"discussion_content":"用户故事 as/id like to/so that 不可能是clear","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711503429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389090,"user_name":"范飞扬","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"浙江","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b3edcc09.jpg","comment_is_top":false,"comment_ctime":1711542790,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"这节课需要代码来反复生成 prompt，不过老师没贴代码，所以我让 GPT 写了一下，放到公众号了，希望对大家有帮助~\n\n链接：\nhttps:&#47;&#47;mp.weixin.qq.com&#47;s?__biz=Mzg3MDg5MzYyMA==&amp;mid=2247483819&amp;idx=1&amp;sn=64bb8ce513260a785e589ae45eccd19f&amp;chksm=ce8790f0f9f019e63aa26e10cba54eb8eab1def0af5f2a192c7566bb773541ffa1d9f2310098&amp;token=597248625&amp;lang=zh_CN#rd","like_count":5},{"had_liked":false,"id":389197,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"浙江","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1711804352,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"第二次学习收获\n\n当处于一个陌生的领域时，可以\n\n1. 简述需求，让 AI 生成 mermaid 的 class diagram\n2. 将 mermaid 带入 CoT；补充用户故事、验收场景到 CoT；开始新一轮 RAG 任务获取更多缺失概念与不正确的概念\n3. 验收与 AI 互动后的学习成果\n\n以上三步分别对应文中的三个模板：建模任务模板 -&gt; 模型检查任务模板 -&gt; 模型展开任务模板","like_count":1},{"had_liked":false,"id":390208,"user_name":"6点无痛早起学习的和尚","can_delete":false,"product_type":"c1","uid":1703256,"ip_address":"北京","ucode":"33A8A1CDA103F9","user_header":"https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg","comment_is_top":false,"comment_ctime":1714708404,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"我用 claude 做建模任务模板，还给了一个答案：缺少模型 Degree(学位):用户故事提到了&quot;获取学位的进度&quot;,但是当前模型中没有学位的概念。学位应该是一个独立的实体,包含学位名称、级别等属性。","like_count":0},{"had_liked":false,"id":390207,"user_name":"6点无痛早起学习的和尚","can_delete":false,"product_type":"c1","uid":1703256,"ip_address":"北京","ucode":"33A8A1CDA103F9","user_header":"https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg","comment_is_top":false,"comment_ctime":1714708309,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"2024年05月03日11:51:10\n蛮有意思的 3 个会话模板，有了模板关于就在于“用户故事”、“验收场景”这 2 个了","like_count":0},{"had_liked":false,"id":390165,"user_name":"Morty","can_delete":false,"product_type":"c1","uid":1026658,"ip_address":"澳大利亚","ucode":"C2E532741F99E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/62/78b45741.jpg","comment_is_top":false,"comment_ctime":1714529735,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"一定要用三个 Session 吗？不能在一个对话里完成吗？","like_count":0},{"had_liked":false,"id":390088,"user_name":"姑射仙人","can_delete":false,"product_type":"c1","uid":1008517,"ip_address":"陕西","ucode":"3EFC1F3E592165","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","comment_is_top":false,"comment_ctime":1714311835,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"用国内的智谱清言走了一遍课程的流程，发现结果非常发散，不停的在增加实体，无法收敛。不知道这种情况算好事，还是坏事，如何让它停止发散，快速收敛。","like_count":0},{"had_liked":false,"id":389758,"user_name":"范飞扬","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"浙江","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b3edcc09.jpg","comment_is_top":false,"comment_ctime":1713402016,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"我注意到模板里面有个“```plain”，这个是笔误还是为了和mermaid区分出来加的呢？","like_count":0},{"had_liked":false,"id":389189,"user_name":"王海","can_delete":false,"product_type":"c1","uid":1159147,"ip_address":"贵州","ucode":"84347194C2061E","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/eb/8a2c26ab.jpg","comment_is_top":false,"comment_ctime":1711783547,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100755401,"comment_content":"老师，可以把完整的 prompt 或者完整的 LLM 对话内容分享一下吗？文章中只有prompt模板。","like_count":0},{"had_liked":false,"id":389186,"user_name":"术子米德","can_delete":false,"product_type":"c1","uid":1898023,"ip_address":"中国香港","ucode":"382EA7E2AF0B56","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f6/27/c27599ae.jpg","comment_is_top":false,"comment_ctime":1711780628,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100755401,"comment_content":"【Q】检查模型的模板、展开模型的模板，输入一样、输出一样，它们的差别是啥？","like_count":0}]}