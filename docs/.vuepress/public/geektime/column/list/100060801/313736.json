{"id":313736,"title":"21｜注意力机制、兴趣演化：推荐系统如何抓住用户的心？","content":"<p>你好，我是王喆。</p><p>近几年来，注意力机制、兴趣演化序列模型和强化学习，都在推荐系统领域得到了广泛的应用。它们是深度学习推荐模型的发展趋势，也是我们必须要储备的前沿知识。</p><p>作为一名算法工程师，足够的知识储备是非常重要的，因为在掌握了当下主流的深度学习模型架构（Embedding MLP架构、Wide&amp;Deep和DeepFM等等）之后，要想再进一步提高推荐系统的效果，就需要清楚地知道业界有哪些新的思路可以借鉴，学术界有哪些新的思想可以尝试，这些都是我们取得持续成功的关键。</p><p>所以，我会用两节课的时间，带你一起学习这几种新的模型改进思路。今天我们先重点关注注意力机制和兴趣演化序列模型，下节课我们再学习强化学习。</p><h2>什么是“注意力机制”？</h2><p><strong>“注意力机制”来源于人类天生的“选择性注意”的习惯</strong>。最典型的例子是用户在浏览网页时，会有选择性地注意页面的特定区域，而忽视其他区域。</p><p>比如，图1是Google对大量用户进行眼球追踪实验后，得出的页面注意力热度图。我们可以看到，用户对页面不同区域的注意力区别非常大，他们的大部分注意力就集中在左上角的几条搜索结果上。</p><p>那么，“注意力机制”对我们构建推荐模型到底有什么价值呢？</p><p><a href=\"https://www.researchgate.net/figure/Heat-Map-Golden-Triangle-pattern-shown-by-the-heat-map-of-how-users-focus-on-a_fig1_267025472\"><img src=\"https://static001.geekbang.org/resource/image/3a/5f/3a3cb86da13876d679c16f4ec955645f.jpg?wh=993*848\" alt=\"\" title=\"图1 Google搜索结果的注意力热度图\"></a></p><p>价值是非常大的。比如说，我们要做一个新闻推荐的模型，让这个模型根据用户已经看过的新闻做推荐。那我们在分析用户已浏览新闻的时候，是把标题、首段、全文的重要性设置成完全一样比较好，还是应该根据用户的注意力不同给予不同的权重呢？当然，肯定是后者比较合理，因为用户很可能都没有注意到正文最后的几段，如果你分析内容的时候把最后几段跟标题、首段一视同仁，那肯定就把最重要的信息给淹没了。</p><!-- [[[read_end]]] --><p>事实上，近年来，注意力机制已经成功应用在各种场景下的推荐系统中了。其中最知名的，要数阿里巴巴的深度推荐模型，DIN（Deep Interest Network，深度兴趣网络）。接下来，我们就一起来学习一下DIN的原理和模型结构。</p><h3>注意力机制在深度兴趣网络DIN上的应用</h3><p>DIN模型的应用场景是阿里最典型的电商广告推荐。对于付了广告费的商品，阿里会根据模型预测的点击率高低，把合适的广告商品推荐给合适的用户，所以DIN模型本质上是一个点击率预估模型。</p><p>注意力机制是怎么应用在DIN模型里的呢？回答这个问题之前，我们得先看一看DIN在应用注意力机制之前的基础模型是什么样的，才能搞清楚注意力机制能应用在哪，能起到什么作用。</p><p>下面的图2就是DIN的基础模型Base Model。我们可以看到，Base Model是一个典型的Embedding MLP的结构。它的输入特征有用户属性特征（User Proflie Features）、用户行为特征（User Behaviors）、候选广告特征（Candidate Ad）和场景特征（Context Features）。</p><p>用户属性特征和场景特征我们之前也已经讲过很多次了，这里我们重点关注用户的行为特征和候选广告特征，也就是图2中彩色的部分。</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/6e/c1dbcc00dd17166ec53ca9e46b04006e.jpg?wh=1284*832\" alt=\"\" title=\"图2 阿里Base模型的架构图[br] (出自论文 Deep Interest Network for Click-Through Rate Prediction)\"></p><p>我们可以清楚地看到，用户行为特征是由一系列用户购买过的商品组成的，也就是图上的Goods  1到Goods N，而每个商品又包含了三个子特征，也就是图中的三个彩色点，其中红色代表商品ID，蓝色是商铺ID，粉色是商品类别ID。同时，候选广告特征也包含了这三个ID型的子特征，因为这里的候选广告也是一个阿里平台上的商品。</p><p>我们之前讲过，在深度学习中，只要遇到ID型特征，我们就构建它的Embedding，然后把Embedding跟其他特征连接起来，输入后续的MLP。阿里的Base Model也是这么做的，它把三个ID转换成了对应的Embedding，然后把这些Embedding连接起来组成了当前商品的Embedding。</p><p>完成了这一步，下一步就比较关键了，因为用户的行为序列其实是一组商品的序列，这个序列可长可短，但是神经网络的输入向量的维度必须是固定的，那我们应该怎么把这一组商品的Embedding处理成一个长度固定的Embedding呢？图2中的SUM Pooling层的结构就给出了答案，就是直接把这些商品的Embedding叠加起来，然后再把叠加后的Embedding跟其他所有特征的连接结果输入MLP。</p><p>但这个时候问题又来了，SUM Pooling的Embedding叠加操作其实是把所有历史行为一视同仁，没有任何重点地加起来，这其实并不符合我们购物的习惯。</p><p>举个例子来说，候选广告对应的商品是“键盘”，与此同时，用户的历史行为序列中有这样几个商品ID，分别是“鼠标”“T恤”和“洗面奶”。从我们的购物常识出发，“鼠标”这个历史商品ID对预测“键盘”广告点击率的重要程度应该远大于后两者。从注意力机制的角度出发，我们在购买键盘的时候，会把注意力更多地投向购买“鼠标”这类相关商品的历史上，因为这些购买经验更有利于我们做出更好的决策。</p><p>好了，现在我们终于看到了应用注意力机制的地方，那就是用户的历史行为序列。阿里正是在Base Model的基础上，把注意力机制应用在了用户的历史行为序列的处理上，从而形成了DIN模型。那么，DIN模型中应用注意力机制的方法到底是什么呢？</p><p>我们可以从下面的DIN模型架构图中看到，与Base Model相比，DIN为每个用户的历史购买商品加上了一个激活单元（Activation Unit），这个激活单元生成了一个权重，这个权重就是用户对这个历史商品的注意力得分，权重的大小对应用户注意力的高低。</p><p><img src=\"https://static001.geekbang.org/resource/image/ed/30/edd028f815ef3577553ffe045f042330.jpg?wh=1920*1046\" alt=\"\" title=\"图3 阿里DIN模型的架构图[br] (出自论文 Deep Interest Network for Click-Through Rate Prediction)\"></p><p>那现在问题就只剩下一个了，这个所谓的激活单元，到底是怎么计算出最后的注意力权重的呢？为了搞清楚这个问题，我们需要深入到激活单元的内部结构里面去，一起来看看图3右上角激活单元的详细结构。</p><p>它的输入是当前这个历史行为商品的Embedding，以及候选广告商品的Embedding。我们把这两个输入Embedding，与它们的外积结果连接起来形成一个向量，再输入给激活单元的MLP层，最终会生成一个注意力权重，这就是激活单元的结构。简单来说，<strong>激活单元就相当于一个小的深度学习模型，它利用两个商品的Embedding，生成了代表它们关联程度的注意力权重</strong>。</p><p>到这里，我们终于抽丝剥茧地讲完了整个DIN模型的结构细节。如果你第一遍没理解清楚，没关系，对照着DIN模型的结构图，反复再看几遍我刚才讲的细节，相信你就能彻底消化吸收它。</p><h3>注意力机制对推荐系统的启发</h3><p>注意力机制的引入对于推荐系统的意义是非常重大的，它模拟了人类最自然，最发自内心的注意力行为特点，使得推荐系统更加接近用户真实的思考过程，从而达到提升推荐效果的目的。</p><p>从“注意力机制”开始，越来越多对深度学习模型结构的改进是基于对用户行为的深刻观察而得出的。由此，我也想再次强调一下，<strong>一名优秀的算法工程师应该具备的能力，就是基于对业务的精确理解，对用户行为的深刻观察，得出改进模型的动机，进而设计出最合适你的场景和用户的推荐模型。</strong></p><p>沿着这条思路，阿里的同学们在提出DIN模型之后，并没有停止推荐模型演化的进程，他们又在2019年提出了DIN模型的演化版本，也就是深度兴趣进化网络DIEN（Deep Interest Evolution Network）。这个DIEN到底在DIN的基础上做了哪些改进呢？</p><h2>兴趣进化序列模型</h2><p>无论是电商购买行为，还是视频网站的观看行为，或是新闻应用的阅读行为，特定用户的历史行为都是一个随时间排序的序列。既然是和时间相关的序列，就一定存在前后行为的依赖关系，这样的序列信息对于推荐过程是非常有价值的。为什么这么说呢？</p><p>我们还拿阿里的电商场景举个例子。对于一个综合电商来说，用户兴趣的迁移其实是非常快的。比如，上一周一位用户在挑选一双篮球鞋，这位用户上周的行为序列都会集中在篮球鞋这个品类的各个商品上，但在他完成这一购物目标后，这一周他的购物兴趣就可能变成买一个机械键盘，那这周他所有的购买行为都会围绕机械键盘这个品类展开。</p><p>因此，如果我们能让模型预测出用户购买商品的趋势，肯定会对提升推荐效果有益。而DIEN模型正好弥补了DIN模型没有对行为序列进行建模的缺陷，它围绕兴趣进化这个点进一步对DIN模型做了改进。</p><p>图4就是DIEN模型的架构图，这个模型整体上仍然是一个Embedding MLP的模型结构。与DIN不同的是，DIEN用“兴趣进化网络”也就是图中的彩色部分替换掉了原来带有激活单元的用户历史行为部分。这部分虽然复杂，但它的输出只是一个h'(T)的Embedding向量，它代表了用户当前的兴趣向量。有了这个兴趣向量之后，再把它与其他特征连接在一起，DIEN就能通过MLP作出最后的预测了。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/a0/56c93e11aa3503852c37cd18db740da0.jpg?wh=1920*900\" alt=\"\" title=\"图4 DIEN模型的架构图 （出自论文 Deep Interest Evolution Network for Click-Through Rate Prediction）\"></p><p>好了，现在问题的焦点就在，DIEN模型是如何生成这个兴趣向量的。关键就在于DIEN模型中彩色部分的三层兴趣进化网络，下面，我就按照从下到上的顺序，给你讲讲它们的名称和作用。</p><p><strong>最下面一层是行为序列层</strong>（Behavior  Layer，浅绿色部分）。它的主要作用和一个普通的Embedding层是一样的，负责把原始的ID类行为序列转换成Embedding行为序列。</p><p><strong>再上一层是兴趣抽取层</strong>（Interest Extractor Layer，浅黄色部分）。它的主要作用是利用GRU组成的序列模型，来模拟用户兴趣迁移过程，抽取出每个商品节点对应的用户兴趣。</p><p><strong>最上面一层是兴趣进化层</strong>（Interest Evolving Layer，浅红色部分）。它的主要作用是利用AUGRU(GRU with Attention Update Gate)组成的序列模型，在兴趣抽取层基础上加入注意力机制，模拟与当前目标广告（Target Ad）相关的兴趣进化过程，兴趣进化层的最后一个状态的输出就是用户当前的兴趣向量h'(T)。</p><p>你发现了吗，兴趣抽取层和兴趣进化层都用到了序列模型的结构，那什么是序列模型呢？直观地说，图5就是一个典型的序列模型的结构，它和我们之前看到的多层神经网络的结构不同，序列模型是“一串神经元”，其中每个神经元对应了一个输入和输出。</p><p>在DIEN模型中，神经元的输入就是商品ID或者前一层序列模型的Embedding向量，而输出就是商品的Embedding或者兴趣Embedding，除此之外，每个神经元还会与后续神经元进行连接，用于预测下一个状态，放到DIEN里就是为了预测用户的下一个兴趣。这就是序列模型的结构和作用。</p><p><a href=\"https://towardsdatascience.com/introduction-to-recurrent-neural-networks-rnn-with-dinosaurs-790e74e3e6f6\"><img src=\"https://static001.geekbang.org/resource/image/f6/37/f69c0f565b5fa31023b727192d3b1d37.jpg?wh=1400*344\" alt=\"\" title=\"图5 RNN模型的经典结构 \"></a></p><p>至于上面提到过的GRU序列模型，它其实是序列模型的一种，根据序列模型神经元结构的不同，最经典的有<a href=\"https://arxiv.org/pdf/1406.1078.pdf\">RNN</a>、<a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.676.4320&amp;rep=rep1&amp;type=pdf\">LSTM</a>、<a href=\"https://arxiv.org/pdf/1412.3555.pdf\">GRU</a>这3种。这里我们就不展开讲了，对理论感兴趣的同学，可以点击我给出的超链接，参考这几篇论文做更深入的研究。</p><p><a href=\"http://dprogrammer.org/rnn-lstm-gru\"><img src=\"https://static001.geekbang.org/resource/image/be/02/bed695e253a49e6f08a6627782ec9202.jpg?wh=1849*557\" alt=\"\" title=\"图6 序列模型中的不同单元结构\"></a></p><p>事实上，序列模型已经不仅在电商场景下，成功应用于推测用户的下次购买行为，在YouTube、Netflix等视频流媒体公司的视频推荐模型中，序列模型也用来推测用户的下次观看行为（Next Watch）。除此之外，音乐类应用也非常适合使用序列模型来预测用户的音乐兴趣变化。所以，掌握DIEN模型的架构对于拓宽我们的技术视野非常有帮助。</p><h2>小结</h2><p>注意力机制和兴趣演化序列模型的加入，让推荐系统能够更好地抓住用户的心。</p><p>对于注意力机制来说，它主要模拟了人类注意力的天性。具体到阿里的DIN模型上，它利用激活单元计算出用户对于不同历史商品的注意力权重，针对当前广告商品，作出更有针对性的预测。</p><p>而序列模型更注重对序列类行为的模拟和预测。典型的例子是DIEN模型对用户购买兴趣进化过程的模拟。DIEN模型可以应用的场景非常广泛，包括电商平台的下次购买，视频网站的下次观看，音乐App的下一首歌曲等等。</p><p>总的来说，注意力机制的引入是对经典深度学习模型的一次大的改进，因为它改变了深度学习模型对待用户历史行为“一视同仁”的弊端。而序列模型则把用户行为串联起来，让用户的兴趣随时间进行演化，这也是之前的深度学习模型完全没有考虑到的结构。</p><p>最后，我把今天的重要概念总结在了表格中，方便你及时查看和复习。</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/e0/c38e2d57f570c0e3ea5c0d616397b2e0.jpeg?wh=1920*1080\" alt=\"\"></p><h2>课后思考</h2><p>DIN使用了一个结构比较复杂的激活单元来计算注意力权重，你觉得有没有更简单、更实用的方式来生成注意力权重呢？其实，计算注意力权重就是为了计算历史行为物品和广告物品的相关性，在这个过程中，你觉得能不能利用到特征交叉的知识呢？为什么？</p><p>欢迎把你的思考和疑问写在留言区，如果你的朋友们也在关注注意力机制和兴趣演化序列模型的发展，那不妨也把这节课转发给他们，我们下节课见！</p>","neighbors":{"left":{"article_title":"20 | DeepFM：如何让你的模型更好地处理特征交叉？","id":312881},"right":{"article_title":"22｜强化学习：让推荐系统像智能机器人一样自主学习","id":315254}},"comments":[{"had_liked":false,"id":264704,"user_name":"浣熊当家","can_delete":false,"product_type":"c1","uid":1952248,"ip_address":"","ucode":"939F06050423E4","user_header":"https://static001.geekbang.org/account/avatar/00/1d/c9/f8/72955ef9.jpg","comment_is_top":false,"comment_ctime":1606587781,"is_pvip":false,"replies":[{"id":"96266","content":"本质上都是做特征交叉，计算相似性的方式，一般来说，外积因为输出是一个向量，所以表达能力更强一些。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606796415,"ip_address":"","comment_id":264704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"151930443141","product_id":100060801,"comment_content":"图3中DIN的激活单元里我们用到了“外积”， 之前的课程里感觉我们多数是用“内积”。请问老师，如何选择使用“内积”和“外积”， 有什么规则吗？","like_count":36,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510656,"discussion_content":"本质上都是做特征交叉，计算相似性的方式，一般来说，外积因为输出是一个向量，所以表达能力更强一些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606796415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272609,"user_name":"李元","can_delete":false,"product_type":"c1","uid":2275142,"ip_address":"","ucode":"FBBF0B1AD37A84","user_header":"https://static001.geekbang.org/account/avatar/00/22/b7/46/0a587042.jpg","comment_is_top":false,"comment_ctime":1610172892,"is_pvip":false,"replies":[{"id":"98831","content":"已经不少了，最近提的比较多的是bert for rec","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1610221858,"ip_address":"","comment_id":272609,"utype":1}],"discussion_count":2,"race_medal":0,"score":"87509518812","product_id":100060801,"comment_content":"根据NLP的发展，我觉得GRU这种提取序列信息的方式肯定会被Transformer取代。不知道有没有人已经发paper了。","like_count":21,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513325,"discussion_content":"已经不少了，最近提的比较多的是bert for rec","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610221858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1317292,"avatar":"https://static001.geekbang.org/account/avatar/00/14/19/ac/d39011f0.jpg","nickname":"King_stone","note":"","ucode":"D76156487CE809","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":544033,"discussion_content":"bert 本身做的是transformer的encoder部分，而不是decoder部分，感觉这和gru的用途本身还是存在差异的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641383421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":513325,"ip_address":""},"score":544033,"extra":""}]}]},{"had_liked":false,"id":264570,"user_name":"Sebastian","can_delete":false,"product_type":"c1","uid":1797634,"ip_address":"","ucode":"62E6FC13DB00E3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/55lYKUdcPFgUHibRYmaRiaBdrsmnLGOHdPp4OicjBh197X0vyGa9qAwruEqicAPuUgibXO4Lz5jLudlcbtsqq2p3CpA/132","comment_is_top":false,"comment_ctime":1606528252,"is_pvip":false,"replies":[{"id":"96251","content":"DIN比DIEN的使用场景要求低很多，我知道很多团队在用，或者说很多团队在用DIN的思路来构建自己的模型。<br><br>就我自己的实践经验，attention机制是非常有价值的，推荐在自己的场景下尝试。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606787667,"ip_address":"","comment_id":264570,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70326004988","product_id":100060801,"comment_content":"老师想问下，DIN模型在工业界的排序阶段使用的多吗？因为我在想在业界每个用户都有比较长的用户行为序列的场景可能还是少数，很多公司的场景可能是，用户进入app端后点击了2-3次后可能就没有后续行为了，那么这种场景下，DIN应该就不适用了吧？","like_count":17,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510603,"discussion_content":"DIN比DIEN的使用场景要求低很多，我知道很多团队在用，或者说很多团队在用DIN的思路来构建自己的模型。\n\n就我自己的实践经验，attention机制是非常有价值的，推荐在自己的场景下尝试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606787667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264661,"user_name":"Leo Zhao","can_delete":false,"product_type":"c1","uid":1402034,"ip_address":"","ucode":"5E4917CCD120B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/64/b2/18005d2a.jpg","comment_is_top":false,"comment_ctime":1606566203,"is_pvip":true,"replies":[{"id":"96254","content":"非常好","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606787804,"ip_address":"","comment_id":264661,"utype":1}],"discussion_count":3,"race_medal":0,"score":"57441141051","product_id":100060801,"comment_content":"思考题：广告和历史行为 相关性 其实就是  广告物品与历史物品的相关性，可以用一个dot层 或者通过物品embedding 算出similarity 当作feature 直接输入。","like_count":14,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510643,"discussion_content":"非常好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606787804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2202225,"avatar":"https://static001.geekbang.org/account/avatar/00/21/9a/71/7347008c.jpg","nickname":"小泥鳅","note":"","ucode":"AE7E3223F8618F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546519,"discussion_content":"您好，如果有多个历史交互过的广告，那么simi 怎么作为feature ？也使用sum pooling的操作?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642329854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194759,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/07/bb8cd026.jpg","nickname":"Roland","note":"","ucode":"80DC2FC86AE07A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341242,"discussion_content":"embedding算similarity会有不在一个向量空间内的问题吧？除非这个embedding不是用的该网络生成的，而用的是离线生成好的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610358438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272048,"user_name":"轩","can_delete":false,"product_type":"c1","uid":2405529,"ip_address":"","ucode":"454CC1A0734A4C","user_header":"https://static001.geekbang.org/account/avatar/00/24/b4/99/79a21147.jpg","comment_is_top":false,"comment_ctime":1609917472,"is_pvip":false,"replies":[{"id":"98661","content":"这是一个很好的idea。但说实话我还没有见到非常成功的案例说能够很好的利用event interval然后取得很大的收益。也许是这个信号本身不够强，带来的收益有限。<br><br>如果今后发现相关paper，可以分享到这里。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1609956732,"ip_address":"","comment_id":272048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40264623136","product_id":100060801,"comment_content":"老师您好，我有一个问题请教您：<br>transformer中有position encoding，而在推荐的领域中，点击的序列中同样有时间间隔的因素，例如取用户最近若干次点击，可能每次间隔时间不等。这个间隔时间应该是有信息可以揭示用户兴趣的变迁速率等信息的吧？但是如何将其引入到推荐序列中呢？<br>是类似于transformer中 position learned encoding这样么？","like_count":10,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513130,"discussion_content":"这是一个很好的idea。但说实话我还没有见到非常成功的案例说能够很好的利用event interval然后取得很大的收益。也许是这个信号本身不够强，带来的收益有限。\n\n如果今后发现相关paper，可以分享到这里。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609956732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266843,"user_name":"fsc2016","can_delete":false,"product_type":"c1","uid":1255585,"ip_address":"","ucode":"5480F05703A974","user_header":"https://static001.geekbang.org/account/avatar/00/13/28/a1/fd2bfc25.jpg","comment_is_top":false,"comment_ctime":1607503100,"is_pvip":false,"replies":[{"id":"96911","content":"这个问题其实挺好的。相比CV动辄上百的隐层数量，推荐模型真的是比较“浅”的了。<br><br>隐层数量大致在1到5之间吧，确实在推荐问题上再提高隐层数量效果上意义不大，inference延迟还大，得不偿失。<br><br>至于为什么相比cv，推荐模型不需要那么多隐层，你能分享下你的思考吗？","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1607560263,"ip_address":"","comment_id":266843,"utype":1}],"discussion_count":6,"race_medal":0,"score":"40262208764","product_id":100060801,"comment_content":"1，老师，看了最近几章介绍的推荐模型，发现神经网络的隐层数量都比较少（相对cv），这个是防止模型太复杂，导致线上推断太慢吗<br>2，请教下老师，业界常用的MLP隐层数量和神经元数量，有没有一个大致的取值范围？","like_count":10,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511406,"discussion_content":"这个问题其实挺好的。相比CV动辄上百的隐层数量，推荐模型真的是比较“浅”的了。\n\n隐层数量大致在1到5之间吧，确实在推荐问题上再提高隐层数量效果上意义不大，inference延迟还大，得不偿失。\n\n至于为什么相比cv，推荐模型不需要那么多隐层，你能分享下你的思考吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607560263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2310887,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ibbg35VbtSTXrcBE1AWgwXAHmKBjru5HzSzEUaxiaTeahQqDVxr4ZATHibn67aanoMmT4uG34PNRv3norpmOqjwMw/132","nickname":"嘿人","note":"","ucode":"F56D9A416ED46D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336577,"discussion_content":"1. 对CV来说，每个样本的输入就是150528个特征(假设224*224*3的图片)，而且这些特征都是稠密的数值特征，相比推荐来说，特征维度就比较大，所以需要更深的网络来做特征提取\n\n2. 同时，推荐模型大多数特征都是结构化的数据，因此只能用全连接来对特征进行提取，而过深的全连接层会带来大量的参数，使得模型训练效率低等问题；对于CV来说，其主要考虑的是三维数据的空间特征提取，CNN中卷积核是权重共享的，这就解决全连接层参数爆炸的问题。","likes_number":28,"is_delete":false,"is_hidden":false,"ctime":1608627835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1504652,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f5/8c/82fb5890.jpg","nickname":"抱小星","note":"","ucode":"BA7B0DAFDA4AF5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384929,"discussion_content":"推荐系统解决的本质上是item对user重要程度排序的问题，对于已有模型来说，再提升隐层的深度（假设空间的维度，可以拟合更多参数更复杂的函数），增加了输出结果的精度，也不大可能会改变大部分item的排序，只是微调，因此对推荐结果来说可能没有太大的影响。回归业务的本质，需求的本质，而不是一味追求fancy的模型和技术。","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1626798747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194759,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/07/bb8cd026.jpg","nickname":"Roland","note":"","ucode":"80DC2FC86AE07A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341241,"discussion_content":"相比于推荐，CV服务的QPS相对也低一些，因此也使得它可以使用更深更复杂的模型；\n另外数据角度看，推荐的输入数据其实已经经过一层抽象；而cv就是用原始的图像，因此需要更为复杂的模型？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1610358364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2449454,"avatar":"https://static001.geekbang.org/account/avatar/00/25/60/2e/b210f88a.jpg","nickname":"张家旭","note":"","ucode":"15CE9E884D985D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352787,"discussion_content":"cv模型比推荐复杂原因主要有3个方面：\n1、图片特征和内在信息量更大，内在关系更复杂，需要更复杂的模型去拟合；\n2、cv主要是基于卷积神经网络，参数规模比普通的神经网络少太多，保证了深度 \n     模型训练的可行性（也包含算力的提升）；\n3、通过残差网络保证深度网络的有效性。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1614849830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3075770,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/ee/ba/32f67372.jpg","nickname":"LY61","note":"","ucode":"892B98E2C3240D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583363,"discussion_content":"cv每一个convolution module receptive field都很小，更深的网络，可以让effective receptive field变大，相当于MLP。\nMLP输入是structure data，curated过后的特征，CNN输入是raw images，需要系统自己去学习特征。cnn因为每一层filter的能力有限，越往后才能越学到复杂的特征。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660053437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287551,"user_name":"小红亮","can_delete":false,"product_type":"c1","uid":1103954,"ip_address":"","ucode":"C02C3CA537E155","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/52/845a2b36.jpg","comment_is_top":false,"comment_ctime":1618024979,"is_pvip":false,"replies":[{"id":"104478","content":"这是个非常好的问题，一般上线前要做模型的割裂，把复杂部分生成的Embedding做预生成，线上直接使用。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1618113482,"ip_address":"","comment_id":287551,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31682796051","product_id":100060801,"comment_content":"老师，请教一下DIEN中用到了GRU，它是串行处理的，那么推理的过程会比较慢，这就不太适合延长要求很高的场景，比如计算广告，那对于电商场景来说它DIEN的推理延迟能满足业务要求吗，或者有什么优化手段可以解决延迟问题吗","like_count":8,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518346,"discussion_content":"这是个非常好的问题，一般上线前要做模型的割裂，把复杂部分生成的Embedding做预生成，线上直接使用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618113482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264703,"user_name":"浣熊当家","can_delete":false,"product_type":"c1","uid":1952248,"ip_address":"","ucode":"939F06050423E4","user_header":"https://static001.geekbang.org/account/avatar/00/1d/c9/f8/72955ef9.jpg","comment_is_top":false,"comment_ctime":1606587123,"is_pvip":false,"replies":[{"id":"96267","content":"我在知乎有一篇专栏文章专门讲面试，可以参考 https:&#47;&#47;zhuanlan.zhihu.com&#47;p&#47;76827460<br><br>我在课程最后也会有一些总结。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606796502,"ip_address":"","comment_id":264703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31671358195","product_id":100060801,"comment_content":"想请教老师一个题外问题， 您作为面试官的话，对于MLE的候选人会更注重考察哪方面的能力（比如算法coding， 系统架构设计，机器学习的领域知识）？，然后对于机器学习的各种模型会期待候选人有多深的了解（比如说了解DIEN的各个层级的结构就够了，还是要知道GRU是具体如何实现的）。<br>随着老师课程，我对深度学习燃起了更大的热情，觉得想真正提高的话，最好的方法还是能从事做深度学习的工作，想知道从面试角度来讲，怎么学习才是性价比最高的选择， （比如注重项目经验，刷题，还是算法的理论公式推到）。","like_count":8,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510655,"discussion_content":"我在知乎有一篇专栏文章专门讲面试，可以参考 https://zhuanlan.zhihu.com/p/76827460\n\n我在课程最后也会有一些总结。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606796502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279182,"user_name":"庄小侠","can_delete":false,"product_type":"c1","uid":2201497,"ip_address":"","ucode":"36943D87578024","user_header":"https://static001.geekbang.org/account/avatar/00/21/97/99/f5e9740a.jpg","comment_is_top":false,"comment_ctime":1613646498,"is_pvip":false,"replies":[{"id":"101706","content":"问的非常好。其实应该是共用一套，用shared embedding。DIN的代码是咱们同学贡献的，如果可以改进的话，可以提交PR，非常欢迎越来越多人参与进来。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1614046175,"ip_address":"","comment_id":279182,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27383450274","product_id":100060801,"comment_content":"老师，我看了下这节课DIN.py里面的代码，发现 user_behaviors_emb_layer和candidate_emb_layer是两套不同的embding向量，请问这是为什么啊？我的理解是它们都是电影的embding向量，共用一套embding不是参数量更少嘛。实际使用里面，大家都是这样用嘛？","like_count":6,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515651,"discussion_content":"问的非常好。其实应该是共用一套，用shared embedding。DIN的代码是咱们同学贡献的，如果可以改进的话，可以提交PR，非常欢迎越来越多人参与进来。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614046175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1214938,"avatar":"https://static001.geekbang.org/account/avatar/00/12/89/da/69755cf2.jpg","nickname":"王利鹏","note":"","ucode":"830B57DC944C0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380069,"discussion_content":"借这个问题问下老师，在实验中发现序列item与候选item共用一个embedding的时候，效果反而没有各自用自己的embedding效果好，感觉有点反常。问下，这时候要相信实验？还是是我的数据不够或者训练不够导致的？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624326832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268226,"user_name":"Geek_3c29c3","can_delete":false,"product_type":"c1","uid":2203358,"ip_address":"","ucode":"3D2E73AB1D08FA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLaoiaerNMy7eoSA5yfibPNhta51jkhPTTL1dD1HGlnjaGnFQ6Uzbbce82Kpnic3g1JlD7rtm41Y83PA/132","comment_is_top":false,"comment_ctime":1608106592,"is_pvip":false,"replies":[{"id":"97413","content":"这是个好问题，我觉得是可以的，因为广告内容和商城内容从经验上来说也会有一定的相关性。<br><br>就拿deepfm的思路来说，其实可以做任意两个特征之间的交叉。对于注意力机制，当然也可以学任意两个特征间的注意力。但到底作用有多大，能不能提高效果，就看自己的实践了。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1608147980,"ip_address":"","comment_id":268226,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27377910368","product_id":100060801,"comment_content":"老师，我对DIN里面的注意力机制有一点疑问：就是DIN的目标广告的id和usr behavior的id是同一领域的id，那能不能推广到比如我们的广告id和商城内的物品不是同属于一个id系列的。就是广告的内容和商城的内容（包含用户行为）是不一样的，这时候还可以用DIN的注意力机制了吗？如果不能，还有什么方法呢？","like_count":7,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511880,"discussion_content":"这是个好问题，我觉得是可以的，因为广告内容和商城内容从经验上来说也会有一定的相关性。\n\n就拿deepfm的思路来说，其实可以做任意两个特征之间的交叉。对于注意力机制，当然也可以学任意两个特征间的注意力。但到底作用有多大，能不能提高效果，就看自己的实践了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608147980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264483,"user_name":"张弛 Conor","can_delete":false,"product_type":"c1","uid":2208459,"ip_address":"","ucode":"193EBA4A64BAB3","user_header":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","comment_is_top":false,"comment_ctime":1606474875,"is_pvip":false,"replies":[{"id":"96249","content":"思考题的回答很赞同。<br><br>关于疑问，我不是很清楚你的问题，什么叫做“历史兴趣以外的兴趣”？","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606787274,"ip_address":"","comment_id":264483,"utype":1}],"discussion_count":7,"race_medal":0,"score":"27376278651","product_id":100060801,"comment_content":"思考题：可以借鉴FM及DeepFM中特征交叉的计算方式，对两个向量直接计算内积，或者先通过Embedding层转换成维度相等的Embedding再求内积，又或者可以像双塔结构一样，设计一个历史行为物品塔和广告物品塔，在塔的最后通过求内积或者拼接后用全连接层输出权重。<br>课后疑问：<br>DIEN模型中输出的用户当前兴趣向量h&#39;(T)是由用户的历史兴趣向量所得，我的问题是，DIEA能否探索到历史兴趣以外的兴趣呢？如果可以的话，是如何在没有其他兴趣向量的参与下做到的呢？如果不行的话，请问老师在实践中是否有什么方法，可以对用户历史兴趣以外的兴趣进行探索的方法呢？","like_count":6,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510578,"discussion_content":"思考题的回答很赞同。\n\n关于疑问，我不是很清楚你的问题，什么叫做“历史兴趣以外的兴趣”？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606787274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2405529,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b4/99/79a21147.jpg","nickname":"轩","note":"","ucode":"454CC1A0734A4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340565,"discussion_content":"历史兴趣之外的兴趣么，应该指兴趣的探索与利用吧？是说这个么？\n我的实现是：\n优先拿usercf的item去填充，如果该item和历史兴趣越不相符合，那就越好。\n当然最终实现时是，但凡需要推荐结果多样性的地方，都优先去从usercf里面去找，没算是否和历史兴趣是否相符，囧。\n热门内容也一般拿来探索。反正就是探索也尽量找一些安全的item来探索吧。\n\n这块如果做的细了，可以单独起一个服务了。\n\n以上都是拍脑袋的，没有严格的理论支撑哈。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1610035135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2669283,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ba/e3/7196d766.jpg","nickname":"一半","note":"","ucode":"C44FE942E49B15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530924,"discussion_content":"模型学习的是多个用户的历史行为序列，预测下一个阶段的兴趣点，那本身学习的就是大量的用户行为特征以及行为特征的进化规律，不存在只能学习到历史存在过的兴趣的说法吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637166787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2577469,"avatar":"https://static001.geekbang.org/account/avatar/00/27/54/3d/366462d0.jpg","nickname":"Yvonne","note":"","ucode":"85287A0AC7456C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373056,"discussion_content":"你好，请问这里的usercf是指什么呀？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620591161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2208459,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","nickname":"张弛 Conor","note":"","ucode":"193EBA4A64BAB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2577469,"avatar":"https://static001.geekbang.org/account/avatar/00/27/54/3d/366462d0.jpg","nickname":"Yvonne","note":"","ucode":"85287A0AC7456C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373161,"discussion_content":"用户协同过滤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620637169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373056,"ip_address":""},"score":373161,"extra":""}]},{"author":{"id":2208459,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","nickname":"张弛 Conor","note":"","ucode":"193EBA4A64BAB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340588,"discussion_content":"对的！就是EE问题，谢谢大佬分享了用usercf来做的方法，但我这里更好奇的是DIEN是否具有兴趣的探索功能呢，它如果想实现兴趣进化的预测，我觉得直觉上似乎应该每一个时间步应该和兴趣向量做一个注意力，这样才可以实现兴趣的探索？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610068938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2454131,"avatar":"https://static001.geekbang.org/account/avatar/00/25/72/73/d707c8be.jpg","nickname":"MutouMan","note":"","ucode":"E2E78C6EE25E80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2208459,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","nickname":"张弛 Conor","note":"","ucode":"193EBA4A64BAB3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379811,"discussion_content":"我觉得DIEN得核心是通过历史兴趣来预测下一阶段得兴趣点，是没有办法探测到历史兴趣外得，比如一个人搜了nike，champion，logitech，可能下一个embedding靠近apple。但是很难会跳到gucchi吧。但是DIEN应该是看近期历史记录，或许再训练一个长期历史兴趣，和待推荐物品做attention。长期历史兴趣用协同过滤应该也可以得到，双塔应该也可以。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624170807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340588,"ip_address":""},"score":379811,"extra":""}]}]},{"had_liked":false,"id":281524,"user_name":"Geek1254","can_delete":false,"product_type":"c1","uid":2028941,"ip_address":"","ucode":"BC2F7756A0676D","user_header":"","comment_is_top":false,"comment_ctime":1614773999,"is_pvip":false,"replies":[{"id":"102386","content":"1. 确实没有使用外积。我的实践经验来看外积的作用不是很大，而且大幅增加参数量，所以我个人不是很喜欢外积操作。<br>2. PRelu几乎是深度学习默认的激活函数，速度比较快，梯度消散问题比较小。如果有特殊需要可以测试其他激活函数，看实践。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1615024390,"ip_address":"","comment_id":281524,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23089610479","product_id":100060801,"comment_content":"老师您好。<br>1.我看到在Sparrow里面的代码。没有严格意义上使用外积吧？使用的是element-wise sub &amp; multipy。然后用这两个向量去拼接，组成的activation_all。请问这是老师实践之后得到的方法吗？<br>2. 我看到参考代码中使用的是PRelu()，请问这种激活函数适合哪些场景呢？","like_count":6,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516429,"discussion_content":"1. 确实没有使用外积。我的实践经验来看外积的作用不是很大，而且大幅增加参数量，所以我个人不是很喜欢外积操作。\n2. PRelu几乎是深度学习默认的激活函数，速度比较快，梯度消散问题比较小。如果有特殊需要可以测试其他激活函数，看实践。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615024390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2865345,"avatar":"","nickname":"Geek_285507","note":"","ucode":"DC1D2FA57DDE79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":584867,"discussion_content":"老师你好：请问做Subtract时，两个参数都是user_behaviors_emb_layer，那么得到的输出是不是全零，输出是全零的密集向量是不是不太合理，不知道理解的是否有误","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661170102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":516429,"ip_address":"广东"},"score":584867,"extra":""}]}]},{"had_liked":false,"id":264370,"user_name":"那时刻","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1606448870,"is_pvip":false,"replies":[{"id":"96248","content":"其实只要是接收两个embedding，生成一个输出分数的结构理论上都可以作为激活单元。所以最简单的结构其实就是dot product或者cosin similarity。因为它们刚好揭示了两个item之间的相似度。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606787180,"ip_address":"","comment_id":264370,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23081285350","product_id":100060801,"comment_content":"DIN 使用了一个结构比较复杂的激活单元来计算注意力权重，能否有其它方法来计算呢？我开始想到的上节课提到的特征交叉，我回顾了下特征交叉，它是加强模型对于特征组合和特征交叉的学习能力以及对于未知特征组合样本的预测能力。而注意力权重是计算历史物品和广告物品相关行。我觉得它们是不同的。","like_count":6,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510542,"discussion_content":"其实只要是接收两个embedding，生成一个输出分数的结构理论上都可以作为激活单元。所以最简单的结构其实就是dot product或者cosin similarity。因为它们刚好揭示了两个item之间的相似度。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606787180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265411,"user_name":"范闲","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1606892249,"is_pvip":false,"replies":[{"id":"96517","content":"没问题","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606940101,"ip_address":"","comment_id":265411,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18786761433","product_id":100060801,"comment_content":"1.历史行为和广告物品直接dot<br>2.利用双塔模型，取最终的输出做特征","like_count":4,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510923,"discussion_content":"没问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606940101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2164898,"avatar":"https://static001.geekbang.org/account/avatar/00/21/08/a2/346431a9.jpg","nickname":"Geek_b86285","note":"","ucode":"78AF704922A5D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337472,"discussion_content":"2不是很理解，能简单说说吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608933958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1073125,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","nickname":"范闲","note":"","ucode":"F21FD7DF6BA53C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2164898,"avatar":"https://static001.geekbang.org/account/avatar/00/21/08/a2/346431a9.jpg","nickname":"Geek_b86285","note":"","ucode":"78AF704922A5D4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337969,"discussion_content":"双塔模型会有个最终的打分结果，可以把这个作为一个特征。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609139274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337472,"ip_address":""},"score":337969,"extra":""}]}]},{"had_liked":false,"id":264688,"user_name":"Geek_e0d66a","can_delete":false,"product_type":"c1","uid":1809935,"ip_address":"","ucode":"5078900C9CF936","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/l3RGUX8aLnPLmsQsra0yU5d8m7Se5jdVpaC3bkb99FuY11BPQNAsH4MPXbZjCTia9VVwn8lnBnKLkdfSiabOgxKg/132","comment_is_top":false,"comment_ctime":1606576781,"is_pvip":false,"replies":[{"id":"96268","content":"因为DIN的同学经过多次实验之后这个网络结构最好。曾经最早的DIN的激活单元是通过element wise minus做特征交叉，但是几经修改，所以都是实践的结果。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606796565,"ip_address":"","comment_id":264688,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18786445965","product_id":100060801,"comment_content":"请问老师，DIN中的激活单元，的网络结构中，为什么用户Embedding和候选集的embedding的外积，再拼接在一起？？","like_count":4,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510653,"discussion_content":"因为DIN的同学经过多次实验之后这个网络结构最好。曾经最早的DIN的激活单元是通过element wise minus做特征交叉，但是几经修改，所以都是实践的结果。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606796565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1255585,"avatar":"https://static001.geekbang.org/account/avatar/00/13/28/a1/fd2bfc25.jpg","nickname":"fsc2016","note":"","ucode":"5480F05703A974","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333314,"discussion_content":"说的，看老师的书中写的DIN模型激活部分，是商品emb和广告emb做元素差，在拼接进入激活单元得到一个权重，这里表述不一样了，都是实验的结果","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607499728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264486,"user_name":"张弛 Conor","can_delete":false,"product_type":"c1","uid":2208459,"ip_address":"","ucode":"193EBA4A64BAB3","user_header":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","comment_is_top":false,"comment_ctime":1606475622,"is_pvip":false,"replies":[{"id":"96281","content":"大于N肯定要选择最近的N个， 小于N考虑使用masking layer <br>tf.keras.layers.Masking","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606799484,"ip_address":"","comment_id":264486,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18786344806","product_id":100060801,"comment_content":"课后疑问：<br>请问老师，对于DIN和DIEN这种包含N个历史商品的模型，如果用户历史商品数小于N，那么这些位置应该如何去填充呢？如果用户商品数大于N，是否是选择最近的N个商品呢？","like_count":5,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510580,"discussion_content":"大于N肯定要选择最近的N个， 小于N考虑使用masking layer \ntf.keras.layers.Masking","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606799484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273298,"user_name":"VictorWu","can_delete":false,"product_type":"c1","uid":1505907,"ip_address":"","ucode":"94AA2A957CFA85","user_header":"https://static001.geekbang.org/account/avatar/00/16/fa/73/3b9cbc69.jpg","comment_is_top":false,"comment_ctime":1610528046,"is_pvip":false,"replies":[{"id":"99048","content":"感谢，我找时间review。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1610563171,"ip_address":"","comment_id":273298,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10200462638","product_id":100060801,"comment_content":"DIN.py 文件中第137行 tf.keras没有sum方法，sum方法应该在tf.keras.backend中<br><br>我发了个pr哈","like_count":2,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513558,"discussion_content":"感谢，我找时间review。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610563171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2735702,"avatar":"https://static001.geekbang.org/account/avatar/00/29/be/56/6a2998ba.jpg","nickname":"คิดถึง ","note":"","ucode":"205BA133D638C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391321,"discussion_content":"改成tf.keras.backend.sum就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630398428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269307,"user_name":"邓生","can_delete":false,"product_type":"c1","uid":2151666,"ip_address":"","ucode":"9A6A95784C0166","user_header":"https://static001.geekbang.org/account/avatar/00/20/d4/f2/979e5346.jpg","comment_is_top":false,"comment_ctime":1608607553,"is_pvip":false,"replies":[{"id":"97717","content":"是这样","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1608665901,"ip_address":"","comment_id":269307,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10198542145","product_id":100060801,"comment_content":"关于sum pooling有一点不明确，假如user1买了good1，对应embedding是[1,2,3]，sum pooling后是[1,2,3]，user2买了good1 good2，对应embedding是[1,2,3]和[4,5,6]，sum pooling 后是［5,7,9]。然后后续都输入到神经网络。这样就实现了神经网络固定维度输入，是这样理解吗？","like_count":2,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512230,"discussion_content":"是这样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608665901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2408697,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c0/f9/eb28d4b4.jpg","nickname":"AndyLee","note":"","ucode":"F790A3706E32E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349839,"discussion_content":"您好，请问一下，这样做sum pooling会导致拥有不同数量行为数据的用户得到的behavior向量的数值在scale上不一样，这个不一样会对模型效果有什么影响呢？换个好理解的方式提问，此处用sum pooling在原理上和average pooling有什么区别呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1613572422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1541481,"avatar":"https://static001.geekbang.org/account/avatar/00/17/85/69/e0af518c.jpg","nickname":"清少纳言","note":"","ucode":"D5A965E0182B2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2408697,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c0/f9/eb28d4b4.jpg","nickname":"AndyLee","note":"","ucode":"F790A3706E32E4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382377,"discussion_content":"疑问+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625548850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":349839,"ip_address":""},"score":382377,"extra":""}]}]},{"had_liked":false,"id":273178,"user_name":"墨量","can_delete":false,"product_type":"c1","uid":2057433,"ip_address":"","ucode":"698BFF5A8FBF18","user_header":"https://static001.geekbang.org/account/avatar/00/1f/64/d9/79aa9ba5.jpg","comment_is_top":false,"comment_ctime":1610466890,"is_pvip":true,"replies":[{"id":"98996","content":"这不是好不好理解的问题，是你理解错了的问题。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1610503169,"ip_address":"","comment_id":273178,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5905434186","product_id":100060801,"comment_content":"大佬，这一句（它的输入是当前这个历史行为商品的 Embedding，以及候选广告商品的 Embedding）加几个字，变为：<br>它的输入是当前这个【用户的】历史行为商品的 Embedding，以及候选广告商品的 Embedding。<br>是不是更好理解哇<br>","like_count":1,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513516,"discussion_content":"这不是好不好理解的问题，是你理解错了的问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610503169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265021,"user_name":"freedom","can_delete":false,"product_type":"c1","uid":2095809,"ip_address":"","ucode":"F6C120771C5E49","user_header":"https://static001.geekbang.org/account/avatar/00/1f/fa/c1/710de9b5.jpg","comment_is_top":false,"comment_ctime":1606737185,"is_pvip":false,"replies":[{"id":"96276","content":"抱歉不能提供很多经验上的指导，我很少在推荐模型里面使用BN层，从原理上怀疑是某些类别型特征非常系数导致的，权当猜测。<br>如果其他同学有相关经验，欢迎讨论。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606798789,"ip_address":"","comment_id":265021,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5901704481","product_id":100060801,"comment_content":"老师我想问一个问题，在训练模型过程中，在用到BN的时候，经常会出现BN层训练不好的情况，具体表现为训练时候(is＿training=TRUE)准召比较高。但是设置is_training为false的时候 准召降得比较厉害。moving_mean和moving_var也都有更新。请问这是因为什么原因呢，该如何解决呢？","like_count":2,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510772,"discussion_content":"抱歉不能提供很多经验上的指导，我很少在推荐模型里面使用BN层，从原理上怀疑是某些类别型特征非常系数导致的，权当猜测。\n如果其他同学有相关经验，欢迎讨论。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606798789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813865,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ujLicQ5Hk3TWX5PDRewjW3NXxVLNSczn01qtRzfia8jCeagwrCTz6FVmicODc8VbvicEDTuSBH45CyJ6ibJ7VDaoXZA/132","nickname":"财神","note":"","ucode":"A6229E080520A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332113,"discussion_content":"BN一般在在CV上上用得多一些。在推荐和NLP上一般都很少用，应该大家尝试了效果都比较差吧，白猫黑猫能抓耗子才是好猫~","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607067579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2095809,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/fa/c1/710de9b5.jpg","nickname":"freedom","note":"","ucode":"F6C120771C5E49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331167,"discussion_content":"老师为什么推荐模型里面很少用BN呢。是因为用户/item数据不能认为是服从同一个分布吗？那会用layer norm吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606799345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264641,"user_name":"张弛 Conor","can_delete":false,"product_type":"c1","uid":2208459,"ip_address":"","ucode":"193EBA4A64BAB3","user_header":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","comment_is_top":false,"comment_ctime":1606555954,"is_pvip":false,"replies":[{"id":"96261","content":"元素相减是阿里第一版DIN的选择，正式论文中采用了这一讲里介绍的Activation Unit结构。<br><br>外积的运算结果是一个向量，向量方向是这个两个向量组成的平面的法向量方向。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606796177,"ip_address":"","comment_id":264641,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5901523250","product_id":100060801,"comment_content":"请问老师，DIN模型的Activation Unit中，两个首先会进行out product运算，两个向量的外积运算不应该是一个常数或者nxn的矩阵嘛，但是图示中得到的是和向量相同维度的向量，我查阅了老师的书籍，我看书中的激活单元中相应位置使用的是元素相减，请问老师这是为什么呢？","like_count":1,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510634,"discussion_content":"元素相减是阿里第一版DIN的选择，正式论文中采用了这一讲里介绍的Activation Unit结构。\n\n外积的运算结果是一个向量，向量方向是这个两个向量组成的平面的法向量方向。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606796177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2208459,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","nickname":"张弛 Conor","note":"","ucode":"193EBA4A64BAB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331306,"discussion_content":"老师你好，我查阅了关于外积的资料，向量外积一般只定义在3维空间，对于高于3维空间的向量如何计算其外积呢？我在DIN作者的开源项目中发现作者自己没有使用外积运算，而是使用了元素相减和元素相乘，不知道老师在DIN或相关实践中是否会使用外积操作来进行向量的融合呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606826240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2208459,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg","nickname":"张弛 Conor","note":"","ucode":"193EBA4A64BAB3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334061,"discussion_content":"我也不喜欢用外积操作，我比较喜欢inner product和element wise操作。外积我始终没法得到更好的效果。\n\nDIN的paper中加入了外积操作，也许身体是诚实的，还是用了传统的交互操作。没必要纠结这些，自己实践中哪个好用用哪个。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607717058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":331306,"ip_address":""},"score":334061,"extra":""}]}]},{"had_liked":false,"id":264350,"user_name":"那时刻","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1606444639,"is_pvip":false,"replies":[{"id":"96246","content":"就是把所有向量拼接在一起，成为一个向量。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606786989,"ip_address":"","comment_id":264350,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5901411935","product_id":100060801,"comment_content":"请问老师DIN模型里的concat&amp;flatten作用是什么？","like_count":1,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510535,"discussion_content":"就是把所有向量拼接在一起，成为一个向量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606786989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337273,"user_name":"passenger","can_delete":false,"product_type":"c1","uid":1463689,"ip_address":"","ucode":"3A755C95A66D93","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/89/6ee4424c.jpg","comment_is_top":false,"comment_ctime":1646728671,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646728671","product_id":100060801,"comment_content":"为什么不直接用余弦相似度表示两个商品的关联程度？","like_count":0},{"had_liked":false,"id":336253,"user_name":"顾小平","can_delete":false,"product_type":"c1","uid":1012253,"ip_address":"","ucode":"B25F7CB3C95F5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/1d/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1646036644,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1646036644","product_id":100060801,"comment_content":"老师你好，实际工作中发现DIN网络计算量占比比较大，有没有比较好的优化手段呢？（用户的行为系列有长也又短的情况下）","like_count":0,"discussions":[{"author":{"id":1463689,"avatar":"https://static001.geekbang.org/account/avatar/00/16/55/89/6ee4424c.jpg","nickname":"passenger","note":"","ucode":"3A755C95A66D93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556975,"discussion_content":"把din的输出接到深层的网络里，这样就可以和浅层的网络并行计算了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647591677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330971,"user_name":"小泥鳅","can_delete":false,"product_type":"c1","uid":2202225,"ip_address":"","ucode":"AE7E3223F8618F","user_header":"https://static001.geekbang.org/account/avatar/00/21/9a/71/7347008c.jpg","comment_is_top":false,"comment_ctime":1642329744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642329744","product_id":100060801,"comment_content":"老师您好：dien 利用用户历史购买行为预测下一个购买的，但是如果用户没有历史购买行为呢，或者有浏览行为呢。也可以利用这些序列么","like_count":0},{"had_liked":false,"id":283505,"user_name":"haolison","can_delete":false,"product_type":"c1","uid":1740391,"ip_address":"","ucode":"7BF883557C461A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/60UgZMiaYPUp1xRqRuRLCclg25KuKyL81pwwj9meQwF7ribZU3t7AhxVC2AxUia4iawcsb3fuiaJJx2BsrWeYGoDERA/132","comment_is_top":false,"comment_ctime":1615800908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615800908","product_id":100060801,"comment_content":"王老师好，运行DIN.py报错：<br>    activation_unit = tf.keras.layers.Flatten()(activation_unit)<br>    &#39;but was passed an input_mask: &#39; + str(mask))<br>TypeError: Layer flatten does not support masking, but was passed an input_mask: Tensor(&quot;concatenate&#47;All:0&quot;, shape=(?, 5), dtype=bool)<br>网上找不到答案，调试很难，请问是bug还是数据问题呢？","like_count":0},{"had_liked":false,"id":272424,"user_name":"梁栋💝","can_delete":false,"product_type":"c1","uid":1067594,"ip_address":"","ucode":"16EEF0DD596A80","user_header":"https://static001.geekbang.org/account/avatar/00/10/4a/4a/fdae1e16.jpg","comment_is_top":false,"comment_ctime":1610087791,"is_pvip":false,"replies":[{"id":"98791","content":"这没啥好问的，行不行自己试一下不就知道了。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1610145397,"ip_address":"","comment_id":272424,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1610087791","product_id":100060801,"comment_content":"老师好，内容直击要害，获益匪浅，感谢。<br><br>想问一下，多个相同维度的embedding向量做sum pooling用tf.keras.layers.Add加起来就行，是吗。","like_count":0,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513275,"discussion_content":"这没啥好问的，行不行自己试一下不就知道了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610145397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269213,"user_name":"邓生","can_delete":false,"product_type":"c1","uid":2151666,"ip_address":"","ucode":"9A6A95784C0166","user_header":"https://static001.geekbang.org/account/avatar/00/20/d4/f2/979e5346.jpg","comment_is_top":false,"comment_ctime":1608557729,"is_pvip":false,"replies":[{"id":"97653","content":"是有一点不太清楚。我尝试答一下，我觉得你说的样本的标签吧？“是否买了”是训练这个样本时的标签。至于里面是鼠标，还是键盘，或者是其他商品，要看样本中包含的物品id。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1608595734,"ip_address":"","comment_id":269213,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1608557729","product_id":100060801,"comment_content":"关于实现DIN模型有个细节疑问：不同用户有不同的购买记录，形成的用户行为特征不一致，是否有一个固定的特征是“是否买了鼠标”？不然模型如何学习到买鼠标对预测买键盘的这一固定组合？（对不起我组织的语言有点混乱）","like_count":1,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512194,"discussion_content":"是有一点不太清楚。我尝试答一下，我觉得你说的样本的标签吧？“是否买了”是训练这个样本时的标签。至于里面是鼠标，还是键盘，或者是其他商品，要看样本中包含的物品id。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608595734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2410680,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c8/b8/27e45560.jpg","nickname":"芝乎者也","note":"","ucode":"7ACD6053DF4E55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343366,"discussion_content":"我想他的问题是，假设样本的标签(label)是&#34;是否会买键盘&#34;，那么特征里面有木有&#34;是否购买过鼠标&#34;这样的特征，我理解的DIN里面是没有这样的记忆特征(像wide&amp;deep里面的wide部分一样的记忆特征)，DIN里面的所有特征都是经过embedding后的，而且还经过sum pooling的，重点都是泛化能力，但注意力机制的加入也会有类似的记忆效果，比如，经过训练后，鼠标的embeding和键盘的embedding肯定会比较相似，则激活单元输出的权重就会比较大，从而达到记忆效果，不知道理解对了没","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1611024768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264878,"user_name":"董仁广","can_delete":false,"product_type":"c1","uid":1153594,"ip_address":"","ucode":"42EA00CF217837","user_header":"https://static001.geekbang.org/account/avatar/00/11/9a/3a/a516329e.jpg","comment_is_top":false,"comment_ctime":1606698052,"is_pvip":false,"replies":[{"id":"96264","content":"端到端训练","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606796328,"ip_address":"","comment_id":264878,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606698052","product_id":100060801,"comment_content":"DIN的激活单元相当于一个小型的深度学习模型，那这个激活单元是单独训练的嘛？如果是这样的话 那模型的y又是什么呢？还是说激活单元是作为整个DIN的一部分进行端到端的训练的？","like_count":0,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510726,"discussion_content":"端到端训练","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606796328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264365,"user_name":"kenan","can_delete":false,"product_type":"c1","uid":1221542,"ip_address":"","ucode":"3EA7A5804FA002","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/a6/9105f762.jpg","comment_is_top":false,"comment_ctime":1606447379,"is_pvip":true,"replies":[{"id":"96247","content":"不是很明白这个问题，可补充解释。","user_name":"作者回复","user_name_real":"王喆","uid":"1662192","ctime":1606787069,"ip_address":"","comment_id":264365,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1606447379","product_id":100060801,"comment_content":"王老师，候选集是这个意思，以点击预估为例，在排序阶段，我们通过把用户特征，item特征和上下文特征放入到模型里面，得到item的点击预估值。然后根据候选集里面每个item的点击预估值从大到小排序，然后取出topN。现在候选集只有item，是如何建模。有没有工程上的demo，或者资料推荐。","like_count":0,"discussions":[{"author":{"id":1662192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5c/f0/46214d29.jpg","nickname":"王喆","note":"","ucode":"2EDC616F905F3F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510540,"discussion_content":"不是很明白这个问题，可补充解释。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606787069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1944884,"avatar":"","nickname":"AstrHan","note":"","ucode":"14C5F3323A472D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343851,"discussion_content":"没有用户行为？那只有根据item的相似度进行排序了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611196018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}