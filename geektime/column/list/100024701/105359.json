{"id":105359,"title":"43 | Socketé€šä¿¡ï¼šé‡ä¸Šç‰¹å¤§é¡¹ç›®ï¼Œè¦å­¦ä¼šå’Œå…¶ä»–å…¬å¸åˆä½œ","content":"<p>ä¸Šä¸€ç¯‡é¢„ä¹ æ–‡ç« è¯´äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥æ¥çœ‹ä¸€ä¸‹ï¼Œåœ¨åº”ç”¨å±‚ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨socketçš„æ¥å£æ¥è¿›è¡Œé€šä¿¡ã€‚</p><p>å¦‚æœä½ å¯¹socketç›¸å…³çš„ç½‘ç»œåè®®åŸç†ä¸æ˜¯éå¸¸äº†è§£ï¼Œå»ºè®®ä½ å…ˆå»çœ‹ä¸€çœ‹ä¸Šä¸€ç¯‡çš„é¢„ä¹ æ–‡ç« ï¼Œå†æ¥çœ‹è¿™ä¸€ç¯‡çš„å†…å®¹ï¼Œå°±ä¼šæ¯”è¾ƒè½»æ¾ã€‚</p><p>æŒ‰ç…§å‰ä¸€ç¯‡æ–‡ç« è¯´çš„åˆ†å±‚æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œsocketæ¥å£å¤§å¤šæ•°æƒ…å†µä¸‹æ“ä½œçš„æ˜¯ä¼ è¾“å±‚ï¼Œæ›´åº•å±‚çš„åè®®ä¸ç”¨å®ƒæ¥æ“å¿ƒï¼Œè¿™å°±æ˜¯åˆ†å±‚çš„å¥½å¤„ã€‚</p><p>åœ¨ä¼ è¾“å±‚æœ‰ä¸¤ä¸ªä¸»æµçš„åè®®TCPå’ŒUDPï¼Œæ‰€ä»¥æˆ‘ä»¬çš„socketç¨‹åºè®¾è®¡ä¹Ÿæ˜¯ä¸»è¦æ“ä½œè¿™ä¸¤ä¸ªåè®®ã€‚è¿™ä¸¤ä¸ªåè®®çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé€šå¸¸çš„ç­”æ¡ˆæ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><ul>\n<li>TCPæ˜¯é¢å‘è¿æ¥çš„ï¼ŒUDPæ˜¯é¢å‘æ— è¿æ¥çš„ã€‚</li>\n<li>TCPæä¾›å¯é äº¤ä»˜ï¼Œæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€å¹¶ä¸”æŒ‰åºåˆ°è¾¾ï¼›UDPä¸æä¾›å¯é äº¤ä»˜ï¼Œä¸ä¿è¯ä¸ä¸¢å¤±ï¼Œä¸ä¿è¯æŒ‰é¡ºåºåˆ°è¾¾ã€‚</li>\n<li>TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œå‘é€æ—¶å‘çš„æ˜¯ä¸€ä¸ªæµï¼Œæ²¡å¤´æ²¡å°¾ï¼›UDPæ˜¯é¢å‘æ•°æ®æŠ¥çš„ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å‘é€ã€‚</li>\n<li>TCPæ˜¯å¯ä»¥æä¾›æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„ï¼Œæ—¢é˜²æ­¢å¯¹ç«¯è¢«å‹å®ï¼Œä¹Ÿé˜²æ­¢ç½‘ç»œè¢«å‹å®ã€‚</li>\n</ul><p>è¿™äº›ç­”æ¡ˆæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰åˆ°è¾¾æœ¬è´¨ï¼Œä¹Ÿç»å¸¸è®©äººäº§ç”Ÿé”™è§‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™äº›é—®é¢˜ï¼Œä½ çœ‹çœ‹ä½ æ˜¯å¦äº†è§£ï¼Ÿ</p><ul>\n<li>æ‰€è°“çš„è¿æ¥ï¼Œå®¹æ˜“è®©äººè¯¯ä»¥ä¸ºï¼Œä½¿ç”¨TCPä¼šä½¿å¾—ä¸¤ç«¯ä¹‹é—´çš„é€šè·¯å’Œä½¿ç”¨UDPä¸ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬ä¼šåœ¨æ²¿é€”å»ºç«‹ä¸€æ¡çº¿è¡¨ç¤ºè¿™ä¸ªè¿æ¥å—ï¼Ÿ</li>\n<li>æˆ‘ä»ä¸­å›½è®¿é—®ç¾å›½ç½‘ç«™ï¼Œä¸­é—´è¿™ä¹ˆå¤šç¯èŠ‚ï¼Œæˆ‘æ€ä¹ˆä¿è¯è¿æ¥ä¸æ–­å‘¢ï¼Ÿ</li>\n<li>ä¸­é—´æœ‰ä¸ªç½‘ç»œç®¡ç†å‘˜æ‹”äº†ä¸€æ ¹ç½‘çº¿ä¸å°±æ–­äº†å—ï¼Ÿæˆ‘ä¸èƒ½æ§åˆ¶å®ƒï¼Œå®ƒä¹Ÿä¸ä¼šé€šçŸ¥æˆ‘ï¼Œæˆ‘ä¸€ä¸ªä¸ªäººç”µè„‘æ€ä¹ˆèƒ½å¤Ÿä¿æŒè¿æ¥å‘¢ï¼Ÿ</li>\n<li>è¿˜è®©æˆ‘åšæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œæˆ‘æ—¢ç®¡ä¸äº†ä¸­é—´çš„é“¾è·¯ï¼Œä¹Ÿç®¡ä¸äº†å¯¹ç«¯çš„æœåŠ¡å™¨å‘€ï¼Œæˆ‘æ€ä¹ˆèƒ½å¤Ÿåšåˆ°ï¼Ÿ</li>\n<li>æŒ‰ç…§ç½‘ç»œåˆ†å±‚ï¼ŒTCPå’ŒUDPéƒ½æ˜¯åŸºäºIPåè®®çš„ï¼ŒIPéƒ½ä¸èƒ½ä¿è¯å¯é ï¼Œè¯´ä¸¢å°±ä¸¢ï¼ŒTCPæ€ä¹ˆèƒ½å¤Ÿä¿è¯å‘¢ï¼Ÿ</li>\n<li>IPå±‚éƒ½æ˜¯ä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…åœ°å‘é€ï¼ŒTCPæ€ä¹ˆå°±å˜æˆæµäº†ï¼Ÿ</li>\n</ul><!-- [[[read_end]]] --><p>ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œæ‰€è°“çš„<strong>å»ºç«‹è¿æ¥</strong>ï¼Œå…¶å®æ˜¯ä¸ºäº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»´æŠ¤è¿æ¥ï¼Œè€Œå»ºç«‹ä¸€å®šçš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤åŒæ–¹äº¤äº’çš„çŠ¶æ€ï¼Œå¹¶ç”¨è¿™æ ·çš„æ•°æ®ç»“æ„æ¥ä¿è¯é¢å‘è¿æ¥çš„ç‰¹æ€§ã€‚TCPæ— æ³•å·¦å³ä¸­é—´çš„ä»»ä½•é€šè·¯ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆè™šæ‹Ÿçš„è¿æ¥ï¼Œä¸­é—´çš„é€šè·¯æ ¹æœ¬æ„è¯†ä¸åˆ°ä¸¤ç«¯ä½¿ç”¨äº†TCPè¿˜æ˜¯UDPã€‚</p><p>æ‰€è°“çš„<strong>è¿æ¥</strong>ï¼Œå°±æ˜¯ä¸¤ç«¯æ•°æ®ç»“æ„çŠ¶æ€çš„ååŒï¼Œä¸¤è¾¹çš„çŠ¶æ€èƒ½å¤Ÿå¯¹å¾—ä¸Šã€‚ç¬¦åˆTCPåè®®çš„è§„åˆ™ï¼Œå°±è®¤ä¸ºè¿æ¥å­˜åœ¨ï¼›ä¸¤é¢çŠ¶æ€å¯¹ä¸ä¸Šï¼Œè¿æ¥å°±ç®—æ–­äº†ã€‚</p><p>æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶å…¶å®å°±æ˜¯æ ¹æ®æ”¶åˆ°çš„å¯¹ç«¯çš„ç½‘ç»œåŒ…ï¼Œè°ƒæ•´ä¸¤ç«¯æ•°æ®ç»“æ„çš„çŠ¶æ€ã€‚TCPåè®®çš„è®¾è®¡ç†è®ºä¸Šè®¤ä¸ºï¼Œè¿™æ ·è°ƒæ•´äº†æ•°æ®ç»“æ„çš„çŠ¶æ€ï¼Œå°±èƒ½è¿›è¡Œæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶äº†ï¼Œå…¶å®åœ¨é€šè·¯ä¸Šæ˜¯ä¸æ˜¯çœŸçš„åšåˆ°äº†ï¼Œè°ä¹Ÿç®¡ä¸ç€ã€‚</p><p>æ‰€è°“çš„<strong>å¯é </strong>ï¼Œä¹Ÿæ˜¯ä¸¤ç«¯çš„æ•°æ®ç»“æ„åšçš„äº‹æƒ…ã€‚ä¸ä¸¢å¤±å…¶å®æ˜¯æ•°æ®ç»“æ„åœ¨â€œç‚¹åâ€ï¼Œé¡ºåºåˆ°è¾¾å…¶å®æ˜¯æ•°æ®ç»“æ„åœ¨â€œæ’åºâ€ï¼Œé¢å‘æ•°æ®æµå…¶å®æ˜¯æ•°æ®ç»“æ„å°†é›¶æ•£çš„åŒ…ï¼ŒæŒ‰ç…§é¡ºåºææˆä¸€ä¸ªæµå‘ç»™åº”ç”¨å±‚ã€‚æ€»è€Œè¨€ä¹‹ï¼Œâ€œè¿æ¥â€ä¸¤ä¸ªå­—è®©äººè¯¯ä»¥ä¸ºåŠŸå¤«åœ¨é€šè·¯ï¼Œå…¶å®åŠŸå¤«åœ¨ä¸¤ç«¯ã€‚</p><p>å½“ç„¶ï¼Œæ— è®ºæ˜¯ç”¨socketæ“ä½œTCPï¼Œè¿˜æ˜¯UDPï¼Œæˆ‘ä»¬é¦–å…ˆéƒ½è¦è°ƒç”¨socketå‡½æ•°ã€‚</p><pre><code>int socket(int domain, int type, int protocol);\n</code></pre><p>socketå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªsocketçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå”¯ä¸€æ ‡è¯†ä¸€ä¸ªsocketã€‚æˆ‘ä»¬æŠŠå®ƒå«ä½œæ–‡ä»¶æè¿°ç¬¦ï¼Œå› ä¸ºåœ¨å†…æ ¸ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”åç»­çš„æ“ä½œéƒ½æœ‰ç”¨åˆ°å®ƒã€‚</p><p>socketå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ã€‚</p><ul>\n<li>domainï¼šè¡¨ç¤ºä½¿ç”¨ä»€ä¹ˆIPå±‚åè®®ã€‚AF_INETè¡¨ç¤ºIPv4ï¼ŒAF_INET6è¡¨ç¤ºIPv6ã€‚</li>\n<li>typeï¼šè¡¨ç¤ºsocketç±»å‹ã€‚SOCK_STREAMï¼Œé¡¾åæ€ä¹‰å°±æ˜¯TCPé¢å‘æµçš„ï¼ŒSOCK_DGRAMå°±æ˜¯UDPé¢å‘æ•°æ®æŠ¥çš„ï¼ŒSOCK_RAWå¯ä»¥ç›´æ¥æ“ä½œIPå±‚ï¼Œæˆ–è€…éTCPå’ŒUDPçš„åè®®ã€‚ä¾‹å¦‚ICMPã€‚</li>\n<li>protocolè¡¨ç¤ºçš„åè®®ï¼ŒåŒ…æ‹¬IPPROTO_TCPã€IPPTOTO_UDPã€‚</li>\n</ul><p>é€šä¿¡ç»“æŸåï¼Œæˆ‘ä»¬è¿˜è¦åƒå…³é—­æ–‡ä»¶ä¸€æ ·ï¼Œå…³é—­socketã€‚</p><h2>é’ˆå¯¹TCPåº”è¯¥å¦‚ä½•ç¼–ç¨‹ï¼Ÿ</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ï¼Œé’ˆå¯¹TCPï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ç¼–ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/da/997e39e5574252ada22220e4b3646dda.png?wh=1303*1603\" alt=\"\"></p><p>TCPçš„æœåŠ¡ç«¯è¦å…ˆç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œä¸€èˆ¬æ˜¯å…ˆè°ƒç”¨bindå‡½æ•°ï¼Œç»™è¿™ä¸ªsocketèµ‹äºˆä¸€ä¸ªç«¯å£å’ŒIPåœ°å€ã€‚</p><pre><code>int bind(int sockfd, const struct sockaddr *addr,socklen_t addrlen);\n\nstruct sockaddr_in {\n  __kernel_sa_family_t\tsin_family;\t/* Address family\t\t*/\n  __be16\t\tsin_port;\t/* Port number\t\t\t*/\n  struct in_addr\tsin_addr;\t/* Internet address\t\t*/\n\n  /* Pad to size of `struct sockaddr'. */\n  unsigned char\t\t__pad[__SOCK_SIZE__ - sizeof(short int) -\n\t\t\tsizeof(unsigned short int) - sizeof(struct in_addr)];\n};\n\nstruct in_addr {\n\t__be32\ts_addr;\n};\n</code></pre><p>å…¶ä¸­ï¼Œsockfdæ˜¯ä¸Šé¢æˆ‘ä»¬åˆ›å»ºçš„socketæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨sockaddr_inç»“æ„ä¸­ï¼Œsin_familyè®¾ç½®ä¸ºAF_INETï¼Œè¡¨ç¤ºIPv4ï¼›sin_portæ˜¯ç«¯å£å·ï¼›sin_addræ˜¯IPåœ°å€ã€‚</p><p>æœåŠ¡ç«¯æ‰€åœ¨çš„æœåŠ¡å™¨å¯èƒ½æœ‰å¤šä¸ªç½‘å¡ã€å¤šä¸ªåœ°å€ï¼Œå¯ä»¥é€‰æ‹©ç›‘å¬åœ¨ä¸€ä¸ªåœ°å€ï¼Œä¹Ÿå¯ä»¥ç›‘å¬0.0.0.0è¡¨ç¤ºæ‰€æœ‰çš„åœ°å€éƒ½ç›‘å¬ã€‚æœåŠ¡ç«¯ä¸€èˆ¬è¦ç›‘å¬åœ¨ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ç«¯å£ä¸Šï¼Œä¾‹å¦‚ï¼ŒNginxä¸€èˆ¬æ˜¯80ï¼ŒTomcatä¸€èˆ¬æ˜¯8080ã€‚</p><p>å®¢æˆ·ç«¯è¦è®¿é—®æœåŠ¡ç«¯ï¼Œè‚¯å®šäº‹å…ˆè¦çŸ¥é“æœåŠ¡ç«¯çš„ç«¯å£ã€‚æ— è®ºæ˜¯ç”µå•†ï¼Œè¿˜æ˜¯æ¸¸æˆï¼Œè¿˜æ˜¯è§†é¢‘ï¼Œå¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç°éƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„ç«¯å£ã€‚å¯èƒ½ä½ ä¼šå‘ç°ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦bindï¼Œå› ä¸ºæµè§ˆå™¨å˜›ï¼Œéšæœºåˆ†é…ä¸€ä¸ªç«¯å£å°±å¯ä»¥äº†ï¼Œåªæœ‰ä½ ä¸»åŠ¨å»è¿æ¥åˆ«äººï¼Œåˆ«äººä¸ä¼šä¸»åŠ¨è¿æ¥ä½ ï¼Œæ²¡æœ‰äººå…³å¿ƒå®¢æˆ·ç«¯ç›‘å¬åˆ°äº†å“ªé‡Œã€‚</p><p>å¦‚æœä½ çœ‹ä¸Šé¢ä»£ç ä¸­çš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢çš„å˜é‡åç§°éƒ½æœ‰â€œbeâ€ä¸¤ä¸ªå­—æ¯ï¼Œä»£è¡¨çš„æ„æ€æ˜¯â€œbig-endianâ€ã€‚å¦‚æœåœ¨ç½‘ç»œä¸Šä¼ è¾“è¶…è¿‡1 Byteçš„ç±»å‹ï¼Œå°±è¦åŒºåˆ†<strong>å¤§ç«¯</strong>ï¼ˆBig Endianï¼‰å’Œ<strong>å°ç«¯</strong>ï¼ˆLittle Endianï¼‰ã€‚</p><p>å‡è®¾ï¼Œæˆ‘ä»¬è¦åœ¨32ä½4 Bytesçš„ä¸€ä¸ªç©ºé—´å­˜æ”¾æ•´æ•°1ï¼Œå¾ˆæ˜¾ç„¶åªè¦1 Byteæ”¾1ï¼Œå…¶ä»–3 Bytesæ”¾0å°±å¯ä»¥äº†ã€‚é‚£é—®é¢˜æ˜¯ï¼Œæœ€åä¸€ä¸ªByteæ”¾1å‘¢ï¼Œè¿˜æ˜¯ç¬¬ä¸€ä¸ªByteæ”¾1å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œ1ä½œä¸ºæœ€ä½ä½ï¼Œåº”è¯¥æ”¾åœ¨32ä½çš„æœ€åä¸€ä¸ªä½ç½®å‘¢ï¼Œè¿˜æ˜¯æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®å‘¢ï¼Ÿ</p><p>æœ€ä½ä½æ”¾åœ¨æœ€åä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å«ä½œå°ç«¯ï¼Œæœ€ä½ä½æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå«ä½œå¤§ç«¯ã€‚TCP/IPæ ˆæ˜¯æŒ‰ç…§å¤§ç«¯æ¥è®¾è®¡çš„ï¼Œè€Œx86æœºå™¨å¤šæŒ‰ç…§å°ç«¯æ¥è®¾è®¡ï¼Œå› è€Œå‘å‡ºå»æ—¶éœ€è¦åšä¸€ä¸ªè½¬æ¢ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±è¦å»ºç«‹TCPçš„è¿æ¥äº†ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…¶å®å°±æ˜¯å°†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„çŠ¶æ€é€šè¿‡ä¸‰æ¬¡ç½‘ç»œäº¤äº’ï¼Œè¾¾åˆ°åˆå§‹çŠ¶æ€æ˜¯ååŒçš„çŠ¶æ€ã€‚ä¸‹å›¾å°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„åºåˆ—å›¾ä»¥åŠå¯¹åº”çš„çŠ¶æ€è½¬æ¢ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/a4/0ef257133471e95bd334383e0155fda4.png?wh=1423*1063\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼ŒæœåŠ¡ç«¯è¦è°ƒç”¨listenè¿›å…¥LISTENçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</p><pre><code>int listen(int sockfd, int backlog);\n</code></pre><p>è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ï¼Œä¹Ÿå³ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ˜¯TCPå±‚çš„åŠ¨ä½œï¼Œæ˜¯åœ¨å†…æ ¸å®Œæˆçš„ï¼Œåº”ç”¨å±‚ä¸éœ€è¦å‚ä¸ã€‚</p><p>æ¥ç€ï¼ŒæœåŠ¡ç«¯åªéœ€è¦è°ƒç”¨acceptï¼Œç­‰å¾…å†…æ ¸å®Œæˆäº†è‡³å°‘ä¸€ä¸ªè¿æ¥çš„å»ºç«‹ï¼Œæ‰è¿”å›ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªè¿æ¥å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼Œacceptå°±ä¸€ç›´ç­‰å¾…ï¼›å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼Œå¹¶ä¸”åœ¨å†…æ ¸é‡Œé¢å®Œæˆäº†å¤šä¸ªä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹äº†å¤šä¸ªè¿æ¥ï¼Œè¿™äº›è¿æ¥ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ã€‚acceptä¼šä»é˜Ÿåˆ—é‡Œé¢å–å‡ºä¸€ä¸ªæ¥è¿›è¡Œå¤„ç†ã€‚å¦‚æœæƒ³è¿›ä¸€æ­¥å¤„ç†å…¶ä»–è¿æ¥ï¼Œéœ€è¦è°ƒç”¨å¤šæ¬¡acceptï¼Œæ‰€ä»¥acceptå¾€å¾€åœ¨ä¸€ä¸ªå¾ªç¯é‡Œé¢ã€‚</p><pre><code>int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡connectå‡½æ•°å‘èµ·è¿æ¥ã€‚</p><pre><code>int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);\n</code></pre><p>æˆ‘ä»¬å…ˆåœ¨å‚æ•°ä¸­æŒ‡æ˜è¦è¿æ¥çš„IPåœ°å€å’Œç«¯å£å·ï¼Œç„¶åå‘èµ·ä¸‰æ¬¡æ¡æ‰‹ã€‚å†…æ ¸ä¼šç»™å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªä¸´æ—¶çš„ç«¯å£ã€‚ä¸€æ—¦æ¡æ‰‹æˆåŠŸï¼ŒæœåŠ¡ç«¯çš„acceptå°±ä¼šè¿”å›å¦ä¸€ä¸ªsocketã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›‘å¬çš„socketå’ŒçœŸæ­£ç”¨æ¥ä¼ é€æ•°æ®çš„socketï¼Œæ˜¯ä¸¤ä¸ªsocketï¼Œä¸€ä¸ªå«ä½œ<strong>ç›‘å¬socket</strong>ï¼Œä¸€ä¸ªå«ä½œ<strong>å·²è¿æ¥socket</strong>ã€‚æˆåŠŸè¿æ¥å»ºç«‹ä¹‹åï¼ŒåŒæ–¹å¼€å§‹é€šè¿‡readå’Œwriteå‡½æ•°æ¥è¯»å†™æ•°æ®ï¼Œå°±åƒå¾€ä¸€ä¸ªæ–‡ä»¶æµé‡Œé¢å†™ä¸œè¥¿ä¸€æ ·ã€‚</p><h2>é’ˆå¯¹UDPåº”è¯¥å¦‚ä½•ç¼–ç¨‹ï¼Ÿ</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ï¼Œé’ˆå¯¹UDPåº”è¯¥å¦‚ä½•ç¼–ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/28/b2/283b0e1c21f0277ba5b4b5cbcaca03b2.png?wh=1303*1243\" alt=\"\"></p><p>UDPæ˜¯æ²¡æœ‰è¿æ¥çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¹Ÿå°±ä¸éœ€è¦è°ƒç”¨listenå’Œconnectï¼Œä½†æ˜¯UDPçš„äº¤äº’ä»ç„¶éœ€è¦IPåœ°å€å’Œç«¯å£å·ï¼Œå› è€Œä¹Ÿéœ€è¦bindã€‚</p><p>å¯¹äºUDPæ¥è®²ï¼Œæ²¡æœ‰æ‰€è°“çš„è¿æ¥ç»´æŠ¤ï¼Œä¹Ÿæ²¡æœ‰æ‰€è°“çš„è¿æ¥çš„å‘èµ·æ–¹å’Œæ¥æ”¶æ–¹ï¼Œç”šè‡³éƒ½ä¸å­˜åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ¦‚å¿µï¼Œå¤§å®¶å°±éƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œä¹ŸåŒæ—¶éƒ½æ˜¯æœåŠ¡ç«¯ã€‚åªè¦æœ‰ä¸€ä¸ªsocketï¼Œå¤šå°æœºå™¨å°±å¯ä»¥ä»»æ„é€šä¿¡ï¼Œä¸å­˜åœ¨å“ªä¸¤å°æœºå™¨æ˜¯å±äºä¸€ä¸ªè¿æ¥çš„æ¦‚å¿µã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªUDPçš„socketéƒ½éœ€è¦bindã€‚æ¯æ¬¡é€šä¿¡æ—¶ï¼Œè°ƒç”¨sendtoå’Œrecvfromï¼Œéƒ½è¦ä¼ å…¥IPåœ°å€å’Œç«¯å£ã€‚</p><pre><code>ssize_t sendto(int sockfd, const void *buf, size_t len, int flags, const struct sockaddr *dest_addr, socklen_t addrlen);\n\nssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);\n</code></pre><h2>æ€»ç»“æ—¶åˆ»</h2><p>è¿™ä¸€èŠ‚æˆ‘ä»¬è®²äº†ç½‘ç»œåè®®çš„åŸºæœ¬åŸç†å’Œsocketç³»ç»Ÿè°ƒç”¨ï¼Œè¿™é‡Œè¯·ä½ é‡ç‚¹å…³æ³¨TCPåè®®çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>é€šè¿‡å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œsocketç³»ç»Ÿè°ƒç”¨æ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„æ¥å£ï¼Œç½‘ç»œåè®®çš„å››å±‚ä»¥ä¸‹éƒ½æ˜¯åœ¨å†…æ ¸ä¸­çš„ã€‚å¾ˆå¤šçš„ä¹¦ç±ä¼šè®²å¦‚ä½•å¼€å‘ä¸€ä¸ªé«˜æ€§èƒ½çš„socketç¨‹åºï¼Œä½†æ˜¯è¿™ä¸æ˜¯æˆ‘ä»¬è¿™é—¨è¯¾çš„é‡ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦çœ‹å†…æ ¸é‡Œé¢çš„æœºåˆ¶å°±è¡Œäº†ã€‚</p><p>å› æ­¤ï¼Œä½ éœ€è¦è®°ä½TCPåè®®çš„socketè°ƒç”¨çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°±æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œä¾æ¬¡å›å¿†ä¸€ä¸‹è¿™äº›ç³»ç»Ÿè°ƒç”¨åˆ°å†…æ ¸éƒ½åšäº†ä»€ä¹ˆï¼š</p><ul>\n<li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è°ƒç”¨socketï¼Œå¾—åˆ°æ–‡ä»¶æè¿°ç¬¦ï¼›</li>\n<li>æœåŠ¡ç«¯è°ƒç”¨listenï¼Œè¿›è¡Œç›‘å¬ï¼›</li>\n<li>æœåŠ¡ç«¯è°ƒç”¨acceptï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼›</li>\n<li>å®¢æˆ·ç«¯è°ƒç”¨connectï¼Œè¿æ¥æœåŠ¡ç«¯ï¼›</li>\n<li>æœåŠ¡ç«¯acceptè¿”å›ç”¨äºä¼ è¾“çš„socketçš„æ–‡ä»¶æè¿°ç¬¦ï¼›</li>\n<li>å®¢æˆ·ç«¯è°ƒç”¨writeå†™å…¥æ•°æ®ï¼›</li>\n<li>æœåŠ¡ç«¯è°ƒç”¨readè¯»å–æ•°æ®ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/d3/5c/d34e667d1c3340deb8c82a2d44f2a65c.png?wh=1786*1375\" alt=\"\"></p><h2>è¯¾å ‚ç»ƒä¹ </h2><p>è¯·ä½ æ ¹æ®ä»Šå¤©è®²çš„socketç³»ç»Ÿè°ƒç”¨ï¼Œå†™ä¸€ä¸ªç®€å•çš„socketç¨‹åºæ¥ä¼ è¾“ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„ç–‘æƒ‘å’Œè§è§£ ï¼Œä¹Ÿæ¬¢è¿å¯ä»¥æ”¶è—æœ¬èŠ‚å†…å®¹ï¼Œåå¤ç ”è¯»ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå’Œä»–ä¸€èµ·å­¦ä¹ å’Œè¿›æ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/37/8c0a95fa07a8b9a1abfd394479bdd637.jpg?wh=1110*659\" alt=\"\"></p>","comments":[{"had_liked":false,"id":110434,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1562258104,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"267850230456","product_id":100024701,"comment_content":"è€å¸ˆï¼Œå¯ä¸å¯ä»¥åœ¨ç­”ç–‘ç¯‡ï¼Œå¢åŠ ä¸€ä¸ªselect,poll,epollçš„å†…æ ¸æœºåˆ¶åˆ†æï¼Ÿ","like_count":63,"discussions":[{"author":{"id":1716827,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/32/5b/d0c7e813.jpg","nickname":"luo","note":"","ucode":"1A1DA8EB916ECF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564874,"discussion_content":"æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650345726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1756562,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/92/f75a00dd.jpg","nickname":"ã€è½å¶ä¸ºä½ èˆ","note":"","ucode":"A196460774A33F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":118958,"discussion_content":"æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578204510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563813,"avatar":"https://static001.geekbang.org/account/avatar/00/17/dc/a5/fe89fd57.jpg","nickname":"rinne","note":"","ucode":"2328E08C3E2D96","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6883,"discussion_content":"æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567153520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135151,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/vTku9cFYPh2T8DSImQoPRLxgSibcVgCRYqMcEYibexxLkfn9IKhUSAasZ7QoB72SDWym31niah2y00ibRWdHibibib1wQ/132","nickname":"Regina","note":"","ucode":"2256559FB9A8D7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4544,"discussion_content":"æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565534812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145650,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/32/60089a62.jpg","nickname":"æ¨é¢†well","note":"","ucode":"3974A03855168C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2242,"discussion_content":"æ”¯æŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563404367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129097,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1567042227,"is_pvip":false,"replies":[{"id":"48749","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":129097,"uid":"1001590","ip_address":"","utype":1,"ctime":1567493644,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"57401617075","product_id":100024701,"comment_content":"ã€è¿æ¥åŠŸå¤«åœ¨ä¸¤ç«¯ï¼Œè€Œä¸åœ¨é€šè·¯ã€‚é€šè¿‡ä¸¤ç«¯çš„åº•å±‚sockç»“æ„ä½“ç»´æŒçŠ¶æ€ä¿¡æ¯ã€‚ã€è€å¸ˆè¿™å¥è¯æ€»ç»“å¾ˆåˆ°ä½ç»“åˆsocketç³»ç»Ÿè°ƒç”¨çš„æºç åˆ†æä¼šæ›´åŠ å®¹æ˜“ç†è§£ã€‚","like_count":14,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465275,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567493644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112979,"user_name":"ç¨‹åºæ°´æœå®","can_delete":false,"product_type":"c1","uid":1371633,"ip_address":"","ucode":"1700DDFE073A56","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132","comment_is_top":false,"comment_ctime":1562859286,"is_pvip":false,"replies":[{"id":"46683","content":"éœ€è¦ä¸¤ä¸ªæ•°æ®ç»“æ„ä¿å­˜ä¸åŒçš„çŠ¶æ€","user_name":"ä½œè€…å›å¤","comment_id":112979,"uid":"1001590","ip_address":"","utype":1,"ctime":1566379759,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"44512532246","product_id":100024701,"comment_content":"ä¸ºä»€ä¹ˆè¦ä¸¤ä¸ªsocketï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457991,"discussion_content":"éœ€è¦ä¸¤ä¸ªæ•°æ®ç»“æ„ä¿å­˜ä¸åŒçš„çŠ¶æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566379759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110797,"user_name":"kdb_reboot","can_delete":false,"product_type":"c1","uid":1003594,"ip_address":"","ucode":"4C56FCA563FCA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/4a/04fef27f.jpg","comment_is_top":false,"comment_ctime":1562336967,"is_pvip":false,"replies":[{"id":"46756","content":"è¿™ä¸ªä¸“æ æ¯”è¾ƒç¡¬æ ¸","user_name":"ä½œè€…å›å¤","comment_id":110797,"uid":"1001590","ip_address":"","utype":1,"ctime":1566388288,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"18742206151","product_id":100024701,"comment_content":"è€å¸ˆå‰å®³äº†, ä¾ç„¶åœ¨æ›´æ–°;<br>æœ€è¿‘æˆ‘æœ‰æ—¶é—´å­¦ä¹ è¿™ä¸ªä¸“æ äº†, ä½†æ˜¯ç›®å‰åªè·Ÿåˆ°ç¬¬åè¯¾, æŠŠä¸“æ ä½œä¸ºå¼•å­,æ¯å¤©çš„é˜…è¯»é‡è¿˜æ˜¯å¾ˆå¤§çš„<br>ç„¶å, æˆ‘æœ‰ä¸ªé—®é¢˜: ä¸“æ æ›´æ–°å®Œè€å¸ˆè¿˜ä¼šç­”ç–‘å—?å› ä¸ºè¿›åº¦åŸå› ,å¯èƒ½è¿˜æ²¡å­¦åˆ°æœ€åé¢,ä¸“æ å·²ç»æ›´æ–°å®Œäº†","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457060,"discussion_content":"è¿™ä¸ªä¸“æ æ¯”è¾ƒç¡¬æ ¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566388288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226419,"user_name":"éŸ©ä¿Šè‡£","can_delete":false,"product_type":"c1","uid":1475340,"ip_address":"","ucode":"D6A15C025570D5","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/0c/b9e39db4.jpg","comment_is_top":false,"comment_ctime":1592093984,"is_pvip":false,"replies":[{"id":"83455","content":"èµ","user_name":"ä½œè€…å›å¤","comment_id":226419,"uid":"1001590","ip_address":"","utype":1,"ctime":1592185808,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"14476995872","product_id":100024701,"comment_content":"æ’‘è¿‡è¿›ç¨‹é—´é€šä¿¡åï¼Œè¿™é‡Œç»ˆäºå¤šå°‘èƒ½çœ‹æ‡‚äº†","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498234,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592185808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135325,"user_name":"å¤©ä½¿ä¹Ÿæœ‰çˆ±","can_delete":false,"product_type":"c1","uid":1368010,"ip_address":"","ucode":"3CCB7C47A0919E","user_header":"https://static001.geekbang.org/account/avatar/00/14/df/ca/7c223fce.jpg","comment_is_top":false,"comment_ctime":1569126576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10159061168","product_id":100024701,"comment_content":"çœ‹äº†è¶£è°ˆç½‘ç»œåè®®ä¸“æ ï¼Œåœ¨ç»“åˆè¿™é‡Œçœ‹ï¼Œæ„Ÿè§‰å¯¹ç½‘ç»œé€šä¿¡çŸ¥è¯†æœ‰äº†æ›´æ·±çš„ç†è§£","like_count":2},{"had_liked":false,"id":282031,"user_name":"Allen_","can_delete":false,"product_type":"c1","uid":1677187,"ip_address":"","ucode":"CA5E00E4644CD5","user_header":"https://static001.geekbang.org/account/avatar/00/19/97/83/845b48e2.jpg","comment_is_top":false,"comment_ctime":1615022333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5909989629","product_id":100024701,"comment_content":"è¿™ä¸€ç« è§£å†³äº†æˆ‘ä¸€å¹´éƒ½é—®ä¸åˆ°çš„ç­”æ¡ˆ è°¢è°¢è€å¸ˆ","like_count":1},{"had_liked":false,"id":140573,"user_name":"å®‹æ¡“å…¬","can_delete":false,"product_type":"c1","uid":1151948,"ip_address":"","ucode":"04235C2B87AB0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/93/cc/dfe92ee1.jpg","comment_is_top":false,"comment_ctime":1571010559,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5865977855","product_id":100024701,"comment_content":"åŸæ¥0000ï¼Œæ˜¯æŒ‡ç›‘å¬ä¸€ä¸ªæœåŠ¡å™¨çš„å…¨éƒ¨ç½‘å¡ï¼Œsoga","like_count":1,"discussions":[{"author":{"id":1254656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","nickname":"88591","note":"","ucode":"04CE3E46455185","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45362,"discussion_content":"æ˜¯æ‰€æœ‰IPå“¦ï¼Œä¸æ˜¯ä¸€ä¸ªæœåŠ¡å™¨å…¨éƒ¨ç½‘å¡","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1573028052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121903,"user_name":"oldman","can_delete":false,"product_type":"c1","uid":1133711,"ip_address":"","ucode":"6BACE2832B4429","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/8f/a90b3969.jpg","comment_is_top":false,"comment_ctime":1565246606,"is_pvip":false,"replies":[{"id":"46339","content":"æ¯ä¸ªè¿æ¥éƒ½æ˜¯ä¸åŒçš„ç«¯å£å·","user_name":"ä½œè€…å›å¤","comment_id":121903,"uid":"1001590","ip_address":"","utype":1,"ctime":1566296160,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"5860213902","product_id":100024701,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼Œä¸€ç›´æ²¡æœ‰æƒ³æ˜ç™½ï¼Œå¸Œæœ›è€å¸ˆçœ‹åˆ°ä¹‹åç»™è§£ç­”ä¸€ä¸‹ï¼Œæˆ‘çŸ¥é“æœåŠ¡ç«¯ä¼šç»´æŠ¤ä¸€ä¸ªè¿æ¥çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢æ˜¯a,b,c,d,e,f,gè¿™ä¸ªæ ·çš„å¤šä¸ªè¿æ¥ï¼Œé‚£å½“å®¢æˆ·ç«¯æœ‰è¯·æ±‚è¿‡æ¥ï¼Œæ¯”å¦‚è¯´æŸä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼ŒæœåŠ¡ç«¯æ˜¯æ€ä¹ˆåŒºåˆ†ä»–æ˜¯aè¿˜æ˜¯bæˆ–è€…cå¯¹åº”çš„è¿æ¥å‘¢ï¼Ÿè°¢è°¢ã€‚","like_count":2,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461999,"discussion_content":"æ¯ä¸ªè¿æ¥éƒ½æ˜¯ä¸åŒçš„ç«¯å£å·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566296160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344166,"user_name":"è¾¹åŸè·¯è¿œ","can_delete":false,"product_type":"c1","uid":1286741,"ip_address":"","ucode":"214ECD8981E87F","user_header":"https://static001.geekbang.org/account/avatar/00/13/a2/55/1092ebb8.jpg","comment_is_top":false,"comment_ctime":1651316229,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651316229","product_id":100024701,"comment_content":"è€å¸ˆå¥½ï¼Œå¤šä¸ªç½‘å¡å¯ä»¥bindå¤šæ¬¡å—","like_count":0},{"had_liked":false,"id":311757,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1631448004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631448004","product_id":100024701,"comment_content":"ç›‘å¬ socket åœ¨æœåŠ¡ç«¯ï¼Œå·²è¿æ¥ socket åœ¨å®¢æˆ·ç«¯ï¼ŸğŸ’”","like_count":0},{"had_liked":false,"id":277735,"user_name":"åš","can_delete":false,"product_type":"c1","uid":2019536,"ip_address":"","ucode":"C02AB1CDE39D1A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d0/d0/a6c6069d.jpg","comment_is_top":false,"comment_ctime":1612532721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612532721","product_id":100024701,"comment_content":"è€å¸ˆï¼ŒUDPæµç¨‹çš„å›¾ç‰‡ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦bindå§ï¼Ÿ","like_count":0},{"had_liked":false,"id":262306,"user_name":"KèŒæ— æƒ¨","can_delete":false,"product_type":"c1","uid":2194764,"ip_address":"","ucode":"97A532D588FD49","user_header":"","comment_is_top":false,"comment_ctime":1605689582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605689582","product_id":100024701,"comment_content":"ä¸é”™ è®²çš„å¾ˆæ¸…æ™°","like_count":0},{"had_liked":false,"id":236335,"user_name":"Geek_29c23f","can_delete":false,"product_type":"c1","uid":2062612,"ip_address":"","ucode":"921FD498B55D50","user_header":"https://static001.geekbang.org/account/avatar/00/1f/79/14/dc3e49d1.jpg","comment_is_top":false,"comment_ctime":1595391362,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1595391362","product_id":100024701,"comment_content":"ä¸‰æ¬¡æ¡æ‰‹æ˜¯åœ¨listerné˜¶æ®µè¿˜æ˜¯accepté˜¶æ®µã€‚listenä¸é˜»å¡ï¼Œæ‰§è¡Œå®Œåç›´æ¥åœ¨acceptä¸‹é˜»å¡ç­‰å¾…ä¸‰æ¬¡æ¡æ‰‹ã€‚é‚£ä¸‰æ¬¡æ¡æ‰‹åº”è¯¥åœ¨accepté˜¶æ®µæ‰ å•Š","like_count":0,"discussions":[{"author":{"id":1657948,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4c/5c/9ea0f752.jpg","nickname":"ç¨‹åºçŒ¿ä¸åœ†","note":"","ucode":"BC8926A84A07C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327808,"discussion_content":"connectå‘èµ·ä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿æ¥å»ºç«‹æˆåŠŸåacceptè¿”å›","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1605957523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672030,"avatar":"","nickname":"Geek_739cf0","note":"","ucode":"58EE00AD0D5D50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589395,"discussion_content":"æ®æˆ‘æ‰€çŸ¥ï¼Œlistenä¸ä¼šå¤„ç†ä¸‰æ¬¡æ¡æ‰‹ï¼Œä»–åªæ˜¯è®©å†…æ ¸æ›¿è¿™ä¸ªsocketç»´æŠ¤ä¸€ä¸ªåŠé“¾æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ã€‚\nè€Œacceptä¹Ÿä¸ä¼šå¤„ç†ä¸‰æ¬¡æ¡æ‰‹ï¼Œåªæ˜¯å»æ£€æŸ¥è¿™ä¸ªsocketå¯¹åº”çš„å…¨è¿æ¥é˜Ÿåˆ—ï¼Œä¸ºç©ºæ—¶é˜»å¡ã€‚\nä¸‰æ¬¡æ¡æ‰‹æ˜¯ç¨‹åºè°ƒç”¨listenåï¼Œå†…æ ¸è‡ªåŠ¨ç›‘å¬å¹¶å®Œæˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1664809345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161966,"user_name":"é«˜å¿—å¼º","can_delete":false,"product_type":"c1","uid":1276563,"ip_address":"","ucode":"68737002043752","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","comment_is_top":false,"comment_ctime":1576418580,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576418580","product_id":100024701,"comment_content":"ç”¨æˆ·æ€å’Œå†…æ ¸æ€äº¤äº’è¦é€šè¿‡socketæ“ä½œtcpæˆ–udpåè®®ï¼Œæ‰€ä»¥socketå¿…ç„¶å­˜åœ¨ï¼Œå¯ä»¥è¿™æ ·ç†è§£ä¹ˆ  è€å¸ˆ","like_count":0},{"had_liked":false,"id":140389,"user_name":"é£å‘åŒ—å¹","can_delete":false,"product_type":"c1","uid":1623409,"ip_address":"","ucode":"2FD0BC5159E1C1","user_header":"https://static001.geekbang.org/account/avatar/00/18/c5/71/f7c43b49.jpg","comment_is_top":false,"comment_ctime":1570925228,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1570925228","product_id":100024701,"comment_content":"åœ¨ç¼–å†™java socketå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå®¢æˆ·ç«¯é€šè¿‡socketå‘é€æ•°æ®åˆ°é€šè¿‡socketæ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»è°ƒç”¨socket. shutdownOutput()æ‰å¯ä»¥æ”¶åˆ°ï¼Œè€ŒæœåŠ¡ç«¯å‘é€åˆ°æ¥æ”¶æˆ–è€…æ¥æ”¶åˆ°å‘é€ä¸­é—´è½¬æ¢å´ä¸éœ€è¦ä¸€ä¸ªå…³æµçš„æ“ä½œï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘€","like_count":0,"discussions":[{"author":{"id":1466447,"avatar":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","nickname":"Daiver","note":"","ucode":"9B1A03AFBC79BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277229,"discussion_content":"æœ‰ç¼“å†²åŒºï¼Œæ²¡æœ‰åŠæ—¶flush","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1591018637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139838,"user_name":"æ’","can_delete":false,"product_type":"c1","uid":1225966,"ip_address":"","ucode":"68F64BF1460D8C","user_header":"https://static001.geekbang.org/account/avatar/00/12/b4/ee/c3ff8615.jpg","comment_is_top":false,"comment_ctime":1570754720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570754720","product_id":100024701,"comment_content":"è€å¸ˆï¼ŒUDPä¸éœ€è¦listenå’Œconnectï¼Œé‚£æ˜¯ä¸æ˜¯UDPä»å¤´åˆ°å°¾å°±ä¸€ä¸ªsocketå°±å¤Ÿäº†ï¼Œä¸åƒTCPåŒºåˆ†ç›‘å¬socketå’Œå·²è¿æ¥socketï¼Ÿ","like_count":0},{"had_liked":false,"id":132386,"user_name":"é äººå“å»èµ¢","can_delete":false,"product_type":"c1","uid":1301286,"ip_address":"","ucode":"7A20F9EBE847E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg","comment_is_top":false,"comment_ctime":1568105363,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568105363","product_id":100024701,"comment_content":"TCPé¢å‘è¿æ¥ï¼ŒHTTPæ— çŠ¶æ€æ€»æ˜¯ææ··ï¼Œé—®ä¸€ä¸‹åŸºäºTCPçš„HTTPä¸ºä»€ä¹ˆä¸è®¾ç½®ä¸€ä¸ªçŠ¶æ€ä¾èµ–çš„ä¸œè¥¿ï¼Œè¦é cookieå’Œsessionæ¥å¸®å¿™å‘¢ï¼Ÿ<br>è¿™ä¸ªUDPä¸Šå­¦çš„æ—¶å€™çŸ¥é“å®æ—¶é€šè¯è§†é¢‘ä¼šç”¨åˆ°ï¼Œä¸¢åŒ…ä¸¢å¤šäº†æ˜¯ä¸æ˜¯å°±æ˜¯æˆ‘ä»¬æ„Ÿè§‰â€œå¡å¡çš„â€æ‰å¸§çš„æƒ…å†µã€‚","like_count":0,"discussions":[{"author":{"id":1266698,"avatar":"https://static001.geekbang.org/account/avatar/00/13/54/0a/9a002ad5.jpg","nickname":"Adam Lau","note":"","ucode":"7E542D6E789500","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251546,"discussion_content":"httpå¦‚æœæ˜¯æœ‰çŠ¶æ€çš„ï¼Œå„ç§ä¸­é—´ä»¶ç¼“å­˜å•¥çš„ä¸å¥½æäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588087586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130265,"user_name":"æ½‡æ˜¯æ½‡æ´’çš„æ´’","can_delete":false,"product_type":"c1","uid":1250652,"ip_address":"","ucode":"CB950E0A655AA0","user_header":"https://static001.geekbang.org/account/avatar/00/13/15/5c/aa3f8306.jpg","comment_is_top":false,"comment_ctime":1567414986,"is_pvip":true,"replies":[{"id":"48683","content":"ä¸åŒçš„æ–‡ä»¶","user_name":"ä½œè€…å›å¤","comment_id":130265,"uid":"1001590","ip_address":"","utype":1,"ctime":1567476795,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1567414986","product_id":100024701,"comment_content":"è€å¸ˆæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è°ƒç”¨ socketï¼Œå¾—åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™é‡Œæ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«æ‰“å¼€äº†ä¸åŒçš„æ–‡ä»¶ï¼Œç„¶åå„è‡ªå†™å¯¹æ–¹çš„æ–‡ä»¶ï¼Œè¯»è‡ªå·±çš„æ–‡ä»¶ï¼Œè¿˜æ˜¯è¯´æ‰“å¼€æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè¯»å’Œå†™ã€‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465881,"discussion_content":"ä¸åŒçš„æ–‡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567476795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114959,"user_name":"å’–å•¡çŒ«å£é‡Œçš„å’–å•¡çŒ«ğŸ±","can_delete":false,"product_type":"c1","uid":1036565,"ip_address":"","ucode":"FE2441B3A40375","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d1/15/7d47de48.jpg","comment_is_top":false,"comment_ctime":1563439079,"is_pvip":false,"replies":[{"id":"46571","content":"å¯ä»¥offloadç»™ç¡¬ä»¶","user_name":"ä½œè€…å›å¤","comment_id":114959,"uid":"1001590","ip_address":"","utype":1,"ctime":1566358780,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1563439079","product_id":100024701,"comment_content":"å…¶å®æˆ‘å¯¹tcpå’Œudpçš„ç†è§£å°±æ˜¯tcpåè®®æ ˆç”±åˆ†æ®µmaxsegment(æ¡æ‰‹é˜¶æ®µçš„é™„åŠ )ï¼Œè‡ªå·±å°½é‡æ¥å¤„ç†æœ€å¤§MTUé—®é¢˜ï¼Œå°½é‡é˜²æ­¢ipåˆ†ç‰‡ï¼Œå¯¹ç«¯ç½‘ç»œå±‚ç»„åŒ…ï¼Œä»è€Œå¯¼è‡´çš„tcpåº”ç”¨ä½¿ç”¨åè®®éœ€è¦è€ƒè™‘å¤„ç†åˆ†åŒ…ï¼Œç²˜åŒ…ã€‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458901,"discussion_content":"å¯ä»¥offloadç»™ç¡¬ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566358780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111659,"user_name":"Geek_92c4e9","can_delete":false,"product_type":"c1","uid":1528916,"ip_address":"","ucode":"44A3E2929E3C3E","user_header":"","comment_is_top":false,"comment_ctime":1562579401,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562579401","product_id":100024701,"comment_content":"è¶…çº§æ£’","like_count":0},{"had_liked":false,"id":110494,"user_name":"bo","can_delete":false,"product_type":"c1","uid":1368074,"ip_address":"","ucode":"B1D7177830DE07","user_header":"https://static001.geekbang.org/account/avatar/00/14/e0/0a/bf7ece06.jpg","comment_is_top":false,"comment_ctime":1562287997,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562287997","product_id":100024701,"comment_content":"è€å¸ˆå¥½ï¼udpä¸­çš„connectèƒŒååšäº†ä»€ä¹ˆå·¥ä½œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"ç½—è¾‘æ€ç»´","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200423,"discussion_content":"UDPç›´æ¥æ”¶å‘ï¼Œä¸ç”¨ç»´æŠ¤è¿æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583680031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}