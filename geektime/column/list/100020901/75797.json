{"id":75797,"title":"19 | 案例篇：为什么系统的Swap变高了（上）","content":"<p>你好，我是倪朋飞。</p><p>上一节，我通过一个斐波那契数列的案例，带你学习了内存泄漏的分析。如果在程序中直接或间接地分配了动态内存，你一定要记得释放掉它们，否则就会导致内存泄漏，严重时甚至会耗尽系统内存。</p><p>不过，反过来讲，当发生了内存泄漏时，或者运行了大内存的应用程序，导致系统的内存资源紧张时，系统又会如何应对呢？</p><p>在内存基础篇我们已经学过，这其实会导致两种可能结果，内存回收和 OOM 杀死进程。</p><p>我们先来看后一个可能结果，内存资源紧张导致的 OOM（Out Of Memory），相对容易理解，指的是系统杀死占用大量内存的进程，释放这些内存，再分配给其他更需要的进程。</p><p>这一点我们前面详细讲过，这里就不再重复了。</p><p>接下来再看第一个可能的结果，内存回收，也就是系统释放掉可以回收的内存，比如我前面讲过的缓存和缓冲区，就属于可回收内存。它们在内存管理中，通常被叫做<strong>文件页（</strong>File-backed Page）。</p><p>大部分文件页，都可以直接回收，以后有需要时，再从磁盘重新读取就可以了。而那些被应用程序修改过，并且暂时还没写入磁盘的数据（也就是脏页），就得先写入磁盘，然后才能进行内存释放。</p><p>这些脏页，一般可以通过两种方式写入磁盘。</p><ul>\n<li>\n<p>可以在应用程序中，通过系统调用 fsync  ，把脏页同步到磁盘中；</p>\n</li>\n<li>\n<p>也可以交给系统，由内核线程 pdflush 负责这些脏页的刷新。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>除了缓存和缓冲区，通过内存映射获取的文件映射页，也是一种常见的文件页。它也可以被释放掉，下次再访问的时候，从文件重新读取。</p><p>除了文件页外，还有没有其他的内存可以回收呢？比如，应用程序动态分配的堆内存，也就是我们在内存管理中说到的<strong>匿名页</strong>（Anonymous Page），是不是也可以回收呢？</p><p>我想，你肯定会说，它们很可能还要再次被访问啊，当然不能直接回收了。非常正确，这些内存自然不能直接释放。</p><p>但是，如果这些内存在分配后很少被访问，似乎也是一种资源浪费。是不是可以把它们暂时先存在磁盘里，释放内存给其他更需要的进程？</p><p>其实，这正是Linux的Swap机制。Swap把这些不常访问的内存先写到磁盘中，然后释放这些内存，给其他更需要的进程使用。再次访问这些内存时，重新从磁盘读入内存就可以了。</p><p>在前几节的案例中，我们已经分别学过缓存和OOM的原理和分析。那Swap 又是怎么工作的呢？因为内容比较多，接下来，我将用两节课的内容，带你探索Swap的工作原理，以及Swap升高后的分析方法。</p><p>今天我们先来看看，Swap究竟是怎么工作的。</p><h2>Swap原理</h2><p>前面提到，Swap说白了就是把一块磁盘空间或者一个本地文件（以下讲解以磁盘为例），当成内存来使用。它包括换出和换入两个过程。</p><ul>\n<li>\n<p>所谓换出，就是把进程暂时不用的内存数据存储到磁盘中，并释放这些数据占用的内存。</p>\n</li>\n<li>\n<p>而换入，则是在进程再次访问这些内存的时候，把它们从磁盘读到内存中来。</p>\n</li>\n</ul><p>所以你看，Swap其实是把系统的可用内存变大了。这样，即使服务器的内存不足，也可以运行大内存的应用程序。</p><p>还记得我最早学习Linux操作系统时，内存实在太贵了，一个普通学生根本就用不起大的内存，那会儿我就是开启了Swap来运行Linux桌面。当然，现在的内存便宜多了，服务器一般也会配置很大的内存，那是不是说Swap就没有用武之地了呢？</p><p>当然不是。事实上，内存再大，对应用程序来说，也有不够用的时候。</p><p>一个很典型的场景就是，即使内存不足时，有些应用程序也并不想被OOM杀死，而是希望能缓一段时间，等待人工介入，或者等系统自动释放其他进程的内存，再分配给它。</p><p>除此之外，我们常见的笔记本电脑的休眠和快速开机的功能，也基于Swap 。休眠时，把系统的内存存入磁盘，这样等到再次开机时，只要从磁盘中加载内存就可以。这样就省去了很多应用程序的初始化过程，加快了开机速度。</p><p>话说回来，既然Swap是为了回收内存，那么Linux到底在什么时候需要回收内存呢？前面一直在说内存资源紧张，又该怎么来衡量内存是不是紧张呢？</p><p>一个最容易想到的场景就是，有新的大块内存分配请求，但是剩余内存不足。这个时候系统就需要回收一部分内存（比如前面提到的缓存），进而尽可能地满足新内存请求。这个过程通常被称为<strong>直接内存回收</strong>。</p><p>除了直接内存回收，还有一个专门的内核线程用来定期回收内存，也就是<strong>kswapd0</strong>。为了衡量内存的使用情况，kswapd0定义了三个内存阈值（watermark，也称为水位），分别是</p><p>页最小阈值（pages_min）、页低阈值（pages_low）和页高阈值（pages_high）。剩余内存，则使用 pages_free 表示。</p><p>这里，我画了一张图表示它们的关系。</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/20/c1054f1e71037795c6f290e670b29120.png?wh=350*233\" alt=\"\"></p><p>kswapd0定期扫描内存的使用情况，并根据剩余内存落在这三个阈值的空间位置，进行内存的回收操作。</p><ul>\n<li>\n<p>剩余内存小于<strong>页最小阈值</strong>，说明进程可用内存都耗尽了，只有内核才可以分配内存。</p>\n</li>\n<li>\n<p>剩余内存落在<strong>页最小阈值</strong>和<strong>页低阈值</strong>中间，说明内存压力比较大，剩余内存不多了。这时kswapd0会执行内存回收，直到剩余内存大于高阈值为止。</p>\n</li>\n<li>\n<p>剩余内存落在<strong>页低阈值</strong>和<strong>页高阈值</strong>中间，说明内存有一定压力，但还可以满足新内存请求。</p>\n</li>\n<li>\n<p>剩余内存大于<strong>页高阈值</strong>，说明剩余内存比较多，没有内存压力。</p>\n</li>\n</ul><p>我们可以看到，一旦剩余内存小于页低阈值，就会触发内存的回收。这个页低阈值，其实可以通过内核选项 /proc/sys/vm/min_free_kbytes 来间接设置。min_free_kbytes 设置了页最小阈值，而其他两个阈值，都是根据页最小阈值计算生成的，计算方法如下 ：</p><pre><code>pages_low = pages_min*5/4\npages_high = pages_min*3/2\n</code></pre><h2>NUMA与Swap</h2><p>很多情况下，你明明发现了 Swap 升高，可是在分析系统的内存使用时，却很可能发现，系统剩余内存还多着呢。为什么剩余内存很多的情况下，也会发生 Swap 呢？</p><p>看到上面的标题，你应该已经想到了，这正是处理器的 NUMA （Non-Uniform Memory Access）架构导致的。</p><p>关于 NUMA，我在 CPU 模块中曾简单提到过。在 NUMA 架构下，多个处理器被划分到不同 Node 上，且每个 Node 都拥有自己的本地内存空间。</p><p>而同一个 Node 内部的内存空间，实际上又可以进一步分为不同的内存域（Zone），比如直接内存访问区（DMA）、普通内存区（NORMAL）、伪内存区（MOVABLE）等，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/be/d9/be6cabdecc2ec98893f67ebd5b9aead9.png?wh=388*279\" alt=\"\"></p><p>先不用特别关注这些内存域的具体含义，我们只要会查看阈值的配置，以及缓存、匿名页的实际使用情况就够了。</p><p>既然 NUMA 架构下的每个 Node 都有自己的本地内存空间，那么，在分析内存的使用时，我们也应该针对每个 Node 单独分析。</p><p>你可以通过 numactl 命令，来查看处理器在 Node 的分布情况，以及每个 Node 的内存使用情况。比如，下面就是一个 numactl 输出的示例：</p><pre><code>$ numactl --hardware\navailable: 1 nodes (0)\nnode 0 cpus: 0 1\nnode 0 size: 7977 MB\nnode 0 free: 4416 MB\n...\n</code></pre><p>这个界面显示，我的系统中只有一个 Node，也就是Node 0 ，而且编号为 0 和 1 的两个 CPU， 都位于 Node 0 上。另外，Node 0 的内存大小为 7977 MB，剩余内存为 4416 MB。</p><p>了解了 NUNA 的架构和 NUMA 内存的查看方法后，你可能就要问了这跟 Swap 有什么关系呢？</p><p>实际上，前面提到的三个内存阈值（页最小阈值、页低阈值和页高阈值），都可以通过内存域在 proc 文件系统中的接口 /proc/zoneinfo 来查看。</p><p>比如，下面就是一个 /proc/zoneinfo 文件的内容示例：</p><pre><code>$ cat /proc/zoneinfo\n...\nNode 0, zone   Normal\n pages free     227894\n       min      14896\n       low      18620\n       high     22344\n...\n     nr_free_pages 227894\n     nr_zone_inactive_anon 11082\n     nr_zone_active_anon 14024\n     nr_zone_inactive_file 539024\n     nr_zone_active_file 923986\n...\n</code></pre><p>这个输出中有大量指标，我来解释一下比较重要的几个。</p><ul>\n<li>\n<p>pages处的min、low、high，就是上面提到的三个内存阈值，而free是剩余内存页数，它跟后面的 nr_free_pages 相同。</p>\n</li>\n<li>\n<p>nr_zone_active_anon和nr_zone_inactive_anon，分别是活跃和非活跃的匿名页数。</p>\n</li>\n<li>\n<p>nr_zone_active_file和nr_zone_inactive_file，分别是活跃和非活跃的文件页数。</p>\n</li>\n</ul><p>从这个输出结果可以发现，剩余内存远大于页高阈值，所以此时的 kswapd0 不会回收内存。</p><p>当然，某个 Node 内存不足时，系统可以从其他 Node 寻找空闲内存，也可以从本地内存中回收内存。具体选哪种模式，你可以通过 /proc/sys/vm/zone_reclaim_mode 来调整。它支持以下几个选项：</p><ul>\n<li>\n<p>默认的 0 ，也就是刚刚提到的模式，表示既可以从其他 Node 寻找空闲内存，也可以从本地回收内存。</p>\n</li>\n<li>\n<p>1、2、4 都表示只回收本地内存，2 表示可以回写脏数据回收内存，4 表示可以用 Swap 方式回收内存。</p>\n</li>\n</ul><h2>swappiness</h2><p>到这里，我们就可以理解内存回收的机制了。这些回收的内存既包括了文件页，又包括了匿名页。</p><ul>\n<li>\n<p>对文件页的回收，当然就是直接回收缓存，或者把脏页写回磁盘后再回收。</p>\n</li>\n<li>\n<p>而对匿名页的回收，其实就是通过 Swap 机制，把它们写入磁盘后再释放内存。</p>\n</li>\n</ul><p>不过，你可能还有一个问题。既然有两种不同的内存回收机制，那么在实际回收内存时，到底该先回收哪一种呢？</p><p>其实，Linux提供了一个  /proc/sys/vm/swappiness 选项，用来调整使用Swap的积极程度。</p><p>swappiness的范围是0-100，数值越大，越积极使用Swap，也就是更倾向于回收匿名页；数值越小，越消极使用Swap，也就是更倾向于回收文件页。</p><p>虽然 swappiness 的范围是 0-100，不过要注意，这并不是内存的百分比，而是调整 Swap 积极程度的权重，即使你把它设置成0，当<a href=\"https://www.kernel.org/doc/Documentation/sysctl/vm.txt\">剩余内存+文件页小于页高阈值</a>时，还是会发生Swap。</p><p>清楚了 Swap 原理后，当遇到 Swap 使用变高时，又该怎么定位、分析呢？别急，下一节，我们将用一个案例来探索实践。</p><h2>小结</h2><p>在内存资源紧张时，Linux通过直接内存回收和定期扫描的方式，来释放文件页和匿名页，以便把内存分配给更需要的进程使用。</p><ul>\n<li>\n<p>文件页的回收比较容易理解，直接清空，或者把脏数据写回磁盘后再释放。</p>\n</li>\n<li>\n<p>而对匿名页的回收，需要通过Swap换出到磁盘中，下次访问时，再从磁盘换入到内存中。</p>\n</li>\n</ul><p>你可以设置/proc/sys/vm/min_free_kbytes，来调整系统定期回收内存的阈值（也就是页低阈值），还可以设置/proc/sys/vm/swappiness，来调整文件页和匿名页的回收倾向。</p><p>在 NUMA 架构下，每个 Node 都有自己的本地内存空间，而当本地内存不足时，默认既可以从其他 Node 寻找空闲内存，也可以从本地内存回收。</p><p>你可以设置 /proc/sys/vm/zone_reclaim_mode ，来调整NUMA本地内存的回收策略。</p><h2>思考</h2><p>最后，我想请你一起来聊聊你理解的 SWAP。我估计你以前已经碰到过 Swap 导致的性能问题，你是怎么分析这些问题的呢？你可以结合今天讲的 Swap 原理，记录自己的操作步骤，总结自己的解决思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","comments":[{"had_liked":false,"id":62745,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1063127,"ip_address":"","ucode":"F9BE6C721C5BAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/38/d7/d549bf3e.jpg","comment_is_top":false,"comment_ctime":1548147165,"is_pvip":false,"replies":[{"id":"22334","content":"嗯嗯，大部分应用都不需要swap","user_name":"作者回复","comment_id":62745,"uid":"1001282","ip_address":"","utype":1,"ctime":1548251661,"user_name_real":"倪朋飞"}],"discussion_count":5,"race_medal":0,"score":"310785792477","product_id":100020901,"comment_content":"关于上面有同学表示 hadoop 集群建议关 swap 提升性能。事实上不仅 hadoop，包括 ES 在内绝大部分 Java 的应用都建议关 swap，这个和 JVM 的 gc 有关，它在 gc 的时候会遍历所有用到的堆的内存，如果这部分内存是被 swap 出去了，遍历的时候就会有磁盘IO<br><br>可以参考这两篇文章：<br>https:&#47;&#47;www.elastic.co&#47;guide&#47;en&#47;elasticsearch&#47;reference&#47;current&#47;setup-configuration-memory.html<br><br>https:&#47;&#47;dzone.com&#47;articles&#47;just-say-no-swapping","like_count":73,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317815,"discussion_content":"k8s集群第一件事: 禁止swap","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603601728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384194,"discussion_content":"soga~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626420676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":317815,"ip_address":""},"score":384194,"extra":""}]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437334,"discussion_content":"嗯嗯，大部分应用都不需要swap","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548251661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297763,"discussion_content":"面试时也有面试官会问到swap的使用限制问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597050346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1415619,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","nickname":"陌兮","note":"","ucode":"00CE47CAECD5CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577081,"discussion_content":"有时候为了避免出现oom，会建议将swap设置为1，取一个折中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655908724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69328,"user_name":"爱学习的小学生","can_delete":false,"product_type":"c1","uid":1413556,"ip_address":"","ucode":"040AB71F0394F2","user_header":"https://static001.geekbang.org/account/avatar/00/15/91/b4/d5d9e4fb.jpg","comment_is_top":false,"comment_ctime":1550718229,"is_pvip":false,"replies":[{"id":"24850","content":"一个是性能问题，开启swap会严重影响性能（包括内存和I&#47;O）；另一个是管理问题，开启swap后通过cgroups设置的内存上限就会失效。","user_name":"作者回复","comment_id":69328,"uid":"1001282","ip_address":"","utype":1,"ctime":1550850835,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"242068886805","product_id":100020901,"comment_content":"请问老师、为什么kubernetes要关闭swap呢？","like_count":57,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440061,"discussion_content":"一个是性能问题，开启swap会严重影响性能（包括内存和I/O）；另一个是管理问题，开启swap后通过cgroups设置的内存上限就会失效。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1550850835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1247574,"avatar":"https://static001.geekbang.org/account/avatar/00/13/09/56/2628852c.jpg","nickname":"星之所在","note":"","ucode":"03ADB0ADD5FC27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":253279,"discussion_content":"最近对这块也比较想了解","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588224419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56386,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1546433799,"is_pvip":false,"replies":[{"id":"20333","content":"对的","user_name":"作者回复","comment_id":56386,"uid":"1001282","ip_address":"","utype":1,"ctime":1546445096,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"108920616199","product_id":100020901,"comment_content":"swap应该是针对以前内存小的一种优化吧,不过现在内存没那么昂贵之后,所以就没那么大的必要开启了<br>numa感觉是对系统资源做的隔离分区,不过目前虚拟化和docker这么流行。而且node与node之间访问更耗时,针对大程序不一定启到了优化作用,针对小程序,也没有太大必要。所以numa也没必要开启。<br>不知道我的理解对否,老师","like_count":26,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435010,"discussion_content":"对的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546445096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56499,"user_name":"bob","can_delete":false,"product_type":"c1","uid":1317131,"ip_address":"","ucode":"DB24FFFE0F3F3B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/d4RrUl4AJ3tdhsK76Kdcc9jQ2cvCzLsBfLYIiaRop7Ufj3byHrnvPS0O7sO935GG0fH8kicB67PklFdQJENZXNDQ/132","comment_is_top":false,"comment_ctime":1546478326,"is_pvip":false,"replies":[{"id":"21139","content":"谢谢分享","user_name":"作者回复","comment_id":56499,"uid":"1001282","ip_address":"","utype":1,"ctime":1547123020,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"74560922358","product_id":100020901,"comment_content":"swappiness=0<br>Kernel version 3.5 and newer: disables swapiness.<br>Kernel version older than 3.5: avoids swapping processes out of physical memory for as long as possible.<br>如果linux内核是3.5及以后的，最好是设置swappiness=10，不要设置swappiness=0<br><br>以前整理的说明，供大家参考。","like_count":17,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435072,"discussion_content":"谢谢分享","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1547123020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1053694,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/fe/9425e151.jpg","nickname":"Paincupid","note":"","ucode":"C75B8F8DE97998","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348095,"discussion_content":"为什么”swappiness=10，不要设置swappiness=0“，HBASE推荐使用0啊。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612425463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56034,"user_name":"石头","can_delete":false,"product_type":"c1","uid":1276641,"ip_address":"","ucode":"BE0FDDA0190061","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/e1/326f83b9.jpg","comment_is_top":false,"comment_ctime":1546388881,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"53085996433","product_id":100020901,"comment_content":"hadoop集群服务器一般是建议关闭swap交换空间，这样可提高性能。在什么情况下开swap、什么情况下关swap？","like_count":12},{"had_liked":false,"id":61090,"user_name":"日行一善520","can_delete":false,"product_type":"c1","uid":1334963,"ip_address":"","ucode":"085238E8F3968C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/J2FTWGBAoMDpKicgiaJ4b5AourOIQvlicJRu0iaDAJhlJkyRaialzuW9UUahN0CUQRuYLYciaN8Lu6u6ibYZrgj0XoXuQ/132","comment_is_top":false,"comment_ctime":1547618523,"is_pvip":false,"replies":[{"id":"22317","content":"谢谢分享","user_name":"作者回复","comment_id":61090,"uid":"1001282","ip_address":"","utype":1,"ctime":1548249943,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"48792258779","product_id":100020901,"comment_content":"看到评论有人问<br>hadoop集群服务器一般是建议关闭swap交换空间，这样可提高性能。在什么情况下开swap、什么情况下关swap？<br><br>为了性能关闭swap，这样就不会交换也不会慢了。内核里有个vm.xx的值可以调节swap和内存的比例，在使用内存90%时才交换到swap，可以设置这个来保持性能。在内存比较少的时候，还可以交换，就好了。<br><br>","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436740,"discussion_content":"谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74622,"user_name":"刘政伟","can_delete":false,"product_type":"c1","uid":1307364,"ip_address":"","ucode":"2D2BFDE4F5ACC8","user_header":"https://static001.geekbang.org/account/avatar/00/13/f2/e4/825ab8d9.jpg","comment_is_top":false,"comment_ctime":1552268784,"is_pvip":false,"replies":[{"id":"27337","content":"这是容易误解的地方，其实，即使把swappiness设置成0也不会禁止swap。想要禁止，就不要开启swap。","user_name":"作者回复","comment_id":74622,"uid":"1001282","ip_address":"","utype":1,"ctime":1552349851,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"40206974448","product_id":100020901,"comment_content":"老师，在工作中经常会遇到这种情况，系统中的剩余内存较小、缓存内存较大的，也就是整体可用内存较高的情况下，就开始使用swap了，而查看swappiness的配置为10，理论上不应该使用swap的；具体看下面的free命令，麻烦老师看下是什么原因？<br>[root@shvsolman ~]# free -m<br>             total       used       free     shared    buffers     cached<br>Mem:         32107      31356        750          0         15      12514<br>-&#47;+ buffers&#47;cache:      18825      13281<br>Swap:         3071       1581       1490<br>[root@shvsolman ~]# sysctl -a | grep swappiness<br>vm.swappiness = 10","like_count":9,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442624,"discussion_content":"这是容易误解的地方，其实，即使把swappiness设置成0也不会禁止swap。想要禁止，就不要开启swap。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552349851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56205,"user_name":"Days","can_delete":false,"product_type":"c1","uid":1317834,"ip_address":"","ucode":"4DDB1CD8F493E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/ca/9afb89a2.jpg","comment_is_top":false,"comment_ctime":1546403626,"is_pvip":false,"replies":[{"id":"20338","content":"一般是为了减少写的次数，延长Flash存储的寿命","user_name":"作者回复","comment_id":56205,"uid":"1001282","ip_address":"","utype":1,"ctime":1546445511,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"40201109290","product_id":100020901,"comment_content":"我们公司处理嵌入式系统都是关闭swap分区，具体不知道什么原因？","like_count":9,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434957,"discussion_content":"一般是为了减少写的次数，延长Flash存储的寿命","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56159,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1546398806,"is_pvip":false,"replies":[{"id":"20339","content":"👍 ","user_name":"作者回复","comment_id":56159,"uid":"1001282","ip_address":"","utype":1,"ctime":1546445575,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"27316202582","product_id":100020901,"comment_content":"[D19打卡]<br>很遗憾,还未遇到过swap导致的性能问题.<br>刚买电脑时,512M内存要四百多,可是当时也不玩linux.<br>等工作了,用linux了,内存相对来说已经比较便宜了.<br>现在就更不用说了,基本小钱能解决的问题都不是问题了.<br>--------------------<br>以前的程序喜欢在启动时预分配很多内存,可是现在的几乎都是动态分配了.<br>以前一个程序动辄实际使用内存2-3G.<br>现在即使重构后,只需要100M内存,老板都不愿意换了.[稳定第一]","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434948,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56587,"user_name":"路过","can_delete":false,"product_type":"c1","uid":1316401,"ip_address":"","ucode":"7152C19ED024CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg","comment_is_top":false,"comment_ctime":1546500157,"is_pvip":false,"replies":[{"id":"21146","content":"阈值的比较只代表回收内存的时机，具体回收哪些内存才是swappiness的目的，但是swappiness只是个倾向，而非绝对值","user_name":"作者回复","comment_id":56587,"uid":"1001282","ip_address":"","utype":1,"ctime":1547123746,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"18726369341","product_id":100020901,"comment_content":"老师，前面你写只有当剩余内存落在页最小阈值和页低阈值中间，才开始回收内存。后面讲即使把 swappiness 设置为0，当剩余内存 + 文件页小于页高阈值时，还是会发生 Swap。我理解，这里是不是应该是：当剩余内存 + 文件页小于页低阈值时，还是会发生 Swap。谢谢！","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435133,"discussion_content":"阈值的比较只代表回收内存的时机，具体回收哪些内存才是swappiness的目的，但是swappiness只是个倾向，而非绝对值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616028,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","nickname":"宏典","note":"","ucode":"63953F36596C28","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395370,"discussion_content":"我的理解是：\n回收会直到页高阈值才停止。如果剩余内存 + 文件页小于页高阈值时，那么即便回收了文件页，也不满足阈值要求。所以会回收匿名页（即使配置了swappiness为0）","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632294735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336009,"avatar":"https://static001.geekbang.org/account/avatar/00/14/62/c9/7da27891.jpg","nickname":"DKSky","note":"","ucode":"69371A81033949","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24894,"discussion_content":"`阈值的比较只代表回收内存的时机`，那么开始回收不应该是小于低阀值吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570325419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103865,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1560556140,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14445458028","product_id":100020901,"comment_content":"老师，可否认为匿名页就是堆内存和共享内存？两者都是应用程序控制","like_count":3,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317818,"discussion_content":"是的 c语言有相应api:mmap() 通过参数可以控制映射的属性. ps: malloc其实在大内存>128k时就是通过mmap分配内存, <128k时通过brk().","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603601942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61398,"user_name":"13001236383","can_delete":false,"product_type":"c1","uid":1247035,"ip_address":"","ucode":"5A1213A1B2466D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLx1Jz78aibuoJEWdLTsDhucnVDTvkkeRX2w6ZJWXp0h7Zfe7GM6vKAx3jNhFhJJaElDCicyHpf1e9Q/132","comment_is_top":false,"comment_ctime":1547690078,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14432591966","product_id":100020901,"comment_content":"除了缓存和缓冲区，通过内存映射获取的文件映射页，也是一种常见的文件页。这个和缓存和缓冲中的文件页有啥区别了","like_count":3},{"had_liked":false,"id":56401,"user_name":"爆爱渣科_无良🌾 🐖","can_delete":false,"product_type":"c1","uid":1320138,"ip_address":"","ucode":"3BC3C018530FD5","user_header":"https://static001.geekbang.org/account/avatar/00/14/24/ca/932741cb.jpg","comment_is_top":false,"comment_ctime":1546437659,"is_pvip":true,"replies":[{"id":"20332","content":"案例篇都会介绍一些常用的性能工具，用好工具事半功倍。当然，如果你有更好的方法，也欢迎分享","user_name":"作者回复","comment_id":56401,"uid":"1001282","ip_address":"","utype":1,"ctime":1546444983,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"10136372251","product_id":100020901,"comment_content":"感觉后面越写越变成讲述linux工具的文章。。。","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435021,"discussion_content":"案例篇都会介绍一些常用的性能工具，用好工具事半功倍。当然，如果你有更好的方法，也欢迎分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546444983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550960,"discussion_content":"更深入看 eBPF","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644826097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122150,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg","nickname":"万历十五年","note":"","ucode":"3D8CF5DF847AE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221939,"discussion_content":"用好工具固然是事半功倍，也更希望老师能讲得更深入些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586085994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56253,"user_name":"2xshu","can_delete":false,"product_type":"c1","uid":1188473,"ip_address":"","ucode":"71584CB9676EDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132","comment_is_top":false,"comment_ctime":1546412121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10136346713","product_id":100020901,"comment_content":"非常感谢老师的课程。让我受益匪浅。<br>老师，我还有两个问题，想请教。<br>1：zone_reclaim_mode设置成1，也即是开启zone reclaim。此时当内存即是低于water 水位的low值，是不是也得需要满足min_unmapped_ratio所给的百分比才会让kswapd0&#47;1开始内存回收？<br>(实际场景，zone内存小于low，kswapd0&#47;1确实没有调用。 不知道是不是和min_unmapped_ratio有关系.)<br>2：min_unmapped_ratio官网解释如下：<br>This is available only on NUMA kernels.<br><br>This is a percentage of the total pages in each zone. Zone reclaim will<br>only occur if more than this percentage of pages are in a state that<br>zone_reclaim_mode allows to be reclaimed.<br><br>If zone_reclaim_mode has the value 4 OR&#39;d, then the percentage is compared<br>against all file-backed unmapped pages including swapcache pages and tmpfs<br>files. Otherwise, only unmapped pages backed by normal files but not tmpfs<br>files and similar are considered.<br><br>The default is 1 percent.<br><br>我自己理解是&#47;proc&#47;pagetypeinfo中Reclaimable所占的页数需要达到该zone总页数的百分比，才会真正回收内存？<br>希望得到老师的解答。谢谢。","like_count":2},{"had_liked":false,"id":56100,"user_name":"React","can_delete":false,"product_type":"c1","uid":1100554,"ip_address":"","ucode":"A176EF0AA242B5","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/0a/6a9e6602.jpg","comment_is_top":false,"comment_ctime":1546392811,"is_pvip":false,"replies":[{"id":"20269","content":"除了分区之外，也可以用文件","user_name":"作者回复","comment_id":56100,"uid":"1001282","ip_address":"","utype":1,"ctime":1546423973,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10136327403","product_id":100020901,"comment_content":"老师好，文中说电脑的休眠是基于swap.如果系统没有分配swap分区，还会将内存数据写入磁盘吗","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434930,"discussion_content":"除了分区之外，也可以用文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56045,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1546389879,"is_pvip":false,"replies":[{"id":"20273","content":"swapoff命令可以动态关闭，持久化还要从fstab里面删除","user_name":"作者回复","comment_id":56045,"uid":"1001282","ip_address":"","utype":1,"ctime":1546424387,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10136324471","product_id":100020901,"comment_content":"倪老师，请教一下，Linux下怎么关闭SWAP功能？直接不分配SWAP卷（或者分区、文件），还是通过某个关闭SWAP功能的系统选项？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434921,"discussion_content":"swapoff命令可以动态关闭，持久化还要从fstab里面删除","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332237,"user_name":"圆哥哥呐丶","can_delete":false,"product_type":"c1","uid":1238051,"ip_address":"","ucode":"8E56E3E68A3836","user_header":"https://static001.geekbang.org/account/avatar/00/12/e4/23/ac13d916.jpg","comment_is_top":false,"comment_ctime":1643103107,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5938070403","product_id":100020901,"comment_content":"pages 处的 min、low、high：是指 page 的数量，乘上 4k 才能换算为内存大小。<br>命令：free，cat &#47;proc&#47;zoneinfo，两者的结果是一致的，可以试着去算一下，记录下留言区老哥的这段话","like_count":1},{"had_liked":false,"id":326302,"user_name":"Podman","can_delete":false,"product_type":"c1","uid":1801003,"ip_address":"","ucode":"1C9C7EA8C28ED7","user_header":"https://static001.geekbang.org/account/avatar/00/1b/7b/2b/97e4d599.jpg","comment_is_top":false,"comment_ctime":1639464804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5934432100","product_id":100020901,"comment_content":"有一个小问题求大佬们解答：<br>buffer&#47;cache都属于内存的概念，那我理解为二者是属于物理内存的概念。<br>那么二者对应到虚拟地址空间，应该对应哪部分呢？文件映射部分么？<br><br>看网上很多人说二者和虚拟地址空间没关系。但是也说不清所以然。而且我理解，如果一个程序读写文件，那么文件必然会缓存到cache中。<br>这样，程序对文件读写操作，就要对这部分cache的物理内存做操作。程序和物理内存对应的操作需要借助虚拟地址空间，也就是说，这部分cache物理内存应该是有对应的虚拟地址空间，这样程序才能借助这部分虚拟地址来读写缓存文件。那么，这部分地址属于虚拟地址空间的什么位置呢？","like_count":1},{"had_liked":false,"id":174011,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1579872851,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874840147","product_id":100020901,"comment_content":"用户空间没有文件背景的内存页都叫匿名页，例如，堆，栈等","like_count":1},{"had_liked":false,"id":64309,"user_name":"liubiqianmoney","can_delete":false,"product_type":"c1","uid":1110679,"ip_address":"","ucode":"E5EAD53FEA01E1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZicRP0FZ78kT68wEGeWzPnxrF4s3Ea36XdMA2pj2TAbU3eibVt7KqzS5B7LbWMhRfSc3XEUL3Hrjw/132","comment_is_top":false,"comment_ctime":1548742433,"is_pvip":true,"replies":[{"id":"22985","content":"（1）会释放掉的；（2）要看进程状态，比如进程退出了就会释放掉","user_name":"作者回复","comment_id":64309,"uid":"1001282","ip_address":"","utype":1,"ctime":1548943768,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5843709729","product_id":100020901,"comment_content":"匿名页换出到磁盘之后，如果进程再次使用到，会被换入到内存中，这时候磁盘中的这个匿名页会从磁盘中释放掉吗？如果换出的匿名页一直没有被使用，从磁盘中释放的策略又怎样的呢？<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437954,"discussion_content":"（1）会释放掉的；（2）要看进程状态，比如进程退出了就会释放掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548943768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56826,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1546565185,"is_pvip":false,"replies":[{"id":"21312","content":"嗯嗯 是的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547259037,"ip_address":"","comment_id":56826,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841532481","product_id":100020901,"comment_content":"数据库应用一般都需要调整下numa。不然跨node访问内存性能就变差了。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435260,"discussion_content":"嗯嗯 是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547259037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56528,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1546482367,"is_pvip":false,"replies":[{"id":"21143","content":"解决了没？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547123451,"ip_address":"","comment_id":56528,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841449663","product_id":100020901,"comment_content":"最近碰到内存打满，瞬间导致系统负载和CPU使用率打满的情况。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435095,"discussion_content":"解决了没？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56031,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1546388568,"is_pvip":false,"replies":[{"id":"20274","content":"我的也是😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546424428,"ip_address":"","comment_id":56031,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841355864","product_id":100020901,"comment_content":"打卡day20<br>我们机器上，都不启用swap😂","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434918,"discussion_content":"我的也是😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355629,"user_name":"陈星宇(2.11)","can_delete":false,"product_type":"c1","uid":1450562,"ip_address":"四川","ucode":"970E48260B7924","user_header":"https://static001.geekbang.org/account/avatar/00/16/22/42/11674804.jpg","comment_is_top":false,"comment_ctime":1661572926,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661572926","product_id":100020901,"comment_content":"如果没为swap分配空间，是不是就相当于禁用了swap。","like_count":0},{"had_liked":false,"id":340235,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1648690982,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1648690982","product_id":100020901,"comment_content":"了解了 NUNA 的架构和 NUMA 内存的查看方法后，你可能就要问了这跟 Swap 有什么关系呢？<br><br>NUNA? 是不是写错了？","like_count":0},{"had_liked":false,"id":321003,"user_name":"Jason Wong","can_delete":false,"product_type":"c1","uid":2790451,"ip_address":"","ucode":"0DA0D724B8F8D6","user_header":"https://static001.geekbang.org/account/avatar/00/2a/94/33/4becb05a.jpg","comment_is_top":false,"comment_ctime":1636615528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636615528","product_id":100020901,"comment_content":"服务器在业务高峰时段内存比较紧张，系统会自动开启swap，但是高峰过后，系统并没有释放swap，这种情况怎么办？","like_count":0},{"had_liked":false,"id":318586,"user_name":"🐮","can_delete":false,"product_type":"c1","uid":2112298,"ip_address":"","ucode":"3FAD9EA59E1713","user_header":"https://static001.geekbang.org/account/avatar/00/20/3b/2a/f05e546a.jpg","comment_is_top":false,"comment_ctime":1635340747,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1635340747","product_id":100020901,"comment_content":"老师，如果没分配swap空间，还会执行swap操作吗，对系统性能有什么影响啊","like_count":0},{"had_liked":false,"id":310998,"user_name":"奋斗","can_delete":false,"product_type":"c1","uid":2047392,"ip_address":"","ucode":"C84C2D030ACA51","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3d/a0/acf6b165.jpg","comment_is_top":false,"comment_ctime":1631011747,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631011747","product_id":100020901,"comment_content":"倪老师你好，现在工程上遇到一个问题： 使用 mmap 将磁盘的 20G 内存映射到了虚拟内存中，现在需要频繁、随机的访问这些数据，耗时较大。<br>1、是因为缺页中断才会去加载某块数据到内存。<br>2、我现在想着先遍历所有数据，做一个内存预热，但是效果不明显<br>有没有好的调优策略推荐？","like_count":0},{"had_liked":false,"id":300132,"user_name":"Geek_a55bf0","can_delete":false,"product_type":"c1","uid":1463944,"ip_address":"","ucode":"96FCD7B9120CA6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Nv7iaxevWVukvxaZf6TjbcNicgatCUpUcp7hTah0JQxvr7ZjMlLbopEaveichKRLQJjKXR6geB5LBntf7XCP8F4kQ/132","comment_is_top":false,"comment_ctime":1625018403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625018403","product_id":100020901,"comment_content":"剩余内存落在页最小阈值和页低阈值中间，说明内存压力比较大，剩余内存不多了。这时 kswapd0 会执行内存回收，直到剩余内存大于高阈值为止。---老师，请问，如果尝试回收后还是无法高于页高阀值，会一直尝试回收吗","like_count":0},{"had_liked":false,"id":300077,"user_name":"Geek_a55bf0","can_delete":false,"product_type":"c1","uid":1463944,"ip_address":"","ucode":"96FCD7B9120CA6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Nv7iaxevWVukvxaZf6TjbcNicgatCUpUcp7hTah0JQxvr7ZjMlLbopEaveichKRLQJjKXR6geB5LBntf7XCP8F4kQ/132","comment_is_top":false,"comment_ctime":1624976610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624976610","product_id":100020901,"comment_content":"除了缓存和缓冲区，通过内存映射获取的文件映射页，也是一种常见的文件页。它也可以被释放掉，下次再访问的时候，从文件重新读取。---老师，请问这里的文件映射页是指虚拟内存中的文件映射段吗","like_count":0},{"had_liked":false,"id":292736,"user_name":"Geek_c9e1e5","can_delete":false,"product_type":"c1","uid":1934912,"ip_address":"","ucode":"4FA7D1C49C146E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLBc6LY3bAVloErjde3JsWfYaWHujP2FzCbNoOCdQQQUibqT7a2L321kzqDyzKN500oFQSyVJgUBAJA/132","comment_is_top":false,"comment_ctime":1620956501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620956501","product_id":100020901,"comment_content":"buffer和cache占用的空间比较大，free比较小，正常吗？有没有必要定期刷cache呢？","like_count":0},{"had_liked":false,"id":246565,"user_name":"蓝魔丶","can_delete":false,"product_type":"c1","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1599405053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599405053","product_id":100020901,"comment_content":"老师，linux既然默认&#47;proc&#47;sys&#47;vm&#47;zone_reclaim_mode为0，表示可以从其他Node获取空闲内存，但是为什么还会导致swap的发生？难道是因为会先换出本地内存？","like_count":0},{"had_liked":false,"id":236997,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1595646702,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1595646702","product_id":100020901,"comment_content":"“pages 处的 min、low、high，就是上面提到的三个内存阈值，而 free 是剩余内存页数，它跟后面的 nr_free_pages 相同。”<br><br>这句话，看的有点儿懵，free指的页数，那么min，low，high的指的页数？还是字节数呢？","like_count":0,"discussions":[{"author":{"id":1186981,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1c/a5/226ce8a7.jpg","nickname":"Noir","note":"","ucode":"985D4C4A5E1E85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333625,"discussion_content":"pages 处的 min、low、high：是指 page 的数量，乘上 4k 才能换算为内存大小。\n命令：free，cat /proc/zoneinfo，两者的结果是一致的，可以试着去算一下","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607581655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1238051,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e4/23/ac13d916.jpg","nickname":"圆哥哥呐丶","note":"","ucode":"8E56E3E68A3836","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1186981,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1c/a5/226ce8a7.jpg","nickname":"Noir","note":"","ucode":"985D4C4A5E1E85","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548254,"discussion_content":"牛啊，老哥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643100983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333625,"ip_address":""},"score":548254,"extra":""}]},{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325284,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605262312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236989,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1595644210,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1595644210","product_id":100020901,"comment_content":"[root@localhost home]# cat &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes<br>67584<br>而如下文件中3个zone都有一个min，上面的min（66MB）与下面3个min的有何联系和区别呢？<br>[root@localhost home]# cat &#47;proc&#47;zoneinfo<br>Node 0, zone      DMA<br>  pages free     3974<br>        min      22<br>        low      27<br>        high     33<br>Node 0, zone    DMA32<br>  pages free     622900<br>        min      4677<br>        low      5846<br>        high     7015<br>Node 0, zone   Normal<br>  pages free     1650818<br>        min      12196<br>        low      15245<br>        high     18294","like_count":0,"discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337579,"discussion_content":"3个min加起来乘以4k","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608981201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230916,"user_name":"掐死你的温柔","can_delete":false,"product_type":"c1","uid":1650044,"ip_address":"","ucode":"6053DAC0740755","user_header":"https://static001.geekbang.org/account/avatar/00/19/2d/7c/84f53e33.jpg","comment_is_top":false,"comment_ctime":1593522370,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593522370","product_id":100020901,"comment_content":"numactl修改numa内存使用策略与zone_reclaim_mode参数设置的内存使用策略关系是什么样的？","like_count":0},{"had_liked":false,"id":211481,"user_name":"涉蓝","can_delete":false,"product_type":"c1","uid":1134619,"ip_address":"","ucode":"C1321E29E01625","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLh8ubWQtDRa6exJtloSwibLliaejpF7434ficyggzukmXE63UlSPvbykoiaVDZo4CbDIIOQsCkicibyn9A/132","comment_is_top":false,"comment_ctime":1587971179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587971179","product_id":100020901,"comment_content":"看了下生产环境的机器 我们swap 完全没开。。。没有碰到这种问题 - - ","like_count":0},{"had_liked":false,"id":200160,"user_name":"斑马Z","can_delete":false,"product_type":"c1","uid":1500262,"ip_address":"","ucode":"ABB55B4652452F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0K9AM6xxDzVV6pF66jyus5NuuxZzT9icad8AQDMKibwUOy3UnoZIZdyKIKd9sA06rgFnIWwiakSeOQ/132","comment_is_top":false,"comment_ctime":1585551712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585551712","product_id":100020901,"comment_content":"<br>在内存实验中centos系统遇到的工具及环境问题：<br>\t* <br>安装 bcc-tools<br><br><br>https:&#47;&#47;blog.csdn.net&#47;zhanglong_4444&#47;article&#47;details&#47;90769075<br>\t* <br>安装go<br><br><br>官网 https:&#47;&#47;golang.org&#47;dl&#47;<br>不建议课程中的go的环境变量设置，可参考官网。<br><br>tar -C &#47;usr&#47;local -xzf go1.14.1.linux-amd64.tar.gz<br>export PATH=$PATH:&#47;usr&#47;local&#47;go&#47;bin<br><br><br>go get golang.org&#47;x&#47;sys&#47;unix   这一步会报错，“unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot;…………” <br><br><br>解决方法github上有， https:&#47;&#47;github.com&#47;spf13&#47;viper&#47;issues&#47;432，<br>mkdir -p $GOPATH&#47;src&#47;golang.org&#47;x&#47;<br>cd !$<br>git clone https:&#47;&#47;github.com&#47;golang&#47;sys.git<br>git clone https:&#47;&#47;github.com&#47;golang&#47;text.git<br><br>完成以上四步，再执行<br>go get golang.org&#47;x&#47;sys&#47;unix<br>go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br><br>记得一定要souce &#47;etc&#47;profile  !!!<br><br><br>\t* <br>run镜像<br><br><br><br>文中的镜像在本机上run不起来，结合之前的经验应该还是磁盘命名的问题，故命令如下<br>docker run --privileged --name=app -itd feisky&#47;app:io-direct &#47;app -d &#47;dev&#47;vda1 -s 33554432<br>一定要加上后面-d 的参数才可以。<br><br>\t* <br>memleak 和 pcstat命令都需要以上全部完成才能执行。<br><br>","like_count":0},{"had_liked":false,"id":198580,"user_name":"怀揣梦想的学渣","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1585457792,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585457792","product_id":100020901,"comment_content":"翻了一下评论，感觉受益匪浅","like_count":0},{"had_liked":false,"id":193741,"user_name":"羁绊","can_delete":false,"product_type":"c1","uid":1529393,"ip_address":"","ucode":"68CA15169C9DBF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er1RdQnOhMLv7dAwpBLAoUOM8icEnH8b1oSZ0cSYoryM6ng5cHcnsRRhYRny8NlrjuaQuOWy4e9Yqw/132","comment_is_top":false,"comment_ctime":1584956898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584956898","product_id":100020901,"comment_content":"文件页的回收比较容易理解，直接清空，或者把脏数据写回磁盘后再释放。<br>而对匿名页的回收，需要通过 Swap 换出到磁盘中，下次访问时，再从磁盘换入到内存中。<br><br>请教下，上面说swap用来回收内存，但是文件页回收直接清空就可以，所以准确的说swap只可以回收匿名页是吗？","like_count":0},{"had_liked":false,"id":192615,"user_name":"201200986","can_delete":false,"product_type":"c1","uid":1900861,"ip_address":"","ucode":"6042C42D1C904E","user_header":"","comment_is_top":false,"comment_ctime":1584864163,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584864163","product_id":100020901,"comment_content":"swap机制必须依赖swap分区吗？如果没有设置swap分区，这个机制还会起作用吗？","like_count":0,"discussions":[{"author":{"id":2831425,"avatar":"","nickname":"Geek_a03aa5","note":"","ucode":"700D44BF7AC3D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410188,"discussion_content":"除了 swap 分区之外，还可以设置 swap 文件，道理是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635608838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189342,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1584502150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584502150","product_id":100020901,"comment_content":"D9 打卡","like_count":0},{"had_liked":false,"id":179818,"user_name":"Carey","can_delete":false,"product_type":"c1","uid":1295041,"ip_address":"","ucode":"D31D1ECFAE0027","user_header":"https://static001.geekbang.org/account/avatar/00/13/c2/c1/48785057.jpg","comment_is_top":false,"comment_ctime":1582104327,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582104327","product_id":100020901,"comment_content":"&#47;proc&#47;zoneinfo 的三个阈值单位也是页数吗？<br>我看页最小阈值：<br>cat &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes<br>67584<br>除以4得页数：16896<br><br>而 cat &#47;proc&#47;zoneinfo得到：<br>Node 0, zone   Normal<br>  pages free     4985<br>        min      3996<br>        low      4995<br>        high     5994<br>....<br>      nr_free_pages 4985<br>      nr_zone_inactive_anon 24155<br>      nr_zone_active_anon 27474<br>      nr_zone_inactive_file 16040<br>      nr_zone_active_file 83084<br>其中min是3996<br>这里的数字怎么关联的呢？","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363333,"discussion_content":"grep min /proc/zoneinfo，把得到三个值相加再算下。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617172051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173000,"user_name":"。。。","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1579404933,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579404933","product_id":100020901,"comment_content":"每一篇都有很大的收获","like_count":0},{"had_liked":false,"id":166751,"user_name":"Don Wang","can_delete":false,"product_type":"c1","uid":1319529,"ip_address":"","ucode":"1853365FA279F2","user_header":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","comment_is_top":false,"comment_ctime":1577587471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577587471","product_id":100020901,"comment_content":"我们可以看到，一旦剩余内存小于页低阈值，就会触发内存的回收。这个页低阈值，其实可以通过内核选项 &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes 来间接设置。min_free_kbytes 设置了页最小阈值，而其他两个阈值，都是根据页最小阈值计算生成的。<br><br><br><br><br>请问此处，间接设置的是 页最低阈值？还是 页低阈值？","like_count":0},{"had_liked":false,"id":157182,"user_name":"ouyangsheng","can_delete":false,"product_type":"c1","uid":1000623,"ip_address":"","ucode":"4D16DA1493453B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/af/79cb724c.jpg","comment_is_top":false,"comment_ctime":1575074981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575074981","product_id":100020901,"comment_content":"内存回收包括：1文件页面既cache buffer直接清除或是脏页回写再清除；2匿名页面既malloc分配的可以通过swap换到硬盘。<br><br>回收的阈值可以在sys中调整watermark","like_count":0},{"had_liked":false,"id":154889,"user_name":"weilai","can_delete":false,"product_type":"c1","uid":1134329,"ip_address":"","ucode":"716945DDC77CEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/f9/b12388bd.jpg","comment_is_top":false,"comment_ctime":1574591259,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1574591259","product_id":100020901,"comment_content":"从这里入门去看了下内核的书，发现，这个专栏其实就是在讲内核的原理在性能调优实战中的运用。非常好，之前直接看内核原理书籍头皮发麻，现在可以看懂了！感谢大佬！！！","like_count":0},{"had_liked":false,"id":152638,"user_name":"Hongyue","can_delete":false,"product_type":"c1","uid":1348577,"ip_address":"","ucode":"33B6B9D59B0690","user_header":"https://static001.geekbang.org/account/avatar/00/14/93/e1/488c17d9.jpg","comment_is_top":false,"comment_ctime":1574054885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574054885","product_id":100020901,"comment_content":"对我帮助很大，赞<br><br>我之前从事手机和移动终端设备开发，很多设备是低内存的，这种都会启用swap，但是这块如果使用不好就会出现kswapd占用cpu特别高的情况，有时候还要结合android lmk一块配置，作者提到的我之前也配置过，只可惜只知其一不知其二，今天算是系统学习下","like_count":0},{"had_liked":false,"id":148149,"user_name":"耿长学","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1572950105,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572950105","product_id":100020901,"comment_content":"老师，cat &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes的值和&#47;proc&#47;zoneinfo里面的pages_min的值为啥不一样呢","like_count":0,"discussions":[{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293702,"discussion_content":"下面的评论，老师有解释，这两个值没有直接关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595645882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137065,"user_name":"von","can_delete":false,"product_type":"c1","uid":1248289,"ip_address":"","ucode":"82C827800D3C23","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/21/c166f3cc.jpg","comment_is_top":false,"comment_ctime":1569588576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569588576","product_id":100020901,"comment_content":"老师，物理内存还有一半，swap却用了40%，这时候发现nr_zone_active_anon 和 nr_zone_inactive_anon，<br>nr_zone_active_file 和 nr_zone_inactive_file全部为0，这种情况是不是不正常","like_count":0},{"had_liked":false,"id":121917,"user_name":"Void_seT","can_delete":false,"product_type":"c1","uid":1070863,"ip_address":"","ucode":"DD55CB0198A5CD","user_header":"https://static001.geekbang.org/account/avatar/00/10/57/0f/1f229bf5.jpg","comment_is_top":false,"comment_ctime":1565248970,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565248970","product_id":100020901,"comment_content":"请问本文中的缓存和缓冲区是指Cache和Buffer吧？","like_count":0},{"had_liked":false,"id":121868,"user_name":"afterdream","can_delete":false,"product_type":"c1","uid":1619795,"ip_address":"","ucode":"701AD039459191","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/53/823f647c.jpg","comment_is_top":false,"comment_ctime":1565236810,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565236810","product_id":100020901,"comment_content":"内存回收方式=直接回收 + swap回收<br>&#47;proc&#47;sys&#47;vm&#47;zone_reclaim_mode决定回收方式<br>如果同时支持直接回收和swap回收，通过&#47;proc&#47;sys&#47;vm&#47;swappiness决定先回收哪个<br><br>另外还得 cat &#47;proc&#47;zoneinfo，按node分别讨论<br>","like_count":0},{"had_liked":false,"id":114494,"user_name":"徳柏","can_delete":false,"product_type":"c1","uid":1178979,"ip_address":"","ucode":"D56F175408766D","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/63/c482d271.jpg","comment_is_top":false,"comment_ctime":1563324991,"is_pvip":false,"replies":[{"id":"41969","content":"嗯嗯，谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563455266,"ip_address":"","comment_id":114494,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563324991","product_id":100020901,"comment_content":"嵌入式系统一般都启用了zram技术，小内存swap还是要开启的，很有好处，跟swap到磁盘不是一个事","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458687,"discussion_content":"嗯嗯，谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563455266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111047,"user_name":"外星人","can_delete":false,"product_type":"c1","uid":1132861,"ip_address":"","ucode":"D8469B13F2AB37","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg","comment_is_top":false,"comment_ctime":1562431139,"is_pvip":false,"replies":[{"id":"40436","content":"请参考第20篇，这个问题正好是20篇的思考题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562509465,"ip_address":"","comment_id":111047,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562431139","product_id":100020901,"comment_content":"https:&#47;&#47;community.hortonworks.com&#47;questions&#47;71095&#47;why-not-set-swappiness-to-zero.html<br><br>这里哈，不过不确定是不是真的完全不会swap","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457197,"discussion_content":"请参考第20篇，这个问题正好是20篇的思考题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562509465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96111,"user_name":"Geek_6d9216","can_delete":false,"product_type":"c1","uid":1467029,"ip_address":"","ucode":"8EE44CE7A39F07","user_header":"","comment_is_top":false,"comment_ctime":1558334258,"is_pvip":false,"replies":[{"id":"34564","content":"看看是不是还有其他的Node和zone？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558448001,"ip_address":"","comment_id":96111,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558334258","product_id":100020901,"comment_content":"为什么 <br>cat &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes <br>67584<br><br>而  cat &#47;proc&#47;zoneinfo<br>  pages free     33069<br>        min      8004<br>        low      10005<br>        high     12006<br>安照 文章说的 page_low = min_free_kbytes * 5&#47;4 , page_high = min_free_kbytes * 3&#47;2, 这个low和high 也不是正确的数据啊, 怎么理解这个 min_free_kbytes ?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450723,"discussion_content":"看看是不是还有其他的Node和zone？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558448001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90337,"user_name":"外星人","can_delete":false,"product_type":"c1","uid":1132861,"ip_address":"","ucode":"D8469B13F2AB37","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg","comment_is_top":false,"comment_ctime":1556497455,"is_pvip":false,"replies":[{"id":"32531","content":"哪个版本？我在用的内核已经很新了，但没有看到这个变化","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556634258,"ip_address":"","comment_id":90337,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556497455","product_id":100020901,"comment_content":"好像是新内核这个逻辑变了，设置成0就不会swap","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448477,"discussion_content":"哪个版本？我在用的内核已经很新了，但没有看到这个变化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556634258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79069,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1553341043,"is_pvip":false,"replies":[{"id":"29351","content":"不一定是你理解的紧张，有的时候可用内存很多也会swap。这时候关闭是为了避免swap带来的性能问题。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553699349,"ip_address":"","comment_id":79069,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553341043","product_id":100020901,"comment_content":"swap不是说在物理内存紧张不够的时候才会发生吗？<br>那么当物理内存不够的时候，使用swap会降低应用性能，但是这时候本身是内存很紧张的时候，不开岂不是有可能会导致oom呢<br>所以我还是不太明白为什么建议关掉swap","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444346,"discussion_content":"不一定是你理解的紧张，有的时候可用内存很多也会swap。这时候关闭是为了避免swap带来的性能问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553699349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76870,"user_name":"道无涯","can_delete":false,"product_type":"c1","uid":1117394,"ip_address":"","ucode":"DA1C0C4BB63DC6","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/d2/381c75f5.jpg","comment_is_top":false,"comment_ctime":1552733432,"is_pvip":false,"replies":[{"id":"28098","content":"理论上会的，不过实际上也有可能会被新的内存请求给占用去","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552833950,"ip_address":"","comment_id":76870,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552733432","product_id":100020901,"comment_content":"老师你好，请问一下如果匿名页被swap到内存后。free查看到的used内存会减少么？还是也会算到已经使用的内存里，谢谢！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443481,"discussion_content":"理论上会的，不过实际上也有可能会被新的内存请求给占用去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552833950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64600,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1548833053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548833053","product_id":100020901,"comment_content":"DAY19.打卡","like_count":0},{"had_liked":false,"id":63576,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1548404531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548404531","product_id":100020901,"comment_content":"老师您好：<br>系统在内存资源紧张时会释放  文件页和匿名页。<br>对于页的类型有一个疑惑：<br>文件页是IO时候内存中存储的页，称之为文件页。（文件页肯定在内核空间中）<br>匿名页是应用程序需要的堆内存，称之为匿名页。（匿名页肯定在用户空间中）<br>想请问老师，linux系统中除了这两种页，还有什么其他类型的页呢？","like_count":0},{"had_liked":false,"id":58417,"user_name":"刘榴","can_delete":false,"product_type":"c1","uid":1063491,"ip_address":"","ucode":"08C51E3CE77889","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/43/6abf3b7d.jpg","comment_is_top":false,"comment_ctime":1547079216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547079216","product_id":100020901,"comment_content":"涨知识了","like_count":0},{"had_liked":false,"id":58151,"user_name":"生活在别处","can_delete":false,"product_type":"c1","uid":1096441,"ip_address":"","ucode":"E7F60026F2737A","user_header":"https://static001.geekbang.org/account/avatar/00/10/ba/f9/351e4fc0.jpg","comment_is_top":false,"comment_ctime":1547003482,"is_pvip":false,"replies":[{"id":"20983","content":"Node外内存？使用了NUMA，内存会按照NUMA Node 访问","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547027346,"ip_address":"","comment_id":58151,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547003482","product_id":100020901,"comment_content":"请问分配给所有node的内存之外的内存,cpu是怎么访问的？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435931,"discussion_content":"Node外内存？使用了NUMA，内存会按照NUMA Node 访问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547027346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57870,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1546932820,"is_pvip":false,"replies":[{"id":"20997","content":"这两个值没有直接关系，仔细看文章中的几个指标关系","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547028567,"ip_address":"","comment_id":57870,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1546932820","product_id":100020901,"comment_content":"cat &#47;proc&#47;sys&#47;vm&#47;min_free_kbytes <br>67584<br>Node 0, zone    DMA32<br>  pages free     656605<br>        min      12775<br>这两个值对不上啊","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435802,"discussion_content":"这两个值没有直接关系，仔细看文章中的几个指标关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547028567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293701,"discussion_content":"那刚刚我的提问，可以忽略了，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595645762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57615,"user_name":"朱林浩","can_delete":false,"product_type":"c1","uid":1126872,"ip_address":"","ucode":"3686433FCF6FEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/d8/18a2de6d.jpg","comment_is_top":false,"comment_ctime":1546851445,"is_pvip":false,"replies":[{"id":"20762","content":"我查到的是0，可能是系统版本不一样。你的系统什么版本","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546853711,"ip_address":"","comment_id":57615,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546851445","product_id":100020901,"comment_content":"zone_reclaim_mode默认值不应该是1吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435667,"discussion_content":"我查到的是0，可能是系统版本不一样。你的系统什么版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546853711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57018,"user_name":"李炀","can_delete":false,"product_type":"c1","uid":1030246,"ip_address":"","ucode":"28F464EA58BCC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/66/5fd18e55.jpg","comment_is_top":false,"comment_ctime":1546602484,"is_pvip":false,"replies":[{"id":"20576","content":"还真是，我们来看看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546612548,"ip_address":"","comment_id":57018,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546602484","product_id":100020901,"comment_content":"文章里的两张图片，上午看的时候还有，下午就看不到了，不管是手机上连接移动网络看，还是电脑上连接WIFI，都看不到。请老师确认一下。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435362,"discussion_content":"还真是，我们来看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546612548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56674,"user_name":"渡渡鸟_linux","can_delete":false,"product_type":"c1","uid":1227772,"ip_address":"","ucode":"099BB11A3201D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132","comment_is_top":false,"comment_ctime":1546520918,"is_pvip":false,"replies":[{"id":"21147","content":"min_free_kbytes 设置了页最小阈值，但跟正在使用了多少内存没有关系，它只是代表什么时候开始回收内存","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547123855,"ip_address":"","comment_id":56674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546520918","product_id":100020901,"comment_content":"# cat &#47;proc&#47;zoneinfo 中的值和free -m ，vm.min_free_kbytes 值怎么算都对不上，这是为啥？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435177,"discussion_content":"min_free_kbytes 设置了页最小阈值，但跟正在使用了多少内存没有关系，它只是代表什么时候开始回收内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56490,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1546477147,"is_pvip":false,"replies":[{"id":"21140","content":"会的，不过Swap的目的就是缓解物理内存不足的问题，虽然性能变差了，但还是继续运行着而不是直接OOM了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547123065,"ip_address":"","comment_id":56490,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546477147","product_id":100020901,"comment_content":"当物理内存不足时，swap的值会升高吧，此时系统性能会受到很大影响吧，如响应时间，系统变慢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435068,"discussion_content":"会的，不过Swap的目的就是缓解物理内存不足的问题，虽然性能变差了，但还是继续运行着而不是直接OOM了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547123065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56432,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1546442093,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546442093","product_id":100020901,"comment_content":"终于找到办法禁用mac上的swap了","like_count":0},{"had_liked":false,"id":56325,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1546421837,"is_pvip":false,"replies":[{"id":"20334","content":"有好处，避免了很多swap导致的性能问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546445171,"ip_address":"","comment_id":56325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546421837","product_id":100020901,"comment_content":"老师好，现在买的 云主机都不分配swap 空间，这样是有好处呢，还是想多卖内存？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434987,"discussion_content":"有好处，避免了很多swap导致的性能问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546445171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56309,"user_name":"唯美","can_delete":false,"product_type":"c1","uid":1263430,"ip_address":"","ucode":"9186A5B99DFBCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/46/61f16147.jpg","comment_is_top":false,"comment_ctime":1546419437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546419437","product_id":100020901,"comment_content":"打卡Day19","like_count":0},{"had_liked":false,"id":56300,"user_name":"淸曉","can_delete":false,"product_type":"c1","uid":1332899,"ip_address":"","ucode":"6E63DA4E29FE09","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/a3/649d861c.jpg","comment_is_top":false,"comment_ctime":1546418018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546418018","product_id":100020901,"comment_content":"老师对于下面二者：<br>文件页的回收：直接清空，或者把脏数据写回磁盘后再释放。<br>匿名页的回收：需要通过 Swap 换出到磁盘中。<br>该怎么去操作？","like_count":0},{"had_liked":false,"id":56214,"user_name":"Christmas","can_delete":false,"product_type":"c1","uid":1219172,"ip_address":"","ucode":"F48F6BE4A7595B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/64/ad837224.jpg","comment_is_top":false,"comment_ctime":1546405271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546405271","product_id":100020901,"comment_content":"我很困惑，什么情况下会发生oom? 回收cache和Swap之后也没有释放足够的空间的时候吗？","like_count":0},{"had_liked":false,"id":56182,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1546400717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546400717","product_id":100020901,"comment_content":"刚好有个线上环境，内存还有，到swap开始占用了","like_count":0},{"had_liked":false,"id":56139,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1546396680,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546396680","product_id":100020901,"comment_content":"匿名页有什么作用呢？系统内存回收的时候是随机杀掉一些进程，还是寻找特定的进程杀掉？","like_count":0}]}