{"id":39844,"title":"17 | goè¯­å¥åŠå…¶æ‰§è¡Œè§„åˆ™ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒæ—ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­åˆ†äº«goè¯­å¥æ‰§è¡Œè§„åˆ™çš„å†…å®¹ã€‚</p>\n<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†goroutineåœ¨æ“ä½œç³»ç»Ÿçš„å¹¶å‘ç¼–ç¨‹ä½“ç³»ï¼Œä»¥åŠåœ¨Goè¯­è¨€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­çš„åœ°ä½å’Œä½œç”¨ç­‰ä¸€ç³»åˆ—å†…å®¹ï¼Œä»Šå¤©æˆ‘ä»¬ç»§ç»­æ¥èŠä¸€èŠè¿™ä¸ªè¯é¢˜ã€‚</p>\n<h2>çŸ¥è¯†æ‰©å±•</h2>\n<p><strong>é—®é¢˜1ï¼šæ€æ ·æ‰èƒ½è®©ä¸»goroutineç­‰å¾…å…¶ä»–goroutineï¼Ÿ</strong></p>\n<p>æˆ‘åˆšæ‰è¯´è¿‡ï¼Œä¸€æ—¦ä¸»goroutineä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå½“å‰çš„Goç¨‹åºå°±ä¼šç»“æŸè¿è¡Œï¼Œæ— è®ºå…¶ä»–çš„goroutineæ˜¯å¦å·²ç»åœ¨è¿è¡Œäº†ã€‚é‚£ä¹ˆï¼Œæ€æ ·æ‰èƒ½åšåˆ°ç­‰å…¶ä»–çš„goroutineè¿è¡Œå®Œæ¯•ä¹‹åï¼Œå†è®©ä¸»goroutineç»“æŸè¿è¡Œå‘¢ï¼Ÿ</p>\n<p>å…¶å®æœ‰å¾ˆå¤šåŠæ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å…¶ä¸­ï¼Œæœ€ç®€å•ç²—æš´çš„åŠæ³•å°±æ˜¯è®©ä¸»goroutineâ€œå°ç¡â€ä¸€ä¼šå„¿ã€‚</p>\n<pre><code>for i := 0; i &lt; 10; i++ {\n\tgo func() {\n\t\tfmt.Println(i)\n\t}()\n}\ntime.Sleep(time.Millisecond * 500)\n</code></pre>\n<p>åœ¨<code>for</code>è¯­å¥çš„åè¾¹ï¼Œæˆ‘è°ƒç”¨äº†<code>time</code>åŒ…çš„<code>Sleep</code>å‡½æ•°ï¼Œå¹¶æŠŠ<code>time.Millisecond * 500</code>çš„ç»“æœä½œä¸ºå‚æ•°å€¼ä¼ ç»™äº†å®ƒã€‚<code>time.Sleep</code>å‡½æ•°çš„åŠŸèƒ½å°±æ˜¯è®©å½“å‰çš„goroutineï¼ˆåœ¨è¿™é‡Œå°±æ˜¯ä¸»goroutineï¼‰æš‚åœè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°åˆ°è¾¾æŒ‡å®šçš„æ¢å¤è¿è¡Œæ—¶é—´ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªç›¸å¯¹çš„æ—¶é—´ä¼ ç»™è¯¥å‡½æ•°ï¼Œå°±åƒæˆ‘åœ¨è¿™é‡Œä¼ å…¥çš„â€œ500æ¯«ç§’â€é‚£æ ·ã€‚<code>time.Sleep</code>å‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨æ—¶ç”¨å½“å‰çš„ç»å¯¹æ—¶é—´ï¼Œå†åŠ ä¸Šç›¸å¯¹æ—¶é—´è®¡ç®—å‡ºåœ¨æœªæ¥çš„æ¢å¤è¿è¡Œæ—¶é—´ã€‚æ˜¾ç„¶ï¼Œä¸€æ—¦åˆ°è¾¾æ¢å¤è¿è¡Œæ—¶é—´ï¼Œå½“å‰çš„goroutineå°±ä¼šä»â€œç¡çœ â€ä¸­é†’æ¥ï¼Œå¹¶å¼€å§‹ç»§ç»­æ‰§è¡Œåè¾¹çš„ä»£ç ã€‚</p><!-- [[[read_end]]] -->\n<p>è¿™ä¸ªåŠæ³•æ˜¯å¯è¡Œçš„ï¼Œåªè¦â€œç¡çœ â€çš„æ—¶é—´ä¸è¦å¤ªçŸ­å°±å¥½ã€‚ä¸è¿‡ï¼Œé—®é¢˜æ°æ°å°±åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®©ä¸»goroutineâ€œç¡çœ â€å¤šé•¿æ—¶é—´æ‰æ˜¯åˆé€‚çš„å‘¢ï¼Ÿå¦‚æœâ€œç¡çœ â€å¤ªçŸ­ï¼Œåˆ™å¾ˆå¯èƒ½ä¸è¶³ä»¥è®©å…¶ä»–çš„goroutineè¿è¡Œå®Œæ¯•ï¼Œè€Œè‹¥â€œç¡çœ â€å¤ªé•¿åˆ™çº¯å±æµªè´¹æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å°±å¤ªéš¾æŠŠæ¡äº†ã€‚</p>\n<p>ä½ å¯èƒ½ä¼šæƒ³åˆ°ï¼Œæ—¢ç„¶ä¸å®¹æ˜“é¢„ä¼°æ—¶é—´ï¼Œé‚£æˆ‘ä»¬å°±è®©å…¶ä»–çš„goroutineåœ¨è¿è¡Œå®Œæ¯•çš„æ—¶å€™å‘Šè¯‰æˆ‘ä»¬å¥½äº†ã€‚è¿™ä¸ªæ€è·¯å¾ˆå¥½ï¼Œä½†æ€ä¹ˆåšå‘¢ï¼Ÿ</p>\n<p>ä½ æ˜¯å¦æƒ³åˆ°äº†é€šé“å‘¢ï¼Ÿæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå®ƒçš„é•¿åº¦åº”è¯¥ä¸æˆ‘ä»¬æ‰‹åŠ¨å¯ç”¨çš„goroutineçš„æ•°é‡ä¸€è‡´ã€‚åœ¨æ¯ä¸ªæ‰‹åŠ¨å¯ç”¨çš„goroutineå³å°†è¿è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦å‘è¯¥é€šé“å‘é€ä¸€ä¸ªå€¼ã€‚</p>\n<p>æ³¨æ„ï¼Œè¿™äº›å‘é€è¡¨è¾¾å¼åº”è¯¥è¢«æ”¾åœ¨å®ƒä»¬çš„<code>go</code>å‡½æ•°ä½“çš„æœ€åé¢ã€‚å¯¹åº”çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>main</code>å‡½æ•°çš„æœ€åä»é€šé“æ¥æ”¶å…ƒç´ å€¼ï¼Œæ¥æ”¶çš„æ¬¡æ•°ä¹Ÿåº”è¯¥ä¸æ‰‹åŠ¨å¯ç”¨çš„goroutineçš„æ•°é‡ä¿æŒä¸€è‡´ã€‚å…³äºè¿™äº›ä½ å¯ä»¥åˆ°demo39.goæ–‡ä»¶ä¸­ï¼Œå»æŸ¥çœ‹å…·ä½“çš„å†™æ³•ã€‚</p>\n<p>å…¶ä¸­æœ‰ä¸€ä¸ªç»†èŠ‚ä½ éœ€è¦æ³¨æ„ã€‚æˆ‘åœ¨å£°æ˜é€šé“<code>sign</code>çš„æ—¶å€™æ˜¯ä»¥<code>chan struct{}</code>ä½œä¸ºå…¶ç±»å‹çš„ã€‚å…¶ä¸­çš„ç±»å‹å­—é¢é‡<code>struct{}</code>æœ‰äº›ç±»ä¼¼äºç©ºæ¥å£ç±»å‹<code>interface{}</code>ï¼Œå®ƒä»£è¡¨äº†æ—¢ä¸åŒ…å«ä»»ä½•å­—æ®µä¹Ÿä¸æ‹¥æœ‰ä»»ä½•æ–¹æ³•çš„ç©ºç»“æ„ä½“ç±»å‹ã€‚</p>\n<p>æ³¨æ„ï¼Œ<code>struct{}</code>ç±»å‹å€¼çš„è¡¨ç¤ºæ³•åªæœ‰ä¸€ä¸ªï¼Œå³ï¼š<code>struct{}{}</code>ã€‚å¹¶ä¸”ï¼Œå®ƒå ç”¨çš„å†…å­˜ç©ºé—´æ˜¯<code>0</code>å­—èŠ‚ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œè¿™ä¸ªå€¼åœ¨æ•´ä¸ªGoç¨‹åºä¸­æ°¸è¿œéƒ½åªä¼šå­˜åœ¨ä¸€ä»½ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥æ— æ•°æ¬¡åœ°ä½¿ç”¨è¿™ä¸ªå€¼å­—é¢é‡ï¼Œä½†æ˜¯ç”¨åˆ°çš„å´éƒ½æ˜¯åŒä¸€ä¸ªå€¼ã€‚</p>\n<p>å½“æˆ‘ä»¬ä»…ä»…æŠŠé€šé“å½“ä½œä¼ é€’æŸç§ç®€å•ä¿¡å·çš„ä»‹è´¨çš„æ—¶å€™ï¼Œç”¨<code>struct{}</code>ä½œä¸ºå…¶å…ƒç´ ç±»å‹æ˜¯å†å¥½ä¸è¿‡çš„äº†ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘åœ¨è®²â€œç»“æ„ä½“åŠå…¶æ–¹æ³•çš„ä½¿ç”¨æ³•é—¨â€çš„æ—¶å€™ç•™è¿‡ä¸€é“ä¸æ­¤ç›¸å…³çš„æ€è€ƒé¢˜ï¼Œä½ å¯ä»¥è¿”å›å»çœ‹ä¸€çœ‹ã€‚</p>\n<p>å†è¯´å›å½“ä¸‹çš„é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ¯”ä½¿ç”¨é€šé“æ›´å¥½çš„æ–¹æ³•ï¼Ÿå¦‚æœä½ çŸ¥é“æ ‡å‡†åº“ä¸­çš„ä»£ç åŒ…<code>sync</code>çš„è¯ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæƒ³åˆ°<code>sync.WaitGroup</code>ç±»å‹ã€‚æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´å¥½çš„ç­”æ¡ˆã€‚ä¸è¿‡å…·ä½“çš„ä½¿ç”¨æ–¹å¼æˆ‘åœ¨åè¾¹è®²<code>sync</code>åŒ…çš„æ—¶å€™å†è¯´ã€‚</p>\n<p><strong>é—®é¢˜2ï¼šæ€æ ·è®©æˆ‘ä»¬å¯ç”¨çš„å¤šä¸ªgoroutineæŒ‰ç…§æ—¢å®šçš„é¡ºåºè¿è¡Œï¼Ÿ</strong></p>\n<p>åœ¨å¾ˆå¤šæ—¶å€™ï¼Œå½“æˆ‘æ²¿ç€ä¸Šé¢çš„ä¸»é—®é¢˜ä»¥åŠç¬¬ä¸€ä¸ªæ‰©å±•é—®é¢˜ä¸€è·¯é—®ä¸‹æ¥çš„æ—¶å€™ï¼Œåº”è˜è€…å¾€å¾€ä¼šè¢«è¿™ç¬¬äºŒä¸ªæ‰©å±•é—®é¢˜éš¾ä½ã€‚</p>\n<p>æ‰€ä»¥åŸºäºä¸Šä¸€ç¯‡ä¸»é—®é¢˜ä¸­çš„ä»£ç ï¼Œæ€æ ·åšåˆ°è®©ä»<code>0</code>åˆ°<code>9</code>è¿™å‡ ä¸ªæ•´æ•°æŒ‰ç…§è‡ªç„¶æ•°çš„é¡ºåºæ‰“å°å‡ºæ¥ï¼Ÿä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘ä¸ç”¨goroutineä¸å°±å¯ä»¥äº†å˜›ã€‚æ²¡é”™ï¼Œè¿™æ ·æ˜¯å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä¸è€ƒè™‘è¿™æ ·åšå‘¢ã€‚ä½ åº”è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>\n<p>å½“ç„¶äº†ï¼Œä¼—å¤šåº”è˜è€…å›ç­”çš„å…¶ä»–ç­”æ¡ˆä¹Ÿæ˜¯äº”èŠ±å…«é—¨çš„ï¼Œæœ‰çš„å¯è¡Œï¼Œæœ‰çš„ä¸å¯è¡Œï¼Œè¿˜æœ‰çš„æŠŠåŸæ¥çš„ä»£ç æ”¹å¾—é¢ç›®å…¨éã€‚æˆ‘ä¸‹é¢å°±æ¥è¯´è¯´æˆ‘çš„æ€è·¯ï¼Œä»¥åŠå¿ƒç›®ä¸­çš„ç­”æ¡ˆå§ã€‚è¿™ä¸ªç­”æ¡ˆå¹¶ä¸ä¸€å®šæ˜¯æœ€ä½³çš„ï¼Œä¹Ÿè®¸ä½ åœ¨çœ‹å®Œä¹‹åè¿˜å¯ä»¥æƒ³åˆ°æ›´ä¼˜çš„ç­”æ¡ˆã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®æ”¹é€ ä¸€ä¸‹<code>for</code>è¯­å¥ä¸­çš„é‚£ä¸ª<code>go</code>å‡½æ•°ï¼Œè¦è®©å®ƒæ¥å—ä¸€ä¸ª<code>int</code>ç±»å‹çš„å‚æ•°ï¼Œå¹¶åœ¨è°ƒç”¨å®ƒçš„æ—¶å€™æŠŠå˜é‡<code>i</code>çš„å€¼ä¼ è¿›å»ã€‚ä¸ºäº†ä¸æ”¹åŠ¨è¿™ä¸ª<code>go</code>å‡½æ•°ä¸­çš„å…¶ä»–ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçš„è¿™ä¸ªå‚æ•°ä¹Ÿå‘½åä¸º<code>i</code>ã€‚</p>\n<pre><code>for i := 0; i &lt; 10; i++ {\n\tgo func(i int) {\n\t\tfmt.Println(i)\n\t}(i)\n}\n</code></pre>\n<p>åªæœ‰è¿™æ ·ï¼ŒGoè¯­è¨€æ‰èƒ½ä¿è¯æ¯ä¸ªgoroutineéƒ½å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ã€‚å…¶åŸå› ä¸<code>go</code>å‡½æ•°çš„æ‰§è¡Œæ—¶æœºæœ‰å…³ã€‚</p>\n<p>æˆ‘åœ¨å‰é¢å·²ç»è®²è¿‡äº†ã€‚åœ¨<code>go</code>è¯­å¥è¢«æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼ ç»™<code>go</code>å‡½æ•°çš„å‚æ•°<code>i</code>ä¼šå…ˆè¢«æ±‚å€¼ï¼Œå¦‚æ­¤å°±å¾—åˆ°äº†å½“æ¬¡è¿­ä»£çš„åºå·ã€‚ä¹‹åï¼Œæ— è®º<code>go</code>å‡½æ•°ä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œè¿™ä¸ªå‚æ•°å€¼éƒ½ä¸ä¼šå˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>go</code>å‡½æ•°ä¸­è°ƒç”¨çš„<code>fmt.Println</code>å‡½æ•°æ‰“å°çš„ä¸€å®šä¼šæ˜¯é‚£ä¸ªå½“æ¬¡è¿­ä»£çš„åºå·ã€‚</p>\n<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ç€æ‰‹æ”¹é€ <code>for</code>è¯­å¥ä¸­çš„<code>go</code>å‡½æ•°ã€‚</p>\n<pre><code>for i := uint32(0); i &lt; 10; i++ {\n\tgo func(i uint32) {\n\t\tfn := func() {\n\t\t\tfmt.Println(i)\n\t\t}\n\t\ttrigger(i, fn)\n\t}(i)\n}\n</code></pre>\n<p>æˆ‘åœ¨<code>go</code>å‡½æ•°ä¸­å…ˆå£°æ˜äº†ä¸€ä¸ªåŒ¿åçš„å‡½æ•°ï¼Œå¹¶æŠŠå®ƒèµ‹ç»™äº†å˜é‡<code>fn</code>ã€‚è¿™ä¸ªåŒ¿åå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œåªæ˜¯è°ƒç”¨<code>fmt.Println</code>å‡½æ•°ä»¥æ‰“å°<code>go</code>å‡½æ•°çš„å‚æ•°<code>i</code>çš„å€¼ã€‚</p>\n<p>åœ¨è¿™ä¹‹åï¼Œæˆ‘è°ƒç”¨äº†ä¸€ä¸ªåå«<code>trigger</code>çš„å‡½æ•°ï¼Œå¹¶æŠŠ<code>go</code>å‡½æ•°çš„å‚æ•°<code>i</code>å’Œåˆšåˆšå£°æ˜çš„å˜é‡<code>fn</code>ä½œä¸ºå‚æ•°ä¼ ç»™äº†å®ƒã€‚æ³¨æ„ï¼Œ<code>for</code>è¯­å¥å£°æ˜çš„å±€éƒ¨å˜é‡<code>i</code>å’Œ<code>go</code>å‡½æ•°çš„å‚æ•°<code>i</code>çš„ç±»å‹éƒ½å˜äº†ï¼Œéƒ½ç”±<code>int</code>å˜ä¸ºäº†<code>uint32</code>ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸€ä¼šå„¿å†è¯´ã€‚</p>\n<p>å†æ¥è¯´<code>trigger</code>å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>uint32</code>ç±»å‹çš„å‚æ•°<code>i</code>, å¦ä¸€ä¸ªæ˜¯<code>func()</code>ç±»å‹çš„å‚æ•°<code>fn</code>ã€‚ä½ åº”è¯¥è®°å¾—ï¼Œ<code>func()</code>ä»£è¡¨çš„æ˜¯æ—¢æ— å‚æ•°å£°æ˜ä¹Ÿæ— ç»“æœå£°æ˜çš„å‡½æ•°ç±»å‹ã€‚</p>\n<pre><code>trigger := func(i uint32, fn func()) {\n\tfor {\n\t\tif n := atomic.LoadUint32(&amp;count); n == i {\n\t\t\tfn()\n\t\t\tatomic.AddUint32(&amp;count, 1)\n\t\t\tbreak\n\t\t}\n\t\ttime.Sleep(time.Nanosecond)\n\t}\n}\n</code></pre>\n<p><code>trigger</code>å‡½æ•°ä¼šä¸æ–­åœ°è·å–ä¸€ä¸ªåå«<code>count</code>çš„å˜é‡çš„å€¼ï¼Œå¹¶åˆ¤æ–­è¯¥å€¼æ˜¯å¦ä¸å‚æ•°<code>i</code>çš„å€¼ç›¸åŒã€‚å¦‚æœç›¸åŒï¼Œé‚£ä¹ˆå°±ç«‹å³è°ƒç”¨<code>fn</code>ä»£è¡¨çš„å‡½æ•°ï¼Œç„¶åæŠŠ<code>count</code>å˜é‡çš„å€¼åŠ <code>1</code>ï¼Œæœ€åæ˜¾å¼åœ°é€€å‡ºå½“å‰çš„å¾ªç¯ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°±å…ˆè®©å½“å‰çš„goroutineâ€œç¡çœ â€ä¸€ä¸ªçº³ç§’å†è¿›å…¥ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚</p>\n<p>æ³¨æ„ï¼Œæˆ‘æ“ä½œå˜é‡<code>count</code>çš„æ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯åŸå­æ“ä½œã€‚è¿™æ˜¯ç”±äº<code>trigger</code>å‡½æ•°ä¼šè¢«å¤šä¸ªgoroutineå¹¶å‘åœ°è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒç”¨åˆ°çš„éæœ¬åœ°å˜é‡<code>count</code>ï¼Œå°±è¢«å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹å…±ç”¨äº†ã€‚å› æ­¤ï¼Œå¯¹å®ƒçš„æ“ä½œå°±äº§ç”Ÿäº†ç«æ€æ¡ä»¶ï¼ˆrace conditionï¼‰ï¼Œç ´åäº†ç¨‹åºçš„å¹¶å‘å®‰å…¨æ€§ã€‚</p>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥å¯¹è¿™æ ·çš„æ“ä½œåŠ ä»¥ä¿æŠ¤ï¼Œåœ¨<code>sync/atomic</code>åŒ…ä¸­å£°æ˜äº†å¾ˆå¤šç”¨äºåŸå­æ“ä½œçš„å‡½æ•°ã€‚</p>\n<p>å¦å¤–ï¼Œç”±äºæˆ‘é€‰ç”¨çš„åŸå­æ“ä½œå‡½æ•°å¯¹è¢«æ“ä½œçš„æ•°å€¼çš„ç±»å‹æœ‰çº¦æŸï¼Œæ‰€ä»¥æˆ‘æ‰å¯¹<code>count</code>ä»¥åŠç›¸å…³çš„å˜é‡å’Œå‚æ•°çš„ç±»å‹è¿›è¡Œäº†ç»Ÿä¸€çš„å˜æ›´ï¼ˆç”±<code>int</code>å˜ä¸ºäº†<code>uint32</code>ï¼‰ã€‚</p>\n<p>çºµè§‚<code>count</code>å˜é‡ã€<code>trigger</code>å‡½æ•°ä»¥åŠæ”¹é€ åçš„<code>for</code>è¯­å¥å’Œ<code>go</code>å‡½æ•°ï¼Œæˆ‘è¦åšçš„æ˜¯ï¼Œè®©<code>count</code>å˜é‡æˆä¸ºä¸€ä¸ªä¿¡å·ï¼Œå®ƒçš„å€¼æ€»æ˜¯ä¸‹ä¸€ä¸ªå¯ä»¥è°ƒç”¨æ‰“å°å‡½æ•°çš„<code>go</code>å‡½æ•°çš„åºå·ã€‚</p>\n<p>è¿™ä¸ªåºå·å…¶å®å°±æ˜¯å¯ç”¨goroutineæ—¶ï¼Œé‚£ä¸ªå½“æ¬¡è¿­ä»£çš„åºå·ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œ<code>go</code>å‡½æ•°å®é™…çš„æ‰§è¡Œé¡ºåºæ‰ä¼šä¸<code>go</code>è¯­å¥çš„æ‰§è¡Œé¡ºåºå®Œå…¨ä¸€è‡´ã€‚æ­¤å¤–ï¼Œè¿™é‡Œçš„<code>trigger</code>å‡½æ•°å®ç°äº†ä¸€ç§è‡ªæ—‹ï¼ˆspinningï¼‰ã€‚é™¤éå‘ç°æ¡ä»¶å·²æ»¡è¶³ï¼Œå¦åˆ™å®ƒä¼šä¸æ–­åœ°è¿›è¡Œæ£€æŸ¥ã€‚</p>\n<p>æœ€åè¦è¯´çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä¾ç„¶æƒ³è®©ä¸»goroutineæœ€åä¸€ä¸ªè¿è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥è¿˜éœ€è¦åŠ ä¸€è¡Œä»£ç ã€‚ä¸è¿‡æ—¢ç„¶æœ‰äº†<code>trigger</code>å‡½æ•°ï¼Œæˆ‘å°±æ²¡æœ‰å†ä½¿ç”¨é€šé“ã€‚</p>\n<pre><code>trigger(10, func(){})\n</code></pre>\n<p>è°ƒç”¨<code>trigger</code>å‡½æ•°å®Œå…¨å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ç”±äºå½“æ‰€æœ‰æˆ‘æ‰‹åŠ¨å¯ç”¨çš„goroutineéƒ½è¿è¡Œå®Œæ¯•ä¹‹åï¼Œ<code>count</code>çš„å€¼ä¸€å®šä¼šæ˜¯<code>10</code>ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ<code>10</code>ä½œä¸ºäº†ç¬¬ä¸€ä¸ªå‚æ•°å€¼ã€‚åˆç”±äºæˆ‘å¹¶ä¸æƒ³æ‰“å°è¿™ä¸ª<code>10</code>ï¼Œæ‰€ä»¥æˆ‘æŠŠä¸€ä¸ªä»€ä¹ˆéƒ½ä¸åšçš„å‡½æ•°ä½œä¸ºäº†ç¬¬äºŒä¸ªå‚æ•°å€¼ã€‚</p>\n<p>æ€»ä¹‹ï¼Œé€šè¿‡ä¸Šè¿°çš„æ”¹é€ ï¼Œæˆ‘ä½¿å¾—å¼‚æ­¥å‘èµ·çš„<code>go</code>å‡½æ•°å¾—åˆ°äº†åŒæ­¥åœ°ï¼ˆæˆ–è€…è¯´æŒ‰ç…§æ—¢å®šé¡ºåºåœ°ï¼‰æ‰§è¡Œï¼Œä½ ä¹Ÿå¯ä»¥åŠ¨æ‰‹è‡ªå·±è¯•ä¸€è¯•ï¼Œæ„Ÿå—ä¸€ä¸‹ã€‚</p>\n<p><strong>æ€»ç»“</strong></p>\n<p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¥ç€ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸»é—®é¢˜ï¼Œè®¨è®ºäº†å½“æˆ‘ä»¬æƒ³è®©è¿è¡Œç»“æœæ›´åŠ å¯æ§çš„æ—¶å€™ï¼Œåº”è¯¥æ€æ ·å»åšã€‚</p>\n<p>ä¸»goroutineçš„è¿è¡Œè‹¥è¿‡æ—©ç»“æŸï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¹¶å‘ç¨‹åºçš„åŠŸèƒ½å°±å¾ˆå¯èƒ½æ— æ³•å…¨éƒ¨å®Œæˆã€‚æ‰€ä»¥æˆ‘ä»¬å¾€å¾€éœ€è¦é€šè¿‡ä¸€äº›æ‰‹æ®µå»è¿›è¡Œå¹²æ¶‰ï¼Œæ¯”å¦‚è°ƒç”¨<code>time.Sleep</code>å‡½æ•°æˆ–è€…ä½¿ç”¨é€šé“ã€‚æˆ‘ä»¬åœ¨åé¢çš„æ–‡ç« ä¸­è¿˜ä¼šè®¨è®ºæ›´é«˜çº§çš„æ‰‹æ®µã€‚</p>\n<p>å¦å¤–ï¼Œ<code>go</code>å‡½æ•°çš„å®é™…æ‰§è¡Œé¡ºåºå¾€å¾€ä¸å…¶æ‰€å±çš„<code>go</code>è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼ˆæˆ–è€…è¯´goroutineçš„å¯ç”¨é¡ºåºï¼‰ä¸åŒï¼Œè€Œä¸”é»˜è®¤æƒ…å†µä¸‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸å¯é¢„çŸ¥çš„ã€‚é‚£æ€æ ·æ‰èƒ½è®©è¿™ä¸¤ä¸ªé¡ºåºä¸€è‡´å‘¢ï¼Ÿå…¶å®å¤æ‚çš„å®ç°æ–¹å¼æœ‰ä¸å°‘ï¼Œä½†æ˜¯å¯èƒ½ä¼šæŠŠåŸæ¥çš„ä»£ç æ”¹å¾—é¢ç›®å…¨éã€‚æˆ‘åœ¨è¿™é‡Œæä¾›äº†ä¸€ç§æ¯”è¾ƒç®€å•ã€æ¸…æ™°çš„æ”¹é€ æ–¹æ¡ˆï¼Œä¾›ä½ å‚è€ƒã€‚</p>\n<p>æ€»ä¹‹ï¼Œæˆ‘å¸Œæœ›é€šè¿‡ä¸Šè¿°åŸºç¡€çŸ¥è¯†ä»¥åŠä¸‰ä¸ªè¿è´¯çš„é—®é¢˜å¸®ä½ ä¸²èµ·ä¸€æ¡ä¸»çº¿ã€‚è¿™åº”è¯¥ä¼šè®©ä½ æ›´å¿«åœ°æ·±å…¥ç†è§£goroutineåŠå…¶èƒŒåçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œä»è€Œæ›´åŠ æ¸¸åˆƒæœ‰ä½™åœ°ä½¿ç”¨<code>go</code>è¯­å¥ã€‚</p>\n<p><strong>æ€è€ƒé¢˜</strong></p>\n<p>1.<code>runtime</code>åŒ…ä¸­æä¾›äº†å“ªäº›ä¸æ¨¡å‹ä¸‰è¦ç´ Gã€På’ŒMç›¸å…³çš„å‡½æ•°ï¼Ÿï¼ˆæ¨¡å‹ä¸‰è¦ç´ å†…å®¹åœ¨ä¸Šä¸€ç¯‡ï¼‰</p>\n<p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p>\n<p></p>\n","neighbors":{"left":{"article_title":"16 | goè¯­å¥åŠå…¶æ‰§è¡Œè§„åˆ™ï¼ˆä¸Šï¼‰","id":39841},"right":{"article_title":"18 | ifè¯­å¥ã€forè¯­å¥å’Œswitchè¯­å¥","id":39858}},"comments":[{"had_liked":false,"id":81982,"user_name":"æ«æ—ç«å±±","can_delete":false,"product_type":"c1","uid":1199855,"ip_address":"","ucode":"66099C9D1AD36C","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/ef/2ad3effd.jpg","comment_is_top":false,"comment_ctime":1554095147,"is_pvip":true,"replies":[{"id":"29704","content":"æˆ‘åˆçœ‹äº†ä¸€ä¸‹â€œæ¥ç¢—ç»¿è±†æ±¤â€åŒå­¦å†™çš„ä»£ç ã€‚æˆ‘å¯èƒ½å½“æ—¶æ²¡çœ‹æ¸…æ¥šï¼Œæˆ–è€…æ²¡è¯´æ¸…æ¥šã€‚<br><br>ä»–å†™çš„è¿™æ®µä»£ç å•ä»â€œé¡ºåºæ‰“å°æ•°å­—â€çš„è¦æ±‚ä¸Šçœ‹æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯è¿™æ ·åšå°±å˜æˆçº¯åŒæ­¥çš„æµç¨‹äº†ï¼Œgoå‡½æ•°å°±å®Œå…¨æ²¡å¿…è¦å†™äº†ã€‚æŠŠgoå‡½æ•°ä¸­çš„ä»£ç æ‹¿å‡ºæ¥ã€åˆ æ‰goå‡½æ•°ï¼Œå†æŠŠé€šé“çš„ç›¸å…³ä»£ç ä¹Ÿåˆ æ‰ï¼Œå²‚ä¸æ˜¯æ›´ç›´æˆªäº†å½“ï¼Ÿåƒè¿™æ ·ï¼š<br><br>\tfor i := 0; i &lt; num; i++ {<br>\t\tfmt.Println(i)<br>\t}<br><br>è¿™ä¸ªé¢˜ç›®çš„è¦æ±‚æ˜¯â€œä½¿å¾—åœ¨forå¾ªç¯ä¸­å¯ç”¨çš„å¤šä¸ªgoroutineæŒ‰ç…§æ—¢å®šçš„é¡ºåºè¿è¡Œâ€ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºâ€œåœ¨å¼‚æ­¥çš„æƒ…å†µä¸‹é¡ºåºçš„æ‰“å°æ•°å­—â€ã€‚æ‰€ä»¥ï¼Œâ€œæ¥ç¢—ç»¿è±†æ±¤â€åŒå­¦å†™çš„ä»£ç åªæ»¡è¶³äº†å…¶ä¸­ä¸€ä¸ªè¦æ±‚ï¼Œè€Œæ²¡æœ‰è®©goå‡½æ•°ä»¬è‡ªç”±çš„å¼‚æ­¥æ‰§è¡Œã€‚<br><br>æˆ‘çš„é‚£ä¸ªç‰ˆæœ¬demo40.goæ˜¯è®©å„ä¸ªgoå‡½æ•°ï¼ˆç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯å®ƒä»¬è°ƒç”¨çš„triggerå‡½æ•°ï¼‰è‡ªè¡Œåœ°æ£€æŸ¥æ‰€éœ€æ¡ä»¶ï¼Œç„¶åå†åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹æ‰“å°æ•°å­—ã€‚è¿™ä¹Ÿå«â€œè‡ªæ—‹â€ã€‚è¿™ä¸çº¯åŒæ­¥çš„æµç¨‹æ˜¯æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«çš„ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1554128270,"ip_address":"","comment_id":81982,"utype":1}],"discussion_count":3,"race_medal":0,"score":"267842067499","product_id":100013101,"comment_content":"è€å¸ˆï¼Œå…³äºé¡ºåºæ‰“å°çš„demo40.goçš„ä¼˜åŒ–ç‰ˆæœ¬ï¼ŒåŒæ¥ç¢—ç»¿è±†æ±¤åŒå­¦çš„å®ç°<br>package main<br><br>import &quot;fmt&quot;<br><br>func main() {<br><br>\tvar num = 10<br>\tsign := make(chan struct{}, 1)<br><br>\tfor i := 0; i &lt; num; i++ {<br>\t\tgo func(i int) {<br>\t\t\tfmt.Println(i)<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}(i)<br>\t\t&lt;-sign<br>\t}<br><br>}<br>è¿™æ ·å†™ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŒæ­¥ï¼Œèƒ½ä¸èƒ½å†è¯¦ç»†è§£é‡Šä¸‹å‘¢ã€‚è¿™ä¸ªå®ç°å’Œæ‚¨demo39.go ç›¸æ¯”ï¼Œåªæ˜¯åˆå¹¶äº†ä¸¤å¤„forå¾ªç¯ï¼Œæˆ‘çœ‹å¥½å¤šåŒå­¦ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œå‘æ‚¨æ±‚è§£ã€‚<br>demo40.goçš„å®ç°ç›¸å½“äºå®ç°äº†æ¯ä¸ªå¼‚æ­¥çº¿ç¨‹çš„ä¸€ä¸ªè½®è¯¢loopã€‚ ä¸Šé¢çš„å®ç°ç›¸å½“äºå•æ­¥é—´åŠ äº†ä¸€ä¸ªbarrierã€‚æ‰§è¡Œ1-&gt;ç­‰å¾…-&gt;æ‰§è¡Œ2-&gt;ç­‰å¾…ã€‚ å®åœ¨æ²¡ç†è§£ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŒæ­¥","like_count":63,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445415,"discussion_content":"æˆ‘åˆçœ‹äº†ä¸€ä¸‹â€œæ¥ç¢—ç»¿è±†æ±¤â€åŒå­¦å†™çš„ä»£ç ã€‚æˆ‘å¯èƒ½å½“æ—¶æ²¡çœ‹æ¸…æ¥šï¼Œæˆ–è€…æ²¡è¯´æ¸…æ¥šã€‚\n\nä»–å†™çš„è¿™æ®µä»£ç å•ä»â€œé¡ºåºæ‰“å°æ•°å­—â€çš„è¦æ±‚ä¸Šçœ‹æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯è¿™æ ·åšå°±å˜æˆçº¯åŒæ­¥çš„æµç¨‹äº†ï¼Œgoå‡½æ•°å°±å®Œå…¨æ²¡å¿…è¦å†™äº†ã€‚æŠŠgoå‡½æ•°ä¸­çš„ä»£ç æ‹¿å‡ºæ¥ã€åˆ æ‰goå‡½æ•°ï¼Œå†æŠŠé€šé“çš„ç›¸å…³ä»£ç ä¹Ÿåˆ æ‰ï¼Œå²‚ä¸æ˜¯æ›´ç›´æˆªäº†å½“ï¼Ÿåƒè¿™æ ·ï¼š\n\n\tfor i := 0; i &amp;lt; num; i++ {\n\t\tfmt.Println(i)\n\t}\n\nè¿™ä¸ªé¢˜ç›®çš„è¦æ±‚æ˜¯â€œä½¿å¾—åœ¨forå¾ªç¯ä¸­å¯ç”¨çš„å¤šä¸ªgoroutineæŒ‰ç…§æ—¢å®šçš„é¡ºåºè¿è¡Œâ€ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºâ€œåœ¨å¼‚æ­¥çš„æƒ…å†µä¸‹é¡ºåºçš„æ‰“å°æ•°å­—â€ã€‚æ‰€ä»¥ï¼Œâ€œæ¥ç¢—ç»¿è±†æ±¤â€åŒå­¦å†™çš„ä»£ç åªæ»¡è¶³äº†å…¶ä¸­ä¸€ä¸ªè¦æ±‚ï¼Œè€Œæ²¡æœ‰è®©goå‡½æ•°ä»¬è‡ªç”±çš„å¼‚æ­¥æ‰§è¡Œã€‚\n\næˆ‘çš„é‚£ä¸ªç‰ˆæœ¬demo40.goæ˜¯è®©å„ä¸ªgoå‡½æ•°ï¼ˆç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯å®ƒä»¬è°ƒç”¨çš„triggerå‡½æ•°ï¼‰è‡ªè¡Œåœ°æ£€æŸ¥æ‰€éœ€æ¡ä»¶ï¼Œç„¶åå†åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹æ‰“å°æ•°å­—ã€‚è¿™ä¹Ÿå«â€œè‡ªæ—‹â€ã€‚è¿™ä¸çº¯åŒæ­¥çš„æµç¨‹æ˜¯æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«çš„ã€‚\n","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1554128270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2687948,"avatar":"https://static001.geekbang.org/account/avatar/00/29/03/cc/e58dac56.jpg","nickname":"xyg","note":"","ucode":"1F9A252515690A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571783,"discussion_content":"å“ˆå“ˆå“ˆå“ˆ æ¥ç¢—ç»¿è±†æ±¤åŒå­¦å¤§æ‰ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652409240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541037,"discussion_content":"ä½œè€…æœ‰å¤§æ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640240391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25473,"user_name":"xiaoè±ª","can_delete":false,"product_type":"c1","uid":1026417,"ip_address":"","ucode":"F7969A9785E37B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/71/78796fd5.jpg","comment_is_top":false,"comment_ctime":1537337376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"160451127328","product_id":100013101,"comment_content":"å›æ¥¼ä¸Šï¼Œatomicçš„åŠ æ“ä½œå’Œè¯»æ“ä½œåªæœ‰32ä½å’Œ64ä½æ•´æ•°å‹ï¼Œæ‰€ä»¥å¿…é¡»è¦æŠŠintè½¬ä¸ºintxxã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºintä½æ•°æ˜¯æ ¹æ®ç³»ç»Ÿå†³å®šçš„ï¼Œè€ŒåŸå­çº§æ“ä½œè¦æ±‚é€Ÿåº¦å°½å¯èƒ½çš„å¿«ï¼Œæ‰€ä»¥æ˜ç¡®äº†æ•´æ•°çš„ä½æ•°æ‰èƒ½æœ€å¤§åœ°æé«˜æ€§èƒ½ã€‚","like_count":38},{"had_liked":false,"id":25435,"user_name":"æ¥ç¢—ç»¿è±†æ±¤","can_delete":false,"product_type":"c1","uid":1070051,"ip_address":"","ucode":"B0AB63B8D9729F","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/e3/39dcfb11.jpg","comment_is_top":false,"comment_ctime":1537327683,"is_pvip":false,"replies":[{"id":"9365","content":"è¿™äº›goå‡½æ•°çš„çœŸæ­£æ‰§è¡Œè°å…ˆè°åæ˜¯ä¸å¯æ§çš„ï¼Œæ‰€ä»¥è¿™æ ·åšä¸è¡Œçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537442536,"ip_address":"","comment_id":25435,"utype":1}],"discussion_count":9,"race_medal":0,"score":"160451117635","product_id":100013101,"comment_content":"æˆ‘æœ‰ä¸€ä¸ªæ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œ å¦‚ä¸‹<br>func main(){<br>\tch := make(chan struct{})<br>\tfor i:=0; i &lt; 100; i++{<br>\t\tgo func(i int){<br>\t\t\tfmt.Println(i)<br>\t\t\tch &lt;- struct{}{}<br>\t\t}(i)<br>\t\t&lt;-ch<br>\t}<br>}<br>è¿™æ ·ï¼Œæ¯æ¬¡å¾ªç¯éƒ½åŒ…è£…goroutine æ‰§è¡Œç»“æŸæ‰è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå°±å¯ä»¥ä¿è¯é¡ºåºæ‰§è¡Œäº†","like_count":37,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424306,"discussion_content":"è¿™äº›goå‡½æ•°çš„çœŸæ­£æ‰§è¡Œè°å…ˆè°åæ˜¯ä¸å¯æ§çš„ï¼Œæ‰€ä»¥è¿™æ ·åšä¸è¡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537442536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311299,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","nickname":"Bourne","note":"","ucode":"1286279F70B13F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308610,"discussion_content":"func main() {\n\tch := make(chan struct{})\n\tfor i := 0; i < 10; i++ {\n\t\tgo func(i int) {\n\t\t\tfmt.Println(i)\n\t\t\tch <- struct{}{}\n\t\t}(i)\n\t\t<-ch\n\t\tfmt.Printf(&#34;no %d goroutine finished.\\n&#34;, i)\n\t}\n}\nä¸Šé¢æ‰“å°å¦‚ä¸‹: \n0\nno 0 goroutine finished.\n1\nno 1 goroutine finished.\n2\nno 2 goroutine finished.\n3\nno 3 goroutine finished.\n4\nno 4 goroutine finished.\n5\nno 5 goroutine finished.\n6\nno 6 goroutine finished.\n7\nno 7 goroutine finished.\n8\nno 8 goroutine finished.\n9\nno 9 goroutine finished.\n\nè¿™å°±æ„å‘³ç€ä¸»åç¨‹æ¯æ¬¡éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå­åç¨‹,ç­‰è¿™ä¸ªå­åç¨‹è¿è¡Œå®Œäº†å†åˆ›å»ºä¸‹ä¸€ä¸ª,è¿™å·²ç»ä¸æ˜¯å¹¶å‘äº†,ç¼–ç¨‹ä¸²è¡Œäº†","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1601005233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1340120,"avatar":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","nickname":"FreeMason","note":"","ucode":"3D58AC2F9AB345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311299,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","nickname":"Bourne","note":"","ucode":"1286279F70B13F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576085,"discussion_content":"å…„å¼Ÿä½ è¿™æ˜¯ä¸²è¡Œæ‰§è¡Œäº†ï¼Œå¹¶ä¸æ˜¯å¹¶å‘å·¥æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655274267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308610,"ip_address":""},"score":576085,"extra":""}]},{"author":{"id":1099513,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/f9/caf27bd3.jpg","nickname":"å¤§ç‹å«æˆ‘æ¥å·¡å±±","note":"","ucode":"1B8D0C701BC95E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8506,"discussion_content":"åŸå­æ€§æ˜¯æŒ‡ä»¤çº§åˆ«çš„ï¼Œä¸æ˜¯è¯­å¥çº§åˆ«çš„ï¼Œä¸€æ¡è¯­å¥å¯èƒ½ä¼šå¯¹åº”å¾ˆå¤šæ¡æŒ‡ä»¤ï¼Œè¿™ä¸ªæ˜¯å¾ˆå¤šåˆå­¦è€…ç†è§£å¹¶å‘çš„ä¸€ä¸ªéšœç¢","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1568013063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2295511,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/FMrT2lyJhJu1fQAWiadGMUGhNuXWpHkLrAEYWP975IhCticeXDIqlPqibl7QaNkaEFpmuI6834FFVkQOQoWAu1gew/132","nickname":"Geek_d05b33","note":"","ucode":"874391AD73DB7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381549,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ï¼Œé¢˜ç›®è¦æ±‚æ˜¯æ¯ä¸ªgoroutineéƒ½è¿›å…¥å¾…æ‰§è¡Œé˜Ÿåˆ—ï¼Œè‡ªå·±æ£€æŸ¥è¿è¡Œæ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³åˆ™æ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±å„Gè‡ªå·±æ§åˆ¶çš„ã€‚ä¸»Gåªè´Ÿè´£å¯åŠ¨å„Gã€‚\nä¸Šé¢çš„è¯­å¥æ˜¯ä¸Šä¸€ä¸ªå¾ªç¯ä½“æ‰§è¡Œå®Œæ¯•ï¼Œæ‰å°†ä¸‹ä¸€ä¸ªå¾ªç¯ä½“æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ˜¯ç”±ä¸»Gè°ƒåº¦çš„ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1625124206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2818527,"avatar":"","nickname":"Geek_d094ea","note":"","ucode":"C137051985EF34","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558721,"discussion_content":"å¦‚æœæ¯ä¸ªgoroutineæ‰§è¡Œçš„å†…éƒ¨é€»è¾‘ä¸ä¸€æ ·ï¼Œæˆ–è€…æœ‰é˜»å¡ç­‰å¾…èµ„æºçš„ï¼Œå°±ä¸èƒ½ä¿è¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648438455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1166373,"avatar":"https://static001.geekbang.org/account/avatar/00/11/cc/25/8c6eab2c.jpg","nickname":"ArtistLu","note":"","ucode":"2E641A3EB4F9AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2908,"discussion_content":"func main(){\nch := make(chan struct{})\nfor i:=0; i < 100; i++{\ngo func(i int){\nfmt.Println(i)\nch <- struct{}{}\n}(i)\n<-ch\n}\n}\n\nè€å¸ˆ è¿™ä¸ªæˆ‘è¯•äº†å¯ä»¥ğŸ˜†å¼ºåˆ¶æ¯æ¬¡æ‰§è¡Œåœ¨ä¸‹æ¬¡å¾ªç¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564032479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1071316,"avatar":"https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg","nickname":"èŠå£«è€çˆ¹","note":"","ucode":"5F2935967574D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1166373,"avatar":"https://static001.geekbang.org/account/avatar/00/11/cc/25/8c6eab2c.jpg","nickname":"ArtistLu","note":"","ucode":"2E641A3EB4F9AC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":3802,"discussion_content":"è¿™æ˜¯æ¯æ¬¡éƒ½é˜»å¡äº†ä¸»Gçš„forå¾ªç¯ï¼Œå·²ç»ä¸æ˜¯å¹¶å‘äº†ã€‚","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1564824033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2908,"ip_address":""},"score":3802,"extra":""},{"author":{"id":1014692,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/a4/24955994.jpg","nickname":"progyoung","note":"","ucode":"0B4898AE78F9F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1071316,"avatar":"https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg","nickname":"èŠå£«è€çˆ¹","note":"","ucode":"5F2935967574D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29334,"discussion_content":"æ­£è§£ï¼Œåˆçœ‹æ²¡ç†è§£ï¼Œä»”ç»†ç ”ç©¶ä¸‹ç¡®å®æ˜¯ï¼Œéƒè€å¸ˆçš„æ˜¯è®©å¹¶å‘å¯åŠ¨çš„goroutineæŒ‰è¦æ±‚çš„é¡ºåºæ‰§è¡Œäº†ï¼Œæ¥¼ä¸»çš„æ˜¯é˜»å¡éå¹¶å‘æ‰§è¡Œ","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1570762549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3802,"ip_address":""},"score":29334,"extra":""}]}]},{"had_liked":false,"id":128028,"user_name":"Geek_3241ef","can_delete":false,"product_type":"c1","uid":1596800,"ip_address":"","ucode":"3258AFDD5D9730","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKbHJIeiaXIApbom8Yx325VvUouL4auhC62JBSpwY8Ao5VbrvCWDq2UUIl4XM6SicnGCW5LrHibQZwjQ/132","comment_is_top":false,"comment_ctime":1566822607,"is_pvip":false,"replies":[{"id":"47686","content":"è¿™ä¸»è¦æ˜¯å› ä¸ºï¼šGo è°ƒåº¦å™¨åœ¨éœ€è¦çš„æ—¶å€™åªä¼šå¯¹æ­£åœ¨è¿è¡Œçš„ goroutine å‘å‡ºé€šçŸ¥ï¼Œè¯•å›¾è®©å®ƒåœä¸‹æ¥ã€‚ä½†æ˜¯ï¼Œå®ƒå´ä¸ä¼šä¹Ÿä¸èƒ½å¼ºè¡Œè®©ä¸€ä¸ª goroutine åœä¸‹æ¥ã€‚<br><br>æ‰€ä»¥ï¼Œå¦‚æœä¸€æ¡ for è¯­å¥è¿‡äºç®€å•çš„è¯ï¼Œæ¯”å¦‚è¿™é‡Œçš„ for è¯­å¥å°±å¾ˆç®€å•ï¼ˆå› ä¸ºé‡Œé¢åªæœ‰ä¸€æ¡ if è¯­å¥ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çš„ goroutine å°±å¯èƒ½ä¸ä¼šå»æ­£å¸¸å“åº”ï¼ˆæˆ–è€…è¯´æ²¡æœ‰æœºä¼šå“åº”ï¼‰Go è°ƒåº¦å™¨çš„åœæ­¢é€šçŸ¥ã€‚<br><br>å› æ­¤ï¼Œè¿™é‡ŒåŠ ä¸€ä¸ª sleep æ˜¯ä¸ºäº†ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ˆå¦‚ä»»ä½•ç‰ˆæœ¬çš„ Goã€ä»»ä½•è®¡ç®—å¹³å°ä¸‹çš„ Goã€ä»»ä½•çš„ CPU æ ¸å¿ƒæ•°ç­‰ï¼‰ï¼Œå†…å«è¿™æ¡ for è¯­å¥çš„è¿™äº› goroutine éƒ½èƒ½å¤Ÿæ­£å¸¸åœ°å“åº”åœæ­¢é€šçŸ¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1566906355,"ip_address":"","comment_id":128028,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57401397455","product_id":100013101,"comment_content":"ä½ å¥½ï¼Œéƒè€å¸ˆï¼Œè¯·é—®è¿™é‡Œä¸ºä»€ä¹ˆéœ€è¦sleepå‘¢ï¼Œæˆ‘ç†è§£çš„å¦‚æœä¸åŠ sleepï¼Œå…¶ä¸­æŸä¸ªgä¼šä¸€ç›´è½®è¯¢countçš„å€¼ï¼Œå½“å¦ä¸€ä¸ªgæ›´æ”¹è¿™ä¸ªå€¼æ—¶ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªgå°±ä¼šåˆ¤æ–­ç›¸ç­‰æ‰å¯¹å‘€ã€‚<br>ä½†å®é™…ä¸Šå»æ‰sleepåï¼Œç¨‹åºç¡®å®æ²¡æœ‰æŒ‰ç…§æˆ‘ç†è§£çš„é€»è¾‘æ‰§è¡Œï¼Œè¯·é—®è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢","like_count":14,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464761,"discussion_content":"è¿™ä¸»è¦æ˜¯å› ä¸ºï¼šGo è°ƒåº¦å™¨åœ¨éœ€è¦çš„æ—¶å€™åªä¼šå¯¹æ­£åœ¨è¿è¡Œçš„ goroutine å‘å‡ºé€šçŸ¥ï¼Œè¯•å›¾è®©å®ƒåœä¸‹æ¥ã€‚ä½†æ˜¯ï¼Œå®ƒå´ä¸ä¼šä¹Ÿä¸èƒ½å¼ºè¡Œè®©ä¸€ä¸ª goroutine åœä¸‹æ¥ã€‚\n\næ‰€ä»¥ï¼Œå¦‚æœä¸€æ¡ for è¯­å¥è¿‡äºç®€å•çš„è¯ï¼Œæ¯”å¦‚è¿™é‡Œçš„ for è¯­å¥å°±å¾ˆç®€å•ï¼ˆå› ä¸ºé‡Œé¢åªæœ‰ä¸€æ¡ if è¯­å¥ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çš„ goroutine å°±å¯èƒ½ä¸ä¼šå»æ­£å¸¸å“åº”ï¼ˆæˆ–è€…è¯´æ²¡æœ‰æœºä¼šå“åº”ï¼‰Go è°ƒåº¦å™¨çš„åœæ­¢é€šçŸ¥ã€‚\n\nå› æ­¤ï¼Œè¿™é‡ŒåŠ ä¸€ä¸ª sleep æ˜¯ä¸ºäº†ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ˆå¦‚ä»»ä½•ç‰ˆæœ¬çš„ Goã€ä»»ä½•è®¡ç®—å¹³å°ä¸‹çš„ Goã€ä»»ä½•çš„ CPU æ ¸å¿ƒæ•°ç­‰ï¼‰ï¼Œå†…å«è¿™æ¡ for è¯­å¥çš„è¿™äº› goroutine éƒ½èƒ½å¤Ÿæ­£å¸¸åœ°å“åº”åœæ­¢é€šçŸ¥ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566906355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25387,"user_name":"Askerlve","can_delete":false,"product_type":"c1","uid":1178535,"ip_address":"","ucode":"BF29F9A8674507","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/a7/12c90699.jpg","comment_is_top":false,"comment_ctime":1537322076,"is_pvip":false,"replies":[{"id":"9364","content":"å¯ä»¥åŠ ä¸ªsleep","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537441119,"ip_address":"","comment_id":25387,"utype":1}],"discussion_count":7,"race_medal":0,"score":"53076929628","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;sync&#47;atomic&quot;<br>)<br><br>func main() {<br>\tvar count uint32<br>\ttrigger := func(i uint32, fn func()) {<br>\t\tfor {<br>\t\t\tif n := atomic.LoadUint32(&amp;count); n == i {<br>\t\t\t\tfn()<br>\t\t\t\tatomic.AddUint32(&amp;count, 1)<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t}<br>\t}<br>\tfor i := uint32(0); i &lt; 10; i++ {<br>\t\tgo func(i uint32) {<br>\t\t\tfn := func() {<br>\t\t\t\tfmt.Println(i)<br>\t\t\t}<br>\t\t\ttrigger(i, fn)<br>\t\t}(i)<br>\t}<br>\ttrigger(10, func() {})<br>}<br><br>æµ‹è¯•äº†ä¸‹ï¼Œè¿™ä¸ªå‡½æ•°çš„è¾“å‡ºä¸å—æ§ï¼Œå¹¶ä¸”å¥½åƒæ°¸è¿œä¹Ÿä¸ä¼šç»“æŸï¼Œæœ‰äººèƒ½å¸®å¿™è§£é‡Šä¸‹å—ï¼Œgoå°ç™½~ğŸ˜€","like_count":12,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424282,"discussion_content":"å¯ä»¥åŠ ä¸ªsleep","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537441119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217554,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/12/15558f28.jpg","nickname":"Jason","note":"","ucode":"C5A540BC5A60B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572763,"discussion_content":"è¿™é‡Œçš„sleepå…¶å®å°±æ˜¯å‘Šè¯‰è°ƒåº¦å™¨ï¼Œæˆ‘è®©å‡ºäº†cpuï¼Œè®©å…¶ä»–åç¨‹æ‰§è¡Œã€‚è¿˜æœ‰channelè¯»å–ä¸åˆ°æ•°æ®ï¼Œæˆ–å‘æ»¡çš„channelå†™å…¥æ•°æ®æˆ–ioé˜»å¡éƒ½ä¼šè®©å‡ºCPUï¼Œç­‰å¾…ä¸‹æ¬¡è°ƒåº¦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652949346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1848474,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/34/9a/1587bc6f.jpg","nickname":"JDY","note":"","ucode":"4B6F55332BE6DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582128,"discussion_content":"å•çº¯ä¸ºäº†ç¨‹åºèƒ½æ‰§è¡ŒåŠ sleepï¼Œè¿™ç§æ–¹å¼ä¸å¯å–å§ï¼Œçº¿ä¸Šä»£ç å¯ä¸èƒ½è¿™ä¹ˆæã€‚æ‰€ä»¥è„±ç¦»ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ï¼Œéƒ½æ˜¯ä¼ªä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659253948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236766,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","nickname":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","note":"","ucode":"103543D6E706BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209078,"discussion_content":"æˆ‘è§‰å¾— æœ‰å¯èƒ½ ä½ é‚£ä¸ªnå·²ç»è¶…è¿‡äº†i æ‰€ä»¥æŸä¸€ä¸ªgoroutineæ­»äº† ä¸Šé¢CCCZZZä¹Ÿå›ç­”äº†æœ€é‡è¦çš„ä¸€ç‚¹ ä½ æœ¬æ¥å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ ä¸‡ä¸€ä¸€ç›´ä¸é‡Šæ”¾å¯¹cpuçš„å ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584607136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1369165,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e4/4d/c7b5f20a.jpg","nickname":"é»„ä¼Ÿæ´ª","note":"","ucode":"97331040A49EAD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3839,"discussion_content":"ä¸ºä»€ä¹ˆè¦åŠ sleepæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æˆ‘ä¹Ÿæ˜¯ä¸æ˜ç™½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564848901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1369165,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e4/4d/c7b5f20a.jpg","nickname":"é»„ä¼Ÿæ´ª","note":"","ucode":"97331040A49EAD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":122998,"discussion_content":"æˆ‘è§‰å¾—æ˜¯triggerå‡½æ•°é‡Œéƒ½æ˜¯forå¾ªç¯ï¼Œå¤šä¸ªgoroutineä¼šä¸€ç›´å ç”¨åŸå­å˜é‡çš„è·å–æ“ä½œï¼Œå³LoadUint32ï¼Œå¯¼è‡´åˆ¤æ–­ç›¸ç­‰æ¡ä»¶ä¸€ç›´ä¸æˆç«‹ï¼Œåˆä¼šä¸€ç›´å¾ªç¯è·å–å¹¶ç­‰å¾…ï¼Œå¯èƒ½é€ æˆæ­»é”ï¼Œæˆ–è®¸éš”å¾ˆé•¿æ—¶é—´å°±èƒ½æ‰“å°ã€‚\nå¢åŠ  sleepå¯èƒ½æ˜¯ä¸ºäº†ç­‰å…¶ä»–çš„groutineæœ‰æœºä¼šæ‰§è¡Œè·å–countå§","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1578384640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3839,"ip_address":""},"score":122998,"extra":""},{"author":{"id":1252164,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1b/44/82acaafc.jpg","nickname":"æ— ä¸º","note":"","ucode":"81D7AF5E1FDD30","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1369165,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e4/4d/c7b5f20a.jpg","nickname":"é»„ä¼Ÿæ´ª","note":"","ucode":"97331040A49EAD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329475,"discussion_content":"å¦‚æœæœ€å…ˆè·å¾—æ‰§è¡Œçš„goroutine ä¸æ˜¯ç¬¬ä¸€ä¸ª, é‚£ if æ¡ä»¶å°±ä¸æˆç«‹äº†, trigger()ä¸€æ—¦æ‰§è¡Œå°±æ­»å¾ªç¯äº†, å¦‚æœæ˜¯å•è¿›ç¨‹, å…¶ä»–çš„goroutineå°±æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†.  sleepçš„ä½œç”¨, å°±æ˜¯é‡Šæ”¾å½“å‰goroutineæ‰§è¡Œæœºä¼š, è¿›å…¥ç­‰å¾…åŒº, å…¶ä»–çš„ goroutine å°±æœ‰å¯èƒ½è·å–æ‰§è¡Œçš„æœºä¼š, è¿™æ ·count å°±æœ‰æœºä¼šå‘ç”Ÿå˜åŒ–äº†, å½“å‰è¿™ä¸ª goroutine ä¸­çš„ifå°±æœ‰å¯èƒ½åœ¨æŸæ¬¡å¾ªç¯çš„æ—¶å€™æˆç«‹äº†, å°±å¯ä»¥é€€å‡ºäº†, å…¶ä»–çš„goroutineä¹Ÿæ˜¯ä¸€æ ·çš„. ä¸ä¿è¯ç†è§£å®Œå…¨æ­£ç¡®, å¦‚æœ‰é”™è¯¯, å¤§å®¶å¸®å¿™æŒ‡æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606388557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3839,"ip_address":""},"score":329475,"extra":""}]}]},{"had_liked":false,"id":32370,"user_name":"è€èŒ‚","can_delete":false,"product_type":"c1","uid":1199722,"ip_address":"","ucode":"5EB1171921758C","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/6a/ad3707f4.jpg","comment_is_top":false,"comment_ctime":1539562508,"is_pvip":false,"replies":[{"id":"11826","content":"Goè¯­è¨€è°ƒåº¦goroutineæ˜¯å‡†æŠ¢å å¼çš„ï¼Œè™½ç„¶ä¼šé˜²æ­¢æŸä¸ªgoroutineè¿è¡Œå¤ªä¹…ï¼Œå¹¶åšæ¢ä¸‹å¤„ç†ã€‚ä½†æ˜¯åƒç®€å•çš„æ­»å¾ªç¯è¿™ç§æœ‰å¯èƒ½ä¼šæ¢ä¸‹å¤±è´¥ï¼Œå°¤å…¶æ˜¯windowsä¸‹ï¼Œè¿™è·Ÿæ“ä½œç³»ç»Ÿçš„åº•å±‚æ”¯æŒæœ‰å…³ã€‚ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨æ‹…å¿ƒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539578414,"ip_address":"","comment_id":32370,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35899300876","product_id":100013101,"comment_content":"ä¸åŠ sleepç¨‹åºä¸èƒ½æ­£å¸¸ç»“æŸçš„æƒ…å†µè²Œä¼¼è·Ÿcpuæ ¸æ•°æœ‰å…³ï¼Œæˆ‘æ˜¯4æ ¸cpuï¼Œæ‰“å°0åˆ°2æ¯æ¬¡éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼›0åˆ°3ä»¥ä¸Šå°±ä¼šæœ‰å¡ä¸»çš„æƒ…å†µï¼Œå¡ä¸»æ—¶cpuè¾¾åˆ°100%ï¼Œloadä¼šè¶…è¿‡4ã€‚çŒœæµ‹æ˜¯ä¸æ˜¯æ­¤æ—¶æ‰€æœ‰cpuéƒ½åœ¨å¤„ç†count==0çš„forå¾ªç¯ï¼Œæ²¡æœ‰ç©ºé—²çš„cpuæ‰§è¡Œatomic.AddUint32(&amp;count, 1)ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426744,"discussion_content":"Goè¯­è¨€è°ƒåº¦goroutineæ˜¯å‡†æŠ¢å å¼çš„ï¼Œè™½ç„¶ä¼šé˜²æ­¢æŸä¸ªgoroutineè¿è¡Œå¤ªä¹…ï¼Œå¹¶åšæ¢ä¸‹å¤„ç†ã€‚ä½†æ˜¯åƒç®€å•çš„æ­»å¾ªç¯è¿™ç§æœ‰å¯èƒ½ä¼šæ¢ä¸‹å¤±è´¥ï¼Œå°¤å…¶æ˜¯windowsä¸‹ï¼Œè¿™è·Ÿæ“ä½œç³»ç»Ÿçš„åº•å±‚æ”¯æŒæœ‰å…³ã€‚ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨æ‹…å¿ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539578414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171541,"user_name":"è¨€åˆæœ¨æ‰","can_delete":false,"product_type":"c1","uid":1201009,"ip_address":"","ucode":"300BEDC1B07DF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/71/a4e9f20e.jpg","comment_is_top":false,"comment_ctime":1578964824,"is_pvip":false,"replies":[{"id":"66483","content":"æ­£å¼å­¦ä¹ ä¸€ä¸ªæ–°ä¸œè¥¿çš„é¦–è¦ä»»åŠ¡å°±æ˜¯â€œé‡è¦åè¯è§£æâ€ã€‚ä¸€æ—¦ç†Ÿæ‚‰äº†è¿™äº›åè¯ä»¥åŠå®ƒä»¬èƒŒåçš„æ·±æ„ï¼Œåé¢çš„å­¦ä¹ æ•ˆç‡å°±ä¼šé«˜å¾ˆå¤šã€‚æ›´é‡è¦çš„æ˜¯ï¼Œåé¢ä¼šå­¦å¾—æ›´æ‰å®ï¼ˆæˆ–è€…è¯´å¾ˆç¨³ï¼‰ã€‚å› ä¸ºä½ çœŸæ­£èå…¥äº†è¿™ä¸ªæ–°ä¸œè¥¿æ‰€å¤„çš„ä¸–ç•Œï¼Œç«™åœ¨äº†å®ƒçš„åœ°åŸºä¹‹ä¸Šã€‚è¿™ä¹Ÿæ˜¯æˆ‘çš„ä¸€ç‚¹å­¦ä¹ ç»éªŒã€‚å…±å‹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1578968391,"ip_address":"","comment_id":171541,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31643735896","product_id":100013101,"comment_content":"è¿™ç¯‡åŠ äº†ä»£ç ï¼Œä¸€ä¸‹å­å°±å®¹æ˜“å¾ˆå¤šäº†ï¼Œè€å¸ˆå‰é¢çš„å‡ ç¯‡éƒ½å¤ªå¤šåè¯äº†ï¼Œéœ€è¦ç¢ç£¨å»å¥½å‡ é","like_count":7,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481405,"discussion_content":"æ­£å¼å­¦ä¹ ä¸€ä¸ªæ–°ä¸œè¥¿çš„é¦–è¦ä»»åŠ¡å°±æ˜¯â€œé‡è¦åè¯è§£æâ€ã€‚ä¸€æ—¦ç†Ÿæ‚‰äº†è¿™äº›åè¯ä»¥åŠå®ƒä»¬èƒŒåçš„æ·±æ„ï¼Œåé¢çš„å­¦ä¹ æ•ˆç‡å°±ä¼šé«˜å¾ˆå¤šã€‚æ›´é‡è¦çš„æ˜¯ï¼Œåé¢ä¼šå­¦å¾—æ›´æ‰å®ï¼ˆæˆ–è€…è¯´å¾ˆç¨³ï¼‰ã€‚å› ä¸ºä½ çœŸæ­£èå…¥äº†è¿™ä¸ªæ–°ä¸œè¥¿æ‰€å¤„çš„ä¸–ç•Œï¼Œç«™åœ¨äº†å®ƒçš„åœ°åŸºä¹‹ä¸Šã€‚è¿™ä¹Ÿæ˜¯æˆ‘çš„ä¸€ç‚¹å­¦ä¹ ç»éªŒã€‚å…±å‹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578968391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018200,"avatar":"","nickname":"ä¸€çœ¼ä¸‡å¹´","note":"","ucode":"7B0823E39AE809","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298646,"discussion_content":"çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597370274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1896164,"avatar":"","nickname":"Geek_73af59","note":"","ucode":"7885D16EB735B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204453,"discussion_content":"è€Œä¸”æ˜¯ç”¨è‡ªå·±çš„è¯å»è§£é‡Šï¼Œä¸èƒ½æ­»è®°ç¡¬èƒŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584175029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25386,"user_name":"Askerlve","can_delete":false,"product_type":"c1","uid":1178535,"ip_address":"","ucode":"BF29F9A8674507","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/a7/12c90699.jpg","comment_is_top":false,"comment_ctime":1537321975,"is_pvip":false,"replies":[{"id":"9367","content":"Winä¸‹å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä½ åœ¨bifè¯­å¥åè¾¹åŠ ä¸€å¥time.sleep(time.Nanosecond)ã€‚githubä¸Šçš„ä»£ç æˆ‘å·²ç»æ›´æ–°äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537442812,"ip_address":"","comment_id":25386,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31602093047","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;sync&#47;atomic&quot;<br>)<br><br>func main() {<br>\tvar count uint32<br>\ttrigger := func(i uint32, fn func()) {<br>\t\tfor {<br>\t\t\tif n := atomic.LoadUint32(&amp;count); n == i {<br>\t\t\t\tfn()<br>\t\t\t\tatomic.AddUint32(&amp;count, 1)<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t}<br>\t}<br>\tfor i := uint32(0); i &lt; 10; i++ {<br>\t\tgo func(i uint32) {<br>\t\t\tfn := func() {<br>\t\t\t\tfmt.Println(i)<br>\t\t\t}<br>\t\t\ttrigger(i, fn)<br>\t\t}(i)<br>\t}<br>\ttrigger(10, func() {})<br>}<br><br>è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿˜æ˜¯ä¸å¯æ§è¯¶ï¼Œå¹¶ä¸”å¥½åƒæ°¸è¿œä¹Ÿä¸ä¼šç»“æŸï¼Œæ˜¯å› ä¸ºæˆ‘çš„goç‰ˆæœ¬é—®é¢˜å—ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424281,"discussion_content":"Winä¸‹å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œä½ åœ¨bifè¯­å¥åè¾¹åŠ ä¸€å¥time.sleep(time.Nanosecond)ã€‚githubä¸Šçš„ä»£ç æˆ‘å·²ç»æ›´æ–°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537442812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92747,"user_name":"è‚–æ©","can_delete":false,"product_type":"c1","uid":1242463,"ip_address":"","ucode":"78F91260284C21","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/5f/01b82ba1.jpg","comment_is_top":false,"comment_ctime":1557320514,"is_pvip":false,"replies":[{"id":"33119","content":"ç¥è´ºä½ å‡çº§äº†ï¼›ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1557325499,"ip_address":"","comment_id":92747,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27327124290","product_id":100013101,"comment_content":"ç¬¬ä¸€éçœ‹å¥½å¤šéƒ½çœ‹ä¸æ‡‚ï¼Œçœ‹åˆ°åè¾¹å›è¿‡å¤´æ¥çœ‹ï¼Œå‘ç°ç”¨è‡ªæ—‹goroutineå®ç°ï¼ŒçœŸå®å¥‡å¦™ï¼›ç°åœ¨æƒ³æƒ³ï¼Œé™¤äº†æ–‡ç« ä¸­å®ç°æ–¹å¼ï¼Œå¯ä»¥ç”¨channelåŒæ­¥å®ç°ï¼›è¿˜å¯ä»¥ç”¨sync.WaitGroupå®ç°","like_count":6,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449368,"discussion_content":"ç¥è´ºä½ å‡çº§äº†ï¼›ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557325499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26190,"user_name":"æ–°å£ç»“è£¤","can_delete":false,"product_type":"c1","uid":1198555,"ip_address":"","ucode":"BFE7CB24C4EDC0","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/db/ee5e8b43.jpg","comment_is_top":false,"comment_ctime":1537515585,"is_pvip":false,"replies":[{"id":"9669","content":"æè¿™ä¹ˆå¤šé€šé“æœ‰äº›æµªè´¹å•Šã€‚å¦å¤–åˆ‡ç‰‡ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç±»å‹ï¼Œæœ€å¥½ä¸è¦è¿™æ ·ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537690669,"ip_address":"","comment_id":26190,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27307319361","product_id":100013101,"comment_content":"func main() {<br>\tnum := 10<br>\tchs := [num+1]chan struct{}{}<br>\tfor i := 0; i &lt; num+1; i++ {<br>\t\tchs[i] = make(chan struct{})<br>\t}<br>\tfor i := 0; i &lt; num; i++ {<br>\t\tgo func(i int) {<br>\t\t\t&lt;- chs[i]<br>\t\t\tfmt.Println(i)<br>\t\t\tchs[i+1] &lt;- struct{}{}<br>\t\t}(i)<br>\t}<br>\tchs[0] &lt;- struct{}{}<br>\t&lt;- chs[num]<br>}<br>æ¯ä¸ªgoroutineæ‰§è¡Œå®Œé€šè¿‡channelé€šçŸ¥ä¸‹ä¸€ä¸ªgoroutineï¼Œåœ¨ä¸»goroutineé‡Œæ§åˆ¶ç¬¬ä¸€ä¸ªgoroutineçš„å¼€å§‹ï¼Œå¹¶æ¥æ”¶æœ€åä¸€ä¸ªgoroutineç»“æŸçš„ä¿¡å·","like_count":7,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424556,"discussion_content":"æè¿™ä¹ˆå¤šé€šé“æœ‰äº›æµªè´¹å•Šã€‚å¦å¤–åˆ‡ç‰‡ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ•°æ®ç±»å‹ï¼Œæœ€å¥½ä¸è¦è¿™æ ·ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537690669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25755,"user_name":"å—·å¤§çŒ«çš„é±¼","can_delete":false,"product_type":"c1","uid":1204931,"ip_address":"","ucode":"BF980405C8E7DF","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/c3/d7f2bd8f.jpg","comment_is_top":false,"comment_ctime":1537436627,"is_pvip":false,"replies":[{"id":"9389","content":"å¾ˆå¥½ï¼ŒåŠ æ²¹ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537447600,"ip_address":"","comment_id":25755,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27307240403","product_id":100013101,"comment_content":"è€å¸ˆï¼Œæœ€è¿‘ä»å¤´å­¦ä¹ ï¼Œå‰é¢ä¸€ç›´æ²¡è·Ÿç€åŠ¨æ‰‹ï¼Œä¹Ÿæ²¡è‡ªå·±æ€»ç»“ã€‚è¿™å‡ å¤©åœ¨æ•´ç†æ¯ç« çš„é‡ç‚¹ï¼<br><br>https:&#47;&#47;github.com&#47;wenxuwan&#47;go36<br><br>åˆšå†™å®Œç¬¬äºŒç« ï¼Œçªç„¶å‘ç°è‡ªå·±åŠ¨æ‰‹æ€»ç»“å’Œåªçœ‹å·®å¥½å¤šã€‚æˆ‘ä¼šç»§ç»­ä¿æŒå–œæ¬¢æ€»ç»“ï¼","like_count":6,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424411,"discussion_content":"å¾ˆå¥½ï¼ŒåŠ æ²¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537447600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387172,"discussion_content":"å“¥ä»¬ï¼Œæ€ä¹ˆGitHubæ²¡æ›´æ–°äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628037778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93605,"user_name":"å¿—é‘«","can_delete":false,"product_type":"c1","uid":1095392,"ip_address":"","ucode":"408869664EEA13","user_header":"https://static001.geekbang.org/account/avatar/00/10/b6/e0/52a07898.jpg","comment_is_top":false,"comment_ctime":1557533721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18737402905","product_id":100013101,"comment_content":"&#47;&#47;ä¸ªäººç¬”è®°ï¼šä½¿ç”¨ä¸€ä¸ªé€šé“æ¥æ§åˆ¶<br>package main<br><br>import &quot;fmt&quot;<br><br>func main() {<br>\tconst n = 10<br>\tm := 0<br>\tch := make(chan int, 10) &#47;&#47;é€šé“é•¿åº¦0~10ä¹‹é—´ï¼Œèƒ½å¤Ÿå½±å“æ€§èƒ½<br>\tfor i := 0; i &lt; n; i++ {<br>\t\tgo func(i int) {<br>\t\t\tfor v := &lt;-ch; v != i; v = &lt;-ch {<br>\t\t\t\tm++<br>\t\t\t\tch &lt;- v &#47;&#47;å¦‚æœä¸æ˜¯è‡ªå·±çš„è½®æ¬¡ï¼Œåˆ™æŠŠå€¼å†æ”¾å›å»<br>\t\t\t}<br>\t\t\tfmt.Println(i)<br>\t\t\tch &lt;- i + 1<br>\t\t}(i)<br>\t}<br>\tch &lt;- 0<br>\tfor v := &lt;-ch; v != 10; v = &lt;-ch {<br>\t\tch &lt;- v<br>\t}<br>\tfmt.Println(m)<br>}","like_count":4},{"had_liked":false,"id":190141,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1584606460,"is_pvip":false,"replies":[{"id":"73159","content":"æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯é¡ºåºåœ°é€ç»™æŸä¸ªMæ‰§è¡Œã€‚ä¸è¿‡ã€‚å®ƒä»¬åˆå¯ä»¥æ˜¯å¹¶å‘çš„ï¼Œå› ä¸ºå¦‚æœå‰ä¸€ä¸ªGè¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªGé˜Ÿåˆ—ä¸­çš„åä¸€ä¸ªGå°±å¾ˆå¯èƒ½ä¼šè·å¾—è¿è¡Œçš„æœºä¼šã€‚è¿™æ—¶ï¼Œå‰ä¸€ä¸ªGå¹¶æ²¡æœ‰è¿è¡Œå®Œæˆï¼Œå®ƒå¯èƒ½æ˜¯åœ¨ç­‰å¾…è®¡æ—¶å™¨åˆ°æ—¶æˆ–è€…IOæ“ä½œå®Œæˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰åè¿™ä¸¤ä¸ªGå°±æ˜¯åœ¨å¹¶å‘è¿è¡Œã€‚<br><br>è¿›ä¸€æ­¥è®²ï¼ŒåŒä¸€ä¸ªGé˜Ÿåˆ—ä¸­çš„Géƒ½å¯ä»¥å¦‚æ­¤ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥è¯´ï¼ŒGoè°ƒåº¦å™¨ä¸­çš„æ‰€æœ‰å¯è¿è¡ŒGéƒ½æ˜¯æœ‰å¹¶å‘è¿è¡Œçš„èƒ½åŠ›çš„ï¼Œåªä¸è¿‡å®é™…ä¸Šæ˜¯æ€æ ·çš„ï¼Œè¿˜è¦çœ‹å®æ—¶è°ƒåº¦çš„å…·ä½“æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1584612468,"ip_address":"","comment_id":190141,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14469508348","product_id":100013101,"comment_content":"æœ¬èŠ‚å†…å®¹ä¸»è¦æ˜¯è®²äº† goroutineåŒæ­¥é‚£ä¸€å— <br>ä¸»è¦é€šè¿‡é€šé“ ä¿¡å· åº”è¯¥syncåŒ…ä¸­ä¹Ÿä¼šæœ‰åŒæ­¥ç›¸å…³çš„å‡½æ•°<br>æˆ‘åˆå»æŠŠ16è®²é‚£ä¸ªGé˜Ÿåˆ—å†æƒ³äº†ä¸€é<br>å®é™…ä¸Šå¯èƒ½å­˜åœ¨å¤šä¸ªGé˜Ÿåˆ— Gé˜Ÿåˆ—ä¹‹é—´å±äºå¹¶å‘å…³ç³»<br>ä½†æ˜¯Gé˜Ÿåˆ—å½“ä¸­ä»–ä»¬åˆæ˜¯é˜Ÿåˆ—å‚¨å­˜ é¡ºåºæ‰§è¡Œçš„","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487900,"discussion_content":"æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯é¡ºåºåœ°é€ç»™æŸä¸ªMæ‰§è¡Œã€‚ä¸è¿‡ã€‚å®ƒä»¬åˆå¯ä»¥æ˜¯å¹¶å‘çš„ï¼Œå› ä¸ºå¦‚æœå‰ä¸€ä¸ªGè¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªGé˜Ÿåˆ—ä¸­çš„åä¸€ä¸ªGå°±å¾ˆå¯èƒ½ä¼šè·å¾—è¿è¡Œçš„æœºä¼šã€‚è¿™æ—¶ï¼Œå‰ä¸€ä¸ªGå¹¶æ²¡æœ‰è¿è¡Œå®Œæˆï¼Œå®ƒå¯èƒ½æ˜¯åœ¨ç­‰å¾…è®¡æ—¶å™¨åˆ°æ—¶æˆ–è€…IOæ“ä½œå®Œæˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰åè¿™ä¸¤ä¸ªGå°±æ˜¯åœ¨å¹¶å‘è¿è¡Œã€‚\n\nè¿›ä¸€æ­¥è®²ï¼ŒåŒä¸€ä¸ªGé˜Ÿåˆ—ä¸­çš„Géƒ½å¯ä»¥å¦‚æ­¤ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥è¯´ï¼ŒGoè°ƒåº¦å™¨ä¸­çš„æ‰€æœ‰å¯è¿è¡ŒGéƒ½æ˜¯æœ‰å¹¶å‘è¿è¡Œçš„èƒ½åŠ›çš„ï¼Œåªä¸è¿‡å®é™…ä¸Šæ˜¯æ€æ ·çš„ï¼Œè¿˜è¦çœ‹å®æ—¶è°ƒåº¦çš„å…·ä½“æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584612468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236766,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","nickname":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","note":"","ucode":"103543D6E706BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209136,"discussion_content":"æ˜¯çš„å‘¢ï¼Œè°¢è°¢æŒ‡å‡ºğŸ˜¬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584613470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31660,"user_name":"SuperP â¤ é£","can_delete":false,"product_type":"c1","uid":1203011,"ip_address":"","ucode":"FCA4E2C5BECB8F","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/43/edf22486.jpg","comment_is_top":false,"comment_ctime":1539257868,"is_pvip":false,"replies":[{"id":"11818","content":"å¯¹ï¼Œå¯ä»¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539577220,"ip_address":"","comment_id":31660,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14424159756","product_id":100013101,"comment_content":"runtime.GOMAXPROCS  è¿™ä¸ªåº”è¯¥èƒ½æ§åˆ¶Pçš„æ•°é‡","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426454,"discussion_content":"å¯¹ï¼Œå¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539577220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25479,"user_name":"cygnus","can_delete":false,"product_type":"c1","uid":1120452,"ip_address":"","ucode":"C60A86E3084754","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/c4/e55fdc1c.jpg","comment_is_top":false,"comment_ctime":1537339811,"is_pvip":false,"replies":[{"id":"9362","content":"ä½ åœ¨winä¸‹æ‰§è¡Œçš„å˜›ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537441043,"ip_address":"","comment_id":25479,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422241699","product_id":100013101,"comment_content":"demo40çš„æ‰§è¡Œç»“æœä¸æ˜¯å¹‚ç­‰çš„ï¼Œç¨‹åºç»å¸¸æ— æ³•æ­£å¸¸ç»“æŸé€€å‡ºï¼Œåªæœ‰æå°‘æ•°å‡ æ¬¡æœ‰æ­£ç¡®è¾“å‡ºã€‚","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424318,"discussion_content":"ä½ åœ¨winä¸‹æ‰§è¡Œçš„å˜›ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537441043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25468,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1082187,"ip_address":"","ucode":"FC323371453C97","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","comment_is_top":false,"comment_ctime":1537336256,"is_pvip":false,"replies":[{"id":"9363","content":"å¯ä»¥åŠ ä¸ªsleepã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537441064,"ip_address":"","comment_id":25468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422238144","product_id":100013101,"comment_content":"win64ç‰ˆæœ¬ï¼šgo1.10.2<br>linux64ç‰ˆæœ¬ï¼šgo1.11<br><br>linuxä¸‹å®é™…è¿è¡Œå’Œé¢„æœŸä¸€æ ·ï¼Œä½†ä¸ºä½•winä¸‹ä¼šä¸€ç›´è¿è¡Œä¸ä¼šåœæ­¢å‘¢ï¼Œä¸”CPUä¹Ÿå·²ç»æ˜¯100% è¡¨ç¤ºä¸è§£å‘€","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424316,"discussion_content":"å¯ä»¥åŠ ä¸ªsleepã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537441064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25383,"user_name":"å†°æ¿€å‡Œçš„çœ¼æ³ª","can_delete":false,"product_type":"c1","uid":1087945,"ip_address":"","ucode":"5DCB974667E93A","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/c9/a7c77746.jpg","comment_is_top":false,"comment_ctime":1537321677,"is_pvip":false,"replies":[{"id":"9368","content":"ä»£ç å·²ç»æ›´æ–°äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537442828,"ip_address":"","comment_id":25383,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422223565","product_id":100013101,"comment_content":"â€˜â€™å¦åˆ™ï¼Œæˆ‘ä»¬å°±å…ˆè®©å½“å‰çš„ goroutineâ€œç¡çœ â€ä¸€ä¸ªçº³ç§’å†è¿›å…¥ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚â€˜â€™<br><br>ç¤ºä¾‹ä»£ç é‡Œæ²¡æœ‰è¿™ä¸ªç¡çœ ä»£ç ","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424280,"discussion_content":"ä»£ç å·²ç»æ›´æ–°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537442828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289381,"user_name":"Geek_d6cfa7","can_delete":false,"product_type":"c1","uid":1581741,"ip_address":"","ucode":"7AF89E9A91A04D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8bkRNKwpPicpibupozsqsbR6apibQyWXyyvrhmdSHIzMXk0lbNRYfRa6ZklQSNib6QrHunxueEFb9x2gJK6GfxSq0A/132","comment_is_top":false,"comment_ctime":1618993020,"is_pvip":false,"replies":[{"id":"105029","content":"å˜é‡å€¼çš„æ”¹å˜ä¹Ÿä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ‰€ä»¥è¿™æ ·åšå¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚è€Œä¸”è¿™ä¸ªæ–¹æ¡ˆæœ‰äº›å¤æ‚äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1619060561,"ip_address":"","comment_id":289381,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10208927612","product_id":100013101,"comment_content":"go é€šé“ä¼ é€’è¾¾åˆ°é¡ºåºæ‰§è¡Œç›®çš„ï¼š<br>func TestTransmitChan(t *testing.T) {<br>\tstart, end := make(chan bool), make(chan bool)<br>\thead := start<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tend = make(chan bool)<br>\t\ttemp := i<br>\t\tgo func(head, end chan bool, i int) {<br>\t\t\t&lt;-head<br>\t\t\tt.Logf(&quot;goroutine %v doing&quot;, i)<br>\t\t\tend &lt;- true<br>\t\t}(head, end, temp)<br>\t\thead = end<br>\t}<br>\tstart &lt;- true<br>\t&lt;-end<br><br>\tt.Logf(&quot;main goroutine is end&quot;)<br>}","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518899,"discussion_content":"å˜é‡å€¼çš„æ”¹å˜ä¹Ÿä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ‰€ä»¥è¿™æ ·åšå¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚è€Œä¸”è¿™ä¸ªæ–¹æ¡ˆæœ‰äº›å¤æ‚äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619060561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25585,"user_name":"Pixar","can_delete":false,"product_type":"c1","uid":1197659,"ip_address":"","ucode":"E653387BA8EA16","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/5b/07858c33.jpg","comment_is_top":false,"comment_ctime":1537369438,"is_pvip":false,"replies":[{"id":"9361","content":"å¹¶å‘æƒ…å†µä¸‹å¿…é¡»åˆ©ç”¨æŸç§åŒæ­¥å·¥å…·ï¼Œå¦åˆ™å°±ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¯èƒ½å‡ºç°ä¸å¯æ§çš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537440972,"ip_address":"","comment_id":25585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127304030","product_id":100013101,"comment_content":"func trigger(i int64, fn func()) {<br>\tfor {<br>\t\t&#47;&#47;if i != 10 {<br>\t\t&#47;&#47;\tfmt.Print(&quot;&quot;)<br>\t\t&#47;&#47;}<br><br>\t\tif count == i {<br>\t\t\tfn()<br>\t\t\tcount += 1<br>\t\t\tbreak<br>\t\t}<br>\t}<br>}<br><br>func main() {<br>\tfor i := int64(0); i &lt;= 9; i++ {<br>\t\tgo func(i int64) {<br>\t\t\tfn := func() {<br>\t\t\t\tfmt.Println(i)<br>\t\t\t}<br>\t\t\ttrigger(i, fn)<br>\t\t}(i)<br>\t}<br>\ttrigger(10, func() {})<br>}<br><br>å–æ¶ˆæ³¨é‡Šåä»£ç å¯é¡ºåº 0 ~9 è¾“å‡º. è€Œæ³¨é‡Šååˆ™ä¼šè«åå¡ä¸», æ€€ç–‘æ˜¯ä¸æ˜¯golang runtime é’ˆå¯¹è¿™äº›å¾ªç¯åšäº†äº›ä»€ä¹ˆ,  è€Œä¸”æ„Ÿè§‰æ²¡å¿…è¦åŠ é”.","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424352,"discussion_content":"å¹¶å‘æƒ…å†µä¸‹å¿…é¡»åˆ©ç”¨æŸç§åŒæ­¥å·¥å…·ï¼Œå¦åˆ™å°±ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¯èƒ½å‡ºç°ä¸å¯æ§çš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537440972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":25380,"user_name":"timmy21","can_delete":false,"product_type":"c1","uid":1174860,"ip_address":"","ucode":"9D6DED247B1F38","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/4c/8674b6ad.jpg","comment_is_top":false,"comment_ctime":1537321094,"is_pvip":false,"replies":[{"id":"9369","content":"ä»£ç å·²ç»æ›´æ–°äº†ï¼Œæ¼æ‰äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537442846,"ip_address":"","comment_id":25380,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127255686","product_id":100013101,"comment_content":"æœ‰ä¸€ä¸ªé—®é¢˜ä¸å¤ªæ¸…æ¥šï¼Œå½“iå’Œcountä¸ç›¸ç­‰æ—¶ï¼Œæ‚¨æåˆ°äº†ç¡çœ 1çº³ç§’ï¼Œå¯æ˜¯æˆ‘æ²¡çœ‹åˆ°æœ‰ç›¸å…³çš„sleepè¢«è°ƒç”¨ã€‚è¿™æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424279,"discussion_content":"ä»£ç å·²ç»æ›´æ–°äº†ï¼Œæ¼æ‰äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537442846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329632,"user_name":"NeoMa","can_delete":false,"product_type":"c1","uid":1228079,"ip_address":"","ucode":"9EABAF2DCF0263","user_header":"","comment_is_top":false,"comment_ctime":1641452915,"is_pvip":false,"replies":[{"id":"120119","content":"åœ¨è¿™é‡Œç”¨é”çš„è¯æœ‰äº›é‡äº†ï¼ˆè¯´çš„æ˜¯æ€§èƒ½æ–¹é¢ï¼‰ï¼Œä¸è¿‡ä½¿ç”¨çš„æ–¹å¼åŸºæœ¬æ²¡é—®é¢˜ã€‚é‚£æ¡ defer è¯­å¥å¯ä»¥å»æ‰ï¼Œä»£ç å¯ä»¥è¿™æ ·æ”¹å†™ï¼š<br><br>    <br>    mu.Lock()<br>    local := index<br>    index++<br>    mu.Unlock()<br>    fmt.Println(local)<br>    ch &lt;- local<br><br>å› ä¸ºå³ä½¿ç°åœ¨ defer è¯­å¥åœ¨æ€§èƒ½æ–¹é¢å·²ç»ä¼˜åŒ–å¾ˆå¤šæ¬¡äº†ï¼Œä½†ç»ˆå½’è¿˜æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ã€‚åœ¨è¿™ä¹ˆç®€å•çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥äººä¸ºä¿è¯â€œåœ¨é”å®šæœŸé—´ä¸ä¼šæœ‰ panic â€çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”¨ defer è¯­å¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1641539151,"ip_address":"","comment_id":329632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5936420211","product_id":100013101,"comment_content":"æ‚¨å¥½ï¼Œçœ‹å®Œäº†åé¢çš„sync.Mutexï¼Œå†™äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¯·å¤šå¤šæŒ‡æ­£<br>package main<br><br>import (<br>    &quot;fmt&quot;<br>    &quot;sync&quot;<br>)<br><br>func main() {<br>    ch := make(chan int, 10)<br>    var mu sync.Mutex<br>    var index = 1<br>    for i := 1; i &lt;= 10; i++ {<br>        go func(ch chan int) {<br>            mu.Lock()<br>            defer mu.Unlock()<br>            fmt.Println(index)<br>            index++<br>            ch &lt;- index<br>        }(ch)<br>    }<br>    for j := 1; j &lt;= 10; j++ {<br>        &lt;- ch<br>    }<br>}","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544488,"discussion_content":"åœ¨è¿™é‡Œç”¨é”çš„è¯æœ‰äº›é‡äº†ï¼ˆè¯´çš„æ˜¯æ€§èƒ½æ–¹é¢ï¼‰ï¼Œä¸è¿‡ä½¿ç”¨çš„æ–¹å¼åŸºæœ¬æ²¡é—®é¢˜ã€‚é‚£æ¡ defer è¯­å¥å¯ä»¥å»æ‰ï¼Œä»£ç å¯ä»¥è¿™æ ·æ”¹å†™ï¼š\n\n    \n    mu.Lock()\n    local := index\n    index++\n    mu.Unlock()\n    fmt.Println(local)\n    ch &lt;- local\n\nå› ä¸ºå³ä½¿ç°åœ¨ defer è¯­å¥åœ¨æ€§èƒ½æ–¹é¢å·²ç»ä¼˜åŒ–å¾ˆå¤šæ¬¡äº†ï¼Œä½†ç»ˆå½’è¿˜æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ã€‚åœ¨è¿™ä¹ˆç®€å•çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥äººä¸ºä¿è¯â€œåœ¨é”å®šæœŸé—´ä¸ä¼šæœ‰ panic â€çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”¨ defer è¯­å¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641539151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324145,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1638322099,"is_pvip":false,"replies":[{"id":"117719","content":"ä¹è§‚é”ï¼šæ€»æ˜¯å‡è®¾åœ¨â€œæˆ‘â€æ“ä½œå…±äº«èµ„æºçš„è¿‡ç¨‹ä¸­æ²¡æœ‰â€œå…¶ä»–äººâ€ç«äº‰æ“ä½œã€‚å¦‚æœå‘ç°â€œå…¶ä»–äººâ€ç¡®å®åœ¨æ­¤æœŸé—´ç«äº‰äº†ï¼Œä¹Ÿå°±æ˜¯å‘ç°å‡è®¾å¤±è´¥ï¼Œé‚£å°±ç­‰ä¸€ç­‰å†æ“ä½œã€‚CASåŸå­æ“ä½œåŸºæœ¬ä¸Šèƒ½å¤Ÿä½“ç°å‡ºè¿™ç§æ€æƒ³ã€‚é€šå¸¸ï¼Œä½é¢‘çš„å¹¶å‘æ“ä½œé€‚åˆç”¨ä¹è§‚é”ã€‚ä¹è§‚é”ä¸€èˆ¬ä¼šç”¨æ¯”è¾ƒè½»é‡çº§çš„åŒæ­¥æ–¹æ³•ï¼ˆå¦‚åŸå­æ“ä½œï¼‰ï¼Œä½†ä¹Ÿä¸æ˜¯100%ã€‚æ³¨æ„ï¼Œé«˜é¢‘çš„æ“ä½œç”¨ä¹è§‚é”çš„è¯åè€Œæœ‰å¯èƒ½å½±å“æ€§èƒ½ï¼Œå› ä¸ºå¤šäº†ä¸€æ­¥â€œæ¢æŸ¥æ˜¯å¦æœ‰äººä¸æˆ‘ç«äº‰â€çš„æ“ä½œï¼ˆå½“ç„¶äº†ï¼Œæ ‡å‡†çš„CASæ“ä½œå¯ä»¥æŠŠè¿™ç§å½±å“é™åˆ°æœ€ä½ï¼‰ã€‚<br><br>æ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾åœ¨â€œæˆ‘â€æ“ä½œå…±äº«èµ„æºçš„è¿‡ç¨‹ä¸­ä¸€å®šæœ‰â€œå…¶ä»–äººâ€ç«äº‰æ“ä½œã€‚æ‰€ä»¥â€œæˆ‘â€ä¼šå…ˆç”¨æŸç§åŒæ­¥æ–¹æ³•ï¼ˆå¦‚äº’æ–¥é”ï¼‰ä¿æŠ¤æˆ‘çš„æ“ä½œã€‚è¿™æ ·çš„è¯ï¼Œâ€œæˆ‘â€åœ¨å°†è¦æ“ä½œçš„æ—¶å€™å°±æ²¡å¿…è¦å»æ¢æŸ¥æ˜¯å¦æœ‰äººä¸æˆ‘ç«äº‰ï¼ˆå› ä¸ºâ€œæˆ‘â€æ€»æ˜¯å‡è®¾è‚¯å®šæœ‰ç«äº‰ï¼Œè€Œä¸”å·²ç»åšå¥½äº†ä¿æŠ¤ï¼‰ã€‚é€šå¸¸ï¼Œé¢‘æ¬¡è¾ƒé«˜çš„å¹¶å‘æ“ä½œé€‚åˆç”¨æ‚²è§‚é”ã€‚ä¸è¿‡ï¼Œå¦‚æœå¹¶å‘æ“ä½œçš„é¢‘æ¬¡éå¸¸ä½ï¼Œç”¨æ‚²è§‚é”ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å¯¹æ€§èƒ½å½±å“ä¸å¤§ã€‚<br><br>æœ€åï¼Œä¸€å®šè¦æ³¨æ„ï¼Œä½¿ç”¨ä»»ä½•åŒæ­¥æ–¹æ³•å’Œå¼‚æ­¥æ–¹æ³•éƒ½é¦–å…ˆè¦è€ƒè™‘ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œå¹¶ä¸”è¿˜è¦è€ƒè™‘ç¨‹åºçš„æ€§èƒ½ã€‚ç¨‹åºçš„æ­£ç¡®æ€§ä¸€å®šè¦é åŠŸèƒ½æµ‹è¯•æ¥ä¿éšœï¼Œç¨‹åºçš„æ€§èƒ½ä¸€å®šè¦é æ€§èƒ½æµ‹è¯•æ¥ä¿éšœã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1638421376,"ip_address":"","comment_id":324145,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5933289395","product_id":100013101,"comment_content":"å…¶ä»–åœ°æ–¹ä¹Ÿæœ‰ç±»ä¼¼çš„spinningæ“ä½œï¼Œè¯´é“å…¶å®æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œå…ˆé€šè¿‡åŸå­æ“ä½œè¯»å–å€¼ï¼Œå†åœ¨ä¿®æ”¹å€¼çš„æ—¶å€™æ£€æŸ¥ï¼Œç¬¦åˆæ¡ä»¶æ‰èƒ½ä¿®æ”¹ï¼Œæˆ‘çš„é—®é¢˜æ˜¯è¿™æ®µä»£ç æ˜¯å¦å°±æ˜¯ä¹è§‚é”çš„å®šä¹‰è¯ é‡Šï¼Œè¿™é‡Œä»ç„¶è¯»å–äº†åŸå€¼å†ä¿®æ”¹ï¼Œè€Œæ²¡æœ‰ç›´æ¥ä¿®æ”¹ï¼Œæ˜¯å¦è¶³å¤Ÿä¹è§‚ï¼Œä¸å¤ªç†è§£ä¹è§‚çš„çœŸæ˜¯å«ä¹‰ï¼Œå¦å¤–å¦‚æœç”¨æ‚²è§‚é”çš„è¯åº”è¯¥æ€ä¹ˆå®ç°","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535371,"discussion_content":"ä¹è§‚é”ï¼šæ€»æ˜¯å‡è®¾åœ¨â€œæˆ‘â€æ“ä½œå…±äº«èµ„æºçš„è¿‡ç¨‹ä¸­æ²¡æœ‰â€œå…¶ä»–äººâ€ç«äº‰æ“ä½œã€‚å¦‚æœå‘ç°â€œå…¶ä»–äººâ€ç¡®å®åœ¨æ­¤æœŸé—´ç«äº‰äº†ï¼Œä¹Ÿå°±æ˜¯å‘ç°å‡è®¾å¤±è´¥ï¼Œé‚£å°±ç­‰ä¸€ç­‰å†æ“ä½œã€‚CASåŸå­æ“ä½œåŸºæœ¬ä¸Šèƒ½å¤Ÿä½“ç°å‡ºè¿™ç§æ€æƒ³ã€‚é€šå¸¸ï¼Œä½é¢‘çš„å¹¶å‘æ“ä½œé€‚åˆç”¨ä¹è§‚é”ã€‚ä¹è§‚é”ä¸€èˆ¬ä¼šç”¨æ¯”è¾ƒè½»é‡çº§çš„åŒæ­¥æ–¹æ³•ï¼ˆå¦‚åŸå­æ“ä½œï¼‰ï¼Œä½†ä¹Ÿä¸æ˜¯100%ã€‚æ³¨æ„ï¼Œé«˜é¢‘çš„æ“ä½œç”¨ä¹è§‚é”çš„è¯åè€Œæœ‰å¯èƒ½å½±å“æ€§èƒ½ï¼Œå› ä¸ºå¤šäº†ä¸€æ­¥â€œæ¢æŸ¥æ˜¯å¦æœ‰äººä¸æˆ‘ç«äº‰â€çš„æ“ä½œï¼ˆå½“ç„¶äº†ï¼Œæ ‡å‡†çš„CASæ“ä½œå¯ä»¥æŠŠè¿™ç§å½±å“é™åˆ°æœ€ä½ï¼‰ã€‚\n\næ‚²è§‚é”ï¼šæ€»æ˜¯å‡è®¾åœ¨â€œæˆ‘â€æ“ä½œå…±äº«èµ„æºçš„è¿‡ç¨‹ä¸­ä¸€å®šæœ‰â€œå…¶ä»–äººâ€ç«äº‰æ“ä½œã€‚æ‰€ä»¥â€œæˆ‘â€ä¼šå…ˆç”¨æŸç§åŒæ­¥æ–¹æ³•ï¼ˆå¦‚äº’æ–¥é”ï¼‰ä¿æŠ¤æˆ‘çš„æ“ä½œã€‚è¿™æ ·çš„è¯ï¼Œâ€œæˆ‘â€åœ¨å°†è¦æ“ä½œçš„æ—¶å€™å°±æ²¡å¿…è¦å»æ¢æŸ¥æ˜¯å¦æœ‰äººä¸æˆ‘ç«äº‰ï¼ˆå› ä¸ºâ€œæˆ‘â€æ€»æ˜¯å‡è®¾è‚¯å®šæœ‰ç«äº‰ï¼Œè€Œä¸”å·²ç»åšå¥½äº†ä¿æŠ¤ï¼‰ã€‚é€šå¸¸ï¼Œé¢‘æ¬¡è¾ƒé«˜çš„å¹¶å‘æ“ä½œé€‚åˆç”¨æ‚²è§‚é”ã€‚ä¸è¿‡ï¼Œå¦‚æœå¹¶å‘æ“ä½œçš„é¢‘æ¬¡éå¸¸ä½ï¼Œç”¨æ‚²è§‚é”ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹å¯¹æ€§èƒ½å½±å“ä¸å¤§ã€‚\n\næœ€åï¼Œä¸€å®šè¦æ³¨æ„ï¼Œä½¿ç”¨ä»»ä½•åŒæ­¥æ–¹æ³•å’Œå¼‚æ­¥æ–¹æ³•éƒ½é¦–å…ˆè¦è€ƒè™‘ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œå¹¶ä¸”è¿˜è¦è€ƒè™‘ç¨‹åºçš„æ€§èƒ½ã€‚ç¨‹åºçš„æ­£ç¡®æ€§ä¸€å®šè¦é åŠŸèƒ½æµ‹è¯•æ¥ä¿éšœï¼Œç¨‹åºçš„æ€§èƒ½ä¸€å®šè¦é æ€§èƒ½æµ‹è¯•æ¥ä¿éšœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638421376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295053,"user_name":"ç§‹å¤©","can_delete":false,"product_type":"c1","uid":1057056,"ip_address":"","ucode":"A7E1D953EF7E17","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg","comment_is_top":false,"comment_ctime":1622196140,"is_pvip":true,"replies":[{"id":"107240","content":"ç›¸ä¿¡ä¸å°‘åŒå­¦ä¼šæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘åœ¨è¿™é‡Œå®Œæ•´åœ°è§£é‡Šä¸€ä¸‹ï¼š<br><br>è¿™ä¸Goè¯­è¨€çš„è°ƒåº¦å™¨ä»¥åŠä½ è¿è¡Œä»£ç çš„æœºå™¨æœ‰å…³ã€‚è¿™ä¹Ÿä»ä¾§é¢è¯´æ˜äº†ï¼ŒGoè¯­è¨€è°ƒåº¦å™¨çš„çµæ´»æ€§ï¼Œæˆ–è€…è¯´éšæœºæ€§ã€‚å¯¹äºä½ æˆ‘è€Œè¨€ï¼Œè¿™é‡Œçš„â€œéšæœºæ€§â€çš„æ„æ€æ˜¯ï¼š<br><br>Goè¯­è¨€è°ƒåº¦Gåœ¨Mä¸Šè¿è¡Œï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦è¿›ç¨‹å’Œçº¿ç¨‹åœ¨CPUæ ¸å¿ƒä¸Šè¿è¡Œï¼Œä»¥åŠCPUå¯¹è‡ªèº«æ ¸å¿ƒå’Œå„çº§ç¼“å­˜çš„åˆ©ç”¨å’Œåè°ƒï¼Œè¿™äº›éƒ½ä¸æ˜¯æˆ‘ä»¬è‡ªå·±èƒ½å¤Ÿç›´æ¥æ§åˆ¶çš„ï¼Œæˆ–è€…è¯´æˆ‘ä»¬å³ä½¿çŸ¥é“äº†åŸç†ä¹Ÿæ— æ³•åšå‡ºåŸºäºæ­¤çš„åˆ¤æ–­ï¼ˆåˆ¤æ–­ä»€ä¹ˆæ—¶åˆ»ä¸€å®šä¼šè¿è¡Œä»€ä¹ˆä»£ç ï¼‰ã€‚<br><br>æˆ‘ä»¬ä½œä¸ºåº”ç”¨ç¨‹åºçš„å¼€å‘è€…ï¼Œä¸è®¡ç®—æœºåº•å±‚çš„è½¯ç¡¬ä»¶ä¹‹é—´çš„ä¿¡æ¯å·®å¦‚æ­¤ä¹‹å¤§ã€‚è¿™æ˜¯æˆ‘ä»¬å¿…é¡»ç†è§£çš„ä¸€ä¸ªå…³é”®ç‚¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰ä¼šæƒ³åˆ°ï¼ˆä»¥åŠå¿…é¡»ï¼‰åˆ©ç”¨ç§ç§åŒæ­¥ç¼–ç¨‹å·¥å…·å’Œå¼‚æ­¥ç¼–ç¨‹æ‰‹æ®µæ¥é˜²æ­¢ä»£ç çš„æ— åºæ‰§è¡Œï¼Œä»¥åŠæ›´é‡è¦çš„ï¼Œä¿è¯ç¨‹åºè¿è¡Œçš„æ­£ç¡®æ€§ã€‚<br><br>è¿™å…¶å®å°±æ˜¯æˆ‘æƒ³é€šè¿‡è¿™ä¸ªä¾‹å­å‘Šè¯‰å¤§å®¶çš„ã€‚åœ¨è¿™é‡Œï¼Œæ‰“å°çš„æ˜¯ä¸æ˜¯10å…¶å®ä¸é‡è¦ï¼ˆå®ƒåªæ˜¯ä¸€ä¸ªè¡¨è±¡ï¼‰ï¼Œé‡è¦çš„æ˜¯ï¼Œä¸€ä¸ªGoç¨‹åºä¸­çš„å„ä¸ªgoroutineï¼ˆæˆ–è€…è¯´goå‡½æ•°ï¼‰çš„æ‰§è¡Œé¡ºåºæ˜¯æˆ‘ä»¬æ— æ³•ç¡®å®šçš„ï¼ˆä¹Ÿå°±ä¸Šé¢è¯´çš„â€œéšæœºçš„â€ï¼‰ã€‚è¦æƒ³è®©goå‡½æ•°æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿â€œæ—¢å®Œå…¨å¹¶å‘åˆéƒ¨åˆ†æœ‰åºâ€çš„è¿è¡Œï¼Œé‚£å°±éœ€è¦åˆç†åœ°ä½¿ç”¨åé¢è®²çš„channelï¼ˆé€šé“ï¼‰ï¼Œä»¥åŠå„ç§åŒæ­¥å·¥å…·ã€‚<br><br>æœ€åï¼Œæˆ‘å†ç”¨æœ€ç›´æ¥çš„æ–¹å¼å›ç­”ä¸€ä¸‹ä½ çš„é—®é¢˜ï¼š<br><br>æ‰“å°10ä»£è¡¨ç€ï¼Œç¨‹åºä¸­çš„â€œä¸»goroutineä¸­çš„forè¯­å¥â€å…ˆäºæˆ‘ä»¬åœ¨å…¶ä¸­â€œæ–°å¯ç”¨çš„goroutineâ€æ‰§è¡Œå®Œæˆäº†ï¼Œæ‰€ä»¥å˜é‡içš„å€¼æ‰ä¼šå®šæ ¼åœ¨10è¿™ä¸ªæœ€åçš„æ•°å­—ã€‚<br><br>å¦‚æœæ‰“å°çš„ä¸æ˜¯10ï¼Œæˆ–è€…æ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œå°±è¯´æ˜ï¼Œåœ¨è¿™äº›â€œæ–°å¯ç”¨çš„goroutineâ€å½“ä¸­æœ‰ä¸€äº›å…ˆäºâ€œä¸»goroutineä¸­çš„forè¯­å¥â€æ‰§è¡Œå®Œæˆäº†ã€‚è¿™æ˜¯ç”±Goè¯­è¨€ä¸­çš„è°ƒåº¦å¼•èµ·çš„ã€‚Goè¯­è¨€ä¼šåœ¨è§¦åŠå„ä¸ªè°ƒåº¦ç‚¹ï¼ˆæ¯”å¦‚åœ¨æ‰§è¡Œå„ä¸ªè¯­å¥ä¹‹é—´çš„æ—¶é—´ç¼éš™ï¼‰æ—¶ä»¥â€œé«˜æ•ˆå’Œå…¬å¹³â€ä¸ºåŸºæœ¬åŸåˆ™æ¥é€‰æ‹©â€œåœ¨æ¥ä¸‹æ¥çš„æ—¶åˆ»ï¼Œè¿è¡Œå“ªä¸€ä¸ªgoroutineã€‚<br><br>æˆ‘ä»¬åœ¨ä¸Šé¢è¯´äº†ï¼Œè¿™ä¸ªè°ƒåº¦å¯¹äºä½ æˆ‘è¿™æ ·çš„åº”ç”¨ç¨‹åºå¼€å‘è€…è€Œè¨€å¯ä»¥çœ‹åšæ˜¯â€œéšæœºçš„â€ã€‚å› æ­¤ï¼Œå³ä½¿æƒ…å†µå¤šå˜ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1622446540,"ip_address":"","comment_id":295053,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5917163436","product_id":100013101,"comment_content":"æœ€ä¸Šé¢çš„ä»£ç  åŠ äº†sleep å¹¶ä¸æ˜¯10ä¸ª10 æœ€åçš„ç»“æœ æ¯æ¬¡éƒ½ä¸ä¸€æ ·å•Šï¼Ÿè€å¸ˆ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520927,"discussion_content":"ç›¸ä¿¡ä¸å°‘åŒå­¦ä¼šæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘åœ¨è¿™é‡Œå®Œæ•´åœ°è§£é‡Šä¸€ä¸‹ï¼š\n\nè¿™ä¸Goè¯­è¨€çš„è°ƒåº¦å™¨ä»¥åŠä½ è¿è¡Œä»£ç çš„æœºå™¨æœ‰å…³ã€‚è¿™ä¹Ÿä»ä¾§é¢è¯´æ˜äº†ï¼ŒGoè¯­è¨€è°ƒåº¦å™¨çš„çµæ´»æ€§ï¼Œæˆ–è€…è¯´éšæœºæ€§ã€‚å¯¹äºä½ æˆ‘è€Œè¨€ï¼Œè¿™é‡Œçš„â€œéšæœºæ€§â€çš„æ„æ€æ˜¯ï¼š\n\nGoè¯­è¨€è°ƒåº¦Gåœ¨Mä¸Šè¿è¡Œï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦è¿›ç¨‹å’Œçº¿ç¨‹åœ¨CPUæ ¸å¿ƒä¸Šè¿è¡Œï¼Œä»¥åŠCPUå¯¹è‡ªèº«æ ¸å¿ƒå’Œå„çº§ç¼“å­˜çš„åˆ©ç”¨å’Œåè°ƒï¼Œè¿™äº›éƒ½ä¸æ˜¯æˆ‘ä»¬è‡ªå·±èƒ½å¤Ÿç›´æ¥æ§åˆ¶çš„ï¼Œæˆ–è€…è¯´æˆ‘ä»¬å³ä½¿çŸ¥é“äº†åŸç†ä¹Ÿæ— æ³•åšå‡ºåŸºäºæ­¤çš„åˆ¤æ–­ï¼ˆåˆ¤æ–­ä»€ä¹ˆæ—¶åˆ»ä¸€å®šä¼šè¿è¡Œä»€ä¹ˆä»£ç ï¼‰ã€‚\n\næˆ‘ä»¬ä½œä¸ºåº”ç”¨ç¨‹åºçš„å¼€å‘è€…ï¼Œä¸è®¡ç®—æœºåº•å±‚çš„è½¯ç¡¬ä»¶ä¹‹é—´çš„ä¿¡æ¯å·®å¦‚æ­¤ä¹‹å¤§ã€‚è¿™æ˜¯æˆ‘ä»¬å¿…é¡»ç†è§£çš„ä¸€ä¸ªå…³é”®ç‚¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰ä¼šæƒ³åˆ°ï¼ˆä»¥åŠå¿…é¡»ï¼‰åˆ©ç”¨ç§ç§åŒæ­¥ç¼–ç¨‹å·¥å…·å’Œå¼‚æ­¥ç¼–ç¨‹æ‰‹æ®µæ¥é˜²æ­¢ä»£ç çš„æ— åºæ‰§è¡Œï¼Œä»¥åŠæ›´é‡è¦çš„ï¼Œä¿è¯ç¨‹åºè¿è¡Œçš„æ­£ç¡®æ€§ã€‚\n\nè¿™å…¶å®å°±æ˜¯æˆ‘æƒ³é€šè¿‡è¿™ä¸ªä¾‹å­å‘Šè¯‰å¤§å®¶çš„ã€‚åœ¨è¿™é‡Œï¼Œæ‰“å°çš„æ˜¯ä¸æ˜¯10å…¶å®ä¸é‡è¦ï¼ˆå®ƒåªæ˜¯ä¸€ä¸ªè¡¨è±¡ï¼‰ï¼Œé‡è¦çš„æ˜¯ï¼Œä¸€ä¸ªGoç¨‹åºä¸­çš„å„ä¸ªgoroutineï¼ˆæˆ–è€…è¯´goå‡½æ•°ï¼‰çš„æ‰§è¡Œé¡ºåºæ˜¯æˆ‘ä»¬æ— æ³•ç¡®å®šçš„ï¼ˆä¹Ÿå°±ä¸Šé¢è¯´çš„â€œéšæœºçš„â€ï¼‰ã€‚è¦æƒ³è®©goå‡½æ•°æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿â€œæ—¢å®Œå…¨å¹¶å‘åˆéƒ¨åˆ†æœ‰åºâ€çš„è¿è¡Œï¼Œé‚£å°±éœ€è¦åˆç†åœ°ä½¿ç”¨åé¢è®²çš„channelï¼ˆé€šé“ï¼‰ï¼Œä»¥åŠå„ç§åŒæ­¥å·¥å…·ã€‚\n\næœ€åï¼Œæˆ‘å†ç”¨æœ€ç›´æ¥çš„æ–¹å¼å›ç­”ä¸€ä¸‹ä½ çš„é—®é¢˜ï¼š\n\næ‰“å°10ä»£è¡¨ç€ï¼Œç¨‹åºä¸­çš„â€œä¸»goroutineä¸­çš„forè¯­å¥â€å…ˆäºæˆ‘ä»¬åœ¨å…¶ä¸­â€œæ–°å¯ç”¨çš„goroutineâ€æ‰§è¡Œå®Œæˆäº†ï¼Œæ‰€ä»¥å˜é‡içš„å€¼æ‰ä¼šå®šæ ¼åœ¨10è¿™ä¸ªæœ€åçš„æ•°å­—ã€‚\n\nå¦‚æœæ‰“å°çš„ä¸æ˜¯10ï¼Œæˆ–è€…æ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œå°±è¯´æ˜ï¼Œåœ¨è¿™äº›â€œæ–°å¯ç”¨çš„goroutineâ€å½“ä¸­æœ‰ä¸€äº›å…ˆäºâ€œä¸»goroutineä¸­çš„forè¯­å¥â€æ‰§è¡Œå®Œæˆäº†ã€‚è¿™æ˜¯ç”±Goè¯­è¨€ä¸­çš„è°ƒåº¦å¼•èµ·çš„ã€‚Goè¯­è¨€ä¼šåœ¨è§¦åŠå„ä¸ªè°ƒåº¦ç‚¹ï¼ˆæ¯”å¦‚åœ¨æ‰§è¡Œå„ä¸ªè¯­å¥ä¹‹é—´çš„æ—¶é—´ç¼éš™ï¼‰æ—¶ä»¥â€œé«˜æ•ˆå’Œå…¬å¹³â€ä¸ºåŸºæœ¬åŸåˆ™æ¥é€‰æ‹©â€œåœ¨æ¥ä¸‹æ¥çš„æ—¶åˆ»ï¼Œè¿è¡Œå“ªä¸€ä¸ªgoroutineã€‚\n\næˆ‘ä»¬åœ¨ä¸Šé¢è¯´äº†ï¼Œè¿™ä¸ªè°ƒåº¦å¯¹äºä½ æˆ‘è¿™æ ·çš„åº”ç”¨ç¨‹åºå¼€å‘è€…è€Œè¨€å¯ä»¥çœ‹åšæ˜¯â€œéšæœºçš„â€ã€‚å› æ­¤ï¼Œå³ä½¿æƒ…å†µå¤šå˜ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622446540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3043622,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/71/26/773e6dcb.jpg","nickname":"æ«","note":"","ucode":"2850902F61B46C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579591,"discussion_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯è¯´å¦‚æœæ–°å¯ç”¨çš„goroutineå…ˆäºä¸»goroutineæ‰§è¡Œï¼Œé‚£ç»ˆç«¯å°±ä¼šåœ¨ä¸ä½¿ç”¨sleepå‡½æ•°çš„æƒ…å†µä¸‹å°±ä¼šè¾“å‡ºè¿™äº›å·²ç»æ‰§è¡Œçš„goroutineçš„æ‰§è¡Œç»“æœï¼Œè€Œä¸æ˜¯ä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657542293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":520927,"ip_address":""},"score":579591,"extra":""}]}]},{"had_liked":false,"id":286725,"user_name":"Geek_9b9769","can_delete":false,"product_type":"c1","uid":1312225,"ip_address":"","ucode":"48A1DEC02CFAE3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/tmVLphkQHLxRsAOZOzJNhJKXvAhkvvT8koMjMUpIQbJN1e8Uico1habQvNibvibI14yM7DWVicJIgNriaib9tRv735mg/132","comment_is_top":false,"comment_ctime":1617527358,"is_pvip":false,"replies":[{"id":"104177","content":"å¯ä»¥å€’æ˜¯å¯ä»¥ï¼Œä½†æ˜¯æè¿™ä¹ˆå¤šé€šé“å‡ºæ¥ï¼Œå¤ªé‡äº†ã€‚<br><br>è¿™ç±»åŒæ­¥å·¥å…·ä»é‡åˆ°è½»ï¼šé€šé“ =&gt; è¯»å†™é” =&gt; äº’æ–¥é” =&gt; åŸå­æ“ä½œã€‚<br><br>èƒ½è½»å°½é‡è½»å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1617682925,"ip_address":"","comment_id":286725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5912494654","product_id":100013101,"comment_content":" è€å¸ˆï¼Œæ‚¨çœ‹ä¸‹ï¼Œæˆ‘çš„æ€è·¯æ˜¯ç”¨ä¸€ä¸ªé€šé“æ•°ç»„æ§åˆ¶<br><br>func main() {<br><br>\t&#47;&#47;é¢„å…ˆåˆ›å»º11ä¸ªé€šé“æ•°ç»„,æœ€åä¸€ä¸ªé˜»å¡ä¸»gorouting<br>\tchArr := [11]chan struct{}{}<br>\tfor i := 0; i &lt; 11; i++ {<br>\t\tchArr[i] = make(chan struct{})<br>\t}<br><br>\t&#47;&#47;ä¸é˜»å¡ç¬¬ä¸€ä¸ªé€šé“<br>\tgo func() {<br>\t\tchArr[0] &lt;- struct{}{}<br>\t}()<br><br>\t&#47;&#47;å¼€å§‹å¾ªç¯<br>\tfor i := 0; i &lt; 10; i++ {<br><br>\t\tgo func(i2 int) {<br>\t\t\t&#47;&#47;é˜»å¡å½“å‰é€šé“<br>\t\t\t&lt;-chArr[i2]<br>\t\t\tfmt.Println(i2)<br>\t\t\t&#47;&#47;æ¯æ¬¡æ‰§è¡Œå®Œé€šçŸ¥ä¸‹ä¸€ä¸ªé€šé“<br>\t\t\tchArr[i2+1] &lt;- struct{}{}<br>\t\t}(i)<br>\t}<br><br>\t&#47;&#47;é˜»å¡ä¸»gorouting<br>\t&lt;-chArr[10]<br><br>}","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518075,"discussion_content":"å¯ä»¥å€’æ˜¯å¯ä»¥ï¼Œä½†æ˜¯æè¿™ä¹ˆå¤šé€šé“å‡ºæ¥ï¼Œå¤ªé‡äº†ã€‚\n\nè¿™ç±»åŒæ­¥å·¥å…·ä»é‡åˆ°è½»ï¼šé€šé“ =&amp;gt; è¯»å†™é” =&amp;gt; äº’æ–¥é” =&amp;gt; åŸå­æ“ä½œã€‚\n\nèƒ½è½»å°½é‡è½»å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617682925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285133,"user_name":"lzh","can_delete":false,"product_type":"c1","uid":1336951,"ip_address":"","ucode":"C3D83DF4230109","user_header":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","comment_is_top":false,"comment_ctime":1616637535,"is_pvip":false,"replies":[{"id":"103454","content":"ä¸ä¼šå•Šï¼Œæœ€åï¼Œå½“å‰çš„Mä¹Ÿä¼šä¸è¿™ä¸ªGåˆ†ç¦»ï¼Œç„¶åè¿è¡Œè°ƒåº¦ç¨‹åºå»å¯»æ‰¾å…¶ä»–çš„å¯è¿è¡ŒGã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1616653392,"ip_address":"","comment_id":285133,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5911604831","product_id":100013101,"comment_content":"è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜<br>ã€Šgoå¹¶å‘ç¼–ç¨‹å®æˆ˜-ç¬¬2ç‰ˆã€‹ç¬¬136é¡µä¸­è¯´è¿‡ï¼ŒPå’ŒMç»‘å®šåï¼Œå…¶å†…çš„Gä¼šè¢«Mæ‰§è¡Œï¼Œå¦‚æœGè¿›å…¥ç³»ç»Ÿè°ƒç”¨é˜»å¡ï¼ŒMå’ŒPä¼šè¢«åˆ†ç¦»ï¼ŒPå»æ‰¾å…¶ä»–ç©ºé—²Mæ‰§è¡Œå†…éƒ¨å‰©ä¸‹çš„G<br>é‚£åˆšåˆšé˜»å¡çš„Gå’ŒMå°±ä¸€ç›´è¿™ä¹ˆç»‘å®šäº†å—ï¼Œç›¸å½“äºMå¯¹åº”çš„ç³»ç»Ÿçº¿ç¨‹ä¸€ç›´åœ¨ç­‰ç€å—ï¼Ÿ<br><br>","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517593,"discussion_content":"ä¸ä¼šå•Šï¼Œæœ€åï¼Œå½“å‰çš„Mä¹Ÿä¼šä¸è¿™ä¸ªGåˆ†ç¦»ï¼Œç„¶åè¿è¡Œè°ƒåº¦ç¨‹åºå»å¯»æ‰¾å…¶ä»–çš„å¯è¿è¡ŒGã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616653392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284203,"user_name":"sanmao","can_delete":false,"product_type":"c1","uid":1395689,"ip_address":"","ucode":"D695D88677E3D9","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/e9/bbccf643.jpg","comment_is_top":false,"comment_ctime":1616121376,"is_pvip":false,"replies":[{"id":"103098","content":"æ²¡çœ‹æ‡‚ä½ è¯´çš„ï¼Œ++äº†ä¸¤æ¬¡ï¼Ÿ<br><br>å“¦...æˆ‘å¤§æ¦‚çŸ¥é“äº†ï¼Œcount++ ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼ˆå¯¹ count çš„ç®€å•è¯»å–ä¹Ÿä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™æ¬¡è¿­ä»£æ­£åœ¨ ++ çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªè¿­ä»£å¯èƒ½ä¹Ÿæ‰§è¡Œè¿™å—ä»£ç ã€‚<br><br>æ‰€ä»¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š<br><br>G2 å‘ç° n ä¸è‡ªå·±çš„ i ç›¸ç­‰ï¼Œæ¯”æ–¹è¯´å€¼éƒ½æ˜¯ 2ï¼Œå› æ­¤æ‰§è¡Œäº† fnã€‚éšåï¼ŒG2 è¦æ‰§è¡Œ count++ã€‚ä½†è¿™æ¡è¯­å¥è¿˜æ²¡æ‰§è¡Œå®Œï¼Œæ°å·§ G3 å¼€å§‹æ‰§è¡Œ n := countï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ n çš„å€¼æ˜¯ä¸€ä¸ªå³é 2 åˆé 3 çš„æ•°ï¼ˆå› ä¸º count æ‰€æŒ‡çš„å†…å­˜åœ°å€ä¸Šçš„äºŒè¿›åˆ¶ä½è¿˜æ²¡æœ‰å…¨éƒ¨å˜æ›´å®Œæ¯•ï¼‰ï¼Œæ‰€ä»¥ G3 ï¼ˆä»¥åŠåç»­çš„ Gï¼‰æ°¸è¿œä¸ä¼šæ‰§è¡Œ fnã€‚<br><br>é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼ŒCPUå’Œæ“ä½œç³»ç»Ÿå¯¹è¿™ç§é’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„éå¹¶å‘å®‰å…¨æ“ä½œæ˜¯ä¸ä¿è¯æ­£ç¡®æ€§çš„ã€‚<br><br>å…¶æ¬¡ï¼Œä¸Šè¿°æƒ…å†µè™½ç„¶å±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä½†è¦çŸ¥é“ï¼ŒCPUåˆ‡æ¢ä»»åŠ¡çš„é€Ÿåº¦ç›¸å½“å¿«ï¼Œè¿™ç§â€œå¯¹å¯¹ç¢°â€çš„å°æ¦‚ç‡äº‹ä»¶åœ¨å¦‚æ­¤å¿«çš„é€Ÿåº¦ä¸‹å‘ç”Ÿçš„å¯èƒ½æ€§ä¹Ÿä¸å¯å°è§‘ã€‚<br><br>æœ€åï¼Œä¸€æ—¦è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œé—®é¢˜æ’æŸ¥å’Œå®šä½èµ·æ¥å°±ä¼šç›¸å½“å›°éš¾ï¼Œå› ä¸ºæƒ…å†µéå¸¸ä¸å®¹æ˜“å¤ç°ï¼Œåªèƒ½ç¢°è¿æ°”ï¼Œè¿™æå¤§çš„å¢åŠ äº†ç¨‹åºçš„ç»´æŠ¤æˆæœ¬ã€‚<br><br>æ‰€ä»¥ï¼Œä¸ºäº†ç¨‹åºç»´æŠ¤æˆæœ¬è€ƒè™‘ï¼Œç¼–å†™ç¨‹åºæ—¶å¤šå†™ä¸€ç‚¹ç‚¹ä»£ç ã€ç¨‹åºè¿è¡Œæ—¶æŸå¤±ä¸€ç‚¹ç‚¹æ€§èƒ½ç»å¯¹æ˜¯ä¸Šä¸Šä¹‹ç­–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1616137101,"ip_address":"","comment_id":284203,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5911088672","product_id":100013101,"comment_content":"\tvar count int32 = 0<br>\ttrigger := func(i int32, fn func()) {<br>\t\tfor {<br>\t\t\tif n := count; n == i {<br>\t\t\t\tfn()<br>\t\t\t\t&#47;&#47;atomic.AddInt32(&amp;count, 1)<br>\t\t\t\tcount++<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\t&#47;&#47;time.Sleep(time.Nanosecond)<br>\t\t}<br>\t}<br>@éƒå“¥ é‚£ç§ç†è®ºæƒ…å†µä¼šå‘ç”Ÿ count++ ä¸¤æ¬¡çš„æƒ…å†µï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517269,"discussion_content":"æ²¡çœ‹æ‡‚ä½ è¯´çš„ï¼Œ++äº†ä¸¤æ¬¡ï¼Ÿ\n\nå“¦...æˆ‘å¤§æ¦‚çŸ¥é“äº†ï¼Œcount++ ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼ˆå¯¹ count çš„ç®€å•è¯»å–ä¹Ÿä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™æ¬¡è¿­ä»£æ­£åœ¨ ++ çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªè¿­ä»£å¯èƒ½ä¹Ÿæ‰§è¡Œè¿™å—ä»£ç ã€‚\n\næ‰€ä»¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š\n\nG2 å‘ç° n ä¸è‡ªå·±çš„ i ç›¸ç­‰ï¼Œæ¯”æ–¹è¯´å€¼éƒ½æ˜¯ 2ï¼Œå› æ­¤æ‰§è¡Œäº† fnã€‚éšåï¼ŒG2 è¦æ‰§è¡Œ count++ã€‚ä½†è¿™æ¡è¯­å¥è¿˜æ²¡æ‰§è¡Œå®Œï¼Œæ°å·§ G3 å¼€å§‹æ‰§è¡Œ n := countï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ n çš„å€¼æ˜¯ä¸€ä¸ªå³é 2 åˆé 3 çš„æ•°ï¼ˆå› ä¸º count æ‰€æŒ‡çš„å†…å­˜åœ°å€ä¸Šçš„äºŒè¿›åˆ¶ä½è¿˜æ²¡æœ‰å…¨éƒ¨å˜æ›´å®Œæ¯•ï¼‰ï¼Œæ‰€ä»¥ G3 ï¼ˆä»¥åŠåç»­çš„ Gï¼‰æ°¸è¿œä¸ä¼šæ‰§è¡Œ fnã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼ŒCPUå’Œæ“ä½œç³»ç»Ÿå¯¹è¿™ç§é’ˆå¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„éå¹¶å‘å®‰å…¨æ“ä½œæ˜¯ä¸ä¿è¯æ­£ç¡®æ€§çš„ã€‚\n\nå…¶æ¬¡ï¼Œä¸Šè¿°æƒ…å†µè™½ç„¶å±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä½†è¦çŸ¥é“ï¼ŒCPUåˆ‡æ¢ä»»åŠ¡çš„é€Ÿåº¦ç›¸å½“å¿«ï¼Œè¿™ç§â€œå¯¹å¯¹ç¢°â€çš„å°æ¦‚ç‡äº‹ä»¶åœ¨å¦‚æ­¤å¿«çš„é€Ÿåº¦ä¸‹å‘ç”Ÿçš„å¯èƒ½æ€§ä¹Ÿä¸å¯å°è§‘ã€‚\n\næœ€åï¼Œä¸€æ—¦è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œé—®é¢˜æ’æŸ¥å’Œå®šä½èµ·æ¥å°±ä¼šç›¸å½“å›°éš¾ï¼Œå› ä¸ºæƒ…å†µéå¸¸ä¸å®¹æ˜“å¤ç°ï¼Œåªèƒ½ç¢°è¿æ°”ï¼Œè¿™æå¤§çš„å¢åŠ äº†ç¨‹åºçš„ç»´æŠ¤æˆæœ¬ã€‚\n\næ‰€ä»¥ï¼Œä¸ºäº†ç¨‹åºç»´æŠ¤æˆæœ¬è€ƒè™‘ï¼Œç¼–å†™ç¨‹åºæ—¶å¤šå†™ä¸€ç‚¹ç‚¹ä»£ç ã€ç¨‹åºè¿è¡Œæ—¶æŸå¤±ä¸€ç‚¹ç‚¹æ€§èƒ½ç»å¯¹æ˜¯ä¸Šä¸Šä¹‹ç­–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616137101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603571,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKgNge1sNXIWCFeUOa53cU5Glfw24sjxibBxTiaTb45LmU9bRDlDgBib9goFZXmoKwXTOJ4JMvVHHbiaA/132","nickname":"æ½˜æ—æ—","note":"","ucode":"31576141FE4A1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408279,"discussion_content":"é’ˆå¯¹åŒä¸€ä¸ªiå€¼çš„goç¨‹åªæœ‰ä¸€ä¸ªï¼Œä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635216607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109433,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/b9/825b2411.jpg","nickname":"è¡¡å­","note":"","ucode":"0AED79FC9D14BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377934,"discussion_content":"ç†è®ºä¸Šcount++ä¸å®‰å…¨ï¼Œå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä¹Ÿåªä¼šå°‘åŠ ï¼Œé‚£ç§æƒ…å†µä¼šæœ‰åŠ ä¸¤æ¬¡æƒ…å†µï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622970832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281686,"user_name":"Rico","can_delete":false,"product_type":"c1","uid":2040512,"ip_address":"","ucode":"9EFA5A95F78CCB","user_header":"https://static001.geekbang.org/account/avatar/00/1f/22/c0/177d6750.jpg","comment_is_top":false,"comment_ctime":1614847648,"is_pvip":false,"replies":[{"id":"102262","content":"å·®ä¸å¤šï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š<br><br>1. ä¸è¦æŠŠ wg çš„æŒ‡é’ˆå€¼ä¼ æ¥ä¼ å»ï¼Œç¨‹åºå¤æ‚ä¹‹åå¾ˆå®¹æ˜“è¯¯æ“ä½œã€‚åœ¨è¿™é‡Œå¯ä»¥æŠŠ wg å†™åˆ°å‡½æ•°å¤–è¾¹å»ã€‚<br>2. è¿™é‡Œåªç”¨ if è¯­å¥æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½å› æ¡ä»¶ä¸æ»¡è¶³è€Œé”™å¤±æ‰“å°çš„æœºä¼šï¼Œåº”è¯¥ç”¨ for è¯­å¥ï¼ˆæˆ–è€…è¯´ç”¨è‡ªåˆ¶çš„ç®€æ˜“è‡ªæ—‹é”ï¼‰ã€‚<br><br>ä½ çš„ç­”æ¡ˆåœ¨æ•´ä½“æ€è·¯ä¸Šæ˜¯æ­£ç¡®çš„ã€‚<br><br>å…¶å®è¿™é‡Œçš„æµç¨‹å°±æ˜¯ä¸€ä¸ªâ€œé¡ºåºçš„ä»»åŠ¡åˆ†å‘â€ï¼Œåˆ°â€œä¹±åºçš„æ¡ä»¶åˆ¤æ–­â€ï¼Œå†åˆ°â€œåŒæ­¥æ§åˆ¶ä¸‹çš„æœ‰åºæ‰§è¡Œï¼ˆæ‰“å°ï¼‰â€çš„è¿‡ç¨‹ã€‚è€ƒå¯Ÿçš„æ˜¯å¤§å®¶å¯¹Goå¼‚æ­¥è¯­å¥å’ŒåŒæ­¥å·¥å…·çš„åˆç†ä½¿ç”¨å’Œé…åˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1614855228,"ip_address":"","comment_id":281686,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5909814944","product_id":100013101,"comment_content":"var counter int32<br>func main(){<br><br>\tvar wg sync.WaitGroup<br>\twg.Add(10)<br>    var i int32<br>\tfor i = 0;i&lt;10;i++{<br>\t\tgo printNum(&amp;wg,i)<br>\t\ttime.Sleep(time.Nanosecond)<br>\t}<br><br>}<br><br>func printNum(wg *sync.WaitGroup,i int32){<br>    if i == atomic.LoadInt32(&amp;counter){<br>\t\tfmt.Println(i)<br>\t\tatomic.AddInt32(&amp;counter,1)<br>\t\twg.Done()<br>\t}<br>}<br>---ç»“æœé¡ºåºæ‰“å°å‡º 0-9<br><br>è€å¸ˆï¼Œè¿™ç§æ–¹æ³•æ­£ç¡®ä¸ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516470,"discussion_content":"å·®ä¸å¤šï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\n\n1. ä¸è¦æŠŠ wg çš„æŒ‡é’ˆå€¼ä¼ æ¥ä¼ å»ï¼Œç¨‹åºå¤æ‚ä¹‹åå¾ˆå®¹æ˜“è¯¯æ“ä½œã€‚åœ¨è¿™é‡Œå¯ä»¥æŠŠ wg å†™åˆ°å‡½æ•°å¤–è¾¹å»ã€‚\n2. è¿™é‡Œåªç”¨ if è¯­å¥æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½å› æ¡ä»¶ä¸æ»¡è¶³è€Œé”™å¤±æ‰“å°çš„æœºä¼šï¼Œåº”è¯¥ç”¨ for è¯­å¥ï¼ˆæˆ–è€…è¯´ç”¨è‡ªåˆ¶çš„ç®€æ˜“è‡ªæ—‹é”ï¼‰ã€‚\n\nä½ çš„ç­”æ¡ˆåœ¨æ•´ä½“æ€è·¯ä¸Šæ˜¯æ­£ç¡®çš„ã€‚\n\nå…¶å®è¿™é‡Œçš„æµç¨‹å°±æ˜¯ä¸€ä¸ªâ€œé¡ºåºçš„ä»»åŠ¡åˆ†å‘â€ï¼Œåˆ°â€œä¹±åºçš„æ¡ä»¶åˆ¤æ–­â€ï¼Œå†åˆ°â€œåŒæ­¥æ§åˆ¶ä¸‹çš„æœ‰åºæ‰§è¡Œï¼ˆæ‰“å°ï¼‰â€çš„è¿‡ç¨‹ã€‚è€ƒå¯Ÿçš„æ˜¯å¤§å®¶å¯¹Goå¼‚æ­¥è¯­å¥å’ŒåŒæ­¥å·¥å…·çš„åˆç†ä½¿ç”¨å’Œé…åˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614855228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247945,"user_name":"æ¢è¾‰","can_delete":false,"product_type":"c1","uid":1809024,"ip_address":"","ucode":"07A83A2801E6AE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9a/80/3a8781a4.jpg","comment_is_top":false,"comment_ctime":1599927673,"is_pvip":false,"replies":[{"id":"91126","content":"æœ‰å‡ ä¸ªé—®é¢˜ï¼š<br>1. count æ˜¯å…±äº«å˜é‡ï¼Œå¯¹å®ƒçš„è¯»å†™å¿…é¡»æœ‰åŒæ­¥å·¥å…·çš„ä¿æŠ¤ã€‚<br>2. subChan æ˜¯å¤šä½™çš„ã€‚<br>3. wg.Done() æœ€å¥½å†™åœ¨ defer å‡½æ•°é‡Œï¼Œå¦åˆ™ä¸‡ä¸€å‡ºäº†å¼‚å¸¸ä¼šé”æ­»ç¨‹åºã€‚<br>4. struct{}{} æœ¬èº«å°±æ˜¯ä¸ªå…¨å±€å”¯ä¸€çš„å¸¸é‡ï¼Œæ²¡å¿…è¦å†èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚ <br>5. ä¸ºä»€ä¹ˆéè¦ç”¨é—­åŒ…ï¼Ÿèƒ½ä¸ç”¨é—­åŒ…å°±ä¸è¦ç”¨é—­åŒ…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1599982134,"ip_address":"","comment_id":247945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5894894969","product_id":100013101,"comment_content":"è¯•äº†ä¸€ä¸‹ï¼Œä¸‹é¢ä»£ç å¯ä»¥ï¼š<br>package main<br><br>import &quot;fmt&quot;<br>import &quot;sync&quot;<br>import &quot;time&quot;<br><br>func main() {<br>\twg := sync.WaitGroup{}<br>\tsubChan := make(chan struct {}, 1)<br>\twg.Add(10)<br>\tst := struct{}{}<br>\tsubChan &lt;- st<br>\tfuncPrint := subPrint(subChan, &amp;wg)<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tfuncPrint(i)<br>\t}<br>\twg.Wait()<br>}<br><br>func subPrint(subChan chan struct{}, wg *sync.WaitGroup) func(int) {<br>\tcount := 0<br>\tsubCount := func (sub int) {<br>\t\tfor {<br>\t\t\tif count == sub {<br>\t\t\t\t&lt;-subChan<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t}<br><br>\t\tfmt.Println(&quot;sub : &quot;, sub)<br>\t\tcount++<br>\t\tst := struct{}{}<br>\t\tsubChan &lt;- st<br>\t\twg.Done()<br>\t}<br>\treturn subCount<br>}","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505534,"discussion_content":"æœ‰å‡ ä¸ªé—®é¢˜ï¼š\n1. count æ˜¯å…±äº«å˜é‡ï¼Œå¯¹å®ƒçš„è¯»å†™å¿…é¡»æœ‰åŒæ­¥å·¥å…·çš„ä¿æŠ¤ã€‚\n2. subChan æ˜¯å¤šä½™çš„ã€‚\n3. wg.Done() æœ€å¥½å†™åœ¨ defer å‡½æ•°é‡Œï¼Œå¦åˆ™ä¸‡ä¸€å‡ºäº†å¼‚å¸¸ä¼šé”æ­»ç¨‹åºã€‚\n4. struct{}{} æœ¬èº«å°±æ˜¯ä¸ªå…¨å±€å”¯ä¸€çš„å¸¸é‡ï¼Œæ²¡å¿…è¦å†èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚ \n5. ä¸ºä»€ä¹ˆéè¦ç”¨é—­åŒ…ï¼Ÿèƒ½ä¸ç”¨é—­åŒ…å°±ä¸è¦ç”¨é—­åŒ…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599982134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240450,"user_name":"onlyzzw","can_delete":false,"product_type":"c1","uid":1071832,"ip_address":"","ucode":"A29EB66014EFAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/5a/d8/cb1045ed.jpg","comment_is_top":false,"comment_ctime":1596936377,"is_pvip":false,"replies":[{"id":"88834","content":"è¿™æ˜¯ä¸€ç§â€œå–å·§â€çš„æ–¹å¼ï¼Œä¸å¯å–ã€‚å¼‚æ­¥ä»£ç çš„å¤©æ€§å°±æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šã€‚ä¸€ç§’é’Ÿæ˜¯è¶³å¤Ÿå¦‚æ­¤ç®€å•çš„goroutineå¯åŠ¨å¹¶æ‰§è¡Œäº†ï¼Œä½†çœŸå®çš„æƒ…å†µè¦æ¯”è¿™å¤æ‚çš„å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1597031132,"ip_address":"","comment_id":240450,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5891903673","product_id":100013101,"comment_content":"func main() {<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\ttime.Sleep(time.Duration(1)*time.Second)<br>\t\tgo func() {<br>\t\t\tfmt.Println(i)<br>\t\t}()<br>\t}<br>}<br><br>ç»“æœä¹Ÿèƒ½æŒ‰ç…§é¡ºåºæ‰“å°è¾“å‡ºï¼š1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503448,"discussion_content":"è¿™æ˜¯ä¸€ç§â€œå–å·§â€çš„æ–¹å¼ï¼Œä¸å¯å–ã€‚å¼‚æ­¥ä»£ç çš„å¤©æ€§å°±æ˜¯æ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šã€‚ä¸€ç§’é’Ÿæ˜¯è¶³å¤Ÿå¦‚æ­¤ç®€å•çš„goroutineå¯åŠ¨å¹¶æ‰§è¡Œäº†ï¼Œä½†çœŸå®çš„æƒ…å†µè¦æ¯”è¿™å¤æ‚çš„å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597031132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233565,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1594355631,"is_pvip":false,"replies":[{"id":"86330","content":"countæ˜¯å¤šgoroutineéƒ½èƒ½è®¿é—®åˆ°çš„å˜é‡ï¼Œä¸æ˜¯è¯´ä½ æ„Ÿè§‰ä¸Šä¸ä¼šæœ‰ç«äº‰å°±æ²¡ç«äº‰ï¼Œä½ è¦è€ƒè™‘CPUæŒ‡ä»¤å’Œcacheã€æ ¸å¿ƒé—´çš„é€šè®¯åŠåŒæ­¥ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥å’Œè¡Œä¸ºã€‚<br><br>å¦‚æœæ²¡æœ‰ä»»ä½•åŒæ­¥æªæ–½ï¼Œcount åœ¨ ++ çš„æ—¶å€™æœ‰å¯èƒ½åŠ åˆ°ä¸€åŠå°±è¢«æ’¤ä¸‹CPUäº†ï¼ˆè¿™æ—¶çš„countçš„å€¼å°±ä¸ä¸€å®šæ˜¯ä½ è§„å®šå¥½çš„é‚£äº›äº†ï¼‰ã€‚å¦å¤–ï¼Œå¤šä¸ªCPUçš„cacheä¸­ç¼“å­˜çš„countçš„å€¼ä¹Ÿå¯èƒ½å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™äº›éƒ½æ˜¯éšæ‚£ã€‚CPUçº§åˆ«çš„åŒæ­¥ï¼Œå„çº§cacheé—´çš„åè°ƒï¼Œå…¶æœ€å°ç²’åº¦éƒ½æ˜¯CPUæŒ‡ä»¤ï¼Œå†³ä¸æ˜¯è¯´ç¼–ç¨‹è¯­è¨€çš„è¯­å¥ä¸Šä¸èƒ½å†æ‹†åˆ†å°±ä¸ä¼šæœ‰å¹¶å‘å®‰å…¨é—®é¢˜ã€‚è¿™ä¸¤è€…çš„ç²’åº¦å®Œå…¨ä¸åœ¨ä¸€ä¸ªçº§åˆ«ã€‚<br><br>æ›´å…·ä½“çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥çœ‹æˆ‘å†™çš„é‚£æœ¬ã€ŠGoå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ç¬¬äºŒç‰ˆï¼Œé‡Œè¾¹æè¿°çš„å¹¶å‘æ¨¡å‹æ˜¯å†ä¹…å¼¥æ–°çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1594548924,"ip_address":"","comment_id":233565,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5889322927","product_id":100013101,"comment_content":"trigger := func(i uint32, fn func()) { for { if n := atomic.LoadUint32(&amp;count); n == i { fn() atomic.AddUint32(&amp;count, 1) break } time.Sleep(time.Nanosecond) }}<br><br>ä¸ªäººæ„Ÿè§‰è¿™ä¸ªä¸éœ€è¦ç”¨åŸå­æ“ä½œä¹Ÿå¯ä»¥ï¼Œè™½ç„¶å‘ç”Ÿäº†ç«äº‰ï¼Œåªæ˜¯å¢åŠ äº†åˆ¤æ–­çš„æ¬¡æ•°ï¼Œä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹ï¼Ÿ<br>å¯ä»¥æ”¹æˆè¿™æ ·<br> for {<br>    if i == count {<br>       fn()<br>       count++<br>       break<br>     }<br>}<br><br>ä½œè€…å›å¤: è¿åŸå­æ“ä½œéƒ½ä¸åŠ ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œå…¨å†™æˆ–è¯»å‡ºè„æ•°æ®çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºæ­»é”åœ¨é‚£é‡Œã€‚åœ¨å†™å¹¶å‘ç¨‹åºæ—¶ä¸è¦æœ‰ä¾¥å¹¸å¿ƒç†ã€‚ä¸ç®¡æ¦‚ç‡æœ‰å¤šå¤§ï¼ˆå†µä¸”ä¸ä¼šæ˜¯å°æ¦‚ç‡ï¼‰ï¼Œéƒ½æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚ä¸€æ—¦å‘ç”Ÿï¼ŒæŸå¤±å’Œæˆæœ¬éƒ½æ˜¯ä¸å®¹å°è§‘çš„ã€‚<br><br>å¯¹æ‚¨è¯´çš„å‘ç”Ÿæ­»é”çš„æƒ…å†µä¸å¤ªç†è§£ï¼Œèƒ½ç†è§£è„è¯»çš„æƒ…å†µï¼Œä½†æ˜¯é’ˆå¯¹è¿™ä¸ªé¢˜ç›®æ¥è¯´ï¼Œä¼ è¿‡æ¥çš„iè‚¯å®šæ˜¯0åˆ°10ä¹‹å‰ä¸ä¼šé‡å¤çš„ï¼Œå°±ç®—è¯»åˆ°äº†è„æ•°æ®ï¼Œä¹Ÿå’Œcountçš„å€¼ä¸ä¸€è‡´ï¼Œä¸ä¼šè¿›å…¥åˆ°ifè¯­å¥é‡Œé¢ã€‚è€Œä¸”ä¸å­˜åœ¨å¹¶è¡Œçš„count++ æ“ä½œï¼Œåªæœ‰å¹¶è¡Œçš„è·å–countã€‚æ‰€ä»¥æœ€åè‚¯å®šæ˜¯å·²é¡ºåºè¯»å‡ºæ¥çš„ã€‚ æ‰€ä»¥å¹¶ä¸ç†è§£æ‰€è¯´çš„å¯¼è‡´æ­»é”çš„æƒ…å†µï¼Œèƒ½å¦æŒ‡æ˜ä¸€ç§æƒ…å†µäº§ç”Ÿæ­»é”","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501089,"discussion_content":"countæ˜¯å¤šgoroutineéƒ½èƒ½è®¿é—®åˆ°çš„å˜é‡ï¼Œä¸æ˜¯è¯´ä½ æ„Ÿè§‰ä¸Šä¸ä¼šæœ‰ç«äº‰å°±æ²¡ç«äº‰ï¼Œä½ è¦è€ƒè™‘CPUæŒ‡ä»¤å’Œcacheã€æ ¸å¿ƒé—´çš„é€šè®¯åŠåŒæ­¥ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥å’Œè¡Œä¸ºã€‚\n\nå¦‚æœæ²¡æœ‰ä»»ä½•åŒæ­¥æªæ–½ï¼Œcount åœ¨ ++ çš„æ—¶å€™æœ‰å¯èƒ½åŠ åˆ°ä¸€åŠå°±è¢«æ’¤ä¸‹CPUäº†ï¼ˆè¿™æ—¶çš„countçš„å€¼å°±ä¸ä¸€å®šæ˜¯ä½ è§„å®šå¥½çš„é‚£äº›äº†ï¼‰ã€‚å¦å¤–ï¼Œå¤šä¸ªCPUçš„cacheä¸­ç¼“å­˜çš„countçš„å€¼ä¹Ÿå¯èƒ½å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™äº›éƒ½æ˜¯éšæ‚£ã€‚CPUçº§åˆ«çš„åŒæ­¥ï¼Œå„çº§cacheé—´çš„åè°ƒï¼Œå…¶æœ€å°ç²’åº¦éƒ½æ˜¯CPUæŒ‡ä»¤ï¼Œå†³ä¸æ˜¯è¯´ç¼–ç¨‹è¯­è¨€çš„è¯­å¥ä¸Šä¸èƒ½å†æ‹†åˆ†å°±ä¸ä¼šæœ‰å¹¶å‘å®‰å…¨é—®é¢˜ã€‚è¿™ä¸¤è€…çš„ç²’åº¦å®Œå…¨ä¸åœ¨ä¸€ä¸ªçº§åˆ«ã€‚\n\næ›´å…·ä½“çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥çœ‹æˆ‘å†™çš„é‚£æœ¬ã€ŠGoå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ç¬¬äºŒç‰ˆï¼Œé‡Œè¾¹æè¿°çš„å¹¶å‘æ¨¡å‹æ˜¯å†ä¹…å¼¥æ–°çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594548924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1987829,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlIBYWVBmevjIuaMickvceJ2JX4IHOaibrmEWmia1gM29jhjLCJcYU9lSXLInNlToAbc5Gg/132","nickname":"å¼ ä¼Ÿ","note":"","ucode":"3A45B9536F91E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371367,"discussion_content":"å’Œæ•°æ®åº“çš„äº‹åŠ¡ä¸€è‡´æ€§å¾ˆåƒï¼Œäº‹åŠ¡å¿…é¡»ä¿è¯äº‹åŠ¡æœªæäº¤å‰ï¼Œå…¶ä»–äº‹åŠ¡æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªå€¼çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619748543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1987829,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlIBYWVBmevjIuaMickvceJ2JX4IHOaibrmEWmia1gM29jhjLCJcYU9lSXLInNlToAbc5Gg/132","nickname":"å¼ ä¼Ÿ","note":"","ucode":"3A45B9536F91E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371365,"discussion_content":"å¯ä»¥è¿™æ ·æŠ½è±¡ç†è§£ï¼Œå¦‚æœcount++æ‰§è¡Œåˆ°ä¸€åŠï¼Œå¾—åˆ°äº†100çš„ä¸€ä¸ªå€¼ï¼Œè€Œæ°å¥½å¦ä¸ªgrontine æ­£å¥½è¦æ£€æµ‹100äºæ˜¯ä¹ï¼Œ100å‰é¢çš„å¯èƒ½è¿˜æ²¡æ‰§è¡Œå®Œæˆå°±ï¼Œå…ˆæŠŠ100æ‰“å°å‡ºæ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619748408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563985,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","nickname":"Geek_a8be59","note":"","ucode":"BEC0F57B51DC44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291070,"discussion_content":"è°¢è°¢ ï¼Œè¿™æ ·ä¸€è¯´æˆ‘æ€»ç®—æ˜ç™½äº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594697913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231356,"user_name":"åˆ˜å°è´±","can_delete":false,"product_type":"c1","uid":1199861,"ip_address":"","ucode":"3BCBA391F92828","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/f5/1d3f13f3.jpg","comment_is_top":false,"comment_ctime":1593657139,"is_pvip":false,"replies":[{"id":"85455","content":"è‚‰çœ¼çœ‹ä¸Šå»åº”è¯¥å¯ä»¥ï¼Œä¸è¿‡signalæ²¡å¿…è¦å­˜åœ¨ï¼Œç”¨WaitGroupæ›´ç®€å•é«˜æ•ˆã€‚å¦å¤–ï¼Œé€šé“åšèµ·æ¥è¦æ¯”åŸå­æ“ä½œæ…¢ä¸å°‘ã€‚è¯·è®°ä½ï¼Œé€šé“çš„ä¸»è¦ç›®çš„æ˜¯å¹¶å‘å®‰å…¨åœ°ä¼ é€’æ•°æ®ï¼Œè€Œä¸æ˜¯å­˜å‚¨æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1593668104,"ip_address":"","comment_id":231356,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5888624435","product_id":100013101,"comment_content":"&#47;&#47;è€å¸ˆ  ä¸¤ä¸ªé€šé“å®ç°æ–¹å¼ ä¸çŸ¥é“å¯¹ä¸å¯¹<br>\tch := make(chan int,1)<br>\tsignal := make(chan struct{})<br>\tvar num = 10<br>\tfor i := 0; i &lt; num; i++ {<br>\t\tgo func(i int) {<br>\t\t\tfor  {<br>\t\t\t\t&#47;&#47; å…ˆé˜»å¡åœ¨è¿™é‡Œ<br>\t\t\t\tt := &lt;-ch<br>\t\t\t\tif t == i {<br>\t\t\t\t\tfmt.Printf(&quot;%d\\n&quot;, i)<br>\t\t\t\t\tp := i+1<br>\t\t\t\t\tif p == num {<br>\t\t\t\t\t\t&#47;&#47; ç»“æŸä¿¡å·<br>\t\t\t\t\t\tsignal &lt;- struct{}{}<br>\t\t\t\t\t\tbreak<br>\t\t\t\t\t} else  {<br>\t\t\t\t\t\tch &lt;- p<br>\t\t\t\t\t\tbreak<br>\t\t\t\t\t}<br>\t\t\t\t} else {<br>\t\t\t\t\tch &lt;- t<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}(i)<br>\t}<br><br>\tch &lt;- 0<br><br>\t&lt;- signal","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500271,"discussion_content":"è‚‰çœ¼çœ‹ä¸Šå»åº”è¯¥å¯ä»¥ï¼Œä¸è¿‡signalæ²¡å¿…è¦å­˜åœ¨ï¼Œç”¨WaitGroupæ›´ç®€å•é«˜æ•ˆã€‚å¦å¤–ï¼Œé€šé“åšèµ·æ¥è¦æ¯”åŸå­æ“ä½œæ…¢ä¸å°‘ã€‚è¯·è®°ä½ï¼Œé€šé“çš„ä¸»è¦ç›®çš„æ˜¯å¹¶å‘å®‰å…¨åœ°ä¼ é€’æ•°æ®ï¼Œè€Œä¸æ˜¯å­˜å‚¨æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593668104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228064,"user_name":"æ‰æ¾å£","can_delete":false,"product_type":"c1","uid":1080578,"ip_address":"","ucode":"ED904CE27CD3C4","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/02/4862f849.jpg","comment_is_top":false,"comment_ctime":1592547191,"is_pvip":false,"replies":[{"id":"84680","content":"å½“ç„¶ä¼šå¹³è¡¡ï¼Œè¯¦è§ã€ŠGoå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹è¿™æœ¬ä¹¦ã€‚è‡³äº CPU Cache å¤±æ•ˆï¼Œå°±æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1592989156,"ip_address":"","comment_id":228064,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5887514487","product_id":100013101,"comment_content":"è°ƒåº¦å™¨ä¼šå¹³è¡¡å„ä¸ªGä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å—ï¼Ÿä¼šä¸ä¼šå¯¼è‡´CPUçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcpu cacheå¤±æ•ˆ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498910,"discussion_content":"å½“ç„¶ä¼šå¹³è¡¡ï¼Œè¯¦è§ã€ŠGoå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹è¿™æœ¬ä¹¦ã€‚è‡³äº CPU Cache å¤±æ•ˆï¼Œå°±æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592989156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190715,"user_name":"Cyril","can_delete":false,"product_type":"c1","uid":1024693,"ip_address":"","ucode":"29FFFAC32F911B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/b5/4dc0c109.jpg","comment_is_top":false,"comment_ctime":1584686566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879653862","product_id":100013101,"comment_content":"é‡ç‚¹è®°å½•ï¼š<br><br>Go è°ƒåº¦å™¨åœ¨éœ€è¦çš„æ—¶å€™åªä¼šå¯¹æ­£åœ¨è¿è¡Œçš„ goroutine å‘å‡ºé€šçŸ¥ï¼Œè¯•å›¾è®©å®ƒåœä¸‹æ¥ã€‚ä½†æ˜¯ï¼Œå®ƒå´ä¸ä¼šä¹Ÿä¸èƒ½å¼ºè¡Œè®©ä¸€ä¸ª goroutine åœä¸‹æ¥ã€‚<br><br>æ‰€ä»¥ï¼Œå¦‚æœä¸€æ¡ for è¯­å¥è¿‡äºç®€å•çš„è¯ï¼Œæ¯”å¦‚è¿™é‡Œçš„ for è¯­å¥å°±å¾ˆç®€å•ï¼ˆå› ä¸ºé‡Œé¢åªæœ‰ä¸€æ¡ if è¯­å¥ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çš„ goroutine å°±å¯èƒ½ä¸ä¼šå»æ­£å¸¸å“åº”ï¼ˆæˆ–è€…è¯´æ²¡æœ‰æœºä¼šå“åº”ï¼‰Go è°ƒåº¦å™¨çš„åœæ­¢é€šçŸ¥ã€‚<br><br>å› æ­¤ï¼Œè¿™é‡ŒåŠ ä¸€ä¸ª sleep æ˜¯ä¸ºäº†ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ˆå¦‚ä»»ä½•ç‰ˆæœ¬çš„ Goã€ä»»ä½•è®¡ç®—å¹³å°ä¸‹çš„ Goã€ä»»ä½•çš„ CPU æ ¸å¿ƒæ•°ç­‰ï¼‰ï¼Œå†…å«è¿™æ¡ for è¯­å¥çš„è¿™äº› goroutine éƒ½èƒ½å¤Ÿæ­£å¸¸åœ°å“åº”åœæ­¢é€šçŸ¥ã€‚","like_count":1},{"had_liked":false,"id":180528,"user_name":"waterd","can_delete":false,"product_type":"c1","uid":1499106,"ip_address":"","ucode":"30F4FE973CF221","user_header":"","comment_is_top":false,"comment_ctime":1582306122,"is_pvip":false,"replies":[{"id":"70217","content":"åº”è¯¥æ˜¯demo39ã€‚ä½ å¯ä»¥æŠŠsignçš„å¤§å°è®¾ç½®æˆ1ï¼Œä½†æ˜¯é‚£æ ·çš„è¯å°±ç›¸å½“äºå®Œå…¨ä¸²è¡Œäº†ï¼Œä¹Ÿå°±å¤±å»äº†ä½¿ç”¨goè¯­å¥çš„æ„ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1582459646,"ip_address":"","comment_id":180528,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5877273418","product_id":100013101,"comment_content":"demo38çš„ä»£ç ä¸­signçš„é€šé“å¤§å°å¯ä»¥è®¾ç½®ä¸º1å¯¹å§?","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484695,"discussion_content":"åº”è¯¥æ˜¯demo39ã€‚ä½ å¯ä»¥æŠŠsignçš„å¤§å°è®¾ç½®æˆ1ï¼Œä½†æ˜¯é‚£æ ·çš„è¯å°±ç›¸å½“äºå®Œå…¨ä¸²è¡Œäº†ï¼Œä¹Ÿå°±å¤±å»äº†ä½¿ç”¨goè¯­å¥çš„æ„ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582459646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447220,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLia2EwyyEVs3tWRnMlqaAG7R7HvlW4vGvxthKsicgsCEeXO1qL7mMy6GAzgdkSKcH3c70Qa2hY3JLw/132","nickname":"æ²å¤œæ˜Ÿå…‰","note":"","ucode":"22F699E237B179","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269955,"discussion_content":"è®¾ç½®æˆ1 ï¼Œgoè¯­å¥ä¸­çš„Printï¼ˆiï¼‰ä¹Ÿæ˜¯å¹¶å‘æ‰§è¡Œçš„å§ï¼Œåªä¸è¿‡æ¯ä¸ªgoroutineçš„ç»“æŸéœ€è¦ç­‰å¾…é€šé“äº†ï¼Œå¦‚æœè®¾ç½®æˆ10ï¼Œ10ä¸ªgoroutineçš„ç»“æŸæ˜¯ä¸éœ€è¦ç­‰å¾…çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589968353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174361,"user_name":"MigToLoveYou","can_delete":false,"product_type":"c1","uid":1525620,"ip_address":"","ucode":"7509C573AF4CB3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJzxnS95wOcdxepAOBZxJlvxNAEryDsV7GaJ5dOPHicqqcj1PtSFK4pibqJD03ic0U88jOkvYiaBLCAKg/132","comment_is_top":false,"comment_ctime":1580180720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5875148016","product_id":100013101,"comment_content":"è€å¸ˆå†™çš„ä¾‹å­ç›¸å½“äºç”¨å¼‚æ­¥çš„go routineå®ç°äº†ä¸€ä¸ªå…¨å±€å˜é‡countçš„é€’å¢ï¼Œå¹¶ä¸”è¿™äº›å¸®åŠ©å…¨å±€å˜é‡é€’å¢çš„go routineæ˜¯æŒ‰ç…§å‚æ•°içš„é¡ºåºä¾æ¬¡å¸®åŠ©è¿™ä¸ªå…¨å±€å˜é‡é€’å¢ï¼Œåœ¨è½®åˆ°iè¿™ä¸ªgo routineæ—¶ï¼Œå®ƒé€’å¢å˜é‡countå¹¶ä¸”æ‰“å°å½“å‰çš„countå€¼ã€‚è¿™ä¸ªä¾‹å­è®¾è®¡éå¸¸å·§å¦™ï¼ŒçŸ­å°çš„ä¾‹å­æ¶µç›–äº†éå¸¸å¤šçš„çŸ¥è¯†ç‚¹ã€‚","like_count":1},{"had_liked":false,"id":144242,"user_name":"Jee","can_delete":false,"product_type":"c1","uid":1198458,"ip_address":"","ucode":"B80BBF2D2EB116","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/7a/b567de82.jpg","comment_is_top":false,"comment_ctime":1571881678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866848974","product_id":100013101,"comment_content":"runtime.GOMAXPROCS  runtime.NumCPU runtime.NumGoroutine","like_count":1},{"had_liked":false,"id":120377,"user_name":"é»„ä¼Ÿæ´ª","can_delete":false,"product_type":"c1","uid":1369165,"ip_address":"","ucode":"97331040A49EAD","user_header":"https://static001.geekbang.org/account/avatar/00/14/e4/4d/c7b5f20a.jpg","comment_is_top":false,"comment_ctime":1564848824,"is_pvip":false,"replies":[{"id":"44302","content":"åœ¨æŸäº›è®¡ç®—å¹³å°ä¸‹ï¼Œè¿‡äºç®€å•çš„ for è¯­å¥æœ‰å¯èƒ½ä¼šé€ æˆ CPU æ—¶é—´ç‰‡æ— æ³•è®©å‡ºçš„é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1564972365,"ip_address":"","comment_id":120377,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5859816120","product_id":100013101,"comment_content":"demo40.go æˆ‘æ³¨é‡Šäº†time.Sleep(time.Nanosecond)åï¼Œç¨‹åºå°±åœç€ä¸€ç›´ä¸åŠ¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚æƒ³ä¸æ˜ç™½ä¸ºä»€ä¹ˆ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461306,"discussion_content":"åœ¨æŸäº›è®¡ç®—å¹³å°ä¸‹ï¼Œè¿‡äºç®€å•çš„ for è¯­å¥æœ‰å¯èƒ½ä¼šé€ æˆ CPU æ—¶é—´ç‰‡æ— æ³•è®©å‡ºçš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564972365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73057,"user_name":"Wind","can_delete":false,"product_type":"c1","uid":1211134,"ip_address":"","ucode":"1F16D751DBBAF9","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/fe/9263d515.jpg","comment_is_top":false,"comment_ctime":1551786368,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"5846753664","product_id":100013101,"comment_content":"func main(){<br>    ch := make(chan struct{})<br>    for i:=0; i &lt; 100; i++{<br>        go func(i int){<br>            fmt.Println(i)<br>            ch &lt;- struct{}{}<br>        }(i)<br>        &lt;-ch<br>    }<br>}<br>äº²æµ‹å¯ä»¥ï¼Œè€Œä¸”å¾ªç¯çš„å‰ææ˜¯å¿…é¡»ä¸Šä¸€ä¸ªé€šé“ä¸é˜»å¡çš„æƒ…å†µä¸‹æ‰èƒ½ç»§ç»­ï¼Œè¿™æ ·çš„ç¡®å¯ä»¥ä¿è¯æŒ‰é¡ºåºè¾“å‡º","like_count":1,"discussions":[{"author":{"id":1018685,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/3d/0c3a2fd4.jpg","nickname":"å¶å°”å¤æ´»ä¸‹","note":"","ucode":"18B1D525CD50D3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401580,"discussion_content":"åªæ˜¯å®ç°äº†é¡ºåºè¾“å‡ºæ•°å­—ï¼Œä½†ä¸é¢˜æ„è¦æ±‚çš„ä¸ç¬¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633695342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1557834,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c5/4a/340bda41.jpg","nickname":"æ°´é˜¡å¢¨","note":"","ucode":"87C949F0E295A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341096,"discussion_content":"æ˜ç™½äº†ï¼Œä½ è¿™å®Œå…¨æ˜¯åŒæ­¥é€»è¾‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610288818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1557834,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c5/4a/340bda41.jpg","nickname":"æ°´é˜¡å¢¨","note":"","ucode":"87C949F0E295A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341095,"discussion_content":"è¿™ä¸ªä¾‹å­å¯ä»¥ï¼Ÿï¼Ÿï¼Ÿæ²¡çœ‹æ‡‚è¿™æ€ä¹ˆä¼šå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610288705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1084378,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8b/da/c3c2a324.jpg","nickname":"ç©ºç™½","note":"","ucode":"1E1E05CF8A7B1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322343,"discussion_content":"è¿™æ ·ä¸å°±å˜æˆé˜»å¡åŒæ­¥é€»è¾‘äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604727806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62287,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1548002007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5842969303","product_id":100013101,"comment_content":"æ‰“å¡ï¼š<br>triggerå¤„ç†æŒ‰é¡ºåºè¾“å‡ºï¼Œå¦‚æœä¸ç¬¦åˆcountçš„é€’å¢é¡ºåºé‚£å°±æ­»å¾ªç¯ç€ingï¼›æœ€åä¸€æ¬¡è°ƒç”¨triggeræ˜¯é˜»å¡ä¸»goroutineï¼Œä»¥ä¿è¯ä¸€å®šè¦è¾“å‡ºåˆ°9æ‰ç»“æŸ","like_count":1},{"had_liked":false,"id":25859,"user_name":"cygnus","can_delete":false,"product_type":"c1","uid":1120452,"ip_address":"","ucode":"C60A86E3084754","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/c4/e55fdc1c.jpg","comment_is_top":false,"comment_ctime":1537454737,"is_pvip":false,"replies":[{"id":"9675","content":"demo40.goæˆ‘å°æ”¹è¿›äº†ä¸‹ï¼Œä½ å†è¯•è¯•ã€‚æˆ‘åœ¨æœåŠ¡å™¨ä¸Šä¹Ÿæ²¡å‡ºç°ä½ è¯´çš„è¿™ä¸ªé—®é¢˜ã€‚Goè¯­è¨€å¾ˆæ—©çš„ç‰ˆæœ¬æœ‰å¯èƒ½è¿™æ ·ï¼Œä½†æ˜¯ç°åœ¨è‚¯å®šä¸ä¼šäº†ã€‚ä½ å¯è”ç³»ä¸‹æå®¢æ—¶é—´ç¼–è¾‘ï¼Œè®©å¥¹ä»¬æŠŠä½ åŠ åˆ°ç¾¤é‡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1537691168,"ip_address":"","comment_id":25859,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832422033","product_id":100013101,"comment_content":"â€œâ€â€demo40çš„æ‰§è¡Œç»“æœä¸æ˜¯å¹‚ç­‰çš„ï¼Œç¨‹åºç»å¸¸æ— æ³•æ­£å¸¸ç»“æŸé€€å‡ºï¼Œåªæœ‰æå°‘æ•°å‡ æ¬¡æœ‰æ­£ç¡®è¾“å‡ºã€‚<br>2018-09-19<br>î˜ˆ ä½œè€…å›å¤<br>ä½ åœ¨winä¸‹æ‰§è¡Œçš„å˜›ï¼Ÿâ€œâ€â€œ<br>æ˜¯åœ¨ubuntu 1804ä¸‹æ‰§è¡Œçš„","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424435,"discussion_content":"demo40.goæˆ‘å°æ”¹è¿›äº†ä¸‹ï¼Œä½ å†è¯•è¯•ã€‚æˆ‘åœ¨æœåŠ¡å™¨ä¸Šä¹Ÿæ²¡å‡ºç°ä½ è¯´çš„è¿™ä¸ªé—®é¢˜ã€‚Goè¯­è¨€å¾ˆæ—©çš„ç‰ˆæœ¬æœ‰å¯èƒ½è¿™æ ·ï¼Œä½†æ˜¯ç°åœ¨è‚¯å®šä¸ä¼šäº†ã€‚ä½ å¯è”ç³»ä¸‹æå®¢æ—¶é—´ç¼–è¾‘ï¼Œè®©å¥¹ä»¬æŠŠä½ åŠ åˆ°ç¾¤é‡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537691168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355359,"user_name":"èŠ±è§ç¬‘","can_delete":false,"product_type":"c1","uid":1219485,"ip_address":"å¹¿ä¸œ","ucode":"8A5122BC11E695","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/9d/d487c368.jpg","comment_is_top":false,"comment_ctime":1661314993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661314993","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;sync&quot;<br>\t&quot;time&quot;<br>)<br><br>func main() {<br>\tvar mu sync.Mutex<br>\tq := 0<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func(i int) {<br>\t\t\tmu.Lock()<br>\t\t\tq = q + 1<br>\t\t\tfmt.Println(q,i)<br>\t\t\tmu.Unlock()<br>\t\t}(i)<br>\t}<br>\ttime.Sleep(10*time.Second)<br>}","like_count":0},{"had_liked":false,"id":347707,"user_name":"Jonathan","can_delete":false,"product_type":"c1","uid":1484965,"ip_address":"","ucode":"031E0DC776E8A0","user_header":"https://static001.geekbang.org/account/avatar/00/16/a8/a5/27466113.jpg","comment_is_top":false,"comment_ctime":1654332266,"is_pvip":true,"replies":[{"id":"126790","content":"é—®é¢˜ï¼šè¿™é‡Œçš„ count å±äºå…±äº«å˜é‡ï¼Œç„¶è€Œå®ƒå¹¶æ²¡æœ‰å—åˆ°åº”ç”¨çš„è¯»&#47;å†™ä¿æŠ¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1654495616,"ip_address":"","comment_id":347707,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1654332266","product_id":100013101,"comment_content":"è®©å¹¶è¡Œçš„ goroutine æŒ‰ç…§æŸä¸€ä¸ªæ¡ä»¶é¡ºåºæ‰§è¡Œï¼Œä¸»è¦æ˜¯å¤šä¸ªgoroutineæœ‰ä¸€ä¸ªå…±åŒçš„åˆ¤æ–­æ¡ä»¶ã€‚åªéœ€è¦å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡å³å¯ï¼Œä¸éœ€è¦ç”¨åŸå­ç±»å‹ä¹Ÿèƒ½åšåˆ°ï¼Œå› ä¸ºåˆ¤æ–­æ¡ä»¶åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªgoroutineä¼šç¬¦åˆè¦æ±‚ã€‚<br><br>package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;time&quot;<br>)<br><br>func main() {<br>\tcount := 0<br>\tfor i := 0; i &lt; 100; i++ {<br>\t\tgo func(i int) {<br>\t\t\tfor {<br>\t\t\t\tif count == i {<br>\t\t\t\t\tfmt.Println(i)<br>\t\t\t\t\tcount += 1<br>\t\t\t\t\tbreak<br>\t\t\t\t} else {<br>\t\t\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}(i)<br>\t}<br>\ttime.Sleep(time.Second * 5)<br>}<br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574956,"discussion_content":"é—®é¢˜ï¼šè¿™é‡Œçš„ count å±äºå…±äº«å˜é‡ï¼Œç„¶è€Œå®ƒå¹¶æ²¡æœ‰å—åˆ°åº”ç”¨çš„è¯»/å†™ä¿æŠ¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654495616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346256,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1217554,"ip_address":"","ucode":"C5A540BC5A60B9","user_header":"https://static001.geekbang.org/account/avatar/00/12/94/12/15558f28.jpg","comment_is_top":false,"comment_ctime":1652948934,"is_pvip":false,"replies":[{"id":"126632","content":"ä¸é”™ã€‚é€šé“æ˜¯æ¯”è¾ƒé‡çš„åŒæ­¥&#47;å¼‚æ­¥å·¥å…·ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¼ é€’â€œæ¶ˆæ¯â€ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å•çº¯åšåŒæ­¥çš„è¯ï¼Œä¼˜å…ˆè€ƒè™‘åŸå­æ“ä½œå’Œé”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1653893227,"ip_address":"","comment_id":346256,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652948934","product_id":100013101,"comment_content":"å—åˆ°è€å¸ˆçš„å¯å‘ï¼Œæˆ‘ç”¨å•çº¯çš„é€šé“å»å®ç°äº†ä¸€ä¸‹ï¼Œåªæ˜¯ä»£ç çš„ä¼˜é›…æ€§å’Œæ¶ˆè€—æ¯”è€å¸ˆçš„å¤§<br>func Comp(i, max int, c, out chan int) {<br>\tfor {<br>\t\tin := &lt;-c<br>\t\tif i == in {<br>\t\t\tfmt.Println(i)<br>\t\t\tin++<br>\t\t\tif in == max {<br>\t\t\t\tout &lt;- in<br>\t\t\t} else {<br>\t\t\t\tc &lt;- in<br>\t\t\t}<br>\t\t\tbreak<br>\t\t} else {<br>\t\t\tc &lt;- in<br>\t\t\ttime.Sleep(10 * time.Millisecond)<br>\t\t}<br>\t}<br><br>}<br>func main() {<br>\tinChan := make(chan int, 1)<br>\toutChan := make(chan int, 1)<br>\tinChan &lt;- 0<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func(i int, max int) {<br>\t\t\tComp(i, max, inChan, outChan)<br>\t\t}(i, 10)<br>\t}<br><br>\t&lt;-outChan<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574189,"discussion_content":"ä¸é”™ã€‚é€šé“æ˜¯æ¯”è¾ƒé‡çš„åŒæ­¥/å¼‚æ­¥å·¥å…·ï¼Œä¸»è¦çš„ç›®çš„æ˜¯ä¼ é€’â€œæ¶ˆæ¯â€ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å•çº¯åšåŒæ­¥çš„è¯ï¼Œä¼˜å…ˆè€ƒè™‘åŸå­æ“ä½œå’Œé”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653893227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342620,"user_name":"Ll","can_delete":false,"product_type":"c1","uid":2035323,"ip_address":"","ucode":"72F7F5907BE4AB","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0e/7b/800784a9.jpg","comment_is_top":false,"comment_ctime":1650366850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650366850","product_id":100013101,"comment_content":"\taction := func(i int) {<br>\t\tfmt.Println(&quot;ç¬¬&quot;+strconv.Itoa(i+1)+&quot;ä¸ªå­åç¨‹è¦ç¬¬&quot;+strconv.Itoa(i+1)+&quot;ä¸ªæ‰§è¡Œ&quot;)<br>\t}<br>\twg := sync.WaitGroup{}<br>\tvar actionNum uint32 = 0<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\twg.Add(1)<br>\t\tgo func(i int) {<br>\t\t\tfor {<br>\t\t\t\tif n := atomic.LoadUint32(&amp;actionNum); n == uint32(i) {<br>\t\t\t\t\tatomic.AddUint32(&amp;actionNum, 1)<br>\t\t\t\t\taction(i)<br>\t\t\t\t\tbreak<br>\t\t\t\t}<br>\t\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t\t}<br>\t\t\twg.Done()<br>\t\t}(i)<br>\t}<br>\tfmt.Println(&quot;è¿™é‡Œæœ‰å¯èƒ½åœ¨æŸäº›å­åç¨‹ä¹‹å‰æ‰§è¡Œ&quot;)<br>\twg.Wait()","like_count":0},{"had_liked":false,"id":333498,"user_name":"å°å˜Ÿå˜Ÿ","can_delete":false,"product_type":"c1","uid":1285055,"ip_address":"","ucode":"1584DD1402502D","user_header":"https://static001.geekbang.org/account/avatar/00/13/9b/bf/a76eadff.jpg","comment_is_top":false,"comment_ctime":1644388100,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644388100","product_id":100013101,"comment_content":"forå¾ªç¯ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ i := i,   è¿™ç§ä¹Ÿå¯ä»¥è®©go func è·å–åˆ°æ­£å¸¸å˜é‡å€¼","like_count":0},{"had_liked":false,"id":329175,"user_name":"ç¬¦ä½³æˆfjc","can_delete":false,"product_type":"c1","uid":2875604,"ip_address":"","ucode":"DAC86F7BBF8085","user_header":"https://static001.geekbang.org/account/avatar/00/2b/e0/d4/63647ae9.jpg","comment_is_top":false,"comment_ctime":1641196699,"is_pvip":false,"replies":[{"id":"119914","content":"ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„æ™®é€šæ•°æ®è¯»å†™éƒ½ä¸èƒ½ä¿è¯åŸå­æ€§å•Šï¼Œéƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¿æŠ¤æªæ–½çš„ã€‚<br><br>è¿™æ¡è¯­å¥ atomic.LoadUint32(&amp;count) çš„å«ä¹‰æ˜¯ï¼Œåœ¨è®¿é—®å­˜æœ‰ count å€¼çš„å­˜å‚¨ç©ºé—´æ—¶ä¿è¯åŸå­æ€§çš„è¯»å–ã€‚<br><br>è‡³äºåç»­æŠŠè¿™é¡¹æ•°æ®ä¸æ ‡è¯†ç¬¦ n ç»‘å®šï¼Œé‚£å°±æ˜¯å¦ä¸€ä»¶äº‹äº†ã€‚å¦‚æœ n ä¹Ÿä»£è¡¨ç€å…±äº«èµ„æºï¼Œé‚£ä¹ˆåœ¨èµ‹ç»™å®ƒå€¼çš„æ—¶å€™ï¼Œæˆ–è€…è¯´åœ¨æŠŠæŸé¡¹æ•°æ®ä¸ n ç»‘å®šçš„æ—¶å€™ï¼Œä¹Ÿåº”è¯¥æ‰‹åŠ¨æ–½åŠ ä¿æŠ¤æªæ–½ã€‚<br><br>ç›¸å¯¹åº”çš„ï¼Œn := count æ²¡æœ‰ä»»ä½•çš„ä¿æŠ¤æªæ–½ï¼Œå®ƒæ˜¯éå¹¶å‘å®‰å…¨çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1641267155,"ip_address":"","comment_id":329175,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641196699","product_id":100013101,"comment_content":"1ï¼Œgolangè¯»å–æ•°æ®éƒ½ä¸æ˜¯åŸå­æ“ä½œï¼Ÿ<br>2ï¼Œn := atomic.LoadUint32(&amp;count)ï¼ŒæŠŠä¸€ä¸ªåŸå­æ“ä½œå¾—åˆ°çš„ä¸´æ—¶å˜é‡èµ‹å€¼ç»™n å’Œ ç›´æ¥æŠŠcountæ‹·è´ç»™næœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543679,"discussion_content":"ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„æ™®é€šæ•°æ®è¯»å†™éƒ½ä¸èƒ½ä¿è¯åŸå­æ€§å•Šï¼Œéƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¿æŠ¤æªæ–½çš„ã€‚\n\nè¿™æ¡è¯­å¥ atomic.LoadUint32(&amp;count) çš„å«ä¹‰æ˜¯ï¼Œåœ¨è®¿é—®å­˜æœ‰ count å€¼çš„å­˜å‚¨ç©ºé—´æ—¶ä¿è¯åŸå­æ€§çš„è¯»å–ã€‚\n\nè‡³äºåç»­æŠŠè¿™é¡¹æ•°æ®ä¸æ ‡è¯†ç¬¦ n ç»‘å®šï¼Œé‚£å°±æ˜¯å¦ä¸€ä»¶äº‹äº†ã€‚å¦‚æœ n ä¹Ÿä»£è¡¨ç€å…±äº«èµ„æºï¼Œé‚£ä¹ˆåœ¨èµ‹ç»™å®ƒå€¼çš„æ—¶å€™ï¼Œæˆ–è€…è¯´åœ¨æŠŠæŸé¡¹æ•°æ®ä¸ n ç»‘å®šçš„æ—¶å€™ï¼Œä¹Ÿåº”è¯¥æ‰‹åŠ¨æ–½åŠ ä¿æŠ¤æªæ–½ã€‚\n\nç›¸å¯¹åº”çš„ï¼Œn := count æ²¡æœ‰ä»»ä½•çš„ä¿æŠ¤æªæ–½ï¼Œå®ƒæ˜¯éå¹¶å‘å®‰å…¨çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641267155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324383,"user_name":"vash_ace","can_delete":false,"product_type":"c1","uid":1128044,"ip_address":"","ucode":"057B4EC8850187","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqmEvxVYib6zYId0bUFdt7ogolM4blZllpzaU1HIju63ib4cut4xHdm4ibTxG8vPoEJEwq5KwBdpkKibw/132","comment_is_top":false,"comment_ctime":1638410858,"is_pvip":false,"replies":[{"id":"117716","content":"ä½ æ€ä¹ˆçŸ¥é“ count åœ¨æŸä¸€æ—¶åˆ»ä¸€å®šæ˜¯æŸä¸ªå®Œæ•´çš„å€¼å‘¢ï¼Ÿå¦‚æœå®ƒåœ¨è¢«ä¿®æ”¹åˆ°ä¸€åŠçš„æ—¶å€™è¢«è¯»å–å‘¢ï¼Ÿåœ¨æŸäº›æœºå™¨ä¸Šç¡®å®æœ‰å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„ã€‚ï¼ˆä½ æ‰€å‡è®¾çš„â€œcount çš„å€¼ä¸€å®šä¼šæ˜¯ä¸€ä¸ªèŒƒå›´åœ¨ [0, 10) çš„æ•´æ•°â€å…¶å®æ˜¯ä¸æˆç«‹çš„ï¼‰<br><br>å¦å¤–ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœæŸä¸ª goroutine é”™è¿‡äº† n==i è¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆå®ƒå°†æ°¸è¿œæ²¡æœ‰æ‰“å°åºå·çš„æœºä¼šã€‚<br><br>æ‰€ä»¥ï¼Œä¸è¦å­˜åœ¨ä¾¥å¹¸å¿ƒç†ï¼Œè®¿é—®å…±äº«èµ„æºçš„æ‰€æœ‰æ“ä½œéƒ½ä¸€å®šè¦æœ‰ç›¸åº”çš„ä¿æŠ¤ï¼Œå¦åˆ™ä¸€æ—¦ä¸Šçº¿åå‘ç”Ÿé—®é¢˜ï¼Œä½ å®šä½é—®é¢˜å°†ä¼šéå¸¸éå¸¸å›°éš¾ï¼ˆè¿™å°†ä¼šæ˜¯å™©æ¢¦ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1638418792,"ip_address":"","comment_id":324383,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638410858","product_id":100013101,"comment_content":"if n := atomic.LoadUint32(&amp;count); n == i <br>è€å¸ˆï¼Œåœ¨å¤šä¸ªgoé¡ºåºæ‰“å°çš„ä¾‹å­ä¸­ï¼Œæˆ‘è§‰å¾—atomic.LoadUint32(&amp;count);å®Œå…¨æ²¡å¿…è¦ï¼Œå› ä¸ºä½ æœ‰n==i(è¿™ä¸ªiç›¸å½“äºçº¿ç¨‹IDäº†ï¼Œæ˜¯å›ºå®šçš„)è¿™ä¸ªé€»è¾‘æ§åˆ¶ç€ï¼Œå¹¶å‘è¯»countå€¼ï¼Œé¡¶å¤šæ˜¯è·å–ä¸åˆ°æœ€æ–°çš„countå€¼(å› ä¸ºifä¸­çš„atomic count++ä¿è¯äº†)ï¼Œç„¶åsleepè€Œå·²ï¼Œç­‰å¾…ä¸‹ä¸€è½®çš„å¹¶å‘è¯»å–ã€‚æˆ‘ä¸çŸ¥é“è¿™æ ·ç†è§£ï¼Œå¯¹ä¸å¯¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535361,"discussion_content":"ä½ æ€ä¹ˆçŸ¥é“ count åœ¨æŸä¸€æ—¶åˆ»ä¸€å®šæ˜¯æŸä¸ªå®Œæ•´çš„å€¼å‘¢ï¼Ÿå¦‚æœå®ƒåœ¨è¢«ä¿®æ”¹åˆ°ä¸€åŠçš„æ—¶å€™è¢«è¯»å–å‘¢ï¼Ÿåœ¨æŸäº›æœºå™¨ä¸Šç¡®å®æœ‰å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„ã€‚ï¼ˆä½ æ‰€å‡è®¾çš„â€œcount çš„å€¼ä¸€å®šä¼šæ˜¯ä¸€ä¸ªèŒƒå›´åœ¨ [0, 10) çš„æ•´æ•°â€å…¶å®æ˜¯ä¸æˆç«‹çš„ï¼‰\n\nå¦å¤–ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœæŸä¸ª goroutine é”™è¿‡äº† n==i è¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆå®ƒå°†æ°¸è¿œæ²¡æœ‰æ‰“å°åºå·çš„æœºä¼šã€‚\n\næ‰€ä»¥ï¼Œä¸è¦å­˜åœ¨ä¾¥å¹¸å¿ƒç†ï¼Œè®¿é—®å…±äº«èµ„æºçš„æ‰€æœ‰æ“ä½œéƒ½ä¸€å®šè¦æœ‰ç›¸åº”çš„ä¿æŠ¤ï¼Œå¦åˆ™ä¸€æ—¦ä¸Šçº¿åå‘ç”Ÿé—®é¢˜ï¼Œä½ å®šä½é—®é¢˜å°†ä¼šéå¸¸éå¸¸å›°éš¾ï¼ˆè¿™å°†ä¼šæ˜¯å™©æ¢¦ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638418792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1128044,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqmEvxVYib6zYId0bUFdt7ogolM4blZllpzaU1HIju63ib4cut4xHdm4ibTxG8vPoEJEwq5KwBdpkKibw/132","nickname":"vash_ace","note":"","ucode":"057B4EC8850187","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535611,"discussion_content":"æˆ‘æ˜¯javaç”¨æˆ·ï¼Œä½†æˆ‘çŒœæƒ³golangä¹Ÿä¼šæœ‰ç±»ä¼¼å†…å­˜å±éšœçš„æ¦‚å¿µå§ï¼Œæ‰€ä»¥æˆ‘ä¸çŸ¥é“è€å¸ˆæ‚¨è¯´çš„ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¯»å–ä¸åˆ°å®Œæ•´çš„countå€¼å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638495603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322892,"user_name":"Ben","can_delete":false,"product_type":"c1","uid":1252353,"ip_address":"","ucode":"70351D4FAE47F7","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/01/5aaaf5b6.jpg","comment_is_top":false,"comment_ctime":1637648737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637648737","product_id":100013101,"comment_content":"```<br>func orderRoutine() {<br>\tcount := uint32(0) &#47;&#47;ä¿¡å·é‡<br>\ttrigger := func(n uint32, fn func()) {<br>\t\tfor {<br>\t\t\tif nc := atomic.LoadUint32(&amp;count); n == nc {<br>\t\t\t\tfn()<br>\t\t\t\tatomic.AddUint32(&amp;count, 1) &#47;&#47;ä¿¡å·çš„å€¼æ€»æ˜¯ä¸‹ä¸€ä¸ªå¯ä»¥è°ƒç”¨æ‰“å°å‡½æ•°çš„goå‡½æ•°çš„åºå·<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\ttime.Sleep(time.Nanosecond) &#47;&#47;è¿›å…¥ä¸‹ä¸€ä¸ªè¿­ä»£<br>\t\t}<br>\t}<br><br>\tprint := func(ii int) {<br>\t\tfn := func() {<br>\t\t\tfmt.Println(ii)<br>\t\t}<br>\t\ttrigger(uint32(ii), fn) &#47;&#47; å®‰å…¨è¿›è¡Œå¹¶å‘æ‰“å°<br>\t}<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo print(i)<br>\t}<br><br>\ttrigger(uint32(10), func() {}) &#47;&#47; ç¡®ä¿countè¾¾åˆ°10åé€€å‡º<br>}<br>```","like_count":0},{"had_liked":false,"id":311796,"user_name":"5-åˆ˜æ–°æ³¢(Arvin)","can_delete":false,"product_type":"c1","uid":1174199,"ip_address":"","ucode":"DBD135D2587A93","user_header":"https://static001.geekbang.org/account/avatar/00/11/ea/b7/1a18a39d.jpg","comment_is_top":false,"comment_ctime":1631464453,"is_pvip":false,"replies":[{"id":"112982","content":"åˆ«æ€¥ï¼Œæ¥ç€å¾€åçœ‹ã€‚<br><br>è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç»™å¤§å®¶æ¼”ç¤º goroutine çš„â€œè¿è¡Œæ—¶æœºçš„ä¸ç¡®å®šæ€§â€ï¼Œè¿˜æ²¡æœ‰è®²åˆ° channel å’Œå„ç§åŒæ­¥å·¥å…·ã€‚å¦å¤–ï¼Œè¿™é‡Œä¹Ÿè€ƒå¯Ÿå’Œå±•ç¤ºäº†ä¸€ä¸‹æœ€åŸºæœ¬çš„åŒæ­¥æ‰‹æ®µï¼ˆå¾ˆå¤šåŒæ­¥å·¥å…·éƒ½å«æœ‰â€œè‡ªæ—‹â€çš„é€»è¾‘ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1631512578,"ip_address":"","comment_id":311796,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631464453","product_id":100013101,"comment_content":"å¼‚æ­¥æ”¹åŒæ­¥ï¼Œæ„Ÿè§‰triggerå‡½æ•°è‡ªæ—‹åˆ©ç”¨ç‡ä¸é«˜å“‡","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526748,"discussion_content":"åˆ«æ€¥ï¼Œæ¥ç€å¾€åçœ‹ã€‚\n\nè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç»™å¤§å®¶æ¼”ç¤º goroutine çš„â€œè¿è¡Œæ—¶æœºçš„ä¸ç¡®å®šæ€§â€ï¼Œè¿˜æ²¡æœ‰è®²åˆ° channel å’Œå„ç§åŒæ­¥å·¥å…·ã€‚å¦å¤–ï¼Œè¿™é‡Œä¹Ÿè€ƒå¯Ÿå’Œå±•ç¤ºäº†ä¸€ä¸‹æœ€åŸºæœ¬çš„åŒæ­¥æ‰‹æ®µï¼ˆå¾ˆå¤šåŒæ­¥å·¥å…·éƒ½å«æœ‰â€œè‡ªæ—‹â€çš„é€»è¾‘ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631512578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281710,"user_name":"Rico","can_delete":false,"product_type":"c1","uid":2040512,"ip_address":"","ucode":"9EFA5A95F78CCB","user_header":"https://static001.geekbang.org/account/avatar/00/1f/22/c0/177d6750.jpg","comment_is_top":false,"comment_ctime":1614854297,"is_pvip":false,"replies":[{"id":"102310","content":"å°é—®é¢˜ï¼šé€šé“ç®—æ˜¯æ¯”è¾ƒé‡çš„å·¥å…·ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ›´è½»ä¸€äº›çš„å·¥å…·ã€‚<br><br>å¤§é—®é¢˜ï¼šâ€œcounter1 == iâ€è¿™é‡Œï¼Œå¦‚æœè¦ä¿æŠ¤ counter1 å°±è¦ä¿æŠ¤å®Œå…¨ï¼Œè¯»çš„æ—¶å€™ä¹Ÿè¦ç”¨åŸå­æ“ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1614923478,"ip_address":"","comment_id":281710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1614854297","product_id":100013101,"comment_content":"package main<br><br>import (<br>   &quot;fmt&quot;<br>   &quot;sync&#47;atomic&quot;<br>   &quot;time&quot;<br>)<br><br>&#47;&#47; å¯ç”¨goroutine,ä½¿ç”¨ channelæ§åˆ¶,æŒ‰é¡ºåºæ‰“å°å‡º0-9<br>var counter1 int32<br><br>func main(){<br>   var i int32<br>   coutCh := make(chan struct{},1)<br>   coutCh &lt;- struct{}{}<br><br>   for i= 0;i&lt;10;i++{<br>      go printfNum(i,coutCh)<br>      time.Sleep(time.Nanosecond)<br>   }<br><br>}<br>func printfNum(i int32,ch chan struct{})  {<br>   for  {<br>      if counter1 == i {<br>         &lt;- ch<br>         fmt.Println(i)<br>         atomic.AddInt32(&amp;counter1,1)<br>         ch &lt;- struct{}{}<br>         return<br>      }<br><br>   }<br><br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516479,"discussion_content":"å°é—®é¢˜ï¼šé€šé“ç®—æ˜¯æ¯”è¾ƒé‡çš„å·¥å…·ï¼Œè¿™é‡Œå¯ä»¥ç”¨æ›´è½»ä¸€äº›çš„å·¥å…·ã€‚\n\nå¤§é—®é¢˜ï¼šâ€œcounter1 == iâ€è¿™é‡Œï¼Œå¦‚æœè¦ä¿æŠ¤ counter1 å°±è¦ä¿æŠ¤å®Œå…¨ï¼Œè¯»çš„æ—¶å€™ä¹Ÿè¦ç”¨åŸå­æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614923478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247950,"user_name":"æ¢è¾‰","can_delete":false,"product_type":"c1","uid":1809024,"ip_address":"","ucode":"07A83A2801E6AE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9a/80/3a8781a4.jpg","comment_is_top":false,"comment_ctime":1599929390,"is_pvip":false,"replies":[{"id":"91127","content":"ä¸è¦ä¸ºäº†ä½¿ç”¨é—­åŒ…è€Œé—­åŒ…ï¼Œå°½é‡ç®€åŒ–ç¨‹åºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1599982176,"ip_address":"","comment_id":247950,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599929390","product_id":100013101,"comment_content":"åˆšå­¦ä¸€ä¸ªæœˆï¼Œè€å¸ˆçš„è¯¾ç¨‹æœ‰äº›éš¾æ‡‚ï¼Œæˆ‘ä½¿ç”¨äº†é—­åŒ…ï¼Œæµ‹è¯•ä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°æ•ˆæœï¼Œä»£ç å¦‚ä¸‹ï¼Œè¯·è€å¸ˆæŒ‡æ­£ï¼š<br>package main<br><br>import &quot;fmt&quot;<br>import &quot;sync&quot;<br>import &quot;time&quot;<br><br>func main() {<br>\twg := sync.WaitGroup{}<br>\twg.Add(10)<br>\tfuncPrint := subPrint(&amp;wg)<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func(x int) {<br>\t\t\tfuncPrint(x)<br>\t\t}(i)<br>\t}<br>\twg.Wait()<br>}<br><br>func subPrint(wg *sync.WaitGroup) func(int) {<br>\tcount := 0<br>\tsubChan := make(chan struct {}, 1)<br>\tst := struct{}{}<br>\tsubChan &lt;- st<br>\tsubCount := func (sub int) {<br>\t\tfor {<br>\t\t\tif count == sub {<br>\t\t\t\t&lt;-subChan<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t}<br><br>\t\tfmt.Println(&quot;sub : &quot;, sub)<br>\t\tcount++<br>\t\tst := struct{}{}<br>\t\tsubChan &lt;- st<br>\t\twg.Done()<br>\t}<br>\treturn subCount<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505538,"discussion_content":"ä¸è¦ä¸ºäº†ä½¿ç”¨é—­åŒ…è€Œé—­åŒ…ï¼Œå°½é‡ç®€åŒ–ç¨‹åºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599982176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247948,"user_name":"æ¢è¾‰","can_delete":false,"product_type":"c1","uid":1809024,"ip_address":"","ucode":"07A83A2801E6AE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9a/80/3a8781a4.jpg","comment_is_top":false,"comment_ctime":1599928095,"is_pvip":false,"replies":[{"id":"91130","content":"è¿™ä¸ªæˆ‘å°±ä¸é‡å¤è¯´äº†ï¼Œé—®é¢˜ç±»ä¼¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1599982242,"ip_address":"","comment_id":247948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599928095","product_id":100013101,"comment_content":"ä½¿ç”¨é—­åŒ…çš„æ–¹å¼ä¹Ÿå¯ä»¥ï¼Œå¤æ‚äº†äº›ï¼Œä»£ç å¦‚ä¸‹ï¼Œæµ‹è¯•è¿‡ï¼Œæ˜¯å¯ä»¥çš„ï¼š<br>package main<br><br>import &quot;fmt&quot;<br>import &quot;sync&quot;<br>import &quot;time&quot;<br><br>func main() {<br>\twg := sync.WaitGroup{}<br>\tsubChan := make(chan struct {}, 1)<br>\twg.Add(10)<br>\tst := struct{}{}<br>\tsubChan &lt;- st<br>\tfuncPrint := subPrint(subChan, &amp;wg)<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tfuncPrint(i)<br>\t}<br>\twg.Wait()<br>}<br><br>func subPrint(subChan chan struct{}, wg *sync.WaitGroup) func(int) {<br>\tcount := 0<br>\tsubCount := func (sub int) {<br>\t\tfor {<br>\t\t\tif count == sub {<br>\t\t\t\t&lt;-subChan<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t}<br><br>\t\tfmt.Println(&quot;sub : &quot;, sub)<br>\t\tcount++<br>\t\tst := struct{}{}<br>\t\tsubChan &lt;- st<br>\t\twg.Done()<br>\t}<br>\treturn subCount<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505537,"discussion_content":"è¿™ä¸ªæˆ‘å°±ä¸é‡å¤è¯´äº†ï¼Œé—®é¢˜ç±»ä¼¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599982242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240212,"user_name":"å°å¥•","can_delete":false,"product_type":"c1","uid":1171471,"ip_address":"","ucode":"5294DD5895D602","user_header":"https://static001.geekbang.org/account/avatar/00/11/e0/0f/12e08ce9.jpg","comment_is_top":false,"comment_ctime":1596789421,"is_pvip":false,"replies":[{"id":"88729","content":"å› ä¸ºè¿™äº› goroutine å‡ ä¹åœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥ counter çš„å€¼çš„æ—¶å€™å°±å‘ç°ç¬¦åˆè‡ªå·±çš„æœŸæœ›ï¼ˆæ ¹æœ¬å°±æ²¡æœ‰å†å¾ªç¯æ£€æŸ¥çš„å¿…è¦ï¼‰ã€‚åˆ«å¿˜äº†ï¼ŒCPUæ—¶é’Ÿé‚£æ˜¯æå¿«çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1596862229,"ip_address":"","comment_id":240212,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596789421","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;sync&#47;atomic&quot;<br>\t&quot;time&quot;<br>)<br><br>var counter int32<br><br>func trigger(i int32)  {<br>\tfor {<br>\t\tif atomic.LoadInt32(&amp;counter) == i {<br>\t\t\tfmt.Println(i)<br>\t\t\tatomic.AddInt32(&amp;counter, 1)<br>\t\t\tbreak<br>\t\t}<br>\t\ttime.Sleep(time.Second)<br>\t}<br>}<br><br>func main() {<br>\tfor i:=0; i&lt;10; i++ {<br>\t\tgo trigger(int32(i))<br>\t}<br>\ttrigger(int32(10))<br>}<br>æŒ‰æˆ‘çš„ç†è§£ï¼ŒæŠ›å¼€åˆ›å»º10ä¸ªgoroutineçš„è¿‡ç¨‹ä¸è®¡ï¼Œæ­¤å®ç°ï¼Œç›¸å½“äºåˆ›å»º10ä¸ªç­‰å¾…å™¨ï¼Œé€šè¿‡åŸå­æ“ä½œå…±äº«ä¸€ä¸ªcounterå€¼ï¼Œå„ç­‰å¾…å™¨åˆ†åˆ«è¿›è¡Œå¾ªç¯åŒ¹é…ï¼Œå¦‚æœcounterå€¼ä¸è‡ªèº«çš„iå€¼ç›¸åŒå°±è¿›è¡Œæ‰“å°ã€å¢åŠ counterå€¼å¹¶é€€å‡ºè‡ªèº«å¾ªç¯ï¼Œé‚£æ­£å¸¸æ¥è¯´åº”è¯¥æ˜¯10ç§’é’Ÿç»“æŸï¼Œä¸ºä»€ä¹ˆå®é™…è¿è¡Œéƒ½ä¼šä½äº10ç§’ï¼Œæœ‰æ—¶å€™2ç§’å°±å¤„ç†å®Œäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503375,"discussion_content":"å› ä¸ºè¿™äº› goroutine å‡ ä¹åœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥ counter çš„å€¼çš„æ—¶å€™å°±å‘ç°ç¬¦åˆè‡ªå·±çš„æœŸæœ›ï¼ˆæ ¹æœ¬å°±æ²¡æœ‰å†å¾ªç¯æ£€æŸ¥çš„å¿…è¦ï¼‰ã€‚åˆ«å¿˜äº†ï¼ŒCPUæ—¶é’Ÿé‚£æ˜¯æå¿«çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596862229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236094,"user_name":"Geek_17ce06","can_delete":false,"product_type":"c1","uid":2066975,"ip_address":"","ucode":"7EA9ECC3C88FF6","user_header":"","comment_is_top":false,"comment_ctime":1595314188,"is_pvip":false,"replies":[{"id":"87317","content":"ä½ å¥½ï¼Œè¿™é‡Œè€ƒå¯Ÿçš„æ˜¯ï¼šæ€æ ·æ§åˆ¶å¤šä¸ªgoroutineçš„æ‰§è¡Œé¡ºåºï¼Œè€Œä¸æ˜¯ç»“æœçš„æ‰“å°é¡ºåºã€‚å¦‚æœè€ƒå¯Ÿçš„æ˜¯åè€…ï¼Œé‚£æœªå…ä¹Ÿå¤ªå°å„¿ç§‘äº†ã€‚ï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1595388434,"ip_address":"","comment_id":236094,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1595314188","product_id":100013101,"comment_content":"package main<br><br>import (<br>&quot;fmt&quot;<br>&quot;sync&quot;<br>)<br><br>type fn func()<br>type AAA struct {<br>id int<br>do fn<br>}<br><br>func main() {<br>slice := make([]fn, 10)<br>waitCh := make(chan AAA, 10)<br>var wg sync.WaitGroup<br>for i := 0; i &lt; 10; i++ {<br>wg.Add(1)<br>go func(i int, wg *sync.WaitGroup) {<br>defer wg.Done()<br>fn := func() {<br>fmt.Println(i)<br>}<br>waitCh &lt;- AAA{<br>id: i,<br>do: fn,<br>}<br>}(i, &amp;wg)<br>}<br>wg.Wait()<br>close(waitCh)<br>for aaa := range waitCh {<br>slice[aaa.id] = aaa.do<br>}<br>for _, do := range slice {<br>do()<br>}<br>}<br><br>ä½œè€…å›å¤: ç»•è¿œäº†ã€‚<br><br>éƒè€å¸ˆæ‚¨å¥½,è¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡æ–°æ³¨å†Œä¸ªè´¦å·æ¥çœ‹36è®²,å› ä¸ºä¹‹å‰è¯•çœ‹çš„7å¤©å·²ç»åˆ°æœŸäº†å“ˆå“ˆå“ˆ,å› ä¸ºåˆšåˆšæ¯•ä¸šå…œé‡Œå›Šä¸­ç¾æ¶©,æˆ‘çš„ç†è§£æ˜¯è¿™æ ·å­çš„,é—®é¢˜çš„æœ¬è´¨æ˜¯å¯¹å¹¶å‘ç¨‹åºå‘å‡ºå,æ§åˆ¶è¿”å›çš„é¡ºåº,é‚£ä¹ˆæˆ‘å°±æƒ³åˆ°å…ˆå»º10ä¸ªæ§½,å½“æŸä¸ªgoç¨‹ä»»åŠ¡å®Œæˆåå°±æŠŠç»“æœè¿”å›åˆ°ä¸è‡ªå·±idå¯¹åº”çš„é‚£ä¸ªæ§½ä¸­,å½“æ‰€æœ‰çš„goç¨‹éƒ½å®Œæˆäº†ä¹‹åä¸æ˜¯æŒ‰ç…§goç¨‹è¿”å›çš„é¡ºåºæ‰“å°,è€Œæ˜¯æŒ‰ç…§æ§½çš„é¡ºåºæ‰“å°,è¿™æ ·å°±å®ç°äº†æ§åˆ¶.æ¯”ç”¨åŸå­æ“ä½œçš„å¥½å¤„åœ¨äºgoç¨‹è¿”å›çš„æ—¶å€™æ²¡æœ‰é˜»å¡.åœ¨æ€§èƒ½æµ‹è¯•ä¸­è¡¨ç°ä¹Ÿå¥½ä¸€ç‚¹.<br>BenchmarkAtomic-8 100 12360024 ns&#47;op<br>BenchmarkAAA-8 390 4312883 ns&#47;op","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501939,"discussion_content":"ä½ å¥½ï¼Œè¿™é‡Œè€ƒå¯Ÿçš„æ˜¯ï¼šæ€æ ·æ§åˆ¶å¤šä¸ªgoroutineçš„æ‰§è¡Œé¡ºåºï¼Œè€Œä¸æ˜¯ç»“æœçš„æ‰“å°é¡ºåºã€‚å¦‚æœè€ƒå¯Ÿçš„æ˜¯åè€…ï¼Œé‚£æœªå…ä¹Ÿå¤ªå°å„¿ç§‘äº†ã€‚ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595388434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066975,"avatar":"","nickname":"Geek_17ce06","note":"","ucode":"7EA9ECC3C88FF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292975,"discussion_content":"é¢  å‡†å¤‡é¢è¯•é¢˜é­”æ€”äº†ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595400807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233278,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1594277881,"is_pvip":false,"replies":[{"id":"86217","content":"è¿åŸå­æ“ä½œéƒ½ä¸åŠ ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œå…¨å†™æˆ–è¯»å‡ºè„æ•°æ®çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºæ­»é”åœ¨é‚£é‡Œã€‚åœ¨å†™å¹¶å‘ç¨‹åºæ—¶ä¸è¦æœ‰ä¾¥å¹¸å¿ƒç†ã€‚ä¸ç®¡æ¦‚ç‡æœ‰å¤šå¤§ï¼ˆå†µä¸”ä¸ä¼šæ˜¯å°æ¦‚ç‡ï¼‰ï¼Œéƒ½æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚ä¸€æ—¦å‘ç”Ÿï¼ŒæŸå¤±å’Œæˆæœ¬éƒ½æ˜¯ä¸å®¹å°è§‘çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1594354585,"ip_address":"","comment_id":233278,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1594277881","product_id":100013101,"comment_content":"trigger := func(i uint32, fn func()) { for { if n := atomic.LoadUint32(&amp;count); n == i { fn() atomic.AddUint32(&amp;count, 1) break } time.Sleep(time.Nanosecond) }}<br><br>ä¸ªäººæ„Ÿè§‰è¿™ä¸ªä¸éœ€è¦ç”¨åŸå­æ“ä½œä¹Ÿå¯ä»¥ï¼Œè™½ç„¶å‘ç”Ÿäº†ç«äº‰ï¼Œåªæ˜¯å¢åŠ äº†åˆ¤æ–­çš„æ¬¡æ•°ï¼Œä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹ï¼Ÿ<br>å¯ä»¥æ”¹æˆè¿™æ ·<br> for {<br>    if  i == count {<br>       fn()<br>       count++<br>       break<br>     }<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500970,"discussion_content":"è¿åŸå­æ“ä½œéƒ½ä¸åŠ ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°ä¸å®Œå…¨å†™æˆ–è¯»å‡ºè„æ•°æ®çš„æƒ…å†µï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºæ­»é”åœ¨é‚£é‡Œã€‚åœ¨å†™å¹¶å‘ç¨‹åºæ—¶ä¸è¦æœ‰ä¾¥å¹¸å¿ƒç†ã€‚ä¸ç®¡æ¦‚ç‡æœ‰å¤šå¤§ï¼ˆå†µä¸”ä¸ä¼šæ˜¯å°æ¦‚ç‡ï¼‰ï¼Œéƒ½æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚ä¸€æ—¦å‘ç”Ÿï¼ŒæŸå¤±å’Œæˆæœ¬éƒ½æ˜¯ä¸å®¹å°è§‘çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594354585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563985,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","nickname":"Geek_a8be59","note":"","ucode":"BEC0F57B51DC44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290138,"discussion_content":"ç†è§£è„è¯»çš„æƒ…å†µï¼Œä½†æ˜¯é’ˆå¯¹è¿™ä¸ªé¢˜ç›®æ¥è¯´ï¼Œä¼ è¿‡æ¥çš„iè‚¯å®šæ˜¯0åˆ°10ä¹‹å‰ä¸ä¼šé‡å¤çš„ï¼Œå°±ç®—è¯»åˆ°äº†è„æ•°æ®ï¼Œä¹Ÿå’Œcountçš„å€¼ä¸ä¸€è‡´ï¼Œä¸ä¼šè¿›å…¥åˆ°ifè¯­å¥é‡Œé¢ã€‚è€Œä¸”ä¸å­˜åœ¨å¹¶è¡Œçš„count++ æ“ä½œï¼Œåªæœ‰å¹¶è¡Œçš„è·å–countã€‚æ‰€ä»¥æœ€åè‚¯å®šæ˜¯å·²é¡ºåºè¯»å‡ºæ¥çš„ã€‚ æ‰€ä»¥å¹¶ä¸ç†è§£æ‰€è¯´çš„å¯¼è‡´æ­»é”çš„æƒ…å†µï¼Œèƒ½å¦æŒ‡æ˜ä¸€ç§æƒ…å†µäº§ç”Ÿæ­»é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594355531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219201,"user_name":"æ²å¤œæ˜Ÿå…‰","can_delete":false,"product_type":"c1","uid":1447220,"ip_address":"","ucode":"22F699E237B179","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLia2EwyyEVs3tWRnMlqaAG7R7HvlW4vGvxthKsicgsCEeXO1qL7mMy6GAzgdkSKcH3c70Qa2hY3JLw/132","comment_is_top":false,"comment_ctime":1589965705,"is_pvip":false,"replies":[{"id":"81060","content":"ä½ è¯´çš„ä¿¡å·æ˜¯æŒ‡â€œæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·â€å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œä½ å¯ä»¥ç”¨&quot;os&#47;signal&quot;åŒ…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1590032985,"ip_address":"","comment_id":219201,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589965705","product_id":100013101,"comment_content":"æˆ‘æ„Ÿè§‰ç¬¬äºŒä¸ªé—®é¢˜çš„åº”ç”¨åœºæ™¯åœ¨äºï¼Œå¦‚æœå¤šä¸ªgoroutineä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–ï¼Œæˆ–è€…ä¿¡å·ä¾èµ–ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å®ç°æ•°æ®çš„é€šä¿¡ã€‚è€Œéƒè€å¸ˆçš„åšæ³•å°±æ˜¯å…¸å‹çš„â€œcommunicate by sharing memoryâ€ =ã€‚=   ï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½é€šè¿‡chanåœ¨å¤šä¸ªgoroutineä¹‹é—´ä¼ é€’ä¿¡å·ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495713,"discussion_content":"ä½ è¯´çš„ä¿¡å·æ˜¯æŒ‡â€œæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·â€å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œä½ å¯ä»¥ç”¨&amp;quot;os/signal&amp;quot;åŒ…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590032985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173282,"user_name":"2018","can_delete":false,"product_type":"c1","uid":1107371,"ip_address":"","ucode":"4C2CD47AD70177","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/ab/6fab2492.jpg","comment_is_top":false,"comment_ctime":1579493352,"is_pvip":true,"replies":[{"id":"67254","content":"åœ¨æ—§ç‰ˆçš„Goè¯­è¨€ä¸­ï¼ˆå°¤å…¶æ˜¯Winä¸‹çš„ï¼‰ï¼Œè¿™ç§ç®€å•çš„å¾ªç¯å¯èƒ½ä¼šä¸€ç›´å æ®CPUä¸æ”¾ã€‚æ‰€ä»¥è¿™é‡Œä¸ºäº†æ‰€æœ‰è¯»è€…éƒ½èƒ½å¤ŸæˆåŠŸè¿è¡Œç¤ºä¾‹ï¼Œæˆ‘æ‰åŠ äº†è¿™ä¸€è¡Œã€‚<br><br>å®é™…å¼€å‘å½“ä¸­ï¼Œé™¤éGoè¯­è¨€ç‰ˆæœ¬å¾ˆæ—§å¹¶ä¸”forè¯­å¥è¶…çº§ç®€å•ï¼Œå¦åˆ™ä¸ç”¨æ·»åŠ é‚£è¡Œä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1579576374,"ip_address":"","comment_id":173282,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1579493352","product_id":100013101,"comment_content":"åœ¨triggeræ–¹æ³•ä¸­ï¼Œé€€å‡ºå¾ªç¯ç¡çœ ä¸€çº³ç§’æ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªgoroutineè¿›å…¥triggeræ–¹æ³•å˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482021,"discussion_content":"åœ¨æ—§ç‰ˆçš„Goè¯­è¨€ä¸­ï¼ˆå°¤å…¶æ˜¯Winä¸‹çš„ï¼‰ï¼Œè¿™ç§ç®€å•çš„å¾ªç¯å¯èƒ½ä¼šä¸€ç›´å æ®CPUä¸æ”¾ã€‚æ‰€ä»¥è¿™é‡Œä¸ºäº†æ‰€æœ‰è¯»è€…éƒ½èƒ½å¤ŸæˆåŠŸè¿è¡Œç¤ºä¾‹ï¼Œæˆ‘æ‰åŠ äº†è¿™ä¸€è¡Œã€‚\n\nå®é™…å¼€å‘å½“ä¸­ï¼Œé™¤éGoè¯­è¨€ç‰ˆæœ¬å¾ˆæ—§å¹¶ä¸”forè¯­å¥è¶…çº§ç®€å•ï¼Œå¦åˆ™ä¸ç”¨æ·»åŠ é‚£è¡Œä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579576374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107371,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/ab/6fab2492.jpg","nickname":"2018","note":"","ucode":"4C2CD47AD70177","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":148344,"discussion_content":"æ„Ÿè°¢è€å¸ˆè§£æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579698648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146887,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1572686872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572686872","product_id":100013101,"comment_content":"å¯ä»¥é€šè¿‡strigerå‡½æ•°ï¼Œæ§åˆ¶goroutineçš„æ‰§è¡Œé¡ºåºã€‚","like_count":0},{"had_liked":false,"id":110408,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1562250266,"is_pvip":false,"replies":[{"id":"40103","content":"signi &lt;- signNum","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1562252061,"ip_address":"","comment_id":110408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562250266","product_id":100013101,"comment_content":"package main<br><br>import (<br>    &quot;fmt&quot;<br>    &quot;time&quot;<br><br>)<br><br>type test func(int)<br>func main() {<br>    var num = 1000<br>    var signi = make(chan int,1)<br>    signi&lt;-0<br>    for i:=0;i&lt;num;i++ {<br><br>        go func(i int) {<br>            for {<br>                signNum :=&lt;-signi<br>                if signNum == i {<br>                    fmt.Println(i)<br>                    signi&lt;-i+1<br>                    break<br>                }<br>                signi &lt;- signNum<br>                time.Sleep(time.Nanosecond)<br>            }<br>        }(i)<br>    }<br>    for {<br>        signNum :=&lt;-signi<br>        if signNum == num {<br>            fmt.Println(&quot;Program finished!&quot;)<br>            break;<br>        }<br>        signi&lt;-signNum<br>        time.Sleep(time.Nanosecond)<br>    }<br><br><br>}<br><br><br>å°±æ˜¯ä¸ºäº†è®©ä»–è¾“å‡ºä¸ä¹±å‘€ã€‚åˆšå¼€å§‹æˆ‘å¾€é€šé“é‡Œæ”¾äº†0ï¼Œåªæœ‰0è¢«æ‰“å°å‡ºæ¥äº†æ‰ä¼šæŠŠæ•°å­—åŠ 1æ”¾è¿›é€šé“ã€‚å°±æ˜¯è¯´èƒ½è¢«ç¬¬ä¸€ä¸ªæ‰“å°å‡ºæ¥çš„å°±æ˜¯0.  ç¬¬äºŒä¸ª1ä»¥æ­¤ç±»æ¨ï¼Œæ€ä¹ˆä¼šä¹±å‘¢ã€‚   å¯èƒ½è‡ªå·±äº†è§£ä¸å¤Ÿï¼","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456864,"discussion_content":"signi &amp;lt;- signNum","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562252061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110365,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1562242675,"is_pvip":false,"replies":[{"id":"40099","content":"ä½ æŠŠåºå·ä» signNum æ‹¿å‡ºæ¥ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±çš„åºå·ï¼Œå¦‚æœä¸æ˜¯å†æ”¾å›å»ã€‚è¿™æ ·è‚¯å®šä¼šä¹±å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1562249832,"ip_address":"","comment_id":110365,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562242675","product_id":100013101,"comment_content":"è€å®æ‚¨å¥½ï¼Œæ ¹æ®æ‚¨æä¾›çš„ æˆ‘ç”¨chanæ”¹é€ äº†ä¸€ä¸‹ ï¼Œæ˜¯ä¸æ˜¯å’Œæ‚¨è¿™ä¸ªåŒæ ·çš„æ•ˆæœ<br>package main<br><br>import (<br>    &quot;fmt&quot;<br>    &quot;time&quot;<br><br>)<br><br>type test func(int)<br>func main() {<br>    var num = 1000<br>    var signi = make(chan int,1)<br>    signi&lt;-0<br>    for i:=0;i&lt;num;i++ {<br><br>        go func(i int) {<br>            for {<br>                signNum :=&lt;-signi<br>                if signNum == i {<br>                    fmt.Println(i)<br>                    signi&lt;-i+1<br>                    break<br>                }<br>                signi &lt;- signNum<br>                time.Sleep(time.Nanosecond)<br>            }<br>        }(i)<br>    }<br>    for {<br>        signNum :=&lt;-signi<br>        if signNum == num {<br>            fmt.Println(&quot;Program finished!&quot;)<br>            break;<br>        }<br>        signi&lt;-signNum<br>        time.Sleep(time.Nanosecond)<br>    }<br><br><br>}<br><br><br>æ ¹æ®æ‚¨çš„å›ç­”è¯´é¡ºåºå¾ˆæœ‰å¯èƒ½ä¼šä¹±ï¼Œèƒ½ä¸èƒ½æŒ‡ç‚¹ä¸€ä¸‹é‚£ä¸ªåœ°æ–¹å¯èƒ½ä¼šæ‰“å°ä¹±ï¼ŒçœŸçš„çœ‹ä¸å‡ºæ¥","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456842,"discussion_content":"ä½ æŠŠåºå·ä» signNum æ‹¿å‡ºæ¥ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±çš„åºå·ï¼Œå¦‚æœä¸æ˜¯å†æ”¾å›å»ã€‚è¿™æ ·è‚¯å®šä¼šä¹±å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109470,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1562038478,"is_pvip":false,"replies":[{"id":"39851","content":"ä½ è¿™æ ·å¾ˆå¯èƒ½ä¼šæŠŠé¡ºåºæä¹±ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1562156851,"ip_address":"","comment_id":109470,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562038478","product_id":100013101,"comment_content":"è€å®æ‚¨å¥½ï¼Œæ ¹æ®æ‚¨æä¾›çš„ æˆ‘ç”¨chanæ”¹é€ äº†ä¸€ä¸‹ ï¼Œæ˜¯ä¸æ˜¯å’Œæ‚¨è¿™ä¸ªåŒæ ·çš„æ•ˆæœ<br>package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;time&quot;<br><br>)<br><br>type test func(int)<br>func main() {<br>\tvar num = 1000<br>\tvar signi = make(chan int,1)<br>\tsigni&lt;-0<br>\tfor i:=0;i&lt;num;i++ {<br><br>\t\tgo func(i int) {<br>\t\t\tfor {<br>\t\t\t\tsignNum :=&lt;-signi<br>\t\t\t\tif signNum == i {<br>\t\t\t\t\tfmt.Println(i)<br>\t\t\t\t\tsigni&lt;-i+1<br>\t\t\t\t\tbreak<br>\t\t\t\t}<br>\t\t\t\tsigni &lt;- signNum<br>\t\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t\t}<br>\t\t}(i)<br>\t}<br>\tfor {<br>\t\tsignNum :=&lt;-signi<br>\t\tif signNum == num {<br>\t\t\tfmt.Println(&quot;Program finished!&quot;)<br>\t\t\tbreak;<br>\t\t}<br>\t\tsigni&lt;-signNum<br>\t\ttime.Sleep(time.Nanosecond)<br>\t}<br><br><br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456425,"discussion_content":"ä½ è¿™æ ·å¾ˆå¯èƒ½ä¼šæŠŠé¡ºåºæä¹±ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562156851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103843,"user_name":"ç«ç«å¯»","can_delete":false,"product_type":"c1","uid":1120541,"ip_address":"","ucode":"B6DC003A5D89AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/1d/d2b6e006.jpg","comment_is_top":false,"comment_ctime":1560528333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560528333","product_id":100013101,"comment_content":"è¿™æ ·å¯ä»¥ï¼š<br>func main() {<br>\tc := make(chan int, 10)<br>\tq := make(chan struct{})<br>\tc &lt;- 0<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func(i int) {<br>\t\t\tfor {<br>\t\t\t\tj := &lt;-c<br>\t\t\t\tif i == j {<br>\t\t\t\t\tfmt.Println(i)<br>\t\t\t\t\tif i == 9 {<br>\t\t\t\t\t\tq &lt;- struct{}{}<br>\t\t\t\t\t} else {<br>\t\t\t\t\t\tc &lt;- i + 1<br>\t\t\t\t\t}<br>\t\t\t\t\tbreak<br>\t\t\t\t} else {<br>\t\t\t\t\tc &lt;- j<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}(i)<br>\t}<br>\t&lt;- q<br>}","like_count":0},{"had_liked":false,"id":99332,"user_name":"æ›¾æ˜¥äº‘","can_delete":false,"product_type":"c1","uid":1197308,"ip_address":"","ucode":"5569D3EC9AD3B4","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/fc/1ca9c88c.jpg","comment_is_top":false,"comment_ctime":1559194870,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559194870","product_id":100013101,"comment_content":"package main<br><br>import &quot;fmt&quot;<br><br>func main() {<br>\tconst num = 10<br>\twg := WaitGroup{}<br>\tfor i := 0; i &lt; num; i++ {<br>\t\tgo func(i int) {<br>\t\t\tif wg.Done(i) {<br>\t\t\t\tfmt.Println(i)<br>\t\t\t\twg.Add()<br>\t\t\t}<br>\t\t}(i)<br>\t}<br>\twg.Wait(num)<br>}<br><br>type WaitGroup struct {<br>\tflag int<br>}<br><br>func (wg *WaitGroup) Add() {<br>\twg.flag += 1<br>}<br><br>func (wg *WaitGroup) Done(n int) bool {<br>\tfor {<br>\t\tif n == wg.flag {<br>\t\t\tbreak<br>\t\t}<br>\t}<br>\treturn true<br>}<br><br>func (wg *WaitGroup) Wait(n int) {<br>\tfor {<br>\t\tif wg.flag == n {<br>\t\t\tbreak<br>\t\t}<br>\t}<br>}<br>","like_count":0},{"had_liked":false,"id":94794,"user_name":"Zzz","can_delete":false,"product_type":"c1","uid":1116272,"ip_address":"","ucode":"4AA47797F48315","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIu1n1DhUGGKTjelrQaLYOSVK2rsFeia0G8ASTIftib5PTOx4pTqdnfwb0NiaEFGRgS661nINyZx9sUg/132","comment_is_top":false,"comment_ctime":1557898736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557898736","product_id":100013101,"comment_content":"å¾ˆå¤šåŒå­¦éƒ½æåˆ°åœ¨å¾ªç¯å†…éƒ¨å¢åŠ &lt;-chçš„æ–¹å¼ä¿è¯ä¸Šé¢çš„goè¯­å¥æ‰§è¡Œå®Œå†ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚è¿™ç§æ–¹å¼è™½ç„¶è¾¾åˆ°äº†é¡ºåºæ‰“å°çš„æ•ˆæœï¼Œä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªç¨‹åºåªéœ€è¦ä¸€ä¸ªgoroutineå°±å¯ä»¥å®Œæˆï¼šä¸»å‡½æ•°é˜»å¡æ—¶æ‰§è¡Œgoè¯­å¥ï¼Œç„¶åå†å”¤é†’ä¸»å‡½æ•°ã€‚","like_count":0},{"had_liked":false,"id":85518,"user_name":"ğŸ„½ğŸ„¸ğŸ…‡ğŸ…„ğŸ…‚","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1555093010,"is_pvip":false,"replies":[{"id":"30821","content":"è¿™æ ·åšå€’æ˜¯å¯ä»¥é¡ºåºæ‰“å°å‡ºæ•°å­—ï¼Œä½†æ˜¯è·ŸåŸé¢˜ä¸å¤ªå¯¹åº”ã€‚å¦å¤–ï¼Œåœ¨æ­£å¼çš„ç¨‹åºä¸­ï¼Œç”¨ len(ch) åˆ¤æ–­é€šé“æ˜¯å¦å·²ç»ä½¿ç”¨å®Œæ¯•ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1555216826,"ip_address":"","comment_id":85518,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1555093010","product_id":100013101,"comment_content":"func main() {<br>\tch := make(chan int, 10)<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tch &lt;- i<br>\t\tgo func() {<br>\t\t\tfmt.Println(&lt;-ch)<br>\t\t}()<br>\t}<br>\tfor {<br>\t\tif len(ch) == 0 {<br>\t\t\tbreak<br>\t\t}<br>\t}<br>}","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446693,"discussion_content":"è¿™æ ·åšå€’æ˜¯å¯ä»¥é¡ºåºæ‰“å°å‡ºæ•°å­—ï¼Œä½†æ˜¯è·ŸåŸé¢˜ä¸å¤ªå¯¹åº”ã€‚å¦å¤–ï¼Œåœ¨æ­£å¼çš„ç¨‹åºä¸­ï¼Œç”¨ len(ch) åˆ¤æ–­é€šé“æ˜¯å¦å·²ç»ä½¿ç”¨å®Œæ¯•ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555216826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447220,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLia2EwyyEVs3tWRnMlqaAG7R7HvlW4vGvxthKsicgsCEeXO1qL7mMy6GAzgdkSKcH3c70Qa2hY3JLw/132","nickname":"æ²å¤œæ˜Ÿå…‰","note":"","ucode":"22F699E237B179","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269967,"discussion_content":"ã€‚ã€‚è¿™åªä¸è¿‡æ˜¯ä»ç”¨10ä¸ªçº¿ç¨‹ä»ä¸€ä¸ªé€šé“ä¸­å–æ•°æ®ç½¢äº†ã€‚æˆ‘æ„Ÿè§‰éƒè€å¸ˆçš„æœ¬æ„æ˜¯å¦‚ä½•åœ¨çº¿ç¨‹ä¹‹é—´åŒæ­¥ä¿¡å·ã€‚ä½ è¿™ä¸ªé¡ºåºæ˜¯é€šé“ä¿è¯çš„ï¼Œä¸æ˜¯çº¿ç¨‹ä¿è¯çš„ï¼Œæ²¡æœ‰æ„ä¹‰å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589969031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1614922,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a4/4a/25c60a94.jpg","nickname":"gofer","note":"","ucode":"246CD48AF018BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":234938,"discussion_content":"è¿™æ®µç¨‹åºæ— æ³•ä¿è¯è¾“å‡ºçš„é¡ºåº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587006825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83367,"user_name":"å·¦æ°§ä½›æ²™æ˜Ÿäºº","can_delete":false,"product_type":"c1","uid":1195278,"ip_address":"","ucode":"0D8295E1DABA8C","user_header":"https://static001.geekbang.org/account/avatar/00/12/3d/0e/92176eaa.jpg","comment_is_top":false,"comment_ctime":1554545712,"is_pvip":true,"replies":[{"id":"30254","content":"ä½ è¿™æ®µä»£ç é‡Œçš„goå‡½æ•°çš„çœŸæ­£æ‰§è¡Œé¡ºåºå®é™…ä¸Šæ˜¯ä¸ç¡®å®šçš„å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1554691708,"ip_address":"","comment_id":83367,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554545712","product_id":100013101,"comment_content":"func main() {<br>\tch := make(chan int,100)<br>\tfor i := int(0); i &lt; 100; i++ {<br>\t\tgo func() {<br>\t\t\tfmt.Println(i)<br>\t\t\tch &lt;- i<br>\t\t}()<br>\t\t&lt;- ch<br>\t}<br>}<br>è¿™æ ·ä¸è¡Œå—ï¼Ÿéƒè€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445993,"discussion_content":"ä½ è¿™æ®µä»£ç é‡Œçš„goå‡½æ•°çš„çœŸæ­£æ‰§è¡Œé¡ºåºå®é™…ä¸Šæ˜¯ä¸ç¡®å®šçš„å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554691708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82139,"user_name":"æ«æ—ç«å±±","can_delete":false,"product_type":"c1","uid":1199855,"ip_address":"","ucode":"66099C9D1AD36C","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/ef/2ad3effd.jpg","comment_is_top":false,"comment_ctime":1554129497,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1554129497","product_id":100013101,"comment_content":"è°¢è°¢è€å¸ˆçš„è®²è§£","like_count":0},{"had_liked":false,"id":73261,"user_name":"æç„¶å¤§æ˜ç™½ğŸ¶","can_delete":false,"product_type":"c1","uid":1227071,"ip_address":"","ucode":"907C63D4CB4844","user_header":"https://static001.geekbang.org/account/avatar/00/12/b9/3f/3ceddcac.jpg","comment_is_top":false,"comment_ctime":1551846148,"is_pvip":false,"replies":[{"id":"26848","content":"ä½ é‚£è¡Œä»£ç è·Ÿè¿™ä¸ªé—®é¢˜æ²¡å•¥å…³ç³»ã€‚é¡ºåºæ²¡æœ‰ä¿éšœçš„æ„æ€æ˜¯å¯èƒ½ä¹±åºä¹Ÿå¯èƒ½æ°å¥½æœ‰åºï¼Œä½†æœ‰åºåªæ˜¯å‡‘å·§ã€‚å½±å“å› ç´ çš„å¾ˆå¤šï¼Œæ¯”å¦‚ä½ çš„è®¡ç®—æœºæ€§èƒ½ã€ä½ ä½¿ç”¨çš„goç‰ˆæœ¬ï¼Œä½ è®¾å®šçš„Pæ•°é‡ã€ä½ å†™ä»£ç çš„é¡ºåºã€‚<br><br>ä½ åŠ äº†é‚£ä¸€å¥ä½¿å¾—è¿™äº›goroutineçš„å¯ç”¨æ—¶é—´ä¹‹é—´æœ‰äº†ä¸€ç‚¹ç‚¹é—´éš”ï¼Œå®ƒä»¬å¯èƒ½å› æ­¤è¢«æŒ‚åˆ°äº†ä¸åŒçš„Pä¸‹é¢ã€‚è¿™äº›éƒ½æ˜¯å½±å“å› ç´ ã€‚<br><br>ä½ åªè¦è®°ä½ï¼šgoå‡½æ•°çš„æ‰§è¡Œæ˜¯æ— åºçš„å°±å¥½äº†ã€‚è¿™æ˜¯Goè¯­è¨€å†…éƒ¨è°ƒåº¦å™¨çš„æºç å†³å®šçš„ã€‚ä½ è¿™æ ·çš„è¯•éªŒå®é™…ä¸Šæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1551953314,"ip_address":"","comment_id":73261,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551846148","product_id":100013101,"comment_content":"åœ¨goè¯­å¥è¢«æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼ ç»™goå‡½æ•°çš„å‚æ•°iä¼šå…ˆè¢«æ±‚å€¼ï¼Œå¦‚æ­¤å¾—åˆ°å½“å‰è¿­ä»£çš„åºå·ï¼Œé‚£ä¹ˆ<br>func main() {<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\t&#47;&#47;s := i<br>\t\tgo func(int) {<br>\t\t\tfmt.Println(i)<br>\t\t}(i)<br>\t}<br>\ttime.Sleep(time.Second)<br>}è¾“å‡ºçš„åº”è¯¥æ˜¯æ— åºçš„1ï½10ï¼Œä½†æ˜¯äº‹å®ä¸æ˜¯è¿™æ ·ï¼Œé™¤éå¤šåŠ ä¸ªs := iï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå•Š","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441993,"discussion_content":"ä½ é‚£è¡Œä»£ç è·Ÿè¿™ä¸ªé—®é¢˜æ²¡å•¥å…³ç³»ã€‚é¡ºåºæ²¡æœ‰ä¿éšœçš„æ„æ€æ˜¯å¯èƒ½ä¹±åºä¹Ÿå¯èƒ½æ°å¥½æœ‰åºï¼Œä½†æœ‰åºåªæ˜¯å‡‘å·§ã€‚å½±å“å› ç´ çš„å¾ˆå¤šï¼Œæ¯”å¦‚ä½ çš„è®¡ç®—æœºæ€§èƒ½ã€ä½ ä½¿ç”¨çš„goç‰ˆæœ¬ï¼Œä½ è®¾å®šçš„Pæ•°é‡ã€ä½ å†™ä»£ç çš„é¡ºåºã€‚\n\nä½ åŠ äº†é‚£ä¸€å¥ä½¿å¾—è¿™äº›goroutineçš„å¯ç”¨æ—¶é—´ä¹‹é—´æœ‰äº†ä¸€ç‚¹ç‚¹é—´éš”ï¼Œå®ƒä»¬å¯èƒ½å› æ­¤è¢«æŒ‚åˆ°äº†ä¸åŒçš„Pä¸‹é¢ã€‚è¿™äº›éƒ½æ˜¯å½±å“å› ç´ ã€‚\n\nä½ åªè¦è®°ä½ï¼šgoå‡½æ•°çš„æ‰§è¡Œæ˜¯æ— åºçš„å°±å¥½äº†ã€‚è¿™æ˜¯Goè¯­è¨€å†…éƒ¨è°ƒåº¦å™¨çš„æºç å†³å®šçš„ã€‚ä½ è¿™æ ·çš„è¯•éªŒå®é™…ä¸Šæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551953314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71661,"user_name":"ç”»èˆ¹å¬é›¨çœ ","can_delete":false,"product_type":"c1","uid":1204530,"ip_address":"","ucode":"7BF99B0B26F3B2","user_header":"https://static001.geekbang.org/account/avatar/00/12/61/32/61112578.jpg","comment_is_top":false,"comment_ctime":1551408378,"is_pvip":false,"replies":[{"id":"26218","content":"è¿™æ ·æ²¡æ³•ä¿è¯è¿™äº›æ•°å­—æŒ‰é¡ºåºæ‰“å°ï¼Œå› ä¸ºè¿™10ä¸ªgoå‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1551610554,"ip_address":"","comment_id":71661,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551408378","product_id":100013101,"comment_content":" æˆ‘ç”¨ç¼“å†²é€šé“å®ç°äº†ä¸€ç§æ–¹å¼ï¼š<br><br>\tarray_chan := make(chan int, 1)<br>\tfor i :=0; i&lt;10; i++ {<br>\t\tarray_chan &lt;- i<br>\t\tgo func() {<br>\t\t\tfmt.Println(&lt;-array_chan)<br>\t\t}()<br>\t}<br>        time.Sleep(time.Millisecond * 500)<br><br>é€šé“ç¼“å†²é•¿åº¦ä¸º1ï¼Œå†™å…¥1ä¸ªä»¥åé˜»å¡ï¼Œgoroutineä¸­å–å‡ºä»¥åç»§ç»­å–å‡ºæ“ä½œä¼šé˜»å¡ï¼Œç­‰å¾…å‘é€æ“ä½œã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441262,"discussion_content":"è¿™æ ·æ²¡æ³•ä¿è¯è¿™äº›æ•°å­—æŒ‰é¡ºåºæ‰“å°ï¼Œå› ä¸ºè¿™10ä¸ªgoå‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551610554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68038,"user_name":"ahauyuanjun","can_delete":false,"product_type":"c1","uid":1202997,"ip_address":"","ucode":"BB8B66596929EC","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/35/ff2c2f49.jpg","comment_is_top":false,"comment_ctime":1550394846,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550394846","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>)<br><br>func main() {<br>\tc := make(chan int, 1)<br>\tc &lt;- 0<br><br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tgo func(i int, c chan int) {<br>\t\t\tfor {<br>\t\t\t\tselect {<br>\t\t\t\tcase w := &lt;-c:<br>\t\t\t\t\tif w == i {<br>\t\t\t\t\t\tfmt.Println(i)<br>\t\t\t\t\t\tw += 1<br>\t\t\t\t\t\tc &lt;- w<br>\t\t\t\t\t\treturn<br>\t\t\t\t\t} else {<br>\t\t\t\t\t\tc &lt;- w<br>\t\t\t\t\t}<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}(i, c)<br>\t}<br><br>\tfor {<br>\t\tselect {<br>\t\tcase w := &lt;-c:<br>\t\t\tif w == 10 {<br>\t\t\t\tfmt.Println(&quot;end&quot;, w)<br>\t\t\t\tclose(c)<br>\t\t\t\treturn<br>\t\t\t} else {<br>\t\t\t\tc &lt;- w<br>\t\t\t}<br>\t\t}<br>\t}<br>}<br>","like_count":0},{"had_liked":false,"id":55602,"user_name":"æºœå“¥","can_delete":false,"product_type":"c1","uid":1200642,"ip_address":"","ucode":"8FEA184059AE7A","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/02/798c2461.jpg","comment_is_top":false,"comment_ctime":1546240676,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1546240676","product_id":100013101,"comment_content":"Goå°ç™½è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼šä¸ºå•¥æ³¨é‡Š &#47;&#47;trigger(10, func() {})  demo40.go å°±ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":123835,"discussion_content":"æœ€åä¸€æ¬¡è°ƒç”¨triggeræ˜¯é˜»å¡ä¸»goroutineï¼Œä»¥ä¿è¯ä¸€å®šè¦è¾“å‡ºåˆ°9æ‰ç»“æŸã€‚å¦‚æœä¸åŠ è¿™è¡Œçš„è¯ï¼Œä¸» goroutine ä»£ç æ‰§è¡Œå®Œæˆæ—¶ï¼Œå°±ç»“æŸè¿è¡Œäº†ï¼Œè¿˜æ²¡æœ‰æœºä¼šè¿è¡Œå…¶ä»– goroutine","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578408872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35257,"user_name":"Steven","can_delete":false,"product_type":"c1","uid":1022513,"ip_address":"","ucode":"C304D73EDD7389","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoJ7I3viacLvC6gSUQaOF9NJTUlPvXtSFCIlSL9nBHyGxxAkcBEX4hj1zQwwvDPRXdhqVTJ71HZbvQ/132","comment_is_top":false,"comment_ctime":1540477986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540477986","product_id":100013101,"comment_content":"func main() {<br>\tpreDone := make(chan bool, 0)<br>\tfor i := 0; i &lt; 10; i++ {<br>\t\tj := i<br>\t\tdone := make(chan bool, 0)<br>\t\tgo func(preDone, done chan bool) {<br>\t\t\t&lt;-preDone<br>\t\t\tfmt.Println(j)<br>\t\t\tdone &lt;- true<br>\t\t}(preDone, done)<br><br>\t\tif i == 0 {<br>\t\t\tpreDone &lt;- true<br>\t\t}<br><br>\t\tpreDone = done<br>\t}<br><br>\t&lt;-preDone<br>}","like_count":0},{"had_liked":false,"id":31609,"user_name":"æ‹‰é“","can_delete":false,"product_type":"c1","uid":1224912,"ip_address":"","ucode":"4286AEAD0A6E6C","user_header":"","comment_is_top":false,"comment_ctime":1539245247,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539245247","product_id":100013101,"comment_content":"æ¥ç¢—ç»¿è±†æ±¤<br>î˜¦<br>æˆ‘æœ‰ä¸€ä¸ªæ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œ å¦‚ä¸‹<br>func main(){<br>ch := make(chan struct{})<br>for i:=0; i &lt; 100; i++{<br>go func(i int){<br>fmt.Println(i)<br>ch &lt;- struct{}{}<br>}(i)<br>&lt;-ch<br>}<br>}<br>è¿™æ ·ï¼Œæ¯æ¬¡å¾ªç¯éƒ½åŒ…è£…goroutine æ‰§è¡Œç»“æŸæ‰è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå°±å¯ä»¥ä¿è¯é¡ºåºæ‰§è¡Œäº†<br>2018-09-19<br>î˜ˆ ä½œè€…å›å¤<br>è¿™äº›goå‡½æ•°çš„çœŸæ­£æ‰§è¡Œè°å…ˆè°åæ˜¯ä¸å¯æ§çš„ï¼Œæ‰€ä»¥è¿™æ ·åšä¸è¡Œçš„ã€‚<br><br>æ‚¨å¥½ï¼Œä»i=0å¼€å§‹ï¼Œå¦‚æœæ²¡æœ‰å¯¹chåšæ¥æ”¶æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿå µå¡ï¼Œç›´åˆ°æœ‰æ•°æ®å‘é€åˆ°chï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰å¾ªç¯å†…çš„goroutineæ²¡æœ‰è¿è¡Œç»“æŸï¼Œæ˜¯ä¸ä¼šè¿è¡Œåˆ°ä¸‹ä¸€æ¬¡è¿­ä»£çš„ï¼Œæ‰€ä»¥è¿™æ ·åšä¹Ÿæ˜¯å¯ä»¥ä¿è¯é¡ºåºçš„ã€‚è¯·é—®ï¼Œæˆ‘è¿™ä¹ˆè¯´æ˜¯æ­£ç¡®çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":30552,"user_name":"å’è¿¹","can_delete":false,"product_type":"c1","uid":1202095,"ip_address":"","ucode":"FAE1AA6038402C","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/af/0b39cab7.jpg","comment_is_top":false,"comment_ctime":1538920386,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538920386","product_id":100013101,"comment_content":"éƒè€å¸ˆï¼Œé—®ä¸ªé—®é¢˜<br>\ttrigger := func(i uint32, fn func()) {<br>\t\tfor {<br>\t\t\tif n := atomic.LoadUint32(&amp;count); n == i {<br>\t\t\t\tfn()<br>\t\t\t\tatomic.AddUint32(&amp;count, 1)<br>\t\t\t\tbreak<br>\t\t\t}<br>&#47;&#47;ä¸ºä»€ä¹ˆè¿™é‡Œå¦‚æœæ²¡æœ‰ä¼‘çœ çš„è¯ï¼Œè¿è¡Œç¨‹åºç”µè„‘ä¼šå¡æ­»å‘¢<br>\t\t\ttime.Sleep(time.Nanosecond)<br>\t\t}<br>\t}<br>","like_count":0},{"had_liked":false,"id":29687,"user_name":"Lever","can_delete":false,"product_type":"c1","uid":1071921,"ip_address":"","ucode":"20C0D381677E1D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/31/b26b56bf.jpg","comment_is_top":false,"comment_ctime":1538487633,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1538487633","product_id":100013101,"comment_content":"ã€æ¥ç¢—ç»¿è±†æ±¤ã€‘å†™çš„ç¨‹åºæ„Ÿè§‰æ²¡æœ‰é—®é¢˜å•Šï¼Œåœ¨è¯» channel çš„æ—¶å€™åº”è¯¥ä¼šä¸€ç›´ç­‰å¾…å§ï¼Œç›´åˆ°è¯»åˆ°ä¹‹åæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œæ‰€ä»¥è¾“å‡ºä¹Ÿåº”è¯¥æ˜¯é¡ºåºçš„å§ï¼Ÿå†è´´ä¸€éä»–çš„ä»£ç ï¼š<br>func main(){<br>  ch := make(chan struct{})<br>  for i:=0; i &lt; 100; i++{<br>    go func(i int){<br>      fmt.Println(i)<br>      ch &lt;- struct{}{}<br>    }(i)<br>    &lt;-ch<br>  }<br>}","like_count":0,"discussions":[{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":123853,"discussion_content":"è¿™å°±ä¸ç®—æ˜¯å¹¶å‘çš„æ‰§è¡Œäº†ï¼Œéƒ½æ˜¯é˜»å¡éå¹¶å‘äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578409078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28984,"user_name":"ä»»æ€§ğŸ˜€","can_delete":false,"product_type":"c1","uid":1209711,"ip_address":"","ucode":"F80DB5E6896105","user_header":"https://static001.geekbang.org/account/avatar/00/12/75/6f/8a6e0a14.jpg","comment_is_top":false,"comment_ctime":1538214519,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538214519","product_id":100013101,"comment_content":"package main<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;time&quot;<br>)<br><br>func main() {<br>\tvar count uint32<br>\ttrigger := func(i uint32, fn func()) {<br>\t\tfor {<br>\t\t\t&#47;* if n := atomic.LoadUint32(&amp;count); n == i {<br>\t\t\t\tfn()<br>\t\t\t\tatomic.AddUint32(&amp;count, 1)<br>\t\t\t\tbreak<br>\t\t\t} *&#47;<br>\t\t\tif count == i {<br>\t\t\t\tfn()<br>\t\t\t\tcount++<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\ttime.Sleep(time.Nanosecond) &#47;&#47;çº³ç§’<br>\t\t}<br>\t}<br>\tfor i := uint32(0); i &lt; 10; i++ {<br>\t\tgo func(i uint32) {<br>\t\t\tfn := func() {<br>\t\t\t\tfmt.Println(i, &quot;=&gt;&quot;, count)<br>\t\t\t}<br>\t\t\ttrigger(i, fn)<br>\t\t}(i)<br>\t}<br>\ttrigger(10, func() {})<br>}<br><br><br>è€å¸ˆè¿™ä¸ªä»£ç ä¼šæœ‰é—®é¢˜å—","like_count":0}]}