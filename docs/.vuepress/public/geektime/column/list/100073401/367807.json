{"id":367807,"title":"20 | RDDå’ŒDataFrameï¼šæ—¢ç”Ÿç‘œï¼Œä½•ç”Ÿäº®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥Spark SQLæ€§èƒ½è°ƒä¼˜ç¯‡çš„å­¦ä¹ ã€‚åœ¨è¿™ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä¼šå…ˆå¸¦ä½ å­¦ä¹ Spark SQLå·²æœ‰çš„ä¼˜åŒ–æœºåˆ¶ï¼Œå¦‚Catalystã€Tungstenè¿™äº›æ ¸å¿ƒç»„ä»¶ï¼Œä»¥åŠAQEã€DPPç­‰æ–°ç‰¹æ€§ã€‚æ·±å…¥ç†è§£è¿™äº›å†…ç½®çš„ä¼˜åŒ–æœºåˆ¶ï¼Œä¼šè®©ä½ åœ¨å¼€å‘åº”ç”¨ä¹‹åˆå°±æœ‰ä¸€ä¸ªæ¯”è¾ƒé«˜çš„èµ·ç‚¹ã€‚ç„¶åï¼Œé’ˆå¯¹æ•°æ®åˆ†æä¸­çš„å…¸å‹åœºæ™¯ï¼Œå¦‚æ•°æ®å…³è”ï¼Œæˆ‘ä»¬å†å»æ·±å…¥æ¢è®¨æ€§èƒ½è°ƒä¼˜çš„æ–¹æ³•å’ŒæŠ€å·§ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´RDDå’ŒDataFrameçš„æ¸Šæºã€‚è¿™ä¹Ÿæ˜¯é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜ç»å¸¸ä¼šé—®çš„ã€‚æ¯”å¦‚è¯´ï¼šâ€œSpark 3.0å¤§ç‰ˆæœ¬å‘å¸ƒï¼ŒSpark SQLçš„ä¼˜åŒ–å æ¯”å°†è¿‘50%ï¼›è€ŒåƒPySparkã€Mllibå’ŒStreamingçš„ä¼˜åŒ–å æ¯”éƒ½ä¸è¶…è¿‡10%ï¼ŒGraphçš„å æ¯”å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™æ˜¯å¦æ„å‘³ç€Sparkç¤¾åŒºé€æ¸æ”¾å¼ƒäº†å…¶ä»–è®¡ç®—é¢†åŸŸï¼Œåªä¸“æ³¨äºæ•°æ®åˆ†æï¼Ÿâ€</p><p><a href=\"https://databricks.com/blog/2020/06/18/introducing-apache-spark-3-0-now-available-in-databricks-runtime-7-0.html\"><img src=\"https://static001.geekbang.org/resource/image/47/75/479cd67e687a3a7cdc805b55b5bdef75.jpg?wh=1600*1358\" alt=\"\"></a></p><p>è¿™ä¸ªé—®é¢˜çš„æ ‡å‡†ç­”æ¡ˆæ˜¯ï¼šâ€œSpark SQLå–ä»£Spark Coreï¼Œæˆä¸ºæ–°ä¸€ä»£çš„å¼•æ“å†…æ ¸ï¼Œæ‰€æœ‰å…¶ä»–å­æ¡†æ¶å¦‚Mllibã€Streamingå’ŒGraphï¼Œéƒ½å¯ä»¥å…±äº«Spark SQLçš„æ€§èƒ½ä¼˜åŒ–ï¼Œéƒ½èƒ½ä»Sparkç¤¾åŒºå¯¹äºSpark SQLçš„æŠ•å…¥ä¸­å—ç›Šã€‚â€ä¸è¿‡ï¼Œé¢è¯•å®˜å¯æ²¡æœ‰é‚£ä¹ˆå¥½å¯¹ä»˜ï¼Œä¸€æ—¦ä½ è¿™ä¹ˆè¯´ï¼Œä»–/å¥¹å¯èƒ½ä¼šè¿½é—®ï¼šâ€œä¸ºä»€ä¹ˆéœ€è¦Spark SQLè¿™ä¸ªæ–°ä¸€ä»£å¼•æ“å†…æ ¸ï¼ŸSpark Coreæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼ŸSpark SQLè§£å†³äº†Spark Coreçš„å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³çš„ï¼Ÿâ€</p><!-- [[[read_end]]] --><p>é¢å¯¹è¿™ä¸€è¿ä¸²â€œç®­å¦‚é›¨å‘â€çš„è¿½é—®ï¼Œä½ è¿˜èƒ½å›ç­”å‡ºæ¥å—ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»RDDçš„ç—›ç‚¹è¯´èµ·ï¼Œä¸€æ­¥ä¸€æ­¥å¸¦ä½ æ¢è®¨DataFrameå‡ºç°çš„å¿…ç„¶æ€§ï¼ŒSpark Coreçš„å±€é™æ€§ï¼Œä»¥åŠå®ƒå’ŒSpark SQLçš„å…³ç³»ã€‚</p><h2>RDDä¹‹ç—›ï¼šä¼˜åŒ–ç©ºé—´å—é™</h2><p>è‡ªä»Sparkç¤¾åŒºåœ¨1.3ç‰ˆæœ¬å‘å¸ƒäº†DataFrameï¼Œå®ƒå°±å¼€å§‹ä»£æ›¿RDDï¼Œé€æ¸æˆä¸ºå¼€å‘è€…çš„é¦–é€‰ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ–°æŠ½è±¡çš„è¯ç”Ÿä¸€å®šæ˜¯ä¸ºäº†è§£å†³è€æŠ½è±¡ä¸èƒ½æå®šçš„é—®é¢˜ã€‚é‚£ä¹ˆï¼Œè¿™äº›é—®é¢˜éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p><p>åœ¨RDDçš„å¼€å‘æ¡†æ¶ä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨RDDç®—å­è¿›è¡Œé€‚å½“çš„æ’åˆ—ç»„åˆï¼Œå°±å¯ä»¥å¾ˆè½»æ¾åœ°å®ç°ä¸šåŠ¡é€»è¾‘ã€‚æˆ‘æŠŠè¿™äº›ä½¿ç”¨é¢‘ç¹çš„RDDç®—å­æ€»ç»“åˆ°äº†ä¸‹é¢çš„è¡¨æ ¼é‡Œï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹ã€‚</p><p><a href=\"https://spark.apache.org/docs/latest/rdd-programming-guide.html\"><img src=\"https://static001.geekbang.org/resource/image/79/d3/790eaa488a4db5950a11da89643232d3.jpeg?wh=1442*1080\" alt=\"\"></a></p><p>è¡¨æ ¼ä¸­é«˜äº®æ˜¾ç¤ºçš„å°±æ˜¯RDDè½¬æ¢å’Œèšåˆç®—å­ï¼Œå®ƒä»¬éƒ½æ˜¯é«˜é˜¶å‡½æ•°ã€‚é«˜é˜¶å‡½æ•°æŒ‡çš„æ˜¯å½¢å‚åŒ…å«å‡½æ•°çš„å‡½æ•°ï¼Œæˆ–æ˜¯è¿”å›ç»“æœåŒ…å«å‡½æ•°çš„å‡½æ•°ã€‚ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠé‚£äº›æœ¬èº«æ˜¯é«˜é˜¶å‡½æ•°çš„RDDç®—å­ï¼Œç®€ç§°â€œé«˜é˜¶ç®—å­â€ã€‚</p><p><strong>å¯¹äºè¿™äº›é«˜é˜¶ç®—å­ï¼Œå¼€å‘è€…éœ€è¦ä»¥Lambdaå‡½æ•°çš„å½¢å¼è‡ªè¡Œæä¾›å…·ä½“çš„è®¡ç®—é€»è¾‘ã€‚</strong>ä»¥mapä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®å¯¹å“ªäº›å­—æ®µåšæ˜ å°„ï¼Œä»¥ä»€ä¹ˆè§„åˆ™æ˜ å°„ã€‚å†ä»¥filterä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡æ˜ä»¥ä»€ä¹ˆæ¡ä»¶åœ¨å“ªäº›å­—æ®µä¸Šè¿‡æ»¤ã€‚</p><p>ä½†è¿™æ ·ä¸€æ¥ï¼ŒSparkåªçŸ¥é“å¼€å‘è€…è¦åšmapã€filterï¼Œä½†å¹¶ä¸çŸ¥é“å¼€å‘è€…æ‰“ç®—æ€ä¹ˆåšmapå’Œfilterã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åœ¨RDDçš„å¼€å‘æ¨¡å¼ä¸‹ï¼ŒSpark CoreåªçŸ¥é“â€œåšä»€ä¹ˆâ€ï¼Œè€Œä¸çŸ¥é“â€œæ€ä¹ˆåšâ€ã€‚</strong>è¿™ä¼šè®©Spark Coreä¸¤çœ¼ä¸€æŠ¹é»‘ï¼Œé™¤äº†æŠŠLambdaå‡½æ•°ç”¨é—­åŒ…çš„å½¢å¼æ‰“å‘åˆ°Executorsä»¥å¤–ï¼Œå®åœ¨æ˜¯æ²¡æœ‰ä»€ä¹ˆé¢å¤–çš„ä¼˜åŒ–ç©ºé—´ã€‚</p><p><strong>å¯¹äºSpark Coreæ¥è¯´ï¼Œä¼˜åŒ–ç©ºé—´å—é™æœ€ä¸»è¦çš„å½±å“ï¼Œè«è¿‡äºè®©åº”ç”¨çš„æ‰§è¡Œæ€§èƒ½å˜å¾—ä½ä¸‹ã€‚</strong>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå°±æ˜¯ç›¸æ¯”Javaæˆ–è€…Scalaï¼ŒPySparkå®ç°çš„åº”ç”¨åœ¨æ‰§è¡Œæ€§èƒ½ä¸Šç›¸å·®æ‚¬æ®Šã€‚åŸå› åœ¨äºï¼Œåœ¨RDDçš„å¼€å‘æ¨¡å¼ä¸‹ï¼Œå³ä¾¿æ˜¯åŒä¸€ä¸ªåº”ç”¨ï¼Œä¸åŒè¯­è¨€å®ç°çš„ç‰ˆæœ¬åœ¨è¿è¡Œæ—¶ä¹Ÿä¼šæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/09/f0/095e9191b93b911c463ca88dba6755f0.jpg?wh=3079*1016\" alt=\"\" title=\"ä¸åŒè¯­è¨€çš„è¿è¡Œæ—¶è®¡ç®—è¿‡ç¨‹\"></p><p>å½“æˆ‘ä»¬ä½¿ç”¨Javaæˆ–è€…Scalaè¯­è¨€åšå¼€å‘æ—¶ï¼Œæ‰€æœ‰çš„è®¡ç®—éƒ½åœ¨JVMè¿›ç¨‹å†…å®Œæˆï¼Œå¦‚å›¾ä¸­å·¦ä¾§çš„Sparkè®¡ç®—èŠ‚ç‚¹æ‰€ç¤ºã€‚</p><p>è€Œå½“æˆ‘ä»¬åœ¨PySparkä¸Šåšå¼€å‘çš„æ—¶å€™ï¼Œåªèƒ½æŠŠç”±RDDç®—å­æ„æˆçš„è®¡ç®—ä»£ç ï¼Œä¸€è‚¡è„‘åœ°å‘é€ç»™Pythonè¿›ç¨‹ã€‚Pythonè¿›ç¨‹è´Ÿè´£æ‰§è¡Œå…·ä½“çš„è„šæœ¬ä»£ç ï¼Œå®Œæˆè®¡ç®—ä¹‹åï¼Œå†æŠŠç»“æœè¿”å›ç»™Executorè¿›ç¨‹ã€‚ç”±äºæ¯ä¸€ä¸ªTaskéƒ½éœ€è¦ä¸€ä¸ªPythonè¿›ç¨‹ï¼Œå¦‚æœRDDçš„å¹¶è¡Œåº¦ä¸º#Nï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±éœ€è¦#Nä¸ªè¿™æ ·çš„Pythonè¿›ç¨‹ä¸Executorsäº¤äº’ã€‚ä¸éš¾å‘ç°ï¼Œå…¶ä¸­çš„ä»»åŠ¡è°ƒåº¦ã€æ•°æ®è®¡ç®—å’Œæ•°æ®é€šä¿¡ç­‰å¼€é”€ï¼Œæ­£æ˜¯PySparkæ€§èƒ½ä½ä¸‹çš„ç½ªé­ç¥¸é¦–ã€‚</p><h2>DataFrameåº”è¿è€Œç”Ÿ</h2><p>é’ˆå¯¹ä¼˜åŒ–ç©ºé—´å—é™è¿™ä¸ªæ ¸å¿ƒé—®é¢˜ï¼ŒSparkç¤¾åŒºç—›å®šæ€ç—›ï¼Œåœ¨2013å¹´åœ¨1.3ç‰ˆæœ¬ä¸­å‘å¸ƒäº†DataFrameã€‚é‚£ä¹ˆï¼ŒDataFrameçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Œå®ƒå’ŒRDDåˆæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼ŒDataFrameå°±æ˜¯æºå¸¦æ•°æ®æ¨¡å¼ï¼ˆData Schemaï¼‰çš„ç»“æ„åŒ–åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œè€ŒRDDæ˜¯ä¸å¸¦Schemaçš„åˆ†å¸ƒå¼æ•°æ®é›†ã€‚<strong>å› æ­¤ï¼Œä»æ•°æ®è¡¨ç¤ºï¼ˆData Representationï¼‰çš„è§’åº¦æ¥çœ‹ï¼Œæ˜¯å¦æºå¸¦Schemaæ˜¯å®ƒä»¬å”¯ä¸€çš„åŒºåˆ«ã€‚</strong>å¸¦Schemaçš„æ•°æ®è¡¨ç¤ºå½¢å¼å†³å®šäº†DataFrameåªèƒ½å°è£…ç»“æ„åŒ–æ•°æ®ï¼Œè€ŒRDDåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ‰€ä»¥é™¤äº†ç»“æ„åŒ–æ•°æ®ï¼Œå®ƒè¿˜å¯ä»¥å°è£…åŠç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ã€‚</p><p>å…¶æ¬¡ï¼Œä»å¼€å‘APIä¸Šçœ‹ï¼Œ<strong>RDDç®—å­å¤šæ˜¯é«˜é˜¶å‡½æ•°ï¼Œè¿™äº›ç®—å­å…è®¸å¼€å‘è€…çµæ´»åœ°å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè¡¨è¾¾èƒ½åŠ›æå¼º</strong>ã€‚</p><p>DataFrameçš„è¡¨è¾¾èƒ½åŠ›å´å¾ˆå¼±ã€‚ä¸€æ¥ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—DSLï¼ˆDomain Specific Languageï¼‰ç®—å­ï¼Œå¦‚selectã€filterã€aggã€groupByç­‰ç­‰ã€‚ç”±äºDSLè¯­è¨€æ˜¯ä¸ºè§£å†³æŸä¸€ç±»ä»»åŠ¡è€Œä¸“é—¨è®¾è®¡çš„è®¡ç®—æœºè¯­è¨€ï¼Œéå›¾çµå®Œå¤‡ï¼Œå› æ­¤ï¼Œè¯­è¨€è¡¨è¾¾èƒ½åŠ›éå¸¸æœ‰é™ã€‚äºŒæ¥ï¼ŒDataFrameä¸­çš„ç»å¤§å¤šæ•°ç®—å­éƒ½æ˜¯æ ‡é‡å‡½æ•°ï¼ˆScalar Functionsï¼‰ï¼Œå®ƒä»¬çš„å½¢å‚å¾€å¾€æ˜¯ç»“æ„åŒ–çš„æ•°æ®åˆ—ï¼ˆColumnsï¼‰ï¼Œè¡¨è¾¾èƒ½åŠ›ä¹Ÿå¾ˆå¼±ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œç›¸æ¯”RDDï¼ŒDataFrameçš„è¡¨ç¤ºå’Œè¡¨è¾¾èƒ½åŠ›éƒ½å˜å¼±äº†ï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆè§£å†³RDDä¼˜åŒ–ç©ºé—´å—é™çš„æ ¸å¿ƒç—›ç‚¹å‘¢ï¼Ÿâ€</p><p>å½“ç„¶ï¼Œä»…å‡­DataFrameåœ¨APIä¸Šçš„æ”¹åŠ¨å°±æƒ³è§£å†³RDDçš„æ ¸å¿ƒç—›ç‚¹ï¼Œæ¯”ç™»å¤©è¿˜éš¾ã€‚<strong>DataFrame APIæœ€å¤§çš„æ„ä¹‰åœ¨äºï¼Œå®ƒä¸ºSparkå¼•æ“çš„å†…æ ¸ä¼˜åŒ–æ‰“å¼€äº†å…¨æ–°çš„ç©ºé—´ã€‚</strong></p><p>é¦–å…ˆï¼ŒDataFrameä¸­Schemaæ‰€æºå¸¦çš„ç±»å‹ä¿¡æ¯ï¼Œè®©Sparkå¯ä»¥æ ¹æ®æ˜ç¡®çš„å­—æ®µç±»å‹è®¾è®¡å®šåˆ¶åŒ–çš„æ•°æ®ç»“æ„ï¼Œä»è€Œå¤§å¹…æå‡æ•°æ®çš„å­˜å‚¨å’Œè®¿é—®æ•ˆç‡ã€‚å…¶æ¬¡ï¼ŒDataFrameä¸­æ ‡é‡ç®—å­ç¡®å®šçš„è®¡ç®—é€»è¾‘ï¼Œè®©Sparkå¯ä»¥åŸºäºå¯å‘å¼çš„è§„åˆ™å’Œç­–ç•¥ï¼Œç”šè‡³æ˜¯åŠ¨æ€çš„è¿è¡Œæ—¶ä¿¡æ¯å»ä¼˜åŒ–DataFrameçš„è®¡ç®—è¿‡ç¨‹ã€‚</p><h2>Spark SQLæ™ºèƒ½å¤§è„‘</h2><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰äº†DataFrame APIï¼Œè´Ÿè´£å¼•æ“å†…æ ¸ä¼˜åŒ–çš„é‚£ä¸ªå¹•åè‹±é›„æ˜¯è°ï¼Ÿä¸ºäº†æ”¯æŒDataFrameå¼€å‘æ¨¡å¼ï¼ŒSparkä»1.3ç‰ˆæœ¬å¼€å§‹æ¨å‡ºSpark SQLã€‚<strong>Spark SQLçš„æ ¸å¿ƒç»„ä»¶æœ‰äºŒï¼Œå…¶ä¸€æ˜¯Catalystä¼˜åŒ–å™¨ï¼Œå…¶äºŒæ˜¯Tungstenã€‚</strong>å…³äºCatalystå’ŒTungstençš„ç‰¹æ€§å’Œä¼˜åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨åé¢çš„ä¸¤è®²å†å»å±•å¼€ï¼Œä»Šå¤©è¿™ä¸€è®²ï¼Œå’±ä»¬ä¸“æ³¨åœ¨å®ƒä»¬å’ŒDataFrameçš„å…³ç³»ã€‚</p><h3>Catalystï¼šæ‰§è¡Œè¿‡ç¨‹ä¼˜åŒ–</h3><p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´Catalystçš„ä¼˜åŒ–è¿‡ç¨‹ã€‚å½“å¼€å‘è€…é€šè¿‡Actionsç®—å­è§¦å‘DataFrameçš„è®¡ç®—è¯·æ±‚æ—¶ï¼ŒSparkå†…éƒ¨ä¼šå‘ç”Ÿä¸€ç³»åˆ—æœ‰è¶£çš„äº‹æƒ…ã€‚</p><p>é¦–å…ˆï¼ŒåŸºäºDataFrameç¡®åˆ‡çš„è®¡ç®—é€»è¾‘ï¼ŒSparkä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„SQLè§£æå™¨ANTLRæ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼ŒAbstract Syntax Treeï¼‰ã€‚æ—¢ç„¶æ˜¯æ ‘ï¼Œå°±ä¼šæœ‰èŠ‚ç‚¹å’Œè¾¹è¿™ä¸¤ä¸ªåŸºæœ¬çš„æ„æˆå…ƒç´ ã€‚èŠ‚ç‚¹è®°å½•çš„æ˜¯æ ‡é‡ç®—å­ï¼ˆå¦‚selectã€filterï¼‰çš„å¤„ç†é€»è¾‘ï¼Œè¾¹æºå¸¦çš„æ˜¯æ•°æ®ä¿¡æ¯ï¼šå…³ç³»è¡¨å’Œæ•°æ®åˆ—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™æ ·çš„è¯­æ³•æ ‘æè¿°äº†ä»æºæ•°æ®åˆ°DataFrameç»“æœæ•°æ®çš„è½¬æ¢è¿‡ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1c/6f/1c0a5e8c1ccdc5eb6ecc29cc45d3f96f.jpg?wh=1396*1382\" alt=\"\" title=\"ASTè¯­æ³•æ ‘ç¤ºæ„å›¾\"></p><p>åœ¨Sparkä¸­ï¼Œè¯­æ³•æ ‘è¿˜æœ‰ä¸ªåˆ«åå«åšâ€œUnresolved Logical Planâ€ã€‚å®ƒæ­£æ˜¯Catalystä¼˜åŒ–è¿‡ç¨‹çš„èµ·ç‚¹ã€‚ä¹‹æ‰€ä»¥å–åâ€œUnresolvedâ€ï¼Œæ˜¯å› ä¸ºè¾¹ä¸Šè®°å½•çš„å…³ç³»è¡¨å’Œæ•°æ®åˆ—ä»…ä»…æ˜¯ä¸€äº›å­—ç¬¦ä¸²ï¼Œè¿˜æ²¡æœ‰å’Œå®é™…æ•°æ®å¯¹åº”èµ·æ¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒFilterä¹‹åçš„é‚£æ¡è¾¹ï¼Œè¾“å‡ºçš„æ•°æ®åˆ—æ˜¯joinKeyå’ŒpayLoadã€‚è¿™äº›å­—ç¬¦ä¸²çš„æ¥æºæ˜¯DataFrameçš„DSLæŸ¥è¯¢ï¼ŒCatalystå¹¶ä¸ç¡®å®šè¿™äº›å­—æ®µåæ˜¯ä¸æ˜¯æœ‰æ•ˆçš„ï¼Œæ›´ä¸çŸ¥é“æ¯ä¸ªå­—æ®µéƒ½æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p><p>å› æ­¤ï¼Œ<strong>Catalyståšçš„ç¬¬ä¸€æ­¥ä¼˜åŒ–ï¼Œå°±æ˜¯ç»“åˆDataFrameçš„Schemaä¿¡æ¯ï¼Œç¡®è®¤è®¡åˆ’ä¸­çš„è¡¨åã€å­—æ®µåã€å­—æ®µç±»å‹ä¸å®é™…æ•°æ®æ˜¯å¦ä¸€è‡´</strong>ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«åšæŠŠâ€œUnresolved Logical Planâ€è½¬æ¢æˆâ€œAnalyzed Logical Planâ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/72/f3ffb5fc43ae3c9bca44c1f4f8b7e872.jpg?wh=6539*1200\" alt=\"\" title=\"Spark SQLçš„ç«¯åˆ°ç«¯ä¼˜åŒ–è¿‡ç¨‹\"></p><p>åŸºäºè§£æè¿‡åçš„â€œAnalyzed Logical Planâ€ï¼ŒCatalystæ‰èƒ½ç»§ç»­åšä¼˜åŒ–ã€‚åˆ©ç”¨å¯å‘å¼çš„è§„åˆ™å’Œæ‰§è¡Œç­–ç•¥ï¼ŒCatalystæœ€ç»ˆæŠŠé€»è¾‘è®¡åˆ’è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚æ€»ä¹‹ï¼ŒCatalystçš„ä¼˜åŒ–ç©ºé—´æ¥æºDataFrameçš„å¼€å‘æ¨¡å¼ã€‚</p><h3>Tungstenï¼šæ•°æ®ç»“æ„ä¼˜åŒ–</h3><p>è¯´å®ŒCatalystï¼Œæˆ‘æ¥ç€å†æ¥è¯´è¯´Tungstenã€‚åœ¨å¼€å‘åŸåˆ™é‚£ä¸€è®²ï¼Œæˆ‘ä»¬æåˆ°è¿‡Tungstenä½¿ç”¨å®šåˆ¶åŒ–çš„æ•°æ®ç»“æ„Unsafe Rowæ¥å­˜å‚¨æ•°æ®ï¼ŒUnsafe Rowçš„ä¼˜ç‚¹æ˜¯å­˜å‚¨æ•ˆç‡é«˜ã€GCæ•ˆç‡é«˜ã€‚Tungstenä¹‹æ‰€ä»¥èƒ½å¤Ÿè®¾è®¡è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œä»°ä»—çš„ä¹Ÿæ˜¯DataFrameæºå¸¦çš„Schemaã€‚Unsafe Rowæˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œè¿™é‡Œæˆ‘å†å¸¦ä½ ç®€å•å›é¡¾ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/75/23/75ab3ca00411e1aa3933f3b0b1b3de23.jpeg?wh=1162*715\" alt=\"\" title=\"ç»“æ„åŒ–çš„äºŒç»´è¡¨\"></p><p>Tungstenæ˜¯ç”¨äºŒè¿›åˆ¶å­—èŠ‚åºåˆ—æ¥å­˜å‚¨æ¯ä¸€æ¡ç”¨æˆ·æ•°æ®çš„ï¼Œå› æ­¤åœ¨å­˜å‚¨æ•ˆç‡ä¸Šå®ŒèƒœJava Objectã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¦å­˜å‚¨ä¸Šè¡¨ä¸­çš„æ•°æ®ï¼Œç”¨Java Objectæ¥å­˜å‚¨ä¼šæ¶ˆè€—100ä¸ªå­—èŠ‚æ•°ï¼Œè€Œä½¿ç”¨Tungstenä»…éœ€è¦ä¸åˆ°20ä¸ªå­—èŠ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/20/02/20230c764200cfde05dedec1cae6b702.jpg?wh=3497*1191\" alt=\"\" title=\"äºŒè¿›åˆ¶å­—èŠ‚åºåˆ—\"></p><p>ä½†æ˜¯ï¼Œè¦æƒ³å®ç°ä¸Šå›¾ä¸­çš„äºŒè¿›åˆ¶åºåˆ—ï¼ŒTungstenå¿…é¡»è¦çŸ¥é“æ•°æ®æ¡ç›®çš„Schemaæ‰è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦çŸ¥é“æ¯ä¸€ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ï¼Œæ‰èƒ½å†³å®šåœ¨ä»€ä¹ˆä½ç½®å®‰æ”¾å®šé•¿å­—æ®µã€å®‰æ’Offsetï¼Œä»¥åŠå­˜æ”¾å˜é•¿å­—æ®µçš„æ•°æ®å€¼ã€‚DataFrameåˆšå¥½èƒ½æ»¡è¶³è¿™ä¸ªå‰ææ¡ä»¶ã€‚</p><p>æˆ‘ä»¬ä¸å¦¨æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ•°æ®æ˜¯ç”¨RDDå°è£…çš„ï¼ŒTungstenè¿˜æœ‰å¯èƒ½åšåˆ°è¿™ä¸€ç‚¹å—ï¼Ÿå½“ç„¶ä¸å¯èƒ½ã€‚è¿™æ˜¯å› ä¸ºï¼Œè™½ç„¶RDDä¹Ÿå¸¦ç±»å‹ï¼Œå¦‚RDD[Int]ã€RDD[(Int, String)]ï¼Œä½†å¦‚æœRDDä¸­æºå¸¦çš„æ˜¯å¼€å‘è€…è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå¦‚RDD[User]æˆ–æ˜¯RDD[Product]ï¼ŒTungstenå°±ä¼šä¸¤çœ¼ä¸€æŠ¹é»‘ï¼Œå®Œå…¨ä¸çŸ¥é“ä½ çš„Userå’ŒProductæŠ½è±¡åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æˆä¹Ÿè§ä½•ã€è´¥ä¹Ÿè§ä½•ï¼ŒRDDçš„é€šç”¨æ€§æ˜¯ä¸€æŸ„åŒåˆƒå‰‘ï¼Œåœ¨æä¾›å¼€å‘çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿè®©å¼•æ“å†…æ ¸çš„ä¼˜åŒ–å˜å¾—æ— æ¯”å›°éš¾ã€‚</p><p><strong>æ€»çš„æ¥è¯´ï¼ŒåŸºäºDataFrameç®€å•çš„æ ‡é‡ç®—å­å’Œæ˜ç¡®çš„Schemaå®šä¹‰ï¼Œå€ŸåŠ©Catalystä¼˜åŒ–å™¨å’ŒTungstenï¼ŒSpark SQLæœ‰èƒ½åŠ›åœ¨è¿è¡Œæ—¶æ„å»ºèµ·ä¸€å¥—ç«¯åˆ°ç«¯çš„ä¼˜åŒ–æœºåˆ¶ã€‚è¿™å¥—æœºåˆ¶è¿ç”¨å¯å‘å¼çš„è§„åˆ™ä¸ç­–ç•¥ï¼Œä»¥åŠè¿è¡Œæ—¶çš„æ‰§è¡Œä¿¡æ¯ï¼Œå°†åŸæœ¬æ¬¡ä¼˜ã€ç”šè‡³æ˜¯ä½æ•ˆçš„æŸ¥è¯¢è®¡åˆ’è½¬æ¢ä¸ºé«˜æ•ˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œæå‡ç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½ã€‚</strong>å› æ­¤ï¼Œåœ¨DataFrameçš„å¼€å‘æ¡†æ¶ä¸‹ï¼Œä¸è®ºä½ ä½¿ç”¨å“ªç§å¼€å‘è¯­è¨€ï¼Œå¼€å‘è€…éƒ½èƒ½å…±äº«Spark SQLå¸¦æ¥çš„æ€§èƒ½ç¦åˆ©ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/50/fc/505dbb1462dbc1f927fa1f4a2daabcfc.jpg?wh=3385*1032\" alt=\"\" title=\"ä¸åŒå¼€å‘æ¨¡å¼ä¸‹çš„åˆ†å¸ƒå¼æ‰§è¡Œè¿‡ç¨‹\"></p><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥å›é¡¾æœ€å¼€å§‹æåˆ°çš„é¢è¯•é¢˜ï¼šâ€œä»2.0ç‰ˆæœ¬è‡³ä»Šï¼ŒSparkå¯¹äºå…¶ä»–å­æ¡†æ¶çš„å®Œå–„ä¸ä¼˜åŒ–ï¼Œç›¸æ¯”Spark SQLå æ¯”å¾ˆä½ã€‚è¿™æ˜¯å¦æ„å‘³ç€ï¼ŒSparkæœªæ¥çš„å‘å±•é‡å¿ƒæ˜¯æ•°æ®åˆ†æï¼Œå…¶ä»–åœºæ™¯å¦‚æœºå™¨å­¦ä¹ ã€æµè®¡ç®—ä¼šé€æ¸è¾¹ç¼˜åŒ–å—ï¼Ÿâ€</p><p>æœ€åˆï¼ŒSpark SQLç¡®å®ä»…ä»…æ˜¯è¿è¡ŒSQLå’ŒDataFrameåº”ç”¨çš„å­æ¡†æ¶ï¼Œä½†éšç€ä¼˜åŒ–æœºåˆ¶çš„æ—¥è¶‹å®Œå–„ï¼ŒSpark SQLé€æ¸å–ä»£Spark Coreï¼Œæ¼”è¿›ä¸ºæ–°ä¸€ä»£çš„å¼•æ“å†…æ ¸ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰å­æ¡†æ¶çš„æºç å®ç°éƒ½å·²ä»RDDåˆ‡æ¢åˆ°DataFrameã€‚å› æ­¤ï¼Œå’ŒPySparkä¸€æ ·ï¼ŒåƒStreamingã€Graphã€Mllibè¿™äº›å­æ¡†æ¶å®é™…ä¸Šéƒ½æ˜¯é€šè¿‡DataFrame APIè¿è¡Œåœ¨Spark SQLä¹‹ä¸Šï¼Œå®ƒä»¬è‡ªç„¶å¯ä»¥å…±äº«Spark SQLå¼•å…¥çš„ç§ç§ä¼˜åŒ–æœºåˆ¶ã€‚</p><p>å½¢è±¡åœ°è¯´ï¼ŒSpark SQLå°±åƒæ˜¯Sparkçš„æ™ºèƒ½å¤§è„‘ï¼Œå‡¡æ˜¯é€šè¿‡DataFrameè¿™åŒâ€œçœ¼ç›â€çœ‹åˆ°çš„é—®é¢˜ï¼Œéƒ½ä¼šç»ç”±æ™ºèƒ½å¤§è„‘è¿™ä¸ªæŒ‡æŒ¥ä¸­å¿ƒï¼Œç»Ÿç­¹åœ°è¿›è¡Œåˆ†æä¸ä¼˜åŒ–ï¼Œä¼˜åŒ–å¾—åˆ°çš„è¡ŒåŠ¨æŒ‡ä»¤ï¼Œæœ€ç»ˆå†äº¤ç”±Executorsè¿™äº›â€œå››è‚¢â€å»æ‰§è¡Œã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å›´ç»•RDDçš„æ ¸å¿ƒç—›ç‚¹ï¼Œæ¢è®¨äº†DataFrameå‡ºç°çš„å¿…ç„¶æ€§ï¼ŒSpark Coreçš„å±€é™æ€§ï¼Œä»¥åŠå®ƒå’ŒSpark SQLçš„å…³ç³»ï¼Œå¯¹Spark SQLæœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ã€‚</p><p>RDDçš„æ ¸å¿ƒç—›ç‚¹æ˜¯ä¼˜åŒ–ç©ºé—´æœ‰é™ï¼Œå®ƒæŒ‡çš„æ˜¯RDDé«˜é˜¶ç®—å­ä¸­å°è£…çš„å‡½æ•°å¯¹äºSparkæ¥è¯´å®Œå…¨é€æ˜ï¼Œå› æ­¤Sparkå¯¹äºè®¡ç®—é€»è¾‘çš„ä¼˜åŒ–æ— ä»ä¸‹æ‰‹ã€‚</p><p>ç›¸æ¯”RDDï¼ŒDataFrameæ˜¯æºå¸¦Schemaçš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œåªèƒ½å°è£…ç»“æ„åŒ–æ•°æ®ã€‚DataFrameçš„ç®—å­å¤§å¤šæ•°éƒ½æ˜¯æ™®é€šçš„æ ‡é‡å‡½æ•°ï¼Œä»¥æ¶ˆè´¹æ•°æ®åˆ—ä¸ºä¸»ã€‚ä½†æ˜¯ï¼ŒDataFrameæ›´å¼±çš„è¡¨ç¤ºèƒ½åŠ›å’Œè¡¨è¾¾èƒ½åŠ›ï¼Œåè€Œä¸ºSparkå¼•æ“çš„å†…æ ¸ä¼˜åŒ–æ‰“å¼€äº†å…¨æ–°çš„ç©ºé—´ã€‚</p><p>æ ¹æ®DataFrameç®€å•çš„æ ‡é‡ç®—å­å’Œæ˜ç¡®çš„Schemaå®šä¹‰ï¼Œå€ŸåŠ©Catalystä¼˜åŒ–å™¨å’ŒTungstenï¼ŒSpark SQLæœ‰èƒ½åŠ›åœ¨è¿è¡Œæ—¶ï¼Œæ„å»ºèµ·ä¸€å¥—ç«¯åˆ°ç«¯çš„ä¼˜åŒ–æœºåˆ¶ã€‚è¿™å¥—æœºåˆ¶è¿ç”¨å¯å‘å¼çš„è§„åˆ™ä¸ç­–ç•¥å’Œè¿è¡Œæ—¶çš„æ‰§è¡Œä¿¡æ¯ï¼Œå°†åŸæœ¬æ¬¡ä¼˜ã€ç”šè‡³æ˜¯ä½æ•ˆçš„æŸ¥è¯¢è®¡åˆ’è½¬æ¢ä¸ºé«˜æ•ˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œæå‡ç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½ã€‚</p><p>åœ¨DataFrameçš„å¼€å‘æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰å­æ¡†æ¶ã€ä»¥åŠPySparkï¼Œéƒ½è¿è¡Œåœ¨Spark SQLä¹‹ä¸Šï¼Œéƒ½å¯ä»¥å…±äº«Spark SQLæä¾›çš„ç§ç§ä¼˜åŒ–æœºåˆ¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆSparkå†æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬ã€Spark SQLå æ¯”æœ€å¤§çš„æ ¹æœ¬åŸå› ã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>Java Objectåœ¨å¯¹è±¡å­˜å‚¨ä¸Šä¸ºä»€ä¹ˆä¼šæœ‰æ¯”è¾ƒå¤§çš„å¼€é”€ï¼ŸJVMéœ€è¦å¤šå°‘ä¸ªå­—èŠ‚æ‰èƒ½å­˜ä¸‹å­—ç¬¦ä¸²â€œabcdâ€ï¼Ÿ</li>\n<li>åœ¨DataFrameçš„å¼€å‘æ¡†æ¶ä¸‹ï¼Œ PySparkä¸­è¿˜æœ‰å“ªäº›æ“ä½œæ˜¯â€œé¡½å›ºåˆ†å­â€ï¼Œä¼šå¯¼è‡´è®¡ç®—ä¸æ•°æ®åœ¨JVMè¿›ç¨‹ä¸Pythonè¿›ç¨‹ä¹‹é—´é¢‘ç¹äº¤äº’ï¼Ÿ(æç¤ºï¼šå‚è€ƒRDDçš„å±€é™æ€§ï¼Œé‚£äº›å¯¹Sparké€æ˜çš„è®¡ç®—é€»è¾‘ï¼ŒSparkæ˜¯æ²¡æœ‰ä¼˜åŒ–ç©ºé—´çš„)</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","neighbors":{"left":{"article_title":"19 | ç½‘ç»œè§†è§’ï¼šå¦‚ä½•æœ‰æ•ˆé™ä½ç½‘ç»œå¼€é”€ï¼Ÿ","id":366265},"right":{"article_title":"21 | Catalysté€»è¾‘è®¡åˆ’ï¼šä½ çš„SQLè¯­å¥æ˜¯æ€ä¹ˆè¢«ä¼˜åŒ–çš„ï¼Ÿï¼ˆä¸Šï¼‰","id":367832}},"comments":[{"had_liked":false,"id":290872,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1619797508,"is_pvip":false,"replies":[{"id":"105413","content":"Perfect x 4 ï¼ ç†è§£å¾—éå¸¸åˆ°ä½äº†~<br><br>è€å¼Ÿçš„æ¦‚æ‹¬èƒ½åŠ›å¾ˆå¼ºï¼Œç¡®å®ï¼ŒæŠŠæ¡è¿™4ç‚¹ï¼Œå…³äºRDDå’ŒDataFrameçš„åŒºåˆ«ä¸è”ç³»ï¼Œå…¶å®å°±ç®—æ˜¯åƒé€äº†ã€‚<br><br>å…³äºä½ è¯´çš„ç¬¬äºŒç‚¹ï¼Œç¡®å®ï¼ŒSpark Coreå®é™…å°±æ˜¯åˆ†å¸ƒå¼è¿è¡Œæ—¶ï¼Œè´Ÿè´£åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ã€æ‰§è¡Œï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå¹¶ä¸å­˜åœ¨ä»€ä¹ˆä¼˜åŒ–æœºåˆ¶ï¼Œä»…ä»…æ˜¯åˆ†å‘åˆ†å¸ƒå¼ä»£ç ã€è¿è¡Œã€çŠ¶æ€äº¤äº’ï¼Œç­‰ç­‰ã€‚<br><br>ç¬¬å››ç‚¹è¯´å¾—å°¤å…¶åˆ°ä½ï¼Œå¤§èµğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619861899,"ip_address":"","comment_id":290872,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44569470468","product_id":100073401,"comment_content":"å¯¹RDDå’ŒDataFrameçš„ç†è§£<br>1.é¦–å…ˆåŒºåˆ†è¿™ä¸¤ä¸ªä¸œè¥¿ï¼ŒRDDåˆ†å¸ƒå¼æ•°æ®é›†;DFæ˜¯å¸¦æ•°æ®æ¨¡å¼çš„ç»“æ„åŒ–åˆ†å¸ƒå¼æ•°æ®é›†ã€‚æ ¸å¿ƒåŒºåˆ«åœ¨äºDFå¸¦æ•°æ®æ¨¡å¼(æ„Ÿè§‰åƒä¼ ç»Ÿåˆ†å¸ƒå¼æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨)ï¼ŒRDDä¸å¸¦æ•°æ®æ¨¡å¼æˆ–è€…è¯´æ˜¯æ³›å‹çš„ã€‚<br>2.å…¶æ¬¡æ˜¯è¿™ä¸¤è€…åˆ†åˆ«æä¾›çš„APIï¼ŒRDD APIä¼˜åŒ–å¼•æ“æ˜¯Spark Core(æ²¡ç†è§£è¿™å¥è¯ï¼Œæˆ‘ç†è§£Spark Coreè´Ÿè´£taskè°ƒåº¦è®¡ç®—å­˜å‚¨ï¼Œå’Œä¼˜åŒ–çš„è”ç³»åœ¨å“ªå‘¢ï¼Ÿ);DF APIä¼˜åŒ–å¼•æ“æ˜¯SparkSQLï¼ŒåŒ…æ‹¬Catalystæ‰§è¡Œè¿‡ç¨‹ä¼˜åŒ–å’ŒTungstenæ•°æ®ç»“æ„ä¼˜åŒ–ã€‚ä¸¤è€…APIçš„åŒºåˆ«åœ¨äºä¸€ä¸ªæä¾›æ ‡é‡ç®—å­ä¸€ä¸ªé«˜é˜¶ç®—å­å’Œä¸¤è€…åº•å±‚ä¼˜åŒ–å¼•æ“ä¸ä¸€è‡´ã€‚<br>3.ä¸Šé¢ä¸¤ç»„æ¦‚å¿µåº”è¯¥åŒºåˆ†å¼€ã€‚ä¹‹å‰å­æ¡†æ¶å¦‚Streamingï¼Œmlib,graphéƒ½æ˜¯é‡‡ç”¨RDD APIæ¥ç¼–å†™ï¼Œç°åœ¨éƒ½æ˜¯é‡‡ç”¨DF APIæ¥é‡æ–°ç¼–å†™ã€‚<br>4.è°ƒç”¨DF APIç”ŸæˆDFï¼Œä½†DF çš„actionç®—å­è§¦å‘æ‰§è¡Œåæœ€ç»ˆè¿˜æ˜¯ç”ŸæˆRDDï¼Œé€šè¿‡Spark Coreæ¡†æ¶æ¥è¿›è¡Œè°ƒåº¦è®¡ç®—ã€‚æ‰€ä»¥å¯ä¸å¯ä»¥è®¤ä¸ºDF API+SparkSQLå°±æ˜¯ä»£æ›¿äº†ä¹‹å‰çš„RDD APIï¼Ÿç›®çš„å°±æ˜¯ä¸ºäº†æä¾›æ›´ç®€å•çš„APIï¼Œè®©Sparkåšç»Ÿä¸€ä¼˜åŒ–ï¼Œåœ¨rddè®¡ç®—æ—¶æ›´é«˜æ•ˆï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519303,"discussion_content":"Perfect x 4 ï¼ ç†è§£å¾—éå¸¸åˆ°ä½äº†~\n\nè€å¼Ÿçš„æ¦‚æ‹¬èƒ½åŠ›å¾ˆå¼ºï¼Œç¡®å®ï¼ŒæŠŠæ¡è¿™4ç‚¹ï¼Œå…³äºRDDå’ŒDataFrameçš„åŒºåˆ«ä¸è”ç³»ï¼Œå…¶å®å°±ç®—æ˜¯åƒé€äº†ã€‚\n\nå…³äºä½ è¯´çš„ç¬¬äºŒç‚¹ï¼Œç¡®å®ï¼ŒSpark Coreå®é™…å°±æ˜¯åˆ†å¸ƒå¼è¿è¡Œæ—¶ï¼Œè´Ÿè´£åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ã€æ‰§è¡Œï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå¹¶ä¸å­˜åœ¨ä»€ä¹ˆä¼˜åŒ–æœºåˆ¶ï¼Œä»…ä»…æ˜¯åˆ†å‘åˆ†å¸ƒå¼ä»£ç ã€è¿è¡Œã€çŠ¶æ€äº¤äº’ï¼Œç­‰ç­‰ã€‚\n\nç¬¬å››ç‚¹è¯´å¾—å°¤å…¶åˆ°ä½ï¼Œå¤§èµğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619861899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549032,"avatar":"","nickname":"Zzz","note":"","ucode":"9323254354868B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378724,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è§‰å¾—ï¼Œæ‹¿spark coreå’Œsparksqlå½“åšä¸€ç§ä¸œè¥¿è¿›è¡Œå¯¹æ¯”æ˜¯ä¸åˆé€‚çš„ï¼Œä¸ºä»€ä¹ˆä¸ç§°ä¹‹ä¸ºRDDè®¡ç®—å’ŒDFè®¡ç®—ï¼ˆsparksqlï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623374012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290627,"user_name":"sky_sql","can_delete":false,"product_type":"c1","uid":1099273,"ip_address":"","ucode":"397F4263C9E590","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/09/7f2bcc6e.jpg","comment_is_top":false,"comment_ctime":1619665198,"is_pvip":false,"replies":[{"id":"105321","content":"å¯¹ï¼Œæ²¡é”™ï¼ŒDataFrameçš„codeï¼Œç»è¿‡Spark SQLä¼˜åŒ–ä¹‹åï¼Œæœ€ç»ˆäº¤ç”±Tungstenç”Ÿæˆä»£ç å’ŒRDD[InternalRow]ï¼Œä»£ç äº¤ç”±DAGSchedulerè¿›è¡Œåˆ†å‘ã€è¿è¡Œåœ¨RDD[InternalRow]ä¹‹ä¸Šã€‚<br><br>åé¢çš„21ã€22ã€23ä¼šè¯¦ç»†å±•å¼€ä»DataFrameåˆ°Catalystã€å†åˆ°Tungstenï¼Œæœ€ç»ˆç”Ÿæˆä»£ç å’ŒRDDçš„è¿‡ç¨‹ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨ä¸‹å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619673593,"ip_address":"","comment_id":290627,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35979403566","product_id":100073401,"comment_content":"è€å¸ˆå¥½ï¼ŒDataFrameå’ŒRDDè¿™ä¸¤å¥—ç‹¬ç«‹çš„APIï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šè½¬åŒ–ä¸ºRDDä¹‹ä¸Šçš„è®¡ç®—å§ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519249,"discussion_content":"å¯¹ï¼Œæ²¡é”™ï¼ŒDataFrameçš„codeï¼Œç»è¿‡Spark SQLä¼˜åŒ–ä¹‹åï¼Œæœ€ç»ˆäº¤ç”±Tungstenç”Ÿæˆä»£ç å’ŒRDD[InternalRow]ï¼Œä»£ç äº¤ç”±DAGSchedulerè¿›è¡Œåˆ†å‘ã€è¿è¡Œåœ¨RDD[InternalRow]ä¹‹ä¸Šã€‚\n\nåé¢çš„21ã€22ã€23ä¼šè¯¦ç»†å±•å¼€ä»DataFrameåˆ°Catalystã€å†åˆ°Tungstenï¼Œæœ€ç»ˆç”Ÿæˆä»£ç å’ŒRDDçš„è¿‡ç¨‹ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨ä¸‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619673593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293061,"user_name":"CycleGAN","can_delete":false,"product_type":"c1","uid":1679661,"ip_address":"","ucode":"9FD04813911A02","user_header":"https://static001.geekbang.org/account/avatar/00/19/a1/2d/599e9051.jpg","comment_is_top":false,"comment_ctime":1621178165,"is_pvip":false,"replies":[{"id":"106287","content":"å¥½é—®é¢˜ï¼ŒUDFæœ¬èº«çš„å¼€é”€å…¶å®å¤§å®¶æœ‰ç›®å…±ç¹ã€‚ä¸è¿‡å¯¹äºä½ çš„casesæ¥è¯´ï¼Œå…¶å®æ²¡åŠæ³•æ­¦æ–­åœ°è¯´ç”¨Scalaé‡å†™æ•ˆæœå¦‚ä½•ã€‚å› ä¸ºå°±åƒå’±ä»¬æœ€å¼€å§‹è®²è°ƒä¼˜æ–¹æ³•è®ºçš„æ—¶å€™ä¸€æ ·ï¼Œå…¶å®è¿™å–å†³äºUDFæœ¬èº«æ˜¯ä¸æ˜¯æ•´ä½“ä½œä¸šçš„ç“¶é¢ˆã€‚<br><br>å¯¹äºUDFçš„ä¼˜åŒ–ï¼Œæˆ‘è§‰å¾—ä¸å¦¨è¿™æ ·ï¼Œå°±æ˜¯ä»ä½ ä¼—å¤šçš„UDFä¸­ï¼Œé€‰ä¸­ä¸€ä¸ªå¼€é”€æœ€å¤§çš„ï¼Œæˆ–è€…è‡³å°‘æ˜¯â€œçœ‹ä¸Šå»â€å¼€é”€æœ€å¤§çš„ï¼Œç„¶åç”¨Scalaä¼˜åŒ–ï¼Œå¯¹æ¯”å‰åä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ•ˆæœï¼Œç„¶åå†å»å†³å®šï¼Œè¦ä¸è¦å¯¹å…¶ä»–UDFåšåŒæ ·çš„ä¼˜åŒ–ã€‚<br><br>å¦å¤–ï¼Œå¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœDSLå’ŒSQLéƒ½æ— æ³•å®ç°ï¼Œé™¤äº†UDFï¼Œå…¶å®è¿˜å¯ä»¥è€ƒè™‘ç”¨Script Transformationï¼Œè¿™å—Facebookæœ‰ä¸ªæœ€ä½³å®è·µï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼Œçœ‹çœ‹å¯¹ä½ ä»¬æ˜¯å¦æœ‰å¸®åŠ©ï¼šhttps:&#47;&#47;databricks.com&#47;session_eu19&#47;powering-custom-apps-at-facebook-using-spark-script-transformation<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621413550,"ip_address":"","comment_id":293061,"utype":1}],"discussion_count":5,"race_medal":0,"score":"23096014645","product_id":100073401,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æœ‰å¾ˆå¤æ‚çš„è®¡ç®—udfï¼Œç”¨dslæˆ–è€…sqlæ— æ³•æè¿°ï¼ŒPySparkåµŒå…¥udfï¼Œä½¿å¾—ä¼˜åŒ–æ— èƒ½ä¸ºåŠ›ï¼Œæ€§èƒ½ä¹Ÿä¸€ç›´å¾ˆä½ï¼Œæˆ‘ä»¬å¯¹äºåå¤ä½¿ç”¨çš„æ•°å­¦æ“ä½œä¼šç¼–è¯‘æˆsoæ‰§è¡Œï¼Œä¹Ÿåœ¨æå‡udfæœ¬èº«çš„æ‰§è¡Œæ•ˆç‡ï¼Œè¯·é—®å°†pythonçš„udfæ”¹å†™æˆscalaæå‡ä¼šå¤§å—ï¼Ÿè€å¸ˆå¯¹äºæˆ‘ä»¬å†™å¤æ‚udfæœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520053,"discussion_content":"å¥½é—®é¢˜ï¼ŒUDFæœ¬èº«çš„å¼€é”€å…¶å®å¤§å®¶æœ‰ç›®å…±ç¹ã€‚ä¸è¿‡å¯¹äºä½ çš„casesæ¥è¯´ï¼Œå…¶å®æ²¡åŠæ³•æ­¦æ–­åœ°è¯´ç”¨Scalaé‡å†™æ•ˆæœå¦‚ä½•ã€‚å› ä¸ºå°±åƒå’±ä»¬æœ€å¼€å§‹è®²è°ƒä¼˜æ–¹æ³•è®ºçš„æ—¶å€™ä¸€æ ·ï¼Œå…¶å®è¿™å–å†³äºUDFæœ¬èº«æ˜¯ä¸æ˜¯æ•´ä½“ä½œä¸šçš„ç“¶é¢ˆã€‚\n\nå¯¹äºUDFçš„ä¼˜åŒ–ï¼Œæˆ‘è§‰å¾—ä¸å¦¨è¿™æ ·ï¼Œå°±æ˜¯ä»ä½ ä¼—å¤šçš„UDFä¸­ï¼Œé€‰ä¸­ä¸€ä¸ªå¼€é”€æœ€å¤§çš„ï¼Œæˆ–è€…è‡³å°‘æ˜¯â€œçœ‹ä¸Šå»â€å¼€é”€æœ€å¤§çš„ï¼Œç„¶åç”¨Scalaä¼˜åŒ–ï¼Œå¯¹æ¯”å‰åä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ•ˆæœï¼Œç„¶åå†å»å†³å®šï¼Œè¦ä¸è¦å¯¹å…¶ä»–UDFåšåŒæ ·çš„ä¼˜åŒ–ã€‚\n\nå¦å¤–ï¼Œå¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœDSLå’ŒSQLéƒ½æ— æ³•å®ç°ï¼Œé™¤äº†UDFï¼Œå…¶å®è¿˜å¯ä»¥è€ƒè™‘ç”¨Script Transformationï¼Œè¿™å—Facebookæœ‰ä¸ªæœ€ä½³å®è·µï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼Œçœ‹çœ‹å¯¹ä½ ä»¬æ˜¯å¦æœ‰å¸®åŠ©ï¼šhttps://databricks.com/session_eu19/powering-custom-apps-at-facebook-using-spark-script-transformation\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621413550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690447,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cb/4f/7466a488.jpg","nickname":"Pytrick","note":"","ucode":"2759D2BB51D981","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537426,"discussion_content":"ç”¨Pandas UDFå–ä»£æ™®é€šUDFï¼Œ æ•ˆç‡æå‡å‡ å€åˆ°å‡ åå€ \n  https://databricks.com/blog/2017/10/30/introducing-vectorized-udfs-for-pyspark.html#:~:text=The%20UDF%20definitions%20are%20the,defined%20function%20takes%20a%20pandas.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639057781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1300070,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d6/66/62206d01.jpg","nickname":"è¶…çº§ä¸¹","note":"","ucode":"6735EF97F10649","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532815,"discussion_content":"pysparké‡åº¦ç”¨æˆ·æ¥è¯´ä¸¤å¥ã€‚\n\n1. ä¸Šé¢è€å¸ˆæåˆ°çš„ facebookçš„ transfomer æœ¬è´¨è¿˜æ˜¯pipï¼Œä¸è¿‡ä»–ä»¬çš„pipç”¨c++å†™ï¼Œè€Œpysparkç”¨pythonå†™ã€‚æœ€æ–°çš„spark3.2 å·²ç»å®Œå…¨æ”¯æŒäº†è¿™ç§è¯­æ³•ï¼Œå®é™…å°±æ˜¯hive é‡Œé¢çš„ transformè¯­æ³•ã€‚\n\n2. pysparkçš„udfï¼Œæœ¬è´¨è¿˜æ˜¯é€šè¿‡pipè°ƒç”¨pyè„šæœ¬ï¼Œè¿™ä¸ªæ“ä½œå’Œåœ¨ rddä¸Šè°ƒç”¨ mappartitionç±»ä¼¼ã€‚ç»è¿‡å¯¹æ¯”ï¼Œmappartitionçš„å†…å­˜ä½¿ç”¨ä¼šæ¯” pip æ›´ä½ï¼Œè¿è¡Œæ›´ç¨³ã€‚\n\n3. æ€§èƒ½é—®é¢˜ã€‚å®é™…å¼€å‘ä¸­ï¼Œä¸ºäº†æå‡æ•ˆç‡ï¼Œpython pipé‡Œé¢çš„æ ¸å¿ƒé€»è¾‘ä¼šç”¨c++å®ç°ä¸ºsoï¼ŒåŠ é€Ÿè¿ç®—è¿‡ç¨‹ã€‚è¿™ä¸ªåœ¨å¤šæ•°æƒ…å†µä¸‹å’Œscalaæ€§èƒ½ç›¸å½“ã€‚\næˆ‘ä»¬çš„æƒ…å†µï¼Œåº•å±‚æ ¸å¿ƒé€»è¾‘ç”¨c++å®ç°ï¼Œä¸Šå±‚é€šè¿‡pybind11æŠŠc++ç¼–è¯‘ä¹Ÿpyæ‰©å±•ï¼›é€šè¿‡javacppæŠŠc++ç¼–è¯‘ä¸ºjavaæ‰©å±•ã€‚ä¸šåŠ¡åŒå­¦ä½¿ç”¨scalaæˆ–è€…pysparkåšä¸šåŠ¡å¼€å‘ã€‚pysparké™¤äº†æŠ¥é”™æ¯”è¾ƒè¯¡å¼‚å‡ºé—®é¢˜ä¸å¥½æ’æŸ¥ï¼Œè¿è¡Œä¸é‚£ä¹ˆç¨³å®šå¤–ï¼Œå…¶ä»–éƒ½è¿˜è¡Œã€‚æˆ‘ä»¬ä¸€èˆ¬æ•°æ®æ¢ç´¢ç”¨pysparkï¼Œæ­£å¼ä¸Šçº¿è¿˜æ˜¯ç”¨scalaï¼Œscalaæ˜¯çœŸçš„ç¨³å®šï¼Œè€Œä¸”æ›´çœå†…å­˜ï¼ˆä¸å®¹æ˜“æŠ¥oomï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637715477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":1,"child_discussions":[{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1300070,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d6/66/62206d01.jpg","nickname":"è¶…çº§ä¸¹","note":"","ucode":"6735EF97F10649","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565236,"discussion_content":"çæ¯”è¯´ï¼Œ ä½ å…ˆææ¸…æ¥šä¸€ä¸ªé—®é¢˜ï¼Œpipæ˜¯å•¥ï¼Œpipæ˜¯åŒ…ç®¡ç†å™¨ï¼ï¼ï¼ï¼ï¼\nâ€œpip è°ƒç”¨pythonè„šæœ¬â€å°±ç›¸å½“äºè¯´â€œmavenè°ƒç”¨javaç¨‹åºâ€ ï¼Œè¿™ä¸æ˜¯æ‰¯æ·¡ä¹ˆ\n\npysparkä¹‹æ‰€ä»¥å¿«äº†ï¼Œåªå› ä¸ºï¼ŒSQLç»Ÿä¸€å¤–éƒ¨æ¥å£ã€ç»Ÿä¸€ä¸‹å±‚ä¼˜åŒ–ï¼Œpy4j ä¸Šæ€§èƒ½æ¶ˆè€—æ¯”ä¾‹é™ä½äº†\n\nè·ŸC++æœ‰æ¯›å…³ç³»ï¼Œé‚£å«interpreterå¥½å§ï¼Œé‚£ä¸ªæ˜¯pythonè¯­è¨€çš„è¿›åŒ–ï¼Œè·Ÿsparkæœ‰æ¯›å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650418548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":532815,"ip_address":""},"score":565236,"extra":""}]},{"author":{"id":1529153,"avatar":"https://static001.geekbang.org/account/avatar/00/17/55/41/b68df312.jpg","nickname":"å†œå¤«ä¸‰æ‹³","note":"","ucode":"9778194A7CD44E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379754,"discussion_content":"è€å¸ˆæ‚¨å¥½ï¼Œä¸Šé¢è¿™ä½åŒå­¦çš„é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨Spark extensions æä¾›çš„å‡½æ•°æ‰©å±•ï¼Œæ•ˆæœä¼šä¸ä¼šæ¯”UDFæ€§èƒ½å¥½å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624107756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290682,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1619685565,"is_pvip":false,"replies":[{"id":"105344","content":"éƒ½å¯¹ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œåªè¦æ˜¯èµ°Spark SQLçš„æµç¨‹ï¼ˆDataFrameã€Datasetã€SQLä¸‰ç§APIï¼‰ï¼Œå°±éƒ½èƒ½åˆ©ç”¨åˆ°Tungstençš„è¿™ç§äºŒè¿›åˆ¶Unsafe Rowã€‚æ¯”å¦‚ï¼Œå°±åƒä½ è¯´çš„ï¼š<br><br>1ï¼‰ç¼“å­˜çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨å¾—åˆ°ï¼ŒTungstenç”¨Unsafe Rowæ¥å°è£…æ¯æ¡æ•°æ®è®°å½•ï¼›<br>2ï¼‰æ•°æ®æºè¯»è¿›æ¥çš„æ—¶å€™ï¼ˆå½“ç„¶è¿™ä¹ˆè¯´ä¸å¤ªä¸¥è°¨ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œåº”è¯¥æ˜¯Tungstenç”Ÿæˆçš„â€œæ‰‹å†™ä»£ç â€äº¤ä»˜æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨è¿è¡Œæ—¶æ‰§è¡Œè¯»å–æ•°æ®æºçš„æ—¶å€™ï¼Œä¼šæŠŠå®ƒconvertæˆTungstençš„äºŒè¿›åˆ¶Unsafe Rowï¼‰ï¼›<br>3ï¼‰Shuffleçš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸ä»…å¦‚æ­¤ï¼ŒShuffleè¿˜èƒ½åˆ©ç”¨æ–‡ä¸­ä»‹ç»çš„Memory Pageï¼ˆä¸€ä¸ªJVMå¯¹è±¡ï¼‰ï¼Œæ¥è¿›ä¸€æ­¥æå‡å†…å­˜çš„åˆ©ç”¨æ•ˆç‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619695267,"ip_address":"","comment_id":290682,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23094522045","product_id":100073401,"comment_content":"ç£Šå“¥ï¼ŒTungsten ä½¿ç”¨å®šåˆ¶åŒ–çš„æ•°æ®ç»“æ„ Unsafe Row æ¥å­˜å‚¨æ•°æ®ï¼Œæ˜¯ä¸æ˜¯æŒ‡çš„cacheç¼“å­˜çš„æ—¶å€™ä½¿ç”¨Unsafe Rowå­˜å‚¨çš„æ•°æ®ï¼Œæˆ–æ˜¯shuffleæº¢å†™åˆ°ç£ç›˜çš„æ—¶å€™å­˜å‚¨çš„ç»“æ„ï¼Œè¿˜æ˜¯è¯´ä»æ•°æ®æºè¯»è¿›æ¥çš„æ—¶å€™ä¼šè½¬åŒ–æˆUnsafe Rowçš„ç»“æ„ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519261,"discussion_content":"éƒ½å¯¹ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œåªè¦æ˜¯èµ°Spark SQLçš„æµç¨‹ï¼ˆDataFrameã€Datasetã€SQLä¸‰ç§APIï¼‰ï¼Œå°±éƒ½èƒ½åˆ©ç”¨åˆ°Tungstençš„è¿™ç§äºŒè¿›åˆ¶Unsafe Rowã€‚æ¯”å¦‚ï¼Œå°±åƒä½ è¯´çš„ï¼š\n\n1ï¼‰ç¼“å­˜çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨å¾—åˆ°ï¼ŒTungstenç”¨Unsafe Rowæ¥å°è£…æ¯æ¡æ•°æ®è®°å½•ï¼›\n2ï¼‰æ•°æ®æºè¯»è¿›æ¥çš„æ—¶å€™ï¼ˆå½“ç„¶è¿™ä¹ˆè¯´ä¸å¤ªä¸¥è°¨ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œåº”è¯¥æ˜¯Tungstenç”Ÿæˆçš„â€œæ‰‹å†™ä»£ç â€äº¤ä»˜æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨è¿è¡Œæ—¶æ‰§è¡Œè¯»å–æ•°æ®æºçš„æ—¶å€™ï¼Œä¼šæŠŠå®ƒconvertæˆTungstençš„äºŒè¿›åˆ¶Unsafe Rowï¼‰ï¼›\n3ï¼‰Shuffleçš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸ä»…å¦‚æ­¤ï¼ŒShuffleè¿˜èƒ½åˆ©ç”¨æ–‡ä¸­ä»‹ç»çš„Memory Pageï¼ˆä¸€ä¸ªJVMå¯¹è±¡ï¼‰ï¼Œæ¥è¿›ä¸€æ­¥æå‡å†…å­˜çš„åˆ©ç”¨æ•ˆç‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619695267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291342,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1620218654,"is_pvip":false,"replies":[{"id":"105523","content":"å¯¹æ²¡é”™ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‡æ¶çš„UDFã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620226669,"ip_address":"","comment_id":291342,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14505120542","product_id":100073401,"comment_content":"PySparkåº”ç”¨ä¸­å¦‚æœç”¨åˆ°äº†Pythoné‡Œé¢çš„æ•°æ®ç»“æ„éƒ½ä¼šå¯¼è‡´åœ¨JVMè¿›ç¨‹å’ŒPythonè¿›ç¨‹é—´è¿›è¡Œäº¤äº’çš„å§","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519445,"discussion_content":"å¯¹æ²¡é”™ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‡æ¶çš„UDFã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620226669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291051,"user_name":"Zå®‡é”¤é”¤","can_delete":false,"product_type":"c1","uid":2188142,"ip_address":"","ucode":"7DB36E986A7A51","user_header":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","comment_is_top":false,"comment_ctime":1619965812,"is_pvip":true,"replies":[{"id":"105477","content":"æ˜¯çš„ï¼Œä½ è¯´çš„è¿™äº›å¼€é”€éƒ½å¯¹ï¼Œä¸è¿‡â€œABCDâ€åœ¨JVMä¸­å®é™…éœ€è¦48ä¸ªå­—èŠ‚æ‰èƒ½å­˜ä¸‹å“ˆ~ æˆ‘æ€€ç–‘ä½ æ˜¯ä¸æ˜¯æ¼æ‰“äº†ä¸ª4ï¼Œå“ˆå“ˆ~<br><br>å…·ä½“è®¡ç®—ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™é‡Œï¼šhttps:&#47;&#47;databricks.com&#47;blog&#47;2015&#47;04&#47;28&#47;project-tungsten-bringing-spark-closer-to-bare-metal.html","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620115250,"ip_address":"","comment_id":291051,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10209900404","product_id":100073401,"comment_content":"Java Object åœ¨å¯¹è±¡å­˜å‚¨ä¸Šä¸ºä»€ä¹ˆä¼šæœ‰æ¯”è¾ƒå¤§çš„å¼€é”€ï¼Ÿ<br>æˆ‘æŸ¥é˜…äº†äº†ä¸€äº›èµ„æ–™ï¼ŒJavaå¯¹è±¡çš„å­˜å‚¨åœ¨JVMä¸Šè‡³å°‘éœ€è¦32æˆ–64Bitçš„å­—èŠ‚å­˜å‚¨å¯¹è±¡è‡ªèº«ä¿¡æ¯ï¼Œå“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€‚<br>&quot;ABCD&quot;çš„å­˜å‚¨è‡³å°‘éœ€è¦8ä¸ªå­—èŠ‚ã€‚","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519354,"discussion_content":"æ˜¯çš„ï¼Œä½ è¯´çš„è¿™äº›å¼€é”€éƒ½å¯¹ï¼Œä¸è¿‡â€œABCDâ€åœ¨JVMä¸­å®é™…éœ€è¦48ä¸ªå­—èŠ‚æ‰èƒ½å­˜ä¸‹å“ˆ~ æˆ‘æ€€ç–‘ä½ æ˜¯ä¸æ˜¯æ¼æ‰“äº†ä¸ª4ï¼Œå“ˆå“ˆ~\n\nå…·ä½“è®¡ç®—ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™é‡Œï¼šhttps://databricks.com/blog/2015/04/28/project-tungsten-bringing-spark-closer-to-bare-metal.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620115250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2486715,"avatar":"https://static001.geekbang.org/account/avatar/00/25/f1/bb/547b580a.jpg","nickname":"è‹å­æµ©","note":"","ucode":"8A842C9C2E53E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372957,"discussion_content":"æˆ‘çœ‹äº†â€œå…·ä½“è®¡ç®—ç»†èŠ‚å¯ä»¥å‚è€ƒé“¾æ¥â€ï¼Œå¯æ˜¯ä¾æ—§æ²¡èƒ½ç®—å‡º48ä¸ªå­—èŠ‚ï¼Ÿ12å­—èŠ‚çš„headeråŠ 8å­—èŠ‚çš„hash codeï¼Œå†åŠ ä¸Šæ¯ä¸ªå­—ç¬¦çš„2å­—èŠ‚ï¼ˆ4 * 2ï¼‰ï¼Œè¿™ä¹ˆç®—ä¸åº”è¯¥æ˜¯28å­—èŠ‚å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620539833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2486715,"avatar":"https://static001.geekbang.org/account/avatar/00/25/f1/bb/547b580a.jpg","nickname":"è‹å­æµ©","note":"","ucode":"8A842C9C2E53E8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565247,"discussion_content":"ä½ å†å¥½å¥½çœ‹çœ‹å§\n\nStringæ˜¯ä¸ªå¯¹è±¡å•Šï¼Œåˆä¸æ˜¯åŸºç¡€ç±»å‹ã€‚\nå¯¹è±¡æ˜¯24+å­—èŠ‚ï¼Œè€ƒè™‘ç±»å‹æŒ‡é’ˆå‹ç¼©\nchar[] åŒ…æ‹¬ [c ï¼ˆchar[].classï¼‰å’Œé•¿åº¦ï¼Œ24å­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650420441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372957,"ip_address":""},"score":565247,"extra":""}]},{"author":{"id":2188142,"avatar":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","nickname":"Zå®‡é”¤é”¤","note":"","ucode":"7DB36E986A7A51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372255,"discussion_content":"å¥½çš„ï¼Œå¥½çš„ã€‚æ„Ÿè°¢è€å¸ˆï¼Œæˆ‘å†å»çœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620261106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319250,"user_name":"å¼º","can_delete":false,"product_type":"c1","uid":1035643,"ip_address":"","ucode":"D0A761E25B0740","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/7b/31a6bf42.jpg","comment_is_top":false,"comment_ctime":1635696809,"is_pvip":false,"replies":[{"id":"115946","content":"å¥½é—®é¢˜~ <br>DataFrameå’ŒDatasetçš„å…³ç³»ï¼Œéå¸¸ç´§å¯†ã€‚<br><br>é¦–å…ˆï¼ŒDataFrameå®é™…ä¸Šæ˜¯Dataset[Row]ï¼Œä¸è®ºæ˜¯DataFrameã€è¿˜æ˜¯Datasetï¼Œä»–ä»¬éƒ½èƒ½äº«å—åˆ°Spark SQLå¸¦æ¥çš„æ€§èƒ½çº¢åˆ©ï¼Œå› æ­¤åœ¨æ‰§è¡Œæ•ˆç‡ä¸Šï¼ŒäºŒè€…æ²¡æœ‰åŒºåˆ«ã€‚<br><br>å› æ­¤ï¼Œä¸¤è€…çš„åŒºåˆ«ï¼Œæœ€ä¸»è¦çš„ï¼Œè¿˜æ˜¯åœ¨å¼€å‘æ•ˆç‡ã€‚DataFrameå…¶å®å°±æ˜¯äºŒç»´è¡¨ï¼Œæ‰¿è½½ç»“æ„åŒ–æ•°æ®ã€‚Datasetå¯ä»¥ç”¨æ¥å¤„ç†éç»“æ„åŒ–æ•°æ®ï¼Œä½†æ˜¯Datasetéœ€è¦ç”¨æˆ·æ˜ç¡®å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚è‡ªå®šä¹‰çš„Personã€Schoolä¹‹ç±»çš„ã€‚<br><br>æ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼Œå¦‚æœéœ€è¦å¤„ç†ç»“æ„åŒ–æ•°æ®ï¼Œä¸€èˆ¬å¤§å®¶éƒ½ä¼šç”¨DataFrameï¼Œå› ä¸ºç®€å•ç›´æ¥ï¼Œä¸éœ€è¦è‡ªå®šä¹‰User Classï¼Œçœå»è¿™ä¸€æ­¥çš„éº»çƒ¦ã€‚ä½†å¦‚æœéœ€è¦ä»ï¼ˆéç»“æ„åŒ–ï¼‰æ—¥å¿—è§£æä¸€äº›å†…å®¹ï¼Œå¾€å¾€ä¼šç”¨Datasetå…ˆæŠŠæ•°æ®æŠ½å‡ºæ¥ï¼Œå¾—åˆ°ç»“æ„åŒ–æ•°æ®ä¹‹åï¼Œå†è€ƒè™‘è½¬æˆDataFrameï¼Œæ–¹ä¾¿åç»­å¤„ç†ã€‚<br><br>ä¸€è¨€ä»¥è”½ä¹‹ï¼Œæ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæœ‰ä¸åŒçš„é€‚åº”åœºæ™¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒDataFrameç”¨çš„åå¤šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µï¼Œæˆ‘ä»¬å¤„ç†çš„éƒ½æ˜¯ç»“æ„åŒ–æ•°æ®ã€‚ç›¸åº”åœ°ï¼ŒDatasetç”¨çš„å°±ä¼šå°‘ä¸€äº›ã€‚å¦å¤–ï¼ŒDatasetå–ä»£DataFrameè¿™ç§è¯´æ³•ï¼Œå¬å¬å°±å¥½äº†ï¼Œä¸ç”¨ç‰¹åˆ«å½“çœŸ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635954135,"ip_address":"","comment_id":319250,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930664105","product_id":100073401,"comment_content":"æ›¾ç»çœ‹åˆ°ä¸€ä¸ªè§†é¢‘,è¯´æ˜¯Datasetåç»­è¦å–ä»£DataFrameã€‚Datasetå’ŒDataFrameè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå®é™…é¡¹ç›®ä¸­ç”¨çš„å“ªä¸ªåå¤šäº›ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529555,"discussion_content":"å¥½é—®é¢˜~ \nDataFrameå’ŒDatasetçš„å…³ç³»ï¼Œéå¸¸ç´§å¯†ã€‚\n\né¦–å…ˆï¼ŒDataFrameå®é™…ä¸Šæ˜¯Dataset[Row]ï¼Œä¸è®ºæ˜¯DataFrameã€è¿˜æ˜¯Datasetï¼Œä»–ä»¬éƒ½èƒ½äº«å—åˆ°Spark SQLå¸¦æ¥çš„æ€§èƒ½çº¢åˆ©ï¼Œå› æ­¤åœ¨æ‰§è¡Œæ•ˆç‡ä¸Šï¼ŒäºŒè€…æ²¡æœ‰åŒºåˆ«ã€‚\n\nå› æ­¤ï¼Œä¸¤è€…çš„åŒºåˆ«ï¼Œæœ€ä¸»è¦çš„ï¼Œè¿˜æ˜¯åœ¨å¼€å‘æ•ˆç‡ã€‚DataFrameå…¶å®å°±æ˜¯äºŒç»´è¡¨ï¼Œæ‰¿è½½ç»“æ„åŒ–æ•°æ®ã€‚Datasetå¯ä»¥ç”¨æ¥å¤„ç†éç»“æ„åŒ–æ•°æ®ï¼Œä½†æ˜¯Datasetéœ€è¦ç”¨æˆ·æ˜ç¡®å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚è‡ªå®šä¹‰çš„Personã€Schoolä¹‹ç±»çš„ã€‚\n\næ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼Œå¦‚æœéœ€è¦å¤„ç†ç»“æ„åŒ–æ•°æ®ï¼Œä¸€èˆ¬å¤§å®¶éƒ½ä¼šç”¨DataFrameï¼Œå› ä¸ºç®€å•ç›´æ¥ï¼Œä¸éœ€è¦è‡ªå®šä¹‰User Classï¼Œçœå»è¿™ä¸€æ­¥çš„éº»çƒ¦ã€‚ä½†å¦‚æœéœ€è¦ä»ï¼ˆéç»“æ„åŒ–ï¼‰æ—¥å¿—è§£æä¸€äº›å†…å®¹ï¼Œå¾€å¾€ä¼šç”¨Datasetå…ˆæŠŠæ•°æ®æŠ½å‡ºæ¥ï¼Œå¾—åˆ°ç»“æ„åŒ–æ•°æ®ä¹‹åï¼Œå†è€ƒè™‘è½¬æˆDataFrameï¼Œæ–¹ä¾¿åç»­å¤„ç†ã€‚\n\nä¸€è¨€ä»¥è”½ä¹‹ï¼Œæ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæœ‰ä¸åŒçš„é€‚åº”åœºæ™¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒDataFrameç”¨çš„åå¤šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µï¼Œæˆ‘ä»¬å¤„ç†çš„éƒ½æ˜¯ç»“æ„åŒ–æ•°æ®ã€‚ç›¸åº”åœ°ï¼ŒDatasetç”¨çš„å°±ä¼šå°‘ä¸€äº›ã€‚å¦å¤–ï¼ŒDatasetå–ä»£DataFrameè¿™ç§è¯´æ³•ï¼Œå¬å¬å°±å¥½äº†ï¼Œä¸ç”¨ç‰¹åˆ«å½“çœŸ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635954135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291047,"user_name":"Zå®‡é”¤é”¤","can_delete":false,"product_type":"c1","uid":2188142,"ip_address":"","ucode":"7DB36E986A7A51","user_header":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","comment_is_top":false,"comment_ctime":1619964371,"is_pvip":true,"replies":[{"id":"105475","content":"DFç¡®å®å°±æ˜¯äºŒç»´è¡¨ï¼Œå’ŒRDDç›¸æ¯”ï¼Œé™¤äº†APIçš„åŒºåˆ«ä¹‹å¤–ï¼Œæœ€å¤§çš„åŒºåˆ«ï¼Œè¿˜æ˜¯DFå¯ä»¥èµ°Spark SQLåšä¼˜åŒ–~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620114827,"ip_address":"","comment_id":291047,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5914931667","product_id":100073401,"comment_content":"RDDå’ŒDataFrameçš„æœ€å¤§åŒºåˆ«ï¼ŒDFåƒæ˜¯ä¸€å¼ äºŒç»´è¡¨ï¼Œå¯ä»¥ç”¨æ¥å†™SQLã€‚RDDåªèƒ½ä½¿ç”¨ç®—å­ã€‚","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519351,"discussion_content":"DFç¡®å®å°±æ˜¯äºŒç»´è¡¨ï¼Œå’ŒRDDç›¸æ¯”ï¼Œé™¤äº†APIçš„åŒºåˆ«ä¹‹å¤–ï¼Œæœ€å¤§çš„åŒºåˆ«ï¼Œè¿˜æ˜¯DFå¯ä»¥èµ°Spark SQLåšä¼˜åŒ–~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620114827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2188142,"avatar":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","nickname":"Zå®‡é”¤é”¤","note":"","ucode":"7DB36E986A7A51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372254,"discussion_content":"æ„Ÿè°¢å¤§ä½¬ç¿»ç‰Œå­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620261069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290683,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1619685714,"is_pvip":false,"replies":[{"id":"105345","content":"ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç”¨äºŒè¿›åˆ¶çš„å½¢å¼æ¥å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ä¼šæœ‰ç›¸é€šçš„åœ°æ–¹ã€‚<br><br>ä¸è¿‡ï¼Œä¸¤è€…æ²¡å•¥è”ç³»å“ˆï¼Œå®é™…ä¸Šï¼Œæˆ‘å€’æ˜¯è§‰å¾—ï¼ŒParquetçš„æ•°æ®ç»“æ„ï¼Œè¦æ¯”Tungstençš„å¤æ‚å¾—å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619695476,"ip_address":"","comment_id":290683,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5914653010","product_id":100073401,"comment_content":"Tungstençš„è¿™ç§å­˜å‚¨æ•°æ®ç»“æ„ï¼Œæ„Ÿè§‰å’Œparquetç±»ä¼¼ï¼Œä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆå…³è”å—","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519262,"discussion_content":"ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç”¨äºŒè¿›åˆ¶çš„å½¢å¼æ¥å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ä¼šæœ‰ç›¸é€šçš„åœ°æ–¹ã€‚\n\nä¸è¿‡ï¼Œä¸¤è€…æ²¡å•¥è”ç³»å“ˆï¼Œå®é™…ä¸Šï¼Œæˆ‘å€’æ˜¯è§‰å¾—ï¼ŒParquetçš„æ•°æ®ç»“æ„ï¼Œè¦æ¯”Tungstençš„å¤æ‚å¾—å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619695476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565248,"discussion_content":"Tungstenæ˜¯ä¸€ä¸ªè®¡åˆ’ã€æ˜¯ä¸€ä¸ªè®¡åˆ’ã€æ˜¯ä¸€ä¸ªè®¡åˆ’ï¼Œä¸æ˜¯å­˜å‚¨ã€ä¸æ˜¯å­˜å‚¨ã€ä¸æ˜¯å­˜å‚¨\n\næ¢è¨€ä¹‹ï¼Œæ˜¯ä¸€ç³»åˆ—ä¼˜åŒ–çš„åˆé›†ï¼ï¼ï¼ï¼ï¼ï¼ï¼æ˜¯ä¸€ä¸ªç‰¹æ€§è¿­ä»£ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n\näºŒè¿›åˆ¶å­˜å‚¨åªæ˜¯å…¶ä¸­ç»™ä¸€ä¸ªä¼˜åŒ–ç‚¹è€Œå·²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650420586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290500,"user_name":"sky_sql","can_delete":false,"product_type":"c1","uid":1099273,"ip_address":"","ucode":"397F4263C9E590","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/09/7f2bcc6e.jpg","comment_is_top":false,"comment_ctime":1619592659,"is_pvip":false,"replies":[{"id":"105296","content":"DataFrameåº•å±‚ä¸æ˜¯RDDå®ç°çš„ï¼ŒDataFrameå’ŒRDDæ˜¯ä¸¤å¥—ç‹¬ç«‹çš„APIã€‚åŒºåˆ«åœ¨äºï¼ŒRDDçš„ä¼˜åŒ–å¼•æ“æ˜¯Spark Coreï¼›è€ŒDataFrameçš„ä¼˜åŒ–å¼•æ“æ˜¯Spark SQLï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢3è®²ï¼š21ã€22ã€23ä¼šè¯¦ç»†çš„ä»‹ç»å“ˆ~<br><br>å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¼ºçƒˆæ¨èDataFrameå¼€å‘APIï¼Œæ”¾å¼ƒRDDå¼€å‘APIã€‚Spark SQLçš„ä¼˜åŒ–æœºåˆ¶è¿œèƒœäºSpark Coreï¼Œæ¢å¥è¯è¯´ï¼ŒåŒæ ·çš„ä¸šåŠ¡åº”ç”¨ï¼Œä»…ä»…æ˜¯APIä¸åŒï¼Œä½ ç”¨DataFrameå¼€å‘çš„codeï¼Œå¤©ç„¶åœ°å°±æ¯”ä½ ç”¨RDDå¼€å‘çš„codeï¼Œåœ¨æ‰§è¡Œæ•ˆç‡ä¸Šé¢æ›´é«˜ï¼Œå•¥éƒ½ä¸ç”¨è°ƒä¼˜ï¼Œå¤©ç„¶å°±æ›´å¿«ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619624280,"ip_address":"","comment_id":290500,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5914559955","product_id":100073401,"comment_content":"RDDæ˜¯Sparkå¯¹äºåˆ†å¸ƒå¼æ•°æ®æ¨¡å‹çš„æŠ½è±¡ï¼Œè°ƒåº¦ã€å­˜å‚¨éƒ½æ˜¯RDDç»´åº¦çš„ï¼ŒDataFrameåº•å±‚æ˜¯ä½¿ç”¨RDDçš„ç®—å­å®ç°çš„å§ï¼Ÿ<br>å¯¹äºæ™®é€šå¼€å‘è€…åé¢ä½¿ç”¨DataFrameå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå°½é‡ä¸ä½¿ç”¨RDDï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519218,"discussion_content":"DataFrameåº•å±‚ä¸æ˜¯RDDå®ç°çš„ï¼ŒDataFrameå’ŒRDDæ˜¯ä¸¤å¥—ç‹¬ç«‹çš„APIã€‚åŒºåˆ«åœ¨äºï¼ŒRDDçš„ä¼˜åŒ–å¼•æ“æ˜¯Spark Coreï¼›è€ŒDataFrameçš„ä¼˜åŒ–å¼•æ“æ˜¯Spark SQLï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢3è®²ï¼š21ã€22ã€23ä¼šè¯¦ç»†çš„ä»‹ç»å“ˆ~\n\nå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¼ºçƒˆæ¨èDataFrameå¼€å‘APIï¼Œæ”¾å¼ƒRDDå¼€å‘APIã€‚Spark SQLçš„ä¼˜åŒ–æœºåˆ¶è¿œèƒœäºSpark Coreï¼Œæ¢å¥è¯è¯´ï¼ŒåŒæ ·çš„ä¸šåŠ¡åº”ç”¨ï¼Œä»…ä»…æ˜¯APIä¸åŒï¼Œä½ ç”¨DataFrameå¼€å‘çš„codeï¼Œå¤©ç„¶åœ°å°±æ¯”ä½ ç”¨RDDå¼€å‘çš„codeï¼Œåœ¨æ‰§è¡Œæ•ˆç‡ä¸Šé¢æ›´é«˜ï¼Œå•¥éƒ½ä¸ç”¨è°ƒä¼˜ï¼Œå¤©ç„¶å°±æ›´å¿«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619624280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375924,"discussion_content":"æœ€ç»ˆå´æ˜¯ä¼šè½¬åŒ–ä¸ºRDD[InternalRow]ä¸Šçš„è®¡ç®—ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰Spark SQLå¯¹DataFrameåšçš„æ‰€æœ‰ä¼˜åŒ–ï¼Œå’ŒRDDæ˜¯æ²¡ä»€ä¹ˆå…³ç³»çš„","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1621869794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179297,"avatar":"","nickname":"kris37","note":"","ucode":"65555B42CFF0A1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371148,"discussion_content":"SparkSQLè¿˜æ˜¯ç”Ÿæˆçš„RDDè®¡åˆ’å§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619664377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334430,"user_name":"October","can_delete":false,"product_type":"c1","uid":1137879,"ip_address":"","ucode":"CEDA78F4A5F8B1","user_header":"https://static001.geekbang.org/account/avatar/00/11/5c/d7/e4673fde.jpg","comment_is_top":false,"comment_ctime":1644931826,"is_pvip":false,"replies":[{"id":"122403","content":"æ ‡é‡å‡½æ•°ï¼Œæ˜¯å’Œâ€œé«˜é˜¶å‡½æ•°â€ç›¸å¯¹çš„ã€‚ç®€å•ç†è§£ï¼Œæ ‡é‡å‡½æ•°ï¼Œå°±æ˜¯æ™®é€šå‡½æ•°ï¼Œè®¡ç®—é€»è¾‘æ˜¯ç¡®å®šçš„ï¼Œæ¯”å¦‚selectï¼Œå°±æ˜¯æ•°æ®åˆ—æŠ•å½±ï¼Œæ¯”å¦‚addï¼Œå°±æ˜¯ä¸¤ä¸ªæ•°å€¼ç›¸åŠ ã€‚é«˜é˜¶å‡½æ•°ä¸åŒï¼Œæ¯”å¦‚mapã€filterè¿™äº›ï¼ŒSparkå¹¶ä¸çŸ¥é“mapã€filteré‡Œé¢ï¼Œç”¨çš„æ˜¯ä»€ä¹ˆå‡½æ•°ï¼Œä»€ä¹ˆæ˜ å°„é€»è¾‘ï¼Œä»€ä¹ˆè¿‡æ»¤é€»è¾‘ï¼Œæ‰€ä»¥æ²¡æ³•ä¼˜åŒ–ã€‚å¯¹äºåƒselectã€addï¼Œè¿™äº›ç¡®å®šçš„é€»è¾‘ï¼ŒSpark SQLå¯ä»¥æ ¹æ®ASTï¼ˆè¯­æ³•æ ‘ï¼‰è¿˜æœ‰ä¸€ç³»åˆ—çš„ä¼˜åŒ–è§„åˆ™ï¼ŒæŠŠå¼€å‘è€…åŸæ¥çš„ä»£ç ï¼Œä¸€æ­¥æ­¥ä¼˜åŒ–ï¼Œè¿›è€Œæé«˜æ‰§è¡Œæ€§èƒ½ï¼Œå¯ä»¥å…³æ³¨åé¢çš„Catalystå’ŒTungsten","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1645369843,"ip_address":"","comment_id":334430,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1644931826","product_id":100073401,"comment_content":"è€å¸ˆå¥½ï¼Œè¿˜æ˜¯ä¸æ˜¯å¾ˆç†è§£ä»€ä¹ˆæ˜¯æ ‡é‡å‡½æ•°å’Œæ ‡é‡ç®—å­ã€‚ä¸ºä»€ä¹ˆæ ‡é‡ç®—å­å°±å³èƒ½çŸ¥é“åšä»€ä¹ˆï¼Œåˆèƒ½çŸ¥é“æ€ä¹ˆåš","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552262,"discussion_content":"æ ‡é‡å‡½æ•°ï¼Œæ˜¯å’Œâ€œé«˜é˜¶å‡½æ•°â€ç›¸å¯¹çš„ã€‚ç®€å•ç†è§£ï¼Œæ ‡é‡å‡½æ•°ï¼Œå°±æ˜¯æ™®é€šå‡½æ•°ï¼Œè®¡ç®—é€»è¾‘æ˜¯ç¡®å®šçš„ï¼Œæ¯”å¦‚selectï¼Œå°±æ˜¯æ•°æ®åˆ—æŠ•å½±ï¼Œæ¯”å¦‚addï¼Œå°±æ˜¯ä¸¤ä¸ªæ•°å€¼ç›¸åŠ ã€‚é«˜é˜¶å‡½æ•°ä¸åŒï¼Œæ¯”å¦‚mapã€filterè¿™äº›ï¼ŒSparkå¹¶ä¸çŸ¥é“mapã€filteré‡Œé¢ï¼Œç”¨çš„æ˜¯ä»€ä¹ˆå‡½æ•°ï¼Œä»€ä¹ˆæ˜ å°„é€»è¾‘ï¼Œä»€ä¹ˆè¿‡æ»¤é€»è¾‘ï¼Œæ‰€ä»¥æ²¡æ³•ä¼˜åŒ–ã€‚å¯¹äºåƒselectã€addï¼Œè¿™äº›ç¡®å®šçš„é€»è¾‘ï¼ŒSpark SQLå¯ä»¥æ ¹æ®ASTï¼ˆè¯­æ³•æ ‘ï¼‰è¿˜æœ‰ä¸€ç³»åˆ—çš„ä¼˜åŒ–è§„åˆ™ï¼ŒæŠŠå¼€å‘è€…åŸæ¥çš„ä»£ç ï¼Œä¸€æ­¥æ­¥ä¼˜åŒ–ï¼Œè¿›è€Œæé«˜æ‰§è¡Œæ€§èƒ½ï¼Œå¯ä»¥å…³æ³¨åé¢çš„Catalystå’ŒTungsten","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645369844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565249,"discussion_content":"è€å¸ˆè¯´çš„ä¸å¯¹ï¼Œä½ æƒ³äº†è§£ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹scalaå‡½æ•°å¼ç¼–ç¨‹å°çº¢ä¹¦\n\nå…·ä½“å¯ä»¥äº†è§£ä¸€ä¸‹ï¼šMonoidï¼ŒFunctorï¼ŒApplicativeï¼Œ Monad","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650420701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325643,"user_name":"Pytrick","can_delete":false,"product_type":"c1","uid":1690447,"ip_address":"","ucode":"2759D2BB51D981","user_header":"https://static001.geekbang.org/account/avatar/00/19/cb/4f/7466a488.jpg","comment_is_top":false,"comment_ctime":1639057500,"is_pvip":false,"replies":[{"id":"118186","content":"æ²¡é”™ï¼Œè€å¼Ÿè¿™ä¸€ç‚¹æçš„ç›¸å½“å¥½~<br><br>ç¡®å®ï¼Œpandas udfå¯ä»¥æ¯”æ™®é€šçš„UDFå¿«å‡ å€åˆ°åå‡ å€ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼Œä¹‹å‰ç›´æ’­çš„æ—¶å€™æœ‰æè¿‡ï¼Œæ­£æ–‡å±…ç„¶å¿˜äº†è¯´äº†ï¼Œå“ˆå“ˆ~<br><br>åŠ é¤å›å¤´ç»Ÿä¸€è€ƒè™‘è€ƒè™‘ï¼ŒSparkå¯ä»¥åŠ é¤çš„å†…å®¹å¤ªå¤šäº†ï¼Œæ¯”å¦‚æœ€è¿‘çš„delta lakeã€project hydrogenã€koalasï¼ŒåŒ…æ‹¬3.2çš„æ–°ç‰¹æ€§ï¼Œç­‰ç­‰ï¼Œå›å¤´ç»Ÿä¸€è€ƒè™‘ä¸‹~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1639149904,"ip_address":"","comment_id":325643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639057500","product_id":100073401,"comment_content":"è€å¸ˆï¼Œ æˆ‘è§‰å¾—æœ‰ä¸ªé‡è¦çš„ä¼˜åŒ–æ²¡æœ‰è®²åˆ°å‘€ï¼Œ ç”¨pyspark + data frameå¼€å‘çš„æ—¶å€™ï¼Œä½¿ç”¨pandas udfå¯ä»¥æ¯”æ™®é€šçš„UDFå¿«å‡ å€åˆ°åå‡ å€ ã€‚  å¯ä»¥åŠ é¤ä¸€ä¸ªpandas UDFçš„ä½¿ç”¨ï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537724,"discussion_content":"æ²¡é”™ï¼Œè€å¼Ÿè¿™ä¸€ç‚¹æçš„ç›¸å½“å¥½~\n\nç¡®å®ï¼Œpandas udfå¯ä»¥æ¯”æ™®é€šçš„UDFå¿«å‡ å€åˆ°åå‡ å€ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼Œä¹‹å‰ç›´æ’­çš„æ—¶å€™æœ‰æè¿‡ï¼Œæ­£æ–‡å±…ç„¶å¿˜äº†è¯´äº†ï¼Œå“ˆå“ˆ~\n\nåŠ é¤å›å¤´ç»Ÿä¸€è€ƒè™‘è€ƒè™‘ï¼ŒSparkå¯ä»¥åŠ é¤çš„å†…å®¹å¤ªå¤šäº†ï¼Œæ¯”å¦‚æœ€è¿‘çš„delta lakeã€project hydrogenã€koalasï¼ŒåŒ…æ‹¬3.2çš„æ–°ç‰¹æ€§ï¼Œç­‰ç­‰ï¼Œå›å¤´ç»Ÿä¸€è€ƒè™‘ä¸‹~","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639149904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324871,"user_name":"wayne","can_delete":false,"product_type":"c1","uid":1811813,"ip_address":"","ucode":"988E1F2F0B419A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","comment_is_top":false,"comment_ctime":1638695832,"is_pvip":true,"replies":[{"id":"118128","content":"ç°åœ¨å·²ç»ä¸å­˜åœ¨äº†å“ˆï¼ˆSpark 2.0+ï¼‰ï¼Œç°åœ¨åº•å±‚éƒ½æ˜¯Spark SQLä¼˜åŒ–å¼•æ“ï¼ŒPythonçš„æ€§èƒ½å’ŒScalaçš„å·®ä¸å¤šçš„ï¼Œè™½è¯´è¿˜æœ‰äº›å·®å¼‚ï¼Œä½†æ˜¯æ²¡é‚£ä¹ˆæ˜¾è‘—äº†~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1639046246,"ip_address":"","comment_id":324871,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1638695832","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ—¢ç„¶pysparkå’Œspark(scala)æ€§èƒ½å·®è·å·¨å¤§ï¼Œé‚£ä¹ˆpyspark-sqlå’Œspark-sql(sql)çš„æ€§èƒ½å·®å¼‚ä¹Ÿæ˜¯å·¨å¤§å—ï¼Ÿç›®å‰æˆ‘ä»¬å…¬å¸é‡‡ç”¨çš„æ˜¯å‘yarné›†ç¾¤ä¸­æäº¤.pyæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨pyspark =&gt; spark.sql()çš„æ–¹å¼æ‰§è¡Œsql","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537382,"discussion_content":"ç°åœ¨å·²ç»ä¸å­˜åœ¨äº†å“ˆï¼ˆSpark 2.0+ï¼‰ï¼Œç°åœ¨åº•å±‚éƒ½æ˜¯Spark SQLä¼˜åŒ–å¼•æ“ï¼ŒPythonçš„æ€§èƒ½å’ŒScalaçš„å·®ä¸å¤šçš„ï¼Œè™½è¯´è¿˜æœ‰äº›å·®å¼‚ï¼Œä½†æ˜¯æ²¡é‚£ä¹ˆæ˜¾è‘—äº†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639046246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1811813,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","nickname":"wayne","note":"","ucode":"988E1F2F0B419A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":540915,"discussion_content":"é‚£è€å¸ˆï¼Œæƒ³é—®ä¸€ä¸‹Scalaè¿™é—¨è¯­è¨€ä½ æ€ä¹ˆçœ‹ï¼ŒScalaä¼šä¸ä¼šæ²¡è½ ä»¥åçš„å¤§æ•°æ®  ä»¥è‡´äºæ²¡äººç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640192672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537382,"ip_address":""},"score":540915,"extra":""},{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1811813,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","nickname":"wayne","note":"","ucode":"988E1F2F0B419A","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":565250,"discussion_content":"ä½ å…ˆæŠŠ javaå­¦å·äº†ï¼Œåœ¨è¯´scalaå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650420772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":540915,"ip_address":""},"score":565250,"extra":""}]}]}]}