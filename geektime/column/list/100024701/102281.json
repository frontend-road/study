{"id":102281,"title":"37 | ä¿¡å·ï¼ˆä¸Šï¼‰ï¼šé¡¹ç›®ç»„Aå®Œæˆäº†ï¼Œå¦‚ä½•åŠæ—¶é€šçŸ¥é¡¹ç›®ç»„Bï¼Ÿ","content":"<p>ä¸Šä¸€èŠ‚æœ€åï¼Œæˆ‘ä»¬è®²äº†ä¿¡å·çš„æœºåˆ¶ã€‚åœ¨æŸäº›ç´§æ€¥æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç»™è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œç´§æ€¥å¤„ç†ä¸€äº›äº‹æƒ…ã€‚</p><p>è¿™ç§æ–¹å¼æœ‰ç‚¹å„¿åƒå’±ä»¬è¿ç»´ä¸€ä¸ªçº¿ä¸Šç³»ç»Ÿï¼Œä¸ºäº†åº”å¯¹ä¸€äº›çªå‘äº‹ä»¶ï¼Œå¾€å¾€éœ€è¦åˆ¶å®šåº”æ€¥é¢„æ¡ˆã€‚å°±åƒä¸‹é¢çš„åˆ—è¡¨ä¸­ä¸€æ ·ã€‚ä¸€æ—¦å‘ç”Ÿäº†çªå‘äº‹ä»¶ï¼Œé©¬ä¸Šèƒ½å¤Ÿæ‰¾åˆ°è´Ÿè´£äººï¼Œæ ¹æ®å¤„ç†æ­¥éª¤è¿›è¡Œç´§æ€¥å“åº”ï¼Œå¹¶ä¸”åœ¨é™å®šçš„äº‹ä»¶å†…æå®šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/49/0c/498199918340c55f59c91129ceb59f0c.png?wh=1268*458\" alt=\"\"></p><p>æˆ‘ä»¬ç°åœ¨å°±æŒ‰ç…§åº”æ€¥é¢„æ¡ˆçš„è®¾è®¡æ€è·¯ï¼Œæ¥çœ‹ä¸€çœ‹Linuxä¿¡å·ç³»ç»Ÿçš„æœºåˆ¶ã€‚</p><p>é¦–å…ˆï¼Œç¬¬ä¸€ä»¶è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼Œæ•´ä¸ªå›¢é˜Ÿè¦æƒ³ä¸€ä¸‹ï¼Œçº¿ä¸Šåˆ°åº•èƒ½å¤Ÿäº§ç”Ÿå“ªäº›å¼‚å¸¸æƒ…å†µï¼Œè¶Šå…¨è¶Šå¥½ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸Šé¢è¿™ä¸ªå¾ˆé•¿å¾ˆé•¿çš„åˆ—è¡¨ã€‚</p><p>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸­ï¼Œä¸ºäº†å“åº”å„ç§å„æ ·çš„äº‹ä»¶ï¼Œä¹Ÿæ˜¯å®šä¹‰äº†éå¸¸å¤šçš„ä¿¡å·ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡kill -lå‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„ä¿¡å·ã€‚</p><pre><code># kill -l\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP\n 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1\n11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM\n16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP\n21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ\n26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR\n31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3\n38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8\n43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13\n48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12\n53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7\n58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2\n63) SIGRTMAX-1  64) SIGRTMAX\n</code></pre><p>è¿™äº›ä¿¡å·éƒ½æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡man 7 signalå‘½ä»¤æŸ¥çœ‹ï¼Œé‡Œé¢ä¼šæœ‰ä¸€ä¸ªåˆ—è¡¨ã€‚</p><pre><code>Signal     Value     Action   Comment\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSIGHUP        1       Term    Hangup detected on controlling terminal\n                              or death of controlling process\nSIGINT        2       Term    Interrupt from keyboard\nSIGQUIT       3       Core    Quit from keyboard\nSIGILL        4       Core    Illegal Instruction\n\n\nSIGABRT       6       Core    Abort signal from abort(3)\nSIGFPE        8       Core    Floating point exception\nSIGKILL       9       Term    Kill signal\nSIGSEGV      11       Core    Invalid memory reference\nSIGPIPE      13       Term    Broken pipe: write to pipe with no\n                              readers\nSIGALRM      14       Term    Timer signal from alarm(2)\nSIGTERM      15       Term    Termination signal\nSIGUSR1   30,10,16    Term    User-defined signal 1\nSIGUSR2   31,12,17    Term    User-defined signal 2\nâ€¦â€¦\n</code></pre><p>å°±åƒåº”æ€¥é¢„æ¡ˆé‡Œé¢ç»™å‡ºçš„ä¸€æ ·ï¼Œæ¯ä¸ªä¿¡å·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œè¿˜æœ‰é‡åˆ°è¿™ä¸ªä¿¡å·çš„æ—¶å€™çš„é»˜è®¤æ“ä½œã€‚</p><p>ä¸€æ—¦æœ‰ä¿¡å·äº§ç”Ÿï¼Œæˆ‘ä»¬å°±æœ‰ä¸‹é¢è¿™å‡ ç§ï¼Œç”¨æˆ·è¿›ç¨‹å¯¹ä¿¡å·çš„å¤„ç†æ–¹å¼ã€‚</p><p>1.<strong>æ‰§è¡Œé»˜è®¤æ“ä½œ</strong>ã€‚Linuxå¯¹æ¯ç§ä¿¡å·éƒ½è§„å®šäº†é»˜è®¤æ“ä½œï¼Œä¾‹å¦‚ï¼Œä¸Šé¢åˆ—è¡¨ä¸­çš„Termï¼Œå°±æ˜¯ç»ˆæ­¢è¿›ç¨‹çš„æ„æ€ã€‚Coreçš„æ„æ€æ˜¯Core Dumpï¼Œä¹Ÿå³ç»ˆæ­¢è¿›ç¨‹åï¼Œé€šè¿‡Core Dumpå°†å½“å‰è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ä¿å­˜åœ¨æ–‡ä»¶é‡Œé¢ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜äº‹åè¿›è¡Œåˆ†æé—®é¢˜åœ¨å“ªé‡Œã€‚</p><!-- [[[read_end]]] --><p>2.<strong>æ•æ‰ä¿¡å·</strong>ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºä¿¡å·å®šä¹‰ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚å½“ä¿¡å·å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬å°±æ‰§è¡Œç›¸åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚</p><p>3.<strong>å¿½ç•¥ä¿¡å·</strong>ã€‚å½“æˆ‘ä»¬ä¸å¸Œæœ›å¤„ç†æŸäº›ä¿¡å·çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¿½ç•¥è¯¥ä¿¡å·ï¼Œä¸åšä»»ä½•å¤„ç†ã€‚æœ‰ä¸¤ä¸ªä¿¡å·æ˜¯åº”ç”¨è¿›ç¨‹æ— æ³•æ•æ‰å’Œå¿½ç•¥çš„ï¼Œå³SIGKILLå’ŒSEGSTOPï¼Œå®ƒä»¬ç”¨äºåœ¨ä»»ä½•æ—¶å€™ä¸­æ–­æˆ–ç»“æŸæŸä¸€è¿›ç¨‹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¿¡å·å¤„ç†æœ€å¸¸è§çš„æµç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯åˆ†æˆä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ã€‚ç¬¬äºŒæ­¥æ˜¯å‘é€ä¿¡å·ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸»è¦çœ‹ç¬¬ä¸€æ­¥ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³è®©æŸä¸ªä¿¡å·æ‰§è¡Œé»˜è®¤æ“ä½œï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¯¹ç‰¹å®šçš„ä¿¡å·æ³¨å†Œç›¸åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè®¾ç½®ä¿¡å·å¤„ç†æ–¹å¼çš„æ˜¯<strong>signalå‡½æ•°</strong>ã€‚</p><pre><code>typedef void (*sighandler_t)(int);\nsighandler_t signal(int signum, sighandler_t handler);\n</code></pre><p>è¿™å…¶å®å°±æ˜¯å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ–¹æ³•å’ŒæŸä¸ªä¿¡å·å…³è”èµ·æ¥ã€‚å½“è¿™ä¸ªè¿›ç¨‹é‡åˆ°è¿™ä¸ªä¿¡å·çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨Linuxä¸‹é¢æ‰§è¡Œman signalçš„è¯ï¼Œä¼šå‘ç°Linuxä¸å»ºè®®æˆ‘ä»¬ç›´æ¥ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯æ”¹ç”¨sigactionã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>int sigaction(int signum, const struct sigaction *act,\n                     struct sigaction *oldact);\n</code></pre><p>è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿå…¶å®å®ƒè¿˜æ˜¯å°†ä¿¡å·å’Œä¸€ä¸ªåŠ¨ä½œè¿›è¡Œå…³è”ï¼Œåªä¸è¿‡è¿™ä¸ªåŠ¨ä½œç”±ä¸€ä¸ªç»“æ„struct sigactionè¡¨ç¤ºäº†ã€‚</p><pre><code>struct sigaction {\n\t__sighandler_t sa_handler;\n\tunsigned long sa_flags;\n\t__sigrestore_t sa_restorer;\n\tsigset_t sa_mask;\t\t/* mask last for extensibility */\n};\n</code></pre><p>å’Œsignalç±»ä¼¼çš„æ˜¯ï¼Œè¿™é‡Œé¢è¿˜æ˜¯æœ‰__sighandler_tã€‚ä½†æ˜¯ï¼Œå…¶ä»–æˆå‘˜å˜é‡å¯ä»¥è®©ä½ æ›´åŠ ç»†è‡´åœ°æ§åˆ¶ä¿¡å·å¤„ç†çš„è¡Œä¸ºã€‚è€Œsignalå‡½æ•°æ²¡æœ‰ç»™ä½ æœºä¼šè®¾ç½®è¿™äº›ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsignalä¸æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯glibcå°è£…çš„ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ ·å°±åƒman signalé‡Œé¢å†™çš„ä¸€æ ·ï¼Œä¸åŒçš„å®ç°æ–¹å¼ï¼Œè®¾ç½®çš„å‚æ•°ä¼šä¸åŒï¼Œä¼šå¯¼è‡´è¡Œä¸ºçš„ä¸åŒã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨glibcé‡Œé¢ä¼šçœ‹åˆ°äº†è¿™æ ·ä¸€ä¸ªå®ç°ï¼š</p><pre><code>#  define signal __sysv_signal\n__sighandler_t\n__sysv_signal (int sig, __sighandler_t handler)\n{\n  struct sigaction act, oact;\n......\n  act.sa_handler = handler;\n  __sigemptyset (&amp;act.sa_mask);\n  act.sa_flags = SA_ONESHOT | SA_NOMASK | SA_INTERRUPT;\n  act.sa_flags &amp;= ~SA_RESTART;\n  if (__sigaction (sig, &amp;act, &amp;oact) &lt; 0)\n    return SIG_ERR;\n  return oact.sa_handler;\n}\nweak_alias (__sysv_signal, sysv_signal)\n</code></pre><p>åœ¨è¿™é‡Œé¢ï¼Œsa_flagsè¿›è¡Œäº†é»˜è®¤çš„è®¾ç½®ã€‚SA_ONESHOTæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ„æ€å°±æ˜¯ï¼Œè¿™é‡Œè®¾ç½®çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä»…ä»…èµ·ä½œç”¨ä¸€æ¬¡ã€‚ç”¨å®Œäº†ä¸€æ¬¡åï¼Œå°±è®¾ç½®å›é»˜è®¤è¡Œä¸ºã€‚è¿™å…¶å®å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„ã€‚æ¯•ç«Ÿæˆ‘ä»¬ä¸€æ—¦å®‰è£…äº†ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè‚¯å®šå¸Œæœ›å®ƒä¸€ç›´èµ·ä½œç”¨ï¼Œç›´åˆ°æˆ‘æ˜¾å¼åœ°å…³é—­å®ƒã€‚</p><p>å¦å¤–ä¸€ä¸ªè®¾ç½®å°±æ˜¯<strong>SA_NOMASK</strong>ã€‚æˆ‘ä»¬é€šè¿‡__sigemptysetï¼Œå°†sa_maskè®¾ç½®ä¸ºç©ºã€‚è¿™æ ·çš„è®¾ç½®è¡¨ç¤ºåœ¨è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå†æœ‰å…¶ä»–ä¿¡å·ï¼Œå“ªæ€•ç›¸åŒçš„ä¿¡å·åˆ°æ¥çš„æ—¶å€™ï¼Œè¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°ä¼šè¢«ä¸­æ–­ã€‚å¦‚æœä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°çœŸçš„è¢«å…¶ä»–ä¿¡å·ä¸­æ–­ï¼Œå…¶å®é—®é¢˜ä¹Ÿä¸å¤§ï¼Œå› ä¸ºå½“å¤„ç†å®Œäº†å…¶ä»–çš„ä¿¡å·å¤„ç†å‡½æ•°åï¼Œè¿˜ä¼šå›æ¥æ¥ç€å¤„ç†è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°çš„ï¼Œä½†æ˜¯å¯¹äºç›¸åŒçš„ä¿¡å·å°±æœ‰ç‚¹å°´å°¬äº†ï¼Œè¿™å°±éœ€è¦è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°å†™å¾—æ¯”è¾ƒæœ‰æŠ€å·§äº†ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯¹äºè¿™ä¸ªä¿¡å·çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œè¦æ“ä½œæŸä¸ªæ•°æ®ç»“æ„ï¼Œå› ä¸ºæ˜¯ç›¸åŒçš„ä¿¡å·ï¼Œå¾ˆå¯èƒ½æ“ä½œçš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ ·çš„è¯ï¼ŒåŒæ­¥ã€æ­»é”è¿™äº›éƒ½è¦æƒ³å¥½ã€‚å…¶å®ä¸€èˆ¬çš„æ€è·¯åº”è¯¥æ˜¯ï¼Œå½“æŸä¸€ä¸ªä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬æš‚æ—¶å±è”½è¿™ä¸ªä¿¡å·ã€‚åé¢æˆ‘ä»¬è¿˜ä¼šä»”ç»†åˆ†æå±è”½è¿™ä¸ªåŠ¨ä½œï¼Œå±è”½å¹¶ä¸æ„å‘³ç€ä¿¡å·ä¸€å®šä¸¢å¤±ï¼Œè€Œæ˜¯æš‚å­˜ï¼Œè¿™æ ·èƒ½å¤Ÿåšåˆ°ä¿¡å·å¤„ç†å‡½æ•°å¯¹äºç›¸åŒçš„ä¿¡å·ï¼Œå¤„ç†å®Œä¸€ä¸ªå†å¤„ç†ä¸‹ä¸€ä¸ªï¼Œè¿™æ ·ä¿¡å·å¤„ç†å‡½æ•°çš„é€»è¾‘è¦ç®€å•å¾—å¤šã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªè®¾ç½®å°±æ˜¯è®¾ç½®äº†<strong>SA_INTERRUPTï¼Œæ¸…é™¤äº†SA_RESTART</strong>ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œä¿¡å·çš„åˆ°æ¥æ—¶é—´æ˜¯ä¸å¯é¢„æœŸçš„ï¼Œæœ‰å¯èƒ½ç¨‹åºæ­£åœ¨è°ƒç”¨æŸä¸ªæ¼«é•¿çš„ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼ˆä½ å¯ä»¥åœ¨ä¸€å°Linuxæœºå™¨ä¸Šè¿è¡Œman 7 signalå‘½ä»¤ï¼Œåœ¨è¿™é‡Œæ‰¾Interruption of system calls and library functions by signal handlersçš„éƒ¨åˆ†ï¼Œé‡Œé¢è¯´å¾—éå¸¸è¯¦ç»†ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ä¸€ä¸ªä¿¡å·æ¥äº†ï¼Œä¼šä¸­æ–­è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå»æ‰§è¡Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œé‚£æ‰§è¡Œå®Œäº†ä»¥åå‘¢ï¼Ÿç³»ç»Ÿè°ƒç”¨æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™æœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼Œä¸€ç§å°±æ˜¯SA_INTERRUPTï¼Œä¹Ÿå³ç³»ç»Ÿè°ƒç”¨è¢«ä¸­æ–­äº†ï¼Œå°±ä¸å†é‡è¯•è¿™ä¸ªç³»ç»Ÿè°ƒç”¨äº†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ª-EINTRå¸¸é‡ï¼Œå‘Šè¯‰è°ƒç”¨æ–¹ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­äº†ï¼Œä½†æ˜¯æ€ä¹ˆå¤„ç†ä½ çœ‹ç€åŠã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œè°ƒç”¨æ–¹å¯ä»¥æ ¹æ®è‡ªå·±çš„é€»è¾‘ï¼Œé‡æ–°è°ƒç”¨æˆ–è€…ç›´æ¥è¿”å›ï¼Œè¿™ä¼šä½¿å¾—æˆ‘ä»¬çš„ä»£ç éå¸¸å¤æ‚ï¼Œåœ¨æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼åˆ¤æ–­é‡Œé¢ï¼Œéƒ½è¦ç‰¹æ®Šåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªå€¼ã€‚</p><p>å¦å¤–ä¸€ç§å¤„ç†æ–¹æ³•æ˜¯SA_RESTARTã€‚è¿™ä¸ªæ—¶å€™ç³»ç»Ÿè°ƒç”¨ä¼šè¢«è‡ªåŠ¨é‡æ–°å¯åŠ¨ï¼Œä¸éœ€è¦è°ƒç”¨æ–¹è‡ªå·±å†™ä»£ç ã€‚å½“ç„¶ä¹Ÿå¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œä¾‹å¦‚ä»ç»ˆç«¯è¯»å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥ä¸€ä¸ª<code>'a'</code>å­—ç¬¦ï¼Œåœ¨å¤„ç†<code>'a'</code>å­—ç¬¦çš„æ—¶å€™è¢«ä¿¡å·ä¸­æ–­äº†ï¼Œç­‰ä¿¡å·å¤„ç†å®Œæ¯•ï¼Œå†æ¬¡è¯»å…¥ä¸€ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼Œå¦‚æœç”¨æˆ·ä¸å†è¾“å…¥ï¼Œå°±åœåœ¨é‚£é‡Œäº†ï¼Œéœ€è¦ç”¨æˆ·å†æ¬¡è¾“å…¥åŒä¸€ä¸ªå­—ç¬¦ã€‚</p><p>å› æ­¤ï¼Œå»ºè®®ä½ ä½¿ç”¨sigactionå‡½æ•°ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦å®šåˆ¶å‚æ•°ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹sigactionå…·ä½“åšäº†äº›ä»€ä¹ˆã€‚</p><p>è¿˜è®°å¾—åœ¨å­¦ä¹ ç³»ç»Ÿè°ƒç”¨é‚£ä¸€èŠ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œglibcé‡Œé¢æœ‰ä¸ªæ–‡ä»¶syscalls.listã€‚è¿™é‡Œé¢å®šä¹‰äº†åº“å‡½æ•°è°ƒç”¨å“ªäº›ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°äº†sigactionã€‚</p><pre><code>sigaction    -       sigaction       i:ipp   __sigaction     sigaction\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œåœ¨glibcä¸­ï¼Œ__sigactionä¼šè°ƒç”¨__libc_sigactionï¼Œå¹¶æœ€ç»ˆè°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨æ˜¯rt_sigactionã€‚</p><pre><code>int\n__sigaction (int sig, const struct sigaction *act, struct sigaction *oact)\n{\n......\n  return __libc_sigaction (sig, act, oact);\n}\n\n\nint\n__libc_sigaction (int sig, const struct sigaction *act, struct sigaction *oact)\n{\n  int result;\n  struct kernel_sigaction kact, koact;\n\n\n  if (act)\n    {\n      kact.k_sa_handler = act-&gt;sa_handler;\n      memcpy (&amp;kact.sa_mask, &amp;act-&gt;sa_mask, sizeof (sigset_t));\n      kact.sa_flags = act-&gt;sa_flags | SA_RESTORER;\n\n\n      kact.sa_restorer = &amp;restore_rt;\n    }\n\n\n  result = INLINE_SYSCALL (rt_sigaction, 4,\n                           sig, act ? &amp;kact : NULL,\n                           oact ? &amp;koact : NULL, _NSIG / 8);\n  if (oact &amp;&amp; result &gt;= 0)\n    {\n      oact-&gt;sa_handler = koact.k_sa_handler;\n      memcpy (&amp;oact-&gt;sa_mask, &amp;koact.sa_mask, sizeof (sigset_t));\n      oact-&gt;sa_flags = koact.sa_flags;\n      oact-&gt;sa_restorer = koact.sa_restorer;\n    }\n  return result;\n}\n</code></pre><p>è¿™ä¹Ÿæ˜¯å¾ˆå¤šäººçœ‹ä¿¡å·å¤„ç†çš„å†…æ ¸å®ç°çš„æ—¶å€™ï¼Œæ¯”è¾ƒå›°æƒ‘çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œå†…æ ¸ä»£ç æ³¨é‡Šé‡Œé¢ä¼šè¯´ï¼Œç³»ç»Ÿè°ƒç”¨signalæ˜¯ä¸ºäº†å…¼å®¹è¿‡å»ï¼Œç³»ç»Ÿè°ƒç”¨sigactionä¹Ÿæ˜¯ä¸ºäº†å…¼å®¹è¿‡å»ï¼Œè¿å‚æ•°éƒ½å˜æˆäº†struct compat_old_sigactionï¼Œæ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬çš„åº“å‡½æ•°è™½ç„¶è°ƒç”¨çš„æ˜¯sigactionï¼Œåˆ°äº†ç³»ç»Ÿè°ƒç”¨å±‚ï¼Œè°ƒç”¨çš„å¯ä¸æ˜¯ç³»ç»Ÿè°ƒç”¨sigactionï¼Œè€Œæ˜¯ç³»ç»Ÿè°ƒç”¨rt_sigactionã€‚</p><pre><code>SYSCALL_DEFINE4(rt_sigaction, int, sig,\n\t\tconst struct sigaction __user *, act,\n\t\tstruct sigaction __user *, oact,\n\t\tsize_t, sigsetsize)\n{\n\tstruct k_sigaction new_sa, old_sa;\n\tint ret = -EINVAL;\n......\n\tif (act) {\n\t\tif (copy_from_user(&amp;new_sa.sa, act, sizeof(new_sa.sa)))\n\t\t\treturn -EFAULT;\n\t}\n\n\n\tret = do_sigaction(sig, act ? &amp;new_sa : NULL, oact ? &amp;old_sa : NULL);\n\n\n\tif (!ret &amp;&amp; oact) {\n\t\tif (copy_to_user(oact, &amp;old_sa.sa, sizeof(old_sa.sa)))\n\t\t\treturn -EFAULT;\n\t}\nout:\n\treturn ret;\n}\n</code></pre><p>åœ¨rt_sigactioné‡Œé¢ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·æ€çš„struct sigactionç»“æ„ï¼Œæ‹·è´ä¸ºå†…æ ¸æ€çš„k_sigactionï¼Œç„¶åè°ƒç”¨do_sigactionã€‚do_sigactionä¹Ÿå¾ˆç®€å•ï¼Œè¿˜è®°å¾—è¿›ç¨‹å†…æ ¸çš„æ•°æ®ç»“æ„é‡Œï¼Œstruct task_structé‡Œé¢æœ‰ä¸€ä¸ªæˆå‘˜sighandï¼Œé‡Œé¢æœ‰ä¸€ä¸ªactionã€‚è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸‹æ ‡æ˜¯ä¿¡å·ï¼Œå†…å®¹å°±æ˜¯ä¿¡å·å¤„ç†å‡½æ•°ï¼Œdo_sigactionå°±æ˜¯è®¾ç½®sighandé‡Œçš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚</p><pre><code>int do_sigaction(int sig, struct k_sigaction *act, struct k_sigaction *oact)\n{\n\tstruct task_struct *p = current, *t;\n\tstruct k_sigaction *k;\n\tsigset_t mask;\n......\n\tk = &amp;p-&gt;sighand-&gt;action[sig-1];\n\n\n\tspin_lock_irq(&amp;p-&gt;sighand-&gt;siglock);\n\tif (oact)\n\t\t*oact = *k;\n\n\n\tif (act) {\n\t\tsigdelsetmask(&amp;act-&gt;sa.sa_mask,\n\t\t\t      sigmask(SIGKILL) | sigmask(SIGSTOP));\n\t\t*k = *act;\n......\n\t}\n\n\n\tspin_unlock_irq(&amp;p-&gt;sighand-&gt;siglock);\n\treturn 0;\n}\n</code></pre><p>è‡³æ­¤ï¼Œä¿¡å·å¤„ç†å‡½æ•°çš„æ³¨å†Œå·²ç»å®Œæˆäº†ã€‚</p><h2>æ€»ç»“æ—¶åˆ»</h2><p>è¿™ä¸€èŠ‚è®²äº†å¦‚ä½•é€šè¿‡APIæ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><ul>\n<li>åœ¨ç”¨æˆ·ç¨‹åºé‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥è°ƒç”¨ï¼Œä¸€ä¸ªæ˜¯signalï¼Œä¸€ä¸ªæ˜¯sigactionï¼Œæ¨èä½¿ç”¨sigactionã€‚</li>\n<li>ç”¨æˆ·ç¨‹åºè°ƒç”¨çš„æ˜¯Glibcé‡Œé¢çš„å‡½æ•°ï¼Œsignalè°ƒç”¨çš„æ˜¯__sysv_signalï¼Œé‡Œé¢é»˜è®¤è®¾ç½®äº†ä¸€äº›å‚æ•°ï¼Œä½¿å¾—signalçš„åŠŸèƒ½å—åˆ°äº†é™åˆ¶ï¼Œsigactionè°ƒç”¨çš„æ˜¯__sigactionï¼Œå‚æ•°ç”¨æˆ·å¯ä»¥ä»»æ„è®¾å®šã€‚</li>\n<li>æ— è®ºæ˜¯__sysv_signalè¿˜æ˜¯__sigactionï¼Œè°ƒç”¨çš„éƒ½æ˜¯ç»Ÿä¸€çš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨rt_sigactionã€‚</li>\n<li>åœ¨å†…æ ¸ä¸­ï¼Œrt_sigactionè°ƒç”¨çš„æ˜¯do_sigactionè®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ã€‚åœ¨æ¯ä¸€ä¸ªè¿›ç¨‹çš„task_structé‡Œé¢ï¼Œéƒ½æœ‰ä¸€ä¸ªsighandæŒ‡å‘struct sighand_structï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸‹æ ‡æ˜¯ä¿¡å·ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯ä¿¡å·å¤„ç†å‡½æ•°ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/7c/28/7cb86c73b9e73893e6b0e0433d476928.png?wh=2665*2053\" alt=\"\"></p><h2>è¯¾å ‚ç»ƒä¹ </h2><p>ä½ å¯ä»¥è¯•ç€å†™ä¸€ä¸ªç¨‹åºï¼Œè°ƒç”¨sigactionä¸ºæŸä¸ªä¿¡å·è®¾ç½®ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ï¼Œå¦‚æœæ”¶åˆ°ä¿¡å·åˆ™æ‰“å°ä¸€äº›å­—ç¬¦ä¸²ï¼Œç„¶åç”¨å‘½ä»¤killå‘é€ä¿¡å·ï¼Œçœ‹æ˜¯å¦å­—ç¬¦ä¸²è¢«æ­£å¸¸è¾“å‡ºã€‚</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„ç–‘æƒ‘å’Œè§è§£ ï¼Œä¹Ÿæ¬¢è¿å¯ä»¥æ”¶è—æœ¬èŠ‚å†…å®¹ï¼Œåå¤ç ”è¯»ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå’Œä»–ä¸€èµ·å­¦ä¹ å’Œè¿›æ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/37/8c0a95fa07a8b9a1abfd394479bdd637.jpg?wh=1110*659\" alt=\"\"></p>","comments":[{"had_liked":false,"id":107199,"user_name":"LDxy","can_delete":false,"product_type":"c1","uid":1188710,"ip_address":"","ucode":"956432CE7B7761","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg","comment_is_top":false,"comment_ctime":1561478191,"is_pvip":false,"replies":[{"id":"48860","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":107199,"uid":"1001590","ip_address":"","utype":1,"ctime":1567501387,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"74575922223","product_id":100024701,"comment_content":"ä¿¡å·ç±»ä¼¼å†…æ ¸é‡Œé¢çš„ä¸­æ–­ï¼Œåªä¸è¿‡æ˜¯åœ¨ç”¨æˆ·æ€çš„","like_count":18,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455411,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567501387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113147,"user_name":"çœ­ä¸œäº®","can_delete":false,"product_type":"c1","uid":1449336,"ip_address":"","ucode":"E9F629828B4E55","user_header":"https://wx.qlogo.cn/mmopen/vi_32/7dSgJbCaoS5CnCI4toP6mPueW1f0eQ0Ua9LxymPqJjH49cNYkJK0s9NcvrapPU4gvZb12j2u3l2A8Rw5onlJMQ/132","comment_is_top":false,"comment_ctime":1562902849,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18742772033","product_id":100024701,"comment_content":"è¯¾åç»ƒä¹ ï¼Œå‚è€ƒæ–‡æ¡£ï¼š<br>https:&#47;&#47;www.cnblogs.com&#47;wblyuyang&#47;archive&#47;2012&#47;11&#47;13&#47;2768923.html<br>https:&#47;&#47;www.runoob.com&#47;linux&#47;linux-comm-kill.html","like_count":4},{"had_liked":false,"id":105989,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1561121851,"is_pvip":false,"replies":[{"id":"38649","content":"straceä¸€ä¸‹","user_name":"ä½œè€…å›å¤","comment_id":105989,"uid":"1001590","ip_address":"","utype":1,"ctime":1561420106,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"18740991035","product_id":100024701,"comment_content":"cè¯­è¨€å¼€å‘è€…è·¯è¿‡ï¼Œè¡¨ç¤ºä»¥å‰ä»æ¥ä¸çŸ¥é“signalä¸æ˜¯ç³»ç»Ÿè°ƒç”¨","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454905,"discussion_content":"straceä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561420106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149771,"user_name":"hello","can_delete":false,"product_type":"c1","uid":1510495,"ip_address":"","ucode":"C6FC61A90F202B","user_header":"https://static001.geekbang.org/account/avatar/00/17/0c/5f/4cbcbfb9.jpg","comment_is_top":false,"comment_ctime":1573373277,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5868340573","product_id":100024701,"comment_content":"ä¸€ä¸ªè¿›ç¨‹å¦‚æœä¸€ç¬é—´æ”¶åˆ°å¾ˆå¤šåŒä¸€ä¸ªä¿¡å·ï¼Œé‚£task_structçš„actionæœ€å¤šèƒ½ä¿å­˜å‡ ä¸ªå‘¢","like_count":1,"discussions":[{"author":{"id":1114352,"avatar":"https://static001.geekbang.org/account/avatar/00/11/00/f0/fe94061e.jpg","nickname":"å‡è£…åœ¨å…»ğŸ·","note":"","ucode":"D0AB9CD03E0D5B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574079,"discussion_content":"åªèƒ½æ˜¯ä¸€ä¸ªå§ï¼Œè¿™é‡Œæ˜¯ä¸æ”¯æŒå¹¶å‘çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653822239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142537,"user_name":"JT","can_delete":false,"product_type":"c1","uid":1489942,"ip_address":"","ucode":"36D71949F34FD9","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/16/5ce59343.jpg","comment_is_top":false,"comment_ctime":1571389894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866357190","product_id":100024701,"comment_content":"è€å¸ˆï¼Œæˆ‘æµ‹è¯•è¿‡ä½¿ç”¨ signal å‡½æ•°æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œæ³¨å†Œä¸€æ¬¡æ˜¯ä¸€ç›´æœ‰æ•ˆã€‚æ¯æ¬¡ç»™è¿›ç¨‹å‘ä¿¡å·éƒ½ä¼šè°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°","like_count":1},{"had_liked":false,"id":105874,"user_name":"å…è´¹çš„äºº","can_delete":false,"product_type":"c1","uid":1032106,"ip_address":"","ucode":"2B12D8ED63C564","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/aa/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1561097373,"is_pvip":false,"replies":[{"id":"38653","content":"ä½¿ç”¨çš„åº“ä¸ä¸€æ ·ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":105874,"uid":"1001590","ip_address":"","utype":1,"ctime":1561420330,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":2,"race_medal":0,"score":"5856064669","product_id":100024701,"comment_content":"å…³äºSA_ONESHOTï¼Œä¸ºä»€ä¹ˆæˆ‘å¹³æ—¶ç”¨signalçš„æ—¶å€™ï¼Œå¤„ç†å‡½æ•°å¯ä»¥è¢«é‡å¤è°ƒç”¨å‘¢","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454847,"discussion_content":"ä½¿ç”¨çš„åº“ä¸ä¸€æ ·ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561420330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1220166,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9e/46/b96e82d6.jpg","nickname":"åˆ˜åˆ©å¹³","note":"","ucode":"7F306BF202A471","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193332,"discussion_content":"æ–°ç‰ˆæœ¬å†…æ ¸ã€4.19æœ‰æµ‹è¯•ã€‘å¯¹signalç³»ç»Ÿä»£ç å·²ç»åšäº†æ”¹å˜ï¼Œä¸å†å­˜åœ¨ä¿¡å·æ³¨å†Œå‡½æ•°åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæ•ˆè€Œåç»­ä¿¡å·å¤„ç†æŒ‰ç…§é»˜è®¤å¤„ç†çš„é—®é¢˜ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583147154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105759,"user_name":"Sharry","can_delete":false,"product_type":"c1","uid":1239293,"ip_address":"","ucode":"045DDB864659F6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/fd/035f4c94.jpg","comment_is_top":false,"comment_ctime":1561081420,"is_pvip":false,"replies":[{"id":"48882","content":"è¿˜æœ‰ä¿¡å·ä¸‹","user_name":"ä½œè€…å›å¤","comment_id":105759,"uid":"1001590","ip_address":"","utype":1,"ctime":1567504234,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"5856048716","product_id":100024701,"comment_content":"æ”¶è·æ»¡æ»¡, ä¸è¿‡çœ‹äº†æ ‡é¢˜ä»¥ä¸ºæ˜¯ä¿¡å·å‘é€çš„æµç¨‹, ç»“æœå­¦åˆ°äº†ä¿¡å·çš„æ³¨å†Œå’Œå¤„ç†","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454800,"discussion_content":"è¿˜æœ‰ä¿¡å·ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567504234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311214,"user_name":"Geek_1ec22e","can_delete":false,"product_type":"c1","uid":2749753,"ip_address":"","ucode":"93E438268C6557","user_header":"","comment_is_top":false,"comment_ctime":1631107659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631107659","product_id":100024701,"comment_content":"ä¿¡å·æ³¨å†Œæ˜¯é’ˆå¯¹æ‰€æœ‰è¿›ç¨‹è¿˜æ˜¯å•ä¸ªè¿›ç¨‹ï¼Ÿ","like_count":0},{"had_liked":false,"id":106502,"user_name":"Luke","can_delete":false,"product_type":"c1","uid":1216016,"ip_address":"","ucode":"C34D4C44DBCE03","user_header":"https://static001.geekbang.org/account/avatar/00/12/8e/10/10092bb1.jpg","comment_is_top":false,"comment_ctime":1561337397,"is_pvip":false,"replies":[{"id":"38645","content":"windowsä¸å¤ªæ¸…æ¥š","user_name":"ä½œè€…å›å¤","comment_id":106502,"uid":"1001590","ip_address":"","utype":1,"ctime":1561420003,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1561337397","product_id":100024701,"comment_content":"ä¿¡å·æ˜¯ä¸æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªåŸè¯­ï¼Œåœ¨Windowsç«¯ï¼Œå¯¹åº”çš„å®ç°æ˜¯æ¶ˆæ¯Messageå¾ªç¯","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455113,"discussion_content":"windowsä¸å¤ªæ¸…æ¥š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561420003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}