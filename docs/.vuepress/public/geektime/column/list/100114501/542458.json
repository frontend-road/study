{"id":542458,"title":"25｜PersistentVolume + NFS：怎么使用网络共享存储？","content":"<p>你好，我是Chrono。</p><p>在上节课里我们看到了Kubernetes里的持久化存储对象PersistentVolume、PersistentVolumeClaim、StorageClass，把它们联合起来就可以为Pod挂载一块“虚拟盘”，让Pod在其中任意读写数据。</p><p>不过当时我们使用的是HostPath，存储卷只能在本机使用，而Kubernetes里的Pod经常会在集群里“漂移”，所以这种方式不是特别实用。</p><p>要想让存储卷真正能被Pod任意挂载，我们需要变更存储的方式，不能限定在本地磁盘，而是要改成<strong>网络存储</strong>，这样Pod无论在哪里运行，只要知道IP地址或者域名，就可以通过网络通信访问存储设备。</p><p>网络存储是一个非常热门的应用领域，有很多知名的产品，比如AWS、Azure、Ceph，Kubernetes还专门定义了CSI（Container Storage Interface）规范，不过这些存储类型的安装、使用都比较复杂，在我们的实验环境里部署难度比较高。</p><p>所以今天的这次课里，我选择了相对来说比较简单的NFS系统（Network File System），以它为例讲解如何在Kubernetes里使用网络存储，以及静态存储卷和动态存储卷的概念。</p><!-- [[[read_end]]] --><h2>如何安装NFS服务器</h2><p>作为一个经典的网络存储系统，NFS有着近40年的发展历史，基本上已经成为了各种UNIX系统的标准配置，Linux自然也提供对它的支持。</p><p>NFS采用的是Client/Server架构，需要选定一台主机作为Server，安装NFS服务端；其他要使用存储的主机作为Client，安装NFS客户端工具。</p><p>所以接下来，我们在自己的Kubernetes集群里再增添一台名字叫Storage的服务器，在上面安装NFS，实现网络存储、共享网盘的功能。<strong>不过这台Storage也只是一个逻辑概念，我们在实际安装部署的时候完全可以把它合并到集群里的某台主机里</strong>，比如这里我就复用了<a href=\"https://time.geekbang.org/column/article/534762\">第17讲</a>里的Console。</p><p>新的网络架构如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/78/07/786e13af0e2f62f9cd73f5ab555a4507.jpg?wh=1920x1235\" alt=\"图片\"></p><p>在Ubuntu系统里安装NFS服务端很容易，使用apt即可：</p><pre><code class=\"language-plain\">sudo apt -y install nfs-kernel-server\n</code></pre><p>安装好之后，你需要给NFS指定一个存储位置，也就是网络共享目录。一般来说，应该建立一个专门的 <code>/data</code> 目录，这里为了简单起见，我就使用了<strong>临时目录 <code>/tmp/nfs</code></strong>：</p><pre><code class=\"language-plain\">mkdir -p /tmp/nfs\n</code></pre><p>接下来你需要配置NFS访问共享目录，修改 <code>/etc/exports</code>，指定目录名、允许访问的网段，还有权限等参数。这些规则比较琐碎，和我们的Kubernetes课程关联不大，我就不详细解释了，你只要把下面这行加上就行，注意目录名和IP地址要改成和自己的环境一致：</p><pre><code class=\"language-plain\">/tmp/nfs 192.168.10.0/24(rw,sync,no_subtree_check,no_root_squash,insecure)\n</code></pre><p><strong>改好之后，需要用 <code>exportfs -ra</code> 通知NFS，让配置生效</strong>，再用 <code>exportfs -v</code> 验证效果：</p><pre><code class=\"language-plain\">sudo exportfs -ra\nsudo exportfs -v\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/0c/d1/0cd8889ee51c6d8a8947f6bd615d6bd1.png?wh=1920x116\" alt=\"图片\"></p><p>现在，你就可以使用 <code>systemctl</code> 来启动NFS服务器了：</p><pre><code class=\"language-plain\">sudo systemctl start&nbsp; nfs-server\nsudo systemctl enable nfs-server\nsudo systemctl status nfs-server\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/29/5a/29fb58f93f0e764ca8309ed9eff5175a.png?wh=1832x486\" alt=\"图片\"></p><p>你还可以使用命令 <code>showmount</code> 来检查NFS的网络挂载情况：</p><pre><code class=\"language-plain\">showmount -e 127.0.0.1\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/90/d2/905ea675a49daef860d21b41a668d6d2.png?wh=978x176\" alt=\"图片\"></p><h2>如何安装NFS客户端</h2><p>有了NFS服务器之后，为了让Kubernetes集群能够访问NFS存储服务，我们还需要在每个节点上都安装NFS客户端。</p><p>这项工作只需要一条apt命令，不需要额外的配置：</p><pre><code class=\"language-plain\">sudo apt -y install nfs-common\n</code></pre><p>同样，在节点上可以用 <code>showmount</code> 检查NFS能否正常挂载，注意IP地址要写成NFS服务器的地址，我在这里就是“192.168.10.208”：</p><p><img src=\"https://static001.geekbang.org/resource/image/7e/9c/7ed89f8468d6d4fa315a6d456f2eee9c.png?wh=1182x186\" alt=\"图片\"></p><p>现在让我们尝试手动挂载一下NFS网络存储，先创建一个目录 <code>/tmp/test</code> 作为挂载点：</p><pre><code class=\"language-plain\">mkdir -p /tmp/test\n</code></pre><p>然后用命令 <code>mount</code> 把NFS服务器的共享目录挂载到刚才创建的本地目录上：</p><pre><code class=\"language-plain\">sudo mount -t nfs 192.168.10.208:/tmp/nfs /tmp/test\n</code></pre><p>最后测试一下，我们在 <code>/tmp/test</code> 里随便创建一个文件，比如 <code>x.yml</code>：</p><pre><code class=\"language-plain\">touch /tmp/test/x.yml\n</code></pre><p>再回到NFS服务器，检查共享目录 <code>/tmp/nfs</code>，应该会看到也出现了一个同样的文件 <code>x.yml</code>，这就说明NFS安装成功了。之后集群里的任意节点，只要通过NFS客户端，就能把数据写入NFS服务器，实现网络存储。</p><h2>如何使用NFS存储卷</h2><p>现在我们已经为Kubernetes配置好了NFS存储系统，就可以使用它来创建新的PV存储对象了。</p><p>先来手工分配一个存储卷，需要指定 <code>storageClassName</code> 是 <code>nfs</code>，而 <code>accessModes</code> 可以设置成 <code>ReadWriteMany</code>，这是由NFS的特性决定的，它<strong>支持多个节点同时访问一个共享目录</strong>。</p><p>因为这个存储卷是NFS系统，所以我们还需要在YAML里添加 <code>nfs</code> 字段，指定NFS服务器的IP地址和共享目录名。</p><p>这里我在NFS服务器的 <code>/tmp/nfs</code> 目录里又创建了一个新的目录 <code>1g-pv</code>，表示分配了1GB的可用存储空间，相应的，PV里的 <code>capacity</code> 也要设置成同样的数值，也就是 <code>1Gi</code>。</p><p>把这些字段都整理好后，我们就得到了一个使用NFS网络存储的YAML描述文件：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: PersistentVolume\nmetadata:\n&nbsp; name: nfs-1g-pv\n\nspec:\n&nbsp; storageClassName: nfs\n&nbsp; accessModes:\n&nbsp; &nbsp; - ReadWriteMany\n&nbsp; capacity:\n&nbsp; &nbsp; storage: 1Gi\n\n&nbsp; nfs:\n&nbsp; &nbsp; path: /tmp/nfs/1g-pv\n&nbsp; &nbsp; server: 192.168.10.208\n</code></pre><p>现在就可以用命令 <code>kubectl apply</code> 来创建PV对象，再用 <code>kubectl get pv</code> 查看它的状态：</p><pre><code class=\"language-plain\">kubectl apply -f nfs-static-pv.yml\nkubectl get pv\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/3b/39/3bb0be2483e92467d3cac14fbc635739.png?wh=1688x300\" alt=\"图片\"></p><p><strong>再次提醒你注意，<code>spec.nfs</code> 里的IP地址一定要正确，路径一定要存在（事先创建好）</strong>，否则Kubernetes按照PV的描述会无法挂载NFS共享目录，PV就会处于“pending”状态无法使用。</p><p>有了PV，我们就可以定义申请存储的PVC对象了，它的内容和PV差不多，但不涉及NFS存储的细节，只需要用 <code>resources.request</code> 来表示希望要有多大的容量，这里我写成1GB，和PV的容量相同：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n&nbsp; name: nfs-static-pvc\n\nspec:\n&nbsp; storageClassName: nfs\n&nbsp; accessModes:\n&nbsp; &nbsp; - ReadWriteMany\n\n&nbsp; resources:\n&nbsp; &nbsp; requests:\n&nbsp; &nbsp; &nbsp; storage: 1Gi\n</code></pre><p>创建PVC对象之后，Kubernetes就会根据PVC的描述，找到最合适的PV，把它们“绑定”在一起，也就是存储分配成功：</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/8c/a7bbcc5dce117f9872cee3f08e6a6c8c.png?wh=1920x309\" alt=\"图片\"></p><p>我们再创建一个Pod，把PVC挂载成它的一个volume，具体的做法和<a href=\"https://time.geekbang.org/column/article/542376\">上节课</a>是一样的，用 <code>persistentVolumeClaim</code> 指定PVC的名字就可以了：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Pod\nmetadata:\n&nbsp; name: nfs-static-pod\n\nspec:\n&nbsp; volumes:\n&nbsp; - name: nfs-pvc-vol\n&nbsp; &nbsp; persistentVolumeClaim:\n&nbsp; &nbsp; &nbsp; claimName: nfs-static-pvc\n\n&nbsp; containers:\n&nbsp; &nbsp; - name: nfs-pvc-test\n&nbsp; &nbsp; &nbsp; image: nginx:alpine\n&nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; - containerPort: 80\n\n&nbsp; &nbsp; &nbsp; volumeMounts:\n&nbsp; &nbsp; &nbsp; &nbsp; - name: nfs-pvc-vol\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /tmp\n</code></pre><p>Pod、PVC、PV和NFS存储的关系可以用下图来形象地表示，你可以对比一下HostPath PV的用法，看看有什么不同：</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/a7/2a21d16b028afdea4f525439bd8f06a7.jpg?wh=1920x1125\" alt=\"图片\"></p><p>因为我们在PV/PVC里指定了 <code>storageClassName</code> 是 <code>nfs</code>，节点上也安装了NFS客户端，所以Kubernetes就会自动执行NFS挂载动作，把NFS的共享目录 <code>/tmp/nfs/1g-pv</code> 挂载到Pod里的 <code>/tmp</code>，完全不需要我们去手动管理。</p><p>最后还是测试一下，用 <code>kubectl apply</code> 创建Pod之后，我们用 <code>kubectl exec</code> 进入Pod，再试着操作NFS共享目录：</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/90/bbc244b6cd21b71f50807864718d8990.png?wh=1386x542\" alt=\"图片\"></p><p>退出Pod，再看一下NFS服务器的 <code>/tmp/nfs/1g-pv</code> 目录，你就会发现Pod里创建的文件确实写入了共享目录：</p><p><img src=\"https://static001.geekbang.org/resource/image/87/d0/87cdc722da478db6f938db4d424be0d0.png?wh=756x354\" alt=\"图片\"></p><p>而且更好的是，因为NFS是一个网络服务，不会受Pod调度位置的影响，所以只要网络通畅，这个PV对象就会一直可用，数据也就实现了真正的持久化存储。</p><h2>如何部署NFS Provisoner</h2><p>现在有了NFS这样的网络存储系统，你是不是认为Kubernetes里的数据持久化问题就已经解决了呢？</p><p>对于这个问题，我觉得可以套用一句现在的流行语：“解决了，但没有完全解决。”</p><p>说它“解决了”，是因为网络存储系统确实能够让集群里的Pod任意访问，数据在Pod销毁后仍然存在，新创建的Pod可以再次挂载，然后读取之前写入的数据，整个过程完全是自动化的。</p><p>说它“没有完全解决”，是因为<strong>PV还是需要人工管理</strong>，必须要由系统管理员手动维护各种存储设备，再根据开发需求逐个创建PV，而且PV的大小也很难精确控制，容易出现空间不足或者空间浪费的情况。</p><p>在我们的这个实验环境里，只有很少的PV需求，管理员可以很快分配PV存储卷，但是在一个大集群里，每天可能会有几百几千个应用需要PV存储，如果仍然用人力来管理分配存储，管理员很可能会忙得焦头烂额，导致分配存储的工作大量积压。</p><p>那么能不能让创建PV的工作也实现自动化呢？或者说，让计算机来代替人类来分配存储卷呢？</p><p>这个在Kubernetes里就是“<strong>动态存储卷</strong>”的概念，它可以用StorageClass绑定一个Provisioner对象，而这个Provisioner就是一个能够自动管理存储、创建PV的应用，代替了原来系统管理员的手工劳动。</p><p>有了“动态存储卷”的概念，前面我们讲的手工创建的PV就可以称为“静态存储卷”。</p><p>目前，Kubernetes里每类存储设备都有相应的Provisioner对象，对于NFS来说，它的Provisioner就是“NFS subdir external provisioner”，你可以在GitHub上找到这个项目（<a href=\"https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner\">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a>）。</p><p>NFS Provisioner也是以Pod的形式运行在Kubernetes里的，<strong>在GitHub的 <code>deploy</code> 目录里是部署它所需的YAML文件，一共有三个，分别是rbac.yaml、class.yaml和deployment.yaml</strong>。</p><p>不过这三个文件只是示例，想在我们的集群里真正运行起来还要修改其中的两个文件。</p><p>第一个要修改的是rbac.yaml，它使用的是默认的 <code>default</code> 名字空间，应该把它改成其他的名字空间，避免与普通应用混在一起，你可以用“查找替换”的方式把它统一改成 <code>kube-system</code>。</p><p>第二个要修改的是deployment.yaml，它要修改的地方比较多。首先要把名字空间改成和rbac.yaml一样，比如是 <code>kube-system</code>，然后重点要修改 <code>volumes</code> 和 <code>env</code> 里的IP地址和共享目录名，必须和集群里的NFS服务器配置一样。</p><p>按照我们当前的环境设置，就应该把IP地址改成 <code>192.168.10.208</code>，目录名改成 <code>/tmp/nfs</code>：</p><pre><code class=\"language-yaml\">spec:\n&nbsp; template:\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; serviceAccountName: nfs-client-provisioner\n&nbsp; &nbsp; &nbsp; containers:\n\t\t&nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; env:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: PROVISIONER_NAME\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: k8s-sigs.io/nfs-subdir-external-provisioner\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: NFS_SERVER\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: 192.168.10.208        #改IP地址\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: NFS_PATH\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: /tmp/nfs              #改共享目录名\n&nbsp; &nbsp; &nbsp; volumes:\n&nbsp; &nbsp; &nbsp; &nbsp; - name: nfs-client-root\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nfs:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; server: 192.168.10.208         #改IP地址\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Path: /tmp/nfs                 #改共享目录名\n</code></pre><p>还有一件麻烦事，deployment.yaml的镜像仓库用的是gcr.io，拉取很困难，而国内的镜像网站上偏偏还没有它，为了让实验能够顺利进行，我不得不“曲线救国”，把它的镜像转存到了Docker Hub上。</p><p>所以你还需要把镜像的名字由原来的“k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2”改成“chronolaw/nfs-subdir-external-provisioner:v4.0.2”，其实也就是变动一下镜像的用户名而已。</p><p>把这两个YAML修改好之后，我们就可以在Kubernetes里创建NFS Provisioner了：</p><pre><code class=\"language-plain\">kubectl apply -f rbac.yaml\nkubectl apply -f class.yaml\nkubectl apply -f deployment.yaml\n</code></pre><p>使用命令 <code>kubectl get</code>，再加上名字空间限定 <code>-n kube-system</code>，就可以看到NFS Provisioner在Kubernetes里运行起来了。</p><p><img src=\"https://static001.geekbang.org/resource/image/35/6d/35758cbe60ddf264bcf59d703fd4986d.png?wh=1920x407\" alt=\"图片\"></p><h2>如何使用NFS动态存储卷</h2><p>比起静态存储卷，动态存储卷的用法简单了很多。因为有了Provisioner，我们就不再需要手工定义PV对象了，只需要在PVC里指定StorageClass对象，它再关联到Provisioner。</p><p>我们来看一下NFS默认的StorageClass定义：</p><pre><code class=\"language-yaml\">apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n&nbsp; name: nfs-client\n\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner&nbsp;\nparameters:\n&nbsp; archiveOnDelete: \"false\"\n</code></pre><p>YAML里的关键字段是 <code>provisioner</code>，它指定了应该使用哪个Provisioner。另一个字段 <code>parameters</code> 是调节Provisioner运行的参数，需要参考文档来确定具体值，在这里的 <code>archiveOnDelete: \"false\"</code> 就是自动回收存储空间。</p><p>理解了StorageClass的YAML之后，你也可以不使用默认的StorageClass，而是根据自己的需求，任意定制具有不同存储特性的StorageClass，比如添加字段 <code>onDelete: \"retain\"</code> 暂时保留分配的存储，之后再手动删除：</p><pre><code class=\"language-yaml\">apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n&nbsp; name: nfs-client-retained\n\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner\nparameters:\n&nbsp; onDelete: \"retain\"\n</code></pre><p>接下来我们定义一个PVC，向系统申请10MB的存储空间，使用的StorageClass是默认的 <code>nfs-client</code>：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n&nbsp; name: nfs-dyn-10m-pvc\n\nspec:\n&nbsp; storageClassName: nfs-client\n&nbsp; accessModes:\n&nbsp; &nbsp; - ReadWriteMany\n\n&nbsp; resources:\n&nbsp; &nbsp; requests:\n&nbsp; &nbsp; &nbsp; storage: 10Mi\n</code></pre><p>写好了PVC，我们还是在Pod里用 <code>volumes</code> 和 <code>volumeMounts</code> 挂载，然后Kubernetes就会自动找到NFS Provisioner，在NFS的共享目录上创建出合适的PV对象：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Pod\nmetadata:\n&nbsp; name: nfs-dyn-pod\n\nspec:\n&nbsp; volumes:\n&nbsp; - name: nfs-dyn-10m-vol\n&nbsp; &nbsp; persistentVolumeClaim:\n&nbsp; &nbsp; &nbsp; claimName: nfs-dyn-10m-pvc\n\n&nbsp; containers:\n&nbsp; &nbsp; - name: nfs-dyn-test\n&nbsp; &nbsp; &nbsp; image: nginx:alpine\n&nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; - containerPort: 80\n\n&nbsp; &nbsp; &nbsp; volumeMounts:\n&nbsp; &nbsp; &nbsp; &nbsp; - name: nfs-dyn-10m-vol\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /tmp\n</code></pre><p>使用 <code>kubectl apply</code> 创建好PVC和Pod，让我们来查看一下集群里的PV状态：</p><p><img src=\"https://static001.geekbang.org/resource/image/57/bb/570d73409db1edc757yy10e6aba56ebb.png?wh=1920x271\" alt=\"图片\"></p><p>从截图你可以看到，虽然我们没有直接定义PV对象，但由于有NFS Provisioner，它就自动创建一个PV，大小刚好是在PVC里申请的10MB。</p><p>如果你这个时候再去NFS服务器上查看共享目录，也会发现多出了一个目录，名字与这个自动创建的PV一样，但加上了名字空间和PVC的前缀：</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/ea/a9b6942b824bc9f7841850ee15yy68ea.png?wh=1714x126\" alt=\"图片\"></p><p>我还是把Pod、PVC、StorageClass和Provisioner的关系画成了一张图，你可以清楚地看出来这些对象的关联关系，还有Pod是如何最终找到存储设备的：</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/1e/e3905990be6fb8739fb51a4ab9856f1e.jpg?wh=1920x856\" alt=\"图片\"></p><h2>小结</h2><p>好了，今天的这节课里我们继续学习PV/PVC，引入了网络存储系统，以NFS为例研究了静态存储卷和动态存储卷的用法，其中的核心对象是StorageClass和Provisioner。</p><p>我再小结一下今天的要点：</p><ol>\n<li>在Kubernetes集群里，网络存储系统更适合数据持久化，NFS是最容易使用的一种网络存储系统，要事先安装好服务端和客户端。</li>\n<li>可以编写PV手工定义NFS静态存储卷，要指定NFS服务器的IP地址和共享目录名。</li>\n<li>使用NFS动态存储卷必须要部署相应的Provisioner，在YAML里正确配置NFS服务器。</li>\n<li>动态存储卷不需要手工定义PV，而是要定义StorageClass，由关联的Provisioner自动创建PV完成绑定。</li>\n</ol><h2>课下作业</h2><p>最后是课下作业时间，给你留两个思考题：</p><ol>\n<li>动态存储卷相比静态存储卷有什么好处？有没有缺点？</li>\n<li>StorageClass在动态存储卷的分配过程中起到了什么作用？</li>\n</ol><p>期待你的思考。如果觉得有收获，也欢迎你分享给朋友一起讨论。我们下节课再见。</p><p><img src=\"https://static001.geekbang.org/resource/image/20/ff/2022f24dcc6a3d76214bbc59c3bd2aff.jpg?wh=1920x2122\" alt=\"图片\"></p>","comments":[{"had_liked":false,"id":355018,"user_name":"马以","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"北京","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1660982765,"is_pvip":false,"replies":[{"id":129158,"content":"very nice！","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661040354,"ip_address":"北京","comment_id":355018,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"思考题：\n1: 首先，静态存储卷PV这个动作是要由运维手动处理的，如果是处在大规模集群的成千上万个PVC的场景下，这个工作量是难以想象的；\n   再者，业务的迭代变更是动态的，这也就意味着随时会有新的PVC被创建，或者就的PVC被删除，这也就要求运维每碰到PVC的变更，就要跟着去手动维护一个新的\n   PV。来满足业务的新需求，这个情况如果解决不了，我相信运维这个职业马上就会消失。\n   最后，动态存储卷的好处还在于分层和解耦，对于简单的localPath或者NFS这种存储卷或许相对来说还比较简单一些，但是像类似于远程存储磁盘这种就相对来说比较\n   复杂了，动态存储可以让我们只关注于需求点，至于怎么把这些东西创建出来，就交由各个类型的provisioner去处理就行了。\n   \n  缺点：缺点的话就是在于资源的管控方面，比如原本我可能只需要2Gi的空间，但是业务人员对容量把握不够申请了10Gi，就会有8Gi空间的浪费。\n2:StorageClass 作用是帮助指定特定类型的provisioner，这决定了你要使用的具体某种类型的存储插件；另外它还限定了PV和PVC的绑定关系，只有从属于同一StorageClass的PV和PVC才能做绑定动作，比如指定GlusterFS类型的PVC对象不能绑定到另外一个PVC定义的NFS类型的StorageClass 模版创建出的Volume的PV对象上面去。","like_count":29,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584666,"discussion_content":"very nice！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661040354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606879,"discussion_content":"首先运维存在已经20年了，开发未来有可能被代替，运维不会，因为卷运维的人少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677478172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355047,"user_name":"新时代农民工","can_delete":false,"product_type":"c1","uid":1225689,"ip_address":"北京","ucode":"0AA60DEDF6C062","user_header":"https://static001.geekbang.org/account/avatar/00/12/b3/d9/cf061262.jpg","comment_is_top":false,"comment_ctime":1661006635,"is_pvip":false,"replies":[{"id":129221,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661137494,"ip_address":"北京","comment_id":355047,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"不妨试一试docker版的nfs-server，简单又方便 https:&#47;&#47;hub.docker.com&#47;r&#47;fuzzle&#47;docker-nfs-server","like_count":10,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584795,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661137494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1313882,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0c/5a/3b01789e.jpg","nickname":"Quintos","note":"","ucode":"DD1FB190599279","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585295,"discussion_content":"这个只能在本地的k8s下使用吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661473036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376784,"user_name":"大毛","can_delete":false,"product_type":"c1","uid":1899599,"ip_address":"北京","ucode":"93B18287F06706","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","comment_is_top":false,"comment_ctime":1687372249,"is_pvip":false,"replies":[{"id":137355,"content":"amazing!","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1687419415,"ip_address":"北京","comment_id":376784,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"用面向对象的思想来理解 kubernetes 在存储上的设计：\nSC 是类，PV 是实例，PVC 是创建实例的代码，provisioner 是工厂。\n有一种豁然开朗的感觉","like_count":9,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621645,"discussion_content":"amazing!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1687419415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360850,"user_name":"小江爱学术","can_delete":false,"product_type":"c1","uid":2628601,"ip_address":"上海","ucode":"554F40C6627AF4","user_header":"https://static001.geekbang.org/account/avatar/00/28/1b/f9/018197f1.jpg","comment_is_top":false,"comment_ctime":1666919985,"is_pvip":false,"replies":[{"id":131275,"content":"理解的非常好，这个就是Kubernetes关键的抽象思路，把底层的实现细节屏蔽了。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1666929221,"ip_address":"上海","comment_id":360850,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师，不知道这么理解对不对，因为存储它涉及到了对物理机文件系统绑定的操作，因此K8S做了一系列抽象。PV在这个抽象里，其实就指代了主机文件系统的路径，当然至于再往实现层面走，是网络文件系统还是主机文件系统，这就全由PV的绑定类型决定。而往抽象层走，作为K8S的核心系统，K8S想尽可能屏蔽掉底层，也就是主机文件系统的概念，所以它抽象了StorageClass，用来统一指代&#47;管理PV。至此，K8S持久化存储就可以分两个部分，第一部分是由 主机文件系统+PV+StorageClass组成的，用来将抽象对象绑定到真实文件系统的生产者部分；第二部分就是 Volume+PVC+StorageClass，完全被抽象为K8S核心业务的消费者部分，而StorageClass，可以看作是两部分连接的桥梁。","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591913,"discussion_content":"理解的非常好，这个就是Kubernetes关键的抽象思路，把底层的实现细节屏蔽了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666929221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354962,"user_name":"马以","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"北京","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1660914743,"is_pvip":false,"replies":[{"id":129121,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660956853,"ip_address":"北京","comment_id":354962,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"云服务器环境搭建：主要在nfs权限那边比较麻烦\n\n-- 服务端\n1: 查看是否安装了必要的软件\n\t$ dpkg -l | grep rpcbind\n\t...\n\n\t$ sudo apt -y install rpcbind\n\t$ sudo apt -y install nfs-kernel-server\n\t$ sudo apt -y install nfs-common\n2.修改 &#47;etc&#47;services 追加\n\n\t# Local services\n\tmountd 4011&#47;udp\n\tmountd 4011&#47;tcp\n\n\t内容，固定mountd 的端口号\n\n\n\n\t打开端口号访问限制：\n\t TCP: 2049、111、4011\n\t UDP: 111、4046、4011\n\n\n3. 创建目录 追加配置（和文档中的一样）\n  $ mkdir -p &#47;tmp&#47;nfs\n\n  &#47;etc&#47;exports 内容增加以下内容（我的云服务器外网ip是175.179网段，这里要根据自身的情况修改）：\n    &#47;tmp&#47;nfs 175.178.0.0&#47;16(rw,sync,no_subtree_check,no_root_squash,insecure)\n\n\n   $ sudo exportfs -v\n   $ sudo exportfs -v\n\n4.开启服务\n\n\t$ sudo systemctl start  nfs-server\n\t$ sudo systemctl enable nfs-server\n\t$ sudo systemctl status nfs-server\n\n\t$ sudo systemctl start  rpcbind\n\t$ sudo systemctl enable rpcbind\n\t$ sudo systemctl status rpcbind\n\n\n-- 客户端\n1.安装客户端软件\n\n   $ sudo apt -y install nfs-common\n   $ sudo apt -y install rpcbind\n\n   其它步骤和老师基本一样\n\n","like_count":6,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584582,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660956853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589515,"discussion_content":"通过以下步骤已解决，供同学们参考\n\nsystemctl start firewalld\nfirewall-cmd --add-service=nfs --permanent\nfirewall-cmd --add-service=mountd --permanent\nfirewall-cmd --add-service=rpc-bind --permanent\nfirewall-cmd --reload","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665056722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589509,"discussion_content":"但是我在client的服务器上使用命令：sudo mount -t nfs 10.0.4.10:/tmp/nfs /tmp/data\n\n然后使用 df -h , 发现有一条成功的挂载记录\nFilesystem          Size  Used Avail Use% Mounted on\n10.0.4.10:/tmp/nfs   59G  5.9G   51G  11% /tmp/data\n\n这个时候在客户端使用命令：showmount -e 10.0.4.10 还是连接不上，一直卡着不动，\n我在客户端和服务器相应的挂载目录创建文件，发现也没有共享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665052811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589507,"discussion_content":"请问大佬，我使用的是云服务Centos7, 三台机器开启了内网互联，并且关闭了防火墙，而且也可以ping通，但是在clinet 使用命令 showmount -e ‘服务器的ip地址’, 却一直卡着什么反应没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665051255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"马以","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589667,"discussion_content":"应该端口号问题吧，指定自己端口号，然后把权限开放","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665225031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":589507,"ip_address":"广东","group_id":0},"score":589667,"extra":""}]}]},{"had_liked":false,"id":364068,"user_name":"zzz","can_delete":false,"product_type":"c1","uid":1216328,"ip_address":"上海","ucode":"31A5F705F012FA","user_header":"https://static001.geekbang.org/account/avatar/00/12/8f/48/c7fb8067.jpg","comment_is_top":false,"comment_ctime":1670491528,"is_pvip":false,"replies":[{"id":132367,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1670564610,"ip_address":"上海","comment_id":364068,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"nfs provisoner 在生产建议使用HELM包方式进行，而且已经在生产实践过，\nnfs-subdir-external-provisioner\n优势2个：\n1. 无需复杂的配置\n2. 可支持离线下载，方便传输到生产环境。\n自己可以玩可以采用教程的方法，了解一下RBAC的流程\n","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596020,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670564610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606880,"discussion_content":"nfs没有单点故障处理方法，生产不适合用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677478228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355273,"user_name":"小宝","can_delete":false,"product_type":"c1","uid":1402330,"ip_address":"北京","ucode":"A7223A477C60C9","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/da/29fe3dde.jpg","comment_is_top":false,"comment_ctime":1661242226,"is_pvip":false,"replies":[{"id":129275,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661300067,"ip_address":"北京","comment_id":355273,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"思考题:\n1. 动态存储卷PV需要手动运维，而且受限于分配的大小问题，如果分配的PV都比较小，需求又比较大，极易造成PV使用不当，造成浪费。反之，动态存储则按需分配。权利的无限放大也会带来问题，就是预先申请与实际使用之间的矛盾，动态申请大了，也是一种浪费。\n2. StorageClass应证了“所有问题都可以通过增加一层来解决”。作用是解决了特定底层存储与K8S上资源的解耦问题，通过SC统一接口，具体厂商负责具体的存储实现。","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585025,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661300067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357312,"user_name":"朱雯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"北京","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1663148076,"is_pvip":false,"replies":[{"id":130030,"content":"这些都是Kubernetes比较深层次的知识点了，感兴趣可以再找其他资料研究，如果平常用不到也就不必浪费精力。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1663159487,"ip_address":"北京","comment_id":357312,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"看了这节课和上节课，终于把storageclass的使用方式搞清楚了，如果都是静态存储和使用，那么只需要在pv和pvc中加上这个name这个属性就可以，并不需要storageClass这个对象，而关键是，这个东西是可以引用provisioner的，让这个和deployment挂钩，其实iwo有一个问题啊，为啥不讲provisioner单独设置为一个对象，而是使用deployment进行部署呢，又是设置环境变量，又是配置参数，另外rabc到底是干嘛的，我真不理解。","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587590,"discussion_content":"这些都是Kubernetes比较深层次的知识点了，感兴趣可以再找其他资料研究，如果平常用不到也就不必浪费精力。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663159487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115440,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/30/fe5037b7.jpg","nickname":"阿铭","note":"","ucode":"BC6FC826E9F6EB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594658,"discussion_content":"如果是静态pv，都用不上storageclass，让pvc和pv自行绑定即可。Storageclass存在的意义主要在于动态pv。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669262803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"天津","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366555,"user_name":"Layne","can_delete":false,"product_type":"c1","uid":1479934,"ip_address":"广东","ucode":"1FEAACD900AB39","user_header":"https://static001.geekbang.org/account/avatar/00/16/94/fe/5fbf1bdc.jpg","comment_is_top":false,"comment_ctime":1673924450,"is_pvip":true,"replies":[{"id":133567,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1673947731,"ip_address":"北京","comment_id":366555,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"已实操\n遇到的问题：\n搭建nfs的时候，目录挂载成功，但是创建文件，没有同步到服务端\n原因：\n在挂载的时候，客户端目录和服务端共享目录一样导致的，挂载目录和共享目录不能根目录相同\n修改前：\nsudo mount -t nfs 192.168.56.103:&#47;home&#47;layne&#47;data&#47;nfs &#47;home&#47;layne&#47;data&#47;nfs\n修改后：\nsudo mount -t nfs 192.168.56.103:&#47;home&#47;layne&#47;data&#47;nfs &#47;data&#47;nfs","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600026,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673947732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110662,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/86/d689f77e.jpg","nickname":"Hank_Yan","note":"","ucode":"86899B561C502B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625428,"discussion_content":"我这里一样的路径是没问题的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691665456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360315,"user_name":"哇哈哈","can_delete":false,"product_type":"c1","uid":1175537,"ip_address":"上海","ucode":"47453D1C96A1DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/f1/8b06801a.jpg","comment_is_top":false,"comment_ctime":1666424529,"is_pvip":false,"replies":[{"id":131150,"content":"我觉得这个应该是Provisioner自己的管理职能，它有能力去处理这些事情，其实写程序不难办到。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1666588624,"ip_address":"上海","comment_id":360315,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"有个问题没有想明白，provisioner如何知道系统的存储容量呢？如果我 pvc 一个 100G 空间，但是 nfs 只有不到 100G 空间的时候，provisioner怎么处理这种场景呢？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591454,"discussion_content":"我觉得这个应该是Provisioner自己的管理职能，它有能力去处理这些事情，其实写程序不难办到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666588624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355351,"user_name":"Quintos","can_delete":false,"product_type":"c1","uid":1313882,"ip_address":"北京","ucode":"DD1FB190599279","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/5a/3b01789e.jpg","comment_is_top":false,"comment_ctime":1661312252,"is_pvip":true,"replies":[{"id":129291,"content":"没用过这些云服务器，抱歉了，可以考虑换用其他的存储Provisioner，记得有aws的。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661320044,"ip_address":"北京","comment_id":355351,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"由于用的是azure国际版的aks服务，无法直接搭建nfsserver。老师能否提供基于azure的nfs sample","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585069,"discussion_content":"没用过这些云服务器，抱歉了，可以考虑换用其他的存储Provisioner，记得有aws的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661320044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354889,"user_name":"Dexter","can_delete":false,"product_type":"c1","uid":2608728,"ip_address":"上海","ucode":"909CABC4AC4AC9","user_header":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","comment_is_top":false,"comment_ctime":1660867938,"is_pvip":true,"replies":[{"id":129101,"content":"是的，看用户名kubernetes-sigs。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660890587,"ip_address":"上海","comment_id":354889,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"这个link是官方的吗？https:&#47;&#47;github.com&#47;kubernetes-sigs&#47;nfs-subdir-external-provisioner","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584516,"discussion_content":"是的，看用户名kubernetes-sigs。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660890587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385261,"user_name":"Geek_5d4e3e","can_delete":false,"product_type":"c1","uid":3692272,"ip_address":"湖南","ucode":"CE56D64E71A707","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/OwolYO3ppfrxTcX81cswxC70LwthXDDbGbmswSe1xSl2ibxibLLy0Ka0KkZakE2uWYNHUzw2SrUSrbibntN93uS5w/132","comment_is_top":false,"comment_ctime":1702363080,"is_pvip":false,"replies":[{"id":140427,"content":"可能是新的provisioner变了，感谢指正。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1702433766,"ip_address":"上海","comment_id":385261,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"老师这个文章里存在错误，这个yaml文件并不能将回收策略更改为retain\napiVersion: storage.k8s.io&#47;v1\nkind: StorageClass\nmetadata:\n  name: nfs-client-retained\n\nprovisioner: k8s-sigs.io&#47;nfs-subdir-external-provisioner\nparameters:\n  onDelete: &quot;retain&quot;\n\n正确的yaml文件内容如下：\napiVersion: storage.k8s.io&#47;v1\nkind: StorageClass\nmetadata:\n  name: nfs-client\nprovisioner: k8s-sigs.io&#47;nfs-subdir-external-provisioner # or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;\nreclaimPolicy: Retain\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633646,"discussion_content":"可能是新的provisioner变了，感谢指正。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702433766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380258,"user_name":"默默且听风","can_delete":false,"product_type":"c1","uid":2539346,"ip_address":"北京","ucode":"105E5FD2429AE3","user_header":"https://static001.geekbang.org/account/avatar/00/26/bf/52/59304c42.jpg","comment_is_top":false,"comment_ctime":1693283153,"is_pvip":false,"replies":[{"id":138487,"content":"看样子是拉取k8s.gcr.io镜像的原因，尝试科学上网吧。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1693297760,"ip_address":"上海","comment_id":380258,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"老师，请教个问题。我使用helm安装MongoDB、Redis等集群并使用nfs的时候经常会报错\n Failed to create pod sandbox: rpc error: code = Unknown desc = failed to get sandbox image &quot;k8s.gcr.io&#47;pause:3.8&quot;: failed to pull image &quot;k8s.gcr.io&#47;pause:3.8&quot;: failed to pull and unpack image &quot;k8s.gcr.io&#47;pause:3.8&quot;: failed to resolve reference &quot;k8s.gcr.io&#47;pause:3.8&quot;: failed to do request: Head &quot;https:&#47;&#47;k8s.gcr.io&#47;v2&#47;pause&#47;manifests&#47;3.8&quot;: dial tcp 108.177.97.82:443: i&#47;o timeout \n每次手动执行\n#!&#47;bin&#47;bash\n\n# Pull the desired image using crictl\ncrictl pull registry.cn-hangzhou.aliyuncs.com&#47;google_containers&#47;pause:3.8\n\n# Tag the pulled image using ctr\nctr -n k8s.io i tag registry.cn-hangzhou.aliyuncs.com&#47;google_containers&#47;pause:3.8 k8s.gcr.io&#47;pause:3.8\n\necho &quot;Image pull and tag complete&quot;\n之后这个错误就又不在了。这个需要怎么设置一下吗？还是我的集群有问题。已经被折磨好几天了，百度不出来才来问的","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626717,"discussion_content":"看样子是拉取k8s.gcr.io镜像的原因，尝试科学上网吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693297761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377116,"user_name":"Greenery","can_delete":false,"product_type":"c1","uid":3566765,"ip_address":"中国香港","ucode":"16111129C9EBA2","user_header":"https://static001.geekbang.org/account/avatar/00/36/6c/ad/0a694b50.jpg","comment_is_top":false,"comment_ctime":1687941276,"is_pvip":false,"replies":[{"id":137497,"content":"应该不会的，在YAML里配置了哪个StorageClass就应该用哪个，可以再检查一下配置文件。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1688343965,"ip_address":"北京","comment_id":377116,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"就算是动态方式，这个storageClass也是会默认生成的对吗，我发现我的pvc中配置的storageClass是nfs-client，但是我只手动配置了文中的nfs-client-retain，也成功运行了。\n是不是实际上nfs-client-retain没有起作用，实际生效的sc是默认自动生成的nfs-client？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622489,"discussion_content":"应该不会的，在YAML里配置了哪个StorageClass就应该用哪个，可以再检查一下配置文件。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688343965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372991,"user_name":"至尊猴","can_delete":false,"product_type":"c1","uid":1743716,"ip_address":"北京","ucode":"4C7A26967DB608","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/64/dadf0ca5.jpg","comment_is_top":false,"comment_ctime":1681897380,"is_pvip":false,"replies":[{"id":136296,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1681958753,"ip_address":"北京","comment_id":372991,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"找到pvc不能调整大小的答案了：nfs provision 不能有空间限制，并且也不能resize\n------\nThe provisioned storage limit is not enforced. The application can expand to use all the available storage regardless of the provisioned size.\nStorage resize&#47;expansion operations are not presently supported in any form. You will end up in an error state: Ignoring the PVC: didn&#39;t find a plugin capable of expanding the volume; waiting for an external controller to process this PVC.\n\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614894,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681958753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372473,"user_name":"Geek_f2f06e","can_delete":false,"product_type":"c1","uid":3073745,"ip_address":"陕西","ucode":"B7AC635AFF7681","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/g4os8I4iaB6jn06PsvyqI1BooV5XbOC0vI3niaJ4I3SlAhkbBKG2eewlPHHJ4ROcDia18bbPFSZPDXXmgHXtrBlLg/132","comment_is_top":false,"comment_ctime":1681187523,"is_pvip":false,"replies":[{"id":135966,"content":"网上查一下资料，看看在自己的系统上该怎么正确配置nfs。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1681219523,"ip_address":"北京","comment_id":372473,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"&#47;tmp&#47;nfs 192.168.10.0&#47;24(rw,sync,no_subtree_check,no_root_squash,insecure)\n\n执行这句话的时候报了这个错误：\nbash: syntax error near unexpected token `(&#39;\n\n加了转译符之后报了这个错误：\nbash: &#47;tmp&#47;nfs: Is a directory\n\n这个应该怎么解决啊\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613265,"discussion_content":"网上查一下资料，看看在自己的系统上该怎么正确配置nfs。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681219523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371849,"user_name":"明月夜","can_delete":false,"product_type":"c1","uid":2767657,"ip_address":"广东","ucode":"50B12742F34285","user_header":"https://static001.geekbang.org/account/avatar/00/2a/3b/29/0f86235e.jpg","comment_is_top":false,"comment_ctime":1680424614,"is_pvip":false,"replies":[{"id":135641,"content":"kubernetes直接支持nfs。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1680480742,"ip_address":"北京","comment_id":371849,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"nfs-static-pvc的例子，不需要创建nfs的storageclass吗，直接在pvc里指定storageClassName：nfs 就可以？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612001,"discussion_content":"kubernetes直接支持nfs。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680480743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371507,"user_name":"GeekNeo","can_delete":false,"product_type":"c1","uid":1146405,"ip_address":"浙江","ucode":"1D355A9BEB8BEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/25/3932dafd.jpg","comment_is_top":false,"comment_ctime":1679995090,"is_pvip":false,"replies":[{"id":135618,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1680219792,"ip_address":"北京","comment_id":371507,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"yaml方式，安装github操作，做了下修改：在本地创建个目录，如nfs，放入自定义的yaml。\n---\n# namespace.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: nfs-provisioner\n\n---\n# patch_nfs_details.yaml\napiVersion: apps&#47;v1\nkind: Deployment\nmetadata:\n  labels:\n    app: nfs-client-provisioner\n  name: nfs-client-provisioner\nspec:\n  template:\n    spec:\n      containers:\n        - name: nfs-client-provisioner\n          image: chronolaw&#47;nfs-subdir-external-provisioner:v4.0.2\n          env:\n            - name: NFS_SERVER\n              value: 172.17.40.171\n            - name: NFS_PATH\n              value: &#47;tmp&#47;nfs\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 172.17.40.171\n            path: &#47;tmp&#47;nfs\n\n---\n# kustomization.yaml\nnamespace: nfs-provisioner\nbases:\n  - github.com&#47;kubernetes-sigs&#47;nfs-subdir-external-provisioner&#47;&#47;deploy\nresources:\n  - namespace.yaml\npatchesStrategicMerge:\n  - patch_nfs_details.yaml\n\n在nfs目录下执行：\nkubectl apply -k .\n很简单的完成了，前提是网络可以稍微拿到GitHub的yaml部署文件","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611645,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680219793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371496,"user_name":"GeekNeo","can_delete":false,"product_type":"c1","uid":1146405,"ip_address":"浙江","ucode":"1D355A9BEB8BEA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/25/3932dafd.jpg","comment_is_top":false,"comment_ctime":1679989644,"is_pvip":false,"replies":[{"id":135617,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1680219780,"ip_address":"北京","comment_id":371496,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"spec.nfs路径 不需要提前创建好，kubectl get pv也是可用状态，但是在创建pod状态时，pod状态一直在ContainerCreating的状态，kubectl describe pod nfs-static-pod查看问题，发现还是挂载的问题，挂载找不到目录1g-pv，报错如下：\nOutput: mount.nfs: mounting 172.17.40.171:&#47;tmp&#47;nfs&#47;1g-pv failed, reason given by server: No such file or directory\n故删除kubectl delete -f nfs-static-pod.yml，在NFS服务器&#47;tmp&#47;nfs&#47;目录下创建目录1g-pv，重新创建容器kubectl apply -f nfs-static-pod.yml，pod创建启动正常。\n\n但是在1.26.3中，前文我测试hostPath没问题哦，不需要提前创建目录，NFS的就需要。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611644,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680219780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371088,"user_name":"Geek_0e30b3","can_delete":false,"product_type":"c1","uid":3567377,"ip_address":"上海","ucode":"4B93D3865F2BC9","user_header":"","comment_is_top":false,"comment_ctime":1679537686,"is_pvip":false,"replies":[{"id":135443,"content":"NFS server 管理存储空间，应该会检测到。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1679705850,"ip_address":"湖南","comment_id":371088,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"老师有一个问题就是 ， 假设我的NFS capacity 是10G， 那么我动态创建PV的时候 ， PVC 申请容量大于10 G， 这个会检测到 超过了NFS server 的限制吗？ 不然没有限制， 我可以创建很多PV 即使我的NFS server容量很小","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610715,"discussion_content":"NFS server 管理存储空间，应该会检测到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679705850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"湖南","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3567377,"avatar":"","nickname":"Geek_0e30b3","note":"","ucode":"4B93D3865F2BC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":610889,"discussion_content":"但是我做了实验，自己创建了一个10G大小的 NFS server ，使用的是 nfs-subdir-external-provisioner,创建了11G的PVC PV是成功的，理论上不应该创建成功吧！ 而且之前也创建过3个 2G的PVC ，最多只能创建4G才是合理的！ 所以感觉是不是这个provisioner 不具备这个功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679834233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":610715,"ip_address":"江苏","group_id":0},"score":610889,"extra":""}]}]},{"had_liked":false,"id":370564,"user_name":"蔡晓慧","can_delete":false,"product_type":"c1","uid":1588301,"ip_address":"北京","ucode":"8D177D2B37BD6D","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","comment_is_top":false,"comment_ctime":1678960219,"is_pvip":false,"replies":[{"id":135227,"content":"也许是kubernetes版本不同，我用1.23是要手工创建的，不过这也是小事，因为实际场景里很少用host path类型。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1679023785,"ip_address":"上海","comment_id":370564,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"nfs.path:&#47;opt&#47;nfs&#47;1g-pv目录我没有手动创建，Pod挂载的时候会提示Output: mount.nfs: mounting 192.168.72.5:&#47;opt&#47;nfs&#47;1g-pv failed, reason given by server: No such file or directory\n\n但是HostPath挂载我自测是会自动创建的。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609554,"discussion_content":"也许是kubernetes版本不同，我用1.23是要手工创建的，不过这也是小事，因为实际场景里很少用host path类型。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679023785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1588301,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","nickname":"蔡晓慧","note":"","ucode":"8D177D2B37BD6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":609556,"discussion_content":"好的，谢谢老师。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679024284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609554,"ip_address":"北京","group_id":0},"score":609556,"extra":""}]}]},{"had_liked":false,"id":369047,"user_name":"骷髅骨头","can_delete":false,"product_type":"c1","uid":1078098,"ip_address":"广东","ucode":"9FCBA47EFD37F6","user_header":"https://static001.geekbang.org/account/avatar/00/10/73/52/8a4cf5e9.jpg","comment_is_top":false,"comment_ctime":1677043971,"is_pvip":true,"replies":[{"id":134389,"content":"nfs-client-retained是一个新的storageClass，示范了定制存储特性。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1677054844,"ip_address":"上海","comment_id":369047,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"pv和pvc的storageClassName都是nfs-client,  而storageClass的name是nfs-client-retain, 是笔误还是？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606250,"discussion_content":"nfs-client-retained是一个新的storageClass，示范了定制存储特性。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677054844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368594,"user_name":"极客酱酱","can_delete":false,"product_type":"c1","uid":2934665,"ip_address":"四川","ucode":"18CDC1DB754D58","user_header":"https://static001.geekbang.org/account/avatar/00/2c/c7/89/16437396.jpg","comment_is_top":false,"comment_ctime":1676464035,"is_pvip":false,"replies":[{"id":134238,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1676468506,"ip_address":"上海","comment_id":368594,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"spec.nfs里的路径如果不存在，PV 没有处于“pending”状态，但是在创建pod时会起不来，报错：reason given by server: No such file or directory，还是提前创建目录保险","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":604887,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676468506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364061,"user_name":"路先生","can_delete":false,"product_type":"c1","uid":1700663,"ip_address":"上海","ucode":"AC42E46434A569","user_header":"https://static001.geekbang.org/account/avatar/00/19/f3/37/30a09a4a.jpg","comment_is_top":false,"comment_ctime":1670488753,"is_pvip":false,"replies":[{"id":132368,"content":"感觉不对，应该是retain吧，看看是否还有哪里没配置好。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1670564734,"ip_address":"上海","comment_id":364061,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"罗老师请教下，在class-retained.yaml里面定义\nparameters:\n  onDelete: &quot;retain&quot;\n但是执行kubectl get sc -n kube-system\nRECLAIMPOLICY列显示是Delete，\n执行kubectl get pv -n devops\nRECLAIM POLICY列显示也是Delete，\n这是正常的吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596021,"discussion_content":"感觉不对，应该是retain吧，看看是否还有哪里没配置好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670564734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363304,"user_name":"菲茨杰拉德","can_delete":false,"product_type":"c1","uid":1875922,"ip_address":"北京","ucode":"4EB29359F39862","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","comment_is_top":false,"comment_ctime":1669515239,"is_pvip":false,"replies":[{"id":132087,"content":"IP地址是nfs允许访问的网段，也就是Kubernetes节点的网段。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1669542170,"ip_address":"北京","comment_id":363304,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"\n&#47;tmp&#47;nfs 192.168.10.0&#47;24(rw,sync,no_subtree_check,no_root_squash,insecure)\n这个ip 是按照nfs的节点的ip?","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594908,"discussion_content":"IP地址是nfs允许访问的网段，也就是Kubernetes节点的网段。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669542170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362708,"user_name":"Bachue Zhou","can_delete":false,"product_type":"c1","uid":1494491,"ip_address":"北京","ucode":"3175754775CA32","user_header":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","comment_is_top":false,"comment_ctime":1668769740,"is_pvip":false,"replies":[{"id":131892,"content":"Kubernetes运行在Linux之上，它自身是没有能力挂载nfs的，而且nfs盘也应该分目录来存放数据，直接用就很容易冲突，导致数据损坏。","user_name":"作者回复","user_name_real":"作者","uid":1181974,"ctime":1668773461,"ip_address":"北京","comment_id":362708,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"为什么要在 node 上手动挂载 nfs volume，然后还要在 kubernetes 上声明这个路径是 nfs 的？既然都已经挂载了，kubernetes 直接使用这个路径不就行了嘛？另外为什么 kubernetes 不能自行挂载 nfs volume 呢？要求用户必须在所有 node 上全都挂载好 nfs 不是很麻烦吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594095,"discussion_content":"Kubernetes运行在Linux之上，它自身是没有能力挂载nfs的，而且nfs盘也应该分目录来存放数据，直接用就很容易冲突，导致数据损坏。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668773461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360561,"user_name":"rubys_","can_delete":false,"product_type":"c1","uid":1394115,"ip_address":"上海","ucode":"931AD02864126A","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/c3/775fe460.jpg","comment_is_top":false,"comment_ctime":1666662530,"is_pvip":false,"replies":[{"id":131174,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1666667132,"ip_address":"上海","comment_id":360561,"utype":1}],"discussion_count":1,"race_medal":2,"score":4,"product_id":100114501,"comment_content":"chronolaw&#47;nfs-subdir-external-provisioner:v4.0.2 在我的虚拟机拉取也失败，换一台机来拉取，然后使用  docker save 保存到文件，将这个导出的镜像文件放到虚拟机里面 docker load 导入，解决虚拟机拉取镜像失败的问题","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591573,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666667132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358947,"user_name":"mamafeng","can_delete":false,"product_type":"c1","uid":3190249,"ip_address":"北京","ucode":"ED0AB11EAAC762","user_header":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","comment_is_top":false,"comment_ctime":1665053002,"is_pvip":false,"replies":[{"id":130546,"content":"可能还是nfs的服务端没安装好，我没怎么用过CentOS，也许只能在网上找解决方案了。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1665059917,"ip_address":"北京","comment_id":358947,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"请问大佬，我使用的是云服务Centos7, 三台机器开启了内网互联，并且关闭了防火墙，而且也可以ping通，但是在clinet 使用命令 showmount -e ‘服务器的ip地址’, 却一直卡着什么反应没有\n\n\n但是我在client的服务器上使用命令：sudo mount -t nfs 10.0.4.10:&#47;tmp&#47;nfs &#47;tmp&#47;data\n\n然后使用 df -h , 发现有一条成功的挂载记录\nFilesystem          Size  Used Avail Use% Mounted on\n10.0.4.10:&#47;tmp&#47;nfs   59G  5.9G   51G  11% &#47;tmp&#47;data\n\n这个时候在客户端使用命令：showmount -e 10.0.4.10 还是连接不上，一直卡着不动，\n我在客户端和服务器相应的挂载目录创建文件，发现也没有共享","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589526,"discussion_content":"可能还是nfs的服务端没安装好，我没怎么用过CentOS，也许只能在网上找解决方案了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665059917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608531,"discussion_content":"另外 nfs client 机器重启后，挂载的记录就消失了，有大佬知道是什么原因吗\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678504002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3190249,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ad/e9/778ddf53.jpg","nickname":"mamafeng","note":"","ucode":"ED0AB11EAAC762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608530,"discussion_content":"遇到了相同的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678503972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357489,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"北京","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1663306210,"is_pvip":false,"replies":[{"id":130103,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1663307766,"ip_address":"北京","comment_id":357489,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"作业：\n动态存储卷相比静态存储卷有什么好处？有没有缺点？\n个人觉得动态卷的灵活性高，运维定义好相应的存储 StorageClass ，开发可以忽视不同的存储细节，只定义相应的 PVC 申请和使用存储。个人觉得它的缺点也是因为它的灵活性，也可能导致管理松散。\n\nStorageClass 在动态存储卷的分配过程中起到了什么作用？\n关联各种类型存储卷的定制化的 Provisioner。解藕了使用和各类存储的实现细节。\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587823,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663307766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356810,"user_name":"Obscure","can_delete":false,"product_type":"c1","uid":3171798,"ip_address":"北京","ucode":"8A7464990F4178","user_header":"https://static001.geekbang.org/account/avatar/00/30/65/d6/20670fd5.jpg","comment_is_top":false,"comment_ctime":1662605914,"is_pvip":false,"replies":[{"id":129856,"content":"课程里用tmp目录是为了方便，如果想要长期使用nfs存储可以换成其他的目录。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1662619506,"ip_address":"北京","comment_id":356810,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"Linux中 &#47;tmp 目录下的内容每次开机都会被清空","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586937,"discussion_content":"课程里用tmp目录是为了方便，如果想要长期使用nfs存储可以换成其他的目录。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662619506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356772,"user_name":"Geek_9d0de4","can_delete":false,"product_type":"c1","uid":3031731,"ip_address":"上海","ucode":"6692B89D125E9B","user_header":"","comment_is_top":false,"comment_ctime":1662566114,"is_pvip":false,"replies":[{"id":129849,"content":"nfs服务搭建的基本步骤都在正文里了，如果有问题可以在搜索引擎里查一下错误信息，应该会有解决方案。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1662603114,"ip_address":"上海","comment_id":356772,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"root@worker2:~# mount -t nfs 192.168.56.83:&#47;tmp&#47;nfs &#47;tmp&#47;test -vvvv\nmount.nfs: timeout set for Wed Sep  7 15:56:28 2022\nmount.nfs: trying text-based options &#39;vers=4.2,addr=192.168.56.83,clientaddr=192.168.56.82&#39;\nmount.nfs: mount(2): Permission denied\nmount.nfs: trying text-based options &#39;vers=4,minorversion=1,addr=192.168.56.83,clientaddr=192.168.56.82&#39;\nmount.nfs: mount(2): Permission denied\nmount.nfs: trying text-based options &#39;vers=4,addr=192.168.56.83,clientaddr=192.168.56.82&#39;\nmount.nfs: mount(2): Permission denied\nmount.nfs: trying text-based options &#39;addr=192.168.56.83&#39;\nmount.nfs: prog 100003, trying vers=3, prot=6\nmount.nfs: trying 192.168.56.83 prog 100003 vers 3 prot TCP port 2049\nmount.nfs: prog 100005, trying vers=3, prot=17\nmount.nfs: trying 192.168.56.83 prog 100005 vers 3 prot UDP port 55070\nmount.nfs: mount(2): Permission denied\nmount.nfs: access denied by server while mounting 192.168.56.83:&#47;tmp&#47;nfs","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586909,"discussion_content":"nfs服务搭建的基本步骤都在正文里了，如果有问题可以在搜索引擎里查一下错误信息，应该会有解决方案。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662603115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355286,"user_name":"Null","can_delete":false,"product_type":"c1","uid":1013728,"ip_address":"北京","ucode":"3A0BC281632DD9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/e0/81db900c.jpg","comment_is_top":false,"comment_ctime":1661247301,"is_pvip":false,"replies":[{"id":129273,"content":"感谢指正","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661295852,"ip_address":"北京","comment_id":355286,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"\n#kubecal 错了\nkubecal apply -f rbac.yaml\nkubecal apply -f class.yaml\nkubecal apply -f deployment.yaml\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585020,"discussion_content":"感谢指正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661295852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606881,"discussion_content":"k8s的命令行工具是kubectl","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677478388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355244,"user_name":"Alsaka_Ta","can_delete":false,"product_type":"c1","uid":3120153,"ip_address":"北京","ucode":"2CB19C2E5EECBD","user_header":"https://static001.geekbang.org/account/avatar/00/2f/9c/19/15c2c7e0.jpg","comment_is_top":false,"comment_ctime":1661223606,"is_pvip":false,"replies":[{"id":129252,"content":"先看看节点是否正确安装了nfs-client，然后用showmount命令手动检查能否正常挂载，如果手动挂载没问题nfs Provisioner一定是可以的。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661227802,"ip_address":"北京","comment_id":355244,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"您好！我在部署 NFS Provisoner时发现pod一直处在ContainerCreating状态，查看详细信息后发现有如下的报错信息，看上去应该是节点上的目录无法挂载成功\nWarning  FailedMount  13s    kubelet            Unable to attach or mount volumes: unmounted volumes=[nfs-client-root], unattached volumes=[nfs-client-root kube-api-access-s9kgj]: timed out waiting for the condition\n请问这样的情况应该怎样解决呢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584928,"discussion_content":"先看看节点是否正确安装了nfs-client，然后用showmount命令手动检查能否正常挂载，如果手动挂载没问题nfs Provisioner一定是可以的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661227802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"朱雯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588952,"discussion_content":"我这里也是半天不行，后面发现因为deployment上面的pod跑到了worker节点，所以所有节点都装一下nfs-common和rpcbind吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664250393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"中国香港","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355114,"user_name":"szy0syz","can_delete":false,"product_type":"c1","uid":1043702,"ip_address":"北京","ucode":"720F05ACB6DE69","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/f6/3bb40677.jpg","comment_is_top":false,"comment_ctime":1661092556,"is_pvip":false,"replies":[{"id":129220,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661137458,"ip_address":"北京","comment_id":355114,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"跟着chrono的给的yaml文件，一步一步手动敲实验真的很重要。\n这节实验pass~~","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584794,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661137458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354967,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"北京","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1660919526,"is_pvip":false,"replies":[{"id":129122,"content":"client是客户端，连接server，数据当然只能存在server上。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660956886,"ip_address":"北京","comment_id":354967,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"请教老师一个问题：\nQ1：NFS，数据实际只能存储在server上吗？ 还是说server、client都能存？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584583,"discussion_content":"client是客户端，连接server，数据当然只能存在server上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660956886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372990,"user_name":"至尊猴","can_delete":false,"product_type":"c1","uid":1743716,"ip_address":"北京","ucode":"4C7A26967DB608","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/64/dadf0ca5.jpg","comment_is_top":false,"comment_ctime":1681896101,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"请问Chrono老师，对于存储扩容的需求，nfs能满足么？试了一下直接改pvc的配置是报错不能动态调整，\n通过改storageclass的属性可以实现么？\n---------------------\n[root@master nfs]# kubectl apply -f pvc.yml \nError from server (Forbidden): error when applying patch:\n{&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;kubectl.kubernetes.io&#47;last-applied-configuration&quot;:&quot;{\\&quot;apiVersion\\&quot;:\\&quot;v1\\&quot;,\\&quot;kind\\&quot;:\\&quot;PersistentVolumeClaim\\&quot;,\\&quot;metadata\\&quot;:{\\&quot;annotations\\&quot;:{},\\&quot;name\\&quot;:\\&quot;nfs-dyn-10m-pvc\\&quot;,\\&quot;namespace\\&quot;:\\&quot;default\\&quot;},\\&quot;spec\\&quot;:{\\&quot;accessModes\\&quot;:[\\&quot;ReadWriteMany\\&quot;],\\&quot;resources\\&quot;:{\\&quot;requests\\&quot;:{\\&quot;storage\\&quot;:\\&quot;20Mi\\&quot;}},\\&quot;storageClassName\\&quot;:\\&quot;nfs-client\\&quot;}}\\n&quot;}},&quot;spec&quot;:{&quot;resources&quot;:{&quot;requests&quot;:{&quot;storage&quot;:&quot;20Mi&quot;}}}}\nto:\nResource: &quot;&#47;v1, Resource=persistentvolumeclaims&quot;, GroupVersionKind: &quot;&#47;v1, Kind=PersistentVolumeClaim&quot;\nName: &quot;nfs-dyn-10m-pvc&quot;, Namespace: &quot;default&quot;\nfor: &quot;pvc.yml&quot;: persistentvolumeclaims &quot;nfs-dyn-10m-pvc&quot; is forbidden: only dynamically provisioned pvc can be resized and the storageclass that provisions the pvc must support resize\n","like_count":0},{"had_liked":false,"id":372195,"user_name":"kobe","can_delete":false,"product_type":"c1","uid":1165831,"ip_address":"浙江","ucode":"AB8B599F3D5521","user_header":"https://static001.geekbang.org/account/avatar/00/11/ca/07/22dd76bf.jpg","comment_is_top":false,"comment_ctime":1680836157,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"我偶然发现 这个动态数据卷创建的StorageClass和pv好像在每个namespace都会有一个 这个是k8s的设计就是如此么","like_count":0}]}