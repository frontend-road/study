{"id":506638,"title":"11ï½œå•å…ƒæµ‹è¯•ï¼ˆäºŒï¼‰ï¼šå››è±¡é™æ³•è®©ä½ çš„å•æµ‹ç«åŠ›å…¨å¼€","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æŸ³èƒœã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬å†™äº†OrderServiceTestæµ‹è¯•ç±»ï¼Œæ¥æµ‹è¯•FoodComeçš„OrderServiceç±»ã€‚è¿™æ ·ä¸ç®¡å¼€å‘ä»£ç è¿˜æ˜¯æµ‹è¯•ä»£ç ï¼Œéƒ½æ˜¯ç®€å•æ¸…æ¥šçš„ã€‚è¿™æ˜¯å› ä¸ºFoodComeçš„å¼€å‘äººå‘˜å¯¹ä»£ç æœ‰ä¸€ä¸ªå¥½çš„è®¾è®¡ï¼Œå®ç°äº†Controllerã€Serviceã€Repositoryç­‰Classçš„èŒèƒ½åˆ’åˆ†ï¼ŒOrderServiceç±»é‡Œä¸“æ³¨è®¢å•ç®¡ç†ï¼Œæˆ‘ä»¬å†™å‡ºçš„OrderServiceTestæ‰èƒ½é›†ä¸­ç«åŠ›æµ‹è¯•ã€‚</p><p>ä½†æ˜¯å¥½çš„è®¾è®¡ä¸æ˜¯å¤©ä¸Šæ‰ä¸‹æ¥çš„ï¼Œæœ‰çš„å›¢é˜Ÿåœ¨åˆšä¸€å¼€å§‹å†™çš„ä»£ç ç»“æ„æ€§å¹¶ä¸å¥½ï¼Œè¿™æœ‰å¯èƒ½æ˜¯é¡¹ç›®çš„é—®é¢˜ï¼Œéœ€æ±‚ä¸æ˜ç¡®ã€èµ¶è¿›åº¦ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¼€å‘äººå‘˜çš„æŠ€æœ¯åŠŸåº•ä¸æ‰å®ã€æŠ½è±¡èƒ½åŠ›ä¸å¤Ÿã€‚æ‰€ä»¥ï¼Œåœ¨è½¯ä»¶ç”Ÿå‘½å‘¨æœŸå†…ï¼Œéœ€è¦æŒç»­é‡æ„ï¼Œæ‰èƒ½æ‰“ç£¨å‡ºå¥½çš„è®¾è®¡ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å°±ç”¨ä¸€ä¸ªä¾‹å­ï¼Œæ¥çœ‹çœ‹å¥½çš„ä»£ç è®¾è®¡æ˜¯æ€ä¹ˆæ‰“ç£¨å‡ºæ¥çš„ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬è¦ä»æµ‹è¯•çš„è§’åº¦æ¥è¯„ä¼°è®¾è®¡çš„æ•ˆæœï¼Œé‚£å°±æ˜¯å•å…ƒæµ‹è¯•å®¹æ˜“å†™ã€è¦†ç›–ç‡é«˜ã€å¹²å‡€æ˜“æ‡‚ï¼Œè¿™åˆå«ä»£ç å¯æµ‹è¯•æ€§ã€‚</p><p>ä½œä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•æ¶æ„å¸ˆï¼Œä½ éœ€è¦æŒæ¡è§‚å¯Ÿå’Œè¯„ä¼°ä»£ç å¯æµ‹è¯•æ€§çš„èƒ½åŠ›ï¼Œæœ‰èƒ½åŠ›æ¨åŠ¨ä½ çš„å¼€å‘å›¢é˜Ÿåšå¥½ä»£ç è®¾è®¡ï¼Œèµ°å‘å•å…ƒæµ‹è¯•ã€‚</p><h2>ä»ä¸€ä¸ªéœ€æ±‚è¯´èµ·</h2><p>æœ‰ä¸€å¤©ï¼Œè€æ¿ç»™FoodComeè®¢é¤ç³»ç»Ÿæäº†ä¸€ä¸ªéœ€æ±‚ï¼Œå¸Œæœ›ç”¨æˆ·åœ¨é¡µé¢ä¸Šå¯ä»¥ä¿®æ”¹è‡ªå·±çš„é‚®ç®±åœ°å€ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/7a/45/7aa7d008a286da48897364228a21cc45.jpg?wh=1920x1284\" alt=\"å›¾ç‰‡\"></p><p>è¿™ä¸ªä¿®æ”¹è¡Œä¸ºåç«¯å®ç°èµ·æ¥ä¼¼ä¹å¾ˆç®€å•ï¼Œä¿®æ”¹é‚®ç®±å°±æ˜¯æ›´æ–°æ•°æ®åº“é‡Œçš„ç”¨æˆ·ä¿¡æ¯ã€‚ä½†åœ¨FoodComeå¹³å°ä¸Šæœ‰ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œé‚®ç®±åœ°å€åŸŸåå¦‚æœæ˜¯@foodcome.comï¼Œè¿™è¯´æ˜æ˜¯å¹³å°ä¸Šæ³¨å†Œçš„é¤é¦†å•†å®¶ï¼Œå¦åˆ™ï¼Œå°±æ˜¯æ™®é€šé¡¾å®¢ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ç”¨æˆ·ä¿®æ”¹é‚®ç®±çš„æ—¶å€™ï¼ŒåŠ å…¥ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœé‚®ç®±åœ°å€çš„ä¿®æ”¹æ˜¯ä»æ™®é€šåŸŸåˆ°@FoodComeåŸŸï¼Œå•†å®¶åœ¨å¹³å°é‡Œçš„æ•°é‡å°±+1ï¼Œå¦åˆ™ï¼Œå°±-1ã€‚</p><p>è¿™ä¸ªéœ€æ±‚çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæ˜¯å§ã€‚ä½†æ˜¯æˆ‘è¦å‘Šè¯‰ä½ ï¼Œå³ä½¿è¿™ä¹ˆç®€å•çš„é€»è¾‘ï¼Œä¹Ÿéœ€è¦åšå¥½è®¾è®¡ï¼Œå¦åˆ™ï¼Œå†™å‡ºæ¥çš„ä»£ç å¯èƒ½å®Œå…¨æ— æ³•å•å…ƒæµ‹è¯•ï¼Œä¸ä¿¡å°±æ¥çœ‹çœ‹å§ã€‚</p><h2>ç‰ˆæœ¬V1</h2><p>æ—¢ç„¶è€æ¿æäº†éœ€æ±‚ï¼Œè‡ªç„¶è¦èµ¶ç´§å®Œæˆã€‚å¼€å‘äººå‘˜å°èƒœåŒå­¦ç«‹åˆ»åœ¨ä¸‹ç­å‰å®Œæˆäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ–°å»ºäº†ä¸€ä¸ªUserç±»ï¼Œåœ¨Userç±»é‡Œæœ‰ä¸€ä¸ªchangeEmailçš„æ–¹æ³•ï¼Œè´Ÿè´£ä¿®æ”¹é‚®ç®±åœ°å€ã€‚è¿™æ˜¯ç¬¬ä¸€ç‰ˆä»£ç <strong>User.java</strong>ä¸‹çš„å†…å®¹ï¼š</p><pre><code class=\"language-java\">public class User\n{\n    public int UserId { get; private set; }\n    public string Email { get; private set; }\n    public UserType Type { get; private set; }\n\n    public void ChangeEmail(int userId, string newEmail)\n    {\n        //æŸ¥è¯¢å‡ºæ¥ç”¨æˆ·çš„IDï¼Œemailå’Œtype\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object[]&nbsp;data&nbsp;=&nbsp;Database.GetUserById(userId);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        UserId = userId;\n        Email = (string)data[1];\n        Type = (UserType)data[2];\n        //å¦‚æœå’Œä¿®æ”¹å‰çš„emailç›¸åŒï¼Œç›´æ¥è¿”å›\n        if (Email == newEmail)\n            return;\n        //ä»æ•°æ®åº“é‡Œè·å¾—å•†å®¶çš„æ•°é‡\n        int numberOfRestaurtants = Database.GetRestaurant();\n        //åˆ¤æ–­ç”¨æˆ·è¦ä¿®æ”¹çš„ç±»å‹æ˜¯å•†å®¶è¿˜æ˜¯é¡¾å®¢\n        string emailDomain = newEmail.Split('@')[1];\n        bool isEmailRestaurant = emailDomain == \"foodcome.com\";\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserType&nbsp;newType&nbsp;=&nbsp;isEmailRestaurant&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?&nbsp;UserType.Restaurant&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;UserType.Customer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n        //å¦‚æœæ˜¯ä¿®æ”¹æˆä¸ºå•†å®¶ï¼Œé‚£ä¹ˆå•†å®¶æ•°é‡+1ï¼Œå¦‚æœæ˜¯ä¿®æ”¹ä¸ºé¡¾å®¢ï¼Œå•†å®¶æ•°é‡-1  \n        if (Type != newType)\n        {\n            int delta = newType == UserType.Restaurant ? 1 : -1;\n            int newNumber = numberOfRestaurtants + delta;\n            Database.SaveRestaurant(newNumber);   \n            MessageBus.SendEmailChangedMessage(UserId, newEmail);                     \n        }\n        //æäº¤ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ï¼Œå…¥åº“\n        Database.SaveUser(this);                                  \n           \n    }\n}\npublic enum UserType\n{\n    Restaurant = 1,\n    Employee = 2\n}\n</code></pre><p>ä¸Šé¢çš„ä»£ç å¹¶ä¸å¤æ‚ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åˆ¤æ–­é‚®ä»¶åœ°å€æ˜¯å¦ä¸ºFoodComeï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Œå‘é€é€šçŸ¥åˆ°æ¶ˆæ¯æ€»çº¿ä¸Šã€‚</p><p>é‚£å®ƒçš„å¯æµ‹è¯•æ€§æ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªä»£ç å¤æ‚åº¦å››è±¡é™æ³•åˆ™æ¥å®Œæˆè¿™ä¸ªè¯„ä¼°ï¼Œå®ƒçš„åŸç†æ˜¯ï¼Œç”¨ä»¥ä¸‹2ä¸ªç»´åº¦æ¥è¯„ä¼°ä»£ç ï¼š</p><p>1.é¢†åŸŸå¤æ‚åº¦ï¼Œä»£ç çš„é¢†åŸŸå¤æ‚åº¦è¶Šé«˜ï¼Œé‡Œé¢çš„ä¸šåŠ¡é€»è¾‘å°±è¶Šå¤šã€‚<br>\n2.å¯¹å¤–ä¾èµ–åº¦ï¼Œä¾èµ–åº¦è¶Šé«˜ï¼Œè¯´æ˜ä»£ç å’Œå¤–éƒ¨çš„Classäº¤äº’ç‚¹å¤šã€‚</p><p>æ¯ä¸ªç»´åº¦éƒ½æœ‰é«˜ä½ï¼Œ2ä¸ªç»´åº¦çš„é«˜ä½ç»„åˆåœ¨ä¸€èµ·å°±æˆäº†å››ä¸ªè±¡é™ã€‚</p><p>1.ä¸šåŠ¡å¤æ‚ã€ä¾èµ–åˆå°‘ï¼Œæ˜¯ä¸šåŠ¡é€»è¾‘é›†ä¸­çš„ä»£ç ã€‚æ¯”å¦‚ä¸šåŠ¡ç®—æ³•ã€‚<br>\n2.ä¸šåŠ¡ç®€å•ã€ä¾èµ–åˆå°‘ï¼Œæ˜¯ä¸€äº›ç®€å•ä»£ç ï¼Œæ¯”å¦‚æ„é€ å‡½æ•°ï¼Œæ•°æ®å¯¹è±¡ç­‰ã€‚<br>\n3.ä¸šåŠ¡å¤æ‚ã€ä¾èµ–å¤šï¼Œæ˜¯å¤æ‚åº¦é«˜çš„ä»£ç ï¼Œæµ‹è¯•èµ·æ¥ä¹Ÿä¼šæ¯”è¾ƒå›°éš¾ã€‚<br>\n4.ä¸šåŠ¡ç®€å•ã€ä¾èµ–å¤šï¼Œæ˜¯ç®¡ç†ä¾èµ–çš„ä»£ç ã€‚æ¯”å¦‚æ¶ˆæ¯æ€»çº¿ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/00/b828cec1b566e1df1ff6640fe5f32900.jpg?wh=1920x1547\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬è¦æŠŠå¼€å‘çš„ä»£ç æ”¾åˆ°å››ä¸ªè±¡é™é‡Œï¼Œæ¯ä¸ªè±¡é™å¯¹åº”ä¸åŒçš„æµ‹è¯•ç­–ç•¥ã€‚é‚£å°èƒœåŒå­¦çš„User Classï¼Œåº”è¯¥æ”¾åˆ°å“ªä¸ªè±¡é™å‘¢ï¼Ÿ</p><p>User Classé‡ŒåŒ…å«äº†changeEmailçš„ä¸šåŠ¡é€»è¾‘ï¼Œå°±æ˜¯æ ¹æ®Emailçš„åœ°å€å†³å®šå¦‚ä½•å˜æ›´Restaurantçš„æ•°é‡ã€‚åŒæ—¶ï¼ŒUser Classé‡Œè¿˜æœ‰2ä¸ªå¤–éƒ¨ä¾èµ–ï¼šDatabaseå’ŒMessageBusï¼Œè¿™ä¸ªä¾èµ–è¿˜æ˜¯éšå¼çš„ï¼Œæ²¡æœ‰å£°æ˜åœ¨æˆå‘˜å˜é‡é‡Œï¼Œä½ å¾—çœ‹ä»£ç æ‰èƒ½æ‰¾åˆ°2ä¸ªå¤–éƒ¨ä¾èµ–æ˜¯æ€ä¹ˆä½¿ç”¨çš„ã€‚</p><p>æ˜¾ç„¶ï¼ŒUser classå±äºé¢†åŸŸå’Œä¾èµ–æ··åˆçš„ä»£ç ï¼Œåº”è¯¥å½’å±äº<strong>å¤æ‚ä»£ç </strong>è±¡é™ã€‚</p><p>é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ€ä¹ˆæµ‹è¯•User Classå‘¢ï¼Ÿ</p><p>ä¸ºäº†è°ƒç”¨changeEmailæ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°Mock Databaseå’ŒMessageBusä¸¤ä¸ªå¯¹è±¡ï¼Œä½†éš¾ç‚¹æ˜¯ï¼Œæ ¹æœ¬æ²¡æœ‰åŠæ³•æŠŠMockå¯¹è±¡ä¼ é€’changeEmailæ–¹æ³•é‡Œå»ã€‚</p><p>æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•å•å…ƒæµ‹è¯•User Classçš„ï¼Œå®ƒçš„å¯æµ‹è¯•æ€§ä¸º0ã€‚</p><p>å› æ­¤ï¼Œå°èƒœåŒå­¦éœ€è¦é‡æ„ä»£ç ï¼ŒæŠŠ<strong>å¤æ‚ä»£ç </strong>è±¡é™çš„ä»£ç åˆ†è§£åˆ°<strong>é¢†åŸŸä»£ç </strong>è±¡é™å’Œ<strong>ä¾èµ–ä»£ç </strong>è±¡é™ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/02/16/0257c4ff30f7be0e4fb0e3f14aa82e16.jpg?wh=1920x1571\" alt=\"å›¾ç‰‡\"></p><h2>ç‰ˆæœ¬V2</h2><p>ä¸‹é¢æ¥åˆ°ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå°èƒœå°†ä¸šåŠ¡é€»è¾‘å’Œä¸å¤–éƒ¨ä¾èµ–çš„äº¤äº’åˆ†ç¦»ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„UserController Classæ¥ä¸“æ³¨ç®¡ç†å¤–éƒ¨ä¾èµ–ã€‚</p><p><strong>UserController.java</strong>çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class UserController\n{\n    //åœ¨controlleré‡Œå£°æ˜ä¸¤ä¸ªå¤–éƒ¨ä¾èµ–\n    private readonly Database _database = new Database();\n    private readonly MessageBus _messageBus = new MessageBus();\n    //changeEmailæ–¹æ³•é‡Œè°ƒç”¨ä¾èµ–\n    public void ChangeEmail(int userId, string newEmail)\n    {\n        object[] data = _database.GetUserById(userId);\n        string email = (string)data[1];\n        UserType type = (UserType)data[2];\n        var user = new User(userId, email, type);\n\n        int numberOfRestaurants = _database.GetRestauruant();\n        string companyDomainName = \"foodcome.com\";\n        //è°ƒç”¨Userçš„changeEmailï¼Œè¿”å›å˜åŒ–çš„å•†å®¶æ•°é‡ã€‚\n        int newNumberOfRestaurants = user.ChangeEmail(\n            newEmail, companyDomainName, numberOfRestaurants);\n        //è°ƒç”¨ä¾èµ–ï¼Œå˜æ›´æ•°æ®åº“å’Œå‘å¸ƒæ¶ˆæ¯\n        if(newNumberOfRestaurants!=numberOfRestaurants){\n          _database.SaveCompany(newNumberOfRestaurants);\n          _database.SaveUser(user);\n          _messageBus.SendEmailChangedMessage(userId, newEmail);\n        }\n    }\n}\n</code></pre><p>åŒæ—¶æˆ‘ä»¬è¦ä¿®æ”¹User Classï¼Œå®ƒä¸è´Ÿè´£ä»»ä½•ä¾èµ–ï¼Œåªå…³æ³¨changeEmailçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ ¹æ®è¾“å…¥å‚æ•°ï¼Œç®—å‡ºæ¥æ–°çš„å•†å®¶çš„æ•°é‡ã€‚</p><p><strong>User.java</strong>çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class User\n{\n    public int ChangeEmail(string newEmail,\n    string companyDomainName, int numberOfRestaurants)\n   {\n    if (Email == newEmail)\n        return numberOfRestaurants;\n\n    string emailDomain = newEmail.Split('@')[1];\n    bool isEmailCorporate = emailDomain == companyDomainName;\n    UserType newType = isEmailCorporate\n        ? UserType.Restaurant\n        : UserType.Customer;\n    if (Type != newType)\n    {\n        int delta = newType == UserType.Employee ? 1 : -1;\n        int newNumber = numberOfRestaurants + delta;\n        numberOfRestaurants = newNumber;\n    }\n    return numberOfRestaurants;\n&nbsp;&nbsp;}\n}\n</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œç›¸æ¯”ç‰ˆæœ¬1 ï¼Œç‰ˆæœ¬2æœ‰äº†è¿›æ­¥ï¼Œå¤šäº†UserController Classæ¥ä¸“é—¨è´Ÿè´£ç®¡ç†å¤–éƒ¨äº¤äº’ï¼Œéšå¼ä¾èµ–çš„Databaseå’ŒMessageBuså˜æˆäº†æ˜¾å¼æˆå‘˜å˜é‡ã€‚User classä¸“é—¨è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œåˆ¤æ–­ä¸ºé¤é¦†è¿˜æ˜¯å®¢æˆ·ã€‚</p><p>æˆ‘ä»¬å†ç”¨å¤æ‚åº¦å››è±¡é™æ¥è§‚å¯Ÿç°åœ¨çš„ä»£ç ï¼Œå®ƒçš„åˆ†å¸ƒæƒ…å†µå˜ä¸ºä¸‹å›¾è¿™æ ·ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤æ‚ä»£ç æ¶ˆå¤±äº†ï¼ŒåŸå…ˆä¸€ä¸ªUser.javaæ–‡ä»¶é‡Œçš„é€»è¾‘è¢«åˆ†æ•£åˆ°äº†ä¸¤ä¸ªæ–‡ä»¶é‡Œï¼Œä¸€ä¸ªæ˜¯UserController.javaï¼Œå®ƒä¸“æ³¨äºç®¡ç†ä¾èµ–ï¼Œä½äºä¾èµ–ä»£ç è±¡é™ï¼›è¿˜æœ‰ä¿®æ”¹åçš„User.javaï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°ï¼Œä½äºé¢†åŸŸä»£ç è±¡é™ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/18/86/181afae377e2d60f74916703810a8386.jpg?wh=1920x1526\" alt=\"å›¾ç‰‡\"></p><p>ç°åœ¨å¯ä»¥æµ‹è¯•äº†ï¼</p><p>User Classåªæœ‰ä¸€ä¸ªchangeEmailçš„æ–¹æ³•ï¼Œæ–¹æ³•é‡Œåªæ˜¯å¯¹é‚®ä»¶åœ°å€åšåˆ¤æ–­ï¼Œå¹¶è®¡ç®—æ–°çš„é¤é¦†æ•°é‡ï¼Œå°†æ–°å€¼è¿”å›ï¼Œä¸ä¼šæ¶‰åŠåˆ°æ“ä½œæ•°æ®åº“å’Œæ¶ˆæ¯æ€»çº¿ã€‚User Classå¯ä»¥æµ‹è¯•äº†ï¼Œå› ä¸ºä¸éœ€è¦åšä»»ä½•Mockï¼Œæˆ‘å«å®ƒ<strong>ç®€å•æµ‹è¯•</strong>ã€‚</p><p>è€Œ2ä¸ªå¤–éƒ¨ä¾èµ–Databaseå’ŒMessageBuséƒ½è¢«æ˜¾å¼åœ°å°è£…åœ¨UserController Classé‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥ä¼ é€’Mockå¯¹è±¡ï¼ŒUserControllerä¹Ÿæ˜¯å¯ä»¥æµ‹è¯•çš„ï¼Œæˆ‘å«å®ƒ<strong>Mockæµ‹è¯•</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œç‰ˆæœ¬2ä¾æ—§ä¸å¤Ÿæ¸…çˆ½ï¼Œè¿˜å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ã€‚</p><ol>\n<li>\n<p>UserControlleré‡Œå®ä¾‹åŒ–äº†User classï¼Œè¿™åŒ…å«äº†ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ä½•æ„é€ ä¸€ä¸ªUserå¯¹è±¡ï¼‰ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›UserControlleræ›´ä¸ºçº¯ç²¹ï¼Œä¸“æ³¨ä¾èµ–ç®¡ç†ï¼›</p>\n</li>\n<li>\n<p>User classå’ŒRestaurantæ•°æ®ä¹Ÿå­˜åœ¨è€¦åˆï¼Œé€šè¿‡User&nbsp;Classçš„ChangeEmailå‡½æ•°è¿”å›äº†Restaurantçš„newNumofRestaurantï¼Œè¿™å’ŒUserçš„è¡Œä¸ºæ¨¡å‹æ¯«æ— å…³ç³»ã€‚</p>\n</li>\n</ol><p>å¥½ï¼Œæ’¸èµ·è¢–å­åŠ æ²¹å¹²ï¼Œæˆ‘ä»¬æ¥å®Œæˆç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä¸€æ¬¡æ€§è§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p><h2>ç‰ˆæœ¬V3</h2><p>é¦–å…ˆï¼Œä½¿ç”¨UserFactoryæ¨¡å¼å°è£…Userå®ä¾‹åŒ–é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class UserFactory\n{\n    public static User Create(object[] data)\n    {\n        Precondition.Requires(data.Length &gt;= 3);\n        int id = (int)data[0];\n        string email = (string)data[1];\n        UserType type = (UserType)data[2];\n\n        return new User(id, email, type);\n    }\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°UserFactoryä¹Ÿæ˜¯å¯ä»¥ç®€å•æµ‹è¯•çš„âœŒï¸ï¼è¿™æ˜¯é˜¶æ®µæ€§èƒœåˆ©ï¼Œå¯å–œå¯è´ºã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å¸¸è§ä¸€ä¸ªRestaurant Classç”¨æ¥å°è£…å…³äºRestaurantçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class Restaurant\n{\n    public string DomainName { get; private set; }\n    public int NumberOfRestaurant { get; private set; }\n\n    public void ChangeNumberOfRestaurants(int delta)\n    {\n        Precondition.Requires(NumberOfRestaurants + delta &gt;= 0);\n        NumberOfRestaurants += delta;\n    }\n    public bool IsEmailCorporate(string email)\n    {\n        string emailDomain = email.Split('@')[1];\n        return emailDomain == DomainName;\n    }\n}\n</code></pre><p>Restaurant Classä¹Ÿæ˜¯å¯ä»¥ç®€å•æµ‹è¯•çš„ï¼</p><p>å‚è€ƒUserFactoryçš„æ€è·¯ï¼Œå†åšä¸€ä¸ªRestaurantFactoryï¼Œä¸“é—¨åšRestaurantå¯¹è±¡çš„æ„å»ºï¼Œæ­¤å¤„çœç•¥ä»£ç ï¼Œå®ç°èµ·æ¥å…¶å®å¹¶ä¸å¤æ‚ï¼Œæœ‰å…´è¶£ä½ å¯ä»¥è‡ªå·±å†™å†™çœ‹ã€‚</p><p>è€ŒUserControlleræ›´å…³æ³¨ä¸å¤–éƒ¨ä¾èµ–çš„ç®¡ç†å’Œäº¤äº’ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class UserController\n{\n    private readonly Database _database = new Database();\n    private readonly MessageBus _messageBus = new MessageBus();\n\n    public void ChangeEmail(int userId, string newEmail)\n    {\n        object[] userData = _database.GetUserById(userId);\n        User user = UserFactory.Create(userData);\n\n        object[] restaurantData = _database.GetRestaurant();\n        Restaurant restaurant = RestaurantFactory.Create(restaurantData);\n        user.ChangeEmail(newEmail, restaurant);\n        \n        _database.SaveUser(user);\n        //å¦‚æœrestaurantæ•°é‡æœ‰å˜åŒ–ï¼Œå°±å†™æ•°æ®åº“ï¼Œå‘é€é€šçŸ¥ä¿¡æ¯\n        if(restaurant.numberChanged()){\n          _database.SaveRestaurant(restaurant);\n          _messageBus.SendEmailChangedMessage(userId, newEmail);\n         }\n    }\n}\n</code></pre><p>UserController Classé‡Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œåªæœ‰Databaseå’ŒMessageBusçš„ç®¡ç†å’Œæ“ä½œã€‚åœ¨å•å…ƒæµ‹è¯•æ—¶ï¼Œåªéœ€è¦ç”¨Mockæ›¿ä»£ï¼Œå°±OKäº†ï¼UserControlleræ˜¯å¯ä»¥è½»æ¾Mockæµ‹è¯•çš„ï¼</p><p>ç»è¿‡å‰é¢çš„æ“ä½œï¼ŒUser Classå˜åŒ–å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class User\n{\n    public int UserId { get; private set; }\n    public string Email { get; private set; }\n    public UserType Type { get; private set; }\n\n    public void ChangeEmail(string newEmail, Restaurant restaurant)\n    {\n        if (Email == newEmail)\n            return;\n\n        UserType newType = company.IsEmailCorporate(newEmail)\n            ? UserType.Employee\n            : UserType.Customer;\n\n        if (Type != newType)\n        {\n            int delta = newType == UserType.Employee ? 1 : -1;\n            restaurant.ChangeNumberOfRestaurants(delta);\n        }\n    }\n}\n</code></pre><p>Oh Yeah, User Classæ˜¯å¯ä»¥ç®€å•æµ‹è¯•çš„ï¼</p><p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹V3ç‰ˆæœ¬ä»£ç åœ¨å¤æ‚åº¦å››è±¡é™çš„ä½ç½®ï¼Œå˜æˆäº†è¿™æ ·ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8e/9b/8e678e078dd95b5ae0e2aa95f2ede29b.jpg?wh=1920x1521\" alt=\"å›¾ç‰‡\"></p><p>ç»è¿‡3ä¸ªç‰ˆæœ¬åï¼Œæˆ‘ä»¬æŠŠä»£ç é‡æ„å®Œï¼Œå¤æ‚ä»£ç å®Œå…¨è¢«æ¶ˆè§£æ‰äº†ï¼Œåˆ†è§£åˆ°äº†å…¶ä»–3ä¸ªè±¡é™ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºä¸åŒè±¡é™çš„ä»£ç ï¼Œåˆ¶å®šå¥½å•å…ƒæµ‹è¯•ç­–ç•¥å’Œä¼˜å…ˆçº§äº†ã€‚æˆ‘ç‰¹æ„å‡†å¤‡äº†ä¸€å¼ æ€»ç»“è¡¨æ”¾åœ¨äº†åé¢ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8e/4e/8e17702d4ab6f9af4555cbc88837634e.jpg?wh=1920x889\" alt=\"å›¾ç‰‡\"></p><p>æœ‰äº†è¿™å¼ è¡¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<a href=\"https://time.geekbang.org/column/article/505695\">ä¸Šä¸€è®²</a>æåˆ°çš„æµ‹è¯•æ–¹æ³•æ¥åšä¸šåŠ¡é€»è¾‘æµ‹è¯•å’ŒMockæµ‹è¯•äº†ï¼</p><h2>å°ç»“</h2><p>å‘ç€æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„ç›®æ ‡ï¼Œå¤æ‚ä»£ç ç»è¿‡ä¸€æ­¥æ­¥çš„é‡æ„ï¼Œè¢«åˆ†è§£åˆ°äº†ä¾èµ–ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘ä¸¤ä¸ªé¢†åŸŸï¼Œå¦‚æœä¹Ÿç®—ä¸Šæ•°æ®åº“ä»£ç çš„è¯ï¼Œæ­£å¥½å’Œè½¯ä»¶æ¶æ„çš„MVCæ¨¡å¼ä¸€è‡´ã€‚è¿™ä¸æ˜¯å‡‘å·§ï¼Œè¿™æ°æ°è¯´æ˜å¥½çš„ä»£ç ç»“æ„ç­‰åŒäºå•å…ƒæµ‹è¯•é«˜è¦†ç›–ç‡ã€‚å¦‚æœä½ çš„é¡¹ç›®ï¼Œå•å…ƒæµ‹è¯•åšä¸ä¸‹å»ï¼Œæµ‹è¯•è¦†ç›–ç‡æä¸ä¸Šæ¥ï¼Œé‚£åº”è¯¥é‡æ„ä»£ç äº†ã€‚</p><p>åä¹‹ä¹Ÿä¸€æ ·ï¼Œå¦‚æœå¼€å‘äººå‘˜å£°ç§°åšäº†éå¸¸å¥½çš„è®¾è®¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡å•å…ƒæµ‹è¯•ï¼Œå°±åº”è¯¥èƒ½ç›´è§‚æ„Ÿå—åˆ°è¿™ä¸ªå¥½çš„è®¾è®¡ã€‚æœŸå¾…ä»Šå¤©è¿™è®²å†…å®¹æˆä¸ºä½ å¼€å¯å¼€å‘é¢†åŸŸå¤§é—¨çš„ä¸€æŠŠé’¥åŒ™ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/35/6b/35ddf28fc9c17585e7ef43c40f574f6b.jpg?wh=1920x999\" alt=\"å›¾ç‰‡\"></p><p>å¦å¤–ï¼Œç»“åˆä»Šå¤©çš„ä¸‰ä¸ªç‰ˆæœ¬çš„ä»£ç ä¾‹å­ï¼Œä½ ä¹Ÿåº”è¯¥å‘ç°äº†ï¼Œå•å…ƒæµ‹è¯•å¹¶ä¸æ˜¯çœ‰æ¯›èƒ¡å­ä¸€æŠŠæŠ“ã€‚</p><p>é¦–å…ˆï¼Œä½ åº”è¯¥å…³æ³¨ä¸šåŠ¡é€»è¾‘èƒ½å¦åœ¨å•å…ƒæµ‹è¯•é‡Œå……åˆ†æµ‹è¯•ï¼Œè¿™æ˜¯è·Ÿæˆ‘ä»¬è‡ªåŠ¨åŒ–æµ‹è¯•é«˜åº¦å…³è”çš„åœ°æ–¹ã€‚è€ŒMockçš„ç›®æ ‡ï¼Œåˆ™æ˜¯è¾…åŠ©ä¸šåŠ¡é€»è¾‘èƒ½å¤Ÿæ›´æ—©æ›´å¿«åœ°æµ‹è¯•ã€‚ä»¥åï¼Œå½“å¼€å‘äººå‘˜éª„å‚²åœ°è·Ÿä½ è¯´ï¼šâ€œä»£ç è¡Œè¦†ç›–ç‡è¾¾åˆ°80%â€çš„æ—¶å€™ï¼Œä½ åº”è¯¥å’Œä»–ä¸€èµ·æ£€æŸ¥ä¸‹ï¼Œä»–åˆ°åº•æµ‹äº†ä»€ä¹ˆã€‚</p><p>å•å…ƒæµ‹è¯•çœ‹èµ·æ¥å·²ç»æ˜¯ä¸ªå®Œç¾çš„æµ‹è¯•æ–¹æ¡ˆäº†ï¼Œé‚£åœ¨å•å…ƒæµ‹è¯•å±‚é¢è¿˜æœ‰ä»€ä¹ˆåšä¸åˆ°çš„äº‹ä¹ˆï¼Œä¸‹ä¸€è®²æˆ‘ä»¬å°±æ¥æ­æ™“ç­”æ¡ˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åˆ¶å®šå•å…ƒæµ‹è¯•è¦†ç›–ç‡100%çš„ç›®æ ‡æœ‰ä»·å€¼ä¹ˆï¼Ÿå¦‚æœè®©ä½ åˆ¶å®šç›®æ ‡ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµäº’åŠ¨ï¼Œä¹Ÿæ¨èä½ æŠŠè¿™è®²å†…å®¹åˆ†äº«ç»™æ›´å¤šåŒäº‹ã€æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"10ï½œå•å…ƒæµ‹è¯•ï¼ˆä¸€ï¼‰ï¼šåŸæ¥æµ‹è¯•å¯ä»¥è¿™ä¹ˆé«˜æ•ˆ","id":505695},"right":{"article_title":"12ï½œé›†æˆæµ‹è¯•ï¼ˆä¸€ï¼‰ï¼šä¸€æ¡Happy Pathæ‰«å¤©ä¸‹","id":507443}},"comments":[{"had_liked":false,"id":341962,"user_name":"lisa","can_delete":false,"product_type":"c1","uid":1508049,"ip_address":"","ucode":"62CB6333CBF7B6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLw3jpao45frZibQIAicWBfc7ofgrm5gJLiaFQSj5u2DDvkjy3ia5goicJLJlgVtZ0HryiaXb2VqpTSQT5Q/132","comment_is_top":false,"comment_ctime":1649932594,"is_pvip":false,"replies":[{"id":"125251","content":"éå¸¸åˆ°ä½ï¼åœ¨åº¦é‡æ¨¡å—é‡Œï¼Œæˆ‘ä»¬ä¹Ÿä¼šæåˆ°ï¼Œå¦‚æœç”¨å•ä¸€çš„ç»´åº¦æ¥åº¦é‡å·¥ä½œçš„è¯ï¼Œä¼šè¯±å¯¼å·¥ä½œæœºæ¢°åŒ–ï¼Œç”šè‡³å¼„è™šä½œå‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1877634","ctime":1650546836,"ip_address":"","comment_id":341962,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23124769074","product_id":100109201,"comment_content":"è¾©è¯æ¥çœ‹ï¼Œå•å…ƒæµ‹è¯•çš„è¡Œè¦†ç›–ç‡æ˜¯æœ‰ä»·å€¼çš„ï¼Œä½†æ˜¯åˆ¶å®š100%çš„è¦†ç›–ç‡æ˜¯ä¸€ç§é”™è¯¯çš„ç®¡ç†æ‰‹æ®µã€‚æµ‹è¯•çš„æœ¬è´¨æ˜¯å‘ç°é—®é¢˜ï¼Œé˜²æ­¢é—®é¢˜å¤–æ¼ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å•å…ƒæµ‹è¯•è¿˜æ˜¯å…¶ä»–æµ‹è¯•ï¼Œéƒ½æ˜¯ä»ä»£ç çš„é£é™©å‡ºå‘æ¥è®¾è®¡ç”¨ä¾‹ï¼Œè€Œä¸æ˜¯ä»è¡Œè¦†ç›–çš„è§’åº¦å‡ºå‘ã€‚","like_count":6,"discussions":[{"author":{"id":1877634,"avatar":"","nickname":"sunshinelius","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565814,"discussion_content":"éå¸¸åˆ°ä½ï¼åœ¨åº¦é‡æ¨¡å—é‡Œï¼Œæˆ‘ä»¬ä¹Ÿä¼šæåˆ°ï¼Œå¦‚æœç”¨å•ä¸€çš„ç»´åº¦æ¥åº¦é‡å·¥ä½œçš„è¯ï¼Œä¼šè¯±å¯¼å·¥ä½œæœºæ¢°åŒ–ï¼Œç”šè‡³å¼„è™šä½œå‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650546836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352968,"user_name":"ç¾Šç¾Š","can_delete":false,"product_type":"c1","uid":1162597,"ip_address":"æ—¥æœ¬","ucode":"B220CE8D1CA5DA","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/65/fbdf4fc1.jpg","comment_is_top":false,"comment_ctime":1659058673,"is_pvip":false,"replies":[{"id":"128647","content":"æœ‰æ‚Ÿæ€§ï¼Œè°¢è°¢åˆ†äº«ï¼æˆ‘åˆæ¸©ä¹ äº†ä¸€ä¸‹è¿ªç±³ç‰¹æ³•åˆ™ï¼Œå¤§é“è‡³ç®€ï¼Œæ®Šé€”åŒå½’ã€‚ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1877634","ctime":1659877941,"ip_address":"æ—¥æœ¬","comment_id":352968,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659058673","product_id":100109201,"comment_content":"ä»¥å‰å­¦ä¹ è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¸­æœ‰ä¸€æ¡æ³•åˆ™ï¼šè¿ªç±³ç‰¹æ³•åˆ™ï¼Œä¹Ÿå«åšâ€œä¸å’Œé™Œç”Ÿäººè¯´è¯â€ã€‚ä¸€ç›´éƒ½ä¸çŸ¥é“è¿™æ¡æ³•åˆ™åˆ°åº•å¦‚ä½•åº”ç”¨ï¼Œç›®çš„æ˜¯ä»€ä¹ˆã€‚çœ‹åˆ°è€å¸ˆçš„ä»£ç å¯æµ‹æ€§æ”¹é€ ï¼Œæ‰æ˜ç™½ï¼Œç¬¦åˆäº†è¿ªç±³ç‰¹æ³•åˆ™çš„ä»£ç ï¼Œå¯ä»¥æ˜¾å¼å¤–éƒ¨ä¾èµ–é¡¹ï¼Œæ–¹ä¾¿æµ‹è¯•æ—¶ Moke å¤–éƒ¨ä¾èµ–ã€‚","like_count":1,"discussions":[{"author":{"id":1877634,"avatar":"","nickname":"sunshinelius","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583026,"discussion_content":"æœ‰æ‚Ÿæ€§ï¼Œè°¢è°¢åˆ†äº«ï¼æˆ‘åˆæ¸©ä¹ äº†ä¸€ä¸‹è¿ªç±³ç‰¹æ³•åˆ™ï¼Œå¤§é“è‡³ç®€ï¼Œæ®Šé€”åŒå½’ã€‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659877941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352732,"user_name":"Rachel","can_delete":false,"product_type":"c1","uid":1165799,"ip_address":"æ—¥æœ¬","ucode":"B413D50328A268","user_header":"https://static001.geekbang.org/account/avatar/00/11/c9/e7/25f01030.jpg","comment_is_top":false,"comment_ctime":1658902793,"is_pvip":false,"replies":[{"id":"128646","content":"æ‰€ä»¥è¯´ï¼Œå¦‚æœæµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†å‘ç°bugï¼Œä¼šå‘ç°è¿™æ˜¯ä¸ªæ— é—´ç—›è‹¦ï¼Œå„ç§å„æ ·çš„bugå±‚å‡ºä¸ç©·ã€‚ä½†æ˜¯ï¼Œå¦‚æœæµ‹è¯•èƒ½å¤Ÿæ¨åŠ¨å¼€å‘æ”¹å–„ï¼Œè¿™å°±ä¼šè¿›å…¥åˆ°ä¸€ä¸ªç§¯æçš„å¾ªç¯ä¸­å»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1877634","ctime":1659877716,"ip_address":"æ—¥æœ¬","comment_id":352732,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1658902793","product_id":100109201,"comment_content":"æ„Ÿè§‰è¿™èŠ‚ä¸»è¦åˆ†æäº†å¼€å‘çš„é€»è¾‘ã€‚ã€‚ã€‚å®é™…ä¸Šå¦‚æœå¼€å‘æ²¡é‚£ä¹ˆå¤šï¼Œè¿˜æ˜¯å¾ˆå¤šé—®é¢˜","like_count":0,"discussions":[{"author":{"id":1877634,"avatar":"","nickname":"sunshinelius","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583025,"discussion_content":"æ‰€ä»¥è¯´ï¼Œå¦‚æœæµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†å‘ç°bugï¼Œä¼šå‘ç°è¿™æ˜¯ä¸ªæ— é—´ç—›è‹¦ï¼Œå„ç§å„æ ·çš„bugå±‚å‡ºä¸ç©·ã€‚ä½†æ˜¯ï¼Œå¦‚æœæµ‹è¯•èƒ½å¤Ÿæ¨åŠ¨å¼€å‘æ”¹å–„ï¼Œè¿™å°±ä¼šè¿›å…¥åˆ°ä¸€ä¸ªç§¯æçš„å¾ªç¯ä¸­å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659877717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345666,"user_name":"swordman","can_delete":false,"product_type":"c1","uid":1002980,"ip_address":"","ucode":"F6719BD5E20B37","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/e4/94b543c3.jpg","comment_is_top":false,"comment_ctime":1652497101,"is_pvip":false,"replies":[{"id":"126310","content":"è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼ä½ å·²ç»å¼€å§‹è€ƒè™‘æ€ä¹ˆåº¦é‡â€œå¥½çš„ä»£ç ç»“æ„â€äº†ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1877634","ctime":1652882695,"ip_address":"","comment_id":345666,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652497101","product_id":100109201,"comment_content":"å¦‚æœä¸€å®šè¦å®šä¸€ä¸ªè¦†ç›–ç‡ç›®æ ‡ï¼Œé¢†åŸŸä»£ç è¿™éƒ¨åˆ†çš„è¦†ç›–ç‡ï¼Œä¼šæ›´æœ‰ä»·å€¼ã€‚è¿™åˆå¼•å‡ºä¸€ä¸ªæ–°é—®é¢˜ï¼Œå¦‚ä½•åˆ¤æ–­è®¾è®¡æ—¶åšäº†é¢†åŸŸä»£ç å’Œä¾èµ–ä»£ç çš„æ‹†åˆ†ã€‚é™¤äº†å’Œå¼€å‘äººå‘˜ä¸€èµ·æ£€æŸ¥ä»¥å¤–ï¼Œæˆ‘è§‰å¾—å¯ä»¥åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨Mockå‡½æ•°çš„è‡ªåŠ¨æ‰«æï¼šå¦‚æœåšäº†æ‹†åˆ†ï¼Œé¢†åŸŸä»£ç éƒ¨åˆ†çš„ç”¨ä¾‹ï¼Œæ˜¯æ— éœ€åšMockçš„ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹é«˜é¢‘çš„ä½¿ç”¨Mockå‡½æ•°ï¼Œè¯´æ˜äº§å“ä»£ç æœ¬èº«ï¼Œå¹¶æ²¡æœ‰æŠŠå¤æ‚ä»£ç åˆ†è§£å¹²å‡€ã€‚ï¼ˆè¿™æ˜¯æˆ‘ä¸ªäººçš„ç†è§£ï¼Œæ³è¯·è€å¸ˆæŒ‡æ­£ï¼‰","like_count":0,"discussions":[{"author":{"id":1877634,"avatar":"","nickname":"sunshinelius","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572650,"discussion_content":"è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼ä½ å·²ç»å¼€å§‹è€ƒè™‘æ€ä¹ˆåº¦é‡â€œå¥½çš„ä»£ç ç»“æ„â€äº†ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652882695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342245,"user_name":"å¤ªåŒ†åŒ†","can_delete":false,"product_type":"c1","uid":1628299,"ip_address":"","ucode":"2F3F273CB65F5D","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/8b/d81769bf.jpg","comment_is_top":false,"comment_ctime":1650124452,"is_pvip":false,"replies":[{"id":"125261","content":"å¾ˆåˆ°ä½ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1877634","ctime":1650547624,"ip_address":"","comment_id":342245,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650124452","product_id":100109201,"comment_content":"å•çº¯è¿½æ±‚è¦†ç›–ç‡æ²¡æœ‰æ„ä¹‰ï¼Œè¿½æ±‚å…³é”®ä»£ç è¦†ç›–åˆ°å°±å¯ä»¥äº†ã€‚é¢†åŸŸä»£ç åº”è¯¥å°±æ˜¯è¿™éƒ¨åˆ†å…³é”®ä»£ç äº†","like_count":0,"discussions":[{"author":{"id":1877634,"avatar":"","nickname":"sunshinelius","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565829,"discussion_content":"å¾ˆåˆ°ä½ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650547625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}