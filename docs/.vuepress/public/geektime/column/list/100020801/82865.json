{"id":82865,"title":"44 | ç­”ç–‘æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šè¯´ä¸€è¯´è¿™äº›å¥½é—®é¢˜","content":"<p>è¿™æ˜¯æˆ‘ä»¬ä¸“æ çš„æœ€åä¸€ç¯‡ç­”ç–‘æ–‡ç« ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¯´è¯´ä¸€äº›å¥½é—®é¢˜ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œèƒ½å¤Ÿå¸®æˆ‘ä»¬æ‰©å±•ä¸€ä¸ªé€»è¾‘çš„è¾¹ç•Œçš„é—®é¢˜ï¼Œå°±æ˜¯å¥½é—®é¢˜ã€‚å› ä¸ºé€šè¿‡è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œèƒ½å¤ŸåŠ æ·±æˆ‘ä»¬å¯¹è¿™ä¸ªé€»è¾‘çš„ç†è§£ï¼Œæˆ–è€…å¸®æˆ‘ä»¬å…³è”åˆ°å¦å¤–ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¿›è€Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å»ºç«‹èµ·è‡ªå·±çš„çŸ¥è¯†ç½‘ç»œã€‚</p><p>åœ¨å·¥ä½œä¸­ä¼šé—®å¥½é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„èƒ½åŠ›ã€‚</p><p>ç»è¿‡è¿™æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œä»è¯„è®ºåŒºçš„é—®é¢˜æˆ‘å¯ä»¥æ„Ÿè§‰å‡ºæ¥ï¼Œç´§è·Ÿè¯¾ç¨‹å­¦ä¹ çš„åŒå­¦ï¼Œå¯¹SQLè¯­å¥æ‰§è¡Œæ€§èƒ½çš„æ„Ÿè§‰è¶Šæ¥è¶Šå¥½äº†ï¼Œæå‡ºçš„é—®é¢˜ä¹Ÿè¶Šæ¥è¶Šç»†è‡´å’Œç²¾å‡†äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·çœ‹çœ‹åŒå­¦ä»¬åœ¨è¯„è®ºåŒºæåˆ°çš„è¿™äº›å¥½é—®é¢˜ã€‚åœ¨å’Œä½ ä¸€èµ·åˆ†æè¿™äº›é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä¼šæŒ‡å‡ºå®ƒä»¬å…·ä½“æ˜¯åœ¨å“ªç¯‡æ–‡ç« å‡ºç°çš„ã€‚åŒæ—¶ï¼Œåœ¨å›ç­”è¿™äº›é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå‡è®¾ä½ å·²ç»æŒæ¡äº†è¿™ç¯‡æ–‡ç« æ¶‰åŠçš„çŸ¥è¯†ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å°è±¡æ¨¡ç³Šäº†ï¼Œä¹Ÿå¯ä»¥è·³å›æ–‡ç« å†å¤ä¹ ä¸€æ¬¡ã€‚</p><h1>joinçš„å†™æ³•</h1><p>åœ¨ç¬¬35ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/80147\">ã€Šjoinè¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘åœ¨ä»‹ç»joinæ‰§è¡Œé¡ºåºçš„æ—¶å€™ï¼Œç”¨çš„éƒ½æ˜¯straight_joinã€‚@éƒ­å¥ åŒå­¦åœ¨æ–‡åæå‡ºäº†ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol>\n<li>\n<p>å¦‚æœç”¨left joinçš„è¯ï¼Œå·¦è¾¹çš„è¡¨ä¸€å®šæ˜¯é©±åŠ¨è¡¨å—ï¼Ÿ</p>\n</li>\n<li>\n<p>å¦‚æœä¸¤ä¸ªè¡¨çš„joinåŒ…å«å¤šä¸ªæ¡ä»¶çš„ç­‰å€¼åŒ¹é…ï¼Œæ˜¯éƒ½è¦å†™åˆ°oné‡Œé¢å‘¢ï¼Œè¿˜æ˜¯åªæŠŠä¸€ä¸ªæ¡ä»¶å†™åˆ°oné‡Œé¢ï¼Œå…¶ä»–æ¡ä»¶å†™åˆ°whereéƒ¨åˆ†ï¼Ÿ</p>\n</li>\n</ol><p>ä¸ºäº†åŒæ—¶å›ç­”è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘æ¥æ„é€ ä¸¤ä¸ªè¡¨aå’Œbï¼š</p><!-- [[[read_end]]] --><pre><code>create table a(f1 int, f2 int, index(f1))engine=innodb;\ncreate table b(f1 int, f2 int)engine=innodb;\ninsert into a values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6);\ninsert into b values(3,3),(4,4),(5,5),(6,6),(7,7),(8,8);\n</code></pre><p>è¡¨aå’Œbéƒ½æœ‰ä¸¤ä¸ªå­—æ®µf1å’Œf2ï¼Œä¸åŒçš„æ˜¯è¡¨açš„å­—æ®µf1ä¸Šæœ‰ç´¢å¼•ã€‚ç„¶åï¼Œæˆ‘å¾€ä¸¤ä¸ªè¡¨ä¸­éƒ½æ’å…¥äº†6æ¡è®°å½•ï¼Œå…¶ä¸­åœ¨è¡¨aå’Œbä¸­åŒæ—¶å­˜åœ¨çš„æ•°æ®æœ‰4è¡Œã€‚</p><p>@éƒ­å¥ åŒå­¦æåˆ°çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå…¶å®å°±æ˜¯ä¸‹é¢è¿™ä¸¤ç§å†™æ³•çš„åŒºåˆ«ï¼š</p><pre><code>select * from a left join b on(a.f1=b.f1) and (a.f2=b.f2); /*Q1*/\nselect * from a left join b on(a.f1=b.f1) where (a.f2=b.f2);/*Q2*/\n</code></pre><p>æˆ‘æŠŠè¿™ä¸¤æ¡è¯­å¥åˆ†åˆ«è®°ä¸ºQ1å’ŒQ2ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªleft joinè¯­å¥çš„è¯­ä¹‰é€»è¾‘å¹¶ä¸ç›¸åŒã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒä»¬çš„æ‰§è¡Œç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/87/bd/871f890532349781fdc4a4287e9f91bd.png?wh=1636*1090\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ä¸¤ä¸ªjoinçš„æŸ¥è¯¢ç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul>\n<li>è¯­å¥Q1è¿”å›çš„æ•°æ®é›†æ˜¯6è¡Œï¼Œè¡¨aä¸­å³ä½¿æ²¡æœ‰æ»¡è¶³åŒ¹é…æ¡ä»¶çš„è®°å½•ï¼ŒæŸ¥è¯¢ç»“æœä¸­ä¹Ÿä¼šè¿”å›ä¸€è¡Œï¼Œå¹¶å°†è¡¨bçš„å„ä¸ªå­—æ®µå€¼å¡«æˆNULLã€‚</li>\n<li>è¯­å¥Q2è¿”å›çš„æ˜¯4è¡Œã€‚ä»é€»è¾‘ä¸Šå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæœ€åçš„ä¸¤è¡Œï¼Œç”±äºè¡¨bä¸­æ²¡æœ‰åŒ¹é…çš„å­—æ®µï¼Œç»“æœé›†é‡Œé¢b.f2çš„å€¼æ˜¯ç©ºï¼Œä¸æ»¡è¶³where éƒ¨åˆ†çš„æ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤ä¸èƒ½ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å®é™…æ‰§è¡Œè¿™ä¸¤æ¡è¯­å¥æ—¶ï¼ŒMySQLæ˜¯æ€ä¹ˆåšçš„ã€‚</p><p>æˆ‘ä»¬å…ˆä¸€èµ·çœ‹çœ‹è¯­å¥Q1çš„explainç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/17/b7f27917ceb0be90ef7b201f2794c817.png?wh=3202*298\" alt=\"\"></p><center><span class=\"reference\">å›¾2 Q1çš„explainç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼š</p><ul>\n<li>é©±åŠ¨è¡¨æ˜¯è¡¨aï¼Œè¢«é©±åŠ¨è¡¨æ˜¯è¡¨bï¼›</li>\n<li>ç”±äºè¡¨bçš„f1å­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯Block Nested Loop Joinï¼ˆç®€ç§°BNLï¼‰ ç®—æ³•ã€‚</li>\n</ul><p>çœ‹åˆ°BNLç®—æ³•ï¼Œä½ å°±åº”è¯¥çŸ¥é“è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹å…¶å®æ˜¯è¿™æ ·çš„ï¼š</p><ol>\n<li>\n<p>æŠŠè¡¨açš„å†…å®¹è¯»å…¥join_buffer ä¸­ã€‚å› ä¸ºæ˜¯select * ï¼Œæ‰€ä»¥å­—æ®µf1å’Œf2éƒ½è¢«æ”¾å…¥join_bufferäº†ã€‚</p>\n</li>\n<li>\n<p>é¡ºåºæ‰«æè¡¨bï¼Œå¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œåˆ¤æ–­joinæ¡ä»¶ï¼ˆä¹Ÿå°±æ˜¯(a.f1=b.f1) and (a.f1=1)ï¼‰æ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³æ¡ä»¶çš„è®°å½•, ä½œä¸ºç»“æœé›†çš„ä¸€è¡Œè¿”å›ã€‚å¦‚æœè¯­å¥ä¸­æœ‰whereå­å¥ï¼Œéœ€è¦å…ˆåˆ¤æ–­whereéƒ¨åˆ†æ»¡è¶³æ¡ä»¶åï¼Œå†è¿”å›ã€‚</p>\n</li>\n<li>\n<p>è¡¨bæ‰«æå®Œæˆåï¼Œå¯¹äºæ²¡æœ‰è¢«åŒ¹é…çš„è¡¨açš„è¡Œï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯(1,1)ã€(2,2)è¿™ä¸¤è¡Œï¼‰ï¼ŒæŠŠå‰©ä½™å­—æ®µè¡¥ä¸ŠNULLï¼Œå†æ”¾å…¥ç»“æœé›†ä¸­ã€‚</p>\n</li>\n</ol><p>å¯¹åº”çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/d7/8fd4b4b179fb84caaecece84b6406ad7.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾3 left join -BNLç®—æ³•</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡è¯­å¥ç¡®å®æ˜¯ä»¥è¡¨aä¸ºé©±åŠ¨è¡¨ï¼Œè€Œä¸”ä»æ‰§è¡Œæ•ˆæœçœ‹ï¼Œä¹Ÿå’Œä½¿ç”¨straight_joinæ˜¯ä¸€æ ·çš„ã€‚</p><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¯­å¥Q2çš„æŸ¥è¯¢ç»“æœé‡Œé¢å°‘äº†æœ€åä¸¤è¡Œæ•°æ®ï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯æŠŠä¸Šé¢æµç¨‹ä¸­çš„æ­¥éª¤3å»æ‰å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹è¯­å¥Q2çš„expainç»“æœå§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/9c/f5712c56dc84d331990409a5c313ea9c.png?wh=2798*396\" alt=\"\"></p><center><span class=\"reference\">å›¾4 Q2çš„explainç»“æœ</span></center><p>è¿™é‡Œå…ˆå’Œä½ è¯´ä¸€å¥é¢˜å¤–è¯ï¼Œä¸“æ é©¬ä¸Šå°±ç»“æŸäº†ï¼Œæˆ‘ä¹Ÿå’Œä½ ä¸€èµ·æ ¹æ®explainç»“æœâ€œè„‘è¡¥â€äº†å¾ˆå¤šæ¬¡ä¸€æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹äº†ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›ä½ å·²ç»å…·å¤‡äº†è¿™ä¸ªèƒ½åŠ›ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å†ä¸€èµ·åˆ†æä¸€æ¬¡SQLè¯­å¥çš„explainç»“æœã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡è¯­å¥æ˜¯ä»¥è¡¨bä¸ºé©±åŠ¨è¡¨çš„ã€‚è€Œå¦‚æœä¸€æ¡joinè¯­å¥çš„Extraå­—æ®µä»€ä¹ˆéƒ½æ²¡å†™çš„è¯ï¼Œå°±è¡¨ç¤ºä½¿ç”¨çš„æ˜¯Index Nested-Loop Joinï¼ˆç®€ç§°NLJï¼‰ç®—æ³•ã€‚</p><p>å› æ­¤ï¼Œè¯­å¥Q2çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šé¡ºåºæ‰«æè¡¨bï¼Œæ¯ä¸€è¡Œç”¨b.f1åˆ°è¡¨aä¸­å»æŸ¥ï¼ŒåŒ¹é…åˆ°è®°å½•ååˆ¤æ–­a.f2=b.f2æ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³æ¡ä»¶çš„è¯å°±ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>ä¸ºä»€ä¹ˆè¯­å¥Q1å’ŒQ2è¿™ä¸¤ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œæµç¨‹ä¼šå·®è·è¿™ä¹ˆå¤§å‘¢ï¼Ÿ</strong>å…¶å®ï¼Œè¿™æ˜¯å› ä¸ºä¼˜åŒ–å™¨åŸºäºQ2è¿™ä¸ªæŸ¥è¯¢çš„è¯­ä¹‰åšäº†ä¼˜åŒ–ã€‚</p><p>ä¸ºäº†ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦å†å’Œä½ äº¤ä»£ä¸€ä¸ªèƒŒæ™¯çŸ¥è¯†ç‚¹ï¼šåœ¨MySQLé‡Œï¼ŒNULLè·Ÿä»»ä½•å€¼æ‰§è¡Œç­‰å€¼åˆ¤æ–­å’Œä¸ç­‰å€¼åˆ¤æ–­çš„ç»“æœï¼Œéƒ½æ˜¯NULLã€‚è¿™é‡ŒåŒ…æ‹¬ï¼Œ select NULL = NULL çš„ç»“æœï¼Œä¹Ÿæ˜¯è¿”å›NULLã€‚</p><p>å› æ­¤ï¼Œè¯­å¥Q2é‡Œé¢where a.f2=b.f2å°±è¡¨ç¤ºï¼ŒæŸ¥è¯¢ç»“æœé‡Œé¢ä¸ä¼šåŒ…å«b.f2æ˜¯NULLçš„è¡Œï¼Œè¿™æ ·è¿™ä¸ªleft joinçš„è¯­ä¹‰å°±æ˜¯â€œæ‰¾åˆ°è¿™ä¸¤ä¸ªè¡¨é‡Œé¢ï¼Œf1ã€f2å¯¹åº”ç›¸åŒçš„è¡Œã€‚å¯¹äºè¡¨aä¸­å­˜åœ¨ï¼Œè€Œè¡¨bä¸­åŒ¹é…ä¸åˆ°çš„è¡Œï¼Œå°±æ”¾å¼ƒâ€ã€‚</p><p>è¿™æ ·ï¼Œè¿™æ¡è¯­å¥è™½ç„¶ç”¨çš„æ˜¯left joinï¼Œä½†æ˜¯è¯­ä¹‰è·Ÿjoinæ˜¯ä¸€è‡´çš„ã€‚</p><p>å› æ­¤ï¼Œä¼˜åŒ–å™¨å°±æŠŠè¿™æ¡è¯­å¥çš„left joinæ”¹å†™æˆäº†joinï¼Œç„¶åå› ä¸ºè¡¨açš„f1ä¸Šæœ‰ç´¢å¼•ï¼Œå°±æŠŠè¡¨bä½œä¸ºé©±åŠ¨è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ä¸ŠNLJ ç®—æ³•ã€‚åœ¨æ‰§è¡Œexplainä¹‹åï¼Œä½ å†æ‰§è¡Œshow warningsï¼Œå°±èƒ½çœ‹åˆ°è¿™ä¸ªæ”¹å†™çš„ç»“æœï¼Œå¦‚å›¾5æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/ab/d74878e7469edb8b713a18c6158530ab.png?wh=3290*506\" alt=\"\"></p><center><span class=\"reference\">å›¾5 Q2çš„æ”¹å†™ç»“æœ</span></center><p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œå³ä½¿æˆ‘ä»¬åœ¨SQLè¯­å¥ä¸­å†™æˆleft joinï¼Œæ‰§è¡Œè¿‡ç¨‹è¿˜æ˜¯æœ‰å¯èƒ½ä¸æ˜¯ä»å·¦åˆ°å³è¿æ¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä½¿ç”¨left joinæ—¶ï¼Œå·¦è¾¹çš„è¡¨ä¸ä¸€å®šæ˜¯é©±åŠ¨è¡¨ã€‚</strong></p><p>è¿™æ ·çœ‹æ¥ï¼Œ<strong>å¦‚æœéœ€è¦left joinçš„è¯­ä¹‰ï¼Œå°±ä¸èƒ½æŠŠè¢«é©±åŠ¨è¡¨çš„å­—æ®µæ”¾åœ¨whereæ¡ä»¶é‡Œé¢åšç­‰å€¼åˆ¤æ–­æˆ–ä¸ç­‰å€¼åˆ¤æ–­ï¼Œå¿…é¡»éƒ½å†™åœ¨oné‡Œé¢ã€‚</strong>é‚£å¦‚æœæ˜¯joinè¯­å¥å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è¿™ä¸¤æ¡è¯­å¥ï¼š</p><pre><code>select * from a join b on(a.f1=b.f1) and (a.f2=b.f2); /*Q3*/\nselect * from a join b on(a.f1=b.f1) where (a.f2=b.f2);/*Q4*/\n</code></pre><p>æˆ‘ä»¬å†ä½¿ç”¨ä¸€æ¬¡çœ‹explain å’Œ show warningsçš„æ–¹æ³•ï¼Œçœ‹çœ‹ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆåšçš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/f5/d9952e4c2150bc649c7f2977e6ea80f5.png?wh=1896*963\" alt=\"\"></p><center><span class=\"reference\">å›¾6 joinè¯­å¥æ”¹å†™</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤æ¡è¯­å¥éƒ½è¢«æ”¹å†™æˆï¼š</p><pre><code>select * from a join b where (a.f1=b.f1) and (a.f2=b.f2);\n</code></pre><p>æ‰§è¡Œè®¡åˆ’è‡ªç„¶ä¹Ÿæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œjoinå°†åˆ¤æ–­æ¡ä»¶æ˜¯å¦å…¨éƒ¨æ”¾åœ¨onéƒ¨åˆ†å°±æ²¡æœ‰åŒºåˆ«äº†ã€‚</p><h1>Simple Nested Loop Join çš„æ€§èƒ½é—®é¢˜</h1><p>æˆ‘ä»¬çŸ¥é“ï¼Œjoinè¯­å¥ä½¿ç”¨ä¸åŒçš„ç®—æ³•ï¼Œå¯¹è¯­å¥çš„æ€§èƒ½å½±å“ä¼šå¾ˆå¤§ã€‚åœ¨ç¬¬34ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/79700\">ã€Šåˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨joinï¼Ÿã€‹</a>çš„è¯„è®ºåŒºä¸­ï¼Œ@ä¹¦ç­–ç¨ æµŠ å’Œ @æœå¤•å¿ƒ ä¸¤ä½åŒå­¦æäº†ä¸€ä¸ªå¾ˆä¸é”™çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åœ¨æ–‡ä¸­è¯´åˆ°ï¼Œè™½ç„¶BNLç®—æ³•å’ŒSimple Nested Loop Join ç®—æ³•éƒ½æ˜¯è¦åˆ¤æ–­M*Næ¬¡ï¼ˆMå’ŒNåˆ†åˆ«æ˜¯joinçš„ä¸¤ä¸ªè¡¨çš„è¡Œæ•°ï¼‰ï¼Œä½†æ˜¯Simple Nested Loop Join ç®—æ³•çš„æ¯è½®åˆ¤æ–­éƒ½è¦èµ°å…¨è¡¨æ‰«æï¼Œå› æ­¤æ€§èƒ½ä¸ŠBNLç®—æ³•æ‰§è¡Œèµ·æ¥ä¼šå¿«å¾ˆå¤šã€‚</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œæˆ‘è¿˜æ˜¯å…ˆä¸ºä½ ç®€å•æè¿°ä¸€ä¸‹è¿™ä¸¤ä¸ªç®—æ³•ã€‚</p><p>BNLç®—æ³•çš„æ‰§è¡Œé€»è¾‘æ˜¯ï¼š</p><ol>\n<li>\n<p>é¦–å…ˆï¼Œå°†é©±åŠ¨è¡¨çš„æ•°æ®å…¨éƒ¨è¯»å…¥å†…å­˜join_bufferä¸­ï¼Œè¿™é‡Œjoin_bufferæ˜¯æ— åºæ•°ç»„ï¼›</p>\n</li>\n<li>\n<p>ç„¶åï¼Œé¡ºåºéå†è¢«é©±åŠ¨è¡¨çš„æ‰€æœ‰è¡Œï¼Œæ¯ä¸€è¡Œæ•°æ®éƒ½è·Ÿjoin_bufferä¸­çš„æ•°æ®è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚</p>\n</li>\n</ol><p>Simple Nested Loop Joinç®—æ³•çš„æ‰§è¡Œé€»è¾‘æ˜¯ï¼šé¡ºåºå–å‡ºé©±åŠ¨è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œåˆ°è¢«é©±åŠ¨è¡¨å»åšå…¨è¡¨æ‰«æåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚</p><p>è¿™ä¸¤ä½åŒå­¦çš„ç–‘é—®æ˜¯ï¼ŒSimple Nested Loop Joinç®—æ³•ï¼Œå…¶å®ä¹Ÿæ˜¯æŠŠæ•°æ®è¯»åˆ°å†…å­˜é‡Œï¼Œç„¶åæŒ‰ç…§åŒ¹é…æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œä¸ºä»€ä¹ˆæ€§èƒ½å·®è·ä¼šè¿™ä¹ˆå¤§å‘¢ï¼Ÿ</p><p>è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°MySQLä¸­ç´¢å¼•ç»“æ„å’ŒBuffer Poolçš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼š</p><ol>\n<li>\n<p>åœ¨å¯¹è¢«é©±åŠ¨è¡¨åšå…¨è¡¨æ‰«æçš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰åœ¨Buffer Poolä¸­ï¼Œå°±éœ€è¦ç­‰å¾…è¿™éƒ¨åˆ†æ•°æ®ä»ç£ç›˜è¯»å…¥ï¼›<br>\nä»ç£ç›˜è¯»å…¥æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œä¼šå½±å“æ­£å¸¸ä¸šåŠ¡çš„Buffer Poolå‘½ä¸­ç‡ï¼Œè€Œä¸”è¿™ä¸ªç®—æ³•å¤©ç„¶ä¼šå¯¹è¢«é©±åŠ¨è¡¨çš„æ•°æ®åšå¤šæ¬¡è®¿é—®ï¼Œæ›´å®¹æ˜“å°†è¿™äº›æ•°æ®é¡µæ”¾åˆ°Buffer Poolçš„å¤´éƒ¨ï¼ˆè¯·å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/80147\">ç¬¬35ç¯‡æ–‡ç« </a>ä¸­çš„ç›¸å…³å†…å®¹)ï¼›</p>\n</li>\n<li>\n<p>å³ä½¿è¢«é©±åŠ¨è¡¨æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ¯æ¬¡æŸ¥æ‰¾â€œä¸‹ä¸€ä¸ªè®°å½•çš„æ“ä½œâ€ï¼Œéƒ½æ˜¯ç±»ä¼¼æŒ‡é’ˆæ“ä½œã€‚è€Œjoin_bufferä¸­æ˜¯æ•°ç»„ï¼Œéå†çš„æˆæœ¬æ›´ä½ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥è¯´ï¼ŒBNLç®—æ³•çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚</p><h1>distinct å’Œ group byçš„æ€§èƒ½</h1><p>åœ¨ç¬¬37ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/80477\">ã€Šä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿã€‹</a>ä¸­ï¼Œ@è€æ¨åŒå¿— æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼šå¦‚æœåªéœ€è¦å»é‡ï¼Œä¸éœ€è¦æ‰§è¡Œèšåˆå‡½æ•°ï¼Œdistinct å’Œgroup byå“ªç§æ•ˆç‡é«˜ä¸€äº›å‘¢ï¼Ÿ</p><p>æˆ‘æ¥å±•å¼€ä¸€ä¸‹ä»–çš„é—®é¢˜ï¼šå¦‚æœè¡¨tçš„å­—æ®µaä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä¸‹é¢è¿™ä¸¤æ¡è¯­å¥ï¼š</p><pre><code>select a from t group by a order by null;\nselect distinct a from t;\n</code></pre><p>çš„æ€§èƒ½æ˜¯ä¸æ˜¯ç›¸åŒçš„?</p><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ç§group byçš„å†™æ³•ï¼Œå¹¶ä¸æ˜¯SQLæ ‡å‡†çš„å†™æ³•ã€‚æ ‡å‡†çš„group byè¯­å¥ï¼Œæ˜¯éœ€è¦åœ¨selectéƒ¨åˆ†åŠ ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><pre><code>select a,count(*) from t group by a order by null;\n</code></pre><p>è¿™æ¡è¯­å¥çš„é€»è¾‘æ˜¯ï¼šæŒ‰ç…§å­—æ®µaåˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„aå‡ºç°çš„æ¬¡æ•°ã€‚åœ¨è¿™ä¸ªç»“æœé‡Œï¼Œç”±äºåšçš„æ˜¯èšåˆè®¡ç®—ï¼Œç›¸åŒçš„aåªå‡ºç°ä¸€æ¬¡ã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šè¿™é‡Œä½ å¯ä»¥é¡ºä¾¿å¤ä¹ ä¸€ä¸‹<a href=\"https://time.geekbang.org/column/article/80477\">ç¬¬37ç¯‡æ–‡ç« </a>ä¸­å…³äºgroup byçš„ç›¸å…³å†…å®¹ã€‚</p>\n</blockquote><p>æ²¡æœ‰äº†count(*)ä»¥åï¼Œä¹Ÿå°±æ˜¯ä¸å†éœ€è¦æ‰§è¡Œâ€œè®¡ç®—æ€»æ•°â€çš„é€»è¾‘æ—¶ï¼Œç¬¬ä¸€æ¡è¯­å¥çš„é€»è¾‘å°±å˜æˆæ˜¯ï¼šæŒ‰ç…§å­—æ®µaåšåˆ†ç»„ï¼Œç›¸åŒçš„açš„å€¼åªè¿”å›ä¸€è¡Œã€‚è€Œè¿™å°±æ˜¯distinctçš„è¯­ä¹‰ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰§è¡Œèšåˆå‡½æ•°æ—¶ï¼Œdistinct å’Œgroup byè¿™ä¸¤æ¡è¯­å¥çš„è¯­ä¹‰å’Œæ‰§è¡Œæµç¨‹æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤æ‰§è¡Œæ€§èƒ½ä¹Ÿç›¸åŒã€‚</p><p>è¿™ä¸¤æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><ol>\n<li>\n<p>åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œä¸´æ—¶è¡¨æœ‰ä¸€ä¸ªå­—æ®µaï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªå­—æ®µaä¸Šåˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼›</p>\n</li>\n<li>\n<p>éå†è¡¨tï¼Œä¾æ¬¡å–æ•°æ®æ’å…¥ä¸´æ—¶è¡¨ä¸­ï¼š</p>\n<ul>\n<li>å¦‚æœå‘ç°å”¯ä¸€é”®å†²çªï¼Œå°±è·³è¿‡ï¼›</li>\n<li>å¦åˆ™æ’å…¥æˆåŠŸï¼›</li>\n</ul>\n</li>\n<li>\n<p>éå†å®Œæˆåï¼Œå°†ä¸´æ—¶è¡¨ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>\n</li>\n</ol><h1>å¤‡åº“è‡ªå¢ä¸»é”®é—®é¢˜</h1><p>é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œå¤§å®¶å¯¹ç»†èŠ‚çš„è¿½é—®ä¹Ÿå¾ˆåˆ°ä½ã€‚åœ¨ç¬¬39ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/80531\">ã€Šè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿã€‹</a>è¯„è®ºåŒºï¼Œ@å¸½å­æ‰äº† åŒå­¦é—®åˆ°ï¼šåœ¨binlog_format=statementæ—¶ï¼Œè¯­å¥Aå…ˆè·å–id=1ï¼Œç„¶åè¯­å¥Bè·å–id=2ï¼›æ¥ç€è¯­å¥Bæäº¤ï¼Œå†™binlogï¼Œç„¶åè¯­å¥Aå†å†™binlogã€‚è¿™æ—¶å€™ï¼Œå¦‚æœbinlogé‡æ”¾ï¼Œæ˜¯ä¸æ˜¯ä¼šå‘ç”Ÿè¯­å¥Bçš„idä¸º1ï¼Œè€Œè¯­å¥Açš„idä¸º2çš„ä¸ä¸€è‡´æƒ…å†µå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜é»˜è®¤äº†â€œè‡ªå¢idçš„ç”Ÿæˆé¡ºåºï¼Œå’Œbinlogçš„å†™å…¥é¡ºåºå¯èƒ½æ˜¯ä¸åŒçš„â€ï¼Œè¿™ä¸ªç†è§£æ˜¯æ­£ç¡®çš„ã€‚</p><p>å…¶æ¬¡ï¼Œè¿™ä¸ªé—®é¢˜é™å®šåœ¨statementæ ¼å¼ä¸‹ï¼Œä¹Ÿæ˜¯å¯¹çš„ã€‚å› ä¸ºrowæ ¼å¼çš„binlogå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜äº†ï¼ŒWrite row eventé‡Œé¢ç›´æ¥å†™äº†æ¯ä¸€è¡Œçš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚</p><p>è€Œè‡³äºä¸ºä»€ä¹ˆä¸ä¼šå‘ç”Ÿä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚</p><pre><code>create table t(id int auto_increment primary key);\ninsert into t values(null);\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/b5/25/b55b2167aa301d899ccc86a00b496b25.png?wh=1309*210\" alt=\"\"></p><center><span class=\"reference\">å›¾7 insert è¯­å¥çš„binlog</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨insertè¯­å¥ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€å¥SET INSERT_ID=1ã€‚è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªçº¿ç¨‹é‡Œä¸‹ä¸€æ¬¡éœ€è¦ç”¨åˆ°è‡ªå¢å€¼çš„æ—¶å€™ï¼Œä¸è®ºå½“å‰è¡¨çš„è‡ªå¢å€¼æ˜¯å¤šå°‘ï¼Œå›ºå®šç”¨1è¿™ä¸ªå€¼ã€‚</p><p>è¿™ä¸ªSET INSERT_IDè¯­å¥æ˜¯å›ºå®šè·Ÿåœ¨insertè¯­å¥ä¹‹å‰çš„ï¼Œæ¯”å¦‚@å¸½å­æ‰äº†åŒå­¦æåˆ°çš„åœºæ™¯ï¼Œä¸»åº“ä¸Šè¯­å¥Açš„idæ˜¯1ï¼Œè¯­å¥Bçš„idæ˜¯2ï¼Œä½†æ˜¯å†™å…¥binlogçš„é¡ºåºå…ˆBåAï¼Œé‚£ä¹ˆbinlogå°±å˜æˆï¼š</p><pre><code>SET INSERT_ID=2;\nè¯­å¥Bï¼›\nSET INSERT_ID=1;\nè¯­å¥Aï¼›\n</code></pre><p>ä½ çœ‹ï¼Œåœ¨å¤‡åº“ä¸Šè¯­å¥Bç”¨åˆ°çš„INSERT_IDä¾ç„¶æ˜¯2ï¼Œè·Ÿä¸»åº“ç›¸åŒã€‚</p><p>å› æ­¤ï¼Œå³ä½¿ä¸¤ä¸ªINSERTè¯­å¥åœ¨ä¸»å¤‡åº“çš„æ‰§è¡Œé¡ºåºä¸åŒï¼Œè‡ªå¢ä¸»é”®å­—æ®µçš„å€¼ä¹Ÿä¸ä¼šä¸ä¸€è‡´ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡ç­”ç–‘æ–‡ç« ï¼Œæˆ‘é€‰äº†4ä¸ªå¥½é—®é¢˜å’Œä½ åˆ†äº«ï¼Œå¹¶åšäº†åˆ†æã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œèƒ½å¤Ÿæå‡ºå¥½é—®é¢˜ï¼Œé¦–å…ˆè¡¨ç¤ºè¿™äº›åŒå­¦ç†è§£äº†æˆ‘ä»¬æ–‡ç« çš„å†…å®¹ï¼Œè¿›è€Œåˆåšäº†æ·±å…¥æ€è€ƒã€‚æœ‰ä½ ä»¬åœ¨è®¤çœŸçš„é˜…è¯»å’Œæ€è€ƒï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯é¼“åŠ±ï¼Œä¹Ÿæ˜¯åŠ¨åŠ›ã€‚</p><p>è¯´å®è¯ï¼ŒçŸ­çŸ­çš„ä¸‰ç¯‡ç­”ç–‘æ–‡ç« æ— æ³•å…¨éƒ¨å±•å¼€åŒå­¦ä»¬åœ¨è¯„è®ºåŒºç•™ä¸‹çš„é«˜è´¨é‡é—®é¢˜ï¼Œä¹‹åæœ‰çš„åŒå­¦è¿˜ä¼šäºŒåˆ·ï¼Œä¹Ÿä¼šæœ‰æ–°çš„åŒå­¦åŠ å…¥ï¼Œå¤§å®¶æƒ³åˆ°æ–°çš„é—®é¢˜å°±è¯·ç»™æˆ‘ç•™è¨€å§ï¼Œæˆ‘ä¼šç»§ç»­å…³æ³¨è¯„è®ºåŒºï¼Œå’Œä½ åœ¨è¯„è®ºåŒºäº¤æµã€‚</p><p>è€è§„çŸ©ï¼Œç­”ç–‘æ–‡ç« ä¹Ÿæ˜¯è¦æœ‰è¯¾åæ€è€ƒé¢˜çš„ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/70562\">ç¬¬8ç¯‡æ–‡ç« </a>çš„è¯„è®ºåŒºï¼Œ @XDåŒå­¦æåˆ°ä¸€ä¸ªé—®é¢˜ï¼šä»–æŸ¥çœ‹äº†ä¸€ä¸‹innodb_trxï¼Œå‘ç°è¿™ä¸ªäº‹åŠ¡çš„trx_idæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼ˆ281479535353408ï¼‰ï¼Œè€Œä¸”ä¼¼ä¹åœ¨åŒä¸€ä¸ªsessionä¸­å¯åŠ¨çš„ä¼šè¯å¾—åˆ°çš„trx_idæ˜¯ä¿æŒä¸å˜çš„ã€‚å½“æ‰§è¡Œä»»ä½•åŠ å†™é”çš„è¯­å¥åï¼Œtrx_idéƒ½ä¼šå˜æˆä¸€ä¸ªå¾ˆå°çš„æ•°å­—ï¼ˆ118378ï¼‰ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡å®éªŒéªŒè¯ä¸€ä¸‹ï¼Œç„¶ååˆ†æçœ‹çœ‹ï¼Œäº‹åŠ¡idçš„åˆ†é…è§„åˆ™æ˜¯ä»€ä¹ˆï¼Œä»¥åŠMySQLä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»“è®ºå’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆç»™åˆ†åŒºè¡¨tåˆ›å»ºè‡ªå¢ä¸»é”®ã€‚ç”±äºMySQLè¦æ±‚ä¸»é”®åŒ…å«æ‰€æœ‰çš„åˆ†åŒºå­—æ®µï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¦åˆ›å»ºè”åˆä¸»é”®çš„ã€‚</p><p>è¿™æ—¶å€™å°±æœ‰ä¸¤ç§å¯é€‰ï¼šä¸€ç§æ˜¯(ftime, id)ï¼Œå¦ä¸€ç§æ˜¯(id, ftime)ã€‚</p><p>å¦‚æœä»åˆ©ç”¨ç‡ä¸Šæ¥çœ‹ï¼Œåº”è¯¥ä½¿ç”¨(ftime, id)è¿™ç§æ¨¡å¼ã€‚å› ä¸ºç”¨ftimeåšåˆ†åŒºkeyï¼Œè¯´æ˜å¤§å¤šæ•°è¯­å¥éƒ½æ˜¯åŒ…å«ftimeçš„ï¼Œä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥åˆ©ç”¨å‰ç¼€ç´¢å¼•çš„è§„åˆ™ï¼Œå‡å°‘ä¸€ä¸ªç´¢å¼•ã€‚</p><p>è¿™æ—¶çš„å»ºè¡¨è¯­å¥æ˜¯ï¼š</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `ftime` datetime NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  PRIMARY KEY (`ftime`,`id`)\n) ENGINE=MyISAM DEFAULT CHARSET=latin1\nPARTITION BY RANGE (YEAR(ftime))\n(PARTITION p_2017 VALUES LESS THAN (2017) ENGINE = MyISAM,\n PARTITION p_2018 VALUES LESS THAN (2018) ENGINE = MyISAM,\n PARTITION p_2019 VALUES LESS THAN (2019) ENGINE = MyISAM,\n PARTITION p_others VALUES LESS THAN MAXVALUE ENGINE = MyISAM);\n</code></pre><p>å½“ç„¶ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä½ è¦å°½é‡ä½¿ç”¨InnoDBå¼•æ“ã€‚InnoDBè¡¨è¦æ±‚è‡³å°‘æœ‰ä¸€ä¸ªç´¢å¼•ï¼Œä»¥è‡ªå¢å­—æ®µä½œä¸ºç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸€ä¸ªidçš„å•ç‹¬ç´¢å¼•ã€‚</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `ftime` datetime NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  PRIMARY KEY (`ftime`,`id`),\n  KEY `id` (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1\nPARTITION BY RANGE (YEAR(ftime))\n(PARTITION p_2017 VALUES LESS THAN (2017) ENGINE = InnoDB,\n PARTITION p_2018 VALUES LESS THAN (2018) ENGINE = InnoDB,\n PARTITION p_2019 VALUES LESS THAN (2019) ENGINE = InnoDB,\n PARTITION p_others VALUES LESS THAN MAXVALUE ENGINE = InnoDB);\n</code></pre><p>å½“ç„¶æŠŠå­—æ®µåè¿‡æ¥ï¼Œåˆ›å»ºæˆï¼š</p><pre><code>  PRIMARY KEY (`id`,`ftime`),\n  KEY `id` (`ftime`)\n</code></pre><p>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@å¤¹å¿ƒé¢åŒ… ã€@éƒ­æ±Ÿä¼Ÿ åŒå­¦æåˆ°äº†æœ€åä¸€ç§æ–¹æ¡ˆã€‚</p>\n</blockquote><blockquote>\n<p>@aliang åŒå­¦æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œå…³äºopen_files_limitå’Œinnodb_open_filesçš„å…³ç³»ï¼Œæˆ‘åœ¨å›å¤ä¸­åšäº†è¯´æ˜ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ã€‚</p>\n</blockquote><blockquote>\n<p>@ä¸‡å‹‡ æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œå®é™…ä¸Šå¯¹äºç°åœ¨å®˜æ–¹çš„ç‰ˆæœ¬ï¼Œå°†å­—æ®µåŠ åœ¨ä¸­é—´è¿˜æ˜¯æœ€åï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯æ²¡å·®åˆ«çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘å»ºè®®å¤§å®¶å…»æˆä¹ æƒ¯ï¼ˆå¦‚æœä½ æ˜¯DBAå°±å¸®ä¸šåŠ¡å¼€å‘åŒå­¦å…»æˆä¹ æƒ¯ï¼‰ï¼Œå°†å­—æ®µåŠ åœ¨æœ€åé¢ï¼Œå› ä¸ºè¿™æ ·è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿æ“ä½œçš„ã€‚è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¹Ÿåœ¨è¯„è®ºçš„ç­”å¤ä¸­åšäº†è¯´æ˜ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ã€‚</p>\n</blockquote>","comments":[{"had_liked":false,"id":70232,"user_name":"ç‰å“¥","can_delete":false,"product_type":"c1","uid":1275710,"ip_address":"","ucode":"FC88E11D3A340B","user_header":"https://static001.geekbang.org/account/avatar/00/13/77/3e/702c8782.jpg","comment_is_top":false,"comment_ctime":1551056530,"is_pvip":false,"replies":[{"id":"25039","content":"å¯¹ï¼Œé©±åŠ¨è¡¨ç°è¿‡æ»¤ï¼Œç„¶åè¿›join buffer<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551058128,"ip_address":"","comment_id":70232,"utype":1}],"discussion_count":1,"race_medal":0,"score":"138990010002","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒBNlç®—æ³•ï¼Œå¦‚æœwhereæ¡ä»¶ä¸­æœ‰é©±åŠ¨è¡¨çš„è¿‡æ»¤æ¡ä»¶ï¼Œä¹Ÿä¸ä¼šåœ¨joinæ—¶å€™å…¨éƒ¨è½½å…¥å†…å­˜å§ï¼Ÿ","like_count":32,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440504,"discussion_content":"å¯¹ï¼Œé©±åŠ¨è¡¨ç°è¿‡æ»¤ï¼Œç„¶åè¿›join buffer\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551058128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69866,"user_name":"é¾™æ–‡","can_delete":false,"product_type":"c1","uid":1303084,"ip_address":"","ucode":"D987E8F706FB1D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/2c/0d04f87b.jpg","comment_is_top":false,"comment_ctime":1550892714,"is_pvip":false,"replies":[{"id":"24947","content":"1. ä¼š<br>2. ä½ è¿™é‡Œ<br>  session 1 æˆåŠŸåŠ é”ä¸€ä¸ªrecord lockï¼›<br><br>  session 2æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªselect è¯­å¥ï¼Œè€Œä¸”a=1 and b=1å°±åªé”ä¸€è¡Œï¼ˆaï¼Œbä¸Šæœ‰è”åˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œè¿™é‡Œå°±æ˜¯è¦ç”³è¯·ä¸€ä¸ªè®°å½•è¡Œé”(but not gap waiting)ã€‚<br>è¿™é‡Œè™½ç„¶æ²¡æœ‰åŠ é”æˆåŠŸï¼Œä½†æ˜¯å·²ç»åŠ å…¥äº†é”é˜Ÿåˆ—ï¼ˆåªæ˜¯è¿™ä¸ªé”æ˜¯å¤„äºç­‰å¾…çŠ¶æ€ï¼‰<br>  ---è¿™æ—¶å€™é˜Ÿåˆ—é‡Œé¢æœ‰ä¸¤ä¸ªé”å¯¹è±¡äº†<br><br>ç„¶åsession 1 å†insertå¤±è´¥çš„æ—¶å€™ï¼Œå°±è¦åŠ next-key lockï¼Œï¼ˆæ³¨æ„è¿™ä¸ªé”å¯¹è±¡è·Ÿç¬¬ä¸€ä¸ªé”å¯¹è±¡ä¸åŒï¼‰ã€‚<br>   ç„¶åæ­»é”æ£€æµ‹çœ‹åˆ°ï¼Œ2å·é”åœ¨ç­‰1å·é”ï¼›3å·è¦ç­‰2å·ï¼Œè€Œ3å’Œ1åˆæ˜¯åŒä¸€ä¸ªsessionï¼Œå°±è®¤ä¸ºæ˜¯æ­»é”äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550977236,"ip_address":"","comment_id":69866,"utype":1}],"discussion_count":8,"race_medal":0,"score":"126104944298","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨ç¬¬21è®²æ±‚åŠ©äº†ä¸€ä¸ªæ­»é”é—®é¢˜ï¼Œå½“æ—¶ä½ å›å¤è¯´åé¢ä¼šè§£ç­”ï¼Œä¸è¿‡æˆ‘æµè§ˆäº†ä¸‹åç»­æ–‡ç« æ²¡æ‰¾åˆ°è§£ç­”ï¼Œæ‰€ä»¥å†æ¬¡æ±‚åŠ©ä¸‹ã€‚ps:ç”¨çš„é˜¿é‡Œäº‘çš„rds,æäº†å·¥å•æ²¡æ•ˆæœå•Š<br>ä½œè€…å›å¤: æœ‰çš„ï¼Œä½ çœ‹ä¸€ä¸‹ç¬¬40ç¯‡ â€œinsert å”¯ä¸€é”®å†²çªâ€è¿™ä¸€æ®µ<br><br>ps:æˆ‘å·²ç»ç¦»å¼€é˜¿é‡Œäº‘æŒºä¹…çš„äº† ğŸ˜†<br><br>---------------------------------------------<br>è°¢è°¢è€å¸ˆ,æˆ‘çœ‹äº†ç¬¬40ç¯‡,è¿˜æ˜¯æœ‰åœ°æ–¹ä¸å¤ªæ˜ç™½,å†æ‰“æ‰°ä¸‹<br>mysql ç‰ˆæœ¬5.6<br>éš”ç¦»çº§åˆ«ä¸ºrc<br>CREATE TABLE `uk_test` (<br>  `id` bigint(20) NOT NULL AUTO_INCREMENT,<br>  `a` int(11) NOT NULL,<br>  `b` int(11) NOT NULL,<br>  `c` int(11) NOT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_a_b` (`a`,`b`) USING BTREE<br>) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4<br>è¡¨ä¸­æ•°æ®ï¼š<br>+----+---+---+---+<br>| id | a | b | c |<br>+----+---+---+---+<br>| 1 | 1 | 1 | 2 |<br>| 6 | 1 | 2 | 1 |<br>+----+---+---+---+<br>sql:æ‰§è¡Œé¡ºåº<br>session1:begin;<br>session2:begin;<br>session1:select * from uk_test where a = 1 and b = 1 for update;<br>session2:select * from uk_test where a = 1 and b = 1 for update;<br>session1:insert into uk_test (a,b,c) values(1,1,2) on duplicate key update c = 2;<br>session2:ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction<br><br>æˆ‘çš„ç–‘é—®æ˜¯:<br>1.rcéš”ç¦»çº§åˆ«ä¸‹å¯¹å”¯ä¸€é”®çš„insertä¹Ÿä¼šåŠ next-key lockå—ï¼Ÿ<br><br>2.æ­»é”æ—¥å¿—æ˜¾ç¤º<br>  session 1å·²ç»æˆåŠŸåŠ ä¸Šè¡Œé”(lock_mode X locks rec but not gap),<br><br>  session 2åœ¨ç­‰å¾…åŒä¸€ä¸ªè¡Œé”(lock_mode X locks rec but not gap waiting),<br><br>  session1è¿™æ—¶å› ä¸ºç­‰å¾…lock_mode X waitingè€Œæ­»é”ã€‚<br>  è¿™é‡Œçš„lock_mode X waitingæ˜¯æŒ‡next-key lockå—ï¼Ÿ<br>  å¦‚æœæ˜¯çš„è¯ï¼Œæ²¡æƒ³æ˜ç™½è¿™é‡Œæ€ä¹ˆå½¢æˆèµ„æºå¾ªç¯ç­‰å¾…äº†ï¼Ÿ<br>æˆ‘çš„çŒœæµ‹æ˜¯session1 è¿™æ—¶æŒæœ‰è¡Œé”ï¼Œè¦next-key lock æ‰€ä»¥è¦å»åŠ gapé”ã€‚session 2æŒæœ‰gapé”åœ¨ç­‰è¡Œé”ã€‚ä½†å¦‚æœæ˜¯è¿™æ ·ä¸ºä»€ä¹ˆsession2 åœ¨rcä¸‹select for updateï¼Œä¸”è®°å½•å­˜åœ¨æ—¶ä¼šåŠ gapé”?è¿˜æœ‰gapé”åŠ é”ä¸æ˜¯ä¸äº’æ–¥å—ï¼Ÿ<br> ","like_count":29,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440322,"discussion_content":"1. ä¼š\n2. ä½ è¿™é‡Œ\n  session 1 æˆåŠŸåŠ é”ä¸€ä¸ªrecord lockï¼›\n\n  session 2æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªselect è¯­å¥ï¼Œè€Œä¸”a=1 and b=1å°±åªé”ä¸€è¡Œï¼ˆaï¼Œbä¸Šæœ‰è”åˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œè¿™é‡Œå°±æ˜¯è¦ç”³è¯·ä¸€ä¸ªè®°å½•è¡Œé”(but not gap waiting)ã€‚\nè¿™é‡Œè™½ç„¶æ²¡æœ‰åŠ é”æˆåŠŸï¼Œä½†æ˜¯å·²ç»åŠ å…¥äº†é”é˜Ÿåˆ—ï¼ˆåªæ˜¯è¿™ä¸ªé”æ˜¯å¤„äºç­‰å¾…çŠ¶æ€ï¼‰\n  ---è¿™æ—¶å€™é˜Ÿåˆ—é‡Œé¢æœ‰ä¸¤ä¸ªé”å¯¹è±¡äº†\n\nç„¶åsession 1 å†insertå¤±è´¥çš„æ—¶å€™ï¼Œå°±è¦åŠ next-key lockï¼Œï¼ˆæ³¨æ„è¿™ä¸ªé”å¯¹è±¡è·Ÿç¬¬ä¸€ä¸ªé”å¯¹è±¡ä¸åŒï¼‰ã€‚\n   ç„¶åæ­»é”æ£€æµ‹çœ‹åˆ°ï¼Œ2å·é”åœ¨ç­‰1å·é”ï¼›3å·è¦ç­‰2å·ï¼Œè€Œ3å’Œ1åˆæ˜¯åŒä¸€ä¸ªsessionï¼Œå°±è®¤ä¸ºæ˜¯æ­»é”äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550977236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344373,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c5/b5/25179772.jpg","nickname":"Jamey","note":"","ucode":"449E4F65339CDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380877,"discussion_content":"mysql 8.0.22 åœ¨rc çº§åˆ«ä¸‹æœªé‡ç°ï¼ˆ set global transaction isolation level read committed;ï¼‰T1: æ‰§è¡Œsession 1 ï¼ˆbegin;\nselect * from uk_test where a = 1 and b = 1 for update;ï¼‰T2ï¼š æ‰§è¡Œ session 2 ï¼ˆbegin;\nselect * from uk_test where a = 1 and b = 1 for update;ï¼‰æ­¤æ—¶ block ã€‚T3ï¼šæ‰§è¡Œ session 1ï¼ˆinsert into uk_test (a,b,c) values(1,1,2) on duplicate key update c = 2;ï¼‰ æˆåŠŸï¼Œ ä½† session 2 ä¾æ—§blockï¼Œ å¹¶æœªå‡ºç° dead lock ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1624771756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588573,"discussion_content":"å”¯ä¸€ç´¢å¼•å†²çªé™çº§è¯»é”ï¼Œå¯¼è‡´æ­»é”ï¼›è·Ÿ40ç« åŸç†ä¸€æ ·","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663856752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284857,"avatar":"https://static001.geekbang.org/account/avatar/00/13/9a/f9/6d55ee0b.jpg","nickname":"Tiger","note":"","ucode":"6F9CAB3C29BAD7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552359,"discussion_content":"rcçš„éš”ç¦»çº§åˆ«ä¸‹ä¸æ˜¯åªæœ‰record lockå—ï¼Ÿnext-key lockå’Œgap lockä¸æ˜¯å› ä¸ºrrä¸‹è¦è§£å†³å¹»è¯»æ‰å¼•å…¥çš„å—ï¼Ÿæ²¡æ˜ç™½rcçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä»€ä¹ˆåœºæ™¯ä¼šåŠ next-key lockï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645429880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1586404,"avatar":"https://static001.geekbang.org/account/avatar/00/18/34/e4/4450c053.jpg","nickname":"å››å‘³ç³–","note":"","ucode":"6648BACBF1CFEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362484,"discussion_content":"on duplicate key updateè¯­å¥æ‰§è¡Œæ˜¯ä¼šå…ˆåŠ sé”ï¼Œåˆ¤æ–­è®°å½•æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ„Ÿè§‰è¿™æ—¶å€™å°±é˜»å¡äº†ç„¶åæ­»é”äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616946753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1275424,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/aiaO77mTsCalcia49ElevPn988pgwcL3rD5ic1DTD6E8rbAwfmguiaPsibHicsYGQID7VbmD21GUAV9bbuNMfDhDGGyg/132","nickname":"ç©¿é’ˆåœŸè±†ä¸","note":"","ucode":"5DA3BDDE5162E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357816,"discussion_content":"ä¸ªäººè§‰å¾—ï¼Œè¿™é‡Œæè¿°æœ‰ç‚¹é—®é¢˜ï¼ŒRC çº§åˆ«ä¸‹ï¼ŒåŠ çš„åº”è¯¥éƒ½æ˜¯è¡Œé”å§ï¼Ÿ1å·è·å–é”ï¼Œ2å·ç­‰1å·çš„é”ï¼Œ3å·åˆè¦ç­‰2å·çš„é”ï¼Œæ­¤æ—¶3å·å°±æ˜¯1å·ã€‚ç›¸å½“äºæˆ‘å‘ç°ä½ åœ¨ç­‰æˆ‘ï¼Œæˆ‘ä¹Ÿåœ¨ç­‰ä½ ï¼Œæ‰€ä»¥äº§ç”Ÿäº†æ­»é”ã€‚æ­»é”æ£€æµ‹è‡ªç„¶è¦å›æ»šä¸€ä¸ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615873725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275424,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/aiaO77mTsCalcia49ElevPn988pgwcL3rD5ic1DTD6E8rbAwfmguiaPsibHicsYGQID7VbmD21GUAV9bbuNMfDhDGGyg/132","nickname":"ç©¿é’ˆåœŸè±†ä¸","note":"","ucode":"5DA3BDDE5162E4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362662,"discussion_content":"æˆ‘çœ‹åˆ°çš„ä¹Ÿæ˜¯è¡Œé”\n*** (2) TRANSACTION:\nTRANSACTION 5544474, ACTIVE 11 sec inserting\nmysql tables in use 1, locked 1\n4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 1\nMySQL thread id 10, OS thread handle 140338301662976, query id 104 localhost root update\ninsert into uk_test (a,b,c) values(1,1,2) on duplicate key update c = 2\n*** (2) HOLDS THE LOCK(S):\nRECORD LOCKS space id 117 page no 4 n bits 72 index uk_a_b of table `test`.`uk_test` trx id 5544474 lock_mode X locks rec but not gap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617003464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":357816,"ip_address":""},"score":362662,"extra":""}]},{"author":{"id":1276205,"avatar":"https://static001.geekbang.org/account/avatar/00/13/79/2d/99a263f4.jpg","nickname":"tanic.xiao","note":"","ucode":"D970A2C1254CEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212207,"discussion_content":"ç‰›é€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584946016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70731,"user_name":"è¿˜ä¸€æ£µæ ‘","can_delete":false,"product_type":"c1","uid":1317709,"ip_address":"","ucode":"C187F2A141D60E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQxlvXukXUgPp39zJHyyReK5s1C9VhA6rric7GiarbfQMuWhdCCDdxdfL610Hc4cNkn9Q/132","comment_is_top":false,"comment_ctime":1551170773,"is_pvip":false,"replies":[{"id":"25754","content":"<br>â€œå¦‚æœæŒ‰ç…§è¿™ä¸ªæµç¨‹ï¼Œæ¯”å¦‚aé‡Œé¢æœ‰2è¡Œé‡å¤çš„æ•°æ®ï¼Œ å¦‚æœæ‹¿bçš„æ•°æ®åœ¨aä¸­åˆ¤æ–­ï¼Œå­˜åœ¨åˆ™ä¿ç•™ï¼Œé‚£ç»“æœé›†åªæœ‰ä¸€æ¡æ•°æ®ï¼Œâ€<br><br>ä¸ä¼šå‘€ï¼Œä½ çœ‹å®ƒæ˜¯è¿™æ ·çš„ï¼š<br>å‡è®¾join bufferä¸­æœ‰ä¸¤ä¸ªè¡Œ1<br><br>ç„¶åè¢«é©±åŠ¨è¡¨å–å‡ºä¸€ä¸ª1ï¼Œ<br>  è·Ÿjoin bufferä¸­ç¬¬ä¸€ä¸ª1æ¯”è¾ƒï¼Œå‘ç°æ»¡è¶³æ¡ä»¶ï¼Œæ”¾åˆ°ç»“æœé›†ï¼›<br>  è·Ÿjoin bufferä¸­ç¬¬äºŒä¸ª1æ¯”è¾ƒï¼Œå‘ç°æ»¡è¶³æ¡ä»¶ï¼Œæ”¾åˆ°ç»“æœé›†ï¼›<br> <br>  æ˜¯å¾—åˆ°ä¸¤è¡Œçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551413009,"ip_address":"","comment_id":70731,"utype":1}],"discussion_count":1,"race_medal":0,"score":"91745483989","product_id":100020801,"comment_content":"çœ‹åˆ° BNL ç®—æ³•ï¼Œä½ å°±åº”è¯¥çŸ¥é“è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹å…¶å®æ˜¯è¿™æ ·<br>æ–‡ç« ä¸­çš„æµç¨‹æ˜¯å†™é”™äº†ï¼Ÿè¿˜æ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜<br>1ã€å¦‚æœæ˜¯aè¡¨æ•°æ®æ”¾å…¥join bufferï¼Œæ ¹æ®bçš„æ¯ä¸€æ¡è®°å½•å»åˆ¤æ–­æ˜¯å¦åœ¨aä¸­ å¦‚æœåœ¨åˆ™ä¿ç•™è®°å½•<br>è¿™ä¸ªæ›´åƒæ˜¯b left join aã€‚  è€Œä¸æ˜¯a  left join b<br>2ã€å¦‚æœæŒ‰ç…§è¿™ä¸ªæµç¨‹ï¼Œæ¯”å¦‚aé‡Œé¢æœ‰2è¡Œé‡å¤çš„æ•°æ®ï¼Œ å¦‚æœæ‹¿bçš„æ•°æ®åœ¨aä¸­åˆ¤æ–­ï¼Œå­˜åœ¨åˆ™ä¿ç•™ï¼Œé‚£ç»“æœé›†åªæœ‰ä¸€æ¡æ•°æ®ï¼Œ è€ŒæŒ‰ç…§a left join b ä¼šå‡ºç°2æ¡ç»“æœçš„","like_count":21,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440799,"discussion_content":"\nâ€œå¦‚æœæŒ‰ç…§è¿™ä¸ªæµç¨‹ï¼Œæ¯”å¦‚aé‡Œé¢æœ‰2è¡Œé‡å¤çš„æ•°æ®ï¼Œ å¦‚æœæ‹¿bçš„æ•°æ®åœ¨aä¸­åˆ¤æ–­ï¼Œå­˜åœ¨åˆ™ä¿ç•™ï¼Œé‚£ç»“æœé›†åªæœ‰ä¸€æ¡æ•°æ®ï¼Œâ€\n\nä¸ä¼šå‘€ï¼Œä½ çœ‹å®ƒæ˜¯è¿™æ ·çš„ï¼š\nå‡è®¾join bufferä¸­æœ‰ä¸¤ä¸ªè¡Œ1\n\nç„¶åè¢«é©±åŠ¨è¡¨å–å‡ºä¸€ä¸ª1ï¼Œ\n  è·Ÿjoin bufferä¸­ç¬¬ä¸€ä¸ª1æ¯”è¾ƒï¼Œå‘ç°æ»¡è¶³æ¡ä»¶ï¼Œæ”¾åˆ°ç»“æœé›†ï¼›\n  è·Ÿjoin bufferä¸­ç¬¬äºŒä¸ª1æ¯”è¾ƒï¼Œå‘ç°æ»¡è¶³æ¡ä»¶ï¼Œæ”¾åˆ°ç»“æœé›†ï¼›\n \n  æ˜¯å¾—åˆ°ä¸¤è¡Œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551413009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70257,"user_name":"Dovelol","can_delete":false,"product_type":"c1","uid":1253384,"ip_address":"","ucode":"9B5DDF7720F307","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg","comment_is_top":false,"comment_ctime":1551060483,"is_pvip":false,"replies":[{"id":"25095","content":"å—¯ æˆ‘çš„æ„æ€æ˜¯ï¼Œå¦‚æœwhereæ¡ä»¶é‡Œé¢ï¼Œç”¨åˆ°äº†b.f2çš„åˆ¤æ–­ï¼Œå¹²è„†å°±ç›´æ¥å†™æˆjoinï¼Œä¸éœ€è¦left joinäº†<br><br><br>å¦‚æœä¸šåŠ¡é€»è¾‘éœ€è¦left joinï¼Œ å°±è¦æŠŠæ¡ä»¶éƒ½æ”¾åˆ°oné‡Œé¢<br><br>ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§è¿˜æ˜¯ä¼˜å…ˆçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551080945,"ip_address":"","comment_id":70257,"utype":1}],"discussion_count":1,"race_medal":0,"score":"87450406403","product_id":100020801,"comment_content":"è€å¸ˆï¼Œçœ‹è¯„è®ºåŒ…æ‹¬æ‚¨çš„å›å¤è¯´â€œ left join ååŠ ä¸Š where çš„è¯ï¼Œ è‚¯å®šä¼šè¢«ä¼˜åŒ–å™¨ä¼˜åŒ–æˆ join where çš„å½¢å¼ï¼Œ é‚£æ˜¯å¦ä¸‹æ¬¡å†™ left join ..where çš„æ—¶å€™ï¼Œ ä¸å¦‚ç›´æ¥å†™æˆ join .. whereâ€ï¼Œè¿™ä¸ªä¹Ÿæ˜¯åˆ†æƒ…å†µçš„å§æ¯”å¦‚è¿˜æ˜¯æ–‡ç« ä¸­çš„2å¼ è¡¨ï¼Œselect * from a left join b on(a.f1=b.f1) where (a.f2=2);&#47;*Q5*&#47;å’Œselect * from a  join b on(a.f1=b.f1) where (a.f2=2);&#47;*Q6*&#47; è¿™ä¸ªleft joinå’Œjoinçš„è¯­æ„å’Œè¿”å›ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œæ€ä¹ˆèƒ½ç›´æ¥å†™æˆjoinå‘¢ï¼Œå¦‚æœæ˜¯where b.f2=xx çš„whereæ¡ä»¶å¯ä»¥ç›´æ¥å†™æˆjoinå› ä¸ºæ ¹æ®ç»“æœæ˜¯ä¸éœ€è¦leftçš„ã€‚","like_count":20,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440524,"discussion_content":"å—¯ æˆ‘çš„æ„æ€æ˜¯ï¼Œå¦‚æœwhereæ¡ä»¶é‡Œé¢ï¼Œç”¨åˆ°äº†b.f2çš„åˆ¤æ–­ï¼Œå¹²è„†å°±ç›´æ¥å†™æˆjoinï¼Œä¸éœ€è¦left joinäº†\n\n\nå¦‚æœä¸šåŠ¡é€»è¾‘éœ€è¦left joinï¼Œ å°±è¦æŠŠæ¡ä»¶éƒ½æ”¾åˆ°oné‡Œé¢\n\nä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§è¿˜æ˜¯ä¼˜å…ˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551080945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70212,"user_name":"æ¢¦åº·","can_delete":false,"product_type":"c1","uid":1069512,"ip_address":"","ucode":"8935F3C329C58E","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/c8/83852d5a.jpg","comment_is_top":false,"comment_ctime":1551053733,"is_pvip":false,"replies":[{"id":"25046","content":"ä¸å¥½æ„æ€ï¼Œç¡®å®ä½ çš„é—®é¢˜æ¯”è¾ƒéš¾ä¸€äº›<br><br>æœ€è¿‘åœ¨åšæ”¶å°¾çš„å·¥ä½œï¼Œåé¢ä¸€å®šä¼šæŠŠé—®é¢˜éƒ½æ¸…ç†æ‰çš„å“ˆã€‚<br><br>ä½ çš„é—®é¢˜è´¨é‡é«˜ï¼Œæ˜¯æˆ‘å–œæ¬¢å›ç­”çš„é—®é¢˜ç±»å‹ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551059057,"ip_address":"","comment_id":70212,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70270530469","product_id":100020801,"comment_content":"ğŸ˜‚ç•™è¨€çš„äººå¤ªå¤šï¼Œè¾›è‹¦è€å®ç­”ç–‘äº†ã€‚è™½ç„¶æˆ‘çš„é—®é¢˜æ²¡èƒ½è¢«ç¿»ç‰Œå­","like_count":16,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440494,"discussion_content":"ä¸å¥½æ„æ€ï¼Œç¡®å®ä½ çš„é—®é¢˜æ¯”è¾ƒéš¾ä¸€äº›\n\næœ€è¿‘åœ¨åšæ”¶å°¾çš„å·¥ä½œï¼Œåé¢ä¸€å®šä¼šæŠŠé—®é¢˜éƒ½æ¸…ç†æ‰çš„å“ˆã€‚\n\nä½ çš„é—®é¢˜è´¨é‡é«˜ï¼Œæ˜¯æˆ‘å–œæ¬¢å›ç­”çš„é—®é¢˜ç±»å‹ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551059057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83282,"user_name":"å¤§å®","can_delete":false,"product_type":"c1","uid":1321975,"ip_address":"","ucode":"FC1BCF0464B6D6","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/f7/f5ae026c.jpg","comment_is_top":false,"comment_ctime":1554516631,"is_pvip":false,"replies":[{"id":"30153","content":"innblock å¯ä»¥äº†è§£ä¸‹ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1554616175,"ip_address":"","comment_id":83282,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57389091479","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œçœ‹äº†ä½ å›å¤ @å½¼å¾—.æ— æ—¶è¯´ï¼Œâ€œåœ¨çº¿æœåŠ¡æœ€å¥½ä¸è¦è®©ç´¢å¼•æ ‘è¶…è¿‡4å±‚â€œï¼›é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•æˆ–è€…å·¥å…·å¯ä»¥æŸ¥çœ‹å½“å‰è¡¨çš„å±‚æ•°å—ï¼Ÿ","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445959,"discussion_content":"innblock å¯ä»¥äº†è§£ä¸‹ğŸ˜†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1554616175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69897,"user_name":"åƒæœ¨","can_delete":false,"product_type":"c1","uid":1304605,"ip_address":"","ucode":"32EBF403E9088E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fJ5BEicRVnXAwCxkIYhJZ0woiaQ38ibUYkYH125bzL2Y2ib1YS9b7Q9S5qia2Cia9UWzUoDBGeWJibB7p9xSnib7iaU8kzw/132","comment_is_top":false,"comment_ctime":1550899009,"is_pvip":false,"replies":[{"id":"24923","content":"BNLç®—æ³•æ‹¿çš„æ•°æ®æ˜¯ç¡®å®šçš„åªä¼šæ‹¿ä¸€æ¬¡ï¼ˆéå†ä¸€éï¼‰<br>è€Œsimple nested loop joinæ˜¯ä¼šéå†å¤šæ¬¡çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550943798,"ip_address":"","comment_id":69897,"utype":1}],"discussion_count":4,"race_medal":0,"score":"57385473857","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œjoinä½¿ç”¨join_bufferå’Œå†…å­˜åŒºåˆ«é‚£ä¸ªé—®é¢˜çš„ç¬¬ä¸€ç‚¹è§£é‡Šæˆ‘è¿˜æ˜¯æœ‰äº›çº³é—·ï¼Œä½ è¯´ç”±äºä»ç£ç›˜æ‹¿æ•°æ®åˆ°å†…å­˜é‡Œé¢ä¼šå¯¼è‡´ç­‰ç­‰çš„æ€§èƒ½é—®é¢˜æˆ‘èƒ½å¤Ÿç†è§£ï¼Œä½†æ˜¯è¯´å³ä½¿ä½¿ç”¨nblç®—æ³•ä¹Ÿä¼šæ¶‰åŠåˆ°ä»ç£ç›˜æ‹¿æ•°æ®åˆ°å†…å­˜å§ï¼Œæ‰€ä»¥è¿™ç‚¹å¯¼è‡´ä¸¤ç§ç®—æ³•æ‰§è¡Œå·®å¼‚è²Œä¼¼ä¸å¤ªåˆç†ï¼Œæ‚¨è§‰å¾—å‘¢ï¼Ÿ","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440340,"discussion_content":"BNLç®—æ³•æ‹¿çš„æ•°æ®æ˜¯ç¡®å®šçš„åªä¼šæ‹¿ä¸€æ¬¡ï¼ˆéå†ä¸€éï¼‰\nè€Œsimple nested loop joinæ˜¯ä¼šéå†å¤šæ¬¡çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550943798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1623487,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/sPORo6cN3GSVxjHj9nqSAPn7KG4wtSTqNUommjNndpf8qd7bHKHquuldXZfxD5nF1ldy4LeoAQNwSsOgcmWG9w/132","nickname":"å®ˆæœ›è€…","note":"","ucode":"DEE375A5F2D57A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347587,"discussion_content":"å¦‚æœå¯¹join_bufferæ’åºï¼Œå†å¯¹join_bufferç”¨äºŒåˆ†æ³•æ¯”è¾ƒï¼Œæ€§èƒ½ä¸Šè¿˜å¯ä»¥æœ‰æå‡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612262838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3007210,"avatar":"","nickname":"Geek_a1699c","note":"","ucode":"CF7DB00BE36B77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578176,"discussion_content":"BNLç®—æ³•ä¸æ˜¯å°†æ•°æ®ä»ç¡¬ç›˜ä¸­åŠ è½½åˆ°å†…å­˜çš„buffer poolå—ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£åŠ è½½åˆ°å“ªé‡Œå‘¢ï¼Œæœ‰ç‚¹ç–‘æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656555600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124075,"avatar":"https://static001.geekbang.org/account/avatar/00/11/26/eb/24e0ac9c.jpg","nickname":"å¬´æ¢¦å·","note":"","ucode":"104CDFD26A1711","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376182,"discussion_content":"æœ‰é“ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622005676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69636,"user_name":"ç™½æ°¸ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1200629,"ip_address":"","ucode":"3578587B8DCADC","user_header":"https://static001.geekbang.org/account/avatar/00/12/51/f5/211dff03.jpg","comment_is_top":false,"comment_ctime":1550800581,"is_pvip":false,"replies":[{"id":"24926","content":"â€œè‡ªå¢idçš„èµ·å§‹å€¼æ˜¯å¤šå°‘ï¼Œæœ‰æ²¡æœ‰å¯èƒ½è·Ÿå·²æœ‰çš„è®°å½•idå†²çªï¼Ÿâ€  <br>å¦‚æœæ²¡æœ‰ä¸»å¤‡å»¶è¿Ÿå°±ä¸ä¼šå‡ºç°ï¼›<br><br>â€œå°¤å…¶æ˜¯å¤‡åº“è¿˜æ²¡æœ‰å¤„ç†å®ŒåŒæ­¥è¿‡æ¥çš„binlogå°±å¼€å§‹æ¥å—å®¢æˆ·ç«¯è¯·æ±‚æ—¶ã€‚â€ ï¼Œ å¯¹ï¼Œè¿™ç§æƒ…å†µå°±ä¼šã€‚<br><br>â€œå¦‚æœè¦æ±‚å¤‡åº“å¿…é¡»å¤„ç†å®Œbinlogæ‰èƒ½æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸»å¤‡åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œä¸å½±å“ç”¨æˆ·ä½¿ç”¨â€ ä¸€èˆ¬éƒ½æ˜¯æœ‰è¿™ä¸ªè¦æ±‚çš„ã€‚è¦å°½é‡å‡å°‘å½±å“ï¼Œå°±æ˜¯æ§åˆ¶ä¸»å¤‡å»¶è¿Ÿã€‚<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550969358,"ip_address":"","comment_id":69636,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44500473541","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºå¤‡åº“è‡ªå¢idæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æ—¢ç„¶binlogä¸ç®¡æ˜¯statementæ¨¡å¼è¿˜æ˜¯rowæ¨¡å¼ï¼Œé‡Œé¢çš„insertè¯­å¥è·Ÿç€çš„è‡ªå¢idéƒ½æ˜¯å›ºå®šçš„ã€‚é‚£å‡å¦‚å‘ç”Ÿä¸»å¤‡åˆ‡æ¢ï¼Œå¤‡åº“å˜æˆä¸»åº“åï¼Œå®¢æˆ·ç«¯å¾€æ–°ä¸»åº“é‡Œæ’å…¥æ•°æ®æ—¶ï¼Œè‡ªå¢idçš„èµ·å§‹å€¼æ˜¯å¤šå°‘ï¼Œæœ‰æ²¡æœ‰å¯èƒ½è·Ÿå·²æœ‰çš„è®°å½•idå†²çªï¼Ÿå°¤å…¶æ˜¯å¤‡åº“è¿˜æ²¡æœ‰å¤„ç†å®ŒåŒæ­¥è¿‡æ¥çš„binlogå°±å¼€å§‹æ¥å—å®¢æˆ·ç«¯è¯·æ±‚æ—¶ã€‚å¦‚æœè¦æ±‚å¤‡åº“å¿…é¡»å¤„ç†å®Œbinlogæ‰èƒ½æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸»å¤‡åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œä¸å½±å“ç”¨æˆ·ä½¿ç”¨ã€‚è°¢è°¢ã€‚","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440197,"discussion_content":"â€œè‡ªå¢idçš„èµ·å§‹å€¼æ˜¯å¤šå°‘ï¼Œæœ‰æ²¡æœ‰å¯èƒ½è·Ÿå·²æœ‰çš„è®°å½•idå†²çªï¼Ÿâ€  \nå¦‚æœæ²¡æœ‰ä¸»å¤‡å»¶è¿Ÿå°±ä¸ä¼šå‡ºç°ï¼›\n\nâ€œå°¤å…¶æ˜¯å¤‡åº“è¿˜æ²¡æœ‰å¤„ç†å®ŒåŒæ­¥è¿‡æ¥çš„binlogå°±å¼€å§‹æ¥å—å®¢æˆ·ç«¯è¯·æ±‚æ—¶ã€‚â€ ï¼Œ å¯¹ï¼Œè¿™ç§æƒ…å†µå°±ä¼šã€‚\n\nâ€œå¦‚æœè¦æ±‚å¤‡åº“å¿…é¡»å¤„ç†å®Œbinlogæ‰èƒ½æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸»å¤‡åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œä¸å½±å“ç”¨æˆ·ä½¿ç”¨â€ ä¸€èˆ¬éƒ½æ˜¯æœ‰è¿™ä¸ªè¦æ±‚çš„ã€‚è¦å°½é‡å‡å°‘å½±å“ï¼Œå°±æ˜¯æ§åˆ¶ä¸»å¤‡å»¶è¿Ÿã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550969358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2797976,"avatar":"","nickname":"Geek_323a60","note":"","ucode":"CDC276EC255411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586831,"discussion_content":"ç»è¿‡æµ‹è¯•ï¼Œåœ¨ binlog_format=row ä¸‹ï¼Œbinlog ä¸­å¹¶æ²¡æœ‰å›ºå®šçš„è‡ªå¢ idã€‚\n/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;\n/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;\nDELIMITER /*!*/;\n# at 4\n#220907  6:50:27 server id 2  end_log_pos 123 CRC32 0xb61f2296 \tStart: binlog v 4, server v 5.7.36-log created 220907  6:50:27 at startup\n# Warning: this binlog is either in use or was not closed properly.\nROLLBACK/*!*/;\nBINLOG &#39;\nMz8YYw8CAAAAdwAAAHsAAAABAAQANS43LjM2LWxvZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAzPxhjEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA\nAZYiH7Y=\n&#39;/*!*/;\n# at 293\n#220907  6:50:34 server id 2  end_log_pos 341 CRC32 0xc65f50fe \tTable_map: `mytest`.`t` mapped to number 156\n# at 341\n#220907  6:50:34 server id 2  end_log_pos 389 CRC32 0xf59c8ead \tWrite_rows: table id 156 flags: STMT_END_F\n\nBINLOG &#39;\nOj8YYxMCAAAAMAAAAFUBAAAAAJwAAAAAAAEABm15dGVzdAABdAADAwMDAAb+UF/G\nOj8YYx4CAAAAMAAAAIUBAAAAAJwAAAAAAAEAAgAD//gIAAAAPAAAADwAAACtjpz1\n&#39;/*!*/;\n### INSERT INTO `mytest`.`t`\n### SET\n###   @1=8 /* INT meta=0 nullable=0 is_null=0 */\n###   @2=60 /* INT meta=0 nullable=1 is_null=0 */\n###   @3=60 /* INT meta=0 nullable=1 is_null=0 */\n# at 389\n#220907  6:50:34 server id 2  end_log_pos 420 CRC32 0x7863e3bc \tXid = 3845\nCOMMIT/*!*/;\nSET @@SESSION.GTID_NEXT= &#39;AUTOMATIC&#39; /* added by mysqlbinlog */ /*!*/;\nDELIMITER ;\n# End of log file\n/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;\n/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662533628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76869,"user_name":"å½¼å¾—.æ—","can_delete":false,"product_type":"c1","uid":1019306,"ip_address":"","ucode":"445B9751A88554","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/aa/e739c4fa.jpg","comment_is_top":false,"comment_ctime":1552732706,"is_pvip":false,"replies":[{"id":"28920","content":"ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ Nå±‚æ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œå°±å¢åŠ ä¸€å±‚æ¥æ”¾ã€‚<br><br>è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±é¡µåˆ†è£‚è§¦å‘çš„<br>åœ¨çº¿æœåŠ¡æœ€å¥½ä¸è¦è®©ç´¢å¼•æ ‘è¶…è¿‡4å±‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1553420542,"ip_address":"","comment_id":76869,"utype":1}],"discussion_count":3,"race_medal":0,"score":"40207438370","product_id":100020801,"comment_content":"ä¸çŸ¥é“è€å¸ˆè¿˜ä¼šä¸ä¼šå›å¤é—®é¢˜ï¼š<br>b+æ ‘ç´¢å¼•ç»“æ„çš„å±‚æ¬¡å’Œè¡¨æ•°æ®é‡çš„å…³ç³»æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿä¹Ÿå°±æ˜¯è¯´15ä¸‡çš„æ•°æ®é‡æ˜¯ä¸‰å±‚ç»“æ„ï¼Ÿè¾¾åˆ°å¤šå°‘æ•°æ®é‡æ˜¯å››å±‚æ¬¡ï¼Ÿ<br>ä¸€èˆ¬åœ¨çº¿æœåŠ¡ä¸­ä¸€ä¸ªè¡¨çš„æ•°æ®é‡ä¸€èˆ¬å¤šå¤§åˆé€‚ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443480,"discussion_content":"ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ Nå±‚æ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œå°±å¢åŠ ä¸€å±‚æ¥æ”¾ã€‚\n\nè¿™ä¸ªè¡Œä¸ºæ˜¯ç”±é¡µåˆ†è£‚è§¦å‘çš„\nåœ¨çº¿æœåŠ¡æœ€å¥½ä¸è¦è®©ç´¢å¼•æ ‘è¶…è¿‡4å±‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553420542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1312918,"avatar":"https://static001.geekbang.org/account/avatar/00/14/08/96/231fdd9e.jpg","nickname":"æœªçŸ¥","note":"","ucode":"DB389CEBEEE9E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387603,"discussion_content":"â€œæœ€å¥½ä¸è®©è¶…è¿‡4å±‚â€\næ€ä¹ˆè®©ä¸è¶…è¿‡4å±‚å‘¢ï¼Ÿå†…å­˜ä¹Ÿä¸å˜çš„æƒ…å†µä¸‹ï¼Œè®©ç´¢å¼•å°ä¸€ç‚¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628298082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1312918,"avatar":"https://static001.geekbang.org/account/avatar/00/14/08/96/231fdd9e.jpg","nickname":"æœªçŸ¥","note":"","ucode":"DB389CEBEEE9E1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559031,"discussion_content":"å¯ä»¥è€ƒè™‘æŠŠç´¢å¼•å­—æ®µç±»å‹å’Œé•¿åº¦ç»†åŒ–ä¸€ä¸‹ï¼Œä½¿ç”¨æœ€åˆé€‚å¾—å­—æ®µç±»å‹ï¼Œè®©æ¯ä¸ªpageé¡µä¸­å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…é¡µåˆ†è£‚çš„æ›´å¤šï¼Œè¿›è€Œé¿å…ç´¢å¼•æ ‘æ›´æ·±","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1648568311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387603,"ip_address":""},"score":559031,"extra":""}]}]},{"had_liked":false,"id":127150,"user_name":"yhui","can_delete":false,"product_type":"c1","uid":1512714,"ip_address":"","ucode":"1AAAF47E41FFB8","user_header":"https://static001.geekbang.org/account/avatar/00/17/15/0a/c450e565.jpg","comment_is_top":false,"comment_ctime":1566569509,"is_pvip":false,"replies":[{"id":"47749","content":"ä½ å¯å¦æŠŠè¡¨ç»“æ„ã€æ’å…¥æ•°æ®è¯­å¥éƒ½è´´ä¸€ä¸‹ï¼Ÿ<br><br>å°±æ˜¯æœ‰æ²¡æœ‰ç¨³å®šçš„å¤ç°æ–¹æ³•ï¼ˆå¸¦ä¸ŠMySQLç‰ˆæœ¬å·ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1566953289,"ip_address":"","comment_id":127150,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23041405989","product_id":100020801,"comment_content":"æˆ‘çœŸçš„å¾ˆè¿«åˆ‡éœ€è¦ä½ çš„å¸®åŠ©ï¼Œæˆ‘æ˜¯å°æ¹¾äººï¼Œé‡åˆ°ä¸€ä¸ªå¾ˆç¥å¥‡çš„é—®é¢˜<br>where in a(1,2,3,5,7,8,9) and b in(3) and c in(1,2) order by id desc<br>æˆ‘å»ºäº†ä¸€ä¸ªabcè”åˆç´¢å¼•ï¼Œå‘ç°è¿™è¯­å¥å°½ç„¶æ²¡ç”¨ä¸Šè”åˆç´¢å¼• å¾ˆå¥‡æ€ªï¼Œiné‡Œåˆ ä¸€ä¸¤ä¸ªå€¼åˆèƒ½é€‰å¯¹ç´¢å¼•ï¼Œè¿™inæœ‰ä»€ä¹ˆè§„å¾‹ å¥¥ç§˜å—ï¼Ÿå¤šè°¢æŒ‡ç‚¹ï¼Œæˆ‘é‚€è¯·æˆ‘åŒäº‹éƒ½ä¹°äº†ä½ çš„è¯¾ç¨‹","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464342,"discussion_content":"ä½ å¯å¦æŠŠè¡¨ç»“æ„ã€æ’å…¥æ•°æ®è¯­å¥éƒ½è´´ä¸€ä¸‹ï¼Ÿ\n\nå°±æ˜¯æœ‰æ²¡æœ‰ç¨³å®šçš„å¤ç°æ–¹æ³•ï¼ˆå¸¦ä¸ŠMySQLç‰ˆæœ¬å·ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566953289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588581,"discussion_content":"è¿™ä¸ªè¯­å¥å°±ç­‰ä»·äº(a=1 and b=3 and c =1) or ..... ï¼›å¦‚æœèµ°ç´¢å¼•è¦èµ°å¤šæ¬¡æ•°æœç´¢ä¸”serverè¿˜éœ€è¦åšä¸€æ¬¡æ’åºï¼›æˆ‘æ€€ç–‘æ˜¯ä½ è¿™ä¸ªè¡¨çš„æ•°æ®é‡å¤ªå°äº†æ‰€ä»¥ä¼˜åŒ–å™¨è§‰å¾—ä¸å¦‚èµ°èšç°‡ç´¢å¼•çœå»æ’åºåˆ’ç®—ï¼›inå‡å»å‡ ä¸ªæ¡ä»¶ä½¿å¾—æ ‘æœç´¢æ¬¡æ•°å˜å°‘ï¼Œä¼˜åŒ–å™¨å°±è§‰å¾—åªéœ€è¦å°‘æ•°æ ‘æœç´¢å°±èƒ½å¾—åˆ°ç»“æœç‰ºç‰²ä¸€æ¬¡æ’åºåº”è¯¥æˆæœ¬ä¼šæ›´ä½æ‰€ä»¥åˆèµ°ç´¢å¼•äº†ï¼›èµ°ä¸èµ°ç´¢å¼•è·Ÿæ•°æ®é‡å¯†åˆ‡ç›¸å…³çš„ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯è´´å‡ºè¡¨æ•°æ®æ¯”è¾ƒå¥½å¾—å‡ºç»“è®º","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663857603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122559,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565424082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10155358674","product_id":100020801,"comment_content":"è¿™ç¯‡ç­”ç–‘å¾ˆå®ç”¨å‘€!ç¬¬ä¸€ä¸ªé—®é¢˜ä¹‹å‰ä¹Ÿå‘ç°æœ‰è¿™æ ·çš„ç°è±¡ï¼Œä¸è¿‡è§£é‡Šä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼Œä¸è¿‡æŒ‰ç…§è‡ªå·±æƒ³è¦çš„ä¹Ÿç®—ä½¿ç”¨å¯¹äº†left join ã€‚<br>æ„Ÿè°¢è€å¸ˆï¼Œä¸“æ æ¥è¿‘å°¾å£°ï¼Œç°åœ¨å›æƒ³ä¸€ä¸‹ï¼Œç¡®å®å¢åŠ äº†ä¸å°‘è§è¯†ï¼Œä¸è¿‡ç”±äºè®°å¿†ä¸å¤ªå¥½ï¼ŒåŠ ä¹‹æœ‰äº›çŸ¥è¯†æ¶ˆåŒ–çš„ä¸å¥½æœ‰äº›å·²ç»æ¨¡ç³Šå•¦ğŸ˜„<br>ç¬¬ä¸€éç»“æŸï¼Œå†æ¥ç¬¬äºŒéï¼ŒæŠŠå®éªŒéƒ½æ“ä½œæ“ä½œï¼Œåº”è¯¥ä¼šå¥½ä¸€äº›ã€‚<br>æ„Ÿè°¢ğŸ˜Š","like_count":2},{"had_liked":false,"id":330151,"user_name":"é˜¿ç”˜","can_delete":false,"product_type":"c1","uid":1057843,"ip_address":"","ucode":"BC93175B70E05D","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/33/bcf37f50.jpg","comment_is_top":false,"comment_ctime":1641817000,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5936784296","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹å¯¹äºinè¯­å¥å¯¼è‡´çš„SQLè¶…é•¿æœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿç‰¹åˆ«æ˜¯å¤šä¸ªinæœ‰and&#47;orå…³ç³»çš„æƒ…å†µã€‚","like_count":1},{"had_liked":false,"id":226223,"user_name":"ä¸€åªç‹¬ç«‹ç‰¹è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1473358,"ip_address":"","ucode":"52263607CCBE6F","user_header":"https://static001.geekbang.org/account/avatar/00/16/7b/4e/73a9deec.jpg","comment_is_top":false,"comment_ctime":1592006816,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5886974112","product_id":100020801,"comment_content":"é¡ºåºæ‰«æè¡¨bï¼Œå¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œåˆ¤æ–­joinæ¡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ï¼ˆa.f1=b.f1ï¼‰and(a.f1=1)ï¼‰æ˜¯å¦æ»¡è¶³...<br>è¿™é‡Œçš„   æ¡ä»¶ a.f1 = 1 æ˜¯è®¤çœŸçš„å—ï¼Ÿæ²¡æœ‰å†™é”™å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335594,"discussion_content":"æˆ‘è§‰å¾—å†™é”™äº†ï¼Œåº”è¯¥æ˜¯a.f2=b.f2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608228610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191516,"user_name":"Jie","can_delete":false,"product_type":"c1","uid":1045078,"ip_address":"","ucode":"AB94041E548FEB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/56/c39046c0.jpg","comment_is_top":false,"comment_ctime":1584778538,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879745834","product_id":100020801,"comment_content":"è¿™é‡Œå›¾2é‡Œé¢çš„joinæ¡ä»¶æ˜¯a.f1 = 1ï¼Œä¸æ˜¯ä¸Šé¢æ–‡å­—é‡Œçš„a.f2=b.f2å‘€ï¼Œæ˜¯å› ä¸ºç¼–è¾‘è¿‡äº†ä¹ˆï¼Ÿ","like_count":1},{"had_liked":false,"id":76390,"user_name":"Chris","can_delete":false,"product_type":"c1","uid":1132777,"ip_address":"","ucode":"82056BBE2E4488","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/e9/f7dba760.jpg","comment_is_top":false,"comment_ctime":1552581896,"is_pvip":false,"replies":[{"id":"27975","content":"çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆå¤–éƒ¨å·¥å…·åœ¨å·¥ä½œ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1552694756,"ip_address":"","comment_id":76390,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5847549192","product_id":100020801,"comment_content":"è¿™ä¸¤å¤©åœ¨çº¿ä¸Šé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒè¯¡å¼‚çš„äº‹æƒ…ï¼Œçªç„¶æœ‰å‡ åˆ†é’Ÿè¿ä¸ä¸ŠMySQLï¼Œé€šè¿‡erroræ—¥å¿—å’Œç›‘æ§çš„processlistæ˜¾ç¤ºï¼ŒMySQLæŠŠå¾ˆå¤šé“¾æ¥éƒ½killæ‰äº†ï¼Œä½†å¤„äºsleepçŠ¶æ€å’Œshow statusçš„è¯­å¥æ²¡æœ‰killï¼Œçœ‹ç›‘æ§çš„èµ„æºä½¿ç”¨æƒ…å†µä¸æ˜¯å¾ˆé«˜ï¼Œåªæ˜¯innodb rows readæŒ‡æ ‡ç‰¹åˆ«é«˜ï¼Œç°åœ¨å®Œå…¨æ˜¯æ²¡å¤´ç»ªäº†","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443286,"discussion_content":"çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆå¤–éƒ¨å·¥å…·åœ¨å·¥ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552694756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70059,"user_name":"é¾™æ–‡","can_delete":false,"product_type":"c1","uid":1303084,"ip_address":"","ucode":"D987E8F706FB1D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/2c/0d04f87b.jpg","comment_is_top":false,"comment_ctime":1550979376,"is_pvip":false,"replies":[{"id":"24995","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550998068,"ip_address":"","comment_id":70059,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845946672","product_id":100020801,"comment_content":"æ˜ç™½äº† è°¢è°¢è€å¸ˆï¼","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440419,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550998068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69820,"user_name":"é¾™æ–‡","can_delete":false,"product_type":"c1","uid":1303084,"ip_address":"","ucode":"D987E8F706FB1D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/2c/0d04f87b.jpg","comment_is_top":false,"comment_ctime":1550853646,"is_pvip":false,"replies":[{"id":"24875","content":"æœ‰çš„ï¼Œä½ çœ‹ä¸€ä¸‹ç¬¬40ç¯‡ â€œinsert å”¯ä¸€é”®å†²çªâ€è¿™ä¸€æ®µ<br><br>ps:æˆ‘å·²ç»ç¦»å¼€é˜¿é‡Œäº‘æŒºä¹…çš„äº† ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550886375,"ip_address":"","comment_id":69820,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845820942","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨ç¬¬21è®²æ±‚åŠ©äº†ä¸€ä¸ªæ­»é”é—®é¢˜ï¼Œå½“æ—¶ä½ å›å¤è¯´åé¢ä¼šè§£ç­”ï¼Œä¸è¿‡æˆ‘æµè§ˆäº†ä¸‹åç»­æ–‡ç« æ²¡æ‰¾åˆ°è§£ç­”ï¼Œæ‰€ä»¥å†æ¬¡æ±‚åŠ©ä¸‹ã€‚ps:ç”¨çš„é˜¿é‡Œäº‘çš„rds,æäº†å·¥å•æ²¡æ•ˆæœå•Š","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440301,"discussion_content":"æœ‰çš„ï¼Œä½ çœ‹ä¸€ä¸‹ç¬¬40ç¯‡ â€œinsert å”¯ä¸€é”®å†²çªâ€è¿™ä¸€æ®µ\n\nps:æˆ‘å·²ç»ç¦»å¼€é˜¿é‡Œäº‘æŒºä¹…çš„äº† ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550886375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69727,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1550820402,"is_pvip":false,"replies":[{"id":"24817","content":"è·Ÿè¿›å¾—å¾ˆå¿«å•Šå¤§å®¶ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550829708,"ip_address":"","comment_id":69727,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845787698","product_id":100020801,"comment_content":"è¿™ä¹ˆå¿«å°±è¦ç»“æŸï¼Œå¥½å¿«å•Š","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440247,"discussion_content":"è·Ÿè¿›å¾—å¾ˆå¿«å•Šå¤§å®¶ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550829708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69683,"user_name":"ä¸‡å‹‡","can_delete":false,"product_type":"c1","uid":1309092,"ip_address":"","ucode":"BC9E0918DF4516","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/a4/f0b92135.jpg","comment_is_top":false,"comment_ctime":1550808044,"is_pvip":false,"replies":[{"id":"24801","content":"å°±æ˜¯æˆ‘è¿™ç¯‡æœ«å°¾å»ºè®®çš„å‡ ç§å»ºè¡¨æ–¹æ³•,å°±æ˜¯å»ºç«‹è”ç³»äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550815616,"ip_address":"","comment_id":69683,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845775340","product_id":100020801,"comment_content":"æ„Ÿè°¢è€å¸ˆä¸Šä¸€æœŸçš„è§£ç­”ï¼Œè¿˜è¯·æ•™ä¸€ä¸ªåˆ†åŒºè¡¨çš„é—®é¢˜ï¼Œåˆ†åŒºè¡¨åˆ›å»ºçš„èšé›†ç´¢å¼•æ˜¯åˆ†åŒºæœ¬åœ°ç»´æŠ¤çš„å§ï¼Œä½†æ˜¯ä¸»é”®ç´¢å¼•è¦ä¿è¯å…¨å±€å”¯ä¸€æ€§ã€‚é‚£åˆ†åŒºå’Œä¸»é”®ç´¢å¼•ä¹‹é—´æ˜¯ä¸æ˜¯è¦å»ºç«‹ä¸€ç§å…³ç³»ï¼Ÿå¦å¤–åˆ†åŒºè¡¨å¦‚æœæˆ‘ä»¬åˆ›å»ºæ™®é€šç´¢å¼•ï¼ŒæŒ‰é“ç†å¯ä»¥åˆ†åŒºåˆ›å»ºçš„ï¼Œåˆ†åŒºç»´æŠ¤è‡ªå·±çš„æ™®é€šç´¢å¼•ï¼Œå„åˆ†åŒºä¹‹é—´äº’ä¸å½±å“ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440224,"discussion_content":"å°±æ˜¯æˆ‘è¿™ç¯‡æœ«å°¾å»ºè®®çš„å‡ ç§å»ºè¡¨æ–¹æ³•,å°±æ˜¯å»ºç«‹è”ç³»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550815616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360427,"user_name":"çŸ¥","can_delete":false,"product_type":"c1","uid":1963248,"ip_address":"å››å·","ucode":"E59EE92519086B","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f4/f0/0cea836f.jpg","comment_is_top":false,"comment_ctime":1666572493,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666572493","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœæ˜¯åŒMæ¶æ„çš„è¯ï¼Œä½¿ç”¨binlogæ ¼å¼ä¸ºstatmentæˆ–è€…rowçš„è¯å¦‚æœè‡ªå¢ä¸»é”®æƒ…å†µä¸‹ï¼Œä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡æ•°æ®çš„idä¸ä¸€è‡´é—®é¢˜ã€‚<br><br>ä¸»åº“aå…ˆè‡ªå¢åˆ°ä¸»é”®ä¸º2ï¼Œè¿˜æ²¡æ¥å¾—åŠå‘ç»™ä»åº“bï¼Œæ­¤æ—¶bå†™å…¥äº†æ–°çš„æ•°æ®ï¼Œå¯¼è‡´abåº“çš„ä¸»é”®ä¸ä¸€è‡´ã€‚","like_count":0},{"had_liked":false,"id":359468,"user_name":"æ™¨é£ç ´æ™“","can_delete":false,"product_type":"c1","uid":1321464,"ip_address":"å¹¿ä¸œ","ucode":"F2BC46428A97B5","user_header":"https://static001.geekbang.org/account/avatar/00/14/29/f8/561c5be1.jpg","comment_is_top":false,"comment_ctime":1665562139,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665562139","product_id":100020801,"comment_content":"åœ¨è¯­ä¹‰ç›¸åŒï¼Œæœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼šgroup byå’Œdistinctéƒ½èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ•ˆç‡ç›¸åŒã€‚<br>åœ¨è¯­ä¹‰ç›¸åŒï¼Œæ— ç´¢å¼•çš„æƒ…å†µä¸‹ï¼šdistinctæ•ˆç‡é«˜äºgroup byã€‚åŸå› æ˜¯distinct å’Œ group byéƒ½ä¼šè¿›è¡Œåˆ†ç»„æ“ä½œï¼Œä½†group byå¯èƒ½ä¼šè¿›è¡Œæ’åºï¼Œè§¦å‘filesortï¼Œå¯¼è‡´sqlæ‰§è¡Œæ•ˆç‡ä½ä¸‹ã€‚","like_count":0},{"had_liked":false,"id":339650,"user_name":"sotondolphin","can_delete":false,"product_type":"c1","uid":1307088,"ip_address":"","ucode":"42198CE9B201FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QZBHia4nXtspEaRibpmMIMVcDA2HHkNypfvVJ2IllQC3FeFCt7f9iaHW7z5yQ4lcB79ibJwia6tNtpuFroufntMhc2g/132","comment_is_top":false,"comment_ctime":1648270520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648270520","product_id":100020801,"comment_content":"å†™sqlè¯­å¥ä¸ä½†è¦è€ƒè™‘æ€§èƒ½ä¹Ÿè¦æŠŠè¯­å¥çš„æ„æ€æ˜ç¡®è¡¨è¾¾å‡ºæ¥ï¼Œå¦‚æœä½ æƒ³å»é‡ï¼Œå°±ç›´æ¥ç”¨distcintï¼Œä¸éœ€è¦æä¸€ä¸ªgroup byæ¥åšåŒæ ·çš„äº‹æƒ…","like_count":0},{"had_liked":false,"id":322626,"user_name":"ç­‰é£æ¥","can_delete":false,"product_type":"c1","uid":1350677,"ip_address":"","ucode":"5B7FF74A51F534","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/15/719f1f44.jpg","comment_is_top":false,"comment_ctime":1637504724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637504724","product_id":100020801,"comment_content":"join æ–¹é¢æˆ‘è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ ä¸‰è¡¨ä»¥ä¸Šçš„joinè¯­å¥ï¼ŒåŒæ—¶ç”¨ä¸Šlefe join å’Œright join å¦‚ä½•åˆ¤æ–­è¿™ä¸ªé©±åŠ¨è¡¨","like_count":0},{"had_liked":false,"id":304381,"user_name":"lleft","can_delete":false,"product_type":"c1","uid":1970443,"ip_address":"","ucode":"D573EB509455AE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","comment_is_top":false,"comment_ctime":1627377663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627377663","product_id":100020801,"comment_content":"æœ¬æ–‡ä¸­è¯´çš„å¤‡åº“è‡ªå¢å€¼çš„é—®é¢˜æ—¶binlog_format=statementæ—¶ï¼Œç”±äºbinlogä¸­ä¼šè®°å½•è‡ªå¢ä¸»é”®çš„å€¼é€šè¿‡set INSERT_IDã€‚é‚£ä¹ˆ39ç¯‡æ–‡ç« ä¸­çš„è‡ªå¢é”çš„ä¼˜åŒ–ç¯èŠ‚å´è¯´â€œè¿™æ˜¯å› ä¸ºåŸåº“ session B çš„ insert è¯­å¥ï¼Œç”Ÿæˆçš„ id ä¸è¿ç»­ã€‚è¿™ä¸ªä¸è¿ç»­çš„ idï¼Œç”¨ statement æ ¼å¼çš„ binlog æ¥ä¸²è¡Œæ‰§è¡Œï¼Œæ˜¯æ‰§è¡Œä¸å‡ºæ¥çš„ã€‚â€ï¼Œæ„Ÿè§‰æœ‰ç‚¹çŸ›ç›¾å‘€ï¼Œæ—¢ç„¶è®°å½•äº†è‡ªå¢å€¼é‚£ä»åº“åº”è¯¥é¡ºåºæ‰§è¡Œbinlogè‡ªå¢å€¼åº”è¯¥ä¹Ÿæ˜¯ä¸è¿ç»­çš„å‘€ï¼Ÿå°±ä¸ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´äº†å‘€","like_count":0},{"had_liked":false,"id":303524,"user_name":"é˜¿Oã€ä¸æ‹½","can_delete":false,"product_type":"c1","uid":1331034,"ip_address":"","ucode":"3F3C089F6D354A","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/5a/b38785b5.jpg","comment_is_top":false,"comment_ctime":1626845723,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626845723","product_id":100020801,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œinnodbå¼•æ“ä¸‹ï¼ŒäºŒçº§ç´¢å¼•ä¹Ÿä¼šå­˜å‚¨ä¸»é”®çš„å€¼ï¼Œé‚£ä¹ˆç›¸åŒçš„äºŒçº§ç´¢å¼•çš„å€¼çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•çš„é¡ºåºæ˜¯æŒ‰ç…§ä¸»é”®å‡åºçš„å—ï¼Ÿ<br><br>æ¯”å¦‚æœ‰ä¸ªè¡¨userï¼Œä¸»é”®æ˜¯idï¼ŒäºŒçº§ç´¢å¼•æ˜¯usernameï¼Œé‚£ä¹ˆselect id from user where username=&#39;zhangsan&#39; limit 10ï¼Œä¸€å®šæ˜¯è¿”å›çš„usernameä¸ºzhangsançš„è®°å½•é‡Œé¢idæœ€å°çš„å‰10ä¸ªidå—ï¼Ÿ æˆ‘éªŒè¯ä¸‹æ¥ï¼Œç»“æœæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æ²¡æœ‰çœ‹åˆ°ç›¸å…³æ–‡æ¡£ä½è¯ï¼Œå¦‚æœå¯ä»¥ä½œä¸ºä¾æ®çš„è¯ï¼Œå°±å¯ä»¥ç”¨è¦†ç›–ç´¢å¼•æŠŠæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„idæ‹‰å–å‡ºæ¥ï¼Œè€Œä¸”å¯ä»¥åˆ©ç”¨ç´¢å¼•å†…éƒ¨çš„è‡ªç„¶æ’åºï¼Œä¸ä¼šå‡ºç°æ·±åˆ†é¡µçš„é—®é¢˜","like_count":0},{"had_liked":false,"id":301197,"user_name":"é™ˆå­é˜³","can_delete":false,"product_type":"c1","uid":1372279,"ip_address":"","ucode":"306262779A17A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/f0/77/8f0863c8.jpg","comment_is_top":false,"comment_ctime":1625572130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625572130","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Ÿè¯·æ•™ä¸€ä¸ªjoinçš„é—®é¢˜ã€‚<br>æˆ‘æœ‰ä¸¤å¼ è¡¨ï¼Œæ¯å¼ éƒ½æœ‰20wè¡Œçš„æ•°æ®éœ€è¦è”åˆæŸ¥è¯¢ã€‚åˆšå¼€å§‹æˆ‘æ˜¯a left join bã€‚å‘ç°å±…ç„¶éœ€è¦2sçš„æ—¶é—´ï¼Œæˆ‘çŒœæµ‹å¯èƒ½æ˜¯å› ä¸ºè”åˆçš„åˆ—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æ”¹ä¸ºa left join (select id from b)ã€‚å‘ç°å±…ç„¶è¿˜æ˜¯2sï¼Œæ²¡æœ‰ä»»ä½•æ”¹å–„ã€‚è€Œä¸”éƒ½ä½¿ç”¨åˆ°äº†ç´¢å¼•ã€‚<br>è¯·é—®è€å¸ˆé—®é¢˜å¯èƒ½å‡ºåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ","like_count":0},{"had_liked":false,"id":278425,"user_name":"å°ç™½ç™½ä¸ç™½","can_delete":false,"product_type":"c1","uid":1757797,"ip_address":"","ucode":"270EC3A197A8D9","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d2/65/79d89c77.jpg","comment_is_top":false,"comment_ctime":1612939174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612939174","product_id":100020801,"comment_content":"æ—¢ç„¶ SET INSERT_ID è¯­å¥æ˜¯å›ºå®šè·Ÿåœ¨ insert è¯­å¥ä¹‹å‰çš„ï¼Œé‚£ä¹ˆæ‰¹é‡æ’å…¥çš„è‡ªå¢é”åœ¨statementæ¨¡å¼ä¸‹æ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨æ¨¡å¼1,ä½¿ç”¨æ¨¡å¼2å°±å¯ä»¥è§£å†³ä¸»ä»ä¸»é”®ä¸ä¸€è‡´äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":253853,"user_name":"Boyka Ou","can_delete":false,"product_type":"c1","uid":1068451,"ip_address":"","ucode":"87264DD6983580","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/a3/3b922cdf.jpg","comment_is_top":false,"comment_ctime":1602919536,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602919536","product_id":100020801,"comment_content":"æ—å“¥ï¼Œå­¦å®Œäº†ä½ çš„ä¸“é¢˜ï¼Œæƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å…¬å¸MySQLåˆ†è¡¨å¤§å°é™åˆ¶åœ¨1000ä¸‡å†…ï¼ŒåŒæ ·çš„ç¡¬ä»¶oracleå•è¡¨æ•°æ®åº”è¯¥ä¸æ­¢1000ä¸‡å§ï¼Œæœ‰äººè¯´æ˜¯æ¶æ„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“åº•å±‚åŸå› æ˜¯ä»€ä¹ˆï¼Œæœ‰ç©ºçš„è¯ï¼Œä½ å¯ä»¥å‘Šè¯‰æˆ‘ä¸ºä»€ä¹ˆå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":243261,"user_name":"ç”Ÿå‘½ç»ƒä¹ ç”Ÿ","can_delete":false,"product_type":"c1","uid":1108066,"ip_address":"","ucode":"BCDA541EE0DB54","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/62/2333d77a.jpg","comment_is_top":false,"comment_ctime":1598004219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598004219","product_id":100020801,"comment_content":"è¿™æ˜¯æˆ‘æ‰€å­¦ä¹ çš„æ‰€æœ‰è¯¾ç¨‹ï¼Œè®²è§£æœ€ç»†å¿ƒã€è€å¿ƒã€åˆ°ä½çš„ä¸€ä½ã€‚ç‚¹ä¸ªèµï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","like_count":0},{"had_liked":false,"id":221847,"user_name":"ç™¾é‡Œ","can_delete":false,"product_type":"c1","uid":1212873,"ip_address":"","ucode":"2CE96129AA7F78","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/c9/9194612b.jpg","comment_is_top":false,"comment_ctime":1590622124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590622124","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œæˆ‘æ‰§è¡Œä¸€å¤©updateè¯­å¥ï¼Œæ›´æ–°4ä¸ªå­—æ®µï¼Œç»“æœåªæ›´æ–°æˆåŠŸä¸€ä¸ªå­—æ®µã€‚<br>è¯­å¥update user set status=2, type=3,  expried=&#39;2020-06-28&#39;, pass=&#39;2020-05-28&#39; where id =5ã€‚å¾ˆæ™®é€šçš„è¯­å¥ï¼Œä¸è¿‡æ›´æ–°çš„å­—æ®µåŒ…å«åœ¨è”åˆç´¢å¼•é‡Œã€‚<br>ä½†æ˜¯æ‰§è¡Œå¤šæ¬¡ï¼Œå°±å¯ä»¥æ‰§è¡ŒæˆåŠŸã€‚<br>ä»¥ä¸Šæ˜¯æ”¾åœ¨golangä»£ç é‡Œæ‰§è¡Œçš„ï¼Œmysqlå‘½ä»¤è¡Œæ‰§è¡Œæ²¡é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":206970,"user_name":"HE","can_delete":false,"product_type":"c1","uid":1179059,"ip_address":"","ucode":"649DC80EB4943A","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/b3/53a7fc71.jpg","comment_is_top":false,"comment_ctime":1586965809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586965809","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸€ä¸‹ï¼Œå…³äºä¸‹é¢â€œé¾™æ–‡â€åŒå­¦æåˆ°çš„insertå¤±è´¥æ­»é”çš„é—®é¢˜ï¼Œæˆ‘åœ¨8.0.19ç‰ˆæœ¬æµ‹è¯•ä¸Šé¢çš„æƒ…å†µï¼Œrcå’Œrræ¨¡å¼éƒ½ä¸ä¼šé€ æˆæ­»é”äº†ï¼Œæ˜¯mysqlæœ‰åšä»€ä¹ˆä¼˜åŒ–ä¹ˆ..","like_count":0},{"had_liked":false,"id":206831,"user_name":"TheWinds","can_delete":false,"product_type":"c1","uid":1503401,"ip_address":"","ucode":"69857C2D95C9D2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIIb51lMmiapEjy5oDdXvV6dd8JqIibrtWJfRI1zjEHiawpicaFXASzceUgocIel3CUSGG1hh8xy723Hg/132","comment_is_top":false,"comment_ctime":1586942828,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586942828","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆMySQLçš„textå­—æ®µä¸å…è®¸è®¾ç½®default valueå‘¢","like_count":0},{"had_liked":false,"id":196075,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1585233767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585233767","product_id":100020801,"comment_content":"Q2çš„æ‰§è¡Œè®¡åˆ’é‡Œï¼Œä¸ºä»€ä¹ˆtable bçš„rowsæ˜¯1å•Š","like_count":0},{"had_liked":false,"id":176512,"user_name":"papaw","can_delete":false,"product_type":"c1","uid":1724942,"ip_address":"","ucode":"B88E39F6B907F8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/52/0e/d875c2c5.jpg","comment_is_top":false,"comment_ctime":1581077454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581077454","product_id":100020801,"comment_content":"è€å¸ˆï¼Œåˆ†åº“åˆ†è¡¨å’Œä¸€ä¸»å¤šä» è¯¥å¦‚ä½•æŠ‰æ‹©å‘¢ï¼Ÿæœ€å¥½ç»“åˆåœºæ™¯åˆ†æä¸‹","like_count":0},{"had_liked":false,"id":176508,"user_name":"papaw","can_delete":false,"product_type":"c1","uid":1724942,"ip_address":"","ucode":"B88E39F6B907F8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/52/0e/d875c2c5.jpg","comment_is_top":false,"comment_ctime":1581075179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581075179","product_id":100020801,"comment_content":"è€å¸ˆï¼Œmysqlé‡Œinå’Œor æœ‰æ€§èƒ½å·®åˆ«å—ï¼ŸæŸ¥è¯¢åŸç†æ˜¯ä¸€æ ·çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":154867,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1574583973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574583973","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ è®²äº†Innodbå’ŒMemoryå¼•æ“ä½¿ç”¨åœºæ™¯ï¼Œé‚£MyIsamå¼•æ“å‘¢ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°å‘¢ï¼Œæ„Ÿè§‰åº”ç”¨åœºæ™¯å¾ˆå°‘å•Š","like_count":0},{"had_liked":false,"id":141835,"user_name":"Omer","can_delete":false,"product_type":"c1","uid":1676246,"ip_address":"","ucode":"8EE3E531313265","user_header":"https://static001.geekbang.org/account/avatar/00/19/93/d6/040e4965.jpg","comment_is_top":false,"comment_ctime":1571234320,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571234320","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æ˜¯ä¸€å‘˜å¼€å‘åŒå­¦ï¼Œæˆ‘èŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´ç–¯ç‹‚ä»ä½ è¿™è¾¹è¡¥ä¹ Mysqlçš„çŸ¥è¯†ï¼Œæ”¶è·å¾ˆå¤§ï¼Œé¦–å…ˆå¾ˆæ„Ÿè°¢ä½ èŠ±äº†é‚£ä¹ˆå¤šç²¾åŠ›ä¼ æˆåŠŸåŠ›ï¼ï¼ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªå¾ˆç–‘æƒ‘çš„é—®é¢˜æƒ³è¦è¯·æ•™ä¸€ä¸‹ï¼Œå¸Œæœ›ä½ çœ‹åˆ°èƒ½å›å¤ï¼Œæ¯•ç«Ÿæˆ‘ç®—æ˜¯å¾ˆæ™šæ‰æ¥çš„å­¦ç”Ÿäº†~~å°±æ˜¯æˆ‘çœ‹é«˜æ€§èƒ½mysqlé‡Œé¢è¯´çš„ï¼šåœ¨å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹, InnoBDåªæŸ¥æ‰¾ç‰ˆæœ¬æ—©äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œ,è¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œ,è¦ä¹ˆæ˜¯åœ¨äº‹åŠ¡å¼€å§‹å‰å·²ç»å­˜åœ¨,è¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ã€‚ ä½†æ˜¯åˆçœ‹åˆ°é‡Œé¢è¯´ï¼Œå¿«ç…§è¯»æ˜¯è¯»æ‰§è¡Œselectæ—¶å€™å·²ç»å…¨éƒ¨æäº¤è¿‡çš„æœ€æ–°çš„æ•°æ®ï¼Œè¿™é‡Œéš¾é“ä¸å°±è·Ÿå‰é¢é‚£å¥é‚£ä¸ªäº‹åŠ¡ç‰ˆæœ¬çš„äº’ç›¸å†²çªäº†å—ï¼Ÿï¼Ÿ è€Œä¸”æˆ‘è‡ªå·±ä¹Ÿæµ‹è¯•äº†ï¼Œæˆ‘å¼€å¯ä¸€ä¸ªäº‹åŠ¡Aï¼Œå…ˆsleep5ç§’ï¼Œå†æ‰§è¡Œå…¨è¡¨æŸ¥è¯¢ï¼Œç„¶ååœ¨äº‹åŠ¡AæŸ¥è¯¢å‰æ‰§è¡Œå¦ä¸€ä¸ªäº‹åŠ¡Bï¼Œå¾€é‡Œé¢æ’å…¥äº†æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘çœ‹åˆ°äº‹åŠ¡AæŸ¥å‡ºæ¥çš„æ•°æ®æ˜¯æœ‰äº‹åŠ¡Bæ–°æ’å…¥çš„ï¼Œè¿™å°±è®©æˆ‘å¯¹å‰é¢é‚£å¥äº‹åŠ¡ç‰ˆæœ¬äº§ç”Ÿäº†å¾ˆå¤§çš„ç–‘æƒ‘ - -ã€‚å¾ˆæ™šäº†ï¼Œä¸çŸ¥é“è€å¸ˆæ‚¨è¿˜ä¼šä¸ä¼šçœ‹åˆ°ï¼Œå¸Œæœ›ä½ çœ‹åˆ°äº†èƒ½å¸®æˆ‘è§£ç­”ä¸€ä¸‹ï¼Œå†æ¬¡æ„Ÿè°¢ä½ è€å¿ƒä¼ æ•™äº†é‚£ä¹ˆå¤šç¯‡å¥½æ–‡~~","like_count":0,"discussions":[{"author":{"id":1997293,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","nickname":"é›ªã®é›«Â·é›¨ã®éŸ³","note":"","ucode":"0693DA3939A321","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275113,"discussion_content":"å› ä¸ºå¦‚æœä¸ä½¿ç”¨start transaction with consistentå¼€å¯äº‹åŠ¡çš„è¯ï¼ŒçœŸæ­£å¼€å¯ä¸€è‡´æ€§è§†å›¾æ˜¯åˆ°ç¬¬ä¸€ä¸ªæ‰§è¡Œinnodbè¡¨çš„è¯­å¥æ‰å¼€å§‹çš„ã€‚åœ¨ä½ è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¯åœ¨äº‹åŠ¡Bæ‰§è¡Œæ’å…¥æ•°æ®æ“ä½œä¹‹åï¼Œäº‹åŠ¡Aæ‰å¼€å¯ä¸€è‡´æ€§è§†å›¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590665975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142044,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6d/1c/10d5c280.jpg","nickname":"å“ˆå“ˆ","note":"","ucode":"F4673CC2238BAE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164015,"discussion_content":" start transaction with consistentè¿™ä¹ˆå¼€å¯å°±å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581137900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139895,"user_name":"eden.tang","can_delete":false,"product_type":"c1","uid":1306947,"ip_address":"","ucode":"F7E09865C9D2B2","user_header":"","comment_is_top":false,"comment_ctime":1570761393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570761393","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ã€‚<br>å®é™…è¡Œæ’é‡åæ˜¯13ä¸‡ï¼Œè€Œcount(distinct)ç¡®æœ‰38ä¸‡ä¸ºä½•<br><br>38ä¸‡<br>select count(distinct(tid)) from tb_logs  where ch=&#39;a&#39;<br><br>13ä¸‡<br>select count(*) from (select distinct(tid) from tb_logs where ch=&#39;a&#39;) t<br><br>chä¸ºå…¶å®ƒçš„æ•°æ®éƒ½æ­£å¸¸ï¼Œå‡ å¹´ä¸‹æ¥ä¹Ÿä¸€ç›´æ­£å¸¸ï¼Œä»Šå¤©çªç„¶æ•°æ®å¼‚å¸¸ï¼Œå°±ch=&#39;a&#39;è¿™ä¸ªæ¡ä»¶çš„æ•°æ®ã€‚","like_count":0},{"had_liked":false,"id":139891,"user_name":"eden.tang","can_delete":false,"product_type":"c1","uid":1306947,"ip_address":"","ucode":"F7E09865C9D2B2","user_header":"","comment_is_top":false,"comment_ctime":1570761239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570761239","product_id":100020801,"comment_content":"å®é™…è¡Œæ’é‡åæ˜¯13ä¸‡ï¼Œè€Œcount(distinct)ç¡®æœ‰38ä¸‡ä¸ºä½•<br><br>38ä¸‡<br>select count(distinct(tid)) from tb_logs <br><br>13ä¸‡<br>select count(*) from (select distinct(tid) from tb_logs) t","like_count":0},{"had_liked":false,"id":136739,"user_name":"ç‹æ–¯æ‹‰","can_delete":false,"product_type":"c1","uid":1593957,"ip_address":"","ucode":"D00DD3CE432189","user_header":"https://static001.geekbang.org/account/avatar/00/18/52/65/320eccb3.jpg","comment_is_top":false,"comment_ctime":1569501232,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569501232","product_id":100020801,"comment_content":"ç–‘é—®ï¼šè„é¡µåˆ°åº•æ€ä¹ˆåˆ·<br>1. æ ¹æ®redo logä¸Šçš„lsnå’Œcheckpoint lsnæ¯”è¾ƒåˆ·ï¼Ÿ<br>2. æ ¹æ®flush-list æŠŠæœ€è€çš„è„é¡µåˆ·å…¥ç£ç›˜ï¼Œè¿™æ ·å°±å¯¹åº”çš„redologå°±å¯ä»¥è¢«è¦†ç›–æ‰äº†ã€‚<br><br>çŒœæµ‹ï¼š<br><br>å¯èƒ½1ï¼š<br>1. åœ¨crashçš„æ—¶å€™ä¼šç”¨1ï¼Œ å› ä¸ºé‡å¯æ—¶å†…å­˜æ•°æ®ä¸å­˜åœ¨æ‰€ä»¥è¦é€šè¿‡redoæ¢å¤<br>2. æ­£å¸¸çš„åˆ·è„é¡µä¼šç”¨2ï¼Œé€šè¿‡flush-liståˆ·è„é¡µæ›´å¿«ã€‚åˆ¤æ–­é‡åšæ—¥å¿—æ˜¯å¦å¯è¦†ç›–ï¼Œå°±æ‰¾å¯¹åº”çš„é¡µå†…å®¹ä¸Šçš„lsnå¯¹æ¯”å³å¯ã€‚<br><br>å¯èƒ½2ï¼š<br>å…¶å®éƒ½æ˜¯1è¿™ç§æ–¹å¼ï¼Œflush liståªæ˜¯ä¸ºäº†redoæ›´å®¹æ˜“æ‰¾è„é¡µï¼Ÿ","like_count":0},{"had_liked":false,"id":136738,"user_name":"ç‹æ–¯æ‹‰","can_delete":false,"product_type":"c1","uid":1593957,"ip_address":"","ucode":"D00DD3CE432189","user_header":"https://static001.geekbang.org/account/avatar/00/18/52/65/320eccb3.jpg","comment_is_top":false,"comment_ctime":1569501186,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569501186","product_id":100020801,"comment_content":"è€å¸ˆåŒå­¦ä»¬å¥½ï¼Œæ±‚æ•™ä¸ªé—®é¢˜<br>ç–‘é—®ï¼šè„é¡µåˆ°åº•æ€ä¹ˆåˆ·<br>1. æ ¹æ®redo logä¸Šçš„lsnå’Œcheckpoint lsnæ¯”è¾ƒåˆ·ï¼Ÿ<br>2. æ ¹æ®flush-list æŠŠæœ€è€çš„è„é¡µåˆ·å…¥ç£ç›˜ï¼Œè¿™æ ·å°±å¯¹åº”çš„redologå°±å¯ä»¥è¢«è¦†ç›–æ‰äº†ã€‚<br><br>çŒœæµ‹ï¼š<br><br>å¯èƒ½1ï¼š<br>1. åœ¨crashçš„æ—¶å€™ä¼šç”¨1ï¼Œ å› ä¸ºé‡å¯æ—¶å†…å­˜æ•°æ®ä¸å­˜åœ¨æ‰€ä»¥è¦é€šè¿‡redoæ¢å¤<br>2. æ­£å¸¸çš„åˆ·è„é¡µä¼šç”¨2ï¼Œé€šè¿‡flush-liståˆ·è„é¡µæ›´å¿«ã€‚åˆ¤æ–­é‡åšæ—¥å¿—æ˜¯å¦å¯è¦†ç›–ï¼Œå°±æ‰¾å¯¹åº”çš„é¡µå†…å®¹ä¸Šçš„lsnå¯¹æ¯”å³å¯ã€‚<br><br>å¯èƒ½2ï¼š<br>å…¶å®éƒ½æ˜¯1è¿™ç§æ–¹å¼ï¼Œflush liståªæ˜¯ä¸ºäº†redoæ›´å®¹æ˜“æ‰¾è„é¡µï¼Ÿ","like_count":0},{"had_liked":false,"id":132640,"user_name":"sunshineling","can_delete":false,"product_type":"c1","uid":1543564,"ip_address":"","ucode":"7E8E03C8568112","user_header":"https://static001.geekbang.org/account/avatar/00/17/8d/8c/ec40964b.jpg","comment_is_top":false,"comment_ctime":1568182841,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1568182841","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆCould not commit JDBC transaction mysqlè¿™ä¸ªé—®é¢˜ä¸€èˆ¬æ˜¯ä»€ä¹ˆæƒ…å†µå¼•å‘çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":122030,"user_name":"ä¸€è¢‹å¤§è™¾","can_delete":false,"product_type":"c1","uid":1469366,"ip_address":"","ucode":"8E4FED94405475","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wwDhoIeIqMZiaLLCLmCsuiaeEt7rEQMqdTVjjTicic0Pz9HHpgzboaia1hxu3H0IHovqEa6pJ8e1UQn1gqeUr3ibIdrA/132","comment_is_top":false,"comment_ctime":1565272308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565272308","product_id":100020801,"comment_content":"è€å¸ˆ ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨show warningsä¸€ç›´æ²¡æœ‰ç»“æœå‘¢ï¼ï¼Ÿ","like_count":0},{"had_liked":false,"id":107031,"user_name":"é™ˆæ‰¬é¸¿","can_delete":false,"product_type":"c1","uid":1284708,"ip_address":"","ucode":"DDDA8493CDC83C","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/64/eea9aa33.jpg","comment_is_top":false,"comment_ctime":1561441645,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561441645","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œç°åœ¨mysql8å·²ç»æ²¡æœ‰frmæ–‡ä»¶ï¼Œä¸€æ—¦æ•°æ®å­—å…¸ä¸¢å¤±ï¼Œæ²¡æœ‰è¡¨ç»“æ„å°±æ— æ³•æ¢å¤å•ä¸ªibdæ–‡ä»¶çš„æ•°æ®ï¼Œå¦‚ä½•é€šè¿‡mysql8çš„ sdiæ–‡ä»¶ç”Ÿæˆåˆ›å»ºè¡¨çš„ddlè¯­å¥ã€‚","like_count":0},{"had_liked":false,"id":95462,"user_name":"400ç£…","can_delete":false,"product_type":"c1","uid":1022396,"ip_address":"","ucode":"3339DC49F2431C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/bc/c1266b7e.jpg","comment_is_top":false,"comment_ctime":1558059182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558059182","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹æˆ‘ä»Šå¤©é‡åˆ°çš„è¯¡å¼‚çš„ Table &#39;&#39; doesn&#39;t exist é—®é¢˜<br><br>é—®é¢˜æè¿°ï¼š<br><br>åœ¨2019å¹´5æœˆ16æ—¥ä¸‹åˆæˆ‘åœ¨æˆ‘å¸å¼€å‘ç¯å¢ƒçš„æ•°æ®åº“ (192.168.1.81:3306) ä¸Šåˆ›å»ºäº†ä¸€å¼ è¡¨ v_home.verification_code  ã€‚æ’å…¥äº†181æ¡æ•°æ®ã€‚ä¸€ç›´åˆ°5æœˆ16æ—¥18ç‚¹30å·¦å³ä¸‹ç­è¡¨ä¾ç„¶å¯ç”¨ã€‚<br><br>5æœˆ17æ—¥æ—©ä¸Šï¼ˆè¿™æœŸé—´ç»è¿‡ä¸€æ¬¡ç”µè„‘çš„é‡å¯ï¼‰ï¼Œ æˆ‘å†æ¬¡è¿è¡Œæ˜¨å¤©çš„æµ‹è¯•ä»£ç ï¼Œ å‘ç°æŠ¥é”™ &quot;Table &#39;v_home.verification_code&#39; doesn&#39;t exist&quot; ã€‚ åŒæ—¶ä½¿ç”¨ navicat å®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“ï¼Œå‘ç°è¡¨ç¡®å®ä¸å­˜åœ¨äº†ã€‚<br><br>è¿™æ—¶æˆ‘æ€€ç–‘æ˜¯å¦æ˜¯å…¶ä»–åŒäº‹è¯¯åˆ é™¤äº†ï¼Œ æ‰€ä»¥åœ¨å›¢é˜Ÿä¸­è¯¢é—®ï¼Œ ç»åé¦ˆå‘ç°å¤§éƒ¨åˆ†åŒäº‹é‚£é‡Œæ˜¯å¯ä»¥çœ‹åˆ°è¿™å¼ è¡¨ v_home.verification_code çš„ï¼Œè¿™é‡Œé¢åŒ…æ‹¬ä½¿ç”¨Macä»¥åŠWindowsç³»ç»Ÿï¼Œæœ‰é‡æ–°å¼€æœºè¿æ¥çš„ï¼Œä¹Ÿæœ‰ä»æ˜¨å¤©è¿æ¥ä¸€ç›´æœªå…³æœºçš„ï¼› ç„¶è€Œè¿˜æœ‰ä¸€ä¸ªä½¿ç”¨Linuxæ“ä½œç³»ç»Ÿçš„åŒäº‹ï¼Œ ä¹Ÿæ²¡æœ‰è¿™å¼ è¡¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Macï¼›è€Œä¸”æˆ‘ä»¬å›¢é˜Ÿæ‰€æœ‰åŒäº‹ä½¿ç”¨çš„IPç«¯å£ä»¥åŠè´¦å·å¯†ç éƒ½æ˜¯ä¸€è‡´çš„ã€‚ ä¹Ÿå°±æ˜¯åœ¨åŒä¸€æ—¶é—´ï¼Œ åŒä¸€ä¸ªæ•°æ®åº“ï¼Œåœ¨ä¸åŒè¿æ¥ä¸Šå‡ºç°äº†ä¸ä¸€è‡´çš„æ•°æ®ä¿¡æ¯ã€‚<br><br>ä¸ºäº†è¿›ä¸€æ­¥ç¡®è®¤ï¼Œ æˆ‘é€€å‡ºnavicatå®¢æˆ·ç«¯ï¼Œå‘ç°é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œ ç„¶åæˆ‘å†æ¬¡è¿è¡ŒSQLåˆ›å»ºäº†è¿™å¼ è¡¨ï¼Œæ²¡æœ‰æ’å…¥ä»»ä½•æ•°æ®ã€‚ è¿™æ—¶æˆ‘çš„å®¢æˆ·ç«¯ç•Œé¢ä¸Šå‡ºç°äº†è¿™å¼ ç©ºè¡¨ï¼Œ åŒæ—¶å‡ºç°çš„æƒ…å†µæ˜¯ ä»¥å‰å­˜åœ¨è¿™å¼ è¡¨çš„åŒäº‹é‚£é‡Œæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œ è€Œä½¿ç”¨Linuxæ“ä½œç³»ç»Ÿçš„é‚£ä½åŒäº‹ä¹Ÿå‡ºç°äº†è¿™å¼ ç©ºè¡¨ï¼Œæ˜¾ç¤ºåˆ›å»ºæ—¶é—´å°±æ˜¯æˆ‘åˆšåˆšæ“ä½œçš„æ—¶é—´ã€‚<br><br>ç„¶åå†è¿›ä¸€æ­¥ï¼Œæˆ‘é‡æ–°å…³æœºå†å¯åŠ¨æˆ‘çš„ç”µè„‘ï¼Œ è¿æ¥ä¸Šæ•°æ®åº“ï¼Œå‘ç°æ˜¨æ™šçš„é‚£å¼ è¡¨å’Œè®°å½•éƒ½æ¢å¤äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘åˆšåˆšåˆ›å»ºè¡¨çš„æ“ä½œåƒæ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚ ä¸ºäº†ç¡®è®¤æ˜¯å¦æ˜¯å®¢æˆ·ç«¯è½¯ä»¶çš„é—®é¢˜ï¼Œ æˆ‘è®©é‚£ä½ä¾ç„¶èƒ½é‡ç°çš„ä½¿ç”¨Linuxæ“ä½œç³»ç»Ÿçš„åŒäº‹ä½¿ç”¨mysqlå‘½ä»¤è¡Œè¿æ¥æ•°æ®åº“ï¼Œ è¿æ¥åå‘ç°è·Ÿä½¿ç”¨ Navicat å®¢æˆ·ç«¯ä¸€æ ·ï¼Œæ˜¾ç¤ºçš„è¿˜æ˜¯æˆ‘åˆšåˆšåˆ›å»ºçš„ç©ºè¡¨ã€‚<br><br>é’ˆå¯¹æ­¤é—®é¢˜æˆ‘æ²¡æœ‰ä¸€ç‚¹å¤´ç»ªï¼Œè™½ç„¶é€šè¿‡é‡å¯ç”µè„‘æ¢å¤äº†ä½¿ç”¨ï¼Œ ä½†æ˜¯å®ƒæ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Œ æ˜¯å¦æœ‰å…¶ä»–äººé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸€æ— æ‰€çŸ¥ã€‚","like_count":0},{"had_liked":false,"id":80183,"user_name":"Invictus_CD îŠ","can_delete":false,"product_type":"c1","uid":1302400,"ip_address":"","ucode":"4B6BCCE71032D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/80/f5d91c66.jpg","comment_is_top":false,"comment_ctime":1553614433,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553614433","product_id":100020801,"comment_content":"è‡ªå¢idè¿˜æœ‰ä¸€ä¸ªbugã€‚å°±æ˜¯replace intoçš„æ—¶å€™ï¼Œå‡å¦‚å”¯ä¸€ç´¢å¼•æœ‰å†²çªï¼Œä¸»åº“ä¼ è¿‡æ¥çš„binlogé‡Œæ˜¯updateï¼Œä½†æ˜¯åœ¨ä¸»åº“æ“ä½œçš„æ—¶å€™æ˜¯å…ˆinsertï¼Œè¿™æ ·ä¸»ä»çš„è‡ªå¢idé‚£ä¸ªå€¼å°±ä¼šä¸ä¸€æ ·ã€‚è¿™æ—¶å€™ä¸»ä»åˆ‡æ¢ä¹Ÿä¼šæœ‰å†²çªçš„é—®é¢˜ã€‚ä¸è¿‡è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡ä¸å¤§ï¼Œé™¤éä¸€ç›´replaceæˆ–è€…åˆšå‡ºç°ä¸€ä¸ªreplaceæ•°æ®åº“å°±ä¸»ä»åˆ‡æ¢äº†ã€‚","like_count":0},{"had_liked":false,"id":79038,"user_name":"ä¸æƒ‘ing","can_delete":false,"product_type":"c1","uid":1207079,"ip_address":"","ucode":"AF04E417D38027","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/27/8c964e52.jpg","comment_is_top":false,"comment_ctime":1553328809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553328809","product_id":100020801,"comment_content":"æ‚¨å¥½ï¼Œæˆ‘çœ‹ç•™è¨€åŒº@é¾™æ–‡ é—®äº†ä¸ªé—®é¢˜<br>1.rcéš”ç¦»çº§åˆ«ä¸‹å¯¹å”¯ä¸€é”®çš„insertä¹Ÿä¼šåŠ next-key lockå—ï¼Ÿ<br>æ‚¨çš„å›ç­”æ˜¯ï¼šä¼š<br><br>æˆ‘çš„é—®é¢˜ï¼š æˆ‘è®°å¾—å‰é¢å“ªç¯‡æ–‡ç« é‡Œæåˆ°rcéš”ç¦»çº§åˆ«æ˜¯æ²¡æœ‰gap lockçš„ä¹ˆï¼Œæˆ‘ä¹Ÿç½‘ä¸Šç”¨ç™¾åº¦ç¡®è®¤äº†ä¸€ä¸‹æ˜¯æ²¡gap lockçš„ï¼Œå‰é¢æ–‡ç« è¿˜æåˆ° next-key lock =gap lock + record lock    ï¼Œæ‰€ä»¥è¿™ä¸ªå›ç­”æˆ‘çœ‹çš„æœ‰ç‚¹æ‡µï¼Œæ˜¯æˆ‘å“ªé‡Œç†è§£é”™äº†ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":71942,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1551490914,"is_pvip":false,"replies":[{"id":"26061","content":"è¦çœ‹ç´¢å¼•å“ˆ<br>å¦‚æœbä¸Šçš„ç´¢å¼•åªæœ‰f1 æ˜¯çš„ï¼Œ<br>å¦‚æœbä¸Šçš„ç´¢å¼•æ˜¯(f1,f2)ï¼Œå°±ä¸¤ä¸ªä¸€èµ·å…³è”äº†<br>ã€å’±ä»¬æ–‡ä¸­è¯´äº†ï¼Œè¿™ä¸ªè¯­å¥ä¼šè¢«è½¬æˆæ™®é€šjoinå“¦ã€‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551499780,"ip_address":"","comment_id":71942,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551490914","product_id":100020801,"comment_content":"select * from a left join b on(a.f1=b.f1) where (a.f2=b.f2);<br>è€å¸ˆï¼Œè¿™ä¸ªè¯­å¥æ˜¯å¦å¯ä»¥ç†è§£ä¸º:å…ˆæŒ‰ç…§onåé¢çš„æ¡ä»¶å…³è”ï¼Œè·å–ç»“æœé›†ï¼Œç„¶åå¯¹ç»“æœé›†ç”¨whereæ¡ä»¶è¿›è¡ŒäºŒæ¬¡è¿‡æ»¤ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441405,"discussion_content":"è¦çœ‹ç´¢å¼•å“ˆ\nå¦‚æœbä¸Šçš„ç´¢å¼•åªæœ‰f1 æ˜¯çš„ï¼Œ\nå¦‚æœbä¸Šçš„ç´¢å¼•æ˜¯(f1,f2)ï¼Œå°±ä¸¤ä¸ªä¸€èµ·å…³è”äº†\nã€å’±ä»¬æ–‡ä¸­è¯´äº†ï¼Œè¿™ä¸ªè¯­å¥ä¼šè¢«è½¬æˆæ™®é€šjoinå“¦ã€‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551499780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71877,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1551458497,"is_pvip":false,"replies":[{"id":"26051","content":"ä¸æ˜¯ï¼Œå¦‚æœæœ‰where,å¹¶ä¸”whereé‡Œé¢æœ‰ç”¨åˆ°b.f1æˆ–b.f2, é‚£å°±è¦æ±‚ç»“æœé›†é‡Œé¢æ²¡æœ‰è¿™äº›nullçš„è¡Œã€‚<br><br>å°±æ˜¯è¯´where a.f2=b.f2çš„æ„æ€æ˜¯<br>Where (a.f2 is not null) and (b.f2 is not null) and (a.f2 =b.f2)","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551490012,"ip_address":"","comment_id":71877,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551458497","product_id":100020801,"comment_content":"æŠŠè¡¨ a çš„å†…å®¹è¯»å…¥ join_buffer ä¸­ã€‚å› ä¸ºæ˜¯ select * ï¼Œæ‰€ä»¥å­—æ®µ f1 å’Œ f2 éƒ½è¢«æ”¾å…¥ join_buffer äº†ã€‚<br><br>é¡ºåºæ‰«æè¡¨ bï¼Œå¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œåˆ¤æ–­ join æ¡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ a.f1=b.f1 and a.f2=b.f2) æ˜¯å¦æ»¡è¶³ï¼Œæ»¡è¶³æ¡ä»¶çš„è®°å½•, ä½œä¸ºç»“æœé›†çš„ä¸€è¡Œè¿”å›ã€‚å¦‚æœè¯­å¥ä¸­æœ‰ where å­å¥ï¼Œéœ€è¦å…ˆåˆ¤æ–­ where éƒ¨åˆ†æ»¡è¶³æ¡ä»¶åï¼Œå†è¿”å›ã€‚<br><br>è¡¨ b æ‰«æå®Œæˆåï¼Œå¯¹äºæ²¡æœ‰è¢«åŒ¹é…çš„è¡¨ a çš„è¡Œï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯ (1,1)ã€(2,2) è¿™ä¸¤è¡Œï¼‰ï¼ŒæŠŠå‰©ä½™å­—æ®µè¡¥ä¸Š NULLï¼Œå†æ”¾å…¥ç»“æœé›†ä¸­ã€‚<br><br>æ˜¯å¦å¯ä»¥ç†è§£ä¸º:å‡å¦‚æœ‰whereæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸æ»¡è¶³onæ¡ä»¶çš„è¡Œï¼Œå†å»è¿‡æ»¤whereæ¡ä»¶ï¼Œæ»¡è¶³å°±è¿”å›ï¼›å¯¹äºä¸æ»¡è¶³onæ¡ä»¶çš„è¡Œï¼Œbå­—æ®µè¡¥Nullåè¿”å›ï¼Œä¸éœ€è¦å†è¿‡æ»¤whereæ¡ä»¶","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441374,"discussion_content":"ä¸æ˜¯ï¼Œå¦‚æœæœ‰where,å¹¶ä¸”whereé‡Œé¢æœ‰ç”¨åˆ°b.f1æˆ–b.f2, é‚£å°±è¦æ±‚ç»“æœé›†é‡Œé¢æ²¡æœ‰è¿™äº›nullçš„è¡Œã€‚\n\nå°±æ˜¯è¯´where a.f2=b.f2çš„æ„æ€æ˜¯\nWhere (a.f2 is not null) and (b.f2 is not null) and (a.f2 =b.f2)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551490012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70103,"user_name":"PYH","can_delete":false,"product_type":"c1","uid":1394235,"ip_address":"","ucode":"F20A402BE905D3","user_header":"https://static001.geekbang.org/account/avatar/00/15/46/3b/a9f28ff9.jpg","comment_is_top":false,"comment_ctime":1550995778,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550995778","product_id":100020801,"comment_content":"ä½ å¥½ æˆ‘æƒ³é—®ä¸€ä¸‹mysqlèƒ½å®ç°oracleçš„æ‹‰é“¾è¡¨ä¹ˆã€‚å¦‚æœèƒ½å‰ææ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":70057,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1550978996,"is_pvip":false,"replies":[{"id":"24996","content":"1. å•ç‹¬ä¸€ä¸ªupdateï¼Œä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡<br>2. å•ç‹¬ä¸€ä¸ªselectï¼Œä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡<br>3. innodbè¡¨ï¼Œå¢åˆ æ”¹æŸ¥éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550998270,"ip_address":"","comment_id":70057,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550978996","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæƒ³è¯·é—®ä¸‹åœ¨innodbå¼•æ“rréš”ç¦»çº§åˆ«ä¸‹ï¼Œå•ç‹¬çš„ä¸€æ¡updateè¯­å¥æ˜¯ä¸æ˜¯é»˜è®¤å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡(åœ¨æ‰§è¡Œupdateå‰ä¸è¾“å…¥begin)ï¼Œè€Œå•ç‹¬çš„ä¸€æ¡selectè¯­å¥æ˜¯ä¸æ˜¯ä¸ä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå“ªæ€•æ˜¯&quot;å½“å‰è¯»&quot;ä¹Ÿä¸ä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ›´è¿›ä¸€æ­¥ï¼Œæ˜¯ä¸æ˜¯å¯¹è¡¨çš„å¢åˆ æ”¹æ“ä½œé»˜è®¤éƒ½ä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼ŸğŸ¤”","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440418,"discussion_content":"1. å•ç‹¬ä¸€ä¸ªupdateï¼Œä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡\n2. å•ç‹¬ä¸€ä¸ªselectï¼Œä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡\n3. innodbè¡¨ï¼Œå¢åˆ æ”¹æŸ¥éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550998270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69921,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1550905954,"is_pvip":false,"replies":[{"id":"24916","content":"æ˜¯çš„<br><br>å¦‚æœåŸæ¥å°±æœ‰whereï¼Œè¯´æ˜åŸæ¥å…¶å®ä¹Ÿä¸ç”¨left join ğŸ˜†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550936819,"ip_address":"","comment_id":69921,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1550905954","product_id":100020801,"comment_content":"å•§å•§ï¼Œ åŸæ¥æˆ‘å†™çš„ left join ä¸€ç›´éƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œæ¯æ¬¡åé¢éƒ½ä¼šåŠ ä¸Š where ï¼Œ è¿˜ä¸€ç›´ä»¥ä¸ºå·¦é¢æ˜¯é©±åŠ¨è¡¨ ã€‚æ—¢ç„¶å®é™…ä¸Š left join ååŠ ä¸Š where çš„è¯ï¼Œ è‚¯å®šä¼šè¢«ä¼˜åŒ–å™¨ä¼˜åŒ–æˆ join  where çš„å½¢å¼ï¼Œ é‚£æ˜¯å¦ä¸‹æ¬¡å†™ left join   ..where çš„æ—¶å€™ï¼Œ ä¸å¦‚ç›´æ¥å†™æˆ join .. where ï¼Œçœå»ä¼˜åŒ–å™¨è‡ªå·±å»ä¼˜åŒ–ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ç¨ç¨å¿«äº›","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440356,"discussion_content":"æ˜¯çš„\n\nå¦‚æœåŸæ¥å°±æœ‰whereï¼Œè¯´æ˜åŸæ¥å…¶å®ä¹Ÿä¸ç”¨left join ğŸ˜†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550936819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1443773,"avatar":"https://static001.geekbang.org/account/avatar/00/16/07/bd/00a3f6aa.jpg","nickname":"Huan","note":"","ucode":"24F1657DDEC117","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":152617,"discussion_content":"æˆ‘è§‰å¾—è¿™ä¸ªä¹Ÿè¦åˆ†å…·ä½“æƒ…å†µçš„å§ã€‚æ¯”å¦‚è¯´æœ‰a,bè¡¨ï¼Œæˆ‘éœ€è¦å¾—åˆ° a,bè¡¨å…³è”ä¸ä¸Šçš„é‚£äº›æ•°æ®ï¼Œå¦‚:\nselect  a.*  from  a  left  join  b  on  a.id = b.id\nwhere  b.id  is  null.\n\nå¦‚æœæ”¹å†™æˆ  inner  joinï¼Œé‚£å°±æ— æ³•å¾—åˆ°ä¸Šè¿°è¯´çš„ç»“æœäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579966063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69763,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1550832152,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550832152","product_id":100020801,"comment_content":"è®¢é˜…äº†å¥½å‡ ä¸ªä¸“æ  mysqlè¿™ä¸ªæ˜¯æœ€ä¼˜å…ˆçœ‹çš„ï¼Œåˆ«çš„ä¸“æ å¯ä»¥è·Ÿä¸ä¸Š è¿™ä¸ªå¿…é¡»è·Ÿä¸Šï¼Œè€å¸ˆè®¡åˆ’å‡ºç¬¬äºŒå­£å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":69711,"user_name":"ä¸€å¤§åªğŸ˜´","can_delete":false,"product_type":"c1","uid":1310960,"ip_address":"","ucode":"92F3D2B7F63568","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/f0/08409e78.jpg","comment_is_top":false,"comment_ctime":1550815988,"is_pvip":false,"replies":[{"id":"24878","content":"å¾ˆå¥½çš„éªŒè¯<br>ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè®²åˆ°å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550889531,"ip_address":"","comment_id":69711,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550815988","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘åšäº†ä¸‹è¯¾åé¢˜çš„å®éªŒï¼Œä¸æ¸…æ¥šä¸ºå•¥è®¾è®¡ï¼Œä¸‹é¢è®°å½•äº†æˆ‘çœ‹åˆ°çš„ç°è±¡ï¼Œä¸ä¸€å®šå¯¹å“ˆã€‚<br>ä½¿ç”¨start transaction with consistent snapshot;<br>åŒä¸€ä¸ªsessionçš„å¼€å¯å¿«ç…§äº‹åŠ¡åçš„trx_idå¾ˆå¤§å¹¶ä¸”ä¸€è‡´ï¼Œå¦‚æœå…³é—­è¿™ä¸ªsessionï¼Œå¼€å¯å¦ä¸€ä¸ªsessionä½¿ç”¨snapshotï¼Œåˆå§‹å€¼çš„trx_idä¹Ÿæ˜¯ä¸ä¹‹å‰çš„sessionä¸€è‡´çš„ã€‚<br><br>å¦‚æœå†æ‰“å¼€ç¬¬äºŒä¸ªsessionä½¿ç”¨snapshotï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢trxè¡¨ï¼Œä¼šå‘ç°ç¬¬ä¸€ä¸ªsessionè¿˜æ˜¯å¾ˆå¤§åªï¼Œç¬¬äºŒä¸ªæ‰“å¼€çš„trx_idä¼šå¾ˆå°ï¼Œä½†è¿™ä¸ªå¾ˆå°çš„trx_idæ˜¯ç¬¬ä¸€ä¸ªæ‰“å¼€çš„sessionçš„æœ€å°trx_id+1ã€‚è¿™æ—¶ï¼Œå¦‚æœcommitï¼›å†start snapshotï¼Œé‚£ä¹ˆå°†ä¼šå‡ºç°ä¸€ä¸ªæ¯”ç¬¬ä¸€ä¸ªsessionè¿˜è¦å¤§ä¸€ç‚¹çš„trx_idï¼Œæˆ‘å¼€äº†å‡ ä¸ªsessionï¼Œç¬¬ä¸€æ¬¡æ˜¯+24ï¼Œéšåéƒ½æ˜¯åŠ 12ï¼Œå¦‚ä¸‹å›¾ï¼š<br>+---------------------+-----------------+<br>| trx_mysql_thread_id | trx_id          |<br>+---------------------+-----------------+<br>|               14672 | 421259275839776 |<br>|               14661 | 421259275838864 |<br>|               14645 | 421259275837952 |<br>|               14587 | 421259275837040 |<br>|               14578 | 421259275835216 |<br>+---------------------+-----------------+<br><br>åªæœ‰ä¸€ä¸ªsessionæ‰“å¼€snapshotæƒ…å†µä¸‹ï¼Œtrx_idåœ¨commitåä¼šå¢åŠ ï¼Œä½†åœ¨äº‹åŠ¡å†…ä¸ä¼šçœ‹åˆ°trx_idå¢åŠ ,ä½¿ç”¨select,select lock in share modeä¸ä¼šå¯¼è‡´trx_idå¢åŠ ã€‚<br><br>ä¸€ä¸ªddlæ“ä½œåº”è¯¥æ˜¯  trx_id+18<br><br>ä¸åœ¨äº‹åŠ¡å†…çš„dmlæ“ä½œï¼š<br>delete 1æ¡  trx_id+2  <br>delete å¤šæ¡ trx_id+6<br>insert 1æ¡ trx_id+1<br>insert values (),()...å¤šæ¡trx_id+5<br>update 1æ¡  trx_id+2<br>update å¤šæ¡ trx_id+6<br><br>snapshotäº‹åŠ¡å†…çš„dmlæ“ä½œï¼š<br>äº‹åŠ¡å†…å…ˆselect * from tb for update;å†delete from tb where id=xxx;è¿™æ ·çš„delete trx_id+1<br>å¦‚æœæ˜¯äº‹åŠ¡å†…ç›´æ¥delete from tb where id=xxx;æˆ–delete from tb;è¿™æ ·çš„delete trx_id+6<br><br>äº‹åŠ¡å†…update 1æ¡ trx_id+2ï¼Œå¦‚æœå…ˆselect * fom tb for update;å†update 1æ¡ï¼Œæœ‰æ—¶å€™æ˜¯trx_id+2ï¼Œæœ‰æ—¶å€™æ˜¯trx_id+5<br>äº‹åŠ¡å†…update å¤šæ¡ trx_id+6<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440238,"discussion_content":"å¾ˆå¥½çš„éªŒè¯\nä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè®²åˆ°å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550889531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69658,"user_name":"å…‹åŠ³å¾·","can_delete":false,"product_type":"c1","uid":1323851,"ip_address":"","ucode":"F94AD5C3D607AE","user_header":"https://static001.geekbang.org/account/avatar/00/14/33/4b/71905da9.jpg","comment_is_top":false,"comment_ctime":1550803444,"is_pvip":false,"replies":[{"id":"24803","content":"1.å¯¹,å°±æ˜¯æ‰«æè¿™ä¸ªç´¢å¼•çš„è¿‡ç¨‹ä¸­,ç¬¬ä¸€ä¸ªç¢°åˆ°çš„å€¼<br>2. å¯ä»¥,ä½ ç”¨force indexè¯•è¯•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550815714,"ip_address":"","comment_id":69658,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550803444","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œå¦‚æœgroup byç”¨ä½œæ•°æ®å»é‡ï¼Œæ ¹æ®æ–‡ç« ä¸­æè¿°çš„ï¼Œæµç¨‹2ä¼šéå†è¡¨ä¾æ¬¡æ’å…¥è¿›ä¸´æ—¶è¡¨ã€‚<br>æˆ‘ç†è§£çš„éå†è¡¨æ˜¯é€šè¿‡æ‰«æä¸»é”®ç´¢å¼•æ¥åšçš„ï¼Œå› æ­¤åŒä¸€ç»„çš„è®°å½•åªä¼šç•™ä¸‹ä¸»é”®å€¼æœ€å°çš„é‚£ä¸ªï¼Œæ˜¯å¦æ­£ç¡®ï¼Ÿ<br>èƒ½å¦é€šè¿‡æ‰«æå…¶ä»–ç´¢å¼•ï¼Œæ¥è¾¾åˆ°å»é‡åçš„è®°å½•ä¸æŒ‰ç…§ä¸»é”®å€¼æ¥å†³å®šï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440211,"discussion_content":"1.å¯¹,å°±æ˜¯æ‰«æè¿™ä¸ªç´¢å¼•çš„è¿‡ç¨‹ä¸­,ç¬¬ä¸€ä¸ªç¢°åˆ°çš„å€¼\n2. å¯ä»¥,ä½ ç”¨force indexè¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550815714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69632,"user_name":"å­Ÿæ™“å†¬","can_delete":false,"product_type":"c1","uid":1204266,"ip_address":"","ucode":"DFFE8A3863F881","user_header":"https://static001.geekbang.org/account/avatar/00/12/60/2a/9e0ba423.jpg","comment_is_top":false,"comment_ctime":1550799896,"is_pvip":false,"replies":[{"id":"24734","content":"çœ‹ä¸‹13ç¯‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550804239,"ip_address":"","comment_id":69632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550799896","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¿™æ˜¯è¡¨ç»“æ„<br>CREATE TABLE `graph` (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `name` varchar(20) NOT NULL COMMENT &#39;æŠ¥è¡¨åç§°&#39;,<br>  `ip` varchar(50) DEFAULT NULL COMMENT &#39;æŠ¥è¡¨æ¥è‡ªäºå“ªå°cat-clientæœºå™¨ip, NULLè¡¨ç¤ºåˆå¹¶åŒdomainæ‰€æœ‰ip&#39;,<br>  `domain` varchar(50) NOT NULL COMMENT &#39;æŠ¥è¡¨å¤„ç†çš„Domainä¿¡æ¯&#39;,<br>  `period` datetime NOT NULL COMMENT &#39;æŠ¥è¡¨æ—¶é—´æ®µ&#39;,<br>  `type` tinyint(4) NOT NULL COMMENT &#39;æŠ¥è¡¨æ•°æ®æ ¼å¼, 1&#47;xml, 2&#47;json, 3&#47;csv, é»˜è®¤3&#39;,<br>  `detail_content` mediumtext NOT NULL COMMENT &#39;è¯¦ç»†ç»˜å›¾å†…å®¹&#39;,<br>  `summary_content` mediumtext NOT NULL COMMENT &#39;æ¦‚è¦ç»˜å›¾å†…å®¹&#39;,<br>  `creation_date` datetime NOT NULL COMMENT &#39;æŠ¥è¡¨åˆ›å»ºæ—¶é—´&#39;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `graph_period_ip_domain_name` (`period`,`ip`,`domain`,`name`)<br>) ENGINE=InnoDB AUTO_INCREMENT=5913464 DEFAULT CHARSET=utf8 COMMENT=&#39;å°æ—¶å›¾è¡¨æ›²çº¿&#39;<br>å·®ä¸å¤šæœ‰600ä¸‡æ¡è®°å½•ï¼Œæˆ‘åˆ é™¤å®Œ550ä¸‡æ¡è®°å½•åï¼Œæ‰§è¡Œselect min(id) from graph;æ¯”è¾ƒæ…¢<br>root@localhost:cat 09:01:06&gt; select min(id) from graph;<br>+---------+<br>| min(id) |<br>+---------+<br>| 5513664 |<br>+---------+<br>1 row in set (8.27 sec)<br>ç„¶ååšäº†alter table graph ENGINE=InnoDB;è¿™ä¸ªæ“ä½œåï¼Œå°±å¿«äº†ï¼Œ<br>root@localhost:cat 09:06:20&gt; select min(id) from graph;<br>+---------+<br>| min(id) |<br>+---------+<br>| 5513664 |<br>+---------+<br>1 row in set (0.00 sec)<br>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘€ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440196,"discussion_content":"çœ‹ä¸‹13ç¯‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550804239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}