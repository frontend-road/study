{"id":319371,"title":"38 | 所有权：Move与析构","content":"<p><strong>课件及Demo下载链接</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Rust\">https://gitee.com/geektime-geekbang/geektime-Rust</a></p>","comments":[{"had_liked":false,"id":385388,"user_name":"Tommy","can_delete":false,"product_type":"c3","uid":1389146,"ip_address":"北京","ucode":"3596169C5BEA1A","user_header":"https://static001.geekbang.org/account/avatar/00/15/32/5a/d875b9d6.jpg","comment_is_top":false,"comment_ctime":1702545967,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"会不会隐式变成了函数调用了？","like_count":0},{"had_liked":false,"id":385387,"user_name":"Tommy","can_delete":false,"product_type":"c3","uid":1389146,"ip_address":"北京","ucode":"3596169C5BEA1A","user_header":"https://static001.geekbang.org/account/avatar/00/15/32/5a/d875b9d6.jpg","comment_is_top":false,"comment_ctime":1702545468,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"如果不绑定变量，\nPrintDrop(“A”）；\nPrintDrop(“B”）；\n我试了一下，为什么释放顺序是A-B，没有想明白","like_count":0},{"had_liked":false,"id":348339,"user_name":"菌临天下","can_delete":false,"product_type":"c3","uid":2189067,"ip_address":"","ucode":"F49E70D579D59E","user_header":"https://static001.geekbang.org/account/avatar/00/21/67/0b/6ba9e8bb.jpg","comment_is_top":false,"comment_ctime":1655005099,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"这里我也没懂~字幕也打错了，析构打成虚构","like_count":0,"discussions":[{"author":{"id":2189067,"avatar":"https://static001.geekbang.org/account/avatar/00/21/67/0b/6ba9e8bb.jpg","nickname":"菌临天下","note":"","ucode":"F49E70D579D59E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575664,"discussion_content":"调换一下zyx的顺序\n#![allow(unused)]\nstruct PrintDrop(&amp;&#39;static str);\n\nimpl Drop for PrintDrop {\n    fn drop(&amp;mut self) {\n        println!(&#34;{}&#34;, self.0);\n    }\n}\n\nfn main() {\n    let y = PrintDrop(&#34;y&#34;);\n    let x = PrintDrop(&#34;x&#34;);\n    let z = PrintDrop(&#34;z&#34;);\n    let closure = move || {\n        {let z_ref = &amp;z;}\n        x; z; y;\n    };\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655012254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301056,"user_name":"Spida H","can_delete":false,"product_type":"c3","uid":2682250,"ip_address":"","ucode":"972F901481B8E3","user_header":"https://static001.geekbang.org/account/avatar/00/28/ed/8a/1ced6211.jpg","comment_is_top":false,"comment_ctime":1625498929,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100060601,"comment_content":"let z_ref = &amp;z，为啥是z先析构才是z_ref，先析构z的话，z所指向的内存区域应该就无法访问？z_ref不就是一个悬垂指针？按照我的理解不应该是先析构z_ref，再析构z才不会造成悬垂指针吗？","like_count":0,"discussions":[{"author":{"id":1809168,"avatar":"","nickname":"Geek_7c4953","note":"","ucode":"359745D4725D4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383005,"discussion_content":"z_ref 是闭包内声明的，闭包执行时才有这个变量。而析构闭包之后，闭包就不能再执行了，不会有悬垂指针的问题。这里老师自己把自己绕进去了。。。\n这个例子要比较的是xyz之间的顺序，从闭包的代码来看，z就是先捕获的，当然先析构，跟上一个例子没有差别。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1625821487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2681475,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ea/83/41fd29d5.jpg","nickname":"青青子衿","note":"","ucode":"887B99AFA7B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809168,"avatar":"","nickname":"Geek_7c4953","note":"","ucode":"359745D4725D4F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384090,"discussion_content":"我认为你说得对, 老师说法有问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626359203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":383005,"ip_address":"","group_id":0},"score":384090,"extra":""}]}]}]}