{"id":238388,"title":"10 | å¦‚ä½•æå‡TCPå››æ¬¡æŒ¥æ‰‹çš„æ€§èƒ½ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»‹ç»äº†å»ºç«‹è¿æ¥æ—¶çš„ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™ä¸€èŠ‚è¯¾å†æ¥çœ‹å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥æ—¶ï¼Œå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ã€‚</p><p>closeå’Œshutdownå‡½æ•°éƒ½å¯ä»¥å…³é—­è¿æ¥ï¼Œä½†è¿™ä¸¤ç§æ–¹å¼å…³é—­çš„è¿æ¥ï¼Œä¸åªåŠŸèƒ½ä¸Šæœ‰å·®å¼‚ï¼Œæ§åˆ¶å®ƒä»¬çš„Linuxå‚æ•°ä¹Ÿä¸ç›¸åŒã€‚closeå‡½æ•°ä¼šè®©è¿æ¥å˜ä¸ºå­¤å„¿è¿æ¥ï¼Œshutdownå‡½æ•°åˆ™å…è®¸åœ¨åŠå…³é—­çš„è¿æ¥ä¸Šé•¿æ—¶é—´ä¼ è¾“æ•°æ®ã€‚TCPä¹‹æ‰€ä»¥å…·å¤‡è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯å…¨åŒå·¥åè®®ï¼Œä½†è¿™ä¹Ÿé€ æˆå››æ¬¡æŒ¥æ‰‹éå¸¸å¤æ‚ã€‚</p><p>å››æ¬¡æŒ¥æ‰‹ä¸­ä½ å¯ä»¥ç”¨netstatå‘½ä»¤è§‚å¯Ÿåˆ°6ç§çŠ¶æ€ã€‚å…¶ä¸­ï¼Œä½ å¤šåŠçœ‹åˆ°è¿‡TIME_WAITçŠ¶æ€ã€‚ç½‘ä¸Šæœ‰è®¸å¤šæ–‡ç« ä»‹ç»æ€æ ·å‡å°‘TIME_WAITçŠ¶æ€è¿æ¥çš„æ•°é‡ï¼Œä¹Ÿæœ‰æ–‡ç« è¯´TIME_WAITçŠ¶æ€æ˜¯å¿…ä¸å¯å°‘ã€ä¸èƒ½ä¼˜åŒ–æ‰çš„ã€‚è¿™ä¸¤ç§çœ‹ä¼¼è‡ªç›¸çŸ›ç›¾çš„è§‚ç‚¹ä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œå°±åœ¨äºä¼˜åŒ–è¿æ¥å…³é—­æ—¶ï¼Œä¸èƒ½ä»…åŸºäºä¸»æœºç«¯çš„è§†è§’ï¼Œè¿˜å¿…é¡»ç«™åœ¨æ•´ä¸ªç½‘ç»œçš„å±‚æ¬¡ä¸Šï¼Œæ‰èƒ½ç»™å‡ºæ­£ç¡®çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>Linuxä¸ºå››æ¬¡æŒ¥æ‰‹æä¾›äº†å¾ˆå¤šæ§åˆ¶å‚æ•°ï¼Œæœ‰äº›å‚æ•°çš„åç§°ä¸å«ä¹‰å¹¶ä¸ç›¸ç¬¦ã€‚ä¾‹å¦‚tcp_orphan_retrieså‚æ•°ä¸­æœ‰orphanå­¤å„¿ï¼Œå´åŒæ—¶å¯¹éå­¤å„¿è¿æ¥ä¹Ÿç”Ÿæ•ˆã€‚è€Œä¸”ï¼Œé”™è¯¯åœ°é…ç½®è¿™äº›å‚æ•°ï¼Œä¸åªæ— æ³•é’ˆå¯¹é«˜å¹¶å‘åœºæ™¯æå‡æ€§èƒ½ï¼Œè¿˜ä¼šé™ä½èµ„æºçš„ä½¿ç”¨æ•ˆç‡ï¼Œç”šè‡³å¼•å‘æ•°æ®é”™è¯¯ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†åŸºäºå››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Œä»‹ç»Linuxä¸‹çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><h2>å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹</h2><p>ä½ æƒ³æ²¡æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œå…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºTCPä¸å…è®¸è¿æ¥å¤„äºåŠæ‰“å¼€çŠ¶æ€æ—¶å°±å•å‘ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥åœ¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼Œå…¶ä¸­ï¼ŒACKç”¨æ¥æ‰“å¼€å®¢æˆ·ç«¯çš„å‘é€é€šé“ï¼ŒSYNç”¨æ¥æ‰“å¼€æœåŠ¡å™¨çš„å‘é€é€šé“ã€‚è¿™æ ·ï¼ŒåŸæœ¬çš„å››æ¬¡æ¡æ‰‹å°±é™ä¸ºä¸‰æ¬¡æ¡æ‰‹äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/74/51/74ac4e70ef719f19270c08201fb53a51.png?wh=943*613\" alt=\"\"></p><p>ä½†æ˜¯å½“è¿æ¥å¤„äºåŠå…³é—­çŠ¶æ€æ—¶ï¼ŒTCPæ˜¯å…è®¸å•å‘ä¼ è¾“æ•°æ®çš„ã€‚ä¸ºä¾¿äºä¸‹æ–‡æè¿°ï¼Œ<strong>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå…ˆå…³é—­è¿æ¥çš„ä¸€æ–¹å«åšä¸»åŠ¨æ–¹ï¼Œåå…³é—­è¿æ¥çš„ä¸€æ–¹å«åšè¢«åŠ¨æ–¹ã€‚</strong>å½“ä¸»åŠ¨æ–¹å…³é—­è¿æ¥æ—¶ï¼Œè¢«åŠ¨æ–¹ä»ç„¶å¯ä»¥åœ¨ä¸è°ƒç”¨closeå‡½æ•°çš„çŠ¶æ€ä¸‹ï¼Œé•¿æ—¶é—´å‘é€æ•°æ®ï¼Œæ­¤æ—¶è¿æ¥å¤„äºåŠå…³é—­çŠ¶æ€ã€‚è¿™ä¸€ç‰¹æ€§æ˜¯TCPçš„åŒå‘é€šé“äº’ç›¸ç‹¬ç«‹æ‰€è‡´ï¼Œå´ä¹Ÿä½¿å¾—å…³é—­è¿æ¥å¿…é¡»é€šè¿‡å››æ¬¡æŒ¥æ‰‹æ‰èƒ½åšåˆ°ã€‚</p><p><strong>äº’è”ç½‘ä¸­å¾€å¾€æœåŠ¡å™¨æ‰æ˜¯ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹ã€‚</strong>è¿™æ˜¯å› ä¸ºï¼ŒHTTPæ¶ˆæ¯æ˜¯å•å‘ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨æ¥æ”¶å®Œè¯·æ±‚æ‰èƒ½ç”Ÿæˆå“åº”ï¼Œå‘é€å®Œå“åº”åå°±ä¼šç«‹åˆ»å…³é—­TCPè¿æ¥ï¼Œè¿™æ ·åŠæ—¶é‡Šæ”¾äº†èµ„æºï¼Œèƒ½å¤Ÿä¸ºæ›´å¤šçš„ç”¨æˆ·æœåŠ¡ã€‚</p><p>è¿™å°±ä½¿å¾—æœåŠ¡å™¨çš„ä¼˜åŒ–ç­–ç•¥å˜å¾—å¤æ‚èµ·æ¥ã€‚ä¸€æ–¹é¢ï¼Œç”±äºè¢«åŠ¨æ–¹æœ‰å¤šç§åº”å¯¹ç­–ç•¥ï¼Œä»è€Œå¢åŠ äº†ä¸»åŠ¨æ–¹çš„å¤„ç†åˆ†æ”¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒæœåŠ¡å™¨åŒæ—¶ä¸ºæˆåƒä¸Šä¸‡ä¸ªç”¨æˆ·æœåŠ¡ï¼Œä»»ä½•é”™è¯¯éƒ½ä¼šè¢«åºå¤§çš„ç”¨æˆ·æ•°æ”¾å¤§ã€‚æ‰€ä»¥å¯¹ä¸»åŠ¨æ–¹çš„å…³é—­è¿æ¥å‚æ•°è°ƒæ•´æ—¶ï¼Œéœ€è¦æ ¼å¤–å°å¿ƒã€‚</p><p>äº†è§£äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/b7/e2ef1347b3b4590da431dc236d9239b7.png?wh=1162*825\" alt=\"\"></p><p><strong>å…¶å®å››æ¬¡æŒ¥æ‰‹åªæ¶‰åŠä¸¤ç§æŠ¥æ–‡ï¼šFINå’ŒACKã€‚</strong>FINå°±æ˜¯Finishç»“æŸè¿æ¥çš„æ„æ€ï¼Œè°å‘å‡ºFINæŠ¥æ–‡ï¼Œå°±è¡¨ç¤ºå®ƒå°†ä¸å†å‘é€ä»»ä½•æ•°æ®ï¼Œå…³é—­è¿™ä¸€æ–¹å‘çš„ä¼ è¾“é€šé“ã€‚ACKæ˜¯Acknowledgeç¡®è®¤çš„æ„æ€ï¼Œå®ƒç”¨æ¥é€šçŸ¥å¯¹æ–¹ï¼šä½ æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ã€‚</p><p>å½“ä¸»åŠ¨æ–¹å…³é—­è¿æ¥æ—¶ï¼Œä¼šå‘é€FINæŠ¥æ–‡ï¼Œæ­¤æ—¶ä¸»åŠ¨æ–¹çš„è¿æ¥çŠ¶æ€ç”±ESTABLISHEDå˜ä¸ºFIN_WAIT1ã€‚å½“è¢«åŠ¨æ–¹æ”¶åˆ°FINæŠ¥æ–‡åï¼Œå†…æ ¸è‡ªåŠ¨å›å¤ACKæŠ¥æ–‡ï¼Œè¿æ¥çŠ¶æ€ç”±ESTABLISHEDå˜ä¸ºCLOSE_WAITï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒåœ¨ç­‰å¾…è¿›ç¨‹è°ƒç”¨closeå‡½æ•°å…³é—­è¿æ¥ã€‚å½“ä¸»åŠ¨æ–¹æ¥æ”¶åˆ°è¿™ä¸ªACKæŠ¥æ–‡åï¼Œè¿æ¥çŠ¶æ€ç”±FIN_WAIT1å˜ä¸ºFIN_WAIT2ï¼Œä¸»åŠ¨æ–¹çš„å‘é€é€šé“å°±å…³é—­äº†ã€‚</p><p>å†æ¥çœ‹è¢«åŠ¨æ–¹çš„å‘é€é€šé“æ˜¯å¦‚ä½•å…³é—­çš„ã€‚å½“è¢«åŠ¨æ–¹è¿›å…¥CLOSE_WAITçŠ¶æ€æ—¶ï¼Œè¿›ç¨‹çš„readå‡½æ•°ä¼šè¿”å›0ï¼Œè¿™æ ·å¼€å‘äººå‘˜å°±ä¼šæœ‰é’ˆå¯¹æ€§åœ°è°ƒç”¨closeå‡½æ•°ï¼Œè¿›è€Œè§¦å‘å†…æ ¸å‘é€FINæŠ¥æ–‡ï¼Œæ­¤æ—¶è¢«åŠ¨æ–¹è¿æ¥çš„çŠ¶æ€å˜ä¸ºLAST_ACKã€‚å½“ä¸»åŠ¨æ–¹æ”¶åˆ°è¿™ä¸ªFINæŠ¥æ–‡æ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å›å¤ACKï¼ŒåŒæ—¶è¿æ¥çš„çŠ¶æ€ç”±FIN_WAIT2å˜ä¸ºTIME_WAITï¼ŒLinuxç³»ç»Ÿä¸‹å¤§çº¦1åˆ†é’ŸåTIME_WAITçŠ¶æ€çš„è¿æ¥æ‰ä¼šå½»åº•å…³é—­ã€‚è€Œè¢«åŠ¨æ–¹æ”¶åˆ°ACKæŠ¥æ–‡åï¼Œè¿æ¥å°±ä¼šå…³é—­ã€‚</p><h2>ä¸»åŠ¨æ–¹çš„ä¼˜åŒ–</h2><p>å…³é—­è¿æ¥æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è¿›ç¨‹å¼‚å¸¸é€€å‡ºæ—¶ï¼Œé’ˆå¯¹å®ƒæ‰“å¼€çš„è¿æ¥ï¼Œå†…æ ¸å°±ä¼šå‘é€RSTæŠ¥æ–‡æ¥å…³é—­ã€‚RSTçš„å…¨ç§°æ˜¯Resetå¤ä½çš„æ„æ€ï¼Œå®ƒå¯ä»¥ä¸èµ°å››æ¬¡æŒ¥æ‰‹å¼ºè¡Œå…³é—­è¿æ¥ï¼Œä½†å½“æŠ¥æ–‡å»¶è¿Ÿæˆ–è€…é‡å¤ä¼ è¾“æ—¶ï¼Œè¿™ç§æ–¹å¼ä¼šå¯¼è‡´æ•°æ®é”™ä¹±ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸å¾—å·²è€Œä¸ºä¹‹çš„å…³é—­è¿æ¥æ–¹æ¡ˆã€‚</p><p>å®‰å…¨å…³é—­è¿æ¥çš„æ–¹å¼å¿…é¡»é€šè¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œå®ƒç”±è¿›ç¨‹è°ƒç”¨closeæˆ–è€…shutdownå‡½æ•°å‘èµ·ï¼Œè¿™äºŒè€…éƒ½ä¼šå‘å¯¹æ–¹å‘é€FINæŠ¥æ–‡ï¼ˆshutdownå‚æ•°é¡»ä¼ å…¥SHUT_WRæˆ–è€…SHUT_RDWRæ‰ä¼šå‘é€FINï¼‰ï¼ŒåŒºåˆ«åœ¨äºcloseè°ƒç”¨åï¼Œå“ªæ€•å¯¹æ–¹åœ¨åŠå…³é—­çŠ¶æ€ä¸‹å‘é€çš„æ•°æ®åˆ°è¾¾ä¸»åŠ¨æ–¹ï¼Œè¿›ç¨‹ä¹Ÿæ— æ³•æ¥æ”¶ã€‚</p><p><strong>æ­¤æ—¶ï¼Œè¿™ä¸ªè¿æ¥å«åšå­¤å„¿è¿æ¥ï¼Œå¦‚æœä½ ç”¨netstat -på‘½ä»¤ï¼Œä¼šå‘ç°è¿æ¥å¯¹åº”çš„è¿›ç¨‹åä¸ºç©ºã€‚è€Œshutdownå‡½æ•°è°ƒç”¨åï¼Œå³ä½¿è¿æ¥è¿›å…¥äº†FIN_WAIT1æˆ–è€…FIN_WAIT2çŠ¶æ€ï¼Œå®ƒä¹Ÿä¸æ˜¯å­¤å„¿è¿æ¥ï¼Œè¿›ç¨‹ä»ç„¶å¯ä»¥ç»§ç»­æ¥æ”¶æ•°æ®ã€‚</strong>å…³äºå­¤å„¿è¿æ¥çš„æ¦‚å¿µï¼Œä¸‹æ–‡è°ƒä¼˜å‚æ•°æ—¶è¿˜ä¼šç”¨åˆ°ã€‚</p><p>ä¸»åŠ¨æ–¹å‘é€FINæŠ¥æ–‡åï¼Œè¿æ¥å°±å¤„äºFIN_WAIT1çŠ¶æ€ä¸‹ï¼Œè¯¥çŠ¶æ€é€šå¸¸åº”åœ¨æ•°åæ¯«ç§’å†…è½¬ä¸ºFIN_WAIT2ã€‚åªæœ‰è¿Ÿè¿Ÿæ”¶ä¸åˆ°å¯¹æ–¹è¿”å›çš„ACKæ—¶ï¼Œæ‰èƒ½ç”¨netstatå‘½ä»¤è§‚å¯Ÿåˆ°FIN_WAIT1çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œ<strong>å†…æ ¸ä¼šå®šæ—¶é‡å‘FINæŠ¥æ–‡ï¼Œå…¶ä¸­é‡å‘æ¬¡æ•°ç”±tcp_orphan_retrieså‚æ•°æ§åˆ¶</strong>ï¼ˆæ³¨æ„ï¼Œorphanè™½ç„¶æ˜¯å­¤å„¿çš„æ„æ€ï¼Œè¯¥å‚æ•°å´ä¸åªå¯¹å­¤å„¿è¿æ¥æœ‰æ•ˆï¼Œäº‹å®ä¸Šï¼Œå®ƒå¯¹æ‰€æœ‰FIN_WAIT1çŠ¶æ€ä¸‹çš„è¿æ¥éƒ½æœ‰æ•ˆï¼‰ï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œç‰¹æŒ‡8æ¬¡ï¼š</p><pre><code>net.ipv4.tcp_orphan_retries = 0\n</code></pre><p>å¦‚æœFIN_WAIT1çŠ¶æ€è¿æ¥æœ‰å¾ˆå¤šï¼Œä½ å°±éœ€è¦è€ƒè™‘é™ä½tcp_orphan_retriesçš„å€¼ã€‚å½“é‡è¯•æ¬¡æ•°è¾¾åˆ°tcp_orphan_retriesæ—¶ï¼Œè¿æ¥å°±ä¼šç›´æ¥å…³é—­æ‰ã€‚</p><p><strong>å¯¹äºæ­£å¸¸æƒ…å†µæ¥è¯´ï¼Œè°ƒä½tcp_orphan_retrieså·²ç»å¤Ÿç”¨ï¼Œä½†å¦‚æœé‡åˆ°æ¶æ„æ”»å‡»ï¼ŒFINæŠ¥æ–‡æ ¹æœ¬æ— æ³•å‘é€å‡ºå»ã€‚</strong>è¿™æ˜¯ç”±TCPçš„2ä¸ªç‰¹æ€§å¯¼è‡´çš„ã€‚</p><ul>\n<li>é¦–å…ˆï¼ŒTCPå¿…é¡»ä¿è¯æŠ¥æ–‡æ˜¯æœ‰åºå‘é€çš„ï¼ŒFINæŠ¥æ–‡ä¹Ÿä¸ä¾‹å¤–ï¼Œå½“å‘é€ç¼“å†²åŒºè¿˜æœ‰æ•°æ®æ²¡å‘é€æ—¶ï¼ŒFINæŠ¥æ–‡ä¹Ÿä¸èƒ½æå‰å‘é€ã€‚</li>\n<li>å…¶æ¬¡ï¼ŒTCPæœ‰æµæ§åŠŸèƒ½ï¼Œå½“æ¥æ”¶æ–¹å°†æ¥æ”¶çª—å£è®¾ä¸º0æ—¶ï¼Œå‘é€æ–¹å°±ä¸èƒ½å†å‘é€æ•°æ®ã€‚æ‰€ä»¥ï¼Œå½“æ”»å‡»è€…ä¸‹è½½å¤§æ–‡ä»¶æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡å°†æ¥æ”¶çª—å£è®¾ä¸º0ï¼Œå¯¼è‡´FINæŠ¥æ–‡æ— æ³•å‘é€ï¼Œè¿›è€Œå¯¼è‡´è¿æ¥ä¸€ç›´å¤„äºFIN_WAIT1çŠ¶æ€ã€‚</li>\n</ul><p>è§£å†³è¿™ç§é—®é¢˜çš„æ–¹æ¡ˆæ˜¯è°ƒæ•´tcp_max_orphanså‚æ•°ï¼š</p><pre><code>net.ipv4.tcp_max_orphans = 16384\n</code></pre><p>é¡¾åæ€ä¹‰ï¼Œ<strong>tcp_max_orphans å®šä¹‰äº†å­¤å„¿è¿æ¥çš„æœ€å¤§æ•°é‡ã€‚</strong>å½“è¿›ç¨‹è°ƒç”¨closeå‡½æ•°å…³é—­è¿æ¥åï¼Œæ— è®ºè¯¥è¿æ¥æ˜¯åœ¨FIN_WAIT1çŠ¶æ€ï¼Œè¿˜æ˜¯ç¡®å®å…³é—­äº†ï¼Œè¿™ä¸ªè¿æ¥éƒ½ä¸è¯¥è¿›ç¨‹æ— å…³äº†ï¼Œå®ƒå˜æˆäº†å­¤å„¿è¿æ¥ã€‚Linuxç³»ç»Ÿä¸ºé˜²æ­¢å­¤å„¿è¿æ¥è¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºé•¿æœŸè¢«å ç”¨ï¼Œå°±æä¾›äº†tcp_max_orphanså‚æ•°ã€‚å¦‚æœå­¤å„¿è¿æ¥æ•°é‡å¤§äºå®ƒï¼Œæ–°å¢çš„å­¤å„¿è¿æ¥å°†ä¸å†èµ°å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œæ˜¯ç›´æ¥å‘é€RSTå¤ä½æŠ¥æ–‡å¼ºåˆ¶å…³é—­ã€‚</p><p>å½“è¿æ¥æ”¶åˆ°ACKè¿›å…¥FIN_WAIT2çŠ¶æ€åï¼Œå°±è¡¨ç¤ºä¸»åŠ¨æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ï¼Œæ¥ä¸‹æ¥å°†ç­‰å¾…å¯¹æ–¹å‘é€FINæŠ¥æ–‡ï¼Œå…³é—­å¯¹æ–¹çš„å‘é€é€šé“ã€‚è¿™æ—¶ï¼Œ<strong>å¦‚æœè¿æ¥æ˜¯ç”¨shutdownå‡½æ•°å…³é—­çš„ï¼Œè¿æ¥å¯ä»¥ä¸€ç›´å¤„äºFIN_WAIT2çŠ¶æ€ã€‚ä½†å¯¹äºcloseå‡½æ•°å…³é—­çš„å­¤å„¿è¿æ¥ï¼Œè¿™ä¸ªçŠ¶æ€ä¸å¯ä»¥æŒç»­å¤ªä¹…ï¼Œè€Œtcp_fin_timeoutæ§åˆ¶äº†è¿™ä¸ªçŠ¶æ€ä¸‹è¿æ¥çš„æŒç»­æ—¶é•¿ã€‚</strong></p><pre><code>net.ipv4.tcp_fin_timeout = 60\n</code></pre><p>å®ƒçš„é»˜è®¤å€¼æ˜¯60ç§’ã€‚è¿™æ„å‘³ç€å¯¹äºå­¤å„¿è¿æ¥ï¼Œå¦‚æœ60ç§’åè¿˜æ²¡æœ‰æ”¶åˆ°FINæŠ¥æ–‡ï¼Œè¿æ¥å°±ä¼šç›´æ¥å…³é—­ã€‚è¿™ä¸ª60ç§’å¹¶ä¸æ˜¯æ‹è„‘è¢‹å†³å®šçš„ï¼Œå®ƒä¸æ¥ä¸‹æ¥ä»‹ç»çš„TIME_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬ç¨åå†æ¥å›ç­”60ç§’çš„ç”±æ¥ã€‚</p><p>TIME_WAITæ˜¯ä¸»åŠ¨æ–¹å››æ¬¡æŒ¥æ‰‹çš„æœ€åä¸€ä¸ªçŠ¶æ€ã€‚å½“æ”¶åˆ°è¢«åŠ¨æ–¹å‘æ¥çš„FINæŠ¥æ–‡æ—¶ï¼Œä¸»åŠ¨æ–¹å›å¤ACKï¼Œè¡¨ç¤ºç¡®è®¤å¯¹æ–¹çš„å‘é€é€šé“å·²ç»å…³é—­ï¼Œè¿æ¥éšä¹‹è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œç­‰å¾…60ç§’åå…³é—­ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¿…é¡»ç«™åœ¨æ•´ä¸ªç½‘ç»œçš„è§’åº¦ä¸Šï¼Œæ‰èƒ½å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><p>TIME_WAITçŠ¶æ€çš„è¿æ¥ï¼Œåœ¨ä¸»åŠ¨æ–¹çœ‹æ¥ç¡®å®å·²ç»å…³é—­äº†ã€‚ç„¶è€Œï¼Œè¢«åŠ¨æ–¹æ²¡æœ‰æ”¶åˆ°ACKæŠ¥æ–‡å‰ï¼Œè¿æ¥è¿˜å¤„äºLAST_ACKçŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªACKæŠ¥æ–‡æ²¡æœ‰åˆ°è¾¾è¢«åŠ¨æ–¹ï¼Œè¢«åŠ¨æ–¹å°±ä¼šé‡å‘FINæŠ¥æ–‡ã€‚é‡å‘æ¬¡æ•°ä»ç„¶ç”±å‰é¢ä»‹ç»è¿‡çš„tcp_orphan_retrieså‚æ•°æ§åˆ¶ã€‚</p><p>å¦‚æœä¸»åŠ¨æ–¹ä¸ä¿ç•™TIME_WAITçŠ¶æ€ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿæ­¤æ—¶è¿æ¥çš„ç«¯å£æ¢å¤äº†è‡ªç”±èº«ï¼Œå¯ä»¥å¤ç”¨äºæ–°è¿æ¥äº†ã€‚ç„¶è€Œï¼Œè¢«åŠ¨æ–¹çš„FINæŠ¥æ–‡å¯èƒ½å†æ¬¡åˆ°è¾¾ï¼Œè¿™æ—¢å¯èƒ½æ˜¯ç½‘ç»œä¸­çš„è·¯ç”±å™¨é‡å¤å‘é€ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¢«åŠ¨æ–¹æ²¡æ”¶åˆ°ACKæ—¶åŸºäºtcp_orphan_retrieså‚æ•°é‡å‘ã€‚è¿™æ ·ï¼Œ<strong>æ­£å¸¸é€šè®¯çš„æ–°è¿æ¥å°±å¯èƒ½è¢«é‡å¤å‘é€çš„FINæŠ¥æ–‡è¯¯å…³é—­ã€‚</strong>ä¿ç•™TIME_WAITçŠ¶æ€ï¼Œå°±å¯ä»¥åº”ä»˜é‡å‘çš„FINæŠ¥æ–‡ï¼Œå½“ç„¶ï¼Œå…¶ä»–æ•°æ®æŠ¥æ–‡ä¹Ÿæœ‰å¯èƒ½é‡å‘ï¼Œæ‰€ä»¥TIME_WAITçŠ¶æ€è¿˜èƒ½é¿å…æ•°æ®é”™ä¹±ã€‚</p><p>æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€è¦ä¿æŒ60ç§’å‘¢ï¼Ÿè¿™ä¸å­¤å„¿è¿æ¥FIN_WAIT2çŠ¶æ€é»˜è®¤ä¿ç•™60ç§’çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œ<strong>å› ä¸ºè¿™ä¸¤ä¸ªçŠ¶æ€éƒ½éœ€è¦ä¿æŒ2MSLæ—¶é•¿ã€‚MSLå…¨ç§°æ˜¯Maximum Segment Lifetimeï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæŠ¥æ–‡åœ¨ç½‘ç»œä¸­çš„æœ€é•¿ç”Ÿå­˜æ—¶é—´</strong>ï¼ˆæŠ¥æ–‡æ¯ç»è¿‡ä¸€æ¬¡è·¯ç”±å™¨çš„è½¬å‘ï¼ŒIPå¤´éƒ¨çš„TTLå­—æ®µå°±ä¼šå‡1ï¼Œå‡åˆ°0æ—¶æŠ¥æ–‡å°±è¢«ä¸¢å¼ƒï¼Œè¿™å°±é™åˆ¶äº†æŠ¥æ–‡çš„æœ€é•¿å­˜æ´»æ—¶é—´ï¼‰ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯2 MSLçš„æ—¶é•¿å‘¢ï¼Ÿè¿™å…¶å®æ˜¯ç›¸å½“äºè‡³å°‘å…è®¸æŠ¥æ–‡ä¸¢å¤±ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œè‹¥ACKåœ¨ä¸€ä¸ªMSLå†…ä¸¢å¤±ï¼Œè¿™æ ·è¢«åŠ¨æ–¹é‡å‘çš„FINä¼šåœ¨ç¬¬2ä¸ªMSLå†…åˆ°è¾¾ï¼ŒTIME_WAITçŠ¶æ€çš„è¿æ¥å¯ä»¥åº”å¯¹ã€‚ä¸ºä»€ä¹ˆä¸æ˜¯4æˆ–è€…8 MSLçš„æ—¶é•¿å‘¢ï¼Ÿä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªä¸¢åŒ…ç‡è¾¾åˆ°ç™¾åˆ†ä¹‹ä¸€çš„ç³Ÿç³•ç½‘ç»œï¼Œè¿ç»­ä¸¤æ¬¡ä¸¢åŒ…çš„æ¦‚ç‡åªæœ‰ä¸‡åˆ†ä¹‹ä¸€ï¼Œè¿™ä¸ªæ¦‚ç‡å®åœ¨æ˜¯å¤ªå°äº†ï¼Œå¿½ç•¥å®ƒæ¯”è§£å†³å®ƒæ›´å…·æ€§ä»·æ¯”ã€‚</p><p><strong>å› æ­¤ï¼ŒTIME_WAITå’ŒFIN_WAIT2çŠ¶æ€çš„æœ€å¤§æ—¶é•¿éƒ½æ˜¯2 MSLï¼Œç”±äºåœ¨Linuxç³»ç»Ÿä¸­ï¼ŒMSLçš„å€¼å›ºå®šä¸º30ç§’ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ˜¯60ç§’ã€‚</strong></p><p>è™½ç„¶TIME_WAITçŠ¶æ€çš„å­˜åœ¨æ˜¯æœ‰å¿…è¦çš„ï¼Œä½†å®ƒæ¯•ç«Ÿåœ¨æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚TIME_WAITçŠ¶æ€çš„ç«¯å£å°±æ— æ³•ä¾›æ–°è¿æ¥ä½¿ç”¨ã€‚æ€æ ·è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p><strong>Linuxæä¾›äº†tcp_max_tw_buckets å‚æ•°ï¼Œå½“TIME_WAITçš„è¿æ¥æ•°é‡è¶…è¿‡è¯¥å‚æ•°æ—¶ï¼Œæ–°å…³é—­çš„è¿æ¥å°±ä¸å†ç»å†TIME_WAITè€Œç›´æ¥å…³é—­ã€‚</strong></p><pre><code>net.ipv4.tcp_max_tw_buckets = 5000\n</code></pre><p>å½“æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥å¢å¤šæ—¶ï¼Œç›¸åº”åœ°ï¼ŒåŒæ—¶å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥æ•°é‡ä¹Ÿä¼šå˜å¤šï¼Œæ­¤æ—¶å°±åº”å½“è°ƒå¤§tcp_max_tw_bucketså‚æ•°ï¼Œå‡å°‘ä¸åŒè¿æ¥é—´æ•°æ®é”™ä¹±çš„æ¦‚ç‡ã€‚</p><p>å½“ç„¶ï¼Œtcp_max_tw_bucketsä¹Ÿä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œæ¯•ç«Ÿå†…å­˜å’Œç«¯å£å·éƒ½æ˜¯æœ‰é™çš„ã€‚æœ‰æ²¡æœ‰åŠæ³•è®©æ–°è¿æ¥å¤ç”¨TIME_WAITçŠ¶æ€çš„ç«¯å£å‘¢ï¼Ÿå¦‚æœæœåŠ¡å™¨ä¼šä¸»åŠ¨å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘èµ·è¿æ¥çš„è¯ï¼Œå°±å¯ä»¥æŠŠtcp_tw_reuseå‚æ•°è®¾ç½®ä¸º1ï¼Œå®ƒå…è®¸ä½œä¸ºå®¢æˆ·ç«¯çš„æ–°è¿æ¥ï¼Œåœ¨å®‰å…¨æ¡ä»¶ä¸‹ä½¿ç”¨TIME_WAITçŠ¶æ€ä¸‹çš„ç«¯å£ã€‚</p><pre><code>net.ipv4.tcp_tw_reuse = 1\n</code></pre><p>å½“ç„¶ï¼Œè¦æƒ³ä½¿tcp_tw_reuseç”Ÿæ•ˆï¼Œè¿˜å¾—æŠŠtimestampså‚æ•°è®¾ç½®ä¸º1ï¼Œå®ƒæ»¡è¶³å®‰å…¨å¤ç”¨çš„å…ˆå†³æ¡ä»¶ï¼ˆå¯¹æ–¹ä¹Ÿè¦æ‰“å¼€tcp_timestamps ï¼‰ï¼š</p><pre><code>net.ipv4.tcp_timestamps = 1\n</code></pre><p>è€ç‰ˆæœ¬çš„Linuxè¿˜æä¾›äº†tcp_tw_recycleå‚æ•°ï¼Œå®ƒå¹¶ä¸è¦æ±‚TIME_WAITçŠ¶æ€å­˜åœ¨60ç§’ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•°æ®é”™ä¹±ï¼Œä¸å»ºè®®è®¾ç½®ä¸º1ã€‚</p><pre><code>net.ipv4.tcp_tw_recycle = 0\n</code></pre><p>æ‰€ä»¥åœ¨Linux 4.12ç‰ˆæœ¬åï¼Œç›´æ¥å–æ¶ˆäº†è¿™ä¸€å‚æ•°ã€‚</p><h2>è¢«åŠ¨æ–¹çš„ä¼˜åŒ–</h2><p>å½“è¢«åŠ¨æ–¹æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå°±å¼€å¯äº†è¢«åŠ¨æ–¹çš„å››æ¬¡æŒ¥æ‰‹æµç¨‹ã€‚å†…æ ¸è‡ªåŠ¨å›å¤ACKæŠ¥æ–‡åï¼Œè¿æ¥å°±è¿›å…¥CLOSE_WAITçŠ¶æ€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒè¡¨ç¤ºç­‰å¾…è¿›ç¨‹è°ƒç”¨closeå‡½æ•°å…³é—­è¿æ¥ã€‚</p><p>å†…æ ¸æ²¡æœ‰æƒåŠ›æ›¿ä»£è¿›ç¨‹å»å…³é—­è¿æ¥ï¼Œå› ä¸ºè‹¥ä¸»åŠ¨æ–¹æ˜¯é€šè¿‡shutdownå…³é—­è¿æ¥ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æƒ³åœ¨åŠå…³é—­è¿æ¥ä¸Šæ¥æ”¶æ•°æ®ã€‚<strong>å› æ­¤ï¼ŒLinuxå¹¶æ²¡æœ‰é™åˆ¶CLOSE_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ã€‚</strong></p><p>å½“ç„¶ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹¶ä¸ä½¿ç”¨shutdownå‡½æ•°å…³é—­è¿æ¥ï¼Œæ‰€ä»¥ï¼Œå½“ä½ ç”¨netstatå‘½ä»¤å‘ç°å¤§é‡CLOSE_WAITçŠ¶æ€æ—¶ï¼Œè¦ä¹ˆæ˜¯ç¨‹åºå‡ºç°äº†Bugï¼Œreadå‡½æ•°è¿”å›0æ—¶å¿˜è®°è°ƒç”¨closeå‡½æ•°å…³é—­è¿æ¥ï¼Œè¦ä¹ˆå°±æ˜¯ç¨‹åºè´Ÿè½½å¤ªé«˜ï¼Œcloseå‡½æ•°æ‰€åœ¨çš„å›è°ƒå‡½æ•°è¢«å»¶è¿Ÿæ‰§è¡Œäº†ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åº”å½“åœ¨åº”ç”¨ä»£ç å±‚é¢è§£å†³é—®é¢˜ã€‚</p><p>ç”±äºCLOSE_WAITçŠ¶æ€ä¸‹ï¼Œè¿æ¥å·²ç»å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œæ‰€ä»¥æ­¤æ—¶è¿›ç¨‹è‹¥è¦å…³é—­è¿æ¥ï¼Œåªèƒ½è°ƒç”¨closeå‡½æ•°ï¼ˆå†è°ƒç”¨shutdownå…³é—­å•å‘é€šé“å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰ï¼Œå†…æ ¸å°±ä¼šå‘å‡ºFINæŠ¥æ–‡å…³é—­å‘é€é€šé“ï¼ŒåŒæ—¶è¿æ¥è¿›å…¥LAST_ACKçŠ¶æ€ï¼Œç­‰å¾…ä¸»åŠ¨æ–¹è¿”å›ACKæ¥ç¡®è®¤è¿æ¥å…³é—­ã€‚</p><p>å¦‚æœè¿Ÿè¿Ÿç­‰ä¸åˆ°ACKï¼Œå†…æ ¸å°±ä¼šé‡å‘FINæŠ¥æ–‡ï¼Œé‡å‘æ¬¡æ•°ä»ç„¶ç”±tcp_orphan_retrieså‚æ•°æ§åˆ¶ï¼Œè¿™ä¸ä¸»åŠ¨æ–¹é‡å‘FINæŠ¥æ–‡çš„ä¼˜åŒ–ç­–ç•¥ä¸€è‡´ã€‚</p><p>è‡³æ­¤ï¼Œç”±ä¸€æ–¹ä¸»åŠ¨å‘èµ·å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹å°±ä»‹ç»å®Œäº†ã€‚éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¦‚æœè¢«åŠ¨æ–¹è¿…é€Ÿè°ƒç”¨closeå‡½æ•°ï¼Œé‚£ä¹ˆè¢«åŠ¨æ–¹çš„ACKå’ŒFINæœ‰å¯èƒ½åœ¨ä¸€ä¸ªæŠ¥æ–‡ä¸­å‘é€ï¼Œè¿™æ ·çœ‹èµ·æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹ä¼šå˜æˆä¸‰æ¬¡æŒ¥æ‰‹ï¼Œè¿™åªæ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä¸ç”¨åœ¨æ„ã€‚</strong></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§ç‰¹ä¾‹ï¼Œå¦‚æœè¿æ¥åŒæ–¹åŒæ—¶å…³é—­è¿æ¥ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>æ­¤æ—¶ï¼Œä¸Šé¢ä»‹ç»è¿‡çš„ä¼˜åŒ–ç­–ç•¥ä»ç„¶é€‚ç”¨ã€‚ä¸¤æ–¹å‘é€FINæŠ¥æ–‡æ—¶ï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ˜¯ä¸»åŠ¨æ–¹ï¼Œæ‰€ä»¥éƒ½è¿›å…¥äº†FIN_WAIT1çŠ¶æ€ï¼ŒFINæŠ¥æ–‡çš„é‡å‘æ¬¡æ•°ä»ç”±tcp_orphan_retrieså‚æ•°æ§åˆ¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/04/52/043752a3957d36f4e3c82cd83d472452.png?wh=1165*585\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼ŒåŒæ–¹åœ¨ç­‰å¾…ACKæŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ç­‰æ¥äº†FINæŠ¥æ–‡ã€‚è¿™æ˜¯ä¸€ç§æ–°æƒ…å†µï¼Œæ‰€ä»¥è¿æ¥ä¼šè¿›å…¥ä¸€ç§å«åšCLOSINGçš„æ–°çŠ¶æ€ï¼Œå®ƒæ›¿ä»£äº†FIN_WAIT2çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œå†…æ ¸å›å¤ACKç¡®è®¤å¯¹æ–¹å‘é€é€šé“çš„å…³é—­ï¼Œä»…å·±æ–¹çš„FINæŠ¥æ–‡å¯¹åº”çš„ACKè¿˜æ²¡æœ‰æ”¶åˆ°ã€‚æ‰€ä»¥ï¼ŒCLOSINGçŠ¶æ€ä¸LAST_ACKçŠ¶æ€ä¸‹çš„è¿æ¥å¾ˆç›¸ä¼¼ï¼Œå®ƒä¼šåœ¨é€‚æ—¶é‡å‘FINæŠ¥æ–‡çš„æƒ…å†µä¸‹æœ€ç»ˆå…³é—­ã€‚</p><h2>å°ç»“</h2><p>æˆ‘ä»¬å¯¹è¿™ä¸€è®²çš„å†…å®¹åšä¸ªå°ç»“ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬è®²äº†å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Œä½ éœ€è¦æ ¹æ®ä¸»åŠ¨æ–¹ä¸è¢«åŠ¨æ–¹çš„è¿æ¥çŠ¶æ€å˜åŒ–æ¥è°ƒæ•´ç³»ç»Ÿå‚æ•°ï¼Œä½¿å®ƒåœ¨ç‰¹å®šç½‘ç»œæ¡ä»¶ä¸‹æ›´åŠæ—¶åœ°é‡Šæ”¾èµ„æºã€‚</p><p>å››æ¬¡æŒ¥æ‰‹çš„ä¸»åŠ¨æ–¹ï¼Œä¸ºäº†åº”å¯¹ä¸¢åŒ…ï¼Œå…è®¸åœ¨tcp_orphan_retriesæ¬¡æ•°å†…é‡å‘FINæŠ¥æ–‡ã€‚å½“æ”¶åˆ°ACKæŠ¥æ–‡ï¼Œè¿æ¥å°±è¿›å…¥äº†FIN_WAIT2çŠ¶æ€ï¼Œæ­¤æ—¶ç³»ç»Ÿçš„è¡Œä¸ºä¾èµ–è¿™æ˜¯å¦ä¸ºå­¤å„¿è¿æ¥ã€‚</p><p>å¦‚æœè¿™æ˜¯closeå‡½æ•°å…³é—­çš„å­¤å„¿è¿æ¥ï¼Œé‚£ä¹ˆåœ¨tcp_fin_timeoutç§’å†…æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡ï¼Œè¿æ¥å°±ç›´æ¥å…³é—­ï¼Œåä¹‹shutdownå‡½æ•°å…³é—­çš„è¿æ¥åˆ™ä¸å—æ­¤é™åˆ¶ã€‚æ¯•ç«Ÿå­¤å„¿è¿æ¥å¯èƒ½åœ¨é‡å‘æ¬¡æ•°å†…å­˜åœ¨æ•°åˆ†é’Ÿä¹‹ä¹…ï¼Œä¸ºäº†åº”å¯¹å­¤å„¿è¿æ¥å ç”¨å¤ªå¤šçš„èµ„æºï¼Œtcp_max_orphanså®šä¹‰äº†æœ€å¤§å­¤å„¿è¿æ¥çš„æ•°é‡ï¼Œè¶…è¿‡æ—¶è¿æ¥å°±ä¼šç›´æ¥é‡Šæ”¾ã€‚</p><p>å½“æ¥æ”¶åˆ°FINæŠ¥æ–‡ï¼Œå¹¶è¿”å›ACKåï¼Œä¸»åŠ¨æ–¹çš„è¿æ¥è¿›å…¥TIME_WAITçŠ¶æ€ã€‚è¿™ä¸€çŠ¶æ€ä¼šæŒç»­1åˆ†é’Ÿï¼Œä¸ºäº†é˜²æ­¢TIME_WAITçŠ¶æ€å ç”¨å¤ªå¤šçš„èµ„æºï¼Œtcp_max_tw_bucketså®šä¹‰äº†æœ€å¤§æ•°é‡ï¼Œè¶…è¿‡æ—¶è¿æ¥ä¹Ÿä¼šç›´æ¥é‡Šæ”¾ã€‚å½“TIME_WAITçŠ¶æ€è¿‡å¤šæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡è®¾ç½®tcp_tw_reuseå’Œtcp_timestampsä¸º1 ï¼Œå°†TIME_WAITçŠ¶æ€çš„ç«¯å£å¤ç”¨äºä½œä¸ºå®¢æˆ·ç«¯çš„æ–°è¿æ¥ã€‚</p><p>è¢«åŠ¨å…³é—­çš„è¿æ¥æ–¹åº”å¯¹éå¸¸ç®€å•ï¼Œå®ƒåœ¨å›å¤ACKåå°±è¿›å…¥äº†CLOSE_WAITçŠ¶æ€ï¼Œç­‰å¾…è¿›ç¨‹è°ƒç”¨closeå‡½æ•°å…³é—­è¿æ¥ã€‚å› æ­¤ï¼Œå‡ºç°å¤§é‡CLOSE_WAITçŠ¶æ€çš„è¿æ¥æ—¶ï¼Œåº”å½“ä»åº”ç”¨ç¨‹åºä¸­æ‰¾é—®é¢˜ã€‚å½“è¢«åŠ¨æ–¹å‘é€FINæŠ¥æ–‡åï¼Œè¿æ¥å°±è¿›å…¥LAST_ACKçŠ¶æ€ï¼Œåœ¨æœªç­‰æ¥ACKæ—¶ï¼Œä¼šåœ¨tcp_orphan_retrieså‚æ•°çš„æ§åˆ¶ä¸‹é‡å‘FINæŠ¥æ–‡ã€‚</p><p>è‡³æ­¤ï¼ŒTCPè¿æ¥å»ºç«‹ã€å…³é—­æ—¶çš„æ€§èƒ½ä¼˜åŒ–å°±ä»‹ç»å®Œäº†ã€‚ä¸‹ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨åœ¨TCPä¸Šä¼ è¾“æ•°æ®æ—¶ï¼Œå¦‚ä½•ä¼˜åŒ–å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ã€‚ä½ çŸ¥é“å…³é—­è¿æ¥æ—¶çš„SO_LINGERé€‰é¡¹å—ï¼Ÿå®ƒå¸Œæœ›ç”¨å››æ¬¡æŒ¥æ‰‹æ›¿ä»£RSTå…³é—­è¿æ¥çš„æ–¹å¼ï¼Œé˜²æ­¢æµè§ˆå™¨æ²¡æœ‰æ¥æ”¶åˆ°å®Œæ•´çš„HTTPå“åº”ã€‚è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼ŒSO_LINGERä¼šæ€ä¹ˆå½±å“ä¸»åŠ¨æ–¹è¿æ¥çš„çŠ¶æ€å˜åŒ–ï¼ŸSO_LINGERä¸Šçš„è¶…æ—¶æ—¶é—´ï¼Œæ˜¯æ€æ ·ä¸ç³»ç»Ÿé…ç½®å‚æ•°åä½œçš„ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘ä¸€èµ·æ¢è®¨ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":219764,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1590075537,"is_pvip":false,"replies":[{"id":"81152","content":"è°¢è°¢å¿†æ°´å¯’çš„åˆ†äº«ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590103734,"ip_address":"","comment_id":219764,"utype":1}],"discussion_count":4,"race_medal":0,"score":"48834715793","product_id":100051201,"comment_content":"æœ¬èŠ‚å†…å®¹çœŸçš„å¾ˆçƒ§è„‘å•Šï¼æ”¶è·ä¹Ÿå¾ˆå¤šï¼Œä»æ¥æ²¡æœ‰ä»è¿™ä¹ˆå¤šè§’åº¦çœ‹å¾…è¿‡è¿™ä¸ªé—®é¢˜ã€‚<br>so_lingeræ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼šl_onoffå’Œl_lingerã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦å¯ç”¨so_lingeråŠŸèƒ½ï¼Œç¬¬äºŒä¸ªå‚æ•°l_linger=0ï¼Œåˆ™ close å‡½æ•°åœ¨é˜»å¡ç›´åˆ° l_linger æ—¶é—´è¶…æ—¶æˆ–è€…æ•°æ®å‘é€å®Œæ¯•ï¼Œå¦‚æœè¶…æ—¶åˆ™ç›´æ¥æƒ…å†µç¼“å†²åŒºç„¶åRSTè¿æ¥ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯è°ƒç”¨closeå‡½æ•°ç«‹å³è¿”å›ï¼‰ã€‚","like_count":11,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495937,"discussion_content":"è°¢è°¢å¿†æ°´å¯’çš„åˆ†äº«ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590103734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073027,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","nickname":"Douglas","note":"","ucode":"CFDE3D76B9DAE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292231,"discussion_content":"å’Œçƒ§ä¸çƒ§è„‘å¹¶æ²¡å•¥å…³ç³»ï¼Œåº•å±‚æ˜¯å±‚çª—æˆ·çº¸","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1595148634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1286741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a2/55/1092ebb8.jpg","nickname":"è¾¹åŸè·¯è¿œ","note":"","ucode":"214ECD8981E87F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276211,"discussion_content":"å›ç­”åäº†ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºé›¶åˆ™ç›´æ¥RSTï¼Œå¦åˆ™ç­‰å¾…è¶…æ—¶åå‘é€FIN","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590841029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"å¿†æ°´å¯’","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1286741,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a2/55/1092ebb8.jpg","nickname":"è¾¹åŸè·¯è¿œ","note":"","ucode":"214ECD8981E87F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276215,"discussion_content":"å†™çš„æ—¶å€™ç¬”è¯¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590841839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":276211,"ip_address":""},"score":276215,"extra":""}]}]},{"had_liked":false,"id":219085,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1589941947,"is_pvip":false,"replies":[{"id":"81097","content":"Nginxä¸­æœ‰SO_LINGERé€‰é¡¹çš„åº”ç”¨ï¼Œå¯ä»¥å‚è§ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ç¬¬130è¯¾","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590059912,"ip_address":"","comment_id":219085,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40244647611","product_id":100051201,"comment_content":"è€å¸ˆçš„æ–‡ç« éƒ½è¦ç»†å“.<br>å†…æ ¸è°ƒä¼˜çš„å‚æ•°ç®—æ˜¯è§è¯†åˆ°äº†,ä¸çŸ¥é“å•¥æ—¶å€™æ‰èƒ½ç”¨å¾—ä¸Š.ğŸ¤¦<br><br>ä¸€äº›è¾¹ç•Œæƒ…å†µè€å¸ˆä¹Ÿä»‹ç»åˆ°äº†:<br>1. tcp_tw_reuse ä¹Ÿæ˜¯æœ‰é€‚ç”¨æ¡ä»¶çš„.<br>2. å››æ¬¡æŒ¥æ‰‹åœ¨æç«¯æƒ…å†µä¸‹,å¯èƒ½å˜ä¸‰æ¬¡æŒ¥æ‰‹.<br>3. CLOSING çŠ¶æ€ç¡®å®ç®—æ˜¯ç¬¬ä¸€æ¬¡è§,ä¹‹å‰æ²¡è€ƒè™‘è¿‡è¿™ä¸ªé—®é¢˜.<br><br>ä»¥å‰åœ¨ç”¨cè¯­è¨€çš„ç½‘ç»œç¼–ç¨‹æ—¶,ä¼šæ¥è§¦setsockoptå‡½æ•°.<br>æœ€åˆçš„ä½¿ç”¨è¯¥å‡½æ•°çš„åŸå› ,åªæ˜¯ä¸ºäº†ç«¯å£å¤ç”¨.<br>å› ä¸ºåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­,ç»å¸¸ä¼šé‡å¯æœåŠ¡,å¦‚æœä¸è®¾ç½®SO_REUSEADDRå‚æ•°,å°±éœ€è¦ç­‰ç³»ç»Ÿé‡Šæ”¾æ‰ç«¯å£,æœåŠ¡æ‰èƒ½ç›‘å¬æˆåŠŸ.<br><br>è§è¿‡SO_LINGERé€‰é¡¹,ä½†çœŸæœªç»†ç©¶è¿‡.<br>å¾…è¯¾ä»£è¡¨ä»¬æ¥è§£ç­”.<br>","like_count":9,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495678,"discussion_content":"Nginxä¸­æœ‰SO_LINGERé€‰é¡¹çš„åº”ç”¨ï¼Œå¯ä»¥å‚è§ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ç¬¬130è¯¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590059912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232832,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1594126170,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23068962650","product_id":100051201,"comment_content":"TCPçš„è¿™å‡ ç¯‡æ–‡ç« æˆ‘å¬äº†æœ‰10å‡ é","like_count":5},{"had_liked":false,"id":230997,"user_name":"G.S.K","can_delete":false,"product_type":"c1","uid":1222966,"ip_address":"","ucode":"88217F9289EB48","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/36/d054c979.jpg","comment_is_top":false,"comment_ctime":1593562501,"is_pvip":false,"replies":[{"id":"85323","content":"RTOé€šå¸¸æ˜¯æ¯«ç§’çº§ï¼Œ2MSLæ˜¯åˆ†é’Ÿçº§ï¼ŒRTOå¤§äº2MSLçš„æ¦‚ç‡å‡ ä¹ä¸º0","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1593567016,"ip_address":"","comment_id":230997,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23068398981","product_id":100051201,"comment_content":"è¯·æ•™è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ç‚¹æƒ³ä¸æ˜ç™½ã€‚å‡å¦‚Aå’ŒBä¹‹é—´æœ‰ä¸ªtcpè¿æ¥ï¼ŒAä¸»åŠ¨å‘èµ·å…³é—­ï¼ŒAè¿›å…¥TIME_WAITçŠ¶æ€ã€‚å¦‚æœBç«¯çš„RTO(é‡ä¼ è¶…æ—¶æ—¶é—´)æ¯”2mslå¤§ï¼Œ2MSLåï¼ŒBç«¯è¿˜æ˜¯æœ‰å¯èƒ½é‡ä¼ FINçš„ã€‚æ„Ÿè§‰TIME_WAITç­‰å¾…çš„æ—¶é—´åº”è¯¥æ˜¯Bç«¯RTO+MSLå•Šã€‚è¿˜è¯·è€å¸ˆå¸®å¿™è§£æƒ‘ã€‚","like_count":5,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500109,"discussion_content":"RTOé€šå¸¸æ˜¯æ¯«ç§’çº§ï¼Œ2MSLæ˜¯åˆ†é’Ÿçº§ï¼ŒRTOå¤§äº2MSLçš„æ¦‚ç‡å‡ ä¹ä¸º0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593567016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255235,"user_name":"Geek_78d3bb","can_delete":false,"product_type":"c1","uid":2254690,"ip_address":"","ucode":"1B43733075E132","user_header":"","comment_is_top":false,"comment_ctime":1603287370,"is_pvip":false,"replies":[{"id":"93198","content":"æ¸…ç©ºç¼“å†²åŒºï¼Œæ˜¯å…³é—­ä¸€ç«¯ä¼ è¾“èƒ½åŠ›çš„å­ä»»åŠ¡ã€‚4æ¬¡æŒ¥æ‰‹çš„ä¸»è¦åŸå› ï¼Œæ˜¯å› ä¸ºTCPç”±å†…æ ¸å®ç°ï¼Œä½†åº”ç”¨å±‚å¯ä»¥åŠå…³é—­è¿æ¥ä¸”é•¿æœŸå­˜åœ¨ï¼Œæ‰€ä»¥åªèƒ½æ˜¯4æ¬¡æŒ¥æ‰‹ï¼Œæ¸…ç©ºç¼“å†²åŒºåªæ˜¯å­ç›®æ ‡ã€‚ä¸ªäººçœ‹æ³•^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1603458533,"ip_address":"","comment_id":255235,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14488189258","product_id":100051201,"comment_content":"ä¸ºä»€ä¹ˆ3æ¬¡æ¡æ‰‹4æ¬¡æŒ¥æ‰‹ï¼Ÿ å› ä¸ºæŒ¥æ‰‹çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæ¸…ç©ºå„è‡ªç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œç„¶åæ‰èƒ½closeï¼Œä¸æ˜¯è¿™æ ·å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507654,"discussion_content":"æ¸…ç©ºç¼“å†²åŒºï¼Œæ˜¯å…³é—­ä¸€ç«¯ä¼ è¾“èƒ½åŠ›çš„å­ä»»åŠ¡ã€‚4æ¬¡æŒ¥æ‰‹çš„ä¸»è¦åŸå› ï¼Œæ˜¯å› ä¸ºTCPç”±å†…æ ¸å®ç°ï¼Œä½†åº”ç”¨å±‚å¯ä»¥åŠå…³é—­è¿æ¥ä¸”é•¿æœŸå­˜åœ¨ï¼Œæ‰€ä»¥åªèƒ½æ˜¯4æ¬¡æŒ¥æ‰‹ï¼Œæ¸…ç©ºç¼“å†²åŒºåªæ˜¯å­ç›®æ ‡ã€‚ä¸ªäººçœ‹æ³•^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603458533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219699,"user_name":"å†¬é£å‘å·¦å¹","can_delete":false,"product_type":"c1","uid":1066928,"ip_address":"","ucode":"376C45C5134F93","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/b0/a9b77a1e.jpg","comment_is_top":false,"comment_ctime":1590066131,"is_pvip":false,"replies":[{"id":"81149","content":"ä½ å¥½ä¸œéƒ­ï¼Œæˆ‘è®¤ä¸ºæœ¬è´¨ä¸Šè¿™æ˜¯æ‰“å¼€tcp_tw_recycleé€ æˆçš„ï¼ŒçœŸä¸å…³timestampsçš„äº‹ã€‚timestampsçš„å¥½å¤„å¾ˆå¤šï¼Œä¸å»ºè®®å…³æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590103172,"ip_address":"","comment_id":219699,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14474968019","product_id":100051201,"comment_content":"çœ‹åˆ°ä¸€éæ–‡ç« ï¼Œtcp_timestampsè¿˜æœ‰è¿™ä¸ªå‘å—ï¼Ÿ<br>https:&#47;&#47;blog.51cto.com&#47;fuyuan2016&#47;1795998","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495909,"discussion_content":"ä½ å¥½ä¸œéƒ­ï¼Œæˆ‘è®¤ä¸ºæœ¬è´¨ä¸Šè¿™æ˜¯æ‰“å¼€tcp_tw_recycleé€ æˆçš„ï¼ŒçœŸä¸å…³timestampsçš„äº‹ã€‚timestampsçš„å¥½å¤„å¾ˆå¤šï¼Œä¸å»ºè®®å…³æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590103172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066928,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/b0/a9b77a1e.jpg","nickname":"å†¬é£å‘å·¦å¹","note":"","ucode":"376C45C5134F93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271186,"discussion_content":"ç¡®å®ï¼Œè¿™ç¯‡æ–‡ç« åˆšå¥½è¯´æ˜äº†æ‰“å¼€tcp_tw_recycleä¼šé€ æˆæ•°æ®é”™ä¹±ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590105585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219023,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1589934445,"is_pvip":false,"replies":[{"id":"81095","content":"ç‚¹ä¸ªèµï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590059797,"ip_address":"","comment_id":219023,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14474836333","product_id":100051201,"comment_content":"è‡³å°‘è¦å¬3é","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495656,"discussion_content":"ç‚¹ä¸ªèµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590059797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073027,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","nickname":"Douglas","note":"","ucode":"CFDE3D76B9DAE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292235,"discussion_content":"å†™çš„æ¸…æ¥šç‚¹çš„è¯ï¼Œçœ‹ä¸€ä¸¤éå°±å¯ä»¥äº†ï¼Œåˆæ²¡å•¥ç®—æ³•è¦å»ç†è§£","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595149640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224428,"user_name":"äº¦çŸ¥ç èš","can_delete":false,"product_type":"c1","uid":1238245,"ip_address":"","ucode":"400344A6E1207F","user_header":"https://static001.geekbang.org/account/avatar/00/12/e4/e5/82132920.jpg","comment_is_top":false,"comment_ctime":1591380403,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10181314995","product_id":100051201,"comment_content":" tcp_tw_reuse çš„å†…æ ¸é…ç½®é€‰é¡¹å’Œ SO_REUSEADDR å¥—æ¥å­—é€‰æ‹©ï¼Œè¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢","like_count":2,"discussions":[{"author":{"id":1250775,"avatar":"https://static001.geekbang.org/account/avatar/00/13/15/d7/96e77edd.jpg","nickname":"é—®å¿ƒ","note":"","ucode":"6808568D61CE36","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292952,"discussion_content":"ä¸€ä¸ªæ˜¯é’ˆå¯¹æ‰€æœ‰socketç”Ÿæ•ˆçš„ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹å•ä¸ªsocketç”Ÿæ•ˆçš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595393869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223927,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1591233771,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"10181168363","product_id":100051201,"comment_content":"å½“ å‘é€ FIN æŠ¥æ–‡åï¼Œé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ° ACK æŠ¥æ–‡å°±ä¼šé‡å‘ FIN, è¿™ä¸ª é•¿æ—¶é—´æ˜¯å“ªä¸ªå‚æ•°è¿›è¡Œæ§åˆ¶çš„ï¼Ÿ å°±æ˜¯å¤šé•¿æ—¶é—´ æ²¡æœ‰æ”¶åˆ° ACK æ‰ä¼šé‡å‘ã€‚ è¿™çš„è¯å°±å¯ä»¥åœ¨ç»“åˆ tcp_orphan_retries è¿™ä¸ªå‚æ•°å¯ä»¥ç®—å‡ºæ¥ä¸€ä¸ªä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´","like_count":2,"discussions":[{"author":{"id":1691214,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/4e/17fd7195.jpg","nickname":"TM","note":"","ucode":"9E03B9D177356A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293335,"discussion_content":"å–å†³äº RTO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595505215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219006,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1589932153,"is_pvip":false,"replies":[{"id":"80907","content":"ä¸æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„ä¼°å€¼ï¼Œæ‰€è°“æ¯ä¸€è·³ï¼Œæ˜¯æŒ‡æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ç½‘ç»œè®¾å¤‡ï¼Œå°†IPå¤´éƒ¨ä¸­çš„TTLå­—æ®µå‡å°‘1ï¼Œå¹¶ä¸ç­‰äº1ç§’ï¼Œé€šå¸¸æ¨èçš„TTLçš„åˆå§‹å€¼æ˜¯64","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1589935126,"ip_address":"","comment_id":219006,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10179866745","product_id":100051201,"comment_content":"TTLæ¯ä¸€è·³å‡å°‘1ï¼Œè¿™äº›æ€ä¹ˆå’ŒMSLå¯¹åº”èµ·æ¥å‘¢ï¼Œæ¯ä¸€è·³å‡å°‘çš„1ç›¸å½“äº1ç§’ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495648,"discussion_content":"ä¸æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„ä¼°å€¼ï¼Œæ‰€è°“æ¯ä¸€è·³ï¼Œæ˜¯æŒ‡æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ç½‘ç»œè®¾å¤‡ï¼Œå°†IPå¤´éƒ¨ä¸­çš„TTLå­—æ®µå‡å°‘1ï¼Œå¹¶ä¸ç­‰äº1ç§’ï¼Œé€šå¸¸æ¨èçš„TTLçš„åˆå§‹å€¼æ˜¯64","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589935126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258431,"user_name":"Geek_f1c894","can_delete":false,"product_type":"c1","uid":2243555,"ip_address":"","ucode":"B7FCB849FEDAF4","user_header":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaIpALTISCOftCIat5ej7QZlndkxTzhKmkvHWqMjvSKcuPZ0bmYkrWiaRXxja3hibwvjHgcLBvA9Uel/132","comment_is_top":false,"comment_ctime":1604424308,"is_pvip":false,"replies":[{"id":"94201","content":"è¿™å–å†³äºä¸»åŠ¨æ–¹è°ƒç”¨çš„æ˜¯closeè¿˜æ˜¯shutdownï¼š<br>1ã€è°ƒç”¨çš„æ˜¯closeï¼Œæ­¤æ—¶è¿æ¥å°†æˆä¸ºorphanï¼Œä¸€èˆ¬åœ¨ tcp_fin_timeoutç§’å·¦å³è¿æ¥ä¼šè¢«ç³»ç»Ÿå…³é—­ï¼›<br>2ã€è°ƒç”¨çš„æ˜¯shutdownï¼Œæ­¤æ—¶åªæœ‰TIME_WAITæ‰æœ‰2MSLé™åˆ¶ï¼ŒFIN_WAIT2å¯ä»¥é•¿æ—¶é—´å¤„äºæ­¤çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1604623759,"ip_address":"","comment_id":258431,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5899391604","product_id":100051201,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼æˆ‘åœ¨æƒ³ä¸»åŠ¨æ–¹å¤„äºFIN_WAIT2çŠ¶æ€ï¼Œè¢«åŠ¨æ–¹å¤„äºCLOSE_WAITï¼Œæ„å‘³å¯èƒ½æƒ³åœ¨åŠå…³é—­è¿æ¥ä¸Šæ¥æ”¶æ•°æ®ï¼Œä¸”æ²¡æœ‰é™åˆ¶CLOSE_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ï¼Œè‹¥è¢«åŠ¨æ–¹åœ¨CLOSE_WAITçŠ¶æ€è¿˜è¦å‘é€çš„æ•°æ®é‡è€—æ—¶è¶…è¿‡äº†2MSLæ—¶é—´ï¼Œæ­¤æ—¶ä¸»åŠ¨æ–¹æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ<br>æˆ‘çŒœæƒ³å¯èƒ½æƒ…å†µâ‘ ä¸»åŠ¨æ–¹æ¥æ”¶äº†ä¸ªå«æ•°æ®çš„æŠ¥æ–‡åé‡æ–°è®°æ—¶ï¼ˆæ”¶åˆ°æœ€æ–°æŠ¥æ–‡çš„æ—¶é—´å¼€å§‹è®°æ—¶2MSLæ—¶é—´ï¼‰ï¼Œç›´åˆ°åœ¨2MSLå†…æ”¶åˆ°FINåŒ…æˆ–æ²¡æ¥æ”¶åˆ°æ•°æ®åŠFINåŒ…åšè¶…æ—¶ç»“æŸè¿æ¥ã€‚â‘¡ä¸»åŠ¨æ–¹åœ¨è¿›å…¥FIN_WAIT2çŠ¶æ€çš„ä¸€åˆ†é’Ÿï¼ˆ2MSLï¼‰å†…èƒ½æ”¶åˆ°å¤šå°‘æ•°æ®å°±æ”¶åˆ°ï¼Œæ—¶é—´ä¸€åˆ°ç›´æ¥è¿›å…¥TIME_WAITçŠ¶æ€æˆ–è€…ç›´æ¥å…³é—­è¿æ¥","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508652,"discussion_content":"è¿™å–å†³äºä¸»åŠ¨æ–¹è°ƒç”¨çš„æ˜¯closeè¿˜æ˜¯shutdownï¼š\n1ã€è°ƒç”¨çš„æ˜¯closeï¼Œæ­¤æ—¶è¿æ¥å°†æˆä¸ºorphanï¼Œä¸€èˆ¬åœ¨ tcp_fin_timeoutç§’å·¦å³è¿æ¥ä¼šè¢«ç³»ç»Ÿå…³é—­ï¼›\n2ã€è°ƒç”¨çš„æ˜¯shutdownï¼Œæ­¤æ—¶åªæœ‰TIME_WAITæ‰æœ‰2MSLé™åˆ¶ï¼ŒFIN_WAIT2å¯ä»¥é•¿æ—¶é—´å¤„äºæ­¤çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604623759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222379,"user_name":"Geek_David","can_delete":false,"product_type":"c1","uid":1897719,"ip_address":"","ucode":"9B9F30BB2F2C68","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/f7/871ff71d.jpg","comment_is_top":false,"comment_ctime":1590766639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885733935","product_id":100051201,"comment_content":"ä¸€ç¯‡15åˆ†é’Ÿçš„éŸ³é¢‘ï¼Œè¶³è¶³èŠ±äº†1.5ä¸ªå°æ—¶<br>åŒ…æ‹¬å…ˆå¬éŸ³é¢‘ï¼Œå†çœ‹æ–‡å­—ï¼Œå†ç†è§£æ¯ä¸ªå«ä¹‰ï¼Œå†è®°ç¬”è®°<br>æˆ‘æ•¢è¯´æˆ‘æ‡‚äº†ã€‚<br>å‰ææ˜¯å¯¹TCPæƒ³è¿‡æ¯”è¾ƒäº†è§£çš„æƒ…å†µä¸‹ï¼Œå¤ªå—äº†","like_count":1},{"had_liked":false,"id":219197,"user_name":"æµæµªåœ°çƒ","can_delete":false,"product_type":"c1","uid":1498137,"ip_address":"","ucode":"25210DCD353F97","user_header":"https://static001.geekbang.org/account/avatar/00/16/dc/19/c058bcbf.jpg","comment_is_top":false,"comment_ctime":1589964948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5884932244","product_id":100051201,"comment_content":"MSLçš„æ•°å€¼åœ¨æ‰€æœ‰ç½‘ç»œç¯å¢ƒä¸­éƒ½ä¸€æ ·ï¼Œå¦‚æœä¸€äº›è·¨æ´‹çš„é•¿è·ç¦»ç½‘ç»œè¿™ä¸ªæ—¶é—´å¯ä»¥ä¿è¯å—ï¼Ÿå¦‚æœå‘ç°è¿™ä¸ªæ•°å€¼æ— æ³•ä¿è¯ï¼Œæ˜¯éœ€è¦è°ƒæ•´ç½‘ç»œä¼ è¾“å±‚æ¬¡ç»“æ„å—ï¼Ÿ<br>","like_count":1},{"had_liked":false,"id":219019,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1589933716,"is_pvip":false,"replies":[{"id":"90918","content":"æ˜¯çš„ï¼Œæ™®é€šæ•°æ®è¦æœ‰åºæ¥æ”¶ï¼Œä½†RSTä¸éœ€è¦æŒ‰seqåºå·å¤„ç†","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599785004,"ip_address":"","comment_id":219019,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884901012","product_id":100051201,"comment_content":"rstæŠ¥æ–‡çš„å‘é€æ˜¯æ¯”æ™®é€šæ•°æ®ä¼˜å…ˆçº§é«˜å—ï¼Œä¹Ÿå°±æ˜¯socketå¯¹ç«¯å¦‚æœå…ˆæ¥å—åˆ°rstï¼Œè¿™ä¸ªsocketå°±ä¸å¯è¯»ä¸å¯å†™äº†ï¼Œåé¢æ”¶åˆ°çš„æ•°æ®è‡ªç„¶ä¹Ÿæ²¡æ³•è¢«è¿›ç¨‹æ‹¿åˆ°äº†ã€‚","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495654,"discussion_content":"æ˜¯çš„ï¼Œæ™®é€šæ•°æ®è¦æœ‰åºæ¥æ”¶ï¼Œä½†RSTä¸éœ€è¦æŒ‰seqåºå·å¤„ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599785004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342665,"user_name":"JW","can_delete":false,"product_type":"c1","uid":1891437,"ip_address":"","ucode":"7B73FB16B999E1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/dc/6d/03130ea9.jpg","comment_is_top":false,"comment_ctime":1650410599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650410599","product_id":100051201,"comment_content":"ä¸åŒç³»ç»Ÿçš„TTLä¸ä¸€æ ·ï¼Œ30ç§’æ˜¯æ¯”è¾ƒå°‘çš„","like_count":0},{"had_liked":false,"id":313434,"user_name":"ezekiel","can_delete":false,"product_type":"c1","uid":1158795,"ip_address":"","ucode":"AB4AB6FA8612D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/8b/43ce01ca.jpg","comment_is_top":false,"comment_ctime":1632442101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632442101","product_id":100051201,"comment_content":"å¦‚æœä¸»åŠ¨æ–¹ä¸ä¿ç•™ TIME_WAIT çŠ¶æ€ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿæ­¤æ—¶è¿æ¥çš„ç«¯å£æ¢å¤äº†è‡ªç”±èº«ï¼Œå¯ä»¥å¤ç”¨äºæ–°è¿æ¥äº†ã€‚ç„¶è€Œï¼Œè¢«åŠ¨æ–¹çš„ FIN æŠ¥æ–‡å¯èƒ½å†æ¬¡åˆ°è¾¾ï¼Œè¿™æ—¢å¯èƒ½æ˜¯ç½‘ç»œä¸­çš„è·¯ç”±å™¨é‡å¤å‘é€ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¢«åŠ¨æ–¹æ²¡æ”¶åˆ° ACK æ—¶åŸºäº tcp_orphan_retries å‚æ•°é‡å‘ã€‚è¿™æ ·ï¼Œæ­£å¸¸é€šè®¯çš„æ–°è¿æ¥å°±å¯èƒ½è¢«é‡å¤å‘é€çš„ FIN æŠ¥æ–‡è¯¯å…³é—­ã€‚<br>-----------------------------------------------------------------------------------------------------<br>æŠ¥æ–‡ä¸éƒ½æ˜¯æœ‰ç¼–å·çš„å—ï¼Ÿé‡æ–°å¯ç”¨çš„ç«¯å£ï¼Œä¼šå¤„ç†è¿‡æœŸçš„æŠ¥æ–‡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":302717,"user_name":"Foxyier","can_delete":false,"product_type":"c1","uid":1056563,"ip_address":"","ucode":"4F3187BF609C2D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsUJP9VV8iaZOuQxfRgzUvxqA09EjlCHfdDGSof9ibXWxpPjl6UpjEsWtTTbiay0RrKjrp814wnibkkQ/132","comment_is_top":false,"comment_ctime":1626344472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626344472","product_id":100051201,"comment_content":"æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡çœ‹æ‡‚ï¼Œ æ–‡ä¸­å…ˆè¯´äº†ã€Œäº’è”ç½‘ä¸­å¾€å¾€æœåŠ¡å™¨æ‰æ˜¯ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹ã€ï¼Œåç»­çš„å†…å®¹ä¸­åˆæŠŠå®¢æˆ·ç«¯ç§°ä¸ºä¸»åŠ¨æ–¹ï¼ŒæœåŠ¡ç«¯ç§°ä¸ºè¢«åŠ¨æ–¹ã€‚ æ‰€ä»¥æœ‰ä¸€äº›æ··ä¹±ï¼Œ å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ä¸­åˆ°åº•æ˜¯è°å…ˆå…³é—­çš„è¿æ¥ã€‚","like_count":0},{"had_liked":false,"id":294985,"user_name":"ç¥ç»è›™","can_delete":false,"product_type":"c1","uid":2633165,"ip_address":"","ucode":"FF28978EC59DB5","user_header":"https://static001.geekbang.org/account/avatar/00/28/2d/cd/f4a16584.jpg","comment_is_top":false,"comment_ctime":1622171350,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622171350","product_id":100051201,"comment_content":"è€å¸ˆå¥½ï¼Œtcp_tw_reuse é…åˆ tcp_timestamps å¯ä»¥ä½œä¸ºå®¢æˆ·ç«¯æ¥å¤ç”¨TIME_WAITçš„ç«¯å£ã€‚é‚£ä¹ˆä½œä¸ºæœåŠ¡ç«¯ï¼Œåº”è¯¥æ€ä¹ˆæ¥å‡å°‘TIME_WAITçš„çŠ¶æ€å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":288469,"user_name":"liutebin","can_delete":false,"product_type":"c1","uid":2284235,"ip_address":"","ucode":"D35FEDE320B4F4","user_header":"https://static001.geekbang.org/account/avatar/00/22/da/cb/02bf0f14.jpg","comment_is_top":false,"comment_ctime":1618481695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618481695","product_id":100051201,"comment_content":"è¿™ä¸€èŠ‚å¹²è´§æ»¡æ»¡ï¼å…‰çœ‹è¿™äº›çŸ¥è¯†ï¼Œå´å¾ˆå°‘åœ¨å·¥ä½œä¸­è¿ç”¨ã€‚è€å¸ˆæœ‰æ²¡æœ‰å¥½çš„åŠæ³•ï¼Œè®©æˆ‘ä»¬è‡ªå·±å¯ä»¥æ¨¡æ‹Ÿè¿™äº›é—®é¢˜ï¼Œå¹¶è°ƒä¼˜å®è·µã€‚","like_count":0},{"had_liked":false,"id":284289,"user_name":"butterfly","can_delete":false,"product_type":"c1","uid":1392924,"ip_address":"","ucode":"1B724973303FB0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rRCSdTPyqWcW6U8DO9xL55ictNPlbQ38VAcaBNgibqaAhcH7mn1W9ddxIJLlMiaA5sngBicMX02w2HP5pAWpBAJsag/132","comment_is_top":false,"comment_ctime":1616150740,"is_pvip":false,"replies":[{"id":"103196","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1616330414,"ip_address":"","comment_id":284289,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1616150740","product_id":100051201,"comment_content":"åœ¨ä¸»åŠ¨æ–¹å¤„äº TIME_WAITçŠ¶æ€æ—¶ï¼Œå¦‚æœè¿‡äº†2MSLæ—¶é—´ï¼Œè¿˜æ˜¯æœ‰FINä¼ æ¥ï¼Œé‚£ä¸æ˜¯å¯¹æ–°è¿æ¥è¿˜æ˜¯æœ‰å½±å“å—","like_count":0,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517300,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616330414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242577,"user_name":"xdargs","can_delete":false,"product_type":"c1","uid":1063740,"ip_address":"","ucode":"EB8326D3A72DE5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoH9Mlw0kLK0p39vhQpdvkbQP5TX96DB9HMJ1POaTVDpMZg4rjlO3WCAqiaWWMc77ffS3vTo8qWdXA/132","comment_is_top":false,"comment_ctime":1597766260,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1597766260","product_id":100051201,"comment_content":"ä¸€ç›´æ”’ç€æ²¡çœ‹ï¼Œåªæ˜¯å¬çš„è¯æ•ˆæœä¸å¤§ï¼Œæ¯æ¬¡äº§ç”Ÿå¤§é‡TIME_WAITå’ŒCLOSE_WAITå°±è¦å»æŸ¥ä¸€éåˆ°åº•æ˜¯è°çš„é—®é¢˜ï¼Œä¸€çŸ¥åŠè§£ä¸¤ä¸‰å¹´ï¼Œä¸Šä¸€ç¯‡åŠ è¿™ä¸€ç¯‡ç†é¡ºäº†è‡ªå·±å¥½ä¹…çš„æ¨¡å‡Œä¸¤å¯","like_count":0},{"had_liked":false,"id":235681,"user_name":"Douglas","can_delete":false,"product_type":"c1","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1595148567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595148567","product_id":100051201,"comment_content":"ã€å½“ç„¶ï¼Œtcp_max_tw_buckets ä¹Ÿä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œæ¯•ç«Ÿå†…å­˜å’Œç«¯å£å·éƒ½æ˜¯æœ‰é™çš„ã€‚æœ‰æ²¡æœ‰åŠæ³•è®©æ–°è¿æ¥å¤ç”¨ TIME_WAIT çŠ¶æ€çš„ç«¯å£å‘¢ï¼Ÿå¦‚æœæœåŠ¡å™¨ä¼šä¸»åŠ¨å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘èµ·è¿æ¥çš„è¯ï¼Œå°±å¯ä»¥æŠŠ tcp_tw_reuse å‚æ•°è®¾ç½®ä¸º 1ï¼Œå®ƒå…è®¸ä½œä¸ºå®¢æˆ·ç«¯çš„æ–°è¿æ¥ï¼Œåœ¨å®‰å…¨æ¡ä»¶ä¸‹ä½¿ç”¨ TIME_WAIT çŠ¶æ€ä¸‹çš„ç«¯å£ã€‚ã€‘ æ–‡ç« çš„æ„æ€ã€å¦‚æœæœåŠ¡å™¨ä¼šä¸»åŠ¨å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘èµ·è¿æ¥çš„è¯ã€‘ æ˜¯ï¼Œåªæœ‰ä¸»åŠ¨å‘èµ·è¿æ¥çš„ä¸€ç«¯ï¼Œæ‰å¯ä»¥å¤ç”¨è¿™ä¸ªç«¯å£ä¹ˆ","like_count":0},{"had_liked":false,"id":230218,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1593315664,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1593315664","product_id":100051201,"comment_content":"â€œæœ‰æ²¡æœ‰åŠæ³•è®©æ–°è¿æ¥å¤ç”¨ TIME_WAIT çŠ¶æ€çš„ç«¯å£å‘¢ï¼Ÿâ€<br>---------------------------------------------------------------<br>è€å¸ˆï¼ŒTCPçš„çŠ¶æ€ä¸ç«¯å£ä¹‹é—´ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™å—è¡¨é¢çŸ¥é“æœ‰ç‚¹å…³ç³»ä½†æ˜¯æœ‰ç‚¹æ¨¡ç³Šã€‚","like_count":0,"discussions":[{"author":{"id":1962148,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f0/a4/9d8c3dc3.jpg","nickname":"åŠç”Ÿ","note":"","ucode":"8F6BA3CA1AC1B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302473,"discussion_content":"ã€Šç½‘ç»œæ˜¯æ€ä¹ˆè¿æ¥çš„ã€‹å»ºè®®å»çœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598930029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1962148,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f0/a4/9d8c3dc3.jpg","nickname":"åŠç”Ÿ","note":"","ucode":"8F6BA3CA1AC1B2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302491,"discussion_content":"å¤šè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598934539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302473,"ip_address":""},"score":302491,"extra":""}]}]},{"had_liked":false,"id":229864,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1593168726,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593168726","product_id":100051201,"comment_content":"å¦‚æœè®¾ç½®äº†SO_LINGERé€‰é¡¹ä¸”è¶…æ—¶æ—¶é—´å¤§äº0ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´ä¹‹å†…å‘å®Œäº†ç¼“å†²åŒºçš„æ•°æ®ï¼Œä¹‹åæ˜¯ä¸æ˜¯èµ°æ­£å¸¸çš„4æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ å››æ¬¡æŒ¥æ‰‹å¦‚æœå†è¶…æ—¶çš„è¯æ‰ç›´æ¥å‘rst ï¼Ÿ <br><br>è€å¸ˆå¾—è¯¾åé—®é¢˜ä¸­è¯´SO_LINGER é€‰é¡¹å¸Œæœ›ç”¨å››æ¬¡æŒ¥æ‰‹ä»£æ›¿rstå…³é—­è¿æ¥çš„æ–¹å¼ã€‚åº”è¯¥æ˜¯æƒ³è¯´ç”¨rstä»£æ›¿å››æ¬¡æŒ¥æ‰‹å§ï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"å®‰æ’","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286475,"discussion_content":"è¿™ä¸ªæŸ¥äº†ä¸€ä¸‹unpï¼Œåœ¨è¶…æ—¶æ—¶é—´ä¹‹å†…å‘å®Œç¼“å†²åŒºçš„æ•°æ®åæ˜¯ä¼šèµ°æ­£å¸¸4æ¬¡æŒ¥æ‰‹çš„ã€‚\nunpç¬¬ä¸‰ç‰ˆ162é¡µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593182840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229554,"user_name":"é™ˆå…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1043706,"ip_address":"","ucode":"B3D4AD3D52F896","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/fa/dceae1c9.jpg","comment_is_top":false,"comment_ctime":1593056696,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593056696","product_id":100051201,"comment_content":"è¯·é—®å®‰å…¨å¤ç”¨çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼ŸSO_REUSEADDRæ˜¯ä¸æ˜¯åšä¸åˆ°å®‰å…¨å¤ç”¨ï¼Ÿ","like_count":0},{"had_liked":false,"id":224913,"user_name":"è´æ°å€­ç‹çŒ´","can_delete":false,"product_type":"c1","uid":1100690,"ip_address":"","ucode":"0A89A70C48629C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/92/cfc1cfd3.jpg","comment_is_top":false,"comment_ctime":1591591165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591591165","product_id":100051201,"comment_content":"â€œå¦‚æœæœåŠ¡å™¨ä¼šä¸»åŠ¨å‘ä¸Šæ¸¸æœåŠ¡å™¨å‘èµ·è¿æ¥çš„è¯ï¼Œå°±å¯ä»¥æŠŠ tcp_tw_reuse å‚æ•°è®¾ç½®ä¸º 1ï¼Œå®ƒå…è®¸ä½œä¸ºå®¢æˆ·ç«¯çš„æ–°è¿æ¥ï¼Œåœ¨å®‰å…¨æ¡ä»¶ä¸‹ä½¿ç”¨ TIME_WAIT çŠ¶æ€ä¸‹çš„ç«¯å£ã€‚â€ é—®ä¸‹ä»€ä¹ˆæƒ…å†µè¿˜æ˜¯å®‰å…¨æ¡ä»¶å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":224053,"user_name":"LubinLew","can_delete":false,"product_type":"c1","uid":1995285,"ip_address":"","ucode":"F30A4933C021BA","user_header":"https://static001.geekbang.org/account/avatar/00/1e/72/15/a8b97a39.jpg","comment_is_top":false,"comment_ctime":1591263084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591263084","product_id":100051201,"comment_content":"æé—®ï¼Œå½“ä¸»åŠ¨æ–¹å…³é—­è¿æ¥æ—¶ï¼Œè¢«åŠ¨æ–¹ä»ç„¶å¯ä»¥åœ¨ä¸è°ƒç”¨ close å‡½æ•°çš„çŠ¶æ€ä¸‹ï¼Œé•¿æ—¶é—´å‘é€æ•°æ®ï¼Œæ­¤æ—¶è¿æ¥å¤„äºåŠå…³é—­çŠ¶æ€ã€‚è¿™ä¸€ç‰¹æ€§æ˜¯ TCP çš„åŒå‘é€šé“äº’ç›¸ç‹¬ç«‹æ‰€è‡´ï¼Œå´ä¹Ÿä½¿å¾—å…³é—­è¿æ¥å¿…é¡»é€šè¿‡å››æ¬¡æŒ¥æ‰‹æ‰èƒ½åšåˆ°ã€‚<br><br>è¿™é‡ŒæŒ‡çš„æ˜¯ä¸»åŠ¨æ–¹è°ƒç”¨ shudown(fd,SHUT_WR) è¿™ç§ç‰¹æ®Šæƒ…å†µå§","like_count":0},{"had_liked":false,"id":223354,"user_name":"î€","can_delete":false,"product_type":"c1","uid":1990630,"ip_address":"","ucode":"82813BD666EFBD","user_header":"https://static001.geekbang.org/account/avatar/00/1e/5f/e6/8a5f9951.jpg","comment_is_top":false,"comment_ctime":1591070057,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1591070057","product_id":100051201,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¯·é—®æœåŠ¡ç«¯çš„æ¥æ”¶çª—å£æ˜¯é’ˆå¯¹æ‰€æœ‰å®¢æˆ·ç«¯çš„TCPè¿æ¥è¿˜æ˜¯å•ä¸ªTCPè¿æ¥ï¼Œå¦‚æœæ˜¯å®¢æˆ·ç«¯æ‰€æœ‰çš„TCPè¿æ¥ï¼Œé‚£è¿™ä¸ªSQEå¦‚ä½•ä¿æŒæœ‰åºï¼Œå¦‚æœ‰æ˜¯å•ä¸ªè¿æ¥åˆå¦‚ä½•æŠŠæ¥æ”¶çª—å£å æ»¡","like_count":0},{"had_liked":false,"id":220717,"user_name":"Cola","can_delete":false,"product_type":"c1","uid":1505237,"ip_address":"","ucode":"633538F8D1009E","user_header":"https://static001.geekbang.org/account/avatar/00/16/f7/d5/e63ee90f.jpg","comment_is_top":false,"comment_ctime":1590311776,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590311776","product_id":100051201,"comment_content":"æœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼Œå…³äºso_lingeré€‰é¡¹ï¼Œåœ¨ä¸€ä¸ªç½‘ç»œæ¡†æ¶æœåŠ¡ç«¯æºç ä¸Šçœ‹åˆ°é’ˆå¯¹ç›‘å¬socketï¼Œä¼šè®¾ç½®l_onff=1, l_linger=0ï¼Œé’ˆå¯¹acceptä¹‹åå»ºç«‹çš„è¿æ¥socketï¼Œä¼šè®¾ç½®l_onff=0, l_linger=0ï¼Œè¿™é‡Œçš„ç”¨æ„æ˜¯ä»€ä¹ˆå‘¢ï¼Œl_onff=1, l_linger=0å¯ä»¥é¿å…TWçŠ¶æ€ï¼Œä½†æ˜¯åœ¨ç›‘å¬socketä¸Šå¦‚æ­¤è®¾ç½®è¿˜æ˜¯è¿™ä¸ªç›®çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":219086,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1589941994,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1589941994","product_id":100051201,"comment_content":"è¯·é—®ä¸€ä¸ªå…³äºrstçš„é—®é¢˜ï¼Œä¸Šç¯‡æ–‡ç« æåˆ°è¿‡accepté˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œä¼šå‘rstã€‚è¿™é‡Œæåˆ° tcp_max_orphans å‚æ•°ï¼Œå¦‚æœå­¤å„¿è¿æ¥æ•°é‡å¤§äºå®ƒï¼Œæ–°å¢çš„å­¤å„¿è¿æ¥å°†ä¸å†èµ°å››æ¬¡æŒ¥æ‰‹ï¼Œè€Œæ˜¯ç›´æ¥å‘é€ RST å¤ä½æŠ¥æ–‡å¼ºåˆ¶å…³é—­ã€‚æˆ‘ä»¬åœ¨å‘é€httpè¯·æ±‚æ—¶ï¼Œä¼šé‡åˆ°rest by peerï¼Œæ˜¯å¯¹åº”è¿™ä¸ªæ¶ˆæ¯ä¹ˆï¼Ÿå¦å¤–æ€ä¹ˆåŒºåˆ†æ˜¯ç”±äºaccepté˜Ÿåˆ—æ»¡è¿˜æ˜¯ç”±äºå­¤å„¿è¿›ç¨‹æ•°é‡å¤šï¼Œå¯¼è‡´rstå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282532,"discussion_content":"1. acceptæ»¡æœ‰ä¸¤ç§å¯èƒ½çš„è¡Œä¸ºï¼Œå¿½ç•¥ å’Œ rst,å–å†³äºabortå‚æ•°ã€‚é€šå¸¸ä¸å»ºè®®å¼€å¯ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯å¿½ç•¥ã€‚ 2.æŠ“åŒ…ï¼Œä¸¤è€…rstå‘é€çš„é˜¶æ®µä¸ä¸€æ ·ï¼ŒæŠ“åŒ…çœ‹ä¸‹å°±çŸ¥é“æ˜¯å»ºè¿è¿˜æ˜¯æŒ¥æ‰‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592010174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1578718,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/diaGeaLuw3oTAcyFMnkiaVur33RXdUZL8z1LtfHibIyh4r629YSexJQz5JXYjBH7v9rwHH7ham5CzqDZF75QnGIwg/132","nickname":"é‡æ€§åŠ›é‡","note":"","ucode":"B6C152FA332B14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273039,"discussion_content":"ä¸€èˆ¬é»˜è®¤æ˜¯ä¸¢ACKï¼Œå®¢æˆ·ç«¯å·²ç»å»ºç«‹äº†ã€‚æœåŠ¡ç«¯æœ‰abortå‚æ•°å¯ä»¥æ§åˆ¶æ¢å¤RSTã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590398308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1784256,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/39/c0/9c465545.jpg","nickname":"wchb","note":"","ucode":"49D94DFC61E9DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270642,"discussion_content":"accepté˜Ÿåˆ—æ»¡ï¼Œåªä¼šä¸¢å¼ƒåŒ…å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590031826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219061,"user_name":"å”æœé¦–éƒ½","can_delete":false,"product_type":"c1","uid":1081233,"ip_address":"","ucode":"F72655AE0AE4CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/91/962eba1a.jpg","comment_is_top":false,"comment_ctime":1589938407,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1589938407","product_id":100051201,"comment_content":"ï¼ˆ1ï¼‰é—®é¢˜1 ï¼šFIN_WAIT1çŠ¶æ€çš„è¿æ¥æ•°è¾ƒå¤š<br>åŸå› 1ï¼šå› é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°è¢«åŠ¨æ–¹çš„ACKï¼šé‡å‘æ¬¡æ•°æ§åˆ¶tcp_orphan_retriesï¼Œé™ä½é‡å‘æ¬¡æ•°ã€‚<br>åŸå› 2ï¼šFINä¿¡æ¯å‘ä¸å‡ºå»<br>è°ƒæ•´tcp_max_orphanså‚æ•°ï¼Œå½“å­¤å„¿è¿æ¥æ•°å¤§äºå®ƒæ—¶ï¼Œæ–°å¢çš„å­¤å„¿è¿æ¥æ•°ä¸åœ¨èµ°å››æ¬¡æŒ¥æ‰‹ï¼Œç›´æ¥å‘é€RSTæŠ¥æ–‡å¼ºåˆ¶å…³é—­ã€‚<br>ï¼ˆ2ï¼‰é—®é¢˜2ï¼šTIME_WAITçŠ¶æ€çš„è¿æ¥æ•°å¤š<br>net.ipv4.tcp_max_tw_buckets åˆç†æ§åˆ¶å…¶æ•°é‡<br>net.ipv4.tcp_tw_reuse = 1 ï¼Œnet.ipv4.tcp_timestamps = 1 å¤„äºTIME_WAITçŠ¶æ€çš„ç«¯å£å¯ä»¥å¤ç”¨ä¸ºå®¢æˆ·ç«¯è¿æ¥<br>ï¼ˆ3ï¼‰é—®é¢˜3ï¼šé•¿æ—¶é—´å¤„äºCLOSE_WAIT<br>åŸå› 1ï¼šç¨‹åºbug<br>åŸå› 2ï¼šè´Ÿè½½é«˜","like_count":0},{"had_liked":false,"id":219040,"user_name":"@Hy","can_delete":false,"product_type":"c1","uid":1154574,"ip_address":"","ucode":"D2DC363F18516D","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/0e/682dd305.jpg","comment_is_top":false,"comment_ctime":1589936947,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589936947","product_id":100051201,"comment_content":"å½“ç„¶ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¹¶ä¸ä½¿ç”¨ shutdown å‡½æ•°å…³é—­è¿æ¥ï¼Œæ‰€ä»¥ï¼Œå½“ä½ ç”¨ netstat å‘½ä»¤å‘ç°å¤§é‡ CLOSE_WAIT çŠ¶æ€æ—¶ï¼Œè¦ä¹ˆæ˜¯ç¨‹åºå‡ºç°äº† Bugï¼Œread å‡½æ•°è¿”å› 0 æ—¶å¿˜è®°è°ƒç”¨ close å‡½æ•°å…³é—­è¿æ¥ï¼Œè¦ä¹ˆå°±æ˜¯ç¨‹åºè´Ÿè½½å¤ªé«˜ï¼Œclose å‡½æ•°æ‰€åœ¨çš„å›è°ƒå‡½æ•°è¢«å»¶è¿Ÿæ‰§è¡Œäº†ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åº”å½“åœ¨åº”ç”¨ä»£ç å±‚é¢è§£å†³é—®é¢˜ã€‚<br><br>è¿™æ˜¯å¾ˆå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼","like_count":0}]}