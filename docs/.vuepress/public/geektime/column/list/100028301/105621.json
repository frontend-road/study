{"id":105621,"title":"23 | [视频]导读lua-resty-requests：优秀的lua-resty-*是如何编写的？","content":"<p><video poster=\"https://static001.geekbang.org/resource/image/65/c2/6565cf0a87645948ef66c547192db3c2.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/fe4a99b62946f2c31c2095c167b26f9c/3d0d7df0-16ce81ba96a-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\"https://media001.geekbang.org/ed7db4a5658b4ed59f225967841c31f8/e7f659c5c1864bb3bde42a4c200eab4b-d5090411129213bc3a3a2d388e0daa0b-sd.m3u8\" type=\"application/x-mpegURL\"><source src=\"https://media001.geekbang.org/ed7db4a5658b4ed59f225967841c31f8/e7f659c5c1864bb3bde42a4c200eab4b-3d9bf901ccefc4abb20c7469df8134d4-hd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>你好，我是温铭。</p><p>今天的内容，我同样会以视频的形式来讲解。老规矩，在你进行视频学习之前，先问你这么几个问题：</p><ul>\n<li>面对多个相同功能的 lua-resty 库，我们应该从哪些方面来选择？</li>\n<li>如何来组织一个 lua-resty 的结构？</li>\n</ul><p>这几个问题，也是今天视频课要解决的核心内容，希望你可以先自己思考一下，并带着问题来学习今天的视频内容。</p><p>同时，我会给出相应的文字介绍，方便你在听完视频内容后，及时总结与复习。下面是今天这节课的文字介绍部分。</p><h2>今日核心</h2><p>前面我们介绍过的 lua-resty 库都是官方自带的，但在 HTTP client 这个最常用的库上，官方并没有。这时候，我们就得自己来选择一个优秀的第三方库了。</p><p>那么，如何在众多的 lua-resty HTTP client 中，选择一个最好、最适合自己的第三方库呢？</p><p>这时候，你就需要综合考虑活跃度、作者、测试覆盖度、接口封装等各方面的因素了。我最后选择的是 lua-resty-requests（<a href=\"https://github.com/tokers/lua-resty-requests\">https://github.com/tokers/lua-resty-requests</a>），它是由又拍云的工程师 tokers 贡献的，我个人很喜欢它的接口风格，也推荐给你。</p><p>在视频中我会从最简单的 get 接口入手，结合文档、测试案例和源码，来逐步展开。你可以看到一个优秀的 lua-resty 库是如何编写的，有哪些可以借鉴的地方。</p><!-- [[[read_end]]] --><h2>课件参考</h2><p>今天的课件已经上传到了我的GitHub上，你可以自己下载学习。</p><p>链接如下：<a href=\"https://github.com/iresty/geektime-slides\">https://github.com/iresty/geektime-slides</a></p><p>如果有不清楚的地方，你可以在留言区提问，另也可以在留言区分享你的学习心得。期待与你的对话，也欢迎你把这篇文章分享给你的同事、朋友，我们一起交流、一起进步。</p>","neighbors":{"left":{"article_title":"22 | [视频]从一个安全漏洞说起，探寻API性能和安全的平衡","id":105615},"right":{"article_title":"24 | 实战：处理四层流量，实现Memcached Server","id":107937}},"comments":[{"had_liked":false,"id":116972,"user_name":"shengsheng","can_delete":false,"product_type":"c1","uid":1198582,"ip_address":"","ucode":"D15DF751F7C0E6","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/f6/ef3e5c81.jpg","comment_is_top":false,"comment_ctime":1563949278,"is_pvip":false,"replies":[{"id":"42823","content":"vscode 里面有付费的插件，但我并没有用过。我都是用最原始的 log 和 say 来调试的。","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1563973099,"ip_address":"","comment_id":116972,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18743818462","product_id":100028301,"comment_content":"请问有没比较方便的调试过程，例如一些ide， 每次写完都要重启nginx才能看到效果。","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459759,"discussion_content":"vscode 里面有付费的插件，但我并没有用过。我都是用最原始的 log 和 say 来调试的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563973099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1511915,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/mcwuUzkL4A67KicNq4ejAzH2lRd2nJDkHiajJ6w0Dlicfjd9yXxvUhibSxZAN507biaMEPkbCTr5jD4qfGqp59GtrwQ/132","nickname":"呦呦","note":"","ucode":"D3A588A164B4EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239241,"discussion_content":"开发的时候在配置文件引入lua文件，然后关闭缓存，这样就不用每次改了代码重启了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587286688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114506,"user_name":"Geek_e553fa","can_delete":false,"product_type":"c1","uid":1509816,"ip_address":"","ucode":"84842B909749A0","user_header":"","comment_is_top":false,"comment_ctime":1563326919,"is_pvip":false,"replies":[{"id":"42836","content":"OpenResty 的作者使用的是 vim，我用的是 vs code","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1563973755,"ip_address":"","comment_id":114506,"utype":1}],"discussion_count":9,"race_medal":0,"score":"5858294215","product_id":100028301,"comment_content":"你们都用什么工具写openresty  代码呢？<br>没有找到任何文章任何人说这个事情啊<br>我现在都是vim里面写任何调试。真的很麻烦","like_count":2,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458693,"discussion_content":"OpenResty 的作者使用的是 vim，我用的是 vs code","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563973755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1371941,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLMDBq7lqg9ZasC4f21R0axKJRVCBImPKlQF8yOicLLXIsNgsZxsVyN1mbvFOL6eVPluTNgJofwZeA/132","nickname":"Run","note":"","ucode":"6738D2F36ACFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":141244,"discussion_content":"使用GoLand + Lua插件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579405192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546612,"avatar":"https://static001.geekbang.org/account/avatar/00/17/99/74/0203bf17.jpg","nickname":"英雄","note":"","ucode":"D1033C83C6CDE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2789,"discussion_content":"vs code 买一个luaIDE 五块钱一个月","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563936088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1551776,"avatar":"","nickname":"zyonline","note":"","ucode":"3D8FE33FEB3D28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2602,"discussion_content":"pycharm 有openresty的插件，也是可以用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563784083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1458885,"avatar":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","nickname":"John","note":"","ucode":"ECACBE31D5D1A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2499,"discussion_content":"notepad++ 通过ftp插件直连一台linux服务器编辑代码，lua code cache设置为off，保存自动生效，使用postman发送请求，通过error 和say输出调试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563724870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1219496,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","nickname":"Leon📷","note":"","ucode":"B9BBD1EFAAE5A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2436,"discussion_content":"我也是vim，直接用tmux开两个窗口，上面改lua文件，下面用curl执行不就看到结果了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563613371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203524,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/44/74173e02.jpg","nickname":"莫然","note":"","ucode":"92F6B735C5E1B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2302,"discussion_content":"Sublime Text3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563445227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1140933,"avatar":"https://static001.geekbang.org/account/avatar/00/11/68/c5/3cdf2390.jpg","nickname":"洛戈","note":"","ucode":"9AADB5FFEF5566","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2245,"discussion_content":"ZeroBrane Studio Lua IDE   可以调试openResty的代码，官网有说明","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563410157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1545509,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cnNBSrNVDiagXWXkdWPnRxFh4D8oIbgnbiaA8WhIMkfI2vmemzTX3001YibnaPXHMRmCP5S6cGA7oHHLPHRBricr8g/132","nickname":"Netfeel","note":"","ucode":"E92F9ED37849A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2180,"discussion_content":"我用VSCODE写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563332257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326938,"user_name":"Peter","can_delete":false,"product_type":"c1","uid":1595382,"ip_address":"","ucode":"A77322C4E07B2D","user_header":"https://static001.geekbang.org/account/avatar/00/18/57/f6/2c7ac1ad.jpg","comment_is_top":false,"comment_ctime":1639783853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639783853","product_id":100028301,"comment_content":"老师lua_package_path 和 LUA_PATH 这两个系统变量好像没讲过啊，具体是什么意思，起什么作用","like_count":0},{"had_liked":false,"id":114589,"user_name":"John","can_delete":false,"product_type":"c1","uid":1458885,"ip_address":"","ucode":"ECACBE31D5D1A7","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","comment_is_top":false,"comment_ctime":1563346182,"is_pvip":false,"replies":[{"id":"42835","content":"resty 有一个 -I 的指令：<br>-I DIR              Add dir to the search paths for Lua libraries.<br>可以添加 lua_package_path 的路径。","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1563973724,"ip_address":"","comment_id":114589,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563346182","product_id":100028301,"comment_content":"老师，请问，resty -e 测试时 如何加载nginx.conf 中的环境配置，比如 lua_package_path","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458737,"discussion_content":"resty 有一个 -I 的指令：\n-I DIR              Add dir to the search paths for Lua libraries.\n可以添加 lua_package_path 的路径。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563973724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013283,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","nickname":"空知","note":"","ucode":"C448E98238DD36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2269,"discussion_content":"定义全局变量 package.path 或 系统变量LUA_PATH","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563421970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}