{"id":234930,"title":"26 | æ•°æ®å­˜å‚¨ï¼šNoSQLä¸RDBMSå¦‚ä½•å–é•¿è¡¥çŸ­ã€ç›¸è¾…ç›¸æˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠèŠæ•°æ®å­˜å‚¨çš„å¸¸è§é”™è¯¯ã€‚</p><p>è¿‘å‡ å¹´ï¼Œå„ç§éå…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯NoSQLå‘å±•è¿…çŒ›ï¼Œåœ¨é¡¹ç›®ä¸­ä¹Ÿéå¸¸å¸¸è§ã€‚å…¶ä¸­ä¸ä¹ä¸€äº›ä½¿ç”¨ä¸Šçš„æç«¯æƒ…å†µï¼Œæ¯”å¦‚ç›´æ¥æŠŠå…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰å…¨éƒ¨æ›¿æ¢ä¸ºNoSQLï¼Œæˆ–æ˜¯åœ¨ä¸åˆé€‚çš„åœºæ™¯ä¸‹é”™è¯¯åœ°ä½¿ç”¨NoSQLã€‚</p><p>å…¶å®ï¼Œæ¯ç§NoSQLçš„ç‰¹ç‚¹ä¸åŒï¼Œéƒ½æœ‰å…¶è¦ç€é‡è§£å†³çš„æŸä¸€æ–¹é¢çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨NoSQLçš„æ—¶å€™ï¼Œè¦å°½é‡è®©å®ƒå»å¤„ç†æ“…é•¿çš„åœºæ™¯ï¼Œå¦åˆ™ä¸ä½†å‘æŒ¥ä¸å‡ºå®ƒçš„åŠŸèƒ½å’Œä¼˜åŠ¿ï¼Œè¿˜å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p><p>NoSQLä¸€èˆ¬å¯ä»¥åˆ†ä¸ºç¼“å­˜æ•°æ®åº“ã€æ—¶é—´åºåˆ—æ•°æ®åº“ã€å…¨æ–‡æœç´¢æ•°æ®åº“ã€æ–‡æ¡£æ•°æ®åº“ã€å›¾æ•°æ®åº“ç­‰ã€‚ä»Šå¤©ï¼Œæˆ‘ä¼šä»¥ç¼“å­˜æ•°æ®åº“Redisã€æ—¶é—´åºåˆ—æ•°æ®åº“InfluxDBã€å…¨æ–‡æœç´¢æ•°æ®åº“ElasticSearchä¸ºä¾‹ï¼Œé€šè¿‡ä¸€äº›æµ‹è¯•æ¡ˆä¾‹ï¼Œå’Œä½ èŠèŠè¿™äº›å¸¸è§NoSQLçš„ç‰¹ç‚¹ï¼Œä»¥åŠå®ƒä»¬æ“…é•¿å’Œä¸æ“…é•¿çš„åœ°æ–¹ã€‚æœ€åï¼Œæˆ‘ä¹Ÿè¿˜ä¼šå’Œä½ è¯´è¯´NoSQLå¦‚ä½•ä¸RDBMSç›¸è¾…ç›¸æˆï¼Œæ¥æ„æˆä¸€å¥—å¯ä»¥åº”å¯¹é«˜å¹¶å‘çš„å¤åˆæ•°æ®åº“ä½“ç³»ã€‚</p><h2>å–é•¿è¡¥çŸ­ä¹‹ Redis vs MySQL</h2><p>Redisæ˜¯ä¸€æ¬¾è®¾è®¡ç®€æ´çš„ç¼“å­˜æ•°æ®åº“ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¯»å†™å•ä¸€Keyçš„æ€§èƒ½éå¸¸é«˜ã€‚</p><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªç®€å•æµ‹è¯•ï¼Œåˆ†åˆ«å¡«å……10ä¸‡æ¡æ•°æ®åˆ°Rediså’ŒMySQLä¸­ã€‚MySQLä¸­çš„nameå­—æ®µåšäº†ç´¢å¼•ï¼Œç›¸å½“äºRedisçš„Keyï¼Œdataå­—æ®µä¸º100å­—èŠ‚çš„æ•°æ®ï¼Œç›¸å½“äºRedisçš„Valueï¼š</p><!-- [[[read_end]]] --><pre><code>@SpringBootApplication\n@Slf4j\npublic class CommonMistakesApplication {\n\n    //æ¨¡æ‹Ÿ10ä¸‡æ¡æ•°æ®å­˜åˆ°Rediså’ŒMySQL\n    public static final int ROWS = 100000;\n    public static final String PAYLOAD = IntStream.rangeClosed(1, 100).mapToObj(__ -&gt; &quot;a&quot;).collect(Collectors.joining(&quot;&quot;));\n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n    @Autowired\n    private JdbcTemplate jdbcTemplate;\n    @Autowired\n    private StandardEnvironment standardEnvironment;\n\n\n    public static void main(String[] args) {\n        SpringApplication.run(CommonMistakesApplication.class, args);\n    }\n\n    @PostConstruct\n    public void init() {\n        //ä½¿ç”¨-Dspring.profiles.active=initå¯åŠ¨ç¨‹åºè¿›è¡Œåˆå§‹åŒ–\n        if (Arrays.stream(standardEnvironment.getActiveProfiles()).anyMatch(s -&gt; s.equalsIgnoreCase(&quot;init&quot;))) {\n            initRedis();\n            initMySQL();\n        }\n    }\n\n    //å¡«å……æ•°æ®åˆ°MySQL\n    private void initMySQL() {\n        //åˆ é™¤è¡¨\n        jdbcTemplate.execute(&quot;DROP TABLE IF EXISTS `r`;&quot;);\n        //æ–°å»ºè¡¨ï¼Œnameå­—æ®µåšäº†ç´¢å¼•\n        jdbcTemplate.execute(&quot;CREATE TABLE `r` (\\n&quot; +\n                &quot;  `id` bigint(20) NOT NULL AUTO_INCREMENT,\\n&quot; +\n                &quot;  `data` varchar(2000) NOT NULL,\\n&quot; +\n                &quot;  `name` varchar(20) NOT NULL,\\n&quot; +\n                &quot;  PRIMARY KEY (`id`),\\n&quot; +\n                &quot;  KEY `name` (`name`) USING BTREE\\n&quot; +\n                &quot;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&quot;);\n\n        //æ‰¹é‡æ’å…¥æ•°æ®\n        String sql = &quot;INSERT INTO `r` (`data`,`name`) VALUES (?,?)&quot;;\n        jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {\n            @Override\n            public void setValues(PreparedStatement preparedStatement, int i) throws SQLException {\n                preparedStatement.setString(1, PAYLOAD);\n                preparedStatement.setString(2, &quot;item&quot; + i);\n            }\n\n            @Override\n            public int getBatchSize() {\n                return ROWS;\n            }\n        });\n        log.info(&quot;init mysql finished with count {}&quot;, jdbcTemplate.queryForObject(&quot;SELECT COUNT(*) FROM `r`&quot;, Long.class));\n    }\n\n    //å¡«å……æ•°æ®åˆ°Redis\n    private void initRedis() {\n        IntStream.rangeClosed(1, ROWS).forEach(i -&gt; stringRedisTemplate.opsForValue().set(&quot;item&quot; + i, PAYLOAD));\n        log.info(&quot;init redis finished with count {}&quot;, stringRedisTemplate.keys(&quot;item*&quot;));\n    }\n}\n</code></pre><p>å¯åŠ¨ç¨‹åºåï¼Œè¾“å‡ºäº†å¦‚ä¸‹æ—¥å¿—ï¼Œæ•°æ®å…¨éƒ¨å¡«å……å®Œæ¯•ï¼š</p><pre><code>[14:22:47.195] [main] [INFO ] [o.g.t.c.n.r.CommonMistakesApplication:80  ] - init redis finished with count 100000\n[14:22:50.030] [main] [INFO ] [o.g.t.c.n.r.CommonMistakesApplication:74  ] - init mysql finished with count 100000\n</code></pre><p>ç„¶åï¼Œæ¯”è¾ƒä¸€ä¸‹ä»MySQLå’ŒRediséšæœºè¯»å–å•æ¡æ•°æ®çš„æ€§èƒ½ã€‚â€œå…¬å¹³â€èµ·è§ï¼ŒåƒRedisé‚£æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨MySQLæ—¶ä¹Ÿæ ¹æ®Keyæ¥æŸ¥Valueï¼Œä¹Ÿå°±æ˜¯æ ¹æ®nameå­—æ®µæ¥æŸ¥dataå­—æ®µï¼Œå¹¶ä¸”æˆ‘ä»¬ç»™nameå­—æ®µåšäº†ç´¢å¼•ï¼š</p><pre><code>@Autowired\nprivate JdbcTemplate jdbcTemplate;\n@Autowired\nprivate StringRedisTemplate stringRedisTemplate;\n\n@GetMapping(&quot;redis&quot;)\npublic void redis() {\n    //ä½¿ç”¨éšæœºçš„Keyæ¥æŸ¥è¯¢Valueï¼Œç»“æœåº”è¯¥ç­‰äºPAYLOAD\n    Assert.assertTrue(stringRedisTemplate.opsForValue().get(&quot;item&quot; + (ThreadLocalRandom.current().nextInt(CommonMistakesApplication.ROWS) + 1)).equals(CommonMistakesApplication.PAYLOAD));\n}\n\n@GetMapping(&quot;mysql&quot;)\npublic void mysql() {\n    //æ ¹æ®éšæœºnameæ¥æŸ¥dataï¼Œnameå­—æ®µæœ‰ç´¢å¼•ï¼Œç»“æœåº”è¯¥ç­‰äºPAYLOAD\n    Assert.assertTrue(jdbcTemplate.queryForObject(&quot;SELECT data FROM `r` WHERE name=?&quot;, new Object[]{(&quot;item&quot; + (ThreadLocalRandom.current().nextInt(CommonMistakesApplication.ROWS) + 1))}, String.class)\n            .equals(CommonMistakesApplication.PAYLOAD));\n}\n</code></pre><p>åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œä½¿ç”¨wrk åŠ 10ä¸ªçº¿ç¨‹50ä¸ªå¹¶å‘è¿æ¥åšå‹æµ‹ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒMySQL 90%çš„è¯·æ±‚éœ€è¦61msï¼ŒQPSä¸º1460ï¼›<strong>è€ŒRedis 90%çš„è¯·æ±‚åœ¨5mså·¦å³ï¼ŒQPSè¾¾åˆ°äº†14008ï¼Œå‡ ä¹æ˜¯MySQLçš„åå€</strong>ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/4e/2d289cc94097c2e62aa97a6602d0554e.png?wh=1670*1072\" alt=\"\"></p><p>ä½†Redisè–„å¼±çš„åœ°æ–¹æ˜¯ï¼Œä¸æ“…é•¿åšKeyçš„æœç´¢ã€‚å¯¹MySQLï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨LIKEæ“ä½œå‰åŒ¹é…èµ°B+æ ‘ç´¢å¼•å®ç°å¿«é€Ÿæœç´¢ï¼›ä½†å¯¹Redisï¼Œæˆ‘ä»¬ä½¿ç”¨Keyså‘½ä»¤å¯¹Keyçš„æœç´¢ï¼Œå…¶å®ç›¸å½“äºåœ¨MySQLé‡Œåšå…¨è¡¨æ‰«æã€‚</p><p>æˆ‘å†™ä¸€æ®µä»£ç æ¥å¯¹æ¯”ä¸€ä¸‹æ€§èƒ½ï¼š</p><pre><code>@GetMapping(&quot;redis2&quot;)\npublic void redis2() {\n    Assert.assertTrue(stringRedisTemplate.keys(&quot;item71*&quot;).size() == 1111);\n}\n@GetMapping(&quot;mysql2&quot;)\npublic void mysql2() {\n    Assert.assertTrue(jdbcTemplate.queryForList(&quot;SELECT name FROM `r` WHERE name LIKE 'item71%'&quot;, String.class).size() == 1111);\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨QPSæ–¹é¢ï¼Œ<strong>MySQLçš„QPSè¾¾åˆ°äº†Redisçš„157å€ï¼›åœ¨å»¶è¿Ÿæ–¹é¢ï¼ŒMySQLçš„å»¶è¿Ÿåªæœ‰Redisçš„ååˆ†ä¹‹ä¸€ã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/5d/e8/5de7a4a7bf27f8736b0ac09ba0dd1fe8.png?wh=1606*1104\" alt=\"\"></p><p>Redisæ…¢çš„åŸå› æœ‰ä¸¤ä¸ªï¼š</p><ul>\n<li>Redisçš„Keyså‘½ä»¤æ˜¯O(n)æ—¶é—´å¤æ‚åº¦ã€‚å¦‚æœæ•°æ®åº“ä¸­Keyçš„æ•°é‡å¾ˆå¤šï¼Œå°±ä¼šéå¸¸æ…¢ã€‚</li>\n<li>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¯¹äºæ…¢çš„å‘½ä»¤å¦‚æœæœ‰å¹¶å‘ï¼Œä¸²è¡Œæ‰§è¡Œå°±ä¼šéå¸¸è€—æ—¶ã€‚</li>\n</ul><p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä½¿ç”¨Rediséƒ½æ˜¯é’ˆå¯¹æŸä¸€ä¸ªKeyæ¥ä½¿ç”¨ï¼Œè€Œä¸èƒ½åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨Keyså‘½ä»¤ä»Redisä¸­â€œæœç´¢æ•°æ®â€ï¼Œå› ä¸ºè¿™ä¸æ˜¯Redisçš„æ“…é•¿ã€‚å¯¹äºKeyçš„æœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡å…³ç³»å‹æ•°æ®åº“è¿›è¡Œï¼Œç„¶åå†ä»Rediså­˜å–æ•°æ®ï¼ˆå¦‚æœå®åœ¨éœ€è¦æœç´¢Keyå¯ä»¥ä½¿ç”¨SCANå‘½ä»¤ï¼‰ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿä¼šé…ç½®Redisç¦ç”¨ç±»ä¼¼Keysè¿™ç§æ¯”è¾ƒå±é™©çš„å‘½ä»¤ï¼Œä½ å¯ä»¥<a href=\"https://redis.io/topics/security\">å‚è€ƒè¿™é‡Œ</a>ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œæ­£å¦‚â€œ<a href=\"https://time.geekbang.org/column/article/231501\">ç¼“å­˜è®¾è®¡</a>â€ä¸€è®²ä¸­æåˆ°çš„ï¼Œå¯¹äºä¸šåŠ¡å¼€å‘æ¥è¯´ï¼Œå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸‹Redisæ˜¯ä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è¾…åŠ©ç”¨äºç¼“å­˜çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šæŠŠå®ƒå½“ä½œæ•°æ®åº“ç‹¬ç«‹ä½¿ç”¨ã€‚</p><p>æ­¤å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒRedisæä¾›äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼ˆSetã€SortedSetã€Hashã€Listï¼‰ï¼Œå¹¶å›´ç»•è¿™äº›æ•°æ®ç»“æ„æä¾›äº†ä¸°å¯Œçš„APIã€‚å¦‚æœæˆ‘ä»¬å¥½å¥½åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨Redisä¸­å®Œæˆä¸€éƒ¨åˆ†æœåŠ¡ç«¯è®¡ç®—ï¼Œé¿å…â€œè¯»å–ç¼“å­˜-&gt;è®¡ç®—æ•°æ®-&gt;ä¿å­˜ç¼“å­˜â€ä¸‰éƒ¨æ›²ä¸­çš„è¯»å–å’Œä¿å­˜ç¼“å­˜çš„å¼€é”€ï¼Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p><h2>å–é•¿è¡¥çŸ­ä¹‹ InfluxDB vs MySQL</h2><p>InfluxDBæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ—¶åºæ•°æ®åº“ã€‚åœ¨â€œ<a href=\"https://time.geekbang.org/column/article/231568\">ç”Ÿäº§å°±ç»ª</a>â€è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨InfluxDBæ¥åšçš„Metricsæ‰“ç‚¹ã€‚æ—¶åºæ•°æ®åº“çš„ä¼˜åŠ¿ï¼Œåœ¨äºå¤„ç†æŒ‡æ ‡æ•°æ®çš„èšåˆï¼Œå¹¶ä¸”è¯»å†™æ•ˆç‡éå¸¸é«˜ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›æµ‹è¯•æ¥å¯¹æ¯”ä¸‹InfluxDBå’ŒMySQLçš„æ€§èƒ½ã€‚</p><p>åœ¨å¦‚ä¸‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«å¡«å……äº†1000ä¸‡æ¡æ•°æ®åˆ°MySQLå’ŒInfluxDBä¸­ã€‚å…¶ä¸­ï¼Œæ¯æ¡æ•°æ®åªæœ‰IDã€æ—¶é—´æˆ³ã€10000ä»¥å†…çš„éšæœºå€¼è¿™3åˆ—ä¿¡æ¯ï¼Œå¯¹äºMySQLæˆ‘ä»¬æŠŠæ—¶é—´æˆ³åˆ—åšäº†ç´¢å¼•ï¼š</p><pre><code>@SpringBootApplication\n@Slf4j\npublic class CommonMistakesApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(CommonMistakesApplication.class, args);\n    }\n\n    //æµ‹è¯•æ•°æ®é‡\n    public static final int ROWS = 10000000;\n\n    @Autowired\n    private JdbcTemplate jdbcTemplate;\n    @Autowired\n    private StandardEnvironment standardEnvironment;\n\n    @PostConstruct\n    public void init() {\n        //ä½¿ç”¨-Dspring.profiles.active=initå¯åŠ¨ç¨‹åºè¿›è¡Œåˆå§‹åŒ–\n        if (Arrays.stream(standardEnvironment.getActiveProfiles()).anyMatch(s -&gt; s.equalsIgnoreCase(&quot;init&quot;))) {\n            initInfluxDB();\n            initMySQL();\n        }\n    }\n\n    //åˆå§‹åŒ–MySQL\n    private void initMySQL() {\n        long begin = System.currentTimeMillis();\n        jdbcTemplate.execute(&quot;DROP TABLE IF EXISTS `m`;&quot;);\n        //åªæœ‰IDã€å€¼å’Œæ—¶é—´æˆ³ä¸‰åˆ—\n        jdbcTemplate.execute(&quot;CREATE TABLE `m` (\\n&quot; +\n                &quot;  `id` bigint(20) NOT NULL AUTO_INCREMENT,\\n&quot; +\n                &quot;  `value` bigint NOT NULL,\\n&quot; +\n                &quot;  `time` timestamp NOT NULL,\\n&quot; +\n                &quot;  PRIMARY KEY (`id`),\\n&quot; +\n                &quot;  KEY `time` (`time`) USING BTREE\\n&quot; +\n                &quot;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;&quot;);\n\n        String sql = &quot;INSERT INTO `m` (`value`,`time`) VALUES (?,?)&quot;;\n        //æ‰¹é‡æ’å…¥æ•°æ®\n        jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {\n            @Override\n            public void setValues(PreparedStatement preparedStatement, int i) throws SQLException {\n                preparedStatement.setLong(1, ThreadLocalRandom.current().nextInt(10000));\n                preparedStatement.setTimestamp(2, Timestamp.valueOf(LocalDateTime.now().minusSeconds(5 * i)));\n            }\n\n            @Override\n            public int getBatchSize() {\n                return ROWS;\n            }\n        });\n        log.info(&quot;init mysql finished with count {} took {}ms&quot;, jdbcTemplate.queryForObject(&quot;SELECT COUNT(*) FROM `m`&quot;, Long.class), System.currentTimeMillis()-begin);\n    }\n\n    //åˆå§‹åŒ–InfluxDB\n    private void initInfluxDB() {\n        long begin = System.currentTimeMillis();\n        OkHttpClient.Builder okHttpClientBuilder = new OkHttpClient().newBuilder()\n                .connectTimeout(1, TimeUnit.SECONDS)\n                .readTimeout(10, TimeUnit.SECONDS)\n                .writeTimeout(10, TimeUnit.SECONDS);\n        try (InfluxDB influxDB = InfluxDBFactory.connect(&quot;http://127.0.0.1:8086&quot;, &quot;root&quot;, &quot;root&quot;, okHttpClientBuilder)) {\n            String db = &quot;performance&quot;;\n            influxDB.query(new Query(&quot;DROP DATABASE &quot; + db));\n            influxDB.query(new Query(&quot;CREATE DATABASE &quot; + db));\n            //è®¾ç½®æ•°æ®åº“\n            influxDB.setDatabase(db);\n            //æ‰¹é‡æ’å…¥ï¼Œ10000æ¡æ•°æ®åˆ·ä¸€æ¬¡ï¼Œæˆ–1ç§’åˆ·ä¸€æ¬¡\n            influxDB.enableBatch(BatchOptions.DEFAULTS.actions(10000).flushDuration(1000));\n            IntStream.rangeClosed(1, ROWS).mapToObj(i -&gt; Point\n                    .measurement(&quot;m&quot;)\n                    .addField(&quot;value&quot;, ThreadLocalRandom.current().nextInt(10000))\n                    .time(LocalDateTime.now().minusSeconds(5 * i).toInstant(ZoneOffset.UTC).toEpochMilli(), TimeUnit.MILLISECONDS).build())\n                    .forEach(influxDB::write);\n            influxDB.flush();\n            log.info(&quot;init influxdb finished with count {} took {}ms&quot;, influxDB.query(new Query(&quot;SELECT COUNT(*) FROM m&quot;)).getResults().get(0).getSeries().get(0).getValues().get(0).get(1), System.currentTimeMillis()-begin);\n        }\n    }\n}\n</code></pre><p>å¯åŠ¨åï¼Œç¨‹åºè¾“å‡ºäº†å¦‚ä¸‹æ—¥å¿—ï¼š</p><pre><code>[16:08:25.062] [main] [INFO ] [o.g.t.c.n.i.CommonMistakesApplication:104 ] - init influxdb finished with count 1.0E7 took 54280ms\n[16:11:50.462] [main] [INFO ] [o.g.t.c.n.i.CommonMistakesApplication:80  ] - init mysql finished with count 10000000 took 205394ms\n</code></pre><p>InfluxDBæ‰¹é‡æ’å…¥1000ä¸‡æ¡æ•°æ®ä»…ç”¨äº†54ç§’ï¼Œç›¸å½“äºæ¯ç§’æ’å…¥18ä¸‡æ¡æ•°æ®ï¼Œé€Ÿåº¦ç›¸å½“å¿«ï¼›MySQLçš„æ‰¹é‡æ’å…¥ï¼Œé€Ÿåº¦ä¹ŸæŒºå¿«è¾¾åˆ°äº†æ¯ç§’4.8ä¸‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>å¯¹è¿™1000ä¸‡æ•°æ®è¿›è¡Œä¸€ä¸ªç»Ÿè®¡ï¼ŒæŸ¥è¯¢æœ€è¿‘60å¤©çš„æ•°æ®ï¼ŒæŒ‰ç…§1å°æ—¶çš„æ—¶é—´ç²’åº¦èšåˆï¼Œç»Ÿè®¡valueåˆ—çš„æœ€å¤§å€¼ã€æœ€å°å€¼å’Œå¹³å‡å€¼ï¼Œå¹¶å°†ç»Ÿè®¡ç»“æœç»˜åˆ¶æˆæ›²çº¿å›¾ï¼š</p><pre><code>@Autowired\nprivate JdbcTemplate jdbcTemplate;\n@GetMapping(&quot;mysql&quot;)\npublic void mysql() {\n    long begin = System.currentTimeMillis();\n    //ä½¿ç”¨SQLä»MySQLæŸ¥è¯¢ï¼ŒæŒ‰ç…§å°æ—¶åˆ†ç»„\n    Object result = jdbcTemplate.queryForList(&quot;SELECT date_format(time,'%Y%m%d%H'),max(value),min(value),avg(value) FROM m WHERE time&gt;now()- INTERVAL 60 DAY GROUP BY date_format(time,'%Y%m%d%H')&quot;);\n    log.info(&quot;took {} ms result {}&quot;, System.currentTimeMillis() - begin, result);\n}\n\n\n@GetMapping(&quot;influxdb&quot;)\npublic void influxdb() {\n    long begin = System.currentTimeMillis();\n    try (InfluxDB influxDB = InfluxDBFactory.connect(&quot;http://127.0.0.1:8086&quot;, &quot;root&quot;, &quot;root&quot;)) {\n        //åˆ‡æ¢æ•°æ®åº“\n        influxDB.setDatabase(&quot;performance&quot;);\n        //InfluxDBçš„æŸ¥è¯¢è¯­æ³•InfluxQLç±»ä¼¼SQL\n        Object result = influxDB.query(new Query(&quot;SELECT MEAN(value),MIN(value),MAX(value) FROM m WHERE time &gt; now() - 60d GROUP BY TIME(1h)&quot;));\n        log.info(&quot;took {} ms result {}&quot;, System.currentTimeMillis() - begin, result);\n    }\n}\n</code></pre><p>å› ä¸ºæ•°æ®é‡éå¸¸å¤§ï¼Œå•æ¬¡æŸ¥è¯¢å°±å·²ç»å¾ˆæ…¢äº†ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¸è¿›è¡Œå‹æµ‹ã€‚åˆ†åˆ«è°ƒç”¨ä¸¤ä¸ªæ¥å£ï¼Œå¯ä»¥çœ‹åˆ°<strong>MySQLæŸ¥è¯¢ä¸€æ¬¡è€—æ—¶29ç§’å·¦å³ï¼Œè€ŒInfluxDBè€—æ—¶980ms</strong>ï¼š</p><pre><code>[16:19:26.562] [http-nio-45678-exec-1] [INFO ] [o.g.t.c.n.i.PerformanceController:31  ] - took 28919 ms result [{date_format(time,'%Y%m%d%H')=2019121308, max(value)=9993, min(value)=4, avg(value)=5129.5639}, {date_format(time,'%Y%m%d%H')=2019121309, max(value)=9990, min(value)=12, avg(value)=4856.0556}, {date_format(time,'%Y%m%d%H')=2019121310, max(value)=9998, min(value)=8, avg(value)=4948.9347}, {date_format(time,'%Y%m%d%H')...\n[16:20:08.170] [http-nio-45678-exec-6] [INFO ] [o.g.t.c.n.i.PerformanceController:40  ] - took 981 ms result QueryResult [results=[Result [series=[Series [name=m, tags=null, columns=[time, mean, min, max], values=[[2019-12-13T08:00:00Z, 5249.2468619246865, 21.0, 9992.0],...\n</code></pre><p>åœ¨æŒ‰ç…§æ—¶é—´åŒºé—´èšåˆçš„æ¡ˆä¾‹ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†InfluxDBçš„æ€§èƒ½ä¼˜åŠ¿ã€‚ä½†ï¼Œæˆ‘ä»¬<strong>è‚¯å®šä¸èƒ½æŠŠInfluxDBå½“ä½œæ™®é€šæ•°æ®åº“</strong>ï¼ŒåŸå› æ˜¯ï¼š</p><ul>\n<li>InfluxDBä¸æ”¯æŒæ•°æ®æ›´æ–°æ“ä½œï¼Œæ¯•ç«Ÿæ—¶é—´æ•°æ®åªèƒ½éšç€æ—¶é—´äº§ç”Ÿæ–°æ•°æ®ï¼Œè‚¯å®šæ— æ³•å¯¹è¿‡å»çš„æ•°æ®åšä¿®æ”¹ï¼›</li>\n<li>ä»æ•°æ®ç»“æ„ä¸Šè¯´ï¼Œæ—¶é—´åºåˆ—æ•°æ®æ•°æ®æ²¡æœ‰å•ä¸€çš„ä¸»é”®æ ‡è¯†ï¼Œå¿…é¡»åŒ…å«æ—¶é—´æˆ³ï¼Œæ•°æ®åªèƒ½å’Œæ—¶é—´æˆ³è¿›è¡Œå…³è”ï¼Œä¸é€‚åˆæ™®é€šä¸šåŠ¡æ•°æ®ã€‚</li>\n</ul><p><strong>æ­¤å¤–éœ€è¦æ³¨æ„ï¼Œå³ä¾¿åªæ˜¯ä½¿ç”¨InfluxDBä¿å­˜å’Œæ—¶é—´ç›¸å…³çš„æŒ‡æ ‡æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ³¨æ„ä¸èƒ½æ»¥ç”¨tag</strong>ã€‚</p><p>InfluxDBæä¾›çš„tagåŠŸèƒ½ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªæŒ‡æ ‡è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œå¹¶ä¸”tagæœ‰ç´¢å¼•ï¼Œå¯ä»¥å¯¹tagè¿›è¡Œæ¡ä»¶æœç´¢æˆ–åˆ†ç»„ã€‚ä½†æ˜¯ï¼Œtagåªèƒ½ä¿å­˜æœ‰é™çš„ã€å¯æšä¸¾çš„æ ‡ç­¾ï¼Œä¸èƒ½ä¿å­˜URLç­‰ä¿¡æ¯ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°<a href=\"https://docs.influxdata.com/influxdb/v1.7/concepts/schema_and_data_layout/#don-t-have-too-many-serieshigh%20series%20cardinality\">high series cardinalityé—®é¢˜</a>ï¼Œå¯¼è‡´å ç”¨å¤§é‡å†…å­˜ï¼Œç”šè‡³æ˜¯OOMã€‚ä½ å¯ä»¥ç‚¹å‡»<a href=\"https://docs.influxdata.com/influxdb/v1.7/guides/hardware_sizing/\">è¿™é‡Œ</a>ï¼ŒæŸ¥çœ‹serieså’Œå†…å­˜å ç”¨çš„å…³ç³»ã€‚å¯¹äºInfluxDBï¼Œæˆ‘ä»¬æ— æ³•æŠŠURLè¿™ç§åŸå§‹æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œåªèƒ½æŠŠæ•°æ®è¿›è¡Œå½’ç±»ï¼Œå½¢æˆæœ‰é™çš„tagè¿›è¡Œä¿å­˜ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºMySQLè€Œè¨€ï¼Œé’ˆå¯¹å¤§é‡çš„æ•°æ®ä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥èšåˆç»Ÿè®¡æŒ‡æ ‡æ•°æ®ï¼Œæ€§èƒ½éå¸¸å·®ï¼Œä¸€èˆ¬åªèƒ½ä½œä¸ºä¸´æ—¶æ–¹æ¡ˆæ¥ä½¿ç”¨ã€‚æ­¤æ—¶ï¼Œå¼•å…¥InfluxDBä¹‹ç±»çš„æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œå°±å¾ˆæœ‰å¿…è¦äº†ã€‚æ—¶é—´åºåˆ—æ•°æ®åº“å¯ä»¥ä½œä¸ºç‰¹å®šåœºæ™¯ï¼ˆæ¯”å¦‚ç›‘æ§ã€ç»Ÿè®¡ï¼‰çš„ä¸»å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥å’Œå…³ç³»å‹æ•°æ®åº“æ­é…ä½¿ç”¨ï¼Œä½œä¸ºä¸€ä¸ªè¾…åŠ©æ•°æ®æºï¼Œä¿å­˜ä¸šåŠ¡ç³»ç»Ÿçš„æŒ‡æ ‡æ•°æ®ã€‚</p><h2>å–é•¿è¡¥çŸ­ä¹‹ Elasticsearch vs MySQL</h2><p>Elasticsearchï¼ˆä»¥ä¸‹ç®€ç§°ESï¼‰ï¼Œæ˜¯ç›®å‰éå¸¸æµè¡Œçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†ææ•°æ®åº“ï¼Œç‹¬ç‰¹çš„å€’æ’ç´¢å¼•ç»“æ„å°¤å…¶é€‚åˆè¿›è¡Œå…¨æ–‡æœç´¢ã€‚</p><p>ç®€å•æ¥è®²ï¼Œå€’æ’ç´¢å¼•å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªMapï¼Œå…¶Keyæ˜¯åˆ†è¯ä¹‹åçš„å…³é”®å­—ï¼ŒValueæ˜¯æ–‡æ¡£ID/ç‰‡æ®µIDçš„åˆ—è¡¨ã€‚æˆ‘ä»¬åªè¦è¾“å…¥éœ€è¦æœç´¢çš„å•è¯ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªMapä¸­å¾—åˆ°æ‰€æœ‰åŒ…å«è¿™ä¸ªå•è¯çš„æ–‡æ¡£ID/ç‰‡æ®µIDåˆ—è¡¨ï¼Œç„¶åå†æ ¹æ®å…¶ä¸­çš„æ–‡æ¡£ID/ç‰‡æ®µIDæŸ¥è¯¢å‡ºå®é™…çš„æ–‡æ¡£å†…å®¹ã€‚</p><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¯¹æ¯”ä¸‹ä½¿ç”¨ESè¿›è¡Œå…³é”®å­—å…¨æ–‡æœç´¢ã€åœ¨MySQLä¸­ä½¿ç”¨LIKEè¿›è¡Œæœç´¢çš„æ•ˆç‡å·®è·ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå®ä½“Newsï¼ŒåŒ…å«æ–°é—»åˆ†ç±»ã€æ ‡é¢˜ã€å†…å®¹ç­‰å­—æ®µã€‚è¿™ä¸ªå®ä½“åŒæ—¶ä¼šç”¨ä½œSpring Data JPAå’ŒSpring Data Elasticsearchçš„å®ä½“ï¼š</p><pre><code>@Entity\n@Document(indexName = &quot;news&quot;, replicas = 0) //@Documentæ³¨è§£å®šä¹‰äº†è¿™æ˜¯ä¸€ä¸ªESçš„ç´¢å¼•ï¼Œç´¢å¼•åç§°newsï¼Œæ•°æ®ä¸éœ€è¦å†—ä½™\n@Table(name = &quot;news&quot;, indexes = {@Index(columnList = &quot;cateid&quot;)}) //@Tableæ³¨è§£å®šä¹‰äº†è¿™æ˜¯ä¸€ä¸ªMySQLè¡¨ï¼Œè¡¨ånewsï¼Œå¯¹cateidåˆ—åšç´¢å¼•\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\n@DynamicUpdate\npublic class News {\n    @Id\n    private long id;\n    @Field(type = FieldType.Keyword)\n    private String category;//æ–°é—»åˆ†ç±»åç§°\n    private int cateid;//æ–°é—»åˆ†ç±»ID\n    @Column(columnDefinition = &quot;varchar(500)&quot;)//@Columnæ³¨è§£å®šä¹‰äº†åœ¨MySQLä¸­å­—æ®µï¼Œæ¯”å¦‚è¿™é‡Œå®šä¹‰titleåˆ—çš„ç±»å‹æ˜¯varchar(500)\n    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)//@Fieldæ³¨è§£å®šä¹‰äº†ESå­—æ®µçš„æ ¼å¼ï¼Œä½¿ç”¨ikåˆ†è¯å™¨è¿›è¡Œåˆ†è¯\n    private String title;//æ–°é—»æ ‡é¢˜\n    @Column(columnDefinition = &quot;text&quot;)\n    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)\n    private String content;//æ–°é—»å†…å®¹\n}\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°ä¸»ç¨‹åºã€‚åœ¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬ä¼šä»ä¸€ä¸ªcsvæ–‡ä»¶ä¸­åŠ è½½4000æ¡æ–°é—»æ•°æ®ï¼Œç„¶åå¤åˆ¶100ä»½ï¼Œæ‹¼æˆ40ä¸‡æ¡æ•°æ®ï¼Œåˆ†åˆ«å†™å…¥MySQLå’ŒESï¼š</p><pre><code>@SpringBootApplication\n@Slf4j\n@EnableElasticsearchRepositories(includeFilters = @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, value = NewsESRepository.class)) //æ˜ç¡®è®¾ç½®å“ªä¸ªæ˜¯ESçš„Repository\n@EnableJpaRepositories(excludeFilters = @ComponentScan.Filter(type = FilterType.ASSIGNABLE_TYPE, value = NewsESRepository.class)) //å…¶ä»–çš„æ˜¯MySQLçš„Repository\npublic class CommonMistakesApplication {\n\n    public static void main(String[] args) {\n        Utils.loadPropertySource(CommonMistakesApplication.class, &quot;es.properties&quot;);\n        SpringApplication.run(CommonMistakesApplication.class, args);\n    }\n\n    @Autowired\n    private StandardEnvironment standardEnvironment;\n    @Autowired\n    private NewsESRepository newsESRepository;\n    @Autowired\n    private NewsMySQLRepository newsMySQLRepository;\n\n    @PostConstruct\n    public void init() {\n        //ä½¿ç”¨-Dspring.profiles.active=initå¯åŠ¨ç¨‹åºè¿›è¡Œåˆå§‹åŒ–\n        if (Arrays.stream(standardEnvironment.getActiveProfiles()).anyMatch(s -&gt; s.equalsIgnoreCase(&quot;init&quot;))) {\n            //csvä¸­çš„åŸå§‹æ•°æ®åªæœ‰4000æ¡\n            List&lt;News&gt; news = loadData();\n            AtomicLong atomicLong = new AtomicLong();\n            news.forEach(item -&gt; item.setTitle(&quot;%%&quot; + item.getTitle()));\n            //æˆ‘ä»¬æ¨¡æ‹Ÿ100å€çš„æ•°æ®é‡ï¼Œä¹Ÿå°±æ˜¯40ä¸‡æ¡\n            IntStream.rangeClosed(1, 100).forEach(repeat -&gt; {\n                news.forEach(item -&gt; {\n                    //é‡æ–°è®¾ç½®ä¸»é”®ID\n                    item.setId(atomicLong.incrementAndGet());\n                    //æ¯æ¬¡å¤åˆ¶æ•°æ®ç¨å¾®æ”¹ä¸€ä¸‹titleå­—æ®µï¼Œåœ¨å‰é¢åŠ ä¸Šä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨è¿™æ˜¯ç¬¬å‡ æ¬¡å¤åˆ¶\n                    item.setTitle(item.getTitle().replaceFirst(&quot;%%&quot;, String.valueOf(repeat)));\n                });\n                initMySQL(news, repeat == 1);\n                log.info(&quot;init MySQL finished for {}&quot;, repeat);\n                initES(news, repeat == 1);\n                log.info(&quot;init ES finished for {}&quot;, repeat);\n            });\n\n        }\n    }\n\n    //ä»news.csvä¸­è§£æå¾—åˆ°åŸå§‹æ•°æ®\n    private List&lt;News&gt; loadData() {\n        //ä½¿ç”¨jackson-dataformat-csvå®ç°csvåˆ°POJOçš„è½¬æ¢\n        CsvMapper csvMapper = new CsvMapper();\n        CsvSchema schema = CsvSchema.emptySchema().withHeader();\n        ObjectReader objectReader = csvMapper.readerFor(News.class).with(schema);\n        ClassLoader classLoader = getClass().getClassLoader();\n        File file = new File(classLoader.getResource(&quot;news.csv&quot;).getFile());\n        try (Reader reader = new FileReader(file)) {\n            return objectReader.&lt;News&gt;readValues(reader).readAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    //æŠŠæ•°æ®ä¿å­˜åˆ°ESä¸­\n    private void initES(List&lt;News&gt; news, boolean clear) {\n        if (clear) {\n            //é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™å…ˆåˆ é™¤å†å²æ•°æ®\n            newsESRepository.deleteAll();\n        }\n        newsESRepository.saveAll(news);\n    }\n\n    //æŠŠæ•°æ®ä¿å­˜åˆ°MySQLä¸­\n    private void initMySQL(List&lt;News&gt; news, boolean clear) {\n        if (clear) {\n            //é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™å…ˆåˆ é™¤å†å²æ•°æ®\n            newsMySQLRepository.deleteAll();\n        }\n        newsMySQLRepository.saveAll(news);\n    }\n}\n</code></pre><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†Spring Dataï¼Œç›´æ¥å®šä¹‰ä¸¤ä¸ªRepositoryï¼Œç„¶åç›´æ¥å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼Œæ— éœ€å®ç°ä»»ä½•é€»è¾‘å³å¯å®ç°æŸ¥è¯¢ï¼ŒSpring Dataä¼šæ ¹æ®æ–¹æ³•åç”Ÿæˆç›¸åº”çš„SQLè¯­å¥å’ŒESæŸ¥è¯¢DSLï¼Œå…¶ä¸­ESçš„ç¿»è¯‘é€»è¾‘<a href=\"https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#elasticsearch.query-methods.criterions\">è¯¦è§è¿™é‡Œ</a>ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªcountByCateidAndContentContainingAndContentContainingæ–¹æ³•ï¼Œä»£è¡¨æŸ¥è¯¢æ¡ä»¶æ˜¯ï¼šæœç´¢åˆ†ç±»ç­‰äºcateidå‚æ•°ï¼Œä¸”å†…å®¹åŒæ—¶åŒ…å«å…³é”®å­—keyword1å’Œkeyword2ï¼Œè®¡ç®—ç¬¦åˆæ¡ä»¶çš„æ–°é—»æ€»æ•°é‡ï¼š</p><pre><code>@Repository\npublic interface NewsMySQLRepository extends JpaRepository&lt;News, Long&gt; {\n    //JPAï¼šæœç´¢åˆ†ç±»ç­‰äºcateidå‚æ•°ï¼Œä¸”å†…å®¹åŒæ—¶åŒ…å«å…³é”®å­—keyword1å’Œkeyword2ï¼Œè®¡ç®—ç¬¦åˆæ¡ä»¶çš„æ–°é—»æ€»æ•°é‡\n    long countByCateidAndContentContainingAndContentContaining(int cateid, String keyword1, String keyword2);\n}\n\n@Repository\npublic interface NewsESRepository extends ElasticsearchRepository&lt;News, Long&gt; {\n    //ESï¼šæœç´¢åˆ†ç±»ç­‰äºcateidå‚æ•°ï¼Œä¸”å†…å®¹åŒæ—¶åŒ…å«å…³é”®å­—keyword1å’Œkeyword2ï¼Œè®¡ç®—ç¬¦åˆæ¡ä»¶çš„æ–°é—»æ€»æ•°é‡\n    long countByCateidAndContentContainingAndContentContaining(int cateid, String keyword1, String keyword2);\n}\n</code></pre><p>å¯¹äºESå’ŒMySQLï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ¡ä»¶è¿›è¡Œæœç´¢ï¼Œæœç´ åˆ†ç±»æ˜¯1ï¼Œå…³é”®å­—æ˜¯ç¤¾ä¼šå’Œè‹¹æœï¼Œç„¶åè¾“å‡ºæœç´¢ç»“æœå’Œè€—æ—¶ï¼š</p><pre><code>//æµ‹è¯•MySQLæœç´¢ï¼Œæœ€åè¾“å‡ºè€—æ—¶å’Œç»“æœ\n@GetMapping(&quot;mysql&quot;)\npublic void mysql(@RequestParam(value = &quot;cateid&quot;, defaultValue = &quot;1&quot;) int cateid,\n                  @RequestParam(value = &quot;keyword1&quot;, defaultValue = &quot;ç¤¾ä¼š&quot;) String keyword1,\n                  @RequestParam(value = &quot;keyword2&quot;, defaultValue = &quot;è‹¹æœ&quot;) String keyword2) {\n    long begin = System.currentTimeMillis();\n    Object result = newsMySQLRepository.countByCateidAndContentContainingAndContentContaining(cateid, keyword1, keyword2);\n    log.info(&quot;took {} ms result {}&quot;, System.currentTimeMillis() - begin, result);\n}\n//æµ‹è¯•ESæœç´¢ï¼Œæœ€åè¾“å‡ºè€—æ—¶å’Œç»“æœ\n@GetMapping(&quot;es&quot;)\npublic void es(@RequestParam(value = &quot;cateid&quot;, defaultValue = &quot;1&quot;) int cateid,\n               @RequestParam(value = &quot;keyword1&quot;, defaultValue = &quot;ç¤¾ä¼š&quot;) String keyword1,\n               @RequestParam(value = &quot;keyword2&quot;, defaultValue = &quot;è‹¹æœ&quot;) String keyword2) {\n    long begin = System.currentTimeMillis();\n    Object result = newsESRepository.countByCateidAndContentContainingAndContentContaining(cateid, keyword1, keyword2);\n    log.info(&quot;took {} ms result {}&quot;, System.currentTimeMillis() - begin, result);\n}\n</code></pre><p>åˆ†åˆ«è°ƒç”¨æ¥å£å¯ä»¥çœ‹åˆ°ï¼Œ<strong>ESè€—æ—¶ä»…ä»…48msï¼ŒMySQLè€—æ—¶6ç§’å¤šæ˜¯ESçš„100å€</strong>ã€‚å¾ˆé—æ†¾ï¼Œè™½ç„¶æ–°é—»åˆ†ç±»IDå·²ç»å»ºäº†ç´¢å¼•ï¼Œä½†æ˜¯è¿™ä¸ªç´¢å¼•åªèƒ½èµ·åˆ°åŠ é€Ÿè¿‡æ»¤åˆ†ç±»IDè¿™ä¸€å•ä¸€æ¡ä»¶çš„ä½œç”¨ï¼Œå¯¹äºæ–‡æœ¬å†…å®¹çš„å…¨æ–‡æœç´¢ï¼ŒB+æ ‘ç´¢å¼•æ— èƒ½ä¸ºåŠ›ã€‚</p><pre><code>[22:04:00.951] [http-nio-45678-exec-6] [INFO ] [o.g.t.c.n.esvsmyql.PerformanceController:48  ] - took 48 ms result 2100\nHibernate: select count(news0_.id) as col_0_0_ from news news0_ where news0_.cateid=? and (news0_.content like ? escape ?) and (news0_.content like ? escape ?)\n[22:04:11.946] [http-nio-45678-exec-7] [INFO ] [o.g.t.c.n.esvsmyql.PerformanceController:39  ] - took 6637 ms result 2100\n</code></pre><p>ä½†ESè¿™ç§ä»¥ç´¢å¼•ä¸ºæ ¸å¿ƒçš„æ•°æ®åº“ï¼Œä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œé¢‘ç¹æ›´æ–°å°±æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚</p><p>MySQLå¯ä»¥åšåˆ°ä»…æ›´æ–°æŸè¡Œæ•°æ®çš„æŸä¸ªå­—æ®µï¼Œä½†ESé‡Œæ¯æ¬¡æ•°æ®å­—æ®µæ›´æ–°éƒ½ç›¸å½“äºæ•´ä¸ªæ–‡æ¡£ç´¢å¼•é‡å»ºã€‚å³ä¾¿ESæä¾›äº†æ–‡æ¡£éƒ¨åˆ†æ›´æ–°çš„åŠŸèƒ½ï¼Œä½†æœ¬è´¨ä¸Šåªæ˜¯èŠ‚çœäº†æäº¤æ–‡æ¡£çš„ç½‘ç»œæµé‡ï¼Œä»¥åŠå‡å°‘äº†æ›´æ–°å†²çªï¼Œå…¶å†…éƒ¨å®ç°è¿˜æ˜¯æ–‡æ¡£åˆ é™¤åé‡æ–°æ„å»ºç´¢å¼•ã€‚å› æ­¤ï¼Œå¦‚æœè¦åœ¨ESä¸­ä¿å­˜ä¸€ä¸ªç±»ä¼¼è®¡æ•°å™¨çš„å€¼ï¼Œè¦å®ç°ä¸æ–­æ›´æ–°ï¼Œå…¶æ‰§è¡Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚</p><p>æˆ‘ä»¬æ¥éªŒè¯ä¸‹ï¼Œåˆ†åˆ«ä½¿ç”¨JdbcTemplate+SQLè¯­å¥ã€ElasticsearchTemplate+è‡ªå®šä¹‰UpdateQueryï¼Œå®ç°éƒ¨åˆ†æ›´æ–°MySQLè¡¨å’ŒESç´¢å¼•çš„ä¸€ä¸ªå­—æ®µï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ˜¯å¾ªç¯æ›´æ–°1000æ¬¡ï¼š</p><pre><code>@GetMapping(&quot;mysql2&quot;)\npublic void mysql2(@RequestParam(value = &quot;id&quot;, defaultValue = &quot;400000&quot;) long id) {\n    long begin = System.currentTimeMillis();\n    //å¯¹äºMySQLï¼Œä½¿ç”¨JdbcTemplate+SQLè¯­å¥ï¼Œå®ç°ç›´æ¥æ›´æ–°æŸä¸ªcategoryå­—æ®µï¼Œæ›´æ–°1000æ¬¡\n    IntStream.rangeClosed(1, 1000).forEach(i -&gt; {\n        jdbcTemplate.update(&quot;UPDATE `news` SET category=? WHERE id=?&quot;, new Object[]{&quot;test&quot; + i, id});\n    });\n    log.info(&quot;mysql took {} ms result {}&quot;, System.currentTimeMillis() - begin, newsMySQLRepository.findById(id));\n}\n\n@GetMapping(&quot;es2&quot;)\npublic void es(@RequestParam(value = &quot;id&quot;, defaultValue = &quot;400000&quot;) long id) {\n    long begin = System.currentTimeMillis();\n    IntStream.rangeClosed(1, 1000).forEach(i -&gt; {\n        //å¯¹äºESï¼Œé€šè¿‡ElasticsearchTemplate+è‡ªå®šä¹‰UpdateQueryï¼Œå®ç°æ–‡æ¡£çš„éƒ¨åˆ†æ›´æ–°\n        UpdateQuery updateQuery = null;\n        try {\n            updateQuery = new UpdateQueryBuilder()\n                    .withIndexName(&quot;news&quot;)\n                    .withId(String.valueOf(id))\n                    .withType(&quot;_doc&quot;)\n                    .withUpdateRequest(new UpdateRequest().doc(\n                            jsonBuilder()\n                                    .startObject()\n                                    .field(&quot;category&quot;, &quot;test&quot; + i)\n                                    .endObject()))\n                    .build();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        elasticsearchTemplate.update(updateQuery);\n    });\n    log.info(&quot;es took {} ms result {}&quot;, System.currentTimeMillis() - begin, newsESRepository.findById(id).get());\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>MySQLè€—æ—¶ä»…ä»…1.5ç§’ï¼Œè€ŒESè€—æ—¶6.8ç§’</strong>ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/63/02/63a583a0bced67a3f7cf0eb32e644802.png?wh=3060*950\" alt=\"\"></p><p>ESæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å…¨æ–‡æœç´¢æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸MySQLç›¸æ¯”çš„ä¼˜åŠ¿åœ¨äºæ–‡æœ¬æœç´¢ï¼Œè€Œä¸”å› ä¸ºå…¶åˆ†å¸ƒå¼çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¤§ESé›†ç¾¤å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„å†…å®¹æœç´¢ã€‚ä½†ï¼Œç”±äºESçš„ç´¢å¼•æ˜¯æ–‡æ¡£ç»´åº¦çš„ï¼Œæ‰€ä»¥ä¸é€‚ç”¨äºé¢‘ç¹æ›´æ–°çš„OLTPä¸šåŠ¡ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä¼šæŠŠESå’ŒMySQLç»“åˆä½¿ç”¨ï¼ŒMySQLç›´æ¥æ‰¿æ‹…ä¸šåŠ¡ç³»ç»Ÿçš„å¢åˆ æ”¹æ“ä½œï¼Œè€ŒESä½œä¸ºè¾…åŠ©æ•°æ®åº“ï¼Œç›´æ¥æ‰å¹³åŒ–ä¿å­˜ä¸€ä»½ä¸šåŠ¡æ•°æ®ï¼Œç”¨äºå¤æ‚æŸ¥è¯¢ã€å…¨æ–‡æœç´¢å’Œç»Ÿè®¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¹Ÿä¼šç»§ç»­å’Œä½ åˆ†æè¿™ä¸€ç‚¹ã€‚</p><h2>ç»“åˆNoSQLå’ŒMySQLåº”å¯¹é«˜å¹¶å‘çš„å¤åˆæ•°æ®åº“æ¶æ„</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›æ¡ˆä¾‹çœ‹åˆ°äº†Redisã€InfluxDBã€ESè¿™äº›NoSQLæ•°æ®åº“ï¼Œéƒ½æœ‰æ“…é•¿å’Œä¸æ“…é•¿çš„åœºæ™¯ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å…¨èƒ½çš„æ•°æ®åº“å‘¢ï¼Ÿ</p><p>æˆ‘è®¤ä¸ºæ²¡æœ‰ã€‚æ¯ä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿéƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ•°æ®ç»“æ„ï¼Œæ•°æ®ç»“æ„çš„è®¾è®¡å°±å†³å®šäº†å…¶æ“…é•¿å’Œä¸æ“…é•¿çš„åœºæ™¯ã€‚</p><p>æ¯”å¦‚ï¼ŒMySQL InnoDBå¼•æ“çš„B+æ ‘å¯¹æ’åºå’ŒèŒƒå›´æŸ¥è¯¢å‹å¥½ï¼Œé¢‘ç¹æ•°æ®æ›´æ–°çš„ä»£ä»·ä¸æ˜¯å¤ªå¤§ï¼Œå› æ­¤é€‚åˆOLTPï¼ˆOn-Line Transaction Processingï¼‰ã€‚</p><p>åˆæ¯”å¦‚ï¼ŒESçš„Luceneé‡‡ç”¨äº†FSTï¼ˆFinite State Transducerï¼‰ç´¢å¼•+å€’æ’ç´¢å¼•ï¼Œç©ºé—´æ•ˆç‡é«˜ï¼Œé€‚åˆå¯¹å˜åŠ¨ä¸é¢‘ç¹çš„æ•°æ®åšç´¢å¼•ï¼Œå®ç°å…¨æ–‡æœç´¢ã€‚å­˜å‚¨ç³»ç»Ÿæœ¬èº«ä¸å¯èƒ½å¯¹ä¸€ä»½æ•°æ®ä½¿ç”¨å¤šç§æ•°æ®ç»“æ„ä¿å­˜ï¼Œå› æ­¤ä¸å¯èƒ½é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚</p><p>è™½ç„¶åœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸‹ï¼ŒMySQLçš„æ€§èƒ½éƒ½ä¸ç®—å¤ªå·®ï¼Œä½†å¯¹äºæ•°æ®é‡å¤§ã€è®¿é—®é‡å¤§ã€ä¸šåŠ¡å¤æ‚çš„äº’è”ç½‘åº”ç”¨æ¥è¯´ï¼ŒMySQLå› ä¸ºå®ç°äº†ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ä¼šæ¯”è¾ƒé‡ï¼Œè€Œä¸”æ¨ªå‘æ‰©å±•èƒ½åŠ›è¾ƒå·®ã€åŠŸèƒ½å•ä¸€ï¼Œæ— æ³•æ‰›ä¸‹æ‰€æœ‰æ•°æ®é‡å’Œæµé‡ï¼Œæ— æ³•åº”å¯¹æ‰€æœ‰åŠŸèƒ½éœ€æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ¶æ„æ‰‹æ®µï¼Œæ¥ç»„åˆä½¿ç”¨å¤šç§å­˜å‚¨ç³»ç»Ÿï¼Œå–é•¿è¡¥çŸ­ï¼Œå®ç°1+1&gt;2çš„æ•ˆæœã€‚</p><p>æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª<strong>åŒ…å«å¤šä¸ªæ•°æ®åº“ç³»ç»Ÿçš„ã€èƒ½åº”å¯¹å„ç§é«˜å¹¶å‘åœºæ™¯çš„ä¸€å¥—æ•°æ®æœåŠ¡çš„ç³»ç»Ÿæ¶æ„</strong>ï¼Œå…¶ä¸­åŒ…å«äº†åŒæ­¥å†™æœåŠ¡ã€å¼‚æ­¥å†™æœåŠ¡å’ŒæŸ¥è¯¢æœåŠ¡ä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«å®ç°ä¸»æ•°æ®åº“å†™å…¥ã€è¾…åŠ©æ•°æ®åº“å†™å…¥å’ŒæŸ¥è¯¢è·¯ç”±ã€‚</p><p>æˆ‘ä»¬æŒ‰ç…§æœåŠ¡æ¥ä¾æ¬¡åˆ†æä¸‹è¿™ä¸ªæ¶æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/38/bbbcdbd74308de6b8fda04b34ed07e38.png?wh=1886*1626\" alt=\"\"></p><p>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼Œé‡è¦çš„ä¸šåŠ¡ä¸»æ•°æ®åªèƒ½ä¿å­˜åœ¨MySQLè¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼ŒåŸå› æœ‰ä¸‰ç‚¹ï¼š</p><ul>\n<li>RDBMSç»è¿‡äº†å‡ åå¹´çš„éªŒè¯ï¼Œå·²ç»éå¸¸æˆç†Ÿï¼›</li>\n<li>RDBMSçš„ç”¨æˆ·æ•°é‡ä¼—å¤šï¼ŒBugä¿®å¤å¿«ã€ç‰ˆæœ¬ç¨³å®šã€å¯é æ€§å¾ˆé«˜ï¼›</li>\n<li>RDBMSå¼ºè°ƒACIDï¼Œèƒ½ç¡®ä¿æ•°æ®å®Œæ•´ã€‚</li>\n</ul><p>æœ‰ä¸¤ç§ç±»å‹çš„æŸ¥è¯¢ä»»åŠ¡å¯ä»¥äº¤ç»™MySQLæ¥åšï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒå¥½ï¼Œè¿™ä¹Ÿæ˜¯MySQLæ“…é•¿çš„åœ°æ–¹ï¼š</p><ul>\n<li>æŒ‰ç…§ä¸»é”®IDçš„æŸ¥è¯¢ã€‚ç›´æ¥æŸ¥è¯¢èšç°‡ç´¢å¼•ï¼Œå…¶æ€§èƒ½ä¼šå¾ˆé«˜ã€‚ä½†æ˜¯å•è¡¨æ•°æ®é‡è¶…è¿‡äº¿çº§åï¼Œæ€§èƒ½ä¹Ÿä¼šè¡°é€€ï¼Œè€Œä¸”å•ä¸ªæ•°æ®åº“æ— æ³•æ‰¿å—è¶…å¤§çš„æŸ¥è¯¢å¹¶å‘ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®è¡¨è¿›è¡ŒShardingæ“ä½œï¼Œå‡åŒ€æ‹†åˆ†åˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸­ä¿å­˜ã€‚æˆ‘ä»¬æŠŠè¿™å¥—æ•°æ®åº“é›†ç¾¤ç§°ä½œShardingé›†ç¾¤ã€‚</li>\n<li>æŒ‰ç…§å„ç§æ¡ä»¶è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼ŒæŸ¥å‡ºä¸»é”®IDã€‚å¯¹äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢å¾—åˆ°ä¸»é”®ï¼Œåªéœ€è¦æŸ¥è¯¢ä¸€æ£µB+æ ‘ï¼Œæ•ˆç‡åŒæ ·å¾ˆé«˜ã€‚ä½†ç´¢å¼•çš„å€¼ä¸å®œè¿‡å¤§ï¼Œæ¯”å¦‚å¯¹varchar(1000)è¿›è¡Œç´¢å¼•ä¸å¤ªåˆé€‚ï¼Œè€Œç´¢å¼•å¤–é”®ï¼ˆä¸€èˆ¬æ˜¯intæˆ–bigintç±»å‹ï¼‰æ€§èƒ½å°±ä¼šæ¯”è¾ƒå¥½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨MySQLä¸­å»ºç«‹ä¸€å¼ â€œç´¢å¼•è¡¨â€ï¼Œé™¤äº†ä¿å­˜ä¸»é”®å¤–ï¼Œä¸»è¦æ˜¯ä¿å­˜å„ç§å…³è”è¡¨çš„å¤–é”®ï¼Œä»¥åŠå°½å¯èƒ½å°‘çš„varcharç±»å‹çš„å­—æ®µã€‚è¿™å¼ ç´¢å¼•è¡¨çš„å¤§éƒ¨åˆ†åˆ—éƒ½å¯ä»¥å»ºä¸ŠäºŒçº§ç´¢å¼•ï¼Œç”¨äºè¿›è¡Œç®€å•æœç´¢ï¼Œæœç´¢çš„ç»“æœæ˜¯ä¸»é”®çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ•°æ®ã€‚ç”±äºç´¢å¼•è¡¨å­—æ®µè½»é‡å¹¶ä¸”æ•°é‡ä¸å¤šï¼ˆä¸€èˆ¬æ§åˆ¶åœ¨10ä¸ªä»¥å†…ï¼‰ï¼Œæ‰€ä»¥å³ä¾¿ç´¢å¼•è¡¨æ²¡æœ‰è¿›è¡ŒShardingæ‹†åˆ†ï¼Œé—®é¢˜ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚</li>\n</ul><p>å¦‚å›¾ä¸Šè“è‰²çº¿æ‰€ç¤ºï¼Œå†™å…¥ä¸¤ç§MySQLæ•°æ®è¡¨å’Œå‘é€MQæ¶ˆæ¯çš„è¿™ä¸‰æ­¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª<strong>åŒæ­¥å†™æœåŠ¡</strong>å®Œæˆäº†ã€‚æˆ‘åœ¨â€œ<a href=\"https://time.geekbang.org/column/article/234928\">å¼‚æ­¥å¤„ç†</a>â€ä¸­æåˆ°ï¼Œæ‰€æœ‰å¼‚æ­¥æµç¨‹éƒ½éœ€è¦è¡¥å¿ï¼Œè¿™é‡Œçš„å¼‚æ­¥æµç¨‹åŒæ ·éœ€è¦ã€‚åªä¸è¿‡ä¸ºäº†ç®€æ´ï¼Œæˆ‘åœ¨è¿™é‡Œçœç•¥äº†è¡¥å¿æµç¨‹ã€‚</p><p>ç„¶åï¼Œå¦‚å›¾ä¸­ç»¿è‰²çº¿æ‰€ç¤ºï¼Œæœ‰ä¸€ä¸ª<strong>å¼‚æ­¥å†™æœåŠ¡</strong>ï¼Œç›‘å¬MQçš„æ¶ˆæ¯ï¼Œç»§ç»­å®Œæˆè¾…åŠ©æ•°æ®çš„æ›´æ–°æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬é€‰ç”¨äº†ESå’ŒInfluxDBè¿™ä¸¤ç§è¾…åŠ©æ•°æ®åº“ï¼Œå› æ­¤æ•´ä¸ªå¼‚æ­¥å†™æ•°æ®æ“ä½œæœ‰ä¸‰æ­¥ï¼š</p><ol>\n<li>MQæ¶ˆæ¯ä¸ä¸€å®šåŒ…å«å®Œæ•´çš„æ•°æ®ï¼Œç”šè‡³å¯èƒ½åªåŒ…å«ä¸€ä¸ªæœ€æ–°æ•°æ®çš„ä¸»é”®IDï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®IDä»æŸ¥è¯¢æœåŠ¡æŸ¥è¯¢åˆ°å®Œæ•´çš„æ•°æ®ã€‚</li>\n<li>å†™å…¥InfluxDBçš„æ•°æ®ä¸€èˆ¬å¯ä»¥æŒ‰æ—¶é—´é—´éš”è¿›è¡Œç®€å•èšåˆï¼Œå®šæ—¶å†™å…¥InfluxDBã€‚å› æ­¤ï¼Œè¿™é‡Œä¼šè¿›è¡Œç®€å•çš„å®¢æˆ·ç«¯èšåˆï¼Œç„¶åå†™å…¥InfluxDBã€‚</li>\n<li>ESä¸é€‚åˆåœ¨å„ç´¢å¼•ä¹‹é—´åšè¿æ¥ï¼ˆJoinï¼‰æ“ä½œï¼Œé€‚åˆä¿å­˜æ‰å¹³åŒ–çš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè®¢å•ä¸‹çš„ç”¨æˆ·ã€å•†æˆ·ã€å•†å“åˆ—è¡¨ç­‰ä¿¡æ¯ï¼Œä½œä¸ºå†…åµŒå¯¹è±¡åµŒå…¥æ•´ä¸ªè®¢å•JSONï¼Œç„¶åæŠŠæ•´ä¸ªæ‰å¹³åŒ–çš„JSONç›´æ¥å­˜å…¥ESã€‚</li>\n</ol><p>å¯¹äºæ•°æ®å†™å…¥æ“ä½œï¼Œæˆ‘ä»¬è®¤ä¸ºæ“ä½œè¿”å›çš„æ—¶å€™åŒæ­¥æ•°æ®ä¸€å®šæ˜¯å†™å…¥æˆåŠŸçš„ï¼Œä½†æ˜¯ç”±äºå„ç§åŸå› ï¼Œå¼‚æ­¥æ•°æ®å†™å…¥æ— æ³•ç¡®ä¿ç«‹å³æˆåŠŸï¼Œä¼šæœ‰ä¸€å®šå»¶è¿Ÿï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>å¼‚æ­¥æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œéœ€è¦è¡¥å¿å¤„ç†ï¼›</li>\n<li>å†™å…¥ESçš„ç´¢å¼•æ“ä½œæœ¬èº«å°±ä¼šæ¯”è¾ƒæ…¢ï¼›</li>\n<li>å†™å…¥InfluxDBçš„æ•°æ®éœ€è¦å®¢æˆ·ç«¯å®šæ—¶èšåˆã€‚</li>\n</ul><p>å› æ­¤ï¼Œå¯¹äº<strong>æŸ¥è¯¢æœåŠ¡</strong>ï¼Œå¦‚å›¾ä¸­çº¢è‰²çº¿æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸€å®šçš„ä¸Šä¸‹æ–‡æ¡ä»¶ï¼ˆæ¯”å¦‚æŸ¥è¯¢ä¸€è‡´æ€§è¦æ±‚ã€æ—¶æ•ˆæ€§è¦æ±‚ã€æœç´¢çš„æ¡ä»¶ã€éœ€è¦è¿”å›çš„æ•°æ®å­—æ®µã€æœç´¢æ—¶é—´åŒºé—´ç­‰ï¼‰æ¥æŠŠè¯·æ±‚è·¯ç”±åˆ°åˆé€‚çš„æ•°æ®åº“ï¼Œå¹¶ä¸”åšä¸€äº›èšåˆå¤„ç†ï¼š</p><ul>\n<li>éœ€è¦æ ¹æ®ä¸»é”®æŸ¥è¯¢å•æ¡æ•°æ®ï¼Œå¯ä»¥ä»MySQL Shardingé›†ç¾¤æˆ–RedisæŸ¥è¯¢ï¼Œå¦‚æœå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ä¹Ÿå¯ä»¥ä»ESæŸ¥è¯¢ã€‚</li>\n<li>æŒ‰ç…§å¤šä¸ªæ¡ä»¶æœç´¢è®¢å•çš„åœºæ™¯ï¼Œå¯ä»¥ä»MySQLç´¢å¼•è¡¨æŸ¥è¯¢å‡ºä¸»é”®åˆ—è¡¨ï¼Œç„¶åå†æ ¹æ®ä¸»é”®ä»MySQL Shardingé›†ç¾¤æˆ–Redisè·å–æ•°æ®è¯¦æƒ…ã€‚</li>\n<li>å„ç§åå°ç³»ç»Ÿéœ€è¦ä½¿ç”¨æ¯”è¾ƒå¤æ‚çš„æœç´¢æ¡ä»¶ï¼Œç”šè‡³å…¨æ–‡æœç´¢æ¥æŸ¥è¯¢è®¢å•æ•°æ®ï¼Œæˆ–æ˜¯å®šæ—¶åˆ†æä»»åŠ¡éœ€è¦ä¸€æ¬¡æŸ¥è¯¢å¤§é‡æ•°æ®ï¼Œè¿™äº›åœºæ™¯å¯¹æ•°æ®å®æ—¶æ€§è¦æ±‚éƒ½ä¸é«˜ï¼Œå¯ä»¥åˆ°ESè¿›è¡Œæœç´¢ã€‚æ­¤å¤–ï¼ŒMySQLä¸­çš„æ•°æ®å¯ä»¥å½’æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ESä¸­ä¿ç•™æ›´ä¹…çš„æ•°æ®ï¼Œè€Œä¸”æŸ¥è¯¢å†å²æ•°æ®ä¸€èˆ¬å¹¶å‘ä¸ä¼šå¾ˆå¤§ï¼Œå¯ä»¥ç»Ÿä¸€è·¯ç”±åˆ°ESæŸ¥è¯¢ã€‚</li>\n<li>ç›‘æ§ç³»ç»Ÿæˆ–åå°æŠ¥è¡¨ç³»ç»Ÿéœ€è¦å‘ˆç°ä¸šåŠ¡ç›‘æ§å›¾è¡¨æˆ–è¡¨æ ¼ï¼Œå¯ä»¥æŠŠè¯·æ±‚è·¯ç”±åˆ°InfluxDBæŸ¥è¯¢ã€‚</li>\n</ul><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘é€šè¿‡ä¸‰ä¸ªæ¡ˆä¾‹åˆ†åˆ«å¯¹æ¯”äº†ç¼“å­˜æ•°æ®åº“Redisã€æ—¶é—´åºåˆ—æ•°æ®åº“InfluxDBã€æœç´¢æ•°æ®åº“ESå’ŒMySQLçš„æ€§èƒ½ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼š</p><ul>\n<li>Rediså¯¹å•æ¡æ•°æ®çš„è¯»å–æ€§èƒ½è¿œè¿œé«˜äºMySQLï¼Œä½†ä¸é€‚åˆè¿›è¡ŒèŒƒå›´æœç´¢ã€‚</li>\n<li>InfluxDBå¯¹äºæ—¶é—´åºåˆ—æ•°æ®çš„èšåˆæ•ˆç‡è¿œè¿œé«˜äºMySQLï¼Œä½†å› ä¸ºæ²¡æœ‰ä¸»é”®ï¼Œæ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªé€šç”¨æ•°æ®åº“ã€‚</li>\n<li>ESå¯¹å…³é”®å­—çš„å…¨æ–‡æœç´¢èƒ½åŠ›è¿œè¿œé«˜äºMySQLï¼Œä½†æ˜¯å­—æ®µçš„æ›´æ–°æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚åˆä¿å­˜é¢‘ç¹æ›´æ–°çš„æ•°æ®ã€‚</li>\n</ul><p>æœ€åï¼Œæˆ‘ä»¬ç»™å‡ºäº†ä¸€ä¸ªæ··åˆä½¿ç”¨MySQL + Redis + InfluxDB + ESçš„æ¶æ„æ–¹æ¡ˆï¼Œå……åˆ†å‘æŒ¥äº†å„ç§æ•°æ®åº“çš„ç‰¹é•¿ï¼Œç›¸äº’é…åˆæ„æˆäº†ä¸€ä¸ªå¯ä»¥åº”å¯¹å„ç§å¤æ‚æŸ¥è¯¢ï¼Œä»¥åŠé«˜å¹¶å‘è¯»å†™çš„å­˜å‚¨æ¶æ„ã€‚</p><ul>\n<li>ä¸»æ•°æ®ç”±ä¸¤ç§MySQLæ•°æ®è¡¨æ„æˆï¼Œå…¶ä¸­ç´¢å¼•è¡¨æ‰¿æ‹…ç®€å•æ¡ä»¶çš„æœç´¢æ¥å¾—åˆ°ä¸»é”®ï¼ŒShardingè¡¨æ‰¿æ‹…å¤§å¹¶å‘çš„ä¸»é”®æŸ¥è¯¢ã€‚ä¸»æ•°æ®ç”±åŒæ­¥å†™æœåŠ¡å†™å…¥ï¼Œå†™å…¥åå‘å‡ºMQæ¶ˆæ¯ã€‚</li>\n<li>è¾…åŠ©æ•°æ®å¯ä»¥æ ¹æ®éœ€æ±‚é€‰ç”¨åˆé€‚çš„NoSQLï¼Œç”±å•ç‹¬ä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥å†™æœåŠ¡ç›‘å¬MQåå¼‚æ­¥å†™å…¥ã€‚</li>\n<li>ç”±ç»Ÿä¸€çš„æŸ¥è¯¢æœåŠ¡ï¼Œå¯¹æ¥æ‰€æœ‰æŸ¥è¯¢éœ€æ±‚ï¼Œæ ¹æ®ä¸åŒçš„æŸ¥è¯¢éœ€æ±‚è·¯ç”±æŸ¥è¯¢åˆ°åˆé€‚çš„å­˜å‚¨ï¼Œç¡®ä¿æ¯ä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿå¯ä»¥æ ¹æ®åœºæ™¯å‘æŒ¥æ‰€é•¿ï¼Œå¹¶åˆ†æ•£å„æ•°æ®åº“ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</li>\n</ul><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>æˆ‘ä»¬æåˆ°ï¼ŒInfluxDBä¸èƒ½åŒ…å«å¤ªå¤štagã€‚ä½ èƒ½å†™ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œæ¥æ¨¡æ‹Ÿè¿™ä¸ªé—®é¢˜ï¼Œå¹¶è§‚å¯Ÿä¸‹InfluxDBçš„å†…å­˜ä½¿ç”¨æƒ…å†µå—ï¼Ÿ</li>\n<li>æ–‡æ¡£æ•°æ®åº“MongoDBï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸ç”¨çš„NoSQLã€‚ä½ è§‰å¾—MongoDBçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒé€‚åˆç”¨åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹å‘¢ï¼Ÿ</li>\n</ol><p>å…³äºæ•°æ®å­˜å‚¨ï¼Œä½ è¿˜æœ‰å…¶ä»–å¿ƒå¾—å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"25 | å¼‚æ­¥å¤„ç†å¥½ç”¨ï¼Œä½†éå¸¸å®¹æ˜“ç”¨é”™","id":234928},"right":{"article_title":"ç­”ç–‘ç¯‡ï¼šè®¾è®¡ç¯‡æ€è€ƒé¢˜ç­”æ¡ˆåˆé›†","id":263776}},"comments":[{"had_liked":false,"id":217544,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1589531160,"is_pvip":false,"replies":[{"id":"80481","content":"è¯´çš„ä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":217544,"uid":"1001470","ip_address":"","utype":1,"ctime":1589533935,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"113258680856","product_id":100047701,"comment_content":"å…¶å®ï¼Œå…·ä½“ä½¿ç”¨ä½•ç§æ•°æ®åº“ï¼Œå¦‚æœäº†è§£å…¶åŸç†ï¼Œé‚£å°±å¾ˆå®¹æ˜“å¼„æ‡‚äº†ã€‚<br>æˆ‘å°±è¯´è¯´ESï¼Œ<br>ESï¼Œå› ä¸ºå…¶æœ¬èº«å…¨æ–‡ç´¢å¼•ï¼Œå’Œå¤æ‚æŸ¥è¯¢çš„é«˜æ€§èƒ½ï¼Œæœ€ä¸»è¦è¿˜æ˜¯ä¾èµ–äºå…¶åˆ†è¯ä¹‹åç®€å†çš„æ˜ å°„è¡¨ã€‚åŸºæœ¬å¯ä»¥ç†è§£ä¸ºç±»ä¼¼æ•°æ®åº“ç´¢å¼•ä¸€æ ·çš„å­˜åœ¨ã€‚ç´¢å¼•çš„å¼Šç«¯ï¼Œä¹Ÿå°±æ˜¯ESçš„å¼Šç«¯ã€‚<br>ç´¢å¼•ï¼ŒåŸºæœ¬ç›®çš„æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œç”¨ä¸€äº›å†—ä½™çš„èŠ‚ç‚¹æ•°æ®æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚ä½†æ˜¯å¸¦æ¥çš„é—®é¢˜ï¼Œä¸€æ–¹é¢æ˜¯ç©ºé—´çš„å ç”¨ï¼Œä»¥åŠç»´æŠ¤ç´¢å¼•æ‰€éœ€è¦çš„æˆæœ¬ã€‚å› ä¸ºéœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œæ‰€ä»¥åˆ æ”¹æ•°æ®æ—¶æ€§èƒ½è¾ƒå·®ã€‚<br>ESçš„ç´¢å¼•åˆæ›´åŠ è¿‡åˆ†ï¼Œå‡ ä¹æ˜¯é’ˆå¯¹å•ä¸ªæ–‡ç« çš„å…¨éƒ¨å†…å®¹ï¼Œå»ºç«‹äº†åˆ†è¯æ˜ å°„ï¼Œä¿®æ”¹ä¸€ç¯‡æ–‡ç« å†…å®¹ï¼Œå¯èƒ½ä¼šå¤§å¹…åº¦ä¿®æ”¹æ˜ å°„å†…å®¹ã€‚æ‰€ä»¥ä¸é€‚åˆé¢‘ç¹ä¿®æ”¹çš„æ•°æ®ã€‚<br>","like_count":27,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495174,"discussion_content":"è¯´çš„ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589533935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218246,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1589764830,"is_pvip":false,"replies":[{"id":"80704","content":"éé‡è¦æ•°æ®ï¼Œå¹¶ä¸”æ•°æ®ç»“æ„ä¸å›ºå®šçš„ï¼Œæ’å…¥é‡åˆå¾ˆå¤§çš„åŸå§‹æ•°æ®ï¼ˆæ¯”å¦‚çˆ¬è™«åŸå§‹æ•°æ®ï¼‰å¯ä»¥è€ƒè™‘Mongoã€‚ä»ä¸ªäººå–œå¥½è€Œè¨€ï¼Œç»¼åˆæ€§NOSQLï¼Œæˆ‘æ›´å–œæ¬¢ESè€Œä¸æ˜¯Mongoï¼ŒMongoåœ¨æ•°æ®é‡åˆ°TBçº§åˆ«æˆ‘æ„Ÿè§‰ä¸ç¨³å®šï¼ŒShardingä¹Ÿä¸é‚£ä¹ˆå¥½ç”¨ï¼Œä¸€å®¶ä¹‹è¨€ã€‚","user_name":"ä½œè€…å›å¤","comment_id":218246,"uid":"1001470","ip_address":"","utype":1,"ctime":1589766656,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"78899176158","product_id":100047701,"comment_content":"è€å¸ˆæ²¡è¯´mongoæ•°æ®åº“ï¼Œæˆ‘çš„ç†è§£æ˜¯å¦‚æœä¸æ˜¯acidè¦æ±‚ç‰¹åˆ«é«˜çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥å°†mysqlæ›¿æ¢ä¸ºmongo.ä¸çŸ¥é“ç†è§£å¯¹ä¸å¯¹ã€‚","like_count":19,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495401,"discussion_content":"éé‡è¦æ•°æ®ï¼Œå¹¶ä¸”æ•°æ®ç»“æ„ä¸å›ºå®šçš„ï¼Œæ’å…¥é‡åˆå¾ˆå¤§çš„åŸå§‹æ•°æ®ï¼ˆæ¯”å¦‚çˆ¬è™«åŸå§‹æ•°æ®ï¼‰å¯ä»¥è€ƒè™‘Mongoã€‚ä»ä¸ªäººå–œå¥½è€Œè¨€ï¼Œç»¼åˆæ€§NOSQLï¼Œæˆ‘æ›´å–œæ¬¢ESè€Œä¸æ˜¯Mongoï¼ŒMongoåœ¨æ•°æ®é‡åˆ°TBçº§åˆ«æˆ‘æ„Ÿè§‰ä¸ç¨³å®šï¼ŒShardingä¹Ÿä¸é‚£ä¹ˆå¥½ç”¨ï¼Œä¸€å®¶ä¹‹è¨€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589766656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217123,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1589423014,"is_pvip":false,"discussion_count":3,"race_medal":1,"score":"35949161382","product_id":100047701,"comment_content":"æˆ‘è¯´è¯´ä¸ªäººå¯¹äºMongoDBçš„ç†è§£ï¼Œå®ƒçš„ä¼˜åŠ¿ï¼š<br>1.schema freeï¼Œä¸éœ€è¦é¢å¤–å®šä¹‰åˆ—åï¼Œæ¯ä¸ªæ–‡æ¡£çš„keyéœ€è¦ä¸€è‡´ã€‚<br>2.å¯¹äºjsonç»“æ„å­˜å‚¨å’Œè¯»å–æ–¹ä¾¿ï¼Œæ¯”å¦‚å–jsonæŸä¸ªkeyçš„valueæ¯”è¾ƒæ–¹ä¾¿ã€‚ç›¸å¯¹äºmysqlå­˜å‚¨jsonéœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚<br>3.æŸ¥è¯¢æ¥çœ‹ï¼Œ3.0ä¹‹åçš„mongoé‡‡ç”¨äº†B+æ ‘å’ŒLSMä¸¤ç§æ–¹å¼ï¼Œæ¥ä¼˜åŒ–è¯»å¤šå†™å°‘å’Œå†™å¤šè¯»å°‘æƒ…å†µã€‚<br><br>åŠ£åŠ¿ï¼š<br>1. schema freeï¼Œæ˜¯åŒåˆƒå‰‘ï¼Œå¦‚æœæŸä¸ªå­—æ®µå¹¶ä¸æ˜¯æ‰€æœ‰æ–‡æ¡£é‡Œå­˜åœ¨ï¼ŒæŸ¥è¯¢æ˜¯ä¸ªéº»çƒ¦äº‹ã€‚<br>2.ä¸æ”¯æŒäº‹åŠ¡<br>3.ä¸ºäº†å‘RDBMSé æ‹¢ï¼Œé€šè¿‡å†—ä½™å­—æ®µæ¥å®ç°ã€‚å®è·µèµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚","like_count":8,"discussions":[{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265713,"discussion_content":"4.xå¼€å§‹æ”¯æŒäº‹åŠ¡äº†","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589429591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1150927,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","nickname":"é‚£æ—¶åˆ»","note":"","ucode":"B0D150856C3A4A","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":265740,"discussion_content":"å¥¥å¥¥ï¼Œæ„Ÿè°¢æé†’...ç›®å‰ä½¿ç”¨çš„æ˜¯3.6ï¼Œ4ä»¥ä¸Šçš„ç‰¹æ€§æœ¨æœ‰æ€ä¹ˆå…³æ³¨è¿‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589432719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":265713,"ip_address":""},"score":265740,"extra":""}]},{"author":{"id":1430831,"avatar":"https://static001.geekbang.org/account/avatar/00/15/d5/2f/d9bb5dab.jpg","nickname":"æ‰“å­—å‘˜è€å¼ ","note":"","ucode":"95CB3E8FAFB141","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391560,"discussion_content":"esä¹Ÿæ˜¯json","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630509492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217263,"user_name":"ä¼¼æ›¾ç›¸è¯†","can_delete":false,"product_type":"c1","uid":1971079,"ip_address":"","ucode":"DCBA5F6ABC7401","user_header":"https://static001.geekbang.org/account/avatar/00/1e/13/87/73a17c60.jpg","comment_is_top":false,"comment_ctime":1589450958,"is_pvip":false,"replies":[{"id":"80309","content":"esä¸€èˆ¬æ˜¯ä¿å­˜å…¨é‡æ•°æ®ï¼Œç”šè‡³æ˜¯è¶…å…¨é‡æ•°æ®ï¼Œæ„æ€å°±æ˜¯æ¯”mysqlä¿å­˜çš„æ•°æ®è¿˜è¦å…¨ã€‚influxdbä½œä¸ºæ—¶é—´åºåˆ—æ•°æ®åº“åªèƒ½ä¿å­˜åŠ å·¥åçš„ä¸šåŠ¡æˆ–ç³»ç»ŸæŒ‡æ ‡æ•°æ®ï¼Œæ— æ³•ä¿å­˜å®é™…çš„ä¸šåŠ¡æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","comment_id":217263,"uid":"1001470","ip_address":"","utype":1,"ctime":1589452853,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"27359254734","product_id":100047701,"comment_content":"è€å¸ˆ Infludb,å’Œes è¿™äº›æ•°æ®åº“åšè¾…åŠ©æ•°æ®åº“ï¼Œéœ€è¦ä¿å­˜å…¨é‡æ•°æ®å—ï¼Ÿè¿˜æ˜¯æ ¹æ®ä¸šåŠ¡ä¿å­˜éƒ¨åˆ†å­—æ®µï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495094,"discussion_content":"esä¸€èˆ¬æ˜¯ä¿å­˜å…¨é‡æ•°æ®ï¼Œç”šè‡³æ˜¯è¶…å…¨é‡æ•°æ®ï¼Œæ„æ€å°±æ˜¯æ¯”mysqlä¿å­˜çš„æ•°æ®è¿˜è¦å…¨ã€‚influxdbä½œä¸ºæ—¶é—´åºåˆ—æ•°æ®åº“åªèƒ½ä¿å­˜åŠ å·¥åçš„ä¸šåŠ¡æˆ–ç³»ç»ŸæŒ‡æ ‡æ•°æ®ï¼Œæ— æ³•ä¿å­˜å®é™…çš„ä¸šåŠ¡æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589452853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217098,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1589420118,"is_pvip":false,"discussion_count":6,"race_medal":1,"score":"27359223894","product_id":100047701,"comment_content":"ç°åœ¨å…¬å¸çš„ä¸šåŠ¡å¯¹ACIDæ²¡æœ‰é‚£ä¹ˆé«˜çš„è¦æ±‚ï¼Œå·²ç»å…¨éƒ¨æ¢æˆäº†NoSQLï¼Œä¸»è¦å°±æ˜¯MongoDB+Redis+ESï¼Œè‡ªä»ç”¨äº†MongoDBï¼Œæˆ‘æ„Ÿè§‰è§£è„±äº†ï¼Œå†ä¹Ÿä¸ç”¨å»è®¾è®¡ä¸€å †å…³è”çš„è¡¨äº†ï¼Œå­—æ®µçš„æ‰©å……æˆ–å˜åŒ–éƒ½æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œå­—æ®µå–å€¼çš„æ£€éªŒå…¨éƒ¨åœ¨åº”ç”¨ç¨‹åºä¸­è§£å†³ï¼Œæœ‰ç‚¹ä¸çˆ½æ˜¯ï¼Œå†™å„ç§å¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡æ—¶æ²¡æœ‰å†™rdmsçš„sqlé‚£ä¹ˆæºœã€‚å¦å¤–å°±æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Keyså»redisæŸ¥è¯¢æ‰€æœ‰ç›¸å…³çš„æ•°æ®ï¼Œä¸€èˆ¬æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯æˆ‘ä¸€ç›´æƒ³ä¼˜åŒ–ä¸‹ï¼Œä»Šå¤©è€å¸ˆåˆæäº†ï¼Œå¿…é¡»ä¼˜åŒ–äº†ã€‚","like_count":6,"discussions":[{"author":{"id":2378309,"avatar":"https://static001.geekbang.org/account/avatar/00/24/4a/45/e048531a.jpg","nickname":"è¿ªç±³ä¹Œæ ¼æ–¯","note":"","ucode":"1D4393746DCBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374177,"discussion_content":"æœ‰ä¸ªé—®é¢˜å•Š, å¦‚æœå­—æ®µå–å€¼çš„æ ¡éªŒå…¨éƒ¨åœ¨å†…å­˜åš,å¦‚æœæ•°æ®é‡å¾ˆå¤§, ç½‘ç»œä¼ è¾“ä¸æ˜¯ç›´æ¥å°±çˆ†äº†å—? éƒ¨åˆ†èšåˆæ“ä½œå’Œè¿‡æ»¤è¿˜æ˜¯åœ¨æ•°æ®åº“ç«¯åšæ¯”è¾ƒå¥½,ä¸ªäººç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621050174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1176229,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f2/a5/f9255bbe.jpg","nickname":"Î©","note":"","ucode":"A8EE2EBD64AEFC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372329,"discussion_content":"mongodbé™¤äº†èšåˆæ“ä½œçœŸçš„å¤´ç–¼ï¼Œèšåˆæ“ä½œè¦æ˜¯ä½¿ç”¨ä¸å½“ç”šè‡³ä¸å¦‚åˆ†å¤šæ¬¡æŸ¥è¯¢æ•ˆç‡é«˜ï¼å…¶ä»–æ–¹é¢å…¶å®ä½¿ç”¨èµ·æ¥è·Ÿmysqlå·®å¼‚ä¸æ˜¯å¾ˆå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620287777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","nickname":"Michael","note":"","ucode":"C233DF1D224EC1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286194,"discussion_content":"é›†ç¾¤ä¸‹è¯•è¿‡å˜›ï¼Ÿscanæ“ä½œåœ¨Redisé›†ç¾¤ä¸‹ä¸æ”¯æŒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593083439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1274787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","nickname":"Michael","note":"","ucode":"C233DF1D224EC1","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":286199,"discussion_content":"è°¢è°¢æé†’ï¼Œæˆ‘å»éªŒè¯ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593085960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":286194,"ip_address":""},"score":286199,"extra":""},{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1274787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","nickname":"Michael","note":"","ucode":"C233DF1D224EC1","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":287214,"discussion_content":"æ„Ÿè°¢æŒ‡æ­£ï¼Œåˆç²—ç•¥çš„å†™äº†ä¸€ç‰ˆï¼š\n\n    public Set<String> scan(final String pattern) {\n        RedisConnection redisConnection = redisTemplate.getConnectionFactory().getConnection();\n        Object nativeConn = redisConnection.getNativeConnection();\n        // nativeConn: Jedis or JedisCluster\n        log.info(&#34;nativeConn: {}&#34;, nativeConn.getClass().getSimpleName());\n        if (nativeConn instanceof JedisCluster) {\n            return scanForCluster((JedisCluster) nativeConn, pattern);\n        }\n        return scanForSingleNode((Jedis) nativeConn, pattern);\n    }\n\n    private Set<String> scanForCluster(JedisCluster jedisCluster, final String pattern) {\n        return jedisCluster.getClusterNodes()\n                .entrySet()\n                .stream()\n                .filter(entry -> !entry.getValue().getResource().info(&#34;replication&#34;).contains(&#34;role:slave&#34;))\n                .flatMap(entry -> scanForSingleNode(entry.getValue().getResource(), pattern).stream())\n                .collect(Collectors.toSet());\n    }\n\n    private Set<String> scanForSingleNode(Jedis jedis, final String pattern) {\n        return (Set<String>) redisTemplate.execute((RedisCallback<Set<String>>) connection -> {\n            ScanParams scanParams = new ScanParams();\n            scanParams.match(pattern);\n            scanParams.count(REDIS_SCAN_COUNT_DEFAULT);\n\n            Set<String> keys = new HashSet<>();\n            ScanResult<String> scanResult = jedis.scan(REDIS_SCAN_CURSOR_INIT, scanParams);\n            while (null != scanResult.getStringCursor()) {\n                keys.addAll(scanResult.getResult());\n                if (REDIS_SCAN_CURSOR_INIT.equals(scanResult.getStringCursor())) {\n                    break;\n                }\n                scanResult = jedis.scan(scanResult.getStringCursor(), scanParams);\n            }\n\n            return keys;\n        });\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593401128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":286194,"ip_address":""},"score":287214,"extra":""},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":383511,"discussion_content":"ã€‚ã€‚äº² æ¢æˆ lettuce è¯•è¯•ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626139069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287214,"ip_address":""},"score":383511,"extra":""}]}]},{"had_liked":false,"id":217118,"user_name":"fly12580","can_delete":false,"product_type":"c1","uid":1345444,"ip_address":"","ucode":"62F5D0B9776FDF","user_header":"https://static001.geekbang.org/account/avatar/00/14/87/a4/bd373a4a.jpg","comment_is_top":false,"comment_ctime":1589422567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23064259047","product_id":100047701,"comment_content":"redisè¿˜å¯ä»¥ç”¨æ¥åšåˆ†å¸ƒå¼å¹¶å‘é”ã€‚","like_count":6},{"had_liked":false,"id":220051,"user_name":"ç»ˆç»“è€…999å·","can_delete":false,"product_type":"c1","uid":1055854,"ip_address":"","ucode":"33ADE61580B6DD","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","comment_is_top":false,"comment_ctime":1590144905,"is_pvip":true,"replies":[{"id":"81215","content":"è‡³å°‘ä¸‰ä¸ªæœˆ å–å†³äºä¸šåŠ¡ä¸Šè®©ç”¨æˆ·æŸ¥å¤šä¹…çš„è®¢å• æ›´é•¿æœŸçš„æ‰“åˆ°es","user_name":"ä½œè€…å›å¤","comment_id":220051,"uid":"1001470","ip_address":"","utype":1,"ctime":1590147585,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"18770014089","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹å¯¹äºä¸€ä¸ªé«˜å¹¶å‘çš„ç³»ç»Ÿï¼Œç´¢å¼•åº“æ‚¨ä»¬ä¿å­˜å¤šé•¿æ—¶é—´å‘¢ï¼Ÿæ²¡æœ‰å¤œç»´æ¸…ç†å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496031,"discussion_content":"è‡³å°‘ä¸‰ä¸ªæœˆ å–å†³äºä¸šåŠ¡ä¸Šè®©ç”¨æˆ·æŸ¥å¤šä¹…çš„è®¢å• æ›´é•¿æœŸçš„æ‰“åˆ°es","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590147585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217307,"user_name":"kyl","can_delete":false,"product_type":"c1","uid":1406090,"ip_address":"","ucode":"DBDFD0FEB5A135","user_header":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","comment_is_top":false,"comment_ctime":1589461948,"is_pvip":false,"replies":[{"id":"80334","content":"åŸºæœ¬æ²¡é”™çš„ mongodbå»ºè®®ç”¨äºéé‡è¦ä¸šåŠ¡åˆå§‹æ•°æ®ä¿å­˜","user_name":"ä½œè€…å›å¤","comment_id":217307,"uid":"1001470","ip_address":"","utype":1,"ctime":1589462189,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"18769331132","product_id":100047701,"comment_content":"è¯´ä¸€ä¸‹æˆ‘å¯¹mongodbçš„ç†è§£ï¼Œæœ›è€å¸ˆæŒ‡æ­£ã€‚mongodbå› ä¸ºæ˜¯æ–‡æ¡£å‹æ•°æ®åº“ä»¥jsonæ ¼å¼å­˜å‚¨ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿çš„å­˜å‚¨å„ç§ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶mongodbæ¨ªå‘æ‰©å±•åªéœ€å¢åŠ åˆ†ç‰‡æ¯”MySQLæ›´åŠ æ–¹ä¾¿ï¼Œæ•°æ®é‡å¾ˆå¤§çš„åœºæ™¯ä¸‹æ„Ÿè§‰æ€§èƒ½ä¼˜äºMySQLã€‚ä½†æ˜¯mongodbå¯¹äº‹åŠ¡æ”¯æŒæ¯”è¾ƒå·®ï¼Œè™½ç„¶4.0å¼•å…¥äº†äº‹åŠ¡ï¼Œä½†æ˜¯å¯èƒ½æœ‰å‘ï¼Œå¦å¤–mongodbä¸æ”¯æŒè¡¨çš„å…³è”æŸ¥è¯¢ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495105,"discussion_content":"åŸºæœ¬æ²¡é”™çš„ mongodbå»ºè®®ç”¨äºéé‡è¦ä¸šåŠ¡åˆå§‹æ•°æ®ä¿å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589462189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170798,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/6e/1479ce4f.jpg","nickname":"CoderWang","note":"","ucode":"6E102DD60AA4A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281319,"discussion_content":"mongodbæ”¯æŒè”è¡¨æŸ¥è¯¢ï¼Œ$lookup","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1591711204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217161,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1589428868,"is_pvip":false,"replies":[{"id":"80303","content":"1. æˆ‘æ˜¯æŒ‡é€»è¾‘å«ä¹‰ä¸Šè¿™ä¸ªå­—æ®µæ˜¯å¤–é”®çš„ä½œç”¨ï¼Œä¸æ˜¯æŒ‡è¦å¤–é”®å…³ç³»çš„ç»‘å®š<br>2. è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸€å¥—é’ˆå¯¹å¤§æ•°æ®é«˜å¹¶å‘çš„ç³»ç»Ÿï¼ˆæ¯”å¦‚è®¢å•ç³»ç»Ÿçš„ï¼‰çš„å¤åˆæ•°æ®å¼•æ“æ–¹æ¡ˆï¼Œä¸æ˜¯è¯´æ™®é€šçš„ä¸šåŠ¡è¡¨éƒ½è¦è¿™ä¹ˆåš<br>3. ä¸æ˜¯å‡ å€çš„å…³ç³»ï¼Œç´¢å¼•è¡¨çš„å­—æ®µæ˜¯å…¨é‡å­—æ®µçš„å­é›†ï¼Œç´¢å¼•è¡¨ä¸ä¼šåšShardingï¼Œè¿™ç‚¹ä½ æ²¡æœ‰æˆ‘çš„æ„æ€ï¼Œå¯ä»¥å†è¯¦ç»†çœ‹ä¸€ä¸‹æ–‡ä¸­çš„è¯´æ˜ï¼š<br><br>å¯¹äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢å¾—åˆ°ä¸»é”®ï¼Œåªéœ€è¦æŸ¥è¯¢ä¸€æ£µ B+ æ ‘ï¼Œæ•ˆç‡åŒæ ·å¾ˆé«˜ã€‚ä½†ç´¢å¼•çš„å€¼ä¸å®œè¿‡å¤§ï¼Œæ¯”å¦‚å¯¹ varchar(1000) è¿›è¡Œç´¢å¼•ä¸å¤ªåˆé€‚ï¼Œè€Œç´¢å¼•å¤–é”®ï¼ˆä¸€èˆ¬æ˜¯ int æˆ– bigint ç±»å‹ï¼‰æ€§èƒ½å°±ä¼šæ¯”è¾ƒå¥½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ MySQL ä¸­å»ºç«‹ä¸€å¼ â€œç´¢å¼•è¡¨â€ï¼Œé™¤äº†ä¿å­˜ä¸»é”®å¤–ï¼Œä¸»è¦æ˜¯ä¿å­˜å„ç§å…³è”è¡¨çš„å¤–é”®ï¼Œä»¥åŠå°½å¯èƒ½å°‘çš„ varchar ç±»å‹çš„å­—æ®µã€‚è¿™å¼ ç´¢å¼•è¡¨çš„å¤§éƒ¨åˆ†åˆ—éƒ½å¯ä»¥å»ºä¸ŠäºŒçº§ç´¢å¼•ï¼Œç”¨äºè¿›è¡Œç®€å•æœç´¢ï¼Œæœç´¢çš„ç»“æœæ˜¯ä¸»é”®çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ•°æ®ã€‚ç”±äºç´¢å¼•è¡¨å­—æ®µè½»é‡å¹¶ä¸”æ•°é‡ä¸å¤šï¼ˆä¸€èˆ¬æ§åˆ¶åœ¨ 10 ä¸ªä»¥å†…ï¼‰ï¼Œæ‰€ä»¥å³ä¾¿ç´¢å¼•è¡¨æ²¡æœ‰è¿›è¡Œ Sharding æ‹†åˆ†ï¼Œé—®é¢˜ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚","user_name":"ä½œè€…å›å¤","comment_id":217161,"uid":"1001470","ip_address":"","utype":1,"ctime":1589434040,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"18769298052","product_id":100047701,"comment_content":"åˆæ˜¯å¹²è´§æ»¡æ»¡ï¼Œå¾ˆå¤šæ–°æ¥è§¦çš„ä¸œè¥¿ï¼Œæ„Ÿè°¢è€å¸ˆã€‚<br>å¯¹äºMysqlæ“…é•¿çš„åœ°æ–¹çš„ç¬¬äºŒç‚¹ä¸æ˜¯å¾ˆç†è§£ï¼š<br>   1.ä¸æ˜¯ä¸å»ºè®®è®¾ç½®å¤–é”®å—ï¼Ÿ <br>   2.ä¸“é—¨å¼„ä¸ªç´¢å¼•è¡¨æ”¾ä¸»é”®ä¸å¤–é”®çš„å…³è”å…³ç³»ï¼Œé‚£å²‚ä¸æ˜¯æ¯å¼ è¡¨éƒ½è¦é…è¿™ä¹ˆä¸€ä¸ªç´¢å¼•è¡¨ï¼Œè¿™ä¸æµªè´¹å†…å­˜å—ï¼Ÿ<br>   3.ä¸»é”®è·Ÿå…³è”è¡¨æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œé‚£è¿™ä¸ªç´¢å¼•è¡¨ç›¸å¯¹æ•°æ®è¡¨çš„æ•°æ®é‡å²‚ä¸æ˜¯å‡ å€çš„å…³ç³»ï¼Œæ€§èƒ½èƒ½å¥½äº†å—ï¼Ÿ<br>è¿˜è¯·è€å¸ˆæŒ‡æ•™ã€‚","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495057,"discussion_content":"1. æˆ‘æ˜¯æŒ‡é€»è¾‘å«ä¹‰ä¸Šè¿™ä¸ªå­—æ®µæ˜¯å¤–é”®çš„ä½œç”¨ï¼Œä¸æ˜¯æŒ‡è¦å¤–é”®å…³ç³»çš„ç»‘å®š\n2. è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸€å¥—é’ˆå¯¹å¤§æ•°æ®é«˜å¹¶å‘çš„ç³»ç»Ÿï¼ˆæ¯”å¦‚è®¢å•ç³»ç»Ÿçš„ï¼‰çš„å¤åˆæ•°æ®å¼•æ“æ–¹æ¡ˆï¼Œä¸æ˜¯è¯´æ™®é€šçš„ä¸šåŠ¡è¡¨éƒ½è¦è¿™ä¹ˆåš\n3. ä¸æ˜¯å‡ å€çš„å…³ç³»ï¼Œç´¢å¼•è¡¨çš„å­—æ®µæ˜¯å…¨é‡å­—æ®µçš„å­é›†ï¼Œç´¢å¼•è¡¨ä¸ä¼šåšShardingï¼Œè¿™ç‚¹ä½ æ²¡æœ‰æˆ‘çš„æ„æ€ï¼Œå¯ä»¥å†è¯¦ç»†çœ‹ä¸€ä¸‹æ–‡ä¸­çš„è¯´æ˜ï¼š\n\nå¯¹äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢å¾—åˆ°ä¸»é”®ï¼Œåªéœ€è¦æŸ¥è¯¢ä¸€æ£µ B+ æ ‘ï¼Œæ•ˆç‡åŒæ ·å¾ˆé«˜ã€‚ä½†ç´¢å¼•çš„å€¼ä¸å®œè¿‡å¤§ï¼Œæ¯”å¦‚å¯¹ varchar(1000) è¿›è¡Œç´¢å¼•ä¸å¤ªåˆé€‚ï¼Œè€Œç´¢å¼•å¤–é”®ï¼ˆä¸€èˆ¬æ˜¯ int æˆ– bigint ç±»å‹ï¼‰æ€§èƒ½å°±ä¼šæ¯”è¾ƒå¥½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ MySQL ä¸­å»ºç«‹ä¸€å¼ â€œç´¢å¼•è¡¨â€ï¼Œé™¤äº†ä¿å­˜ä¸»é”®å¤–ï¼Œä¸»è¦æ˜¯ä¿å­˜å„ç§å…³è”è¡¨çš„å¤–é”®ï¼Œä»¥åŠå°½å¯èƒ½å°‘çš„ varchar ç±»å‹çš„å­—æ®µã€‚è¿™å¼ ç´¢å¼•è¡¨çš„å¤§éƒ¨åˆ†åˆ—éƒ½å¯ä»¥å»ºä¸ŠäºŒçº§ç´¢å¼•ï¼Œç”¨äºè¿›è¡Œç®€å•æœç´¢ï¼Œæœç´¢çš„ç»“æœæ˜¯ä¸»é”®çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ•°æ®ã€‚ç”±äºç´¢å¼•è¡¨å­—æ®µè½»é‡å¹¶ä¸”æ•°é‡ä¸å¤šï¼ˆä¸€èˆ¬æ§åˆ¶åœ¨ 10 ä¸ªä»¥å†…ï¼‰ï¼Œæ‰€ä»¥å³ä¾¿ç´¢å¼•è¡¨æ²¡æœ‰è¿›è¡Œ Sharding æ‹†åˆ†ï¼Œé—®é¢˜ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589434040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247235,"user_name":"è‹—","can_delete":false,"product_type":"c1","uid":1088710,"ip_address":"","ucode":"5ECCC6C855E541","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/c6/05a6798f.jpg","comment_is_top":false,"comment_ctime":1599638515,"is_pvip":false,"replies":[{"id":"90811","content":"Mongodb ä¸å»ºè®®ç”¨äºé‡è¦ä¸šåŠ¡ï¼Œåªé€‚åˆè¾¹ç¼˜æ•°æ®ï¼Œæ¯”å¦‚ä¸šåŠ¡æ—¥å¿—ã€çˆ¬è™«åŸå§‹æ•°æ®ç­‰","user_name":"ä½œè€…å›å¤","comment_id":247235,"uid":"1001470","ip_address":"","utype":1,"ctime":1599654264,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10189573107","product_id":100047701,"comment_content":"MongoDB 4.2.xæä¾›äº†ç›¸å½“äºå…³ç³»æ•°æ®åº“RRçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼›å¥½åƒä¹Ÿèƒ½ç”¨äºäº¤æ˜“æ•°æ®å¼ºacidçš„éœ€æ±‚ã€‚æ„Ÿè§‰ç”¨æ•°ç»„å­—æ®µå¤„ç†ç®€å•çš„ä¸€å¯¹å¤šå…³ç³»å¾ˆæ–¹ä¾¿ã€‚","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505348,"discussion_content":"Mongodb ä¸å»ºè®®ç”¨äºé‡è¦ä¸šåŠ¡ï¼Œåªé€‚åˆè¾¹ç¼˜æ•°æ®ï¼Œæ¯”å¦‚ä¸šåŠ¡æ—¥å¿—ã€çˆ¬è™«åŸå§‹æ•°æ®ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599654264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219192,"user_name":"æ°¸å¤œ","can_delete":false,"product_type":"c1","uid":1349301,"ip_address":"","ucode":"92F435DFA5C197","user_header":"https://static001.geekbang.org/account/avatar/00/14/96/b5/d09a53c7.jpg","comment_is_top":false,"comment_ctime":1589964140,"is_pvip":false,"replies":[{"id":"80968","content":"ä½¿ç”¨ESï¼Œæ²¡æœ‰Shardingçš„å…³ç³»å‹æ•°æ®åº“æ‰¿è½½ä¸äº†ä½ è¿™ä¹ˆå¤§çš„æ•°æ®é‡çš„ç»Ÿè®¡","user_name":"ä½œè€…å›å¤","comment_id":219192,"uid":"1001470","ip_address":"","utype":1,"ctime":1589966489,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10179898732","product_id":100047701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘ä»¬è¿™è¾¹ä¸»è¦åšä¸€äº›äº¤äº’å¼æ•°æ®å¯è§†åŒ–ç³»ç»Ÿï¼Œç›®å‰ç”¨çš„ä¸»è¦æ˜¯postgresæ•°æ®åº“ï¼Œä½†æ˜¯ä¸€æ—¦æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå‡ ç™¾ä¸‡æ¡çš„æ•°æ®çš„ä¸€äº›è¿‡æ»¤ç»Ÿè®¡éƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œéœ€è¦20~30sï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œjsonè¿™æ ·çš„ç‰¹æ®Šç±»å‹ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å…¶å®ƒçš„æ•°æ®åº“æˆ–è€…æ¡†æ¶èƒ½æé«˜è¿™ç§åœºæ™¯ä¸‹çš„æ•ˆç‡é—®é¢˜ã€‚","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495709,"discussion_content":"ä½¿ç”¨ESï¼Œæ²¡æœ‰Shardingçš„å…³ç³»å‹æ•°æ®åº“æ‰¿è½½ä¸äº†ä½ è¿™ä¹ˆå¤§çš„æ•°æ®é‡çš„ç»Ÿè®¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589966489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225308,"user_name":"CoderWang","can_delete":false,"product_type":"c1","uid":1170798,"ip_address":"","ucode":"6E102DD60AA4A6","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/6e/1479ce4f.jpg","comment_is_top":false,"comment_ctime":1591711644,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5886678940","product_id":100047701,"comment_content":"æˆ‘æ¥è¯´è¯´ä¸ªäººå¯¹mongodbçš„ç†è§£ï¼Œå¾ˆå¤šäººä¹‹å‰å¯¹mongodbç†è§£æ˜¯ä¸æ”¯æŒäº‹ç‰©æˆ–è€…è‹¥äº‹ç‰©ï¼Œä½†æ˜¯åœ¨4.0ä¹‹åç‰¹åˆ«åœ¨æœ€æ–°ç‰ˆæœ¬4.2ä¹‹åå¯¹äº‹ç‰©æ”¯æŒå¾ˆå¥½äº†ã€‚è€Œä¸”mongodbæ˜¯jsonæ ¼å¼å­˜å‚¨ï¼Œéå¸¸æ–¹ä¾¿çµæ´»å¯¹æ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ¯”å¦‚æ•°ç»„ç±»å‹ã€‚åœ¨åŠ å…¥aggregateä¹‹åå¯¹èšåˆç®¡é“æŸ¥è¯¢éå¸¸æ–¹ä¾¿ï¼Œå¯¹æ•°æ®ç»Ÿè®¡åˆ†æç‰¹åˆ«å¤§å¸®åŠ©ã€‚ä¸ªäººç†è§£ï¼Œè°¢è°¢","like_count":1},{"had_liked":false,"id":218256,"user_name":"Gå°è°ƒ","can_delete":false,"product_type":"c1","uid":1145529,"ip_address":"","ucode":"8F3D50E2C1A559","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/b9/c3d3a92f.jpg","comment_is_top":false,"comment_ctime":1589766129,"is_pvip":true,"replies":[{"id":"80712","content":"æ˜¯æŒ‡è¿™ä¸ªè¡¨å¤§å¤šå­—æ®µéƒ½å»ºäº†ç´¢å¼•ï¼Œä¸»è¦ç”¨äºç®€å•æœç´¢ï¼Œç´¢å¼•åº“å¯¹æ¯”Shardingåº“","user_name":"ä½œè€…å›å¤","comment_id":218256,"uid":"1001470","ip_address":"","utype":1,"ctime":1589769217,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"5884733425","product_id":100047701,"comment_content":"è€å¸ˆ æœ‰ä¸ªç–‘é—®â“ ä½ å›¾é‡Œå†™çš„mysqlç´¢å¼•åº“ æ˜¯æŒ‡è¡¨ä¸Šå»ºç«‹äº†ç´¢å¼•çš„åº“å—","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495407,"discussion_content":"æ˜¯æŒ‡è¿™ä¸ªè¡¨å¤§å¤šå­—æ®µéƒ½å»ºäº†ç´¢å¼•ï¼Œä¸»è¦ç”¨äºç®€å•æœç´¢ï¼Œç´¢å¼•åº“å¯¹æ¯”Shardingåº“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589769217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123011,"avatar":"https://static001.geekbang.org/account/avatar/00/11/22/c3/5c69ab81.jpg","nickname":"Lucky Dog","note":"","ucode":"C71C5D24200CCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306107,"discussion_content":"ç´¢å¼•è¡¨ï¼Œè¡¨çš„å­—æ®µåŸºæœ¬ä¸Šéƒ½å»ºç«‹ç´¢å¼•ï¼Œå­—æ®µæœ€å¥½ä¸è¶…è¿‡10ä¸ªã€‚è€å¸ˆæ–‡ä¸­æœ‰è®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600171311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217127,"user_name":"é‚£æ—¶åˆ»","can_delete":false,"product_type":"c1","uid":1150927,"ip_address":"","ucode":"B0D150856C3A4A","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg","comment_is_top":false,"comment_ctime":1589423174,"is_pvip":false,"replies":[{"id":"80284","content":"å–å†³äºç¼“å­˜çš„ä½¿ç”¨ç­–ç•¥ï¼Œæ¯”å¦‚Cache aside, Read through, Write throughï¼Œå¯ä»¥æ ¹æ®ä½ éœ€è¦çš„æ–¹æ¡ˆæŠŠå†™å…¥redisçš„æ“ä½œè½åˆ°è¯»æœåŠ¡æˆ–åŒæ­¥å†™æœåŠ¡å»å®ç°ã€‚","user_name":"ä½œè€…å›å¤","comment_id":217127,"uid":"1001470","ip_address":"","utype":1,"ctime":1589425449,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"5884390470","product_id":100047701,"comment_content":"è¯·é—®è€å¸ˆï¼Œæ–‡ç« æåˆ°çš„å¤šæ•°æ®åº“ç³»ç»Ÿä¾‹å­é‡Œï¼Œrediså†™å…¥æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495046,"discussion_content":"å–å†³äºç¼“å­˜çš„ä½¿ç”¨ç­–ç•¥ï¼Œæ¯”å¦‚Cache aside, Read through, Write throughï¼Œå¯ä»¥æ ¹æ®ä½ éœ€è¦çš„æ–¹æ¡ˆæŠŠå†™å…¥redisçš„æ“ä½œè½åˆ°è¯»æœåŠ¡æˆ–åŒæ­¥å†™æœåŠ¡å»å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589425449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302215,"user_name":"walleæ–Œ","can_delete":false,"product_type":"c1","uid":1062848,"ip_address":"","ucode":"0DB3243004951F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","comment_is_top":false,"comment_ctime":1626139401,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626139401","product_id":100047701,"comment_content":"1ï¼‰æˆ‘è¿™è¾¹è‡ªç ”çš„ç»Ÿä¸€æ¶ˆæ¯æ¨é€å¼•æ“ï¼Œåº•å±‚æ‰€æœ‰çš„æ¨é€è®°å½•ï¼Œä¼šç»è¿‡æœ¬åœ°å®šæ—¶ç¼“å†²åŒºï¼Œæ‰¹é‡å†™å…¥åˆ°mongoä¸­ã€‚ã€‚ä¸»è¦æ˜¯éœ€è¦æä¾›åˆ†é¡µï¼Œå¯æ‰©å±•å­—æ®µã€è¦å…è®¸ä¸šåŠ¡å®šåˆ¶è‡ªå·±çš„å­—æ®µã€‘ï¼Œä¸»è¦å¯¹å†…ä½¿ç”¨ï¼Œæ‰€ä»¥å†™å…¥é‡å¤§ï¼Œä½†æ˜¯æŸ¥è¯¢é‡ä¸å¤§ã€‚<br>2ï¼‰ç„¶åå†è‡ªç ”ç»Ÿä¸€æ¸…åº“ç­–ç•¥ï¼Œæ‰¹é‡å°æ­¥åˆ é™¤ä¸€å®šæ—¶é—´ä¹‹å‰çš„æ•°æ®ï¼Œåˆ é™¤æ˜¯ç‰©ç†åˆ é™¤æˆ–è€…å¯¼å…¥åˆ°å…¬å¸å†…çš„phoenixä¸­ã€‚<br>3ï¼‰è‡ªç ”èƒŒåæ•°æ®å±•ç¤ºé¡µé¢ã€‚ä¸­é—´ä¼šç”±äºå¤šé¡¹ç›®èµ„æºéš”ç¦»ï¼Œæ‰€ä»¥è¿˜è¦æŠŠå†å²æ¨é€é¡¹ç›®å¼•å…¥ç‹¬ç«‹jaråŒ…å¼€å¯å›ºå®šæ¥å£ï¼Œç„¶åé…ç½®é¡µé¢ä¸åŒçš„jv ä¼šé»˜è®¤è·¯ç”±åˆ°ä¸åŒçš„æ•°æ®å±•ç¤ºã€‚<br>4ï¼‰ å¯¹æµ‹è¯•äººå‘˜æä¾›åŒæ ·é€»è¾‘æ¥å£ã€‚è¾…åŠ©å…¶è‡ªåŠ¨åŒ–è„šæœ¬çš„å®Œæˆ<br>åŸºæœ¬ä¸Šä»å¤´åˆ°å°¾éƒ½æœ‰è¾…åŠ©ã€‚è€Œåšä¸šåŠ¡ç ”å‘çš„åŒå­¦ï¼Œåªéœ€è¦å¼•å…¥æ¨é€å¼•æ“å®ç°å¿…é¡»çš„å‡ ä¸ªä¸šåŠ¡å†…å®¹ï¼Œç„¶åå°±OKäº†ã€‚","like_count":0},{"had_liked":false,"id":292411,"user_name":"ğŸ›ğŸ›","can_delete":false,"product_type":"c1","uid":1367321,"ip_address":"","ucode":"C7C6F93764FD23","user_header":"https://static001.geekbang.org/account/avatar/00/14/dd/19/45afa234.jpg","comment_is_top":false,"comment_ctime":1620809132,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620809132","product_id":100047701,"comment_content":"hbaseç®—æ˜¯ä»€ä¹ˆæ ·ç±»å‹çš„NoSQLå‘¢","like_count":0},{"had_liked":false,"id":265696,"user_name":"æµ·å¼º","can_delete":false,"product_type":"c1","uid":1645684,"ip_address":"","ucode":"EF4971CD58E4E5","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/74/eb472cc3.jpg","comment_is_top":false,"comment_ctime":1606985123,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606985123","product_id":100047701,"comment_content":"æ•°æ®é‡å¤§ï¼Œæ›´æ–°é¢‘ç¹ï¼Œè¿˜éœ€è¦æŸ¥å®æ—¶åˆ—è¡¨çš„åœºæ™¯æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Ÿæœ‰æ²¡æœ‰å¼‚æ­¥å†™esï¼Œä½†æ˜¯æŸ¥è¯¢æ—¶å€™å¯¹æ²¡æ¥åŠè¿›esçš„æ•°æ®è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢è¡¥å¿ä¹‹ç±»çš„æ–¹æ¡ˆ","like_count":0},{"had_liked":false,"id":265694,"user_name":"æµ·å¼º","can_delete":false,"product_type":"c1","uid":1645684,"ip_address":"","ucode":"EF4971CD58E4E5","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/74/eb472cc3.jpg","comment_is_top":false,"comment_ctime":1606984939,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606984939","product_id":100047701,"comment_content":"åšçš„ä¸€ä¸ªæ”¿åºœé¡¹ç›®ï¼Œæƒé™è¦æ±‚ä¸¥æ ¼ï¼Œæ•°æ®æƒé™é‡‡ç”¨è¡Œçº§ç™½åå•æœºåˆ¶(åå•æ˜¯ç³»ç»Ÿæ ¹æ®å„ç§æ¡ä»¶è‡ªåŠ¨ç»´æŠ¤çš„)ï¼Œç™½åå•é‡Œé¢åˆæ¶‰åŠè§’è‰²ï¼Œä¸ªäººå’Œç¾¤ç»„ã€‚ç”¨æˆ·å’Œæ•°æ®é‡éƒ½æŒºå¤§çš„æ—¶å€™ï¼Œç™½åå•è¡¨ç‰¹åˆ«å¤§ã€‚åˆ—è¡¨æŸ¥è¯¢(éœ€è¦æƒé™è¿‡æ»¤)æ—¶å€™èµ°æ•°æ®åº“ï¼Œå„ç§ç´¢å¼•å’Œä¼˜åŒ–æ€§èƒ½ä»ç„¶è¾¾ä¸åˆ°è¦æ±‚ã€‚<br>åé¢æ¢æˆåœ¨esé‡Œé¢æŸ¥ï¼Œä½†æ˜¯åˆ—è¡¨æŸ¥è¯¢éœ€è¦æœ€æ–°çš„æ•°æ®ï¼Œåªå¥½æŠŠæ•°æ®æ›´æ–°æ¨esåšæˆåŒæ­¥çš„ï¼Œæ•°æ®çš„æ›´æ–°è¿˜æ¯”è¾ƒé¢‘ç¹ã€‚<br>æ€»ç»“å°±æ˜¯æ•°æ®é‡å¤§","like_count":1},{"had_liked":false,"id":250949,"user_name":"åˆ˜é£","can_delete":false,"product_type":"c1","uid":1890310,"ip_address":"","ucode":"516F96D88C5C98","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/j5ld8j7BqIZe9fOVniaLJajbOwbnwKD7dn3RN5T79K00uy1utB7PTP7TiclxdhXyh4ER8hsu8mgnibUoIDaRwib4kg/132","comment_is_top":false,"comment_ctime":1601288458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601288458","product_id":100047701,"comment_content":"mongdb æ›´å¥½çš„åº”ç”¨åœºæ™¯å‘¢ã€‹ï¼Ÿ","like_count":1}]}