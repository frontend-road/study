{"id":461658,"title":"05｜码流结构：原来你是这样的H264","content":"<p>你好，我是李江。</p><p>上一节课我们一起讨论了视频编码的基本原理。今天，我们就接着来聊聊视频编码的码流结构，这在视频开发工作中是非常重要的。</p><p>视频编码标准其实有很多，比如上一节课讲到的H264、H265、AV1等，但原理大同小异，都是预测、变换、量化和熵编码等几个步骤。H264编码可以说是最常用的编码标准，比较经典，所以这节课我们就以H264为例来讲解码流结构。在掌握了这些之后，迁移学习其它编码标准的码流结构也就简单多了。</p><p>视频编码的码流结构其实就是指视频经过编码之后得到的二进制数据是怎么组织的，换句话说，就是编码后的码流我们怎么将一帧帧编码后的图像数据分离出来，以及在二进制码流数据中，哪一块数据是一帧图像，哪一块数据是另外一帧图像。</p><p>而我们在工程开发中，需要对编码后的数据进行一些解析，以便用于之后的打包。同时我们在打包时也需要判断当前一帧图像数据它的开头和结尾在哪。这些工作的前提就是我们要清楚如何分析编码码流，那么码流结构到底是怎样的，就是当下的学习重点了。</p><p>下面我们就以H264编码为基础，分析一下它的码流结构，并看看它在工程中是如何应用的。</p><h2>H264的编码结构</h2><p>这里有一些前置知识我们需要先了解一下。我们先一起来看几个重要的概念吧。它们之间有这样一条线索，你在接下来的学习中可以重点关注一下，对于你记忆它们也是非常有帮助的。</p><!-- [[[read_end]]] --><p>首先，清楚帧类型是图像的基础；其次，GOP是以其中的IDR帧作为分隔点的；最后的Slice是我们深入帧内部以后的一个重要概念。整个过程，由浅入深。</p><h3>帧类型</h3><p>帧类型相信你在平时的工作中可能已经接触过一部分了，比如说我们可能经常听到视频开发工作者说I帧、P帧之类的。其实在H264中，帧类型主要分为3大类，分别是I帧、P帧和B帧。那么它们之间有什么区别呢？接下来我们就来详细聊聊。</p><p>在<a href=\"https://time.geekbang.org/column/article/459554\">视频编码原理</a>那节课里面，我们讲过为了减少空间冗余和时间冗余，视频编码使用了帧内预测和帧间预测技术，这些都涉及到帧。所以了解帧的类型是很有必要的。</p><p>我们知道帧内预测不需要参考已编码帧，对已编码帧是没有依赖的，并可以自行完成编码和解码。而帧间预测是需要参考已编码帧的，并对已编码帧具有依赖性。帧间预测需要参考已经编码好了的帧内编码帧或者帧间编码帧。并且，帧间编码帧又可以分为只参考前面帧的前向编码帧，和既可以参考前面帧又可以参考后面帧的双向编码帧。</p><p>为了做区分，在H264中，我们就将图像分为以下不同类型的帧。<br>\n<img src=\"https://static001.geekbang.org/resource/image/6b/8d/6b908464d87e30bf977893ababf7e78d.jpg?wh=1280x392\" alt=\"\"><br>\n三种帧的示例图如下所示。例如，从左向右，第一个B帧参考第一个I帧和第一个P帧，第一个P帧只参考第一个I帧（箭头是从参考帧指向编码帧）。</p><p><img src=\"https://static001.geekbang.org/resource/image/ab/4c/ab75b04921d925f567a92796c992e54c.jpeg?wh=1920x376\" alt=\"图片\"></p><p>由于P帧和B帧需要参考其它帧。如果编码或者解码的过程中有一个参考帧出现错误的话，那依赖它的P帧和B帧肯定也会出现错误，而这些有问题的P帧（B帧虽然也可以用来作为参考帧，但是一般用的比较少，所以这里不讨论）又会继续作为之后P帧或B帧的参考帧。因此，<strong>错误会不断的传递</strong>。为了避免错误的不断传递，就有了<strong>一种特殊的I帧叫IDR帧</strong>，也叫立即刷新帧。</p><p>H264编码标准中规定，<strong>IDR帧之后的帧不能再参考IDR帧之前的帧</strong>。这样，如果某一帧编码错误，之后的帧参考了这个错误帧，则也会出错。此时编码一个IDR帧，由于它不参考其它帧，所以只要它自己编码是正确的就不会有问题。之前有错误的帧也不会再被用作参考帧，<strong>这样就截断了编码错误的传递</strong>，且之后的帧就可以正常编/解码了。</p><p>当然，有IDR这种特殊的I帧，也就有普通的I帧。普通的I帧就是指当前帧只使用帧内预测编码，但是后面的P帧和B帧还是可以参考普通I帧之前的帧。但是这里我要说明一下，一般来说我们不太会使用这种普通I帧，<strong>大多数情况下还是直接使用IDR帧</strong>，尤其是在流媒体场景，比如RTC场景。只是说如果你非要用这种普通I帧，标准也是支持的。</p><h3>GOP</h3><p>在H264中，还有一个GOP的概念也经常会遇到，它是什么意思呢？从一个IDR帧开始到下一个IDR帧的前一帧为止，这里面包含的IDR帧、普通I帧、P帧和B帧，我们称为一个<strong>GOP（图像组）</strong>（这是closed GOP，还有一种opened GOP，比较少见，这里不讨论）。</p><p>我们可以看到GOP的大小是由IDR帧之间的间隔来确定的，而这个间隔我们有一个重要的概念来表示，叫做<strong>关键帧间隔</strong>。关键帧间隔越大，两个IDR相隔就会越远，GOP也就越大；关键帧间隔越小，IDR相隔也就越近，GOP就越小。</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/df/3deac858fff85f0bf3d9c930e6776cdf.jpeg?wh=1920x416\" alt=\"图片\"></p><p>GOP越大，编码的I帧就会越少。相比而言，P帧、B帧的压缩率更高，因此整个视频的编码效率就会越高。但是GOP太大，也会导致IDR帧距离太大，点播场景时进行视频的seek操作就会不方便。</p><p>并且，在RTC和直播场景中，可能会因为网络原因导致丢包而引起接收端的丢帧，大的GOP最终可能导致参考帧丢失而出现解码错误，从而引起长时间花屏和卡顿。这一块我们会在之后用单独的一节课来详细讲述。总之，<strong>GOP不是越大越好，也不是越小越好，需要根据实际的场景来选择。</strong></p><p>前面我们讲的是视频图像序列的层次结构，那图像内的层次结构是怎样的呢？</p><h3>Slice</h3><p>这就不得不提到另一个概念了，Slice，也叫做“片”。<strong>Slice其实是为了并行编码设计的</strong>。什么意思呢？就是说，我们可以将一帧图像划分成几个Slice，并且Slice之间相互独立、互不依赖、独立编码。</p><p>那么在机器性能比较高的情况下，我们就可以多线程并行对多个Slice进行编码，从而提升速度。但也因为一帧内的几个Slice是相互独立的，所以如果帧内预测的话，就不能跨Slice进行，因此编码性能会差一些。</p><p>而在H264中编码的基本单元是宏块，所以一个Slice又包含整数个宏块。我们在前一节课中也讲了，宏块MB大小是16 x 16。在做帧内和帧间预测的时候，我们又可以将宏块继续划分成不同大小的子块，用来给复杂区域做精细化编码。</p><p>总结来说，<strong>图像内的层次结构就是一帧图像可以划分成一个或多个Slice，<strong><strong>而</strong></strong>一个Slice包含多个宏块，<strong><strong>且</strong></strong>一个宏块又可以划分成多个不同尺寸的子块</strong>。如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/63/16/63f316bf5d1410cdb38334ba7bc9f316.jpg?wh=1280x720\" alt=\"\"><br>\n好了，上面都是从概念上来讨论视频编码中的视频序列和图像的层次结构。那有了这些知识之后，接下来我们更进一步，从H264码流的角度来看看这些层次结构具体在二进制码流中是怎样的。</p><h2>H264的码流结构</h2><p>下面我们就以“剥洋葱”的方式来详细地讲解H264的码流结构。先从最外层的码流格式讲起，教你怎么判断视频编码数据的起始；然后再介绍里面的NALU（网络抽象层单元）数据，看看通过它是怎么区分不同的帧类型的；再详细聊聊NALU有几种类型，以及通过什么方式来区分NALU的类型。</p><h3>码流格式</h3><p><strong>H264码流有两种格式</strong>：<strong><strong>一种是Annexb格式</strong></strong>；<strong>一种是MP4格式。</strong>两种格式的区别是：</p><ol>\n<li>\n<p>Annexb格式使用<strong>起始码</strong>来表示一个编码数据的开始。起始码本身不是图像编码的内容，只是用来分隔用的。起始码有两种，一种是4字节的“00 00 00 01”，一种是3字节的“00 00 01”。<br>\n这里需要<strong>注意</strong>一下，由于图像编码出来的数据中也有可能出现“00 00 00 01”和“00 00 01”的数据。那这种情况怎么办呢？为了防止出现这种情况，H264会将图像编码数据中的下面的几种字节串做如下处理：</p>\n<p>（1）“00 00 00”修改为“00 00 03 00”；</p>\n<p>（2）“00 00 01”修改为“00 00 03 01”；</p>\n<p>（3）“00 00 02”修改为“00 00 03 02”；</p>\n<p>（4）“00 00 03”修改为“00 00 03 03”。</p>\n</li>\n</ol><p>同样地在解码端，我们在去掉起始码之后，也需要将对应的字节串转换回来。</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/b2/8f7b9f988aa439d8ae584eb4561ed1b2.jpeg?wh=1920x311\" alt=\"图片\"></p><ol start=\"2\">\n<li>MP4格式没有起始码，而是<strong>在图像编码数据的开始使用了4个字节作为长度标识</strong>，用来表示编码数据的长度，这样我们每次读取4个字节，计算出编码数据长度，然后取出编码数据，再继续读取4个字节得到长度，一直继续下去就可以取出所有的编码数据了。<br>\n<img src=\"https://static001.geekbang.org/resource/image/94/6d/945b7e9c21e313c1cfcd8ecbe967576d.jpeg?wh=1920x250\" alt=\"图片\"></li>\n</ol><p>这两种格式差别不大，接下来我们主要使用Annexb格式来讲解H264码流中的NALU。</p><p>下面，我们剥开“洋葱”的最外层，将起始码去掉，进入“洋葱”的内部，也就是编码数据。这个编码数据就是H264码流的重要部分——NALU。</p><h3>NALU</h3><p>在这节课的开始我们讲了图像分成I帧、P帧和B帧这三种类型的帧。其实除了图像数据，视频编码的时候还有一些编码参数数据，为了能够将一些通用的编码参数提取出来，不在图像编码数据中重复，H264设计了<strong>两个重要的参数集：一个是SPS（序列参数集）；一个是PPS（图像参数集）</strong>。</p><p>其中，SPS主要包含的是图像的宽、高、YUV格式和位深等基本信息；PPS则主要包含熵编码类型、基础QP和最大参考帧数量等基本编码信息。如果没有SPS、PPS里面的基础信息，之后的I帧、P帧、B帧就都没办法进行解码。因此SPS和PPS是至关重要的。</p><p>结合前面我们讲的内容，我们现在可以知道，H264码流主要包含了SPS、PPS、I帧、P帧和B帧。由于帧又可以划分成一个或多个Slice。因此，帧在码流中实际上是以Slice的形式呈现的。所以，<strong>H264的码流主要是由</strong> <strong>SPS、PPS、I Slice、P Slice<strong><strong>和</strong></strong>B Slice组成的</strong>。如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/14/d4/145b789d7fd80e415c8c5d7d6e6fe1d4.jpeg?wh=1920x290\" alt=\"图片\"></p><p>我们知道了H264码流主要由SPS、PPS和三种Slice组成，那我们<strong>如何在码流中区分这几种数据呢？</strong></p><p>为了解决这个问题，H264设计了NALU（网络抽象层单元）。SPS是一个NALU、PPS是一个NALU、每一个Slice也是一个NALU。每一个NALU又都是由一个1字节的NALU Header和若干字节的NALU Data组成的。而对于每一个Slice NALU，其NALU Data又是由Slice Header和Slice Data组成，并且Slice Data又是由一个个MB Data组成。其结构如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/df/c0/df6fdacccd55c66d8495cc7c113489c0.jpg?wh=1280x720\" alt=\"\"><br>\n在这里，我们重点介绍一下NALU Header。它总共占用1个字节，具体如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/76/26/761aa34e76ed9b449a75c6b3bd226126.jpeg?wh=1586x522\" alt=\"图片\"><br>\n其中，</p><ul>\n<li>F：forbidden_zero_bit，占1bit，禁止位，H264码流必须为0；</li>\n<li>NRI： nal_ref_idc，占2bits，可以取00～11，表示当前NALU的重要性。参考帧、SPS和PPS对应的NALU必须要大于0；</li>\n<li>Type： nal_unit_type，占5bits，表示NALU类型。其取值如下表所示。</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/86/a7/86c7dbba135911a984224d8b886c2fa7.png?wh=1880x267\" alt=\"\"><br>\n有了NALU Type类型表格，那我们解析出NALU Header的Type字段，查询表格就可以得到哪个NALU是SPS，哪个是PPS，以及哪个是IDR帧了。</p><p>这里需要注意一下，<strong>NALU类型只区分了IDR Slice和非IDR Slice</strong>，至于非IDR Slice是普通I Slice、P Slice还是B Slice，则需要继续解析Slice Header中的Slice Type字段得到。我们通过下面两个例子来看看常见的NALU里的NALU Header是怎样的。</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/a8/3d017ba4005cd602881611772e5203a8.png?wh=1920x608\" alt=\"图片\"></p><p>下面我们再来看一个实际码流的例子，看看在实际编码出来的二进制数据中，各种NALU是怎么“放置”在数据中的。下图是我用二进制查看工具打开实际编码后的码流数据。我们可以看到在码流的开始部分是一个起始码，之后紧接着是一个SPS的NALU。在SPS后面是一个PPS的NALU。然后就是一个IDR Slice的NALU和一个非IDR Slice NALU。</p><p><img src=\"https://static001.geekbang.org/resource/image/77/bb/775e22095450797346e3434f5abdfcbb.png?wh=1220x1256\" alt=\"图片\"></p><p>现在，对于码流结构的认知你是不是很清晰了。你也可以去找个H264码流，用二进制查看工具打开它。通过今天学习的知识，你可以试着找出其中的起始码，看看能不能找到SPS、PPS、IDR和非IDR Slice。如果你都能找出来，那恭喜你说明你已经掌握了今天的主要知识点了。</p><h2>常见工程问题</h2><p>好了，在了解了基本的码流结构知识之后，我们来看看如何运用这节课学到的知识去解决工程上常见的一些问题。这里我列举了3个比较典型的问题，如果你有更多问题的话，可以到留言区我们一起讨论。</p><h3>多Slice时如何判断哪几个Slice是同一帧的？</h3><p>我们前面讲过，在H264码流中，帧是以Slice的方式呈现的，或者可以说在H264码流里是没有“帧“这种数据的，只有Slice。但是有个问题是，一帧有几个Slice是不会告诉你的。也就是说码流中没有字段表示一帧包含几个Slice。既然没有办法知道一帧有几个Slice，那我们如何知道多Slice编码时一帧的开始和结束分别对应哪个Slice呢？</p><p><img src=\"https://static001.geekbang.org/resource/image/ae/64/ae932f9ae0f2de95e1943d98c5a35b64.jpeg?wh=1920x418\" alt=\"图片\"></p><p>其实，Slice NALU由NALU Header和NALU Data组成，其中NALU Data里面就是Slice数据，而Slice数据又是由Slice Header和Slice Data组成。<strong>在Slice Header开始的地方有一个first_mb_in_slice的字段</strong>，表示当前Slice的第一个宏块MB在当前编码图像中的序号。我们只要解析出这个宏块的序号出来，</p><ul>\n<li>如果first_mb_in_slice的值等于0，就代表了当前Slice的第一个宏块是一帧的第一个宏块，也就是说当前Slice就是一帧的第一个Slice。</li>\n<li>如果first_mb_in_slice的值不等于0，就代表了当前Slice不是一帧的第一个Slice。<br>\n并且，使用同样的方式一直往下找，直到找到下一个first_mb_in_slice为0的Slice，就代表新的一帧的开始，那么其前一个Slice就是前一帧的最后一个Slice了。</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/0d/86/0dbc23dc75c0811a0d83b06916c5aa86.jpeg?wh=1598x1252\" alt=\"图片\" title=\"图片来源于H264标准文档\"></p><p>其中，first_mb_in_slice是以无符号指数哥伦布编码的，需要使用对应的解码方式才能解码出来。但是有一个小技巧，如果只是需要判断first_mb_in_slice是不是等于0，不需要计算出实际值的话，只需要通过下面的方式计算就可以了。</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/69/2c6acyy46cbdf0829da609e281b93c69.png?wh=1470x226\" alt=\"图片\"></p><p>这就是多Slice判断一帧的开始和结束的方法。</p><h3>如何从SPS中获取图像的宽高？</h3><p>在编码端编码一个视频的时候，我们是需要设置分辨率告诉编码器图像的实际宽高的。但是解码器是不需要设置分辨率的，那我们在解码端或者说接收端如何知道视频的分辨率大小呢？</p><p>其实，在编码器编码的时候会将分辨率信息编码到SPS中。<strong>在SPS中有几个字段用来表示分辨率的大小。<strong>我们可以</strong>解码出这几个字段并通过一定的规则计算得到分辨率的大小</strong>。这几个字段分别是：</p><p><img src=\"https://static001.geekbang.org/resource/image/60/3d/603e4da34be2ab8bfc5d24eba83b693d.jpg?wh=1280x574\" alt=\"\"><br>\n这几个字段都是通过无符号指数哥伦布编码的，需要先解码出来。解码得到具体值之后，通过以下方法就可以得到分辨率了。注意，pic_height_in_map_units_minus1需要考虑帧编码和场编码的区别，其中场编码已经很少使用了，我们这里不再考虑。<br>\n<img src=\"https://static001.geekbang.org/resource/image/4c/be/4c9yy45d48234db0da222024653833be.jpg?wh=1280x720\" alt=\"\"><br>\n通过上面的方法就可以计算得到图像的分辨率了。</p><h3>如何计算得到QP值？</h3><p>我们在视频编码原理那节课中讲过，量化过程是引入失真最主要的环节。而量化最主要的参数就是QP值，并且QP值的大小严重影响到编码画面的清晰度。因此QP值非常重要。那么我们如何从码流中计算得到QP值呢？</p><p>在PPS中有一个全局基础QP，字段是pic_init_qp_minus26。当前序列中所有依赖该PPS的Slice共用这个基础QP，且每一个Slice在这个基础QP的基础上做调整。在Slice Header中有一个slice_qp_delta字段来描述这个调整偏移值。更进一步，H264允许在宏块级别对QP做更进一步的精细化调节。这个字段在宏块数据里面，叫做mb_qp_delta。</p><p><img src=\"https://static001.geekbang.org/resource/image/94/e2/9491235aba78da8693e77befabc0bbe2.jpg?wh=1280x388\" alt=\"\"><br>\n如果需要得到Slice级别的QP则只需要考虑前两个QP相关字段。如果需要计算宏块QP，则需要三个都考虑。但是宏块QP需要解析整个Slice数据，计算量大。一般我们直接计算到Slice QP就可以了。计算方法如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/d5/3a/d5b6d75fd0567bca065ddf6631bce83a.png?wh=1328x344\" alt=\"图片\"></p><h2>小结</h2><p>这节课我们主要讨论了H264的编码层次结构和码流结构。在一个视频图像序列中，我们将其划分成一个个GOP。<strong>GOP包含一个IDR帧到下一个IDR帧的前一帧中的所有帧。</strong>GOP的大小选择需要根据实际应用场景来选择，<strong>一般RTC和直播场景可以稍微大一些，<strong><strong>而</strong></strong>点播场景一般小一些。</strong></p><p>在H264中，每一帧图像又可以分为I帧、P帧和B帧，而I帧又包含了普通I帧和IDR帧。帧可以划分为一个或者多个Slice，并且<strong>最后帧都是以Slice的方式在码流中呈现</strong>。同时H264码流中除了Slice数据之外，还有<strong>SPS和PPS两个参数集，<strong><strong>分别</strong></strong>用来存放基础图像信息和基础编码参数</strong>。SPS和PPS非常重要，如果丢失了，将无法进行解码。</p><p>每一个Slice和SPS、PPS都是通过NALU来封装的，且NALU含有一个1字节的NALU Header。我们可以<strong>通过NALU Header中的NALU Type来判断NALU的类型</strong>。同时，每一个NALU的分隔有两种方式：一种是<strong>Annexb格式，通过使用起始码分隔</strong>；一种是<strong>MP4格式，通过一个4字节的长度来表示NALU的大小</strong>，从而起到分隔的作用。</p><p>为了帮助你记忆，我们通过下图来总结一下。<br>\n<img src=\"https://static001.geekbang.org/resource/image/2e/f9/2edfa9c579e43efd2a76e94fa33f83f9.png?wh=1846x1434\" alt=\"\"></p><h2>思考题</h2><p>为什么有B帧的时候延时会高？</p><p>你可以把你的答案和思考写下来，分享到留言区，与我一起讨论。下节课再见。</p>","comments":[{"had_liked":false,"id":324341,"user_name":"aikeke","can_delete":false,"product_type":"c1","uid":1057623,"ip_address":"","ucode":"42974797A75EA7","user_header":"https://static001.geekbang.org/account/avatar/00/10/23/57/5ba842bc.jpg","comment_is_top":false,"comment_ctime":1638375912,"is_pvip":true,"replies":[{"id":"117721","content":"Elecard或者VQAnalyzer都挺好的，我用的VQAnalyzer。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638422924,"ip_address":"","comment_id":324341,"utype":1}],"discussion_count":2,"race_medal":0,"score":"40293081576","product_id":100098901,"comment_content":"老师能推荐下好用的h264字段分析工具吗？","like_count":10,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535374,"discussion_content":"Elecard或者VQAnalyzer都挺好的，我用的VQAnalyzer。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638422924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2857304,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/99/58/c304c279.jpg","nickname":"许瑞龙","note":"","ucode":"2C36EE37146F9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580611,"discussion_content":"我用的vim","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658289860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324102,"user_name":"smart","can_delete":false,"product_type":"c1","uid":1005465,"ip_address":"","ucode":"79721B195EE112","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM4BtLmq9ia6sWuwQMibrmdDGWkOzng6kUxick42mLEXnhojTQFF9blxPysafKJnwzswaSenJkZJGlWYQ/132","comment_is_top":false,"comment_ctime":1638297546,"is_pvip":false,"replies":[{"id":"117729","content":"嗯嗯，编码的时候也是一样的，需要先等后面的P帧先编码才能编码B帧。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638423829,"ip_address":"","comment_id":324102,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35998035914","product_id":100098901,"comment_content":"B帧需要双向参考，pts 和 dts 不一致。因此需要等待后面的 p 帧解码后才能继续，从而引入了延时。","like_count":9,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535386,"discussion_content":"嗯嗯，编码的时候也是一样的，需要先等后面的P帧先编码才能编码B帧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638423829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326088,"user_name":"Chris Zou","can_delete":false,"product_type":"c1","uid":1897148,"ip_address":"","ucode":"B6DFC71C1DD8B7","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg","comment_is_top":false,"comment_ctime":1639373177,"is_pvip":false,"replies":[{"id":"118425","content":"是的","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1639408924,"ip_address":"","comment_id":326088,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18819242361","product_id":100098901,"comment_content":"老师，ts文件中是不是就是含起始码的码流，而mp4文件就是不含起始码的mp4码流？","like_count":4,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538468,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639408924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324475,"user_name":"qingzhu","can_delete":false,"product_type":"c1","uid":1212587,"ip_address":"","ucode":"87C05FF2BA50B7","user_header":"","comment_is_top":false,"comment_ctime":1638451275,"is_pvip":false,"replies":[{"id":"119351","content":"不会，因为原始的00 00 03 00中的00 00 03会被修改为00 00 03 03，所以是可以区分的。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1640312983,"ip_address":"","comment_id":324475,"utype":1}],"discussion_count":4,"race_medal":0,"score":"14523353163","product_id":100098901,"comment_content":"（1）“00 00 00”修改为“00 00 03 00”；<br>会不会原始编码中也存在“00 00 03 00”的冲突？","like_count":3,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541263,"discussion_content":"不会，因为原始的00 00 03 00中的00 00 03会被修改为00 00 03 03，所以是可以区分的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640312983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1090051,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","nickname":"ripple","note":"","ucode":"99008FD0533F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536382,"discussion_content":"00 00 03 00 变成了00 00 03 03 了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638774964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1897148,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg","nickname":"Chris Zou","note":"","ucode":"B6DFC71C1DD8B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1090051,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","nickname":"ripple","note":"","ucode":"99008FD0533F68","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538222,"discussion_content":"如果原始编码也有 00 00 03 03呢？好像会一直循环","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639372576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536382,"ip_address":""},"score":538222,"extra":""},{"author":{"id":1090051,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","nickname":"ripple","note":"","ucode":"99008FD0533F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1897148,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg","nickname":"Chris Zou","note":"","ucode":"B6DFC71C1DD8B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541228,"discussion_content":"如果原始有，原始就变成00 00 03 03\n03了，还原后也是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640308299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538222,"ip_address":""},"score":541228,"extra":""}]}]},{"had_liked":false,"id":324398,"user_name":"晓龙","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/93c79f7c.jpg","comment_is_top":false,"comment_ctime":1638415473,"is_pvip":false,"replies":[{"id":"119349","content":"起始码用来分隔一个个NALU的，每一个Slice都是放在一个NALU里面，而I、P、B这些帧，每一帧又可以是一个或多个Slice。也就是说起始码分隔的是Slice不是帧，同一个I帧有多个Slice的话，也是会有起始码分隔的。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1640312702,"ip_address":"","comment_id":324398,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14523317361","product_id":100098901,"comment_content":"想问一下老师，起始码和NALU的关系是，起始码是用来区分PPS，SPS，I，B，P帧，然后I，B，P帧内部，又有由多个Slice&#47;NALU组成是吧？ 也就是说，I 帧和B帧中间用起始码分割，然后I帧内部，又会再被Slice分割？","like_count":4,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541261,"discussion_content":"起始码用来分隔一个个NALU的，每一个Slice都是放在一个NALU里面，而I、P、B这些帧，每一帧又可以是一个或多个Slice。也就是说起始码分隔的是Slice不是帧，同一个I帧有多个Slice的话，也是会有起始码分隔的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640312703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347759,"user_name":"龚长华","can_delete":false,"product_type":"c1","uid":2969046,"ip_address":"","ucode":"A710129E480788","user_header":"","comment_is_top":false,"comment_ctime":1654400790,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5949368086","product_id":100098901,"comment_content":"因为B帧既需要前向参考，也需要后向参考。因此在解码时，B帧的解码需要等到它参考的后向帧解码之后才能解码。这会导致额外的延时。","like_count":2},{"had_liked":false,"id":327914,"user_name":"tony","can_delete":false,"product_type":"c1","uid":1131361,"ip_address":"","ucode":"1160371C7F473E","user_header":"https://static001.geekbang.org/account/avatar/00/11/43/61/eeefa369.jpg","comment_is_top":false,"comment_ctime":1640359487,"is_pvip":true,"replies":[{"id":"119626","content":"1、不可以，fu-a的start和end标志位只能用来判断slice的开头和结尾。一帧可以有多个slice，所以不能这样判断。<br>2、不可以，因为多个帧的frame number可以相同，而且frame num有最大值，到了最大值又会从0开始。<br>3、RTC中有SVC的，不一定需要连续参考，也可以解决这个问题。<br>4、应该是说NALU这个东西吧，里面会nalu type这个字段吧。而且slice header里面没有使用复杂的CAVLC和CABAC的熵编码，更容易解析出来。可以不用完全解码出整个帧，提前做一些可解码性判断。比如说这节课里面的first_mb_in_slice字段用来判断帧的开头和结尾这种操作。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1640744582,"ip_address":"","comment_id":327914,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5935326783","product_id":100098901,"comment_content":"老师请教一下如下问题:<br>1. 判断一帧起始以及结束是否可以使用fu-a的start以及end标识位？<br>2. 判断哪几个slice属于同一个帧是否可以使用slice header中的frame number？<br>3. rtc中编码时为什么不采用sp帧?这样丢弃了某一参考帧，还能恢复出来<br>4. 有些书上说h264码流结构设计为具有良好网络亲和性的，从哪些方面特征可以表现出来？","like_count":2,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542404,"discussion_content":"1、不可以，fu-a的start和end标志位只能用来判断slice的开头和结尾。一帧可以有多个slice，所以不能这样判断。\n2、不可以，因为多个帧的frame number可以相同，而且frame num有最大值，到了最大值又会从0开始。\n3、RTC中有SVC的，不一定需要连续参考，也可以解决这个问题。\n4、应该是说NALU这个东西吧，里面会nalu type这个字段吧。而且slice header里面没有使用复杂的CAVLC和CABAC的熵编码，更容易解析出来。可以不用完全解码出整个帧，提前做一些可解码性判断。比如说这节课里面的first_mb_in_slice字段用来判断帧的开头和结尾这种操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640744582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324394,"user_name":"晓龙","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/93c79f7c.jpg","comment_is_top":false,"comment_ctime":1638414732,"is_pvip":false,"replies":[{"id":"117722","content":"嗯嗯，一起学习交流，又问题可以给我留言。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638422975,"ip_address":"","comment_id":324394,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5933382028","product_id":100098901,"comment_content":"iOS Video Toolbox 可以参考这一篇 https:&#47;&#47;www.cnblogs.com&#47;tangyuanby2&#47;p&#47;11449460.html， 对照老师的课程，融会贯通","like_count":1,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535376,"discussion_content":"嗯嗯，一起学习交流，又问题可以给我留言。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638422975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324360,"user_name":"paradise","can_delete":false,"product_type":"c1","uid":2354314,"ip_address":"","ucode":"1CA1101E0A3106","user_header":"https://static001.geekbang.org/account/avatar/00/23/ec/8a/4de35fb7.jpg","comment_is_top":false,"comment_ctime":1638405822,"is_pvip":false,"replies":[{"id":"117724","content":"嗯嗯，谢谢支持。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638423018,"ip_address":"","comment_id":324360,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5933373118","product_id":100098901,"comment_content":"B帧因为双向参考的缘故，编码和解码都存在时延，特别是在倒放的时候比较麻烦，所以安防领域都不使用B帧编码。<br>感谢江哥细致的讲解","like_count":1,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535378,"discussion_content":"嗯嗯，谢谢支持。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638423018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354244,"user_name":"邱文彬","can_delete":false,"product_type":"c1","uid":2268571,"ip_address":"浙江","ucode":"B57E2C279947AE","user_header":"https://static001.geekbang.org/account/avatar/00/22/9d/9b/12862222.jpg","comment_is_top":false,"comment_ctime":1660209106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660209106","product_id":100098901,"comment_content":"老师起始码的4字节和3字节分别用在什么情况下","like_count":0},{"had_liked":false,"id":342753,"user_name":"追梦小乐","can_delete":false,"product_type":"c1","uid":1035507,"ip_address":"","ucode":"82AB8A7F98389D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cc/f3/5e4b0315.jpg","comment_is_top":false,"comment_ctime":1650446065,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1650446065","product_id":100098901,"comment_content":"1、码流是针对时间段来说的吗？！比如说一段码流包含了很多张图像？！<br><br>2、没太看懂那两个例子是怎么区分SPS、PPS、IDR和非IDR类型的？！  比如说图中   00 00 00 01 67是SPS类型？！ 文中说头部是由8位组成，00 00 00 01就是8位了吧，67这个是起什么作用？！","like_count":0,"discussions":[{"author":{"id":2994778,"avatar":"","nickname":"Geek_608042","note":"","ucode":"746720EF308560","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570125,"discussion_content":"00 00 00 01是起始码，分隔用的。0x67的二进制是0110 0111其中后5位表示类型，7对应表中SPS","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651670995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342380,"user_name":"Lothar","can_delete":false,"product_type":"c1","uid":1457360,"ip_address":"","ucode":"B4BED644257E5F","user_header":"https://static001.geekbang.org/account/avatar/00/16/3c/d0/224e5f22.jpg","comment_is_top":false,"comment_ctime":1650229814,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650229814","product_id":100098901,"comment_content":"请问sps pps出现的频率是什么？每一个gop会放一组sps pps吗？","like_count":0},{"had_liked":false,"id":341520,"user_name":"Geek_00d0ef","can_delete":false,"product_type":"c1","uid":2973038,"ip_address":"","ucode":"6253B8A17BE274","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/9wMJwh9oo16l63ZOLX4M814qaXJofVwG169XeeZJ5xibXDqkJffod0ELvhVU822ibIXyB7QichvjX6K1icehJh6Xjg/132","comment_is_top":false,"comment_ctime":1649671308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649671308","product_id":100098901,"comment_content":"发现了一个宝藏老师","like_count":0},{"had_liked":false,"id":341407,"user_name":"易水南风","can_delete":false,"product_type":"c1","uid":1123818,"ip_address":"","ucode":"A2A0F18228A5D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/25/ea/ec869117.jpg","comment_is_top":false,"comment_ctime":1649583282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649583282","product_id":100098901,"comment_content":"老师，我看其他资料是说H264码流格式是AnnexB 和 avcC哦？","like_count":0},{"had_liked":false,"id":341302,"user_name":"A君","can_delete":false,"product_type":"c1","uid":1940105,"ip_address":"","ucode":"FE96F089C2312C","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg","comment_is_top":false,"comment_ctime":1649511549,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649511549","product_id":100098901,"comment_content":"H264编码的IDR帧到下一个IDR帧的前一帧之间，即GOP，有I帧P帧B帧，GOP越大，pb帧占比越高，压缩率越高，但idr间隔远了，seek的步长就会越长（？）各帧会切分为多个slice来发送，每个slice又是由多个宏块构成，每个宏块可以划分成多个编码子块。H264有annexb和mp4两种码流格式，前者会在发送slice之前发送一个4字节的起始码，后者也是一个4字节的数据，用于获取后续slice的长度。图像分辨率、yuv格式配置等metadata会通过SPA&#47;PSS在帧slice前发送。","like_count":0},{"had_liked":false,"id":341297,"user_name":"慕士塔格","can_delete":false,"product_type":"c1","uid":1059152,"ip_address":"","ucode":"B30AA3F6EDC4BF","user_header":"https://static001.geekbang.org/account/avatar/00/10/29/50/2b2e6875.jpg","comment_is_top":false,"comment_ctime":1649508564,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649508564","product_id":100098901,"comment_content":"编码数据00 00 00改成00 00 03 00，那如果编码数据中正好也有00 00 03怎么办？","like_count":0},{"had_liked":false,"id":339149,"user_name":"Geek_18e70d","can_delete":false,"product_type":"c1","uid":2850823,"ip_address":"","ucode":"E201FF495A06EE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/w6PB0WPSSfKWNsrdGDultmctmIqCic7ictcnLuNwUzRAPDBiaicDUXq5CIVtCq8RbEU88NQUOKNXS91428lUI2yhkg/132","comment_is_top":false,"comment_ctime":1647941229,"is_pvip":false,"replies":[{"id":"124415","content":"这种判断方式的前提是你用的rtp 协议，如果不是用的rtp 协议的话就没有mark位了","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1648687754,"ip_address":"","comment_id":339149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647941229","product_id":100098901,"comment_content":"李老师一帧的多slice的判断为什么不能用first_mb_slice和RTP的mark位组合判断，是因为这个不RTP传输的吗","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559275,"discussion_content":"这种判断方式的前提是你用的rtp 协议，如果不是用的rtp 协议的话就没有mark位了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648687754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339148,"user_name":"Geek_18e70d","can_delete":false,"product_type":"c1","uid":2850823,"ip_address":"","ucode":"E201FF495A06EE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/w6PB0WPSSfKWNsrdGDultmctmIqCic7ictcnLuNwUzRAPDBiaicDUXq5CIVtCq8RbEU88NQUOKNXS91428lUI2yhkg/132","comment_is_top":false,"comment_ctime":1647941122,"is_pvip":false,"replies":[{"id":"124416","content":"mark位是rtp 协议才有的","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1648687773,"ip_address":"","comment_id":339148,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647941122","product_id":100098901,"comment_content":"一帧的多slice的判断为什么不能用mark位判断","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559276,"discussion_content":"mark位是rtp 协议才有的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648687773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337711,"user_name":"weekend","can_delete":false,"product_type":"c1","uid":2853514,"ip_address":"","ucode":"03EEAFC78B76B4","user_header":"https://static001.geekbang.org/account/avatar/00/2b/8a/8a/2aa0e992.jpg","comment_is_top":false,"comment_ctime":1646985177,"is_pvip":false,"replies":[{"id":"123457","content":"在slice header里面有一个slice type的字段可以区分具体的类型","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1647048592,"ip_address":"","comment_id":337711,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646985177","product_id":100098901,"comment_content":"&quot;NALU 类型只区分了 IDR Slice 和非 IDR Slice，至于非 IDR Slice 是普通 I Slice、P Slice 还是 B Slice，则需要继续解析 Slice Header 中的 Slice Type 字段得到&quot;<br><br>--请问老师这个可以讲一下非IDR Slice，要具体怎么判断是P Slice还是B&#47;I Slice呢？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555725,"discussion_content":"在slice header里面有一个slice type的字段可以区分具体的类型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647048593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331966,"user_name":"Chris Zou","can_delete":false,"product_type":"c1","uid":1897148,"ip_address":"","ucode":"B6DFC71C1DD8B7","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg","comment_is_top":false,"comment_ctime":1642928154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642928154","product_id":100098901,"comment_content":"老师，为什么我用wireshark解析H264的rtp包（FU-A）时，只有每帧的第一个包才会解析出 H264 NALU header，并且也只有first_mb_in_slice、slice_type、pic_paramter_set_id这三个字段，其他的解不出来？","like_count":0},{"had_liked":false,"id":330127,"user_name":"chao","can_delete":false,"product_type":"c1","uid":1358527,"ip_address":"","ucode":"AE1DBB0592747C","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/bf/e9a44c63.jpg","comment_is_top":false,"comment_ctime":1641806989,"is_pvip":false,"replies":[{"id":"120351","content":"NALU是标准规定的，每一个SPS PPS SEI和Slice 都是一个NALU。至于STAP MTAP和FU这几个跟RTP打包相关的在第9节课有详细介绍，你可以参考一下。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1641893314,"ip_address":"","comment_id":330127,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641806989","product_id":100098901,"comment_content":"请问 NAL Unit、STAP、MTAP、FU 有各自适用的场景吗","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545280,"discussion_content":"NALU是标准规定的，每一个SPS PPS SEI和Slice 都是一个NALU。至于STAP MTAP和FU这几个跟RTP打包相关的在第9节课有详细介绍，你可以参考一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641893314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325408,"user_name":"余健辉","can_delete":false,"product_type":"c1","uid":1694237,"ip_address":"","ucode":"2150C89CF66ADC","user_header":"https://wx.qlogo.cn/mmopen/vi_32/yBBhL9I6vian2PMOo7xnibKp8EibiaCrqfXibk5YOQSfzyjfZPGnUqHy1x1ibVIVYddMnibFJlpJibutAicXsZibwqskFoibw/132","comment_is_top":false,"comment_ctime":1638948893,"is_pvip":false,"replies":[{"id":"120253","content":"x264和h264可以去leixiaohua大佬的csdn博客里面学习。https:&#47;&#47;blog.csdn.net&#47;leixiaohua1020&#47;category_2619503.html?spm=1001.2014.3001.5482。<br>av1的资料还很少。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1641791893,"ip_address":"","comment_id":325408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638948893","product_id":100098901,"comment_content":"因为B帧是参考前面和后面帧数据的，计算量就相对大了一点，而且还需要缓存帧用于解码，所以会产生一定的时延。<br>想请问老师关于h264，AV1这些编码协议和对应的编码器x264这些和他们的编程有什么好的学习资料吗","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544967,"discussion_content":"x264和h264可以去leixiaohua大佬的csdn博客里面学习。https://blog.csdn.net/leixiaohua1020/category_2619503.html?spm=1001.2014.3001.5482。\nav1的资料还很少。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641791893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325007,"user_name":"一身龙骨","can_delete":false,"product_type":"c1","uid":2853068,"ip_address":"","ucode":"70ED9F147C6DC0","user_header":"https://static001.geekbang.org/account/avatar/00/2b/88/cc/e1ba2379.jpg","comment_is_top":false,"comment_ctime":1638777731,"is_pvip":false,"replies":[{"id":"117913","content":"起始码都是00 00 00 01或者00 00 01。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638784713,"ip_address":"","comment_id":325007,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1638777731","product_id":100098901,"comment_content":"请问B帧的起始码是啥？谢谢！","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536431,"discussion_content":"起始码都是00 00 00 01或者00 00 01。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638784713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2853068,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/88/cc/e1ba2379.jpg","nickname":"一身龙骨","note":"","ucode":"70ED9F147C6DC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536687,"discussion_content":"抱歉我问错了，我是想问这个：\n00 00 00 01 68是PPS，\n00 00 00 01 65是idr帧，\n00 00 00 01 _ _是P帧？\n00 00 00 01 _ _是B帧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638845536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536431,"ip_address":""},"score":536687,"extra":""},{"author":{"id":1897148,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg","nickname":"Chris Zou","note":"","ucode":"B6DFC71C1DD8B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2853068,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/88/cc/e1ba2379.jpg","nickname":"一身龙骨","note":"","ucode":"70ED9F147C6DC0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538223,"discussion_content":"非IDR根据slice header来判断的I p b帧的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639372775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536687,"ip_address":""},"score":538223,"extra":""}]}]},{"had_liked":false,"id":325002,"user_name":"ripple","can_delete":false,"product_type":"c1","uid":1090051,"ip_address":"","ucode":"99008FD0533F68","user_header":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","comment_is_top":false,"comment_ctime":1638776461,"is_pvip":false,"replies":[{"id":"117912","content":"27是指0x27","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638784647,"ip_address":"","comment_id":325002,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638776461","product_id":100098901,"comment_content":"00 00 00 00 27 为什么是一个pps？是不是写错了呢？<br>27 转成2进制是00011011，前一位0是F，接着两位00，代表NRI，pps不是要求大于0么？<br>后面5位是type，我理解没对？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536430,"discussion_content":"27是指0x27","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638784647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1090051,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","nickname":"ripple","note":"","ucode":"99008FD0533F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":536467,"discussion_content":"哈哈哈，对的，看漏了，感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638789792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536430,"ip_address":""},"score":536467,"extra":""}]}]},{"had_liked":false,"id":324799,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1638630850,"is_pvip":true,"replies":[{"id":"117922","content":"码流结构主要是用来方便对码流做一些基本解析的。像NALU，它的type就直接标示了是不是IDR帧，是不是SPS和PPS，有这些东西我们就能做一些常用的基本判断。比如码流必须从SPS、PPS、IDR开始解码的。我们就可以直接从NALU头部判断是不是SPS、PPS、IDR了。至于为什么一定要设计成这样的。这个我理解格式确定应该是大佬们定下来的。就像是TCP标准一样，每个字段怎么放？是不是一定需要这样放？应该都是大佬们定的吧。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638785764,"ip_address":"","comment_id":324799,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638630850","product_id":100098901,"comment_content":"希望能知道码流结构为什么要这样设计？上节课讲编码原理的时候，预测编码、DCT和量化等都是为了压缩掉各种冗余信息。这节课的码流结构又解决了什么样的问题呢？尤其是NALU，为什么是这样的结构？有没有什么特别的考虑？还是说只要包含了必要的信息，随便什么样的格式都可以？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536443,"discussion_content":"码流结构主要是用来方便对码流做一些基本解析的。像NALU，它的type就直接标示了是不是IDR帧，是不是SPS和PPS，有这些东西我们就能做一些常用的基本判断。比如码流必须从SPS、PPS、IDR开始解码的。我们就可以直接从NALU头部判断是不是SPS、PPS、IDR了。至于为什么一定要设计成这样的。这个我理解格式确定应该是大佬们定下来的。就像是TCP标准一样，每个字段怎么放？是不是一定需要这样放？应该都是大佬们定的吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638785764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324584,"user_name":"我有一条鱼","can_delete":false,"product_type":"c1","uid":2143357,"ip_address":"","ucode":"9581A06A0EAF3B","user_header":"https://static001.geekbang.org/account/avatar/00/20/b4/7d/9455f31a.jpg","comment_is_top":false,"comment_ctime":1638510587,"is_pvip":true,"replies":[{"id":"118430","content":"使用一个B帧大概提升10%左右","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1639409404,"ip_address":"","comment_id":324584,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638510587","product_id":100098901,"comment_content":"问题：<br>那B帧相对于P帧来说能减少多少大小吗？有相关的数据吗？","like_count":1,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538473,"discussion_content":"使用一个B帧大概提升10%左右","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639409404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324474,"user_name":"qingzhu","can_delete":false,"product_type":"c1","uid":1212587,"ip_address":"","ucode":"87C05FF2BA50B7","user_header":"","comment_is_top":false,"comment_ctime":1638451072,"is_pvip":false,"replies":[{"id":"119352","content":"这个需要业务本身判断。如果是裸码流的话不好判断。一般裸码流还是Annexb的比较多","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1640313036,"ip_address":"","comment_id":324474,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638451072","product_id":100098901,"comment_content":"怎么判断数据量是MP4格式的，还是Annexb起始码格式的？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541264,"discussion_content":"这个需要业务本身判断。如果是裸码流的话不好判断。一般裸码流还是Annexb的比较多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640313036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324452,"user_name":"Y","can_delete":false,"product_type":"c1","uid":1916166,"ip_address":"","ucode":"D7569E54C924D0","user_header":"","comment_is_top":false,"comment_ctime":1638440174,"is_pvip":true,"replies":[{"id":"119346","content":"我觉得不会，因为IDR帧之前会有SPS、PPS，有可能图像的宽度和高度都变化了。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1640312194,"ip_address":"","comment_id":324452,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638440174","product_id":100098901,"comment_content":"请问老师：<br>    IDR之前的帧，会参考本IDR帧和之后的帧吗？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541255,"discussion_content":"我觉得不会，因为IDR帧之前会有SPS、PPS，有可能图像的宽度和高度都变化了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640312194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324437,"user_name":"ripple","can_delete":false,"product_type":"c1","uid":1090051,"ip_address":"","ucode":"99008FD0533F68","user_header":"https://wx.qlogo.cn/mmopen/vi_32/ywSuwVNMKNjRLPMjZmpQOQHWW2usAu8RwRIOlBHaVVU6J3xHdtibgO6FVzYkRIkV50vCr62ia4OwJp07giabiazUGA/132","comment_is_top":false,"comment_ctime":1638434743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638434743","product_id":100098901,"comment_content":"防止竞争中的02,03是怎么存在的？","like_count":0},{"had_liked":false,"id":324393,"user_name":"晓龙","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/93c79f7c.jpg","comment_is_top":false,"comment_ctime":1638414702,"is_pvip":false,"replies":[{"id":"117920","content":"谢谢支持","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638785091,"ip_address":"","comment_id":324393,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638414702","product_id":100098901,"comment_content":"iOS Video ToolBox 可以参考这一篇，在针对老师的课程，融会贯通","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536440,"discussion_content":"谢谢支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638785091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324391,"user_name":"晓龙","can_delete":false,"product_type":"c1","uid":1004576,"ip_address":"","ucode":"78CDCEBD183D3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/20/93c79f7c.jpg","comment_is_top":false,"comment_ctime":1638413228,"is_pvip":false,"replies":[{"id":"117723","content":"回答的非常对。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638422994,"ip_address":"","comment_id":324391,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638413228","product_id":100098901,"comment_content":"因为B帧的解析依赖前后帧，所以需要缓存帧，才能解析B帧，一般RTC场景不编码B帧","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535377,"discussion_content":"回答的非常对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638422994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324223,"user_name":"_zeta","can_delete":false,"product_type":"c1","uid":1068298,"ip_address":"","ucode":"94BBEBBE33EB83","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/0a/e124ec4b.jpg","comment_is_top":false,"comment_ctime":1638343735,"is_pvip":false,"replies":[{"id":"117731","content":"两种叫法。是一样的。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638434773,"ip_address":"","comment_id":324223,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638343735","product_id":100098901,"comment_content":"MP4包格式和RTP包格式有什么区别么？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535416,"discussion_content":"两种叫法。是一样的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638434773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1359941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c0/45/069cd477.jpg","nickname":"好好虚度时光","note":"","ucode":"8079C01665C63F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":567312,"discussion_content":"老师您好，没有理解RTP包格式为什么和MP4包格式是一样的啊？RTP包不是有自己头信息么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650885460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":535416,"ip_address":""},"score":567312,"extra":""}]}]},{"had_liked":false,"id":324157,"user_name":"Geek_7de4c5","can_delete":false,"product_type":"c1","uid":2762698,"ip_address":"","ucode":"47266BE542AE9B","user_header":"","comment_is_top":false,"comment_ctime":1638323608,"is_pvip":false,"replies":[{"id":"117645","content":"是说在码流中去找到宏块？还是图像里面每一个宏块的坐标是怎样的？<br>如果说在码流中去找到每个宏块的话就比较难了，只有Slice的第一个宏块的序号是可以通过slice_header中的first_mb_in_slice得到，其他的需要一个一个位的进行熵解码出出来才能知道当前解码的宏块是第几个宏块，所以这也是为什么在计算宏块级QP时，需要将一帧都熵解码出来，比较麻烦。<br>如果只是说图像中宏块的坐标怎么表示的话，就是从左到右、从上到下依次排列的。最左上角的是0号宏块，之后每个宏块序号+1，知道最右下角的宏块。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638330385,"ip_address":"","comment_id":324157,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638323608","product_id":100098901,"comment_content":"老师，请问一下，如何通过坐标来找对应的宏块呢？","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535007,"discussion_content":"是说在码流中去找到宏块？还是图像里面每一个宏块的坐标是怎样的？\n如果说在码流中去找到每个宏块的话就比较难了，只有Slice的第一个宏块的序号是可以通过slice_header中的first_mb_in_slice得到，其他的需要一个一个位的进行熵解码出出来才能知道当前解码的宏块是第几个宏块，所以这也是为什么在计算宏块级QP时，需要将一帧都熵解码出来，比较麻烦。\n如果只是说图像中宏块的坐标怎么表示的话，就是从左到右、从上到下依次排列的。最左上角的是0号宏块，之后每个宏块序号+1，知道最右下角的宏块。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638330385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324140,"user_name":"西钾钾","can_delete":false,"product_type":"c1","uid":1097722,"ip_address":"","ucode":"0EE77083636ED9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJV27QOK57cdpdh3E4hbArCOlccdtjCyWooF9fhjeSKAMo9SN1v9RODkrZUZD4RejjbdsqU2FIeMA/132","comment_is_top":false,"comment_ctime":1638321730,"is_pvip":false,"replies":[{"id":"117727","content":"编码的时候，由于需要先编码后面的P帧，才能编码前面的B帧，所以也会缓存几帧才能开始编码B帧，也会导致延时很多。","user_name":"作者回复","user_name_real":"编辑","uid":"2744713","ctime":1638423792,"ip_address":"","comment_id":324140,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638321730","product_id":100098901,"comment_content":"B帧是双向预测帧，需要前后帧作为参考，这会在拉流侧产生延迟。<br>B解码时应该也会比较耗费cpu","like_count":0,"discussions":[{"author":{"id":2744713,"avatar":"https://static001.geekbang.org/account/avatar/00/29/e1/89/2bc80aa1.jpg","nickname":"叫什么好呢","note":"","ucode":"2A4069A23DE3B2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535384,"discussion_content":"编码的时候，由于需要先编码后面的P帧，才能编码前面的B帧，所以也会缓存几帧才能开始编码B帧，也会导致延时很多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638423792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}