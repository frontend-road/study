{"id":109717,"title":"26 | 网关和反向代理是什么关系？","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":178792,"user_name":"Tyrone","can_delete":false,"product_type":"c3","uid":1400703,"ip_address":"","ucode":"DA6F289438A750","user_header":"https://static001.geekbang.org/account/avatar/00/15/5f/7f/3d005d61.jpg","comment_is_top":false,"comment_ctime":1581825077,"is_pvip":false,"replies":[{"id":69735,"content":"你好，具体要不要分，还是要看业务和团队规模，对于像携程这样体量的公司(我之前工作过)，它们内部有超过十套以上面向不同端的网关，总网关集群规模超过百台。对大体量多团队的公司，网关如果分的不够，不同团队容易打架。微服务也是这个道理，服务分分多少多细，也主要看体量和团队规模，小团队不分也没事。另外，安全认证要求，对于不同部门可能不一样，比如支付部门要求更严格，所以可以独立定制部署。\n\n另外，nginx偏运维，spring gateway对中国java程序员更友好。\n\n\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1582039887,"ip_address":"","comment_id":178792,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"我在给公司做重构时，在网关上做了不少工作，和老师探讨一下、以下几点是个人认为。还望指点:\n1、所有不同的端，我觉得不需要分这么细。在我看来。ios 安卓  h5 web。。。都只是一个不同的端完全可以在客户端请求头内带入端的代号。每次请求后网关根据代号做策略选择。\n2、不同的端其实他们安全验证和日志等等基本都是一套。。。所以真心没有必要这么分。。。\n3、nginx 一样可以用lua做上面这些工作，但是不太好维护。所以还是建议使用spring的gateway\n","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483968,"discussion_content":"你好，具体要不要分，还是要看业务和团队规模，对于像携程这样体量的公司(我之前工作过)，它们内部有超过十套以上面向不同端的网关，总网关集群规模超过百台。对大体量多团队的公司，网关如果分的不够，不同团队容易打架。微服务也是这个道理，服务分分多少多细，也主要看体量和团队规模，小团队不分也没事。另外，安全认证要求，对于不同部门可能不一样，比如支付部门要求更严格，所以可以独立定制部署。\n\n另外，nginx偏运维，spring gateway对中国java程序员更友好。\n\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582039887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118288,"user_name":"亚林","can_delete":false,"product_type":"c3","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1564309571,"is_pvip":false,"replies":[{"id":43321,"content":"你这个理解也有一定道理，网关主要给微服务&#47;api用，偏向开发人员，反向代理主要面向传统静态web应用，偏向运维。未来趋势是DevOps+网关和反向代理再次融合。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1564320874,"ip_address":"","comment_id":118288,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"还是有点懵。感觉网关是给开发者用的，反向代理是给很少编程的运维人员用的。","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460345,"discussion_content":"你这个理解也有一定道理，网关主要给微服务/api用，偏向开发人员，反向代理主要面向传统静态web应用，偏向运维。未来趋势是DevOps+网关和反向代理再次融合。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564320874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117403,"user_name":"PK時頭髮不亂","can_delete":false,"product_type":"c3","uid":1207867,"ip_address":"","ucode":"08AAAC8F4DE71D","user_header":"https://static001.geekbang.org/account/avatar/00/12/6e/3b/88f14e2a.jpg","comment_is_top":false,"comment_ctime":1564040900,"is_pvip":false,"replies":[{"id":43004,"content":"在k8s中，和网关等价的概念叫Ingress，像kong&#47;envoy&#47;traefik这些可编程网关，都有支持对接Ingress。课程项目Staffjoy中的Faraday，即是反向代理也是网关，当把Staffjoy部署到K8s环境，Faraday也相当于Ingress功能。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1564060083,"ip_address":"","comment_id":117403,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"可编程网关怎样跟k8s结和？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459951,"discussion_content":"在k8s中，和网关等价的概念叫Ingress，像kong/envoy/traefik这些可编程网关，都有支持对接Ingress。课程项目Staffjoy中的Faraday，即是反向代理也是网关，当把Staffjoy部署到K8s环境，Faraday也相当于Ingress功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564060083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207867,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6e/3b/88f14e2a.jpg","nickname":"PK時頭髮不亂","note":"","ucode":"08AAAC8F4DE71D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2970,"discussion_content":"还是不明白，可能我了解不深吧。\n我知道的是k8s用yaml作为模板，但要实现自定义的功能没找到方法，ingree都内置写死的。\n另外怎样利用k8s进行架构的取舍，这也是我要加入这课程找答案的目的。\n但更新有点慢，还没开始k8s的环节。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564078799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117233,"user_name":"WL","can_delete":false,"product_type":"c3","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1564013887,"is_pvip":false,"replies":[{"id":43000,"content":"zuul是java开发，绝对性能比不过c&#47;lua开发的nginx。但是网关性能考量只是一个方面，同时还要考虑开发和维护是否方便，使用是否简单灵活等其它方面因素。相对于nginx，zuul对开发人员(特别是java开发人员)更友好，使用门槛也更低。另外，网关一般无状态部署，可以支持水平扩容，如果性能容量不够，只要简单扩容即可。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1564059225,"ip_address":"","comment_id":117233,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"请问一下老师统一代理和zuul网关的性能有没有ngx那样的高性能","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459872,"discussion_content":"zuul是java开发，绝对性能比不过c/lua开发的nginx。但是网关性能考量只是一个方面，同时还要考虑开发和维护是否方便，使用是否简单灵活等其它方面因素。相对于nginx，zuul对开发人员(特别是java开发人员)更友好，使用门槛也更低。另外，网关一般无状态部署，可以支持水平扩容，如果性能容量不够，只要简单扩容即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564059225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116633,"user_name":"而立斋","can_delete":false,"product_type":"c3","uid":1087258,"ip_address":"","ucode":"5FED6E9E148195","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/1a/389eab84.jpg","comment_is_top":false,"comment_ctime":1563883657,"is_pvip":false,"replies":[{"id":42631,"content":"你好，kong(https:&#47;&#47;github.com&#47;Kong&#47;kong)就是在openresty基础上扩展出来的云原生的网关，有api动态可编程，后面有一节专门讲主流网关概览会讲到kong。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563887378,"ip_address":"","comment_id":116633,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"openrestry能用在云原生应用中吗？不是也号称是动态可编程网关吗？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459622,"discussion_content":"你好，kong(https://github.com/Kong/kong)就是在openresty基础上扩展出来的云原生的网关，有api动态可编程，后面有一节专门讲主流网关概览会讲到kong。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563887378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288069,"user_name":"Maggie唐麦子🐣","can_delete":false,"product_type":"c3","uid":2152888,"ip_address":"","ucode":"E0A3433CFB1438","user_header":"https://static001.geekbang.org/account/avatar/00/20/d9/b8/d58335e2.jpg","comment_is_top":false,"comment_ctime":1618288379,"is_pvip":false,"replies":[{"id":104802,"content":"这时候可以考虑引入前置硬件负载均衡，例如F5或者A10，然后nginx躲在硬件负载均衡器后面，做二级负载均衡，这时候nginx可以按需部署多台，分摊负载。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1618669809,"ip_address":"","comment_id":288069,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，我想问一下Nginx的负载均衡，我们如果请求量非常大，Nginx根本承载不了这么大的请求量，接收不了这么大的请求量，这时候Nginx还怎么做负载均衡呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518505,"discussion_content":"这时候可以考虑引入前置硬件负载均衡，例如F5或者A10，然后nginx躲在硬件负载均衡器后面，做二级负载均衡，这时候nginx可以按需部署多台，分摊负载。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618669809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128180,"user_name":"wmg","can_delete":false,"product_type":"c3","uid":1070036,"ip_address":"","ucode":"BA4CED171B59E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/d4/2ed767ea.jpg","comment_is_top":false,"comment_ctime":1566854638,"is_pvip":false,"replies":[{"id":47691,"content":"stackoverflow上有讨论，网关和反向代理只是术语叫法不同，两者可以互补，也可以相互替代。\n\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;35756663&#47;api-gateway-vs-reverse-proxy","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566910840,"ip_address":"","comment_id":128180,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"感觉网关主要体现的是流量汇聚的作用，反向代理体现的是中间代理人的作用，某些场景下既可以叫网关也可以叫反向代理","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464827,"discussion_content":"stackoverflow上有讨论，网关和反向代理只是术语叫法不同，两者可以互补，也可以相互替代。\n\nhttps://stackoverflow.com/questions/35756663/api-gateway-vs-reverse-proxy","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566910840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307879,"user_name":"丸吖芝士条","can_delete":false,"product_type":"c3","uid":1962520,"ip_address":"","ucode":"C9511CA0AF28A8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f2/18/13bb693f.jpg","comment_is_top":false,"comment_ctime":1629291515,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"BFF emmm...  前端是多想表现自己","like_count":0,"discussions":[{"author":{"id":1241496,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f1/98/49775ece.jpg","nickname":"wxw","note":"","ucode":"5927EAEF6D2919","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594897,"discussion_content":"？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669537168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"安徽","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219946,"user_name":"xgbyl","can_delete":false,"product_type":"c3","uid":1363123,"ip_address":"","ucode":"1D48711210CAD4","user_header":"https://static001.geekbang.org/account/avatar/00/14/cc/b3/ac3e3d8f.jpg","comment_is_top":false,"comment_ctime":1590122827,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"api网关 Zuul  基本功能与反向代理大同小异 \n动态可配置、动态可编程\n统一代理：envoy、traefik\n\n反向代理 -&gt; 网关&amp;反向代理 -&gt; 统一代理","like_count":0}]}