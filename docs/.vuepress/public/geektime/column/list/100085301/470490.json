{"id":470490,"title":"ç”¨æˆ·æ•…äº‹ï½œè¯­è¨€ä¸ä»…æ˜¯å·¥å…·ï¼Œè¿˜æ˜¯æ€ç»´æ–¹å¼","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ Pedroï¼Œä¸€åæ™®æ™®é€šé€šæ‰“å·¥äººï¼Œå¹³å¹³å‡¡å‡¡å°ç å†œã€‚</p><p>å¯èƒ½ä½ åœ¨è¯¾ç¨‹ç•™è¨€åŒºçœ‹åˆ°è¿‡æˆ‘ï¼Œä¹Ÿè·Ÿæˆ‘è®¨è®ºè¿‡é—®é¢˜ã€‚ä»Šå¤©å€Ÿç€è¿™ç¯‡ç”¨æˆ·æ•…äº‹çš„æœºä¼šï¼Œæ­£å¥½èƒ½è·Ÿä½ å†å¤šèŠå‡ å¥ã€‚</p><p>æˆ‘ç®€å•æ•´ç†äº†ä¸€ä¸‹è‡ªå·±å…¥å‘ç¼–ç¨‹ä»¥æ¥çš„ä¸€äº›æ€è€ƒï¼Œä¸»è¦ä¼šä»æ€ç»´ã€è¯­è¨€å’Œå·¥å…·ä¸‰ä¸ªæ–¹é¢æ¥èŠä¸€èŠï¼Œæœ€åä¹Ÿç»™ä½ åˆ†äº«ä¸€ç‚¹è‡ªå·±å¯¹ Rust çš„çœ‹æ³•ï¼Œå½“ç„¶ä»¥ä¸‹è§‚ç‚¹éƒ½æ˜¯â€œä¸»è§‚â€çš„ï¼Œè§‚ç‚¹æœ¬èº«ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¾—åˆ°è§‚ç‚¹çš„è¿‡ç¨‹ã€‚</p><h2>ä»æ€ç»´è°ˆèµ·</h2><p>ä»æ¥è§¦ç¼–ç¨‹å¼€å§‹ï¼Œæˆ‘ä»¬å°±å·²ç»å¼€å§‹ä¸ç¼–ç¨‹è¯­è¨€æ‰“äº¤é“ï¼Œå¾ˆå¤šäººå­¦ä¹ ç¼–ç¨‹çš„é“è·¯å¾€å¾€å°±æ˜¯ç†Ÿæ‚‰ç¼–ç¨‹è¯­è¨€çš„è¿‡ç¨‹ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººä¼šä¸é€‚åº”ï¼Œå†™å‡ºçš„ä»£ç å¾€å¾€éƒ½ä¸èƒ½è¿è¡Œï¼Œæ›´åˆ«æè®¾è®¡ä¸æŠ½è±¡ã€‚å‡ºç°è¿™ä¸ªç°è±¡æœ€æ ¹æœ¬çš„åŸå› æ˜¯ï¼Œä»£ç ä½“ç°çš„æ˜¯è®¡ç®—æœºæ€ç»´ï¼Œ<strong>è€Œäººè„‘æ€ç»´å’Œè®¡ç®—æœºæ€ç»´å·®å¼‚å·¨å¤§ï¼Œå¾ˆå¤šäººä¸€å¼€å§‹æ— æ³•æ¥å—ä¸¤ç§æ€ç»´å·®å¼‚å¸¦æ¥çš„å·¨å¤§å†²å‡»</strong>ã€‚</p><p>é‚£ä¹ˆï¼Œç©¶ç«Ÿä»€ä¹ˆæ˜¯è®¡ç®—æœºæ€ç»´ï¼Ÿ</p><p>è®¡ç®—æœºæ€ç»´æ˜¯å…¨æ–¹ä½çš„ï¼Œä½“ç°åœ¨æ–¹æ–¹é¢é¢ï¼Œæˆ‘ä»¥ä¸ªäººè§†è§’æ¥ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼š</p><ul>\n<li>è‡ªé¡¶å‘ä¸‹ï¼šè‡ªé¡¶å‘ä¸‹æ˜¯è®¡ç®—æœºæ€ç»´çš„ç²¾é«“ï¼Œäººè„‘æ›´åŠ é€‚åˆè‡ªåº•å‘ä¸Šã€‚è®¡ç®—æœºé€šè¿‡è‡ªé¡¶å‘ä¸‹æ€ç»´å°†å¤§è€Œéš¾çš„é—®é¢˜æ‹†è§£ä¸ºå°é—®é¢˜ï¼Œå†å°†å°é—®é¢˜é€ä¸€è§£å†³ï¼Œä»è€Œæœ€ç»ˆè§£å†³å¤§é—®é¢˜ã€‚</li>\n<li>å¤šç»´åº¦ã€å¤šä»»åŠ¡ï¼šäººè„‘æ˜¯çº¿æ€§çš„ï¼Œçœ‹é—®é¢˜å¾€å¾€æ˜¯å•ç»´çš„ï¼Œæˆ‘ä»¬å¾ˆéš¾åŒæ—¶å¤„ç†å’Œæ€è€ƒå¤šä¸ªé—®é¢˜ï¼Œä½†æ˜¯è®¡ç®—æœºä¸ä¸€æ ·ï¼Œå®ƒå¯ä»¥æœ‰å¤šä¸ª CPU æ ¸å¿ƒï¼Œåœ¨ä¿å­˜ä¸Šä¸‹æ–‡çš„åŸºç¡€ä¸Šèƒ½å¤Ÿå¹¶å‘è¿è¡Œæˆç™¾ä¸Šåƒçš„ä»»åŠ¡ã€‚</li>\n<li>å…¨å±€æ€§ï¼šäººçš„ç²¾åŠ›ã€è„‘å®¹é‡æ˜¯æœ‰é™çš„ï¼Œè€Œè®¡ç®—æœºçš„å®¹é‡å‡ ä¹æ˜¯æ— é™çš„ï¼›äººåœ¨æ€è€ƒé—®é¢˜æ—¶ï¼Œé™äºè‡ªå·±çš„å±€éƒ¨æ€§ï¼Œæ‹¿åˆ°å±€éƒ¨è§£å°±å¼€å§‹åšäº†ï¼Œè€Œè®¡ç®—æœºå¯ä»¥åœ¨æµ·é‡æ•°æ®çš„åŸºç¡€ä¸Šå†åšå†³ç­–ï¼Œä»è€Œé€¼è¿‘å…¨å±€æœ€ä¼˜ã€‚</li>\n<li>åä½œæ€§ï¼šè®¡ç®—æœºæœ¬èº«å°±æ˜¯ä¸€ä»¶æå…¶ç²¾ç»†åŒ–çš„å·¥ç¨‹è‰ºæœ¯å“ï¼Œå®ƒå¤æ‚ç²¾å·§ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½åªä¼šåšè‡ªå·±æœ€æ“…é•¿çš„äº‹æƒ…ï¼Œæ¯”å¦‚å°†è®¡ç®—å’Œå­˜å‚¨å‰¥ç¦»ï¼Œè®¡ç®—æœºé«˜æ•ˆè¿ä½œçš„èƒŒåæ˜¯æ¯ä¸ªéƒ¨åˆ†åä½œçš„ç»“æœï¼Œè€Œäººæ›´æ“…é•¿å•ä½“ä½œæˆ˜ï¼Œåªæœ‰é€šè¿‡å¤§é‡çš„è®­ç»ƒï¼Œæ‰èƒ½å‘æŒ¥ç¾¤ä½“çš„ä½œç”¨ã€‚</li>\n<li>è¿­ä»£å¿«ï¼šäººç±»è¿›åŒ–ã€æˆé•¿æ˜¯ç¼“æ…¢çš„ï¼Œç›´åˆ°ç°åœ¨ï¼Œå¾ˆå¤šäººçš„æ€ç»´æ–¹å¼ä»æ—§åœç•™åœ¨ä¸Šä¸ªä¸–çºªï¼Œè€Œè®¡ç®—æœºåˆ™ä¸åŒï¼Œè¿›å…¥ä¿¡æ¯æ—¶ä»£åï¼Œè®¡ç®—æœºå°±éµå¾ªç€æ‘©å°”å®šå¾‹ï¼Œæ¯ 18 ä¸ªæœˆç¿»ä¸€ç•ªï¼Œåå¹´å‰çš„æ‰‹æœºæ”¾åœ¨ä»Šå¤©å¯èƒ½è¿å¾®ä¿¡éƒ½æ— æ³•æ­£å¸¸è¿è¡Œã€‚</li>\n<li>å–èˆï¼šåœ¨é•¿æœŸçš„ç¤¾ä¼šå‘å±•ä¸­ï¼Œäººè¿‡åˆ†å–œæ¬¢å¼ºè°ƒå¯¹ä¸é”™ï¼Œå–œæ¬¢è¿½æ±‚ç»å¯¹çš„å…¬å¹³ï¼Œè®½åˆºçš„æ˜¯ï¼Œç”±äºŒè¿›åˆ¶ç»„æˆçš„è®¡ç®—æœºå´ä¸ä¼šåšå‡ºéé»‘å³ç™½çš„å†³ç­–ï¼Œæ— è®ºæ˜¯è®¡ç®—æœºæœ¬èº«(ç¡¬ä»¶)ï¼Œè¿˜æ˜¯é‡Œé¢è¿è¡Œçš„è½¯ä»¶ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯æ€§èƒ½ã€æˆæœ¬ã€æ˜“ç”¨æ€§å¤šè§’åº¦æƒè¡¡çš„ç»“æœã€‚</li>\n<li>So onâ€¦</li>\n</ul><!-- [[[read_end]]] --><p>å½“è¿™äº›æ€ç»´ç›´æ¥ä½“ç°åœ¨ä»£ç é‡Œé¢ï¼Œæ¯”å¦‚ï¼Œè‡ªé¡¶å‘ä¸‹ä½“ç°åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å°±æ˜¯é€’å½’ã€åˆ†æ²»ï¼›å¤šç»´åº¦ã€å¤šä»»åŠ¡çš„ä½“ç°å°±æ˜¯åˆ†æ”¯ã€è·³è½¬ã€ä¸Šä¸‹æ–‡ï¼›è¿­ä»£ã€åä½œå’Œå–èˆåœ¨ç¼–ç¨‹ä¸­ä¹Ÿå¤„å¤„å¯è§ã€‚</p><p>è€Œè¿™äº›æ°æ°æ˜¯äººè„‘æ€ç»´ä¸æ“…é•¿çš„ç‚¹ï¼Œæ‰€ä»¥å¾ˆå¤šäººæ— æ³•çŸ­æ—¶é—´å†…åšåˆ°ç¼–ç¨‹å…¥é—¨ã€‚æƒ³è¦ç†Ÿç»ƒæŒæ¡ç¼–ç¨‹ï¼Œå°±å¿…é¡»è®¤è¯†åˆ°äººè„‘ä¸è®¡ç®—æœºæ€ç»´çš„å·®å¼‚ï¼Œå¼ºåŒ–è®¡ç®—æœºæ€ç»´çš„è®­ç»ƒï¼Œ<strong>è¿™ä¸ªè®­ç»ƒçš„è¿‡ç¨‹æ˜¯ä¸å¤ªå¯èƒ½çŸ­æš‚çš„ï¼Œå› æ­¤ç¼–ç¨‹å…¥é—¨å¿…é¡»è¦æ¶ˆè€—å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›</strong>ã€‚</p><h2>è¯­è¨€</h2><p>ä¸è¿‡æ€ç»´çš„è®­ç»ƒå’Œè¯„ä¼°æ˜¯éœ€è¦æœ‰è½½ä½“çš„ï¼Œå°±å¥½æ¯”è¯„ä¼°ä½ çš„è‹±æ–‡æ°´å¹³ï¼Œä¼šè€ƒå¯Ÿä½ ç”¨è‹±æ–‡å¬/è¯´/è¯»/å†™çš„è¡¨è¾¾èƒ½åŠ›ã€‚é‚£æˆ‘ä»¬çš„è®¡ç®—æœºæ€ç»´æ€ä¹ˆè¡¨è¾¾å‘¢ï¼Ÿ</p><p>äºäººè€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‚¢ä½“åŠ¨ä½œã€ç¥æƒ…ã€å£°éŸ³ã€æ–‡å­—ç­‰æ¥è¡¨è¾¾æ€ç»´ã€‚åœ¨æ¼«é•¿çš„äººç±»å²ä¸­ï¼ŒåŠ¨ä½œã€ç¥æƒ…ã€å£°éŸ³è¿™å‡ ç§è½½ä½“å¾ˆéš¾ä¼ æ‰¿å’Œä¼ æ’­ï¼Œç›´åˆ°è¿‘ä»£ï¼ŒéŸ³ã€è§†é¢‘çš„å…´èµ·æ‰å¼€å§‹æ…¢æ…¢è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ–‡å­—ï¼Œå°¤å…¶æ˜¯è¯­è¨€è¯ç”Ÿåçš„æ–‡å­—ï¼Œæˆäº†äººç±»æ–‡æ˜å»¶ç»­ã€å‘å±•çš„ä¸»è¦é€”å¾„ä¹‹ä¸€ï¼Œç›´è‡³ä»Šå¤©ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡æ–‡å­—æ¥ä¸å…ˆè´¤å¯¹è¯ã€‚å½“ç„¶ï¼Œå¯¹è¯çš„å‰ææ˜¯ï¼Œè¿™äº›æ–‡å­—ä½ å¾—çœ‹å¾—æ‡‚ã€‚</p><p>è€Œçœ‹å¾—æ‡‚çš„å‰ææ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åŒä¸€ç§æˆ–ç±»ä¼¼çš„è¯­è¨€ã€‚</p><p><strong>å›åˆ°è®¡ç®—æœºä¸Šæ¥ï¼Œç°ä»£è®¡ç®—æœºä¹Ÿæ˜¯æœ‰é€šç”¨è¯­è¨€çš„</strong>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„äºŒè¿›åˆ¶æœºå™¨è¯­è¨€ï¼Œä¸“ä¸šä¸€ç‚¹å«æŒ‡ä»¤é›†ã€‚äºŒè¿›åˆ¶æ˜¯è®¡ç®—æœºçš„çµé­‚ï¼Œä½†æ˜¯äººç±»å´å¾ˆéš¾ç†è§£ã€è®°å¿†å’Œåº”ç”¨ï¼Œå› æ­¤ä¸ºäº†è¾…åŠ©äººç±»æ“çºµè®¡ç®—æœºå·¥ä½œï¼Œä¸Šä¸€ä»£ç¨‹åºå‘˜ä»¬å¯¹æœºå™¨è¯­è¨€åšäº†ç¬¬ä¸€æ¬¡æŠ½è±¡ï¼Œå‘æ˜äº†æ±‡ç¼–è¯­è¨€ã€‚</p><p>ä½†ä¼´éšç€ç¡¬ä»¶ã€è½¯ä»¶çš„å¿«é€Ÿå‘å±•ï¼Œç¨‹åºä»£ç è¶Šæ¥è¶Šé•¿ï¼Œåº”ç”¨å˜å¾—æ„ˆæ¥æ„ˆåºå¤§ï¼Œæ±‡ç¼–çº§åˆ«çš„æŠ½è±¡å·²ç»æ— æ³•æ»¡è¶³å·¥ç¨‹å¸ˆå¯¹å¿«é€Ÿé«˜æ•ˆå·¥ä½œçš„éœ€æ±‚äº†ã€‚å†å²çš„å‘å±•æ€»æ˜¯å¦‚æ­¤åœ°ç›¸ä¼¼ï¼Œå½“å‘ç°è¯­è¨€æŠ½è±¡å·²ç»æ— æ³•æ»¡è¶³å·¥ä½œæ—¶ï¼Œå·¥ç¨‹å¸ˆä»¬å°±ä¼šåœ¨åŸæœ‰å±‚çš„åŸºç¡€ä¸Šå†æŠ½è±¡å‡ºä¸€å±‚ï¼Œè€Œè¿™ä¸€å±‚çš„è‘—åä½¼ä½¼è€…â€”â€”Cè¯­è¨€ç›´æ¥å¥ å®šäº†ä»Šå¤©è®¡ç®—æœºç³»ç»Ÿçš„åŸºçŸ³ã€‚</p><p>ä»æ­¤ä»¥åï¼Œä¸è®¡å…¶æ•°çš„ç¼–ç¨‹è¯­è¨€èµ°å‘è®¡ç®—æœºçš„èˆå°ï¼Œå®ƒä»¬å¦‚åŒæ»¡å¤©ç¹æ˜Ÿï¼Œå¸å¼•äº†æ— æ•°çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œæ¯”å¦‚è¯´è¿ˆå‘ä¸­å¹´çš„ Java å’Œæ–°ç”Ÿä»£çš„ Juliaã€‚è™½ç„¶å­¦ä¹ è®¡ç®—æœºæœ€æ­£ç¡®çš„é€”å¾„ä¸æ˜¯ä»è¯­è¨€å¼€å§‹ï¼Œä½†å­¦ä¹ ç¼–ç¨‹æœ€å¥½ã€æœ€å®¹æ˜“è·å–æˆå°±æ„Ÿçš„è·¯å¾„ç¡®å®æ˜¯åº”è¯¥ä»è¯­è¨€å…¥æ‰‹ã€‚å› æ­¤ç¼–ç¨‹è¯­è¨€çš„é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œå®ƒæ˜¯æˆ‘ä»¬èµ°å‘ç¼–ç¨‹ä¸–ç•Œçš„å¤§é—¨ã€‚</p><p>C è¯­è¨€æ˜¯ä¸€ç§<strong>å‘½ä»¤å¼ç¼–ç¨‹</strong>è¯­è¨€ï¼Œå‘½ä»¤å¼æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼›ä½¿ç”¨ C å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬æ›´å¤šæ˜¯åœ¨æ€è€ƒå¦‚ä½•æè¿°ç¨‹åºçš„è¿è¡Œï¼Œé€šè¿‡ç¼–ç¨‹è¯­è¨€æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•æ‰§è¡Œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ C è¯­è¨€æ¥ç­›é€‰å‡ºä¸€ä¸ªæ•°ç»„ä¸­å¤§äº 100 çš„æ•°å­—ã€‚å¯¹åº”ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">int main() {&nbsp;\n&nbsp; int arr[5] = { 100, 105, 110, 99, 0 };\n&nbsp; for (int i = 0; i &lt; 5; ++i) {\n&nbsp; &nbsp; if (arr[i] &gt; 100) {\n&nbsp; &nbsp; &nbsp; // do something\n&nbsp; &nbsp; }\n&nbsp; }\n&nbsp; return 0;\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»£ç æ’°å†™è€…éœ€è¦ä½¿ç”¨æ•°ç»„ã€å¾ªç¯ã€åˆ†æ”¯åˆ¤æ–­ç­‰é€»è¾‘æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å»ç­›é€‰æ•°å­—ï¼Œå†™ä»£ç çš„è¿‡ç¨‹å¾€å¾€å°±æ˜¯è®¡ç®—æœºçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>è€Œå¯¹äºå¦ä¸€ç§è¯­è¨€è€Œè¨€ï¼Œæ¯”å¦‚ JavaScriptï¼Œç­›é€‰å‡ºå¤§äº 100 çš„æ•°å­—çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-javascript\">let arr = [ 100, 105, 110, 99, 0 ]\nlet result = arr.filter(n =&gt; n &gt; 100)\n</code></pre><p>ç›¸è¾ƒäº C æ¥è¯´ï¼ŒJavaScript åšå‡ºäº†æ›´åŠ é«˜çº§çš„æŠ½è±¡ï¼Œä»£ç æ’°å†™è€…æ— éœ€å…³å¿ƒæ•°ç»„å®¹é‡ã€æ•°ç»„éå†ï¼Œåªéœ€å°†æ•°å­—ä¸¢è¿›å®¹å™¨é‡Œé¢ï¼Œå¹¶åœ¨åˆé€‚çš„åœ°æ–¹åŠ ä¸Šç­›é€‰å‡½æ•°å³å¯ï¼Œè¿™ç§ç¼–ç¨‹æ–¹å¼è¢«ç§°ä¸º<strong>å£°æ˜å¼ç¼–ç¨‹</strong>ã€‚</p><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œç›¸è¾ƒäºå‘½ä»¤å¼ç¼–ç¨‹ï¼Œå£°æ˜å¼ç¼–ç¨‹æ›´å€¾å‘äºè¡¨è¾¾åœ¨è§£å†³é—®é¢˜æ—¶åº”è¯¥åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯å…·ä½“æ€ä¹ˆåšã€‚è¿™ç§æ›´é«˜çº§çš„æŠ½è±¡ä¸ä»…èƒ½å¤Ÿç»™å¼€å‘è€…å¸¦æ¥æ›´åŠ è‰¯å¥½çš„ä½“éªŒï¼Œä¹Ÿèƒ½è®©æ›´å¤šéä¸“ä¸šäººå£«è¿›å…¥ç¼–ç¨‹è¿™ä¸ªé¢†åŸŸã€‚</p><p>ä¸è¿‡å‘½ä»¤å¼ç¼–ç¨‹å’Œå£°æ˜å¼ç¼–ç¨‹å…¶å®å¹¶æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œä¸»è¦åŒºåˆ«ä½“ç°åœ¨<strong>ä¸¤è€…çš„è¯­è¨€ç‰¹æ€§ç›¸è¾ƒäºè®¡ç®—æœºæŒ‡ä»¤é›†çš„æŠ½è±¡ç¨‹åº¦</strong>ã€‚</p><p>å…¶ä¸­ï¼Œå‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€çš„æŠ½è±¡ç¨‹åº¦æ›´ä½ï¼Œè¿™æ„å‘³ç€è¯¥ç±»è¯­è¨€çš„è¯­æ³•ç»“æ„å¯ä»¥ç›´æ¥ç”±ç›¸åº”çš„æœºå™¨æŒ‡ä»¤æ¥å®ç°ï¼Œé€‚åˆå¯¹æ€§èƒ½æåº¦æ•æ„Ÿçš„åœºæ™¯ã€‚è€Œå£°æ˜å¼ç¼–ç¨‹è¯­è¨€çš„æŠ½è±¡ç¨‹åº¦æ›´é«˜ï¼Œè¿™ç±»è¯­è¨€æ›´å€¾å‘äºä»¥å™äº‹çš„æ–¹å¼æ¥æè¿°ç¨‹åºé€»è¾‘ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒè¯­è¨€èƒŒååœ¨æœºå™¨æŒ‡ä»¤å±‚é¢çš„å®ç°ç»†èŠ‚ï¼Œé€‚åˆäºä¸šåŠ¡å¿«é€Ÿè¿­ä»£çš„åœºæ™¯ã€‚</p><p>ä¸è¿‡è¯­è¨€ä¸æ˜¯ä¸€æˆä¸å˜çš„ã€‚ç¼–ç¨‹è¯­è¨€ä¸€ç›´åœ¨è¿›åŒ–ï¼Œå®ƒçš„è¿›åŒ–é€Ÿåº¦ç»å¯¹è¶…è¿‡äº†è‡ªç„¶è¯­è¨€çš„è¿›åŒ–é€Ÿåº¦ã€‚</p><p>åœ¨æŠ½è±¡å±‚é¢ä¸Šï¼Œç¼–ç¨‹è¯­è¨€ä¸€ç›´éƒ½åœç•™åœ¨æœºå™¨ç  -&gt; æ±‡ç¼– -&gt; é«˜çº§è¯­è¨€è¿™ä¸‰å±‚ä¸Šã€‚è€Œå¯¹äºæˆ‘ä»¬å¹¿å¤§å¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬çš„ç›®å…‰ä¸€ç›´èšç„¦åœ¨é«˜çº§è¯­è¨€è¿™ä¸€å±‚ä¸Šï¼Œæ‰€ä»¥ï¼Œé«˜çº§ç¼–ç¨‹è¯­è¨€ä¹Ÿæ…¢æ…¢æˆä¸ºäº†ç‹­éš˜çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œæ¯ä¸€ç±»äººéƒ½åº”è¯¥å„å¸å…¶èŒåšå¥½è‡ªå·±çš„äº‹æƒ…ï¼Œä¸ç”¨è¿‡å¤šæ‹…å¿ƒæŒ‡ä»¤æ¶æ„ã€æŒ‡ä»¤é›†å·®å¼‚å¸¦æ¥çš„éº»çƒ¦ï¼‰ã€‚</p><p>è°ˆåˆ°è¿™é‡Œï¼Œä¸çŸ¥ä½ æ˜¯å¦å‘ç°äº†ä¸€ä¸ªè§„å¾‹ï¼šæŠ½è±¡è¶Šä½çš„ç¼–ç¨‹è¯­è¨€è¶Šæ¥è¿‘è®¡ç®—æœºæ€ç»´ï¼Œè€ŒæŠ½è±¡è¶Šé«˜è¶Šæ¥è¿‘äººè„‘æ€ç»´ã€‚</p><p>æ˜¯çš„ã€‚<strong>ç°ä»£å±‚å‡ºä¸ç©·çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¾€å¾€éƒ½æ˜¯åœ¨äººè„‘ã€è®¡ç®—æœºæ€ç»´ä¹‹é—´çš„å¹³è¡¡åšå–èˆ</strong>ã€‚é‚£äº›è®¾è®¡è¯­è¨€çš„ä¸“å®¶ä»¬ä¼¼ä¹åœ¨è¿™ä¸ªæ¯«æ— ç¡çƒŸçš„æˆ˜åœºä¸Šåšå¼ˆï¼Œå½¼æ­¤å¯¹ç«‹å´åˆå½¼æ­¤å€Ÿé‰´ã€‚ä¸è¿‡å“ªæ€•å†åšå¼ˆï¼ŒæŒ‰ç…§äººç±»è‡ªç„¶è¯­è¨€çš„è¶‹åŠ¿æ¥çœ‹ï¼Œä¹Ÿå‡ ä¹ä¸å¯èƒ½å‡ºç°ä¸€å®¶ç‹¬å¤§çš„å¯èƒ½ï¼Œå°±åƒäººç±»ç›®å‰ä¹Ÿæ˜¯æ±‰è¯­ã€è‹±è¯­ç­‰å¤šç§è¯­è¨€å…±å­˜ï¼Œå³ä½¿ä¸–ç•Œè¯­äº 1887 å¹´å°±è¢«å‘æ˜ï¼Œä½†æˆ‘ä»¬ä¼¼ä¹ä»æœªè§è¿‡è°è¯´ä¸–ç•Œè¯­ã€‚</p><p>æ—¢ç„¶é«˜çº§ç¼–ç¨‹è¯­è¨€é‚£ä¹ˆå¤šï¼Œå¯¹äºæœ‰é€‰æ‹©å›°éš¾ç—‡çš„æˆ‘ä»¬ï¼Œåˆè¯¥åšå‡ºä½•ç§é€‰æ‹©å‘¢ï¼Ÿ</p><h2>å·¥å…·</h2><p>ä¸€æåˆ°é€‰è¯­è¨€ï¼Œä¼°è®¡ä½ å¸¸å¬è¿™ä¹ˆä¸€å¥è¯ï¼Œè¯­è¨€æ˜¯å·¥å…·ã€‚å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä¹Ÿè¿™ä¹ˆå‘Šè¯«è‡ªå·±ï¼Œæ— æ‰€è°“ä¸€é—¨è¯­è¨€çš„ä¼˜åŠ£ï¼Œå®ƒä»…ä»…åªæ˜¯ä¸€é—¨å·¥å…·ï¼Œè€Œæˆ‘éœ€è¦åšçš„å°±æ˜¯å°†è¿™é—¨å·¥å…·ç”¨å¥½ã€‚è¯­è¨€æ˜¯è¡¨è¾¾æ€æƒ³çš„è½½ä½“ï¼Œåªè¦æœ‰äº†æ€æƒ³ï¼Œæ— è®ºæ˜¯ä½•ç§è¯­è¨€ï¼Œéƒ½èƒ½è¡¨è¾¾ã€‚</p><p>å¯å½“æˆ‘æ¥è§¦äº†è¶Šæ¥è¶Šå¤šçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹ä»£ç ã€æŒ‡ä»¤ã€æŠ½è±¡æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ä¹‹åï¼Œæˆ‘æ¨ç¿»äº†è¿™ä¸ªæƒ³æ³•ï¼Œè®¤è¯†åˆ°äº†â€œè¯­è¨€åªæ˜¯å·¥å…·â€è¿™ä¸ªè¯´æ³•çš„ç‹­éš˜æ€§ã€‚</p><p>ç¼–ç¨‹è¯­è¨€ï¼Œæ˜¾ç„¶ä¸ä»…åªæ˜¯å·¥å…·ï¼Œå®ƒä¸€å®šç¨‹åº¦ä¸Šæ¡æ¢äº†æˆ‘ä»¬çš„æ€ç»´ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨ Java æˆ–è€… C# çš„äººèƒ½å¤Ÿå¾ˆè½»æ˜“åœ°æƒ³åˆ°å¯¹è±¡çš„è®¾è®¡ä¸å°è£…ï¼Œé‚£æ˜¯å› ä¸º Java å’Œ C# å°±æ˜¯ä»¥ç±»ä½œä¸ºåŸºæœ¬çš„ç»„ç»‡å•ä½ï¼Œæ— è®ºä½ æ˜¯å¦æœ‰æ„è¯†åœ°å»åšè¿™ä»¶äº‹ï¼Œä½ éƒ½å·²ç»åšäº†ã€‚è€Œå¯¹äº C å’Œ JavaScript çš„ä½¿ç”¨è€…æ¥è¯´ï¼Œå¤§å®¶ä¼¼ä¹æ›´å€¾å‘äºä½¿ç”¨å‡½æ•°æ¥è¿›è¡Œå°è£…ã€‚</p><p><strong>æŠ›å¼€è¯­è¨€æœ¬èº«çš„ä¼˜åŠ£ï¼Œè¿™æ˜¯ä¸€ç§æ€ç»´çš„æƒ¯æ€§ï¼Œæ°æ°ä¹Ÿå°è¯äº†ä¸Šé¢æˆ‘è°ˆåˆ°çš„ï¼Œè¯­è¨€ä¸€å®šç¨‹åº¦ä¸Šæ¡æ¢äº†æˆ‘ä»¬çš„æ€ç»´</strong>ã€‚å…¶å®å¦‚æœä»äººç±»è¯­è¨€çš„è§’åº¦å‡ºå‘ï¼Œä¸€ä¸ªäººè¯´ä¸­æ–‡å’Œè¯´è‹±æ–‡çš„æ€ç»´æ–¹å¼æ˜¯å¤§ç›¸å¾„åº­çš„ï¼Œç”šè‡³ä¸€ä¸ªäººåˆ†åˆ«è¯´æ–¹è¨€å’Œæ™®é€šè¯ç»™åˆ«äººçš„æ„Ÿè§‰ä¹Ÿåƒæ˜¯ä¸¤ä¸ªäººä¸€æ ·ã€‚</p><h2>Rust</h2><p>æ‰€ä»¥å¦‚æœè¯´æ€ç»´æ˜¯æˆ‘ä»¬åˆ›é€ çš„å‡ºå‘ç‚¹ï¼Œé‚£ä¹ˆç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¡¨è¾¾æ€ç»´çš„åŒæ—¶ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¡æ¢äº†æˆ‘ä»¬çš„æ€ç»´ã€‚èŠåˆ°è¿™é‡Œï¼Œç»ˆäºåˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’â€”â€”Rustè¿™é—¨ç¼–ç¨‹è¯­è¨€å‡ºåœºäº†ã€‚</p><p>Rust æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>Rust æ˜¯ä¸€é—¨é«˜åº¦æŠ½è±¡ã€æ€§èƒ½ä¸å®‰å…¨å¹¶é‡çš„ç°ä»£åŒ–é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚æˆ‘å­¦ä¹ ã€æ¨å´‡å®ƒçš„ä¸»è¦åŸå› æœ‰ä¸‰ç‚¹ï¼š</p><ul>\n<li>é«˜åº¦æŠ½è±¡ã€è¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ”¯æŒå‘½ä»¤å¼ã€å£°æ˜å¼ã€å…ƒç¼–ç¨‹ã€èŒƒå‹ç­‰å¤šç§ç¼–ç¨‹èŒƒå¼ï¼›</li>\n<li>å¼ºå¤§çš„å·¥ç¨‹èƒ½åŠ›ï¼Œå®‰å…¨ä¸æ€§èƒ½å¹¶é‡ï¼›</li>\n<li>è‰¯å¥½çš„åº•å±‚èƒ½åŠ›ï¼Œå¤©ç„¶é€‚åˆå†…æ ¸ã€æ•°æ®åº“ã€ç½‘ç»œã€‚</li>\n</ul><p>Rust å¾ˆå¥½åœ°è¿åˆäº†äººç±»æ€ç»´ï¼Œå¯¹æŒ‡ä»¤é›†è¿›è¡Œäº†é«˜åº¦æŠ½è±¡ï¼ŒæŠ½è±¡åçš„è¡¨è¾¾åŠ›èƒ½è®©æˆ‘ä»¬ä»¥æ›´æ¥è¿‘äººç±»æ€ç»´çš„è§†è§’å»å†™ä»£ç ï¼Œè€Œ Rust è´Ÿè´£å°†æˆ‘ä»¬çš„æ€ç»´ç¿»è¯‘ä¸ºè®¡ç®—æœºè¯­è¨€ï¼Œå¹¶ä¸”æ€§èƒ½å’Œå®‰å…¨å¾—åˆ°äº†æå¤§çš„ä¿è¯ã€‚ç®€å•è¯´å°±æ˜¯ï¼Œå®Œç¾å…¼é¡¾äº†ä¸€é—¨è¯­è¨€çš„æ€æƒ³æ€§å’Œå·¥å…·æ€§ã€‚</p><p>ä»ä»¥å‰é¢â€œé€‰å‡ºä¸€ä¸ªæ•°ç»„ä¸­å¤§äº 100 çš„æ•°å­—â€ä¸ºä¾‹ï¼Œå¦‚æœä½¿ç”¨ Rustï¼Œé‚£ä¹ˆä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-rust\">let arr = vec![ 100, 105, 110, 99, 0 ]\nlet result = arr.iter().filter(n =&gt; n &gt; 100).collect();\n</code></pre><p>å¦‚æ­¤ç®€æ´çš„ä»£ç ä¼šä¸ä¼šå¸¦æ¥æ€§èƒ½æŸè€—ï¼ŒRust çš„ç­”æ¡ˆæ˜¯ä¸ä¼šï¼Œç”šè‡³å¯ä»¥æ¯” C åšåˆ°æ›´å¿«ã€‚</p><p>æˆ‘ä»¬å¯¹åº”çœ‹ä¸‰ä¸ªå°ä¾‹å­çš„å®ç°æ€è·¯/è¦ç‚¹ï¼Œæ¥æ„Ÿå—ä¸€ä¸‹ Rust çš„è¯­è¨€è¡¨è¾¾èƒ½åŠ›ã€å·¥ç¨‹èƒ½åŠ›å’Œåº•å±‚èƒ½åŠ›ã€‚</p><h3>ç®€å•åç¨‹</h3><p>Rust å¯ä»¥æ— ç¼è¡”æ¥åˆ° Cã€æ±‡ç¼–ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·Ÿä¸‹å±‚çš„ç¡¬ä»¶æ‰“äº¤é“ä»è€Œå®ç°åç¨‹ã€‚</p><p>å®ç°ä¹Ÿå¾ˆæ¸…æ™°ã€‚é¦–å…ˆï¼Œå®šä¹‰å‡ºåç¨‹çš„ä¸Šä¸‹æ–‡ï¼š</p><pre><code class=\"language-rust\">#[derive(Debug, Default)]\n#[repr(C)]\nstruct Context {\n   rsp: u64, // rsp å¯„å­˜å™¨\n   r15: u64,\n   r14: u64,\n   r13: u64,\n   r12: u64,\n   rbx: u64,\n   rbp: u64,\n}\n#[naked]\nunsafe fn ctx_switch() {\n   // æ³¨æ„ï¼š16 è¿›åˆ¶\n   llvm_asm!(\n       \"\n       mov     %rsp, 0x00(%rdi)\n       mov     %r15, 0x08(%rdi)\n       mov     %r14, 0x10(%rdi)\n       mov     %r13, 0x18(%rdi)\n       mov     %r12, 0x20(%rdi)\n       mov     %rbx, 0x28(%rdi)\n       mov     %rbp, 0x30(%rdi)\n\n       mov     0x00(%rsi), %rsp\n       mov     0x08(%rsi), %r15\n       mov     0x10(%rsi), %r14\n       mov     0x18(%rsi), %r13\n       mov     0x20(%rsi), %r12\n       mov     0x28(%rsi), %rbx\n       mov     0x30(%rsi), %rbp\n       \"\n   );\n}\n</code></pre><p>ç»“æ„ä½“ Context ä¿å­˜äº†åç¨‹çš„è¿è¡Œä¸Šä¸‹æ–‡ä¿¡æ¯(å¯„å­˜å™¨æ•°æ®)ï¼Œé€šè¿‡å‡½æ•° ctx_switchï¼Œå½“å‰åç¨‹å°±å¯ä»¥äº¤å‡º CPU ä½¿ç”¨æƒï¼Œä¸‹ä¸€ä¸ªåç¨‹æ¥ç®¡ CPU å¹¶è¿›å…¥æ‰§è¡Œæµã€‚</p><p>ç„¶åæˆ‘ä»¬ç»™å‡ºåç¨‹çš„å®šä¹‰ï¼š</p><pre><code class=\"language-rust\">#[derive(Debug)]\nstruct Routine {\n   id: usize,\n   stack: Vec&lt;u8&gt;,\n   state: State,\n   ctx: Context,\n}\n</code></pre><p>åç¨‹ Routine æœ‰è‡ªå·±å”¯ä¸€çš„ idã€æ ˆ stackã€çŠ¶æ€ stateï¼Œä»¥åŠä¸Šä¸‹æ–‡ ctxã€‚Routine é€šè¿‡ spawn å‡½æ•°åˆ›å»ºä¸€ä¸ªå°±ç»ªåç¨‹ï¼Œyield å‡½æ•°ä¼šäº¤å‡º CPU æ‰§è¡Œæƒï¼š</p><pre><code class=\"language-rust\">pub fn spawn(&amp;mut self, f: fn()) {\n     // æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„\n     // let avaliable = ....\n     let sz = avaliable.stack.len();\n     unsafe {\n         let stack_bottom = avaliable.stack.as_mut_ptr().offset(sz as isize); // é«˜åœ°å€å†…å­˜æ˜¯æ ˆé¡¶\n         let stack_aligned = (stack_bottom as usize &amp; !15) as *mut u8;\n         std::ptr::write(stack_aligned.offset(-16) as *mut u64, guard as u64);\n         std::ptr::write(stack_aligned.offset(-24) as *mut u64, hello as u64);\n         std::ptr::write(stack_aligned.offset(-32) as *mut u64, f as u64);\n         avaliable.ctx.rsp = stack_aligned.offset(-32) as u64; // 16 å­—èŠ‚å¯¹é½\n     }\n     avaliable.state = State::Ready;\n }\n\npub fn r#yield(&amp;mut self) -&gt; bool {\n     // æ‰¾åˆ°ä¸€ä¸ª ready çš„ï¼Œç„¶åè®©å…¶è¿è¡Œ\n     let mut pos = self.current;\n     //.....\n     self.routines[pos].state = State::Running;\n     let old_pos = self.current;\n     self.current = pos;\n     unsafe {\n         let old: *mut Context = &amp;mut self.routines[old_pos].ctx;\n         let new: *const Context = &amp;self.routines[pos].ctx;\n         llvm_asm!(\n             \"mov $0, %rdi\n              mov $1, %rsi\"::\"r\"(old), \"r\"(new)\n         );\n         ctx_switch();\n     }\n     self.routines.len() &gt; 0\n }\n</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=\"language-rust\">1 STARTING\nroutine: 1 counter: 0\n2 STARTING\nroutine: 2 counter: 0\nroutine: 1 counter: 1\nroutine: 2 counter: 1\nroutine: 1 counter: 2\nroutine: 2 counter: 2\nroutine: 1 counter: 3\nroutine: 2 counter: 3\nroutine: 1 counter: 4\nroutine: 2 counter: 4\nroutine: 1 counter: 5\nroutine: 2 counter: 5\nroutine: 1 counter: 6\nroutine: 2 counter: 6\nroutine: 1 counter: 7\nroutine: 2 counter: 7\nroutine: 1 counter: 8\nroutine: 2 counter: 8\nroutine: 1 counter: 9\nroutine: 2 counter: 9\n1 FINISHED\n</code></pre><p>å…·ä½“ä»£ç å®ç°å‚è€ƒ<a href=\"https://github.com/PedroGao/rust-examples/blob/main/rsroutine/src/main.rs\">åç¨‹</a> ã€‚</p><h3>ç®€å•å†…æ ¸</h3><p>æ“ä½œç³»ç»Ÿå†…æ ¸æ˜¯ä¸€ä¸ªæä¸ºåºå¤§çš„å·¥ç¨‹ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯å†™ä¸ªç®€å•å†…æ ¸è¾“å‡º Hello Worldï¼Œé‚£ä¹ˆ Rust å°±èƒ½å¾ˆå¿«å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ä½ å¯ä»¥è‡ªå·±ä½“éªŒä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œæ·»åŠ ä¾èµ–å·¥å…·ï¼š</p><pre><code class=\"language-rust\">rustup component add llvm-tools-preview\ncargo install bootimage\n</code></pre><p>ç„¶åç¼–è¾‘ main.rs æ–‡ä»¶è¾“å‡ºä¸€ä¸ª Hello Worldï¼š</p><pre><code class=\"language-rust\">#![no_std]\n#![no_main]\nuse core::panic::PanicInfo;\nstatic HELLO:&amp;[u8] = b\"Hello World!\";\n#[no_mangle]\npub extern \"C\" fn _start() -&gt; ! {\n   let vga_buffer = 0xb8000 as *mut u8;\n   for (i, &amp;byte) in HELLO.iter().enumerate() {\n       unsafe {\n           *vga_buffer.offset(i as isize * 2) = byte;\n           *vga_buffer.offset(i as isize * 2 + 1) = 0xb;\n       }\n   }\n   loop{}\n}\n#[panic_handler]\nfn panic(_info: &amp;PanicInfo) -&gt; ! {\n   loop {}\n}\n</code></pre><p>ç„¶åç¼–è¯‘ã€æ‰“åŒ…è¿è¡Œï¼š</p><pre><code class=\"language-bash\">cargo bootimage\ncargo run\n</code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/4e/40/4e200553acbc604a6456f8629dd30340.png?wh=1512x928\" alt=\"\"></p><p>å…·ä½“ä»£ç å®ç°å‚è€ƒ<a href=\"https://github.com/PedroGao/rust-examples/tree/main/rkernel\">å†…æ ¸</a> ã€‚</p><h3>ç®€å•ç½‘ç»œåè®®æ ˆ</h3><p>åŒæ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œç½‘ç»œåè®®æ ˆä¹Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„å·¥ç¨‹ç³»ç»Ÿã€‚ä½†æ˜¯å€ŸåŠ© Rust å’Œå…¶å®Œå¤‡çš„ç”Ÿæ€ï¼Œæˆ‘ä»¬å¯ä»¥è¿…é€Ÿå®Œæˆä¸€ä¸ªå°å·§çš„ HTTP åè®®æ ˆã€‚</p><p>é¦–å…ˆï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œæˆ‘ä»¬å®šä¹‰ Mac åœ°å€ç»“æ„ä½“ï¼š</p><pre><code class=\"language-rust\">#[derive(Debug)]\npub struct MacAddress([u8; 6]);\n\t\nimpl MacAddress {\n pub fn new() -&gt; MacAddress {\n     let mut octets: [u8; 6] = [0; 6];\n     rand::thread_rng().fill_bytes(&amp;mut octets); // 1. éšæœºç”Ÿæˆ\n     octets[0] |= 0b_0000_0010; // 2\n     octets[1] &amp;= 0b_1111_1110; // 3\n     MacAddress { 0: octets }\n }\n}\n</code></pre><p>MacAddress ç”¨æ¥è¡¨ç¤ºç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œæ­¤å¤„çš„ new å‡½æ•°é€šè¿‡éšæœºæ•°æ¥ç”Ÿæˆéšæœºçš„ç‰©ç†åœ°å€ã€‚</p><p>ç„¶åå®ç° DNS åŸŸåè§£æå‡½æ•°ï¼Œé€šè¿‡ IP åœ°å€è·å– MAC åœ°å€ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class=\"language-rust\">pub fn resolve(\n   dns_server_address: &amp;str,\n   domain_name: &amp;str,\n  ) -&gt; Result&lt;Option&lt;std::net::IpAddr&gt;, Box&lt;dyn Error&gt;&gt; {\n   let domain_name = Name::from_ascii(domain_name).map_err(DnsError::ParseDomainName)?;\n  \n   let dns_server_address = format!(\"{}:53\", dns_server_address);\n   let dns_server: SocketAddr = dns_server_address\n       .parse()\n       .map_err(DnsError::ParseDnsServerAddress)?;\n   // ....\n   let mut encoder = BinEncoder::new(&amp;mut request_buffer);\n   request.emit(&amp;mut encoder).map_err(DnsError::Encoding)?;\n   let _n_bytes_sent = localhost\n       .send_to(&amp;request_buffer, dns_server)\n       .map_err(DnsError::Sending)?;\n   loop {\n       let (_b_bytes_recv, remote_port) = localhost\n           .recv_from(&amp;mut response_buffer)\n           .map_err(DnsError::Receiving)?;\n       if remote_port == dns_server {\n           break;\n       }\n   }\n   let response = Message::from_vec(&amp;response_buffer).map_err(DnsError::Decoding)?;\n   for answer in response.answers() {\n       if answer.record_type() == RecordType::A {\n           let resource = answer.rdata();\n           let server_ip = resource.to_ip_addr().expect(\"invalid IP address received\");\n  \n           return Ok(Some(server_ip));\n       }\n   }\n   Ok(None)\n}\n</code></pre><p>æ¥ç€å®ç° HTTP åè®®çš„ GET æ–¹æ³•ï¼š</p><pre><code class=\"language-rust\">pub fn get(\n   tap: TapInterface,\n   mac: EthernetAddress,\n   addr: IpAddr,\n   url: Url,\n) -&gt; Result&lt;(), UpstreamError&gt; {\n   let domain_name = url.host_str().ok_or(UpstreamError::InvalidUrl)?;\n   let neighbor_cache = NeighborCache::new(BTreeMap::new());\n   // TCP ç¼“å†²åŒº\n   let tcp_rx_buffer = TcpSocketBuffer::new(vec![0; 1024]);\n   let tcp_tx_buffer = TcpSocketBuffer::new(vec![0; 1024]);\n   let tcp_socket = TcpSocket::new(tcp_rx_buffer, tcp_tx_buffer);\n   let ip_addrs = [IpCidr::new(IpAddress::v4(192, 168, 42, 1), 24)];\n   let fd = tap.as_raw_fd();\n   let mut routes = Routes::new(BTreeMap::new());\n   let default_gateway = Ipv4Address::new(192, 168, 42, 100);\n   routes.add_default_ipv4_route(default_gateway).unwrap();\n   let mut iface = EthernetInterfaceBuilder::new(tap)\n       .ethernet_addr(mac)\n       .neighbor_cache(neighbor_cache)\n       .ip_addrs(ip_addrs)\n       .routes(routes)\n       .finalize();\n   let mut sockets = SocketSet::new(vec![]);\n   let tcp_handle = sockets.add(tcp_socket);\n   // HTTP è¯·æ±‚\n   let http_header = format!(\n       \"GET {} HTTP/1.0\\r\\nHost: {}\\r\\nConnection: close\\r\\n\\r\\n\",\n       url.path(),\n       domain_name,\n   );\n   let mut state = HttpState::Connect;\n   'http: loop {\n       let timestamp = Instant::now();\n       match iface.poll(&amp;mut sockets, timestamp) {\n           Ok(_) =&gt; {}\n           Err(smoltcp::Error::Unrecognized) =&gt; {}\n           Err(e) =&gt; {\n               eprintln!(\"error: {:?}\", e);\n           }\n       }\n       {\n           let mut socket = sockets.get::&lt;TcpSocket&gt;(tcp_handle);\n           state = match state {\n               HttpState::Connect if !socket.is_active() =&gt; {\n                   eprintln!(\"connecting\");\n                   socket.connect((addr, 80), random_port())?;\n                   HttpState::Request\n               }\n               HttpState::Request if socket.may_send() =&gt; {\n                   eprintln!(\"sending request\");\n                   socket.send_slice(http_header.as_ref())?;\n                   HttpState::Response\n               }\n               HttpState::Response if socket.can_recv() =&gt; {\n                   socket.recv(|raw_data| {\n                       let output = String::from_utf8_lossy(raw_data);\n                       println!(\"{}\", output);\n                       (raw_data.len(), ())\n                   })?;\n                   HttpState::Response\n               }\n               HttpState::Response if !socket.may_recv() =&gt; {\n                   eprintln!(\"received complete response\");\n                   break 'http;\n               }\n               _ =&gt; state,\n           }\n       }\n       phy_wait(fd, iface.poll_delay(&amp;sockets, timestamp)).expect(\"wait error\");\n   }\n   Ok(())\n}\n</code></pre><p>æœ€ååœ¨ main å‡½æ•°ä¸­ä½¿ç”¨ HTTP GET æ–¹æ³•ï¼š</p><pre><code class=\"language-rust\">fn main() {\n   // ...\n   let tap = TapInterface::new(&amp;tap_text).expect(\n       \"error: unable to use &lt;tap-device&gt; as a \\\n   network interface\",\n   );\n   let domain_name = url.host_str().expect(\"domain name required\");\n   let _dns_server: std::net::Ipv4Addr = dns_server_text.parse().expect(\n       \"error: unable to parse &lt;dns-server&gt; as an \\\n        IPv4 address\",\n   );\n   let addr = dns::resolve(dns_server_text, domain_name).unwrap().unwrap();\n   let mac = ethernet::MacAddress::new().into();\n   http::get(tap, mac, addr, url).unwrap();\n}\n</code></pre><p>è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=\"language-powershell\">$ ./target/debug/rget http://www.baidu.com tap-rust\n\nHTTP/1.0 200 OK\nAccept-Ranges: bytes\nCache-Control: no-cache\nContent-Length: 9508\nContent-Type: text/html\n</code></pre><p>å…·ä½“ä»£ç å®ç°å‚è€ƒ<a href=\"https://github.com/PedroGao/rust-examples/tree/main/rget\">åè®®æ ˆ</a> ã€‚</p><p>é€šè¿‡è¿™ä¸‰ä¸ªç®€å•çš„å°ä¾‹å­ï¼Œæ— è®ºæ˜¯åç¨‹ã€å†…æ ¸è¿˜æ˜¯åè®®æ ˆï¼Œè¿™äº›å¬ä¸Šå»éƒ½å¾ˆé«˜å¤§ä¸Šçš„æŠ€æœ¯ï¼Œåœ¨ Rust å¼ºå¤§çš„è¡¨ç°åŠ›ã€ç”Ÿæ€å’Œåº•å±‚èƒ½åŠ›é¢å‰æ˜¾å¾—å¦‚æ­¤ç®€å•å’Œæ–¹ä¾¿ã€‚</p><p>æ€ç»´æ˜¯å‡ºå‘ç‚¹ï¼Œè¯­è¨€æ˜¯è¡¨è¾¾ä½“ï¼Œå·¥å…·æ˜¯åª’ä»‹ï¼Œè€Œ Rust å®Œç¾å…¼é¡¾äº†ä¸€é—¨è¯­è¨€çš„æ€æƒ³æ€§å’Œå·¥å…·æ€§ï¼Œèµ‹äºˆäº†æˆ‘ä»¬æå¼ºçš„å·¥ç¨‹è¡¨è¾¾èƒ½åŠ›å’Œå®Œæˆèƒ½åŠ›ã€‚</p><h2>æ€»ç»“</h2><p>ä½œä¸ºæå…¶ç°ä»£çš„è¯­è¨€ï¼ŒRust é›†ç™¾å®¶ä¹‹é•¿è€Œæˆï¼Œå°†æ€§èƒ½ã€å®‰å…¨ã€è¯­è¨€è¡¨è¾¾åŠ›éƒ½åšåˆ°äº†æè‡´ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†å·¨å¤§çš„å­¦ä¹ æ›²çº¿ã€‚</p><p>åˆå­¦æ—¶ï¼Œæ¯å¤©éƒ½è¦å’Œç¼–è¯‘å™¨åšæ–—äº‰ï¼Œæ¯æ¬¡ç¼–è¯‘éƒ½æ˜¯æ»¡å±çš„é”™è¯¯ä¿¡æ¯ï¼›æ”»å…‹ä¸€ä¸ªé™¡å¡åï¼Œå‘ç°åé¢æœ‰æ›´å¤§çš„é™¡å¡ï¼Œå­¦ä¹ çš„é“è·¯ä¼¼ä¹æ— ç©·æ— å°½ã€‚é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹  Rust ï¼Ÿ</p><p>è¿™é‡Œå¼•ç”¨å·¦è€³æœµè€—å­çš„ä¸€å¥è¯ï¼š</p><blockquote>\n<p>å¦‚æœä½ å¯¹ Rust çš„æ¦‚å¿µè®¤è¯†å¾—ä¸å®Œæ•´ï¼Œä½ å®Œå…¨å†™ä¸å‡ºç¨‹åºï¼Œé‚£æ€•å°±æ˜¯å¾ˆç®€å•çš„ä¸€æ®µä»£ç ã€‚è¿™é€¼ç€ç¨‹åºå‘˜å¿…é¡»äº†è§£æ‰€æœ‰çš„æ¦‚å¿µæ‰èƒ½ç¼–ç ã€‚</p>\n</blockquote><p>Rust æ˜¯ä¸€ä¸ªå¯¹å¼€å‘è€…æå…¶ä¸¥æ ¼çš„è¯­è¨€ï¼Œä¸¥æ ¼åˆ°ä½ å­¦çš„ä¸æ‰å®ï¼Œå°±ä¸èƒ½å†™ç¨‹åºï¼Œ<strong>ä½†è¿™æ— ç–‘ä¹Ÿæ˜¯ä¸€ä¸ªå·¨å¤§çš„æœºä¼šï¼Œæ”¹æ‰ä½ ä¸å¥½çš„ç¼–ç ä¹ æƒ¯ï¼Œé”»ç‚¼ä½ çš„æ€ç»´ï¼Œè®©ä½ æˆä¸ºçœŸæ­£çš„å¤§å¸ˆ</strong>ã€‚</p><p>èŠåˆ°è¿™é‡Œï¼Œä½ æ˜¯å¦å·²ç»å¯¹ Rust æœ‰äº†æ›´æ·±çš„è®¤è¯†å’Œæ›´å¤šçš„æ¿€æƒ…ï¼Œé‚£ä¹ˆæ”¾æ‰‹å»åšå§ï¼æœŸå¾…ä½ ä¸ Rust æ“¦å‡ºæ›´åŠ æ˜äº®çš„ç«èŠ±ï¼</p><h3>å‚è€ƒèµ„æ–™</h3><ol>\n<li><a href=\"https://os.phil-opp.com/\">Writing an OS in Rust</a></li>\n<li><a href=\"https://cfsamson.gitbook.io/green-threads-explained-in-200-lines-of-rust\">green-threads-explained-in-200-lines-of-rust</a></li>\n<li><a href=\"https://github.com/PedroGao/rust-examples\">https://github.com/PedroGao/rust-examples</a></li>\n<li>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</li>\n<li>ã€ŠRust in Actionã€‹</li>\n<li>ã€Šç¡…è°·æ¥ä¿¡ã€‹</li>\n<li>ã€Šæµªæ½®ä¹‹å·…ã€‹</li>\n</ol>","neighbors":{"left":{"article_title":"å¤§å’–åŠ©åœºï½œå¼€æ‚Ÿä¹‹å¡ï¼ˆä¸‹ï¼‰ï¼šRustçš„ç°çŠ¶ã€æœºé‡ä¸æŒ‘æˆ˜","id":468948},"right":{"article_title":"åŠ é¤ï½œä»£ç å³æ•°æ®ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å®ç¼–ç¨‹èƒ½åŠ›ï¼Ÿ","id":481355}},"comments":[{"had_liked":false,"id":327868,"user_name":"å®‰è¿ª","can_delete":false,"product_type":"c1","uid":1023085,"ip_address":"","ucode":"BC23EA989E0A4C","user_header":"","comment_is_top":false,"comment_ctime":1640334183,"is_pvip":true,"replies":[{"id":"120785","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1642309882,"ip_address":"","comment_id":327868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5935301479","product_id":100085301,"comment_content":"è°¢è°¢åˆ†äº«ï¼<br>è¯´åˆ°è®¡ç®—æœºæ€ç»´ï¼Œæœ€è¿‘æ­£åœ¨çœ‹å´å†›è€å¸ˆçš„ã€Šè®¡ç®—ä¹‹é­‚ã€‹è¿™æœ¬ä¹¦ï¼Œä¹¦ä¸­é‡ç‚¹è®²è§£äº†å¦‚ä½•å¡‘é€ è®¡ç®—æœºæ€ç»´ã€‚","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546424,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642309883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343405,"user_name":"è€å®äººHoney","can_delete":false,"product_type":"c1","uid":1080653,"ip_address":"","ucode":"EA4AB5C0C33090","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/4d/d98865b2.jpg","comment_is_top":false,"comment_ctime":1650818335,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650818335","product_id":100085301,"comment_content":"æ„Ÿè°¢åˆ†äº«","like_count":0},{"had_liked":false,"id":327783,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1640306516,"is_pvip":false,"replies":[{"id":"120788","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1642309985,"ip_address":"","comment_id":327783,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1640306516","product_id":100085301,"comment_content":"å†™çš„éå¸¸ç²¾å½©ï¼Œæ„Ÿè°¢åˆ†äº«","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546428,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642309985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}