{"id":186419,"title":"39 | 高级集群设计：全球多写","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":201386,"user_name":"jone","can_delete":false,"product_type":"c3","uid":1318619,"ip_address":"","ucode":"00D0C54BE1005C","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/db/921367d6.jpg","comment_is_top":false,"comment_ctime":1585759572,"is_pvip":false,"replies":[{"id":75805,"content":"这个tag 范围必须是在片健上做。按你的提议，片健就必须是 {locationCode:1}。 这个片健就完全不合适，你所有的数据一共就只有几个片（几个location 就几个片），典型的基数太大，jumbo chunk问题。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586081045,"ip_address":"","comment_id":201386,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，咨询一个小问题，\nsh.addTagRange(&quot;crm.orders&quot;, {&quot;locationCode&quot;:&quot;CN&quot;,&quot;order_id&quot;:MinKey},\n{{&quot;locationCode&quot;:&quot;CN&quot;,&quot;order_id&quot;:MaxKey}},&quot;ASIA&quot; );\n为什么不直接用：\nsh.addTagRange(&quot;crm.orders&quot;, {&quot;locationCode&quot;:&quot;CN&quot;},\n{{&quot;locationCode&quot;:&quot;CN&quot;}},&quot;ASIA&quot; ); \n去掉order_id呢。\n\n另外一个小问题，原来可能有业务直接通过order_id进行获取订单信息，但是现在是通过了mongos，如果find里面没有locationCode，会去俩个分片去查询数据进行汇总，那老师，建议在find里面额外加上locationCode进行查询么，比如：\ndb.order.find({&quot;order_id&quot;:1,&quot;locationCode&quot;:&quot;CN&quot;});  &lt;业务可能会通过请求者的ip之类的来确定locationCode&gt;","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490319,"discussion_content":"这个tag 范围必须是在片健上做。按你的提议，片健就必须是 {locationCode:1}。 这个片健就完全不合适，你所有的数据一共就只有几个片（几个location 就几个片），典型的基数太大，jumbo chunk问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586081045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1241430,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/f4lPZg0qXT2FJvgmfiapD2R97e5TERdkibUBPpSM2dLoRY1xg2hCcE8rULmutkzFcWH5kibmRFicrZvzq1pp2lO7oQ/132","nickname":"周幕辰","note":"","ucode":"904D82C48C970F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639697,"discussion_content":"其实单独用locationCode 也要最小值，最大值，否则会报错。可是地域怎么能有最小值最大值呢，邮编，年龄，这些还可能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710846025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2714469,"avatar":"","nickname":"小贱贱","note":"","ucode":"436BD03904BEE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540857,"discussion_content":"老师 是不是之后所有的查询都要带上locationCode字段了，不带的话是不是要查询所有分片了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640184537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183315,"user_name":"趁早","can_delete":false,"product_type":"c3","uid":1031970,"ip_address":"","ucode":"949FB3AA250D80","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg","comment_is_top":false,"comment_ctime":1582992965,"is_pvip":false,"replies":[{"id":70935,"content":"中美之间网络延迟会很长， 直接读中国，用户体验无法得到保证。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1583027771,"ip_address":"","comment_id":183315,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"中国和美国各部署一套复制集  和 老师说的全球多写方式有什么不同？ 如果美国客户需要读取中国数据，那就读中国的复制集就好了呀","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485650,"discussion_content":"中美之间网络延迟会很长， 直接读中国，用户体验无法得到保证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583027771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284900,"avatar":"https://static001.geekbang.org/account/avatar/00/13/9b/24/a131714e.jpg","nickname":"Alvin","note":"","ucode":"8CF85DA34B3CEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383992,"discussion_content":"老师你好！趁早的意思是，美国有中国的从库。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626330620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223092,"user_name":"小佳","can_delete":false,"product_type":"c3","uid":1965492,"ip_address":"","ucode":"5F2F4966805B04","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fd/b4/5fe7bcc1.jpg","comment_is_top":false,"comment_ctime":1590999873,"is_pvip":false,"replies":[{"id":82554,"content":"谢谢你的细心！我会让极客时间修正视频","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1591324297,"ip_address":"","comment_id":223092,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"\n唐老师，感谢您的视屏教程，性价比和质量都非常高。而且讲课方式让人听了很舒服。\n另外有个问题哈，第39讲MongoDB Zone Sharding工作原理的ppt，\n右下角的“Shard 0 Primary tag:AMERICA”应该是“Shard 1”吧？ 我听老师念的是“Shard 1”","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497007,"discussion_content":"谢谢你的细心！我会让极客时间修正视频","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591324297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181206,"user_name":"不愿透露国籍的四川人","can_delete":false,"product_type":"c3","uid":1355947,"ip_address":"","ucode":"BA356BADD5EA99","user_header":"https://static001.geekbang.org/account/avatar/00/14/b0/ab/3492016c.jpg","comment_is_top":false,"comment_ctime":1582516919,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师好，请问全球多写模式下，不同地区，使用多个分片情况下，该如何配置打标签？","like_count":1},{"had_liked":false,"id":296362,"user_name":"A荔枝味","can_delete":false,"product_type":"c3","uid":1801154,"ip_address":"","ucode":"E7A186AE0D1570","user_header":"https://static001.geekbang.org/account/avatar/00/1b/7b/c2/1d0957f6.jpg","comment_is_top":false,"comment_ctime":1622940793,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"我是做物联网平台的 现在数据存储是按设备id作为集合名称来存储数据的 有什么部署方案","like_count":0}]}