{"id":84003,"title":"44 | å¥—è·¯ç¯‡ï¼šç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å­¦äº†ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ€è·¯ï¼Œæˆ‘å…ˆå¸¦ä½ ç®€å•å¤ä¹ ä¸€ä¸‹ã€‚</p><p>åœ¨ä¼˜åŒ–ç½‘ç»œçš„æ€§èƒ½æ—¶ï¼Œä½ å¯ä»¥ç»“åˆ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹ï¼Œç„¶åä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å†åˆ°é“¾è·¯å±‚ç­‰æ¯ä¸ªå±‚æ¬¡ï¼Œè¿›è¡Œé€å±‚ä¼˜åŒ–ã€‚ä¸Šä¸€æœŸæˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†åº”ç”¨ç¨‹åºå’Œå¥—æ¥å­—çš„ä¼˜åŒ–æ€è·¯ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>\n<p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä¸»è¦ä¼˜åŒ– I/O æ¨¡å‹ã€å·¥ä½œæ¨¡å‹ä»¥åŠåº”ç”¨å±‚çš„ç½‘ç»œåè®®ï¼›</p>\n</li>\n<li>\n<p>åœ¨å¥—æ¥å­—å±‚ä¸­ï¼Œä¸»è¦ä¼˜åŒ–å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ã€‚</p>\n</li>\n</ul><p>ä»Šå¤©ï¼Œæˆ‘ä»¬é¡ºç€ TCP/IP ç½‘ç»œæ¨¡å‹ï¼Œç»§ç»­å‘ä¸‹ï¼Œçœ‹çœ‹å¦‚ä½•ä»ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ä»¥åŠé“¾è·¯å±‚ä¸­ï¼Œä¼˜åŒ– Linux ç½‘ç»œæ€§èƒ½ã€‚</p><h2>ç½‘ç»œæ€§èƒ½ä¼˜åŒ–</h2><h3>ä¼ è¾“å±‚</h3><p>ä¼ è¾“å±‚æœ€é‡è¦çš„æ˜¯ TCP å’Œ UDP åè®®ï¼Œæ‰€ä»¥è¿™å„¿çš„ä¼˜åŒ–ï¼Œå…¶å®ä¸»è¦å°±æ˜¯å¯¹è¿™ä¸¤ç§åè®®çš„ä¼˜åŒ–ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹TCPåè®®çš„ä¼˜åŒ–ã€‚</p><p>TCP æä¾›äº†é¢å‘è¿æ¥çš„å¯é ä¼ è¾“æœåŠ¡ã€‚è¦ä¼˜åŒ– TCPï¼Œæˆ‘ä»¬é¦–å…ˆè¦æŒæ¡ TCP åè®®çš„åŸºæœ¬åŸç†ï¼Œæ¯”å¦‚æµé‡æ§åˆ¶ã€æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å»¶è¿Ÿç¡®è®¤ä»¥åŠçŠ¶æ€æµå›¾ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ç­‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c0/d1/c072bb9c9dfd727ed187bc24beb3e3d1.png?wh=1920*1447\" alt=\"\"></p><p>å…³äºè¿™äº›åŸç†çš„ç»†èŠ‚ï¼Œæˆ‘å°±ä¸å†å±•å¼€è®²è§£äº†ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡ï¼Œå»ºè®®ä½ å…ˆå­¦å®Œè¿™äº›åŸºæœ¬åŸç†åå†æ¥ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯å›«å›µåæ£åœ°ä¹±æŠ„ä¹±è¯•ã€‚</p><p>æŒæ¡è¿™äº›åŸç†åï¼Œä½ å°±å¯ä»¥åœ¨ä¸ç ´å TCP æ­£å¸¸å·¥ä½œçš„åŸºç¡€ä¸Šï¼Œå¯¹å®ƒè¿›è¡Œä¼˜åŒ–ã€‚ä¸‹é¢ï¼Œæˆ‘åˆ†å‡ ç±»æƒ…å†µè¯¦ç»†è¯´æ˜ã€‚</p><!-- [[[read_end]]] --><p>ç¬¬ä¸€ç±»ï¼Œåœ¨è¯·æ±‚æ•°æ¯”è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¤§é‡å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥ï¼Œå®ƒä»¬ä¼šå ç”¨å¤§é‡å†…å­˜å’Œç«¯å£èµ„æºã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–ä¸ TIME_WAIT çŠ¶æ€ç›¸å…³çš„å†…æ ¸é€‰é¡¹ï¼Œæ¯”å¦‚é‡‡å–ä¸‹é¢å‡ ç§æªæ–½ã€‚</p><ul>\n<li>\n<p>å¢å¤§å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥æ•°é‡ net.ipv4.tcp_max_tw_buckets ï¼Œå¹¶å¢å¤§è¿æ¥è·Ÿè¸ªè¡¨çš„å¤§å° net.netfilter.nf_conntrack_maxã€‚</p>\n</li>\n<li>\n<p>å‡å° net.ipv4.tcp_fin_timeout å’Œ net.netfilter.nf_conntrack_tcp_timeout_time_wait ï¼Œè®©ç³»ç»Ÿå°½å¿«é‡Šæ”¾å®ƒä»¬æ‰€å ç”¨çš„èµ„æºã€‚</p>\n</li>\n<li>\n<p>å¼€å¯ç«¯å£å¤ç”¨ net.ipv4.tcp_tw_reuseã€‚è¿™æ ·ï¼Œè¢« TIME_WAIT çŠ¶æ€å ç”¨çš„ç«¯å£ï¼Œè¿˜èƒ½ç”¨åˆ°æ–°å»ºçš„è¿æ¥ä¸­ã€‚</p>\n</li>\n<li>\n<p>å¢å¤§æœ¬åœ°ç«¯å£çš„èŒƒå›´ net.ipv4.ip_local_port_range ã€‚è¿™æ ·å°±å¯ä»¥æ”¯æŒæ›´å¤šè¿æ¥ï¼Œæé«˜æ•´ä½“çš„å¹¶å‘èƒ½åŠ›ã€‚</p>\n</li>\n<li>\n<p>å¢åŠ æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨ fs.nr_open å’Œ fs.file-max ï¼Œåˆ†åˆ«å¢å¤§è¿›ç¨‹å’Œç³»ç»Ÿçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼›æˆ–åœ¨åº”ç”¨ç¨‹åºçš„ systemd é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½® LimitNOFILE ï¼Œè®¾ç½®åº”ç”¨ç¨‹åºçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ã€‚</p>\n</li>\n</ul><p>ç¬¬äºŒç±»ï¼Œä¸ºäº†ç¼“è§£ SYN FLOOD ç­‰ï¼Œåˆ©ç”¨ TCP åè®®ç‰¹ç‚¹è¿›è¡Œæ”»å‡»è€Œå¼•å‘çš„æ€§èƒ½é—®é¢˜ï¼Œä½ å¯ä»¥è€ƒè™‘ä¼˜åŒ–ä¸ SYN çŠ¶æ€ç›¸å…³çš„å†…æ ¸é€‰é¡¹ï¼Œæ¯”å¦‚é‡‡å–ä¸‹é¢å‡ ç§æªæ–½ã€‚</p><ul>\n<li>\n<p>å¢å¤§ TCP åŠè¿æ¥çš„æœ€å¤§æ•°é‡ net.ipv4.tcp_max_syn_backlog ï¼Œæˆ–è€…å¼€å¯ TCP SYN Cookies net.ipv4.tcp_syncookies ï¼Œæ¥ç»•å¼€åŠè¿æ¥æ•°é‡é™åˆ¶çš„é—®é¢˜ï¼ˆæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªé€‰é¡¹ä¸å¯åŒæ—¶ä½¿ç”¨ï¼‰ã€‚</p>\n</li>\n<li>\n<p>å‡å°‘ SYN_RECV çŠ¶æ€çš„è¿æ¥é‡ä¼  SYN+ACK åŒ…çš„æ¬¡æ•° net.ipv4.tcp_synack_retriesã€‚</p>\n</li>\n</ul><p>ç¬¬ä¸‰ç±»ï¼Œåœ¨é•¿è¿æ¥çš„åœºæ™¯ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ Keepalive æ¥æ£€æµ‹ TCP è¿æ¥çš„çŠ¶æ€ï¼Œä»¥ä¾¿å¯¹ç«¯è¿æ¥æ–­å¼€åï¼Œå¯ä»¥è‡ªåŠ¨å›æ”¶ã€‚ä½†æ˜¯ï¼Œç³»ç»Ÿé»˜è®¤çš„ Keepalive æ¢æµ‹é—´éš”å’Œé‡è¯•æ¬¡æ•°ï¼Œä¸€èˆ¬éƒ½æ— æ³•æ»¡è¶³åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¦æ±‚ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¼˜åŒ–ä¸ Keepalive ç›¸å…³çš„å†…æ ¸é€‰é¡¹ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>\n<p>ç¼©çŸ­æœ€åä¸€æ¬¡æ•°æ®åŒ…åˆ° Keepalive æ¢æµ‹åŒ…çš„é—´éš”æ—¶é—´ net.ipv4.tcp_keepalive_timeï¼›</p>\n</li>\n<li>\n<p>ç¼©çŸ­å‘é€ Keepalive æ¢æµ‹åŒ…çš„é—´éš”æ—¶é—´ net.ipv4.tcp_keepalive_intvlï¼›</p>\n</li>\n<li>\n<p>å‡å°‘Keepalive æ¢æµ‹å¤±è´¥åï¼Œä¸€ç›´åˆ°é€šçŸ¥åº”ç”¨ç¨‹åºå‰çš„é‡è¯•æ¬¡æ•° net.ipv4.tcp_keepalive_probesã€‚</p>\n</li>\n</ul><p>è®²äº†è¿™ä¹ˆå¤šTCP ä¼˜åŒ–æ–¹æ³•ï¼Œæˆ‘ä¹ŸæŠŠå®ƒä»¬æ•´ç†æˆäº†ä¸€ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿ä½ åœ¨éœ€è¦æ—¶å‚è€ƒï¼ˆæ•°å€¼ä»…ä¾›å‚è€ƒï¼Œå…·ä½“é…ç½®è¿˜è¦ç»“åˆä½ çš„å®é™…åœºæ™¯æ¥è°ƒæ•´ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/e0/b07ea76a8737ed93395736795ede44e0.png?wh=1664*2147\" alt=\"\"></p><p>ä¼˜åŒ– TCP æ€§èƒ½æ—¶ï¼Œä½ è¿˜è¦æ³¨æ„ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨ä¸åŒä¼˜åŒ–æ–¹æ³•ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªã€‚</p><p>æ¯”å¦‚ï¼Œå°±åƒç½‘ç»œè¯·æ±‚å»¶è¿Ÿçš„æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ›¾ç»åˆ†æè¿‡çš„ï¼ŒæœåŠ¡å™¨ç«¯å¼€å¯ Nagle ç®—æ³•ï¼Œè€Œå®¢æˆ·ç«¯å¼€å¯å»¶è¿Ÿç¡®è®¤æœºåˆ¶ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´ç½‘ç»œå»¶è¿Ÿå¢å¤§ã€‚</p><p>å¦å¤–ï¼Œåœ¨ä½¿ç”¨  NAT çš„æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœå¼€å¯ net.ipv4.tcp_tw_recycle ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´å„ç§è¿æ¥å¤±è´¥ã€‚å®é™…ä¸Šï¼Œç”±äºå‘å¤ªå¤šï¼Œè¿™ä¸ªé€‰é¡¹åœ¨å†…æ ¸çš„ 4.1 ç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤äº†ã€‚</p><p>è¯´å®ŒTCPï¼Œæˆ‘ä»¬å†æ¥çœ‹ UDP çš„ä¼˜åŒ–ã€‚</p><p>UDP æä¾›äº†é¢å‘æ•°æ®æŠ¥çš„ç½‘ç»œåè®®ï¼Œå®ƒä¸éœ€è¦ç½‘ç»œè¿æ¥ï¼Œä¹Ÿä¸æä¾›å¯é æ€§ä¿éšœã€‚æ‰€ä»¥ï¼ŒUDP ä¼˜åŒ–ï¼Œç›¸å¯¹äº TCP æ¥è¯´ï¼Œè¦ç®€å•å¾—å¤šã€‚è¿™é‡Œæˆ‘ä¹Ÿæ€»ç»“äº†å¸¸è§çš„å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆã€‚</p><ul>\n<li>\n<p>è·Ÿä¸Šç¯‡å¥—æ¥å­—éƒ¨åˆ†æåˆ°çš„ä¸€æ ·ï¼Œå¢å¤§å¥—æ¥å­—ç¼“å†²åŒºå¤§å°ä»¥åŠ UDP ç¼“å†²åŒºèŒƒå›´ï¼›</p>\n</li>\n<li>\n<p>è·Ÿå‰é¢ TCP éƒ¨åˆ†æåˆ°çš„ä¸€æ ·ï¼Œå¢å¤§æœ¬åœ°ç«¯å£å·çš„èŒƒå›´ï¼›</p>\n</li>\n<li>\n<p>æ ¹æ® MTU å¤§å°ï¼Œè°ƒæ•´ UDP æ•°æ®åŒ…çš„å¤§å°ï¼Œå‡å°‘æˆ–è€…é¿å…åˆ†ç‰‡çš„å‘ç”Ÿã€‚</p>\n</li>\n</ul><h3>ç½‘ç»œå±‚</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ç½‘ç»œå±‚çš„ä¼˜åŒ–ã€‚</p><p>ç½‘ç»œå±‚ï¼Œè´Ÿè´£ç½‘ç»œåŒ…çš„å°è£…ã€å¯»å€å’Œè·¯ç”±ï¼ŒåŒ…æ‹¬ IPã€ICMP ç­‰å¸¸è§åè®®ã€‚åœ¨ç½‘ç»œå±‚ï¼Œæœ€ä¸»è¦çš„ä¼˜åŒ–ï¼Œå…¶å®å°±æ˜¯å¯¹è·¯ç”±ã€ IP åˆ†ç‰‡ä»¥åŠ ICMP ç­‰è¿›è¡Œè°ƒä¼˜ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œä»è·¯ç”±å’Œè½¬å‘çš„è§’åº¦å‡ºå‘ï¼Œä½ å¯ä»¥è°ƒæ•´ä¸‹é¢çš„å†…æ ¸é€‰é¡¹ã€‚</p><ul>\n<li>\n<p>åœ¨éœ€è¦è½¬å‘çš„æœåŠ¡å™¨ä¸­ï¼Œæ¯”å¦‚ç”¨ä½œ NAT ç½‘å…³çš„æœåŠ¡å™¨æˆ–è€…ä½¿ç”¨ Docker å®¹å™¨æ—¶ï¼Œå¼€å¯ IP è½¬å‘ï¼Œå³è®¾ç½® net.ipv4.ip_forward = 1ã€‚</p>\n</li>\n<li>\n<p>è°ƒæ•´æ•°æ®åŒ…çš„ç”Ÿå­˜å‘¨æœŸ TTLï¼Œæ¯”å¦‚è®¾ç½® net.ipv4.ip_default_ttl = 64ã€‚æ³¨æ„ï¼Œå¢å¤§è¯¥å€¼ä¼šé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</p>\n</li>\n<li>\n<p>å¼€å¯æ•°æ®åŒ…çš„åå‘åœ°å€æ ¡éªŒï¼Œæ¯”å¦‚è®¾ç½® net.ipv4.conf.eth0.rp_filter = 1ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢ IP æ¬ºéª—ï¼Œå¹¶å‡å°‘ä¼ªé€  IP å¸¦æ¥çš„ DDoS é—®é¢˜ã€‚</p>\n</li>\n</ul><p>ç¬¬äºŒç§ï¼Œä»åˆ†ç‰‡çš„è§’åº¦å‡ºå‘ï¼Œæœ€ä¸»è¦çš„æ˜¯è°ƒæ•´ MTUï¼ˆMaximum Transmission Unitï¼‰çš„å¤§å°ã€‚</p><p>é€šå¸¸ï¼ŒMTU çš„å¤§å°åº”è¯¥æ ¹æ®ä»¥å¤ªç½‘çš„æ ‡å‡†æ¥è®¾ç½®ã€‚ä»¥å¤ªç½‘æ ‡å‡†è§„å®šï¼Œä¸€ä¸ªç½‘ç»œå¸§æœ€å¤§ä¸º 1518Bï¼Œé‚£ä¹ˆå»æ‰ä»¥å¤ªç½‘å¤´éƒ¨çš„ 18B åï¼Œå‰©ä½™çš„ 1500 å°±æ˜¯ä»¥å¤ªç½‘ MTU çš„å¤§å°ã€‚</p><p>åœ¨ä½¿ç”¨ VXLANã€GRE ç­‰å åŠ ç½‘ç»œæŠ€æœ¯æ—¶ï¼Œè¦æ³¨æ„ï¼Œç½‘ç»œå åŠ ä¼šä½¿åŸæ¥çš„ç½‘ç»œåŒ…å˜å¤§ï¼Œå¯¼è‡´ MTU ä¹Ÿéœ€è¦è°ƒæ•´ã€‚</p><p>æ¯”å¦‚ï¼Œå°±ä»¥ VXLAN ä¸ºä¾‹ï¼Œå®ƒåœ¨åŸæ¥æŠ¥æ–‡çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº† 14B çš„ä»¥å¤ªç½‘å¤´éƒ¨ã€ 8B çš„ VXLAN å¤´éƒ¨ã€8B çš„ UDP å¤´éƒ¨ä»¥åŠ 20B çš„ IP å¤´éƒ¨ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªåŒ…æ¯”åŸæ¥å¢å¤§äº† 50Bã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠäº¤æ¢æœºã€è·¯ç”±å™¨ç­‰çš„ MTUï¼Œå¢å¤§åˆ° 1550ï¼Œ æˆ–è€…æŠŠ VXLAN å°åŒ…å‰ï¼ˆæ¯”å¦‚è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„è™šæ‹Ÿç½‘å¡ï¼‰çš„ MTU å‡å°ä¸º 1450ã€‚</p><p>å¦å¤–ï¼Œç°åœ¨å¾ˆå¤šç½‘ç»œè®¾å¤‡éƒ½æ”¯æŒå·¨å¸§ï¼Œå¦‚æœæ˜¯è¿™ç§ç¯å¢ƒï¼Œä½ è¿˜å¯ä»¥æŠŠ MTU è°ƒå¤§ä¸º 9000ï¼Œä»¥æé«˜ç½‘ç»œååé‡ã€‚</p><p>ç¬¬ä¸‰ç§ï¼Œä» ICMP çš„è§’åº¦å‡ºå‘ï¼Œä¸ºäº†é¿å… ICMP ä¸»æœºæ¢æµ‹ã€ICMP Flood ç­‰å„ç§ç½‘ç»œé—®é¢˜ï¼Œä½ å¯ä»¥é€šè¿‡å†…æ ¸é€‰é¡¹ï¼Œæ¥é™åˆ¶ ICMP çš„è¡Œä¸ºã€‚</p><ul>\n<li>\n<p>æ¯”å¦‚ï¼Œä½ å¯ä»¥ç¦æ­¢ ICMP åè®®ï¼Œå³è®¾ç½® net.ipv4.icmp_echo_ignore_all = 1ã€‚è¿™æ ·ï¼Œå¤–éƒ¨ä¸»æœºå°±æ— æ³•é€šè¿‡ ICMP æ¥æ¢æµ‹ä¸»æœºã€‚</p>\n</li>\n<li>\n<p>æˆ–è€…ï¼Œä½ è¿˜å¯ä»¥ç¦æ­¢å¹¿æ’­ ICMPï¼Œå³è®¾ç½® net.ipv4.icmp_echo_ignore_broadcasts = 1ã€‚</p>\n</li>\n</ul><h3>é“¾è·¯å±‚</h3><p>ç½‘ç»œå±‚çš„ä¸‹é¢æ˜¯é“¾è·¯å±‚ï¼Œæ‰€ä»¥æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹é“¾è·¯å±‚çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>é“¾è·¯å±‚è´Ÿè´£ç½‘ç»œåŒ…åœ¨ç‰©ç†ç½‘ç»œä¸­çš„ä¼ è¾“ï¼Œæ¯”å¦‚ MAC å¯»å€ã€é”™è¯¯ä¾¦æµ‹ä»¥åŠé€šè¿‡ç½‘å¡ä¼ è¾“ç½‘ç»œå¸§ç­‰ã€‚è‡ªç„¶ï¼Œé“¾è·¯å±‚çš„ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯å›´ç»•è¿™äº›åŸºæœ¬åŠŸèƒ½è¿›è¡Œçš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»ä¸åŒçš„å‡ ä¸ªæ–¹é¢åˆ†åˆ«æ¥çœ‹ã€‚</p><p>ç”±äºç½‘å¡æ”¶åŒ…åè°ƒç”¨çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆç‰¹åˆ«æ˜¯è½¯ä¸­æ–­ï¼‰ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡çš„ CPUã€‚æ‰€ä»¥ï¼Œå°†è¿™äº›ä¸­æ–­å¤„ç†ç¨‹åºè°ƒåº¦åˆ°ä¸åŒçš„ CPU ä¸Šæ‰§è¡Œï¼Œå°±å¯ä»¥æ˜¾è‘—æé«˜ç½‘ç»œååé‡ã€‚è¿™é€šå¸¸å¯ä»¥é‡‡ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³•ã€‚</p><ul>\n<li>\n<p>æ¯”å¦‚ï¼Œä½ å¯ä»¥ä¸ºç½‘å¡ç¡¬ä¸­æ–­é…ç½® CPU äº²å’Œæ€§ï¼ˆsmp_affinityï¼‰ï¼Œæˆ–è€…å¼€å¯ irqbalance æœåŠ¡ã€‚</p>\n</li>\n<li>\n<p>å†å¦‚ï¼Œä½ å¯ä»¥å¼€å¯ <strong>RPS</strong>ï¼ˆReceive Packet Steeringï¼‰å’Œ <strong>RFS</strong>ï¼ˆReceive Flow Steeringï¼‰ï¼Œå°†åº”ç”¨ç¨‹åºå’Œè½¯ä¸­æ–­çš„å¤„ç†ï¼Œè°ƒåº¦åˆ°ç›¸åŒCPU ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å¢åŠ  CPU ç¼“å­˜å‘½ä¸­ç‡ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚</p>\n</li>\n</ul><p>å¦å¤–ï¼Œç°åœ¨çš„ç½‘å¡éƒ½æœ‰å¾ˆä¸°å¯Œçš„åŠŸèƒ½ï¼ŒåŸæ¥åœ¨å†…æ ¸ä¸­é€šè¿‡è½¯ä»¶å¤„ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸è½½åˆ°ç½‘å¡ä¸­ï¼Œé€šè¿‡ç¡¬ä»¶æ¥æ‰§è¡Œã€‚</p><ul>\n<li>\n<p><strong>TSO</strong>ï¼ˆTCP Segmentation Offloadï¼‰å’Œ <strong>UFO</strong>ï¼ˆUDP Fragmentation Offloadï¼‰ï¼šåœ¨ TCP/UDP åè®®ä¸­ç›´æ¥å‘é€å¤§åŒ…ï¼›è€ŒTCP åŒ…çš„åˆ†æ®µï¼ˆæŒ‰ç…§ MSS åˆ†æ®µï¼‰å’Œ UDP çš„åˆ†ç‰‡ï¼ˆæŒ‰ç…§ MTU åˆ†ç‰‡ï¼‰åŠŸèƒ½ï¼Œç”±ç½‘å¡æ¥å®Œæˆ ã€‚</p>\n</li>\n<li>\n<p><strong>GSO</strong>ï¼ˆGeneric Segmentation Offloadï¼‰ï¼šåœ¨ç½‘å¡ä¸æ”¯æŒ TSO/UFO æ—¶ï¼Œå°† TCP/UDP åŒ…çš„åˆ†æ®µï¼Œå»¶è¿Ÿåˆ°è¿›å…¥ç½‘å¡å‰å†æ‰§è¡Œã€‚è¿™æ ·ï¼Œä¸ä»…å¯ä»¥å‡å°‘ CPU çš„æ¶ˆè€—ï¼Œè¿˜å¯ä»¥åœ¨å‘ç”Ÿä¸¢åŒ…æ—¶åªé‡ä¼ åˆ†æ®µåçš„åŒ…ã€‚</p>\n</li>\n<li>\n<p><strong>LRO</strong>ï¼ˆLarge Receive Offloadï¼‰ï¼šåœ¨æ¥æ”¶ TCP åˆ†æ®µåŒ…æ—¶ï¼Œç”±ç½‘å¡å°†å…¶ç»„è£…åˆå¹¶åï¼Œå†äº¤ç»™ä¸Šå±‚ç½‘ç»œå¤„ç†ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œåœ¨éœ€è¦ IP è½¬å‘çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å¼€å¯ LROï¼Œå› ä¸ºå¦‚æœå¤šä¸ªåŒ…çš„å¤´éƒ¨ä¿¡æ¯ä¸ä¸€è‡´ï¼ŒLRO åˆå¹¶ä¼šå¯¼è‡´ç½‘ç»œåŒ…çš„æ ¡éªŒé”™è¯¯ã€‚</p>\n</li>\n<li>\n<p><strong>GRO</strong>ï¼ˆGeneric Receive Offloadï¼‰ï¼šGRO ä¿®å¤äº† LRO çš„ç¼ºé™·ï¼Œå¹¶ä¸”æ›´ä¸ºé€šç”¨ï¼ŒåŒæ—¶æ”¯æŒ TCP å’Œ UDPã€‚</p>\n</li>\n<li>\n<p><strong>RSS</strong>ï¼ˆReceive Side Scalingï¼‰ï¼šä¹Ÿç§°ä¸ºå¤šé˜Ÿåˆ—æ¥æ”¶ï¼Œå®ƒåŸºäºç¡¬ä»¶çš„å¤šä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼Œæ¥åˆ†é…ç½‘ç»œæ¥æ”¶è¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥è®©å¤šä¸ª CPU æ¥å¤„ç†æ¥æ”¶åˆ°çš„ç½‘ç»œåŒ…ã€‚</p>\n</li>\n<li>\n<p><strong>VXLAN</strong> å¸è½½ï¼šä¹Ÿå°±æ˜¯è®©ç½‘å¡æ¥å®Œæˆ VXLAN çš„ç»„åŒ…åŠŸèƒ½ã€‚</p>\n</li>\n</ul><p>æœ€åï¼Œå¯¹äºç½‘ç»œæ¥å£æœ¬èº«ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥ä¼˜åŒ–ç½‘ç»œçš„ååé‡ã€‚</p><ul>\n<li>\n<p>æ¯”å¦‚ï¼Œä½ å¯ä»¥å¼€å¯ç½‘ç»œæ¥å£çš„å¤šé˜Ÿåˆ—åŠŸèƒ½ã€‚è¿™æ ·ï¼Œæ¯ä¸ªé˜Ÿåˆ—å°±å¯ä»¥ç”¨ä¸åŒçš„ä¸­æ–­å·ï¼Œè°ƒåº¦åˆ°ä¸åŒ CPU ä¸Šæ‰§è¡Œï¼Œä»è€Œæå‡ç½‘ç»œçš„ååé‡ã€‚</p>\n</li>\n<li>\n<p>å†å¦‚ï¼Œä½ å¯ä»¥å¢å¤§ç½‘ç»œæ¥å£çš„ç¼“å†²åŒºå¤§å°ï¼Œä»¥åŠé˜Ÿåˆ—é•¿åº¦ç­‰ï¼Œæå‡ç½‘ç»œä¼ è¾“çš„ååé‡ï¼ˆæ³¨æ„ï¼Œè¿™å¯èƒ½å¯¼è‡´å»¶è¿Ÿå¢å¤§ï¼‰ã€‚</p>\n</li>\n<li>\n<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ Traffic Control å·¥å…·ï¼Œä¸ºä¸åŒç½‘ç»œæµé‡é…ç½® QoSã€‚</p>\n</li>\n</ul><p>åˆ°è¿™é‡Œï¼Œæˆ‘å°±ä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ï¼Œå†åˆ°é“¾è·¯å±‚ï¼Œåˆ†åˆ«ä»‹ç»äº†ç›¸åº”çš„ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•ã€‚é€šè¿‡è¿™äº›æ–¹æ³•çš„ä¼˜åŒ–åï¼Œç½‘ç»œæ€§èƒ½å°±å¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†åœºæ™¯äº†ã€‚</p><p>æœ€åï¼Œåˆ«å¿˜äº†ä¸€ç§æé™åœºæ™¯ã€‚è¿˜è®°å¾—æˆ‘ä»¬å­¦è¿‡çš„çš„ C10M é—®é¢˜å—ï¼Ÿ</p><p>åœ¨å•æœºå¹¶å‘ 1000 ä¸‡çš„åœºæ™¯ä¸­ï¼Œå¯¹Linux ç½‘ç»œåè®®æ ˆè¿›è¡Œçš„å„ç§ä¼˜åŒ–ç­–ç•¥ï¼ŒåŸºæœ¬éƒ½æ²¡æœ‰å¤ªå¤§æ•ˆæœã€‚å› ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼Œç½‘ç»œåè®®æ ˆçš„å†—é•¿æµç¨‹ï¼Œå…¶å®æ‰æ˜¯æœ€ä¸»è¦çš„æ€§èƒ½è´Ÿæ‹…ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥ä¼˜åŒ–ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œä½¿ç”¨ DPDK æŠ€æœ¯ï¼Œè·³è¿‡å†…æ ¸åè®®æ ˆï¼Œç›´æ¥ç”±ç”¨æˆ·æ€è¿›ç¨‹ç”¨è½®è¯¢çš„æ–¹å¼ï¼Œæ¥å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚åŒæ—¶ï¼Œå†ç»“åˆå¤§é¡µã€CPU ç»‘å®šã€å†…å­˜å¯¹é½ã€æµæ°´çº¿å¹¶å‘ç­‰å¤šç§æœºåˆ¶ï¼Œä¼˜åŒ–ç½‘ç»œåŒ…çš„å¤„ç†æ•ˆç‡ã€‚</p><p>ç¬¬äºŒç§ï¼Œä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ XDP æŠ€æœ¯ï¼Œåœ¨ç½‘ç»œåŒ…è¿›å…¥å†…æ ¸åè®®æ ˆå‰ï¼Œå°±å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°å¾ˆå¥½çš„æ€§èƒ½ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢³ç†äº†å¸¸è§çš„ Linux ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>åœ¨ä¼˜åŒ–ç½‘ç»œçš„æ€§èƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ Linux ç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆå’Œç½‘ç»œæ”¶å‘æµç¨‹ï¼Œä»åº”ç”¨ç¨‹åºã€å¥—æ¥å­—ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å†åˆ°é“¾è·¯å±‚ç­‰ï¼Œå¯¹æ¯ä¸ªå±‚æ¬¡è¿›è¡Œé€å±‚ä¼˜åŒ–ã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åˆ†æå’Œå®šä½ç½‘ç»œç“¶é¢ˆï¼Œä¹Ÿæ˜¯åŸºäºè¿™äº›ç½‘ç»œå±‚è¿›è¡Œçš„ã€‚è€Œå®šä½å‡ºç½‘ç»œæ€§èƒ½ç“¶é¢ˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç“¶é¢ˆæ‰€åœ¨çš„åè®®å±‚ï¼Œè¿›è¡Œä¼˜åŒ–ã€‚å…·ä½“è€Œè¨€ï¼š</p><ul>\n<li>\n<p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä¸»è¦æ˜¯ä¼˜åŒ– I/O æ¨¡å‹ã€å·¥ä½œæ¨¡å‹ä»¥åŠåº”ç”¨å±‚çš„ç½‘ç»œåè®®ï¼›</p>\n</li>\n<li>\n<p>åœ¨å¥—æ¥å­—å±‚ä¸­ï¼Œä¸»è¦æ˜¯ä¼˜åŒ–å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°ï¼›</p>\n</li>\n<li>\n<p>åœ¨ä¼ è¾“å±‚ä¸­ï¼Œä¸»è¦æ˜¯ä¼˜åŒ– TCP å’Œ UDP åè®®ï¼›</p>\n</li>\n<li>\n<p>åœ¨ç½‘ç»œå±‚ä¸­ï¼Œä¸»è¦æ˜¯ä¼˜åŒ–è·¯ç”±ã€è½¬å‘ã€åˆ†ç‰‡ä»¥åŠ ICMP åè®®ï¼›</p>\n</li>\n<li>\n<p>æœ€åï¼Œåœ¨é“¾è·¯å±‚ä¸­ï¼Œä¸»è¦æ˜¯ä¼˜åŒ–ç½‘ç»œåŒ…çš„æ”¶å‘ã€ç½‘ç»œåŠŸèƒ½å¸è½½ä»¥åŠç½‘å¡é€‰é¡¹ã€‚</p>\n</li>\n</ul><p>å¦‚æœè¿™äº›æ–¹æ³•ä¾ç„¶ä¸èƒ½æ»¡è¶³ä½ çš„è¦æ±‚ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘ï¼Œä½¿ç”¨ DPDK ç­‰ç”¨æˆ·æ€æ–¹å¼ï¼Œç»•è¿‡å†…æ ¸åè®®æ ˆï¼›æˆ–è€…ï¼Œä½¿ç”¨ XDPï¼Œåœ¨ç½‘ç»œåŒ…è¿›å…¥å†…æ ¸åè®®æ ˆå‰è¿›è¡Œå¤„ç†ã€‚</p><h2>æ€è€ƒ</h2><p>åœ¨æ•´ä¸ªæ¿å—çš„å­¦ä¹ ä¸­ï¼Œæˆ‘åªåˆ—ä¸¾äº†æœ€å¸¸è§çš„å‡ ä¸ªç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ€è·¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€å®šè¿˜æœ‰å¾ˆå¤šå…¶ä»–ä»åº”ç”¨ç¨‹åºã€ç³»ç»Ÿå†åˆ°ç½‘ç»œè®¾å¤‡çš„ä¼˜åŒ–æ–¹æ³•ã€‚æˆ‘æƒ³è¯·ä½ ä¸€èµ·æ¥èŠèŠï¼Œä½ è¿˜çŸ¥é“å“ªäº›ä¼˜åŒ–æ–¹æ³•å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºè·Ÿæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>","comments":[{"had_liked":false,"id":82325,"user_name":"C.C","can_delete":false,"product_type":"c1","uid":1199521,"ip_address":"","ucode":"B88CE3DE4E5680","user_header":"","comment_is_top":false,"comment_ctime":1554185799,"is_pvip":false,"replies":[{"id":"29850","content":"å—¯å—¯ï¼Œæ€»ç»“çš„ä¸é”™ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":82325,"uid":"1001282","ip_address":"","utype":1,"ctime":1554211264,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"83158564423","product_id":100020901,"comment_content":"timewaitçš„ä¼˜åŒ–ï¼š<br>timewaitæ˜¯ç”±ä¸»åŠ¨çš„ä¸€æ–¹ä¸»åŠ¨å…³é—­çš„ï¼Œæˆ‘è®¤ä¸ºåº”ç”¨å±‚æœ€å¥½èƒ½å¤Ÿæ± åŒ–è¿™äº›è¿æ¥ï¼Œè€Œä¸æ˜¯ç›´æ¥å…³é—­è¿™äº›é“¾æ¥; å¦å¤–ï¼Œæ¯”å¦‚å¯¹äºhttpæœ‰äº›åœºæ™¯çš„è¯·æ±‚ï¼Œå¯¹äºéœ€è¦å…³é—­é“¾æ¥çš„æƒ…å†µï¼Œå¤šä¸ªæ•°æ®è¯·æ±‚æœ€å¥½åˆå¹¶å‘é€ï¼Œä¹Ÿå¯ä»¥å‡å°‘timewaitçš„æƒ…å†µ. ä¸€åŠæ¥è¯´ï¼Œæˆ‘è§‰å¾—ä¸€ä¸ªæœåŠ¡å™¨ä¸Šæœ‰1Wä¸ªå·¦å³çš„timewaitçš„é“¾æ¥è¿˜æ˜¯æ¯”è¾ƒæ­£å¸¸çš„.<br>keepAliveï¼Œå¯¹äºé•¿è¿æ¥çš„åœºæ™¯ï¼Œæˆ‘è§‰å¾—tcpå±‚æ˜¯æœ€å¥½ä¸è¦å¼€. å› ä¸º1.tcpé»˜è®¤æ˜¯7200ç§’ï¼Œéœ€è¦é€šè¿‡æ›´æ”¹å†…æ ¸çš„æ–¹å¼ï¼Œä¸çŸ¥é“åœ¨ä½•ç§æƒ…å†µä¸‹æ˜¯åˆé€‚çš„. 2:é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨å±‚ä¹Ÿæ˜¯éœ€è¦å¿ƒè·³æ£€æŸ¥çš„,è¿™ä¸ªæ—¶å€™tcpå±‚å¼€keepaliveè¯ï¼Œåè€Œæ˜¯ä¸­æµªè´¹.<br>tcpå±‚å’Œåº”ç”¨å±‚çš„ç½‘ç»œä¼˜åŒ–ï¼Œé™¤äº† tcp&#47;ipè¯¦è§£å·ä¸€ï¼Œæœ‰ä¸€æœ¬ effective Tcp&#47;ip programming ä¹Ÿæ˜¯ä¸é”™çš„","like_count":20,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445553,"discussion_content":"å—¯å—¯ï¼Œæ€»ç»“çš„ä¸é”™ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554211264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72572,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1551669546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"83156048170","product_id":100020901,"comment_content":"[D44æ‰“å¡]<br>è¿™ä¸ªä¼˜åŒ–å¥—è·¯å¾ˆå…¨é¢,å€¼å¾—å¥½å¥½æ”¶è—.<br>æ ¹æ®TCP&#47;IPçš„ç½‘ç»œæ¨¡å‹ ä»å››å±‚åè®®ä¸­çš„ä¸‹é¢ä¸‰å±‚:ä¼ è¾“ã€ç½‘ç»œã€é“¾è·¯å±‚ï¼Œé€æ­¥åˆ†ææ¯å±‚çš„ä¼˜åŒ–æ–¹æ³•ã€‚<br><br>ä»¥å‰çŸ¥é“çš„åªæœ‰äº›æµ…æ˜¾çš„ï¼š<br>ä¸€ä¸ªMTUé€šå¸¸åœ¨1500å­—èŠ‚<br>å¢åŠ æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼šulimit -n xxxx<br>å‡å°‘TIME_WAITçŠ¶æ€çš„æ—¶é—´ è®©ç³»ç»Ÿå°½å¿«é‡Šæ”¾<br>çœŸå¤§TIME_WAITçŠ¶æ€çš„è¿æ¥æ•°<br><br>ä»¥å‰çš„éƒ½æ˜¯é‡åˆ°ä¸€ä¸ª,è°·æ­Œä¸€ä¸ª. ä¹Ÿæ²¡è§è°æœ‰è¿™ä¹ˆå…¨é¢çš„ä¼˜åŒ–æ€è·¯.<br>åœ¨ä¸çŸ¥é“æ‰€ä»¥ç„¶çš„æƒ…å†µä¸‹,è¿˜å¾ˆå¯èƒ½ä¼šå‡ºç°è¿”ä¼˜åŒ–çš„æƒ…å†µ.å“ˆå“ˆ.<br><br>è™½ç„¶ç›®å‰å·¥ä½œä¸­è¿˜æš‚æ—¶ç”¨ä¸ä¸Šé‚£ä¹ˆå¤šé«˜å¤§ä¸Šçš„ä¼˜åŒ–æ–¹æ³•ï¼Œä½†æœ‰äº†ä¸ªå°è±¡ï¼Œä»¥åé‡åˆ°äº†å†æ¥å¤ä¹ ä¹Ÿæ˜¯æå¥½çš„ã€‚","like_count":20},{"had_liked":false,"id":80956,"user_name":"æ©™æ±","can_delete":false,"product_type":"c1","uid":1332257,"ip_address":"","ucode":"EC3FF10D708C9D","user_header":"https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg","comment_is_top":false,"comment_ctime":1553763785,"is_pvip":false,"replies":[{"id":"29613","content":"å—¯ æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":80956,"uid":"1001282","ip_address":"","utype":1,"ctime":1554021729,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":4,"race_medal":0,"score":"27323567561","product_id":100020901,"comment_content":"å…³äºtcpè¿™å—æœ‰ä¸ªå…³äºå¼€å¯æ—¶é—´æˆ³çš„éªŒè¯ å‚æ•°ä¸ºtcp_timestampsï¼Œæœ‰natç¯å¢ƒåƒä¸‡ä¸è¦æ‰“å¼€ï¼Œå¯ä»¥é€šè¿‡cat &#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_timestamps æ˜¯å¦å¼€å¯","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445027,"discussion_content":"å—¯ æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554021729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1292330,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VX0ib4CV0m7fwxB2xFcIJaYYWXXpfxxYbfBErqBej9395hgZszqS3dz9bThCxOuFfJ8Xibx9HbdNmZJwL5m33wIw/132","nickname":"chaoxifuchen","note":"","ucode":"95DCC5C4994F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398542,"discussion_content":"åº”è¯¥æ˜¯tcp_recycleå’Œtcp_timestamps ä¸èƒ½åŒæ—¶å¼€ï¼Œä¸€èˆ¬æ˜¯æŠŠrecycleå…³é—­","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1632810609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218147,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/63/64f62020.jpg","nickname":"or0or1","note":"","ucode":"E7B63C666302C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":18372,"discussion_content":"tcp_tw_reuseéœ€è¦ç»“åˆè¿™ä¸ªå‚æ•°æ‰ç”Ÿæ•ˆå§ï¼Ÿå…³é—­äº†å’‹æ•´ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1569052334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446494,"avatar":"https://static001.geekbang.org/account/avatar/00/16/12/5e/77b67a85.jpg","nickname":"é£˜äº‘","note":"","ucode":"C6FE0310D6853C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210054,"discussion_content":"ä½ è¯´çš„natç¯å¢ƒä¸è¦æ‰“å¼€ï¼Œåº”è¯¥æ˜¯tcp_recycleé€‰é¡¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584704937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74663,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1552275019,"is_pvip":false,"replies":[{"id":"27488","content":"å—¯å—¯ï¼Œæ˜¯çš„ï¼Œè°¢è°¢æŒ‡å‡º<br>","user_name":"ä½œè€…å›å¤","comment_id":74663,"uid":"1001282","ip_address":"","utype":1,"ctime":1552400028,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"18732144203","product_id":100020901,"comment_content":"è€å¸ˆï¼Œnr_openåº”è¯¥æ˜¯å•ä¸ªè¿›ç¨‹å¯åˆ†é…çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œfile_maxæ‰æ˜¯ç³»ç»Ÿçº§åˆ«çš„ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442641,"discussion_content":"å—¯å—¯ï¼Œæ˜¯çš„ï¼Œè°¢è°¢æŒ‡å‡º\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552400028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108292,"user_name":"zhchnchn","can_delete":false,"product_type":"c1","uid":1110218,"ip_address":"","ucode":"2219E40ED134D4","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/ca/4560f06b.jpg","comment_is_top":false,"comment_ctime":1561714283,"is_pvip":false,"replies":[{"id":"40451","content":"è°¢è°¢æŒ‡å‡ºï¼Œæ–‡ä¸­ä¸å¤ªå‡†ç¡®ï¼Œnet.ipv4.tcp_fin_timeoutå®é™…ä¸Šæ˜¯ä»TIME_WAIT_2åˆ°TIME_WAITçš„è¶…æ—¶æ—¶é—´ï¼Œè€Œ TIME_WAITçŠ¶æ€çš„è¶…æ—¶æ—¶é—´æ˜¯å›ºå®šçš„ 2MSLï¼ˆä¹Ÿå°±æ˜¯60sï¼‰ã€‚","user_name":"ä½œè€…å›å¤","comment_id":108292,"uid":"1001282","ip_address":"","utype":1,"ctime":1562511298,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"10151648875","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œä»â€œç‹äº®â€çš„ç•™è¨€ä¸­çœ‹åˆ°ï¼Œ`net.ipv4.tcp_fin_timeout`è¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨`FIN-WAIT-2`çŠ¶æ€çš„æ—¶é—´ï¼Œé‚£å®ƒæ€ä¹ˆåˆå¯ä»¥â€œç¼©çŸ­å¤„äºTIME_WAITçŠ¶æ€çš„è¶…æ—¶æ—¶é—´â€ï¼ˆè€å¸ˆæ€»ç»“çš„å›¾ä¸­ï¼‰å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455907,"discussion_content":"è°¢è°¢æŒ‡å‡ºï¼Œæ–‡ä¸­ä¸å¤ªå‡†ç¡®ï¼Œnet.ipv4.tcp_fin_timeoutå®é™…ä¸Šæ˜¯ä»TIME_WAIT_2åˆ°TIME_WAITçš„è¶…æ—¶æ—¶é—´ï¼Œè€Œ TIME_WAITçŠ¶æ€çš„è¶…æ—¶æ—¶é—´æ˜¯å›ºå®šçš„ 2MSLï¼ˆä¹Ÿå°±æ˜¯60sï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562511298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2189657,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/59/fd0dcc7b.jpg","nickname":"äº‘æ·¡é£æ¸…","note":"","ucode":"4F5F5C89EBF3A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320796,"discussion_content":"fin_wait2ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸ªè¶…æ—¶æ—¶é—´ï¼Œèµ·å•¥ä½œç”¨ï¼Œfin_wait1ä¸ºä»€ä¹ˆåˆæ²¡æœ‰ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604480715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1200299,"avatar":"https://static001.geekbang.org/account/avatar/00/12/50/ab/6584e520.jpg","nickname":"é™ˆé¡ºå‰","note":"","ucode":"315732AEA35CD1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2189657,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/59/fd0dcc7b.jpg","nickname":"äº‘æ·¡é£æ¸…","note":"","ucode":"4F5F5C89EBF3A1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353096,"discussion_content":"è¿™æ˜¯å› ä¸ºå½“å®¢æˆ·ç«¯å¤„äº fin_wait2 æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå¤„äº close_waitï¼Œå¦‚æœæœåŠ¡ç«¯çš„ä»£ç æœ‰é—®é¢˜ï¼Œä¸ä¸»åŠ¨é‡Šæ”¾é“¾æ¥çš„è¯ï¼Œclose_wait çŠ¶æ€ä¼šä¸€ç›´æŒç»­ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¹Ÿå°±æ— æ³•è¿›å…¥ time_waitï¼Œæ•´ä¸ªè¿æ¥ä¹Ÿå°±æ— æ³•é‡Šæ”¾ã€‚é€šè¿‡ net.ipv4.tcp_fin_timeout è®¾ç½®è¶…æ—¶æ—¶é—´ä¹‹åï¼Œå³ä½¿æœåŠ¡ç«¯ä¸é‡Šæ”¾è¿æ¥ï¼Œé‚£ä¹ˆè¶…æ—¶åå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨è¿›å…¥ time_waitï¼Œ120s åè¿æ¥é‡Šæ”¾ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615002738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320796,"ip_address":""},"score":353096,"extra":""}]}]},{"had_liked":false,"id":80232,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553643467,"is_pvip":false,"replies":[{"id":"29329","content":"ä¸´æ—¶ä¿®æ”¹ä½¿ç”¨sysctlï¼ŒæŒä¹…åŒ–å†™å…¥æ–‡ä»¶&#47;etc&#47;sysctl.conf","user_name":"ä½œè€…å›å¤","comment_id":80232,"uid":"1001282","ip_address":"","utype":1,"ctime":1553697467,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":3,"race_medal":0,"score":"10143578059","product_id":100020901,"comment_content":"TCPä¼˜åŒ–ï¼Œå†…æ ¸é€‰é¡¹å‚æ•°æ€ä¹ˆä¿®æ”¹å‘¢ï¼Ÿåœ¨å“ªä¿®æ”¹å‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444791,"discussion_content":"ä¸´æ—¶ä¿®æ”¹ä½¿ç”¨sysctlï¼ŒæŒä¹…åŒ–å†™å…¥æ–‡ä»¶/etc/sysctl.conf","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134694,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/66/047ee060.jpg","nickname":"Return12321","note":"","ucode":"F7A3C5ED02E1D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382591,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625642657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2116245,"avatar":"https://static001.geekbang.org/account/avatar/00/20/4a/95/4f6f93c3.jpg","nickname":"çŸ¥è¡Œåˆä¸€","note":"","ucode":"A53A002DF3A652","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364120,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617368567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72889,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1551751241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10141685833","product_id":100020901,"comment_content":"æ‰“å¡ï¼Œå­¦ä¹ æœ¬ç« ï¼ŒçŸ¥é“äº†ä½¿ç”¨è°ƒèŠ‚å†…æ ¸ç½‘ç»œå‚æ•°ï¼Œä½¿ç”¨ç½‘å¡ç‰¹æ€§ï¼Œæ¥è°ƒèŠ‚ä¸ªå±‚æ€§èƒ½ï¼Œå—ç›Šï¼Œæ„Ÿè°¢è€å¸ˆ","like_count":2},{"had_liked":false,"id":72483,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1551657880,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10141592472","product_id":100020901,"comment_content":"æ‰“å¡day46<br>åŸºç¡€ä¸ç‰¢ï¼Œåœ°åŠ¨å±±æ‘‡ï¼Œä¸€äº›ç½‘ç»œçš„æ¦‚å¿µæ²¡ç†è§£ï¼Œæ¶ˆåŒ–èµ·æ¥æ¯”è¾ƒè´¹åŠ›ï½","like_count":3,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312067,"discussion_content":"æ€ªä¸å¾—æˆ‘è§‰å¾—æ™•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602577885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281988,"user_name":"é™ˆé¡ºå‰","can_delete":false,"product_type":"c1","uid":1200299,"ip_address":"","ucode":"315732AEA35CD1","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/ab/6584e520.jpg","comment_is_top":false,"comment_ctime":1615003244,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5909970540","product_id":100020901,"comment_content":"æ®æˆ‘æ‰€çŸ¥ï¼Œnet.ipv4.tcp_tw_reuse å’Œ net.ipv4.tcp_tw_recycle éƒ½ä¾èµ–äº net.ipv4.tcp_timestampsï¼Œnet.ipv4.tcp_timestamps æ˜¯ tcp çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå¦‚æœå¼€å¯äº†å®ƒï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨ tcp çš„å…¶ä»–é€‰é¡¹äº†ï¼ŒåŒ…æ‹¬ net.ipv4.tcp_syncookiesã€‚","like_count":2,"discussions":[{"author":{"id":2110718,"avatar":"https://static001.geekbang.org/account/avatar/00/20/34/fe/e5429b02.jpg","nickname":"glimmer","note":"","ucode":"48A16C52FB4C45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368728,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618819418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78185,"user_name":"honnkyou","can_delete":false,"product_type":"c1","uid":1026608,"ip_address":"","ucode":"FD5EC4120EE803","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg","comment_is_top":false,"comment_ctime":1553088248,"is_pvip":false,"replies":[{"id":"28743","content":"ç›‘å¬çš„ç«¯å£é€šå¸¸æ˜¯ä¸€ä¸ªï¼Œä½†æœåŠ¡å™¨ç¨‹åºè¿˜å¯èƒ½ä¼šé€šè¿‡ç½‘ç»œå»è¿æ¥å…¶ä»–æœåŠ¡ï¼Œè¿™æ—¶å€™å®ƒåˆæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯äº†","user_name":"ä½œè€…å›å¤","comment_id":78185,"uid":"1001282","ip_address":"","utype":1,"ctime":1553316219,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":1,"race_medal":0,"score":"5848055544","product_id":100020901,"comment_content":"&quot;å¢å¤§æœ¬åœ°ç«¯å£çš„èŒƒå›´ net.ipv4.ip_local_port_range ã€‚&quot;è¿™ä¸ªä¼˜åŒ–æ‰‹æ®µä¸æ˜¯å¾ˆç†è§£ï¼ŒæœåŠ¡å™¨ç«¯é€šå¸¸ä¸éƒ½æ˜¯ç›‘å¬æŸä¸ªç«¯å£å˜›ï¼Œä¸ºä»€ä¹ˆè¯´å¢å¤§æœ¬åœ°ç«¯å£èŒƒå›´ä¼šä¼˜åŒ–å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443996,"discussion_content":"ç›‘å¬çš„ç«¯å£é€šå¸¸æ˜¯ä¸€ä¸ªï¼Œä½†æœåŠ¡å™¨ç¨‹åºè¿˜å¯èƒ½ä¼šé€šè¿‡ç½‘ç»œå»è¿æ¥å…¶ä»–æœåŠ¡ï¼Œè¿™æ—¶å€™å®ƒåˆæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553316219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73049,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1551785352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846752648","product_id":100020901,"comment_content":"è¶Šæ¥è¶ŠæœŸå¾…åé¢çš„è¯¾äº†","like_count":1},{"had_liked":false,"id":72664,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1551688506,"is_pvip":false,"replies":[{"id":"26335","content":"å†…å­˜æ¨¡å—æœ‰è®²è§£cache missçš„é—®é¢˜ã€‚ç½‘ç»œä¸­è™½ç„¶æœ‰å¾ˆå¤šç¼“å†²åŒºï¼Œä½†æ²¡æœ‰ cache miss è¿™ä¸€è¯´ï¼ˆç¼“å†²åŒºä¸­è¯»ä¸åˆ°æ•°æ®é‚£å°±æ˜¯æ²¡æœ‰æ•°æ®äº†ï¼‰","user_name":"ä½œè€…å›å¤","comment_id":72664,"uid":"1001282","ip_address":"","utype":1,"ctime":1551706924,"user_name_real":"å€ªæœ‹é£"}],"discussion_count":2,"race_medal":0,"score":"5846655802","product_id":100020901,"comment_content":"è¯·é—®å€ªè€å¸ˆæ€ä¹ˆè¯„ä¼°cache miss?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441678,"discussion_content":"å†…å­˜æ¨¡å—æœ‰è®²è§£cache missçš„é—®é¢˜ã€‚ç½‘ç»œä¸­è™½ç„¶æœ‰å¾ˆå¤šç¼“å†²åŒºï¼Œä½†æ²¡æœ‰ cache miss è¿™ä¸€è¯´ï¼ˆç¼“å†²åŒºä¸­è¯»ä¸åˆ°æ•°æ®é‚£å°±æ˜¯æ²¡æœ‰æ•°æ®äº†ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551706924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"å‡¯æ–‡å°çŒª","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390137,"discussion_content":"ç½‘ç»œåè®®æ ˆçš„ç¼“å†²æ±  ä¸»è¦ç”¨é€”çš„æ˜¯æ”¶å‘ ä¸æ˜¯ç”¨æ¥å‘½ä¸­åŠ é€Ÿæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯æ‰§è¡Œäº†write backç­–ç•¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629685531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310553,"user_name":"FreeMason","can_delete":false,"product_type":"c1","uid":1340120,"ip_address":"","ucode":"3D58AC2F9AB345","user_header":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","comment_is_top":false,"comment_ctime":1630741557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630741557","product_id":100020901,"comment_content":"æœ€è¿‘æ demo æµ‹è¯•æ—¶ï¼Œè¿›è¡Œå‹æµ‹ go-stress-testing-win -c 2000 -n 1000 -u host -data POSTï¼Œä» 2000 QPS ä¸‹é™åˆ°600QPSï¼Œè¿˜ä¼šå‡ºç°å¤§é‡ wsarecv: An existing connection was forcibly closed by the remote hostï¼Œtcpdump æŠ“åŒ…æœåŠ¡å™¨å‘ç°æœ‰å¤§é‡çš„ RST å’Œ RST,ACK å’Œ TCP Port numbers reused å’Œ TCP Dup ACK å’Œ TCP Previous ... å’Œ TCP Retransmission ç­‰é”™è¯¯ï¼Œå°±æ‰¾ google å„ç§æ“ä½œï¼Œç„¶è€Œç„¶å¹¶åµã€‚ åˆæ¬¡ææµ‹è¯•è¿æ¥è¿™æ–¹é¢å¯æœ‰å°æ±‚è§£ï¼ˆæŒ‡å¯¼ï¼‰","like_count":0},{"had_liked":false,"id":299918,"user_name":"æŠ€æœ¯å°ç™½èœ","can_delete":false,"product_type":"c1","uid":1990375,"ip_address":"","ucode":"CEA9B0DFA197C6","user_header":"","comment_is_top":false,"comment_ctime":1624920951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624920951","product_id":100020901,"comment_content":"å¼€å¯ç«¯å£å¤ç”¨ net.ipv4.tcp_tw_reuseã€‚è¿™æ ·ï¼Œè¢« TIME_WAIT çŠ¶æ€å ç”¨çš„ç«¯å£ï¼Œè¿˜èƒ½ç”¨åˆ°æ–°å»ºçš„è¿æ¥ä¸­ã€‚--è¿™ä¸ªæ˜¯é’ˆå¯¹å®¢æˆ·ç«¯çš„ time_waitå¤ç”¨é—®é¢˜ï¼Œæ­£å¸¸ä¸å¼€è¿™ä¸ªå‚æ•°ï¼Œè¦ç­‰60ç§’ç«¯å£é‡Šæ”¾æ‰èƒ½ä½¿ç”¨ã€‚å¼€å¯æ­¤å†…æ ¸å‚æ•°ï¼Œè¿æ¥å¤šé•¿æ—¶é—´å°±å¯ä»¥å¤ç”¨å‘¢","like_count":0},{"had_liked":false,"id":212816,"user_name":"stackWarn","can_delete":false,"product_type":"c1","uid":1002005,"ip_address":"","ucode":"89672E452DEBA5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","comment_is_top":false,"comment_ctime":1588214977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588214977","product_id":100020901,"comment_content":"æ‰“å¡ ï¼Œè¯·é—®ä¸‹è¯„è®ºåŒºæ˜¯å¦æœ‰å¯¹ç½‘ç»œæ•´ä¸ªæµç¨‹çš„ä¸¢åŒ…æŠ€æœ¯ç›¸å…³å‚æ•°çš„æ–‡ç« å‚è€ƒ","like_count":0},{"had_liked":false,"id":199773,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1585495682,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585495682","product_id":100020901,"comment_content":"ä¸€ç›´éƒ½é£˜åœ¨åº”ç”¨ç¨‹åºé‚£ä¸€å±‚ï¼Œæƒ³æ²‰ä¸‹æ¥ï¼ŒåŠ æ²¹ï¼ï¼ï¼","like_count":0},{"had_liked":false,"id":144842,"user_name":"Abu","can_delete":false,"product_type":"c1","uid":1301948,"ip_address":"","ucode":"297D7C7A2944E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/bc/8969d111.jpg","comment_is_top":false,"comment_ctime":1572070357,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572070357","product_id":100020901,"comment_content":"åœ¨ç½‘å¡æ”¯æŒRSSæ—¶ï¼Œè¿˜éœ€è¦ç”¨RPSæˆ–è€…RFSå—ï¼Ÿè¯·è€å¸ˆæŒ‡æ•™","like_count":0},{"had_liked":false,"id":141806,"user_name":"LQ","can_delete":false,"product_type":"c1","uid":1026253,"ip_address":"","ucode":"68C56AC7710B3A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/cd/cce2161a.jpg","comment_is_top":false,"comment_ctime":1571228814,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571228814","product_id":100020901,"comment_content":"å¯¹äºnginxï¼Œæˆ‘çœ‹ç½‘ä¸Šå¤§é‡çš„æ–‡ç« éƒ½è¯´åº”è¯¥è®¾ç½® tcp_max_tw_buckets=5000ï¼Œä½†æ‚¨æ¨èçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œèƒ½è§£é‡Šä¸€ä¸‹å—ï¼Ÿè°¢è°¢ï¼","like_count":0,"discussions":[{"author":{"id":1081299,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","nickname":"Realm","note":"","ucode":"30CBEBE619D1A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552208,"discussion_content":"å‡å°‘hashå†²çª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645347655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394203,"discussion_content":"æ–‡ä¸­è€å¸ˆæœ‰è§£é‡Šè›®æ¸…æ¥šçš„ï¼Œå¯ä»¥å†å›çœ‹ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631783456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118635,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1564403019,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1564403019","product_id":100020901,"comment_content":"è€å¸ˆï¼Œlinuxé‡Œé¢çš„è¿™ä¸ªå˜é‡net.ipv4.tcp_fin_timeout åˆ°åº•æŒ‡ä»£çš„æ˜¯ä»€ä¹ˆæ„ä¹‰å‘¢ã€‚<br>tcpè¯¦è§£ç¬¬ä¸€å·é‡Œé¢ï¼Œ<br>è¯´time_waitçš„ç­‰å¾…æ—¶é—´ç”±è¿™ä¸ªå˜é‡è®°å½•<br>ç„¶åè¯´ FIN_WAIT_2çŠ¶æ€çš„ç­‰å¾…æ—¶é—´ä¹Ÿç”±è¿™ä¸ªå˜é‡è®°å½•<br>ç„¶åæœ‰äº›åšå®¢è¯´ï¼Œå…¶å®time_waitçŠ¶æ€çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶æ²¡æœ‰è¯»å–è¿™ä¸ªå˜é‡ï¼Œè€Œæ˜¯ç”±ä»£ç ä¸­å®å®šä¹‰çš„ã€‚<br>æœ‰ç‚¹æ‡µé€¼","like_count":0,"discussions":[{"author":{"id":1662117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7zuDYFIutbSPc4eEtcMhdNBTI1FRR7q0xrGh2X1QdiaNxvAV31HcRUsjPWLaaWftqgwTnVoiaica8Nw/132","nickname":"èƒœè¾‰ï¼ˆå¤§Vï¼‰","note":"","ucode":"3C13BFCD82D4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400435,"discussion_content":"timewaitçš„ç­‰å¾…æ—¶é—´éœ€è¦é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œæ— æ³•é€šè¿‡å‚æ•°è¿›è¡Œè°ƒæ•´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633269621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1493286,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","nickname":"æ˜€æºª","note":"","ucode":"BFAF31542BC24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3583,"discussion_content":"TIME_WAITè¿™ä¸ªæ—¶é—´ åœ¨å†…æ ¸ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»è®¾å®šäº† æˆ‘ä¸€ç›´æ²¡æ‰¾åˆ°åœ¨å“ªé‡Œä¿®æ”¹ ä¸è¿‡FIN_TIMEOUT æŒ‡çš„å°±æ˜¯FIN_TIME2 è¿™ä¸€ç‚¹ä¹¦ä¸Šæ²¡é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564618200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104726,"user_name":"å³°å›","can_delete":false,"product_type":"c1","uid":1173558,"ip_address":"","ucode":"4DB385E93749A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/e8/36/5b018040.jpg","comment_is_top":false,"comment_ctime":1560822266,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560822266","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œç³»ç»Ÿä¸­å‘ç°å¤§é‡closedè¿æ¥ï¼Œåº”è¯¥ä¼˜åŒ–å“ªäº›å‚æ•°ã€‚","like_count":0},{"had_liked":false,"id":92650,"user_name":"ç‹äº®","can_delete":false,"product_type":"c1","uid":1002270,"ip_address":"","ucode":"A94DBEBD3C21E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4b/1e/3a732ac3.jpg","comment_is_top":false,"comment_ctime":1557309026,"is_pvip":false,"replies":[{"id":"33108","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1557324186,"ip_address":"","comment_id":92650,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557309026","product_id":100020901,"comment_content":"net.ipv4.tcp_fin_timeout åº”è¯¥æ˜¯è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449345,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557324186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91145,"user_name":"Joe","can_delete":false,"product_type":"c1","uid":1033290,"ip_address":"","ucode":"79AC38C1F44D76","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/4a/c02c597b.jpg","comment_is_top":false,"comment_ctime":1556880893,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556880893","product_id":100020901,"comment_content":"å¥½çš„","like_count":0},{"had_liked":false,"id":90224,"user_name":"ç‹ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1046001,"ip_address":"","ucode":"ABA3781E6DD5DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/f1/4b26ac7d.jpg","comment_is_top":false,"comment_ctime":1556452042,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556452042","product_id":100020901,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":90097,"user_name":"ç¬‘","can_delete":false,"product_type":"c1","uid":1284647,"ip_address":"","ucode":"C91EAFAB88E5AC","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/27/4b81bce5.jpg","comment_is_top":false,"comment_ctime":1556414315,"is_pvip":false,"replies":[{"id":"32534","content":"ä¸€ä¸ªæ„æ€ä½†ä½œç”¨èŒƒå›´ä¸ä¸€æ ·ï¼Œfs.nr_openå¯¹åº”å•ä¸ªè¿›ç¨‹ï¼Œulimitè®¾ç½®ç”¨æˆ·å½“å‰ä¼šè¯","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1556634968,"ip_address":"","comment_id":90097,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556414315","product_id":100020901,"comment_content":"ulimit -n : open files   (-n) 1024   è¿™ä¸ªè·Ÿ  fs.nr_open = 1048576 æ˜¯ä¸€ä¸ªæ„æ€å—ï¼Ÿ<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448390,"discussion_content":"ä¸€ä¸ªæ„æ€ä½†ä½œç”¨èŒƒå›´ä¸ä¸€æ ·ï¼Œfs.nr_openå¯¹åº”å•ä¸ªè¿›ç¨‹ï¼Œulimitè®¾ç½®ç”¨æˆ·å½“å‰ä¼šè¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556634968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80250,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553644976,"is_pvip":false,"replies":[{"id":"29326","content":"å—¯å—¯ï¼Œå¤šå®è·µå‡ æ¬¡å°±è®°ä½äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1553697356,"ip_address":"","comment_id":80250,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553644976","product_id":100020901,"comment_content":"ä¼˜åŒ–æ€è·¯æ€»ç»“æ˜¯æŒºå¥½çš„ï¼Œä½†æ˜¯æ¯•ç«Ÿç¼ºå°‘å®è·µï¼Œå¦‚æœä¸å®è·µï¼Œå¾ˆå¿«å°±ä¼šå¿˜è®°!","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444798,"discussion_content":"å—¯å—¯ï¼Œå¤šå®è·µå‡ æ¬¡å°±è®°ä½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77236,"user_name":"æ˜ç¿¼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1552894383,"is_pvip":false,"replies":[{"id":"28159","content":"ä»¥å‰ç¢°åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œæ˜¯ç½‘å¡é©±åŠ¨åˆ°å¯¼è‡´çš„ï¼Œå¯ä»¥åˆ°é©±åŠ¨ç½‘ç«™çœ‹çœ‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„é”™è¯¯ä¿®å¤","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1552903424,"ip_address":"","comment_id":77236,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552894383","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘åœ¨ä»Šå¤©ç”Ÿäº§ç¯å¢ƒå‘ç°ä¸€ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼ŒåŒäº‹åé¦ˆesçš„é›†ç¾¤çš„ç´¢å¼•é€Ÿåº¦è¿‡æ…¢ï¼Œæˆ‘å»é›†ç¾¤ä¸Šçœ‹äº†ä¸‹ï¼Œä»è¡¨é¢çœ‹æ¥ï¼Œå†…å­˜ã€cpuã€ç½‘ç»œã€ç£ç›˜å„æ–¹é¢æŒ‡æ ‡éƒ½è¿˜å¯ä»¥ï¼Œéƒ½ä¸é«˜ã€‚<br>æ“ä½œç³»ç»Ÿä¸ºCentosï¼Œç‰ˆæœ¬ä¿¡æ¯ï¼šLinux lc-gwrz-es25 3.10.0-693.el7.x86_64 #1 SMP Thu Jul 6 19:56:57 EDT 2017 x86_64 x86_64 x86_64 GNU&#47;Linux<br>åœ¨dmesgå»æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—çš„æ—¶å€™ï¼Œå‘ç°å‡ ä¹æ¯éš”1-2så°±æœ‰ç½‘å¡é‡å¯çš„æ—¥å¿—ï¼š<br>[12528931.704091] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528933.478267] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528933.908089] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528936.420314] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528938.116022] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528948.595812] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528950.439906] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528951.949896] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528952.643856] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528953.305133] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528954.847848] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br>[12528980.928031] ixgbe 0000:01:00.0 em1: NIC Link is Down<br>[12528981.199552] ixgbe 0000:01:00.0 em1: NIC Link is Up 10 Gbps, Flow Control: RX&#47;TX<br><br><br>å¦å¤–æŸ¥çœ‹äº†ä¸‹è¿™ä¸ªç½‘å¡çš„ä¿¡æ¯ï¼š<br>em1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        ether 22:14:5b:e1:3e:2a  txqueuelen 1000  (Ethernet)<br>        RX packets 29473048069  bytes 29538551685381 (26.8 TiB)<br>        RX errors 755381927  dropped 0  overruns 0  frame 755381927<br>        TX packets 16901640311  bytes 17050517754286 (15.5 TiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br> RX errorsçš„æ•°é‡æœ‰ç‚¹å¤šï¼Œé€šè¿‡esçš„æ—¥å¿—æ¥çœ‹ï¼Œè¿™å°æœºå™¨ç¡®å®å’Œå…¶ä»–ä¸»æœºçš„è¿æ¥æ—¶å¸¸ä¼šè¶…æ—¶ï¼Œå¥‡æ€ªçš„æ˜¯ï¼Œå¯¹esçš„å…¶ä»–èŠ‚ç‚¹æ‰§è¡Œpingå‘½ä»¤åˆèƒ½å¤Ÿåœ¨0.1mså†…è¿”å›ã€‚æˆ‘çœ‹äº†ä¸‹ç½‘å¡ï¼Œç½‘å¡é‡‡ç”¨teamç»‘å®šçš„æ–¹å¼ï¼Œ<br>TEAM_CONFIG=&quot;{\\&quot;runner\\&quot;: {\\&quot;name\\&quot;: \\&quot;lacp\\&quot;}}&quot;ã€‚<br>è¯·æ•™ä¸‹ï¼š1ï¼‰ä¸ºä»€ä¹ˆç½‘ç»œæœ‰é—®é¢˜ï¼Œæˆ‘pingæ˜¾ç¤ºæ­£å¸¸ï¼›ï¼›2ï¼‰è¿™ç§å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¼•èµ·çš„ã€‚<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443648,"discussion_content":"ä»¥å‰ç¢°åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œæ˜¯ç½‘å¡é©±åŠ¨åˆ°å¯¼è‡´çš„ï¼Œå¯ä»¥åˆ°é©±åŠ¨ç½‘ç«™çœ‹çœ‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„é”™è¯¯ä¿®å¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552903424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73995,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1552055804,"is_pvip":false,"replies":[{"id":"27328","content":"å¯èƒ½æ˜¯æ²¡æœ‰é…ç½®ä¸­æ–­è´Ÿè½½å‡è¡¡ï¼Œæˆ–è€…é…ç½®çš„æ—¶å€™é…é”™äº†ï¼Œç»‘å®šåˆ°äº†æœ€åä¸€ä¸ªCPU","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1552348966,"ip_address":"","comment_id":73995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552055804","product_id":100020901,"comment_content":"æˆ‘æ¥è¯·æ•™äº†ï¼Œä»Šå¤©æœåŠ¡å™¨å‘ç°è¿™ä¸ªï¼Œè½¯ä¸­æ–­NET_RXä¸ºä»€ä¹ˆè¿™ä¹ˆä¸å‡è¡¡ï¼Œæ˜¯å¦æ„å‘³ç€ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>[root]# watch -d cat &#47;proc&#47;softirqs<br>Every 2.0s: cat &#47;proc&#47;softirqs                                                                                                                                                             Fri Mar  8 22:34:25 2019<br><br>                    CPU0       CPU1       CPU2       CPU3<br>          HI:          4          1          0          1<br>       TIMER:  713624971  755107323  712371160  933839267<br>      NET_TX:          2          1          3         81<br>      NET_RX:      16219      17426      17488 1270269922<br>       BLOCK:          0          0          0          0<br>BLOCK_IOPOLL:          0          0          0          0<br>     TASKLET:       5647       9600       8682      14476<br>       SCHED:  535200439  484313787  449453690  603342848<br>     HRTIMER:          0          0          0          0<br>         RCU:  206853385  237158342  227458167  255373399<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442373,"discussion_content":"å¯èƒ½æ˜¯æ²¡æœ‰é…ç½®ä¸­æ–­è´Ÿè½½å‡è¡¡ï¼Œæˆ–è€…é…ç½®çš„æ—¶å€™é…é”™äº†ï¼Œç»‘å®šåˆ°äº†æœ€åä¸€ä¸ªCPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552348966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73411,"user_name":"æ˜ç¿¼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1551880900,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551880900","product_id":100020901,"comment_content":"å–œæ¬¢è¿™ç§ç³»ç»Ÿçš„æœ‰å¥—è·¯çš„åˆ†ææ–¹æ³•","like_count":0},{"had_liked":false,"id":73020,"user_name":"ç‹ç¯æ­¦","can_delete":false,"product_type":"c1","uid":1107432,"ip_address":"","ucode":"B35FF513125BA9","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/e8/033bdbf5.jpg","comment_is_top":false,"comment_ctime":1551778154,"is_pvip":false,"replies":[{"id":"26745","content":"æ¨èä½¿ç”¨è¿›ç¨‹ç®¡ç†å·¥å…·ï¼ˆæ¯”å¦‚ systemdï¼‰ç®¡ç†æœåŠ¡ï¼Œä¸è¦ç›´æ¥åœ¨SSHä¸­å¯åŠ¨","user_name":"ä½œè€…å›å¤","user_name_real":"å€ªæœ‹é£","uid":"1001282","ctime":1551883700,"ip_address":"","comment_id":73020,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1551778154","product_id":100020901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼æä¸€ä¸ªä¸æœ¬ç¯‡æ— å…³çš„ç³»ç»Ÿæ•…éšœï¼Œæœ€è¿‘å‡ å¤©ç»å¸¸å‡ºç°tomcatè¿›ç¨‹è‡ªåŠ¨æ¶ˆå¤±ï¼Œä¹‹å‰ç¢°åˆ°çš„ä¸€ç§æ˜¯å› ä¸ºsshè¿æ¥ä¸Šå»ï¼Œç„¶åæ‰§è¡Œbin&#47;startup.sh | tail logs&#47;catalina.outè¿™æ ·çš„å‘½ä»¤å¯åŠ¨å¹¶æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œè¿™ç§å¯åŠ¨æ–¹å¼åœ¨sshè¿æ¥æ–­å¼€çš„ç¬é—´ï¼Œä¼šå› ä¸ºçˆ¶å­è¿›ç¨‹çš„å…³ç³»ï¼Œçˆ¶è¿›ç¨‹ï¼ˆsshdï¼‰é€€å‡ºï¼Œæ‰€ä»¥tomcatè¿›ç¨‹ä¹Ÿè·Ÿç€è‡ªåŠ¨é€€å‡ºäº†ã€‚è¿™ç§å¼‚å¸¸é€€å‡ºæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š1ã€ä¼šåœ¨&#47;var&#47;log&#47;secureæ—¥å¿—ä¸­çœ‹åˆ°Mar  5 16:40:36 host-10-234-8-172 su: pam_unix(su:session): session closed for user testè¿™æ ·çš„æ—¥å¿—ï¼Œè¿™ä¸ªsession closedæ—¶é—´ç‚¹è·Ÿtomcatè¿›ç¨‹é€€å‡ºçš„æ—¶é—´ç‚¹æ˜¯ä¸€æ ·çš„ã€‚2ã€tomcatçš„catalina.outæ—¥å¿—ä¸­ä¼šæœ‰å¹³æ»‘å…³é—­é€€å‡ºçš„æ—¥å¿—ã€‚<br><br>ä½†æ˜¯æœ€è¿‘çš„æ•…éšœæ²¡æœ‰ä¸Šé¢ä¸¤ä¸ªç‰¹ç‚¹ï¼Œdmesgæ—¥å¿—æˆ–&#47;var&#47;log&#47;messagesæ—¥å¿—ä¸­ä¹Ÿæ²¡æœ‰oom killerä¹‹ç±»çš„é”™è¯¯ä¿¡æ¯ã€‚ç›®å‰åˆ†ææ²¡ä»€ä¹ˆå¤´ç»ªäº†ï¼Œè€å¸ˆçœ‹çœ‹æ˜¯å¦é‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆåˆ†ææ€è·¯ï¼Œè°¢è°¢ï¼<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441879,"discussion_content":"æ¨èä½¿ç”¨è¿›ç¨‹ç®¡ç†å·¥å…·ï¼ˆæ¯”å¦‚ systemdï¼‰ç®¡ç†æœåŠ¡ï¼Œä¸è¦ç›´æ¥åœ¨SSHä¸­å¯åŠ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551883700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1049208,"avatar":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","nickname":"james","note":"","ucode":"5701899403917C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341398,"discussion_content":"åŠ  nohup","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1610411637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}