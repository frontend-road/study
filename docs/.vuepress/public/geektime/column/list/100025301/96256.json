{"id":96256,"title":"15 | Spark SQLï¼šSparkæ•°æ®æŸ¥è¯¢çš„åˆ©å™¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è”¡å…ƒæ¥ ã€‚</p><p>ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»‹ç»äº†å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†çš„ç‰¹æ€§å’Œå®ƒæ”¯æŒçš„å„ç§æ•°æ®æ“ä½œã€‚</p><p>ä¸è¿‡åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ€»éœ€è¦åœ¨RDDçš„å±‚æ¬¡è¿›è¡Œç¼–ç¨‹ã€‚</p><p>å°±å¥½æ¯”ç¼–ç¨‹åˆšå‘æ˜çš„å¹´ä»£ï¼Œå·¥ç¨‹å¸ˆåªèƒ½ç”¨æ±‡ç¼–è¯­è¨€ï¼Œåˆ°åæ¥æ‰æ…¢æ…¢å‘å±•å‡ºé«˜çº§è¯­è¨€ï¼Œå¦‚Basicã€Cã€Javaç­‰ã€‚ä½¿ç”¨é«˜çº§è¯­è¨€å¤§å¤§æå‡äº†å¼€å‘è€…çš„æ•ˆç‡ã€‚</p><p>åŒæ ·çš„ï¼ŒSparkç”Ÿæ€ç³»ç»Ÿä¹Ÿæä¾›å¾ˆå¤šåº“ï¼Œè®©æˆ‘ä»¬åœ¨ä¸åŒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><p>ä»Šå¤©ï¼Œè®©æˆ‘ä»¬æ¥ä¸€èµ·æ¢è®¨Sparkæœ€å¸¸ç”¨çš„æ•°æ®æŸ¥è¯¢æ¨¡å—â€”â€”Spark SQLã€‚</p><h2>Spark SQL å‘å±•å†å²</h2><p>å‡ å¹´å‰ï¼ŒHadoop/MapReduceåœ¨ä¼ä¸šç”Ÿäº§ä¸­çš„å¤§é‡ä½¿ç”¨ï¼ŒHDFSä¸Šç§¯ç´¯äº†å¤§é‡æ•°æ®ã€‚</p><p>ç”±äºMapReduceå¯¹äºå¼€å‘è€…è€Œè¨€ä½¿ç”¨éš¾åº¦è¾ƒå¤§ï¼Œå¤§éƒ¨åˆ†å¼€å‘äººå‘˜æœ€ç†Ÿæ‚‰çš„è¿˜æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å¤§å¤šæ•°å¼€å‘äººå‘˜ä½¿ç”¨Hadoopï¼ŒHiveåº”è¿è€Œç”Ÿã€‚</p><p>Hiveæä¾›ç±»ä¼¼SQLçš„ç¼–ç¨‹æ¥å£ï¼ŒHQLè¯­å¥ç»è¿‡è¯­æ³•è§£æã€é€»è¾‘è®¡åˆ’ã€ç‰©ç†è®¡åˆ’è½¬åŒ–æˆMapReduceç¨‹åºæ‰§è¡Œï¼Œä½¿å¾—å¼€å‘äººå‘˜å¾ˆå®¹æ˜“å¯¹HDFSä¸Šå­˜å‚¨çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æã€‚</p><p>åœ¨Sparkåˆšé—®ä¸–çš„æ—¶å€™ï¼ŒSparkå›¢é˜Ÿä¹Ÿå¼€å‘äº†ä¸€ä¸ªSharkæ¥æ”¯æŒç”¨SQLè¯­è¨€æ¥æŸ¥è¯¢Sparkçš„æ•°æ®ã€‚</p><p>Sharkçš„æœ¬è´¨å°±æ˜¯Hiveï¼Œå®ƒä¿®æ”¹äº†Hiveçš„å†…å­˜ç®¡ç†æ¨¡å—ï¼Œå¤§å¹…ä¼˜åŒ–äº†è¿è¡Œé€Ÿåº¦ï¼Œæ˜¯Hiveçš„10å€åˆ°100å€ä¹‹å¤šã€‚</p><!-- [[[read_end]]] --><p>ä½†æ˜¯ï¼ŒSharkå¯¹äºHiveçš„ä¾èµ–ä¸¥é‡å½±å“äº†Sparkçš„å‘å±•ã€‚Sparkæƒ³è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æŠ€æœ¯æ ˆå’Œå®Œæ•´çš„ç”Ÿæ€ï¼Œä¸å¯èƒ½å…è®¸æœ‰è¿™æ ·çš„å¤–åœ¨ä¾èµ–ã€‚</p><p>è¯•æƒ³ï¼Œå¦‚æœSparkæƒ³å‘å¸ƒæ–°çš„åŠŸèƒ½è¿˜éœ€è¦ç­‰Hiveçš„æ›´æ–°ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šå¾ˆéš¾æ‰§è¡Œã€‚æ­¤å¤–ï¼Œä¾èµ–äºHiveè¿˜åˆ¶çº¦äº†Sparkå„ä¸ªç»„ä»¶çš„ç›¸äº’é›†æˆï¼ŒSharkä¹Ÿæ— æ³•åˆ©ç”¨Sparkçš„ç‰¹æ€§è¿›è¡Œæ·±åº¦ä¼˜åŒ–ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/68/75/68a739ff869d714a32c7760d1a439a75.png?wh=4758*2667\" alt=\"\"></p><p>æ‰€ä»¥ï¼Œ2014å¹´7æœˆ1æ—¥ï¼ŒSparkå›¢é˜Ÿå°±å°†Sharkäº¤ç»™Hiveè¿›è¡Œç®¡ç†ï¼Œè½¬è€Œå¼€å‘äº†SparkSQLã€‚</p><p>SparkSQLæ‘’å¼ƒäº†Sharkçš„ï¼ˆå°†SQLè¯­å¥è½¬åŒ–ä¸ºSpark RDDçš„ï¼‰æ‰§è¡Œå¼•æ“ï¼Œæ¢æˆè‡ªå·±å›¢é˜Ÿé‡æ–°å¼€å‘çš„æ‰§è¡Œå¼•æ“ã€‚</p><p>Spark SQLä¸ä»…å°†å…³ç³»å‹æ•°æ®åº“çš„å¤„ç†æ¨¡å¼å’ŒSparkçš„å‡½æ•°å¼ç¼–ç¨‹ç›¸ç»“åˆï¼Œè¿˜å…¼å®¹å¤šç§æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬Hiveã€RDDã€JSONæ–‡ä»¶ã€CSVæ–‡ä»¶ç­‰ã€‚</p><p>å¯ä»¥è¯´ï¼ŒSpark SQLçš„é—®ä¸–å¤§å¤§åŠ å¿«äº†Sparkç”Ÿæ€çš„å‘å±•ã€‚</p><h2>Spark SQLçš„æ¶æ„</h2><p>Spark SQLæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåº“ã€‚å®ƒè¿è¡Œåœ¨Sparkçš„æ ¸å¿ƒæ‰§è¡Œå¼•æ“ä¹‹ä¸Šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/13/3bdb29b1d697e3530d1efbd05e694e13.png?wh=4758*2667\" alt=\"\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®ƒæä¾›ç±»ä¼¼äºSQLçš„æ“ä½œæ¥å£ï¼Œå…è®¸æ•°æ®ä»“åº“åº”ç”¨ç¨‹åºç›´æ¥è·å–æ•°æ®ï¼Œå…è®¸ä½¿ç”¨è€…é€šè¿‡å‘½ä»¤è¡Œæ“ä½œæ¥äº¤äº’åœ°æŸ¥è¯¢æ•°æ®ï¼Œè¿˜æä¾›ä¸¤ä¸ªAPIï¼šDataFrame APIå’ŒDataSet APIã€‚</p><p>Javaã€Pythonå’ŒScalaçš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªAPIæ¥è¯»å–å’Œå†™å…¥RDDã€‚</p><p>æ­¤å¤–ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€è®²ä»‹ç»çš„ï¼Œåº”ç”¨ç¨‹åºè¿˜å¯ä»¥ç›´æ¥æ“ä½œRDDã€‚</p><p>ä½¿ç”¨Spark SQLä¼šè®©å¼€å‘è€…è§‰å¾—å¥½åƒæ˜¯åœ¨æ“ä½œä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œè€Œä¸æ˜¯åœ¨æ“ä½œRDDã€‚è¿™æ˜¯å®ƒä¼˜äºåŸç”Ÿçš„RDD APIçš„åœ°æ–¹ã€‚</p><p>ä¸åŸºæœ¬çš„Spark RDD APIä¸åŒï¼ŒSpark SQLæä¾›çš„æ¥å£ä¸ºSparkæä¾›äº†å…³äºæ•°æ®ç»“æ„å’Œæ­£åœ¨æ‰§è¡Œçš„è®¡ç®—çš„æ›´å¤šä¿¡æ¯ã€‚</p><p>åœ¨å†…éƒ¨ï¼ŒSpark SQLä½¿ç”¨è¿™äº›é¢å¤–çš„ä¿¡æ¯æ¥æ‰§è¡Œé¢å¤–çš„ä¼˜åŒ–ã€‚è™½ç„¶Spark SQLæ”¯æŒå¤šç§äº¤äº’æ–¹å¼ï¼Œä½†æ˜¯åœ¨è®¡ç®—ç»“æœæ—¶å‡ä½¿ç”¨ç›¸åŒçš„æ‰§è¡Œå¼•æ“ã€‚</p><p>è¿™ç§ç»Ÿä¸€æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„APIä¹‹é—´æ¥å›åˆ‡æ¢ï¼ŒåŸºäºè¿™äº›APIæä¾›äº†è¡¨è¾¾ç»™å®šè½¬æ¢çš„æœ€è‡ªç„¶çš„æ–¹å¼ã€‚</p><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£DataSetå’ŒDataFrameã€‚</p><h2>DataSet</h2><p>DataSetï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ•°æ®é›†çš„æ„æ€ï¼Œå®ƒæ˜¯Spark 1.6æ–°å¼•å…¥çš„æ¥å£ã€‚</p><p>åŒå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ç±»ä¼¼ï¼ŒDataSetä¹Ÿæ˜¯ä¸å¯å˜åˆ†å¸ƒå¼çš„æ•°æ®å•å…ƒï¼Œå®ƒæ—¢æœ‰ä¸RDDç±»ä¼¼çš„å„ç§è½¬æ¢å’ŒåŠ¨ä½œå‡½æ•°å®šä¹‰ï¼Œè€Œä¸”è¿˜äº«å—Spark SQLä¼˜åŒ–è¿‡çš„æ‰§è¡Œå¼•æ“ï¼Œä½¿å¾—æ•°æ®æœç´¢æ•ˆç‡æ›´é«˜ã€‚</p><p>DataSetæ”¯æŒçš„è½¬æ¢å’ŒåŠ¨ä½œä¹Ÿå’ŒRDDç±»ä¼¼ï¼Œæ¯”å¦‚mapã€filterã€selectã€countã€showåŠæŠŠæ•°æ®å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>åŒæ ·åœ°ï¼ŒDataSetä¸Šçš„è½¬æ¢æ“ä½œä¹Ÿä¸ä¼šè¢«ç«‹åˆ»æ‰§è¡Œï¼Œåªæ˜¯å…ˆç”Ÿæˆæ–°çš„DataSetï¼Œåªæœ‰å½“é‡åˆ°åŠ¨ä½œæ“ä½œï¼Œæ‰ä¼šæŠŠä¹‹å‰çš„è½¬æ¢æ“ä½œä¸€å¹¶æ‰§è¡Œï¼Œç”Ÿæˆç»“æœã€‚</p><p>æ‰€ä»¥ï¼ŒDataSetçš„å†…éƒ¨ç»“æ„åŒ…å«äº†é€»è¾‘è®¡åˆ’ï¼Œå³ç”Ÿæˆè¯¥æ•°æ®é›†æ‰€éœ€è¦çš„è¿ç®—ã€‚</p><p>å½“åŠ¨ä½œæ“ä½œæ‰§è¡Œæ—¶ï¼ŒSpark SQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–è¿™ä¸ªé€»è¾‘è®¡åˆ’ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¯ä»¥åˆ†å¸ƒå¼æ‰§è¡Œçš„ã€åŒ…å«åˆ†åŒºä¿¡æ¯çš„ç‰©ç†è®¡åˆ’ã€‚</p><p>é‚£ä¹ˆï¼ŒDataSetå’ŒRDDçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é€šè¿‡ä¹‹å‰çš„å™è¿°ï¼Œæˆ‘ä»¬çŸ¥é“DataSet APIæ˜¯Spark SQLçš„ä¸€ä¸ªç»„ä»¶ã€‚é‚£ä¹ˆï¼Œä½ åº”è¯¥èƒ½å¾ˆå®¹æ˜“åœ°è”æƒ³åˆ°ï¼ŒDataSetä¹Ÿå…·æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­è¡¨çš„ç‰¹æ€§ã€‚</p><p>æ˜¯çš„ï¼ŒDataSetæ‰€æè¿°çš„æ•°æ®éƒ½è¢«ç»„ç»‡åˆ°æœ‰åå­—çš„åˆ—ä¸­ï¼Œå°±åƒå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ä¸€æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5a/e3/5a6fd6e91c92c166d279711bf9c761e3.png?wh=4758*2286\" alt=\"\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦ä¾§çš„RDDè™½ç„¶ä»¥Peopleä¸ºç±»å‹å‚æ•°ï¼Œä½†Sparkæ¡†æ¶æœ¬èº«ä¸äº†è§£Peopleç±»çš„å†…éƒ¨ç»“æ„ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½ä»¥Peopleä¸ºå•ä½æ‰§è¡Œã€‚</p><p>è€Œå³ä¾§çš„DataSetå´æä¾›äº†è¯¦ç»†çš„ç»“æ„ä¿¡æ¯ä¸æ¯åˆ—çš„æ•°æ®ç±»å‹ã€‚</p><p>è¿™è®©Spark SQLå¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¯¥æ•°æ®é›†ä¸­åŒ…å«å“ªäº›åˆ—ï¼Œæ¯åˆ—çš„åç§°å’Œç±»å‹å„æ˜¯ä»€ä¹ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDataSetæä¾›æ•°æ®è¡¨çš„schemaä¿¡æ¯ã€‚è¿™æ ·çš„ç»“æ„ä½¿å¾—DataSet APIçš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚</p><p>è¯•æƒ³ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥è¯¢Peopleçš„å¹´é¾„ä¿¡æ¯ï¼ŒSpark SQLæ‰§è¡Œçš„æ—¶å€™å¯ä»¥ä¾é æŸ¥è¯¢ä¼˜åŒ–å™¨ä»…ä»…æŠŠéœ€è¦çš„é‚£ä¸€åˆ—å–å‡ºæ¥ï¼Œå…¶ä»–åˆ—çš„ä¿¡æ¯æ ¹æœ¬å°±ä¸éœ€è¦å»è¯»å–äº†ã€‚æ‰€ä»¥ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯ä»¥ååœ¨ç¼–è¯‘çš„æ—¶å€™èƒ½å¤Ÿåšæ›´å¤šçš„ä¼˜åŒ–ã€‚</p><p>å…¶æ¬¡ï¼Œç”±äºDataSetå­˜å‚¨äº†æ¯åˆ—çš„æ•°æ®ç±»å‹ã€‚æ‰€ä»¥ï¼Œåœ¨ç¨‹åºç¼–è¯‘æ—¶å¯ä»¥æ‰§è¡Œç±»å‹æ£€æµ‹ã€‚</p><h2>DataFrame</h2><p>DataFrameå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„DataSetã€‚å®ƒä¹Ÿæ˜¯å…³ç³»å‹æ•°æ®åº“ä¸­è¡¨ä¸€æ ·çš„ç»“æ„åŒ–å­˜å‚¨æœºåˆ¶ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚</p><p>ä½†æ˜¯ï¼Œå®ƒçš„æ¯ä¸€åˆ—å¹¶ä¸å­˜å‚¨ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å¹¶ä¸èƒ½å‘ç°ç±»å‹é”™è¯¯ã€‚DataFrameæ¯ä¸€è¡Œçš„ç±»å‹å›ºå®šä¸ºRowï¼Œä»–å¯ä»¥è¢«å½“ä½œDataSet[Row]æ¥å¤„ç†ï¼Œæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡è§£ææ‰èƒ½è·å–å„åˆ—çš„å€¼ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºDataSetæˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼people.nameæ¥è®¿é—®ä¸€ä¸ªäººçš„åå­—ï¼Œè€Œå¯¹äºDataFrameæˆ‘ä»¬ä¸€å®šè¦ç”¨ç±»ä¼¼people.get As [String] (â€œnameâ€)æ¥è®¿é—®ã€‚</p><h2>RDDã€DataFrameã€DataSetå¯¹æ¯”</h2><p>å­¦ä¹ Sparkåˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ¥è§¦äº†ä¸‰ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼šRDDã€DataFrameå’ŒDataSetã€‚æ¥ä¸‹æ¥ä½ çš„è¡¨æ ¼ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å¼‚åŒç‚¹ï¼Œæ€è€ƒä¸€ä¸‹æ€æ ·åœ¨å®é™…å·¥ç¨‹ä¸­é€‰æ‹©ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/40/ef/40691757146e1b480e08969e676644ef.png?wh=4758*1843\" alt=\"\"></p><h3>å‘å±•å†å²</h3><p>ä»å‘å±•å†å²ä¸Šæ¥çœ‹ï¼ŒRDD APIåœ¨ç¬¬ä¸€ä»£Sparkä¸­å°±å­˜åœ¨ï¼Œæ˜¯æ•´ä¸ªSparkæ¡†æ¶çš„åŸºçŸ³ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†æ–¹ä¾¿ç†Ÿæ‚‰å…³ç³»å‹æ•°æ®åº“å’ŒSQLçš„å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œåœ¨RDDçš„åŸºç¡€ä¸Šï¼ŒSparkåˆ›å»ºäº†DataFrame APIã€‚ä¾é å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¯¹æ•°æ®çš„åˆ—è¿›è¡Œæ“ä½œã€‚</p><p>DataSetæœ€æ—©è¢«åŠ å…¥Spark SQLæ˜¯åœ¨Spark 1.6ï¼Œå®ƒåœ¨DataFrameçš„åŸºç¡€ä¸Šæ·»åŠ äº†å¯¹æ•°æ®çš„æ¯ä¸€åˆ—çš„ç±»å‹çš„é™åˆ¶ã€‚</p><p>åœ¨Spark 2.0ä¸­ï¼ŒDataFrameå’ŒDataSetè¢«ç»Ÿä¸€ã€‚DataFrameä½œä¸ºDataSet[Row]å­˜åœ¨ã€‚åœ¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œå¦‚Pythonä¸­ï¼ŒDataFrame APIä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯åœ¨Javaä¸­ï¼ŒDataFrame APIå·²ç»ä¸å¤å­˜åœ¨äº†ã€‚</p><h3>ä¸å˜æ€§ä¸åˆ†åŒº</h3><p>ç”±äºDataSetå’ŒDataFrameéƒ½æ˜¯åŸºäºRDDçš„ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ‹¥æœ‰RDDçš„åŸºæœ¬ç‰¹æ€§ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„ APIåœ¨ DataFrameæˆ– Datasetä¸RDDä¹‹é—´è¿›è¡Œæ— ç¼åˆ‡æ¢ã€‚</p><h3>æ€§èƒ½</h3><p>DataFrameå’ŒDataSetçš„æ€§èƒ½è¦æ¯”RDDæ›´å¥½ã€‚</p><p>Sparkç¨‹åºè¿è¡Œæ—¶ï¼ŒSpark SQLä¸­çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¯¹è¯­å¥è¿›è¡Œåˆ†æï¼Œå¹¶ç”Ÿæˆä¼˜åŒ–è¿‡çš„RDDåœ¨åº•å±‚æ‰§è¡Œã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å…ˆå¯¹ä¸€å †æ•°æ®è¿›è¡ŒGroupByå†è¿›è¡ŒFilteræ“ä½œï¼Œè¿™æ— ç–‘æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹æ‰€æœ‰æ•°æ®éƒ½GroupByã€‚</p><p>å¦‚æœç”¨RDD APIå®ç°è¿™ä¸€è¯­å¥ï¼Œåœ¨æ‰§è¡Œæ—¶å®ƒåªä¼šæœºæ¢°åœ°æŒ‰é¡ºåºæ‰§è¡Œã€‚è€Œå¦‚æœç”¨DataFrame/DataSet APIï¼ŒSpark SQLçš„Catalystä¼˜åŒ–å™¨ä¼šå°†Filteræ“ä½œå’ŒGroupByæ“ä½œè°ƒæ¢é¡ºåºï¼Œä»è€Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p><p>ä¸‹å›¾åæ˜ äº†è¿™ä¸€ä¼˜åŒ–è¿‡ç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d6/42/d6162126bae14517aa163b3885c13a42.png?wh=4758*1693\" alt=\"\"></p><h3>é”™è¯¯æ£€æµ‹</h3><p>RDDå’ŒDataSetéƒ½æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œè€ŒDataFrameå¹¶ä¸æ˜¯ç±»å‹å®‰å…¨çš„ã€‚è¿™æ˜¯å› ä¸ºå®ƒä¸å­˜å‚¨æ¯ä¸€åˆ—çš„ä¿¡æ¯å¦‚åå­—å’Œç±»å‹ã€‚</p><p>ä½¿ç”¨DataFrame APIæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªå¹¶ä¸å­˜åœ¨çš„åˆ—ï¼Œè¿™ä¸ªé”™è¯¯åªæœ‰åœ¨ä»£ç è¢«æ‰§è¡Œæ—¶æ‰ä¼šæŠ›å‡ºã€‚å¦‚æœä½¿ç”¨DataSet APIï¼Œåœ¨ç¼–è¯‘æ—¶å°±ä¼šæ£€æµ‹åˆ°è¿™ä¸ªé”™è¯¯ã€‚</p><h2>å°ç»“</h2><p>DataFrameå’ŒDataSetæ˜¯Spark SQLæä¾›çš„åŸºäºRDDçš„ç»“æ„åŒ–æ•°æ®æŠ½è±¡ã€‚</p><p>å®ƒæ—¢æœ‰RDDä¸å¯å˜ã€åˆ†åŒºã€å­˜å‚¨ä¾èµ–å…³ç³»ç­‰ç‰¹æ€§ï¼Œåˆæ‹¥æœ‰ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚</p><p>æ‰€ä»¥ï¼ŒåŸºäºDataFrameå’ŒDataSet APIå¼€å‘å‡ºçš„ç¨‹åºä¼šè¢«è‡ªåŠ¨ä¼˜åŒ–ï¼Œä½¿å¾—å¼€å‘äººå‘˜ä¸éœ€è¦æ“ä½œåº•å±‚çš„RDD APIæ¥è¿›è¡Œæ‰‹åŠ¨ä¼˜åŒ–ï¼Œå¤§å¤§æå‡å¼€å‘æ•ˆç‡ã€‚</p><p>ä½†æ˜¯RDD APIå¯¹äºéç»“æ„åŒ–çš„æ•°æ®å¤„ç†æœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚æ–‡æœ¬æµæ•°æ®ï¼Œè€Œä¸”æ›´æ–¹ä¾¿æˆ‘ä»¬åšåº•å±‚çš„æ“ä½œã€‚æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©ä½¿ç”¨å“ªç§APIã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨DataFrame APIï¼Œä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨DataSet APIï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠç­”æ¡ˆå†™åœ¨ç•™è¨€åŒºï¼Œä¸æˆ‘å’Œå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚</p><p>å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p></p>","comments":[{"had_liked":false,"id":96602,"user_name":":)","can_delete":false,"product_type":"c1","uid":1239198,"ip_address":"","ucode":"23D505949442B6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/9e/6550a051.jpg","comment_is_top":false,"comment_ctime":1558457490,"is_pvip":false,"replies":[{"id":"48474","content":"å¾ˆå¥½çš„æ€»ç»“","user_name":"ä½œè€…å›å¤","user_name_real":"Xinyue Li","uid":"1502409","ctime":1567373759,"ip_address":"","comment_id":96602,"utype":1}],"discussion_count":2,"race_medal":0,"score":"143292378258","product_id":100025301,"comment_content":"ä»»ä½•ä¸€ä¸ªç”Ÿå‘½åŠ›çš„å­˜åœ¨ä¸å‘å±•éƒ½æºäºå†å²èƒŒæ™¯ä¸‹çš„éœ€æ±‚ã€‚<br>1.  hive sqlè™½å¥½ï¼Œä½†æ˜¯é™åˆ¶äº†sparkçš„å‘å±•ï¼Œhive sqlå·²ç»æ»¡è¶³ä¸äº†å¹¿å‘äººæ°‘ç¾¤ä¼—å¯¹spark sqlçš„çš„å¼ºçƒˆéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥ç¤¾ä¼šä¸»ä¹‰ç¤¾ä¼šï¼Œä½ å´è¿˜æ˜¯ç”¨çŸ³å¤´æ‰“çŒï¼Œï¼Œä¸è¡Œæ»´ï¼Œï¼Œ<br>2. RDDæ˜¯sparkè¿™åº§å¤§å¦çš„åŸºçŸ³ï¼Œé‚£å—ç –å°±æ˜¯RDDã€‚RDDèµ‹äºˆäº†çµæ´»æ€§ï¼Œä½†å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤æ‚æ€§ã€‚çµæ´»æ€§å’Œå¤æ‚æ€§æ˜¯ä¸€å¯¹æ°¸ä¹…ä¸å˜çš„çŸ›ç›¾ã€‚<br>3.Datasetä¸DataFrameã€‚æˆ‘ç°åœ¨è¦å»ºä¸ªæˆ¿å­ï¼Œä½ ç›´æ¥ç»™æˆ‘4é¢å¢™ä¸€ä¸ªé¡¶å°±å¤Ÿäº†ï¼Œä¸è¦ä¸€å—ç –ä¸€å—ç –çš„ç»™æˆ‘ï¼Œæˆ‘ä¸ä½†å¾ˆæ‡’è€Œä¸”å¾ˆç¬¨ã€‚Datasetä¸DataFrameæ˜¯æ ¹æ®é€šç”¨ç»“æ„åŒ–æ•°æ®å¤„ç†çš„å»ºç«‹åœ¨RDDä¹‹ä¸Šçš„å°è£…ã€‚å¸¦æ¥çš„ä¾¿æ˜“æ€§ä½†æ˜¯é™ä½äº†ä¸€å®šçš„çµæ´»æ€§ã€‚","like_count":32,"discussions":[{"author":{"id":1502409,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ec/c9/45bfcba3.jpg","nickname":"Xinyue Li","note":"","ucode":"0CB92610C8B9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450930,"discussion_content":"å¾ˆå¥½çš„æ€»ç»“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567373759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1266620,"avatar":"https://static001.geekbang.org/account/avatar/00/13/53/bc/72baeee8.jpg","nickname":"æ—é»›ç‰","note":"","ucode":"F8507366012881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":10961,"discussion_content":"è¯¾ä»£è¡¨è¯·åã€‚\nâ‘ Sharkçš„æ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨è¿›è¡ŒæŠ€æœ¯é€‰å‹æ—¶ï¼Œä¸ä»…è¦è€ƒè™‘éš¾æ˜“ç¨‹åº¦ï¼Œè¿˜éœ€è€ƒè™‘æœªæ¥çš„è·¯ï¼›\nâ‘¡Sqlçš„æ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œå…±è¯†å§‹ç»ˆæ˜¯é‡è¦çš„å› ç´ ï¼Œå’Œå¹¿å¤§äººæ°‘ç¾¤ä¼—ç«™åœ¨ä¸€èµ·ï¼Œè€Œç¾¤ä¼—åçˆ±ç»§æ‰¿ã€è§„èŒƒã€å…±è¯†ã€ç®€æ´ï¼›\nâ‘¢é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ä¹ˆï¼Œåšå¥½åˆ†ç±»å°±å¯ä»¥ï¼Œé¥¿åäº†å°±ç»™ç†ŠæŒ(dataset),éšä¾¿ä¸¤å£å°±å®¹æ˜“æ»¡è¶³ï¼Œå°èµ„çš„è¯å°±ç»™é±¼ï¼ˆRDDï¼‰ï¼Œè½»æŒ‘å¤æ’®ï¼Œæ…¢æ…¢å“ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1568343547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96644,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1558483806,"is_pvip":false,"replies":[{"id":"48501","content":"å—¯ï¼ŒåŸºæœ¬ä¸Šè¯´çš„æ²¡é”™ï¼Œè€Œä¸”åœ¨éœ€è¦ç±»å‹æ£€æµ‹çš„æ—¶å€™è¦ç”¨DataSetã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Xinyue Li","uid":"1502409","ctime":1567384520,"ip_address":"","comment_id":96644,"utype":1}],"discussion_count":1,"race_medal":0,"score":"104637698910","product_id":100025301,"comment_content":"å¾…å¤„ç†æ•°æ®çš„schemaæ˜¯é™æ€çš„ä¸”å¯¹å…¶å®Œå…¨æŒæ§çš„æƒ…å†µä¸‹ç”¨DataSetï¼Œåä¹‹ç”¨DataFrame","like_count":25,"discussions":[{"author":{"id":1502409,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ec/c9/45bfcba3.jpg","nickname":"Xinyue Li","note":"","ucode":"0CB92610C8B9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450950,"discussion_content":"å—¯ï¼ŒåŸºæœ¬ä¸Šè¯´çš„æ²¡é”™ï¼Œè€Œä¸”åœ¨éœ€è¦ç±»å‹æ£€æµ‹çš„æ—¶å€™è¦ç”¨DataSetã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567384520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96612,"user_name":"æ¶µ","can_delete":false,"product_type":"c1","uid":1502742,"ip_address":"","ucode":"BB8575DB13F1E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/ee/16/742956ac.jpg","comment_is_top":false,"comment_ctime":1558466445,"is_pvip":false,"replies":[{"id":"48502","content":"ğŸ‘ğŸ»ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"Xinyue Li","uid":"1502409","ctime":1567384550,"ip_address":"","comment_id":96612,"utype":1}],"discussion_count":2,"race_medal":0,"score":"74572910477","product_id":100025301,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘çŒœæƒ³DataSeté€‚ç”¨äºæ¯åˆ—ç±»å‹ç¨‹åºéƒ½å¾ˆç¡®å®šæ—¶ä½¿ç”¨ï¼Œè€ŒDataFrameé€‚ç”¨äºåˆ—çš„ç±»å‹ä¸ç¡®å®šï¼Œç±»ä¼¼äºgenericçš„ç±»å‹ï¼Œæ‹¿åˆ°æ•°æ®åæ ¹æ®æ•°æ®ç±»å‹å†è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚æ˜¯å¦å¯ä»¥è¿™æ ·ç†è§£?","like_count":18,"discussions":[{"author":{"id":1502409,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ec/c9/45bfcba3.jpg","nickname":"Xinyue Li","note":"","ucode":"0CB92610C8B9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450936,"discussion_content":"ğŸ‘ğŸ»ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567384550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129610,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg","nickname":"test","note":"","ucode":"C57A175CBC6547","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382946,"discussion_content":"åˆ—çš„ç±»å‹æ€ä¹ˆä¼šä¸ç¡®å®šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625803815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96737,"user_name":"Geek_9319","can_delete":false,"product_type":"c1","uid":1535449,"ip_address":"","ucode":"90C84C0048D73F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELtsib7NQO2NaEubNbfbAqh8FQDibTuUon1QNHvbV1vD1Vo9vO8wymibTria6nIO3hakJNfrY1okseuRQ/132","comment_is_top":false,"comment_ctime":1558494968,"is_pvip":false,"replies":[{"id":"48500","content":"DataFrameå¯ä»¥çœ‹åšæ˜¯DataSetçš„æ— ç±»å‹ç‰¹ä¾‹ï¼Œè®¤ä¸ºæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªRow objectã€‚ä½†æ˜¯å…ˆæå‡ºçš„æ˜¯DataFrame, åæ¥æ‰å‘å±•å‡ºäº†DataSetå¹¶å°†ä¸¤è€…ç»Ÿä¸€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Xinyue Li","uid":"1502409","ctime":1567384409,"ip_address":"","comment_id":96737,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27328298744","product_id":100025301,"comment_content":"åˆ°åº• DataSetæ˜¯DataFrameçš„ç‰¹ä¾‹ï¼Ÿè¿˜æ˜¯DataFrame æ˜¯DataSetçš„ç‰¹ä¾‹ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1502409,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ec/c9/45bfcba3.jpg","nickname":"Xinyue Li","note":"","ucode":"0CB92610C8B9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450996,"discussion_content":"DataFrameå¯ä»¥çœ‹åšæ˜¯DataSetçš„æ— ç±»å‹ç‰¹ä¾‹ï¼Œè®¤ä¸ºæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªRow objectã€‚ä½†æ˜¯å…ˆæå‡ºçš„æ˜¯DataFrame, åæ¥æ‰å‘å±•å‡ºäº†DataSetå¹¶å°†ä¸¤è€…ç»Ÿä¸€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567384409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518906,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2d/3a/412825c9.jpg","nickname":"å­ç³»","note":"","ucode":"CF1149D8EE02F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333744,"discussion_content":"åº”è¯¥ç†è§£ä¸º dataset ç»§æ‰¿è‡ªdataframe","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607608046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125427,"user_name":"leesper","can_delete":false,"product_type":"c1","uid":1351104,"ip_address":"","ucode":"CC76320571BECA","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/c0/cb5341ec.jpg","comment_is_top":false,"comment_ctime":1566183286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14451085174","product_id":100025301,"comment_content":"æ„Ÿè§‰è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„Schema-on-readï¼Œä¼ ç»Ÿçš„æ•°æ®ä»“åº“åªèƒ½å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼Œå¯¹äºéç»“æ„åŒ–æ•°æ®çš„ï¼Œåæ¥æœ‰äº†data lake","like_count":4},{"had_liked":false,"id":103446,"user_name":"ç…å‰‘","can_delete":false,"product_type":"c1","uid":1504220,"ip_address":"","ucode":"4290D5C140F80F","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/dc/80b0cd23.jpg","comment_is_top":false,"comment_ctime":1560436497,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14445338385","product_id":100025301,"comment_content":"DataSetåœ¨éœ€è¦è®¿é—®åˆ—ä¸­çš„æŸä¸ªå­—æ®µæ—¶æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œä½†æ˜¯å¦‚æœè¦å†™ä¸€äº›é€‚é…æ€§å¾ˆå¼ºçš„å‡½æ•°æ—¶ï¼Œå¦‚æœä½¿ç”¨DataSetï¼Œè¡Œçš„ç±»å‹æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œå¯èƒ½æ˜¯å„ç§case classï¼Œè¿™æ—¶å€™ç”¨DataFrameå°±å¯ä»¥æ¯”è¾ƒå¥½åœ°è§£å†³é—®é¢˜","like_count":3},{"had_liked":false,"id":96902,"user_name":"æœ±åŒå­¦","can_delete":false,"product_type":"c1","uid":1514233,"ip_address":"","ucode":"2EF7D5A051712C","user_header":"https://static001.geekbang.org/account/avatar/00/17/1a/f9/180f347a.jpg","comment_is_top":false,"comment_ctime":1558532244,"is_pvip":false,"replies":[{"id":"48473","content":"è¯´çš„å¾ˆå¯¹ï¼ŒDataFrameçš„åŠŸèƒ½å¯ä»¥çœ‹åšæ˜¯Datasetçš„å­é›†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Xinyue Li","uid":"1502409","ctime":1567373683,"ip_address":"","comment_id":96902,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14443434132","product_id":100025301,"comment_content":"å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç”¨datasetéƒ½æ²¡é—®é¢˜ï¼Œé™åˆ¶å› ç´ ä¸»è¦æ˜¯sparkç‰ˆæœ¬","like_count":4,"discussions":[{"author":{"id":1502409,"avatar":"https://static001.geekbang.org/account/avatar/00/16/ec/c9/45bfcba3.jpg","nickname":"Xinyue Li","note":"","ucode":"0CB92610C8B9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451055,"discussion_content":"è¯´çš„å¾ˆå¯¹ï¼ŒDataFrameçš„åŠŸèƒ½å¯ä»¥çœ‹åšæ˜¯Datasetçš„å­é›†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567373683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100610,"user_name":"CoderLean","can_delete":false,"product_type":"c1","uid":1518409,"ip_address":"","ucode":"DC9E25428EDB3F","user_header":"https://static001.geekbang.org/account/avatar/00/17/2b/49/e94b2a35.jpg","comment_is_top":false,"comment_ctime":1559606156,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5854573452","product_id":100025301,"comment_content":"å®é™…ä¸Šå¦‚æœåªæ˜¯å› ä¸ºhiveçš„ä¸è¶³ï¼Œä¸ºä»€ä¹ˆä¸ç”¨impalaä»£æ›¿ï¼Œæ€§èƒ½ä¹Ÿæ¯”sparklsqlé«˜","like_count":1,"discussions":[{"author":{"id":1970391,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/10/d7/65ff6e5d.jpg","nickname":"æœºæ™ºçš„æèµ›è‰‡","note":"","ucode":"66794F6816DD26","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344411,"discussion_content":"impalaæ˜¯mppçš„ï¼Œæœ¬èº«æ˜¯æœ‰ç“¶é¢ˆçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611456411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97563,"user_name":"brv","can_delete":false,"product_type":"c1","uid":1254213,"ip_address":"","ucode":"DD94D8C2085EAB","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/45/3addffe7.jpg","comment_is_top":false,"comment_ctime":1558695930,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853663226","product_id":100025301,"comment_content":"datasetæ˜¯åœ¨dateframeåŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ï¼Œé‚£datesetæ˜¯dateframeçš„ç‰¹ä¾‹","like_count":1},{"had_liked":false,"id":96661,"user_name":"RocWay","can_delete":false,"product_type":"c1","uid":1088024,"ip_address":"","ucode":"377CD114BABBF7","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/18/3596069c.jpg","comment_is_top":false,"comment_ctime":1558485850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853453146","product_id":100025301,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼šæ—¢ç„¶dataframeæ²¡æœ‰å­˜å‚¨å…·ä½“çš„ç±»å‹ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥è®¤ä¸ºdataframeå…·æœ‰åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼Ÿä¹Ÿå°±æ˜¯è¯´å½“æ•°æ®ç±»å‹å˜åŒ–åï¼Œç¨‹åºèƒ½å¤Ÿè‡ªåŠ¨é€‚åº”ã€‚å®ç°èµ·æ¥å¯å¦è¿™æ ·ï¼šå…ˆåˆ¤æ–­æŸä¸ªåå­—çš„å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå†åšå‡ºç›¸åº”çš„åŠ¨ä½œï¼Ÿ","like_count":1},{"had_liked":false,"id":247864,"user_name":"èŒ‚æ¨","can_delete":false,"product_type":"c1","uid":1181344,"ip_address":"","ucode":"8D8259E905DCA3","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/a0/3da0e315.jpg","comment_is_top":false,"comment_ctime":1599896651,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599896651","product_id":100025301,"comment_content":"è¶Šæ¥è¶Šå–œæ¬¢sparkäº†, æœ‰äº†dataframeå’Œdatasetï¼Œå°±å¯ä»¥ç”¨sqlè¿™ç§å‡½æ•°å¼è¯­è¨€åšé¡¹ç›®äº†","like_count":1},{"had_liked":false,"id":209104,"user_name":"å¨„æ±Ÿå›½","can_delete":false,"product_type":"c1","uid":1018479,"ip_address":"","ucode":"6C2AAE4E409286","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/6f/3d4f7e31.jpg","comment_is_top":false,"comment_ctime":1587504524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587504524","product_id":100025301,"comment_content":"å¦‚æœåšæ•°æ®ä»“åº“ç”¨sparksqlåšetlï¼Œé‚£ä¹ˆæ•°æ®ä»¥ä»€ä¹ˆæ ¼å¼å­˜å‚¨æœ€å¥½å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":201596,"user_name":"å¹³å®‰å–œä¹","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1585809848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585809848","product_id":100025301,"comment_content":"ä½¿ç”¨StructField(filedName, StringType, nullable = true)<br>æˆ–è€…val caseClassDS = Seq(Person(&quot;Andy&quot;, 32)).toDS(ï¼‰<br>å¦‚æœè¦æŸ¥æ•´ä¸ªè¡¨çš„å­—æ®µ  æ€ä¹ˆåŠ¨æ€çš„å¡«å……æ•°æ®å­—æ®µå¯¹åº”çš„ç±»å‹","like_count":0},{"had_liked":false,"id":157746,"user_name":"å¤2021ç‰›","can_delete":false,"product_type":"c1","uid":1676097,"ip_address":"","ucode":"A26B321F300785","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/cKeYVTKJCJhrfTCBkEGla1WA7W0S9FPZrTR3ovYJFhcKo7kl72gR9VibCufhHsjOar2Z6mZlFKb8VEkkDv9lqVA/132","comment_is_top":false,"comment_ctime":1575254736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575254736","product_id":100025301,"comment_content":"å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ç”¨datasetå’Œdataframe,rddçš„ç”¨äºæ“ä½œç»†èŠ‚çš„åœ°æ–¹","like_count":0},{"had_liked":false,"id":154806,"user_name":"wy","can_delete":false,"product_type":"c1","uid":1064681,"ip_address":"","ucode":"41C1B304E7F032","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e9/116f1dee.jpg","comment_is_top":false,"comment_ctime":1574569807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574569807","product_id":100025301,"comment_content":"dataframeæ˜¯datasetçš„å­é›†ï¼Œç±»å‹æ˜¯rowï¼Œæ‰€ä»¥dataframeé€‚åˆé‚£äº›ç¼–è¯‘é˜¶æ®µæ— æ³•ç¡®å®šå­—æ®µæ•°é‡å’Œç±»å‹çš„æŸ¥è¯¢ï¼Œdataseté€‚ç”¨é‚£äº›ç¼–è¯‘é˜¶æ®µå°±æ˜ç¡®çŸ¥é“å­—æ®µè¯¦ç»†è¯¦ç»†ä¿¡æ¯çš„åœºæ™¯ã€‚","like_count":1},{"had_liked":false,"id":113096,"user_name":"ç‹ç¿”å®‡ğŸ¼","can_delete":false,"product_type":"c1","uid":1177925,"ip_address":"","ucode":"D7AA5EDEC8D612","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/45/eaa8beb0.jpg","comment_is_top":false,"comment_ctime":1562896564,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562896564","product_id":100025301,"comment_content":"ä½•æ—¶æ£€æµ‹åˆ†æé”™è¯¯ çš„åˆ†æé”™è¯¯æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1058818,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/02/a6d7ece6.jpg","nickname":"refactor","note":"","ucode":"EC8FF55FE6EC8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2617,"discussion_content":"ç¼–è¯‘æ—¶é”™è¯¯çš„ä¸€ç§ï¼Œæ¯”å¦‚é”™åˆ«å­—ã€å‘½åä¸è§„èŒƒè¿™äº›æ˜¯è¯­æ³•é”™è¯¯ï¼Œè€Œè°ƒç”¨å‡½æ•°å‚æ•°å’Œå®šä¹‰å‚æ•°ç±»å‹ä¸ä¸€å°±æ˜¯åˆ†æé”™è¯¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563788334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112702,"user_name":"è¥¿åŒ—ååŒ—","can_delete":false,"product_type":"c1","uid":1043160,"ip_address":"","ucode":"64BD69C84EE6A1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdpKbFgRLnicjsr6qkrPVKZcFrG3aS2V51HhjFP6Mh2CYcjWric9ud1Qiclo8A49ia3eZ1NhibDib0AOCg/132","comment_is_top":false,"comment_ctime":1562808103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562808103","product_id":100025301,"comment_content":"Rddæ˜¯sparkæœ€åº•å±‚çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œä½†ç›´æ¥ä½¿ç”¨rddçš„é—¨æ§›è¾ƒé«˜ï¼Œä½ å¾—çŸ¥é“é‚£äº›åœ°æ–¹å¯ä»¥ä¼˜åŒ–ï¼Œæ¯”å¦‚filterè¦å†™åœ¨groupä¹‹å‰ã€‚å¦‚è‹¥ä¸ç„¶ï¼Œå†™å‡ºæ¥çš„è®¡ç®—ï¼Œæ€§èƒ½å…¶å·®ã€‚<br><br><br>å¹¶ä¸”rddæ²¡æœ‰å­—æ®µç±»å‹åç§°ä¿¡æ¯ï¼Œå­—æ®µçš„è·å–å’Œå¤„ç†éš¾åº¦è¾ƒé«˜ã€‚<br><br><br>æ¨èä½¿ç”¨spark sqlæ›´é¡¶å±‚ï¼Œæä¾›äº†schemaä¿¡æ¯ï¼Œæä¾›äº†å¯¹æŸ¥è¯¢çš„ä¼˜åŒ–ã€‚","like_count":1},{"had_liked":false,"id":104196,"user_name":"linuxfans","can_delete":false,"product_type":"c1","uid":1193815,"ip_address":"","ucode":"0C0BEE82F8A409","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/57/750c641d.jpg","comment_is_top":false,"comment_ctime":1560679855,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560679855","product_id":100025301,"comment_content":"Datasetå…·æœ‰ç±»å‹ä¿¡æ¯ï¼Œè€ŒDataframeæ²¡æœ‰ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¦å¤„ç†ç±»å‹åŒ–æ•°æ®ï¼Œä¾‹å¦‚æ•°å€¼å‹æ—¶ï¼Œç”¨Datasetæ›´æ–¹ä¾¿ã€‚ç†è®ºä¸Šï¼ŒDataframeå¯ä»¥ç”¨åœ¨Datasetçš„æ‰€æœ‰åœ°æ–¹ï¼Œåªæ˜¯å­—æ®µç±»å‹è¦åœ¨ç¨‹åºä¸­è‡ªå·±å¤„ç†ã€‚","like_count":0},{"had_liked":false,"id":99281,"user_name":"Geek_f406a1","can_delete":false,"product_type":"c1","uid":1453834,"ip_address":"","ucode":"62A15101047054","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/4lUeUo6LHfsHLYfKaMQXQiaZVyEsqY1nfXU6dP0wN1KCch7LDIZTCO4rJ5mq1SdqY9FibCGMsjFdknULmEQ4Octg/132","comment_is_top":false,"comment_ctime":1559186072,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559186072","product_id":100025301,"comment_content":"è¯·é—®ä½œè€… &quot;è¿˜å…¼å®¹å¤šç§æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ Hiveã€RDDã€JSON æ–‡ä»¶&quot; è¿™å¥è¯ä¸­hiveæ˜¯ä¸€ç§æ•°æ®æ ¼å¼ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1058818,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/02/a6d7ece6.jpg","nickname":"refactor","note":"","ucode":"EC8FF55FE6EC8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2619,"discussion_content":"ä¸¥æ ¼çš„è®²ä¸æ˜¯ï¼Œhive æ˜¯ä¸€ä¸ªæ•°æ®åº“è½¯ä»¶ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ spark å¯ä»¥ä»è¿™å‡ ä¸ªåœ°æ–¹æŠ½å–æ•°æ®ï¼Œç›¸å½“äºéƒ½æ˜¯æ•°æ®æº","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1563788411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96900,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1558532019,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558532019","product_id":100025301,"comment_content":"1. å¯¹äºè¯»å†™Hiveæ—¶ï¼Œé€‚åˆç”¨Dataframeï¼Œå¯ä»¥è®¤ä¸ºdfå°±æ˜¯ä¸€å¼ è¡¨ã€‚<br>2. å¯¹äºè¦æ“ä½œå…ƒç»„æˆ–è€…case classæˆ–è€…csvç­‰æ–‡ä»¶æ—¶ï¼Œé€‚åˆç”¨Datasetï¼Œå› ä¸ºæ˜¯å¼ºç±»å‹çš„","like_count":0}]}