{"id":109715,"title":"24 | 网关和BFF是如何演化出来的（上）","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":143033,"user_name":"Geek_cha","can_delete":false,"product_type":"c3","uid":1510045,"ip_address":"","ucode":"6AB056704FF22E","user_header":"","comment_is_top":false,"comment_ctime":1571622282,"is_pvip":false,"replies":[{"id":55456,"content":"你好，通过nginx暴露内部服务以后，严格讲也不能算直接暴露在公网上。但是，一般不建议通过nginx直接暴露内部服务，因为很可能会有潜在安全性问题，比如某些内部API是涉及敏感安全数据的，不能随便暴露出去，当然可以让运维帮忙在nginx上配安全策略，但是nginx配置安全策略比较麻烦，对开发人员不友好不灵活，很容易犯错，留下潜在安全隐患。通过引入BFF层，可以在内部服务和外网之间引入一层间接，一方面可以增加聚合裁剪适配的逻辑，另外还可以增加安全性，防止内部敏感API被无意暴露出去的可能性，因为BFF是开发人员负责开发的，他们有更大灵活性和控制。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1571751013,"ip_address":"","comment_id":143033,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师好，我理解这个v2版本中前端是通过nginx方向代理来访问后端服务的，为什么说这种情况下后端服务是直接暴露在公网上的，不是很理解~","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471355,"discussion_content":"你好，通过nginx暴露内部服务以后，严格讲也不能算直接暴露在公网上。但是，一般不建议通过nginx直接暴露内部服务，因为很可能会有潜在安全性问题，比如某些内部API是涉及敏感安全数据的，不能随便暴露出去，当然可以让运维帮忙在nginx上配安全策略，但是nginx配置安全策略比较麻烦，对开发人员不友好不灵活，很容易犯错，留下潜在安全隐患。通过引入BFF层，可以在内部服务和外网之间引入一层间接，一方面可以增加聚合裁剪适配的逻辑，另外还可以增加安全性，防止内部敏感API被无意暴露出去的可能性，因为BFF是开发人员负责开发的，他们有更大灵活性和控制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571751013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246031,"user_name":"椿","can_delete":false,"product_type":"c3","uid":1433535,"ip_address":"","ucode":"EED0EBBBF80A43","user_header":"https://static001.geekbang.org/account/avatar/00/15/df/bf/f90caa79.jpg","comment_is_top":false,"comment_ctime":1599138999,"is_pvip":false,"replies":[{"id":90597,"content":"BFF可以有缓存(甚至还可以有独立的DB)，比方说如果某个BFF是一个聚合服务，它可以把聚合好的数据缓存起来（服务器本地缓存，或者集中的redis缓存），这样可以加快后面的查询速度。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1599402982,"ip_address":"","comment_id":246031,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"请问下老师，bff 层会涉及到缓存吗？缓存是不是同一放在业务层来实现。","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505040,"discussion_content":"BFF可以有缓存(甚至还可以有独立的DB)，比方说如果某个BFF是一个聚合服务，它可以把聚合好的数据缓存起来（服务器本地缓存，或者集中的redis缓存），这样可以加快后面的查询速度。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599402982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232286,"user_name":"william777","can_delete":false,"product_type":"c3","uid":1028639,"ip_address":"","ucode":"C1C1108DD968F0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b2/1f/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1593945797,"is_pvip":false,"replies":[{"id":86103,"content":"对，你看得很仔细，nginx其实也可以实现反响路由的功能，一个域名，通过path或者header路由，也可以搞定。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1594310404,"ip_address":"","comment_id":232286,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"杨老师，您好。这集课程讲到v2 内网暴露服务那里，说每个服务都要买域名，我认为是不必要的，可以只买一个域名，通过nginx，配置比如：location &#47;auth&#47; {proxy_pass http:&#47;&#47;localhost:8080&#47;}，location &#47;shoppingcart&#47; {proxy_pass http:&#47;&#47;localhost:8081&#47;}, location &#47;products&#47; {proxy_pass http:&#47;&#47;localhost:8082&#47;}, location &#47;pay&#47; {proxy_pass http:&#47;&#47;localhost:8083&#47;} 这样的方式，将不同的服务，映射到不同的子路径下，将请求转发到对应的服务端口，也可以实现需求。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500594,"discussion_content":"对，你看得很仔细，nginx其实也可以实现反响路由的功能，一个域名，通过path或者header路由，也可以搞定。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594310404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126928,"user_name":"Aaron","can_delete":false,"product_type":"c3","uid":1066251,"ip_address":"","ucode":"B0C504A76297C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/0Qp9pxHBvgdZAveKzsvUFFUicCJfe7ONzhC7jSNFQDNFvg0jRMXuqqZOdxG1qKosylUYrpIHUR2Q76w5m4HtVkg/132","comment_is_top":false,"comment_ctime":1566522257,"is_pvip":false,"replies":[{"id":47033,"content":"bff是聚合层，也有公司叫api层，主要作用是对后端基础服务进行聚合裁剪，对外暴露无线设备友好的api。bff可以用对后端友好的语言开发，也可以用对前端友好的语言如nodejs开发。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566566126,"ip_address":"","comment_id":126928,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"无线bff就是通常说的api层吗？通常是Java开发的应用吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464249,"discussion_content":"bff是聚合层，也有公司叫api层，主要作用是对后端基础服务进行聚合裁剪，对外暴露无线设备友好的api。bff可以用对后端友好的语言开发，也可以用对前端友好的语言如nodejs开发。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566566126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}