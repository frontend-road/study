{"id":119013,"title":"36 | WAF：保护我们的网络服务","content":"<p>在前些天的“安全篇”里，我谈到了HTTPS，它使用了SSL/TLS协议，加密整个通信过程，能够防止恶意窃听和窜改，保护我们的数据安全。</p><p>但HTTPS只是网络安全中很小的一部分，仅仅保证了“通信链路安全”，让第三方无法得知传输的内容。在通信链路的两端，也就是客户端和服务器，它是无法提供保护的。</p><p>因为HTTP是一个开放的协议，Web服务都运行在公网上，任何人都可以访问，所以天然就会成为黑客的攻击目标。</p><p>而且黑客的本领比我们想象的还要大得多。虽然不能在传输过程中做手脚，但他们还可以“假扮”成合法的用户访问系统，然后伺机搞破坏。</p><h2>Web服务遇到的威胁</h2><p>黑客都有哪些手段来攻击Web服务呢？我给你大概列出几种常见的方式。</p><p>第一种叫“<strong>DDoS</strong>”攻击（distributed denial-of-service attack），有时候也叫“洪水攻击”。</p><p>黑客会控制许多“僵尸”计算机，向目标服务器发起大量无效请求。因为服务器无法区分正常用户和黑客，只能“照单全收”，这样就挤占了正常用户所应有的资源。如果黑客的攻击强度很大，就会像“洪水”一样对网站的服务能力造成冲击，耗尽带宽、CPU和内存，导致网站完全无法提供正常服务。</p><p>“DDoS”攻击方式比较“简单粗暴”，虽然很有效，但不涉及HTTP协议内部的细节，“技术含量”比较低，不过下面要说的几种手段就不一样了。</p><!-- [[[read_end]]] --><p>网站后台的Web服务经常会提取出HTTP报文里的各种信息，应用于业务，有时会缺乏严格的检查。因为HTTP报文在语义结构上非常松散、灵活，URI里的query字符串、头字段、body数据都可以任意设置，这就带来了安全隐患，给了黑客“<strong>代码注入</strong>”的可能性。</p><p>黑客可以精心编制HTTP请求报文，发送给服务器，服务程序如果没有做防备，就会“上当受骗”，执行黑客设定的代码。</p><p>“<strong>SQL注入</strong>”（SQL injection）应该算是最著名的一种“代码注入”攻击了，它利用了服务器字符串拼接形成SQL语句的漏洞，构造出非正常的SQL语句，获取数据库内部的敏感信息。</p><p>另一种“<strong>HTTP头注入</strong>”攻击的方式也是类似的原理，它在“Host”“User-Agent”“X-Forwarded-For”等字段里加入了恶意数据或代码，服务端程序如果解析不当，就会执行预设的恶意代码。</p><p>在之前的<a href=\"https://time.geekbang.org/column/article/106034\">第19讲</a>里，也说过一种利用Cookie的攻击手段，“<strong>跨站脚本</strong>”（XSS）攻击，它属于“JS代码注入”，利用JavaScript脚本获取未设防的Cookie。</p><h2>网络应用防火墙</h2><p>面对这么多的黑客攻击手段，我们应该怎么防御呢？</p><p>这就要用到“<strong>网络应用防火墙</strong>”（Web Application Firewall）了，简称为“<strong>WAF</strong>”。</p><p>你可能对传统的“防火墙”比较熟悉。传统“防火墙”工作在三层或者四层，隔离了外网和内网，使用预设的规则，只允许某些特定IP地址和端口号的数据包通过，拒绝不符合条件的数据流入或流出内网，实质上是<strong>一种网络数据过滤设备</strong>。</p><p>WAF也是一种“防火墙”，但它工作在七层，看到的不仅是IP地址和端口号，还能看到整个HTTP报文，所以就能够对报文内容做更深入细致的审核，使用更复杂的条件、规则来过滤数据。</p><p>说白了，WAF就是一种“<strong>HTTP入侵检测和防御系统</strong>”。</p><p><img src=\"https://static001.geekbang.org/resource/image/e8/a3/e8369d077454e5b92e3722e7090551a3.png?wh=1192*648\" alt=\"\"></p><p>WAF都能干什么呢？</p><p>通常一款产品能够称为WAF，要具备下面的一些功能：</p><ul>\n<li>IP黑名单和白名单，拒绝黑名单上地址的访问，或者只允许白名单上的用户访问；</li>\n<li>URI黑名单和白名单，与IP黑白名单类似，允许或禁止对某些URI的访问；</li>\n<li>防护DDoS攻击，对特定的IP地址限连限速；</li>\n<li>过滤请求报文，防御“代码注入”攻击；</li>\n<li>过滤响应报文，防御敏感信息外泄；</li>\n<li>审计日志，记录所有检测到的入侵操作。</li>\n</ul><p>听起来WAF好像很高深，但如果你理解了它的工作原理，其实也不难。</p><p>它就像是平时编写程序时必须要做的函数入口参数检查，拿到HTTP请求、响应报文，用字符串处理函数看看有没有关键字、敏感词，或者用正则表达式做一下模式匹配，命中了规则就执行对应的动作，比如返回403/404。</p><p>如果你比较熟悉Apache、Nginx、OpenResty，可以自己改改配置文件，写点JS或者Lua代码，就能够实现基本的WAF功能。</p><p>比如说，在Nginx里实现IP地址黑名单，可以利用“map”指令，从变量$remote_addr获取IP地址，在黑名单上就映射为值1，然后在“if”指令里判断：</p><pre><code>map $remote_addr $blocked {\n    default       0;\n    &quot;1.2.3.4&quot;     1;\n    &quot;5.6.7.8&quot;     1;\n}\n\n\nif ($blocked) {\n    return 403 &quot;you are blocked.&quot;;  \n}\n</code></pre><p>Nginx的配置文件只能静态加载，改名单必须重启，比较麻烦。如果换成OpenResty就会非常方便，在access阶段进行判断，IP地址列表可以使用cosocket连接外部的Redis、MySQL等数据库，实现动态更新：</p><pre><code>local ip_addr = ngx.var.remote_addr\n\nlocal rds = redis:new()\nif rds:get(ip_addr) == 1 then \n    ngx.exit(403) \nend\n</code></pre><p>看了上面的两个例子，你是不是有种“跃跃欲试”的冲动了，想自己动手开发一个WAF？</p><p>不过我必须要提醒你，在网络安全领域必须时刻记得“<strong>木桶效应</strong>”（也叫“短板效应”）。网站的整体安全不在于你加固的最强的那个方向，而是在于你可能都没有意识到的“短板”。黑客往往会“避重就轻”，只要发现了网站的一个弱点，就可以“一点突破”，其他方面的安全措施也就都成了“无用功”。</p><p>所以，使用WAF最好“<strong>不要重新发明轮子</strong>”，而是使用现有的、比较成熟的、经过实际考验的WAF产品。</p><h2>全面的WAF解决方案</h2><p>这里我就要“隆重”介绍一下WAF领域里的最顶级产品了：<span class=\"orange\">ModSecurity</span>，它可以说是WAF界“事实上的标准”。</p><p>ModSecurity是一个开源的、生产级的WAF工具包，历史很悠久，比Nginx还要大几岁。它开始于一个私人项目，后来被商业公司Breach Security收购，现在则是由TrustWave公司的SpiderLabs团队负责维护。</p><p>ModSecurity最早是Apache的一个模块，只能运行在Apache上。因为其品质出众，大受欢迎，后来的2.x版添加了Nginx和IIS支持，但因为底层架构存在差异，不够稳定。</p><p>所以，这两年SpiderLabs团队就开发了全新的3.0版本，移除了对Apache架构的依赖，使用新的“连接器”来集成进Apache或者Nginx，比2.x版更加稳定和快速，误报率也更低。</p><p>ModSecurity有两个核心组件。第一个是“<strong>规则引擎</strong>”，它实现了自定义的“SecRule”语言，有自己特定的语法。但“SecRule”主要基于正则表达式，还是不够灵活，所以后来也引入了Lua，实现了脚本化配置。</p><p>ModSecurity的规则引擎使用C++11实现，可以从<a href=\"https://github.com/SpiderLabs/ModSecurity\">GitHub</a>上下载源码，然后集成进Nginx。因为它比较庞大，编译很费时间，所以最好编译成动态模块，在配置文件里用指令“load_module”加载：</p><pre><code>load_module modules/ngx_http_modsecurity_module.so;\n</code></pre><p>只有引擎还不够，要让引擎运转起来，还需要完善的防御规则，所以ModSecurity的第二个核心组件就是它的“<strong>规则集</strong>”。</p><p>ModSecurity源码提供一个基本的规则配置文件“<strong>modsecurity.conf-recommended</strong>”，使用前要把它的后缀改成“conf”。</p><p>有了规则集，就可以在Nginx配置文件里加载，然后启动规则引擎：</p><pre><code>modsecurity on;\nmodsecurity_rules_file /path/to/modsecurity.conf;\n</code></pre><p>“modsecurity.conf”文件默认只有检测功能，不提供入侵阻断，这是为了防止误杀误报，把“SecRuleEngine”后面改成“On”就可以开启完全的防护：</p><pre><code>#SecRuleEngine DetectionOnly\nSecRuleEngine  On\n</code></pre><p>基本的规则集之外，ModSecurity还额外提供一个更完善的规则集，为网站提供全面可靠的保护。这个规则集的全名叫“<strong>OWASP ModSecurity 核心规则集</strong>”（Open Web Application Security Project ModSecurity Core Rule Set），因为名字太长了，所以有时候会简称为“核心规则集”或者“CRS”。</p><p><img src=\"https://static001.geekbang.org/resource/image/ad/48/add929f8439c64f29db720d30f7de548.png?wh=1142*514\" alt=\"\"></p><p>CRS也是完全开源、免费的，可以从GitHub上下载：</p><pre><code>git clone https://github.com/SpiderLabs/owasp-modsecurity-crs.git\n</code></pre><p>其中有一个“<strong>crs-setup.conf.example</strong>”的文件，它是CRS的基本配置，可以用“Include”命令添加到“modsecurity.conf”里，然后再添加“rules”里的各种规则。</p><pre><code>Include /path/to/crs-setup.conf\nInclude /path/to/rules/*.conf\n</code></pre><p>你如果有兴趣可以看一下这些配置文件，里面用“SecRule”定义了很多的规则，基本的形式是“SecRule 变量 运算符 动作”。不过ModSecurity的这套语法“自成一体”，比较复杂，要完全掌握不是一朝一夕的事情，我就不详细解释了。</p><p>另外，ModSecurity还有强大的审计日志（Audit Log）功能，记录任何可疑的数据，供事后离线分析。但在生产环境中会遇到大量的攻击，日志会快速增长，消耗磁盘空间，而且写磁盘也会影响Nginx的性能，所以一般建议把它关闭：</p><pre><code>SecAuditEngine off  #RelevantOnly\nSecAuditLog /var/log/modsec_audit.log\n</code></pre><h2>小结</h2><p>今天我们一起学习了“网络应用防火墙”，也就是WAF，使用它可以加固Web服务。</p><ol>\n<li><span class=\"orange\">Web服务通常都运行在公网上，容易受到“DDoS”、“代码注入”等各种黑客攻击，影响正常的服务，所以必须要采取措施加以保护；</span></li>\n<li><span class=\"orange\">WAF是一种“HTTP入侵检测和防御系统”，工作在七层，为Web服务提供全面的防护；</span></li>\n<li><span class=\"orange\">ModSecurity是一个开源的、生产级的WAF产品，核心组成部分是“规则引擎”和“规则集”，两者的关系有点像杀毒引擎和病毒特征库；</span></li>\n<li><span class=\"orange\">WAF实质上是模式匹配与数据过滤，所以会消耗CPU，增加一些计算成本，降低服务能力，使用时需要在安全与性能之间找到一个“平衡点”。</span></li>\n</ol><h2>课下作业</h2><ol>\n<li>HTTPS为什么不能防御DDoS、代码注入等攻击呢？</li>\n<li>你还知道有哪些手段能够抵御网络攻击吗？</li>\n</ol><p>欢迎你把自己的学习体会写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/24/b9e48b813c98bb34b4b433b7326ace24.png?wh=1769*3710\" alt=\"unpreview\"></p><p></p>","comments":[{"had_liked":false,"id":125359,"user_name":"闫飞","can_delete":false,"product_type":"c1","uid":1013162,"ip_address":"","ucode":"30C782D30108D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/aa/21275b9d.jpg","comment_is_top":false,"comment_ctime":1566174047,"is_pvip":false,"replies":[{"id":"46204","content":"great。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566262844,"ip_address":"","comment_id":125359,"utype":1}],"discussion_count":3,"race_medal":0,"score":"96055454559","product_id":100029001,"comment_content":"DDoS攻击从产生攻击对象的协议的角度来看可以分为L4攻击和L7攻击，前者其实是针对TCP状态机的恶意hack，比如攻击三次握手机制的SYN Flood和攻击四次握手的TIME WAIT2等，这些方面的防范超出了HTTPS的范畴，需要特殊的安全网管来过滤，清洗和识别。","like_count":23,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463543,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566262844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7111,"discussion_content":"纠正一下：是“四次挥手”；是 &#34;TIME_WAIT&#34; 和 &#34;2MSL&#34; 而不是 TIME WAIT2","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1567388348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1099513,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/f9/caf27bd3.jpg","nickname":"大王叫我来巡山","note":"","ucode":"1B8D0C701BC95E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":196755,"discussion_content":"理论上DDOS不可防御，属于资源的对抗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583371254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125499,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1566195002,"is_pvip":false,"replies":[{"id":"46169","content":"great。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566260332,"ip_address":"","comment_id":125499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"61695737146","product_id":100029001,"comment_content":"HTTPS 为什么不能防御 DDoS、代码注入等攻击呢？<br>DDoS、代码注入本身是遵循HTTPS协议的，它的攻击面不在HTTPS协议层，而在其它层面，所以HTTPS 不能防御此类攻击。<br><br>你还知道有哪些手段能够抵御网络攻击吗？<br>我还知道有CSP内容安全策略，CSRF防御，SYN cookie，流速控制等手段。","like_count":15,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463584,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566260332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125391,"user_name":"我行我素","can_delete":false,"product_type":"c1","uid":1224678,"ip_address":"","ucode":"4C69542FAB0671","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg","comment_is_top":false,"comment_ctime":1566178026,"is_pvip":false,"replies":[{"id":"46166","content":"good。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566260228,"ip_address":"","comment_id":125391,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31630949098","product_id":100029001,"comment_content":"https是做数据加密防止泄露，而ddos是以数量取胜（伪装成正常请求），","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463559,"discussion_content":"good。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566260228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230033,"user_name":"Maske","can_delete":false,"product_type":"c1","uid":1696847,"ip_address":"","ucode":"A19BB41A47E852","user_header":"https://static001.geekbang.org/account/avatar/00/19/e4/4f/df6d810d.jpg","comment_is_top":false,"comment_ctime":1593245547,"is_pvip":true,"replies":[{"id":"84916","content":"说的对。 ","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1593265722,"ip_address":"","comment_id":230033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18773114731","product_id":100029001,"comment_content":"https是对数据的进行加密传输，并且保证了数据的有效性，而不关心数据本身是什么，所以不能防止sql注入。DDos本身也是符合http规范的请求，所以https也无法将其识别为攻击。","like_count":5,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499742,"discussion_content":"说的对。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593265722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125352,"user_name":"佳佳大魔王","can_delete":false,"product_type":"c1","uid":1235320,"ip_address":"","ucode":"D5214903D85A0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/d9/78/8a328299.jpg","comment_is_top":false,"comment_ctime":1566173221,"is_pvip":false,"replies":[{"id":"46168","content":"对。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566260266,"ip_address":"","comment_id":125352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10156107813","product_id":100029001,"comment_content":"问题一，我觉得是因为https只提供了对通信过程中的数据进行加密，如果黑客用大量资源充当客户端，对服务器进行大量请求，https是无法阻止的，代码注入也是一样","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463541,"discussion_content":"对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566260266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247785,"user_name":" 尿布","can_delete":false,"product_type":"c1","uid":1476323,"ip_address":"","ucode":"D1C8BDA7540962","user_header":"https://static001.geekbang.org/account/avatar/00/16/86/e3/a31f6869.jpg","comment_is_top":false,"comment_ctime":1599835873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5894803169","product_id":100029001,"comment_content":"“CC攻击”（Challenge Collapser）是“DDos”的一种，它使用代理服务器发动攻击","like_count":1},{"had_liked":false,"id":229129,"user_name":"snake","can_delete":false,"product_type":"c1","uid":1217535,"ip_address":"","ucode":"A74B3D02B017FB","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/ff/87d8de89.jpg","comment_is_top":false,"comment_ctime":1592902417,"is_pvip":false,"replies":[{"id":"84496","content":"当然可以。<br><br>waf是内容检测，在服务器端必然要看到解密后的数据，比如ModSecurity就是Nginx的一个模块，嵌入了Nginx的处理流程，在接入https流量之后才能起作用。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1592903624,"ip_address":"","comment_id":229129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5887869713","product_id":100029001,"comment_content":"那能否用waf来做https流量的入侵检测和防御呢？https的密文的，waf应该看不到吧？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499344,"discussion_content":"当然可以。\n\nwaf是内容检测，在服务器端必然要看到解密后的数据，比如ModSecurity就是Nginx的一个模块，嵌入了Nginx的处理流程，在接入https流量之后才能起作用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592903624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223376,"user_name":"Aaron","can_delete":false,"product_type":"c1","uid":1156222,"ip_address":"","ucode":"059966DCA3A8F0","user_header":"https://static001.geekbang.org/account/avatar/00/11/a4/7e/963c037c.jpg","comment_is_top":false,"comment_ctime":1591076974,"is_pvip":false,"replies":[{"id":"82320","content":"web安全的话题太大，我也不是这方面的专家，只是比较熟悉waf，其他的手段真就不太了解了。<br><br>不过我觉得，用waf就可以抵御八成的web攻击了。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1591081932,"ip_address":"","comment_id":223376,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5886044270","product_id":100029001,"comment_content":"这节课内容很重要呀，但有种只讲了冰山一角的感觉。老师能不能自己系统回答一下『你还知道有哪些手段能够抵御网络攻击吗？』呢？好期待官方答案~","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497114,"discussion_content":"web安全的话题太大，我也不是这方面的专家，只是比较熟悉waf，其他的手段真就不太了解了。\n\n不过我觉得，用waf就可以抵御八成的web攻击了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591081932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125481,"user_name":"二星球","can_delete":false,"product_type":"c1","uid":1111552,"ip_address":"","ucode":"89EC5FEB98E7CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/00/2a248fd8.jpg","comment_is_top":false,"comment_ctime":1566189851,"is_pvip":false,"replies":[{"id":"46609","content":"如果链路中有多个代理，那么长连接实际上连的是第一个代理服务器，而不是源服务器。<br><br>所以可能是中间的代理出了问题，给了你错误的响应。<br><br>看看能否在代理上加上日志，看看请求的处理过程。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566366144,"ip_address":"","comment_id":125481,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861157147","product_id":100029001,"comment_content":"老师好，向您请教最近遇到的一个问题，APP应用通过http长链接向后台发送请求，中间有几个代理服务器，偶尔发现app发送的请求返回的状态码是正常的200，但是没有返回值，没有出错，后台也没有收到请求，这是什么原因，该如何解决呢？","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463579,"discussion_content":"如果链路中有多个代理，那么长连接实际上连的是第一个代理服务器，而不是源服务器。\n\n所以可能是中间的代理出了问题，给了你错误的响应。\n\n看看能否在代理上加上日志，看看请求的处理过程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566366144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291425,"user_name":"dog_brother","can_delete":false,"product_type":"c1","uid":1619597,"ip_address":"","ucode":"9F64D3C6D815FB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","comment_is_top":false,"comment_ctime":1620284065,"is_pvip":true,"replies":[{"id":"105599","content":"对，waf本质上就是各种各样的规则。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1620349561,"ip_address":"","comment_id":291425,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620284065","product_id":100029001,"comment_content":"项目中使用过基于业务的规则引擎，完全自研的；waf应该是规则引擎比较典型的应用了。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519467,"discussion_content":"对，waf本质上就是各种各样的规则。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620349561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287756,"user_name":"张良","can_delete":false,"product_type":"c1","uid":1381930,"ip_address":"","ucode":"0DFA45F42B2735","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIqzCbNMTJHEVNER4p8bsd8RHv3Sg84Ykd8uYQkOwV57ZqXTLib0AqtP7csKxOrICeFvdUrQWFKl0Q/132","comment_is_top":false,"comment_ctime":1618134681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618134681","product_id":100029001,"comment_content":"测试JS脚本共计\t&lt;script&gt;alert(&#39;ok&#39;);&lt;&#47;script&gt;","like_count":0},{"had_liked":false,"id":242113,"user_name":"fakership","can_delete":false,"product_type":"c1","uid":1097136,"ip_address":"","ucode":"42B5F286B6CC19","user_header":"https://static001.geekbang.org/account/avatar/00/10/bd/b0/8b808d33.jpg","comment_is_top":false,"comment_ctime":1597592155,"is_pvip":false,"replies":[{"id":"89369","content":"学习的事情急不得，尤其是关于网络协议的，慢慢看，有可能的话自己做个心得笔记。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1597626802,"ip_address":"","comment_id":242113,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1597592155","product_id":100029001,"comment_content":"老师讲的太干货了 还想着2d看完。。 高估了。。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503926,"discussion_content":"学习的事情急不得，尤其是关于网络协议的，慢慢看，有可能的话自己做个心得笔记。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597626802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240387,"user_name":"小谢同学","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1596884529,"is_pvip":false,"replies":[{"id":"88825","content":"不是太明白你说的问题，抱歉啦。<br><br>waf只支持对http流量防护，四层和以下的防护它是做不了的，需要用底层的防火墙。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1597021866,"ip_address":"","comment_id":240387,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596884529","product_id":100029001,"comment_content":"请问老师如果我的业务接入ddos服务后，是否高防节点只会对请求流量进行4层行为的检查？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503425,"discussion_content":"不是太明白你说的问题，抱歉啦。\n\nwaf只支持对http流量防护，四层和以下的防护它是做不了的，需要用底层的防火墙。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597021866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206642,"user_name":"张三","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1586912855,"is_pvip":false,"replies":[{"id":"77218","content":"nice。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1586927052,"ip_address":"","comment_id":206642,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586912855","product_id":100029001,"comment_content":"打卡！","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491849,"discussion_content":"nice。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586927052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202736,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1586059503,"is_pvip":false,"replies":[{"id":"76040","content":"对，它保证的是内容安全，但不关心内容。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1586222178,"ip_address":"","comment_id":202736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586059503","product_id":100029001,"comment_content":"HTTPS 为什么不能防御 DDoS、代码注入等攻击呢？<br>因为HTTPS的核心工作是加密解密通过HTTPS传输的内容，保证传输的内容是安全的，至于内容是一个“炸弹”还是一把“匕首”她是管不着的。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490669,"discussion_content":"对，它保证的是内容安全，但不关心内容。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586222178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}