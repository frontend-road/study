{"id":473414,"title":"29ï½œæ¥å£ï¼šä¸ºä»€ä¹ˆnilæ¥å£ä¸ç­‰äºnilï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬å­¦ä¹ äº†Goæ¥å£çš„åŸºç¡€çŸ¥è¯†ä¸è®¾è®¡æƒ¯ä¾‹ï¼ŒçŸ¥é“Goæ¥å£æ˜¯æ„å»ºGoåº”ç”¨éª¨æ¶çš„é‡è¦å…ƒç´ ã€‚ä»è¯­è¨€è®¾è®¡è§’åº¦æ¥çœ‹ï¼ŒGoè¯­è¨€çš„æ¥å£ï¼ˆinterfaceï¼‰å’Œå¹¶å‘ï¼ˆconcurrencyï¼‰åŸè¯­æ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸¤ç±»Goè¯­è¨€è¯­æ³•å…ƒç´ ã€‚Goè¯­è¨€æ ¸å¿ƒå›¢é˜Ÿçš„æŠ€æœ¯è´Ÿè´£äººRuss Coxä¹Ÿæ›¾è¯´è¿‡è¿™æ ·ä¸€å¥è¯ï¼šâ€œ<strong>å¦‚æœè¦ä»Goè¯­è¨€ä¸­æŒ‘é€‰å‡ºä¸€ä¸ªç‰¹æ€§æ”¾å…¥å…¶ä»–è¯­è¨€ï¼Œæˆ‘ä¼šé€‰æ‹©æ¥å£</strong>â€ï¼Œè¿™å¥è¯è¶³ä»¥è¯´æ˜æ¥å£è¿™ä¸€è¯­æ³•ç‰¹æ€§åœ¨è¿™ä½Goè¯­è¨€å¤§ç¥å¿ƒç›®ä¸­çš„åœ°ä½ã€‚</p><p>ä¸ºä»€ä¹ˆæ¥å£åœ¨Goä¸­æœ‰è¿™ä¹ˆé«˜çš„åœ°ä½å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º<strong>æ¥å£æ˜¯Goè¿™é—¨é™æ€è¯­è¨€ä¸­å”¯ä¸€â€œåŠ¨é™å…¼å¤‡â€çš„è¯­æ³•ç‰¹æ€§</strong>ã€‚è€Œä¸”ï¼Œæ¥å£â€œåŠ¨é™å…¼å¤‡â€çš„ç‰¹æ€§ç»™Goå¸¦æ¥äº†å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä½†åŒæ—¶ä¹Ÿç»™Goè¯­è¨€åˆå­¦è€…å¸¦æ¥äº†ä¸å°‘å›°æƒ‘ã€‚è¦æƒ³çœŸæ­£è§£å†³è¿™äº›å›°æƒ‘ï¼Œæˆ‘ä»¬å¿…é¡»æ·±å…¥åˆ°Goè¿è¡Œæ—¶å±‚é¢ï¼Œçœ‹çœ‹Goè¯­è¨€åœ¨è¿è¡Œæ—¶æ˜¯å¦‚ä½•è¡¨ç¤ºæ¥å£ç±»å‹çš„ã€‚åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘å°±å¸¦ç€ä½ ä¸€èµ·æ·±å…¥åˆ°æ¥å£ç±»å‹çš„è¿è¡Œæ—¶è¡¨ç¤ºå±‚é¢çœ‹çœ‹ã€‚</p><p>å¥½ï¼Œåœ¨è§£æƒ‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ¥å£çš„é™æ€ä¸åŠ¨æ€ç‰¹æ€§ï¼Œçœ‹çœ‹â€œåŠ¨é™çš†å¤‡â€åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><h2>æ¥å£çš„é™æ€ç‰¹æ€§ä¸åŠ¨æ€ç‰¹æ€§</h2><p>æ¥å£çš„<strong>é™æ€ç‰¹æ€§</strong>ä½“ç°åœ¨<strong>æ¥å£ç±»å‹å˜é‡å…·æœ‰é™æ€ç±»å‹</strong>ï¼Œæ¯”å¦‚<code>var err error</code>ä¸­å˜é‡errçš„é™æ€ç±»å‹ä¸ºerrorã€‚æ‹¥æœ‰é™æ€ç±»å‹ï¼Œé‚£å°±æ„å‘³ç€ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ‰€æœ‰æ¥å£ç±»å‹å˜é‡çš„èµ‹å€¼æ“ä½œè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥å³å€¼çš„ç±»å‹æ˜¯å¦å®ç°äº†è¯¥æ¥å£æ–¹æ³•é›†åˆä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚å¦‚æœä¸æ»¡è¶³ï¼Œå°±ä¼šæŠ¥é”™ï¼š</p><!-- [[[read_end]]] --><pre><code class=\"language-plain\">var err error = 1 // cannot use 1 (type int) as type error in assignment: int does not implement error (missing Error method)\n</code></pre><p>è€Œæ¥å£çš„<strong>åŠ¨æ€ç‰¹æ€§</strong>ï¼Œå°±ä½“ç°åœ¨æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶è¿˜å­˜å‚¨äº†å³å€¼çš„çœŸå®ç±»å‹ä¿¡æ¯ï¼Œè¿™ä¸ªå³å€¼çš„çœŸå®ç±»å‹è¢«ç§°ä¸ºæ¥å£ç±»å‹å˜é‡çš„<strong>åŠ¨æ€ç±»å‹</strong>ã€‚ä½ çœ‹ä¸€ä¸‹ä¸‹é¢ç¤ºä¾‹ä»£ç ï¼š</p><pre><code class=\"language-plain\">var err error\nerr = errors.New(\"error1\")\nfmt.Printf(\"%T\\n\", err)  // *errors.errorString\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç¤ºä¾‹é€šè¿‡errros.Newæ„é€ äº†ä¸€ä¸ªé”™è¯¯å€¼ï¼Œèµ‹å€¼ç»™äº†erroræ¥å£ç±»å‹å˜é‡errï¼Œå¹¶é€šè¿‡fmt.Printfå‡½æ•°è¾“å‡ºæ¥å£ç±»å‹å˜é‡errçš„åŠ¨æ€ç±»å‹ä¸º*errors.errorStringã€‚</p><p>é‚£æ¥å£çš„è¿™ç§â€œåŠ¨é™çš†å¤‡â€çš„ç‰¹æ€§ï¼Œåˆå¸¦æ¥äº†ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæ¥å£ç±»å‹å˜é‡åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥è¢«èµ‹å€¼ä¸ºä¸åŒçš„åŠ¨æ€ç±»å‹å˜é‡ï¼Œæ¯æ¬¡èµ‹å€¼åï¼Œæ¥å£ç±»å‹å˜é‡ä¸­å­˜å‚¨çš„åŠ¨æ€ç±»å‹ä¿¡æ¯éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™è®©Goè¯­è¨€å¯ä»¥åƒåŠ¨æ€è¯­è¨€ï¼ˆæ¯”å¦‚Pythonï¼‰é‚£æ ·æ‹¥æœ‰ä½¿ç”¨<a href=\"https://en.wikipedia.org/wiki/Duck_typing\">Duck Typingï¼ˆé¸­å­ç±»å‹ï¼‰</a>çš„çµæ´»æ€§ã€‚æ‰€è°“é¸­å­ç±»å‹ï¼Œå°±æ˜¯æŒ‡æŸç±»å‹æ‰€è¡¨ç°å‡ºçš„ç‰¹æ€§ï¼ˆæ¯”å¦‚æ˜¯å¦å¯ä»¥ä½œä¸ºæŸæ¥å£ç±»å‹çš„å³å€¼ï¼‰ï¼Œä¸æ˜¯ç”±å…¶åŸºå› ï¼ˆæ¯”å¦‚C++ä¸­çš„çˆ¶ç±»ï¼‰å†³å®šçš„ï¼Œè€Œæ˜¯ç”±ç±»å‹æ‰€è¡¨ç°å‡ºæ¥çš„è¡Œä¸ºï¼ˆæ¯”å¦‚ç±»å‹æ‹¥æœ‰çš„æ–¹æ³•ï¼‰å†³å®šçš„ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">type QuackableAnimal interface {\n    Quack()\n}\n\ntype Duck struct{}\n\nfunc (Duck) Quack() {\n    println(\"duck quack!\")\n}\n\ntype Dog struct{}\n\nfunc (Dog) Quack() {\n    println(\"dog quack!\")\n}\n\ntype Bird struct{}\n\nfunc (Bird) Quack() {\n    println(\"bird quack!\")\n}                         \n                          \nfunc AnimalQuackInForest(a QuackableAnimal) {\n    a.Quack()             \n}                         \n                          \nfunc main() {             \n    animals := []QuackableAnimal{new(Duck), new(Dog), new(Bird)}\n    for _, animal := range animals {\n        AnimalQuackInForest(animal)\n    }  \n}\n</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨æ¥å£ç±»å‹QuackableAnimalæ¥ä»£è¡¨å…·æœ‰â€œä¼šå«â€è¿™ä¸€ç‰¹å¾çš„åŠ¨ç‰©ï¼Œè€ŒDuckã€Birdå’ŒDogç±»å‹å„è‡ªéƒ½å…·æœ‰è¿™æ ·çš„ç‰¹å¾ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸‰ä¸ªç±»å‹çš„å˜é‡èµ‹å€¼ç»™QuackableAnimalæ¥å£ç±»å‹å˜é‡aã€‚æ¯æ¬¡èµ‹å€¼ï¼Œå˜é‡aä¸­å­˜å‚¨çš„åŠ¨æ€ç±»å‹ä¿¡æ¯éƒ½ä¸åŒï¼ŒQuackæ–¹æ³•çš„æ‰§è¡Œç»“æœå°†æ ¹æ®å˜é‡aä¸­å­˜å‚¨çš„åŠ¨æ€ç±»å‹ä¿¡æ¯è€Œå®šã€‚</p><p>è¿™é‡Œçš„Duckã€Birdã€Dogéƒ½æ˜¯â€œé¸­å­ç±»å‹â€ï¼Œä½†å®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆè”ç³»ï¼Œä¹‹æ‰€ä»¥èƒ½ä½œä¸ºå³å€¼èµ‹å€¼ç»™QuackableAnimalç±»å‹å˜é‡ï¼Œåªæ˜¯å› ä¸ºä»–ä»¬è¡¨ç°å‡ºäº†QuackableAnimalæ‰€è¦æ±‚çš„ç‰¹å¾ç½¢äº†ã€‚</p><p>ä¸è¿‡ï¼Œä¸åŠ¨æ€è¯­è¨€ä¸åŒçš„æ˜¯ï¼ŒGoæ¥å£è¿˜å¯ä»¥ä¿è¯â€œåŠ¨æ€ç‰¹æ€§â€ä½¿ç”¨æ—¶çš„å®‰å…¨æ€§ã€‚æ¯”å¦‚ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥æ•æ‰åˆ°å°†intç±»å‹å˜é‡ä¼ ç»™QuackableAnimalæ¥å£ç±»å‹å˜é‡è¿™æ ·çš„æ˜æ˜¾é”™è¯¯ï¼Œå†³ä¸ä¼šè®©è¿™æ ·çš„é”™è¯¯é—æ¼åˆ°è¿è¡Œæ—¶æ‰è¢«å‘ç°ã€‚</p><p>æ¥å£ç±»å‹çš„åŠ¨é™ç‰¹æ€§è®©æˆ‘ä»¬çœ‹åˆ°äº†æ¥å£ç±»å‹çš„å¼ºå¤§ï¼Œä½†åœ¨æ—¥å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šäº§ç”Ÿå„ç§å›°æƒ‘ï¼Œå…¶ä¸­æœ€ç»å…¸çš„ä¸€ä¸ªå›°æƒ‘è«è¿‡äºâ€œnilçš„errorå€¼ä¸ç­‰äºnilâ€äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çœ‹ä¸€ä¸‹ã€‚</p><h2>nil errorå€¼ != nil</h2><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€æ®µæ”¹ç¼–è‡ª<a href=\"https://go.dev/doc/faq#nil_error\">GO FAQä¸­çš„ä¾‹å­</a>çš„ä»£ç ï¼š</p><pre><code class=\"language-plain\">type MyError struct {\n    error\n}\n\nvar ErrBad = MyError{\n    error: errors.New(\"bad things happened\"),\n}\n\nfunc bad() bool {\n    return false\n}\n\nfunc returnsError() error {\n    var p *MyError = nil\n    if bad() {\n        p = &amp;ErrBad\n    }\n    return p\n}\n\nfunc main() {\n    err := returnsError()\n    if err != nil {\n        fmt.Printf(\"error occur: %+v\\n\", err)\n        return\n    }\n    fmt.Println(\"ok\")\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹é›†ä¸­åœ¨returnsErrorè¿™ä¸ªå‡½æ•°ä¸Šé¢ã€‚è¿™ä¸ªå‡½æ•°å®šä¹‰äº†ä¸€ä¸ª<code>*MyError</code>ç±»å‹çš„å˜é‡pï¼Œåˆå€¼ä¸ºnilã€‚å¦‚æœå‡½æ•°badè¿”å›falseï¼ŒreturnsErrorå‡½æ•°å°±ä¼šç›´æ¥å°†pï¼ˆæ­¤æ—¶p = nilï¼‰ä½œä¸ºè¿”å›å€¼è¿”å›ç»™è°ƒç”¨è€…ï¼Œä¹‹åè°ƒç”¨è€…ä¼šå°†returnsErrorå‡½æ•°çš„è¿”å›å€¼ï¼ˆerroræ¥å£ç±»å‹ï¼‰ä¸nilè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœåšå‡ºæœ€ç»ˆå¤„ç†ã€‚</p><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªåˆå­¦è€…ï¼Œæˆ‘çŒœä½ çš„çš„æ€è·¯å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼špä¸ºnilï¼ŒreturnsErrorè¿”å›pï¼Œé‚£ä¹ˆmainå‡½æ•°ä¸­çš„errå°±ç­‰äºnilï¼Œäºæ˜¯ç¨‹åºè¾“å‡º<strong>ok</strong>åé€€å‡ºã€‚</p><p>ä½†çœŸå®çš„è¿è¡Œç»“æœæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre><code class=\"language-plain\">error occur: &lt;nil&gt;\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œç¤ºä¾‹ç¨‹åºå¹¶æœªå¦‚æˆ‘ä»¬å‰é¢é¢„æœŸçš„é‚£æ ·è¾“å‡ºokã€‚ç¨‹åºæ˜¾ç„¶æ˜¯è¿›å…¥äº†é”™è¯¯å¤„ç†åˆ†æ”¯ï¼Œè¾“å‡ºäº†errçš„å€¼ã€‚é‚£è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼šæ˜æ˜returnsErrorå‡½æ•°è¿”å›çš„på€¼ä¸ºnilï¼Œä¸ºä»€ä¹ˆå´æ»¡è¶³äº†<code>if err != nil</code>çš„æ¡ä»¶è¿›å…¥é”™è¯¯å¤„ç†åˆ†æ”¯å‘¢ï¼Ÿ</p><p>è¦æƒ³å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥äº†è§£æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p><h2>æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤º</h2><p>æ¥å£ç±»å‹â€œåŠ¨é™å…¼å¤‡â€çš„ç‰¹æ€§ä¹Ÿå†³å®šäº†å®ƒçš„å˜é‡çš„å†…éƒ¨è¡¨ç¤ºç»ä¸åƒä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼ˆå¦‚intã€float64ï¼‰é‚£æ ·ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>$GOROOT/src/runtime/runtime2.go</code>ä¸­æ‰¾åˆ°æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/runtime2.go\ntype iface struct {\n    tab  *itab\n    data unsafe.Pointer\n}\n\ntype eface struct {\n    _type *_type\n    data  unsafe.Pointer\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨è¿è¡Œæ—¶å±‚é¢ï¼Œæ¥å£ç±»å‹å˜é‡æœ‰ä¸¤ç§å†…éƒ¨è¡¨ç¤ºï¼š<code>iface</code>å’Œ<code>eface</code>ï¼Œè¿™ä¸¤ç§è¡¨ç¤ºåˆ†åˆ«ç”¨äºä¸åŒçš„æ¥å£ç±»å‹å˜é‡ï¼š</p><ul>\n<li>efaceç”¨äºè¡¨ç¤ºæ²¡æœ‰æ–¹æ³•çš„ç©ºæ¥å£ï¼ˆ<strong>e</strong>mpty inter<strong>face</strong>ï¼‰ç±»å‹å˜é‡ï¼Œä¹Ÿå°±æ˜¯interface{}ç±»å‹çš„å˜é‡ï¼›</li>\n<li>ifaceç”¨äºè¡¨ç¤ºå…¶ä½™æ‹¥æœ‰æ–¹æ³•çš„æ¥å£<strong>i</strong>nter<strong>face</strong>ç±»å‹å˜é‡ã€‚</li>\n</ul><p>è¿™ä¸¤ä¸ªç»“æ„çš„å…±åŒç‚¹æ˜¯å®ƒä»¬éƒ½æœ‰ä¸¤ä¸ªæŒ‡é’ˆå­—æ®µï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªæŒ‡é’ˆå­—æ®µçš„åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡å‘å½“å‰èµ‹å€¼ç»™è¯¥æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹å˜é‡çš„å€¼ã€‚</p><p>é‚£å®ƒä»¬çš„ä¸åŒç‚¹åœ¨å“ªå‘¢ï¼Ÿå°±åœ¨äºefaceè¡¨ç¤ºçš„ç©ºæ¥å£ç±»å‹å¹¶æ²¡æœ‰æ–¹æ³•åˆ—è¡¨ï¼Œå› æ­¤å®ƒçš„ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­—æ®µæŒ‡å‘ä¸€ä¸ª<code>_type</code>ç±»å‹ç»“æ„ï¼Œè¿™ä¸ªç»“æ„ä¸ºè¯¥æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/type.go\n\ntype _type struct {\n    size       uintptr\n    ptrdata    uintptr // size of memory prefix holding all pointers\n    hash       uint32\n    tflag      tflag\n    align      uint8\n    fieldAlign uint8\n    kind       uint8\n    // function for comparing objects of this type\n    // (ptr to object A, ptr to object B) -&gt; ==?\n    equal func(unsafe.Pointer, unsafe.Pointer) bool\n    // gcdata stores the GC type data for the garbage collector.\n    // If the KindGCProg bit is set in kind, gcdata is a GC program.\n    // Otherwise it is a ptrmask bitmap. See mbitmap.go for details.\n    gcdata    *byte\n    str       nameOff\n    ptrToThis typeOff\n}\n</code></pre><p>è€Œifaceé™¤äº†è¦å­˜å‚¨åŠ¨æ€ç±»å‹ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜è¦å­˜å‚¨æ¥å£æœ¬èº«çš„ä¿¡æ¯ï¼ˆæ¥å£çš„ç±»å‹ä¿¡æ¯ã€æ–¹æ³•åˆ—è¡¨ä¿¡æ¯ç­‰ï¼‰ä»¥åŠåŠ¨æ€ç±»å‹æ‰€å®ç°çš„æ–¹æ³•çš„ä¿¡æ¯ï¼Œå› æ­¤ifaceçš„ç¬¬ä¸€ä¸ªå­—æ®µæŒ‡å‘ä¸€ä¸ª<code>itab</code>ç±»å‹ç»“æ„ã€‚itabç»“æ„çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/runtime2.go\ntype itab struct {\n    inter *interfacetype\n    _type *_type\n    hash  uint32 // copy of _type.hash. Used for type switches.\n    _     [4]byte\n    fun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.\n}\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œitabç»“æ„ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µ<code>inter</code>æŒ‡å‘çš„interfacetypeç»“æ„ï¼Œå­˜å‚¨ç€è¿™ä¸ªæ¥å£ç±»å‹è‡ªèº«çš„ä¿¡æ¯ã€‚ä½ çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µä»£ç è¡¨ç¤ºçš„interfacetypeç±»å‹å®šä¹‰ï¼Œ è¿™ä¸ªinterfacetypeç»“æ„ç”±ç±»å‹ä¿¡æ¯ï¼ˆtypï¼‰ã€åŒ…è·¯å¾„åï¼ˆpkgpathï¼‰å’Œæ¥å£æ–¹æ³•é›†åˆåˆ‡ç‰‡ï¼ˆmhdrï¼‰ç»„æˆã€‚</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/type.go\ntype interfacetype struct {\n    typ     _type\n    pkgpath name\n    mhdr    []imethod\n}\n</code></pre><p>itabç»“æ„ä¸­çš„å­—æ®µ<code>_type</code>åˆ™å­˜å‚¨ç€è¿™ä¸ªæ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹çš„ä¿¡æ¯ï¼Œå­—æ®µ<code>fun</code>åˆ™æ˜¯åŠ¨æ€ç±»å‹å·²å®ç°çš„æ¥å£æ–¹æ³•çš„è°ƒç”¨åœ°å€æ•°ç»„ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å†ç»“åˆä¾‹å­ç”¨å›¾ç‰‡æ¥ç›´è§‚å±•ç°efaceå’Œifaceçš„ç»“æ„ã€‚é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸ªç”¨efaceè¡¨ç¤ºçš„ç©ºæ¥å£ç±»å‹å˜é‡çš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">type T struct {\n    n int\n    s string\n}\n\nfunc main() {\n    var t = T {\n        n: 17,\n        s: \"hello, interface\",\n    }\n    \n    var ei interface{} = t // Goè¿è¡Œæ—¶ä½¿ç”¨efaceç»“æ„è¡¨ç¤ºei\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­çš„ç©ºæ¥å£ç±»å‹å˜é‡eiåœ¨Goè¿è¡Œæ—¶çš„è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/ae/2d8f103e2973d2e31c9f4237e6799eae.jpg?wh=1920x1047\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ç©ºæ¥å£ç±»å‹çš„è¡¨ç¤ºè¾ƒä¸ºç®€å•ï¼Œå›¾ä¸­ä¸ŠåŠéƒ¨åˆ†_typeå­—æ®µæŒ‡å‘å®ƒçš„åŠ¨æ€ç±»å‹Tçš„ç±»å‹ä¿¡æ¯ï¼Œä¸‹åŠéƒ¨åˆ†çš„dataåˆ™æ˜¯æŒ‡å‘ä¸€ä¸ªTç±»å‹çš„å®ä¾‹å€¼ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç”¨ifaceè¡¨ç¤ºéç©ºæ¥å£ç±»å‹å˜é‡çš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">type T struct {\n    n int\n    s string\n}\n\nfunc (T) M1() {}\nfunc (T) M2() {}\n\ntype NonEmptyInterface interface {\n    M1()\n    M2()\n}\n\nfunc main() {\n    var t = T{\n        n: 18,\n        s: \"hello, interface\",\n    }\n    var i NonEmptyInterface = t\n}\n</code></pre><p>å’Œefaceæ¯”èµ·æ¥ï¼Œifaceçš„è¡¨ç¤ºç¨å¾®å¤æ‚äº›ã€‚æˆ‘ä¹Ÿç”»äº†ä¸€å¹…è¡¨ç¤ºä¸Šé¢NonEmptyInterfaceæ¥å£ç±»å‹å˜é‡åœ¨Goè¿è¡Œæ—¶è¡¨ç¤ºçš„ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/36/44/369810ba10b9b8792d8edfd8e931b344.jpg?wh=1980x1080\" alt=\"\"></p><p>ç”±ä¸Šé¢çš„è¿™ä¸¤å¹…å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªæ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºéƒ½æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œé’ˆå¯¹ä¸åŒæ¥å£ç±»å‹æˆ‘ä»¬å¯ä»¥ç®€åŒ–è®°ä½œï¼š<code>eface(_type, data)</code>å’Œ<code>iface(tab, data)</code>ã€‚</p><p>è€Œä¸”ï¼Œè™½ç„¶efaceå’Œifaceçš„ç¬¬ä¸€ä¸ªå­—æ®µæœ‰æ‰€å·®åˆ«ï¼Œä½†tabå’Œ_typeå¯ä»¥ç»Ÿä¸€çœ‹ä½œæ˜¯åŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯ã€‚Goè¯­è¨€ä¸­æ¯ç§ç±»å‹éƒ½ä¼šæœ‰å”¯ä¸€çš„_typeä¿¡æ¯ï¼Œæ— è®ºæ˜¯å†…ç½®åŸç”Ÿç±»å‹ï¼Œè¿˜æ˜¯è‡ªå®šä¹‰ç±»å‹éƒ½æœ‰ã€‚Goè¿è¡Œæ—¶ä¼šä¸ºç¨‹åºå†…çš„å…¨éƒ¨ç±»å‹å»ºç«‹åªè¯»çš„å…±äº«_typeä¿¡æ¯è¡¨ï¼Œå› æ­¤æ‹¥æœ‰ç›¸åŒåŠ¨æ€ç±»å‹çš„åŒç±»æ¥å£ç±»å‹å˜é‡çš„_type/tabä¿¡æ¯æ˜¯ç›¸åŒçš„ã€‚</p><p>è€Œæ¥å£ç±»å‹å˜é‡çš„dataéƒ¨åˆ†åˆ™æ˜¯æŒ‡å‘ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå†…å­˜ç©ºé—´å­˜å‚¨çš„æ˜¯èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡çš„åŠ¨æ€ç±»å‹å˜é‡çš„å€¼ã€‚æœªæ˜¾å¼åˆå§‹åŒ–çš„æ¥å£ç±»å‹å˜é‡çš„å€¼ä¸º<code>nil</code>ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå˜é‡çš„_type/tabå’Œdataéƒ½ä¸ºnilã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åˆ¤æ–­ä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡æ˜¯å¦ç›¸åŒï¼Œåªéœ€è¦åˆ¤æ–­_type/tabæ˜¯å¦ç›¸åŒï¼Œä»¥åŠdataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´æ‰€å­˜å‚¨çš„æ•°æ®å€¼æ˜¯å¦ç›¸åŒå°±å¯ä»¥äº†ã€‚è¿™é‡Œè¦æ³¨æ„ä¸æ˜¯dataæŒ‡é’ˆçš„å€¼ç›¸åŒå™¢ã€‚</p><p>ä¸è¿‡ï¼Œé€šè¿‡è‚‰çœ¼å»è¾¨åˆ«æ¥å£ç±»å‹å˜é‡æ˜¯å¦ç›¸ç­‰æ€»æ˜¯å›°éš¾ä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€äº›<strong>helperå‡½æ•°</strong>ã€‚å€ŸåŠ©è¿™äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°è¾“å‡ºæ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºï¼Œè¿™æ ·å°±å¯ä»¥ä¸€ç›®äº†ç„¶åœ°çœ‹å‡ºä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰äº†ã€‚</p><p>ç”±äºefaceå’Œifaceæ˜¯runtimeåŒ…ä¸­çš„éå¯¼å‡ºç»“æ„ä½“å®šä¹‰ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨åŒ…å¤–ä½¿ç”¨ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•ç›´æ¥è®¿é—®åˆ°ä¸¤ä¸ªç»“æ„ä½“ä¸­çš„æ•°æ®ã€‚ä¸è¿‡ï¼ŒGoè¯­è¨€æä¾›äº†printlné¢„å®šä¹‰å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥è¾“å‡ºefaceæˆ–ifaceçš„ä¸¤ä¸ªæŒ‡é’ˆå­—æ®µçš„å€¼ã€‚</p><p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®è¦è¾“å‡ºçš„å‚æ•°çš„ç±»å‹å°†printlnæ›¿æ¢ä¸ºç‰¹å®šçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°éƒ½å®šä¹‰åœ¨<code>$GOROOT/src/runtime/print.go</code>æ–‡ä»¶ä¸­ï¼Œè€Œé’ˆå¯¹efaceå’Œifaceç±»å‹çš„æ‰“å°å‡½æ•°å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/print.go\nfunc printeface(e eface) {\n    print(\"(\", e._type, \",\", e.data, \")\")\n}\n\nfunc printiface(i iface) {\n    print(\"(\", i.tab, \",\", i.data, \")\")\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œprintefaceå’Œprintifaceä¼šè¾“å‡ºå„è‡ªçš„ä¸¤ä¸ªæŒ‡é’ˆå­—æ®µçš„å€¼ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥ä½¿ç”¨printlnå‡½æ•°è¾“å‡ºå„ç±»æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºä¿¡æ¯ï¼Œå¹¶ç»“åˆè¾“å‡ºç»“æœï¼Œè§£ææ¥å£ç±»å‹å˜é‡çš„ç­‰å€¼æ¯”è¾ƒæ“ä½œã€‚</p><h3>ç¬¬ä¸€ç§ï¼šnilæ¥å£å˜é‡</h3><p>æˆ‘ä»¬å‰é¢æè¿‡ï¼Œæœªèµ‹åˆå€¼çš„æ¥å£ç±»å‹å˜é‡çš„å€¼ä¸ºnilï¼Œè¿™ç±»å˜é‡ä¹Ÿå°±æ˜¯nilæ¥å£å˜é‡ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™ç±»å˜é‡çš„å†…éƒ¨è¡¨ç¤ºè¾“å‡ºçš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">func printNilInterface() {\n\t// nilæ¥å£å˜é‡\n\tvar i interface{} // ç©ºæ¥å£ç±»å‹\n\tvar err error     // éç©ºæ¥å£ç±»å‹\n\tprintln(i)\n\tprintln(err)\n\tprintln(\"i = nil:\", i == nil)\n\tprintln(\"err = nil:\", err == nil)\n\tprintln(\"i = err:\", i == err)\n}\n</code></pre><p>è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">(0x0,0x0)\n(0x0,0x0)\ni = nil: true\nerr = nil: true\ni = err: true\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç©ºæ¥å£ç±»å‹è¿˜æ˜¯éç©ºæ¥å£ç±»å‹å˜é‡ï¼Œä¸€æ—¦å˜é‡å€¼ä¸ºnilï¼Œé‚£ä¹ˆå®ƒä»¬å†…éƒ¨è¡¨ç¤ºå‡ä¸º<code>(0x0,0x0)</code>ï¼Œä¹Ÿå°±æ˜¯ç±»å‹ä¿¡æ¯ã€æ•°æ®å€¼ä¿¡æ¯å‡ä¸ºç©ºã€‚å› æ­¤ä¸Šé¢çš„å˜é‡iå’Œerrç­‰å€¼åˆ¤æ–­ä¸ºtrueã€‚</p><h3>ç¬¬äºŒç§ï¼šç©ºæ¥å£ç±»å‹å˜é‡</h3><p>ä¸‹é¢æ˜¯ç©ºæ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºè¾“å‡ºçš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">  func printEmptyInterface() {\n      var eif1 interface{} // ç©ºæ¥å£ç±»å‹\n      var eif2 interface{} // ç©ºæ¥å£ç±»å‹\n      var n, m int = 17, 18\n  \n      eif1 = n\n      eif2 = m\n\n      println(\"eif1:\", eif1)\n      println(\"eif2:\", eif2)\n      println(\"eif1 = eif2:\", eif1 == eif2) // false\n  \n      eif2 = 17\n      println(\"eif1:\", eif1)\n      println(\"eif2:\", eif2)\n      println(\"eif1 = eif2:\", eif1 == eif2) // true\n \n      eif2 = int64(17)\n      println(\"eif1:\", eif1)\n      println(\"eif2:\", eif2)\n      println(\"eif1 = eif2:\", eif1 == eif2) // false\n }\n</code></pre><p>è¿™ä¸ªä¾‹å­çš„è¿è¡Œè¾“å‡ºç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><pre><code class=\"language-plain\">eif1: (0x10ac580,0xc00007ef48)\neif2: (0x10ac580,0xc00007ef40)\neif1 = eif2: false\neif1: (0x10ac580,0xc00007ef48)\neif2: (0x10ac580,0x10eb3d0)\neif1 = eif2: true\neif1: (0x10ac580,0xc00007ef48)\neif2: (0x10ac640,0x10eb3d8)\neif1 = eif2: false\n</code></pre><p>æˆ‘ä»¬æŒ‰é¡ºåºåˆ†æä¸€ä¸‹è¿™ä¸ªè¾“å‡ºç»“æœã€‚</p><p>é¦–å…ˆï¼Œä»£ç æ‰§è¡Œåˆ°ç¬¬11è¡Œæ—¶ï¼Œeif1ä¸eif2å·²ç»åˆ†åˆ«è¢«èµ‹å€¼æ•´å‹å€¼17ä¸18ï¼Œè¿™æ ·eif1å’Œeif2çš„åŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼ˆéƒ½æ˜¯0x10ac580ï¼‰ï¼Œä½†dataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨çš„å€¼ä¸åŒï¼Œä¸€ä¸ªæ˜¯17ï¼Œä¸€ä¸ªæ˜¯18ï¼Œäºæ˜¯eif1ä¸ç­‰äºeif2ã€‚</p><p>æ¥ç€ï¼Œä»£ç æ‰§è¡Œåˆ°ç¬¬16è¡Œçš„æ—¶å€™ï¼Œeif2å·²ç»è¢«é‡æ–°èµ‹å€¼ä¸º17ï¼Œè¿™æ ·eif1å’Œeif2ä¸ä»…å­˜å‚¨çš„åŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼ˆéƒ½æ˜¯0x10ac580ï¼‰ï¼ŒdataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨å€¼ä¹Ÿç›¸åŒäº†ï¼Œéƒ½æ˜¯17ï¼Œäºæ˜¯eif1ç­‰äºeif2ã€‚</p><p>ç„¶åï¼Œä»£ç æ‰§è¡Œåˆ°ç¬¬21è¡Œæ—¶ï¼Œeif2å·²ç»è¢«é‡æ–°èµ‹å€¼äº†int64ç±»å‹çš„æ•°å€¼17ã€‚è¿™æ ·ï¼Œeif1å’Œeif2å­˜å‚¨çš„åŠ¨æ€ç±»å‹çš„ç±»å‹ä¿¡æ¯å°±å˜æˆä¸åŒçš„äº†ï¼Œä¸€ä¸ªæ˜¯intï¼Œä¸€ä¸ªæ˜¯int64ï¼Œå³ä¾¿dataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨å€¼æ˜¯ç›¸åŒçš„ï¼Œæœ€ç»ˆeif1ä¸eif2ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><p>ä»è¾“å‡ºç»“æœä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼š<strong>å¯¹äºç©ºæ¥å£ç±»å‹å˜é‡ï¼Œåªæœ‰_typeå’Œdataæ‰€æŒ‡æ•°æ®å†…å®¹ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªç©ºæ¥å£ç±»å‹å˜é‡ä¹‹é—´æ‰èƒ½åˆ’ç­‰å·</strong>ã€‚å¦å¤–ï¼ŒGoåœ¨åˆ›å»ºefaceæ—¶ä¸€èˆ¬ä¼šä¸ºdataé‡æ–°åˆ†é…æ–°å†…å­˜ç©ºé—´ï¼Œå°†åŠ¨æ€ç±»å‹å˜é‡çš„å€¼å¤åˆ¶åˆ°è¿™å—å†…å­˜ç©ºé—´ï¼Œå¹¶å°†dataæŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ç©ºé—´ã€‚å› æ­¤æˆ‘ä»¬å¤šæ•°æƒ…å†µä¸‹çœ‹åˆ°çš„dataæŒ‡é’ˆå€¼éƒ½æ˜¯ä¸åŒçš„ã€‚</p><h3>ç¬¬ä¸‰ç§ï¼šéç©ºæ¥å£ç±»å‹å˜é‡</h3><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿç›´æ¥æ¥çœ‹ä¸€ä¸ªéç©ºæ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºè¾“å‡ºçš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">type T int\n\nfunc (t T) Error() string { \n    return \"bad error\"\n}\n\nfunc printNonEmptyInterface() { \n    var err1 error // éç©ºæ¥å£ç±»å‹\n    var err2 error // éç©ºæ¥å£ç±»å‹\n    err1 = (*T)(nil)\n    println(\"err1:\", err1)\n    println(\"err1 = nil:\", err1 == nil)\n\n    err1 = T(5)\n    err2 = T(6)\n    println(\"err1:\", err1)\n    println(\"err2:\", err2)\n    println(\"err1 = err2:\", err1 == err2)\n\n    err2 = fmt.Errorf(\"%d\\n\", 5)\n    println(\"err1:\", err1)\n    println(\"err2:\", err2)\n    println(\"err1 = err2:\", err1 == err2)\n}   \n</code></pre><p>è¿™ä¸ªä¾‹å­çš„è¿è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">err1: (0x10ed120,0x0)\nerr1 = nil: false\nerr1: (0x10ed1a0,0x10eb310)\nerr2: (0x10ed1a0,0x10eb318)\nerr1 = err2: false\nerr1: (0x10ed1a0,0x10eb310)\nerr2: (0x10ed0c0,0xc000010050)\nerr1 = err2: false\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢ç¤ºä¾‹ä¸­æ¯ä¸€è½®é€šè¿‡printlnè¾“å‡ºçš„err1å’Œerr2çš„tabå’Œdataå€¼ï¼Œè¦ä¹ˆdataå€¼ä¸åŒï¼Œè¦ä¹ˆtabä¸dataå€¼éƒ½ä¸åŒã€‚</p><p>å’Œç©ºæ¥å£ç±»å‹å˜é‡ä¸€æ ·ï¼Œåªæœ‰tabå’ŒdataæŒ‡çš„æ•°æ®å†…å®¹ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªéç©ºæ¥å£ç±»å‹å˜é‡ä¹‹é—´æ‰èƒ½åˆ’ç­‰å·ã€‚è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„err1ä¸‹é¢çš„èµ‹å€¼æƒ…å†µï¼š</p><pre><code class=\"language-plain\">err1 = (*T)(nil)\n</code></pre><p>é’ˆå¯¹è¿™ç§èµ‹å€¼ï¼Œprintlnè¾“å‡ºçš„err1æ˜¯ï¼ˆ0x10ed120, 0x0ï¼‰ï¼Œä¹Ÿå°±æ˜¯éç©ºæ¥å£ç±»å‹å˜é‡çš„ç±»å‹ä¿¡æ¯å¹¶ä¸ä¸ºç©ºï¼Œæ•°æ®æŒ‡é’ˆä¸ºç©ºï¼Œå› æ­¤å®ƒä¸nilï¼ˆ0x0,0x0ï¼‰ä¹‹é—´ä¸èƒ½åˆ’ç­‰å·ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å†å›åˆ°æˆ‘ä»¬å¼€å¤´çš„é‚£ä¸ªé—®é¢˜ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»è±ç„¶å¼€æœ—äº†å‘¢ï¼Ÿå¼€å¤´çš„é—®é¢˜ä¸­ï¼Œä»returnsErrorè¿”å›çš„erroræ¥å£ç±»å‹å˜é‡errçš„æ•°æ®æŒ‡é’ˆè™½ç„¶ä¸ºç©ºï¼Œä½†å®ƒçš„ç±»å‹ä¿¡æ¯ï¼ˆiface.tabï¼‰å¹¶ä¸ä¸ºç©ºï¼Œè€Œæ˜¯*MyErrorå¯¹åº”çš„ç±»å‹ä¿¡æ¯ï¼Œè¿™æ ·errä¸nilï¼ˆ0x0,0x0ï¼‰ç›¸æ¯”è‡ªç„¶ä¸ç›¸ç­‰ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¼€å¤´é‚£ä¸ªé—®é¢˜çš„ç­”æ¡ˆè§£æï¼Œç°åœ¨ä½ æ˜ç™½äº†å—ï¼Ÿ</p><h3>ç¬¬å››ç§ï¼šç©ºæ¥å£ç±»å‹å˜é‡ä¸éç©ºæ¥å£ç±»å‹å˜é‡çš„ç­‰å€¼æ¯”è¾ƒ</h3><p>ä¸‹é¢æ˜¯éç©ºæ¥å£ç±»å‹å˜é‡å’Œç©ºæ¥å£ç±»å‹å˜é‡ä¹‹é—´è¿›è¡Œæ¯”è¾ƒçš„ä¾‹å­ï¼š</p><pre><code class=\"language-plain\">func printEmptyInterfaceAndNonEmptyInterface() {\n\tvar eif interface{} = T(5)\n\tvar err error = T(5)\n\tprintln(\"eif:\", eif)\n\tprintln(\"err:\", err)\n\tprintln(\"eif = err:\", eif == err)\n\n\terr = T(6)\n\tprintln(\"eif:\", eif)\n\tprintln(\"err:\", err)\n\tprintln(\"eif = err:\", eif == err)\n}\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">eif: (0x10b3b00,0x10eb4d0)\nerr: (0x10ed380,0x10eb4d8)\neif = err: true\neif: (0x10b3b00,0x10eb4d0)\nerr: (0x10ed380,0x10eb4e0)\neif = err: false\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œç©ºæ¥å£ç±»å‹å˜é‡å’Œéç©ºæ¥å£ç±»å‹å˜é‡å†…éƒ¨è¡¨ç¤ºçš„ç»“æ„æœ‰æ‰€ä¸åŒï¼ˆç¬¬ä¸€ä¸ªå­—æ®µï¼š_type vs. tab)ï¼Œä¸¤è€…ä¼¼ä¹ä¸€å®šä¸èƒ½ç›¸ç­‰ã€‚ä½†Goåœ¨è¿›è¡Œç­‰å€¼æ¯”è¾ƒæ—¶ï¼Œç±»å‹æ¯”è¾ƒä½¿ç”¨çš„æ˜¯efaceçš„_typeå’Œifaceçš„tab._typeï¼Œå› æ­¤å°±åƒæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œå½“eifå’Œerréƒ½è¢«èµ‹å€¼ä¸º<code>T(5)</code>æ—¶ï¼Œä¸¤è€…ä¹‹é—´æ˜¯åˆ’ç­‰å·çš„ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å­¦å®Œäº†å„ç±»æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶å±‚çš„è¡¨ç¤ºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡printlnå¯ä»¥æŸ¥çœ‹è¿™ä¸ªè¡¨ç¤ºä¿¡æ¯ï¼Œä»ä¸­æˆ‘ä»¬ä¹ŸçŸ¥é“äº†æ¥å£å˜é‡åªæœ‰åœ¨ç±»å‹ä¿¡æ¯ä¸å€¼ä¿¡æ¯éƒ½ä¸€è‡´çš„æƒ…å†µä¸‹æ‰èƒ½åˆ’ç­‰å·ã€‚</p><h2>è¾“å‡ºæ¥å£ç±»å‹å˜é‡å†…éƒ¨è¡¨ç¤ºçš„è¯¦ç»†ä¿¡æ¯</h2><p>ä¸è¿‡ï¼Œprintlnè¾“å‡ºçš„æ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºä¿¡æ¯ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯è¶³å¤Ÿçš„ï¼Œä½†æœ‰äº›æ—¶å€™åˆæ˜¾å¾—è¿‡äºç®€ç•¥ï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä»…å‡­<code>eif: (0x10b3b00,0x10eb4d0)</code>å’Œ<code>err: (0x10ed380,0x10eb4d8)</code>çš„è¾“å‡ºï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æƒ³åˆ°ä¸¤ä¸ªå˜é‡æ˜¯ç›¸ç­‰çš„ã€‚</p><p>é‚£è¿™æ—¶å¦‚æœæˆ‘ä»¬èƒ½è¾“å‡ºæ¥å£ç±»å‹å˜é‡å†…éƒ¨è¡¨ç¤ºçš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼štab._typeï¼‰ï¼Œé‚£åŠ¿å¿…å¯ä»¥å–å¾—äº‹åŠåŠŸå€çš„æ•ˆæœã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹è¿™è¦æ€ä¹ˆåšã€‚</p><p>å‰é¢æåˆ°è¿‡ï¼Œefaceå’Œifaceä»¥åŠç»„æˆå®ƒä»¬çš„itabå’Œ_typeéƒ½æ˜¯runtimeåŒ…ä¸‹çš„éå¯¼å‡ºç»“æ„ä½“ï¼Œæˆ‘ä»¬æ— æ³•åœ¨å¤–éƒ¨ç›´æ¥å¼•ç”¨å®ƒä»¬ã€‚ä½†æˆ‘ä»¬å‘ç°ï¼Œç»„æˆefaceã€ifaceçš„ç±»å‹éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡<strong>â€œå¤åˆ¶ä»£ç â€</strong>çš„æ–¹å¼å°†å®ƒä»¬æ‹¿åˆ°runtimeåŒ…å¤–é¢æ¥ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç”±äºruntimeä¸­çš„efaceã€ifaceï¼Œæˆ–è€…å®ƒä»¬çš„ç»„æˆå¯èƒ½ä¼šéšç€Goç‰ˆæœ¬çš„å˜åŒ–å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•ä¸å…·å¤‡è·¨ç‰ˆæœ¬å…¼å®¹æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäºGo 1.17ç‰ˆæœ¬å¤åˆ¶çš„ä»£ç ï¼Œå¯èƒ½ä»…é€‚ç”¨äºä½¿ç”¨Go 1.17ç‰ˆæœ¬ç¼–è¯‘ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä»¥Go 1.17ç‰ˆæœ¬ä¸ºä¾‹çœ‹çœ‹ï¼š</p><pre><code class=\"language-plain\">// dumpinterface.go \ntype eface struct {\n    _type *_type\n    data  unsafe.Pointer\n}\n\ntype tflag uint8\ntype nameOff int32\ntype typeOff int32\n\ntype _type struct {\n    size       uintptr\n    ptrdata    uintptr // size of memory prefix holding all pointers\n    hash       uint32\n    tflag      tflag\n    align      uint8\n    fieldAlign uint8\n    kind       uint8\n    // function for comparing objects of this type\n    // (ptr to object A, ptr to object B) -&gt; ==?\n    equal func(unsafe.Pointer, unsafe.Pointer) bool\n    // gcdata stores the GC type data for the garbage collector.\n    // If the KindGCProg bit is set in kind, gcdata is a GC program.\n    // Otherwise it is a ptrmask bitmap. See mbitmap.go for details.\n    gcdata    *byte\n    str       nameOff\n    ptrToThis typeOff\n}\n\ntype iface struct {\n    tab  *itab\n    data unsafe.Pointer\n}\n\ntype itab struct {\n    inter *interfacetype\n    _type *_type\n    hash  uint32 // copy of _type.hash. Used for type switches.\n    _     [4]byte\n    fun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.\n}\n\n... ...\n\nconst ptrSize = unsafe.Sizeof(uintptr(0))\n\nfunc dumpEface(i interface{}) {\n    ptrToEface := (*eface)(unsafe.Pointer(&amp;i))\n    fmt.Printf(\"eface: %+v\\n\", *ptrToEface)\n\n    if ptrToEface._type != nil {\n        // dump _type info\n        fmt.Printf(\"\\t _type: %+v\\n\", *(ptrToEface._type))\n    }\n\n    if ptrToEface.data != nil {\n        // dump data\n        switch i.(type) {\n        case int:\n            dumpInt(ptrToEface.data)\n        case float64:\n            dumpFloat64(ptrToEface.data)\n        case T:\n            dumpT(ptrToEface.data)\n\n        // other cases ... ...\n        default:\n            fmt.Printf(\"\\t unsupported data type\\n\")\n        }\n    }\n    fmt.Printf(\"\\n\")\n}\n\nfunc dumpItabOfIface(ptrToIface unsafe.Pointer) {\n    p := (*iface)(ptrToIface)\n    fmt.Printf(\"iface: %+v\\n\", *p)\n\n    if p.tab != nil {\n        // dump itab\n        fmt.Printf(\"\\t itab: %+v\\n\", *(p.tab))\n        // dump inter in itab\n        fmt.Printf(\"\\t\\t inter: %+v\\n\", *(p.tab.inter))\n\n        // dump _type in itab\n        fmt.Printf(\"\\t\\t _type: %+v\\n\", *(p.tab._type))\n\n        // dump fun in tab\n        funPtr := unsafe.Pointer(&amp;(p.tab.fun))\n        fmt.Printf(\"\\t\\t fun: [\")\n        for i := 0; i &lt; len((*(p.tab.inter)).mhdr); i++ {\n            tp := (*uintptr)(unsafe.Pointer(uintptr(funPtr) + uintptr(i)*ptrSize))\n            fmt.Printf(\"0x%x(%d),\", *tp, *tp)\n        }\n        fmt.Printf(\"]\\n\")\n    }\n}\n\nfunc dumpDataOfIface(i interface{}) {\n    // this is a trick as the data part of eface and iface are same\n    ptrToEface := (*eface)(unsafe.Pointer(&amp;i))\n\n    if ptrToEface.data != nil {\n        // dump data\n        switch i.(type) {\n        case int:\n            dumpInt(ptrToEface.data)\n        case float64:\n            dumpFloat64(ptrToEface.data)\n        case T:\n            dumpT(ptrToEface.data)\n\n        // other cases ... ...\n\n        default:\n            fmt.Printf(\"\\t unsupported data type\\n\")\n        }\n    }\n    fmt.Printf(\"\\n\")\n}\n\nfunc dumpT(dataOfIface unsafe.Pointer) {\n    var p *T = (*T)(dataOfIface)\n    fmt.Printf(\"\\t data: %+v\\n\", *p)\n}\n... ...\n\n</code></pre><p>è¿™é‡Œæˆ‘æŒ‘é€‰äº†å…³é”®éƒ¨åˆ†ï¼Œçœç•¥äº†éƒ¨åˆ†ä»£ç ã€‚ä¸Šé¢è¿™ä¸ªdumpinterface.goä¸­æä¾›äº†ä¸‰ä¸ªä¸»è¦å‡½æ•°:</p><ul>\n<li>dumpEface: ç”¨äºè¾“å‡ºç©ºæ¥å£ç±»å‹å˜é‡çš„å†…éƒ¨è¡¨ç¤ºä¿¡æ¯ï¼›</li>\n<li>dumpItabOfIface: ç”¨äºè¾“å‡ºéç©ºæ¥å£ç±»å‹å˜é‡çš„tabå­—æ®µä¿¡æ¯ï¼›</li>\n<li>dumpDataOfIface: ç”¨äºè¾“å‡ºéç©ºæ¥å£ç±»å‹å˜é‡çš„dataå­—æ®µä¿¡æ¯ï¼›</li>\n</ul><p>æˆ‘ä»¬åˆ©ç”¨è¿™ä¸‰ä¸ªå‡½æ•°æ¥è¾“å‡ºä¸€ä¸‹å‰é¢printEmptyInterfaceAndNonEmptyInterfaceå‡½æ•°ä¸­çš„æ¥å£ç±»å‹å˜é‡çš„ä¿¡æ¯ï¼š</p><pre><code class=\"language-plain\">package main\n\nimport \"unsafe\"\n\ntype T int\n\nfunc (t T) Error() string {\n    return \"bad error\"\n}\n\nfunc main() {\n    var eif interface{} = T(5)\n    var err error = T(5)\n    println(\"eif:\", eif)\n    println(\"err:\", err)\n    println(\"eif = err:\", eif == err)\n    \n    dumpEface(eif)\n    dumpItabOfIface(unsafe.Pointer(&amp;err))\n    dumpDataOfIface(err)\n}\n</code></pre><p>è¿è¡Œè¿™ä¸ªç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™ä¸ªè¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-plain\">eif: (0x10b38c0,0x10e9b30)\nerr: (0x10eb690,0x10e9b30)\neif = err: true\neface: {_type:0x10b38c0 data:0x10e9b30}\n\t _type: {size:8 ptrdata:0 hash:1156555957 tflag:15 align:8 fieldAlign:8 kind:2 equal:0x10032e0 gcdata:0x10e9a60 str:4946 ptrToThis:58496}\n\t data: bad error\n\niface: {tab:0x10eb690 data:0x10e9b30}\n\t itab: {inter:0x10b5e20 _type:0x10b38c0 hash:1156555957 _:[0 0 0 0] fun:[17454976]}\n\t\t inter: {typ:{size:16 ptrdata:16 hash:235953867 tflag:7 align:8 fieldAlign:8 kind:20 equal:0x10034c0 gcdata:0x10d2418 str:3666 ptrToThis:26848} pkgpath:{bytes:&lt;nil&gt;} mhdr:[{name:2592 ityp:43520}]}\n\t\t _type: {size:8 ptrdata:0 hash:1156555957 tflag:15 align:8 fieldAlign:8 kind:2 equal:0x10032e0 gcdata:0x10e9a60 str:4946 ptrToThis:58496}\n\t\t fun: [0x10a5780(17454976),]\n\t data: bad error\n</code></pre><p>ä»è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°eifçš„_typeï¼ˆ0x10b38c0ï¼‰ä¸errçš„tab._typeï¼ˆ0x10b38c0ï¼‰æ˜¯ä¸€è‡´çš„ï¼ŒdataæŒ‡é’ˆæ‰€æŒ‡å†…å®¹ï¼ˆâ€œbad errorâ€ï¼‰ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤<code>eif == err</code>è¡¨è¾¾å¼çš„ç»“æœä¸ºtrueã€‚</p><p>å†æ¬¡å¼ºè°ƒä¸€éï¼Œä¸Šé¢è¿™ä¸ªå®ç°å¯èƒ½ä»…åœ¨Go 1.17ç‰ˆæœ¬ä¸Šæµ‹è¯•é€šè¿‡ï¼Œå¹¶ä¸”åœ¨è¾“å‡ºifaceæˆ–efaceçš„dataéƒ¨åˆ†å†…å®¹æ—¶åªåˆ—å‡ºäº†intã€float64å’ŒTç±»å‹çš„æ•°æ®è¯»å–å®ç°ï¼Œæ²¡æœ‰åˆ—å‡ºå…¨éƒ¨ç±»å‹çš„å®ç°ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å®ç°å…¶ä½™æ•°æ®ç±»å‹ã€‚dumpinterface.goçš„å®Œæ•´ä»£ç ä½ å¯ä»¥åœ¨<a href=\"https://github.com/bigwhite/publication/tree/master/column/timegeek/go-first-course/29\">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p><p>æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“äº†ï¼Œæ¥å£ç±»å‹æœ‰ç€å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¸€ä¸ªç±»å‹å˜é‡å€¼èµ‹å€¼ç»™ä¸€ä¸ªæ¥å£ç±»å‹å˜é‡å€¼çš„è¿‡ç¨‹è‚¯å®šä¸ä¼šåƒ<code>var i int = 5</code>é‚£ä¹ˆç®€å•ï¼Œé‚£ä¹ˆæ¥å£ç±»å‹å˜é‡èµ‹å€¼çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå…¶å®æ¥å£ç±»å‹å˜é‡èµ‹å€¼æ˜¯ä¸€ä¸ªâ€œè£…ç®±â€çš„è¿‡ç¨‹ã€‚</p><h2>æ¥å£ç±»å‹çš„è£…ç®±ï¼ˆboxingï¼‰åŸç†</h2><p><strong>è£…ç®±ï¼ˆboxingï¼‰</strong>æ˜¯ç¼–ç¨‹è¯­è¨€é¢†åŸŸçš„ä¸€ä¸ªåŸºç¡€æ¦‚å¿µï¼Œä¸€èˆ¬æ˜¯æŒ‡æŠŠä¸€ä¸ªå€¼ç±»å‹è½¬æ¢æˆå¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚åœ¨æ”¯æŒè£…ç®±æ¦‚å¿µçš„Javaè¯­è¨€ä¸­ï¼Œå°†ä¸€ä¸ªintå˜é‡è½¬æ¢æˆIntegerå¯¹è±¡å°±æ˜¯ä¸€ä¸ªè£…ç®±æ“ä½œã€‚</p><p>åœ¨Goè¯­è¨€ä¸­ï¼Œå°†ä»»æ„ç±»å‹èµ‹å€¼ç»™ä¸€ä¸ªæ¥å£ç±»å‹å˜é‡ä¹Ÿæ˜¯<strong>è£…ç®±</strong>æ“ä½œã€‚æœ‰äº†å‰é¢å¯¹æ¥å£ç±»å‹å˜é‡å†…éƒ¨è¡¨ç¤ºçš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“<strong>æ¥å£ç±»å‹çš„è£…ç®±å®é™…å°±æ˜¯åˆ›å»ºä¸€ä¸ªefaceæˆ–ifaceçš„è¿‡ç¨‹</strong>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ç®€è¦æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æ¥å£ç±»å‹çš„è£…ç®±åŸç†ã€‚</p><p>æˆ‘ä»¬åŸºäºä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­çš„æ¥å£è£…ç®±æ“ä½œæ¥è¯´æ˜ï¼š</p><pre><code class=\"language-plain\">// interface_internal.go\n\n  type T struct {\n      n int\n      s string\n  }\n  \n  func (T) M1() {}\n  func (T) M2() {}\n  \n  type NonEmptyInterface interface {\n      M1()\n      M2()\n  }\n  \n  func main() {\n      var t = T{\n          n: 17,\n          s: \"hello, interface\",\n      }\n      var ei interface{}\n      ei = t\n \n      var i NonEmptyInterface\n      i = t\n      fmt.Println(ei)\n      fmt.Println(i)\n  }\n</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¯¹eiå’Œiä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡çš„èµ‹å€¼éƒ½ä¼šè§¦å‘è£…ç®±æ“ä½œï¼Œè¦æƒ³çŸ¥é“Goåœ¨èƒŒååšäº†äº›ä»€ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦â€œä¸‹æ²‰â€ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯è¦è¾“å‡ºä¸Šé¢Goä»£ç å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼š</p><pre><code class=\"language-plain\">$go tool compile -S interface_internal.go &gt; interface_internal.s\n</code></pre><p>å¯¹åº”<code>ei = t</code>ä¸€è¡Œçš„æ±‡ç¼–å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">    0x0026 00038 (interface_internal.go:24) MOVQ    $17, \"\"..autotmp_15+104(SP)\n    0x002f 00047 (interface_internal.go:24) LEAQ    go.string.\"hello, interface\"(SB), CX\n    0x0036 00054 (interface_internal.go:24) MOVQ    CX, \"\"..autotmp_15+112(SP)\n    0x003b 00059 (interface_internal.go:24) MOVQ    $16, \"\"..autotmp_15+120(SP)\n    0x0044 00068 (interface_internal.go:24) LEAQ    type.\"\".T(SB), AX\n    0x004b 00075 (interface_internal.go:24) LEAQ    \"\"..autotmp_15+104(SP), BX\n    0x0050 00080 (interface_internal.go:24) PCDATA  $1, $0\n    0x0050 00080 (interface_internal.go:24) CALL    runtime.convT2E(SB)\n</code></pre><p>å¯¹åº”i = tä¸€è¡Œçš„æ±‡ç¼–å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">    0x005f 00095 (interface_internal.go:27) MOVQ    $17, \"\"..autotmp_15+104(SP)\n    0x0068 00104 (interface_internal.go:27) LEAQ    go.string.\"hello, interface\"(SB), CX\n    0x006f 00111 (interface_internal.go:27) MOVQ    CX, \"\"..autotmp_15+112(SP)\n    0x0074 00116 (interface_internal.go:27) MOVQ    $16, \"\"..autotmp_15+120(SP)\n    0x007d 00125 (interface_internal.go:27) LEAQ    go.itab.\"\".T,\"\".NonEmptyInterface(SB), AX\n    0x0084 00132 (interface_internal.go:27) LEAQ    \"\"..autotmp_15+104(SP), BX\n    0x0089 00137 (interface_internal.go:27) PCDATA  $1, $1\n    0x0089 00137 (interface_internal.go:27) CALL    runtime.convT2I(SB)\n</code></pre><p>åœ¨å°†åŠ¨æ€ç±»å‹å˜é‡èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡è¯­å¥å¯¹åº”çš„æ±‡ç¼–ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<code>convT2E</code>å’Œ<code>convT2I</code>ä¸¤ä¸ªruntimeåŒ…çš„å‡½æ•°ã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°ä½äº<code>$GOROOT/src/runtime/iface.go</code>ä¸­ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/iface.go\n\nfunc convT2E(t *_type, elem unsafe.Pointer) (e eface) {\n    if raceenabled {\n        raceReadObjectPC(t, elem, getcallerpc(), funcPC(convT2E))\n    }\n    if msanenabled {\n        msanread(elem, t.size)\n    }\n    x := mallocgc(t.size, t, true)\n    typedmemmove(t, x, elem)\n    e._type = t\n    e.data = x\n    return\n}\n\nfunc convT2I(tab *itab, elem unsafe.Pointer) (i iface) {\n    t := tab._type\n    if raceenabled {\n        raceReadObjectPC(t, elem, getcallerpc(), funcPC(convT2I))\n    }\n    if msanenabled {\n        msanread(elem, t.size)\n    }\n    x := mallocgc(t.size, t, true)\n    typedmemmove(t, x, elem)\n    i.tab = tab\n    i.data = x\n    return\n}\n</code></pre><p>convT2Eç”¨äºå°†ä»»æ„ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªefaceï¼ŒconvT2Iç”¨äºå°†ä»»æ„ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªifaceã€‚ä¸¤ä¸ªå‡½æ•°çš„å®ç°é€»è¾‘ç›¸ä¼¼ï¼Œä¸»è¦æ€è·¯å°±æ˜¯æ ¹æ®ä¼ å…¥çš„ç±»å‹ä¿¡æ¯ï¼ˆconvT2Eçš„_typeå’ŒconvT2Içš„tab._typeï¼‰åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ï¼Œå¹¶å°†elemæŒ‡å‘çš„æ•°æ®æ‹·è´åˆ°è¿™å—å†…å­˜ç©ºé—´ä¸­ï¼Œæœ€åä¼ å…¥çš„ç±»å‹ä¿¡æ¯ä½œä¸ºè¿”å›å€¼ç»“æ„ä¸­çš„ç±»å‹ä¿¡æ¯ï¼Œè¿”å›å€¼ç»“æ„ä¸­çš„æ•°æ®æŒ‡é’ˆï¼ˆdataï¼‰æŒ‡å‘æ–°åˆ†é…çš„é‚£å—å†…å­˜ç©ºé—´ã€‚</p><p>ç”±æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œç»è¿‡è£…ç®±åï¼Œç®±å†…çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾åœ¨æ–°åˆ†é…çš„å†…å­˜ç©ºé—´ä¸­çš„æ•°æ®ä¸åŸå˜é‡ä¾¿æ— ç“œè‘›äº†ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><pre><code class=\"language-plain\">func main() {\n\tvar n int = 61\n\tvar ei interface{} = n\n\tn = 62  // nçš„å€¼å·²ç»æ”¹å˜\n\tfmt.Println(\"data in box:\", ei) // è¾“å‡ºä»æ˜¯61\n}\n</code></pre><p>é‚£ä¹ˆconvT2Eå’ŒconvT2Iå‡½æ•°çš„ç±»å‹ä¿¡æ¯æ˜¯ä»ä½•è€Œæ¥çš„å‘¢ï¼Ÿ</p><p>å…¶å®è¿™äº›éƒ½ä¾èµ–Goç¼–è¯‘å™¨çš„å·¥ä½œã€‚ç¼–è¯‘å™¨çŸ¥é“æ¯ä¸ªè¦è½¬æ¢ä¸ºæ¥å£ç±»å‹å˜é‡ï¼ˆtoTypeï¼‰å’ŒåŠ¨æ€ç±»å‹å˜é‡çš„ç±»å‹ï¼ˆfromTypeï¼‰ï¼Œå®ƒä¼šæ ¹æ®è¿™ä¸€å¯¹ç±»å‹é€‰æ‹©é€‚å½“çš„convT2Xå‡½æ•°ï¼Œå¹¶åœ¨ç”Ÿæˆä»£ç æ—¶ä½¿ç”¨é€‰å‡ºçš„convT2Xå‡½æ•°å‚ä¸è£…ç®±æ“ä½œã€‚</p><p>ä¸è¿‡ï¼Œè£…ç®±æ˜¯ä¸€ä¸ªæœ‰æ€§èƒ½æŸè€—çš„æ“ä½œï¼Œå› æ­¤Goä¹Ÿåœ¨ä¸æ–­å¯¹è£…ç®±æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼ŒåŒ…æ‹¬å¯¹å¸¸è§ç±»å‹å¦‚æ•´å‹ã€å­—ç¬¦ä¸²ã€åˆ‡ç‰‡ç­‰æä¾›ç³»åˆ—å¿«é€Ÿè½¬æ¢å‡½æ•°ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/iface.go\nfunc convT16(val any) unsafe.Pointer     // val must be uint16-like\nfunc convT32(val any) unsafe.Pointer     // val must be uint32-like\nfunc convT64(val any) unsafe.Pointer     // val must be uint64-like\nfunc convTstring(val any) unsafe.Pointer // val must be a string\nfunc convTslice(val any) unsafe.Pointer  // val must be a slice\n</code></pre><p>è¿™äº›å‡½æ•°å»é™¤äº†typedmemmoveæ“ä½œï¼Œå¢åŠ äº†é›¶å€¼å¿«é€Ÿè¿”å›ç­‰ç‰¹æ€§ã€‚</p><p>åŒæ—¶Goå»ºç«‹äº†staticuint64såŒºåŸŸï¼Œå¯¹255ä»¥å†…çš„å°æ•´æ•°å€¼è¿›è¡Œè£…ç®±æ“ä½œæ—¶<a href=\"https://github.com/golang/go/issues/17725\">ä¸å†åˆ†é…æ–°å†…å­˜</a>ï¼Œè€Œæ˜¯åˆ©ç”¨staticuint64såŒºåŸŸçš„å†…å­˜ç©ºé—´ï¼Œä¸‹é¢æ˜¯staticuint64sçš„å®šä¹‰ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/runtime/iface.go\n// staticuint64s is used to avoid allocating in convTx for small integer values.\nvar staticuint64s = [...]uint64{\n    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n    0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,\n\t... ...\n}\n</code></pre><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>æ¥å£ç±»å‹ä½œä¸ºå‚ä¸æ„å»ºGoåº”ç”¨éª¨æ¶çš„é‡è¦å‚ä¸è€…ï¼Œåœ¨Goè¯­è¨€ä¸­æœ‰ç€å¾ˆé«˜çš„åœ°ä½ã€‚å®ƒè¿™ä¸ªåœ°ä½çš„å–å¾—ç¦»ä¸å¼€å®ƒæ‹¥æœ‰çš„â€œåŠ¨é™å…¼å¤‡â€çš„è¯­æ³•ç‰¹æ€§ã€‚Goæ¥å£çš„åŠ¨æ€ç‰¹æ€§è®©Goæ‹¥æœ‰ä¸åŠ¨æ€è¯­è¨€ç›¸è¿‘çš„çµæ´»æ€§ï¼Œè€Œé™æ€ç‰¹æ€§åˆåœ¨ç¼–è¯‘é˜¶æ®µä¿è¯äº†è¿™ç§çµæ´»æ€§çš„å®‰å…¨ã€‚</p><p>è¦æ›´å¥½åœ°ç†è§£Goæ¥å£çš„è¿™ä¸¤ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥åˆ°Goæ¥å£åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºå±‚é¢ä¸Šå»ã€‚æ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶è¡¨ç¤ºä¸ºefaceå’Œifaceï¼Œefaceç”¨äºè¡¨ç¤ºç©ºæ¥å£ç±»å‹å˜é‡ï¼Œifaceç”¨äºè¡¨ç¤ºéç©ºæ¥å£ç±»å‹å˜é‡ã€‚åªæœ‰ä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡çš„ç±»å‹ä¿¡æ¯ï¼ˆeface._type/iface.tab._typeï¼‰ç›¸åŒï¼Œä¸”æ•°æ®æŒ‡é’ˆï¼ˆeface.data/iface.dataï¼‰æ‰€æŒ‡æ•°æ®ç›¸åŒæ—¶ï¼Œä¸¤ä¸ªæ¥å£ç±»å‹å˜é‡æ‰æ˜¯ç›¸ç­‰çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡printlnè¾“å‡ºæ¥å£ç±»å‹å˜é‡çš„ä¸¤éƒ¨åˆ†æŒ‡é’ˆå˜é‡çš„å€¼ã€‚è€Œä¸”ï¼Œé€šè¿‡æ‹·è´runtimeåŒ…efaceå’Œifaceç›¸å…³ç±»å‹æºç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰è¾“å‡ºeface/ifaceè¯¦å°½ä¿¡æ¯çš„å‡½æ•°ï¼Œä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºruntimeå±‚ä»£ç çš„æ¼”è¿›ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½ä¸å…·å¤‡åœ¨Goç‰ˆæœ¬é—´çš„ç§»æ¤æ€§ã€‚</p><p>æœ€åï¼Œæ¥å£ç±»å‹å˜é‡çš„èµ‹å€¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è£…ç®±æ“ä½œï¼Œè£…ç®±æ“ä½œæ˜¯ç”±Goç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å…±åŒå®Œæˆçš„ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¯¹äºæ€§èƒ½æ•æ„Ÿçš„ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…æˆ–å‡å°‘è¿™ç±»è£…ç®±æ“ä½œã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åƒnil errorå€¼ != nilé‚£ä¸ªä¾‹å­ä¸­çš„â€œå‘â€ä½ åœ¨æ—¥å¸¸ç¼–ç æ—¶æœ‰é‡åˆ°è¿‡å—ï¼Ÿå¯ä»¥å’Œæˆ‘ä»¬åˆ†äº«ä¸€ä¸‹å—ï¼Ÿå¦å¤–ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾ä¸­çš„è¿™ä¸ªä¾‹å­å¦‚ä½•ä¿®æ”¹ï¼Œæ‰èƒ½è®©å®ƒæŒ‰æˆ‘ä»¬æœ€åˆçš„é¢„æœŸç»“æœè¾“å‡ºå‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„ç»éªŒå’Œæƒ³æ³•ã€‚ä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹Goæ¥å£æ„Ÿå…´è¶£çš„æœ‹å‹ã€‚æˆ‘æ˜¯Tony Baiï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"28ï½œæ¥å£ï¼šæ¥å£å³å¥‘çº¦","id":471952},"right":{"article_title":"30ï½œæ¥å£ï¼šGoä¸­æœ€å¼ºå¤§çš„é­”æ³•","id":474260}},"comments":[{"had_liked":false,"id":328488,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1640751323,"is_pvip":false,"replies":[{"id":"120354","content":"å—å® è‹¥æƒŠğŸ˜","user_name":"ä½œè€…å›å¤","comment_id":328488,"uid":"1026224","ip_address":"","utype":1,"ctime":1641894304,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"61770293467","product_id":100093501,"comment_content":"è€å¸ˆè®²çš„å¤ªå¥½ï¼Œ è¿™ä¸€ç¯‡ çŸ¥è¯†å¯†åº¦ç›¸å½“å¤§å•Šï¼Œ <br>å°±è¿™ä¸€ç¯‡å°±å€¼ä¸“æ çš„ä»·æ ¼äº†ã€‚<br>æ„Ÿè°¢è€å¸ˆå¦‚æ­¤ç”¨å¿ƒçš„è¾“å‡ºã€‚","like_count":14,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545286,"discussion_content":"å—å® è‹¥æƒŠğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641894305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328421,"user_name":"Geralt","can_delete":false,"product_type":"c1","uid":1184102,"ip_address":"","ucode":"2F31ED777D06A0","user_header":"https://static001.geekbang.org/account/avatar/00/12/11/66/ac631a36.jpg","comment_is_top":false,"comment_ctime":1640721042,"is_pvip":true,"replies":[{"id":"120412","content":"âœ…","user_name":"ä½œè€…å›å¤","comment_id":328421,"uid":"1026224","ip_address":"","utype":1,"ctime":1641995963,"user_name_real":"ç¼–è¾‘"}],"discussion_count":3,"race_medal":0,"score":"53180328594","product_id":100093501,"comment_content":"ä¿®æ”¹æ–¹æ³•:<br>1. æŠŠreturnsError()é‡Œé¢pçš„ç±»å‹æ”¹ä¸ºerror<br>2. åˆ é™¤pï¼Œç›´æ¥return &amp;ErrBadæˆ–è€…nil","like_count":12,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545564,"discussion_content":"âœ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641995963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072015,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","nickname":"Middleware","note":"","ucode":"C0028293ECDD47","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542798,"discussion_content":"ä¸æ„§æ˜¯åä¸ºå­—èŠ‚ç½‘æ˜“é¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640847510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1025239,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a4/d7/5d2bfaa7.jpg","nickname":"Aliliin","note":"","ucode":"61F9A09BB6650F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548275,"discussion_content":"ä¸æ„§æ˜¯åä¸ºå­—èŠ‚ç½‘æ˜“é¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643108236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329453,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","comment_is_top":false,"comment_ctime":1641354219,"is_pvip":false,"replies":[{"id":"120467","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":329453,"uid":"1026224","ip_address":"","utype":1,"ctime":1642038695,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"40296059883","product_id":100093501,"comment_content":"æ€è€ƒé¢˜æœ‰2 ç§æ–¹æ³•ï¼š<br>1ï¼‰returnsError() å‡½æ•°ä¸è¿”å› error éç©ºæ¥å£ç±»å‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç»“æ„ä½“æŒ‡é’ˆ *MyErrorï¼ˆæ˜ç¡®çš„ç±»å‹ï¼Œé˜»æ­¢è‡ªåŠ¨è£…ç®±ï¼‰ï¼›<br>2ï¼‰ä¸è¦ç›´æ¥ err != nil è¿™æ ·åˆ¤æ–­ï¼Œè€Œæ˜¯ä½¿ç”¨ç±»å‹æ–­è¨€æ¥åˆ¤æ–­ï¼š<br>if e, ok := err.(*MyError); ok &amp;&amp; e != nil {<br>    fmt.Printf(&quot;error occur: %+v\\n&quot;, e)<br>    return<br>}<br><br>PSï¼šGo çš„â€œæ¥å£â€åœ¨ç¼–ç¨‹ä¸­éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¿…é¡»ææ¸…æ¥šæ¥å£ç±»å‹å˜é‡åœ¨è¿è¡Œæ—¶çš„è¡¨ç¤ºï¼Œä»¥é¿å…è¸©å‘ï¼ï¼ï¼","like_count":10,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545675,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642038695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328497,"user_name":"åœ¨ä¸‹å®é¾™ã€","can_delete":false,"product_type":"c1","uid":1618030,"ip_address":"","ucode":"0735B64EB61CAC","user_header":"https://static001.geekbang.org/account/avatar/00/18/b0/6e/921cb700.jpg","comment_is_top":false,"comment_ctime":1640754043,"is_pvip":false,"replies":[{"id":"120420","content":"åˆ¤ç›¸ç­‰ä¸è¦çœ‹dataæŒ‡é’ˆçš„å€¼ï¼Œè¦çœ‹dataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨çš„å€¼æ˜¯å¦ç›¸åŒã€‚","user_name":"ä½œè€…å›å¤","comment_id":328497,"uid":"1026224","ip_address":"","utype":1,"ctime":1641996683,"user_name_real":"ç¼–è¾‘"}],"discussion_count":3,"race_medal":0,"score":"18820623227","product_id":100093501,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œåœ¨   eif2 = 17 è¿™ä¸ªæ“ä½œåï¼Œè¾“å‡ºåçš„data  ,0xc00007ef48 å’Œ0x10eb3d0 ä¸ç›¸ç­‰å‘€ï¼Œä¸ºç”šä¹ˆè¯´ä»–ä»¬æ˜¯ä¸€æ ·çš„<br>eif1: (0x10ac580,0xc00007ef48)<br>eif2: (0x10ac580,0x10eb3d0)","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545574,"discussion_content":"åˆ¤ç›¸ç­‰ä¸è¦çœ‹dataæŒ‡é’ˆçš„å€¼ï¼Œè¦çœ‹dataæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ä¸­å­˜å‚¨çš„å€¼æ˜¯å¦ç›¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641996683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2049562,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/aQmhiahazRFUA4W3r1hdxxreSB5Pl54IwAJ8bwN6j02lzicydWAfPFbWx1LSFtzXH8MkI0jUKjlpUtmQBoZ4kReA/132","nickname":"Geek_99b47c","note":"","ucode":"D25E22C1D84E09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542520,"discussion_content":"æŒ‡é’ˆæŒ‡å‘çš„å€¼ç›¸åŒï¼Œæ–‡ä¸­æœ‰è®²çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640771848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2104856,"avatar":"https://static001.geekbang.org/account/avatar/00/20/1e/18/9d1f1439.jpg","nickname":"liaomars","note":"","ucode":"4FCA97EE9FB57D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542813,"discussion_content":"ä¸æ˜¯æŒ‡é’ˆçš„å€¼ç›¸åŒï¼Œæ˜¯æŒ‡å‘çš„å†…å®¹ç›¸åŒå°±å¥½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640852572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342723,"user_name":"Slowdive","can_delete":false,"product_type":"c1","uid":1624537,"ip_address":"","ucode":"AF3429CE47C462","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/d9/00870178.jpg","comment_is_top":false,"comment_ctime":1650433252,"is_pvip":false,"replies":[{"id":"125224","content":"æ­£ç¡®ã€‚","user_name":"ä½œè€…å›å¤","comment_id":342723,"uid":"1026224","ip_address":"","utype":1,"ctime":1650493735,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"14535335140","product_id":100093501,"comment_content":"è€å¸ˆï¼Œ è¯·é—®è¿™é‡Œå‘ç”Ÿè£…ç®±äº†å—ï¼Ÿ è¿”å›ç±»å‹æ˜¯errorï¼Œ æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ pæ˜¯*MyErrorï¼Œ pçš„æ–¹æ³•åˆ—è¡¨è¦†ç›–äº†errorè¿™ä¸ªæ¥å£ï¼Œ æ‰€ä»¥æ˜¯å¯ä»¥èµ‹å€¼ç»™errorç±»å‹çš„å˜é‡ã€‚ <br>è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œèµ‹å€¼ç»™æ¥å£ç±»å‹ï¼Œåšè£…ç®±åˆ›å»ºifaceï¼Œ <br>p != nilå°±æˆäº† (&amp;tab, 0x0) != (0x0, 0x0)<br><br>func returnsError() error {    <br>    var p *MyError = nil    <br>    if bad() {<br>        p = &amp;ErrBad<br>    }<br>    return p<br>}<br><br>è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565543,"discussion_content":"æ­£ç¡®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650493735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329552,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","comment_is_top":false,"comment_ctime":1641397494,"is_pvip":false,"replies":[{"id":"120470","content":"å¥½å¤šäººæå‡ºæ¥äº†ï¼Œåç»­å®šå¼„ä¸ªåŠ é¤è¯´è¯´æŒ‡é’ˆã€‚ä¸è¿‡éœ€è¦æŠŠæ‰€æœ‰æ­£æ–‡éƒ½æ›´å®Œåï¼Œç¼–è¾‘è€å¸ˆå‚¬çš„ç´§ï¼Œä½ äº†è§£çš„:)","user_name":"ä½œè€…å›å¤","comment_id":329552,"uid":"1026224","ip_address":"","utype":1,"ctime":1642039187,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"14526299382","product_id":100093501,"comment_content":"Go æŒ‡é’ˆè¿™å—ï¼Œæ„Ÿè§‰å¯ä»¥å•ç‹¬æŠ½å‡ºä¸€è®²æ¥è®²ä¸‹ï¼Œå¹¶ä¸”ç»“åˆunsafe è®²è§£ï¼Œä¸çŸ¥é“å¤§ç™½è€å¸ˆèƒ½å¦æ»¡è¶³å¤§å®¶çš„æ„¿æœ›å‘¢ï¼ŸğŸ˜‚","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545680,"discussion_content":"å¥½å¤šäººæå‡ºæ¥äº†ï¼Œåç»­å®šå¼„ä¸ªåŠ é¤è¯´è¯´æŒ‡é’ˆã€‚ä¸è¿‡éœ€è¦æŠŠæ‰€æœ‰æ­£æ–‡éƒ½æ›´å®Œåï¼Œç¼–è¾‘è€å¸ˆå‚¬çš„ç´§ï¼Œä½ äº†è§£çš„:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642039187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329171,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1641194449,"is_pvip":false,"replies":[{"id":"120436","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":329171,"uid":"1026224","ip_address":"","utype":1,"ctime":1641998086,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"14526096337","product_id":100093501,"comment_content":"åŸæ¥è£…ç®±æ˜¯è¿™æ ·ï¼šå°†ä»»æ„ç±»å‹èµ‹å€¼ç»™ä¸€ä¸ªæ¥å£ç±»å‹å˜é‡å°±æ˜¯è£…ç®±æ“ä½œã€‚<br>æ¥å£ç±»å‹çš„è£…ç®±å®é™…å°±æ˜¯åˆ›å»ºä¸€ä¸ª eface æˆ– iface çš„è¿‡ç¨‹","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545597,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641998086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350401,"user_name":"Geek_a6104e","can_delete":false,"product_type":"c1","uid":1711967,"ip_address":"","ucode":"29A56792216DC8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/GJXKh8OG00U5ial64plAIibbIuwkzhPc8uYic9Hibl8SbqvhnS2JImHgCD4JGvTktiaVnCjHQWbA5wicaxRUN5aTEWnQ/132","comment_is_top":false,"comment_ctime":1656896943,"is_pvip":false,"replies":[{"id":"127492","content":"å¥½é—®é¢˜ã€‚<br><br>ä¸ºä»€ä¹ˆè¾“å‡ºbad errorè€Œä¸æ˜¯5ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„dumpTå‡½æ•°çš„å®ç°ï¼š<br><br>func dumpT(dataOfIface unsafe.Pointer) {<br>    var p *T = (*T)(dataOfIface)<br>    fmt.Printf(&quot;\\t data: %+v\\n&quot;, *p)<br>}<br><br>è¿™é‡Œçš„Printfä½¿ç”¨äº†%+vã€‚<br><br>åœ¨æ ‡å‡†åº“fmtåŒ…çš„manualï¼ˆhttps:&#47;&#47;pkg.go.dev&#47;fmtï¼‰ä¸­æœ‰ï¼Œå½“verbä¸º%væ—¶ï¼Œå¦‚æœæ“ä½œæ•°å®ç°äº†erroræ¥å£ï¼Œé‚£ä¹ˆPrintfå°†ä¼šè°ƒç”¨è¿™ä¸ªæ“ä½œæ•°çš„Erroræ–¹æ³•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚<br><br>åŸæ–‡ï¼šIf an operand implements the error interface, the Error method will be invoked to convert the object to a string<br><br>æ‰€ä»¥è¿™é‡Œè¾“å‡ºçš„æ˜¯bad errorã€‚<br><br>å¯ä»¥å†ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š<br><br>package main<br>  <br>import &quot;fmt&quot;<br><br>type T int<br><br>func (t T) Error() string {<br>    return &quot;bad error&quot;<br>}<br><br>func main() {<br>    var t = T(5)<br><br>    fmt.Printf(&quot;%d\\n&quot;, t) &#47;&#47; 5<br>    fmt.Printf(&quot;%v\\n&quot;, t) &#47;&#47; bad error<br>}<br><br><br><br><br>","user_name":"ä½œè€…å›å¤","comment_id":350401,"uid":"1026224","ip_address":"","utype":1,"ctime":1656969942,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10246831535","product_id":100093501,"comment_content":"eif: (0x10b38c0,0x10e9b30)<br>err: (0x10eb690,0x10e9b30)<br>eif = err: true<br>eface: {_type:0x10b38c0 data:0x10e9b30}<br>   _type: {size:8 ptrdata:0 hash:1156555957 tflag:15 align:8 fieldAlign:8 kind:2 equal:0x10032e0 gcdata:0x10e9a60 str:4946 ptrToThis:58496}<br>   data: bad error<br><br>iface: {tab:0x10eb690 data:0x10e9b30}<br>   itab: {inter:0x10b5e20 _type:0x10b38c0 hash:1156555957 _:[0 0 0 0] fun:[17454976]}<br>     inter: {typ:{size:16 ptrdata:16 hash:235953867 tflag:7 align:8 fieldAlign:8 kind:20 equal:0x10034c0 gcdata:0x10d2418 str:3666 ptrToThis:26848} pkgpath:{bytes:&lt;nil&gt;} mhdr:[{name:2592 ityp:43520}]}<br>     _type: {size:8 ptrdata:0 hash:1156555957 tflag:15 align:8 fieldAlign:8 kind:2 equal:0x10032e0 gcdata:0x10e9a60 str:4946 ptrToThis:58496}<br>     fun: [0x10a5780(17454976),]<br>   data: bad error è¯·é—®ä¸ºä»€ä¹ˆdataä¼šæ˜¯bad errorä¸åº”è¯¥æ˜¯5å—","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578697,"discussion_content":"å¥½é—®é¢˜ã€‚\n\nä¸ºä»€ä¹ˆè¾“å‡ºbad errorè€Œä¸æ˜¯5ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„dumpTå‡½æ•°çš„å®ç°ï¼š\n\nfunc dumpT(dataOfIface unsafe.Pointer) {\n    var p *T = (*T)(dataOfIface)\n    fmt.Printf(&#34;\\t data: %+v\\n&#34;, *p)\n}\n\nè¿™é‡Œçš„Printfä½¿ç”¨äº†%+vã€‚\n\nåœ¨æ ‡å‡†åº“fmtåŒ…çš„manualï¼ˆhttps://pkg.go.dev/fmtï¼‰ä¸­æœ‰ï¼Œå½“verbä¸º%væ—¶ï¼Œå¦‚æœæ“ä½œæ•°å®ç°äº†erroræ¥å£ï¼Œé‚£ä¹ˆPrintfå°†ä¼šè°ƒç”¨è¿™ä¸ªæ“ä½œæ•°çš„Erroræ–¹æ³•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚\n\nåŸæ–‡ï¼šIf an operand implements the error interface, the Error method will be invoked to convert the object to a string\n\næ‰€ä»¥è¿™é‡Œè¾“å‡ºçš„æ˜¯bad errorã€‚\n\nå¯ä»¥å†ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\npackage main\n  \nimport &#34;fmt&#34;\n\ntype T int\n\nfunc (t T) Error() string {\n    return &#34;bad error&#34;\n}\n\nfunc main() {\n    var t = T(5)\n\n    fmt.Printf(&#34;%d\\n&#34;, t) // 5\n    fmt.Printf(&#34;%v\\n&#34;, t) // bad error\n}\n\n\n\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1656969942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336010,"user_name":"éƒ‘æ³½æ´²","can_delete":false,"product_type":"c1","uid":1447496,"ip_address":"","ucode":"EA1B540A040875","user_header":"https://static001.geekbang.org/account/avatar/00/16/16/48/01567df1.jpg","comment_is_top":false,"comment_ctime":1645846146,"is_pvip":true,"replies":[{"id":"122861","content":"å¥½é—®é¢˜ï¼<br><br>å‡è®¾æŒ‰ç…§ä½ è¯´çš„ï¼Œinterfaceä¸­ç›´æ¥ç”¨åŸå…ˆçš„å€¼ï¼Œé‚£ä¹ˆinterfaceç±»å‹åœ¨runtimeä¸­çš„è¡¨ç¤ºä¸€å®šæ˜¯(type, ptr)çš„äºŒå…ƒç»„ã€‚è€ŒptræŒ‡å‘åŸå€¼çš„åœ°å€ã€‚è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œçœ‹ä¸ªä¾‹å­ï¼š<br><br>func foo(i interface{}) {<br>   i.(int) = 8<br>}<br><br>var a int = 6<br>var i interface{} = a<br>i.(int) = 7<br>println(a) &#47;&#47; a = 7 è¿™ä¼¼ä¹è¿˜è¯´å¾—è¿‡å»ã€‚<br><br>ä½†æ˜¯å¦‚æœå°†iä¼ é€’ç»™å‡½æ•°fooï¼š<br>foo(i) <br><br>fooå¯¹içš„ä¿®æ”¹å°†éƒ½åæ˜ åˆ°aä¸Šï¼š<br><br>println(a) &#47;&#47; a = 8<br><br>è¿™ä¸å€¼æ‹·è´è¯­ä¹‰ä¼¼ä¹æœ‰æ‚–ã€‚<br><br>","user_name":"ä½œè€…å›å¤","comment_id":336010,"uid":"1026224","ip_address":"","utype":1,"ctime":1645997675,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10235780738","product_id":100093501,"comment_content":"è¯·æ•™è€å¸ˆï¼Œæ¥å£ç±»å‹è£…ç®±è¿‡ç¨‹ä¸ºä»€ä¹ˆæ™®éè¦æŠŠåŸæ¥çš„å€¼å¤åˆ¶ä¸€ä»½åˆ°dataï¼Ÿï¼ˆé™¤äº†staticuint64sç­‰ç‰¹ä¾‹ï¼‰ç›´æ¥ç”¨åŸæ¥çš„å€¼ä¸è¡Œå—ï¼Œè¿˜èƒ½æå‡ç‚¹æ€§èƒ½","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553623,"discussion_content":"å¥½é—®é¢˜ï¼\n\nå‡è®¾æŒ‰ç…§ä½ è¯´çš„ï¼Œinterfaceä¸­ç›´æ¥ç”¨åŸå…ˆçš„å€¼ï¼Œé‚£ä¹ˆinterfaceç±»å‹åœ¨runtimeä¸­çš„è¡¨ç¤ºä¸€å®šæ˜¯(type, ptr)çš„äºŒå…ƒç»„ã€‚è€ŒptræŒ‡å‘åŸå€¼çš„åœ°å€ã€‚è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œçœ‹ä¸ªä¾‹å­ï¼š\n\nfunc foo(i interface{}) {\n   i.(int) = 8\n}\n\nvar a int = 6\nvar i interface{} = a\ni.(int) = 7\nprintln(a) // a = 7 è¿™ä¼¼ä¹è¿˜è¯´å¾—è¿‡å»ã€‚\n\nä½†æ˜¯å¦‚æœå°†iä¼ é€’ç»™å‡½æ•°fooï¼š\nfoo(i) \n\nfooå¯¹içš„ä¿®æ”¹å°†éƒ½åæ˜ åˆ°aä¸Šï¼š\n\nprintln(a) // a = 8\n\nè¿™ä¸å€¼æ‹·è´è¯­ä¹‰ä¼¼ä¹æœ‰æ‚–ã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645997675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328971,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1640963983,"is_pvip":false,"replies":[{"id":"120433","content":"1. æ²¡æœ‰å•¥ç‰¹æ®Šå«ä¹‰ã€‚æˆ‘ä»¬è‡ªå·±å†™ä»£ç ï¼Œä¸è¦ç”¨ä»¥ä¸‹åˆ’çº¿ä¸ºå‰ç¼€çš„å‘½åæ–¹å¼ã€‚<br>2. æŒ‡é’ˆåŠ é¤åç»­åº”è¯¥ä¼šåŠ ä¸Šã€‚","user_name":"ä½œè€…å›å¤","comment_id":328971,"uid":"1026224","ip_address":"","utype":1,"ctime":1641997626,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10230898575","product_id":100093501,"comment_content":"å¤§ç™½è€å¸ˆçš„è¿™ä¸€èŠ‚å¹²è´§å¾ˆå¤šï¼Œè¯»çš„æ„çŠ¹æœªå°½ã€‚æœ‰å‡ ä¸ªç–‘æƒ‘ç‚¹ï¼Œéº»çƒ¦è€å¸ˆè§£å¿§ã€‚<br><br>1. æ–‡ä¸­ç±»ä¼¼ï¼šâ€œ_typeâ€ è¿™ç§å‘½åï¼Œå‰é¢åŠ ä¸‹åˆ’çº¿ï¼Œè¿™ç§æœ‰ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ<br><br>2. æ–‡ä¸­å…³äºæ‰“å°ä¸¤ç±»æ¥å£å†…éƒ¨è¯¦ç»†ä¿¡æ¯çš„ä»£ç ä¸­ï¼Œè¿ç”¨äº†å¤§é‡çš„ * è¿˜æœ‰ &amp; å†åŠ ä¸Š  unsafe.Pointer çš„ä½¿ç”¨ï¼Œçœ‹èµ·æ¥ä¼šéå¸¸å›°æƒ‘ï¼Œå¸Œæœ›è€å¸ˆåé¢èƒ½è®²ä¸€è®²Goçš„æŒ‡é’ˆå§ã€‚åˆšä»åŠ¨æ€è¯­è¨€è½¬è¿‡æ¥ï¼Œç¡®å®åº”è¯¥å¥½å¥½ç†è§£ä¸€ä¸‹ã€‚ä¸ç„¶åé¢å†™å‡ºæ¥çš„ä»£ç ä¸€å®šä¼šæœ‰å¾ˆå¤šæ½œåœ¨çš„é£é™©ã€‚","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545593,"discussion_content":"1. æ²¡æœ‰å•¥ç‰¹æ®Šå«ä¹‰ã€‚æˆ‘ä»¬è‡ªå·±å†™ä»£ç ï¼Œä¸è¦ç”¨ä»¥ä¸‹åˆ’çº¿ä¸ºå‰ç¼€çš„å‘½åæ–¹å¼ã€‚\n2. æŒ‡é’ˆåŠ é¤åç»­åº”è¯¥ä¼šåŠ ä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641997626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328616,"user_name":"witt","can_delete":false,"product_type":"c1","uid":1005864,"ip_address":"","ucode":"19C8BCA266130A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/28/88f9d7f7.jpg","comment_is_top":false,"comment_ctime":1640789677,"is_pvip":false,"replies":[{"id":"120423","content":"âœ…","user_name":"ä½œè€…å›å¤","comment_id":328616,"uid":"1026224","ip_address":"","utype":1,"ctime":1641996830,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"10230724269","product_id":100093501,"comment_content":"è¿”å› *MyError è€Œä¸æ˜¯ error","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545581,"discussion_content":"âœ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641996830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543149,"discussion_content":"åŒå­¦ï¼Œä½ è¿™å›ç­”æ„Ÿè§‰æ»¡åˆ†å‘€ã€‚å“ˆå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640963629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339739,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1214303,"ip_address":"","ucode":"0C9CA3DB8B3CF0","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/5f/6bf8b74a.jpg","comment_is_top":false,"comment_ctime":1648350084,"is_pvip":true,"replies":[{"id":"124188","content":"ğŸ’ª","user_name":"ä½œè€…å›å¤","comment_id":339739,"uid":"1026224","ip_address":"","utype":1,"ctime":1648424893,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5943317380","product_id":100093501,"comment_content":"è¿™ç¯‡æœ‰ç‚¹é«˜å¼ºåº¦å¯¹æŠ—å•Š","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558628,"discussion_content":"ğŸ’ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648424893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330785,"user_name":"æ–‡ç»","can_delete":false,"product_type":"c1","uid":1072346,"ip_address":"","ucode":"2C059BD2A4276B","user_header":"https://static001.geekbang.org/account/avatar/00/10/5c/da/0a8bc27b.jpg","comment_is_top":false,"comment_ctime":1642159575,"is_pvip":true,"replies":[{"id":"120907","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":330785,"uid":"1026224","ip_address":"","utype":1,"ctime":1642412105,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5937126871","product_id":100093501,"comment_content":"è™½ç„¶æ˜¯Goè¯­è¨€ç¬¬ä¸€è¯¾ï¼Œä½†è¿™ä¸€éƒ¨åˆ†è®²å¾—å¾ˆæ·±å…¥ï¼Œè€Œä¸”å¾ˆå‰å®³çš„ä¸€ç‚¹æ˜¯ï¼ŒæŠŠéš¾ä»¥ç†è§£çš„æŠ€æœ¯ç»†èŠ‚éšè—çš„åˆšåˆšå¥½ï¼Œè¿™ä¸€ç¯‡è¦å†çœ‹å‡ éã€‚ç™½è€å¸ˆçœŸæ˜¯è®²è¯¾çš„é«˜æ‰‹å•ŠğŸ‘ğŸ‘","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546744,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642412105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328467,"user_name":"bearlu","can_delete":false,"product_type":"c1","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1640746198,"is_pvip":true,"replies":[{"id":"120406","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":328467,"uid":"1026224","ip_address":"","utype":1,"ctime":1641995550,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5935713494","product_id":100093501,"comment_content":"è¿™æ¬¡è¯¾å¾ˆå¹²ã€‚éœ€è¦å†å­¦ä¸€é","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545556,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641995550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358678,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"ç¦å»º","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1664532180,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1664532180","product_id":100093501,"comment_content":"nil error ï¼= nilçš„ä»·å€¼æ˜¯å•¥ï¼Œdataä¸ºç©ºï¼Œitabæœ‰ç±»å‹ä¿¡æ¯çš„æ¥å£å˜é‡è¿™ç§ä¸œè¥¿æœ‰ä»€ä¹ˆå…·ä½“ä½¿ç”¨åœºæ™¯å—ï¼Ÿ å¦‚æœåªæ˜¯å› ä¸ºå®ç°çš„åŸå› ï¼Œæˆ‘è§‰å¾—å°±æ˜¯goåœ¨æŒ–å‘ï¼Œå…¸å‹çš„è¿èƒŒäº†ç›´è§‰å•Š","like_count":0},{"had_liked":false,"id":337682,"user_name":"ivhong","can_delete":false,"product_type":"c1","uid":2659871,"ip_address":"","ucode":"9947B228807AC9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ic8eLTo5rnqIMJicUfpkVBrOUJAW4fANicKIbHdC54O9SOdwSoeK6o8icibaUbh7ZUXAkGF9zwHqo0Q/132","comment_is_top":false,"comment_ctime":1646969577,"is_pvip":false,"replies":[{"id":"123520","content":"é—®é¢˜æŒºå¤šï¼Œæˆ‘ç²—ç•¥ç­”ä¸€ä¸‹ï¼š<br><br>é—®é¢˜ 1-3: è¿™å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ•…æ„å‘ˆç°å‡ºè¿™æ ·çš„æ•ˆæœã€‚<br>é—®é¢˜4: æ²¡çœ‹æ˜ç™½ã€‚<br>é—®é¢˜5: var p MyErrorè¿™ä¹ˆåˆå§‹åŒ–åï¼ŒMyErrorç±»å‹é‡Œé¢çš„errorä¸ºnilï¼Œå¯¼è‡´panic<br>é—®é¢˜6: å¯ä»¥ã€‚<br>é—®é¢˜7ï¼šæ˜¯çš„ã€‚ ","user_name":"ä½œè€…å›å¤","comment_id":337682,"uid":"1026224","ip_address":"","utype":1,"ctime":1647090268,"user_name_real":"ç¼–è¾‘"}],"discussion_count":4,"race_medal":0,"score":"1646969577","product_id":100093501,"comment_content":"è¿™ç¯‡æ–‡ç« çœ‹äº†å¥½å‡ éï¼Œä¸€ç›´åœ¨çº ç»“æ–‡ç« å¼€å¤´çš„é‚£ä¸ªä»£ç ç¤ºä¾‹çœ‹ä¸æ‡‚<br>func returnsError() error {    <br>    var p *MyError = nil    <br>    if bad() {<br>        p = &amp;ErrBad<br>    }<br>    return p<br>}<br>1ï¼‰é€šè¿‡returnsErrorå‡½æ•°æ˜¯ä¸æ˜¯å¯ä»¥ç¿»è¯‘æˆï¼šè¯¥å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå®ç°äº†errorå˜é‡ï¼Œè€Œè¿™ä¸ªå˜é‡å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„ä¸æ¸…æ¥šã€‚<br>2ï¼‰ä¸ºä»€ä¹ˆ ä½¿ç”¨ MyError æŒ‡é’ˆç±»å‹å®šä¹‰ p<br>3ï¼‰ä¸ºä»€ä¹ˆè¿”å›çš„æ˜¯ pï¼ˆä¸€ä¸ªæŒ‡å‘å®ç°äº†erroræ¥å£çš„æŒ‡é’ˆï¼Ÿï¼‰<br>4ï¼‰æ—¢ç„¶æ¥å£çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œé‚£ä¹ˆåªèƒ½ç¡®å®šä½¿ç”¨è¯¥è¿”å›å€¼çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å€¼ï¼Œå› ä¸ºå€¼å¹¶ä¸ç¡®å®šæ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å€¼æ—¶å¿…é¡»å…ˆæ–­è¨€æ‰èƒ½åˆç†çš„ä½¿ç”¨å…¶å€¼ï¼ˆä¸ªäººç†è§£ï¼‰ã€‚åœ¨mainå‡½æ•°ä¸­ç›´æ¥ä½¿ç”¨è¿”å›å€¼ == nil åˆ¤æ–­ï¼Œç»“æœæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¯ä»¥æ˜¯è¯´æ˜¯é€»è¾‘ä¸Šæ˜¯ä¸å…è®¸çš„ï¼ˆä¸ºä»€ä¹ˆgoçš„è®¾è®¡è€…ä¸åœ¨ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™æŠ¥é”™å‘¢ï¼Ÿè¿™ä¸ªåº”è¯¥å¯ä»¥åˆ¤æ–­çš„å§ï¼‰ã€‚<br>5ï¼‰äºæ˜¯æˆ‘æŠŠå‡½æ•°ä»£ç ç®€åŒ–æˆä¸‹é¢è¿™æ ·<br>func returnsError() error {<br>\tvar p MyError<br>\treturn p<br>}<br>ç„¶ååœ¨mainå‡½æ•°ä¸­ä½¿ç”¨<br>err := returnsError()<br>if err != nil {<br>\tfmt.Printf(&quot;error occur: %+v\\n&quot;, err)<br>\treturn<br>}<br>å‘ç° err åŒ…å«è¿è¡Œæ—¶é”™è¯¯ï¼š<br>error occur: %!v(PANIC=Error method: runtime error: invalid memory address or nil pointer dereference) æ— æ•ˆå†…å­˜åœ°å€æˆ–nilæŒ‡é’ˆå¼•ç”¨<br>æ˜¯ä¸æ˜¯å› ä¸ºå‡½æ•°è¿”å›çš„ç»“æœè¦æ±‚æ˜¯erroræŒ‡é’ˆç±»å‹çš„ï¼Œè€Œå‡½æ•°è¿”å›çš„æ˜¯ç©ºæŒ‡é’ˆï¼Œç©ºæŒ‡é’ˆä¸æ˜¯errorç±»å‹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æŠ¥ç€ä¸ªé”™å‘¢ï¼Ÿ<br>6ï¼‰æŠŠreturnsError å†æ¬¡ä¿®æ”¹<br>func returnsError() *MyError {<br>\tvar p *MyError<br>\treturn p<br>}<br>è¿™æ ·è¿™æ ·åœ¨mainå‡½æ•°ä¸­å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå¯ä»¥æŠŠmainå‡½æ•°ç¿»è¯‘æˆè¿™æ ·çš„äººç±»è¯­è¨€å¯¹ä¹ˆ? â€œé€šè¿‡returnsErrorè·å– MyErrorç±»å‹çš„æŒ‡é’ˆï¼Œå¦‚æœè¿™ä¸ªæŒ‡é’ˆä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™è¯´æ˜æœ‰é”™è¯¯è¿”å›â€<br><br>7ï¼‰è£…ç®±&#47;æ‹†ç®± æ˜¯ä¸æ˜¯å°±æ˜¯è§£å†³æ¥å£ç±»å‹å‚æ•°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œâ€œåŠ¨æ€â€ç±»å‹çš„é—®é¢˜ï¼Ÿ<br><br><br><br>","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555877,"discussion_content":"é—®é¢˜æŒºå¤šï¼Œæˆ‘ç²—ç•¥ç­”ä¸€ä¸‹ï¼š\n\né—®é¢˜ 1-3: è¿™å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ•…æ„å‘ˆç°å‡ºè¿™æ ·çš„æ•ˆæœã€‚\né—®é¢˜4: æ²¡çœ‹æ˜ç™½ã€‚\né—®é¢˜5: var p MyErrorè¿™ä¹ˆåˆå§‹åŒ–åï¼ŒMyErrorç±»å‹é‡Œé¢çš„errorä¸ºnilï¼Œå¯¼è‡´panic\né—®é¢˜6: å¯ä»¥ã€‚\né—®é¢˜7ï¼šæ˜¯çš„ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647090268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":2659871,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ic8eLTo5rnqIMJicUfpkVBrOUJAW4fANicKIbHdC54O9SOdwSoeK6o8icibaUbh7ZUXAkGF9zwHqo0Q/132","nickname":"ivhong","note":"","ucode":"9947B228807AC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":555984,"discussion_content":"éå¸¸æ„Ÿè°¢è€å¸ˆç™¾å¿™ä¹‹ä¸­çš„å›å¤ï¼Œæ·±æ·±\né èº¬ğŸ™‡\nç¬¬å››ä¸ªé—®é¢˜æˆ‘å¯èƒ½æ²¡è¡¨è¾¾æ¸…æ¥šï¼Œåœ¨å°è¯•è¡¨è¿°ä¸€ä¸‹ï¼š\nå‡½æ•°çš„è¿”å›å€¼ç±»å‹å®šä¹‰ä¸ºâ€œæ¥å£ç±»å‹â€ï¼Œé‚£ä¹ˆè°ƒç”¨å‡½æ•°åªèƒ½ç¡®å®šè¿”å›å€¼æ˜¯å®ç°äº†â€œæŸæ¥å£â€ï¼Œä»è€Œèƒ½ç¡®å®šè¿”å›å€¼å¯ä»¥ä½¿ç”¨å“ªäº›æ–¹æ³•ï¼Œè€Œä¸èƒ½ç›´æ¥è¿™ä¹ˆä½¿ç”¨(è¿”å›å€¼==nil)ï¼Œå› ä¸ºè¿”å›å€¼çš„å…·ä½“ç±»å‹ä¸å¯é¢„æ–™ï¼Œä¾‹å¦‚è¿”å›å€¼æ˜¯æŸç»“æ„ä½“ç±»å‹çš„è¯ï¼Œç»“æ„ä½“ç±»å‹çš„å˜é‡æ˜¯ä¸èƒ½å’Œnilä½œæ¯”è¾ƒçš„ã€‚å¦‚æœæƒ³ä½¿ç”¨è¿”å›å€¼æ‰€ä»£è¡¨â€œå€¼â€çš„å«ä¹‰ï¼Œå¿…é¡»å…ˆæ–­è¨€ï¼Œç¡®å®šå…·ä½“å€¼å¾—ç±»å‹ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚\nä¾‹å­ä¸­ç›´æ¥ä½¿ç”¨è¿”å›å€¼å’Œnilä½œæ¯”è¾ƒï¼Œæœ¬èº«å°±ä¸åˆç†ï¼\næˆ‘é—®å¾—é—®é¢˜æ˜¯ï¼šå¦‚æœæˆ‘ç†è§£çš„æ²¡é—®é¢˜çš„è¯ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥ç¡®å®šæ¥å£ç±»å‹è¿”å›å€¼ä¸èƒ½ç›´æ¥ä½¿ç”¨å®ƒçš„å€¼ï¼Œgoçš„è®¾è®¡è€…æ€ä¹ˆä¸è¿™ä¹ˆåšå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647157174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555877,"ip_address":""},"score":555984,"extra":""},{"author":{"id":1045910,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg","nickname":"Aeins","note":"","ucode":"D5BF220767541D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2659871,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ic8eLTo5rnqIMJicUfpkVBrOUJAW4fANicKIbHdC54O9SOdwSoeK6o8icibaUbh7ZUXAkGF9zwHqo0Q/132","nickname":"ivhong","note":"","ucode":"9947B228807AC9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574346,"discussion_content":"1. æ¥å£æ”¯æŒå’Œ nil åšæ¯”è¾ƒã€‚æ˜¯åˆç†çš„\n2. å¦‚æœéœ€è¦æ¥å£ä¸­çš„åŠ¨æ€å€¼ï¼Œç”¨ç±»å‹æ–­è¨€æˆ–è€… type-switchï¼ˆé”™è¯¯å¤„ç†é‚£ç« åº”è¯¥æœ‰ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653987616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555984,"ip_address":""},"score":574346,"extra":""},{"author":{"id":2029976,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f9/98/53740221.jpg","nickname":"é½å¤§æŸ±","note":"","ucode":"694BBCA988C1DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575045,"discussion_content":"è€å¸ˆæ‚¨å¥½ï¼Œæ‚¨é—®é¢˜5çš„è§£ç­”æˆ‘æœ‰äº›ç–‘æƒ‘ï¼šä¸ºä½•MyErrorç±»å‹é‡Œé¢çš„errorä¸ºnilï¼Œå°±ä¼šå¯¼è‡´panicå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654569323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555877,"ip_address":""},"score":575045,"extra":""}]}]},{"had_liked":false,"id":330322,"user_name":"ä¸è´Ÿé’æ˜¥ä¸è´Ÿå·±ğŸ¤˜","can_delete":false,"product_type":"c1","uid":1363671,"ip_address":"","ucode":"A6DD8E8B20EA6E","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","comment_is_top":false,"comment_ctime":1641910810,"is_pvip":true,"replies":[{"id":"121538","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":330322,"uid":"1026224","ip_address":"","utype":1,"ctime":1643442331,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1641910810","product_id":100093501,"comment_content":"markï¼Œå›å¤´åœ¨åå¤è¯»ï¼Œå¹²è´§å¤ªå¤šäº†","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548900,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643442331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329239,"user_name":"Bynow","can_delete":false,"product_type":"c1","uid":2735072,"ip_address":"","ucode":"1E4F3ADD65CF18","user_header":"https://static001.geekbang.org/account/avatar/00/29/bb/e0/c7cd5170.jpg","comment_is_top":false,"comment_ctime":1641233217,"is_pvip":false,"replies":[{"id":"120438","content":"âœ…","user_name":"ä½œè€…å›å¤","comment_id":329239,"uid":"1026224","ip_address":"","utype":1,"ctime":1641998818,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1641233217","product_id":100093501,"comment_content":"å°† returnsError è¿”å›ç­¾åæ›´æ”¹ä¸º *MyError ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545599,"discussion_content":"âœ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641998818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329071,"user_name":"æœ¨æœ¨","can_delete":false,"product_type":"c1","uid":2704565,"ip_address":"","ucode":"86820F26A27308","user_header":"https://static001.geekbang.org/account/avatar/00/29/44/b5/7eba5a0e.jpg","comment_is_top":false,"comment_ctime":1641094203,"is_pvip":false,"replies":[{"id":"120128","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":329071,"uid":"1026224","ip_address":"","utype":1,"ctime":1641540895,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1641094203","product_id":100093501,"comment_content":"è¿™èŠ‚å­¦åˆ°å¾ˆå¤šï¼","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544500,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641540896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}