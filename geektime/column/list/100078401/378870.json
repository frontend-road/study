{"id":378870,"title":"09 | ç§ä¸€ç§Linuxï¼šLinuxçš„è‡ªæ—‹é”å’Œä¿¡å·é‡å¦‚ä½•å®ç°ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è§£å†³æ•°æ®åŒæ­¥é—®é¢˜çš„æ€è·¯ä¸æ–¹æ³•ã€‚Linuxä½œä¸ºæˆç†Ÿçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå½“ç„¶ä¹Ÿæœ‰å¾ˆå¤šæ•°æ®åŒæ­¥çš„æœºåˆ¶ï¼Œå®ƒä¹Ÿæœ‰åŸå­å˜é‡ã€å¼€å¯å’Œå…³é—­ä¸­æ–­ã€è‡ªæ—‹é”ã€ä¿¡å·é‡ã€‚</p><p>é‚£ä»Šå¤©æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹è¿™äº›æœºåˆ¶åœ¨Linuxä¸­çš„å®ç°ã€‚çœ‹çœ‹Linuxçš„å®ç°å’Œå‰é¢æˆ‘ä»¬è‡ªå·±çš„å®ç°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠLinuxä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®ç°ï¼Œè¿™ä¹ˆå®ç°èƒŒåçš„æœºç†æ˜¯ä»€ä¹ˆã€‚</p><h2>Linuxçš„åŸå­å˜é‡</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹Linuxä¸‹çš„åŸå­å˜é‡çš„å®ç°ï¼Œåœ¨Linuxä¸­ï¼Œæœ‰è®¸å¤šå…±äº«çš„èµ„æºå¯èƒ½åªæ˜¯ä¸€ä¸ªç®€å•çš„æ•´å‹æ•°å€¼ã€‚</p><p>ä¾‹å¦‚åœ¨æ–‡ä»¶æè¿°ç¬¦ä¸­ï¼Œéœ€è¦åŒ…å«ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ã€‚è¿™ä¸ªè®¡æ•°å™¨è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªåº”ç”¨ç¨‹åºæ‰“å¼€äº†æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿçš„openå‡½æ•°ä¸­ï¼Œå°†è¿™ä¸ªè®¡æ•°å™¨å˜é‡åŠ 1ï¼›åœ¨closeå‡½æ•°ä¸­ï¼Œå°†è¿™ä¸ªè®¡æ•°å™¨å˜é‡å‡1ã€‚</p><p>å¦‚æœå•ä¸ªè¿›ç¨‹æ‰§è¡Œæ‰“å¼€å’Œå…³é—­æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªè®¡æ•°å™¨å˜é‡ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯Linuxæ˜¯æ”¯æŒå¤šè¿›ç¨‹çš„ç³»ç»Ÿï¼Œå¦‚æœæœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰“å¼€æˆ–è€…å…³é—­æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯èƒ½å¯¼è‡´è¿™ä¸ªè®¡æ•°å™¨å˜é‡å¤šåŠ æˆ–è€…å°‘åŠ ï¼Œå‡ºç°é”™è¯¯ã€‚</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒLinuxæä¾›äº†<strong>ä¸€ä¸ªåŸå­ç±»å‹å˜é‡atomic_t</strong>ã€‚è¯¥å˜é‡çš„å®šä¹‰å¦‚ä¸‹ã€‚</p><pre><code>typedef struct {\n    int counter;\n} atomic_t;//å¸¸ç”¨çš„32ä½çš„åŸå­å˜é‡ç±»å‹\n#ifdef CONFIG_64BIT\ntypedef struct {\n    s64 counter;\n} atomic64_t;//64ä½çš„åŸå­å˜é‡ç±»å‹\n#endif\n</code></pre><p>ä¸Šè¿°ä»£ç è‡ªç„¶ä¸èƒ½ç”¨æ™®é€šçš„ä»£ç å»è¯»å†™åŠ å‡ï¼Œè€Œæ˜¯è¦ç”¨Linuxä¸“é—¨æä¾›çš„æ¥å£å‡½æ•°å»æ“ä½œï¼Œå¦åˆ™å°±ä¸èƒ½ä¿è¯åŸå­æ€§äº†ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><!-- [[[read_end]]] --><pre><code>//åŸå­è¯»å–å˜é‡ä¸­çš„å€¼\nstatic __always_inline int arch_atomic_read(const atomic_t *v)\n{\n    return __READ_ONCE((v)-&gt;counter);\n}\n//åŸå­å†™å…¥ä¸€ä¸ªå…·ä½“çš„å€¼\nstatic __always_inline void arch_atomic_set(atomic_t *v, int i)\n{\n    __WRITE_ONCE(v-&gt;counter, i);\n}\n//åŸå­åŠ ä¸Šä¸€ä¸ªå…·ä½“çš„å€¼\nstatic __always_inline void arch_atomic_add(int i, atomic_t *v)\n{\n    asm volatile(LOCK_PREFIX &quot;addl %1,%0&quot;\n             : &quot;+m&quot; (v-&gt;counter)\n             : &quot;ir&quot; (i) : &quot;memory&quot;);\n}\n//åŸå­å‡å»ä¸€ä¸ªå…·ä½“çš„å€¼\nstatic __always_inline void arch_atomic_sub(int i, atomic_t *v)\n{\n    asm volatile(LOCK_PREFIX &quot;subl %1,%0&quot;\n             : &quot;+m&quot; (v-&gt;counter)\n             : &quot;ir&quot; (i) : &quot;memory&quot;);\n}\n//åŸå­åŠ 1\nstatic __always_inline void arch_atomic_inc(atomic_t *v)\n{\n    asm volatile(LOCK_PREFIX &quot;incl %0&quot;\n             : &quot;+m&quot; (v-&gt;counter) :: &quot;memory&quot;);\n}\n//åŸå­å‡1\nstatic __always_inline void arch_atomic_dec(atomic_t *v)\n{\n    asm volatile(LOCK_PREFIX &quot;decl %0&quot;\n             : &quot;+m&quot; (v-&gt;counter) :: &quot;memory&quot;);\n}\n</code></pre><p>LinuxåŸå­ç±»å‹å˜é‡çš„æ“ä½œå‡½æ•°æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘åªæ˜¯ä»‹ç»äº†æœ€åŸºç¡€çš„å‡ ä¸ªå‡½æ•°ï¼Œ<a href=\"https://elixir.bootlin.com/linux/v5.10.13/source/arch/x86/include/asm/atomic.h#L23\">å…¶å®ƒçš„åŸå­ç±»å‹å˜é‡æ“ä½œ</a>ä¹Ÿä¾èµ–äºä¸Šè¿°å‡ ä¸ªåŸºç¡€çš„å‡½æ•°ã€‚</p><p>ä½ ä¼šå‘ç°ï¼ŒLinuxçš„å®ç°ä¹ŸåŒæ ·é‡‡ç”¨äº†x86 CPUçš„åŸå­æŒ‡ä»¤ï¼ŒLOCK_PREFIXæ˜¯ä¸€ä¸ªå®ï¼Œæ ¹æ®éœ€è¦å±•å¼€æˆâ€œlock;â€æˆ–è€…ç©ºä¸²ã€‚<strong>å•æ ¸å¿ƒCPUæ˜¯ä¸éœ€è¦lockå‰ç¼€çš„ï¼Œåªè¦åœ¨å¤šæ ¸å¿ƒCPUä¸‹æ‰éœ€è¦åŠ ä¸Šlockå‰ç¼€ã€‚</strong></p><p>å‰©ä¸‹__READ_ONCEï¼Œ__WRITE_ONCEä¸¤ä¸ªå®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬åˆ†åˆ«åšäº†ä»€ä¹ˆï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>#define __READ_ONCE(x)\t\\\n(*(const volatile __unqual_scalar_typeof(x) *)&amp;(x))\n#define __WRITE_ONCE(x, val) \\\ndo {*(volatile typeof(x) *)&amp;(x) = (val);} while (0)\n//__unqual_scalar_typeofè¡¨ç¤ºå£°æ˜ä¸€ä¸ªéé™å®šçš„æ ‡é‡ç±»å‹ï¼Œéæ ‡é‡ç±»å‹ä¿æŒä¸å˜ã€‚è¯´äººè¯å°±æ˜¯è¿”å›xå˜é‡çš„ç±»å‹ï¼Œè¿™æ˜¯GCCçš„åŠŸèƒ½ï¼Œtypeofåªæ˜¯çº¯ç²¹è¿”å›xçš„ç±»å‹ã€‚\n//å¦‚æœ x æ˜¯intç±»å‹åˆ™è¿”å›â€œintâ€ \n#define __READ_ONCE(x)\t\\\n(*(const volatile int *)&amp;(x))\n#define __WRITE_ONCE(x, val) \\\ndo {*(volatile int *)&amp;(x) = (val);} while (0) \n</code></pre><p>ç»“åˆåˆšæ‰çš„ä»£ç ï¼Œæˆ‘ç»™ä½ åšä¸ªè§£è¯»ã€‚Linuxå®šä¹‰äº†__READ_ONCEï¼Œ__WRITE_ONCEè¿™ä¸¤ä¸ªå®ï¼Œæ˜¯å¯¹ä»£ç å°è£…å¹¶åˆ©ç”¨GCCçš„ç‰¹æ€§å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ï¼ŒæŠŠè®©é”™è¯¯æ˜¾ç°åœ¨ç¼–è¯‘é˜¶æ®µã€‚å…¶ä¸­çš„â€œvolatile int *â€æ˜¯ä¸ºäº†æé†’ç¼–è¯‘å™¨ï¼š<strong>è¿™æ˜¯å¯¹å†…å­˜åœ°å€è¯»å†™ï¼Œä¸è¦æœ‰ä¼˜åŒ–åŠ¨ä½œï¼Œæ¯æ¬¡éƒ½å¿…é¡»å¼ºåˆ¶å†™å…¥å†…å­˜æˆ–ä»å†…å­˜è¯»å–ã€‚</strong></p><h2>Linuxæ§åˆ¶ä¸­æ–­</h2><p>Linuxä¸­æœ‰å¾ˆå¤šåœºæ™¯ï¼Œéœ€è¦åœ¨å…³ä¸­æ–­ä¸‹æ‰å¯ä»¥å®‰å…¨æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><p>æ¯”å¦‚ï¼Œå¤šä¸ªä¸­æ–­å¤„ç†ç¨‹åºéœ€è¦è®¿é—®ä¸€äº›å…±äº«æ•°æ®ï¼Œä¸€ä¸ªä¸­æ–­ç¨‹åºåœ¨è®¿é—®æ•°æ®æ—¶å¿…é¡»ä¿è¯è‡ªèº«ï¼ˆä¸­æ–­åµŒå¥—ï¼‰å’Œå…¶å®ƒä¸­æ–­å¤„ç†ç¨‹åºäº’æ–¥ï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚å†æ¯”å¦‚ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºåœ¨è®¾ç½®è®¾å¤‡å¯„å­˜å™¨æ—¶ï¼Œä¹Ÿå¿…é¡»è®©CPUåœæ­¢å“åº”ä¸­æ–­ã€‚</p><p>Linuxæ§åˆ¶CPUå“åº”ä¸­æ–­çš„å‡½æ•°å¦‚ä¸‹ã€‚</p><pre><code>//å®é™…ä¿å­˜eflagså¯„å­˜å™¨\nextern __always_inline unsigned long native_save_fl(void){\n    unsigned long flags;\n    asm volatile(&quot;# __raw_save_flags\\n\\t&quot;\n                 &quot;pushf ; pop %0&quot;:&quot;=rm&quot;(flags)::&quot;memory&quot;);\n    return flags;\n}\n//å®é™…æ¢å¤eflagså¯„å­˜å™¨\nextern inline void native_restore_fl(unsigned long flags){\n    asm volatile(&quot;push %0 ; popf&quot;::&quot;g&quot;(flags):&quot;memory&quot;,&quot;cc&quot;);\n}\n//å®é™…å…³ä¸­æ–­\nstatic __always_inline void native_irq_disable(void){\n    asm volatile(&quot;cli&quot;:::&quot;memory&quot;);\n}\n//å®é™…å¼€å¯ä¸­æ–­\nstatic __always_inline void native_irq_enable(void){\n    asm volatile(&quot;sti&quot;:::&quot;memory&quot;);\n}\n//archå±‚å…³ä¸­æ–­\nstatic __always_inline void arch_local_irq_disable(void){\n    native_irq_disable();\n}\n//archå±‚å¼€å¯ä¸­æ–­\nstatic __always_inline void arch_local_irq_enable(void){ \n    native_irq_enable();\n}\n//archå±‚ä¿å­˜eflagså¯„å­˜å™¨\nstatic __always_inline unsigned long           arch_local_save_flags(void){\n    return native_save_fl();\n}\n//archå±‚æ¢å¤eflagså¯„å­˜å™¨\nstatic  __always_inline void arch_local_irq_restore(unsigned long flags){\n    native_restore_fl(flags);\n}\n//å®é™…ä¿å­˜eflagså¯„å­˜å™¨å¹¶å…³ä¸­æ–­\nstatic __always_inline unsigned long arch_local_irq_save(void){\n    unsigned long flags = arch_local_save_flags();\n    arch_local_irq_disable();\n    return flags;\n}\n//rawå±‚å…³é—­å¼€å¯ä¸­æ–­å®\n#define raw_local_irq_disable()     arch_local_irq_disable()\n#define raw_local_irq_enable()      arch_local_irq_enable()\n//rawå±‚ä¿å­˜æ¢å¤eflagså¯„å­˜å™¨å®\n#define raw_local_irq_save(flags)           \\\n    do {                        \\\n        typecheck(unsigned long, flags);    \\\n        flags = arch_local_irq_save();      \\\n    } while (0)\n    \n#define raw_local_irq_restore(flags)            \\\n    do {                        \\\n        typecheck(unsigned long, flags);    \\\n        arch_local_irq_restore(flags);      \\\n    } while (0)\n    \n#define raw_local_save_flags(flags)         \\\n    do {                        \\\n        typecheck(unsigned long, flags);    \\\n        flags = arch_local_save_flags();    \\\n    } while (0)\n//é€šç”¨å±‚æ¥å£å® \n#define local_irq_enable()              \\\n    do { \\\n        raw_local_irq_enable();         \\\n    } while (0)\n\n#define local_irq_disable()             \\\n    do {                        \\\n        raw_local_irq_disable();        \\\n    } while (0)\n\n#define local_irq_save(flags)               \\\n    do {                        \\\n        raw_local_irq_save(flags);      \\\n    } while (0)\n\n#define local_irq_restore(flags)            \\\n    do {                        \\\n        raw_local_irq_restore(flags);       \\\n    } while (0)\n</code></pre><p>å¯ä»¥å‘ç°ï¼ŒLinuxä¸­é€šè¿‡å®šä¹‰çš„æ–¹å¼å¯¹ä¸€äº›åº•å±‚å‡½æ•°è¿›è¡Œäº†ä¸€äº›åŒ…è£…ï¼Œä¸ºäº†è®©ä½ æŠ“ä½é‡ç‚¹ï¼Œå‰é¢è¿™äº›å®æˆ‘å»æ‰äº†å’Œä¸­æ–­æ§åˆ¶æ— å…³çš„é¢å¤–æ“ä½œï¼Œè¯¦ç»†ä¿¡æ¯ä½ å¯ä»¥å‚é˜…<a href=\"https://elixir.bootlin.com/linux/v5.10.13/source/include/linux/irqflags.h#L186\">ç›¸å…³ä»£ç </a>ã€‚</p><p>ç¼–è¯‘Linuxä»£ç æ—¶ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¯¹å®è¿›è¡Œå±•å¼€ã€‚å…¶ä¸­ï¼Œ<span class=\"orange\">do{}while(0)</span>æ˜¯Linuxä»£ç ä¸­ä¸€ç§å¸¸ç”¨çš„æŠ€å·§ï¼Œdo{}while(0)è¡¨è¾¾å¼ä¼šä¿è¯{}ä¸­çš„ä»£ç ç‰‡æ®µæ‰§è¡Œä¸€æ¬¡ï¼Œä¿è¯å®å±•å¼€æ—¶è¿™ä¸ªä»£ç ç‰‡æ®µæ˜¯ä¸€ä¸ªæ•´ä½“ã€‚</p><p>å¸¦native_å‰ç¼€ä¹‹ç±»çš„å‡½æ•°åˆ™è·Ÿæˆ‘ä»¬ä¹‹å‰å®ç°çš„hal_å‰ç¼€å¯¹åº”ï¼Œè€ŒLinuxä¸ºäº†æ”¯æŒä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œåšäº†å¤šå±‚å°è£…ã€‚</p><h2>Linuxè‡ªæ—‹é”</h2><p>Linuxä¹Ÿæ˜¯æ”¯æŒå¤šæ ¸å¿ƒCPUçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå› æ­¤Linuxä¹Ÿéœ€è¦è‡ªæ—‹é”æ¥å¯¹ç³»ç»Ÿä¸­çš„å…±äº«èµ„æºè¿›è¡Œä¿æŠ¤ã€‚åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰è·å–äº†é”çš„è¿›ç¨‹æ‰èƒ½ä½¿ç”¨å…±äº«èµ„æºã€‚</p><p>æ ¹æ®ä¸ŠèŠ‚è¯¾å¯¹è‡ªæ—‹é”ç®—æ³•çš„ç†è§£ï¼Œè‡ªæ—‹é”ä¸ä¼šå¼•èµ·åŠ é”è¿›ç¨‹ç¡çœ ï¼Œå¦‚æœè‡ªæ—‹é”å·²ç»è¢«åˆ«çš„è¿›ç¨‹æŒæœ‰ï¼ŒåŠ é”è¿›ç¨‹å°±éœ€è¦ä¸€ç›´å¾ªç¯åœ¨é‚£é‡Œï¼ŒæŸ¥çœ‹æ˜¯å¦è¯¥è‡ªæ—‹é”çš„æŒæœ‰è€…å·²ç»é‡Šæ”¾äº†é”ï¼Œ\"è‡ªæ—‹\"ä¸€è¯å°±æ˜¯å› æ­¤è€Œå¾—åã€‚</p><p>Linuxæœ‰å¤šç§è‡ªæ—‹é”ï¼Œæˆ‘ä»¬è¿™é‡Œåªä»‹ç»ä¸¤ç§ï¼Œ<strong>åŸå§‹è‡ªæ—‹é”å’Œæ’é˜Ÿè‡ªæ—‹é”</strong>ï¼Œå®ƒä»¬åº•å±‚åŸç†å’Œæˆ‘ä»¬ä¹‹å‰å®ç°çš„æ²¡ä»€ä¹ˆä¸åŒï¼Œä½†å¤šäº†ä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·å»çœ‹çœ‹ã€‚</p><h3>LinuxåŸå§‹è‡ªæ—‹é”</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹LinuxåŸå§‹çš„è‡ªæ—‹é”ï¼ŒLinuxçš„åŸå§‹è‡ªæ—‹é”æœ¬è´¨ä¸Šç”¨ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºï¼Œå€¼ä¸º1ä»£è¡¨é”æœªè¢«å ç”¨ï¼Œä¸º0æˆ–è€…è´Ÿæ•°åˆ™è¡¨ç¤ºè¢«å ç”¨ã€‚</p><p>ä½ å¯ä»¥ç»“åˆä¸ŠèŠ‚è¯¾çš„è¿™å¼ å›¾ï¼Œç†è§£åé¢çš„å†…å®¹ã€‚å½“æŸä¸ªCPUæ ¸å¿ƒæ‰§è¡Œè¿›ç¨‹è¯·æ±‚åŠ é”æ—¶ï¼Œå¦‚æœé”æ˜¯æœªåŠ é”çŠ¶æ€ï¼Œåˆ™åŠ é”ï¼Œç„¶åæ“ä½œå…±äº«èµ„æºï¼Œæœ€åé‡Šæ”¾é”ï¼›å¦‚æœé”å·²è¢«åŠ é”ï¼Œåˆ™è¿›ç¨‹å¹¶ä¸ä¼šè½¬å…¥ç¡çœ çŠ¶æ€ï¼Œè€Œæ˜¯å¾ªç¯ç­‰å¾…è¯¥é”ï¼Œä¸€æ—¦é”è¢«é‡Šæ”¾ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ„ŸçŸ¥æ­¤ä¿¡æ¯çš„è¿›ç¨‹å°†è·å¾—é”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/24/a2968832f3f1055cc7ba68628a25d924.jpg?wh=2195*2405\" alt=\"\" title=\"è‡ªæ—‹é”åŸç†ç¤ºæ„å›¾\"></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹LinuxåŸå§‹è‡ªæ—‹é”çš„æ•°æ®ç»“æ„ï¼Œä¸ºæ–¹ä¾¿ä½ é˜…è¯»ï¼Œæˆ‘åˆ é™¤äº†ç”¨äºè°ƒè¯•çš„æ•°æ®å­—æ®µï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code>//æœ€åº•å±‚çš„è‡ªæ—‹é”æ•°æ®ç»“æ„\ntypedef struct{\nvolatile unsigned long lock;//çœŸæ­£çš„é”å€¼å˜é‡ï¼Œç”¨volatileæ ‡è¯†\n}spinlock_t;\n</code></pre><p>LinuxåŸå§‹è‡ªæ—‹é”æ•°æ®ç»“æ„å°è£…äº†ä¸€ä¸ªunsigned longç±»å‹çš„å˜é‡ã€‚æœ‰äº†æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æ“ä½œè¿™ä¸ªæ•°æ®ç»“æ„çš„å‡½æ•°ï¼Œå³è‡ªæ—‹é”æ¥å£ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code>#define spin_unlock_string \\\t\n    &quot;movb $1,%0&quot; \\ //å†™å…¥1è¡¨ç¤ºè§£é”\n    :&quot;=m&quot; (lock-&gt;lock) : : &quot;memory&quot;\n\n#define spin_lock_string \\\n\t&quot;\\n1:\\t&quot; \\\t\n    &quot;lock ; decb %0\\n\\t&quot; \\ //åŸå­å‡1\n\t&quot;js 2f\\n&quot; \\\t  //å½“ç»“æœå°äº0åˆ™è·³è½¬åˆ°æ ‡å·2å¤„ï¼Œè¡¨ç¤ºåŠ é”å¤±è´¥\n    &quot;.section .text.lock,\\&quot;ax\\&quot;\\n&quot; \\ //é‡æ–°å®šä¹‰ä¸€ä¸ªä»£ç æ®µï¼Œè¿™æ˜¯ä¼˜åŒ–æŠ€æœ¯ï¼Œé¿å…åé¢çš„ä»£ç å¡«å……cacheï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¼šåŠ é”æˆåŠŸï¼Œé“¾æ¥å™¨ä¼šå¤„ç†å¥½è¿™ä¸ªä»£ç æ®µçš„\n\t&quot;2:\\t&quot; \\\t\n    &quot;cmpb $0,%0\\n\\t&quot; \\\t//å’Œ0æ¯”è¾ƒ\n    &quot;rep;nop\\n\\t&quot; \\\t//ç©ºæŒ‡ä»¤\n    &quot;jle 2b\\n\\t&quot; \\\t //å°äºæˆ–ç­‰äº0è·³è½¬åˆ°æ ‡å·2\n    &quot;jmp 1b\\n&quot; \\   //è·³è½¬åˆ°æ ‡å·1\t\n    &quot;.previous&quot;\n//è·å–è‡ªæ—‹é”\nstatic inline void spin_lock(spinlock_t*lock){\n    __asm__ __volatile__(\n    spin_lock_string\n    :&quot;=m&quot;(lock-&gt;lock)::&quot;memory&quot;\n    );\n}\n//é‡Šæ”¾è‡ªæ—‹é”\nstatic inline void spin_unlock(spinlock_t*lock){\n__asm__ __volatile__(\n    spin_unlock_string\n    );\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ç”¨spin_lock_stringã€spin_unlock_stringä¸¤ä¸ªå®ï¼Œå®šä¹‰äº†è·å–ã€é‡Šæ”¾è‡ªæ—‹é”çš„æ±‡ç¼–æŒ‡ä»¤ã€‚spin_unlock_stringåªæ˜¯ç®€å•å°†é”å€¼å˜é‡è®¾ç½®æˆ1ï¼Œè¡¨ç¤ºé‡Šæ”¾è‡ªæ—‹é”ï¼Œspin_lock_stringä¸­å¹¶æ²¡æœ‰åƒæˆ‘ä»¬Cosmosä¸€æ ·ä½¿ç”¨xchgæŒ‡ä»¤ï¼Œè€Œæ˜¯ä½¿ç”¨äº†decbæŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤ä¹Ÿèƒ½åŸå­åœ°æ‰§è¡Œå‡1æ“ä½œã€‚</p><p>å¼€å§‹é”å€¼å˜é‡ä¸º1æ—¶ï¼Œæ‰§è¡ŒdecbæŒ‡ä»¤å°±å˜æˆäº†0ï¼Œ0å°±è¡¨ç¤ºåŠ é”æˆåŠŸã€‚å¦‚æœå°äº0ï¼Œåˆ™è¡¨ç¤ºæœ‰å…¶å®ƒè¿›ç¨‹å·²ç»åŠ é”äº†ï¼Œå°±ä¼šå¯¼è‡´å¾ªç¯æ¯”è¾ƒã€‚</p><h3>Linuxæ’é˜Ÿè‡ªæ—‹é”</h3><p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹çœ‹100ä¸ªè¿›ç¨‹è·å–åŒä¸€ä¸ªè‡ªæ—‹é”çš„æƒ…å†µï¼Œå¼€å§‹1ä¸ªè¿›ç¨‹è·å–äº†è‡ªæ—‹é”Lï¼Œåé¢ç»§ç»­æ¥äº†99ä¸ªè¿›ç¨‹ï¼Œå®ƒä»¬éƒ½è¦è·å–è‡ªæ—‹é”Lï¼Œä½†æ˜¯å®ƒä»¬å¿…é¡»ç­‰å¾…ï¼Œè¿™æ—¶ç¬¬1è¿›ç¨‹é‡Šæ”¾äº†è‡ªæ—‹é”Lã€‚è¯·é—®ï¼Œè¿™99ä¸ªè¿›ç¨‹ä¸­è°èƒ½å…ˆè·å–è‡ªæ—‹é”Lå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸ç¡®å®šï¼Œå› ä¸ºè¿™ä¸ªæ¬¡åºä¾èµ–äºå“ªä¸ªCPUæ ¸å¿ƒèƒ½æœ€å…ˆè®¿é—®å†…å­˜ï¼Œè€Œå“ªä¸ªCPUæ ¸å¿ƒå¯ä»¥è®¿é—®å†…å­˜æ˜¯ç”±<strong>æ€»çº¿ä»²è£åè®®</strong>å†³å®šçš„ã€‚</p><p>å¾ˆæœ‰å¯èƒ½æœ€åæ¥çš„è¿›ç¨‹æœ€å…ˆè·å–è‡ªæ—‹é”Lï¼Œè¿™å¯¹å…¶å®ƒç­‰å¾…çš„è¿›ç¨‹æå…¶ä¸å…¬å¹³ï¼Œä¸ºäº†è§£å†³è·å–è‡ªæ—‹é”çš„<strong>å…¬å¹³æ€§</strong>ï¼ŒLinuxå¼€å‘å‡ºäº†æ’é˜Ÿè‡ªæ—‹é”ã€‚</p><p>ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œæƒ³è¦ç»™è¿›ç¨‹æ’å¥½é˜Ÿï¼Œå°±éœ€è¦ç¡®å®šé¡ºåºï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ç”³è¯·è·å–é”çš„å…ˆåæ¬¡åºï¼ŒLinuxçš„æ’é˜Ÿè‡ªæ—‹é”é€šè¿‡ä¿å­˜è¿™ä¸ªä¿¡æ¯ï¼Œå°±èƒ½æ›´å…¬å¹³åœ°è°ƒåº¦è¿›ç¨‹äº†ã€‚</p><p>ä¸ºäº†ä¿å­˜é¡ºåºä¿¡æ¯ï¼Œæ’é˜Ÿè‡ªæ—‹é”é‡æ–°å®šä¹‰äº†æ•°æ®ç»“æ„ã€‚</p><pre><code>//RAWå±‚çš„è‡ªæ—‹é”æ•°æ®ç»“æ„\ntypedef struct raw_spinlock{\n    unsigned int slock;//çœŸæ­£çš„é”å€¼å˜é‡\n}raw_spinlock_t;\n//æœ€ä¸Šå±‚çš„è‡ªæ—‹é”æ•°æ®ç»“æ„\ntypedef struct spinlock{\n    struct raw_spinlock rlock;\n}spinlock_t;\n//Linuxæ²¡æœ‰è¿™æ ·çš„ç»“æ„ï¼Œè¿™åªæ˜¯ä¸ºäº†æè¿°æ–¹ä¾¿\ntypedef struct raw_spinlock{\n    union {\n        unsigned int slock;//çœŸæ­£çš„é”å€¼å˜é‡\n        struct {\n        u16 owner;\n        u16 next;\n        }\n    }\n}raw_spinlock_t;\n</code></pre><p>slockåŸŸè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¿å­˜<strong>é”æŒæœ‰è€…</strong>å’Œ<strong>æœªæ¥é”ç”³è¯·è€…</strong>çš„åºå·ï¼Œå¦‚ä¸Šè¿°ä»£ç 10ï½16è¡Œæ‰€ç¤ºã€‚</p><p>åªæœ‰nextåŸŸä¸owneråŸŸç›¸ç­‰æ—¶ï¼Œæ‰è¡¨ç¤ºè‡ªæ—‹é”å¤„äºæœªä½¿ç”¨çš„çŠ¶æ€ï¼ˆæ­¤æ—¶ä¹Ÿæ²¡æœ‰è¿›ç¨‹ç”³è¯·è¯¥é”ï¼‰ã€‚åœ¨æ’é˜Ÿè‡ªæ—‹é”åˆå§‹åŒ–æ—¶ï¼Œslockè¢«ç½®ä¸º0ï¼Œå³nextå’Œownerè¢«ç½®ä¸º0ï¼ŒLinuxè¿›ç¨‹æ‰§è¡Œç”³è¯·è‡ªæ—‹é”æ—¶ï¼ŒåŸå­åœ°å°†nextåŸŸåŠ 1ï¼Œå¹¶å°†åŸå€¼è¿”å›ä½œä¸ºè‡ªå·±çš„åºå·ã€‚</p><p>å¦‚æœè¿”å›çš„åºå·ç­‰äºç”³è¯·æ—¶çš„ownerå€¼ï¼Œè¯´æ˜è‡ªæ—‹é”å¤„äºæœªä½¿ç”¨çš„çŠ¶æ€ï¼Œåˆ™è¿›ç¨‹ç›´æ¥è·å¾—é”ï¼›å¦åˆ™ï¼Œè¯¥è¿›ç¨‹å¾ªç¯æ£€æŸ¥owneråŸŸæ˜¯å¦ç­‰äºè‡ªå·±æŒæœ‰çš„åºå·ï¼Œä¸€æ—¦ç›¸ç­‰ï¼Œåˆ™è¡¨æ˜é”è½®åˆ°è‡ªå·±è·å–ã€‚</p><p>è¿›ç¨‹é‡Šæ”¾è‡ªæ—‹é”æ—¶ï¼ŒåŸå­åœ°å°†owneråŸŸåŠ 1å³å¯ï¼Œä¸‹ä¸€ä¸ªè¿›ç¨‹å°†ä¼šå‘ç°è¿™ä¸€å˜åŒ–ï¼Œä»å¾ªç¯çŠ¶æ€ä¸­é€€å‡ºã€‚è¿›ç¨‹å°†ä¸¥æ ¼åœ°æŒ‰ç…§ç”³è¯·é¡ºåºä¾æ¬¡è·å–æ’é˜Ÿè‡ªæ—‹é”ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŸå…ˆè¿›ç¨‹æ— åºç«äº‰çš„ä¹±è±¡å°±è¿åˆƒè€Œè§£äº†ã€‚</p><pre><code>static inline void __raw_spin_lock(raw_spinlock_t*lock){\nint inc = 0x00010000;\nint tmp;\n__asm__ __volatile__(\n&quot;lock ; xaddl %0, %1\\n&quot; //å°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock\n                        //ç›¸å½“äºåŸå­è¯»å–nextå’Œownerå¹¶å¯¹next+1\n&quot;movzwl %w0, %2\\n\\t&quot;//å°†incçš„ä½16ä½åš0æ‰©å±•åé€tmp tmp=(u16)inc\n&quot;shrl $16, %0\\n\\t&quot; //å°†incå³ç§»16ä½ inc=inc&gt;&gt;16\n&quot;1:\\t&quot;\n&quot;cmpl %0, %2\\n\\t&quot; //æ¯”è¾ƒincå’Œtmpï¼Œå³æ¯”è¾ƒnextå’Œowner \n&quot;je 2f\\n\\t&quot; //ç›¸ç­‰åˆ™è·³è½¬åˆ°æ ‡å·2å¤„è¿”å›\n&quot;rep ; nop\\n\\t&quot; //ç©ºæŒ‡ä»¤\n&quot;movzwl %1, %2\\n\\t&quot; //å°†slockçš„ä½16ä½åš0æ‰©å±•åé€tmp å³tmp=owner\n&quot;jmp 1b\\n&quot; //è·³è½¬åˆ°æ ‡å·1å¤„ç»§ç»­æ¯”è¾ƒ\n&quot;2:&quot;\n:&quot;+Q&quot;(inc),&quot;+m&quot;(lock-&gt;slock),&quot;=r&quot;(tmp)\n::&quot;memory&quot;,&quot;cc&quot;\n);\n}\n#define UNLOCK_LOCK_PREFIX LOCK_PREFIX\nstatic inline void __raw_spin_unlock(raw_spinlock_t*lock){\n__asm__ __volatile__(\nUNLOCK_LOCK_PREFIX&quot;incw %0&quot;//å°†slockçš„ä½16ä½åŠ 1 å³owner+1\n:&quot;+m&quot;(lock-&gt;slock)\n::&quot;memory&quot;,&quot;cc&quot;);\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­çš„æ³¨é‡Šå·²ç»æè¿°å¾—å¾ˆæ¸…æ¥šäº†ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½æœ‰æ³¨è§£ï¼Œä¾›ä½ å‚è€ƒã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯Linuxä¸ºäº†é¿å…å·®å¼‚æ€§ï¼Œåœ¨spinlock_tç»“æ„ä½“ä¸­åŒ…å«äº†raw_spinlock_tï¼Œè€Œåœ¨raw_spinlock_tç»“æ„ä½“ä¸­å¹¶æ²¡ä½¿ç”¨nextå’Œownerå­—æ®µï¼Œè€Œæ˜¯åœ¨ä»£ç ä¸­ç›´æ¥æ“ä½œslockçš„é«˜16ä½å’Œä½16ä½æ¥å®ç°çš„ã€‚</p><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Ÿå½“ä½ å»é“¶è¡ŒåŠäº‹ï¼Œåˆå‘ç°äººå¾ˆå¤šæ—¶ï¼Œä½ å¾ˆå¯èƒ½ä¼šé€‰æ‹©å…ˆå»å¤„ç†ä¸€äº›åˆ«çš„äº‹æƒ…ï¼Œç­‰è¿‡ä¸€ä¼šäººæ¯”è¾ƒå°‘äº†ï¼Œå†æ¥åŠç†æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡ã€‚</p><p>å…¶å®ï¼Œåœ¨ä½¿ç”¨è‡ªæ—‹é”æ—¶ä¹Ÿæœ‰åŒæ ·çš„æƒ…å†µï¼Œå½“ä¸€ä¸ªè¿›ç¨‹å‘ç°å¦ä¸€ä¸ªè¿›ç¨‹å·²ç»æ‹¥æœ‰è‡ªå·±æ‰€è¯·æ±‚çš„è‡ªæ—‹é”æ—¶ï¼Œå°±è‡ªæ„¿æ”¾å¼ƒï¼Œè½¬è€Œåšå…¶å®ƒåˆ«çš„å·¥ä½œï¼Œå¹¶ä¸æƒ³åœ¨è¿™é‡Œå¾ªç¯ç­‰å¾…ï¼Œæµªè´¹è‡ªå·±çš„æ—¶é—´ã€‚</p><p>å¯¹äºè¿™ç§æƒ…å†µï¼ŒLinuxåŒæ ·æä¾›äº†ç›¸åº”çš„è‡ªæ—‹é”æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>static inline int __raw_spin_trylock(raw_spinlock_t*lock){\n    int tmp;\n    int new;\n    asm volatile(\n    &quot;movl %2,%0\\n\\t&quot;//tmp=slock\n    &quot;movl %0,%1\\n\\t&quot;//new=tmp\n    &quot;roll $16, %0\\n\\t&quot;//tmpå¾ªç¯å·¦ç§»16ä½ï¼Œå³nextå’Œowneräº¤æ¢äº†\n    &quot;cmpl %0,%1\\n\\t&quot;//æ¯”è¾ƒtmpå’Œnewå³ï¼ˆownerã€nextï¼‰ï¼Ÿ=ï¼ˆnextã€ownerï¼‰\n    &quot;jne 1f\\n\\t&quot; //ä¸ç­‰åˆ™è·³è½¬åˆ°æ ‡å·1å¤„ \n    &quot;addl $0x00010000, %1\\n\\t&quot;//ç›¸å½“äºnext+1\n    &quot;lock ; cmpxchgl %1,%2\\n\\t&quot;//newå’Œslockäº¤æ¢æ¯”è¾ƒ    \n    &quot;1:&quot;\n    &quot;sete %b1\\n\\t&quot; //new = eflags.ZFä½ï¼ŒZFå–å†³äºå‰é¢çš„åˆ¤æ–­æ˜¯å¦ç›¸ç­‰\n    &quot;movzbl %b1,%0\\n\\t&quot; //tmp = new\n    :&quot;=&amp;a&quot;(tmp),&quot;=Q&quot;(new),&quot;+m&quot;(lock-&gt;slock)\n    ::&quot;memory&quot;,&quot;cc&quot;);\n    return tmp;\n}\nint __lockfunc _spin_trylock(spinlock_t*lock){ \n    preempt_disable();\n    if(_raw_spin_trylock(lock)){\n        spin_acquire(&amp;lock-&gt;dep_map,0,1,_RET_IP_);\n        return 1;\n    }\n    preempt_enable();\n    return 0;\n}\n#define spin_trylock(lock) __cond_lock(lock, _spin_trylock(lock))\n</code></pre><p>_cond_lockåªç”¨ä»£ç é™æ€æ£€æŸ¥å·¥ä½œï¼Œä¸€å®šè¦æ˜ç™½_spin_trylockè¿”å›1è¡¨ç¤ºå°è¯•åŠ é”æˆåŠŸï¼Œå¯ä»¥å®‰å…¨çš„åœ°é—®å…±äº«èµ„æºäº†ï¼›è¿”å›å€¼ä¸º0åˆ™è¡¨ç¤ºå°è¯•åŠ é”å¤±è´¥ï¼Œä¸èƒ½æ“ä½œå…±äº«èµ„æºï¼Œåº”è¯¥ç­‰ä¸€æ®µæ—¶é—´ï¼Œå†æ¬¡å°è¯•åŠ é”ã€‚</p><h2>Linuxä¿¡å·é‡</h2><p>Linuxä¸­çš„ä¿¡å·é‡åŒæ ·æ˜¯ç”¨æ¥ä¿æŠ¤å…±äº«èµ„æºï¼Œèƒ½ä¿è¯èµ„æºåœ¨ä¸€ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œè¿™æ˜¯å•å€¼ä¿¡å·é‡ã€‚ä¹Ÿå¯ä»¥ä½œä¸ºèµ„æºè®¡æ•°å™¨ï¼Œæ¯”å¦‚ä¸€ç§èµ„æºæœ‰äº”ä»½ï¼ŒåŒæ—¶æœ€å¤šå¯ä»¥æœ‰äº”ä¸ªè¿›ç¨‹ï¼Œè¿™æ˜¯å¤šå€¼ä¿¡å·é‡ã€‚</p><p>å•å€¼ä¿¡å·é‡ï¼Œç±»æ¯”äºç§äººç©ºé—´ä¸€æ¬¡åªè¿›å»ä¸€ä¸ªäººï¼Œå…¶ä¿¡å·é‡çš„å€¼åˆå§‹å€¼ä¸º1ï¼Œè€Œå¤šå€¼ä¿¡å·é‡ï¼Œç›¸å½“äºæ˜¯å®¢å…ï¼Œå¯åŒæ—¶å®¹çº³å¤šä¸ªäººã€‚å…¶ä¿¡å·é‡çš„å€¼åˆå§‹å€¼ä¸º5ï¼Œå°±å¯å®¹çº³5ä¸ªäººã€‚</p><p>ä¿¡å·é‡çš„å€¼ä¸ºæ­£çš„æ—¶å€™ã€‚æ‰€ç”³è¯·çš„è¿›ç¨‹å¯ä»¥é”å®šä½¿ç”¨å®ƒã€‚è‹¥ä¸º0ï¼Œè¯´æ˜å®ƒè¢«å…¶å®ƒè¿›ç¨‹å ç”¨ï¼Œç”³è¯·çš„è¿›ç¨‹è¦è¿›å…¥ç¡çœ é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚æ‰€ä»¥ä¿¡å·é‡æœ€å¤§çš„ä¼˜åŠ¿æ˜¯æ—¢<strong>å¯ä»¥ä½¿ç”³è¯·å¤±è´¥çš„è¿›ç¨‹ç¡çœ ï¼Œè¿˜å¯ä»¥ä½œä¸ºèµ„æºè®¡æ•°å™¨ä½¿ç”¨ã€‚</strong></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Linuxå®ç°ä¿¡å·é‡æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>struct semaphore{\n    raw_spinlock_t lock;//ä¿æŠ¤ä¿¡å·é‡è‡ªèº«çš„è‡ªæ—‹é”\n    unsigned int count;//ä¿¡å·é‡å€¼\n    struct list_head wait_list;//æŒ‚è½½ç¡çœ ç­‰å¾…è¿›ç¨‹çš„é“¾è¡¨\n};\n</code></pre><p>ä¸‹é¢æˆ‘ä»¬å°±è·Ÿç€Linuxä¿¡å·é‡æ¥å£å‡½æ•°ï¼Œä¸€æ­¥æ­¥æ¢ç´¢Linuxä¿¡å·é‡å·¥ä½œåŸç†ï¼Œå’Œå®ƒå¯¹è¿›ç¨‹çŠ¶æ€çš„å½±å“ï¼Œå…ˆæ¥çœ‹çœ‹Linuxä¿¡å·é‡çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>#define down_console_sem() do { \\\n    down(&amp;console_sem);\\\n} while (0)\nstatic void __up_console_sem(unsigned long ip) {\n    up(&amp;console_sem);\n}\n#define up_console_sem() __up_console_sem(_RET_IP_)\n//åŠ é”console\nvoid console_lock(void)\n{\n    might_sleep();\n    down_console_sem();//è·å–ä¿¡å·é‡console_sem\n    if (console_suspended)\n        return;\n    console_locked = 1;\n    console_may_schedule = 1;\n}\n//è§£é”console\nvoid console_unlock(void)\n{\n    static char ext_text[CONSOLE_EXT_LOG_MAX];\n    static char text[LOG_LINE_MAX + PREFIX_MAX];\n    //â€¦â€¦åˆ é™¤äº†å¾ˆå¤šä»£ç \n    up_console_sem();//é‡Šæ”¾ä¿¡å·é‡console_sem\n    raw_spin_lock(&amp;logbuf_lock);\n    //â€¦â€¦åˆ é™¤äº†å¾ˆå¤šä»£ç    \n}\n</code></pre><p>ä¸ºäº†ç®€å•è¯´æ˜é—®é¢˜ï¼Œæˆ‘åˆ é™¤äº†å¾ˆå¤šä»£ç ï¼Œä¸Šé¢ä»£ç ä¸­ä»¥consoleé©±åŠ¨ä¸ºä¾‹è¯´æ˜äº†ä¿¡å·é‡çš„ä½¿ç”¨ã€‚</p><p>åœ¨Linuxæºä»£ç çš„kernel/printk.cä¸­ï¼Œä½¿ç”¨å®DEFINE_SEMAPHOREå£°æ˜äº†ä¸€ä¸ªå•å€¼ä¿¡å·é‡console_semï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯<strong>äº’æ–¥é”</strong>ï¼Œå®ƒç”¨äºä¿æŠ¤consoleé©±åŠ¨åˆ—è¡¨console_driversä»¥åŠåŒæ­¥å¯¹æ•´ä¸ªconsoleé©±åŠ¨çš„è®¿é—®ã€‚</p><p>å…¶ä¸­å®šä¹‰äº†å®down_console_sem()æ¥è·å¾—ä¿¡å·é‡console_semï¼Œå®šä¹‰äº†å®up_console_sem()æ¥é‡Šæ”¾ä¿¡å·é‡console_semï¼Œconsole_lockå’Œconsole_unlockå‡½æ•°æ˜¯ç”¨äºäº’æ–¥è®¿é—®consoleé©±åŠ¨çš„ï¼Œæ ¸å¿ƒæ“ä½œå°±æ˜¯è°ƒç”¨å‰é¢å®šä¹‰ä¸¤ä¸ªå®ã€‚</p><p>ä¸Šé¢çš„æƒ…æ™¯ä¸­ï¼Œdown_console_sem()å’Œup_console_sem()å®çš„æ ¸å¿ƒä¸»è¦æ˜¯è°ƒç”¨äº†ä¿¡å·é‡çš„æ¥å£å‡½æ•°downã€upå‡½æ•°ï¼Œå®Œæˆè·å–ã€é‡Šæ”¾ä¿¡å·é‡çš„æ ¸å¿ƒæ“ä½œï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code>static inline int __sched __down_common(struct semaphore *sem, long state,long timeout)\n{\n    struct semaphore_waiter waiter;\n    //æŠŠwaiteråŠ å…¥sem-&gt;wait_listçš„å¤´éƒ¨\n    list_add_tail(&amp;waiter.list, &amp;sem-&gt;wait_list);\n    waiter.task = current;//currentè¡¨ç¤ºå½“å‰è¿›ç¨‹ï¼Œå³è°ƒç”¨è¯¥å‡½æ•°çš„è¿›ç¨‹\n    waiter.up = false;\n    for (;;) {\n        if (signal_pending_state(state, current))\n            goto interrupted;\n        if (unlikely(timeout &lt;= 0))\n            goto timed_out;\n        __set_current_state(state);//è®¾ç½®å½“å‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œè¿›ç¨‹ç¡çœ ï¼Œå³å…ˆå‰__downå‡½æ•°ä¸­ä¼ å…¥çš„TASK_UNINTERRUPTIBLEï¼šè¯¥çŠ¶æ€æ˜¯ç­‰å¾…èµ„æºæœ‰æ•ˆæ—¶å”¤é†’ï¼ˆæ¯”å¦‚ç­‰å¾…é”®ç›˜è¾“å…¥ã€socketè¿æ¥ã€ä¿¡å·ï¼ˆsignalï¼‰ç­‰ç­‰ï¼‰ï¼Œä½†ä¸å¯ä»¥è¢«ä¸­æ–­å”¤é†’\n        raw_spin_unlock_irq(&amp;sem-&gt;lock);//é‡Šæ”¾åœ¨downå‡½æ•°ä¸­åŠ çš„é”\n        timeout = schedule_timeout(timeout);//çœŸæ­£è¿›å…¥ç¡çœ \n        raw_spin_lock_irq(&amp;sem-&gt;lock);//è¿›ç¨‹ä¸‹æ¬¡è¿è¡Œä¼šå›åˆ°è¿™é‡Œï¼Œæ‰€ä»¥è¦åŠ é”\n        if (waiter.up)\n            return 0;\n    }\n timed_out:\n    list_del(&amp;waiter.list);\n    return -ETIME;\n interrupted:\n    list_del(&amp;waiter.list);\n    return -EINTR;\n\n    //ä¸ºäº†ç®€å•èµ·è§å¤„ç†è¿›ç¨‹ä¿¡å·ï¼ˆsignalï¼‰å’Œè¶…æ—¶çš„é€»è¾‘ä»£ç æˆ‘å·²ç»åˆ é™¤\n}\n//è¿›å…¥ç¡çœ ç­‰å¾…\nstatic noinline void __sched __down(struct semaphore *sem)\n{\n    __down_common(sem, TASK_UNINTERRUPTIBLE, MAX_SCHEDULE_TIMEOUT);\n}\n//è·å–ä¿¡å·é‡\nvoid down(struct semaphore *sem)\n{\n    unsigned long flags;\n    //å¯¹ä¿¡å·é‡æœ¬èº«åŠ é”å¹¶å…³ä¸­æ–­ï¼Œä¹Ÿè®¸å¦ä¸€æ®µä»£ç ä¹Ÿåœ¨æ“ä½œè¯¥ä¿¡å·é‡\n    raw_spin_lock_irqsave(&amp;sem-&gt;lock, flags);\n    if (likely(sem-&gt;count &gt; 0))\n        sem-&gt;count--;//å¦‚æœä¿¡å·é‡å€¼å¤§äº0,åˆ™å¯¹å…¶å‡1\n    else\n        __down(sem);//å¦åˆ™è®©å½“å‰è¿›ç¨‹è¿›å…¥ç¡çœ \n    raw_spin_unlock_irqrestore(&amp;sem-&gt;lock, flags);\n}\n//å®é™…å”¤é†’è¿›ç¨‹ \nstatic noinline void __sched __up(struct semaphore *sem)\n{\n    struct semaphore_waiter *waiter = list_first_entry(&amp;sem-&gt;wait_list, struct semaphore_waiter, list);\n    //è·å–ä¿¡å·é‡ç­‰å¾…é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®ç»“æ„semaphore_waiterï¼Œå®ƒé‡Œé¢ä¿å­˜ç€ç¡çœ è¿›ç¨‹çš„æŒ‡é’ˆ\n    list_del(&amp;waiter-&gt;list);\n    waiter-&gt;up = true;\n    wake_up_process(waiter-&gt;task);//å”¤é†’è¿›ç¨‹é‡æ–°åŠ å…¥è°ƒåº¦é˜Ÿåˆ—\n}\n//é‡Šæ”¾ä¿¡å·é‡\nvoid up(struct semaphore *sem)\n{\n    unsigned long flags;\n    //å¯¹ä¿¡å·é‡æœ¬èº«åŠ é”å¹¶å…³ä¸­æ–­ï¼Œå¿…é¡»å¦ä¸€æ®µä»£ç ä¹Ÿåœ¨æ“ä½œè¯¥ä¿¡å·é‡\n    raw_spin_lock_irqsave(&amp;sem-&gt;lock, flags);\n    if (likely(list_empty(&amp;sem-&gt;wait_list)))\n        sem-&gt;count++;//å¦‚æœä¿¡å·é‡ç­‰å¾…é“¾è¡¨ä¸­ä¸ºç©ºï¼Œåˆ™å¯¹ä¿¡å·é‡å€¼åŠ 1\n    else\n        __up(sem);//å¦åˆ™æ‰§è¡Œå”¤é†’è¿›ç¨‹ç›¸å…³çš„æ“ä½œ\n    raw_spin_unlock_irqrestore(&amp;sem-&gt;lock, flags);\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­çš„é€»è¾‘ï¼Œå·²ç»æè¿°äº†ä¿¡å·é‡çš„å·¥ä½œåŸç†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªè¿›ç¨‹è¿›å…¥äº†__downå‡½æ•°ä¸­ï¼Œè®¾ç½®äº†ä¸€ä¸ªä¸å¯ä¸­æ–­çš„ç­‰å¾…çŠ¶æ€ï¼Œç„¶åæ‰§è¡Œäº†schedule_timeoutå‡½æ•°ã€‚è¿™ä¸ªæ‰§è¡Œäº†è¿›ç¨‹çš„è°ƒåº¦å™¨ï¼Œå°±ç›´æ¥è°ƒåº¦åˆ°åˆ«çš„è¿›ç¨‹è¿è¡Œäº†ã€‚</p><p>è¿™æ—¶ï¼Œè¿™ä¸ªè¿›ç¨‹å°±ä¸ä¼šè¿”å›äº†ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å®ƒè¢«upå‡½æ•°å”¤é†’ã€‚æ‰§è¡Œäº†wake_up_processå‡½æ•°ä»¥åï¼Œé‡æ–°è°ƒåº¦å®ƒå°±ä¼šå›åˆ°schedule_timeoutå‡½æ•°ä¸‹ä¸€è¡Œä»£ç ï¼Œæ²¿ç€è°ƒç”¨è·¯ç»è¿”å›ï¼Œæœ€åä»__downå‡½æ•°ä¸­å‡ºæ¥ï¼Œå³è¿›ç¨‹ç¡é†’äº†ã€‚</p><h2>Linuxè¯»å†™é”</h2><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæœ‰å¾ˆå¤šå…±äº«æ•°æ®ï¼Œè¿›ç¨‹å¯¹è¿™äº›å…±äº«æ•°æ®è¦è¿›è¡Œä¿®æ”¹çš„æƒ…å†µå¾ˆå°‘ï¼Œè€Œè¯»å–çš„æƒ…å†µå´æ˜¯éå¸¸å¤šçš„ï¼Œè¿™äº›å…±äº«æ•°æ®çš„æ“ä½œåŸºæœ¬éƒ½æ˜¯åœ¨è¯»å–ã€‚</p><p>å¦‚æœæ¯æ¬¡è¯»å–è¿™äº›å…±äº«æ•°æ®éƒ½åŠ é”çš„è¯ï¼Œé‚£å°±å¤ªæµªè´¹æ—¶é—´äº†ï¼Œä¼šé™ä½è¿›ç¨‹çš„è¿è¡Œæ•ˆç‡ã€‚å› ä¸ºè¯»æ“ä½œä¸ä¼šå¯¼è‡´ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ä¸ç”¨åŠ é”äº†ï¼Œè€Œæ˜¯å¯ä»¥å…±äº«çš„è®¿é—®ï¼Œåªæœ‰æ¶‰åŠåˆ°å¯¹å…±äº«æ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œæ‰éœ€è¦åŠ é”äº’æ–¥è®¿é—®ã€‚</p><p>æƒ³åƒä¸€ä¸‹100ä¸ªè¿›ç¨‹åŒæ—¶è¯»å–ä¸€ä¸ªå…±äº«æ•°æ®ï¼Œè€Œæ¯ä¸ªè¿›ç¨‹éƒ½è¦åŠ é”è§£é”ï¼Œå‰©ä¸‹çš„è¿›ç¨‹åªèƒ½ç­‰å¾…ï¼Œè¿™ä¼šå¤§å¤§é™ä½æ•´ä¸ªç³»ç»Ÿæ€§èƒ½ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ä¸€ç§æ–°çš„é”äº†â€”â€”è¯»å†™é”ã€‚</p><p>è¯»å†™é”ä¹Ÿç§°ä¸ºå…±äº«-ç‹¬å ï¼ˆshared-exclusiveï¼‰é”ï¼Œå½“è¯»å†™é”ç”¨è¯»å–æ¨¡å¼åŠ é”æ—¶ï¼Œå®ƒæ˜¯ä»¥å…±äº«æ¨¡å¼ä¸Šé”çš„ï¼Œå½“ä»¥å†™å…¥ä¿®æ”¹æ¨¡å¼åŠ é”æ—¶ï¼Œå®ƒæ˜¯ä»¥ç‹¬å æ¨¡å¼ä¸Šé”çš„ï¼ˆäº’æ–¥ï¼‰ã€‚</p><p>è¯»å†™é”éå¸¸é€‚åˆ<strong>è¯»å–æ•°æ®çš„é¢‘ç‡è¿œå¤§äºä¿®æ”¹æ•°æ®çš„é¢‘ç‡</strong>çš„åœºæ™¯ä¸­ã€‚è¿™æ ·å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¿è¯å¤šä¸ªè¿›ç¨‹çš„è¯»å–æ“ä½œå¹¶å‘åœ°æ‰§è¡Œï¼Œç»™ç³»ç»Ÿå¸¦æ¥äº†æ›´é«˜çš„å¹¶å‘åº¦ã€‚</p><p>é‚£è¯»å†™é”æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿè¯»å†™ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œè¯»å–çš„æ—¶å€™ä¸èƒ½å†™å…¥ï¼Œå†™å…¥çš„æ—¶å€™ä¸èƒ½è¯»å–ï¼Œè€Œä¸”è¯»å–å’Œå†™å…¥æ“ä½œåœ¨ç«äº‰é”çš„æ—¶å€™ï¼Œå†™ä¼šä¼˜å…ˆå¾—åˆ°é”ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚</p><p>1.å½“å…±äº«æ•°æ®æ²¡æœ‰é”çš„æ—¶å€™ï¼Œè¯»å–çš„åŠ é”æ“ä½œå’Œå†™å…¥çš„åŠ é”æ“ä½œéƒ½å¯ä»¥æ»¡è¶³ã€‚<br>\n2.å½“å…±äº«æ•°æ®æœ‰è¯»é”çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„è¯»å–åŠ é”æ“ä½œéƒ½å¯ä»¥æ»¡è¶³ï¼Œå†™å…¥çš„åŠ é”æ“ä½œä¸èƒ½æ»¡è¶³ï¼Œè¯»å†™æ˜¯äº’æ–¥çš„ã€‚<br>\n3.å½“å…±äº«æ•°æ®æœ‰å†™é”çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„è¯»å–çš„åŠ é”æ“ä½œéƒ½ä¸èƒ½æ»¡è¶³ï¼Œæ‰€æœ‰çš„å†™å…¥çš„åŠ é”æ“ä½œä¹Ÿä¸èƒ½æ»¡è¶³ï¼Œè¯»ä¸å†™ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œå†™ä¸å†™ä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„ã€‚</p><p>å¦‚æœä½ æ„Ÿè§‰åˆšæ‰è¯´çš„æ­¥éª¤è¿˜æ˜¯å¤ªå¤æ‚ï¼Œé‚£æˆ‘å†ç»™ä½ ç”»ä¸€ä¸ªè¡¨ï¼Œä½ å°±æ¸…æ¥šäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/70/08/70c2d2580e8ec4b138db2f2807ba9f08.jpg?wh=1625*848\" alt=\"\"></p><p>å¥½äº†ï¼Œæˆ‘ä»¬æ˜ç™½äº†è¯»å†™é”çš„åŠ é”è§„åˆ™ï¼Œç°åœ¨å°±å»çœ‹çœ‹Linuxä¸­çš„è¯»å†™é”çš„å®ç°ï¼Œ<strong>Linuxä¸­çš„è¯»å†™é”æœ¬è´¨ä¸Šæ˜¯è‡ªæ—‹é”çš„å˜ç§ã€‚</strong></p><p>åé¢è¿™æ®µä»£ç æ˜¯Linuxä¸­è¯»å†™é”çš„æ ¸å¿ƒä»£ç ï¼Œè¯·ä½ æ³¨æ„ï¼Œ<strong>å®é™…æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ˜¯ç›´æ¥ä½¿ç”¨ä¸Šé¢çš„å‡½æ•°å’Œæ•°æ®ç»“æ„ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨Linuxæä¾›çš„æ ‡å‡†æ¥å£ï¼Œå¦‚read_lockã€write_lockç­‰ã€‚</strong></p><pre><code>//è¯»å†™é”åˆå§‹åŒ–é”å€¼\n#define RW_LOCK_BIAS\t\t 0x01000000\n//è¯»å†™é”çš„åº•å±‚æ•°æ®ç»“æ„\ntypedef struct{\n    unsigned int lock;\n}arch_rwlock_t;\n//é‡Šæ”¾è¯»é” \nstatic inline void arch_read_unlock(arch_rwlock_t*rw){ \n    asm volatile(\n        LOCK_PREFIX&quot;incl %0&quot; //åŸå­å¯¹lockåŠ 1\n        :&quot;+m&quot;(rw-&gt;lock)::&quot;memory&quot;);\n}\n//é‡Šæ”¾å†™é”\nstatic inline void arch_write_unlock(arch_rwlock_t*rw){\n    asm volatile(\n        LOCK_PREFIX&quot;addl %1, %0&quot;//åŸå­å¯¹lockåŠ ä¸ŠRW_LOCK_BIAS\n        :&quot;+m&quot;(rw-&gt;lock):&quot;i&quot;(RW_LOCK_BIAS):&quot;memory&quot;);\n}\n//è·å–å†™é”å¤±è´¥æ—¶è°ƒç”¨\nENTRY(__write_lock_failed)\n    //(%eax)è¡¨ç¤ºç”±eaxæŒ‡å‘çš„å†…å­˜ç©ºé—´æ˜¯è°ƒç”¨è€…ä¼ è¿›æ¥çš„ \n    2:LOCK_PREFIX addl\t$ RW_LOCK_BIAS,(%eax)\n    1:rep;nop//ç©ºæŒ‡ä»¤\n    cmpl $RW_LOCK_BIAS,(%eax)\n    //ä¸ç­‰äºåˆå§‹å€¼åˆ™å¾ªç¯æ¯”è¾ƒï¼Œç›¸ç­‰åˆ™è¡¨ç¤ºæœ‰è¿›ç¨‹é‡Šæ”¾äº†å†™é”\n    jne\t 1b\n    //æ‰§è¡ŒåŠ å†™é”\n    LOCK_PREFIX subl\t$ RW_LOCK_BIAS,(%eax)\n    jnz 2b //ä¸ä¸º0åˆ™ç»§ç»­æµ‹è¯•ï¼Œä¸º0åˆ™è¡¨ç¤ºåŠ å†™é”æˆåŠŸ\n    ret //è¿”å›\nENDPROC(__write_lock_failed)\n//è·å–è¯»é”å¤±è´¥æ—¶è°ƒç”¨\nENTRY(__read_lock_failed)\n    //(%eax)è¡¨ç¤ºç”±eaxæŒ‡å‘çš„å†…å­˜ç©ºé—´æ˜¯è°ƒç”¨è€…ä¼ è¿›æ¥çš„ \n    2:LOCK_PREFIX incl(%eax)//åŸå­åŠ 1\n    1:\trep; nop//ç©ºæŒ‡ä»¤\n    cmpl\t$1,(%eax) //å’Œ1æ¯”è¾ƒ å°äº0åˆ™\n    js 1b //ä¸ºè´Ÿåˆ™ç»§ç»­å¾ªç¯æ¯”è¾ƒ\n    LOCK_PREFIX decl(%eax) //åŠ è¯»é”\n    js\t2b\t//ä¸ºè´Ÿåˆ™ç»§ç»­åŠ 1å¹¶æ¯”è¾ƒï¼Œå¦åˆ™è¿”å›\n    ret //è¿”å›\nENDPROC(__read_lock_failed)\n//è·å–è¯»é”\nstatic inline void arch_read_lock(arch_rwlock_t*rw){\n    asm volatile(\n        LOCK_PREFIX&quot; subl $1,(%0)\\n\\t&quot;//åŸå­å¯¹lockå‡1\n        &quot;jns 1f\\n&quot;//ä¸ä¸ºå°äº0åˆ™è·³è½¬æ ‡å·1å¤„ï¼Œè¡¨ç¤ºè·å–è¯»é”æˆåŠŸ\n        &quot;call __read_lock_failed\\n\\t&quot;//è°ƒç”¨__read_lock_failed\n        &quot;1:\\n&quot;\n        ::LOCK_PTR_REG(rw):&quot;memory&quot;);\n}\n//è·å–å†™é”\nstatic inline void arch_write_lock(arch_rwlock_t*rw){\n    asm volatile(\n        LOCK_PREFIX&quot;subl %1,(%0)\\n\\t&quot;//åŸå­å¯¹lockå‡å»RW_LOCK_BIAS\n        &quot;jz 1f\\n&quot;//ä¸º0åˆ™è·³è½¬æ ‡å·1å¤„\n        &quot;call __write_lock_failed\\n\\t&quot;//è°ƒç”¨__write_lock_failed\n        &quot;1:\\n&quot;\n        ::LOCK_PTR_REG(rw),&quot;i&quot;(RW_LOCK_BIAS):&quot;memory&quot;);\n}\n</code></pre><p>Linuxè¯»å†™é”çš„åŸç†æœ¬è´¨æ˜¯åŸºäºè®¡æ•°å™¨ï¼Œåˆå§‹å€¼ä¸º0x01000000ï¼Œè·å–è¯»é”æ—¶å¯¹å…¶å‡1ï¼Œç»“æœä¸å°äº0åˆ™è¡¨ç¤ºè·å–è¯»é”æˆåŠŸï¼Œè·å–å†™é”æ—¶ç›´æ¥å‡å»0x01000000ã€‚</p><p>è¯´åˆ°è¿™é‡Œä½ å¯èƒ½è¦é—®äº†ï¼Œä¸ºä½•è¦å‡å»åˆå§‹å€¼å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåªæœ‰å½“é”å€¼ä¸ºåˆå§‹å€¼æ—¶ï¼Œå‡å»åˆå§‹å€¼ç»“æœæ‰å¯ä»¥æ˜¯0ï¼Œè¿™æ˜¯å”¯ä¸€æ²¡æœ‰è¿›ç¨‹æŒæœ‰ä»»ä½•é”çš„æƒ…å†µï¼Œè¿™æ ·æ‰èƒ½ä¿è¯è·å–å†™é”æ—¶æ˜¯äº’æ–¥çš„ã€‚</p><p>__read_lock_failedã€__write_lock_failedæ˜¯ä¸¤ä¸ªæ±‡ç¼–å‡½æ•°ï¼Œæ³¨é‡Šå†™å¾—å¾ˆè¯¦ç»†äº†ï¼Œå’Œå‰é¢è‡ªæ—‹é”çš„å¥—è·¯æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¯»å†™é”å…¶å®æ˜¯å¸¦è®¡æ•°çš„ç‰¹æ®Šè‡ªæ—‹é”ï¼Œèƒ½åŒæ—¶è¢«å¤šä¸ªè¯»å–æ•°æ®çš„è¿›ç¨‹å æœ‰æˆ–ä¸€ä¸ªä¿®æ”¹æ•°æ®çš„è¿›ç¨‹å æœ‰ï¼Œä½†ä¸èƒ½åŒæ—¶è¢«è¯»å–æ•°æ®çš„è¿›ç¨‹å’Œä¿®æ”¹æ•°æ®çš„è¿›ç¨‹å æœ‰ã€‚</p><p>æˆ‘ä»¬å†æ¬¡æ¢³ç†ä¸€ä¸‹è·å–ã€é‡Šæ”¾è¯»å†™é”çš„æµç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>1.è·å–è¯»é”æ—¶ï¼Œé”å€¼å˜é‡lockè®¡æ•°å‡å»1ï¼Œåˆ¤æ–­ç»“æœçš„ç¬¦å·ä½æ˜¯å¦ä¸º1ã€‚è‹¥ç»“æœç¬¦å·ä½ä¸º0æ—¶ï¼Œè·å–è¯»é”æˆåŠŸï¼Œå³è¡¨ç¤ºlockå¤§äº0ã€‚<br>\n2.è·å–è¯»é”æ—¶ï¼Œé”å€¼å˜é‡lockè®¡æ•°å‡å»1ï¼Œåˆ¤æ–­ç»“æœçš„ç¬¦å·ä½æ˜¯å¦ä¸º1ã€‚è‹¥ç»“æœç¬¦å·ä½ä¸º1æ—¶ï¼Œè·å–è¯»é”å¤±è´¥ï¼Œè¡¨ç¤ºæ­¤æ—¶è¯»å†™é”è¢«ä¿®æ”¹æ•°æ®çš„è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è°ƒç”¨__read_lock_failedå¤±è´¥å¤„ç†å‡½æ•°ï¼Œå¾ªç¯æµ‹è¯•lock+1çš„å€¼ï¼Œç›´åˆ°ç»“æœçš„å€¼å¤§äºç­‰äº1ã€‚<br>\n3.è·å–å†™é”æ—¶ï¼Œé”å€¼å˜é‡lockè®¡æ•°å‡å»RW_LOCK_BIAS_STRï¼Œå³lock-0x01000000ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0ã€‚è‹¥ç»“æœä¸º0æ—¶ï¼Œè¡¨ç¤ºè·å–å†™é”æˆåŠŸã€‚<br>\n4.è·å–å†™é”æ—¶ï¼Œé”å€¼å˜é‡lockè®¡æ•°å‡å»RW_LOCK_BIAS_STRï¼Œå³lock-0x01000000ï¼Œåˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0ã€‚è‹¥ç»“æœä¸ä¸º0æ—¶ï¼Œè·å–å†™é”å¤±è´¥ï¼Œè¡¨ç¤ºæ­¤æ—¶æœ‰è¯»å–æ•°æ®çš„è¿›ç¨‹å æœ‰è¯»é”æˆ–æœ‰ä¿®æ”¹æ•°æ®çš„è¿›ç¨‹å æœ‰å†™é”ï¼Œæ­¤æ—¶è°ƒç”¨__write_lock_failedå¤±è´¥å¤„ç†å‡½æ•°ï¼Œå¾ªç¯æµ‹è¯•lock+0x01000000ï¼Œç›´åˆ°ç»“æœçš„å€¼ç­‰äº0x01000000ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾çš„å†…å®¹è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†Linuxä¸Šå®ç°æ•°æ®åŒæ­¥çš„äº”å¤§åˆ©å™¨ï¼Œåˆ†åˆ«æ˜¯LinuxåŸå­å˜é‡ã€Linuxä¸­æ–­æ§åˆ¶ã€Linuxè‡ªæ—‹é”ã€Linuxä¿¡å·é‡ã€Linuxè¯»å†™é”ã€‚æˆ‘æŠŠé‡ç‚¹ç»™ä½ æ¢³ç†ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7f/a9/7fd3abc144bb40331ca2aeb05ab5b7a9.jpg?wh=3145*2137\" alt=\"\"></p><p>é”ï¼Œä¿è¯äº†æ•°æ®çš„å®‰å…¨è®¿é—®ï¼Œä½†æ˜¯å®ƒç»™ç¨‹åºçš„å¹¶è¡Œæ€§èƒ½é€ æˆäº†å·¨å¤§æŸå®³ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ä¸€ä¸ªç®—æ³•æ—¶åº”å°½é‡é¿å…ä½¿ç”¨é”ã€‚è‹¥æ— æ³•é¿å…ï¼Œåˆ™åº”æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨ç›¸åº”ç±»å‹çš„é”ï¼Œä»¥é™ä½é”çš„ä¸å½“ä½¿ç”¨å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·è¯•ç€å›ç­”ï¼šä¸Šè¿°Linuxçš„è¯»å†™é”ï¼Œæ”¯æŒå¤šå°‘ä¸ªè¿›ç¨‹å¹¶å‘è¯»å–å…±äº«æ•°æ®ï¼Ÿè¿™æ ·çš„è¯»å†™é”æœ‰ä»€ä¹ˆä¸è¶³ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµï¼Œç›¸ä¿¡é€šè¿‡ç§¯æå‚ä¸ï¼Œä½ å°†æ›´å¥½åœ°ç†è§£è¿™èŠ‚è¯¾çš„å†…å®¹ã€‚</p><p>æˆ‘æ˜¯ LMOSï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","comments":[{"had_liked":false,"id":295045,"user_name":"è€ç”·å­©","can_delete":false,"product_type":"c1","uid":1134514,"ip_address":"","ucode":"CEC6D47412F620","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/b2/1e8b5616.jpg","comment_is_top":true,"comment_ctime":1622193582,"is_pvip":false,"replies":[{"id":"107295","content":"å—¯å—¯è§è§£ç‹¬åˆ°","user_name":"ä½œè€…å›å¤","comment_id":295045,"uid":"1345199","ip_address":"","utype":1,"ctime":1622472904,"user_name_real":"LMOS"}],"discussion_count":4,"race_medal":0,"score":"9.2233721759159009e+18","product_id":100078401,"comment_content":"è¿™ä¸ªæ’é˜Ÿè‡ªæ—‹é”çš„å®ç°æ–¹å¼æ„Ÿè§‰å¾ˆé£éªšå•Šã€‚å…³äºè¯»é”æœ€å¤§æ”¯æŒè¿›ç¨‹æ•°æ˜¯0x01000000ï¼ˆå­¦å‹ä»¬éƒ½å·²ç»è§£ç­”äº†ï¼‰å…³äºå†™é¥¥é¥¿çš„é—®é¢˜ï¼Œæ—¢ç„¶å†™é”å’Œè¯»é”åœ¨åŒæ—¶è·å–é”çŠ¶æ€æ—¶å€™å†™é”ä¼˜å…ˆï¼Œé‚£ä¹ˆå°±åº”è¯¥å¯¹è¯»é”åšä¸€ä¸ªé™åˆ¶ï¼Œä¸èƒ½è®©è¯»é”æœç€æœ€å¤§æ•°å¥”å»ã€‚æ¯”å¦‚ï¼Œç³»ç»Ÿæ£€æµ‹åˆ°æœ‰å†™é”åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå°±é™åˆ¶æ–°çš„è¯»é”åŠ å…¥ï¼Œç­‰å·²ç»å­˜åœ¨çš„è¯»é”éƒ½é‡Šæ”¾äº†ï¼Œå†™é”é©¬ä¸ŠåŠ é”æ›´æ–°èµ„æºã€‚ç„¶åç­‰å¾…çš„è¯»é”å†å¼€å§‹åŠ é”è¯»å–ã€‚è¿™ä¸ªç­‰å¾…çš„é˜Ÿåˆ—è¦åˆ†ä¸ºè¯»é”é˜Ÿåˆ—å’Œå†™é”é˜Ÿåˆ—ã€‚ä¼˜å…ˆå¤„ç†å†™é”é˜Ÿåˆ—ï¼Œåœ¨æ²¡æœ‰å†™é”çš„æ—¶å€™æ‰èƒ½ç»§ç»­åŠ è¯»é”ï¼Œå¦‚æœæœ‰å†™é”ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°çš„è¯»é”ä¸ç®¡è¶…æ²¡è¶…å‡ºé‚£ä¸ªæœ€å¤§æ•°ï¼Œéƒ½è¦è¿›å…¥è¯»é”é˜Ÿåˆ—ç­‰å¾…å†™é”å®Œæˆåå†å¼€å§‹è‡ªå·±çš„è¡¨æ¼”ã€‚","like_count":33,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520925,"discussion_content":"å—¯å—¯è§è§£ç‹¬åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1364645,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/a5/7acbd63a.jpg","nickname":"eddy","note":"","ucode":"E71EE2FAD96000","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582488,"discussion_content":"æˆ‘æ€ä¹ˆå°±æ²¡ç†è§£è¿™ä¸ªä¼˜å…ˆä¹ˆï¼Ÿ\næ˜æ˜æ˜¯å†™é”ä¼˜å…ˆï¼Œè¿˜é™åˆ¶è¯»é”ï¼Œè¿™éš¾é“æ˜¯è¦è¯»é”è¢«é¥¿æ­»åè¿˜é­å°¸ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659452252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129610,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg","nickname":"test","note":"","ucode":"C57A175CBC6547","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568381,"discussion_content":"é™åˆ¶è¯»ï¼Œé‚£ç­‰å†™å®Œäº†ï¼Œæ•°æ®ä¸æ˜¯å˜äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651121976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134694,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/66/047ee060.jpg","nickname":"Return12321","note":"","ucode":"F7A3C5ED02E1D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413377,"discussion_content":"çš„ç¡®ï¼ŒåŠ å…¥é˜Ÿåˆ—å’Œä¼˜å…ˆçº§å°±å¯è§£å†³é”é¥¥é¥¿çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636460228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295378,"user_name":"springXu","can_delete":false,"product_type":"c1","uid":2064750,"ip_address":"","ucode":"F5DB0B963C894F","user_header":"","comment_is_top":true,"comment_ctime":1622387215,"is_pvip":true,"replies":[{"id":"107267","content":"ä½ å¥½ï¼Œé“å­æ€»ç»“ åˆ°ä½","user_name":"ä½œè€…å›å¤","comment_id":295378,"uid":"1345199","ip_address":"","utype":1,"ctime":1622469798,"user_name_real":"LMOS"}],"discussion_count":3,"race_medal":0,"score":"9.2233721114916004e+18","product_id":100078401,"comment_content":"åŒæ­¥ä¸é”<br>æ“ä½œç³»ç»Ÿæ˜¯è®©åº”ç”¨ç¨‹åºè®¤ä¸ºå½“å‰æœ‰è¶…å¤§çš„å†…å­˜ç©ºé—´å’Œå¼ºå¤§çš„cpuæ¥å·¥ä½œçš„ç¡¬ä»¶ç¯å¢ƒï¼Œä½†å…¶å®ç¡¬ä»¶æ²¡æœ‰è¿™ä¹ˆå¼ºå¤§ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿæ¯”å¦‚åœ¨å•æ ¸cpuä¸Šå¯ä»¥ç”¨åˆ†æ—¶æŠ€æœ¯ï¼Œè®©è¿›ç¨‹äº¤æ›¿æ‰§è¡Œã€‚å¯¹äºä¸€ä¸ªè¿›ç¨‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªè¿›ç¨‹å˜æˆäº†å¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚ä½†è¿™æ ·å°±äº§ç”Ÿäº†åŒä¸€ä¸ªèµ„æºå¯ä»¥æ˜¯å†…å­˜çš„æŸä¸€å…·ä½“åœ°å€ï¼Œå¯ä»¥æ˜¯é¼ æ ‡å¯ä»¥æ˜¯ç£ç›˜ä¸Šçš„æŸä¸€æ–‡ä»¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹çš„é—®é¢˜ã€‚è¿™ä¸¤èŠ‚è¯¾æä¾›äº†è§£å†³æ€è·¯ï¼Œä¸€ä¸ªæ˜¯cosmosæ“ä½œç³»ç»Ÿçš„æ–¹æ¡ˆï¼Œä¸€ä¸ªæ˜¯linuxçš„æ–¹æ¡ˆã€‚<br>1.åŸå­æ€§ã€‚å°±æ˜¯ç¡¬ä»¶æ‰§è¡ŒæŒ‡ä»¤æ—¶ä¸è¢«æ‰“æ–­ã€‚å¯¹äºx86æ˜¯å¤æ‚æŒ‡ä»¤é›†ã€‚ä¸€æ¡æŒ‡ä»¤å¯ä»¥åšè¯»ä¿®æ”¹å†…å­˜å€¼çš„æ“ä½œï¼ŒæŒ‡ä»¤é›†ä¸­ç›´æ¥æ”¯æŒé”å®šæ“ä½œã€‚å¯¹äºç²¾ç®€æŒ‡ä»¤é›†ï¼Œå°±ç›¸å¯¹éº»çƒ¦äº›ï¼Œç¡¬ä»¶ä¼šæä¾›bitbandçš„æ“ä½œã€‚<br>2.ä¸­æ–­æ§åˆ¶æ˜¯åœ¨æ‰§è¡Œæ—¶ï¼Œé˜²æ­¢ä¸­æ–­ä¿¡å·çªç„¶æ¥äº†æŠŠå½“å‰æ‰§è¡Œçš„è¿‡ç¨‹æ‰“æ–­äº†ã€‚ è§£å†³æ–¹æ³•å°±æ˜¯å…³é—­ä¸­æ–­ã€‚è®©ä¸­æ–­ä¿¡å·ç­‰åˆ°å¯ä»¥é€šçŸ¥æ—¶ï¼Œæ‰å‘èµ·é€šçŸ¥ã€‚<br>3.è‡ªæ—‹é”ã€‚åœ¨å¤šæ ¸çš„cpuç¯å¢ƒä¸‹ï¼Œå½“å‰æ ¸å¿ƒçš„cpuè¦è®¿é—®çš„èµ„æºæ˜¯æœ‰å¯èƒ½è¢«å…¶ä»–æ ¸çš„cpuæ¥è®¿é—®çš„ã€‚å¦‚æœäº§ç”Ÿè¿™ç§æƒ…å†µï¼Œé‚£å°±è®©å…¶ä»–æ ¸çš„cpuè‡ªå·±æ‰§è¡Œç©ºè½¬ã€‚ä¸€ç›´åˆ°å½“å‰æ ¸å¿ƒçš„cpuæŠŠè®¿é—®èµ„æºè®©å‡ºåï¼Œå…¶ä»–æ ¸çš„cpué€šè¿‡æ£€æµ‹åˆ°äº†å¯ä»¥è®¿é—®èµ„æºï¼Œä¸åœ¨ç©ºè½¬æ‰§è¡Œç›¸å…³æ“ä½œæ¢å¤æ­£å¸¸è¿è¡Œã€‚è€Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è‡ªæ—‹é”ã€‚è¿™é‡Œä¼šæœ‰ä¸€ç‚¹æµªè´¹cpuçš„è¿è¡Œæ•ˆç‡ã€‚æ¯•ç«Ÿæœ‰ä¸ªcpuåœ¨ç©ºè½¬ã€‚å½“ç©ºè½¬æ—¶é—´è¿‡é•¿æ—¶ï¼Œæµªè´¹çš„æ•ˆèƒ½æ›´å¤§ã€‚æˆ‘ä»¬éœ€è¦æ›´å¥½çš„åˆ©ç”¨cpuæ ¸çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é‚£å°±æ˜¯äº’æ–¥ã€‚<br>4.ä¿¡å·é‡<br>å¯¹äºå•ä¸€èµ„æºçš„ä¿¡å·é‡ä¹Ÿå¯ä»¥è¯´æ˜¯äº’æ–¥é”ã€‚  äº’æ–¥é”å’Œè‡ªæ—‹é”çš„åŒºåˆ«å°±æ˜¯åŸæ¥é‚£ä¸ªç©ºè½¬çš„æ ¸ä¸å†ç©ºè½¬ï¼Œè€Œæ˜¯æŠŠå½“å‰è¿è¡Œçš„çº¿ç¨‹æˆ–è€…è¿›ç¨‹ç¡çœ å»æ‰§è¡Œå…¶ä»–çš„çº¿ç¨‹æˆ–è€…è¿›ç¨‹äº†ã€‚  å½“èµ„æºè¢«é€‚å½“åï¼Œå»é€šçŸ¥ç¡çœ çº¿ç¨‹æˆ–è€…è¿›ç¨‹ã€‚è¿™å°±æ˜¯ä¿¡å·é‡ã€‚linuxä¸‹æ–°ç‰ˆæœ¬çš„ä¿¡å·é‡åœ¨è¢«ç§»é™¤ã€‚","like_count":18,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521054,"discussion_content":"ä½ å¥½ï¼Œé“å­æ€»ç»“ åˆ°ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622469798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147795,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIBV8Deuz0Ys4omVlErUvTeRLt7xYRPd8nxhSZ1C2Q9Nice7icHnndsHmyT3KBenxLGw7xghlDzfIuA/132","nickname":"LT","note":"","ucode":"4E902E1EFBB9C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377938,"discussion_content":"è¿™ç« çš„ä»£ç å’Œå½“å‰çš„linuxä»£ç æœ‰ç‚¹å¯¹ä¸ä¸Šï¼ˆrwlock, spin_trylockï¼‰ï¼Œæ˜¯linuxåœ¨åšæ”¹è¿›å—ï¼Ÿè¿™äº›æ”¹è¿›èƒ½è¯´æ˜ä¸€ä¸‹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622972886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2064750,"avatar":"","nickname":"springXu","note":"","ucode":"F5DB0B963C894F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377168,"discussion_content":"è°¢è°¢ä¸œå“¥çš„é¼“åŠ±ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622535568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339965,"user_name":"Qfeng","can_delete":false,"product_type":"c1","uid":1466121,"ip_address":"","ucode":"1248E70012BBA2","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","comment_is_top":true,"comment_ctime":1648515410,"is_pvip":false,"replies":[{"id":"124365","content":"æ˜¯çš„ ","user_name":"ä½œè€…å›å¤","comment_id":339965,"uid":"1345199","ip_address":"","utype":1,"ctime":1648605951,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"9.223372055683199e+18","product_id":100078401,"comment_content":"å›ç­”æ€è€ƒé¢˜ï¼šLinux çš„è¯»å†™é”ï¼Œå› ä¸ºæ¯æ¬¡è¯»é”åŠ é”è®¡æ•°-1ï¼Œæ‰€ä»¥æœ€å¤šæ”¯æŒ0x01000000ä¸ªè¿›ç¨‹å¹¶å‘è¯»å–å…±äº«æ•°æ®ã€‚<br>è¿™æ ·çš„è¯»å†™é”çš„ä¸è¶³ï¼šè¯»æˆ–è€…å†™é”æ‹¿ä¸åˆ°æ—¶å¿™ç­‰ï¼Œå¯ä»¥ä¼˜åŒ–æˆtrylockï¼Œæ‹¿ä¸åˆ°å¯ä»¥å…ˆå¹²å…¶ä»–çš„ï¼Œç­‰ä¸€æ®µæ—¶é—´å†å°è¯•æ‹¿é”ã€‚ï¼ˆä¸çŸ¥é“å›ç­”çš„å¯¹ä¸å¯¹ï¼‰<br><br>æ„Ÿæ‚Ÿï¼šä¸è®ºæ˜¯å•å€¼ä¿¡å·é‡è¿˜æ˜¯å¤šå€¼ä¿¡å·é‡ï¼Œäº¦æˆ–æ˜¯åŸå§‹è‡ªæ—‹é”ã€trylockç‰ˆæœ¬è‡ªæ—‹é”è¿˜æ˜¯è¯»å†™é”ï¼Œå„ç§æœºåˆ¶çš„è®¾è®¡å’Œä¼˜åŒ–éƒ½æ˜¯ä¸ºäº†èµ„æºï¼ˆCPUç­‰ï¼‰çš„æ›´åˆç†æ›´é«˜æ•ˆçš„ä½¿ç”¨è€Œä¼˜åŒ–ã€‚äº’æ–¥æœºåˆ¶æœ‰å¾ˆå¤šï¼Œç†è§£æ¯ç§é”æœºåˆ¶é‡è¦ï¼Œä½†æ˜¯ç†è§£æˆ‘ä»¬çš„ä¸šåŠ¡æ›´é‡è¦ï¼Œè¿™æ ·æ‰èƒ½å› åœ°åˆ¶å®œé€‰æ‹©åˆé€‚çš„é”ã€‚<br><br>è€å¸ˆç®€æ˜æ‰¼è¦ï¼Œç‚¹åˆ°å³æ­¢çš„æ–‡é£å¤ªèµäº†ï¼Œè°¢è°¢ã€‚","like_count":5,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559083,"discussion_content":"æ˜¯çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648605951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294934,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1622160439,"is_pvip":false,"replies":[{"id":"107308","content":"å“ˆå“ˆ æ¬¢è¿","user_name":"ä½œè€…å›å¤","comment_id":294934,"uid":"1345199","ip_address":"","utype":1,"ctime":1622473557,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"117586277431","product_id":100078401,"comment_content":"ä»¥åæˆ‘å°±æ˜¯ç¬¬ä¸€ä¸œå¹äº†ğŸ˜ï¼<br>åƒè¿™æ ·çš„æ¸…æ™°æ˜äº†ï¼Œè¨€ç®€æ„èµ…çš„Linuxå†…æ ¸æºç è§£è¯»å®åœ¨æ˜¯å¤ªå°‘äº†ï¼Œè¿™æ ·çš„æ–‡ç« è¯»èµ·æ¥å®åœ¨æ˜¯å¤ªçˆ½äº†ï¼Œå¼ºçƒˆå°ç¼–å®‰æ’ä¸€ä¸‹ä¸œå“¥çš„ä¸‹ä¸€ä¸ªä¸“æ å«åš ã€Šçºµè§ˆLinuxæºç ï¼Œå°ç™½ä¹Ÿèƒ½å­¦é€ã€‹ã€‚<br><br>å¯¹äºæ€è€ƒé¢˜ç­”æ¡ˆï¼Œè¯»å¹¶å‘è¿›ç¨‹çš„æœ€å¤§ä¸ªæ•°å°±æ˜¯0x01000000ï¼Œåªè¦lockå¤§äº0éƒ½æ˜¯å¯ä»¥å…±äº«æ•°æ®çš„ã€‚<br>è‡³äºè¯»å†™é”çš„ä¸è¶³ï¼Œæˆ‘ä¸ªäººè§‰å¾—æœ€ä¸å‹å¥½çš„ç‚¹åœ¨äºè¯»å†™äº’æ–¥ä¸Šï¼Œç”±äºè¯»é”å¯¹å†™é”æ˜¯äº’æ–¥çš„ï¼Œå¦‚æœä¸€ç›´æœ‰äººè¯»ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ä¸€ç›´å°äº0x01000000ï¼ŒåŠ å†™é”æ—¶ä¹Ÿä¸€ç›´å°äº0ï¼Œå†™é”ä¸€ç›´ä¹Ÿä¸ä¼šæˆåŠŸï¼Œä¼šé™·å…¥é•¿æ—¶é—´çš„å†™é¥¥é¥¿çŠ¶æ€ï¼Œå¹¶ä¸”ä¸€ç›´è‡ªæ—‹ï¼Œæµªè´¹CPUèµ„æºã€‚<br>æ‰€ä»¥æ”¹è¿›ç‚¹å°±åœ¨äºï¼Œç»™å†™è¿›ç¨‹é…ä¸Šä¸€ä¸ªä¼‘çœ é˜Ÿåˆ—ï¼Œå¾…åŠ é”å¤±è´¥è¿›å…¥é˜Ÿåˆ—ä¼‘çœ ç­‰å¾…ï¼Œå¾…è§£è¯»é”æ—¶åˆ¤æ–­è®¡æ•°å™¨ï¼Œå†³å®šæ˜¯å¦å”¤é†’é˜Ÿåˆ—ä¸­çš„å†™è¿›ç¨‹ã€‚<br>å½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„ä¼˜åŒ–ç‚¹ï¼Œæ¬¢è¿å¤§å®¶é›†æ€å¹¿ç›Š~","like_count":28,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520878,"discussion_content":"å“ˆå“ˆ æ¬¢è¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2950704,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/06/30/c26ea06a.jpg","nickname":"è‰¾æ©å‡","note":"","ucode":"F2B81BF4F0106A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558954,"discussion_content":"é”å°±æ˜¯é”ï¼Œä¼˜åŒ–å•¥ï¼Œåº”ç”¨åœºæ™¯ä¸åŒï¼Œä¸ªäººè®¤ä¸ºä¸æ˜¯ä¸èƒ½ä¼˜åŒ–ï¼Œæ¯ä¸ªé”éƒ½æœ‰å®ƒå­˜åœ¨çš„é“ç†ï¼Œåƒè¿™ç§é•¿æ—¶é—´æœ‰å†™æ“ä½œçš„åœºæ™¯ï¼Œç”¨è¯»å†™é”å°±ä¸é€‚ç”¨äº†ï¼Œæ˜æ˜çŸ¥é“è¦é•¿æ—¶é—´ç­‰å¾…ï¼Œè¿˜è¦ç”¨è¿™ç§çŸ­æ—¶é—´æ‰ç”¨çš„é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648527689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294945,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1622163542,"is_pvip":false,"replies":[{"id":"107306","content":"å—¯å—¯","user_name":"ä½œè€…å›å¤","comment_id":294945,"uid":"1345199","ip_address":"","utype":1,"ctime":1622473489,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"61751705686","product_id":100078401,"comment_content":"å›ç­”ä¸€ä¸‹æ€è€ƒé¢˜<br>1.ç†è®ºä¸Šå¯ä»¥æ”¯æŒx01000000è¿™ä¹ˆå¤šè¿›ç¨‹ï¼Œä½†å®é™…ä¸Šå—é™äºæ–‡ä»¶å¥ç‚³ä¹Ÿå°±æ˜¯æ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶ï¼Œè¿˜æœ‰è€ƒè™‘å¤šä¸ªçº¿ç¨‹çš„é—®é¢˜ç­‰ç­‰ï¼Œæ³¨å®šæœ€ç»ˆè¿œè¿œå°äºè¿™ä¸ªå€¼<br>2.è¯»å†™é”é€ æˆå†™é¥¥é¥¿çš„æƒ…å†µæ˜¯ä¸æ˜¯å¯ä»¥å‚è€ƒjdkçš„è¯»å†™é”çš„å®ç°ï¼Œåœ¨æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ä¸­åˆ¤æ–­é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯ä¸€ä¸ªå†™è¿›ç¨‹ï¼Œå¦‚æœæ˜¯å†™è¿›ç¨‹ï¼Œè®©å…¶ç›´æ¥ä¼˜å…ˆè·å–é”.","like_count":15,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520887,"discussion_content":"å—¯å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296899,"user_name":"Geek_8c4220","can_delete":false,"product_type":"c1","uid":2028446,"ip_address":"","ucode":"5370E7C39AD1E3","user_header":"","comment_is_top":false,"comment_ctime":1623218891,"is_pvip":false,"replies":[{"id":"107853","content":"å› ä¸ºæˆ‘æ²¡æœ‰è®²","user_name":"ä½œè€…å›å¤","comment_id":296899,"uid":"1345199","ip_address":"","utype":1,"ctime":1623245032,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"18803088075","product_id":100078401,"comment_content":"ä¸ºä»€ä¹ˆè¿™èŠ‚é‡Œå®ç°è‡ªæ—‹é”çš„æ—¶å€™éƒ½æ²¡æœ‰å…³ä¸­æ–­äº†å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521633,"discussion_content":"å› ä¸ºæˆ‘æ²¡æœ‰è®²","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623245032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313284,"user_name":"å­é’","can_delete":false,"product_type":"c1","uid":1200029,"ip_address":"","ucode":"F6D22EB15325FD","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/9d/72461b25.jpg","comment_is_top":false,"comment_ctime":1632363959,"is_pvip":true,"replies":[{"id":"113517","content":"1.è¿›ç¨‹è°ƒç”¨è‡ªæ—‹é”ï¼Œæ˜¯åœ¨å†…æ ¸æ€è¿è¡Œçš„å†…æ ¸ä»£ç ï¼Œå¦‚æœåœ¨è¿™ä¸ªä»£ç è·¯å¾„ä¸ŠæŒ‚äº†ï¼Œé‚£å°±è¯´æ˜å†…æ ¸æœ‰BUG éœ€è¦ä¿®æ­£<br>2. upä¹‹åä¼šå¯¹è¿›ç¨‹çš„ä¼˜å…ˆçº§è¿›è¡Œå¤„ç†çš„ï¼Œä¸ä¼šåé¢çš„è¿›ç¨‹æ²¡æœºä¼šçš„","user_name":"ä½œè€…å›å¤","comment_id":313284,"uid":"1345199","ip_address":"","utype":1,"ctime":1632445425,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"14517265847","product_id":100078401,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜æƒ³è¯·æ•™<br>1 ã€‚Linuxè‡ªæ—‹é”ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨è·å–é”ä¹‹åæŒ‚äº†æ€ä¹ˆåŠï¼Œæ²¡äººç»™owner +1äº†ï¼Œåé¢æ’é˜Ÿçš„è¿›ç¨‹å²‚ä¸æ˜¯æ°¸è¿œç­‰ä¸åˆ°é”é‡Šæ”¾ï¼Ÿ<br>2ã€‚ä¿¡å·é‡é‚£é‡Œï¼Œdownæ˜¯åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥ï¼Œupæ˜¯å”¤é†’é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿™æ ·ä¸ä¼šæœ‰é¥¥é¥¿é—®é¢˜å—ï¼Œé“¾è¡¨åé¢çš„å¯èƒ½æ°¸è¿œæ‹¿ä¸åˆ°èµ„æºï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527302,"discussion_content":"1.è¿›ç¨‹è°ƒç”¨è‡ªæ—‹é”ï¼Œæ˜¯åœ¨å†…æ ¸æ€è¿è¡Œçš„å†…æ ¸ä»£ç ï¼Œå¦‚æœåœ¨è¿™ä¸ªä»£ç è·¯å¾„ä¸ŠæŒ‚äº†ï¼Œé‚£å°±è¯´æ˜å†…æ ¸æœ‰BUG éœ€è¦ä¿®æ­£\n2. upä¹‹åä¼šå¯¹è¿›ç¨‹çš„ä¼˜å…ˆçº§è¿›è¡Œå¤„ç†çš„ï¼Œä¸ä¼šåé¢çš„è¿›ç¨‹æ²¡æœºä¼šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632445425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2834444,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/40/0c/19b4224a.jpg","nickname":"ä¸å†™å‡ºæ“ä½œç³»ç»Ÿä¸æ”¹å","note":"","ucode":"DD40D98250B688","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412558,"discussion_content":"ä½ çš„ç¬¬2é—®ï¼Œçœ‹ä»£ç é‡Œæ˜¯æŠŠå®ƒåŠ å…¥åˆ°äº†sem->wait_listçš„å°¾éƒ¨äº†ï¼Œæ²¡æœ‰æ’å…¥åˆ°å¤´éƒ¨ã€‚upå”¤é†’çš„æ—¶å€™æ˜¯ä»å¤´éƒ¨å”¤é†’çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636208367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331157,"user_name":"ç–¯ç ","can_delete":false,"product_type":"c1","uid":1228313,"ip_address":"","ucode":"7FF11EC80439EA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/vQiadbkZYR239J80hjekw7jzY9vy6otLKPNDSuz2lruDiaXlKGkcsX5wwiaFevicgqV8odlRG4UITiadDF3fgicrHPcw/132","comment_is_top":false,"comment_ctime":1642469278,"is_pvip":false,"replies":[{"id":"121015","content":"eflagså¯„å­˜å™¨ä¸èƒ½ä½¿ç”¨movæŒ‡ä»¤è®¿é—®","user_name":"ä½œè€…å›å¤","comment_id":331157,"uid":"1345199","ip_address":"","utype":1,"ctime":1642495790,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10232403870","product_id":100078401,"comment_content":"è¯·é—®ä¸‹ä¸ºä»€ä¹ˆä¿å­˜å’Œæ¢å¤eflagsé‚£æ®µä»£ç ç”¨push popè€Œä¸æ˜¯movå‘¢","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547015,"discussion_content":"eflagså¯„å­˜å™¨ä¸èƒ½ä½¿ç”¨movæŒ‡ä»¤è®¿é—®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1642495790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326120,"user_name":"GeekYanger","can_delete":false,"product_type":"c1","uid":2046036,"ip_address":"","ucode":"E674B7D25261CC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/sOuSC65kXWdWBAIIs6uXAD41Ed8Wo8tib81LLVOQJ2oK23TgPDy6x0PGmp7rXwLR3BHOicaKx1zib1DyfpCITK3dw/132","comment_is_top":false,"comment_ctime":1639386760,"is_pvip":false,"replies":[{"id":"118725","content":"å¯¹ å¯¹ å¯¹ æˆ‘å¤§æ„äº†","user_name":"ä½œè€…å›å¤","comment_id":326120,"uid":"1345199","ip_address":"","utype":1,"ctime":1639703029,"user_name_real":"ç¼–è¾‘"}],"discussion_count":3,"race_medal":0,"score":"10229321352","product_id":100078401,"comment_content":"æ–‡ä¸­ï¼š<br>â€œ&#47;&#47;Linuxæ²¡æœ‰è¿™æ ·çš„ç»“æ„ï¼Œè¿™åªæ˜¯ä¸ºäº†æè¿°æ–¹ä¾¿<br>typedef struct raw_spinlock<br>{ <br>        union <br>                { <br>                        unsigned int slock;&#47;&#47;çœŸæ­£çš„é”å€¼å˜é‡ <br>                        u16 owner; <br>                        u16 next; <br>                }<br>}raw_spinlock_t;â€<br>è¿™é‡Œè€å¸ˆä¸ºäº†å¸®åŠ©æˆ‘ä»¬ç†è§£æ±‡ç¼–ä»£ç æ„é€ äº†ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼Œæˆ‘è§‰å¾—ï¼Œè¿™ä¸ªownerå’Œnextè¦è¢«åŒ…åœ¨ä¸€ä¸ªstructä¸­æ‰æ˜¯è€å¸ˆæƒ³è¦è¡¨è¿°çš„æ„æ€ï¼Œä¸ç„¶ownerå’Œnextçš„å–å€¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä½16ä½ã€‚","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539383,"discussion_content":"å¯¹ å¯¹ å¯¹ æˆ‘å¤§æ„äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639703029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539412,"discussion_content":"æ›´æ­£åçš„ä»£ç æ˜¯\n//RAWå±‚çš„è‡ªæ—‹é”æ•°æ®ç»“æ„\ntypedef struct raw_spinlock{\n    unsigned int slock;//çœŸæ­£çš„é”å€¼å˜é‡\n}raw_spinlock_t;\n//æœ€ä¸Šå±‚çš„è‡ªæ—‹é”æ•°æ®ç»“æ„\ntypedef struct spinlock{\n    struct raw_spinlock rlock;\n}spinlock_t;\n//Linuxæ²¡æœ‰è¿™æ ·çš„ç»“æ„ï¼Œè¿™åªæ˜¯ä¸ºäº†æè¿°æ–¹ä¾¿\ntypedef struct raw_spinlock{\n    union {\n        unsigned int slock;//çœŸæ­£çš„é”å€¼å˜é‡\n        struct {\n        u16 owner;\n        u16 next;\n        }\n    }\n}raw_spinlock_t;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639710277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539411,"discussion_content":"æ„Ÿè°¢åé¦ˆï¼Œæˆ‘ä»¬å·²ç»æ”¹æ­£å•¦ï¼Œåˆ·æ–°å¯è§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639710266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301229,"user_name":"Geek_4b6813","can_delete":false,"product_type":"c1","uid":1721895,"ip_address":"","ucode":"ED10C17BE368B4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/46/27/eb318d12.jpg","comment_is_top":false,"comment_ctime":1625582250,"is_pvip":false,"replies":[{"id":"109107","content":"æ˜¯çš„ ","user_name":"ä½œè€…å›å¤","comment_id":301229,"uid":"1345199","ip_address":"","utype":1,"ctime":1625625672,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10215516842","product_id":100078401,"comment_content":"æœ€å¤šæ”¯æŒåŒæ—¶æœ‰2^24ä¸ªè¿›ç¨‹å…±äº«è¯»é”(è®¡ç®—æœºå¸¸é©»çš„è¿›ç¨‹åŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½è¾¾åˆ°è¿™ä¸ªæ•°çš„)<br>å­˜åœ¨çš„é—®é¢˜ï¼Œå†™é¥¥é¥¿ï¼Œåªè¦æœ‰è¯»è¿›ç¨‹å­˜åœ¨ï¼Œå†™è¿›ç¨‹å°±æ°¸è¿œæ²¡æœºä¼šè·å¾—é”ã€‚","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522935,"discussion_content":"æ˜¯çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625625672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297515,"user_name":"KèŒæ— æƒ¨","can_delete":false,"product_type":"c1","uid":2194764,"ip_address":"","ucode":"97A532D588FD49","user_header":"","comment_is_top":false,"comment_ctime":1623592688,"is_pvip":false,"replies":[{"id":"108063","content":"è¿™æ˜¯Linuxé‚£ä¸€å¥—ï¼Œå®ƒæœ‰ä¸€ä¸ªæ£€æŸ¥å·¥å…·ï¼Œå¯¹ä»£ç è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œèƒ½åŠæ—©å‘ç°é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":297515,"uid":"1345199","ip_address":"","utype":1,"ctime":1623723285,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"10213527280","product_id":100078401,"comment_content":"è¯·é—®â€œ_cond_lock åªç”¨ä»£ç é™æ€æ£€æŸ¥å·¥ä½œâ€è¿™å¥è¯æ—¶ä»€ä¹ˆæ„æ€ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521843,"discussion_content":"è¿™æ˜¯Linuxé‚£ä¸€å¥—ï¼Œå®ƒæœ‰ä¸€ä¸ªæ£€æŸ¥å·¥å…·ï¼Œå¯¹ä»£ç è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œèƒ½åŠæ—©å‘ç°é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623723285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295252,"user_name":"fhs","can_delete":false,"product_type":"c1","uid":1640934,"ip_address":"","ucode":"941734CC64A296","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJWFdKjyLOXtCzowmdCUFHezNlnux4NPWmYsqETjiaHNbnmb7xdzibDncZqP06nNbpN4AhmD76cpicfw/132","comment_is_top":false,"comment_ctime":1622334269,"is_pvip":false,"replies":[{"id":"107275","content":"ä¸æ˜¯è¿™æ ·çš„å“¦ å¤šçœ‹çœ‹è¯¾ç¨‹","user_name":"ä½œè€…å›å¤","comment_id":295252,"uid":"1345199","ip_address":"","utype":1,"ctime":1622470498,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"10212268861","product_id":100078401,"comment_content":"è¯»å†™é”éƒ¨åˆ†ä¸­ã€‚å‡è®¾t1æ—¶å€™1å·å†™çº¿ç¨‹è·å–åˆ°äº†é”ä¸”ä¸é‡Šæ”¾ï¼šlock=0ï¼Œt2æ—¶åˆ»2å·å†™çº¿ç¨‹å°è¯•è·å–ï¼šlock=-(0x0100 0000)ï¼Œt3æ—¶åˆ»1å·è¯»å°è¯•è·å–ï¼šlock=-(0x0100 0001)ã€‚<br>ä¹‹å1å·å†™å³ä¾¿é‡Šæ”¾äº†é”ï¼Œæ­¤æ—¶lock = -1ã€‚ä½†æ˜¯2å·å†™çš„æ¯”è¾ƒæˆåŠŸçš„æ¡ä»¶æ˜¯ï¼š&quot;lock+0x01000000ï¼Œç›´åˆ°ç»“æœçš„å€¼ç­‰äº 0x01000000&quot;ã€‚1å·è¯»çš„æ¯”è¾ƒæ¡ä»¶æ˜¯&quot;å¾ªç¯æµ‹è¯• lock+1 çš„å€¼ï¼Œç›´åˆ°ç»“æœçš„å€¼å¤§äºç­‰äº 1&quot;ã€‚<br>å³åœ¨1å·å†™é‡Šæ”¾ä¹‹åï¼Œ2å·å†™å’Œ1å·è¯»å› ä¸ºlockæ˜¯-1æ°¸è¿œè¾¾ä¸åˆ°å„è‡ªé€€å‡ºå¾ªç¯çš„æ¡ä»¶ï¼Œä¸€ç›´åœ¨è‡ªæ—‹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521010,"discussion_content":"ä¸æ˜¯è¿™æ ·çš„å“¦ å¤šçœ‹çœ‹è¯¾ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622470498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1214582,"avatar":"https://static001.geekbang.org/account/avatar/00/12/88/76/c69b7fe5.jpg","nickname":"youngitachi","note":"","ucode":"88717CA8B8ED64","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542286,"discussion_content":"æ²¡åŠ é”æˆåŠŸçš„æ˜¯ä¸ä¼šæ›´æ–°lockå€¼çš„ï¼Œå› æ­¤ä½ è¿™é‡Œçš„æƒ…å†µï¼Œlockå°±æ˜¯0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640701907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342957,"user_name":"doos","can_delete":false,"product_type":"c1","uid":1069269,"ip_address":"","ucode":"7C9AF67F90E65C","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","comment_is_top":false,"comment_ctime":1650549199,"is_pvip":false,"replies":[{"id":"125286","content":"çœ‹ä½ çš„ç›®çš„ï¼Œä¸ºäº†ç†è§£è¿™é—¨è¯¾ï¼Œå¾ˆå¤šå†…å®¹å¯ä»¥ç°æœçš„ã€‚æ±‡ç¼–åˆ°åˆå§‹åŒ–é‚£é‡Œï¼Œåé¢éƒ½æ˜¯Cã€‚å…·ä½“æœ‰å•¥ä¸æ‡‚ä¹‹å¤„ï¼Œä½ å¯ä»¥å†ç•™è¨€æé—®ã€‚","user_name":"ç¼–è¾‘å›å¤","comment_id":342957,"uid":"1501385","ip_address":"","utype":2,"ctime":1650593717,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5945516495","product_id":100078401,"comment_content":"æ„Ÿè§‰ä¸å­¦ä¹ æ±‡ç¼–å’Œcå¾ˆå¤šéƒ½çœ‹ä¸æ‡‚","like_count":2,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566061,"discussion_content":"çœ‹ä½ çš„ç›®çš„ï¼Œä¸ºäº†ç†è§£è¿™é—¨è¯¾ï¼Œå¾ˆå¤šå†…å®¹å¯ä»¥ç°æœçš„ã€‚æ±‡ç¼–åˆ°åˆå§‹åŒ–é‚£é‡Œï¼Œåé¢éƒ½æ˜¯Cã€‚å…·ä½“æœ‰å•¥ä¸æ‡‚ä¹‹å¤„ï¼Œä½ å¯ä»¥å†ç•™è¨€æé—®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650593717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323636,"user_name":"kocgockohgohç‹è£’","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638040330,"is_pvip":false,"replies":[{"id":"120098","content":"ç‚¹èµ","user_name":"ä½œè€…å›å¤","comment_id":323636,"uid":"1345199","ip_address":"","utype":1,"ctime":1641522625,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5933007626","product_id":100078401,"comment_content":"å…³äºå°å¼Ÿé—®çš„é‚£ä¸ªå…³äºæ’é˜Ÿè‡ªæ—‹é”çš„é—®é¢˜ï¼Œå¥½åƒæ˜¯å› ä¸ºgccæ±‡ç¼–çš„æº ç›®çš„å’Œintelæ‰‹å†Œä¸Šçš„é¡ºåºæ˜¯åçš„ã€‚å…³äº xaddlï¼Œintelæ‰‹å†Œä¸Šè¯´æºæ˜¯å¯„å­˜å™¨ï¼Œç›®çš„æ˜¯å¯„å­˜å™¨æˆ–å†…å­˜ã€‚è€Œslockæ˜¯å†…å­˜ï¼Œä¸å¯èƒ½æ˜¯æºã€‚æ‰€ä»¥å°å¼Ÿè§‰å¾—æºæ˜¯%0  incï¼Œç›®çš„æ˜¯%1 slock, æ‰€ä»¥xaddlç›¸å½“äº temp = inc + slock,  inc = slock,  slock = slock + incã€‚ å¦åˆ™çš„è¯ï¼Œæ¯æ¬¡è°ƒç”¨slockéƒ½ä¼šè¢«è®¾æˆincçš„åˆå€¼0001000ï¼Œä¸åˆç†ã€‚ä¸çŸ¥é“å½­ä¸œå¤§ç¥è§‰å¾—å¦‚ä½•","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544437,"discussion_content":"ç‚¹èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641522625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298104,"user_name":"Feen","can_delete":false,"product_type":"c1","uid":2646145,"ip_address":"","ucode":"E6CDC442B7213F","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/81/38b00111.jpg","comment_is_top":false,"comment_ctime":1623914455,"is_pvip":false,"replies":[{"id":"108209","content":"è¿™åªèƒ½è¡¨æ˜ä½ ç†è§£äº†è®¡ç®—æœºä¸­çš„åŒæ­¥æœºåˆ¶ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿéœ€è¦çŸ¥é“çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤š ","user_name":"ä½œè€…å›å¤","comment_id":298104,"uid":"1345199","ip_address":"","utype":1,"ctime":1623981020,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5918881751","product_id":100078401,"comment_content":"åˆ°ç¬¬9è¯¾çš„æ—¶å€™ï¼Œå‘ç°ç•™è¨€çš„æ•°é‡å°‘äº†å¾ˆå¤šï¼Œæ„Ÿè§‰æ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è®¡ç®—æœºåŸç†ï¼‰çš„æ·˜æ±°ç‡çœŸçš„å¾ˆé«˜ï¼Œèƒ½å‡ºå¸ˆçš„å¤ªå°‘äº†ã€‚å…³äºæœ€åçš„é—®é¢˜ï¼Œåº”è¯¥è¯´è¯»é”æœ€å¤§æ”¯æŒçš„è¿›ç¨‹æ•°æ˜¯0x01000000ï¼Œå†™é”æœ€å¤§çš„è¿›ç¨‹æ•°äººä¸ºçš„è®¾ç½®ä¸º1ã€‚å†™é”ä¹Ÿå¯ä»¥è®¾ç½®ä¸º0x01000000ï¼Œå› ä¸ºå¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œåˆ°åº•æœ‰å¤šå°‘è¿›ç¨‹å†™å¯¹å®ƒæ¥è¯´æ— å…³ï¼Œæ•°æ®å¯¹è®¡ç®—æœºæ²¡æœ‰æ„ä¹‰ï¼Œæ•°æ®åªå¯¹äºäººèƒ½ä¸èƒ½æ­£ç¡®ä½¿ç”¨æœ‰å…³ã€‚æ‰€ä»¥æ‰æœ‰ä¸Šå†™é”çš„æ—¶å€™ç›´æ¥å‡å»0x01000000è¿™ä¸ªåˆå§‹å€¼ï¼Œç›®çš„æ˜¯æ§åˆ¶åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å†™ï¼Œè€Œä¸æ˜¯ä¸ºäº†1è€Œè®¾ç½®1ã€‚ä¸ç®¡æ˜¯ä¸­æ–­ï¼Œä¿¡å·é‡ï¼Œå„ç§é”ï¼Œæœ€åéƒ½è¦é CPUç¡¬ä»¶çš„é›†æˆæŒ‡ä»¤æ”¯æŒæ‰èƒ½å®Œæˆï¼Œå°±æ˜¯åŸå­æ“ä½œï¼Œè®¡ç®—æœºä¸Šçš„å„ç§è½¯ä»¶ï¼Œåº”ç”¨ï¼ŒæœåŠ¡éƒ½æ˜¯é åŸå­æ“ä½œå®Œæˆè‡ªå·±çš„äº‹åŠ¡ï¼Œæ‰‹æ®µå°±æ˜¯åœ¨æ“ä½œçš„æ—¶å€™ä¸å—æ‰“æ–­ï¼Œç›®çš„æ˜¯å®Œæˆä¸€ä»¶äº‹ã€‚æ€ä¹ˆæ ·èƒ½ç©å¥½åŸå­æ“ä½œï¼Œå°±èƒ½å‡ºå¸ˆäº†ã€‚å“ˆå“ˆ","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522017,"discussion_content":"è¿™åªèƒ½è¡¨æ˜ä½ ç†è§£äº†è®¡ç®—æœºä¸­çš„åŒæ­¥æœºåˆ¶ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿéœ€è¦çŸ¥é“çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤š ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623981020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296421,"user_name":"LT","can_delete":false,"product_type":"c1","uid":1147795,"ip_address":"","ucode":"4E902E1EFBB9C1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIBV8Deuz0Ys4omVlErUvTeRLt7xYRPd8nxhSZ1C2Q9Nice7icHnndsHmyT3KBenxLGw7xghlDzfIuA/132","comment_is_top":false,"comment_ctime":1622968103,"is_pvip":false,"replies":[{"id":"107569","content":"è¿™æ˜¯æ—§ç‰ˆ linuxçš„ æ–°ç‰ˆæœ¬ä¸­æ²¡æœ‰äº† ","user_name":"ä½œè€…å›å¤","comment_id":296421,"uid":"1345199","ip_address":"","utype":1,"ctime":1622986436,"user_name_real":"LMOS"}],"discussion_count":2,"race_medal":0,"score":"5917935399","product_id":100078401,"comment_content":"static inline int __raw_spin_trylock(raw_spinlock_t*lock){    int tmp;    int new;    asm volatile(    &quot;movl %2,%0\\n\\t&quot;&#47;&#47;tmp=slock    &quot;movl %0,%1\\n\\t&quot;&#47;&#47;new=tmp    &quot;roll $16, %0\\n\\t&quot;&#47;&#47;tmpå¾ªç¯å·¦ç§»16ä½ï¼Œå³nextå’Œowneräº¤æ¢äº†    &quot;cmpl %0,%1\\n\\t&quot;&#47;&#47;æ¯”è¾ƒtmpå’Œnewå³ï¼ˆownerã€nextï¼‰ï¼Ÿ=ï¼ˆnextã€ownerï¼‰    &quot;jne 1f\\n\\t&quot; &#47;&#47;ä¸ç­‰åˆ™è·³è½¬åˆ°æ ‡å·1å¤„     &quot;addl $0x00010000, %1\\n\\t&quot;&#47;&#47;ç›¸å½“äºnext+1    &quot;lock ; cmpxchgl %1,%2\\n\\t&quot;&#47;&#47;newå’Œslockäº¤æ¢æ¯”è¾ƒ        &quot;1:&quot;    &quot;sete %b1\\n\\t&quot; &#47;&#47;new = eflags.ZFä½ï¼ŒZFå–å†³äºå‰é¢çš„åˆ¤æ–­æ˜¯å¦ç›¸ç­‰    &quot;movzbl %b1,%0\\n\\t&quot; &#47;&#47;tmp = new    :&quot;=&amp;a&quot;(tmp),&quot;=Q&quot;(new),&quot;+m&quot;(lock-&gt;slock)    ::&quot;memory&quot;,&quot;cc&quot;);    return tmp;}<br><br>è¿™æ®µä»£ç æˆ‘çœ‹æ‡‚äº†ï¼Œä½†æ˜¯åœ¨linuxä»£ç æ ‘ä¸­æˆ‘æ²¡æœ‰æ‰¾åˆ°ï¼Œç”šè‡³æ˜¯ç”¨grep.<br>æˆ‘çœ‹linuxä»£ç ç»å¸¸ä¼šæœ‰è¿™ç§æƒ…å†µï¼Œæ‰¾ä¸åˆ°ç›¸å…³çš„ASMä»£ç çš„å®ç°ã€‚LMOSï¼Œè¿™æ®µä»£ç åœ¨é‚£ä¸ªæ–‡ä»¶ä¸­ï¼Ÿ<br><br>å»ºè®®ä»¥åç›¸å…³ä»£ç ï¼Œæ ‡æ³¨ä¸‹linuxä¸‹çš„æ–‡ä»¶è·¯å¾„ã€‚","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521436,"discussion_content":"è¿™æ˜¯æ—§ç‰ˆ linuxçš„ æ–°ç‰ˆæœ¬ä¸­æ²¡æœ‰äº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622986436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2358828,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZpAQxicyuOuNQuxcTVk11Gh0UrmLtPyZbFBVBnyC4I7hGmLrYFF8z6xK6USfNV1EDp6BXskjrv7YGHoodH6T6aw/132","nickname":"Geek_3974bd","note":"","ucode":"74E05D25512948","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407903,"discussion_content":"æƒ³è¯·æ•™ä¸€ä¸‹ï¼Œcmpl %0,%1\\n\\t&#34;//æ¯”è¾ƒtmpå’Œnewå³ï¼ˆownerã€nextï¼‰ï¼Ÿ=ï¼ˆnextã€ownerï¼‰ä¹‹åï¼Œä¸æ˜¯å·²ç»åˆ¤æ–­é”æœªè¢«å ç”¨äº†å˜›ï¼Œä¸ºä»€ä¹ˆå°†newä¸­çš„next+1ä¹‹åï¼Œç„¶åå°†å…¶ä¸slockè¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·çš„è¯ï¼Œ&#34;lock ; cmpxchgl %1,%2\\n\\t&#34;//newå’Œslockäº¤æ¢æ¯”è¾ƒï¼Œè¿™ä¸€æ­¥å°±ä¸€å®šä¸ç›¸ç­‰äº†ã€‚ä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635147760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295467,"user_name":"å®å…¸","can_delete":false,"product_type":"c1","uid":2616028,"ip_address":"","ucode":"63953F36596C28","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","comment_is_top":false,"comment_ctime":1622442330,"is_pvip":true,"replies":[{"id":"107259","content":"æ˜¯çš„æ˜¯çš„ ","user_name":"ä½œè€…å›å¤","comment_id":295467,"uid":"1345199","ip_address":"","utype":1,"ctime":1622469258,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5917409626","product_id":100078401,"comment_content":"é‡æ–°å®šä¹‰ä¸€ä¸ªä»£ç æ®µï¼Œé¿å…åé¢çš„ä»£ç å¡«å……cacheã€‚å› ä¸ºå¤§éƒ¨åˆ†åŠ é”éƒ½æ˜¯æˆåŠŸçš„ã€‚<br>è¿™ä¸ªå¯ä»¥ç†è§£ã€‚<br>ä½†æ˜¯ä¸ºä½•é‡æ–°é‡æ–°å®šä¹‰ä¸€ä¸ªä»£ç æ®µï¼Œå°±å¯ä»¥ä¿è¯åé¢çš„ä»£ç ä¸å¡«å……cache?","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521091,"discussion_content":"æ˜¯çš„æ˜¯çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622469258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295248,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1622330746,"is_pvip":false,"replies":[{"id":"107277","content":"æ˜¯çš„ æ˜¯çš„ ","user_name":"ä½œè€…å›å¤","comment_id":295248,"uid":"1345199","ip_address":"","utype":1,"ctime":1622470549,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5917298042","product_id":100078401,"comment_content":"è¯·é—®è€å¸ˆï¼Œå››ç§è§£å†³å¹¶å‘çš„æ–¹æ³•ä¸­é‡Œæ˜¯ä¸æ˜¯åªæœ‰å…³ä¸­æ–­æ˜¯åªå’ŒCPUçš„çŠ¶æ€æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯å…³é—­äº†CPUæ¥å—ä¸­æ–­è°ƒç”¨çš„æœåŠ¡ï¼Œå…¶ä»–çš„åŸå­æ“ä½œï¼Œè‡ªæ—‹é”ï¼Œä¿¡å·é‡éƒ½éœ€è¦å†…å­˜å’ŒCPUå„è‡ªçš„åŸå­æ“ä½œæ¥é…åˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521007,"discussion_content":"æ˜¯çš„ æ˜¯çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622470549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295188,"user_name":"fhs","can_delete":false,"product_type":"c1","uid":1640934,"ip_address":"","ucode":"941734CC64A296","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJWFdKjyLOXtCzowmdCUFHezNlnux4NPWmYsqETjiaHNbnmb7xdzibDncZqP06nNbpN4AhmD76cpicfw/132","comment_is_top":false,"comment_ctime":1622291771,"is_pvip":false,"replies":[{"id":"107284","content":"ä¸ºä»€ä¹ˆ åªæœ‰128 ","user_name":"ä½œè€…å›å¤","comment_id":295188,"uid":"1345199","ip_address":"","utype":1,"ctime":1622472312,"user_name_real":"LMOS"}],"discussion_count":7,"race_medal":0,"score":"5917259067","product_id":100078401,"comment_content":"è¯·é—®ä¸‹ï¼ŒLinuxçš„è¯»å†™é”å®ç°ä¸­ï¼Œå†™é”æ¯æ¬¡è·å–çš„æ—¶å€™éƒ½å‡0x0100 0000ï¼Œé‚£ä¹ˆå¦‚æœæœ‰è¶…è¿‡128ä¸ªçº¿ç¨‹åŒæ—¶å†™ï¼Œä¸æ˜¯å°±å¯èƒ½ä¼šæº¢å‡ºä¹ˆï¼Ÿå³è¿™ä¸ªå®ç°ä¸­æœ€å¤šåªèƒ½æ”¯æŒ128ä¸ªå†™çº¿ç¨‹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520978,"discussion_content":"ä¸ºä»€ä¹ˆ åªæœ‰128 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2495621,"avatar":"https://static001.geekbang.org/account/avatar/00/26/14/85/73e55be5.jpg","nickname":"~","note":"","ucode":"BE5E3BD6EE3665","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545487,"discussion_content":"æœ‹å‹ 0x01000000 æ˜¯ 16 è¿›åˆ¶ï¼Œä¸æ˜¯äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥ä¸æ˜¯ 128 è€Œæ˜¯ 2^24ã€‚è¿™æ ·çš„è¯æˆ‘æƒ³ä¹Ÿå°±ä¸ä¼šæº¢å‡ºäº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641975816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1475134,"avatar":"https://static001.geekbang.org/account/avatar/00/16/82/3e/1fc6e36a.jpg","nickname":"zlig","note":"","ucode":"DD5850FA4235E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376779,"discussion_content":"åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½å¾—åˆ°å†™é”ã€‚128ä¸ªéƒ½éœ€è¦æ’é˜Ÿï¼Œæ¯ä¸ªè¿›ç¨‹è¿›æ¥éƒ½éœ€è¦å…ˆè·å–å†™é”ï¼Œå®Œæˆå†™ä»»åŠ¡åï¼Œå¿…éœ€é‡Šæ”¾é”ï¼Œåé¢çš„è¿›ç¨‹æ‰èƒ½å¼€å§‹å°è¯•è·å–å†™é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622341351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1640934,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJWFdKjyLOXtCzowmdCUFHezNlnux4NPWmYsqETjiaHNbnmb7xdzibDncZqP06nNbpN4AhmD76cpicfw/132","nickname":"fhs","note":"","ucode":"941734CC64A296","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1475134,"avatar":"https://static001.geekbang.org/account/avatar/00/16/82/3e/1fc6e36a.jpg","nickname":"zlig","note":"","ucode":"DD5850FA4235E5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376866,"discussion_content":"ä½ è¯´çš„å½“ç„¶æ²¡é”™ã€‚æˆ‘æ›´æƒ³è¡¨è¾¾çš„æ˜¯è¿™128ä¸ªå†™æ“ä½œå¦‚æœåœ¨å¾ˆçŸ­æ—¶é—´å†…åŒæ—¶åˆ°æ¥ï¼Œé‚£ä¹ˆå› ä¸ºæ¯æ¬¡éƒ½æ˜¯å…ˆå‡å»0x0100 0000ï¼Œä¼šå¯¼è‡´è¶…è¿‡intæœ€å°å€¼å¯¼è‡´æ•°æ®æº¢å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622386408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376779,"ip_address":""},"score":376866,"extra":""},{"author":{"id":1475134,"avatar":"https://static001.geekbang.org/account/avatar/00/16/82/3e/1fc6e36a.jpg","nickname":"zlig","note":"","ucode":"DD5850FA4235E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1640934,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJWFdKjyLOXtCzowmdCUFHezNlnux4NPWmYsqETjiaHNbnmb7xdzibDncZqP06nNbpN4AhmD76cpicfw/132","nickname":"fhs","note":"","ucode":"941734CC64A296","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376905,"discussion_content":"è¿™ä¸ªæ•°å­—æœ¬èº«å°±æ˜¯åŸå­æ“ä½œçš„ï¼Œåªè¦æœ‰ä¸€ä¸ªè¿›ç¨‹æ“ä½œå®ƒäº†ï¼Œå®ƒçš„å€¼å‡è¿‡ä¹‹åï¼Œåé¢çš„è¿›ç¨‹å°±ç›´æ¥è¿›å…¥è‡ªæ—‹çŠ¶æ€ã€‚åªèƒ½ç­‰å‰ä¸€ä¸ªè§£é”çš„æ—¶å€™æŠŠå®ƒåŠ å›æ¥ï¼Œå…¶å®ƒçš„è¿›ç¨‹æ‰èƒ½æ¥ç«äº‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622420718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376866,"ip_address":""},"score":376905,"extra":""},{"author":{"id":1640934,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJWFdKjyLOXtCzowmdCUFHezNlnux4NPWmYsqETjiaHNbnmb7xdzibDncZqP06nNbpN4AhmD76cpicfw/132","nickname":"fhs","note":"","ucode":"941734CC64A296","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1475134,"avatar":"https://static001.geekbang.org/account/avatar/00/16/82/3e/1fc6e36a.jpg","nickname":"zlig","note":"","ucode":"DD5850FA4235E5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376942,"discussion_content":"LOCK_PREFIX&#34;subl %1,(%0)\\n\\t&#34;//åŸå­å¯¹lockå‡å»RW_LOCK_BIAS\n\næ¯ä¸ªå†™è¿›ç¨‹å°è¯•è·å–å†™é”æ—¶å€™æ˜¯å…ˆå»å‡ï¼Œä¸ä¸º0äº†å†å»è‡ªæ—‹ã€‚ä¸æ˜¯å…ˆåˆ¤æ–­","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622431478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376905,"ip_address":""},"score":376942,"extra":""}]}]},{"had_liked":false,"id":295102,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1622245205,"is_pvip":false,"replies":[{"id":"107289","content":"ä¸æ˜¯å“¦  æ˜¯ç”±ç¡¬ä»¶æ§åˆ¶çš„ ","user_name":"ä½œè€…å›å¤","comment_id":295102,"uid":"1345199","ip_address":"","utype":1,"ctime":1622472562,"user_name_real":"LMOS"}],"discussion_count":1,"race_medal":0,"score":"5917212501","product_id":100078401,"comment_content":"è¯·é—®è€å¸ˆï¼ŒåŸå­å˜é‡çš„æœ¬è´¨æ˜¯ä¸æ˜¯åªæ˜¯å¯¹å¯„å­˜å™¨å’Œå†…å­˜æ“ä½œï¼Œè·³è¿‡äº†å…¶ä»–æ‰€æœ‰ä¸­é—´ç¼“å­˜ï¼Œæ˜¯ä¸€ç§ç”¨é€Ÿåº¦æ¢ä¸€è‡´æ€§çš„æ–¹æ³•ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520949,"discussion_content":"ä¸æ˜¯å“¦  æ˜¯ç”±ç¡¬ä»¶æ§åˆ¶çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295087,"user_name":"é™ˆè¶…","can_delete":false,"product_type":"c1","uid":2610622,"ip_address":"","ucode":"A28CA3E9B5A5C7","user_header":"https://static001.geekbang.org/account/avatar/00/27/d5/be/183c222b.jpg","comment_is_top":false,"comment_ctime":1622212878,"is_pvip":false,"replies":[{"id":"107292","content":"66666ï¼Œå¯¹çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622472677,"ip_address":"","comment_id":295087,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5917180174","product_id":100078401,"comment_content":"æˆ‘è®¤ä¸ºï¼Œæ”¯æŒå¹¶å‘è¯»çš„æ•°é‡æ˜¯0x01000000,æ”¯æŒå¹¶è¡Œè¯»çš„æ•°é‡æ˜¯cpuæ ¸å¿ƒçš„æ•°é‡ï¼›è€Œä¸è¶³ä¹‹å¤„å°±åœ¨äºå¿™ç­‰æµªè´¹cpuæ—¶é—´äº†ã€‚è¯»çš„æ—¶å€™å¯ä»¥è®©å†™çš„è¿›ç¨‹è®©å‡ºcpuä¼‘çœ å—ï¼ŸæœŸæœ›è€å¸ˆé«˜è§ï¼","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520944,"discussion_content":"66666ï¼Œå¯¹çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295031,"user_name":"é€è¿‡å¿«é€’çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1587666,"ip_address":"","ucode":"66EA81B3BADC73","user_header":"https://static001.geekbang.org/account/avatar/00/18/39/d2/845c0e39.jpg","comment_is_top":false,"comment_ctime":1622189848,"is_pvip":false,"replies":[{"id":"107297","content":"å¯¹çš„ ï¼ŒåŸå­æ“ä½œæ˜¯ç¡¬ä»¶å¿…é¡» æä¾›çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622473029,"ip_address":"","comment_id":295031,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5917157144","product_id":100078401,"comment_content":"è¯´ä¸‹è‡ªå·±å¯¹é”åº•å±‚çš„ç†æœºï¼Œé”æ˜¯ä¾èµ–ç¡¬ä»¶æä¾›çš„åŸå­æŒ‡ä»¤æ¥æ‰§è¡Œçš„ã€‚æ™®é€šäº’æ–¥é”æ˜¯lockå€¼1 è·å–é”åˆ™å¯¹è¯¥å€¼è¿›è¡ŒåŸå­å‡ï¼Œå¦‚æœè¿™ä¸ªå€¼æœ¬èº«å°±å°äº1ï¼Œé‚£è¯´æ˜è¢«é”ä½äº†ã€‚ã€‚ã€‚ç‹¬å†™é”çš„åŒºåˆ«æ˜¯ä»–æ˜¯0x01000000çš„å€¼ï¼Œè¯»é”å‡1ï¼Œå†™é”å‡0x01000000ï¼Œè¯»é”å¯ä»¥è¢«0x01000000å…±äº«ï¼Œå†™é”æ˜¯äº’æ–¥çš„åªèƒ½è¢«å‡ä¸€æ¬¡ã€‚ã€‚ã€‚ çªç„¶æ„Ÿè§‰åŸå­æ“ä½œæ˜¯è®¡ç®—æœºæœ€åº•å±‚çš„åŠŸèƒ½ï¼Œä»¥å‰åœ¨Javaç¢°åˆ°è¿™ä¸ªé—®é¢˜å°±èŒƒæ‡µï¼Œå°±æ˜¯è‡ªå·±å¯¹åº•å±‚ç†è§£å¤ªå°‘å¯¼è‡´çš„ï¼Œæ— è®ºæ˜¯åº”ç”¨å±‚çš„å¹¶å‘åŒ…ï¼Œè¿˜æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å±‚ï¼Œå¯¹åŸå­æ“ä½œéƒ½æ˜¯éå¸¸ä¾èµ–ã€‚ã€‚ã€‚","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520920,"discussion_content":"å¯¹çš„ ï¼ŒåŸå­æ“ä½œæ˜¯ç¡¬ä»¶å¿…é¡» æä¾›çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400738,"discussion_content":"åˆ°åº•ç¡¬ä»¶æ˜¯æ€ä¹ˆæä¾›çš„ï¼Ÿèƒ½å¤Ÿç®€ç•¥çš„è®²è®²å—ï¼Ÿä¹Ÿå¯ä»¥æ¨èä¸€éæ–‡ç« ã€‚è°¢è°¢è€å¸ˆäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633402806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294976,"user_name":"ç½— ä¹¾ æ—","can_delete":false,"product_type":"c1","uid":1188222,"ip_address":"","ucode":"D0406F95176ABA","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg","comment_is_top":false,"comment_ctime":1622169232,"is_pvip":false,"replies":[{"id":"107301","content":"ä½ å¥½ï¼Œè¯´è¯´åŸå›  ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622473305,"ip_address":"","comment_id":294976,"utype":1}],"discussion_count":6,"race_medal":0,"score":"5917136528","product_id":100078401,"comment_content":" Linuxçš„è¯»å†™é”ï¼Œæˆ‘çš„çœ‹æ³•æ­£å¥½ç›¸åï¼Œå†™ä¼šé€ æˆè¯»é¥¥é¥¿ï¼Œä¸€ç›´æœ‰å†™å…¥æ—¶è¯»è¿›ç¨‹å°†ä¼šé¥¥é¥¿","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520902,"discussion_content":"ä½ å¥½ï¼Œè¯´è¯´åŸå›  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616002,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/c2/8da904a3.jpg","nickname":"Aries","note":"","ucode":"04868496F025A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563475,"discussion_content":"æ–‡ä¸­å·²ç»è¯´äº†è¯»å†™é”é€‚åˆè¯»çš„é¢‘ç‡è¿œå¤§äºå†™çš„é¢‘ç‡çš„åœºæ™¯ï¼Œå¦‚æœæ˜¯å†™çš„é¢‘ç‡æ›´å¤§ï¼Œé‚£ä¸è®ºè¯»ã€å†™ï¼Œéƒ½ä¸Šé”å°±è¡Œäº†ï¼Œå°±å˜æˆæ™®é€šçš„é”äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650004368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400734,"discussion_content":"ä¸€èˆ¬å°±ä¸€ä¸ªå†™ï¼Œå¤šä¸ªè¯»çš„åœºæ™¯å§ã€‚å¦‚æœå¤šä¸ªå†™ï¼Œå¤šä¸ªè¯»é‚£å°±å¤æ‚äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633402224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188222,"avatar":"https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg","nickname":"ç½— ä¹¾ æ—","note":"","ucode":"D0406F95176ABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376568,"discussion_content":"è¡¨è¾¾æœ‰è¯¯ï¼Œå…¶å®æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œä¸€ç›´æœ‰è¯»å¹¶ä¸ä¼šé€ æˆå†™è¿›ç¨‹æ‹¿ä¸åˆ°é”ï¼Œå› ä¸ºå†™ä¸è¯»ç«äº‰ä¸€å®šæ˜¯å†™æŠ¢åˆ°é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622195465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2314187,"avatar":"https://static001.geekbang.org/account/avatar/00/23/4f/cb/ad3526bc.jpg","nickname":"laah","note":"","ucode":"C3886AA1CC556D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1188222,"avatar":"https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg","nickname":"ç½— ä¹¾ æ—","note":"","ucode":"D0406F95176ABA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408488,"discussion_content":"å†™é”æ¯æ¬¡è¦å‡ 0x01000000 åä¸ä¸ºè´Ÿæ•°æ‰èƒ½æ‹¿åˆ°é”ï¼Œè€Œè¯»é”æ¯æ¬¡å‡ 1 åä¸ä¸ºè´Ÿå°±èƒ½æ‹¿åˆ°é”ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¯»æ¯”å†™æˆåŠŸæŠ¢åˆ°é”çš„æ¦‚ç‡å¤§å¾ˆå¤šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635255100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376568,"ip_address":""},"score":408488,"extra":""},{"author":{"id":1466121,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","nickname":"Qfeng","note":"","ucode":"1248E70012BBA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2314187,"avatar":"https://static001.geekbang.org/account/avatar/00/23/4f/cb/ad3526bc.jpg","nickname":"laah","note":"","ucode":"C3886AA1CC556D","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":558865,"discussion_content":"èµåŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648515991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":408488,"ip_address":""},"score":558865,"extra":""}]}]},{"had_liked":false,"id":354664,"user_name":"Geek_ba3598","can_delete":false,"product_type":"c1","uid":3139074,"ip_address":"æ¹–åŒ—","ucode":"9D83A36A34189B","user_header":"","comment_is_top":false,"comment_ctime":1660653233,"is_pvip":false,"replies":[{"id":"129180","content":"æ˜¯ä¸æ˜¯ ç‰ˆæœ¬ ä¸å¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661052559,"ip_address":"æ¹–åŒ—","comment_id":354664,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1660653233","product_id":100078401,"comment_content":"è‡ªæ—‹é”åœ¨å“ªä¸ªå¤´æ–‡ä»¶ä¸­å•Šï¼Ÿlinux&#47;spin_lock.hé‡Œå—ï¼Ÿä½†æ˜¯includeæ ¹æœ¬æ‰¾ä¸åˆ°è¿™ä¸ªå¤´æ–‡ä»¶ã€‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584700,"discussion_content":"æ˜¯ä¸æ˜¯ ç‰ˆæœ¬ ä¸å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661052560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2016221,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c3/dd/33648195.jpg","nickname":"é‡‘åˆš","note":"","ucode":"9657132D6E5D9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585335,"discussion_content":"include/linux/spinlock_types.h","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661487696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®‰å¾½"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350678,"user_name":"è¥¿é—¨å¹ç‰›","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1657091778,"is_pvip":false,"replies":[{"id":"128046","content":"æ˜¯çš„ ä½ å¤ªç‰›äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1658388630,"ip_address":"","comment_id":350678,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1657091778","product_id":100078401,"comment_content":"Java ä¸­çš„ aqs å’Œ linux çš„æ’é˜Ÿè‡ªæ—‹é”ï¼Œå¼‚æ›²åŒå·¥ã€‚aqs ç”¨é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ç»´æŠ¤äº†å…¬å¹³æ€§ï¼Œè€Œ linux åªç”¨ next å’Œ owner ç»´æŠ¤äº†æŠ¢å çš„é¡ºåºæ€§ã€‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580838,"discussion_content":"æ˜¯çš„ ä½ å¤ªç‰›äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658388630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347127,"user_name":"èŠ±æ ‘","can_delete":false,"product_type":"c1","uid":1542107,"ip_address":"","ucode":"810A5B42EEE264","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/db/c132ef37.jpg","comment_is_top":false,"comment_ctime":1653730160,"is_pvip":false,"replies":[{"id":"126882","content":"ä½ è¦å¼„æ‡‚é‚£ä¸ªæ•°æ®ç»“æ„å’ŒåŠ é”ä»£ç  å°±çŸ¥é“äº† ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1654912313,"ip_address":"","comment_id":347127,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1653730160","product_id":100078401,"comment_content":"è¯»å†™é”é‚£é‡Œæåˆ°å†™ä¼šä¼˜å…ˆå¾—åˆ°é”ï¼Œä»£ç é‡Œæ²¡çœ‹åˆ°ï¼Œæ˜¯æ€ä¹ˆå®ç°çš„å‘€","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575521,"discussion_content":"ä½ è¦å¼„æ‡‚é‚£ä¸ªæ•°æ®ç»“æ„å’ŒåŠ é”ä»£ç  å°±çŸ¥é“äº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654912314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346174,"user_name":"èŠ±æ ‘","can_delete":false,"product_type":"c1","uid":1542107,"ip_address":"","ucode":"810A5B42EEE264","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/db/c132ef37.jpg","comment_is_top":false,"comment_ctime":1652869177,"is_pvip":false,"replies":[{"id":"126505","content":"å…¶å®ƒè¿›ç¨‹åŒæ ·è¦æ‰§è¡Œ decb æŒ‡ä»¤çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1653618068,"ip_address":"","comment_id":346174,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652869177","product_id":100078401,"comment_content":"å¼€å§‹é”å€¼å˜é‡ä¸º 1 æ—¶ï¼Œæ‰§è¡Œ decb æŒ‡ä»¤å°±å˜æˆäº† 0ï¼Œ0 å°±è¡¨ç¤ºåŠ é”æˆåŠŸã€‚å¦‚æœå°äº 0ï¼Œåˆ™è¡¨ç¤ºæœ‰å…¶å®ƒè¿›ç¨‹å·²ç»åŠ é”äº†ï¼Œå°±ä¼šå¯¼è‡´å¾ªç¯æ¯”è¾ƒã€‚<br><br>è¿™é‡ŒåŠ é”æˆåŠŸå€¼å°±ä¸º0äº†ï¼Œå…¶ä»–è¿›ç¨‹è·å–å€¼ä¸åº”è¯¥æ˜¯0å—ï¼Ÿä¸ºä»€ä¹ˆæ˜¯å°äºé›¶","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573716,"discussion_content":"å…¶å®ƒè¿›ç¨‹åŒæ ·è¦æ‰§è¡Œ decb æŒ‡ä»¤çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653618068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343129,"user_name":"ljx","can_delete":false,"product_type":"c1","uid":2446982,"ip_address":"","ucode":"6133FC98C44498","user_header":"https://static001.geekbang.org/account/avatar/00/25/56/86/db4c0d1c.jpg","comment_is_top":false,"comment_ctime":1650643538,"is_pvip":true,"replies":[{"id":"125979","content":"å‡å»çš„é”å€¼ä¸åŒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1652066514,"ip_address":"","comment_id":343129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650643538","product_id":100078401,"comment_content":"è€å¸ˆï¼Œè¯»å†™é”çš„ä»£ç æ²¡çœ‹å‡ºæ¥ä¸ºä»€ä¹ˆç«äº‰æ—¶å†™é”ä¼šä¼˜å…ˆè·å¾—ã€‚èƒ½è§£é‡Šä¸€ä¸‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571086,"discussion_content":"å‡å»çš„é”å€¼ä¸åŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652066514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337552,"user_name":"xy","can_delete":false,"product_type":"c1","uid":2031661,"ip_address":"","ucode":"4D7DB0AC984170","user_header":"https://static001.geekbang.org/account/avatar/00/1f/00/2d/abff5821.jpg","comment_is_top":false,"comment_ctime":1646889705,"is_pvip":false,"replies":[{"id":"123373","content":"ä¼˜å…ˆçº§","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1646973295,"ip_address":"","comment_id":337552,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646889705","product_id":100078401,"comment_content":"ä½ å¥½è¯»å†™é”åœ¨è¯»é”å¾ˆå¤šçš„æ—¶å€™å¦‚ä½•åšä½¿å¾—å†™é”èƒ½æ‹¿åˆ°é”å‘¢ã€‚æ„Ÿè§‰è¿™ä¸ªæŒºéš¾å®ç°çš„ã€‚çœ‹è¯„è®ºè¿™ä¸ªé—®é¢˜å¥½åƒæ²¡æœ‰è§£é‡Šçš„å¾ˆæ¸…æ¥šå“¦ã€‚éå¸¸æ„Ÿè°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555547,"discussion_content":"ä¼˜å…ˆçº§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646973295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328050,"user_name":"å‡‰å‡‰","can_delete":false,"product_type":"c1","uid":1325256,"ip_address":"","ucode":"FCCF976E41EF71","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/c8/972a5024.jpg","comment_is_top":false,"comment_ctime":1640503594,"is_pvip":false,"replies":[{"id":"119662","content":"ä»”ç»†çœ‹ä»£ç é€»è¾‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1640768542,"ip_address":"","comment_id":328050,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1640503594","product_id":100078401,"comment_content":"&quot;è¯»é”æœ€å¤§æ”¯æŒè¿›ç¨‹æ•°æ˜¯0x01000000&quot;ä¸å¤ªç†è§£ï¼Œè¿™ä¸ªå€¼æ€ä¹ˆå¾—å‡ºæ¥çš„","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542500,"discussion_content":"ä»”ç»†çœ‹ä»£ç é€»è¾‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640768542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2616002,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ea/c2/8da904a3.jpg","nickname":"Aries","note":"","ucode":"04868496F025A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563476,"discussion_content":"æ¢æˆ0x10000000ä¹Ÿè¡Œï¼Œæ‡‚äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650004474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324564,"user_name":"æ ‘å¿ƒ","can_delete":false,"product_type":"c1","uid":1589523,"ip_address":"","ucode":"6C329F0FF798B9","user_header":"https://static001.geekbang.org/account/avatar/00/18/41/13/ab14ad25.jpg","comment_is_top":false,"comment_ctime":1638501770,"is_pvip":true,"replies":[{"id":"117883","content":"å—ç”¨å°±å¥½ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1638753529,"ip_address":"","comment_id":324564,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1638501770","product_id":100078401,"comment_content":"å°ç»“<br>09 | ç§ä¸€ç§Linuxï¼šLinuxçš„è‡ªæ—‹é”å’Œä¿¡å·é‡å¦‚ä½•å®ç°ï¼Ÿ<br>Linux çš„åŸå­å˜é‡<br>Linux æ§åˆ¶ä¸­æ–­<br>Linux è‡ªæ—‹é”<br>1. Linux åŸå§‹è‡ªæ—‹é”<br>2. Linux æ’é˜Ÿè‡ªæ—‹é”<br>Linux ä¿¡å·é‡<br>Linux è¯»å†™é”<br><br>ä¾ç„¶è§‰å¾—è€å¸ˆçš„æ€è·¯è„‰ç»œå¾ˆæ¸…æ™°ï¼Œè¯»å®Œç»“åˆæ–‡æœ«çš„å¯¼å›¾é£Ÿç”¨æ›´ä½³","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536293,"discussion_content":"å—ç”¨å°±å¥½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638753529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323634,"user_name":"kocgockohgohç‹è£’","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638036858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638036858","product_id":100078401,"comment_content":"è¯·é—®æ’é˜Ÿè‡ªæ—‹é”15 16 è¡Œä¹‹é—´ ä¹Ÿå°±æ˜¯æ ‡å·2:ä¹‹åæ˜¯ä¸æ˜¯åº”è¯¥åŠ ä¸Šmovl %0ï¼Œ%1å•Š  ä¸ç„¶slockä¸å°±å˜æˆ00010000äº†ä¹ˆ","like_count":0},{"had_liked":false,"id":323631,"user_name":"kocgockohgohç‹è£’","can_delete":false,"product_type":"c1","uid":2617112,"ip_address":"","ucode":"35EFABDE0D713D","user_header":"https://static001.geekbang.org/account/avatar/00/27/ef/18/6a620733.jpg","comment_is_top":false,"comment_ctime":1638034098,"is_pvip":false,"replies":[{"id":"117626","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1638323322,"ip_address":"","comment_id":323631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638034098","product_id":100078401,"comment_content":"è¯·é—®æ’é˜Ÿè‡ªæ—‹é”  xaddlä¹‹å  slockæ˜¯ä¸æ˜¯æ¢æˆinc=00010000å•Š  è¿™æ ·çš„è¯åªè¦ä¸€æœ‰è¿›ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸æ˜¯slockå°±ä¼šè®¾æˆ00010000å•Š","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534952,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638323322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323493,"user_name":"Geek__JASON","can_delete":false,"product_type":"c1","uid":1457801,"ip_address":"","ucode":"B1B4BD97BE3A55","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK7j6kFBH6Wy9KYcRGjbH7c7zqvjJW6yfu5lFMQEf5qDgJzJbGA1CwMbJwxCedJUTE2Hoj2AfQajQ/132","comment_is_top":false,"comment_ctime":1637932472,"is_pvip":false,"replies":[{"id":"117629","content":"GAS æ±‡ç¼– æ˜¯ åçš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1638323421,"ip_address":"","comment_id":323493,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637932472","product_id":100078401,"comment_content":"&quot;lock ; xaddl %0, %1\\n&quot; &#47;&#47;å°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock<br>æ„Ÿè§‰åº”è¯¥æ˜¯ <br>&quot;lock ; xaddl %1, %0\\n&quot; &#47;&#47;å°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock<br><br>XADD r&#47;m8, r8\tExchange r8 and r&#47;m8; load sum into r&#47;m8. xadd å‘½ä»¤çš„dest æ‰èƒ½æ˜¯å†…å­˜åœ°å€ï¼›<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534955,"discussion_content":"GAS æ±‡ç¼– æ˜¯ åçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638323421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320701,"user_name":"Return12321","can_delete":false,"product_type":"c1","uid":1134694,"ip_address":"","ucode":"F7A3C5ED02E1D9","user_header":"https://static001.geekbang.org/account/avatar/00/11/50/66/047ee060.jpg","comment_is_top":false,"comment_ctime":1636459987,"is_pvip":false,"replies":[{"id":"116316","content":"æˆ‘ä»¬è¿˜è¦è€ƒè™‘è¯»å†™ä¼˜å…ˆçº§çš„","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1636506093,"ip_address":"","comment_id":320701,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636459987","product_id":100078401,"comment_content":"è¯»å†™é”ä¸­ï¼Œå¦‚æœæœ‰1000ä¸ªçº¿ç¨‹æœ‰999ä¸ªçº¿ç¨‹å¾ªç¯è¯»å–shareæ•°æ®ã€1ä¸ªçº¿ç¨‹éœ€è¦å†™æ•°æ®ï¼Œé‚£æ˜¯å¦å†™çº¿ç¨‹ä¸€ç›´è·å–ä¸åˆ°é”ï¼Œå¯¼è‡´æ— æ³•ä¿®æ”¹æ•°æ®ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530085,"discussion_content":"æˆ‘ä»¬è¿˜è¦è€ƒè™‘è¯»å†™ä¼˜å…ˆçº§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636506093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314765,"user_name":"Shawn Duan","can_delete":false,"product_type":"c1","uid":1927222,"ip_address":"","ucode":"628BAD6473FBCE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","comment_is_top":false,"comment_ctime":1633410927,"is_pvip":false,"replies":[{"id":"114267","content":"ä½ æ²¡æœ‰è¯»æ‡‚xaddlæŒ‡ä»¤","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1633937970,"ip_address":"","comment_id":314765,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633410927","product_id":100078401,"comment_content":"static inline void __raw_spin_lock(raw_spinlock_t*lock){int inc = 0x00010000;int tmp;__asm__ __volatile__(&quot;lock ; xaddl %0, %1\\n&quot; &#47;&#47;å°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock                        &#47;&#47;ç›¸å½“äºåŸå­è¯»å–nextå’Œownerå¹¶å¯¹next+1<br><br>è¿™é‡Œxaddl å­—é¢æ„æ€æˆ‘æ‡‚ï¼ˆå°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock )ã€‚ä½†æ˜¯å¦‚ä½•â€œç›¸å½“äºåŸå­è¯»å–nextå’Œownerå¹¶å¯¹next+1â€œï¼Œæˆ‘å°±ä¸æ‡‚äº†ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹ã€‚å¥½åƒæ˜¯slockçš„é«˜16ä½æ˜¯next, ä½16ä½æ˜¯owner, ç„¶åå’Œincç›¸åŠ ï¼Œæ€ä¹ˆå°±æ˜¯å¯¹next+1äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527788,"discussion_content":"ä½ æ²¡æœ‰è¯»æ‡‚xaddlæŒ‡ä»¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633937970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314742,"user_name":"Shawn Duan","can_delete":false,"product_type":"c1","uid":1927222,"ip_address":"","ucode":"628BAD6473FBCE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","comment_is_top":false,"comment_ctime":1633387327,"is_pvip":false,"replies":[{"id":"114269","content":"æ˜¯å’ŒCPUä½“ç³»ç›¸å…³çš„","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1633938012,"ip_address":"","comment_id":314742,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633387327","product_id":100078401,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹äº†__READ_ONCEå’Œ__WRITE_ONCEçš„å®ç°ï¼Œè¿˜æ˜¯å¼„ä¸æ¸…æ˜¯å¦‚ä½•å®ç°åŸå­è¯»å†™çš„ï¼Œèƒ½è§£é‡Šä»¥ä¸‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527779,"discussion_content":"æ˜¯å’ŒCPUä½“ç³»ç›¸å…³çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633938012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312810,"user_name":"èŠ±å¥½æœˆåœ†","can_delete":false,"product_type":"c1","uid":2425595,"ip_address":"","ucode":"424AC405DE626E","user_header":"https://static001.geekbang.org/account/avatar/00/25/02/fb/30ed9541.jpg","comment_is_top":false,"comment_ctime":1632035724,"is_pvip":true,"replies":[{"id":"113388","content":"å¯ä»¥å­¦çš„","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1632215430,"ip_address":"","comment_id":312810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632035724","product_id":100078401,"comment_content":"ä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹å¯¹äºæ–‡ä¸­é‚£äº›ä»£ç ï¼Œæ˜¯æ±‡ç¼–è¯­è¨€å—ï¼Œæ²¡å­¦è¿‡æ±‡ç¼–è¯­è¨€æ˜¯ä¸æ˜¯ä¸å¯èƒ½å­¦ä¸‹å»","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527120,"discussion_content":"å¯ä»¥å­¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632215430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311868,"user_name":"IDo","can_delete":false,"product_type":"c1","uid":1026204,"ip_address":"","ucode":"BCF7BFBE35E390","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/9c/91dc7fc4.jpg","comment_is_top":false,"comment_ctime":1631516331,"is_pvip":false,"replies":[{"id":"113154","content":"æ˜¯çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1631753202,"ip_address":"","comment_id":311868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631516331","product_id":100078401,"comment_content":"qspinlockæ²¡è®²å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526777,"discussion_content":"æ˜¯çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631753202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309067,"user_name":"anTalk","can_delete":false,"product_type":"c1","uid":2730532,"ip_address":"","ucode":"5079037241F8AA","user_header":"https://static001.geekbang.org/account/avatar/00/29/aa/24/b46439e8.jpg","comment_is_top":false,"comment_ctime":1629914462,"is_pvip":false,"replies":[{"id":"111869","content":"å“ˆå“ˆ è¿™æ²¡æœ‰é—®é¢˜å…ˆä»æ³¨é‡Šå¼€å§‹çœ‹èµ·","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1629939625,"ip_address":"","comment_id":309067,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629914462","product_id":100078401,"comment_content":"çœ‹ä¸æ‡‚ä»£ç ï¼Œåªèƒ½çœ‹ä»£ç æ³¨é‡Šäº†ï¼","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525731,"discussion_content":"å“ˆå“ˆ è¿™æ²¡æœ‰é—®é¢˜å…ˆä»æ³¨é‡Šå¼€å§‹çœ‹èµ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629939625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308974,"user_name":"å››å–œ","can_delete":false,"product_type":"c1","uid":1071389,"ip_address":"","ucode":"C5EBED19C0F332","user_header":"https://static001.geekbang.org/account/avatar/00/10/59/1d/c89abcd8.jpg","comment_is_top":false,"comment_ctime":1629877207,"is_pvip":false,"replies":[{"id":"111874","content":"æœ‰äº›æ˜¯ï¼Œæœ‰äº›ä¸æ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1629939894,"ip_address":"","comment_id":308974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629877207","product_id":100078401,"comment_content":"é«˜çº§ç¼–ç¨‹è¯­è¨€çš„é”å’Œä¿¡å·é‡ç­‰æ¥å£ï¼Œæ˜¯è°ƒç”¨ç³»ç»Ÿåº•å±‚æä¾›çš„è¿™äº›æ¥å£å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525698,"discussion_content":"æœ‰äº›æ˜¯ï¼Œæœ‰äº›ä¸æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629939894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301734,"user_name":"å´å›½è±ª","can_delete":false,"product_type":"c1","uid":2635606,"ip_address":"","ucode":"0899104FDC2C97","user_header":"https://static001.geekbang.org/account/avatar/00/28/37/56/3a527963.jpg","comment_is_top":false,"comment_ctime":1625824550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625824550","product_id":100078401,"comment_content":"&quot;2:\\t&quot; \\ &quot;cmpb $0,%0\\n\\t&quot; \\ &#47;&#47;å’Œ0æ¯”è¾ƒ <br>&quot;rep;nop\\n\\t&quot; \\ &#47;&#47;ç©ºæŒ‡ä»¤ <br>&quot;jle 2b\\n\\t&quot; \\ &#47;&#47;å°äºæˆ–ç­‰äº0è·³è½¬åˆ°æ ‡å·2<br>è¿™é‡Œæœ€å¼€å§‹åŸå­å‡1ï¼Œå¦‚æœå°äº0ï¼Œä¹Ÿå°±æ˜¯åˆ«çš„è¿›ç¨‹æ‹¿åˆ°é”çš„æƒ…å†µï¼Œé‚£åˆ«çš„è¿›ç¨‹è¿˜é”åï¼Œåº”è¯¥æ˜¯0å§ã€‚æ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯åˆ¤æ–­æ˜¯å¦å°äº0ï¼Œè€Œä¸æ˜¯å°äºç­‰äº0ï¼Ÿ","like_count":0},{"had_liked":false,"id":301730,"user_name":"å´å›½è±ª","can_delete":false,"product_type":"c1","uid":2635606,"ip_address":"","ucode":"0899104FDC2C97","user_header":"https://static001.geekbang.org/account/avatar/00/28/37/56/3a527963.jpg","comment_is_top":false,"comment_ctime":1625824202,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625824202","product_id":100078401,"comment_content":"&quot;js 2f\\n&quot; \\ &#47;&#47;å½“ç»“æœå°äº0åˆ™è·³è½¬åˆ°æ ‡å·2å¤„ï¼Œè¡¨ç¤ºåŠ é”å¤±è´¥ <br>&quot;.section .text.lock,\\&quot;ax\\&quot;\\n&quot;<br><br>è¿™é‡Œå¦‚æœç»“æœå¤§äº0ï¼Œæ˜¯ä¸æ˜¯æ‰§è¡Œå®Œç¬¬äºŒè¡Œå°±ç»“æŸäº†ï¼Œä¸ä¼šå†è¿›æ ‡å·2äº†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":301245,"user_name":"å´å›½è±ª","can_delete":false,"product_type":"c1","uid":2635606,"ip_address":"","ucode":"0899104FDC2C97","user_header":"https://static001.geekbang.org/account/avatar/00/28/37/56/3a527963.jpg","comment_is_top":false,"comment_ctime":1625587809,"is_pvip":false,"replies":[{"id":"109106","content":"ä¸ä¼šçš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1625625655,"ip_address":"","comment_id":301245,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625587809","product_id":100078401,"comment_content":"Linux æ’é˜Ÿè‡ªæ—‹é”çš„éƒ¨åˆ†ï¼Œæ˜¯æ€ä¹ˆä¿è¯ä»è¯»slockï¼Œåˆ¤æ–­ï¼Œå†™slockçš„è¿‡ç¨‹æ˜¯åŸå­çš„å‘¢ï¼Ÿæˆ‘çœ‹å¥½åƒåˆ†äº†å¾ˆå¤šè¡Œæ±‡ç¼–ã€‚æœ‰æ²¡æœ‰å¯èƒ½ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¯»ï¼Œç„¶ååˆ¤æ–­æˆåŠŸï¼Œå†å†™å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522940,"discussion_content":"ä¸ä¼šçš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625625655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300432,"user_name":"é’ç‰ç™½éœ²","can_delete":false,"product_type":"c1","uid":2619436,"ip_address":"","ucode":"96FE2D4D2B94A0","user_header":"https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg","comment_is_top":false,"comment_ctime":1625152344,"is_pvip":false,"replies":[{"id":"108888","content":"é˜Ÿåˆ—æ˜¯æœ‰ä»£ä»·çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1625190386,"ip_address":"","comment_id":300432,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1625152344","product_id":100078401,"comment_content":"ä»æµç¨‹ä¸Šæ¥çœ‹ï¼Œè¯»é”æœ€å¤§ä¸º0x01000000ï¼›<br>ç”±äºè¯»å†™é”äº’æ–¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¯»ï¼Œå…¶ä»–å†™éƒ½æ— æ³•ï¼Œåªèƒ½è‡ªæ—‹ï¼Œæµªè´¹èµ„æºï¼Œå¯ä»¥è€ƒè™‘ç»™å†™é”åŠ é˜Ÿåˆ—ï¼Œé¿å…è‡ªæ—‹ã€‚<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522731,"discussion_content":"é˜Ÿåˆ—æ˜¯æœ‰ä»£ä»·çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625190386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1466121,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","nickname":"Qfeng","note":"","ucode":"1248E70012BBA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":558866,"discussion_content":"è€å¸ˆï¼Œé˜Ÿåˆ—çš„ä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648516209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":522731,"ip_address":""},"score":558866,"extra":""}]}]},{"had_liked":false,"id":299672,"user_name":"PawN","can_delete":false,"product_type":"c1","uid":1234005,"ip_address":"","ucode":"D0678E699327DE","user_header":"https://static001.geekbang.org/account/avatar/00/12/d4/55/a5ec04f4.jpg","comment_is_top":false,"comment_ctime":1624788785,"is_pvip":false,"replies":[{"id":"108697","content":"å–®æ ¸ä¸‹ åŒä¸€æ™‚åˆ» åªæœ‰ä¸€å€‹é€²ç¨‹è¿è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1624844404,"ip_address":"","comment_id":299672,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1624788785","product_id":100078401,"comment_content":"æœ‰ä¸€ç‚¹æ²¡å¤ªç†è§£ï¼Œ æ˜¯åœ¨å¤šæ ¸ çš„æ—¶å€™éœ€è¦é”æ€»çº¿å¹¶ä¸”å…³ä¸­æ–­å—ï¼Œ å•æ ¸åªéœ€è¦å…³ä¸­æ–­å°±å¥½äº† ã€‚ å…³ä¸­æ–­æ—¶å…³å½“å‰è¿›ç¨‹çš„ä¸­æ–­ï¼Œè¿˜æ˜¯æ‰€æœ‰è¿›ç¨‹çš„ä¸­æ–­éƒ½å…³å‘¢","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522503,"discussion_content":"å–®æ ¸ä¸‹ åŒä¸€æ™‚åˆ» åªæœ‰ä¸€å€‹é€²ç¨‹è¿è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624844404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1466121,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","nickname":"Qfeng","note":"","ucode":"1248E70012BBA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558869,"discussion_content":"å…³ä¸­æ–­æˆ‘ç†è§£åªèƒ½å…³å½“å‰CPUçš„ä¸­æ–­ã€‚ä¸€ä¸ªæ ¸ä¸Šè·‘çš„è¿›ç¨‹ä¸èƒ½å…³å¦ä¸€ä¸ªæ ¸çš„ä¸­æ–­çš„ã€‚ç›®å‰Linuxä¸Šçš„å…³ä¸­æ–­æ˜¯è¿™ä¹ˆå®ç°çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648516358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400737,"discussion_content":"åœ¨å¤šæ ¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„CPUéƒ½éœ€è¦å…³ä¸­æ–­å—ï¼Ÿè¿˜æ˜¯åªæœ‰æœ¬è¿›ç¨‹çš„CPUå…³ä¸­æ–­ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633402664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1927222,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/68/36/478194f3.jpg","nickname":"Shawn Duan","note":"","ucode":"628BAD6473FBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400736,"discussion_content":"å•æ ¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…³ä¸­æ–­ï¼ŒæŠ¢å å¼è°ƒåº¦æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å¯èƒ½æœ‰é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹å»æŠ¢å CPUï¼Œç„¶åé€ æˆå¤šè¿›ç¨‹è®¿é—®è¿™ä¸ªä¿æŠ¤æ®µçš„æƒ…å†µå—ï¼Ÿå¦‚æœä¸èƒ½æŠ¢å ï¼Œæ˜¯å¦‚ä½•ä¿è¯çš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633402599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295640,"user_name":"Freddy","can_delete":false,"product_type":"c1","uid":1708412,"ip_address":"","ucode":"5822B746265DB4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/11/7c/bf5049b3.jpg","comment_is_top":false,"comment_ctime":1622526609,"is_pvip":false,"replies":[{"id":"107614","content":"å˜¿å˜¿ æ˜¯çš„å‘¢","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622990015,"ip_address":"","comment_id":295640,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622526609","product_id":100078401,"comment_content":"Linuxçš„è¯»å†™é”æ”¯æŒ0x01000000 = 16777216ä¸ªè¿›ç¨‹å¹¶å‘è¯»å–å…±äº«æ•°æ®ï¼›<br>Linuxçš„è¯»å†™é”æœ¬è´¨ä¸Šæ˜¯è‡ªæ—‹é”ï¼Œè¿›ç¨‹æ²¡æœ‰æˆåŠŸè·å–åˆ°è¯»é”æˆ–è€…å†™é”æ—¶ï¼Œä¼šè¿›è¡Œè‡ªæ—‹ï¼Œæµªè´¹äº†CPUèµ„æºï¼›","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521166,"discussion_content":"å˜¿å˜¿ æ˜¯çš„å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622990015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295517,"user_name":"äºŒä¸‰å­ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1622458673,"is_pvip":false,"replies":[{"id":"107256","content":"æ˜¯å…ˆäº¤æ¢","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622469106,"ip_address":"","comment_id":295517,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1622458673","product_id":100078401,"comment_content":"&quot;lock ; xaddl %0, %1\\n&quot; &#47;&#47;å°†incå’Œslockäº¤æ¢ï¼Œç„¶å inc=inc+slock<br>è€å¸ˆï¼Œè¿™ä¸ªæ˜¯ä¸æ˜¯åº”è¯¥æ˜¯slock=slock+incï¼Ÿ<br>ä¸ç„¶ç¬¬ä¸€ä¸ªç”³è¯·çš„çº¿ç¨‹åŠ ä¸ä¸Šé”å•Šï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521113,"discussion_content":"æ˜¯å…ˆäº¤æ¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622469106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1245787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","nickname":"äºŒä¸‰å­ä¹Ÿ","note":"","ucode":"69C7D86583277D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377057,"discussion_content":"æ˜¯å…ˆäº¤æ¢ç„¶åç›¸åŠ ã€‚ä½†æ˜¯ç›¸åŠ çš„ç»“æœåº”è¯¥æ˜¯èµ‹å€¼ç»™slockè€Œä¸æ˜¯incå§ã€‚\nå‡è®¾ç¬¬ä¸€ä¸ªçº¿ç¨‹ç”³è¯·é”\nå¦‚æœæ˜¯inc=inc+slockçš„è¯\nxaddlæ‰§è¡Œä¹‹å‰\nincæ˜¯0x00010000 slockæ˜¯0x00000000\nxaddlæ‰§è¡Œä¹‹å\ninc=0x00010000 slockæ˜¯0x00010000\nincçš„é«˜ä½å’Œä½ä½ä¸ç›¸ç­‰å•Šã€‚ç¬¬ä¸€æ¬¡é”ä¸ä¸Šå•Š","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1622472913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1478242,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8e/62/435148c1.jpg","nickname":"SinKitwah","note":"","ucode":"BC39A39E17C95E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393669,"discussion_content":"è¿™ä¸ªæˆ‘ä¹Ÿçœ‹äº†å¾ˆä¹…ï¼Œæˆ‘åœ¨æƒ³æ˜¯ä¸æ˜¯å†™åäº†ã€‚åº”è¯¥æ˜¯äº¤æ¢åï¼Œslockï¼slock + incå§ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631540934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323341,"avatar":"https://static001.geekbang.org/account/avatar/00/14/31/4d/ea8ac77c.jpg","nickname":"ä¼Ÿä»”_Hoo","note":"","ucode":"74945AEE48DD62","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387428,"discussion_content":"æ˜¯å•Šï¼Œæˆ‘ä¹Ÿçœ‹äº†å¾ˆä¹…ï¼Œç¬¬ä¸€æ¬¡ä¼šåŠ ä¸ä¸Šé”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628163373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2718584,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9YwnzDGnOqlriaMaNXtY8R9b8QpgmnYP9xEBWWy1iaUwdTkiaNHPiajNlB7UKbXHovxkad0oRDEsCDg/132","nickname":"Geek_237cef","note":"","ucode":"06D84FC4A4FF2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537555,"discussion_content":"åº”è¯¥æ˜¯ç¬”è¯¯äº†ï¼Œåº”è¯¥æ˜¯slock=slock+inc,è¿™æ ·ç¨‹åºå°±ç¬¦åˆé€»è¾‘äº†ï¼Œç¡®ä¿æ¯æ¬¡åŠ é”åslockçš„nextéƒ¨åˆ†å¢1ï¼ŒåŒæ—¶åŠ é”å‰çš„nextå€¼æ­£å¸¸ç»™åˆ°incï¼Œè€å¸ˆèƒ½ç¡®è®¤ä¸‹å¦ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639102187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295421,"user_name":"è‹å¿—è¾‰","can_delete":false,"product_type":"c1","uid":1068927,"ip_address":"","ucode":"39B25CE21C04EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg","comment_is_top":false,"comment_ctime":1622426512,"is_pvip":false,"replies":[{"id":"107262","content":"å—¯å—¯ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622469442,"ip_address":"","comment_id":295421,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1622426512","product_id":100078401,"comment_content":"&quot;addl $0x00010000, %1\\n\\t&quot;&#47;&#47;ç›¸å½“äºnext+1<br>    &quot;lock ; cmpxchgl %1,%2\\n\\t&quot;&#47;&#47;newå’Œslockäº¤æ¢æ¯”è¾ƒ    <br>è€å¸ˆï¼Œè¿™ä¸¤å¥å¯ä»¥ç»†è®²ä¸€ä¸‹å—ï¼Ÿ<br>æ˜¯slockå’Œè°æ¯”è¾ƒï¼Œå¦‚æœæˆåŠŸæ˜¯æŠŠnewç»™slockå—","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521073,"discussion_content":"å—¯å—¯ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622469442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2635606,"avatar":"https://static001.geekbang.org/account/avatar/00/28/37/56/3a527963.jpg","nickname":"å´å›½è±ª","note":"","ucode":"0899104FDC2C97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382482,"discussion_content":"slockå’Œè°æ¯”è¾ƒå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625589425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295095,"user_name":"æ›¾æ³½æµ©","can_delete":false,"product_type":"c1","uid":1104601,"ip_address":"","ucode":"A7E5CF9E1571A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","comment_is_top":false,"comment_ctime":1622221930,"is_pvip":false,"replies":[{"id":"107290","content":"å¾—çœ‹æ“ä½œç³»ç»Ÿ æ˜¯ æ€ä¹ˆ å¤„ç†çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622472627,"ip_address":"","comment_id":295095,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1622221930","product_id":100078401,"comment_content":"è€å¸ˆï¼Œè¯´è¯´æˆ‘è¿™èŠ‚è¯¾çš„ç†è§£å’Œé—®é¢˜ã€‚<br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè‡ªæ—‹é”åœ¨è·å–ä¸åˆ°é”çš„æ—¶å€™ï¼Œè¯¥è¿›ç¨‹æ‰€åœ¨çš„CPUä¸€ç›´åœ¨ç©ºè½¬ã€‚é‚£å¦‚æœæ˜¯8æ ¸çš„CPUï¼Œå¦‚æœæ˜¯99ä¸ªè¿›ç¨‹ç«äº‰è¿™æŠŠè‡ªæ—‹é”ï¼Œç†è®ºä¸Šæ˜¯åªæœ‰8ä¸ªè¿›ç¨‹å¤„äºè‡ªæ—‹ç­‰å¾…ï¼Œå…¶ä»–çš„è¿›ç¨‹ç­‰å¾…è¢«è°ƒåº¦ã€‚é‚£æ˜¯ä¸æ˜¯è¯´å¤„äºè‡ªæ—‹ç­‰å¾…çš„è¿›ç¨‹ï¼Œæ—¶é—´ç‰‡ç”¨å®Œä¹Ÿä¼šè¢«æŒ‚èµ·çš„ï¼Ÿ<br><br><br>","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520948,"discussion_content":"å¾—çœ‹æ“ä½œç³»ç»Ÿ æ˜¯ æ€ä¹ˆ å¤„ç†çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2834444,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/40/0c/19b4224a.jpg","nickname":"ä¸å†™å‡ºæ“ä½œç³»ç»Ÿä¸æ”¹å","note":"","ucode":"DD40D98250B688","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412570,"discussion_content":"ç¬¬1ä¸ªæ ¸è·å–è‡ªæ—‹é”è¿›å…¥ä¸´ç•ŒåŒºï¼Œç„¶ååé¢çš„2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8å·coreéƒ½ä¼šåŸåœ°è‡ªæ—‹ç­‰å¾…æœ‰å¯ç”¨çš„è‡ªæ—‹é”ï¼Œæ˜¯ä¸ä¼šè¿›å…¥æŒ‚èµ·çŠ¶æ€çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636210289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295094,"user_name":"æ›¾æ³½æµ©","can_delete":false,"product_type":"c1","uid":1104601,"ip_address":"","ucode":"A7E5CF9E1571A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","comment_is_top":false,"comment_ctime":1622220047,"is_pvip":false,"replies":[{"id":"107291","content":"å—¯å—¯","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622472649,"ip_address":"","comment_id":295094,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622220047","product_id":100078401,"comment_content":"è€å¸ˆï¼Œå…³äºè¯»å†™é”çš„ç–‘é—®ï¼Œå¦‚æœè·å–ä¸åˆ°å†™é”æ—¶ï¼Œæ­¤æ—¶è¯¥è¿›ç¨‹ä¸€ç›´åœ¨ç­‰å¾…ï¼Œä¹Ÿå°±æ„å‘³ç€CPUä¸€ç›´åœ¨ç©ºè½¬å—ï¼Ÿè¿˜æ˜¯è¯¥è¿›ç¨‹è¢«æŒ‚èµ·äº†ï¼Œç­‰ç€CPUçš„è°ƒåº¦å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520947,"discussion_content":"å—¯å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295085,"user_name":"é™ç”±å¿ƒç„¶","can_delete":false,"product_type":"c1","uid":2631261,"ip_address":"","ucode":"E48AD41CD96F09","user_header":"https://static001.geekbang.org/account/avatar/00/28/26/5d/eeaa7df0.jpg","comment_is_top":false,"comment_ctime":1622212726,"is_pvip":false,"replies":[{"id":"107293","content":"è¿™æ˜¯è¯´æ˜è·å–è¯»å†™é”çš„å…ˆåæ¬¡åºé—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622472769,"ip_address":"","comment_id":295085,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622212726","product_id":100078401,"comment_content":"å¦‚æœå¤šä¸ªè¿›ç¨‹è·å¾—å…±äº«è¯»å–é”çš„è¯ï¼Œé‚£ä¹ˆè¿›è¡Œå†™çš„æ“ä½œè¿›ç¨‹å°†è¦ç­‰å¾…æ‰€æœ‰è¯»å–å…±äº«å®Œæˆã€‚å»¶è¿Ÿæ•°æ®æ›´æ–°ï¼Œå³ä½¿æ˜¯å†™æ“ä½œæ‹¥æœ‰å¾ˆé«˜çš„ä¼˜å…ˆçº§çš„è¯ï¼Œä¹Ÿå¯èƒ½ç­‰å¾…æ‰€æœ‰è¯»å…±äº«å®Œæˆï¼Œä¼˜å…ˆçº§åè½¬ï¼Ÿå¦å¤–å½“è¯»å’Œå†™åŠ é”å‡ºç°ç«æ€çš„æ—¶å€™ï¼Œå†…æ ¸å¦‚ä½•å®ç°å†™é”ä¼˜å…ˆåŠ é”ï¼Ÿä¸æ˜¯çœ‹çš„å¾ˆæ˜ç™½ã€‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520943,"discussion_content":"è¿™æ˜¯è¯´æ˜è·å–è¯»å†™é”çš„å…ˆåæ¬¡åºé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295081,"user_name":"LDxy","can_delete":false,"product_type":"c1","uid":1188710,"ip_address":"","ucode":"956432CE7B7761","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/66/413c0bb5.jpg","comment_is_top":false,"comment_ctime":1622211458,"is_pvip":false,"replies":[{"id":"107294","content":"ä½ äº†è§£ä¸€ä¸‹ é“¶è¡Œå®¶ç®—æ³• ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622472799,"ip_address":"","comment_id":295081,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622211458","product_id":100078401,"comment_content":"è€å¸ˆï¼Œèƒ½ä¸èƒ½è®²ä¸‹æ­»é”æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿåœ¨å®é™…å¼€å‘ä¸­ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜å—ï¼Ÿå¦‚æœé‡åˆ°äº†è¯¥æ€ä¹ˆå®šä½é—®é¢˜æ˜¯å‡ºåœ¨å“ªï¼Ÿå¦‚ä½•é¿å…æ­»é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520941,"discussion_content":"ä½ äº†è§£ä¸€ä¸‹ é“¶è¡Œå®¶ç®—æ³• ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622472799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294948,"user_name":"Rush Hour","can_delete":false,"product_type":"c1","uid":1687584,"ip_address":"","ucode":"73ED20FABF63E6","user_header":"https://static001.geekbang.org/account/avatar/00/19/c0/20/db1e7f5b.jpg","comment_is_top":false,"comment_ctime":1622163899,"is_pvip":false,"replies":[{"id":"107304","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622473425,"ip_address":"","comment_id":294948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622163899","product_id":100078401,"comment_content":"åˆå§‹å€¼æ˜¯ 0x01000000ï¼Œä»£è¡¨å¯ä»¥æ¥å—çš„å…±äº«æ•°æ®çš„è¿›ç¨‹ä¸ªæ•°ã€‚ä¸è¶³ä¹‹å¤„åœ¨äºä¼šå¯¼è‡´è¯»é”ä¸æ–­æœ‰è¿›ç¨‹è·å–ï¼Œå†™é”ä¼šè¢«é¥¿æ­»ã€‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520890,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294947,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1622163761,"is_pvip":false,"replies":[{"id":"107305","content":"ä¸ç”¨ï¼Œäº†è§£ä¸€ä¸‹å°±è¡Œäº† ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1622473462,"ip_address":"","comment_id":294947,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1622163761","product_id":100078401,"comment_content":"è¿˜è¯·æ•™è€å¸ˆå’Œå„ä½ç«¥é‹ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹ç€å†…æ ¸é‡Œå„ç§é”å®ç°å‡½æ•°é‡Œçš„æ±‡ç¼–ä»£ç å¤´å¤§ï¼Œè¿™ä¸ªæ˜¯çœ‹åˆ°ä»€ä¹ˆæŒ‡ä»¤å»æŸ¥ä¸€éè¿˜æ˜¯å…ˆç³»ç»Ÿçš„å­¦ä¹ éï¼Œæœ¬äººå­¦ä¹ è¿‡ä¸€éç‹çˆ½çš„x86æ±‡ç¼–ï¼Œè¿™é‡Œçœ‹ç€é™Œç”Ÿçš„æŒ‡ä»¤è¿˜æ˜¯å¤´å¤§","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520889,"discussion_content":"ä¸ç”¨ï¼Œäº†è§£ä¸€ä¸‹å°±è¡Œäº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622473462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376535,"discussion_content":"å…ˆçœ‹å®Œï¼Œå†æŒ‰éœ€è¡¥ç»†èŠ‚å§ã€‚ä¸ç„¶æ²¡å•ƒå®Œæ±‡ç¼–ï¼Œåˆæƒ³æ”¾å¼ƒäº†å“ˆå“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622180989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294937,"user_name":"å°¼æ¬§","can_delete":false,"product_type":"c1","uid":1260883,"ip_address":"","ucode":"39D4D1F5F51764","user_header":"https://static001.geekbang.org/account/avatar/00/13/3d/53/9d8a1207.jpg","comment_is_top":false,"comment_ctime":1622160846,"is_pvip":false,"replies":[{"id":"107072","content":"è·Ÿç€æ›´æ–°æ­¥ä¼åŒæ­¥æ‰“å¡å‘€ï¼Œä»Šå¤©æ”¶è·å¦‚ä½•æ¬¢è¿åˆ†äº«ï¼Œè¿˜æœ‰ç»§ç»­åŠ æ²¹ã€‚","user_name":"ç¼–è¾‘å›å¤","user_name_real":"èµµå®‡æ–°","uid":"1501385","ctime":1622170570,"ip_address":"","comment_id":294937,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1622160846","product_id":100078401,"comment_content":"æ‰“å¡","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520881,"discussion_content":"è·Ÿç€æ›´æ–°æ­¥ä¼åŒæ­¥æ‰“å¡å‘€ï¼Œä»Šå¤©æ”¶è·å¦‚ä½•æ¬¢è¿åˆ†äº«ï¼Œè¿˜æœ‰ç»§ç»­åŠ æ²¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622170570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]}]}