{"id":422400,"title":"08 | å†…å­˜ç®¡ç†ï¼šSparkå¦‚ä½•ä½¿ç”¨å†…å­˜ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/420399\">ç¬¬6è®²</a>ï¼Œæˆ‘ä»¬æ‹œè®¿äº†æ–¯å·´å…‹å»ºç­‘é›†å›¢çš„åˆ†å…¬å¸ï¼Œç†Ÿæ‚‰äº†åˆ†å…¬å¸çš„åŠå…¬ç¯å¢ƒä¸äººå‘˜é…ç½®ï¼ŒåŒæ—¶ç”¨â€œå·¥åœ°æ¬ç –çš„ä»»åŠ¡â€ä½œç±»æ¯”ï¼Œä»‹ç»äº†Spark Shuffleçš„å·¥ä½œåŸç†ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å†æ¬¡æ¥åˆ°åˆ†å…¬å¸ï¼Œå»çœ‹çœ‹æ–¯å·´å…‹å…¬å¸éƒ½åœ¨æ‰¿æ¥å“ªäº›å»ºç­‘é¡¹ç›®ï¼Œä»¥åŠè¿™äº›é¡¹ç›®æ˜¯å¦‚ä½•æ–½å·¥çš„ã€‚é€šè¿‡ç†Ÿæ‚‰é¡¹ç›®çš„æ–½å·¥è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ Sparkçš„å†…å­˜ç®¡ç†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2f/63/2fe7ba37365ca1b0da67f83eb859f663.jpg?wh=1920x1016\" alt=\"å›¾ç‰‡\" title=\"æ–¯å·´å…‹å»ºç­‘é›†å›¢åˆ†å…¬å¸\"></p><p>ç›¸æ¯”å…¶ä»–å¤§æ•°æ®è®¡ç®—å¼•æ“ï¼Œå…³äºSparkçš„ç‰¹æ€§ä¸ä¼˜åŠ¿ï¼Œæƒ³å¿…ä½ å¬åˆ°æœ€å¤šçš„å­—çœ¼ï¼Œå°±æ˜¯â€œå†…å­˜è®¡ç®—â€ã€‚<strong>åˆç†è€Œåˆå……åˆ†åœ°åˆ©ç”¨å†…å­˜èµ„æº</strong>ï¼Œæ˜¯Sparkçš„æ ¸å¿ƒç«äº‰åŠ›ä¹‹ä¸€ã€‚å› æ­¤ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¼„æ¸…æ¥šSparkæ˜¯å¦‚ä½•ä½¿ç”¨å†…å­˜çš„ï¼Œå°±å˜å¾—éå¸¸é‡è¦ã€‚</p><p>å¥½å•¦ï¼Œé—²è¨€å°‘å™ï¼Œè¯·ä½ æˆ´å¥½å®‰å…¨å¸½ï¼Œè·Ÿæˆ‘ä¸€èµ·å†æ¬¡å»æ‹œè®¿æ–¯å·´å…‹é›†å›¢åˆ†å…¬å¸å§ã€‚ä¸è¿‡ï¼Œåœ¨æ­£å¼â€œæ‹œè®¿â€ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€é¡¹å‡†å¤‡å·¥ä½œè¦åšï¼Œé‚£å°±æ˜¯å…ˆäº†è§£æ¸…æ¥šSparkçš„å†…å­˜åŒºåŸŸæ˜¯æ€æ ·åˆ’åˆ†çš„ã€‚</p><h2>Sparkå†…å­˜åŒºåŸŸåˆ’åˆ†</h2><p>å¯¹äºä»»æ„ä¸€ä¸ªExecutoræ¥è¯´ï¼ŒSparkä¼šæŠŠå†…å­˜åˆ†ä¸º4ä¸ªåŒºåŸŸï¼Œåˆ†åˆ«æ˜¯Reserved Memoryã€User Memoryã€Execution Memoryå’ŒStorage Memoryã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/7b/c317aa36c594b6ccc93a8a65b5bcf57b.jpg?wh=1920x1010\" alt=\"å›¾ç‰‡\" title=\"Sparkå†…å­˜åŒºåŸŸåˆ’åˆ†\"></p><p>å…¶ä¸­ï¼ŒReserved Memoryå›ºå®šä¸º300MBï¼Œä¸å—å¼€å‘è€…æ§åˆ¶ï¼Œå®ƒæ˜¯Sparké¢„ç•™çš„ã€ç”¨æ¥å­˜å‚¨å„ç§ Spark å†…éƒ¨å¯¹è±¡çš„å†…å­˜åŒºåŸŸï¼›User Memoryç”¨äºå­˜å‚¨å¼€å‘è€…è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚RDDç®—å­ä¸­å¼•ç”¨çš„æ•°ç»„ã€åˆ—è¡¨ã€æ˜ å°„ç­‰ç­‰ã€‚</p><!-- [[[read_end]]] --><p>Execution Memoryç”¨æ¥æ‰§è¡Œåˆ†å¸ƒå¼ä»»åŠ¡ã€‚åˆ†å¸ƒå¼ä»»åŠ¡çš„è®¡ç®—ï¼Œä¸»è¦åŒ…æ‹¬æ•°æ®çš„è½¬æ¢ã€è¿‡æ»¤ã€æ˜ å°„ã€æ’åºã€èšåˆã€å½’å¹¶ç­‰ç¯èŠ‚ï¼Œè€Œè¿™äº›è®¡ç®—ç¯èŠ‚çš„å†…å­˜æ¶ˆè€—ï¼Œç»Ÿç»Ÿæ¥è‡ªäºExecution Memoryã€‚</p><p>Storage Memoryç”¨äºç¼“å­˜åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ¯”å¦‚RDD Cacheã€å¹¿æ’­å˜é‡ç­‰ç­‰ã€‚å…³äºå¹¿æ’­å˜é‡çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬ç•™åˆ°ç¬¬10è®²å†å»å±•å¼€ã€‚RDD CacheæŒ‡çš„æ˜¯RDDç‰©åŒ–åˆ°å†…å­˜ä¸­çš„å‰¯æœ¬ã€‚åœ¨ä¸€ä¸ªè¾ƒé•¿çš„DAGä¸­ï¼Œå¦‚æœåŒä¸€ä¸ªRDDè¢«å¼•ç”¨å¤šæ¬¡ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªRDDç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¾€å¾€ä¼šå¤§å¹…æå‡ä½œä¸šçš„æ‰§è¡Œæ€§èƒ½ã€‚æˆ‘ä»¬åœ¨è¿™èŠ‚è¯¾çš„æœ€åä¼šä»‹ç»RDD Cacheçš„å…·ä½“ç”¨æ³•ã€‚</p><p>ä¸éš¾å‘ç°ï¼ŒExecution Memoryå’ŒStorage Memoryè¿™ä¸¤å—å†…å­˜åŒºåŸŸï¼Œå¯¹äºSparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½èµ·ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚å› æ­¤ï¼Œ<strong>åœ¨æ‰€æœ‰çš„å†…å­˜åŒºåŸŸä¸­ï¼ŒExecution Memoryå’ŒStorage Memoryæ˜¯æœ€é‡è¦çš„ï¼Œä¹Ÿæ˜¯å¼€å‘è€…æœ€éœ€è¦å…³æ³¨çš„</strong>ã€‚</p><p>åœ¨ Spark 1.6 ç‰ˆæœ¬ä¹‹å‰ï¼ŒExecution Memory å’Œ Storage Memoryçš„ç©ºé—´åˆ’åˆ†æ˜¯é™æ€çš„ï¼Œä¸€æ—¦ç©ºé—´åˆ’åˆ†å®Œæ¯•ï¼Œä¸åŒå†…å­˜åŒºåŸŸçš„ç”¨é€”ä¸å°ºå¯¸å°±å›ºå®šäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿ä½ æ²¡æœ‰ç¼“å­˜ä»»ä½• RDD æˆ–æ˜¯å¹¿æ’­å˜é‡ï¼ŒStorage Memory åŒºåŸŸçš„ç©ºé—²å†…å­˜ä¹Ÿä¸èƒ½ç”¨æ¥æ‰§è¡Œæ˜ å°„ã€æ’åºæˆ–èšåˆç­‰è®¡ç®—ä»»åŠ¡ï¼Œå®è´µçš„å†…å­˜èµ„æºå°±è¿™ä¹ˆç™½ç™½åœ°æµªè´¹æ‰äº†ã€‚</p><p>è€ƒè™‘åˆ°é™æ€å†…å­˜åˆ’åˆ†çš„å¼Šç«¯ï¼Œåœ¨ 1.6 ç‰ˆæœ¬ä¹‹åï¼ŒSpark æ¨å‡ºäº†<strong>ç»Ÿä¸€å†…å­˜ç®¡ç†æ¨¡å¼</strong>ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒExecution Memory å’Œ Storage Memory ä¹‹é—´å¯ä»¥ç›¸äº’è½¬åŒ–ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·èµ°è¿›æ–¯å·´å…‹é›†å›¢åˆ†å…¬å¸ï¼Œçœ‹çœ‹ä¸åŒå†…å­˜åŒºåŸŸç›¸äº’è½¬åŒ–çš„é€»è¾‘ã€‚</p><h2>ä¸åŒå†…å­˜åŒºåŸŸçš„ç›¸äº’è½¬åŒ–</h2><p>åˆšä¸€èµ°è¿›åˆ†å…¬å¸çš„å¤§é—¨ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°å·¥äººä»¬åœ¨å·¥åœ°ä¸Šå¦‚ç«å¦‚è¼çš„å¿™ç¢Œæ™¯è±¡ã€‚èµ°è¿‘ä¸€é—®ï¼Œæ‰çŸ¥é“ä»–ä»¬æ‰¿æ¥äº†ä¸€ä¸ªâ€œé›†è£…ç®±æ”¹è£…æ´»åŠ¨æˆ¿â€çš„å»ºç­‘é¡¹ç›®ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªé¡¹ç›®çš„å…·ä½“ä»»åŠ¡ï¼Œå°±æ˜¯æŠŠé›†è£…ç®±æ”¹è£…æˆæ´»åŠ¨æˆ¿ã€‚</p><p>æ´»åŠ¨æˆ¿çš„åˆ¶ä½œè¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œåªéœ€ä¸€ç³»åˆ—ç®€å•çš„æ­¥éª¤ï¼Œå°±èƒ½æŠŠé›†è£…ç®±æ”¹è£…ä¸ºå°å·§è€Œåˆåˆ«è‡´çš„æ´»åŠ¨æˆ¿ï¼Œè¿™äº›æ­¥éª¤åŒ…æ‹¬æ¸…æ´—ã€åˆ‡å‰²å¼€çª—ã€åˆ‡å‰²å¼€é—¨ã€åˆ·æ¼†ã€æ‰“éš”æ–­ã€å¸ƒç½®å®¶å±…ã€è£…é¥°ç‚¹ç¼€ã€‚æ´»åŠ¨æˆ¿çš„åˆ¶ä½œåœ¨å·¥åœ°ä¸Šå®Œæˆï¼ŒæˆåŠŸæ”¹è£…çš„æ´»åŠ¨æˆ¿ä¼šè¢«ç«‹å³æ‹‰èµ°ï¼Œç”±è´§è¿å¡è½¦è¿å¾€é›†å›¢å…¬å¸çš„ç‰©æµé›†æ•£åœ°ã€‚</p><p>å¥½äº†ï¼Œä»‹ç»å®Œé›†è£…ç®±æ”¹è£…æ´»åŠ¨æˆ¿çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¿…é¡»è¦äº¤ä»£ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ä¸Sparkä¹‹é—´çš„å…³è”å…³ç³»ã€‚æ¯•ç«Ÿï¼Œå†æœ‰è¶£çš„æ•…äº‹ï¼Œä¹Ÿæ˜¯ç”¨æ¥è¾…åŠ©å’±ä»¬æ›´å¥½åœ°å­¦ä¹ Sparkå˜›ã€‚</p><p>é¡¹ç›®ä¸­æ¶‰åŠçš„åŸææ–™ã€æ–½å·¥æ­¥éª¤ä¸Sparkä¹‹é—´çš„ç±»æ¯”å…³ç³»ï¼Œæˆ‘æŠŠå®ƒæ•´ç†åˆ°äº†ä¸‹é¢çš„è¿™å¼ è¡¨æ ¼ä¸­ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/ea/32/ea211abc37a691ea32bc0cd8b4608132.jpg?wh=1687x733\" alt=\"\" title=\"å»ºç­‘é¡¹ç›®ä¸Sparkçš„ç±»æ¯”\"></p><p>ä»è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé›†è£…ç®±ç›¸å½“äºæ˜¯RDDæ•°æ®æºï¼Œè€Œåˆ‡å‰²é—¨çª—ç­‰æ–½å·¥æ­¥éª¤ï¼Œå¯¹åº”çš„æ­£æ˜¯å„å¼å„æ ·çš„RDDç®—å­ã€‚è€Œå·¥åœ°ç”¨äºæä¾›æ–½å·¥åœºæ‰€ï¼Œè¿™ä¸è®¡ç®—èŠ‚ç‚¹å†…å­˜æä¾›æ•°æ®å¤„ç†åœºæ‰€çš„ä½œç”¨å¦‚å‡ºä¸€è¾™ã€‚è¿™ä¹ˆçœ‹ä¸‹æ¥ï¼Œé›†è£…ç®±æ”¹è£…æ´»åŠ¨æˆ¿çš„é¡¹ç›®ï¼Œå°±å¯ä»¥çœ‹ä½œæ˜¯Sparkä½œä¸šï¼Œæˆ–è€…è¯´æ˜¯Sparkåº”ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è€ƒå¯Ÿä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„æ–½å·¥è¿‡ç¨‹ã€‚èµ°è¿‘å·¥åœ°ï¼Œæˆ‘ä»¬å‘ç°å·¥åœ°ä¸Šèµ«ç„¶åˆ’ç€ä¸€æ¡çº¢è‰²çš„è™šçº¿ï¼ŒæŠŠå·¥åœ°ä¸€åˆ†ä¸ºäºŒã€‚è™šçº¿çš„å·¦ä¾§ï¼Œå †æ”¾ç€è‹¥å¹²æ²¾æ»¡æ³¥åœŸçš„é›†è£…ç®±ï¼Œè€Œå·¥åœ°çš„å³ä¾§ï¼Œåˆ™æ˜¯å·¥äººä»¬åœ¨é›†è£…ç®±ä¸Šå®å®å½“å½“åœ°åšç€æ”¹è£…ï¼Œæœ‰çš„é›†è£…ç®±å·²ç»å¼€å§‹å¸ƒç½®å®¶å±…ï¼Œæœ‰çš„è¿˜åœ¨åˆ‡å‰²é—¨çª—ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/c3/e05f61ef55a4fbe043756165a8b7e0c3.jpg?wh=1920x905\" alt=\"å›¾ç‰‡\" title=\"æ–½å·¥å·¥åœ°ç¤ºæ„å›¾\"></p><p>çœ‹åˆ°åœ°ä¸Šçš„çº¢çº¿ï¼Œæˆ‘ä»¬ä¸å…å¥½å¥‡ï¼Œèµ°è¿‘å‰å»é—®ï¼Œå·¥å¤´ä¸ºæˆ‘ä»¬é“æ¸…äº†åŸå§”ã€‚</p><p>æŒ‰ç†è¯´ï¼Œåƒé›†è£…ç®±ã€å®¶å…·è¿™äº›ç”Ÿäº§èµ„æ–™éƒ½åº”è¯¥æ”¾åœ¨ä¸´æ—¶ä»“åº“ï¼ˆèŠ‚ç‚¹ç¡¬ç›˜ï¼‰çš„ï¼Œå·¥åœ°ï¼ˆèŠ‚ç‚¹å†…å­˜ï¼‰åŸåˆ™ä¸Šåªç”¨æ¥è¿›è¡Œæ”¹è£…æ“ä½œã€‚ä¸è¿‡ï¼Œå·¥åœ°ç¦»ä¸´æ—¶ä»“åº“è¿˜æœ‰ä¸€æ®µè·ç¦»ï¼Œæ¥å›è¿è¾“ä¸å¤ªæ–¹ä¾¿ã€‚</p><p>ä¸ºäº†æå‡å·¥ä½œæ•ˆç‡ï¼Œå·¥åœ°è¢«åˆ’åˆ†æˆä¸¤ä¸ªåŒºåŸŸã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œçº¢çº¿å·¦è¾¹çš„é‚£å—åœ°å«ä½œæš‚å­˜åŒºï¼ˆStorage Memoryï¼‰ï¼Œä¸“é—¨ç”¨æ¥æš‚å­˜å»ºç­‘ææ–™ï¼›è€Œå³è¾¹çš„é‚£éƒ¨åˆ†å«ä½œæ“ä½œåŒºï¼ˆExecution Memoryï¼‰ï¼Œç”¨æ¥ç»™å·¥äººæ”¹è£…é›†è£…ç®±ã€åˆ¶ä½œæ´»åŠ¨æˆ¿ã€‚</p><p>ä¹‹æ‰€ä»¥ä½¿ç”¨è™šçº¿æ ‡è®°ï¼ŒåŸå› å°±åœ¨äºï¼Œä¸¤å—åŒºåŸŸçš„å°ºå¯¸å¤§å°å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œå½“ä¸€æ–¹åŒºåŸŸæœ‰ç©ºåœ°æ—¶ï¼Œå¦ä¸€æ–¹å¯ä»¥è¿›è¡ŒæŠ¢å ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾æ“ä½œåŒºåªæœ‰ä¸¤ä¸ªå·¥äººï¼ˆCPU çº¿ç¨‹ï¼‰åˆ†åˆ«åœ¨æ”¹è£…é›†è£…ç®±ï¼Œæ­¤æ—¶æ“ä½œåŒºç©ºå‡ºæ¥å¯ä»¥å®¹çº³ä¸¤ä¸ªç‰©ä»¶çš„ç©ºåœ°ï¼Œé‚£ä¹ˆè¿™ç‰‡ç©ºåœ°å°±å¯ä»¥æš‚æ—¶ç”¨æ¥å †æ”¾å»ºç­‘ææ–™ï¼Œæš‚å­˜åŒºä¹Ÿå› æ­¤å¾—åˆ°äº†å®è´¨æ€§çš„æ‰©å¼ ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/d3/b7a750da7c9a8dd7cedd25e4be4158d3.jpg?wh=1920x980\" alt=\"å›¾ç‰‡\" title=\"æŠ¢å æ¨¡å¼1ï¼šæš‚å­˜åŒºæŠ¢å æ“ä½œåŒº\"></p><p>ä¸è¿‡ï¼Œå½“æœ‰è¶³å¤Ÿçš„å·¥äººå¯ä»¥æ‰©å¤§ç”Ÿäº§çš„æ—¶å€™ï¼Œæ¯”å¦‚åœ¨åŸæœ‰ä¸¤ä¸ªå·¥äººåœ¨ä½œä¸šçš„åŸºç¡€ä¸Šï¼Œåˆæ¥äº†ä¸¤ä¸ªå·¥äººï¼Œæ­¤æ—¶å…±æœ‰4ä¸ªå·¥äººå¯ä»¥åŒæ—¶åˆ¶ä½œæ´»åŠ¨æˆ¿ï¼Œé‚£ä¹ˆçº¢è‰²è™šçº¿åˆ°è“è‰²å®çº¿ä¹‹é—´çš„ä»»ä½•ç‰©ä»¶ï¼ˆæ¯”å¦‚ä¸Šå›¾çš„æ²™å‘å’ŒåŒäººåºŠï¼‰ï¼Œéƒ½éœ€è¦è…¾å‡ºåˆ°ä¸´æ—¶ä»“åº“ï¼Œè…¾ç©ºçš„åŒºåŸŸäº¤ç»™æ–°æ¥çš„ä¸¤ä¸ªå·¥äººæ”¹è£…é›†è£…ç®±ã€‚æ¯•ç«Ÿï¼Œæ”¹è£…é›†è£…ç®±ã€åˆ¶ä½œæ´»åŠ¨æˆ¿ï¼Œæ‰æ˜¯é¡¹ç›®çš„æ ¸å¿ƒä»»åŠ¡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/43/90/43406416353168e2a6cb7f11c5440c90.jpg?wh=1920x896\" alt=\"å›¾ç‰‡\" title=\"æŠ¢å æ¨¡å¼2ï¼šæ“ä½œåŒºæŠ¢å æš‚å­˜åŒº\"></p><p>ç›¸åï¼Œå¦‚æœæš‚å­˜åŒºå †æ”¾çš„ç‰©ä»¶æ¯”è¾ƒå°‘ã€ç•™æœ‰ç©ºåœ°ï¼Œè€Œå·¥äººåˆæ¯”è¾ƒå……è£•ï¼Œæ¯”å¦‚æœ‰6ä¸ªå·¥äººå¯ä»¥åŒæ—¶è¿›è¡Œæ”¹è£…ï¼Œé‚£ä¹ˆæ­¤æ—¶æš‚å­˜åŒºçš„ç©ºåœ°å°±ä¼šè¢«æ“ä½œåŒºä¸´æ—¶å¾ç”¨ï¼Œç»™å·¥äººç”¨æ¥åˆ¶ä½œæ´»åŠ¨æˆ¿ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ“ä½œåŒºå®é™…ä¸Šä¹Ÿæ‰©å¤§äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/43/90/43406416353168e2a6cb7f11c5440c90.jpg?wh=1920x896\" alt=\"å›¾ç‰‡\" title=\"æŠ¢å æ¨¡å¼2ï¼šæ“ä½œåŒºæŠ¢å æš‚å­˜åŒº\"></p><p>å½“æœ‰æ›´å¤šçš„ç‰©ä»¶éœ€è¦å †æ”¾åˆ°æš‚å­˜åŒºçš„æ—¶å€™ï¼Œæ‰©å¼ çš„æ“ä½œåŒºç›¸åº”åœ°ä¹Ÿéœ€è¦æ”¶ç¼©åˆ°çº¢è‰²è™šçº¿çš„ä½ç½®ã€‚ä¸è¿‡ï¼Œå¯¹äºçº¢è‰²å®çº¿ä¸çº¢è‰²è™šçº¿ä¹‹é—´çš„åŒºåŸŸï¼Œæˆ‘ä»¬å¿…é¡»è¦ç­‰åˆ°å·¥äººä»¬æŠŠæ­£åœ¨æ”¹è£…çš„æ´»åŠ¨æˆ¿åˆ¶ä½œå®Œæ¯•ï¼ˆTask Completeï¼‰ï¼Œæ‰èƒ½æŠŠè¿™ç‰‡åŒºåŸŸå½’è¿˜ç»™æš‚å­˜åŒºã€‚</p><p>å¥½å•¦ï¼Œæ´»åŠ¨æˆ¿çš„é¡¹ç›®åˆ°è¿™é‡Œå°±ä»‹ç»å®Œäº†ã€‚ä¸éš¾å‘ç°ï¼Œæ“ä½œåŒºç±»æ¯”çš„æ˜¯ Execution Memoryï¼Œè€Œæš‚å­˜åŒºå…¶å®å°±æ˜¯ Storage Memoryã€‚Execution Memory å’Œ Storage Memory ä¹‹é—´çš„æŠ¢å è§„åˆ™ï¼Œä¸€å…±å¯ä»¥æ€»ç»“ä¸º 3 æ¡ï¼š</p><ul>\n<li>å¦‚æœå¯¹æ–¹çš„å†…å­˜ç©ºé—´æœ‰ç©ºé—²ï¼ŒåŒæ–¹å¯ä»¥äº’ç›¸æŠ¢å ï¼›</li>\n<li>å¯¹äºStorage MemoryæŠ¢å çš„Execution Memoryéƒ¨åˆ†ï¼Œå½“åˆ†å¸ƒå¼ä»»åŠ¡æœ‰è®¡ç®—éœ€è¦æ—¶ï¼ŒStorage Memoryå¿…é¡»ç«‹å³å½’è¿˜æŠ¢å çš„å†…å­˜ï¼Œæ¶‰åŠçš„ç¼“å­˜æ•°æ®è¦ä¹ˆè½ç›˜ã€è¦ä¹ˆæ¸…é™¤ï¼›</li>\n<li>å¯¹äºExecution MemoryæŠ¢å çš„Storage Memoryéƒ¨åˆ†ï¼Œå³ä¾¿Storage Memoryæœ‰æ”¶å›å†…å­˜çš„éœ€è¦ï¼Œä¹Ÿå¿…é¡»è¦ç­‰åˆ°åˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰èƒ½é‡Šæ”¾ã€‚</li>\n</ul><p>ä»‹ç»å®ŒExecution Memoryä¸Storage Memoryä¹‹é—´çš„æŠ¢å è§„åˆ™ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŒå†…å­˜åŒºåŸŸçš„åˆå§‹å¤§å°æ˜¯å¦‚ä½•è®¾ç½®çš„ã€‚</p><h2>å†…å­˜é…ç½®é¡¹</h2><p>æ€»ä½“æ¥è¯´ï¼ŒExecutor JVM Heapçš„åˆ’åˆ†ï¼Œç”±å›¾ä¸­çš„3ä¸ªé…ç½®é¡¹æ¥å†³å®šï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/f0/9c2fd81c42cdab915f9a388683602df0.jpg?wh=1920x737\" alt=\"å›¾ç‰‡\" title=\"å†…å­˜åŒºåŸŸç›¸å…³é…ç½®é¡¹\"></p><p>å…¶ä¸­spark.executor.memoryæ˜¯<strong>ç»å¯¹å€¼</strong>ï¼Œå®ƒæŒ‡å®šäº†Executorè¿›ç¨‹çš„<strong>JVM Heapæ€»å¤§å°</strong>ã€‚å¦å¤–ä¸¤ä¸ªé…ç½®é¡¹ï¼Œspark.memory.fractionå’Œspark.memory.storageFractionéƒ½æ˜¯<strong>æ¯”ä¾‹å€¼</strong>ï¼Œå®ƒä»¬æŒ‡å®šäº†åˆ’å®šä¸åŒåŒºåŸŸçš„<strong>ç©ºé—´å æ¯”</strong>ã€‚</p><p>spark.memory.fractionç”¨äºæ ‡è®°Sparkå¤„ç†åˆ†å¸ƒå¼æ•°æ®é›†çš„å†…å­˜æ€»å¤§å°ï¼Œè¿™éƒ¨åˆ†å†…å­˜åŒ…æ‹¬Execution Memoryå’ŒStorage Memoryä¸¤éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ç»¿è‰²çš„çŸ©å½¢åŒºåŸŸã€‚ï¼ˆM â€“ 300ï¼‰* ï¼ˆ1 â€“ mfï¼‰åˆšå¥½å°±æ˜¯User Memoryçš„åŒºåŸŸå¤§å°ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­è“è‰²åŒºåŸŸçš„éƒ¨åˆ†ã€‚</p><p>spark.memory.storageFractionåˆ™ç”¨æ¥è¿›ä¸€æ­¥åŒºåˆ†Execution Memoryå’ŒStorage Memoryçš„åˆå§‹å¤§å°ã€‚æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼ŒReserved Memoryå›ºå®šä¸º300MBã€‚ï¼ˆM â€“ 300ï¼‰* mf * sfæ˜¯Storage Memoryçš„åˆå§‹å¤§å°ï¼Œç›¸åº”åœ°ï¼Œï¼ˆM â€“ 300ï¼‰* mf * ï¼ˆ1 â€“ sfï¼‰å°±æ˜¯Execution Memoryçš„åˆå§‹å¤§å°ã€‚</p><p>ç†Ÿæ‚‰äº†ä»¥ä¸Š3ä¸ªé…ç½®é¡¹ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å°±èƒ½æœ‰çš„æ”¾çŸ¢åœ°å»è°ƒæ•´ä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œä»è€Œæå‡å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚æˆ‘ä»¬åœ¨å‰é¢æåˆ°ï¼Œåˆç†åœ°ä½¿ç”¨RDD Cacheå¾€å¾€èƒ½å¤§å¹…æå‡ä½œä¸šçš„æ‰§è¡Œæ€§èƒ½ï¼Œå› æ­¤åœ¨è¿™ä¸€è®²çš„æœ€åï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸€ä¸‹RDD Cacheçš„å…·ä½“ç”¨æ³•ã€‚</p><h2>RDD Cache</h2><p>åœ¨ä¸€ä¸ªSparkä½œä¸šä¸­ï¼Œè®¡ç®—å›¾DAGä¸­å¾€å¾€åŒ…å«å¤šä¸ªRDDï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¼„æ¸…æ¥šä»€ä¹ˆæ—¶å€™å¯¹å“ªä¸ªRDDè¿›è¡ŒCacheï¼Œç›²ç›®åœ°æ»¥ç”¨Cacheå¯ä¸æ˜¯æ˜æ™ºä¹‹ä¸¾ã€‚æˆ‘ä»¬å…ˆè¯´ç»“è®ºï¼Œ<strong>å½“åŒä¸€ä¸ªRDDè¢«å¼•ç”¨å¤šæ¬¡æ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘å¯¹å…¶è¿›è¡ŒCacheï¼Œä»è€Œæå‡ä½œä¸šçš„æ‰§è¡Œæ•ˆç‡</strong>ã€‚</p><p>æˆ‘ä»¬æ‹¿ç¬¬1è®²ä¸­çš„Word Countæ¥ä¸¾ä¾‹ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-scala\">import org.apache.spark.rdd.RDD\n&nbsp;\nval rootPath: String = _\nval file: String = s\"${rootPath}/wikiOfSpark.txt\"\n&nbsp;\n// è¯»å–æ–‡ä»¶å†…å®¹\nval lineRDD: RDD[String] = spark.sparkContext.textFile(file)\n&nbsp;\n// ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯\nval wordRDD: RDD[String] = lineRDD.flatMap(line =&gt; line.split(\" \"))\nval cleanWordRDD: RDD[String] = wordRDD.filter(word =&gt; !word.equals(\"\"))\n&nbsp;\n// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼\nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map(word =&gt; (word, 1))\n\n// æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°\nval wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) =&gt; x + y)\n&nbsp;\n// æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡\nwordCounts.map{case (k, v) =&gt; (v, k)}.sortByKey(false).take(5)\n&nbsp;\n// å°†åˆ†ç»„è®¡æ•°ç»“æœè½ç›˜åˆ°æ–‡ä»¶\nval targetPath: String = _\nwordCounts.saveAsTextFile(targetPath)\n</code></pre><p>ç»†å¿ƒçš„ä½ å¯èƒ½å‘ç°äº†ï¼Œæˆ‘ä»¬ä»Šå¤©çš„ä»£ç ï¼Œä¸ç¬¬1è®²ä¸­çš„ä»£ç å®ç°ä¸åŒã€‚æˆ‘ä»¬åœ¨æœ€åè¿½åŠ äº†saveAsTextFileè½ç›˜æ“ä½œï¼Œè¿™æ ·ä¸€æ¥ï¼ŒwordCountsè¿™ä¸ªRDDåœ¨ç¨‹åºä¸­è¢«å¼•ç”¨äº†ä¸¤æ¬¡ã€‚</p><p>å¦‚æœä½ æŠŠè¿™ä»½ä»£ç ä¸¢è¿›spark-shellå»æ‰§è¡Œï¼Œä¼šå‘ç°takeå’ŒsaveAsTextFileè¿™ä¸¤ä¸ªæ“ä½œæ‰§è¡Œå¾—éƒ½å¾ˆæ…¢ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘é€šè¿‡ç»™wordCountsåŠ Cacheæ¥æå‡æ•ˆç‡ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒCacheè¯¥æ€ä¹ˆåŠ å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œä½ åªéœ€è¦åœ¨wordCountså®Œæˆå®šä¹‰ä¹‹åï¼Œåœ¨è¿™ä¸ªRDDä¹‹ä¸Šä¾æ¬¡è°ƒç”¨cacheå’Œcountå³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-scala\">// æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°\nval wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) =&gt; x + y)\n&nbsp;\nwordCounts.cache// ä½¿ç”¨cacheç®—å­å‘ŠçŸ¥Sparkå¯¹wordCountsåŠ ç¼“å­˜\nwordCounts.count// è§¦å‘wordCountsçš„è®¡ç®—ï¼Œå¹¶å°†wordCountsç¼“å­˜åˆ°å†…å­˜\n&nbsp;\n// æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡\nwordCounts.map{case (k, v) =&gt; (v, k)}.sortByKey(false).take(5)\n&nbsp;\n// å°†åˆ†ç»„è®¡æ•°ç»“æœè½ç›˜åˆ°æ–‡ä»¶\nval targetPath: String = _\nwordCounts.saveAsTextFile(targetPath)\n</code></pre><p>ç”±äºcacheå‡½æ•°å¹¶ä¸ä¼šç«‹å³è§¦å‘RDDåœ¨å†…å­˜ä¸­çš„ç‰©åŒ–ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦<strong>è°ƒç”¨countç®—å­æ¥è§¦å‘è¿™ä¸€æ‰§è¡Œè¿‡ç¨‹</strong>ã€‚æ·»åŠ ä¸Šé¢çš„ä¸¤æ¡è¯­å¥ä¹‹åï¼Œä½ ä¼šå‘ç°takeå’ŒsaveAsTextFileçš„è¿è¡Œé€Ÿåº¦æ˜æ˜¾å˜å¿«äº†å¾ˆå¤šã€‚å¼ºçƒˆå»ºè®®ä½ åœ¨spark-shellä¸­å¯¹æ¯”æ·»åŠ Cacheå‰åçš„è¿è¡Œé€Ÿåº¦ï¼Œä»è€Œç›´è§‚åœ°æ„Ÿå—RDD Cacheå¯¹äºä½œä¸šæ‰§è¡Œæ€§èƒ½çš„æå‡ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨RDDä¹‹ä¸Šè°ƒç”¨cacheæ¥ä¸ºå…¶æ·»åŠ ç¼“å­˜ï¼Œè€Œåœ¨èƒŒåï¼Œ<strong>cacheå‡½æ•°å®é™…ä¸Šä¼šè¿›ä¸€æ­¥è°ƒç”¨persistï¼ˆMEMORY_ONLYï¼‰æ¥å®Œæˆè®¡ç®—</strong>ã€‚æ¢å¥è¯è¯´ï¼Œä¸‹é¢çš„ä¸¤æ¡è¯­å¥æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼ŒäºŒè€…çš„å«ä¹‰éƒ½æ˜¯æŠŠRDDç‰©åŒ–åˆ°å†…å­˜ã€‚</p><pre><code class=\"language-scala\">wordCounts.cache\nwordCounts.persist(MEMORY_ONLY)\n</code></pre><p>å°±æ·»åŠ Cacheæ¥è¯´ï¼Œç›¸æ¯”cacheç®—å­ï¼Œpersistç®—å­æ›´å…·å¤‡æ™®é€‚æ€§ï¼Œç»“åˆå¤šæ ·çš„å­˜å‚¨çº§åˆ«ï¼ˆå¦‚è¿™é‡Œçš„MEMORY_ONLYï¼‰ï¼Œpersistç®—å­å…è®¸å¼€å‘è€…çµæ´»åœ°é€‰æ‹©Cacheçš„å­˜å‚¨ä»‹è´¨ã€å­˜å‚¨å½¢å¼ä»¥åŠå‰¯æœ¬æ•°é‡ã€‚</p><p>Sparkæ”¯æŒä¸°å¯Œçš„å­˜å‚¨çº§åˆ«ï¼Œæ¯ä¸€ç§å­˜å‚¨çº§åˆ«éƒ½åŒ…å«3ä¸ªæœ€åŸºæœ¬çš„è¦ç´ ã€‚</p><ul>\n<li>å­˜å‚¨ä»‹è´¨ï¼šæ•°æ®ç¼“å­˜åˆ°å†…å­˜è¿˜æ˜¯ç£ç›˜ï¼Œæˆ–æ˜¯ä¸¤è€…éƒ½æœ‰</li>\n<li>å­˜å‚¨å½¢å¼ï¼šæ•°æ®å†…å®¹æ˜¯å¯¹è±¡å€¼è¿˜æ˜¯å­—èŠ‚æ•°ç»„ï¼Œå¸¦ SER å­—æ ·çš„è¡¨ç¤ºä»¥åºåˆ—åŒ–æ–¹å¼å­˜å‚¨ï¼Œä¸å¸¦ SER åˆ™è¡¨ç¤ºé‡‡ç”¨å¯¹è±¡å€¼</li>\n<li>å‰¯æœ¬æ•°é‡ï¼šå­˜å‚¨çº§åˆ«åå­—æœ€åçš„æ•°å­—ä»£è¡¨æ‹·è´æ•°é‡ï¼Œæ²¡æœ‰æ•°å­—é»˜è®¤ä¸º 1 ä»½å‰¯æœ¬ã€‚</li>\n</ul><p>æˆ‘æŠŠSparkæ”¯æŒçš„å­˜å‚¨çº§åˆ«æ€»ç»“åˆ°äº†ä¸‹è¡¨ï¼Œå…¶ä¸­æ‰“é’©çš„åœ°æ–¹ï¼Œè¡¨ç¤ºæŸç§å­˜å‚¨çº§åˆ«æ”¯æŒçš„å­˜å‚¨ä»‹è´¨ä¸å­˜å‚¨å½¢å¼ï¼Œä½ ä¸å¦¨çœ‹ä¸€çœ‹ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/b7/d7f15c0f7679777ec237c6a02f11c7b7.jpg?wh=1821x1192\" alt=\"å›¾ç‰‡\" title=\"RDD Cacheçš„å­˜å‚¨çº§åˆ«\"></p><p>é€šè¿‡ä¸Šè¡¨å¯¹ç³ç…æ»¡ç›®çš„å­˜å‚¨çº§åˆ«è¿›è¡Œæ‹†è§£ä¹‹åï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå®ƒä»¬ä¸è¿‡æ˜¯å­˜å‚¨ä»‹è´¨ã€å­˜å‚¨å½¢å¼å’Œå‰¯æœ¬æ•°é‡è¿™3ç±»åŸºæœ¬è¦ç´ çš„æ’åˆ—ç»„åˆè€Œå·²ã€‚ä¸Šè¡¨åˆ—å‡ºäº†ç›®å‰Sparkæ”¯æŒçš„æ‰€æœ‰å­˜å‚¨çº§åˆ«ï¼Œé€šè¿‡å®ƒï¼Œä½ å¯ä»¥è¿…é€Ÿå¯¹æ¯”æŸ¥æ‰¾ä¸åŒçš„å­˜å‚¨çº§åˆ«ï¼Œä»è€Œæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œä½ éœ€è¦æŒæ¡Executor JVM Heapçš„åˆ’åˆ†åŸç†ï¼Œå¹¶å­¦ä¼šé€šè¿‡é…ç½®é¡¹æ¥åˆ’åˆ†ä¸åŒçš„å†…å­˜åŒºåŸŸã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒSparkæŠŠExecutorå†…å­˜åˆ’åˆ†ä¸º4ä¸ªåŒºåŸŸï¼Œåˆ†åˆ«æ˜¯Reserved Memoryã€User Memoryã€Execution Memoryå’ŒStorage Memoryã€‚</p><p>é€šè¿‡è°ƒæ•´spark.executor.memoryã€spark.memory.fractionå’Œspark.memory.storageFractionè¿™3ä¸ªé…ç½®é¡¹ï¼Œä½ å¯ä»¥çµæ´»åœ°è°ƒæ•´ä¸åŒå†…å­˜åŒºåŸŸçš„å¤§å°ï¼Œä»è€Œå»é€‚é…Sparkä½œä¸šå¯¹äºå†…å­˜çš„éœ€æ±‚ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/f0/9c2fd81c42cdab915f9a388683602df0.jpg?wh=1920x737\" alt=\"å›¾ç‰‡\" title=\"å†…å­˜åŒºåŸŸç›¸å…³é…ç½®é¡¹\"></p><p>å†è€…ï¼Œåœ¨ç»Ÿä¸€å†…å­˜ç®¡ç†æ¨¡å¼ä¸‹ï¼ŒExecution Memoryä¸Storage Memoryä¹‹é—´å¯ä»¥äº’ç›¸æŠ¢å ï¼Œä½ éœ€è¦å¼„æ¸…æ¥šäºŒè€…ä¹‹é—´çš„æŠ¢å é€»è¾‘ã€‚æ€»ç»“ä¸‹æ¥ï¼Œå†…å­˜çš„æŠ¢å é€»è¾‘æœ‰å¦‚ä¸‹3æ¡ï¼š</p><ul>\n<li>å¦‚æœå¯¹æ–¹çš„å†…å­˜ç©ºé—´æœ‰ç©ºé—²ï¼ŒåŒæ–¹å¯ä»¥äº’ç›¸æŠ¢å ï¼›</li>\n<li>å¯¹äºStorage MemoryæŠ¢å çš„Execution Memoryéƒ¨åˆ†ï¼Œå½“åˆ†å¸ƒå¼ä»»åŠ¡æœ‰è®¡ç®—éœ€è¦æ—¶ï¼ŒStorage Memoryå¿…é¡»ç«‹å³å½’è¿˜æŠ¢å çš„å†…å­˜ï¼Œæ¶‰åŠçš„ç¼“å­˜æ•°æ®è¦ä¹ˆè½ç›˜ã€è¦ä¹ˆæ¸…é™¤ï¼›</li>\n<li>å¯¹äºExecution MemoryæŠ¢å çš„Storage Memoryéƒ¨åˆ†ï¼Œå³ä¾¿Storage Memoryæœ‰æ”¶å›å†…å­˜çš„éœ€è¦ï¼Œä¹Ÿå¿…é¡»è¦ç­‰åˆ°åˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰èƒ½é‡Šæ”¾ã€‚</li>\n</ul><p>æœ€åï¼Œæˆ‘ä»¬ä»‹ç»äº†RDD Cacheçš„åŸºæœ¬ç”¨æ³•ï¼Œå½“ä¸€ä¸ªRDDåœ¨ä»£ç ä¸­çš„å¼•ç”¨æ¬¡æ•°å¤§äº1æ—¶ï¼Œä½ å¯ä»¥è€ƒè™‘é€šè¿‡ç»™RDDåŠ Cacheæ¥æå‡ä½œä¸šæ€§èƒ½ã€‚å…·ä½“åšæ³•æ˜¯åœ¨RDDä¹‹ä¸Šè°ƒç”¨cacheæˆ–æ˜¯persistå‡½æ•°ã€‚</p><p>å…¶ä¸­persistæ›´å…·å¤‡æ™®é€‚æ€§ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®šå­˜å‚¨çº§åˆ«æ¥çµæ´»åœ°é€‰æ‹©Cacheçš„å­˜å‚¨ä»‹è´¨ã€å­˜å‚¨å½¢å¼ä»¥åŠå‰¯æœ¬æ•°é‡ï¼Œä»è€Œæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€è¦ã€‚</p><h2>æ¯è¯¾ä¸€ç»ƒ</h2><p>å¥½å•¦ï¼Œè¿™èŠ‚è¯¾å°±åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬ä»Šå¤©çš„ç»ƒä¹ é¢˜æ˜¯è¿™æ ·çš„ï¼š</p><p>ç»™å®šå¦‚ä¸‹é…ç½®é¡¹è®¾ç½®ï¼Œè¯·ä½ è®¡ç®—ä¸åŒå†…å­˜åŒºåŸŸï¼ˆReservedã€Userã€Executionã€Storageï¼‰çš„ç©ºé—´å¤§å°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/17/49/1719802a95c154775530f0bf4ec34949.jpg?wh=1898x716\" alt=\"\"></p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç­”æ¡ˆã€‚å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ä¸€è®²åˆ†äº«ç»™è‡ªå·±çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ã€‚</p>","neighbors":{"left":{"article_title":"07 | RDDå¸¸ç”¨ç®—å­ï¼ˆäºŒï¼‰ï¼šSparkå¦‚ä½•å®ç°æ•°æ®èšåˆï¼Ÿ","id":421566},"right":{"article_title":"09 | RDDå¸¸ç”¨ç®—å­ï¼ˆä¸‰ï¼‰ï¼šæ•°æ®çš„å‡†å¤‡ã€é‡åˆ†å¸ƒä¸æŒä¹…åŒ–","id":423131}},"comments":[{"had_liked":false,"id":313823,"user_name":"GACÂ·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1632700768,"is_pvip":true,"replies":[{"id":"113765","content":"æ»¡åˆ†ğŸ’¯<br><br>å¯ä»¥çš„ï¼Œè¿™é‡Œçš„0.8ï¼Œå…¶å®ä¸æ˜¯ç‰©ç†å†…å­˜çš„80%ï¼Œè€Œæ˜¯åˆ†é…ç»™Executor JVM heapçš„80%ï¼Œæ²¡ä»€ä¹ˆé£é™©çš„","user_name":"ä½œè€…å›å¤","comment_id":313823,"uid":"1043100","ip_address":"","utype":1,"ctime":1632831298,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"35992439136","product_id":100090001,"comment_content":"R:300M<br>U:(10240 - 300) * (1 - 0.8) =1988<br>E:(10240 - 300) * 0.8 * (1 - 0.4) = 4771.2<br>S:(10240 -300) * 0.8 * 0.4 = 3180.8<br>è€å¸ˆå®é™…ç”Ÿäº§ç¯å¢ƒï¼ŒæŠŠspark. executor. memoryè®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„80%åˆç†å—ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527482,"discussion_content":"æ»¡åˆ†ğŸ’¯\n\nå¯ä»¥çš„ï¼Œè¿™é‡Œçš„0.8ï¼Œå…¶å®ä¸æ˜¯ç‰©ç†å†…å­˜çš„80%ï¼Œè€Œæ˜¯åˆ†é…ç»™Executor JVM heapçš„80%ï¼Œæ²¡ä»€ä¹ˆé£é™©çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632831298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324047,"user_name":"å°æ–°","can_delete":false,"product_type":"c1","uid":1690884,"ip_address":"","ucode":"DCAD04665E2CF8","user_header":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","comment_is_top":false,"comment_ctime":1638271004,"is_pvip":false,"replies":[{"id":"117601","content":"ä»æºç æ¥çœ‹ï¼Œè¿˜çœŸæ²¡æœ‰~<br><br>æ‰“ä¸ªæ¯”æ–¹ï¼Œæ¯”å¦‚åº”ç”¨ä¸­æ²¡æœ‰åŠ ä»»ä½•çš„Cacheï¼Œé‚£éšç€å†…å­˜éœ€è¦çš„å¢é•¿ï¼ŒExecution Taskä¼šé€æ¸èš•é£Ÿæ‰å…¨éƒ¨Storage Memoryéƒ¨åˆ†çš„å†…å­˜","user_name":"ä½œè€…å›å¤","comment_id":324047,"uid":"1043100","ip_address":"","utype":1,"ctime":1638283713,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10228205596","product_id":100090001,"comment_content":" Storage memoryä¸Execution Memoryä¹‹é—´æŠ¢å æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªæœ€å°é˜ˆå€¼å—ï¼Ÿä¸å¯èƒ½å…¨éƒ¨æŠ¢å å®Œå§ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534822,"discussion_content":"ä»æºç æ¥çœ‹ï¼Œè¿˜çœŸæ²¡æœ‰~\n\næ‰“ä¸ªæ¯”æ–¹ï¼Œæ¯”å¦‚åº”ç”¨ä¸­æ²¡æœ‰åŠ ä»»ä½•çš„Cacheï¼Œé‚£éšç€å†…å­˜éœ€è¦çš„å¢é•¿ï¼ŒExecution Taskä¼šé€æ¸èš•é£Ÿæ‰å…¨éƒ¨Storage Memoryéƒ¨åˆ†çš„å†…å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638283713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315901,"user_name":"å†¯æ°","can_delete":false,"product_type":"c1","uid":1950765,"ip_address":"","ucode":"61C92D62D49A66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/qmdZbyxrRD5qQLKjWkmdp3PCVhwmWTcp0cs04s39pic2RcNw0nNKTDgKqedSQ54bAGWjAVSc9p4vWP8RJRKB6nA/132","comment_is_top":false,"comment_ctime":1634037649,"is_pvip":false,"replies":[{"id":"114516","content":"è¿™ä¸ªå‘ç°å¾ˆæœ‰æ„æ€ï¼Œæ„¿é—»å…¶è¯¦~ è€å¼Ÿèƒ½è¯¦ç»†è¯´è¯´å—ï¼Ÿæˆ‘å¾ˆæ„Ÿå…´è¶£~ å°¤å…¶æ˜¯Spark UIèƒ½å¤ŸéªŒè¯è¿™ç§å‘ç°ï¼Œæå®¢åº”è¯¥æ˜¯ä¸èƒ½è´´å›¾ï¼Œè€å¼ŸåŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼Œä¸€èµ·è¯¦ç»†è®¨è®ºè®¨è®º~","user_name":"ä½œè€…å›å¤","comment_id":315901,"uid":"1043100","ip_address":"","utype":1,"ctime":1634136019,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"10223972241","product_id":100090001,"comment_content":"åœ¨å®é™…å·¥ä½œä¸­å‘ç°ï¼Œè®¾ç½®çš„executorå†…å­˜ï¼Œè¿˜è¦æ‰£é™¤1&#47;10çš„å¤§å°ï¼Œå‰©ä½™çš„9&#47;10æ‰èƒ½å‚ä¸è€å¸ˆè¯´çš„å…¬å¼è®¡ç®—ã€‚   çœ‹äº†åˆ«äººçš„åšå®¢ï¼Œè¯´æ˜¯jvmä¸­çš„Survivorï¼Œåªèƒ½æœ‰1ä¸ªè¢«çœŸæ­£ç”¨èµ·æ¥ã€‚       Spark UIä¸Šæ˜¾ç¤ºçš„ç»“æœï¼Œä¹Ÿåˆšå¥½èƒ½å¤Ÿåæ˜ è¿™ä¸ªé—®é¢˜","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528195,"discussion_content":"è¿™ä¸ªå‘ç°å¾ˆæœ‰æ„æ€ï¼Œæ„¿é—»å…¶è¯¦~ è€å¼Ÿèƒ½è¯¦ç»†è¯´è¯´å—ï¼Ÿæˆ‘å¾ˆæ„Ÿå…´è¶£~ å°¤å…¶æ˜¯Spark UIèƒ½å¤ŸéªŒè¯è¿™ç§å‘ç°ï¼Œæå®¢åº”è¯¥æ˜¯ä¸èƒ½è´´å›¾ï¼Œè€å¼ŸåŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼Œä¸€èµ·è¯¦ç»†è®¨è®ºè®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634136019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1300466,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGMphabeneYXs9otkAtr67RvxJClDa7jPe7w8yExg4YaS2FGJruDKMj5yN1E90o6MFibnicH8gM0ibg/132","nickname":"hadoop_admin","note":"","ucode":"7EAFA775505C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555370,"discussion_content":"è¿™ä¸ªæ˜¯cms gcæ–¹å¼å§ï¼Œæ¢æˆg1è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646884430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313912,"user_name":"äº•å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":2108294,"ip_address":"","ucode":"87FD735FA7BFC3","user_header":"https://static001.geekbang.org/account/avatar/00/20/2b/86/318e6ff3.jpg","comment_is_top":false,"comment_ctime":1632735964,"is_pvip":false,"replies":[{"id":"113769","content":"æ²¡é”™ï¼Œæ­£è§£ï½ è€å¼Ÿæ€è€ƒçš„ç›¸å½“åˆ°ä½ï½","user_name":"ä½œè€…å›å¤","comment_id":313912,"uid":"1043100","ip_address":"","utype":1,"ctime":1632834829,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"10222670556","product_id":100090001,"comment_content":"æ—¢ç„¶user memoryå­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œæˆ‘åœ¨çº¯sqlçš„spark jobä¸­æ˜¯ä¸æ˜¯æŠŠspark.memory.fractionè®¾ç½®å¾ˆå¤§çš„å€¼ï¼Œåªç»™user memoryç•™æ¯”è¾ƒå°çš„ç©ºé—´ä»¥æé«˜executionå’Œstorage memoryçš„å¤§å°ï¼Œè¿›è€Œæé«˜å†…å­˜çš„ä½¿ç”¨ç‡å‘¢","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527516,"discussion_content":"æ²¡é”™ï¼Œæ­£è§£ï½ è€å¼Ÿæ€è€ƒçš„ç›¸å½“åˆ°ä½ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632834829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313908,"user_name":"å¤§å¿—","can_delete":false,"product_type":"c1","uid":1039047,"ip_address":"","ucode":"648335930C2E55","user_header":"https://static001.geekbang.org/account/avatar/00/0f/da/c7/66f5fcea.jpg","comment_is_top":false,"comment_ctime":1632734478,"is_pvip":false,"replies":[{"id":"113768","content":"æ­£è§£ï½","user_name":"ä½œè€…å›å¤","comment_id":313908,"uid":"1043100","ip_address":"","utype":1,"ctime":1632831718,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"5927701774","product_id":100090001,"comment_content":"error: not found: value MEMORY_ONLY<br><br>import org.apache.spark.storage.StorageLevel._<br>wordCounts.persist(MEMORY_ONLY)  &#47;&#47; å°±å¯ä»¥äº†","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527514,"discussion_content":"æ­£è§£ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632831718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1748720,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/ae/f0/56ddebdd.jpg","nickname":"æœ‰ç‚¹å¿™","note":"","ucode":"C82D787567E849","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572439,"discussion_content":"wordCounts.persist(StorageLevel.MEMORY_ONLY)  æˆ‘è¿™æ ·ç”¨çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652784303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350083,"user_name":"ç‹é‘«","can_delete":false,"product_type":"c1","uid":2115307,"ip_address":"","ucode":"6CB849E4900E40","user_header":"https://static001.geekbang.org/account/avatar/00/20/46/eb/44d4f887.jpg","comment_is_top":false,"comment_ctime":1656558895,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656558895","product_id":100090001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œsparkçš„å †å†…å†…å­˜å’Œå †å¤–å†…å­˜åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¦‚ä½•åˆ†é…ä½¿ç”¨ï¼Œå †å¤–å†…å­˜ç›´æ¥å—sparkç®¡ç†ï¼Œæ²¡æœ‰jvmã€‚ä¸ºä»€ä¹ˆä¸å¤šä½¿ç”¨å †å¤–å†…å­˜","like_count":0},{"had_liked":false,"id":345192,"user_name":"xiong","can_delete":false,"product_type":"c1","uid":1099375,"ip_address":"","ucode":"C1BFD9EF96372F","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/6f/ac3003fa.jpg","comment_is_top":false,"comment_ctime":1652101336,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652101336","product_id":100090001,"comment_content":"sparkçš„memoryæ¨¡å‹æ˜¯åœ¨jvmä¸­çš„æ–°å£°ä»£åŒºåˆ’åˆ†å‡ºæ¥çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":341414,"user_name":"æˆ‘çˆ±å¤œæ¥é¦™","can_delete":false,"product_type":"c1","uid":2609930,"ip_address":"","ucode":"10761E677EF05F","user_header":"https://static001.geekbang.org/account/avatar/00/27/d3/0a/92640aae.jpg","comment_is_top":false,"comment_ctime":1649590447,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1649590447","product_id":100090001,"comment_content":"è€å¸ˆ,ä¼šä¸ä¼šå­˜åœ¨storageç©ºé—´ä¸è¶³,æ— æ³•ç¼“å­˜RDDçš„æƒ…å†µ,è¿™æ—¶å€™æ€ä¹ˆåŠ?<br>","like_count":0,"discussions":[{"author":{"id":2957218,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/1f/a2/0ac2dc38.jpg","nickname":"ç»„ç»‡çµé­‚ ç‹å­å¥","note":"","ucode":"94DB462CEAFAD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575640,"discussion_content":"ä¹Ÿæ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ï¼Œè‡ªå·±è§‰å¾—æœ‰è¿™ä¹ˆå‡ æ¡æ€è·¯, ä¸çŸ¥é“å¯¹ä¸å¯¹\n- Spark Executor ä¼šé‡‡ç”¨Java garbage Collectionæ¥clearé‚£äº›young old generation objectsï¼Œä¿æŒå†…å­˜æœ€å¥½çŠ¶æ€ï¼Œæ¯•ç«Ÿæ¯ä¸ªExecutorå…¶è®¡ç®—å’Œå­˜å‚¨éƒ½æ˜¯JVM\n- persistå¯ä»¥åŠ ä¸Šdiskï¼Œå­˜åˆ°ç¡¬ç›˜é‡Œ\n- å¦‚æœå®åœ¨å¤ªå¤§å°è¯•ä½¿ç”¨serializerï¼Œè™½ç„¶è€—æ—¶ä½†æ˜¯ç¡®å®èŠ‚çœå†…å­˜, å¯ä»¥ç”¨Javaçš„serializerä¹Ÿå¯ä»¥ç”¨kyro","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654973123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341152,"user_name":"ç¿¡ç¿ å°å—ç“œ","can_delete":false,"product_type":"c1","uid":1068242,"ip_address":"","ucode":"92503E54E106CD","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/d2/f12dd0ac.jpg","comment_is_top":false,"comment_ctime":1649391454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649391454","product_id":100090001,"comment_content":"ä¸ºäº†è§¦å‘cacheï¼Œè°ƒç”¨äº†countæ“ä½œï¼Œä½†å®é™…è·‘çš„ç¨‹åºï¼Œè®°å½•å¾ˆå¤šæ—¶ï¼Œcountæ“ä½œè²Œä¼¼ä¹ŸæŒºè€—æ—¶çš„ï¼›å‡å¦‚æŸä¸ªRDDç¬¬ä¸€æ¬¡ç”Ÿæˆæ—¶æ—¶å€™ï¼Œè°ƒç”¨äº†cacheï¼Œä½†ä¸è§¦å‘actionæ“ä½œï¼Œåé¢å¯¹è¿™ä¸ªRDDå¤šæ¬¡è½¬æ¢ï¼Œæœ€åæ‰§è¡Œäº†ä¸€æ¬¡actionï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æœ€åactionçš„æ—¶å€™æ‰æ‰è¿›è¡Œäº†cacheï¼Œè¿™æ˜¯å¯¹åº”ç”¨æ¥è¯´å®é™…æ²¡å•¥ç”¨äº†äº†ï¼Ÿï¼Ÿï¼Œè¿˜æœ‰è¿™æ—¶å€™ç¨‹åºç»“æŸäº†ï¼Œè¿™å—cacheæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢","like_count":0},{"had_liked":false,"id":338986,"user_name":"æ™“æ³¢.å‚äº‘æœ¨","can_delete":false,"product_type":"c1","uid":1203929,"ip_address":"","ucode":"911684B4E593B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/5e/d9/28c7a551.jpg","comment_is_top":false,"comment_ctime":1647850386,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647850386","product_id":100090001,"comment_content":"Reserved:300M<br>User:(1024*10 - 300) * (1 - 0.8) =1988<br>Execution:(1024*10 - 300) * 0.8 * (1 - 0.4) = 4771.2<br>Storage:(1024*10 -300) * 0.8 * 0.4 = 3180.8","like_count":0},{"had_liked":false,"id":327720,"user_name":"Botanic","can_delete":false,"product_type":"c1","uid":1543891,"ip_address":"","ucode":"AA8C028A6C08DC","user_header":"https://static001.geekbang.org/account/avatar/00/17/8e/d3/1a3bb2cc.jpg","comment_is_top":false,"comment_ctime":1640250313,"is_pvip":false,"replies":[{"id":"119391","content":"å…¶å®è·ŸPySparkæ²¡ä»€ä¹ˆå…³ç³»å“ˆï¼Œä¸ç®¡æ˜¯Scalaã€Javaã€è¿˜æ˜¯Python APIï¼Œtakeéƒ½å±äºActionç®—å­ï¼Œå¾—åˆ°çš„éƒ½æ˜¯listã€‚è¦æƒ³æŠŠRDDä¿å­˜åˆ°æ–‡ä»¶ï¼Œç›´æ¥è°ƒç”¨saveAsTextFileå³å¯~","user_name":"ä½œè€…å›å¤","comment_id":327720,"uid":"1043100","ip_address":"","utype":1,"ctime":1640355883,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1640250313","product_id":100090001,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æƒ³è¯·å‡ä¸€ä¸ªé—®é¢˜ã€‚pythonä¸­ï¼Œå¦‚æœwordCountåŠ ä¸Štake(5)è¿™ä¸ªç®—å­åï¼Œæ•°æ®ç±»å‹å°±ä»RDDè½¬åŒ–ä¸ºlistäº†ï¼Œé‚£ä¹ˆåé¢å†ä½¿ç”¨saveAsTextFileç®—å­å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¤„ç†å®ƒè¦æ±‚å‰é¢çš„æ•°æ®ç±»å‹æ˜¯RDDã€‚è¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541401,"discussion_content":"å…¶å®è·ŸPySparkæ²¡ä»€ä¹ˆå…³ç³»å“ˆï¼Œä¸ç®¡æ˜¯Scalaã€Javaã€è¿˜æ˜¯Python APIï¼Œtakeéƒ½å±äºActionç®—å­ï¼Œå¾—åˆ°çš„éƒ½æ˜¯listã€‚è¦æƒ³æŠŠRDDä¿å­˜åˆ°æ–‡ä»¶ï¼Œç›´æ¥è°ƒç”¨saveAsTextFileå³å¯~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640355883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321416,"user_name":"William","can_delete":false,"product_type":"c1","uid":2086573,"ip_address":"","ucode":"EC29D9CD616183","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d6/ad/850992a5.jpg","comment_is_top":false,"comment_ctime":1636860870,"is_pvip":false,"replies":[{"id":"116847","content":"Storage memoryä¸Execution Memoryä¹‹é—´çš„è¾¹ç•Œï¼Œä»¥åŠäºŒè€…ä¹‹é—´ç›¸äº’çš„æŠ¢å è§„åˆ™ï¼Œè€å¼Ÿè¿˜éœ€è¦å†æ¸©ä¹ ä¸‹å“ˆ~","user_name":"ä½œè€…å›å¤","comment_id":321416,"uid":"1043100","ip_address":"","utype":1,"ctime":1637059171,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1636860870","product_id":100090001,"comment_content":"è€å¸ˆï¼Œå‡è®¾è®¾å®šäº†spark.memory.storageFraction=0.4ï¼Œé‚£è¿™éƒ¨åˆ†ç”¨äºå­˜å‚¨çš„å†…å­˜ä¹Ÿæ˜¯å‘è®¡ç®—å†…å­˜è½¬æ¢çš„æ˜¯å§ï¼Ÿ é‚£è®¾å®šè¿™ä¸ªå‚æ•°çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Œå•çº¯ä¸ºäº†åœ¨è®¡ç®—å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹é¢„ç•™å‚¨å­˜ç©ºé—´å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530361,"discussion_content":"Storage memoryä¸Execution Memoryä¹‹é—´çš„è¾¹ç•Œï¼Œä»¥åŠäºŒè€…ä¹‹é—´ç›¸äº’çš„æŠ¢å è§„åˆ™ï¼Œè€å¼Ÿè¿˜éœ€è¦å†æ¸©ä¹ ä¸‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637059171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321353,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1636809321,"is_pvip":false,"replies":[{"id":"116844","content":"ç®—çš„æ²¡é”™~ ä¸è¿‡è€å¼ŸStorageå’ŒReservedå†™åäº†å§ï¼Œå“ˆå“ˆ","user_name":"ä½œè€…å›å¤","comment_id":321353,"uid":"1043100","ip_address":"","utype":1,"ctime":1637058630,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1636809321","product_id":100090001,"comment_content":"Execution = (10G-300M)* 0.8 * (1-0.4) = 4771.2M <br>User = (10G-300M) * (1-0.8) = 1988M<br>Reserved = (10G-300M)* 0.8 * 0.4 = 3180.8M<br>Storage = 300M<br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530358,"discussion_content":"ç®—çš„æ²¡é”™~ ä¸è¿‡è€å¼ŸStorageå’ŒReservedå†™åäº†å§ï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637058630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314351,"user_name":"Geek_2dfa9a","can_delete":false,"product_type":"c1","uid":1435535,"ip_address":"","ucode":"B5FE7971F5E773","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGTSTvn7r4ibk1PuaUrSvvLdviaLcne50jbvvfiaxKkM5SLibeP6jibA2bCCQBqETibvIvcsOhAZlwS8kQ/132","comment_is_top":false,"comment_ctime":1632983377,"is_pvip":false,"replies":[{"id":"113876","content":"æ­£è§£ï¼Œæ»¡åˆ†ğŸ’¯","user_name":"ä½œè€…å›å¤","comment_id":314351,"uid":"1043100","ip_address":"","utype":1,"ctime":1633051324,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1632983377","product_id":100090001,"comment_content":"è¿™é‡Œç²—ç•¥ä¼°è®¡1GBä¸º1000MB<br>Reserved Memory = 300MB<br>Execution Memory + Storage Memory = (10GB - 0.3GB) * 0.8 = 9.7GB * 0.8 = 7.76GB<br>User Memory = 9.7GB - 7.76GB = 1.94GB<br>Execution Memory = 7.76GB * (1 - 0.4) = 7.76GB * 0.6 = 4.66GB<br>Storage Memory = 7.76GB - 4.66GB = 3.1GB<br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527656,"discussion_content":"æ­£è§£ï¼Œæ»¡åˆ†ğŸ’¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633051324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313885,"user_name":"Geek_796a41","can_delete":false,"product_type":"c1","uid":2765167,"ip_address":"","ucode":"EDC2288E23F6CA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJbmJViaa9UH5EVehq7EiayKzEy5FUPpjmZkicg0jxy2sJycTFYbyM3wWzqy1goZhZj2wsrWATDoia9Ww/132","comment_is_top":false,"comment_ctime":1632728671,"is_pvip":false,"replies":[{"id":"113767","content":"å¯ä»¥å‚è€ƒåé¢çš„é…ç½®é¡¹é‚£ä¸€è®²ï¼ˆ12è®²ï¼‰å“ˆï½ åº”è¯¥å¾ˆå¿«å°±æ›´æ–°å•¦ï¼æ•¬è¯·å…³æ³¨ï½","user_name":"ä½œè€…å›å¤","comment_id":313885,"uid":"1043100","ip_address":"","utype":1,"ctime":1632831695,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1632728671","product_id":100090001,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸‹spark.memory.fraction å’Œ spark.memory.storageFractionè¿™ä¸¤ä¸ªå€¼åœ¨è®¾ç½®çš„æ—¶å€™éƒ½æœ‰ä»€ä¹ˆå‚è€ƒï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527507,"discussion_content":"å¯ä»¥å‚è€ƒåé¢çš„é…ç½®é¡¹é‚£ä¸€è®²ï¼ˆ12è®²ï¼‰å“ˆï½ åº”è¯¥å¾ˆå¿«å°±æ›´æ–°å•¦ï¼æ•¬è¯·å…³æ³¨ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632831695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}