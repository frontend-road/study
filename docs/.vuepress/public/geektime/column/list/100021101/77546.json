{"id":77546,"title":"14 | å­˜å‚¨ä¼˜åŒ–ï¼ˆä¸‹ï¼‰ï¼šæ•°æ®åº“SQLiteçš„ä½¿ç”¨å’Œä¼˜åŒ–","content":"<p>æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹å‰é¢è®²åˆ°çš„å­˜å‚¨æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯ï¼šå°‘é‡çš„Key Valueæ•°æ®å¯ä»¥ç›´æ¥ä½¿ç”¨SharedPreferencesï¼Œç¨å¾®å¤æ‚ä¸€äº›çš„æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥é€šè¿‡åºåˆ—åŒ–æˆJSONæˆ–è€…Protocol Buffersä¿å­˜ï¼Œå¹¶ä¸”åœ¨å¼€å‘ä¸­è·å–æˆ–è€…ä¿®æ”¹æ•°æ®ä¹Ÿå¾ˆç®€å•ã€‚</p><p>ä¸è¿‡è¿™å‡ ç§æ–¹æ³•å¯ä»¥è¦†ç›–æ‰€æœ‰çš„å­˜å‚¨åœºæ™¯å—ï¼Ÿæ•°æ®é‡åœ¨å‡ ç™¾ä¸Šåƒæ¡è¿™ä¸ªé‡çº§æ—¶å®ƒä»¬çš„æ€§èƒ½è¿˜å¯ä»¥æ¥å—ï¼Œä½†å¦‚æœæ˜¯å‡ ä¸‡æ¡çš„å¾®ä¿¡èŠå¤©è®°å½•å‘¢ï¼Ÿè€Œä¸”å¦‚ä½•å®ç°å¿«é€Ÿåœ°å¯¹æŸå‡ ä¸ªè”ç³»äººçš„æ•°æ®åšå¢åˆ æ”¹æŸ¥å‘¢ï¼Ÿ</p><p>å¯¹äºå¤§æ•°æ®çš„å­˜å‚¨åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ç¨³å®šæ€§ã€æ€§èƒ½å’Œ<strong>å¯æ‰©å±•æ€§</strong>ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦è½®åˆ°ä»Šå¤©çš„â€œä¸»è§’â€æ•°æ®åº“ç™»åœºäº†ã€‚è®²å­˜å‚¨ä¼˜åŒ–ä¸€å®šç»•ä¸å¼€æ•°æ®åº“ï¼Œè€Œæ•°æ®åº“è¿™ä¸ªä¸»é¢˜åˆéå¸¸å¤§ï¼Œæˆ‘ä¹ŸçŸ¥é“ä¸å°‘åŒå­¦å­¦æ•°æ®åº“çš„è¿‡ç¨‹æ˜¯ä»å…¥é—¨åˆ°æ”¾å¼ƒã€‚é‚£ä¹ˆè€ƒè™‘åˆ°æˆ‘ä»¬å¤§å¤šæ˜¯ä»äº‹ç§»åŠ¨å¼€å‘çš„å·¥ä½œï¼Œä»Šå¤©æˆ‘å°±æ¥è®²è®²ç§»åŠ¨ç«¯æ•°æ®åº“SQLiteçš„ä½¿ç”¨å’Œä¼˜åŒ–ã€‚</p><h2>SQLiteçš„é‚£äº›äº‹å„¿</h2><p>è™½ç„¶å¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„æ•°æ®åº“ï¼Œä½†å—é™äºåº“ä½“ç§¯å’Œå­˜å‚¨ç©ºé—´ï¼Œé€‚åˆç§»åŠ¨ç«¯ä½¿ç”¨çš„è¿˜çœŸä¸å¤šã€‚å½“ç„¶ä½¿ç”¨æœ€å¹¿æ³›çš„è¿˜æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’SQLiteï¼Œä½†åŒæ ·è¿˜æ˜¯æœ‰ä¸€äº›å…¶ä»–ä¸é”™çš„é€‰æ‹©ï¼Œä¾‹å¦‚åˆ›ä¸šå›¢é˜Ÿçš„<a href=\"https://github.com/realm/realm-java\">Realm</a>ã€Googleçš„<a href=\"https://github.com/google/leveldb\">LevelDB</a>ç­‰ã€‚</p><p>åœ¨å›½å†…é‚£ä¹ˆå¤šçš„ç§»åŠ¨å›¢é˜Ÿä¸­ï¼Œå¾®ä¿¡å¯¹SQLiteçš„ç ”ç©¶å¯ä»¥ç®—æ˜¯æœ€æ·±å…¥çš„ã€‚è¿™å…¶å®æ˜¯ä¸šåŠ¡è¯‰æ±‚å¯¼å‘çš„ï¼Œç”¨æˆ·èŠå¤©è®°å½•åªä¼šåœ¨æœ¬åœ°ä¿å­˜ï¼Œä¸€æ—¦å‡ºç°æ•°æ®æŸåæˆ–è€…ä¸¢å¤±ï¼Œå¯¹ç”¨æˆ·æ¥è¯´éƒ½æ˜¯ä¸å¯æŒ½å›çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¾®ä¿¡æœ‰å¾ˆå¤§ä¸€æ‰¹çš„é‡åº¦ç”¨æˆ·ï¼Œä»–ä»¬æœ‰å‡ åƒä¸ªè”ç³»äººã€å‡ åƒä¸ªç¾¤èŠå¤©ï¼Œæ›¾ç»åšè¿‡ä¸€ä¸ªç»Ÿè®¡ï¼Œæœ‰å‡ ç™¾ä¸‡ç”¨æˆ·çš„æ•°æ®åº“ç«Ÿç„¶å¤§äº1GBã€‚å¯¹äºè¿™æ‰¹ç”¨æˆ·ï¼Œå¦‚ä½•ä¿è¯ä»–ä»¬å¯ä»¥æ­£å¸¸åœ°ä½¿ç”¨å¾®ä¿¡æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æŒ‘æˆ˜ã€‚</p><!-- [[[read_end]]] --><p>æ‰€ä»¥å½“æ—¶å¾®ä¿¡ä¸“é—¨å¼€å±•äº†ä¸€ä¸ªé‡åº¦ç”¨æˆ·ä¼˜åŒ–çš„ä¸“é¡¹ã€‚ä¸€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬é›†ä¸­åœ¨SQLiteä½¿ç”¨ä¸Šçš„ä¼˜åŒ–ï¼Œä¾‹å¦‚è¡¨ç»“æ„ã€ç´¢å¼•ç­‰ã€‚ä½†å¾ˆå¿«å°±å‘ç°ç”±äºç³»ç»Ÿç‰ˆæœ¬çš„ä¸åŒï¼ŒSQLiteçš„å®ç°ä¹Ÿæœ‰æ‰€å·®å¼‚ï¼Œç»å¸¸ä¼šå‡ºç°ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œå¹¶ä¸”ä¹Ÿè€ƒè™‘åˆ°åŠ å¯†çš„è¯‰æ±‚ï¼Œæˆ‘ä»¬å†³å®šå•ç‹¬å¼•å…¥è‡ªå·±çš„SQLiteç‰ˆæœ¬ã€‚</p><p>â€œæºç åœ¨æ‰‹ï¼Œå¤©ä¸‹æˆ‘æœ‰â€ï¼Œä»æ­¤å¼€å¯äº†ä¸€æ¡ç ”ç©¶æ•°æ®åº“çš„â€œä¸å½’è·¯â€ã€‚é‚£æ—¶æˆ‘ä»¬æŠ•å…¥äº†å‡ ä¸ªäººä¸“é—¨å»æ·±å…¥ç ”ç©¶SQLiteçš„æºç ï¼Œä»SQLiteçš„PRAGMAç¼–è¯‘é€‰é¡¹ã€<a href=\"https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&amp;mid=2649286603&amp;idx=1&amp;sn=d243dd27f2c6614631241cd00570e853&amp;chksm=8334c349b4434a5fd81809d656bfad6072f075d098cb5663a85823e94fc2363edd28758ab882&amp;mpshare=1&amp;scene=1&amp;srcid=0609GLAeaGGmI4zCHTc2U9ZX#rd\">Cursorå®ç°ä¼˜åŒ–</a>ï¼Œåˆ°SQLiteæºç çš„ä¼˜åŒ–ï¼Œæœ€åæ‰“é€ å‡ºä»å®éªŒå®¤åˆ°çº¿ä¸Šçš„æ•´ä¸ªç›‘æ§ä½“ç³»ã€‚</p><p>åœ¨2017å¹´ï¼Œæˆ‘ä»¬å¼€æºäº†å†…éƒ¨ä½¿ç”¨çš„SQLiteæ•°æ®åº“<a href=\"https://github.com/Tencent/wcdb/wiki\">WCDB</a>ã€‚è¿™é‡Œå¤šè¯´ä¸¤å¥ï¼Œçœ‹ä¸€ä¸ªå¼€æºé¡¹ç›®æ˜¯å¦é è°±ï¼Œå°±çœ‹è¿™ä¸ªé¡¹ç›®å¯¹äº§å“æœ¬èº«æœ‰å¤šé‡è¦ã€‚å¾®ä¿¡å¼€æºåšæŒå†…éƒ¨ä¸å¤–éƒ¨ä½¿ç”¨åŒä¸€ä¸ªç‰ˆæœ¬ï¼Œè™½ç„¶æˆ‘ç°åœ¨å·²ç»ç¦»å¼€äº†å¾®ä¿¡å›¢é˜Ÿï¼Œä½†è¿˜æ˜¯æ¬¢è¿æœ‰éœ€è¦çš„åŒå­¦ä½¿ç”¨WCDBã€‚</p><p>åœ¨å¼€å§‹å­¦ä¹ å‰æˆ‘è¦æé†’ä½ ï¼ŒSQLiteçš„ä¼˜åŒ–åŒæ ·ä¹Ÿå¾ˆéš¾é€šè¿‡ä¸€ä¸¤ç¯‡æ–‡ç« å°±æŠŠæ¯ä¸ªç»†èŠ‚éƒ½è®²æ¸…æ¥šã€‚ä»Šå¤©çš„å†…å®¹æˆ‘é€‰æ‹©äº†ä¸€äº›æ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œå¹¶ä¸”ä¸ºä½ å‡†å¤‡äº†å¤§é‡çš„å‚è€ƒèµ„æ–™ï¼Œé‡åˆ°é™Œç”Ÿæˆ–è€…ä¸æ‡‚çš„åœ°æ–¹éœ€è¦ç»“åˆå‚è€ƒèµ„æ–™åå¤å­¦ä¹ ã€‚</p><p><strong>1. ORM</strong></p><p>å¦ç™½è¯´å¯èƒ½å¾ˆå¤šBATçš„é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆéƒ½ä¸å®Œå…¨äº†è§£SQLiteçš„å†…éƒ¨æœºåˆ¶ï¼Œä¹Ÿä¸èƒ½æ­£ç¡®åœ°å†™å‡ºé«˜æ•ˆçš„SQLè¯­å¥ã€‚å¤§éƒ¨åˆ†åº”ç”¨ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œä¼šå¼•å…¥ORMæ¡†æ¶ã€‚ORMï¼ˆObject Relational Mappingï¼‰ä¹Ÿå°±æ˜¯å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œç”¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µæŠŠæ•°æ®åº“ä¸­è¡¨å’Œå¯¹è±¡å…³è”èµ·æ¥ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¸ç”¨å…³å¿ƒæ•°æ®åº“åº•å±‚çš„å®ç°ã€‚</p><p>Androidä¸­æœ€å¸¸ç”¨çš„ORMæ¡†æ¶æœ‰å¼€æº<a href=\"https://github.com/greenrobot/greenDAO\">greenDAO</a>å’ŒGoogleå®˜æ–¹çš„<a href=\"https://developer.android.com/training/data-storage/room/\">Room</a>ï¼Œé‚£ä½¿ç”¨ORMæ¡†æ¶ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>ä½¿ç”¨ORMæ¡†æ¶çœŸçš„éå¸¸ç®€å•ï¼Œä½†æ˜¯ç®€æ˜“æ€§æ˜¯éœ€è¦ç‰ºç‰²éƒ¨åˆ†æ‰§è¡Œæ•ˆç‡ä¸ºä»£ä»·çš„ï¼Œå…·ä½“çš„æŸè€—è·ŸORMæ¡†æ¶å†™å¾—å¥½ä¸å¥½å¾ˆæœ‰å…³ç³»ã€‚ä½†å¯èƒ½æ›´å¤§çš„é—®é¢˜æ˜¯è®©å¾ˆå¤šçš„å¼€å‘è€…çš„æ€ç»´å›ºåŒ–ï¼Œæœ€åå¯èƒ½è¿ç®€å•çš„SQLè¯­å¥éƒ½ä¸ä¼šå†™äº†ã€‚</p><p>é‚£æˆ‘ä»¬çš„åº”ç”¨æ˜¯å¦åº”è¯¥å¼•å…¥ORMæ¡†æ¶å‘¢ï¼Ÿå¯èƒ½ç¨‹åºå‘˜å¤©ç”Ÿè¿½æ±‚å·æ‡’ï¼Œä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œåº”ç”¨çš„ç¡®åº”è¯¥å¼•å…¥ORMæ¡†æ¶ã€‚<strong>ä½†æ˜¯è¿™ä¸èƒ½æ˜¯æˆ‘ä»¬å¯ä»¥ä¸å»å­¦ä¹ æ•°æ®åº“åŸºç¡€çŸ¥è¯†çš„ç†ç”±ï¼Œåªæœ‰ç†è§£åº•å±‚çš„ä¸€äº›æœºåˆ¶ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´åŠ å¾—å¿ƒåº”æ‰‹åœ°è§£å†³ç–‘éš¾çš„é—®é¢˜</strong>ã€‚</p><p>è€ƒè™‘åˆ°å¯ä»¥æ›´å¥½çš„ä¸Android Jetpackçš„ç»„ä»¶äº’åŠ¨ï¼Œ<a href=\"https://github.com/Tencent/wcdb/wiki/Android-WCDB-%E4%BD%BF%E7%94%A8-Room-ORM-%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A\">WCDBé€‰æ‹©Roomä½œä¸ºORMæ¡†æ¶</a>ã€‚</p><p><strong>2. è¿›ç¨‹ä¸çº¿ç¨‹å¹¶å‘</strong></p><p>å¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æœ‰ä½¿ç”¨SQLiteï¼Œé‚£ä¹ˆä¸‹é¢è¿™ä¸ª<a href=\"https://developer.android.com/reference/android/database/sqlite/SQLiteDatabaseLockedException\">SQLiteDatabaseLockedException</a>å°±æ˜¯ç»å¸¸ä¼šå‡ºç°çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><pre><code>android.database.sqlite.SQLiteDatabaseLockedException: database is locked\n  at android.database.sqlite.SQLiteDatabase.dbopen\n  at android.database.sqlite.SQLiteDatabase.openDatabase\n  at android.database.sqlite.SQLiteDatabase.openDatabase\n</code></pre><p>SQLiteDatabaseLockedExceptionå½’æ ¹åˆ°åº•æ˜¯å› ä¸ºå¹¶å‘å¯¼è‡´ï¼Œè€ŒSQLiteçš„å¹¶å‘æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä¸€ä¸ªæ˜¯å¤šè¿›ç¨‹å¹¶å‘ï¼Œä¸€ä¸ªæ˜¯å¤šçº¿ç¨‹å¹¶å‘ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥è®²ä¸€ä¸‹å®ƒä»¬çš„å…³é”®ç‚¹ã€‚</p><p><strong>å¤šè¿›ç¨‹å¹¶å‘</strong></p><p>SQLiteé»˜è®¤æ˜¯æ”¯æŒå¤šè¿›ç¨‹å¹¶å‘æ“ä½œçš„ï¼Œå®ƒé€šè¿‡æ–‡ä»¶é”æ¥æ§åˆ¶å¤šè¿›ç¨‹çš„å¹¶å‘ã€‚SQLiteé”çš„ç²’åº¦å¹¶æ²¡æœ‰éå¸¸ç»†ï¼Œå®ƒé’ˆå¯¹çš„æ˜¯æ•´ä¸ªDBæ–‡ä»¶ï¼Œå†…éƒ¨æœ‰5ä¸ªçŠ¶æ€ï¼Œå…·ä½“ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« ã€‚</p><ul>\n<li>\n<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href=\"https://www.sqlite.org/lockingv3.html\">SQLite locking</a></p>\n</li>\n<li>\n<p>SQLiteæºç åˆ†æï¼š<a href=\"http://huili.github.io/lockandimplement/machining.html\">SQLiteé”æœºåˆ¶ç®€ä»‹</a></p>\n</li>\n<li>\n<p><a href=\"https://www.cnblogs.com/cchust/p/4761814.html\">SQLiteå°é”æœºåˆ¶</a></p>\n</li>\n</ul><p>ç®€å•æ¥è¯´ï¼Œå¤šè¿›ç¨‹å¯ä»¥åŒæ—¶è·å–SHAREDé”æ¥è¯»å–æ•°æ®ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å–EXCLUSIVEé”æ¥å†™æ•°æ®åº“ã€‚å¯¹äºiOSæ¥è¯´å¯èƒ½æ²¡æœ‰å¤šè¿›ç¨‹è®¿é—®æ•°æ®åº“çš„åœºæ™¯ï¼Œå¯ä»¥æŠŠlocking_modeçš„é»˜è®¤å€¼æ”¹ä¸ºEXCLUSIVEã€‚</p><pre><code>PRAGMA locking_mode = EXCLUSIVE\n</code></pre><p>åœ¨EXCLUSIVEæ¨¡å¼ä¸‹ï¼Œæ•°æ®åº“è¿æ¥åœ¨æ–­å¼€å‰éƒ½ä¸ä¼šé‡Šæ”¾SQLiteæ–‡ä»¶çš„é”ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„å†²çªï¼Œæé«˜æ•°æ®åº“è®¿é—®çš„é€Ÿåº¦ã€‚</p><p><strong>å¤šçº¿ç¨‹å¹¶å‘</strong></p><p>ç›¸æ¯”å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹çš„æ•°æ®åº“è®¿é—®å¯èƒ½ä¼šæ›´åŠ å¸¸è§ã€‚SQLiteæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘æ¨¡å¼ï¼Œéœ€è¦å¼€å¯ä¸‹é¢çš„é…ç½®ï¼Œå½“ç„¶ç³»ç»ŸSQLiteä¼šé»˜è®¤å¼€å¯å¤šçº¿ç¨‹<a href=\"https://sqlite.org/threadsafe.html\">Multi-threadæ¨¡å¼</a>ã€‚</p><pre><code>PRAGMA SQLITE_THREADSAFE = 2\n</code></pre><p><strong>è·Ÿå¤šè¿›ç¨‹çš„é”æœºåˆ¶ä¸€æ ·ï¼Œä¸ºäº†å®ç°ç®€å•ï¼ŒSQLiteé”çš„ç²’åº¦éƒ½æ˜¯æ•°æ®åº“æ–‡ä»¶çº§åˆ«ï¼Œå¹¶æ²¡æœ‰å®ç°è¡¨çº§ç”šè‡³è¡Œçº§çš„é”</strong>ã€‚è¿˜æœ‰éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<strong>åŒä¸€ä¸ªå¥æŸ„åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œ</strong>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‰“å¼€è¿æ¥æ± Connection Poolã€‚</p><p>å¦‚æœä½¿ç”¨WCDBåœ¨åˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¿æ¥æ± çš„å¤§å°ï¼Œåœ¨å¾®ä¿¡ä¸­æˆ‘ä»¬è®¾ç½®çš„å¤§å°æ˜¯4ã€‚</p><pre><code>public static SQLiteDatabase openDatabase (String path, \n                    SQLiteDatabase.CursorFactory factory, \n                    int flags, \n                    DatabaseErrorHandler errorHandler, \n                    int poolSize)\n</code></pre><p>è·Ÿå¤šè¿›ç¨‹ç±»ä¼¼ï¼Œå¤šçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–æ•°æ®åº“æ•°æ®ï¼Œä½†æ˜¯å†™æ•°æ®åº“ä¾ç„¶æ˜¯äº’æ–¥çš„ã€‚SQLiteæä¾›äº†Busy Retryçš„æ–¹æ¡ˆï¼Œå³å‘ç”Ÿé˜»å¡æ—¶ä¼šè§¦å‘Busy Handlerï¼Œæ­¤æ—¶å¯ä»¥è®©çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´åï¼Œé‡æ–°å°è¯•æ“ä½œï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://mp.weixin.qq.com/s/8FjDqPtXWWqOInsiV79Chg\">ã€Šå¾®ä¿¡iOS SQLiteæºç ä¼˜åŒ–å®è·µã€‹</a>è¿™ç¯‡æ–‡ç« ã€‚</p><p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜å¹¶å‘æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‰“å¼€<a href=\"https://www.sqlite.org/wal.html\">WAL</a>ï¼ˆWrite-Ahead Loggingï¼‰æ¨¡å¼ã€‚WALæ¨¡å¼ä¼šå°†ä¿®æ”¹çš„æ•°æ®å•ç‹¬å†™åˆ°ä¸€ä¸ªWALæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•å…¥äº†WALæ—¥å¿—æ–‡ä»¶é”ã€‚é€šè¿‡WALæ¨¡å¼è¯»å’Œå†™å¯ä»¥å®Œå…¨åœ°å¹¶å‘æ‰§è¡Œï¼Œä¸ä¼šäº’ç›¸é˜»å¡ã€‚</p><pre><code>PRAGMA schema.journal_mode = WAL\n</code></pre><p><strong>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†™ä¹‹é—´æ˜¯ä»ç„¶ä¸èƒ½å¹¶å‘</strong>ã€‚å¦‚æœå‡ºç°å¤šä¸ªå†™å¹¶å‘çš„æƒ…å†µï¼Œä¾ç„¶æœ‰å¯èƒ½ä¼šå‡ºç°SQLiteDatabaseLockedExceptionã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è®©åº”ç”¨ä¸­æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åç­‰å¾…ä¸€æ®µæ—¶é—´å†é‡è¯•ã€‚</p><pre><code>} catch (SQLiteDatabaseLockedException e) {\n    if (sqliteLockedExceptionTimes &lt; (tryTimes - 1)) {\n        try {\n            Thread.sleep(100);\n        } catch (InterruptedException e1) {\n        }\n    }\n    sqliteLockedExceptionTimes++ï¼›\n}\n</code></pre><p><strong>æ€»çš„æ¥è¯´é€šè¿‡è¿æ¥æ± ä¸WALæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå¢åŠ SQLiteçš„è¯»å†™å¹¶å‘ï¼Œå¤§å¤§å‡å°‘ç”±äºå¹¶å‘å¯¼è‡´çš„ç­‰å¾…è€—æ—¶ï¼Œå»ºè®®å¤§å®¶åœ¨åº”ç”¨ä¸­å¯ä»¥å°è¯•å¼€å¯ã€‚</strong></p><p><strong>3. æŸ¥è¯¢ä¼˜åŒ–</strong></p><p>è¯´åˆ°æ•°æ®åº“çš„æŸ¥è¯¢ä¼˜åŒ–ï¼Œä½ ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„è‚¯å®šæ˜¯å»ºç´¢å¼•ï¼Œé‚£æˆ‘å°±å…ˆæ¥è®²è®²SQLiteçš„ç´¢å¼•ä¼˜åŒ–ã€‚</p><p><strong>ç´¢å¼•ä¼˜åŒ–</strong></p><p>æ­£ç¡®ä½¿ç”¨ç´¢å¼•åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯å¯ä»¥å¤§å¤§é™ä½æŸ¥è¯¢é€Ÿåº¦ï¼Œå¾®ä¿¡çš„æ•°æ®åº“ä¼˜åŒ–ä¹Ÿæ˜¯é€šè¿‡ç´¢å¼•å¼€å§‹ã€‚ä¸‹é¢æ˜¯ç´¢å¼•ä½¿ç”¨éå¸¸ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å…ˆä»ç´¢å¼•è¡¨æ‰¾åˆ°æ•°æ®å¯¹åº”çš„rowidï¼Œç„¶åå†ä»åŸæ•°æ®è¡¨ç›´æ¥é€šè¿‡rowidæŸ¥è¯¢ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/57/d9/57fd28e1464b7ffbb1ba2b5379b84ad9.gif?wh=672*141\" alt=\"\"></p><p>å…³äºSQLiteç´¢å¼•çš„åŸç†ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ï¼Œåœ¨è¿™é‡Œæˆ‘æ¨èä¸€äº›å‚è€ƒèµ„æ–™ç»™ä½ ï¼š</p><ul>\n<li>\n<p><a href=\"https://www.cnblogs.com/huahuahu/p/sqlite-suo-yin-de-yuan-li-ji-ying-yong.html\">SQLiteç´¢å¼•çš„åŸç†</a></p>\n</li>\n<li>\n<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href=\"https://www.sqlite.org/queryplanner.html#searching\">Query Planning</a></p>\n</li>\n<li>\n<p><a href=\"http://blog.codinglabs.org/articles/theory-of-mysql-index.html\">MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</a></p>\n</li>\n</ul><p>è¿™é‡Œçš„å…³é”®åœ¨äºå¦‚ä½•æ­£ç¡®çš„å»ºç«‹ç´¢å¼•ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä»¥ä¸ºå·²ç»å»ºç«‹äº†ç´¢å¼•ï¼Œä½†äº‹å®ä¸Šå¹¶æ²¡æœ‰çœŸæ­£ç”Ÿæ•ˆã€‚ä¾‹å¦‚ä½¿ç”¨äº†BETWEENã€LIKEã€ORè¿™äº›æ“ä½œç¬¦ã€ä½¿ç”¨è¡¨è¾¾å¼æˆ–è€…case whenç­‰ã€‚æ›´è¯¦ç»†çš„è§„åˆ™å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"http://www.sqlite.org/optoverview.html\">The SQLite Query Optimizer Overview</a>ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡ä¼˜åŒ–è½¬æ¢è¾¾åˆ°ä½¿ç”¨ç´¢å¼•ç›®çš„çš„ä¾‹å­ã€‚</p><pre><code>BETWEENï¼šmyfiedlç´¢å¼•æ— æ³•ç”Ÿæ•ˆ\nSELECT * FROM mytable WHERE myfield BETWEEN 10 and 20;\nè½¬æ¢æˆï¼šmyfiedlç´¢å¼•å¯ä»¥ç”Ÿæ•ˆ\nSELECT * FROM mytable WHERE myfield &gt;= 10 AND myfield &lt;= 20;\n</code></pre><p>å»ºç«‹ç´¢å¼•æ˜¯æœ‰ä»£ä»·çš„ï¼Œéœ€è¦ä¸€ç›´ç»´æŠ¤ç´¢å¼•è¡¨çš„æ›´æ–°ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ªå¾ˆå°çš„è¡¨æ¥è¯´å°±æ²¡å¿…è¦å»ºç´¢å¼•ï¼›å¦‚æœä¸€ä¸ªè¡¨ç»å¸¸æ˜¯æ‰§è¡Œæ’å…¥æ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦èŠ‚åˆ¶çš„å»ºç«‹ç´¢å¼•ã€‚æ€»çš„æ¥è¯´æœ‰å‡ ä¸ªåŸåˆ™ï¼š</p><ul>\n<li>\n<p>å»ºç«‹æ­£ç¡®çš„ç´¢å¼•ã€‚è¿™é‡Œä¸ä»…éœ€è¦ç¡®ä¿ç´¢å¼•åœ¨æŸ¥è¯¢ä¸­çœŸæ­£ç”Ÿæ•ˆï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›å¯ä»¥é€‰æ‹©æœ€é«˜æ•ˆçš„ç´¢å¼•ã€‚å¦‚æœä¸€ä¸ªè¡¨å»ºç«‹å¤ªå¤šçš„ç´¢å¼•ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢çš„æ—¶å€™SQLiteå¯èƒ½ä¸ä¼šé€‰æ‹©æœ€å¥½çš„æ¥æ‰§è¡Œã€‚</p>\n</li>\n<li>\n<p>å•åˆ—ç´¢å¼•ã€å¤šåˆ—ç´¢å¼•ä¸å¤åˆç´¢å¼•çš„é€‰æ‹©ã€‚ç´¢å¼•è¦ç»¼åˆæ•°æ®è¡¨ä¸­ä¸åŒçš„æŸ¥è¯¢ä¸æ’åºè¯­å¥ä¸€èµ·è€ƒè™‘ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœé›†è¿‡å¤§ï¼Œè¿˜æ˜¯å¸Œæœ›å¯ä»¥é€šè¿‡å¤åˆç´¢å¼•ç›´æ¥åœ¨ç´¢å¼•è¡¨è¿”å›æŸ¥è¯¢ç»“æœã€‚</p>\n</li>\n<li>\n<p>ç´¢å¼•å­—æ®µçš„é€‰æ‹©ã€‚æ•´å‹ç±»å‹ç´¢å¼•æ•ˆç‡ä¼šè¿œé«˜äºå­—ç¬¦ä¸²ç´¢å¼•ï¼Œè€Œå¯¹äºä¸»é”®SQLiteä¼šé»˜è®¤å¸®æˆ‘ä»¬å»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®å°½é‡ä¸è¦ç”¨å¤æ‚å­—æ®µã€‚</p>\n</li>\n</ul><p><strong>æ€»çš„æ¥è¯´ç´¢å¼•ä¼˜åŒ–æ˜¯SQLiteä¼˜åŒ–ä¸­æœ€ç®€å•åŒæ—¶ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ç®€å•çš„å»ºä¸€ä¸ªç´¢å¼•å°±å¯ä»¥äº†ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´æŸ¥è¯¢è¯­å¥ç”šè‡³æ˜¯è¡¨çš„ç»“æ„ï¼Œè¿™æ ·æ‰èƒ½è¾¾åˆ°æœ€å¥½çš„æ•ˆæœã€‚</strong></p><p><strong>é¡µå¤§å°ä¸ç¼“å­˜å¤§å°</strong></p><p>åœ¨I/Oæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæˆ‘è®²è¿‡æ•°æ®åº“å°±åƒä¸€ä¸ªå°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œäº‹å®ä¸Šå®ƒå†…éƒ¨ä¹Ÿæœ‰é¡µå’Œç¼“å­˜çš„æ¦‚å¿µã€‚</p><p>å¯¹äºSQLiteçš„DBæ–‡ä»¶æ¥è¯´ï¼Œé¡µï¼ˆpageï¼‰æ˜¯æœ€å°çš„å­˜å‚¨å•ä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºæ¯ä¸ªè¡¨å¯¹åº”çš„æ•°æ®åœ¨æ•´ä¸ªDBæ–‡ä»¶ä¸­éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªä¸€ä¸ªçš„é¡µå­˜å‚¨ï¼Œå±äºåŒä¸€ä¸ªè¡¨ä¸åŒçš„é¡µä»¥Bæ ‘ï¼ˆB-treeï¼‰çš„æ–¹å¼ç»„ç»‡ç´¢å¼•ï¼Œæ¯ä¸€ä¸ªè¡¨éƒ½æ˜¯ä¸€æ£µBæ ‘ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/f3/c9b494da11233c98f2a54abfe2921ef3.png?wh=567*384\" alt=\"\"></p><p>è·Ÿæ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰ä¸€æ ·ï¼ŒSQLiteä¼šå°†è¯»è¿‡çš„é¡µç¼“å­˜èµ·æ¥ï¼Œç”¨æ¥åŠ å¿«ä¸‹ä¸€æ¬¡è¯»å–é€Ÿåº¦ã€‚é¡µå¤§å°é»˜è®¤æ˜¯1024Byteï¼Œç¼“å­˜å¤§å°é»˜è®¤æ˜¯1000é¡µã€‚æ›´å¤šçš„ç¼–è¯‘å‚æ•°ä½ å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£<a href=\"https://sqlite.org/pragma.html#pragma_journal_mode\">PRAGMA Statements</a>ã€‚</p><pre><code>PRAGMA page_size = 1024\nPRAGMA cache_size = 1000\n</code></pre><p>æ¯ä¸ªé¡µæ°¸è¿œåªå­˜æ”¾ä¸€ä¸ªè¡¨æˆ–è€…ä¸€ç»„ç´¢å¼•çš„æ•°æ®ï¼Œå³ä¸å¯èƒ½åŒä¸€ä¸ªé¡µå­˜æ”¾å¤šä¸ªè¡¨æˆ–ç´¢å¼•çš„æ•°æ®ï¼Œè¡¨åœ¨æ•´ä¸ªDBæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªé¡µå°±æ˜¯è¿™æ£µBæ ‘çš„æ ¹é¡µã€‚ç»§ç»­ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå¦‚æœæƒ³æŸ¥è¯¢rowIDä¸ºN+2çš„æ•°æ®ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ä»sqlite_masteræŸ¥æ‰¾å‡ºtableçš„root pageçš„ä½ç½®ï¼Œç„¶åè¯»å–root pageã€page4è¿™ä¸¤ä¸ªé¡µï¼Œæ‰€ä»¥ä¸€å…±ä¼šéœ€è¦3æ¬¡I/Oã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f2/1c/f232cbaff34236a1933182a02c685a1c.png?wh=696*468\" alt=\"\"></p><p>ä»ä¸Šè¡¨å¯ä»¥çœ‹åˆ°ï¼Œå¢å¤§page sizeå¹¶ä¸èƒ½ä¸æ–­åœ°æå‡æ€§èƒ½ï¼Œåœ¨æ‹ç‚¹ä»¥åå¯èƒ½è¿˜ä¼šæœ‰å‰¯ä½œç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡PRAGMAæ”¹å˜é»˜è®¤page sizeçš„å¤§å°ï¼Œä¹Ÿå¯ä»¥å†åˆ›å»ºDBæ–‡ä»¶çš„æ—¶å€™è¿›è¡Œè®¾ç½®ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„å¦‚æœå­˜åœ¨è€çš„æ•°æ®ï¼Œéœ€è¦è°ƒç”¨vacuumå¯¹æ•°æ®è¡¨å¯¹åº”çš„èŠ‚ç‚¹é‡æ–°è®¡ç®—åˆ†é…å¤§å°ã€‚</p><p>åœ¨å¾®ä¿¡çš„å†…éƒ¨æµ‹è¯•ä¸­ï¼Œå¦‚æœä½¿ç”¨4KBçš„page sizeæ€§èƒ½æå‡å¯ä»¥åœ¨5%ï½10%ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å†å²æ•°æ®çš„è¿ç§»æˆæœ¬ï¼Œæœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨1024Byteã€‚<strong>æ‰€ä»¥è¿™é‡Œå»ºè®®å¤§å®¶åœ¨æ–°å»ºæ•°æ®åº“çš„æ—¶å€™ï¼Œå°±æå‰é€‰æ‹©4KBä½œä¸ºé»˜è®¤çš„page sizeä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</strong></p><p><strong>å…¶ä»–ä¼˜åŒ–</strong></p><p>å…³äºSQLiteçš„ä½¿ç”¨ä¼˜åŒ–è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œä¸‹é¢æˆ‘ç®€å•æå‡ ä¸ªç‚¹ã€‚</p><ul>\n<li>\n<p>æ…ç”¨â€œ<code>select*</code>â€ï¼Œéœ€è¦ä½¿ç”¨å¤šå°‘åˆ—ï¼Œå°±é€‰å–å¤šå°‘åˆ—ã€‚</p>\n</li>\n<li>\n<p>æ­£ç¡®åœ°ä½¿ç”¨äº‹åŠ¡ã€‚</p>\n</li>\n<li>\n<p>é¢„ç¼–è¯‘ä¸å‚æ•°ç»‘å®šï¼Œç¼“å­˜è¢«ç¼–è¯‘åçš„SQLè¯­å¥ã€‚</p>\n</li>\n<li>\n<p>å¯¹äºblobæˆ–è¶…å¤§çš„Textåˆ—ï¼Œå¯èƒ½ä¼šè¶…å‡ºä¸€ä¸ªé¡µçš„å¤§å°ï¼Œå¯¼è‡´å‡ºç°è¶…å¤§é¡µã€‚å»ºè®®å°†è¿™äº›åˆ—å•ç‹¬æ‹†è¡¨ï¼Œæˆ–è€…æ”¾åˆ°è¡¨å­—æ®µçš„åé¢ã€‚</p>\n</li>\n<li>\n<p>å®šæœŸæ•´ç†æˆ–è€…æ¸…ç†æ— ç”¨æˆ–å¯åˆ é™¤çš„æ•°æ®ï¼Œä¾‹å¦‚æœ‹å‹åœˆæ•°æ®åº“ä¼šåˆ é™¤æ¯”è¾ƒä¹…è¿œçš„æ•°æ®ï¼Œå¦‚æœç”¨æˆ·è®¿é—®åˆ°è¿™éƒ¨åˆ†æ•°æ®ï¼Œé‡æ–°ä»ç½‘ç»œæ‹‰å–å³å¯ã€‚</p>\n</li>\n</ul><p>åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å¯¹è¿™äº›çŸ¥è¯†æœ‰æ‰€äº†è§£ï¼Œå†æ¥å¤ä¹ ä¸€ä¸‹ä¸Šé¢å­¦åˆ°çš„SQLiteä¼˜åŒ–æ–¹æ³•ã€‚<strong>é€šè¿‡å¼•è¿›ORMï¼Œå¯ä»¥å¤§å¤§çš„æå‡æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚é€šè¿‡WALæ¨¡å¼å’Œè¿æ¥æ± ï¼Œå¯ä»¥æé«˜SQLiteçš„å¹¶å‘æ€§èƒ½ã€‚é€šè¿‡æ­£ç¡®çš„å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æå‡SQLiteçš„æŸ¥è¯¢é€Ÿåº¦ã€‚é€šè¿‡è°ƒæ•´é»˜è®¤çš„é¡µå¤§å°å’Œç¼“å­˜å¤§å°ï¼Œå¯ä»¥æå‡SQLiteçš„æ•´ä½“æ€§èƒ½ã€‚</strong></p><h2>SQLiteçš„å…¶ä»–ç‰¹æ€§</h2><p>é™¤äº†SQLiteçš„ä¼˜åŒ–ç»éªŒï¼Œæˆ‘åœ¨å¾®ä¿¡çš„å·¥ä½œä¸­è¿˜ç§¯ç´¯äº†å¾ˆå¤šä½¿ç”¨çš„ç»éªŒï¼Œä¸‹é¢æˆ‘æŒ‘é€‰äº†å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç»éªŒæŠŠå®ƒåˆ†äº«ç»™ä½ ã€‚</p><p><strong>1. æŸåä¸æ¢å¤</strong></p><p>å¾®ä¿¡ä¸­SQLiteçš„æŸè€—ç‡åœ¨1/20000ï½1/10000å·¦å³ï¼Œè™½ç„¶çœ‹èµ·æ¥å¾ˆä½ï¼Œä¸è¿‡æ„è€ƒè™‘åˆ°å¾®ä¿¡çš„ä½“é‡ï¼Œè¿™ä¸ªé—®é¢˜è¿˜æ˜¯ä¸å®¹å¿½è§†çš„ã€‚ç‰¹åˆ«æ˜¯å¦‚æœæŸäº›å¤§ä½¬çš„èŠå¤©è®°å½•ä¸¢å¤±ï¼Œæˆ‘ä»¬å›¢é˜Ÿéƒ½ä¼šæ‰¿å—è¶…å¤§çš„å‹åŠ›ã€‚</p><p>åˆ›æ–°æ˜¯ä¸ºäº†è§£å†³ç„¦è™‘ï¼ŒæŠ€æœ¯éƒ½æ˜¯é€¼å‡ºæ¥çš„ã€‚å¯¹äºSQLiteæŸåä¸æ¢å¤çš„ç ”ç©¶ï¼Œå¯ä»¥è¯´æ˜¯å¾®ä¿¡æŠ•å…¥æ¯”è¾ƒå¤§çš„ä¸€å—ã€‚å…³äºSQLiteæ•°æ®åº“çš„æŸè€—ä¸ä¿®å¤ï¼Œä»¥åŠå¾®ä¿¡åœ¨è¿™é‡Œçš„ä¼˜åŒ–æˆæœï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›èµ„æ–™ã€‚</p><ul>\n<li>\n<p><a href=\"https://sqlite.org/howtocorrupt.html\">How To Corrupt An SQLite Database File</a></p>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s/N1tuHTyg3xVfbaSd4du-tw\">å¾®ä¿¡ SQLite æ•°æ®åº“ä¿®å¤å®è·µ</a></p>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s/Ln7kNOn3zx589ACmn5ESQA\">å¾®ä¿¡ç§»åŠ¨ç«¯æ•°æ®åº“ç»„ä»¶WCDBç³»åˆ—ï¼ˆäºŒï¼‰ â€” æ•°æ®åº“ä¿®å¤ä¸‰æ¿æ–§</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/Tencent/wcdb/wiki/Android%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E5%A4%8D\">WCDB Androidæ•°æ®åº“ä¿®å¤</a></p>\n</li>\n</ul><p><strong>2. åŠ å¯†ä¸å®‰å…¨</strong></p><p>æ•°æ®åº“çš„å®‰å…¨ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯é˜²æ³¨å…¥ï¼Œä¸€ä¸ªæ˜¯åŠ å¯†ã€‚é˜²æ³¨å…¥å¯ä»¥é€šè¿‡é™æ€å®‰å…¨æ‰«æçš„æ–¹å¼ï¼Œè€ŒåŠ å¯†ä¸€èˆ¬ä¼šä½¿ç”¨SQLCipheræ”¯æŒã€‚</p><p>SQLiteçš„åŠ è§£å¯†éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œé»˜è®¤ä¼šä½¿ç”¨AESç®—æ³•åŠ å¯†ï¼ŒåŠ /è§£å¯†çš„è€—æ—¶è·Ÿé€‰ç”¨çš„å¯†é’¥é•¿åº¦æœ‰å…³ã€‚ä¸‹é¢æ˜¯<a href=\"https://github.com/Tencent/wcdb/wiki/Android-Benchmark\">WCDB Android Benchmark</a>çš„æ•°æ®ï¼Œè¯¦ç»†çš„ä¿¡æ¯è¯·æŸ¥çœ‹é“¾æ¥é‡Œçš„è¯´æ˜ï¼Œä»ç»“è®ºæ¥è¯´å¯¹Createæ¥è¯´å½±å“ä¼šé«˜è¾¾åˆ°10å€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/81/5f5ac545e346a45f1c3fcfa504300b81.png?wh=1302*402\" alt=\"\"></p><p>å…³äºWCDBåŠ è§£å¯†çš„ä½¿ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://mp.weixin.qq.com/s/NFnYEXSxAaHBqpi7WofSPQ\">ã€Šå¾®ä¿¡ç§»åŠ¨æ•°æ®åº“ç»„ä»¶WCDBï¼ˆå››ï¼‰ â€” Android ç‰¹æ€§ç¯‡ã€‹</a>ã€‚</p><p><strong>3. å…¨æ–‡æœç´¢</strong></p><p>å¾®ä¿¡çš„å…¨æ–‡æœç´¢ä¹Ÿæ˜¯ä¸€ä¸ªæŠ€æœ¯å¯¼å‘çš„é¡¹ç›®ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æ€§èƒ½å¹¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œç»å¸¸ä¼šè¢«äººâ€œæ‰¹æ–—â€ã€‚ç»è¿‡å‡ ä¸ªç‰ˆæœ¬çš„ä¼˜åŒ–è¿­ä»£ï¼Œç›®å‰çœ‹æ•ˆæœè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/d9/d2a09d040d0d915e78d7598457d6d1d9.png?wh=1038*574\" alt=\"\"></p><p>å…³äºå…¨æ–‡æœç´¢ï¼Œä½ å¯ä»¥å‚è€ƒè¿™äº›èµ„æ–™ï¼š</p><ul>\n<li>\n<p><a href=\"https://sqlite.org/fts3.html\">SQLite FTS3 and FTS4 Extensions</a></p>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s/AhYECT3HVyn1ikB0YQ-UVg\">å¾®ä¿¡å…¨æ–‡æœç´¢ä¼˜åŒ–ä¹‹è·¯</a></p>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s/GCznwCtjJ2XUszyMcbNz8Q\">ç§»åŠ¨å®¢æˆ·ç«¯å¤šéŸ³å­—æœç´¢</a></p>\n</li>\n</ul><p><strong>å…³äºSQLiteçš„è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„é¡¹ç›®æƒ…å†µç»¼åˆè€ƒè™‘ã€‚å‡å¦‚æŸä¸ªæ•°æ®åº“å­˜å‚¨çš„æ•°æ®å¹¶ä¸é‡è¦ï¼Œè¿™ä¸ªæ—¶å€™ä¸‡åˆ†ä¹‹ä¸€çš„æ•°æ®æŸåç‡æˆ‘ä»¬å¹¶ä¸ä¼šå…³å¿ƒã€‚åŒæ ·æ˜¯å¦éœ€è¦ä½¿ç”¨æ•°æ®åº“åŠ å¯†ï¼Œä¹Ÿè¦æ ¹æ®å­˜å‚¨çš„æ•°æ®æ˜¯ä¸æ˜¯æ•æ„Ÿå†…å®¹ã€‚</strong></p><h2>SQLiteçš„ç›‘æ§</h2><p>é¦–å…ˆæˆ‘æƒ³è¯´ï¼Œæ­£ç¡®ä½¿ç”¨ç´¢å¼•ï¼Œæ­£ç¡®ä½¿ç”¨äº‹åŠ¡ã€‚å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œå‚ä¸çš„å¼€å‘äººå‘˜å¯èƒ½æœ‰å‡ åå‡ ç™¾äººï¼Œå¼€å‘äººå‘˜æ°´å¹³å‚å·®ä¸é½ï¼Œå¾ˆéš¾ä¿è¯æ¯ä¸ªäººéƒ½å¯ä»¥æ­£ç¡®è€Œé«˜æ•ˆåœ°ä½¿ç”¨SQLiteï¼Œæ‰€ä»¥è¿™æ¬¡æ—¶å€™éœ€è¦å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ã€‚</p><p><strong>1. æœ¬åœ°æµ‹è¯•</strong></p><p>ä½œä¸ºä¸€åé è°±çš„å¼€å‘å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬æ¯å†™ä¸€ä¸ªSQLè¯­å¥ï¼Œéƒ½åº”è¯¥å…ˆåœ¨æœ¬åœ°æµ‹è¯•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ EXPLAIN QUERY PLANæµ‹è¯•SQLè¯­å¥çš„æŸ¥è¯¢è®¡åˆ’ï¼Œæ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯ä½¿ç”¨äº†ç´¢å¼•ï¼Œä»¥åŠå…·ä½“ä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ç­‰ã€‚</p><pre><code>sqlite&gt; EXPLAIN QUERY PLAN SELECT * FROM t1 WHERE a=1 AND b&gt;2;\nQUERY PLAN\n|--SEARCH TABLE t1 USING INDEX i2 (a=? AND b&gt;?)\n</code></pre><p>å…³äºSQLiteå‘½ä»¤è¡Œä¸EXPLAIN QUERY PLANçš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://sqlite.org/cli.html\">Command Line Shell For SQLite</a>ä»¥åŠ<a href=\"https://sqlite.org/eqp.html\">EXPLAIN QUERY PLAN</a>ã€‚</p><p><strong>2. è€—æ—¶ç›‘æ§</strong></p><p>æœ¬åœ°æµ‹è¯•è¿‡äºä¾èµ–å¼€å‘äººå‘˜çš„è‡ªè§‰æ€§ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¾ç„¶éœ€è¦å»ºç«‹çº¿ä¸Šå¤§æ•°æ®çš„ç›‘æ§ã€‚å› ä¸ºå¾®ä¿¡é›†æˆäº†è‡ªå·±çš„SQLiteæºç ï¼Œæ‰€ä»¥å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¢åŠ è‡ªå·±æƒ³è¦çš„ç›‘æ§æ¨¡å—ã€‚</p><p>WCDBå¢åŠ äº†<a href=\"https://tencent.github.io/wcdb/references/android/reference/com/tencent/wcdb/database/SQLiteTrace.html\">SQLiteTrace</a>çš„ç›‘æ§æ¨¡å—ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªæ¥å£ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/8a/f3f0b4b43e4911dc0655694fca90358a.png?wh=1288*324\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›æ¥å£ç›‘æ§æ•°æ®åº“busyã€æŸè€—ä»¥åŠæ‰§è¡Œè€—æ—¶ã€‚é’ˆå¯¹è€—æ—¶æ¯”è¾ƒé•¿çš„SQLè¯­å¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥æ˜¯SQLè¯­å¥å†™å¾—ä¸å¥½ï¼Œè¿˜æ˜¯éœ€è¦å»ºç«‹ç´¢å¼•ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/12/5d/12c3d1b494fc4fb60fa0a429a8ff805d.png?wh=588*246\" alt=\"\"></p><p><strong>3. æ™ºèƒ½ç›‘æ§</strong></p><p>å¯¹äºæŸ¥è¯¢ç»“æœçš„ç›‘æ§åªæ˜¯æˆ‘ä»¬ç›‘æ§æ¼”è¿›çš„ç¬¬äºŒé˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬ä¾ç„¶éœ€è¦äººå·¥ä»‹å…¥åˆ†æï¼Œè€Œä¸”éœ€è¦æ¯”è¾ƒæœ‰ç»éªŒçš„äººå‘˜è´Ÿè´£ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›SQLè¯­å¥çš„åˆ†æå¯ä»¥åšåˆ°æ™ºèƒ½åŒ–ï¼Œæ˜¯å®Œå…¨ä¸éœ€è¦é—¨æ§›çš„ã€‚å¾®ä¿¡å¼€æºçš„Matrixé‡Œé¢å°±æœ‰ä¸€ä¸ªæ™ºèƒ½åŒ–åˆ†æSQLiteè¯­å¥çš„å·¥å…·ï¼š<a href=\"https://mp.weixin.qq.com/s/laUgOmAcMiZIOfM2sWrQgw\">Matrix SQLiteLint â€“ SQLite ä½¿ç”¨è´¨é‡æ£€æµ‹</a>ã€‚<strong>å®ƒæ ¹æ®åˆ†æSQLè¯­å¥çš„è¯­æ³•æ ‘ï¼Œç»“åˆæˆ‘ä»¬æ—¥å¸¸æ•°æ®åº“ä½¿ç”¨çš„ç»éªŒï¼ŒæŠ½è±¡å‡ºç´¢å¼•ä½¿ç”¨ä¸å½“ã€<code>select*</code>ç­‰å…­å¤§é—®é¢˜ã€‚</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/a4/81/a40411af3c91c9d58cac27f4f53aaa81.png?wh=940*380\" alt=\"\"></p><p>å¯èƒ½æœ‰åŒå­¦ä¼šæ„Ÿå¹ä¸ºä»€ä¹ˆå¾®ä¿¡çš„äººå¯ä»¥æƒ³åˆ°è¿™æ ·çš„æ–¹å¼ï¼Œäº‹å®ä¸Šè¿™ä¸ªæ€è·¯åœ¨MySQLä¸­æ˜¯éå¸¸å¸¸è§çš„åšæ³•ã€‚ç¾å›¢ä¹Ÿå¼€æºäº†å®ƒä»¬å†…éƒ¨çš„SQLä¼˜åŒ–å·¥å…·SQLAdvisorï¼Œä½ å¯ä»¥å‚è€ƒè¿™äº›èµ„æ–™ï¼š</p><ul>\n<li>\n<p><a href=\"https://tech.meituan.com/SQL_parser_used_in_mtdp.html\">SQLè§£æåœ¨ç¾å›¢çš„åº”ç”¨</a></p>\n</li>\n<li>\n<p><a href=\"https://tech.meituan.com/sqladvisor_pr.html\">ç¾å›¢ç‚¹è¯„SQLä¼˜åŒ–å·¥å…·SQLAdvisorå¼€æº</a></p>\n</li>\n</ul><h2>æ€»ç»“</h2><p>æ•°æ®åº“å­˜å‚¨æ˜¯ä¸€ä¸ªå¼€å‘äººå‘˜çš„åŸºæœ¬åŠŸï¼Œæ¸…æ¥šSQLiteçš„åº•å±‚æœºåˆ¶å¯¹æˆ‘ä»¬çš„å·¥ä½œä¼šæœ‰å¾ˆå¤§çš„æŒ‡å¯¼æ„ä¹‰ã€‚</p><p>æŒæ¡äº†SQLiteæ•°æ®åº“å¹¶å‘çš„æœºåˆ¶ï¼Œåœ¨æŸäº›æ—¶å€™æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°å†³ç­–åº”è¯¥æ‹†æ•°æ®è¡¨è¿˜æ˜¯æ‹†æ•°æ®åº“ã€‚æ–°å»ºä¸€ä¸ªæ•°æ®åº“å¥½å¤„æ˜¯å¯ä»¥éš”ç¦»å…¶ä»–åº“å¹¶å‘æˆ–è€…æŸåçš„æƒ…å†µï¼Œè€Œåå¤„æ˜¯æ•°æ®åº“åˆå§‹åŒ–è€—æ—¶ä»¥åŠæ›´å¤šå†…å­˜çš„å ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå•ç‹¬çš„ä¸šåŠ¡éƒ½ä¼šä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼Œä¾‹å¦‚ä¸“é—¨çš„ä¸‹è½½æ•°æ®åº“ã€æœ‹å‹åœˆæ•°æ®åº“ã€èŠå¤©æ•°æ®åº“ã€‚ä½†æ˜¯æ•°æ®åº“ä¹Ÿä¸å®œå¤ªå¤šï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªå…¬å…±æ•°æ®åº“ï¼Œç”¨æ¥å­˜æ”¾ä¸€äº›ç›¸å¯¹ä¸æ˜¯å¤ªå¤§çš„æ•°æ®ã€‚</p><p>åœ¨äº†è§£SQLiteæ•°æ®åº“æŸåçš„åŸç†å’Œæ¦‚ç‡ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°æ®çš„é‡è¦ç¨‹åº¦å†³å®šæ˜¯å¦è¦å¼•å…¥æ¢å¤æœºåˆ¶ã€‚æˆ‘è¿˜è®²äº†å¦‚ä½•å®ç°æ•°æ®åº“åŠ å¯†ä»¥åŠå¯¹æ€§èƒ½çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°æ®çš„æ•æ„Ÿç¨‹åº¦å†³å®šæ˜¯å¦è¦å¼•å…¥åŠ å¯†ã€‚</p><p>æœ€åæˆ‘å†å¼ºè°ƒä¸€ä¸‹ï¼ŒSQLiteä¼˜åŒ–çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œåœ¨è¯¾åä½ è¿˜éœ€è¦ç»“åˆå‚è€ƒèµ„æ–™å†è¿›ä¸€æ­¥åå¤å­¦ä¹ ï¼Œæ‰èƒ½æŠŠä»Šå¤©çš„å†…å®¹ç†è§£é€å½»ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>åœ¨ä½ çš„åº”ç”¨ä¸­æ˜¯å¦ä½¿ç”¨æ•°æ®åº“å­˜å‚¨å‘¢ï¼Œä½¿ç”¨äº†å“ªç§æ•°æ®åº“ï¼Ÿæ˜¯å¦ä½¿ç”¨ORMï¼Ÿåœ¨ä½¿ç”¨æ•°æ®åº“è¿‡ç¨‹ä¸­ä½ æœ‰å“ªäº›ç–‘é—®æˆ–è€…ç»éªŒå‘¢ï¼Ÿæ¬¢è¿ç•™è¨€è·Ÿæˆ‘å’Œå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚</p><p>å¦‚æœä½ çš„åº”ç”¨ä¹Ÿåœ¨ä½¿ç”¨SQLiteå­˜å‚¨ï¼Œä»Šå¤©çš„è¯¾åç»ƒä¹ æ˜¯å°è¯•æ¥å…¥WCDBï¼Œå¯¹æ¯”æµ‹è¯•ç³»ç»Ÿé»˜è®¤SQLiteçš„æ€§èƒ½ã€‚å°è¯•æ¥å…¥<a href=\"https://github.com/Tencent/matrix/tree/master/matrix/matrix-android/matrix-sqlite-lint\">Matrix SQLiteLint</a>ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä¸åˆç†çš„SQLiteä½¿ç”¨ã€‚</p><p>é™¤äº†ä»Šå¤©æ–‡ç« ä¸­çš„å‚è€ƒèµ„æ–™ï¼Œæˆ‘è¿˜ç»™å¸Œæœ›è¿›é˜¶çš„åŒå­¦å‡†å¤‡äº†ä¸‹é¢çš„èµ„æ–™ï¼Œæ¬¢è¿æœ‰å…´è¶£çš„åŒå­¦ç»§ç»­æ·±å…¥å­¦ä¹ ã€‚</p><ul>\n<li>\n<p><a href=\"https://sqlite.org/docs.html\">SQLiteå®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li>\n<p><a href=\"http://huili.github.io/sqlite/sqliteintro.html\">SQLiteæºç åˆ†æ</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/AndroidAdvanceWithGeektime/Chapter14/blob/master/%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90SQLite.pdf\">å…¨é¢è§£æSQLite</a></p>\n</li>\n<li>\n<p>å›¾ä¹¦ã€ŠSQLiteæƒå¨æŒ‡å—ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹</p>\n</li>\n</ul><p>æ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™å¥½å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ã€‚æœ€ååˆ«å¿˜äº†åœ¨è¯„è®ºåŒºæäº¤ä»Šå¤©çš„ä½œä¸šï¼Œæˆ‘ä¹Ÿä¸ºè®¤çœŸå®Œæˆä½œä¸šçš„åŒå­¦å‡†å¤‡äº†ä¸°åšçš„â€œå­¦ä¹ åŠ æ²¹ç¤¼åŒ…â€ï¼ŒæœŸå¾…ä¸ä½ ä¸€èµ·åˆ‡ç£‹è¿›æ­¥å“¦ã€‚</p><p></p>","neighbors":{"left":{"article_title":"13 | å­˜å‚¨ä¼˜åŒ–ï¼ˆä¸­ï¼‰ï¼šå¦‚ä½•ä¼˜åŒ–æ•°æ®å­˜å‚¨ï¼Ÿ","id":76985},"right":{"article_title":"15 | ç½‘ç»œä¼˜åŒ–ï¼ˆä¸Šï¼‰ï¼šç§»åŠ¨å¼€å‘å·¥ç¨‹å¸ˆå¿…å¤‡çš„ç½‘ç»œä¼˜åŒ–çŸ¥è¯†","id":77990}},"comments":[{"had_liked":false,"id":74611,"user_name":"HI","can_delete":false,"product_type":"c1","uid":1238921,"ip_address":"","ucode":"C65218113883E6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/89/207cc841.jpg","comment_is_top":false,"comment_ctime":1552267260,"is_pvip":true,"replies":[{"id":"31126","content":"è¿™äº›éƒ½æ˜¯ä¸€äº›æ‹è„‘è¢‹çš„ç»éªŒå€¼è€Œå·²ï¼Œä¹Ÿå¯ä»¥åœ¨GitHubä¸Šé¢æissue","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555400725,"ip_address":"","comment_id":74611,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10142201852","product_id":100021101,"comment_content":"å¤§è‡´çš„çœ‹äº†Matrix SQLiteLintçš„æºç å®ç°ï¼Œç”±äºAndrod N hook sqlite3_profile ä¼šå‡ºç°é—®é¢˜ï¼ŒSQLiteLint å¹¶ä¸èƒ½å®æ—¶çš„è·å–åˆ°sqlè¯­å¥ï¼Œè€Œæ˜¯é‡‡ç”¨javaå±‚ä¸»åŠ¨çš„å‘ŠçŸ¥SQLiteLint è¦åˆ†æçš„sqlï¼Œæ¯”å¦‚åˆ†æ select *ï¼ŒPrepareStatementï¼Œ è€Œå¯¹äºæ£€æµ‹ Autoincrementï¼Œå†—ä½™ç´¢å¼•ï¼ŒWithout RowId è€Œæ˜¯é€šè¿‡nativeå±‚å‘ŠçŸ¥javaå±‚è¦æŸ¥è¯¢çš„å†…å®¹ï¼Œjavaå±‚å°†æŸ¥è¯¢ä¹‹åçš„å†…å®¹å†é€šçŸ¥nativeå±‚ï¼Œè¿™ä¸ªæ£€æµ‹çš„æ—¶é—´é—´éš”ä¸º4ç§’ï¼Œè¿™4ç§’æ˜¯æœ‰ä»€ä¹ˆä¾æ®çš„å—","like_count":3,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442617,"discussion_content":"è¿™äº›éƒ½æ˜¯ä¸€äº›æ‹è„‘è¢‹çš„ç»éªŒå€¼è€Œå·²ï¼Œä¹Ÿå¯ä»¥åœ¨GitHubä¸Šé¢æissue","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555400725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67657,"user_name":"é»„å°æœ¨ğŸµ","can_delete":false,"product_type":"c1","uid":1184870,"ip_address":"","ucode":"ED35D90A9BD157","user_header":"https://static001.geekbang.org/account/avatar/00/12/14/66/96f8d2b1.jpg","comment_is_top":false,"comment_ctime":1550218601,"is_pvip":false,"replies":[{"id":"30693","content":"ormliteåº”è¯¥æ˜¯ORMæ¡†æ¶ï¼Œè·Ÿåº•å±‚çš„wcdbåº”è¯¥æ˜¯ä¸å†²çªçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555137531,"ip_address":"","comment_id":67657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845185897","product_id":100021101,"comment_content":"å¼ è€å¸ˆå¥½ï¼Œæä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¡¹ç›®å½“å‰ç”¨çš„æ˜¯ormliteå…³ç³»å‹æ•°æ®åº“æ¡†æ¶ï¼Œå·²ç»åˆ©ç”¨é‡Œé¢çš„apiå†™äº†å¤§é‡sqlè¯­å¥ï¼Œè¯·é—®å¦‚ä½•æœ€ä½æˆæœ¬çš„æ›¿æ¢æˆwcdbå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439309,"discussion_content":"ormliteåº”è¯¥æ˜¯ORMæ¡†æ¶ï¼Œè·Ÿåº•å±‚çš„wcdbåº”è¯¥æ˜¯ä¸å†²çªçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555137531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332957,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1643880881,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1643880881","product_id":100021101,"comment_content":"æˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œè€å¸ˆçœ‹ä¸‹æ˜¯å¦åˆç†ï¼ŒæŠŠMySQLï¼ˆinnodbï¼‰è¿™å¥—å…¨éƒ¨æ”¾åˆ°ç§»åŠ¨ç«¯æ¥ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯MySQLæ˜¯C&#47;Sæ¨¡å‹ï¼Œè®¿é—®æ–¹å¼ï¼ˆè¿æ¥å±‚ï¼‰æ”¹é€ ä¸‹ï¼Œæ”¹æˆç§»åŠ¨ç«¯ç±»ä¼¼sqliteçš„dbæ–‡ä»¶ç±»å‹ã€‚è¿™æ ·ï¼Œinnodbçš„è¡Œçº§é”å¯å¼ºå¤šäº†ï¼Œç„¶åMySQLæ€»ä½“æ˜¯å¤šçº¿ç¨‹è¯»å†™å¹¶å‘çš„ï¼Œä¸æ˜¯èƒ½æ›´å¥½åœ°æ¦¨å¹²ç§»åŠ¨ç«¯çš„æ€§èƒ½å—ï¼Ÿå¾®ä¿¡æœ‰è¿™ä¹ˆæƒ³è¿‡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":301387,"user_name":"JavanRhino","can_delete":false,"product_type":"c1","uid":1271312,"ip_address":"","ucode":"58D5673FB5D4A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/66/10/010ff1ab.jpg","comment_is_top":false,"comment_ctime":1625656247,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625656247","product_id":100021101,"comment_content":"PRAGMA SQLITE_THREADSAFE = 2 è¿™ä¸ªæ˜¯ç”¨javaä»£ç è®¾ç½®å—ï¼Ÿçœ‹æºç å¥½åƒæ²¡æœ‰æä¾›java apiå‘€","like_count":0},{"had_liked":false,"id":301225,"user_name":"JavanRhino","can_delete":false,"product_type":"c1","uid":1271312,"ip_address":"","ucode":"58D5673FB5D4A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/66/10/010ff1ab.jpg","comment_is_top":false,"comment_ctime":1625581271,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1625581271","product_id":100021101,"comment_content":"å¯¹äº iOS æ¥è¯´å¯èƒ½æ²¡æœ‰å¤šè¿›ç¨‹è®¿é—®æ•°æ®åº“çš„åœºæ™¯ï¼Œå¯ä»¥æŠŠ locking_mode çš„é»˜è®¤å€¼æ”¹ä¸º EXCLUSIVEã€‚<br>â€”â€”&gt;åº”è¯¥æ˜¯å¯¹äºAndroidæ¥è¯´å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2172917,"avatar":"","nickname":"Dora365","note":"","ucode":"3793B06E234F4E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393049,"discussion_content":"è¿™æœ¬æ¥å°±æ˜¯androidè¯¾ç¨‹ï¼Œä½ è·‘æ¥å‡‘ä»€ä¹ˆçƒ­é—¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631236451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260467,"user_name":"hs","can_delete":false,"product_type":"c1","uid":1135809,"ip_address":"","ucode":"136D2A4B25E847","user_header":"https://static001.geekbang.org/account/avatar/00/11/54/c1/1d852e91.jpg","comment_is_top":false,"comment_ctime":1605016387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605016387","product_id":100021101,"comment_content":"è€å¸ˆæƒ³é—®ä¸€ä¸‹è¿™å¥è¯çš„æ„æ€<br>â€œè¿˜æœ‰éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒåŒä¸€ä¸ªå¥æŸ„åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‰“å¼€è¿æ¥æ±  Connection Poolâ€  ä¸ºä»€ä¹ˆåŒä¸€ä¸ªå¥æŸ„åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œï¼Œå°±éœ€è¦å¼€å¯çº¿ç¨‹æ± ","like_count":0},{"had_liked":false,"id":186506,"user_name":"JeffMony","can_delete":false,"product_type":"c1","uid":1221877,"ip_address":"","ucode":"9AA0671C297604","user_header":"https://static001.geekbang.org/account/avatar/00/12/a4/f5/9ce95dd5.jpg","comment_is_top":false,"comment_ctime":1583854023,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583854023","product_id":100021101,"comment_content":"è¿™ç¯‡æ–‡ç« å¤ªæ·±äº†","like_count":0},{"had_liked":false,"id":167507,"user_name":"lbj","can_delete":false,"product_type":"c1","uid":1697899,"ip_address":"","ucode":"C4D6DFAAE164A7","user_header":"https://static001.geekbang.org/account/avatar/00/19/e8/6b/ce264eb0.jpg","comment_is_top":false,"comment_ctime":1577846201,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577846201","product_id":100021101,"comment_content":"æƒ³å’¨è¯¢ä¸ªé—®é¢˜ï¼Œcheckpointæ˜¯100pagesä¸€æ¬¡ï¼Œé‚£å‡å¦‚appçš„ç”Ÿå‘½å‘¨æœŸä¸­å¾€sqliteå†™çš„æ•°æ®åŠ èµ·æ¥éƒ½ä¸åˆ°100pagesï¼Œé‚£å³ä½¿appè¢«æ€æ­»äº†ä¹Ÿæ²¡åˆ°è§¦å‘checkpointçš„ä¸´ç•Œå€¼ï¼Œè¿™ä¸ªæ—¶å€™è¿™éƒ¨åˆ†æ•°æ®æ˜¯ç›´åˆ°næ¬¡appä½¿ç”¨ç§¯æ”’åˆ°100pagesåœ¨checkpointè¿˜æ˜¯æ€ä¹ˆå¤„ç†","like_count":0},{"had_liked":false,"id":160346,"user_name":"æ»¡å¤§å¤§","can_delete":false,"product_type":"c1","uid":1170022,"ip_address":"","ucode":"06DE739A6CE9EF","user_header":"https://static001.geekbang.org/account/avatar/00/11/da/66/5858322e.jpg","comment_is_top":false,"comment_ctime":1575939384,"is_pvip":true,"replies":[{"id":"62028","content":"SQLiteæœ‰æ¥å£çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1576677396,"ip_address":"","comment_id":160346,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575939384","product_id":100021101,"comment_content":"è€å¸ˆå®¢æˆ·ç«¯æ€ä¹ˆå¼€å¯WALæ¨¡å¼","like_count":1,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477346,"discussion_content":"SQLiteæœ‰æ¥å£çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576677396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144361,"user_name":"OF","can_delete":false,"product_type":"c1","uid":1329847,"ip_address":"","ucode":"1087485CFAB7A1","user_header":"https://static001.geekbang.org/account/avatar/00/14/4a/b7/a3468e61.jpg","comment_is_top":false,"comment_ctime":1571903805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571903805","product_id":100021101,"comment_content":"å“ï¼Œè¿™è¾ˆå­èµ¶ä¸ä¸Šå¤§ä½¬äº†","like_count":0},{"had_liked":false,"id":138465,"user_name":"è–¯æ¡","can_delete":false,"product_type":"c1","uid":1334064,"ip_address":"","ucode":"08E591FC62563A","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/30/83104f0f.jpg","comment_is_top":false,"comment_ctime":1570261258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570261258","product_id":100021101,"comment_content":"å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªdatabase å¯¹è±¡ï¼Œå‡å¦‚åœ¨æŸä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨äº†db.close æ–¹æ³•å°±ä¼šå‡ºç°é—®é¢˜ã€‚çœ‹äº†å¥½å¤šæ–¹æ¡ˆï¼Œï¼Œæœ€å¥½çš„å°±å¦‚æ–‡ç« æ‰€è¯´ï¼Œä¸å…³é—­db","like_count":0},{"had_liked":false,"id":138464,"user_name":"è–¯æ¡","can_delete":false,"product_type":"c1","uid":1334064,"ip_address":"","ucode":"08E591FC62563A","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/30/83104f0f.jpg","comment_is_top":false,"comment_ctime":1570260666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570260666","product_id":100021101,"comment_content":"æ—¶é—´å¼€å‘ä¸­ é‡åˆ°è¿‡ â€œå¤šçº¿ç¨‹æ“ä½œsqlite3 å¯¼è‡´æ•°æ®åº“æŸåçš„é—®é¢˜â€ æ²¡æƒ³åˆ° å¾®ä¿¡åœ¨è¿™å—åšäº†è¿™ä¹ˆå¤šåŠŸå¤«","like_count":0},{"had_liked":false,"id":136735,"user_name":"godliness","can_delete":false,"product_type":"c1","uid":1341267,"ip_address":"","ucode":"1C1976C39DCFE6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIuUYcwKWUuib5mpdIbTwQzTGNWBmk0ktZSwm2vteUXf4TxWF2aVCv7Hvshcq0OaG7JRLj6rJyPLicA/132","comment_is_top":false,"comment_ctime":1569500998,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569500998","product_id":100021101,"comment_content":"ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†™ä¹‹é—´æ˜¯ä»ç„¶ä¸èƒ½å¹¶å‘<br><br>Android ç³»ç»Ÿé»˜è®¤æä¾›çš„ SQLiteConnecionPool ï¼Œä¸»è¿æ¥åªæœ‰ä¸€ä¸ªï¼ˆå¯å†™çš„ï¼‰ï¼Œå¦åˆ™åœ¨ Java å±‚å¤šçº¿ç¨‹ç­‰å¾…ï¼ˆè¿™é‡Œæ˜¯ç­‰å¾…-é‡Šæ”¾-å”¤é†’ï¼‰ã€‚ä¸ä¼šå‡ºç° SQLiteDatabaseLockedException<br>","like_count":0,"discussions":[{"author":{"id":1329847,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4a/b7/a3468e61.jpg","nickname":"OF","note":"","ucode":"1087485CFAB7A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39183,"discussion_content":"å•è¿›ç¨‹å°±ç®—å¯ä»¥é€šè¿‡ï¼Œé‚£å¤šè¿›ç¨‹æ“ä½œå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571901365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117096,"user_name":"EchoSomeTH","can_delete":false,"product_type":"c1","uid":1602634,"ip_address":"","ucode":"E73F13BF09695F","user_header":"https://static001.geekbang.org/account/avatar/00/18/74/4a/2dd9d62a.jpg","comment_is_top":false,"comment_ctime":1563967283,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563967283","product_id":100021101,"comment_content":"18:56.100 2712-2732&#47;com.exampletest.liepin.chapter14_wcdb D&#47;SqliteLint.Native: Lint::Check checked cnt=2<br>2019-07-24 19:18:56.101 2712-2732&#47;com.exampletest.liepin.chapter14_wcdb V&#47;SqliteLint.Native: SqlInfoProcessor::ParseObj wildcard_sql_ = insert into message values(?)<br>2019-07-24 19:18:56.102 2712-2732&#47;com.exampletest.liepin.chapter14_wcdb V&#47;SqliteLint.Native: Lint::PreProcessSqlInfo processRet:ret:0<br>2019-07-24 19:18:56.103 2712-2732&#47;com.exampletest.liepin.chapter14_wcdb V&#47;SqliteLint.Native: Lint::Check() already checked recently<br>2019-07-24 19:18:56.110 2712-2732&#47;com.exampletest.liepin.chapter14_wcdb I&#47;SqliteLint.Native: Lint::TakeSqlInfo queue empty and wait<br><br>è¿™æ˜¯ 8.0 æ’å…¥ä¸€æ¡æ•°æ®ï¼Œè°ƒç”¨notifySqlExecutionæ‰å‡ºæ¥çš„ï¼Œè¿™ä¸ªå¥½åƒÂ·Â·Â·æ²¡æœ‰å•¥æœ‰ç”¨æ•°æ®æ’’","like_count":0},{"had_liked":false,"id":68111,"user_name":"L","can_delete":false,"product_type":"c1","uid":1330979,"ip_address":"","ucode":"8514C3CABFCC84","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/23/db8403c7.jpg","comment_is_top":false,"comment_ctime":1550416115,"is_pvip":false,"replies":[{"id":"31134","content":"å¯ä»¥çœ‹çœ‹ï¼šhttps:&#47;&#47;www.sqlite.org&#47;pragma.html#pragma_journal_mode<br><br>PRAGMA schema.synchronous; <br>PRAGMA schema.synchronous = 0 | OFF | 1 | NORMAL | 2 | FULL | 3 | EXTRA;<br><br>Query or change the setting of the &quot;synchronous&quot; flag. The first (query) form will return the synchronous setting as an integer. The second form changes the synchronous setting. The meanings of the various synchronous settings are as follows:<br><br>EXTRA (3)<br>EXTRA synchronous is like FULL with the addition that the directory containing a rollback journal is synced after that journal is unlinked to commit a transaction in DELETE mode. EXTRA provides additional durability if the commit is followed closely by a power loss.<br>FULL (2)<br>When synchronous is FULL (2), the SQLite database engine will use the xSync method of the VFS to ensure that all content is safely written to the disk surface prior to continuing. This ensures that an operating system crash or power failure will not corrupt the database. FULL synchronous is very safe, but it is also slower. FULL is the most commonly used synchronous setting when not in WAL mode.<br>NORMAL (1)<br>When synchronous is NORMAL (1), the SQLite database engine will still sync at the most critical moments, but less often than in FULL mode. There is a very small (though non-zero) chance that a power failure at just the wrong time could corrupt the database in journal_mode=DELETE on an older filesystem. WAL mode is safe from corruption with synchronous=NORMAL, and probably DELETE mode is safe too on modern filesystems. WAL mode is always consistent with synchronous=NORMAL, but WAL mode does lose durability. A transaction committed in WAL mode with synchronous=NORMAL might roll back following a power loss or system crash. Transactions are durable across application crashes regardless of the synchronous setting or journal mode. The synchronous=NORMAL setting is a good choice for most applications running in WAL mode.<br>OFF (0)<br>With synchronous OFF (0), SQLite continues without syncing as s","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555401701,"ip_address":"","comment_id":68111,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550416115","product_id":100021101,"comment_content":"sqlite wal mode wæ¨¡å¼sync mode å¯ä»¥ç›´æ¥ä¿®æ”¹æˆOFFï¼Ÿè‹¥ä¸è¡Œï¼Œæ€ä¹ˆè®ºè¯ï¼Ÿè°¢è°¢ï¼å› ä¸ºä¿®æ”¹æˆOFFå¯ä»¥å‡å°‘ DB fdatasync call","like_count":0,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439520,"discussion_content":"å¯ä»¥çœ‹çœ‹ï¼šhttps://www.sqlite.org/pragma.html#pragma_journal_mode\n\nPRAGMA schema.synchronous; \nPRAGMA schema.synchronous = 0 | OFF | 1 | NORMAL | 2 | FULL | 3 | EXTRA;\n\nQuery or change the setting of the &amp;quot;synchronous&amp;quot; flag. The first (query) form will return the synchronous setting as an integer. The second form changes the synchronous setting. The meanings of the various synchronous settings are as follows:\n\nEXTRA (3)\nEXTRA synchronous is like FULL with the addition that the directory containing a rollback journal is synced after that journal is unlinked to commit a transaction in DELETE mode. EXTRA provides additional durability if the commit is followed closely by a power loss.\nFULL (2)\nWhen synchronous is FULL (2), the SQLite database engine will use the xSync method of the VFS to ensure that all content is safely written to the disk surface prior to continuing. This ensures that an operating system crash or power failure will not corrupt the database. FULL synchronous is very safe, but it is also slower. FULL is the most commonly used synchronous setting when not in WAL mode.\nNORMAL (1)\nWhen synchronous is NORMAL (1), the SQLite database engine will still sync at the most critical moments, but less often than in FULL mode. There is a very small (though non-zero) chance that a power failure at just the wrong time could corrupt the database in journal_mode=DELETE on an older filesystem. WAL mode is safe from corruption with synchronous=NORMAL, and probably DELETE mode is safe too on modern filesystems. WAL mode is always consistent with synchronous=NORMAL, but WAL mode does lose durability. A transaction committed in WAL mode with synchronous=NORMAL might roll back following a power loss or system crash. Transactions are durable across application crashes regardless of the synchronous setting or journal mode. The synchronous=NORMAL setting is a good choice for most applications running in WAL mode.\nOFF (0)\nWith synchronous OFF ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555401701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60687,"user_name":"å˜¿ï¼ŒæŠ¬å¤´","can_delete":false,"product_type":"c1","uid":1328797,"ip_address":"","ucode":"1D36F7BA8C128F","user_header":"https://static001.geekbang.org/account/avatar/00/14/46/9d/79edce49.jpg","comment_is_top":false,"comment_ctime":1547530860,"is_pvip":false,"replies":[{"id":"22052","content":"è¾“å…¥ä¿¡æ¯å¤ªå°‘ï¼Œå¦‚æœæ˜¯å¿…ç°å¯ä»¥æ¯”è¾ƒå¥½æï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥é€šè¿‡sqlå‘½ä»¤è¡ŒæŸ¥è¯¢ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1548042231,"ip_address":"","comment_id":60687,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547530860","product_id":100021101,"comment_content":"å¼ è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼š<br>å¯åŠ¨ä¸€ä¸ªActivity,å¯ä»¥æŸ¥å‡ºæ•°æ®åº“ä¸­æ•°æ®ï¼Œä½†åˆ‡æ¢ä¸‹ç³»ç»Ÿè¯­è¨€ï¼ŒActivityé‡å¯ï¼Œå´æŸ¥ä¸å‡ºæ•°æ®åº“ä¸­çš„æ•°æ®ï¼ï¼ï¼ï¼ˆdebugçœ‹åˆ°ä¸¤æ¬¡éƒ½æ‰§è¡Œäº†æŸ¥è¯¢æ•°æ®åº“çš„ä»£ç ï¼‰<br>å¸Œæœ›æ‚¨æŒ‡ç‚¹ä¸€äºŒï¼Œè°¢è°¢~","like_count":1,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436585,"discussion_content":"è¾“å…¥ä¿¡æ¯å¤ªå°‘ï¼Œå¦‚æœæ˜¯å¿…ç°å¯ä»¥æ¯”è¾ƒå¥½æï¼Œè¿™ä¸ªå¯ä»¥ç›´æ¥é€šè¿‡sqlå‘½ä»¤è¡ŒæŸ¥è¯¢ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548042231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}