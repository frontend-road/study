{"id":151121,"title":"16 | keepalive与idle监测","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geek_netty\">https://gitee.com/geektime-geekbang/geek_netty</a></p>","comments":[{"had_liked":false,"id":168690,"user_name":"西西弗与卡夫卡","can_delete":false,"product_type":"c3","uid":1001710,"ip_address":"","ucode":"B4C27B8335B76A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/ee/96a7d638.jpg","comment_is_top":false,"comment_ctime":1578141054,"is_pvip":true,"replies":[{"id":65411,"content":"😄😄😄😄😄","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1578180735,"ip_address":"","comment_id":168690,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"你女朋友不断问你“你爱不爱我”，这就是一种keepalive，用来确认你还有没有活路。","like_count":23,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480299,"discussion_content":"😄😄😄😄😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578180735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1658796,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4f/ac/80439ba7.jpg","nickname":"Aprelude","note":"","ucode":"840D3F7A35AEEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611779,"discussion_content":"给我介绍女朋友","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680315328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193167,"avatar":"https://static001.geekbang.org/account/avatar/00/12/34/cf/0a316b48.jpg","nickname":"蝴蝶","note":"","ucode":"8019924D99182F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377788,"discussion_content":"我再也忘不了这个意思了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622859617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316167,"discussion_content":"醒醒醒醒，程序员哪来女朋友","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603370279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1248702,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ltu4XZ6MHlbeVk4Kt8aU4kPH7KK6FlTPwK5K6S1zX4y2wTF7J86SzFrfj6dDYkk1icgyPKiacUw0rcJvXucwPSKw/132","nickname":"yasin","note":"","ucode":"129D6B1B0A9A10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185920,"discussion_content":"😄飞哥这个比喻好形象","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582642604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202162,"user_name":"小马哥","can_delete":false,"product_type":"c3","uid":1107153,"ip_address":"","ucode":"376833AC2A1589","user_header":"https://static001.geekbang.org/account/avatar/00/10/e4/d1/002f9955.jpg","comment_is_top":false,"comment_ctime":1585913303,"is_pvip":false,"replies":[{"id":78843,"content":"说明你比较有探索精神，都搞过了，还学习，呵呵，很多人搞过，就说自己精通了，也不会再学习了，给你的学习精神点赞！","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1588057376,"ip_address":"","comment_id":202162,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"目前为至，听的很顺畅，上家公司从事过netty tcp ws 和 http 相关服务端的开发工作。总算没忘完，主要还是老师讲的好，先讲领域，再分析源码。感觉很对口！","like_count":7,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490522,"discussion_content":"说明你比较有探索精神，都搞过了，还学习，呵呵，很多人搞过，就说自己精通了，也不会再学习了，给你的学习精神点赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588057376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142264,"user_name":"Jerry Tan","can_delete":false,"product_type":"c3","uid":1625510,"ip_address":"","ucode":"FA93EAAF5926F2","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/a6/96cee976.jpg","comment_is_top":false,"comment_ctime":1571322174,"is_pvip":false,"replies":[{"id":57936,"content":"我最近也一直在线课程到底能给大家带来什么收获（对比直接百度），现在快结束了，反倒有信心了，因为我觉得多少都会有所收获的，因为netty覆盖的知识太多，总会有你能收益的地方。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573570780,"ip_address":"","comment_id":142264,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"之前也看过netty 的一些基础概念和视频，不过没有写过代码实战，希望通过这节课再提升一下自己..😜","like_count":5,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471050,"discussion_content":"我最近也一直在线课程到底能给大家带来什么收获（对比直接百度），现在快结束了，反倒有信心了，因为我觉得多少都会有所收获的，因为netty覆盖的知识太多，总会有你能收益的地方。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573570780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1799983,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/77/2f/6796cde2.jpg","nickname":"大维","note":"","ucode":"3EEEBEB92764AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351973,"discussion_content":"老师的课程内容干活多，这个是什么放🐶或者找百度看不到的。而且主要是课程内容体系化；长期来看，效率赛过去搜索和看短文。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614538792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147128,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1572813520,"is_pvip":false,"replies":[{"id":57238,"content":"一个永远牵着手，一个一会牵手一会断，http是基于tcp的，http的长连接是说它下面用的tcp连接一直连着，所有请求都复用这个传输通道，而http短连接，就是比如一个请求就建一个tcp连接，处理完就断了。实际上，一般我们现在经常用的是比如保持几分钟的长连接。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573047566,"ip_address":"","comment_id":147128,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师 http 长连接 http短连接  区别在哪里 还有tcp这个连接","like_count":4,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473160,"discussion_content":"一个永远牵着手，一个一会牵手一会断，http是基于tcp的，http的长连接是说它下面用的tcp连接一直连着，所有请求都复用这个传输通道，而http短连接，就是比如一个请求就建一个tcp连接，处理完就断了。实际上，一般我们现在经常用的是比如保持几分钟的长连接。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573047566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1368187,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e0/7b/dc8f673a.jpg","nickname":"pm:n","note":"","ucode":"725504D3DE942B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43002,"discussion_content":"http短连接是：浏览器打开一个TCP向服务器（tomcat,nginx等等）发送一个HTTP格式的请求，然后服务器回给浏览器HTTP响应，浏览器确认收到响应以后，就把这个TCP连接给关了。而长连接则是不关闭，下次如果我还要给这个服务器（tomcat,nginx等等）发送数据的时候我继续在这个TCP连接上发送和接收。这样会提高效率。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572840291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141876,"user_name":"鱼向北游","can_delete":false,"product_type":"c3","uid":1439908,"ip_address":"","ucode":"580EC7DCE57E9A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","comment_is_top":false,"comment_ctime":1571241687,"is_pvip":false,"replies":[{"id":54782,"content":"哈哈，因为我发现身边的人都经常混淆。所以想下，还是浪费一两分钟提下。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571270419,"ip_address":"","comment_id":141876,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师这个视频信息量特别大，心里正在默念http keepalive的时候 老师的tips就提了","like_count":3,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470923,"discussion_content":"哈哈，因为我发现身边的人都经常混淆。所以想下，还是浪费一两分钟提下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571270419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307889,"user_name":"人月聊IT","can_delete":false,"product_type":"c3","uid":1358609,"ip_address":"","ucode":"FDC7A0C6E08B02","user_header":"https://static001.geekbang.org/account/avatar/00/14/bb/11/28d86278.jpg","comment_is_top":false,"comment_ctime":1629293627,"is_pvip":false,"replies":[{"id":113840,"content":"谢谢肯定，很久没有看留言了！","user_name":"作者回复","user_name_real":"傅健","uid":1638649,"ctime":1632966678,"ip_address":"","comment_id":307889,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"这一课讲的实在是妙啊","like_count":2,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525328,"discussion_content":"谢谢肯定，很久没有看留言了！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632966678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142844,"user_name":"星愿","can_delete":false,"product_type":"c3","uid":1434022,"ip_address":"","ucode":"ADEF252DEEA84E","user_header":"https://static001.geekbang.org/account/avatar/00/15/e1/a6/311b8639.jpg","comment_is_top":false,"comment_ctime":1571558061,"is_pvip":false,"replies":[{"id":57881,"content":"这是两个不同的事情，因为一个服务不做keepalive和idle监控也能工作（或许会偶尔失败），但是监控还是需要做的，比如停电了。但是就像你用的词“借鉴”一样，思想倒是可以借鉴，在做监控的时候，你要划分下多个层次，比如机器的进程在不在，机器本身资源使用率，服务质量三个层次，Java的可以打开jmx做监控，然后监控的方式上，可以调用它提供的api或者自己写一个轻量级的任务定时去测试下，类似keepalive了：定时，轻量级。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573550532,"ip_address":"","comment_id":142844,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，rocktmq有没有办法去监控服务是不是挂了呢。跟这种模式是一样么，怎么借鉴呢","like_count":2,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471293,"discussion_content":"这是两个不同的事情，因为一个服务不做keepalive和idle监控也能工作（或许会偶尔失败），但是监控还是需要做的，比如停电了。但是就像你用的词“借鉴”一样，思想倒是可以借鉴，在做监控的时候，你要划分下多个层次，比如机器的进程在不在，机器本身资源使用率，服务质量三个层次，Java的可以打开jmx做监控，然后监控的方式上，可以调用它提供的api或者自己写一个轻量级的任务定时去测试下，类似keepalive了：定时，轻量级。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573550532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147127,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1572813477,"is_pvip":false,"replies":[{"id":57239,"content":"不管哪层的keepalive都算心跳，差不多一个意思，只是心跳的层次不同。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573047616,"ip_address":"","comment_id":147127,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师应用层的keeplive 就是心跳机制吧","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473159,"discussion_content":"不管哪层的keepalive都算心跳，差不多一个意思，只是心跳的层次不同。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573047616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142615,"user_name":"时光之刃","can_delete":false,"product_type":"c3","uid":1083381,"ip_address":"","ucode":"0F15CAD70BDDC3","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/f5/c6d1ffed.jpg","comment_is_top":false,"comment_ctime":1571413593,"is_pvip":false,"replies":[{"id":57882,"content":"一起努力，希望多少都有点收获！","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573550588,"ip_address":"","comment_id":142615,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"理论和源码结合还是挺有意思的，之前不懂理论看源码还是比较吃力的，期待学完后对netty能深入理解并运用","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471194,"discussion_content":"一起努力，希望多少都有点收获！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573550588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434022,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e1/a6/311b8639.jpg","nickname":"星愿","note":"","ucode":"ADEF252DEEA84E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37245,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571557950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142148,"user_name":"vash_ace","can_delete":false,"product_type":"c3","uid":1128044,"ip_address":"","ucode":"057B4EC8850187","user_header":"https://static001.geekbang.org/account/avatar/00/11/36/6c/7d5b797e.jpg","comment_is_top":false,"comment_ctime":1571300410,"is_pvip":false,"replies":[{"id":54976,"content":"不是的，所有服务器开发最好都有，因为最简单的，你服务器，别人连上来不做事怎么办，肯定要自我保护下，http只是一种基于tcp的服务器","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571388279,"ip_address":"","comment_id":142148,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，一般Http的keep-alive是有客户端(即浏览器)发起web请求的时候带在Header里的，所以视频中说的idleHandler的方法是不是netty作为httpclient端的时候才需要写的？","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471006,"discussion_content":"不是的，所有服务器开发最好都有，因为最简单的，你服务器，别人连上来不做事怎么办，肯定要自我保护下，http只是一种基于tcp的服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571388279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1439908,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","nickname":"鱼向北游","note":"","ucode":"580EC7DCE57E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36156,"discussion_content":"别的也可以用 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571325428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174256,"user_name":"密码123456","can_delete":false,"product_type":"c3","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1580110549,"is_pvip":false,"replies":[{"id":67875,"content":"👍","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1580296778,"ip_address":"","comment_id":174256,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"每一个说理论的时候，都要看2、3遍","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482347,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580296778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143779,"user_name":"罗洲","can_delete":false,"product_type":"c3","uid":1263417,"ip_address":"","ucode":"68133E38A25C17","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/39/0ce1aa62.jpg","comment_is_top":false,"comment_ctime":1571791715,"is_pvip":false,"replies":[{"id":55526,"content":"17节从源码上介绍了，上次更新应该把17也一起了，就没这个问题了","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571804652,"ip_address":"","comment_id":143779,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"老师，如何判断连接是空闲的？","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471683,"discussion_content":"17节从源码上介绍了，上次更新应该把17也一起了，就没这个问题了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571804652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153463,"user_name":"冬渐暖","can_delete":false,"product_type":"c3","uid":1586800,"ip_address":"","ucode":"907E41AAE9A36C","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/70/00122b24.jpg","comment_is_top":false,"comment_ctime":1574239007,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"keepalive就是类似于心跳时间，通俗点来说就是看看对方有没有彻底凉了\nLinux Kernel有三个选项影响到KeepAlive的行为：\ntcp_keepalive_time 7200 &#47;&#47; 距离上次传送数据多少时间未收到新报文判断为开始检测，单位秒，默认7200s(没必要频繁，浪费资源)\ntcp_keepalive_intvl 75&#47;&#47; 检测开始每多少时间发送心跳包，单位秒，默认75s\ntcp_keepalive_probes 9&#47;&#47; 发送几次心跳包对方未响应则close连接，默认9次\n整体上的判断需要小心，不能因为它可能中途凉了几下就认为它已经死掉了\n注意的缺点是\nkeepalive只能检测连接是否存活(对面只要回复就认为是正常的)，不能检测连接是否可用(比如死锁中还认为是能用的)，下面会说到解决方案\n以及一些可以让tcp keep-alive失效的东西（如代理(socks proxy之类的)、负载均衡器）\n\n\n\n在应用层用keepalive的原因\n1.tcp层关注的是有没有活着，应用层关注的是能不能用\n2.tcp默认是关的，而且在传输途中可能没了，所以应用层再做一层保险\n3.tcp的参数是系统参数，如果是自己的应用在用就没事。如果别人也在用，你改了他也要变，就变化很大了。。。不过这关应用层用keepalive什么事情。。。。？难道是自己可以在应用层再设置一遍??\n\ntcp的keepalive和http的keep-alive\n看清楚了，中间有个杠。\ntcp的keepalive是在ESTABLISH状态的时候，双方如何检测连接的可用行。\n而http的keep-alive说的是如何避免进行重复的TCP三次握手和四次挥手的环节(选择长连接还是短的)。\n长连接：指在一个连接上可以连续发送多个数据包，在连接保持期间，如果没有数据包发送，需要双方发链路检测包。\n短连接：指通讯双方有数据交互时，就建立一个连接，数据发送完成后，则断开此连接，即每次连接只完成一项业务的发送。\n\nidle检测：就是看对方有没有反应。作用是省的你每次都去问人家\nidle:就是对方不回复你，对方就是idle状态\n去询问的动作叫keepalive\n\nnetty开启keepalive\n可以在创建ServerBootstrap的group后通过额外参数(childOption)来指定开启\n开启idle检测可以在handler下的初始化Channel那里开启，记得那个addlast不，就是加在这个里面\n","like_count":20,"discussions":[{"author":{"id":1032013,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bf/4d/abb7bfe3.jpg","nickname":"Geek_d682xj","note":"","ucode":"24B4CA1B707009","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311157,"discussion_content":"课代表，可以","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602239520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810156,"avatar":"","nickname":"poordickey","note":"","ucode":"2A436EC813AF97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342722,"discussion_content":"http的keepalive和TCP keepalive是两回事   那http默认的keep-alive是用TCP的keepalive的方式链接的吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610793696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175084,"user_name":"Kino","can_delete":false,"product_type":"c3","uid":1255270,"ip_address":"","ucode":"CBE8588F3C302C","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/66/afa629d6.jpg","comment_is_top":false,"comment_ctime":1580549415,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"老师，请问keepalive的三个系统参数与idle是怎么配合使用？\n1, 如果设置了keepalive但是没设置idle，是怎样？默认使用三个系统参数么？即7200秒没数据就开始发心跳。\n2, 如果设置了keepalive同时设置了idle，三个参数还生效吗？","like_count":3,"discussions":[{"author":{"id":1032013,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bf/4d/abb7bfe3.jpg","nickname":"Geek_d682xj","note":"","ucode":"24B4CA1B707009","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311160,"discussion_content":"这个没具体测试过，但是idle的时间基本上都是比tcp的keepalive小的，而且tcp的keepalive也不一定好使，可能其他硬件都没开启，所以，在我看来，tcp保活只是一个保底方案，用到这个时，业务早就完蛋了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602239752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142160,"user_name":"小不点","can_delete":false,"product_type":"c3","uid":1351860,"ip_address":"","ucode":"C307D44A185C34","user_header":"https://static001.geekbang.org/account/avatar/00/14/a0/b4/5173f1af.jpg","comment_is_top":false,"comment_ctime":1571301866,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"享受，课程买的值","like_count":1},{"had_liked":false,"id":345831,"user_name":"卷毛","can_delete":false,"product_type":"c3","uid":1762439,"ip_address":"","ucode":"B53D459BB63025","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e4/87/fa7438da.jpg","comment_is_top":false,"comment_ctime":1652620961,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"协议层 keepalive：链路是否通\n应用层 keepalive：服务是否正常","like_count":0},{"had_liked":false,"id":336598,"user_name":"热心市民小陈","can_delete":false,"product_type":"c3","uid":1666006,"ip_address":"","ucode":"DED1930BEBC3AE","user_header":"https://static001.geekbang.org/account/avatar/00/19/6b/d6/8d59d926.jpg","comment_is_top":false,"comment_ctime":1646232605,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"idle检测是不是得和应用层的keepalive结合使用啊？\n而和 tcp 层的 keepalive 应该是没有关系的吧？","like_count":0},{"had_liked":false,"id":300163,"user_name":"James Harden13","can_delete":false,"product_type":"c3","uid":1591062,"ip_address":"","ucode":"91DFFAE59E332F","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/16/144846e5.jpg","comment_is_top":false,"comment_ctime":1625029872,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"老师您好 有两个问题请教下 1.这几开启了keepalive是设置的tcp层的参数那2.如果设置了keepalice还有必要设置idle拦截器吗","like_count":0},{"had_liked":false,"id":291872,"user_name":"念","can_delete":false,"product_type":"c3","uid":1113818,"ip_address":"","ucode":"866A800D49C498","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/da/01cfbdc6.jpg","comment_is_top":false,"comment_ctime":1620565242,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"客户端netty连接第三方IM服务端用idle的方式发送心跳好还是写个定时器按第三方IM的心跳间隔时间发送好呢，前者是否会存在连接假死，消息丢失的情况","like_count":0},{"had_liked":false,"id":242409,"user_name":"李白","can_delete":false,"product_type":"c3","uid":1108168,"ip_address":"","ucode":"4C37C447FE2DD8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/c8/0dc100ad.jpg","comment_is_top":false,"comment_ctime":1597715901,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100036701,"comment_content":"请问老师：开启了keepalive  和idel是不是就没必要再用心跳了，感觉功能类似？","like_count":0},{"had_liked":false,"id":235171,"user_name":"V","can_delete":false,"product_type":"c3","uid":1060726,"ip_address":"","ucode":"7CA43B0FBFFA68","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/76/a382a707.jpg","comment_is_top":false,"comment_ctime":1594912809,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100036701,"comment_content":"tcp_keepalive 参数如果时间设置的太短，是不是会频繁的发包， 导致服务器的socket增加，甚至fd被打满了","like_count":0},{"had_liked":false,"id":223875,"user_name":"Geek_772139","can_delete":false,"product_type":"c3","uid":1902221,"ip_address":"","ucode":"06FBB079BC38EB","user_header":"","comment_is_top":false,"comment_ctime":1591200195,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100036701,"comment_content":"合理的做法，Idle检测是配合应用层的keepalive来做的吧？ 老师举的netty中的例子是idle加上tcp层的keepalive来做的？那netty中没有现成的应用层的keepalive吗？","like_count":0},{"had_liked":false,"id":198486,"user_name":"ran","can_delete":false,"product_type":"c3","uid":1296666,"ip_address":"","ucode":"D5F4DFA2644A05","user_header":"https://static001.geekbang.org/account/avatar/00/13/c9/1a/7f326801.jpg","comment_is_top":false,"comment_ctime":1585453381,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100036701,"comment_content":"达到一定时间的idle空闲时间 开始检测心跳keepalive","like_count":0},{"had_liked":false,"id":190973,"user_name":"Geek_bbbda3","can_delete":false,"product_type":"c3","uid":1504651,"ip_address":"","ucode":"737394CE472C21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKNDKOCoZvCqoYVM1t97Q77QPLmRBGvOLYzFsh8073RicycoIuwGrIsCXpAFEyVBOxcyE3Ih1mr6Vw/132","comment_is_top":false,"comment_ctime":1584714968,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100036701,"comment_content":"实际应用中：结合起来使用，按需keepalive，保证不空闲，如果空闲，关闭链接。\n\n这句能详细解释下吗？ 没领回到要领。","like_count":0},{"had_liked":false,"id":179477,"user_name":"辉煌码农","can_delete":false,"product_type":"c3","uid":1332799,"ip_address":"","ucode":"09779C2E06EA52","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIy5ULaodUwsLoPuk1wd22hqXsaBbibNEqXM0kgrCTYDGKYQkZICYEyH9wMj4hyUicuQwHdDuOKRj0g/132","comment_is_top":false,"comment_ctime":1582012170,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100036701,"comment_content":"老师，您看下我的理解对不对。tcp_keepalive_time这个时间值，就可以理解空闲连接状态变为idle的阈值吗？","like_count":0,"discussions":[{"author":{"id":1032013,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bf/4d/abb7bfe3.jpg","nickname":"Geek_d682xj","note":"","ucode":"24B4CA1B707009","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311161,"discussion_content":"再加上9*75������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602240235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}