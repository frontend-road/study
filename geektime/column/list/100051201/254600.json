{"id":254600,"title":"22 | NWRç®—æ³•ï¼šå¦‚ä½•ä¿®æ”¹è¯»å†™æ¨¡å‹ä»¥æå‡æ€§èƒ½ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>å‰ä¸¤è®²æˆ‘ä»¬ä»‹ç»æ•°æ®åº“çš„æ‰©å±•æ—¶ï¼Œå†™è¯·æ±‚ä»ç„¶åœ¨æ“ä½œä¸­å¿ƒåŒ–çš„Masterå•ç‚¹ï¼Œè¿™åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚è¿™ä¸€è®²æˆ‘å°†ä»‹ç»å¯¹äºæ— å•ç‚¹çš„å»ä¸­å¿ƒåŒ–ç³»ç»Ÿéå¸¸æœ‰ç”¨çš„NWRç®—æ³•ï¼Œå®ƒå¯ä»¥çµæ´»åœ°å¹³è¡¡ä¸€è‡´æ€§ä¸æ€§èƒ½ã€‚</p><p>æœ€åˆæˆ‘ä»¬ä»…åœ¨å•æœºä¸Šéƒ¨ç½²æ•°æ®åº“ï¼Œä¸€æ—¦æ€§èƒ½åˆ°è¾¾ç“¶é¢ˆï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºAKF Yè½´å°†è¯»å†™åˆ†ç¦»ï¼Œè¿™æ ·å¤šä¸ªSlaveä»åº“å°†è¯»æ“ä½œåˆ†æµåï¼Œå†™æ“ä½œå°±å¯ä»¥ç‹¬äº«Masterä¸»åº“çš„å…¨éƒ¨æ€§èƒ½ã€‚ç„¶è€Œä¸»åº“ä½œä¸ºä¸­å¿ƒåŒ–çš„å•ç‚¹ï¼Œä¸€æ—¦å®•æœºï¼ŒæœªåŠæ—¶åŒæ­¥åˆ°ä»åº“çš„æ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚è€Œä¸”ï¼Œè¿™ä¸€æ¶æ„ä¸‹ï¼Œä¸»åº“çš„æ•…éšœè¿˜ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿç˜«ç—ªã€‚</p><p>å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­æ²¡æœ‰â€œMasterä¸»åº“â€è¿™ä¸€æ¦‚å¿µï¼Œæ•°æ®å­˜æ”¾åœ¨å¤šä¸ªReplicationå†—ä½™èŠ‚ç‚¹ä¸Šï¼Œä¸”è¿™äº›èŠ‚ç‚¹é—´åœ°ä½å‡ç­‰ï¼Œæ‰€ä»¥æ²¡æœ‰å•ç‚¹é—®é¢˜ã€‚ä¸ºäº†ä¿æŒå¼ºä¸€è‡´æ€§ï¼Œç³»ç»Ÿå¯ä»¥è¦æ±‚ä¿®æ”¹æ•°æ®æ—¶ï¼Œå¿…é¡»åŒæ—¶å†™å…¥æ‰€æœ‰å†—ä½™èŠ‚ç‚¹ï¼Œæ‰èƒ½å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸã€‚ä½†è¿™æ ·ç³»ç»Ÿçš„å¯ç”¨æ€§ä¸€å®šå¾ˆæˆé—®é¢˜ï¼Œæ¯•ç«Ÿå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå‡ºç°æ•…éšœæ˜¯å¸¸æ€ï¼Œå†™å…¥å…¨éƒ¨èŠ‚ç‚¹çš„æ“ä½œæ ¹æœ¬æ— æ³•å®¹é”™ï¼Œä»»ä½•1ä¸ªèŠ‚ç‚¹å®•æœºéƒ½ä¼šé€ æˆå†™æ“ä½œå¤±è´¥ã€‚è€Œä¸”ï¼ŒåŒæ­¥èŠ‚ç‚¹è¿‡å¤šä¹Ÿä¼šå¯¼è‡´å†™æ“ä½œæ€§èƒ½ä½ä¸‹ã€‚</p><p>NWRç®—æ³•æä¾›äº†ä¸€ä¸ªå¾ˆæ£’çš„è¯»å†™æ¨¡å‹ï¼Œå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚è¿™é‡Œçš„â€œNWRâ€ï¼Œæ˜¯æŒ‡åœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­å°†1ä»½æ•°æ®å­˜æ”¾åœ¨Nä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯æ¬¡æ“ä½œæ—¶ï¼Œå†™Wä¸ªèŠ‚ç‚¹ã€è¯»Rä¸ªèŠ‚ç‚¹ï¼Œåªè¦è°ƒæ•´Wã€Rä¸Nçš„å…³ç³»ï¼Œå°±èƒ½åŠ¨æ€åœ°å¹³è¡¡ä¸€è‡´æ€§ä¸æ€§èƒ½ã€‚NWRåœ¨NoSQLæ•°æ®åº“ä¸­æœ‰å¾ˆå¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚Amazonçš„Dynamoå’Œå¼€æºçš„Cassandraï¼Œè¿™äº›æ•°æ®åº“å¾€å¾€è·¨è¶Šå¤šä¸ªIDCæ•°æ®ä¸­å¿ƒï¼ŒåŒ…å«æˆåƒä¸Šä¸‡ä¸ªç‰©ç†æœºèŠ‚ç‚¹ï¼Œé€‚ç”¨äºæµ·é‡æ•°æ®çš„å­˜å‚¨ä¸å¤„ç†ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä»‹ç»NWRç®—æ³•çš„åŸç†ï¼ŒåŒ…æ‹¬å®ƒæ˜¯æ€æ ·è°ƒæ•´è¯»å†™æ¨¡å‹æ¥æå‡æ€§èƒ½çš„ï¼Œä»¥åŠCassandraæ•°æ®åº“æ˜¯å¦‚ä½•ä½¿ç”¨NWRç®—æ³•çš„ã€‚</p><h2>ä»é¸½å·¢åŸç†åˆ°NWRç®—æ³•</h2><p>NWRç®—æ³•æ˜¯ç”±é¸½å·¢åŸç†å¾—æ¥çš„ï¼šå¦‚æœ10åªé¸½å­æ”¾å…¥9ä¸ªé¸½å·¢ï¼Œé‚£ä¹ˆæœ‰1ä¸ªé¸½å·¢å†…è‡³å°‘æœ‰2åªé¸½å­ï¼Œè¿™å°±æ˜¯é¸½å·¢åŸç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><a href=\"https://zh.wikipedia.org/wiki/%E9%B4%BF%E5%B7%A2%E5%8E%9F%E7%90%86\"><img src=\"https://static001.geekbang.org/resource/image/83/17/835a454f1ecb8d6edb5a1c2059082d17.jpg?wh=1246*1010\" alt=\"\" title=\"å›¾ç‰‡æ¥æºï¼šhttps://zh.wikipedia.org/wiki/%E9%B4%BF%E5%B7%A2%E5%8E%9F%E7%90%86\"></a></p><p>ä½ å¯ä»¥ç”¨åè¯æ³•è¯æ˜å®ƒã€‚é¸½å·¢åŸç†è™½ç„¶ç®€å•ï¼Œä½†å®ƒæœ‰è®¸å¤šå¾ˆæœ‰ç”¨çš„æ¨è®ºã€‚æ¯”å¦‚<a href=\"https://time.geekbang.org/column/article/232351\">[ç¬¬3è¯¾]</a> ä»‹ç»äº†å¾ˆå¤šè§£å†³å“ˆå¸Œè¡¨å†²çªçš„æ–¹æ¡ˆï¼Œé‚£ä¹ˆï¼Œå“ˆå¸Œè¡¨æœ‰æ²¡æœ‰å¯èƒ½å®Œå…¨ä¸å‡ºç°å†²çªå‘¢ï¼Ÿ<strong>é¸½å·¢åŸç†å‘Šè¯‰æˆ‘ä»¬ï¼Œåªè¦å“ˆå¸Œå‡½æ•°è¾“å…¥ä¸»é”®çš„å€¼èŒƒå›´å¤§äºè¾“å‡ºç´¢å¼•ï¼Œå‡ºç°å†²çªçš„æ¦‚ç‡å°±ä¸€å®šå¤§äº0ï¼›åªè¦å­˜æ”¾å…ƒç´ çš„æ•°é‡è¶…è¿‡å“ˆå¸Œæ¡¶çš„æ•°é‡ï¼Œå°±å¿…ç„¶ä¼šå‘ç”Ÿå†²çªã€‚</strong></p><p>åŸºäºé¸½å·¢åŸç†ï¼ŒDavid K. Giffordåœ¨1979å¹´é¦–æ¬¡æå‡ºäº†<a href=\"https://en.wikipedia.org/wiki/Quorum_(distributed_computing)\">Quorum</a> ç®—æ³•ï¼ˆå‚è§ã€Š<a href=\"https://dl.acm.org/doi/epdf/10.1145/800215.806583\">Weighted Voting for Replicated Data</a>ã€‹è®ºæ–‡ï¼‰ï¼Œè§£å†³å»ä¸­å¿ƒåŒ–ç³»ç»Ÿå†—ä½™æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ã€‚è€ŒQuorumç®—æ³•æå‡ºï¼Œå¦‚æœå†—ä½™æ•°æ®å­˜æ”¾åœ¨Nä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¸”æ¯æ¬¡å†™æ“ä½œæˆåŠŸå†™å…¥Wä¸ªèŠ‚ç‚¹ï¼ˆå…¶ä»–N - Wä¸ªèŠ‚ç‚¹å°†å¼‚æ­¥åœ°åŒæ­¥æ•°æ®ï¼‰ï¼Œè€Œè¯»æ“ä½œåˆ™ä»Rä¸ªèŠ‚ç‚¹ä¸­é€‰æ‹©å¹¶è¯»å‡ºæ­£ç¡®çš„æ•°æ®ï¼Œåªè¦ç¡®ä¿W + R &gt; Nï¼ŒåŒ1æ¡æ•°æ®çš„è¯»ã€å†™æ“ä½œå°±ä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±æ€»èƒ½è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®ã€‚ç‰¹åˆ«æ˜¯å½“W &gt; N/2æ—¶ï¼ŒåŒ1æ¡æ•°æ®çš„ä¿®æ”¹å¿…ç„¶æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚è¿™æ ·ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°±å…·å¤‡äº†å¼ºä¸€è‡´æ€§ï¼Œè¿™ä¹Ÿæ˜¯NWRç®—æ³•çš„ç”±æ¥ã€‚</p><p>æ¯”å¦‚ï¼Œè‹¥Nä¸º3ï¼Œé‚£ä¹ˆè®¾ç½®Wå’ŒRä¸º2æ—¶ï¼Œåœ¨ä¿éšœç³»ç»Ÿå¼ºä¸€è‡´æ€§çš„åŒæ—¶ï¼Œè¿˜å…è®¸3ä¸ªèŠ‚ç‚¹ä¸­1ä¸ªèŠ‚ç‚¹å®•æœºåï¼Œç³»ç»Ÿä»ç„¶å¯ä»¥æä¾›è¯»ã€å†™æœåŠ¡ï¼Œè¿™æ ·çš„ç³»ç»Ÿå…·å¤‡äº†å¾ˆé«˜çš„å¯ç”¨æ€§ã€‚å½“ç„¶ï¼ŒRå’ŒWçš„æ•°å€¼å¹¶ä¸éœ€è¦ä¸€è‡´ï¼Œå¦‚ä½•è°ƒæ•´å®ƒä»¬ï¼Œå–å†³äºè¯»ã€å†™è¯·æ±‚æ•°é‡çš„æ¯”ä¾‹ã€‚æ¯”å¦‚å½“Nä¸º5æ—¶ï¼Œå¦‚æœç³»ç»Ÿè¯»å¤šå†™å°‘æ—¶ï¼Œå¯ä»¥å°†Wè®¾ä¸º4ï¼Œè€ŒRè®¾ä¸º2ï¼Œè¿™æ ·è¯»æ“ä½œçš„æ€§èƒ½ä¼šæ›´å¥½ã€‚</p><p>NWRç®—æ³•æœ€æ—©åº”ç”¨åœ¨Amazonæ¨å‡ºçš„<a href=\"https://en.wikipedia.org/wiki/Dynamo_(storage_system)\">Dynamo</a> æ•°æ®åº“ä¸­ï¼Œä½ å¯ä»¥å‚è§2007å¹´Amazonå‘è¡¨çš„<a href=\"https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf\">ã€ŠDynamo: Amazonâ€™s Highly Available Key-value Storeã€‹</a>è®ºæ–‡ã€‚2008å¹´Dynamoçš„ä½œè€…Avinash Lakshmanè·³æ§½åˆ°FaceBookï¼Œå¼€å‘äº†Dynamoçš„å¼€æºç‰ˆæ•°æ®åº“<a href=\"https://zh.wikipedia.org/wiki/Cassandra\">Cassandra</a>ï¼Œå®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„NoSQLæ•°æ®åº“ä¹‹ä¸€ï¼Œåœ¨Appleã€Netflixã€360ç­‰å…¬å¸å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚æƒ³å¿…ä½ å¯¹NWRç®—æ³•çš„å¾ˆå¤šç»†èŠ‚å¹¶ä¸æ¸…æ¥šï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥Cassandraä¸ºä¾‹ï¼Œçœ‹çœ‹NWRæ˜¯å¦‚ä½•åº”ç”¨åœ¨å®é™…å·¥ç¨‹ä¸­çš„ã€‚</p><h2>Cassandraæ•°æ®åº“æ˜¯å¦‚ä½•ä½¿ç”¨NWRç®—æ³•çš„ï¼Ÿ</h2><p>1ä¸ªCassandraåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥ç”±å¤šä¸ªIDCæ•°æ®ä¸­å¿ƒã€æ•°ä¸‡ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹æ„æˆï¼Œè¿™äº›èŠ‚ç‚¹é—´ä½¿ç”¨RPCæ¡†æ¶é€šä¿¡ï¼Œç”±äºCassandraæ¨å‡ºæ—¶gRPCï¼ˆå‚è§<a href=\"https://time.geekbang.org/column/article/247812\">[ç¬¬18è¯¾]</a>ï¼‰è¿˜æ²¡æœ‰è¯ç”Ÿï¼Œå› æ­¤å®ƒä½¿ç”¨çš„æ˜¯æ€§èƒ½ç›¸å¯¹è¾ƒä½çš„Thrift RPCæ¡†æ¶ï¼ˆThriftçš„ä¼˜ç‚¹æ˜¯æ”¯æŒçš„å¼€å‘è¯­è¨€æ›´å¤šï¼‰ã€‚åŒæ—¶ï¼ŒCassandraè™½ç„¶ä½¿ç”¨å®½åˆ—å­˜å‚¨æ¨¡å‹ï¼ˆæ¯è¡Œæœ€å¤šå¯ä»¥åŒ…å«<a href=\"https://docs.datastax.com/en/cql-oss/3.x/cql/cql_reference/refLimits.html\">20äº¿åˆ—</a>æ•°æ®ï¼‰ï¼Œä½†<strong>æ•°æ®çš„åˆ†å¸ƒæ˜¯åŸºäºè¡ŒKeyè¿›è¡Œçš„</strong>ï¼Œå®ƒå’ŒDynamoä¸€æ ·ä½¿ç”¨äº†ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå°†Keyå¯¹åº”çš„æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸­ã€‚å…³äºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨ [ç¬¬24è¯¾] å†è¯¦ç»†ä»‹ç»ã€‚</p><p>Cassandraå¯¹å®¢æˆ·ç«¯æä¾›ä¸€ç§ç±»SQLçš„<a href=\"https://cassandra.apache.org/doc/latest/cql/index.html\">CQL</a> è¯­è¨€ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™è¡ŒCQLè¯­å¥è®¾å®šæ•°æ®å­˜å‚¨çš„å†—ä½™èŠ‚ç‚¹ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯NWRç®—æ³•ä¸­çš„Nï¼ˆä¹Ÿç§°ä¸ºReplication Factorï¼‰ï¼š</p><pre><code>CREATE KEYSPACE excalibur\n  WITH REPLICATION = {'class' : 'NetworkTopologyStrategy', 'dc1' : 3};\n</code></pre><p>ä¸Šé¢è¿™è¡ŒCQLè¯­å¥è®¾ç½®äº†æ¯è¡Œæ•°æ®åœ¨æ•°æ®ä¸­å¿ƒDC1ä¸­å­˜å‚¨3ä»½å†—ä½™ï¼Œå³N = 3ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„CQLè¯­å¥ï¼Œå°†è¯»Rã€å†™Wçš„èŠ‚ç‚¹æ•°éƒ½è®¾ç½®ä¸º1ï¼š</p><pre><code>cqlsh&gt; CONSISTENCY ONE\nConsistency level set to ONE.\ncqlsh&gt; CONSISTENCY\nCurrent consistency level is ONE.\n</code></pre><p><strong>æ­¤æ—¶ï¼ŒCassandraçš„æ€§èƒ½æœ€é«˜ï¼Œä½†è¾¾æˆæœ€ç»ˆä¸€è‡´æ€§çš„è€—æ—¶æœ€é•¿ï¼Œä¸¢æ•°æ®é£é™©ä¹Ÿæœ€å¤§ã€‚</strong>å¦‚æœä¸šåŠ¡ä¸Šå¯¹ä¸¢å¤±å°‘é‡æ•°æ®ä¸å¤ªåœ¨æ„ï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§æ¨¡å‹ã€‚æ­¤æ—¶ä¿®æ”¹æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå¹¶å‘åœ°å‘3ä¸ªå­˜å‚¨èŠ‚ç‚¹å†™å…¥æ•°æ®ï¼Œä½†åªè¦1ä¸ªèŠ‚ç‚¹è¿”å›æˆåŠŸï¼ŒCassandraå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›å†™å…¥æˆåŠŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><a href=\"https://docs.datastax.com/en/cassandra-oss/3.x/cassandra/dml\"><img src=\"https://static001.geekbang.org/resource/image/74/1d/742a430b92bb3b235294805b7073991d.png?wh=606*415\" alt=\"\" title=\"è¯¥å›¾ç‰‡åŠä»¥ä¸‹å›¾ç‰‡æ¥æºï¼šhttps://docs.datastax.com/en/cassandra-oss/3.x/cassandra/dml\"></a></p><p>ä¸Šå›¾ä¸­çš„ç³»ç»Ÿç”±12ä¸ªä¸»æœºèŠ‚ç‚¹æ„æˆï¼Œç”±äºæ•°æ®é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†ç‰‡ï¼Œæ•…æ„æˆäº†ä¸€ä¸ªèŠ‚ç‚¹ç¯ã€‚å…¶ä¸­ï¼Œæœ¬æ¬¡å†™å…¥çš„æ•°æ®è¢«åˆ†å¸ƒåˆ°1ã€3ã€6è¿™3ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨ã€‚å®¢æˆ·ç«¯å¯ä»¥éšæœºè¿æ¥åˆ°ç³»ç»Ÿä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è®¿é—®Cassandraï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹è¢«ç§°ä¸ºCoordinator Nodeï¼Œç”±å®ƒæ ¹æ®NWRçš„å€¼æ¥é€‰æ‹©ä¸€è‡´æ€§æ¨¡å‹ï¼Œè®¿é—®å­˜å‚¨èŠ‚ç‚¹ã€‚</p><p>å†æ¥çœ‹è¯»å–æ•°æ®çš„æµç¨‹ã€‚ä¸‹å›¾ä¸­ï¼Œä½œä¸ºCoordinator Nodeçš„èŠ‚ç‚¹10é¦–å…ˆè¯•å›¾è¯»å–èŠ‚ç‚¹1ä¸­çš„æ•°æ®ï¼Œä½†å‘ç°èŠ‚ç‚¹1å·²ç»å®•æœºï¼Œäºæ˜¯æ”¹é€‰èŠ‚ç‚¹6å¹¶è·å–åˆ°æ•°æ®ï¼Œç”±äºR = 1äºæ˜¯ç«‹åˆ»å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/50/d6/5038a63ce8a5cd23fcb6ba2e14b59cd6.jpg?wh=609*443\" alt=\"\"></p><p>å¦‚æœæˆ‘ä»¬å°†Rã€Wéƒ½è®¾ç½®æˆ2ï¼Œè¿™å°±æ»¡è¶³äº†R + W &gt; N(3)çš„åœºæ™¯ï¼Œæ­¤æ—¶ç³»ç»Ÿå…·å¤‡äº†å¼ºä¸€è‡´æ€§ã€‚å®¢æˆ·ç«¯è¯»å†™æ•°æ®æ—¶ï¼Œå¿…é¡»æœ‰2ä¸ªèŠ‚ç‚¹è¿”å›ï¼Œæ‰ç®—æ“ä½œæˆåŠŸã€‚æ¯”å¦‚ä¸‹å›¾ä¸­è¯»å–æ•°æ®æ—¶ï¼Œåªæœ‰æ¥æ”¶åˆ°èŠ‚ç‚¹1ã€èŠ‚ç‚¹6çš„è¿”å›ï¼Œæ“ä½œæ‰ç®—æˆåŠŸã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/0f/8dc00f0a82676cb54d21880e7b60c20f.jpg?wh=610*457\" alt=\"\"></p><p>ä¸Šå›¾ä¸­çš„è“è‰²çº¿å«åšRead repairï¼Œå¦‚æœèŠ‚ç‚¹3ä¸Šçš„æ•°æ®ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæœ¬æ¬¡è¯»æ“ä½œå¯ä»¥å°†å®ƒä¿®å¤ä¸ºæ­£ç¡®çš„æ•°æ®ã€‚è¯´å®Œæ­£å¸¸åœºæ™¯ï¼Œæˆ‘ä»¬å†æ¥çœ‹å½“ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°å¼‚å¸¸æ—¶ï¼ŒNWRæ˜¯å¦‚ä½•ä¿æŒå¼ºä¸€è‡´æ€§çš„ã€‚</p><p>ä¸‹å›¾ä¸­ï¼Œå®¢æˆ·ç«¯1åœ¨ç¬¬2æ­¥ï¼ŒåŒæ—¶å‘3ä¸ªå­˜å‚¨èŠ‚ç‚¹å†™å…¥äº†æ•°æ®ï¼Œç”±äºèŠ‚ç‚¹1ã€3è¿”å›æˆåŠŸï¼Œæ‰€ä»¥å†™å…¥æ“ä½œå®é™…å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯èŠ‚ç‚¹6ç”±äºç½‘ç»œæ•…éšœï¼Œå´ä¸€ç›´æ²¡æœ‰æ”¶åˆ°Coordinator Nodeå‘æ¥çš„å†™å…¥æ“ä½œã€‚åœ¨å¼ºä¸€è‡´æ€§çš„çº¦æŸä¸‹ï¼Œå®¢æˆ·ç«¯2åœ¨ç¬¬5æ­¥å‘èµ·çš„è¯»è¯·æ±‚ï¼Œå¿…é¡»èƒ½è·å–åˆ°ç¬¬2æ­¥å†™å…¥çš„æ•°æ®ã€‚ç„¶è€Œï¼Œå®¢æˆ·ç«¯2è¿æ¥çš„Coordinator Nodeä¸å®¢æˆ·ç«¯1ä¸åŒï¼Œå®ƒé€‰æ‹©äº†èŠ‚ç‚¹3å’ŒèŠ‚ç‚¹6ï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å¹¶ä¸ä¸€è‡´ã€‚<strong>æ ¹æ®ä¸åŒçš„timestampæ—¶é—´æˆ³ï¼ŒCoordinator Nodeå‘ç°èŠ‚ç‚¹3ä¸Šçš„æ•°æ®æ‰æ˜¯æœ€åå†™å…¥çš„æ•°æ®ï¼Œå› æ­¤é€‰æ‹©å…¶ä¸Šçš„æ•°æ®è¿”å›å®¢æˆ·ç«¯ã€‚è¿™ä¹Ÿå«Last-Write-Winç­–ç•¥ã€‚</strong></p><p><a href=\"https://blog.scottlogic.com/2017/10/06/cassandra-eventual-consistency.html\"><img src=\"https://static001.geekbang.org/resource/image/4b/fa/4bc3308298395b7a57d9d540a79aa7fa.jpg?wh=7306*3486\" alt=\"\" title=\"å›¾ç‰‡æ¥æºï¼šhttps://blog.scottlogic.com/2017/10/06/cassandra-eventual-consistency.html\"></a></p><p>Cassandraæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½®è¯»å†™èŠ‚ç‚¹æ•°é‡éƒ½è¿‡åŠï¼Œæ»¡è¶³å¼ºä¸€è‡´æ€§çš„è¦æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>cqlsh&gt; CONSISTENCY QUORUM\nConsistency level set to QUORUM.\ncqlsh&gt; CONSISTENCY\nCurrent consistency level is QUORUM.\n</code></pre><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹çœ‹å¤šæ•°æ®ä¸­å¿ƒçš„éƒ¨ç½²æ–¹å¼ã€‚ä¸‹å›¾ä¸­2ä¸ªæ•°æ®ä¸­å¿ƒå„è®¾ç½®N = 3ï¼Œå…¶ä¸­Rã€Wåˆ™é‡‡ç”¨QUORUMä¸€è‡´æ€§æ¨¡å‹ã€‚å½“å®¢æˆ·ç«¯å‘èµ·å†™è¯·æ±‚åˆ°è¾¾èŠ‚ç‚¹10è¿™ä¸ªCoordinator Nodeåï¼Œå®ƒé€‰æ‹©æœ¬IDC Alphaçš„1ã€3ã€6èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå…¶ä¸­èŠ‚ç‚¹3ã€6è¿”å›æˆåŠŸåï¼ŒIDC Alphaä¾¿æ›´æ–°æˆåŠŸã€‚åŒæ—¶æ‰¾åˆ°å¦ä¸€IDC Betaçš„èŠ‚ç‚¹11å­˜å‚¨æ•°æ®ï¼Œå¹¶ç”±èŠ‚ç‚¹11å°†æ•°æ®åŒæ­¥ç»™èŠ‚ç‚¹4å’ŒèŠ‚ç‚¹8ã€‚å…¶ä¸­ï¼Œåªè¦èŠ‚ç‚¹4è¿”å›æˆåŠŸï¼ŒIDC Betaä¹Ÿå°±æˆåŠŸæ›´æ–°äº†æ•°æ®ï¼Œæ­¤æ—¶Coordinator Nodeä¼šå‘å®¢æˆ·ç«¯è¿”å›å†™å…¥æˆåŠŸã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/00/5fe2fa80bb20e04d25c41ed5986c0c00.jpg?wh=618*811\" alt=\"\"></p><p>è¯»å–æ•°æ®æ—¶ï¼Œè¿™2ä¸ªIDCå†…å¿…é¡»ç”±4ä¸ªå­˜å‚¨èŠ‚ç‚¹è¿”å›æ•°æ®ï¼Œæ‰æ»¡è¶³QUORUMä¸€è‡´æ€§çš„è¦æ±‚ã€‚ä¸‹å›¾ä¸­ï¼ŒCoordinator Nodeè·å–åˆ°äº†IDC Alphaä¸­èŠ‚ç‚¹1ã€3ã€6çš„è¿”å›ï¼Œä»¥åŠIDC Betaä¸­èŠ‚ç‚¹11çš„è¿”å›ï¼Œå°±å¯ä»¥åŸºäºtimestampæ—¶é—´æˆ³é€‰æ‹©æœ€æ–°çš„æ•°æ®è¿”å›å®¢æˆ·ç«¯ã€‚è€Œä¸”Coordinator Nodeä¼šå¹¶å‘åœ°å‘èµ·Read repairï¼Œè¯•å›¾ä¿®å¤IDC Betaä¸­å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„èŠ‚ç‚¹4å’Œ8ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/59/19/59564438445fb26d2e8993a50a23df19.jpg?wh=614*892\" alt=\"\"></p><p>Cassandraè¿˜æœ‰è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ï¼Œæ¯”å¦‚LOCAL_QUORUMåªè¦æ±‚æœ¬åœ°IDCå†…æœ‰å¤šæ•°èŠ‚ç‚¹å“åº”å³å¯ï¼Œè€ŒEACH_QUORUMåˆ™è¦æ±‚æ¯ä¸ªIDCå†…éƒ½å¿…é¡»æœ‰å¤šæ•°èŠ‚ç‚¹è¿”å›æˆåŠŸï¼ˆæ³¨æ„ï¼Œè¿™ä¸ä¸Šå›¾ä¸­IDC Alphaä¸­æœ‰3ä¸ªèŠ‚ç‚¹è¿”å›ï¼Œè€ŒIDC Betaåˆ™åªæœ‰1ä¸ªèŠ‚ç‚¹è¿”å›çš„QUORUMæ˜¯ä¸åŒçš„ï¼‰ã€‚ä½ å¯ä»¥ä»<a href=\"https://docs.datastax.com/en/cassandra-oss/3.x/cassandra/dml/dmlConfigConsistency.html\">è¿™ä¸ªé¡µé¢</a>æ‰¾åˆ°Cassandraæ”¯æŒçš„æ‰€æœ‰ä¸€è‡´æ€§æ¨¡å‹ï¼Œä½†æ— è®ºå¦‚ä½•å˜åŒ–ï¼Œéƒ½åªæ˜¯åœ¨å¼•å…¥æ•°æ®ä¸­å¿ƒã€æœºæ¶ç­‰æ¦‚å¿µåï¼Œå±€éƒ¨æ€§åœ°è°ƒèŠ‚NWRè€Œå·²ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬ä»‹ç»äº†é¸½å·¢åŸç†ï¼Œä»¥åŠç”±æ­¤æ¨å¯¼å‡ºçš„NWRç®—æ³•ï¼Œå¹¶ä»¥æµè¡Œçš„NoSQLæ•°æ®åº“Cassandraä¸ºä¾‹ï¼Œä»‹ç»äº†NWRåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å®è·µã€‚</p><p>å½“é¸½å­çš„æ•°é‡è¶…è¿‡äº†é¸½å·¢åï¼Œå°±è¦æ³¨å®šæŸä¸€ä¸ªé¸½å·¢å†…ä¸€å®šå«æœ‰ä¸¤åªä»¥ä¸Šçš„é¸½å­ï¼ŒåŒæ ·çš„é“ç†ï¼Œåªè¦è¯»ã€å†™æ“ä½œæ¶‰åŠçš„èŠ‚ç‚¹è¶…è¿‡åŠæ•°ï¼Œå°±æ³¨å®šè¯»å†™æ“ä½œæ€»åŒ…å«ä¸€ä¸ªå«æœ‰æ­£ç¡®æ•°æ®çš„èŠ‚ç‚¹ã€‚NWRç®—æ³•å°†è¿™ä¸€åŸç†ä¸€èˆ¬åŒ–ä¸ºï¼šåªè¦è¯»èŠ‚ç‚¹æ•°R + å†™èŠ‚ç‚¹æ•°W &gt; å­˜å‚¨èŠ‚ç‚¹æ•°Nï¼Œç‰¹åˆ«æ˜¯W &gt; N/2æ—¶ï¼Œå°±èƒ½ä½¿å»ä¸­å¿ƒçš„åˆ†å¸ƒå¼ç³»ç»Ÿè·å¾—å¼ºä¸€è‡´æ€§ã€‚</p><p>æ”¯æŒä¸Šä¸‡èŠ‚ç‚¹çš„Cassandraæ•°æ®åº“ï¼Œå°±ä½¿ç”¨äº†NWRç®—æ³•æ¥ä¿æŒä¸€è‡´æ€§ã€‚å½“ç„¶ï¼ŒCassandraæ”¯æŒå¤šç§ä¸€è‡´æ€§æ¨¡å‹ï¼Œå½“ä½ éœ€è¦æ›´å¼ºåŠ²çš„æ€§èƒ½æ—¶ï¼Œä½ å¯ä»¥ä»¤R + W &lt; Nï¼Œå½“ä¸šåŠ¡å˜åŒ–å¯¼è‡´éœ€è¦å¢å¼ºç³»ç»Ÿçš„ä¸€è‡´æ€§æ—¶ï¼Œä½ å¯ä»¥å®æ—¶åœ°ä¿®æ”¹Rã€Wã€‚Cassandraä¹Ÿæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²ï¼Œæ­¤æ—¶çš„ä¸€è‡´æ€§æ¨¡å‹æ›´ä¸ºå¤æ‚ï¼Œä½†ä»ç„¶å°†NWRç®—æ³•ä½œä¸ºå®ç°åŸºç¡€ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åç»™ä½ ç•™ä¸€é“è®¨è®ºé¢˜ã€‚ä½ è¿˜çŸ¥é“å“ªäº›æœ‰çŠ¶æ€æœåŠ¡ä½¿ç”¨äº†NWRç®—æ³•å—ï¼Ÿå®ƒä¸NWRåœ¨Cassandraä¸­çš„åº”ç”¨æœ‰ä½•ä¸åŒï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸­åˆ†äº«ï¼Œä¹ŸæœŸå¾…ä½ èƒ½ä»å¤§å®¶çš„ç•™è¨€ä¸­æ€»ç»“å‡ºæ›´ä¸€èˆ¬åŒ–çš„è§„å¾‹ã€‚</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":231345,"user_name":"æ‰æ¾å£","can_delete":false,"product_type":"c1","uid":1080578,"ip_address":"","ucode":"ED904CE27CD3C4","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/02/4862f849.jpg","comment_is_top":false,"comment_ctime":1593655183,"is_pvip":false,"replies":[{"id":"85539","content":"æ˜¯çš„ï¼ŒKafkaåœ¨é€‰ä¸¾leaderæ—¶ï¼Œä½¿ç”¨äº†ç®€åŒ–ç‰ˆçš„NWRæ¨¡å‹","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1593756603,"ip_address":"","comment_id":231345,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35953393551","product_id":100051201,"comment_content":"kafkaæ˜¯ä¸æ˜¯ä¹Ÿæ˜¯NWRæ¨¡å‹","like_count":9,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500268,"discussion_content":"æ˜¯çš„ï¼ŒKafkaåœ¨é€‰ä¸¾leaderæ—¶ï¼Œä½¿ç”¨äº†ç®€åŒ–ç‰ˆçš„NWRæ¨¡å‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593756603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230955,"user_name":"ple","can_delete":false,"product_type":"c1","uid":1120057,"ip_address":"","ucode":"E1C4519C325994","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/39/3274257b.jpg","comment_is_top":false,"comment_ctime":1593530746,"is_pvip":false,"replies":[{"id":"85324","content":"^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1593567037,"ip_address":"","comment_id":230955,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31658301818","product_id":100051201,"comment_content":"è€å¸ˆçš„é£æ ¼å¾ˆä¸ä¸€æ · å¾ˆä¸“ä¸š ç¡¬æ ¸,å½“çœŸè¯´äº†ä¸€äº›å…¶ä»–åœ°æ–¹ä¸å®¹æ˜“çœ‹åˆ°çš„. ","like_count":8,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500090,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593567037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232991,"user_name":"æ¢¦æƒ³çš„ä¼˜æƒ åˆ¸","can_delete":false,"product_type":"c1","uid":1257418,"ip_address":"","ucode":"D3B44F6C618CA7","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/ca/cbce6e94.jpg","comment_is_top":false,"comment_ctime":1594184172,"is_pvip":false,"replies":[{"id":"86144","content":"^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1594342345,"ip_address":"","comment_id":232991,"utype":1}],"discussion_count":1,"race_medal":1,"score":"14479086060","product_id":100051201,"comment_content":"zkå°±æœ‰quorumæœºåˆ¶ï¼Œä¹‹å‰åªçŸ¥é“NWğŸ˜‚ï¼ŒåŸæ¥è¿˜éœ€è¦Ræ‰èƒ½ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œï¼Œï¼Œ<br>","like_count":4,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500839,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594342345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230773,"user_name":"è‡­çŒ«","can_delete":false,"product_type":"c1","uid":1313181,"ip_address":"","ucode":"5C3D1ED80055B7","user_header":"https://static001.geekbang.org/account/avatar/00/14/09/9d/8af6cb1e.jpg","comment_is_top":false,"comment_ctime":1593487876,"is_pvip":false,"replies":[{"id":"85329","content":"æ–‡ç¨¿ä¸­å€’æ•°ç¬¬3å¼ å›¾ï¼Œå°±æ˜¯2ä¸ªè¿›ç¨‹å¹¶å‘å†™å…¥çš„ï¼Œå…¶ä¸­client1ã€client2å°±æ˜¯2ä¸ªè¿›ç¨‹ï¼ŒåŸºäºLast-Write-Win ç­–ç•¥æ¥åè°ƒçš„","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1593567981,"ip_address":"","comment_id":230773,"utype":1}],"discussion_count":7,"race_medal":0,"score":"10183422468","product_id":100051201,"comment_content":"ä¸åŒçš„è¿›ç¨‹è¯·æ±‚å†™å…¥ï¼Œæ˜¯å¦‚ä½•åè°ƒé¡ºåºçš„å‘¢ï¼Ÿæ¯”å¦‚è¿›ç¨‹Aè¦set X = 3;è¿›ç¨‹Bè¦set X =4;","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500031,"discussion_content":"æ–‡ç¨¿ä¸­å€’æ•°ç¬¬3å¼ å›¾ï¼Œå°±æ˜¯2ä¸ªè¿›ç¨‹å¹¶å‘å†™å…¥çš„ï¼Œå…¶ä¸­client1ã€client2å°±æ˜¯2ä¸ªè¿›ç¨‹ï¼ŒåŸºäºLast-Write-Win ç­–ç•¥æ¥åè°ƒçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593567981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1249656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","nickname":"å¦¥å","note":"","ucode":"7201DFE9C12669","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288067,"discussion_content":"æˆ‘çš„ç†è§£è¿™æ ·ï¼Œwriteå†™å…¥å¤§äºN/2èŠ‚ç‚¹ä¿è¯åŒä¸€æ¡æ•°æ®ä¿®æ”¹é¡ºåºæ€§ï¼Œå› ä¸ºä¸¤æ¬¡å†™å…¥ä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°äº†ä¸¤æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä»¥æ—¶é—´æˆ³åˆ¤æ–­å…ˆåé¡ºåºï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„é¡ºåºå°±ç¡®å®šäº†ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘åˆæœ‰ä¸¤ä¸ªé—®é¢˜:ä¸€æ˜¯æ•°æ®çš„æ—¶é—´æˆ³æ˜¯ä»¥é‚£å°æœºå™¨çš„æ—¶é—´æˆ³ä¸ºå‡†çš„? äºŒæ˜¯ï¼Œä¸Šé¢è¿™ç§æƒ…å†µï¼Œæ•°æ®å¼‚æ­¥åŒæ­¥åˆ°å‰©ä½™èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹å¦‚æœæ”¶åˆ°æ™šäºå½“å‰æ•°æ®æ—¶é—´æˆ³è¯·æ±‚æ—¶ï¼Œæ˜¯ç›´æ¥ä¸¢æ‰å—ï¼Ÿæ¯”å¦‚æ—¶é—´æˆ³é¡ºåºæ˜¯å…ˆåˆ›å»ºæ•°æ®aï¼Œå†æ›´æ–°aï¼›å¯¹äºå¼‚æ­¥åŒæ­¥çš„èŠ‚ç‚¹å¯èƒ½å…ˆæ”¶åˆ°æ›´æ–°aï¼Œå†åˆ›å»ºaï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤æ¬¡è¯·æ±‚éƒ½ä¼šå¤±è´¥ï¼Œè¿™ç§ä¸å°±äº§ç”Ÿä¸ä¸€è‡´äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593643395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1249656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","nickname":"å¦¥å","note":"","ucode":"7201DFE9C12669","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287759,"discussion_content":"æˆ‘çš„ç†è§£è¿™æ ·ï¼Œwriteå†™å…¥å¤§äºN/2èŠ‚ç‚¹ä¿è¯åŒä¸€æ¡æ•°æ®ä¿®æ”¹é¡ºåºæ€§ï¼Œå› ä¸ºä¸¤æ¬¡å†™å…¥ä¸€å®šä¼šå­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°äº†ä¸¤æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä»¥æ—¶é—´æˆ³åˆ¤æ–­å…ˆåé¡ºåºï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„é¡ºåºå°±ç¡®å®šäº†ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘åˆæœ‰ä¸¤ä¸ªé—®é¢˜:ä¸€æ˜¯æ•°æ®çš„æ—¶é—´æˆ³æ˜¯ä»¥é‚£å°æœºå™¨çš„æ—¶é—´æˆ³ä¸ºå‡†çš„?  äºŒæ˜¯ï¼Œä¸Šé¢è¿™ç§æƒ…å†µï¼Œæ•°æ®å¼‚æ­¥åŒæ­¥åˆ°å‰©ä½™èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹å¦‚æœæ”¶åˆ°æ™šäºå½“å‰æ•°æ®æ—¶é—´æˆ³è¯·æ±‚æ—¶ï¼Œæ˜¯ç›´æ¥ä¸¢æ‰å—ï¼Ÿæ¯”å¦‚æ—¶é—´æˆ³é¡ºåºæ˜¯å…ˆåˆ›å»ºæ•°æ®aï¼Œå†æ›´æ–°aï¼›å¯¹äºå¼‚æ­¥åŒæ­¥çš„èŠ‚ç‚¹å¯èƒ½å…ˆæ”¶åˆ°æ›´æ–°aï¼Œå†åˆ›å»ºaï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤æ¬¡è¯·æ±‚éƒ½ä¼šå¤±è´¥ï¼Œè¿™ç§ä¸å°±äº§ç”Ÿä¸ä¸€è‡´äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593529501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1127332,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/a4/9be19ae3.jpg","nickname":"LossingDawn","note":"","ucode":"75E65EA3A272BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1249656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","nickname":"å¦¥å","note":"","ucode":"7201DFE9C12669","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287921,"discussion_content":"æ—¶é—´æˆ³å°±æ˜¯ç‰ˆæœ¬å·ï¼Œéæœ€æ–°ç‰ˆæœ¬çš„ä¸æä¾›æœåŠ¡ï¼Œå¼‚æ­¥åŒæ­¥é€šè¿‡æ—¶é—´æˆ³æŠŠä¸€ç³»åˆ—å¢é‡ä¿®æ”¹é¡ºåºåŒæ­¥ï¼Œä¸å­˜åœ¨è¿™ç§æƒ…å†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593589317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287759,"ip_address":""},"score":287921,"extra":""},{"author":{"id":1249656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","nickname":"å¦¥å","note":"","ucode":"7201DFE9C12669","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1127332,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/a4/9be19ae3.jpg","nickname":"LossingDawn","note":"","ucode":"75E65EA3A272BA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288058,"discussion_content":"å¼‚æ­¥åŒæ­¥é€šè¿‡æ—¶é—´æˆ³æŠŠä¸€ç³»åˆ—å¢é‡ä¿®æ”¹é¡ºåºåŒæ­¥  è¿™å¥è¯èƒ½è¯¦ç»†è§£é‡Šä¸‹å—ï¼Œæ²¡ç†è§£å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593634436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287921,"ip_address":""},"score":288058,"extra":""},{"author":{"id":1784256,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/39/c0/9c465545.jpg","nickname":"wchb","note":"","ucode":"49D94DFC61E9DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1249656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","nickname":"å¦¥å","note":"","ucode":"7201DFE9C12669","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288279,"discussion_content":"å„èŠ‚ç‚¹ä¹‹é—´ï¼Œæ—¶é’Ÿè¦åŒæ­¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593700327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287759,"ip_address":""},"score":288279,"extra":""}]}]},{"had_liked":false,"id":237192,"user_name":"ä¸ä¼šé£çš„æµ·ç‡•","can_delete":false,"product_type":"c1","uid":2029872,"ip_address":"","ucode":"76EEACB32735F8","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f9/30/54c71bf9.jpg","comment_is_top":false,"comment_ctime":1595733079,"is_pvip":false,"replies":[{"id":"87688","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1595816900,"ip_address":"","comment_id":237192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5890700375","product_id":100051201,"comment_content":"æ ¹æ®é¸½å·¢åŸç†æ˜¯ä¸æ˜¯å¯ä»¥æ¨è®ºå‡ºï¼ŒæŠŠ9åªé¸½å­æ”¾åˆ°10ä¸ªç¬¼å­é‡Œè‡³å°‘æœ‰ä¸€ä¸ªç¬¼å­æ˜¯ç©ºçš„","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502332,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595816900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235445,"user_name":"stackWarn","can_delete":false,"product_type":"c1","uid":1002005,"ip_address":"","ucode":"89672E452DEBA5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","comment_is_top":false,"comment_ctime":1595039224,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5890006520","product_id":100051201,"comment_content":"keepalived çš„é…ç½® quorum up ä¼°è®¡ä¹Ÿæ˜¯åŒåŒ–äº†è¿™ä¸ªæ€æƒ³  ","like_count":1},{"had_liked":false,"id":287428,"user_name":"åŒ—æçš„å¤§ä¼é¹…","can_delete":false,"product_type":"c1","uid":1045577,"ip_address":"","ucode":"8935346D08E109","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/49/2add4f6b.jpg","comment_is_top":false,"comment_ctime":1617945429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617945429","product_id":100051201,"comment_content":"æ„Ÿè°¢ä½œè€…çš„è€å¿ƒåˆ†äº«å’ŒæŒ‡å¯¼","like_count":0},{"had_liked":false,"id":233306,"user_name":"å¤å“¥","can_delete":false,"product_type":"c1","uid":2053749,"ip_address":"","ucode":"E0B2C6F35EB0FD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/56/75/6bf38a1e.jpg","comment_is_top":false,"comment_ctime":1594283418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594283418","product_id":100051201,"comment_content":"é™¶è€å¸ˆï¼Œå¼‚æ­¥åŒæ­¥å‰©ä¸‹çš„n-wä¸ªèŠ‚ç‚¹æ²¡è¯´å‘¢ï¼Ÿ  last-write-win å‰æå„ä¸ªæœåŠ¡æ—¶é—´æˆ³ä¸€è‡´ã€‚å¯¹äºå‰©ä¸‹çš„n-wä¸ªèŠ‚ç‚¹  è°ä½œleaderå»åŒæ­¥å‘¢ï¼Ÿåˆæ€æ ·åŒæ­¥ï¼Ÿ","like_count":0},{"had_liked":false,"id":233050,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594203649,"is_pvip":false,"replies":[{"id":"90730","content":"^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599557756,"ip_address":"","comment_id":233050,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594203649","product_id":100051201,"comment_content":"NWRç®—æ³•æ€»ç»“ï¼šå½“é¸½å­çš„æ•°é‡è¶…è¿‡äº†é¸½å·¢åï¼Œå°±è¦æ³¨å®šæŸä¸€ä¸ªé¸½å·¢å†…ä¸€å®šå«æœ‰ä¸¤åªä»¥ä¸Šçš„é¸½å­ï¼ŒåŒæ ·çš„é“ç†ï¼Œåªè¦è¯»ã€å†™æ“ä½œæ¶‰åŠçš„èŠ‚ç‚¹è¶…è¿‡åŠæ•°ï¼Œå°±æ³¨å®šè¯»å†™æ“ä½œæ€»åŒ…å«ä¸€ä¸ªå«æœ‰æ­£ç¡®æ•°æ®çš„èŠ‚ç‚¹ã€‚NWR ç®—æ³•å°†è¿™ä¸€åŸç†ä¸€èˆ¬åŒ–ä¸ºï¼šåªè¦è¯»èŠ‚ç‚¹æ•° R + å†™èŠ‚ç‚¹æ•° W &gt; å­˜å‚¨èŠ‚ç‚¹æ•° Nï¼Œç‰¹åˆ«æ˜¯ W &gt; N&#47;2 æ—¶ï¼Œå°±èƒ½ä½¿å»ä¸­å¿ƒçš„åˆ†å¸ƒå¼ç³»ç»Ÿè·å¾—å¼ºä¸€è‡´æ€§ã€‚<br>--------------------------------<br>é¸½è‡¼åŸç†æ¨å¯¼å‡ºçš„NWRä¸€è‡´æ€§ç®—æ³•ï¼ŒçœŸçš„å¤§å¼€çœ¼ç•Œäº†ã€‚niceï¼<br>","like_count":0,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500871,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599557756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231144,"user_name":"é»„æµ·å³°","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1593592823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593592823","product_id":100051201,"comment_content":"æœ€åä¸€ä¸ªå¤šä¸­å¿ƒä¾‹å­ï¼Œâ€œæ•°æ®ä¸­å¿ƒå„è®¾ç½® N = 3ï¼Œå…¶ä¸­ Rã€W åˆ™é‡‡ç”¨ QUORUM ä¸€è‡´æ€§æ¨¡å‹â€ã€‚ã€‚ã€‚r wé‡‡ç”¨quorumæ¨¡å‹é‚£æ„æ€åˆ°åº•æ˜¯r wåˆ†åˆ«è®¾ä¸ºå¤šå°‘å‘¢ï¼Ÿï¼Ÿä¸ºä½•å†™çš„æ—¶å€™alphaè¦ä¸¤ä¸ªè¿”å›ï¼Œbetaä¸­å¿ƒä¸€ä¸ªè¿”å›å°±è¡Œäº†å‘¢ï¼Ÿ","like_count":0}]}