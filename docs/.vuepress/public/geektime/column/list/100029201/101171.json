{"id":101171,"title":"07 | 最最最重要的集群参数配置（上）","content":"<p>你好，我是胡夕。今天我想和你聊聊最最最重要的Kafka集群配置。我这里用了3个“最”字并非哗众取宠，而是因为有些配置的重要性并未体现在官方文档中，并且从实际表现看，很多参数对系统的影响要比从文档上看更加明显，因此很有必要集中讨论一下。</p><p>我希望通过两期内容把这些重要的配置讲清楚。严格来说这些配置并不单单指Kafka服务器端的配置，其中既有Broker端参数，也有主题（后面我用我们更熟悉的Topic表示）级别的参数、JVM端参数和操作系统级别的参数。</p><p>需要你注意的是，这里所说的Broker端参数也被称为静态参数（Static Configs）。我会在专栏后面介绍与静态参数相对应的动态参数。所谓静态参数，是指你必须在Kafka的配置文件server.properties中进行设置的参数，不管你是新增、修改还是删除。同时，你必须重启Broker进程才能令它们生效。而主题级别参数的设置则有所不同，Kafka提供了专门的kafka-configs命令来修改它们。至于JVM和操作系统级别参数，它们的设置方法比较通用化，我介绍的也都是标准的配置参数，因此，你应该很容易就能够对它们进行设置。</p><p>下面我先从Broker端参数说起。</p><!-- [[[read_end]]] --><h2>Broker端参数</h2><p>目前Kafka Broker提供了近200个参数，这其中绝大部分参数都不用你亲自过问。当谈及这些参数的用法时，网上的文章多是罗列出一些常见的参数然后一个一个地给出它们的定义，事实上我以前写文章时也是这么做的。不过今天我打算换个方法，按照大的用途类别一组一组地介绍它们，希望可以更有针对性，也更方便你记忆。</p><p>首先Broker是需要配置存储信息的，即Broker使用哪些磁盘。那么针对存储信息的重要参数有以下这么几个：</p><ul>\n<li><code>log.dirs</code>：这是非常重要的参数，指定了Broker需要使用的若干个文件目录路径。要知道这个参数是没有默认值的，这说明什么？这说明它必须由你亲自指定。</li>\n<li><code>log.dir</code>：注意这是dir，结尾没有s，说明它只能表示单个路径，它是补充上一个参数用的。</li>\n</ul><p>这两个参数应该怎么设置呢？很简单，你只要设置<code>log.dirs</code>，即第一个参数就好了，不要设置<code>log.dir</code>。而且更重要的是，在线上生产环境中一定要为<code>log.dirs</code>配置多个路径，具体格式是一个CSV格式，也就是用逗号分隔的多个路径，比如<code>/home/kafka1,/home/kafka2,/home/kafka3</code>这样。如果有条件的话你最好保证这些目录挂载到不同的物理磁盘上。这样做有两个好处：</p><ul>\n<li>提升读写性能：比起单块磁盘，多块物理磁盘同时读写数据有更高的吞吐量。</li>\n<li>能够实现故障转移：即Failover。这是Kafka 1.1版本新引入的强大功能。要知道在以前，只要Kafka Broker使用的任何一块磁盘挂掉了，整个Broker进程都会关闭。但是自1.1开始，这种情况被修正了，坏掉的磁盘上的数据会自动地转移到其他正常的磁盘上，而且Broker还能正常工作。还记得上一期我们关于Kafka是否需要使用RAID的讨论吗？这个改进正是我们舍弃RAID方案的基础：没有这种Failover的话，我们只能依靠RAID来提供保障。</li>\n</ul><p>下面说说与ZooKeeper相关的设置。首先ZooKeeper是做什么的呢？它是一个分布式协调框架，负责协调管理并保存Kafka集群的所有元数据信息，比如集群都有哪些Broker在运行、创建了哪些Topic，每个Topic都有多少分区以及这些分区的Leader副本都在哪些机器上等信息。</p><p>Kafka与ZooKeeper相关的最重要的参数当属<code>zookeeper.connect</code>。这也是一个CSV格式的参数，比如我可以指定它的值为<code>zk1:2181,zk2:2181,zk3:2181</code>。2181是ZooKeeper的默认端口。</p><p>现在问题来了，如果我让多个Kafka集群使用同一套ZooKeeper集群，那么这个参数应该怎么设置呢？这时候chroot就派上用场了。这个chroot是ZooKeeper的概念，类似于别名。</p><p>如果你有两套Kafka集群，假设分别叫它们kafka1和kafka2，那么两套集群的<code>zookeeper.connect</code>参数可以这样指定：<code>zk1:2181,zk2:2181,zk3:2181/kafka1</code>和<code>zk1:2181,zk2:2181,zk3:2181/kafka2</code>。切记chroot只需要写一次，而且是加到最后的。我经常碰到有人这样指定：<code>zk1:2181/kafka1,zk2:2181/kafka2,zk3:2181/kafka3</code>，这样的格式是不对的。</p><p>第三组参数是与Broker连接相关的，即客户端程序或其他Broker如何与该Broker进行通信的设置。有以下三个参数：</p><ul>\n<li><code>listeners</code>：学名叫监听器，其实就是告诉外部连接者要通过什么协议访问指定主机名和端口开放的Kafka服务。</li>\n<li><code>advertised.listeners</code>：和listeners相比多了个advertised。Advertised的含义表示宣称的、公布的，就是说这组监听器是Broker用于对外发布的。</li>\n<li><code>host.name/port</code>：列出这两个参数就是想说你把它们忘掉吧，压根不要为它们指定值，毕竟都是过期的参数了。</li>\n</ul><p>我们具体说说监听器的概念，从构成上来说，它是若干个逗号分隔的三元组，每个三元组的格式为<code>&lt;协议名称，主机名，端口号&gt;</code>。这里的协议名称可能是标准的名字，比如PLAINTEXT表示明文传输、SSL表示使用SSL或TLS加密传输等；也可能是你自己定义的协议名字，比如<code>CONTROLLER: //localhost:9092</code>。</p><p>一旦你自己定义了协议名称，你必须还要指定<code>listener.security.protocol.map</code>参数告诉这个协议底层使用了哪种安全协议，比如指定<code>listener.security.protocol.map=CONTROLLER:PLAINTEXT表示CONTROLLER</code>这个自定义协议底层使用明文不加密传输数据。</p><p>至于三元组中的主机名和端口号则比较直观，不需要做过多解释。不过有个事情你还是要注意一下，经常有人会问主机名这个设置中我到底使用IP地址还是主机名。<strong>这里我给出统一的建议：最好全部使用主机名，即Broker端和Client端应用配置中全部填写主机名。</strong> Broker源代码中也使用的是主机名，如果你在某些地方使用了IP地址进行连接，可能会发生无法连接的问题。</p><p>第四组参数是关于Topic管理的。我来讲讲下面这三个参数：</p><ul>\n<li><code>auto.create.topics.enable</code>：是否允许自动创建Topic。</li>\n<li><code>unclean.leader.election.enable</code>：是否允许Unclean Leader选举。</li>\n<li><code>auto.leader.rebalance.enable</code>：是否允许定期进行Leader选举。</li>\n</ul><p>我还是一个个说。</p><p><code>auto.create.topics.enable</code>参数我建议最好设置成false，即不允许自动创建Topic。在我们的线上环境里面有很多名字稀奇古怪的Topic，我想大概都是因为该参数被设置成了true的缘故。</p><p>你可能有这样的经历，要为名为test的Topic发送事件，但是不小心拼写错误了，把test写成了tst，之后启动了生产者程序。恭喜你，一个名为tst的Topic就被自动创建了。</p><p>所以我一直相信好的运维应该防止这种情形的发生，特别是对于那些大公司而言，每个部门被分配的Topic应该由运维严格把控，决不能允许自行创建任何Topic。</p><p>第二个参数<code>unclean.leader.election.enable</code>是关闭Unclean Leader选举的。何谓Unclean？还记得Kafka有多个副本这件事吗？每个分区都有多个副本来提供高可用。在这些副本中只能有一个副本对外提供服务，即所谓的Leader副本。</p><p>那么问题来了，这些副本都有资格竞争Leader吗？显然不是，只有保存数据比较多的那些副本才有资格竞选，那些落后进度太多的副本没资格做这件事。</p><p>好了，现在出现这种情况了：假设那些保存数据比较多的副本都挂了怎么办？我们还要不要进行Leader选举了？此时这个参数就派上用场了。</p><p>如果设置成false，那么就坚持之前的原则，坚决不能让那些落后太多的副本竞选Leader。这样做的后果是这个分区就不可用了，因为没有Leader了。反之如果是true，那么Kafka允许你从那些“跑得慢”的副本中选一个出来当Leader。这样做的后果是数据有可能就丢失了，因为这些副本保存的数据本来就不全，当了Leader之后它本人就变得膨胀了，认为自己的数据才是权威的。</p><p>这个参数在最新版的Kafka中默认就是false，本来不需要我特意提的，但是比较搞笑的是社区对这个参数的默认值来来回回改了好几版了，鉴于我不知道你用的是哪个版本的Kafka，所以建议你还是显式地把它设置成false吧。</p><p>第三个参数<code>auto.leader.rebalance.enable</code>的影响貌似没什么人提，但其实对生产环境影响非常大。设置它的值为true表示允许Kafka定期地对一些Topic分区进行Leader重选举，当然这个重选举不是无脑进行的，它要满足一定的条件才会发生。严格来说它与上一个参数中Leader选举的最大不同在于，它不是选Leader，而是换Leader！比如Leader A一直表现得很好，但若<code>auto.leader.rebalance.enable=true</code>，那么有可能一段时间后Leader A就要被强行卸任换成Leader B。</p><p>你要知道换一次Leader代价很高的，原本向A发送请求的所有客户端都要切换成向B发送请求，而且这种换Leader本质上没有任何性能收益，因此我建议你在生产环境中把这个参数设置成false。</p><p>最后一组参数是数据留存方面的，我分别介绍一下。</p><ul>\n<li><code>log.retention.{hours|minutes|ms}</code>：这是个“三兄弟”，都是控制一条消息数据被保存多长时间。从优先级上来说ms设置最高、minutes次之、hours最低。</li>\n<li><code>log.retention.bytes</code>：这是指定Broker为消息保存的总磁盘容量大小。</li>\n<li><code>message.max.bytes</code>：控制Broker能够接收的最大消息大小。</li>\n</ul><p>先说这个“三兄弟”，虽然ms设置有最高的优先级，但是通常情况下我们还是设置hours级别的多一些，比如<code>log.retention.hours=168</code>表示默认保存7天的数据，自动删除7天前的数据。很多公司把Kafka当作存储来使用，那么这个值就要相应地调大。</p><p>其次是这个<code>log.retention.bytes</code>。这个值默认是-1，表明你想在这台Broker上保存多少数据都可以，至少在容量方面Broker绝对为你开绿灯，不会做任何阻拦。这个参数真正发挥作用的场景其实是在云上构建多租户的Kafka集群：设想你要做一个云上的Kafka服务，每个租户只能使用100GB的磁盘空间，为了避免有个“恶意”租户使用过多的磁盘空间，设置这个参数就显得至关重要了。</p><p>最后说说<code>message.max.bytes</code>。实际上今天我和你说的重要参数都是指那些不能使用默认值的参数，这个参数也是一样，默认的1000012太少了，还不到1MB。实际场景中突破1MB的消息都是屡见不鲜的，因此在线上环境中设置一个比较大的值还是比较保险的做法。毕竟它只是一个标尺而已，仅仅衡量Broker能够处理的最大消息大小，即使设置大一点也不会耗费什么磁盘空间的。</p><h2>小结</h2><p>再次强调一下，今天我和你分享的所有参数都是那些要修改默认值的参数，因为它们的默认值不适合一般的生产环境。当然，我并不是说其他100多个参数就不重要。事实上，在专栏的后面我们还会陆续提到其他的一些参数，特别是那些和性能息息相关的参数。所以今天我提到的所有参数，我希望作为一个最佳实践给到你，可以有的放矢地帮助你规划和调整你的Kafka生产环境。</p><p><img src=\"https://static001.geekbang.org/resource/image/d5/e7/d5248ba158a2283c095324a265d9f7e7.jpg?wh=2069*2560\" alt=\"\"></p><h2>开放讨论</h2><p>除了今天我分享的这些参数，还有哪些参数是你认为比较重要而文档中没有提及的？你曾踩过哪些关于参数配置的“坑”？欢迎提出来与我和大家一起讨论。</p><p>欢迎你写下自己的思考或疑问，我们一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p>","neighbors":{"left":{"article_title":"06 | Kafka线上集群部署方案怎么做？","id":101107},"right":{"article_title":"08 | 最最最重要的集群参数配置（下）","id":101763}},"comments":[{"had_liked":false,"id":188390,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1584348125,"is_pvip":false,"replies":[{"id":"72770","content":"我去，这个过于形象了~","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1584408403,"ip_address":"","comment_id":188390,"utype":1}],"discussion_count":16,"race_medal":0,"score":"998016760797","product_id":100029201,"comment_content":"auto.create.topics.enable： 不能自立为王<br><br>unclean.leader.election.enable： 宁缺毋滥<br><br>auto.leader.rebalance.enable：江山不易改<br><br>log.retention.{hours|minutes|ms} ：数据寿命  hours=168<br>log.rentention.bytes: 祖宅大小  -1 表示没限制<br>message.max.bytes: 祖宅大门宽度，默认 1000012=976KB","like_count":233,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487394,"discussion_content":"我去，这个过于形象了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584408403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1488020,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","nickname":"追风筝的人","note":"","ucode":"2993D60F94C396","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533187,"discussion_content":"同九年汝何秀","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1637810165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2034669,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/ed/4969d2f8.jpg","nickname":"柯南爱上指针","note":"","ucode":"5BF7E8AC28F9CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303204,"discussion_content":"秀儿  是你吗？？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599184665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2934665,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/c7/89/16437396.jpg","nickname":"极客酱酱","note":"","ucode":"18CDC1DB754D58","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567774,"discussion_content":"秀儿，是你吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650987192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2550743,"avatar":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","nickname":"if...else...","note":"","ucode":"D0565908C99695","race_medal":4,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385849,"discussion_content":"秀啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627298696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438860,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f4/8c/0866b228.jpg","nickname":"子房","note":"","ucode":"CB05938C248BB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559788,"discussion_content":"🛫","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648966369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130726,"avatar":"https://static001.geekbang.org/account/avatar/00/11/40/e6/2cd0f52b.jpg","nickname":"Mr.x","note":"","ucode":"FDA144380DB9AE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412957,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636341179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2165300,"avatar":"https://static001.geekbang.org/account/avatar/00/21/0a/34/3e29eb5a.jpg","nickname":"尚小树","note":"","ucode":"9BCB0DF0F3C8E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324673,"discussion_content":"秀秀秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605150844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205865,"avatar":"https://static001.geekbang.org/account/avatar/00/12/66/69/110f35c1.jpg","nickname":"booker","note":"","ucode":"950860DD77413D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315696,"discussion_content":"太皮了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603321323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1165662,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c9/5e/b79e6d5d.jpg","nickname":"꧁子华宝宝萌萌哒꧂","note":"","ucode":"3E5BBAF15064B6","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308293,"discussion_content":"你也太秀了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600909522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1949831,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/890Q99X0LkAMj4VPpiaicSSEciaBXsZ0kx9xvgMibibttFMGsUkrDx8EU4hdibmkAwjiaDGWia9UjDtiakzOzrgKNDqHZMQ/132","nickname":"沙石","note":"","ucode":"9307074CC75607","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303501,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599285088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102385,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/31/f1bec7fc.jpg","nickname":"汉斯·冯·拉特","note":"","ucode":"29F14B0D938A02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290150,"discussion_content":"牛皮  高手在民间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594358662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182802,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","nickname":"长脖子树","note":"","ucode":"D9090EF67EEB1B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283767,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592360578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283557,"discussion_content":"牛皮plus","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592296634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1333665,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/a1/fb8eb114.jpg","nickname":"鹅鹅鹅","note":"","ucode":"C75F7A97D0AAB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274274,"discussion_content":"牛皮plus","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590561064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1173129,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e6/89/d8aec012.jpg","nickname":"Liang","note":"","ucode":"E1A816EE5CE7DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":255701,"discussion_content":"哈哈哈哈 笑死了 有才","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588423664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104628,"user_name":"草帽路飞","can_delete":false,"product_type":"c1","uid":1401733,"ip_address":"","ucode":"7416D1D82E3456","user_header":"https://static001.geekbang.org/account/avatar/00/15/63/85/9ccf1b19.jpg","comment_is_top":false,"comment_ctime":1560789168,"is_pvip":true,"replies":[{"id":"37844","content":"advertised.listeners主要是为外网访问用的。如果clients在内网环境访问Kafka不需要配置这个参数。<br><br>常见的玩法是：你的Kafka Broker机器上配置了双网卡，一块网卡用于内网访问（即我们常说的内网IP）；另一个块用于外网访问。那么你可以配置listeners为内网IP，advertised.listeners为外网IP。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560819035,"ip_address":"","comment_id":104628,"utype":1}],"discussion_count":7,"race_medal":0,"score":"435352486064","product_id":100029201,"comment_content":"老师 advertised.listeners 这个配置能否再解释一下。感觉配置了 listeners之后就不用配置这个了呀？","like_count":102,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454347,"discussion_content":"advertised.listeners主要是为外网访问用的。如果clients在内网环境访问Kafka不需要配置这个参数。\n\n常见的玩法是：你的Kafka Broker机器上配置了双网卡，一块网卡用于内网访问（即我们常说的内网IP）；另一个块用于外网访问。那么你可以配置listeners为内网IP，advertised.listeners为外网IP。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560819035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028461,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b1/6d/651e2f4d.jpg","nickname":"小肥牛","note":"","ucode":"1E1FD5A4712668","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4953,"discussion_content":"advertised.listeners这个参数在使用Docker的时候比较重要，Docker就是老师提到的这种“双网卡”场景。容器有一个内部ip，但客户端常常看到的是容器在宿主机上绑定的ip","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1565857249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1087395,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/a3/25bd1173.jpg","nickname":"与狼共舞","note":"","ucode":"3714E31F20385D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623,"discussion_content":"老师，如果每个broker节点的 advertised.listeners都设置为外网IP，这样一来，假设集群有多个 broker节点，是不是得要有多个外网ip？ 而外网ip这个资源比较有限，有没有更好的方法呢？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1561815205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2421631,"avatar":"","nickname":"Geek_61f664","note":"","ucode":"A97893B5367CF1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539292,"discussion_content":"advertised.listeners配置的内容，会存在zookeeper里，客户端连接kafka的时候，会使用zookeeper里存储的advertised.listeners。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1639661931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300673,"discussion_content":"推荐一篇好文：https://rmoff.net/2018/08/02/kafka-listeners-explained/","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598230864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1400471,"avatar":"https://static001.geekbang.org/account/avatar/00/15/5e/97/61f32d69.jpg","nickname":"🚶🏻","note":"","ucode":"AA5E9F8212A887","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300162,"discussion_content":"马克","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597973403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46865,"discussion_content":"马克","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573220888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161507,"user_name":"第一片心意","can_delete":false,"product_type":"c1","uid":1682331,"ip_address":"","ucode":"4CFE5F1D615743","user_header":"https://static001.geekbang.org/account/avatar/00/19/ab/9b/b12c223d.jpg","comment_is_top":false,"comment_ctime":1576218981,"is_pvip":false,"replies":[{"id":"61584","content":"同意。不过实际上，线上环境贸然大面积迁移副本leader是非常有风险的事情：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1576302267,"ip_address":"","comment_id":161507,"utype":1}],"discussion_count":1,"race_medal":0,"score":"173374910821","product_id":100029201,"comment_content":"       auto.leader.rebalance.enable<br>       关于这个参数的设置，我有一点不同的意见，官网说的是如果某个broker挂了，那分布在他上的leader副本就会自动切换到其他活着的broker上，但是挂掉的broker重启之后，集群并不会将他之前的leader副本再切换回来，这样就会使其他broker上leader副本数较多，而该broker上无leader副本（无新主题创建），从而造成负载不均衡的情况。<br>       这时我们可以通过 kafka-preferred-replica-election.sh 脚本来重新平衡集群中的leader副本。但是我们配置这个参数为true的话，controller角色就会每五分钟（默认）检查一下集群不平衡的状态，进而重新平衡leader副本。","like_count":41,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477739,"discussion_content":"同意。不过实际上，线上环境贸然大面积迁移副本leader是非常有风险的事情：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576302267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104915,"user_name":"QQ怪","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1560869756,"is_pvip":false,"replies":[{"id":"38028","content":"不太懂“删除topic后还出现重复消费”是什么意思？删完了还要继续消费它吗？<br><br>当consumer启动后它会从Kafka读取它上次消费的位移。情况1： 如果 Kafka broker端没有保存这个位移值，那么consumer会看auto.offset.reset的脸色<br>情况2：consumer拿到位移值开始消费，如果后面发现它要读取消息的位移在Kafka中不存在（可能对应的消息已经被删除了），那么它也会看auto.offset.reset的脸色<br>情况3：除以上这两种情况之外consumer不会再顾忌auto.offset.reset的值<br><br>怎么看auto.offset.reset的脸色呢？简单说就是earliest从头消息；latest从当前新位移处消费。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560905450,"ip_address":"","comment_id":104915,"utype":1}],"discussion_count":1,"race_medal":0,"score":"156179692412","product_id":100029201,"comment_content":"老师帮我们讲讲这个参数吧auto.offset.reset，我有时候删除一个topic时会导致offset异常，出现重复消费问题，不知道跟这个参数有没有关系？？","like_count":37,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454481,"discussion_content":"不太懂“删除topic后还出现重复消费”是什么意思？删完了还要继续消费它吗？\n\n当consumer启动后它会从Kafka读取它上次消费的位移。情况1： 如果 Kafka broker端没有保存这个位移值，那么consumer会看auto.offset.reset的脸色\n情况2：consumer拿到位移值开始消费，如果后面发现它要读取消息的位移在Kafka中不存在（可能对应的消息已经被删除了），那么它也会看auto.offset.reset的脸色\n情况3：除以上这两种情况之外consumer不会再顾忌auto.offset.reset的值\n\n怎么看auto.offset.reset的脸色呢？简单说就是earliest从头消息；latest从当前新位移处消费。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560905450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204546,"user_name":"🇭   🇴  🇱 🇮  🇸","can_delete":false,"product_type":"c1","uid":1612894,"ip_address":"","ucode":"36BCA065EE4F2E","user_header":"https://static001.geekbang.org/account/avatar/00/18/9c/5e/76c3c339.jpg","comment_is_top":false,"comment_ctime":1586419388,"is_pvip":false,"replies":[{"id":"76529","content":"需要。producer、broker、consumer三端都需要调整<br><br>broker: message.max.bytes和replica.fetch.max.bytes<br>consumer：fetch.message.max.bytes","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1586481705,"ip_address":"","comment_id":204546,"utype":1}],"discussion_count":2,"race_medal":0,"score":"121845503676","product_id":100029201,"comment_content":"老师 我把message.max.bytes设置地挺大，但是java生产者发送1M以上数据就失败，集群也重启过，版本0.10左右 是否有其他参数需要调？","like_count":29,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491213,"discussion_content":"需要。producer、broker、consumer三端都需要调整\n\nbroker: message.max.bytes和replica.fetch.max.bytes\nconsumer：fetch.message.max.bytes","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586481705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2943954,"avatar":"","nickname":"小贝放学后","note":"","ucode":"D9CA37FE7E825C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":580933,"discussion_content":"老师，producer端的调整是什么参数呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658407731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":491213,"ip_address":""},"score":580933,"extra":""}]}]},{"had_liked":false,"id":106799,"user_name":"小头针","can_delete":false,"product_type":"c1","uid":1422920,"ip_address":"","ucode":"21EB7CDE48EC9B","user_header":"https://static001.geekbang.org/account/avatar/00/15/b6/48/1275e0ce.jpg","comment_is_top":false,"comment_ctime":1561387392,"is_pvip":false,"replies":[{"id":"38665","content":"只有一个broker有数据进出，我猜是因为这样的原因：1. 首先你的主题分区副本数是1；2. 在你升级的过程中所有分区的Leader副本都变更到了同一台broker上。<br><br>后面开启了auto.leader.rebalance.enable=true之后它定期将Leader副本分散到不同broker上了。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561423146,"ip_address":"","comment_id":106799,"utype":1}],"discussion_count":3,"race_medal":0,"score":"108935569792","product_id":100029201,"comment_content":"胡老师，我在kafka升级过程中遇到过这样的问题，就是升级后的Kafka与之前的Kafka 的配置完全一样，就是版本不一样了。但是5个Broker后，Kafka Manager工具中，只有1个Broker有数据进入进出。后来同时添加了以下4个参数：<br>rebalance.max.retries=4<br>auto.leader.rebalance.enable=true<br>leader.imbalance.check.interval.seconds=300<br>leader.imbalance.per.broker.percentage=10<br>再重启Kafka，5个Broker都有数据进入进出，但是我不清楚这到底是哪个参数起到了决定性的作用。其中就有老师讲的auto.leader.rebalance.enable这个参数，但是我这里设置的是true？","like_count":25,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455226,"discussion_content":"只有一个broker有数据进出，我猜是因为这样的原因：1. 首先你的主题分区副本数是1；2. 在你升级的过程中所有分区的Leader副本都变更到了同一台broker上。\n\n后面开启了auto.leader.rebalance.enable=true之后它定期将Leader副本分散到不同broker上了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561423146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58295,"discussion_content":"提出问题的朋友，应该回应一下 胡老师 的猜测是否正确嘛~","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1574666530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1913231,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIgiarK8ic7vY1RuR65ESnibhR5D6ic4rCf6DW9PBS4UCHcEZjibZWwGeicU82EllIic5nBcia0B0x0TcsVdQ/132","nickname":"程辉","note":"","ucode":"E9B49C5DDA84CD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573216,"discussion_content":"是的，应该回应一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653273546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167095,"user_name":"杨陆伟","can_delete":false,"product_type":"c1","uid":1108457,"ip_address":"","ucode":"3BC968447406EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/e9/e9/1f95e422.jpg","comment_is_top":false,"comment_ctime":1577690932,"is_pvip":true,"replies":[{"id":"64954","content":"这个参数既有broker端也有topic端，不过最终都是作用于topic的。另外算法上也不是简单的比较大小。举个例子吧：假设日志段大小是700MB，当前分区共有4个日志段文件，大小分别是700MB，700MB，700MB和1234B——显然1234B那个文件就是active日志段。此时该分区总的日志大小是3*700MB+1234B=2100MB+1234B，如果阈值设置为2000MB，那么超出阈值的部分就是100MB+1234B，小于日志段大小700MB，故Kafka不会执行任何删除操作，即使总大小已经超过了阈值；反之如果阈值设置为1400MB，那么超过阈值的部分就是700MB+1234B &gt; 700MB，此时Kafka会删除最老的那个日志段文件","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1577759798,"ip_address":"","comment_id":167095,"utype":1}],"discussion_count":5,"race_medal":0,"score":"100361938740","product_id":100029201,"comment_content":"你好，log.retention.bytes这个参数是针对主题的吧？比如设置为100M，Kafka定期会把每个主题的日志数据留存到100M以下？","like_count":23,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479742,"discussion_content":"这个参数既有broker端也有topic端，不过最终都是作用于topic的。另外算法上也不是简单的比较大小。举个例子吧：假设日志段大小是700MB，当前分区共有4个日志段文件，大小分别是700MB，700MB，700MB和1234B——显然1234B那个文件就是active日志段。此时该分区总的日志大小是3*700MB+1234B=2100MB+1234B，如果阈值设置为2000MB，那么超出阈值的部分就是100MB+1234B，小于日志段大小700MB，故Kafka不会执行任何删除操作，即使总大小已经超过了阈值；反之如果阈值设置为1400MB，那么超过阈值的部分就是700MB+1234B &amp;gt; 700MB，此时Kafka会删除最老的那个日志段文件","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577759798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2912918,"avatar":"","nickname":"Geek_284c06","note":"","ucode":"4BD6D4449D4F1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":576995,"discussion_content":"所以日志段大小也不能太大吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655878131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":479742,"ip_address":""},"score":576995,"extra":""}]},{"author":{"id":1736462,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/0e/e3a8dbd9.jpg","nickname":"Liujun","note":"","ucode":"3DB1F3CA57B5B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389268,"discussion_content":"老师说得太棒了，补充一点，kafka2.6默认配置log.retention.bytes和log.segment.bytes一致，另外该配置独立于log.retention.hours，也就是说触发了log.retention.bytes条件之后，就会裁剪删除日志段，不需要等到 log.retention.hours 该阈值到来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629197918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1755910,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cb/06/8eefb6dd.jpg","nickname":"鹤鸣","note":"","ucode":"8F56BD4281794C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361241,"discussion_content":"日志段是什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616632599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1143372,"avatar":"https://static001.geekbang.org/account/avatar/00/11/72/4c/4d636a23.jpg","nickname":"在路上","note":"","ucode":"335960F683C23C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303393,"discussion_content":"日志段是指log.retention.bytes吧？那阀值又是哪个字段设置的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599228152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104868,"user_name":"不了峰","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1560860540,"is_pvip":false,"replies":[{"id":"38027","content":"搜了一下，像是Oracle GoldenGate Kafka Adapter的参数。我没有用过，从文档中看这两者的区别是：当设置成op单个数据库表的变更（插入、更新、删除）会被当成一条Kafka消息发送；当设置成tx时，数据库事务所做的所有变更统一被封装进一条Kafka消息，并在事务提交后被发送。<br><br>显然，后者有事务性的保障，至少有原子性方面的保证，不会丢失部分CDC数据。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560905132,"ip_address":"","comment_id":104868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"65985369980","product_id":100029201,"comment_content":"请教老师<br>gg.handler.kafkahandler.Mode = tx<br>gg.handler.kafkahandler.Mode = op<br>这两个的差别。我们遇到时 dml 数据会丢失的情况。用的是 op 。<br>谢谢","like_count":15,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454462,"discussion_content":"搜了一下，像是Oracle GoldenGate Kafka Adapter的参数。我没有用过，从文档中看这两者的区别是：当设置成op单个数据库表的变更（插入、更新、删除）会被当成一条Kafka消息发送；当设置成tx时，数据库事务所做的所有变更统一被封装进一条Kafka消息，并在事务提交后被发送。\n\n显然，后者有事务性的保障，至少有原子性方面的保证，不会丢失部分CDC数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560905132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104632,"user_name":"你好旅行者","can_delete":false,"product_type":"c1","uid":1154101,"ip_address":"","ucode":"5C72A428DC28F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg","comment_is_top":false,"comment_ctime":1560793027,"is_pvip":false,"replies":[{"id":"37858","content":"首先，CAP理论有很多有歧义的地方，我很好奇为什么国内很多人追捧CAP，其实对于分布式系统而言，很多一致性问题都是CAP覆盖不了的。<br>其次，我个人觉得饶大神并不是说Kafka放弃了P，其实Kafka是依托于ZooKeeper以及合理配置minIsr等参数来规避脑裂的。<br>第三，我翻看了社区对此提案的讨论，变更为false就是很朴素的思想：用户在默认情况下可能更加关心数据一致性，不想数据丢失。如果用户想要更高的可用性，手动调整即可。你可以看看社区对此问题的讨论：https:&#47;&#47;www.mail-archive.com&#47;dev@kafka.apache.org&#47;msg63086.html","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560819883,"ip_address":"","comment_id":104632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"65985302467","product_id":100029201,"comment_content":"老师好！关于Unclean这个参数，将其设置为false之后，就意味着如果ISR内的所有broker都宕机，那么这个分区就不可用了。<br>刚好我前几天看到饶军在2013年的一次报告上讲到Kafka在CAP问题上的取舍，他说，因为Kafka是部署在一个DataCenter中的，而一个DataCenter很少会出现Partitioning的情况，所以Kafka放弃了分区容忍性。<br>我想问的是，Kafka舍弃了分区容忍性这一点是否可以体现在社区默认将Unclean设置为false上呢？<br>附上报告的地址：https:&#47;&#47;www.youtube.com&#47;watch?v=XcvHmqmh16g<br>关于CAP的取舍出现在21:50左右的地方。谢谢老师！<br>","like_count":15,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454349,"discussion_content":"首先，CAP理论有很多有歧义的地方，我很好奇为什么国内很多人追捧CAP，其实对于分布式系统而言，很多一致性问题都是CAP覆盖不了的。\n其次，我个人觉得饶大神并不是说Kafka放弃了P，其实Kafka是依托于ZooKeeper以及合理配置minIsr等参数来规避脑裂的。\n第三，我翻看了社区对此提案的讨论，变更为false就是很朴素的思想：用户在默认情况下可能更加关心数据一致性，不想数据丢失。如果用户想要更高的可用性，手动调整即可。你可以看看社区对此问题的讨论：https://www.mail-archive.com/dev@kafka.apache.org/msg63086.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560819883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178380,"user_name":"咸淡一首诗","can_delete":false,"product_type":"c1","uid":1435869,"ip_address":"","ucode":"FEE5A9B5139BF1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl9nj9b6RydKADq82ZwOad0fQcvXWyQKk5U5RFC2kzHGI4GjIQsIZvHsEm7mFELgMiaGx3lGq9vag/132","comment_is_top":false,"comment_ctime":1581674809,"is_pvip":false,"replies":[{"id":"69231","content":"是的，这种情况会丢失数据。其实Kafka并没有承诺不丢失数据，而是在满足某些条件下才做持久化保证。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1581728818,"ip_address":"","comment_id":178380,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40236380473","product_id":100029201,"comment_content":"老师，对于failover机制，kafka会新建副本，从leader处同步最新的数据给新建副本。如果坏掉的盘是leader持久化的盘并且其他副本没有来的及从坏掉的leader分区同步最新数据，重新选举leader后岂不是也会丢失数据？？？","like_count":9,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483784,"discussion_content":"是的，这种情况会丢失数据。其实Kafka并没有承诺不丢失数据，而是在满足某些条件下才做持久化保证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581728818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149813,"user_name":"hunterlodge","can_delete":false,"product_type":"c1","uid":1069755,"ip_address":"","ucode":"5B83A79E784161","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg","comment_is_top":false,"comment_ctime":1573386385,"is_pvip":false,"replies":[{"id":"57658","content":"这个取决于broker端参数replica.lag.time.max.ms的取值","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573432489,"ip_address":"","comment_id":149813,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35933124753","product_id":100029201,"comment_content":"“坚决不能让那些落后太多的副本竞选 Leader”，请问落后多少算是太多呢？谢谢","like_count":8,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473987,"discussion_content":"这个取决于broker端参数replica.lag.time.max.ms的取值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573432489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105035,"user_name":"henry","can_delete":false,"product_type":"c1","uid":1075941,"ip_address":"","ucode":"0ACD12F363F8DE","user_header":"http://thirdqq.qlogo.cn/qqapp/101418266/D6DD8CB1004D442B48914656340277F3/100","comment_is_top":false,"comment_ctime":1560907660,"is_pvip":false,"replies":[{"id":"38066","content":"不会。已有数据将一直“躺在”原有分区中。 ","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560911281,"ip_address":"","comment_id":105035,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35920646028","product_id":100029201,"comment_content":"老师，最近别人问我一个问题，假如现有集群已经有3个分区，动态添加两个分区,  原有的分区会迁移数据到新增的分区吗？ ","like_count":8,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454530,"discussion_content":"不会。已有数据将一直“躺在”原有分区中。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560911281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1705386,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/usX58SweWDFqjCmtkvPOWIfjqN2GqydQYqW53bIcFI4DGBmp6O2LZxZL1UYsVPRuEP03dEJcK3d9jHdYZVn8ug/132","nickname":"maben996","note":"","ucode":"95390116090D23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38660,"discussion_content":"那么新写入的数据正常进入到新的分区吗？我以前的理解也是分区数变化会触发rebalance，还是说rebalance只是针对Consumer Group的Consuemr的。假设一个消费者组中有三个消费者同时消费topicA的3个分区数据，现在给topicA增加一个分区，会导致什么结果呢？还是kafka依然正常的使用自己的分区分配机制，将4个分区的数据分配给3个消费者呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571815100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1705386,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/usX58SweWDFqjCmtkvPOWIfjqN2GqydQYqW53bIcFI4DGBmp6O2LZxZL1UYsVPRuEP03dEJcK3d9jHdYZVn8ug/132","nickname":"maben996","note":"","ucode":"95390116090D23","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300848,"discussion_content":"新增分区会分配给其中一个消费者的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598281633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":38660,"ip_address":""},"score":300848,"extra":""}]}]},{"had_liked":false,"id":104984,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1560902979,"is_pvip":false,"replies":[{"id":"38043","content":"可能有点没说清楚。<br><br>1. Broker自动在好的路径上重建副本，然后从leader同步；<br>2. Kafka支持工具能够将某个路径上的数据拷贝到其他路径上","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560906681,"ip_address":"","comment_id":104984,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35920641347","product_id":100029201,"comment_content":"请问老师，坏掉的数据是怎么自动转移到其他磁盘上的呢？","like_count":8,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454515,"discussion_content":"可能有点没说清楚。\n\n1. Broker自动在好的路径上重建副本，然后从leader同步；\n2. Kafka支持工具能够将某个路径上的数据拷贝到其他路径上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560906681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105172,"user_name":"李 P","can_delete":false,"product_type":"c1","uid":1444969,"ip_address":"","ucode":"91DF7C52FF75FB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0c/69/3d2f3a58.jpg","comment_is_top":false,"comment_ctime":1560932787,"is_pvip":false,"replies":[{"id":"38099","content":"可以试试Kafka 0.11引入的事务","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560939933,"ip_address":"","comment_id":105172,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31625703859","product_id":100029201,"comment_content":"和本节无关，消息队列重复消费问题有什么太好的办法吗？我们现在的做法是把offset和消费后的计算结果一并保存在业务系统中，有没有更好的做法","like_count":7,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454582,"discussion_content":"可以试试Kafka 0.11引入的事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560939933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1638570,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/aa/1f5fceda.jpg","nickname":"明月朔风","note":"","ucode":"C9CAF7B14C38FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377105,"discussion_content":"请教一下，为啥不是消费端自己做幂等那？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622509364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1638570,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/aa/1f5fceda.jpg","nickname":"明月朔风","note":"","ucode":"C9CAF7B14C38FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543770,"discussion_content":"有些消费是做累积运算的，真不好做幂等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641296120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377105,"ip_address":""},"score":543770,"extra":""}]}]},{"had_liked":false,"id":104832,"user_name":"你看起来很好吃","can_delete":false,"product_type":"c1","uid":1188854,"ip_address":"","ucode":"F9079138EC3D7C","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/f6/1ef70cab.jpg","comment_is_top":false,"comment_ctime":1560849714,"is_pvip":false,"replies":[{"id":"38025","content":"它们是异步拉取消息的，必然有一个时间窗口导致它和leader中的数据是不一致的，或者说它是落后于leader的。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560904725,"ip_address":"","comment_id":104832,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27330653490","product_id":100029201,"comment_content":"&#39;如果设置成 false，那么就坚持之前的原则，坚决不能让那些落后太多的副本竞选 Leader。&#39;想问一下老师，每个partition的副本保存的数据不是应该和leader是一模一样的吗？为什么会有丢失的？","like_count":6,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454445,"discussion_content":"它们是异步拉取消息的，必然有一个时间窗口导致它和leader中的数据是不一致的，或者说它是落后于leader的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560904725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126469,"user_name":"Geek_b809ff","can_delete":false,"product_type":"c1","uid":1288329,"ip_address":"","ucode":"F3F17E99F3AA0B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoPY23R9RRSfBeTJUlyc612VlodjAaWWBNiay9tPydkrd6b9NA8GNibdibnFibTsx94ItHE4jvQwprNzA/132","comment_is_top":false,"comment_ctime":1566390531,"is_pvip":false,"replies":[{"id":"46841","content":"如果只是偶尔抛出不用管，通常是因为没有找到对应的主题所致。不是参数配置错导致","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566440914,"ip_address":"","comment_id":126469,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23041227011","product_id":100029201,"comment_content":"[2019-08-21 20:25:24,619] WARN [Producer clientId=console-producer] Error while fetching metadata with correlation id 57 : {test=LEADER_NOT_AVAILABLE} (org.apache.kafka.clients.NetworkClient)<br><br>老师，请教一下，这个错误是什么参数配置错了导致的呢？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464005,"discussion_content":"如果只是偶尔抛出不用管，通常是因为没有找到对应的主题所致。不是参数配置错导致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566440914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104963,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1560899549,"is_pvip":false,"replies":[{"id":"38042","content":"对于普通的消息处理，这个值不会增加额外的内存占用，它不像是数组的长度那样 ，即使用不完也要申请足量的内存空间。<br><br>但对于Log Cleaner而言（就是为topic执行compact操作的线程），这个值的确会占用更多的内存，因为cleaner的读写buffer都要申请一块ByteBuffer。这个值越大这块buffer也就越大。好在cleaner thread也就那么几个。 ","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560906584,"ip_address":"","comment_id":104963,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23035736029","product_id":100029201,"comment_content":"老师你好，message.max.bytes设置后是不是影响了kafka的内存占用大小？谢谢","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454507,"discussion_content":"对于普通的消息处理，这个值不会增加额外的内存占用，它不像是数组的长度那样 ，即使用不完也要申请足量的内存空间。\n\n但对于Log Cleaner而言（就是为topic执行compact操作的线程），这个值的确会占用更多的内存，因为cleaner的读写buffer都要申请一块ByteBuffer。这个值越大这块buffer也就越大。好在cleaner thread也就那么几个。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560906584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104728,"user_name":"Geek_jacky","can_delete":false,"product_type":"c1","uid":1564542,"ip_address":"","ucode":"F6ABD94A03BE7B","user_header":"","comment_is_top":false,"comment_ctime":1560822580,"is_pvip":false,"replies":[{"id":"37876","content":"Broker会在好的目录上重建副本。另外Kafka也提供了工具将某块磁盘上的数据直接搬移到另一个磁盘上，毕竟磁盘坏了也不是不能修好：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560823827,"ip_address":"","comment_id":104728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23035659060","product_id":100029201,"comment_content":"老师好，如果磁盘坏掉了，这些数据是什么机制读取到其他磁盘上的呢？不是都坏了吗？不应该读取其他副本中的数据了吗？这个磁盘上的数据就算是丢失了吗？","like_count":5,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454392,"discussion_content":"Broker会在好的目录上重建副本。另外Kafka也提供了工具将某块磁盘上的数据直接搬移到另一个磁盘上，毕竟磁盘坏了也不是不能修好：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560823827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134135,"user_name":"LJK","can_delete":false,"product_type":"c1","uid":1199213,"ip_address":"","ucode":"12B2441099FF1D","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/6d/c20f2d5a.jpg","comment_is_top":false,"comment_ctime":1568766040,"is_pvip":false,"replies":[{"id":"51423","content":"leader挂掉了Kafka会从ISR剩下的副本中选择一个当leader，但如果ISR也没有副本了，leader就选不出来了。如果设置unclean.leader.election.enable=true，则允许Kafka从那些不在ISR但依然存活的副本中选择一个出来当leader。此时是有数据丢失的风险的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1568767830,"ip_address":"","comment_id":134135,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18748635224","product_id":100029201,"comment_content":"老师好，请问unclean.leader.election.enable设置为false之后，如果leader副本挂掉了那这个分区就无法使用了，是不是意味数据会丢失呢？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467625,"discussion_content":"leader挂掉了Kafka会从ISR剩下的副本中选择一个当leader，但如果ISR也没有副本了，leader就选不出来了。如果设置unclean.leader.election.enable=true，则允许Kafka从那些不在ISR但依然存活的副本中选择一个出来当leader。此时是有数据丢失的风险的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568767830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112292,"user_name":"行则将至","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1562717057,"is_pvip":false,"replies":[{"id":"40826","content":"那就先选举新的leader。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562720673,"ip_address":"","comment_id":112292,"utype":1}],"discussion_count":1,"race_medal":1,"score":"18742586241","product_id":100029201,"comment_content":"老师，对于failover机制，kafka会新建副本，从leader处同步最新的数据给新建副本。如果坏掉的盘是leader持久化的盘呢？","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457661,"discussion_content":"那就先选举新的leader。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562720673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107734,"user_name":"王纪娟","can_delete":false,"product_type":"c1","uid":1309109,"ip_address":"","ucode":"C77DB2C88CC97C","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/b5/850ddda1.jpg","comment_is_top":false,"comment_ctime":1561601137,"is_pvip":false,"replies":[{"id":"39137","content":"它的算法比较复杂，不是简单的不超过就行了。有兴趣的话可以看下我写的这篇文章：https:&#47;&#47;www.cnblogs.com&#47;huxi2b&#47;p&#47;8042099.html","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561681178,"ip_address":"","comment_id":107734,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18741470321","product_id":100029201,"comment_content":"你好，我目前在用0.10.2版本，实际用下来log.retention.bytes限定的是每个topic的每个分区的最大存储，但其实还可能超，因为还跟reflush 的间隔有关，同时我观察到kafka在写的时候会单独再开一个segment。所以某个时间点topic的实际存储可能大过配置值","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455643,"discussion_content":"它的算法比较复杂，不是简单的不超过就行了。有兴趣的话可以看下我写的这篇文章：https://www.cnblogs.com/huxi2b/p/8042099.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561681178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106237,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1561214733,"is_pvip":false,"replies":[{"id":"38509","content":"嗯嗯，这是老版本consumer的设计。目前老版本已经废弃了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561339547,"ip_address":"","comment_id":106237,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18741083917","product_id":100029201,"comment_content":"kafka保存偏移量好像是在zookeeper，不是在kafka","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455011,"discussion_content":"嗯嗯，这是老版本consumer的设计。目前老版本已经废弃了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561339547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104016,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/90/1cb1a7ea.jpg","nickname":"enum","note":"","ucode":"96519847D5555D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318517,"discussion_content":"从那个版本开始的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603770224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"文敦复","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1104016,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d8/90/1cb1a7ea.jpg","nickname":"enum","note":"","ucode":"96519847D5555D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337113,"discussion_content":" 聊聊Kafka的版本号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608800208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318517,"ip_address":""},"score":337113,"extra":""}]}]},{"had_liked":false,"id":105179,"user_name":"Geek_edc612","can_delete":false,"product_type":"c1","uid":1564943,"ip_address":"","ucode":"3E01DE3CE4BF3E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUJKviaecwxpAZCAnHWap86kXUichv5JwUoAtrUNy4ugC0kMMmssFDdyayKFgAoA9Z62sqMZaibbvUg/132","comment_is_top":false,"comment_ctime":1560933705,"is_pvip":false,"replies":[{"id":"38106","content":"1. 的确是有个比例，要超过这个比例才会触发preferred leader选举。这个比例由broker端参数leader.imbalance.per.broker.percentage控制，默认是10%。举个例子，如果一个broker上有10个分区，有2个分区的leader不是preferred leader，那么就会触发<br><br>2. 没太明白为什么写到100GB，broker就不能继续写入了？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560947861,"ip_address":"","comment_id":105179,"utype":1}],"discussion_count":4,"race_medal":0,"score":"18740802889","product_id":100029201,"comment_content":"胡老师您好，我对这两个参数有些疑问：<br>（1）auto.leader.rebalance.enable 这个值设置为true，那么您说的定期重新选举，应该有个触发的条件吧？我刚才跟同事沟通过，他说是跟每台broker的leader数量有关，如果leader分布不均衡就会触发重新选举leader，但是感觉说的还是不够具体，您能给解答下吗，感谢<br>（2）log.retention.bytes这个参数，您说的对于总磁盘容量来说，那我这样理解您看正确不（极端情况）---这个值我设置为100G，我机器有3个磁盘，每个磁盘大小1T，每个磁盘有不同topic的partition且，如果一个租户恶意写数据到自己的topic，造成某块磁盘的partition大小为100G，那么这台broker是不是所有topic都无法继续写入数据了？劳烦您解答下，感谢<br><br>","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454585,"discussion_content":"1. 的确是有个比例，要超过这个比例才会触发preferred leader选举。这个比例由broker端参数leader.imbalance.per.broker.percentage控制，默认是10%。举个例子，如果一个broker上有10个分区，有2个分区的leader不是preferred leader，那么就会触发\n\n2. 没太明白为什么写到100GB，broker就不能继续写入了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560947861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564943,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUJKviaecwxpAZCAnHWap86kXUichv5JwUoAtrUNy4ugC0kMMmssFDdyayKFgAoA9Z62sqMZaibbvUg/132","nickname":"Geek_edc612","note":"","ucode":"3E01DE3CE4BF3E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77,"discussion_content":"老师，这个我找到了相关的示例解释，您不用在麻烦回复了，感谢:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561084593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1564943,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUJKviaecwxpAZCAnHWap86kXUichv5JwUoAtrUNy4ugC0kMMmssFDdyayKFgAoA9Z62sqMZaibbvUg/132","nickname":"Geek_edc612","note":"","ucode":"3E01DE3CE4BF3E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40,"discussion_content":"log.retention.bytes 这个值具体如何体现的我有点不太理解，他是限制的那块呢？胡老师，能麻烦您举个例子吗？谢谢，谢谢 :)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561013145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1348830,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","nickname":"td901105","note":"","ucode":"32D42A4F36FA02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1564943,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUJKviaecwxpAZCAnHWap86kXUichv5JwUoAtrUNy4ugC0kMMmssFDdyayKFgAoA9Z62sqMZaibbvUg/132","nickname":"Geek_edc612","note":"","ucode":"3E01DE3CE4BF3E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":104789,"discussion_content":"多租户应该是一个租户启动一个Broker服务吧,这样就直接限制了这个租户的bytes","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577451318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":40,"ip_address":""},"score":104789,"extra":""}]}]},{"had_liked":false,"id":104752,"user_name":"小猪","can_delete":false,"product_type":"c1","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1560826794,"is_pvip":false,"replies":[{"id":"38019","content":"性能应该是不用担心的吧。很多大厂都有自己的Kafka PaaS服务，没有听说有性能方面的硬伤。用Docker跑也可以挂多个磁盘<br><br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560904438,"ip_address":"","comment_id":104752,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18740695978","product_id":100029201,"comment_content":"请教老师，kafka可以部署到kubernetes云平台吗？效能如何？和直接部署在物理机上有什么区别？例如物理机可以选择分布在不同物理磁盘存数据提高速度等","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454407,"discussion_content":"性能应该是不用担心的吧。很多大厂都有自己的Kafka PaaS服务，没有听说有性能方面的硬伤。用Docker跑也可以挂多个磁盘\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560904438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104740,"user_name":"Geek_jacky","can_delete":false,"product_type":"c1","uid":1564542,"ip_address":"","ucode":"F6ABD94A03BE7B","user_header":"","comment_is_top":false,"comment_ctime":1560825207,"is_pvip":false,"replies":[{"id":"38015","content":"嗯嗯，如果ISR为空，unclean.leader.election.enable=false，当leader挂了的时候分区就不可用了。<br><br>100是broker id，-1表示没有leader了，原因就是100的broker磁盘满了宕机了，正常情况下leader应该会切换到其他的副本上，除非你的副本数就是1","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560903857,"ip_address":"","comment_id":104740,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18740694391","product_id":100029201,"comment_content":"老师好：如果unclean.leader.election.enable这个参数设置为false，一个partition挂了，不让数据少的副本参与选举，那么不就会一直没有副本了吗？我还有个问题，在磁盘满的情况我的一个topic其中的一个partition-0对应的brokerid变成了-1，本来是100的（手动设置的100,-1不知道怎么变的），那么这个partition-0就就找不到这个broker，导致无法进行消费。","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454400,"discussion_content":"嗯嗯，如果ISR为空，unclean.leader.election.enable=false，当leader挂了的时候分区就不可用了。\n\n100是broker id，-1表示没有leader了，原因就是100的broker磁盘满了宕机了，正常情况下leader应该会切换到其他的副本上，除非你的副本数就是1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560903857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206401,"user_name":"GL€","can_delete":false,"product_type":"c1","uid":1023225,"ip_address":"","ucode":"3CA0D6D8C4A1CA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/f9/2a2be193.jpg","comment_is_top":false,"comment_ctime":1586854141,"is_pvip":false,"replies":[{"id":"77352","content":"可能表述的有点歧义。这里是说当出现坏盘后Broker进程依然可以为好盘正常提供服务。一旦用户触发了reassign，Kafka支持将坏掉磁盘上的数据自动地转移到其他正常的磁盘上。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1587006099,"ip_address":"","comment_id":206401,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14471756029","product_id":100029201,"comment_content":"&#39;能够实现故障转移：即 Failover。但是自 1.1 开始，这种情况被修正了，坏掉的磁盘上的数据会自动地转移到其他正常的磁盘上，而且 Broker 还能正常工作&#39;kafka如何做到坏掉的磁盘上的数据自动转移到其他正常的磁盘上的？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491776,"discussion_content":"可能表述的有点歧义。这里是说当出现坏盘后Broker进程依然可以为好盘正常提供服务。一旦用户触发了reassign，Kafka支持将坏掉磁盘上的数据自动地转移到其他正常的磁盘上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587006099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300828,"discussion_content":"应该也要等坏盘恢复吧？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598276768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170438,"user_name":"Hale","can_delete":false,"product_type":"c1","uid":1129731,"ip_address":"","ucode":"1925955343FE94","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/03/b2d9a084.jpg","comment_is_top":false,"comment_ctime":1578615698,"is_pvip":true,"replies":[{"id":"66072","content":"简单来说，就是1.1版本之前，如果Kafka使用的任何一块硬盘坏掉了，Broker就会宕机。1.1版本之后不会了~","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1578618464,"ip_address":"","comment_id":170438,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14463517586","product_id":100029201,"comment_content":"能够实现故障转移：即 Failover。这是 Kafka 1.1 版本新引入的强大功能。要知道在以前，只要 Kafka Broker 使用的任何一块磁盘挂掉了，整个 Broker 进程都会关闭。但是自 1.1 开始，这种情况被修正了，坏掉的磁盘上的数据会自动地转移到其他正常的磁盘上，而且 Broker 还能正常工作。还记得上一期我们关于 Kafka 是否需要使用 RAID 的讨论吗？这个改进正是我们舍弃 RAID 方案的基础：没有这种 Failover 的话，我们只能依靠 RAID 来提供保障。这段话不太理解","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480983,"discussion_content":"简单来说，就是1.1版本之前，如果Kafka使用的任何一块硬盘坏掉了，Broker就会宕机。1.1版本之后不会了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578618464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125121,"user_name":"无情剃刀","can_delete":false,"product_type":"c1","uid":1436126,"ip_address":"","ucode":"7CA85164B797B4","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/de/0d632855.jpg","comment_is_top":false,"comment_ctime":1566094478,"is_pvip":false,"replies":[{"id":"46040","content":"等恢复了再转移","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566181545,"ip_address":"","comment_id":125121,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14450996366","product_id":100029201,"comment_content":"“坏掉的磁盘上的数据会自动地转移到其他正常的磁盘上，而且 Broker 还能正常工作。”磁盘都坏啦，还能转移？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463443,"discussion_content":"等恢复了再转移","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566181545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104741,"user_name":"mickle","can_delete":false,"product_type":"c1","uid":1201493,"ip_address":"","ucode":"1F89608B5E06C7","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/55/19ec7b0e.jpg","comment_is_top":false,"comment_ctime":1560825279,"is_pvip":false,"replies":[{"id":"38016","content":"不会啊，broker会重建副本，然后走正常的同步机制：从leader处拉取数据。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560903896,"ip_address":"","comment_id":104741,"utype":1}],"discussion_count":5,"race_medal":0,"score":"14445727167","product_id":100029201,"comment_content":"老师，对于磁盘坏掉以后转移到其他磁盘的机制，我有点疑问，如果已经坏掉，则不可读了，那么是不是只能从副本去转移了，如果从副本转移那就有可能会丢失部分最新的数据吧？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454401,"discussion_content":"不会啊，broker会重建副本，然后走正常的同步机制：从leader处拉取数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560903896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58305,"discussion_content":"确实存在疑惑：“broker会重建副本”的前提应该是能够访问到“尚未成功同步的、仅在主副本上持有的那部分消息”才行，不太清楚这个是如何实现的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574667070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1010402,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6a/e2/40766fe7.jpg","nickname":"独孤求败","note":"","ucode":"7C3EE22FC3594F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2239,"discussion_content":"同问，求老师有空解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563380593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1579066,"avatar":"https://static001.geekbang.org/account/avatar/00/18/18/3a/b407889c.jpg","nickname":"Geek_817ea4","note":"","ucode":"D1194D33C4DC11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":700,"discussion_content":"我也是有疑问，主副本磁盘坏了，那follow还没即时同步数据，那未同步的那部分数据怎么恢复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561969519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1580847,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1f/2f/73bc1aed.jpg","nickname":"辜放","note":"","ucode":"40E89B24CE64E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1579066,"avatar":"https://static001.geekbang.org/account/avatar/00/18/18/3a/b407889c.jpg","nickname":"Geek_817ea4","note":"","ucode":"D1194D33C4DC11","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2653,"discussion_content":"我想应该是这样，主副本的的磁盘坏了就没有leader了，zk会重新选举isr里面的副本当leader，然后从这个新的leader所在的broker恢复数据","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1563845194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":700,"ip_address":""},"score":2653,"extra":""}]}]},{"had_liked":false,"id":104724,"user_name":"bunny","can_delete":false,"product_type":"c1","uid":1513004,"ip_address":"","ucode":"EB5A8447708CE6","user_header":"https://static001.geekbang.org/account/avatar/00/17/16/2c/243c354a.jpg","comment_is_top":false,"comment_ctime":1560822122,"is_pvip":false,"replies":[{"id":"37875","content":"后面讲到producer和consumer会有涉及，但不会专门来讲，毕竟很多人反映单纯讲配置参数太枯燥了，还是结合具体的使用场景来讲比较好。另外建议delete.topic.enable保持默认值true就好，毕竟不能删除topic总显得不太方便。只是要注意权限设置即可，不可能 让任何人都能有删除topic的权限。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560823140,"ip_address":"","comment_id":104724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14445724010","product_id":100029201,"comment_content":"后面会单独讲解producer，consumer相关配置参数吧？还有这个参数delete.topic.enable，胡老师有什么建议么？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454390,"discussion_content":"后面讲到producer和consumer会有涉及，但不会专门来讲，毕竟很多人反映单纯讲配置参数太枯燥了，还是结合具体的使用场景来讲比较好。另外建议delete.topic.enable保持默认值true就好，毕竟不能删除topic总显得不太方便。只是要注意权限设置即可，不可能 让任何人都能有删除topic的权限。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560823140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104681,"user_name":"蒙开强","can_delete":false,"product_type":"c1","uid":1317706,"ip_address":"","ucode":"61B3183781B9F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/4a/f9df2d06.jpg","comment_is_top":false,"comment_ctime":1560817783,"is_pvip":false,"replies":[{"id":"37869","content":"目前不可以：（","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560822615,"ip_address":"","comment_id":104681,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14445719671","product_id":100029201,"comment_content":"老师，你好，kafka的log存储目录可以指定为hdfs上么，如果可以，那就不用给分区指定副本了，因为hdfs默认就是三个副本","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454373,"discussion_content":"目前不可以：（","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560822615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212060,"user_name":"真锅","can_delete":false,"product_type":"c1","uid":1141547,"ip_address":"","ucode":"D36634359B0BD6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqxnw92EOgZbyHDGMZ1d1OFDjjJKnBdmpiac8J7kBEN5h3AvvzU85mo5Chj8pkIHQc390dL1mu0neQ/132","comment_is_top":false,"comment_ctime":1588055350,"is_pvip":false,"replies":[{"id":"78885","content":"1. 完整正确：）<br>2. log.retention.bytes是broker级别的参数，但是具体生效的范围是单个分区日志。另外在删除的时候要对HW与删除位移上限的比较。如果后者越过了HW自然不允许删除该日志段","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1588086089,"ip_address":"","comment_id":212060,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10177989942","product_id":100029201,"comment_content":"老师，有几个问题请教一下。<br>1. log.dirs这个参数目的是将【某一个】broker的数据分散的存储到不同的目录或磁盘下。在之后设置了分区、副本策略后，多分区多副本的数据可能存储在不同的目录&#47;磁盘下，但都是属于这个broker的。这样的理解对吗。<br>2. log.retention.bytes，这个参数控制的是broker级别的删除吗。一个broker会存储属于不同topic的副本，如果某个broker因为达到容量上限了，触发策略删除了此broker中的旧日志段，这样不就导致该broker上副本的数据和其他broker上同topic的副本数据不一致了吗。还是说只会删除leader副本的日志段。<br>","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493422,"discussion_content":"1. 完整正确：）\n2. log.retention.bytes是broker级别的参数，但是具体生效的范围是单个分区日志。另外在删除的时候要对HW与删除位移上限的比较。如果后者越过了HW自然不允许删除该日志段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588086089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179189,"user_name":"咸淡一首诗","can_delete":false,"product_type":"c1","uid":1435869,"ip_address":"","ucode":"FEE5A9B5139BF1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl9nj9b6RydKADq82ZwOad0fQcvXWyQKk5U5RFC2kzHGI4GjIQsIZvHsEm7mFELgMiaGx3lGq9vag/132","comment_is_top":false,"comment_ctime":1581933700,"is_pvip":false,"replies":[{"id":"69621","content":"没办法。分区不可用之后里面的数据无法消费。hmmm，这种情况也不算数据丢失了，因为只要分区恢复正常，还是可以继续消费的<br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1581985527,"ip_address":"","comment_id":179189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10171868292","product_id":100029201,"comment_content":"老师，unclean.leader.election.enable 设置为false, 并且最后导致了分区不能用，那么该分区中的数据消费者也消费不到了，相当于数据丢失了，那么有什么办法能继续消费该分区数据吗？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484133,"discussion_content":"没办法。分区不可用之后里面的数据无法消费。hmmm，这种情况也不算数据丢失了，因为只要分区恢复正常，还是可以继续消费的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581985527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178634,"user_name":"咸淡一首诗","can_delete":false,"product_type":"c1","uid":1435869,"ip_address":"","ucode":"FEE5A9B5139BF1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl9nj9b6RydKADq82ZwOad0fQcvXWyQKk5U5RFC2kzHGI4GjIQsIZvHsEm7mFELgMiaGx3lGq9vag/132","comment_is_top":false,"comment_ctime":1581765811,"is_pvip":false,"replies":[{"id":"69362","content":"嗯，因为log.dir是先引入的，log.dirs是后加的参数：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1581813818,"ip_address":"","comment_id":178634,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10171700403","product_id":100029201,"comment_content":"老师，&quot; log.dir：注意这是 dir，结尾没有 s，说明它只能表示单个路径，它是补充上一个参数用的&quot; 这句话没有完全理解，既然 log.dirs 已经可以设置多个目录，如果需要追加在 log.dirs 后面追加即可，为什么还需要额外的 log.dir  参数补充呢？ log.dir 也是静态参数需要重启并不比 log.dirs 优越，为什么要有 log.dir 这个配置项？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483905,"discussion_content":"嗯，因为log.dir是先引入的，log.dirs是后加的参数：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581813818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150247,"user_name":"Welliam.Cao","can_delete":false,"product_type":"c1","uid":1046638,"ip_address":"","ucode":"D6B79E7A32E8E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/6e/4023d2e6.jpg","comment_is_top":false,"comment_ctime":1573483793,"is_pvip":false,"replies":[{"id":"57809","content":"从日志上来看可以看一下broker 4的连接状态是否正常，其他问题暂时还无法从日志中看出来","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573519630,"ip_address":"","comment_id":150247,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10163418385","product_id":100029201,"comment_content":"<br>接我上个问题的错误日志，麻烦帮忙指点一下：<br>state-change.log日志出现错误日志<br>[2019-11-05 11:08:50,508] ERROR [Controller id=2 epoch=5] Controller 2 epoch 5 failed to change state for partition xxxxx-37 from OnlinePartition to OnlinePartition (state.change.logger)<br>[2019-11-05 11:08:50,510] ERROR [Controller id=2 epoch=5] Controller 2 epoch 5 failed to change state for partition xxxxx-7 from OnlinePartition to OnlinePartition (state.change.logger)<br>server.log里面刷Shrinking&#47;Expanding日志，没有错误日志<br>[2019-11-05 11:08:47,630] INFO [Partition xxxxx-3 broker=2] Shrinking ISR from 2,3,4 to 2,3 (kafka.cluster.Partition)<br>[2019-11-05 11:08:52,745] INFO [Partition xxxxx-60 broker=2] Expanding ISR from 2,3 to 2,3,4 (kafka.cluster.Partition)","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474105,"discussion_content":"从日志上来看可以看一下broker 4的连接状态是否正常，其他问题暂时还无法从日志中看出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573519630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109565,"user_name":"小鱼","can_delete":false,"product_type":"c1","uid":1588606,"ip_address":"","ucode":"BDAEE77E973C0D","user_header":"","comment_is_top":false,"comment_ctime":1562057856,"is_pvip":false,"replies":[{"id":"39762","content":"num.partitions是自动创建topic的分区数。其实我觉得运维良好的集群应该禁掉自动创建topic，所有topic全部有运维手动创建好。所以理论上这个参数应该用不上。不过你的问题和如何评估分区数是相同的，基本上要结合你的SLA加上性能测试来共同决定。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562114935,"ip_address":"","comment_id":109565,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10151992448","product_id":100029201,"comment_content":"老师你好，请问num.partitions个数一般建议设置为多少个，是和broker的个数一致吗？提高partitions的个数，能增加消费者的消费速度吗？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456469,"discussion_content":"num.partitions是自动创建topic的分区数。其实我觉得运维良好的集群应该禁掉自动创建topic，所有topic全部有运维手动创建好。所以理论上这个参数应该用不上。不过你的问题和如何评估分区数是相同的，基本上要结合你的SLA加上性能测试来共同决定。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562114935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106620,"user_name":"东风第一枝","can_delete":false,"product_type":"c1","uid":1402697,"ip_address":"","ucode":"0CD0F62E90DAD8","user_header":"https://static001.geekbang.org/account/avatar/00/15/67/49/864dba17.jpg","comment_is_top":false,"comment_ctime":1561357715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10151292307","product_id":100029201,"comment_content":"👍，相当于把Kafka里面的一些坑预先告诉了我们。","like_count":2},{"had_liked":false,"id":106355,"user_name":"Geek_986289","can_delete":false,"product_type":"c1","uid":1182717,"ip_address":"","ucode":"503FE134FCC109","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKtYGLkKnh186Ynyx3bPvOMI7ViaWia2l8DD8eomDkE6AKNwW7l1a00CiaaiaiapibZY5JlQlxqQEQuSYFg/132","comment_is_top":false,"comment_ctime":1561278307,"is_pvip":false,"replies":[{"id":"38514","content":"这些都是全局参数，针对broker上所有log而言的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561339747,"ip_address":"","comment_id":106355,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10151212899","product_id":100029201,"comment_content":"老师，这里的log.retention.hour 和log.retention.bytes指的是单个log吧，感觉如果是所有log 的大小似乎还能理解，但是所有log 的hour 似乎有点说不通","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455058,"discussion_content":"这些都是全局参数，针对broker上所有log而言的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561339747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104667,"user_name":"Stalary","can_delete":false,"product_type":"c1","uid":1101749,"ip_address":"","ucode":"F69AFF7C958D31","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/b5/d1ec6a7d.jpg","comment_is_top":false,"comment_ctime":1560816753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10150751345","product_id":100029201,"comment_content":"很棒！好多都是踩过的坑","like_count":2},{"had_liked":false,"id":233580,"user_name":"汉斯·冯·拉特","can_delete":false,"product_type":"c1","uid":1102385,"ip_address":"","ucode":"29F14B0D938A02","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/31/f1bec7fc.jpg","comment_is_top":false,"comment_ctime":1594359792,"is_pvip":false,"replies":[{"id":"86295","content":"这是可以的，broker间的网络通讯是安全的话其实没必要做SSL","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1594448456,"ip_address":"","comment_id":233580,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5889327088","product_id":100029201,"comment_content":"老师，可以这样设置吗，listeners设置协议用PLAINTEXT，advertised.listeners设置协议为SASL_PLAINTEXT，让broker之间走plaintext，这样内部相互传输快些，但是外部访问则需要认证","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501093,"discussion_content":"这是可以的，broker间的网络通讯是安全的话其实没必要做SSL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594448456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227318,"user_name":"kai","can_delete":false,"product_type":"c1","uid":1018452,"ip_address":"","ucode":"443ED92B59AB8C","user_header":"","comment_is_top":false,"comment_ctime":1592357173,"is_pvip":true,"replies":[{"id":"83940","content":"auto.leader.rebalance.enable=false只是关闭自动调整机制。手动运行这个命令对所有副本执行preferred leader election是有风险的，因为可能涉及到大量分区的leader变更，会瞬间推高consumer和producer的请求延时，降低TPS。至于消息丢失，我觉得倒是不会。建议是尽量在低峰时刻执行这类操作。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1592473071,"ip_address":"","comment_id":227318,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5887324469","product_id":100029201,"comment_content":"老师好，有个问题麻烦问一下老师，若auto.leader.rebalance.enable=false，当集群 leader 不均匀的时候，执行kafka-preferred-replica-election.sh 脚本来重新平衡集群中的leader副本对集群会有什么影响，对消费者和生产者客户端有何影响？是否会造成消息丢失？应该如何更好地应对？尤其是如何保障避免消息丢失？谢谢老师～","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498592,"discussion_content":"auto.leader.rebalance.enable=false只是关闭自动调整机制。手动运行这个命令对所有副本执行preferred leader election是有风险的，因为可能涉及到大量分区的leader变更，会瞬间推高consumer和producer的请求延时，降低TPS。至于消息丢失，我觉得倒是不会。建议是尽量在低峰时刻执行这类操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592473071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215850,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1589118739,"is_pvip":false,"replies":[{"id":"79960","content":"0.9提供的java consumer之后已经不把offset保存在ZooKeeper中了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589180456,"ip_address":"","comment_id":215850,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884086035","product_id":100029201,"comment_content":"kafka保存偏移量好像是在zookeeper，不是在kafka;<br>请问哪个版本之后是存在kafka的.官网没有找到说明.","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494582,"discussion_content":"0.9提供的java consumer之后已经不把offset保存在ZooKeeper中了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589180456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212431,"user_name":"滚去滚来","can_delete":false,"product_type":"c1","uid":1980640,"ip_address":"","ucode":"0BCA19461E8FD0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/BZ0iakAttMwIhaLVgoicovSKU8QnAT1noScyWKggeaVffVAam56suNQvp6ttrSsWASJKQCrAnHYTsjyxjUfSicoxA/132","comment_is_top":false,"comment_ctime":1588122622,"is_pvip":false,"replies":[{"id":"78914","content":"依靠硬件保障数据持久性是一方面，也可以依靠软件层面的备份机制来保障。","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1588125352,"ip_address":"","comment_id":212431,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5883089918","product_id":100029201,"comment_content":"坏掉的磁盘数据，需要等磁盘恢复了再转移，是不是最可靠的方式是：磁盘还是要做raid(比如raid5)，有坏盘，告警通知（有没有命令手工设置该分区不可用，自动切换到新分区？）然后更换好坏盘后，再把该分区使能，这样只会有一段时间丢了数据，万一没raid的磁盘恢复不了，这个分区数据就真找不回来了","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493502,"discussion_content":"依靠硬件保障数据持久性是一方面，也可以依靠软件层面的备份机制来保障。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588125352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211619,"user_name":"辉","can_delete":false,"product_type":"c1","uid":1117850,"ip_address":"","ucode":"B235B6D76BE98A","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/9a/980682f5.jpg","comment_is_top":false,"comment_ctime":1587989657,"is_pvip":false,"replies":[{"id":"78671","content":"可以通过手动的方式来做迁移。尽量避免自动迁移，因为有很多不可控","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1587997293,"ip_address":"","comment_id":211619,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5882956953","product_id":100029201,"comment_content":"我怎么觉得auto.rebalence.那个参数要设置为true呢，可以防止某一个节点leader过多","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493316,"discussion_content":"可以通过手动的方式来做迁移。尽量避免自动迁移，因为有很多不可控","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587997293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018452,"avatar":"","nickname":"kai","note":"","ucode":"443ED92B59AB8C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283759,"discussion_content":"老师是否可以分析一下有哪些不可控？谢谢老师～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592357529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1018452,"avatar":"","nickname":"kai","note":"","ucode":"443ED92B59AB8C","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":300827,"discussion_content":"例如在业务高峰期自动reblance，增加了风险","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598276503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":283759,"ip_address":""},"score":300827,"extra":""}]}]},{"had_liked":false,"id":204639,"user_name":"飞猪环游记","can_delete":false,"product_type":"c1","uid":1120765,"ip_address":"","ucode":"BEE1A2E097997D","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/fd/b77903c0.jpg","comment_is_top":false,"comment_ctime":1586433674,"is_pvip":false,"replies":[{"id":"76527","content":"为什么不能通过主机名去访问呢? 使用IP其实也要要求能够ping通主机名，还是推荐统一使用主机名比较好","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1586481541,"ip_address":"","comment_id":204639,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5881400970","product_id":100029201,"comment_content":"<br>老师，你好，关于advertised.listeners参数，我在用docker部署的时候，配置成宿主机ip，同时客户端，服务端都在一个局域网，为什么访问不了呢，如果服务端部署到云服务器上，配置成外网lp就可以访问，在局域网的时候，我现在只能配置成主机名，但是客户端和服务端不在一台机器，客户端又不能通过主机名去访问，这个怎么解决？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491237,"discussion_content":"为什么不能通过主机名去访问呢? 使用IP其实也要要求能够ping通主机名，还是推荐统一使用主机名比较好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586481541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2281904,"avatar":"https://static001.geekbang.org/account/avatar/00/22/d1/b0/e8db9565.jpg","nickname":"钟","note":"","ucode":"3D2ECD40D42044","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383490,"discussion_content":"配置dns+f5？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626133606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120765,"avatar":"https://static001.geekbang.org/account/avatar/00/11/19/fd/b77903c0.jpg","nickname":"飞猪环游记","note":"","ucode":"BEE1A2E097997D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":227605,"discussion_content":"😂因为broker配置通过主机名访问，客户端就得配置hosts文件去映射，嫌麻烦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586506289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178762,"user_name":"咸淡一首诗","can_delete":false,"product_type":"c1","uid":1435869,"ip_address":"","ucode":"FEE5A9B5139BF1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl9nj9b6RydKADq82ZwOad0fQcvXWyQKk5U5RFC2kzHGI4GjIQsIZvHsEm7mFELgMiaGx3lGq9vag/132","comment_is_top":false,"comment_ctime":1581819414,"is_pvip":false,"replies":[{"id":"69481","content":"这是ZooKeeper上的chroot配置。如果你的ZooKeeper只服务于一套Kafka集群，那么可以不配置这个参数，否则就要设置chroot以区分要服务的不同Kafka集群。配置方法就是在listeners中直接指定就行了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1581899835,"ip_address":"","comment_id":178762,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5876786710","product_id":100029201,"comment_content":"老师，zk1:2181,zk2:2181,zk3:2181&#47;kafka1，zk1:2181,zk2:2181,zk3:2181&#47;kafka2 中的 kafka1 和  kafka2 这2个别名需要设置吗？如果需要配置，在哪里配置参数是什么？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483954,"discussion_content":"这是ZooKeeper上的chroot配置。如果你的ZooKeeper只服务于一套Kafka集群，那么可以不配置这个参数，否则就要设置chroot以区分要服务的不同Kafka集群。配置方法就是在listeners中直接指定就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581899835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143441,"user_name":"柯察金","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1571709414,"is_pvip":false,"replies":[{"id":"55481","content":"你的hostname在宿主机可以正确解析吗？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1571791913,"ip_address":"","comment_id":143441,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5866676710","product_id":100029201,"comment_content":"对 listeners 还是不明白。我在虚拟机里面启动了 kafka server ，然后再宿主机用 java client 去访问。如果在 listener 中指定了 hostname 就无法连接，如果不指定就可以连接，这是为啥啊","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471539,"discussion_content":"你的hostname在宿主机可以正确解析吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571791913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115149,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","nickname":"柯察金","note":"","ucode":"F722BF8FCD2C47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38483,"discussion_content":"可以的啊，都在 hosts 中有配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571794265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134957,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1568962540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863929836","product_id":100029201,"comment_content":"感谢老师分享，对于broker来讲，<br>1.broker.id这个参数应该也是必要的吧，为了以后集群好管理做准备。<br>2.log.flush.interval.messages和log.flush.interval.ms，这两个参数如果设置过小或者不合理的话，对IO也有一定影响的吧？<br>公司项目用kafka的时候还真的踩过坑，就是topic自动创建的配置，刚开始是默认开启的并且当时为了需求快速上线，没有配置kafka的测试环境，后面运维同学在维护的时候发现生产环境各种乱七八糟的topic都有，而且在用可视化管理工具打开的时候，就很卡，最后做清理的时候需要跟业务部门一个一个做确认，防止删除topic后数据丢失，特别麻烦，好在当时是kafka刚开始用不久，里面的topic数量特别多，否则处理起来更棘手，最后把这个参数关掉了。","like_count":1},{"had_liked":false,"id":129465,"user_name":"小北","can_delete":false,"product_type":"c1","uid":1101976,"ip_address":"","ucode":"4DAC260AC75B71","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/98/9779cf40.jpg","comment_is_top":false,"comment_ctime":1567133473,"is_pvip":true,"replies":[{"id":"48313","content":"显式设置上主机名吧","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567154948,"ip_address":"","comment_id":129465,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5862100769","product_id":100029201,"comment_content":"反反复复听了很多遍，老师请教一个问题。我是用docker启动的kafka，把参数listeners 设置为宿主机IP，就会报以下问题。ERROR [KafkaServer id=1001] Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)<br>org.apache.kafka.common.KafkaException: Socket server failed to bind to 192.168.100.20:9092: Address not available.<br>，但是设置为PLAINTEXT:&#47;&#47;:9092 内网的其他机器又无法访问。请问是不是我哪里做的不对。谢谢","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465484,"discussion_content":"显式设置上主机名吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567154948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101976,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d0/98/9779cf40.jpg","nickname":"小北","note":"","ucode":"4DAC260AC75B71","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6946,"discussion_content":"那请问这种情况是不是不能使用IP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567182945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120224,"user_name":"everhythm","can_delete":false,"product_type":"c1","uid":1055780,"ip_address":"","ucode":"A982AEC8FDD49B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPBia6bC8VmQPvLN7cK5LWVHj0an4m9hcJ2TzicnunfzhKMzib4OJaIsMsrdBQlOyT2ribw/132","comment_is_top":false,"comment_ctime":1564809442,"is_pvip":false,"replies":[{"id":"44258","content":"broker端会抛出异常","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1564966292,"ip_address":"","comment_id":120224,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5859776738","product_id":100029201,"comment_content":"message.max.bytes 设置broker 和 client 各有一份，如果client 发送超过设定大小的msg ，broker的处理方式是怎样的？<br><br>之前碰到过 broker直接断开连接（client用的librdkafka ，从callback看broker status直接变成down，然后消息堆积，重连client才可用）","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461247,"discussion_content":"broker端会抛出异常","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564966292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114184,"user_name":"李跃爱学习","can_delete":false,"product_type":"c1","uid":1347792,"ip_address":"","ucode":"F25C038C86324A","user_header":"https://static001.geekbang.org/account/avatar/00/14/90/d0/48037ba6.jpg","comment_is_top":false,"comment_ctime":1563246871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858214167","product_id":100029201,"comment_content":"没有这种 Failover 的话，我们只能依靠 RAID 来提供保障<br>— 这个说法我觉得不是很妥当。我们不用RAID应该是具备足够的 replica 吧，和Failover没有必然联系","like_count":1},{"had_liked":false,"id":353971,"user_name":"Geek_4a6e69","can_delete":false,"product_type":"c1","uid":2882400,"ip_address":"云南","ucode":"EE003DDF8BC99D","user_header":"","comment_is_top":false,"comment_ctime":1659964113,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1659964113","product_id":100029201,"comment_content":"老师你好，这里的Failover是指，如果我配置了多个目录对应到多块磁盘，比如3块，如果其中一块磁盘出问题了，那数据是会自动专业到其他两块上，是转移到其他两块上已配置的目录下，还是其他目录。<br><br>如果我的分区数和副本数都是1，那这里log.dirs 配置多个，数据还是会分散存储？","like_count":0},{"had_liked":false,"id":349979,"user_name":"于晓东","can_delete":false,"product_type":"c1","uid":2638387,"ip_address":"","ucode":"7E4FB0FE24C9AC","user_header":"https://static001.geekbang.org/account/avatar/00/28/42/33/3805be13.jpg","comment_is_top":false,"comment_ctime":1656482135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656482135","product_id":100029201,"comment_content":"unclean.leader.election.enable<br>关于这个参数，我们是给他设置成true了，我仔细的问了一下，意见是优先保证集群可用，这个估计跟业务有关系。","like_count":0},{"had_liked":false,"id":345539,"user_name":"InfoQ_7b1f2555555f","can_delete":false,"product_type":"c1","uid":1962216,"ip_address":"","ucode":"FB718710FD5B12","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erp3Is6ckmsGqtTP8t7xTQkrLUcOcFstAkE565FmYFibawfVIXTtu1vXtXibpHZK5dBL2F42ZpM0iamA/132","comment_is_top":false,"comment_ctime":1652367147,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652367147","product_id":100029201,"comment_content":"请问，如果磁盘被写满了会覆盖最久的消息继续写入吗？","like_count":0},{"had_liked":false,"id":344211,"user_name":"InfoQ_7b1f2555555f","can_delete":false,"product_type":"c1","uid":1962216,"ip_address":"","ucode":"FB718710FD5B12","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erp3Is6ckmsGqtTP8t7xTQkrLUcOcFstAkE565FmYFibawfVIXTtu1vXtXibpHZK5dBL2F42ZpM0iamA/132","comment_is_top":false,"comment_ctime":1651373233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651373233","product_id":100029201,"comment_content":"log.dirs设置多个目录后会将数据均分到多个目录下进行存储吗？","like_count":0},{"had_liked":false,"id":338374,"user_name":"Geek_6ce829","can_delete":false,"product_type":"c1","uid":2945853,"ip_address":"","ucode":"0AB51DE2BBB6DF","user_header":"","comment_is_top":false,"comment_ctime":1647447650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647447650","product_id":100029201,"comment_content":"kafka线上集群配置用户名和密码吗？会进行 ACL鉴权吗？","like_count":0},{"had_liked":false,"id":336436,"user_name":"冰原的苍蓝星","can_delete":false,"product_type":"c1","uid":1862936,"ip_address":"","ucode":"84120EC31A63AF","user_header":"https://static001.geekbang.org/account/avatar/00/1c/6d/18/e05f72ee.jpg","comment_is_top":false,"comment_ctime":1646145380,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646145380","product_id":100029201,"comment_content":"我怎么觉得我刚学kafka就看这些参数配置有点太早了的感觉。。。","like_count":0},{"had_liked":false,"id":333412,"user_name":"起风了","can_delete":false,"product_type":"c1","uid":2719086,"ip_address":"","ucode":"730DC69D98608F","user_header":"https://static001.geekbang.org/account/avatar/00/29/7d/6e/ac873f72.jpg","comment_is_top":false,"comment_ctime":1644332049,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644332049","product_id":100029201,"comment_content":"auto.create.topics.enable 这个变量false的话会影响streams里的如一些时间窗口统计的topics创建吗","like_count":0},{"had_liked":false,"id":326155,"user_name":"William","can_delete":false,"product_type":"c1","uid":1346215,"ip_address":"","ucode":"55F5D9DEE485B1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","comment_is_top":false,"comment_ctime":1639397760,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1639397760","product_id":100029201,"comment_content":"老师，主要是想上手实际应用开发，目前推荐着重看些章节？","like_count":0},{"had_liked":false,"id":314037,"user_name":"幼稚园的小朋友","can_delete":false,"product_type":"c1","uid":2725596,"ip_address":"","ucode":"EF63C355BD58A7","user_header":"https://static001.geekbang.org/account/avatar/00/29/96/dc/8adf8971.jpg","comment_is_top":false,"comment_ctime":1632814875,"is_pvip":false,"replies":[{"id":"114436","content":"是的，broker端参数都可以在server.properties中配置","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1634004469,"ip_address":"","comment_id":314037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632814875","product_id":100029201,"comment_content":"老师您好 想问下您您说得的这些配置都是可以在 &#47;conf&#47;server.properties中配置的嘛？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527552,"discussion_content":"是的，broker端参数都可以在server.properties中配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634004469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310081,"user_name":"黄婷婷","can_delete":false,"product_type":"c1","uid":1467134,"ip_address":"","ucode":"8B65636C9197A2","user_header":"https://static001.geekbang.org/account/avatar/00/16/62/fe/6d2fa6b9.jpg","comment_is_top":false,"comment_ctime":1630480716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630480716","product_id":100029201,"comment_content":"老师，故障转移的细节可以详细讲一下嘛","like_count":0},{"had_liked":false,"id":307667,"user_name":"Geek_f4512f","can_delete":false,"product_type":"c1","uid":2733281,"ip_address":"","ucode":"3CB387D2943590","user_header":"","comment_is_top":false,"comment_ctime":1629194132,"is_pvip":false,"replies":[{"id":"112534","content":"可以的，没问题","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1630810767,"ip_address":"","comment_id":307667,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629194132","product_id":100029201,"comment_content":"我从来没用过kafka 可以学这个课程吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525235,"discussion_content":"可以的，没问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630810767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300465,"user_name":"freesocean","can_delete":false,"product_type":"c1","uid":1529210,"ip_address":"","ucode":"CAD4C80CF569D3","user_header":"https://static001.geekbang.org/account/avatar/00/17/55/7a/d44df1d6.jpg","comment_is_top":false,"comment_ctime":1625186790,"is_pvip":false,"replies":[{"id":"109457","content":"它首先会尝试向第一个broker发送请求获取集群信息","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1626242292,"ip_address":"","comment_id":300465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625186790","product_id":100029201,"comment_content":"当客户端连接kafka集群时，会连接到哪个broker？ 比如--broker-list 指定了一个地址列表，是访问第一个地址吗？  ","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522740,"discussion_content":"它首先会尝试向第一个broker发送请求获取集群信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626242292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299065,"user_name":"曹杯杯💥","can_delete":false,"product_type":"c1","uid":1467004,"ip_address":"","ucode":"CA030DFC3D6912","user_header":"https://static001.geekbang.org/account/avatar/00/16/62/7c/a46ca139.jpg","comment_is_top":false,"comment_ctime":1624446507,"is_pvip":false,"replies":[{"id":"108483","content":"您的困惑是？","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1624497332,"ip_address":"","comment_id":299065,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624446507","product_id":100029201,"comment_content":"我是数据产品，最近在做实时中间层接入，但是对topic的生产和输出有点迷茫","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522318,"discussion_content":"您的困惑是？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624497332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298412,"user_name":"Soul","can_delete":false,"product_type":"c1","uid":1332755,"ip_address":"","ucode":"91D8794DD2FAD2","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/13/b2f3611e.jpg","comment_is_top":false,"comment_ctime":1624089097,"is_pvip":false,"replies":[{"id":"108488","content":"如果是false，正常情况下就不会出现丢失数据的情况。我再次提醒各位，对于Kafka而言，当acks=all时，只有成功提交的消息被丢失才算是丢失。只是写入了几个副本（没有写满所有ISR）最后丢失了，不算丢失","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1624497558,"ip_address":"","comment_id":298412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624089097","product_id":100029201,"comment_content":"unclean.leader.election.enable：是否允许 Unclean Leader 选举。<br>假如按照推荐的设置成false， 由其他存储比较多的副本来参与竞争 竞选Leader， 这时候的副本应该也是数据不全的副本吧， 不还是会丢失数据？<br>和设置成true，用落后更多数据的副本产生的副作用不是一样吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522131,"discussion_content":"如果是false，正常情况下就不会出现丢失数据的情况。我再次提醒各位，对于Kafka而言，当acks=all时，只有成功提交的消息被丢失才算是丢失。只是写入了几个副本（没有写满所有ISR）最后丢失了，不算丢失","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624497558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291270,"user_name":"wang-possible","can_delete":false,"product_type":"c1","uid":1268939,"ip_address":"","ucode":"5639E96CD4F833","user_header":"https://static001.geekbang.org/account/avatar/00/13/5c/cb/65b38e27.jpg","comment_is_top":false,"comment_ctime":1620178052,"is_pvip":false,"replies":[{"id":"105696","content":"多个路径，多个线程同时加载，加速","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1620614068,"ip_address":"","comment_id":291270,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620178052","product_id":100029201,"comment_content":"log.dirs 配置多个多路径后，具体是怎样提高读写性能的，能详细讲一下吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519425,"discussion_content":"多个路径，多个线程同时加载，加速","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620614068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291153,"user_name":"路客","can_delete":false,"product_type":"c1","uid":1721812,"ip_address":"","ucode":"DE3765016947DA","user_header":"https://static001.geekbang.org/account/avatar/00/1a/45/d4/39a662ef.jpg","comment_is_top":false,"comment_ctime":1620054854,"is_pvip":false,"replies":[{"id":"105697","content":"这3个broker就构成了一个kafka集群，它们启动时会去连接zookeeper去获取一些必要的数据","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1620614228,"ip_address":"","comment_id":291153,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620054854","product_id":100029201,"comment_content":"老师，我最近在一台服务器上起了三个kafka，每个kafka一个broker，然后zk用的也是同一台服务器，端口号一个2181 一个2182。我其实没有理解kafka的集群是一个什么概念，然后这三个broker怎么去注册到zk的，有些凌乱。。。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519389,"discussion_content":"这3个broker就构成了一个kafka集群，它们启动时会去连接zookeeper去获取一些必要的数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620614228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290974,"user_name":"seleven","can_delete":false,"product_type":"c1","uid":1338701,"ip_address":"","ucode":"B4D84E6B930448","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/SsJajvXghPMDicSuOcx54mV6L9zv4KSKM2bKY0gsUdAH3oGCWzfRv9Q9HRljic2IvHzYFpRECp8SXGWhiaqGWFTKg/132","comment_is_top":false,"comment_ctime":1619889259,"is_pvip":false,"replies":[{"id":"105698","content":"应该是消息时间戳的设定，最好保持时间同步","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1620614259,"ip_address":"","comment_id":290974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619889259","product_id":100029201,"comment_content":"胡老师，您好，请教个问题：我们现在的使用的是kafka2.11_1.1.1版本，用三个虚拟机搭建的一个小集群C，现在有客户端A可以正常访问C，但是突然改变了A的系统时间后，导致A向C发送消息失败，不知这是什么问题？请老师赐教！","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519332,"discussion_content":"应该是消息时间戳的设定，最好保持时间同步","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620614259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273831,"user_name":"redis","can_delete":false,"product_type":"c1","uid":1066278,"ip_address":"","ucode":"91C54605384F51","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/26/f54c9888.jpg","comment_is_top":false,"comment_ctime":1610691298,"is_pvip":false,"replies":[{"id":"99931","content":"连接不上了Coordinator，查看与这个broker之间的连通性","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1611539094,"ip_address":"","comment_id":273831,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1610691298","product_id":100029201,"comment_content":" [Consumer clientId=consumer-7, groupId=test2] Group coordinator 10.20.129.161:9090 (id: 2147483486 rack: null) is unavailable or invalid, will attempt rediscovery   请问下这个是什么原因导致的呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513823,"discussion_content":"连接不上了Coordinator，查看与这个broker之间的连通性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611539094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":262547,"user_name":"王聪 Claire","can_delete":false,"product_type":"c1","uid":1090310,"ip_address":"","ucode":"0D9CC82C9F44D4","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/06/9fa93074.jpg","comment_is_top":false,"comment_ctime":1605765165,"is_pvip":false,"replies":[{"id":"95339","content":"这个和kafka-manager关系不大，应该还是副本数量不足导致的","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1605838217,"ip_address":"","comment_id":262547,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605765165","product_id":100029201,"comment_content":"老师好，麻烦问一下kafka_manager会影响kafka的性能吗？机器上启动kafka-manager后，kafka会报Produce failed: Broker: Not enough in-sync replicas 错误，过一会儿才会同步成功。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509879,"discussion_content":"这个和kafka-manager关系不大，应该还是副本数量不足导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605838217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244131,"user_name":"ningfuzhao","can_delete":false,"product_type":"c1","uid":2139107,"ip_address":"","ucode":"164B63A4C22768","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKIFBib8INpPpIKZe2EVWUhbVXTicaGcZOUdsYYNJuubK6OwchTrOgeg2ibDtmcH7smUTBgd2puXm1Hg/132","comment_is_top":false,"comment_ctime":1598407205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598407205","product_id":100029201,"comment_content":"老师的声音很好听","like_count":0},{"had_liked":false,"id":240195,"user_name":"火狼","can_delete":false,"product_type":"c1","uid":2046978,"ip_address":"","ucode":"37BDE583E64D8C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/3c/02/b7c27217.jpg","comment_is_top":false,"comment_ctime":1596784722,"is_pvip":false,"replies":[{"id":"88689","content":"保存消息","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1596797700,"ip_address":"","comment_id":240195,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596784722","product_id":100029201,"comment_content":"老师您好，想问下 为什么要给Broker的堆内存分配6G，Kafka用堆内存主要做什么？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503370,"discussion_content":"保存消息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596797700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222172,"user_name":"密码123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1590712528,"is_pvip":false,"replies":[{"id":"81990","content":"可以的，试试看：）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1590750234,"ip_address":"","comment_id":222172,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590712528","product_id":100029201,"comment_content":"以前没玩过，kafka学了这个专栏，能上手吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496702,"discussion_content":"可以的，试试看：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590750234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215842,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1589116536,"is_pvip":false,"replies":[{"id":"79959","content":"为什么会有两个？两个chroot标识两套Kafka集群了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1589180276,"ip_address":"","comment_id":215842,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589116536","product_id":100029201,"comment_content":"请问<br>zookeeper.connect参数可以这样指定：zk1:2181,zk2:2181,zk3:2181&#47;kafka1和zk1:2181,zk2:2181,zk3:2181&#47;kafka2。切记 chroot 只需要写一次，而且是加到最后的.<br><br>是直接在配置文件写下面这两个还是只写一个?<br>zookeeper.connect=zk1:2181,zk2:2181,zk3:2181&#47;kafka1<br>zookeeper.connect=zk1:2181,zk2:2181,zk3:2181&#47;kafka2","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494578,"discussion_content":"为什么会有两个？两个chroot标识两套Kafka集群了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589180276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198455,"user_name":"幸运草","can_delete":false,"product_type":"c1","uid":1622282,"ip_address":"","ucode":"ACDF6C4E573FDB","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/0a/a44e3786.jpg","comment_is_top":false,"comment_ctime":1585452493,"is_pvip":false,"replies":[{"id":"74839","content":"这两套zk配置信息分别是给两套Kafka集群用的~","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1585533683,"ip_address":"","comment_id":198455,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585452493","product_id":100029201,"comment_content":"两套kafka集群使用一套zookeeper集群，zookeeper. connect:zk1:2181,zk2:2181,zk3:2181&#47;kafka1和zk1:2181,zk2:2181,zk3:2181&#47;kafka2，这里的“和”字还要么？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489707,"discussion_content":"这两套zk配置信息分别是给两套Kafka集群用的~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585533683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622282,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c1/0a/a44e3786.jpg","nickname":"幸运草","note":"","ucode":"ACDF6C4E573FDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219653,"discussion_content":"中间这个“和”字还要么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585792476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195164,"user_name":"Evan","can_delete":false,"product_type":"c1","uid":1344281,"ip_address":"","ucode":"B877ABD0CF4661","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/19/0a3fe8c1.jpg","comment_is_top":false,"comment_ctime":1585142956,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1585142956","product_id":100029201,"comment_content":"分区参数，num.partitions  2. log.retention.ms  消息保留的时间， ","like_count":0},{"had_liked":false,"id":194095,"user_name":"扬一场远远的风","can_delete":false,"product_type":"c1","uid":1357801,"ip_address":"","ucode":"AB47E3D2EAB8A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/b7/e9/5400cdf3.jpg","comment_is_top":false,"comment_ctime":1585024436,"is_pvip":false,"replies":[{"id":"74067","content":"和这些参数都没有关系","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1585096695,"ip_address":"","comment_id":194095,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585024436","product_id":100029201,"comment_content":"您好。昨天问的增加consumer数量后频繁reblance的问题。我主要是想知道这种情况是否和kafka的某些配置有关？比如：NUM.IO.THREADS: &quot;64&quot;,<br>NUM.NETWORK.THREADS &quot;32&quot;,<br>NUM.REPLICA.FETCHERS: &quot;24&quot;<br>这几个配置项我设置的值是否合理？集群总共 3个broker","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488755,"discussion_content":"和这些参数都没有关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585096695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193864,"user_name":"扬一场远远的风","can_delete":false,"product_type":"c1","uid":1357801,"ip_address":"","ucode":"AB47E3D2EAB8A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/b7/e9/5400cdf3.jpg","comment_is_top":false,"comment_ctime":1584975107,"is_pvip":false,"replies":[{"id":"73825","content":"首先，没有主动rebalance和被动rebalance的提法。增加consumer数之后频繁rebalance，有无可能这些新增的consumer表现不稳定或者影响了之前的consumer？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1585006999,"ip_address":"","comment_id":193864,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1584975107","product_id":100029201,"comment_content":"您好，问一下我的一个topic 有48个partitions,当我的congsumer 数是12的时候，几乎没有reblance ，当我把consumer 数调到24、48时会出现频繁reblance 。这是什么原因呢？另外，从日志中可以区分主动reblance 和被动reblance 么","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488685,"discussion_content":"首先，没有主动rebalance和被动rebalance的提法。增加consumer数之后频繁rebalance，有无可能这些新增的consumer表现不稳定或者影响了之前的consumer？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585006999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357801,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b7/e9/5400cdf3.jpg","nickname":"扬一场远远的风","note":"","ucode":"AB47E3D2EAB8A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212683,"discussion_content":"这个有可能。我主要是想知道这种情况是否和kafka的某些配置有关？比如：NUM.IO.THREADS: &#34;64&#34;,\nNUM.NETWORK.THREADS &#34;32&#34;,\nNUM.REPLICA.FETCHERS: &#34;24&#34;\n这几个配置项我设置的值是否合理？集群总共 3个broker","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585008261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183920,"user_name":"文灏","can_delete":false,"product_type":"c1","uid":1122739,"ip_address":"","ucode":"177D548FC87BED","user_header":"https://static001.geekbang.org/account/avatar/00/11/21/b3/db933462.jpg","comment_is_top":false,"comment_ctime":1583162439,"is_pvip":false,"replies":[{"id":"71210","content":"客户端解析主机名会有什么问题吗？如果有，也不是说不能用IP","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1583197045,"ip_address":"","comment_id":183920,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583162439","product_id":100029201,"comment_content":"这里我给出统一的建议：最好全部使用主机名，即 Broker 端和 Client 端应用配置中全部填写主机名。胡老师好，这里如果建议用主机名的话，那客户端不就又得牵扯到如何解析主机名的问题吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485821,"discussion_content":"客户端解析主机名会有什么问题吗？如果有，也不是说不能用IP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583197045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161501,"user_name":"第一片心意","can_delete":false,"product_type":"c1","uid":1682331,"ip_address":"","ucode":"4CFE5F1D615743","user_header":"https://static001.geekbang.org/account/avatar/00/19/ab/9b/b12c223d.jpg","comment_is_top":false,"comment_ctime":1576218574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576218574","product_id":100029201,"comment_content":"auto.leader.rebalance.enable","like_count":0},{"had_liked":false,"id":147887,"user_name":"Welliam.Cao","can_delete":false,"product_type":"c1","uid":1046638,"ip_address":"","ucode":"D6B79E7A32E8E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/6e/4023d2e6.jpg","comment_is_top":false,"comment_ctime":1572917335,"is_pvip":false,"replies":[{"id":"57109","content":"这是在异步更新每个broker上的元数据缓存时打出的TRACE，单凭这个日志看不出任何的异常，还是要结合其他的日志（特别是Error日志）来定位原因。<br><br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573001373,"ip_address":"","comment_id":147887,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1572917335","product_id":100029201,"comment_content":"老师请教一下，我们线上的kafka集群state-change.log日志会不定期出现下面这种日志，导致生产者会生产消息超时，不知道是不是跟auto.leader.rebalance.enable这个参数有关，请问如果避免出现这类日志。<br>TRACE [Broker id=0] Cached leader info PartitionState(controllerEpoch=5, leader=3, leaderEpoch=12, isr=[3, 4, 0], zkVersion=25, replicas=[3, 4, 0], offlineReplicas=[]) for partition xxxxxxx-14 in response to UpdateMetadata request sent by controller 2 epoch 5 with correlation id 483 (state.change.logger)","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473329,"discussion_content":"这是在异步更新每个broker上的元数据缓存时打出的TRACE，单凭这个日志看不出任何的异常，还是要结合其他的日志（特别是Error日志）来定位原因。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573001373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046638,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/6e/4023d2e6.jpg","nickname":"Welliam.Cao","note":"","ucode":"D6B79E7A32E8E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45464,"discussion_content":"state-change.log日志出现错误日志\n[2019-11-05 11:08:50,508] ERROR [Controller id=2 epoch=5] Controller 2 epoch 5 failed to change state for partition xxxxx-37 from OnlinePartition to OnlinePartition (state.change.logger)\n[2019-11-05 11:08:50,510] ERROR [Controller id=2 epoch=5] Controller 2 epoch 5 failed to change state for partition xxxxx-7 from OnlinePartition to OnlinePartition (state.change.logger)\nserver.log里面刷Shrinking/Expanding日志，没有错误日志\n[2019-11-05 11:08:47,630] INFO [Partition xxxxx-3 broker=2] Shrinking ISR from 2,3,4 to 2,3 (kafka.cluster.Partition)\n[2019-11-05 11:08:52,745] INFO [Partition xxxxx-60 broker=2] Expanding ISR from 2,3 to 2,3,4 (kafka.cluster.Partition)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573041049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124069,"user_name":"未名之殇","can_delete":false,"product_type":"c1","uid":1174707,"ip_address":"","ucode":"B42DE2C11059B2","user_header":"","comment_is_top":false,"comment_ctime":1565801893,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565801893","product_id":100029201,"comment_content":"老师好，kafka版本用的0.9.0.1，一个topic占用15个broker，32个分区<br>使用8个logstash进程进行消费，每个进程配置4个线程，消费时经常出现Rebalance，请帮我看下参数是不是有不合理的地方。<br>kafka相关参数如下：<br>    session_timeout_ms =&gt; &quot;30000&quot;<br>    request_timeout_ms =&gt; &quot;40000&quot;<br>    heartbeat_interval_ms =&gt; &quot;10000&quot;<br>    max_partition_fetch_bytes =&gt; &quot;10485760&quot;<br>    decorate_events =&gt; true<br>    auto_commit_interval_ms =&gt; &quot;60000&quot;<br>    poll_timeout_ms =&gt; 1000","like_count":0},{"had_liked":false,"id":123489,"user_name":"大雄","can_delete":false,"product_type":"c1","uid":1307188,"ip_address":"","ucode":"45B96AF48DF134","user_header":"https://static001.geekbang.org/account/avatar/00/13/f2/34/03282f4d.jpg","comment_is_top":false,"comment_ctime":1565685961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565685961","product_id":100029201,"comment_content":"关于broker有些不明白的地方想请教胡老师<br><br>1.broker配置参数中，可配置多个log.dirs路径,log.dirs配置的文件夹中存放的实体文件主要为topic的partition文件，dirs文件夹放在多个物理盘上能够提高读写速度，这里的dirs配置的文件夹是与topic对应？还是与partition对应？也即同一个topic所有partition放在同一个dirs目录中，一个broker中不同磁盘放不同的多个topic增加读写速度，还是一个topic可以跨多个dirs中配置的文件夹，将同一个topic的不同partition分散在不同dirs中提高读写速度，不知道哪个理解正确还是都不正确？<br><br><br><br>2.如果partition或topic可分散放于不同dirs中，这一步是需要手动配置还是broker会根据dirs数量自动将partition或topic分配到不同dirs文件夹中？<br><br>3.假如我的服务器（一台服务器为一个broker）有两个磁盘，每个磁盘很小只有100g，topic和partition都为1并且不设following，log.dirs中设置了两个硬盘的路径，整体都先放在第一个磁盘上运行，log.retention.bytes如果设为-1,可用全磁盘容量，如果其中一个物理磁盘满了的话，broker会自动在第二快磁盘上开始写么？还是直接就报异常了？<br><br>这三个问题有些交叉，主要是自己理不顺这里的关系，还望胡老师能给解惑，多谢。<br><br>","like_count":0},{"had_liked":false,"id":122915,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565573134,"is_pvip":false,"replies":[{"id":"45127","content":"嗯嗯，最好结合实际项目学习，这样快得多：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1565575502,"ip_address":"","comment_id":122915,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565573134","product_id":100029201,"comment_content":"目前还有用过kafka，先打卡，回头使用了，再回头看一下。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462454,"discussion_content":"嗯嗯，最好结合实际项目学习，这样快得多：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565575502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116670,"user_name":"wykkx","can_delete":false,"product_type":"c1","uid":1122358,"ip_address":"","ucode":"ABCDF49E7A95C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","comment_is_top":false,"comment_ctime":1563887982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563887982","product_id":100029201,"comment_content":"老师 我三个节点的kafka集群，当min.insync.replicas=1设置为1的时候消费者可以正常消费数据，但是当这个值改为2的时候，消费者就收不到数据了。这是什么问题啊？<br>其他主要参数：<br>replica.fetch.max.bytes=10020000<br>message.max.bytes=10000000<br>auto.leader.rebalance.enable=false<br>unclean.leader.election.enable=false<br>request.required.acks=-1<br>default.replication.factor=3<br>message.send.max.retries=5<br>auto.create.topics.enable=false<br>这个问题搞了好几天了，也没搞明白，麻烦老师给看下，谢谢","like_count":0},{"had_liked":false,"id":115399,"user_name":"老鱼","can_delete":false,"product_type":"c1","uid":1221974,"ip_address":"","ucode":"2C873D9E34CB00","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/56/d1f70c0d.jpg","comment_is_top":false,"comment_ctime":1563575907,"is_pvip":false,"replies":[{"id":"42310","content":"所有副本落后leader太多，常见的可能是leader自己是不是有问题了。。。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563752725,"ip_address":"","comment_id":115399,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563575907","product_id":100029201,"comment_content":"老师，一般是什么原因导致的unclean replica","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459089,"discussion_content":"所有副本落后leader太多，常见的可能是leader自己是不是有问题了。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563752725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115208,"user_name":"拒绝","can_delete":false,"product_type":"c1","uid":1335155,"ip_address":"","ucode":"CB0264C4D3FE17","user_header":"https://static001.geekbang.org/account/avatar/00/14/5f/73/bb3dc468.jpg","comment_is_top":false,"comment_ctime":1563508023,"is_pvip":false,"replies":[{"id":"42085","content":"后面有专门介绍如何避免数据丢失的配置：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1563517027,"ip_address":"","comment_id":115208,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563508023","product_id":100029201,"comment_content":"胡老师：<br>    什么情况下，kafka会丢失数据，及怎么做才能不让数据丢失","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459010,"discussion_content":"后面有专门介绍如何避免数据丢失的配置：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563517027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114390,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1563288830,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563288830","product_id":100029201,"comment_content":"老师好，kafka的零拷贝原理后面会讲么?","like_count":0},{"had_liked":false,"id":109643,"user_name":"mellow","can_delete":false,"product_type":"c1","uid":1257852,"ip_address":"","ucode":"C44F0A588263C6","user_header":"https://static001.geekbang.org/account/avatar/00/13/31/7c/14df0dbf.jpg","comment_is_top":false,"comment_ctime":1562070968,"is_pvip":false,"replies":[{"id":"39761","content":"线上环境自动迁移大批量分区的leader，对业务影响很大。运维手动介入比较保险。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1562114862,"ip_address":"","comment_id":109643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562070968","product_id":100029201,"comment_content":"auto.leader.rebalance.enable设置为false之后，当集群中一些节点down，此时leader就会转移到其他节点上去，重启之后如果不触发leader balance的话不就会导致leader在同一节点上吗，请求都打到该节点，达不到负载均衡，望老师解答一下","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456494,"discussion_content":"线上环境自动迁移大批量分区的leader，对业务影响很大。运维手动介入比较保险。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562114862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108617,"user_name":"与狼共舞","can_delete":false,"product_type":"c1","uid":1087395,"ip_address":"","ucode":"3714E31F20385D","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/a3/25bd1173.jpg","comment_is_top":false,"comment_ctime":1561815299,"is_pvip":false,"replies":[{"id":"39437","content":"如果你的client只能通过外网IP访问具体的broker，那么broker只能设置外网IP","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561946584,"ip_address":"","comment_id":108617,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1561815299","product_id":100029201,"comment_content":"老师，请教一个关于内外网设置方面的问题。如果每个broker节点的 advertised.listeners都设置为外网IP，这样一来，假设集群有多个 broker节点，是不是得要有多个外网ip？ 而外网ip这个资源比较有限，有没有更好的方法呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456059,"discussion_content":"如果你的client只能通过外网IP访问具体的broker，那么broker只能设置外网IP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561946584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300823,"discussion_content":"可以共用一个外网ip，然后配上不同端口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598274570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336037,"avatar":"https://static001.geekbang.org/account/avatar/00/14/62/e5/d7583ce4.jpg","nickname":"bz","note":"","ucode":"FF7432FD129D7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2304,"discussion_content":"想问的是，是否需要一个broker对应一个外网ip","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563446283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1589021,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3f/1d/67933cd1.jpg","nickname":"tly","note":"","ucode":"F0C182E204626D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336037,"avatar":"https://static001.geekbang.org/account/avatar/00/14/62/e5/d7583ce4.jpg","nickname":"bz","note":"","ucode":"FF7432FD129D7E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125108,"discussion_content":"需要的，不然会出现数据丢失","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578474395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2304,"ip_address":""},"score":125108,"extra":""},{"author":{"id":1052528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0f/70/c8680841.jpg","nickname":"Joe Black","note":"","ucode":"21FE222A286445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1589021,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3f/1d/67933cd1.jpg","nickname":"tly","note":"","ucode":"F0C182E204626D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":254448,"discussion_content":"这样是因为客户端使用kafka的API造成的吧？因为会直接访问任何一个broker？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588327602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":125108,"ip_address":""},"score":254448,"extra":""}]}]},{"had_liked":false,"id":107613,"user_name":"易水寒","can_delete":false,"product_type":"c1","uid":1238961,"ip_address":"","ucode":"F5D8127ED4754E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/b1/5c63be67.jpg","comment_is_top":false,"comment_ctime":1561565118,"is_pvip":false,"replies":[{"id":"38934","content":"“消费者处理消息如果时间过长” 为什么会阻塞在poll方法上呢？应该是阻塞在处理方法中吧？我觉得一个可能的原因是处理时间过长导致的频繁rebalance。看看日志是否存在频繁rebalance的情况。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561596168,"ip_address":"","comment_id":107613,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561565118","product_id":100029201,"comment_content":"竟然不能回复。老师，之前用的是0.11版本的，就是消费者处理消息如果时间过长的话，会长期阻塞在poll方法上，无法继续消费新的消息","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455587,"discussion_content":"“消费者处理消息如果时间过长” 为什么会阻塞在poll方法上呢？应该是阻塞在处理方法中吧？我觉得一个可能的原因是处理时间过长导致的频繁rebalance。看看日志是否存在频繁rebalance的情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561596168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107209,"user_name":"易水寒","can_delete":false,"product_type":"c1","uid":1238961,"ip_address":"","ucode":"F5D8127ED4754E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/b1/5c63be67.jpg","comment_is_top":false,"comment_ctime":1561480384,"is_pvip":false,"replies":[{"id":"38821","content":"会话过期？是老版本consumer吗？有什么具体的日志打出来吗","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561514059,"ip_address":"","comment_id":107209,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561480384","product_id":100029201,"comment_content":"老师你好，之前曾碰到过消费者处理时间过长，可能导致会话过期，然后消费者就再也拿不到数据了，无法消费，不晓得是什么原因","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455419,"discussion_content":"会话过期？是老版本consumer吗？有什么具体的日志打出来吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561514059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107094,"user_name":"jacke","can_delete":false,"product_type":"c1","uid":1161209,"ip_address":"","ucode":"05F355E1FF88C5","user_header":"https://static001.geekbang.org/account/avatar/00/11/b7/f9/a8f26b10.jpg","comment_is_top":false,"comment_ctime":1561457940,"is_pvip":false,"replies":[{"id":"38827","content":"1. 是有独立的配置文件。这里的chroot设置是指在ZooKeeper中使用独立的znode父节点。<br>2. 由replica.lag.time.max.ms控制。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561514676,"ip_address":"","comment_id":107094,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561457940","product_id":100029201,"comment_content":"胡老师，2个问题：<br> 1.zookeeper.connect的chroot这个点没有看懂，两套kafka集群不应该是每套都单独有自己的配置文件吗？kafka1和kafka2这2个别名在哪里设置的呢<br> 2.unclean.leader.election.enable 设置为false表示落后太多进度的副本无法没有资格做完leader，落后的进度多少算多呢？这个也是可以配置的吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455362,"discussion_content":"1. 是有独立的配置文件。这里的chroot设置是指在ZooKeeper中使用独立的znode父节点。\n2. 由replica.lag.time.max.ms控制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561514676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106758,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1561384172,"is_pvip":false,"replies":[{"id":"38663","content":"不论是公有云还是私有云，云上面有很多个用户，他们以租赁的方式来订购云上的系统资源（CPU、RAM、DISK、Bandwidth）。一般管这些用户成为租户。如果构建和运维支持多租户的Kafka集群是我们需要研究的课题。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561423053,"ip_address":"","comment_id":106758,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561384172","product_id":100029201,"comment_content":"老师，我其实是想问下 租户 是什么意思，口语化来讲的话","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455209,"discussion_content":"不论是公有云还是私有云，云上面有很多个用户，他们以租赁的方式来订购云上的系统资源（CPU、RAM、DISK、Bandwidth）。一般管这些用户成为租户。如果构建和运维支持多租户的Kafka集群是我们需要研究的课题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561423053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106166,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1561192694,"is_pvip":false,"replies":[{"id":"38503","content":"抱歉，没太懂“租户 语义化”。搜了一下全文，貌似没有这个词。。。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561339250,"ip_address":"","comment_id":106166,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561192694","product_id":100029201,"comment_content":"请问老师，租户 语义化来讲的话是表示什么意思呢<br>","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454984,"discussion_content":"抱歉，没太懂“租户 语义化”。搜了一下全文，貌似没有这个词。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561339250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105955,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1561113537,"is_pvip":false,"replies":[{"id":"38471","content":"嗯嗯，每个人对于实践的理解不一样。尽量还是找一个真实的项目去着手学习，否则很难深入进去：）<br>","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561337239,"ip_address":"","comment_id":105955,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561113537","product_id":100029201,"comment_content":"打卡，来来回回，反反复复 ，8篇文章看来好几次！ 总结＋复习  ！ 希望有效果！ 感觉缺少实践！ 老师咱后续有带点实践吗？自己玩还是没有头绪！ 所以期待后续的课","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454884,"discussion_content":"嗯嗯，每个人对于实践的理解不一样。尽量还是找一个真实的项目去着手学习，否则很难深入进去：）\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561337239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105725,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1561078880,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561078880","product_id":100029201,"comment_content":"谢谢","like_count":0},{"had_liked":false,"id":105339,"user_name":"涛","can_delete":false,"product_type":"c1","uid":1301309,"ip_address":"","ucode":"33C11D0BF15AA3","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlaNica7xRH6P99s8eFsHr0nW56giaw8cOAGUN4ic1GSQ75qNzJFpXEWibrz8oENHDOiagqx58aRFH1VA/132","comment_is_top":false,"comment_ctime":1560988605,"is_pvip":false,"replies":[{"id":"38180","content":"应该不会。可以试验一下~~","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1561018114,"ip_address":"","comment_id":105339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560988605","product_id":100029201,"comment_content":"老师您好，通过ssl方式加密传输，如果ssl得证书过期了，会影响数据传输么？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454639,"discussion_content":"应该不会。可以试验一下~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561018114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105086,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1560913554,"is_pvip":false,"replies":[{"id":"38098","content":"嗯嗯，最好把Kafka的quick start跑通了并熟悉里面的流程：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560939904,"ip_address":"","comment_id":105086,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560913554","product_id":100029201,"comment_content":"继续打卡，继续努力，不懂不装懂，不要脸的问老师。老师我觉得这个参数这里我个人感觉稍微有点跳跃，怎么说呢，也许是我不懂，不熟悉，我觉得参数本身的作用我总是觉得看到的少，不够了解，然后就是他的场景介绍。所以感到跳跃，是我的初学的原因吗，我看了好几次，也许我学完后面的，回头看，就不是这么一回事了。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454556,"discussion_content":"嗯嗯，最好把Kafka的quick start跑通了并熟悉里面的流程：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560939904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104860,"user_name":"燃烧的M豆","can_delete":false,"product_type":"c1","uid":1355000,"ip_address":"","ucode":"BEDA9FC8852F5D","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/f8/a56b7475.jpg","comment_is_top":false,"comment_ctime":1560858298,"is_pvip":false,"replies":[{"id":"38026","content":"这是两个参数。message.max.bytes是控制消息的最大尺寸，log.segment.bytes是控制日志段文件的最大尺寸。你可以认为一个日志段文件里面包含了成千上万条的消息。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560904817,"ip_address":"","comment_id":104860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560858298","product_id":100029201,"comment_content":"老师你好我用的 1.0.1 不知道 message.max.byte 是否在在1.0.1 种叫 log.segment.bytes？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454458,"discussion_content":"这是两个参数。message.max.bytes是控制消息的最大尺寸，log.segment.bytes是控制日志段文件的最大尺寸。你可以认为一个日志段文件里面包含了成千上万条的消息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560904817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104814,"user_name":"wakeeee","can_delete":false,"product_type":"c1","uid":1194177,"ip_address":"","ucode":"F1A1D051AC6509","user_header":"https://static001.geekbang.org/account/avatar/00/12/38/c1/237a2113.jpg","comment_is_top":false,"comment_ctime":1560846164,"is_pvip":false,"replies":[{"id":"38024","content":"我这边可以下载啊，看看是不是被墙了吧。。。不行就画个镜像<br><br>我用的是这个地址：<br>https:&#47;&#47;archive.apache.org&#47;dist&#47;kafka&#47;0.11.0.3&#47;kafka_2.11-0.11.0.3.tgz","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560904640,"ip_address":"","comment_id":104814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560846164","product_id":100029201,"comment_content":"老师好，我发现在官网上，旧的kafka版本无法下载(例如0.11.0.3)，这是什么原因呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454434,"discussion_content":"我这边可以下载啊，看看是不是被墙了吧。。。不行就画个镜像\n\n我用的是这个地址：\nhttps://archive.apache.org/dist/kafka/0.11.0.3/kafka_2.11-0.11.0.3.tgz","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560904640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104767,"user_name":"祁恒","can_delete":false,"product_type":"c1","uid":1490089,"ip_address":"","ucode":"DACE6E862AB752","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/a9/129b33ab.jpg","comment_is_top":false,"comment_ctime":1560830644,"is_pvip":true,"replies":[{"id":"38023","content":"Kafka Streams是Kafka社区提供的流处理库，用于实现实时流式计算。Confluent Platform是Kafka原开发团队单独成立公司后研发的基于Apache Kafka的商业化产品","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560904547,"ip_address":"","comment_id":104767,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560830644","product_id":100029201,"comment_content":"老师，请问一下，confluent platform和kafka streams 之间有什么关系呢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454416,"discussion_content":"Kafka Streams是Kafka社区提供的流处理库，用于实现实时流式计算。Confluent Platform是Kafka原开发团队单独成立公司后研发的基于Apache Kafka的商业化产品","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560904547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104735,"user_name":"Geek_jacky","can_delete":false,"product_type":"c1","uid":1564542,"ip_address":"","ucode":"F6ABD94A03BE7B","user_header":"","comment_is_top":false,"comment_ctime":1560824126,"is_pvip":false,"replies":[{"id":"37909","content":"嗯嗯，我比较同意：）","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560837836,"ip_address":"","comment_id":104735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560824126","product_id":100029201,"comment_content":"老师好，对于参数advertised.listeners，我理解的是在一个内网集群里面，最外面有一层防火墙，一家公司对应一个ip地址，那么将这个参数配置到公司这个ip同时开发一个新的端口，那么就可以通过外网ip+端口就可以访问内网的这个kafka集群对吧？不知道有没有理解错误。","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454396,"discussion_content":"嗯嗯，我比较同意：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560837836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104707,"user_name":"Nero","can_delete":false,"product_type":"c1","uid":1175079,"ip_address":"","ucode":"BEAE3A8AADDD67","user_header":"https://static001.geekbang.org/account/avatar/00/11/ee/27/5b15fa63.jpg","comment_is_top":false,"comment_ctime":1560820360,"is_pvip":false,"replies":[{"id":"37872","content":"嗯，对。&lt;host, port&gt;对","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560822682,"ip_address":"","comment_id":104707,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560820360","product_id":100029201,"comment_content":"listeners属性是指定该broker的ip和端口的对吧？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454383,"discussion_content":"嗯，对。&amp;lt;host, port&amp;gt;对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560822682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104696,"user_name":"啊哑呦","can_delete":false,"product_type":"c1","uid":1127230,"ip_address":"","ucode":"66C45551AF2A8B","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/3e/5e697a8f.jpg","comment_is_top":false,"comment_ctime":1560819212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560819212","product_id":100029201,"comment_content":"&quot;默认的 1000012 太少了，还不到 1KB&quot;, 这里是不是有点问题, 应该是1MB吧?","like_count":0},{"had_liked":false,"id":104678,"user_name":"蔡胖子","can_delete":false,"product_type":"c1","uid":1400952,"ip_address":"","ucode":"EDABCA3CEEC26B","user_header":"https://static001.geekbang.org/account/avatar/00/15/60/78/d0ffe3aa.jpg","comment_is_top":false,"comment_ctime":1560817322,"is_pvip":false,"replies":[{"id":"37868","content":"advertised.listener主要是给通过外网访问的clients使用的。如果你的clients都是通过内网访问Kafka，只设置listeners就可以了。<br><br>它们可以同时设置，常见的做法是设置advertised.listener为公网IP，listeners为内网IP，区分开来","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1560822575,"ip_address":"","comment_id":104678,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560817322","product_id":100029201,"comment_content":"老师，您好。关于advertised.listener和listener这两个参数，具体有什么区别，能否再详细说明下，两者能否同时设置？谢谢！","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454372,"discussion_content":"advertised.listener主要是给通过外网访问的clients使用的。如果你的clients都是通过内网访问Kafka，只设置listeners就可以了。\n\n它们可以同时设置，常见的做法是设置advertised.listener为公网IP，listeners为内网IP，区分开来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560822575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104631,"user_name":"烟波","can_delete":false,"product_type":"c1","uid":1066395,"ip_address":"","ucode":"EDA582524E7A34","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/9b/6f814c6d.jpg","comment_is_top":false,"comment_ctime":1560792219,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560792219","product_id":100029201,"comment_content":"生产者的ack配置","like_count":0,"discussions":[{"author":{"id":1020871,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/93/c7/1640226d.jpg","nickname":"刘欣洲","note":"","ucode":"767B7D80D01623","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135,"discussion_content":"在 log.dirs 配置行下面， 还有一条\nnum.partitions=1\n\n如果我在log.dirs  配置了2个文件夹（磁盘）， 这一行（num.partitions）是不是该设置为2啊？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561146209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}