{"id":40466,"title":"15 | æ·±å…¥è§£æPodå¯¹è±¡ï¼ˆäºŒï¼‰ï¼šä½¿ç”¨è¿›é˜¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šæ·±å…¥è§£æPodå¯¹è±¡ä¹‹ä½¿ç”¨è¿›é˜¶ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æ·±å…¥è§£æäº†Podçš„APIå¯¹è±¡ï¼Œè®²è§£äº†Podå’ŒContainerçš„å…³ç³»ã€‚</p><p>ä½œä¸ºKubernetesé¡¹ç›®é‡Œæœ€æ ¸å¿ƒçš„ç¼–æ’å¯¹è±¡ï¼ŒPodæºå¸¦çš„ä¿¡æ¯éå¸¸ä¸°å¯Œã€‚å…¶ä¸­ï¼Œèµ„æºå®šä¹‰ï¼ˆæ¯”å¦‚CPUã€å†…å­˜ç­‰ï¼‰ï¼Œä»¥åŠè°ƒåº¦ç›¸å…³çš„å­—æ®µï¼Œæˆ‘ä¼šåœ¨åé¢ä¸“é—¨è®²è§£è°ƒåº¦å™¨æ—¶å†è¿›è¡Œæ·±å…¥çš„åˆ†æã€‚åœ¨æœ¬ç¯‡ï¼Œæˆ‘ä»¬å°±å…ˆä»ä¸€ç§ç‰¹æ®Šçš„Volumeå¼€å§‹ï¼Œæ¥å¸®åŠ©ä½ æ›´åŠ æ·±å…¥åœ°ç†è§£Podå¯¹è±¡å„ä¸ªé‡è¦å­—æ®µçš„å«ä¹‰ã€‚</p><p>è¿™ç§ç‰¹æ®Šçš„Volumeï¼Œå«ä½œProjected Volumeï¼Œä½ å¯ä»¥æŠŠå®ƒç¿»è¯‘ä¸ºâ€œæŠ•å°„æ•°æ®å·â€ã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šProjected Volumeæ˜¯Kubernetes v1.11ä¹‹åçš„æ–°ç‰¹æ€§</p>\n</blockquote><p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>åœ¨Kubernetesä¸­ï¼Œæœ‰å‡ ç§ç‰¹æ®Šçš„Volumeï¼Œå®ƒä»¬å­˜åœ¨çš„æ„ä¹‰ä¸æ˜¯ä¸ºäº†å­˜æ”¾å®¹å™¨é‡Œçš„æ•°æ®ï¼Œä¹Ÿä¸æ˜¯ç”¨æ¥è¿›è¡Œå®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚è¿™äº›ç‰¹æ®ŠVolumeçš„ä½œç”¨ï¼Œæ˜¯ä¸ºå®¹å™¨æä¾›é¢„å…ˆå®šä¹‰å¥½çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œä»å®¹å™¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›Volumeé‡Œçš„ä¿¡æ¯å°±æ˜¯ä»¿ä½›æ˜¯<strong>è¢«Kubernetesâ€œæŠ•å°„â€ï¼ˆProjectï¼‰è¿›å…¥å®¹å™¨å½“ä¸­çš„</strong>ã€‚è¿™æ­£æ˜¯Projected Volumeçš„å«ä¹‰ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒKubernetesæ”¯æŒçš„Projected Volumeä¸€å…±æœ‰å››ç§ï¼š</p><!-- [[[read_end]]] --><ol>\n<li>\n<p>Secretï¼›</p>\n</li>\n<li>\n<p>ConfigMapï¼›</p>\n</li>\n<li>\n<p>Downward APIï¼›</p>\n</li>\n<li>\n<p>ServiceAccountTokenã€‚</p>\n</li>\n</ol><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œ<span class=\"orange\">æˆ‘é¦–å…ˆå’Œä½ åˆ†äº«çš„æ˜¯Secret</span>ã€‚å®ƒçš„ä½œç”¨ï¼Œæ˜¯å¸®ä½ æŠŠPodæƒ³è¦è®¿é—®çš„åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°Etcdä¸­ã€‚ç„¶åï¼Œä½ å°±å¯ä»¥é€šè¿‡åœ¨Podçš„å®¹å™¨é‡ŒæŒ‚è½½Volumeçš„æ–¹å¼ï¼Œè®¿é—®åˆ°è¿™äº›Secreté‡Œä¿å­˜çš„ä¿¡æ¯äº†ã€‚</p><p>Secretæœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼Œè«è¿‡äºå­˜æ”¾æ•°æ®åº“çš„Credentialä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-projected-volume \nspec:\n  containers:\n  - name: test-secret-volume\n    image: busybox\n    args:\n    - sleep\n    - &quot;86400&quot;\n    volumeMounts:\n    - name: mysql-cred\n      mountPath: &quot;/projected-volume&quot;\n      readOnly: true\n  volumes:\n  - name: mysql-cred\n    projected:\n      sources:\n      - secret:\n          name: user\n      - secret:\n          name: pass\n</code></pre><p>åœ¨è¿™ä¸ªPodä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å®¹å™¨ã€‚å®ƒå£°æ˜æŒ‚è½½çš„Volumeï¼Œå¹¶ä¸æ˜¯å¸¸è§çš„emptyDiræˆ–è€…hostPathç±»å‹ï¼Œè€Œæ˜¯projectedç±»å‹ã€‚è€Œè¿™ä¸ª Volumeçš„æ•°æ®æ¥æºï¼ˆsourcesï¼‰ï¼Œåˆ™æ˜¯åä¸ºuserå’Œpassçš„Secretå¯¹è±¡ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>è¿™é‡Œç”¨åˆ°çš„æ•°æ®åº“çš„ç”¨æˆ·åã€å¯†ç ï¼Œæ­£æ˜¯ä»¥Secretå¯¹è±¡çš„æ–¹å¼äº¤ç»™Kubernetesä¿å­˜çš„ã€‚å®Œæˆè¿™ä¸ªæ“ä½œçš„æŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ cat ./username.txt\nadmin\n$ cat ./password.txt\nc1oudc0w!\n\n$ kubectl create secret generic user --from-file=./username.txt\n$ kubectl create secret generic pass --from-file=./password.txt\n</code></pre><p>å…¶ä¸­ï¼Œusername.txtå’Œpassword.txtæ–‡ä»¶é‡Œï¼Œå­˜æ”¾çš„å°±æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼›è€Œuserå’Œpassï¼Œåˆ™æ˜¯æˆ‘ä¸ºSecretå¯¹è±¡æŒ‡å®šçš„åå­—ã€‚è€Œæˆ‘æƒ³è¦æŸ¥çœ‹è¿™äº›Secretå¯¹è±¡çš„è¯ï¼Œåªè¦æ‰§è¡Œä¸€æ¡kubectl getå‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><pre><code>$ kubectl get secrets\nNAME           TYPE                                DATA      AGE\nuser          Opaque                                1         51s\npass          Opaque                                1         51s\n</code></pre><p>å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨kubectl create secretæŒ‡ä»¤å¤–ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ç¼–å†™YAMLæ–‡ä»¶çš„æ–¹å¼æ¥åˆ›å»ºè¿™ä¸ªSecretå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š</p><pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  user: YWRtaW4=\n  pass: MWYyZDFlMmU2N2Rm\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ç¼–å†™YAMLæ–‡ä»¶åˆ›å»ºå‡ºæ¥çš„Secretå¯¹è±¡åªæœ‰ä¸€ä¸ªã€‚ä½†å®ƒçš„dataå­—æ®µï¼Œå´ä»¥Key-Valueçš„æ ¼å¼ä¿å­˜äº†ä¸¤ä»½Secretæ•°æ®ã€‚å…¶ä¸­ï¼Œâ€œuserâ€å°±æ˜¯ç¬¬ä¸€ä»½æ•°æ®çš„Keyï¼Œâ€œpassâ€æ˜¯ç¬¬äºŒä»½æ•°æ®çš„Keyã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSecretå¯¹è±¡è¦æ±‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯ç»è¿‡Base64è½¬ç çš„ï¼Œä»¥å…å‡ºç°æ˜æ–‡å¯†ç çš„å®‰å…¨éšæ‚£ã€‚è¿™ä¸ªè½¬ç æ“ä½œä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚ï¼š</p><pre><code>$ echo -n 'admin' | base64\nYWRtaW4=\n$ echo -n '1f2d1e2e67df' | base64\nMWYyZDFlMmU2N2Rm\n</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåƒè¿™æ ·åˆ›å»ºçš„Secretå¯¹è±¡ï¼Œå®ƒé‡Œé¢çš„å†…å®¹ä»…ä»…æ˜¯ç»è¿‡äº†è½¬ç ï¼Œè€Œå¹¶æ²¡æœ‰è¢«åŠ å¯†ã€‚åœ¨çœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ éœ€è¦åœ¨Kubernetesä¸­å¼€å¯Secretçš„åŠ å¯†æ’ä»¶ï¼Œå¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚å…³äºå¼€å¯SecretåŠ å¯†æ’ä»¶çš„å†…å®¹ï¼Œæˆ‘ä¼šåœ¨åç»­ä¸“é—¨è®²è§£Secretçš„æ—¶å€™ï¼Œå†åšè¿›ä¸€æ­¥è¯´æ˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹åˆ›å»ºè¿™ä¸ªPodï¼š</p><pre><code>$ kubectl create -f test-projected-volume.yaml\n</code></pre><p>å½“Podå˜æˆRunningçŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬å†éªŒè¯ä¸€ä¸‹è¿™äº›Secretå¯¹è±¡æ˜¯ä¸æ˜¯å·²ç»åœ¨å®¹å™¨é‡Œäº†ï¼š</p><pre><code>$ kubectl exec -it test-projected-volume -- /bin/sh\n$ ls /projected-volume/\nuser\npass\n$ cat /projected-volume/user\nroot\n$ cat /projected-volume/pass\n1f2d1e2e67df\n</code></pre><p>ä»è¿”å›ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¿å­˜åœ¨Etcdé‡Œçš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯ï¼Œå·²ç»ä»¥æ–‡ä»¶çš„å½¢å¼å‡ºç°åœ¨äº†å®¹å™¨çš„Volumeç›®å½•é‡Œã€‚è€Œè¿™ä¸ªæ–‡ä»¶çš„åå­—ï¼Œå°±æ˜¯kubectl create secretæŒ‡å®šçš„Keyï¼Œæˆ–è€…è¯´æ˜¯Secretå¯¹è±¡çš„dataå­—æ®µæŒ‡å®šçš„Keyã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œåƒè¿™æ ·é€šè¿‡æŒ‚è½½æ–¹å¼è¿›å…¥åˆ°å®¹å™¨é‡Œçš„Secretï¼Œä¸€æ—¦å…¶å¯¹åº”çš„Etcdé‡Œçš„æ•°æ®è¢«æ›´æ–°ï¼Œè¿™äº›Volumeé‡Œçš„æ–‡ä»¶å†…å®¹ï¼ŒåŒæ ·ä¹Ÿä¼šè¢«æ›´æ–°ã€‚å…¶å®ï¼Œ<strong>è¿™æ˜¯kubeletç»„ä»¶åœ¨å®šæ—¶ç»´æŠ¤è¿™äº›Volumeã€‚</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ›´æ–°å¯èƒ½ä¼šæœ‰ä¸€å®šçš„å»¶æ—¶ã€‚æ‰€ä»¥<strong>åœ¨ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œåœ¨å‘èµ·æ•°æ®åº“è¿æ¥çš„ä»£ç å¤„å†™å¥½é‡è¯•å’Œè¶…æ—¶çš„é€»è¾‘ï¼Œç»å¯¹æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚</strong></p><p><strong>ä¸Secretç±»ä¼¼çš„æ˜¯ConfigMap</strong>ï¼Œå®ƒä¸Secretçš„åŒºåˆ«åœ¨äºï¼ŒConfigMapä¿å­˜çš„æ˜¯ä¸éœ€è¦åŠ å¯†çš„ã€åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ã€‚è€ŒConfigMapçš„ç”¨æ³•å‡ ä¹ä¸Secretå®Œå…¨ç›¸åŒï¼šä½ å¯ä»¥ä½¿ç”¨kubectl create configmapä»æ–‡ä»¶æˆ–è€…ç›®å½•åˆ›å»ºConfigMapï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼–å†™ConfigMapå¯¹è±¡çš„YAMLæ–‡ä»¶ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªJavaåº”ç”¨æ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼ˆ.propertiesæ–‡ä»¶ï¼‰ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ ·çš„æ–¹å¼ä¿å­˜åœ¨ConfigMapé‡Œï¼š</p><pre><code># .propertiesæ–‡ä»¶çš„å†…å®¹\n$ cat example/ui.properties\ncolor.good=purple\ncolor.bad=yellow\nallow.textmode=true\nhow.nice.to.look=fairlyNice\n\n# ä».propertiesæ–‡ä»¶åˆ›å»ºConfigMap\n$ kubectl create configmap ui-config --from-file=example/ui.properties\n\n# æŸ¥çœ‹è¿™ä¸ªConfigMapé‡Œä¿å­˜çš„ä¿¡æ¯(data)\n$ kubectl get configmaps ui-config -o yaml\napiVersion: v1\ndata:\n  ui.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true\n    how.nice.to.look=fairlyNice\nkind: ConfigMap\nmetadata:\n  name: ui-config\n  ...\n</code></pre><blockquote>\n<p>å¤‡æ³¨ï¼škubectl get -o yamlè¿™æ ·çš„å‚æ•°ï¼Œä¼šå°†æŒ‡å®šçš„Pod APIå¯¹è±¡ä»¥YAMLçš„æ–¹å¼å±•ç¤ºå‡ºæ¥ã€‚</p>\n</blockquote><p><strong>æ¥ä¸‹æ¥æ˜¯Downward API</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šè®©Podé‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ªPod APIå¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-downwardapi-volume\n  labels:\n    zone: us-est-coast\n    cluster: test-cluster1\n    rack: rack-22\nspec:\n  containers:\n    - name: client-container\n      image: k8s.gcr.io/busybox\n      command: [&quot;sh&quot;, &quot;-c&quot;]\n      args:\n      - while true; do\n          if [[ -e /etc/podinfo/labels ]]; then\n            echo -en '\\n\\n'; cat /etc/podinfo/labels; fi;\n          sleep 5;\n        done;\n      volumeMounts:\n        - name: podinfo\n          mountPath: /etc/podinfo\n          readOnly: false\n  volumes:\n    - name: podinfo\n      projected:\n        sources:\n        - downwardAPI:\n            items:\n              - path: &quot;labels&quot;\n                fieldRef:\n                  fieldPath: metadata.labels\n</code></pre><p>åœ¨è¿™ä¸ªPodçš„YAMLæ–‡ä»¶ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå£°æ˜äº†ä¸€ä¸ªprojectedç±»å‹çš„Volumeã€‚åªä¸è¿‡è¿™æ¬¡Volumeçš„æ•°æ®æ¥æºï¼Œå˜æˆäº†Downward APIã€‚è€Œè¿™ä¸ªDownward API Volumeï¼Œåˆ™å£°æ˜äº†è¦æš´éœ²Podçš„metadata.labelsä¿¡æ¯ç»™å®¹å™¨ã€‚</p><p>é€šè¿‡è¿™æ ·çš„å£°æ˜æ–¹å¼ï¼Œå½“å‰Podçš„Labelså­—æ®µçš„å€¼ï¼Œå°±ä¼šè¢«Kubernetesè‡ªåŠ¨æŒ‚è½½æˆä¸ºå®¹å™¨é‡Œçš„/etc/podinfo/labelsæ–‡ä»¶ã€‚</p><p>è€Œè¿™ä¸ªå®¹å™¨çš„å¯åŠ¨å‘½ä»¤ï¼Œåˆ™æ˜¯ä¸æ–­æ‰“å°å‡º/etc/podinfo/labelsé‡Œçš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘åˆ›å»ºäº†è¿™ä¸ªPodä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡kubectl logsæŒ‡ä»¤ï¼ŒæŸ¥çœ‹åˆ°è¿™äº›Labelså­—æ®µè¢«æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ kubectl create -f dapi-volume.yaml\n$ kubectl logs test-downwardapi-volume\ncluster=&quot;test-cluster1&quot;\nrack=&quot;rack-22&quot;\nzone=&quot;us-est-coast&quot;\n</code></pre><p>ç›®å‰ï¼ŒDownward APIæ”¯æŒçš„å­—æ®µå·²ç»éå¸¸ä¸°å¯Œäº†ï¼Œæ¯”å¦‚ï¼š</p><pre><code>1. ä½¿ç”¨fieldRefå¯ä»¥å£°æ˜ä½¿ç”¨:\nspec.nodeName - å®¿ä¸»æœºåå­—\nstatus.hostIP - å®¿ä¸»æœºIP\nmetadata.name - Podçš„åå­—\nmetadata.namespace - Podçš„Namespace\nstatus.podIP - Podçš„IP\nspec.serviceAccountName - Podçš„Service Accountçš„åå­—\nmetadata.uid - Podçš„UID\nmetadata.labels['&lt;KEY&gt;'] - æŒ‡å®š&lt;KEY&gt;çš„Labelå€¼\nmetadata.annotations['&lt;KEY&gt;'] - æŒ‡å®š&lt;KEY&gt;çš„Annotationå€¼\nmetadata.labels - Podçš„æ‰€æœ‰Label\nmetadata.annotations - Podçš„æ‰€æœ‰Annotation\n\n2. ä½¿ç”¨resourceFieldRefå¯ä»¥å£°æ˜ä½¿ç”¨:\nå®¹å™¨çš„CPU limit\nå®¹å™¨çš„CPU request\nå®¹å™¨çš„memory limit\nå®¹å™¨çš„memory request\n</code></pre><p>ä¸Šé¢è¿™ä¸ªåˆ—è¡¨çš„å†…å®¹ï¼Œéšç€Kubernetesé¡¹ç›®çš„å‘å±•è‚¯å®šè¿˜ä¼šä¸æ–­å¢åŠ ã€‚æ‰€ä»¥è¿™é‡Œåˆ—å‡ºæ¥çš„ä¿¡æ¯ä»…ä¾›å‚è€ƒï¼Œä½ åœ¨ä½¿ç”¨Downward APIæ—¶ï¼Œè¿˜æ˜¯è¦è®°å¾—å»æŸ¥é˜…ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ã€‚</p><p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDownward APIèƒ½å¤Ÿè·å–åˆ°çš„ä¿¡æ¯ï¼Œ<strong>ä¸€å®šæ˜¯Podé‡Œçš„å®¹å™¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰å°±èƒ½å¤Ÿç¡®å®šä¸‹æ¥çš„ä¿¡æ¯</strong>ã€‚è€Œå¦‚æœä½ æƒ³è¦è·å–Podå®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œå®¹å™¨è¿›ç¨‹çš„PIDï¼Œé‚£å°±è‚¯å®šä¸èƒ½ä½¿ç”¨Downward APIäº†ï¼Œè€Œåº”è¯¥è€ƒè™‘åœ¨Podé‡Œå®šä¹‰ä¸€ä¸ªsidecarå®¹å™¨ã€‚</p><p>å…¶å®ï¼ŒSecretã€ConfigMapï¼Œä»¥åŠDownward APIè¿™ä¸‰ç§Projected Volumeå®šä¹‰çš„ä¿¡æ¯ï¼Œå¤§å¤šè¿˜å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼å‡ºç°åœ¨å®¹å™¨é‡Œã€‚ä½†æ˜¯ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡è·å–è¿™äº›ä¿¡æ¯çš„æ–¹å¼ï¼Œä¸å…·å¤‡è‡ªåŠ¨æ›´æ–°çš„èƒ½åŠ›ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘éƒ½å»ºè®®ä½ ä½¿ç”¨Volumeæ–‡ä»¶çš„æ–¹å¼è·å–è¿™äº›ä¿¡æ¯ã€‚</p><p>åœ¨æ˜ç™½äº†Secretä¹‹åï¼Œ<span class=\"orange\">æˆ‘å†ä¸ºä½ è®²è§£Podä¸­ä¸€ä¸ªä¸å®ƒå¯†åˆ‡ç›¸å…³çš„æ¦‚å¿µï¼šService Account</span>ã€‚</p><p>ç›¸ä¿¡ä½ ä¸€å®šæœ‰è¿‡è¿™æ ·çš„æƒ³æ³•ï¼šæˆ‘ç°åœ¨æœ‰äº†ä¸€ä¸ªPodï¼Œæˆ‘èƒ½ä¸èƒ½åœ¨è¿™ä¸ªPodé‡Œå®‰è£…ä¸€ä¸ªKubernetesçš„Clientï¼Œè¿™æ ·å°±å¯ä»¥ä»å®¹å™¨é‡Œç›´æ¥è®¿é—®å¹¶ä¸”æ“ä½œè¿™ä¸ªKubernetesçš„APIäº†å‘¢ï¼Ÿ</p><p>è¿™å½“ç„¶æ˜¯å¯ä»¥çš„ã€‚</p><p>ä¸è¿‡ï¼Œä½ é¦–å…ˆè¦è§£å†³API Serverçš„æˆæƒé—®é¢˜ã€‚</p><p>Service Accountå¯¹è±¡çš„ä½œç”¨ï¼Œå°±æ˜¯Kubernetesç³»ç»Ÿå†…ç½®çš„ä¸€ç§â€œæœåŠ¡è´¦æˆ·â€ï¼Œå®ƒæ˜¯Kubernetesè¿›è¡Œæƒé™åˆ†é…çš„å¯¹è±¡ã€‚æ¯”å¦‚ï¼ŒService Account Aï¼Œå¯ä»¥åªè¢«å…è®¸å¯¹Kubernetes APIè¿›è¡ŒGETæ“ä½œï¼Œè€ŒService Account Bï¼Œåˆ™å¯ä»¥æœ‰Kubernetes APIçš„æ‰€æœ‰æ“ä½œæƒé™ã€‚</p><p>åƒè¿™æ ·çš„Service Accountçš„æˆæƒä¿¡æ¯å’Œæ–‡ä»¶ï¼Œå®é™…ä¸Šä¿å­˜åœ¨å®ƒæ‰€ç»‘å®šçš„ä¸€ä¸ªç‰¹æ®Šçš„Secretå¯¹è±¡é‡Œçš„ã€‚è¿™ä¸ªç‰¹æ®Šçš„Secretå¯¹è±¡ï¼Œå°±å«ä½œ<strong>ServiceAccountToken</strong>ã€‚ä»»ä½•è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¸Šçš„åº”ç”¨ï¼Œéƒ½å¿…é¡»ä½¿ç”¨è¿™ä¸ªServiceAccountTokené‡Œä¿å­˜çš„æˆæƒä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯Tokenï¼Œæ‰å¯ä»¥åˆæ³•åœ°è®¿é—®API Serverã€‚</p><p>æ‰€ä»¥è¯´ï¼ŒKubernetesé¡¹ç›®çš„Projected Volumeå…¶å®åªæœ‰ä¸‰ç§ï¼Œå› ä¸ºç¬¬å››ç§ServiceAccountTokenï¼Œåªæ˜¯ä¸€ç§ç‰¹æ®Šçš„Secretè€Œå·²ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒKuberneteså·²ç»ä¸ºä½ æä¾›äº†ä¸€ä¸ªé»˜è®¤â€œæœåŠ¡è´¦æˆ·â€ï¼ˆdefault Service Accountï¼‰ã€‚å¹¶ä¸”ï¼Œä»»ä½•ä¸€ä¸ªè¿è¡Œåœ¨Kubernetesé‡Œçš„Podï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé»˜è®¤çš„Service Accountï¼Œè€Œæ— éœ€æ˜¾ç¤ºåœ°å£°æ˜æŒ‚è½½å®ƒã€‚</p><p><strong>è¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</strong></p><p>å½“ç„¶è¿˜æ˜¯é Projected Volumeæœºåˆ¶ã€‚</p><p>å¦‚æœä½ æŸ¥çœ‹ä¸€ä¸‹ä»»æ„ä¸€ä¸ªè¿è¡Œåœ¨Kubernetesé›†ç¾¤é‡Œçš„Podï¼Œå°±ä¼šå‘ç°ï¼Œæ¯ä¸€ä¸ªPodï¼Œéƒ½å·²ç»è‡ªåŠ¨å£°æ˜ä¸€ä¸ªç±»å‹æ˜¯Secretã€åä¸ºdefault-token-xxxxçš„Volumeï¼Œç„¶å è‡ªåŠ¨æŒ‚è½½åœ¨æ¯ä¸ªå®¹å™¨çš„ä¸€ä¸ªå›ºå®šç›®å½•ä¸Šã€‚æ¯”å¦‚ï¼š</p><pre><code>$ kubectl describe pod nginx-deployment-5c678cfb6d-lg9lw\nContainers:\n...\n  Mounts:\n    /var/run/secrets/kubernetes.io/serviceaccount from default-token-s8rbq (ro)\nVolumes:\n  default-token-s8rbq:\n  Type:       Secret (a volume populated by a Secret)\n  SecretName:  default-token-s8rbq\n  Optional:    false\n</code></pre><p>è¿™ä¸ªSecretç±»å‹çš„Volumeï¼Œæ­£æ˜¯é»˜è®¤Service Accountå¯¹åº”çš„ServiceAccountTokenã€‚æ‰€ä»¥è¯´ï¼ŒKuberneteså…¶å®åœ¨æ¯ä¸ªPodåˆ›å»ºçš„æ—¶å€™ï¼Œè‡ªåŠ¨åœ¨å®ƒçš„spec.volumeséƒ¨åˆ†æ·»åŠ ä¸Šäº†é»˜è®¤ServiceAccountTokençš„å®šä¹‰ï¼Œç„¶åè‡ªåŠ¨ç»™æ¯ä¸ªå®¹å™¨åŠ ä¸Šäº†å¯¹åº”çš„volumeMountså­—æ®µã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ã€‚</p><p>è¿™æ ·ï¼Œä¸€æ—¦Podåˆ›å»ºå®Œæˆï¼Œå®¹å™¨é‡Œçš„åº”ç”¨å°±å¯ä»¥ç›´æ¥ä»è¿™ä¸ªé»˜è®¤ServiceAccountTokençš„æŒ‚è½½ç›®å½•é‡Œè®¿é—®åˆ°æˆæƒä¿¡æ¯å’Œæ–‡ä»¶ã€‚è¿™ä¸ªå®¹å™¨å†…çš„è·¯å¾„åœ¨Kubernetesé‡Œæ˜¯å›ºå®šçš„ï¼Œå³ï¼š/var/run/secrets/kubernetes.io/serviceaccount ï¼Œè€Œè¿™ä¸ªSecretç±»å‹çš„Volumeé‡Œé¢çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ ls /var/run/secrets/kubernetes.io/serviceaccount \nca.crt namespace  token\n</code></pre><p>æ‰€ä»¥ï¼Œä½ çš„åº”ç”¨ç¨‹åºåªè¦ç›´æ¥åŠ è½½è¿™äº›æˆæƒæ–‡ä»¶ï¼Œå°±å¯ä»¥è®¿é—®å¹¶æ“ä½œKubernetes APIäº†ã€‚è€Œä¸”ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Kuberneteså®˜æ–¹çš„ClientåŒ…ï¼ˆ<code>k8s.io/client-go</code>ï¼‰çš„è¯ï¼Œå®ƒè¿˜å¯ä»¥è‡ªåŠ¨åŠ è½½è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½ ä¸éœ€è¦åšä»»ä½•é…ç½®æˆ–è€…ç¼–ç æ“ä½œã€‚</p><p><strong>è¿™ç§æŠŠKuberneteså®¢æˆ·ç«¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œåœ¨é›†ç¾¤é‡Œï¼Œç„¶åä½¿ç”¨default Service Accountè‡ªåŠ¨æˆæƒçš„æ–¹å¼ï¼Œè¢«ç§°ä½œâ€œInClusterConfigâ€ï¼Œä¹Ÿæ˜¯æˆ‘æœ€æ¨èçš„è¿›è¡ŒKubernetes APIç¼–ç¨‹çš„æˆæƒæ–¹å¼ã€‚</strong></p><p>å½“ç„¶ï¼Œè€ƒè™‘åˆ°è‡ªåŠ¨æŒ‚è½½é»˜è®¤ServiceAccountTokençš„æ½œåœ¨é£é™©ï¼ŒKuberneteså…è®¸ä½ è®¾ç½®é»˜è®¤ä¸ä¸ºPodé‡Œçš„å®¹å™¨è‡ªåŠ¨æŒ‚è½½è¿™ä¸ªVolumeã€‚</p><p>é™¤äº†è¿™ä¸ªé»˜è®¤çš„Service Accountå¤–ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™è¿˜éœ€è¦åˆ›å»ºä¸€äº›æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„Service Accountï¼Œæ¥å¯¹åº”ä¸åŒçš„æƒé™è®¾ç½®ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„Podé‡Œçš„å®¹å™¨å°±å¯ä»¥é€šè¿‡æŒ‚è½½è¿™äº›Service Accountå¯¹åº”çš„ServiceAccountTokenï¼Œæ¥ä½¿ç”¨è¿™äº›è‡ªå®šä¹‰çš„æˆæƒä¿¡æ¯ã€‚åœ¨åé¢è®²è§£ä¸ºKuberneteså¼€å‘æ’ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä¼šå®è·µåˆ°è¿™ä¸ªæ“ä½œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬<span class=\"orange\">å†æ¥çœ‹Podçš„å¦ä¸€ä¸ªé‡è¦çš„é…ç½®ï¼šå®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶ã€‚</span></p><p>åœ¨Kubernetesä¸­ï¼Œä½ å¯ä»¥ä¸ºPodé‡Œçš„å®¹å™¨å®šä¹‰ä¸€ä¸ªå¥åº·æ£€æŸ¥â€œæ¢é’ˆâ€ï¼ˆProbeï¼‰ã€‚è¿™æ ·ï¼Œkubeletå°±ä¼šæ ¹æ®è¿™ä¸ªProbeçš„è¿”å›å€¼å†³å®šè¿™ä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»¥å®¹å™¨é•œåƒæ˜¯å¦è¿è¡Œï¼ˆæ¥è‡ªDockerè¿”å›çš„ä¿¡æ¯ï¼‰ä½œä¸ºä¾æ®ã€‚è¿™ç§æœºåˆ¶ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ä¿è¯åº”ç”¨å¥åº·å­˜æ´»çš„é‡è¦æ‰‹æ®µã€‚</p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸ªKubernetesæ–‡æ¡£ä¸­çš„ä¾‹å­ã€‚</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    test: liveness\n  name: test-liveness-exec\nspec:\n  containers:\n  - name: liveness\n    image: busybox\n    args:\n    - /bin/sh\n    - -c\n    - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600\n    livenessProbe:\n      exec:\n        command:\n        - cat\n        - /tmp/healthy\n      initialDelaySeconds: 5\n      periodSeconds: 5\n</code></pre><p>åœ¨è¿™ä¸ªPodä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰è¶£çš„å®¹å™¨ã€‚å®ƒåœ¨å¯åŠ¨ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åœ¨/tmpç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªhealthyæ–‡ä»¶ï¼Œä»¥æ­¤ä½œä¸ºè‡ªå·±å·²ç»æ­£å¸¸è¿è¡Œçš„æ ‡å¿—ã€‚è€Œ30 sè¿‡åï¼Œå®ƒä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åˆ é™¤æ‰ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¿™æ ·çš„livenessProbeï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚å®ƒçš„ç±»å‹æ˜¯execï¼Œè¿™æ„å‘³ç€ï¼Œå®ƒä¼šåœ¨å®¹å™¨å¯åŠ¨åï¼Œåœ¨å®¹å™¨é‡Œé¢æ‰§è¡Œä¸€æ¡æˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼šâ€œcat /tmp/healthyâ€ã€‚è¿™æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œè¿™æ¡å‘½ä»¤çš„è¿”å›å€¼å°±æ˜¯0ï¼ŒPodå°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¹å™¨ä¸ä»…å·²ç»å¯åŠ¨ï¼Œè€Œä¸”æ˜¯å¥åº·çš„ã€‚è¿™ä¸ªå¥åº·æ£€æŸ¥ï¼Œåœ¨å®¹å™¨å¯åŠ¨5 såå¼€å§‹æ‰§è¡Œï¼ˆinitialDelaySeconds: 5ï¼‰ï¼Œæ¯5 sæ‰§è¡Œä¸€æ¬¡ï¼ˆperiodSeconds: 5ï¼‰ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥<strong>å…·ä½“å®è·µä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</strong>ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºè¿™ä¸ªPodï¼š</p><pre><code>$ kubectl create -f test-liveness-exec.yaml\n</code></pre><p>ç„¶åï¼ŒæŸ¥çœ‹è¿™ä¸ªPodçš„çŠ¶æ€ï¼š</p><pre><code>$ kubectl get pod\nNAME                READY     STATUS    RESTARTS   AGE\ntest-liveness-exec   1/1       Running   0          10s\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºå·²ç»é€šè¿‡äº†å¥åº·æ£€æŸ¥ï¼Œè¿™ä¸ªPodå°±è¿›å…¥äº†RunningçŠ¶æ€ã€‚</p><p>è€Œ30 sä¹‹åï¼Œæˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹Podçš„Eventsï¼š</p><pre><code>$ kubectl describe pod test-liveness-exec\n</code></pre><p>ä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªPodåœ¨EventsæŠ¥å‘Šäº†ä¸€ä¸ªå¼‚å¸¸ï¼š</p><pre><code>FirstSeen LastSeen    Count   From            SubobjectPath           Type        Reason      Message\n--------- --------    -----   ----            -------------           --------    ------      -------\n2s        2s      1   {kubelet worker0}   spec.containers{liveness}   Warning     Unhealthy   Liveness probe failed: cat: can't open '/tmp/healthy': No such file or directory\n</code></pre><p>æ˜¾ç„¶ï¼Œè¿™ä¸ªå¥åº·æ£€æŸ¥æ¢æŸ¥åˆ°/tmp/healthyå·²ç»ä¸å­˜åœ¨äº†ï¼Œæ‰€ä»¥å®ƒæŠ¥å‘Šå®¹å™¨æ˜¯ä¸å¥åº·çš„ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸å¦¨å†æ¬¡æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªPodçš„çŠ¶æ€ï¼š</p><pre><code>$ kubectl get pod test-liveness-exec\nNAME           READY     STATUS    RESTARTS   AGE\nliveness-exec   1/1       Running   1          1m\n</code></pre><p>è¿™æ—¶æˆ‘ä»¬å‘ç°ï¼ŒPodå¹¶æ²¡æœ‰è¿›å…¥FailedçŠ¶æ€ï¼Œè€Œæ˜¯ä¿æŒäº†RunningçŠ¶æ€ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œå¦‚æœä½ æ³¨æ„åˆ°RESTARTSå­—æ®µä»0åˆ°1çš„å˜åŒ–ï¼Œå°±æ˜ç™½åŸå› äº†ï¼šè¿™ä¸ªå¼‚å¸¸çš„å®¹å™¨å·²ç»è¢«Kubernetesé‡å¯äº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒPodä¿æŒRunningçŠ¶æ€ä¸å˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šKubernetesä¸­å¹¶æ²¡æœ‰Dockerçš„Stopè¯­ä¹‰ã€‚æ‰€ä»¥è™½ç„¶æ˜¯Restartï¼ˆé‡å¯ï¼‰ï¼Œä½†å®é™…å´æ˜¯é‡æ–°åˆ›å»ºäº†å®¹å™¨ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½å°±æ˜¯Kubernetesé‡Œçš„<strong>Podæ¢å¤æœºåˆ¶</strong>ï¼Œä¹Ÿå«restartPolicyã€‚å®ƒæ˜¯Podçš„Specéƒ¨åˆ†çš„ä¸€ä¸ªæ ‡å‡†å­—æ®µï¼ˆpod.spec.restartPolicyï¼‰ï¼Œé»˜è®¤å€¼æ˜¯Alwaysï¼Œå³ï¼šä»»ä½•æ—¶å€™è¿™ä¸ªå®¹å™¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå®ƒä¸€å®šä¼šè¢«é‡æ–°åˆ›å»ºã€‚</p><p>ä½†ä¸€å®šè¦å¼ºè°ƒçš„æ˜¯ï¼ŒPodçš„æ¢å¤è¿‡ç¨‹ï¼Œæ°¸è¿œéƒ½æ˜¯å‘ç”Ÿåœ¨å½“å‰èŠ‚ç‚¹ä¸Šï¼Œè€Œä¸ä¼šè·‘åˆ°åˆ«çš„èŠ‚ç‚¹ä¸Šå»ã€‚äº‹å®ä¸Šï¼Œä¸€æ—¦ä¸€ä¸ªPodä¸ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ç»‘å®šï¼Œé™¤éè¿™ä¸ªç»‘å®šå‘ç”Ÿäº†å˜åŒ–ï¼ˆpod.spec.nodeå­—æ®µè¢«ä¿®æ”¹ï¼‰ï¼Œå¦åˆ™å®ƒæ°¸è¿œéƒ½ä¸ä¼šç¦»å¼€è¿™ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœè¿™ä¸ªå®¿ä¸»æœºå®•æœºäº†ï¼Œè¿™ä¸ªPodä¹Ÿä¸ä¼šä¸»åŠ¨è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»ã€‚</p><p>è€Œå¦‚æœä½ æƒ³è®©Podå‡ºç°åœ¨å…¶ä»–çš„å¯ç”¨èŠ‚ç‚¹ä¸Šï¼Œå°±å¿…é¡»ä½¿ç”¨Deploymentè¿™æ ·çš„â€œæ§åˆ¶å™¨â€æ¥ç®¡ç†Podï¼Œå“ªæ€•ä½ åªéœ€è¦ä¸€ä¸ªPodå‰¯æœ¬ã€‚è¿™å°±æ˜¯æˆ‘åœ¨ç¬¬12ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/40008\">ã€Šç‰›åˆ€å°è¯•ï¼šæˆ‘çš„ç¬¬ä¸€ä¸ªå®¹å™¨åŒ–åº”ç”¨ã€‹</a>æœ€åç»™ä½ ç•™çš„æ€è€ƒé¢˜çš„ç­”æ¡ˆï¼Œå³ä¸€ä¸ªå•Podçš„Deploymentä¸ä¸€ä¸ªPodæœ€ä¸»è¦çš„åŒºåˆ«ã€‚</p><p>è€Œä½œä¸ºç”¨æˆ·ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡è®¾ç½®restartPolicyï¼Œæ”¹å˜Podçš„æ¢å¤ç­–ç•¥ã€‚é™¤äº†Alwaysï¼Œå®ƒè¿˜æœ‰OnFailureå’ŒNeverä¸¤ç§æƒ…å†µï¼š</p><ul>\n<li>Alwaysï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œå°±è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</li>\n<li>OnFailure: åªåœ¨å®¹å™¨ å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›</li>\n<li>Never: ä»æ¥ä¸é‡å¯å®¹å™¨ã€‚</li>\n</ul><p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®åº”ç”¨è¿è¡Œçš„ç‰¹æ€§ï¼Œåˆç†è®¾ç½®è¿™ä¸‰ç§æ¢å¤ç­–ç•¥ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªPodï¼Œå®ƒåªè®¡ç®—1+1=2ï¼Œè®¡ç®—å®Œæˆè¾“å‡ºç»“æœåé€€å‡ºï¼Œå˜æˆSucceededçŠ¶æ€ã€‚è¿™æ—¶ï¼Œä½ å¦‚æœå†ç”¨restartPolicy=Alwayså¼ºåˆ¶é‡å¯è¿™ä¸ªPodçš„å®¹å™¨ï¼Œå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚</p><p>è€Œå¦‚æœä½ è¦å…³å¿ƒè¿™ä¸ªå®¹å™¨é€€å‡ºåçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæ¯”å¦‚å®¹å™¨é€€å‡ºåçš„æ—¥å¿—ã€æ–‡ä»¶å’Œç›®å½•ï¼Œå°±éœ€è¦å°†restartPolicyè®¾ç½®ä¸ºNeverã€‚å› ä¸ºä¸€æ—¦å®¹å™¨è¢«è‡ªåŠ¨é‡æ–°åˆ›å»ºï¼Œè¿™äº›å†…å®¹å°±æœ‰å¯èƒ½ä¸¢å¤±æ‰äº†ï¼ˆè¢«åƒåœ¾å›æ”¶äº†ï¼‰ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒKubernetesçš„å®˜æ–¹æ–‡æ¡£ï¼ŒæŠŠrestartPolicyå’ŒPodé‡Œå®¹å™¨çš„çŠ¶æ€ï¼Œä»¥åŠPodçŠ¶æ€çš„å¯¹åº”å…³ç³»ï¼Œ<a href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#example-states\">æ€»ç»“äº†éå¸¸å¤æ‚çš„ä¸€å¤§å †æƒ…å†µ</a>ã€‚å®é™…ä¸Šï¼Œä½ æ ¹æœ¬ä¸éœ€è¦æ­»è®°ç¡¬èƒŒè¿™äº›å¯¹åº”å…³ç³»ï¼Œåªè¦è®°ä½å¦‚ä¸‹ä¸¤ä¸ªåŸºæœ¬çš„è®¾è®¡åŸç†å³å¯ï¼š</p><ol>\n<li>\n<p><strong>åªè¦Podçš„restartPolicyæŒ‡å®šçš„ç­–ç•¥å…è®¸é‡å¯å¼‚å¸¸çš„å®¹å™¨ï¼ˆæ¯”å¦‚ï¼šAlwaysï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªPodå°±ä¼šä¿æŒRunningçŠ¶æ€ï¼Œå¹¶è¿›è¡Œå®¹å™¨é‡å¯</strong>ã€‚å¦åˆ™ï¼ŒPodå°±ä¼šè¿›å…¥FailedçŠ¶æ€ ã€‚</p>\n</li>\n<li>\n<p><strong>å¯¹äºåŒ…å«å¤šä¸ªå®¹å™¨çš„Podï¼Œåªæœ‰å®ƒé‡Œé¢æ‰€æœ‰çš„å®¹å™¨éƒ½è¿›å…¥å¼‚å¸¸çŠ¶æ€åï¼ŒPodæ‰ä¼šè¿›å…¥FailedçŠ¶æ€</strong>ã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒPodéƒ½æ˜¯RunningçŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒPodçš„READYå­—æ®µä¼šæ˜¾ç¤ºæ­£å¸¸å®¹å™¨çš„ä¸ªæ•°ï¼Œæ¯”å¦‚ï¼š</p>\n</li>\n</ol><pre><code>$ kubectl get pod test-liveness-exec\nNAME           READY     STATUS    RESTARTS   AGE\nliveness-exec   0/1       Running   1          1m\n</code></pre><p>æ‰€ä»¥ï¼Œå‡å¦‚ä¸€ä¸ªPodé‡Œåªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œç„¶åè¿™ä¸ªå®¹å™¨å¼‚å¸¸é€€å‡ºäº†ã€‚é‚£ä¹ˆï¼Œåªæœ‰å½“restartPolicy=Neveræ—¶ï¼Œè¿™ä¸ªPodæ‰ä¼šè¿›å…¥FailedçŠ¶æ€ã€‚è€Œå…¶ä»–æƒ…å†µä¸‹ï¼Œç”±äºKuberneteséƒ½å¯ä»¥é‡å¯è¿™ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥Podçš„çŠ¶æ€ä¿æŒRunningä¸å˜ã€‚</p><p>è€Œå¦‚æœè¿™ä¸ªPodæœ‰å¤šä¸ªå®¹å™¨ï¼Œä»…æœ‰ä¸€ä¸ªå®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œå®ƒå°±å§‹ç»ˆä¿æŒRunningçŠ¶æ€ï¼Œå“ªæ€•å³ä½¿restartPolicy=Neverã€‚åªæœ‰å½“æ‰€æœ‰å®¹å™¨ä¹Ÿå¼‚å¸¸é€€å‡ºä¹‹åï¼Œè¿™ä¸ªPodæ‰ä¼šè¿›å…¥FailedçŠ¶æ€ã€‚</p><p>å…¶ä»–æƒ…å†µï¼Œéƒ½å¯ä»¥ä»¥æ­¤ç±»æ¨å‡ºæ¥ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·å›åˆ°å‰é¢æåˆ°çš„livenessProbeä¸Šæ¥ã€‚</p><p>é™¤äº†åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤å¤–ï¼ŒlivenessProbeä¹Ÿå¯ä»¥å®šä¹‰ä¸ºå‘èµ·HTTPæˆ–è€…TCPè¯·æ±‚çš„æ–¹å¼ï¼Œå®šä¹‰æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code>...\nlivenessProbe:\n     httpGet:\n       path: /healthz\n       port: 8080\n       httpHeaders:\n       - name: X-Custom-Header\n         value: Awesome\n       initialDelaySeconds: 3\n       periodSeconds: 3\n</code></pre><pre><code>    ...\n    livenessProbe:\n      tcpSocket:\n        port: 8080\n      initialDelaySeconds: 15\n      periodSeconds: 20\n</code></pre><p>æ‰€ä»¥ï¼Œä½ çš„Podå…¶å®å¯ä»¥æš´éœ²ä¸€ä¸ªå¥åº·æ£€æŸ¥URLï¼ˆæ¯”å¦‚/healthzï¼‰ï¼Œæˆ–è€…ç›´æ¥è®©å¥åº·æ£€æŸ¥å»æ£€æµ‹åº”ç”¨çš„ç›‘å¬ç«¯å£ã€‚è¿™ä¸¤ç§é…ç½®æ–¹æ³•ï¼Œåœ¨WebæœåŠ¡ç±»çš„åº”ç”¨ä¸­éå¸¸å¸¸ç”¨ã€‚</p><p>åœ¨Kubernetesçš„Podä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå«readinessProbeçš„å­—æ®µã€‚è™½ç„¶å®ƒçš„ç”¨æ³•ä¸livenessProbeç±»ä¼¼ï¼Œä½†ä½œç”¨å´å¤§ä¸ä¸€æ ·ã€‚readinessProbeæ£€æŸ¥ç»“æœçš„æˆåŠŸä¸å¦ï¼Œå†³å®šçš„è¿™ä¸ªPodæ˜¯ä¸æ˜¯èƒ½è¢«é€šè¿‡Serviceçš„æ–¹å¼è®¿é—®åˆ°ï¼Œè€Œå¹¶ä¸å½±å“Podçš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘ä¼šåœ¨è®²è§£Serviceæ—¶é‡ç‚¹ä»‹ç»ã€‚</p><p>åœ¨è®²è§£äº†è¿™ä¹ˆå¤šå­—æ®µä¹‹åï¼Œæƒ³å¿…ä½ å¯¹Podå¯¹è±¡çš„è¯­ä¹‰å’Œæè¿°èƒ½åŠ›ï¼Œå·²ç»æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„æ„Ÿè§‰ã€‚</p><p>è¿™æ—¶ï¼Œä½ æœ‰æ²¡æœ‰äº§ç”Ÿè¿™æ ·ä¸€ä¸ªæƒ³æ³•ï¼šPodçš„å­—æ®µè¿™ä¹ˆå¤šï¼Œæˆ‘åˆä¸å¯èƒ½å…¨è®°ä½ï¼Œ<span class=\"orange\">Kubernetesèƒ½ä¸èƒ½è‡ªåŠ¨ç»™Podå¡«å……æŸäº›å­—æ®µå‘¢ï¼Ÿ</span></p><p>è¿™ä¸ªéœ€æ±‚å®é™…ä¸Šéå¸¸å®ç”¨ã€‚æ¯”å¦‚ï¼Œå¼€å‘äººå‘˜åªéœ€è¦æäº¤ä¸€ä¸ªåŸºæœ¬çš„ã€éå¸¸ç®€å•çš„Pod YAMLï¼ŒKuberneteså°±å¯ä»¥è‡ªåŠ¨ç»™å¯¹åº”çš„Podå¯¹è±¡åŠ ä¸Šå…¶ä»–å¿…è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚labelsï¼Œannotationsï¼Œvolumesç­‰ç­‰ã€‚è€Œè¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯è¿ç»´äººå‘˜äº‹å…ˆå®šä¹‰å¥½çš„ã€‚</p><p>è¿™ä¹ˆä¸€æ¥ï¼Œå¼€å‘äººå‘˜ç¼–å†™Pod YAMLçš„é—¨æ§›ï¼Œå°±è¢«å¤§å¤§é™ä½äº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªå«ä½œPodPresetï¼ˆPodé¢„è®¾ç½®ï¼‰çš„åŠŸèƒ½ å·²ç»å‡ºç°åœ¨äº†v1.11ç‰ˆæœ¬çš„Kubernetesä¸­ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨å¼€å‘äººå‘˜ç¼–å†™äº†å¦‚ä¸‹ä¸€ä¸ª pod.yamlæ–‡ä»¶ï¼š</p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\nspec:\n  containers:\n    - name: website\n      image: nginx\n      ports:\n        - containerPort: 80\n</code></pre><p>ä½œä¸ºKubernetesçš„åˆå­¦è€…ï¼Œä½ è‚¯å®šçœ¼å‰ä¸€äº®ï¼šè¿™ä¸å°±æ˜¯æˆ‘æœ€æ“…é•¿ç¼–å†™çš„ã€æœ€ç®€å•çš„Podå˜›ã€‚æ²¡é”™ï¼Œè¿™ä¸ªYAMLæ–‡ä»¶é‡Œçš„å­—æ®µï¼Œæƒ³å¿…ä½ ç°åœ¨é—­ç€çœ¼ç›ä¹Ÿèƒ½å†™å‡ºæ¥ã€‚</p><p>å¯æ˜¯ï¼Œå¦‚æœè¿ç»´äººå‘˜çœ‹åˆ°äº†è¿™ä¸ªPodï¼Œä»–ä¸€å®šä¼šè¿è¿æ‘‡å¤´ï¼šè¿™ç§Podåœ¨ç”Ÿäº§ç¯å¢ƒé‡Œæ ¹æœ¬ä¸èƒ½ç”¨å•Šï¼</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¿ç»´äººå‘˜å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªPodPresetå¯¹è±¡ã€‚åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œå‡¡æ˜¯ä»–æƒ³åœ¨å¼€å‘äººå‘˜ç¼–å†™çš„Podé‡Œè¿½åŠ çš„å­—æ®µï¼Œéƒ½å¯ä»¥é¢„å…ˆå®šä¹‰å¥½ã€‚æ¯”å¦‚è¿™ä¸ªpreset.yamlï¼š</p><pre><code>apiVersion: settings.k8s.io/v1alpha1\nkind: PodPreset\nmetadata:\n  name: allow-database\nspec:\n  selector:\n    matchLabels:\n      role: frontend\n  env:\n    - name: DB_PORT\n      value: &quot;6379&quot;\n  volumeMounts:\n    - mountPath: /cache\n      name: cache-volume\n  volumes:\n    - name: cache-volume\n      emptyDir: {}\n</code></pre><p>åœ¨è¿™ä¸ªPodPresetçš„å®šä¹‰ä¸­ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªselectorã€‚è¿™å°±æ„å‘³ç€åé¢è¿™äº›è¿½åŠ çš„å®šä¹‰ï¼Œåªä¼šä½œç”¨äºselectoræ‰€å®šä¹‰çš„ã€å¸¦æœ‰â€œrole: frontendâ€æ ‡ç­¾çš„Podå¯¹è±¡ï¼Œè¿™å°±å¯ä»¥é˜²æ­¢â€œè¯¯ä¼¤â€ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ç»„Podçš„Specé‡Œçš„æ ‡å‡†å­—æ®µï¼Œä»¥åŠå¯¹åº”çš„å€¼ã€‚æ¯”å¦‚ï¼Œenvé‡Œå®šä¹‰äº†DB_PORTè¿™ä¸ªç¯å¢ƒå˜é‡ï¼ŒvolumeMountså®šä¹‰äº†å®¹å™¨Volumeçš„æŒ‚è½½ç›®å½•ï¼Œvolumeså®šä¹‰äº†ä¸€ä¸ªemptyDirçš„Volumeã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‡å®šè¿ç»´äººå‘˜å…ˆåˆ›å»ºäº†è¿™ä¸ªPodPresetï¼Œç„¶åå¼€å‘äººå‘˜æ‰åˆ›å»ºPodï¼š</p><pre><code>$ kubectl create -f preset.yaml\n$ kubectl create -f pod.yaml\n</code></pre><p>è¿™æ—¶ï¼ŒPodè¿è¡Œèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªPodçš„APIå¯¹è±¡ï¼š</p><pre><code>$ kubectl get pod website -o yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\n  annotations:\n    podpreset.admission.kubernetes.io/podpreset-allow-database: &quot;resource version&quot;\nspec:\n  containers:\n    - name: website\n      image: nginx\n      volumeMounts:\n        - mountPath: /cache\n          name: cache-volume\n      ports:\n        - containerPort: 80\n      env:\n        - name: DB_PORT\n          value: &quot;6379&quot;\n  volumes:\n    - name: cache-volume\n      emptyDir: {}\n</code></pre><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™ä¸ªPodé‡Œå¤šäº†æ–°æ·»åŠ çš„labelsã€envã€volumeså’ŒvolumeMountçš„å®šä¹‰ï¼Œå®ƒä»¬çš„é…ç½®è·ŸPodPresetçš„å†…å®¹ä¸€æ ·ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªPodè¿˜è¢«è‡ªåŠ¨åŠ ä¸Šäº†ä¸€ä¸ªannotationè¡¨ç¤ºè¿™ä¸ªPodå¯¹è±¡è¢«PodPresetæ”¹åŠ¨è¿‡ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<strong>PodPreseté‡Œå®šä¹‰çš„å†…å®¹ï¼Œåªä¼šåœ¨Pod APIå¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ åœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«ä¸Šï¼Œè€Œä¸ä¼šå½±å“ä»»ä½•Podçš„æ§åˆ¶å™¨çš„å®šä¹‰ã€‚</strong></p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æäº¤çš„æ˜¯ä¸€ä¸ªnginx-deploymentï¼Œé‚£ä¹ˆè¿™ä¸ªDeploymentå¯¹è±¡æœ¬èº«æ˜¯æ°¸è¿œä¸ä¼šè¢«PodPresetæ”¹å˜çš„ï¼Œè¢«ä¿®æ”¹çš„åªæ˜¯è¿™ä¸ªDeploymentåˆ›å»ºå‡ºæ¥çš„æ‰€æœ‰Podã€‚è¿™ä¸€ç‚¹è¯·åŠ¡å¿…åŒºåˆ†æ¸…æ¥šã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä½ å®šä¹‰äº†åŒæ—¶ä½œç”¨äºä¸€ä¸ªPodå¯¹è±¡çš„å¤šä¸ªPodPresetï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼ŒKubernetesé¡¹ç›®ä¼šå¸®ä½ åˆå¹¶ï¼ˆMergeï¼‰è¿™ä¸¤ä¸ªPodPresetè¦åšçš„ä¿®æ”¹ã€‚è€Œå¦‚æœå®ƒä»¬è¦åšçš„ä¿®æ”¹æœ‰å†²çªçš„è¯ï¼Œè¿™äº›å†²çªå­—æ®µå°±ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ è¯¦ç»†ä»‹ç»äº†Podå¯¹è±¡æ›´é«˜é˜¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸Œæœ›é€šè¿‡å¯¹è¿™äº›å®ä¾‹çš„è®²è§£ï¼Œä½ å¯ä»¥æ›´æ·±å…¥åœ°ç†è§£Pod APIå¯¹è±¡çš„å„ä¸ªå­—æ®µã€‚</p><p>è€Œåœ¨å­¦ä¹ è¿™äº›å­—æ®µçš„åŒæ—¶ï¼Œä½ è¿˜åº”è¯¥è®¤çœŸä½“ä¼šä¸€ä¸‹Kubernetesâ€œä¸€åˆ‡çš†å¯¹è±¡â€çš„è®¾è®¡æ€æƒ³ï¼šæ¯”å¦‚åº”ç”¨æ˜¯Podå¯¹è±¡ï¼Œåº”ç”¨çš„é…ç½®æ˜¯ConfigMapå¯¹è±¡ï¼Œåº”ç”¨è¦è®¿é—®çš„å¯†ç åˆ™æ˜¯Secretå¯¹è±¡ã€‚</p><p>æ‰€ä»¥ï¼Œä¹Ÿå°±è‡ªç„¶è€Œç„¶åœ°æœ‰äº†PodPresetè¿™æ ·ä¸“é—¨ç”¨æ¥å¯¹Podè¿›è¡Œæ‰¹é‡åŒ–ã€è‡ªåŠ¨åŒ–ä¿®æ”¹çš„å·¥å…·å¯¹è±¡ã€‚åœ¨åé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä¼šä¸ºä½ è®²è§£æ›´å¤šçš„è¿™ç§å¯¹è±¡ï¼Œè¿˜ä¼šå’Œä½ ä»‹ç»Kubernetesé¡¹ç›®å¦‚ä½•å›´ç»•ç€è¿™äº›å¯¹è±¡è¿›è¡Œå®¹å™¨ç¼–æ’ã€‚</p><p>åœ¨æœ¬ä¸“æ ä¸­ï¼ŒPodå¯¹è±¡ç›¸å…³çš„çŸ¥è¯†ç‚¹éå¸¸é‡è¦ï¼Œå®ƒæ˜¯æ¥ä¸‹æ¥Kubernetesèƒ½å¤Ÿæè¿°å’Œç¼–æ’å„ç§å¤æ‚åº”ç”¨çš„åŸºçŸ³æ‰€åœ¨ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿç»§ç»­å¤šå®è·µã€å¤šä½“ä¼šã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨æ²¡æœ‰Kubernetesçš„æ—¶å€™ï¼Œä½ æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹æ³•è¿›è¡Œåº”ç”¨çš„å¥åº·æ£€æŸ¥çš„ï¼ŸKubernetesçš„livenessProbeå’ŒreadinessProbeæä¾›çš„å‡ ç§æ¢æµ‹æœºåˆ¶ï¼Œæ˜¯å¦èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","neighbors":{"left":{"article_title":"14 | æ·±å…¥è§£æPodå¯¹è±¡ï¼ˆä¸€ï¼‰ï¼šåŸºæœ¬æ¦‚å¿µ","id":40366},"right":{"article_title":"16 | ç¼–æ’å…¶å®å¾ˆç®€å•ï¼šè°ˆè°ˆâ€œæ§åˆ¶å™¨â€æ¨¡å‹","id":40583}},"comments":[{"had_liked":false,"id":244047,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1598366932,"is_pvip":false,"discussion_count":13,"race_medal":0,"score":"628663592148","product_id":100015201,"comment_content":"Kuberenteså¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆå®¹å™¨å°±æ˜¯è¿›ç¨‹ï¼Œè€ŒPodå°±æ˜¯è¿›ç¨‹ç»„orè™šæ‹Ÿæœºï¼ˆå‡ ä¸ªè¿›ç¨‹å…³è”åœ¨ä¸€èµ·ï¼‰ã€‚<br><br>Podçš„è®¾è®¡ä¹‹åˆæœ‰ä¸¤ä¸ªç›®çš„ï¼š<br>ï¼ˆ1ï¼‰ä¸ºäº†å¤„ç†å®¹å™¨ä¹‹é—´çš„è°ƒåº¦å…³ç³»<br>ï¼ˆ2ï¼‰ å®ç°å®¹å™¨è®¾è®¡æ¨¡å¼ï¼š Podä¼šå…ˆå¯åŠ¨Infraå®¹å™¨è®¾ç½®ç½‘ç»œã€Volumeç­‰namespaceï¼ˆå¦‚æœVolumeè¦å…±äº«çš„è¯ï¼‰ï¼Œå…¶ä»–å®¹å™¨é€šè¿‡åŠ å…¥çš„æ–¹å¼å…±äº«è¿™äº›Namespaceã€‚<br><br>å¦‚æœå¯¹Podä¸­çš„å®¹å™¨å¯åŠ¨æœ‰é¡ºåºè¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨Init Contianerã€‚æ‰€æœ‰Init Containerå®šä¹‰çš„å®¹å™¨ï¼Œéƒ½ä¼šæ¯”spec.containerså®šä¹‰çš„ç”¨æˆ·å®¹å™¨æŒ‰é¡ºåºä¼˜å…ˆå¯åŠ¨ã€‚Init Containerå®¹å™¨ä¼šæŒ‰é¡ºåºé€ä¸€å¯åŠ¨ï¼Œè€Œç›´åˆ°å®ƒä»¬éƒ½å¯åŠ¨å¹¶ä¸”é€€å‡ºäº†ï¼Œç”¨æˆ·å®¹å™¨æ‰ä¼šå¯åŠ¨ã€‚<br><br>Podä½¿ç”¨è¿‡ç¨‹ä¸­çš„é‡è¦å­—æ®µï¼š<br>ï¼ˆ1ï¼‰podè‡ªå®šä¹‰&#47;etc&#47;hosts:  spec.hostAliases<br>ï¼ˆ2ï¼‰podå…±äº«PID : spec.shareProcessNamespace <br>ï¼ˆ3ï¼‰å®¹å™¨å¯åŠ¨å&#47;é”€æ¯å‰çš„é’©å­ï¼š spec.container.lifecycle.postStart&#47;preStop<br>ï¼ˆ4ï¼‰podçš„çŠ¶æ€ï¼šspec.status.phase<br>ï¼ˆ5ï¼‰podç‰¹æ®Šçš„volumeï¼ˆæŠ•å°„æ•°æ®å·ï¼‰:<br>   5.1) å¯†ç ä¿¡æ¯è·å–ï¼šåˆ›å»ºSecreteå¯¹è±¡ä¿å­˜åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°Etcdä¸­ã€‚ç„¶åï¼Œä½ å°±å¯ä»¥é€šè¿‡åœ¨Podçš„å®¹å™¨é‡ŒæŒ‚è½½Volumeçš„æ–¹å¼ï¼Œè®¿é—®åˆ°è¿™äº›Secreté‡Œä¿å­˜çš„ä¿¡æ¯<br>  5.2ï¼‰é…ç½®ä¿¡æ¯è·å–ï¼šåˆ›å»ºConfigMapå¯¹è±¡ä¿å­˜åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°Etcdä¸­ã€‚ç„¶åï¼Œé€šè¿‡æŒ‚è½½Volumeçš„æ–¹å¼ï¼Œè®¿é—®åˆ°ConfigMapé‡Œä¿å­˜çš„å†…å®¹<br>  5.3ï¼‰å®¹å™¨è·å–Podä¸­å®šä¹‰çš„é™æ€ä¿¡æ¯ï¼šé€šè¿‡æŒ‚è½½DownwardAPI è¿™ä¸ªç‰¹æ®Šçš„Volumeï¼Œè®¿é—®åˆ°Podä¸­å®šä¹‰çš„é™æ€ä¿¡æ¯<br>  5.4) Podä¸­è¦è®¿é—®K8Sçš„APIï¼šä»»ä½•è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¸Šçš„åº”ç”¨ï¼Œéƒ½å¿…é¡»ä½¿ç”¨è¿™ä¸ªServiceAccountTokené‡Œä¿å­˜çš„æˆæƒä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯Tokenï¼Œæ‰å¯ä»¥åˆæ³•åœ°è®¿é—®API Serverã€‚å› æ­¤ï¼Œé€šè¿‡æŒ‚è½½Volumeçš„æ–¹å¼ï¼ŒæŠŠå¯¹åº”æƒé™çš„ServiceAccountTokenè¿™ä¸ªç‰¹æ®Šçš„SecreteæŒ‚è½½åˆ°Podä¸­å³å¯<br>  ï¼ˆ6ï¼‰å®¹å™¨æ˜¯å¦å¥åº·ï¼š spec.container.livenessProbeã€‚è‹¥ä¸å¥åº·ï¼Œåˆ™Podæœ‰å¯èƒ½è¢«é‡å¯ï¼ˆå¯é…ç½®ç­–ç•¥ï¼‰<br>  ï¼ˆ7ï¼‰å®¹å™¨æ˜¯å¦å¯ç”¨ï¼š spec.container.readinessProbeã€‚è‹¥ä¸å¥åº·ï¼Œåˆ™serviceä¸ä¼šè®¿é—®åˆ°è¯¥Pod<br>","like_count":147,"discussions":[{"author":{"id":2853149,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/89/1d/d1d8edcc.jpg","nickname":"æ¢…æ–Œ","note":"","ucode":"DDE15A3FD12738","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545134,"discussion_content":"6é”™äº†ï¼Œpodä¸ä¼šâ€œé‡å¯â€ï¼Œæ˜¯ä¼šæ€æ‰å¤±è´¥çš„å®¹å™¨åå†åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1641861845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325879,"discussion_content":"5.2æœ‰è¯¯","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1605451225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2014285,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKNv880TlsNuKaWcKbxiaAZTQIBWfJAddC8wfOROnwRPRwJXaEGSTBH2sic4jK7IGpxZn79tTDcREjw/132","nickname":"Geek_7482f6","note":"","ucode":"F3565F78525D30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400786,"discussion_content":"ç¡®å®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633427879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":325879,"ip_address":""},"score":400786,"extra":""}]},{"author":{"id":1813643,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/8b/5f02056a.jpg","nickname":"Mr.Wang","note":"","ucode":"2BBB013B26B2D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321285,"discussion_content":"mk","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604559448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156489,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/89/d3a2fed9.jpg","nickname":"lwy_Robb","note":"","ucode":"B18B82763EA2BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405953,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634661437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447739,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eou1BMETumU21ZI4yiaLenOMSibzkAgkw944npIpsJRicmdicxlVQcgibyoQ00rdGk9Htp1j0dM5CP2Fibw/132","nickname":"å¯¥è‹¥æ™¨æ˜Ÿ","note":"","ucode":"2E87E43687DE72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394102,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631721311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2689906,"avatar":"https://static001.geekbang.org/account/avatar/00/29/0b/72/5dc6f786.jpg","nickname":"Ts","note":"","ucode":"EC3ABE1A12AD66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385155,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626922786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2115127,"avatar":"","nickname":"siko","note":"","ucode":"2E04E37C6D29F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384863,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626775508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1837179,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/7b/7f086546.jpg","nickname":"Alex","note":"","ucode":"70806CEA9AB15E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381250,"discussion_content":"è€ğŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624970468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2126468,"avatar":"https://static001.geekbang.org/account/avatar/00/20/72/84/079fa620.jpg","nickname":"hj24","note":"","ucode":"D7C31FF9BC0A81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372480,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620351546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006424,"avatar":"","nickname":"é—¨çª—å°äºŒ","note":"","ucode":"0BF3780C247F22","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357205,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615766806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2325365,"avatar":"https://static001.geekbang.org/account/avatar/00/23/7b/75/ad435499.jpg","nickname":"çˆ±å’‹çš„å’‹çš„","note":"","ucode":"A416C4E8C12E78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330054,"discussion_content":"mk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606513934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201471,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/3f/bfffaad7.jpg","nickname":"luke","note":"","ucode":"75758B3A52ED2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311472,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602345773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27740,"user_name":"huan","can_delete":false,"product_type":"c1","uid":1012286,"ip_address":"","ucode":"46CB95F6E4E5FF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/3e/534db55d.jpg","comment_is_top":false,"comment_ctime":1537935363,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"263530940419","product_id":100015201,"comment_content":"ä¸å®è·µï¼Œå°±æ— æ³•ç†è§£ä¸ºä»€ä¹ˆpodè¿™ä¹ˆè®¾è®¡ï¼Œè¿™é‡Œç»™äº†æˆ‘è‡ªå·±çš„å®è·µçš„è®°å½•ï¼š<br><br>https:&#47;&#47;github.com&#47;huan9huan&#47;k8s-practice&#47;tree&#47;master&#47;15-pod-advanced<br><br>ä»…ä¾›å‚è€ƒã€‚","like_count":61,"discussions":[{"author":{"id":1257338,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/7a/741fb07b.jpg","nickname":"ç™½èœ","note":"","ucode":"EA051509DF4C09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69169,"discussion_content":"kubectl describe secrets/mysecret  ä½ å®è·µè®°å½•å†™çš„è¿™é‡Œæœ‰è¯¯ï¼Œåº”è¯¥æ˜¯kubectl describe secrets/my-secret","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575267222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28180,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1538016507,"is_pvip":false,"replies":[{"id":"10141","content":"å¯¹ã€‚æ–°ç‰¹æ€§éœ€è¦å…ˆå¯ç”¨ã€‚","user_name":"ä½œè€…å›å¤","comment_id":28180,"uid":"1218095","ip_address":"","utype":1,"ctime":1538023558,"user_name_real":"Geek_6ef93d"}],"discussion_count":15,"race_medal":0,"score":"173336708347","product_id":100015201,"comment_content":"åœ¨ä½¿ç”¨PodPresetå¯¹è±¡æ—¶,å‘ç°å¹¶æœªç”Ÿæ•ˆ,æœ€ç»ˆæ‰çŸ¥é“æ˜¯å› ä¸ºå½“åˆå®‰è£…æ—¶æœªå¯ç”¨ Pod Preset.ç„¶åå‚è€ƒ[https:&#47;&#47;kubernetes.io&#47;docs&#47;concepts&#47;workloads&#47;pods&#47;podpreset&#47;#enable-pod-preset] ä¿®æ”¹  [&#47;etc&#47;kubernetes&#47;manifests&#47;kube-apiserver.yaml] ä¸­çš„spec.containers.command:   ä¿®æ”¹åŸ[ - --runtime-config=api&#47;all=true]ä¸º[- --runtime-config=api&#47;all=true,settings.k8s.io&#47;v1alpha1=true], æ–°åŠ ä¸€è¡Œ[- --enable-admission-plugins=PodPreset] å¯ä»¥ç­‰è‡ªåŠ¨ç”Ÿæ•ˆä¹Ÿå¯ä»¥å¼ºåˆ¶é‡å¯[systemctl restart kubelet]. ç„¶åå†é‡æ–°åˆ›å»º,å°±å¯ä»¥åœ¨podä¸­çœ‹è§spec.containers.env.name:DB_PORTç­‰ä¿¡æ¯äº†.","like_count":41,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425169,"discussion_content":"å¯¹ã€‚æ–°ç‰¹æ€§éœ€è¦å…ˆå¯ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538023558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1296804,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c9/a4/0710bbbd.jpg","nickname":"Geek_18858f","note":"","ucode":"391B5F20C2E860","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539421,"discussion_content":"Kubernetes v1.20 ChangeLog:\n\nThe v1alpha1 PodPreset API and admission plugin has been removed with no built-in replacement. Admission webhooks can be used to modify pods on creation. ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1639711539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"å›å“¥èŠæŠ€æœ¯","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288484,"discussion_content":"æˆ‘çš„æ˜¯v1.17.3ç‰ˆæœ¬ï¼Œå¢åŠ ä¸‹é¢é…ç½®åå°±å¯ä»¥äº†\n\nvi /etc/kubernetes/manifests/kube-apiserver.yaml\n#å¢åŠ è¿™ä¸€è¡Œ\n- --runtime-config=settings.k8s.io/v1alpha1=true\n#åœ¨ä¸‹ä¸€è¡Œåé¢å¢åŠ &#34;,PodPreset&#34;\n- --enable-admission-plugins=NodeRestriction","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593759112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"éƒ­è´»é“–","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350771,"discussion_content":"v1.20.4ç›´æ¥ææ­»","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1614003219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"éƒ­è´»é“–","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350801,"discussion_content":"ğŸ˜„ è¿™éƒ½ç»è¿‡å¥½å¤šä¸ªk8sçš„å¤§ç‰ˆæœ¬å•¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614010066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350771,"ip_address":""},"score":350801,"extra":""},{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"ä¸€ç§’","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"éƒ­è´»é“–","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351280,"discussion_content":"è€å“¥æ‰¾åˆ°è§£å†³æ–¹æ³•äº†å—","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614225112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":350771,"ip_address":""},"score":351280,"extra":""}]},{"author":{"id":1129632,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","nickname":"eagle","note":"","ucode":"D7601A2AFC1D17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344130,"discussion_content":"2021å¹´è¿‡æ¥æŒ–åŸï¼Œå‘ç° PodPreset å®˜æ–¹æ–‡æ¡£éƒ½ 404 äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611301338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1129632,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","nickname":"eagle","note":"","ucode":"D7601A2AFC1D17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344185,"discussion_content":"å“ˆå“ˆï¼Œk8så˜åŒ–å¤ªå¿«äº†ã€‚å¥½åƒç°åœ¨æœ‰å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ã€‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611318220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":344130,"ip_address":""},"score":344185,"extra":""}]},{"author":{"id":2399354,"avatar":"https://static001.geekbang.org/account/avatar/00/24/9c/7a/eecbdf22.jpg","nickname":"åŠ æª ç– é›¨","note":"","ucode":"2FB6F652E62367","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341843,"discussion_content":"æˆ‘åœ¨ v1.20.1 ä¸­è¿™æ ·é…ç½®ï¼Œé›†ç¾¤é‡å¯ä¼šå¤±è´¥ã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°å…³äºPodPresetçš„èµ„æ–™ï¼Œåªæœ‰v1.18ç‰ˆæœ¬çš„æ–‡æ¡£èµ„æ–™ã€‚      \nç„¶åæˆ‘é‡æ–°åˆ›å»ºä¸€ä¸ªv1.18.3çš„Kubernetesé›†ç¾¤ã€‚ä½¿ç”¨åŒæ ·çš„æ–¹å¼å¼€å¯PodPresetç‰¹æ€§åï¼Œé›†ç¾¤é‡å¯æˆåŠŸã€‚åˆ›å»ºpodä¹Ÿèƒ½æˆåŠŸåˆ›å»ºã€‚\n\nå¤§ä½¬æŒ‡ç‚¹ä¸€ä¸‹ï¼ï¼ï¼\næ˜¯ä¸æ˜¯PodPresetç‰¹æ€§åœ¨v1.19å¼€å§‹ï¼Œå¼€å¯çš„æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Ÿè¿˜æ˜¯PodPresetç‰¹æ€§æ›´æ¢ä¸ºåˆ«çš„äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610536399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2399354,"avatar":"https://static001.geekbang.org/account/avatar/00/24/9c/7a/eecbdf22.jpg","nickname":"åŠ æª ç– é›¨","note":"","ucode":"2FB6F652E62367","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341917,"discussion_content":"ä½ è¿™ä¸ªå¤ªè¶…å‰äº†ï¼Œå“ˆå“ˆã€‚æˆ‘ä¹Ÿæ²¡ç©è¿‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610543048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":341843,"ip_address":""},"score":341917,"extra":""}]},{"author":{"id":1069133,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/4d/db91e218.jpg","nickname":"sam700000","note":"","ucode":"C2ABDDC56B2D50","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24817,"discussion_content":"å¤šè°¢ï¼Œæˆ‘ç…§ç€æ”¹ï¼Œç„¶åé‡å¯kubeletå°±è¡Œäº†ï¼Œkubernetesç‰ˆæœ¬1.5.2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570274124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1522995,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/HfnrQlGW842BmSeVG7iciazV7U2CaYbODPbQ144qG1pSgHjhCW3OziaoqKJISfoZlEBsWsuVZtkLdCvuNUoibnsUfw/132","nickname":"Geek_hander","note":"","ucode":"3147A30A34BC8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23005,"discussion_content":"åº”è¯¥æ˜¯è¦é‡å¯apiserverï¼šsystemctl restart kube-apiserver","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1522995,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/HfnrQlGW842BmSeVG7iciazV7U2CaYbODPbQ144qG1pSgHjhCW3OziaoqKJISfoZlEBsWsuVZtkLdCvuNUoibnsUfw/132","nickname":"Geek_hander","note":"","ucode":"3147A30A34BC8F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79360,"discussion_content":"ä½ çš„ç‰ˆæœ¬æ˜¯å¤šå°‘å•Šï¼Ÿæˆ‘çš„1.16çš„è¿˜æ˜¯ä¸è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576074014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":23005,"ip_address":""},"score":79360,"extra":""}]},{"author":{"id":1145939,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO6eRuuA6V31MdFeKxghjK8SiaVUM5iaO8ibII4b2PYx7WCCmQ3yiaadaDibQft8hPtUqlScLian4PanSQ/132","nickname":"Geek_b59356","note":"","ucode":"0993804D49E73A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389,"discussion_content":"æ”¹äº†è¿™ä¸¤è¡Œé…ç½®è¿˜æ˜¯ä¸è¡Œï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561527744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1145939,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIO6eRuuA6V31MdFeKxghjK8SiaVUM5iaO8ibII4b2PYx7WCCmQ3yiaadaDibQft8hPtUqlScLian4PanSQ/132","nickname":"Geek_b59356","note":"","ucode":"0993804D49E73A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77048,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ï¼Œä½ åæ¥æ‰¾åˆ°åŸå› äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575883581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389,"ip_address":""},"score":77048,"extra":""}]}]},{"had_liked":false,"id":27568,"user_name":"Geek_zz","can_delete":false,"product_type":"c1","uid":1130682,"ip_address":"","ucode":"A3AC7C2991B50D","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/ba/2c8af305.jpg","comment_is_top":false,"comment_ctime":1537921910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"117502038902","product_id":100015201,"comment_content":"ä¿¡æ¯é‡å¤§ï¼Œè¦å¤šçœ‹ä¸¤é","like_count":27},{"had_liked":false,"id":28050,"user_name":"åŒ—å¡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1537982440,"is_pvip":false,"replies":[{"id":"10123","content":"deploymentç¡®å®æ˜¯è¿™ä¹ˆè¦æ±‚çš„å•Šã€‚ä¸è¿‡ä½ å¯ä»¥æƒ³æƒ³ä¸ºä»€ä¹ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":28050,"uid":"1218095","ip_address":"","utype":1,"ctime":1538018308,"user_name_real":"Geek_6ef93d"}],"discussion_count":4,"race_medal":0,"score":"78847393768","product_id":100015201,"comment_content":"æˆ‘è®°å¾—deploymentæ‰€åˆ›å»ºçš„pod restartç­–ç•¥åªæ”¯æŒawaysã€‚æ˜¯æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬å¤ªä½äº†å—ï¼Ÿ","like_count":18,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425126,"discussion_content":"deploymentç¡®å®æ˜¯è¿™ä¹ˆè¦æ±‚çš„å•Šã€‚ä¸è¿‡ä½ å¯ä»¥æƒ³æƒ³ä¸ºä»€ä¹ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538018308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445106,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0c/f2/eff644f9.jpg","nickname":"Geek_f04d81","note":"","ucode":"ECD9F1BE0B2186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288520,"discussion_content":"ä¸ºäº†æœ€å°‘æœ‰ä¸€ä¸ªpodå¯ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593771128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3569,"discussion_content":"ç†è§£çš„æ˜¯ä¸ºäº†podçš„è°ƒåº¦ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564586902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2009498,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/a9/9a/5df6cc22.jpg","nickname":"h","note":"","ucode":"47893B5F8913B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285652,"discussion_content":"å› ä¸ºdeploymentå¿…é¡»è¦ç»´æŒä¸€å®šé‡å¾—å‰¯æœ¬æ•°","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1592904505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3569,"ip_address":""},"score":285652,"extra":""}]}]},{"had_liked":false,"id":27597,"user_name":"snakorse","can_delete":false,"product_type":"c1","uid":1064887,"ip_address":"","ucode":"0AD727E1F16993","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/b7/0d8b5431.jpg","comment_is_top":false,"comment_ctime":1537923405,"is_pvip":false,"replies":[{"id":"9988","content":"ä¸æ˜¯çš„ï¼Œexec","user_name":"ä½œè€…å›å¤","comment_id":27597,"uid":"1218095","ip_address":"","utype":1,"ctime":1537938092,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"61667465549","product_id":100015201,"comment_content":"probeçš„åŸç†æ˜¯é€šè¿‡sidecarå®¹å™¨æ¥å®ç°çš„å—","like_count":14,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424960,"discussion_content":"ä¸æ˜¯çš„ï¼Œexec","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88532,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1555937140,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53095544692","product_id":100015201,"comment_content":"æˆ‘å…¬å¸ä¹Ÿåœ¨ç”¨livenessprobeå’Œreadinessprobeï¼Œç¬¬ä¸€ä¸ªæ˜¯å°±ç»ªæ¢é’ˆåœ¨ç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å°±ç»ªå¯ä»¥æ¥å—æµé‡ï¼Œè€Œç¬¬äºŒä¸ªæ˜¯å­˜æ´»å®¹å™¨æ¥ç¡®å®šå®¹å™¨æ˜¯å¦å‡æ­»ï¼Œå¦‚æœé‡åˆ°å‡æ­»åˆ™å¼€å§‹é‡å¯p","like_count":12,"discussions":[{"author":{"id":1326131,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3c/33/15648d99.jpg","nickname":"ã‚ã","note":"","ucode":"2629502A07E3A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43748,"discussion_content":"åäº†","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1572890814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592298,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg","nickname":"â„¡äººè§äººçˆ±æµ©ç„¶å›ã‚œ","note":"","ucode":"D042A622533C72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566835,"discussion_content":"ç¡®å®æ˜¯åäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650772399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34131,"user_name":"ç« å®‡å†›","can_delete":false,"product_type":"c1","uid":1000796,"ip_address":"","ucode":"746F14150C8285","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/5c/d983c652.jpg","comment_is_top":false,"comment_ctime":1540014119,"is_pvip":false,"replies":[{"id":"12180","content":"æ²¡é”™ã€‚Secreté‡Œè¦ä¿å­˜çš„ä¸œè¥¿å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„ç±»å‹æ˜¯map[string][]byteã€‚ä½†ä»è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼ŒSecretä¹Ÿéœ€è¦é¿å…ç”¨æˆ·æŠŠcredential stringç›´æ¥å†™åœ¨yamlé‡Œã€‚","user_name":"ä½œè€…å›å¤","comment_id":34131,"uid":"1218095","ip_address":"","utype":1,"ctime":1540026268,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"53079621671","product_id":100015201,"comment_content":"â€œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSecret å¯¹è±¡è¦æ±‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯ç»è¿‡ Base64 è½¬ç çš„ï¼Œä»¥å…å‡ºç°æ˜æ–‡å¯†ç çš„å®‰å…¨éšæ‚£ã€‚â€ base64 ç­‰åŒäºæ˜æ–‡å§â€¦â€¦æˆ‘ç†è§£æ˜¯ä¸»è¦æ˜¯ä¸ºäº† binary ç±»å‹çš„æ•°æ®ã€‚","like_count":12,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427126,"discussion_content":"æ²¡é”™ã€‚Secreté‡Œè¦ä¿å­˜çš„ä¸œè¥¿å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„ç±»å‹æ˜¯map[string][]byteã€‚ä½†ä»è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼ŒSecretä¹Ÿéœ€è¦é¿å…ç”¨æˆ·æŠŠcredential stringç›´æ¥å†™åœ¨yamlé‡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540026268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2518763,"avatar":"https://static001.geekbang.org/account/avatar/00/26/6e/eb/a891e77f.jpg","nickname":"Jasper Wu","note":"","ucode":"D6F3D58731BC02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413932,"discussion_content":"secretå¯ä»¥æœ‰å¾ˆå¤šå¥‡æ€ªçš„å­—ç¬¦ ç›´æ¥å­˜å‚¨å’Œä¼ è¾“å¯èƒ½ä¼šå‡ºé”™ï¼Œæ‰€ä»¥é€šå¸¸éƒ½è¦base64","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636613721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33952,"user_name":"å¯æœˆ","can_delete":false,"product_type":"c1","uid":1226786,"ip_address":"","ucode":"7243313ED73754","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/22/6d63d3fc.jpg","comment_is_top":false,"comment_ctime":1539928594,"is_pvip":false,"replies":[{"id":"12150","content":"å—¯ï¼Œä»£ç å®ç°ç›®å‰å°±æ˜¯è¿™æ ·çš„ã€‚æœ‰å…·ä½“çš„å½±å“å—ï¼Ÿé™¤äº†æŠ¥é”™æ¯”è¾ƒå¤šä¹‹å¤–ã€‚","user_name":"ä½œè€…å›å¤","comment_id":33952,"uid":"1218095","ip_address":"","utype":1,"ctime":1539935171,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"44489601554","product_id":100015201,"comment_content":"è€å¸ˆå¥½ï¼Œprobeæˆ‘ä»¬åœ¨ç”Ÿäº§å®é™…åº”ç”¨ä¸­ï¼Œæœ‰ä¸ªé—®é¢˜ã€‚å°±æ˜¯ï¼Œæ¯æ¬¡æ–°éƒ¨ç½²çš„æ—¶å€™ï¼Œæ—§å®¹å™¨è¦åšgraceful deleteï¼Œè¿™ä¸ªä¼šè§¦å‘kubeletçš„deleteé€»è¾‘ã€‚ åªæœ‰åœ¨å®¹å™¨è¢«killä»¥åï¼Œk8sæ‰ä¼šremove è¿™ä¸ªæ¢é’ˆã€‚å³ï¼Œå®¹å™¨å·²ç»æ”¶åˆ°killä¿¡å·åœ¨åœæœåŠ¡äº†ï¼Œä½†æ˜¯æ¢é’ˆè¿˜åœ¨æ£€æµ‹äºæ˜¯ä¸€ç›´æŠ¥é”™ã€‚   ä¸çŸ¥é“æœ‰æ²¡æœ‰é…ç½®å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚","like_count":10,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427084,"discussion_content":"å—¯ï¼Œä»£ç å®ç°ç›®å‰å°±æ˜¯è¿™æ ·çš„ã€‚æœ‰å…·ä½“çš„å½±å“å—ï¼Ÿé™¤äº†æŠ¥é”™æ¯”è¾ƒå¤šä¹‹å¤–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539935171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"ä¸€ç§’","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351298,"discussion_content":"ä»–åº”è¯¥æ˜¯æƒ³åŠ å…¥ä¸€ä¸ªç»´æŠ¤çš„åŠŸèƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614235185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88777,"user_name":"é©•è","can_delete":false,"product_type":"c1","uid":1205656,"ip_address":"","ucode":"F8C9D60738499D","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/98/02bea067.jpg","comment_is_top":false,"comment_ctime":1555998593,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"40210704257","product_id":100015201,"comment_content":"ä½¿ç”¨yamlæ–‡ä»¶åˆ›å»ºsecretå¯¹è±¡éƒ¨åˆ†çš„éªŒè¯é˜¶æ®µæœ‰é—®é¢˜ï¼š<br>$ kubectl exec -it test-projected-volume -- &#47;bin&#47;sh<br>$ ls &#47;projected-volume&#47;<br>user<br>pass<br>$ cat &#47;projected-volume&#47;user<br>root<br>$ cat &#47;projected-volume&#47;pass<br>1f2d1e2e67df<br><br>ä¸Šé¢&#47;projected-volume&#47;useré‡Œé¢çš„å†…å®¹åº”è¯¥æ˜¯adminï¼Œè€Œéroot<br><br>å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¹‹å‰è¯¾ç¨‹å»ºè®®ä½¿ç”¨kubectl applyçš„æ–¹å¼åˆ›å»ºå’Œæ›´æ–°å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿™ç¯‡é‡Œé¢è¿˜æ˜¯å…¨ç”¨kubectl createçš„æ–¹å¼å‘¢ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1086319,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","nickname":"æ…•å®¹","note":"","ucode":"BEE694935853E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267642,"discussion_content":"è¿™é‡Œçš„ConfigMapå’ŒSecretçš„åˆ›å»ºï¼Œå®è·µä¹‹åä½ å°±ä¼šå‘ç°ï¼Œé€šè¿‡kubectl create XXX --from-fileçš„æ–¹å¼æ›´æ–¹ä¾¿å¿«æ·ï¼Œæ— éœ€è‡ªå·±å»å¤„ç†å¤æ‚çš„yamlæ ¼å¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589668601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28274,"user_name":"é¾™å¤","can_delete":false,"product_type":"c1","uid":1233455,"ip_address":"","ucode":"D1724E68D6304D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","comment_is_top":false,"comment_ctime":1538039092,"is_pvip":false,"replies":[{"id":"10173","content":"client libraryï¼Œkubernetes å¯¹å¤–æš´éœ²çš„api","user_name":"ä½œè€…å›å¤","comment_id":28274,"uid":"1218095","ip_address":"","utype":1,"ctime":1538049699,"user_name_real":"Geek_6ef93d"}],"discussion_count":4,"race_medal":1,"score":"40192744756","product_id":100015201,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ‰å¥è¯ä¸å¤ªæ˜ç™½<br>åŸæ–‡ï¼šâ€œç›¸ä¿¡ä½ ä¸€å®šæœ‰è¿‡è¿™æ ·çš„æƒ³æ³•ï¼šæˆ‘ç°åœ¨æœ‰äº†ä¸€ä¸ª Podï¼Œæˆ‘èƒ½ä¸èƒ½åœ¨è¿™ä¸ª Pod é‡Œå®‰è£…ä¸€ä¸ª Kubernetes çš„Clientï¼Œè¿™æ ·å°±å¯ä»¥ä»å®¹å™¨é‡Œç›´æ¥è®¿é—®å¹¶ä¸”æ“ä½œè¿™ä¸ª Kubernetes çš„ API äº†å‘¢ï¼Ÿâ€<br><br>1. è¿™é‡Œå¯ä»¥ä¸¾ä¸ªç®€å•ä¾‹å­å—ï¼Ÿ<br>2.â€œkubernetesçš„clientâ€æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ<br>3. æ“ä½œâ€œkubernetesçš„APIâ€è¿™é‡Œçš„APIç”±æŒ‡ä»€ä¹ˆï¼Ÿ<br><br>å°ç™½é—®é¢˜ï¼Œè¿‡ä¸äº†è¿™å…³ï¼Œå¬å¾—æœ‰ç‚¹æ™•ã€‚è§è°…<br>","like_count":9,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425205,"discussion_content":"client libraryï¼Œkubernetes å¯¹å¤–æš´éœ²çš„api","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1538049699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691380,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/f4/d68fa921.jpg","nickname":"jason","note":"","ucode":"5F01F0E913C16F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345304,"discussion_content":"ä½ å¯èƒ½æ˜¯åšè¿ç»´çš„\nåšå¼€å‘çš„æ¯”è¾ƒå¥½ç†è§£ï¼Œä¾‹å¦‚å¼€å‘ä¸€ä¸ªé›†ç¾¤ç›‘æ§è½¯ä»¶ï¼Œé€šè¿‡å®¹å™¨éƒ¨ç½²ï¼Œå°±éœ€è¦ä¸€ä¸ªè®¿é—®é›†ç¾¤çš„å®¢æˆ·ç«¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611710450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"ä¸€ç§’","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691380,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/f4/d68fa921.jpg","nickname":"jason","note":"","ucode":"5F01F0E913C16F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351303,"discussion_content":"æˆ‘ä¹Ÿæ²¡ç†è§£ã€‚ä½ è¯´çš„é€šè¿‡å®¹å™¨éƒ¨ç½²ï¼Œè®¿é—®é›†ç¾¤çš„å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614235542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345304,"ip_address":""},"score":351303,"extra":""},{"author":{"id":2378009,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDj2w7GG8UjxRFYicmXlAdUHaSRdAT798ibpfOgF9OWFku5jad5ezWFGkCWXnoqFgSWlw/132","nickname":"iamcaptain","note":"","ucode":"868D95D47E033E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/01/19/f4da2829.jpg","nickname":"ä¸€ç§’","note":"","ucode":"F149B7F60620BD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374910,"discussion_content":"ç®€å•ç‚¹å°±æ˜¯æŠŠè®¿é—®é›†ç¾¤çš„å®¢æˆ·ç«¯ç¨‹åºä»¥å®¹å™¨çš„æ–¹å¼éƒ¨ç½²è€Œå·²ï¼Œè¿™ä¸ªå®¹å™¨æ˜¯åœ¨è¿™ä¸ªk8så™¨ç¾¤ä¸Šçš„ã€‚ä¸çŸ¥é“è¿™ä¹ˆè§£é‡Šæœ‰æ²¡æœ‰é—®é¢˜","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1621409477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351303,"ip_address":""},"score":374910,"extra":""}]}]},{"had_liked":false,"id":27595,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1537923258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35897661626","product_id":100015201,"comment_content":"Kubernetes çš„ livenessProbe å’Œ readinessProbe ä¸¤ä¸ªåœ¨é¡¹ç›®ä¸­éƒ½ç”¨åˆ°äº†ï¼Œæœ€åŸºæœ¬çš„æ˜¯å®šæ—¶æ£€æµ‹æœåŠ¡ç«¯å£æ˜¯å¦åœ¨ï¼Œæ¯•ç«Ÿå¥½çš„æ˜¯è¯·æ±‚æœåŠ¡ï¼Œä¾‹å¦‚é’ˆå¯¹httpæœåŠ¡ï¼Œå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œå› ä¸ºæœ‰æ—¶å€™ç«¯å£åœ¨ï¼ŒæœåŠ¡ä¸ä¸€å®šæ­£å¸¸ã€‚","like_count":8},{"had_liked":false,"id":45571,"user_name":"Pixar","can_delete":false,"product_type":"c1","uid":1197659,"ip_address":"","ucode":"E653387BA8EA16","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/5b/07858c33.jpg","comment_is_top":false,"comment_ctime":1543681365,"is_pvip":false,"replies":[{"id":"16258","content":"å¾ˆç®€å•ã€‚restart policy è¦å°Šé‡ liveness probe","user_name":"ä½œè€…å›å¤","comment_id":45571,"uid":"1218095","ip_address":"","utype":1,"ctime":1543732897,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"27313485141","product_id":100015201,"comment_content":"å¤ä¹ äº†ä¸‹å®¹å™¨çš„æ£€æŸ¥æ¢é’ˆ, æœ‰å‡ ä¸ªç‚¹è¿˜æ˜¯æ²¡å¤ªæ˜ç™½, è¿˜æœ›è€å¸ˆèƒ½è§£ç­”ä¸‹:<br>1.  restartPolicy : è¿™ä¸ªrestartPolicyæ˜¯é‡å¯çš„Podçš„Container, é‚£ä¹ˆé‡å¯çš„æ—¶æœºæ˜¯æ ¹æ®Containerç»“æŸæ—¶è¿”å›çš„çŠ¶æ€ç å—? <br>2. restart å’Œ probeçš„å…³ç³»:  PodæŸä¸ªå®¹å™¨çš„livenessProbe è¿”å›fail, è¿™ä¸ªæ—¶å€™Containerå¹¶æ²¡æœ‰ç»“æŸ, åªæ˜¯çŠ¶æ€æ£€æŸ¥æ˜¯å¤±è´¥çš„, é‚£ä¸ºä»€ä¹ˆContainerä¹Ÿä¼šé‡å¯å‘¢?  è¿™ä¸ªé‡å¯åŠ¨ä½œæ˜¯è°å‘èµ·çš„å‘¢?<br>3. readnessProbe:  å¦‚æœæŸä¸ªPodå«å¤šä¸ªContainer, ä¸”æ¯ä¸ªéƒ½æœ‰readnessProbe, é‚£æ˜¯ä¸æ˜¯è¯´åªæœ‰å…¨éƒ¨Containerçš„Probeè¿”å›success, è¯¥Podæ‰ä¼šæ˜¯ readnesså‘¢? ","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431099,"discussion_content":"å¾ˆç®€å•ã€‚restart policy è¦å°Šé‡ liveness probe","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543732897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27604,"user_name":"huan","can_delete":false,"product_type":"c1","uid":1012286,"ip_address":"","ucode":"46CB95F6E4E5FF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/3e/534db55d.jpg","comment_is_top":false,"comment_ctime":1537924082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27307727858","product_id":100015201,"comment_content":"ç›®å‰é¡¹ç›®ä½¿ç”¨äº†foreverä¹‹ç±»çš„wrapperè¿›ç¨‹æ¥ç®¡ç†å·¥ä½œè¿›ç¨‹ï¼Œforeveræ˜¯æ ¹æ®å·¥ä½œè¿›ç¨‹çš„çŠ¶æ€åšé‡å¯æ“ä½œï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨foreverçš„apiæ¥å£åšhealthæ£€æŸ¥ï¼‰ã€‚å¦å¤–ï¼Œæ—¥å¿—éƒ½æ˜¯ä½¿ç”¨appendçš„å½¢å¼ï¼Œè€Œä¸æ˜¯è¦†ç›–ï¼Œè¿™æ ·å¯ä»¥ä¸ç”¨æ©ç›–é”™è¯¯çš„å‘ç”Ÿã€‚","like_count":6},{"had_liked":false,"id":27685,"user_name":"å¾®æ€","can_delete":false,"product_type":"c1","uid":1004349,"ip_address":"","ucode":"853C48AA183A7B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/53/3d/1189e48a.jpg","comment_is_top":false,"comment_ctime":1537929232,"is_pvip":true,"replies":[{"id":"9978","content":"å¯¹","user_name":"ä½œè€…å›å¤","comment_id":27685,"uid":"1218095","ip_address":"","utype":1,"ctime":1537937873,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":4,"score":"23012765712","product_id":100015201,"comment_content":"åœ¨è®²è¿°livenessProbeçš„æ—¶å€™è¯´åˆ°ï¼šè™½ç„¶æ˜¯ Restartï¼ˆé‡å¯ï¼‰ï¼Œä½†å®é™…å´æ˜¯é‡æ–°åˆ›å»ºäº†å®¹å™¨ï¼›é‚£ä¹‹å‰é‚£ä¸ªè¿˜åœ¨è¿è¡Œçš„livenesså®¹å™¨è¢«è‡ªåŠ¨é”€æ¯äº†å—ï¼Ÿ<br>","like_count":5,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425004,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537937873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289245,"user_name":"Frank_Geek","can_delete":false,"product_type":"c1","uid":2542221,"ip_address":"","ucode":"7ACF68D4B6E014","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNITTq63LcicPbBYC1iceRo9Op0aR7jLnnYGUF4fqRscNIMIuHHbnVNSWElsP5erlP57QbUe1mY8Dw/132","comment_is_top":false,"comment_ctime":1618931677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18798800861","product_id":100015201,"comment_content":"PodPreset API ä»k8s v1.20åè¢«removeäº†ï¼š The v1alpha1 PodPreset API and admission plugin has been removed with no built-in replacement. Admission webhooks can be used to modify pods on creation.","like_count":4},{"had_liked":false,"id":243851,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1598312088,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18778181272","product_id":100015201,"comment_content":"Kuberenteså¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆå®¹å™¨å°±æ˜¯è¿›ç¨‹ï¼Œè€ŒPodå°±æ˜¯è¿›ç¨‹ç»„orè™šæ‹Ÿæœºï¼ˆå‡ ä¸ªè¿›ç¨‹å…³è”åœ¨ä¸€èµ·ï¼‰ã€‚<br><br>Podçš„è®¾è®¡ä¹‹åˆæœ‰ä¸¤ä¸ªç›®çš„ï¼š<br>ï¼ˆ1ï¼‰ä¸ºäº†å¤„ç†å®¹å™¨ä¹‹é—´çš„è°ƒåº¦å…³ç³»<br>ï¼ˆ2ï¼‰ å®ç°å®¹å™¨è®¾è®¡æ¨¡å¼ï¼š Podä¼šå…ˆå¯åŠ¨Infraå®¹å™¨è®¾ç½®ç½‘ç»œã€Volumeç­‰namespaceï¼ˆå¦‚æœVolumeè¦å…±äº«çš„è¯ï¼‰ï¼Œå…¶ä»–å®¹å™¨é€šè¿‡åŠ å…¥çš„æ–¹å¼å…±äº«è¿™äº›Namespaceã€‚<br><br>å¦‚æœå¯¹Podä¸­çš„å®¹å™¨å¯åŠ¨æœ‰é¡ºåºè¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨Init Contianerã€‚æ‰€æœ‰Init Containerå®šä¹‰çš„å®¹å™¨ï¼Œéƒ½ä¼šæ¯”spec.containerså®šä¹‰çš„ç”¨æˆ·å®¹å™¨æŒ‰é¡ºåºä¼˜å…ˆå¯åŠ¨ã€‚Init Containerå®¹å™¨ä¼šæŒ‰é¡ºåºé€ä¸€å¯åŠ¨ï¼Œè€Œç›´åˆ°å®ƒä»¬éƒ½å¯åŠ¨å¹¶ä¸”é€€å‡ºäº†ï¼Œç”¨æˆ·å®¹å™¨æ‰ä¼šå¯åŠ¨ã€‚<br><br>Podä½¿ç”¨è¿‡ç¨‹ä¸­çš„é‡è¦å­—æ®µï¼š<br>ï¼ˆ1ï¼‰podè‡ªå®šä¹‰&#47;etc&#47;hosts:  spec.hostAliases<br>ï¼ˆ2ï¼‰podå…±äº«PID : spec.shareProcessNamespace <br>ï¼ˆ3ï¼‰å®¹å™¨å¯åŠ¨å&#47;é”€æ¯å‰çš„é’©å­ï¼š spec.container.lifecycle.postStart&#47;preStop<br>ï¼ˆ4ï¼‰podçš„çŠ¶æ€ï¼šspec.status.phase<br>ï¼ˆ5ï¼‰podç‰¹æ®Šçš„volumeï¼ˆæŠ•å°„æ•°æ®å·ï¼‰:<br>   5.1) å¯†ç ä¿¡æ¯è·å–ï¼šåˆ›å»ºSecreteå¯¹è±¡ä¿å­˜åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°Etcdä¸­ã€‚ç„¶åï¼Œä½ å°±å¯ä»¥é€šè¿‡åœ¨Podçš„å®¹å™¨é‡ŒæŒ‚è½½Volumeçš„æ–¹å¼ï¼Œè®¿é—®åˆ°è¿™äº›Secreté‡Œä¿å­˜çš„ä¿¡æ¯<br>  5.2ï¼‰é…ç½®ä¿¡æ¯è·å–ï¼šåˆ›å»ºConfigMapå¯¹è±¡ä¿å­˜åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°Etcdä¸­ã€‚ç„¶åï¼Œé€šè¿‡æŒ‚è½½Volumeçš„æ–¹å¼ï¼Œè®¿é—®åˆ°ConfigMapé‡Œä¿å­˜çš„å†…å®¹<br>  5.3ï¼‰å®¹å™¨è·å–Podä¸­å®šä¹‰çš„é™æ€ä¿¡æ¯ï¼šé€šè¿‡æŒ‚è½½DownwardAPI è¿™ä¸ªç‰¹æ®Šçš„Volumeï¼Œè®¿é—®åˆ°Podä¸­å®šä¹‰çš„é™æ€ä¿¡æ¯<br>  5.4) Podä¸­è¦è®¿é—®K8Sçš„APIï¼šä»»ä½•è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¸Šçš„åº”ç”¨ï¼Œéƒ½å¿…é¡»ä½¿ç”¨è¿™ä¸ªServiceAccountTokené‡Œä¿å­˜çš„æˆæƒä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯Tokenï¼Œæ‰å¯ä»¥åˆæ³•åœ°è®¿é—®API Serverã€‚å› æ­¤ï¼Œé€šè¿‡æŒ‚è½½Volumeçš„æ–¹å¼ï¼ŒæŠŠå¯¹åº”æƒé™çš„ServiceAccountTokenè¿™ä¸ªç‰¹æ®Šçš„SecreteæŒ‚è½½åˆ°Podä¸­å³å¯<br>  ï¼ˆ6ï¼‰å®¹å™¨æ˜¯å¦å¥åº·ï¼š spec.container.livenessProbeã€‚è‹¥ä¸å¥åº·ï¼Œåˆ™Podæœ‰å¯èƒ½è¢«é‡å¯ï¼ˆå¯é…ç½®ç­–ç•¥ï¼‰<br>  ï¼ˆ7ï¼‰å®¹å™¨æ˜¯å¦å¯ç”¨ï¼š spec.container.readinessProbeã€‚è‹¥ä¸å¥åº·ï¼Œåˆ™serviceä¸ä¼šè®¿é—®åˆ°è¯¥Pod<br>","like_count":4,"discussions":[{"author":{"id":1426212,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5tqchv61Dk7EwNaDicoUCNaEgQJych0IZ9e0hGPXgZPqJXOmSJJaLvXxSoAf2ibKNe7sgs6R3g5Bw/132","nickname":"ç”°å¯„è¿œ","note":"","ucode":"9C921737C7B54F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321379,"discussion_content":"æ€»ç»“çš„éå¸¸æ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604573318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32838,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1223046,"ip_address":"","ucode":"61CFE863E8E6D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/86/8211935c.jpg","comment_is_top":false,"comment_ctime":1539701303,"is_pvip":false,"discussion_count":8,"race_medal":0,"score":"18719570487","product_id":100015201,"comment_content":"æŒ‰ç…§è€å¸ˆçš„æ“ä½œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤æŠ¥é”™äº†<br>[root@node1 k8s]# kubectl create -f preset.yaml <br>error: unable to recognize &quot;preset.yaml&quot;: no matches for kind &quot;PodPreset&quot; in version &quot;settings.k8s.io&#47;v1alpha1&quot;<br><br><br>æ±‚è§£","like_count":4,"discussions":[{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"å›å“¥èŠæŠ€æœ¯","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288486,"discussion_content":"æˆ‘çš„æ˜¯v1.17.3ç‰ˆæœ¬ï¼Œå¢åŠ ä¸‹é¢é…ç½®åå°±å¯ä»¥äº†\n\nvi /etc/kubernetes/manifests/kube-apiserver.yaml\n#å¢åŠ è¿™ä¸€è¡Œ\n- --runtime-config=settings.k8s.io/v1alpha1=true\n#åœ¨ä¸‹ä¸€è¡Œåé¢å¢åŠ &#34;,PodPreset&#34;\n- --enable-admission-plugins=NodeRestriction","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593759149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"ç§¯çº¢","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":672,"discussion_content":"éœ€è¦å¯ç”¨PodPreset, 1. ä¿®æ”¹/etc/kubernetes/manifests/kube-apiserver.yamlæ–‡ä»¶ï¼Œæ·»åŠ --enable-admission-plugins=NodeRestriction,PodPreset å’Œ--runtime-config=settings.k8s.io/v1alpha1=true ï¼Œ 2. é‡å¯kubelet:  systemctl restart kubelet","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561952148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1644983,"avatar":"","nickname":"weiwei.mo","note":"","ucode":"DA130336171AE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"ç§¯çº¢","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9545,"discussion_content":"æå®Œï¼ŒkubeletæŒ‚äº† å‘å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568185549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":672,"ip_address":""},"score":9545,"extra":""},{"author":{"id":1227336,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","nickname":"csoulsi","note":"","ucode":"96C9BBE9097FB3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1082097,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/f1/c2cfbd2e.jpg","nickname":"ç§¯çº¢","note":"","ucode":"A8ED0D66E7E723","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77039,"discussion_content":"æˆ‘æ˜¯å®ç”¨kubeadmå®‰è£…çš„ï¼ŒæŒ‰ç…§è¿™ä¸ªæ”¹åè¿˜ä¸è¡Œï¼Œä½ æ˜¯åšè¿‡äº†å¯¹å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575882459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":672,"ip_address":""},"score":77039,"extra":""},{"author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"éƒ­è´»é“–","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1644983,"avatar":"","nickname":"weiwei.mo","note":"","ucode":"DA130336171AE8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350776,"discussion_content":"æˆ‘ä¹Ÿæ˜¯å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614003605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":9545,"ip_address":""},"score":350776,"extra":""}]},{"author":{"id":1740780,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8f/ec/7333c129.jpg","nickname":"ä»˜æ–‡è¾¾","note":"","ucode":"FBC2B62CB4DFB4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554439,"discussion_content":"æŒ‚äº†ç›´æ¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646380666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298252,"avatar":"","nickname":"Geek_b52974","note":"","ucode":"59884399646620","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295935,"discussion_content":"æˆ‘è¯•æ²¡é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596383961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27824,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1537949681,"is_pvip":false,"replies":[{"id":"10036","content":"è¯·ä»”ç»†çœ‹ï¼Œæˆ‘åœ¨æ–‡ç¨¿åˆ—å‡ºæ¥çš„execçš„è¾“å‡ºï¼Œæ˜¯ç¬¬äºŒç§æ–¹æ³•ã€ä¹Ÿå°±æ˜¯å†™YAMLæ–‡ä»¶æ–¹æ³•åˆ›å»ºçš„Secretã€‚è€Œä½ åˆ—å‡ºæ¥çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•åˆ›å»ºçš„Secretã€‚ä»–ä¿©æœ¬æ¥å°±æ˜¯ä¸ä¸€æ ·çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":27824,"uid":"1218095","ip_address":"","utype":1,"ctime":1537953645,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"18717818865","product_id":100015201,"comment_content":"æ–‡ç« ä¸­çš„ä»£ç  dapi-volume.yaml æ ¼å¼ä¸å¯¹,è¢«å–æ¶ˆäº†ç¼©è¿›,å¯¼è‡´ç›´æ¥è´´å‡ºæ¥ä½¿ç”¨ä¼šæŠ¥é”™.<br>è¿˜æœ‰æŒ‰æ–‡ç« ä¸­çš„å‘½ä»¤ kubectl create secret generic user --from-file=.&#47;username.txt ,åœ¨podä¸­[ kubectl exec -it test-projected-volume -- &#47;bin&#47;sh]å±•ç¤ºçš„ç›®å½•ä¸æ˜¯user,è€Œæ˜¯username.txt. å¯ä»¥é€šè¿‡[kubectl edit secrets user]æ‰‹åŠ¨ä¿®æ”¹data:ä¸‹çš„å­—æ®µå.","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425043,"discussion_content":"è¯·ä»”ç»†çœ‹ï¼Œæˆ‘åœ¨æ–‡ç¨¿åˆ—å‡ºæ¥çš„execçš„è¾“å‡ºï¼Œæ˜¯ç¬¬äºŒç§æ–¹æ³•ã€ä¹Ÿå°±æ˜¯å†™YAMLæ–‡ä»¶æ–¹æ³•åˆ›å»ºçš„Secretã€‚è€Œä½ åˆ—å‡ºæ¥çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•åˆ›å»ºçš„Secretã€‚ä»–ä¿©æœ¬æ¥å°±æ˜¯ä¸ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537953645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1022886,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9b/a6/1f485c48.jpg","nickname":"é«˜è¿œ","note":"","ucode":"BC84D5A3EA37A6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315519,"discussion_content":"è€å¸ˆè¿˜æ˜¯æœ‰ç¬”è¯¯çš„ã€‚å› ä¸ºå¦‚æœè¦ç”¨åˆ°ç¬¬äºŒç§æ–¹æ³•äº§ç”Ÿçš„secretçš„è¯ï¼Œåº”è¯¥æç¤ºä¸€ä¸‹å­¦ç”Ÿtest-projected-volume.yamlæ–‡ä»¶çš„æœ€åsecretéƒ¨åˆ†æ˜¯éœ€è¦æ›´æ–°ä¸€ä¸‹çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603284553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27525,"user_name":"å‡è£…ä¹","can_delete":false,"product_type":"c1","uid":1093437,"ip_address":"","ucode":"97A7D0A6D93865","user_header":"https://static001.geekbang.org/account/avatar/00/10/af/3d/28b61e6b.jpg","comment_is_top":false,"comment_ctime":1537918940,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18717788124","product_id":100015201,"comment_content":"è®²çš„è¯¦ç»†é‡åˆå¤§å“ˆ","like_count":4},{"had_liked":false,"id":289244,"user_name":"Frank_Geek","can_delete":false,"product_type":"c1","uid":2542221,"ip_address":"","ucode":"7ACF68D4B6E014","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNITTq63LcicPbBYC1iceRo9Op0aR7jLnnYGUF4fqRscNIMIuHHbnVNSWElsP5erlP57QbUe1mY8Dw/132","comment_is_top":false,"comment_ctime":1618931594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14503833482","product_id":100015201,"comment_content":"PodPreset APIä»k8s v.20ä»¥åè¢«removeäº†ï¼š","like_count":3},{"had_liked":false,"id":35288,"user_name":"Yao1931","can_delete":false,"product_type":"c1","uid":1219014,"ip_address":"","ucode":"FDF907E94C5574","user_header":"https://static001.geekbang.org/account/avatar/00/12/99/c6/fcb91141.jpg","comment_is_top":false,"comment_ctime":1540511667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14425413555","product_id":100015201,"comment_content":"Deploymentæ˜¯æ§åˆ¶å™¨ï¼Œæœ‰å‰¯æœ¬æ•°è¦æ±‚ï¼Œå¦‚æœæ¢å¤ç­–ç•¥ä¸ä»…æ˜¯alwayså°±ä¸å®ƒçš„è®¾è®¡è¿èƒŒäº†ã€‚æ˜¯è¿™æ ·å—ï¼Ÿ","like_count":3},{"had_liked":false,"id":27632,"user_name":"é£è¡Œä¼ è¯´","can_delete":false,"product_type":"c1","uid":1228222,"ip_address":"","ucode":"3CFD8AB4975764","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTILhHQ6S5c2QEGNoiaL5LicibKah5wOZIh8iaWloM5XfDeW4aJwLicWlqceUVFEBicMzpqyFWDFEmVeibhFg/132","comment_is_top":false,"comment_ctime":1537925753,"is_pvip":false,"replies":[{"id":"9983","content":"å¾ˆç®€å•å•¦ã€‚projected volume æ˜¯æ–°apiï¼Œå››ä¸ªå®šä¹‰åœ¨ä¸€èµ·ã€‚åè€…æ˜¯è€apiï¼Œåˆ†å¼€çš„ã€‚ä»¥åå°½é‡ç”¨æ–°apiã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938023,"ip_address":"","comment_id":27632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422827641","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œæ‚¨æ–‡ç« é‡Œé¢è®²åˆ°çš„pod.spec.volumes.projected.sourcesä¸‹çš„è¿™å››ç§å¯¹è±¡ä¸­çš„configMap secret å’Œpod.spec.volumesä¸‹çš„configMap secretæ˜¯å¦æœ‰åŒºåˆ«ï¼Œå¦‚æœæ²¡æœ‰åŒºåˆ«é‚£ä¸ºä½•ç›¸åŒçš„åŠŸèƒ½å¯¹è±¡è¦è®¾ç½®åœ¨ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ä¸‹é¢å‘¢ï¼Ÿè¿™ç‚¹è®©æˆ‘ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œå¸Œæœ›æ‚¨èƒ½ç»™äºˆä¸€ä¸‹è§£ç­”ï¼Œè°¢è°¢ï¼","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424977,"discussion_content":"å¾ˆç®€å•å•¦ã€‚projected volume æ˜¯æ–°apiï¼Œå››ä¸ªå®šä¹‰åœ¨ä¸€èµ·ã€‚åè€…æ˜¯è€apiï¼Œåˆ†å¼€çš„ã€‚ä»¥åå°½é‡ç”¨æ–°apiã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27617,"user_name":"abc","can_delete":false,"product_type":"c1","uid":1198332,"ip_address":"","ucode":"A4E989E85848D9","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/fc/f46062b6.jpg","comment_is_top":false,"comment_ctime":1537924923,"is_pvip":false,"replies":[{"id":"9994","content":"projectedæ˜¯æ–°apiï¼ŒæŠŠå››ç§volumeç»Ÿä¸€ç®¡ç†äº†","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938272,"ip_address":"","comment_id":27617,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14422826811","product_id":100015201,"comment_content":"æ›´é‡è¦çš„æ˜¯ï¼Œåƒè¿™æ ·é€šè¿‡æŒ‚è½½æ–¹å¼è¿›å…¥åˆ°å®¹å™¨é‡Œçš„ Secretï¼Œä¸€æ—¦å…¶å¯¹åº”çš„ Etcd é‡Œçš„æ•°æ®è¢«æ›´æ–°ï¼Œè¿™äº› Volume é‡Œçš„æ–‡ä»¶å†…å®¹ï¼ŒåŒæ ·ä¹Ÿä¼šè¢«æ›´æ–°ã€‚<br>â€”â€”â€”â€”â€”â€”â€”<br>æƒ³é—®ä¸€ä¸‹ï¼Œsecretæ˜¯å¯ä»¥ç›´æ¥æŒ‚è½½ä½¿ç”¨çš„ï¼ŒåŠ ä¸ªprojects volumesçš„æ–¹å¼æœ‰å•¥å¥½å¤„ï¼Ÿæ˜¯è‡ªåŠ¨æ›´æ–°å—","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424966,"discussion_content":"projectedæ˜¯æ–°apiï¼ŒæŠŠå››ç§volumeç»Ÿä¸€ç®¡ç†äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"å›¢","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412798,"discussion_content":"Mark.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636292728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27593,"user_name":"fhchina","can_delete":false,"product_type":"c1","uid":1057157,"ip_address":"","ucode":"CF9329FD16F6CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/85/609a2e51.jpg","comment_is_top":false,"comment_ctime":1537922959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14422824847","product_id":100015201,"comment_content":"æ˜¯projected volume 1.11ä»¥åï¼Œä¸æ˜¯persistent volume","like_count":3},{"had_liked":false,"id":90505,"user_name":"Destiny","can_delete":false,"product_type":"c1","uid":1320422,"ip_address":"","ucode":"0CB250BB32C822","user_header":"https://static001.geekbang.org/account/avatar/00/14/25/e6/67104dff.jpg","comment_is_top":false,"comment_ctime":1556539840,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10146474432","product_id":100015201,"comment_content":"å’Œopenshiftå“ªä¸ªè¾ƒå¥½","like_count":2,"discussions":[{"author":{"id":1340672,"avatar":"https://static001.geekbang.org/account/avatar/00/14/75/00/836d9421.jpg","nickname":"Toby","note":"","ucode":"B90446C0F04E50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208622,"discussion_content":"ä¸¤ä¸ªä¸œè¥¿åº”è¯¥è¯´ä¸ä¸€æ ·çš„å§ openshiftæ˜¯åœ¨k8sçš„åŸºç¡€ä¸ŠåŠ äº†ä¸€å±‚wrapper","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584564157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28251,"user_name":"å‘¨å¨„å­","can_delete":false,"product_type":"c1","uid":1228039,"ip_address":"","ucode":"18A1E6926C095A","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/07/bf8c31fb.jpg","comment_is_top":false,"comment_ctime":1538033423,"is_pvip":false,"replies":[{"id":"10183","content":"è¿™æ˜¯ä¸€ä¸ªåœºæ™¯åŒ–çš„åŠŸèƒ½ï¼Œè¦æœ‰æ‰¹é‡æ“ä½œçš„éœ€æ±‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538052388,"ip_address":"","comment_id":28251,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127968015","product_id":100015201,"comment_content":"podpresetæˆ‘è§‰å¾—ä¸è¦ä»€ä¹ˆæƒ…å†µéƒ½ç”¨ï¼Œè¿˜æ˜¯åšæŒæ‰€è§å³æ‰€å¾—ã€‚","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425197,"discussion_content":"è¿™æ˜¯ä¸€ä¸ªåœºæ™¯åŒ–çš„åŠŸèƒ½ï¼Œè¦æœ‰æ‰¹é‡æ“ä½œçš„éœ€æ±‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538052388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27653,"user_name":"å°å°ç¬‘å„¿","can_delete":false,"product_type":"c1","uid":1040354,"ip_address":"","ucode":"CA63CC50DC2091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/df/e2/823a04b4.jpg","comment_is_top":false,"comment_ctime":1537927052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10127861644","product_id":100015201,"comment_content":"ä¸€èˆ¬éƒ½æ˜¯httpè¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œk8sæä¾›äº†http,tcpå’Œexecçš„æ–¹å¼ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯å¤Ÿç”¨äº†","like_count":2},{"had_liked":false,"id":27503,"user_name":"Tim Zhang","can_delete":false,"product_type":"c1","uid":1214499,"ip_address":"","ucode":"4956AC5FE45EE1","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/23/a0966b4d.jpg","comment_is_top":false,"comment_ctime":1537912516,"is_pvip":false,"replies":[{"id":"9995","content":"å†ä»”ç»†çœ‹çœ‹â€¦â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938294,"ip_address":"","comment_id":27503,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127847108","product_id":100015201,"comment_content":"pvæ˜¯1.11ä»¥åï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424928,"discussion_content":"å†ä»”ç»†çœ‹çœ‹â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304417,"user_name":"boss_pi","can_delete":false,"product_type":"c1","uid":1713744,"ip_address":"","ucode":"5EED6D9BA7F061","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/htzC3ImxibzOia06PkhxmHib8aXnFXqOSjbHiaveNkh26EtFDFxlAoXzyBdibDtGIIlmZhqumnAAaSGYGTPopY0kZicw/132","comment_is_top":false,"comment_ctime":1627395038,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5922362334","product_id":100015201,"comment_content":"è¿™æ˜¯æˆ‘å­¦è¿‡æœ€é•¿çš„ä¸€èŠ‚ä¸“æ ï¼Œå¹²è´§å¾ˆå¤š","like_count":1},{"had_liked":false,"id":283090,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1615543503,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5910510799","product_id":100015201,"comment_content":"ä¸ºä»€ä¹ˆè¦å¼•å…¥Deploymentå’ŒServiceAcoountï¼Ÿ ç›´æ¥ä½¿ç”¨Replicaentå’ŒServiceAcoountï¼Ÿ ç›´æ¥ä½¿ç”¨Replicasetå’ŒSecretæœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2378009,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDj2w7GG8UjxRFYicmXlAdUHaSRdAT798ibpfOgF9OWFku5jad5ezWFGkCWXnoqFgSWlw/132","nickname":"iamcaptain","note":"","ucode":"868D95D47E033E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374913,"discussion_content":"Deploymentæ˜¯Replicasetçš„å‡çº§ç‰ˆï¼Œèƒ½å¤Ÿç”¨Deploymentçš„æƒ…å†µä¸‹å°½é‡ç”¨å®ƒï¼Œå› ä¸ºå®ƒæ”¯æŒæ»šåŠ¨æ›´æ–°ï¼ŒReplicasetä¸æ”¯æŒï¼Œè€Œä¸”ä¹Ÿæ¨èä½¿ç”¨Deploymentã€‚ å®ƒä»¬ä¿©çš„æœ€å¤§åŒºåˆ«å°±æ˜¯æ˜¯å¦æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1621410273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265547,"user_name":"Glowry","can_delete":false,"product_type":"c1","uid":1415527,"ip_address":"","ucode":"36046C0639A404","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/U1A1E7HXDTpbLjhickDHHuaRlRo6wFoRtSwl0zCSROJyTN2pVm5Bpia1cPPX5hZOzMf5zqJVXDGN2Q0FTH5c9vOQ/132","comment_is_top":false,"comment_ctime":1606926195,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5901893491","product_id":100015201,"comment_content":"<br>apiVersion: v1<br>kind: Secret<br>metadata:<br>  name: mysecret<br>type: Opaque<br>data:<br>  user: YWRtaW4=<br>  pass: MWYyZDFlMmU2N2Rm<br><br>ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶åˆ›å»ºsecret: kubectl create -f ***<br><br>deploymenté…ç½®éœ€è¦è°ƒæ•´ä¸ºï¼š<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: test-projected-volume <br>spec:<br>  containers:<br>  - name: test-secret-volume<br>    image: busybox<br>    args:<br>    - sleep<br>    - &quot;86400&quot;<br>    volumeMounts:<br>    - name: mysql-cred<br>      mountPath: &quot;&#47;projected-volume&quot;<br>      readOnly: true<br>  volumes:<br>  - name: mysql-cred<br>    projected:<br>      sources:<br>      - secret:<br>          name: mysecret<br><br>ç›´æ¥ç”¨user, passä¼šæŠ¥æ‰¾ä¸åˆ°æ•°æ®çš„å¼‚å¸¸ï¼Œpodæ— æ³•å¯åŠ¨","like_count":1,"discussions":[{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389246,"discussion_content":"å‰å®³ï¼Œè§£å†³äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629190695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2352309,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e4/b5/8908e68e.jpg","nickname":"Tannin","note":"","ucode":"486B0924DD3DED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332131,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ä¸€æ ·çš„é—®é¢˜ï¼Œæ±‚è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607071526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41956,"user_name":"Geek_6bab38","can_delete":false,"product_type":"c1","uid":1261301,"ip_address":"","ucode":"118ED65D80A6B5","user_header":"https://static001.geekbang.org/account/avatar/00/13/3e/f5/ba756775.jpg","comment_is_top":false,"comment_ctime":1542880698,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837847994","product_id":100015201,"comment_content":"æˆ‘åˆ›å»ºäº† podPreset  åŒ…å« redis  6379ç­‰ å…³è”äº†role frontend<br>ä½†æ˜¯  æˆ‘åˆ›å»ºäº†Pod website <br>ç”¨kubectl get pod website -o yaml æŸ¥çœ‹ï¼Œæ²¡æœ‰çœ‹åˆ°æœ‰æ–‡ç« ä¸­çš„<br>      env:<br>        - name: DB_PORT<br>          value: &quot;6379&quot;<br>ä¿¡æ¯ï¼Œæ˜¯æˆ‘å“ªé‡Œæ“ä½œä¸å¯¹ï¼Ÿè¿˜æ˜¯å“ªé‡Œæœ‰é—®é¢˜å‘¢ï¼ŸæœŸå¾…è€å¸ˆçš„å›å¤ï¼Œæ„Ÿè°¢","like_count":1},{"had_liked":false,"id":34754,"user_name":"Racoon","can_delete":false,"product_type":"c1","uid":1040047,"ip_address":"","ucode":"20D9DBDDEB3B1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/af/9379c7bd.jpg","comment_is_top":false,"comment_ctime":1540283804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5835251100","product_id":100015201,"comment_content":"geektime&#47;sample:v2å’Œgeektime&#47;tomcat:7.0  éº»çƒ¦ç»™ä¸€ä¸‹è¿™ä¸¤ä¸ªé•œåƒçš„å…¬æœ‰åœ°å€ã€‚<br>","like_count":1},{"had_liked":false,"id":32760,"user_name":"æ˜Ÿå°˜_StarDust","can_delete":false,"product_type":"c1","uid":1226876,"ip_address":"","ucode":"78A2B0B0745429","user_header":"https://static001.geekbang.org/account/avatar/00/12/b8/7c/dc6c1242.jpg","comment_is_top":false,"comment_ctime":1539690480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5834657776","product_id":100015201,"comment_content":"--runtime-config æ˜¯deprecatedï¼Œ ä»¥åä¼šè¢«ç§»é™¤ã€‚","like_count":1},{"had_liked":false,"id":28169,"user_name":"gogo","can_delete":false,"product_type":"c1","uid":1003104,"ip_address":"","ucode":"E8F0F3B000020A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/60/0d5aa340.jpg","comment_is_top":false,"comment_ctime":1538014375,"is_pvip":false,"replies":[{"id":"10142","content":"å­˜åœ¨elastic searché‡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538023574,"ip_address":"","comment_id":28169,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832981671","product_id":100015201,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·é—®java webé¡¹ç›®çš„æ—¥å¿—è¾“å‡ºåˆ°åˆ†å¸ƒå¼å­˜å‚¨é‡Œé¢ï¼Œæ€ä¹ˆæ–¹ä¾¿æŸ¥çœ‹ä¿å­˜å¥½çš„æ—¥å¿—å‘¢","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425163,"discussion_content":"å­˜åœ¨elastic searché‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538023574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27600,"user_name":"vx:jiancheng_goon","can_delete":false,"product_type":"c1","uid":1218615,"ip_address":"","ucode":"FD34901B061825","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/37/7f575aec.jpg","comment_is_top":false,"comment_ctime":1537923692,"is_pvip":false,"replies":[{"id":"9986","content":"è¿™å°±æ˜¯probeç”¨çš„è„šæœ¬å•Š","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938079,"ip_address":"","comment_id":27600,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832890988","product_id":100015201,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ä»¬çš„å¹³å°è¦æ¥å…¥å¾ˆå¤šæ¥è‡ªäºä¸åŒå›¢é˜Ÿçš„äº§å“ã€‚ä»–ä»¬çš„å¥åº·æ£€æŸ¥æ–¹å¼éƒ½ç±»ä¼¼äºåœ¨å®¹å™¨é‡Œæ‰§è¡Œä¸€ä¸ªcheckhealthçš„è„šæœ¬ï¼Œæ ¹æ®æ£€æŸ¥è„šæœ¬çš„è¿”å›ç»“æœæ¥åˆ¤æ–­ã€‚æ˜¯å¦å¯ä»¥æ— ç¼æ¥å…¥åˆ°k8så‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424962,"discussion_content":"è¿™å°±æ˜¯probeç”¨çš„è„šæœ¬å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359166,"user_name":"æ–¹æŒ¯","can_delete":false,"product_type":"c1","uid":2917177,"ip_address":"ä¸Šæµ·","ucode":"7468D5C81D5BE8","user_header":"https://static001.geekbang.org/account/avatar/00/2c/83/39/5a11372b.jpg","comment_is_top":false,"comment_ctime":1665300182,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665300182","product_id":100015201,"comment_content":"PodPreset åœ¨ v1.20 ç‰ˆæœ¬å·²ç»åˆ é™¤ï¼Œé«˜ç‰ˆæœ¬çš„å°ä¼™ä¼´ä¸ç”¨å°è¯•äº†<br>","like_count":0},{"had_liked":false,"id":350654,"user_name":"æ˜ŸæœŸä¸€çš„åŒ…å­","can_delete":false,"product_type":"c1","uid":2914948,"ip_address":"","ucode":"A37C5310C0EB64","user_header":"https://static001.geekbang.org/account/avatar/00/2c/7a/84/07b4c263.jpg","comment_is_top":false,"comment_ctime":1657076143,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657076143","product_id":100015201,"comment_content":"è€å¸ˆä½ å¥½æˆ‘ä½¿ç”¨ port-forward åå¡ä¸»æ²¡æœ‰è¾“å‡ºä¸€èˆ¬æ˜¯ä»€ä¹ˆåŸå› å‘¢","like_count":0},{"had_liked":false,"id":344906,"user_name":"ryan","can_delete":false,"product_type":"c1","uid":1999269,"ip_address":"","ucode":"187157B8A25E7A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/81/a5/c928b294.jpg","comment_is_top":false,"comment_ctime":1651846980,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651846980","product_id":100015201,"comment_content":"podpreset è²Œä¼¼å·²ç»è¢«å¼ƒç”¨å¹¶ç§»é™¤äº†ï¼Œæˆ‘ä¹Ÿè§‰å¾—å®ƒç”¨å¤„å¹¶ä¸å¤§","like_count":0},{"had_liked":false,"id":340251,"user_name":"è·¯äººç”²","can_delete":false,"product_type":"c1","uid":1208024,"ip_address":"","ucode":"0B5D0AE087B68C","user_header":"https://static001.geekbang.org/account/avatar/00/12/6e/d8/42e516d8.jpg","comment_is_top":false,"comment_ctime":1648697763,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648697763","product_id":100015201,"comment_content":"PodPresetå·²ç»åœ¨1.20åˆ é™¤ï¼Œå»ºè®®å°±ç®—é›†ç¾¤è¿˜åœ¨1.19æˆ–ä»¥ä¸‹éƒ½ä¸è¦ç”¨äº†","like_count":0},{"had_liked":false,"id":338873,"user_name":"ä¸€å¶","can_delete":false,"product_type":"c1","uid":2053463,"ip_address":"","ucode":"912A097A918BE7","user_header":"https://static001.geekbang.org/account/avatar/00/1f/55/57/0eedfd08.jpg","comment_is_top":false,"comment_ctime":1647767961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647767961","product_id":100015201,"comment_content":"ExecActionï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º 0 åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚<br>TCPSocketActionï¼šå¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨çš„ IP åœ°å€è¿›è¡Œ TCP æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚<br>HTTPGetActionï¼šå¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨çš„ IP åœ°å€æ‰§è¡Œ HTTP Get è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº200 ä¸”å°äº 400ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚","like_count":0},{"had_liked":false,"id":323772,"user_name":"edward","can_delete":false,"product_type":"c1","uid":1942013,"ip_address":"","ucode":"5DAE754E7EC361","user_header":"","comment_is_top":false,"comment_ctime":1638155943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638155943","product_id":100015201,"comment_content":"æƒ³è¯·é—®ä¸€ä¸‹livenessProbeæš´éœ²çš„å¥åº·æ£€æŸ¥æ¥å£ï¼Œåˆ«äººçš„podä¸­çš„æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æš´éœ²å¥åº·æ£€æŸ¥çš„è¯¥podçš„podIpæ¥è°ƒç”¨å¥åº·æ£€æŸ¥ï¼Œä»¥æ­¤æ¥ç¡®å®šè¯¥podæ˜¯å¦å·²ç»è¢«é‡å¯å—ï¼Œå› ä¸ºé‡å¯ä¹‹åï¼ŒpodIPä¼šå˜ï¼Œé‚£ä¹ˆpodIPï¼š8080&#47;healthå°±è®¿é—®ä¸åˆ°äº†","like_count":0},{"had_liked":false,"id":315023,"user_name":"Geek_515b9e","can_delete":false,"product_type":"c1","uid":1335734,"ip_address":"","ucode":"2D041B7679A2AF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dlj3u0jzg1gmCSxZ6daxUhhjtjmgqIwdOyalaEXYDYyQxibOsQdTrKFPPRs2I2XCHoehNaYUPrIffia9ZnR9efqQ/132","comment_is_top":false,"comment_ctime":1633661720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633661720","product_id":100015201,"comment_content":"æˆ‘é¡¹ç›®çš„é…ç½®æ–‡ä»¶è¦æ€ä¹ˆå»å¼•ç”¨secretçš„ç”¨æˆ·åå¯†ç å‘¢   ","like_count":0},{"had_liked":false,"id":314784,"user_name":"é™ˆæ–¯ä½³","can_delete":false,"product_type":"c1","uid":1259323,"ip_address":"","ucode":"C236F874FC767A","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","comment_is_top":false,"comment_ctime":1633429355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633429355","product_id":100015201,"comment_content":"ç¬¬åäº”è¯¾:æ·±å…¥ç†è§£Podå¯¹è±¡ï¼ˆäºŒï¼‰:ä½¿ç”¨è¿›é˜¶<br><br>K8sæ”¯æŒå››ç§Projected Volume: secret, configmap, downward apiå’Œä¸€ä¸ªç‰¹æ®Šçš„secret ServiceTccountTokenã€‚ä»¥è¿™ç§æ–¹å¼æŒ‚åœ¨çš„volumeä¼šåˆ°åˆ°kubeletå®šæœŸæ›´æ–°ç»´æŠ¤ï¼Œè€Œå¦‚æœæ˜¯ä»¥ç¯å¢ƒå˜é‡æ–¹å¼æŒ‚è½½åˆ™ä¸ä¼šã€‚<br><br>livenesså’Œreadinessæ˜¯ä¿è¯å®¹å™¨æ­£å¸¸è¿è¡Œçš„é‡è¦æ‰‹æ®µï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºprobeæ¢é’ˆã€‚<br><br>restartPolicyæœ‰ä¸‰ç§å½¢å¼:always,onfailureå’Œnever<br><br>PodPresetå¯ä»¥é¢„å®šPodæ¨¡æ¿ï¼Œç„¶åå‘ç¬¦åˆlabelçš„Podæ³¨å…¥è®¾ç½®å¥½çš„æ¨¡æ¿å†…å®¹ï¼Œè¿™æ ·åœ¨åˆ›å»ºPodçš„æ—¶å€™å°±å¯ä»¥ä¸ç”¨å®šä¹‰æ‰€æœ‰å€¼äº†","like_count":0},{"had_liked":false,"id":314587,"user_name":"å‡¡ä¿—","can_delete":false,"product_type":"c1","uid":1977570,"ip_address":"","ucode":"47FBCD66BE5AD4","user_header":"https://static001.geekbang.org/account/avatar/00/1e/2c/e2/afa3867c.jpg","comment_is_top":false,"comment_ctime":1633245451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633245451","product_id":100015201,"comment_content":"è™šæœºæ—¶ä»£ï¼Œä¸»è¦ç”¨zabbix-agentæ­é…å‘½ä»¤å®ç°å¥åº·æ£€æŸ¥","like_count":0},{"had_liked":false,"id":310869,"user_name":"è¨€åˆæœ¨æ‰","can_delete":false,"product_type":"c1","uid":1201009,"ip_address":"","ucode":"300BEDC1B07DF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/71/a4e9f20e.jpg","comment_is_top":false,"comment_ctime":1630940012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630940012","product_id":100015201,"comment_content":"å…¶å®åœ¨çœ‹ Downward API çš„æ—¶å€™ï¼Œä¼šä¸€ç›´æœ‰ç–‘é—®ï¼Œå…³äº pod èµ„æºçš„å…ƒæ•°æ®ï¼Œåœ¨å®¹å™¨ä¸­å¯ä»¥è·å–è¿è¡Œç¯å¢ƒçš„ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œæ¥äº¤æ¢æ¯”å¦‚DNSå’Œå½“å‰å®¹å™¨éœ€è¦ä¼ é€’çš„ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼„ä¸€å¥—æ¯”è¾ƒå¤æ‚çš„ Downward API ï¼Ÿ<br>è¿™é‡Œéšç€æ·±å…¥äº†è§£ï¼Œå…¶å®è§‰å¾—å…ƒæ•°æ®ç¡®å®åº”è¯¥å’Œ pod å¯¹è±¡è¿›è¡Œåˆ†ç¦»ï¼Œå› ä¸ºå®¹å™¨åœ¨æ„ŸçŸ¥ pod çš„ç¯å¢ƒå˜é‡çš„æ—¶å€™ï¼Œä¸€ä½†è¿è¡Œä¹‹åï¼Œå¦‚æœè¦æ„ŸçŸ¥åŒä¸€ä¸ª pod ä¸‹å¾—å…¶ä»–å®¹å™¨çš„å…ƒæ•°æ®å˜åŒ–æ˜¯éå¸¸å›°éš¾çš„ï¼Œä¸€ä¸ªå®¹å™¨åªèƒ½ä¼ é€’å®ƒè‡ªèº«èµ„æºç”³è¯·å’Œé™åˆ¶çš„ä¿¡æ¯ã€‚<br>è€Œ Downward API æ–¹å¼ç”¨å·çš„å®šä¹‰ï¼Œé¢å¯¹çš„æ˜¯ pod çº§åˆ«çš„ï¼Œè€Œä¸æ˜¯å®¹å™¨çº§åˆ«ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå®¹å™¨çš„èµ„æºå­—æ®µåˆ°å¦å¤–ä¸€ä¸ªå®¹å™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Downward API éœ€è¦å­˜åœ¨çš„ç†ç”±ã€‚","like_count":0},{"had_liked":false,"id":309559,"user_name":"çªçªå¤´","can_delete":false,"product_type":"c1","uid":1063866,"ip_address":"","ucode":"5C2635ED6484F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/ba/3b30dcde.jpg","comment_is_top":false,"comment_ctime":1630231026,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1630231026","product_id":100015201,"comment_content":"æ²¡æœ‰k8sçš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡æœåŠ¡å®šæ—¶å¿ƒè·³ä¸ŠæŠ¥ï¼Œçº¦å®šæ¥å£æˆ–æ–‡ä»¶é€šè¿‡å®šæ—¶ä»»åŠ¡å»è°ƒç”¨è¯»å–ï¼Œç„¶åè§£æç»“æœï¼Œk8sçš„æ¢æµ‹æœºåˆ¶ä¸çŸ¥é“æ˜¯å¦èƒ½æ»¡è¶³å¯¹æ£€æŸ¥æ¥å£ä¸­è¿”å›çš„å…·ä½“æŒ‡æ ‡è¿›è¡Œåˆ†æåˆ¤å®š","like_count":0},{"had_liked":false,"id":307686,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":1313963,"ip_address":"","ucode":"E0E655D048824A","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ab/cfbf16e4.jpg","comment_is_top":false,"comment_ctime":1629201048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629201048","product_id":100015201,"comment_content":"æå®¢æ—¶é—´è¿™ä¸ªwebç‰ˆæœ‰é—®é¢˜å•Šï¼Œå¥½å¤šå†…å®¹éƒ½æ²¡æ˜¾ç¤ºï¼Œä»¥ä¸ºä¸€ç« å°±ä¸€ç‚¹å†…å®¹","like_count":0},{"had_liked":false,"id":299060,"user_name":"limix","can_delete":false,"product_type":"c1","uid":1166614,"ip_address":"","ucode":"76401FF54AE0D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cd/16/981cc4f8.jpg","comment_is_top":false,"comment_ctime":1624444909,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624444909","product_id":100015201,"comment_content":"éå¸¸æ„Ÿè°¢ä½œè€…ç²¾å½©çš„è®²è§£ï¼Œä¸è¿‡æˆ‘æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰å¼„æ˜ç™½ã€‚å®¹å™¨çš„çŠ¶æ€æ£€æµ‹å’Œæ¢å¤ç­–ç•¥ï¼Œé€šè¿‡yamlæ¥è¿›è¡Œé…ç½®ï¼Œä¿å­˜åˆ°etcdå½“ä¸­ï¼Œè¿™æˆ‘ç†è§£ã€‚ä½†å…·ä½“çš„å®¹å™¨çš„çŠ¶æ€æ£€æµ‹å’Œå®¹å™¨çš„æ¢å¤è¿™äº›ç®¡ç†åŠŸèƒ½æ˜¯è°æ¥æ§åˆ¶çš„ï¼Ÿæ¢å¤æˆ‘ç†è§£å¯èƒ½æ˜¯ç”±æ§åˆ¶å™¨æ§åˆ¶çš„ï¼ŒçŠ¶æ€æ£€æµ‹åº”è¯¥æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæˆ‘çš„ç†è§£åŸºæœ¬æ˜¯çŒœæµ‹çš„","like_count":0},{"had_liked":false,"id":294558,"user_name":"ä¸“æ ç”¨æˆ·","can_delete":false,"product_type":"c1","uid":1212523,"ip_address":"","ucode":"3BC8EDBB04A40F","user_header":"https://static001.geekbang.org/account/avatar/00/12/80/6b/04457413.jpg","comment_is_top":false,"comment_ctime":1621999614,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621999614","product_id":100015201,"comment_content":"æˆ‘ä¸€ç›´æ²¡æ˜ç™½readinessæ¢é’ˆè®¾è®¡åŸåˆ™ï¼Œæ—¢ç„¶æ˜¯å½“åšå¯åŠ¨çš„æˆåŠŸçš„æ ‡å¿—ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰å®šæ—¶æ£€æŸ¥ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘æ£€æŸ¥åˆ°readinessæˆåŠŸåï¼Œä»–çš„ä½¿å‘½å°±åº”è¯¥æ˜¯å®Œæˆäº†çš„ã€‚ï¼‰ï¼Œå®šæ—¶æ£€æŸ¥å°±åº”è¯¥æ˜¯livenessæ‰€åšçš„äº‹æƒ…äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1105387,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","nickname":"lttzzlll","note":"","ucode":"FA160F7C02ABAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390779,"discussion_content":"æ˜¯çš„ã€‚å°±æ˜¯è¿™æ ·ã€‚readiness æ²¡æœ‰å®šæœŸæ£€æŸ¥å§ã€‚https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630045515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285623,"user_name":"å•æœ‹è£","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1616924267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616924267","product_id":100015201,"comment_content":"Project volumeçš„èƒ½åŠ›ï¼Œå’Œistio sidecarä¸€æ ·ï¼Œæ˜¯&quot;åŠ¨æ€å‡†å…¥æ§åˆ¶&quot;åŠŸèƒ½æä¾›çš„å—ï¼Œè¿˜æ˜¯api serverçš„æŸé¡¹èƒ½åŠ›ï¼Ÿ","like_count":0},{"had_liked":false,"id":255670,"user_name":"å¼ å°ç›Š","can_delete":false,"product_type":"c1","uid":1347798,"ip_address":"","ucode":"702BC860386C61","user_header":"https://static001.geekbang.org/account/avatar/00/14/90/d6/f806b648.jpg","comment_is_top":false,"comment_ctime":1603410515,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603410515","product_id":100015201,"comment_content":"æ²¡æœ‰startupProbe","like_count":0},{"had_liked":false,"id":253256,"user_name":"Action","can_delete":false,"product_type":"c1","uid":1239234,"ip_address":"","ucode":"FFFD1537C6BB3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/c2/77a413a7.jpg","comment_is_top":false,"comment_ctime":1602664137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602664137","product_id":100015201,"comment_content":"è€å¸ˆæˆ‘è®¾ç½®readinessProbeå¥åº·æ£€æŸ¥ï¼š<br>...<br>          - containerPort: 8050<br>          readinessProbe:<br>            httpGet:<br>              scheme: HTTP <br>              path: &#47;<br>              port: 8050<br>            initialDelaySeconds: 10<br>            periodSeconds: 3<br>.....<br>ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´æŠ¥é”™äº†ï¼Œè¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ<br> Readiness probe failed: Get http:&#47;&#47;172.17.53.5:8050&#47;: net&#47;http: request canceled (Client.Timeout exceeded while awaiting headers)","like_count":0},{"had_liked":false,"id":248182,"user_name":"éƒ­å°èœ","can_delete":false,"product_type":"c1","uid":1017297,"ip_address":"","ucode":"C4044C80BB331B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKYfcUOVhf3vhEBUNGHgtIcw8ujMZnkabicLzzjn3xwdeeic2PJSe7ibJgMx2UjF0d7L4B4gsRpaqe2A/132","comment_is_top":false,"comment_ctime":1600053414,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600053414","product_id":100015201,"comment_content":"çœ‹äº†æ–‡ç« ï¼Œç¨å¾®æ€»ç»“äº†ä¸‹ï¼š<br>1. ä¸€èˆ¬é…ç½®ä¿¡æ¯æ–‡ä»¶ä¼šä»¥ä»€ä¹ˆå½¢å¼åŠ å…¥åˆ° pod ä¸­ï¼Œå„è‡ªéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>2. åˆ›å»º Secret éƒ½æœ‰å“ªäº›æ–¹å¼ï¼Ÿ<br>3. Downward API éƒ½èƒ½å¤Ÿè·å–å“ªäº›ä¿¡æ¯ï¼Œæ˜¯å¦èƒ½å¤Ÿè·å–å®¹å™¨è¿›ç¨‹çš„ PIDï¼Ÿ<br>4. è¦å¦‚ä½•é™åˆ¶ Pod å†… container æ“ä½œ k8s APIï¼Ÿ<br>   1. Service Account æ˜¯ä¸€ä¸ª ç‰¹æ®Šçš„ Secret<br>5. ç®€è¿° livenessProbe å’Œ readinessProbe çš„ä½œç”¨å’ŒåŒºåˆ«ï¼Ÿ<br>6. ä¸€ä¸ª Pod å†…çš„ container å¦‚æœå‘ç”Ÿå¼‚å¸¸ä¼šå¯¼è‡´ä»€ä¹ˆæƒ…å†µï¼Ÿ<br>   1. ä¸€ä¸ªæ™®é€šçš„ Pod å‘ç”Ÿå¼‚å¸¸ï¼Œä¼šä¸ä¼šè¢« k8s è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå¦‚æœä¸è¡Œéœ€è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ","like_count":0},{"had_liked":false,"id":247498,"user_name":"æ¨","can_delete":false,"product_type":"c1","uid":1971269,"ip_address":"","ucode":"7EFEFE285975C6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/oltLEqTrmHm2aJP99BK6tHu5h7hp4aj08wR5Wt6H31iadFduDAVvjYKmhQ2nvGbLV3lkVdiat2GRasgWXoJeTibUg/132","comment_is_top":false,"comment_ctime":1599726772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599726772","product_id":100015201,"comment_content":"ç»“åˆè€å¸ˆè¿™ä¸ªè¯¾ç¨‹å»çœ‹kuboardé‡Œéœ€è¦å¡«å†™çš„å†…å®¹  ä»¥åŠåˆ›å»ºå®¹å™¨åçš„yamlç°åœ¨çŸ¥é“é‡Œé¢ç»å¤§éƒ¨åˆ†ä¸œè¥¿äº†<br>ï¼ˆè‡ªå·±æ­å»ºçš„1master2workerï¼‰","like_count":0},{"had_liked":false,"id":246764,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1599471822,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599471822","product_id":100015201,"comment_content":"ä¹‹å‰åˆ©ç”¨shellè„šæœ¬æ¥è¿›è¡Œè¿‡æ¢æµ‹,ä¹Ÿæ˜¯åˆ©ç”¨çš„å¥åº·ç›‘æµ‹æ¥å£,ä¸€æ—¦è¿”å›å€¼ä¸æ˜¯200,ç›´æ¥æ€æ­»è¿›ç¨‹,ç„¶åjava -jarå‘½ä»¤å°è¯•é‡å¯<br>","like_count":0},{"had_liked":false,"id":242859,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1597856460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597856460","product_id":100015201,"comment_content":"æœ‰äº†è¿™ä¸ªåŠŸèƒ½K8Så²‚ä¸æ˜¯æ— æ•Œäº†ï¼Ÿåªè¦å®¿ä¸»æœºä¸å€’ï¼ŒPodä¸­çš„åº”ç”¨å°±èƒ½ä¸å€’ï¼<br><br>åœ¨ Kubernetes ä¸­ï¼Œä½ å¯ä»¥ä¸º Pod é‡Œçš„å®¹å™¨å®šä¹‰ä¸€ä¸ªå¥åº·æ£€æŸ¥â€œæ¢é’ˆâ€ï¼ˆProbeï¼‰ã€‚è¿™æ ·ï¼Œkubelet å°±ä¼šæ ¹æ®è¿™ä¸ª Probe çš„è¿”å›å€¼å†³å®šè¿™ä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»¥å®¹å™¨è¿›è¡Œæ˜¯å¦è¿è¡Œï¼ˆæ¥è‡ª Docker è¿”å›çš„ä¿¡æ¯ï¼‰ä½œä¸ºä¾æ®ã€‚è¿™ç§æœºåˆ¶ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ä¿è¯åº”ç”¨å¥åº·å­˜æ´»çš„é‡è¦æ‰‹æ®µã€‚<br><br>Kubernetes é‡Œçš„ Pod æ¢å¤æœºåˆ¶ï¼Œä¹Ÿå« restartPolicyã€‚å®ƒæ˜¯ Pod çš„ Spec éƒ¨åˆ†çš„ä¸€ä¸ªæ ‡å‡†å­—æ®µï¼ˆpod.spec.restartPolicyï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ Alwaysï¼Œå³ï¼šä»»ä½•æ—¶å€™è¿™ä¸ªå®¹å™¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå®ƒä¸€å®šä¼šè¢«é‡æ–°åˆ›å»ºã€‚","like_count":0},{"had_liked":false,"id":241649,"user_name":"Geek_e0ee48","can_delete":false,"product_type":"c1","uid":1904256,"ip_address":"","ucode":"11D10A0F5892AB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIgDicRj9LAvWSejVc6v34R6dR1yRHzqBgEpABeRwDvNcpoFW6zmiavwV5cP1fCKJiaQPiafP9E7Puqnw/132","comment_is_top":false,"comment_ctime":1597378817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597378817","product_id":100015201,"comment_content":"è¿™ä¸ªä¸“æ çš„æ–‡ç« è¯»èµ·æ¥æœ‰ç§ä¹…æ—±é€¢ç”˜éœ–çš„æ„Ÿè§‰ã€‚æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œè®©äººèŒ…å¡é¡¿å¼€ï¼Œæ¬²ç½¢ä¸èƒ½ï¼Œæµ‘èº«èˆ’ç•…ã€‚éå¸¸æ„Ÿè§‰ä½œè€…ç»†è‡´å…¥å¾®çš„è®²è§£ã€‚","like_count":0},{"had_liked":false,"id":235151,"user_name":"ashen-one","can_delete":false,"product_type":"c1","uid":1123304,"ip_address":"","ucode":"F80F924DB220A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/e8/abd99392.jpg","comment_is_top":false,"comment_ctime":1594908958,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594908958","product_id":100015201,"comment_content":"æœ€åä¸€æ®µPodPreseté‡Œvolumeså’ŒvolumeMountä¸æ˜¯åŒä¸€å±‚çº§çš„ï¼ŒvolumeMountä¸Šæœ‰Containterï¼Œä¸ºä»€ä¹ˆPodPresetä¼šæŠŠå®ƒä»¬æ”¾åœ¨åŒä¸€çº§","like_count":0},{"had_liked":false,"id":227766,"user_name":"LH","can_delete":false,"product_type":"c1","uid":1211178,"ip_address":"","ucode":"819B9B2409E834","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg","comment_is_top":false,"comment_ctime":1592472889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592472889","product_id":100015201,"comment_content":"çœ‹ä¸€é å®è·µä¸€æ®µæ—¶é—´å†çœ‹ä¸€é æ•ˆæœä¼šå¾ˆå¥½","like_count":0},{"had_liked":false,"id":226747,"user_name":"æ™æœˆ520","can_delete":false,"product_type":"c1","uid":1845394,"ip_address":"","ucode":"4F05E02A5C1608","user_header":"https://static001.geekbang.org/account/avatar/00/1c/28/92/436735f5.jpg","comment_is_top":false,"comment_ctime":1592194021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592194021","product_id":100015201,"comment_content":"kubectl explain PodPreset<br>the server doesn&#39;t have a resource type &quot;PodPreset&quot;     è¿™ä¸ªæ˜¯å“ªä¸ªç‰ˆæœ¬çš„å•Š  1.15 åçš„æ²¡æœ‰è¿™ä¸ªäº†","like_count":0},{"had_liked":false,"id":224993,"user_name":"è®¸è‡»","can_delete":false,"product_type":"c1","uid":2019255,"ip_address":"","ucode":"DEF743E0C7F1B0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELuwZMDPDYbicYPBhib1fcNsMayPpXy5LfMzapALpyPyEFicLw1Ppf1sqlpiapIkPRVmVjRJwtfTjQuLg/132","comment_is_top":false,"comment_ctime":1591611189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591611189","product_id":100015201,"comment_content":"è€å¸ˆ æˆ‘ç”¨ kube-apiçš„ymal æ–‡ä»¶ apply - f æ–°å»ºäº†ä¸€ä¸ª apiserver çš„pod ä¸ºå•¥è€çš„ä¸€ç›´åˆ ä¸æ‰ ä¼šè‡ªå·±é‡å»ºã€‚æˆ‘æ˜¯minikubeç¯å¢ƒ ä¹Ÿæ²¡æœ‰deployment å‘€","like_count":0},{"had_liked":false,"id":219463,"user_name":"é‚‹é¢ç†Š","can_delete":false,"product_type":"c1","uid":1000257,"ip_address":"","ucode":"9B4732F85904D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/41/f7aa80e9.jpg","comment_is_top":false,"comment_ctime":1590028200,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590028200","product_id":100015201,"comment_content":"role: frontendè¿™ä¸ªåœ¨podpreseté‡Œæ˜¯æ ‡ç­¾ç­›é€‰å™¨ï¼Œä¹Ÿä¼šåœ¨podåˆ›å»ºçš„æ—¶å€™æ·»åŠ åˆ°podé‡Œä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":217930,"user_name":"æ…•å®¹","can_delete":false,"product_type":"c1","uid":1086319,"ip_address":"","ucode":"BEE694935853E1","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","comment_is_top":false,"comment_ctime":1589669259,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1589669259","product_id":100015201,"comment_content":"â€œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœè¿™ä¸ªå®¿ä¸»æœºå®•æœºäº†ï¼Œè¿™ä¸ª Pod ä¹Ÿä¸ä¼šä¸»åŠ¨è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»ã€‚&quot;<br><br>è€å¸ˆï¼Œæˆ‘æ²¡å¤ªç†è§£è¿™å¥è¯ï¼Œå¦‚æœå®¿ä¸»æœºå®•æœºéƒ½ä¸èƒ½è§¦å‘Podçš„è¿ç§»ï¼Œé‚£ä¹ˆå®ƒçš„å‰¯æœ¬æ•°å’Œå¯ç”¨æ€§ï¼ˆå‡è®¾å°±è®¾ç½®ä¸€ä¸ªå‰¯æœ¬ï¼‰å¦‚ä½•ä¿è¯å‘¢ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1994572,"avatar":"","nickname":"Geek_2b4a91","note":"","ucode":"242A32ED80C420","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270654,"discussion_content":"æ‰€ä»¥ç”Ÿäº§ç¯å¢ƒè¦ç”¨deploymentæ§åˆ¶å™¨æ¥åˆ›å»ºpodå‘€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590032799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1086319,"avatar":"https://static001.geekbang.org/account/avatar/00/10/93/6f/5ab3da19.jpg","nickname":"æ…•å®¹","note":"","ucode":"BEE694935853E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1994572,"avatar":"","nickname":"Geek_2b4a91","note":"","ucode":"242A32ED80C420","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279721,"discussion_content":"è°¢è°¢ï¼Œåæ¥çœ‹ç¬¬äºŒéæ˜ç™½äº†ã€‚èµ·åˆæŠŠè¿™é‡Œçš„podææ··æˆæ§åˆ¶å™¨äº†ï¼Œå›§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591404954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":270654,"ip_address":""},"score":279721,"extra":""}]}]},{"had_liked":false,"id":211157,"user_name":"~å°˜æ›¦~","can_delete":false,"product_type":"c1","uid":1175695,"ip_address":"","ucode":"BFA7E7DBD9047B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/8f/ca9fded0.jpg","comment_is_top":false,"comment_ctime":1587906574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587906574","product_id":100015201,"comment_content":"é—®ä¸€ä¸‹åœ¨1.16ç‰ˆæœ¬åpodé‡Œæ·»åŠ çš„ä¸´æ—¶å®¹å™¨ç”Ÿå‘½å‘¨æœŸæ€ä¹ˆç®¡ç†ï¼Ÿ","like_count":0},{"had_liked":false,"id":210639,"user_name":"uni","can_delete":false,"product_type":"c1","uid":1643252,"ip_address":"","ucode":"38DFFAC10A7991","user_header":"https://static001.geekbang.org/account/avatar/00/19/12/f4/d1ed8885.jpg","comment_is_top":false,"comment_ctime":1587801184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587801184","product_id":100015201,"comment_content":"å¦‚æœpodä¸­æœ‰å¤šä¸ªå®¹å™¨ï¼Œprepod å¦‚ä½•åªç»™å…¶ä¸­ä¸€ä¸ªå®¹å™¨æ·»åŠ æŒ‚è½½ç‚¹å‘¢","like_count":0},{"had_liked":false,"id":205365,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1586598943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586598943","product_id":100015201,"comment_content":"çœ‹ä¸¤éæ‰ç†è§£çš„å¤šä¸€äº›ã€‚å¥½æ•™ç¨‹ï¼Œæ‰“å¡ã€‚","like_count":0},{"had_liked":false,"id":202174,"user_name":"ç™½å·§å…‹åŠ›","can_delete":false,"product_type":"c1","uid":1712018,"ip_address":"","ucode":"91628875D8C0F8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1f/92/4d56ff21.jpg","comment_is_top":false,"comment_ctime":1585917108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585917108","product_id":100015201,"comment_content":"è€å¸ˆå¥½ æˆ‘åœ¨æµ‹è¯•downwardapiçš„æ—¶å€™ å‘ç°æåˆ°çš„ status.hostIP é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼è·å¾—æ²¡æœ‰é—®é¢˜ ä½†æ˜¯ä¸€æ—¦å†™åœ¨ volumeséƒ¨åˆ† k8s 1.15å°±ä¸è®¤è¯†å®ƒã€‚è¿™ä¸ªæ˜¯æœ‰ä»€ä¹ˆé™åˆ¶ä¹ˆ","like_count":0},{"had_liked":false,"id":189941,"user_name":"tk103331","can_delete":false,"product_type":"c1","uid":1060819,"ip_address":"","ucode":"221F935D7AF3BB","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/d3/d97c5993.jpg","comment_is_top":false,"comment_ctime":1584584412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584584412","product_id":100015201,"comment_content":"å½“ç„¶ï¼Œè€ƒè™‘åˆ°è‡ªåŠ¨æŒ‚è½½é»˜è®¤ ServiceAccountToken çš„æ½œåœ¨é£é™©ï¼ŒKubernetes å…è®¸ä½ è®¾ç½®é»˜è®¤ä¸ä¸º Pod é‡Œçš„å®¹å™¨è‡ªåŠ¨æŒ‚è½½è¿™ä¸ª Volumeã€‚<br><br>è¿™ä¸ªåœ¨å“ªé‡Œæ”¹","like_count":0},{"had_liked":false,"id":189776,"user_name":"zackery","can_delete":false,"product_type":"c1","uid":1052282,"ip_address":"","ucode":"92D737D6773855","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/7a/ab527628.jpg","comment_is_top":false,"comment_ctime":1584547990,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584547990","product_id":100015201,"comment_content":"è¯·é—®è€å¸ˆï¼ŒProjected Volume åœ¨å®¹å™¨å±‚é¢æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":171578,"user_name":"ä¿¡äº†","can_delete":false,"product_type":"c1","uid":1368648,"ip_address":"","ucode":"EA188A1DD1D390","user_header":"https://static001.geekbang.org/account/avatar/00/14/e2/48/6c066714.jpg","comment_is_top":false,"comment_ctime":1578968062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578968062","product_id":100015201,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆkubernet çš„YAML æ–‡ä»¶çš„å‚æ•°æœ‰çš„åŠ äº†-ï¼Œæœ‰çš„å°±æ²¡åŠ ï¼Œæœ‰ä»€ä¹ˆè®²ç©¶å—","like_count":0},{"had_liked":false,"id":136154,"user_name":"å¤©è‹¥æœ‰æƒ…å¤©äº¦è€","can_delete":false,"product_type":"c1","uid":1172029,"ip_address":"","ucode":"57F0B7D524C0CF","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/3d/9a52946b.jpg","comment_is_top":false,"comment_ctime":1569374461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569374461","product_id":100015201,"comment_content":"healthcheckæ¥å£","like_count":0},{"had_liked":false,"id":120546,"user_name":"æººæ°´çš„é±¼","can_delete":false,"product_type":"c1","uid":1019872,"ip_address":"","ucode":"B3FF29649B387C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/e0/54391c08.jpg","comment_is_top":false,"comment_ctime":1564926796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564926796","product_id":100015201,"comment_content":"readiness failedä¸ä¼šå¼•å‘podé‡å»ºå§ï¼Ÿ","like_count":0},{"had_liked":false,"id":119436,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1564587163,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564587163","product_id":100015201,"comment_content":"deploymentå¯¹è±¡å’ŒPodå¯¹è±¡éƒ½å¯ä»¥åˆ›å»ºpodï¼Œä¸¤è€…åŒºåˆ«é™¤äº†æ–‡ä¸­è®²åˆ°çš„podä»½æ•°å’Œè°ƒåº¦å¤–ï¼Œè¿˜æœ‰å“ªäº›åŒºåˆ«ï¼Ÿå®é™…ç”Ÿäº§ä¸­ä¸¤è€…çš„åœºæ™¯åˆ’åˆ†æ˜¯æ€ä¹ˆå®šçš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":112520,"user_name":"æ— æƒ…å‰ƒåˆ€","can_delete":false,"product_type":"c1","uid":1436126,"ip_address":"","ucode":"7CA85164B797B4","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/de/0d632855.jpg","comment_is_top":false,"comment_ctime":1562750752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562750752","product_id":100015201,"comment_content":"è€å¸ˆ kubectl create -f test-liveness-exec.yaml æ²¡æœ‰é‡å¯æ˜¯æ€ä¹ˆå›äº‹<br>Events:<br>  Type     Reason     Age                            From                Message<br>  ----     ------     ----                           ----                -------<br>  Normal   Scheduled  12m                            default-scheduler   Successfully assigned default&#47;test-liveness-exec to k8s-node1<br>  Normal   Pulled     &lt;invalid&gt;                      kubelet, k8s-node1  Successfully pulled image &quot;busybox&quot;<br>  Normal   Created    &lt;invalid&gt;                      kubelet, k8s-node1  Created container liveness<br>  Normal   Started    &lt;invalid&gt;                      kubelet, k8s-node1  Started container liveness<br>  Warning  Unhealthy  &lt;invalid&gt; (x3 over &lt;invalid&gt;)  kubelet, k8s-node1  Liveness probe failed: cat: can&#39;t open &#39;&#47;tmp&#47;healthy&#39;: No such file or directory<br>  Normal   Killing    &lt;invalid&gt;                      kubelet, k8s-node1  Container liveness failed liveness probe, will be restarted<br>  Normal   Pulling    &lt;invalid&gt; (x2 over &lt;invalid&gt;)  kubelet, k8s-node1  Pulling image &quot;busybox&quot;<br>","like_count":0},{"had_liked":false,"id":112405,"user_name":"tangzc1","can_delete":false,"product_type":"c1","uid":1311254,"ip_address":"","ucode":"78CB596D2F33DC","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","comment_is_top":false,"comment_ctime":1562729242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562729242","product_id":100015201,"comment_content":"1.å¥åº·æ¢æµ‹ä¾‹å­ï¼Œå½“Container liveness failedä¹‹åpodçŠ¶æ€æ˜¯CrashLoopBackOffï¼ŒæŸ¥äº†ä¸‹ä»£è¡¨â€œKubernetes æ­£åœ¨å°½åŠ›å¯åŠ¨è¿™ä¸ª Podï¼Œå› ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å·²ç»æŒ‚äº†ï¼Œæˆ–è€…æ­£è¢«åˆ é™¤â€ä¹Ÿä¸æ°¸è¿œæ˜¯runingã€‚<br>2.kubectl exec [podname] -- &#47;bin&#47;sh   è¿™ä¸ªå‘½ä»¤å¦‚æœæ˜¯å¤šå®¹å™¨podï¼Œç©¶ç«Ÿè¿›å…¥çš„æ˜¯å“ªä¸ªå®¹å™¨çš„rootfså‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":98038,"user_name":"äºŒè¿›åˆ¶å‚»ç“œ","can_delete":false,"product_type":"c1","uid":1073261,"ip_address":"","ucode":"FA8E76339CF512","user_header":"https://static001.geekbang.org/account/avatar/00/10/60/6d/3c2a5143.jpg","comment_is_top":false,"comment_ctime":1558880976,"is_pvip":true,"replies":[{"id":"36304","content":"å¤šçœ‹å‡ é","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1559619451,"ip_address":"","comment_id":98038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558880976","product_id":100015201,"comment_content":"ä¿¡æ¯é‡å¤ªå¤§äº†ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451528,"discussion_content":"å¤šçœ‹å‡ é","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559619451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95230,"user_name":"tuyu","can_delete":false,"product_type":"c1","uid":1448863,"ip_address":"","ucode":"B235325B541408","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/BIRpwViaN51yynIeFonD7QRlwDCVtKibrG956NTxzEqibOZZVjhMMgibOPmd3VicfYxpknZsic1oJq8KicZvXkmmiajuQg/132","comment_is_top":false,"comment_ctime":1557993378,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557993378","product_id":100015201,"comment_content":"è€å¸ˆ,å°±æ˜¯åœ¨è®²livenessçš„æ—¶å€™,å¯åŠ¨å®¹å™¨çš„argsçš„å‰ä¸¤ä¸ªå‚æ•°æ˜¯ -&#47;bin&#47;sh å’Œ - -cã€‚ä¸ºå•¥ä¸èƒ½æ‰§è¡Œtouch &#47;tmp&#47;healthyã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸç†å‘¢","like_count":0},{"had_liked":false,"id":85578,"user_name":"Ò‰","can_delete":false,"product_type":"c1","uid":1130004,"ip_address":"","ucode":"97EFF35344F754","user_header":"https://static001.geekbang.org/account/avatar/00/11/3e/14/f844ecca.jpg","comment_is_top":false,"comment_ctime":1555131146,"is_pvip":false,"replies":[{"id":"31576","content":"å¤§é‡çš„ä¿®æ”¹ï¼Œè¿˜æ˜¯å»ºè®®å†™admission hook","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1555697390,"ip_address":"","comment_id":85578,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555131146","product_id":100015201,"comment_content":"podpreset æ”¯æŒçš„å‚æ•°å¤ªå°‘äº†ã€‚<br><br>nodeSelector ã€affinity è¿™ç§å¥½åƒéƒ½æ²¡æœ‰ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446720,"discussion_content":"å¤§é‡çš„ä¿®æ”¹ï¼Œè¿˜æ˜¯å»ºè®®å†™admission hook","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555697390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83667,"user_name":"æ˜¥å’Œæ™¯æ˜","can_delete":false,"product_type":"c1","uid":1272482,"ip_address":"","ucode":"A27970A276ECD6","user_header":"https://static001.geekbang.org/account/avatar/00/13/6a/a2/f9efd9dc.jpg","comment_is_top":false,"comment_ctime":1554694287,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1554694287","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæˆ‘ç”¨ä¸‹é¢çš„dockerfileåˆ¶ä½œå‡ºæ¥çš„é•œåƒå¯åŠ¨podã€‚å‘ç°podä¸­çš„&#47;home&#47;jenkinsä¸‹é¢æ²¡æœ‰.pipæ–‡ä»¶å¤¹ï¼Œè€Œ&#47;varä¸­æ˜¯æœ‰.pipæ–‡ä»¶å¤¹çš„ã€‚<br><br>æˆ‘çš„é—®é¢˜æ˜¯åœ¨podå¯åŠ¨æ—¶ï¼Œä¼šå¯¹å®¶ç›®å½•æœ‰ç‰¹åˆ«æ“ä½œå—ï¼Ÿ<br><br>1 FROM jenkins&#47;jnlp-slave<br>  2<br>  3 LABEL maintainer=&quot;sqe&quot;<br>  4<br>  5 USER root<br>  6<br>  7 ENV PYTHON_VERSION 3.5<br>  8<br>  9 RUN apt-get update \\<br> 10     &amp;&amp; apt-get dist-upgrade -y \\<br> 11     &amp;&amp; apt-get -y install python${PYTHON_VERSION} \\<br> 12        libffi-dev \\<br> 13        libpq-dev \\<br> 14        libssl-dev \\<br> 15        python3-dev \\<br> 16        python3-pip \\<br> 17        python3-setuptools \\<br> 18        python3-venv \\<br> 19        python3-wheel \\<br> 20        build-essential \\<br> 21        docker \\<br> 22     &amp;&amp; rm -rf &#47;var&#47;lib&#47;apt&#47;lists&#47;* \\<br> 23     &amp;&amp; ln -nsf &#47;usr&#47;bin&#47;python${PYTHON_VERSION} &#47;usr&#47;bin&#47;python<br> 24 RUN pip3 install pipenv<br> 25<br> 26 ADD pip.conf &#47;home&#47;jenkins&#47;.pip&#47;pip.conf<br> 27 ADD pip.conf &#47;var&#47;.pip&#47;pip.conf<br> 28 RUN chown -R jenkins:jenkins &#47;home&#47;jenkins&#47;.pip&#47;<br> 29 RUN chown -R jenkins:jenkins &#47;var&#47;.pip&#47;<br> 30<br> 31 USER jenkins","like_count":0},{"had_liked":false,"id":80836,"user_name":"å°çŒª","can_delete":false,"product_type":"c1","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1553740527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553740527","product_id":100015201,"comment_content":"è€å¸ˆèƒ½è®²è§£ä¸€ä¸‹kubernetesçš„masterèŠ‚ç‚¹çš„é«˜å¯ç”¨éƒ¨ç½²å—ï¼Ÿå¦‚ä½•åšåˆ°å®•æœºä¸€ä¸¤å°ç‰©ç†æœºï¼Œä¸å½±å“kubernetesé›†ç¾¤çš„è¿è¡Œï¼Ÿ","like_count":0},{"had_liked":false,"id":77653,"user_name":"æ°é­","can_delete":false,"product_type":"c1","uid":1169775,"ip_address":"","ucode":"D9E4AC416F793E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/6f/553aeb40.jpg","comment_is_top":false,"comment_ctime":1552978677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552978677","product_id":100015201,"comment_content":"å“ˆå“ˆï¼Œç²¾å½©","like_count":0},{"had_liked":false,"id":71782,"user_name":"å½¦","can_delete":false,"product_type":"c1","uid":1125048,"ip_address":"","ucode":"13EE4093C488A5","user_header":"https://static001.geekbang.org/account/avatar/00/11/2a/b8/edbafb82.jpg","comment_is_top":false,"comment_ctime":1551431354,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1551431354","product_id":100015201,"comment_content":"è¯·é—®é€šè¿‡ServiceAccountæˆæƒçš„æ–¹å¼è°ƒç”¨Kubernetes APIï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯è°ƒç”¨masterèŠ‚ç‚¹ä¸Škube-apiserveræš´éœ²çš„API?","like_count":0,"discussions":[{"author":{"id":2853149,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/89/1d/d1d8edcc.jpg","nickname":"æ¢…æ–Œ","note":"","ucode":"DDE15A3FD12738","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545141,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641864446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1601,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562726290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59623,"user_name":"å¢å½¦å‡","can_delete":false,"product_type":"c1","uid":1175402,"ip_address":"","ucode":"AD695652062B66","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/6a/fdb4e298.jpg","comment_is_top":false,"comment_ctime":1547393202,"is_pvip":false,"replies":[{"id":"22071","content":"å®¹å™¨çš„net namespace æ˜¯shareçš„ï¼Œä¸€ä¸ªpodä¸€ä»½","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1548054043,"ip_address":"","comment_id":59623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547393202","product_id":100015201,"comment_content":"æ–‡ä¸­æœ‰ä¸ªåœ°æ–¹æ˜¯å¦å†™é”™äº†ï¼Ÿ<br>â€œæ‰€ä»¥ï¼Œä½ çš„ Pod å…¶å®å¯ä»¥æš´éœ²ä¸€ä¸ªå¥åº·æ£€æŸ¥ URLï¼ˆæ¯”å¦‚ &#47;healthzï¼‰ã€‚ã€‚ã€‚â€<br>åº”è¯¥æ˜¯å®¹å™¨åº”ç”¨æš´éœ²ä¸€ä¸ªurlï¼Œè€Œä¸æ˜¯Podå§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436370,"discussion_content":"å®¹å™¨çš„net namespace æ˜¯shareçš„ï¼Œä¸€ä¸ªpodä¸€ä»½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548054043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55584,"user_name":"æŸ¯å¯Ÿé‡‘","can_delete":false,"product_type":"c1","uid":1115149,"ip_address":"","ucode":"F722BF8FCD2C47","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg","comment_is_top":false,"comment_ctime":1546237050,"is_pvip":false,"replies":[{"id":"20145","content":"åé¢è®²Jobå•Š","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1546385202,"ip_address":"","comment_id":55584,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546237050","product_id":100015201,"comment_content":"èƒ½ä¸èƒ½ç»™ä¸€ä¸ªä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå°±é€€å‡ºçš„ç¤ºä¾‹","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434805,"discussion_content":"åé¢è®²Jobå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546385202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47061,"user_name":"ä¸¹æ¸…","can_delete":false,"product_type":"c1","uid":1178681,"ip_address":"","ucode":"9FA4CA3CBF2847","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/39/8ce41759.jpg","comment_is_top":false,"comment_ctime":1544027239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544027239","product_id":100015201,"comment_content":"liveness probeæ˜¯ç±»ä¼¼ä½¿ç”¨kubectl exec test-liveness-exec -- &#47;bin&#47;sh<br>è¿›å…¥å®¹å™¨å,æ‰§è¡Œç›¸åº”çš„å‘½ä»¤,cat dir ,æ ¹æ®è¿”å›å€¼ä¼šåˆ¤æ–­å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œå—<br><br>","like_count":0},{"had_liked":false,"id":40095,"user_name":"hpfish","can_delete":false,"product_type":"c1","uid":1217377,"ip_address":"","ucode":"86DB066E5B6D89","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/61/3e4607c7.jpg","comment_is_top":false,"comment_ctime":1542476617,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1542476617","product_id":100015201,"comment_content":"è¦ä½¿ç”¨PodPresetè¿˜è¦å…ˆåœ¨kube-apiserveré‡Œå¼€å¯<br>--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,PodPreset<br><br>--runtime-config=rbac.authorization.k8s.io&#47;v1alpha1=true,settings.k8s.io&#47;v1alpha1=true","like_count":0,"discussions":[{"author":{"id":2019255,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELuwZMDPDYbicYPBhib1fcNsMayPpXy5LfMzapALpyPyEFicLw1Ppf1sqlpiapIkPRVmVjRJwtfTjQuLg/132","nickname":"è®¸è‡»","note":"","ucode":"DEF743E0C7F1B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":280718,"discussion_content":"å¦‚ä½•è®¾ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591605153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39614,"user_name":"è¯šä¿¡é«˜æ•ˆ","can_delete":false,"product_type":"c1","uid":1219329,"ip_address":"","ucode":"003CD60A0D0BF7","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/01/f100d827.jpg","comment_is_top":false,"comment_ctime":1542328737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542328737","product_id":100015201,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®å•èŠ‚ç‚¹æœ€å¤šå¯éƒ¨ç½²å¤šå°‘ä¸ªå®¹å™¨ï¼Ÿé™¤äº†å’Œç‰©ç†æœºèµ„æºæœ‰å…³ï¼Œè¿˜å’Œä»€ä¹ˆæœ‰å…³ï¼Ÿ","like_count":0},{"had_liked":false,"id":36771,"user_name":"å°è°¢åŒå­¦","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1541319407,"is_pvip":false,"replies":[{"id":"13030","content":"æ˜¾ç„¶ä¸èƒ½ã€‚åé¢ä¼šè®²åˆ°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541338446,"ip_address":"","comment_id":36771,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541319407","product_id":100015201,"comment_content":"è¯·é—®yamlæ–‡ä»¶å¼€å¤´çš„apiversion æ˜¯èµ·ä»€ä¹ˆä½œç”¨çš„ï¼Ÿå¯ä»¥éšä¾¿å†™ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428009,"discussion_content":"æ˜¾ç„¶ä¸èƒ½ã€‚åé¢ä¼šè®²åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541338446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35152,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1224388,"ip_address":"","ucode":"165B65317A7B3D","user_header":"https://static001.geekbang.org/account/avatar/00/12/ae/c4/806fd588.jpg","comment_is_top":false,"comment_ctime":1540438924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540438924","product_id":100015201,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<br>secretå’Œconfig-mapå¦‚æœè¦æŠŠæ–‡ä»¶åŠ å…¥åˆ°å¯¹è±¡ä¸­ï¼Œæ˜¯å¦åªèƒ½é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼ä»¥--from-file=å‚æ•°æ¥åˆ›å»ºäº†ï¼Ÿå¦å¤–å¦‚ä½•å¯¹ä¸€ä¸ªå·²å­˜åœ¨çš„secretå’Œconfigmapå¯¹è±¡è¿½åŠ é…ç½®æˆ–secretç›¸å…³çš„æ–‡ä»¶è¿›å»å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":35149,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1224388,"ip_address":"","ucode":"165B65317A7B3D","user_header":"https://static001.geekbang.org/account/avatar/00/12/ae/c4/806fd588.jpg","comment_is_top":false,"comment_ctime":1540437929,"is_pvip":false,"replies":[{"id":"12529","content":"æ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸æ­£å¸¸","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540439624,"ip_address":"","comment_id":35149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540437929","product_id":100015201,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸¤ä¸ªå°é—®é¢˜<br>1ã€æˆ‘åœ¨å®è·µçš„æ—¶å€™å‘ç°podå¯åŠ¨åï¼Œå®¹å™¨é‡ŒæŒ‚è½½çš„åªæœ‰serviceaccountçš„token,caå’Œcertæ–‡ä»¶å¹¶æœªæœ‰åŠ è½½(é›†ç¾¤ç‰ˆæœ¬æ˜¯1.10ï¼Œæ˜¯æ‰‹åŠ¨ä¸€ä¸ªä¸ªç»„ä»¶éƒ¨ç½²é…ç½®å¯åŠ¨çš„ï¼Œå½“å‰å¹¶æœªä½¿ç”¨å®‰å…¨æ¥å£å¯åŠ¨)ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccountä¸å­˜åœ¨caå’Œcertæ–‡ä»¶æ˜¯æ­£å¸¸çš„å—ï¼Ÿ<br><br>2ã€ç”±äº#1ï¼Œè¿™ä½¿å¾—åœ¨å¯åŠ¨kubednså’Œdashboardæ—¶éƒ½åªèƒ½æŒ‡å®šmaster-urlæ¥è¿æ¥ï¼Œä¸ç„¶å®¹å™¨å°±ä¼šæŠ¥é”™é€€å‡ºã€‚è¿™æ˜¯å› ä¸ºkubednså’Œdashboardè¿™äº›ç¨‹åºéƒ½æ˜¯æŒ‰æ‚¨è¯´çš„é»˜è®¤ä½¿ç”¨kubernetes å®˜æ–¹åŸç”Ÿçš„clientï¼Œæ‰€ä»¥é»˜è®¤è‡ªåŠ¨å¯ç”¨å®‰å…¨è¿æ¥è¯»å–&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccountä¸‹çš„caå’Œcertæ–‡ä»¶å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427463,"discussion_content":"æ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸æ­£å¸¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540439624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33563,"user_name":"jimmy","can_delete":false,"product_type":"c1","uid":1112872,"ip_address":"","ucode":"43FC90AF9582DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/28/eec9220b.jpg","comment_is_top":false,"comment_ctime":1539825869,"is_pvip":false,"replies":[{"id":"12082","content":"åŠ è¾…åŠ©å®¹å™¨å•Š","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539850659,"ip_address":"","comment_id":33563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539825869","product_id":100015201,"comment_content":"è·å– Pod å®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯ï¼Œä½¿ç”¨sidecarï¼Œè¿™ä¸ªä¸å¤ªç†è§£ï¼Œåœ¨podé‡Œå¢åŠ ä¸€ä¸ªè¾…åŠ©å®¹å™¨ï¼Ÿæ€ä¹ˆè·å–Pod å®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426997,"discussion_content":"åŠ è¾…åŠ©å®¹å™¨å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539850659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33284,"user_name":"å¤šè‚‰","can_delete":false,"product_type":"c1","uid":1228219,"ip_address":"","ucode":"EF0805E34339D6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJicBibF1UEOAhicickjCRXzVBDDyAMTw5C7EP3IPSKyTqWjvtmicB4AFu0B72BVyxFAVnNHrbx672p2Ow/132","comment_is_top":false,"comment_ctime":1539771229,"is_pvip":false,"replies":[{"id":"12037","content":"è¿™æ²¡æ¯›ç—…å•Šï¼Œç”¨æ–‡ä»¶åˆ›å»ºå°±æ˜¯è¿™ä¸ªæ•ˆæœ","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539783835,"ip_address":"","comment_id":33284,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1539771229","product_id":100015201,"comment_content":"è¯·é—®ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„å®¹å™¨ç›®å½•ä¸­å¾—åˆ°å¾—æ–‡ä»¶æ˜¯ .txtæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ–‡ç« ä¸­æ‰€è¯´å¾—userå’Œpasså‘¢ï¼Ÿ<br>root@test-projected-volume:&#47;# ls &#47;project-volume&#47;<br>password.txt username.txt<br>æˆ‘secretsæ˜¯å®‰è£…æ ¹æ®username.txtæ–‡ä»¶åˆ›å»ºå¾—adminå’Œpass secretså¯¹è±¡","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426961,"discussion_content":"è¿™æ²¡æ¯›ç—…å•Šï¼Œç”¨æ–‡ä»¶åˆ›å»ºå°±æ˜¯è¿™ä¸ªæ•ˆæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539783835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1606,"discussion_content":"ç”¨æ–‡ä»¶åˆ›å»ºçš„å°±æ˜¯abc.txtï¼Œç”¨yamlåˆ›å»ºçš„å°±æ˜¯abc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562727235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1105387,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","nickname":"lttzzlll","note":"","ucode":"FA160F7C02ABAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311254,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/16/6fe3fe44.jpg","nickname":"tangzc1","note":"","ucode":"78CB596D2F33DC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390780,"discussion_content":"soga.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630045693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1606,"ip_address":""},"score":390780,"extra":""}]}]},{"had_liked":false,"id":32476,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1223046,"ip_address":"","ucode":"61CFE863E8E6D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/86/8211935c.jpg","comment_is_top":false,"comment_ctime":1539585537,"is_pvip":false,"replies":[{"id":"11846","content":"ç¼©è¿›é—®é¢˜ã€‚éº»çƒ¦ç¼–è¾‘ç»™æ”¹ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539591358,"ip_address":"","comment_id":32476,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539585537","product_id":100015201,"comment_content":"æ–‡ä¸­Download api çš„ymlæ–‡ä»¶å¥½åƒæœ‰é—®é¢˜ï¼Œåˆ›å»ºä¼šæŠ¥é”™<br>error: error validating &quot;downloadapi-volume.yaml&quot;: error validating data: ValidationError(Pod.spec.volumes[0].projected.sources[0]): unknown field &quot;items&quot; in io.k8s.api.core.v1.VolumeProjection; if you choose to ignore these errors, turn validation off with --validate=false<br><br>çœ‹äº†å®˜æ¡£è¦è¿™æ ·æ‰èƒ½åˆ›å»ºæˆæœ<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: test-downwardapi-volume<br>  labels:<br>    zone: us-est-coast<br>    cluster: test-cluster1<br>    rack: rack-22<br>spec:<br>  containers:<br>    - name: client-container<br>      image: k8s.gcr.io&#47;busybox<br>      command: [&quot;sh&quot;, &quot;-c&quot;]<br>      args:<br>      - while true; do<br>          if [[ -e &#47;etc&#47;podinfo&#47;labels ]]; then<br>            echo -en &#39;\\n\\n&#39;; cat &#47;etc&#47;podinfo&#47;labels; fi;<br>          sleep 5;<br>        done;<br>      volumeMounts:<br>        - name: podinfo<br>          mountPath: &#47;etc&#47;podinfo<br>          readOnly: false<br>  volumes:<br>    - name: podinfo<br>      downwardAPI:<br>        items:<br>          - path: &quot;labels&quot;<br>            fieldRef:<br>              fieldPath: metadata.labels<br><br><br>ä¸çŸ¥é“è¯´çš„æ˜¯ä¸æ˜¯å¯¹çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426786,"discussion_content":"ç¼©è¿›é—®é¢˜ã€‚éº»çƒ¦ç¼–è¾‘ç»™æ”¹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539591358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31959,"user_name":"Yiliu","can_delete":false,"product_type":"c1","uid":1068884,"ip_address":"","ucode":"2CF20B138244B7","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/54/552bde40.jpg","comment_is_top":false,"comment_ctime":1539342927,"is_pvip":false,"replies":[{"id":"11565","content":"ä¸æ˜¯ï¼Œåé¢ä¼šè®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539357109,"ip_address":"","comment_id":31959,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539342927","product_id":100015201,"comment_content":"istioçš„è‡ªåŠ¨æ·»åŠ sidecaræ˜¯ä¸æ˜¯å°±æ˜¯ç”¨çš„preset","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426582,"discussion_content":"ä¸æ˜¯ï¼Œåé¢ä¼šè®²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539357109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28283,"user_name":"vx:jiancheng_goon","can_delete":false,"product_type":"c1","uid":1218615,"ip_address":"","ucode":"FD34901B061825","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/37/7f575aec.jpg","comment_is_top":false,"comment_ctime":1538041316,"is_pvip":false,"replies":[{"id":"10172","content":"ä¸æ˜¯ï¼Œkubernetes çš„client library ","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538049639,"ip_address":"","comment_id":28283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538041316","product_id":100015201,"comment_content":"k8s clientæŒ‡çš„æ˜¯kubectlå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425212,"discussion_content":"ä¸æ˜¯ï¼Œkubernetes çš„client library ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538049639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28222,"user_name":"Sun Fei","can_delete":false,"product_type":"c1","uid":1032631,"ip_address":"","ucode":"092EC0992050BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/b7/57f153f6.jpg","comment_is_top":false,"comment_ctime":1538025474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538025474","product_id":100015201,"comment_content":"ä»å¼€å§‹åˆ°ç°åœ¨ï¼Œæ”¶è·å¾ˆå¤šï¼Œè°¢è°¢dalao","like_count":0},{"had_liked":false,"id":28219,"user_name":"åŒ—å¡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1538024574,"is_pvip":false,"replies":[{"id":"10152","content":"å¯¹çš„ã€‚è¿™ç¯‡æ–‡ç« çš„é¢˜ç›®ä¸å°±æ˜¯æ·±å…¥è§£æpodå¯¹è±¡å˜›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538041567,"ip_address":"","comment_id":28219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538024574","product_id":100015201,"comment_content":"deploymentåˆ›å»ºçš„podåªæ”¯æŒrestart awaysï¼Œæ˜¯ä¸ºäº†è®©podä¿å­˜å§‹ç»ˆå‡ºäºé¢„æœŸè¿è¡ŒçŠ¶æ€çš„æ¦‚å¿µå—?<br>æ‰€æœ‰æ–‡ç« ä¸­å†™çš„podçš„å„ç§é‡å¯æ–¹å¼ï¼Œæ˜¯ä¸“é—¨æŒ‡å•ç‹¬åˆ›å»ºpodçš„æƒ…å†µä¸‹?<br><br>æå®¢æ—¶é—´ä¸èƒ½ç›´æ¥å›å¤ä½œè€…çš„å›å¤å¥½éº»çƒ¦å•Šå“ˆå“ˆå“ˆï¼Œæ„Ÿè§‰äº¤æµä¼šæ–­æ‰ã€‚<br>è°¢è°¢å¼ ç£Šä¸€ç›´éƒ½åœ¨ä¿æŒå›å¤ï¼Œæ•™ç¨‹å¤ªæ£’äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425183,"discussion_content":"å¯¹çš„ã€‚è¿™ç¯‡æ–‡ç« çš„é¢˜ç›®ä¸å°±æ˜¯æ·±å…¥è§£æpodå¯¹è±¡å˜›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538041567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27928,"user_name":"åŒ…å­","can_delete":false,"product_type":"c1","uid":1089345,"ip_address":"","ucode":"6CC4EBB8CD3924","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/41/82306dfe.jpg","comment_is_top":false,"comment_ctime":1537967088,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537967088","product_id":100015201,"comment_content":"å¥åº·æ€§æ£€æŸ¥æ¢é’ˆä¸å»ºè®®å¼€å‘æµ‹è¯•ç¯å¢ƒä½¿ç”¨å§ï¼Œå®¹å™¨ä¸€é‡å¯ï¼Œä¿¡æ¯å…¨æ²¡äº†ã€‚ä¹‹å‰å¼€å¯è¿‡ï¼Œåæ¥ç»™å…³äº†ğŸ˜“","like_count":0},{"had_liked":false,"id":27925,"user_name":"åŒ…å­","can_delete":false,"product_type":"c1","uid":1089345,"ip_address":"","ucode":"6CC4EBB8CD3924","user_header":"https://static001.geekbang.org/account/avatar/00/10/9f/41/82306dfe.jpg","comment_is_top":false,"comment_ctime":1537966920,"is_pvip":false,"replies":[{"id":"10126","content":"ä¸æ˜¯éƒ½è¯´äº†å¯ä»¥å…³çš„â€¦â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538018519,"ip_address":"","comment_id":27925,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1537966920","product_id":100015201,"comment_content":"ä¸€èˆ¬çš„å®¹å™¨åœ¨ä¸è®¿é—®server apiæ—¶ï¼ŒService account tokenæŒ‚è½½å¯ä»¥å…³æ‰å—è€å¸ˆï¼Œæ²¡ä»€ä¹ˆå½±å“å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425087,"discussion_content":"ä¸æ˜¯éƒ½è¯´äº†å¯ä»¥å…³çš„â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538018519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27837,"user_name":"å°ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1229457,"ip_address":"","ucode":"4E20DFD3D4FF82","user_header":"https://static001.geekbang.org/account/avatar/00/12/c2/91/fba79b87.jpg","comment_is_top":false,"comment_ctime":1537952901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537952901","product_id":100015201,"comment_content":"æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒå¥åº·æ£€æŸ¥æ˜¯ç”¨keepalivedæˆ–è€…haproxy.é…åˆç›‘æ§èƒ½æ»¡è¶³åŸºæœ¬çš„è¦æ±‚ã€‚","like_count":0}]}