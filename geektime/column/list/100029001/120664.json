{"id":120664,"title":"37 | CDN：加速我们的网络服务","content":"<p>在正式开讲前，我们先来看看到现在为止HTTP手头都有了哪些“武器”。</p><p>协议方面，HTTPS强化通信链路安全、HTTP/2优化传输效率；应用方面，Nginx/OpenResty提升网站服务能力，WAF抵御网站入侵攻击，讲到这里，你是不是感觉还少了点什么？</p><p>没错，在应用领域，还缺一个在外部加速HTTP协议的服务，这个就是我们今天要说的CDN（Content Delivery Network或Content Distribution Network），中文名叫“内容分发网络”。</p><h2>为什么要有网络加速？</h2><p>你可能要问了，HTTP的传输速度也不算差啊，而且还有更好的HTTP/2，为什么还要再有一个额外的CDN来加速呢？是不是有点“多此一举”呢？</p><p>这里我们就必须要考虑现实中会遇到的问题了。你一定知道，光速是有限的，虽然每秒30万公里，但这只是真空中的上限，在实际的电缆、光缆中的速度会下降到原本的三分之二左右，也就是20万公里/秒，这样一来，地理位置的距离导致的传输延迟就会变得比较明显了。</p><p>比如，北京到广州直线距离大约是2000公里，按照刚才的20万公里/秒来算的话，发送一个请求单程就要10毫秒，往返要20毫秒，即使什么都不干，这个“硬性”的时延也是躲不过的。</p><!-- [[[read_end]]] --><p>另外不要忘了， 互联网从逻辑上看是一张大网，但实际上是由许多小网络组成的，这其中就有小网络“互连互通”的问题，典型的就是各个电信运营商的网络，比如国内的电信、联通、移动三大家。</p><p><img src=\"https://static001.geekbang.org/resource/image/41/b9/413605355db69278cb137b318b70b3b9.png?wh=1239*746\" alt=\"\"></p><p>这些小网络内部的沟通很顺畅，但网络之间却只有很少的联通点。如果你在A网络，而网站在C网络，那么就必须“跨网”传输，和成千上万的其他用户一起去“挤”连接点的“独木桥”。而带宽终究是有限的，能抢到多少只能看你的运气。</p><p>还有，网络中还存在许多的路由器、网关，数据每经过一个节点，都要停顿一下，在二层、三层解析转发，这也会消耗一定的时间，带来延迟。</p><p>把这些因素再放到全球来看，地理距离、运营商网络、路由转发的影响就会成倍增加。想象一下，你在北京，访问旧金山的网站，要跨越半个地球，中间会有多少环节，会增加多少时延？</p><p>最终结果就是，如果仅用现有的HTTP传输方式，大多数网站都会访问速度缓慢、用户体验糟糕。</p><h2>什么是CDN？</h2><p>这个时候CDN就出现了，它就是专门为解决“长距离”上网络访问速度慢而诞生的一种网络应用服务。</p><p>从名字上看，CDN有三个关键词：“<strong>内容</strong>”“<strong>分发</strong>”和“<strong>网络</strong>”。</p><p>先看一下“网络”的含义。CDN的最核心原则是“<strong>就近访问</strong>”，如果用户能够在本地几十公里的距离之内获取到数据，那么时延就基本上变成0了。</p><p>所以CDN投入了大笔资金，在全国、乃至全球的各个大枢纽城市都建立了机房，部署了大量拥有高存储高带宽的节点，构建了一个专用网络。这个网络是跨运营商、跨地域的，虽然内部也划分成多个小网络，但它们之间用高速专有线路连接，是真正的“信息高速公路”，基本上可以认为不存在网络拥堵。</p><p>有了这个高速的专用网之后，CDN就要“分发”源站的“内容”了，用到的就是在<a href=\"https://time.geekbang.org/column/article/108313\">第22讲</a>说过的“<strong>缓存代理</strong>”技术。使用“推”或者“拉”的手段，把源站的内容逐级缓存到网络的每一个节点上。</p><p>于是，用户在上网的时候就不直接访问源站，而是访问离他“最近的”一个CDN节点，术语叫“<strong>边缘节点</strong>”（edge node），其实就是缓存了源站内容的代理服务器，这样一来就省去了“长途跋涉”的时间成本，实现了“网络加速”。</p><p><img src=\"https://static001.geekbang.org/resource/image/46/5b/46d1dbbb545fcf3cfb53407e0afe9a5b.png?wh=1291*787\" alt=\"\"></p><p>那么，CDN都能加速什么样的“内容”呢？</p><p>在CDN领域里，“内容”其实就是HTTP协议里的“资源”，比如超文本、图片、视频、应用程序安装包等等。</p><p>资源按照是否可缓存又分为“<strong>静态资源</strong>”和“<strong>动态资源</strong>”。所谓的“静态资源”是指数据内容“静态不变”，任何时候来访问都是一样的，比如图片、音频。所谓的“动态资源”是指数据内容是“动态变化”的，也就是由后台服务计算生成的，每次访问都不一样，比如商品的库存、微博的粉丝数等。</p><p>很显然，只有静态资源才能够被缓存加速、就近访问，而动态资源只能由源站实时生成，即使缓存了也没有意义。不过，如果动态资源指定了“Cache-Control”，允许缓存短暂的时间，那它在这段时间里也就变成了“静态资源”，可以被CDN缓存加速。</p><p>套用一句广告词来形容CDN吧，我觉得非常恰当：“<strong>我们不生产内容，我们只是内容的搬运工。</strong>”</p><p>CDN，正是把“数据传输”这件看似简单的事情“做大做强”“做专做精”，就像专门的快递公司一样，在互联网世界里实现了它的价值。</p><h2>CDN的负载均衡</h2><p>我们再来看看CDN是具体怎么运行的，它有两个关键组成部分：<strong>全局负载均衡</strong>和<strong>缓存系统</strong>，对应的是DNS（<a href=\"https://time.geekbang.org/column/article/99665\">第6讲</a>）和缓存代理（<a href=\"https://time.geekbang.org/column/article/107577\">第21讲</a>、<a href=\"https://time.geekbang.org/column/article/108313\">第22讲</a>）技术。</p><p>全局负载均衡（Global Sever Load Balance）一般简称为GSLB，它是CDN的“大脑”，主要的职责是当用户接入网络的时候在CDN专网中挑选出一个“最佳”节点提供服务，解决的是用户如何找到“最近的”边缘节点，对整个CDN网络进行“负载均衡”。</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/ca/6c39e76d58d9f17872c83ae72908faca.png?wh=1281*664\" alt=\"\"></p><p>GSLB最常见的实现方式是“<strong>DNS负载均衡</strong>”，这个在<a href=\"https://time.geekbang.org/column/article/99665\">第6讲</a>里也说过，不过GSLB的方式要略微复杂一些。</p><p>原来没有CDN的时候，权威DNS返回的是网站自己服务器的实际IP地址，浏览器收到DNS解析结果后直连网站。</p><p>但加入CDN后就不一样了，权威DNS返回的不是IP地址，而是一个CNAME( Canonical Name )别名记录，指向的就是CDN的GSLB。它有点像是HTTP/2里“Alt-Svc”的意思，告诉外面：“我这里暂时没法给你真正的地址，你去另外一个地方再查查看吧。”</p><p>因为没拿到IP地址，于是本地DNS就会向GSLB再发起请求，这样就进入了CDN的全局负载均衡系统，开始“智能调度”，主要的依据有这么几个：</p><ol>\n<li>看用户的IP地址，查表得知地理位置，找相对最近的边缘节点；</li>\n<li>看用户所在的运营商网络，找相同网络的边缘节点；</li>\n<li>检查边缘节点的负载情况，找负载较轻的节点；</li>\n<li>其他，比如节点的“健康状况”、服务能力、带宽、响应时间等。</li>\n</ol><p>GSLB把这些因素综合起来，用一个复杂的算法，最后找出一台“最合适”的边缘节点，把这个节点的IP地址返回给用户，用户就可以“就近”访问CDN的缓存代理了。</p><h2>CDN的缓存代理</h2><p>缓存系统是CDN的另一个关键组成部分，相当于CDN的“心脏”。如果缓存系统的服务能力不够，不能很好地满足用户的需求，那GSLB调度算法再优秀也没有用。</p><p>但互联网上的资源是无穷无尽的，不管CDN厂商有多大的实力，也不可能把所有资源都缓存起来。所以，缓存系统只能有选择地缓存那些最常用的那些资源。</p><p>这里就有两个CDN的关键概念：“<strong>命中</strong>”和“<strong>回源</strong>”。</p><p>“命中”就是指用户访问的资源恰好在缓存系统里，可以直接返回给用户；“回源”则正相反，缓存里没有，必须用代理的方式回源站取。</p><p>相应地，也就有了两个衡量CDN服务质量的指标：“<strong>命中率</strong>”和“<strong>回源率</strong>”。命中率就是命中次数与所有访问次数之比，回源率是回源次数与所有访问次数之比。显然，好的CDN应该是命中率越高越好，回源率越低越好。现在的商业CDN命中率都在90%以上，相当于把源站的服务能力放大了10倍以上。</p><p>怎么样才能尽可能地提高命中率、降低回源率呢？</p><p>首先，最基本的方式就是在存储系统上下功夫，硬件用高速CPU、大内存、万兆网卡，再搭配TB级别的硬盘和快速的SSD。软件方面则不断“求新求变”，各种新的存储软件都会拿来尝试，比如Memcache、Redis、Ceph，尽可能地高效利用存储，存下更多的内容。</p><p>其次，缓存系统也可以划分出层次，分成一级缓存节点和二级缓存节点。一级缓存配置高一些，直连源站，二级缓存配置低一些，直连用户。回源的时候二级缓存只找一级缓存，一级缓存没有才回源站，这样最终“扇入度”就缩小了，可以有效地减少真正的回源。</p><p>第三个就是使用高性能的缓存服务，据我所知，目前国内的CDN厂商内部都是基于开源软件定制的。最常用的是专门的缓存代理软件Squid、Varnish，还有新兴的ATS（Apache Traffic Server），而Nginx和OpenResty作为Web服务器领域的“多面手”，凭借着强大的反向代理能力和模块化、易于扩展的优点，也在CDN里占据了不少的份额。</p><h2>小结</h2><p>CDN发展到现在已经有二十来年的历史了，早期的CDN功能比较简单，只能加速静态资源。随着这些年Web 2.0、HTTPS、视频、直播等新技术、新业务的崛起，它也在不断进步，增加了很多的新功能，比如SSL加速、内容优化（数据压缩、图片格式转换、视频转码）、资源防盗链、WAF安全防护等等。</p><p>现在，再说CDN是“搬运工”已经不太准确了，它更像是一个“无微不至”的“网站保姆”，让网站只安心生产优质的内容，其他的“杂事”都由它去代劳。</p><ol>\n<li>由于客观地理距离的存在，直连网站访问速度会很慢，所以就出现了CDN；</li>\n<li>CDN构建了全国、全球级别的专网，让用户就近访问专网里的边缘节点，降低了传输延迟，实现了网站加速；</li>\n<li>GSLB是CDN的“大脑”，使用DNS负载均衡技术，智能调度边缘节点提供服务；</li>\n<li>缓存系统是CDN的“心脏”，使用HTTP缓存代理技术，缓存命中就返回给用户，否则就要回源。</li>\n</ol><h2>课下作业</h2><ol>\n<li>网站也可以自建同城、异地多处机房，构建集群来提高服务能力，为什么非要选择CDN呢？</li>\n<li>对于无法缓存的动态资源，你觉得CDN也能有加速效果吗？</li>\n</ol><p>欢迎你把自己的学习体会写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/51/bc1805a7c49977c7838b29602f3bba51.png?wh=1769*3498\" alt=\"unpreview\"></p><p></p>","comments":[{"had_liked":false,"id":126155,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1566342534,"is_pvip":false,"replies":[{"id":"46525","content":"<br>1.对<br><br>2.cdn一般有专用的高速网络直连源站，或者是动态路径优化，所以动态资源回源要比通过公网速度快很多。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354378,"ip_address":"","comment_id":126155,"utype":1}],"discussion_count":3,"race_medal":0,"score":"108940524934","product_id":100029001,"comment_content":"1.自建成本太高，一般的公司玩不起<br>2.cache-control允许缓存的动态资源可以被CDN缓存。不允许缓存的动态资源会回源，虽然老师课上没讲，感觉回源的路径会被优化。","like_count":26,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463853,"discussion_content":"\n1.对\n\n2.cdn一般有专用的高速网络直连源站，或者是动态路径优化，所以动态资源回源要比通过公网速度快很多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1299095,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d2/97/5f4cd8da.jpg","nickname":"虎虎生威的程坚强","note":"","ucode":"321C89298D3682","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393515,"discussion_content":"动态加速主要是优化传输从而达到加速的效果","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1631461975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013493,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","nickname":"宝仔","note":"","ucode":"A0F17DFF99DB21","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291593,"discussion_content":"动态加速成本就很高了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594883676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126860,"user_name":"前端西瓜哥","can_delete":false,"product_type":"c1","uid":1248576,"ip_address":"","ucode":"150130C34CD1C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/0d/40/f70e5653.jpg","comment_is_top":false,"comment_ctime":1566494261,"is_pvip":false,"replies":[{"id":"46917","content":"现在cdn有种叫“边缘计算”的技术，就是把计算动态资源的代码和数据也放在cdn的节点上，这样就可以在cdn里获取动态资源不用回源站了。<br><br>cdn与源站通常都有专网连接，所以走cdn也比走公网快。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566521497,"ip_address":"","comment_id":126860,"utype":1}],"discussion_count":5,"race_medal":0,"score":"74580938293","product_id":100029001,"comment_content":"如果请求的是动态资源，走 CDN 貌似会更慢（因为无法缓存，CDN到源站多了握手过程）？<br><br>我想到两个方案：<br>（1）静态资源都放到一个域名里，然后这个域名使用 CDN 缓存加速。动态资源则使用另一个域名，不进行 CDN 缓存，直接访问源站。<br>（2）让动态资源也走 CDN，像老师说的那样， CDN 有高速网络直连源站，速度也能提高，但这里貌似也是会有不少带宽支出。<br><br>我想知道实际中，请求动态资源具体到底是怎么考虑，一般使用什么方案？","like_count":18,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464208,"discussion_content":"现在cdn有种叫“边缘计算”的技术，就是把计算动态资源的代码和数据也放在cdn的节点上，这样就可以在cdn里获取动态资源不用回源站了。\n\ncdn与源站通常都有专网连接，所以走cdn也比走公网快。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566521497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1299095,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d2/97/5f4cd8da.jpg","nickname":"虎虎生威的程坚强","note":"","ucode":"321C89298D3682","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393516,"discussion_content":"边缘计算这个不是所有的业务场景都合适，动态资源加速主要是加速从客户端到源站这个路径和传输，比如走专线，使用quic协议，动态监测网络状况选择最优回源路径等手段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631462394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186702,"discussion_content":"现在CDN 能自动 区分那些是业务代码了，这不部分资源会走源站的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582706878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7124,"discussion_content":"“如果请求的是动态资源，走 CDN 貌似会更慢（因为无法缓存，CDN到源站多了握手过程）”-- 如果我没记错的话，这个连接是长连接，不会每次需要时才建立，所以不会多出握手过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567391683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7122,"discussion_content":"“边缘计算”受业务场景和类型的限制（安全性考量），当然还有成本考量，有些情况无法使用；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567391594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147641,"user_name":"book尾汁","can_delete":false,"product_type":"c1","uid":1446375,"ip_address":"","ucode":"AE2B8DFC643ACC","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg","comment_is_top":false,"comment_ctime":1572875620,"is_pvip":true,"replies":[{"id":"56940","content":"说的很好。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1572915729,"ip_address":"","comment_id":147641,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31637646692","product_id":100029001,"comment_content":"1 是的自建成本很高<br>2 虽然是动态资源会回源，但是用户通过GSLB得到的边缘节点的ip也是离用户较近的，边缘节点到中心 中心节点到源站的网络也是很快的，综合来说还是要比用户直接访问快点。支持动态加速的CDN就更快了，直接规划出一条到源站的最优路径<br>","like_count":7,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473279,"discussion_content":"说的很好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572915729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128700,"user_name":"苦行僧","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1566952596,"is_pvip":false,"replies":[{"id":"47837","content":"在视频、直播领域cdn非常有用。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566972217,"ip_address":"","comment_id":128700,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23041789076","product_id":100029001,"comment_content":"我们公司就是生产大量视频 每天几T视频 不用cdn成本可想而知 不过每次招标换厂家都涉及视频搬迁","like_count":5,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465065,"discussion_content":"在视频、直播领域cdn非常有用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566972217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126542,"user_name":"magicnum","can_delete":false,"product_type":"c1","uid":1004869,"ip_address":"","ucode":"96B3696961F654","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/45/e4314bc6.jpg","comment_is_top":false,"comment_ctime":1566404744,"is_pvip":false,"replies":[{"id":"46800","content":"对","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566430407,"ip_address":"","comment_id":126542,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14451306632","product_id":100029001,"comment_content":"CDN不仅有专线，还可以进行边缘计算。","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464046,"discussion_content":"对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566430407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126307,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1566360047,"is_pvip":false,"replies":[{"id":"46605","content":"great。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566365167,"ip_address":"","comment_id":126307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14451261935","product_id":100029001,"comment_content":"网站也可以自建同城、异地多处机房，构建集群来提高服务能力，为什么非要选择 CDN 呢？<br>确实可以，不过建大了，就成了一个CDN。<br><br>对于无法缓存的动态资源，你觉得 CDN 也能有加速效果吗？<br>也有加速效果，不过要注意设置好缓存过期时间，不宜太长。如果不设缓存，内容由CDN回源去源站拉取，链路上专用网络可能快一些。对于缓存不可接受的业务，最好就不要用CDN了。","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463935,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566365167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126168,"user_name":"佳佳大魔王","can_delete":false,"product_type":"c1","uid":1235320,"ip_address":"","ucode":"D5214903D85A0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/d9/78/8a328299.jpg","comment_is_top":false,"comment_ctime":1566345344,"is_pvip":false,"replies":[{"id":"46534","content":"对，自己搭建机房费时费力费钱费人工，对于一般的中小型网站来说性价比不高，cdn是专门做这个的，交给他们做效果会更好。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354814,"ip_address":"","comment_id":126168,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14451247232","product_id":100029001,"comment_content":"问题一，我觉得会造成数据同步困难的问题，另外在网站更新的时候，消耗的资源也比较多","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463861,"discussion_content":"对，自己搭建机房费时费力费钱费人工，对于一般的中小型网站来说性价比不高，cdn是专门做这个的，交给他们做效果会更好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1439908,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","nickname":"鱼向北游","note":"","ucode":"580EC7DCE57E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5557,"discussion_content":"主要是成本 类比自来水网铁路这样的公共设施 这种最好是组大网然后复用 而不是每个设备商都自己搞套新的 成本极高","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1566353812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202741,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1586061220,"is_pvip":false,"replies":[{"id":"76039","content":"回答的很好。<br><br>动态资源的关键在于它的实时性，如果缓存可能会导致数据不一致，比如账户余额。<br><br>如果实时性要求低，那么就可以缓存较短的时间。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1586222158,"ip_address":"","comment_id":202741,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10175995812","product_id":100029001,"comment_content":"1：网站也可以自建同城、异地多处机房，构建集群来提高服务能力，为什么非要选择 CDN 呢？<br>钱决定的，成本收益比导致选择CDN，假如自建更省钱那一定会选择自建。首先，小公司自建不起，没有这么多人力、财力、技术，用多少买多少多香。大公司觉得自建更好，此时就变成了使用自己的CDN。<br><br>2：对于无法缓存的动态资源，你觉得 CDN 也能有加速效果吗？<br>无法缓存的资源，只能回源获取，正好能够利用CDN与源服务器之间的高速通道（看评论才知道），也能起到加速的效果吧！<br>话说什么动态资源不能够缓存？自建机房，异地多机房不是什么都有了嘛？只是又引入了一致性问题。","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490671,"discussion_content":"回答的很好。\n\n动态资源的关键在于它的实时性，如果缓存可能会导致数据不一致，比如账户余额。\n\n如果实时性要求低，那么就可以缓存较短的时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586222158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126227,"user_name":"锦","can_delete":false,"product_type":"c1","uid":1468298,"ip_address":"","ucode":"CB0EB4B68C468B","user_header":"https://static001.geekbang.org/account/avatar/00/16/67/8a/babd74dc.jpg","comment_is_top":false,"comment_ctime":1566351381,"is_pvip":false,"replies":[{"id":"46524","content":"你说的这个“伪源”可能就是cdn的一级节点吧，二级节点不直接访问源站，而是访问cdn内部的一级节点，而一级节点就充当了源站。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354283,"ip_address":"","comment_id":126227,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5861318677","product_id":100029001,"comment_content":"现实中为了减少回源率，降低宽带费用，一般cdn厂商也会提供伪源，那云厂商是怎么解决这个回源问题的呢？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463894,"discussion_content":"你说的这个“伪源”可能就是cdn的一级节点吧，二级节点不直接访问源站，而是访问cdn内部的一级节点，而一级节点就充当了源站。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019805,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8f/9d/abb7bfe3.jpg","nickname":"Carson","note":"","ucode":"B2EF429C157ACB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6026,"discussion_content":"伪源，可以用云服务商的对象存储，如腾讯云cos，存储费用，回源流量都要比比自己原站成本低很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566619492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126206,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1566349802,"is_pvip":false,"replies":[{"id":"46521","content":"welcome back。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354101,"ip_address":"","comment_id":126206,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861317098","product_id":100029001,"comment_content":"老师，我又回来啦，😄","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463884,"discussion_content":"welcome back。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126188,"user_name":"徐海浪","can_delete":false,"product_type":"c1","uid":1078528,"ip_address":"","ucode":"21801C420D0610","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","comment_is_top":false,"comment_ctime":1566347296,"is_pvip":false,"replies":[{"id":"46522","content":"very good。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354118,"ip_address":"","comment_id":126188,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5861314592","product_id":100029001,"comment_content":"1.网站也可以自建同城、异地多处机房，构建集群来提高服务能力，为什么非要选择 CDN 呢？<br>因为CDN有大量边缘节点，网站只需要专注于自身业务，无需关心早专业的CDN复杂调度逻辑。<br>2.对于无法缓存的动态资源，你觉得 CDN 也能有加速效果吗？<br>有一定的效果，因为动态资源可以走cdn专线回源。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463873,"discussion_content":"very good。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126180,"user_name":"闫飞","can_delete":false,"product_type":"c1","uid":1013162,"ip_address":"","ucode":"30C782D30108D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/aa/21275b9d.jpg","comment_is_top":false,"comment_ctime":1566346107,"is_pvip":false,"replies":[{"id":"46523","content":"家用级别和企业级别的硬盘还是有区别的，用于服务器的硬盘质量肯定会更高一些。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566354189,"ip_address":"","comment_id":126180,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5861313403","product_id":100029001,"comment_content":"TB级别的硬盘看起来也不是特别高端厉害的样子，因为普通的PC机也标配TB级SATA盘或者512GB SSD了吧。我猜CDN厂商是不是需要用专有的服务器硬盘保证比较长的服务寿命，还是大家就到市面上买买普通的硬盘挂上去就用了?","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463871,"discussion_content":"家用级别和企业级别的硬盘还是有区别的，用于服务器的硬盘质量肯定会更高一些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566354189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1439908,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","nickname":"鱼向北游","note":"","ucode":"580EC7DCE57E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5556,"discussion_content":"有服务器专用的 以前黑科技为了让硬盘速度更快专门用软件把内圈磁道屏蔽了 只用外圈 以减少容量的代价换取性能","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566353656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1013162,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/aa/21275b9d.jpg","nickname":"闫飞","note":"","ucode":"30C782D30108D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1439908,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","nickname":"鱼向北游","note":"","ucode":"580EC7DCE57E9A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5867,"discussion_content":"这个的确很黑科技，涨见识了。我以前公司因为业务变化曾经退下来一堆SUN服务器专用硬盘，都是8个一组的RAID，性能上不见得优势多多少，就是主打稳定可靠，价格非常感人，拆下来PC还用不了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566518798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5556,"ip_address":""},"score":5867,"extra":""}]}]},{"had_liked":false,"id":126170,"user_name":"佳佳大魔王","can_delete":false,"product_type":"c1","uid":1235320,"ip_address":"","ucode":"D5214903D85A0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/d9/78/8a328299.jpg","comment_is_top":false,"comment_ctime":1566345566,"is_pvip":false,"replies":[{"id":"46542","content":"是的，这些数据已经下载到了本地，而且依然在有效期，那么就不用再次向服务器请求，可以直接在本地获取。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566356241,"ip_address":"","comment_id":126170,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861312862","product_id":100029001,"comment_content":"问题二，文章指出了如果动态资源指定了 Cache-Control  那么也可以在很短时间内缓存<br>我觉得在这种情况比较有用：打开一个网站，打到一半的时候关闭，此时服务器已经开始了运算，当我们在很短时间内再次打开相同的网站时，很快就进入了","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463862,"discussion_content":"是的，这些数据已经下载到了本地，而且依然在有效期，那么就不用再次向服务器请求，可以直接在本地获取。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566356241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352452,"user_name":"北冥有鱼","can_delete":false,"product_type":"c1","uid":1307189,"ip_address":"","ucode":"C970CD9F308FC4","user_header":"https://static001.geekbang.org/account/avatar/00/13/f2/35/c3589990.jpg","comment_is_top":false,"comment_ctime":1658678987,"is_pvip":true,"replies":[{"id":"128197","content":"great","user_name":"作者回复","user_name_real":"编辑","uid":"1181974","ctime":1658712175,"ip_address":"","comment_id":352452,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1658678987","product_id":100029001,"comment_content":"1.自建多地缓存集群，成本巨高，只有少数top级互联网公司承担的起。<br>2.CDN依托于自己搭建的网络，通过计算最优路由来实现加速效果。另外还能优化跨运营商访问，省去了源站的BGP带宽开销","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581289,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658712175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299758,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1624847654,"is_pvip":true,"replies":[{"id":"108722","content":"great。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1624864678,"ip_address":"","comment_id":299758,"utype":1}],"discussion_count":1,"race_medal":4,"score":"1624847654","product_id":100029001,"comment_content":"1.成本高，维护困难；<br><br>2.数据一致性要求不高，同步慢等，可以设置短时间缓存","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522538,"discussion_content":"great。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624864678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277136,"user_name":"牛","can_delete":false,"product_type":"c1","uid":2382521,"ip_address":"","ucode":"12C46025BBA2D3","user_header":"","comment_is_top":false,"comment_ctime":1612271645,"is_pvip":false,"replies":[{"id":"100584","content":"对，CDN已经是如今互联网的基础设施了，无法想象没有它的世界会是什么样。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1612323853,"ip_address":"","comment_id":277136,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612271645","product_id":100029001,"comment_content":"CDN已经是一项互联网领域的基本服务了。对于受众分布广泛，比如全国性、全世界性的互联网产品，都用得上，而且费用还不便宜。那些个视频网站，这项开支巨大。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514939,"discussion_content":"对，CDN已经是如今互联网的基础设施了，无法想象没有它的世界会是什么样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612323853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240396,"user_name":"小谢同学","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1596887252,"is_pvip":false,"replies":[{"id":"88823","content":"good","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1597021649,"ip_address":"","comment_id":240396,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596887252","product_id":100029001,"comment_content":"问题1:主要是互联网形态的业务终端用户分布范围太广，还需要考虑一些边远地区甚至三大运营商覆盖不到的地方，这时候考验cdn的节点和运营商覆盖了，此外尽可能优化终端体验也是产品的一大竞争优势<br>问题2:对于动态内容可以采用动态加速或者所谓的“全站加速”，即通过cdn服务商提供动态内容请求的最优回源路线","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503428,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597021649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223904,"user_name":"do it","can_delete":false,"product_type":"c1","uid":1309911,"ip_address":"","ucode":"E0753912E8F2AF","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d7/b102034a.jpg","comment_is_top":false,"comment_ctime":1591229211,"is_pvip":false,"replies":[{"id":"82439","content":"言简意赅，good。","user_name":"作者回复","user_name_real":"罗剑锋","uid":"1181974","ctime":1591232947,"ip_address":"","comment_id":223904,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1591229211","product_id":100029001,"comment_content":"1、为了省钱<br>2、线路优化","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497292,"discussion_content":"言简意赅，good。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591232947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180970,"user_name":"子杨","can_delete":false,"product_type":"c1","uid":1236803,"ip_address":"","ucode":"EA7555EEE6DECE","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/43/1aa8708a.jpg","comment_is_top":false,"comment_ctime":1582450758,"is_pvip":false,"replies":[{"id":"70242","content":"这个好像是最基本的，也挺有效，这样就保证源站的http服务是正常的，其他很多网站都是这么干，像let&#39;s encrypt。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1582507672,"ip_address":"","comment_id":180970,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1582450758","product_id":100029001,"comment_content":"老师好，对于 CDN 而言，如何判断是源站造成的异常还是 CDN 的异常？为了监控源站是否异常，我们目前采用的是在源站放一个文件，不断的去探测文件的长度，一致的话就表示正常。总觉得会有更好的办法。。。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484870,"discussion_content":"这个好像是最基本的，也挺有效，这样就保证源站的http服务是正常的，其他很多网站都是这么干，像let&amp;#39;s encrypt。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582507672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307189,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/35/c3589990.jpg","nickname":"北冥有鱼","note":"","ucode":"C970CD9F308FC4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581271,"discussion_content":"还有一种方法，在源站放一个很小的文件，CDN设置为不缓存。在终端访问这个文件，如果正常响应了，说明CDN到源站链路正常，也就是说源站正常。如果响应异常，让终端直接去请求源站，这时候源站正常响应的话说明CDN故障，源站响应异常说明源站故障。如果是要判断资源是否一致的话。只发head请求 通过etag来判断更好一点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658679522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307189,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/35/c3589990.jpg","nickname":"北冥有鱼","note":"","ucode":"C970CD9F308FC4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581270,"discussion_content":"通常CDN有回源日志，直接查询回源日志，根据相应状态码分析即可。另外cdn还可以向源站发head请求来探测所缓存的资源是否过期，源站响应是否正常，来决定缓存的处置方式以及主备源站切换。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658679235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138478,"user_name":"lfn","can_delete":false,"product_type":"c1","uid":1026593,"ip_address":"","ucode":"2E1558C6A12A89","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/21/6c3ba9af.jpg","comment_is_top":false,"comment_ctime":1570266852,"is_pvip":false,"replies":[{"id":"53476","content":"加油。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1570496450,"ip_address":"","comment_id":138478,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570266852","product_id":100029001,"comment_content":"2019-10-05 打卡。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469535,"discussion_content":"加油。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570496450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130215,"user_name":"moooofly","can_delete":false,"product_type":"c1","uid":1008348,"ip_address":"","ucode":"4A20795C281B6F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","comment_is_top":false,"comment_ctime":1567405516,"is_pvip":false,"replies":[{"id":"48583","content":"cdn主要看价格和服务保障能力，很多厂商都提供试用，需要结合公司最关注的指标去评估，没有一个完美的cdn。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1567413149,"ip_address":"","comment_id":130215,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567405516","product_id":100029001,"comment_content":"关于国内，国外 CDN 选型不知道有何建议和推荐？之前了解过 aws 的 cloudfront ，网宿和阿里云 CDN，公司实际使用情况，国外部分用了 cloudfront ，国内上了网宿，后面打算国内外都用网速，而阿里云也一致在考虑之内","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465861,"discussion_content":"cdn主要看价格和服务保障能力，很多厂商都提供试用，需要结合公司最关注的指标去评估，没有一个完美的cdn。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567413149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127248,"user_name":"Carson","can_delete":false,"product_type":"c1","uid":1019805,"ip_address":"","ucode":"B2EF429C157ACB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/9d/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1566620260,"is_pvip":false,"replies":[{"id":"47152","content":"<br>1.对<br><br>2.能缓存的动态资源就是静态资源，只是缓存时间短而已。<br><br>3.有的动态资源是不允许缓存的，所以只能走cdn动态路由优化或者边缘计算。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566690239,"ip_address":"","comment_id":127248,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566620260","product_id":100029001,"comment_content":"1.自建多地业务源站，花费的人力，物力，财力要比使用cdn都多不止多少倍，我猜cdn当时就是这么产生的<br>2.动态资源cdn缓存没有问题，关键是要控制好缓存时间和业务调用逻辑，别张三访问命中了李四的信息了","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464396,"discussion_content":"\n1.对\n\n2.能缓存的动态资源就是静态资源，只是缓存时间短而已。\n\n3.有的动态资源是不允许缓存的，所以只能走cdn动态路由优化或者边缘计算。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566690239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126265,"user_name":"我行我素","can_delete":false,"product_type":"c1","uid":1224678,"ip_address":"","ucode":"4C69542FAB0671","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg","comment_is_top":false,"comment_ctime":1566354846,"is_pvip":false,"replies":[{"id":"46606","content":"对。","user_name":"作者回复","user_name_real":"chrono","uid":"1181974","ctime":1566365174,"ip_address":"","comment_id":126265,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566354846","product_id":100029001,"comment_content":"1.成本问题还有维护问题，既然已有现成的何必自找麻烦<br>2.感觉可以优化访问的线路","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463912,"discussion_content":"对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566365174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}