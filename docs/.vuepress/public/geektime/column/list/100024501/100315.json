{"id":100315,"title":"39 | æ‰“é€šå‰ç«¯ä¸åŸç”Ÿçš„æ¡¥æ¢ï¼šJavaScriptCore èƒ½å¹²å“ªäº›äº‹æƒ…ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« æ˜¯åŸç”Ÿä¸å‰ç«¯å…±èˆæ¨¡å—çš„ç¬¬ä¸€ç¯‡ï¼Œæˆ‘æ¥è·Ÿä½ èŠèŠå‰ç«¯å’ŒåŸç”Ÿä¹‹é—´çš„æ¡¥æ¢ JavaScriptCoreï¼Œçœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆã€èƒ½åšå“ªäº›äº‹å„¿ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒJavaScriptCore ä¸ºåŸç”Ÿç¼–ç¨‹è¯­è¨€ Objective-Cã€Swift æä¾›è°ƒç”¨ JavaScript ç¨‹åºçš„åŠ¨æ€èƒ½åŠ›ï¼Œè¿˜èƒ½ä¸º JavaScript æä¾›åŸç”Ÿèƒ½åŠ›æ¥å¼¥è¡¥å‰ç«¯æ‰€ç¼ºèƒ½åŠ›ã€‚</p><p>æ­£æ˜¯å› ä¸ºJavaScriptCoreçš„è¿™ç§æ¡¥æ¢ä½œç”¨ï¼Œæ‰€ä»¥å‡ºç°äº†å¾ˆå¤šä½¿ç”¨ JavaScriptCore å¼€å‘ App çš„æ¡†æ¶ ï¼Œæ¯”å¦‚React Nativeã€Weexã€å°ç¨‹åºã€WebView Hybirdç­‰æ¡†æ¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹ï¼ŒJavaScriptCore çš„æ¥å¤´æ˜¯å•¥ï¼Œä¸ºä»€ä¹ˆè¿™äº›æ¡†æ¶ä¸çº¦è€ŒåŒåœ°éƒ½è¦ç”¨ JavaScriptCore å¼•æ“æ¥ä½œä¸ºå‰ç«¯å’ŒåŸç”Ÿçš„æ¡¥æ¢å‘¢ï¼Ÿ</p><p>è¦å›ç­”è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä½ è¿˜éœ€è¦<strong>äº†è§£JavaScriptCore çš„èƒŒæ™¯</strong>ã€‚</p><p>JavaScriptCoreï¼ŒåŸæœ¬æ˜¯ WebKitä¸­ç”¨æ¥è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç çš„æ ¸å¿ƒå¼•æ“ã€‚è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç çš„å¼•æ“è‡ª JavaScript è¯ç”Ÿèµ·å°±æœ‰ï¼Œä¸æ–­æ¼”è¿›ï¼Œä¸€ç›´å‘å±•åˆ°ç°åœ¨ï¼Œå¦‚ä»Šè‹¹æœå…¬å¸æœ‰ JavaScriptCore å¼•æ“ã€è°·æ­Œæœ‰ V8 å¼•æ“ã€Mozilla æœ‰ SpiderMonkeyã€‚å¯¹äº iOS å¼€å‘è€…æ¥è¯´ï¼Œä½ åªè¦æ·±å…¥ç†è§£è‹¹æœå…¬å¸çš„ JavaScriptCore æ¡†æ¶å°±å¯ä»¥äº†ã€‚</p><!-- [[[read_end]]] --><p>iOS7 ä¹‹å‰ï¼Œè‹¹æœå…¬å¸æ²¡æœ‰å¼€æ”¾ JavaScriptCore å¼•æ“ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ JavaScriptCore çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨åœ°ä»å¼€æºWebKit ä¸­ç¼–è¯‘å‡ºæ¥ï¼Œå…¶æ¥å£éƒ½æ˜¯ C è¯­è¨€ï¼Œè¿™å¯¹äºiOSå¼€å‘è€…æ¥è¯´éå¸¸ä¸å‹å¥½ã€‚</p><p>ä½†æ˜¯ä»iOS7å¼€å§‹ï¼Œè‹¹æœå…¬å¸å¼€å§‹å°† JavaScriptCore æ¡†æ¶å¼•å…¥ iOS ç³»ç»Ÿï¼Œå¹¶å°†å…¶ä½œä¸ºç³»ç»Ÿçº§çš„æ¡†æ¶æä¾›ç»™å¼€å‘è€…ä½¿ç”¨ã€‚è¿™æ—¶ï¼Œæ¥å£ä½¿ç”¨ Objective-C è¿›è¡ŒåŒ…è£…ï¼Œè¿™å¯¹äºåŸç”Ÿ Objective-C å¼€å‘è€…æ¥è¯´ï¼Œä½“éªŒä¸Šå°±éå¸¸å‹å¥½äº†ã€‚</p><p>JavaScriptCore æ¡†æ¶çš„æ¡†æ¶åæ˜¯ JavaScriptCore.frameworkã€‚ç”±äºè‹¹æœå…¬å¸çš„ç³»ç»Ÿå·²ç»å†…ç½®äº†JavaScriptCore æ¡†æ¶ï¼Œè€Œä¸”æ€§èƒ½ä¸é€Šè‰²äº V8 å’Œ SpiderMonkey ç­‰å…¶ä»–å¼•æ“ï¼Œæ‰€ä»¥å‰ç«¯å¼€å‘ App æ¡†æ¶å°±éƒ½ä¸çº¦è€ŒåŒå°† JavaScriptCore æ¡†æ¶ä½œä¸ºè‡ªå·±å’ŒåŸç”Ÿçš„æ¡¥æ¢ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ è¯¦ç»†åˆ†æä¸€ä¸‹JavaScriptCoreæ¡†æ¶çš„åŸç†ã€‚</p><h2>JavaScriptCore æ¡†æ¶</h2><p>è‹¹æœå®˜æ–¹å¯¹JavaScriptCoreæ¡†æ¶çš„è¯´æ˜ï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://developer.apple.com/documentation/javascriptcore\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼ŒJavaScriptCore æ¡†æ¶ä¸»è¦ç”± JSVirtualMachine ã€JSContextã€JSValueç±»ç»„æˆã€‚</p><p>JSVirturalMachineçš„ä½œç”¨ï¼Œæ˜¯ä¸º JavaScript ä»£ç çš„è¿è¡Œæä¾›ä¸€ä¸ªè™šæ‹Ÿæœºç¯å¢ƒã€‚åœ¨åŒä¸€æ—¶é—´å†…ï¼ŒJSVirtualMachineåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæƒ³è¦å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä½ å¯ä»¥åˆ›å»ºå¤šä¸ª JSVirtualMachineã€‚æ¯ä¸ª JSVirtualMachine éƒ½æœ‰è‡ªå·±çš„ GCï¼ˆGarbage Collectorï¼Œåƒåœ¾å›æ”¶å™¨ï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œæ‰€ä»¥å¤šä¸ª JSVirtualMachine ä¹‹é—´çš„å¯¹è±¡æ— æ³•ä¼ é€’ã€‚</p><p>JSContext æ˜¯ JavaScript è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œè´Ÿè´£åŸç”Ÿå’Œ JavaScript çš„æ•°æ®ä¼ é€’ã€‚</p><p>JSValue æ˜¯ JavaScript çš„å€¼å¯¹è±¡ï¼Œç”¨æ¥è®°å½• JavaScript çš„åŸå§‹å€¼ï¼Œå¹¶æä¾›è¿›è¡ŒåŸç”Ÿå€¼å¯¹è±¡è½¬æ¢çš„æ¥å£æ–¹æ³•ã€‚</p><p>JSVirtualMachineã€JSContextã€JSValue ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/00/24/00306bd8193cd606d6e62340cffcbb24.png?wh=888*1042\" alt=\"\"></p><p>å¯ä»¥çœ‹å‡ºï¼ŒJSVirtualMachine é‡ŒåŒ…å«äº†å¤šä¸ª JSContextï¼Œ åŒä¸€ä¸ªJSContext ä¸­åˆå¯ä»¥æœ‰å¤šä¸ª JSValueã€‚</p><p>JSVirtualMachine ã€JSContextã€JSValue ç±»æä¾›çš„æ¥å£ï¼Œèƒ½å¤Ÿè®©åŸç”Ÿåº”ç”¨æ‰§è¡Œ JavaScript ä»£ç ï¼Œè®¿é—® JavaScript å˜é‡ï¼Œè®¿é—®å’Œæ‰§è¡Œ JavaScript å‡½æ•°ï¼›ä¹Ÿèƒ½å¤Ÿè®© JavaScript æ‰§è¡ŒåŸç”Ÿä»£ç ï¼Œä½¿ç”¨åŸç”Ÿè¾“å‡ºçš„ç±»ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç çš„ JavaScriptCore å’ŒåŸç”Ÿåº”ç”¨æ˜¯æ€ä¹ˆäº¤äº’çš„å‘¢ï¼Ÿ</strong></p><p>è¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/31/c3/316d9ba836fd6fd14155e941e21b27c3.png?wh=2118*1628\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ª JavaScriptCore ä¸­çš„ JSVirtualMachine å¯¹åº”ç€ä¸€ä¸ªåŸç”Ÿçº¿ç¨‹ï¼ŒåŒä¸€ä¸ª JSVirtualMachine ä¸­å¯ä»¥ä½¿ç”¨ JSValue ä¸åŸç”Ÿçº¿ç¨‹é€šä¿¡ï¼Œéµå¾ªçš„æ˜¯JSExportåè®®ï¼šåŸç”Ÿçº¿ç¨‹å¯ä»¥å°†ç±»æ–¹æ³•å’Œå±æ€§æä¾›ç»™ JavaScriptCore ä½¿ç”¨ï¼ŒJavaScriptCore å¯ä»¥å°†JSValueæä¾›ç»™åŸç”Ÿçº¿ç¨‹ä½¿ç”¨ã€‚</p><p>JavaScriptCore å’ŒåŸç”Ÿåº”ç”¨è¦æƒ³äº¤äº’ï¼Œé¦–å…ˆè¦æœ‰ JSContextã€‚JSContext ç›´æ¥ä½¿ç”¨ init åˆå§‹åŒ–ï¼Œä¼šé»˜è®¤ä½¿ç”¨ç³»ç»Ÿåˆ›å»ºçš„ JSVirtualMachineã€‚å¦‚æœ JSContext è¦è‡ªå·±æŒ‡å®šä½¿ç”¨å“ªä¸ª JSVirtualMachineï¼Œå¯ä»¥ä½¿ç”¨ initWithVirtualMachine æ–¹æ³•æ¥æŒ‡å®šï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>// åˆ›å»º JSVirtualMachine å¯¹è±¡ jsvm\nJSVirtualMachine *jsvm = [[JSVirtualMachine alloc] init];\n// ä½¿ç”¨ jsvm çš„ JSContext å¯¹è±¡ ct\nJSContext *ct = [[JSContext alloc] initWithVirtualMachine:jsvm];\n</code></pre><p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª JSVirtualMachine å¯¹è±¡ jsvmï¼Œå†åˆå§‹åŒ–ä¸€ä¸ªä½¿ç”¨ jsvm çš„ JSContext å¯¹è±¡ ctã€‚</p><p>ä¸‹é¢æˆ‘å†ä¸¾ä¸€ä¸ª<strong>é€šè¿‡JavaScriptCoreåœ¨åŸç”Ÿä»£ç ä¸­è°ƒç”¨JavaScriptå˜é‡çš„ä¾‹å­</strong>ã€‚</p><p>è¿™é‡Œæœ‰ä¸€æ®µ JavaScript ä»£ç ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ª JavaScript å˜é‡ i ï¼Œç„¶åæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•é€šè¿‡ JavaScriptCore åœ¨åŸç”Ÿä¸­è°ƒç”¨å˜é‡iã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>JSContext *context  = [[JSContext alloc] init];\n// è§£ææ‰§è¡Œ JavaScript è„šæœ¬\n[context evaluateScript:@&quot;var i = 4 + 8&quot;];\n// è½¬æ¢ i å˜é‡ä¸ºåŸç”Ÿå¯¹è±¡\nNSNumber *number = [context[@&quot;i&quot;] toNumber];\nNSLog(@&quot;var i is %@, number is %@&quot;,context[@&quot;i&quot;], number);\n</code></pre><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒJSContext ä¼šè°ƒç”¨ evaluateScript æ–¹æ³•ï¼Œè¿”å› JSValue å¯¹è±¡ã€‚</p><p>JSValue ç±»æä¾›äº†ä¸€ç»„å°† JavaScript å¯¹è±¡å€¼ç±»å‹è½¬æˆåŸç”Ÿç±»å‹çš„æ¥å£ï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://developer.apple.com/documentation/javascriptcore/jsvalue\">è¿™ä¸ªé“¾æ¥</a>ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ JSValue æ¥å£çš„è¯¦ç»†è¯´æ˜ã€‚</p><p>å…¶ä¸­ï¼Œæœ‰3ä¸ªè½¬æ¢ç±»å‹çš„æ¥å£æ¯”è¾ƒå¸¸ç”¨ï¼Œæˆ‘æ¥å’Œä½ ç¨ä½œå±•å¼€ï¼š</p><ul>\n<li>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ toNumber æ–¹æ³•ï¼Œæ¥å°† JavaScript å€¼è½¬æ¢æˆ NSNumber å¯¹è±¡ã€‚</li>\n<li>å¦‚æœ JavaScript ä»£ç ä¸­çš„å˜é‡æ˜¯æ•°ç»„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ toArrayæ–¹æ³•å°†å…¶è½¬æ¢æˆ NSArrayå¯¹è±¡ã€‚</li>\n<li>å¦‚æœå˜é‡æ˜¯ Objectç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ toDictionaryæ–¹æ³•å°†å…¶è½¬æ¢æˆ NSDictionaryã€‚</li>\n</ul><p>å¦‚æœä½ æƒ³åœ¨åŸç”Ÿä»£ç ä¸­ä½¿ç”¨JavaScript ä¸­çš„å‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ callWithArguments æ–¹æ³•ä¼ å…¥å‚æ•°ï¼Œç„¶åå®ç°å®ƒçš„è°ƒç”¨ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>// è§£ææ‰§è¡Œ JavaScript è„šæœ¬\n[context evaluateScript:@&quot;function addition(x, y) { return x + y}&quot;];\n// è·å¾— addition å‡½æ•°\nJSValue *addition = context[@&quot;addition&quot;];\n// ä¼ å…¥å‚æ•°æ‰§è¡Œ addition å‡½æ•°\nJSValue *resultValue = [addition callWithArguments:@[@(4), @(8)]];\n// å°† addition å‡½æ•°æ‰§è¡Œçš„ç»“æœè½¬æˆåŸç”Ÿ NSNumber æ¥ä½¿ç”¨ã€‚\nNSLog(@&quot;function is %@; reslutValue is %@&quot;,addition, [resultValue toNumber]);\n</code></pre><p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼šé¦–å…ˆï¼ŒJSContext é€šè¿‡ evaluateScript æ–¹æ³•è·å– JavaScript ä»£ç ä¸­ addition å‡½æ•°ï¼Œå¹¶ä¿å­˜ä¸ºä¸€ä¸ª JSValue å¯¹è±¡ï¼›ç„¶åï¼Œé€šè¿‡ JSValue çš„ callWithArguments æ–¹æ³•ï¼Œä¼ å…¥ addition å‡½æ•°æ‰€éœ€å‚æ•° xã€y ä»¥æ‰§è¡Œå‡½æ•°ã€‚</p><p>è€Œå¦‚æœè¦åœ¨åŸç”Ÿä»£ç ä¸­è°ƒç”¨JavaScript å…¨å±€å‡½æ•°ï¼Œä½ éœ€è¦ä½¿ç”¨ JSValue çš„ invokeMethod:withArguments æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œ<a href=\"https://github.com/apache/incubator-weex/\">Weex</a>æ¡†æ¶å°±æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ¥è·å– JavaScript å‡½æ•°çš„ã€‚</p><p>ç›¸å…³ä»£ç è·¯å¾„æ˜¯ incubator-weex/ios/sdk/WeexSDK/Sources/Bridge/WXJSCoreBridge.mm ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><pre><code>- (JSValue *)callJSMethod:(NSString *)method args:(NSArray *)args {\n    WXLogDebug(@&quot;Calling JS... method:%@, args:%@&quot;, method, args);\n    return [[_jsContext globalObject] invokeMethod:method withArguments:args];\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒJSContext ä¸­æœ‰ä¸€ä¸ª globalObject å±æ€§ã€‚globalObject æ˜¯ JSValue ç±»å‹ï¼Œé‡Œé¢è®°å½•äº† JSContext çš„å…¨å±€å¯¹è±¡ï¼Œä½¿ç”¨ globalObject æ‰§è¡Œçš„ JavaScript å‡½æ•°èƒ½å¤Ÿä½¿ç”¨å…¨å±€ JavaScript å¯¹è±¡ã€‚å› æ­¤ï¼Œé€šè¿‡ globalObject æ‰§è¡Œ invokeMethod:withArguments æ–¹æ³•å°±èƒ½å¤Ÿå»ä½¿ç”¨å…¨å±€ JavaScript å¯¹è±¡äº†ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œé€šè¿‡ evaluateScript æ–¹æ³•ï¼Œå°±èƒ½å¤Ÿåœ¨åŸç”Ÿä»£ç ä¸­æ‰§è¡Œ JavaScript è„šæœ¬ï¼Œå¹¶ä½¿ç”¨ JavaScript çš„å€¼å¯¹è±¡å’Œå‡½æ•°å¯¹è±¡ã€‚é‚£ä¹ˆï¼Œ<strong>JavaScriptåˆæ˜¯å¦‚ä½•è°ƒç”¨åŸç”Ÿä»£ç å‘¢ï¼Ÿ</strong></p><p>æˆ‘å…ˆç»™å‡ºä¸€æ®µä»£ç ç¤ºä¾‹ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><pre><code>// åœ¨ JSContext ä¸­ä½¿ç”¨åŸç”Ÿ Block è®¾ç½®ä¸€ä¸ªå‡æ³• subtraction å‡½æ•°\ncontext[@&quot;subtraction&quot;] = ^(int x, int y) {\n    return x - y;\n};\n\n// åœ¨åŒä¸€ä¸ª JSContext é‡Œç”¨ JavaScript ä»£ç æ¥è°ƒç”¨åŸç”Ÿ subtraction å‡½æ•°\nJSValue *subValue = [context evaluateScript:@&quot;subtraction(4,8);&quot;];\nNSLog(@&quot;substraction(4,8) is %@&quot;,[subValue toNumber]);\n</code></pre><p>å¯ä»¥çœ‹å‡ºï¼ŒJavaScript è°ƒç”¨åŸç”Ÿä»£ç çš„æ–¹å¼ï¼Œå°±æ˜¯ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œåœ¨ JSContext ä¸­ä½¿ç”¨åŸç”Ÿ Block è®¾ç½®ä¸€ä¸ªå‡æ³•å‡½æ•°subtractionï¼›</li>\n<li>ç„¶åï¼Œåœ¨åŒä¸€ä¸ª JSContext é‡Œç”¨ JavaScript ä»£ç æ¥è°ƒç”¨åŸç”Ÿ subtraction å‡½æ•°ã€‚</li>\n</ul><p>é™¤äº† Blockå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ JSExport åè®®æ¥å®ç°åœ¨JavaScriptä¸­è°ƒç”¨åŸç”Ÿä»£ç ï¼Œä¹Ÿå°±æ˜¯åŸç”Ÿä»£ç ä¸­è®©éµå¾ªJSExportåè®®çš„ç±»ï¼Œèƒ½å¤Ÿä¾› JavaScript ä½¿ç”¨ã€‚Weex æ¡†æ¶é‡Œï¼Œå°±æœ‰ä¸ªéµå¾ªäº† JSExport åè®®çš„WXPolyfillSet ç±»ï¼Œä½¿å¾—JavaScript ä¹Ÿèƒ½å¤Ÿä½¿ç”¨åŸç”Ÿä»£ç ä¸­çš„ NSMutableSet ç±»å‹ã€‚</p><p>WXPolyfillSet çš„å¤´æ–‡ä»¶ä»£ç è·¯å¾„æ˜¯ incubator-weex/ios/sdk/WeexSDK/Sources/Bridge/WXPolyfillSet.h ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>@protocol WXPolyfillSetJSExports &lt;JSExport&gt;\n\n// JavaScript å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•\n+ (instancetype)create;\n- (BOOL)has:(id)value;\n- (NSUInteger)size;\n- (void)add:(id)value;\n- (BOOL)delete:(id)value;\n- (void)clear;\n\n@end\n\n// WXPolyfillSet éµå¾ª JSExport åè®®\n@interface WXPolyfillSet : NSObject &lt;WXPolyfillSetJSExports&gt;\n\n@end\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒWXPolyfillSet é€šè¿‡ JSExport åè®®ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ç»™ JavaScript ä½¿ç”¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç†è§£äº†åŸç”Ÿå’Œ JavaScript çš„äº’é€šæ–¹å¼ï¼ŒçŸ¥é“äº†å®ƒä»¬çš„äº’é€šä¾èµ–äºè™šæ‹Ÿæœºç¯å¢ƒJSVirtualMachineã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹JavaScriptCoreå¼•æ“è¿›è¡Œæ›´æ·±å…¥åœ°ç†è§£ï¼Œæ‰èƒ½æ›´å¥½åœ°ç”¨å¥½è¿™ä¸ªæ¡†æ¶ã€‚æ¯”å¦‚ï¼ŒJavaScriptCore æ˜¯æ€ä¹ˆé€šè¿‡ç›´æ¥ä½¿ç”¨ç¼“å­˜ JIT ç¼–è¯‘çš„æœºå™¨ç æ¥æé«˜æ€§èƒ½çš„ï¼Œåˆæ˜¯æ€ä¹ˆå¯¹éƒ¨åˆ†å‡½æ•°è¿›è¡Œé’ˆå¯¹æ€§æµ‹è¯•ç¼–è¯‘ä¼˜åŒ–çš„ã€‚</p><p>JSVirtualMachine æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ JavaScript è™šæ‹Ÿæœºï¼Œæ˜¯æä¾›ç»™å¼€å‘è€…è¿›è¡Œå¼€å‘çš„ï¼Œè€Œå…¶æ ¸å¿ƒçš„ <strong>JavaScriptCore å¼•æ“åˆ™æ˜¯ä¸€ä¸ªçœŸå®çš„è™šæ‹Ÿæœºï¼ŒåŒ…å«äº†è™šæ‹Ÿæœºéƒ½æœ‰çš„è§£é‡Šå™¨å’Œè¿è¡Œæ—¶éƒ¨åˆ†</strong>ã€‚å…¶ä¸­ï¼Œè§£é‡Šå™¨ä¸»è¦ç”¨æ¥å°†é«˜çº§çš„è„šæœ¬è¯­è¨€ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè¿è¡Œæ—¶ä¸»è¦ç”¨æ¥ç®¡ç†è¿è¡Œæ—¶çš„å†…å­˜ç©ºé—´ã€‚å½“å†…å­˜å‡ºç°é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•å†…å­˜é—®é¢˜æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ JavaScriptCore é‡Œçš„ Web Inspectorï¼Œæˆ–è€…é€šè¿‡æ‰‹åŠ¨è§¦å‘ Full GC çš„æ–¹å¼æ¥æ’æŸ¥å†…å­˜é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘è·Ÿä½ è¯´ä¸‹ JavaScriptCore å¼•æ“å†…éƒ¨çš„ç»„æˆã€‚</p><h2>JavaScriptCore å¼•æ“çš„ç»„æˆ</h2><p>JavaScriptCoreå†…éƒ¨æ˜¯ç”± Parserã€Interpreterã€Compilerã€GC ç­‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ Compiler è´Ÿè´£æŠŠå­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨ç ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ã€‚ä½ å¯ä»¥ç‚¹å‡»<a href=\"https://trac.webkit.org/wiki/JavaScriptCore\">è¿™ä¸ªé“¾æ¥</a>ï¼Œæ¥æŸ¥çœ‹WebKit å®˜æ–¹å¯¹JavaScriptCore å¼•æ“çš„ä»‹ç»ã€‚</p><p>JavaScriptCore è§£é‡Šæ‰§è¡Œ JavaScript ä»£ç çš„æµç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤æ­¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œç”± Parser è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œç”Ÿæˆå­—èŠ‚ç ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œç”± Interpreter è¿›è¡Œè§£é‡Šæ‰§è¡Œï¼Œè§£é‡Šæ‰§è¡Œçš„è¿‡ç¨‹æ˜¯å…ˆç”± LLIntï¼ˆLow Level Interpreterï¼‰æ¥æ‰§è¡Œ Parser ç”Ÿæˆçš„å­—èŠ‚ç ï¼ŒJavaScriptCore ä¼šå¯¹è¿è¡Œé¢‘æ¬¡é«˜çš„å‡½æ•°æˆ–è€…å¾ªç¯è¿›è¡Œä¼˜åŒ–ã€‚ä¼˜åŒ–å™¨æœ‰ Baseline JITã€DFG JITã€FTL JITã€‚å¯¹äºå¤šä¼˜åŒ–å±‚çº§åˆ‡æ¢ï¼Œ JavaScriptCore ä½¿ç”¨ OSRï¼ˆOn Stack Replacementï¼‰æ¥ç®¡ç†ã€‚</p><p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°ç†è§£JavaScriptCore å¼•æ“çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¥å‰çš„ä¸€ç¯‡åšæ–‡â€œ<a href=\"https://ming1016.github.io/2018/04/21/deeply-analyse-javascriptcore/\">æ·±å…¥å‰–æ JavaScriptCore</a>â€ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¸»è¦å’Œä½ åˆ†äº«çš„æ˜¯ iOS ä¸­ JavaScriptCore èƒ½å¹²çš„äº‹æƒ…ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒJavaScriptCore æä¾›äº†å‰ç«¯ä¸åŸç”Ÿç›¸äº’è°ƒç”¨çš„æ¥å£ï¼Œæ¥å£å±‚ä¸Šä¸»è¦ç”¨çš„æ˜¯ JSContext å’Œ JSValue è¿™ä¸¤ä¸ªç±»ï¼Œé€šè¿‡ JSValue çš„ evaluateScript æ–¹æ³•ã€Block èµ‹å€¼ contextã€JSExport åè®®å¯¼å‡ºæ¥è¾¾åˆ°äº’é€šçš„æ•ˆæœã€‚</p><p>å‰ç«¯çš„ä¼˜åŠ¿åœ¨äºå¿«é€Ÿç¼–å†™UIï¼ŒåŸç”Ÿçš„ä¼˜åŠ¿åœ¨äºå¯¹å¹³å°ç‰¹æ€§çš„å¤©ç„¶æ”¯æŒï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†èƒ½å¤Ÿæ‰“é€šå‰ç«¯å’ŒåŸç”Ÿçš„æ­¦å™¨ï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨äºŒè€…çš„ä¼˜åŠ¿ï¼Œäº’ä¸ºè¡¥å……åœ°å»åšæ›´å¤šã€æ›´æœ‰æ„æ€çš„äº‹å„¿ã€‚è€Œä½ ï¼Œä¹Ÿå¯ä»¥å……åˆ†å‘æŒ¥è‡ªå·±çš„æƒ³è±¡åŠ›ï¼Œå»å®ç°æ›´æœ‰æ„æ€çš„Appã€‚</p><h2>è¯¾åä½œä¸š</h2><p>å¦‚æœåŸç”Ÿæ–¹æ³•æ²¡æœ‰éµå¾ª JSExport åè®®ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ Block æ–¹å¼è®¾ç½®ç»™ JSContextï¼Œé‚£è¿˜æœ‰æ²¡æœ‰å…¶ä»–åŠæ³•å¯ä»¥åœ¨JavaScriptä¸­è°ƒç”¨åŸç”Ÿä»£ç å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p></p>","comments":[{"had_liked":false,"id":102446,"user_name":"Ansion","can_delete":false,"product_type":"c1","uid":1002049,"ip_address":"","ucode":"FF9AFE77E98BC8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/41/58757849.jpg","comment_is_top":false,"comment_ctime":1560222135,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"78869633463","product_id":100024501,"comment_content":"è¯¾åä½œä¸šï¼š<br>å¯ä»¥å€ŸåŠ©JSContextä¸JSValueçš„ç±»å‹è½¬æ¢å’ŒOCçš„Runtimeæ¶ˆæ¯è½¬å‘æœºåˆ¶å®ç°åŠ¨æ€è°ƒç”¨ï¼Œå·§å¦™é¿å¼€Exportåè®®ï¼›<br>å¯ä»¥å‚è€ƒJSPatchçš„å®ç°åŸç†","like_count":19,"discussions":[{"author":{"id":1471806,"avatar":"https://static001.geekbang.org/account/avatar/00/16/75/3e/71b16443.jpg","nickname":"Struggle","note":"","ucode":"C769D8FFD9C1B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290798,"discussion_content":"JSPatchä¸æ˜¯ä½¿ç”¨äº†JSContextçš„blockæ¥è®©javascriptè°ƒç”¨ocçš„å—ï¼Œç„¶åocæ‰ç”¨runtimeå»å¤„ç†çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594607583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1010399,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLMGCcYZHdAJg7CpoO4kF7srVDkyO2yXRMia9ck74nMbGwjzXYicVfAuYDqz6oUeOswm4Z78CWkPVQ/132","nickname":"æ‘‡æ‘†è¿ˆå…‹","note":"","ucode":"721F2046C8D6BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1707,"discussion_content":"æ€»çš„æ¶ˆæ¯åˆ†å‘çš„å…¥å£è¿˜æ˜¯è¦ç”¨JSExportæˆ–è€…Blockæ–¹å¼æ¥å®ç°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562833827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102552,"user_name":"å“ˆ","can_delete":false,"product_type":"c1","uid":1453904,"ip_address":"","ucode":"3F46ADFFBC94CE","user_header":"https://static001.geekbang.org/account/avatar/00/16/2f/50/b46a9b6a.jpg","comment_is_top":false,"comment_ctime":1560250046,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31625021118","product_id":100024501,"comment_content":"WKWebViewç”¨ä¸åˆ°JavaScripCoreå§â€¦æ¯•ç«Ÿå–ä¸åˆ°JSContextâ€¦","like_count":7,"discussions":[{"author":{"id":1010399,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLMGCcYZHdAJg7CpoO4kF7srVDkyO2yXRMia9ck74nMbGwjzXYicVfAuYDqz6oUeOswm4Z78CWkPVQ/132","nickname":"æ‘‡æ‘†è¿ˆå…‹","note":"","ucode":"721F2046C8D6BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1708,"discussion_content":"WKWebViewç”¨çš„è¿˜æ˜¯JSCoreå•Šï¼Œè·ŸUIWebViewæ¯”è¾ƒå¤šäº†JIT","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562833899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102387,"user_name":"kevin","can_delete":false,"product_type":"c1","uid":1461532,"ip_address":"","ucode":"8BF4D9E4C11EF7","user_header":"https://static001.geekbang.org/account/avatar/00/16/4d/1c/2512341d.jpg","comment_is_top":false,"comment_ctime":1560214940,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23035051420","product_id":100024501,"comment_content":"è¿™é‡Œè®²çš„æ–¹å¼è¿˜æ˜¯åŸºäºuiwebview hybridå¼€å‘ï¼Œwkwebview è¿˜æ˜¯å¾ˆå¤§çš„ä¸åŒå§ï¼Œç°åœ¨ç”¨webviewjavascriptbrigdeå¤šä¸€äº›ã€‚","like_count":5,"discussions":[{"author":{"id":2120213,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/dhGrw9HgLURfHhoYSyqIbWfp3fBM82Hun2jfy4BBqtI1icsSiadMYbBjic4s0MR8jatGZfbkvzENvfCFY9IPk6hzQ/132","nickname":"Apple_b22154","note":"","ucode":"F39073E94E4A1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301108,"discussion_content":"JSBridge å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯ binding. æ¨èè¿™ä¸€ç¯‡æ–‡ç« ã€‚\nhttp://www.awhisper.net/2019/03/03/native-dynamic/","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598409307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144026,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1571827361,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14456729249","product_id":100024501,"comment_content":"è€å¸ˆï¼Œä½ åœ¨æ–‡ä¸­è¯´â€œJSContext ä¼šè°ƒç”¨ evaluateScript æ–¹æ³•ï¼Œè¿”å› JSValue å¯¹è±¡ã€‚â€ï¼Œåº”è¯¥æ˜¯ç”ŸæˆJSValue å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿”å›å§ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249862,"discussion_content":"Returns  The last value generated by the script. Note that a script can result in the JavaScript value undefined.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587968429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249860,"discussion_content":"å…ˆç”Ÿæˆï¼Œåœ¨è¿”å›å“ˆã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587968319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103573,"user_name":"æ·¡","can_delete":false,"product_type":"c1","uid":1456392,"ip_address":"","ucode":"6856CA319DE2F0","user_header":"https://static001.geekbang.org/account/avatar/00/16/39/08/09055b47.jpg","comment_is_top":false,"comment_ctime":1560474012,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14445375900","product_id":100024501,"comment_content":"æˆ´è€å¸ˆä½ å¥½ï¼Œè¯·é—®åé¢ä¼šè®²è§£é€šè¿‡WKWebviewæ¥æ„å»ºhybrid appå—ï¼Ÿç›®å‰æ­£åœ¨ç”¨vue.jså†™å‰ç«¯ï¼Œç”¨WKWebviewä½œwebå®¹å™¨ï¼Œä¸çŸ¥é“ä¸šç•Œæ˜¯æ€ä¹ˆæ‰“é€ è‡ªå·±çš„hybrid appçš„ï¼Œè¿˜è¯·ç»™äº›æŒ‡å¯¼ï¼Œè°¢è°¢ã€‚","like_count":3,"discussions":[{"author":{"id":1478519,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8f/77/c3a080cd.jpg","nickname":"ç™½æ¬£","note":"","ucode":"7754425C270C59","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":15270,"discussion_content":"æœ‰æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ¡ˆäº†å•Š åŒå­¦ æˆ‘ä¹Ÿæƒ³è¿™ä¹ˆæä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568813487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1456392,"avatar":"https://static001.geekbang.org/account/avatar/00/16/39/08/09055b47.jpg","nickname":"æ·¡","note":"","ucode":"6856CA319DE2F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1478519,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8f/77/c3a080cd.jpg","nickname":"ç™½æ¬£","note":"","ucode":"7754425C270C59","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":174522,"discussion_content":"æˆ‘æ˜¯é€šè¿‡å†™WKWebviewBridge+Vueæ¥åšHybrid appçš„ï¼Œç›®å‰å·²å®ç°ï¼Œæ„Ÿè§‰è¿˜è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581924690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":15270,"ip_address":""},"score":174522,"extra":""}]}]},{"had_liked":false,"id":102482,"user_name":"Xqqq0","can_delete":false,"product_type":"c1","uid":1335462,"ip_address":"","ucode":"38C05366ACB23B","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/a6/3614094e.jpg","comment_is_top":false,"comment_ctime":1560233490,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14445135378","product_id":100024501,"comment_content":"ä¸çŸ¥é“å¤§ç¥ä¼šä¸ä¼šè®²NSURLProtocolçš„å®æˆ˜ï¼Œå¸Œæœ›ä¼šğŸ™ğŸ™ğŸ™","like_count":3},{"had_liked":false,"id":173131,"user_name":"jun","can_delete":false,"product_type":"c1","uid":1799617,"ip_address":"","ucode":"73294487897025","user_header":"https://static001.geekbang.org/account/avatar/00/1b/75/c1/3d350d18.jpg","comment_is_top":false,"comment_ctime":1579430892,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10169365484","product_id":100024501,"comment_content":"â€œJavaScriptCore æ¡†æ¶çš„æ¡†æ¶åæ˜¯ JavaScriptCore.frameworkã€‚ç”±äºè‹¹æœå…¬å¸çš„ç³»ç»Ÿå·²ç»å†…ç½®äº† JavaScriptCore æ¡†æ¶ï¼Œè€Œä¸”æ€§èƒ½ä¸é€Šè‰²äº V8 å’Œ SpiderMonkey ç­‰å…¶ä»–å¼•æ“ï¼Œæ‰€ä»¥å‰ç«¯å¼€å‘ App æ¡†æ¶å°±éƒ½ä¸çº¦è€ŒåŒå°† JavaScriptCore æ¡†æ¶ä½œä¸ºè‡ªå·±å’ŒåŸç”Ÿçš„æ¡¥æ¢ã€‚â€<br>è¿™é‡Œä¼šè¯¯å¯¼äººå§ï¼Œä½ ç¡®å®šAppä½¿ç”¨å…¶ä»–JSå¼•æ“èƒ½é€šè¿‡è‹¹æœå®¡æ ¸ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1457016,"avatar":"https://static001.geekbang.org/account/avatar/00/16/3b/78/027117d9.jpg","nickname":"ê§à¼ºè‹æ ¼à¼»ê§‚","note":"","ucode":"5ECC1640A82551","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305754,"discussion_content":"è¿™å°±æ˜¯ Chrome for iOS ä¸ºä½•æ— æ³•ä½¿ç”¨è‡ªä¸»ç ”å‘çš„ Chromium WebKit å’Œ V8 çš„åŸå› ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600076182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105789,"user_name":"å­¦æ— æ­¢å¢ƒ","can_delete":false,"product_type":"c1","uid":1350473,"ip_address":"","ucode":"FC13803A5A3E9E","user_header":"https://static001.geekbang.org/account/avatar/00/14/9b/49/33b2da58.jpg","comment_is_top":false,"comment_ctime":1561084205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5856051501","product_id":100024501,"comment_content":"WebViewJavascriptBridge","like_count":1},{"had_liked":false,"id":342103,"user_name":"å°åƒ","can_delete":false,"product_type":"c1","uid":1286065,"ip_address":"","ucode":"8A1274AD7B87F0","user_header":"https://static001.geekbang.org/account/avatar/00/13/9f/b1/ae61b184.jpg","comment_is_top":false,"comment_ctime":1650015051,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650015051","product_id":100024501,"comment_content":"æˆ‘ä»¬åˆ©ç”¨WKUIDelegateï¼Œè‡ªå·±å¤„ç†H5è°ƒç”¨çš„Promptå¼¹æ¡†äº‹ä»¶ï¼Œé€šè¿‡å’Œå‰ç«¯çº¦å®šå¥½çš„å‚æ•°æ ¼å¼ï¼Œæ¥å®ç°jsè°ƒç”¨åŸç”Ÿã€‚å¹¶ä¸”æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è¿”å›jsç»“æœã€‚","like_count":1},{"had_liked":false,"id":159097,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1456533,"ip_address":"","ucode":"812208DE6C6A7B","user_header":"https://static001.geekbang.org/account/avatar/00/16/39/95/c442a6cc.jpg","comment_is_top":false,"comment_ctime":1575537299,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1575537299","product_id":100024501,"comment_content":"æ‚¨å¥½æˆ´è€å¸ˆï¼Œä¸€ç›´éƒ½åœ¨å¬æ‚¨çš„è¯¾ç¨‹ï¼Œç°åœ¨æˆ‘å¾ˆè¿·èŒ«ï¼Œä¸€ç›´åœ¨åšiosåŸç”Ÿå¼€å‘ï¼Œæƒ³å­¦æ–°ä¸œè¥¿ä½†æ˜¯ä¸çŸ¥é“è¯¥å­¦ä¹ ä»€ä¹ˆï¼Œçƒ¦è¯·æˆ´è€å¸ˆçœ‹åˆ°èƒ½ç»™ä¸ªæŒ‡å¼•ï¼Œæ„Ÿæ¿€ä¸å°½è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1234311,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d5/87/7b6b7a90.jpg","nickname":"bluceî™","note":"","ucode":"5BBD82416509F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362166,"discussion_content":"è‡ªå·±çš„è·¯è‡ªå·±èµ°ï¼Œä½ çš„äººç”Ÿè¿·èŒ«å¤šçœ‹ä¹¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616860044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1079152,"avatar":"https://static001.geekbang.org/account/avatar/00/10/77/70/466368e1.jpg","nickname":"æ°æ£®è«ç›","note":"","ucode":"A29AEC27270657","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273528,"discussion_content":"æ ¹æ®å·¥ä½œéœ€è¦åŠè‡ªå·±çš„å…´è¶£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590467399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144025,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1571827219,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571827219","product_id":100024501,"comment_content":"è€å¸ˆï¼Œä½ åœ¨æ–‡ä¸­è¯´â€œåŸç”Ÿçº¿ç¨‹å¯ä»¥å°†ç±»æ–¹æ³•å’Œå±æ€§æä¾›ç»™ JavaScriptCore ä½¿ç”¨ï¼ŒJavaScriptCore å¯ä»¥å°† JSValue æä¾›ç»™åŸç”Ÿçº¿ç¨‹ä½¿ç”¨ã€‚â€ï¼Œä¸ºä»€ä¹ˆå¯ä»¥å°†ç±»æ–¹æ³•æä¾›ç»™ JavaScriptCore ä½¿ç”¨ï¼Ÿå¯¹è±¡æ–¹æ³•ä¸è¡Œä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2449060,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5e/a4/d48b8298.jpg","nickname":"Geek_sz","note":"","ucode":"72E86D7D6554CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532401,"discussion_content":"åŸæ–‡å†™çš„æœ‰æ­§ä¹‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637593554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249866,"discussion_content":"ä½ æ˜¯ä¸æ˜¯ç†è§£é”™äº†ï¼Ÿè€å¸ˆè¯´çš„æ˜¯ç±»çš„æ–¹æ³•å’Œå±æ€§ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587968617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143788,"user_name":"Sunny","can_delete":false,"product_type":"c1","uid":1305257,"ip_address":"","ucode":"BB7B274CE0672E","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg","comment_is_top":false,"comment_ctime":1571792213,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571792213","product_id":100024501,"comment_content":"è€å¸ˆï¼Œæ‚¨åœ¨æ–‡ä¸­å¤šæ¬¡æåˆ°äº†â€œå­—èŠ‚ç â€ï¼Œå®ƒå…·ä½“æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249868,"discussion_content":"ä¸CPUæ¶æ„æ— å…³çš„äºŒè¿›åˆ¶å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587968662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122710,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1565495917,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1565495917","product_id":100024501,"comment_content":"è€å¸ˆï¼Œä½ è¯´â€œå‰ç«¯çš„ä¼˜åŠ¿åœ¨äºå¿«é€Ÿç¼–å†™ UIï¼ŒåŸç”Ÿçš„ä¼˜åŠ¿åœ¨äºå¯¹å¹³å°ç‰¹æ€§çš„å¤©ç„¶æ”¯æŒâ€ï¼Œè¿™æœ‰ç‚¹æŠ½è±¡ï¼Œæœ‰æ²¡æœ‰å……åˆ†ç»“åˆè¿™ä¸¤è€…ä¼˜åŠ¿çš„æ¡ˆä¾‹å‚è€ƒä¸€ä¸‹ã€‚è°¢è°¢ï¼","like_count":0,"discussions":[{"author":{"id":1079152,"avatar":"https://static001.geekbang.org/account/avatar/00/10/77/70/466368e1.jpg","nickname":"æ°æ£®è«ç›","note":"","ucode":"A29AEC27270657","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273532,"discussion_content":"æˆ‘è§‰å¾—æ„æ€æ˜¯è·¨å¹³å°æŠŠï¼Œä¸€å¥—ä»£ç è¿è¡Œåœ¨å¤šç«¯ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590467833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102374,"user_name":"æˆ‘ç³»å“†å•¦","can_delete":false,"product_type":"c1","uid":1258151,"ip_address":"","ucode":"109A96943F1DDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/32/a7/3f3e05fa.jpg","comment_is_top":false,"comment_ctime":1560214246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560214246","product_id":100024501,"comment_content":"æ²™å‘ï¼Ÿ","like_count":0}]}