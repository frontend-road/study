{"id":201164,"title":"30 | 领域事件：提升业务内聚，实现模块解耦","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":180253,"user_name":"清涧飞鸟","can_delete":false,"product_type":"c3","uid":1706683,"ip_address":"","ucode":"15F3B5FD4D7822","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0a/bb/2f3b6af3.jpg","comment_is_top":false,"comment_ctime":1582221317,"is_pvip":false,"replies":[{"id":70467,"content":"领域服务操作领域模型来实现业务目的\n\n领域事件的作用是将领域服务的业务动作的“副作用”，从领域服务的逻辑中抽离出来，这里的副作用就是”当a做xx事情时，b就怎么怎么样“的表达。\n\n复杂的业务中，一个领域事件有多个处理handler是正常的，这写handler分别专注不同业务对象的逻辑。\n\n跨聚合的业务，一般处理为领域事件\n跨服务的业务，一般处理为集成事件","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582695480,"ip_address":"","comment_id":180253,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，有如下几个问题：\n1）DDD中有领域服务与领域事件之分，这两个术语如何界定？\n2）我们使用了领域事件，那复杂的业务系统中N个业务方法，要定义N个Handler？\n3)  跨聚合的业务处理与跨服务的业务处理我们分别写在哪一层？","like_count":5,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484586,"discussion_content":"领域服务操作领域模型来实现业务目的\n\n领域事件的作用是将领域服务的业务动作的“副作用”，从领域服务的逻辑中抽离出来，这里的副作用就是”当a做xx事情时，b就怎么怎么样“的表达。\n\n复杂的业务中，一个领域事件有多个处理handler是正常的，这写handler分别专注不同业务对象的逻辑。\n\n跨聚合的业务，一般处理为领域事件\n跨服务的业务，一般处理为集成事件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582695480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219082,"user_name":"王亚","can_delete":false,"product_type":"c3","uid":1810841,"ip_address":"","ucode":"765CDC2A4DF8CF","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a1/99/137f5ff7.jpg","comment_is_top":false,"comment_ctime":1589941412,"is_pvip":false,"replies":[{"id":81335,"content":"实际上进程内的领域事件handler可以在同一个事务里执行的，由SaveEntitiesAsync的实现里决定的","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1590235688,"ip_address":"","comment_id":219082,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师 我还有个疑问 领域内的事件用事务替代岂不是更好吗？ 这样就不会操作多次数据库了  事务一次搞定","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495677,"discussion_content":"实际上进程内的领域事件handler可以在同一个事务里执行的，由SaveEntitiesAsync的实现里决定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590235688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193451,"user_name":"小孩","can_delete":false,"product_type":"c3","uid":1112367,"ip_address":"","ucode":"A7F587FC641E63","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/2f/01b32495.jpg","comment_is_top":false,"comment_ctime":1584893560,"is_pvip":false,"replies":[{"id":77166,"content":"感谢建议","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1586876961,"ip_address":"","comment_id":193451,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"肖老师讲的挺好的，不过我觉得有些内容还是要有些宏观的铺垫，要不直接来看代码大家会有点儿懵","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488559,"discussion_content":"感谢建议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586876961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009651,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/f3/04ae9565.jpg","nickname":"diorhuang","note":"","ucode":"5F4E196FCCACB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259422,"discussion_content":"最主要是感觉不知道这些技术的应用场景和所解决的问题。直接看代码，没有融入到这个技术里，没有感同身受。之后基本看过就忘...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588777135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180879,"user_name":"tutu","can_delete":false,"product_type":"c3","uid":1808563,"ip_address":"","ucode":"50026CB0CADBDE","user_header":"","comment_is_top":false,"comment_ctime":1582434210,"is_pvip":false,"replies":[{"id":70505,"content":"可以到github上向CAP项目提issue","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582718198,"ip_address":"","comment_id":180879,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"我改成SqlServer数据库连接，为什么执行到_capPublisher.Publish(&quot;OrderCreated&quot;, new OrderCreatedIntegrationEvent(notification.Order.Id));这部的时候会报错，提示Microsoft.Data.SqlClient.SqlException:““`”附近有语法错误。”","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484829,"discussion_content":"可以到github上向CAP项目提issue","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582718198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213927,"discussion_content":"看一下源码，看具体原因是什么。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585135249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062444,"avatar":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","nickname":"小喵喵","note":"","ucode":"FDBBB2A59DB8B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201295,"discussion_content":"CAP项目的地址是什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583768967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813098,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/6a/fade4619.jpg","nickname":"顾你心安","note":"","ucode":"D0080EBA52CFBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":182726,"discussion_content":"同问啊  一样的问题？ 求解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582452055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180436,"user_name":"CHECKY","can_delete":false,"product_type":"c3","uid":1390340,"ip_address":"","ucode":"C2045A4A8BD11C","user_header":"https://static001.geekbang.org/account/avatar/00/15/37/04/a81180e7.jpg","comment_is_top":false,"comment_ctime":1582280834,"is_pvip":false,"replies":[{"id":70457,"content":"感谢反馈，后面会考虑补充说明一下","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1582691109,"ip_address":"","comment_id":180436,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"是不是要先了解下DDD，跟不上了。","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484665,"discussion_content":"感谢反馈，后面会考虑补充说明一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582691109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213928,"discussion_content":"可以先看看《DDD实战》一课。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585135266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207554,"user_name":"tommy","can_delete":false,"product_type":"c3","uid":1562330,"ip_address":"","ucode":"D0052132881A36","user_header":"https://static001.geekbang.org/account/avatar/00/17/d6/da/18982b86.jpg","comment_is_top":false,"comment_ctime":1587107144,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师  能不要上来就看代码吗    开始的时候介绍点理论做铺垫","like_count":5,"discussions":[{"author":{"id":1323537,"avatar":"https://static001.geekbang.org/account/avatar/00/14/32/11/a25a0127.jpg","nickname":"Jack the Pipper","note":"","ucode":"20BDB41F616534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288743,"discussion_content":"这跟拿一个代码 让你对着敲 就完事。有什么区别。超级不友好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593857173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302648,"user_name":"Geek_108fd5","can_delete":false,"product_type":"c3","uid":2681209,"ip_address":"","ucode":"F6D47925666CDE","user_header":"","comment_is_top":false,"comment_ctime":1626314117,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老師可以請教以下幾個問題嗎：\n1. Project 如果越來越大,Ｄomain也會越來越多,這樣相對的Domain Event也會越來越多,在這樣的情況下,要怎麼確保結構不會越來越肥大而難以理解呢？\n2. Domain的操作有些時候會有較複雜的查詢Query指令,而不是單純的Find key,有些情況下會需要各種不同情境下的查詢&amp;Join這樣的情況下,是不是Domain Event也會越來越多ex:\n   OrderCreateDomainHandler,OrderJoinUserDomainHandler等等,還是說Domain Event只會用來處理 \bCreate Update Delete等需要操作資料的操作呢？","like_count":0},{"had_liked":false,"id":271658,"user_name":"上善若水","can_delete":false,"product_type":"c3","uid":1199746,"ip_address":"","ucode":"E95D2C010807AE","user_header":"https://static001.geekbang.org/account/avatar/00/12/4e/82/67ece8b8.jpg","comment_is_top":false,"comment_ctime":1609749748,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"请问老师，domainEntities.ToList().ForEach(entity =&gt; entity.Entity.ClearDomainEvents()); 这一步操作的目的是什么，为什么要进行清除实体中的领域事件？如果不清除，会有什么问题吗？多谢","like_count":0,"discussions":[{"author":{"id":2681209,"avatar":"","nickname":"Geek_108fd5","note":"","ucode":"F6D47925666CDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384397,"discussion_content":"我的看法是 因為這個Transaction要提交了 所以先將提交事件都取出之後 將事件刪除,避免得下次操作同一個類型的Entity出現重複操作相同領域事件的事情發生, 如有錯誤(麻煩更正 謝謝~)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626568364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}