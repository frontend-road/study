{"id":8942,"title":"20 | 高性能负载均衡：分类及架构","content":"<p>单服务器无论如何优化，无论采用多好的硬件，总会有一个性能天花板，当单服务器的性能无法满足业务需求时，就需要设计高性能集群来提升系统整体的处理性能。</p>\n<p>高性能集群的本质很简单，通过增加更多的服务器来提升系统整体的计算能力。由于计算本身存在一个特点：同样的输入数据和逻辑，无论在哪台服务器上执行，都应该得到相同的输出。因此高性能集群设计的复杂度主要体现在任务分配这部分，需要设计合理的任务分配策略，将计算任务分配到多台服务器上执行。</p>\n<p><strong>高性能集群的复杂性主要体现在需要增加一个任务分配器，以及为任务选择一个合适的任务分配算法</strong>。对于任务分配器，现在更流行的通用叫法是“负载均衡器”。但这个名称有一定的误导性，会让人潜意识里认为任务分配的目的是要保持各个计算单元的负载达到均衡状态。而实际上任务分配并不只是考虑计算单元的负载均衡，不同的任务分配算法目标是不一样的，有的基于负载考虑，有的基于性能（吞吐量、响应时间）考虑，有的基于业务考虑。考虑到“负载均衡”已经成为了事实上的标准术语，这里我也用“负载均衡”来代替“任务分配”，但请你时刻记住，<strong>负载均衡不只是为了计算单元的负载达到均衡状态</strong>。</p>\n<p>今天我先来讲讲<span class=\"orange\">负载均衡的分类及架构</span>，下一期会讲负载均衡的算法。</p>\n<h2>负载均衡分类</h2>\n<p>常见的负载均衡系统包括3种：DNS负载均衡、硬件负载均衡和软件负载均衡。</p>\n<!-- [[[read_end]]] -->\n<p><strong>DNS负载均衡</strong></p>\n<p>DNS是最简单也是最常见的负载均衡方式，一般用来实现地理级别的均衡。例如，北方的用户访问北京的机房，南方的用户访问深圳的机房。DNS负载均衡的本质是DNS解析同一个域名可以返回不同的IP地址。例如，同样是www.baidu.com，北方用户解析后获取的地址是61.135.165.224（这是北京机房的IP），南方用户解析后获取的地址是14.215.177.38（这是深圳机房的IP）。</p>\n<p>下面是DNS负载均衡的简单示意图：</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/db/2f/dbb61acde016acb2f57212d627d2732f.jpg?wh=920*802\" alt=\"\" /></p>\n<p>DNS负载均衡实现简单、成本低，但也存在粒度太粗、负载均衡算法少等缺点。仔细分析一下优缺点，其优点有：</p>\n<ul>\n<li>\n<p>简单、成本低：负载均衡工作交给DNS服务器处理，无须自己开发或者维护负载均衡设备。</p>\n</li>\n<li>\n<p>就近访问，提升访问速度：DNS解析时可以根据请求来源IP，解析成距离用户最近的服务器地址，可以加快访问速度，改善性能。</p>\n</li>\n</ul>\n<p>缺点有：</p>\n<ul>\n<li>\n<p>更新不及时：DNS缓存的时间比较长，修改DNS配置后，由于缓存的原因，还是有很多用户会继续访问修改前的IP，这样的访问会失败，达不到负载均衡的目的，并且也影响用户正常使用业务。</p>\n</li>\n<li>\n<p>扩展性差：DNS负载均衡的控制权在域名商那里，无法根据业务特点针对其做更多的定制化功能和扩展特性。</p>\n</li>\n<li>\n<p>分配策略比较简单：DNS负载均衡支持的算法少；不能区分服务器的差异（不能根据系统与服务的状态来判断负载）；也无法感知后端服务器的状态。</p>\n</li>\n</ul>\n<p>针对DNS负载均衡的一些缺点，对于时延和故障敏感的业务，有一些公司自己实现了HTTP-DNS的功能，即使用HTTP协议实现一个私有的DNS系统。这样的方案和通用的DNS优缺点正好相反。</p>\n<p><strong>硬件负载均衡</strong></p>\n<p>硬件负载均衡是通过单独的硬件设备来实现负载均衡功能，这类设备和路由器、交换机类似，可以理解为一个用于负载均衡的基础网络设备。目前业界典型的硬件负载均衡设备有两款：F5和A10。这类设备性能强劲、功能强大，但价格都不便宜，一般只有“土豪”公司才会考虑使用此类设备。普通业务量级的公司一是负担不起，二是业务量没那么大，用这些设备也是浪费。</p>\n<p>硬件负载均衡的优点是：</p>\n<ul>\n<li>\n<p>功能强大：全面支持各层级的负载均衡，支持全面的负载均衡算法，支持全局负载均衡。</p>\n</li>\n<li>\n<p>性能强大：对比一下，软件负载均衡支持到10万级并发已经很厉害了，硬件负载均衡可以支持100万以上的并发。</p>\n</li>\n<li>\n<p>稳定性高：商用硬件负载均衡，经过了良好的严格测试，经过大规模使用，稳定性高。</p>\n</li>\n<li>\n<p>支持安全防护：硬件均衡设备除具备负载均衡功能外，还具备防火墙、防DDoS攻击等安全功能。</p>\n</li>\n</ul>\n<p>硬件负载均衡的缺点是：</p>\n<ul>\n<li>\n<p>价格昂贵：最普通的一台F5就是一台“马6”，好一点的就是“Q7”了。</p>\n</li>\n<li>\n<p>扩展能力差：硬件设备，可以根据业务进行配置，但无法进行扩展和定制。</p>\n</li>\n</ul>\n<p><strong>软件负载均衡</strong></p>\n<p>软件负载均衡通过负载均衡软件来实现负载均衡功能，常见的有Nginx和LVS，其中Nginx是软件的7层负载均衡，LVS是Linux内核的4层负载均衡。4层和7层的区别就在于<strong>协议</strong>和<strong>灵活性</strong>，Nginx支持HTTP、E-mail协议；而LVS是4层负载均衡，和协议无关，几乎所有应用都可以做，例如，聊天、数据库等。</p>\n<p>软件和硬件的最主要区别就在于性能，硬件负载均衡性能远远高于软件负载均衡性能。Nginx的性能是万级，一般的Linux服务器上装一个Nginx大概能到5万/秒；LVS的性能是十万级，据说可达到80万/秒；而F5性能是百万级，从200万/秒到800万/秒都有（数据来源网络，仅供参考，如需采用请根据实际业务场景进行性能测试）。当然，软件负载均衡的最大优势是便宜，一台普通的Linux服务器批发价大概就是1万元左右，相比F5的价格，那就是自行车和宝马的区别了。</p>\n<p>除了使用开源的系统进行负载均衡，如果业务比较特殊，也可能基于开源系统进行定制（例如，Nginx插件），甚至进行自研。</p>\n<p>下面是Nginx的负载均衡架构示意图：</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/13/35/136afcb3b3bc964f2609127eb27a0235.jpg?wh=1497*1058\" alt=\"\" /></p>\n<p>软件负载均衡的优点：</p>\n<ul>\n<li>\n<p>简单：无论是部署还是维护都比较简单。</p>\n</li>\n<li>\n<p>便宜：只要买个Linux服务器，装上软件即可。</p>\n</li>\n<li>\n<p>灵活：4层和7层负载均衡可以根据业务进行选择；也可以根据业务进行比较方便的扩展，例如，可以通过Nginx的插件来实现业务的定制化功能。</p>\n</li>\n</ul>\n<p>其实下面的缺点都是和硬件负载均衡相比的，并不是说软件负载均衡没法用。</p>\n<ul>\n<li>\n<p>性能一般：一个Nginx大约能支撑5万并发。</p>\n</li>\n<li>\n<p>功能没有硬件负载均衡那么强大。</p>\n</li>\n<li>\n<p>一般不具备防火墙和防DDoS攻击等安全功能。</p>\n</li>\n</ul>\n<h2>负载均衡典型架构</h2>\n<p>前面我们介绍了3种常见的负载均衡机制：DNS负载均衡、硬件负载均衡、软件负载均衡，每种方式都有一些优缺点，但并不意味着在实际应用中只能基于它们的优缺点进行非此即彼的选择，反而是基于它们的优缺点进行组合使用。具体来说，组合的<strong>基本原则</strong>为：DNS负载均衡用于实现地理级别的负载均衡；硬件负载均衡用于实现集群级别的负载均衡；软件负载均衡用于实现机器级别的负载均衡。</p>\n<p>我以一个假想的实例来说明一下这种组合方式，如下图所示。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/79/8d/79f371ecbf74818e2a34b4a31664668d.png?wh=1222*814\" alt=\"\" /></p>\n<p>整个系统的负载均衡分为三层。</p>\n<ul>\n<li>\n<p>地理级别负载均衡：www.xxx.com部署在北京、广州、上海三个机房，当用户访问时，DNS会根据用户的地理位置来决定返回哪个机房的IP，图中返回了广州机房的IP地址，这样用户就访问到广州机房了。</p>\n</li>\n<li>\n<p>集群级别负载均衡：广州机房的负载均衡用的是F5设备，F5收到用户请求后，进行集群级别的负载均衡，将用户请求发给3个本地集群中的一个，我们假设F5将用户请求发给了“广州集群2”。</p>\n</li>\n<li>\n<p>机器级别的负载均衡：广州集群2的负载均衡用的是Nginx，Nginx收到用户请求后，将用户请求发送给集群里面的某台服务器，服务器处理用户的业务请求并返回业务响应。</p>\n</li>\n</ul>\n<p>需要注意的是，上图只是一个示例，一般在大型业务场景下才会这样用，如果业务量没这么大，则没有必要严格照搬这套架构。例如，一个大学的论坛，完全可以不需要DNS负载均衡，也不需要F5设备，只需要用Nginx作为一个简单的负载均衡就足够了。</p>\n<h2>小结</h2>\n<p>今天我为你讲了负载均衡的常见分类以及典型架构，希望对你有所帮助。</p>\n<p>这就是今天的全部内容，留一道思考题给你吧，假设你来设计一个日活跃用户1000万的论坛的负载均衡集群，你的方案是什么？设计理由是什么？</p>\n<p>欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）</p>\n","neighbors":{"left":{"article_title":"19 | 单服务器高性能模式：Reactor与Proactor","id":8805},"right":{"article_title":"21 | 高性能负载均衡：算法","id":9055}},"comments":[{"had_liked":false,"id":12389,"user_name":"鹅米豆发","can_delete":false,"product_type":"c1","uid":1017687,"ip_address":"","ucode":"98E8D911EE32DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","comment_is_top":false,"comment_ctime":1528791763,"is_pvip":false,"replies":[{"id":4068,"content":"思路不错👍👍","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528808206,"ip_address":"","comment_id":12389,"utype":1}],"discussion_count":26,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"       日活千万的论坛，这个流量不低了。\r\n1、首先，流量评估。\n       1000万DAU，换算成秒级，平均约等于116。\r\n考虑每个用户操作次数，假定10，换算成平均QPS=1160。\r\n       考虑峰值是均值倍数，假定10，换算成峰值QPS=11600。\r\n       考虑静态资源、图片资源、服务拆分等，流量放大效应，假定10，QPS*10=116000。 \r\n2、其次，容量规划。\r\n       考虑高可用、异地多活，QPS*2=232000。\r\n       考虑未来半年增长，QPS*1.5=348000。\r\n3、最后，方案设计。\r\n       三级导流。\r\n       第一级，DNS，确定机房，以目前量级，可以不考虑。\r\n       第二级，确定集群，扩展优先，则选Haproxy&#47;LVS，稳定优先则选F5。\r\n       第三级，Nginx+KeepAlived，确定实例。","like_count":393},{"had_liked":false,"id":21778,"user_name":"无聊夫斯基","can_delete":false,"product_type":"c1","uid":1194071,"ip_address":"","ucode":"F7BC3346FFF5EC","user_header":"https://static001.geekbang.org/account/avatar/00/12/38/57/a9f9705a.jpg","comment_is_top":false,"comment_ctime":1535332006,"is_pvip":false,"replies":[{"id":7787,"content":"T=transaction，代表写请求\nQ=query，代表读请求","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1535342345,"ip_address":"","comment_id":21778,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我还是不是很理解TPS和QPS具体的区别","like_count":88,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419241,"discussion_content":"思路不错👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528808206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463711,"avatar":"","nickname":"大平子","note":"","ucode":"D2FD7E769B2C3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338032,"discussion_content":"我个人觉得应该是2-8原则，80%流量集中在20%的时间，也就是24小时*0.2=4个小时，姑且说是6个小时的高峰，也就是高峰时期操作次数达到来460","likes_number":17,"is_delete":false,"is_hidden":false,"ctime":1609158650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":255624,"discussion_content":"同问异地多活x2的问题","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588417064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1086592,"avatar":"https://static001.geekbang.org/account/avatar/00/10/94/80/70e483f6.jpg","nickname":"任锋","note":"","ucode":"8C32C85A61C426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261249,"discussion_content":"为啥呢 大神","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588948501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":255624,"ip_address":"","group_id":0},"score":261249,"extra":""},{"author":{"id":1079898,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7a/5a/4dfb21f7.jpg","nickname":"毕成功 Antony","note":"","ucode":"32219043046F62","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337876,"discussion_content":"异地多活要看具体是怎么实现的。比较理想的情况，数据分片不会有流量穿透，这样其实QPS总量不变。但如果是数据库还是单点或者还要同步保持全量，这可以简单理解成流量还是放大了一倍。当然，即便如此，简单把QPS乘以2也对整体规划参考意义不大，可以作为一个独立场景来考虑。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609115474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":255624,"ip_address":"","group_id":0},"score":337876,"extra":""}]},{"author":{"id":1073596,"avatar":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","nickname":"亮点","note":"","ucode":"1B8AE07484C69A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55657,"discussion_content":"高可用 异地多活 为啥乘2","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574387677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1017687,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","nickname":"鹅米豆发","note":"","ucode":"98E8D911EE32DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1073596,"avatar":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","nickname":"亮点","note":"","ucode":"1B8AE07484C69A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282805,"discussion_content":"容量预估的冗余。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1592096955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55657,"ip_address":"","group_id":0},"score":282805,"extra":""}]},{"author":{"id":1072722,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/52/abb7bfe3.jpg","nickname":"leowong","note":"","ucode":"59032C778B5C86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50812,"discussion_content":"什么是流量放大效应？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573776890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1017687,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","nickname":"鹅米豆发","note":"","ucode":"98E8D911EE32DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1072722,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/52/abb7bfe3.jpg","nickname":"leowong","note":"","ucode":"59032C778B5C86","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282803,"discussion_content":"一次用户访问，可能对应了多个下游服务的执行。执行的链路越长，这个调用次数的乘数照应越大。在有效编排下这个效应可以缓解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592096827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50812,"ip_address":"","group_id":0},"score":282803,"extra":""}]},{"author":{"id":2681807,"avatar":"https://static001.geekbang.org/account/avatar/00/28/eb/cf/29d4a8b9.jpg","nickname":"九三二十七","note":"","ucode":"FDB28EE80551A5","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655522,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735135004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2312222,"avatar":"https://static001.geekbang.org/account/avatar/00/23/48/1e/f8f3c881.jpg","nickname":"束","note":"","ucode":"61DA0598597F0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":602288,"discussion_content":"mk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675728925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3216493,"avatar":"","nickname":"舒秉亮","note":"","ucode":"A723B37C82EC46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594330,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668993207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2935759,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/cb/cf/fc97de76.jpg","nickname":"Geektimer","note":"","ucode":"13746813BA173A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582947,"discussion_content":"不过应该按照12个小时算吧，其实晚上的时候QPS就降下来了，所以还的往高评估","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659795265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fb/58/6c422e70.jpg","nickname":"清晨吼于林","note":"","ucode":"6ADCB9B9FB8330","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555836,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647078220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1671394,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/8KpWhCMxgVgqKMxNT9zuJuVnz1gNBzYlWrZCO4hlF4OQibhawvn0hpHhHgHr4kSXfVNjeuE4StuvTR54NGcE4Zg/132","nickname":"Geek_aa780e","note":"","ucode":"20C49732158424","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553675,"discussion_content":"马克，学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646025024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2652995,"avatar":"https://static001.geekbang.org/account/avatar/00/28/7b/43/20cf4dd0.jpg","nickname":"aimin","note":"","ucode":"7001E627F33B5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550803,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644737097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1259156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/94/0b969588.jpg","nickname":"青年祭司","note":"","ucode":"C88EDAE3FF09AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393853,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631619096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118111,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","nickname":"见南山","note":"","ucode":"6A8BB82B7573CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386838,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627831434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1994321,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6e/51/17a8e5e5.jpg","nickname":"hammer","note":"","ucode":"DA7913D62495AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385519,"discussion_content":"马克学习","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627110432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1443365,"avatar":"https://static001.geekbang.org/account/avatar/00/16/06/25/5461385f.jpg","nickname":"学无止境0033","note":"","ucode":"6332DA0B9FF989","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378568,"discussion_content":"马克","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623289895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338834,"discussion_content":"思路很清晰, 学习了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609398202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2366248,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","nickname":"那那那","note":"","ucode":"04FD2412BB30D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334443,"discussion_content":"千万日活的差不多平时10几万的qps了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607849359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1900299,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ff/0b/795348b1.jpg","nickname":"孙彦科","note":"","ucode":"F938EC7D3235B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330975,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606742353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066752,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","nickname":"piboye","note":"","ucode":"7CFD8712857A85","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301223,"discussion_content":"一个论坛为什么是用户每秒有10次请求？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598445244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1160192,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","nickname":"追忆似水年华","note":"","ucode":"C1D7C0DD7E7411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1066752,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","nickname":"piboye","note":"","ucode":"7CFD8712857A85","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":310193,"discussion_content":"用户请求一个页面，浏览器的话，并发连接数是5、6左右，考虑到小文件加载很快，就把每秒的请求预估为10次左右了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601685324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301223,"ip_address":"","group_id":0},"score":310193,"extra":""}]},{"author":{"id":1313840,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0c/30/d4737cd5.jpg","nickname":"lyonger","note":"","ucode":"E89A75DADEA2A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203235,"discussion_content":"大神，有空求解答上面的问题？我也想知道，哈哈😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584016179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16757,"user_name":"孙振超","can_delete":false,"product_type":"c1","uid":1101755,"ip_address":"","ucode":"0F9EABC6125350","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg","comment_is_top":false,"comment_ctime":1532159275,"is_pvip":false,"replies":[{"id":5845,"content":"最常用的方式","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532255691,"ip_address":"","comment_id":16757,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"这篇文章最大的收获是分析问题的思路，从dau出发，结合业务的特点，计算出来总的qps和tps，而后再根据通常规律计算出qps和tps的峰值，加上一定的未来发展空间和高可用冗余，结合单机能够支撑的qps和tps量，就可以计算出来整个集群的规模，有了这些数据就可以制定出比较合理的负载均衡的策略，而不是无的放矢，凭空猜测。\n\n\n\n","like_count":57,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422858,"discussion_content":"T=transaction，代表写请求\nQ=query，代表读请求","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1535342345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1477120,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia31qc8paRg2uPSB6AuEBDricrSxvFBuTpP3NnnflekpJ7wqvN0nRrJyu7zVbzd7Lwjxw/132","nickname":"Geek_steven_wang","note":"","ucode":"8CC8F4C9726191","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":103838,"discussion_content":"论坛这类http短链接应用，两者相等。tps主要计算服务器连接能力，qps主要是服务器业务处理能力。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1577401116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338836,"discussion_content":"同一个TPS, 可以产生多个QPS\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609398247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2663324,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a3/9c/836d7bb3.jpg","nickname":"11月的萧邦","note":"","ucode":"E7A2236BFD9ABE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386631,"discussion_content":"同意","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627701366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338836,"ip_address":"","group_id":0},"score":386631,"extra":""}]}]},{"had_liked":false,"id":12304,"user_name":"ant","can_delete":false,"product_type":"c1","uid":1043816,"ip_address":"","ucode":"27BAF20679679A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/68/737f97c8.jpg","comment_is_top":false,"comment_ctime":1528764017,"is_pvip":false,"replies":[{"id":4107,"content":"可以达到，但有点复杂，nginx做级联不太合适，因为顶层的nginx性能是瓶颈，多级导流一般用在处理能力有差异的系统上，例如一级用F5，二级用LVS，三级用nginx","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869644,"ip_address":"","comment_id":12304,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"日活跃用户1000万应该就是国家级应用了，面向全国活跃或者全球用户，比如最大的Xxx网站github。这个时候钱应该都不是问题了。我觉得可以考虑异地多机房部署。这样导流之后每个机房的日活就少很多。其实我在想如果在每个机房不加入负载硬件用多个ngnix集群来实现，每个ngnix上会有我们自定义的路由算法。ngnix也架设多层，逐层导流，比如我们一个机房设计承受200万，那么我们可以架设3层ngnix，第一层基于自己的路由算法导流到第2层ngnix。第2层又导流到第3层。为了避免ngnix单点，每一层ngnix部署多。这样导流下流每台服务器所承认的访问不会很多。不知道这样的设计能不能达到要求，老师点评下","like_count":34,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419201,"discussion_content":"可以达到，但有点复杂，nginx做级联不太合适，因为顶层的nginx性能是瓶颈，多级导流一般用在处理能力有差异的系统上，例如一级用F5，二级用LVS，三级用nginx","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1528869644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109389,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/8d/377c106a.jpg","nickname":"KW💤","note":"","ucode":"290DD7016F4EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404322,"discussion_content":"这不脱裤子放屁码...本来就是nginx处理不了那么大的量，上层才需要硬件扛，你上层的nginx还是顶着这么大的量啊","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1634287089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601937,"discussion_content":"都是nginx，瓶颈都一样，你这样做的意义在哪里？F5比nginx并发大所以才能进行前置导流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675509380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188906,"avatar":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","nickname":"汝林外史","note":"","ucode":"3C66C0F0537A99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332470,"discussion_content":"都不差钱了，直接上F5不香吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607231700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12607,"user_name":"何国平","can_delete":false,"product_type":"c1","uid":1101355,"ip_address":"","ucode":"251BA091AF8690","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/2b/a47a0936.jpg","comment_is_top":false,"comment_ctime":1528936365,"is_pvip":false,"replies":[{"id":4156,"content":"我宁愿用LVS，久经考验，性能强大😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528942277,"ip_address":"","comment_id":12607,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"nginx也支持4层反向代理了","like_count":21,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419201,"discussion_content":"可以达到，但有点复杂，nginx做级联不太合适，因为顶层的nginx性能是瓶颈，多级导流一般用在处理能力有差异的系统上，例如一级用F5，二级用LVS，三级用nginx","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1528869644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109389,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/8d/377c106a.jpg","nickname":"KW💤","note":"","ucode":"290DD7016F4EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404322,"discussion_content":"这不脱裤子放屁码...本来就是nginx处理不了那么大的量，上层才需要硬件扛，你上层的nginx还是顶着这么大的量啊","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1634287089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601937,"discussion_content":"都是nginx，瓶颈都一样，你这样做的意义在哪里？F5比nginx并发大所以才能进行前置导流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675509380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188906,"avatar":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","nickname":"汝林外史","note":"","ucode":"3C66C0F0537A99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332470,"discussion_content":"都不差钱了，直接上F5不香吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607231700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15197,"user_name":"老北","can_delete":false,"product_type":"c1","uid":1024376,"ip_address":"","ucode":"89B9B6673F1705","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/78/71d37164.jpg","comment_is_top":false,"comment_ctime":1530980266,"is_pvip":false,"replies":[{"id":5199,"content":"确实有点吓人，千万日活转换为百万同时在线这里有问题，一般把日活转换为pv，例如平均每个用户会访问100个页面，日访问量就是10亿，每秒就是大约1.2万的并发访问量，再按照峰值等于均值3倍来算，也就3.6万，远远没有125万那么夸张","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531122351,"ip_address":"","comment_id":15197,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"千万日活，论坛的时间相对比较集中，同时在线预计会达到一百万。\n这时候会有一半的人在操作(查看帖子之类)，每个用户操作可能会调用2-3个接口。那并发数大约就是50w*2.5=125w?\n\n这时候nginx的5w并发就不行了。需要多个dns到不同主机，再进行nginx,lvs之类转发。\n另外像tomcat一般支持2000左右连接数。这样就需要600多台tomcat？\n总感觉哪里算的不对😂","like_count":18,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420282,"discussion_content":"确实有点吓人，千万日活转换为百万同时在线这里有问题，一般把日活转换为pv，例如平均每个用户会访问100个页面，日访问量就是10亿，每秒就是大约1.2万的并发访问量，再按照峰值等于均值3倍来算，也就3.6万，远远没有125万那么夸张","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1531122351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1498274,"avatar":"https://static001.geekbang.org/account/avatar/00/16/dc/a2/74119fb0.jpg","nickname":"马马","note":"","ucode":"4ED39D89D4031F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615080,"discussion_content":"评论区更精彩😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682038409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1798979,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/73/43/ae139b1f.jpg","nickname":"博","note":"","ucode":"F7CA69FF5D09BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240106,"discussion_content":"😱","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587340456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12372,"user_name":"plflying","can_delete":false,"product_type":"c1","uid":1107843,"ip_address":"","ucode":"F975F24D554246","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/83/d1ed920d.jpg","comment_is_top":false,"comment_ctime":1528783950,"is_pvip":false,"replies":[{"id":4101,"content":"1000万是用户数量，不是访问次数，访问次数会多很多，其它分析都可以","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868816,"ip_address":"","comment_id":12372,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"1、首先分析论坛系统的需求：高可用、扩展性、常规安全性、高性能。以上需求优先级依次降低。\n2、并发计算：\n\t1）、首先计算每秒并发量：1000万&#47;(10*60*60)=278qps. (此处每天按照10个小时计算)\n   2）、计算每秒最大并发量：278*5=1390. （此处的5为经验值，按照论坛的用户使用特点多集中晚上小部分时段，该值已尽量取大。同时网上也有按照时间和并发数的二八原则计算，本人按照第一种计算）\n3、容量规划：\n\t1、前端2台nginx负载均衡，利用keepalive保证高可用。同时可用做静态资源缓存服务器。\n   2、后端tomcat部署应用，按照单台tomcat支撑1200并发，需要2台。考虑冗余，此处配置3台。\n   3、考虑高性能应用可以集成缓存，也可以使用统一缓存。\n   4、数据库采用mysql，使用2台进行主从复制和读写分离。一方面满足读多写少的应用场景，另一方面在1台出现故障时，能保证高可用。\n以上内容请老师指正！","like_count":18,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419233,"discussion_content":"1000万是用户数量，不是访问次数，访问次数会多很多，其它分析都可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2663324,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a3/9c/836d7bb3.jpg","nickname":"11月的萧邦","note":"","ucode":"E7A2236BFD9ABE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386632,"discussion_content":"可以预估每个用户触发几次点击操作  如果是5次  那么1000万×5   另外 这些业务高峰期可能只有晚上那两个小时左右  所以把10小时替换为2小时 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627701636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1620111,"avatar":"","nickname":"刘国正","note":"","ucode":"AECC40F54C9779","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207739,"discussion_content":"我理解，plflying算出来的278是说平均实时在线用户数，这些在用户中，同时去点击论坛里功能（也就是产生读写操作）的用户，可能占20%，那就是278x0.2=50，考虑访问高峰期，差不多50x2=100qps ，对于这个并发量，一台nginx足以抗住。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584510495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12285,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1528762182,"is_pvip":false,"replies":[{"id":4110,"content":"同样1000万日活用户，不同业务特点的QPS差异很大，例如抖音的访问量会明显高于支付业务，论坛业务明显高于工具类业务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869833,"ip_address":"","comment_id":12285,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"请问老师后面会有容量规划方面文章吗？日活用户1000w转换成日请求量（这一步我没啥经验），再计算平均qps，考虑请求的波峰波谷，波峰取qps均值的5倍。1000x10000x10*24*60*60x5~5700得到qps峰值5700。不考虑后端应用层和更下层数据库缓存这些，接入层一个nginx就可以搞定了？","like_count":15,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419192,"discussion_content":"同样1000万日活用户，不同业务特点的QPS差异很大，例如抖音的访问量会明显高于支付业务，论坛业务明显高于工具类业务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":118,"discussion_content":"那直播和抖音呢？抖音和论坛相比呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561114330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14278,"user_name":"低调的大老刘","can_delete":false,"product_type":"c1","uid":1105194,"ip_address":"","ucode":"2E34E8617C015D","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/2a/976a9aec.jpg","comment_is_top":false,"comment_ctime":1530258321,"is_pvip":false,"replies":[{"id":4776,"content":"谁都没法防DDOS攻击呀，不暴露ip，正常用户也访问不了啊😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530273744,"ip_address":"","comment_id":14278,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"华哥，看到很多DNS+Nginx做负载，但是这种方式没办法预防DDOS攻击，你的Ip都暴露了","like_count":11,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419192,"discussion_content":"同样1000万日活用户，不同业务特点的QPS差异很大，例如抖音的访问量会明显高于支付业务，论坛业务明显高于工具类业务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":118,"discussion_content":"那直播和抖音呢？抖音和论坛相比呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561114330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26644,"user_name":"一叶","can_delete":false,"product_type":"c1","uid":1115608,"ip_address":"","ucode":"EB018BDA606A33","user_header":"https://static001.geekbang.org/account/avatar/00/11/05/d8/cd269378.jpg","comment_is_top":false,"comment_ctime":1537709257,"is_pvip":false,"replies":[{"id":10023,"content":"与时俱进，现在基本都是32核48g内存了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1537951497,"ip_address":"","comment_id":26644,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"dear 华哥：文中说的一般的linux服务器 nginx 5w&#47;s ，lvs 80w&#47;s，这个一般的linux服务器能再具体一点吗，比如你们通常用的多少核多少g内存呢？3Q","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419942,"discussion_content":"谁都没法防DDOS攻击呀，不暴露ip，正常用户也访问不了啊😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530273744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12389,"user_name":"鹅米豆发","can_delete":false,"product_type":"c1","uid":1017687,"ip_address":"","ucode":"98E8D911EE32DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","comment_is_top":false,"comment_ctime":1528791763,"is_pvip":false,"replies":[{"id":4068,"content":"思路不错👍👍","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528808206,"ip_address":"","comment_id":12389,"utype":1}],"discussion_count":26,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"       日活千万的论坛，这个流量不低了。\r\n1、首先，流量评估。\n       1000万DAU，换算成秒级，平均约等于116。\r\n考虑每个用户操作次数，假定10，换算成平均QPS=1160。\r\n       考虑峰值是均值倍数，假定10，换算成峰值QPS=11600。\r\n       考虑静态资源、图片资源、服务拆分等，流量放大效应，假定10，QPS*10=116000。 \r\n2、其次，容量规划。\r\n       考虑高可用、异地多活，QPS*2=232000。\r\n       考虑未来半年增长，QPS*1.5=348000。\r\n3、最后，方案设计。\r\n       三级导流。\r\n       第一级，DNS，确定机房，以目前量级，可以不考虑。\r\n       第二级，确定集群，扩展优先，则选Haproxy&#47;LVS，稳定优先则选F5。\r\n       第三级，Nginx+KeepAlived，确定实例。","like_count":393,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419241,"discussion_content":"思路不错👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528808206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463711,"avatar":"","nickname":"大平子","note":"","ucode":"D2FD7E769B2C3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338032,"discussion_content":"我个人觉得应该是2-8原则，80%流量集中在20%的时间，也就是24小时*0.2=4个小时，姑且说是6个小时的高峰，也就是高峰时期操作次数达到来460","likes_number":17,"is_delete":false,"is_hidden":false,"ctime":1609158650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":255624,"discussion_content":"同问异地多活x2的问题","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588417064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1086592,"avatar":"https://static001.geekbang.org/account/avatar/00/10/94/80/70e483f6.jpg","nickname":"任锋","note":"","ucode":"8C32C85A61C426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261249,"discussion_content":"为啥呢 大神","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588948501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":255624,"ip_address":"","group_id":0},"score":261249,"extra":""},{"author":{"id":1079898,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7a/5a/4dfb21f7.jpg","nickname":"毕成功 Antony","note":"","ucode":"32219043046F62","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337876,"discussion_content":"异地多活要看具体是怎么实现的。比较理想的情况，数据分片不会有流量穿透，这样其实QPS总量不变。但如果是数据库还是单点或者还要同步保持全量，这可以简单理解成流量还是放大了一倍。当然，即便如此，简单把QPS乘以2也对整体规划参考意义不大，可以作为一个独立场景来考虑。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609115474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":255624,"ip_address":"","group_id":0},"score":337876,"extra":""}]},{"author":{"id":1073596,"avatar":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","nickname":"亮点","note":"","ucode":"1B8AE07484C69A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55657,"discussion_content":"高可用 异地多活 为啥乘2","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574387677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1017687,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","nickname":"鹅米豆发","note":"","ucode":"98E8D911EE32DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1073596,"avatar":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","nickname":"亮点","note":"","ucode":"1B8AE07484C69A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282805,"discussion_content":"容量预估的冗余。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1592096955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":55657,"ip_address":"","group_id":0},"score":282805,"extra":""}]},{"author":{"id":1072722,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/52/abb7bfe3.jpg","nickname":"leowong","note":"","ucode":"59032C778B5C86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50812,"discussion_content":"什么是流量放大效应？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573776890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1017687,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","nickname":"鹅米豆发","note":"","ucode":"98E8D911EE32DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1072722,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/52/abb7bfe3.jpg","nickname":"leowong","note":"","ucode":"59032C778B5C86","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282803,"discussion_content":"一次用户访问，可能对应了多个下游服务的执行。执行的链路越长，这个调用次数的乘数照应越大。在有效编排下这个效应可以缓解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592096827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50812,"ip_address":"","group_id":0},"score":282803,"extra":""}]},{"author":{"id":2681807,"avatar":"https://static001.geekbang.org/account/avatar/00/28/eb/cf/29d4a8b9.jpg","nickname":"九三二十七","note":"","ucode":"FDB28EE80551A5","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655522,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735135004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2312222,"avatar":"https://static001.geekbang.org/account/avatar/00/23/48/1e/f8f3c881.jpg","nickname":"束","note":"","ucode":"61DA0598597F0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":602288,"discussion_content":"mk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675728925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3216493,"avatar":"","nickname":"舒秉亮","note":"","ucode":"A723B37C82EC46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594330,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668993207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2935759,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/cb/cf/fc97de76.jpg","nickname":"Geektimer","note":"","ucode":"13746813BA173A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582947,"discussion_content":"不过应该按照12个小时算吧，其实晚上的时候QPS就降下来了，所以还的往高评估","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659795265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fb/58/6c422e70.jpg","nickname":"清晨吼于林","note":"","ucode":"6ADCB9B9FB8330","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555836,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647078220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1671394,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/8KpWhCMxgVgqKMxNT9zuJuVnz1gNBzYlWrZCO4hlF4OQibhawvn0hpHhHgHr4kSXfVNjeuE4StuvTR54NGcE4Zg/132","nickname":"Geek_aa780e","note":"","ucode":"20C49732158424","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553675,"discussion_content":"马克，学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646025024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2652995,"avatar":"https://static001.geekbang.org/account/avatar/00/28/7b/43/20cf4dd0.jpg","nickname":"aimin","note":"","ucode":"7001E627F33B5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550803,"discussion_content":"666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644737097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1259156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/36/94/0b969588.jpg","nickname":"青年祭司","note":"","ucode":"C88EDAE3FF09AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393853,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631619096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118111,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg","nickname":"见南山","note":"","ucode":"6A8BB82B7573CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386838,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627831434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1994321,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6e/51/17a8e5e5.jpg","nickname":"hammer","note":"","ucode":"DA7913D62495AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385519,"discussion_content":"马克学习","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627110432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1443365,"avatar":"https://static001.geekbang.org/account/avatar/00/16/06/25/5461385f.jpg","nickname":"学无止境0033","note":"","ucode":"6332DA0B9FF989","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378568,"discussion_content":"马克","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623289895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338834,"discussion_content":"思路很清晰, 学习了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609398202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2366248,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","nickname":"那那那","note":"","ucode":"04FD2412BB30D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334443,"discussion_content":"千万日活的差不多平时10几万的qps了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607849359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1900299,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/ff/0b/795348b1.jpg","nickname":"孙彦科","note":"","ucode":"F938EC7D3235B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330975,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606742353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066752,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","nickname":"piboye","note":"","ucode":"7CFD8712857A85","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301223,"discussion_content":"一个论坛为什么是用户每秒有10次请求？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598445244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1160192,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","nickname":"追忆似水年华","note":"","ucode":"C1D7C0DD7E7411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1066752,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","nickname":"piboye","note":"","ucode":"7CFD8712857A85","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":310193,"discussion_content":"用户请求一个页面，浏览器的话，并发连接数是5、6左右，考虑到小文件加载很快，就把每秒的请求预估为10次左右了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601685324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301223,"ip_address":"","group_id":0},"score":310193,"extra":""}]},{"author":{"id":1313840,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0c/30/d4737cd5.jpg","nickname":"lyonger","note":"","ucode":"E89A75DADEA2A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203235,"discussion_content":"大神，有空求解答上面的问题？我也想知道，哈哈😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584016179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":21778,"user_name":"无聊夫斯基","can_delete":false,"product_type":"c1","uid":1194071,"ip_address":"","ucode":"F7BC3346FFF5EC","user_header":"https://static001.geekbang.org/account/avatar/00/12/38/57/a9f9705a.jpg","comment_is_top":false,"comment_ctime":1535332006,"is_pvip":false,"replies":[{"id":7787,"content":"T=transaction，代表写请求\nQ=query，代表读请求","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1535342345,"ip_address":"","comment_id":21778,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我还是不是很理解TPS和QPS具体的区别","like_count":88,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422858,"discussion_content":"T=transaction，代表写请求\nQ=query，代表读请求","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1535342345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1477120,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8mFt5wSkia31qc8paRg2uPSB6AuEBDricrSxvFBuTpP3NnnflekpJ7wqvN0nRrJyu7zVbzd7Lwjxw/132","nickname":"Geek_steven_wang","note":"","ucode":"8CC8F4C9726191","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":103838,"discussion_content":"论坛这类http短链接应用，两者相等。tps主要计算服务器连接能力，qps主要是服务器业务处理能力。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1577401116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338836,"discussion_content":"同一个TPS, 可以产生多个QPS\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609398247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2663324,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a3/9c/836d7bb3.jpg","nickname":"11月的萧邦","note":"","ucode":"E7A2236BFD9ABE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386631,"discussion_content":"同意","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627701366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338836,"ip_address":"","group_id":0},"score":386631,"extra":""}]}]},{"had_liked":false,"id":16757,"user_name":"孙振超","can_delete":false,"product_type":"c1","uid":1101755,"ip_address":"","ucode":"0F9EABC6125350","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg","comment_is_top":false,"comment_ctime":1532159275,"is_pvip":false,"replies":[{"id":5845,"content":"最常用的方式","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532255691,"ip_address":"","comment_id":16757,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"这篇文章最大的收获是分析问题的思路，从dau出发，结合业务的特点，计算出来总的qps和tps，而后再根据通常规律计算出qps和tps的峰值，加上一定的未来发展空间和高可用冗余，结合单机能够支撑的qps和tps量，就可以计算出来整个集群的规模，有了这些数据就可以制定出比较合理的负载均衡的策略，而不是无的放矢，凭空猜测。\n\n\n\n","like_count":57,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420919,"discussion_content":"最常用的方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532255691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2245610,"avatar":"","nickname":"我也会架构","note":"","ucode":"503DE85E31CE42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352412,"discussion_content":"big and empty words","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614732144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12304,"user_name":"ant","can_delete":false,"product_type":"c1","uid":1043816,"ip_address":"","ucode":"27BAF20679679A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/68/737f97c8.jpg","comment_is_top":false,"comment_ctime":1528764017,"is_pvip":false,"replies":[{"id":4107,"content":"可以达到，但有点复杂，nginx做级联不太合适，因为顶层的nginx性能是瓶颈，多级导流一般用在处理能力有差异的系统上，例如一级用F5，二级用LVS，三级用nginx","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869644,"ip_address":"","comment_id":12304,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"日活跃用户1000万应该就是国家级应用了，面向全国活跃或者全球用户，比如最大的Xxx网站github。这个时候钱应该都不是问题了。我觉得可以考虑异地多机房部署。这样导流之后每个机房的日活就少很多。其实我在想如果在每个机房不加入负载硬件用多个ngnix集群来实现，每个ngnix上会有我们自定义的路由算法。ngnix也架设多层，逐层导流，比如我们一个机房设计承受200万，那么我们可以架设3层ngnix，第一层基于自己的路由算法导流到第2层ngnix。第2层又导流到第3层。为了避免ngnix单点，每一层ngnix部署多。这样导流下流每台服务器所承认的访问不会很多。不知道这样的设计能不能达到要求，老师点评下","like_count":34,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420919,"discussion_content":"最常用的方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532255691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2245610,"avatar":"","nickname":"我也会架构","note":"","ucode":"503DE85E31CE42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352412,"discussion_content":"big and empty words","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614732144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12607,"user_name":"何国平","can_delete":false,"product_type":"c1","uid":1101355,"ip_address":"","ucode":"251BA091AF8690","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/2b/a47a0936.jpg","comment_is_top":false,"comment_ctime":1528936365,"is_pvip":false,"replies":[{"id":4156,"content":"我宁愿用LVS，久经考验，性能强大😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528942277,"ip_address":"","comment_id":12607,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"nginx也支持4层反向代理了","like_count":21,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419321,"discussion_content":"我宁愿用LVS，久经考验，性能强大😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528942277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601938,"discussion_content":"验证了以下nginx这个4层代理还是要维护连接的。还不如直接用iptable的DNAT完成反向代理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675509432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15197,"user_name":"老北","can_delete":false,"product_type":"c1","uid":1024376,"ip_address":"","ucode":"89B9B6673F1705","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/78/71d37164.jpg","comment_is_top":false,"comment_ctime":1530980266,"is_pvip":false,"replies":[{"id":5199,"content":"确实有点吓人，千万日活转换为百万同时在线这里有问题，一般把日活转换为pv，例如平均每个用户会访问100个页面，日访问量就是10亿，每秒就是大约1.2万的并发访问量，再按照峰值等于均值3倍来算，也就3.6万，远远没有125万那么夸张","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531122351,"ip_address":"","comment_id":15197,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"千万日活，论坛的时间相对比较集中，同时在线预计会达到一百万。\n这时候会有一半的人在操作(查看帖子之类)，每个用户操作可能会调用2-3个接口。那并发数大约就是50w*2.5=125w?\n\n这时候nginx的5w并发就不行了。需要多个dns到不同主机，再进行nginx,lvs之类转发。\n另外像tomcat一般支持2000左右连接数。这样就需要600多台tomcat？\n总感觉哪里算的不对😂","like_count":18,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419321,"discussion_content":"我宁愿用LVS，久经考验，性能强大😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528942277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601938,"discussion_content":"验证了以下nginx这个4层代理还是要维护连接的。还不如直接用iptable的DNAT完成反向代理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675509432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12372,"user_name":"plflying","can_delete":false,"product_type":"c1","uid":1107843,"ip_address":"","ucode":"F975F24D554246","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/83/d1ed920d.jpg","comment_is_top":false,"comment_ctime":1528783950,"is_pvip":false,"replies":[{"id":4101,"content":"1000万是用户数量，不是访问次数，访问次数会多很多，其它分析都可以","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868816,"ip_address":"","comment_id":12372,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"1、首先分析论坛系统的需求：高可用、扩展性、常规安全性、高性能。以上需求优先级依次降低。\n2、并发计算：\n\t1）、首先计算每秒并发量：1000万&#47;(10*60*60)=278qps. (此处每天按照10个小时计算)\n   2）、计算每秒最大并发量：278*5=1390. （此处的5为经验值，按照论坛的用户使用特点多集中晚上小部分时段，该值已尽量取大。同时网上也有按照时间和并发数的二八原则计算，本人按照第一种计算）\n3、容量规划：\n\t1、前端2台nginx负载均衡，利用keepalive保证高可用。同时可用做静态资源缓存服务器。\n   2、后端tomcat部署应用，按照单台tomcat支撑1200并发，需要2台。考虑冗余，此处配置3台。\n   3、考虑高性能应用可以集成缓存，也可以使用统一缓存。\n   4、数据库采用mysql，使用2台进行主从复制和读写分离。一方面满足读多写少的应用场景，另一方面在1台出现故障时，能保证高可用。\n以上内容请老师指正！","like_count":18,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420282,"discussion_content":"确实有点吓人，千万日活转换为百万同时在线这里有问题，一般把日活转换为pv，例如平均每个用户会访问100个页面，日访问量就是10亿，每秒就是大约1.2万的并发访问量，再按照峰值等于均值3倍来算，也就3.6万，远远没有125万那么夸张","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1531122351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1498274,"avatar":"https://static001.geekbang.org/account/avatar/00/16/dc/a2/74119fb0.jpg","nickname":"马马","note":"","ucode":"4ED39D89D4031F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615080,"discussion_content":"评论区更精彩😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682038409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1798979,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/73/43/ae139b1f.jpg","nickname":"博","note":"","ucode":"F7CA69FF5D09BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240106,"discussion_content":"😱","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587340456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12285,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1528762182,"is_pvip":false,"replies":[{"id":4110,"content":"同样1000万日活用户，不同业务特点的QPS差异很大，例如抖音的访问量会明显高于支付业务，论坛业务明显高于工具类业务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869833,"ip_address":"","comment_id":12285,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"请问老师后面会有容量规划方面文章吗？日活用户1000w转换成日请求量（这一步我没啥经验），再计算平均qps，考虑请求的波峰波谷，波峰取qps均值的5倍。1000x10000x10*24*60*60x5~5700得到qps峰值5700。不考虑后端应用层和更下层数据库缓存这些，接入层一个nginx就可以搞定了？","like_count":15,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419233,"discussion_content":"1000万是用户数量，不是访问次数，访问次数会多很多，其它分析都可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2663324,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a3/9c/836d7bb3.jpg","nickname":"11月的萧邦","note":"","ucode":"E7A2236BFD9ABE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386632,"discussion_content":"可以预估每个用户触发几次点击操作  如果是5次  那么1000万×5   另外 这些业务高峰期可能只有晚上那两个小时左右  所以把10小时替换为2小时 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627701636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1620111,"avatar":"","nickname":"刘国正","note":"","ucode":"AECC40F54C9779","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207739,"discussion_content":"我理解，plflying算出来的278是说平均实时在线用户数，这些在用户中，同时去点击论坛里功能（也就是产生读写操作）的用户，可能占20%，那就是278x0.2=50，考虑访问高峰期，差不多50x2=100qps ，对于这个并发量，一台nginx足以抗住。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584510495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14278,"user_name":"低调的大老刘","can_delete":false,"product_type":"c1","uid":1105194,"ip_address":"","ucode":"2E34E8617C015D","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/2a/976a9aec.jpg","comment_is_top":false,"comment_ctime":1530258321,"is_pvip":false,"replies":[{"id":4776,"content":"谁都没法防DDOS攻击呀，不暴露ip，正常用户也访问不了啊😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530273744,"ip_address":"","comment_id":14278,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"华哥，看到很多DNS+Nginx做负载，但是这种方式没办法预防DDOS攻击，你的Ip都暴露了","like_count":11,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419942,"discussion_content":"谁都没法防DDOS攻击呀，不暴露ip，正常用户也访问不了啊😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530273744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26644,"user_name":"一叶","can_delete":false,"product_type":"c1","uid":1115608,"ip_address":"","ucode":"EB018BDA606A33","user_header":"https://static001.geekbang.org/account/avatar/00/11/05/d8/cd269378.jpg","comment_is_top":false,"comment_ctime":1537709257,"is_pvip":false,"replies":[{"id":10023,"content":"与时俱进，现在基本都是32核48g内存了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1537951497,"ip_address":"","comment_id":26644,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"dear 华哥：文中说的一般的linux服务器 nginx 5w&#47;s ，lvs 80w&#47;s，这个一般的linux服务器能再具体一点吗，比如你们通常用的多少核多少g内存呢？3Q","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424697,"discussion_content":"与时俱进，现在基本都是32核48g内存了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537951497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098910,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/9e/d820b03c.jpg","nickname":"狩魔天使范海辛","note":"","ucode":"E0E8CF701D18BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336601,"discussion_content":"哎，我们用2核4g就行了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608631547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251147,"user_name":"lawrence.peng","can_delete":false,"product_type":"c1","uid":1051087,"ip_address":"","ucode":"5021C6FADCC032","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/cf/9196b53b.jpg","comment_is_top":false,"comment_ctime":1601378892,"is_pvip":false,"replies":[{"id":91860,"content":"云主机的性能可以按照同配置的物理机80%的性能来估算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1601430842,"ip_address":"","comment_id":251147,"utype":1}],"discussion_count":0,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师，看了前面的文章的话，经常能看到你说，linux服务器 nginx 5w&#47;s ，lvs 80w&#47;s 等等，并且知道这些机器是当前主流的配置 32C 48G,要求我们要把这个性能指标背熟，目地是很明显的，为了做容量规划。但现在很多创业公司，基本上都是上云的，云主机的配置基本都是4C 8G,问题来了，怎么去做这个应用的容量规划呢？或者这些指标哪里能查阅吗？","like_count":8},{"had_liked":false,"id":13004,"user_name":"交叉路口","can_delete":false,"product_type":"c1","uid":1125680,"ip_address":"","ucode":"D1A636F0F4E147","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/30/b840bd9e.jpg","comment_is_top":false,"comment_ctime":1529283694,"is_pvip":false,"replies":[{"id":4345,"content":"基本OK","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529376849,"ip_address":"","comment_id":13004,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"论坛这种业务的接口响应应该比较短，预计平均100ms ，超时限制500ms 。日活千万，预计峰值QPS 4000&#47;s，按照超时500ms ，并发估算2000。采取dns+nginx 足够，具体实例根据 staging 压测来评估。dns 一是为了地理位置负载均衡，还有为了扩展性（客户端通过域名访问，后端需要拓展机器对客户端透明）。Nginx ：应用负载均衡，打到某个服务实例，利用其故障转移（可检测实例状态进行剔除）、并发限制等特性来保证服务稳定性，同时还可以利用它做其他事情（access log 做日志行为分析）。希望华哥指出不足😃","like_count":8},{"had_liked":false,"id":286344,"user_name":"good boby","can_delete":false,"product_type":"c1","uid":2387358,"ip_address":"","ucode":"1471E2E499412C","user_header":"https://static001.geekbang.org/account/avatar/00/24/6d/9e/6a82a5ea.jpg","comment_is_top":false,"comment_ctime":1617263148,"is_pvip":false,"replies":[{"id":104052,"content":"非常棒的补充，当时写书的时候，这些还不怎么很成熟，所以没有包含，技术与时俱进，我们的认知也要不断更新 ：）","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1617326989,"ip_address":"","comment_id":286344,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"向后延伸：负载均衡还包括以下处理\n1、集群调度平台（PaaS）平台，例如k8s 、docker， 可以实现动态扩容和缩减，根据事实的并发量进行处理，当然前提是包括Nginx、lvs、haproxy前端负载均衡器不能挂掉。\n2、分布式框架。\n例如：Spring Cloud 的ribbion、feign也可以从应用层面实现负载均衡。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419497,"discussion_content":"基本OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529376849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12444,"user_name":"沐风","can_delete":false,"product_type":"c1","uid":1051796,"ip_address":"","ucode":"9CF09739F247C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/94/56ea80f7.jpg","comment_is_top":false,"comment_ctime":1528841819,"is_pvip":false,"replies":[{"id":4098,"content":"基于业务场景进行性能压测，了解大概量级即可，不需要很精确","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868600,"ip_address":"","comment_id":12444,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"并发测试如何来做，怎么知道自己设计的数据库，或者架构能支撑多少并发","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419259,"discussion_content":"基于业务场景进行性能压测，了解大概量级即可，不需要很精确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1170166,"avatar":"https://static001.geekbang.org/account/avatar/00/11/da/f6/e91ce94b.jpg","nickname":"wettper","note":"","ucode":"A3E473958B9489","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":637196,"discussion_content":"是的，更加详细的指标要通过摸高来压测出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708056922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":419259,"ip_address":"浙江","group_id":0},"score":637196,"extra":""}]}]},{"had_liked":false,"id":12291,"user_name":"星火燎原","can_delete":false,"product_type":"c1","uid":1101373,"ip_address":"","ucode":"15AD8E3006E107","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/3d/385b8263.jpg","comment_is_top":false,"comment_ctime":1528762579,"is_pvip":false,"replies":[{"id":4109,"content":"论坛不怎么赚钱啊😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869709,"ip_address":"","comment_id":12291,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"不差钱的话可以考虑文中DNS +F5+ ngnix ，一般这种日活还是考虑DNS+LVS+Nginx","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419259,"discussion_content":"基于业务场景进行性能压测，了解大概量级即可，不需要很精确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1170166,"avatar":"https://static001.geekbang.org/account/avatar/00/11/da/f6/e91ce94b.jpg","nickname":"wettper","note":"","ucode":"A3E473958B9489","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":637196,"discussion_content":"是的，更加详细的指标要通过摸高来压测出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708056922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":419259,"ip_address":"浙江","group_id":0},"score":637196,"extra":""}]}]},{"had_liked":false,"id":33647,"user_name":"lyshrine","can_delete":false,"product_type":"c1","uid":1058278,"ip_address":"","ucode":"497551F047A5C6","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/e6/a69cff76.jpg","comment_is_top":false,"comment_ctime":1539843298,"is_pvip":false,"replies":[{"id":12077,"content":"是的，LibreOffice Draw","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539848784,"ip_address":"","comment_id":33647,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师画的这些有服务器的图，是哪那个软件画的？还是libreoffice？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427021,"discussion_content":"是的，LibreOffice Draw","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539848784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12398,"user_name":"张玮(大圣)","can_delete":false,"product_type":"c1","uid":1111343,"ip_address":"","ucode":"D567C4BE87D116","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/2f/56117bab.jpg","comment_is_top":false,"comment_ctime":1528797448,"is_pvip":false,"replies":[{"id":4100,"content":"最好算一下，当然有经验的架构师确实能够凭感觉预估","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868731,"ip_address":"","comment_id":12398,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看了大家的各种计算，估容量，估机器，\n\n想说的是：根据之前专栏讲到的单台高性能模式等知识，先把单台机器做到最优化，同时做好负载均衡层，然后进行压测，一步一步添加机器，均衡层 Nginx 够了，另外，要考虑成本啊，F5尽量不用，稳定性用双主克服下","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427021,"discussion_content":"是的，LibreOffice Draw","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539848784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12298,"user_name":"三水","can_delete":false,"product_type":"c1","uid":1017781,"ip_address":"","ucode":"11837CF38FD9BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/b5/dd0353f4.jpg","comment_is_top":false,"comment_ctime":1528763367,"is_pvip":false,"replies":[{"id":4108,"content":"HAProxy也很成熟，可以用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869673,"ip_address":"","comment_id":12298,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师，流行的SLB还有HAProxy，我们用LVS做DNS的LB，Nginx和HAProxy做HTTP的LB。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419246,"discussion_content":"最好算一下，当然有经验的架构师确实能够凭感觉预估","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298182,"user_name":"小鬼爱风雪","can_delete":false,"product_type":"c1","uid":2646199,"ip_address":"","ucode":"FF72E39E557C6F","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/b7/4a665c73.jpg","comment_is_top":false,"comment_ctime":1623938567,"is_pvip":false,"replies":[{"id":108213,"content":"你这个估算太离谱了，1000万日活不可能有1000万并发的，如果按照你这个估算，微信和淘宝之类的业务，服务器是天文数字","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1623982790,"ip_address":"","comment_id":298182,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"1000万日活跃用户，最差情况是1000万并发，如果分散一下，500万可以了，以此量级去分析，真实场景会按照千万级设计","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419199,"discussion_content":"HAProxy也很成熟，可以用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239019,"user_name":"慎独明强","can_delete":false,"product_type":"c1","uid":1965699,"ip_address":"","ucode":"DC2F7F2C0C8F60","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","comment_is_top":false,"comment_ctime":1596417034,"is_pvip":false,"replies":[{"id":88380,"content":"基本这已经是标配做法了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1596498288,"ip_address":"","comment_id":239019,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看到华哥这章收获很大，之前见过这些名词很多次，但就是没搞清楚。DNS层应该都会有，进行域名解析为具体的ip。回头又看了公司之前运维发布的文章，公司采用的是腾讯云的组件，原理差不多，第一层有高防组件WAF并将https拆包为http，第二层是CLB(集群负载均衡)组件，第三层就是自己公司搭建的10台Nginx(8核16g)来反向代理到自己公司对应的服务器。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522045,"discussion_content":"你这个估算太离谱了，1000万日活不可能有1000万并发的，如果按照你这个估算，微信和淘宝之类的业务，服务器是天文数字","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623982790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251147,"user_name":"lawrence.peng","can_delete":false,"product_type":"c1","uid":1051087,"ip_address":"","ucode":"5021C6FADCC032","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/cf/9196b53b.jpg","comment_is_top":false,"comment_ctime":1601378892,"is_pvip":false,"replies":[{"id":91860,"content":"云主机的性能可以按照同配置的物理机80%的性能来估算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1601430842,"ip_address":"","comment_id":251147,"utype":1}],"discussion_count":0,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师，看了前面的文章的话，经常能看到你说，linux服务器 nginx 5w&#47;s ，lvs 80w&#47;s 等等，并且知道这些机器是当前主流的配置 32C 48G,要求我们要把这个性能指标背熟，目地是很明显的，为了做容量规划。但现在很多创业公司，基本上都是上云的，云主机的配置基本都是4C 8G,问题来了，怎么去做这个应用的容量规划呢？或者这些指标哪里能查阅吗？","like_count":8},{"had_liked":false,"id":13004,"user_name":"交叉路口","can_delete":false,"product_type":"c1","uid":1125680,"ip_address":"","ucode":"D1A636F0F4E147","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/30/b840bd9e.jpg","comment_is_top":false,"comment_ctime":1529283694,"is_pvip":false,"replies":[{"id":4345,"content":"基本OK","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529376849,"ip_address":"","comment_id":13004,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"论坛这种业务的接口响应应该比较短，预计平均100ms ，超时限制500ms 。日活千万，预计峰值QPS 4000&#47;s，按照超时500ms ，并发估算2000。采取dns+nginx 足够，具体实例根据 staging 压测来评估。dns 一是为了地理位置负载均衡，还有为了扩展性（客户端通过域名访问，后端需要拓展机器对客户端透明）。Nginx ：应用负载均衡，打到某个服务实例，利用其故障转移（可检测实例状态进行剔除）、并发限制等特性来保证服务稳定性，同时还可以利用它做其他事情（access log 做日志行为分析）。希望华哥指出不足😃","like_count":8,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419497,"discussion_content":"基本OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529376849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286344,"user_name":"good boby","can_delete":false,"product_type":"c1","uid":2387358,"ip_address":"","ucode":"1471E2E499412C","user_header":"https://static001.geekbang.org/account/avatar/00/24/6d/9e/6a82a5ea.jpg","comment_is_top":false,"comment_ctime":1617263148,"is_pvip":false,"replies":[{"id":104052,"content":"非常棒的补充，当时写书的时候，这些还不怎么很成熟，所以没有包含，技术与时俱进，我们的认知也要不断更新 ：）","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1617326989,"ip_address":"","comment_id":286344,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"向后延伸：负载均衡还包括以下处理\n1、集群调度平台（PaaS）平台，例如k8s 、docker， 可以实现动态扩容和缩减，根据事实的并发量进行处理，当然前提是包括Nginx、lvs、haproxy前端负载均衡器不能挂掉。\n2、分布式框架。\n例如：Spring Cloud 的ribbion、feign也可以从应用层面实现负载均衡。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517953,"discussion_content":"非常棒的补充，当时写书的时候，这些还不怎么很成熟，所以没有包含，技术与时俱进，我们的认知也要不断更新 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617326989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12444,"user_name":"沐风","can_delete":false,"product_type":"c1","uid":1051796,"ip_address":"","ucode":"9CF09739F247C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/94/56ea80f7.jpg","comment_is_top":false,"comment_ctime":1528841819,"is_pvip":false,"replies":[{"id":4098,"content":"基于业务场景进行性能压测，了解大概量级即可，不需要很精确","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868600,"ip_address":"","comment_id":12444,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"并发测试如何来做，怎么知道自己设计的数据库，或者架构能支撑多少并发","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517953,"discussion_content":"非常棒的补充，当时写书的时候，这些还不怎么很成熟，所以没有包含，技术与时俱进，我们的认知也要不断更新 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617326989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12291,"user_name":"星火燎原","can_delete":false,"product_type":"c1","uid":1101373,"ip_address":"","ucode":"15AD8E3006E107","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/3d/385b8263.jpg","comment_is_top":false,"comment_ctime":1528762579,"is_pvip":false,"replies":[{"id":4109,"content":"论坛不怎么赚钱啊😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869709,"ip_address":"","comment_id":12291,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"不差钱的话可以考虑文中DNS +F5+ ngnix ，一般这种日活还是考虑DNS+LVS+Nginx","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419195,"discussion_content":"论坛不怎么赚钱啊😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33647,"user_name":"lyshrine","can_delete":false,"product_type":"c1","uid":1058278,"ip_address":"","ucode":"497551F047A5C6","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/e6/a69cff76.jpg","comment_is_top":false,"comment_ctime":1539843298,"is_pvip":false,"replies":[{"id":12077,"content":"是的，LibreOffice Draw","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539848784,"ip_address":"","comment_id":33647,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师画的这些有服务器的图，是哪那个软件画的？还是libreoffice？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419195,"discussion_content":"论坛不怎么赚钱啊😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12398,"user_name":"张玮(大圣)","can_delete":false,"product_type":"c1","uid":1111343,"ip_address":"","ucode":"D567C4BE87D116","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/2f/56117bab.jpg","comment_is_top":false,"comment_ctime":1528797448,"is_pvip":false,"replies":[{"id":4100,"content":"最好算一下，当然有经验的架构师确实能够凭感觉预估","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868731,"ip_address":"","comment_id":12398,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看了大家的各种计算，估容量，估机器，\n\n想说的是：根据之前专栏讲到的单台高性能模式等知识，先把单台机器做到最优化，同时做好负载均衡层，然后进行压测，一步一步添加机器，均衡层 Nginx 够了，另外，要考虑成本啊，F5尽量不用，稳定性用双主克服下","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419246,"discussion_content":"最好算一下，当然有经验的架构师确实能够凭感觉预估","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12298,"user_name":"三水","can_delete":false,"product_type":"c1","uid":1017781,"ip_address":"","ucode":"11837CF38FD9BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/b5/dd0353f4.jpg","comment_is_top":false,"comment_ctime":1528763367,"is_pvip":false,"replies":[{"id":4108,"content":"HAProxy也很成熟，可以用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869673,"ip_address":"","comment_id":12298,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"老师，流行的SLB还有HAProxy，我们用LVS做DNS的LB，Nginx和HAProxy做HTTP的LB。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419199,"discussion_content":"HAProxy也很成熟，可以用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298182,"user_name":"小鬼爱风雪","can_delete":false,"product_type":"c1","uid":2646199,"ip_address":"","ucode":"FF72E39E557C6F","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/b7/4a665c73.jpg","comment_is_top":false,"comment_ctime":1623938567,"is_pvip":false,"replies":[{"id":108213,"content":"你这个估算太离谱了，1000万日活不可能有1000万并发的，如果按照你这个估算，微信和淘宝之类的业务，服务器是天文数字","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1623982790,"ip_address":"","comment_id":298182,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"1000万日活跃用户，最差情况是1000万并发，如果分散一下，500万可以了，以此量级去分析，真实场景会按照千万级设计","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522045,"discussion_content":"你这个估算太离谱了，1000万日活不可能有1000万并发的，如果按照你这个估算，微信和淘宝之类的业务，服务器是天文数字","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623982790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239019,"user_name":"慎独明强","can_delete":false,"product_type":"c1","uid":1965699,"ip_address":"","ucode":"DC2F7F2C0C8F60","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","comment_is_top":false,"comment_ctime":1596417034,"is_pvip":false,"replies":[{"id":88380,"content":"基本这已经是标配做法了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1596498288,"ip_address":"","comment_id":239019,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看到华哥这章收获很大，之前见过这些名词很多次，但就是没搞清楚。DNS层应该都会有，进行域名解析为具体的ip。回头又看了公司之前运维发布的文章，公司采用的是腾讯云的组件，原理差不多，第一层有高防组件WAF并将https拆包为http，第二层是CLB(集群负载均衡)组件，第三层就是自己公司搭建的10台Nginx(8核16g)来反向代理到自己公司对应的服务器。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502940,"discussion_content":"基本这已经是标配做法了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596498288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111401,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1562552478,"is_pvip":false,"replies":[{"id":40625,"content":"服务发现用了负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562584933,"ip_address":"","comment_id":111401,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"微服务的服务发现是不是也算一类负载均衡？","like_count":2},{"had_liked":false,"id":17465,"user_name":"小橙橙","can_delete":false,"product_type":"c1","uid":1054923,"ip_address":"","ucode":"4F467210A15F66","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/cb/edb5a0a0.jpg","comment_is_top":false,"comment_ctime":1532663025,"is_pvip":false,"replies":[{"id":6153,"content":"查询nginx官方文档，里面有介绍health check","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532918287,"ip_address":"","comment_id":17465,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师，有个问题一直不是很清楚，如果用nginx轮询做负载均衡，下游某个服务挂掉了，那就会导致某些请求无法响应，这样的问题要如何解决呢？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457335,"discussion_content":"服务发现用了负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562584933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12785,"user_name":"迟博🙈","can_delete":false,"product_type":"c1","uid":1102280,"ip_address":"","ucode":"BBE8E522D43B98","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/c8/80b4011d.jpg","comment_is_top":false,"comment_ctime":1529029234,"is_pvip":false,"replies":[{"id":4240,"content":"会有异地多活章节讲","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046229,"ip_address":"","comment_id":12785,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"我看到好多评论说多多机房，请问一下多机房的数据一致一般怎么解决的？数据库通过专线组成跨dc的多主集群？这个后面会讲到吗？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419407,"discussion_content":"会有异地多活章节讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529046229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12505,"user_name":"feifei","can_delete":false,"product_type":"c1","uid":1105431,"ip_address":"","ucode":"B1F8AE3AD82C51","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/17/75e2b624.jpg","comment_is_top":false,"comment_ctime":1528872271,"is_pvip":false,"replies":[{"id":4169,"content":"日活用户数 ！= 用户访问数，论坛类业务，一个用户一天可能访问几十个页面","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528943033,"ip_address":"","comment_id":12505,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"日活跃用户千万，按14小时折算，每秒并发198，但这是平均，还有高峰时段，并发按平均并发5倍来估算，即每秒1千，然后来对比方案：\n\nDns负载，目前单机房能够满足，没跨机房的必要，dns目前不适用。\n硬件负载，每秒几百万级的并非，很显然系统没有这么高的并发，硬件负载不适合。\n软件负载，nginx单台能支持到5万的并发，当前系统,折算最高的并发也不过千级别。\n\n经过方案的对比，软件负载使用nginx可以完全满足业务的要求，所以使用软件负载即可\n\n","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419407,"discussion_content":"会有异地多活章节讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529046229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12344,"user_name":"三月沙@wecatch","can_delete":false,"product_type":"c1","uid":1034980,"ip_address":"","ucode":"16FEF6C74D24E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/e4/f15a1cf0.jpg","comment_is_top":false,"comment_ctime":1528769555,"is_pvip":false,"replies":[{"id":4102,"content":"1000万日活的业务，你真的要这么节省么？😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868848,"ip_address":"","comment_id":12344,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"不考虑多机房，不考虑不同地区，一个配置好点的nginx 就够了，防止单点，可以再加一台","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419280,"discussion_content":"日活用户数 ！= 用户访问数，论坛类业务，一个用户一天可能访问几十个页面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528943033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12319,"user_name":"肖一林","can_delete":false,"product_type":"c1","uid":1113317,"ip_address":"","ucode":"1DE45D906EB836","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/e5/605f423f.jpg","comment_is_top":false,"comment_ctime":1528765287,"is_pvip":false,"replies":[{"id":4106,"content":"这种方式也可以，dns做同机房多入口负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869493,"ip_address":"","comment_id":12319,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"峰值大概就是5000&#47;s～20000&#47;s，要看论坛活跃度。所以一个ng就够了。dns负载均衡也不一定就要支持异地多活吧，同一个机房多台主机也是可以的，所以最多dns+ng就可以很完美。需要异地多活的项目应该非常少。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419211,"discussion_content":"这种方式也可以，dns做同机房多入口负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12278,"user_name":"黄金的太阳","can_delete":false,"product_type":"c1","uid":1105079,"ip_address":"","ucode":"9D7F2397124AB9","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg","comment_is_top":false,"comment_ctime":1528760963,"is_pvip":false,"replies":[{"id":4112,"content":"基本正确，中国一般分南北区域接入，西部用户确实少很多","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869935,"ip_address":"","comment_id":12278,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"假设论坛的用户平均分布在全国各地(东，西，南，北四个区域)，1000万的日活跃用户平均分散到每个区域后可近似估计并发量在2.5万～5万用户，可以采用两级嵌套的负载均衡架构\n1.利用DNS达到四个地域的负载均衡\n2.利用Nginx的方式达到本区域内的负载均衡\n此方案未考虑西部地区用户少，东部地区用户多的情况，在并发量尚可接受的范围内，可以考虑将单台Nginx集群化以增强并发负载支持能力\n\n不知道理解的对不对","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419188,"discussion_content":"基本正确，中国一般分南北区域接入，西部用户确实少很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389886,"user_name":"冲","can_delete":false,"product_type":"c1","uid":1149914,"ip_address":"陕西","ucode":"4191C8A4DF3840","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIk46cor5XVFTPZbPOnb7pViabgy450pobo46hRHFQz5nR5ocYRKIzC8vShic36vwa553H4Vj50x5wA/132","comment_is_top":false,"comment_ctime":1713780148,"is_pvip":false,"replies":[{"id":142035,"content":"2013年左右的32核 intel至强服务器，只做简单的反向代理负载均衡。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1715414830,"ip_address":"广东","comment_id":389886,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师问下这个Nginx 5w的并发是在什么条件下的，Nginx装在一个专门的服务器上，下面还需要多少个装接口的服务器？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644665,"discussion_content":"2013年左右的32核 intel至强服务器，只做简单的反向代理负载均衡。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715414830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338028,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1647244668,"is_pvip":false,"replies":[{"id":123690,"content":"是的，就是这么做的，找个好的DNS和CDN服务商","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1647476895,"ip_address":"","comment_id":338028,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师同学好，所以DNS负载均衡就是多机房部署，剩下的就交给域名服务商了？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556694,"discussion_content":"是的，就是这么做的，找个好的DNS和CDN服务商","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647476895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136104,"user_name":"Geek_ebe1c1","can_delete":false,"product_type":"c1","uid":1664768,"ip_address":"","ucode":"3942F6D4ABF86F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erD9YTBibqNvibicyicp31gBdJLJ7KPTuePMeibNWKGv9PydRID0AwvtUYEIO6qpTvXQpxbktR8fuHkCaA/132","comment_is_top":false,"comment_ctime":1569365574,"is_pvip":false,"replies":[{"id":52144,"content":"QPS是查询，TPS是写入，都是并发衡量指标","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569373763,"ip_address":"","comment_id":136104,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师说明并发是qps么 ","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468462,"discussion_content":"QPS是查询，TPS是写入，都是并发衡量指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569373763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1664768,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erD9YTBibqNvibicyicp31gBdJLJ7KPTuePMeibNWKGv9PydRID0AwvtUYEIO6qpTvXQpxbktR8fuHkCaA/132","nickname":"Geek_ebe1c1","note":"","ucode":"3942F6D4ABF86F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20770,"discussion_content":"那假设10万并发，我可以理解为10万qps或tps么","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569373921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111401,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1562552478,"is_pvip":false,"replies":[{"id":40625,"content":"服务发现用了负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562584933,"ip_address":"","comment_id":111401,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"微服务的服务发现是不是也算一类负载均衡？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457335,"discussion_content":"服务发现用了负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562584933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17465,"user_name":"小橙橙","can_delete":false,"product_type":"c1","uid":1054923,"ip_address":"","ucode":"4F467210A15F66","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/cb/edb5a0a0.jpg","comment_is_top":false,"comment_ctime":1532663025,"is_pvip":false,"replies":[{"id":6153,"content":"查询nginx官方文档，里面有介绍health check","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532918287,"ip_address":"","comment_id":17465,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师，有个问题一直不是很清楚，如果用nginx轮询做负载均衡，下游某个服务挂掉了，那就会导致某些请求无法响应，这样的问题要如何解决呢？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421165,"discussion_content":"查询nginx官方文档，里面有介绍health check","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532918287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12785,"user_name":"迟博🙈","can_delete":false,"product_type":"c1","uid":1102280,"ip_address":"","ucode":"BBE8E522D43B98","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/c8/80b4011d.jpg","comment_is_top":false,"comment_ctime":1529029234,"is_pvip":false,"replies":[{"id":4240,"content":"会有异地多活章节讲","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046229,"ip_address":"","comment_id":12785,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"我看到好多评论说多多机房，请问一下多机房的数据一致一般怎么解决的？数据库通过专线组成跨dc的多主集群？这个后面会讲到吗？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421165,"discussion_content":"查询nginx官方文档，里面有介绍health check","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532918287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12505,"user_name":"feifei","can_delete":false,"product_type":"c1","uid":1105431,"ip_address":"","ucode":"B1F8AE3AD82C51","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/17/75e2b624.jpg","comment_is_top":false,"comment_ctime":1528872271,"is_pvip":false,"replies":[{"id":4169,"content":"日活用户数 ！= 用户访问数，论坛类业务，一个用户一天可能访问几十个页面","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528943033,"ip_address":"","comment_id":12505,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"日活跃用户千万，按14小时折算，每秒并发198，但这是平均，还有高峰时段，并发按平均并发5倍来估算，即每秒1千，然后来对比方案：\n\nDns负载，目前单机房能够满足，没跨机房的必要，dns目前不适用。\n硬件负载，每秒几百万级的并非，很显然系统没有这么高的并发，硬件负载不适合。\n软件负载，nginx单台能支持到5万的并发，当前系统,折算最高的并发也不过千级别。\n\n经过方案的对比，软件负载使用nginx可以完全满足业务的要求，所以使用软件负载即可\n\n","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419280,"discussion_content":"日活用户数 ！= 用户访问数，论坛类业务，一个用户一天可能访问几十个页面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528943033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12344,"user_name":"三月沙@wecatch","can_delete":false,"product_type":"c1","uid":1034980,"ip_address":"","ucode":"16FEF6C74D24E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/e4/f15a1cf0.jpg","comment_is_top":false,"comment_ctime":1528769555,"is_pvip":false,"replies":[{"id":4102,"content":"1000万日活的业务，你真的要这么节省么？😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868848,"ip_address":"","comment_id":12344,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"不考虑多机房，不考虑不同地区，一个配置好点的nginx 就够了，防止单点，可以再加一台","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419224,"discussion_content":"1000万日活的业务，你真的要这么节省么？😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120,"discussion_content":"nginx支持5W，是什么样的服务器呢？nginx并发量5w是指负责均衡并发，还是处理请求并发？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561115622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12319,"user_name":"肖一林","can_delete":false,"product_type":"c1","uid":1113317,"ip_address":"","ucode":"1DE45D906EB836","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/e5/605f423f.jpg","comment_is_top":false,"comment_ctime":1528765287,"is_pvip":false,"replies":[{"id":4106,"content":"这种方式也可以，dns做同机房多入口负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869493,"ip_address":"","comment_id":12319,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"峰值大概就是5000&#47;s～20000&#47;s，要看论坛活跃度。所以一个ng就够了。dns负载均衡也不一定就要支持异地多活吧，同一个机房多台主机也是可以的，所以最多dns+ng就可以很完美。需要异地多活的项目应该非常少。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419224,"discussion_content":"1000万日活的业务，你真的要这么节省么？😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120,"discussion_content":"nginx支持5W，是什么样的服务器呢？nginx并发量5w是指负责均衡并发，还是处理请求并发？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561115622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12278,"user_name":"黄金的太阳","can_delete":false,"product_type":"c1","uid":1105079,"ip_address":"","ucode":"9D7F2397124AB9","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg","comment_is_top":false,"comment_ctime":1528760963,"is_pvip":false,"replies":[{"id":4112,"content":"基本正确，中国一般分南北区域接入，西部用户确实少很多","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869935,"ip_address":"","comment_id":12278,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"假设论坛的用户平均分布在全国各地(东，西，南，北四个区域)，1000万的日活跃用户平均分散到每个区域后可近似估计并发量在2.5万～5万用户，可以采用两级嵌套的负载均衡架构\n1.利用DNS达到四个地域的负载均衡\n2.利用Nginx的方式达到本区域内的负载均衡\n此方案未考虑西部地区用户少，东部地区用户多的情况，在并发量尚可接受的范围内，可以考虑将单台Nginx集群化以增强并发负载支持能力\n\n不知道理解的对不对","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419211,"discussion_content":"这种方式也可以，dns做同机房多入口负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389886,"user_name":"冲","can_delete":false,"product_type":"c1","uid":1149914,"ip_address":"陕西","ucode":"4191C8A4DF3840","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIk46cor5XVFTPZbPOnb7pViabgy450pobo46hRHFQz5nR5ocYRKIzC8vShic36vwa553H4Vj50x5wA/132","comment_is_top":false,"comment_ctime":1713780148,"is_pvip":false,"replies":[{"id":142035,"content":"2013年左右的32核 intel至强服务器，只做简单的反向代理负载均衡。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1715414830,"ip_address":"广东","comment_id":389886,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师问下这个Nginx 5w的并发是在什么条件下的，Nginx装在一个专门的服务器上，下面还需要多少个装接口的服务器？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419188,"discussion_content":"基本正确，中国一般分南北区域接入，西部用户确实少很多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338028,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1647244668,"is_pvip":false,"replies":[{"id":123690,"content":"是的，就是这么做的，找个好的DNS和CDN服务商","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1647476895,"ip_address":"","comment_id":338028,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师同学好，所以DNS负载均衡就是多机房部署，剩下的就交给域名服务商了？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644665,"discussion_content":"2013年左右的32核 intel至强服务器，只做简单的反向代理负载均衡。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715414830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136104,"user_name":"Geek_ebe1c1","can_delete":false,"product_type":"c1","uid":1664768,"ip_address":"","ucode":"3942F6D4ABF86F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erD9YTBibqNvibicyicp31gBdJLJ7KPTuePMeibNWKGv9PydRID0AwvtUYEIO6qpTvXQpxbktR8fuHkCaA/132","comment_is_top":false,"comment_ctime":1569365574,"is_pvip":false,"replies":[{"id":52144,"content":"QPS是查询，TPS是写入，都是并发衡量指标","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569373763,"ip_address":"","comment_id":136104,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师说明并发是qps么 ","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556694,"discussion_content":"是的，就是这么做的，找个好的DNS和CDN服务商","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647476895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37677,"user_name":"h…","can_delete":false,"product_type":"c1","uid":1052539,"ip_address":"","ucode":"E713F11CBA6AB0","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/7b/7c043069.jpg","comment_is_top":false,"comment_ctime":1541673943,"is_pvip":false,"replies":[{"id":13612,"content":"学习永远都不晚，加油👍","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1541751743,"ip_address":"","comment_id":37677,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，我来晚了，才上车~","like_count":1},{"had_liked":false,"id":14735,"user_name":"道法自然","can_delete":false,"product_type":"c1","uid":1063627,"ip_address":"","ucode":"E4DFD0415A6291","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/cb/97dee373.jpg","comment_is_top":false,"comment_ctime":1530623507,"is_pvip":false,"replies":[{"id":4974,"content":"并发数：同一时刻的接收的访问数量，时间单位一般用秒，也可以用分钟和小时，常见有并发请求数，并发连接数\n\nQPS：query per second，指查询类请求\n\n日活：每日活跃用户数，指当天来访问过系统的用户，同一用户，无论用户访问多少功能和页面都只算一个用户","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530663037,"ip_address":"","comment_id":14735,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"我也希望老师能对并发数，qps，日活等这些能够举个经典例子计算下，网上虽然有，可是总觉着讲解地不是很清楚，对这块一直都有点迷糊。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420111,"discussion_content":"并发数：同一时刻的接收的访问数量，时间单位一般用秒，也可以用分钟和小时，常见有并发请求数，并发连接数\n\nQPS：query per second，指查询类请求\n\n日活：每日活跃用户数，指当天来访问过系统的用户，同一用户，无论用户访问多少功能和页面都只算一个用户","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530663037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12678,"user_name":"Mask","can_delete":false,"product_type":"c1","uid":1027441,"ip_address":"","ucode":"3C8849ADE88553","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ad/71/cb16306a.jpg","comment_is_top":false,"comment_ctime":1528953024,"is_pvip":false,"replies":[{"id":4255,"content":"负载均衡不涉及数据同步，是指将请求分发到不同服务器","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529047365,"ip_address":"","comment_id":12678,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，这个负载均衡会涉及到数据同步吗？还是说我没搞懂😂，多台服务器其实访问的是同一个数据库服务器，不存在数据实时同步的问题。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420111,"discussion_content":"并发数：同一时刻的接收的访问数量，时间单位一般用秒，也可以用分钟和小时，常见有并发请求数，并发连接数\n\nQPS：query per second，指查询类请求\n\n日活：每日活跃用户数，指当天来访问过系统的用户，同一用户，无论用户访问多少功能和页面都只算一个用户","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530663037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12282,"user_name":"姜泮昌","can_delete":false,"product_type":"c1","uid":1107213,"ip_address":"","ucode":"89B63270BAE099","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/0d/b4258141.jpg","comment_is_top":false,"comment_ctime":1528761962,"is_pvip":false,"replies":[{"id":4111,"content":"下一章就介绍算法","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869865,"ip_address":"","comment_id":12282,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"首先可以增加DNS负载均衡，如果部分地区并发访问量仍然大大，或无法使用DNS负载均衡，则可以搭建一个F5的集群，然后再通过另外一台F5对这个F5集群进行任务分配，成本虽略贵，但相信对于这样有海量用户的系统也不会有太大的成本压力。另外老师啥时候介绍一下负载均衡的算法？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419363,"discussion_content":"负载均衡不涉及数据同步，是指将请求分发到不同服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529047365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119,"discussion_content":"那这个用单数据库能支撑吗？如果能的话，使用dsn分布到不同区域的服务器上？那不同地区的服务器还是要访问同一个数据库吧？那这个数据库该放在哪里呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561115101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354822,"user_name":"Allan","can_delete":false,"product_type":"c1","uid":1310388,"ip_address":"广东","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1660806513,"is_pvip":false,"replies":[{"id":129495,"content":"正解","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1661763524,"ip_address":"广东","comment_id":354822,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"日活跃用户 1000 万的论坛，tps粗略算一下在100.那么用nginx去做负载就足以抵挡的住了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419190,"discussion_content":"下一章就介绍算法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352712,"user_name":"杨恒","can_delete":false,"product_type":"c1","uid":3066545,"ip_address":"北京","ucode":"057CCB97B56740","user_header":"https://static001.geekbang.org/account/avatar/00/2e/ca/b1/044d3e98.jpg","comment_is_top":false,"comment_ctime":1658893717,"is_pvip":false,"replies":[{"id":128338,"content":"比如说，你要按照用户ID来分区，将不同用户的请求转发到不同的机房，四层怎么做呢？","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1659066266,"ip_address":"北京","comment_id":352712,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"F5也有软件的版本。\n4 层和 7 层的区别就在于协议和灵活性---这个描述不准确吧，这个关键是在哪层做，当然每层都有自己的协议。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585691,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661763524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340583,"user_name":"别惹年轻人","can_delete":false,"product_type":"c1","uid":1328102,"ip_address":"","ucode":"F02CE0AA709EED","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/e6/99fd4bb9.jpg","comment_is_top":false,"comment_ctime":1648954200,"is_pvip":false,"replies":[{"id":124589,"content":"虽然结论正确，但qps估算有点低。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1649119902,"ip_address":"","comment_id":340583,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"1000&#47;24&#47;60&#47;60*10000 * 10 = 1160，qps约等于1160。\n访问量不是很大，应该用不上硬件负载均衡。\n为了加快访问速度，使用DNS负载均衡 + 软件负载均衡就够了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581912,"discussion_content":"比如说，你要按照用户ID来分区，将不同用户的请求转发到不同的机房，四层怎么做呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659066266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333003,"user_name":"沐雪","can_delete":false,"product_type":"c1","uid":1028301,"ip_address":"","ucode":"0C42BF0D75FD9B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/cd/c54572fe.jpg","comment_is_top":false,"comment_ctime":1643950979,"is_pvip":false,"replies":[{"id":121709,"content":"Nginx顶4万没什么压力，配个64核的机器是够的","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1644028098,"ip_address":"","comment_id":333003,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"千万日活 约等于  10亿级 访问量， 1万&#47;秒的访问量；峰值4万；\n若用Nginx，则有点危险，最好外面在加个 LVS   ;\n1个Lvs---&gt;  4个Nginx \n1个Nginx---&gt; 10个tomcat\n","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549490,"discussion_content":"Nginx顶4万没什么压力，配个64核的机器是够的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644028098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316310,"user_name":"Walter","can_delete":false,"product_type":"c1","uid":1142493,"ip_address":"","ucode":"2AE436899510D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/dd/9f6f3305.jpg","comment_is_top":false,"comment_ctime":1634266361,"is_pvip":false,"replies":[{"id":114619,"content":"可以根据用户ip解析出用户归属地，你在百度都可以搜到ip归属地查询，原理是一样的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1634372678,"ip_address":"","comment_id":316310,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，在DNS章节里面，是怎么保证北方用户访问的就是北方的机房，南方用户访问的就是深圳的机房?","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528350,"discussion_content":"可以根据用户ip解析出用户归属地，你在百度都可以搜到ip归属地查询，原理是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634372678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253460,"user_name":"过去已落幕","can_delete":false,"product_type":"c1","uid":1311130,"ip_address":"","ucode":"26C6D697967B60","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/9a/d379c292.jpg","comment_is_top":false,"comment_ctime":1602744966,"is_pvip":false,"replies":[{"id":92721,"content":"当然会出问题，会丢包，需要增加下游的处理能力","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1602910085,"ip_address":"","comment_id":253460,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"示例里面硬件负载的性能比软件高，当并发足够大时候，硬件负载的下游软件负载处理不过来，会不会出现问题。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528350,"discussion_content":"可以根据用户ip解析出用户归属地，你在百度都可以搜到ip归属地查询，原理是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634372678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37677,"user_name":"h…","can_delete":false,"product_type":"c1","uid":1052539,"ip_address":"","ucode":"E713F11CBA6AB0","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/7b/7c043069.jpg","comment_is_top":false,"comment_ctime":1541673943,"is_pvip":false,"replies":[{"id":13612,"content":"学习永远都不晚，加油👍","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1541751743,"ip_address":"","comment_id":37677,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，我来晚了，才上车~","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428445,"discussion_content":"学习永远都不晚，加油👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541751743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14735,"user_name":"道法自然","can_delete":false,"product_type":"c1","uid":1063627,"ip_address":"","ucode":"E4DFD0415A6291","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/cb/97dee373.jpg","comment_is_top":false,"comment_ctime":1530623507,"is_pvip":false,"replies":[{"id":4974,"content":"并发数：同一时刻的接收的访问数量，时间单位一般用秒，也可以用分钟和小时，常见有并发请求数，并发连接数\n\nQPS：query per second，指查询类请求\n\n日活：每日活跃用户数，指当天来访问过系统的用户，同一用户，无论用户访问多少功能和页面都只算一个用户","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530663037,"ip_address":"","comment_id":14735,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"我也希望老师能对并发数，qps，日活等这些能够举个经典例子计算下，网上虽然有，可是总觉着讲解地不是很清楚，对这块一直都有点迷糊。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428445,"discussion_content":"学习永远都不晚，加油👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541751743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12678,"user_name":"Mask","can_delete":false,"product_type":"c1","uid":1027441,"ip_address":"","ucode":"3C8849ADE88553","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ad/71/cb16306a.jpg","comment_is_top":false,"comment_ctime":1528953024,"is_pvip":false,"replies":[{"id":4255,"content":"负载均衡不涉及数据同步，是指将请求分发到不同服务器","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529047365,"ip_address":"","comment_id":12678,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，这个负载均衡会涉及到数据同步吗？还是说我没搞懂😂，多台服务器其实访问的是同一个数据库服务器，不存在数据实时同步的问题。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419363,"discussion_content":"负载均衡不涉及数据同步，是指将请求分发到不同服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529047365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523315,"avatar":"","nickname":"GeekCoder","note":"","ucode":"14BB73CBE28545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":119,"discussion_content":"那这个用单数据库能支撑吗？如果能的话，使用dsn分布到不同区域的服务器上？那不同地区的服务器还是要访问同一个数据库吧？那这个数据库该放在哪里呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561115101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12282,"user_name":"姜泮昌","can_delete":false,"product_type":"c1","uid":1107213,"ip_address":"","ucode":"89B63270BAE099","user_header":"https://static001.geekbang.org/account/avatar/00/10/e5/0d/b4258141.jpg","comment_is_top":false,"comment_ctime":1528761962,"is_pvip":false,"replies":[{"id":4111,"content":"下一章就介绍算法","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528869865,"ip_address":"","comment_id":12282,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"首先可以增加DNS负载均衡，如果部分地区并发访问量仍然大大，或无法使用DNS负载均衡，则可以搭建一个F5的集群，然后再通过另外一台F5对这个F5集群进行任务分配，成本虽略贵，但相信对于这样有海量用户的系统也不会有太大的成本压力。另外老师啥时候介绍一下负载均衡的算法？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419190,"discussion_content":"下一章就介绍算法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528869865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354822,"user_name":"Allan","can_delete":false,"product_type":"c1","uid":1310388,"ip_address":"广东","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1660806513,"is_pvip":false,"replies":[{"id":129495,"content":"正解","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1661763524,"ip_address":"广东","comment_id":354822,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"日活跃用户 1000 万的论坛，tps粗略算一下在100.那么用nginx去做负载就足以抵挡的住了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585691,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661763524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352712,"user_name":"杨恒","can_delete":false,"product_type":"c1","uid":3066545,"ip_address":"北京","ucode":"057CCB97B56740","user_header":"https://static001.geekbang.org/account/avatar/00/2e/ca/b1/044d3e98.jpg","comment_is_top":false,"comment_ctime":1658893717,"is_pvip":false,"replies":[{"id":128338,"content":"比如说，你要按照用户ID来分区，将不同用户的请求转发到不同的机房，四层怎么做呢？","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1659066266,"ip_address":"北京","comment_id":352712,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"F5也有软件的版本。\n4 层和 7 层的区别就在于协议和灵活性---这个描述不准确吧，这个关键是在哪层做，当然每层都有自己的协议。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581912,"discussion_content":"比如说，你要按照用户ID来分区，将不同用户的请求转发到不同的机房，四层怎么做呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659066266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340583,"user_name":"别惹年轻人","can_delete":false,"product_type":"c1","uid":1328102,"ip_address":"","ucode":"F02CE0AA709EED","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/e6/99fd4bb9.jpg","comment_is_top":false,"comment_ctime":1648954200,"is_pvip":false,"replies":[{"id":124589,"content":"虽然结论正确，但qps估算有点低。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1649119902,"ip_address":"","comment_id":340583,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"1000&#47;24&#47;60&#47;60*10000 * 10 = 1160，qps约等于1160。\n访问量不是很大，应该用不上硬件负载均衡。\n为了加快访问速度，使用DNS负载均衡 + 软件负载均衡就够了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560001,"discussion_content":"虽然结论正确，但qps估算有点低。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649119902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333003,"user_name":"沐雪","can_delete":false,"product_type":"c1","uid":1028301,"ip_address":"","ucode":"0C42BF0D75FD9B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/cd/c54572fe.jpg","comment_is_top":false,"comment_ctime":1643950979,"is_pvip":false,"replies":[{"id":121709,"content":"Nginx顶4万没什么压力，配个64核的机器是够的","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1644028098,"ip_address":"","comment_id":333003,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"千万日活 约等于  10亿级 访问量， 1万&#47;秒的访问量；峰值4万；\n若用Nginx，则有点危险，最好外面在加个 LVS   ;\n1个Lvs---&gt;  4个Nginx \n1个Nginx---&gt; 10个tomcat\n","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560001,"discussion_content":"虽然结论正确，但qps估算有点低。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649119902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316310,"user_name":"Walter","can_delete":false,"product_type":"c1","uid":1142493,"ip_address":"","ucode":"2AE436899510D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/dd/9f6f3305.jpg","comment_is_top":false,"comment_ctime":1634266361,"is_pvip":false,"replies":[{"id":114619,"content":"可以根据用户ip解析出用户归属地，你在百度都可以搜到ip归属地查询，原理是一样的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1634372678,"ip_address":"","comment_id":316310,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，在DNS章节里面，是怎么保证北方用户访问的就是北方的机房，南方用户访问的就是深圳的机房?","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549490,"discussion_content":"Nginx顶4万没什么压力，配个64核的机器是够的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644028098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253460,"user_name":"过去已落幕","can_delete":false,"product_type":"c1","uid":1311130,"ip_address":"","ucode":"26C6D697967B60","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/9a/d379c292.jpg","comment_is_top":false,"comment_ctime":1602744966,"is_pvip":false,"replies":[{"id":92721,"content":"当然会出问题，会丢包，需要增加下游的处理能力","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1602910085,"ip_address":"","comment_id":253460,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"示例里面硬件负载的性能比软件高，当并发足够大时候，硬件负载的下游软件负载处理不过来，会不会出现问题。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507077,"discussion_content":"当然会出问题，会丢包，需要增加下游的处理能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602910085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251557,"user_name":"追忆似水年华","can_delete":false,"product_type":"c1","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1601686816,"is_pvip":false,"replies":[{"id":92107,"content":"你可以理解为大家讨论的是抽象出来的模型，假设一个页面一个连接，你说的是实际情况那就按5～6个来算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1602082947,"ip_address":"","comment_id":251557,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"想到一个问题，用户访问访问一个页面，浏览器本身的并发数在5～6之间，也就是会同时请求5～6个网页的静态资源，但是看大家在专栏里的讨论，好像都是把访问一个页面看做一个并发连接，这样统计没有问题么？","like_count":0},{"had_liked":false,"id":249652,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1600741898,"is_pvip":true,"replies":[{"id":91872,"content":"低配的是马自达6，笔者写文章的时候车的价格大概20多万������","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1601431675,"ip_address":"","comment_id":249652,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"有一天在路上看到了 Q7，突然就想起了高配的硬件负载均衡 F5，但是想不起来便宜点的对应是什么车。\n\n为什么我觉的 4 层的 LVS, Linux Visual Server 要比 7 层的 Nginx 厉害呢？因为 LVS 协议无关啊。\n\n对于思考题，日活跃 1000 万的论坛，如果不考虑时区的影响，假设一天当中有 1 个小时是高峰时段，那么需要抗住的流量也就 1 万&#47;秒 上下，那么 Nginx 应该就够用了。\n\n看了 @鹅米豆发 的留言，膜拜一下大佬。\n\n我确实把日活 1000 万用户与请求数混淆了。\n\n再来计算一次的话，1000 万日活，假设高峰时段集中在 4 个小时左右，大概等于 700 用户每秒（这里有一点疑问，不知道用户平均在线时间，这样计算，似乎不是很准确），应该找一下用户在线的峰值。\n\n再增加一点假设，假设用户平均停留时间为 30 分钟，那么在高峰时段的 30 分钟内，就有 125 万用户在线。\n\n用户平均在 30 分钟内操作 30 次（这个可能也需要数据支持）。\n\n这样计算下来大概是 1,250,000 * 30 &#47; 30 * 60 = 20833 QPS\n\n如果是单机房的话，那么先用 Nginx 顶上去看看效果，然后按照访问 IP 的地理分布，添加 DNS 的负载均衡，并且增加多机房配置。\n\n当然，如果论坛很赚钱的话，那就直接上 F5 好了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506541,"discussion_content":"你可以理解为大家讨论的是抽象出来的模型，假设一个页面一个连接，你说的是实际情况那就按5～6个来算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602082947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248652,"user_name":"脱缰的野马__","can_delete":false,"product_type":"c1","uid":1447569,"ip_address":"","ucode":"D5F993E7232C61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","comment_is_top":false,"comment_ctime":1600253399,"is_pvip":false,"replies":[{"id":91371,"content":"一看连接是否存在，二看是否能够发出去，三看响应是否快速\n挂了当然是直接踢掉","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1600394212,"ip_address":"","comment_id":248652,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师，请问这三类负载均衡方式，都是怎么对目标节点存活状态进行实时监控的啊，比如心跳检测类似的。没看到老师讲解，如果某个地理级别的硬件负载均衡挂了、或者硬件负载均衡中某个集群都挂了、或者软件负载均衡中的某个机器挂了是怎么发现的呢？如果挂了他们都是怎么处理的呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505978,"discussion_content":"低配的是马自达6，笔者写文章的时候车的价格大概20多万������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601431675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242750,"user_name":"上班族程序员设计师的水果","can_delete":false,"product_type":"c1","uid":1247422,"ip_address":"","ucode":"C56B24D4BF1A79","user_header":"https://static001.geekbang.org/account/avatar/00/13/08/be/19527615.jpg","comment_is_top":false,"comment_ctime":1597830801,"is_pvip":false,"replies":[{"id":89629,"content":"DNS服务器你不能控制，但是脚本和配置都是你控制的呀������","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1597984332,"ip_address":"","comment_id":242750,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"怎样通过DNS来访问异地服务器？DNS服务器我们不是不能控制么？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505710,"discussion_content":"一看连接是否存在，二看是否能够发出去，三看响应是否快速\n挂了当然是直接踢掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600394212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189852,"user_name":"高源","can_delete":false,"product_type":"c1","uid":1048887,"ip_address":"","ucode":"751B41FD38EF7D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","comment_is_top":false,"comment_ctime":1584577479,"is_pvip":false,"replies":[{"id":74897,"content":"给了样例告诉你怎么算了呀","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1585540917,"ip_address":"","comment_id":189852,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师能都否按你说的问题，详细的说明一下具体设计方案，具体数据怎么算出来的，根据算出来结果具体如何配置","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504087,"discussion_content":"DNS服务器你不能控制，但是脚本和配置都是你控制的呀������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597984332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153346,"user_name":"古月三石","can_delete":false,"product_type":"c1","uid":1503260,"ip_address":"","ucode":"D03D7484B0A3F4","user_header":"https://static001.geekbang.org/account/avatar/00/16/f0/1c/53f18c18.jpg","comment_is_top":false,"comment_ctime":1574220589,"is_pvip":false,"replies":[{"id":59065,"content":"DNS本身就无法做到实时生效，而且主要是读操作，所以一个数据库和多个数据库在性能上都没问题，用一主多从就可以了，可用性和性能都能搞定","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1574303353,"ip_address":"","comment_id":153346,"utype":1}],"discussion_count":2,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师请教个问题，dns负载后边的数据库是一个还是多个？ 如果是多个怎么解决多个库间的同步问题，如果是一个那是不是网络延时会很大？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487811,"discussion_content":"给了样例告诉你怎么算了呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585540917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128897,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1566981083,"is_pvip":false,"replies":[{"id":48293,"content":"这个是业务来评估的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1567153173,"ip_address":"","comment_id":128897,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"课后思考及问题\n1：学习曲线下去啦！以下为核心观点\n1-1：活多了，一个人总是干不完的，此时只能增加人手了，人手一多，活该怎么分是一个问题，那就增加一个分活的——任务分配器，又叫负载均衡器。\n分活的策略就是负载均衡的算法啦——随机、轮询、加权轮询、各种哈希，随便只要把活分出去就行😁\n\n1-2：注意，负载均衡不只是为了计算单元的负载达到均衡状态——不过我觉得是为了达到这个目的的，即使让能干的多干一些或者让离的近的把活干了，其根本目的就是为了把活尽快干完。\n\n1-3：常见的负载均衡分类，软硬DNS，\n软件负载均衡用于实现机器级别的负载均衡；\n硬件负载均衡用于实现集群级别的负载均衡；\nDNS 负载均衡用于实现地理级别的负载均衡；\n\n1-4：核心就是分活的人和分活的方式\n日活——日活动用户量，1000万，那确实比较大，大概是全国人口的百分之一，每个用户至少访问一个页面吧！平均估计有十个\nQPS——每秒查询请求的次数\nTPS——每秒业务处理的次数\n评估资源的关键，我觉得就是怎么评估同一时刻大概多少人同时在线，这个怎么评估呢？日活的百分之几或者千分之几？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475131,"discussion_content":"DNS本身就无法做到实时生效，而且主要是读操作，所以一个数据库和多个数据库在性能上都没问题，用一主多从就可以了，可用性和性能都能搞定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574303353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556197,"discussion_content":"您好，有问题，DNS的并发请求不高吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647244263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121261,"user_name":"(╯‵□′)╯︵┻━┻","can_delete":false,"product_type":"c1","uid":1387589,"ip_address":"","ucode":"10A03AB1CB6B42","user_header":"https://static001.geekbang.org/account/avatar/00/15/2c/45/e8bcf142.jpg","comment_is_top":false,"comment_ctime":1565089421,"is_pvip":false,"replies":[{"id":44574,"content":"你的方案有点重😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1565095373,"ip_address":"","comment_id":121261,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"由于整体访问量大，首先对全局添加硬件负载均衡，其次对访问量高的服务集群添加第二层硬件负载均衡，而对于访问量低的业务或服务只采用软件负载均衡。如果有异地服务器集群，则相应地使用DNS负载均衡。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465161,"discussion_content":"这个是业务来评估的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567153173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105985,"user_name":"GeekCoder","can_delete":false,"product_type":"c1","uid":1523315,"ip_address":"","ucode":"14BB73CBE28545","user_header":"","comment_is_top":false,"comment_ctime":1561120437,"is_pvip":false,"replies":[{"id":38782,"content":"看1000万日活平均每人发多少评论","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1561483322,"ip_address":"","comment_id":105985,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"直播类app或抖音短视频，1000w的日活，怎么算评论中的那些数据？如qps","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461711,"discussion_content":"你的方案有点重😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565095373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41432,"user_name":"gameboy120","can_delete":false,"product_type":"c1","uid":1026790,"ip_address":"","ucode":"298DE6A17A2C66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/e6/cc3f3853.jpg","comment_is_top":false,"comment_ctime":1542779714,"is_pvip":false,"replies":[{"id":14907,"content":"pv是通用的，不一定很精确，但偏差不会太大","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1542790369,"ip_address":"","comment_id":41432,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"按照pv算一个页面一次请求，会不会不准，每个页面会有异步调用，这个不考虑进去吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454903,"discussion_content":"看1000万日活平均每人发多少评论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561483322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251557,"user_name":"追忆似水年华","can_delete":false,"product_type":"c1","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1601686816,"is_pvip":false,"replies":[{"id":92107,"content":"你可以理解为大家讨论的是抽象出来的模型，假设一个页面一个连接，你说的是实际情况那就按5～6个来算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1602082947,"ip_address":"","comment_id":251557,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"想到一个问题，用户访问访问一个页面，浏览器本身的并发数在5～6之间，也就是会同时请求5～6个网页的静态资源，但是看大家在专栏里的讨论，好像都是把访问一个页面看做一个并发连接，这样统计没有问题么？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506541,"discussion_content":"你可以理解为大家讨论的是抽象出来的模型，假设一个页面一个连接，你说的是实际情况那就按5～6个来算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602082947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249652,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1600741898,"is_pvip":true,"replies":[{"id":91872,"content":"低配的是马自达6，笔者写文章的时候车的价格大概20多万������","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1601431675,"ip_address":"","comment_id":249652,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"有一天在路上看到了 Q7，突然就想起了高配的硬件负载均衡 F5，但是想不起来便宜点的对应是什么车。\n\n为什么我觉的 4 层的 LVS, Linux Visual Server 要比 7 层的 Nginx 厉害呢？因为 LVS 协议无关啊。\n\n对于思考题，日活跃 1000 万的论坛，如果不考虑时区的影响，假设一天当中有 1 个小时是高峰时段，那么需要抗住的流量也就 1 万&#47;秒 上下，那么 Nginx 应该就够用了。\n\n看了 @鹅米豆发 的留言，膜拜一下大佬。\n\n我确实把日活 1000 万用户与请求数混淆了。\n\n再来计算一次的话，1000 万日活，假设高峰时段集中在 4 个小时左右，大概等于 700 用户每秒（这里有一点疑问，不知道用户平均在线时间，这样计算，似乎不是很准确），应该找一下用户在线的峰值。\n\n再增加一点假设，假设用户平均停留时间为 30 分钟，那么在高峰时段的 30 分钟内，就有 125 万用户在线。\n\n用户平均在 30 分钟内操作 30 次（这个可能也需要数据支持）。\n\n这样计算下来大概是 1,250,000 * 30 &#47; 30 * 60 = 20833 QPS\n\n如果是单机房的话，那么先用 Nginx 顶上去看看效果，然后按照访问 IP 的地理分布，添加 DNS 的负载均衡，并且增加多机房配置。\n\n当然，如果论坛很赚钱的话，那就直接上 F5 好了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505978,"discussion_content":"低配的是马自达6，笔者写文章的时候车的价格大概20多万������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601431675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248652,"user_name":"脱缰的野马__","can_delete":false,"product_type":"c1","uid":1447569,"ip_address":"","ucode":"D5F993E7232C61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","comment_is_top":false,"comment_ctime":1600253399,"is_pvip":false,"replies":[{"id":91371,"content":"一看连接是否存在，二看是否能够发出去，三看响应是否快速\n挂了当然是直接踢掉","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1600394212,"ip_address":"","comment_id":248652,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师，请问这三类负载均衡方式，都是怎么对目标节点存活状态进行实时监控的啊，比如心跳检测类似的。没看到老师讲解，如果某个地理级别的硬件负载均衡挂了、或者硬件负载均衡中某个集群都挂了、或者软件负载均衡中的某个机器挂了是怎么发现的呢？如果挂了他们都是怎么处理的呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505710,"discussion_content":"一看连接是否存在，二看是否能够发出去，三看响应是否快速\n挂了当然是直接踢掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600394212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242750,"user_name":"上班族程序员设计师的水果","can_delete":false,"product_type":"c1","uid":1247422,"ip_address":"","ucode":"C56B24D4BF1A79","user_header":"https://static001.geekbang.org/account/avatar/00/13/08/be/19527615.jpg","comment_is_top":false,"comment_ctime":1597830801,"is_pvip":false,"replies":[{"id":89629,"content":"DNS服务器你不能控制，但是脚本和配置都是你控制的呀������","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1597984332,"ip_address":"","comment_id":242750,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"怎样通过DNS来访问异地服务器？DNS服务器我们不是不能控制么？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504087,"discussion_content":"DNS服务器你不能控制，但是脚本和配置都是你控制的呀������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597984332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189852,"user_name":"高源","can_delete":false,"product_type":"c1","uid":1048887,"ip_address":"","ucode":"751B41FD38EF7D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","comment_is_top":false,"comment_ctime":1584577479,"is_pvip":false,"replies":[{"id":74897,"content":"给了样例告诉你怎么算了呀","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1585540917,"ip_address":"","comment_id":189852,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师能都否按你说的问题，详细的说明一下具体设计方案，具体数据怎么算出来的，根据算出来结果具体如何配置","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487811,"discussion_content":"给了样例告诉你怎么算了呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585540917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153346,"user_name":"古月三石","can_delete":false,"product_type":"c1","uid":1503260,"ip_address":"","ucode":"D03D7484B0A3F4","user_header":"https://static001.geekbang.org/account/avatar/00/16/f0/1c/53f18c18.jpg","comment_is_top":false,"comment_ctime":1574220589,"is_pvip":false,"replies":[{"id":59065,"content":"DNS本身就无法做到实时生效，而且主要是读操作，所以一个数据库和多个数据库在性能上都没问题，用一主多从就可以了，可用性和性能都能搞定","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1574303353,"ip_address":"","comment_id":153346,"utype":1}],"discussion_count":2,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师请教个问题，dns负载后边的数据库是一个还是多个？ 如果是多个怎么解决多个库间的同步问题，如果是一个那是不是网络延时会很大？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475131,"discussion_content":"DNS本身就无法做到实时生效，而且主要是读操作，所以一个数据库和多个数据库在性能上都没问题，用一主多从就可以了，可用性和性能都能搞定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574303353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556197,"discussion_content":"您好，有问题，DNS的并发请求不高吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647244263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128897,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1566981083,"is_pvip":false,"replies":[{"id":48293,"content":"这个是业务来评估的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1567153173,"ip_address":"","comment_id":128897,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"课后思考及问题\n1：学习曲线下去啦！以下为核心观点\n1-1：活多了，一个人总是干不完的，此时只能增加人手了，人手一多，活该怎么分是一个问题，那就增加一个分活的——任务分配器，又叫负载均衡器。\n分活的策略就是负载均衡的算法啦——随机、轮询、加权轮询、各种哈希，随便只要把活分出去就行😁\n\n1-2：注意，负载均衡不只是为了计算单元的负载达到均衡状态——不过我觉得是为了达到这个目的的，即使让能干的多干一些或者让离的近的把活干了，其根本目的就是为了把活尽快干完。\n\n1-3：常见的负载均衡分类，软硬DNS，\n软件负载均衡用于实现机器级别的负载均衡；\n硬件负载均衡用于实现集群级别的负载均衡；\nDNS 负载均衡用于实现地理级别的负载均衡；\n\n1-4：核心就是分活的人和分活的方式\n日活——日活动用户量，1000万，那确实比较大，大概是全国人口的百分之一，每个用户至少访问一个页面吧！平均估计有十个\nQPS——每秒查询请求的次数\nTPS——每秒业务处理的次数\n评估资源的关键，我觉得就是怎么评估同一时刻大概多少人同时在线，这个怎么评估呢？日活的百分之几或者千分之几？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465161,"discussion_content":"这个是业务来评估的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567153173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121261,"user_name":"(╯‵□′)╯︵┻━┻","can_delete":false,"product_type":"c1","uid":1387589,"ip_address":"","ucode":"10A03AB1CB6B42","user_header":"https://static001.geekbang.org/account/avatar/00/15/2c/45/e8bcf142.jpg","comment_is_top":false,"comment_ctime":1565089421,"is_pvip":false,"replies":[{"id":44574,"content":"你的方案有点重😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1565095373,"ip_address":"","comment_id":121261,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"由于整体访问量大，首先对全局添加硬件负载均衡，其次对访问量高的服务集群添加第二层硬件负载均衡，而对于访问量低的业务或服务只采用软件负载均衡。如果有异地服务器集群，则相应地使用DNS负载均衡。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461711,"discussion_content":"你的方案有点重😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565095373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105985,"user_name":"GeekCoder","can_delete":false,"product_type":"c1","uid":1523315,"ip_address":"","ucode":"14BB73CBE28545","user_header":"","comment_is_top":false,"comment_ctime":1561120437,"is_pvip":false,"replies":[{"id":38782,"content":"看1000万日活平均每人发多少评论","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1561483322,"ip_address":"","comment_id":105985,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"直播类app或抖音短视频，1000w的日活，怎么算评论中的那些数据？如qps","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454903,"discussion_content":"看1000万日活平均每人发多少评论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561483322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41432,"user_name":"gameboy120","can_delete":false,"product_type":"c1","uid":1026790,"ip_address":"","ucode":"298DE6A17A2C66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/e6/cc3f3853.jpg","comment_is_top":false,"comment_ctime":1542779714,"is_pvip":false,"replies":[{"id":14907,"content":"pv是通用的，不一定很精确，但偏差不会太大","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1542790369,"ip_address":"","comment_id":41432,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"按照pv算一个页面一次请求，会不会不准，每个页面会有异步调用，这个不考虑进去吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429799,"discussion_content":"pv是通用的，不一定很精确，但偏差不会太大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542790369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35302,"user_name":"aaaaaaaaaaaas","can_delete":false,"product_type":"c1","uid":1230417,"ip_address":"","ucode":"44F3D4DB3F5678","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/51/30c17473.jpg","comment_is_top":false,"comment_ctime":1540514312,"is_pvip":false,"replies":[{"id":12597,"content":"一个F5后面接20个nginx，每个nginx再接10太服务器，类似这种架构","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1540530576,"ip_address":"","comment_id":35302,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，我有个地方不明白。现在有比如说现在有100w的并发量到 F5，绕后再分发到nginx，但nginx只能每秒5w的并发量，那说明再nginx处请求排队是吗？而且服务器就这么多，最后由nginx分发的请求 不应该和只用F5 分发是一样的吗？","like_count":0},{"had_liked":false,"id":22139,"user_name":"I","can_delete":false,"product_type":"c1","uid":1207154,"ip_address":"","ucode":"3D4EF00284C3AA","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/72/30c631fe.jpg","comment_is_top":false,"comment_ctime":1535506151,"is_pvip":false,"replies":[{"id":7990,"content":"上云也要考虑买什么负载均衡设备呢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1535608788,"ip_address":"","comment_id":22139,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"上云就不用考虑这么多了","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427507,"discussion_content":"一个F5后面接20个nginx，每个nginx再接10太服务器，类似这种架构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540530576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13958,"user_name":"楼剑波","can_delete":false,"product_type":"c1","uid":1086725,"ip_address":"","ucode":"CC24C50CB8E1A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/95/05/1b5cbc41.jpg","comment_is_top":false,"comment_ctime":1530085150,"is_pvip":false,"replies":[{"id":4691,"content":"买不买不一定，用是肯定要用的😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530178612,"ip_address":"","comment_id":13958,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，能回答下，政府部门的域名也是通过域名服务商那里买的吗？比如说万网，他们也需要dns，把域名解析到IP吧？感觉dns是所有架构都要采用的，要么你的网站就只要IP访问。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423013,"discussion_content":"上云也要考虑买什么负载均衡设备呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535608788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12654,"user_name":"Skysper","can_delete":false,"product_type":"c1","uid":1058800,"ip_address":"","ucode":"164B3CAF81A7C5","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg","comment_is_top":false,"comment_ctime":1528946172,"is_pvip":false,"replies":[{"id":4359,"content":"日活1000万不是日pv 1000万，整体计算逻辑是OK的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529378562,"ip_address":"","comment_id":12654,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"可以选用DNS做区域划分 在使用Ｎginx做负载均衡。 日活1000万，每秒并发115，峰值按照10～100 也只在 1150～11500，Nginx 和DNS成本较低 也足够使用","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419823,"discussion_content":"买不买不一定，用是肯定要用的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530178612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12470,"user_name":"learn more","can_delete":false,"product_type":"c1","uid":1128702,"ip_address":"","ucode":"0EF628B2E0F95E","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/fe/04f56d1e.jpg","comment_is_top":false,"comment_ctime":1528852125,"is_pvip":false,"replies":[{"id":4094,"content":"名词可以上网查查，计算方法参考前面高性能复杂度的内容","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868259,"ip_address":"","comment_id":12470,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"活跃用户数，并发数，每秒并发量，qps，峰值估算，最大连接数等等，这些名词充满了整篇文章和评论，可是计算结果千差万别，恳请作者帮帮新手如何计算这几个值，以及确定概念","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419354,"discussion_content":"日活1000万不是日pv 1000万，整体计算逻辑是OK的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529378562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12466,"user_name":"zhou","can_delete":false,"product_type":"c1","uid":1046778,"ip_address":"","ucode":"40BB6A203732FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLJbYWRtYLxGl6dVTH9JKQ10Lbhkyf2vArGs7YGvDKKxrZibo2OTt5AMCqgSznrJrVRWfLf8bftxvA/132","comment_is_top":false,"comment_ctime":1528851534,"is_pvip":false,"replies":[{"id":4170,"content":"规则引擎和设计模式类似，都是单机具体实现的一种方式，和架构关系不大，所以没有进行阐述","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528943167,"ip_address":"","comment_id":12466,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"你好，后续可介绍下有些偏业务的规则引擎相关的知识吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419268,"discussion_content":"名词可以上网查查，计算方法参考前面高性能复杂度的内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12449,"user_name":"sunlight001","can_delete":false,"product_type":"c1","uid":1126975,"ip_address":"","ucode":"A72C4274D5DE8A","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/3f/fa4ac035.jpg","comment_is_top":false,"comment_ctime":1528847818,"is_pvip":false,"replies":[{"id":4096,"content":"论坛业务其实可以不用dns做地理位置负载均衡，用CDN效果更好","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868523,"ip_address":"","comment_id":12449,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"感觉这种设计初期，考虑用户体验，可以用dns+ha+nginx来做负载均衡，一般的可能不用dns也差不多，用了dns肯定是要快些的","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419267,"discussion_content":"规则引擎和设计模式类似，都是单机具体实现的一种方式，和架构关系不大，所以没有进行阐述","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528943167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12365,"user_name":"林","can_delete":false,"product_type":"c1","uid":1022243,"ip_address":"","ucode":"273F83CB3F9DF8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/23/3c3272bd.jpg","comment_is_top":false,"comment_ctime":1528781405,"is_pvip":false,"replies":[{"id":4103,"content":"用户数不能当QPS，每个用户会访问很多页面，论坛用户可能评论访问20页面以上\n\n其它分析基本OK","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868938,"ip_address":"","comment_id":12365,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"\r日活1000万，平均每秒活跃就是1000万&#47;86400=115，高峰放大10倍也就是1150，这是每秒活跃用户，不知能否当作QPS？\n\r个人觉得论坛读多写少类的，加上老师之前说的mysql读写分离或分库分表(需要结合实际情况)+高性缓存结合，前面Nginx做负载均衡（Nginx理论上每秒5万QPS)，MySQL读写分离，后端三台WebServer，根据三原则之简单原则不知是否可以抗得住？ \n","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419261,"discussion_content":"论坛业务其实可以不用dns做地理位置负载均衡，用CDN效果更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12423,"user_name":"公号-技术夜未眠","can_delete":false,"product_type":"c1","uid":1013683,"ip_address":"","ucode":"83825B57CBD952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/b3/991f3f9b.jpg","comment_is_top":false,"comment_ctime":1528813331,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":7,"product_id":100006601,"comment_content":"通过容量规划，并考虑到高性能、高可用的要求，Web最前端可采用HAProxy+Keepalived双机(实现故障转移，保证高可用)作为负载均衡器；\n后端的数据库架构采用MySQL一主多从，读写分离的方式，可采用LVS+Keepalived的方式实现读数据库的负载均衡与故障转移。","like_count":2},{"had_liked":false,"id":184276,"user_name":"谭方敏","can_delete":false,"product_type":"c1","uid":1710960,"ip_address":"","ucode":"728DC7ECB7C902","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg","comment_is_top":false,"comment_ctime":1583282344,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"\n前面同学提到的计算思路很赞呀，根据日活得到qps值，然后结合论坛业务读多写少的特性，计算出业务规模，之后再进行容量设计，三种负载均衡策略各有特点（dns负载基于地理位置；硬件负载f5, a10百万并发；软件负载万级或者十万级并发），但不是非此即彼互斥的关系，而是可以组合来发挥最大效率的。\n其实除了这三级负载均衡，目前还有cdn，主要用于加速dns。\n针对论坛的方案，可以通过cdn+dns+nginx&#47;haproxy这种组合就好了。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419230,"discussion_content":"用户数不能当QPS，每个用户会访问很多页面，论坛用户可能评论访问20页面以上\n\n其它分析基本OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35302,"user_name":"aaaaaaaaaaaas","can_delete":false,"product_type":"c1","uid":1230417,"ip_address":"","ucode":"44F3D4DB3F5678","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/51/30c17473.jpg","comment_is_top":false,"comment_ctime":1540514312,"is_pvip":false,"replies":[{"id":12597,"content":"一个F5后面接20个nginx，每个nginx再接10太服务器，类似这种架构","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1540530576,"ip_address":"","comment_id":35302,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，我有个地方不明白。现在有比如说现在有100w的并发量到 F5，绕后再分发到nginx，但nginx只能每秒5w的并发量，那说明再nginx处请求排队是吗？而且服务器就这么多，最后由nginx分发的请求 不应该和只用F5 分发是一样的吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427507,"discussion_content":"一个F5后面接20个nginx，每个nginx再接10太服务器，类似这种架构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540530576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":22139,"user_name":"I","can_delete":false,"product_type":"c1","uid":1207154,"ip_address":"","ucode":"3D4EF00284C3AA","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/72/30c631fe.jpg","comment_is_top":false,"comment_ctime":1535506151,"is_pvip":false,"replies":[{"id":7990,"content":"上云也要考虑买什么负载均衡设备呢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1535608788,"ip_address":"","comment_id":22139,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"上云就不用考虑这么多了","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423013,"discussion_content":"上云也要考虑买什么负载均衡设备呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535608788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13958,"user_name":"楼剑波","can_delete":false,"product_type":"c1","uid":1086725,"ip_address":"","ucode":"CC24C50CB8E1A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/95/05/1b5cbc41.jpg","comment_is_top":false,"comment_ctime":1530085150,"is_pvip":false,"replies":[{"id":4691,"content":"买不买不一定，用是肯定要用的😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530178612,"ip_address":"","comment_id":13958,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，能回答下，政府部门的域名也是通过域名服务商那里买的吗？比如说万网，他们也需要dns，把域名解析到IP吧？感觉dns是所有架构都要采用的，要么你的网站就只要IP访问。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419823,"discussion_content":"买不买不一定，用是肯定要用的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530178612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12654,"user_name":"Skysper","can_delete":false,"product_type":"c1","uid":1058800,"ip_address":"","ucode":"164B3CAF81A7C5","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg","comment_is_top":false,"comment_ctime":1528946172,"is_pvip":false,"replies":[{"id":4359,"content":"日活1000万不是日pv 1000万，整体计算逻辑是OK的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529378562,"ip_address":"","comment_id":12654,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"可以选用DNS做区域划分 在使用Ｎginx做负载均衡。 日活1000万，每秒并发115，峰值按照10～100 也只在 1150～11500，Nginx 和DNS成本较低 也足够使用","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419354,"discussion_content":"日活1000万不是日pv 1000万，整体计算逻辑是OK的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529378562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12470,"user_name":"learn more","can_delete":false,"product_type":"c1","uid":1128702,"ip_address":"","ucode":"0EF628B2E0F95E","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/fe/04f56d1e.jpg","comment_is_top":false,"comment_ctime":1528852125,"is_pvip":false,"replies":[{"id":4094,"content":"名词可以上网查查，计算方法参考前面高性能复杂度的内容","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868259,"ip_address":"","comment_id":12470,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"活跃用户数，并发数，每秒并发量，qps，峰值估算，最大连接数等等，这些名词充满了整篇文章和评论，可是计算结果千差万别，恳请作者帮帮新手如何计算这几个值，以及确定概念","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419268,"discussion_content":"名词可以上网查查，计算方法参考前面高性能复杂度的内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12466,"user_name":"zhou","can_delete":false,"product_type":"c1","uid":1046778,"ip_address":"","ucode":"40BB6A203732FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLJbYWRtYLxGl6dVTH9JKQ10Lbhkyf2vArGs7YGvDKKxrZibo2OTt5AMCqgSznrJrVRWfLf8bftxvA/132","comment_is_top":false,"comment_ctime":1528851534,"is_pvip":false,"replies":[{"id":4170,"content":"规则引擎和设计模式类似，都是单机具体实现的一种方式，和架构关系不大，所以没有进行阐述","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528943167,"ip_address":"","comment_id":12466,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"你好，后续可介绍下有些偏业务的规则引擎相关的知识吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419267,"discussion_content":"规则引擎和设计模式类似，都是单机具体实现的一种方式，和架构关系不大，所以没有进行阐述","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528943167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12449,"user_name":"sunlight001","can_delete":false,"product_type":"c1","uid":1126975,"ip_address":"","ucode":"A72C4274D5DE8A","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/3f/fa4ac035.jpg","comment_is_top":false,"comment_ctime":1528847818,"is_pvip":false,"replies":[{"id":4096,"content":"论坛业务其实可以不用dns做地理位置负载均衡，用CDN效果更好","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868523,"ip_address":"","comment_id":12449,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"感觉这种设计初期，考虑用户体验，可以用dns+ha+nginx来做负载均衡，一般的可能不用dns也差不多，用了dns肯定是要快些的","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419261,"discussion_content":"论坛业务其实可以不用dns做地理位置负载均衡，用CDN效果更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12365,"user_name":"林","can_delete":false,"product_type":"c1","uid":1022243,"ip_address":"","ucode":"273F83CB3F9DF8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/23/3c3272bd.jpg","comment_is_top":false,"comment_ctime":1528781405,"is_pvip":false,"replies":[{"id":4103,"content":"用户数不能当QPS，每个用户会访问很多页面，论坛用户可能评论访问20页面以上\n\n其它分析基本OK","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528868938,"ip_address":"","comment_id":12365,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"\r日活1000万，平均每秒活跃就是1000万&#47;86400=115，高峰放大10倍也就是1150，这是每秒活跃用户，不知能否当作QPS？\n\r个人觉得论坛读多写少类的，加上老师之前说的mysql读写分离或分库分表(需要结合实际情况)+高性缓存结合，前面Nginx做负载均衡（Nginx理论上每秒5万QPS)，MySQL读写分离，后端三台WebServer，根据三原则之简单原则不知是否可以抗得住？ \n","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419230,"discussion_content":"用户数不能当QPS，每个用户会访问很多页面，论坛用户可能评论访问20页面以上\n\n其它分析基本OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528868938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12423,"user_name":"公号-技术夜未眠","can_delete":false,"product_type":"c1","uid":1013683,"ip_address":"","ucode":"83825B57CBD952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/b3/991f3f9b.jpg","comment_is_top":false,"comment_ctime":1528813331,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":7,"product_id":100006601,"comment_content":"通过容量规划，并考虑到高性能、高可用的要求，Web最前端可采用HAProxy+Keepalived双机(实现故障转移，保证高可用)作为负载均衡器；\n后端的数据库架构采用MySQL一主多从，读写分离的方式，可采用LVS+Keepalived的方式实现读数据库的负载均衡与故障转移。","like_count":2},{"had_liked":false,"id":184276,"user_name":"谭方敏","can_delete":false,"product_type":"c1","uid":1710960,"ip_address":"","ucode":"728DC7ECB7C902","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg","comment_is_top":false,"comment_ctime":1583282344,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"\n前面同学提到的计算思路很赞呀，根据日活得到qps值，然后结合论坛业务读多写少的特性，计算出业务规模，之后再进行容量设计，三种负载均衡策略各有特点（dns负载基于地理位置；硬件负载f5, a10百万并发；软件负载万级或者十万级并发），但不是非此即彼互斥的关系，而是可以组合来发挥最大效率的。\n其实除了这三级负载均衡，目前还有cdn，主要用于加速dns。\n针对论坛的方案，可以通过cdn+dns+nginx&#47;haproxy这种组合就好了。","like_count":1},{"had_liked":false,"id":16444,"user_name":"Ezekiel","can_delete":false,"product_type":"c1","uid":1112636,"ip_address":"","ucode":"0C3DC3A4426432","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/3c/da87559e.jpg","comment_is_top":false,"comment_ctime":1531962397,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"还是要具体看业务，这个论坛是关于什么内容的论坛，是否有区域量级不同的情况，如果存在则考虑下DNS均衡，论坛应该都不怎么赚钱的，硬件均衡可以不考虑，请求量较大，LVS做集群均衡，Nginx做机器均衡感觉就可以了。论坛个人觉得做好读写分离和缓存设计才是重点。","like_count":1},{"had_liked":false,"id":12439,"user_name":"一位不愿透露姓名的王先生","can_delete":false,"product_type":"c1","uid":1031394,"ip_address":"","ucode":"EB2C9420B3484A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/e2/e760c8e2.jpg","comment_is_top":false,"comment_ctime":1528822585,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"多台LVS+ECMP做前端负载均衡，Nginx做Web服务器，其实主要压力还是在应用逻辑和数据库上，中间再加上一层缓存","like_count":1},{"had_liked":false,"id":312226,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631694139,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"前端：NGINX负载均衡 后台：tomcat  中间件可用：redis集群 数据库：mysql主从集群","like_count":0},{"had_liked":false,"id":196305,"user_name":"阿恒","can_delete":false,"product_type":"c1","uid":1100238,"ip_address":"","ucode":"59434AB37236E5","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/ce/cc85c6c3.jpg","comment_is_top":false,"comment_ctime":1585271324,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"按照这个思路，通过机器架构和峰值也能预估一下日活","like_count":0},{"had_liked":false,"id":169659,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1578399275,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":8,"product_id":100006601,"comment_content":" 3 种常见的负载均衡机制：DNS 负载均衡、硬件负载均衡、软件负载均衡，每种方式都有一些优缺点，但并不意味着在实际应用中只能基于它们的优缺点进行非此即彼的选择，反而是基于它们的优缺点进行组合使用。具体来说，组合的基本原则为：DNS 负载均衡用于实现地理级别的负载均衡；硬件负载均衡用于实现集群级别的负载均衡；软件负载均衡用于实现机器级别的负载均衡。","like_count":0},{"had_liked":false,"id":68532,"user_name":"gkb111","can_delete":false,"product_type":"c1","uid":1224217,"ip_address":"","ucode":"9B3154BCC9046B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLUic3XzxET3L3QXxcTbeg96GMx1HkiaiaZdudchmOmtPnuEPHK5vYEeMkvJR098XljMbXDialYib3z6w/132","comment_is_top":false,"comment_ctime":1550539655,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"负载均衡，dns，软件，硬件。软件nginx.lvs。根据qpstps选择相应均衡策略，或者组合策略。\nnginx十万级\n硬件f5百万级","like_count":0},{"had_liked":false,"id":20717,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1534689571,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"DNS和Nginx必用，对于F5根据地域用户量来衡量。若用户量大，达到了百万级，可选择使用F5,因为这种情况下，一般人力和成本不是问题。","like_count":0},{"had_liked":false,"id":13661,"user_name":"孙晓明","can_delete":false,"product_type":"c1","uid":1117094,"ip_address":"","ucode":"CAD28E4D5A3E76","user_header":"https://static001.geekbang.org/account/avatar/00/11/0b/a6/b234aa79.jpg","comment_is_top":false,"comment_ctime":1529911098,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师能讲一下设计思路吗？以前听说是计算并发的话一般是用户数的1%，但是看各位同学的分析都很复杂，而且感觉除以时间的计算方式也不合理，就像您说的，不同系统的访问请求量也是不同的，不能一刀切的除以时间来计算并发。求答案。","like_count":0},{"had_liked":false,"id":13645,"user_name":"李牧之","can_delete":false,"product_type":"c1","uid":1010482,"ip_address":"","ucode":"0D9DA93BB0A05C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/32/b3850660.jpg","comment_is_top":false,"comment_ctime":1529892016,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"id hash的方法只能用着7层负载均衡上吧？另外，请问一下数据库层的负载均衡一般使用什么算法","like_count":0},{"had_liked":false,"id":16444,"user_name":"Ezekiel","can_delete":false,"product_type":"c1","uid":1112636,"ip_address":"","ucode":"0C3DC3A4426432","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/3c/da87559e.jpg","comment_is_top":false,"comment_ctime":1531962397,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"还是要具体看业务，这个论坛是关于什么内容的论坛，是否有区域量级不同的情况，如果存在则考虑下DNS均衡，论坛应该都不怎么赚钱的，硬件均衡可以不考虑，请求量较大，LVS做集群均衡，Nginx做机器均衡感觉就可以了。论坛个人觉得做好读写分离和缓存设计才是重点。","like_count":1},{"had_liked":false,"id":12439,"user_name":"一位不愿透露姓名的王先生","can_delete":false,"product_type":"c1","uid":1031394,"ip_address":"","ucode":"EB2C9420B3484A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/e2/e760c8e2.jpg","comment_is_top":false,"comment_ctime":1528822585,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"多台LVS+ECMP做前端负载均衡，Nginx做Web服务器，其实主要压力还是在应用逻辑和数据库上，中间再加上一层缓存","like_count":1},{"had_liked":false,"id":312226,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631694139,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"前端：NGINX负载均衡 后台：tomcat  中间件可用：redis集群 数据库：mysql主从集群","like_count":0},{"had_liked":false,"id":196305,"user_name":"阿恒","can_delete":false,"product_type":"c1","uid":1100238,"ip_address":"","ucode":"59434AB37236E5","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/ce/cc85c6c3.jpg","comment_is_top":false,"comment_ctime":1585271324,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"按照这个思路，通过机器架构和峰值也能预估一下日活","like_count":0},{"had_liked":false,"id":169659,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1578399275,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":8,"product_id":100006601,"comment_content":" 3 种常见的负载均衡机制：DNS 负载均衡、硬件负载均衡、软件负载均衡，每种方式都有一些优缺点，但并不意味着在实际应用中只能基于它们的优缺点进行非此即彼的选择，反而是基于它们的优缺点进行组合使用。具体来说，组合的基本原则为：DNS 负载均衡用于实现地理级别的负载均衡；硬件负载均衡用于实现集群级别的负载均衡；软件负载均衡用于实现机器级别的负载均衡。","like_count":0},{"had_liked":false,"id":68532,"user_name":"gkb111","can_delete":false,"product_type":"c1","uid":1224217,"ip_address":"","ucode":"9B3154BCC9046B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLUic3XzxET3L3QXxcTbeg96GMx1HkiaiaZdudchmOmtPnuEPHK5vYEeMkvJR098XljMbXDialYib3z6w/132","comment_is_top":false,"comment_ctime":1550539655,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"负载均衡，dns，软件，硬件。软件nginx.lvs。根据qpstps选择相应均衡策略，或者组合策略。\nnginx十万级\n硬件f5百万级","like_count":0},{"had_liked":false,"id":20717,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1534689571,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"DNS和Nginx必用，对于F5根据地域用户量来衡量。若用户量大，达到了百万级，可选择使用F5,因为这种情况下，一般人力和成本不是问题。","like_count":0},{"had_liked":false,"id":13661,"user_name":"孙晓明","can_delete":false,"product_type":"c1","uid":1117094,"ip_address":"","ucode":"CAD28E4D5A3E76","user_header":"https://static001.geekbang.org/account/avatar/00/11/0b/a6/b234aa79.jpg","comment_is_top":false,"comment_ctime":1529911098,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师能讲一下设计思路吗？以前听说是计算并发的话一般是用户数的1%，但是看各位同学的分析都很复杂，而且感觉除以时间的计算方式也不合理，就像您说的，不同系统的访问请求量也是不同的，不能一刀切的除以时间来计算并发。求答案。","like_count":0},{"had_liked":false,"id":13645,"user_name":"李牧之","can_delete":false,"product_type":"c1","uid":1010482,"ip_address":"","ucode":"0D9DA93BB0A05C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/32/b3850660.jpg","comment_is_top":false,"comment_ctime":1529892016,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"id hash的方法只能用着7层负载均衡上吧？另外，请问一下数据库层的负载均衡一般使用什么算法","like_count":0}]}