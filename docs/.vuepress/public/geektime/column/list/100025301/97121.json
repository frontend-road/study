{"id":97121,"title":"17 | Structured Streamingï¼šå¦‚ä½•ç”¨DataFrame APIè¿›è¡Œå®æ—¶æ•°æ®åˆ†æ?","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è”¡å…ƒæ¥ ã€‚</p><p>ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Sparkä¸­çš„æµå¤„ç†åº“Spark Streamingã€‚å®ƒå°†æ— è¾¹ç•Œçš„æµæ•°æ®æŠ½è±¡æˆDStreamï¼ŒæŒ‰ç‰¹å®šçš„æ—¶é—´é—´éš”ï¼ŒæŠŠæ•°æ®æµåˆ†å‰²æˆä¸€ä¸ªä¸ªRDDè¿›è¡Œæ‰¹å¤„ç†ã€‚æ‰€ä»¥ï¼ŒDStream APIä¸RDD APIé«˜åº¦ç›¸ä¼¼ï¼Œä¹Ÿæ‹¥æœ‰RDDçš„å„ç§æ€§è´¨ã€‚</p><p>åœ¨ç¬¬15è®²ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒè¿‡RDDå’ŒDataSet/DataFrameã€‚ä½ è¿˜è®°å¾—DataSet/DataFrameçš„ä¼˜ç‚¹å—ï¼Ÿä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œæ—¢ç„¶å·²ç»æœ‰äº†RDD APIï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥DataSet/DataFrameå‘¢ï¼Ÿ</p><p>è®©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹DataSet/DataFrameçš„ä¼˜ç‚¹ï¼ˆä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬ç»Ÿä¸€ç”¨DataFrameæ¥ä»£æŒ‡DataSetå’ŒDataFrameï¼‰ï¼š</p><ul>\n<li>DataFrame æ˜¯<strong>é«˜çº§API</strong>ï¼Œæä¾›ç±»ä¼¼äº<strong>SQL</strong>çš„queryæ¥å£ï¼Œæ–¹ä¾¿ç†Ÿæ‚‰å…³ç³»å‹æ•°æ®åº“çš„å¼€å‘äººå‘˜ä½¿ç”¨ï¼›</li>\n<li><strong>Spark SQLæ‰§è¡Œå¼•æ“ä¼šè‡ªåŠ¨ä¼˜åŒ–DataFrameç¨‹åº</strong>ï¼Œè€Œç”¨RDD APIå¼€å‘çš„ç¨‹åºæœ¬è´¨ä¸Šéœ€è¦å·¥ç¨‹å¸ˆè‡ªå·±æ„é€ RDDçš„DAGæ‰§è¡Œå›¾ï¼Œæ‰€ä»¥ä¾èµ–äºå·¥ç¨‹å¸ˆè‡ªå·±å»ä¼˜åŒ–ã€‚</li>\n</ul><p>é‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶ä¼šæƒ³åˆ°ï¼Œå¦‚æœå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåŸºäºDataFrame APIçš„æµå¤„ç†æ¨¡å—ï¼Œä½œä¸ºå·¥ç¨‹å¸ˆçš„æˆ‘ä»¬å°±ä¸éœ€è¦å»ç”¨ç›¸å¯¹low levelçš„DStream APIå»å¤„ç†æ— è¾¹ç•Œæ•°æ®ï¼Œè¿™æ ·ä¼šå¤§å¤§æå‡æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p><!-- [[[read_end]]] --><p>åŸºäºè¿™ä¸ªæ€æƒ³ï¼Œ2016å¹´ï¼ŒSparkåœ¨å…¶2.0ç‰ˆæœ¬ä¸­æ¨å‡ºäº†ç»“æ„åŒ–æµæ•°æ®å¤„ç†çš„æ¨¡å—Structured Streamingã€‚</p><p>Structured Streamingæ˜¯åŸºäºSpark SQLå¼•æ“å®ç°çš„ï¼Œä¾é Structured Streamingï¼Œåœ¨å¼€å‘è€…çœ¼é‡Œï¼Œæµæ•°æ®å’Œé™æ€æ•°æ®æ²¡æœ‰åŒºåˆ«ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥åƒæ‰¹å¤„ç†é™æ€æ•°æ®é‚£æ ·å»å¤„ç†æµæ•°æ®ã€‚éšç€æµæ•°æ®çš„æŒç»­è¾“å…¥ï¼ŒSpark SQLå¼•æ“ä¼šå¸®åŠ©æˆ‘ä»¬æŒç»­åœ°å¤„ç†æ–°æ•°æ®ï¼Œå¹¶ä¸”æ›´æ–°è®¡ç®—ç»“æœã€‚</p><p>ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬æ¥ä¸€èµ·å­¦ä¹ Structured Streamingçš„åŸç†ä»¥åŠåº”ç”¨ã€‚</p><h2>Structured Streamingæ¨¡å‹</h2><p>æµæ•°æ®å¤„ç†æœ€åŸºæœ¬çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¯¹ä¸æ–­æ›´æ–°çš„æ— è¾¹ç•Œæ•°æ®å»ºæ¨¡ã€‚</p><p>ä¹‹å‰è®²çš„Spark Streamingå°±æ˜¯æŠŠæµæ•°æ®æŒ‰ä¸€å®šçš„æ—¶é—´é—´éš”åˆ†å‰²æˆè®¸å¤šä¸ªå°çš„æ•°æ®å—è¿›è¡Œæ‰¹å¤„ç†ã€‚åœ¨Structured Streamingçš„æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬è¦æŠŠæ•°æ®çœ‹æˆä¸€ä¸ªæ— è¾¹ç•Œçš„å…³ç³»å‹çš„æ•°æ®è¡¨ã€‚æ¯ä¸€ä¸ªæ•°æ®éƒ½æ˜¯è¡¨ä¸­çš„ä¸€è¡Œï¼Œä¸æ–­ä¼šæœ‰æ–°çš„æ•°æ®è¡Œè¢«æ·»åŠ åˆ°è¡¨é‡Œæ¥ã€‚æˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªè¡¨åšä»»ä½•ç±»ä¼¼æ‰¹å¤„ç†çš„æŸ¥è¯¢ï¼ŒSparkä¼šå¸®æˆ‘ä»¬ä¸æ–­å¯¹æ–°åŠ å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶æ›´æ–°è®¡ç®—ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bb/37/bb1845be9f34ef7d232a509f90ae0337.jpg?wh=2152*1262\" alt=\"\"></p><p>ä¸Spark Streamingç±»ä¼¼ï¼ŒStructured Streamingä¹Ÿæ˜¯å°†è¾“å…¥çš„æ•°æ®æµæŒ‰ç…§æ—¶é—´é—´éš”ï¼ˆä»¥ä¸€ç§’ä¸ºä¾‹ï¼‰åˆ’åˆ†æˆæ•°æ®æ®µã€‚æ¯ä¸€ç§’éƒ½ä¼šæŠŠæ–°è¾“å…¥çš„æ•°æ®æ·»åŠ åˆ°è¡¨ä¸­ï¼ŒSparkä¹Ÿä¼šæ¯ç§’æ›´æ–°è¾“å‡ºç»“æœã€‚è¾“å‡ºç»“æœä¹Ÿæ˜¯è¡¨çš„å½¢å¼ï¼Œè¾“å‡ºè¡¨å¯ä»¥å†™å…¥ç¡¬ç›˜æˆ–è€…HDFSã€‚</p><p>è¿™é‡Œæˆ‘è¦ä»‹ç»ä¸€ä¸‹Structured Streamingçš„ä¸‰ç§è¾“å‡ºæ¨¡å¼ã€‚</p><ol>\n<li>å®Œå…¨æ¨¡å¼ï¼ˆComplete Modeï¼‰ï¼šæ•´ä¸ªæ›´æ–°è¿‡çš„è¾“å‡ºè¡¨éƒ½è¢«å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼›</li>\n<li>é™„åŠ æ¨¡å¼ï¼ˆAppend Modeï¼‰ï¼šä¸Šä¸€æ¬¡è§¦å‘ä¹‹åæ–°å¢åŠ çš„è¡Œæ‰ä¼šè¢«å†™å…¥å¤–éƒ¨å­˜å‚¨ã€‚å¦‚æœè€æ•°æ®æœ‰æ”¹åŠ¨åˆ™ä¸é€‚åˆè¿™ä¸ªæ¨¡å¼ï¼›</li>\n<li>æ›´æ–°æ¨¡å¼ï¼ˆUpdate Modeï¼‰ï¼šä¸Šä¸€æ¬¡è§¦å‘ä¹‹åè¢«æ›´æ–°çš„è¡Œæ‰ä¼šè¢«å†™å…¥å¤–éƒ¨å­˜å‚¨ã€‚</li>\n</ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒStructured Streamingå¹¶ä¸ä¼šå®Œå…¨å­˜å‚¨è¾“å…¥æ•°æ®ã€‚æ¯ä¸ªæ—¶é—´é—´éš”å®ƒéƒ½ä¼šè¯»å–æœ€æ–°çš„è¾“å…¥ï¼Œè¿›è¡Œå¤„ç†ï¼Œæ›´æ–°è¾“å‡ºè¡¨ï¼Œç„¶åæŠŠè¿™æ¬¡çš„è¾“å…¥åˆ é™¤ã€‚Structured Streamingåªä¼šå­˜å‚¨æ›´æ–°è¾“å‡ºè¡¨æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚</p><p>Structured Streamingçš„æ¨¡å‹åœ¨æ ¹æ®äº‹ä»¶æ—¶é—´ï¼ˆEvent Timeï¼‰å¤„ç†æ•°æ®æ—¶ååˆ†æ–¹ä¾¿ã€‚</p><p>æˆ‘ä»¬åœ¨ç¬¬å…­è®²ä¸­æ›¾ç»è®²è¿‡äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ï¼ˆProcessing Timeï¼‰çš„åŒºåˆ«ã€‚è¿™é‡Œæˆ‘å†ç®€å•è¯´ä¸€ä¸‹ã€‚äº‹ä»¶æ—¶é—´æŒ‡çš„æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œæ˜¯æ•°æ®æœ¬èº«çš„å±æ€§ï¼›è€Œå¤„ç†æ—¶é—´æŒ‡çš„æ˜¯Sparkæ¥æ”¶åˆ°æ•°æ®çš„æ—¶é—´ã€‚</p><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºäº‹ä»¶æ—¶é—´æ¥å¤„ç†æ•°æ®ã€‚æ¯”å¦‚è¯´ï¼Œç»Ÿè®¡æ¯ä¸ªå°æ—¶æ¥åˆ°çš„è®¢å•æ•°é‡ï¼Œä¸€ä¸ªè®¢å•å¾ˆæœ‰å¯èƒ½åœ¨12:59è¢«åˆ›å»ºï¼Œä½†æ˜¯åˆ°äº†13:01æ‰è¢«å¤„ç†ã€‚</p><p>åœ¨Structured Streamingçš„æ¨¡å‹ä¸­ï¼Œç”±äºæ¯ä¸ªæ•°æ®éƒ½æ˜¯è¾“å…¥æ•°æ®è¡¨ä¸­çš„ä¸€è¡Œï¼Œé‚£ä¹ˆäº‹ä»¶æ—¶é—´å°±æ˜¯è¡Œä¸­çš„ä¸€åˆ—ã€‚ä¾é DataFrame APIæä¾›çš„ç±»ä¼¼äºSQLçš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰§è¡ŒåŸºäºæ—¶é—´çª—å£çš„æŸ¥è¯¢ã€‚</p><h2>Streaming DataFrame API</h2><p>åœ¨Structured Streamingå‘å¸ƒä»¥åï¼ŒDataFrameæ—¢å¯ä»¥ä»£è¡¨é™æ€çš„æœ‰è¾¹ç•Œæ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»£è¡¨æ— è¾¹ç•Œæ•°æ®ã€‚ä¹‹å‰å¯¹é™æ€DataFrameçš„å„ç§æ“ä½œåŒæ ·ä¹Ÿé€‚ç”¨äºæµå¼DataFrameã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹å‡ ä¸ªä¾‹å­ã€‚</p><h3>åˆ›å»ºDataFrame</h3><p>SparkSession.readStream()è¿”å›çš„DataStreamReaderå¯ä»¥ç”¨äºåˆ›å»ºæµDataFrameã€‚å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®æµä½œä¸ºè¾“å…¥ï¼Œæ¯”å¦‚æ–‡ä»¶ã€Kafkaã€socketç­‰ã€‚</p><pre><code>socketDataFrame = spark\n   .readStream\n   .format(&quot;socket&quot;ï¼‰\n   .option(&quot;host&quot;, &quot;localhost&quot;)\n   .option(&quot;port&quot;, 9999)\n   .load()\n</code></pre><p>ä¸Šè¾¹çš„ä»£ç ä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªDataFrameï¼Œç”¨æ¥ç›‘å¬æ¥è‡ªlocalhost:9999çš„æ•°æ®æµã€‚</p><h3>åŸºæœ¬çš„æŸ¥è¯¢æ“ä½œ</h3><p>æµDataFrameåŒé™æ€DataFrameä¸€æ ·ï¼Œä¸ä»…æ”¯æŒç±»ä¼¼SQLçš„æŸ¥è¯¢æ“ä½œï¼ˆå¦‚selectå’Œwhereç­‰ï¼‰ï¼Œè¿˜æ”¯æŒRDDçš„è½¬æ¢æ“ä½œï¼ˆå¦‚mapå’Œfilterï¼‰ã€‚ è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªDataFrameä»£è¡¨ä¸€ä¸ªå­¦ç”Ÿçš„æ•°æ®æµï¼Œå³æ¯ä¸ªæ•°æ®æ˜¯ä¸€ä¸ªå­¦ç”Ÿï¼Œæ¯ä¸ªå­¦ç”Ÿæœ‰åå­—ï¼ˆnameï¼‰ã€å¹´é¾„ï¼ˆageï¼‰ã€èº«é«˜ï¼ˆheightï¼‰å’Œå¹´çº§ï¼ˆgradeï¼‰å››ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨DataFrame APIå»åšç±»ä¼¼äºSQLçš„Queryã€‚</p><pre><code>df = â€¦ // è¿™ä¸ªDataFrameä»£è¡¨å­¦æ ¡å­¦ç”Ÿçš„æ•°æ®æµï¼Œschemaæ˜¯{name: string, age: number, height: number, grade: string}\ndf.select(&quot;name&quot;).where(&quot;age &gt; 10&quot;) // è¿”å›å¹´é¾„å¤§äº10å²çš„å­¦ç”Ÿåå­—åˆ—è¡¨\ndf.groupBy(&quot;grade&quot;).count() // è¿”å›æ¯ä¸ªå¹´çº§å­¦ç”Ÿçš„äººæ•°\ndf.sort_values([â€˜ageâ€™], ascending=False).head(100) //è¿”å›100ä¸ªå¹´é¾„æœ€å¤§çš„å­¦ç”Ÿ \n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡ç¬¬äºŒè¡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰å¹´é¾„åœ¨10å²ä»¥ä¸Šçš„å­¦ç”Ÿåå­—ï¼Œç¬¬ä¸‰è¡Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå¹´çº§å­¦ç”Ÿçš„äººæ•°ï¼Œç¬¬å››è¡Œå¾—åˆ°100ä¸ªå¹´é¾„æœ€å¤§çš„å­¦ç”Ÿä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDataFrameè¿˜æ”¯æŒå¾ˆå¤šåŸºæœ¬çš„æŸ¥è¯¢æ“ä½œï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡isStreamingå‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªDataFrameæ˜¯å¦ä»£è¡¨æµæ•°æ®ã€‚</p><pre><code>df.isStreaming()\n</code></pre><h3></h3><p>åŸºäºäº‹ä»¶æ—¶é—´çš„æ—¶é—´çª—å£æ“ä½œ</p><p>åœ¨å­¦ä¹ Spark Streamingçš„æ—¶é—´çª—å£æ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¸¾è¿‡ä¸€ä¸ªä¾‹å­ï¼Œæ˜¯æ¯éš”10ç§’é’Ÿè¾“å‡ºè¿‡å»60ç§’çš„å‰åçƒ­ç‚¹è¯ã€‚è¿™ä¸ªä¾‹å­æ˜¯åŸºäºå¤„ç†æ—¶é—´è€Œéäº‹ä»¶æ—¶é—´çš„ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ•°æ®æµä¸­çš„æ¯ä¸ªè¯è¯­éƒ½æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ä»£è¡¨è¯è¯­äº§ç”Ÿçš„æ—¶é—´ï¼Œé‚£ä¹ˆè¦æ€æ ·å®ç°ï¼Œæ¯éš”10ç§’é’Ÿè¾“å‡ºè¿‡å»60ç§’å†…äº§ç”Ÿçš„å‰åçƒ­ç‚¹è¯å‘¢ï¼Ÿä½ å¯ä»¥çœ‹çœ‹ä¸‹è¾¹çš„ä»£ç ã€‚</p><pre><code>words = ...  #è¿™ä¸ªDataFrameä»£è¡¨è¯è¯­çš„æ•°æ®æµï¼Œschemaæ˜¯ { timestamp: Timestamp, word: String}\n\n\nwindowedCounts = words.groupBy(\n   window(words.timestamp, &quot;1 minute&quot;, &quot;10 seconds&quot;),\n   words.word\n).count()\n.sort(desc(&quot;count&quot;))\n.limit(10)\n</code></pre><p>åŸºäºè¯è¯­çš„ç”Ÿæˆæ—¶é—´ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªçª—å£é•¿åº¦ä¸º1åˆ†é’Ÿï¼Œæ»‘åŠ¨é—´éš”ä¸º10ç§’çš„windowã€‚ç„¶åï¼ŒæŠŠè¾“å…¥çš„è¯è¯­è¡¨æ ¹æ®windowå’Œè¯è¯­æœ¬èº«èšåˆèµ·æ¥ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªwindowå†…æ¯ä¸ªè¯è¯­çš„æ•°é‡ã€‚ä¹‹åï¼Œå†æ ¹æ®è¯è¯­çš„æ•°é‡è¿›è¡Œæ’åºï¼Œåªè¿”å›å‰10çš„è¯è¯­ã€‚</p><p>åœ¨Structured StreamingåŸºäºæ—¶é—´çª—å£çš„èšåˆæ“ä½œä¸­ï¼ŒgroupByæ˜¯éå¸¸å¸¸ç”¨çš„ã€‚</p><h3>è¾“å‡ºç»“æœæµ</h3><p>å½“ç»è¿‡å„ç§SQLæŸ¥è¯¢æ“ä½œä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºå¥½äº†ä»£è¡¨æœ€ç»ˆç»“æœçš„DataFrameã€‚ä¸‹ä¸€æ­¥å°±æ˜¯å¼€å§‹å¯¹è¾“å…¥æ•°æ®æµçš„å¤„ç†ï¼Œå¹¶ä¸”æŒç»­è¾“å‡ºç»“æœã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨Dataset.writeStream()è¿”å›çš„DataStreamWriterå¯¹è±¡å»è¾“å‡ºç»“æœã€‚å®ƒæ”¯æŒå¤šç§å†™å…¥ä½ç½®ï¼Œå¦‚ç¡¬ç›˜æ–‡ä»¶ã€Kafkaã€consoleå’Œå†…å­˜ç­‰ã€‚</p><pre><code>query = wordCounts\n   .writeStream\n   .outputMode(&quot;complete&quot;)\n   .format(&quot;csv&quot;)\n   .option(&quot;path&quot;, &quot;path/to/destination/dir&quot;)\n   .start()\n\n\nquery.awaitTermination()\n</code></pre><p>åœ¨ä¸Šé¢è¿™ä¸ªä»£ç ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†å®Œå…¨æ¨¡å¼ï¼ŒæŠŠè¾“å‡ºç»“æœæµå†™å…¥äº†CSVæ–‡ä»¶ã€‚</p><h2>Structured Streamingä¸Spark Streamingå¯¹æ¯”</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹Structured Streamingå’Œä¸Šä¸€è®²å­¦è¿‡çš„Spark Streamingã€‚çœ‹çœ‹åŒä¸ºæµå¤„ç†çš„ç»„ä»¶çš„å®ƒä»¬å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ã€‚</p><h3>ç®€æ˜“åº¦å’Œæ€§èƒ½</h3><p>Spark Streamingæä¾›çš„DStream APIä¸RDD APIå¾ˆç±»ä¼¼ï¼Œç›¸å¯¹æ¯”è¾ƒä½levelã€‚</p><p>å½“æˆ‘ä»¬ç¼–å†™ Spark Streaming ç¨‹åºçš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è¦å»æ„é€ RDDçš„DAGæ‰§è¡Œå›¾ï¼Œç„¶åé€šè¿‡ Spark Engine è¿è¡Œã€‚è¿™æ ·å¼€å‘è€…èº«ä¸Šçš„æ‹…å­å°±å¾ˆé‡ï¼Œå¾ˆå¤šæ—¶å€™è¦è‡ªå·±æƒ³åŠæ³•å»æé«˜ç¨‹åºçš„å¤„ç†æ•ˆç‡ã€‚è¿™ä¸æ˜¯Sparkä½œä¸ºä¸€ä¸ªæ•°æ®å¤„ç†æ¡†æ¶æƒ³çœ‹åˆ°çš„ã€‚å¯¹äºå¥½çš„æ¡†æ¶æ¥è¯´ï¼Œå¼€å‘è€…åªéœ€è¦ä¸“æ³¨åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼Œè€Œä¸ç”¨æ“å¿ƒåˆ«çš„é…ç½®ã€ä¼˜åŒ–ç­‰ç¹æ‚äº‹é¡¹ã€‚</p><p>Structured Streamingæä¾›çš„DataFrame APIå°±æ˜¯è¿™ä¹ˆä¸€ä¸ªç›¸å¯¹é«˜levelçš„APIï¼Œå¤§éƒ¨åˆ†å¼€å‘è€…éƒ½å¾ˆç†Ÿæ‚‰å…³ç³»å‹æ•°æ®åº“å’ŒSQLã€‚<strong>è¿™æ ·çš„æ•°æ®æŠ½è±¡å¯ä»¥è®©ä»–ä»¬ç”¨ä¸€å¥—ç»Ÿä¸€çš„æ–¹æ¡ˆå»å¤„ç†æ‰¹å¤„ç†å’Œæµå¤„ç†</strong>ï¼Œä¸ç”¨å»å…³å¿ƒå…·ä½“çš„æ‰§è¡Œç»†èŠ‚ã€‚</p><p>è€Œä¸”ï¼ŒDataFrame APIæ˜¯åœ¨Spark SQLçš„å¼•æ“ä¸Šæ‰§è¡Œçš„ï¼ŒSpark SQLæœ‰éå¸¸å¤šçš„ä¼˜åŒ–åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†ç­‰ï¼Œæ‰€ä»¥Structured Streamingçš„åº”ç”¨ç¨‹åºæ€§èƒ½å¾ˆå¥½ã€‚</p><h3>å®æ—¶æ€§</h3><p>åœ¨ä¸Šä¸€è®²ä¸­æˆ‘ä»¬äº†è§£åˆ°ï¼ŒSpark Streamingæ˜¯å‡†å®æ—¶çš„ï¼Œå®ƒèƒ½åšåˆ°çš„æœ€å°å»¶è¿Ÿåœ¨ä¸€ç§’å·¦å³ã€‚</p><p>è™½ç„¶Structured Streamingç”¨çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„å¾®æ‰¹å¤„ç†æ€æƒ³ï¼Œæ¯è¿‡ä¸€ä¸ªæ—¶é—´é—´éš”å°±å»æ‹¿æ¥æœ€æ–°çš„æ•°æ®åŠ å…¥åˆ°è¾“å…¥æ•°æ®è¡¨ä¸­å¹¶æ›´æ–°ç»“æœï¼Œä½†æ˜¯ç›¸æ¯”èµ·Spark Streamingæ¥è¯´ï¼Œå®ƒæ›´åƒæ˜¯å®æ—¶å¤„ç†ï¼Œèƒ½åšåˆ°ç”¨æ›´å°çš„æ—¶é—´é—´éš”ï¼Œæœ€å°å»¶è¿Ÿåœ¨100æ¯«ç§’å·¦å³ã€‚</p><p>è€Œä¸”åœ¨Spark 2.3ç‰ˆæœ¬ä¸­ï¼ŒStructured Streamingå¼•å…¥äº†è¿ç»­å¤„ç†çš„æ¨¡å¼ï¼Œå¯ä»¥åšåˆ°çœŸæ­£çš„æ¯«ç§’çº§å»¶è¿Ÿï¼Œè¿™æ— ç–‘å¤§å¤§æ‹“å±•äº†Structured Streamingçš„åº”ç”¨å¹¿åº¦ã€‚ä¸è¿‡ç°åœ¨è¿ç»­å¤„ç†æ¨¡å¼è¿˜æœ‰å¾ˆå¤šé™åˆ¶ï¼Œè®©æˆ‘ä»¬æœŸå¾…å®ƒçš„æœªæ¥å§ã€‚</p><h3>å¯¹äº‹ä»¶æ—¶é—´çš„æ”¯æŒ</h3><p>å°±åƒæˆ‘ä»¬åœ¨å‰è¾¹è®²è¿‡çš„ï¼ŒStructured Streamingå¯¹åŸºäºäº‹ä»¶æ—¶é—´çš„å¤„ç†æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p><p>ç”±äºSpark Streamingæ˜¯æŠŠæ•°æ®æŒ‰æ¥æ”¶åˆ°çš„æ—¶é—´åˆ‡åˆ†æˆä¸€ä¸ªä¸ªRDDæ¥è¿›è¡Œæ‰¹å¤„ç†ï¼Œæ‰€ä»¥å®ƒå¾ˆéš¾åŸºäºæ•°æ®æœ¬èº«çš„äº§ç”Ÿæ—¶é—´æ¥è¿›è¡Œå¤„ç†ã€‚å¦‚æœæŸä¸ªæ•°æ®çš„å¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ä¸ä¸€è‡´çš„è¯ï¼Œå°±å®¹æ˜“å‡ºé—®é¢˜ã€‚æ¯”å¦‚ï¼Œç»Ÿè®¡æ¯ç§’çš„è¯è¯­æ•°é‡ï¼Œæœ‰çš„æ•°æ®å…ˆäº§ç”Ÿï¼Œä½†æ˜¯åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´é—´éš”æ‰è¢«å¤„ç†ï¼Œè¿™æ ·å‡ ä¹ä¸å¯èƒ½è¾“å‡ºæ­£ç¡®çš„ç»“æœã€‚</p><p>Structured Streamingè¿˜æœ‰å¾ˆå¤šå…¶ä»–ä¼˜ç‚¹ã€‚æ¯”å¦‚ï¼Œå®ƒæœ‰æ›´å¥½çš„å®¹é”™æ€§ï¼Œä¿è¯äº†ç«¯åˆ°ç«¯exactly onceçš„è¯­ä¹‰ç­‰ç­‰ã€‚æ‰€ä»¥ç»¼åˆæ¥è¯´ï¼ŒStructured Streamingæ˜¯æ¯”Spark Streamingæ›´å¥½çš„æµå¤„ç†å·¥å…·ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨åŸºäºäº‹ä»¶æ—¶é—´çš„çª—å£æ“ä½œä¸­ï¼ŒStructured Streamingæ˜¯æ€æ ·å¤„ç†æ™šåˆ°è¾¾çš„æ•°æ®ï¼Œå¹¶ä¸”è¿”å›æ­£ç¡®ç»“æœçš„å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼Œåœ¨æ¯ååˆ†é’Ÿç»Ÿè®¡è¯é¢‘çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªè¯è¯­åœ¨1:09è¢«ç”Ÿæˆï¼Œåœ¨1:11è¢«å¤„ç†ï¼Œç¨‹åºåœ¨1:10å’Œ1:20éƒ½è¾“å‡ºäº†å¯¹åº”çš„ç»“æœï¼Œåœ¨1:20è¾“å‡ºæ—¶ä¸ºä»€ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªè¯è¯­ç»Ÿè®¡åœ¨å†…ï¼Ÿè¿™æ ·çš„æœºåˆ¶æœ‰æ²¡æœ‰é™åˆ¶ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠè‡ªå·±çš„ç­”æ¡ˆå†™åœ¨ç•™è¨€åŒºï¼Œä¸æˆ‘å’Œå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚</p><p>å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"16 | Spark Streamingï¼šSparkçš„å®æ—¶æµè®¡ç®—API","id":96792},"right":{"article_title":"18 | Word Countï¼šä»é›¶å¼€å§‹è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªSparkåº”ç”¨","id":97658}},"comments":[{"had_liked":false,"id":98804,"user_name":"é’çŸ³","can_delete":false,"product_type":"c1","uid":1215531,"ip_address":"","ucode":"B0056AD6453322","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg","comment_is_top":false,"comment_ctime":1559097601,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"57393672449","product_id":100025301,"comment_content":"watermarkï¼Œprocess time - event time &gt; watermarkåˆ™ç›´æ¥ä¸¢å¤±ï¼Œprocess time - event time <br>&lt; watermarkåˆ™æ¥æ”¶æ•°æ®å¤„ç†ï¼Œæ›´æ–°ç»“æœè¡¨ã€‚","like_count":14},{"had_liked":false,"id":101946,"user_name":"se7en","can_delete":false,"product_type":"c1","uid":1045247,"ip_address":"","ucode":"E3727BF5186267","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/ff/2a27214e.jpg","comment_is_top":false,"comment_ctime":1560066103,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"48804706359","product_id":100025301,"comment_content":"åŒæ ·éƒ½æ˜¯å¾®æ‰¹å¤„ç†ï¼Œä¸ºä»€ä¹ˆspark streaming å°±ä¸èƒ½å¤„ç†å¾®ç§’ï¼Œè€Œstructure streamingå°±å¯ä»¥","like_count":12,"discussions":[{"author":{"id":1106802,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e3/72/afd1eef0.jpg","nickname":"æŸ³å¹´æ€æ°´","note":"","ucode":"65589C121B904A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1933,"discussion_content":"https://databricks.com/blog/2018/03/20/low-latency-continuous-processing-mode-in-structured-streaming-in-apache-spark-2-3-0.htmlï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥çœ‹ä¸‹","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1563105866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1897610,"avatar":"","nickname":"Fiery","note":"","ucode":"CDB000687A6B14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1106802,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e3/72/afd1eef0.jpg","nickname":"æŸ³å¹´æ€æ°´","note":"","ucode":"65589C121B904A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202824,"discussion_content":"è¿™ç¯‡è¯´çš„æ˜¯æ–°çš„continuous processingå¼•æ“ï¼Œæˆ‘è§‰å¾—åŸé—®é¢˜é—®çš„æ˜¯ä¸ºä»€ä¹ˆåŸºäºmicro-batchçš„structured streamingèƒ½åšåˆ°100æ¯«ç§’ï¼Œä½†æ˜¯spark streamingå°±åªèƒ½æ˜¯ç§’çº§ï¼Œä¸è¿‡æˆ‘çŒœæ˜¯å› ä¸ºåæ¥åªé’ˆå¯¹structured streamingåšäº†ä¸€äº›å…³äºçª—å£çš„ä¼˜åŒ–ï¼Œä½†æ˜¯spark streamingå·²ç»ä¸æ›´æ–°äº†æ²¡åŒ…å«è¿™äº›ä¼˜åŒ–è€Œå·²","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1583952142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1933,"ip_address":""},"score":202824,"extra":""}]}]},{"had_liked":false,"id":171552,"user_name":"å½­ç³","can_delete":false,"product_type":"c1","uid":1804585,"ip_address":"","ucode":"E4E5CEE6FF6366","user_header":"https://static001.geekbang.org/account/avatar/00/1b/89/29/1fba918b.jpg","comment_is_top":false,"comment_ctime":1578966053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35938704421","product_id":100025301,"comment_content":"å…³äºæ€è€ƒé¢˜â€¦â€¦æ®è¯´æ˜¯æœ‰æ°´å°æœºåˆ¶ï¼Œè·Ÿè¸ªæ•°æ®çš„äº‹ä»¶æ—¶é—´ï¼Œé˜ˆå€¼å†…çš„å»¶è¿Ÿæ•°æ®å°†ä¼šè¢«èšåˆï¼Œæ¯”é˜ˆå€¼æ›´å»¶è¿Ÿçš„æ•°æ®å°†è¢«åˆ é™¤ï¼Œåœ¨å†…å­˜ä¸­ç•™æœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€ã€‚è‹¥æœ‰ä¸å¯¹ï¼Œè¯·æŒ‡æ­£ï¼›ä¸è¿‡æ¨èçœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ã€ŠSpark 2.3.0 Structured Streamingè¯¦è§£ã€‹ï¼Œç›¸å½“äºå®˜ç½‘ç¿»è¯‘ï¼šhttps:&#47;&#47;blog.csdn.net&#47;l_15156024189&#47;article&#47;details&#47;81612860","like_count":9},{"had_liked":false,"id":132388,"user_name":"å¤§å¤§ä¸¸å­ğŸ¡","can_delete":false,"product_type":"c1","uid":1215601,"ip_address":"","ucode":"BE3D49F2D9EDCA","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/71/a52ac5c1.jpg","comment_is_top":false,"comment_ctime":1568105429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31632876501","product_id":100025301,"comment_content":"1ã€Structured Streamingæ˜¯åŸºäºäº‹ä»¶äº‹ä»¶å¤„ç†ï¼Œè€Œä¸æ˜¯å¤„ç†äº‹ä»¶ï¼Œæ‰€ä»¥ï¼Œå»¶è¿Ÿæ¥æ”¶çš„æ•°æ®ï¼Œæ˜¯èƒ½è¢«ç»Ÿè®¡åˆ°å¯¹åº”çš„äº‹ä»¶æ—¶é—´çª—å£çš„<br>2ã€è®¾å®šæ•°æ®å»¶è¿Ÿçš„çª—å£æ—¶é—´é˜ˆå€¼ï¼Œé€šè¿‡åˆ¤æ–­é˜ˆå€¼æ¥å†³å®šå»¶è¿Ÿæ•°æ®æ˜¯å¦éœ€è¦çº³å…¥ç»Ÿè®¡ï¼›è¿™ä¸ªé˜ˆå€¼çš„è®¾å®šå¯ä»¥é¿å…å¤§é‡æ•°æ®çš„å»¶è¿Ÿå¯¼è‡´çš„æ€§èƒ½é—®é¢˜","like_count":7},{"had_liked":false,"id":100852,"user_name":"å‘é»æ˜æ•¬ç¤¼","can_delete":false,"product_type":"c1","uid":1241248,"ip_address":"","ucode":"4D7E18FB29C531","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/a0/f83416e9.jpg","comment_is_top":false,"comment_ctime":1559655013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14444556901","product_id":100025301,"comment_content":"withWatermarkå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ æ•°æ®è¡¨ä¸­çš„æ—¶é—´æˆ³å­—æ®µçš„å­—æ®µåï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å»¶è¿Ÿçš„æ—¶é—´é˜ˆå€¼","like_count":4},{"had_liked":false,"id":98304,"user_name":"Ming","can_delete":false,"product_type":"c1","uid":1516011,"ip_address":"","ucode":"69BB73B8AB7E3F","user_header":"https://static001.geekbang.org/account/avatar/00/17/21/eb/bb2e7a3b.jpg","comment_is_top":false,"comment_ctime":1558952323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14443854211","product_id":100025301,"comment_content":"æˆ‘ä¸ç¡®å®šæœ‰æ²¡æœ‰å®Œå…¨ç†è§£é—®é¢˜..<br><br>æˆ‘æƒ³å¤§æ¦‚æ˜¯å› ä¸ºï¼Œè¾“å‡ºæ—¶é—´æ‰€å¯¹åº”çš„çª—å£å¯ä»¥æ•…æ„è®¾ç½®çš„æ¯”è¾“å‡ºæ—¶é—´ç¨å¾®æ—©ä¸€ç‚¹ï¼Œè¿™æ ·å¯ä»¥å¯¹æ•°æ®å»¶è¿Ÿæœ‰ä¸€å®šçš„æŠ—æ€§ã€‚ä¸ç„¶ä¾‹å­ä¸­çš„1:09åˆ†çš„æ•°æ®å°±æ²¡æœºä¼šè¢«ä½¿ç”¨äº†ã€‚<br><br>ä¸è¿‡ç›¸åº”çš„ï¼Œè¿™æ ·çš„æœºåˆ¶ä¼¼ä¹ç»ˆç©¶æ˜¯ä¸ªå¦¥åï¼Œå¦¥åçš„è¶Šå¤§ï¼Œå®æ—¶æ€§å°±è¶Šå·®ã€‚","like_count":4},{"had_liked":false,"id":105562,"user_name":"Geek_86e573","can_delete":false,"product_type":"c1","uid":1506862,"ip_address":"","ucode":"3480C15374B999","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mHibFJhnKJC5wRazXPevbWoRbMkCaJibzSekf3DoJAGygHgXKVIO6zK37e1LVLzpUI7iaER8W93dqyTmQmmuIC4rg/132","comment_is_top":false,"comment_ctime":1561031852,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10150966444","product_id":100025301,"comment_content":"ç”¨è¿‡æ‰çŸ¥é“ï¼Œè¿™ä¸ªä¸œè¥¿ç›®å‰å‘è¿˜æŒºå¤š","like_count":3,"discussions":[{"author":{"id":1168504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","nickname":"æ–¯ç›–ä¸¸","note":"","ucode":"B881D14B028F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213013,"discussion_content":"2.4çš„è¯æœ‰å“ªäº›å‘å•Šâ€¦â€¦ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585043000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104672,"user_name":"CoderLean","can_delete":false,"product_type":"c1","uid":1518409,"ip_address":"","ucode":"DC9E25428EDB3F","user_header":"https://static001.geekbang.org/account/avatar/00/17/2b/49/e94b2a35.jpg","comment_is_top":false,"comment_ctime":1560817130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10150751722","product_id":100025301,"comment_content":"å„ä¸ªç±»çš„ç»§æ‰¿å…³ç³»æœ€å¥½ç”»ä¸€ä¸ªå›¾ï¼Œä¸ç„¶åœ¨è¿™å‡ ä¸ªç« èŠ‚æ‰“è½¬æå¾—æœ‰ç‚¹æ™•","like_count":2},{"had_liked":false,"id":98152,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1558921364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10148855956","product_id":100025301,"comment_content":"spark structure streamingæœ‰æ²¡æœ‰ç±»ä¼¼flinkçš„sideOutputæœºåˆ¶ï¼Ÿæ”¯æŒè¶…è¿‡watermarkçš„äº‹ä»¶è¢«å¤„ç†åˆ°","like_count":2},{"had_liked":false,"id":104989,"user_name":"CoderLean","can_delete":false,"product_type":"c1","uid":1518409,"ip_address":"","ucode":"DC9E25428EDB3F","user_header":"https://static001.geekbang.org/account/avatar/00/17/2b/49/e94b2a35.jpg","comment_is_top":false,"comment_ctime":1560903484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855870780","product_id":100025301,"comment_content":"æœ€åçš„æ€è€ƒé¢˜åªçŸ¥é“flinkæœ‰ä¸€ä¸ªwatermarkæœºåˆ¶å¯ä»¥ä¿è¯","like_count":1},{"had_liked":false,"id":98341,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1558963133,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853930429","product_id":100025301,"comment_content":"ä¸€èˆ¬æ˜¯å¤„ç†æ»åä¸€å®šæ—¶é—´çš„æ•°æ®ï¼Œè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´èŒƒå›´ï¼Œå°±ä¼šèˆå¼ƒ","like_count":1},{"had_liked":false,"id":98141,"user_name":"æ–¹ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1177897,"ip_address":"","ucode":"71194E674DC6D7","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/29/d03c7ad5.jpg","comment_is_top":false,"comment_ctime":1558920024,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853887320","product_id":100025301,"comment_content":"æˆ‘çŸ¥é“åœ¨flinkä¸­å¯ä»¥é€šè¿‡watermarkæ¥å¤„ç†è¿™æ ·çš„åœºæ™¯ï¼Œåœ¨Structured Streamingä¸­åº”è¯¥ä¹Ÿæ˜¯è¿™æ ·çš„æ–¹å¼æ¥å¤„ç†å§ã€‚","like_count":1},{"had_liked":false,"id":98087,"user_name":"Rainbow","can_delete":false,"product_type":"c1","uid":1259525,"ip_address":"","ucode":"248A7E2C05E4DE","user_header":"https://static001.geekbang.org/account/avatar/00/13/38/05/67aae6c8.jpg","comment_is_top":false,"comment_ctime":1558912111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853879407","product_id":100025301,"comment_content":"10åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡ï¼ŒæŒ‰ç…§å¤„ç†æ—¶é—´åˆ†1:00-1:10ï¼Œ1:10-1:20ï¼›æ‰€ä»¥å•è¯çš„å¤„ç†æ—¶é—´ä½äºç¬¬äºŒä¸ªåŒºé—´ä¼šè¢«ç¬¬äºŒæ¬¡ç»Ÿè®¡åˆ°ï¼›å¦‚æœæŒ‰ç…§äº‹ä»¶æ—¶é—´ï¼Œsqlé‡Œtime&gt;1:00 and time&lt;1:10å°±å¯ä»¥æŠŠå•è¯å½’ç±»åˆ°ç¬¬ä¸€ä¸ªåŒºé—´ï¼Œè¿™ä¹ˆç†è§£å¯¹å—ï¼Œè€å¸ˆï¼Ÿ","like_count":1},{"had_liked":false,"id":200111,"user_name":"çˆ¬è¡Œçš„èœ—ç‰›","can_delete":false,"product_type":"c1","uid":1033956,"ip_address":"","ucode":"6623B62DE63CE9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QD6bf8hkS5dHrabdW7M7Oo9An1Oo3QSxqoySJMDh7GTraxFRX77VZ2HZ13x3R4EVYddIGXicRRDAc7V9z5cLDlA/132","comment_is_top":false,"comment_ctime":1585545310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585545310","product_id":100025301,"comment_content":"é€‰æ‹©æ›´æ–°æ¨¡å¼æ˜¯ä¸æ˜¯å°±å¯ä»¥è§£å†³è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œ ","like_count":0},{"had_liked":false,"id":155883,"user_name":".","can_delete":false,"product_type":"c1","uid":1361729,"ip_address":"","ucode":"D2E44AAF2AA31C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJtr0Mee6woib9x0EHPEXh7Or4ZSUicVJgBfskSZZ3zrxAeCqcAselFIZk8uAmSNVDiadBSWyhMiaqL6Q/132","comment_is_top":false,"comment_ctime":1574773625,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574773625","product_id":100025301,"comment_content":"å„ä½å¤§ä½¬å¥½ï¼Œæµå¼å¤„ç†åº”è¯¥æ¶ˆæ¯åº”è¯¥åªè¢«æ¶ˆè´¹ä¸€æ¬¡å§ï¼ŒwaterMarkæœºåˆ¶å¯ä»¥ç¡®ä¿åœ¨1:20è¾“å‡ºï¼Œä»€ä¹ˆæƒ…å†µä¸‹åœ¨1:10è¾“å‡ºäº†å¯¹åº”çš„ç»“æœå‘¢ï¼Ÿæ±‚è§£ã€‚","like_count":0},{"had_liked":false,"id":117884,"user_name":"windcaller","can_delete":false,"product_type":"c1","uid":1514157,"ip_address":"","ucode":"1CA3E849805770","user_header":"https://static001.geekbang.org/account/avatar/00/17/1a/ad/faf1bf19.jpg","comment_is_top":false,"comment_ctime":1564164471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564164471","product_id":100025301,"comment_content":"æˆ‘ç”¨é‚£ä¸ªwithWaterMarké™åˆ¶æ—¶é—´çª—å£è¿›è¡Œæ€è€ƒé¢˜ä¸­çš„æ•°æ®è¿‡æ»¤æ—¶å€™ï¼Œå°±æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œæœ‰æ—¶å€™æ”¾å¼ƒæ‰ï¼Œæœ‰æ—¶å€™å°±æ€ä¹ˆéƒ½ä¸æ”¾å¼ƒï¼Œä¸€ç›´ä¸å¤ªç†è§£è¿™å—å†…å®¹<br>","like_count":0},{"had_liked":false,"id":107274,"user_name":"æ·¹æ­»çš„å¤§è™¾","can_delete":false,"product_type":"c1","uid":1488430,"ip_address":"","ucode":"79DB76C60F8404","user_header":"https://static001.geekbang.org/account/avatar/00/16/b6/2e/096790e1.jpg","comment_is_top":false,"comment_ctime":1561510689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561510689","product_id":100025301,"comment_content":"structure streamingç›¸å½“äºä¸€ç›´åœ¨æ›´æ–°è¾“å‡ºä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨æœ‰äº‹ä»¶æ—¶é—´ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥æŒ‰äº‹ä»¶æ—¶é—´å¤„ç†ï¼›spark streamingåªèƒ½æŒ‰å¤„ç†æ—¶é—´æ¥çš„rddå¤„ç†ï¼Œç¼ºå°‘ä¸€ä¸ªæ±‡æ€»","like_count":0},{"had_liked":false,"id":99035,"user_name":"å¼ å‡¯æ±Ÿ","can_delete":false,"product_type":"c1","uid":1057462,"ip_address":"","ucode":"301905828F489D","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/b6/3d8fcc2c.jpg","comment_is_top":false,"comment_ctime":1559133508,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559133508","product_id":100025301,"comment_content":"è¾“å‡ºæ¨¡å¼æ”¯æŒå‘€ã€‚<br>å®Œå…¨æ¨¡å¼å’Œæ›´æ–°æ¨¡å¼å“ˆã€‚","like_count":0},{"had_liked":false,"id":98773,"user_name":"é”¦","can_delete":false,"product_type":"c1","uid":1468298,"ip_address":"","ucode":"CB0EB4B68C468B","user_header":"https://static001.geekbang.org/account/avatar/00/16/67/8a/babd74dc.jpg","comment_is_top":false,"comment_ctime":1559093190,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559093190","product_id":100025301,"comment_content":"æˆ‘è§‰å¾—å¯èƒ½æ˜¯é€šè¿‡å†—ä½™è®¡ç®—ä¸Šä¸€ä¸ªæ—¶é—´çª—å£ä¸­çš„æ•°æ®æ¥å®ç°çš„ã€‚<br>å±€é™æ€§å°±æ˜¯ä¸æ”¯æŒè¿Ÿåˆ°å¤ªä¹…çš„æ•°æ®","like_count":0},{"had_liked":false,"id":98731,"user_name":"å‘¨å‡¯","can_delete":false,"product_type":"c1","uid":1251177,"ip_address":"","ucode":"C7097F9E86E7B6","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/69/3dea1b7d.jpg","comment_is_top":false,"comment_ctime":1559087854,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559087854","product_id":100025301,"comment_content":"ç¨‹åºåœ¨1:10å¤„ç†çš„æ˜¯1:09ä¹‹å‰ç”Ÿæˆçš„æ•°æ®ï¼Œå¾€åæ¨10åˆ†é’Ÿï¼Œé‚£1:20å¤„ç†çš„æ˜¯1:19ä¹‹å‰ç”Ÿæˆçš„æ•°æ®","like_count":0},{"had_liked":false,"id":98715,"user_name":"èƒ¡é¹","can_delete":false,"product_type":"c1","uid":1326455,"ip_address":"","ucode":"52644EC57FA4DB","user_header":"https://static001.geekbang.org/account/avatar/00/14/3d/77/45e5e06d.jpg","comment_is_top":false,"comment_ctime":1559068490,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559068490","product_id":100025301,"comment_content":"è€å¸ˆ, æˆ‘æœ€è¿‘é‡åˆ°ä¸ªé—®é¢˜è¿˜æœ›å¸®å¿™æç‚¹ä¸€ä¸‹:<br>1. éœ€æ±‚: ç»Ÿè®¡å®æ—¶è®¢å•é‡(ç±»ä¼¼)<br>2. é€šè¿‡maxwellè¯»å–binlogæ•°æ®åŒæ­¥åˆ°kafka<br>3. spark-streamingå¤„ç†kafkaé‡Œé¢çš„æ•°æ®<br>4. spark-sqlå®šä¹‰ä¸åŒçš„å®æ—¶æŠ¥è¡¨<br><br>è¿™æ ·åšçš„æ—¶å€™, å¯¹äºä¸åŒsqlå®šä¹‰çš„æŠ¥è¡¨æˆ‘å°±æ‡µäº†, <br>   å‡å¦‚æ˜¨å¤©éœ€æ±‚æ–¹å†™äº†10ä¸ªSQLæ”¾åˆ°æ•°æ®åº“, ç„¶åæˆ‘ä»¬å¯åŠ¨æµè®¡ç®—, æäº¤jobåˆ°spark, é‚£ä¹ˆ10ä¸ªå®æ—¶çš„æŠ¥è¡¨å°±å¼€å§‹å˜åŠ¨èµ·æ¥äº†<br>   ä½†æ˜¯ä»Šå¤©éœ€æ±‚æ–¹è¯´, è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªæŒ‡æ ‡éœ€è¦ç»Ÿè®¡ä¸€ä¸‹, å°±ç»™æˆ‘äº†2æ¡SQL,<br><br>(å…ˆè¯´æ˜ä¸‹å‰æ, maxwellæŠŠmysqlçš„æ•°æ®æå–å‡ºæ¥æäº¤åˆ°äº†ä¸€ä¸ªkafkaçš„topicé‡Œé¢)<br>ç–‘é—®ç‚¹å‡ºæ¥äº†: <br>    1. å¦‚æœä»æ–°æäº¤ä¸€ä¸ª2æ¡sqlçš„job, å°±å¾—ç‹¬ç«‹æ¶ˆè´¹kafkaæ•°æ®, å¦åˆ™æ•°æ®æœ‰é—æ¼,  (ç›¸å½“äºä¸€æ¡æ²³æµ, åšäº†å¤šä¸ªæˆªæ–­),     ä¸å…¶å¯¹æ¯”çš„æ˜¯: åœ¨ä¹‹å‰æäº¤10ä¸ªSQLçš„jobä¸­, å…ˆå†™å¥½SQLæ¥æºæ˜¯åŠ¨æ€ä»æŸä¸ªæ•°æ®åº“æŸå¼ è¡¨å–å‡ºæ¥çš„, ç„¶åæ•°æ®æµæ¥äº†ç›´æ¥å…±äº«serverè¿›è¡Œè®¡ç®—,    (ç›¸å½“äºä¸€æ¡æ²³æµä¸€æ¬¡æˆªæ–­, å¤šä¸ªç­›é€‰, å¤ç”¨äº†jobçš„æäº¤å’Œkafkaæ¶ˆè´¹è¿™ä¸€æ­¥),  ä¸çŸ¥é“åè€…æ˜¯å¦å¯è¡Œ, æˆ–æ˜¯æœ‰ä»€ä¹ˆå‘? <br>    2. å‡å¦‚é€‰æ‹©äº†é—®é¢˜1 çš„ç¬¬ä¸€ç§æƒ…å†µ, ä¸”å‡å¦‚é‡å¤æ¶ˆè´¹å¾ˆæ¶ˆè€—æ–°èƒ½,  ç„¶åæˆ‘æƒ³åˆ°äº†æ›¿ä»£æ–¹æ¡ˆ,ä¸åŒçš„æ•°æ®åº“binlogæ”¾åˆ°ä¸åŒçš„kafkaçš„topicä¸­,  è®¡ç®—å‡ºç»“æœä¹‹åå†èšåˆ, (è¿™æ ·åšç¼ºç‚¹æ˜¯ä¸æ˜¯å°±æ˜¯å¼€å‘ç¨‹åºéå¸¸éº»çƒ¦å‘¢)?<br><br>ç›®å‰å­˜åœ¨å¦‚ä¸Šä¸¤ä¸ªç–‘é—®, æˆ‘ç›®å‰è§‰å¾—ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç¬¬äºŒç§æƒ…å†µæ¯”è¾ƒé è°±, å¸Œæœ›å¯ä»¥æ±‚è¯, æˆ–è€…æˆ‘åŸæœ¬æ€è€ƒæ–¹å‘å°±æ˜¯é”™çš„,     è¿˜æœ›è€å¸ˆå¸®å¿™æŒ‡ç‚¹ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":98421,"user_name":"RocWay","can_delete":false,"product_type":"c1","uid":1088024,"ip_address":"","ucode":"377CD114BABBF7","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/18/3596069c.jpg","comment_is_top":false,"comment_ctime":1559003138,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559003138","product_id":100025301,"comment_content":"æˆ‘çš„ç†è§£æ˜¯ï¼šè™½ç„¶è®¾ç«‹äº†çª—å£ï¼Œä½†æ˜¯æœ‰äº›äº‹ä»¶å¯èƒ½ç”±äºç½‘ç»œæˆ–å…¶ä»–åŸå› è¿Ÿåˆ°äº†ï¼Œè¿™äº›è¿Ÿåˆ°çš„äº‹ä»¶ä¹Ÿè¦è¢«è®¡ç®—åœ¨å†…ã€‚å¦åˆ™è¿™æ®µçª—å£å†…çš„æ•°æ®è®¡ç®—å°±ä¼šâ€œä¸å‡†â€ã€‚å½“ç„¶ä¹Ÿä¸èƒ½æ— é™å…è®¸è¿Ÿåˆ°ï¼Œæ‰€ä»¥Sparkä¹Ÿè®¾ç«‹äº†watermarkã€‚å¦‚æœçª—å£çš„ç»“æŸæ—¶é—´å‡å»watermarkï¼Œæ¯”æŸä¸ªäº‹ä»¶çš„æ—¶é—´è¿˜â€œæ™šâ€ï¼Œé‚£è¿™ä¸ªäº‹ä»¶å°±ä¸èƒ½ç®—åœ¨è¿™ä¸ªçª—å£é‡Œã€‚","like_count":0},{"had_liked":false,"id":98355,"user_name":"å®‰","can_delete":false,"product_type":"c1","uid":1502447,"ip_address":"","ucode":"C9A5B99149DB3A","user_header":"https://static001.geekbang.org/account/avatar/00/16/ec/ef/99f8dc7b.jpg","comment_is_top":false,"comment_ctime":1558966729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558966729","product_id":100025301,"comment_content":"å› ä¸º1:20æ˜¯å¤„ç†æ—¶é—´ï¼Œ1:09æ˜¯äº‹ä»¶æ—¶é—´ï¼Œ1ç‚¹20è¾“å‡ºæ•°æ®çš„äº‹ä»¶æ—¶é—´è¿˜æ²¡åˆ°1ç‚¹20ã€‚æ˜¯è¿™æ ·å—ï¼Ÿä¸å¤ªç¡®å®š","like_count":0},{"had_liked":false,"id":98154,"user_name":"Cyber_Derek","can_delete":false,"product_type":"c1","uid":1239646,"ip_address":"","ucode":"D9B3596BDC35A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/5e/79dd13b5.jpg","comment_is_top":false,"comment_ctime":1558921805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558921805","product_id":100025301,"comment_content":"ä¸çŸ¥é“è€å¸ˆèƒ½å¦ä¹Ÿè®²è§£ä¸€äº›å…³äºflinkæ–¹é¢çš„ä¸œè¥¿å‘¢ï¼Ÿ","like_count":0}]}