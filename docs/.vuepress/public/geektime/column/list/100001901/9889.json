{"id":9889,"title":"090 | Cassandra和DataStax的故事","content":"<p>Cassandra是大数据时代中非常具有影响力的一个开源项目，DataStax则是背后支持开源Cassandra并将其商业化的公司。今天我们就来聊一下Cassandra和Datatax的故事。</p><p>我们都知道，在大数据发展历史上，谷歌的“三驾马车”：谷歌文件系统、 MapReduce、 BigTable。三者都曾经扮演了非常重要的角色，Hadoop开源生态圈里也有对应的Hadoop文件系统，Hadoop MapReduce和HBase。</p><p>但是在大数据发展史上，还有一篇影响力几乎等同于谷歌“三驾马车”的论文。它讲的就是亚马逊发布的Dynamo系统。</p><p>2008年，Dynamo系统的作者之一阿维纳什·拉克希曼（Avinash Lakshman），跳槽去了Facebook。跳槽的阿维纳（Avinash）和Facebook网站的另外一个工程师普拉桑特·马利克（Prashant Malik），一起开发了Cassandra，一个Dynamo的开源山寨版。</p><p>Cassandra开发出来之后很快就被开源了。早期Facebook对于开源这件事还是非常支持的，但是它开源的Cassandra很快就受到了一次重大的打击，这个打击可以说是十分致命的。</p><!-- [[[read_end]]] --><p>早年的Facebook对于谷歌技术非常崇拜，但对于亚马逊的技术却缺乏信心。于是Facebook准备开发移动App“Messenger”的时候，决定使用谷歌的技术架构。更明确一点说就是，Facebook抛弃了自己开发的Cassandra，选择了当时在Hadoop系统里山寨了BigTable的HBase。</p><p>亲儿子被自己的公司抛弃，开发人员也没什么兴趣继续开发了。与被众心捧月的HBase状态比起来，Cassandra当时就是一种被众人嫌弃的状态，不过，如果故事到此为止的话，那么Cassandra估计也就不会活到今天了。</p><p>我们把时光回溯到2010年，当时在Rackspace工作的乔纳森·艾利斯（Jonathan Ellis）和马特·皮菲尔（Matt Pfeil），这两个和Cassandra无关的人，决定离开Rackspace，自己创业。</p><p>Rackspace在工业界里最为著名的是OpenStack那一套体系，做的是数据中心云计算的基础架构。算起来和Cassandra这套NoSQL的东西多少也有点关系。</p><p>他们创业的故事非常有意思，同时也跟Cassandra有着千丝万缕的联系，公开的说法是这样的。</p><blockquote>\n<p>乔纳森是个很牛的工程师，决定结束碌碌无为的工作状态，辞职创业去。马特代表公司去挽留这个人才，于是两个人约了去吃午餐；然而结局却颇为戏剧化，马特没有说服乔纳森继续为Rackspace工作，而杰纳森却说服了马特和他一起创业，并让他出任自己公司的CEO。<br>\n公司同年成立，最初公司的名字叫Riptano。创业需要有方向，乔纳森和马特看好开源社区商业化的模式，但是他们并没有打算成为Hadoop的发行商，所以环顾四周之后他们挑中了Cassandra，并打算将它做为核心，开启他们的创业之旅。<br>\n大概就是因为选取了Cassandra，公司的定位就比较明确了，也就是选择了云端数据处理的方向。于是他们觉得Riptano这个公司的名字不太适合公司的定位，就把公司名字改成了DataStax。这个故事就是DataStax的由来。</p>\n</blockquote><p>自从2010年选中了Cassandra之后，DataStax就开始了全力以赴开发Cassandra的历程。在很长一段时间里，DataStax对Cassandra贡献的代码量，占据了整个代码提交量的85%以上。</p><p>可以说，正是因为DataStax的介入，才最终让Cassandra活了下来，并且在2011年成为了Apache基金会的顶级开源项目。DataStax推出的主打产品，是一个叫做DataStax Enterprise的东西。这是一个以Cassandra为核心，整合了诸多开源项目的产品。</p><p>DataStax Enterprise提供了两种模式，一种是卖软件和服务给企业，企业再装到自己的机器上去运行。另外一种是托管云服务“DataStax Managed Cloud”，这是一个运行在亚马逊云服务（AWS）上的云托管服务，用户无需购买和维护自己的机器。</p><p>从产品完整性和盈利模式来看，DataStax提供的是相对来说比较完整的一套产品体系。但是以Cassandra为核心的主要问题是，Cassandra的技术相对冷门，优点和缺点也都很明显，这导致的结果是：适用于Cassandra的应用也是有一定限制的。</p><p>DataStax的产品也因为选择了Cassandra作为核心，和其他公司的同类产品就有很明显的不一样。</p><p>具体来说，Cassandra是一个写入非常快、吞吐量很大、延时很低的系统；同时，这个系统的处理能力伴随容量的增长，也呈现出线性的增强。这些都是Cassandra的优势。尤其是做云端部署时，这个系统可以很灵活地根据工作负载来加减机器。</p><p>2012年，多伦多大学一篇论文比较研究了6个不同的NoSQL数据库的优劣，得出的结论是Cassandra是当之无愧的赢家。这篇论文被DataStax广泛引用，以此来证明这个系统比其他更为优质。</p><p>但是凡事都有两面性，Cassandra的缺点也很明显。首先是Cassandra有一个十分令人讨厌的问题：这个系统没办法保证一条记录行级别的一致性。</p><p>简单来说，如果A操作改变了行里面的一个列，B操作改变了同一行里面的另外一列，那么很有可能就得到了一条四不像的行。</p><p>这对应用程序来说是一件非常糟糕的事，虽然现实来说这种错误的概率不是特别高，但是只要不是0概率的话，很多应用程序都不可能使用这样的系统。</p><p>还有一个缺点是Cassandra普遍适用的场景非常有限，Cassandra虽然对于单行操作非常快，但是对于多行操作就会非常慢；而且不仅仅慢，很可能同时消耗的资源也会很高。</p><p>Cassandra对范围查询的能力比起HBase要差了很多。因此，通常来说Cassandra应用的场景适合只访问单行记录的，但是在单行记录的时候却不能保证行级别的一致性。这就是Cassandra适用场景的瓶颈所在。</p><p>不过，DataStax发展到了今天，它的主打产品DataStax Enterprise也是经过了多年的演进，并且在以Cassandra为核心的基础上，进行了全面的整合。</p><p>例如它通过对Spark和Solr的整合，提供了数据分析和搜索的功能。它还在自我完善中提供了对多种语言和开发平台的支持，比如说Java、Python、Ruby、 C++、Javascript等等。</p><p>此外，DataStax Enterprise还提供了给管理员用来做系统监控和操作的OpsCenter，以及给开发者提供的IDE环境 DataStax Studio。</p><p>从产品的完善程度来讲，DataStax Enterprise是非常完善的，它是一套整合了开源以及自主开发产品的系统，并提供了开发、运行、部署和监控几乎全方位的支持。这些都是这套系统的优势。</p><p>然而，DataStax的发展相对来说不温不火，在业界也只是名气平平。我想，它选择了Cassandra，既给了DataStax足够多的辨识度和区分度，也让DataStax的产品受到了各种限制。至于这样的选择到底是好是坏，对DataStax的发展是否有利，可能只有时间才能说清楚了。</p><p>不管怎么样，Cassandra仍然需要感谢DataStax的救命之恩和鼎力支持。可以说没有DataStax，就不会有今天的Cassandra。</p><p></p>","neighbors":{"left":{"article_title":"089 | Powerset：HBase的老东家","id":9329},"right":{"article_title":"091 | Databricks之Spark的数据金砖王国","id":10041}},"comments":[{"had_liked":false,"id":14896,"user_name":"阿卡斯","can_delete":false,"product_type":"c1","uid":1065382,"ip_address":"","ucode":"BA38FDC53CE1B0","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/a6/dcd67a78.jpg","comment_is_top":false,"comment_ctime":1530748842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14415650730","product_id":100001901,"comment_content":"那篇2012年论文链接能粘贴出来么？","like_count":3},{"had_liked":false,"id":13886,"user_name":"xiaoc10","can_delete":false,"product_type":"c1","uid":1018894,"ip_address":"","ucode":"63FA42C6193943","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/0e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1530059973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5825027269","product_id":100001901,"comment_content":"这些Casandra系统拥有的弊端，是否也适用于dynamo? amazon是怎么解决的呢","like_count":1},{"had_liked":false,"id":315205,"user_name":"滩涂曳尾","can_delete":false,"product_type":"c1","uid":1187478,"ip_address":"","ucode":"40F650F2A419D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/96/c735ad6b.jpg","comment_is_top":false,"comment_ctime":1633748951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633748951","product_id":100001901,"comment_content":"Amazon: Dynamo<br><br> --Avinash跳槽--&gt; <br><br>Facebook: 开启Cassandra，后抛弃之，选择HBase<br><br>--&gt;<br><br>DataStax:<br>1. 接手并持续贡献Cassandra，使之成为Apache顶级开源项目；<br>2. 以Cassandra为核心整合诸多开源项目的主打产品DataStax Enterprise","like_count":0},{"had_liked":false,"id":194424,"user_name":"丁乐洪","can_delete":false,"product_type":"c1","uid":1264392,"ip_address":"","ucode":"549CE57AB20B49","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg","comment_is_top":false,"comment_ctime":1585059285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585059285","product_id":100001901,"comment_content":"听故事，长见识","like_count":0},{"had_liked":false,"id":166652,"user_name":"小侠","can_delete":false,"product_type":"c1","uid":1045025,"ip_address":"","ucode":"A35A61061E41B2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/21/00600713.jpg","comment_is_top":false,"comment_ctime":1577533582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577533582","product_id":100001901,"comment_content":"无法保持一致性的问题现在还存在吗？","like_count":0},{"had_liked":false,"id":14323,"user_name":"燃","can_delete":false,"product_type":"c1","uid":1137201,"ip_address":"","ucode":"59B23E8439A4C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/31/14f00b1c.jpg","comment_is_top":false,"comment_ctime":1530287308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530287308","product_id":100001901,"comment_content":"datastax  enterprise要花钱买的吗？","like_count":0},{"had_liked":false,"id":14055,"user_name":"尹徐","can_delete":false,"product_type":"c1","uid":1013050,"ip_address":"","ucode":"CEA61F8E161673","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/3a/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1530154785,"is_pvip":false,"replies":[{"id":"6954","content":"MongoDB大法好","user_name":"作者回复","user_name_real":"飞总","uid":"1006100","ctime":1534218959,"ip_address":"","comment_id":14055,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1530154785","product_id":100001901,"comment_content":"飞总能不能介绍下Cassandra目前的发展，国内饿了么和360虽然也在用，更多的拥趸都迈向Mongo了，那么国外怎么样","like_count":0,"discussions":[{"author":{"id":1006100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5a/14/853d2c93.jpg","nickname":"飞总","note":"","ucode":"9819CECDD0E814","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419855,"discussion_content":"MongoDB大法好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534218959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083184,"avatar":"https://static001.geekbang.org/account/avatar/00/10/87/30/4626c8c0.jpg","nickname":"Fs","note":"","ucode":"0AD0EFB5544B9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":57053,"discussion_content":"mongodb和cassandra这种根本不能算是一类","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574562372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}