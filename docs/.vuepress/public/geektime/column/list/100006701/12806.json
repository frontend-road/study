{"id":12806,"title":"ç¬¬39è®² | è°ˆè°ˆå¸¸ç”¨çš„åˆ†å¸ƒå¼IDçš„è®¾è®¡æ–¹æ¡ˆï¼ŸSnowflakeæ˜¯å¦å—å†¬ä»¤æ—¶åˆ‡æ¢å½±å“ï¼Ÿ","content":"<p>ä¸“æ çš„ç»å¤§éƒ¨åˆ†ä¸»é¢˜éƒ½ä¾§é‡äºJavaè¯­è¨€å’Œè™šæ‹Ÿæœºï¼ŒåŸºæœ¬éƒ½æ˜¯å•æœºæ¨¡å¼ä¸‹çš„é—®é¢˜ï¼Œä»Šå¤©æˆ‘ä¼šè¡¥å……ä¸€ä¸ªåˆ†å¸ƒå¼ç›¸å…³çš„é—®é¢˜ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œåˆ†å¸ƒå¼å¹¶ä¸ç®—æ˜¯Javaé¢†åŸŸï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¤§ä¸»é¢˜ï¼Œä½†ç¡®å®ä¹Ÿä¼šåœ¨JavaæŠ€æœ¯å²—ä½é¢è¯•ä¸­è¢«æ¶‰åŠã€‚åœ¨å‡†å¤‡é¢è¯•æ—¶ï¼Œå¦‚æœæœ‰ä¸°å¯Œçš„åˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒå½“ç„¶å¥½ï¼›å¦‚æœæ²¡æœ‰ï¼Œä½ å¯ä»¥é€‰æ‹©å…¸å‹é—®é¢˜å’ŒåŸºç¡€æŠ€æœ¯è¿›è¡Œé€‚å½“å‡†å¤‡ã€‚å…³äºåˆ†å¸ƒå¼ï¼Œæˆ‘è‡ªèº«çš„å®æˆ˜ç»éªŒä¹Ÿéå¸¸æœ‰é™ï¼Œä¸“æ é‡Œå°±è°ˆè°ˆä»ç†è®ºå‡ºå‘çš„ä¸€äº›æ€è€ƒã€‚</p><p>ä»Šå¤©æˆ‘è¦é—®ä½ çš„é—®é¢˜æ˜¯ï¼Œ<span class=\"orange\">è°ˆè°ˆå¸¸ç”¨çš„åˆ†å¸ƒå¼IDçš„è®¾è®¡æ–¹æ¡ˆï¼ŸSnowflakeæ˜¯å¦å—å†¬ä»¤æ—¶åˆ‡æ¢å½±å“ï¼Ÿ</span></p><h2>å…¸å‹å›ç­”</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®é€šå¸¸çš„åˆ†å¸ƒå¼IDå®šä¹‰ï¼ŒåŸºæœ¬çš„è¦æ±‚åŒ…æ‹¬ï¼š</p><ul>\n<li>\n<p>å…¨å±€å”¯ä¸€ï¼ŒåŒºåˆ«äºå•ç‚¹ç³»ç»Ÿçš„å”¯ä¸€ï¼Œå…¨å±€æ˜¯è¦æ±‚åˆ†å¸ƒå¼ç³»ç»Ÿå†…å”¯ä¸€ã€‚</p>\n</li>\n<li>\n<p>æœ‰åºæ€§ï¼Œé€šå¸¸éƒ½éœ€è¦ä¿è¯ç”Ÿæˆçš„IDæ˜¯æœ‰åºé€’å¢çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨æ•°æ®åº“å­˜å‚¨ç­‰åœºæ™¯ä¸­ï¼Œæœ‰åºIDä¾¿äºç¡®å®šæ•°æ®ä½ç½®ï¼Œå¾€å¾€æ›´åŠ é«˜æ•ˆã€‚</p>\n</li>\n</ul><p>ç›®å‰ä¸šç•Œçš„æ–¹æ¡ˆå¾ˆå¤šï¼Œå…¸å‹æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p><ul>\n<li>\n<p>åŸºäºæ•°æ®åº“è‡ªå¢åºåˆ—çš„å®ç°ã€‚è¿™ç§æ–¹å¼ä¼˜ç¼ºç‚¹éƒ½éå¸¸æ˜æ˜¾ï¼Œå¥½å¤„æ˜¯ç®€å•æ˜“ç”¨ï¼Œä½†æ˜¯åœ¨æ‰©å±•æ€§å’Œå¯é æ€§ç­‰æ–¹é¢å­˜åœ¨å±€é™æ€§ã€‚</p>\n</li>\n<li>\n<p>åŸºäºTwitteræ—©æœŸå¼€æºçš„<a href=\"https://github.com/twitter/snowflake\">Snowflake</a>çš„å®ç°ï¼Œä»¥åŠç›¸å…³æ”¹åŠ¨æ–¹æ¡ˆã€‚è¿™æ˜¯ç›®å‰åº”ç”¨ç›¸å¯¹æ¯”è¾ƒå¹¿æ³›çš„ä¸€ç§æ–¹å¼ï¼Œå…¶ç»“æ„å®šä¹‰ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾ã€‚</p>\n</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/ff/ad/ffd41494a39ef737b3c1151929c3c4ad.png?wh=1010*270\" alt=\"\"></p><p>æ•´ä½“é•¿åº¦é€šå¸¸æ˜¯64 ï¼ˆ1 + 41 + 10+ 12 = 64ï¼‰ä½ï¼Œé€‚åˆä½¿ç”¨Javaè¯­è¨€ä¸­çš„longç±»å‹æ¥å­˜å‚¨ã€‚</p><!-- [[[read_end]]] --><p>å¤´éƒ¨æ˜¯1ä½çš„æ­£è´Ÿæ ‡è¯†ä½ã€‚</p><p>ç´§è·Ÿç€çš„é«˜ä½éƒ¨åˆ†åŒ…å«41ä½æ—¶é—´æˆ³ï¼Œé€šå¸¸ä½¿ç”¨System.currentTimeMillis()ã€‚</p><p>åé¢æ˜¯10ä½çš„WorkerIDï¼Œæ ‡å‡†å®šä¹‰æ˜¯5ä½æ•°æ®ä¸­å¿ƒ + 5ä½æœºå™¨IDï¼Œç»„æˆäº†æœºå™¨ç¼–å·ï¼Œä»¥åŒºåˆ†ä¸åŒçš„é›†ç¾¤èŠ‚ç‚¹ã€‚</p><p>æœ€åçš„12ä½å°±æ˜¯å•ä½æ¯«ç§’å†…å¯ç”Ÿæˆçš„åºåˆ—å·æ•°ç›®çš„ç†è®ºæé™ã€‚</p><p>Snowflakeçš„<a href=\"https://github.com/twitter/snowflake\">å®˜æ–¹ç‰ˆæœ¬</a>æ˜¯åŸºäºScalaè¯­è¨€ï¼ŒJavaç­‰å…¶ä»–è¯­è¨€çš„<a href=\"https://github.com/relops/snowflake\">å‚è€ƒå®ç°</a>æœ‰å¾ˆå¤šï¼Œæ˜¯ä¸€ç§éå¸¸ç®€å•å®ç”¨çš„æ–¹å¼ï¼Œå…·ä½“ä½æ•°çš„å®šä¹‰æ˜¯å¯ä»¥æ ¹æ®åˆ†å¸ƒå¼ç³»ç»Ÿçš„çœŸå®åœºæ™¯è¿›è¡Œä¿®æ”¹çš„ï¼Œå¹¶ä¸ä¸€å®šè¦ä¸¥æ ¼æŒ‰ç…§ç¤ºæ„å›¾ä¸­çš„è®¾è®¡ã€‚</p><ul>\n<li>\n<p>Redisã€ZooKeeperã€MongoDBç­‰ä¸­é—´ä»¶ï¼Œä¹Ÿéƒ½æœ‰å„ç§å”¯ä¸€IDè§£å†³æ–¹æ¡ˆã€‚å…¶ä¸­ä¸€äº›è®¾è®¡ä¹Ÿå¯ä»¥ç®—ä½œæ˜¯Snowflakeæ–¹æ¡ˆçš„å˜ç§ã€‚ä¾‹å¦‚ï¼ŒMongoDBçš„<a href=\"http://mongodb.github.io/node-mongodb-native/2.0/tutorials/objectid/\">ObjectId</a>æä¾›äº†ä¸€ä¸ª12 byteï¼ˆ96ä½ï¼‰çš„IDå®šä¹‰ï¼Œå…¶ä¸­32ä½ç”¨äºè®°å½•ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼Œæœºå™¨IDåˆ™ä¸º24ä½ï¼Œ16ä½ç”¨ä½œè¿›ç¨‹IDï¼Œ24ä½éšæœºèµ·å§‹çš„è®¡æ•°åºåˆ—ã€‚</p>\n</li>\n<li>\n<p>å›½å†…çš„ä¸€äº›å¤§å‚å¼€æºäº†å…¶è‡ªèº«çš„éƒ¨åˆ†åˆ†å¸ƒå¼IDå®ç°ï¼ŒInfoQå°±æ›¾ç»ä»‹ç»è¿‡å¾®ä¿¡çš„<a href=\"http://www.infoq.com/cn/articles/wechat-serial-number-generator-architecture\">seqsvr</a>ï¼Œå®ƒé‡‡å–äº†ç›¸å¯¹å¤æ‚çš„ä¸¤å±‚æ¶æ„ï¼Œå¹¶æ ¹æ®ç¤¾äº¤åº”ç”¨çš„æ•°æ®ç‰¹ç‚¹è¿›è¡Œäº†é’ˆå¯¹æ€§è®¾è®¡ï¼Œå…·ä½“è¯·å‚è€ƒç›¸å…³<a href=\"https://github.com/nebula-im/seqsvr\">ä»£ç å®ç°</a>ã€‚å¦å¤–ï¼Œ<a href=\"https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md\">ç™¾åº¦</a>ã€ç¾å›¢ç­‰ä¹Ÿéƒ½æœ‰å¼€æºæˆ–è€…åˆ†äº«äº†ä¸åŒçš„åˆ†å¸ƒå¼IDå®ç°ï¼Œéƒ½å¯ä»¥è¿›è¡Œå‚è€ƒã€‚</p>\n</li>\n</ul><p>å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œ<strong>Snowflakeæ˜¯å¦å—å†¬ä»¤æ—¶åˆ‡æ¢å½±å“ï¼Ÿ</strong></p><p>æˆ‘è®¤ä¸ºæ²¡æœ‰å½±å“ï¼Œä½ å¯ä»¥ä»Snowflakeçš„å…·ä½“ç®—æ³•å®ç°å¯»æ‰¾ç­”æ¡ˆã€‚æˆ‘ä»¬çŸ¥é“Snowflakeç®—æ³•çš„Javaå®ç°ï¼Œå¤§éƒ½æ˜¯ä¾èµ–äºSystem.currentTimeMillis()ï¼Œè¿™ä¸ªæ•°å€¼ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿä»Javadocå¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯è¿”å›å½“å‰æ—¶é—´å’Œ1970å¹´1æœˆ1å·UTCæ—¶é—´ç›¸å·®çš„æ¯«ç§’æ•°ï¼Œè¿™ä¸ªæ•°å€¼ä¸å¤/å†¬ä»¤æ—¶å¹¶æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥å¹¶ä¸å—å…¶å½±å“ã€‚</p><h2>è€ƒç‚¹åˆ†æ</h2><p>ä»Šå¤©çš„é—®é¢˜ä¸ä»…æºè‡ªé¢è¯•çš„çƒ­é—¨è€ƒç‚¹ï¼Œå¹¶ä¸”ä¹Ÿå­˜åœ¨ç€å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘å‰é¢ç»™å‡ºçš„å›ç­”åªæ˜¯ä¸€ä¸ªæ¯”è¾ƒç²¾ç®€çš„å…¸å‹æ–¹æ¡ˆä»‹ç»ã€‚æˆ‘å»ºè®®ä½ é’ˆå¯¹ç‰¹å®šçš„æ–¹æ¡ˆè¿›è¡Œæ·±å…¥åˆ†æï¼Œä»¥ä¿è¯åœ¨é¢è¯•å®˜å¯èƒ½ä¼šæ·±å…¥è¿½é—®æ—¶èƒ½æœ‰å……åˆ†å‡†å¤‡ï¼›å¦‚æœæ°å¥½åœ¨ç°æœ‰ç³»ç»Ÿä½¿ç”¨åˆ†å¸ƒå¼IDï¼Œç†è§£å…¶è®¾è®¡ç»†èŠ‚æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p>æ¶‰åŠåˆ†å¸ƒå¼ï¼Œå¾ˆå¤šå•æœºæ¨¡å¼ä¸‹çš„ç®€å•é—®é¢˜çªç„¶å°±å˜å¾—å¤æ‚äº†ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼å¤©ç„¶çš„å¤æ‚æ€§ï¼Œéœ€è¦ä»ä¸åŒè§’åº¦å»ç†è§£é€‚ç”¨åœºæ™¯ã€æ¶æ„å’Œç»†èŠ‚ç®—æ³•ï¼Œæˆ‘ä¼šä»ä¸‹é¢çš„è§’åº¦è¿›è¡Œé€‚å½“è§£è¯»ï¼š</p><ul>\n<li>\n<p>æˆ‘ä»¬çš„ä¸šåŠ¡åˆ°åº•éœ€è¦ä»€ä¹ˆæ ·çš„åˆ†å¸ƒå¼IDï¼Œé™¤äº†å”¯ä¸€å’Œæœ‰åºï¼Œè¿˜æœ‰å“ªäº›å¿…é¡»è¦è€ƒè™‘çš„è¦ç´ ï¼Ÿ</p>\n</li>\n<li>\n<p>åœ¨å®é™…åœºæ™¯ä¸­ï¼Œé’ˆå¯¹å…¸å‹çš„æ–¹æ¡ˆï¼Œæœ‰å“ªäº›å¯èƒ½çš„å±€é™æ€§æˆ–è€…é—®é¢˜ï¼Œå¯ä»¥é‡‡å–ä»€ä¹ˆåŠæ³•è§£å†³å‘¢ï¼Ÿ</p>\n</li>\n</ul><h2>çŸ¥è¯†æ‰©å±•</h2><p>å¦‚æœè¯•å›¾æ·±å…¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®ä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚è¦ç‚¹ï¼Œæˆ‘ä»¬åˆ°åº•éœ€è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„åˆ†å¸ƒå¼IDï¼Ÿ</p><p>é™¤äº†å”¯ä¸€å’Œæœ‰åºï¼Œè€ƒè™‘åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŠŸèƒ½éœ€è¦ï¼Œé€šå¸¸è¿˜ä¼šé¢å¤–å¸Œæœ›åˆ†å¸ƒå¼IDä¿è¯ï¼š</p><ul>\n<li>\n<p>æœ‰æ„ä¹‰ï¼Œæˆ–è€…è¯´åŒ…å«æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚æ—¶é—´ã€ä¸šåŠ¡ç­‰ä¿¡æ¯ã€‚è¿™ä¸€ç‚¹å’Œæœ‰åºæ€§è¦æ±‚å­˜åœ¨ä¸€å®šå…³è”ï¼Œå¦‚æœIDä¸­åŒ…å«æ—¶é—´ï¼Œæœ¬èº«å°±èƒ½ä¿è¯ä¸€å®šç¨‹åº¦çš„æœ‰åºï¼Œè™½ç„¶å¹¶ä¸èƒ½ç»å¯¹ä¿è¯ã€‚IDä¸­åŒ…å«é¢å¤–ä¿¡æ¯ï¼Œåœ¨åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ç­‰åœºåˆä¸­ï¼Œæœ‰åŠ©äºè¿›ä¸€æ­¥ä¼˜åŒ–æ•°æ®è®¿é—®çš„æ•ˆç‡ã€‚</p>\n</li>\n<li>\n<p>é«˜å¯ç”¨æ€§ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¿…ç„¶è¦æ±‚ã€‚å‰é¢è°ˆåˆ°çš„æ–¹æ¡ˆä¸­ï¼Œæœ‰çš„æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„åˆ†å¸ƒå¼ï¼Œæœ‰å¾—è¿˜æ˜¯ä¼ ç»Ÿä¸»ä»çš„æ€è·¯ï¼Œè¿™ä¸€ç‚¹æ²¡æœ‰ç»å¯¹çš„å¯¹é”™ï¼Œå–å†³äºæˆ‘ä»¬ä¸šåŠ¡å¯¹æ‰©å±•æ€§ã€æ€§èƒ½ç­‰æ–¹é¢çš„è¦æ±‚ã€‚</p>\n</li>\n<li>\n<p>ç´§å‡‘æ€§ï¼ŒIDçš„å¤§å°å¯èƒ½å—åˆ°å®é™…åº”ç”¨çš„åˆ¶çº¦ï¼Œä¾‹å¦‚æ•°æ®åº“å­˜å‚¨å¾€å¾€å¯¹é•¿IDä¸å‹å¥½ï¼Œå¤ªé•¿çš„IDä¼šé™ä½MySQLç­‰æ•°æ®åº“ç´¢å¼•çš„æ€§èƒ½ï¼›ç¼–ç¨‹è¯­è¨€åœ¨å¤„ç†æ—¶ä¹Ÿå¯èƒ½å—æ•°æ®ç±»å‹é•¿åº¦é™åˆ¶ã€‚</p>\n</li>\n</ul><p>åœ¨å…·ä½“çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿˜æœ‰å¯èƒ½æå‡ºå¯¹QPSç­‰æ–¹é¢çš„å…·ä½“è¦æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨å›½å†…ä¸€çº¿äº’è”ç½‘å…¬å¸çš„ä¸šåŠ¡è§„æ¨¡ä¸‹ï¼Œæ›´æ˜¯éœ€è¦è€ƒè™‘å³°å€¼ä¸šåŠ¡åœºæ™¯çš„æ•°é‡çº§å±‚æ¬¡éœ€æ±‚ã€‚</p><p>ç¬¬äºŒï¼Œ<strong>ä¸»æµæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹åˆ†æ</strong>ã€‚</p><p>å¯¹äºæ•°æ®åº“è‡ªå¢æ–¹æ¡ˆï¼Œé™¤äº†å®ç°ç®€å•ï¼Œå®ƒç”Ÿæˆçš„IDè¿˜èƒ½å¤Ÿä¿è¯å›ºå®šæ­¥é•¿çš„é€’å¢ï¼Œä½¿ç”¨å¾ˆæ–¹ä¾¿ã€‚</p><p>ä½†æ˜¯ï¼Œå› ä¸ºæ¯è·å–ä¸€ä¸ªIDå°±ä¼šè§¦å‘æ•°æ®åº“çš„å†™è¯·æ±‚ï¼Œæ˜¯ä¸€ä¸ªä»£ä»·é«˜æ˜‚çš„æ“ä½œï¼Œæ„å»ºé«˜æ‰©å±•æ€§ã€é«˜æ€§èƒ½è§£å†³æ–¹æ¡ˆæ¯”è¾ƒå¤æ‚ï¼Œæ€§èƒ½ä¸Šé™æ˜æ˜¾ï¼Œæ›´ä¸è¦è°ˆæ‰©å®¹ç­‰åœºæ™¯çš„éš¾åº¦äº†ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¿è¯æ•°æ®åº“æ–¹æ¡ˆçš„é«˜å¯ç”¨æ€§ä¹Ÿå­˜åœ¨æŒ‘æˆ˜ï¼Œæ•°æ®åº“å¯èƒ½å‘ç”Ÿå®•æœºï¼Œå³ä½¿é‡‡å–ä¸»ä»çƒ­å¤‡ç­‰å„ç§æªæ–½ï¼Œä¹Ÿå¯èƒ½å‡ºç°IDé‡å¤ç­‰é—®é¢˜ã€‚</p><p>å®é™…å¤§å‚å•†å¾€å¾€æ˜¯æ„å»ºäº†å¤šå±‚çš„å¤åˆæ¶æ„ï¼Œä¾‹å¦‚ç¾å›¢å…¬å¼€çš„æ•°æ®åº“æ–¹æ¡ˆ<a href=\"https://tech.meituan.com/MT_Leaf.html\">Leaf-Segment</a>ï¼Œå¼•å…¥äº†èµ·åˆ°ç¼“å­˜ç­‰ä½œç”¨çš„Leafå±‚ï¼Œå¯¹æ•°æ®åº“æ“ä½œåˆ™æ˜¯é€šè¿‡æ•°æ®åº“ä¸­é—´ä»¶æä¾›çš„æ‰¹é‡æ“ä½œï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æ€§èƒ½ã€æ‰©å±•æ€§ï¼Œä¹Ÿèƒ½ä¿è¯é«˜å¯ç”¨ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆå¯¹åŸºç¡€æ¶æ„å±‚é¢çš„è¦æ±‚å¾ˆå¤šï¼Œæœªå¿…é€‚åˆæ™®é€šä¸šåŠ¡è§„æ¨¡çš„éœ€æ±‚ã€‚</p><p>ä¸å…¶ç›¸æ¯”ï¼ŒSnowflakeæ–¹æ¡ˆçš„å¥½å¤„æ˜¯ç®—æ³•ç®€å•ï¼Œä¾èµ–ä¹Ÿéå¸¸å°‘ï¼Œç”Ÿæˆçš„åºåˆ—å¯é¢„æµ‹ï¼Œæ€§èƒ½ä¹Ÿéå¸¸å¥½ï¼Œæ¯”å¦‚Twitterçš„å³°å€¼è¶…è¿‡10ä¸‡/sã€‚</p><p>ä½†æ˜¯ï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„ä¸è¶³ï¼Œä¾‹å¦‚ï¼š</p><ul>\n<li>æ—¶é’Ÿåæ–œé—®é¢˜ï¼ˆClock Skewï¼‰ã€‚æˆ‘ä»¬çŸ¥é“æ™®é€šçš„è®¡ç®—æœºç³»ç»Ÿæ—¶é’Ÿå¹¶ä¸èƒ½ä¿è¯é•¿ä¹…çš„ä¸€è‡´æ€§ï¼Œå¯èƒ½å‘ç”Ÿæ—¶é’Ÿå›æ‹¨ç­‰é—®é¢˜ï¼Œè¿™å°±ä¼šå¯¼è‡´æ—¶é—´æˆ³ä¸å‡†ç¡®ï¼Œè¿›è€Œäº§ç”Ÿé‡å¤IDã€‚</li>\n</ul><p>é’ˆå¯¹è¿™ä¸€ç‚¹ï¼ŒTwitteræ›¾ç»åœ¨æ–‡æ¡£ä¸­å»ºè®®å¼€å¯<a href=\"http://doc.ntp.org/4.1.0/ntpd.htm\">NTP</a>ï¼Œæ¯•ç«ŸSnowflakeå¯¹æ—¶é—´å­˜åœ¨ä¾èµ–ï¼Œä½†æ˜¯ä¹Ÿæœ‰äººæè®®å…³é—­NTPã€‚æˆ‘ä¸ªäººè®¤ä¸ºè¿˜æ˜¯åº”è¯¥å¼€å¯NTPï¼Œåªæ˜¯å¯ä»¥è€ƒè™‘å°†stepbackè®¾ç½®ä¸º0ï¼Œä»¥ç¦æ­¢å›è°ƒã€‚</p><p>ä»è®¾è®¡å’Œå…·ä½“ç¼–ç çš„è§’åº¦ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰æ•ˆçš„æªæ–½å°±æ˜¯ç¼“å­˜å†å²æ—¶é—´æˆ³ï¼Œç„¶ååœ¨åºåˆ—ç”Ÿæˆä¹‹å‰è¿›è¡Œæ£€éªŒï¼Œå¦‚æœå‡ºç°å½“å‰æ—¶é—´è½åäºå†å²æ—¶é—´çš„ä¸åˆç†æƒ…å†µï¼Œå¯ä»¥é‡‡å–ç›¸åº”çš„åŠ¨ä½œï¼Œè¦ä¹ˆé‡è¯•ã€ç­‰å¾…æ—¶é’Ÿé‡æ–°ä¸€è‡´ï¼Œæˆ–è€…å°±ç›´æ¥æç¤ºæœåŠ¡ä¸å¯ç”¨ã€‚</p><ul>\n<li>\n<p>å¦å¤–ï¼Œåºåˆ—å·çš„å¯é¢„æµ‹æ€§æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œè™½ç„¶ç®€åŒ–äº†ä¸€äº›å·¥ç¨‹é—®é¢˜ï¼Œä½†å¾ˆå¤šä¸šåŠ¡åœºæ™¯å¹¶ä¸é€‚åˆå¯é¢„æµ‹çš„IDã€‚å¦‚æœä½ ç”¨å®ƒä½œä¸ºå®‰å…¨ä»¤ç‰Œä¹‹ç±»ï¼Œåˆ™æ˜¯éå¸¸å±é™©çš„ï¼Œå¾ˆå®¹æ˜“è¢«é»‘å®¢çŒœæµ‹å¹¶åˆ©ç”¨ã€‚</p>\n</li>\n<li>\n<p>IDè®¾è®¡é˜¶æ®µéœ€è¦è°¨æ…è€ƒè™‘æš´éœ²å‡ºçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œ<a href=\"https://github.com/boundary/flake\">Erlangç‰ˆæœ¬</a>çš„flakeå®ç°åŸºäºMACåœ°å€è®¡ç®—WorkerIDï¼Œåœ¨å®‰å…¨æ•æ„Ÿçš„é¢†åŸŸå¾€å¾€æ˜¯ä¸å¯ä»¥è¿™æ ·ä½¿ç”¨çš„ã€‚</p>\n</li>\n<li>\n<p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œç±»ä¼¼Snowflakeçš„æ–¹æ¡ˆç”±äºæ—¶é—´æ•°æ®ä½æ•°çš„é™åˆ¶ï¼Œå­˜åœ¨ä¸<a href=\"https://en.wikipedia.org/wiki/Year_2038_problem\">2038å¹´é—®é¢˜</a>ç›¸ä¼¼çš„ç†è®ºæé™ã€‚è™½ç„¶ç›®å‰çš„ç³»ç»Ÿè®¾è®¡è€ƒè™‘æ•°åå¹´åçš„é—®é¢˜è¿˜å¤ªæ—©ï¼Œä½†æ˜¯ç†è§£è¿™äº›å¯èƒ½çš„æé™æ˜¯æœ‰å¿…è¦çš„ï¼Œä¹Ÿè®¸ä¼šæˆä¸ºé¢è¯•çš„è¿‡ç¨‹ä¸­çš„è€ƒå¯Ÿç‚¹ã€‚</p>\n</li>\n</ul><p>å¦‚æœæ›´åŠ æ·±å…¥åˆ°æ—¶é’Ÿå’Œåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶åºçš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸åˆ†å¸ƒå¼IDç›¸å…³ä½†åˆæœ‰æ‰€åŒºåˆ«çš„é—®é¢˜ï¼Œæ¯”å¦‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒæœºå™¨çš„æ—¶é—´å¾ˆå¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œå¦‚ä½•ä¿è¯äº‹ä»¶çš„æœ‰åºæ€§ï¼ŸLamportåœ¨1978å¹´çš„è®ºæ–‡ï¼ˆ<a href=\"https://amturing.acm.org/p558-lamport.pdf\">Time, Clocks, and the Ording of Events in a Distributed System</a>ï¼‰ä¸­å°±æœ‰å¾ˆæ·±å…¥çš„é˜è¿°ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»æŸ¥æ‰¾ç›¸åº”çš„ç¿»è¯‘å’Œè§£è¯»ã€‚</p><p>æœ€åï¼Œæˆ‘å†è¡¥å……ä¸€äº›å½“å‰åˆ†å¸ƒå¼é¢†åŸŸçš„é¢è¯•çƒ­ç‚¹ï¼Œä¾‹å¦‚ï¼š</p><ul>\n<li>\n<p>åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒåŒ…æ‹¬å…¶äº§ç”ŸåŸå› ã€ä¸šåŠ¡èƒŒæ™¯ã€ä¸»æµçš„è§£å†³æ–¹æ¡ˆç­‰ã€‚</p>\n</li>\n<li>\n<p>ç†è§£<a href=\"https://en.wikipedia.org/wiki/CAP_theorem\">CAP</a>ã€<a href=\"https://en.wikipedia.org/wiki/Eventual_consistency\">BASE</a>ç­‰ç†è®ºï¼Œæ‡‚å¾—ä»æœ€ç»ˆä¸€è‡´æ€§ç­‰è§’åº¦æ¥æ€è€ƒé—®é¢˜ï¼Œç†è§£<a href=\"https://en.wikipedia.org/wiki/Paxos_(computer_science)\">Paxos</a>ã€<a href=\"https://raft.github.io/\">Raft</a>ç­‰ä¸€è‡´æ€§ç®—æ³•ã€‚</p>\n</li>\n<li>\n<p>ç†è§£å…¸å‹çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œä¾‹å¦‚æœ€å¸¸è§çš„<a href=\"https://redis.io/topics/distlock\">Redisåˆ†å¸ƒå¼é”</a>ã€‚</p>\n</li>\n<li>\n<p>è´Ÿè½½å‡è¡¡ç­‰åˆ†å¸ƒå¼é¢†åŸŸçš„å…¸å‹ç®—æ³•ï¼Œè‡³å°‘è¦äº†è§£ä¸»è¦æ–¹æ¡ˆçš„åŸç†ã€‚</p>\n</li>\n</ul><p>è¿™äº›æ–¹é¢ç›®å‰éƒ½å·²ç»æœ‰ç›¸å¯¹æ¯”è¾ƒæ·±å…¥çš„åˆ†æï¼Œå°¤å…¶æ˜¯æ¥è‡ªäºä¸€çº¿å¤§å‚çš„å®è·µç»éªŒã€‚å¦å¤–ï¼Œåœ¨<a href=\"http://time.geekbang.org/column/48\">å·¦è€³å¬é£ä¸“æ çš„â€œç¨‹åºå‘˜ç»ƒçº§æ”»ç•¥â€</a>é‡Œï¼Œæä¾›äº†éå¸¸å…¨é¢çš„åˆ†å¸ƒå¼å­¦ä¹ èµ„æ–™ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒã€‚</p><p>ä»Šå¤©æˆ‘ç®€è¦æ¢³ç†äº†å½“å‰å…¸å‹çš„åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼Œå¹¶æ¢è®¨äº†IDè®¾è®¡çš„ä¸€äº›è€ƒé‡ï¼Œå°¤å…¶æ˜¯åº”ç”¨ç›¸å¯¹å¹¿æ³›çš„Snowflakeçš„ä¸è¶³ä¹‹å¤„ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><h2>ä¸€è¯¾ä¸€ç»ƒ</h2><p>å…³äºä»Šå¤©æˆ‘ä»¬è®¨è®ºçš„é¢˜ç›®ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°äº†å—ï¼Ÿä»Šå¤©çš„æ€è€ƒé¢˜æ˜¯ï¼Œä»ç†è®ºä¸Šæ¥çœ‹ï¼ŒSnowflakeè¿™ç§åŸºäºæ—¶é—´çš„ç®—æ³•ï¼Œä»å½¢å¼ä¸Šå¤©ç„¶åœ°é™åˆ¶äº†IDçš„å¹¶å‘ç”Ÿæˆæ•°é‡ï¼Œå¦‚æœåœ¨æç«¯æƒ…å†µä¸‹ï¼ŒçŸ­æ—¶é—´éœ€è¦æ›´å¤šIDï¼Œæœ‰ä»€ä¹ˆåŠæ³•è§£å†³å‘¢ï¼Ÿ</p><p>è¯·ä½ åœ¨ç•™è¨€åŒºå†™å†™ä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘ä¼šé€‰å‡ºç»è¿‡è®¤çœŸæ€è€ƒçš„ç•™è¨€ï¼Œé€ç»™ä½ ä¸€ä»½å­¦ä¹ å¥–åŠ±ç¤¼åˆ¸ï¼Œæ¬¢è¿ä½ ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p><p>ä½ çš„æœ‹å‹æ˜¯ä¸æ˜¯ä¹Ÿåœ¨å‡†å¤‡é¢è¯•å‘¢ï¼Ÿä½ å¯ä»¥â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„é¢˜ç›®åˆ†äº«ç»™å¥½å‹ï¼Œæˆ–è®¸ä½ èƒ½å¸®åˆ°ä»–ã€‚</p><p></p>","comments":[{"had_liked":false,"id":19454,"user_name":"è‘£æœ±æ˜","can_delete":false,"product_type":"c1","uid":1123130,"ip_address":"","ucode":"A393DD33DC8156","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/3a/5df9735f.jpg","comment_is_top":false,"comment_ctime":1533838419,"is_pvip":false,"replies":[{"id":"6859","content":"é«˜æ‰‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1533995691,"ip_address":"","comment_id":19454,"utype":1}],"discussion_count":3,"race_medal":0,"score":"246346974291","product_id":100006701,"comment_content":"69å¹´çš„æé™é—®é¢˜ä¸éš¾è§£å†³ï¼Œtimestampå‡ä¸ªå¸¸é‡å°±å¯ä»¥äº†ï¼Œå¯¹äºå·²ç”Ÿæˆçš„å†å²idï¼Œå¯ä»¥å¯¼è¡¨åˆ·idï¼Œå½“ç„¶ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸ªæ•°æ®åº“è®¾è®¡åŸåˆ™ï¼Œç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®ä¸åº”ä½¿ç”¨ç‰©ç†ä¸»é”®ï¼Œè¿™æ ·åˆ·id å°±å®¹æ˜“äº†","like_count":58,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421849,"discussion_content":"é«˜æ‰‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533995691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030842,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ba/ba/83de3488.jpg","nickname":"Carter","note":"","ucode":"1FD476D8F2BE27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382299,"discussion_content":"è¯·é—®â€œç³»ç»Ÿä¹‹é—´ä¼ é€’æ•°æ®ä¸åº”ä½¿ç”¨ç‰©ç†ä¸»é”®â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625503998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":190487,"discussion_content":"ä¿®æ”¹WorkerIDä¼šä¸ä¼šæ›´å®¹æ˜“ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582949241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23925,"user_name":"å¡ç‰¹","can_delete":false,"product_type":"c1","uid":1060491,"ip_address":"","ucode":"FF63677089E701","user_header":"https://static001.geekbang.org/account/avatar/00/10/2e/8b/32a8c5a0.jpg","comment_is_top":false,"comment_ctime":1536720686,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"108910903086","product_id":100006701,"comment_content":"å› ä¸ºsnowflakeçš„å¯é¢„æµ‹æ€§ï¼Œå¯ä»¥æå‰ç”Ÿæˆå¥½æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œè·å–çš„æ—¶å€™ç›´æ¥è·å–ã€‚ç›¸å½“äºåšäº†ä¸€å±‚ç¼“å­˜ï¼›<br>ç†è®ºä¸Šå¯ä»¥è§£å†³çŸ­æ—¶é—´å¤§é‡è·å–idçš„éœ€æ±‚ï¼›","like_count":26,"discussions":[{"author":{"id":1199091,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4b/f3/8b9df836.jpg","nickname":"jimmy","note":"","ucode":"9B93DCAB317572","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261699,"discussion_content":"ringbuffer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588994021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19082,"user_name":"è¢ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1000862,"ip_address":"","ucode":"30BCA7B2705247","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/9e/57e18908.jpg","comment_is_top":false,"comment_ctime":1533660707,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"44483333667","product_id":100006701,"comment_content":"ä¸€ç›´æœ‰ä¸ªç–‘é—®å°±æ˜¯Snowflake æ–‡ä¸­è¯´çš„æé™é—®é¢˜ï¼Œç›®å‰ç¡®å®šå®ƒåªèƒ½ç”¨69å¹´ï¼Œå¤§å®¶éƒ½ç”¨æ•°æ®åº“çš„æ•°å­—ç±»å‹æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆåˆ°äº†69å¹´ä¹‹åï¼Œåæ¥äººæ€ä¹ˆå¤„ç†ï¼Œä¹Ÿè®¸é‚£ä¸ªæ—¶å€™æœ‰æ›´å¤§æ•°å­—æ¥è¡¨ç¤ºã€‚ä½†æˆ‘è¿˜æ˜¯æƒ³ä¸å‡ºæ›´åˆç†çš„æ–¹å¼ï¼Œä¹Ÿè®¸æˆ‘æƒ³å¤šäº†ï¼Œè¿™ä¸ªé—®é¢˜äº¤ç»™69å¹´åçš„äººæ¥è€ƒè™‘ï¼Œä½†æˆ‘ä¹Ÿæƒ³çŸ¥é“è€å¸ˆæ‚¨æ˜¯å¦‚ä½•æ€è€ƒè¿™ä¸ªé—®é¢˜çš„","like_count":11,"discussions":[{"author":{"id":1432682,"avatar":"https://static001.geekbang.org/account/avatar/00/15/dc/6a/4a291730.jpg","nickname":"è«è¨€18595814913","note":"","ucode":"CD7EB58A30DF43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374,"discussion_content":"éœ€è¦69å¹´ï¼Ÿ10å¹´ç³»ç»Ÿå°±é‡åšäº†Näº†","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1561513482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1961940,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/ef/d4/6c212b5f.jpg","nickname":"Eason","note":"","ucode":"1A822C577675FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290510,"discussion_content":"ä¸€å¼€å§‹å°±è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œç”¨å­—ç¬¦ä¸²å­˜å‚¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594518838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18916,"user_name":"å¤§è¥¿ç“œ","can_delete":false,"product_type":"c1","uid":1190794,"ip_address":"","ucode":"7425805CF610A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/2b/8a/b99b5a2d.jpg","comment_is_top":false,"comment_ctime":1533606476,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"31598377548","product_id":100006701,"comment_content":"ç¼©å‡workIDé•¿åº¦ï¼Œå¢åŠ åºåˆ—å·é•¿åº¦","like_count":8},{"had_liked":false,"id":164541,"user_name":"å¤§ç»§","can_delete":false,"product_type":"c1","uid":1274500,"ip_address":"","ucode":"9A27E97F134C73","user_header":"https://static001.geekbang.org/account/avatar/00/13/72/84/3f116ac8.jpg","comment_is_top":false,"comment_ctime":1577024324,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27346828100","product_id":100006701,"comment_content":"éå¸¸æ„Ÿè°¢å¤§ä½¬çš„æ•™ç¨‹ï¼Œé¢è¯•æ˜¯æˆ‘è¿›æ­¥æœ€å¿«çš„çŠ¶æ€ï¼Œ è¿™ç§çŠ¶æ€ç»´æŒä¸€å¹´ï¼Œä¼°è®¡æˆ‘å¯ä»¥ä¸Šå¤©ï¼Œç»ˆäºçœ‹å®Œäº†ã€‚ ã€‚ æ€»ç»“ï¼Œå¤§ä½¬ç»™å‡ºçš„æ•™ç¨‹éå¸¸æœ‰è¥å…»ï¼Œä¹Ÿçœ‹åˆ°å¤§å®¶éƒ½è¦çœ‹å‡ éï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹çœ‹ä¸€è¾¹ç™¾åº¦ã€‚ å—ç›ŠåŒªæµ…ã€‚","like_count":7},{"had_liked":false,"id":235088,"user_name":"ä¸šä½™è‰","can_delete":false,"product_type":"c1","uid":1126538,"ip_address":"","ucode":"99BDC1E629049D","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg","comment_is_top":false,"comment_ctime":1594888848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18774758032","product_id":100006701,"comment_content":"19 å¹´å†™çš„ã€Š5 å¤§åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨ä¼˜ç¼ºç‚¹ç®€å•å¯¹æ¯”ã€‹å€¼å¾—ä¸€çœ‹ï¼Œhttps:&#47;&#47;mp.weixin.qq.com&#47;s&#47;OnH7Xrow5-TlkAh5gxz_XQ","like_count":5},{"had_liked":false,"id":24412,"user_name":"RoverYe","can_delete":false,"product_type":"c1","uid":1113144,"ip_address":"","ucode":"ACA5AD466C2536","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/38/59dda970.jpg","comment_is_top":false,"comment_ctime":1536987463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18716856647","product_id":100006701,"comment_content":"æˆ‘ä»¬è¿™è¾¹åˆ©ç”¨zkçš„å”¯ä¸€idç‰¹æ€§","like_count":5},{"had_liked":false,"id":63410,"user_name":"å½±å­","can_delete":false,"product_type":"c1","uid":1094682,"ip_address":"","ucode":"84B4EC343C728D","user_header":"https://static001.geekbang.org/account/avatar/00/10/b4/1a/baf765a4.jpg","comment_is_top":false,"comment_ctime":1548344439,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10138279031","product_id":100006701,"comment_content":"ç”Ÿæˆ32ä½çš„è‡ªå¢é•¿Id(int)è€å¸ˆæœ‰ä»€ä¹ˆæ€è·¯å˜›","like_count":3},{"had_liked":false,"id":45249,"user_name":"XiaoYeGe","can_delete":false,"product_type":"c1","uid":1122953,"ip_address":"","ucode":"F07027153B6971","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/89/5757eb43.jpg","comment_is_top":false,"comment_ctime":1543567820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133502412","product_id":100006701,"comment_content":"å‰åå†æ—¶åŠå¹´å¤š ç»ˆäºçœ‹å®Œäº†, ä¸‹é¢å°±æ˜¯å†å›å¤´å·©å›ºä¸€é!","like_count":3},{"had_liked":false,"id":23215,"user_name":"Yang.ğŸ­","can_delete":false,"product_type":"c1","uid":1180028,"ip_address":"","ucode":"3A09F586CBC571","user_header":"https://static001.geekbang.org/account/avatar/00/12/01/7c/836cf29e.jpg","comment_is_top":false,"comment_ctime":1536216876,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10126151468","product_id":100006701,"comment_content":"ä½¿ç”¨System.currentTimeMillisçš„è¯ä¸æ˜¯å­˜åœ¨æ—¶é’Ÿå›æ‹¨é—®é¢˜ä¹ˆï¼Œèƒ½ä¸èƒ½ä»ç½‘ç»œè·å–æ—¶é—´ï¼Œå»ç”Ÿæˆè¿™ä¸ªğŸ˜‚ğŸ˜‚","like_count":2,"discussions":[{"author":{"id":1257046,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2e/56/aa3690ef.jpg","nickname":"äº‘äº‘","note":"","ucode":"1A08803F6EBD33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":113721,"discussion_content":"ç½‘ç»œèµ°IOå¥½æ…¢çš„ï¼Œä¸åˆ’ç®—ï¼Œè€Œä¸” System.currentTimeMillis äººå®¶éƒ½å«Œå¤ªæ…¢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577929335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1180028,"avatar":"https://static001.geekbang.org/account/avatar/00/12/01/7c/836cf29e.jpg","nickname":"Yang.ğŸ­","note":"","ucode":"3A09F586CBC571","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1257046,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2e/56/aa3690ef.jpg","nickname":"äº‘äº‘","note":"","ucode":"1A08803F6EBD33","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350325,"discussion_content":"ä¹Ÿæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613811745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":113721,"ip_address":""},"score":350325,"extra":""}]},{"author":{"id":3009425,"avatar":"","nickname":"Geek_25fc4c","note":"","ucode":"33C53D0864F3BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576809,"discussion_content":"ä½ ç”¨ç½‘ç»œIOå°±æ›´..ä¸‡ä¸€é‚£å¤©ç½‘ç»œä¸å¥½å»¶è¿Ÿäº†å‡ æ¯«ç§’ï¼Œç„¶åå‡ºç°é‡å¤çš„å¯èƒ½æ€§åè€Œå¤§å¤šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655793780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19088,"user_name":"å®‰å°ä¾","can_delete":false,"product_type":"c1","uid":1101660,"ip_address":"","ucode":"A5C414C7B994FF","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/5c/d4e19eb6.jpg","comment_is_top":false,"comment_ctime":1533663529,"is_pvip":false,"replies":[{"id":"7664","content":"æœ¯ä¸šæœ‰ä¸“æ”»ï¼Œæœ‰ç‰¹å®šä¸“å®¶å‡ºä¸“æ ","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1535216161,"ip_address":"","comment_id":19088,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10123598121","product_id":100006701,"comment_content":"è€å¸ˆè‡ªå·±æœ‰æ²¡æœ‰è®¡åˆ’ï¼Œé’ˆå¯¹åˆ†å¸ƒå¼å•ç‹¬å‡ºä¸€ä¸ªä¸“æ ï¼Œä¸€ç›´ä»¥æ¥è‡ªå·±éƒ½æƒ³ç ”ç©¶åˆ†å¸ƒå¼ï¼Œä½†æ˜¯å¾ˆå¤šé—®é¢˜ä¾æ—§æä¸æ‡‚: zookeeper é€‰ä¸¾è¿‡ç¨‹ã€hdfs å­˜å‚¨å‡ºç°æ•…éšœnamenodeæ˜¯æ€ä¹ˆå¤„ç†ã€MapReduce ä½œä¸šè°ƒåº¦é—®é¢˜éœ€è¦åšå“ªäº›æƒè¡¡ï¼Œä¸åŒå¼‚å¸¸ä¸‹åº”è¯¥æ€ä¹ˆè§£å†³ï¼Œæ˜¯å¿½ç•¥é”™è¯¯ï¼Œè¿˜æ˜¯ç›´æ¥é€€å‡ºâ€¦å„ä¸ªæ–¹æ¡ˆèƒŒåæ˜¯ä»€ä¹ˆæ ·çš„åˆ©å¼Šåœ¨åè°ƒç€è¿™äº›â€¦","like_count":2,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421709,"discussion_content":"æœ¯ä¸šæœ‰ä¸“æ”»ï¼Œæœ‰ç‰¹å®šä¸“å®¶å‡ºä¸“æ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535216161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18965,"user_name":"æœ‰é“­","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1533622134,"is_pvip":false,"replies":[{"id":"6581","content":"æˆ‘æåˆ°äº†ï¼Œå„éƒ¨åˆ†ä¸æ˜¯å›ºå®šçš„ï¼Œçœ‹ä¸šåŠ¡éœ€æ±‚ï¼Œä¾‹å¦‚ï¼Œé›†ç¾¤å°ï¼Œä½æ•°å¯ä»¥è®¾è®¡çŸ­ç‚¹å„¿ï¼Œseqå°±å¯ä»¥æ›´å¤šä½ï¼Œæ—¶é—´ä¹Ÿæœªå¿…éè¦41ä½","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1533628286,"ip_address":"","comment_id":18965,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10123556726","product_id":100006701,"comment_content":"ä¸ºå•¥æœ€åä¸€æ®µæ˜¯12çš„é•¿åº¦è€Œä¸æ˜¯åˆ«çš„æ•°","like_count":3,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421685,"discussion_content":"æˆ‘æåˆ°äº†ï¼Œå„éƒ¨åˆ†ä¸æ˜¯å›ºå®šçš„ï¼Œçœ‹ä¸šåŠ¡éœ€æ±‚ï¼Œä¾‹å¦‚ï¼Œé›†ç¾¤å°ï¼Œä½æ•°å¯ä»¥è®¾è®¡çŸ­ç‚¹å„¿ï¼Œseqå°±å¯ä»¥æ›´å¤šä½ï¼Œæ—¶é—´ä¹Ÿæœªå¿…éè¦41ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533628286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109543,"user_name":"ä¸‰ç¢—çŒªè„š","can_delete":false,"product_type":"c1","uid":1371918,"ip_address":"","ucode":"33E7151FCAA8D0","user_header":"https://static001.geekbang.org/account/avatar/00/14/ef/0e/7abc67bf.jpg","comment_is_top":false,"comment_ctime":1562054246,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5857021542","product_id":100006701,"comment_content":"å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼ŒSnowflake æ˜¯å¦å—å†¬ä»¤æ—¶åˆ‡æ¢å½±å“ï¼Ÿ<br>å†¬ä»¤æ—¶ä¸æ˜¯å›æ‹¨ä¸€ä¸ªå°æ—¶å—ï¼Ÿé‚£ä¾‹å¦‚æˆ‘10æœˆ3å·3æ—¶è¢«å›æ‹¨10æœˆ3å·2æ—¶ï¼Œä¸­é—´æ˜¯èµ°äº†ä¸¤æ¬¡çš„ï¼Œåˆ°å½“å‰æ—¶é—´ä¹Ÿä¼šé‡å¤ï¼Œä¸æ˜¯å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1197455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/45/8f/a56b2214.jpg","nickname":"innocent","note":"","ucode":"368659A0DDE7E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335511,"discussion_content":"æ–‡ç« ä¸­éƒ½è¯´äº†ç”¨çš„ä¸€èˆ¬æ˜¯æ—¶é—´æˆ³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608211686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299115,"user_name":"_å…³æ—­_","can_delete":false,"product_type":"c1","uid":1009052,"ip_address":"","ucode":"ADEB7BBC54035B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/9c/5c94692c.jpg","comment_is_top":false,"comment_ctime":1624462794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624462794","product_id":100006701,"comment_content":"ä¸€æ¬èµ„æºæ± é‡Œé¢éƒ½æœ‰æ—¶é’Ÿæœºå™¨çš„ï¼Œæ‰€æœ‰èµ„æºå‡å‘å…¶åŒæ­¥å³å¯ï¼Œé™¤éæ—¶é’Ÿæœºå™¨å‘ç”Ÿæ—¶é’Ÿå›æ‹¨ï¼ŒçŸ­æ—¶é—´å†…åº”è¯¥æ²¡äº‹çš„ï¼Œæ¯•ç«Ÿå…¶ä»–çš„å°±æ˜¯è¿è¡Œä¸€æ®µæ—¶é—´åæ‰ä¼šå‘ç”Ÿæ—¶é’Ÿä¸å¯¹ã€‚","like_count":0},{"had_liked":false,"id":170323,"user_name":"é©¬å¿—è¿œ","can_delete":false,"product_type":"c1","uid":1480892,"ip_address":"","ucode":"AAD8875343E5FC","user_header":"https://static001.geekbang.org/account/avatar/00/16/98/bc/6d5affd3.jpg","comment_is_top":false,"comment_ctime":1578568752,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578568752","product_id":100006701,"comment_content":"ç¬¬ä¸€éç»“æŸ","like_count":0,"discussions":[{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336643,"discussion_content":"ç•™å°ï¼Œcount=2","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608642858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55234,"user_name":"å´ç§‘ğŸ€","can_delete":false,"product_type":"c1","uid":1112547,"ip_address":"","ucode":"8F2C317887A323","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/e3/2529c7dd.jpg","comment_is_top":false,"comment_ctime":1546071403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546071403","product_id":100006701,"comment_content":"æˆ‘ä»¬é€šå¸¸ç”¨UUIDæˆ–è€…æ•°æ®è‡ªå¢ä¸»é”®ï¼Œè¿™æ ·çš„æ–¹å¼æ•ˆç‡éƒ½ä¸é«˜ã€‚snowflakeåˆ†å¸ƒå¼å…¨å±€ç”Ÿæˆçš„IDï¼Œæ•ˆç‡é«˜ï¼Œè®¾è®¡ä¼˜é›…ã€‚","like_count":0},{"had_liked":false,"id":55017,"user_name":"airong","can_delete":false,"product_type":"c1","uid":1317199,"ip_address":"","ucode":"0082FFF6C679A7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/6KJcYf8PnO0knxk6EDCETYQHc19KMiaBW2U6EVdPKYNOjObiaibm46KjbJtL5WS5cg7HVY7nEIqiakCgWEg137Okbw/132","comment_is_top":false,"comment_ctime":1546000864,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1546000864","product_id":100006701,"comment_content":"è¯·é—®å¤§ç‰›10é›†ç¾¤ç¼–å·æ€ä¹ˆè·å–çš„å•Š","like_count":1,"discussions":[{"author":{"id":1124461,"avatar":"https://static001.geekbang.org/account/avatar/00/11/28/6d/d776d35a.jpg","nickname":"å¤§æ¼ ","note":"","ucode":"B7973B9FD7CB61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374258,"discussion_content":"å¯åŠ¨çš„æ—¶å€™æŒ‡å®šçš„ï¼Œå¯ä»¥å†™åˆ°é…ç½®æ–‡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621084486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18977,"user_name":"Aaron_æ¶›","can_delete":false,"product_type":"c1","uid":1180617,"ip_address":"","ucode":"067F3CBB1F036C","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/c9/9a9d82ab.jpg","comment_is_top":false,"comment_ctime":1533628927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533628927","product_id":100006701,"comment_content":"èƒ½è®²ä¸‹ä¸‹æ—¶é’Ÿåæ–œå’Œæ—¶é’Ÿå›æ‹¨å—ï¼Œä¸æ˜¯ç†è§£","like_count":0}]}