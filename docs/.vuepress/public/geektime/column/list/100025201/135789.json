{"id":135789,"title":"41 | å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šâ€œç”»å›¾â€ç¨‹åºåç«¯å®æˆ˜","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸ƒç‰›äº‘è®¸å¼ä¼Ÿã€‚</p><p>åˆ°ä»Šå¤©ä¸ºæ­¢ï¼ŒæœåŠ¡ç«¯å¼€å‘çš„åŸºæœ¬å†…å®¹å·²ç»è®²å®Œäº†ã€‚æˆ‘ä»¬èŠ±äº†æ¯”è¾ƒé•¿çš„ç¯‡å¹…æ¥ä»‹ç»æœåŠ¡ç«¯çš„åŸºç¡€è½¯ä»¶ï¼ŒåŒ…æ‹¬è´Ÿè½½å‡è¡¡å’Œå„ç±»å­˜å‚¨ä¸­é—´ä»¶ã€‚ç„¶åæˆ‘ä»¬ä¸Šä¸€è®²ä»‹ç»äº†æœåŠ¡ç«¯åœ¨ä¸šåŠ¡æ¶æ„ä¸Šçš„ä¸€äº›é€šç”¨é—®é¢˜ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å¼€å§‹è¿›å…¥å®æˆ˜ã€‚</p><p>å¯¹æ¯”æœåŠ¡ç«¯å’Œæ¡Œé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯å¼€å‘å’Œæ¡Œé¢ç«¯å¼€å‘å„è‡ªæœ‰å„è‡ªçš„å¤æ‚æ€§ã€‚æœåŠ¡ç«¯å¼€å‘ï¼Œéš¾åœ¨åŸºç¡€è½¯ä»¶å¾ˆå¤šï¼Œå¯¹ç¨‹åºå‘˜å’Œæ¶æ„å¸ˆçš„çŸ¥è¯†é¢å’Œç†è§£æ·±åº¦éƒ½æœ‰è¾ƒé«˜çš„è¦æ±‚ã€‚ä½†ä»ä¸šåŠ¡å¤æ‚æ€§æ¥è¯´ï¼ŒæœåŠ¡ç«¯çš„ä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•ã€‚è€Œæ¡Œé¢ç«¯å¼€å‘åˆ™ç›¸åï¼Œå®ƒçš„éš¾ç‚¹åœ¨äºç”¨æˆ·äº¤äº’é€»è¾‘å¤æ‚ï¼Œä»£ç é‡å¤§ï¼Œä¸šåŠ¡æ¶æ„çš„å¤æ‚æ€§é«˜ã€‚</p><p>ä¸Šä¸€ç« çš„å®æˆ˜ç¯‡ï¼Œè›®å¤šäººåé¦ˆæœ‰ç‚¹éš¾ï¼Œè¿™æŸç§ç¨‹åº¦æ¥è¯´å’Œæˆ‘ä»¬è¯¾ç¨‹å†…å®¹è®¾è®¡çš„è§„åˆ’æœ‰å…³ã€‚ä¸Šä¸€ç« æˆ‘ä»¬ä»æ¶æ„è§’åº¦æ¥è¯´ï¼Œåé‡äºä»‹ç»æ¦‚è¦è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿæ¶æ„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹å®ç°ç»†èŠ‚å¹¶æ²¡æœ‰åšè¿‡å¤šçš„å‰–æï¼Œè€Œæ˜¯æŠŠé‡å¿ƒæ”¾åœ¨æ¨¡å—ä¹‹é—´çš„æ¥å£è€¦åˆä¸Šã€‚è¿™æ˜¯å¸Œæœ›ä½ æŠŠå…³æ³¨ç‚¹æ”¾åœ¨å…¨å±€ï¼Œè€Œä¸æ˜¯ä¸€ä¸Šæ¥å°±è¿›å…¥å±€éƒ¨ç»†èŠ‚ã€‚ä½†æ˜¯ç”±äºç¼ºä¹å®Œæ•´æµç¨‹çš„å‰–æï¼Œå¤§å®¶æ²¡æ³•æŠŠæ•´ä¸ªè¿‡ç¨‹ä¸²èµ·æ¥ï¼Œç†è§£ä¸Šå°±ä¼šæ‰“æŠ˜æ‰£ã€‚</p><p>è¿™ä¸€ç« æˆ‘ä»¬åœ¨æ¶æ„ä¸Šä¼šåé‡äºè¯¦ç»†è®¾è®¡ã€‚è¿™åœ¨å®æˆ˜ç¯‡ä¹Ÿä¼šæœ‰æ‰€ä½“ç°ã€‚</p><p>åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª mock ç‰ˆæœ¬çš„æœåŠ¡ç«¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/tree/v31/paintdom\">https://github.com/qiniu/qpaint/tree/v31/paintdom</a></li>\n</ul><!-- [[[read_end]]] --><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€æ­¥æ­¥æŠŠå®ƒå˜æˆä¸€ä¸ªäº§å“çº§çš„æœåŠ¡ç«¯ç¨‹åºã€‚</p><h2>RPC æ¡†æ¶</h2><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å¼•å…¥ RPC æ¡†æ¶ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œåœ¨ä¸Šä¸€ç« çš„å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬çš„ mock æœåŠ¡ç«¯ç¨‹åºæ²¡æœ‰å¼•å…¥ä»»ä½•éæ ‡å‡†åº“çš„å†…å®¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v31/paintdom/service.go\">https://github.com/qiniu/qpaint/blob/v31/paintdom/service.go</a></li>\n</ul><p>æ•´ä¸ª Service å¤§çº¦ 280 è¡Œä»£ç ã€‚</p><p>æˆ‘ä»¬æ”¹ä¸ºåŸºäºä¸ƒç‰›äº‘å¼€æºçš„ <a href=\"https://github.com/qiniu/http/tree/v2.0.1/restrpc\">restrpc</a> æ¡†æ¶æ¥å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v41/paintdom/service.go\">https://github.com/qiniu/qpaint/blob/v41/paintdom/service.go</a></li>\n</ul><p>è¿™æ ·ï¼Œæ•´ä¸ª Service å°±å¤§çº¦åªå‰©ä¸‹ 163 è¡Œä»£ç ï¼Œåªæœ‰åŸå…ˆçš„ 60% ä¸åˆ°ã€‚</p><p>åˆ°åº•å°‘å†™äº†å“ªäº›ä»£ç ï¼Ÿæˆ‘ä»¬æ‹¿åˆ›å»ºä¸€ä¸ªæ–°å›¾å½¢æ¥çœ‹ä¸‹ã€‚åŸå…ˆæˆ‘ä»¬è¿™æ ·å†™ï¼š</p><pre><code>func (p *Service) PostShapes(w http.ResponseWriter, req *http.Request, args []string) {\n\tid := args[0]\n\tdrawing, err := p.doc.Get(id)\n\tif err != nil {\n\t\tReplyError(w, err)\n\t\treturn\n\t}\n\n\tvar aShape serviceShape\n\terr = json.NewDecoder(req.Body).Decode(&amp;aShape)\n\tif err != nil {\n\t\tReplyError(w, err)\n\t\treturn\n\t}\n\n\terr = drawing.Add(aShape.Get())\n\tif err != nil {\n\t\tReplyError(w, err)\n\t\treturn\n\t}\n\tReplyCode(w, 200)\n}\n</code></pre><p>ç°åœ¨è¿™æ ·å†™ï¼š</p><pre><code>func (p *Service) PostShapes(aShape *serviceShape, env *restrpc.Env) (err error) {\n\tid := env.Args[0]\n\tdrawing, err := p.doc.Get(id)\n\tif err != nil {\n\t\treturn\n\t}\n\treturn drawing.Add(aShape.Get())\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­è¿”å›åŒ…æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰ HTTP åŒ…çš„æ­£æ–‡ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªè¿”å›åŒ…æ¯”è¾ƒå¤æ‚çš„ä¾‹å­ï¼Œå–å›¾å½¢çš„å†…å®¹ã€‚åŸå…ˆæˆ‘ä»¬è¿™æ ·å†™ï¼š</p><pre><code>func (p *Service) GetShape(w http.ResponseWriter, req *http.Request, args []string) {\n\tid := args[0]\n\tdrawing, err := p.doc.Get(id)\n\tif err != nil {\n\t\tReplyError(w, err)\n\t\treturn\n\t}\n\n\tshapeID := args[1]\n\tshape, err := drawing.Get(shapeID)\n\tif err != nil {\n\t\tReplyError(w, err)\n\t\treturn\n\t}\n\tReply(w, 200, shape)\n}\n</code></pre><p>ç°åœ¨è¿™æ ·å†™ï¼š</p><pre><code>func (p *Service) GetShape(env *restrpc.Env) (shape Shape, err error) {\n\tid := env.Args[0]\n\tdrawing, err := p.doc.Get(id)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tshapeID := env.Args[1]\n\treturn drawing.Get(shapeID)\n}\n</code></pre><p>å¯¹æ¯”è¿™ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p><ul>\n<li>åŸå…ˆè¿™ä¸¤ä¸ªè¯·æ±‚ <code>POST /drawings/&lt;DrawingID&gt;/shapes</code>ã€<code>GET /drawings/&lt;DrawingID&gt;/shapes/&lt;ShapeID&gt;</code> ä¸­çš„ URL å‚æ•°å¦‚ DrawingIDã€ShapeID çš„å€¼ï¼Œæ˜¯é€šè¿‡å‚æ•° args[0]ã€args[1] ä¼ å…¥ï¼Œç°åœ¨é€šè¿‡ env.Args[0]ã€env.Args[1] ä¼ å…¥ã€‚</li>\n<li>åŸå…ˆæˆ‘ä»¬ PostShapes éœ€è¦è‡ªå·±å®šä¹‰ Shape å®ä¾‹å¹¶è§£æ HTTP è¯·æ±‚åŒ… req.Body çš„å†…å®¹ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨å‚æ•°ä¸­æŒ‡å®š Shape ç±»å‹ï¼Œrestrpc æ¡†æ¶å°±è‡ªåŠ¨å®Œæˆå‚æ•°çš„è§£æã€‚</li>\n<li>åŸå…ˆæˆ‘ä»¬ GetShape éœ€è¦è‡ªå·±å›å¤é”™è¯¯æˆ–è€…è¿”å›æ­£å¸¸çš„ HTTP åè®®åŒ…ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦åœ¨è¿”å›å€¼åˆ—è¡¨ä¸­è¿”å›è¦å›å¤çš„æ•°æ®ï¼Œrestrpc æ¡†æ¶è‡ªåŠ¨å®Œæˆè¿”å›å€¼çš„åºåˆ—åŒ–å¹¶å›å¤ HTTP è¯·æ±‚ã€‚</li>\n</ul><p>é€šè¿‡å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç å·®å¼‚ï¼Œæˆ‘ä»¬å¤§ä½“èƒ½å¤ŸçŒœå¾—å‡ºæ¥ï¼Œrestrpc çš„ HTTP å¤„ç†å‡½æ•°èƒŒåéƒ½å¹²äº†äº›å•¥ã€‚å…¶æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/http/blob/v2.0.2/rpcutil/rpc_util.go#L96\">https://github.com/qiniu/http/blob/v2.0.2/rpcutil/rpc_util.go#L96</a></li>\n</ul><p>å€¼å¾—å…³æ³¨çš„æ˜¯ Env çš„æ”¯æŒï¼ŒRPC æ¡†æ¶å¹¶æ²¡æœ‰é™å®š Env ç±»å…·ä½“æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œåªæ˜¯è§„å®šå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¥å£ï¼š</p><pre><code>type itfEnv interface {\n\tOpenEnv(rcvr interface{}, w *http.ResponseWriter, req *http.Request) error\n\tCloseEnv()\n}\n</code></pre><p>åœ¨ OpenEnv æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¿›è¡Œ Env çš„åˆå§‹åŒ–å·¥ä½œã€‚CloseEnv æ–¹æ³•åˆ™åä¹‹ã€‚ä¸ºä»€ä¹ˆ OpenEnv æ–¹æ³•ä¸­ï¼ŒResponseWriter æ¥å£æ˜¯ä»¥æŒ‡é’ˆæ–¹å¼ä¼ å…¥ï¼Ÿå› ä¸ºå¯èƒ½ä¼šæœ‰å®¢æˆ·å¸Œæœ›æ”¹å†™ ResponseWriter çš„å®ç°ã€‚</p><p>æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç»™ RPC æ¡†æ¶æ‰©å±• API å®¡è®¡æ—¥å¿—çš„åŠŸèƒ½ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ¥ç®¡å¹¶è®°å½•ç”¨æˆ·è¿”å›çš„ HTTP åŒ…ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦æ”¹å†™ ResponseWriter ä»¥è¾¾åˆ°æ¥ç®¡å¹¶è®°å½•çš„ç›®çš„ã€‚</p><p>å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œrestrpc ç‰ˆæœ¬çš„ HTTP è¯·æ±‚çš„å¤„ç†å‡½æ•°ï¼Œçœ‹èµ·æ¥ä¸å†é‚£ä¹ˆåƒ HTTP å¤„ç†å‡½æ•°ï¼Œå€’åƒä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼æ¥æµ‹è¯• Service ç±»ã€‚é™¤äº†ç”¨æ­£å¸¸æµ‹è¯• HTTP Service çš„æ–¹æ³•æ¥æµ‹è¯•å®ƒä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ Service ç±»å½“æˆæ™®é€šç±»æ¥æµ‹è¯•ï¼Œè¿™å¤§å¤§é™ä½å•å…ƒæµ‹è¯•çš„æˆæœ¬ã€‚å› ä¸ºæˆ‘ä»¬ä¸ç”¨å†éœ€è¦åŒ…è£…æœåŠ¡çš„ Client SDKï¼Œç„¶åå†åŸºäº Client SDK åšå•å…ƒæµ‹è¯•ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ç§ä½æˆæœ¬æµ‹è¯•æ–¹å¼ï¼Œä½†è¿˜æ˜¯ä¼šæ‹…å¿ƒè¿™ç§æµ‹è¯•æ–¹æ³•å¯èƒ½ä¸èƒ½è¦†ç›–ä¸€äº›ç¼–ç ä¸Šçš„å°æ„å¤–ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ²¡æœ‰èµ° HTTP åè®®ï¼Œå¿ƒé‡Œå¤šå¤šå°‘å°‘æœ‰äº›ä¸è¸å®ã€‚</p><p>ç†è§£äº† restrpc çš„ HTTP å¤„ç†å‡½æ•°ï¼Œå‰©ä¸‹çš„å°±æ˜¯ restrpc çš„è·¯ç”±åŠŸèƒ½ã€‚å®ƒæ˜¯ç”± restrpc.Router ç±»çš„ Register å‡½æ•°å®Œæˆçš„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/http/blob/v2.0.1/restrpc/restroute.go#L39\">https://github.com/qiniu/http/blob/v2.0.1/restrpc/restroute.go#L39</a></li>\n</ul><p>å®ƒæ”¯æŒä¸¤ç§è·¯ç”±æ–¹å¼ï¼Œä¸€ç§æ˜¯æ ¹æ®æ–¹æ³•åå­—è‡ªåŠ¨è·¯ç”±ã€‚æ¯”å¦‚ <code>POST /drawings/&lt;DrawingID&gt;/shapes</code> è¿™æ ·çš„è¯·æ±‚ï¼Œè¦æ±‚æ–¹æ³•åä¸º â€œPostDrawings_Shapesâ€ã€‚<code>GET /drawings/&lt;DrawingID&gt;/shapes/&lt;ShapeID&gt;</code> è¿™æ ·çš„è¯·æ±‚ï¼Œè¦æ±‚æ–¹æ³•åä¸º â€œGetDrawings_Shapes_â€ã€‚</p><p>è§„åˆ™å€’æ˜¯æ¯”è¾ƒç®€å•ï¼Œè·¯å¾„ä¸­çš„ â€œ/â€ ç”±å•è¯é¦–å­—æ¯å¤§å†™æ¥åˆ†éš”ï¼ŒURL å‚æ•°å¦‚ DrawingIDã€ShapeID è¿™äº›åˆ™æ›¿æ¢ä¸º â€œ_â€ã€‚</p><p>å½“ç„¶æœ‰çš„äººä¼šè®¤ä¸ºè¿™ç§æ–¹æ³•åå­—çœ‹èµ·æ¥å¾ˆä¸‘ã€‚é‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©æ‰‹å·¥è·¯ç”±çš„æ–¹å¼ï¼Œä¼ å…¥ routeTableã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>var routeTable = [][2]string{\n\t{&quot;POST /drawings&quot;, &quot;PostDrawings&quot;},\n\t{&quot;GET /drawings/*&quot;, &quot;GetDrawing&quot;},\n\t{&quot;DELETE /drawings/*&quot;, &quot;DeleteDrawing&quot;},\n\t{&quot;POST /drawings/*/sync&quot;, &quot;PostDrawingSync&quot;},\n\t{&quot;POST /drawings/*/shapes&quot;, &quot;PostShapes&quot;},\n\t{&quot;GET /drawings/*/shapes/*&quot;, &quot;GetShape&quot;},\n\t{&quot;POST /drawings/*/shapes/*&quot;, &quot;PostShape&quot;},\n\t{&quot;DELETE /drawings/*/shapes/*&quot;, &quot;DeleteShape&quot;},\n}\n</code></pre><p>è™½ç„¶æ˜¯æ‰‹å·¥è·¯ç”±ï¼Œä½†æ˜¯æ–¹æ³•åä»ç„¶æœ‰é™åˆ¶ï¼Œè¦æ±‚å¿…é¡»æ˜¯ Getã€Putã€Postã€Delete å¼€å¤´ã€‚</p><h2>ä¸šåŠ¡é€»è¾‘çš„åˆ†å±‚</h2><p>ç†è§£äº† restrpc æ¡†æ¶ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹ QPaint æœåŠ¡ç«¯çš„ä¸šåŠ¡æœ¬èº«ã€‚å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„æœåŠ¡ç«¯ä¸šåŠ¡é€»è¾‘è¢«åˆ†ä¸ºä¸¤å±‚ï¼šä¸€å±‚æ˜¯ä¸šåŠ¡é€»è¾‘çš„å®ç°å±‚ï¼Œé€šå¸¸æˆ‘ä»¬æœ‰æ„è¯†åœ°æŠŠå®ƒç»„ç»‡ä¸ºä¸€é¢— DOM æ ‘ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v41/paintdom/drawing.go\">https://github.com/qiniu/qpaint/blob/v41/paintdom/drawing.go</a></li>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v41/paintdom/shape.go\">https://github.com/qiniu/qpaint/blob/v41/paintdom/shape.go</a></li>\n</ul><p>å¦ä¸€å±‚åˆ™æ˜¯ RESTful API å±‚ï¼Œå®ƒè´Ÿè´£æ¥æ”¶ç”¨æˆ·çš„ç½‘ç»œè¯·æ±‚ï¼Œå¹¶è½¬ä¸ºå¯¹åº•å±‚ DOM æ ‘çš„æ–¹æ³•è°ƒç”¨ã€‚æœ‰äº†ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„ restrpc æ¡†æ¶ï¼Œè¿™ä¸€å±‚çš„æ¯ä¸ªæ–¹æ³•å¾€å¾€éƒ½æ¯”è¾ƒç®€å•ï¼Œç”šè‡³æœ‰çš„åªæ˜¯å¾ˆç®€å•çš„ä¸€å¥å‡½æ•°è°ƒç”¨ã€‚æ¯”å¦‚ï¼š</p><pre><code>func (p *Service) DeleteDrawing(env *restrpc.Env) (err error) {\n\tid := env.Args[0]\n\treturn p.doc.Delete(id)\n}\n</code></pre><p>å®Œæ•´çš„RESTful API å±‚ä»£ç å¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v41/paintdom/service.go\">https://github.com/qiniu/qpaint/blob/v41/paintdom/service.go</a></li>\n</ul><p>è¿™æ ·åˆ†å±‚çš„åŸå› ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå‡è®¾ä¸€å®šé€šè¿‡ RESTful API æš´éœ²ã€‚æˆ‘ä»¬è€ƒè™‘è¿™æ ·å‡ ç§å¯èƒ½æ€§ï¼š</p><p>å…¶ä¸€ï¼Œæœ‰å¯èƒ½æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦ç½‘ç»œè°ƒç”¨ã€‚</p><p>åšä¸ªç±»æ¯”ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ mysql æ˜¯é€šè¿‡ TCP åè®®æä¾›æœåŠ¡æ¥å£çš„ï¼Œè€Œ sqlite æ˜¯åµŒå…¥å¼æ•°æ®åº“ï¼Œæ˜¯é€šè¿‡æœ¬åœ°çš„å‡½æ•°è°ƒç”¨æä¾›æœåŠ¡æ¥å£çš„ã€‚è¿™é‡Œåˆ†å±‚å°±ç±»ä¼¼äºæˆ‘å®ç° mysql çš„æ—¶å€™ï¼Œå…ˆåœ¨åº•å±‚å®ç°äº†ä¸€ä¸ªç±»ä¼¼ sqlite çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œç„¶åå†æä¾›åŸºäº TCP åè®®çš„ç½‘ç»œæ¥å£ã€‚</p><p>å…¶äºŒï¼Œæœ‰å¯èƒ½æˆ‘ä»¬éœ€è¦æ”¯æŒå¾ˆå¤šç§ç½‘ç»œåè®®ã€‚</p><p>æˆ‘ä»¬ä»Šå¤©æµè¡Œ RESTful APIï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ¥å£æ˜¯ RESTful é£æ ¼çš„ã€‚å¦‚æœæœ‰ä¸€å¤©æˆ‘ä»¬åƒ Github ä¸€æ ·æƒ³æ”¹ç”¨ GraphQLï¼Œé‚£ä¹ˆè‡³å°‘åº•å±‚çš„ä¸šåŠ¡é€»è¾‘å®ç°å±‚æ˜¯ä¸éœ€è¦æ”¹å˜çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ç›¸å¯¹è–„çš„ GraphQL å±‚å°±è¡Œäº†ã€‚</p><p>è€Œä¸”ï¼Œå¾€å¾€åœ¨è¿™ç§æƒ…å†µä¸‹ RESTful API å’Œ GraphQL æ˜¯éœ€è¦åŒæ—¶æ”¯æŒçš„ã€‚æ¯•ç«Ÿæˆ‘ä»¬ä¸å¯èƒ½ä¸ºäº†èµ¶æ—¶é«¦ï¼Œå°±æŠŠè€ç”¨æˆ·å¼ƒä¹‹ä¸é¡¾äº†ã€‚</p><p>åœ¨éœ€è¦åŒæ—¶æ”¯æŒå¤šå¥—ç½‘ç»œæ¥å£çš„æ—¶å€™ï¼Œè¿™ç§åˆ†å±‚çš„ä»·å€¼å°±ä½“ç°å‡ºæ¥äº†ï¼Œä¸åŒç½‘ç»œæ¥å£çš„æ¨¡å—ä¹‹é—´ï¼Œå…±äº«äº†åŒä¸€ä»½ DOM æ ‘çš„å®ä¾‹ï¼Œæ•´ä¸ªä½“ç³»ä¸ä»…å®ç°äº†å¤šåè®®å¹¶å­˜ï¼Œè¿˜å®ç°äº†å®Œç¾çš„è§£è€¦ï¼Œå½¼æ­¤ä¹‹é—´å®Œå…¨ç‹¬ç«‹ã€‚</p><h2>å•å…ƒæµ‹è¯•</h2><p>èŠå®Œäº†ä¸šåŠ¡ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å•å…ƒæµ‹è¯•ã€‚</p><p>ä¹‹å‰ï¼Œæˆ‘ä»¬å•å…ƒæµ‹è¯•åŸºæœ¬ä¸Šæ²¡æ€ä¹ˆåšï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/qpaint/blob/v31/paintdom/service_test.go#L62\">https://github.com/qiniu/qpaint/blob/v31/paintdom/service_test.go#L62</a></li>\n</ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>type idRet struct {\n\tID string `json:&quot;id&quot;`\n}\n\nfunc TestNewDrawing(t *testing.T) {\n        ...\n\tvar ret idRet\n\terr := Post(&amp;ret, ts.URL + &quot;/drawings&quot;, &quot;&quot;)\n\tif err != nil {\n\t\tt.Fatal(&quot;Post /drawings failed:&quot;, err)\n\t}\n\tif ret.ID != &quot;10001&quot; {\n\t\tt.Log(&quot;new drawing id:&quot;, ret.ID)\n\t}\n}\n</code></pre><p>ä»è¿™é‡Œçš„æµ‹è¯•ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å°±åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª drawingï¼Œå¹¶ä¸”è¦æ±‚è¿”å›çš„ drawingID ä¸º \"10001\"ã€‚</p><p>ä»å•å…ƒæµ‹è¯•çš„è§’åº¦ï¼Œè¿™æ ·çš„æµ‹è¯•åŠ›åº¦å½“ç„¶æ˜¯éå¸¸ä¸è¶³çš„ã€‚åŒæ ·çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œç”¨æˆ‘ä»¬ä¸Šä¸€è®²ä»‹ç»çš„ <a href=\"https://github.com/qiniu/httptest\">httptest</a> æµ‹è¯•æ¡†æ¶å®ç°å¦‚ä¸‹ï¼š</p><pre><code>func TestNewDrawing(t *testing.T) {\n    ...\n    ctx := httptest.New(t)\n    ctx.Exec(\n    `\n\tpost http://qpaint.com/drawings\n\tret 200\n\tjson '{&quot;id&quot;: &quot;10001&quot;}'\n    `)\n}\n</code></pre><p>å½“ç„¶ï¼Œå®é™…æˆ‘ä»¬åº”è¯¥å»æµ‹è¯•æ›´å¤šçš„æƒ…å†µï¼Œæ¯”å¦‚ï¼š</p><pre><code>func TestService(t *testing.T) {\n        ...\n\tctx := httptest.New(t)\n\tctx.Exec(\n\t`\n\tpost http://qpaint.com/drawings\n\tret 200\n\tjson '{\n\t\t&quot;id&quot;: $(id1)\n\t}'\n\tmatch $(line1) '{\n\t\t&quot;id&quot;: &quot;1&quot;,\n\t\t&quot;line&quot;: {\n\t\t\t&quot;pt1&quot;: {&quot;x&quot;: 2.0, &quot;y&quot;: 3.0},\n\t\t\t&quot;pt2&quot;: {&quot;x&quot;: 15.0, &quot;y&quot;: 30.0},\n\t\t\t&quot;style&quot;: {\n\t\t\t\t&quot;lineWidth&quot;: 3,\n\t\t\t\t&quot;lineColor&quot;: &quot;red&quot;\n\t\t\t}\n\t\t}\n\t}'\n\tpost http://qpaint.com/drawings/$(id1)/shapes\n\tjson $(line1)\n\tret 200\n\tget http://qpaint.com/drawings/$(id1)/shapes/1\n\tret 200\n\tjson $(line1)\n\t`)\n\tif !ctx.GetVar(&quot;id1&quot;).Equal(&quot;10001&quot;) {\n\t\tt.Fatal(`$(id1) != &quot;10001&quot;`)\n\t}\n}\n</code></pre><p>è¿™ä¸ªæ¡ˆä¾‹æˆ‘ä»¬æƒ³æ¼”ç¤ºä»€ä¹ˆï¼Ÿè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„æ¡ˆä¾‹ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª drawingï¼Œå¹¶ä¸”å°† drawingID æ”¾åˆ°å˜é‡ <code>$(id1)</code> ä¸­ã€‚éšåï¼Œæˆ‘ä»¬å‘è¯¥ drawing ä¸­æ·»åŠ äº†ä¸€æ¡ç›´çº¿ <code>$(line1)</code>ã€‚ä¸ºäº†ç¡®è®¤æ·»åŠ æˆåŠŸï¼Œæˆ‘ä»¬å–å‡ºäº†è¯¥å›¾å½¢å¯¹è±¡ï¼Œå¹¶ä¸”åˆ¤æ–­å–å¾—çš„å›¾å½¢å’Œæ·»åŠ è¿›å»çš„ <code>$(line1)</code> æ˜¯å¦ä¸€è‡´ã€‚</p><p>å¦å¤–ï¼Œå®ƒä¹Ÿæ¼”ç¤ºäº† qiniutest DSL è„šæœ¬å’Œ Go è¯­è¨€ä»£ç çš„äº’æ“ä½œæ€§ã€‚æˆ‘ä»¬ç”¨ Go ä»£ç å–å¾—å˜é‡ <code>$(id1)</code>ï¼Œå¹¶ä¸”åˆ¤æ–­å®ƒæ˜¯å¦å’Œ \"10001\" ç›¸ç­‰ã€‚</p><p>å…³äº qiniutest æ›´å¤šçš„å†…å®¹ï¼Œè¯·æŸ¥é˜…ä»¥ä¸‹èµ„æ–™ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/httptest\">https://github.com/qiniu/httptest</a></li>\n<li><a href=\"https://github.com/qiniu/qiniutest\">https://github.com/qiniu/qiniutest</a></li>\n<li>æ¼”è®²ç¨¿ï¼š<a href=\"http://open.qiniudn.com/qiniutest.pdf\">http://open.qiniudn.com/qiniutest.pdf</a></li>\n</ul><p>åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¸­ï¼Œè¿˜ä½¿ç”¨äº†ä¸€ä¸ªä¸ƒç‰›äº‘å¼€æºçš„ mockhttp ç»„ä»¶ï¼Œå®ƒä¹Ÿéå¸¸æœ‰æ„æ€ï¼š</p><ul>\n<li><a href=\"https://github.com/qiniu/x/blob/v8.0.1/mockhttp/mockhttp.go\">https://github.com/qiniu/x/blob/v8.0.1/mockhttp/mockhttp.go</a></li>\n</ul><p>è¿™ä¸ª mockhttp å¹¶ä¸çœŸå»ç›‘å¬ç«¯å£ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚</p><h2>ç»“è¯­</h2><p>æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚</p><p>ä»ä»Šå¤©å¼€å§‹æˆ‘ä»¬ä¼šä¸€æ­¥æ­¥å°†ä¹‹å‰å†™çš„ mock æœåŠ¡ç«¯æ”¹é€ ä¸ºçœŸå®çš„æœåŠ¡ç«¯ç¨‹åºã€‚</p><p>æˆ‘ä»¬ç¬¬ä¸€æ­¥æ”¹é€ çš„æ˜¯ RPC æ¡†æ¶å’Œå•å…ƒæµ‹è¯•ã€‚è¿™æ ·æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¼€å§‹ä¾èµ–ç¬¬ä¸‰æ–¹çš„ä»£ç åº“ï¼Œå¦‚ä¸‹ï¼š</p><ul>\n<li><a href=\"http://github.com/qiniu/http\">http://github.com/qiniu/http</a> ï¼ˆç”¨åˆ° restrpcï¼‰</li>\n<li><a href=\"http://github.com/qiniu/qiniutest\">http://github.com/qiniu/qiniutest</a></li>\n<li><a href=\"http://github.com/qiniu/x\">http://github.com/qiniu/x</a> ï¼ˆç”¨åˆ° mockhttpï¼‰</li>\n</ul><p>ä¸€æ—¦æœ‰äº†å¤–éƒ¨ä¾èµ–ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘ä¾èµ–åº“çš„ç‰ˆæœ¬ç®¡ç†ã€‚å¥½çš„ä¸€ç‚¹æ˜¯å¤§å¤šæ•°ç°ä»£è¯­è¨€éƒ½æœ‰å¾ˆå¥½çš„ç‰ˆæœ¬ç®¡ç†è§„èŒƒï¼Œå¯¹äº Go è¯­è¨€æˆ‘ä»¬ç”¨ go mod æ¥åšç‰ˆæœ¬ç®¡ç†ã€‚</p><p>å¦‚æœä½ å¯¹ä»Šå¤©çš„å†…å®¹æœ‰ä»€ä¹ˆæ€è€ƒä¸è§£è¯»ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚ä¸‹ä¸€è®²å¼€å§‹æˆ‘ä»¬ç»§ç»­å®æˆ˜ã€‚</p><p>å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p>","comments":[{"had_liked":false,"id":143775,"user_name":"Bachue Zhou","can_delete":false,"product_type":"c1","uid":1494491,"ip_address":"","ucode":"3175754775CA32","user_header":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","comment_is_top":false,"comment_ctime":1571791173,"is_pvip":false,"replies":[{"id":"55572","content":"å—¯ï¼Œè¿™ä¸ªé¡¾è™‘æ˜¯æœ‰é“ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ‰“ç®—æ˜¯ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªdslä¸goè¯­è¨€çš„äº’æ“ä½œæ€§ï¼Œè¿™æ ·å°±ç®—é¢å¯¹å¤šå¤æ‚çš„éœ€æ±‚éƒ½å¯ä»¥è‡ªå¦‚åº”å¯¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1571839319,"ip_address":"","comment_id":143775,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23046627653","product_id":100025201,"comment_content":"ç”¨è¿™æ ·ç‚«é…·çš„ DSL è™½ç„¶çœ‹ä¸Šå»å¾ˆæ£’ï¼Œä½†å…¶å®æ˜¯ä»¥æ”¾å¼ƒäº†ç¼–è¯‘æ—¶æ£€æŸ¥ä¸ºä»£ä»·çš„ï¼Œå¢åŠ äº†ä»¥åé•¿æœŸç»´æŠ¤çš„å›°éš¾ç¨‹åº¦ã€‚è€Œä¸”ä½¿ç”¨è‡ªå®šä¹‰çš„è¯­æ³•è€Œéä¸€é—¨åŸæœ¬å°±æ˜¯å…¨åŠŸèƒ½çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯èƒ½ä»¥åä¼šç–²äºåº”å¯¹å„ç§éœ€æ±‚ï¼Œæ¯”å¦‚ä¸ƒç‰› API ä¸­ base64 çš„æˆåˆ†å¾ˆå¤šå°±ä¸“é—¨å¢åŠ äº† base64 çš„åŠŸèƒ½ï¼Œç”šè‡³è¯­æ³•ä¸Šè®¾è®¡çš„å¾ˆåƒ shell è¯­æ³•ï¼Œä½†ä»¥åè¯´ä¸å®šå°±ä¼šæœ‰å…¶ä»–ç¼–è§£ç ç®—æ³•å‡ºç°ï¼Œæœ€ç»ˆå‘ç°è¿˜ä¸å¦‚æŠŠ openssl éƒ½å¼„è¿›æ¥","like_count":6,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471680,"discussion_content":"å—¯ï¼Œè¿™ä¸ªé¡¾è™‘æ˜¯æœ‰é“ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ‰“ç®—æ˜¯ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªdslä¸goè¯­è¨€çš„äº’æ“ä½œæ€§ï¼Œè¿™æ ·å°±ç®—é¢å¯¹å¤šå¤æ‚çš„éœ€æ±‚éƒ½å¯ä»¥è‡ªå¦‚åº”å¯¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571839319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133105,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1568361718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23043198198","product_id":100025201,"comment_content":"ä»Šå¤©ä¸­ç§‹èŠ‚ æ²¡äººæ‰“å¡äº†å—","like_count":5},{"had_liked":false,"id":133524,"user_name":"Charles","can_delete":false,"product_type":"c1","uid":1001410,"ip_address":"","ucode":"32646D78CC0389","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/c2/e9fa4cf6.jpg","comment_is_top":false,"comment_ctime":1568597079,"is_pvip":false,"replies":[{"id":"51267","content":"æ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1568605881,"ip_address":"","comment_id":133524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5863564375","product_id":100025201,"comment_content":"åŸºç¡€ä¸å¤§å¥½ï¼Œè¯·æ•™ä¸‹è®¸è€å¸ˆï¼Œè¿™ç¯‡ä¸­æåˆ°çš„rpcæ¡†æ¶ä½œç”¨æ˜¯ä¸ºäº†æ›´å¿«é€Ÿçš„å¼€å‘RESTful APIï¼Œè€Œå°è£…äº†åº•å±‚httpåè®®å¤„ç†å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467413,"discussion_content":"æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568605881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290243,"user_name":"ä¸æ¸©æš–å•Šä¸çº¯è‰¯","can_delete":false,"product_type":"c1","uid":2079117,"ip_address":"","ucode":"204474A214E00C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/b9/8d/00bded19.jpg","comment_is_top":false,"comment_ctime":1619446309,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619446309","product_id":100025201,"comment_content":"åœ¨å®ç°ä¸šåŠ¡å±‚çš„æ—¶å€™ï¼Œå°†ä¸šåŠ¡å±‚åˆ†æˆäº†ä¸¤å±‚ï¼Œä¸€å±‚æ˜¯å¯¹å¤–æä¾›ç½‘ç»œæ¥å£ï¼Œä¸€å±‚æ˜¯å®ç°å…·ä½“ä¸šåŠ¡çš„é€»è¾‘ã€‚åœ¨å·¥ä½œä¸­æ›¾ç»çœ‹åˆ°ä¸€ä¸ªåŒäº‹å°†é€»è¾‘ä»£ç ï¼Œå†™åˆ°äº†æ¥å£å±‚ï¼Œç›´æ¥çœå»äº†serviceå¤„ç†å±‚ï¼Œç›´æ¥ä½¿ç”¨æ¥å£å±‚å»è°ƒç”¨daoå±‚çš„æ•°æ®è¿”å›ï¼Œå½“ç„¶æˆ‘ä»¬æ˜¯åŸºäºä¸‰å±‚æ¶æ„ï¼Œå°†ä¸šåŠ¡å±‚ä»£ç åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯æ¥å£å±‚controllerï¼ŒæœåŠ¡å¤„ç†å±‚serviceï¼Œæ•°æ®äº¤äº’å±‚daoï¼Œä½†æ˜¯æˆ‘å€’æ˜¯è§‰å¾—ä»–è¿™ç§æ–¹æ³•ä¹Ÿæœ‰ä¸€ç•ªé£å‘³ï¼Œä¸çŸ¥é“æ˜¯å¦åœ¨è´Ÿæ‹…è®¾è®¡å²ä¸Šå­˜åœ¨è¿‡è¿™æ ·çš„åˆ†å±‚ï¼Œå¦‚æœæˆ‘ä»¬ç”¨é¢†åŸŸé©±åŠ¨å‹è®¾è®¡ï¼Œåªè¦è®¾è®¡å¥½modelå±‚ï¼Œé‚£å®Œå…¨å¯ä»¥ç”¨æ¥å£å±‚ç›´æ¥è°ƒç”¨modelå±‚å’Œdaoå±‚ï¼Œä¸å¿…ä½¿ç”¨service.å±‚ã€‚","like_count":0},{"had_liked":false,"id":281433,"user_name":"Run","can_delete":false,"product_type":"c1","uid":1371941,"ip_address":"","ucode":"6738D2F36ACFF6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLMDBq7lqg9ZasC4f21R0axKJRVCBImPKlQF8yOicLLXIsNgsZxsVyN1mbvFOL6eVPluTNgJofwZeA/132","comment_is_top":false,"comment_ctime":1614749408,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614749408","product_id":100025201,"comment_content":"ç•¥è¿‡","like_count":0},{"had_liked":false,"id":134994,"user_name":"Quincy","can_delete":false,"product_type":"c1","uid":1194412,"ip_address":"","ucode":"FFFBB9FFCB98A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/39/ac/76beadf1.jpg","comment_is_top":false,"comment_ctime":1568970919,"is_pvip":false,"replies":[{"id":"51836","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","uid":"1228022","ctime":1569010244,"ip_address":"","comment_id":134994,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568970919","product_id":100025201,"comment_content":"go çš„ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å·¥å…·ï¼Œè€å¸ˆæ¨èç”¨gomodå˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"è®¸å¼ä¼Ÿ-ä¸ƒç‰›äº‘(å·²æ»¡)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467993,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569010244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133125,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1568369436,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568369436","product_id":100025201,"comment_content":"ç»ˆäºåˆçœ‹åˆ°äº†ç†Ÿæ‚‰çš„golangä»£ç ğŸ˜„","like_count":0}]}