{"id":126109,"title":"36 | 你应该怎么监控Kafka？","content":"<p>你好，我是胡夕。今天我要和你分享的主题是：如何监控Kafka。</p><p>监控Kafka，历来都是个老大难的问题。无论是在我维护的微信公众号，还是Kafka QQ群里面，大家问得最多的问题，一定是Kafka的监控。大家提问的内容看似五花八门，但真正想了解的，其实都是监控这点事，也就是我应该监控什么，怎么监控。那么今天，我们就来详细聊聊这件事。</p><p>我个人认为，和头疼医头、脚疼医脚的问题类似，在监控Kafka时，如果我们只监控Broker的话，就难免以偏概全。单个Broker启动的进程虽然属于Kafka应用，但它也是一个普通的Java进程，更是一个操作系统进程。因此，我觉得有必要从Kafka主机、JVM和Kafka集群本身这三个维度进行监控。</p><h2>主机监控</h2><p>主机级别的监控，往往是揭示线上问题的第一步。<strong>所谓主机监控，指的是监控Kafka集群Broker所在的节点机器的性能</strong>。通常来说，一台主机上运行着各种各样的应用进程，这些进程共同使用主机上的所有硬件资源，比如CPU、内存或磁盘等。</p><p>常见的主机监控指标包括但不限于以下几种：</p><ul>\n<li>机器负载（Load）</li>\n<li>CPU使用率</li>\n<li>内存使用率，包括空闲内存（Free Memory）和已使用内存（Used Memory）</li>\n<li>磁盘I/O使用率，包括读使用率和写使用率</li>\n<li>网络I/O使用率</li>\n<li>TCP连接数</li>\n<li>打开文件数</li>\n<li>inode使用情况</li>\n</ul><!-- [[[read_end]]] --><p>考虑到我们并不是要系统地学习调优与监控主机性能，因此我并不打算对上面的每一个指标都进行详细解释，我重点分享一下机器负载和CPU使用率的监控方法。我会以Linux平台为例来进行说明，其他平台应该也是类似的。</p><p>首先，我们来看一张图片。我在Kafka集群的某台Broker所在的主机上运行top命令，输出的内容如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/00/e0/00f0ead463b17e667d09b6cea4e42de0.png?wh=1950*1546\" alt=\"\"></p><p>在图片的右上角，我们可以看到load average的3个值：4.85，2.76和1.26，它们分别代表过去1分钟、过去5分钟和过去15分钟的Load平均值。在这个例子中，我的主机总共有4个CPU核，但Load值却达到了4.85，这就说明，一定有进程暂时“抢不到”任何CPU资源。同时，Load值一直在增加，也说明这台主机上的负载越来越大。</p><p>举这个例子，其实我真正想说的是CPU使用率。很多人把top命令中“%CPU”列的输出值当作CPU使用率。比如，在上面这张图中，PID为2637的Java进程是Broker进程，它对应的“%CPU”的值是102.3。你不要认为这是CPU的真实使用率，这列值的真实含义是进程使用的所有CPU的平均使用率，只是top命令在显示的时候转换成了单个CPU。因此，如果是在多核的主机上，这个值就可能会超过100。在这个例子中，我的主机有4个CPU核，总CPU使用率是102.3，那么，平均每个CPU的使用率大致是25%。</p><h2>JVM监控</h2><p>除了主机监控之外，另一个重要的监控维度就是JVM监控。Kafka Broker进程是一个普通的Java进程，所有关于JVM的监控手段在这里都是适用的。</p><p>监控JVM进程主要是为了让你全面地了解你的应用程序（Know Your Application）。具体到Kafka而言，就是全面了解Broker进程。比如，Broker进程的堆大小（HeapSize）是多少、各自的新生代和老年代是多大？用的是什么GC回收器？这些监控指标和配置参数林林总总，通常你都不必全部重点关注，但你至少要搞清楚Broker端JVM进程的Minor GC和Full GC的发生频率和时长、活跃对象的总大小和JVM上应用线程的大致总数，因为这些数据都是你日后调优Kafka Broker的重要依据。</p><p>我举个简单的例子。假设一台主机上运行的Broker进程在经历了一次Full GC之后，堆上存活的活跃对象大小是700MB，那么在实际场景中，你几乎可以安全地将老年代堆大小设置成该数值的1.5倍或2倍，即大约1.4GB。不要小看700MB这个数字，它是我们设定Broker堆大小的重要依据！</p><p>很多人会有这样的疑问：我应该怎么设置Broker端的堆大小呢？其实，这就是最合理的评估方法。试想一下，如果你的Broker在Full GC之后存活了700MB的数据，而你设置了堆大小为16GB，这样合理吗？对一个16GB大的堆执行一次GC要花多长时间啊？！</p><p>因此，我们来总结一下。要做到JVM进程监控，有3个指标需要你时刻关注：</p><ol>\n<li>Full GC发生频率和时长。这个指标帮助你评估Full GC对Broker进程的影响。长时间的停顿会令Broker端抛出各种超时异常。</li>\n<li>活跃对象大小。这个指标是你设定堆大小的重要依据，同时它还能帮助你细粒度地调优JVM各个代的堆大小。</li>\n<li>应用线程总数。这个指标帮助你了解Broker进程对CPU的使用情况。</li>\n</ol><p>总之，你对Broker进程了解得越透彻，你所做的JVM调优就越有效果。</p><p>谈到具体的监控，前两个都可以通过GC日志来查看。比如，下面的这段GC日志就说明了GC后堆上的存活对象大小。</p><blockquote>\n<p>2019-07-30T09:13:03.809+0800: 552.982: [GC cleanup 827M-&gt;645M(1024M), 0.0019078 secs]</p>\n</blockquote><p>这个Broker JVM进程默认使用了G1的GC算法，当cleanup步骤结束后，堆上活跃对象大小从827MB缩减成645MB。另外，你可以根据前面的时间戳来计算每次GC的间隔和频率。</p><p>自0.9.0.0版本起，社区将默认的GC收集器设置为G1，而G1中的Full GC是由单线程执行的，速度非常慢。因此，<strong>你一定要监控你的Broker GC日志，即以kafkaServer-gc.log开头的文件</strong>。注意不要出现Full GC的字样。一旦你发现Broker进程频繁Full GC，可以开启G1的-XX:+PrintAdaptiveSizePolicy开关，让JVM告诉你到底是谁引发了Full GC。</p><h2>集群监控</h2><p>说完了主机和JVM监控，现在我来给出监控Kafka集群的几个方法。</p><p><strong>1.查看Broker进程是否启动，端口是否建立。</strong></p><p>千万不要小看这一点。在很多容器化的Kafka环境中，比如使用Docker启动Kafka Broker时，容器虽然成功启动了，但是里面的网络设置如果配置有误，就可能会出现进程已经启动但端口未成功建立监听的情形。因此，你一定要同时检查这两点，确保服务正常运行。</p><p><strong>2.查看Broker端关键日志。</strong></p><p>这里的关键日志，主要涉及Broker端服务器日志server.log，控制器日志controller.log以及主题分区状态变更日志state-change.log。其中，server.log是最重要的，你最好时刻对它保持关注。很多Broker端的严重错误都会在这个文件中被展示出来。因此，如果你的Kafka集群出现了故障，你要第一时间去查看对应的server.log，寻找和定位故障原因。</p><p><strong>3.查看Broker端关键线程的运行状态。</strong></p><p>这些关键线程的意外挂掉，往往无声无息，但是却影响巨大。比方说，Broker后台有个专属的线程执行Log Compaction操作，由于源代码的Bug，这个线程有时会无缘无故地“死掉”，社区中很多Jira都曾报出过这个问题。当这个线程挂掉之后，作为用户的你不会得到任何通知，Kafka集群依然会正常运转，只是所有的Compaction操作都不能继续了，这会导致Kafka内部的位移主题所占用的磁盘空间越来越大。因此，我们有必要对这些关键线程的状态进行监控。</p><p>可是，一个Kafka Broker进程会启动十几个甚至是几十个线程，我们不可能对每个线程都做到实时监控。所以，我跟你分享一下我认为最重要的两类线程。在实际生产环境中，监控这两类线程的运行情况是非常有必要的。</p><ul>\n<li>Log Compaction线程，这类线程是以kafka-log-cleaner-thread开头的。就像前面提到的，此线程是做日志Compaction的。一旦它挂掉了，所有Compaction操作都会中断，但用户对此通常是无感知的。</li>\n<li>副本拉取消息的线程，通常以ReplicaFetcherThread开头。这类线程执行Follower副本向Leader副本拉取消息的逻辑。如果它们挂掉了，系统会表现为对应的Follower副本不再从Leader副本拉取消息，因而Follower副本的Lag会越来越大。</li>\n</ul><p>不论你是使用jstack命令，还是其他的监控框架，我建议你时刻关注Broker进程中这两类线程的运行状态。一旦发现它们状态有变，就立即查看对应的Kafka日志，定位原因，因为这通常都预示会发生较为严重的错误。</p><p><strong>4.查看Broker端的关键JMX指标。</strong></p><p>Kafka提供了超多的JMX指标供用户实时监测，我来介绍几个比较重要的Broker端JMX指标：</p><ul>\n<li>BytesIn/BytesOut：即Broker端每秒入站和出站字节数。你要确保这组值不要接近你的网络带宽，否则这通常都表示网卡已被“打满”，很容易出现网络丢包的情形。</li>\n<li>NetworkProcessorAvgIdlePercent：即网络线程池线程平均的空闲比例。通常来说，你应该确保这个JMX值长期大于30%。如果小于这个值，就表明你的网络线程池非常繁忙，你需要通过增加网络线程数或将负载转移给其他服务器的方式，来给该Broker减负。</li>\n<li>RequestHandlerAvgIdlePercent：即I/O线程池线程平均的空闲比例。同样地，如果该值长期小于30%，你需要调整I/O线程池的数量，或者减少Broker端的负载。</li>\n<li>UnderReplicatedPartitions：即未充分备份的分区数。所谓未充分备份，是指并非所有的Follower副本都和Leader副本保持同步。一旦出现了这种情况，通常都表明该分区有可能会出现数据丢失。因此，这是一个非常重要的JMX指标。</li>\n<li>ISRShrink/ISRExpand：即ISR收缩和扩容的频次指标。如果你的环境中出现ISR中副本频繁进出的情形，那么这组值一定是很高的。这时，你要诊断下副本频繁进出ISR的原因，并采取适当的措施。</li>\n<li>ActiveControllerCount：即当前处于激活状态的控制器的数量。正常情况下，Controller所在Broker上的这个JMX指标值应该是1，其他Broker上的这个值是0。如果你发现存在多台Broker上该值都是1的情况，一定要赶快处理，处理方式主要是查看网络连通性。这种情况通常表明集群出现了脑裂。脑裂问题是非常严重的分布式故障，Kafka目前依托ZooKeeper来防止脑裂。但一旦出现脑裂，Kafka是无法保证正常工作的。</li>\n</ul><p>其实，Broker端还有很多很多JMX指标，除了上面这些重要指标，你还可以根据自己业务的需要，去官网查看其他JMX指标，把它们集成进你的监控框架。</p><p><strong>5.监控Kafka客户端。</strong></p><p>客户端程序的性能同样需要我们密切关注。不管是生产者还是消费者，我们首先要关心的是客户端所在的机器与Kafka Broker机器之间的<strong>网络往返时延</strong>（Round-Trip Time，RTT）。通俗点说，就是你要在客户端机器上ping一下Broker主机IP，看看RTT是多少。</p><p>我曾经服务过一个客户，他的Kafka生产者TPS特别低。我登到机器上一看，发现RTT是1秒。在这种情况下，无论你怎么调优Kafka参数，效果都不会太明显，降低网络时延反而是最直接有效的办法。</p><p>除了RTT，客户端程序也有非常关键的线程需要你时刻关注。对于生产者而言，有一个以kafka-producer-network-thread开头的线程是你要实时监控的。它是负责实际消息发送的线程。一旦它挂掉了，Producer将无法正常工作，但你的Producer进程不会自动挂掉，因此你有可能感知不到。对于消费者而言，心跳线程事关Rebalance，也是必须要监控的一个线程。它的名字以kafka-coordinator-heartbeat-thread开头。</p><p>除此之外，客户端有一些很重要的JMX指标，可以实时告诉你它们的运行情况。</p><p>从Producer角度，你需要关注的JMX指标是request-latency，即消息生产请求的延时。这个JMX最直接地表征了Producer程序的TPS；而从Consumer角度来说，records-lag和records-lead是两个重要的JMX指标。我们在专栏<a href=\"https://time.geekbang.org/column/article/109238\">第22讲</a>解释过这两个指标的含义，这里我就不再赘述了。总之，它们直接反映了Consumer的消费进度。如果你使用了Consumer Group，那么有两个额外的JMX指标需要你关注下，一个是join rate，另一个是sync rate。它们说明了Rebalance的频繁程度。如果在你的环境中，它们的值很高，那么你就需要思考下Rebalance频繁发生的原因了。</p><h2>小结</h2><p>好了，我们来小结一下。今天，我介绍了监控Kafka的方方面面。除了监控Kafka集群，我还推荐你从主机和JVM的维度进行监控。对主机的监控，往往是我们定位和发现问题的第一步。JVM监控同样重要。要知道，很多Java进程碰到的性能问题是无法通过调整Kafka参数是解决的。最后，我罗列了一些比较重要的Kafka JMX指标。在下一讲中，我会专门介绍一下如何使用各种工具来查看这些JMX指标。</p><p><img src=\"https://static001.geekbang.org/resource/image/28/93/28e6d8c2459b5d123f443173ac122c93.jpg?wh=2069*2560\" alt=\"\"></p><h2>开放讨论</h2><p>请分享一下你在监控Kafka方面的心得，以及你的运维技巧。</p><p>欢迎写下你的思考和答案，我们一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><p></p>","neighbors":{"left":{"article_title":"35 | 跨集群备份解决方案MirrorMaker","id":120991},"right":{"article_title":"37 | 主流的Kafka监控框架","id":127192}},"comments":[{"had_liked":false,"id":130843,"user_name":"我已经设置了昵称","can_delete":false,"product_type":"c1","uid":1364034,"ip_address":"","ucode":"ED672C5EBDBDC4","user_header":"https://static001.geekbang.org/account/avatar/00/14/d0/42/6fd01fb9.jpg","comment_is_top":false,"comment_ctime":1567558998,"is_pvip":false,"replies":[{"id":"49120","content":"无论是Broker端还是Clients端启动前要先设置JMX_PORT，然后使用任何能够连接JMX MBean Server的工具或框架连接（如JConsole）就能看到了","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567595827,"ip_address":"","comment_id":130843,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57402133846","product_id":100029201,"comment_content":"要怎么看到JMX指标呢，能否讲下","like_count":14,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466150,"discussion_content":"无论是Broker端还是Clients端启动前要先设置JMX_PORT，然后使用任何能够连接JMX MBean Server的工具或框架连接（如JConsole）就能看到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567595827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127299,"user_name":"r","can_delete":false,"product_type":"c1","uid":1408176,"ip_address":"","ucode":"34B6905DC23B3B","user_header":"https://static001.geekbang.org/account/avatar/00/15/7c/b0/0ee17e1b.jpg","comment_is_top":false,"comment_ctime":1566640539,"is_pvip":false,"replies":[{"id":"47282","content":"根据社区的报告，Kafka 1.1.0之后可以支持单集群20万个分区。和集群规模不能说没有关系，但其实和集群总的物理硬件资源有很大关系。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566781953,"ip_address":"","comment_id":127299,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27336444315","product_id":100029201,"comment_content":"老师总结的真好。我有个疑问，没找到相关资料做支撑。就是一套kafka集群，最多能容纳多少个topic-partition，这个是集群规模有关吗，","like_count":7,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464424,"discussion_content":"根据社区的报告，Kafka 1.1.0之后可以支持单集群20万个分区。和集群规模不能说没有关系，但其实和集群总的物理硬件资源有很大关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566781953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135799,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1569282880,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18749152064","product_id":100029201,"comment_content":"感觉离开平台自己真的什么都不是，公司内部的监控挺全的，单机的CPU&#47;硬盘&#47;内存&#47;网络&#47;jvm等都有，也有针对方法级别的性能&#47;可用率&#47;调用次数，针对MQ有流入&#47;流出&#47;积压等，这里的每个监控工具都有专门的团队来负责，分工比较细，现在想一想业务开发，如果对业务不精通真是没有什么存在感和价值的。<br>感觉监控最大的痛点是怎么获取到对应的监控信息，只要能获取监控信息，剩下的就是怎么聚合和汇总展示的问题了。","like_count":5,"discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544934,"discussion_content":"是的，业务部门基本都没有底层基础权限，你想做的都是别人可以做的事，别人不会把饭碗送给你","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641786514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127543,"user_name":"ykkk88","can_delete":false,"product_type":"c1","uid":1068585,"ip_address":"","ucode":"A1BCFC2F0D1022","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/29/1be3dd40.jpg","comment_is_top":false,"comment_ctime":1566739118,"is_pvip":false,"replies":[{"id":"47263","content":"我觉得Kafka Manager就挺不错的","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566780221,"ip_address":"","comment_id":127543,"utype":1}],"discussion_count":2,"race_medal":2,"score":"14451641006","product_id":100029201,"comment_content":"有什么好的开源的监控工具么 ","like_count":4,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464542,"discussion_content":"我觉得Kafka Manager就挺不错的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566780221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008176,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/30/a8df1a4e.jpg","nickname":"张亮","note":"","ucode":"06868525059967","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349593,"discussion_content":"https://github.com/didi/Logi-KafkaManager  强烈推荐体验下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613358013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127221,"user_name":"wxr","can_delete":false,"product_type":"c1","uid":1415450,"ip_address":"","ucode":"1DA03A580B25CD","user_header":"https://static001.geekbang.org/account/avatar/00/15/99/1a/53ed3004.jpg","comment_is_top":false,"comment_ctime":1566614131,"is_pvip":false,"replies":[{"id":"47283","content":"这个取决于你对消费延时的定义。从Kafka的角度，当poll方法返回后，消息已经算是被消费了，但通常我们获取到消息后还要对消息进行处理，如果你认为处理完成后才算是消费就要加上这部分的时间，但处理逻辑、工具、方法都不尽相同，因此你需要自己来监控消息处理的总时间。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566782052,"ip_address":"","comment_id":127221,"utype":1}],"discussion_count":6,"race_medal":0,"score":"14451516019","product_id":100029201,"comment_content":"怎样比较好的监控消费延时呢","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464383,"discussion_content":"这个取决于你对消费延时的定义。从Kafka的角度，当poll方法返回后，消息已经算是被消费了，但通常我们获取到消息后还要对消息进行处理，如果你认为处理完成后才算是消费就要加上这部分的时间，但处理逻辑、工具、方法都不尽相同，因此你需要自己来监控消息处理的总时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566782052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097577,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bf/69/dbfd10f7.jpg","nickname":"追光者","note":"","ucode":"B45B3C214219BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6595,"discussion_content":"大神，请问为什么我用 Metricbeat 监控 kafka 的时候启动 kafka 模块会提示：kafka/log.go:53 Connected to broker at 10.162.3.90:9092 (unregistered)，没有采集到的 kafka 的数据（这套集群也没有开启安全认证呀），下面是配置文件：\ngrep -vE &#34;^\\s*#|^$&#34; modules.d/kafka.yml\n- module: kafka\n  metricsets:\n    - partition\n    - consumergroup\n  period: 10s\n  hosts: [&#34;10.162.3.90:9092&#34;]\n  client_id: xl\n  retries: 3\n  backoff: 250ms\n还望不吝赐教，万分感激！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566986629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1588517,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJerY3WgO21tbWvSCZPicA8iboGxXIawtNk8hcQcicPLPVETgHkpe7GcUYN2DMKiaQial0p8Hk49TPEHEA/132","nickname":"Planet","note":"","ucode":"B76C2DDE853C42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6053,"discussion_content":"metricbeat可以监控kafka消费延时","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566640669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1097577,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bf/69/dbfd10f7.jpg","nickname":"追光者","note":"","ucode":"B45B3C214219BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1588517,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJerY3WgO21tbWvSCZPicA8iboGxXIawtNk8hcQcicPLPVETgHkpe7GcUYN2DMKiaQial0p8Hk49TPEHEA/132","nickname":"Planet","note":"","ucode":"B76C2DDE853C42","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6663,"discussion_content":"大神，请问为什么我用 Metricbeat 监控 kafka 的时候启动 kafka 模块会提示：kafka/log.go:53 Connected to broker at 10.162.3.90:9092 (unregistered)，没有采集到的 kafka 的数据（这套集群也没有开启安全认证呀），下面是配置文件：\ngrep -vE &#34;^\\s*#|^$&#34; modules.d/kafka.yml\n- module: kafka\n  metricsets:\n    - partition\n    - consumergroup\n  period: 10s\n  hosts: [&#34;10.162.3.90:9092&#34;]\n  client_id: xl\n  retries: 3\n  backoff: 250ms\n还望不吝赐教，万分感激！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567041708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6053,"ip_address":""},"score":6663,"extra":""},{"author":{"id":1588517,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJerY3WgO21tbWvSCZPicA8iboGxXIawtNk8hcQcicPLPVETgHkpe7GcUYN2DMKiaQial0p8Hk49TPEHEA/132","nickname":"Planet","note":"","ucode":"B76C2DDE853C42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1097577,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bf/69/dbfd10f7.jpg","nickname":"追光者","note":"","ucode":"B45B3C214219BB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":7087,"discussion_content":"看下kafka开启jmx没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567347223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6663,"ip_address":""},"score":7087,"extra":""}]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544935,"discussion_content":"burrow算是比较好的监控lag的工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641786550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187716,"user_name":"快跑","can_delete":false,"product_type":"c1","uid":1564645,"ip_address":"","ucode":"90ED7E6D40C58E","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg","comment_is_top":false,"comment_ctime":1584198535,"is_pvip":false,"replies":[{"id":"72594","content":"无法看出。不过你可以监控一下broker的磁盘IO，对于那些同步的consumer而言，磁盘IO读应该很少才对","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1584320949,"ip_address":"","comment_id":187716,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174133127","product_id":100029201,"comment_content":"请教老师一下<br>从监控上能看到读取kafka数据是从页缓存还是磁盘么，对应的指标有哪些？","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487209,"discussion_content":"无法看出。不过你可以监控一下broker的磁盘IO，对于那些同步的consumer而言，磁盘IO读应该很少才对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584320949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149223,"user_name":"frenco","can_delete":false,"product_type":"c1","uid":1718244,"ip_address":"","ucode":"CF894D1CC77252","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/W1qXe7yEB8C9fsossNLH59OrNBrEhxnibaMNfKro6YtKyL3thNN3AMyGyme2el0IgzwGpiaycFwwSvKLINITjhzA/132","comment_is_top":false,"comment_ctime":1573176682,"is_pvip":false,"replies":[{"id":"57423","content":"那就单台多broker吧，不过网卡最好万兆","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1573211892,"ip_address":"","comment_id":149223,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10163111274","product_id":100029201,"comment_content":"老师好， 请教个问题：    按您之前有个推荐的配置kafka内存的说法，一般堆内存配置6G就好了。 那新生代和老年代默认2：1  分配。      如果只需要6G的内存，  我们生产的机器一般都是64G以上内存， 那机器是不是有很大浪费呢。","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473783,"discussion_content":"那就单台多broker吧，不过网卡最好万兆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573211892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1094898,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b4/f2/b71d1a44.jpg","nickname":"王宇","note":"","ucode":"989FF6DCBAC63A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324672,"discussion_content":"kafka堆内存使用很小，大量的内存都是给操作系统缓存使用，充分利用页缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605150739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133851,"user_name":"Geek_72a3d3","can_delete":false,"product_type":"c1","uid":1622277,"ip_address":"","ucode":"586CCB1F0374A4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFrA5ztRGqQTFYIMoBVFgvlhH8GZOCj0K6QLhddcACsugr3BABZdWdSrNobhAWcuEb1W1vS2yicDg/132","comment_is_top":false,"comment_ctime":1568684173,"is_pvip":false,"replies":[{"id":"51424","content":"3个值的排序是过去1分钟，5分钟和15分钟，因此表明load越来越大","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1568767908,"ip_address":"","comment_id":133851,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10158618765","product_id":100029201,"comment_content":"“同时，Load 值一直在增加，也说明这台主机上的负载越来越大。”<br>老师，您好，Load值好像是越来越小。？？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467532,"discussion_content":"3个值的排序是过去1分钟，5分钟和15分钟，因此表明load越来越大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568767908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1035064,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cb/38/4c9cfdf4.jpg","nickname":"谢小路","note":"","ucode":"C9FE2EB10DC105","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310191,"discussion_content":"没懂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601685162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622277,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFrA5ztRGqQTFYIMoBVFgvlhH8GZOCj0K6QLhddcACsugr3BABZdWdSrNobhAWcuEb1W1vS2yicDg/132","nickname":"Geek_72a3d3","note":"","ucode":"586CCB1F0374A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14514,"discussion_content":"懂了😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568768818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1009000,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/68/93c05ab0.jpg","nickname":"laugh","note":"","ucode":"1CB29054325D1D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1622277,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFrA5ztRGqQTFYIMoBVFgvlhH8GZOCj0K6QLhddcACsugr3BABZdWdSrNobhAWcuEb1W1vS2yicDg/132","nickname":"Geek_72a3d3","note":"","ucode":"586CCB1F0374A4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282637,"discussion_content":"😆我也懂了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592034672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":14514,"ip_address":""},"score":282637,"extra":""}]}]},{"had_liked":false,"id":129284,"user_name":"谦寻","can_delete":false,"product_type":"c1","uid":1033639,"ip_address":"","ucode":"07160FAFAD08F7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/a7/e32dcfe7.jpg","comment_is_top":false,"comment_ctime":1567078801,"is_pvip":false,"replies":[{"id":"48161","content":"如果group不使用了，它的状态就是nonactive了，一段时间之后Kafka会自动删除的它数据。如果判断状态的话，新一点版本的Kafka可以使用kafka-consumer-groups --describe --group *** 来查看group状态。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567125568,"ip_address":"","comment_id":129284,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10157013393","product_id":100029201,"comment_content":"请教下老师，我们最近遇到一个监控问题，监控各个topic的消息堆积，发现如果业务方由于服务下线，不使用某个consume group了，结果这个group的消息堆积会一直增加，运维就会收到监控告警，但是运维并不好判断哪个group已经不使用了，这个能有什么自动化的手段吗","like_count":3,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465382,"discussion_content":"如果group不使用了，它的状态就是nonactive了，一段时间之后Kafka会自动删除的它数据。如果判断状态的话，新一点版本的Kafka可以使用kafka-consumer-groups --describe --group *** 来查看group状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567125568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544940,"discussion_content":"按老师的话就是旧版本的Kafka没法判定了是吗？那只能看lag大到某个程度了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641786670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127201,"user_name":"外星人","can_delete":false,"product_type":"c1","uid":1132861,"ip_address":"","ucode":"D8469B13F2AB37","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg","comment_is_top":false,"comment_ctime":1566609673,"is_pvip":false,"replies":[{"id":"47287","content":"如果性能okay而仅仅是你觉得不太好，那么我认为先不用拆分。单个topic最多能有多少partition没有定数，主要还是看底层物理资源。当然分区数过多，使得broker上平均分区数增加的确会降低Kafka的TPS。","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566782190,"ip_address":"","comment_id":127201,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10156544265","product_id":100029201,"comment_content":"你好，单个topic可以支撑的最多partition个数多少啊？我们生产上有个topic超级大，占了整个集群的一半以上的流量，这种情况是需要拆分吗？","like_count":2,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464373,"discussion_content":"如果性能okay而仅仅是你觉得不太好，那么我认为先不用拆分。单个topic最多能有多少partition没有定数，主要还是看底层物理资源。当然分区数过多，使得broker上平均分区数增加的确会降低Kafka的TPS。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566782190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263360,"user_name":"夏日","can_delete":false,"product_type":"c1","uid":1214167,"ip_address":"","ucode":"A5DBEB3E437728","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/d7/33d628b1.jpg","comment_is_top":false,"comment_ctime":1606115439,"is_pvip":false,"replies":[{"id":"95857","content":"通常ttl超过500ms就要关注下了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1606441134,"ip_address":"","comment_id":263360,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5901082735","product_id":100029201,"comment_content":"ttl一般多少以内比较正常，比如在考虑在双活中心搭建一套kafka集群的时候，怎么判断不会由于节点之间的传输延时导致kafka性能不高？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510162,"discussion_content":"通常ttl超过500ms就要关注下了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606441134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222123,"user_name":"胡小禾","can_delete":false,"product_type":"c1","uid":1132315,"ip_address":"","ucode":"1C23B7492C0C9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg","comment_is_top":false,"comment_ctime":1590680493,"is_pvip":false,"replies":[{"id":"81991","content":"目前Kafka的consumer group完全不使用ZooKeeper来保存元数据了，因此无论任何状态的group在ZK上都没有节点了","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1590750264,"ip_address":"","comment_id":222123,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5885647789","product_id":100029201,"comment_content":"“如果group不使用了，它的状态就是nonactive了”<br><br>这个nonactive 在ZK上是不是有节点？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496675,"discussion_content":"目前Kafka的consumer group完全不使用ZooKeeper来保存元数据了，因此无论任何状态的group在ZK上都没有节点了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590750264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129435,"user_name":"追光者","can_delete":false,"product_type":"c1","uid":1097577,"ip_address":"","ucode":"B45B3C214219BB","user_header":"https://static001.geekbang.org/account/avatar/00/10/bf/69/dbfd10f7.jpg","comment_is_top":false,"comment_ctime":1567128862,"is_pvip":true,"replies":[{"id":"48225","content":"这里都是IINFO日志看不出有什么问题，有其他日志吗？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1567133397,"ip_address":"","comment_id":129435,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5862096158","product_id":100029201,"comment_content":"老师，您好，想请教一个关于  Metricbeat 采集 kafka 数据的问题：<br>配置好 modules.d&#47;kafka.yml 启动 metricbeat 采集不到数据，提示信息：<br>2019-08-29T16:13:33.827+0800    INFO    kafka&#47;log.go:53 kafka message: Successful SASL handshake<br>2019-08-29T16:13:33.828+0800    INFO    kafka&#47;log.go:53 SASL authentication successful with broker 10.162.7.2:9092:4 - [0 0 0 0]<br>2019-08-29T16:13:33.828+0800    INFO    kafka&#47;log.go:53 Connected to broker at 10.162.7.2:9092 (unregistered)<br>2019-08-29T16:13:33.832+0800    INFO    kafka&#47;log.go:53 Closed connection to broker 10.162.7.2:9092<br>system 的可以采集到，请问这是什么原因呀<br>配置文件：<br>- module: kafka<br>metricsets:<br>- partition<br>- consumergroup<br>period: 10s<br>hosts: [&quot;10.162.3.90:9092&quot;]<br>client_id: xl<br>retries: 3<br>backoff: 250ms<br>topics: []<br>username: &quot;admin&quot;<br>password: &quot;admin&quot;","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465468,"discussion_content":"这里都是IINFO日志看不出有什么问题，有其他日志吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567133397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170970,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJFlHhylrbLANtehiaX50wgVa2Z1ibQAdLpgyW4gCpEyOKEI9bPNZZBiabrP2oCleZWc2KKyKADz8tg/132","nickname":"阿丽","note":"","ucode":"C01D32E7165302","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203421,"discussion_content":"看看系统日志/var/log/messages，如果metricbeat使用rpm或yum安装的话","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584027533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097577,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bf/69/dbfd10f7.jpg","nickname":"追光者","note":"","ucode":"B45B3C214219BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6842,"discussion_content":"没有，都是 INFO Connected to broker at 10.162.7.2:9092 (unregistered) 未注册","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567136419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322533,"user_name":"ahu0605","can_delete":false,"product_type":"c1","uid":1057150,"ip_address":"","ucode":"352BF972A369A7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI34ZlT6HSOtJBeTvTvfNLfYECDdJXnHCMj2BHdrRaqRLnZiafnxmKQ2aXoQkW1RLQOyt0tlyzEWIA/132","comment_is_top":false,"comment_ctime":1637471549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637471549","product_id":100029201,"comment_content":"胡老师，您对kafka部署k8s中有什么建议吗？","like_count":0},{"had_liked":false,"id":278806,"user_name":"张亮","can_delete":false,"product_type":"c1","uid":1008176,"ip_address":"","ucode":"06868525059967","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/30/a8df1a4e.jpg","comment_is_top":false,"comment_ctime":1613357898,"is_pvip":false,"replies":[{"id":"101514","content":"我觉得可行：）","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1613780725,"ip_address":"","comment_id":278806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613357898","product_id":100029201,"comment_content":"Kafka监控是一个非常专业和体系化的事情，Elasticearch基本将系统指标、JVM指标作为Metric上报出来自闭环非常方便实用，在开源Logi-KafkaManager的时候，我一直计划将这些指标通过JMX直接暴露出来，你怎么看？","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515508,"discussion_content":"我觉得可行：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613780725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278035,"user_name":"你为啥那么牛","can_delete":false,"product_type":"c1","uid":1503506,"ip_address":"","ucode":"1ABC604A54A8F6","user_header":"https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg","comment_is_top":false,"comment_ctime":1612711590,"is_pvip":false,"replies":[{"id":"101014","content":"过奖了~","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1612833141,"ip_address":"","comment_id":278035,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612711590","product_id":100029201,"comment_content":"这应该是最有水平的一篇文章了，经验值超高","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515260,"discussion_content":"过奖了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612833141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273241,"user_name":"谁谁","can_delete":false,"product_type":"c1","uid":1203114,"ip_address":"","ucode":"9651913B7B7ECC","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/aa/777d7f88.jpg","comment_is_top":false,"comment_ctime":1610505671,"is_pvip":false,"replies":[{"id":"99089","content":"这两个概念没有直接的关联吧","user_name":"作者回复","user_name_real":"胡夕","uid":"1288090","ctime":1610620767,"ip_address":"","comment_id":273241,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1610505671","product_id":100029201,"comment_content":"老师，tps不是应该包括ttl？从客户端发送请求到服务端处理完成返回，文中为什么说tps小而ttl大呢？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513535,"discussion_content":"这两个概念没有直接的关联吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610620767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164672,"user_name":"Rosy","can_delete":false,"product_type":"c1","uid":1757800,"ip_address":"","ucode":"74B015C848EA39","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d2/68/2149f518.jpg","comment_is_top":false,"comment_ctime":1577070184,"is_pvip":true,"replies":[{"id":"62875","content":"能详细解释下”删掉broker”的含义吗？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1577149279,"ip_address":"","comment_id":164672,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577070184","product_id":100029201,"comment_content":"kafka会频繁地删掉broker，导致频繁地切换leader，这是什么情况呢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478858,"discussion_content":"能详细解释下”删掉broker”的含义吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577149279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157233,"user_name":"风中花","can_delete":false,"product_type":"c1","uid":1085237,"ip_address":"","ucode":"067E0A1E116844","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/35/f1839bb2.jpg","comment_is_top":false,"comment_ctime":1575092235,"is_pvip":false,"replies":[{"id":"60317","content":"大数据Kafka技术分享","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1575112329,"ip_address":"","comment_id":157233,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575092235","product_id":100029201,"comment_content":"老师你的公众号怎么找到呢","like_count":1,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476370,"discussion_content":"大数据Kafka技术分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575112329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147180,"user_name":"皇甫","can_delete":false,"product_type":"c1","uid":1200408,"ip_address":"","ucode":"1624C5283C68DC","user_header":"https://static001.geekbang.org/account/avatar/00/12/51/18/0b0c105b.jpg","comment_is_top":false,"comment_ctime":1572833331,"is_pvip":false,"replies":[{"id":"56941","content":"不太清楚kafka manager API是怎么实现的。你可以用下jmxtool工具去实时监控下Kafka提供的JMX，看看是否有延迟呢？","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1572915887,"ip_address":"","comment_id":147180,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572833331","product_id":100029201,"comment_content":"老师，您好，最近遇到一个实践问题，通过调用kafka manage提供的api获取topic的流入消息数量，有时候有延时，在生产者流量激增的情况下，api不能及时返回消息流入数量，想问下这是什么原因，有啥解决办法吗？谢谢","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473182,"discussion_content":"不太清楚kafka manager API是怎么实现的。你可以用下jmxtool工具去实时监控下Kafka提供的JMX，看看是否有延迟呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572915887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128130,"user_name":"13761642169","can_delete":false,"product_type":"c1","uid":1232334,"ip_address":"","ucode":"68137695FC2120","user_header":"","comment_is_top":false,"comment_ctime":1566834212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566834212","product_id":100029201,"comment_content":"确实很经典","like_count":0},{"had_liked":false,"id":127340,"user_name":"丰富","can_delete":false,"product_type":"c1","uid":1017611,"ip_address":"","ucode":"8FF798DC1418C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/0b/6a4cf978.jpg","comment_is_top":false,"comment_ctime":1566657892,"is_pvip":false,"replies":[{"id":"47281","content":"不确定您指的支持是什么意思。Kafka有开源的Connect组件接收SNMP traps，但如果是指Kafka的请求协议的话，那么Kafka是自己设计的一套二进制协议，底层用TCP。没有用到SNMP","user_name":"作者回复","user_name_real":"huxi_2b","uid":"1288090","ctime":1566781851,"ip_address":"","comment_id":127340,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566657892","product_id":100029201,"comment_content":"请问老师，kafka支持snmp吗？","like_count":0,"discussions":[{"author":{"id":1288090,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a7/9a/495cb99a.jpg","nickname":"胡夕","note":"","ucode":"5709A689B6683B","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464450,"discussion_content":"不确定您指的支持是什么意思。Kafka有开源的Connect组件接收SNMP traps，但如果是指Kafka的请求协议的话，那么Kafka是自己设计的一套二进制协议，底层用TCP。没有用到SNMP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566781851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1017611,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/0b/6a4cf978.jpg","nickname":"丰富","note":"","ucode":"8FF798DC1418C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6202,"discussion_content":"主要还是指监控层面。很多软硬件系统都有公共和私有的mib库，通过snmp协议就能获取系统运行状态，所以想问问老师kafka是否也有这样的支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566784570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127274,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1566630293,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566630293","product_id":100029201,"comment_content":"老师总结得很好，跟着老师一起精进。","like_count":0}]}