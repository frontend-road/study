{"id":146949,"title":"57 | 函数式编程（2）","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":201620,"user_name":"小千","can_delete":false,"product_type":"c3","uid":1286065,"ip_address":"","ucode":"8A1274AD7B87F0","user_header":"https://static001.geekbang.org/account/avatar/00/13/9f/b1/ae61b184.jpg","comment_is_top":false,"comment_ctime":1585813278,"is_pvip":false,"replies":[{"id":79913,"content":"因为swift的限制，没有太优雅的实现方式。建议需要多线程的时候不要用这种方式访问数组","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1589165175,"ip_address":"","comment_id":201620,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"&#47;&#47; 有没有更简洁的实现方式？！\npublic class CustomArray&lt;Element&gt; {\n    let queue = DispatchQueue(label: &quot;com.xq.customarray&quot;, attributes: .concurrent)\n    var array: [Element]\n\n    init() {\n        array = [Element]()\n    }\n\n    init(_ ary: [Element]) {\n        array = ary\n    }\n}\n\nextension CustomArray {\n    var count: Int {\n        var result = 0\n        queue.sync {\n            result = self.array.count\n        }\n        return result\n    }\n\n    func filter(_ isIncluded: (Element) -&gt; Bool) -&gt; CustomArray&lt;Element&gt; {\n        var result = [Element]()\n        queue.sync {\n            result = self.array.filter(isIncluded)\n        }\n        return CustomArray(result)\n    }\n\n    func append(_ newElement: Element){\n        &#47;&#47;并发+异步写入（barrier机制）\n        queue.async(flags: .barrier) {\n            self.array.append(newElement)\n        }\n    }\n\n    func joined(separator: String = &quot;&quot;) -&gt; String {\n        var str = &quot;&quot;\n        queue.sync {\n            if let ary = array as? [String] {\n                str = ary.joined(separator: &quot;,&quot;)\n            }\n        }\n        return str\n    }\n\n    func map&lt;T&gt;(_ transform : @escaping (Element) -&gt; T) -&gt; CustomArray&lt;T&gt; {\n        let n = self.count\n        guard n &gt; 0 else { return CustomArray&lt;T&gt;() }\n\n        let result: CustomArray&lt;T&gt; = CustomArray&lt;T&gt;()\n        DispatchQueue.concurrentPerform(iterations: n) { (i) in\n            result.append(transform(array[i]))\n        }\n        return result\n    }\n}\n\nlet employee = [&quot;neal&quot;, &quot;s&quot;, &quot;stu&quot;, &quot;j&quot;, &quot;rich&quot;, &quot;bob&quot;, &quot;aiden&quot;, &quot;j&quot;, &quot;ethan&quot;, &quot;liam&quot;, &quot;mason&quot;, &quot;noah&quot;, &quot;lucas&quot;, &quot;jacob&quot;, &quot;jack&quot;]\nlet resultNames0 = employee.filter{ $0.count &gt; 1 }\n                  .map{ $0.capitalized }\n                  .joined(separator: &quot;,&quot;)\n\nlet resultNames1 = CustomArray(employee).filter { $0.count &gt; 1 }\n                    .map{ $0.capitalized }\n                    .joined(separator: &quot;,&quot;)\nprint(&quot;\\(resultNames0.count), \\(resultNames0)&quot;)\nprint(&quot;\\(resultNames1.count), \\(resultNames1)&quot;)","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490380,"discussion_content":"因为swift的限制，没有太优雅的实现方式。建议需要多线程的时候不要用这种方式访问数组","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589165175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185465,"user_name":"奋斗的小朱","can_delete":false,"product_type":"c3","uid":1628186,"ip_address":"","ucode":"EB98E73E7DC6C9","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/1a/cf7cf45d.jpg","comment_is_top":false,"comment_ctime":1583587560,"is_pvip":false,"replies":[{"id":79922,"content":"建议看一下《函数式编程思维》这本书","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1589165809,"ip_address":"","comment_id":185465,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"没有没比较全的高阶函数总结，map， filter， reduce，foreach等在哪里可以找到","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486369,"discussion_content":"建议看一下《函数式编程思维》这本书","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589165809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184172,"user_name":"Geek_zwip3b","can_delete":false,"product_type":"c3","uid":1198013,"ip_address":"","ucode":"7CA1651D0DE257","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/bd/3c88b41b.jpg","comment_is_top":false,"comment_ctime":1583243038,"is_pvip":false,"replies":[{"id":79924,"content":"有这个属性啊，你不是用了老版本的swift","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1589165925,"ip_address":"","comment_id":184172,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"capitalized 我这也没有，提示Value of type &#39;String&#39; has no member &#39;capitalized&#39;","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485917,"discussion_content":"有这个属性啊，你不是用了老版本的swift","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589165925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172030,"user_name":"jxdwinter","can_delete":false,"product_type":"c3","uid":1016874,"ip_address":"","ucode":"AC2F87226611BE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/2a/f92b8212.jpg","comment_is_top":false,"comment_ctime":1579074778,"is_pvip":false,"replies":[{"id":70504,"content":"capitalized应该是有的，代码贴一下？","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1582718092,"ip_address":"","comment_id":172030,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"Value of type &#39;String&#39; has no member &#39;capitalized&#39; 报错了，请问老师如何解决？","like_count":0,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481592,"discussion_content":"capitalized应该是有的，代码贴一下？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582718092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243399,"user_name":"Turing","can_delete":false,"product_type":"c3","uid":1458512,"ip_address":"","ucode":"C827B476D29AA0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRjPmr2NG3ibMRQeqWCmQnsrWdMAw9XhlRSEGrxgZiaKJ8MK0xFictiajtBvUuYM5pAUyiaqCEymtAypQ/132","comment_is_top":false,"comment_ctime":1598087762,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"和OC一样，对线程进行加锁，可进行安全访问，对吗","like_count":1},{"had_liked":false,"id":335208,"user_name":"FW.优秀","can_delete":false,"product_type":"c3","uid":1241193,"ip_address":"","ucode":"3662CFA6D5FC4A","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/69/1b892707.jpg","comment_is_top":false,"comment_ctime":1645407554,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"老师，有个问题，这里map、filter等会循序单词数组吗?这里的例子是不是会循序三次才计算出最后的结果？","like_count":0}]}