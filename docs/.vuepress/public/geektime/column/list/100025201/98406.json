{"id":98406,"title":"14 | IP 网络：连接世界的桥梁","content":"<p>你好，我是七牛云许式伟。</p><p>到目前为止，我们介绍了操作系统的六大子系统中的四项：进程、存储、输入、输出。当你理解了这些东西背后的道理，基本上做一款单机软件就游刃有余了。</p><p>但是，如果仅仅局限于单机，一台计算机并不见得比计算器高明太多，网络对整个信息科技的重要性不言而喻。它让计算机连接在了一起，这一连接就发生了巨大的变化。</p><p>没有了网络，我们只能用 Office 软件，玩玩扫雷。没有网络，就没有 QQ 和微信，不会有淘宝和支付宝，也不会有 BAT。</p><p>网络连接一切。它连接了人（个人和企业）、服务（由软件系统构建的服务接口）和物（大自然产物和智能终端），构建了多姿多彩的互联网。</p><p>它让地球上的任何两个人都可以随时随地进行沟通，远程做生意。在互联网出现之前，旧的商业文明我们可以一言以蔽之：一手交钱，一手交货。而建立在互联网之上的新商业文明，我们一手下单付款，一手收钱发货，足不出户，货物就通过便捷的物流服务送到了你手上。</p><p>这是多么巨大的效率变革，但这一切是怎么做到的呢？</p><h2>数据的封包过程</h2><p>网络和其他所有的输入输出设备一样，只能交换数据。无论你要对方做什么，你首先需要发送对方理解得了的数据给它。所以双方要就沟通的语言达成共识，这就是网络协议。</p><!-- [[[read_end]]] --><p>网络协议是计算机与计算机远程沟通的数据格式。它包含很多信息。这些信息不同部分的内容，有不同的职责，关心它的人也各有不同。</p><p>网络是传递数据的，是数字内容的物流。作为类比，我们可以看看实物快递的物流协议是什么样的。下面这张快递面单大家应该都很熟悉：</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/18/d2206dbdaf528ef1f1fcb26869b05018.png?wh=1920*1144\" alt=\"\"></p><p>这个快递面单包含很多内容，其中最重要的当然是寄件人信息和收件人信息。有了收件人信息，物流系统才能够知道怎么把要邮寄的物品进行一站站中转，并最终到达目的地。</p><p>有了寄件人信息，收件人收到信息才知道是谁寄过来的，如果回复的话应该邮寄往何方。而在物流过程如果出错的话，物流系统也知道如何与寄件人沟通协调错误的处置方法。</p><p>寄件人关心什么？他很可能关心物流订单号。这是他掌握物流状态的唯一凭据。另外，为了传输过程的便捷，物流系统可能还会给我们要邮寄的物品用信封袋或者包装箱进行封装。</p><p>所有这些寄件人信息、收件人信息、物流订单号、信封袋、包装箱，都不是寄件人要邮寄的内容，而是物流系统对物流协议所产生的需求。</p><p>为了支持整个物流系统的不间断运转，我们会有很多不同的部门。有负责最后一公里的快递员，也有负责骨干线路的航空运输部门，或者火车货运部门等等。</p><p>同样的，数字物流系统也有很多不同的部门，有的部门负责局域网（LAN）内最后一公里的，也有人负责广域网（WAN）骨干线路的运输的。网络协议作为数字物流的载体，会收到来自这些不同部门的需求。</p><p>我们平常可能经常听人提及，网络协议有 OSI 模型，它把网络协议分成了七层结构，从上到下分别是：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。但这样描述有点过于抽象，我们不妨用下图来理解网络协议的分层结构。</p><p><img src=\"https://static001.geekbang.org/resource/image/60/2a/6059e45af9f2ff757fa64df2ec48212a.png?wh=1920*737\" alt=\"\"></p><p>让我们设想：我们要传输一部电影，它就是我们的 “物品”，或者用技术术语叫 “应用层数据”，怎么传？</p><p><strong>第一步，分批次。</strong>数字物流系统单次能够传递的数据大小是有限的。如果数据太大，就必须分开多次来传输。从物理网络视角看，数据并不是流（stream），而是一个个大小有明确限制的数据包。</p><p><strong>第二步，套上信封，写好寄件单位的部门（源端口号）、收件单位的部门（目标端口号）、批次编号。</strong>为什么要写部门（端口号）？方便知道由谁（哪个应用程序软件）来负责收件。为什么要写批次编号？是为了防止寄丢了，寄丢了就得重新传一份该批次编号的东西。</p><p>这层我们叫传输层。它主要是为了解决传输可靠性的问题。当然传输层有两套协议（两种信封），一套是 TCP 协议，另一套是 UDP 协议。UDP 协议不保证对方一定收到，信封上就没写批次编号。</p><p><strong>第三步，再套上一层信封，上面写上寄件单位地址（源 IP 地址）、收件单位地址（目标 IP 地址）。</strong>有了地址，这封信在广域网（WAN）上流转，就知道自己应该去往何方了。这一层叫做网络层，它定义的信封格式，叫 IP 协议。</p><p>互联网的复杂性是在于，它不是一家数字物流公司的事。信寄到某处，可能就换一家物流公司了。它是所有的数字物流公司通力协作的结果。</p><p>所以 IP 协议最核心的意义是标准化，解决跨物流公司传输的问题。为什么我们要这样一层信封套一层信封？因为越往外层的信封，内容越和具体的物流公司相关。但无论你外层套的信封如何各有不同，拆到这一层，信的格式就是标准化的。</p><p><strong>第四步，再套上一层信封，这层我们叫它数据链路层。</strong>具体信封上写什么，完全是具体负责这段路程的物流公司说了算。当信件从一个物流公司转到另一个物流公司做交接的时候，这一层信封拆掉，重新换上新的信封。</p><p>数据链路层的信封格式（网络协议）非常多样化。局域网（LAN）现在最流行的是以太网（Ethernet）协议，广域网（WAN）现在常见的有 HDLC、PPP、Frame-Relay 等网络协议。</p><p>无论如何，写完了特定物流公司所需要的信息，信件就可以进入数字物流系统（物理层）去流转了。</p><h2>网络协议</h2><p>上面那一层套一层的信件（网络协议）放的是用户要邮寄的东西，比如一部电影。但为了支持整个邮寄过程的顺利进行，获得更好的用户体验，还会有一些辅助用途的信件（网络协议）在网络上传递，有的是面向用户的，有的是面向数字网络系统内部的。</p><p>完整来说，在整个数字物流系统中，与数据传输这件事本身有关的网络协议，我们整理如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/23/8d3d2147685359357e78c8715e5edf23.png?wh=1920*731\" alt=\"\"></p><p>在这个图中，链路层协议最为复杂，MAC+LLC、PPP、HDLC、Frame-Replay，这些是目前最为常见的。未来也必然会出来很多新的网络通讯技术，用的是全新的协议。链路层之上，IP -&gt; TCP/UDP，这些协议我们最为耳熟能详，上面我们也已经介绍过了。</p><p>其他都还有些什么？除了 ICMP 和 IGMP 协议，这些协议都和网络地址的解析有关。所以，在谈协议用途前，我们先聊一聊网络地址。</p><p>要通讯，首先要有地址。数字物流世界的地址有三层。最底下的是链路层地址。不同链路层协议的地址表示非常不同。</p><p>比如，局域网所采纳的以太网（Ethernet）协议用的是 MAC 地址。一台计算机有一个或多个网卡，每个网卡会有自己的唯一标识即 MAC 地址。这个标识跟随网卡设备存在，和网络环境无关。你把计算机从北京搬到上海，MAC 地址保持不变。</p><p>链路层的网络地址我们平常接触并不多，常规我们理解的网络地址是位于第二层的 IP 地址。</p><p>IP 地址类似于门牌号：你家住在哪个城市哪条路几号。它决定了网络路由怎么走，信息如何到达你的计算机网卡。IP 地址已经发展了两代，分别为 IPv4 和 IPv6。升级的原因是 IPv4 地址空间太小，只有 4G（即40多亿）个地址。</p><p>就像我们通常会更喜欢用 “我要去金茂大厦” 而不是 “我要去上海市浦东新区世纪大道88号” 一样，IP地址并不容易记忆，所以就有了第三层的网络地址：域名。</p><p>比如，我们会用 <a href=\"http://www.qiniu.com\">www.qiniu.com</a> 这个地址来找到七牛云的官网，而不是记住枯燥的 IP 地址。</p><p>理解了这三类网络地址，我们一一介绍下这些协议的用途。</p><p><strong>首先是 DNS 协议。</strong>这个协议就像是个地址簿，主要负责 “域名” =&gt; “IP地址” 的查询。每次我们要邮寄信件之前都要拿出来查一查。</p><p><strong>其次是 DHCP 协议。</strong>DHCP 全称叫动态主机配置协议（Dynamic Host Configuration Protocol），主要负责计算机接入网络时的初始化。计算机刚开始就只有网卡的 MAC 地址，通过 DHCP 可以给它分配 IP 地址，并得到默认网关地址（这很重要，不知道网关就上不了网）和 DNS 服务器的地址。有了这些东西，这台计算机就可以和外界通讯了。</p><p><strong>然后是 ARP 协议。</strong>ARP 全称叫地址解析协议（Address Resolution Protocol），它服务于现在局域网中最流行的以太网协议。在以太网中，ARP 协议负责解析远程主机 IP 地址对应的 MAC 地址。之所以需要 ARP 协议，是因为我们平常应用程序连接目标计算机进行网络通讯时，都是提供了域名或 IP 地址。但对以太网来说，要想发信件出去，它要的是对方的 MAC 地址。</p><p><strong>然后是 RARP 协议。</strong>RARP 全称叫反向地址转换协议（Reverse Address Resolution Protocol）。顾名思义，它和 ARP 协议相反，负责的是 MAC 地址到 IP 地址的转换。RARP 协议已经被上面的 DHCP 协议所取代，平常用不太到了。</p><p><strong>然后是 ICMP 协议。</strong>ICMP 全称叫互联网控制报文协议（Internet Control Message Protocol），它能够检测网路的连线状况，以保证连线的有效性。基于这个协议实现的常见程序有两个：ping 和 traceroute，它们可以用来判断和定位网络问题。</p><p><strong>最后是 IGMP 协议。</strong>IGMP 全称叫互联网组管理协议（Internet Group Management Protocol），它负责 IP 组播（Multicast）成员管理。本文略过这块的内容。</p><h2>数据传输过程</h2><p>了解了数据包的结构，也了解了数据传输相关的网络协议，接下来我们聊一聊数据传输的过程。为了方便理解，我们画了一幅数据传输的示意图：</p><p><img src=\"https://static001.geekbang.org/resource/image/b6/d5/b6dd426fa5fffa0c38b69118c20732d5.png?wh=1920*771\" alt=\"\"></p><p>简化理解来说，我们可以认为，在需要传输数据的源主机和目标主机之间，它们通过若干路由器或交换机连接。我们分以下几种情况来分析：</p><p><strong>情形一，源主机和目标主机在同一个局域网内，中间通过交换机连接，采用了最常见的以太网协议。</strong></p><p>通讯开始的时候，源主机只有目标主机的 IP 地址，并没有 MAC 地址。但以太网通讯要的是 MAC 地址，所以源主机会发起一个 ARP 请求去获得目标 IP 对应的 MAC 地址。</p><p>当然，源主机会缓存这个对应关系。第二次继续给相同 IP 发信息的时候，就不需要重新发起 ARP 请求了。</p><p>无论是 ARP 请求，还是普通的数据包，都会先到达交换机。ARP 是一个广播请求，所以交换机会转发给所有其他主机，目标主机发现这个 IP 地址是自己的，于是返回自己的 MAC 地址。</p><p>有了目标主机的 MAC 地址，源主机就可以发数据了。同样的，所有数据包都发给了交换机。</p><p>交换机是性能极高的网络数据交换设备。它通常工作在网络协议的第二层，也就是数据链路层。这一层只认 MAC 地址，不认 IP 地址。MAC 地址本身是个唯一身份标识，就像我们的身份证号，并没有可寻址的作用。那么交换机怎么做到这么高的数据传输的效率？</p><p>交换机在工作的过程中，会不断地收集资料去创建一个地址映射表：MAC 地址 =&gt; 交换机端口。这个表很简单，它记录了某个MAC 地址是在哪个端口上被发现的。</p><p>交换机收到一个数据包后，首先会进行学习，把源 MAC 地址和收到数据包的交换机端口对应起来。然后交换机查看数据包的目标 MAC 地址，并在地址映射表中找，如果找到对应的端口，那么就往这个端口转发数据包。</p><p>如果没找到，交换机可能会把这个数据包 “扩散” 出去，就好像收到广播数据包一样。这时如果目标主机收到广播过来的数据包后，回复了这个数据包，那么它的 MAC 地址和交换机端口的映射关系就也会被学习到。</p><p>当交换机初次加入网络时，由于地址映射表是空的，所以，所有的数据包将发往局域网内的全部端口，直到交换机 “学习” 到各个MAC 地址为止。这样看来，交换机刚刚启动时与传统的共享式集线器类似，直到地址映射表比较完整地建立起来后，它才真正发挥它的高性能。</p><p>我们总结一下，当一台交换机安装配置好之后，其工作过程如下。</p><ul>\n<li>收到某端口（设为A）MAC 地址为 X 的计算机发给 MAC 地址为 Y 的计算机的数据包。交换机从而记下了 MAC 地址 X 在端口 A。这称为学习（learning）。</li>\n<li>交换机还不知道 MAC 地址 Y 在哪个端口上，于是向除了 A 以外的所有端口转发该数据包。这称为泛洪（flooding）。</li>\n<li>MAC 地址 Y 的计算机收到该数据包，向 MAC 地址 X 发出确认包。交换机收到该包后，从而记录下 MAC 地址 Y 所在的端口。</li>\n<li>交换机向 MAC 地址 X 转发确认包。这称为转发（forwarding）。</li>\n<li>交换机收到一个数据包，查表后发现该数据包的来源地址与目的地址属于同一端口。交换机将不处理该数据包。这称为过滤（filtering）。</li>\n<li>交换机内部的 “MAC 地址 =&gt; 端口” 查询表的每条记录采用时间戳记录最后一次访问的时间。早于某个阈值（用户可配置）的记录被清除。这称为老化（aging）。</li>\n</ul><p><strong>情形二，源主机和目标主机都有公网 IP 地址，它们中间经过若干交换机和路由器相连。</strong></p><p>路由器和交换机不太一样，交换机因为没有门牌号，通讯基本靠吼。好的一点是，圈子比较小，吼上一段时间后，路都记住了，闭着眼睛都不会走错。</p><p>但广域网太大了，靠吼没几个人听得见。所以路由器工作在网络协议的第三层，也就是网络层。网络层看到的是 IP 协议，能够知道数据传输的源 IP 地址和目标 IP 地址。</p><p>有了 IP 地址，就相当于有了门牌号，开启导航按图索骥就可以把东西带过去了。这也是路由器为什么叫路由器的原因，它有导航（路由）功能，知道哪些目标 IP 地址的数据包应该往哪条路走的。</p><p>路由器可以拥有一部分交换机的能力，比如，如果发现请求是局域网内的话，也可以引入类似交换机那样的基于 MAC 地址的映射表实现高速通讯。但总体来说，路由器要考虑的问题复杂很多，因为涉及 “最佳路由路径” 的问题。</p><p>简单说，所谓 “最佳路由路径” 是指，到达目标主机的路有很多种可能性，我应该选择哪一条。大家在大学可能都学过带权的有向图，路由器面临的正是这种情况。而且情况可能更复杂的是，每一小段路径的权重都是动态的，因为网络状况一直在变。</p><p>如果你对路由算法感兴趣，可以在维基百科查找 “<a href=\"https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1\">路由</a>” ，进一步研究。</p><p>路由器除了解决路由问题，它往往还要解决异构网络的封包转换问题。作为局域网的接入方，它可能走的是固网或 WiFi 网络。</p><p>作为 Internet 的接入方，它可能走的是光纤宽带。所以它需要把局域网的数据链路层的封包解开并重组，以适应广域网数据链路协议的需求。</p><p>理解了以上两点，我们回到话题：广域网的两台具备公网 IP 的主机之间如何完成数据传输？</p><p>大体来说，整个过程如下。</p><ul>\n<li>首先，源主机发送的数据包，经由交换机（可选），到达本局域网的公网网关（路由器）。这个过程属于局域网内通讯，同情形一。</li>\n<li>路由器收到了数据包，发现目标主机是 Internet 上的某个远端的目标主机，于是对数据包进行拆包重组，形成新的数据包。</li>\n<li>循着自身的路由表，把这个新数据包层层转发，最后到达目标主机对应的公网网关（路由器）上。</li>\n<li>路由器发现是发给本局域网内的目标主机，于是再拆包重组，形成新的数据包。</li>\n<li>新数据包转到局域网内，经由交换机（可选），并最终到达目标主机。如此，整个数据传输过程就结束了。</li>\n</ul><p><strong>情形三，源主机和目标主机至少有一方在局域网内且只有私有 IP 地址，它们中间经过若干交换机和路由器相连。</strong></p><p>解释一下私有 IP 地址。在 IPv4 地址区间中，有一些区段，比如 10.0.0.0 ~ 10.255.255.255、172.16.0.0 ~ 172.31.255.255、192.168.0.0 ~ 192.168.255.255 ，这几个 IP 地址区间都是私有 IP 地址，只用于局域网内通讯。</p><p>常规来说，只有私有 IP 而没有公网 IP 的主机只能和局域网内的主机通讯，而无法和 Internet 上的其他主机相互通讯。</p><p>但这一点又和我们日常的感受不符：比如家庭用户往往网络结构是一个 WiFi 路由器连接公网，所有的家庭设备如手机、平板、笔记本，都以 WiFi 路由器为网关构成一个局域网。那么我们的这些设备是怎么上网的呢？</p><p>答案是 NAT（Network Address Translation，网络地址转换）技术。它的原理比较简单，假设我们现在源主机用的IP+端口为 iAddr:port1，经过 NAT 网关后，NAT 将源主机的 IP 换成自己的公网 IP，比如 eAddr，端口随机分配一个，比如 port2。</p><p>也就是从目标主机看来，这个数据包看起来是来自于 eAddr:port2。然后，目标主机把数据包回复到 eAddr:port2，NAT 网关再把它转发给 iAddr:port1。</p><p>也就是说，NAT 网关临时建立了一个双向的映射表 iAddr:port1 &lt;=&gt; eAddr:port2，一旦完成映射关系的建立，在映射关系删除前，eAddr:port2 就变成了 iAddr:port1 的 “替身”。这样，内网主机也就能够上网了。</p><p>NAT 网关并不一定是公网网关（路由器），它可以由局域网内任何一台有公网 IP 的主机担当。但显然如果公网网关担当 NAT 网关，链路的效率会高一点。</p><p>我们家用的 WiFi 路由器，就充当了 NAT 网关的作用，这也是我们能够上网的原因。</p><p>那么，最极端的情形，源主机和目标主机在不同的局域网内，且都没有公网 IP，它们是否可以通讯呢？</p><p>答案是不确定。</p><p>首先，在这种情况下，源主机和目标主机没法直接通讯，需要中间人去帮忙搭建通讯的链路。怎么做呢？找一个有公网 IP 的主机作为中间人服务器，目标主机向它发包，这样，在目标主机的 NAT 网关就形成了一对双向的映射表：</p><ul>\n<li>iDestAddr:portDest1 &lt;=&gt; eDestAddr:portDest2</li>\n</ul><p>然后，中间人服务器再把 eDestAddr:portDest2 告诉源主机。这样源主机就可以通过向 eDestAddr:portDest2 发送数据包来和目标主机 iDestAddr:portDest1 通讯了。</p><p>我们不少 P2P 软件就利用了这个技术实现 NAT 穿透，让两台不同内网的计算机相互能够直接通讯。</p><p>那么，答案为什么是不确定？因为上面这个机制只有在目标主机的 NAT 网关是 Full cone NAT，即一对一（one-to-one）NAT 网关时才成立。</p><p>什么是 Full cone NAT？它是指 NAT 网关临时建立了 iAddr:port1 &lt;=&gt; eAddr:port2 双向映射后，任何主机给 eAddr:port2 发送数据包，都会被转给 iAddr:port1，并不局限于构建这个映射时数据包发送的目标主机是谁。</p><p>但在其他类型的 NAT 网关下，一般都对回包的主机 IP 地址有约束。也就是说，NAT 网关形成的双向映射表是因为哪个目标主机建立的，那么回包也必须来自哪台主机。</p><p>这种情况下，中间人服务器就没办法来搭桥让它们直接通讯了，数据包需要由中间人服务器来中转。</p><h2>结语</h2><p>总结一下，今天我们介绍了数据封包过程、与 IP 数据包传输相关的网络协议，并对数据传输过程做了整体的描述。</p><p>我们主要介绍的重点是 IP 协议之下的网络工作过程。我们不讨论如何进行数据重传，更不关心数据到达应用层我们收到数据包后，如何去处理它们。</p><p>互联网背后的世界，和互联网一样精彩。精妙之处，值得细细体会。</p><p>如果你对今天的内容有什么思考与解读，欢迎给我留言，我们一起讨论。下一讲我们将进一步来探讨一下网络世界的编程接口。</p><p>如果你觉得有所收获，也欢迎把文章分享给你的朋友。感谢你的收听，我们下期再见。</p>","neighbors":{"left":{"article_title":"13 | 进程间的同步互斥、资源共享与通讯","id":97617},"right":{"article_title":"15 | 可编程的互联网世界","id":99184}},"comments":[{"had_liked":false,"id":99691,"user_name":"coder","can_delete":false,"product_type":"c1","uid":1399673,"ip_address":"","ucode":"929E3FFD14EFC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/5b/79/d55044ac.jpg","comment_is_top":false,"comment_ctime":1559280557,"is_pvip":false,"replies":[{"id":"35830","content":"分而治之的能力","user_name":"作者回复","comment_id":99691,"uid":"1228022","ip_address":"","utype":1,"ctime":1559302937,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":6,"race_medal":0,"score":"160473070509","product_id":100025201,"comment_content":"许老师觉得，从架构设计的角度去看，我们可以学到什么呢？","like_count":38,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452226,"discussion_content":"分而治之的能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559302937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1650748,"avatar":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","nickname":"盘胧","note":"","ucode":"5386CC4C92ECC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311456,"discussion_content":"好小子这个问题直接白嫖","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602342852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135528,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","nickname":"return","note":"","ucode":"42B8A3380DF04B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397421,"discussion_content":"封层 解藕 分治","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632619265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1283052,"avatar":"https://static001.geekbang.org/account/avatar/00/13/93/ec/985675c8.jpg","nickname":"小高","note":"","ucode":"FCD422249F7355","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386366,"discussion_content":"分而治之的能力。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627550974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2313071,"avatar":"https://static001.geekbang.org/account/avatar/00/23/4b/6f/50be543b.jpg","nickname":"景南鑫 Rock.J","note":"","ucode":"C611E784D391F5","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367855,"discussion_content":"我会提这些问题，网络是如何保证传输的可靠性，安全性呢？如果我是硬件商，我需要关注那些层，如果我是应用开发，我需要关注那些层？为什么后来的架构设计都提出硬件的不可靠，那么软件架构提出什么改进？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618486824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1230099,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c5/13/99baef26.jpg","nickname":"aiueo","note":"","ucode":"96100CD14AB501","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39405,"discussion_content":"分层架构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571922414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100623,"user_name":"kdb_reboot","can_delete":false,"product_type":"c1","uid":1003594,"ip_address":"","ucode":"4C56FCA563FCA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/4a/04fef27f.jpg","comment_is_top":false,"comment_ctime":1559607605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74574051637","product_id":100025201,"comment_content":"更新了 赞一下作者写作的态度","like_count":18},{"had_liked":false,"id":100436,"user_name":"kirajun","can_delete":false,"product_type":"c1","uid":1021380,"ip_address":"","ucode":"87B752E7E9A0E9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaXxkpSSZP2oWhPGYFJ9icGcfKt5kHNxLfdpFibNjIU8L3ky3MASMiaP6swkMePj9tcbG3A8ficlN1TQ/132","comment_is_top":false,"comment_ctime":1559555802,"is_pvip":false,"replies":[{"id":"36217","content":"是的，不过那样解释太复杂了，以简化模型介绍好一些。","user_name":"作者回复","comment_id":100436,"uid":"1228022","ip_address":"","utype":1,"ctime":1559571220,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":1,"race_medal":0,"score":"74573999834","product_id":100025201,"comment_content":"老许，现代的交换机和路由器的概念已经发生了变化了，不再是 L2&#47;L3 的差异了。个人理解，交换机是服务于以太网的 L2&#47;L3 网络设备，而路由器是服务于以太网和非以太网之间的网络设备。","like_count":18,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452548,"discussion_content":"是的，不过那样解释太复杂了，以简化模型介绍好一些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559571220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99520,"user_name":"82","can_delete":false,"product_type":"c1","uid":1494935,"ip_address":"","ucode":"C58365A8A3843D","user_header":"https://static001.geekbang.org/account/avatar/00/16/cf/97/fcd8957d.jpg","comment_is_top":false,"comment_ctime":1559234769,"is_pvip":true,"replies":[{"id":"35787","content":"1、mac地址用于验证，所以实际上是局域网唯一就好。不过生产时是保证全球唯一的。<br>2、老化（缓存过时）。<br>3、嗯，这个漏了没交代。<br>4、你说的没错，交换机模式对局域网比较有效，如果要访问的广域网地址比较多的情形，需要优化。","user_name":"作者回复","comment_id":99520,"uid":"1228022","ip_address":"","utype":1,"ctime":1559265880,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":3,"race_medal":0,"score":"53098842321","product_id":100025201,"comment_content":"老师好<br> 1，网络传递最根本是通过mac地址来投递的,所以mac地址必须全球唯一，那么在生产网卡时如何保证地址不重复？<br>2，交换机中缓存mac与端口的映射关系，那如果将设备从北京搬到上海，原有的交换设备缓存是否有问题，它是如何刷新映射关系的？<br>3，如何解释不同局域网ip可以重复的问题？<br>4，交换机是否会缓存所有路过他的映射关系，由于互联网链接巨多设备，那么每台交换机是否有最小内存限制？","like_count":12,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452149,"discussion_content":"1、mac地址用于验证，所以实际上是局域网唯一就好。不过生产时是保证全球唯一的。\n2、老化（缓存过时）。\n3、嗯，这个漏了没交代。\n4、你说的没错，交换机模式对局域网比较有效，如果要访问的广域网地址比较多的情形，需要优化。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559265880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572871,"discussion_content":"FYI\n问题3， 先理解啥是局域网，你就清楚了，简单说，就是到了局域网，你想怎么玩都行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653019890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572869,"discussion_content":"FYI\n还是分而治之。简单说，通过划分断，首先是生产网卡的厂家，分配不同的编号，然后厂家保证自己生产的网卡后面部分唯一。\n具体可以查询资料。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653019766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99619,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1559267447,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40213973111","product_id":100025201,"comment_content":"wan数据传输，ARP解析的是LAN路由器的mac地址，而不是目标主机的mac地址","like_count":8},{"had_liked":false,"id":103638,"user_name":"程序员小跃","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1560480184,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"35920218552","product_id":100025201,"comment_content":"大学的计算机网络和这个比起来，这个详细多了。比如那个七层网络协议，5层网络协议，以前都是死记硬背的。我可能是个假科班出身","like_count":9},{"had_liked":false,"id":100156,"user_name":"hua168","can_delete":false,"product_type":"c1","uid":1065255,"ip_address":"","ucode":"CFF9A7E86EBA48","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg","comment_is_top":false,"comment_ctime":1559463269,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31624234341","product_id":100025201,"comment_content":"CCNA的内容，鉴定完毕","like_count":7},{"had_liked":false,"id":100183,"user_name":"Geek_gooy","can_delete":false,"product_type":"c1","uid":1504570,"ip_address":"","ucode":"FC168C31530040","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLluwfFjxlCmg9p2rJVicBdBo6OYpN0EAotUguias8wc78WtAEPHsWic0880CqGwyNypy2KZqVpYhGiag/132","comment_is_top":false,"comment_ctime":1559470723,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27329274499","product_id":100025201,"comment_content":"想一种办法来消化网络通讯。<br>两台电脑用网线直连，相当于在一起的两个人直接交流，不用叫名字(无mac)也能沟通。<br>村子里的两个人交流，告诉村子里的某个负责传话的人，说姓名就行(有mac)，不用地址(无ip)。<br>要联系村以外的人，得用地址和姓名(有mac有ip)。<br>","like_count":6},{"had_liked":false,"id":216553,"user_name":"王棕生","can_delete":false,"product_type":"c1","uid":1337944,"ip_address":"","ucode":"901BD0447A871E","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/58/f2c6d65b.jpg","comment_is_top":false,"comment_ctime":1589282484,"is_pvip":false,"replies":[{"id":"80186","content":"中间人通过自己的 mAddr:mport 向NAT网关请求访问 eAddr:port2，NAT 通过自己的 iAddr:port1 向 mAddr:mport 回复信息。这样中间人就记录到了 iAddr:port1 &lt;=&gt; eAddr:port2 这个地址对。但是实际上 NAT 网关除了形成这个地址对外，还可以记录下 mAddr:mport。如果下次请求来源不是它，说明中间人将地址对告诉了别人，别人发来的数据。NAT 网关如果选择支持它，那就是 Full cone NAT，还有一个选择是它只认中间人，即构建这个地址对的来源地址，那么中间人就无法作为中间人了。","user_name":"作者回复","comment_id":216553,"uid":"1228022","ip_address":"","utype":1,"ctime":1589334799,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":2,"race_medal":0,"score":"23064118964","product_id":100025201,"comment_content":"什么是 Full cone NAT？它是指 NAT 网关临时建立了 iAddr:port1 &lt;=&gt; eAddr:port2 双向映射后，任何主机给 eAddr:port2 发送数据包，都会被转给 iAddr:port1，并不局限于构建这个映射时数据包发送的目标主机是谁。<br>许老师，这段文字中【并不局限于构建这个映射时数据包发送的目标主机是谁】这句话不是很明白，既然 iAddr:port1 确定了，目标主机肯定就是确定的了","like_count":5,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494860,"discussion_content":"中间人通过自己的 mAddr:mport 向NAT网关请求访问 eAddr:port2，NAT 通过自己的 iAddr:port1 向 mAddr:mport 回复信息。这样中间人就记录到了 iAddr:port1 &amp;lt;=&amp;gt; eAddr:port2 这个地址对。但是实际上 NAT 网关除了形成这个地址对外，还可以记录下 mAddr:mport。如果下次请求来源不是它，说明中间人将地址对告诉了别人，别人发来的数据。NAT 网关如果选择支持它，那就是 Full cone NAT，还有一个选择是它只认中间人，即构建这个地址对的来源地址，那么中间人就无法作为中间人了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589334799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1515149,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/8d/5b242931.jpg","nickname":"Fish","note":"","ucode":"C20719F8B0F7C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339526,"discussion_content":"不大明白中间人怎么知道NAT网关地址的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609721768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99706,"user_name":"M.K","can_delete":false,"product_type":"c1","uid":1496595,"ip_address":"","ucode":"5BBDA69256938D","user_header":"https://static001.geekbang.org/account/avatar/00/16/d6/13/d365cecb.jpg","comment_is_top":false,"comment_ctime":1559283145,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23034119625","product_id":100025201,"comment_content":"很清楚的从架构的角度诠释了网络分层的意义，以及从宏观角度介绍了每一层的职责。前人智慧的结晶在我们做框架设计时，非常有参考价值。","like_count":5},{"had_liked":false,"id":101102,"user_name":"马哲富","can_delete":false,"product_type":"c1","uid":1107917,"ip_address":"","ucode":"D6BDDFE3CC07ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/cd/08088f14.jpg","comment_is_top":false,"comment_ctime":1559718403,"is_pvip":false,"replies":[{"id":"36466","content":"端口就是交换机上的插槽，一个端口往往连接一台或多台计算机","user_name":"作者回复","comment_id":101102,"uid":"1228022","ip_address":"","utype":1,"ctime":1559744842,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":3,"race_medal":0,"score":"18739587587","product_id":100025201,"comment_content":"文中所指的“端口”可以理解为“一台物理的计算机”吗?","like_count":4,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452805,"discussion_content":"端口就是交换机上的插槽，一个端口往往连接一台或多台计算机","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559744842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2034286,"avatar":"","nickname":"一生学习","note":"","ucode":"693E9DAF5D6CC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288088,"discussion_content":"如果一个端口上连接了多台计算机，那么交换机只管往这个端口转发，最后怎么保证只有目标计算机收到结果？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593649762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276613,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","nickname":"大头爸爸","note":"","ucode":"131E25DB04D222","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240514,"discussion_content":"NAT的端口和TCP的端口是一回事吗?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587370446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99827,"user_name":"ljf10000","can_delete":false,"product_type":"c1","uid":1494064,"ip_address":"","ucode":"44957329A61EAE","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQ5wib49kcMPqCTRT1aThh6mMAVl6qseLwbVOLhicVLjZCxCoyQd5CrrHHibs2CVPaoK3g/132","comment_is_top":false,"comment_ctime":1559313349,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18739182533","product_id":100025201,"comment_content":"arp是用于查下一跳的mac地址，不是查目的ip的mac地址。","like_count":4},{"had_liked":false,"id":105870,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1561096881,"is_pvip":false,"replies":[{"id":"38289","content":"什么地方觉得需要补充？","user_name":"作者回复","comment_id":105870,"uid":"1228022","ip_address":"","utype":1,"ctime":1561099315,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":1,"race_medal":0,"score":"14445998769","product_id":100025201,"comment_content":"请收下我的膝盖。如果不是看完趣谈网络协议。这一章我怕是完全看不懂。","like_count":3,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454845,"discussion_content":"什么地方觉得需要补充？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561099315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100774,"user_name":"ljf10000","can_delete":false,"product_type":"c1","uid":1494064,"ip_address":"","ucode":"44957329A61EAE","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQ5wib49kcMPqCTRT1aThh6mMAVl6qseLwbVOLhicVLjZCxCoyQd5CrrHHibs2CVPaoK3g/132","comment_is_top":false,"comment_ctime":1559636164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14444538052","product_id":100025201,"comment_content":"网络是个大而复杂的领域，我们能在这里面学到思维的主要是分治，水平分，垂直分。建议无需多讲，感兴趣去看tcpip详解即可。","like_count":3},{"had_liked":false,"id":180326,"user_name":"小豆角","can_delete":false,"product_type":"c1","uid":1187321,"ip_address":"","ucode":"93FBADEB249C46","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tuvQ44WvwibibVoAdUSia3EdXP4fR3nyJUhLWUmVxl3jibMuVb8uZViaRsy5nAyzicBN06VA/132","comment_is_top":false,"comment_ctime":1582257104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10172191696","product_id":100025201,"comment_content":"非常赞，干货，许总功底深厚。同时买了几个课，看了开头之后，就对这个课爱不释手了，最值的。","like_count":2},{"had_liked":false,"id":101503,"user_name":"Geek_88604f","can_delete":false,"product_type":"c1","uid":1501234,"ip_address":"","ucode":"33DD1318E53814","user_header":"","comment_is_top":false,"comment_ctime":1559831224,"is_pvip":false,"replies":[{"id":"36588","content":"可以的，有NAT网关","user_name":"作者回复","comment_id":101503,"uid":"1228022","ip_address":"","utype":1,"ctime":1559854821,"user_name_real":"许式伟-七牛云(已满)"}],"discussion_count":1,"race_medal":0,"score":"10149765816","product_id":100025201,"comment_content":"源主机和目标主机在不同的局域网内，且都没有公网 IP。在这种情况下，他们也无法发送数据到中间人服务器","like_count":2,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452991,"discussion_content":"可以的，有NAT网关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559854821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100526,"user_name":"Sylh","can_delete":false,"product_type":"c1","uid":1147961,"ip_address":"","ucode":"F6B87D15A9AF95","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIicbH65wBhSCWa5eBF4gFaia5ngkttTzprdicJaDcOMgwAYrFbpQfJ0z6OichE6qphpicqsq87Lam0X5A/132","comment_is_top":false,"comment_ctime":1559571173,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10149505765","product_id":100025201,"comment_content":"公网传输一样也会依赖mac地址的，比如两个路由器之间的转发。隧道之类的可能不依赖mac地址","like_count":2},{"had_liked":false,"id":99829,"user_name":"sunsweet","can_delete":false,"product_type":"c1","uid":1027879,"ip_address":"","ucode":"787F9E1EC6A67E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/27/76489618.jpg","comment_is_top":false,"comment_ctime":1559315594,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10149250186","product_id":100025201,"comment_content":"保证Mac地址全球唯一，我的老师说过，各个网卡厂商都有自己固定的几位，在Mac地址上，厂商只要保证剩余那些位不重复就好了","like_count":2,"discussions":[{"author":{"id":1001400,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/b8/6edbbe13.jpg","nickname":"宋志","note":"","ucode":"3353ACA1F7B2BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4727,"discussion_content":"我们老师也说过，但好像被误导了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565689388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99719,"user_name":"stern","can_delete":false,"product_type":"c1","uid":1501057,"ip_address":"","ucode":"3120A647C6B6AD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKx6EdicYYuYKibnUiajL1ba1cmzXpK6RmvAoIX4mTgdzVELf6Ljzk2chQIBhk37xRuOAnAwtOjkaRMA/132","comment_is_top":false,"comment_ctime":1559284371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10149218963","product_id":100025201,"comment_content":"源主机和目标主机不在同一个局域网内，源主机的信息：IP:192.168.0.1&#47;MAC:C01，源主机所在网络路由器信息：IP:10.20.12.2&#47;MAC:R01，目标主机的信息：IP:192.168.0.1&#47;MAC:C02，目标主机所在网络路由器信息：IP:20.20.16.2&#47;MAC:R02，源主机往目标主机发送数据，数据包中源IP、目标IP、源MAC地址、目标MAC地址的变化是什么样子的？","like_count":2},{"had_liked":false,"id":99572,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1559261738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10149196330","product_id":100025201,"comment_content":"说的明明白白了，也听的明明白白。谢谢老师","like_count":2},{"had_liked":false,"id":216554,"user_name":"王棕生","can_delete":false,"product_type":"c1","uid":1337944,"ip_address":"","ucode":"901BD0447A871E","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/58/f2c6d65b.jpg","comment_is_top":false,"comment_ctime":1589282669,"is_pvip":false,"replies":[{"id":"80187","content":"这是另外一个完全不同的目的。如果是基于提供公网服务的目的，是不需要 NAT 网关的，一般是用应用网关作为入口的负载均衡器。后续服务端那一章会涉及。","user_name":"作者回复","user_name_real":"许式伟-七牛云(已满)","uid":"1228022","ctime":1589335125,"ip_address":"","comment_id":216554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884249965","product_id":100025201,"comment_content":"非 Full one NAT 场景下，我觉得 NAT网关可以对应该局域网中的多个目标主机，也就是，这些目标主机虽然没有公网IP，但可以通过 非 Full one NAT对外提供多个公网的服务。<br>麻烦许老师点评一下！","like_count":1,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494861,"discussion_content":"这是另外一个完全不同的目的。如果是基于提供公网服务的目的，是不需要 NAT 网关的，一般是用应用网关作为入口的负载均衡器。后续服务端那一章会涉及。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589335125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101976,"user_name":"瀚海星尘","can_delete":false,"product_type":"c1","uid":1024461,"ip_address":"","ucode":"90F418299EA3BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/cd/2c513481.jpg","comment_is_top":false,"comment_ctime":1560080755,"is_pvip":false,"replies":[{"id":"36765","content":"此端口非tcp中的port","user_name":"作者回复","user_name_real":"许式伟-七牛云(已满)","uid":"1228022","ctime":1560089160,"ip_address":"","comment_id":101976,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5855048051","product_id":100025201,"comment_content":"老师，如果路由器能通过端口来做内网转发，那为什么一般都说它是网络层设备？不是应该是传输层设备了吗？","like_count":1,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453198,"discussion_content":"此端口非tcp中的port","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560089160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276613,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132","nickname":"大头爸爸","note":"","ucode":"131E25DB04D222","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240519,"discussion_content":"NAT里面的端口是不是TCP中的port?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587370824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001400,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/b8/6edbbe13.jpg","nickname":"宋志","note":"","ucode":"3353ACA1F7B2BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4726,"discussion_content":"可以说明一下8/16/24口 交换机中的端口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565689200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101119,"user_name":"zzx10","can_delete":false,"product_type":"c1","uid":1317201,"ip_address":"","ucode":"4196E9EADAF60B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWTnR1vgM3f7matwO0VvXQfA1nkgfS7PWiaYIa9h9NbuUUxQSO4KPDqPopSZiarBxFHIdwFDeG0kQg/132","comment_is_top":false,"comment_ctime":1559720804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854688100","product_id":100025201,"comment_content":"好长一篇,内容很充实，基础太差没法一口气看完。mac-&gt;ip-&gt;域名，中间有各种协议转换，通过交换机和路由传输，找寻目标主机通信。","like_count":1},{"had_liked":false,"id":99575,"user_name":"pawhrmyki","can_delete":false,"product_type":"c1","uid":1480332,"ip_address":"","ucode":"CDCF44F2E43937","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ermRibwXSt1icBvH3IO1JfiaqakIcxxAP4zSkicewogKVWCFicb0NVc7tF3xSVMJwE3lBg2gH4r7u6sGtw/132","comment_is_top":false,"comment_ctime":1559261896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854229192","product_id":100025201,"comment_content":"太好了，终于把基本的广域网和局域网之前的数据交换模式厘清了","like_count":1},{"had_liked":false,"id":99573,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1559261767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854229063","product_id":100025201,"comment_content":"打卡04 学习了","like_count":1},{"had_liked":false,"id":99535,"user_name":"在记录美好","can_delete":false,"product_type":"c1","uid":1461446,"ip_address":"","ucode":"72A936E3DB603C","user_header":"https://static001.geekbang.org/account/avatar/00/16/4c/c6/99e6f5ae.jpg","comment_is_top":false,"comment_ctime":1559255470,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854222766","product_id":100025201,"comment_content":"谢谢许老师的分享","like_count":1},{"had_liked":false,"id":346323,"user_name":"William Ning","can_delete":false,"product_type":"c1","uid":1592279,"ip_address":"","ucode":"4DB8D05E69E5F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","comment_is_top":false,"comment_ctime":1653025682,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653025682","product_id":100025201,"comment_content":"关于这几种场景，看了之后，有点懵，特使是“情形三，源主机和目标主机至少有一方在局域网内且只有私有 IP 地址，它们中间经过若干交换机和路由器相连。”<br>那么，最极端的情形，源主机和目标主机在不同的局域网内，且都没有公网 IP，它们是否可以通讯呢？<br>以及&quot;找一个有公网 IP 的主机作为中间人服务器，目标主机向它发包，这样，在目标主机的 NAT 网关就形成了一对双向的映射表：&quot;, &quot; Full cone NAT&quot;<br><br>这里老师应该配个图，说明个人认为会更好一些～<br>","like_count":0},{"had_liked":false,"id":331927,"user_name":"xfly","can_delete":false,"product_type":"c1","uid":1193153,"ip_address":"","ucode":"215CF53ECF2298","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/c1/255161c9.jpg","comment_is_top":false,"comment_ctime":1642903457,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642903457","product_id":100025201,"comment_content":"现在的 5G 蓝牙 WiFi 都算是数据链路层了","like_count":0},{"had_liked":false,"id":324246,"user_name":"小灰","can_delete":false,"product_type":"c1","uid":1130729,"ip_address":"","ucode":"1AB4E3AEDEE7FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/e9/29dfa621.jpg","comment_is_top":false,"comment_ctime":1638347716,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1638347716","product_id":100025201,"comment_content":"看老板写的文章都要看好几遍，如果有个动画的效果图就更好了","like_count":0},{"had_liked":false,"id":286244,"user_name":"不温暖啊不纯良","can_delete":false,"product_type":"c1","uid":2079117,"ip_address":"","ucode":"204474A214E00C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/b9/8d/00bded19.jpg","comment_is_top":false,"comment_ctime":1617206114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617206114","product_id":100025201,"comment_content":"以前总觉得上网就是在网上把消息发来发去，完全不会考虑网络的基础设施，今天才知道一个数据，要想从北京跑到上海，先要经历各种协议的封装，然后发到交换机那里，然后把数据包发到路由器那里，路由器为了能在公网里面传送数据，不得不把局域网里的协议包装拆了，然后重新包装一次，等到了对方的路由器那里，为了能让自己的局域网里的计算机，解析和识别数据包，又拆了重新用局域网的协议包装一遍，一直到目标端口那里，这个数据包经历了包包拆拆。长见识了","like_count":0},{"had_liked":false,"id":256168,"user_name":"小炭","can_delete":false,"product_type":"c1","uid":1109544,"ip_address":"","ucode":"E20E3958CAF06C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ee/28/c04a0c83.jpg","comment_is_top":false,"comment_ctime":1603544802,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603544802","product_id":100025201,"comment_content":"网线是怎么来的，是不是电报、电话演进过来的。","like_count":0},{"had_liked":false,"id":179622,"user_name":"幻灰龙","can_delete":false,"product_type":"c1","uid":1046202,"ip_address":"","ucode":"AFEDCC997C2FF6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/ba/09ab72d2.jpg","comment_is_top":false,"comment_ctime":1582040765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582040765","product_id":100025201,"comment_content":"套娃和NAT，最开始的时候，我以为越上层的协议，头部是在外层套呢，可实际上解析是从最底层开始的，所以协议的头部是反向内部嵌套的，所谓上层协议，其实应该叫内层协议。包头和包体这种解析方式，其实就是模式匹配。相比于正则表达式这种还会回朔匹配的来说，其实简单很多了。对于NAT，比较有意思的是打洞，有一个场景可以想象一下，小区里面的人要出来，就会开门，一旦开门外面的人就可以没卡也可以进来。","like_count":0},{"had_liked":false,"id":167113,"user_name":"Geek007","can_delete":false,"product_type":"c1","uid":1510530,"ip_address":"","ucode":"53BF2BC4187DE4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDOKcx20XxmrRrLkelN8yAsBk0ZcuremVN7lZp4U2kdABFULtEVmCgaFlJLh1TYia0kicPbvxeZQNg/132","comment_is_top":false,"comment_ctime":1577693640,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577693640","product_id":100025201,"comment_content":"第一次看到把网络协议和物流协议类比，精彩！","like_count":0},{"had_liked":false,"id":165593,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1053498,"ip_address":"","ucode":"59752A51A382A6","user_header":"https://static001.geekbang.org/account/avatar/00/10/13/3a/b0454322.jpg","comment_is_top":false,"comment_ctime":1577265986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577265986","product_id":100025201,"comment_content":"👍 对于没有背景的人可能负责一些，对于有一定背景的，就是言简意赅的浓缩精华，真的不错","like_count":0},{"had_liked":false,"id":152371,"user_name":"码农Kevin亮","can_delete":false,"product_type":"c1","uid":1116630,"ip_address":"","ucode":"D34562461CA0A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/d6/5f366427.jpg","comment_is_top":false,"comment_ctime":1573985026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573985026","product_id":100025201,"comment_content":"请问老师，目前的ipv4地址与ipv6地址相差很远，那么是不是意味着当前ip的报文已经不能用？从架构设计的角度看，该如何做适配呢？以及怎么判断哪些是ipv4哪些是ipv6呢","like_count":0},{"had_liked":false,"id":144910,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1572090216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572090216","product_id":100025201,"comment_content":"网络确实重要，但真没必要把单机说的啥都不是，只能扫雷。<br>像星际争霸，暗黑   是计算器可以比的？？？？","like_count":0},{"had_liked":false,"id":119061,"user_name":"坤","can_delete":false,"product_type":"c1","uid":1010922,"ip_address":"","ucode":"74E6838226A405","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/ea/ce9854a5.jpg","comment_is_top":false,"comment_ctime":1564495040,"is_pvip":false,"replies":[{"id":"43648","content":"看情况，共享ip也是有可能的","user_name":"作者回复","user_name_real":"许式伟-七牛云(已满)","uid":"1228022","ctime":1564503414,"ip_address":"","comment_id":119061,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1564495040","product_id":100025201,"comment_content":"小区宽带一般会给每户提供一个私有IP，即WAN口的IP地址，请问是这样的吗？","like_count":0,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460732,"discussion_content":"看情况，共享ip也是有可能的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564503414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135566,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/ce/04ad2449.jpg","nickname":"#^_^#","note":"","ucode":"804481AC41E564","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251920,"discussion_content":"共享 IP 岂不是运营商在小区建了个局域网","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588126086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112679,"user_name":"的","can_delete":false,"product_type":"c1","uid":1088532,"ip_address":"","ucode":"7E29F5C7C66077","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/14/5ba772f2.jpg","comment_is_top":false,"comment_ctime":1562806154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562806154","product_id":100025201,"comment_content":"老师面试会问这些问题吗？","like_count":0},{"had_liked":false,"id":111908,"user_name":"秋天","can_delete":false,"product_type":"c1","uid":1057056,"ip_address":"","ucode":"A7E1D953EF7E17","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg","comment_is_top":false,"comment_ctime":1562636000,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562636000","product_id":100025201,"comment_content":"对网络知识 有加深了一层理解  分而治之  分层设计 分工协作 ","like_count":0},{"had_liked":false,"id":108937,"user_name":"小虾米","can_delete":false,"product_type":"c1","uid":1005528,"ip_address":"","ucode":"F543987A7FAB20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg","comment_is_top":false,"comment_ctime":1561940066,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561940066","product_id":100025201,"comment_content":"我觉得老师的比喻非常好，通俗易懂，超赞👍","like_count":0},{"had_liked":false,"id":105401,"user_name":"skye","can_delete":false,"product_type":"c1","uid":1027840,"ip_address":"","ucode":"C55C9F52C78A00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","comment_is_top":false,"comment_ctime":1560992959,"is_pvip":false,"replies":[{"id":"38142","content":"主要是做数据链路层的协议转换","user_name":"作者回复","user_name_real":"许式伟-七牛云(已满)","uid":"1228022","ctime":1560996431,"ip_address":"","comment_id":105401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560992959","product_id":100025201,"comment_content":"老师好！情形二下，公网ip发的包到路由器后为什么还要拆包重组，拆包重组是干什么？","like_count":0,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454668,"discussion_content":"主要是做数据链路层的协议转换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560996431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104209,"user_name":"北方的雪","can_delete":false,"product_type":"c1","uid":1495787,"ip_address":"","ucode":"5DA6D1B6743B7B","user_header":"https://static001.geekbang.org/account/avatar/00/16/d2/eb/a3b89f22.jpg","comment_is_top":false,"comment_ctime":1560681766,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560681766","product_id":100025201,"comment_content":"感觉需求的时候不用进行单词的字母拼读吧，感觉好傻，上这个课的人都有相应的基础吧","like_count":0},{"had_liked":false,"id":103166,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1560389711,"is_pvip":false,"replies":[{"id":"37326","content":"是通过老化机制发现的，不是通过交换机重试","user_name":"作者回复","user_name_real":"许式伟-七牛云(已满)","uid":"1228022","ctime":1560395200,"ip_address":"","comment_id":103166,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560389711","product_id":100025201,"comment_content":"情形一下若发包过程中目标机端口变了，交换机仍按原端口发的话，如何发现发送失败？若能发现失败，是否又要全员广播重新获取新的端口？","like_count":0,"discussions":[{"author":{"id":1228022,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/f6/e61d4b8f.jpg","nickname":"许式伟-七牛云(已满)","note":"","ucode":"1A2F8AA6F6DB54","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453766,"discussion_content":"是通过老化机制发现的，不是通过交换机重试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560395200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102432,"user_name":"苟范儿","can_delete":false,"product_type":"c1","uid":1364883,"ip_address":"","ucode":"B06B86765512FA","user_header":"https://static001.geekbang.org/account/avatar/00/14/d3/93/bef5a186.jpg","comment_is_top":false,"comment_ctime":1560220318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560220318","product_id":100025201,"comment_content":"感谢老师～","like_count":0},{"had_liked":false,"id":102287,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1560176932,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560176932","product_id":100025201,"comment_content":"互联网的基石 TCP IP","like_count":0},{"had_liked":false,"id":101931,"user_name":"Thomas","can_delete":false,"product_type":"c1","uid":1178585,"ip_address":"","ucode":"36950010DB3D29","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/d9/055e5383.jpg","comment_is_top":false,"comment_ctime":1560059950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560059950","product_id":100025201,"comment_content":"很不错。","like_count":0},{"had_liked":false,"id":101457,"user_name":"东次哒呲","can_delete":false,"product_type":"c1","uid":1500925,"ip_address":"","ucode":"19B6506C9E86AE","user_header":"https://static001.geekbang.org/account/avatar/00/16/e6/fd/8ab5cbeb.jpg","comment_is_top":false,"comment_ctime":1559812581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559812581","product_id":100025201,"comment_content":"我是一个程序员，这一期是我看的最懂的一章。作者的简单模型抽象的好。<br>过去的一手交钱一手交货，到现在互联网的一手交钱一手交货。<br><br>为了让大家都能看懂，会有很多抽象概念，其实做的事情可能很简单。","like_count":0},{"had_liked":false,"id":100880,"user_name":"永涛","can_delete":false,"product_type":"c1","uid":1004199,"ip_address":"","ucode":"BE54825A1AA065","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/a7/76c10ff6.jpg","comment_is_top":false,"comment_ctime":1559661415,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559661415","product_id":100025201,"comment_content":"我同学跟我讲，之所以分层是人类处理不了太复杂的问题，现在感觉是七层网络的设计灵感还是来源于实体生活，物流，自来水网络，天然气网络和互联网络太像了。互联网的ip层真是一个伟大的设计。实体网络没有这一层，我感觉是成本太高了。","like_count":0},{"had_liked":false,"id":100363,"user_name":"kdb_reboot","can_delete":false,"product_type":"c1","uid":1003594,"ip_address":"","ucode":"4C56FCA563FCA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/4a/04fef27f.jpg","comment_is_top":false,"comment_ctime":1559537431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559537431","product_id":100025201,"comment_content":"报文最终以二层报文的方式传递，这个是硬件限制是么？如果是，这个是不变量，上层都是对底层实现的演绎；我做驱动开发，之前接触过交换芯片，给芯片处理的buffer就是要填入二层报文的格式（或者说芯片要求的处理格式），您能讲讲：1，为什么网络最终是以二层报文传递，2，（1）的过程感觉应该涉及了一些硬件芯片的故事可以讲讲么，比如我想到了网卡 phy芯片 交换芯片","like_count":0},{"had_liked":false,"id":100316,"user_name":"觉","can_delete":false,"product_type":"c1","uid":1503600,"ip_address":"","ucode":"95E85D30E92170","user_header":"https://static001.geekbang.org/account/avatar/00/16/f1/70/bca09d2d.jpg","comment_is_top":false,"comment_ctime":1559527419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559527419","product_id":100025201,"comment_content":"感恩大佬分享 随喜大佬","like_count":0},{"had_liked":false,"id":100186,"user_name":"fjpcode","can_delete":false,"product_type":"c1","uid":1306092,"ip_address":"","ucode":"C32C5E3ECB9A90","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ61zTDmLk7IhLJn6seBPOwsVaKIWUWaxk5YmsdYBZUOYMQCsyl9iaQVSg9U5qJVLLOCFUoLUuYnRA/132","comment_is_top":false,"comment_ctime":1559471521,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559471521","product_id":100025201,"comment_content":"老师用寄件物流的方式类比网络传输过程，通俗易懂，解决了自己很多困惑。","like_count":0},{"had_liked":false,"id":100170,"user_name":"Cordova","can_delete":false,"product_type":"c1","uid":1507212,"ip_address":"","ucode":"CADCB5D4F48F33","user_header":"https://static001.geekbang.org/account/avatar/00/16/ff/8c/a6a2b26b.jpg","comment_is_top":false,"comment_ctime":1559466808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559466808","product_id":100025201,"comment_content":"关于一楼的问题我尝试说一些我的理解：首先MAC地址是不会变的，其次ip是可以经过网段层层划分的。两主机通信为什么会出现各种协议（通信约定），其实是为了解决网络通信中各种复杂的情况（比如icmp会返回连接某一地址的情况），好了，直接面向问题。两个不同局域网（也就是两个不同子网）通信是非常常见的，既然mac地址不会变，ip按层划分可想而知也是唯一的，其实每次经过一个路由点，都会完成一次数据包的拆包与重组校验，完全不知道目标ip在哪的时候就广播，知道之后就把有效的下一跳地址缓存起来（DNS就玩的更高级点，我直接开服层层存储你们的ip，然后给你们ip起名，OK名字你们自己定，但是得给我服务费，我们就称它为域名吧！有了DNS服务网络传输效率会高很多，如果没有域名，通过DNS服务查找某个ip地址也会快很多）。至于ip和mac怎么变化，当然是不会变化了&#47;% 。～），我估计你要问的是路由器怎么寻址的、最后需要说明的是，校验会包括数据长度校验，这样可以丢弃垃圾包，直到目标主机通过软中断之后把数据通过mbuf刷到进程地址空间的时候，依旧会做数据的长度校验，来证明数据有效性，防止数据被篡改。当然我理解的也存在不准确，有不同见解的可以烹饪我、&#47;% _～）","like_count":0},{"had_liked":false,"id":99824,"user_name":"ttxser","can_delete":false,"product_type":"c1","uid":1022694,"ip_address":"","ucode":"47C3FCB59F8027","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9a/e6/e8439f9a.jpg","comment_is_top":false,"comment_ctime":1559311448,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559311448","product_id":100025201,"comment_content":"感觉不像是在讲架构。计算机组成","like_count":0,"discussions":[{"author":{"id":1157910,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ab/16/0f83cab6.jpg","nickname":"smilingmiao","note":"","ucode":"B48F429563EF74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1713,"discussion_content":"TCP/IP 就是分层协议的架构模式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562836632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99732,"user_name":"黄强","can_delete":false,"product_type":"c1","uid":1086093,"ip_address":"","ucode":"20231AC29CFD53","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/8d/ab469ad5.jpg","comment_is_top":false,"comment_ctime":1559287439,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559287439","product_id":100025201,"comment_content":" ARP 协议通过目标 IP 地址，查找目标 MAC 地址，这个IP 地址和MAC 地址对照关系是存储在哪里的啊？","like_count":0,"discussions":[{"author":{"id":1330065,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/N0NACGUr8dNAbN6BdiagPHBaB0EnyDsI9zWpwJteqTY38apOEnTOA7JkBAQnzYKJBgxu3Q8YMUILwLAB6camn4w/132","nickname":"Swing","note":"","ucode":"55FCA9ECEFBBEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209019,"discussion_content":"局域网内，ip地址和mac地址的对应关系arp表 是 各设备自己记录的；\n但是 交换机 也会学习 mac地址和端口的对应关系","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584601046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99717,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1559284242,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559284242","product_id":100025201,"comment_content":"想问个问题，广域网里ARP协议是否是起效的，在局域网里，因为ARP协议，存在ARP欺骗问题，在广域网里，如何解决ARP欺骗这个问题？","like_count":0,"discussions":[{"author":{"id":1102245,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d1/a5/2bbedc3b.jpg","nickname":"over","note":"","ucode":"FE272AC19842D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362982,"discussion_content":"绑死","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617083819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}