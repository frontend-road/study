{"id":88100,"title":"20 | Vuex核心概念及底层原理","content":"<h1>源代码及课件地址</h1><p><a href=\"https://gitee.com/geektime-geekbang/geektime-vue-1\">https://gitee.com/geektime-geekbang/geektime-vue-1</a></p>","comments":[{"had_liked":false,"id":92330,"user_name":"Starry starry night","can_delete":false,"product_type":"c3","uid":1520539,"ip_address":"","ucode":"8DCEAF095FEC84","user_header":"https://static001.geekbang.org/account/avatar/00/17/33/9b/683f9c2a.jpg","comment_is_top":false,"comment_ctime":1557233928,"is_pvip":false,"replies":[{"id":33201,"content":"我想这样效果会更好一些 感谢支持","user_name":"作者回复","user_name_real":"唐","uid":1316874,"ctime":1557409908,"ip_address":"","comment_id":92330,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"这套视频对于新手来说跳跃性很强：\n                          1，很适合去根据视频中的知识点去自主学习，而且这样印象才会更深。                     \n                          2，视频中出现了很多实际工程中出现的问题，并给出了解决工具与解决方法。\n                          3，最后就是老师很积极的在做好本次课程，会及时给留言区留下回复。","like_count":5,"discussions":[{"author":{"id":1316874,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/0a/28206510.jpg","nickname":"唐金州","note":"","ucode":"563B97D87C66AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449217,"discussion_content":"我想这样效果会更好一些 感谢支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557409908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736720,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/80/10/2406a662.jpg","nickname":"希言自然","note":"","ucode":"8D99A82B05636B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233675,"discussion_content":"老师我的回复很积极，但是你都没鸟我，我知道很多问题很白痴，我会慢慢删除的。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586938127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84637,"user_name":"赤霄","can_delete":false,"product_type":"c3","uid":1464282,"ip_address":"","ucode":"892A7FDF9C9367","user_header":"https://static001.geekbang.org/account/avatar/00/16/57/da/4bfdbcb9.jpg","comment_is_top":false,"comment_ctime":1554888336,"is_pvip":false,"replies":[{"id":30446,"content":"是$$state  这个名称是自己在 data中自己定义的 可以任意起名字，当然不能和vue保留字冲突","user_name":"作者回复","user_name_real":"唐","uid":1316874,"ctime":1554896974,"ip_address":"","comment_id":84637,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"get函数下面 return this._vm.data.$state吧  看老师写成了  return this._vm.data.$$state","like_count":1,"discussions":[{"author":{"id":1316874,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/0a/28206510.jpg","nickname":"唐金州","note":"","ucode":"563B97D87C66AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446409,"discussion_content":"是$$state  这个名称是自己在 data中自己定义的 可以任意起名字，当然不能和vue保留字冲突","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554896974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81084,"user_name":"😶","can_delete":false,"product_type":"c3","uid":1391986,"ip_address":"","ucode":"1833882A000EFE","user_header":"https://static001.geekbang.org/account/avatar/00/15/3d/72/51ba3684.jpg","comment_is_top":false,"comment_ctime":1553810984,"is_pvip":false,"replies":[{"id":29471,"content":"中后台管理系统  可以搜索下 ant-design-pro 已经有react版的了","user_name":"作者回复","user_name_real":"唐","uid":1316874,"ctime":1553847301,"ip_address":"","comment_id":81084,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"老师最后个项目是什么项目？","like_count":1,"discussions":[{"author":{"id":1316874,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/0a/28206510.jpg","nickname":"唐金州","note":"","ucode":"563B97D87C66AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445074,"discussion_content":"中后台管理系统  可以搜索下 ant-design-pro 已经有react版的了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553847301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207629,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6d/4d/ada0aa8a.jpg","nickname":"亚东","note":"","ucode":"D76E7F593D6CBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241762,"discussion_content":"这个是vue课程，为什么讲react?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587438676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91678,"user_name":"༺治朋༻","can_delete":false,"product_type":"c3","uid":1379801,"ip_address":"","ucode":"6636FAB70BD566","user_header":"https://static001.geekbang.org/account/avatar/00/15/0d/d9/0a7d2f8f.jpg","comment_is_top":false,"comment_ctime":1557071598,"is_pvip":false,"replies":[{"id":35065,"content":"你可以这么理解，但内部还是有些小逻辑的，有兴趣可以看看源码","user_name":"作者回复","user_name_real":"唐","uid":1316874,"ctime":1558879429,"ip_address":"","comment_id":91678,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"明白了,vuex跟vue自身的实例都是独立的存在, 在引用vuex时候 是不是在new Vue那里挂载到了,当前的vue实例上边, 所以后边用 this.$store 之类的都能操作呢?","like_count":0,"discussions":[{"author":{"id":1316874,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/0a/28206510.jpg","nickname":"唐金州","note":"","ucode":"563B97D87C66AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448991,"discussion_content":"你可以这么理解，但内部还是有些小逻辑的，有兴趣可以看看源码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558879429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":210793,"user_name":"renderfan001","can_delete":false,"product_type":"c3","uid":1253485,"ip_address":"","ucode":"FB1A383E9DC256","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLX8ole5k6gIdCLibxtvDOAzvrQibIayjUsT852TOLl0NgYBIjD5X28Jkkb1j9S3s00rQUsIqQLe0JA/132","comment_is_top":false,"comment_ctime":1587825831,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"import Vue from &#39;vue&#39;;\nfunction Store(options={}) {\n    const{state = {}, mutations = {}, getters={}, actions={}} = options;    \n    this.vm = new Vue({\n        data:{\n            $$state: state\n        },\n    });\n    this.commit = function(type, payload) {\n        if(mutations[type]) {\n            mutations[type].call(this, state, payload);\n        }\n    }\n    this.dispatch = function(type, payload) {\n        if(actions[type]) {\n            let args = [state, payload];\n            actions[type].apply(null, args);\n        }\n    }\n    let thisGetters = {};\n    for(let p in getters) {\n        Object.defineProperty(thisGetters, p, {\n            get() { return getters[p](state);}\n        });\n    }\n    this.getters = thisGetters;\n    this.mutations = options.mutations;\n    this.state = state;\n}\nfunction init() {\n    let options = this.$options;\n    if(options.store) {\n        this.$store = options.store;\n    } else if(options.parent &amp;&amp; options.parent.$store) {\n        this.$store = options.parent.$store;\n    }\n}\nfunction install(Vue) {\n    Vue.mixin({beforeCreate: init});\n}\nexport default {\n    Store,\n    install\n}","like_count":14},{"had_liked":false,"id":81465,"user_name":"雷恩","can_delete":false,"product_type":"c3","uid":1469267,"ip_address":"","ucode":"D691F4E050AA99","user_header":"","comment_is_top":false,"comment_ctime":1553918603,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"老师，提个意见，最好能结合你的经验讲下技巧之类的内容。","like_count":13},{"had_liked":false,"id":133888,"user_name":"Geek_4e4ec2","can_delete":false,"product_type":"c3","uid":1603078,"ip_address":"","ucode":"6DAD5EE4FFB195","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zAZv4NyuS21Y1qk45j8JiaoEYdA5Zgc1PqpJsBokz5bZVmdkf6kNWvT4cUAAKAdH6TgN52DWZhiaH6wNFhw14nRg/132","comment_is_top":false,"comment_ctime":1568691075,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"老师，store发音是s duo ，re不发音，不然老是联想到story ^^","like_count":12,"discussions":[{"author":{"id":2686011,"avatar":"https://static001.geekbang.org/account/avatar/00/28/fc/3b/e4318cca.jpg","nickname":"马晶鑫","note":"","ucode":"D12EA0AC700D2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403897,"discussion_content":"确实 听着好别扭","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634179941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1855159,"avatar":"","nickname":"Geek_84e1a5","note":"","ucode":"D24EA641D100EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263166,"discussion_content":"秀儿你好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589181952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1498186,"avatar":"https://static001.geekbang.org/account/avatar/00/16/dc/4a/0f56e0ad.jpg","nickname":"LiKui","note":"","ucode":"7089F7F38D26A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1855159,"avatar":"","nickname":"Geek_84e1a5","note":"","ucode":"D24EA641D100EC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295561,"discussion_content":"你也很秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596249813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":263166,"ip_address":"","group_id":0},"score":295561,"extra":""}]}]},{"had_liked":false,"id":90790,"user_name":"young","can_delete":false,"product_type":"c3","uid":1472571,"ip_address":"","ucode":"4B5285A404E637","user_header":"https://static001.geekbang.org/account/avatar/00/16/78/3b/19ef632a.jpg","comment_is_top":false,"comment_ctime":1556645188,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"老师，min-vuex.js中用new Vue()创建Vue实例了，\n然后在main.js中又用new Vue()创建Vue实例了，\nVue是单态模式吗？这两次创建的Vue实例是不是同一个Vue实例吧？如果是的话两次创建Vue实例时数据会合并吗？","like_count":7,"discussions":[{"author":{"id":1684890,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJiaeTzf4V8ib4wibD5pbDY1GHBvUcfbof3fSxicW1HHiaqWhick7KFuwutZTA8AVUicgxDnTOUkDrlaTKag/132","nickname":"zh1164","note":"","ucode":"1B7B8BA25B50FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293192,"discussion_content":"不是，它们两个没有任何关系吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595472618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89809,"user_name":"huanghui","can_delete":false,"product_type":"c3","uid":1464865,"ip_address":"","ucode":"AD2AC528E2C63A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ericUvFT5gl0eEJCjcMXub9d6Z8TPjZOibJCjIyibZKOlhsQWkgcSvOoA5S0Vn6z0B6BKv2zR8HvLArA/132","comment_is_top":false,"comment_ctime":1556269317,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"return this._vm._data.$$state，为什么是_data，而不是data","like_count":4,"discussions":[{"author":{"id":1736720,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/80/10/2406a662.jpg","nickname":"希言自然","note":"","ucode":"8D99A82B05636B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233853,"discussion_content":"$data = _data，你就明白了\n以 _ 或 $ 开头的属性不会被 Vue 实例代理，因为它们可能和 Vue 内置的属性、API 方法冲突。\nconsole.log(this._vm._data === this._vm.$data);    // true 测试一下加深印象","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586949184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1567745,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ec/01/7a2d7f84.jpg","nickname":"ただの観です。","note":"","ucode":"D2EF872BEAF4C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1204,"discussion_content":"因为Vue的data对外不暴露，需要使用_data进行访问","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562401910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220424,"user_name":"胖达","can_delete":false,"product_type":"c3","uid":1422517,"ip_address":"","ucode":"C930A33E1CEBCD","user_header":"https://static001.geekbang.org/account/avatar/00/15/b4/b5/b7ac4724.jpg","comment_is_top":false,"comment_ctime":1590240059,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024601,"comment_content":"作业很有深度.帮助我理解了很多解构,我个人理解查看源代码得到的信息:\n1.getters实际上时一个内部实例vue的computed,所以后面作业是要实现getters挂载对应实例的computed\n2.注入$store是在store上,有个对应install的钩子函数.实现的挂载\n","like_count":3},{"had_liked":false,"id":206877,"user_name":"希言自然","can_delete":false,"product_type":"c3","uid":1736720,"ip_address":"","ucode":"8D99A82B05636B","user_header":"https://static001.geekbang.org/account/avatar/00/1a/80/10/2406a662.jpg","comment_is_top":false,"comment_ctime":1586949274,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"Store 是如何做到我们的一个响应式的？\n实际上它还是利用了 Vue，我们通过 `new Vue()` 函数构建了一个 Vue 实例，并将 `state` 存放在了这个实例的选项 data 的 `$$state` 属性里面。这样的话，我们的 `state` 已经变成了一个间接的响应式的数据。\nObject.defineProperties(Store.prototype, {......})\n这个方法修改 `Store` 对象上的属性 `prototype`（属性），修改的属性是 `state`，修改了 `state` 下的 `get`（`getter` 函数） ，`get` 函数返回一个结果是 `_vm` 实例下的选项 `data` 中的 `$$state` 属性，其实就是 `Store` 对象下的 `state` 对象，只不过从 `_vm` 实例中取了一遍，就编程响应式的了~","like_count":1},{"had_liked":false,"id":180904,"user_name":"夏不见秋","can_delete":false,"product_type":"c3","uid":1005105,"ip_address":"","ucode":"D1960FA9982D7F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/31/46103c86.jpg","comment_is_top":false,"comment_ctime":1582440401,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"一个头两个大，太多专业性术语，学渣的我要看好多遍，还要把之前的返回来看才能大致搞懂。","like_count":1},{"had_liked":false,"id":396276,"user_name":"Geek_330172","can_delete":false,"product_type":"c3","uid":4053101,"ip_address":"山东","ucode":"1970B600457B9E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/R4xm4hCOtZR2wOOLnqISmdUHmgq9V2kevv6q5U4D0PEiasb48GdXuic8WYmmjR8fOE4QKh6f181WJY4axwTTib6Hg/132","comment_is_top":false,"comment_ctime":1733829348,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":3,"product_id":100024601,"comment_content":"const Vuex = {\n    Store,\n    install\n}\n\nexport default Vuex","like_count":0},{"had_liked":false,"id":396275,"user_name":"Geek_330172","can_delete":false,"product_type":"c3","uid":4053101,"ip_address":"山东","ucode":"1970B600457B9E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/R4xm4hCOtZR2wOOLnqISmdUHmgq9V2kevv6q5U4D0PEiasb48GdXuic8WYmmjR8fOE4QKh6f181WJY4axwTTib6Hg/132","comment_is_top":false,"comment_ctime":1733829341,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":3,"product_id":100024601,"comment_content":"const install = function(Vue) {\n    Vue.mixin({\n        beforeCreate() {\n            if(this.$options &amp;&amp; this.$options.store) { &#47;&#47; 如果是根组件\n                this.$store = this.$options.store\n            } else { &#47;&#47; 如果是子组件\n                this.$store = this.$parent &amp;&amp; this.$parent.$store\n            }\n        }\n    })\n}","like_count":0},{"had_liked":false,"id":396274,"user_name":"Geek_330172","can_delete":false,"product_type":"c3","uid":4053101,"ip_address":"山东","ucode":"1970B600457B9E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/R4xm4hCOtZR2wOOLnqISmdUHmgq9V2kevv6q5U4D0PEiasb48GdXuic8WYmmjR8fOE4QKh6f181WJY4axwTTib6Hg/132","comment_is_top":false,"comment_ctime":1733829333,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":3,"product_id":100024601,"comment_content":"class Store {\n    constructor(options) {\n        this.vm = new Vue({\n            data: {\n                state: options.state || {}\n            }\n        })\n\n        &#47;&#47; 用户提供的 getters 函数\n        const userGetters = options.getters || {}\n        &#47;&#47; Store 实例上的 getters 属性\n        this.getters = {}\n        &#47;&#47; 遍历用户提供的 getter 函数，并为每个 getter 创建访问器属性\n        Object.keys(userGetters).forEach(getterName =&gt; {\n            Object.defineProperty(this.getters, getterName, {\n                get: () =&gt; {\n                    return userGetters[getterName](this.state)\n                }\n            })\n        })\n\n        &#47;&#47; 用户提供的 mutations 函数\n        const userMutations = options.mutations || {}\n        &#47;&#47; Store 实例上的 mutations 属性\n        this.mutations = {}\n        &#47;&#47; 遍历用户提供的 mutations 函数，并为每个 mutation 创建访问器属性\n        Object.keys(userMutations).forEach(mutationName =&gt; {\n            this.mutations[mutationName] = arg =&gt; {\n                userMutations[mutationName](this.state, arg)\n            }\n        })\n\n        &#47;&#47; 用户提供的 actions 函数\n        const userActions = options.actions || {}\n        &#47;&#47; Store 实例上的 actions 属性\n        this.actions = {}\n        &#47;&#47; 遍历用户提供的 actions 函数，并为每个 action 创建访问器属性\n        Object.keys(userActions).forEach(actionName =&gt; {\n            this.actions[actionName] = arg =&gt; {\n                userActions[actionName](this, arg)\n            }\n        })\n\n    }\n\n    dispatch(method, arg) {\n        this.actions[method](arg)\n    }\n\n    &#47;&#47; 在执行 dispatch 调用 commit，this undefined 改为箭头函数\n    commit = (method, arg) =&gt; {\n        this.mutations[method](arg)\n    }\n\n    get state() {\n        return this.vm.state\n    }\n}","like_count":0},{"had_liked":false,"id":295605,"user_name":"可惜没有如果～R","can_delete":false,"product_type":"c3","uid":1661123,"ip_address":"","ucode":"17BEE46924E721","user_header":"https://static001.geekbang.org/account/avatar/00/19/58/c3/a9dcaa99.jpg","comment_is_top":false,"comment_ctime":1622510843,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"import Vue from &#39;vue&#39;;\n\nconst Store = function Store(option = {}) {\n    const {state = {}, mutations = {}, actions = {}, getters={}} = option;\n    this._vm = new Vue({\n        data: {\n            $sstate: state\n        }\n    })\n    this._mutations = mutations\n    this._actions = actions\n    this._getters = getters\n    const ref = this\n    const commit = ref.commit\n    const dispatch = ref.dispatch\n\n    this.commit = function boundCommit(type, paylod){\n        return commit.call(ref, type, paylod)\n    }\n\n    this.dispatch = function boundDispatch(type, paylod){\n        return dispatch.call(ref, type, paylod)\n    }\n}\n\nStore.prototype.commit = function(type, paylod) {\n    if(this._mutations[type]){\n        this._mutations[type](this.state, paylod)\n    }\n}\n\nStore.prototype.dispatch = function(type, paylod){\n    if(this._actions[type]){\n        this._actions[type]({\n            state: this.state,\n            commit: this.commit,\n            paylod,\n        })\n    }\n}\n\nStore.prototype.getters = function(type){\n    if(this._getters[type]){\n        this._getters[type](this.state)\n    }\n}\n\nObject.defineProperties(Store.prototype,{\n    state: {\n        get: function(){\n            return this._vm.$data.$sstate\n        }\n    }\n})\n\nexport default {Store}\n\n其他的没写完，主要吧 action写完了","like_count":0},{"had_liked":false,"id":277149,"user_name":"你好，阳光","can_delete":false,"product_type":"c3","uid":2145095,"ip_address":"","ucode":"1A2F487C57F7D9","user_header":"https://static001.geekbang.org/account/avatar/00/20/bb/47/b60ae3eb.jpg","comment_is_top":false,"comment_ctime":1612275751,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"链接代码中vueInit函数里面的options.parent判断分支是否代表给非根组件注入$store属性？","like_count":0},{"had_liked":false,"id":231772,"user_name":"葱油拌面","can_delete":false,"product_type":"c3","uid":1728866,"ip_address":"","ucode":"C8681C7AC91332","user_header":"https://static001.geekbang.org/account/avatar/00/1a/61/62/bdefba52.jpg","comment_is_top":false,"comment_ctime":1593767480,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"上完课突然闪现老师的大脸也是有点突兀哈哈哈哈哈","like_count":0},{"had_liked":false,"id":190419,"user_name":"WinfyHo","can_delete":false,"product_type":"c3","uid":1376366,"ip_address":"","ucode":"1C1EBA315593A8","user_header":"https://static001.geekbang.org/account/avatar/00/15/00/6e/6982a56e.jpg","comment_is_top":false,"comment_ctime":1584645400,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"没想到还能这么手写vuex，利用vue原来的响应式系统挂载，减少很多代码","like_count":0},{"had_liked":false,"id":174325,"user_name":"递归涛","can_delete":false,"product_type":"c3","uid":1578922,"ip_address":"","ucode":"0C5082BEBDA550","user_header":"https://static001.geekbang.org/account/avatar/00/18/17/aa/3e0508ae.jpg","comment_is_top":false,"comment_ctime":1580142119,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024601,"comment_content":"const {mutations, state, getters} = option\n    let changeGetters = {}\n    &#47;&#47; getters实现\n    Object.keys(getters).forEach(key =&gt; {\n        changeGetters[key] = () =&gt; getters[key](this._vm._data.$$data)\n    })\n    this._vm = new Vue({\n        data() {\n            return {\n                $$data: state\n            }\n        },\n        computed: changeGetters\n    })\n    this._mutations = mutations\n试了一下，能用。","like_count":0,"discussions":[{"author":{"id":1272789,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6b/d5/0e4b70a2.jpg","nickname":"Sean","note":"","ucode":"BC0715BF423613","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192128,"discussion_content":"应该还需要在Store.prototype上加一个getters属性吧。\nObject.defineProperties(Store.prototype, {\n    state: {\n        get: function () {\n            return this._vm._data.$$state;\n        }\n    },\n    getters: {\n        get: function () {\n            return this._vm;\n        }\n    }\n})","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583064501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149030,"user_name":"Saki","can_delete":false,"product_type":"c3","uid":1143138,"ip_address":"","ucode":"CEA2E5D15D400E","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/62/20df02b0.jpg","comment_is_top":false,"comment_ctime":1573129232,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024601,"comment_content":"暂时用不到，先来了解原理，眼熟眼熟","like_count":0},{"had_liked":false,"id":118002,"user_name":"周序猿","can_delete":false,"product_type":"c3","uid":1374169,"ip_address":"","ucode":"C6D09DBAA22F94","user_header":"https://static001.geekbang.org/account/avatar/00/14/f7/d9/3014889f.jpg","comment_is_top":false,"comment_ctime":1564209769,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024601,"comment_content":"老师，您好，大概过了下vuex的源码。有个地方不是很理解，为什么vuex内部存放mutations、actions 都要以数组的形式存放呢。每个模块中存在的 mutations 下的操作应该是唯一的才对啊，即使是不同模块下的同名的mutation 它们type值也不一样，真的想不明请老师为我解惑。\n源码：\nfunction registerMutation (store, type, handler, local) {\n  const entry = store._mutations[type] || (store._mutations[type] = [])\n  entry.push(function wrappedMutationHandler (payload) {\n    handler.call(store, local.state, payload)\n  })\n}\n为什么不直接这样写：\nfunction registerMutation (store, type, handler, local) {\n  store._mutations[type] = function (payload) {\n    handler.call(store, local.state, payload)\n  }\n}","like_count":0},{"had_liked":false,"id":88781,"user_name":"novaln🍉","can_delete":false,"product_type":"c3","uid":1231695,"ip_address":"","ucode":"EC544D448DA898","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/4f/feb5528f.jpg","comment_is_top":false,"comment_ctime":1555999384,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100024601,"comment_content":"min-vue.js中第19行：get函数中 return this._vm._data.$$state，为什么需要有一层_data呢，new Vue时data对象中的所有key不是都会挂载到实例上吗，直接访问this._vm.$state就可以？","like_count":0,"discussions":[{"author":{"id":1272789,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6b/d5/0e4b70a2.jpg","nickname":"Sean","note":"","ucode":"BC0715BF423613","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192022,"discussion_content":"实例代理data对象中的属性，除了不能与methods和props重名之外，还有一个限制条件：属性不能是以$或者_开头的保留属性。在这个例子中，老师使用$$state，vue会认为这是一个保留属性，因此不会代理。打印this._vm_$$state会显示是undefined。而data中所有的数据最终会保存在vm._data下，没有任何限制，因此可以在需要在_data下取， $data也可以。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583055678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86282,"user_name":"烟雨海花lwl","can_delete":false,"product_type":"c3","uid":1495437,"ip_address":"","ucode":"94106A70FF45A6","user_header":"https://static001.geekbang.org/account/avatar/00/16/d1/8d/d923fa4b.jpg","comment_is_top":false,"comment_ctime":1555337614,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024601,"comment_content":"打卡","like_count":0}]}