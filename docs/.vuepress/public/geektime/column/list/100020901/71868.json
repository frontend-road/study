{"id":71868,"title":"09 | 基础篇：怎么理解Linux软中断？","content":"<p>你好，我是倪朋飞。</p><p>上一期，我用一个不可中断进程的案例，带你学习了iowait（也就是等待I/O的CPU使用率）升高时的分析方法。这里你要记住，进程的不可中断状态是系统的一种保护机制，可以保证硬件的交互过程不被意外打断。所以，短时间的不可中断状态是很正常的。</p><p>但是，当进程长时间都处于不可中断状态时，你就得当心了。这时，你可以使用 dstat、pidstat 等工具，确认是不是磁盘 I/O 的问题，进而排查相关的进程和磁盘设备。关于磁盘 I/O 的性能问题，你暂且不用专门去背，我会在后续的 I/O 部分详细介绍，到时候理解了也就记住了。</p><p>其实除了 iowait，软中断（softirq）CPU使用率升高也是最常见的一种性能问题。接下来的两节课，我们就来学习软中断的内容，我还会以最常见的反向代理服务器 Nginx 的案例，带你分析这种情况。</p><h2>从“取外卖”看中断</h2><p>说到中断，我在前面<a href=\"https://time.geekbang.org/column/article/69859\">关于“上下文切换”的文章</a>，简单说过中断的含义，先来回顾一下。中断是系统用来响应硬件设备请求的一种机制，它会打断进程的正常调度和执行，然后调用内核中的中断处理程序来响应设备的请求。</p><p>你可能要问了，为什么要有中断呢？我可以举个生活中的例子，让你感受一下中断的魅力。</p><!-- [[[read_end]]] --><p>比如说你订了一份外卖，但是不确定外卖什么时候送到，也没有别的方法了解外卖的进度，但是，配送员送外卖是不等人的，到了你这儿没人取的话，就直接走人了。所以你只能苦苦等着，时不时去门口看看外卖送到没，而不能干其他事情。</p><p>不过呢，如果在订外卖的时候，你就跟配送员约定好，让他送到后给你打个电话，那你就不用苦苦等待了，就可以去忙别的事情，直到电话一响，接电话、取外卖就可以了。</p><p>这里的“打电话”，其实就是一个中断。没接到电话的时候，你可以做其他的事情；只有接到了电话（也就是发生中断），你才要进行另一个动作：取外卖。</p><p>这个例子你就可以发现，<strong>中断其实是一种异步的事件处理机制，可以提高系统的并发处理能力</strong>。</p><p>由于中断处理程序会打断其他进程的运行，所以，<strong>为了减少对正常进程运行调度的影响，中断处理程序就需要尽可能快地运行</strong>。如果中断本身要做的事情不多，那么处理起来也不会有太大问题；但如果中断要处理的事情很多，中断服务程序就有可能要运行很长时间。</p><p>特别是，中断处理程序在响应中断时，还会临时关闭中断。这就会导致上一次中断处理完成之前，其他中断都不能响应，也就是说中断有可能会丢失。</p><p>那么还是以取外卖为例。假如你订了 2 份外卖，一份主食和一份饮料，并且是由2个不同的配送员来配送。这次你不用时时等待着，两份外卖都约定了电话取外卖的方式。但是，问题又来了。</p><p>当第一份外卖送到时，配送员给你打了个长长的电话，商量发票的处理方式。与此同时，第二个配送员也到了，也想给你打电话。</p><p>但是很明显，因为电话占线（也就是关闭了中断响应），第二个配送员的电话是打不通的。所以，第二个配送员很可能试几次后就走掉了（也就是丢失了一次中断）。</p><h2>软中断</h2><p>如果你弄清楚了“取外卖”的模式，那对系统的中断机制就很容易理解了。事实上，为了解决中断处理程序执行过长和中断丢失的问题，Linux 将中断处理过程分成了两个阶段，也就是<strong>上半部和下半部</strong>：</p><ul>\n<li>\n<p><strong>上半部用来快速处理中断</strong>，它在中断禁止模式下运行，主要处理跟硬件紧密相关的或时间敏感的工作。</p>\n</li>\n<li>\n<p><strong>下半部用来延迟处理上半部未完成的工作，通常以内核线程的方式运行</strong>。</p>\n</li>\n</ul><p>比如说前面取外卖的例子，上半部就是你接听电话，告诉配送员你已经知道了，其他事儿见面再说，然后电话就可以挂断了；下半部才是取外卖的动作，以及见面后商量发票处理的动作。</p><p>这样，第一个配送员不会占用你太多时间，当第二个配送员过来时，照样能正常打通你的电话。</p><p>除了取外卖，我再举个最常见的网卡接收数据包的例子，让你更好地理解。</p><p>网卡接收到数据包后，会通过<strong>硬件中断</strong>的方式，通知内核有新的数据到了。这时，内核就应该调用中断处理程序来响应它。你可以自己先想一下，这种情况下的上半部和下半部分别负责什么工作呢？</p><p>对上半部来说，既然是快速处理，其实就是要把网卡的数据读到内存中，然后更新一下硬件寄存器的状态（表示数据已经读好了），最后再发送一个<strong>软中断</strong>信号，通知下半部做进一步的处理。</p><p>而下半部被软中断信号唤醒后，需要从内存中找到网络数据，再按照网络协议栈，对数据进行逐层解析和处理，直到把它送给应用程序。</p><p>所以，这两个阶段你也可以这样理解：</p><ul>\n<li>\n<p>上半部直接处理硬件请求，也就是我们常说的硬中断，特点是快速执行；</p>\n</li>\n<li>\n<p>而下半部则是由内核触发，也就是我们常说的软中断，特点是延迟执行。</p>\n</li>\n</ul><p>实际上，上半部会打断CPU正在执行的任务，然后立即执行中断处理程序。而下半部以内核线程的方式执行，并且每个 CPU 都对应一个软中断内核线程，名字为 “ksoftirqd/CPU编号”，比如说， 0 号CPU对应的软中断内核线程的名字就是 ksoftirqd/0。</p><p>不过要注意的是，软中断不只包括了刚刚所讲的硬件设备中断处理程序的下半部，一些内核自定义的事件也属于软中断，比如内核调度和RCU锁（Read-Copy Update 的缩写，RCU 是 Linux 内核中最常用的锁之一）等。</p><p>那要怎么知道你的系统里有哪些软中断呢？</p><h2>查看软中断和内核线程</h2><p>不知道你还记不记得，前面提到过的 proc 文件系统。它是一种内核空间和用户空间进行通信的机制，可以用来查看内核的数据结构，或者用来动态修改内核的配置。其中：</p><ul>\n<li>\n<p>/proc/softirqs 提供了软中断的运行情况；</p>\n</li>\n<li>\n<p>/proc/interrupts 提供了硬中断的运行情况。</p>\n</li>\n</ul><p>运行下面的命令，查看 /proc/softirqs 文件的内容，你就可以看到各种类型软中断在不同 CPU 上的累积运行次数：</p><pre><code>$ cat /proc/softirqs\n                    CPU0       CPU1\n          HI:          0          0\n       TIMER:     811613    1972736\n      NET_TX:         49          7\n      NET_RX:    1136736    1506885\n       BLOCK:          0          0\n    IRQ_POLL:          0          0\n     TASKLET:     304787       3691\n       SCHED:     689718    1897539\n     HRTIMER:          0          0\n         RCU:    1330771    1354737\n</code></pre><p>在查看 /proc/softirqs 文件内容时，你要特别注意以下这两点。</p><p>第一，要注意软中断的类型，也就是这个界面中第一列的内容。从第一列你可以看到，软中断包括了10个类别，分别对应不同的工作类型。比如 NET_RX 表示网络接收中断，而 NET_TX 表示网络发送中断。</p><p>第二，要注意同一种软中断在不同 CPU 上的分布情况，也就是同一行的内容。正常情况下，同一种中断在不同 CPU 上的累积次数应该差不多。比如这个界面中，NET_RX 在 CPU0 和 CPU1 上的中断次数基本是同一个数量级，相差不大。</p><p>不过你可能发现，TASKLET  在不同CPU上的分布并不均匀。TASKLET 是最常用的软中断实现机制，每个 TASKLET 只运行一次就会结束 ，并且只在调用它的函数所在的 CPU 上运行。</p><p>因此，使用 TASKLET 特别简便，当然也会存在一些问题，比如说由于只在一个CPU上运行导致的调度不均衡，再比如因为不能在多个 CPU 上并行运行带来了性能限制。</p><p>另外，刚刚提到过，软中断实际上是以内核线程的方式运行的，每个 CPU 都对应一个软中断内核线程，这个软中断内核线程就叫做  ksoftirqd/CPU编号。那要怎么查看这些线程的运行状况呢？</p><p>其实用 ps 命令就可以做到，比如执行下面的指令：</p><pre><code>$ ps aux | grep softirq\nroot         7  0.0  0.0      0     0 ?        S    Oct10   0:01 [ksoftirqd/0]\nroot        16  0.0  0.0      0     0 ?        S    Oct10   0:01 [ksoftirqd/1]\n</code></pre><p>注意，这些线程的名字外面都有中括号，这说明 ps 无法获取它们的命令行参数（cmline）。一般来说，ps  的输出中，名字括在中括号里的，一般都是内核线程。</p><h2>小结</h2><p>Linux 中的中断处理程序分为上半部和下半部：</p><ul>\n<li>\n<p>上半部对应硬件中断，用来快速处理中断。</p>\n</li>\n<li>\n<p>下半部对应软中断，用来异步处理上半部未完成的工作。</p>\n</li>\n</ul><p>Linux 中的软中断包括网络收发、定时、调度、RCU锁等各种类型，可以通过查看 /proc/softirqs 来观察软中断的运行情况。</p><h2>思考</h2><p>最后，我想请你一起聊聊，你是怎么理解软中断的？你有没有碰到过因为软中断出现的性能问题？你又是怎么分析它们的瓶颈的呢？你可以结合今天的内容，总结自己的思路，写下自己的问题。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","comments":[{"had_liked":false,"id":48302,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1544415301,"is_pvip":false,"replies":[{"id":"17274","content":"嗯嗯，已经是很有经验的老手了😊<br><br>大多数情况下 root 权限都是必须的，还是准备个root权限的环境实践吧","user_name":"作者回复","comment_id":48302,"uid":"1001282","ip_address":"","utype":1,"ctime":1544435971,"user_name_real":"倪朋飞"}],"discussion_count":8,"race_medal":0,"score":"594249902149","product_id":100020901,"comment_content":"[D9打卡]<br>======================================<br>问题:怎么理解软中断?<br>我的理解比较简单粗暴, 硬中断是硬件产生的,比如键盘、鼠标的输入，硬盘的写入读取、网卡有数据了；软中断是软件产生的，比如程序内的定时器、[文中提到的RCU锁]。<br>再加上今天的上半部下半部，更好的理解了网卡的处理实际是有硬中断和软中断的。<br>======================================<br>问题:有没有碰到过因为软中断出现的性能问题?<br>有，且是血淋淋的教训。<br>之前的c程序用到了别人写的动态库[如:lib.a]，在物理机上，进程的cpu利用率在0%；而切换到了云服务器，即使空载，单进程的cpu利用率都有30%+。<br>以前没经验嘛,各种自查,无结果,但是自己的进程cpu利用率又那么高,总是不安心.<br>后来才通过vmstat 检测到系统的软中断每秒有100W+次.<br>最后各自百度,找人,才发现是那个动态库在处理网络收发消息时,使用了usleep(1)来休息,每次休息1纳秒,单次中断的耗时都不止1纳秒.<br>--------------------------------------<br>如果是现在,我会如下分析:<br>1.检测是哪个线程占用了cpu: top -H -p XX 1 &#47; pidstat -wut -p XX 1 <br>2.在进程中打印各线程号. 找到是哪个线程.[ 此过程也可以省略 但可以快速定位线程]<br>3.第一步应该可以判断出来中断数过高. 再使用 cat &#47;proc&#47;softirqs 查看是哪种类型的中断数过高.<br>4.不知道perf report -g -p XX 是否可以定位到具体的系统调用函数.<br>5.最终还是要查看源码,定位具体的位置,并加以验证.<br>--------------------------------------<br>感觉现在随便怎么分析都可以快速定位到是动态库的锅.<br>想当初可是好几个月都无能为力啊, 最后还是几个人各种查,搞了一周多才定位到原因.<br>最后再吐槽下,没有root权限的普通账户真是不方便啊,有些工具只能安装在自己的目录下, 还有些好用的工具根本无权限运行,哎...","like_count":138,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432116,"discussion_content":"嗯嗯，已经是很有经验的老手了😊\n\n大多数情况下 root 权限都是必须的，还是准备个root权限的环境实践吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544435971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073976,"avatar":"https://static001.geekbang.org/account/avatar/00/10/63/38/b3e6751d.jpg","nickname":"SIGSEGV","note":"","ucode":"FA6E587E2E3682","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5526,"discussion_content":"usleep() 好像是微妙","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1566345983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1073976,"avatar":"https://static001.geekbang.org/account/avatar/00/10/63/38/b3e6751d.jpg","nickname":"SIGSEGV","note":"","ucode":"FA6E587E2E3682","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5529,"discussion_content":"对对对，应该是微秒。\n毫秒、微秒、纳秒。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566347094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5526,"ip_address":""},"score":5529,"extra":""}]},{"author":{"id":1316247,"avatar":"https://static001.geekbang.org/account/avatar/00/14/15/97/626a6763.jpg","nickname":"北溟有鹏","note":"","ucode":"35B5069295A9A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274550,"discussion_content":"为什么换到云服务器后cpu使用率上升了呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590591001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1316247,"avatar":"https://static001.geekbang.org/account/avatar/00/14/15/97/626a6763.jpg","nickname":"北溟有鹏","note":"","ucode":"35B5069295A9A4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274811,"discussion_content":"可能是物理机的处理器能力强一些吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590624490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":274550,"ip_address":""},"score":274811,"extra":""},{"author":{"id":1033219,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","nickname":"JianXu","note":"","ucode":"2A61BDBB573BDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542040,"discussion_content":"感觉有别的因素","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640650068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":274811,"ip_address":""},"score":542040,"extra":""}]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171766,"discussion_content":"usleep为什么会导致CPU升高呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581745491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":172018,"discussion_content":"本身usleep并不会造成什么太大的影响.但是把他放在while循环中拼命的弄,就有问题了.\n如果usleep的值设置的不合理,比如1微妙,那么1秒就需要被执行100万次.\n每次休眠和唤醒对CPU来说,就是一次上下文的切换.\n这个上下文的切换,是比较耗CPU的资源的.\n","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1581766274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":171766,"ip_address":""},"score":172018,"extra":""}]}]},{"had_liked":false,"id":48196,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1544401172,"is_pvip":false,"replies":[{"id":"17283","content":"正解","user_name":"作者回复","comment_id":48196,"uid":"1001282","ip_address":"","utype":1,"ctime":1544436803,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"486875705620","product_id":100020901,"comment_content":"经常听同事说大量的网络小包会导致性能问题，一直不太理解，从今天的课程来看，是不是大量的小网络包会导致频繁的硬中断和软中断呢？希望老师给予指点，谢谢","like_count":113,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432070,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59394,"user_name":"冷静","can_delete":false,"product_type":"c1","uid":1147481,"ip_address":"","ucode":"64691214BD38CA","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/59/cd10c25b.jpg","comment_is_top":false,"comment_ctime":1547362658,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"134691348834","product_id":100020901,"comment_content":"中断不会丢失的，因为有中断控制器，它会pending住所有外部中断。除非pending住的那个中断，CPU还没来得及处理，这时又来了一个同样的中断，这个中断才会丢失。还有就是自linux-2.6.3x开始就完全不支持中断嵌套了。","like_count":31,"discussions":[{"author":{"id":1441606,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ff/46/7e4039ea.jpg","nickname":"伟平","note":"","ucode":"2D3E55238FC8B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303478,"discussion_content":"什么情况CPU会来不及处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599278896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48192,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1544400926,"is_pvip":false,"replies":[{"id":"17284","content":"👍","user_name":"作者回复","comment_id":48192,"uid":"1001282","ip_address":"","utype":1,"ctime":1544436848,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"108918583326","product_id":100020901,"comment_content":"打卡，day10<br>用外卖的例子，延伸到网卡的例子，非常形象，👍","like_count":25,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432068,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48180,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1544397232,"is_pvip":false,"replies":[{"id":"17285","content":"👍","user_name":"作者回复","comment_id":48180,"uid":"1001282","ip_address":"","utype":1,"ctime":1544436870,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":1,"score":"83148775856","product_id":100020901,"comment_content":"【D9打卡】<br>主题:软中断<br>中断:系统用来响应硬件设备请求的一种机制，会打断进程的正常调度和执行，通过调用内核中的中断处理程序来响应设备的请求。<br>1.中断是一种异步的事件处理机制，能提高系统的并发处理能力<br>2.为了减少对正常进程运行进行影响，中断处理程序需要尽快运行。<br>3.中断分为上下两个部分<br>(1)上部分用来快速处理中断，在中断禁止模式下，主要处理跟硬件紧密相关的或时间敏感的工作<br>(2)下部分用来延迟处理上半部分未完成的工作，通常以内核线程的方式运行。<br>小结:<br>上半部分直接处理硬件请求，即硬中断，特点是快速执行<br>下部分由内核触发，即软中断，特点是延迟执行<br>软中断除了上面的下部分，还包括一些内核自定义的事件，如:内核调度 RCU锁 网络收发 定时等<br>软中断内核线程的名字:ksoftirq&#47;cpu编号<br>4.proc文件系统是一种内核空间和用户空间进行通信的机制，可以同时用来查看内核的数据结构又能用了动态修改内核的配置，如:<br>&#47;proc&#47;softirqs 提供软中断的运行情况<br>&#47;proc&#47;interrupts 提供硬中断的运行情况<br>","like_count":19,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432063,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198377,"avatar":"https://static001.geekbang.org/account/avatar/00/12/49/29/bbeccb9f.jpg","nickname":"风羽星泉","note":"","ucode":"CBC63AA00C5D70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136614,"discussion_content":"666，总结得真好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579151907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54475,"user_name":"york","can_delete":false,"product_type":"c1","uid":1318852,"ip_address":"","ucode":"EE938B81A7FC04","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGMibYc0m7cDHMsNRBUur2NPVnlBZFXoNjWomibfjnHeAO3XRt27VaH3WNtdUX11d3uIT1ZHWCxLeg/132","comment_is_top":false,"comment_ctime":1545878557,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"53085486109","product_id":100020901,"comment_content":"老师，可否把&#47;proc&#47;softirqs输出信息中的10个类别解释一下含义？网上自行搜索了一下也没查到。","like_count":12,"discussions":[{"author":{"id":2060088,"avatar":"","nickname":"fantastic_show","note":"","ucode":"D2738135D086E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343246,"discussion_content":"man proc","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1610972420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2060088,"avatar":"","nickname":"fantastic_show","note":"","ucode":"D2738135D086E4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591595,"discussion_content":"man proc没有找到软中断的参数解释","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666685403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":343246,"ip_address":"浙江"},"score":591595,"extra":""}]},{"author":{"id":1905171,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/12/13/e103a6e3.jpg","nickname":"扩散性百万咸面包","note":"","ucode":"6D703D51553B42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":243241,"discussion_content":"换谷歌","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587530898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48590,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1544492108,"is_pvip":false,"replies":[{"id":"17464","content":"👍","user_name":"作者回复","comment_id":48590,"uid":"1001282","ip_address":"","utype":1,"ctime":1544521516,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"53084099660","product_id":100020901,"comment_content":"我的心得：<br>中断过程的工作包括，应答并重新设置硬件，从设备拷贝数据到内存以及反向操作，处理硬件请求，并发送新的硬件请求。<br>中断处理流程：硬件--&gt;特殊电信号（中断）--&gt;中断处理器--&gt;IRQ线（中断号）--&gt;操作系统内核（调用中断处理程序，上半部）--&gt;ksoftirqd&#47;n（内核线程处理软中断，下半部）<br>因为中断打断了其他代码的执行（进程，内核本身，甚至其他中断处理程序），它们必须尽快执行完，所以内核把中断处理切分为两部分：上半部，对于时间非常敏感，硬件相关，保证不被其他中断（特别是相同中断）打断的任务，由中断处理程序处理；其他所有能够被允许稍后完成的工作推迟到下半部（任务尽可能放在下半部）。<br><br>基于Linux内核2.6，稍后执行的中断下半部使用三种方式实现：<br>1、软中断，可在所有处理器上同时执行，同类型也可以，仅网络和SCSI直接使用；<br>2、tasklet，通过软中断实现，同类型不能在处理器上同时执行，大部分下半部处理又tasklet实现；<br>3、工作队列，在进程上下文中执行，允许重新调度甚至睡眠，如获得大量内存、信号量、执行阻塞式I&#47;O非常有用。<br>ksoftirqd&#47;n，每个处理器都有一组辅助处理中断的内核线程，专为出现大量软中断处理而设计，避免跟其他重要任务抢夺资源。","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432261,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48159,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1140494,"ip_address":"","ucode":"8FFC6764ED327B","user_header":"https://static001.geekbang.org/account/avatar/00/11/67/0e/2a51a2df.jpg","comment_is_top":false,"comment_ctime":1544372590,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"35904110958","product_id":100020901,"comment_content":"中断不是可以嵌套的吗？在中断处理程序中可以开中断以响应更高优先级的中断，为什么第二次中断会丢失？是指中断隐指令过程吗？？？","like_count":8,"discussions":[{"author":{"id":1453035,"avatar":"","nickname":"陈凯","note":"","ucode":"69A979A5DC91D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":96758,"discussion_content":"还要看具体的中断处理程序，如果处理逻辑不能嵌套，或者不能被打断，大多数会使用关中断。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577091475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217907,"user_name":"Yong","can_delete":false,"product_type":"c1","uid":1912653,"ip_address":"","ucode":"0ADA75C5C68619","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","comment_is_top":false,"comment_ctime":1589643643,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27359447419","product_id":100020901,"comment_content":"打卡，软中断。我想起了定完外卖打王者农药的场景，害怕被外卖电话软中断^_^","like_count":6,"discussions":[{"author":{"id":2172434,"avatar":"https://static001.geekbang.org/account/avatar/00/21/26/12/b10dfa8b.jpg","nickname":"坚信光明就在远方！","note":"","ucode":"1723C129AB5871","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586763,"discussion_content":"这应该是硬中断，外卖电话是物理硬件，下一阶段是外卖员把饭送到门口后，你需要自己开个内核线程去处理剩下的拿饭动作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662480038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144835,"user_name":"Dym","can_delete":false,"product_type":"c1","uid":1205036,"ip_address":"","ucode":"7E521F01A4D823","user_header":"","comment_is_top":false,"comment_ctime":1572068534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27341872310","product_id":100020901,"comment_content":"CPU软中断<br><br><br>1、什么是中断<br><br>中断表示我们请求操作硬件操作准备就绪了，例如从磁盘读取数据，我们知道CPU执行速度比磁盘执行速度快几个数量级，因此如果CPU每次check磁盘是否准备就绪了，那么系统的并发能力和性能会大大下降，但是采用中断方式，异步事件驱动方式来提升系统效率，首先会在驱动程序中嵌入中断程序，一旦磁盘准备就绪就会通过驱动程序发生一个中断请求操作，CPU立马停下手里的活来执行中断程序，该中断程序会从磁盘中读取数据到内存中。<br><br>2、如何避免丢失其他中断请求<br><br><br>一定要保证中断程序快速能处理，因为当CPU在处理中断时，是不能响应其他中断请求的，那么就会导致其他中断请求丢失<br><br><br>举个取外卖的例子：我们在app上点外卖，但是这个外卖不知道什么时候到，因为送外卖小哥一旦到了目的地就会放下外卖就走，这个时候你就会一次又一次的check外卖是否到了，然而你什么时候也干不了，仅仅在来来回回看外卖是否到了，导致浪费你的时间。<br><br>改进方式：如果换一种方式，你和外卖小哥约定一个通知方式，例如当外卖到了家门口小哥就打电话通知我，我就出去取外卖。 打电话就是一次中断请求，你就安心的干其他事情，静静等电话。 如果你点了两份外卖，当第一份外卖到了，小哥电话通知你，但是你在电话中沟通发票问题，这个时候第二份外卖到了另外一个小哥给你打电话发现占线，几次尝试后还是失败，这个时候外卖小哥就走了，导致丢失了这次外卖。<br><br>解决：在电话中只回答好，然后沟通发票问题当面说，这个时候就可以接到另外小哥的电话。 所以中断请求分为两个阶段：<br><br>第一阶段(上半部请求)：接受硬件中断请求(从硬件中取完数据后发送一次软断请求，复杂逻辑交给下半部分请求，)，称为硬中断，特点是处理速度快<br><br>第二阶段(下半部请求)： 内核线程接受到上半部分软中断请求，就会异步的继续执行上半部未完成的请求， 称为软中断，特点延迟执行<br><br>举个网络接受数据例子：<br><br>当网卡接收到数据时，首先会发送一个硬中断请求，这个时候CPU就会执行中断处理程序，快速将网卡中数据读取到内存中，完成后会发送一个软中断请求，下半部被软中断信号唤醒后就会按照网络协议栈将内存数据进行解析处理，最终递给应用程序。(处理期间还是可以响应其他硬中断请求的)<br><br>3、查看硬中断和软中断运行情况<br><br><br><br>可以查看 &#47;proc&#47;interrupts 和 &#47;proc&#47;softirq 文件<br><br><br><br><br>","like_count":6},{"had_liked":false,"id":48310,"user_name":"茴香根","can_delete":false,"product_type":"c1","uid":1316111,"ip_address":"","ucode":"B91C00B72077F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/0f/954be2db.jpg","comment_is_top":false,"comment_ctime":1544417739,"is_pvip":false,"replies":[{"id":"17362","content":"内核管理的任务一般叫线程是因为它们没有独立的虚拟内存空间，并且它也不会去跟用户空间内存交互。","user_name":"作者回复","comment_id":48310,"uid":"1001282","ip_address":"","utype":1,"ctime":1544489346,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"27314221515","product_id":100020901,"comment_content":"老师说软中断是在内核线程ksoftirqd&#47;cpu中运行。思考和疑问，这个内核线程为什么叫线程，不是进程吗？猜测这个线程很特殊，属于内核中的某一进程，而且这个进程还能够直接与挂接的用户空间内存进行交互。","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432122,"discussion_content":"内核管理的任务一般叫线程是因为它们没有独立的虚拟内存空间，并且它也不会去跟用户空间内存交互。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544489346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321937,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2b/d1/05acc6cb.jpg","nickname":"小马哥","note":"","ucode":"2B5FB3916DEE63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532675,"discussion_content":"软中断有几个执行时机，一般会在irq_exit时查询有哪些pending的sortirq去执行，处理数量是有限的，这时处于中断上下文，为了防止其他进程饥饿获取不到cpu去执行，才有了了softirqd内核线程去处理剩余的softirq, 不是所有softirq都在内核线程中运行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637665272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73830,"user_name":"沙皮狗","can_delete":false,"product_type":"c1","uid":1308340,"ip_address":"","ucode":"FD7F6E2B5C38C2","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/b4/e4d13c1a.jpg","comment_is_top":false,"comment_ctime":1552011660,"is_pvip":false,"replies":[{"id":"27481","content":"这儿区分的更细了，tasklet 也是基于软中断的，而工作队列则是用于可以睡眠的下半部处理过程","user_name":"作者回复","comment_id":73830,"uid":"1001282","ip_address":"","utype":1,"ctime":1552399084,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18731880844","product_id":100020901,"comment_content":"老师，有一点很疑惑。在《Linux内核设计与实现》一书中提到&quot;在2.6以后的内核中提到，目前有三种方式实现中断下半部：工作队列，tasklet和软中断，软中断机制并不完全等同于中断下半部，很多人把所有下半部当成是软中断。&quot;请问这部分怎么理解？麻烦老师解答一下","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442297,"discussion_content":"这儿区分的更细了，tasklet 也是基于软中断的，而工作队列则是用于可以睡眠的下半部处理过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552399084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53388,"user_name":"科学Jia","can_delete":false,"product_type":"c1","uid":1080409,"ip_address":"","ucode":"95430413F82A69","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/59/26b1e65a.jpg","comment_is_top":false,"comment_ctime":1545636666,"is_pvip":false,"replies":[{"id":"19442","content":"当然可能了，比如还是以网络软中断为例，同样发送1GB数据包，每次发送1KB跟每次发送32B带来的结果肯定是不同的。<br><br>具体优化方法不要太着急，先定位出根源，之后一般都不难找出解决方法。","user_name":"作者回复","comment_id":53388,"uid":"1001282","ip_address":"","utype":1,"ctime":1545695644,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18725505850","product_id":100020901,"comment_content":"老师老师，女童鞋举手问您，软中断既然是内核方式运行，那就没有可能是应用程序引起，那如果软中断很频繁，作为应用程序该怎么考虑解决内核的问题？很忧伤啊。","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434123,"discussion_content":"当然可能了，比如还是以网络软中断为例，同样发送1GB数据包，每次发送1KB跟每次发送32B带来的结果肯定是不同的。\n\n具体优化方法不要太着急，先定位出根源，之后一般都不难找出解决方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545695644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48309,"user_name":"饼子","can_delete":false,"product_type":"c1","uid":1085953,"ip_address":"","ucode":"981A44836A5216","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/01/c723d180.jpg","comment_is_top":false,"comment_ctime":1544417539,"is_pvip":false,"replies":[{"id":"17271","content":"软中断问题在大流量网络中最为常见","user_name":"作者回复","comment_id":48309,"uid":"1001282","ip_address":"","utype":1,"ctime":1544435376,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18724286723","product_id":100020901,"comment_content":"积累了知识，但是没有遇到优化软中断的情况，不知道在哪些情况下会考虑进去？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432121,"discussion_content":"软中断问题在大流量网络中最为常见","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544435376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48265,"user_name":"靠人品去赢","can_delete":false,"product_type":"c1","uid":1301286,"ip_address":"","ucode":"7A20F9EBE847E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg","comment_is_top":false,"comment_ctime":1544407623,"is_pvip":false,"replies":[{"id":"17278","content":"这属于进程间通信的“信号”机制","user_name":"作者回复","comment_id":48265,"uid":"1001282","ip_address":"","utype":1,"ctime":1544436388,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18724276807","product_id":100020901,"comment_content":"问一个很low的问题，我们平常有时候会使用crtl+z ，crtl+c这种挂起或中断的命令，跟文中提到的硬中断，软中断是否有什么关联。","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432094,"discussion_content":"这属于进程间通信的“信号”机制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48258,"user_name":"阿巍-豆夫","can_delete":false,"product_type":"c1","uid":1005123,"ip_address":"","ucode":"732188848B0A85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1544406932,"is_pvip":false,"replies":[{"id":"17365","content":"中断是内核中的任务，可以理解为跟线程是并列的概念，但它的优先级更高。<br><br>中断中也没有进程的概念，线程才是调度的基本单位。","user_name":"作者回复","comment_id":48258,"uid":"1001282","ip_address":"","utype":1,"ctime":1544489608,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18724276116","product_id":100020901,"comment_content":"老师，请教下，一般进程都是多线程运行的。你所说的中断是线程的级别，还是进程的级别？ 送外卖的场景没有解释到多线程的场景。 如果是多线程是不是根本不存在中断的情况？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432091,"discussion_content":"中断是内核中的任务，可以理解为跟线程是并列的概念，但它的优先级更高。\n\n中断中也没有进程的概念，线程才是调度的基本单位。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544489608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48199,"user_name":"Days","can_delete":false,"product_type":"c1","uid":1317834,"ip_address":"","ucode":"4DDB1CD8F493E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/ca/9afb89a2.jpg","comment_is_top":false,"comment_ctime":1544401662,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18724270846","product_id":100020901,"comment_content":"而下半部以内核线程的方式执行，并且每个 CPU 都对应一个软中断内核线程，<br>这里我觉得不是所有软中断直接被ksoftirqd处理，只有大量软中断产生，或者处理软终端超时才唤醒ksoftirqd线程","like_count":4,"discussions":[{"author":{"id":1321937,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2b/d1/05acc6cb.jpg","nickname":"小马哥","note":"","ucode":"2B5FB3916DEE63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532676,"discussion_content":"是的，每次irq_exit时候会处理一波softirq, 此时处于中断上下文，剩下的才会在softirqd内核线程去处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637665338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91132,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1556874778,"is_pvip":false,"replies":[{"id":"33126","content":"这是发行版的问题，忽略多余的就可以了","user_name":"作者回复","comment_id":91132,"uid":"1001282","ip_address":"","utype":1,"ctime":1557326210,"user_name_real":"倪朋飞"}],"discussion_count":6,"race_medal":0,"score":"14441776666","product_id":100020901,"comment_content":"明明只有两个cpu ，请问老师为何会出现多个CPU呢？百度无果<br>[root@master ~]# grep processor &#47;proc&#47;cpuinfo |wc -l<br>2<br>[root@master ~]# head -1 &#47;proc&#47;softirqs<br>                    CPU0       CPU1       CPU2       CPU3       CPU4       CPU5       CPU6       CPU7       CPU8       CPU9       CPU10      CPU11      CPU12      CPU13      CPU14      CPU15      CPU16      CPU17      CPU18      CPU19      CPU20      CPU21      CPU22      CPU23      CPU24      CPU25      CPU26      CPU27      CPU28      CPU29      CPU30      CPU31      CPU32      CPU33      CPU34      CPU35      CPU36      CPU37      CPU38      CPU39      CPU40      CPU41      CPU42      CPU43      CPU44      CPU45      CPU46      CPU47      CPU48      CPU49      CPU50      CPU51      CPU52      CPU53      CPU54      CPU55      CPU56      CPU57      CPU58      CPU59      CPU60      CPU61      CPU62      CPU63      CPU64      CPU65      CPU66      CPU67      CPU68      CPU69      CPU70      CPU71      CPU72      CPU73      CPU74      CPU75      CPU76      CPU77      CPU78      CPU79      CPU80      CPU81      CPU82      CPU83      CPU84      CPU85      CPU86      CPU87      CPU88      CPU89      CPU90      CPU91      CPU92      CPU93      CPU94      CPU95      CPU96      CPU97      CPU98      CPU99      CPU100     CPU101     CPU102     CPU103     CPU104     CPU105     CPU106     CPU107     CPU108     CPU109     CPU110     CPU111     CPU112     CPU113     CPU114     CPU115     CPU116     CPU117     CPU118     CPU119     CPU120     CPU121     CPU122     CPU123     CPU124     CPU125     CPU126     CPU127<br>","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448819,"discussion_content":"这是发行版的问题，忽略多余的就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557326210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185506,"discussion_content":"遇到显示软中断终端输出对齐问题下面命令\ncat /proc/softirqs | column -t  | cut -c -82","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1582631512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2021302,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d7/b6/534c036e.jpg","nickname":"可以告诉我你名字嘛","note":"","ucode":"AAAA58E95F54D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277308,"discussion_content":"我碰到这种情况是因为vsphere/vmware中开启了CPU热插拔, 关闭之后就恢复了正常","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1591025322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2015048,"avatar":"","nickname":"kingsoft","note":"","ucode":"DF8B6CA44D2BBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276581,"discussion_content":"打印对齐：\nawk &#39;NR==FNR{for(i=1;i<=32;i++) \n        max[i] = length($i) > max[i] ? length($i) : max[i]; next} \n{ for(i=1;i<=32;i++) printf &#34;%-&#34;max[i]&#34;s  &#34;, $i; printf &#34;\\n&#34;}&#39; /proc/softirqs /proc/softirqs","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590907814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1191069,"avatar":"https://static001.geekbang.org/account/avatar/00/12/2c/9d/cc150980.jpg","nickname":"崔巍","note":"","ucode":"1EE10CE5A3CECD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319555,"discussion_content":"2个物理CPU，128个逻辑CORE也是有可能的，比如单CPU 32个物理核，每个核物理双线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604050053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1362659,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ca/e3/447aff89.jpg","nickname":"记事本","note":"","ucode":"76F2CAFA309437","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5690,"discussion_content":"我这打印出来也这样  用命令可以忽略吗  看着太难受了…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566438469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48435,"user_name":"一往而深","can_delete":false,"product_type":"c1","uid":1318374,"ip_address":"","ucode":"BDB71744934669","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/e6/c8f20c9e.jpg","comment_is_top":false,"comment_ctime":1544443899,"is_pvip":false,"replies":[{"id":"17337","content":"对的，硬中断优先处理","user_name":"作者回复","comment_id":48435,"uid":"1001282","ip_address":"","utype":1,"ctime":1544487851,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14429345787","product_id":100020901,"comment_content":"我也来理解一下，先来硬的：<br>硬件层面，来事情了cpu就必须过来处理，网卡就能存储那么多数据，如果设计成延迟的话可能有丢数据的坑，所以必须过来把数据拿出来放在容量大的地方，然后就进入下半场，软中断，应该就没那么着急了，有时间就给它处理掉，软中断处理过程中应该也是可以再处理硬中断的。意淫一下 不知道对不对啊","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432177,"discussion_content":"对的，硬中断优先处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544487851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48417,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":1258789,"ip_address":"","ucode":"63A002997462E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/35/25/bab760a1.jpg","comment_is_top":false,"comment_ctime":1544440223,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14429342111","product_id":100020901,"comment_content":"期待第二篇，我有个业务48核心，怎么调整都是只用了前面24核心的软中断，期待更新","like_count":3,"discussions":[{"author":{"id":1312635,"avatar":"https://static001.geekbang.org/account/avatar/00/14/07/7b/db7fa67e.jpg","nickname":"阿梵杰～","note":"","ucode":"EBF291933B16E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128313,"discussion_content":"numa架构导致的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578627795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54307,"user_name":"涛涛","can_delete":false,"product_type":"c1","uid":1180810,"ip_address":"","ucode":"747C4B1F20A2D3","user_header":"https://static001.geekbang.org/account/avatar/00/12/04/8a/ff94bd60.jpg","comment_is_top":false,"comment_ctime":1545825357,"is_pvip":false,"replies":[{"id":"19692","content":"吃外卖露馅了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545832907,"ip_address":"","comment_id":54307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135759949","product_id":100020901,"comment_content":"倪老师是不是总吃外卖。","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434422,"discussion_content":"吃外卖露馅了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50778,"user_name":"Glen","can_delete":false,"product_type":"c1","uid":1318413,"ip_address":"","ucode":"13693860B3613C","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/0d/f8ad03fb.jpg","comment_is_top":false,"comment_ctime":1545044027,"is_pvip":false,"replies":[{"id":"18476","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545144462,"ip_address":"","comment_id":50778,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134978619","product_id":100020901,"comment_content":"留言里也有很多资深的同学啊","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433097,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545144462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48627,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1544500093,"is_pvip":false,"replies":[{"id":"17462","content":"可以从两个方面考虑，一个是应用的指标，比如吞吐量、响应时间等等，另外一个是系统的资源使用情况，比如CPU、I&#47;O等等。<br><br>性能的优化方法和基准测试会讲的。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544521328,"ip_address":"","comment_id":48627,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134434685","product_id":100020901,"comment_content":"老师，我开发了一个日志搜集系统，上面需要压测，但是我不知道要测试哪些性能指标，这个应用的性能指标和优化和压测后面的课程会讲吗","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432280,"discussion_content":"可以从两个方面考虑，一个是应用的指标，比如吞吐量、响应时间等等，另外一个是系统的资源使用情况，比如CPU、I/O等等。\n\n性能的优化方法和基准测试会讲的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48248,"user_name":"好说","can_delete":false,"product_type":"c1","uid":1211019,"ip_address":"","ucode":"58E861D711D935","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/8b/2c81a375.jpg","comment_is_top":false,"comment_ctime":1544406267,"is_pvip":false,"replies":[{"id":"17280","content":"先留个悬念😊，I&#47;O部分会讲的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436638,"ip_address":"","comment_id":48248,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134340859","product_id":100020901,"comment_content":"老师，生产环境的服务器的磁盘数量一般有很多，每块盘读写都比较高，有某块盘特别高，这个时候想要获取哪个进程使得这块盘IO特别高要怎么分析呢","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432087,"discussion_content":"先留个悬念😊，I/O部分会讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301591,"user_name":"张贺","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1625752773,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5920720069","product_id":100020901,"comment_content":"软中断可以被打断吗？","like_count":1,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579116,"discussion_content":"应该是可以的，因为硬中断的优先级高于进程和线程，而软中断是线程所以应该可以被打断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657180469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252492,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1602318736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5897286032","product_id":100020901,"comment_content":"外卖解释软中断一听就懂，十分感谢！","like_count":1},{"had_liked":false,"id":236861,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595570757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5890538053","product_id":100020901,"comment_content":"总结：<br>✨进程的不可中断状态是系统的一种保护机制，可以保证硬件的交互过程不被意外打断。所以，短时间的不可中断状态是很正常的。<br>✨ 中断其实是一种异步的事件处理机制，可以提高系统的并发处理能力。由于中断处理程序会打断其他进程的运行，所以，为了减少对正常进程运行调度的影响，中断处理程序就需要尽可能快地运行。<br>✨ 如果中断本身要做的事情不多，那么处理起来也不会有太大问题；<br>如果中断要处理的事情很多，中断服务程序就有可能要运行很长时间。特别是，中断处理程序在响应中断时，还会临时关闭中断。这就会导致上一次中断处理完成之前，其他中断都不能响应，也就是说中断有可能会丢失。<br>✨为了解决中断处理程序执行过长和中断丢失的问题，Linux 将中断处理过程分成了两个阶段，也就是上半部和下半部：<br>* 上半部处理硬件请求，把网卡数据读取到内存中，更新硬件寄存器状态。发送软中断信号通知下半部执行。<br>* 下半部由内核触发，被软中断信号唤醒后，从内存找到网络数据，按网络协议栈，对数据进行解析处理，直到发给应用程序。<br>* 上半部会打断 CPU 正在执行的任务，然后立即执行中断处理程序。<br>* 而下半部以内核线程的方式执行，并且每个 CPU 都对应一个软中断内核线程，名字为 ksoftirqd&#47;CPU 编号，比如ksoftirqd&#47;0<br>✨ proc文件系统，是一种内核空间和用户空间的通信机制，可以查看内核数据结构，或者来修改内核配置。<br>* &#47;proc&#47;softirqs 提供了软中断的运行情况；<br>* &#47;proc&#47;interrupts 提供了硬中断的运行情况。<br>①通过cat &#47;proc&#47;softirqs查看软中断10种类型：<br>NET_RX 表示网络接收中断<br>NET_TX 表示网络发送中断。<br>②查看软中断内核线程的运行状况：ps aux | grep softirq<br>③ps 的输出中，名字括在中括号里的，一般都是内核线程","like_count":1},{"had_liked":false,"id":234409,"user_name":"衹是一支歌","can_delete":false,"product_type":"c1","uid":1456239,"ip_address":"","ucode":"9FC36529C9FD2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaZdMmzM0Vfass2ukHOqGgSBbtJMwb4NxDvLdN3R67iczzPVdtF0F0WS0abvls3edQpOVxaUJBmlr2YxHzUpveIQ/132","comment_is_top":false,"comment_ctime":1594687030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5889654326","product_id":100020901,"comment_content":"注意，这些线程的名字外面都有中括号，这说明 ps 无法获取它们的命令行参数（cmline）。一般来说，ps  的输出中，名字括在中括号里的，一般都是内核线程。<br>～～～～～<br>ps看到的不都是进程吗？老师这里说的是内核线程。难道我一直都理解错了？","like_count":1},{"had_liked":false,"id":226547,"user_name":"Geek_4254d8","can_delete":false,"product_type":"c1","uid":1635021,"ip_address":"","ucode":"806A8116A3177F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MIbA6MRiblftUawVWvKt6jvgOvTwibKsTCJhh5y5vKEuURtcEZDtylwGFfekZBanmwIgNSJTm9YMmZlPPicDQ14Iw/132","comment_is_top":false,"comment_ctime":1592137978,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5887105274","product_id":100020901,"comment_content":"请问一下cat &#47;proc&#47;softirqs 中BLOCK、IRQ_POLL、HI、HRTIMER、TASKLET 这几个参数怎么理解？我翻了一下man proc并没找到说明。<br>TASKLET  可以理解为系统一个硬中断后调用TASKLET  函数，在开始处理下半部之前陆续收到多少中断吗？","like_count":1},{"had_liked":false,"id":95730,"user_name":"强子","can_delete":false,"product_type":"c1","uid":1528598,"ip_address":"","ucode":"1002DA5D645FE5","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJF8NpRdF7fOetWvmBfOFvUfNkV7OoRnVdKoyTUBhOqCnibSyibGngGYEibn5QGMuXic66enqG9OS7jWA/132","comment_is_top":false,"comment_ctime":1558151235,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853118531","product_id":100020901,"comment_content":"这才是工程派的","like_count":1},{"had_liked":false,"id":81209,"user_name":"Geek_94e115","can_delete":false,"product_type":"c1","uid":1476955,"ip_address":"","ucode":"DBDB27A0472B55","user_header":"","comment_is_top":false,"comment_ctime":1553830991,"is_pvip":false,"replies":[{"id":"29586","content":"谢谢分享👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554003222,"ip_address":"","comment_id":81209,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848798287","product_id":100020901,"comment_content":"3. 软中断分析  #https:&#47;&#47;www.cnblogs.com&#47;cherishui&#47;p&#47;4318660.html<br>\t- softirq_vec[32]<br>\t- open_softirq #软终端注册<br>\t- __softirq_pending  #软终端执行位图 对应bit被设置  #通过 raise_softirq_irqoff 开启某个软终端<br>\t- _do_softirq #遍历 sirq vec #执行对应类型的 sirq  的action <br>\t- 前者被调用的时机 #硬件中断处理完，返回时调用(irq_exit()) # ksoftirqd - wakeup_softirqd  #local_bh_enable bh执行前，如果不在硬中断中，就执行软中断 ，这样可以保证 hirq 和 sirq 的有序 <br>\t","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445118,"discussion_content":"谢谢分享👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554003222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79774,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1553557190,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5848524486","product_id":100020901,"comment_content":"根据我的经验，网络包最小是64字节，加上20字节的帧头和帧尾，最小数据帧是84字节。文中出现的54字节，应该是网络包，但最小不是64字节吗？","like_count":1,"discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52326,"discussion_content":"最小是64 但是这个64就是最小帧长 包括6+4+4的帧首部 和 4字节的帧尾crc校验，一共18字节。 中间的数据报最小是46字节。 加起来是64","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1574039507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79734,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1553528162,"is_pvip":false,"replies":[{"id":"29338","content":"ps 或者 pidstat 都可以","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553698658,"ip_address":"","comment_id":79734,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848495458","product_id":100020901,"comment_content":"我想问个问题，缺页中断有统计信息吗","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444601,"discussion_content":"ps 或者 pidstat 都可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553698658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55218,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1546067668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841034964","product_id":100020901,"comment_content":"D3","like_count":1},{"had_liked":false,"id":50287,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544944523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839911819","product_id":100020901,"comment_content":"DAY9,打卡","like_count":1},{"had_liked":false,"id":49192,"user_name":"春暖花开","can_delete":false,"product_type":"c1","uid":1215253,"ip_address":"","ucode":"8B7D3BA1C1DD1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/8b/15/5278f52a.jpg","comment_is_top":false,"comment_ctime":1544620025,"is_pvip":false,"replies":[{"id":"17657","content":"可以的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660346,"ip_address":"","comment_id":49192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839587321","product_id":100020901,"comment_content":"是否可以将中断处理专门属于一个核心cpu处理，通过亲和性","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432521,"discussion_content":"可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49137,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1544609561,"is_pvip":false,"replies":[{"id":"17663","content":"会的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660511,"ip_address":"","comment_id":49137,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839576857","product_id":100020901,"comment_content":"软中断时间太长会不会影响性能","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432498,"discussion_content":"会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48793,"user_name":"魏峰","can_delete":false,"product_type":"c1","uid":1146412,"ip_address":"","ucode":"33F5D09C64D4C4","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/2c/54d68da4.jpg","comment_is_top":false,"comment_ctime":1544538356,"is_pvip":false,"replies":[{"id":"17701","content":"除了软中断，更大的问题是文件IO","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662068,"ip_address":"","comment_id":48793,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839505652","product_id":100020901,"comment_content":"scp小文件很慢的的原因是网络小包的软中断？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432355,"discussion_content":"除了软中断，更大的问题是文件IO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48653,"user_name":"小白","can_delete":false,"product_type":"c1","uid":1214348,"ip_address":"","ucode":"B49CCFD368D65E","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/8c/e67751f2.jpg","comment_is_top":false,"comment_ctime":1544507561,"is_pvip":false,"replies":[{"id":"17458","content":"没问题，这是只有一个CPU","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520924,"ip_address":"","comment_id":48653,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839474857","product_id":100020901,"comment_content":"# cat &#47;proc&#47;softirqs <br>                    CPU0       <br>          HI:          1<br>       TIMER:   52670170<br>      NET_TX:          9<br>      NET_RX:    4737439<br>       BLOCK:     557149<br>BLOCK_IOPOLL:          0<br>     TASKLET:         16<br>       SCHED:          0<br>     HRTIMER:          0<br>         RCU:   32239865<br>这样的情况，是存在问题吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432294,"discussion_content":"没问题，这是只有一个CPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48231,"user_name":"胡萝卜","can_delete":false,"product_type":"c1","uid":1056926,"ip_address":"","ucode":"306139A86C182D","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/9e/3278e1d8.jpg","comment_is_top":false,"comment_ctime":1544404701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839371997","product_id":100020901,"comment_content":"打卡","like_count":1},{"had_liked":false,"id":48177,"user_name":"solar","can_delete":false,"product_type":"c1","uid":1316091,"ip_address":"","ucode":"D5BE087E264401","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dwehJHP4ycAfDb9MoudXb4QSt7YgmISqwwsa928XZ6aTWqwWh0kx0iatjocSibLa7iajXmbGlJ5svegY3P6LfKJ0w/132","comment_is_top":false,"comment_ctime":1544394231,"is_pvip":true,"replies":[{"id":"17851","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746545,"ip_address":"","comment_id":48177,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839361527","product_id":100020901,"comment_content":"打卡，又学到一些很细节的东西，感动","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432062,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48170,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1544379772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839347068","product_id":100020901,"comment_content":"D9","like_count":1},{"had_liked":false,"id":360609,"user_name":"Geek_b3b8da","can_delete":false,"product_type":"c1","uid":3065276,"ip_address":"浙江","ucode":"5461CD95B1D764","user_header":"","comment_is_top":false,"comment_ctime":1666686106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666686106","product_id":100020901,"comment_content":"我翻遍了百度和谷歌包括头条只找到了<br>NET_TX：是网络接收<br>NET_RX：是网络发送<br>TASKLET：是最常用的软中断实现机制每个TASKLET只运行一次就会结束 ，并且只在调用它的函数所在的CPU上运行<br>RCU：是cpu的常见锁类型<br>SCHED：是内核调度<br>这些参数解释","like_count":0},{"had_liked":false,"id":355739,"user_name":"白雨轩","can_delete":false,"product_type":"c1","uid":1123492,"ip_address":"河北","ucode":"ACCFAFD777427F","user_header":"https://static001.geekbang.org/account/avatar/00/11/24/a4/fdcde25d.jpg","comment_is_top":false,"comment_ctime":1661705038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661705038","product_id":100020901,"comment_content":"我翻遍了谷歌和百度，也没发现对软中断有个好的定义","like_count":0},{"had_liked":false,"id":351895,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1658282309,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1658282309","product_id":100020901,"comment_content":"day9 ","like_count":0},{"had_liked":false,"id":336948,"user_name":"ZHANGPING","can_delete":false,"product_type":"c1","uid":1918112,"ip_address":"","ucode":"7108812981C996","user_header":"https://static001.geekbang.org/account/avatar/00/1d/44/a0/16d0d300.jpg","comment_is_top":false,"comment_ctime":1646485593,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646485593","product_id":100020901,"comment_content":"你好，老师，这样理解对吗？<br>1.在网络数据解析这部分是内核线程在负责，假如是同步IO，是内核线程处理结束后，来告知业务线程可以返回了","like_count":0},{"had_liked":false,"id":326614,"user_name":"fx","can_delete":false,"product_type":"c1","uid":2334235,"ip_address":"","ucode":"CA9066014707F3","user_header":"https://static001.geekbang.org/account/avatar/00/23/9e/1b/7abfa59f.jpg","comment_is_top":false,"comment_ctime":1639584020,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1639584020","product_id":100020901,"comment_content":"前面平均负载章节讲的不可中断和这个中断是什么关系呀？","like_count":0,"discussions":[{"author":{"id":2401422,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","nickname":"geek","note":"","ucode":"FF0845140D72A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549136,"discussion_content":"不可中断是进程的一种状态，是由于进程访问设备导致的；中断是一种内核响应外部设备的io的机制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643614456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312934,"user_name":"宏典","can_delete":false,"product_type":"c1","uid":2616028,"ip_address":"","ucode":"63953F36596C28","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","comment_is_top":false,"comment_ctime":1632127866,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632127866","product_id":100020901,"comment_content":"文中提到“下半部对应软中断，用来异步处理上半部未完成的工作。”<br><br>下半部和软中断不是一个概念吧，软中断只是下半部的一种机制。workqueque也是下半部的机制","like_count":0},{"had_liked":false,"id":278754,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1613295512,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613295512","product_id":100020901,"comment_content":"# cat &#47;proc&#47;softirqs<br>                    CPU0<br>          HI:          0<br>       TIMER:  104273559<br>      NET_TX:          3<br>      NET_RX:    2285771<br>       BLOCK:    1361750<br>    IRQ_POLL:          0<br>     TASKLET:         24<br>       SCHED:          0<br>     HRTIMER:        527<br>         RCU:   80280298<br><br><br>阿里云的机器支持手机输入命令，随时随地可以玩命令","like_count":0},{"had_liked":false,"id":253858,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602920950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602920950","product_id":100020901,"comment_content":"打卡<br>linux中的中断处理包括上半部跟下半部<br>上半部对应硬件中断，快速处理中断<br>下半部对应软件中断，异步处理上半部未处理的部分","like_count":0},{"had_liked":false,"id":245095,"user_name":"thomas","can_delete":false,"product_type":"c1","uid":1016777,"ip_address":"","ucode":"9AB945308F1B50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/c9/5d03981a.jpg","comment_is_top":false,"comment_ctime":1598834232,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1598834232","product_id":100020901,"comment_content":"对上半部来说，既然是快速处理，其实就是要把网卡的数据读到内存中，然后更新一下硬件寄存器的状态（表示数据已经读好了），最后再发送一个软中断信号，通知下半部做进一步的处理。<br>——————————————》<br>老师，不是网卡通过SG-DMA把数据放入到ring-buffer中，再由中断控制器发出硬中断，告知操作系统数据已准备好，然后触发软中断继续执行吗？","like_count":0},{"had_liked":false,"id":235306,"user_name":"qmq","can_delete":false,"product_type":"c1","uid":2056745,"ip_address":"","ucode":"7F1405C08D20C4","user_header":"","comment_is_top":false,"comment_ctime":1594968558,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594968558","product_id":100020901,"comment_content":"老师，你好，我这边碰到一个情况，ps aux命令就卡住，用strace命令 追踪发现是：<br>open(&quot;&#47;proc&#47;6466&#47;status&quot;, O_RDONLY)     = 6<br>read(6, &quot;Name:\\tgitlab-shell\\nState:\\tD (dis&quot;..., 2048) = 1073<br>close(6)                                = 0<br>open(&quot;&#47;proc&#47;6466&#47;cmdline&quot;, O_RDONLY)    = 6<br>read(6, <br><br>是卡在这个进程，cat这个文件也会卡住<br>[root@localhost ~]# cat &#47;proc&#47;6466&#47;cmdline <br>还好cat &#47;proc&#47;6466&#47;stat 这个命令不会<br>cat &#47;proc&#47;6466&#47;stat<br>6466 (gitlab-shell) D 1 6466 6466 0 -1 4202496 977 0 0 0 34 54 0 0 20 0 4 0 955657317 216059904 291 18446744073709551615 4194304 6713776 140733476588704 140733476587896 140009963590506 262144 2147221247 0 2143420159 18446744073709551615 0 0 17 1 0 0 0 0 0 9347072 9563488 11653120 140733476597114 140733476597180 140733476597180 140733476597693 0<br>发现进程一直处于D状态<br><br>perf pstree 只要指定这个进程都会卡住<br>","like_count":0},{"had_liked":false,"id":230807,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593500063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593500063","product_id":100020901,"comment_content":"系统中断分为软中断和硬中断，系统中断是一种异步处理机制，可以提升系统性能：<br>硬中断是硬件产生的，比如键盘输入，网卡收包等，即上半部，硬中断通常速度很快；<br>软中断是用来异步处理上半部产生的工作，和程序相关，通过内核线程的方式来处理上半部产生的工作，即下半部；<br>软中断在每个cpu上都对应一个进程，进程名为ksoftirqd&#47;cpu编号，如[ksoftirqd&#47;0]，通过ps可以查看此进程，此进程用中括号包起来，表示是内核进程；<br>通过查看&#47;proc&#47;softirqs来查看软中断信息，软中断分为10种类型，通常每种类型在各cpu之间的次数差距并不大；<br>通过查看&#47;proc&#47;interrupts来查看硬中断信息<br>如果中断次数过多也会影响到系统性能。","like_count":0},{"had_liked":false,"id":209301,"user_name":"扩散性百万咸面包","can_delete":false,"product_type":"c1","uid":1905171,"ip_address":"","ucode":"6D703D51553B42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/12/13/e103a6e3.jpg","comment_is_top":false,"comment_ctime":1587531889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587531889","product_id":100020901,"comment_content":"老师您好！请问：软中断线程的作用是接受软中断信号，然后调用其他系统线程来完成未完成的工作吗？","like_count":0},{"had_liked":false,"id":199336,"user_name":"盘尼西林","can_delete":false,"product_type":"c1","uid":1197347,"ip_address":"","ucode":"B59569FC25144F","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/23/28311447.jpg","comment_is_top":false,"comment_ctime":1585487136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585487136","product_id":100020901,"comment_content":"中断和我们一般知道的 事件有什么区别？","like_count":0},{"had_liked":false,"id":172675,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579249708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579249708","product_id":100020901,"comment_content":"补打卡，Day 8，中断是一种异步的事件处理机制，可以提高系统的并发处理能力。Linux 将中断处理过程分成了两个阶段，上半部对应硬中断，用来快速处理中断，下半部对应软中断，用来异步处理上半部未完成的工作。软中断是以内核线程的方式运行的，每个 CPU 都对应一个软中断内核线程。Linux 中的软中断包括网络收发、定时、调度、RCU 锁等各种类型。&#47;proc&#47;softirqs 查看软中断的运行情况，&#47;proc&#47;interrupts 查看硬中断的运行情况。","like_count":0},{"had_liked":false,"id":168327,"user_name":"郭慧","can_delete":false,"product_type":"c1","uid":1786095,"ip_address":"","ucode":"913053980A960A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/40/ef/053e0ed2.jpg","comment_is_top":false,"comment_ctime":1578047867,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578047867","product_id":100020901,"comment_content":"老师 响应时间0.007s 16cpu网络接受软中断只分布在一颗cpu，而且是持续增长，这正常吗？","like_count":0},{"had_liked":false,"id":132514,"user_name":"苦行僧","can_delete":false,"product_type":"c1","uid":1055334,"ip_address":"","ucode":"726024A9A9CF44","user_header":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","comment_is_top":false,"comment_ctime":1568159759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568159759","product_id":100020901,"comment_content":"打卡学习软中断","like_count":0},{"had_liked":false,"id":131177,"user_name":"YUN","can_delete":false,"product_type":"c1","uid":1269012,"ip_address":"","ucode":"5FCB60C3C59E44","user_header":"https://static001.geekbang.org/account/avatar/00/13/5d/14/01679021.jpg","comment_is_top":false,"comment_ctime":1567662111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567662111","product_id":100020901,"comment_content":"老师一般中断次数多少以内是比较合理的？","like_count":0},{"had_liked":false,"id":121450,"user_name":"Alpha","can_delete":false,"product_type":"c1","uid":1227737,"ip_address":"","ucode":"E6652D2E2C357F","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/d9/6175dbab.jpg","comment_is_top":false,"comment_ctime":1565141186,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1565141186","product_id":100020901,"comment_content":"8核cpu下的软中断类型差别不是一般大呢，跟上面说到的不一样<br>root@confluence:~# cat &#47;proc&#47;softirqs <br>                    CPU0       CPU1       CPU2       CPU3       CPU4       CPU5       CPU6       CPU7       <br>          HI:          0          0          0          0          0          0          0          0<br>       TIMER:  144218970   30233762     835233     764087     973251     988154    3091441     862895<br>      NET_TX:         54          2          0          0          0          0    2083331          0<br>      NET_RX:   86793593          4         74          5          4          2        188          8<br>       BLOCK:    5582889          0          0          0      11511       9198       7626       7368<br>    IRQ_POLL:          0          0          0          0          0          0          0          0<br>     TASKLET:       4761          0          0          0          0          0          0          0<br>       SCHED:   82752409   29266786     701068     341747     402022     409874    2506715     508006<br>     HRTIMER:          0          0          0          0          0          0          0          0<br>         RCU:   93176472   22770588     673018     534128     577182     576177    2646005     658348<br>","like_count":0,"discussions":[{"author":{"id":1335260,"avatar":"https://static001.geekbang.org/account/avatar/00/14/5f/dc/2a8440ed.jpg","nickname":"꯭小꯭凯꯭","note":"","ucode":"AF96BE095507C9","race_medal":3,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158761,"discussion_content":"我的虚拟机也是八核的，但我查看时，有128个cpu的信息，除了前八个，剩余的值全部为零","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580621508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106422,"user_name":"魏乐","can_delete":false,"product_type":"c1","uid":1233832,"ip_address":"","ucode":"B6D50018BE67E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d3/a8/91eed372.jpg","comment_is_top":false,"comment_ctime":1561295691,"is_pvip":false,"replies":[{"id":"40454","content":"嗯，不支持嵌套","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562512005,"ip_address":"","comment_id":106422,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561295691","product_id":100020901,"comment_content":"linux里面的中断是不支持嵌套的吧？硬件中断服务程序进入后都就把中断关了。不是很确定，请老师帮忙解答","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455080,"discussion_content":"嗯，不支持嵌套","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562512005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96093,"user_name":"周谦","can_delete":false,"product_type":"c1","uid":1054264,"ip_address":"","ucode":"43520078455347","user_header":"https://static001.geekbang.org/account/avatar/00/10/16/38/88eb9377.jpg","comment_is_top":false,"comment_ctime":1558327524,"is_pvip":false,"replies":[{"id":"34565","content":"不会，还可以调度给其他需要CPU的进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558448079,"ip_address":"","comment_id":96093,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1558327524","product_id":100020901,"comment_content":"问下 D状态的进程cpu会空等这个进程吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450717,"discussion_content":"不会，还可以调度给其他需要CPU的进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558448079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1799168,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/74/00/4da5d547.jpg","nickname":"🐳","note":"","ucode":"3876D4E8CA2364","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577640,"discussion_content":"CPU时间片用完之后，就会让出CPU给运行其他进程了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656253081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87734,"user_name":"火狼王","can_delete":false,"product_type":"c1","uid":1152184,"ip_address":"","ucode":"76919311EA41A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/b8/09d86400.jpg","comment_is_top":false,"comment_ctime":1555674172,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1555674172","product_id":100020901,"comment_content":"dx","like_count":0},{"had_liked":false,"id":87445,"user_name":"bigzuo","can_delete":false,"product_type":"c1","uid":1224554,"ip_address":"","ucode":"448C258D31A8A6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/RQdib68D7dsoFlYXOweiaPqLrcyn2jD6DCGnz8nc2VFmhmX0bpGTeSrVM5M9Qs7ibIInAmt5MeLcpcNja5YjyZCIg/132","comment_is_top":false,"comment_ctime":1555597244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555597244","product_id":100020901,"comment_content":"还不是很能理解软中断和硬中断的含义，继续学习","like_count":0},{"had_liked":false,"id":86611,"user_name":"明月","can_delete":false,"product_type":"c1","uid":1476588,"ip_address":"","ucode":"D3C649B954A519","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJayib1ZcRfOaoLsdsWZokiaO5tLAdC4uNAicQJRIVXrz9fIchib7QwXibnRrsJaoh5TUlia7faUf36g8Bw/132","comment_is_top":false,"comment_ctime":1555411756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555411756","product_id":100020901,"comment_content":"讲的好好，生动。","like_count":0},{"had_liked":false,"id":83554,"user_name":"sunsweet","can_delete":false,"product_type":"c1","uid":1027879,"ip_address":"","ucode":"787F9E1EC6A67E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/27/76489618.jpg","comment_is_top":false,"comment_ctime":1554648424,"is_pvip":false,"replies":[{"id":"30381","content":"不一样，这儿主要是说中断处理程序下半部","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554815789,"ip_address":"","comment_id":83554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554648424","product_id":100020901,"comment_content":"系统调用的实现也是通过软中断，int 80指令触发，跟这里的软中断概念一样吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446069,"discussion_content":"不一样，这儿主要是说中断处理程序下半部","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554815789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81408,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1553906326,"is_pvip":false,"replies":[{"id":"29582","content":"1. 不熟悉netmap，不能并行看起来是netmap的问题。有多队列网卡后，每个队列可以绑定到不同的cpu<br>2. http是应用层了，意识不到多队列. 有什么场景需要在同一个队列？<br><br>网络模块有讲到一些优化思路，可以参考","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554002902,"ip_address":"","comment_id":81408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553906326","product_id":100020901,"comment_content":"老师不知道您是否还在看留言，有两个问题请教。一，我看一些抓包高性能库比如netmap上讲，linux协议栈无法并行处理网络消息的，这个文章看每个CPU都有软中断线程，这样是可以处理的啊。二，现在网卡几乎都是多队列的，用netmap这类库并行接受网卡数据的话，同一个会话的网络包进入队列后不均衡，导致了像Http之类一个完整会话不在一个队列中，我想问的是如何来定制网络包到网卡队列的均衡算法，谢谢，期盼回复","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445184,"discussion_content":"1. 不熟悉netmap，不能并行看起来是netmap的问题。有多队列网卡后，每个队列可以绑定到不同的cpu\n2. http是应用层了，意识不到多队列. 有什么场景需要在同一个队列？\n\n网络模块有讲到一些优化思路，可以参考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554002902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72397,"user_name":"疯码","can_delete":false,"product_type":"c1","uid":1228313,"ip_address":"","ucode":"7FF11EC80439EA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/vQiadbkZYR239J80hjekw7jzY9vy6otLKPNDSuz2lruDiaXlKGkcsX5wwiaFevicgqV8odlRG4UITiadDF3fgicrHPcw/132","comment_is_top":false,"comment_ctime":1551608157,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551608157","product_id":100020901,"comment_content":"这例子生动","like_count":0},{"had_liked":false,"id":69127,"user_name":"李亮亮","can_delete":false,"product_type":"c1","uid":1116508,"ip_address":"","ucode":"290907F930B261","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/5c/b5d79d20.jpg","comment_is_top":false,"comment_ctime":1550666396,"is_pvip":false,"replies":[{"id":"24540","content":"不一定，看具体的中断实现","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550675815,"ip_address":"","comment_id":69127,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550666396","product_id":100020901,"comment_content":"老师，我想问下上半部跟下半部是运行在同一个内核线程的吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439964,"discussion_content":"不一定，看具体的中断实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550675815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68861,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1221267,"ip_address":"","ucode":"FF679EAE2B683D","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/93/cfed7c6c.jpg","comment_is_top":false,"comment_ctime":1550624216,"is_pvip":false,"replies":[{"id":"24528","content":"不是所有的中断都会分为上半部和下半部，还有一些是纯软中断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550674610,"ip_address":"","comment_id":68861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550624216","product_id":100020901,"comment_content":"最开始的中段缺点是处理中断信号时不能响应别的中断信号。所以Linux处理中断 是分了两部分去响应中断 上半部分是硬中断 响应快 下半部分是软中断内核处理响应慢 采用了异步的方式 所以 上部分将中断信号发送给内核的时候（即软中断） 必然会先存到一个数据队列中。下半部分是从队列中去取的数据。所以 在Linux发生了中断 必然是硬中断和软中断同时出现的。 不知道理解的对不对。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439855,"discussion_content":"不是所有的中断都会分为上半部和下半部，还有一些是纯软中断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550674610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66542,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1549956122,"is_pvip":false,"replies":[{"id":"23719","content":"这应该是系统版本的问题，只观察系统中实际存在的CPU就可以了（其他的都是0）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550069890,"ip_address":"","comment_id":66542,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549956122","product_id":100020901,"comment_content":"我的环境也是ubantu,使用 cat &#47;proc&#47;softirqs查看，为什么显示了很多CPU，有128个？<br>root@kaipule-virtual-machine:~# cat &#47;proc&#47;softirqs <br>                    CPU0       CPU1       CPU2       CPU3       CPU4       CPU5       CPU6       CPU7       CPU8       CPU9       CPU10      CPU11      CPU12      CPU13      CPU14      CPU15      CPU16      CPU17      CPU18      CPU19      CPU20      CPU21      CPU22      CPU23      CPU24      CPU25      CPU26      CPU27      CPU28      CPU29      CPU30      CPU31      CPU32      CPU33      CPU34      CPU35      CPU36      CPU37      CPU38      CPU39      CPU40      CPU41      CPU42      CPU43      CPU44      CPU45      CPU46      CPU47      CPU48      CPU49      CPU50      CPU51      CPU52      CPU53      CPU54      CPU55      CPU56      CPU57      CPU58      CPU59      CPU60      CPU61      CPU62      CPU63      CPU64      CPU65      CPU66      CPU67      CPU68      CPU69      CPU70      CPU71      CPU72      CPU73      CPU74      CPU75      CPU76      CPU77      CPU78      CPU79      CPU80      CPU81      CPU82      CPU83      CPU84      CPU85      CPU86      CPU87      CPU88      CPU89      CPU90      CPU91      CPU92      CPU93      CPU94      CPU95      CPU96      CPU97      CPU98      CPU99      CPU100     CPU101     CPU102     CPU103     CPU104     CPU105     CPU106     CPU107     CPU108     CPU109     CPU110     CPU111     CPU112     CPU113     CPU114     CPU115     CPU116     CPU117     CPU118     CPU119     CPU120     CPU121     CPU122     CPU123     CPU124     CPU125     CPU126     CPU127     ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438826,"discussion_content":"这应该是系统版本的问题，只观察系统中实际存在的CPU就可以了（其他的都是0）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550069890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57416,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1546784667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546784667","product_id":100020901,"comment_content":"lesson9打卡","like_count":0},{"had_liked":false,"id":54598,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1545910556,"is_pvip":false,"replies":[{"id":"19951","content":"上半部也有，中断可以嵌套","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546006211,"ip_address":"","comment_id":54598,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545910556","product_id":100020901,"comment_content":"老师您好，中断优先级 针对高优先级的中断服务程序先执行，它是在下半部起作用的吗？因为上半部运行在中断禁止模式。这样理解对吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434504,"discussion_content":"上半部也有，中断可以嵌套","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546006211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51099,"user_name":"Geek_fbe6fe","can_delete":false,"product_type":"c1","uid":1250069,"ip_address":"","ucode":"E69AD55364C93E","user_header":"https://static001.geekbang.org/account/avatar/00/13/13/15/5dabb390.jpg","comment_is_top":false,"comment_ctime":1545113810,"is_pvip":false,"replies":[{"id":"18459","content":"协程是用户态的轻量级线程，也就是协程的切换都在用户态完成，用户自己来控制上下文切换","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545142655,"ip_address":"","comment_id":51099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545113810","product_id":100020901,"comment_content":"想问下老师，现在一些的语言中实现协程是不是就是利用中断的系统命令实现的协程操作呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433283,"discussion_content":"协程是用户态的轻量级线程，也就是协程的切换都在用户态完成，用户自己来控制上下文切换","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1545142655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50812,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1545049332,"is_pvip":false,"replies":[{"id":"18473","content":"+1","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545144323,"ip_address":"","comment_id":50812,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545049332","product_id":100020901,"comment_content":"Flag","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433118,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545144323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50561,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1545009648,"is_pvip":false,"replies":[{"id":"18492","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145495,"ip_address":"","comment_id":50561,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545009648","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433021,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50530,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1545007388,"is_pvip":false,"replies":[{"id":"18496","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145513,"ip_address":"","comment_id":50530,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545007388","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433012,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50422,"user_name":"铁鸟","can_delete":false,"product_type":"c1","uid":1227710,"ip_address":"","ucode":"D89CDBEA75BD40","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/be/0f96379d.jpg","comment_is_top":false,"comment_ctime":1544971083,"is_pvip":false,"replies":[{"id":"18503","content":"centos上面可能显示比较乱，可以用shell处理下再看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545146035,"ip_address":"","comment_id":50422,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544971083","product_id":100020901,"comment_content":"cat &#47;proc&#47;softirqs<br>Centos7 这个命令看到都不是文章所说的，系统差异比较大。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432979,"discussion_content":"centos上面可能显示比较乱，可以用shell处理下再看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545146035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49939,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1544793651,"is_pvip":false,"replies":[{"id":"18109","content":"同一个CPU","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004557,"ip_address":"","comment_id":49939,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544793651","product_id":100020901,"comment_content":"老师，您好，问一下 是不是上半部的硬中断和下半部的软中断 是发生在同一个 CPU 上吗？还是说 上半部 执行完，下半部可以调度到 其他 CPU 上执行接下来的？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432809,"discussion_content":"同一个CPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49647,"user_name":"Mike","can_delete":false,"product_type":"c1","uid":1013168,"ip_address":"","ucode":"58601DD413ACC0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/b0/17f46582.jpg","comment_is_top":false,"comment_ctime":1544749670,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544749670","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":49228,"user_name":"张强","can_delete":false,"product_type":"c1","uid":1334882,"ip_address":"","ucode":"F6899441D85911","user_header":"https://static001.geekbang.org/account/avatar/00/14/5e/62/a6631e94.jpg","comment_is_top":false,"comment_ctime":1544626496,"is_pvip":false,"replies":[{"id":"17845","content":"可能是客户端临时错误导致的，少量一般不需要关系，等着系统清理就可以。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746142,"ip_address":"","comment_id":49228,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544626496","product_id":100020901,"comment_content":"倪老师，您好。我今天遇到个问题，服务端监听程序收到的客户端的连接状态使用netstat命令看到有几个syn_recv状态（少量），我使用telnet新的连接来测试也是这个状态。客户端的请求数量规模很小，在个位数。这种问题的解决思路是什么？很难出现，重启后好了，其他监听端口也没问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432540,"discussion_content":"可能是客户端临时错误导致的，少量一般不需要关系，等着系统清理就可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48913,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1544577748,"is_pvip":false,"replies":[{"id":"17692","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661812,"ip_address":"","comment_id":48913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544577748","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432415,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48909,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1544577368,"is_pvip":false,"replies":[{"id":"17687","content":"嗯嗯 不太准确。两种中断的触发都是异步的，只是处理的任务多少问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661591,"ip_address":"","comment_id":48909,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544577368","product_id":100020901,"comment_content":"用外卖的例子形象的说明了中断，很清晰，我可以比一个不大恰当的例子，就是同步和异步，是不是就像硬中断和软中断","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432414,"discussion_content":"嗯嗯 不太准确。两种中断的触发都是异步的，只是处理的任务多少问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48705,"user_name":"Wendy","can_delete":false,"product_type":"c1","uid":1308653,"ip_address":"","ucode":"398DDC96B178F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0PT9LxT8D6micyk0YbPuGQElQIeSax7puBBTXJDicJDhUHNibrbJPjEPJBRklVmcKG1PB7YV8JNh0BpsJjSicfibT5A/132","comment_is_top":false,"comment_ctime":1544519508,"is_pvip":false,"replies":[{"id":"17705","content":"谢谢分享和讨论","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662139,"ip_address":"","comment_id":48705,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544519508","product_id":100020901,"comment_content":"答复wykkx，兄弟，你用pidstat -t 1 查看一下java线程嘛，你说的有点类似于短时进程，ps看看进程状态有哪些，是否有僵尸进程？是否java程序在大量的调用短时函数(进程)？。我们目前学了以下几个指标:cpu使用率、iowait、上下文切换、软硬中断。你比照一下这几个指标。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432317,"discussion_content":"谢谢分享和讨论","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48694,"user_name":"风萧雨瑟","can_delete":false,"product_type":"c1","uid":1317323,"ip_address":"","ucode":"5E832ABE126393","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/cb/70a2b47e.jpg","comment_is_top":false,"comment_ctime":1544517217,"is_pvip":false,"replies":[{"id":"17846","content":"查看一下SSD是不是有错误发生？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746265,"ip_address":"","comment_id":48694,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544517217","product_id":100020901,"comment_content":"老师我这里有一个问题请教一下：mysql的一台新机器:CentOS  7.5，32c 64G内存。ssd盘。将mysql 参数innodb_flush_log_at_trx_commit设置为1的时候会出现mysql复制延迟增大，iostat观察%util能达到50%。而同样的其它从库，机器规格,mysql参数都一样。但却不会出这样的情况。 iostat只有百分之几。 但将innodb_flush_log_at_trx_commit调整为2的时候复制就完全正常了，%util也降到正常水平。innodb_flush_log_at_trx_commit是会影响刷盘操作。但其它机器都没有出现这种情况。 对ssd硬盘我通过fio做测试，iops随机读写结果跟其它机器上的ssd盘区别不大。  并且，这台机器上的两块ssd我都测试过。情况一样。<br>不正常的这台机器iostat结果<br>iostat -d sda1 -x 2 -m<br>Linux 3.10.0-862.9.1.el7.x86_64 (g1-db-rw-15) \t12&#47;11&#47;2018 \t_x86_64_\t(32 CPU)<br>Device            r&#47;s     w&#47;s     rMB&#47;s     wMB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda1             7.50  268.00      0.12      2.25     0.00     0.00   0.00   0.00    1.00    0.84   0.23    16.00     8.61   0.77  21.35<br><br>Device            r&#47;s     w&#47;s     rMB&#47;s     wMB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda1             4.98  387.56      0.08      2.98     0.00     0.00   0.00   0.00    0.40    0.93   0.36    16.00     7.87   0.79  31.09<br>正常的从库iostat结果：<br>iostat -d sda1 -x 2 -m<br>Linux 2.6.32-431.el6.x86_64 (g1-db-cat-02) \t12&#47;11&#47;2018 \t_x86_64_\t(32 CPU)<br>Device:         rrqm&#47;s   wrqm&#47;s     r&#47;s     w&#47;s    rMB&#47;s    wMB&#47;s avgrq-sz avgqu-sz   await  svctm  %util<br>sda1              0.00     0.00   13.50  339.00     0.21     4.06    24.84     0.07    0.19   0.11   3.95<br>Device:         rrqm&#47;s   wrqm&#47;s     r&#47;s     w&#47;s    rMB&#47;s    wMB&#47;s avgrq-sz avgqu-sz   await  svctm  %util<br>sda1              0.00     0.00   11.00  268.00     0.17     3.81    29.20     0.05    0.18   0.14   4.00<br>这两个机器因为系统不一样。iostat内容显示略有不同，有问题的这台我升级过sysstat，升级之前iostat显示内容基本一样。<br>有一点很疑惑：两台规格一样的机器。都是从库，都是独点一块ssd，ssd fio测试也无多大区别。为何写入性能上差别很大。    <br>通过perf来抓取看的话。有问题的这台显示：<br>libpthread-2.17.so   [.] start_thread - start_thread - 63.21% io_handler_thread - 63.21% fil_aio_wait - 45.23% os_aio_handler - 28.35% os_file_write_page  因为这台从库上没有负载，单纯只是个从库。<br>top<br>%Cpu19 :  3.4 us,  2.0 sy,  0.0 ni, 58.4 id, 36.2 wa,  0.0 hi,  0.0 si,  0.0 st<br>%CPU：17.2","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432313,"discussion_content":"查看一下SSD是不是有错误发生？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48657,"user_name":"wykkx","can_delete":false,"product_type":"c1","uid":1122358,"ip_address":"","ucode":"ABCDF49E7A95C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/36/b3e2f1d5.jpg","comment_is_top":false,"comment_ctime":1544508674,"is_pvip":false,"replies":[{"id":"17457","content":"最好是把历史的运行情况监控起来，比如部署监控系统，或者最简单的把这些命令放到脚本里定期执行，这样才有依据分析历史","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520846,"ip_address":"","comment_id":48657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544508674","product_id":100020901,"comment_content":"老师我们线上系统最近有个问题，4核的cpu，load5和load15总是过一段时间就超过4*0.8的值,这个时候我用top看系统的情况，没有D进程，也没有一直R的进程，cpu利用率很低不到5%，cs的值也就几千，iostat查看util和iowait的值都不高，vmstat中r和b这两列基本都是0，偶尔r会有1.这台机器上就一个java进程，请教下下次复现该问题时，我该如何排查？谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432295,"discussion_content":"最好是把历史的运行情况监控起来，比如部署监控系统，或者最简单的把这些命令放到脚本里定期执行，这样才有依据分析历史","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48607,"user_name":"梁中华","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1544495117,"is_pvip":true,"replies":[{"id":"17463","content":"下一篇会讲一个案例","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544521493,"ip_address":"","comment_id":48607,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1544495117","product_id":100020901,"comment_content":"期待分享更多软中断引起性能问题的线上真实案例分析。只看理论理解不深刻。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432271,"discussion_content":"下一篇会讲一个案例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48585,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1544491796,"is_pvip":false,"replies":[{"id":"17465","content":"是的，内核态","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544521542,"ip_address":"","comment_id":48585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544491796","product_id":100020901,"comment_content":"软中断都是内核态吗，是不是所有的用户态必须转为内核态才能执行","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432259,"discussion_content":"是的，内核态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48563,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1544489010,"is_pvip":false,"replies":[{"id":"17849","content":"+1","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746421,"ip_address":"","comment_id":48563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544489010","product_id":100020901,"comment_content":"D9打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432247,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48443,"user_name":"浮生若梦","can_delete":false,"product_type":"c1","uid":1219941,"ip_address":"","ucode":"17C5C76CBA444A","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/65/1a1848e6.jpg","comment_is_top":false,"comment_ctime":1544445665,"is_pvip":false,"replies":[{"id":"17336","content":"CPU使用率是哪种类型？是软中断吗？还是硬中断或者系统？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544487796,"ip_address":"","comment_id":48443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544445665","product_id":100020901,"comment_content":"请问一下，如果是因为网卡队列不够，导致 CPU使用率在百分百，是不是也是因为软中断过多导致的？<br><br>通过软中断的相关信息，能定位到是因为网卡队列不够导致的吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432181,"discussion_content":"CPU使用率是哪种类型？是软中断吗？还是硬中断或者系统？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544487796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48268,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1544408140,"is_pvip":false,"replies":[{"id":"17277","content":"会的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436255,"ip_address":"","comment_id":48268,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544408140","product_id":100020901,"comment_content":"倪老师，软中断执行期间除了可以响应其他硬件中断，防止中断丢失，会进行用户进程的定时调度（timer中断）吗?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432097,"discussion_content":"会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48264,"user_name":"要飞","can_delete":false,"product_type":"c1","uid":1095423,"ip_address":"","ucode":"B491C629E9D83C","user_header":"https://static001.geekbang.org/account/avatar/00/10/b6/ff/f7fb2894.jpg","comment_is_top":false,"comment_ctime":1544407620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544407620","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":48241,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1544405607,"is_pvip":false,"replies":[{"id":"17282","content":"也欢迎分享你的心得👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436753,"ip_address":"","comment_id":48241,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544405607","product_id":100020901,"comment_content":"看完老师的讲解，加深了我对中断的理解，回想起哪里也学过，我需要回去补补课了《Linux内核设计与实现》。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432084,"discussion_content":"也欢迎分享你的心得👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48238,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1544405320,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544405320","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":48212,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1544402892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544402892","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":48211,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1544402891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544402891","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":48194,"user_name":"舒超","can_delete":false,"product_type":"c1","uid":1055955,"ip_address":"","ucode":"42B94749BB28CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/d3/573575f5.jpg","comment_is_top":false,"comment_ctime":1544401106,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544401106","product_id":100020901,"comment_content":"中断优先级(IPL)是否意味着中断不会禁断(无法触发或丢掉)，只会根据优先级排队，或是抢占，类似于进程优先级调度","like_count":0}]}