{"id":724942,"title":"11ï½œå¸¸è§traitè§£æï¼šæ ‡å‡†åº“ä¸­çš„å¸¸è§traitåº”è¯¥æ€ä¹ˆç”¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Mikeï¼Œä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ Rustä¸­çš„å¸¸è§traitã€‚</p><p>å‰é¢ä¸¤èŠ‚è¯¾æˆ‘ä»¬å·²ç»è®²è¿‡traitåœ¨Rustä¸­çš„é‡è¦æ€§äº†ï¼Œè¿™èŠ‚è¯¾å°±æ˜¯traitåœ¨Rustæ ‡å‡†åº“ä¸­çš„åº”ç”¨ã€‚Rustæ ‡å‡†åº“ä¸­åŒ…å«å¤§é‡çš„traitå®šä¹‰ï¼Œç”šè‡³Rustè‡ªèº«çš„æŸäº›è¯­è¨€ç‰¹æ€§å°±æ˜¯åœ¨è¿™äº›traitçš„å¸®åŠ©ä¸‹å®ç°çš„ã€‚è¿™äº›traitå’Œæ ‡å‡†åº“é‡Œçš„å„ç§ç±»å‹ä¸€èµ·ï¼Œæ„æˆäº†æ•´ä¸ªRustç”Ÿæ€çš„æ ¹åŸºï¼Œåªæœ‰äº†è§£å®ƒä»¬æ‰ç®—çœŸæ­£äº†è§£Rustã€‚</p><p><span class=\"reference\">æ³¨ï¼šè¿™èŠ‚è¯¾å¤§é‡ä»£ç æ¥è‡ª <a href=\"https://github.com/pretzelhammer/rust-blog/blob/master/posts/tour-of-rusts-standard-library-traits.md\">Tour of Rustâ€™s Standard Library Traits</a>ï¼Œæˆ‘åŠ äº†å¿…è¦çš„æ³¨è§£å’Œåˆ†æã€‚</span></p><p>å­¦ä¹ å®Œè¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œä½ ä¼šå¯¹å¾ˆå¤šé—®é¢˜éƒ½è±ç„¶å¼€æœ—ã€‚ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥å­¦ä¹ æ ‡å‡†åº“é‡Œä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„traitã€‚</p><h2>æ ‡å‡†åº“ä¸­çš„å¸¸ç”¨trait</h2><h3>Default</h3><p>æˆ‘ä»¬æ¥çœ‹Default traitçš„å®šä¹‰ä»¥åŠå¯¹Default traitçš„å®ç°å’Œä½¿ç”¨ã€‚</p><pre><code class=\"language-plain\">trait Default {\n    fn default() -&gt; Self;\n}\n</code></pre><pre><code class=\"language-plain\">struct Color(u8, u8, u8);\nimpl Default for Color {\n    // é»˜è®¤é¢œè‰²æ˜¯é»‘è‰² (0, 0, 0)\n    fn default() -&gt; Self {\n        Color(0, 0, 0)\n    }\n}\n\nfn main() {\n    let color = Color::default();\n    // æˆ–\n    let color: Color = Default::default();\n}\n</code></pre><!-- [[[read_end]]] --><p>è¿˜æœ‰å…¶ä»–ä¸€äº›åœ°æ–¹ç”¨åˆ°äº†Defaultï¼Œæ¯”å¦‚ <code>Option&lt;T&gt;</code> çš„ <code>unwrap_or_default()</code>ï¼Œåœ¨ç±»å‹å‚æ•°ä¸Šè°ƒç”¨ <code>default()</code> å‡½æ•°ã€‚</p><pre><code class=\"language-plain\">fn paint(color: Option&lt;Color&gt;) {\n    // å¦‚æœæ²¡æœ‰é¢œè‰²å‚æ•°ä¼ è¿›æ¥ï¼Œå°±ç”¨é»˜è®¤é¢œè‰²\n    let color = color.unwrap_or_default();\n    // ...\n}\n\n// ç”±äºdefault()æ˜¯åœ¨traitä¸­å®šä¹‰çš„å…³è”å‡½æ•°ï¼Œå› æ­¤å¯æ–¹ä¾¿çš„ç”±ç±»å‹å‚æ•°è°ƒç”¨\nfn guarantee_length&lt;T: Default&gt;(mut vec: Vec&lt;T&gt;, min_len: usize) -&gt; Vec&lt;T&gt; {\n    for _ in 0..min_len.saturating_sub(vec.len()) {\n        vec.push(T::default());  // è¿™é‡Œç”¨äº† T::default() è¿™ç§å½¢å¼\n    }\n    vec\n}\n</code></pre><p>å‰é¢è®²è¿‡ï¼Œå¦‚æœæ˜¯structï¼Œè¿˜å¯ä»¥ä½¿ç”¨éƒ¨åˆ†æ›´æ–°è¯­æ³•ï¼Œè¿™ä¸ªæ—¶å€™å…¶å®æ˜¯Defaultåœ¨å‘æŒ¥ä½œç”¨ã€‚</p><pre><code class=\"language-plain\">#[derive(Default)]\nstruct Color {\n&nbsp; &nbsp; r: u8,\n&nbsp; &nbsp; g: u8,\n&nbsp; &nbsp; b: u8,\n}\nimpl Color {\n&nbsp; &nbsp; fn new(r: u8, g: u8, b: u8) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; Color {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b,\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\nimpl Color {\n&nbsp; &nbsp; fn red(r: u8) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; Color {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ..Color::default()&nbsp; &nbsp; // æ³¨æ„è¿™ä¸€å¥\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn green(g: u8) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; Color {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ..Color::default()&nbsp; &nbsp; // æ³¨æ„è¿™ä¸€å¥\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n&nbsp; &nbsp; fn blue(b: u8) -&gt; Self {\n&nbsp; &nbsp; &nbsp; &nbsp; Color {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ..Color::default()&nbsp; &nbsp; // æ³¨æ„è¿™ä¸€å¥\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>Rustæ ‡å‡†åº“å®é™…ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ ‡æ³¨ï¼Œä¹Ÿå°±æ˜¯ <code>#[derive()]</code> é‡Œé¢æ”¾ Defaultï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸ºç»“æ„ä½“è‡ªåŠ¨å®ç°Default traitã€‚</p><pre><code class=\"language-plain\">#[derive(Default)]\nstruct Color {\n    r: u8,\n    g: u8,\n    b: u8\n}\n\n#[derive(Default)]\nstruct Color2(u8, u8, u8);\n</code></pre><p>æ³¨æ„è¿™é‡Œçš„ç»†èŠ‚ï¼Œæˆ‘ä»¬ç”¨ <code>#[derive()]</code> åœ¨ä¸¤ä¸ªç»“æ„ä½“ä¸Šä½œäº†æ ‡æ³¨ï¼Œè¿™é‡Œé¢å‡ºç°çš„è¿™ä¸ª Default ä¸æ˜¯traitï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒåçš„æ´¾ç”Ÿå®ï¼ˆæˆ‘ä»¬åé¢ä¼šè®²åˆ°ï¼‰ã€‚è¿™ç§æ´¾ç”Ÿå®æ ‡æ³¨å¸®åŠ©æˆ‘ä»¬å®ç°äº† Default traitã€‚Rustcèƒ½æ­£ç¡®åŒºåˆ†Defaultåˆ°åº•æ˜¯å®è¿˜æ˜¯traitï¼Œå› ä¸ºå®ƒä»¬å‡ºç°çš„ä½ç½®ä¸ä¸€æ ·ã€‚</p><p>ä¸ºä»€ä¹ˆå¯ä»¥è‡ªåŠ¨å®ç°Default traitå‘¢ï¼Ÿå› ä¸ºColoré‡Œé¢çš„ç±»å‹æ˜¯åŸºç¡€ç±»å‹u8ï¼Œè€Œu8æ˜¯å®ç°äº†Default traitçš„ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚</p><h3>Display</h3><p>æˆ‘ä»¬çœ‹Display traitçš„å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">trait Display {\n    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; Result;\n}\n</code></pre><p>Display traitå¯¹åº”äºæ ¼å¼åŒ–ç¬¦å· <code>\"{}\"</code>ï¼Œæ¯”å¦‚ <code>println!(\"{}\", s)</code>ï¼Œç”¨äºå†³å®šä¸€ä¸ªç±»å‹å¦‚ä½•æ˜¾ç¤ºï¼Œå…¶å®å°±æ˜¯æŠŠç±»å‹è½¬æ¢æˆå­—ç¬¦ä¸²è¡¨è¾¾ã€‚Displayéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å»å®ç°ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">use std::fmt;\n#[derive(Default)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n// ä¸ºPointå®ç° Display\nimpl fmt::Display for Point {\n    // å®ç°å”¯ä¸€çš„fmtæ–¹æ³•ï¼Œè¿™é‡Œå®šä¹‰ç”¨æˆ·è‡ªå®šä¹‰çš„æ ¼å¼\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {\n        write!(f, \"({}, {})\", self.x, self.y)  // write!å®å‘stdoutå†™å…¥\n    }\n}\n\nfn main() {\n    println!(\"origin: {}\", Point::default());\n    // æ‰“å°å‡º \"origin: (0, 0)\"\n    // åœ¨ format! ä¸­ç”¨ \"{}\" å°†ç±»å‹è¡¨ç¤º/è½¬æ¢ä¸º String\n    let stringified = format!(\"{}\", Point::default());\n    assert_eq!(\"(0, 0)\", stringified); // âœ…\n}\n</code></pre><h3>ToString</h3><p>æˆ‘ä»¬æ¥çœ‹ToString trait å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">trait ToString {\n    fn to_string(&amp;self) -&gt; String;\n}\n</code></pre><p>å®ƒæä¾›äº†ä¸€ä¸ª to_string() æ–¹æ³•ï¼Œæ–¹ä¾¿æŠŠå„ç§ç±»å‹å®ä¾‹è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ä½†å®é™…ä¸Šä¸éœ€è¦è‡ªå·±å»ç»™ç±»å‹å®ç°ToString traitï¼Œå› ä¸ºæ ‡å‡†åº“å·²ç»ç»™æˆ‘ä»¬åšäº†æ€»å®ç°ï¼ˆ<a href=\"https://time.geekbang.org/column/article/723496\">ç¬¬ 9 è®²</a>æåˆ°è¿‡ï¼‰ï¼Œåƒä¸‹é¢è¿™ä¸ªæ ·å­ã€‚</p><pre><code class=\"language-plain\">impl&lt;T: Display&gt; ToString for T\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡¡æ˜¯å®ç°äº†Displayçš„å°±å®ç°äº†ToStringã€‚è¿™ä¸¤ä¸ªåŠŸèƒ½æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æŠŠç±»å‹è½¬æ¢æˆå­—ç¬¦ä¸²è¡¨è¾¾ã€‚åªä¸è¿‡Displayä¾§é‡äºå±•ç°ï¼ŒToStringä¾§é‡äºç±»å‹è½¬æ¢ã€‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹è¯æ˜è¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚</p><pre><code class=\"language-plain\">#[test] // âœ…\nfn display_point() {\n    let origin = Point::default();\n    assert_eq!(format!(\"{}\", origin), \"(0, 0)\");\n}\n#[test] // âœ…\nfn point_to_string() {\n    let origin = Point::default();\n    assert_eq!(origin.to_string(), \"(0, 0)\");\n}\n#[test] // âœ…\nfn display_equals_to_string() {\n    let origin = Point::default();\n    assert_eq!(format!(\"{}\", origin), origin.to_string());\n}\n</code></pre><p>æ‰€ä»¥æŠŠä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ç±»å‹å®ä¾‹è½¬æ¢æˆå­—ç¬¦ä¸²æœ‰ä¸¤ç§å¸¸ç”¨æ–¹æ³•ã€‚</p><pre><code class=\"language-plain\">let s = format!(\"{}\", obj);\n// æˆ–\nlet s = obj.to_string();\n</code></pre><h3>Debug</h3><p>Debug è·Ÿ Display å¾ˆåƒï¼Œä¹Ÿä¸»è¦æ˜¯ç”¨äºè°ƒè¯•æ‰“å°ã€‚æ‰“å°å°±éœ€è¦æŒ‡å®šæ ¼å¼ï¼ŒåŒºåˆ«åœ¨äºDebug trait æ˜¯é…å¯¹ <code>\"{:?}\"</code> æ ¼å¼çš„ï¼ŒDisplayæ˜¯é…å¯¹ <code>\"{}\"</code> çš„ã€‚å®ƒä»¬æœ¬èº«éƒ½æ˜¯å°†ç±»å‹è¡¨ç¤ºæˆ–è½¬æ¢æˆ String ç±»å‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒDebugçš„æ’ç‰ˆä¿¡æ¯æ¯”Displayè¦å¤šä¸€ç‚¹ï¼Œå› ä¸ºå®ƒæ˜¯ç»™ç¨‹åºå‘˜è°ƒè¯•ç”¨çš„ï¼Œä¸æ˜¯ç»™æœ€ç»ˆç”¨æˆ·çœ‹çš„ã€‚Debugè¿˜é…å¥—äº†ä¸€ä¸ªç¾åŒ–ç‰ˆæœ¬æ ¼å¼ <code>\"{:#?}\"</code>ï¼Œç”¨æ¥æŠŠç±»å‹æ‰“å°å¾—æ›´å…·ç»“æ„åŒ–ä¸€äº›ï¼Œé€‚åˆè°ƒè¯•çš„æ—¶å€™æŸ¥çœ‹ï¼Œæ¯”å¦‚jsonç»“æ„ä¼šå±•å¼€æ‰“å°ã€‚</p><p>Rustæ ‡å‡†åº“æä¾›äº†Debugå®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä»¥è¿™ä¸ªå®ä¸ºç›®æ ‡ç±»å‹è‡ªåŠ¨ç”ŸæˆDebug traitï¼Œè€Œä¸æ˜¯ç”±æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å»å®ç°ï¼Œè¿™ä¸€ç‚¹å’ŒDisplayæ­£å¥½ç›¸å¯¹ï¼Œstdæ ‡å‡†åº“é‡Œå¹¶æ²¡æœ‰æä¾›ä¸€ä¸ª Display å®ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å®ç° Display traitï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°å®ƒã€‚</p><p>å†æé†’ä½ ä¸€ä¸‹ï¼ŒRustçš„ç±»å‹èƒ½å¤Ÿè‡ªåŠ¨è¢«deriveçš„æ¡ä»¶æ˜¯ï¼Œå®ƒé‡Œé¢çš„æ¯ä¸ªå…ƒç´ éƒ½èƒ½è¢«deriveï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç»“æ„ä½“é‡Œçš„æ¯ä¸ªå­—æ®µï¼Œéƒ½æ˜¯i32ç±»å‹çš„ï¼Œè¿™ç§åŸºç¡€ç±»å‹åœ¨æ ‡å‡†åº“é‡Œå·²ç»è¢«å®ç°è¿‡Debug traitäº†ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨Pointä¸Šåšderiveä¸ºPointç±»å‹å®ç°Debug traitã€‚è¿™ä¸ªåŸåˆ™é€‚ç”¨äºæ‰€æœ‰traitï¼Œåé¢ä¸å†èµ˜è¿°ã€‚</p><pre><code class=\"language-plain\">#[derive(Debug)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n</code></pre><h3>PartialEqå’ŒEq</h3><p>å¦‚æœä¸€ä¸ªç±»å‹ä¸Šå®ç°äº†PartialEqï¼Œé‚£ä¹ˆå®ƒå°±èƒ½æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚è¿™ç§å¯æ¯”è¾ƒæ€§æ»¡è¶³æ•°å­¦ä¸Šçš„å¯¹ç§°æ€§å’Œä¼ é€’æ€§ï¼Œæˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªä¾‹å­å…·ä½“æ¥çœ‹ã€‚</p><ul>\n<li>å¯¹ç§°æ€§ï¼ˆsymmetryï¼‰ï¼š<code>a == b</code> å¯¼å‡º <code>b == a</code>ã€‚</li>\n<li>ä¼ é€’æ€§ï¼ˆtransitivityï¼‰ï¼š<code>a == b &amp;&amp; b == c</code> å¯¼å‡º <code>a == c</code>ã€‚</li>\n</ul><p>è€ŒEqå®šä¹‰ä¸ºPartialEqçš„subtraitï¼Œåœ¨PartialEqçš„å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œåˆæ·»åŠ äº†è‡ªåæ€§ï¼Œä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰ <code>a</code> éƒ½æœ‰ <code>a == a</code>ã€‚æœ€å…¸å‹çš„å°±æ˜¯Rustä¸­çš„æµ®ç‚¹æ•°åªå®ç°äº†PartialEqï¼Œæ²¡å®ç°Eqï¼Œå› ä¸ºæ ¹æ®IEEEçš„è§„èŒƒï¼Œæµ®ç‚¹æ•°ä¸­å­˜åœ¨ä¸€ä¸ªNaNï¼Œå®ƒä¸ç­‰äºè‡ªå·±ï¼Œä¹Ÿå°±æ˜¯ NaN â‰  NaNã€‚è€Œå¯¹æ•´æ•°æ¥è¯´ï¼ŒPartialEqå’ŒEqéƒ½å®ç°äº†ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»å‹ï¼Œå®ƒçš„æ‰€æœ‰å­—æ®µéƒ½å®ç°äº†PartialEqï¼Œé‚£ä¹ˆä½¿ç”¨æ ‡å‡†åº“ä¸­å®šä¹‰çš„PartialEqæ´¾ç”Ÿå®ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç›®æ ‡ç±»å‹è‡ªåŠ¨å®ç°å¯æ¯”è¾ƒèƒ½åŠ›ï¼Œç”¨==å·ï¼Œæˆ–è€…ç”¨ <code>assert_eq!()</code> åšåˆ¤æ–­ã€‚</p><pre><code class=\"language-plain\">#[derive(PartialEq, Debug)]    // æ³¨æ„è¿™ä¸€å¥\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nfn example_assert(p1: Point, p2: Point) {\n    assert_eq!(p1, p2);        // æ¯”è¾ƒ\n}\n\nfn example_compare_collections&lt;T: PartialEq&gt;(vec1: Vec&lt;T&gt;, vec2: Vec&lt;T&gt;) {\n    if vec1 == vec2 {    // æ¯”è¾ƒ\n        // some code\n    } else {\n        // other code\n    }\n}\n</code></pre><h3>PartialOrdå’ŒOrd</h3><p>PartialOrdå’ŒPartialEqå·®ä¸å¤šï¼ŒPartialEqåªåˆ¤æ–­ç›¸ç­‰æˆ–ä¸ç›¸ç­‰ï¼ŒPartialOrdåœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›ä¸€æ­¥åˆ¤æ–­æ˜¯å°äºã€å°äºç­‰äºã€å¤§äºè¿˜æ˜¯å¤§äºç­‰äºã€‚å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå°±æ˜¯ä¸ºæ’åºåŠŸèƒ½å‡†å¤‡çš„ã€‚</p><p>PartialOrdè¢«å®šä¹‰ä¸º PartialEqçš„subtraitã€‚å®ƒä»¬åœ¨ç±»å‹ä¸Šå¯ä»¥ç”¨è¿‡ç¨‹å®ä¸€èµ·deriveå®ç°ã€‚</p><pre><code class=\"language-plain\">#[derive(PartialEq, PartialOrd)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\n#[derive(PartialEq, PartialOrd)]\nenum Stoplight {\n    Red,\n    Yellow,\n    Green,\n}\n</code></pre><p>ç±»ä¼¼çš„ï¼ŒOrd å®šä¹‰ä¸º Eq + PartialOrd çš„ subtraitã€‚å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç°äº† Ordï¼Œé‚£ä¹ˆå¯¹é‚£ä¸ªç±»å‹çš„æ‰€æœ‰å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åšå‡ºä¸€ä¸ªä¸¥æ ¼çš„æ€»æ’åºï¼Œæ¯”å¦‚u8ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¥æ ¼åœ°ä»0æ’åˆ°255ï¼Œå½¢æˆä¸€ä¸ªç¡®å®šçš„ä»å°åˆ°å¤§çš„åºåˆ—ã€‚</p><p>åŒæ ·çš„ï¼Œæµ®ç‚¹æ•°å®ç°äº† PartialOrdï¼Œä½†æ˜¯æ²¡å®ç° Ordã€‚</p><p>ç”±äºOrdä¸¥æ ¼çš„é¡ºåºæ€§ï¼Œå¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†Ordï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹å¯ä»¥è¢«ç”¨ä½œBTreeMapæˆ–BTreeSetçš„keyã€‚</p><blockquote>\n<p>BTreeMapã€BTreeSetï¼šç›¸å¯¹äºHashMapå’ŒHashSetï¼Œæ˜¯ä¸¤ç§å¯æ’åºç»“æ„ã€‚</p>\n</blockquote><p>ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">use std::collections::BTreeSet;\n\n#[derive(Ord, PartialOrd, PartialEq, Eq)]  // æ³¨æ„è¿™ä¸€å¥ï¼Œ4ä¸ªéƒ½å†™ä¸Š\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nfn example_btreeset() {\n    let mut points = BTreeSet::new();\n    points.insert(Point { x: 0, y: 0 }); // ä½œkeyå€¼æ’å…¥\n}\n\n// å®ç°äº†Ord traitçš„ç±»å‹çš„é›†åˆï¼Œå¯è°ƒç”¨ .sort() æ’åºæ–¹æ³•\nfn example_sort&lt;T: Ord&gt;(mut sortable: Vec&lt;T&gt;) -&gt; Vec&lt;T&gt; {\n    sortable.sort();\n    sortable\n}\n</code></pre><h3>è¿ç®—ç¬¦é‡è½½</h3><p>Rustæä¾›äº†ä¸€ä¸ªAdd traitï¼Œç”¨æ¥å¯¹åŠ å·ï¼ˆ+ï¼‰åšè‡ªå®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¿ç®—ç¬¦é‡è½½ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸€ä¸‹Addçš„å®šä¹‰ï¼Œå®ƒå¸¦ä¸€ä¸ªç±»å‹å‚æ•°Rhsï¼Œè¿™é‡Œçš„ç±»å‹å‚æ•°å¯ä»¥æ˜¯ä»»æ„åå­—ï¼Œé»˜è®¤ç±»å‹æ˜¯Selfï¼Œä¸€ä¸ªå…³è”ç±»å‹Outputï¼Œä¸€ä¸ªæ–¹æ³•add()ã€‚</p><pre><code class=\"language-plain\">trait Add&lt;Rhs = Self&gt; {\n    type Output;\n    fn add(self, rhs: Rhs) -&gt; Self::Output;\n}\n</code></pre><p>åƒä¸‹é¢æˆ‘ç»™å‡ºçš„è¿™ä¸ªç¤ºä¾‹ä¸€æ ·å»ä½¿ç”¨å®ƒå°±å¯ä»¥ï¼Œéå¸¸ç®€å•ã€‚</p><pre><code class=\"language-plain\">struct Point {\n    x: i32,\n    y: i32,\n}\n\n// ä¸º Point ç±»å‹å®ç° Add traitï¼Œè¿™æ ·ä¸¤ä¸ªPointå®ä¾‹å°±å¯ä»¥ç›´æ¥ç›¸åŠ \nimpl Add for Point {\n    type Output = Point;\n    fn add(self, rhs: Point) -&gt; Point {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 2 };\n    let p2 = Point { x: 3, y: 4 };\n    let p3 = p1 + p2; // è¿™é‡Œç›´æ¥ç”¨+å·ä½œç”¨åœ¨ä¸¤ä¸ªPointå®ä¾‹ä¸Š\n    assert_eq!(p3.x, p1.x + p2.x); // âœ…\n    assert_eq!(p3.y, p1.y + p2.y); // âœ…\n}\n</code></pre><p>å®é™…ä¸Šï¼ŒRustæ ‡å‡†åº“æä¾›äº†ä¸€å¥—å®Œæ•´çš„ä¸è¿ç®—ç¬¦å¯¹åº”çš„traitï¼Œä½ åœ¨<a href=\"https://doc.rust-lang.org/std/ops/index.html\">è¿™é‡Œ</a>å¯ä»¥æ‰¾åˆ°å¯é‡è½½çš„è¿ç®—ç¬¦ã€‚ä½ å¯ä»¥æŒ‰ç±»ä¼¼çš„æ–¹å¼ç»ƒä¹ å¦‚ä½•è‡ªå®šä¹‰å„ç§è¿ç®—ç¬¦ã€‚</p><h3>Clone</h3><p>å®šä¹‰ï¼š</p><pre><code class=\"language-plain\">trait Clone {\n    fn clone(&amp;self) -&gt; Self;\n}\n</code></pre><p>è¿™ä¸ªtraitç»™ç›®æ ‡ç±»å‹æä¾›äº†clone()æ–¹æ³•ç”¨æ¥å®Œæ•´åœ°å…‹éš†å®ä¾‹ã€‚ä½¿ç”¨æ ‡å‡†åº“é‡Œé¢æä¾›çš„Cloneæ´¾ç”Ÿå®å¯ä»¥æ–¹ä¾¿åœ°ä¸ºç›®æ ‡ç±»å‹å®ç°Clone traitã€‚</p><p>æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">#[derive(Clone)]\nstruct Point {\n    x: u32,\n    y: u32,\n}\n</code></pre><p>å› ä¸ºæ¯ä¸€ä¸ªå­—æ®µï¼ˆu32ç±»å‹ï¼‰éƒ½å®ç°äº†Cloneï¼Œæ‰€ä»¥é€šè¿‡deriveï¼Œè‡ªåŠ¨ä¸ºPointç±»å‹å®ç°äº†Clone traitã€‚å®ç°åï¼ŒPointçš„å®ä¾‹ point ä½¿ç”¨ point.clone() å°±å¯ä»¥æŠŠè‡ªå·±å…‹éš†ä¸€ä»½äº†ã€‚</p><p>é€šè¿‡æ–¹æ³•çš„ç­¾åï¼Œå¯ä»¥çœ‹åˆ°æ–¹æ³•ä½¿ç”¨çš„æ˜¯å®ä¾‹çš„ä¸å¯å˜å¼•ç”¨ã€‚</p><pre><code class=\"language-plain\">    fn clone(&amp;self) -&gt; Self;\n</code></pre><p>è¿™é‡Œé¢æœ‰ä¸¤ç§æƒ…å†µã€‚</p><ul>\n<li>ç¬¬ä¸€ç§æ˜¯å·²ç»æ‹¿åˆ°å®ä¾‹çš„æ‰€æœ‰æƒï¼Œcloneä¸€ä»½ç”Ÿæˆä¸€ä¸ªæ–°çš„æ‰€æœ‰æƒå¹¶è¢«å±€éƒ¨å˜é‡æ‰€æŒæœ‰ã€‚</li>\n<li>ç¬¬äºŒç§æ˜¯åªæ‹¿åˆ°ä¸€ä¸ªå®ä¾‹çš„å¼•ç”¨ï¼Œæƒ³æ‹¿åˆ°å®ƒçš„æ‰€æœ‰æƒï¼Œå¦‚æœè¿™ä¸ªç±»å‹å®ç°äº†Clone traitï¼Œé‚£ä¹ˆå°±å¯ä»¥cloneä¸€ä»½æ‹¿åˆ°è¿™ä¸ªæ‰€æœ‰æƒã€‚</li>\n</ul><p>clone() æ˜¯å¯¹è±¡çš„æ·±åº¦æ‹·è´ï¼Œå¯èƒ½ä¼šæœ‰æ¯”è¾ƒå¤§çš„é¢å¤–è´Ÿè½½ï¼Œä½†æ˜¯å°±å¤§å¤šæ•°æƒ…å†µæ¥è¯´å…¶å®è¿˜å¥½ã€‚ä¸è¦æ‹…å¿ƒåœ¨Rustä¸­ä½¿ç”¨clone()ï¼Œå…ˆæŠŠç¨‹åºåŠŸèƒ½è·‘é€šæœ€é‡è¦ã€‚Rustçš„ä»£ç ï¼Œæ€§èƒ½ä¸€èˆ¬éƒ½ä¸ä¼šå¤ªå·®ï¼Œæ¯•ç«Ÿèµ·ç‚¹å¾ˆé«˜ã€‚</p><p><span class=\"reference\">æ³¨ï¼šæµ…æ‹·è´æ˜¯æŒ‰å€¼æ‹·è´ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œåªå¤åˆ¶ä¸€å±‚ï¼Œä¸ä¼šå»æ·±ç©¶è¿™ä¸ªå€¼é‡Œé¢æ˜¯å¦æœ‰åˆ°å…¶å®ƒå†…å­˜èµ„æºçš„å¼•ç”¨ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œæ·±æ‹·è´å°±ä¼šæŠŠè¿™äº›å¼•ç”¨å¯¹è±¡é€’å½’å…¨éƒ¨æ‹·è´ã€‚</span></p><p>åœ¨Rustç”Ÿæ€çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°clone()ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå®ƒæŠŠå¯¹å®ä¾‹å¼•ç”¨çš„æŒæœ‰è½¬æ¢æˆäº†å¯¹å¯¹è±¡æ‰€æœ‰æƒçš„æŒæœ‰ã€‚ä¸€æ—¦æˆ‘ä»¬æ‹¿åˆ°äº†æ‰€æœ‰æƒï¼Œå¾ˆå¤šä»£ç å†™èµ·æ¥å°±æ¯”è¾ƒè½»æ¾äº†ã€‚</p><h3>Copy</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹Copy traitçš„å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">trait Copy: Clone {}\n</code></pre><p>å®šä¹‰ä¸ºCloneçš„subtraitï¼Œå¹¶ä¸”ä¸åŒ…å«ä»»ä½•å†…å®¹ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®°ï¼ˆmarkerï¼‰ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½è‡ªå·±ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°è¿™ä¸ªtraitã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹å°±æ˜¯ä¸è¡Œçš„ã€‚</p><pre><code class=\"language-plain\">impl Copy for Point {} // è¿™æ˜¯ä¸è¡Œçš„\n</code></pre><p>ä½†æ˜¯Rustæ ‡å‡†åº“æä¾›äº†Copyè¿‡ç¨‹å®ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªåŠ¨ä¸ºç›®æ ‡ç±»å‹å®ç°Copy traitã€‚</p><pre><code class=\"language-plain\">#[derive(Copy, Clone)]\nstruct SomeType;\n</code></pre><p>å› ä¸ºCopyæ˜¯Cloneçš„subtraitã€‚æ‰€ä»¥ç†æ‰€å½“ç„¶è¦æŠŠClone traitä¹Ÿä¸€èµ·å®ç°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸€æ¬¡æ€§deriveè¿‡æ¥ã€‚</p><p>Copyå’ŒCloneçš„åŒºåˆ«æ˜¯ï¼ŒCopyæ˜¯æµ…æ‹·è´åªå¤åˆ¶ä¸€å±‚ï¼Œä¸ä¼šå»æ·±ç©¶è¿™ä¸ªå€¼é‡Œé¢æ˜¯å¦æœ‰åˆ°å…¶ä»–å†…å­˜èµ„æºçš„å¼•ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²çš„åŠ¨æ€æ•°ç»„ã€‚</p><pre><code class=\"language-plain\">struct Atype {\n&nbsp; &nbsp; num: u32,\n&nbsp; &nbsp; a_vec: Vec&lt;u32&gt;,\n}\nfn main() {\n&nbsp; &nbsp; let a = Atype {\n&nbsp; &nbsp; &nbsp; &nbsp; num: 100,&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; a_vec: vec![10, 20, 30],\n&nbsp; &nbsp; };\n&nbsp; &nbsp; let b = a;  // è¿™é‡Œå‘ç”Ÿäº†ç§»åŠ¨\n}\n</code></pre><p>ä»£ç ç¬¬10è¡Œçš„æ“ä½œæ˜¯å°†açš„æ‰€æœ‰æƒç§»åŠ¨ç»™bï¼ˆ<a href=\"https://time.geekbang.org/column/article/718916\">ç¬¬ 2 è®²</a>çš„å†…å®¹ï¼‰ã€‚<br>\nå¦‚æœæˆ‘ä»¬ç»™è¿™ä¸ªç»“æ„ä½“å®ç°äº†Clone traitçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨.clone() æ¥äº§ç”Ÿä¸€ä»½æ–°çš„æ‰€æœ‰æƒã€‚</p><pre><code class=\"language-plain\">#[derive(Clone, Debug)]\nstruct Atype {\n&nbsp; &nbsp; num: u32,\n&nbsp; &nbsp; a_vec: Vec&lt;u32&gt;,    // åŠ¨æ€æ•°ç»„èµ„æºåœ¨å †å†…å­˜ä¸­\n}\nfn main() {\n&nbsp; &nbsp; let a = Atype {\n&nbsp; &nbsp; &nbsp; &nbsp; num: 100,&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; a_vec: vec![10, 20, 30],\n&nbsp; &nbsp; };\n&nbsp; &nbsp; let mut b = a.clone();  // å…‹éš†ï¼Œä¹Ÿå°†å †å†…å­˜ä¸­çš„Vecèµ„æºéƒ¨åˆ†å…‹éš†äº†ä¸€ä»½\n&nbsp; &nbsp; b.num = 200;            // æ›´æ”¹bçš„å€¼\n&nbsp; &nbsp; b.a_vec[0] = 11;\n&nbsp; &nbsp; b.a_vec[1] = 21;\n&nbsp; &nbsp; b.a_vec[2] = 31;\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; println!(\"{a:?}\");  // å¯¹æ¯”ä¸¤ä»½å€¼\n&nbsp; &nbsp; println!(\"{b:?}\");\n}\n// è¾“å‡º \nAtype { num: 100, a_vec: [10, 20, 30] }\nAtype { num: 200, a_vec: [11, 21, 31] }\n</code></pre><p>é€šè¿‡ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œclone()ä¸€ä»½æ–°çš„æ‰€æœ‰æƒå‡ºæ¥ï¼Œbæ”¹åŠ¨çš„å€¼ä¸å½±å“açš„å€¼ã€‚</p><p>è€Œä¸€æ—¦ä½ æƒ³åœ¨ Atype ä¸Šå®ç° Copy traitçš„è¯ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p><pre><code class=\"language-plain\">error[E0204]: the trait `Copy` cannot be implemented for this type\n&nbsp;--&gt; src/main.rs:1:10\n&nbsp; |\n1 | #[derive(Copy, Clone, Debug)]\n&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^^^^\n...\n4 |&nbsp; &nbsp; &nbsp;a_vec: Vec&lt;u32&gt;,&nbsp; &nbsp; // åŠ¨æ€æ•°ç»„èµ„æºåœ¨å †å†…å­˜ä¸­\n&nbsp; |&nbsp; &nbsp; &nbsp;--------------- this field does not implement `Copy`\n</code></pre><p>å®ƒè¯´åŠ¨æ€æ•°ç»„å­—æ®µ a_vec æ²¡æœ‰å®ç°Copy traitï¼Œæ‰€ä»¥ä½ ä¸èƒ½å¯¹Atypeå®ç°Copy traitã€‚åŸå› ä¹Ÿå¥½ç†è§£ï¼ŒVecæ˜¯ä¸€ç§æ‰€æœ‰æƒç»“æ„ï¼Œå¦‚æœä½ åœ¨å®ƒä¸Šé¢å®ç°äº†Copyï¼Œé‚£å†èµ‹å€¼çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å¯¹åŒä¸€ä»½èµ„æºçš„ä¸¤ä¸ªæŒ‡å‘ï¼Œå†²çªäº†ï¼</p><p>ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº†Copyï¼Œå®ƒå°±ä¼šå…·å¤‡ä¸€ä¸ªç‰¹åˆ«é‡è¦çš„ç‰¹æ€§ï¼š<strong>å†èµ‹å€¼çš„æ—¶å€™ä¼šå¤åˆ¶ä¸€ä»½è‡ªèº«</strong>ã€‚é‚£ä¹ˆå°±ç›¸å½“äºæ–°åˆ›å»ºä¸€ä»½æ‰€æœ‰æƒã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªå€¼å…¨åœ¨æ ˆä¸Šçš„ç±»å‹ã€‚</p><pre><code class=\"language-plain\">#[derive(Clone)]\nstruct Point {\n    x: u32,\n    y: u32,\n}\n\nfn main() {\n  let a = Point {x: 10, y: 10};\n  let b = a; // è¿™é‡Œå‘ç”Ÿäº†æ‰€æœ‰æƒmoveï¼Œaåœ¨åç»­ä¸èƒ½ä½¿ç”¨äº†\n}\n</code></pre><p>æˆ‘ä»¬å¯¹ Point å®ç°Cloneå’ŒCopyã€‚</p><pre><code class=\"language-plain\">#[derive(Copy, Clone)]\nstruct Point {\n    x: u32,\n    y: u32,\n}\n\nfn main() {\n  let a = Point {x: 10, y: 10};\n  let b = a; // è¿™é‡Œå‘ç”Ÿäº†å¤åˆ¶ï¼Œaåœ¨åç»­å¯ä»¥ç»§ç»­ä½¿ç”¨\n  let c = a; // è¿™é‡Œåˆå¤åˆ¶äº†ä¸€ä»½ï¼Œè¿™ä¸‹æœ‰3ä»½äº†\n}\n</code></pre><p>ä»”ç»†ä½“ä¼šä¸€ä¸‹ï¼Œç°åœ¨ä½ çŸ¥é“æˆ‘ä»¬åœ¨ç¬¬2è®²é‡Œé¢è®²åˆ°çš„å¤åˆ¶ä¸ç§»åŠ¨çš„è¯­ä¹‰åŒºåˆ«æ ¹æºåœ¨å“ªé‡Œäº†å§ï¼</p><p>ä½ å¯èƒ½ä¼šé—®ï¼ŒPointç»“æ„ä½“é‡Œé¢çš„å­—æ®µå…¶å®å…¨éƒ½æ˜¯å›ºå®šå°ºå¯¸çš„ï¼Œå¹¶ä¸”u32æ˜¯copyè¯­ä¹‰çš„ï¼ŒæŒ‰ç†è¯´Pointä¹Ÿæ˜¯ç¼–è¯‘æ—¶å·²çŸ¥å›ºå®šå°ºå¯¸çš„ï¼Œä¸ºä»€ä¹ˆå®ƒé»˜è®¤ä¸å®ç°copyè¯­ä¹‰å‘¢ï¼Ÿ</p><p>è¿™å…¶å®æ˜¯Rustè®¾è®¡è€…æ•…æ„è¿™ä¹ˆåšçš„ã€‚å› ä¸ºCopy traitå…¶å®å…³è”åˆ°èµ‹å€¼è¯­æ³•ï¼Œä»…ä»…ä»è¿™ä¸ªè¯­æ³•ï¼ˆlet a = b;ï¼‰ï¼Œå¾ˆéš¾ä¸€ä¸‹å­çœ‹å‡ºæ¥è¿™åˆ°åº•æ˜¯copyè¿˜æ˜¯moveï¼Œå®ƒæ˜¯ä¸€ç§<strong>éšå¼è¡Œä¸º</strong>ã€‚</p><p>è€Œåœ¨æ‰€æœ‰æƒçš„ç¬¬ä¸€è®¾è®¡åŸåˆ™æ¡†æ¶ä¸‹ï¼ŒRusté»˜è®¤é€‰æ‹©äº†moveè¯­ä¹‰ã€‚æ‰€ä»¥æ–¹ä¾¿èµ·è§ï¼ŒRustè®¾è®¡è€…å°±åªè®©æœ€åŸºç¡€çš„é‚£äº›ç±»å‹ï¼Œæ¯”å¦‚u32ã€boolç­‰å…·æœ‰copyè¯­ä¹‰ã€‚è€Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä¸€æ¦‚é»˜è®¤moveè¯­ä¹‰ã€‚å¦‚æœç”¨æˆ·æƒ³ç»™è‡ªå®šä¹‰ç±»å‹èµ‹äºˆcopyè¯­ä¹‰å†…æ¶µï¼Œé‚£ä¹ˆä»–éœ€è¦æ˜¾å¼åœ°åœ¨é‚£ä¸ªç±»å‹ä¸Šæ·»åŠ Copyçš„deriveã€‚</p><p>æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹Cloneï¼Œä¸€ä¸ªç±»å‹å®ç°äº†Cloneåï¼Œéœ€è¦æ˜¾å¼åœ°è°ƒç”¨ .clone() æ–¹æ³•æ‰ä¼šå¯¼è‡´å¯¹è±¡å…‹éš†ï¼Œè¿™å°±åœ¨ä»£ç é‡Œé¢ç•™ä¸‹äº†è¶³è¿¹ã€‚è€Œå¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†Copyï¼Œé‚£ä¹ˆå®ƒåœ¨ç”¨ = å·å¯¹å®ä¾‹å†èµ‹å€¼çš„æ—¶å€™å°±å‘ç”Ÿäº†å¤åˆ¶ï¼Œè¿™é‡Œç¼ºå°‘äº†é™„åŠ çš„è¶³è¿¹ã€‚è¿™å°±ä¸ºæ½œåœ¨çš„Bugä»¥åŠæ€§èƒ½çš„é™ä½åŸ‹ä¸‹äº†éšæ‚£ï¼Œå¹¶ä¸”ç”±äºæ²¡æœ‰é™„åŠ è¶³è¿¹ï¼Œå¯¼è‡´åé¢å†å›å¤´æ¥å®¡æŸ¥çš„æ—¶å€™éå¸¸å›°éš¾ã€‚</p><p>è¯•æƒ³ï¼Œå¦‚æœæ˜¯.clone()ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ç”¨ä»£ç æœç´¢å·¥å…·æœç´¢ä»£ç å“ªäº›åœ°æ–¹å‡ºç°äº†cloneå‡½æ•°å°±å¯ä»¥äº†ã€‚è¿™ä¸ªè®¾è®¡ï¼Œåœ¨ <code>Option&lt;T&gt;</code> å’Œ <code>Result&lt;T, E&gt;</code> çš„ <code>unwrap()</code> ç³»åˆ—å‡½æ•°ä¸Šä¹Ÿæœ‰ä½“ç°ã€‚</p><p><strong>æ˜¾å¼åœ°ç•™ä¸‹è¶³è¿¹ï¼Œæ˜¯Rustè¯­è¨€è®¾è®¡é‡è¦çš„å“²å­¦ä¹‹ä¸€</strong>ã€‚</p><p>è‡³äºCopyä¸ºä»€ä¹ˆè¦å®šä¹‰æˆCloneçš„subtraitï¼Œè€Œä¸æ˜¯åè¿‡æ¥ï¼Œä¹Ÿæ˜¯è·Ÿè¿™ä¸ªè®¾è®¡å“²å­¦ç›¸å…³ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒRusté¼“åŠ±ä¼˜å…ˆä½¿ç”¨Cloneè€Œä¸é¼“åŠ±ä½¿ç”¨Copyï¼Œäºæ˜¯è®©å¼€å‘è€…åœ¨derive Copyçš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»derive Cloneï¼Œç›¸å½“äºå¤šæ‰“äº†å‡ ä¸ªå­—ç¬¦ï¼Œå¤šä»˜å‡ºäº†ä¸€ç‚¹ä»£ä»·ã€‚ä¹Ÿè®¸å¼€å‘è€…è¿™æ—¶ä¼šæƒ³ï¼Œå¯èƒ½Cloneå°±èƒ½æ»¡è¶³æˆ‘çš„è¦æ±‚äº†ï¼Œèƒ½åœ¨ç»“æ„ä½“ä¸Šçš„deriveå®é‡Œé¢å°‘æ‰“å‡ ä¸ªå­—ç¬¦ï¼Œä¹Ÿæ˜¯ä¸€ä»¶å¥½äº‹å„¿ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªåŸå› å…¶å®æ˜¯ï¼ŒCloneå’ŒCopyåœ¨æœ¬è´¨ä¸Šå…¶å®æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å†…å­˜çš„æŒ‰ä½å¤åˆ¶ï¼Œåªæ˜¯å¤åˆ¶çš„è§„åˆ™æœ‰ä¸€äº›åŒºåˆ«ã€‚</p><h3>ToOwned</h3><p>ToOwnedç›¸å½“äºæ˜¯Cloneæ›´å®½æ³›çš„ç‰ˆæœ¬ã€‚ToOwnedç»™ç±»å‹æä¾›äº†ä¸€ä¸ª <code>to_owned()</code> æ–¹æ³•ï¼Œå¯ä»¥å°†å¼•ç”¨è½¬æ¢ä¸ºæ‰€æœ‰æƒå®ä¾‹ã€‚</p><p>å¸¸è§çš„æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">let a: &amp;str = \"123456\";\nlet s: String = a.to_owned();\n</code></pre><p>é€šè¿‡æŸ¥çœ‹æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åº“æ¥å£æ–‡æ¡£ï¼Œä½ å¯ä»¥ç¡®å®šæœ‰æ²¡å®ç°è¿™ä¸ªtraitã€‚</p><h3>Deref</h3><p>Deref traitå¯ä»¥ç”¨æ¥æŠŠä¸€ç§ç±»å‹è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ï¼Œä½†æ˜¯è¦åœ¨å¼•ç”¨ç¬¦å·&amp;ã€ç‚¹å·æ“ä½œç¬¦ . æˆ–å…¶ä»–æ™ºèƒ½æŒ‡é’ˆçš„è§¦å‘ä¸‹æ‰ä¼šäº§ç”Ÿè½¬æ¢ã€‚æ¯”å¦‚æ ‡å‡†åº“é‡Œæœ€å¸¸è§çš„ &amp;String å¯ä»¥è‡ªåŠ¨è½¬æ¢åˆ° &amp;strï¼ˆè¯·å›é¡¾<a href=\"https://time.geekbang.org/column/article/720426\">ç¬¬ 4 è®²</a>ï¼‰ï¼Œå°±æ˜¯å› ä¸ºStringç±»å‹å®ç°äº†Deref traitã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/46/6ec1b4f409fe430b14884d66a9354d46.jpg?wh=1931x981\" alt=\"11-2\"></p><p>è¿˜æœ‰ <code>&Vec&lt;T&gt;</code> å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸º <code>&[T]</code>ï¼Œä¹Ÿæ˜¯å› ä¸º <code>Vec[T]</code> å®ç°äº†Derefã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/80/58/801214ebaf258a873326b7cc047c1b58.jpg?wh=2101x1282\" alt=\"11-1\"></p><p>åˆ°è¿™é‡Œï¼ŒRusté‡Œå¾ˆå¤šé­”æ³•å°±å¼€å§‹æ­å¼€ç¥ç§˜é¢çº±äº†ã€‚æœ‰äº†è¿™äº›traitä»¥åŠåœ¨å„ç§ç±»å‹ä¸Šçš„å®ç°ï¼ŒRustè®©æˆ‘ä»¬å¯ä»¥å†™å‡ºé¡ºåº”ç›´è§‰ã€èµå¿ƒæ‚¦ç›®ã€åŠŸèƒ½å¼ºå¤§çš„ä»£ç ã€‚</p><p>ä½ è¿˜å¯ä»¥åœ¨æ ‡å‡†åº“æ–‡æ¡£ä¸­æœç´¢Derefï¼ŒæŸ¥é˜…æ‰€æœ‰å®ç°äº†Deref traitçš„ <a href=\"https://doc.rust-lang.org/std/ops/trait.Deref.html#implementors\">implementors</a>ã€‚</p><p>è¿™é‡Œéœ€è¦æé†’ä½ ä¸€ä¸‹ï¼Œæœ‰äººå°è¯•<a href=\"https://github.com/pretzelhammer/rust-blog/blob/master/posts/tour-of-rusts-standard-library-traits.md#deref--derefmut\">ç”¨ Deref æœºåˆ¶å»å®ç° OOP ç»§æ‰¿</a>ï¼Œä½†æ˜¯é‚£æ˜¯å¾’åŠ³å’Œä¸å®Œæ•´çš„ï¼Œæœ‰å…´è¶£çš„è¯ä½ å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ç»™å‡ºçš„é“¾æ¥ã€‚</p><h3>Drop</h3><p>Drop traitç”¨äºç»™ç±»å‹åšè‡ªå®šä¹‰åƒåœ¾æ¸…ç†ï¼ˆå›æ”¶ï¼‰ã€‚</p><pre><code class=\"language-plain\">trait Drop {\n    fn drop(&amp;mut self);\n}\n</code></pre><p>å®ç°äº†è¿™ä¸ªtraitçš„ç±»å‹çš„å®ä¾‹åœ¨èµ°å‡ºä½œç”¨åŸŸçš„æ—¶å€™ï¼Œè§¦å‘è°ƒç”¨drop()æ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨å‘ç”Ÿåœ¨è¿™ä¸ªå®ä¾‹è¢«é”€æ¯ä¹‹å‰ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„ä½¿ç”¨æ–¹å¼ã€‚</p><pre><code class=\"language-plain\">struct A;\nimpl Drop for A {\n  fn drop(&amp;mut self){\n    // å¯ä»¥å°è¯•åœ¨è¿™é‡Œæ‰“å°ç‚¹ä¸œè¥¿çœ‹çœ‹ä»€ä¹ˆæ—¶å€™è°ƒç”¨\n  }\n}\n</code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸ºè‡ªå·±çš„ç±»å‹å®ç°è¿™ä¸ªtraitï¼Œé™¤éé‡åˆ°ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è°ƒç”¨å¤–éƒ¨çš„Cåº“å‡½æ•°ï¼Œç„¶ååœ¨Cé‚£è¾¹åˆ†é…äº†èµ„æºï¼Œç”±Cåº“é‡Œçš„å‡½æ•°è´Ÿè´£é‡Šæ”¾ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦åœ¨Rustçš„åŒ…è£…ç±»å‹ï¼ˆå¯¹Cåº“ä¸­ç±»å‹çš„åŒ…è£…ï¼‰ä¸Šå®ç°Dropï¼Œå¹¶è°ƒç”¨é‚£ä¸ªCåº“ä¸­é‡Šæ”¾èµ„æºçš„å‡½æ•°ã€‚è¯¾ç¨‹æœ€åä¸¤è®²FFIç¼–ç¨‹ä¸­ï¼Œä½ ä¼šçœ‹åˆ°Dropçš„å…·ä½“ä½¿ç”¨ã€‚</p><h3>é—­åŒ…ç›¸å…³trait</h3><p>æ ‡å‡†åº“ä¸­æœ‰3ä¸ªtraitä¸é—­åŒ…ç›¸å…³ï¼Œåˆ†åˆ«æ˜¯FnOnceã€FnMutã€Fnã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å®ƒä»¬çš„å®šä¹‰ã€‚</p><pre><code class=\"language-plain\">trait FnOnce&lt;Args&gt; {\n    type Output;\n    fn call_once(self, args: Args) -&gt; Self::Output;\n}\ntrait FnMut&lt;Args&gt;: FnOnce&lt;Args&gt; {\n    fn call_mut(&amp;mut self, args: Args) -&gt; Self::Output;\n}\ntrait Fn&lt;Args&gt;: FnMut&lt;Args&gt; {\n    fn call(&amp;self, args: Args) -&gt; Self::Output;\n}\n</code></pre><p>å‰é¢æˆ‘ä»¬ä¹Ÿè®²è¿‡ï¼Œé—­åŒ…å°±æ˜¯ä¸€ç§èƒ½æ•è·ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„å‡½æ•°ã€‚</p><pre><code class=\"language-plain\">let range = 0..10;\nlet get_range_count = || range.count();  \n</code></pre><p>ä»£ç é‡Œçš„è¿™ä¸ª get_range_count å°±æ˜¯é—­åŒ…ï¼Œrangeæ˜¯è¢«è¿™ä¸ªé—­åŒ…æ•è·çš„ç¯å¢ƒå˜é‡ã€‚</p><p>è™½ç„¶è¯´å®ƒæ˜¯ä¸€ç§å‡½æ•°ï¼Œä½†æ˜¯ä¸é€šè¿‡fnè¿›è¡Œå®šä¹‰ã€‚åœ¨Rustä¸­ï¼Œå¹¶ä¸æŠŠè¿™ä¸ªé—­åŒ…çš„ç±»å‹å¤„ç†æˆfnè¿™ç§å‡½æ•°æŒ‡é’ˆç±»å‹ï¼Œè€Œæ˜¯æœ‰å•ç‹¬çš„ç±»å‹å®šä¹‰ã€‚</p><p>é‚£ä¹ˆï¼Œå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ã€‚é—­åŒ…çš„ç±»å‹æ˜¯ç”±Rustç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œå¹¶ä¸”åœ¨ç¡®å®šç±»å‹çš„æ—¶å€™è¦æ ¹æ®è¿™ä¸ªé—­åŒ…æ•è·ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡æ—¶çš„è¡Œä¸ºæ¥ç¡®å®šã€‚</p><p>æ€»çš„æ¥è¯´æœ‰ä¸‰ç§è¡Œä¸ºï¼ˆâš ï¸ æ‰€æœ‰æƒä¸‰æ€å†ç°ï¼‰ã€‚</p><ol>\n<li>è·å–äº†ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„æ‰€æœ‰æƒï¼Œå¯¹åº” FnOnceã€‚</li>\n<li>åªè·å–äº†ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„&amp;mutå¼•ç”¨ï¼Œå¯¹åº” FnMutã€‚</li>\n<li>åªè·å–äº†ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„&amp;å¼•ç”¨ï¼Œå¯¹åº” Fnã€‚</li>\n</ol><p>æ ¹æ®è¿™ä¸‰ç§ä¸åŒçš„è¡Œä¸ºï¼ŒRustç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æŠŠé—­åŒ…ç”Ÿæˆä¸ºè¿™ä¸‰ç§ä¸åŒç±»å‹ä¸­çš„ä¸€ç§ã€‚è¿™ä¸‰ç§ä¸åŒç±»å‹çš„é—­åŒ…ï¼Œå…·ä½“ç±»å‹å½¢å¼æˆ‘ä»¬ä¸çŸ¥é“ï¼ŒRustæ²¡æœ‰æš´éœ²ç»™æˆ‘ä»¬ã€‚ä½†æ˜¯Rustç»™æˆ‘ä»¬æš´éœ²äº†FnOnceã€FnMutã€Fnè¿™3ä¸ªtraitï¼Œå°±åˆšå¥½å¯¹åº”äºé‚£ä¸‰ç§ç±»å‹ã€‚ç»“åˆæˆ‘ä»¬å‰é¢è®²åˆ°çš„trait objectï¼Œå°±èƒ½åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å¯¹é‚£äº›ç±»å‹è¿›è¡Œæè¿°äº†ã€‚</p><p>FnOnceä»£è¡¨çš„é—­åŒ…ç±»å‹åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ¯”å¦‚ï¼›</p><pre><code class=\"language-plain\">fn main() {\n    let range = 0..10;\n    let get_range_count = || range.count();\n    assert_eq!(get_range_count(), 10); // âœ…\n    get_range_count(); // âŒ\n}\n</code></pre><p>å†è°ƒç”¨å°±æŠ¥é”™äº†ã€‚</p><p>FnMutä»£è¡¨çš„é—­åŒ…ç±»å‹èƒ½è¢«è°ƒç”¨å¤šæ¬¡ï¼Œå¹¶ä¸”èƒ½ä¿®æ”¹ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„å€¼ï¼Œä¸è¿‡æœ‰ä¸€äº›å‰¯ä½œç”¨ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯æˆ–è€…ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">fn main() {\n    let nums = vec![0, 4, 2, 8, 10, 7, 15, 18, 13];\n    let mut min = i32::MIN;\n    let ascending = nums.into_iter().filter(|&amp;n| {\n        if n &lt;= min {\n            false\n        } else {\n            min = n;  // è¿™é‡Œä¿®æ”¹äº†ç¯å¢ƒå˜é‡minçš„å€¼\n            true\n        }\n    }).collect::&lt;Vec&lt;_&gt;&gt;();\n    assert_eq!(vec![0, 4, 8, 10, 15, 18], ascending); // âœ…\n}\n</code></pre><p>Fn ä»£è¡¨çš„è¿™ç±»é—­åŒ…èƒ½è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†æ˜¯å¯¹ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡æ²¡æœ‰å‰¯ä½œç”¨ã€‚æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">fn main() {\n    let nums = vec![0, 4, 2, 8, 10, 7, 15, 18, 13];\n    let min = 9;\n    let greater_than_9 = nums.into_iter().filter(|&amp;n| n &gt; min).collect::&lt;Vec&lt;_&gt;&gt;();\n    assert_eq!(vec![10, 15, 18, 13], greater_than_9); // âœ…\n}\n</code></pre><p>å¦å¤–ï¼Œfnè¿™ç§å‡½æ•°æŒ‡é’ˆï¼Œç”¨åœ¨ä¸éœ€è¦æ•è·ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">fn add_one(x: i32) -&gt; i32 {\n    x + 1\n}\n\nfn main() {\n    let mut fn_ptr: fn(i32) -&gt; i32 = add_one;  // æ³¨æ„è¿™é‡Œçš„ç±»å‹å®šä¹‰\n    assert_eq!(fn_ptr(1), 2); // âœ…\n    \n    // å¦‚æœä¸€ä¸ªé—­åŒ…æ²¡æœ‰æ•æ‰ç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥é€šè¿‡ç±»å‹è½¬æ¢è½¬æˆ fn ç±»å‹\n    fn_ptr = |x| x + 1; // same as add_one\n    assert_eq!(fn_ptr(1), 2); // âœ…\n}\n</code></pre><h3><code>From&lt;T&gt;</code> å’Œ <code>Into&lt;T&gt;</code></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ Rust æ ‡å‡†åº“ä¸­çš„ä¸¤ä¸ªå…³è”çš„ trait <code>From&lt;T&gt;</code> å’Œ <code>Into&lt;T&gt;</code>ï¼Œå®ƒä»¬ç”¨äºç±»å‹è½¬æ¢ã€‚<code>From&lt;T&gt;</code> å¯ä»¥æŠŠç±»å‹Tè½¬ä¸ºè‡ªå·±ï¼Œè€Œ<code>Into&lt;T&gt;</code> å¯ä»¥æŠŠè‡ªå·±è½¬ä¸ºç±»å‹Tã€‚</p><pre><code class=\"language-plain\">trait From&lt;T&gt; {\n    fn from(T) -&gt; Self;\n}\ntrait Into&lt;T&gt; {\n    fn into(self) -&gt; T;\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°å®ƒä»¬æ˜¯äº’é€†çš„traitã€‚å®é™…ä¸Šï¼ŒRuståªå…è®¸æˆ‘ä»¬å®ç° <code>From&lt;T&gt;</code>ï¼Œå› ä¸ºå®ç°äº†Fromåï¼Œè‡ªåŠ¨å°±å®ç°äº†Intoï¼Œè¯·çœ‹æ ‡å‡†åº“é‡Œçš„è¿™ä¸ªå®ç°ã€‚</p><pre><code class=\"language-plain\">impl&lt;T, U&gt; Into&lt;U&gt; for T\nwhere\n    U: From&lt;T&gt;,\n{\n    fn into(self) -&gt; U {\n        U::from(self)\n    }\n}\n</code></pre><p>å¯¹ä¸€ä¸ªç±»å‹å®ç°äº†Fromåï¼Œå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·çº¦æŸå’Œä½¿ç”¨ã€‚</p><pre><code class=\"language-plain\">fn function&lt;T&gt;(t: T)\nwhere\n    // ä¸‹é¢è¿™ä¸¤ç§çº¦æŸæ˜¯ç­‰ä»·çš„\n    T: From&lt;i32&gt;,\n    i32: Into&lt;T&gt;\n{\n    // ç­‰ä»·\n    let example: T = T::from(0);\n    let example: T = 0.into();\n}\n</code></pre><p>æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p><pre><code class=\"language-plain\">struct Point {\n    x: i32,\n    y: i32,\n}\nimpl From&lt;(i32, i32)&gt; for Point {    // å®ç°ä»(i32, i32)åˆ°Pointçš„è½¬æ¢\n    fn from((x, y): (i32, i32)) -&gt; Self {\n        Point { x, y }\n    }\n}\nimpl From&lt;[i32; 2]&gt; for Point {      // å®ç°ä»[i32; 2]åˆ°Pointçš„è½¬æ¢\n    fn from([x, y]: [i32; 2]) -&gt; Self {\n        Point { x, y }\n    }\n}\nfn example() {\n    // ä½¿ç”¨from()è½¬æ¢ä¸åŒç±»å‹\n    let origin = Point::from((0, 0));\n    let origin = Point::from([0, 0]);\n    // ä½¿ç”¨into()è½¬æ¢ä¸åŒç±»å‹\n    let origin: Point = (0, 0).into();\n    let origin: Point = [0, 0].into();\n}\n</code></pre><p>å…¶å®Fromæ˜¯å•å‘çš„ã€‚å¯¹äºä¸¤ä¸ªç±»å‹è¦äº’ç›¸è½¬çš„è¯ï¼Œæ˜¯éœ€è¦äº’ç›¸å®ç°Fromçš„ã€‚</p><p>æœ¬èº«ï¼Œ<code>From&lt;T&gt;</code> å’Œ <code>Into&lt;T&gt;</code> éƒ½éšå«äº†æ‰€æœ‰æƒï¼Œ<code>From&lt;T&gt;</code> çš„Selfæ˜¯å…·æœ‰æ‰€æœ‰æƒçš„ï¼Œ<code>Into&lt;T&gt;</code> çš„Tä¹Ÿæ˜¯å…·æœ‰æ‰€æœ‰æƒçš„ã€‚<code>Into&lt;T&gt;</code> æœ‰ä¸ªå¸¸ç”¨çš„æ¯” <code>From&lt;T&gt;</code> æ›´è‡ªç„¶çš„åœºæ™¯æ˜¯ï¼Œå¦‚æœä½ å·²ç»æ‹¿åˆ°äº†ä¸€ä¸ªå˜é‡ï¼Œæƒ³æŠŠå®ƒå˜æˆå…·æœ‰æ‰€æœ‰æƒçš„å€¼ï¼ŒIntoå†™èµ·æ¥æ›´é¡ºæ‰‹ã€‚å› ä¸º <code>into()</code> æ˜¯æ–¹æ³•ï¼Œè€Œ <code>from()</code> æ˜¯å…³è”å‡½æ•°ã€‚</p><p>æ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">struct Person {\n    name: String,\n}\nimpl Person {\n    // è¿™ä¸ªæ–¹æ³•åªæ¥æ”¶Stringå‚æ•°\n    fn new1(name: String) -&gt; Person {\n        Person { name }\n    }\n    // è¿™ä¸ªæ–¹æ³•å¯æ¥æ”¶ \n    // - String\n    // - &amp;String\n    // - &amp;str\n    // - Box&lt;str&gt;\n    // - char\n    // è¿™å‡ ç§å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬éƒ½å®ç°äº†Into&lt;String&gt;\n    fn new2&lt;N: Into&lt;String&gt;&gt;(name: N) -&gt; Person {\n        Person { name: name.into() }  // è°ƒç”¨into()ï¼Œå†™èµ·æ¥å¾ˆç®€æ´\n    }\n}\n</code></pre><h3>TryFrom TryInto</h3><p><code>TryFrom&lt;T&gt;</code> å’Œ <code>TryInto&lt;T&gt;</code> æ˜¯ <code>From&lt;T&gt;</code> å’Œ <code>Into&lt;T&gt;</code> çš„å¯å¤±è´¥ç‰ˆæœ¬ã€‚å¦‚æœä½ è®¤ä¸ºè½¬æ¢å¯èƒ½ä¼šå‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œå°±é€‰æ‹©è¿™ä¸¤ä¸ªtraitæ¥å®ç°ã€‚</p><pre><code class=\"language-plain\">trait TryFrom&lt;T&gt; {\n    type Error;\n    fn try_from(value: T) -&gt; Result&lt;Self, Self::Error&gt;;\n}\n\ntrait TryInto&lt;T&gt; {\n    type Error;\n    fn try_into(self) -&gt; Result&lt;T, Self::Error&gt;;\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨ <code>try_from()</code> å’Œ <code>try_into()</code> åè¿”å›çš„æ˜¯Resultï¼Œä½ éœ€è¦å¯¹Resultè¿›è¡Œå¤„ç†ã€‚</p><h3>FromStr</h3><p>ä»å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åˆ°è‡ªèº«ã€‚</p><pre><code class=\"language-plain\">trait FromStr {\n    type Err;\n    fn from_str(s: &amp;str) -&gt; Result&lt;Self, Self::Err&gt;;\n}\n</code></pre><p>å…¶å®æˆ‘ä»¬å‰é¢å·²ç»é‡åˆ°è¿‡è¿™ä¸ªtraitï¼Œå®ƒå°±æ˜¯å­—ç¬¦ä¸²çš„ <code>parse()</code> æ–¹æ³•èƒŒåçš„traitã€‚</p><pre><code class=\"language-plain\">use std::str::FromStr;\n\nfn example&lt;T: FromStr&gt;(s: &amp;str) {\n    // ä¸‹é¢4ç§è¡¨è¾¾ç­‰ä»·\n    let t: Result&lt;T, _&gt; = FromStr::from_str(s);\n    let t = T::from_str(s);\n    let t: Result&lt;T, _&gt; = s.parse();\n    let t = s.parse::&lt;T&gt;(); // æœ€å¸¸ç”¨çš„å†™æ³•\n}\n</code></pre><h3><code>AsRef&lt;T&gt;</code></h3><p><code>AsRef&lt;T&gt;</code> çš„å®šä¹‰ç±»ä¼¼ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-plain\">trait AsRef&lt;T&gt; {\n    fn as_ref(&amp;self) -&gt; &amp;T;\n}\n</code></pre><p>å®ƒæŠŠè‡ªèº«çš„å¼•ç”¨è½¬æ¢æˆç›®æ ‡ç±»å‹çš„å¼•ç”¨ã€‚å’ŒDerefçš„åŒºåˆ«æ˜¯ï¼Œ<code>**deref()</code>æ˜¯éšå¼è°ƒç”¨çš„ï¼Œè€Œ<code>as_ref()</code>éœ€è¦ä½ æ˜¾å¼åœ°è°ƒç”¨**ã€‚æ‰€ä»¥ä»£ç ä¼šæ›´æ¸…æ™°ï¼Œå‡ºé”™çš„æœºä¼šä¹Ÿä¼šæ›´å°‘ã€‚</p><p><code>AsRef&lt;T&gt;</code> å¯ä»¥è®©å‡½æ•°å‚æ•°ä¸­ä¼ å…¥çš„ç±»å‹æ›´åŠ å¤šæ ·åŒ–ï¼Œä¸ç®¡æ˜¯å¼•ç”¨ç±»å‹è¿˜æ˜¯å…·æœ‰æ‰€æœ‰æƒçš„ç±»å‹ï¼Œéƒ½å¯ä»¥ä¼ é€’ã€‚æ¯”å¦‚ï¼›</p><pre><code class=\"language-plain\">// ä½¿ç”¨ &amp;str ä½œä¸ºå‚æ•°å¯ä»¥æ¥æ”¶ä¸‹é¢ä¸¤ç§ç±»å‹\n//  - &amp;str\n//  - &amp;String\nfn takes_str(s: &amp;str) {\n    // use &amp;str\n}\n// ä½¿ç”¨ AsRef&lt;str&gt; ä½œä¸ºå‚æ•°å¯ä»¥æ¥å—ä¸‹é¢ä¸‰ç§ç±»å‹\n//  - &amp;str\n//  - &amp;String\n//  - String\nfn takes_asref_str&lt;S: AsRef&lt;str&gt;&gt;(s: S) {\n    let s: &amp;str = s.as_ref();\n    // use &amp;str\n}\nfn example(slice: &amp;str, borrow: &amp;String, owned: String) {\n    takes_str(slice);\n    takes_str(borrow);\n    takes_str(owned); // âŒ\n    takes_asref_str(slice);\n    takes_asref_str(borrow);\n    takes_asref_str(owned); // âœ…\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå…·æœ‰æ‰€æœ‰æƒçš„Stringå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥å‚æ•°ä¸­äº†ï¼Œç›¸å¯¹äº &amp;str çš„å‚æ•°ç±»å‹è¡¨è¾¾æ›´åŠ æ‰©å±•äº†ä¸€æ­¥ã€‚</p><p>ä½ å¯ä»¥æŠŠ Deref çœ‹æˆæ˜¯éšå¼åŒ–ï¼ˆæˆ–è‡ªåŠ¨åŒ–ï¼‰+å¼±åŒ–ç‰ˆæœ¬çš„ <code>AsRef&lt;T&gt;</code>ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å¿«é€Ÿè¿‡äº†ä¸€éæ ‡å‡†åº“é‡Œæœ€å¸¸è§çš„ä¸€äº›traitï¼Œå†…å®¹æ¯”è¾ƒå¤šã€‚ä½ å¯ä»¥å…ˆæœ‰ä¸ªå°è±¡ï¼Œåé¢é‡åˆ°çš„æ—¶å€™å†å›è¿‡å¤´æ¥æŸ¥é˜…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/18/70/189778d381ce4bbe1e25e0426fc82a70.jpg?wh=2972x1472\" alt=\"\"></p><p>è¿™äº›traitéå¸¸é‡è¦ï¼Œå®ƒä»¬ä¸€èµ·æ„æˆäº†Rustç”Ÿæ€å®ä¼Ÿè“å›¾çš„åŸºç¡€ã€‚å¾ˆå¤šå‰é¢è®²åˆ°çš„ä¸€äº›ç¥å¥‡çš„â€œé­”æ³•â€éƒ½åœ¨è¿™èŠ‚è¯¾æ­å¼€äº†é¢çº±ã€‚traitè¿™ç§è®¾è®¡çœŸçš„ç»™Rustå¸¦æ¥äº†å¼ºå¤§çš„è¡¨è¾¾åŠ›å’Œçµæ´»æ€§ï¼Œå¯¹å®ƒç†è§£è¶Šæ·±åˆ»ï¼Œè¶Šèƒ½ä½“ä¼šRustçš„å‰å®³ã€‚traitå®Œå…¨è§£æ„äº†ä»C++ã€Javaä»¥æ¥ç¼–ç¨‹è¯­è¨€çš„å‘å±•èŒƒå¼ï¼Œä»ç´§è€¦åˆè½¬æ¢æˆæ¾æ•£çš„å¹³é“ºå¼ï¼Œè®©æ–°ç‰¹æ€§çš„æ·»åŠ ä¸ä¼šå¯¹è¯­è¨€æœ¬èº«é€ æˆæ²‰é‡çš„è´Ÿæ‹…ã€‚</p><p>åˆ°è¿™èŠ‚è¯¾ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€é˜¶æ®µåŸºç¡€ç¯‡çš„å­¦ä¹ å°±å®Œæˆäº†ã€‚æˆ‘ä»¬ç”¨11è®²çš„å†…å®¹è¯¦ç»†ä»‹ç»äº†Rustè¯­è¨€é‡Œæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œç„¶è€Œè¿˜æœ‰å¾ˆå¤šRustçš„ç»†èŠ‚æ²¡åŠæ³•å±•å¼€ï¼Œè¿™éœ€è¦ä½ å€ŸåŠ©æˆ‘æä¾›çš„é“¾æ¥è¿˜æœ‰å·²æœ‰çš„èµ„æ–™æŒç»­å­¦ä¹ ã€‚</p><p>åŸºç¡€ç¯‡ç›¸å½“äºè‹¦ç»ƒå†…åŠŸï¼Œä»ä¸‹èŠ‚è¯¾å¼€å§‹æˆ‘ä»¬è¿›å…¥è¿›é˜¶ç¯‡ï¼Œå­¦ä¹ Rustè¯­è¨€åŠç”Ÿæ€ä¸­é¢å‘å®é™…åœºæ™¯çš„å¤–åŠŸæ‹›å¼ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·ä¸¾ä¾‹è¯´æ˜ <code>Deref</code> ä¸ <code>AsRef&lt;T&gt;</code> çš„åŒºåˆ«ã€‚æ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·å­¦ä¹ Rustï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"10ï½œå†æ¢traitï¼šå¸¦ç±»å‹å‚æ•°çš„traitåŠtrait object","id":724776},"right":{"article_title":"12ï½œæ™ºèƒ½æŒ‡é’ˆï¼šä»æ‰€æœ‰æƒçœ‹æ™ºèƒ½æŒ‡é’ˆ","id":725815}},"comments":[{"had_liked":false,"id":387065,"user_name":"é£äº†çš„é¸­å­è¢«ç…®äº†","can_delete":false,"product_type":"c1","uid":3813080,"ip_address":"ç¾å›½","ucode":"5781D69934D956","user_header":"https://static001.geekbang.org/account/avatar/00/3a/2e/d8/7beb49a4.jpg","comment_is_top":false,"comment_ctime":1706344281,"is_pvip":false,"replies":[{"id":141123,"content":"ğŸˆ¶æ„æ€ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1706771761,"ip_address":"é‡åº†","comment_id":387065,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"asref: A åˆ° Bï¼Œ\nderefï¼šBå›åˆ°A","like_count":4,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636707,"discussion_content":"ğŸˆ¶æ„æ€ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706771762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385753,"user_name":"Luke","can_delete":false,"product_type":"c1","uid":1003156,"ip_address":"ä¸Šæµ·","ucode":"4060B4E2EF1D13","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/94/0b22b6a2.jpg","comment_is_top":false,"comment_ctime":1703239765,"is_pvip":false,"replies":[{"id":140630,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703577698,"ip_address":"é‡åº†","comment_id":385753,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Deref å’Œ AsRef&lt;T&gt; æ˜¯ Rust ä¸­ç”¨äºç±»å‹è½¬æ¢çš„ traitã€‚\n\nDeref trait å…è®¸ä½ é‡è½½è§£å¼•ç”¨æ“ä½œç¬¦ *ï¼Œä½¿å¾—ä¸€ä¸ªç±»å‹å¯ä»¥è¢«åƒæŒ‡é’ˆä¸€æ ·è§£å¼•ç”¨ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®ç±»å‹å†…éƒ¨çš„æ•°æ®ã€‚å½“ä½ å¯¹ä¸€ä¸ªå®ç°äº† Deref trait çš„ç±»å‹ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨ Deref trait ä¸­çš„ deref æ–¹æ³•æ¥è·å–å¯¹åº”çš„å€¼ã€‚\n\nAsRef&lt;T&gt; trait åˆ™æ˜¯ç”¨äºå°†ä¸€ä¸ªç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ª as_ref æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å‘ç›®æ ‡ç±»å‹çš„å¼•ç”¨ã€‚è¿™åœ¨éœ€è¦å°†ä¸€ä¸ªç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨æ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åˆ‡ç‰‡ã€‚\n\næ€»ç»“ä¸€ä¸‹åŒºåˆ«ï¼š\n\nDeref trait ç”¨äºé‡è½½è§£å¼•ç”¨æ“ä½œç¬¦ *ï¼Œä½¿å¾—ä¸€ä¸ªç±»å‹å¯ä»¥è¢«åƒæŒ‡é’ˆä¸€æ ·è§£å¼•ç”¨ã€‚\nAsRef&lt;T&gt; trait ç”¨äºå°†ä¸€ä¸ªç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨ã€‚\nåœ¨ä½¿ç”¨ä¸Šï¼Œå¦‚æœä½ éœ€è¦å¯¹ä¸€ä¸ªç±»å‹è¿›è¡Œè§£å¼•ç”¨æ“ä½œï¼Œä½ å¯ä»¥å®ç° Deref traitã€‚å¦‚æœä½ éœ€è¦å°†ä¸€ä¸ªç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨ï¼Œä½ å¯ä»¥å®ç° AsRef&lt;T&gt; traitã€‚","like_count":3,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634496,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703577698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386246,"user_name":"Zoom 6","can_delete":false,"product_type":"c1","uid":3247738,"ip_address":"æ±Ÿè‹","ucode":"377A1D3ABCD705","user_header":"","comment_is_top":false,"comment_ctime":1704377701,"is_pvip":false,"replies":[{"id":140791,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1704435661,"ip_address":"é‡åº†","comment_id":386246,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Deref æ˜¯é‡è½½äº†è¿ç®—ç¬¦ï¼ŒAsRefæ˜¯åšçš„ç±»å‹è½¬æ¢","like_count":2,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635129,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704435661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387806,"user_name":"å…°å¤©ç™½äº‘","can_delete":false,"product_type":"c1","uid":1009155,"ip_address":"æµ·å—","ucode":"D41F1C52A7BFBC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/03/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1708595858,"is_pvip":false,"replies":[{"id":141260,"content":"æ–¹æ³•ç”±å®ä¾‹è°ƒç”¨ï¼Œç”¨ . ï¼Œå…³è”å‡½æ•°ç”±ç±»å‹è°ƒç”¨ï¼Œç”¨ :: ï¼ŒåŒºåˆ«ä¸åœ¨æœ‰æ²¡æœ‰è¿”å›å€¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1708815259,"ip_address":"åŠ æ‹¿å¤§","comment_id":387806,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è€å¸ˆï¼Œæ‚¨åœ¨è®²åˆ°fromå’Œintoçš„æ—¶å€™ï¼Œè¯´â€œå› ä¸º into() æ˜¯æ–¹æ³•ï¼Œè€Œ from() æ˜¯å…³è”å‡½æ•°ã€‚â€ï¼Œè€Œåœ¨traitå£°æ˜é‡Œéƒ½æ˜¯æœ‰è¿”å›å€¼çš„å‘€ï¼Ÿè¯¥æ€æ ·ç†è§£å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637681,"discussion_content":"æ–¹æ³•ç”±å®ä¾‹è°ƒç”¨ï¼Œç”¨ . ï¼Œå…³è”å‡½æ•°ç”±ç±»å‹è°ƒç”¨ï¼Œç”¨ :: ï¼ŒåŒºåˆ«ä¸åœ¨æœ‰æ²¡æœ‰è¿”å›å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708815259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386040,"user_name":"My dream","can_delete":false,"product_type":"c1","uid":1077733,"ip_address":"å››å·","ucode":"2FEFB344230C17","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/e5/bcdc382a.jpg","comment_is_top":false,"comment_ctime":1703890065,"is_pvip":false,"replies":[{"id":140730,"content":"å¯ä»¥çœ‹çœ‹è¿™ç¯‡. https:&#47;&#47;blog.rust-lang.org&#47;inside-rust&#47;2023&#47;05&#47;03&#47;stabilizing-async-fn-in-trait.html  \nè¿˜æœ‰åˆšå‘å¸ƒçš„ç¨³å®šç‰ˆæœ¬: https:&#47;&#47;blog.rust-lang.org&#47;2023&#47;12&#47;28&#47;Rust-1.75.0.html\nç”¨æ³•è·Ÿå•ç‹¬å†™ async fn ç°åœ¨æ˜¯ä¸€æ ·çš„.","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1704171062,"ip_address":"é‡åº†","comment_id":386040,"utype":1}],"discussion_count":0,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"èƒ½è®²ä¸€ä¸‹åœ¨traitä¸­å¦‚ä½•ä½¿ç”¨async fnå—ï¼Ÿæˆ‘è¿˜ä¸ä¼šä½¿ç”¨","like_count":0},{"had_liked":false,"id":385458,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702637644,"is_pvip":false,"replies":[{"id":140564,"content":"å“ˆå“ˆã€‚gpt4æœ‰è¶£çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1703123366,"ip_address":"é‡åº†","comment_id":385458,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"as_ref æ²¡å°è±¡äº†ï¼Œ æ‰¾gpt4çœ‹äº†çœ‹ï¼Œ æ€»ç»“äº†ä¸‹æ ¸å¿ƒå°±è¿™ä¿©ï¼š\n\n- implicit vs explicit\n    - Deref trait è‡ªåŠ¨è¿è¡Œï¼Œ `*T` ç›´æ¥è§¦å‘ deref()ï¼Œ çœ‹èµ·æ¥åƒæ˜¯éšå¼è§¦å‘\n    - AsRef trait éœ€è¦æ˜¾å¼è°ƒç”¨ as_ref()\n- åŠŸèƒ½ä¸åŒï¼ˆæˆ‘çœ‹åˆ°è¿™æ¡çš„æ—¶å€™éƒ½æ„£äº†ï¼Œ è¿™è°ä¸çŸ¥é“ï¼Œ ä¸ºæ’’è¿˜ç®—æ˜¯ key diffï¼‰\n    - Deref æ˜¯è§£å¼•ç”¨çš„\n    - AsRef æ˜¯åˆ›å»ºå¼•ç”¨çš„","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634240,"discussion_content":"å“ˆå“ˆã€‚gpt4æœ‰è¶£çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1703123366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383862,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"å¹¿ä¸œ","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1699837299,"is_pvip":false,"replies":[{"id":139988,"content":"ä¸èƒ½ï¼ŒRustç¼–è¯‘å™¨å°±æ˜¯è¦è®©ä½ å¤šå†™ä¸€ç‚¹ã€‚æ–‡ä¸­æœ‰è¯´æ˜ç±»ä¼¼çš„åŸå› ã€‚ä¸»è¦æ˜¯æ€•ä½ æ»¥ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699846542,"ip_address":"é‡åº†","comment_id":383862,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¯·é—®ä¸‹é¢è¿™ä¸€å¥ï¼Œèƒ½å¦åªå†™Ordå’ŒEqï¼ŸOrdæ˜¯PartialOrdçš„è¶…é›†, Eqæ˜¯PartialEqçš„è¶…é›†ã€‚ ç¼–è¯‘å™¨åº”è¯¥å¯ä»¥åˆ¤æ–­å‡ºï¼Œå·²ç»å®ç°äº†Ordå’ŒEqï¼Œå½“ç„¶ä¹Ÿè‚¯å®šå®ç°äº†PartialOrdå’ŒPartialEqã€‚\n#[derive(Ord, PartialOrd, PartialEq, Eq)] &#47;&#47; æ³¨æ„è¿™ä¸€å¥ï¼Œ4ä¸ªéƒ½å†™ä¸Š","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631616,"discussion_content":"ä¸èƒ½ï¼ŒRustç¼–è¯‘å™¨å°±æ˜¯è¦è®©ä½ å¤šå†™ä¸€ç‚¹ã€‚æ–‡ä¸­æœ‰è¯´æ˜ç±»ä¼¼çš„åŸå› ã€‚ä¸»è¦æ˜¯æ€•ä½ æ»¥ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699846542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383856,"user_name":"æ¨èµ›å†›","can_delete":false,"product_type":"c1","uid":1050917,"ip_address":"åŒ—äº¬","ucode":"12F314F9E6F158","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/25/2db95c79.jpg","comment_is_top":false,"comment_ctime":1699830290,"is_pvip":false,"replies":[{"id":139986,"content":"æœ‰è¿™ä¸ªæ„æ€åœ¨é‡Œé¢ï¼ŒDereféœ€è¦é€šè¿‡å…¶å®ƒæ“ä½œç¬¦éšå¼è§¦å‘ï¼Œå¦‚ &amp;, . ç­‰ï¼Œå¹¶ä¸”åšçš„æ˜¯è‡ªåŠ¨ &amp; æ“ä½œã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2186062,"ctime":1699846474,"ip_address":"é‡åº†","comment_id":383856,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"Deref ä¸èƒ½ä¼ é€’æ‰€æœ‰æƒå˜é‡ï¼ŒAsrefå¯ä»¥ä¼ é€’æ‰€æœ‰æƒå˜é‡","like_count":0,"discussions":[{"author":{"id":2186062,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5b/4e/8e1f699e.jpg","nickname":"Mike Tang","note":"","ucode":"55775BCEDB5937","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631614,"discussion_content":"æœ‰è¿™ä¸ªæ„æ€åœ¨é‡Œé¢ï¼ŒDereféœ€è¦é€šè¿‡å…¶å®ƒæ“ä½œç¬¦éšå¼è§¦å‘ï¼Œå¦‚ &amp;, . ç­‰ï¼Œå¹¶ä¸”åšçš„æ˜¯è‡ªåŠ¨ &amp; æ“ä½œã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699846474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385457,"user_name":"superggn","can_delete":false,"product_type":"c1","uid":3623568,"ip_address":"åŒ—äº¬","ucode":"831CCD98B393FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/7Q403U68Oy4lXG5sFBPVKLrfwaRzBqpBZibpEBXcPf9UOO3qrnh7RELoByTLzBZLkN9Nukfsj7DibynbZjKAKgag/132","comment_is_top":false,"comment_ctime":1702637034,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"ç¬”è®°\n\n1. Deref trait =&gt; ç»™ typeA å®ç°äº† Deref trait ä¹‹åå°±å¯ä»¥ *typeAinstance äº†\n\n2. deref coercion =&gt; æˆ‘ä»¬è¦å¯¹ obj_0 åšä¸€äº›äº‹æƒ…çš„æ—¶å€™ï¼Œ å¦‚æœå‘ç° obj_0 ä¸é€‚é…ï¼Œ å°±è¯•ä¸€ä¸‹ *obj_0, çœ‹çœ‹å®ƒçš„ deref æ˜¯å¦é€‚é…ï¼Œ å¦‚æœé€‚é…ï¼Œ å°±å¯¹ deref result æäº‹ï¼Œ å¦‚æœä¸é€‚é…ï¼Œ å°±ç»§ç»­æ‰¾ deref, ç›´åˆ°å½“å‰ obj æ²¡æœ‰ deref ä¸ºæ­¢\n","like_count":2},{"had_liked":false,"id":392867,"user_name":"Logical_Monster","can_delete":false,"product_type":"c1","uid":3896502,"ip_address":"ç¾å›½","ucode":"2FA30CED203261","user_header":"https://static001.geekbang.org/account/avatar/00/3b/74/b6/42e74b6d.jpg","comment_is_top":false,"comment_ctime":1722002417,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100626901,"comment_content":"è¿ç®—ç¬¦é‡è½½é‚£é‡Œçš„ä»£ç åº”è¯¥æ”¹ä¸ºï¼Œç›´æ¥é‚£æ ·å†™mainå‡½æ•°ä¼šæœ‰æ‰€æœ‰æƒé—®é¢˜ï¼š\nuse std::ops::Add;\n\n#[derive(Debug, PartialEq)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\n&#47;&#47; ä¸º Point ç±»å‹å®ç° Add traitï¼Œè¿™æ ·ä¸¤ä¸ªPointå®ä¾‹å°±å¯ä»¥ç›´æ¥ç›¸åŠ \nimpl Add for Point {\n    type Output = Point;\n    fn add(self, rhs: Point) -&gt; Point {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 2 };\n    let p2 = Point { x: 3, y: 4 };\n    let p3 = p1 + p2;\n    \n    println!(&quot;{:?}&quot;, p3); &#47;&#47; Output: Point { x: 4, y: 6 }\n    assert_eq!(p3, Point { x: 4, y: 6 });\n}","like_count":0},{"had_liked":false,"id":389215,"user_name":"å‘¨é¹","can_delete":false,"product_type":"c1","uid":1301143,"ip_address":"ç¦å»º","ucode":"3BDD7C9785AEC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/da/97/e421b1ae.jpg","comment_is_top":false,"comment_ctime":1711867727,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"struct Point {\n    x: i32,\n    y: i32,\n}\n\n&#47;&#47; ä¸º Point ç±»å‹å®ç° Add traitï¼Œè¿™æ ·ä¸¤ä¸ªPointå®ä¾‹å°±å¯ä»¥ç›´æ¥ç›¸åŠ \nimpl Add for Point {\n    type Output = Point;\n    fn add(self, rhs: Point) -&gt; Point {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 2 };\n    let p2 = Point { x: 3, y: 4 };\n    let p3 = p1 + p2; &#47;&#47; è¿™é‡Œç›´æ¥ç”¨+å·ä½œç”¨åœ¨ä¸¤ä¸ªPointå®ä¾‹ä¸Š\n&#47;&#47;è¿™é‡Œmoveäº†\n    assert_eq!(p3.x, p1.x + p2.x); &#47;&#47; âœ…\n&#47;&#47;è¿™é‡Œä¸èƒ½å†ç”¨ä¼šæŠ¥é”™\n    assert_eq!(p3.y, p1.y + p2.y); &#47;&#47; âœ…\n&#47;&#47;è¿™é‡Œä¸èƒ½ç”¨\n}","like_count":0},{"had_liked":false,"id":389213,"user_name":"å‘¨é¹","can_delete":false,"product_type":"c1","uid":1301143,"ip_address":"ç¦å»º","ucode":"3BDD7C9785AEC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/da/97/e421b1ae.jpg","comment_is_top":false,"comment_ctime":1711867298,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100626901,"comment_content":"struct Point {\n    x: i32,\n    y: i32,\n}\n\n&#47;&#47; ä¸º Point ç±»å‹å®ç° Add traitï¼Œè¿™æ ·ä¸¤ä¸ªPointå®ä¾‹å°±å¯ä»¥ç›´æ¥ç›¸åŠ \n&#47;&#47; å»ºè®®åŠ ä¸Š\nimpl std::ops::Add for Point {\n    type Output = Point;\n    fn add(self, rhs: Point) -&gt; Point {\n        Point {\n            x: self.x + rhs.x,\n            y: self.y + rhs.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 1, y: 2 };\n    let p2 = Point { x: 3, y: 4 };\n    let p3 = p1 + p2; &#47;&#47; è¿™é‡Œç›´æ¥ç”¨+å·ä½œç”¨åœ¨ä¸¤ä¸ªPointå®ä¾‹ä¸Š\n    assert_eq!(p3.x, p1.x + p2.x); &#47;&#47; âœ…\n    assert_eq!(p3.y, p1.y + p2.y); &#47;&#47; âœ…\n}","like_count":0}]}