{"id":711690,"title":"02｜提示词技巧：获得代码友好的回复","content":"<p>由于openai 11月6日发布的新的API  v1.0.0, 不兼容以前的版本，所以课程代码会做一定的更新。老师已经更新了部分章节的典型代码，<br>\n链接如下（两个链接都可以，国内用户推荐第二个）：</p><p><a href=\"https://github.com/chaocai2001/gpt_in_practice_v1\">https://github.com/chaocai2001/gpt_in_practice_v1</a></p><p><a href=\"https://gitee.com/chao-superman/llm_in_practice_v1\">https://gitee.com/chao-superman/llm_in_practice_v1</a></p><p>其他部分学员可以参考修改。老师也会在近期陆续更新代码。</p>","comments":[{"had_liked":false,"id":386713,"user_name":"刘稹","can_delete":false,"product_type":"c3","uid":1061398,"ip_address":"美国","ucode":"04E72146C6E68D","user_header":"https://static001.geekbang.org/account/avatar/00/10/32/16/ea9c3cb2.jpg","comment_is_top":true,"comment_ctime":1705389967,"is_pvip":false,"replies":[{"id":141000,"content":"👍","user_name":"作者回复","user_name_real":"编辑","uid":1008262,"ctime":1705460063,"ip_address":"北京","comment_id":386713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"直接使用OPENAI的接口，又改进了老师的作业，返回结果是用0-100\n#用GPT 编写一个用户评语判断程序，输入用户评论，输出评论是正向的还是方向的，分别用Y和N表示\nfrom openai import OpenAI\nclient = OpenAI()\n\ncompletion = client.chat.completions.create(\n  #model=model_resource,\n  model = &quot;gpt-4&quot;,\n  messages=[\n   # {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;&quot;&quot;Analyze comments from the user&#39;s input if it is positive or negative.\n   # Format output is one character Y or N. if it is positive, return Y else return N &quot;&quot;&quot;}, \n    {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;&quot;&quot;Analyze comments from the user&#39;s input if it is positive or negative.\n    Format output is 0 - 100 score, if it is better, the score is bigger &quot;&quot;&quot;}, \n    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;这个产品非常好，但是快递太慢了，以后不会买了&quot;}\n\n  ]\n)\nprint(completion.choices[0].message.content)\n\n结果: 45 \n(如果是Y\\N,结果是N）","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636007,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1705460063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382328,"user_name":"杨松","can_delete":false,"product_type":"c3","uid":1512517,"ip_address":"辽宁","ucode":"FB3C73BC44C94D","user_header":"https://static001.geekbang.org/account/avatar/00/17/14/45/adf079ae.jpg","comment_is_top":false,"comment_ctime":1697078320,"is_pvip":false,"replies":[{"id":139262,"content":"嗯，这里可以有多种方式，其中一种我们常用的就是对返回结果进行一个格式校验，如果不正确则可以通过\n1. 重试（再此调用大模型）, 这里设定一个重试次数\n2. 放弃大模型的返回采用其他降级返回继续执行，\n3. 利用如果正则表达式等提取返回中的有效内容，看看能否进行修正，如果不行采用 1，2","user_name":"作者回复","user_name_real":"编辑","uid":1008262,"ctime":1697100159,"ip_address":"北京","comment_id":382328,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"老师，请教下，promt中规范模型的回复格式，模型只能是尽量去满足吧，有很多时候返回的并不是预想的规范格式，这个时候该怎么处理这类异常呢","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629472,"discussion_content":"嗯，这里可以有多种方式，其中一种我们常用的就是对返回结果进行一个格式校验，如果不正确则可以通过\n1. 重试（再此调用大模型）, 这里设定一个重试次数\n2. 放弃大模型的返回采用其他降级返回继续执行，\n3. 利用如果正则表达式等提取返回中的有效内容，看看能否进行修正，如果不行采用 1，2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697100160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385482,"user_name":"敲代码的小黑猫","can_delete":false,"product_type":"c3","uid":2634898,"ip_address":"浙江","ucode":"71BC207880D077","user_header":"https://static001.geekbang.org/account/avatar/00/28/34/92/643ed88b.jpg","comment_is_top":false,"comment_ctime":1702730948,"is_pvip":false,"replies":[{"id":140476,"content":"感谢，你的澄清👍","user_name":"作者回复","user_name_real":"编辑","uid":1008262,"ctime":1702738305,"ip_address":"北京","comment_id":385482,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"Mark：本节第 3 点 &quot;文本规范异常输出的格式&quot; 的案例：You are a software engineer, you can write a SQL string as the anwser according to the user request.\nAlso, when you cannot create the SQL query for the user&#39;s request based on the given tables, please, you don&#39;t need to anwser any reason, only return &quot;-1&quot; for me,\n               The user&#39;s requirement is based on the given tables:\n                  table “students“ with the columns [id, name, course_id, score];\n                  table &quot;courses&quot; with the columns [id, name].\n\n这个案例我试了一下，使用 gpt-3.5-turbo 是不行的，它依然会返回一个解释为什么无法给出答案的 reason，即便再加一层类似：you don&#39;t need to anwser any reason 这样的约束也是不行的。在 ChatGPT 中验证了一下，的确是 3.5 不行，4可以。所以如果同样使用 3.5 的小伙伴遇到这个问题应该不用怀疑了，是模型能力不行。","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":633903,"discussion_content":"感谢，你的澄清👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702738305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384224,"user_name":"杨松","can_delete":false,"product_type":"c3","uid":1512517,"ip_address":"辽宁","ucode":"FB3C73BC44C94D","user_header":"https://static001.geekbang.org/account/avatar/00/17/14/45/adf079ae.jpg","comment_is_top":false,"comment_ctime":1700554532,"is_pvip":false,"replies":[{"id":140208,"content":"课程的内容是给你一个启发，即让llm返回的结果便于程序处理，也许不定是json，任何你的程序更加方便处理的形式，你都可以通过in-context learning来让llm按要求返回","user_name":"作者回复","user_name_real":"编辑","uid":1008262,"ctime":1700617193,"ip_address":"北京","comment_id":384224,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"老师，现在gpt4已经可以直接指定json格式了，那么课程中的提示词技巧还有实际的意义吗","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632272,"discussion_content":"课程的内容是给你一个启发，即让llm返回的结果便于程序处理，也许不定是json，任何你的程序更加方便处理的形式，你都可以通过in-context learning来让llm按要求返回","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700617193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383360,"user_name":"Dom","can_delete":false,"product_type":"c3","uid":1021556,"ip_address":"广东","ucode":"A036B0D88A4D6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/74/ef636095.jpg","comment_is_top":false,"comment_ctime":1698915602,"is_pvip":false,"replies":[{"id":139663,"content":"在需要比较确定的任务，如生成内容要被程序使用（SQL，JSON），\n我一般用 小于0.2的值，甚至0\n在一些生成性的任务，如生成文字，故事等，\n我一般用大于0.6的值，0.7， 0.9等","user_name":"作者回复","user_name_real":"编辑","uid":1008262,"ctime":1698976471,"ip_address":"北京","comment_id":383360,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"`temperature` 是 OpenAI API 的一个参数，用于控制生成文本的随机性。\n`temperature` 的值通常在 0 到 1 之间，但也可以超过这个范围。`temperature` 的值越高，生成的文本越随机和创造性，但也可能更不准确或不连贯。相反，`temperature` 的值越低，生成的文本越确定和一致，但也可能更保守和重复。\n例如，如果设置 `temperature` 为 0.7，那么生成的文本会比较随机和创造性。如果设置 `temperature` 为 0.2，那么生成的文本会比较确定和一致。\n在使用 OpenAI API 时，可以根据需要调整 `temperature` 的值，以得到满意的生成结果。如果希望生成的文本更有创意，可以尝试增加 `temperature` 的值；如果希望生成的文本更准确和一致，可以尝试降低 `temperature` 的值。\n\n在实际的使用中，蔡老师有没有关于这个参数的一些典型值？","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"蔡超","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630850,"discussion_content":"在需要比较确定的任务，如生成内容要被程序使用（SQL，JSON），\n我一般用 小于0.2的值，甚至0\n在一些生成性的任务，如生成文字，故事等，\n我一般用大于0.6的值，0.7， 0.9等","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1698976471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021556,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/96/74/ef636095.jpg","nickname":"Dom","note":"","ucode":"A036B0D88A4D6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630853,"discussion_content":"谢谢啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698978848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382734,"user_name":"cuisongliu","can_delete":false,"product_type":"c3","uid":1193869,"ip_address":"北京","ucode":"B7A70B06B1B64F","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/8d/f8dbd578.jpg","comment_is_top":false,"comment_ctime":1697905750,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"User： 下面，你作为一个评判程序，我将输入一段文字，如果你认为是正向的就返回Y否则返回N。如果你了解了我的意图，请说”我了解了，请输入文字“。\n\nChatGPT： 我了解了，请输入文字。\n\nUser: 一个卖炸弹的小女孩。\n\nChatGPT: N","like_count":1},{"had_liked":false,"id":382357,"user_name":"徐石头","can_delete":false,"product_type":"c3","uid":1035885,"ip_address":"湖南","ucode":"D8FA8A64FB7E33","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/6d/530df0dd.jpg","comment_is_top":false,"comment_ctime":1697104276,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100625601,"comment_content":"内容总结：\n1.  AI 回复内容中包含自然语言，如果要作为数据源提供给程序调用不够简洁明了，不方便程序接收处理。\n2. 提示词技巧，要求 AI 输出指定格式，比如 json，SQL语句等，提供给程序调用。针对异常错误场景，直返回特定的字符串或格式。\n\n作业：\n用 GPT 写一段用户评语判断的程序，输入用户评论，输出评论是正向还是反向的，分别用 Y和 N 表示\n\n个人理解，用提示词技巧的作用是把 GPT 当成一个数据源的黑盒，通常我们写接口从数据库和缓存获取数据，现在改成从 GPT 获取数据，黑盒是我们不用关心数据生成原理，和逻辑是否正确，仅关注是否调用成功。","like_count":0}]}