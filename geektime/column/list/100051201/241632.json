{"id":241632,"title":"14 | ä¼˜åŒ–TLS/SSLæ€§èƒ½è¯¥ä»ä½•ä¸‹æ‰‹ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>ä»è¿™ä¸€è®²å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥åº”ç”¨å±‚åè®®çš„å¤„ç†ã€‚</p><p>ä¿¡æ¯å®‰å…¨åœ¨å½“ä¸‹è¶Šæ¥è¶Šé‡è¦ï¼Œç»å¤§å¤šæ•°ç«™ç‚¹è®¿é—®æ—¶éƒ½ä½¿ç”¨https://æ›¿ä»£äº†http://ï¼Œè¿™å°±æ˜¯åœ¨ç”¨TLS/SSLåè®®ï¼ˆä¸‹æ–‡ç®€ç§°ä¸ºTLSåè®®ï¼‰æ¥ä¿éšœåº”ç”¨å±‚æ¶ˆæ¯çš„å®‰å…¨ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šå›¾ç‰‡ç±»é—¨æˆ·ç½‘ç«™ï¼Œè¿˜åœ¨ä½¿ç”¨http://ï¼Œè¿™æ˜¯å› ä¸ºTLSåè®®åœ¨å¯¹ä¿¡æ¯åŠ è§£å¯†çš„åŒæ—¶ï¼Œå¿…ç„¶ä¼šé™ä½æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œè¿™äº›ç«™ç‚¹åœ¨æƒè¡¡åé€‰æ‹©äº†æ€§èƒ½ä¼˜å…ˆã€‚</p><p>å®é™…ä¸Šï¼ŒTLSåè®®ç”±ä¸€ç³»åˆ—åŠ å¯†ç®—æ³•åŠè§„èŒƒç»„æˆï¼Œè¿™äº›ç®—æ³•çš„å®‰å…¨æ€§å’Œæ€§èƒ½å„ä¸ç›¸åŒï¼Œç”šè‡³ä¸ä½ çš„ç³»ç»Ÿç¡¬ä»¶ç›¸å…³ã€‚æ¯”å¦‚å½“ä¸»æœºçš„CPUæ”¯æŒAES-NIæŒ‡ä»¤é›†æ—¶ï¼Œé€‰æ‹©AESå¯¹ç§°åŠ å¯†ç®—æ³•ä¾¿å¯ä»¥å¤§å¹…æå‡æ€§èƒ½ã€‚ç„¶è€Œï¼Œè¦æƒ³é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Œéœ€è¦äº†è§£ç®—æ³•æ‰€ç”¨åˆ°çš„ä¸€äº›æ•°å­¦çŸ¥è¯†ï¼Œè€Œå¾ˆå¤šåŒå­¦ç”±äºå¿½è§†äº†æ•°å­¦åŸç†ä¾¿éš¾ä»¥æ­£ç¡®åœ°é…ç½®TLSç®—æ³•ã€‚</p><p>åŒæ—¶ï¼ŒTLSåè®®ä¼˜åŒ–æ—¶ä¹Ÿéœ€è¦äº†è§£ç½‘ç»œå’Œè½¯ä»¶å·¥ç¨‹çŸ¥è¯†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç»œçš„ä¸åŒä½ç½®ç¼“å­˜å¯†é’¥æ¥ä¼˜åŒ–æ€§èƒ½ã€‚è€Œä¸”ï¼ŒTLSåè®®è¿˜å¯ä»¥ä¼˜åŒ–å…¶ä»–åº”ç”¨å±‚åè®®çš„æ€§èƒ½ï¼Œæ¯”å¦‚ä»HTTP/1å‡çº§åˆ°HTTP/2åè®®ä¾¿å¯ä»¥é€šè¿‡TLSåè®®å‡å°‘1ä¸ªRTTçš„æ—¶é—´ã€‚</p><p>ä¼˜åŒ–TLSæ€§èƒ½ç©¶ç«Ÿè¯¥ä»ä½•ä¸‹æ‰‹å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œä¸€æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•çš„æ€§èƒ½ä¼˜åŒ–ï¼ŒäºŒæ˜¯å¦‚ä½•é«˜æ•ˆåœ°åå•†å¯†é’¥ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹ä¼˜åŒ–ç»†èŠ‚ã€‚</p><!-- [[[read_end]]] --><h2>å¦‚ä½•æå‡å¯¹ç§°åŠ å¯†ç®—æ³•çš„æ€§èƒ½ï¼Ÿ</h2><p>å¦‚æœä½ ç”¨Wiresharkç­‰å·¥å…·å¯¹HTTPSè¯·æ±‚æŠ“åŒ…åˆ†æï¼Œä¼šå‘ç°åœ¨TCPä¼ è¾“å±‚ä¹‹ä¸Šçš„æ¶ˆæ¯å…¨æ˜¯ä¹±ç ï¼Œè¿™æ˜¯å› ä¸ºTCPä¹‹ä¸Šçš„TLSå±‚ï¼ŒæŠŠHTTPè¯·æ±‚ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•é‡æ–°è¿›è¡Œäº†ç¼–ç ã€‚<strong>å½“ç„¶ï¼Œç”¨Chromeæµè§ˆå™¨é…åˆWiresharkå¯ä»¥è§£å¯†æ¶ˆæ¯ï¼Œå¸®åŠ©ä½ åˆ†æTLSåè®®çš„ç»†èŠ‚</strong>ï¼ˆå…·ä½“æ“ä½œæ–¹æ³•å¯å‚è€ƒ<a href=\"https://time.geekbang.org/course/detail/175-104932\">ã€ŠWebåè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜ã€‹ç¬¬51è¯¾</a>ï¼‰ã€‚</p><p>ç°ä»£å¯¹ç§°åŠ å¯†ç®—æ³•çš„ç‰¹ç‚¹æ˜¯ï¼Œå³ä½¿æŠŠåŠ å¯†æµç¨‹å‘å…¨ç¤¾ä¼šå…¬å¼€ï¼Œæ”»å‡»è€…ä¹Ÿä»å…¬ç½‘ä¸Šæˆªè·åˆ°å¯†æ–‡ï¼Œä½†åªè¦ä»–æ²¡æœ‰æ‹¿åˆ°å¯†é’¥ï¼Œå°±æ— æ³•ä»å¯†æ–‡ä¸­åæ¨å‡ºåŸå§‹æ˜æ–‡ã€‚å¦‚ä½•åŒæ­¥å¯†é’¥æˆ‘ä»¬ç¨ååœ¨è°ˆï¼Œå…ˆæ¥çœ‹å¦‚ä½•ä¼˜åŒ–å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</p><p>ç›®å‰ä¸»æµçš„å¯¹ç§°åŠ å¯†ç®—æ³•å«åšAESï¼ˆAdvanced Encryption Standardï¼‰ï¼Œå®ƒåœ¨æ€§èƒ½å’Œå®‰å…¨ä¸Šè¡¨ç°éƒ½å¾ˆä¼˜ç§€ã€‚è€Œä¸”ï¼Œå®ƒä¸åªåœ¨è®¿é—®ç½‘ç«™æ—¶æœ€ä¸ºå¸¸ç”¨ï¼Œç”šè‡³ä½ æ—¥å¸¸ä½¿ç”¨çš„WINRARç­‰å‹ç¼©è½¯ä»¶ä¹Ÿåœ¨ä½¿ç”¨AESç®—æ³•ï¼ˆè§<a href=\"https://www.win-rar.com/encryption-faq.html?&amp;L=0\">å®˜æ–¹FAQ</a>ï¼‰ã€‚<strong>å› æ­¤ï¼ŒAESæ˜¯æˆ‘ä»¬çš„é¦–é€‰å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œ</strong>ä¸‹é¢æ¥çœ‹çœ‹AESç®—æ³•è¯¥å¦‚ä½•ä¼˜åŒ–ã€‚</p><p><strong>AESåªæ”¯æŒ3ç§ä¸åŒçš„å¯†é’¥é•¿åº¦ï¼Œåˆ†åˆ«æ˜¯128ä½ã€192ä½å’Œ256ä½ï¼Œå®ƒä»¬çš„å®‰å…¨æ€§ä¾æ¬¡å‡é«˜ï¼Œè¿ç®—æ—¶é—´ä¹Ÿæ›´é•¿ã€‚</strong>æ¯”å¦‚ï¼Œå½“å¯†é’¥ä¸º128æ¯”ç‰¹ä½æ—¶ï¼Œéœ€è¦ç»è¿‡åè½®æ“ä½œï¼Œå…¶ä¸­æ¯è½®è¦ç”¨ç§»ä½æ³•ã€æ›¿æ¢æ³•ã€å¼‚æˆ–æ“ä½œç­‰å¯¹æ˜æ–‡åš4æ¬¡å˜æ¢ã€‚è€Œå½“å¯†é’¥æ˜¯192ä½æ—¶ï¼Œåˆ™è¦ç»è¿‡12è½®æ“ä½œï¼Œå¯†é’¥ä¸º256æ¯”ç‰¹ä½æ—¶ï¼Œåˆ™è¦ç»è¿‡14è½®æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><a href=\"http://www.researchgate.net\"><img src=\"https://static001.geekbang.org/resource/image/8a/28/8ae363f2b0b8cb722533b596b9201428.png?wh=734*999\" alt=\"\" title=\"AES128çš„10è½®åŠ å¯†æµç¨‹[br]æ­¤å›¾ç”±Ahmed Ghanim Waddayä¸Šä¼ äºwww.researchgate.net\"></a></p><p>å¯†é’¥è¶Šé•¿ï¼Œè™½ç„¶æ€§èƒ½ç•¥æœ‰ä¸‹é™ï¼Œä½†å®‰å…¨æ€§æå‡å¾ˆå¤šã€‚æ¯”å¦‚æ—©å…ˆçš„DESç®—æ³•åªæœ‰56ä½å¯†é’¥ï¼Œåœ¨1999å¹´ä¾¿è¢«ç ´è§£ã€‚<strong>åœ¨TLS1.2åŠæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶å…è®¸é€šè®¯åŒæ–¹ä½¿ç”¨DESç®—æ³•ï¼Œè¿™æ˜¯éå¸¸ä¸å®‰å…¨çš„è¡Œä¸ºï¼Œä½ åº”è¯¥åœ¨æœåŠ¡å™¨ä¸Šé™åˆ¶DESç®—æ³•å¥—ä»¶çš„ä½¿ç”¨</strong>ï¼ˆNginxä¸Šé™åˆ¶åŠ å¯†å¥—ä»¶çš„æ–¹æ³•ï¼Œå‚è§ã€ŠNginx æ ¸å¿ƒçŸ¥è¯†100è®²ã€‹<a href=\"https://time.geekbang.org/course/detail/138-75878\">ç¬¬96è¯¾</a> å’Œ<a href=\"https://time.geekbang.org/course/detail/138-79618\">ç¬¬131è¯¾</a>ï¼‰ã€‚ä¹Ÿæ­£å› ä¸ºå¯†é’¥é•¿åº¦å¯¹å®‰å…¨æ€§çš„å·¨å¤§å½±å“ï¼Œç¾å›½æ”¿åºœæ‰ä¸å…è®¸å‡ºå£256ä½å¯†é’¥çš„AESç®—æ³•ã€‚</p><p>åªæœ‰æ•°ç™¾æ¯”ç‰¹çš„å¯†é’¥ï¼Œåˆ°åº•è¯¥å¦‚ä½•å¯¹ä»»æ„é•¿åº¦çš„æ˜æ–‡åŠ å¯†å‘¢ï¼Ÿä¸»æµå¯¹ç§°ç®—æ³•ä¼šå°†åŸå§‹æ˜æ–‡åˆ†æˆç­‰é•¿çš„å¤šç»„æ˜æ–‡ï¼Œå†åˆ†åˆ«ç”¨å¯†é’¥ç”Ÿæˆå¯†æ–‡ï¼Œæœ€åæŠŠå®ƒä»¬æ‹¼æ¥åœ¨ä¸€èµ·å½¢æˆæœ€ç»ˆå¯†æ–‡ã€‚è€ŒAESç®—æ³•æ˜¯æŒ‰ç…§128æ¯”ç‰¹ï¼ˆ16å­—èŠ‚ï¼‰å¯¹æ˜æ–‡è¿›è¡Œåˆ†ç»„çš„ï¼ˆæœ€åä¸€ç»„ä¸è¶³128ä½æ—¶ä¼šå¡«å……0æˆ–è€…éšæœºæ•°ï¼‰ã€‚ä¸ºäº†é˜²æ­¢åˆ†ç»„åå¯†æ–‡å‡ºç°æ˜æ˜¾çš„è§„å¾‹ï¼Œé€ æˆæ”»å‡»è€…å®¹æ˜“æ ¹æ®æ¦‚ç‡ç ´è§£å‡ºåŸæ–‡ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹æ¯ç»„çš„å¯†é’¥åšä¸€äº›å˜æ¢ï¼Œ<strong>è¿™ç§åˆ†ç»„åå˜æ¢å¯†é’¥çš„ç®—æ³•å°±å«åšåˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ˆä¸‹æ–‡ç®€ç§°ä¸ºåˆ†ç»„æ¨¡å¼ï¼‰ï¼Œå®ƒæ˜¯å½±å“AESæ€§èƒ½çš„å¦ä¸€ä¸ªå› ç´ ã€‚</strong></p><p><a href=\"https://zh.wikipedia.org/wiki/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F\"><img src=\"https://static001.geekbang.org/resource/image/46/d1/460d594465b9eb9a04426c6ee35da4d1.png?wh=1294*539\" alt=\"\" title=\"ä¼˜ç§€çš„åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼[br]æ›´éš¾ä»¥ä»å¯†æ–‡ä¸­å‘ç°è§„å¾‹ï¼Œå›¾å‚è§wiki\"></a></p><p>æ¯”å¦‚ï¼ŒCBCåˆ†ç»„æ¨¡å¼ä¸­ï¼Œåªæœ‰ç¬¬1ç»„æ˜æ–‡åŠ å¯†å®Œæˆåï¼Œæ‰èƒ½å¯¹ç¬¬2ç»„åŠ å¯†ï¼Œå› ä¸ºç¬¬2ç»„åŠ å¯†æ—¶ä¼šç”¨åˆ°ç¬¬1ç»„ç”Ÿæˆçš„å¯†æ–‡ã€‚å› æ­¤ï¼ŒCBCå¿…ç„¶æ— æ³•å¹¶è¡Œè®¡ç®—ã€‚åœ¨ææ–™ç§‘å­¦å‡ºç°ç“¶é¢ˆã€å•æ ¸é¢‘ç‡ä¸å†æå‡çš„å½“ä¸‹ï¼ŒCPUéƒ½åœ¨å‘å¤šæ ¸æ–¹å‘å‘å±•ï¼Œè€ŒCBCåˆ†ç»„æ¨¡å¼æ— æ³•ä½¿ç”¨å¤šæ ¸çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œæ€§èƒ½å—åˆ°å¾ˆå¤§å½±å“ã€‚<strong>æ‰€ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬åº”é€‰æ‹©å¯ä»¥å¹¶è¡Œè®¡ç®—çš„GCMåˆ†ç»„æ¨¡å¼ï¼Œè¿™ä¹Ÿæ˜¯å½“ä¸‹äº’è”ç½‘ä¸­æœ€å¸¸è§çš„AESåˆ†ç»„ç®—æ³•ã€‚</strong></p><p>ç”±äºAESç®—æ³•ä¸­çš„æ›¿æ¢æ³•ã€è¡Œç§»ä½ç­‰æµç¨‹å¯¹CPUæŒ‡ä»¤å¹¶ä¸å‹å¥½ï¼Œæ‰€ä»¥Intelåœ¨2008å¹´æ¨å‡ºäº†æ”¯æŒ<a href=\"https://zh.wikipedia.org/wiki/AES%E6%8C%87%E4%BB%A4%E9%9B%86\">AES-NIæŒ‡ä»¤é›†</a>çš„CPUï¼Œèƒ½å¤Ÿå°†AESç®—æ³•çš„æ‰§è¡Œé€Ÿåº¦ä»æ¯å­—èŠ‚æ¶ˆè€—28ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆå‚è§<a href=\"https://www.cryptopp.com/benchmarks-p4.html\">è¿™é‡Œ</a>ï¼‰ï¼Œé™ä½è‡³3.5ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆå‚è§<a href=\"https://groups.google.com/forum/#!msg/cryptopp-users/5x-vu0KwFRk/CO8UIzwgiKYJ\">è¿™é‡Œ</a>ï¼‰ã€‚åœ¨Linuxä¸Šä½ å¯ä»¥ç”¨ä¸‹é¢è¿™è¡Œå‘½ä»¤æŸ¥çœ‹CPUæ˜¯å¦æ”¯æŒAES-NIæŒ‡ä»¤é›†ï¼š</p><pre><code># sort -u /proc/crypto | grep module |grep aes\nmodule       : aesni_intel\n</code></pre><p><strong>å› æ­¤ï¼Œå¦‚æœCPUæ”¯æŒAES-NIç‰¹æ€§ï¼Œé‚£ä¹ˆåº”é€‰æ‹©AESç®—æ³•ï¼Œå¦åˆ™å¯ä»¥é€‰æ‹©<a href=\"https://tools.ietf.org/html/rfc7539\">CHACHA20</a> å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒä¸»è¦ä½¿ç”¨ARXæ“ä½œï¼ˆadd-rotate-xorï¼‰ï¼ŒCPUæ‰§è¡Œèµ·æ¥æ›´å¿«ã€‚</strong></p><p>è¯´å®Œå¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å†æ¥çœ‹åŠ å¯†æ—¶çš„å¯†é’¥æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚</p><h2>å¦‚ä½•æ›´å¿«åœ°åå•†å‡ºå¯†é’¥ï¼Ÿ</h2><p>æ— è®ºå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰å¤šä¹ˆå®‰å…¨ï¼Œä¸€æ—¦å¯†é’¥è¢«æ³„éœ²ï¼Œä¿¡æ¯å®‰å…¨å°±æ˜¯ä¸€çº¸ç©ºè°ˆã€‚æ‰€ä»¥ï¼ŒTLSå»ºç«‹ä¼šè¯çš„ç¬¬1ä¸ªæ­¥éª¤æ˜¯åœ¨æ¡æ‰‹é˜¶æ®µåå•†å‡ºå¯†é’¥ã€‚</p><p>æ—©æœŸè§£å†³å¯†é’¥ä¼ é€’çš„æ˜¯<a href=\"https://en.wikipedia.org/wiki/RSA_(cryptosystem)\">RSA</a> å¯†é’¥åå•†ç®—æ³•ã€‚å½“ä½ éƒ¨ç½²TLSè¯ä¹¦åˆ°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œè¯ä¹¦æ–‡ä»¶ä¸­åŒ…å«ä¸€å¯¹å…¬ç§é’¥ï¼ˆå‚è§<a href=\"https://zh.wikipedia.org/wiki/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5%E5%8A%A0%E5%AF%86\">éå¯¹ç§°åŠ å¯†</a>ï¼‰ï¼Œå…¶ä¸­ï¼Œå…¬é’¥ä¼šåœ¨æ¡æ‰‹é˜¶æ®µä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚åœ¨RSAå¯†é’¥åå•†ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆéšæœºå¯†é’¥ï¼ˆäº‹å®ä¸Šæ˜¯ç”Ÿæˆå¯†é’¥çš„ç§å­å‚æ•°ï¼‰ï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†åå†ä¼ ç»™æœåŠ¡å™¨ã€‚æ ¹æ®éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå…¬é’¥åŠ å¯†çš„æ¶ˆæ¯ä»…èƒ½é€šè¿‡ç§é’¥è§£å¯†ï¼Œè¿™æ ·æœåŠ¡å™¨è§£å¯†åï¼ŒåŒæ–¹å°±å¾—åˆ°äº†ç›¸åŒçš„å¯†é’¥ï¼Œå†ç”¨å®ƒåŠ å¯†åº”ç”¨æ¶ˆæ¯ã€‚</p><p><strong>RSAå¯†é’¥åå•†ç®—æ³•çš„æœ€å¤§é—®é¢˜æ˜¯ä¸æ”¯æŒå‰å‘ä¿å¯†</strong>ï¼ˆ<a href=\"https://zh.wikipedia.org/wiki/%E5%89%8D%E5%90%91%E4%BF%9D%E5%AF%86\">Forward Secrecy</a>ï¼‰ï¼Œä¸€æ—¦æœåŠ¡å™¨çš„ç§é’¥æ³„éœ²ï¼Œè¿‡å»è¢«æ”»å‡»è€…æˆªè·çš„æ‰€æœ‰TLSé€šè®¯å¯†æ–‡éƒ½ä¼šè¢«ç ´è§£ã€‚è§£å†³å‰å‘ä¿å¯†çš„æ˜¯<a href=\"https://zh.wikipedia.org/wiki/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B\">DHï¼ˆDiffieâ€“Hellmanï¼‰å¯†é’¥åå•†ç®—æ³•</a>ã€‚</p><p>æˆ‘ä»¬ç®€å•çœ‹ä¸‹DHç®—æ³•çš„å·¥ä½œæµç¨‹ã€‚é€šè®¯åŒæ–¹å„è‡ªç‹¬ç«‹ç”Ÿæˆéšæœºçš„æ•°å­—ä½œä¸ºç§é’¥ï¼Œè€Œåä¾æ®å…¬å¼€çš„ç®—æ³•è®¡ç®—å‡ºå„è‡ªçš„å…¬é’¥ï¼Œå¹¶é€šè¿‡æœªåŠ å¯†çš„TLSæ¡æ‰‹å‘ç»™å¯¹æ–¹ã€‚æ¥ç€ï¼Œæ ¹æ®å¯¹æ–¹çš„å…¬é’¥å’Œè‡ªå·±çš„ç§é’¥ï¼ŒåŒæ–¹å„è‡ªç‹¬ç«‹è¿ç®—åèƒ½å¤Ÿè·å¾—ç›¸åŒçš„æ•°å­—ï¼Œè¿™å°±å¯ä»¥ä½œä¸ºåç»­å¯¹ç§°åŠ å¯†æ—¶ä½¿ç”¨çš„å¯†é’¥ã€‚<strong>å³ä½¿æ”»å‡»è€…æˆªè·åˆ°æ˜æ–‡ä¼ é€’çš„å…¬é’¥ï¼ŒæŸ¥è¯¢åˆ°å…¬å¼€çš„DHè®¡ç®—å…¬å¼åï¼Œåœ¨ä¸çŸ¥é“ç§é’¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯æ— æ³•è®¡ç®—å‡ºå¯†é’¥çš„ã€‚</strong>è¿™æ ·ï¼ŒDHç®—æ³•å°±å¯ä»¥åœ¨æ¡æ‰‹é˜¶æ®µç”Ÿæˆéšæœºçš„æ–°å¯†é’¥ï¼Œå®ç°å‰å‘ä¿å¯†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9f/1d/9f5ab0e7f64497c825a927782f58f31d.png?wh=1488*340\" alt=\"\"></p><p>DHç®—æ³•çš„è®¡ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè®¡ç®—å…¬é’¥ä»¥åŠæœ€ç»ˆçš„å¯†é’¥æ—¶ï¼Œéœ€è¦åšå¤§é‡çš„ä¹˜æ³•è¿ç®—ï¼Œè€Œä¸”ä¸ºäº†ä¿éšœå®‰å…¨æ€§ï¼Œè¿™äº›æ•°å­—çš„ä½æ•°éƒ½å¾ˆé•¿ã€‚ä¸ºäº†æå‡DHå¯†é’¥äº¤æ¢ç®—æ³•çš„æ€§èƒ½ï¼Œè¯ç”Ÿäº†å½“ä¸‹å¹¿ä¸ºä½¿ç”¨çš„<a href=\"https://zh.wikipedia.org/wiki/%E6%A9%A2%E5%9C%93%E6%9B%B2%E7%B7%9A%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E9%87%91%E9%91%B0%E4%BA%A4%E6%8F%9B\">ECDHå¯†é’¥äº¤æ¢ç®—æ³•</a>ï¼Œ<strong>ECDHåœ¨DHç®—æ³•çš„åŸºç¡€ä¸Šåˆ©ç”¨<a href=\"https://zh.wikipedia.org/wiki/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF\">ECCæ¤­åœ†æ›²çº¿</a>ç‰¹æ€§ï¼Œå¯ä»¥ç”¨æ›´å°‘çš„è®¡ç®—é‡è®¡ç®—å‡ºå…¬é’¥ä»¥åŠæœ€ç»ˆçš„å¯†é’¥ã€‚</strong></p><p>ä¾æ®è§£æå‡ ä½•ï¼Œæ¤­åœ†æ›²çº¿å®é™…å¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸åŒçš„æ›²çº¿ä¾¿æœ‰ä¸åŒçš„å‡½æ•°è¡¨è¾¾å¼ï¼Œç›®å‰ä¸è¢«ä»»ä½•å·²çŸ¥ä¸“åˆ©è¦†ç›–çš„æœ€å¿«æ¤­åœ†æ›²çº¿æ˜¯<a href=\"https://en.wikipedia.org/wiki/Curve25519\">X25519æ›²çº¿</a>ï¼Œå®ƒçš„è¡¨è¾¾å¼æ˜¯y<sup>2</sup> = x<sup>3</sup> + 486662x<sup>2</sup> + xã€‚å› æ­¤ï¼Œå½“é€šè®¯åŒæ–¹åå•†ä½¿ç”¨X25519æ›²çº¿ç”¨äºECDHç®—æ³•æ—¶ï¼Œåªéœ€è¦ä¼ é€’X25519è¿™ä¸ªå­—ç¬¦ä¸²å³å¯ã€‚åœ¨Nginxä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ssl_ecdh_curveæŒ‡ä»¤é…ç½®æƒ³ä½¿ç”¨çš„æ›²çº¿ï¼š</p><pre><code>ssl_ecdh_curve X25519:secp384r1;\n</code></pre><p>é€‰æ‹©å¯†é’¥åå•†ç®—æ³•æ˜¯é€šè¿‡ssl_ciphersæŒ‡ä»¤å®Œæˆçš„ï¼š</p><pre><code>ssl_ciphers 'EECDH+ECDSA+AES128+SHA:RSA+AES128+SHA';\n</code></pre><p>å¯è§ï¼Œssl_cipherså¯ä»¥åŒæ—¶é…ç½®å¯¹ç§°åŠ å¯†ç®—æ³•åŠå¯†é’¥å¼ºåº¦ç­‰ä¿¡æ¯ã€‚æ³¨æ„ï¼Œå½“ssl_prefer_server_ciphersè®¾ç½®ä¸ºonæ—¶ï¼Œssl_ciphersæŒ‡å®šçš„å¤šä¸ªç®—æ³•æ˜¯æœ‰ä¼˜å…ˆé¡ºåºçš„ï¼Œ<strong>æˆ‘ä»¬åº”å½“æŠŠæ€§èƒ½æœ€å¿«ä¸”æœ€å®‰å…¨çš„ç®—æ³•æ”¾åœ¨æœ€å‰é¢ã€‚</strong></p><p>æå‡å¯†é’¥åå•†é€Ÿåº¦çš„å¦ä¸€ä¸ªæ€è·¯ï¼Œæ˜¯å‡å°‘å¯†é’¥åå•†çš„æ¬¡æ•°ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹3ç§æ–¹å¼ã€‚</p><p>é¦–å…ˆï¼Œæœ€ä¸ºç®€å•æœ‰æ•ˆçš„æ–¹å¼æ˜¯åœ¨ä¸€ä¸ªTLSä¼šè¯ä¸­ä¼ è¾“å¤šç»„è¯·æ±‚ï¼Œå¯¹äºHTTPåè®®è€Œè¨€å°±æ˜¯ä½¿ç”¨é•¿è¿æ¥ï¼Œåœ¨è¯·æ±‚ä¸­åŠ å…¥Connection: keep-aliveå¤´éƒ¨ä¾¿å¯ä»¥åšåˆ°ã€‚</p><p>å…¶æ¬¡ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åœ¨é¦–æ¬¡ä¼šè¯ç»“æŸåç¼“å­˜ä¸‹sessionå¯†é’¥ï¼Œå¹¶ç”¨å”¯ä¸€çš„session IDä½œä¸ºæ ‡è¯†ã€‚è¿™æ ·ï¼Œä¸‹ä¸€æ¬¡æ¡æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯åªè¦æŠŠsession IDä¼ ç»™æœåŠ¡å™¨ï¼Œä¸”æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°å¯†é’¥åï¼ˆä¸ºäº†æå‡å®‰å…¨æ€§ï¼Œç¼“å­˜ä¼šå®šæœŸå¤±æ•ˆï¼‰ï¼ŒåŒæ–¹å°±å¯ä»¥åŠ å¯†é€šè®¯äº†ã€‚è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå½“Nå°æœåŠ¡å™¨é€šè¿‡è´Ÿè½½å‡è¡¡æä¾›TLSæœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯å‘½ä¸­ä¸Šæ¬¡è®¿é—®è¿‡çš„æœåŠ¡å™¨çš„æ¦‚ç‡åªæœ‰1/Nï¼Œæ‰€ä»¥å¤§æ¦‚ç‡å®ƒä»¬è¿˜å¾—å†æ¬¡åå•†å¯†é’¥ã€‚</p><p>session ticketæ–¹æ¡ˆå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå®ƒæŠŠæœåŠ¡å™¨ç¼“å­˜å¯†é’¥ï¼Œæ”¹ä¸ºç”±æœåŠ¡å™¨æŠŠå¯†é’¥åŠ å¯†åä½œä¸ºticketç¥¨æ®å‘ç»™å®¢æˆ·ç«¯ï¼Œç”±å®¢æˆ·ç«¯ç¼“å­˜å¯†æ–‡ã€‚å…¶ä¸­ï¼Œé›†ç¾¤ä¸­æ¯å°æœåŠ¡å™¨å¯¹sessionåŠ å¯†çš„å¯†é’¥å¿…é¡»ç›¸åŒï¼Œè¿™æ ·ï¼Œå®¢æˆ·ç«¯æºå¸¦ticketå¯†æ–‡è®¿é—®ä»»æ„ä¸€å°æœåŠ¡å™¨æ—¶ï¼Œéƒ½èƒ½é€šè¿‡è§£å¯†ticketï¼Œè·å–åˆ°å¯†é’¥ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨sessionç¼“å­˜æˆ–è€…session ticketæ—¢æ²¡æœ‰å‰å‘å®‰å…¨æ€§ï¼Œåº”å¯¹<a href=\"https://en.wikipedia.org/wiki/Replay_attack\">é‡æ”¾æ”»å‡»</a>ä¹Ÿæ›´åŠ å›°éš¾ã€‚æå‡TLSæ¡æ‰‹æ€§èƒ½çš„æ›´å¥½æ–¹å¼ï¼Œæ˜¯æŠŠTLSåè®®å‡çº§åˆ°1.3ç‰ˆæœ¬ã€‚</p><h2>ä¸ºä»€ä¹ˆåº”å½“å°½å¿«å‡çº§åˆ°TLS1.3ï¼Ÿ</h2><p>TLS1.3ï¼ˆå‚è§<a href=\"https://tools.ietf.org/html/rfc8446\">RFC8446</a>ï¼‰å¯¹æ€§èƒ½çš„æœ€å¤§æå‡ï¼Œåœ¨äºå®ƒæŠŠTLSæ¡æ‰‹æ—¶é—´ä»2ä¸ªRTTé™ä¸º1ä¸ªRTTã€‚</p><p>åœ¨TLS1.2çš„æ¡æ‰‹ä¸­ï¼Œå…ˆè¦é€šè¿‡Client Helloå’ŒServer Helloæ¶ˆæ¯åå•†å‡ºåç»­ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œå†äº’ç›¸äº¤æ¢å…¬é’¥å¹¶è®¡ç®—å‡ºæœ€ç»ˆå¯†é’¥ã€‚<strong>TLS1.3ä¸­æŠŠHelloæ¶ˆæ¯å’Œå…¬é’¥äº¤æ¢åˆå¹¶ä¸ºä¸€æ­¥ï¼Œè¿™å°±å‡å°‘äº†ä¸€åŠçš„æ¡æ‰‹æ—¶é—´</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><a href=\"https://www.ssl2buy.com/wiki/tls-1-3-protocol-released-move-ahead-to-advanced-security-and-privacy\"><img src=\"https://static001.geekbang.org/resource/image/49/20/4924f22447eaf0cc443aac9b2d483020.png?wh=1832*1290\" alt=\"\" title=\"TLS1.3ç›¸å¯¹TLS1.2ï¼Œå‡å°‘äº†1ä¸ªRTTçš„æ¡æ‰‹æ—¶é—´[br]å›¾ç‰‡æ¥è‡ªwww.ssl2buy.com\"></a></p><p>é‚£TLS1.3æ¡æ‰‹ä¸ºä»€ä¹ˆåªéœ€è¦1ä¸ªRTTå°±å¯ä»¥å®Œæˆå‘¢ï¼Ÿå› ä¸ºTLS1.3æ”¯æŒçš„å¯†é’¥åå•†ç®—æ³•å¤§å¹…åº¦å‡å°‘äº†ï¼Œè¿™æ ·ï¼Œå®¢æˆ·ç«¯å°½å¯ä»¥æŠŠå¸¸ç”¨DHç®—æ³•çš„å…¬é’¥è®¡ç®—å‡ºæ¥ï¼Œå¹¶ä¸åå•†åŠ å¯†ç®—æ³•çš„HELLOæ¶ˆæ¯ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¹Ÿä½œåŒæ ·å¤„ç†ï¼Œè¿™æ ·ä»…ç”¨1ä¸ªRTTå°±å¯ä»¥åå•†å‡ºå¯†é’¥ã€‚</p><p>è€Œä¸”ï¼ŒTLS1.3ä»…æ”¯æŒç›®å‰æœ€å®‰å…¨çš„å‡ ä¸ªç®—æ³•ï¼Œæ¯”å¦‚opensslä¸­ä»…æ”¯æŒä¸‹é¢5ç§å®‰å…¨å¥—ä»¶ï¼š</p><ul>\n<li>TLS_AES_256_GCM_SHA384</li>\n<li>TLS_CHACHA20_POLY1305_SHA256</li>\n<li>TLS_AES_128_GCM_SHA256</li>\n<li>TLS_AES_128_CCM_8_SHA256</li>\n<li>TLS_AES_128_CCM_SHA256</li>\n</ul><p>ç›¸è¾ƒèµ·æ¥ï¼ŒTLS1.2æ”¯æŒå„ç§å¤è€çš„ç®—æ³•ï¼Œä¸­é—´äººå¯ä»¥åˆ©ç”¨<a href=\"https://en.wikipedia.org/wiki/Downgrade_attack\">é™çº§æ”»å‡»</a>ï¼Œåœ¨æ¡æ‰‹é˜¶æ®µæŠŠåŠ å¯†ç®—æ³•æ›¿æ¢ä¸ºä¸å®‰å…¨çš„ç®—æ³•ï¼Œä»è€Œè½»æ¾åœ°ç ´è§£å¯†æ–‡ã€‚å¦‚å‰æ–‡æåˆ°è¿‡çš„DESç®—æ³•ï¼Œç”±äºå¯†é’¥ä½æ•°åªæœ‰56ä½ï¼Œå¾ˆå®¹æ˜“ç ´è§£ã€‚</p><p>å› æ­¤ï¼Œ<strong>æ— è®ºä»æ€§èƒ½è¿˜æ˜¯å®‰å…¨è§’åº¦ä¸Šï¼Œä½ éƒ½åº”è¯¥å°½å¿«æŠŠTLSç‰ˆæœ¬å‡çº§åˆ°1.3ã€‚</strong>ä½ å¯ä»¥ç”¨<a href=\"https://www.ssllabs.com/ssltest/index.html\">è¿™ä¸ªç½‘å€</a>æµ‹è¯•å½“å‰ç«™ç‚¹æ˜¯å¦æ”¯æŒTLS1.3ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/57/a816a361d7f47303cbfeb10035a96d57.png?wh=1051*794\" alt=\"\"></p><p>å¦‚æœä¸æ”¯æŒï¼Œè¿˜å¯ä»¥å‚è§<a href=\"https://time.geekbang.org/dailylesson/detail/100028440\">æ¯æ—¥ä¸€è¯¾ã€ŠTLS1.3åŸç†åŠåœ¨Nginxä¸Šçš„åº”ç”¨ã€‹</a>ï¼Œå‡çº§Nginxåˆ°TLS1.3ç‰ˆæœ¬ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†TLSåè®®çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p><p>åº”ç”¨æ¶ˆæ¯æ˜¯é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•ç¼–ç çš„ï¼Œè€Œç›®å‰AESè¿˜æ˜¯æœ€å®‰å…¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ä¸åŒçš„åˆ†ç»„æ¨¡å¼ä¹Ÿä¼šå½±å“AESç®—æ³•çš„æ€§èƒ½ï¼Œè€ŒGCMæ¨¡å¼èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œæ‰€ä»¥AES_GCMæ˜¯æˆ‘ä»¬çš„é¦–é€‰ã€‚å½“ä½ çš„CPUæ”¯æŒAES-NIæŒ‡ä»¤é›†æ—¶ï¼ŒAESç®—æ³•çš„æ‰§è¡Œä¼šéå¸¸å¿«ï¼Œå¦åˆ™ï¼Œå¯ä»¥è€ƒè™‘å¯¹CPUæ›´å‹å¥½çš„CHACHA20ç®—æ³•ã€‚</p><p>å†æ¥çœ‹å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥æ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Œå®ƒå†³å®šç€TLSç³»ç»Ÿçš„å®‰å…¨ï¼Œä¹Ÿå¯¹HTTPå°å¯¹è±¡çš„ä¼ è¾“é€Ÿåº¦æœ‰å¾ˆå¤§å½±å“ã€‚DHå¯†é’¥åå•†ç®—æ³•é€Ÿåº¦å¹¶ä¸å¿«ï¼Œå› æ­¤ç›®å‰ä¸»è¦ä½¿ç”¨åŸºäºæ¤­åœ†æ›²çº¿çš„ECDHå¯†é’¥åå•†ç®—æ³•ï¼Œå…¶ä¸­ï¼Œä¸è¢«ä»»ä½•ä¸“åˆ©è¦†ç›–çš„X25519æ¤­åœ†æ›²çº¿é€Ÿåº¦æœ€å¿«ã€‚ä¸ºäº†å‡å°‘å¯†é’¥åå•†æ¬¡æ•°ï¼Œæˆ‘ä»¬åº”å½“å°½é‡é€šè¿‡é•¿è¿æ¥æ¥å¤ç”¨ä¼šè¯ã€‚åœ¨TLS1.2åŠæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsessionç¼“å­˜å’Œsession ticketä¹Ÿèƒ½å‡å°‘å¯†é’¥åå•†æ—¶çš„è®¡ç®—é‡ï¼Œä½†å®ƒä»¬æ—¢æ²¡æœ‰å‰å‘å®‰å…¨æ€§ï¼Œä¹Ÿæ›´éš¾é˜²å¾¡é‡æ”¾æ”»å‡»ï¼Œæ‰€ä»¥ä¸ºäº†è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œåº”å½“å°½å¿«å‡çº§åˆ°TLS1.3ã€‚</p><p>TLS1.3å°†æ¡æ‰‹æ—¶é—´ä»2ä¸ªRTTé™ä¸º1ä¸ªRTTï¼Œè€Œä¸”å®ƒé™åˆ¶äº†ç›®å‰å·²ç»ä¸å†å®‰å…¨çš„ç®—æ³•ï¼Œè¿™æ ·ä¸­é—´äººå°±éš¾ä»¥ç”¨é™çº§æ”»å‡»æ¥ç ´è§£å¯†é’¥ã€‚</p><p>å¯†ç å­¦çš„æ¼”è¿›è¶Šæ¥è¶Šå¿«ï¼ŒåŠ å¯†ä¸ç ´è§£æ€»æ˜¯åœ¨é“é«˜ä¸€å°ºã€é­”é«˜ä¸€ä¸ˆçš„äº¤æ›¿å¾ªç¯ä¸­å‘å±•ï¼Œå½“ä¸‹å®‰å…¨çš„ç®—æ³•æœªå¿…åœ¨ä¸€å¹´åä»ç„¶å®‰å…¨ã€‚è€Œä¸”ï¼Œå½“é‡å­è®¡ç®—æœºçœŸæ­£è¯ç”Ÿåï¼Œå®ƒå¼ºå¤§çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›å¯ä»¥è½»æ¾åœ°æš´åŠ›ç ´è§£å½“ä¸‹è¿˜ç®—å®‰å…¨çš„ç®—æ³•ã€‚ç„¶è€Œï¼Œè¿™ç§åˆ’æ—¶ä»£çš„æ–°æŠ€æœ¯å‡ºç°æ—¶æ€»ä¼šæœ‰ä¸€ä¸ªæ—¶é—´çª—å£ï¼Œè€Œåœ¨çª—å£å†…ä¹Ÿä¼šæ¶Œç°å‡ºèƒ½å¤Ÿé˜²å¾¡ä½é‡å­ç ´è§£çš„æ–°ç®—æ³•ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”æ—¶å¸¸å…³æ³¨å¯†ç å­¦çš„è¿›å±•ï¼Œæ›´æ¢æ›´å®‰å…¨ã€æ€§èƒ½ä¹Ÿæ›´ä¼˜ç§€çš„æ–°ç®—æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç•™ç»™ä½ ä¸€é“æ€è€ƒé¢˜ï¼ŒTLSä½“ç³»ä¸­è¿˜æœ‰è®¸å¤šæ€§èƒ½ä¼˜åŒ–ç‚¹ï¼Œæ¯”å¦‚åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²<a href=\"https://zh.wikipedia.org/wiki/OCSP%E8%A3%85%E8%AE%A2\">OSCP Stapling</a>ï¼ˆç”¨äºæ›´å¿«åœ°å‘ç°è¿‡æœŸè¯ä¹¦ï¼‰ä¹Ÿå¯ä»¥æå‡ç½‘ç«™çš„è®¿é—®æ€§èƒ½ï¼Œä½ è¿˜ç”¨è¿‡å“ªäº›æ–¹å¼ä¼˜åŒ–TLSçš„æ€§èƒ½å‘¢ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘æ¢è®¨ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":222197,"user_name":"Geek_007","can_delete":false,"product_type":"c1","uid":1467182,"ip_address":"","ucode":"C80107538EAA7F","user_header":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","comment_is_top":false,"comment_ctime":1590715289,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"66015224729","product_id":100051201,"comment_content":"TLS1.3 æ„Ÿè§‰å…¶å®ä¹Ÿä¸æ˜¯ä¼˜åŒ–ç‰¹åˆ«å¤§ï¼ŒTLS1.2 æœ‰False Startï¼Œä¹Ÿèƒ½åšåˆ°1RTTï¼Œè‡³äº0RTTï¼Œç°åœ¨ä¸»æµçš„CDNåº”è¯¥ä¹Ÿè¿˜æœ‰å¾ˆå¤šå‚å®¶ä¸æ”¯æŒPSKï¼Œæ‰€ä»¥0RTTçš„æ•ˆæœä¹Ÿä¸ä¸€å®šå¥½ã€‚<br>è¯¾åé¢˜ï¼š<br>1ã€ECCè¯ä¹¦åº”è¯¥ç®—æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºè¯ä¹¦æ›´å°ï¼ŒåŠ è§£å¯†æ›´å¿«ã€‚ï¼ˆä¸è¿‡å¥½åƒå› ä¸ºå®¢æˆ·ç«¯å…¬é’¥å¤ªé•¿ï¼Œå¯¹å®¢æˆ·ç«¯ä¸å‹å¥½ï¼Œå°¤å…¶æ˜¯ç§»åŠ¨ç«¯ï¼‰<br>2ã€ç®—æ³•åˆ†ç¦»ã€ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿå¡ä»£ç†è®¡ç®—ã€‚å¯ä»¥æå¤§å‡è½»æ¥å…¥å±‚å‹åŠ›ã€‚<br>3ã€å»æ‰è¯ä¹¦é“¾ä¸­çš„æ ¹è¯ä¹¦ï¼ˆè¯ä¹¦é“¾å¤ªé•¿å¯èƒ½ä¼šå¯¼è‡´å¤šä¸€ä¸ªRTTï¼Œæ¯•ç«ŸTCPè¿˜åœ¨æ…¢å¯åŠ¨ï¼‰<br>4ã€è¿˜æ˜¯ä¿æŒè¿æ¥å§ã€å‡å°‘è¿æ¥æ¬¡æ•°ã€‚<br>5ã€å®¢æˆ·ç«¯çš„session ticket æŒä¹…åŒ–ï¼Œä¹‹å‰éƒ½æ˜¯æåˆ°çš„æœåŠ¡ç«¯çš„session ticketï¼Œä½†æ˜¯å®¢æˆ·ç«¯å¦‚æœæ˜¯æµè§ˆå™¨æˆ–è€…APPï¼Œå› ä¸ºé‡æ–°æ‰“å¼€ç­‰æ“ä½œå¯¼è‡´é‡æ–°å»ºç«‹é“¾æ¥ï¼Œåº”è¯¥ä¼šæ¸…ç©ºä¿å­˜çš„ä¼šè¯ç¥¨æ®ï¼ŒæœåŠ¡ç«¯å³ä¾¿æœ‰ç¥¨æ®ä¹Ÿæ²¡æœ‰ç”¨äº†ã€‚ï¼ˆä¸ªäººç†è§£ï¼Œä¸æ­£ç¡®çš„è¯è¯·è€å¸ˆæŒ‡æ­£ï¼‰<br>","like_count":16},{"had_liked":false,"id":222346,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1590755709,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"23065592189","product_id":100051201,"comment_content":"æœ€è¿‘å°±é‡åˆ°è¿‡tlsåè®®ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä¸è¿‡æˆ‘ä»¬æ˜¯åœ¨å¼€å€’è½¦ã€‚ğŸ˜‚<br><br>æœ€è¿‘å‡çº§åˆ°k8såï¼Œé»˜è®¤çš„ingress nignxåªæ”¯æŒtls1.2ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¯¼è‡´æŸäº›å®‰å“5.xç‰ˆæœ¬ä¸Šçš„appæ— æ³•ä¸æœåŠ¡å™¨æ­£å¸¸é€šè®¯ï¼Œä¸ºäº†å…¼å®¹è¿™éƒ¨åˆ†ç”¨æˆ·ï¼Œåªèƒ½å¼ºåˆ¶æŠŠtlsæ”¯æŒçš„æœ€ä½ç‰ˆæœ¬å·è°ƒå›åˆ°1.0ã€‚","like_count":6,"discussions":[{"author":{"id":1195278,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3d/0e/92176eaa.jpg","nickname":"å·¦æ°§ä½›æ²™æ˜Ÿäºº","note":"","ucode":"0D8295E1DABA8C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400370,"discussion_content":"1.0 å¯å¤ªç§€äº†ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633251687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236765,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1d/038853e5.jpg","nickname":"Yong","note":"","ucode":"154CD23B5ACC67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284915,"discussion_content":"å¤Ÿç‹ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592668895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1236765,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1d/038853e5.jpg","nickname":"Yong","note":"","ucode":"154CD23B5ACC67","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284920,"discussion_content":"æœ€è¿‘åˆæŠ“åŒ…åˆ†æäº†ä¸‹ï¼Œå…¶å®å¹¶ä¸æ˜¯tlsåè®®ç‰ˆæœ¬çš„é—®é¢˜ã€‚\nè€Œæ˜¯javaæŸä¸ªçš„websocketåº“çš„æ—§ç‰ˆæœ¬ä¸è§„èŒƒå¯¼è‡´çš„ã€‚\n\nå®¢æˆ·ç«¯åœ¨æ¡æ‰‹é˜¶æ®µæœªå‘é€sniï¼ˆç›¸å½“äºæ˜¯è¯·æ±‚çš„åŸŸåï¼‰ï¼Œè€Œk8sä¸Šçš„ingresså¹¶æœªé…ç½®é»˜è®¤çš„è¯ä¹¦ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ¡æ‰‹æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›äº†k8sè‡ªå·±è‡ªç­¾åçš„è¯ä¹¦ã€‚å®¢æˆ·ç«¯æ— æ³•éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Œç›´æ¥ç»ˆæ­¢äº†æ¡æ‰‹ã€‚\n\nè¿˜æ˜¯è¦æŠ“åŒ…ï¼Œè°çš„é”…ä¸€ä¸‹å°±ç¡®è®¤äº†ã€‚\nè§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼š\n1.æœåŠ¡ç«¯é…ç½®é»˜è®¤çš„è¯ä¹¦\n2.æ›´æ–°å®¢æˆ·ç«¯åº“çš„ç‰ˆæœ¬\n","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1592669632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":284915,"ip_address":""},"score":284920,"extra":""},{"author":{"id":1236765,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1d/038853e5.jpg","nickname":"Yong","note":"","ucode":"154CD23B5ACC67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366239,"discussion_content":"å—¯å—¯ï¼› è™šæƒŠä¸€åœºï¼›\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617989088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":284920,"ip_address":""},"score":366239,"extra":""}]}]},{"had_liked":false,"id":239195,"user_name":"æ˜ç¿¼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1596456179,"is_pvip":false,"replies":[{"id":"88394","content":"æ˜¯çš„æ˜ç¿¼ï¼ŒDiffie-Hellmanç®—æ³•å…¶å®æœ‰å¾ˆå¤šç§å®ç°ï¼Œå¦‚åŒæ–‡ç¨¿ä¸­çš„å›¾é‡Œï¼Œå¦‚æœæ¯æ¬¡è§£å¯†åå•†pã€gã€aã€béƒ½æ˜¯é‡æ–°ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆè¿™å°±å…·æœ‰å‰å‘ä¿å¯†æ€§ï¼Œæ­¤æ—¶Diffie-Hellmanç®—æ³•ä¹Ÿå«Ephemeral Diffie-Hellmanï¼Œé™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›Diffie-Hellmanç®—æ³•ä¼šå‡ºäºæ€§èƒ½ç­‰å› ç´ è€ƒè™‘ï¼Œé‡å¤ä½¿ç”¨ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚static Diffie-Hellmanç®—æ³•å°±ä¸å…·å¤‡å‰å‘ä¿å¯†æ€§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1596502872,"ip_address":"","comment_id":239195,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18776325363","product_id":100051201,"comment_content":"è€å¸ˆæˆ‘åœ¨å¦ä¸€æœ¬ä¹¦ä¸Šçœ‹DHç®—æ³•ä¸æ˜¯å‰å‘å®‰å…¨ç®—æ³•åŠ¨æ€DHç®—æ³•æˆ–ECDHç®—æ³•æ‰æ˜¯å‰å‘å®‰å…¨çš„","like_count":4,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503018,"discussion_content":"æ˜¯çš„æ˜ç¿¼ï¼ŒDiffie-Hellmanç®—æ³•å…¶å®æœ‰å¾ˆå¤šç§å®ç°ï¼Œå¦‚åŒæ–‡ç¨¿ä¸­çš„å›¾é‡Œï¼Œå¦‚æœæ¯æ¬¡è§£å¯†åå•†pã€gã€aã€béƒ½æ˜¯é‡æ–°ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆè¿™å°±å…·æœ‰å‰å‘ä¿å¯†æ€§ï¼Œæ­¤æ—¶Diffie-Hellmanç®—æ³•ä¹Ÿå«Ephemeral Diffie-Hellmanï¼Œé™¤æ­¤ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›Diffie-Hellmanç®—æ³•ä¼šå‡ºäºæ€§èƒ½ç­‰å› ç´ è€ƒè™‘ï¼Œé‡å¤ä½¿ç”¨ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚static Diffie-Hellmanç®—æ³•å°±ä¸å…·å¤‡å‰å‘ä¿å¯†æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596502872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240214,"user_name":"Bourne","can_delete":false,"product_type":"c1","uid":1311299,"ip_address":"","ucode":"1286279F70B13F","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","comment_is_top":false,"comment_ctime":1596789908,"is_pvip":false,"replies":[{"id":"88722","content":"^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1596843937,"ip_address":"","comment_id":240214,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14481691796","product_id":100051201,"comment_content":"å½“ç„¶ï¼Œç”¨ Chrome æµè§ˆå™¨é…åˆ Wireshark å¯ä»¥è§£å¯†æ¶ˆæ¯ï¼Œå¸®åŠ©ä½ åˆ†æ TLS åè®®çš„ç»†èŠ‚ï¼ˆå…·ä½“æ“ä½œæ–¹æ³•å¯å‚è€ƒã€ŠWeb åè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜ã€‹ç¬¬ 51 è¯¾ï¼‰ã€‚ä¸¥é‡æ€€ç–‘è€å¸ˆåœ¨ç»™è‡ªå·±æ‰“å¹¿å‘Šå“‡ï¼Œç‚¹è¿‡å»ä¸€çœ‹ï¼Œå¹²è´§è¿™ä¹ˆå¤šï¼Œåˆä¹°äº†ï¼Œå“ˆå“ˆå“ˆã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œè€å¸ˆçš„è¯¾ç¨‹è´¨é‡çœŸçš„å¾ˆé«˜ï¼Œã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹è¿˜æ²¡å­¦å®Œï¼Œåˆ°100èŠ‚å·¦å³äº†ï¼ˆå…¶å®æœ‰150è®²ï¼‰ï¼Œå­¦åˆ°äº†å¾ˆå¤šï¼Œä»Nginxå°ç™½åˆ°å†™Nginxé…ç½®ä¿¡æ‰‹æ‹ˆæ¥ï¼ˆå¹ä¸ªç‰›é€¼ï¼‰ï¼Œè°¢è°¢è€å¸ˆçš„ä»˜å‡ºã€‚","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503376,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596843937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240129,"user_name":"å¦¥å","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1596768447,"is_pvip":false,"replies":[{"id":"88719","content":"0RTTä¸‹ï¼Œæœ‰é‡æ”¾æ”»å‡»é£é™©ã€‚1RTTä¸‹æ˜¯å®‰å…¨çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1596843700,"ip_address":"","comment_id":240129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10186703039","product_id":100051201,"comment_content":"æ‰€ä»¥TLS1.3å¯ä»¥æ”¾é‡æ”¾æ”»å‡»å—","like_count":2,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503351,"discussion_content":"0RTTä¸‹ï¼Œæœ‰é‡æ”¾æ”»å‡»é£é™©ã€‚1RTTä¸‹æ˜¯å®‰å…¨çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596843700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232844,"user_name":"Geek_007","can_delete":false,"product_type":"c1","uid":1467182,"ip_address":"","ucode":"C80107538EAA7F","user_header":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","comment_is_top":false,"comment_ctime":1594128384,"is_pvip":false,"replies":[{"id":"94773","content":"å› ä¸ºTCPçš„MSSè¿œå°äº16KBï¼Œæ¯”å¦‚ä¸º1500å­—èŠ‚ï¼Œè¿™æ ·æ¥æ”¶æ–¹æ”¶åˆ°record lengthä¸º16KBæ—¶ï¼Œå°±å¿…é¡»åœ¨æ¥æ”¶åˆ°å¤šä¸ªTCPæŠ¥æ–‡æ€»æ•°ä¸º16KBæ—¶ï¼Œæ‰èƒ½æ‰§è¡Œè§£å¯†è¿™ä¸ªåˆ†æ®µï¼Œå› æ­¤åŠæ—¶æ€§å°±ä¼šå·®ä¸€äº›ã€‚æ‰€ä»¥cloudflareçš„åŠ¨æ€record sizeï¼Œä¸»è¦æ˜¯ä¸ºäº†æ¥æ”¶æ–¹çš„å“åº”é€Ÿåº¦æ›´å¿«ä¸€ç‚¹ã€‚<br><br>å½“ç„¶ï¼Œå¦‚æœTCP MSSå¤§äºrecord sizeï¼Œå°±ä¼šé™ä½ååé‡ï¼Œå› ä¸ºæŠ¥æ–‡å¤´éƒ¨çš„å…³ç³»ï¼Œæœ‰æ•ˆä¿¡æ¯æ¯”å°±ä¼šé™ä½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1605189591,"ip_address":"","comment_id":232844,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5889095680","product_id":100051201,"comment_content":"é™¶è¾‰è€å¸ˆä½ å¥½ï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´å¾ˆå›°æƒ‘ï¼Œå¸Œæœ›èƒ½è§£ç­”ä¸€ä¸‹ï¼Œæ„Ÿè°¢ã€‚TLSçš„record size æ˜¯16KBï¼ŒNginx ä¸Šæœ‰ ssl_buffer_size å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿä¼šè®¾ç½®æ­» record sizeã€‚å¦‚æœæ²¡æœ‰åƒcloudflareä¸€æ ·åšäº†åŠ¨æ€tls record çš„è¯ ï¼Œå°±æ˜¯è¯´TLSçš„record sizeæ˜¯å›ºå®šçš„16KBï¼Œä½†æ˜¯å‡è®¾TLSå»ºè”åæ¯æ¬¡åªå‘1kçš„æ•°æ®ï¼Œä¸å¤Ÿ16kã€‚é‚£ä¹ˆå¯¹ç«¯è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿæ˜¯ç­‰å¾…ï¼Ÿè¿˜æ˜¯è¯´å‘é€å‘ç°å‘é€çš„æ•°æ®ä¸å¤Ÿ16Kï¼Œå°±å¡«å……ï¼Ÿå¦‚æœç­‰å¾…ä¼šé€ æˆæ—¶å»¶é—®é¢˜ï¼Œå¦‚æœå¡«å……ä¼šé€ æˆå‘é€çš„æ•°æ®æ€»æ˜¯è¿‡å¤§ã€‚æ‰€ä»¥ä¸çŸ¥é“è¿™ä¸ª record size ä¸º16 å­—èŠ‚æ€ä¹ˆç†è§£ã€‚å“¦ï¼Œå¯¹äº†ï¼Œå¤§éƒ¨åˆ†Nginxéƒ½æ²¡æœ‰åšåŠ¨æ€TLS record size å§ï¼Œæˆ‘æ˜¯å‚è€ƒ https:&#47;&#47;blog.cloudflare.com&#47;optimizing-tls-over-tcp-to-reduce-latency&#47; è¿™ç¯‡æ–‡ç« æ‰æœ‰è¿™ä¸ªç–‘æƒ‘çš„ã€‚å¸Œæœ›è®¨è®ºè€å¸ˆæœ‰ç©ºé—²ä¹‹ä½™è§£ç­”ä¸€ä¸‹ã€‚","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500785,"discussion_content":"å› ä¸ºTCPçš„MSSè¿œå°äº16KBï¼Œæ¯”å¦‚ä¸º1500å­—èŠ‚ï¼Œè¿™æ ·æ¥æ”¶æ–¹æ”¶åˆ°record lengthä¸º16KBæ—¶ï¼Œå°±å¿…é¡»åœ¨æ¥æ”¶åˆ°å¤šä¸ªTCPæŠ¥æ–‡æ€»æ•°ä¸º16KBæ—¶ï¼Œæ‰èƒ½æ‰§è¡Œè§£å¯†è¿™ä¸ªåˆ†æ®µï¼Œå› æ­¤åŠæ—¶æ€§å°±ä¼šå·®ä¸€äº›ã€‚æ‰€ä»¥cloudflareçš„åŠ¨æ€record sizeï¼Œä¸»è¦æ˜¯ä¸ºäº†æ¥æ”¶æ–¹çš„å“åº”é€Ÿåº¦æ›´å¿«ä¸€ç‚¹ã€‚\n\nå½“ç„¶ï¼Œå¦‚æœTCP MSSå¤§äºrecord sizeï¼Œå°±ä¼šé™ä½ååé‡ï¼Œå› ä¸ºæŠ¥æ–‡å¤´éƒ¨çš„å…³ç³»ï¼Œæœ‰æ•ˆä¿¡æ¯æ¯”å°±ä¼šé™ä½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605189591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222437,"user_name":"å†¬é£å‘å·¦å¹","can_delete":false,"product_type":"c1","uid":1066928,"ip_address":"","ucode":"376C45C5134F93","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/b0/a9b77a1e.jpg","comment_is_top":false,"comment_ctime":1590806615,"is_pvip":false,"replies":[{"id":"82393","content":"ä½ å¥½ä¸œéƒ­ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼ŒTLSæ¡æ‰‹é˜¶æ®µNginxçš„Cipher Suiteï¼Œè¦é€šè¿‡ssl_ciphers æŒ‡ä»¤æ¥é…æ”¯æŒçš„suitesï¼Œå¹¶å¯é€šè¿‡ssl_prefer_server_ciphersæŒ‡å®šä¼˜å…ˆé€‰ç”¨çš„ç®—æ³•ã€‚<br>è¯ä¹¦åªæ˜¯åŒ…å«äº†å¯†é’¥ã€èº«ä»½ç­‰ä¿¡æ¯ï¼Œå®ƒä»¬ä¸å¯†é’¥åå•†æ–¹å¼ã€å¯¹ç§°åŠ å¯†ç®—æ³•å¹¶æ— å…³ç³»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1591169916,"ip_address":"","comment_id":222437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5885773911","product_id":100051201,"comment_content":"è¯·é—®è€å¸ˆï¼Œæˆ‘åœ¨nginxé…ç½®ä¸­ï¼Œä¸ç®¡ssl_certificateå’Œssl_certificate_keyæ˜¯å¦é…ç½®eccè¯ä¹¦ï¼ŒæŠ“åŒ…æŸ¥çœ‹æœåŠ¡å™¨çš„server helloå“åº”ä¸­çš„Cipher Suiteå­—æ®µéƒ½æ˜¯TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256ï¼Œè¿™æ˜¯æ­£å¸¸çš„å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496793,"discussion_content":"ä½ å¥½ä¸œéƒ­ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼ŒTLSæ¡æ‰‹é˜¶æ®µNginxçš„Cipher Suiteï¼Œè¦é€šè¿‡ssl_ciphers æŒ‡ä»¤æ¥é…æ”¯æŒçš„suitesï¼Œå¹¶å¯é€šè¿‡ssl_prefer_server_ciphersæŒ‡å®šä¼˜å…ˆé€‰ç”¨çš„ç®—æ³•ã€‚\nè¯ä¹¦åªæ˜¯åŒ…å«äº†å¯†é’¥ã€èº«ä»½ç­‰ä¿¡æ¯ï¼Œå®ƒä»¬ä¸å¯†é’¥åå•†æ–¹å¼ã€å¯¹ç§°åŠ å¯†ç®—æ³•å¹¶æ— å…³ç³»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591169916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332606,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1643363737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643363737","product_id":100051201,"comment_content":"TLS1.3ï¼ˆå‚è§RFC8446ï¼‰å¯¹æ€§èƒ½çš„æœ€å¤§æå‡ï¼Œåœ¨äºå®ƒæŠŠ TLS æ¡æ‰‹æ—¶é—´ä» 2 ä¸ª RTT é™ä¸º 1 ä¸ª RTTã€‚","like_count":0},{"had_liked":false,"id":332605,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1643363725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643363725","product_id":100051201,"comment_content":"TLS1.3 ä¸­æŠŠ Hello æ¶ˆæ¯å’Œå…¬é’¥äº¤æ¢åˆå¹¶ä¸ºä¸€æ­¥ï¼Œè¿™å°±å‡å°‘äº†ä¸€åŠçš„æ¡æ‰‹æ—¶é—´","like_count":0},{"had_liked":false,"id":288943,"user_name":"è‘£æ°¸åˆš","can_delete":false,"product_type":"c1","uid":1169147,"ip_address":"","ucode":"ADA792B226A6CD","user_header":"https://static001.geekbang.org/account/avatar/00/11/d6/fb/837af7bf.jpg","comment_is_top":false,"comment_ctime":1618795636,"is_pvip":false,"replies":[{"id":"104956","content":"ä¸ä¼šï¼Œå…¬é’¥å³ä½¿è¢«é»‘å®¢æ‹¦æˆªåˆ°ï¼Œé»‘å®¢ä¹Ÿæ— æ³•åŸºäºå…¬é’¥åæ¨å‡ºç§é’¥ï¼Œä»¥åŠçŒœå‡ºåç»­å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼ŒåŸå› å‚è§è¿™é‡Œï¼šhttps:&#47;&#47;time.geekbang.org&#47;course&#47;detail&#47;100026801-109888<br>å¦å¤–ï¼Œé€šå¸¸TCPä¸‰æ¬¡æ¡æ‰‹åæ‰èƒ½ä¼ é€’å…¬é’¥ï¼Œåªæœ‰TCP Fast Openæ—¶æ‰èƒ½åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ä¼ é€’å…¬é’¥","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1618968816,"ip_address":"","comment_id":288943,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618795636","product_id":100051201,"comment_content":"TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ä¼ é€’å…¬é’¥ï¼Œä¼šè¢«é»‘å®¢æ‹¦æˆªåˆ°å—ï¼Œè¢«æ‹¦æˆªåå°±å¯ä»¥è·å–åˆ°å…¬é’¥ä¿¡æ¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518775,"discussion_content":"ä¸ä¼šï¼Œå…¬é’¥å³ä½¿è¢«é»‘å®¢æ‹¦æˆªåˆ°ï¼Œé»‘å®¢ä¹Ÿæ— æ³•åŸºäºå…¬é’¥åæ¨å‡ºç§é’¥ï¼Œä»¥åŠçŒœå‡ºåç»­å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼ŒåŸå› å‚è§è¿™é‡Œï¼šhttps://time.geekbang.org/course/detail/100026801-109888\nå¦å¤–ï¼Œé€šå¸¸TCPä¸‰æ¬¡æ¡æ‰‹åæ‰èƒ½ä¼ é€’å…¬é’¥ï¼Œåªæœ‰TCP Fast Openæ—¶æ‰èƒ½åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ä¼ é€’å…¬é’¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618968816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231631,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1593738850,"is_pvip":false,"replies":[{"id":"90479","content":"^_^","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599211175,"ip_address":"","comment_id":231631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593738850","product_id":100051201,"comment_content":"è¯»äº†ä¸¤éï¼Œå…¶ä¹‰è‡ªè§ã€‚è°“è¯»å¾—ç†Ÿï¼come on!","like_count":0,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500383,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599211175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222886,"user_name":"Denuth","can_delete":false,"product_type":"c1","uid":1284665,"ip_address":"","ucode":"E20A7E707155CD","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/39/82679f79.jpg","comment_is_top":false,"comment_ctime":1590940002,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590940002","product_id":100051201,"comment_content":"è€å¸ˆæ±‚ä»‹ç»sslç¡¬ä»¶åŠ é€Ÿæ–¹é¢çš„å®æˆ˜","like_count":0},{"had_liked":false,"id":222187,"user_name":"æ¯›ç«‹å¹³","can_delete":false,"product_type":"c1","uid":1315299,"ip_address":"","ucode":"C4B507511447C5","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/e3/17d09788.jpg","comment_is_top":false,"comment_ctime":1590714225,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1590714225","product_id":100051201,"comment_content":"OSCP-&gt;OCSP?  æœ€è¿‘ç¢°åˆ°è¿‡letsencryptåœ¨å›½å†…è®¿é—®ocspçš„é—®é¢˜å¯¼è‡´iosç«¯å»¶è¿Ÿ3sçš„é—®é¢˜ã€‚ https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;z_QsomzE3jBtwi8VdVDdEA","like_count":0,"discussions":[{"author":{"id":1467182,"avatar":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","nickname":"Geek_007","note":"","ucode":"C80107538EAA7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275435,"discussion_content":"è¯•è¯•è€å¸ˆæåˆ°çš„OCSP stapling ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590715421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1315299,"avatar":"https://static001.geekbang.org/account/avatar/00/14/11/e3/17d09788.jpg","nickname":"æ¯›ç«‹å¹³","note":"","ucode":"C4B507511447C5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1467182,"avatar":"https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg","nickname":"Geek_007","note":"","ucode":"C80107538EAA7F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275539,"discussion_content":"å›½å†…æœåŠ¡å™¨ç«¯è®¿é—®lets encrypt çš„ocspä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯åšä¹Ÿä¸å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590726659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":275435,"ip_address":""},"score":275539,"extra":""}]}]}]}