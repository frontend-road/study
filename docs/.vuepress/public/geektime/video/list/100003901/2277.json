{"id":2277,"title":"17 | 微服务的调用链监控该如何选型？","content":"<p>无</p>\n","comments":[{"had_liked":false,"id":2386,"user_name":"LMD","can_delete":false,"product_type":"c3","uid":1013443,"ip_address":"","ucode":"7626FBB7A4E771","user_header":"","comment_is_top":true,"comment_ctime":1516964868,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"关于《微服务架构核心20讲》课程讲义（PDF 文件），学员可复制下面链接到浏览器下载获取。 http:&#47;&#47;t.cn&#47;RQs9iTw","like_count":8},{"had_liked":false,"id":90516,"user_name":"死者苏生","can_delete":false,"product_type":"c3","uid":1029285,"ip_address":"","ucode":"830E0483DE52A6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/a5/396268e5.jpg","comment_is_top":false,"comment_ctime":1556545091,"is_pvip":false,"replies":[{"id":32489,"content":"嗯，skywalking在apache支持下发展很快，近期github上已经有8k星，我也一直在关注中，计划后续推出相关课程。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1556627686,"ip_address":"","comment_id":90516,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"这两年skywalking的发展已经超过了其他几家竞品，无侵入性，插件完善，社区活跃。推荐使用","like_count":6,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448552,"discussion_content":"嗯，skywalking在apache支持下发展很快，近期github上已经有8k星，我也一直在关注中，计划后续推出相关课程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556627686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8705,"user_name":"LEON","can_delete":false,"product_type":"c3","uid":1109922,"ip_address":"","ucode":"58F7AF5302FCAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg","comment_is_top":false,"comment_ctime":1526380495,"is_pvip":false,"replies":[{"id":2859,"content":"埋点(instrument)就是利用各种监控客户端（调用链CAT，时间序列influxdb等）在代码中写监控数据记录，日志log也是一种特殊的埋点。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1526914122,"ip_address":"","comment_id":8705,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"老师您好，埋点具体指的是什么？是不是监控程序执行到了一定情况，发一条log出来？","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417826,"discussion_content":"埋点(instrument)就是利用各种监控客户端（调用链CAT，时间序列influxdb等）在代码中写监控数据记录，日志log也是一种特殊的埋点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526914122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14788,"user_name":"Sam.张朝","can_delete":false,"product_type":"c3","uid":1132448,"ip_address":"","ucode":"FB20554D94B250","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/a0/f12115b7.jpg","comment_is_top":false,"comment_ctime":1530664816,"is_pvip":true,"replies":[{"id":5086,"content":"案例，第一种，f5+nginx，第二种，eureka+ribbon，第三种，istio+envoy，后继补充文章进一步说明","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1530894372,"ip_address":"","comment_id":14788,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"前面讲的几种LB的情况没听明白，每种情况具体的实现方案会是什么呢？老师有没有相关文章可以参考的呢。谢谢","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420135,"discussion_content":"案例，第一种，f5+nginx，第二种，eureka+ribbon，第三种，istio+envoy，后继补充文章进一步说明","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530894372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10031,"user_name":"Expif","can_delete":false,"product_type":"c3","uid":1002162,"ip_address":"","ucode":"17D1E78E513C18","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/b2/6b8451c1.jpg","comment_is_top":false,"comment_ctime":1527232406,"is_pvip":false,"replies":[{"id":3373,"content":"注册中心和配置中心一般公司共用一套就够了（当然每个环境中都需要部署），搞多了有维护问题，我司现在有多个团队共用一套注册中心和配置中心，由框架团队维护。除非特殊情况，部门才需单独搭建。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1527611959,"ip_address":"","comment_id":10031,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"咨询个问题啊，我们研发中心分了若干个部门，每个部门有若干个系统。现在有一个部门的系统进行了微服务化，spring cloud 体系。另一个部门的系统也要做微服务化，但是公司运维说只维护一套注册中心和配置中心，所以整个研发部门打算用这么一套基础设施，请问这样该怎么取舍，怎么跟运维讨论，谢谢","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418317,"discussion_content":"注册中心和配置中心一般公司共用一套就够了（当然每个环境中都需要部署），搞多了有维护问题，我司现在有多个团队共用一套注册中心和配置中心，由框架团队维护。除非特殊情况，部门才需单独搭建。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527611959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8741,"user_name":"billow","can_delete":false,"product_type":"c3","uid":1008350,"ip_address":"","ucode":"6D58AEA45BA6A3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/de/57cbb843.jpg","comment_is_top":false,"comment_ctime":1526395461,"is_pvip":false,"replies":[{"id":2790,"content":"嗯，值得关注，这个领域还在不断创新","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1526740648,"ip_address":"","comment_id":8741,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"jaeger完整的都开源一年多了，而且也是符合opentracing的，社区活跃度比cat高不少","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417837,"discussion_content":"嗯，值得关注，这个领域还在不断创新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526740648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100720,"user_name":"西门少年","can_delete":false,"product_type":"c3","uid":1118783,"ip_address":"","ucode":"AFBA2FFE709BB6","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/3f/5d85ce4b.jpg","comment_is_top":false,"comment_ctime":1559626091,"is_pvip":false,"replies":[{"id":36630,"content":"你好，80～90%调用链监控都是同步调用场景。异步(rabbitmq)调用跟踪也可以做，有一定监控价值，但是一般需要定制（通过消息header传递调用链上下文），有一定研发定制成本，一般公司都不做这块，有些比较成熟的公司，比如阿里云消息支持消息轨迹。你要不要定制，要看公司阶段和实际需求，投入产出比。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1559912206,"ip_address":"","comment_id":100720,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"老师您好，我这边已经实现了基于http的调用链，但是服务之间有一些通信是基于rabbitmq的，请问这种场景下，有没有必要做服务追踪，如果有必要改如何去做。","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452652,"discussion_content":"你好，80～90%调用链监控都是同步调用场景。异步(rabbitmq)调用跟踪也可以做，有一定监控价值，但是一般需要定制（通过消息header传递调用链上下文），有一定研发定制成本，一般公司都不做这块，有些比较成熟的公司，比如阿里云消息支持消息轨迹。你要不要定制，要看公司阶段和实际需求，投入产出比。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559912206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8706,"user_name":"LEON","can_delete":false,"product_type":"c3","uid":1109922,"ip_address":"","ucode":"58F7AF5302FCAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg","comment_is_top":false,"comment_ctime":1526380496,"is_pvip":false,"replies":[{"id":2858,"content":"埋点(instrument)就是利用各种监控客户端（调用链CAT，时间序列influxdb等）在代码中写监控数据记录，日志log也是一种特殊的埋点。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1526914117,"ip_address":"","comment_id":8706,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"老师您好，埋点具体指的是什么？是不是监控程序执行到了一定情况，发一条log出来？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417827,"discussion_content":"埋点(instrument)就是利用各种监控客户端（调用链CAT，时间序列influxdb等）在代码中写监控数据记录，日志log也是一种特殊的埋点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526914117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8061,"user_name":"billow","can_delete":false,"product_type":"c3","uid":1008350,"ip_address":"","ucode":"6D58AEA45BA6A3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/de/57cbb843.jpg","comment_is_top":false,"comment_ctime":1525886070,"is_pvip":false,"replies":[{"id":2459,"content":"jaeger的完整产品应该还没开源吧，只有客户端开源了吧","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1526138176,"ip_address":"","comment_id":8061,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"Uber的jaeger也挺不错的，不知道有没有研究过","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417565,"discussion_content":"jaeger的完整产品应该还没开源吧，只有客户端开源了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1526138176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":7151,"user_name":"Ethan","can_delete":false,"product_type":"c3","uid":1047835,"ip_address":"","ucode":"DB4EF73FA57590","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/1b/7ff2bb2f.jpg","comment_is_top":false,"comment_ctime":1525310126,"is_pvip":false,"replies":[{"id":2340,"content":"https:&#47;&#47;github.com&#47;ahuazhu&#47;cat-php\nCAT的PHP客户端可以尝试","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1525879242,"ip_address":"","comment_id":7151,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"我用的PHP 做的微服务，如何监控调用链呢","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":417254,"discussion_content":"https://github.com/ahuazhu/cat-php\nCAT的PHP客户端可以尝试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1525879242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191349,"user_name":"华仔","can_delete":false,"product_type":"c3","uid":1047435,"ip_address":"","ucode":"241962BCA71674","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/8b/a1feb0bf.jpg","comment_is_top":false,"comment_ctime":1584764892,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"cat比较好用","like_count":2},{"had_liked":false,"id":181636,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1582601485,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"微服务调用链监控工具，CAT&#47;ZIPKIN&#47;PINPOINT，这个确实重要，对于排查问题，特别是定位性能瓶颈很有帮助。\n原理：\n1：记录调用链的关系，主要通过TRACE ID和SPAN ID\n2：记录每个子调用过程的方法执行情况","like_count":2},{"had_liked":false,"id":192481,"user_name":"GZC","can_delete":false,"product_type":"c3","uid":1928513,"ip_address":"","ucode":"1A96BC07D8BC42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6d/41/256f7238.jpg","comment_is_top":false,"comment_ctime":1584854451,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"正在做微服务项目的链路追踪模块！","like_count":1}]}