{"id":515347,"title":"17ï½œGestureï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è§£å†³å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>å‰ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬è®²è§£äº†æ‰‹åŠ¿è¿›é˜¶çš„ä¸€äº›å†…å®¹ï¼Œä¹Ÿåˆ†æäº†å¦‚ä½•è§£å†³å•è§†å›¾å¤šæ‰‹åŠ¿å†²çªçš„é—®é¢˜ï¼Œä½†è¿™ä¸ª Demo å…¶å®æŒºåŸºç¡€çš„ã€‚ä»Šå¤©æˆ‘ä»¬è¦å†æ·±å…¥ä¸€ç‚¹ï¼Œçœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ç‚¹çš„æ¡ˆä¾‹ï¼Œå°±æ˜¯ Android çš„å›å¼¹ä¸‹æ‹‰åˆ·æ–°ã€‚</p><p>åœ¨Gestureçš„ç¬¬ä¸€ç¯‡ä¸­æˆ‘æåˆ°è¿‡ï¼Œå®ç° Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°çš„éš¾ç‚¹åœ¨äºAndroid çš„ ScrollView ç»„ä»¶å°±æ²¡æœ‰æ»šåŠ¨å›å¼¹å±æ€§ bouncesã€‚è€Œ iOS çš„ ScrollView ç»„ä»¶æ˜¯æœ‰æ»šåŠ¨å›å¼¹å±æ€§ bounces çš„ï¼Œè€Œä¸”æ˜¯é»˜è®¤å¼€å¯çš„ã€‚</p><p>åœ¨ Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°æ¡ˆä¾‹ä¸­ï¼Œä¼šç”¨åˆ° Gesture ä¸Šä¸­ä¸‹ä¸‰ç¯‡ä¸­çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬å¦‚ä½•å°†æ‰‹åŠ¿åº“ Gesture å’ŒåŠ¨ç”»åº“ Reanimated æ­é…ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä½•è§£å†³å•è§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ï¼Œå¦‚ä½•è§£å†³å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œä¸€æ–¹é¢æˆ‘ä¼šé‡ç‚¹å’Œä½ ä»‹ç»å¦‚ä½•è§£å†³å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä¼šæŠŠ Gesture ä¸Šä¸­ä¸‹ä¸‰ç¯‡çš„å†…å®¹ç»™ä½ ä¸²èµ·æ¥ï¼Œå¸®ä½ å®ç° Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°çš„æ•ˆæœã€‚</p><h2>Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°</h2><p>åœ¨çœŸå®çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå®ç°åŒç«¯ä¸‹æ‹‰åˆ·æ–°çš„æ­£ç¡®é€»è¾‘æ˜¯ï¼š<strong>iOS åŸºäº bounces å®ç°ï¼ŒAndroid åŸºäºæ‰‹åŠ¿å®ç°</strong>ã€‚ä¸è¿‡ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘åœ¨å†™ Demo çš„æ—¶å€™ï¼Œç›´æ¥æŠŠ iOS çš„ bounces æ•ˆæœå…³äº†ï¼ŒåŒç«¯ç»Ÿä¸€ä½¿ç”¨æ‰‹åŠ¿å®ç°ï¼Œçœå»äº† if else çš„ä»£ç ï¼Œè¿™æ ·ä½ çœ‹ä»£ç ä¼šå®¹æ˜“ä¸€äº›ã€‚</p><!-- [[[read_end]]] --><p>é‚£æˆ‘ä»¬åˆåº”è¯¥ä»å“ªé‡Œå¼€å§‹è¿›è¡Œå®ç°å›å¼¹ä¸‹æ‹‰åˆ·æ–°ï¼Ÿ</p><p>è¦å®ç°å›å¼¹ä¸‹æ‹‰åˆ·æ–°ï¼Œé¦–å…ˆè¦ç†è§£ Android å›å¼¹æ»šåŠ¨çš„åŸç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<strong>Android å›å¼¹æ»šåŠ¨çš„ç»“æ„ç¤ºæ„å›¾</strong>ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/61/0f11873068f746e96f08ac16478e4b61.png?wh=1920x982\" alt=\"å›¾ç‰‡\"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒAndroid å›å¼¹æ»šåŠ¨æ¶‰åŠçš„ç»“æ„ä¸€å…±æœ‰ 5 ç§ï¼Œæœ€å¤–å±‚æ˜¯æ‰‹æœºå±å¹•ï¼Œæ‰‹æœºå±å¹•å†…æœ‰ä¸€ä¸ªæ¯”å±å¹•é«˜ä¸€äº›çš„ Animated.Viewã€‚Animated.View æ¯”å±å¹•é«˜å‡ºæ¥çš„éƒ¨åˆ†ï¼Œæ­£å¥½ç­‰äº Loading è§†å›¾çš„é«˜åº¦ï¼ŒLoading è§†å›¾è¿™é‡Œæˆ‘ç›´æ¥ç”¨ Text å…ƒç´ ä»£æ›¿äº†ã€‚Animated.View å’Œå±å¹•åŒé«˜çš„éƒ¨åˆ†æ˜¯ ScrollView è§†å›¾ã€‚åœ¨ ScrollView è§†å›¾çš„å†…éƒ¨ï¼ŒScrollView çš„å†…å®¹ Content éƒ¨åˆ†æ˜¯æ¯” ScrollView å®¹å™¨æ›´é«˜çš„ï¼Œè¿™æ ·å†…å®¹æ‰èƒ½æ»šåŠ¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä» ScrollView å†…å®¹çš„æœ€åº•éƒ¨å¼€å§‹ï¼Œä¸€ç›´å¾€ä¸Šæ»šï¼Œæ»šåˆ°å†…å®¹çš„æœ€é¡¶éƒ¨ã€‚åœ¨æ²¡æœ‰ bounces å›å¼¹æ•ˆæœçš„å®¹å™¨ä¸­ï¼Œå†…å®¹çš„é¡¶éƒ¨å’Œæ‰‹æœºå±å¹•çš„é¡¶éƒ¨æ˜¯å¹³é½çš„ã€‚å¦‚æœæ”¯æŒ bounces å›å¼¹æˆ–æ‰‹åŠ¿å›å¼¹ï¼Œé‚£ä¹ˆå†…å®¹è¿˜å¯ä»¥ç»§ç»­å¾€ä¸‹æ‹‰ï¼Œå†…å®¹çš„é¡¶éƒ¨å¯ä»¥ä½äºæ‰‹æœºå±å¹•é¡¶éƒ¨ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨ absolute ç»å¯¹å®šä½å°† Text å®šä½åˆ°æ‰‹æœºå±å¹•ä¸Šæ–¹çš„ä½ç½®ï¼Œè€Œæ˜¯å¢åŠ äº†å…¶çˆ¶å®¹å™¨ Animated.View çš„é«˜åº¦ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¥å‰é‡åˆ°è¿‡ Android æ‰‹æœºå­è§†å›¾è¶…å‡ºçˆ¶å®¹å™¨åä¸æ˜¾ç¤ºçš„é—®é¢˜ã€‚ä¸ºäº†é¿å…è¶…å‡ºä¸æ˜¾ç¤ºï¼Œåœ¨Animated.View  çš„å­è§†å›¾è¿™é‡Œï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯ä»ä¸Šåˆ°ä¸‹çš„é»˜è®¤å¸ƒå±€æ–¹å¼ï¼ŒæŠŠå­è§†å›¾éƒ½åŒ…è£¹åœ¨ Animated.View è§†å›¾å†…éƒ¨ï¼Œè€Œä¸æ˜¯è®©å­è§†å›¾ Loading æµ®åœ¨ Animated.View è§†å›¾çš„å¤–é¢ã€‚</p><p>é‚£ä¸Šè¿°å›å¼¹ä¸‹æ‹‰åˆ·æ–°çš„ JSX å®ç°æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p>JSX éƒ¨åˆ†çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const LOADING_HEIGHT = 30\nconst {height: windowHeight} = useWindowDimensions()\nconst wrapperHeight = windowHeight + LOADING_HEIGHT\n// ...\nreturn (\n  &lt;Animated.View style={[{ height: wrapperHeight }, animatedStyle]}&gt;\n    &lt;Text style={{height: LOADING_HEIGHT}}&gt;loading...&lt;/Text&gt;\n    &lt;GestureDetector gesture={Gesture.Simultaneous(scrollGesture, panGesture)}&gt;\n      &lt;Animated.ScrollView bounces={false} onScroll={scrollHandler}/&gt;\n    &lt;/GestureDetector&gt;\n  &lt;/Animated.View&gt;\n)\n</code></pre><p>åœ¨ä¸Šè¿°ç»“æ„ä»£ç ä¸­ï¼Œæˆ‘ç»™ ScrollView æ·»åŠ äº†ä¸¤ä¸ªå¯ä»¥åŒæ—¶æ‰§è¡Œçš„æ‰‹åŠ¿ï¼šä¸€ä¸ªæ˜¯ ScrollView è‡ªèº«çš„æ»šåŠ¨æ‰‹åŠ¿ scrollGestureï¼›å¦ä¸€ä¸ªæ˜¯æ‹–æ‹½æ‰‹åŠ¿ panGestureã€‚åŒæ—¶æˆ‘è¿˜ç»™ Animated.View æ·»åŠ äº†ä¸€ä¸ªåŠ¨ç”»æ ·å¼ animatedStyleã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ»šåŠ¨æ‰‹åŠ¿ã€æ‹–æ‹½æ‰‹åŠ¿å’ŒåŠ¨ç”»çš„é…åˆï¼Œå®ç° Android å›å¼¹ä¸‹æ‹‰æ•ˆæœã€‚</p><p>äº†è§£å®Œ JSX ç»“æ„åï¼Œæˆ‘ä»¬å†æ¥çœ‹é©±åŠ¨æ‹–æ‹½åŠ¨ç”»çš„å…±äº«å€¼ã€‚<strong>å›å¼¹ä¸‹æ‹‰ä¸€å…±æ¶‰åŠäº†ä¸¤ä¸ªå…±äº«å€¼ï¼Œä¹Ÿå°±æ˜¯ scrollY å’Œ refreshYã€‚</strong></p><ul>\n<li>scrollYï¼šScrollView æ»šåŠ¨åç§»é‡ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</li>\n</ul><pre><code class=\"language-plain\">const scrollY = useSharedValue(0);\n\nconst scrollHandler = useAnimatedScrollHandler({\n  onScroll: e =&gt; {\n    // è®°å½•åç§»é‡ï¼Œåªè¯»ä¸å†™\n    scrollY.value = e.contentOffset.y;\n  },\n});\n\n// ...\n&lt;Animated.ScrollView  onScroll={scrollHandler} scrollEventThrottle={1}/&gt;\n</code></pre><p>ç”±äº ScrollView çš„æ»šåŠ¨åç§»é‡æ˜¯ç”±åŸç”Ÿå¹³å°æ§åˆ¶çš„ï¼ŒAnimated åŠ¨ç”»åº“å’Œ Gesture æ‰‹åŠ¿åº“éƒ½æ§åˆ¶ä¸äº†ï¼Œ<strong>å› æ­¤ scrollY åªå¯è¯»ã€ä¸å¯å†™</strong>ã€‚è¯»å– scrollY é çš„æ˜¯ ScrollView çš„ onScroll å›è°ƒå’Œ Reanimated çš„ useAnimatedScrollHandler çš„é…åˆï¼Œæ•´ä¸ªè¿‡ç¨‹åœ¨ UI çº¿ç¨‹ä¸­è¿›è¡Œã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡ scrollEventThrottle å±æ€§ï¼Œå°†ä¸¤æ¬¡ onScroll å›è°ƒçš„æ‰§è¡Œé—´éš”è®¾ç½®ä¸º 1msï¼Œä»¥æ­¤æ¥ä¿è¯è·å– scrollY çš„æ—¶æ•ˆæ€§ã€‚</p><ul>\n<li>refreshYï¼šAnimated.View æ‹–æ‹½åç§»é‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>\n</ul><pre><code class=\"language-plain\">const LOADING_HEIGHT = 30\nconst refreshY = useSharedValue(-LOADING_HEIGHT);\nconst {height: windowHeight} = useWindowDimensions()\nconst wrapperHeight = windowHeight + LOADING_HEIGHT\n\nconst animatedStyle = useAnimatedStyle(() =&gt; {\n  return {\n    transform: [{translateY: refreshY.value}],\n  };\n});\n\nreturn (\n  &lt;Animated.View style={[{height: wrapperHeight}, animatedStyle]}&gt;\n    {/* ... */}\n  &lt;/Animated.View&gt;\n);\n</code></pre><p>æ‹–æ‹½åç§»é‡æ˜¯ç”¨æ¥æ§åˆ¶æ•´ä½“è§†å›¾ Animated.View çš„çºµè½´åç§»é‡çš„ï¼ŒåŒ…æ‹¬ ScrollView å’Œ Loadingã€‚é»˜è®¤ refreshY çš„å€¼ä¸º -30ï¼Œä¹Ÿå°±æ˜¯ LOADING_HEIGHT çš„è´Ÿå€¼ï¼Œæ­¤æ—¶æ­£å¥½æŠŠ Loading  éšè—åœ¨å±å¹•å¤–ã€‚</p><p>å’Œ scrollY åªè¯»ä¸å†™ä¸åŒï¼Œ<strong>refreshY çš„å€¼ä¼šè·Ÿç€æ‹–æ‹½æ‰‹åŠ¿çš„å˜åŒ–è€Œå˜åŒ–</strong>ã€‚å½“ä½ æ‹–æ‹½ä¸‹æ‹‰æ—¶ï¼Œ refreshY çš„å€¼ä» -30 é€æ¸å˜å¤§ï¼›å½“ refreshY çš„å€¼å˜ä¸º 0 æ—¶ï¼Œ Loading å­—æ ·ä¼šå®Œå…¨å‡ºç°ï¼›ç»§ç»­å‘ä¸‹æ‹–æ‹½ï¼Œ refreshY  ä¼šç»§ç»­å˜å¤§ï¼Œé¡µé¢ç»§ç»­ä¸‹ç§»ï¼Œæ¾æ‰‹æ—¶ï¼Œé‡æ–°å˜ä¸º -30ã€‚</p><p><strong>äº†è§£äº†æ•´ä½“çš„ JSX ç»“æ„å’Œå…±äº«å€¼åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é¢ä¸´çš„éš¾é¢˜å°±æ˜¯ï¼Œå›å¼¹æ»šåŠ¨ç©¶ç«Ÿå¦‚ä½•å®ç°å‘¢ï¼Ÿ</strong></p><p>ä¸€å›¾èƒœåƒè¨€ï¼Œæˆ‘è¿˜ç”»ä¸€å¼ åŸç†ç¤ºæ„å›¾ï¼Œç›¸ä¿¡ä½ çœ‹ä¸€ä¸‹å°±èƒ½æ˜ç™½ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/82/44/82c626b4681a0623156dba963bbb6a44.png?wh=1920x2269\" alt=\"å›¾ç‰‡\"></p><p>ç¤ºæ„å›¾ä¸€å…±åˆ†ä¸º 6 æ­¥ï¼Œæœ‰ä¸¤ç§å¯èƒ½ç»“æœã€‚</p><p>é¦–å…ˆï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œä½ å…ˆå°† ScrollView å†…å®¹æ»šåŠ¨åˆ°æœ€åº•éƒ¨ï¼Œç„¶åæ‰‹åŠ¿å‘ä¸‹å¾€å†…å®¹çš„æœ€é¡¶éƒ¨æ–¹å‘æ»šåŠ¨ã€‚æ­¤æ—¶ï¼Œå› ä¸ºä½ çš„æ‰‹æ˜¯ä¸€ç›´æ”¾åœ¨ ScrollView è§†å›¾ä¸Šçš„ï¼Œæ‰€ä»¥ ScrollView  è§†å›¾ä¼šåŒæ—¶å“åº”æ»šåŠ¨æ‰‹åŠ¿å’Œæ‹–æ‹½æ‰‹åŠ¿ã€‚ä½†æ˜¯æ»šåŠ¨æ‰‹åŠ¿ä¹Ÿå°±æ„å‘³ç€è§¦å‘äº†æ»šåŠ¨åŠ¨ç”»ï¼Œè€Œæ‹–æ‹½æ‰‹åŠ¿åªæ˜¯è§¦å‘äº†æ‹–æ‹½å›è°ƒ onChangeï¼Œä½†å›è°ƒä¸­å¹¶æœªæ”¹å˜å…±äº«å€¼ refreshYï¼Œä¹Ÿæœªæ‰§è¡Œæ‹–æ‹½åŠ¨ç”»ã€‚</p><p>ç»‘å®šæ‰‹åŠ¿çš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const scrollGesture = Gesture.Native()\nconst panGesture = Gesture.Pan()\n  .onChange(e =&gt; { \n    // æ‹–æ‹½åŠ¨ç”»\n    if (scrollY.value === 0 || refreshY.value !== -LOADING_HEIGHT) {\n      refreshY.value =  Math.max(-LOADING_HEIGHT,refreshY.value + e.changeY) ;\n    }\n  })\n  .onEnd(() =&gt; {})\n\nconst animatedStyle = useAnimatedStyle(() =&gt; {\n  return {\n    transform: [{translateY: refreshY.value}],\n  };\n});\n\nreturn (\n  &lt;GestureDetector gesture={Gesture.Simultaneous(scrollGesture, panGesture)}&gt;\n    &lt;Animated.ScrollView /&gt;            \n  &lt;/GestureDetector&gt;\nï¼‰\n</code></pre><p>æ¥ç€ï¼Œä½ ç»§ç»­ä¸æ¾æ‰‹åœ°å‘ä¸‹æ»šåŠ¨ ScrollView çš„å†…å®¹ï¼Œç›´åˆ°å†…å®¹æ»šåŠ¨åˆ°äº†æœ€é¡¶éƒ¨ã€‚æ­¤æ—¶ scrollY çš„å€¼æ­£å¥½ä¸º 0ï¼ŒrefreshY çš„å€¼ä¹Ÿæ­£å¥½ä¸º -LOADING_HEIGHTï¼Œæ­¤æ—¶æ‹–æ‹½åŠ¨ç”»å¤„äºè¿˜æœªè§¦å‘ä½†å³å°†è§¦å‘çš„ä¸´ç•Œç‚¹ã€‚</p><p>ç„¶åä½ å†ç»§ç»­ä¸æ¾æ‰‹åœ°å‘ä¸‹æ»šåŠ¨å’Œæ‹–æ‹½ã€‚è¿™æ—¶ä½ è¦æ³¨æ„ä¸€ä¸‹ ScrollView çš„æ»šåŠ¨æ¡ï¼Œä½ ä¼šå‘ç°æ»šåŠ¨æ¡æ˜¯ä¸€ç›´æ˜¾ç¤ºçš„ï¼Œä½†æ²¡æœ‰ä½ç½®å’Œé•¿åº¦çš„å˜åŒ–äº†ï¼Œè¿™ä»£è¡¨ ScrollView å†…å®¹è§¦é¡¶äº†ï¼Œå¹¶ä¸”ä¸èƒ½å›å¼¹æ»šåŠ¨äº†ã€‚è€Œè¿™æ—¶æ‹–æ‹½æ‰‹åŠ¿æ”¹å˜äº†å…±äº«å€¼ refreshYï¼Œ å¹¶å¼€å§‹æ‰§è¡Œæ‹–æ‹½åŠ¨ç”»ã€‚æ‹–æ‹½åŠ¨ç”»è®©å¤–å±‚å®¹å™¨ Animated.View æ”¹å˜äº†å®ƒçš„ translateY åç§»é‡ï¼Œæ‰€ä»¥ Animated.View å’Œå…¶å†…éƒ¨çš„ Loading æ–‡å­—ä¼šä¸€èµ·å¾€ä¸‹ç§»ï¼Œäºæ˜¯ä½ å°±åœ¨æ‰‹æœºå±å¹•ä¸Šçœ‹åˆ°äº† Loading æ–‡å­—ã€‚</p><p>æ¥ä¸‹æ¥ä½ ä¼šæœ‰ä¸¤ç§é€‰æ‹©ï¼ŒA é€‰æ‹©æ˜¯æ¾æ‰‹åˆ·æ–°é¡µé¢ï¼ŒB é€‰æ‹©æ˜¯å¾€åæ–¹å‘æ»šåŠ¨å–æ¶ˆåˆ·æ–°ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹é€‰æ‹©äº†Aä¼šæ€ä¹ˆæ ·ã€‚å¦‚æœä½ é€‰æ‹©äº†æ¾æ‰‹åˆ·æ–°é¡µé¢ï¼Œé‚£ä¹ˆæ‹–æ‹½æ‰‹åŠ¿å’Œæ»šåŠ¨æ‰‹åŠ¿ä¼šåŒæ—¶ç»“æŸï¼Œæ­¤æ—¶åªéœ€è¦åœ¨æ‰‹åŠ¿ç»“æŸå›è°ƒä¸­å°† Animated.View çš„ translateY åç§»é‡è®¾ç½®ä¸ºé»˜è®¤å€¼å³å¯ã€‚è¿™æ ·æ‰€æœ‰è§†å›¾éƒ½ä¼šæ¢å¤é»˜è®¤çš„ä½ç½®ï¼Œè€Œ Loading æ–‡å­—ä¹Ÿä¼šæ¶ˆå¤±åœ¨å±å¹•ä¸­ã€‚</p><p>æ¾æ‰‹è§¦å‘æ‹–æ‹½æ‰‹åŠ¿ onEnd å›è°ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">  const panGesture = Gesture.Pan()\n    // ...\n    .onEnd(() =&gt; {\n      // æ¾æ‰‹æ—¶ï¼Œå¦‚æœå®¹å™¨æ•´ä½“åç¦»æ­£å¸¸ä½ç½®\n      if (refreshY.value !== -LOADING_HEIGHT) {\n        // åˆ™ä½¿ç”¨å¼¹æ€§åŠ¨ç”» withSpringï¼Œå›å¼¹è‡³åŸä½ç½®\n        refreshY.value = withSpring(-LOADING_HEIGHT, {\n          stiffness:300,\n          overshootClamping: true\n        })\n      }\n    })\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½ æ¾æ‰‹æ—¶ï¼ŒpanGesture æ‰‹åŠ¿çš„å†…éƒ¨çŠ¶æ€ä¼šç”± ACTIVE å˜ä¸º ENDï¼Œå¹¶è§¦å‘ onEnd å›è°ƒã€‚åœ¨ onEed å›è°ƒä¸­ï¼Œåªæœ‰å®¹å™¨æ•´ä½“åç¦»æ­£å¸¸ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ refreshY çš„å€¼ä¸ç­‰äº -LOADING_HEIGHTï¼Œæ‰ä¼šä½¿ç”¨å¼¹æ€§åŠ¨ç”» withSpring å°† refreshY é‡ç½®ä¸º  -LOADING_HEIGHTã€‚</p><p>å…¶ä¸­ï¼Œå¼¹æ€§åŠ¨ç”»çš„ stiffness æŒ‡çš„æ˜¯â€œå¼¹ç°§ç¡¬åº¦â€ï¼Œç¡¬åº¦è¶Šå¤§å¼¹ç°§å¼¹çš„é€Ÿåº¦è¶Šå¿«ï¼Œâ€œå¼¹ç°§ç¡¬åº¦â€é»˜è®¤æ˜¯ 100ï¼Œè¿™é‡Œè®¾ç½®æˆäº† 300 çš„æ„æ€æ˜¯å¸Œæœ›å›å¼¹çš„é€Ÿåº¦å¿«ä¸€ç‚¹ã€‚å¼¹æ€§åŠ¨ç”»çš„ overshootClamping æŒ‡çš„æ˜¯â€œå¤¹ä½è¿‡å†²â€ï¼Œé»˜è®¤ overshootClamping çš„å€¼æ˜¯ falseï¼Œè¿™æ—¶å¼¹ç°§ä¼šæ²¿ç€å®ƒçš„é»˜è®¤å½¢å˜çš„ä¸­å¿ƒçº¿æ¥å›åå¤åœ°å¼¹ã€‚æˆ‘è¿™é‡Œå°†å®ƒè®¾ç½®ä¸ºäº† trueï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¼¹ç°§åœ¨å›åˆ°é»˜è®¤å½¢å˜çš„ä¸­å¿ƒçº¿çš„æ—¶å€™å°±ä¼šåœä¸‹æ¥ï¼Œæ•´ä½“å®¹å™¨çš„æ¾æ‰‹åŠ¨ç”»ä¼šç›´æ¥åœåœ¨å±å¹•ä¸Šè¾¹ç¼˜ã€‚</p><p>é‚£å¦‚æœä½ çš„é€‰æ‹©æ˜¯ B æ–¹æ¡ˆå‘¢ï¼Ÿ</p><p>å¦‚æœä½ é€‰æ‹©äº†å¾€åæ–¹å‘æ»šå–æ¶ˆåˆ·æ–°ï¼Œé‚£ä¹ˆæ»šåŠ¨æ‰‹åŠ¿å’Œæ‹–æ‹½æ‰‹åŠ¿è¿˜ä¼šåŒæ—¶å“åº”ï¼Œå¹¶ä¸”æ‹–æ‹½åŠ¨ç”»è¿˜ä¼šç»§ç»­æ‰§è¡Œï¼Œæ‹–æ‹½åŠ¨ç”»å‘åæ–¹å‘æ”¹å˜ Animated.View çš„ translateY åç§»é‡ã€‚å…·ä½“ä»£ç ä½ å¯ä»¥çœ‹ä¸‹è¿™é‡Œï¼š</p><pre><code class=\"language-plain\">// æ‹–æ‹½åŠ¨ç”»\nif (scrollY.value === 0 || refreshY.value !== -LOADING_HEIGHT) {\n  refreshY.value =  Math.max(-LOADING_HEIGHT, refreshY.value + e.changeY) ;\n}\n</code></pre><p>è¿™é‡Œä½ å¯ä»¥æ³¨æ„ä¸‹æ‰§è¡Œæ‹–æ‹½åŠ¨ç”»çš„åˆ¤æ–­æ¡ä»¶ã€‚å› ä¸ºæˆ‘è®¾ç½®äº†åªè¦ scrollY çš„å€¼ä¸º 0 æˆ–è€… refreshY çš„å€¼ä¸ä¸º -LOADING_HEIGHT æ—¶ï¼Œä¹Ÿå°±æ˜¯ ScrollView å†…å®¹é¡¶åˆ°å¤´æˆ–è€…æ•´ä½“è§†å›¾ä¸åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šï¼Œå°±å¯ä»¥è§¦å‘æ‹–æ‹½æ‰‹åŠ¿ï¼Œå› æ­¤è¿™æ—¶æˆ‘ä»¬æ˜¯å¯ä»¥åæ–¹å‘å‘ä¸Šæ‹–æ‹½çš„ã€‚</p><p>ä½†è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå‘ä¸Šæ‹–æ‹½æ—¶ ScrollView å†…å®¹ä¹Ÿæ˜¯å¯ä»¥å‘ä¸Šæ»šåŠ¨çš„ï¼Œä½†æˆ‘ä»¬è¿™é‡Œå¹¶æ²¡æœ‰ç¦æ­¢ ScrollView å†…å®¹çš„æ»šåŠ¨ã€‚è¿™ä¸ªå‘æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬åé¢å†èŠï¼Œæˆ‘ä»¬å…ˆæ¥ç€çœ‹æœ€åä¸€æ­¥ã€‚</p><p>å¦‚æœä½ ç»§ç»­ä¸æ¾æ‰‹çš„å‘ä¸Šæ»šåŠ¨ï¼Œæ»šåŠ¨æ‰‹åŠ¿å’Œæ‹–æ‹½æ‰‹åŠ¿è¿˜ä¼šåŒæ—¶å“åº”ï¼Œä½†å› ä¸ºæ•´ä½“è§†å›¾å›åˆ°é»˜è®¤ä½ç½®äº†æ‰€ä»¥æ‹–æ‹½åŠ¨ç”»ä¸ä¼šæ‰§è¡Œäº†ï¼Œè€Œæ˜¯æ»šåŠ¨åŠ¨ç”»å¼€å§‹æ‰§è¡Œï¼ŒScrollView çš„å†…å®¹å¼€å§‹å‘ä¸Šæ»šåŠ¨ã€‚</p><p><strong>æ•´ä¸ªå›å¼¹ä¸‹æ‹‰åˆ·æ–°çš„æ‰‹åŠ¿åŠ¨æ•ˆæ˜¯è¿è´¯çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½ä¸éœ€è¦é€šè¿‡æ¾æ‰‹æ¥åˆ‡æ¢æ‹–æ‹½åŠ¨ç”»å’Œæ»šåŠ¨åŠ¨ç”»ï¼Œè¿™å°±æ˜¯ Gesture æ‰‹åŠ¿åº“å’Œ Reanimated åŠ¨ç”»åº“çš„å¼ºå¤§ä¹‹å¤„ã€‚</strong></p><p>å®ç° Android å›å¼¹ä¸‹æ‹‰çš„æ ¸å¿ƒä»£ç ï¼Œæˆ‘æ”¾åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥ä»”ç»†çœ‹çœ‹ï¼š</p><pre><code class=\"language-plain\">const LOADING_HEIGHT = 30\n\nfunction PanAndScrollView() {\n  const refreshY = useSharedValue(-LOADING_HEIGHT);\n  const scrollY = useSharedValue(0);\n  const {height: windowHeight} = useWindowDimensions()\n  const wrapperHeight = windowHeight + LOADING_HEIGHT\n\n  const scrollGesture = Gesture.Native()\n\n  const panGesture = Gesture.Pan()\n    .onChange(e =&gt; {\n      // æ»šåŠ¨åˆ°é¡¶éƒ¨æˆ–è€…å®¹å™¨æ•´ä½“åç¦»æ­£å¸¸ä½ç½®æ—¶ï¼Œå¯è§¦å‘æ‰‹åŠ¿åŠ¨ç”»\n      if (scrollY.value === 0 || refreshY.value !== -LOADING_HEIGHT) {\n        refreshY.value =  Math.max(-LOADING_HEIGHT,refreshY.value + e.changeY) ;\n      }\n    })\n    .onEnd(() =&gt; {\n      // æ¾æ‰‹æ—¶ï¼Œå¦‚æœå®¹å™¨æ•´ä½“åç¦»æ­£å¸¸ä½ç½®\n      if (refreshY.value !== -LOADING_HEIGHT) {\n        // åˆ™ä½¿ç”¨å¼¹æ€§åŠ¨ç”» withSpringï¼Œå›å¼¹è‡³åŸä½ç½®\n        refreshY.value = withSpring(-LOADING_HEIGHT, {\n          stiffness:300,\n          overshootClamping: true\n        })\n      }\n    })\n\n  const animatedStyle = useAnimatedStyle(() =&gt; {\n    return {\n      transform: [{translateY: refreshY.value}],\n    };\n  });\n\n  const scrollHandler = useAnimatedScrollHandler({\n    onScroll: e =&gt; {\n      // è®°å½•åç§»é‡ï¼Œåªè¯»ä¸å†™\n      scrollY.value = e.contentOffset.y;\n    },\n  });\n\n  return (\n        &lt;Animated.View style={[{height: wrapperHeight}, animatedStyle]}&gt;\n          &lt;Text style={{height: LOADING_HEIGHT }}&gt;loading...&lt;/Text&gt;\n          &lt;GestureDetector gesture={Gesture.Simultaneous(scrollGesture, panGesture)}&gt;\n            &lt;Animated.ScrollView \n              bounces={false}\n              onScroll={scrollHandler}\n              scrollEventThrottle={1}&gt;\n              {Array(100).fill(1).map((_, index) =&gt; (&lt;Text key={index}&gt;{index}&lt;/Text&gt;))}\n            &lt;/Animated.ScrollView&gt;\n          &lt;/GestureDetector&gt;\n        &lt;/Animated.View&gt;\n  );\n}\n</code></pre><h2>å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜</h2><p>åˆšåˆšæˆ‘ä»¬å®ç°çš„ Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½ï¼Œå¤§ä½“ä¸Šæ˜¯èƒ½ç”¨çš„ï¼Œä½†æ˜¯å®ƒè¿˜æœ‰ä¸¤ä¸ªå°çš„ä½“éªŒé—®é¢˜ã€‚</p><p><strong>é¦–å…ˆæ˜¯ Loading æœ¬èº«ä¸èƒ½ä¸å“åº”æ‹–æ‹½æ‰‹åŠ¿</strong>ï¼Œè¿™å°±é™åˆ¶äº†å›å¼¹ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½çš„é€šç”¨æ€§ã€‚å¦‚æœä½ æƒ³æŠŠ Loading æ›¿æ¢æˆç±»ä¼¼æ·˜å®äºŒæ¥¼çš„æ•ˆæœï¼Œç”¨åˆšåˆšæˆ‘ä»¬å®ç°çš„ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶æ¥åšå°±ä¼šæœ‰ Bugã€‚è¦çŸ¥é“ï¼ŒäºŒæ¥¼è§†å›¾çš„é«˜åº¦å¯è¦æ¯”åªæœ‰ 30 åƒç´ çš„ Loading é«˜å¾ˆå¤šï¼Œç”¨æˆ·å¾ˆå®¹æ˜“æ‹–æ‹½åˆ°äºŒæ¥¼è§†å›¾ï¼Œå¦‚æœç”¨æˆ·æ‹–æ‹½åå‘ç°æ²¡æœ‰ååº”ï¼Œè‚¯å®šä¼šæ„Ÿè§‰åˆ°å¾ˆå¥‡æ€ªã€‚</p><p>å¦å¤–ä¸€ä¸ªä½“éªŒæ–¹é¢çš„é—®é¢˜æ˜¯ï¼Œåœ¨Bæ–¹æ¡ˆä¸­ï¼Œä¹Ÿå°±æ˜¯<strong>ä¸æ¾æ‰‹è€Œæ˜¯åå‘æ»šåŠ¨æˆ–æ‹–æ‹½è¿™ä¸ªæ­¥éª¤</strong>æ—¶ï¼Œæ»šåŠ¨åŠ¨ç”»å’Œæ‹–æ‹½åŠ¨ç”»éƒ½æ²¡æœ‰ç¦æ­¢ï¼ŒäºŒè€…å¯èƒ½ä¼šåŒæ—¶è§¦å‘ï¼Œè¿™ä¼šå¯¼è‡´å‡ºç°ä¸¤ä¸ªå åŠ è§†å›¾åç§»é—®é¢˜ã€‚</p><p>è¦è®© ScrollView è§†å›¾å’Œ Loading è§†å›¾åŒæ—¶ç›‘å¬æ»šåŠ¨å’Œæ‹–æ‹½æ‰‹åŠ¿ï¼Œè¦è®©æ‰§è¡Œæ‹–æ‹½åŠ¨ç”»æ—¶ä¸èƒ½æ‰§è¡Œæ»šåŠ¨åŠ¨ç”»ï¼Œå°±æ¶‰åŠå¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜äº†ã€‚</p><p>é‚£ä¹ˆï¼Œå¤šè§†å›¾å¤šæ‰‹åŠ¿å†²çªé—®é¢˜è¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</p><p>è§£å†³å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å­¦ä¼šç«™åœ¨å•ä¸ªæ‰‹åŠ¿çš„è§†è§’æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç»™ä½ ç”»äº†ä¸€ä¸ªç¤ºæ„å›¾ï¼Œä½ å…ˆçœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/66/72/6684e3312f30fc2630c47090e7c5d872.png?wh=1920x901\" alt=\"å›¾ç‰‡\"></p><p>ç¤ºæ„å›¾ä¸­å·¦è¾¹çš„éƒ¨åˆ†ï¼Œå°±æ˜¯ç«™åœ¨æ‹–æ‹½æ‰‹åŠ¿çš„è§†è§’æ¥è§£å†³å†²çªé—®é¢˜çš„ã€‚æ‹–æ‹½æ‰‹åŠ¿æ˜¯è¿™ä¹ˆæƒ³çš„ï¼šæ—¢ç„¶ä½ æƒ³åœ¨å“åº”æˆ‘æ‹–æ‹½æ‰‹åŠ¿çš„åŒæ—¶å“åº”è½»æŒ‰ã€æ»šåŠ¨æ‰‹åŠ¿ï¼Œé‚£æˆ‘å¯ä»¥æä¾›ä¸€ä¸ªæ–¹æ³•å‡½æ•°ï¼Œä½ æŠŠè½»æŒ‰ã€æ»šåŠ¨æ‰‹åŠ¿éƒ½å‘Šè¯‰æˆ‘å§ã€‚</p><p>å’¦ï¼Ÿè¿™é‡Œå¤šäº†ä¸ªè½»æŒ‰æ‰‹åŠ¿ï¼Œå®ƒæ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä¿ç•™ä¸€ä¸ªæ‚¬å¿µï¼Œä½ ä¸€ä¼šå°±çŸ¥é“äº†ã€‚</p><p>ç„¶åæˆ‘ä»¬å†çœ‹ç¤ºæ„å›¾ä¸­å³è¾¹çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯ç«™åœ¨æ»šåŠ¨æ‰‹åŠ¿çš„è§†è§’æ¥è§£å†³å†²çªé—®é¢˜çš„ã€‚æ»šåŠ¨æ‰‹åŠ¿æ˜¯è¿™ä¹ˆæƒ³çš„ï¼šä½ æƒ³è®©æˆ‘æ»šåŠ¨æ‰‹åŠ¿å’Œæ‹–æ‹½æ‰‹åŠ¿åŒæ—¶å“åº”ï¼Œä½†ä¸æƒ³è®©æ»šåŠ¨åŠ¨ç”»å’Œæ‹–æ‹½åŠ¨ç”»åŒæ—¶æ‰§è¡Œï¼Œä½†æˆ‘æ»šåŠ¨æ‰‹åŠ¿å¹¶ä¸çŸ¥é“æ‹–æ‹½åŠ¨ç”»æ˜¯å¦èƒ½æ‰§è¡Œå‘€ï¼</p><p>é‚£ä¹ˆè¿™è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ€è·¯ã€‚æˆ‘æ»šåŠ¨æ‰‹åŠ¿è™½ç„¶ä¸çŸ¥é“åŠ¨ç”»é€»è¾‘æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Œä½†èƒ½å¤ŸçŸ¥é“å…¶ä»–æ‰‹åŠ¿ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œæˆå‘€ã€‚è¦ä¸è¿™æ ·ï¼Ÿä½ å…ˆåˆ›å»ºä¸€ä¸ªå‡çš„è½»æŒ‰æ‰‹åŠ¿ï¼Œå½“æ‹–æ‹½åŠ¨ç”»ä¸å¯æ‰§è¡Œæ—¶ï¼Œä½ å°±ä¸»åŠ¨æŠŠè½»æŒ‰æ‰‹åŠ¿ç»“æŸã€‚è¿™æ ·æˆ‘æ”¶åˆ°è½»æŒ‰æ‰‹åŠ¿ç»“æŸçš„é€šçŸ¥æ—¶ï¼Œå°±çŸ¥é“æ‹–æ‹½åŠ¨ç”»ä¸å¯æ‰§è¡Œäº†ï¼Œè¿™æ—¶æˆ‘å†æŠŠæ»šåŠ¨åŠ¨ç”»ç”±ä¸å¯æ‰§è¡Œçš„çŠ¶æ€å˜ä¸ºå¯æ‰§è¡Œçš„çŠ¶æ€ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬ç«™åœ¨æ‰‹åŠ¿çš„è§†è§’ï¼Œè§£å†³ä¸¤ä¸ªä¸‹æ‹‰åˆ·æ–°ä½“éªŒé—®é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰é¢çš„ç¤ºæ„å›¾ä¸­ä¼šå¤šä¸€ä¸ªè½»æŒ‰æ‰‹åŠ¿çš„åŸå› ã€‚</p><p>é‚£å…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>æˆ‘å…ˆå¸¦ä½ çœ‹ä¸‹æ–°çš„ JSX ç»“æ„çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">&lt;GestureDetector gesture={panGesture}&gt;\n  &lt;Animated.View style={[{height: wrapperHeight}, animatedStyle]}&gt;\n    &lt;Text&gt;loading...&lt;/Text&gt;\n    &lt;GestureDetector gesture={Gesture.Simultaneous(scrollGesture, tapGesture)}&gt;\n      &lt;Animated.ScrollView/&gt;\n    &lt;/GestureDetector&gt;\n  &lt;/Animated.View&gt;\n&lt;/GestureDetector&gt;\n</code></pre><p>è¿™æ®µä»£ç å°±æ˜¯ç«™åœ¨è§†å›¾çš„è§†è§’ï¼ŒæŠŠæ‰‹åŠ¿å’Œè§†å›¾ç»‘å®šåœ¨ä¸€èµ·äº†ã€‚è¿™é‡Œæœ‰ä¸‰ä¸ªæ‰‹åŠ¿ï¼Œåˆ†åˆ«æ˜¯ panGestureã€scrollGestureã€tapGestureã€‚å½“ä½ æ‰‹æŒ‡è§¦ç¢°åˆ°å¤–å±‚å®¹å™¨ Animated.View æ—¶ï¼ŒpanGesture å°±ä¼šå“åº”ã€‚è¿™æ ·æ— è®ºä½ æ˜¯è§¦ç¢°åˆ°å®ƒçš„å­å®¹å™¨ Textï¼Œè¿˜æ˜¯ ScrollView ï¼Œéƒ½èƒ½è§¦å‘ panGesture æ‰‹åŠ¿ã€‚</p><p>è€Œ <strong>scrollGesture æ‰‹åŠ¿åªèƒ½åœ¨è§¦ç¢°åˆ° ScrollView è§†å›¾æ—¶è¿›è¡Œå“åº”ï¼Œè€Œä¸”æˆ‘è¿˜é…äº†ä¸€ä¸ªæ§åˆ¶æ»šåŠ¨åŠ¨ç”»æ˜¯å¦æ‰§è¡Œçš„ tapGesture æ‰‹åŠ¿ã€‚</strong></p><p>æ¥ä¸‹æ¥çš„ä»£ç ï¼Œå°±æ˜¯ç«™åœ¨ panGesture æ‰‹åŠ¿çš„è§†è§’ï¼Œè®©å®ƒæ”¯æŒå’Œ scrollGesturã€tapGesture è¿™ä¸¤ä¸ªæ‰‹åŠ¿åŒæ—¶å“åº”ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const tapGesture = Gesture.Tap()\nconst scrollGesture = Gesture.Native()\nconst panGesture = Gesture.Pan()\n    .simultaneousWithExternalGesture(scrollGesture, tapGesture)\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒpanGesture æ‰‹åŠ¿è°ƒç”¨äº† simultaneousWithExternalGesture æ–¹æ³•ï¼Œæ–¹æ³•å…¥å‚æ˜¯ scrollGesture, tapGestureã€‚è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œåœ¨å“åº”æˆ‘ panGesture æ‰‹åŠ¿æ—¶ï¼Œå¯ä»¥åŒæ—¶å“åº” scrollGestureã€tapGesture æ‰‹åŠ¿ã€‚</p><p><strong>Gesture æ‰‹åŠ¿åº“ä¸­çš„ 9 ä¸ªæ‰‹åŠ¿ï¼Œæ¯ä¸ªæ‰‹åŠ¿å¯¹è±¡ä¸Šéƒ½æœ‰ simultaneousWithExternalGesture æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶è‹¥å¹²ä¸ªå…¶ä»–æ‰‹åŠ¿ä½œä¸ºå‚æ•°ï¼Œä½œç”¨æ˜¯è®©è¯¥æ‰‹åŠ¿èƒ½å’Œè‹¥å¹²ä¸ªå…¶ä»–æ‰‹åŠ¿åŒæ—¶è¿›è¡Œå“åº”ã€‚</strong></p><p>ç„¶åæˆ‘ä»¬å†ç«™åœ¨ scrollGesture æ‰‹åŠ¿çš„è§†è§’ï¼Œè®©å®ƒåœ¨æ•´ä½“è§†å›¾æ²¡æœ‰å›å½’åˆ°æ­£å¸¸ä½ç½®çš„æ—¶å€™ï¼Œä¸æ‰§è¡Œæ»šåŠ¨åŠ¨ç”»ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// hack: ä½¿ç”¨ tapGesture æ‰‹åŠ¿ä½œä¸ºæ§åˆ¶ scrollGesture æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»çš„å¼€å…³\n// å¹¶ä¸æ˜¯çœŸæ­£çš„è¦å“åº” Tap æ‰‹åŠ¿\nconst tapGesture = Gesture.Tap()\n  .onTouchesMove((_, manager) =&gt; {\n      // å¦‚æœ ScrollView å®¹å™¨æ²¡æœ‰é¡¶åˆ°å±å¹•é¡¶éƒ¨\n    if (LOADING_HEIGHT + refreshY.value === 0) {\n        // åˆ™è®¾ç½® Tap æ‰‹åŠ¿å†…éƒ¨çŠ¶æ€ä¸º FAILED\n      manager.fail();\n    } else {\n        // å…¶ä»–æƒ…å†µåˆ™è®¾ç½® Tap æ‰‹åŠ¿å†…éƒ¨çŠ¶æ€ä¸º ACTIVE\n        // å› ä¸º Tap æ‰‹åŠ¿å®é™…è§¦å‘äº†ï¼Œæ‰€ä»¥å†…éƒ¨ä¹Ÿä¼šè°ƒç”¨\n        // è¿™é‡Œåˆæ˜¾å¼è°ƒç”¨äº†ä¸€æ¬¡ï¼Œä¸ºçš„æ˜¯è®©å¤§å®¶çœ‹å¾—æ›´æ˜ç™½ä¸€äº›ã€‚\n      manager.activate();\n    }\n  })\n  .maxDuration(1000000);\n\n  const scrollGesture = Gesture.Native()\n    // å½“ Tap æ‰‹åŠ¿å†…éƒ¨çŠ¶æ€ä¸º ACTIVE æ—¶ï¼Œæ»šåŠ¨åŠ¨ç”»ä¸æ‰§è¡Œ\n    // å½“ Tap æ‰‹åŠ¿å†…éƒ¨çŠ¶æ€ä¸º FAILED æ—¶ï¼Œæ»šåŠ¨åŠ¨ç”»æ‰§è¡Œ\n    .requireExternalGestureToFail(tapGesture);\n</code></pre><p>è¿™æ®µä»£ç è™½ç„¶å¾ˆç®€å•ï¼Œä½†å…¶å®æ˜¯ä¸€ç§ hack æ–¹æ³•ï¼Œä¸ºäº†è®©ä½ çœ‹å¾—æ›´æ˜ç™½ä¸€äº›ï¼Œæˆ‘åˆåŠ äº†å¾ˆå¤šæ³¨é‡Šã€‚</p><p>ä»£ç ä¸­å…ˆåˆ›å»ºäº†ä¸€ä¸ª tapGesture æ‰‹åŠ¿ï¼Œåœ¨æ‰‹åŠ¿çš„ onTouchesMove å›è°ƒä¸­æ‰§è¡Œäº†æ§åˆ¶å…¶å†…éƒ¨çŠ¶æ€çš„é€»è¾‘ï¼Œåªæœ‰å½“å¤–å±‚å®¹å™¨çš„åç§»é‡ refreshY å’Œ LOADING_HEIGHT çš„é«˜åº¦æŠµæ¶ˆæ—¶ï¼Œæ•´ä½“è§†å›¾æ‰å›å½’åˆ°æ­£å¸¸ä½ç½®ï¼Œæ­¤æ—¶å°† tapGesture å†…éƒ¨çŠ¶æ€è®¾ç½®ä¸º FAILEDã€‚</p><p>å¹¶ä¸”ï¼Œæˆ‘è¿˜è°ƒç”¨äº† tapGesture çš„ maxDuration æ–¹æ³•ï¼Œè¿™ä¸ªå€¼çš„é»˜è®¤å€¼åªæœ‰ 500msã€‚æˆ‘å°†å…¶æœ€å¤§å“åº”æ—¶é—´è®¾ç½®ä¸º 1000000msï¼Œå¤§æ¦‚æ˜¯ 16 åˆ†é’Ÿã€‚åœ¨è¿™ 16 åˆ†é’Ÿå†…ï¼ŒGesture æ‰‹åŠ¿åº“ä¸ä¼šç›´æ¥ç»“æŸ Tap äº‹ä»¶ï¼Œåªæœ‰åœ¨æˆ‘ä¸»åŠ¨è°ƒç”¨ FAILEDæ—¶ï¼Œæˆ–è€…æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶æ‰ä¼šä¸»åŠ¨ç»“æŸï¼Œè¿™æ ·å°±ä¿è¯äº†æˆ‘çš„ hack é€»è¾‘æ­£å¸¸æ‰§è¡Œäº†ã€‚</p><p>æ¥ç€æˆ‘åˆåœ¨ scrollGesture æ‰‹åŠ¿ä¸­è°ƒç”¨äº† requireExternalGestureToFail æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…¥å‚æ˜¯ tapGestureï¼Œå…¶ä½œç”¨æ˜¯å½“ tapGesture æ‰‹åŠ¿çš„å†…éƒ¨çŠ¶æ€ç½®ä¸º FAILED æ—¶ï¼Œå¼€å§‹æ‰§è¡Œæ»šåŠ¨åŠ¨ç”»ã€‚</p><p><strong>å…¶ä¸­ï¼ŒrequireExternalGestureToFail æ–¹æ³•åœ¨ Gesture æ‰‹åŠ¿åº“ä¸­çš„ 9 ä¸ªæ‰‹åŠ¿å¯¹è±¡ä¸Šéƒ½èƒ½è°ƒç”¨ã€‚è¯¥æ–¹æ³•æ¥æ”¶è‹¥å¹²ä¸ªå…¶ä»–æ‰‹åŠ¿ä½œä¸ºå‚æ•°ï¼Œåªæœ‰åœ¨å…¶ä»–è‹¥å¹²ä¸ªæ‰‹åŠ¿éƒ½å¤±è´¥åï¼Œè¯¥æ‰‹åŠ¿æ‰ä¼šå˜ä¸º ACTIVE å“åº”ï¼Œåœ¨æ»šåŠ¨æ‰‹åŠ¿ä¸Šè¡¨ç°ä¸ºæ‰§è¡Œæ»šåŠ¨åŠ¨ç”»ã€‚</strong></p><p>è¿™æ ·æˆ‘å°±é€šè¿‡ hack çš„æ‰‹æ®µï¼Œè§£å†³äº†æ»šåŠ¨åŠ¨ç”»å’Œæ‰‹åŠ¿åŠ¨ç”»å åŠ å¯¼è‡´çš„è§†å›¾å¼‚å¸¸åç§»çš„æ½œåœ¨é—®é¢˜ã€‚</p><p>ä¼˜åŒ–åçš„ Android å›å¼¹æ»šåŠ¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const LOADING_HEIGHT = 200;\n\nfunction PanAndScrollView() {\n  const refreshY = useSharedValue(-LOADING_HEIGHT);\n  const scrollY = useSharedValue(0);\n  const {height: windowHeight} = useWindowDimensions();\n  const wrapperHeight = windowHeight + LOADING_HEIGHT;\n\n  const tapGesture = Gesture.Tap()\n    .onTouchesMove((_, manager) =&gt; {\n      if (LOADING_HEIGHT + refreshY.value === 0) {\n        manager.fail();\n      } else {\n        manager.activate();\n      }\n    })\n    .maxDuration(1000000);\n\n  const scrollGesture = Gesture.Native()\n    .requireExternalGestureToFail(tapGesture);\n\n  const panGesture = Gesture.Pan()\n    .onChange(e =&gt; {\n      if (scrollY.value === 0 || refreshY.value !== -LOADING_HEIGHT) {\n        refreshY.value = Math.max(-LOADING_HEIGHT, refreshY.value + e.changeY);\n      }\n    })\n    .onEnd(() =&gt; {\n      if (refreshY.value !== -LOADING_HEIGHT) {\n        refreshY.value = withSpring(-LOADING_HEIGHT, {\n          stiffness: 300,\n          overshootClamping: true,\n        });\n      }\n    })\n    .simultaneousWithExternalGesture(scrollGesture, tapGesture);\n\n  const animatedStyle = useAnimatedStyle(() =&gt; {\n    return {\n      transform: [{translateY: refreshY.value}],\n    };\n  });\n\n  const scrollHandler = useAnimatedScrollHandler({\n    onScroll: e =&gt; {\n      scrollY.value = e.contentOffset.y;\n    },\n  });\n\n  return (\n    &lt;GestureDetector gesture={panGesture}&gt;\n      &lt;Animated.View style={[{height: wrapperHeight}, animatedStyle]}&gt;\n        &lt;Text style={{height: LOADING_HEIGHT,}}&gt;\n          loading...\n        &lt;/Text&gt;\n        &lt;GestureDetector\n          gesture={Gesture.Simultaneous(scrollGesture, tapGesture)}&gt;\n          &lt;Animated.ScrollView  onScroll={scrollHandler} scrollEventThrottle={1}&gt;\n             {Array(100).fill(1).map((_, index) =&gt; (&lt;Text key={index}&gt;{index}&lt;/Text&gt;))}\n          &lt;/Animated.ScrollView&gt;\n        &lt;/GestureDetector&gt;\n      &lt;/Animated.View&gt;\n    &lt;/GestureDetector&gt;\n  );\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±é€šè¿‡ç«™åœ¨å•ä¸ªæ‰‹åŠ¿çš„è§†è§’æ‹†è§£é—®é¢˜ï¼Œè§£å†³äº†å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªã€‚æˆ‘ä»¬ç°åœ¨å†å›åˆ°Gestureç¬¬ä¸€è®²ä¸­æˆ‘æåˆ°çš„ 3 ä¸ªæ›¾ç»å›°æ‰°è¿‡æˆ‘çš„é—®é¢˜ï¼šAndroid å›å¼¹ä¸‹æ‹‰åˆ·æ–°ã€ç±»ä¼¼æŠ–éŸ³è¯„è®ºåŒºçš„æ‰‹åŠ¿åŠ¨æ•ˆã€ç±»ä¼¼æ·˜å®é¦–é¡µçš„æ‰‹åŠ¿åŠ¨æ•ˆã€‚</p><p>é€šè¿‡è¿™ä¸‰è®²çš„å­¦ä¹ ï¼Œç›¸ä¿¡ä½ å·²ç»çŸ¥é“æ€ä¹ˆå»è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜äº†ã€‚å‰©ä¸‹çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä¹Ÿæ‰¾åˆ°äº†ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥çœ‹ä¸‹æˆ‘<a href=\"https://github.com/jiangleo/react-native-classroom/tree/main/src/17_Gesture\"> GitHub</a> ä¸Šçš„ä»£ç ã€‚æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€ã€‚</p><ul>\n<li><a href=\"https://github.com/jiangleo/react-native-classroom/blob/main/src/17_Gesture/4_BetterPanAndScrollView.tsx\">Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°ï¼ˆæœ¬èŠ‚è¯¾æ¡ˆä¾‹ï¼‰</a>ï¼›</li>\n<li><a href=\"https://github.com/jiangleo/react-native-classroom/blob/main/src/17_Gesture/5_NestBottomSheet.tsx\">ç±»ä¼¼æŠ–éŸ³è¯„è®ºåŒºçš„æ‰‹åŠ¿åŠ¨æ•ˆ</a>ï¼ˆæ”¹è‡ª Gesture æ‰‹åŠ¿åº“æä¾›çš„ bottom_sheet ç¤ºä¾‹ï¼‰ï¼›</li>\n<li><a href=\"ttps://github.com/jiangleo/react-native-classroom/blob/main/src/17_Gesture/6_HeadTabs.tsx\">ç±»ä¼¼æ·˜å®é¦–é¡µçš„æ‰‹åŠ¿åŠ¨æ•ˆ</a>ï¼ˆæ‰¾åˆ°ä¸€ä¸ªå¼€æºåº“ï¼Œä½†ç”¨çš„æ˜¯ Reanimated v2 + Gesture v1 å®ç°çš„ï¼‰ã€‚</li>\n</ul><p>å¦‚æœä½ è§‰å¾—å…‰æœ‰å›¾ç‰‡ï¼Œæ²¡æœ‰è§†é¢‘ï¼Œå…¥é—¨æ¯”è¾ƒè´¹åŠ²ï¼Œä½ å¯ä»¥æ­é…<a href=\"https://www.youtube.com/watch?v=xpT2shjX790\">ã€ŠIntroduction to Gesture Handler 2 (React Native)ã€‹</a>è§†é¢‘æ•™ç¨‹ä¸€èµ·å­¦ä¹ ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨å¹³æ—¶å’Œå¤§å®¶äº¤æµçš„æ—¶å€™ï¼Œæˆ‘å‘ç°ä¸ä»…ä»…æ˜¯æˆ‘é‡åˆ°äº† React Native çš„æ‰‹åŠ¿å†²çªé—®é¢˜ï¼Œå¤§å®¶ä¹Ÿç»å¸¸é‡åˆ°æ‰‹åŠ¿å†²çªçš„é—®é¢˜ï¼Œä½†ä¸çŸ¥é“æ€ä¹ˆè§£å†³ã€‚</p><p>ä»æŠ€æœ¯ä¸Šï¼Œè§£å†³æ€è·¯æœ‰ä¸‰ä¸ªè¦ç‚¹ï¼š</p><p>é¦–å…ˆï¼Œæ‰‹åŠ¿åŠ¨ç”»ä¸åˆ†å®¶ï¼Œå°† Reanimated v2 + Gesture v2 æ­é…èµ·æ¥ç”¨ï¼Œå®ƒä¿©çš„å›è°ƒéƒ½æ˜¯æ”¾åœ¨ UI çº¿ç¨‹åŒæ­¥æ‰§è¡Œçš„ï¼Œæ€§èƒ½å’Œä½“éªŒä¸Šä¼šæ›´å¥½ã€‚</p><p>å…¶æ¬¡ï¼ŒGesture æ‰‹åŠ¿åº“æä¾›å¯æ‰©å±•æ€§å¼ºçš„ã€åŠŸèƒ½ä¸°å¯Œçš„ â€œ1 + 8â€ ç§æ‰‹åŠ¿ï¼Œ1 æ˜¯ç»™ä½ è‡ªå®šä¹‰çš„åŸå§‹æ‰‹åŠ¿ï¼Œ8 æ˜¯å·²ç»å°è£…å¥½çš„ 8 ç§å¸¸ç”¨çš„æ‰‹åŠ¿ã€‚</p><p>æœ€åï¼ŒGesture æ‰‹åŠ¿åº“åˆ›æ–°åœ°ç«™åœ¨ç»„ä»¶è§’åº¦ã€ç«™åœ¨æ‰‹åŠ¿è§’åº¦ç»™å‡ºäº†æ‰‹åŠ¿å†²çªçš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆå®Œå…¨å¯ä»¥æ›¿ä»£ React Native æ¡†æ¶åŸæœ‰çš„ã€ç«™åœ¨äº‹ä»¶è§’åº¦çš„æ•è·å†’æ³¡æ–¹æ¡ˆï¼Œè€Œä¸”è§£å†³äº†å¤šè§†å›¾å¤šæ‰‹åŠ¿å†²çªçš„é—®é¢˜ã€‚</p><p>å¦å¤–ï¼Œæˆ‘è§‰å¾—å½“ä½ é‡åˆ°ä¸šå†…å·²æœ‰ç±»ä¼¼è§£å†³æ–¹æ¡ˆçš„é—®é¢˜æ—¶ï¼Œä¸å¦¨å¤šçœ‹çœ‹ Github ç¤¾åŒºä¸Šçš„ä»£ç ï¼Œå¾ˆå¤šç¤¾åŒºåº“åœ¨ Github ä¸Šéƒ½æä¾›äº† Example ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹éå¸¸æœ‰ä»·å€¼ï¼Œæˆ‘å®ç° Android å›å¼¹ä¸‹æ‹‰åˆ·æ–°å’Œç±»ä¼¼æŠ–éŸ³è¯„è®ºåŒºçš„æ‰‹åŠ¿åŠ¨æ•ˆè¿™ä¸¤ä¸ª demoï¼Œéƒ½æ˜¯ä» Gesture æ‰‹åŠ¿åº“çš„ <a href=\"https://github.com/software-mansion/react-native-gesture-handler/tree/main/example\">Example ç¤ºä¾‹</a>ä¸­æ‰¾åˆ°çš„çµæ„Ÿã€‚</p><p>æœ‰ç©ºçš„æ—¶å€™ï¼Œä½ ä¹Ÿå¯ä»¥å¤šçœ‹çœ‹è¿™äº›ä¼˜ç§€å¼€æºåº“çš„ç¤ºä¾‹ï¼Œç›¸ä¿¡è¿™å¯¹ä½ çš„æˆé•¿ä¼šç‰¹åˆ«æœ‰å¸®åŠ©ã€‚</p><h2>ä½œä¸š</h2><ol>\n<li>è¯·ä½ å‚è€ƒè¿™ä¸€è®²ä¸­çš„ Android ä¸‹æ‹‰åˆ·æ–° Demoï¼Œå®ç°ä¸€ä¸ªç±»ä¼¼æ·˜å®äºŒæ¥¼çš„æ‰‹åŠ¿æ•ˆæœã€‚</li>\n<li>è¯·ä½ è¯´è¯´ä½ åœ¨å¼€å‘ React Native æ—¶é‡åˆ°è¿‡å“ªäº›æ‰‹åŠ¿åŠ¨æ•ˆé—®é¢˜ï¼Ÿå­¦å®Œè¿™ä¸‰è®²åä½ æœ‰æ²¡æœ‰æ–°çš„è§£å†³æ€è·¯ï¼Ÿ</li>\n</ol><p>æ¬¢è¿åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„è§‚ç‚¹å’Œæƒ³æ³•ã€‚æˆ‘æ˜¯è’‹å®ä¼Ÿï¼Œå’±ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"16ï½œGestureï¼ˆä¸­ï¼‰ï¼šå¦‚ä½•è§£å†³å•è§†å›¾å¤šæ‰‹åŠ¿çš„å†²çªé—®é¢˜ï¼Ÿ","id":514905},"right":{"article_title":"18ï½œNavigationï¼šé¡µé¢ä¹‹é—´æ€ä¹ˆè·³è½¬ï¼Ÿ","id":516300}},"comments":[{"had_liked":false,"id":345338,"user_name":"abcğŸ™‚","can_delete":false,"product_type":"c1","uid":1887261,"ip_address":"","ucode":"FCF2B9091D161B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/cc/1d/3c0272a1.jpg","comment_is_top":false,"comment_ctime":1652196922,"is_pvip":false,"replies":[{"id":126220,"content":"å¯ä»¥çš„ã€‚RecyclerListView æä¾›äº†ç›¸å…³å±æ€§ï¼Œå¯ä»¥æŠŠé»˜è®¤çš„ ScrollView æ›¿æ¢æˆ Animated.ScrollViewã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1652678748,"ip_address":"","comment_id":345338,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"æœ‰æ²¡æœ‰å¯èƒ½è·ŸRecyclerListViewç»„ä»¶ç»“åˆèµ·æ¥ï¼Œå®ç°andaroidé«˜æ€§èƒ½çš„é•¿åˆ—è¡¨å¼¹æ€§æ»šåŠ¨","like_count":2,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572253,"discussion_content":"å¯ä»¥çš„ã€‚RecyclerListView æä¾›äº†ç›¸å…³å±æ€§ï¼Œå¯ä»¥æŠŠé»˜è®¤çš„ ScrollView æ›¿æ¢æˆ Animated.ScrollViewã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652678748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344950,"user_name":"é£æ˜Ÿèˆ","can_delete":false,"product_type":"c1","uid":1045276,"ip_address":"","ucode":"27BB5EF927C940","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/1c/db1d53e2.jpg","comment_is_top":false,"comment_ctime":1651893082,"is_pvip":false,"replies":[{"id":126312,"content":"è¿™ä¸ªæ˜¯å¼€å¯ Hermes çš„å‘½ä»¤ï¼›ç°åœ¨å¯ä»¥ç›´æ¥é€šè¿‡é…ç½®åŒæ—¶å¼€å¯æ–°æ¶æ„çš„ Hermes å’Œ Fabric äº†ã€‚\n\n\nOn Android you can set newArchEnabled=true inside the android&#47;gradle.properties file.","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1652885329,"ip_address":"","comment_id":344950,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è¯·é—®GitHubä»“åº“ä¸­è¿è¡Œandroidæ—¶çš„è¿™ä¸ª yarn install-android-hermes å‘½ä»¤æ˜¯ä»€ä¹ˆä½œç”¨ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572659,"discussion_content":"è¿™ä¸ªæ˜¯å¼€å¯ Hermes çš„å‘½ä»¤ï¼›ç°åœ¨å¯ä»¥ç›´æ¥é€šè¿‡é…ç½®åŒæ—¶å¼€å¯æ–°æ¶æ„çš„ Hermes å’Œ Fabric äº†ã€‚\n\n\nOn Android you can set newArchEnabled=true inside the android/gradle.properties file.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652885330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396203,"user_name":"Geek_84d08b","can_delete":false,"product_type":"c1","uid":3073317,"ip_address":"åŒ—äº¬","ucode":"8CF78E2DF2EF98","user_header":"","comment_is_top":false,"comment_ctime":1733543742,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è¯·é—®ï¼štapGesture onTouchesMove ä¸­ refreshY.value è·å–åˆ°çš„å€¼ä¸€ç›´æ˜¯ -200ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":389158,"user_name":"*****","can_delete":false,"product_type":"c1","uid":2548515,"ip_address":"ç¦å»º","ucode":"73EDAFD23B80E1","user_header":"https://static001.geekbang.org/account/avatar/00/26/e3/23/b190b05d.jpg","comment_is_top":false,"comment_ctime":1711696353,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ç°åœ¨å›½å†…çš„å¤§å‚æœ‰ä½¿ç”¨è¿™æ‰‹åŠ¿å’ŒåŠ¨ç”»åº“å—","like_count":0},{"had_liked":false,"id":380502,"user_name":"ä¾¯åŒå­¦","can_delete":false,"product_type":"c1","uid":1125813,"ip_address":"åŒ—äº¬","ucode":"CC7A07CDF63EC6","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/b5/777ba52b.jpg","comment_is_top":false,"comment_ctime":1693728716,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è’‹è€å¸ˆå¥½\n\nå¤„ç†å•è§†å›¾å¤šæ‰‹åŠ¿å†²çªçš„ Race Exclusive Simultaneous ä¸å¤„ç†å¤šè§†å›¾å¤šæ‰‹åŠ¿çš„ simultaneousWithExternalGesture requireExternalGestureToFail æœ‰ä»€ä¹ˆå…³ç³»ã€åŒºåˆ« ï¼Ÿ\nåªæ˜¯å¤„ç†å•è§†å›¾å¤šæ‰‹åŠ¿å†²çªçš„ API æ˜¯åœ¨ç»„ä»¶çš„è§’åº¦ï¼Œå¤„ç†å¤šè§†å›¾å¤šæ‰‹åŠ¿å†²çªçš„ API æ˜¯åœ¨æ‰‹åŠ¿çš„è§’åº¦å— ï¼Ÿ\nç‰¹åˆ«æ˜¯ Simultaneous ä¸ simultaneousWithExternalGesture æ„Ÿè§‰å¾ˆåƒ\n\nå¦å¤–ä¸Šé¢ä»£ç ä¸­çš„ panGesture è°ƒç”¨ simultaneousWithExternalGesture æ—¶ä¸ºä»€ä¹ˆè¿˜è¦ä¼ å…¥ scrollGesture tapGesture \nå¤–éƒ¨ç»„ä»¶ä¸ºä»€ä¹ˆè¿˜è¦å“åº”è¿™ä¸¤ä¸ªäº‹ä»¶ï¼Œè™½ç„¶æˆ‘æµ‹è¯•ä¸ä¼ ç¡®å®ä¸è¡Œ","like_count":0},{"had_liked":false,"id":354739,"user_name":"songyq","can_delete":false,"product_type":"c1","uid":2427725,"ip_address":"åŒ—äº¬","ucode":"0A95EBA8D2F16A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLib4GiaK4KB3UvnnzIkMAD4QzKBAkOzdntPwsb8RX1xjHYgr2w0GLWhmoPdwy3iby3zOHbeTBR2DgRQ/132","comment_is_top":false,"comment_ctime":1660729742,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"Gesture æ‰‹åŠ¿åº“è§£å†³æ‰‹åŠ¿å†²çªçš„æ–¹æ¡ˆ ç¡®å®šä¸æ˜¯æŠ„çš„appleçš„æ‰‹åŠ¿ä»£ç†ä¹ˆï¼Ÿ","like_count":0}]}