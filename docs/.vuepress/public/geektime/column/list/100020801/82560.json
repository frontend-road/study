{"id":82560,"title":"43 | è¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨ï¼Ÿ","content":"<p>æˆ‘ç»å¸¸è¢«é—®åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šåˆ†åŒºè¡¨æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå…¬å¸è§„èŒƒä¸è®©ä½¿ç”¨åˆ†åŒºè¡¨å‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠåˆ†åŒºè¡¨çš„ä½¿ç”¨è¡Œä¸ºï¼Œç„¶åå†ä¸€èµ·å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><h1>åˆ†åŒºè¡¨æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ä¸ºäº†è¯´æ˜åˆ†åŒºè¡¨çš„ç»„ç»‡å½¢å¼ï¼Œæˆ‘å…ˆåˆ›å»ºä¸€ä¸ªè¡¨tï¼š</p><pre><code>CREATE TABLE `t` (\n  `ftime` datetime NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  KEY (`ftime`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1\nPARTITION BY RANGE (YEAR(ftime))\n(PARTITION p_2017 VALUES LESS THAN (2017) ENGINE = InnoDB,\n PARTITION p_2018 VALUES LESS THAN (2018) ENGINE = InnoDB,\n PARTITION p_2019 VALUES LESS THAN (2019) ENGINE = InnoDB,\nPARTITION p_others VALUES LESS THAN MAXVALUE ENGINE = InnoDB);\ninsert into t values('2017-4-1',1),('2018-4-1',1);\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/06/f5/06f041129783533de9c75580f9decdf5.png?wh=1602*60\" alt=\"\"></p><center><span class=\"reference\">å›¾1 è¡¨tçš„ç£ç›˜æ–‡ä»¶</span></center><p>æˆ‘åœ¨è¡¨tä¸­åˆå§‹åŒ–æ’å…¥äº†ä¸¤è¡Œè®°å½•ï¼ŒæŒ‰ç…§å®šä¹‰çš„åˆ†åŒºè§„åˆ™ï¼Œè¿™ä¸¤è¡Œè®°å½•åˆ†åˆ«è½åœ¨p_2018å’Œp_2019è¿™ä¸¤ä¸ªåˆ†åŒºä¸Šã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¡¨åŒ…å«äº†ä¸€ä¸ª.frmæ–‡ä»¶å’Œ4ä¸ª.ibdæ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª.ibdæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul>\n<li>å¯¹äºå¼•æ“å±‚æ¥è¯´ï¼Œè¿™æ˜¯4ä¸ªè¡¨ï¼›</li>\n<li>å¯¹äºServerå±‚æ¥è¯´ï¼Œè¿™æ˜¯1ä¸ªè¡¨ã€‚</li>\n</ul><p>ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ä¸¤å¥éƒ½æ˜¯åºŸè¯ã€‚å…¶å®ä¸ç„¶ï¼Œè¿™ä¸¤å¥è¯éå¸¸é‡è¦ï¼Œå¯ä»¥å¸®æˆ‘ä»¬ç†è§£åˆ†åŒºè¡¨çš„æ‰§è¡Œé€»è¾‘ã€‚</p><h1>åˆ†åŒºè¡¨çš„å¼•æ“å±‚è¡Œä¸º</h1><p>æˆ‘å…ˆç»™ä½ ä¸¾ä¸ªåœ¨åˆ†åŒºè¡¨åŠ é—´éš™é”çš„ä¾‹å­ï¼Œç›®çš„æ˜¯è¯´æ˜å¯¹äºInnoDBæ¥è¯´ï¼Œè¿™æ˜¯4ä¸ªè¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/c7/d28d6ab873bd8337d88812d45b9266c7.png?wh=939*297\" alt=\"\"></p><center><span class=\"reference\">å›¾2 åˆ†åŒºè¡¨é—´éš™é”ç¤ºä¾‹</span></center><p>è¿™é‡Œé¡ºä¾¿å¤ä¹ ä¸€ä¸‹ï¼Œæˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/75659\">ç¬¬21ç¯‡æ–‡ç« </a>å’Œä½ ä»‹ç»çš„é—´éš™é”åŠ é”è§„åˆ™ã€‚</p><p>æˆ‘ä»¬åˆå§‹åŒ–è¡¨tçš„æ—¶å€™ï¼Œåªæ’å…¥äº†ä¸¤è¡Œæ•°æ®ï¼Œ ftimeçš„å€¼åˆ†åˆ«æ˜¯ï¼Œ'2017-4-1' å’Œ'2018-4-1' ã€‚session Açš„selectè¯­å¥å¯¹ç´¢å¼•ftimeä¸Šè¿™ä¸¤ä¸ªè®°å½•ä¹‹é—´çš„é—´éš™åŠ äº†é”ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šè¡¨çš„è¯ï¼Œé‚£ä¹ˆT1æ—¶åˆ»ï¼Œåœ¨è¡¨tçš„ftimeç´¢å¼•ä¸Šï¼Œé—´éš™å’ŒåŠ é”çŠ¶æ€åº”è¯¥æ˜¯å›¾3è¿™æ ·çš„ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/27/d2/273c9ca869f5b52621641d73eb6f72d2.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾3 æ™®é€šè¡¨çš„åŠ é”èŒƒå›´</span></center><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ'2017-4-1' å’Œ'2018-4-1' è¿™ä¸¤ä¸ªè®°å½•ä¹‹é—´çš„é—´éš™æ˜¯ä¼šè¢«é”ä½çš„ã€‚é‚£ä¹ˆï¼Œsesion Bçš„ä¸¤æ¡æ’å…¥è¯­å¥åº”è¯¥éƒ½è¦è¿›å…¥é”ç­‰å¾…çŠ¶æ€ã€‚</p><p>ä½†æ˜¯ï¼Œä»ä¸Šé¢çš„å®éªŒæ•ˆæœå¯ä»¥çœ‹å‡ºï¼Œsession Bçš„ç¬¬ä¸€ä¸ªinsertè¯­å¥æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºå¼•æ“æ¥è¯´ï¼Œp_2018å’Œp_2019æ˜¯ä¸¤ä¸ªä¸åŒçš„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´2017-4-1çš„ä¸‹ä¸€ä¸ªè®°å½•å¹¶ä¸æ˜¯2018-4-1ï¼Œè€Œæ˜¯p_2018åˆ†åŒºçš„supremumã€‚æ‰€ä»¥T1æ—¶åˆ»ï¼Œåœ¨è¡¨tçš„ftimeç´¢å¼•ä¸Šï¼Œé—´éš™å’ŒåŠ é”çš„çŠ¶æ€å…¶å®æ˜¯å›¾4è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/92/5c/92f63aba0b24adefac7316c75463b95c.jpg?wh=1142*880\" alt=\"\"></p><center><span class=\"reference\">å›¾4 åˆ†åŒºè¡¨tçš„åŠ é”èŒƒå›´</span></center><p>ç”±äºåˆ†åŒºè¡¨çš„è§„åˆ™ï¼Œsession Açš„selectè¯­å¥å…¶å®åªæ“ä½œäº†åˆ†åŒºp_2018ï¼Œå› æ­¤åŠ é”èŒƒå›´å°±æ˜¯å›¾4ä¸­æ·±ç»¿è‰²çš„éƒ¨åˆ†ã€‚</p><p>æ‰€ä»¥ï¼Œsession Bè¦å†™å…¥ä¸€è¡Œftimeæ˜¯2018-2-1çš„æ—¶å€™æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œè€Œè¦å†™å…¥2017-12-1è¿™ä¸ªè®°å½•ï¼Œå°±è¦ç­‰session Açš„é—´éš™é”ã€‚</p><p>å›¾5å°±æ˜¯è¿™æ—¶å€™çš„show engine innodb statusçš„éƒ¨åˆ†ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/0f/e3d83d9ba89de9a6f541c9a2f24a3b0f.png?wh=3080*240\" alt=\"\"></p><center><span class=\"reference\">å›¾5 session Bè¢«é”ä½ä¿¡æ¯</span></center><p>çœ‹å®ŒInnoDBå¼•æ“çš„ä¾‹å­ï¼Œæˆ‘ä»¬å†æ¥ä¸€ä¸ªMyISAMåˆ†åŒºè¡¨çš„ä¾‹å­ã€‚</p><p>æˆ‘é¦–å…ˆç”¨alter table t engine=myisamï¼ŒæŠŠè¡¨tæ”¹æˆMyISAMè¡¨ï¼›ç„¶åï¼Œæˆ‘å†ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œå¯¹äºMyISAMå¼•æ“æ¥è¯´ï¼Œè¿™æ˜¯4ä¸ªè¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/94/76/941306d4a7193455dcf1cfebf7678876.png?wh=927*264\" alt=\"\"></p><center><span class=\"reference\">å›¾6 ç”¨MyISAMè¡¨é”éªŒè¯</span></center><p>åœ¨session Aé‡Œé¢ï¼Œæˆ‘ç”¨sleep(100)å°†è¿™æ¡è¯­å¥çš„æ‰§è¡Œæ—¶é—´è®¾ç½®ä¸º100ç§’ã€‚ç”±äºMyISAMå¼•æ“åªæ”¯æŒè¡¨é”ï¼Œæ‰€ä»¥è¿™æ¡updateè¯­å¥ä¼šé”ä½æ•´ä¸ªè¡¨tä¸Šçš„è¯»ã€‚</p><p>ä½†æˆ‘ä»¬çœ‹åˆ°çš„ç»“æœæ˜¯ï¼Œsession Bçš„ç¬¬ä¸€æ¡æŸ¥è¯¢è¯­å¥æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼Œç¬¬äºŒæ¡è¯­å¥æ‰è¿›å…¥é”ç­‰å¾…çŠ¶æ€ã€‚</p><p>è¿™æ­£æ˜¯å› ä¸ºMyISAMçš„è¡¨é”æ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ï¼Œsession AåŠ çš„è¡¨é”ï¼Œå…¶å®æ˜¯é”åœ¨åˆ†åŒºp_2018ä¸Šã€‚å› æ­¤ï¼Œåªä¼šå µä½åœ¨è¿™ä¸ªåˆ†åŒºä¸Šæ‰§è¡Œçš„æŸ¥è¯¢ï¼Œè½åˆ°å…¶ä»–åˆ†åŒºçš„æŸ¥è¯¢æ˜¯ä¸å—å½±å“çš„ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè¯´ï¼Œåˆ†åŒºè¡¨çœ‹æ¥è¿˜ä¸é”™å˜›ï¼Œä¸ºä»€ä¹ˆä¸è®©ç”¨å‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å•è¡¨è¿‡å¤§ã€‚é‚£ä¹ˆï¼Œå¦‚æœä¸ä½¿ç”¨åˆ†åŒºè¡¨çš„è¯ï¼Œæˆ‘ä»¬å°±æ˜¯è¦ä½¿ç”¨æ‰‹åŠ¨åˆ†è¡¨çš„æ–¹å¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹æ‰‹åŠ¨åˆ†è¡¨å’Œåˆ†åŒºè¡¨æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>æ¯”å¦‚ï¼ŒæŒ‰ç…§å¹´ä»½æ¥åˆ’åˆ†ï¼Œæˆ‘ä»¬å°±åˆ†åˆ«åˆ›å»ºæ™®é€šè¡¨t_2017ã€t_2018ã€t_2019ç­‰ç­‰ã€‚æ‰‹å·¥åˆ†è¡¨çš„é€»è¾‘ï¼Œä¹Ÿæ˜¯æ‰¾åˆ°éœ€è¦æ›´æ–°çš„æ‰€æœ‰åˆ†è¡¨ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œæ›´æ–°ã€‚åœ¨æ€§èƒ½ä¸Šï¼Œè¿™å’Œåˆ†åŒºè¡¨å¹¶æ²¡æœ‰å®è´¨çš„å·®åˆ«ã€‚</p><p>åˆ†åŒºè¡¨å’Œæ‰‹å·¥åˆ†è¡¨ï¼Œä¸€ä¸ªæ˜¯ç”±serverå±‚æ¥å†³å®šä½¿ç”¨å“ªä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ˜¯ç”±åº”ç”¨å±‚ä»£ç æ¥å†³å®šä½¿ç”¨å“ªä¸ªåˆ†è¡¨ã€‚å› æ­¤ï¼Œä»å¼•æ“å±‚çœ‹ï¼Œè¿™ä¸¤ç§æ–¹å¼ä¹Ÿæ˜¯æ²¡æœ‰å·®åˆ«çš„ã€‚</p><p>å…¶å®è¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„åŒºåˆ«ï¼Œä¸»è¦æ˜¯åœ¨serverå±‚ä¸Šã€‚ä»serverå±‚çœ‹ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸æåˆ°åˆ†åŒºè¡¨ä¸€ä¸ªè¢«å¹¿ä¸ºè¯Ÿç—…çš„é—®é¢˜ï¼šæ‰“å¼€è¡¨çš„è¡Œä¸ºã€‚</p><h1>åˆ†åŒºç­–ç•¥</h1><p>æ¯å½“ç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªåˆ†åŒºè¡¨çš„æ—¶å€™ï¼ŒMySQLéœ€è¦æŠŠæ‰€æœ‰çš„åˆ†åŒºéƒ½è®¿é—®ä¸€éã€‚<strong>ä¸€ä¸ªå…¸å‹çš„æŠ¥é”™æƒ…å†µ</strong>æ˜¯è¿™æ ·çš„ï¼šå¦‚æœä¸€ä¸ªåˆ†åŒºè¡¨çš„åˆ†åŒºå¾ˆå¤šï¼Œæ¯”å¦‚è¶…è¿‡äº†1000ä¸ªï¼Œè€ŒMySQLå¯åŠ¨çš„æ—¶å€™ï¼Œopen_files_limitå‚æ•°ä½¿ç”¨çš„æ˜¯é»˜è®¤å€¼1024ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è®¿é—®è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œç”±äºéœ€è¦æ‰“å¼€æ‰€æœ‰çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ‰“å¼€è¡¨æ–‡ä»¶çš„ä¸ªæ•°è¶…è¿‡äº†ä¸Šé™è€ŒæŠ¥é”™ã€‚</p><p>ä¸‹å›¾å°±æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šåˆ†åŒºçš„è¡¨t_myisamï¼Œæ‰§è¡Œä¸€æ¡æ’å…¥è¯­å¥åæŠ¥é”™çš„æƒ…å†µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ab/e7/abfa0054ec43d97fb18ba3c1c8829ae7.png?wh=2060*124\" alt=\"\"></p><center><span class=\"reference\">å›¾ 7 insert è¯­å¥æŠ¥é”™</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡insertè¯­å¥ï¼Œæ˜æ˜¾åªéœ€è¦è®¿é—®ä¸€ä¸ªåˆ†åŒºï¼Œä½†è¯­å¥å´æ— æ³•æ‰§è¡Œã€‚</p><p>è¿™æ—¶ï¼Œä½ ä¸€å®šä»è¡¨åçŒœåˆ°äº†ï¼Œè¿™ä¸ªè¡¨æˆ‘ç”¨çš„æ˜¯MyISAMå¼•æ“ã€‚æ˜¯çš„ï¼Œå› ä¸ºä½¿ç”¨InnoDBå¼•æ“çš„è¯ï¼Œå¹¶ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p><p>MyISAMåˆ†åŒºè¡¨ä½¿ç”¨çš„åˆ†åŒºç­–ç•¥ï¼Œæˆ‘ä»¬ç§°ä¸º<strong>é€šç”¨åˆ†åŒºç­–ç•¥</strong>ï¼ˆgeneric partitioningï¼‰ï¼Œæ¯æ¬¡è®¿é—®åˆ†åŒºéƒ½ç”±serverå±‚æ§åˆ¶ã€‚é€šç”¨åˆ†åŒºç­–ç•¥ï¼Œæ˜¯MySQLä¸€å¼€å§‹æ”¯æŒåˆ†åŒºè¡¨çš„æ—¶å€™å°±å­˜åœ¨çš„ä»£ç ï¼Œåœ¨æ–‡ä»¶ç®¡ç†ã€è¡¨ç®¡ç†çš„å®ç°ä¸Šå¾ˆç²—ç³™ï¼Œå› æ­¤æœ‰æ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>ä»MySQL 5.7.9å¼€å§‹ï¼ŒInnoDBå¼•æ“å¼•å…¥äº†<strong>æœ¬åœ°åˆ†åŒºç­–ç•¥</strong>ï¼ˆnative partitioningï¼‰ã€‚è¿™ä¸ªç­–ç•¥æ˜¯åœ¨InnoDBå†…éƒ¨è‡ªå·±ç®¡ç†æ‰“å¼€åˆ†åŒºçš„è¡Œä¸ºã€‚</p><p>MySQLä»5.7.17å¼€å§‹ï¼Œå°†MyISAMåˆ†åŒºè¡¨æ ‡è®°ä¸ºå³å°†å¼ƒç”¨(deprecated)ï¼Œæ„æ€æ˜¯â€œä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹ä¸å»ºè®®è¿™ä¹ˆä½¿ç”¨ï¼Œè¯·ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆã€‚åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ä¼šåºŸå¼ƒè¿™ä¸ªåŠŸèƒ½â€ã€‚</p><p>ä»MySQL 8.0ç‰ˆæœ¬å¼€å§‹ï¼Œå°±ä¸å…è®¸åˆ›å»ºMyISAMåˆ†åŒºè¡¨äº†ï¼Œåªå…è®¸åˆ›å»ºå·²ç»å®ç°äº†æœ¬åœ°åˆ†åŒºç­–ç•¥çš„å¼•æ“ã€‚ç›®å‰æ¥çœ‹ï¼Œåªæœ‰InnoDBå’ŒNDBè¿™ä¸¤ä¸ªå¼•æ“æ”¯æŒäº†æœ¬åœ°åˆ†åŒºç­–ç•¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹åˆ†åŒºè¡¨åœ¨serverå±‚çš„è¡Œä¸ºã€‚</p><h1>åˆ†åŒºè¡¨çš„serverå±‚è¡Œä¸º</h1><p>å¦‚æœä»serverå±‚çœ‹çš„è¯ï¼Œä¸€ä¸ªåˆ†åŒºè¡¨å°±åªæ˜¯ä¸€ä¸ªè¡¨ã€‚</p><p>è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘å°±ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥å’Œä½ è¯´æ˜ã€‚å¦‚å›¾8å’Œå›¾9æ‰€ç¤ºï¼Œåˆ†åˆ«æ˜¯è¿™ä¸ªä¾‹å­çš„æ“ä½œåºåˆ—å’Œæ‰§è¡Œç»“æœå›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/81/0eca5a3190161e59ea58493915bd5e81.png?wh=935*202\" alt=\"\"></p><center><span class=\"reference\">å›¾8 åˆ†åŒºè¡¨çš„MDLé”</span></center><p><img src=\"https://static001.geekbang.org/resource/image/af/a8/afe662f5e051a2ceb96a87624a589aa8.png?wh=2912*368\" alt=\"\"></p><center><span class=\"reference\">å›¾9 show processlistç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶session Båªéœ€è¦æ“ä½œp_2017è¿™ä¸ªåˆ†åŒºï¼Œä½†æ˜¯ç”±äºsession AæŒæœ‰æ•´ä¸ªè¡¨tçš„MDLé”ï¼Œå°±å¯¼è‡´äº†session Bçš„alterè¯­å¥è¢«å µä½ã€‚</p><p>è¿™ä¹Ÿæ˜¯DBAåŒå­¦ç»å¸¸è¯´çš„ï¼Œåˆ†åŒºè¡¨ï¼Œåœ¨åšDDLçš„æ—¶å€™ï¼Œå½±å“ä¼šæ›´å¤§ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ™®é€šåˆ†è¡¨ï¼Œé‚£ä¹ˆå½“ä½ åœ¨truncateä¸€ä¸ªåˆ†è¡¨çš„æ—¶å€™ï¼Œè‚¯å®šä¸ä¼šè·Ÿå¦å¤–ä¸€ä¸ªåˆ†è¡¨ä¸Šçš„æŸ¥è¯¢è¯­å¥ï¼Œå‡ºç°MDLé”å†²çªã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°ç»“ä¸€ä¸‹ï¼š</p><ol>\n<li>\n<p>MySQLåœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€åˆ†åŒºè¡¨çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®æ‰€æœ‰çš„åˆ†åŒºï¼›</p>\n</li>\n<li>\n<p>åœ¨serverå±‚ï¼Œè®¤ä¸ºè¿™æ˜¯åŒä¸€å¼ è¡¨ï¼Œå› æ­¤æ‰€æœ‰åˆ†åŒºå…±ç”¨åŒä¸€ä¸ªMDLé”ï¼›</p>\n</li>\n<li>\n<p>åœ¨å¼•æ“å±‚ï¼Œè®¤ä¸ºè¿™æ˜¯ä¸åŒçš„è¡¨ï¼Œå› æ­¤MDLé”ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ ¹æ®åˆ†åŒºè¡¨è§„åˆ™ï¼Œåªè®¿é—®å¿…è¦çš„åˆ†åŒºã€‚</p>\n</li>\n</ol><p>è€Œå…³äºâ€œå¿…è¦çš„åˆ†åŒºâ€çš„åˆ¤æ–­ï¼Œå°±æ˜¯æ ¹æ®SQLè¯­å¥ä¸­çš„whereæ¡ä»¶ï¼Œç»“åˆåˆ†åŒºè§„åˆ™æ¥å®ç°çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œwhere ftime='2018-4-1'ï¼Œæ ¹æ®åˆ†åŒºè§„åˆ™yearå‡½æ•°ç®—å‡ºæ¥çš„å€¼æ˜¯2018ï¼Œé‚£ä¹ˆå°±ä¼šè½åœ¨p_2019è¿™ä¸ªåˆ†åŒºã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªwhere æ¡ä»¶æ”¹æˆ where ftime&gt;='2018-4-1'ï¼Œè™½ç„¶æŸ¥è¯¢ç»“æœç›¸åŒï¼Œä½†æ˜¯è¿™æ—¶å€™æ ¹æ®whereæ¡ä»¶ï¼Œå°±è¦è®¿é—®p_2019å’Œp_othersè¿™ä¸¤ä¸ªåˆ†åŒºã€‚</p><p>å¦‚æœæŸ¥è¯¢è¯­å¥çš„whereæ¡ä»¶ä¸­æ²¡æœ‰åˆ†åŒºkeyï¼Œé‚£å°±åªèƒ½è®¿é—®æ‰€æœ‰åˆ†åŒºäº†ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯åˆ†åŒºè¡¨çš„é—®é¢˜ã€‚å³ä½¿æ˜¯ä½¿ç”¨ä¸šåŠ¡åˆ†è¡¨çš„æ–¹å¼ï¼Œwhereæ¡ä»¶ä¸­æ²¡æœ‰ä½¿ç”¨åˆ†è¡¨çš„keyï¼Œä¹Ÿå¿…é¡»è®¿é—®æ‰€æœ‰çš„åˆ†è¡¨ã€‚</p><p>æˆ‘ä»¬å·²ç»ç†è§£äº†åˆ†åŒºè¡¨çš„æ¦‚å¿µï¼Œé‚£ä¹ˆä»€ä¹ˆåœºæ™¯ä¸‹é€‚åˆä½¿ç”¨åˆ†åŒºè¡¨å‘¢ï¼Ÿ</p><h1>åˆ†åŒºè¡¨çš„åº”ç”¨åœºæ™¯</h1><p>åˆ†åŒºè¡¨çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„ä¼˜åŠ¿æ˜¯å¯¹ä¸šåŠ¡é€æ˜ï¼Œç›¸å¯¹äºç”¨æˆ·åˆ†è¡¨æ¥è¯´ï¼Œä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸šåŠ¡ä»£ç æ›´ç®€æ´ã€‚è¿˜æœ‰ï¼Œåˆ†åŒºè¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…ç†å†å²æ•°æ®ã€‚</p><p>å¦‚æœä¸€é¡¹ä¸šåŠ¡è·‘çš„æ—¶é—´è¶³å¤Ÿé•¿ï¼Œå¾€å¾€å°±ä¼šæœ‰æ ¹æ®æ—¶é—´åˆ é™¤å†å²æ•°æ®çš„éœ€æ±‚ã€‚è¿™æ—¶å€™ï¼ŒæŒ‰ç…§æ—¶é—´åˆ†åŒºçš„åˆ†åŒºè¡¨ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡alter table t drop partition ...è¿™ä¸ªè¯­æ³•åˆ æ‰åˆ†åŒºï¼Œä»è€Œåˆ æ‰è¿‡æœŸçš„å†å²æ•°æ®ã€‚</p><p>è¿™ä¸ªalter table t drop partition ...æ“ä½œæ˜¯ç›´æ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶ï¼Œæ•ˆæœè·Ÿdropæ™®é€šè¡¨ç±»ä¼¼ã€‚ä¸ä½¿ç”¨deleteè¯­å¥åˆ é™¤æ•°æ®ç›¸æ¯”ï¼Œä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«ã€å¯¹ç³»ç»Ÿå½±å“å°ã€‚</p><h1>å°ç»“</h1><p>è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¸»è¦å’Œä½ ä»‹ç»çš„æ˜¯serverå±‚å’Œå¼•æ“å±‚å¯¹åˆ†åŒºè¡¨çš„å¤„ç†æ–¹å¼ã€‚æˆ‘å¸Œæœ›é€šè¿‡è¿™äº›ä»‹ç»ï¼Œä½ èƒ½å¤Ÿå¯¹æ˜¯å¦é€‰æ‹©ä½¿ç”¨åˆ†åŒºè¡¨ï¼Œæœ‰æ›´æ¸…æ™°çš„æƒ³æ³•ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘æ˜¯ä»¥èŒƒå›´åˆ†åŒºï¼ˆrangeï¼‰ä¸ºä¾‹å’Œä½ ä»‹ç»çš„ã€‚å®é™…ä¸Šï¼ŒMySQLè¿˜æ”¯æŒhashåˆ†åŒºã€liståˆ†åŒºç­‰åˆ†åŒºæ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå†ç¿»ç¿»<a href=\"https://dev.mysql.com/doc/refman/8.0/en/partitioning-types.html\">æ‰‹å†Œ</a>ã€‚</p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œåˆ†åŒºè¡¨è·Ÿç”¨æˆ·åˆ†è¡¨æ¯”èµ·æ¥ï¼Œæœ‰ä¸¤ä¸ªç»•ä¸å¼€çš„é—®é¢˜ï¼šä¸€ä¸ªæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™éœ€è¦è®¿é—®æ‰€æœ‰åˆ†åŒºï¼Œå¦ä¸€ä¸ªæ˜¯å…±ç”¨MDLé”ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœè¦ä½¿ç”¨åˆ†åŒºè¡¨ï¼Œå°±ä¸è¦åˆ›å»ºå¤ªå¤šçš„åˆ†åŒºã€‚æˆ‘è§è¿‡ä¸€ä¸ªç”¨æˆ·åšäº†æŒ‰å¤©åˆ†åŒºç­–ç•¥ï¼Œç„¶åé¢„å…ˆåˆ›å»ºäº†10å¹´çš„åˆ†åŒºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè®¿é—®åˆ†åŒºè¡¨çš„æ€§èƒ½è‡ªç„¶æ˜¯ä¸å¥½çš„ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼š</p><ol>\n<li>\n<p>åˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½ã€‚å®é™…ä¸Šï¼Œå•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œï¼Œåªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•ï¼Œå¯¹äºç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨äº†ã€‚</p>\n</li>\n<li>\n<p>åˆ†åŒºä¹Ÿä¸è¦æå‰é¢„ç•™å¤ªå¤šï¼Œåœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåˆ›å»ºå³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯æŒ‰æœˆåˆ†åŒºï¼Œæ¯å¹´å¹´åº•æ—¶å†æŠŠä¸‹ä¸€å¹´åº¦çš„12ä¸ªæ–°åˆ†åŒºåˆ›å»ºä¸Šå³å¯ã€‚å¯¹äºæ²¡æœ‰æ•°æ®çš„å†å²åˆ†åŒºï¼Œè¦åŠæ—¶çš„dropæ‰ã€‚</p>\n</li>\n</ol><p>è‡³äºåˆ†åŒºè¡¨çš„å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚æŸ¥è¯¢éœ€è¦è·¨å¤šä¸ªåˆ†åŒºå–æ•°æ®ï¼ŒæŸ¥è¯¢æ€§èƒ½å°±ä¼šæ¯”è¾ƒæ…¢ï¼ŒåŸºæœ¬ä¸Šå°±ä¸æ˜¯åˆ†åŒºè¡¨æœ¬èº«çš„é—®é¢˜ï¼Œè€Œæ˜¯æ•°æ®é‡çš„é—®é¢˜æˆ–è€…è¯´æ˜¯ä½¿ç”¨æ–¹å¼çš„é—®é¢˜äº†ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ çš„å›¢é˜Ÿå·²ç»ç»´æŠ¤äº†æˆç†Ÿçš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Œç”¨ä¸šåŠ¡åˆ†è¡¨ï¼Œå¯¹ä¸šåŠ¡å¼€å‘åŒå­¦æ²¡æœ‰é¢å¤–çš„å¤æ‚æ€§ï¼Œå¯¹DBAä¹Ÿæ›´ç›´è§‚ï¼Œè‡ªç„¶æ˜¯æ›´å¥½çš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¾‹çš„è¡¨ä¸­æ²¡æœ‰ç”¨åˆ°è‡ªå¢ä¸»é”®ï¼Œå‡è®¾ç°åœ¨è¦åˆ›å»ºä¸€ä¸ªè‡ªå¢å­—æ®µidã€‚MySQLè¦æ±‚åˆ†åŒºè¡¨ä¸­çš„ä¸»é”®å¿…é¡»åŒ…å«åˆ†åŒºå­—æ®µã€‚å¦‚æœè¦åœ¨è¡¨tçš„åŸºç¡€ä¸Šåšä¿®æ”¹ï¼Œä½ ä¼šæ€ä¹ˆå®šä¹‰è¿™ä¸ªè¡¨çš„ä¸»é”®å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆå®šä¹‰å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç»“è®ºå’Œåˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸Šç¯‡æ–‡ç« åé¢è¿˜ä¸å¤Ÿå¤šï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦è¿˜æ²¡æ¥è®°å¾—çœ‹å§ï¼Œæˆ‘ä»¬å°±ç­‰åç»­æœ‰æ›´å¤šç•™è¨€çš„æ—¶å€™ï¼Œå†è¡¥å……æœ¬æœŸçš„â€œä¸ŠæœŸé—®é¢˜æ—¶é—´â€å§ã€‚</p><p>@å¤¹å¿ƒé¢åŒ… æåˆ°äº†åœ¨grantçš„æ—¶å€™æ˜¯æ”¯æŒé€šé…ç¬¦çš„ï¼š\"_\"è¡¨ç¤ºä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œâ€œ%â€è¡¨ç¤ºä»»æ„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªæŠ€å·§åœ¨ä¸€ä¸ªåˆ†åº“åˆ†è¡¨æ–¹æ¡ˆé‡Œé¢ï¼ŒåŒä¸€ä¸ªåˆ†åº“ä¸Šæœ‰å¤šä¸ªdbçš„æ—¶å€™ï¼Œæ˜¯æŒºæ–¹ä¾¿çš„ã€‚ä¸è¿‡æˆ‘ä¸ªäººè®¤ä¸ºï¼Œæƒé™èµ‹å€¼çš„æ—¶å€™ï¼Œæ§åˆ¶çš„ç²¾ç¡®æ€§è¿˜æ˜¯è¦ä¼˜å…ˆè€ƒè™‘çš„ã€‚</p>","comments":[{"had_liked":false,"id":69011,"user_name":"å¤¹å¿ƒé¢åŒ…","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":true,"comment_ctime":1550644924,"is_pvip":false,"replies":[{"id":"24484","content":"ğŸ‘  éå¸¸å¥½<br>","user_name":"ä½œè€…å›å¤","comment_id":69011,"uid":"1264162","ip_address":"","utype":1,"ctime":1550651492,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"9.2233723046933996e+18","product_id":100020801,"comment_content":"æˆ‘è¯´ä¸‹æˆ‘çš„æ„Ÿæƒ³<br>1 ç»å…¸çš„åˆ©ç”¨åˆ†åŒºè¡¨çš„åœºæ™¯<br>    1 zabbixå†å²æ•°æ®è¡¨çš„æ”¹é€ ,åˆ©ç”¨å­˜å‚¨è¿‡ç¨‹åˆ›å»ºå’Œæ”¹é€ <br>    2 åå°æ•°æ®çš„åˆ†ææ±‡æ€»,æ¯”å¦‚æ—¥å¿—æ•°æ®,ä¾¿äºæ¸…ç†<br>è¿™ä¸¤ç§åœºæ™¯æˆ‘ä»¬éƒ½åœ¨æ‰§è¡Œ,æˆ‘ä»¬å¯¹äºåˆ†åŒºè¡¨åœ¨ä¸šåŠ¡é‡‡ç”¨çš„æ˜¯hash ç”¨æˆ·IDæ–¹å¼,ä¸è¿‡å¤§è§„æ¨¡åº”ç”¨åˆ†åŒºè¡¨çš„å…¬å¸æˆ‘è¿˜æ²¡é‡åˆ°è¿‡<br>2 åˆ†åŒºè¡¨éœ€è¦æ³¨æ„çš„å‡ ç‚¹<br>æ€»ç»“ä¸‹<br>1 ç”±äºåˆ†åŒºè¡¨éƒ½å¾ˆå¤§,DDLè€—æ—¶æ˜¯éå¸¸ä¸¥é‡çš„,å¿…é¡»è€ƒè™‘è¿™ä¸ªé—®é¢˜<br>2 åˆ†åŒºè¡¨ä¸èƒ½å»ºç«‹å¤ªå¤šçš„åˆ†åŒº,æˆ‘æ›¾è¢«åˆ†äº«ä¸€ä¸ªå› ä¸ºåˆ†åŒºè¡¨åˆ†åŒºè¿‡å¤šå¯¼è‡´çš„ä¸»ä»å»¶è¿Ÿé—®é¢˜<br>3 åˆ†åŒºè¡¨çš„è§„åˆ™å’Œåˆ†åŒºéœ€è¦é¢„å…ˆè®¾ç½®å¥½,å¦åˆ™åæ¥è¿›è¡Œä¿®æ”¹ä¹Ÿå¾ˆéº»çƒ¦<br>","like_count":63,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439912,"discussion_content":"ğŸ‘  éå¸¸å¥½\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550651492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069127,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/47/46da4585.jpg","nickname":"Fan()","note":"","ucode":"FED79EC7D78E91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309439,"discussion_content":"é‚“æ€»ç‰›é€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601290382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122180,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1565313455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"267853285807","product_id":100020801,"comment_content":"1ï¼šå•¥æ˜¯åˆ†åŒºè¡¨ï¼Ÿ<br>åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œä½¿ç”¨äº†æ•°æ®åˆ†åŒºç›¸å…³çš„è¯­æ³•ï¼Œå­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“ä¼šæ ¹æ®åˆ†åŒºè§„åˆ™å°†ä¸åŒçš„æ•°æ®å­˜å…¥ä¸åŒçš„åˆ†åŒºæ–‡ä»¶ã€‚<br>2ï¼šä½¿ç”¨åˆ†åŒºè¡¨çš„åŠ£åŠ¿ï¼Ÿ<br>2-1ï¼šMySQL åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€åˆ†åŒºè¡¨çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®æ‰€æœ‰çš„åˆ†åŒºâ€”â€”æ‰“å¼€çš„è¡¨è¾ƒå¤šï¼Œæ€§èƒ½ç³Ÿç³•ä¹Ÿå¯èƒ½æŠ¥æ‰“å¼€çš„è¡¨è¶…è¿‡è®¾ç½®çš„é—®é¢˜ã€‚<br>2-2ï¼šåœ¨ server å±‚ï¼Œè®¤ä¸ºè¿™æ˜¯åŒä¸€å¼ è¡¨ï¼Œå› æ­¤æ‰€æœ‰åˆ†åŒºå…±ç”¨åŒä¸€ä¸ª MDL é”â€”â€”é”ç²’åº¦å¤§ï¼Œå½±å“å¹¶å‘åº¦ï¼Œç«™åœ¨Serverçœ‹ä¹Ÿæ˜¯åˆç†çš„ï¼Œä¸è¿‡ç«™åœ¨å­˜å‚¨å¼•æ“çš„è§’åº¦çœ‹å°±ä¸åˆç†äº†ã€‚<br>2-3ï¼šåœ¨å¼•æ“å±‚ï¼Œè®¤ä¸ºè¿™æ˜¯ä¸åŒçš„è¡¨ï¼Œå› æ­¤ MDL é”ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ ¹æ®åˆ†åŒºè¡¨è§„åˆ™ï¼Œåªè®¿é—®å¿…è¦çš„åˆ†åŒºâ€”â€”è¢«è®¿é—®åˆ°çš„åˆ†åŒºã€‚<br>3ï¼šä½¿ç”¨åˆ†åŒºè¡¨çš„ä¼˜åŠ¿ï¼Ÿ<br>åˆ†åŒºè¡¨çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„ä¼˜åŠ¿æ˜¯å¯¹ä¸šåŠ¡é€æ˜ï¼Œç›¸å¯¹äºç”¨æˆ·åˆ†è¡¨æ¥è¯´ï¼Œä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸šåŠ¡ä»£ç æ›´ç®€æ´ã€‚è¿˜æœ‰ï¼Œåˆ†åŒºè¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…ç†å†å²æ•°æ®ã€‚<br>4ï¼šå•¥æ—¶å€™é€‚åˆä½¿ç”¨åˆ†åŒºè¡¨ï¼Ÿ<br>å•è¡¨è¿‡å¤§æ—¶ï¼Œä½¿ç”¨æ—¶æ³¨æ„ä¸€ä¸‹ä¸¤ç‚¹<br>4-1ï¼šåˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½ã€‚å®é™…ä¸Šï¼Œå•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œï¼Œåªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•ï¼Œå¯¹äºç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨äº†ã€‚<br>4-2ï¼šåˆ†åŒºä¹Ÿä¸è¦æå‰é¢„ç•™å¤ªå¤šï¼Œåœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåˆ›å»ºå³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯æŒ‰æœˆåˆ†åŒºï¼Œæ¯å¹´å¹´åº•æ—¶å†æŠŠä¸‹ä¸€å¹´åº¦çš„ 12 ä¸ªæ–°åˆ†åŒºåˆ›å»ºä¸Šå³å¯ã€‚å¯¹äºæ²¡æœ‰æ•°æ®çš„å†å²åˆ†åŒºï¼Œè¦åŠæ—¶çš„ drop æ‰ã€‚<br>5ï¼šä½¿ç”¨åˆ†åŒºè¡¨ï¼Œæœ‰å…¶ç‰¹ç‚¹çš„æ ¹æœ¬åŸå› ï¼Ÿ<br>å¯¹äºServerå±‚ï¼Œåˆ†åŒºè¡¨è¿˜æ˜¯ä¸€ä¸ªè¡¨<br>å¯¹äºå­˜å‚¨å¼•æ“å±‚ï¼Œåˆ†åŒºè¡¨ä¼šæ˜¯å¤šå¼ è¡¨","like_count":63},{"had_liked":false,"id":69381,"user_name":"aliang","can_delete":false,"product_type":"c1","uid":1149502,"ip_address":"","ucode":"B36B94B362477F","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/3e/30c05bce.jpg","comment_is_top":false,"comment_ctime":1550731637,"is_pvip":true,"replies":[{"id":"24677","content":"å¥½é—®é¢˜ã€‚<br><br>åœ¨InnoDBå¼•æ“æ‰“å¼€æ–‡ä»¶è¶…è¿‡ innodb_open_filesè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œå°±ä¼šå…³æ‰ä¸€äº›ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶ã€‚<br><br>å…¶å®æˆ‘ä»¬æ–‡ç« ä¸­ ï¼ŒInnoDBåˆ†åŒºè¡¨ä½¿ç”¨äº†æœ¬åœ°åˆ†åŒºç­–ç•¥ä»¥åï¼Œå³ä½¿åˆ†åŒºä¸ªæ•°å¤§äºopen_files_limit ï¼Œæ‰“å¼€InnoDBåˆ†åŒºè¡¨ä¹Ÿä¸ä¼šæŠ¥â€œæ‰“å¼€æ–‡ä»¶è¿‡å¤šâ€è¿™ä¸ªé”™è¯¯ï¼Œå°±æ˜¯innodb_open_filesè¿™ä¸ªå‚æ•°å‘æŒ¥çš„ä½œç”¨ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":69381,"uid":"1264162","ip_address":"","utype":1,"ctime":1550755278,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":3,"race_medal":0,"score":"263543736693","product_id":100020801,"comment_content":"è€å¸ˆï¼Œmysqlè¿˜æœ‰ä¸€ä¸ªå‚æ•°æ˜¯innodb_open_filesï¼Œèµ„æ–™ä¸Šè¯´ä½œç”¨æ˜¯é™åˆ¶Innodbèƒ½æ‰“å¼€çš„è¡¨çš„æ•°é‡ã€‚å®ƒå’Œopen_files_limitä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿ","like_count":62,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440090,"discussion_content":"å¥½é—®é¢˜ã€‚\n\nåœ¨InnoDBå¼•æ“æ‰“å¼€æ–‡ä»¶è¶…è¿‡ innodb_open_filesè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œå°±ä¼šå…³æ‰ä¸€äº›ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶ã€‚\n\nå…¶å®æˆ‘ä»¬æ–‡ç« ä¸­ ï¼ŒInnoDBåˆ†åŒºè¡¨ä½¿ç”¨äº†æœ¬åœ°åˆ†åŒºç­–ç•¥ä»¥åï¼Œå³ä½¿åˆ†åŒºä¸ªæ•°å¤§äºopen_files_limit ï¼Œæ‰“å¼€InnoDBåˆ†åŒºè¡¨ä¹Ÿä¸ä¼šæŠ¥â€œæ‰“å¼€æ–‡ä»¶è¿‡å¤šâ€è¿™ä¸ªé”™è¯¯ï¼Œå°±æ˜¯innodb_open_filesè¿™ä¸ªå‚æ•°å‘æŒ¥çš„ä½œç”¨ã€‚\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1550755278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1180501,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/55/fc9f7170.jpg","nickname":"Fisheart","note":"","ucode":"207201926104D9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579161,"discussion_content":"innodb_open_files  vs open_files_limit ã€‚\næ„Ÿè§‰ä¸€ä¸ªæ˜¯innodbå¼•æ“çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯mysql Serverå±‚çš„å‚æ•°ã€‚ ä¸€èˆ¬å‰ä¸€ä¸ªå‚æ•°è®¾ç½®çš„è¦æ¯”åä¸€ä¸ªå¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657208168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136814,"discussion_content":"MySQL 5.7.12 åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œinnodb_open_files=300ï¼Œopen_files_limit=6209ï¼Œâ€œåœ¨InnoDBå¼•æ“æ‰“å¼€æ–‡ä»¶è¶…è¿‡ innodb_open_filesè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œå°±ä¼šå…³æ‰ä¸€äº›ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶ã€‚â€ è¿™å¥è¯è¿™ä¹ˆè¯´çš„è¯open_files_limit=6209æ˜¯ä¸æ˜¯å°±æ²¡ç”¨äº†ï¼Ÿå°±åªèƒ½åŒæ—¶å¼€300ä¸ªè¡¨äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579165900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69431,"user_name":"ä¸‡å‹‡","can_delete":false,"product_type":"c1","uid":1309092,"ip_address":"","ucode":"BC9E0918DF4516","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/a4/f0b92135.jpg","comment_is_top":false,"comment_ctime":1550742107,"is_pvip":false,"replies":[{"id":"24676","content":"ä»…ä»…çœ‹æ€§èƒ½ï¼Œæ˜¯æ²¡ä»€ä¹ˆå·®åˆ«çš„<br><br>ä½†æ˜¯å»ºè®®å°½é‡ä¸è¦åŠ after column_nameï¼Œ<br>ä¹Ÿå°±æ˜¯è¯´å°½é‡åŠ åˆ°æœ€åä¸€åˆ—ã€‚<br><br>å› ä¸ºå…¶å®æ²¡å·®åˆ«ï¼Œä½†æ˜¯åŠ åœ¨æœ€åæœ‰ä»¥ä¸‹ä¸¤ä¸ªå¥½å¤„ï¼š<br>1. å¼€å§‹æœ‰ä¸€äº›åˆ†æ”¯æ”¯æŒå¿«é€ŸåŠ åˆ—ï¼Œå°±æ˜¯è¯´å¦‚æœä½ åŠ åœ¨æœ€åä¸€åˆ—ï¼Œæ˜¯ç¬é—´å°±èƒ½å®Œæˆï¼Œè€ŒåŠ äº†after column_nameï¼Œå°±ç”¨ä¸ä¸Šè¿™äº›ä¼˜åŒ–ï¼ˆä»¥åæ½œåœ¨çš„å¥½å¤„ï¼‰<br><br>2. æˆ‘ä»¬åœ¨å‰é¢çš„æ–‡ç« æœ‰æåˆ°è¿‡ï¼Œå¦‚æœæ€•å¯¹çº¿ä¸Šä¸šåŠ¡é€ æˆå½±å“ï¼Œæœ‰æ—¶å€™æ˜¯é€šè¿‡â€œå…ˆåšå¤‡åº“ã€åˆ‡æ¢ã€å†åšå¤‡åº“â€è¿™ç§æ–¹å¼æ¥æ‰§è¡Œddlçš„ï¼Œé‚£ä¹ˆä½¿ç”¨after column_nameçš„æ—¶å€™ç”¨ä¸ä¸Šè¿™ç§æ–¹å¼ã€‚<br><br>å®é™…ä¸Šåˆ—çš„æ•°æ®æ˜¯ä¸åº”è¯¥æœ‰å½±å“çš„ï¼Œè¿˜æ˜¯è¦å½¢æˆå¥½ä¹ æƒ¯ğŸ˜†","user_name":"ä½œè€…å›å¤","comment_id":69431,"uid":"1264162","ip_address":"","utype":1,"ctime":1550755154,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":4,"race_medal":0,"score":"134694728283","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®add column after column_nameè·Ÿadd columnä¸æŒ‡å®šä½ç½®ï¼Œè¿™ä¸¤ç§æ€§èƒ½ä¸Šæœ‰åŒºåˆ«å—ï¼Ÿæˆ‘ä»¬åœ¨add column æŒ‡å®šafter column_nameçš„æƒ…å†µå¾ˆå¤šã€‚","like_count":32,"discussions":[{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7927,"discussion_content":"æ²¡å¤ªç†è§£ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ after column_name åˆ™ç”¨ä¸ä¸Š â€œå…ˆåšå¤‡åº“ï¼Œåˆ‡æ¢ï¼Œå†åšå¤‡åº“â€ è¿™ç§æ–¹å¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1567732426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033578,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c5/6a/7f858f1f.jpg","nickname":"ç™½ä¸åƒ","note":"","ucode":"F019914D8819C2","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381941,"discussion_content":"æˆ‘è·Ÿä½ æœ‰åŒæ ·çš„ç–‘é—®ï¼Œåšå¤‡åº“ï¼Œåœ¨å¤‡åº“æ‰§è¡Œafter column_name ä¸è¡Œä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625310152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7927,"ip_address":""},"score":381941,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440119,"discussion_content":"ä»…ä»…çœ‹æ€§èƒ½ï¼Œæ˜¯æ²¡ä»€ä¹ˆå·®åˆ«çš„\n\nä½†æ˜¯å»ºè®®å°½é‡ä¸è¦åŠ after column_nameï¼Œ\nä¹Ÿå°±æ˜¯è¯´å°½é‡åŠ åˆ°æœ€åä¸€åˆ—ã€‚\n\nå› ä¸ºå…¶å®æ²¡å·®åˆ«ï¼Œä½†æ˜¯åŠ åœ¨æœ€åæœ‰ä»¥ä¸‹ä¸¤ä¸ªå¥½å¤„ï¼š\n1. å¼€å§‹æœ‰ä¸€äº›åˆ†æ”¯æ”¯æŒå¿«é€ŸåŠ åˆ—ï¼Œå°±æ˜¯è¯´å¦‚æœä½ åŠ åœ¨æœ€åä¸€åˆ—ï¼Œæ˜¯ç¬é—´å°±èƒ½å®Œæˆï¼Œè€ŒåŠ äº†after column_nameï¼Œå°±ç”¨ä¸ä¸Šè¿™äº›ä¼˜åŒ–ï¼ˆä»¥åæ½œåœ¨çš„å¥½å¤„ï¼‰\n\n2. æˆ‘ä»¬åœ¨å‰é¢çš„æ–‡ç« æœ‰æåˆ°è¿‡ï¼Œå¦‚æœæ€•å¯¹çº¿ä¸Šä¸šåŠ¡é€ æˆå½±å“ï¼Œæœ‰æ—¶å€™æ˜¯é€šè¿‡â€œå…ˆåšå¤‡åº“ã€åˆ‡æ¢ã€å†åšå¤‡åº“â€è¿™ç§æ–¹å¼æ¥æ‰§è¡Œddlçš„ï¼Œé‚£ä¹ˆä½¿ç”¨after column_nameçš„æ—¶å€™ç”¨ä¸ä¸Šè¿™ç§æ–¹å¼ã€‚\n\nå®é™…ä¸Šåˆ—çš„æ•°æ®æ˜¯ä¸åº”è¯¥æœ‰å½±å“çš„ï¼Œè¿˜æ˜¯è¦å½¢æˆå¥½ä¹ æƒ¯ğŸ˜†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1550755154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3046032,"avatar":"","nickname":"Geek_2969df","note":"","ucode":"E953E199B4FD03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588879,"discussion_content":"ä¸‡å‹‡ï¼Œæ˜¯ç‰©æµçš„çš„é‚£ä¸ªä¸‡å‹‡å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664191661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68896,"user_name":"éƒ­æ±Ÿä¼Ÿ","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1550626615,"is_pvip":false,"replies":[{"id":"24993","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":68896,"uid":"1264162","ip_address":"","utype":1,"ctime":1550997915,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":6,"race_medal":0,"score":"108924809015","product_id":100020801,"comment_content":"æ­¤æ—¶ä¸»é”®åŒ…å«è‡ªå¢åˆ—+åˆ†åŒºé”®ï¼ŒåŸå› ä¸ºå¯¹innodbæ¥è¯´åˆ†åŒºç­‰äºå•ç‹¬çš„è¡¨ï¼Œè‡ªå¢å­—æ®µæ¯ä¸ªåˆ†åŒºå¯ä»¥æ’å…¥ç›¸åŒçš„å€¼ï¼Œå¦‚æœä¸»é”®åªæœ‰è‡ªå¢åˆ—æ— æ³•å®Œå…¨ä¿è¯å”¯ä¸€æ€§ã€‚<br>æµ‹è¯•è¡¨å¦‚ä¸‹ï¼š<br>mysql&gt; show create table t\\G<br>       Table: t<br>Create Table: CREATE TABLE `t` (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `ftime` datetime NOT NULL,<br>  `c` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`,`ftime`),<br>  KEY `ftime` (`ftime`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4<br>&#47;*!50100 PARTITION BY RANGE (YEAR(ftime))<br>(PARTITION p_2017 VALUES LESS THAN (2017) ENGINE = InnoDB,<br> PARTITION p_2018 VALUES LESS THAN (2018) ENGINE = InnoDB,<br> PARTITION p_2019 VALUES LESS THAN (2019) ENGINE = InnoDB,<br> PARTITION p_others VALUES LESS THAN MAXVALUE ENGINE = InnoDB) *&#47;<br>1 row in set (0.00 sec)<br>mysql&gt; insert into t values(1,&#39;2017-4-1&#39;,1),(1,&#39;2018-4-1&#39;,1);<br>Query OK, 2 rows affected (0.02 sec)<br>mysql&gt; select * from t;<br>+----+---------------------+------+<br>| id | ftime               | c    |<br>+----+---------------------+------+<br>|  1 | 2017-04-01 00:00:00 |    1 |<br>|  1 | 2018-04-01 00:00:00 |    1 |<br>+----+---------------------+------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; insert into t values(null,&#39;2017-5-1&#39;,1),(null,&#39;2018-5-1&#39;,1);<br>Query OK, 2 rows affected (0.02 sec)<br><br>mysql&gt; select * from t;<br>+----+---------------------+------+<br>| id | ftime               | c    |<br>+----+---------------------+------+<br>|  1 | 2017-04-01 00:00:00 |    1 |<br>|  2 | 2017-05-01 00:00:00 |    1 |<br>|  1 | 2018-04-01 00:00:00 |    1 |<br>|  3 | 2018-05-01 00:00:00 |    1 |<br>+----+---------------------+------+<br>4 rows in set (0.00 sec)","like_count":26,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439863,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550997915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362601,"discussion_content":"å°†ftimeè®¾ç½®ä¸ºç´¢å¼•ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ä¸æ˜¯å¯ä»¥å°‘å»ºä¸€ä¸ªç´¢å¼•ï¼Ÿ\nè‡ªå¢åˆ—è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ä¸æ˜¯èƒ½å‡å°‘ç´¢å¼•åˆ†è£‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616989969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006735,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","nickname":"å°å¯","note":"","ucode":"8834AF621FA67D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537630,"discussion_content":"â‘ ALTER TABLE `p`\nADD COLUMN `id`  int NULL AUTO_INCREMENT FIRST ;\nåªåŠ idè‡ªå¢åˆ—ï¼Œæ‰§è¡ŒæŠ¥é”™ï¼Œæç¤ºè‡ªå¢åˆ—åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸”å¿…é¡»ç´¢å¼•åˆ—\nIncorrect table definition; there can be only one auto column and it must be defined as a keyï¼›\nâ‘¡ALTER TABLE `p`\nADD COLUMN `id`  int NOT NULL AUTO_INCREMENT FIRST ,\nADD PRIMARY KEY (`id`);\nidè‡ªå¢åŠ keyï¼Œæ‰§è¡ŒæŠ¥é”™ï¼Œæç¤ºä¸»é”®å¿…é¡»åŒ…å«æ‰€æœ‰åˆ†åŒºå‡½æ•°ä½¿ç”¨åˆ—\nA PRIMARY KEY must include all columns in the tableâ€™s partitioning function\nâ‘¢ALTER TABLE `p`\nADD COLUMN `id`  int NOT NULL AUTO_INCREMENT FIRST ,\nADD PRIMARY KEY (`id`, `ftime`);\nidè‡ªå¢ï¼Œid+ftimeè”åˆä¸»é”®ï¼Œæ‰§è¡ŒæˆåŠŸ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639124983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203576,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/78/f011d586.jpg","nickname":"é‡è§é˜³å…‰","note":"","ucode":"378E5D37B3CD0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396788,"discussion_content":"å”¯ä¸€çš„è§£é‡Šåªèƒ½æ˜¯serverå±‚è®¤ä¸ºæ˜¯ä¸€ä¸ªè¡¨ã€‚æ‰€ä»¥å¿…é¡»å­˜åœ¨å”¯ä¸€å»º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632493382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2116363,"avatar":"https://static001.geekbang.org/account/avatar/00/20/4b/0b/3f1e9054.jpg","nickname":"aben","note":"","ucode":"A04792E90AFCD9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385469,"discussion_content":"è‡ªå¢id, ä¸ºä»€ä¹ˆåœ¨æ’å…¥çš„æ—¶å€™è¦æŒ‡å®šå‘¢? ä¸æŒ‡å®šçš„è¯, å°±ä»ç„¶æ˜¯ä¸€ä¸ªè¡¨çš„è‡ªå¢, ä¸åˆ†åŒºæ— å…³.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627054016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"é•¿æœŸè§„åˆ’","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334955,"discussion_content":"è¿™ä¸ªå¾ˆå¥½è§£é‡Šäº†ä¸ºä½•MySQLè¦æ±‚å”¯ä¸€é”®ä¸­å¿…é¡»åŒ…å«åˆ†åŒºé”®çš„åŸå› ã€‚ä¹‹å‰æˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸ºï¼Œä½†æ²¡åŠ¨æ‰‹å®è·µè¿‡ã€‚èµğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608035628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70356,"user_name":"â˜","can_delete":false,"product_type":"c1","uid":1302793,"ip_address":"","ucode":"6FAEF05F234D2A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/09/9483f537.jpg","comment_is_top":false,"comment_ctime":1551083720,"is_pvip":false,"replies":[{"id":"25102","content":"ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œè¦æ‰“å¼€æ‰€æœ‰åˆ†åŒºçš„<br><br>","user_name":"ä½œè€…å›å¤","comment_id":70356,"uid":"1264162","ip_address":"","utype":1,"ctime":1551092396,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"83155462344","product_id":100020801,"comment_content":"è€å¸ˆç¡®è®¤ä¸‹ï¼Œ5.7.9ä¹‹åçš„innodbåˆ†åŒºè¡¨ï¼Œæ˜¯è®¿é—®ç¬¬ä¸€ä¸ªè¡¨æ—¶ä¸ä¼šå»æ‰“å¼€æ‰€æœ‰çš„åˆ†åŒºè¡¨äº†å—ï¼Ÿ","like_count":20,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440582,"discussion_content":"ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œè¦æ‰“å¼€æ‰€æœ‰åˆ†åŒºçš„\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551092396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161271,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","nickname":"ä¸ä¼¼æ—§æ—¥","note":"","ucode":"DF4C5E3AB9570C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384105,"discussion_content":"ä¸ºä»€ä¹ˆè¦æ‰“å¼€æ‰€æœ‰åˆ†åŒº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626363724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68852,"user_name":"wljs","can_delete":false,"product_type":"c1","uid":1306543,"ip_address":"","ucode":"6B88A664972AD2","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/af/ba786593.jpg","comment_is_top":false,"comment_ctime":1550623731,"is_pvip":false,"replies":[{"id":"24443","content":"ç”¨viewå¯èƒ½å¯ä»¥å®ç°éƒ¨åˆ†ä½ çš„éœ€æ±‚ï¼Œä½†æ˜¯å¼ºçƒˆä¸å»ºè®®è¿™ä¹ˆåšã€‚<br>ä¸šåŠ¡ä¸æƒ³ä¿®æ”¹ï¼Œå°±å¥½å¥½è·Ÿä»–ä»¬è¯´ï¼Œæ¯•ç«Ÿè¿™æ ·åˆ†ï¼ˆå¸¸æŸ¥å’Œä¸å¸¸æŸ¥çš„å‚ç›´æ‹†åˆ†ï¼‰æ˜¯åˆç†çš„ï¼Œå¯¹è¯»å†™æ€§èƒ½éƒ½æœ‰æ˜æ˜¾çš„æå‡çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":68852,"uid":"1264162","ip_address":"","utype":1,"ctime":1550625367,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":3,"race_medal":0,"score":"65975133171","product_id":100020801,"comment_content":"<br>è€å¸ˆæˆ‘æƒ³é—®ä¸ªé—®é¢˜ æˆ‘ä»¬å…¬å¸ä¸€ä¸ªè®¢å•è¡¨æœ‰110ä¸ªå­—æ®µ æƒ³æ‹†åˆ†æˆä¸¤ä¸ªè¡¨ ç¬¬ä¸€ä¸ªè¡¨æ”¾ç»å¸¸æŸ¥çš„å­—æ®µ ç¬¬äºŒä¸ªè¡¨æ”¾ä¸å¸¸æŸ¥çš„ ç°åœ¨ç¨‹åºç«¯ä¸æƒ³æ”¹sqlï¼Œæ•°æ®åº“ç«¯æ¥å®ç° å½“æŸ¥è¯¢å­—æ®µä¸­ ç¬¬ä¸€ä¸ªè¡¨ä¸å­˜åœ¨ å°±å»å…³è”ç¬¬äºŒä¸ªè¡¨æŸ¥å‡ºæ•°æ®  dbèƒ½å®ç°ä¸","like_count":16,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439853,"discussion_content":"ç”¨viewå¯èƒ½å¯ä»¥å®ç°éƒ¨åˆ†ä½ çš„éœ€æ±‚ï¼Œä½†æ˜¯å¼ºçƒˆä¸å»ºè®®è¿™ä¹ˆåšã€‚\nä¸šåŠ¡ä¸æƒ³ä¿®æ”¹ï¼Œå°±å¥½å¥½è·Ÿä»–ä»¬è¯´ï¼Œæ¯•ç«Ÿè¿™æ ·åˆ†ï¼ˆå¸¸æŸ¥å’Œä¸å¸¸æŸ¥çš„å‚ç›´æ‹†åˆ†ï¼‰æ˜¯åˆç†çš„ï¼Œå¯¹è¯»å†™æ€§èƒ½éƒ½æœ‰æ˜æ˜¾çš„æå‡çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550625367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1333649,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg","nickname":"ä¸åƒè¾£ğŸ‘¾","note":"","ucode":"B25E0725B5E85F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387269,"discussion_content":"é«˜è´¨é‡ç•™è¨€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628078699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304383,"discussion_content":"å•è¡¨å­—æ®µå¤ªå¤šäº†ï¼Œæ‹†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599557606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69125,"user_name":"æƒæ’æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1090619,"ip_address":"","ucode":"2700E28092020D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a4/3b/a29c8eec.jpg","comment_is_top":false,"comment_ctime":1550666091,"is_pvip":false,"replies":[{"id":"24521","content":"å¯¹è¿™ç¯‡æ–‡ç« è®²çš„æ˜¯å•æœºä¸Šçš„å•è¡¨å¤šåˆ†åŒº","user_name":"ä½œè€…å›å¤","comment_id":69125,"uid":"1264162","ip_address":"","utype":1,"ctime":1550669307,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":5,"race_medal":0,"score":"53090273643","product_id":100020801,"comment_content":"è¿™ä¸ªåªé€‚åˆå•æœºå§ï¼Ÿé›†ç¾¤æ²¡æ³•å³ä½¿ç”¨innodbå¼•æ“ï¼Œåˆæ”¯æŒåˆ†åŒºè¡¨å§ï¼Œåªèƒ½ä½¿ç”¨ä¸­é—´ä»¶äº†ã€‚ä¹‹å‰è°ƒç ”äº†ä¸€ä¸‹ï¼Œå®˜æ–¹åªæœ‰ndb clusteræ‰æ”¯æŒåˆ†åŒºè¡¨ï¼Ÿ","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439963,"discussion_content":"å¯¹è¿™ç¯‡æ–‡ç« è®²çš„æ˜¯å•æœºä¸Šçš„å•è¡¨å¤šåˆ†åŒº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550669307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1729060,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/62/24/07e2507c.jpg","nickname":"æ‰˜å°¼æ–¯å¨ç‰¹","note":"","ucode":"98A1035527292E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306518,"discussion_content":"é›†ç¾¤ å¤ªæ¨¡ç³Šï¼Œä¸»ä»å¤åˆ¶çš„é›†ç¾¤è¿˜æ˜¯éœ€è¦åˆ†åŒºè¡¨çš„ã€‚åˆ†åº“åˆ†è¡¨é›†ç¾¤ï¼Œå°±å·²ç»æ‰‹åŠ¨åˆ†è¡¨äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600309693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"é•¿æœŸè§„åˆ’","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334959,"discussion_content":"çœ‹æ¥åˆ†åŒºè¡¨çš„æ€§èƒ½è¿˜æ˜¯å—é™äºå•æœºçš„IOï¼Œå†…å­˜å’ŒCPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608035923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237199,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e0/cf/43f201f2.jpg","nickname":"å¹¼å„¿ç¼–ç¨‹æ•™å­¦","note":"","ucode":"F13F3150E6CAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292879,"discussion_content":"éƒ½é›†ç¾¤äº†ï¼Œæ— æ‰€è°“åˆ†åŒºè¡¨äº†å§ï¼Ÿé›†ç¾¤å°±æ˜¯è§£å†³äº†ç£ç›˜ç©ºé—´å’Œæ€§èƒ½çš„é—®é¢˜å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595375221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1091556,"avatar":"https://static001.geekbang.org/account/avatar/00/10/a7/e4/5a4515e9.jpg","nickname":"æˆç«‹-Charlie","note":"","ucode":"2970BB5446B70A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209162,"discussion_content":"è€å¸ˆï¼ŒInnoDB clusterä¸æ”¯æŒåˆ†åŒºè¡¨å—ï¼Ÿ8.0ä¹Ÿä¸å¯ä»¥å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584615611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68904,"user_name":"åƒæœ¨","can_delete":false,"product_type":"c1","uid":1304605,"ip_address":"","ucode":"32EBF403E9088E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fJ5BEicRVnXAwCxkIYhJZ0woiaQ38ibUYkYH125bzL2Y2ib1YS9b7Q9S5qia2Cia9UWzUoDBGeWJibB7p9xSnib7iaU8kzw/132","comment_is_top":false,"comment_ctime":1550627182,"is_pvip":false,"replies":[{"id":"24468","content":"â€œæœ¬åœ°åˆ†åŒºè§„åˆ™åº”è¯¥æ˜¯åªæ‰“å¼€å•ä¸ªå¼•æ“æ–‡ä»¶â€ï¼Œå¹¶ä¸æ˜¯å“ˆï¼Œæˆ‘åœ¨æ–‡ç« æœ«å°¾è¯´äº†ï¼Œä¹Ÿä¼šæ‰“å¼€æ‰€æœ‰æ–‡ä»¶çš„ï¼Œåªæ˜¯è¯´æœ¬åœ°åˆ†åŒºè§„åˆ™æœ‰ä¼˜åŒ–ï¼Œæ¯”å¦‚å¦‚æœæ–‡ä»¶æ•°è¿‡å¤šï¼Œå°±ä¼šæ·˜æ±°ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼ˆæš‚æ—¶å…³æ‰ï¼‰ã€‚<br><br>æ‰€ä»¥åˆ†åŒºå¤ªå¤šï¼Œè¿˜æ˜¯ä¼šæœ‰å½±å“çš„<br>","user_name":"ä½œè€…å›å¤","comment_id":68904,"uid":"1264162","ip_address":"","utype":1,"ctime":1550640493,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"35910365550","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œä½ åœ¨æ–‡ç« é‡Œé¢æœ‰è¯´é€šç”¨åˆ†åŒºè§„åˆ™ä¼šæ‰“å¼€æ‰€æœ‰å¼•æ“æ–‡ä»¶å¯¼è‡´ä¸å¯ç”¨ï¼Œè€Œæœ¬åœ°åˆ†åŒºè§„åˆ™åº”è¯¥æ˜¯åªæ‰“å¼€å•ä¸ªå¼•æ“æ–‡ä»¶ï¼Œé‚£ä½ ä¸å»ºè®®åˆ›å»ºå¤ªå¤šåˆ†åŒºçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæ˜¯æœ¬åœ°åˆ†åŒºè§„åˆ™ï¼Œç…§ä¾‹è¯´æ˜¯ä¸ä¼šå½±å“çš„å§ï¼Œå¨æ‰°äº†","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439867,"discussion_content":"â€œæœ¬åœ°åˆ†åŒºè§„åˆ™åº”è¯¥æ˜¯åªæ‰“å¼€å•ä¸ªå¼•æ“æ–‡ä»¶â€ï¼Œå¹¶ä¸æ˜¯å“ˆï¼Œæˆ‘åœ¨æ–‡ç« æœ«å°¾è¯´äº†ï¼Œä¹Ÿä¼šæ‰“å¼€æ‰€æœ‰æ–‡ä»¶çš„ï¼Œåªæ˜¯è¯´æœ¬åœ°åˆ†åŒºè§„åˆ™æœ‰ä¼˜åŒ–ï¼Œæ¯”å¦‚å¦‚æœæ–‡ä»¶æ•°è¿‡å¤šï¼Œå°±ä¼šæ·˜æ±°ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼ˆæš‚æ—¶å…³æ‰ï¼‰ã€‚\n\næ‰€ä»¥åˆ†åŒºå¤ªå¤šï¼Œè¿˜æ˜¯ä¼šæœ‰å½±å“çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550640493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74062,"user_name":"æ€€åˆš","can_delete":false,"product_type":"c1","uid":1012839,"ip_address":"","ucode":"F778DDE910918E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/74/67/46bb05de.jpg","comment_is_top":false,"comment_ctime":1552096916,"is_pvip":false,"replies":[{"id":"27082","content":"1. å¯¹ï¼Œbinlogå¯¹åŸå› <br>2. å¦‚æœå»¶è¿Ÿç®—æŸå¤±ï¼Œç¡®å®æ˜¯æœ‰æŸçš„ã€‚å¤‡åº“ä¸Šçš„è¯»æµé‡è¦å…ˆåˆ‡æ¢åˆ°ä¸»åº“ï¼ˆä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨ä½å³°æœŸåšåšä¸ªæ“ä½œï¼‰","user_name":"ä½œè€…å›å¤","comment_id":74062,"uid":"1264162","ip_address":"","utype":1,"ctime":1552111011,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"31616867988","product_id":100020801,"comment_content":"è¯·æ•™ä¸‹é‡‡ç”¨â€å…ˆåšå¤‡åº“ã€åˆ‡æ¢ã€å†åšå¤‡åº“â€DDLæ–¹å¼ä¸æ”¯æŒAFTER COLUMNæ˜¯å› ä¸ºBINLOGåŸå› å—ï¼Ÿ<br>ä»¥ä¸ŠDDLæ–¹å¼ä¼šå­˜åœ¨å½±å“â€œæœ‰æŸâ€çš„å§ï¼Ÿâ€œæ— æŸâ€æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿå¦‚æœå¤‡åº“æ‰¿è½½è¯»è¯·æ±‚ä½†åˆä¸èƒ½æ¥å—â€œé•¿æ—¶é—´â€å»¶æ—¶","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442418,"discussion_content":"1. å¯¹ï¼Œbinlogå¯¹åŸå› \n2. å¦‚æœå»¶è¿Ÿç®—æŸå¤±ï¼Œç¡®å®æ˜¯æœ‰æŸçš„ã€‚å¤‡åº“ä¸Šçš„è¯»æµé‡è¦å…ˆåˆ‡æ¢åˆ°ä¸»åº“ï¼ˆä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨ä½å³°æœŸåšåšä¸ªæ“ä½œï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552111011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69141,"user_name":"Q","can_delete":false,"product_type":"c1","uid":1285997,"ip_address":"","ucode":"098731DD304590","user_header":"https://static001.geekbang.org/account/avatar/00/13/9f/6d/0a21fa84.jpg","comment_is_top":false,"comment_ctime":1550669125,"is_pvip":false,"replies":[{"id":"24558","content":"åº”è¯¥ç»Ÿä¸€æˆinnodb<br>ç½‘ä¸Šå•†åŸè´­ç‰©ç±»å‹æ›´è¦ç”¨InnoDBï¼Œå› ä¸ºMyISAMå¹¶ä¸æ˜¯crash-safeçš„ã€‚<br><br>æµ‹è¯•ç¯å¢ƒæ”¹å®Œå›å½’ä¸‹","user_name":"ä½œè€…å›å¤","comment_id":69141,"uid":"1264162","ip_address":"","utype":1,"ctime":1550679632,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"31615440197","product_id":100020801,"comment_content":"è€å¸ˆ è¯·é—®ä¸‹  ç½‘ç«™å¼€å‘æ•°æ®åº“è¡¨æ˜¯myisamå’Œinnodbæ··åˆå¼•æ“  è€ƒè™‘ç®¡ç†æ¯”è¾ƒéº»çƒ¦  æƒ³ç»Ÿä¸€æˆinnodb è¯·é—®æ˜¯å¦å½±å“æ•°æ®åº“æˆ–å¸¦æ¥ä»€ä¹ˆéšæ‚£å—ï¼Ÿ  ç½‘ç«™æ˜¯ç½‘ä¸Šå•†åŸè´­ç‰©ç±»å‹çš„","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439968,"discussion_content":"åº”è¯¥ç»Ÿä¸€æˆinnodb\nç½‘ä¸Šå•†åŸè´­ç‰©ç±»å‹æ›´è¦ç”¨InnoDBï¼Œå› ä¸ºMyISAMå¹¶ä¸æ˜¯crash-safeçš„ã€‚\n\næµ‹è¯•ç¯å¢ƒæ”¹å®Œå›å½’ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550679632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177209,"user_name":"zc","can_delete":false,"product_type":"c1","uid":1213495,"ip_address":"","ucode":"07900D4B6A3135","user_header":"https://static001.geekbang.org/account/avatar/00/12/84/37/a13d867a.jpg","comment_is_top":false,"comment_ctime":1581322754,"is_pvip":false,"replies":[{"id":"68820","content":"è¦åŠ  ä¸è¿‡å› ä¸ºæ—¶é—´å¾ˆçŸ­ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨æ“ä½œ","user_name":"ä½œè€…å›å¤","comment_id":177209,"uid":"1264162","ip_address":"","utype":1,"ctime":1581334444,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23056159234","product_id":100020801,"comment_content":"alter table t drop partition ä¸åŠ å…ƒæ•°æ®é”å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483345,"discussion_content":"è¦åŠ  ä¸è¿‡å› ä¸ºæ—¶é—´å¾ˆçŸ­ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨æ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581334444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70361,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1551085278,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23025921758","product_id":100020801,"comment_content":"é˜¿é‡Œäº‘çš„DRDSå°±æ˜¯åˆ†åº“åˆ†è¡¨çš„ä¸­é—´ä»¶å…¸å‹ä»£è¡¨ã€‚è‡ªå·±å®ç°äº†ä¸€ä¸ªå±‚Serverè®¿é—®å±‚åœ¨è¿™ä¸€å±‚è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼ˆå¯¹é€æ˜ï¼‰ï¼Œç„¶åMySQLåªæ˜¯ç›¸å½“äºå­˜å‚¨å±‚ã€‚ä¸€äº›Joinã€è´Ÿè½½Order by&#47;Group byéƒ½åœ¨DRDSä¸­é—´ä»¶è¿™å±‚å®Œæˆï¼Œç®€å•çš„é€»è¾‘æ’å™è®¡ç®—å®Œå¯¹åº”çš„åˆ†åº“åˆ†è¡¨åä¸‹æ¨ç»™MySQL https:&#47;&#47;www.aliyun.com&#47;product&#47;drds","like_count":6,"discussions":[{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339346,"discussion_content":"order by å’Œ group byçš„æ€§èƒ½ä¸æ•¢æ­ç»´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609642720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297153,"discussion_content":"ç”¨è¿‡ï¼Œä¸è¿‡æ˜¯18 19å¹´é‚£ä¼šè¿˜å‡ºäº†ä¸å°‘bugã€‚æ¯”å¦‚ç‰ˆæœ¬å‡çº§é€ æˆçš„è¿æ¥ä¸ç¨³å®šç­‰ã€‚è€Œä¸”æœ€å…³é”®çš„æ˜¯çœŸå¿ƒä¸ä¾¿å®œï¼Œå¦‚æœæŠ€æœ¯å›¢é˜Ÿå†…éƒ¨èƒ½æå®šï¼Œè¿˜æ˜¯è¦æ³¨æ„ä¸‹æ€§ä»·æ¯”çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596788735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69440,"user_name":"helloworld.xs","can_delete":false,"product_type":"c1","uid":1265652,"ip_address":"","ucode":"AE9CDD78FD5994","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MSV5CclX2Zct7U0F7bVwd0Zg4y6AK1qf8GVic5W3tCNaLhL6wTqD7CUnWxarW4DiaVbVic1G3gpZ3ud0ELWhuxnrg/132","comment_is_top":false,"comment_ctime":1550745455,"is_pvip":false,"replies":[{"id":"24675","content":"updateçš„è¯ï¼Œä¸»è¦åº”è¯¥ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ•°æ®éƒ½è¯»å…¥åˆ°äº†","user_name":"ä½œè€…å›å¤","comment_id":69440,"uid":"1264162","ip_address":"","utype":1,"ctime":1550754922,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23025581935","product_id":100020801,"comment_content":"è¯·æ•™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬mysqlä¼šæœ‰æŸ¥è¯¢ç¼“å­˜ï¼Œä½†æ˜¯updateæ“ä½œä¹Ÿæœ‰ç¼“å­˜æœºåˆ¶å—ï¼Ÿä½¿ç”¨mysql consoleç¬¬ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªupdate SQLè€—æ—¶æ˜æ˜¾æ¯”åé¢æ‰§è¡Œç›¸åŒupdate SQLè¦æ…¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440122,"discussion_content":"updateçš„è¯ï¼Œä¸»è¦åº”è¯¥ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ•°æ®éƒ½è¯»å…¥åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550754922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69033,"user_name":"å¸ƒè¡£éª‡å®¢","can_delete":false,"product_type":"c1","uid":1256280,"ip_address":"","ucode":"5226B0F67090D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/2b/58/11c05ccb.jpg","comment_is_top":false,"comment_ctime":1550649083,"is_pvip":false,"replies":[{"id":"24483","content":"èµä¸¤æ¬¡ ğŸ˜†<br><br>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ–‡ç« è¯´çš„â€œåˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶â€<br>ä¸è¿‡çœ‹åˆ°ä¸å°‘å…¬å¸éƒ½ä¼šè¦åœ¨è¿™åŸºç¡€ä¸Šåšç‚¹å®šåˆ¶åŒ–","user_name":"ä½œè€…å›å¤","comment_id":69033,"uid":"1264162","ip_address":"","utype":1,"ctime":1550651103,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23025485563","product_id":100020801,"comment_content":"è¿™æ¬¡ç«Ÿç„¶åªéœ€è¦å†è¯»ä¸¤æ¬¡å°±èƒ½è¯»æ‡‚ï¼Œä¹‹å‰æ¥è§¦è¿‡mycatå’Œsharding-jdbcå®ç°åˆ†åŒº,è€å¸ˆèƒ½å¦è°ˆè°ˆè¿™æ–¹é¢çš„å‘¢","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439925,"discussion_content":"èµä¸¤æ¬¡ ğŸ˜†\n\nè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ–‡ç« è¯´çš„â€œåˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶â€\nä¸è¿‡çœ‹åˆ°ä¸å°‘å…¬å¸éƒ½ä¼šè¦åœ¨è¿™åŸºç¡€ä¸Šåšç‚¹å®šåˆ¶åŒ–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550651103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69526,"user_name":"daka","can_delete":false,"product_type":"c1","uid":1307998,"ip_address":"","ucode":"A23D82FF956793","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ibLXicovSNwEJhP4BOIPxEMle1ZUq1He58xztgBXTQFicdp5m5ibRHwUSoUVk5xQMWFwFXhp56ibm1Q/132","comment_is_top":false,"comment_ctime":1550760906,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18730630090","product_id":100020801,"comment_content":"æœ¬æœŸæåˆ°äº†ndbï¼Œäº†è§£äº†ä¸‹ï¼Œè¿™ä¸ªå­˜å‚¨å¼•æ“é«˜å¯ç”¨åŠè¯»å†™å¯æ‰©å±•æ€§åŠŸèƒ½éƒ½æ˜¯è‡ªå¸¦ï¼Œæ„Ÿè§‰æ˜¯ä¸é”™ï¼Œä¸ºä»€ä¹ˆå¾ˆå°‘è§äººä½¿ç”¨å‘¢ï¼Ÿç”Ÿäº§ä¸å¯é ï¼Ÿ","like_count":4},{"had_liked":false,"id":70335,"user_name":"NICK","can_delete":false,"product_type":"c1","uid":1322863,"ip_address":"","ucode":"FE50160CA16DCC","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/6f/31721039.jpg","comment_is_top":false,"comment_ctime":1551078000,"is_pvip":false,"replies":[{"id":"25105","content":"åˆ†åŒºè¡¨çš„ç”¨æ³•è·Ÿæ™®é€šè¡¨ï¼Œåœ¨sqlè¯­å¥ä¸Šæ˜¯ç›¸åŒçš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":70335,"uid":"1264162","ip_address":"","utype":1,"ctime":1551092565,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"14435979888","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœç”¨æˆ·åˆ†åŒºï¼Œä¸šåŠ¡è¦åšåˆ†é¡µè¿‡æ»¤æŸ¥è¯¢æ€ä¹ˆåšæ‰å¥½ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440570,"discussion_content":"åˆ†åŒºè¡¨çš„ç”¨æ³•è·Ÿæ™®é€šè¡¨ï¼Œåœ¨sqlè¯­å¥ä¸Šæ˜¯ç›¸åŒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551092565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68942,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1550631229,"is_pvip":false,"replies":[{"id":"24466","content":"1. æˆ‘ä»¬è¯­å¥é‡Œé¢æ˜¯ where ftime=&#39;2017-5-1&#39; å“ˆï¼Œä¸æ˜¯â€œ4-1â€<br>2. â€œåˆ†åŒºè¡¨çš„æŸ¥è¯¢æ€§èƒ½è¿˜æ˜¯è¦æ¯”ä¸åˆ†åŒºå¥½ï¼Œè¿™æ ·ç†è§£å¯¹å—â€ï¼Œå…¶å®è¿˜æ˜¯è¦çœ‹è¡¨çš„ç´¢å¼•æƒ…å†µã€‚<br>   å½“ç„¶ä¸€å®šå­˜åœ¨ä¸€ä¸ªæ•°é‡çº§Nï¼ŒæŠŠè¿™Nè¡Œåˆ†åˆ°10ä¸ªåˆ†åŒºè¡¨ï¼Œæ¯”æŠŠè¿™Nè¡Œæ”¾åˆ°ä¸€ä¸ªå¤§è¡¨é‡Œé¢ï¼Œæ•ˆç‡é«˜","user_name":"ä½œè€…å›å¤","comment_id":68942,"uid":"1264162","ip_address":"","utype":1,"ctime":1550640404,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"14435533117","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜<br>1. å›¾ä¸‰çš„é—´éš™é”ï¼Œæ ¹æ®â€œç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”â€ï¼Œä¸åº”è¯¥æ˜¯ (-âˆ,2017-4-1],(2017-4-1,2018-4-1)å—ï¼Œå›¾4å·¦è¾¹çš„ä¹Ÿåº”è¯¥æ˜¯ (-âˆ,2017-4-1],(2017-4-1, supernum)ï¼Œæ˜¯ä¸æ˜¯å›¾ç”»é”™äº†<br>2. ç°æœ‰çš„ä¸€ä¸ªè¡¨ï¼Œä¸€åƒä¸‡è¡Œçš„æ•°æ®ï¼Œ InnoDB å¼•æ“ï¼Œå¦‚æœä»¥æœˆä»½åˆ†åŒºï¼Œå³ä½¿æœ‰ MDL é”å’Œåˆæ¬¡è®¿é—®æ—¶ä¼šæŸ¥è¯¢æ‰€æœ‰åˆ†åŒºï¼Œä½†æ˜¯ç»¼åˆæ¥çœ‹ï¼Œåˆ†åŒºè¡¨çš„æŸ¥è¯¢æ€§èƒ½è¿˜æ˜¯è¦æ¯”ä¸åˆ†åŒºå¥½ï¼Œè¿™æ ·ç†è§£å¯¹å—<br><br>æ€è€ƒé¢˜çš„ç­”æ¡ˆ <br>ALTER TABLE t<br>  ADD COLUMN (id INT AUTO_INCREMENT ),<br>  ADD PRIMARY KEY (id, ftime);<br><br>éº»çƒ¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼Œè°¢è°¢è€å¸ˆ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439882,"discussion_content":"1. æˆ‘ä»¬è¯­å¥é‡Œé¢æ˜¯ where ftime=&amp;#39;2017-5-1&amp;#39; å“ˆï¼Œä¸æ˜¯â€œ4-1â€\n2. â€œåˆ†åŒºè¡¨çš„æŸ¥è¯¢æ€§èƒ½è¿˜æ˜¯è¦æ¯”ä¸åˆ†åŒºå¥½ï¼Œè¿™æ ·ç†è§£å¯¹å—â€ï¼Œå…¶å®è¿˜æ˜¯è¦çœ‹è¡¨çš„ç´¢å¼•æƒ…å†µã€‚\n   å½“ç„¶ä¸€å®šå­˜åœ¨ä¸€ä¸ªæ•°é‡çº§Nï¼ŒæŠŠè¿™Nè¡Œåˆ†åˆ°10ä¸ªåˆ†åŒºè¡¨ï¼Œæ¯”æŠŠè¿™Nè¡Œæ”¾åˆ°ä¸€ä¸ªå¤§è¡¨é‡Œé¢ï¼Œæ•ˆç‡é«˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550640404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293427,"user_name":"ä½•éœ–","can_delete":false,"product_type":"c1","uid":1510761,"ip_address":"","ucode":"8BBE3BFD0691B8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/NP6xd0gtGwNWnzrk2hn1zgscu7ZuLRibDCrbJzHBRk1Bicb8X7uXlrfTH1Bh4epCNxts4ok4z1sGPHpWjtSaUqnQ/132","comment_is_top":false,"comment_ctime":1621388415,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5916355711","product_id":100020801,"comment_content":"å°Šæ•¬çš„ä½œè€…ï¼Œä½ è¯´â€œåˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½ã€‚å®é™…ä¸Šï¼Œå•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œï¼Œåªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•ï¼Œå¯¹äºç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨äº†â€ï¼Œæ€ä¹ˆåˆ¤æ–­ç´¢å¼•æ˜¯å¤§ç´¢å¼•è¿˜æ˜¯å°ç´¢å¼•å•Šã€‚","like_count":1,"discussions":[{"author":{"id":1744257,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/9d/81/d748b7eb.jpg","nickname":"åƒé”¤ç™¾ç‚¼é¢†æ‚Ÿä¹‹æé™","note":"","ucode":"224B5CF2101716","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380514,"discussion_content":"çœ‹è¡¨ç´¢å¼•çš„å ç”¨ç©ºé—´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624539257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222388,"user_name":"PhilZhang","can_delete":false,"product_type":"c1","uid":1088010,"ip_address":"","ucode":"383F1A792C7DF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/0a/922615cf.jpg","comment_is_top":false,"comment_ctime":1590770729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885738025","product_id":100020801,"comment_content":"æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¤§è¡¨4000å¤šwæ¡æ•°æ®ï¼Œå¹¶ä¸”å¢é•¿ä¸ç®—æ…¢ï¼Œé¢„è®¡ç”¨hash(user id)åˆ†64ä¸ªåŒºï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼š<br>1. è¿™ä¹ˆå¤§çš„è¡¨æ˜¯ä¸æ˜¯ä¸èƒ½ç›´æ¥alteræˆåˆ†åŒºè¡¨ï¼Ÿæˆ‘ä»¬è®¡åˆ’æ˜¯å»ºä¸€å¼ æ–°è¡¨ï¼Œå…ˆåˆ›å»ºè§¦å‘å™¨åŒæ­¥æ›´æ–°æ–°æ•°æ®åˆ°æ–°è¡¨å®ç°åŒå†™ï¼Œç„¶åç”±DBAå€’æ•°æ®åˆ°æ–°è¡¨ï¼Œ<br>æœ€ååšä¸€ä¸ªtable renameï¼Œä¸çŸ¥é“è¿™æ ·æ˜¯å¦æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>2. æŸ¥è¯¢ä¸­åªè¦å¸¦ä¸Šuseridæ¡ä»¶ï¼Œå°±å¯ä»¥å…ˆå®šä½åˆ°ä¸€ä¸ªåˆ†åŒºç„¶åè¿›è¡ŒæŸ¥è¯¢ï¼Ÿ<br>3. è¯¥è¡¨ä¹‹åæ˜¯å¦å¾ˆéš¾è¿›è¡Œæ‰€æœ‰ç±»å‹çš„DDLï¼Œæ¯”å¦‚å¢åˆ å­—æ®µæˆ–è€…åˆ›å»ºç´¢å¼•ï¼Ÿ","like_count":1},{"had_liked":false,"id":124569,"user_name":"ç¨‹è¾‰","can_delete":false,"product_type":"c1","uid":1395334,"ip_address":"","ucode":"A8AE3BFE6EE59C","user_header":"https://static001.geekbang.org/account/avatar/00/15/4a/86/c7bd910e.jpg","comment_is_top":false,"comment_ctime":1565921795,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5860889091","product_id":100020801,"comment_content":"å¥‡å“¥ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸ªè¡¨çš„æ•°æ®é‡ä¸Šäº¿äº†ï¼Œæ¯ä¸ªæœˆç™¾ä¸‡+çš„æ•°æ®é‡ï¼Œè€ƒè™‘åšåˆ†åŒºã€‚è¡¨ç»“æ„ï¼š<br>id bigint(20) auto_increment,<br>imei varchar(32),<br>atime timestamp,<br>primary key (id),<br>unique key imei (imei)<br>ç»è®¨è®ºåè€ƒè™‘å¯¹atimeåšrangeåˆ†åŒºï¼Œç„¶åå› ä¸ºåˆ†åŒºå­—æ®µå¿…é¡»è¢«åŒ…å«åœ¨ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•ä¸Šï¼Œimeiçš„å”¯ä¸€ç´¢å¼•å·²ç»æ²¡æœ‰æ„ä¹‰äº†ï¼Œå˜æˆä¸‹é¢çš„è¡¨ç»“æ„ï¼š<br>id bigint(20) primary key,<br>imei varchar(32),<br>atime timestamp,<br>primary key (id, atime),<br>key imei (imei)<br>partition by range ( UNIX_TIMESTAMP(atime) ) (<br>partition p2018_01_06 values less than ( UNIX_TIMESTAMP(&#39;2018-07-01&#39;) ),<br>partition p2018_07_12 values less than ( UNIX_TIMESTAMP(&#39;2019-01-01&#39;) ),<br>...<br>)<br>ä¹‹å‰imeiæœ‰å”¯ä¸€ç´¢å¼•ï¼Œæ˜¯å¯ä»¥ç”¨REPLACE INTOåšæ‰¹é‡æ’å…¥çš„ï¼Œè¿™æ ·æ’å…¥å¾ˆå¿«ã€‚<br>ä½†æ˜¯åˆ†åŒºä¹‹åï¼Œå› ä¸ºimeiå¤±å»äº†å”¯ä¸€æ€§ï¼Œåœ¨æ’å…¥çš„æ—¶å€™è¦å…ˆå»æŸ¥è¿™ä¸ªimeiå­˜ä¸å­˜åœ¨ï¼Œä¸å­˜åœ¨å†æ’å…¥ï¼Œæ²¡åŠæ³•åšæ‰¹é‡æ’å…¥äº†ï¼Œæ€§èƒ½ä¸‹é™å¾ˆå¤šã€‚<br>è¿™ä¸ªæœ‰åŠæ³•è§£å†³å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2070832,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/99/30/9e542e5a.jpg","nickname":"å»–æ™¶â‚â‚ƒâ‚‰â‚€â‚ˆâ‚„â‚ˆâ‚†â‚â‚„â‚‚","note":"","ucode":"2331549830E0DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292192,"discussion_content":"æ€ä¹ˆæ²¡æœ‰å›ç­”è¿™ç§é—®é¢˜ï¼Œä¸å€¼å¾—å›ç­”å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595133771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1321346,"avatar":"https://static001.geekbang.org/account/avatar/00/14/29/82/7c97db71.jpg","nickname":"èµ°èµ°é“ä¸¢äº†","note":"","ucode":"9087149FCA5B90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2070832,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/99/30/9e542e5a.jpg","nickname":"å»–æ™¶â‚â‚ƒâ‚‰â‚€â‚ˆâ‚„â‚ˆâ‚†â‚â‚„â‚‚","note":"","ucode":"2331549830E0DE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306782,"discussion_content":"æ—¶é—´å¤ªä¹…äº†å§ï¼Œä¸“æ ç»“æŸäº†ï¼Œä½œè€…å¯èƒ½éƒ½ä¸çœ‹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600389677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292192,"ip_address":""},"score":306782,"extra":""}]}]},{"had_liked":false,"id":69876,"user_name":"é”‹èŠ’","can_delete":false,"product_type":"c1","uid":1320419,"ip_address":"","ucode":"BB5284E3C8D78D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ach5TNuIu8T4Of8ibvfWM4JPic5uQn9Y7TgGjBHLp2iar4icxJzs14bpUXV9OdYiciblvJl14zSqXjwtDffHnSTqbD6g/132","comment_is_top":false,"comment_ctime":1550894618,"is_pvip":false,"replies":[{"id":"24917","content":"20ã€21ä¸¤ç¯‡çœ‹ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550936838,"ip_address":"","comment_id":69876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845861914","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä»€ä¹ˆæƒ…å†µä¼šå‡ºç°é—´éš™é”ï¼Ÿèƒ½å¦ä¸“é¢˜è®²ä¸€ä¸‹é”å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440325,"discussion_content":"20ã€21ä¸¤ç¯‡çœ‹ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550936838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338025,"user_name":"Curiosity","can_delete":false,"product_type":"c1","uid":1879290,"ip_address":"","ucode":"A6732CAE6CBE8E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/ac/fa/a32099e7.jpg","comment_is_top":false,"comment_ctime":1647242334,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647242334","product_id":100020801,"comment_content":"åˆ†åŒºé”®å¿…é¡»æ˜¯ä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼Ÿ<br>ä¸ªäººè®¤ä¸ºè¿˜æ˜¯åŸºäºæ€§èƒ½è€ƒè™‘ã€‚å‡è®¾åˆ†åŒºé”®å’Œä¸»é”®æ˜¯ä¸¤ä¸ªä¸åŒçš„åˆ—ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œè™½ç„¶ä¹ŸæŒ‡å®šäº†åˆ†åŒºé”®ï¼Œä½†è¿˜æ˜¯éœ€è¦æ‰«ææ‰€æœ‰åˆ†åŒºæ‰èƒ½åˆ¤æ–­æ’å…¥çš„ä¸»é”®å€¼æ˜¯å¦è¿åäº†å”¯ä¸€æ€§çº¦æŸã€‚è¿™æ ·çš„è¯ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ä¸‹ï¼Œè¿èƒŒäº†åˆ†åŒºè¡¨çš„åˆè¡·ã€‚<br><br>","like_count":0},{"had_liked":false,"id":332045,"user_name":"idiot","can_delete":false,"product_type":"c1","uid":2526391,"ip_address":"","ucode":"D7A6E980B530B4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132","comment_is_top":false,"comment_ctime":1642995037,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642995037","product_id":100020801,"comment_content":"alter table t drop partitionä¼šæ‹¿MDLé”ï¼Œå¸¦ç´¢å¼•çš„deleteä¸ä¼šé”æ•´ä¸ªè¡¨ï¼Œè¿™æ ·çœ‹ä¸æ˜¯deleteæ›´å¥½å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":276946,"user_name":"å­æ°","can_delete":false,"product_type":"c1","uid":1025250,"ip_address":"","ucode":"717D10394391BE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/e2/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1612187648,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612187648","product_id":100020801,"comment_content":"é€šé€ï¼Œé‚£å…¶å®serverå±‚mainå®Œå…¨å¯ä»¥æ›´åˆç†çš„ä¼˜åŒ–æ‰MDLé”ï¼ŒæŠŠå­˜å‚¨å¼•æ“å±‚é¢çš„whereåˆ¤å®šé€»è¾‘æ‹¿æ¥å†³å®šæ˜¯ä½¿ç”¨é”å‡ ä¸ªåˆ†åŒºè¡¨çš„MDLé”","like_count":0},{"had_liked":false,"id":235058,"user_name":"å—å­","can_delete":false,"product_type":"c1","uid":1573993,"ip_address":"","ucode":"DFBED9E1A7FC49","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/69/31f5a0ae.jpg","comment_is_top":false,"comment_ctime":1594881032,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1594881032","product_id":100020801,"comment_content":"åœ¨mysql ä¸­ï¼Œåœ¨è®¾è®¡æ•°æ®åº“å­—æ®µåˆ—æ—¶ï¼Œå­—æ®µæ˜¯åº”è¯¥è¢«è®¾ç½®ä¸ºnullï¼Œè¿˜æ˜¯åº”è¯¥ä½¿ç”¨çš„default å»æ›¿ä»£null","like_count":0,"discussions":[{"author":{"id":1303322,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","nickname":"äº¢æ˜Ÿä¸œ","note":"","ucode":"5E4063E83B2BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333205,"discussion_content":"ä½¿ç”¨çš„default å»æ›¿ä»£null","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607480121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231986,"user_name":"jiaozhuchen","can_delete":false,"product_type":"c1","uid":1510471,"ip_address":"","ucode":"65A696D75C0577","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI9cqxrtYLlu0XvlU6J7LwEn67cL9fbnJrI6UjankWwbhiaeDQ8fI2LtjMMVMFIGKSlUyeKmN29SMg/132","comment_is_top":false,"comment_ctime":1593817814,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593817814","product_id":100020801,"comment_content":"è€å¸ˆä¹‹å‰æˆ‘ä»¬éƒ½è¯´mysqlè¶…è¿‡ä¸€åƒä¸‡çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±å¾ˆä½äº†ï¼Œçœ‹æ–‡ç« ä¸­ç°åœ¨çš„ç¡¬ä»¶ï¼Œä¸€åƒä¸‡ç®—å°è¡¨ï¼Œè€å¸ˆæœ‰æ²¡æœ‰ä¸ªå»ºè®®å€¼ï¼Œæ•°æ®è¡Œå¤šå°‘ä»¥åè€ƒè™‘åˆ†åº“åˆ†è¡¨","like_count":0},{"had_liked":false,"id":221980,"user_name":"æ³¨æ„åŠ›$","can_delete":false,"product_type":"c1","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1590648056,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"1590648056","product_id":100020801,"comment_content":"è¯·é—®mysql å¯ä»¥æŒ‰ç…§æ—¶é—´ï¼ˆæŒ‰å¤©ï¼‰è‡ªåŠ¨åˆ›å»ºåˆ†åŒºå—","like_count":0,"discussions":[{"author":{"id":1604532,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/QD9GIbqK8mx2zu6GbHQQEfWYG2oxzTlZIUQhWUrBgy4QFueKPb1qlVBUtxZictHibtjdia7ZBoNOrD1SrZPQ3TKsw/132","nickname":"Finley","note":"","ucode":"042BC805B4A1B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284755,"discussion_content":"æˆ‘ç›®å‰æ˜¯å†™çš„è„šæœ¬ï¼Œæ¯å¤©åˆ›å»ºåˆ†åŒº","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592628588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361458,"discussion_content":"è¿™ä¸ªè¦è‡ªå·±æ‰‹åŠ¨åˆ›å»ºå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616674685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205514,"user_name":"silentyears","can_delete":false,"product_type":"c1","uid":1061748,"ip_address":"","ucode":"6E137BFEB874CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/74/d9d143fa.jpg","comment_is_top":false,"comment_ctime":1586660967,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1586660967","product_id":100020801,"comment_content":"è¿™ä¹ˆä¹…äº†ï¼Œä¸çŸ¥èƒ½å¦çœ‹åˆ°ã€‚<br>è€å¸ˆï¼Œçœ‹helloworld.xsçš„è¯„è®º<br>è¯·æ•™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬mysqlä¼šæœ‰æŸ¥è¯¢ç¼“å­˜ï¼Œä½†æ˜¯updateæ“ä½œä¹Ÿæœ‰ç¼“å­˜æœºåˆ¶å—ï¼Ÿä½¿ç”¨mysql consoleç¬¬ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªupdate SQLè€—æ—¶æ˜æ˜¾æ¯”åé¢æ‰§è¡Œç›¸åŒupdate SQLè¦æ…¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<br>ä½œè€…å›å¤: updateçš„è¯ï¼Œä¸»è¦åº”è¯¥ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ•°æ®éƒ½è¯»å…¥åˆ°äº†<br><br>å…³äºè¿™ä¸ªï¼Œæœ‰ä¸ªç–‘é—®ï¼Œè¯·é—®è€å¸ˆï¼š<br>updateè¯­å¥ä¸æ˜¯å½“æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­æ—¶ï¼Œä¼šå…ˆä¿å­˜åœ¨change bufferä¸­å—ï¼Ÿ<br>ä¸ºå•¥1ã€è¿˜ä¼šå‡ºç°ç¬¬ä¸€æ¬¡updateè€—æ—¶æ˜æ˜¾é•¿çš„æƒ…å†µï¼›2ã€æ‚¨å›ç­”çš„updateçš„è¯ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œæ•°æ®éƒ½è¯»å…¥äº†ã€‚<br>æ˜¯è€ƒè™‘æ•°æ®ä¸€èˆ¬æœ‰å”¯ä¸€ç´¢å¼•ï¼Œéœ€è¦å…ˆè¯»å…¥ï¼Ÿ<br>è°¢è°¢ï¼","like_count":0,"discussions":[{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362606,"discussion_content":"change bufferåªæ˜¯ç¼“å­˜äºŒçº§ç´¢å¼•æ›´æ–°ï¼Œä¸€çº§çš„ä¸»é”®ç´¢å¼•å’Œè¡Œæ•°æ®è¿˜æ˜¯è¦è¯»å…¥ç£ç›˜çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616991015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161442,"user_name":"èµµåŠ å…´","can_delete":false,"product_type":"c1","uid":1117072,"ip_address":"","ucode":"B5730C4175B05D","user_header":"https://static001.geekbang.org/account/avatar/00/11/0b/90/f161b09a.jpg","comment_is_top":false,"comment_ctime":1576206861,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576206861","product_id":100020801,"comment_content":"é€šç”¨åˆ†åŒºç­–ç•¥å’Œæœ¬åœ°åˆ†åŒºç­–ç•¥çš„å…·ä½“å†…å®¹æ²¡æœ‰æœç´¢åˆ°ï¼Œè¿™ä¸ªåœ¨å“ªé‡Œèƒ½çœ‹åˆ°å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":155062,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1574642640,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574642640","product_id":100020801,"comment_content":"è€å¸ˆï¼Œåˆ†åŒºåï¼Œäº‹åŠ¡ä»¥åŠjionè¯­å¥éœ€è¦ä¿®æ”¹å—","like_count":0},{"had_liked":false,"id":128941,"user_name":"åŠ è½½ä¸­â€¦â€¦","can_delete":false,"product_type":"c1","uid":1366948,"ip_address":"","ucode":"3E59A0A0784D0A","user_header":"https://static001.geekbang.org/account/avatar/00/14/db/a4/191be6ad.jpg","comment_is_top":false,"comment_ctime":1566989193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566989193","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œæ–‡ç« ä¸­è¯´â€œå•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œï¼Œåªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•ï¼Œå¯¹äºç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨äº†â€ã€‚å…¶ä¸­çš„&quot;ç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›&quot;åœ¨è¿™å¥è¯çš„åœºæ™¯ä¸‹å¤§æ¦‚æŒ‡çš„æ˜¯ä¸ªä»€ä¹ˆæ ·çš„å…·ä½“é…ç½®ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":113745,"user_name":"northloki","can_delete":false,"product_type":"c1","uid":1102116,"ip_address":"","ucode":"1D944AAF0AA046","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/24/5a902c55.jpg","comment_is_top":false,"comment_ctime":1563150797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563150797","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰äº›å†å²æ•°æ®ä¼šä¸“é—¨æ”¾åœ¨å†å²è¡¨ä¸­ï¼Œæ¯å¤©å®šæœŸæŠŠæœ€æ–°æ•°æ®å½’æ¡£åˆ°å†å²è¡¨ï¼Œå…¶å®ƒæ—¶å€™å†å²è¡¨ä»…æ”¯æŒä¸å¤ªé¢‘ç¹çš„æŸ¥è¯¢ã€‚è¿™ç§åœºæ™¯æ˜¯ä½¿ç”¨åˆ†åŒºè¡¨è¿˜æ˜¯åˆ†åº“åˆ†è¡¨åˆé€‚ï¼Ÿ","like_count":0},{"had_liked":false,"id":95234,"user_name":"é¾™é¡»é¢","can_delete":false,"product_type":"c1","uid":1303391,"ip_address":"","ucode":"6D091EDFD72F5C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/5f/49276cd3.jpg","comment_is_top":false,"comment_ctime":1557994114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557994114","product_id":100020801,"comment_content":"mysqlç‰ˆæœ¬  5.7.22ï¼ŒæŒ‰ç…§è€å¸ˆçš„æ­¥éª¤æ²¡æœ‰å‘ç”Ÿblockå•Š  innodbå¼•æ“","like_count":0},{"had_liked":false,"id":80167,"user_name":"Invictus_CD îŠ","can_delete":false,"product_type":"c1","uid":1302400,"ip_address":"","ucode":"4B6BCCE71032D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/80/f5d91c66.jpg","comment_is_top":false,"comment_ctime":1553612289,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553612289","product_id":100020801,"comment_content":"å¥½åƒ5.7.22ä»¥ååˆ†åŒºå¤šäº†ä¸»ä»å»¶è¿Ÿé‚£ä¸ªé—®é¢˜è§£å†³äº†ã€‚5.6.23æ˜¯æœ‰è¿™ä¸ªé—®é¢˜","like_count":0},{"had_liked":false,"id":70352,"user_name":"å¯ç¨‹","can_delete":false,"product_type":"c1","uid":1158728,"ip_address":"","ucode":"AD30380E87CE9C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/NjF5F2UZEbd3iclteRmVL6aRlW9wv9GHOte3QFjF4cUvb5hWeNZBPmaNrlJJbSUdqTMF6MmI10icMLuDQOsb6ERA/132","comment_is_top":false,"comment_ctime":1551082376,"is_pvip":false,"replies":[{"id":"25201","content":"è¿™ä¸ªè¿˜æ˜¯å¾—çœ‹ä¸åŒçš„è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°å“ˆ<br><br>å¦‚æœä»è¯­å¥ç±»å‹ä¸Šçœ‹ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸Š(b,c)ã€(b,d)è¿™ä¸¤ä¸ªè”åˆç´¢å¼•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551148053,"ip_address":"","comment_id":70352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551082376","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œè¯·æ•™ä½ ä¸ªåˆ†åŒºè¡¨å¤šæ¡ä»¶æŸ¥è¯¢å»ºç´¢å¼•çš„é—®é¢˜ï¼›<br>è¡¨A,<br>åˆ—a,b,c,d,e,f,g,h   (å…¶ä¸­bæ˜¯datetimeï¼Œaæ˜¯uuid,å…¶ä½™æ˜¯varchar)<br>ä¸»é”®ç´¢å¼•ï¼Œ(b,a),æŒ‰æœˆåˆ†åŒº<br>æŸ¥è¯¢æƒ…å†µ1ï¼š<br>where b&gt;=? and b&lt;=? order by b desc limit 500;<br>æŸ¥è¯¢æƒ…å†µ2:<br>where b&gt;=? and b&lt;=? and c in(?) order by b desc limit 500;<br>æŸ¥è¯¢æƒ…å†µ3ï¼š<br>where b&gt;=? and b&lt;=? and d in(?) and e in(?) order by b desc limit 500;<br>æŸ¥è¯¢æƒ…å†µ4ï¼š<br>where b&gt;=? and b&lt;=? and c in(?) and d in(?) and e in(?) order by b desc limit 500;<br>è‡ªå·±å°è¯•å»ºè¿‡ä¸å°‘ç´¢å¼•ï¼Œæ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œè¯·é—®è€å¸ˆï¼Œæˆ‘è¦æ€ä¹ˆå»ºç´¢å¼•ï¼Ÿï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440580,"discussion_content":"è¿™ä¸ªè¿˜æ˜¯å¾—çœ‹ä¸åŒçš„è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°å“ˆ\n\nå¦‚æœä»è¯­å¥ç±»å‹ä¸Šçœ‹ï¼Œå¯ä»¥è€ƒè™‘åŠ ä¸Š(b,c)ã€(b,d)è¿™ä¸¤ä¸ªè”åˆç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551148053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69010,"user_name":"å¤¹å¿ƒé¢åŒ…","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":false,"comment_ctime":1550644591,"is_pvip":false,"replies":[{"id":"24486","content":"â€œä½†æ˜¯auto_incrementåˆ—å¿…é¡»æ˜¯ç¬¬ä¸€åˆ—â€ å¯ä»¥ä¸æ˜¯å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550652609,"ip_address":"","comment_id":69010,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550644591","product_id":100020801,"comment_content":"<br>æˆ‘è§‰å¾—è€å¸ˆçš„é—®é¢˜å¯ä»¥æç‚¼ä¸º Mysqlå¤åˆä¸»é”®ä¸­è‡ªå¢é•¿å­—æ®µè®¾ç½®é—®é¢˜<br>å¤åˆç´¢å¼•å¯ä»¥åŒ…å«ä¸€ä¸ªauto_increment,ä½†æ˜¯auto_incrementåˆ—å¿…é¡»æ˜¯ç¬¬ä¸€åˆ—ã€‚è¿™æ ·æ’å…¥çš„è¯,åªéœ€è¦æŒ‡å®šéè‡ªå¢é•¿çš„åˆ—<br>è¯­æ³• alter table test1  change column id id int  auto_increment;","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439911,"discussion_content":"â€œä½†æ˜¯auto_incrementåˆ—å¿…é¡»æ˜¯ç¬¬ä¸€åˆ—â€ å¯ä»¥ä¸æ˜¯å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550652609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}