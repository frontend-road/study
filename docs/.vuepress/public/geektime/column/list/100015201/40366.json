{"id":40366,"title":"14 | 深入解析Pod对象（一）：基本概念","content":"<p>你好，我是张磊。今天我和你分享的主题是：深入解析Pod对象之基本概念。</p>\n<p>在上一篇文章中，我详细介绍了Pod这个Kubernetes项目中最重要的概念。而在今天这篇文章中，我会和你分享Pod对象的更多细节。</p>\n<p>现在，你已经非常清楚：Pod，而不是容器，才是Kubernetes项目中的最小编排单位。将这个设计落实到API对象上，容器（Container）就成了Pod属性里的一个普通的字段。那么，一个很自然的问题就是：到底哪些属性属于Pod对象，而又有哪些属性属于Container呢？</p>\n<p>要彻底理解这个问题，你就一定要牢记我在上一篇文章中提到的一个结论：Pod扮演的是传统部署环境里“虚拟机”的角色。这样的设计，是为了使用户从传统环境（虚拟机环境）向Kubernetes（容器环境）的迁移，更加平滑。</p>\n<p>而如果你能把Pod看成传统环境里的“机器”、把容器看作是运行在这个“机器”里的“用户程序”，那么很多关于Pod对象的设计就非常容易理解了。</p>\n<p>比如，<strong>凡是调度、网络、存储，以及安全相关的属性，基本上是Pod 级别的。</strong></p>\n<p>这些属性的共同特征是，它们描述的是“机器”这个整体，而不是里面运行的“程序”。比如，配置这个“机器”的网卡（即：Pod的网络定义），配置这个“机器”的磁盘（即：Pod的存储定义），配置这个“机器”的防火墙（即：Pod的安全定义）。更不用说，这台“机器”运行在哪个服务器之上（即：Pod的调度）。</p><!-- [[[read_end]]] -->\n<p>接下来，我就先为你介绍Pod中几个重要字段的含义和用法。</p>\n<p><strong>NodeSelector：是一个供用户将Pod与Node进行绑定的字段</strong>，用法如下所示：</p>\n<pre><code>apiVersion: v1\nkind: Pod\n...\nspec:\n nodeSelector:\n   disktype: ssd\n</code></pre>\n<p>这样的一个配置，意味着这个Pod永远只能运行在携带了“disktype: ssd”标签（Label）的节点上；否则，它将调度失败。</p>\n<p><strong>NodeName</strong>：一旦Pod的这个字段被赋值，Kubernetes项目就会被认为这个Pod已经经过了调度，调度的结果就是赋值的节点名字。所以，这个字段一般由调度器负责设置，但用户也可以设置它来“骗过”调度器，当然这个做法一般是在测试或者调试的时候才会用到。</p>\n<p><strong>HostAliases：定义了Pod的hosts文件（比如/etc/hosts）里的内容</strong>，用法如下：</p>\n<pre><code>apiVersion: v1\nkind: Pod\n...\nspec:\n  hostAliases:\n  - ip: &quot;10.1.2.3&quot;\n    hostnames:\n    - &quot;foo.remote&quot;\n    - &quot;bar.remote&quot;\n...\n</code></pre>\n<p>在这个Pod的YAML文件中，我设置了一组IP和hostname的数据。这样，这个Pod启动后，/etc/hosts文件的内容将如下所示：</p>\n<pre><code>cat /etc/hosts\n# Kubernetes-managed hosts file.\n127.0.0.1 localhost\n...\n10.244.135.10 hostaliases-pod\n10.1.2.3 foo.remote\n10.1.2.3 bar.remote\n</code></pre>\n<p>其中，最下面两行记录，就是我通过HostAliases字段为Pod设置的。需要指出的是，在Kubernetes项目中，如果要设置hosts文件里的内容，一定要通过这种方法。否则，如果直接修改了hosts文件的话，在Pod被删除重建之后，kubelet会自动覆盖掉被修改的内容。</p>\n<p>除了上述跟“机器”相关的配置外，你可能也会发现，<strong>凡是跟容器的Linux Namespace相关的属性，也一定是Pod 级别的</strong>。这个原因也很容易理解：Pod的设计，就是要让它里面的容器尽可能多地共享Linux Namespace，仅保留必要的隔离和限制能力。这样，Pod模拟出的效果，就跟虚拟机里程序间的关系非常类似了。</p>\n<p>举个例子，在下面这个Pod的YAML文件中，我定义了shareProcessNamespace=true：</p>\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  shareProcessNamespace: true\n  containers:\n  - name: nginx\n    image: nginx\n  - name: shell\n    image: busybox\n    stdin: true\n    tty: true\n</code></pre>\n<p>这就意味着这个Pod里的容器要共享PID Namespace。</p>\n<p>而在这个YAML文件中，我还定义了两个容器：一个是nginx容器，一个是开启了tty和stdin的shell容器。</p>\n<p>我在前面介绍容器基础时，曾经讲解过什么是tty和stdin。而在Pod的YAML文件里声明开启它们俩，其实等同于设置了docker run里的-it（-i即stdin，-t即tty）参数。</p>\n<p>如果你还是不太理解它们俩的作用的话，可以直接认为tty就是Linux给用户提供的一个常驻小程序，用于接收用户的标准输入，返回操作系统的标准输出。当然，为了能够在tty中输入信息，你还需要同时开启stdin（标准输入流）。</p>\n<p>于是，这个Pod被创建后，你就可以使用shell容器的tty跟这个容器进行交互了。我们一起实践一下：</p>\n<pre><code>$ kubectl create -f nginx.yaml\n</code></pre>\n<p>接下来，我们使用kubectl attach命令，连接到shell容器的tty上：</p>\n<pre><code>$ kubectl attach -it nginx -c shell\n</code></pre>\n<p>这样，我们就可以在shell容器里执行ps指令，查看所有正在运行的进程：</p>\n<pre><code>$ kubectl attach -it nginx -c shell\n/ # ps ax\nPID   USER     TIME  COMMAND\n    1 root      0:00 /pause\n    8 root      0:00 nginx: master process nginx -g daemon off;\n   14 101       0:00 nginx: worker process\n   15 root      0:00 sh\n   21 root      0:00 ps ax\n</code></pre>\n<p>可以看到，在这个容器里，我们不仅可以看到它本身的ps ax指令，还可以看到nginx容器的进程，以及Infra容器的/pause进程。这就意味着，整个Pod里的每个容器的进程，对于所有容器来说都是可见的：它们共享了同一个PID Namespace。</p>\n<p>类似地，<strong>凡是Pod中的容器要共享宿主机的Namespace，也一定是Pod级别的定义</strong>，比如：</p>\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  hostNetwork: true\n  hostIPC: true\n  hostPID: true\n  containers:\n  - name: nginx\n    image: nginx\n  - name: shell\n    image: busybox\n    stdin: true\n    tty: true\n</code></pre>\n<p>在这个Pod中，我定义了共享宿主机的Network、IPC和PID Namespace。这就意味着，这个Pod里的所有容器，会直接使用宿主机的网络、直接与宿主机进行IPC通信、看到宿主机里正在运行的所有进程。</p>\n<p>当然，除了这些属性，Pod里最重要的字段当属“Containers”了。而在上一篇文章中，我还介绍过“Init Containers”。其实，这两个字段都属于Pod对容器的定义，内容也完全相同，只是Init Containers的生命周期，会先于所有的Containers，并且严格按照定义的顺序执行。</p>\n<p>Kubernetes项目中对Container的定义，和Docker相比并没有什么太大区别。我在前面的容器技术概念入门系列文章中，和你分享的Image（镜像）、Command（启动命令）、workingDir（容器的工作目录）、Ports（容器要开发的端口），以及volumeMounts（容器要挂载的Volume）都是构成Kubernetes项目中Container的主要字段。不过在这里，还有这么几个属性值得你额外关注。</p>\n<p><strong>首先，是ImagePullPolicy字段</strong>。它定义了镜像拉取的策略。而它之所以是一个Container级别的属性，是因为容器镜像本来就是Container定义中的一部分。</p>\n<p>ImagePullPolicy的值默认是Always，即每次创建Pod都重新拉取一次镜像。另外，当容器的镜像是类似于nginx或者nginx:latest这样的名字时，ImagePullPolicy也会被认为Always。</p>\n<p>而如果它的值被定义为Never或者IfNotPresent，则意味着Pod永远不会主动拉取这个镜像，或者只在宿主机上不存在这个镜像时才拉取。</p>\n<p><strong>其次，是Lifecycle字段</strong>。它定义的是Container Lifecycle Hooks。顾名思义，Container Lifecycle Hooks的作用，是在容器状态发生变化时触发一系列“钩子”。我们来看这样一个例子：</p>\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  - name: lifecycle-demo-container\n    image: nginx\n    lifecycle:\n      postStart:\n        exec:\n          command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;]\n      preStop:\n        exec:\n          command: [&quot;/usr/sbin/nginx&quot;,&quot;-s&quot;,&quot;quit&quot;]\n</code></pre>\n<p>这是一个来自Kubernetes官方文档的Pod的YAML文件。它其实非常简单，只是定义了一个nginx镜像的容器。不过，在这个YAML文件的容器（Containers）部分，你会看到这个容器分别设置了一个postStart和preStop参数。这是什么意思呢？</p>\n<p>先说postStart吧。它指的是，在容器启动后，立刻执行一个指定的操作。需要明确的是，postStart定义的操作，虽然是在Docker容器ENTRYPOINT执行之后，但它并不严格保证顺序。也就是说，在postStart启动时，ENTRYPOINT有可能还没有结束。</p>\n<p>当然，如果postStart执行超时或者错误，Kubernetes会在该Pod的Events中报出该容器启动失败的错误信息，导致Pod也处于失败的状态。</p>\n<p>而类似地，preStop发生的时机，则是容器被杀死之前（比如，收到了SIGKILL信号）。而需要明确的是，preStop操作的执行，是同步的。所以，它会阻塞当前的容器杀死流程，直到这个Hook定义操作完成之后，才允许容器被杀死，这跟postStart不一样。</p>\n<p>所以，在这个例子中，我们在容器成功启动之后，在/usr/share/message里写入了一句“欢迎信息”（即postStart定义的操作）。而在这个容器被删除之前，我们则先调用了nginx的退出指令（即preStop定义的操作），从而实现了容器的“优雅退出”。</p>\n<p>在熟悉了Pod以及它的Container部分的主要字段之后，我再和你分享一下<strong>这样一个的Pod对象在Kubernetes中的生命周期</strong>。</p>\n<p>Pod生命周期的变化，主要体现在Pod API对象的<strong>Status部分</strong>，这是它除了Metadata和Spec之外的第三个重要字段。其中，pod.status.phase，就是Pod的当前状态，它有如下几种可能的情况：</p>\n<ol>\n<li>\n<p>Pending。这个状态意味着，Pod的YAML文件已经提交给了Kubernetes，API对象已经被创建并保存在Etcd当中。但是，这个Pod里有些容器因为某种原因而不能被顺利创建。比如，调度不成功。</p>\n</li>\n<li>\n<p>Running。这个状态下，Pod已经调度成功，跟一个具体的节点绑定。它包含的容器都已经创建成功，并且至少有一个正在运行中。</p>\n</li>\n<li>\n<p>Succeeded。这个状态意味着，Pod里的所有容器都正常运行完毕，并且已经退出了。这种情况在运行一次性任务时最为常见。</p>\n</li>\n<li>\n<p>Failed。这个状态下，Pod里至少有一个容器以不正常的状态（非0的返回码）退出。这个状态的出现，意味着你得想办法Debug这个容器的应用，比如查看Pod的Events和日志。</p>\n</li>\n<li>\n<p>Unknown。这是一个异常状态，意味着Pod的状态不能持续地被kubelet汇报给kube-apiserver，这很有可能是主从节点（Master和Kubelet）间的通信出现了问题。</p>\n</li>\n</ol>\n<p>更进一步地，Pod对象的Status字段，还可以再细分出一组Conditions。这些细分状态的值包括：PodScheduled、Ready、Initialized，以及Unschedulable。它们主要用于描述造成当前Status的具体原因是什么。</p>\n<p>比如，Pod当前的Status是Pending，对应的Condition是Unschedulable，这就意味着它的调度出现了问题。</p>\n<p>而其中，Ready这个细分状态非常值得我们关注：它意味着Pod不仅已经正常启动（Running状态），而且已经可以对外提供服务了。这两者之间（Running和Ready）是有区别的，你不妨仔细思考一下。</p>\n<p>Pod的这些状态信息，是我们判断应用运行情况的重要标准，尤其是Pod进入了非“Running”状态后，你一定要能迅速做出反应，根据它所代表的异常情况开始跟踪和定位，而不是去手忙脚乱地查阅文档。</p>\n<h2>总结</h2>\n<p>在今天这篇文章中，我详细讲解了Pod API对象，介绍了Pod的核心使用方法，并分析了Pod和Container在字段上的异同。希望这些讲解能够帮你更好地理解和记忆Pod YAML中的核心字段，以及这些字段的准确含义。</p>\n<p>实际上，Pod API对象是整个Kubernetes体系中最核心的一个概念，也是后面我讲解各种控制器时都要用到的。</p>\n<p>在学习完这篇文章后，我希望你能仔细阅读$GOPATH/src/k8s.io/kubernetes/vendor/k8s.io/api/core/v1/types.go里，type Pod struct ，尤其是PodSpec部分的内容。争取做到下次看到一个Pod的YAML文件时，不再需要查阅文档，就能做到把常用字段及其作用信手拈来。</p>\n<p>而在下一篇文章中，我会通过大量的实践，帮助你巩固和进阶关于Pod API对象核心字段的使用方法，敬请期待吧。</p>\n<h2>思考题</h2>\n<p>你能否举出一些Pod（即容器）的状态是Running，但是应用其实已经停止服务的例子？相信Java Web开发者的亲身体会会比较多吧。</p>\n<p>感谢你的收听，欢迎你给我留言，也欢迎分享给更多的朋友一起阅读。</p>\n<p></p>\n","neighbors":{"left":{"article_title":"13 | 为什么我们需要Pod？","id":40092},"right":{"article_title":"15 | 深入解析Pod对象（二）：使用进阶","id":40466}},"comments":[{"had_liked":false,"id":26939,"user_name":"blackpiglet","can_delete":false,"product_type":"c1","uid":1032928,"ip_address":"","ucode":"58AA8329C91767","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/e0/7188aa0a.jpg","comment_is_top":false,"comment_ctime":1537780339,"is_pvip":false,"replies":[{"id":"9867","content":"课代表来了","user_name":"作者回复","comment_id":26939,"uid":"1218095","ip_address":"","utype":1,"ctime":1537887100,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"1204128623219","product_id":100015201,"comment_content":"对于 Pod 状态是 Ready，实际上不能提供服务的情况能想到几个例子：<br>1. 程序本身有 bug，本来应该返回 200，但因为代码问题，返回的是500；<br>2. 程序因为内存问题，已经僵死，但进程还在，但无响应；<br>3. Dockerfile 写的不规范，应用程序不是主进程，那么主进程出了什么问题都无法发现；<br>4. 程序出现死循环。<br>","like_count":281,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424763,"discussion_content":"课代表来了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537887100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1129309,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3b/5d/15c4817a.jpg","nickname":"xxxxL","note":"","ucode":"F84BB5ACD1241E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530824,"discussion_content":"是不是还有一种情况：在系统正式提供服务前需要一些预热操作，需要等预热操作结束了才能把状态从running改成ready","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1637155875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31896,"user_name":"Jeff.W","can_delete":false,"product_type":"c1","uid":1140420,"ip_address":"","ucode":"2043F83FB7B39C","user_header":"https://static001.geekbang.org/account/avatar/00/11/66/c4/038f9325.jpg","comment_is_top":false,"comment_ctime":1539324512,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"796108274272","product_id":100015201,"comment_content":"POD的直议是豆荚，豆荚中的一个或者多个豆属于同一个家庭，共享一个物理豆荚（可以共享调度、网络、存储，以及安全），每个豆虽然有自己的空间，但是由于之间的缝隙，可以近距离无缝沟通（Linux Namespace相关的属性）。","like_count":186,"discussions":[{"author":{"id":2654712,"avatar":"","nickname":"弓赫","note":"","ucode":"DFB92B520CC82B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379821,"discussion_content":"然而实际上， Pod 直译是「一群鲸鱼」（暗示 Docker 组成的集群）而非「豆荚」。Kubernetes 相关的术语，Pod、helm 等等，基本上都与航海有关，云原生是一个互联网的大航海时代。","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1624174907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2654712,"avatar":"","nickname":"弓赫","note":"","ucode":"DFB92B520CC82B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590601,"discussion_content":"感谢，不过层主也没有毛病，因为pod是豆荚的意思所以「a pod of」是一群的意思，这里pod就是「a pod of somethings」的简称。很有意思的命名。另外请教下infra pod为啥叫pause呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665913631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":379821,"ip_address":"北京"},"score":590601,"extra":""}]},{"author":{"id":1581708,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eozzWrelqaW7GWmbGGMejOV3DIDsMXTpib5ib9W5yHM0s1oDpvOb70G2SdjRs7evxv8T3VVjZTeEeyQ/132","nickname":"Geek_c12c37","note":"","ucode":"7EFDD2E596F18E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316964,"discussion_content":"充分说明学好英语很重要","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1603489792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1515294,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1f/1e/35897c64.jpg","nickname":"。","note":"","ucode":"9B546734C73CFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337557,"discussion_content":"这个总结的好，mark","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608973529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1525284,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/39pQ9yRAAnAmW4jicAFomZJ0IlsnmUpyYsgMvVgcVEibXmahMcxxyYyN5pOZmSWtoic3XYib2uoiaUwgK9bS7eqpthQ/132","nickname":"峑崧","note":"","ucode":"DA7348630C0539","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203113,"discussion_content":"大神，你的总结总是那么通俗易懂","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583999433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529638,"avatar":"https://static001.geekbang.org/account/avatar/00/17/57/26/0de43b5d.jpg","nickname":"WxZhu","note":"","ucode":"1F6E12B51AD102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319121,"discussion_content":"感觉有点像进程和线程的关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603948252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27829,"user_name":"龙坤","can_delete":false,"product_type":"c1","uid":1233455,"ip_address":"","ucode":"D1724E68D6304D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","comment_is_top":false,"comment_ctime":1537951253,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"173336643093","product_id":100015201,"comment_content":"你好，我进入shell容器，然后执行ps ax，跟例子的结果不一样。例子代码也一样，添加了shareProcessNamespace: true了，为什么不行呢，请问可能出现的原因在哪里<br>&#47; # ps<br>PID   USER     TIME  COMMAND<br>    1 root      0:00 sh<br>   10 root      0:00 ps<br><br>","like_count":40,"discussions":[{"author":{"id":1643252,"avatar":"https://static001.geekbang.org/account/avatar/00/19/12/f4/d1ed8885.jpg","nickname":"uni","note":"","ucode":"38DFFAC10A7991","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239720,"discussion_content":"我刚开始和你一样，因为该字段不可以更新时设置，必须先删除原pod","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1587306871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1248307,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0c/33/c5026169.jpg","nickname":"hiyang","note":"","ucode":"E521EE72C0F247","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292170,"discussion_content":"针对1.18.3，测试：当没有shareProcessNamespace字段时，进去POD ps aux 看不到nginx进程；有 shareProcessNamespace，进入 POD 能看到 nginx 进程；\n如果pod启动后，才加shareProcessNamespace，现在直接会报错\nshareProcessNamespace\nThe Pod &#34;nginx&#34; is invalid: spec: Forbidden: pod updates may not change fields other than `spec.containers[*].image`, `spec.initContainers[*].image`, `spec.activeDeadlineSeconds` or `spec.tolerations` (only additions to existing tolerations)\n  core.PodSpec{\n  \t... // 10 identical fields\n  \tAutomountServiceAccountToken: nil,\n  \tNodeName:                     &#34;node3&#34;,\n  \tSecurityContext: &amp;core.PodSecurityContext{\n  \t\tHostNetwork:           false,\n  \t\tHostPID:               false,\n  \t\tHostIPC:               false,\n- \t\tShareProcessNamespace: &amp;true,\n+ \t\tShareProcessNamespace: nil,\n  \t\tSELinuxOptions:        nil,\n  \t\tWindowsOptions:        nil,\n  \t\t... // 7 identical fields\n  \t},\n  \tImagePullSecrets: nil,\n  \tHostname:         &#34;&#34;,\n  \t... // 14 identical fields\n  }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595128588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45935,"user_name":"细雨","can_delete":false,"product_type":"c1","uid":1267059,"ip_address":"","ucode":"8A42F39D9388E8","user_header":"https://static001.geekbang.org/account/avatar/00/13/55/73/0b6351b8.jpg","comment_is_top":false,"comment_ctime":1543821964,"is_pvip":false,"replies":[{"id":"17512","content":"对啊","user_name":"作者回复","comment_id":45935,"uid":"1218095","ip_address":"","utype":1,"ctime":1544533783,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"113212971660","product_id":100015201,"comment_content":"问一下老师，infra 网络的镜像为什么取名字叫 pause 呀，难道它一直处于“暂停状态”吗？","like_count":27,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431278,"discussion_content":"对啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544533783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":590602,"discussion_content":"学到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665913707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":431278,"ip_address":"北京"},"score":590602,"extra":""}]}]},{"had_liked":false,"id":28041,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1537980581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"96027261093","product_id":100015201,"comment_content":"只要容器没有down掉，pod就会处于running状态。pod只会监控到容器的状态，但不会监控容器里面程序的运行状态。如果程序处于死循环，或者其他bug状态，但并没有异常退出，此刻容器还是会处于存活状态，但实际上程序已经不能工作了。<br>日常使用的感受是这样的，不知道对不。","like_count":23},{"had_liked":false,"id":30224,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1538730067,"is_pvip":false,"replies":[{"id":"10869","content":"apiserver 加—feature-gates=PodShareProcessNamespace=true 1.11后已经默认开启了","user_name":"作者回复","comment_id":30224,"uid":"1218095","ip_address":"","utype":1,"ctime":1538739939,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"74553174099","product_id":100015201,"comment_content":"你好，我进入shell容器，然后执行ps ax，跟例子的结果不一样。例子代码也一样，添加了shareProcessNamespace: true了，为什么不行呢，请问可能出现的原因在哪里<br>&#47; # ps<br>PID USER TIME COMMAND<br>1 root 0:00 sh<br>10 root 0:00 ps<br><br>请问怎么开启sharepid功能呢？","like_count":18,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425903,"discussion_content":"apiserver 加—feature-gates=PodShareProcessNamespace=true 1.11后已经默认开启了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538739939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27540,"user_name":"两两","can_delete":false,"product_type":"c1","uid":1010648,"ip_address":"","ucode":"A6A48AF00C6026","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/d8/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1537920472,"is_pvip":false,"replies":[{"id":"9991","content":"liveness和readiness啥区别？","user_name":"作者回复","comment_id":27540,"uid":"1218095","ip_address":"","utype":1,"ctime":1537938195,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"61667462616","product_id":100015201,"comment_content":"pod runing好理解，但k8s怎么知道容器runing呢，通过什么标准判断？应用死循环，k8s怎么能感知？","like_count":14,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424940,"discussion_content":"liveness和readiness啥区别？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27252,"user_name":"杨孔来","can_delete":false,"product_type":"c1","uid":1219154,"ip_address":"","ucode":"2CEA33CAB6322E","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/52/a51cbdef.jpg","comment_is_top":false,"comment_ctime":1537858546,"is_pvip":false,"replies":[{"id":"9858","content":"不是讲了prestop hook了？","user_name":"作者回复","comment_id":27252,"uid":"1218095","ip_address":"","utype":1,"ctime":1537886785,"user_name_real":"Geek_6ef93d"}],"discussion_count":3,"race_medal":0,"score":"48782498802","product_id":100015201,"comment_content":"老师，如果pod中的image更新了（比如 通过jenkins发布了新版本），我想通过重启pod,获取最新的image，有什么命令，可以优雅的重启pod，而不影响当前pod提供的业务吗","like_count":12,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424852,"discussion_content":"不是讲了prestop hook了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537886785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2598745,"avatar":"","nickname":"Geek_15f028","note":"","ucode":"5DD5FEF3B55F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545146,"discussion_content":"镜像设置为总是拉去，更新方式为滚动更新，策略后面估计会讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641865558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237986,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e3/e2/2b56a802.jpg","nickname":"菠萝睡不醒","note":"","ucode":"7E3884FD402ED1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404806,"discussion_content":"helm upgrade","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634404978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27625,"user_name":"徐海浪","can_delete":false,"product_type":"c1","uid":1078528,"ip_address":"","ucode":"21801C420D0610","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","comment_is_top":false,"comment_ctime":1537925377,"is_pvip":false,"replies":[{"id":"9984","content":"吃一堑长一智","user_name":"作者回复","comment_id":27625,"uid":"1218095","ip_address":"","utype":1,"ctime":1537938045,"user_name_real":"Geek_6ef93d"}],"discussion_count":9,"race_medal":1,"score":"44487598337","product_id":100015201,"comment_content":"以前我对容器的认识还不深，竟然用tail -f Catalina.out作为前台进程，这样即使tomcat进程挂掉，容器还是正在运行。应用不可用tomcat进程还在经常会遇到，比如内存溢出，或者应用依赖的数据库等外部系统动荡导致应用不正常。怎么在应用的角度来决定容器是否应该退出？应用提供一个健康检查url，跑前台shell定期检查该url，状态不对则shell退出，从而容器退出。","like_count":10,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424971,"discussion_content":"吃一堑长一智","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006336,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/00/9078412c.jpg","nickname":"hellofuture","note":"","ucode":"6F76A79ECBE1B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203438,"discussion_content":"你好，请教一下，tailf的问题是什么呢，这个地方的最佳实践应该是什么样呢，谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584027978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1078528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","nickname":"徐海浪","note":"","ucode":"21801C420D0610","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1006336,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/00/9078412c.jpg","nickname":"hellofuture","note":"","ucode":"6F76A79ECBE1B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204798,"discussion_content":"tailf最大的问题是跟应用无关。健康检查应该是作为应用的关键路径，比如是数据库的pod健康检查可以是数据库操作select 1，缓存会话的强依赖redis的可以用ping命令，如果一个应用依赖的关键东西不存在，或者是关键接口不可用，那么就应该健康检查失败，由k8s调度重启。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1584205589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":203438,"ip_address":""},"score":204798,"extra":""},{"author":{"id":1170811,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/7b/c1efb1d9.jpg","nickname":"胡永","note":"","ucode":"931DA91D191FEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1006336,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/00/9078412c.jpg","nickname":"hellofuture","note":"","ucode":"6F76A79ECBE1B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362220,"discussion_content":"liveness readiness probes。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616895850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":203438,"ip_address":""},"score":362220,"extra":""}]},{"author":{"id":1007359,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/ff/295bcf2c.jpg","nickname":"vimfun","note":"","ucode":"EAB2281FC0552A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5671,"discussion_content":"这个也不靠谱。\n\n这个健康检查的url正常，其它entry url出问题了你怎么知道呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566433657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1078528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","nickname":"徐海浪","note":"","ucode":"21801C420D0610","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1007359,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/ff/295bcf2c.jpg","nickname":"vimfun","note":"","ucode":"EAB2281FC0552A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5871,"discussion_content":"        嗯，我明白你说的，所以这个健康检查的url不能太简单，应该根据应用的特点做检查，而不是单纯的检测web容器下的静态页面。\n       我之前想到的是，根据应用的依赖，定制健康检查url，比如依赖redis和mysql，那么这个健康检查就是去redis发起PING，去mysql发起select 1。但加上(比如查询)业务的检查，似乎会变得更加复杂，我觉得容器不应该关心业务是否正常，只专注容器的依赖是否正常即可。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566520821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5671,"ip_address":""},"score":5871,"extra":""},{"author":{"id":1803018,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/0a/ff47a794.jpg","nickname":"艾秦","note":"","ucode":"0E1A88EAB734AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1078528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","nickname":"徐海浪","note":"","ucode":"21801C420D0610","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":214554,"discussion_content":"那比如tomcat应用，如果不加tail -f 执行start.sh脚本会立即退出咋搞，容器就退出了，这个咋破，望大神赐教","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585207517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5871,"ip_address":""},"score":214554,"extra":""},{"author":{"id":1078528,"avatar":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","nickname":"徐海浪","note":"","ucode":"21801C420D0610","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1803018,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/0a/ff47a794.jpg","nickname":"艾秦","note":"","ucode":"0E1A88EAB734AA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217481,"discussion_content":"前台启动，catalina.sh run","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585564066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":214554,"ip_address":""},"score":217481,"extra":""}]},{"author":{"id":1113571,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fd/e3/a9d21a3b.jpg","nickname":"Kuqi","note":"","ucode":"42143DAB548FCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3889,"discussion_content":"厉害","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564926710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55781,"user_name":"追风","can_delete":false,"product_type":"c1","uid":1356206,"ip_address":"","ucode":"D1D463D7B911A5","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/ae/344fbda3.jpg","comment_is_top":false,"comment_ctime":1546307389,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40201013053","product_id":100015201,"comment_content":"作者的那句评论。先让让子弹飞一会，让我看出了作者决胜千里之外的眼界。哈哈哈","like_count":9},{"had_liked":false,"id":27224,"user_name":"hexinzhe","can_delete":false,"product_type":"c1","uid":1044445,"ip_address":"","ucode":"7417E4E3A40C72","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/dd/599d77c0.jpg","comment_is_top":false,"comment_ctime":1537852817,"is_pvip":false,"replies":[{"id":"9860","content":"前者就是sig term的超时时间。后者是要你自己编写逻辑处理的。","user_name":"作者回复","comment_id":27224,"uid":"1218095","ip_address":"","utype":1,"ctime":1537886893,"user_name_real":"Geek_6ef93d"}],"discussion_count":3,"race_medal":0,"score":"35897591185","product_id":100015201,"comment_content":"比较想要知道优雅停机方面的更详细内容，比如说terminationgraceperiodseconds与prestop之间的关系，两者怎么用","like_count":8,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424838,"discussion_content":"前者就是sig term的超时时间。后者是要你自己编写逻辑处理的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537886893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2747868,"avatar":"","nickname":"DramaColin","note":"","ucode":"F505F21FD45042","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573734,"discussion_content":"想请教一下在哪一个章节的文章里有提到Pod的停止问题呢？不懂什么是term、sig term","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653619379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2254917,"avatar":"https://static001.geekbang.org/account/avatar/00/22/68/45/ddf89612.jpg","nickname":"bestgopher","note":"","ucode":"D89735C8CA9C6E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":2747868,"avatar":"","nickname":"DramaColin","note":"","ucode":"F505F21FD45042","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577840,"discussion_content":"linux的信号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656386217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":573734,"ip_address":""},"score":577840,"extra":""}]}]},{"had_liked":false,"id":27177,"user_name":"ethfoo","can_delete":false,"product_type":"c1","uid":1230991,"ip_address":"","ucode":"89437AB68AF4C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/c8/8f/759b7761.jpg","comment_is_top":false,"comment_ctime":1537842255,"is_pvip":false,"replies":[{"id":"9861","content":"可以这么理解","user_name":"作者回复","comment_id":27177,"uid":"1218095","ip_address":"","utype":1,"ctime":1537886914,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"35897580623","product_id":100015201,"comment_content":"如果pod加了健康检查，是不是就不关心应用进程是不是容器的初始化进程呢？因为应用进程挂了，虽然容器不会自动退出，但是kubelet会主动去kill掉这个容器","like_count":8,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424825,"discussion_content":"可以这么理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537886914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27326,"user_name":"姜戈","can_delete":false,"product_type":"c1","uid":1119654,"ip_address":"","ucode":"8CF8A5AD9A3E10","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/a6/723854ee.jpg","comment_is_top":false,"comment_ctime":1537871877,"is_pvip":false,"replies":[{"id":"9851","content":"不会","user_name":"作者回复","comment_id":27326,"uid":"1218095","ip_address":"","utype":1,"ctime":1537886652,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"31602642949","product_id":100015201,"comment_content":"通过node selector将任务调度到了woker1   成功运行之后 再修改worker1的label,  任务会重新调度吗？","like_count":8,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424878,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537886652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26751,"user_name":"混沌渺无极","can_delete":false,"product_type":"c1","uid":1221896,"ip_address":"","ucode":"A8517768BF1E77","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/08/10b18682.jpg","comment_is_top":false,"comment_ctime":1537751234,"is_pvip":false,"replies":[{"id":"9693","content":"文中不是已经解释了？当然会执行，不管entrypoint。","user_name":"作者回复","comment_id":26751,"uid":"1218095","ip_address":"","utype":1,"ctime":1537751945,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"27307555010","product_id":100015201,"comment_content":"各位，中秋节好。<br>如果entrypoint是一个一直运行的命令，那postStart会执行吗？还是启动一个协程成执行entrypoint，然后再运行一个协程执行这个postStart，所以这两个命令的执行状态是独立的，没有真正的先后关系。","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424724,"discussion_content":"文中不是已经解释了？当然会执行，不管entrypoint。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537751945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26729,"user_name":"pytimer","can_delete":false,"product_type":"c1","uid":1014666,"ip_address":"","ucode":"A0038F6CB1F9AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ercmNryEicqDS73icpUu7W0BnZ7ZIia6jR7kdVMIzH0q1d7L8EKAYWeTJcribibGcHnJzpsjRFxAe26egQ/132","comment_is_top":false,"comment_ctime":1537748559,"is_pvip":false,"replies":[{"id":"9703","content":"看events","user_name":"作者回复","comment_id":26729,"uid":"1218095","ip_address":"","utype":1,"ctime":1537754562,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"27307552335","product_id":100015201,"comment_content":"老师，问一下，我看pod.status.phase是running，但是Ready是false，如果我想判断pod状态，要怎么做","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424723,"discussion_content":"看events","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537754562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013147,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","nickname":"技术修行者","note":"","ucode":"28CA41A1214D6B","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":140116,"discussion_content":"或者用kubectl describe <pod-name>来检查。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579347968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29157,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1538276139,"is_pvip":false,"replies":[{"id":"10483","content":"你看看sharepid功能开启了没","user_name":"作者回复","comment_id":29157,"uid":"1218095","ip_address":"","utype":1,"ctime":1538277672,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"23013112619","product_id":100015201,"comment_content":"本地测试的进入shell容器后执行ps ax，跟例子的结果不一样。没有看到nginx窗口里的nginx进程信息，为什么，我看也有人遇到这个问题.<br>&#47; # ps<br>PID USER TIME COMMAND<br>1 root 0:00 sh<br>10 root 0:00 ps","like_count":5,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425506,"discussion_content":"你看看sharepid功能开启了没","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538277672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61418,"user_name":"XThundering","can_delete":false,"product_type":"c1","uid":1343394,"ip_address":"","ucode":"B301F36E7EEB5E","user_header":"https://static001.geekbang.org/account/avatar/00/14/7f/a2/8ccf5c85.jpg","comment_is_top":false,"comment_ctime":1547694445,"is_pvip":false,"replies":[{"id":"22066","content":"最新版本才改的呢","user_name":"作者回复","comment_id":61418,"uid":"1218095","ip_address":"","utype":1,"ctime":1548053786,"user_name_real":"Geek_6ef93d"}],"discussion_count":3,"race_medal":0,"score":"18727563629","product_id":100015201,"comment_content":"文章中有处有问题：&quot;ImagePullPolicy 的值默认是 Always，即...&quot; 这部分和官方文档与实际情况不一致。<br>在官方文档中提到&quot;The default pull policy is IfNotPresent&quot;，我这边在使用中发现的也是这样子的~<br>附一下官方文档链接：https:&#47;&#47;kubernetes.io&#47;docs&#47;concepts&#47;containers&#47;images&#47;","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436869,"discussion_content":"最新版本才改的呢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548053786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2459306,"avatar":"https://static001.geekbang.org/account/avatar/00/25/86/aa/a75e34f5.jpg","nickname":"SHAWN","note":"","ucode":"D52EB98E8ACB77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":534292,"discussion_content":"哈哈时隔2年","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638156377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":436869,"ip_address":""},"score":534292,"extra":""}]},{"author":{"id":2091644,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/ea/7c/9417dbbc.jpg","nickname":"提百万的超神梦","note":"","ucode":"53932395568AC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314111,"discussion_content":"官方现在描述的仍为:  The default pull policy is IfNotPresent which causes the kubelet to skip pulling an image if it already exists.  但是实际上的确是Always","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603118164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41470,"user_name":"短笛","can_delete":false,"product_type":"c1","uid":1239688,"ip_address":"","ucode":"8AEABC5977A02C","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/88/914d0c1b.jpg","comment_is_top":false,"comment_ctime":1542788616,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18722657800","product_id":100015201,"comment_content":"Pod 的意思我理解应该是指 a small herd or school of marine animals, especially whales 而不是豆荚，为什么是鲸群呢？因为 Docker 的 Logo 啊 😂","like_count":4,"discussions":[{"author":{"id":1366782,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/eQysJPqzuAoyrWzWyXyYibrAszp6B4WUic7g2TnO8ksfWtCibOEMRqQmCZk4xJwEPQwTRH21W4e2f77FoQTzL6Dhw/132","nickname":"钱涛","note":"","ucode":"B08EB10AD30D74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311366,"discussion_content":"有道查出来是  “蚕茧；豆荚”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602317492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543460,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8d/24/a2f886d3.jpg","nickname":"Rexxar","note":"","ucode":"86D0238F0F0C55","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296849,"discussion_content":"词典没查到pod有这个意思啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596685702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252485,"user_name":"钱涛","can_delete":false,"product_type":"c1","uid":1366782,"ip_address":"","ucode":"B08EB10AD30D74","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eQysJPqzuAoyrWzWyXyYibrAszp6B4WUic7g2TnO8ksfWtCibOEMRqQmCZk4xJwEPQwTRH21W4e2f77FoQTzL6Dhw/132","comment_is_top":false,"comment_ctime":1602317334,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14487219222","product_id":100015201,"comment_content":"Pod 启动设置NodeSelector 是如果设置的Node不存在, 可以看到Pod会被调度，但是永远不会成功，但是启动失败后又没有对应的Pod,导致日志没法describe. 请问怎么找对应的日志呢？","like_count":3,"discussions":[{"author":{"id":1751859,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/bb/33/5545b42e.jpg","nickname":"Bobo","note":"","ucode":"23102FBE943515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583865,"discussion_content":"看pod的events事件呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660452683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165610,"user_name":"Farewell丶","can_delete":false,"product_type":"c1","uid":1179565,"ip_address":"","ucode":"A0D69893C5375C","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/ad/5020a8c5.jpg","comment_is_top":false,"comment_ctime":1577267729,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14462169617","product_id":100015201,"comment_content":"官方文档对 imagePullPolicy 属性的默认情况是这样描述的，好像和文章说的不太一样：<br>“ Defaults to Always if :latest tag is specified, or IfNotPresent otherwise. ”","like_count":3,"discussions":[{"author":{"id":2156207,"avatar":"https://static001.geekbang.org/account/avatar/00/20/e6/af/acf4a949.jpg","nickname":"山外青山楼外楼外楼","note":"","ucode":"19FDB1FA5D394F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340874,"discussion_content":"官方文档默认是IfNotPresent \n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610186681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35630,"user_name":"陆培尔","can_delete":false,"product_type":"c1","uid":1095319,"ip_address":"","ucode":"B9AE067272513B","user_header":"https://static001.geekbang.org/account/avatar/00/10/b6/97/93e82345.jpg","comment_is_top":false,"comment_ctime":1540717799,"is_pvip":false,"replies":[{"id":"12690","content":"当然不是。pause和sidecar没有任何区别。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1540742365,"ip_address":"","comment_id":35630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14425619687","product_id":100015201,"comment_content":"关于pod还有一事请教，之前老师说过pod所有进出流量都会经pause这个根容器，那么是否可以这样理解，实现service mesh的最佳方式是扩展这个根容器的功能来做流量控制和路由，这比再注入一个envoy要更加底层，更加原生？","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427606,"discussion_content":"当然不是。pause和sidecar没有任何区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540742365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27351,"user_name":"loda","can_delete":false,"product_type":"c1","uid":1043287,"ip_address":"","ucode":"3F9575DBFA1031","user_header":"https://static001.geekbang.org/account/avatar/00/0f/eb/57/3032e1a7.jpg","comment_is_top":false,"comment_ctime":1537876343,"is_pvip":false,"replies":[{"id":"9849","content":"这个不难处理，后面专门有讲解scaling的文章","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537886606,"ip_address":"","comment_id":27351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14422778231","product_id":100015201,"comment_content":"请教个问题，当资源不足的时候，在调用k8s扩容会出现失败，然后一直pending，表示资源不够。怎么能在请求失败前提前检测到该现象呢，避免在继续出现pending请求？<br><br>如果要每次扩容前都全量扫描一个所有pod和node，然后计算剩余资源，开销也太大了；<br>如果要维护一个和kube-scheduler缓存一致的资源池，会不会又出现数据不一致的问题<br><br>业界在碰到该类问题的时候，都是怎么处理的呢？","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424887,"discussion_content":"这个不难处理，后面专门有讲解scaling的文章","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537886606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63560,"user_name":"zhyErick","can_delete":false,"product_type":"c1","uid":1197176,"ip_address":"","ucode":"88373FE24B8FA6","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/78/fb804977.jpg","comment_is_top":false,"comment_ctime":1548400595,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10138335187","product_id":100015201,"comment_content":"我在master节点看到的kube-apiserver指定参数<br>[root@node1 ~]# ps aux | grep apiserver<br>root      34049  4.1  8.4 421360 340828 ?       Ssl  21:21   0:44 kube-apiserver --authorization-mode=Node,RBAC --runtime-config=api&#47;all=true --advertise-address=172.101.0.10 --allow-privileged=true --client-ca-file=&#47;etc&#47;kubernetes&#47;pki&#47;ca.crt --disable-admission-plugins=PersistentVolumeLabel --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=&#47;etc&#47;kubernetes&#47;pki&#47;etcd&#47;ca.crt --etcd-certfile=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver-etcd-client.crt --etcd-keyfile=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver-etcd-client.key --etcd-servers=https:&#47;&#47;127.0.0.1:2379 --insecure-port=0 --kubelet-client-certificate=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver-kubelet-client.crt --kubelet-client-key=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=&#47;etc&#47;kubernetes&#47;pki&#47;front-proxy-client.crt --proxy-client-key-file=&#47;etc&#47;kubernetes&#47;pki&#47;front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=&#47;etc&#47;kubernetes&#47;pki&#47;front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-key-file=&#47;etc&#47;kubernetes&#47;pki&#47;sa.pub --service-cluster-ip-range=10.96.0.0&#47;12 --tls-cert-file=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver.crt --tls-private-key-file=&#47;etc&#47;kubernetes&#47;pki&#47;apiserver.key --feature-gates=PodShareProcessNamespace=true<br><br>--feature-gates=PodShareProcessNamespace=true是我修改&#47;etc&#47;kubernetes&#47;manifests&#47;kube-apiserver.yaml 添加的<br><br>但是还是看不到nginx的进程<br>[root@node1 ~]# kubectl attach -it nginx -c shell<br>If you don&#39;t see a command prompt, try pressing enter.<br>&#47; # ps aux<br>PID   USER     TIME  COMMAND<br>    1 root      0:00 sh<br>    5 root      0:00 ps aux","like_count":2},{"had_liked":false,"id":48833,"user_name":"王天明","can_delete":false,"product_type":"c1","uid":1012262,"ip_address":"","ucode":"60C51851C73A37","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/26/7387fc89.jpg","comment_is_top":false,"comment_ctime":1544546996,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10134481588","product_id":100015201,"comment_content":"张老师，有一个问题，在使用kubeadm安装后，我查看etc与apiserver的信息，发现他们俩的ip都是宿主机内网IP，同时在apiserver中有关etc的地址写的是127.0.0.1,很是纳闷，又重要找到这节课程，是因为作了如下设置了吗？<br>hostNetwork: true <br>hostIPC: true<br>hostPID: true","like_count":2},{"had_liked":false,"id":27563,"user_name":"Vincen","can_delete":false,"product_type":"c1","uid":1218185,"ip_address":"","ucode":"1029A901EC7BA0","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/89/9312b3a2.jpg","comment_is_top":false,"comment_ctime":1537921773,"is_pvip":false,"replies":[{"id":"9998","content":"这个字段为啥不能用？","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537938513,"ip_address":"","comment_id":27563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127856365","product_id":100015201,"comment_content":"pod对象中的有些字段不能够在deployment中使用比如文章中提到的HostAliases，我们通常使用deployment来部署pod。这种情况怎么办？","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424947,"discussion_content":"这个字段为啥不能用？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537938513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27425,"user_name":"JefferLiu","can_delete":false,"product_type":"c1","uid":1213125,"ip_address":"","ucode":"3186C9CCC8AEF6","user_header":"https://static001.geekbang.org/account/avatar/00/12/82/c5/4152b39e.jpg","comment_is_top":false,"comment_ctime":1537885705,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10127820297","product_id":100015201,"comment_content":"停止服务，即对外不再提供服务，这种情况可以发生在容器内的服务需要获取某种资源但获取不到又在不断重试。","like_count":2},{"had_liked":false,"id":27328,"user_name":"虎虎❤️","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1537872094,"is_pvip":false,"replies":[{"id":"9872","content":"文件系统是隔离的呀","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537887622,"ip_address":"","comment_id":27328,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127806686","product_id":100015201,"comment_content":"老师，pod的&#47;etc&#47;hosts文件怎么理解？是pause 容器的文件吗？","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424879,"discussion_content":"文件系统是隔离的呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537887622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26849,"user_name":"gogo","can_delete":false,"product_type":"c1","uid":1003104,"ip_address":"","ucode":"E8F0F3B000020A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/60/0d5aa340.jpg","comment_is_top":false,"comment_ctime":1537762596,"is_pvip":false,"replies":[{"id":"9747","content":"先让子弹飞一会儿","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537789852,"ip_address":"","comment_id":26849,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10127697188","product_id":100015201,"comment_content":"老师您好，您提出的思考题能以java web解释下原因吗？还没实践过，想知道答案，谢谢","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424739,"discussion_content":"先让子弹飞一会儿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537789852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52617,"user_name":"橄榄树","can_delete":false,"product_type":"c1","uid":1030751,"ip_address":"","ucode":"74F6272CD0B3D0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/5f/bab32b7a.jpg","comment_is_top":false,"comment_ctime":1545455042,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5840422338","product_id":100015201,"comment_content":"老师 和你同样的版本为什么shareProcessNamespace不起作用呢？","like_count":1},{"had_liked":false,"id":26896,"user_name":"hugeo","can_delete":false,"product_type":"c1","uid":1042824,"ip_address":"","ucode":"438F289EDD21CD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/88/941e488a.jpg","comment_is_top":false,"comment_ctime":1537771613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5832738909","product_id":100015201,"comment_content":"springboot启动的时候报错了，服务没起起来，但是pod是running","like_count":1},{"had_liked":false,"id":26788,"user_name":"咕噜男爵-Tony","can_delete":false,"product_type":"c1","uid":1219258,"ip_address":"","ucode":"8C841851AC767F","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/ba/f5eb2a66.jpg","comment_is_top":false,"comment_ctime":1537754666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5832721962","product_id":100015201,"comment_content":"中秋快乐<br><br>看了老师的讲解，对Pod的认识更全面了，把Pod看做虚拟机，确实很形象，以前对Pod的疑惑都没了","like_count":1},{"had_liked":false,"id":26760,"user_name":"AFA","can_delete":false,"product_type":"c1","uid":1228333,"ip_address":"","ucode":"4D3CEA4B8DCB1E","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/2d/befd19a6.jpg","comment_is_top":false,"comment_ctime":1537751851,"is_pvip":false,"replies":[{"id":"9721","content":"pod版本早就固定下来啦，v1","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537760131,"ip_address":"","comment_id":26760,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5832719147","product_id":100015201,"comment_content":"您好，pod结构体的文件目录是不是要指定kuber版本号？不指定版本号是不是有可能找不到？","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424727,"discussion_content":"pod版本早就固定下来啦，v1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537760131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353689,"user_name":"penng","can_delete":false,"product_type":"c1","uid":1033169,"ip_address":"重庆","ucode":"6087CFCB0AC434","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","comment_is_top":false,"comment_ctime":1659684025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659684025","product_id":100015201,"comment_content":"安装ceph后，status字段看还有个：Completed ","like_count":0},{"had_liked":false,"id":347718,"user_name":"L君","can_delete":false,"product_type":"c1","uid":2769903,"ip_address":"","ucode":"367C49C2742424","user_header":"https://static001.geekbang.org/account/avatar/00/2a/43/ef/da7a32df.jpg","comment_is_top":false,"comment_ctime":1654345354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654345354","product_id":100015201,"comment_content":"有个问题想请教下老师，老师在文中指出，凡是跟容器的 Linux Namespace 相关的属性，也一定是 Pod 级别的。既然如此，为什么还要显式定义PID namespace = true，pod里面的容器才共享pid namespace？<br>shareProcessNamespace=true","like_count":0},{"had_liked":false,"id":343165,"user_name":"Nio","can_delete":false,"product_type":"c1","uid":1529642,"ip_address":"","ucode":"A1B8D3C01FB937","user_header":"https://static001.geekbang.org/account/avatar/00/17/57/2a/c6c95f37.jpg","comment_is_top":false,"comment_ctime":1650684646,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1650684646","product_id":100015201,"comment_content":"所以标题的基本概念是指pod的一些属性定义吗  <br>是指pod的基本概念还是pod里面的一些基本概念呢，这点没太理解。","like_count":0},{"had_liked":false,"id":321801,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1637049702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637049702","product_id":100015201,"comment_content":"在熟悉了 Pod 以及它的 Container 部分的主要字段之后，我再和你分享一下这样一个的 Pod 对象在 Kubernetes 中的生命周期。Pod 生命周期的变化，主要体现在 Pod API 对象的 Status 部分，这是它除了 Metadata 和 Spec 之外的第三个重要字段。其中，pod.status.phase，就是 Pod 的当前状态，它有如下几种可能的情况：Pending。这个状态意味着，Pod 的 YAML 文件已经提交给了 Kubernetes，API 对象已经被创建并保存在 Etcd 当中。但是，这个 Pod 里有些容器因为某种原因而不能被顺利创建。比如，调度不成功。Running。这个状态下，Pod 已经调度成功，跟一个具体的节点绑定。它包含的容器都已经创建成功，并且至少有一个正在运行中。Succeeded。这个状态意味着，Pod 里的所有容器都正常运行完毕，并且已经退出了。这种情况在运行一次性任务时最为常见。Failed。这个状态下，Pod 里至少有一个容器以不正常的状态（非 0 的返回码）退出。这个状态的出现，意味着你得想办法 Debug 这个容器的应用，比如查看 Pod 的 Events 和日志。Unknown。这是一个异常状态，意味着 Pod 的状态不能持续地被 kubelet 汇报给 kube-apiserver，这很有可能是主从节点（Master 和 Kubelet）间的通信出现了问题。","like_count":0},{"had_liked":false,"id":321800,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1637049690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637049690","product_id":100015201,"comment_content":"除了上述跟“机器”相关的配置外，你可能也会发现，凡是跟容器的 Linux Namespace 相关的属性，也一定是 Pod 级别的。这个原因也很容易理解：Pod 的设计，就是要让它里面的容器尽可能多地共享 Linux Namespace，仅保留必要的隔离和限制能力。这样，Pod 模拟出的效果，就跟虚拟机里程序间的关系非常类似了。","like_count":0},{"had_liked":false,"id":309330,"user_name":"Tr","can_delete":false,"product_type":"c1","uid":2011065,"ip_address":"","ucode":"CB52D918C0586E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/af/b9/cf22a1fd.jpg","comment_is_top":false,"comment_ctime":1630050318,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1630050318","product_id":100015201,"comment_content":"比如，我用pod 拉起一个服务，但是后面该服务不具备对外服务能力。但是pod不知道我的服务是不是正常运行的（即正常对外提供服务）。这时候就需要一种探针，来检测我的服务是不是健康的。<br>场景如下：<br>服务启动是会创建一个 master 服务，然后master 服务会创建多个 worker 服务，接下来所有业务处理都是经过 worker 服务的，可是我不小心 写了一个 bug,导致所有的 worker 服务被 killed。","like_count":0},{"had_liked":false,"id":284909,"user_name":"罗杰","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1616540269,"is_pvip":false,"discussion_count":2,"race_medal":2,"score":"1616540269","product_id":100015201,"comment_content":"NodeName: 一旦被赋值，K8S 项目会认为这个 Pod 已经经过调度，这是为啥呢？","like_count":0,"discussions":[{"author":{"id":2589474,"avatar":"https://static001.geekbang.org/account/avatar/00/27/83/22/a44b65f5.jpg","nickname":"JamonJou","note":"","ucode":"C77E647E2FA7A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543036,"discussion_content":"nodeName 是节点选择约束的最简单方法，但是由于其自身限制，通常不使用它。 nodeName 是 PodSpec 的一个字段。 如果它不为空，调度器将忽略 Pod，并且给定节点上运行的 kubelet 进程尝试执行该 Pod。 因此，如果 nodeName 在 PodSpec 中指定了，则它优先于上面的节点选择方法。\n\n使用 nodeName 来选择节点的一些限制：\n\n如果指定的节点不存在，\n如果指定的节点没有资源来容纳 Pod，Pod 将会调度失败并且其原因将显示为， 比如 OutOfmemory 或 OutOfcpu。\n云环境中的节点名称并非总是可预测或稳定的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640936714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2343027,"avatar":"","nickname":"Geek_74ca97","note":"","ucode":"936C94154651FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381456,"discussion_content":"看官网  有三种办法可以手动调度  nodename  nodeselector   还有污点容忍度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625063529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283919,"user_name":"nullptr","can_delete":false,"product_type":"c1","uid":1283847,"ip_address":"","ucode":"D309EABB70F0BF","user_header":"https://static001.geekbang.org/account/avatar/00/13/97/07/7406fe30.jpg","comment_is_top":false,"comment_ctime":1615983869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615983869","product_id":100015201,"comment_content":"实例的yaml部署会报错：<br>Failed to pull image &quot;busybox&quot;: rpc error: code = Unknown desc = toomanyrequests: You have reached your pull rate limit. You may increase the limit by authenticating and upgrading: https:&#47;&#47;www.docker.com&#47;increase-rate-limit<br>Failed to pull image &quot;nginx&quot;: rpc error: code = Unknown desc = toomanyrequests: You have reached your pull rate limit. You may increase the limit by authenticating and upgrading: https:&#47;&#47;www.docker.com&#47;increase-rate-limit","like_count":0},{"had_liked":false,"id":267777,"user_name":"旺旺","can_delete":false,"product_type":"c1","uid":1227639,"ip_address":"","ucode":"2067D3BCCA7C0A","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/77/e1391dd8.jpg","comment_is_top":false,"comment_ctime":1607925502,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607925502","product_id":100015201,"comment_content":"老师太厉害了，看了很多文章，这个是最详细而且易懂得","like_count":0},{"had_liked":false,"id":252481,"user_name":"..e","can_delete":false,"product_type":"c1","uid":1990323,"ip_address":"","ucode":"CECD1B801DB620","user_header":"https://static001.geekbang.org/account/avatar/00/1e/5e/b3/e35e5d3c.jpg","comment_is_top":false,"comment_ctime":1602316612,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602316612","product_id":100015201,"comment_content":"一个 db pod是running状态，但是pod中的应用容器与infra容器都是exited(255)状态，结果是svc 与pod_ip都不通，但进入pod中以127.0.0.1链接数据库发现一切正常，奇怪的是此时的pod却一直是running状态","like_count":0},{"had_liked":false,"id":243104,"user_name":"我爱吃桃子","can_delete":false,"product_type":"c1","uid":1728278,"ip_address":"","ucode":"897172BD6987CF","user_header":"https://static001.geekbang.org/account/avatar/00/1a/5f/16/e0946ab5.jpg","comment_is_top":false,"comment_ctime":1597967561,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597967561","product_id":100015201,"comment_content":"老师，我想问一个问题，就是我之前遇到pod是runing但是服务不好的情况是因为endpoint掉了，然后通过重启deployment和service解决了这个问题，但是endpoint为什么掉却不太清楚，希望老师能解答下","like_count":0},{"had_liked":false,"id":239598,"user_name":"大力水手Jerry","can_delete":false,"product_type":"c1","uid":1227840,"ip_address":"","ucode":"E4A6C71E275DB5","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/40/2279cfb5.jpg","comment_is_top":false,"comment_ctime":1596593738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596593738","product_id":100015201,"comment_content":"&quot;它指的是，在容器启动后，立刻执行一个指定的操作。需要明确的是，postStart 定义的操作，虽然是在 Docker 容器 ENTRYPOINT 执行之后，但它并不严格保证顺序。也就是说，在 postStart 启动时，ENTRYPOINT 有可能还没有结束。&quot;有点疑问，原文档是“This hook executes immediately after a container is created. However, there is no guarantee that the hook will execute before the container ENTRYPOINT. ”，postStart会在创建容器时立刻执行，这个“创建容器”与ENTRYPOINT执行是等价关系吗？","like_count":0},{"had_liked":false,"id":239177,"user_name":"Karl Liu","can_delete":false,"product_type":"c1","uid":1941264,"ip_address":"","ucode":"77AFB9D233342D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9f/10/0f714ea1.jpg","comment_is_top":false,"comment_ctime":1596453322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596453322","product_id":100015201,"comment_content":"看官方文档默认拉取策略是IfNotPresent","like_count":0},{"had_liked":false,"id":238929,"user_name":"Geek_b52974","can_delete":false,"product_type":"c1","uid":1298252,"ip_address":"","ucode":"59884399646620","user_header":"","comment_is_top":false,"comment_ctime":1596373341,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1596373341","product_id":100015201,"comment_content":"condition ready 描述的是服务是否接收 request<br>而 running 则是至少有一个 container 正在被启动，但不一定代表可以接收 request","like_count":0},{"had_liked":false,"id":226593,"user_name":"晞月520","can_delete":false,"product_type":"c1","uid":1845394,"ip_address":"","ucode":"4F05E02A5C1608","user_header":"https://static001.geekbang.org/account/avatar/00/1c/28/92/436735f5.jpg","comment_is_top":false,"comment_ctime":1592147254,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592147254","product_id":100015201,"comment_content":"大佬带我飞啊 ","like_count":0},{"had_liked":false,"id":209928,"user_name":"辉晖","can_delete":false,"product_type":"c1","uid":1574062,"ip_address":"","ucode":"E5EC033EE4952B","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","comment_is_top":false,"comment_ctime":1587636873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587636873","product_id":100015201,"comment_content":"部署存储插件。状态一直是Init:0&#47;2<br>Unable to attach or mount volumes: unmounted volumes=[rook-ceph-crash-collector-keyring], unattached volumes=[default-token-8f4fl rook-ceph-crash-collector-keyring rook-config-override rook-ceph-log rook-ceph-crash]: timed out waiting for the condition<br>手动创建了目录也没用","like_count":0},{"had_liked":false,"id":201308,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1585748727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585748727","product_id":100015201,"comment_content":"打卡。以前在项目中tomcat里启动了多线程，主程序因为bug原因报错了，其它线程在健康运行，就是退出不了。导至web无法访问。","like_count":0},{"had_liked":false,"id":199472,"user_name":"余向华","can_delete":false,"product_type":"c1","uid":1119778,"ip_address":"","ucode":"263773616D2C83","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/22/2205cf0a.jpg","comment_is_top":false,"comment_ctime":1585489899,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585489899","product_id":100015201,"comment_content":"通俗易懂","like_count":0},{"had_liked":false,"id":152604,"user_name":"xiaoxlm_0807","can_delete":false,"product_type":"c1","uid":1586508,"ip_address":"","ucode":"32B587038282BC","user_header":"","comment_is_top":false,"comment_ctime":1574048783,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574048783","product_id":100015201,"comment_content":"思考题:<br>服务程序crash了，或者panic。","like_count":0},{"had_liked":false,"id":143182,"user_name":"giantbroom","can_delete":false,"product_type":"c1","uid":1059516,"ip_address":"","ucode":"7258784193C302","user_header":"","comment_is_top":false,"comment_ctime":1571643577,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1571643577","product_id":100015201,"comment_content":"请教一个问题，对于prestop来说，如果由于container的不正常退出（比如OOM），导致pod recreated，这种情况下prestop是否还生效？我们生产环境曾出现过由于container OOM是pod被不断的重建，怎样查看之前pod的log呢？谢谢","like_count":0},{"had_liked":false,"id":141154,"user_name":"hughieyu","can_delete":false,"product_type":"c1","uid":1206690,"ip_address":"","ucode":"FC1A64B2BAB784","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/a2/c30ac459.jpg","comment_is_top":false,"comment_ctime":1571124887,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571124887","product_id":100015201,"comment_content":"为啥设置hostNetwork: true 之后n面的网卡的 pod里面显示的是0.0.0.0:80 但是在宿主机看不到这个socket监听 但是却可以访问通 ","like_count":0},{"had_liked":false,"id":136531,"user_name":"MarkFeng","can_delete":false,"product_type":"c1","uid":1220152,"ip_address":"","ucode":"82968C267E4D21","user_header":"https://static001.geekbang.org/account/avatar/00/12/9e/38/2dbe5f46.jpg","comment_is_top":false,"comment_ctime":1569465700,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569465700","product_id":100015201,"comment_content":"看官方文档的优雅退出流程，有处疑问：<br>pod进入`terminating`状态时，配了prestop的容器会执行prestop操作，在grace period之后未退出会收到SIGTERM并延期2s，之后再未退出，接收SIGKILL信号<br><br>疑问：grace period不是应该是接收到SIGTERM之后的优雅退出时间吗，为何会先于接收SIGTERM信号之前就开始计时？<br>","like_count":0},{"had_liked":false,"id":135880,"user_name":"坤","can_delete":false,"product_type":"c1","uid":1010922,"ip_address":"","ucode":"74E6838226A405","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/ea/ce9854a5.jpg","comment_is_top":false,"comment_ctime":1569292046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569292046","product_id":100015201,"comment_content":"请问，lifecycle中Hooks定义的command中，“&#47;bin&#47;shell” 位于哪里？是启动成功的container中的吗？","like_count":0},{"had_liked":false,"id":128536,"user_name":"小江哥哥","can_delete":false,"product_type":"c1","uid":1044266,"ip_address":"","ucode":"E5B3725FC9E366","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/2a/e9c5c163.jpg","comment_is_top":false,"comment_ctime":1566897727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566897727","product_id":100015201,"comment_content":"可以通过liveness和readiness间接监控java web进程，不过貌似目前只有重启策略，在单副本的情况下要谨慎，而且这种方式治标不治本，我们可以内置一些JVM的监控代理（比如阿里的arthas）来发现问题根源","like_count":0},{"had_liked":false,"id":109998,"user_name":"iGeneral","can_delete":false,"product_type":"c1","uid":1274314,"ip_address":"","ucode":"F7EA381C34955E","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/ca/87688ff9.jpg","comment_is_top":false,"comment_ctime":1562147618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562147618","product_id":100015201,"comment_content":"代码库，不types不再v1 看到的在core里面","like_count":0},{"had_liked":false,"id":93951,"user_name":"小吴","can_delete":false,"product_type":"c1","uid":1233497,"ip_address":"","ucode":"E6F5FB9AE862EA","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/59/7fa6ab95.jpg","comment_is_top":false,"comment_ctime":1557675245,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1557675245","product_id":100015201,"comment_content":"$GOPATH&#47;src&#47;k8s.io&#47;kubernetes&#47;vendor&#47;k8s.io&#47;api&#47;core&#47;v1&#47;types.go 这个地址是？~","like_count":0,"discussions":[{"author":{"id":1002731,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4c/eb/73b45431.jpg","nickname":"lanlyhs","note":"","ucode":"C7FDAECE5A8494","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13595,"discussion_content":"here: https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/api/core/v1/types.go","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1568688428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93095,"user_name":"紫薯糯米圆子","can_delete":false,"product_type":"c1","uid":1173224,"ip_address":"","ucode":"910813976847E7","user_header":"https://static001.geekbang.org/account/avatar/00/11/e6/e8/7085e65e.jpg","comment_is_top":false,"comment_ctime":1557396952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557396952","product_id":100015201,"comment_content":"这玩意儿有pdf版本吗","like_count":0},{"had_liked":false,"id":89278,"user_name":"Dy","can_delete":false,"product_type":"c1","uid":1305969,"ip_address":"","ucode":"6A572632ECAC6F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ed/71/6292e0c2.jpg","comment_is_top":false,"comment_ctime":1556136660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556136660","product_id":100015201,"comment_content":"老师好，问下一个pod里面的容器a和b,a如果需要访问b容器的命令该怎么操作","like_count":0},{"had_liked":false,"id":80389,"user_name":"","can_delete":false,"product_type":"c1","uid":1154194,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1553654623,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553654623","product_id":100015201,"comment_content":" 您好，我想咨询一个问题，kubectl get pod --all-namespaces -o wide 里面的RESTARTS列，下面的0和1分别代表什么意思？不太明白","like_count":0,"discussions":[{"author":{"id":1237986,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e3/e2/2b56a802.jpg","nickname":"菠萝睡不醒","note":"","ucode":"7E3884FD402ED1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404807,"discussion_content":"重启的次数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634405323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77341,"user_name":"李昂纳多.奥斯特洛夫斯基","can_delete":false,"product_type":"c1","uid":1445486,"ip_address":"","ucode":"3E2B76117ABBAB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0e/6e/3d3661c3.jpg","comment_is_top":false,"comment_ctime":1552909977,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552909977","product_id":100015201,"comment_content":"poststart解释的是不是有些问题，官方说的是在容器创建时就会执行poststart，但不能保证在entrypoint前执行","like_count":0,"discussions":[{"author":{"id":2589474,"avatar":"https://static001.geekbang.org/account/avatar/00/27/83/22/a44b65f5.jpg","nickname":"JamonJou","note":"","ucode":"C77E647E2FA7A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543019,"discussion_content":"Kubernetes 在容器创建后立即发送 postStart 事件。 然而，postStart 处理函数的调用不保证早于容器的入口点（entrypoint） 的执行。postStart 处理函数与容器的代码是异步执行的，但 Kubernetes 的容器管理逻辑会一直阻塞等待 postStart 处理函数执行完毕。 只有 postStart 处理函数执行完毕，容器的状态才会变成 RUNNING。\n\nKubernetes 在容器结束前立即发送 preStop 事件。除非 Pod 宽限期限超时，Kubernetes 的容器管理逻辑 会一直阻塞等待 preStop 处理函数执行完毕。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640933729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73393,"user_name":"李俊江","can_delete":false,"product_type":"c1","uid":1199180,"ip_address":"","ucode":"847CC3AB42AE4B","user_header":"https://static001.geekbang.org/account/avatar/00/12/4c/4c/5bcacf3a.jpg","comment_is_top":false,"comment_ctime":1551876545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551876545","product_id":100015201,"comment_content":"现在Succeed状态标签貌似被改成Completed了","like_count":0},{"had_liked":false,"id":68570,"user_name":"雪消魂","can_delete":false,"product_type":"c1","uid":1218648,"ip_address":"","ucode":"E258BEDD515A77","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/58/18925dd3.jpg","comment_is_top":false,"comment_ctime":1550546007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550546007","product_id":100015201,"comment_content":"即使某个服务存在多个副本，会不会存在这多个副本调度在了相同的node上，这种情况下node宕机了，服务是不是就会中断一段时间（直到副本在其他node上<br>被重新调度）？这个情况如何避免","like_count":0},{"had_liked":false,"id":64603,"user_name":"禹声","can_delete":false,"product_type":"c1","uid":1367905,"ip_address":"","ucode":"58BAA42CE3C8EC","user_header":"https://static001.geekbang.org/account/avatar/00/14/df/61/9b88986e.jpg","comment_is_top":false,"comment_ctime":1548833720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548833720","product_id":100015201,"comment_content":"请问Pod中的HostAliases设置了之后，在启动之后，是该Pod中的容器的host都被修改了吗<br>","like_count":0},{"had_liked":false,"id":36307,"user_name":"Farrell","can_delete":false,"product_type":"c1","uid":1228074,"ip_address":"","ucode":"6E73A217A7144C","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/2a/7cdd71fd.jpg","comment_is_top":false,"comment_ctime":1541034336,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541034336","product_id":100015201,"comment_content":"有遇到过Pod的状态是 Running，但是应用其实已经停止服务的情况，而且困扰我至今。我用deployment启了部署，只维护1个pod实例，pod中的进程会调用到外部的nfs服务，当出现网络不稳定的情况时，进程会变为不可中断睡眠（Disk Sleeping）状态，如果在这个时候删除deployment，pod不会被删除而且之后也删不掉，虽然用kubectl命令查看会发现这个pod的状态是Terminated，但是这个pod的status.phase是Running。目前遇到这种情况我只知道重启pod所在节点可以解决这个问题，可是这样又会影响到节点上的其他程序。","like_count":0},{"had_liked":false,"id":34446,"user_name":"Caesar","can_delete":false,"product_type":"c1","uid":1253220,"ip_address":"","ucode":"0319C9E19387CD","user_header":"https://static001.geekbang.org/account/avatar/00/13/1f/64/54458855.jpg","comment_is_top":false,"comment_ctime":1540173226,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1540173226","product_id":100015201,"comment_content":"开启shareProcessNamespace后，ll &#47;proc&#47;${容器进程}ns，发现pause容器，nginx容器，以及busybox容器的pid namespace都不相同，这是怎么回事？","like_count":0},{"had_liked":false,"id":30725,"user_name":"奇奇不怪","can_delete":false,"product_type":"c1","uid":1227593,"ip_address":"","ucode":"582209B854590E","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/49/975d4569.jpg","comment_is_top":false,"comment_ctime":1538983677,"is_pvip":false,"replies":[{"id":"11067","content":"可以先检查一下kubelet log","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539001257,"ip_address":"","comment_id":30725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538983677","product_id":100015201,"comment_content":"你好，我看了评论去的很多遇到了实验结果和文章中的不符合，我根据你的回复查看了api-service的配置，默认是有一个--feature-gates=AllAlpha=true。这个应该就是你说的1.11默认开启的参数吧，但是我还是看不到nginx的进程。这会是什么原因造成的。","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426073,"discussion_content":"可以先检查一下kubelet log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539001257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29252,"user_name":"eason2017","can_delete":false,"product_type":"c1","uid":1009422,"ip_address":"","ucode":"E070BA624FA490","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/0e/c77ad9b1.jpg","comment_is_top":false,"comment_ctime":1538305260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538305260","product_id":100015201,"comment_content":"好文章顶！","like_count":0},{"had_liked":false,"id":28753,"user_name":"旺旺","can_delete":false,"product_type":"c1","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1538140322,"is_pvip":false,"replies":[{"id":"10373","content":"可能屏幕适配的问题","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538179053,"ip_address":"","comment_id":28753,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538140322","product_id":100015201,"comment_content":"nginx的yaml文件，后面几行好像少了2个空格缩进，应该是下面这样的吧：<br>root@k8s-master:~&#47;k8s# cat nginx.yaml <br>apiVersion: v1<br>kind: Pod<br>metadata:<br> name: nginx<br>spec:<br> shareProcessNamespace: true<br> containers:<br> - name: nginx<br>   image: nginx<br> - name: shell<br>   image: busybox<br>   stdin: true<br>   tty: true<br>","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425367,"discussion_content":"可能屏幕适配的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538179053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28548,"user_name":"刘家兴","can_delete":false,"product_type":"c1","uid":1064035,"ip_address":"","ucode":"453EB6F23A527D","user_header":"https://static001.geekbang.org/account/avatar/00/10/3c/63/95fadffe.jpg","comment_is_top":false,"comment_ctime":1538101690,"is_pvip":false,"replies":[{"id":"10292","content":"这是个新功能，你确定一下集群版本，还有是不是开启了","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538116320,"ip_address":"","comment_id":28548,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538101690","product_id":100015201,"comment_content":"error: error validating &quot;liujx-nginx-pod-shareProcessNamespace.yaml&quot;: error validating data: ValidationError(Pod.spec): unknown field &quot;shareProcessNamespace&quot; in io.k8s.api.core.v1.PodSpec; if you choose to ignore these errors, turn validation off with --validate=false<br><br>老师这是咋回事儿","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425303,"discussion_content":"这是个新功能，你确定一下集群版本，还有是不是开启了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538116320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28191,"user_name":"龙坤","can_delete":false,"product_type":"c1","uid":1233455,"ip_address":"","ucode":"D1724E68D6304D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","comment_is_top":false,"comment_ctime":1538018356,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1538018356","product_id":100015201,"comment_content":"NAME                                                         READY     STATUS             RESTARTS   AGE<br>coredns-78fcdf6894-f6gn5                     0&#47;1       CrashLoopBackOff   12         45m<br>coredns-78fcdf6894-hnnbf                     0&#47;1       CrashLoopBackOff   12         45m<br><br>NAME                                                          ADY     STATUS    RESTARTS   AGE<br>coredns-78fcdf6894-f6gn5                     1&#47;1       Running   12         42m<br>coredns-78fcdf6894-hnnbf                     1&#47;1       Running   12         42m<br><br>Events信息：<br>Message<br>----------------<br>0&#47;1 nodes are available: 1 node(s) were not ready.<br>Successfully assigned kube-system&#47;coredns-78fcdf6894-f6gn5 to zcloud-13-3-master<br>Container image &quot;k8s.gcr.io&#47;coredns:1.1.3&quot; already present on machine<br>Created container<br>Started container<br>Killing container with id docker:&#47;&#47;coredns:Container failed liveness probe.. Container will be killed and recreated.<br>Liveness probe failed: HTTP probe failed with statuscode: 503<br>Back-off restarting failed container<br><br>问题：这个pod有时候 0&#47;1 有时候  1&#47;1。不知道什么原因，望老师指点下","like_count":0},{"had_liked":false,"id":28051,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1537983139,"is_pvip":false,"replies":[{"id":"10122","content":"你要是愿意的话，可以找到好几份呢 :-)","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538018266,"ip_address":"","comment_id":28051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1537983139","product_id":100015201,"comment_content":"k8s pod type struct 路径改了，最新的路径在： kubernetes&#47;staging&#47;src&#47;k8s.io&#47;api&#47;core&#47;v1&#47;types.go","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425127,"discussion_content":"你要是愿意的话，可以找到好几份呢 :-)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538018266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":27344,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1537875044,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537875044","product_id":100015201,"comment_content":"Yaml文件kind赋值为Pod，会存在单点问题吧。如果这个Pod挂掉了，对应的服务也会挂掉。在生产环境中，使用Deployment，启用多个pod副本。可以讲讲这个高可用问题","like_count":0},{"had_liked":false,"id":27054,"user_name":"古董级大叔","can_delete":false,"product_type":"c1","uid":1219960,"ip_address":"","ucode":"6B1AD15A5A1B64","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bfg5tgic873jl1ZWBc4Cp098c8aLSf8cjyRv27icu0CptJJmPeNYibWHDT6ZKLZ8Pj3CrlFiaPh3wag16nTp48EOyw/132","comment_is_top":false,"comment_ctime":1537805950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1537805950","product_id":100015201,"comment_content":"actuator健康检查为down的时候，服务已经不能服务了，但是服务还是启动的","like_count":0},{"had_liked":false,"id":26949,"user_name":"巩夫建","can_delete":false,"product_type":"c1","uid":1222958,"ip_address":"","ucode":"6B06A4399D2338","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/2e/01b2839e.jpg","comment_is_top":false,"comment_ctime":1537782272,"is_pvip":false,"replies":[{"id":"9864","content":"调度部分自会介绍。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537887056,"ip_address":"","comment_id":26949,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1537782272","product_id":100015201,"comment_content":"中秋节快乐，感谢作者地产出。知识点很丰富，对实际工作帮助很大。有个标签的问题求解一下，如果node1打了标签ssd，其他node没有打标签，如果一个没有标记标签的pod，在资源充足的情况下会偶发部署到node1上吗？如果资源不充足，会去占用node1的资源吗？<br>回答作业题，java的项目经常由于oom，导致pod正常，里面的子进程被kill掉。现在是关闭oom，是否有其他更优方案?","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424769,"discussion_content":"调度部分自会介绍。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537887056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":26948,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1223046,"ip_address":"","ucode":"61CFE863E8E6D1","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/86/8211935c.jpg","comment_is_top":false,"comment_ctime":1537781885,"is_pvip":false,"replies":[{"id":"9866","content":"嗯，这正是一个常见情况。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1537887077,"ip_address":"","comment_id":26948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1537781885","product_id":100015201,"comment_content":"思考题是Java web项目内存溢出？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424768,"discussion_content":"嗯，这正是一个常见情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537887077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}