{"id":408762,"title":"07 | Mock æ¡†æ¶ï¼šæ€ä¹ˆè®©æµ‹è¯•å˜å¾—å¯æ§ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ‘æ™”ï¼</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬è°ˆåˆ°æµ‹è¯•ä¸å¥½æµ‹ï¼Œå…³é”®æ˜¯è½¯ä»¶è®¾è®¡é—®é¢˜ã€‚ä¸€ä¸ªå¥½çš„è®¾è®¡å¯ä»¥æŠŠå¾ˆå¤šå®ç°ç»†èŠ‚ä»ä¸šåŠ¡ä»£ç ä¸­éš”ç¦»å‡ºå»ã€‚</p><p>ä¹‹æ‰€ä»¥è¦éš”ç¦»å‡ºå»ï¼Œä¸€ä¸ªé‡è¦çš„åŸå› å°±æ˜¯è¿™äº›å®ç°ç»†èŠ‚ä¸é‚£ä¹ˆå¯æ§ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä¾èµ–äº†æ•°æ®åº“ï¼Œå°±éœ€è¦ä¿è¯è¿™ä¸ªæ•°æ®åº“ç¯å¢ƒåŒæ—¶åªæœ‰ä¸€ä¸ªæµ‹è¯•åœ¨ç”¨ã€‚ç†è®ºä¸Šè¿™æ ·ä¸æ˜¯ä¸å¯èƒ½ï¼Œä½†æˆæœ¬ä¼šéå¸¸é«˜ã€‚å†æ¯”å¦‚ï¼Œå¦‚æœä¾èµ–äº†ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ²¡æ³•æ§åˆ¶å®ƒç»™æˆ‘ä»¬è¿”å›é¢„æœŸçš„å€¼ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¾ˆå¤šå‡ºé”™çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯èƒ½éƒ½æ²¡æ³•æµ‹è¯•ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨æµ‹è¯•é‡Œï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ–äºè¿™äº›å¥½ä¸å®¹æ˜“éš”ç¦»å‡ºå»çš„ç»†èŠ‚ã€‚å¦åˆ™ï¼Œæµ‹è¯•å°±ä¼šå˜å¾—ä¸ç¨³å®šï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šå›¢é˜Ÿæµ‹è¯•éš¾åšçš„é‡è¦åŸå› ã€‚ä¸ä¾èµ–äºè¿™äº›ç»†èŠ‚ï¼Œé‚£æˆ‘ä»¬çš„æµ‹è¯•æ€»éœ€è¦æœ‰ä¸€ä¸ªå®ç°å‡ºç°åœ¨æ‰€éœ€ç»„ä»¶çš„ä½ç½®ä¸Šå§ï¼Ÿæˆ–è®¸ä½ å·²ç»æƒ³åˆ°ç­”æ¡ˆäº†ï¼Œæ²¡é”™ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¿™ä¸€è®²è¦è®²çš„ Mock æ¡†æ¶ã€‚</p><h2>ä»æ¨¡å¼åˆ°æ¡†æ¶</h2><p><strong>åšæµ‹è¯•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸€ä¸ªå¯æ§çš„ç¯å¢ƒä¸‹å¯¹è¢«æµ‹ç³»ç»Ÿ/ç»„ä»¶è¿›è¡Œå„ç§è¯•æ¢ã€‚</strong>æ‹¥æœ‰å¤§é‡ä¾èµ–äºç¬¬ä¸‰æ–¹ä»£ç ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸å¯æ§ã€‚</p><p>æ€ä¹ˆæŠŠä¸å¯æ§å˜æˆå¯æ§ï¼Ÿç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯éš”ç¦»ï¼Œç¬¬äºŒæ­¥å°±æ˜¯ç”¨ä¸€ä¸ªå¯æ§çš„ç»„ä»¶ä»£æ›¿ä¸å¯æ§çš„ç»„ä»¶ã€‚æ¢è¨€ä¹‹ï¼Œç”¨ä¸€ä¸ªå‡çš„ç»„ä»¶ä»£æ›¿çœŸçš„ç»„ä»¶ã€‚</p><p>è¿™ç§ç”¨å‡ç»„ä»¶ä»£æ›¿çœŸç»„ä»¶çš„åšæ³•ï¼Œåœ¨æµ‹è¯•ä¸­å±¡è§ä¸é²œï¼Œå‡ ä¹æˆäº†æ ‡å‡†çš„åšæ³•ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå„ç§åšæ³•åˆæœ‰ç»†å¾®çš„å·®åˆ«ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ å»äº†è§£è¿™ä¸ªå…·ä½“åšæ³•ä¼šçœ‹åˆ°å¾ˆå¤šä¸åŒçš„åè¯ï¼Œæ¯”å¦‚ï¼šStubã€Dummyã€Fakeã€Spyã€Mock ç­‰ç­‰ã€‚å®è¯è¯´ï¼Œä½ ä»Šå¤©é—®æˆ‘è¿™äº›åè¯çš„å·®å¼‚ï¼Œæˆ‘ä¹Ÿéœ€è¦å»æŸ¥æ‰¾ç›¸å…³çš„èµ„æ–™ï¼Œä¸èƒ½ç»™å‡ºä¸€ä¸ªç«‹å³çš„ç­”å¤ã€‚å®ƒä»¬ä¹‹é—´ç¡®å®å­˜åœ¨å·®å¼‚ï¼Œä½†å·®å¼‚å‡ ä¹åˆ°äº†å¯ä»¥å¿½ç•¥ä¸è®¡çš„ä»½ä¸Šã€‚</p><!-- [[[read_end]]] --><p>Gerard Meszaros å†™è¿‡ä¸€æœ¬ã€Š<a href=\"https://book.douban.com/subject/1859393/\">xUnit Test Patterns</a>ã€‹ï¼Œä»–ç»™è¿™äº›åè¯èµ·äº†ä¸€ä¸ªç»Ÿä¸€çš„åå­—ï¼Œå½¢æˆäº†ä¸€ä¸ªæ–°çš„æ¨¡å¼ï¼š<a href=\"https://martinfowler.com/bliki/TestDouble.html\">Test Doubleï¼ˆæµ‹è¯•æ›¿èº«ï¼‰</a>ã€‚å…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0a/29/0a9ac08ddf1de69e90d917c36fe37929.jpg?wh=1188x721\" alt=\"\"></p><p>åœ¨è¿™ä¸ªå›¾é‡Œï¼ŒSUT æŒ‡çš„æ˜¯è¢«æµ‹ç³»ç»Ÿï¼ˆSystem Under Testï¼‰ï¼ŒTest Double å°±æ˜¯ä¸ SUT è¿›è¡Œäº¤äº’çš„ä¸€ä¸ªç»„ä»¶ã€‚æœ‰äº†æˆ‘ä»¬ä¹‹å‰çš„è®²è§£ï¼Œè¿™ä¸ªå›¾åº”è¯¥ä¸éš¾çœ‹æ‡‚ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¸ªåå­—ä¹Ÿæ²¡æœ‰åœ¨ä¸šç•Œå¾—åˆ°è¶³å¤Ÿå¹¿æ³›çš„ä¼ æ’­ï¼Œä½ æ›´ç†Ÿæ‚‰çš„è¯´æ³•åº”è¯¥æ˜¯ Mock å¯¹è±¡ã€‚å› ä¸ºåæ¥åœ¨è¿™ä¸ªæ¨¡å¼å¹¿æ³›æµè¡Œèµ·æ¥ä¹‹å‰ï¼ŒMock æ¡†æ¶å…ˆæµè¡Œäº†èµ·æ¥ã€‚</p><h2>Mock æ¡†æ¶</h2><p>Mock æ¡†æ¶çš„åŸºæœ¬é€»è¾‘å¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡å¹¶è®¾ç½®å®ƒçš„è¡Œä¸ºï¼Œä¸»è¦å°±æ˜¯ç”¨ä»€ä¹ˆæ ·çš„å‚æ•°è°ƒç”¨æ—¶ï¼Œç»™å‡ºæ€æ ·çš„åé¦ˆã€‚è™½ç„¶ Mock æ¡†æ¶æœ¬èº«çš„é€»è¾‘å¾ˆç®€å•ï¼Œä½†å‰æœŸä¹Ÿç»è¿‡äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„å‘å±•ï¼Œä»€ä¹ˆä¸œè¥¿å¯ä»¥ Mock  ä»¥åŠæ€æ ·å»è¡¨ç° Mockï¼Œä¸åŒçš„ Mock æ¡†æ¶ç»™å‡ºäº†ä¸åŒçš„ç­”æ¡ˆã€‚</p><p>ä»Šå¤©æˆ‘ä»¬çš„è®¨è®ºå°±ä»¥ Mockito è¿™ä¸ªæ¡†æ¶ä½œä¸ºæˆ‘ä»¬è®¨è®ºçš„åŸºç¡€ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰ Java ç¤¾åŒºæœ€å¸¸ç”¨çš„ Mock æ¡†æ¶ã€‚</p><p>è¦å­¦ä¹  Mock æ¡†æ¶ï¼Œå¿…é¡»è¦æŒæ¡å®ƒæœ€æ ¸å¿ƒçš„ä¸¤ä¸ªç‚¹ï¼š<strong>è®¾ç½®æ¨¡æ‹Ÿå¯¹è±¡</strong>ä¸<strong>æ ¡éªŒå¯¹è±¡è¡Œä¸º</strong>ã€‚</p><h3>è®¾ç½® Mock å¯¹è±¡</h3><p>è¦è®¾ç½®ä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡ã€‚åœ¨å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»è§è¯†è¿‡äº†ã€‚</p><pre><code>TodoItemRepository repository = mock(TodoItemRepository.class);\n</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯è®¾ç½®å®ƒçš„è¡Œä¸ºï¼Œä¸‹é¢æ˜¯ä»å®æˆ˜ä¸­æ‘˜å–çš„ä¸¤ä¸ªä¾‹å­ã€‚</p><pre><code>when(repository.findAll()).thenReturn(of(new TodoItem(&quot;foo&quot;)));\nwhen(repository.save(any())).then(returnsFirstArg());\n</code></pre><p>ä¸€ä¸ªå¥½ç¨‹åºåº“å…¶ API è¦æœ‰å¾ˆå¼ºçš„è¡¨è¾¾æ€§ï¼Œåƒå‰é¢è¿™ä¸¤æ®µä»£ç ï¼Œå³ä¾¿æˆ‘ä¸è§£é‡Šï¼Œçœ‹è¯­å¥æœ¬èº«ä¹ŸçŸ¥é“å®ƒåšäº†äº›ä»€ä¹ˆã€‚</p><p><strong>æ¨¡æ‹Ÿå¯¹è±¡çš„è®¾ç½®æ ¸å¿ƒå°±æ˜¯ä¸¤ç‚¹ï¼šå‚æ•°æ˜¯ä»€ä¹ˆæ ·çš„ä»¥åŠå¯¹åº”çš„å¤„ç†æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</strong></p><p>å‚æ•°è®¾ç½®å…¶å®æ˜¯ä¸€ä¸ªå‚æ•°åŒ¹é…çš„è¿‡ç¨‹ï¼Œæ ¸å¿ƒè¦å›ç­”çš„é—®é¢˜å°±æ˜¯åˆ¤æ–­ç»™å‡ºçš„å®å‚æ˜¯å¦æ»¡è¶³è¿™é‡Œè®¾ç½®çš„æ¡ä»¶ã€‚åƒä¸Šé¢ä»£ç ä¸­ï¼Œsave çš„å†™æ³•è¡¨ç¤ºä»»æ„å‚æ•°éƒ½å¯ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å®ƒæ˜¯ç‰¹å®šçš„å€¼ï¼Œæ¯”å¦‚åƒä¸‹é¢è¿™æ ·ã€‚</p><pre><code>when(repository.findByIndex(1)).thenReturn(new TodoItem(&quot;foo&quot;));\n</code></pre><p>å…¶å®å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‚æ•°åŒ¹é…çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡è¿™é‡Œåšäº†äº›çœç•¥ï¼Œå®Œæ•´çš„å†™æ³•åº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·ã€‚</p><pre><code>when(repository.findByIndex(eq(1))).thenReturn(new TodoItem(&quot;foo&quot;));\n</code></pre><p>å¦‚æœä½ æœ‰æ›´å¤æ‚çš„å‚æ•°åŒ¹é…è¿‡ç¨‹ï¼Œç”šè‡³å¯ä»¥è‡ªå·±å»å®ç°ä¸€ä¸ªåŒ¹é…è¿‡ç¨‹ã€‚ä½†æˆ‘å¼ºçƒˆå»ºè®®ä½ ä¸è¦è¿™ä¹ˆåšï¼Œå› ä¸ºæµ‹è¯•åº”è¯¥æ˜¯ç®€å•çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>ç›¸ç­‰å’Œä»»æ„å‚æ•°è¿™ä¸¤ç§ç”¨æ³•åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»å¤Ÿç”¨äº†ã€‚</strong></p><p>è®¾ç½®å®Œå‚æ•°ï¼Œæ¥ä¸‹æ¥ï¼Œå°±æ˜¯å¯¹åº”çš„å¤„ç†ã€‚èƒ½å¤Ÿè®¾ç½®ç›¸åº”çš„å¤„ç†ï¼Œè¿™æ˜¯ä½“ç°æ¨¡æ‹Ÿå¯¹è±¡å¯æ§çš„å…³é”®ã€‚å‰é¢çš„ä¾‹å­æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•è®¾ç½®ç›¸åº”çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯ã€‚</p><pre><code>when(repository.save(any())).thenThrow(IllegalArgumentException.class);\n</code></pre><p>åŒè®¾ç½®å‚æ•°ç±»ä¼¼ï¼Œç›¸åº”çš„å¤„ç†ä¹Ÿå¯ä»¥å†™å¾—å¾ˆå¤æ‚ï¼Œä½†æˆ‘åŒæ ·å»ºè®®ä½ ä¸è¦è¿™ä¹ˆåšï¼ŒåŸå› ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæµ‹è¯•è¦ç®€å•ã€‚<strong>çŸ¥é“æ€æ ·è®¾ç½®è¿”å›å€¼ï¼Œæ€æ ·æŠ›å‡ºå¼‚å¸¸ï¼Œå·²ç»è¶³å¤Ÿå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨äº†ã€‚</strong></p><h3>æ ¡éªŒå¯¹è±¡è¡Œä¸º</h3><p>æ¨¡æ‹Ÿå¯¹è±¡çš„å¦å¤–ä¸€ä¸ªé‡è¦è¡Œä¸ºæ˜¯æ ¡éªŒå¯¹è±¡è¡Œä¸ºï¼Œå°±æ˜¯çŸ¥é“ä¸€ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰æŒ‰ç…§é¢„æœŸçš„æ–¹å¼è°ƒç”¨ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸ save å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¾—åˆ°äº†è°ƒç”¨ã€‚</p><pre><code>verify(repository).save(any());\n</code></pre><p>è¿™åªæ˜¯æ ¡éªŒäº† save æ–¹æ³•å¾—åˆ°äº†è°ƒç”¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¡éªŒè¿™ä¸ªæ–¹æ³•è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚</p><pre><code>verify(repository, atLeast(3)).save(any());\n</code></pre><p>åŒæ ·ï¼Œæ ¡éªŒä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥è®¾ç½®çš„å‚æ•°ï¼Œä½†æˆ‘åŒæ ·ä¸å»ºè®®ä½ æŠŠå®ƒç”¨å¾—å¤ªå¤æ‚äº†ï¼Œ<strong>å°±è¿verify æœ¬èº«æˆ‘éƒ½å»ºè®®ä½ ä¸è¦ç”¨å¾—å¤ªå¤š</strong>ã€‚</p><p>verify ç”¨èµ·æ¥ä¼šç»™äººä¸€ç§å®‰å…¨æ„Ÿï¼Œæ‰€ä»¥ï¼Œä¼šè®©äººæœ‰ä¸€ç§å¤šç”¨çš„å€¾å‘ï¼Œä½†è¿™æ˜¯ä¸€ç§é”™è§‰ã€‚æˆ‘åœ¨è®²æµ‹è¯•æ¡†æ¶æ—¶è¯´è¿‡ï¼Œverify å…¶å®æ˜¯ä¸€ç§æ–­è¨€ã€‚æ–­è¨€æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªå‡½æ•°åº”è¯¥å…·å¤‡çš„è¡Œä¸ºï¼Œæ˜¯ä¸€ç§è¡Œä¸ºä¸Šçš„çº¦å®šã€‚</p><p>ä¸€æ—¦è®¾ç½®äº† verifyï¼Œå®é™…ä¸Šä¹Ÿå°±çº¦æŸäº†å‡½æ•°çš„å®ç°ã€‚ä½† verify çº¦æŸçš„å¯¹è±¡åˆæ˜¯åº•å±‚çš„ç»„ä»¶ï¼Œæ˜¯ä¸€ç§å®ç°ç»†èŠ‚ã€‚æ¢è¨€ä¹‹ï¼Œè¿‡åº¦ä½¿ç”¨ verify é€ æˆçš„ç»“æœå°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°çš„å®ç°ç»†èŠ‚çº¦å®šæ­»äº†ã€‚</p><p>è¿‡åº¦ä½¿ç”¨ verifyï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œä½ ä¼šæœ‰ä¸€ç§æˆå°±æ„Ÿã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æ¶‰åŠä»£ç ä¿®æ”¹ï¼Œæ•´ä¸ªäººå°±ä¸å¥½äº†ã€‚å› ä¸ºå®ç°ç»†èŠ‚è¢« verify é”å®šæ­»ï¼Œä¸€æ—¦ä¿®æ”¹ä»£ç ï¼Œè¿™äº› verify å°±å¾ˆå®¹æ˜“é€ æˆæµ‹è¯•æ— æ³•é€šè¿‡ã€‚</p><p><strong>æµ‹è¯•åº”è¯¥æµ‹è¯•çš„æ˜¯æ¥å£è¡Œä¸ºï¼Œè€Œä¸æ˜¯å†…éƒ¨å®ç°</strong>ã€‚æ‰€ä»¥ï¼Œverify è™½å¥½ï¼Œè¿˜æ˜¯å»ºè®®å°‘ç”¨ã€‚å¦‚æœæœ‰ä¸€äº›åœºæ™¯ä¸ç”¨ verify å°±æ²¡æœ‰ä»€ä¹ˆå¯æ–­è¨€çš„äº†ï¼Œé‚£è¯¥ç”¨ verify è¿˜æ˜¯è¦ç”¨ã€‚</p><p>å¦‚æœæŒ‰ç…§æµ‹è¯•æ¨¡å¼æ¥è¯´ï¼Œè®¾ç½® Mock å¯¹è±¡çš„è¡Œä¸ºåº”è¯¥ç®—æ˜¯ Stubï¼Œè€Œæ ¡éªŒå¯¹è±¡è¡Œä¸ºçš„åšæ³•ï¼Œæ‰æ˜¯ Mockã€‚<strong>å¦‚æœæŒ‰ç…§æ¨¡å¼çš„è¯´æ³•ï¼Œæˆ‘ä»¬åº”è¯¥å¸¸ç”¨ Stubï¼Œå°‘ç”¨ Mockã€‚</strong></p><h2>Mock æ¡†æ¶çš„å»¶ä¼¸</h2><p>Mock æ¡†æ¶çš„ä¸»è¦ä½œç”¨æ˜¯æ¨¡æ‹Ÿå¯¹è±¡çš„è¡Œä¸ºï¼Œä½†ä½œä¸ºä¸€ç§è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå´æœ‰ç€æ›´å¤§çš„å½±å“ã€‚æ—¢ç„¶æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå¯¹è±¡è¡Œä¸ºï¼Œé‚£æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ¨¡æ‹Ÿå…¶å®ƒä¸œè¥¿ã€‚æ‰€ä»¥ï¼Œåé¢ä¹Ÿæœ‰ä¸€äº›åŸºäºè¿™ç§æ¨¡æ‹Ÿæ€æƒ³çš„æ¡†æ¶ï¼Œå…¶ä¸­ï¼Œç›®å‰è¡Œä¸šä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚</p><p>æ¨¡æ‹ŸæœåŠ¡å™¨é¡¾åæ€ä¹‰ï¼Œå®ƒæ¨¡æ‹Ÿçš„æ˜¯æœåŠ¡å™¨è¡Œä¸ºï¼Œç°åœ¨åœ¨è¡Œä¸šä¸­å¹¿æ³›ä½¿ç”¨çš„æ¨¡æ‹ŸæœåŠ¡å™¨ä¸»è¦æ˜¯ HTTP æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚HTTP æœåŠ¡å™¨çš„ä¸»è¦è¡Œä¸ºå°±æ˜¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ä¹‹åï¼Œç»™å‡ºä¸€ä¸ªåº”ç­”ï¼Œä»è¡Œä¸ºä¸Šè¯´ï¼Œè¿™ä¸å¯¹è±¡æ¥å—ä¸€ç³»åˆ—å‚æ•°ï¼Œç»™å‡ºç›¸åº”çš„å¤„ç†å¦‚å‡ºä¸€è¾™ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘å°±ä»¥ Moco ä¸ºä¾‹ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚<a href=\"https://github.com/dreamhead/moco\">Moco</a> æ˜¯æˆ‘è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªå¼€æºæ¨¡æ‹ŸæœåŠ¡å™¨ç¨‹åºåº“ï¼Œæ›¾åœ¨ 2013 å¹´è·å¾— Oracle çš„ Duke é€‰æ‹©å¥–ã€‚ï¼ˆåœ¨ã€Šè½¯ä»¶è®¾è®¡ä¹‹ç¾ã€‹ä¸­è®²åˆ°ç¨‹åºåº“çš„è®¾è®¡æ—¶ï¼Œæˆ‘è®²è¿‡ <a href=\"https://time.geekbang.org/column/article/267856\">Moco æ•´ä¸ªè®¾è®¡çš„æ¥é¾™å»è„‰</a>ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥å»å›é¡¾ä¸€ä¸‹ã€‚ï¼‰</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨äº† Moco çš„æµ‹è¯•ä»£ç ã€‚</p><pre><code>public void should_return_expected_response() {\n  // è®¾ç½®æ¨¡æ‹ŸæœåŠ¡å™¨çš„ä¿¡æ¯\n  // è®¾ç½®æœåŠ¡å™¨è®¿é—®çš„ç«¯å£\n  HttpServer server = httpServer(12306);\n  // è®¿é—®/foo è¿™ä¸ª URI æ—¶ï¼Œè¿”å› bar\n  server.request(by(uri(&quot;/foo&quot;))).response(&quot;bar&quot;); \n  \n  // å¼€å§‹æ‰§è¡Œæµ‹è¯•\n  running(server, () -&gt; {\n    // è¿™é‡Œç”¨äº† Apache HTTPåº“è®¿é—®æ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œå®é™…ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ä½ çš„çœŸå®é¡¹ç›®\n    Content content = Request.Get(&quot;http://localhost:12306/foo&quot;)\n      .execute()\n      .returnContent();\n      \n    // å¯¹ç»“æœè¿›è¡Œæ–­è¨€\n    assertThat(content.asString(), is(&quot;bar&quot;));\n  });\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç é‡Œï¼Œæˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“ä½ è®¿é—® /foo è¿™ä¸ª URI æ—¶ï¼Œå®ƒä¼šç»™ä½ è¿”å›ä¸€ä¸ªåº”ç­” barã€‚è¿™å…¶ä¸­æœ€å…³é”®çš„ä¸€è¡Œä»£ç å°±æ˜¯è®¾ç½®è¯·æ±‚åº”ç­”çš„é‚£è¡Œã€‚</p><pre><code>server.request(by(uri(&quot;/foo&quot;))).response(&quot;bar&quot;); \n</code></pre><p>Moco çš„ API æœ¬èº«ä¹Ÿæœ‰å¾ˆå¼ºçš„è¡¨è¾¾æ€§ï¼Œé€šè¿‡ä»£ç æœ¬èº«ä½ å°±èƒ½çœ‹åˆ°ï¼Œè¿™é‡Œå°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªè¯·æ±‚ä»¥åŠç›¸åº”çš„åº”ç­”ã€‚</p><p>Moco çš„é…ç½®æ”¯æŒå¾ˆå¤šçš„ HTTP å…ƒç´ ï¼Œåƒä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ å¯ä»¥åŒæ—¶åŒ¹é…è¯·æ±‚å†…å®¹å’Œ URIï¼Œä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®åº”ç­”æ–‡æœ¬å’Œ HTTP çš„çŠ¶æ€ç ã€‚</p><pre><code>server\n  .request(and(by(&quot;foo&quot;), by(uri(&quot;/foo&quot;))))\n  .response(and(with(text(&quot;bar&quot;)), status(200)));\n</code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œé¢ï¼Œrunning æ˜¯è´Ÿè´£æ¨¡æ‹ŸæœåŠ¡å™¨å¯åœçš„ä»£ç ï¼Œé‡Œé¢åŒ…å«çš„ä»£ç å°±æ˜¯ï¼Œé€šè¿‡è‡ªå·±çœŸå®çš„æœåŠ¡ä»£ç å‘å‡ºçš„çœŸå®è¯·æ±‚ã€‚</p><p>Moco è¿˜æ”¯æŒ verifyï¼Œå¦‚æœä½ æƒ³åƒ Mock æ¡†æ¶é‚£æ ·å»æ ¡éªŒæœåŠ¡å™¨æ˜¯å¦æ”¶åˆ°äº†ç›¸åº”çš„è¯·æ±‚ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒã€‚</p><pre><code>RequestHit hit = requestHit();\nfinal HttpServer server = httpServer(port(), hit);\nrunning(server, () -&gt; {\n  ...\n})\n\nhit.verify(by(uri(&quot;/foo&quot;)), times(1));\n</code></pre><p>è™½ç„¶ Moco æ”¯æŒè¿™æ ·çš„èƒ½åŠ›ï¼Œä½†åŒä½¿ç”¨ Mock æ¡†æ¶ç±»ä¼¼ï¼Œæˆ‘ä¹Ÿå»ºè®®ä½ å°‘ç”¨ verifyã€‚</p><p>Moco æœ€å¤§çš„ä»·å€¼å°±æ˜¯è®©åŸæœ¬ä¸å¯æ§çš„ç¬¬ä¸‰æ–¹ HTTP æœåŠ¡å™¨ï¼Œç°åœ¨å¯ä»¥æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ–¹å¼æ‰§è¡Œã€‚æ¯”å¦‚ï¼Œåœ¨çœŸå®çš„é›†æˆè¿‡ç¨‹ï¼Œä½ å¾ˆéš¾è¦æ±‚ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç»™ä½ ä¸€ä¸ªé”™è¯¯çš„åº”ç­”ï¼Œæˆ–è€…ä¸€ä¸ªè¶…æ—¶çš„åº”ç­”ï¼Œä½†ä½¿ç”¨ Moco ä½ å°±å¯ä»¥è®©å®ƒæ¨¡æ‹Ÿå‡ºè¿™æ ·çš„è¡Œä¸ºã€‚</p><p>Moco è¿˜æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä»·å€¼ï¼ŒåŸæœ¬ä½ è¦åšé›†æˆï¼Œå”¯ä¸€çš„é€‰é¡¹æ˜¯æŠŠæ•´ä¸ªç³»ç»Ÿè·‘èµ·æ¥ï¼ŒåŸºæœ¬ä¸Šå°±åˆ°äº†ç³»ç»Ÿé›†æˆçš„èŒƒç•´ã€‚è€Œç°åœ¨ä½¿ç”¨ Mocoï¼ŒéªŒè¯å·¥ä½œå¯ä»¥ç”¨é›†æˆæµ‹è¯•çš„ä»£ç å°±å¯ä»¥å®Œæˆã€‚ä½œä¸ºç¨‹åºå‘˜æˆ‘ä»¬å¾ˆæ¸…æ¥šï¼Œç›¸æ¯”äºç³»ç»Ÿæµ‹è¯•ï¼Œè¿™ç§åšæ³•è½»å¤ªå¤šäº†ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå®šä½èµ·æ¥ä¹Ÿå®¹æ˜“å¾ˆå¤šã€‚ä»å¼€å‘æ•ˆç‡ä¸Šçœ‹ï¼Œè¿™ç®€ç›´æ˜¯æ•°é‡çº§çš„æå‡ã€‚</p><p>Moco ä¸ä»…ä»…æ”¯æŒæ¨¡æ‹Ÿ HTTP æœåŠ¡å™¨ï¼Œè¿˜åšäº†è¿›ä¸€æ­¥å»¶ä¼¸ï¼Œæ”¯æŒæ¨¡æ‹Ÿ WebSocket æœåŠ¡å™¨ã€‚</p><pre><code>HttpServer server = httpServer(12306);\nwebSocketServer = server.websocket(&quot;/ws&quot;);\nwebSocketServer.request(by(&quot;foo&quot;)).response(&quot;bar&quot;);\n</code></pre><p>æ— è®ºæ˜¯æ¨¡æ‹Ÿ HTTP æœåŠ¡å™¨ï¼Œè¿˜æ˜¯æ¨¡æ‹Ÿ WebSocket æœåŠ¡å™¨ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒéƒ½æ˜¯æ¨¡æ‹Ÿå¯¹è±¡è¿™ä¸€æ€æƒ³çš„å»¶ä¼¸ã€‚è€Œæ‰€æœ‰è¿™ä¸€åˆ‡çš„å‡ºå‘ç‚¹éƒ½æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æµ‹è¯•ä¸­å¾—åˆ°ä¸€ä¸ªå¯æ§çš„ç¯å¢ƒã€‚</p><h2>æ€»ç»“æ—¶åˆ»</h2><p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦è®²äº† Mock æ¡†æ¶ã€‚Mock æ¡†æ¶æ˜¯æºè‡ª Test Doubleï¼ˆæµ‹è¯•æ›¿èº«ï¼‰è¿™ç§æµ‹è¯•æ¨¡å¼ã€‚æˆ‘ä»¬å¸Œæœ›è‡ªå·±æœ‰ä¸€ä¸ªå¯æ§çš„ç¯å¢ƒå¯¹è¢«æµ‹ç³»ç»Ÿ/ç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼ŒèƒŒåçš„æ€æƒ³å°±æ˜¯ç”¨å‡çš„å´å¯æ§çš„ç»„ä»¶å»ä»£æ›¿çœŸå®ä¸å¯æ§çš„ç»„ä»¶ã€‚</p><p>ç°åœ¨ Mock æ¡†æ¶å·²ç»æˆä¸ºäº†æµ‹è¯•çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç†è§£ä¸€ä¸ªMockæ¡†æ¶æ ¸å¿ƒå°±æ˜¯è¦ç†è§£å¦‚ä½•è®¾ç½®å¯¹è±¡è¡Œä¸ºä»¥åŠå¦‚ä½•æ ¡éªŒå¯¹è±¡è¡Œä¸ºã€‚è®¾ç½®å¯¹è±¡è¡Œä¸ºä¸»è¦æ˜¯è®¾ç½®ç›¸åº”çš„å‚æ•°ä»¥åŠå¯¹åº”çš„å¤„ç†ï¼Œæ— è®ºè¿™ä¸ªå¤„ç†æ˜¯ç»™å‡ºè¿”å›å€¼ï¼Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚æ ¡éªŒå¯¹è±¡è¡Œä¸ºæ˜¯ä¸€ç§æ–­è¨€ï¼Œæ˜¯çœ‹å¯¹è±¡æ˜¯å¦æŒ‰ç…§é¢„æœŸæ–¹å¼æ‰§è¡Œã€‚ä¸è¿‡ï¼Œæˆ‘ç»™ä½ æäº†ä¸€ä¸ªé†’ï¼Œverify è™½å¥½ï¼Œå°½é‡å°‘ç”¨ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¿˜ä»¥ Moco ä¸ºä¾‹è®²åˆ°äº† Mock æ¡†æ¶çš„å»¶ä¼¸ï¼Œä¹Ÿå°±æ˜¯æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚Moco ä¸»è¦æ˜¯æ¨¡æ‹Ÿ HTTP æœåŠ¡å™¨ï¼Œå…¶æ ¸å¿ƒå°±æ˜¯å¯¹ä»€ä¹ˆæ ·çš„è¯·æ±‚ï¼Œç»™å‡ºä»€ä¹ˆæ ·çš„åº”ç­”ã€‚</p><p>å¦‚æœä»Šå¤©çš„å†…å®¹ä½ åªèƒ½è®°ä½ä¸€ä»¶äº‹ï¼Œé‚£è¯·è®°ä½ï¼š<strong>ä½¿ç”¨ Mock æ¡†æ¶ï¼Œå°‘ç”¨ verifyã€‚</strong></p><h2>æ€è€ƒé¢˜</h2><p>ä»Šå¤©æˆ‘ä»¬è®²äº† Mock æ¡†æ¶ï¼Œä½ åœ¨å®é™…å·¥ä½œä¸­ç”¨åˆ°è¿‡ Mock æ¡†æ¶å—ï¼Ÿå®ƒè§£å†³äº†ä½ æ€æ ·çš„é—®é¢˜ï¼Œæˆ–æ˜¯ä½ åœ¨ä½¿ç”¨å®ƒçš„è¿‡ç¨‹ä¸­é‡åˆ°æ€æ ·çš„å›°éš¾ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„ç»éªŒã€‚</p>","neighbors":{"left":{"article_title":"06 | æµ‹è¯•ä¸å¥½åšï¼Œä¸ºä»€ä¹ˆä¼šå’Œè®¾è®¡æœ‰å…³ç³»ï¼Ÿ","id":408187},"right":{"article_title":"08 | å•å…ƒæµ‹è¯•åº”è¯¥æ€ä¹ˆå†™ï¼Ÿ","id":409822}},"comments":[{"had_liked":false,"id":307800,"user_name":"sylan215","can_delete":false,"product_type":"c1","uid":1019029,"ip_address":"","ucode":"5A2CF31BC69F40","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/95/4544d905.jpg","comment_is_top":false,"comment_ctime":1629260195,"is_pvip":false,"replies":[{"id":"111895","content":"å¤šè°¢ä½ çš„æ€»ç»“ï¼","user_name":"ä½œè€…å›å¤","comment_id":307800,"uid":"1258861","ip_address":"","utype":1,"ctime":1629940605,"user_name_real":"éƒ‘æ™”"}],"discussion_count":1,"race_medal":0,"score":"23104096675","product_id":100085101,"comment_content":"1ã€è¿™ä¸€è®²ä¸»è¦æ˜¯è®² Mock çš„ï¼Œå¯¹äºè‡ªåŠ¨åŒ–æµ‹è¯•æ¥è¯´ï¼Œè¿™ä¸ªæŠ€æœ¯ç¡®å®å¾ˆå…³é”®ï¼Œå½“ç„¶ï¼Œè€å¸ˆä¹Ÿåœ¨æ–‡ä¸­å»ºè®®æ…ç”¨ï¼Œä½¿ç”¨çš„å‰ææ˜¯ï¼Œæˆ‘ä»¬çœŸçš„æ˜ç™½è¿™äº›æŠ€æœ¯çš„ä½œç”¨å’Œå‰¯ä½œç”¨ã€‚<br><br>2ã€å‰ä¸€è®²è¯´äº†æµ‹è¯•è¦å‡å°‘è€¦åˆæ€§ï¼ŒåŒæ—¶æˆ‘ä»¬ä¸ºäº†ä¿è¯æµ‹è¯•ç›®çš„çš„å”¯ä¸€æ€§ï¼Œå°±å¼•å…¥äº† Mock æŠ€æœ¯ï¼Œå®ƒä¸€å®šç¨‹åº¦ä¸Šï¼Œè®©æˆ‘ä»¬çš„å…³æ³¨ç‚¹æ›´é›†ä¸­ï¼›<br><br>3ã€å’Œ Mock æŠ€æœ¯ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥äº†è§£ Stubã€Dummyã€Fakeã€Spy ç­‰æŠ€æœ¯ï¼ŒåŒæ ·æ˜¯å¸®å¿™æˆ‘ä»¬ä¼˜åŒ–æµ‹è¯•ç›®çš„ï¼Œç®€åŒ–æµ‹è¯•å®ç°çš„ï¼›<br><br>4ã€Mock ç­‰æ¨¡æ‹Ÿå¯¹è±¡ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ–¹ä¾¿çš„æ¨¡æ‹Ÿä¼ å‚å’Œä¸åŒè¿”å›å€¼çš„æƒ…å†µï¼Œè¿™äº›å¦‚æœæ˜¯åœ¨å®é™…ä¸šåŠ¡ç¯å¢ƒä¸­ï¼Œæ„é€ èµ·æ¥å¯èƒ½ä¼šéå¸¸éº»çƒ¦ï¼›<br><br>5ã€éæµ‹è¯•ç›®çš„çš„è¿‡ç¨‹ä¸­çš„ verify è¦æ…ç”¨ï¼Œé¿å…é™ä½ç”¨ä¾‹çš„é€‚ç”¨æ€§ï¼Œä¹Ÿä¼šå¢åŠ ç”¨ä¾‹çš„ç»´æŠ¤æˆæœ¬ï¼›<br><br>ä»¥ä¸Šï¼ŒæœŸå¾…åç»­çš„ç²¾å½©å†…å®¹ã€‚","like_count":6,"discussions":[{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525292,"discussion_content":"å¤šè°¢ä½ çš„æ€»ç»“ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629940605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308225,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1629458480,"is_pvip":false,"replies":[{"id":"111674","content":"ä¸¥æ ¼åœ°è¯´ï¼Œç¬¬ä¸‰æ–¹æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿™äº‹ä¸å±äºæµ‹è¯•ã€‚å¦‚æœé‡‡ç”¨æµ‹è¯•çš„æ–¹å¼ï¼Œç¬¬ä¸‰æ–¹æœåŠ¡æœ‰ä¸€å¤©å®•æœºäº†ï¼Œä½ çš„æµ‹è¯•å¤±è´¥äº†ï¼Œä½†ä½ æ ¹æœ¬å°±æ²¡æœ‰åŠ¨ä»£ç ã€‚æ‰€ä»¥ï¼Œå®ƒæ— æ³•èµ·åˆ°æµ‹è¯•åº”æœ‰çš„ä½œç”¨ã€‚æ‰€ä»¥ï¼Œä½ çœŸæ­£éœ€è¦çš„æ˜¯ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæµ‹è¯•ã€‚<br><br>å½“ç„¶ï¼Œä¸ºäº†è®©äººä»¬æ³¨æ„åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ­£ç¡®æ€§ï¼Œä½ ä¸“é—¨åšä¸€ä¸ªâ€œæµ‹è¯•â€é›†åˆï¼Œåœ¨æŒç»­é›†æˆçš„æœåŠ¡ä»¥æ›´é•¿çš„å‘¨æœŸè¿è¡Œï¼Œè€Œä¸éœ€è¦åƒæ™®é€šçš„æµ‹è¯•ä¸€æ ·ï¼Œæ¯æ¬¡æäº¤éƒ½è¿è¡Œã€‚","user_name":"ä½œè€…å›å¤","comment_id":308225,"uid":"1258861","ip_address":"","utype":1,"ctime":1629631362,"user_name_real":"éƒ‘æ™”"}],"discussion_count":4,"race_medal":0,"score":"14514360368","product_id":100085101,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œ <br>æŠŠç¬¬ä¸‰æ–¹mockæ‰äº†ï¼Œ<br>é‚£ä¹ˆå¦‚ä½•éªŒè¯ æˆ‘ä»¬è¯·æ±‚ç¬¬ä¸‰æ–¹çš„å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œ æˆ‘ä»¬åˆ°ç¬¬ä¸‰æ–¹çš„è¯·æ±‚æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œã€‚","like_count":4,"discussions":[{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525437,"discussion_content":"ä¸¥æ ¼åœ°è¯´ï¼Œç¬¬ä¸‰æ–¹æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿™äº‹ä¸å±äºæµ‹è¯•ã€‚å¦‚æœé‡‡ç”¨æµ‹è¯•çš„æ–¹å¼ï¼Œç¬¬ä¸‰æ–¹æœåŠ¡æœ‰ä¸€å¤©å®•æœºäº†ï¼Œä½ çš„æµ‹è¯•å¤±è´¥äº†ï¼Œä½†ä½ æ ¹æœ¬å°±æ²¡æœ‰åŠ¨ä»£ç ã€‚æ‰€ä»¥ï¼Œå®ƒæ— æ³•èµ·åˆ°æµ‹è¯•åº”æœ‰çš„ä½œç”¨ã€‚æ‰€ä»¥ï¼Œä½ çœŸæ­£éœ€è¦çš„æ˜¯ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæµ‹è¯•ã€‚\n\nå½“ç„¶ï¼Œä¸ºäº†è®©äººä»¬æ³¨æ„åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ­£ç¡®æ€§ï¼Œä½ ä¸“é—¨åšä¸€ä¸ªâ€œæµ‹è¯•â€é›†åˆï¼Œåœ¨æŒç»­é›†æˆçš„æœåŠ¡ä»¥æ›´é•¿çš„å‘¨æœŸè¿è¡Œï¼Œè€Œä¸éœ€è¦åƒæ™®é€šçš„æµ‹è¯•ä¸€æ ·ï¼Œæ¯æ¬¡æäº¤éƒ½è¿è¡Œã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1629631362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","nickname":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","note":"","ucode":"BD53829E924B66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564992,"discussion_content":"ç¬¬ä¸‰æ–¹æœåŠ¡å¯èƒ½æ ¹æœ¬ä¸éœ€è¦æµ‹è¯•ï¼Œéœ€è¦æµ‹è¯•çš„æ˜¯ç¬¬ä¸‰æ–¹æœåŠ¡çš„å„ç§è¿”å›å€¼å¯¹ä¸šåŠ¡é€»è¾‘çš„å½±å“ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650368750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1158152,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/08/8b99367c.jpg","nickname":"topsion","note":"","ucode":"01366517C6F564","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558650,"discussion_content":"è¯·æ±‚å‚æ•°ä¹Ÿåº”è¯¥æ–­è¨€çš„ã€‚Mockitioæä¾›çš„ArgumentCaptor","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1648431305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135528,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","nickname":"return","note":"","ucode":"42B8A3380DF04B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390221,"discussion_content":"æ˜ç™½äº† éå¸¸æ„Ÿè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629717821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307855,"user_name":"grandgraph","can_delete":false,"product_type":"c1","uid":1016036,"ip_address":"","ucode":"B26060999DAA73","user_header":"","comment_is_top":false,"comment_ctime":1629282595,"is_pvip":false,"replies":[{"id":"111493","content":"æŒ‰ç…§ä½ çš„é€»è¾‘ï¼Œæµ‹è¯•è¿™ä¸ªèšåˆæœåŠ¡å°±æ˜¯è¦å¯¹å…¶ä¾èµ–çš„æœåŠ¡åšMockã€‚è¿™å’Œå•ç‹¬çš„æœåŠ¡æ˜¯å¦ä¾èµ–äºRepositoryæ²¡å…³ç³»","user_name":"ä½œè€…å›å¤","comment_id":307855,"uid":"1258861","ip_address":"","utype":1,"ctime":1629335038,"user_name_real":"éƒ‘æ™”"}],"discussion_count":2,"race_medal":1,"score":"14514184483","product_id":100085101,"comment_content":"å¦‚æœå­˜åœ¨å¤šå±‚, é‚£ä¹ˆæ¯å±‚å¯¹ä¸‹å±‚ä¾èµ–çš„å¯¹è±¡éƒ½éœ€è¦åšStub&#47;Mockå—? æ¯”å¦‚AggregateServiceä¾èµ–å¤šä¸ªServiceå¯¹è±¡, è€Œå„ä¸ªServiceå¯¹è±¡åˆæœ‰è‡ªå·±çš„Repository, é‚£ä¹ˆåœ¨æµ‹è¯•AggregateServiceæ—¶, éœ€è¦å¯¹å„ä¸ªServiceå¯¹è±¡åšMockå—?","like_count":4,"discussions":[{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525317,"discussion_content":"æŒ‰ç…§ä½ çš„é€»è¾‘ï¼Œæµ‹è¯•è¿™ä¸ªèšåˆæœåŠ¡å°±æ˜¯è¦å¯¹å…¶ä¾èµ–çš„æœåŠ¡åšMockã€‚è¿™å’Œå•ç‹¬çš„æœåŠ¡æ˜¯å¦ä¾èµ–äºRepositoryæ²¡å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629335038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"æ— å’","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577799,"discussion_content":"æ¥å£æˆ–è€…ç•Œé¢çš„ç†è§£ï¼Œä¾èµ–çš„æœåŠ¡æœ¬è´¨ä¸Šå°±å±äºæ¥å£çš„å®ç°å±‚é¢äº†ï¼Œä»”ç»†æƒ³æƒ³å°±æ˜ç™½äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656339421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307838,"user_name":"é˜¿å§†æ–¯å£®","can_delete":false,"product_type":"c1","uid":1265599,"ip_address":"","ucode":"87D5923D639CD6","user_header":"https://static001.geekbang.org/account/avatar/00/13/4f/bf/6584bdeb.jpg","comment_is_top":false,"comment_ctime":1629276414,"is_pvip":false,"replies":[{"id":"111494","content":"åŠ æ²¹ï¼Œå‘é«˜æ°´å¹³ç¨‹åºå‘˜è¿›å†›ï¼","user_name":"ä½œè€…å›å¤","comment_id":307838,"uid":"1258861","ip_address":"","utype":1,"ctime":1629335757,"user_name_real":"éƒ‘æ™”"}],"discussion_count":1,"race_medal":0,"score":"14514178302","product_id":100085101,"comment_content":"ä»Šå¤©åˆå¿ä¸ä½ä¸Šæ¥åˆ†äº«ä¸€ä¸‹ã€‚æŠŠéƒ‘å¤§ä¹‹å‰çš„è¯¾ç¨‹åº”ç”¨åˆ°å·¥ä½œä¹‹åã€‚å…ˆä»ã€Œåå‘³é“ã€å…¥æ‰‹ï¼Œåˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¶ˆé™¤å¤§é‡é‡å¤ä»£ç ã€‚ä¸åšCVSç¨‹åºå‘˜ã€‚å½“å·¥ä½œå’Œå­¦ä¹ å……åˆ†ç»“åˆèµ·æ¥åï¼Œå‘ç°æ¯å¤©çš„å·¥ä½œéƒ½å……æ»¡äº†ä¹è¶£ã€‚æ€»æ„Ÿè§‰å·¥ä½œæ—¶é—´å¥½å¿«ã€‚ï¼ˆä¸€å¤©7ä¸ªå°æ—¶ï¼‰ä¸éœ€è¦åŠ ç­ã€‚å¯èƒ½æˆ‘ä»¬å…¬å¸æ˜¯ä¸€ä¸ªä¸åŠ¡æ­£ä¸šçš„ITå…¬å¸ã€‚æ¥ä¸‹æ¥ï¼Œå°±æ˜¯æœŸå¾…éƒ‘å¤§çš„æµ‹è¯•è¯¾ã€‚æŠŠè‡ªåŠ¨åŒ–æµ‹è¯•è¿™å—ä¹Ÿåº”ç”¨åˆ°å·¥ä½œä¸­ã€‚","like_count":4,"discussions":[{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525310,"discussion_content":"åŠ æ²¹ï¼Œå‘é«˜æ°´å¹³ç¨‹åºå‘˜è¿›å†›ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629335757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308435,"user_name":"asusual","can_delete":false,"product_type":"c1","uid":2735468,"ip_address":"","ucode":"AF9AA546D3794F","user_header":"https://static001.geekbang.org/account/avatar/00/29/bd/6c/a988846d.jpg","comment_is_top":false,"comment_ctime":1629619355,"is_pvip":false,"replies":[{"id":"111697","content":"æ‰€è°“ç»éªŒï¼Œéƒ½æ˜¯æ•™è®­","user_name":"ä½œè€…å›å¤","comment_id":308435,"uid":"1258861","ip_address":"","utype":1,"ctime":1629687853,"user_name_real":"éƒ‘æ™”"}],"discussion_count":1,"race_medal":0,"score":"10219553947","product_id":100085101,"comment_content":"ä»¥å‰å†™æµ‹è¯•åŸºæœ¬éƒ½å†™äº†verifyã€‚ç°åœ¨çœ‹æ¥éƒ‘å¤§çš„è§‚ç‚¹éå¸¸å‡†ç¡®~<br><br>è¿‡åº¦ä½¿ç”¨ verifyï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œä½ ä¼šæœ‰ä¸€ç§æˆå°±æ„Ÿã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æ¶‰åŠä»£ç ä¿®æ”¹ï¼Œæ•´ä¸ªäººå°±ä¸å¥½äº†ã€‚å› ä¸ºå®ç°ç»†èŠ‚è¢« verify é”å®šæ­»ï¼Œä¸€æ—¦ä¿®æ”¹ä»£ç ï¼Œè¿™äº› verify å°±å¾ˆå®¹æ˜“é€ æˆæµ‹è¯•æ— æ³•é€šè¿‡ã€‚","like_count":3,"discussions":[{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525490,"discussion_content":"æ‰€è°“ç»éªŒï¼Œéƒ½æ˜¯æ•™è®­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629687853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307735,"user_name":"ä¸‹å¼¦ã®æœˆ","can_delete":false,"product_type":"c1","uid":1909916,"ip_address":"","ucode":"57D924C51679D4","user_header":"https://static001.geekbang.org/account/avatar/00/1d/24/9c/e32fe600.jpg","comment_is_top":false,"comment_ctime":1629221315,"is_pvip":false,"replies":[{"id":"111574","content":"ä½ è¿™ä¸ªç†è§£æ²¡é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":307735,"uid":"1258861","ip_address":"","utype":1,"ctime":1629416638,"user_name_real":"éƒ‘æ™”"}],"discussion_count":3,"race_medal":0,"score":"5924188611","product_id":100085101,"comment_content":"æ˜¯å¦å¯ä»¥è¿™ä¹ˆç†è§£ï¼Ÿ<br>æœ‰ä¸ªå¾…æµ‹çš„ç»„ä»¶Aï¼Œå†…éƒ¨ä¾èµ–ç»„å»ºB,ä¼šæ‰§è¡ŒB.callFunc(); <br>åŒæ—¶ï¼ŒBè¿˜ä¾èµ–äºç»„å»ºC,ä¼šæ‰§è¡Œ C.callMethod();<br><br>å¯¹Aåšå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦éš”ç¦»å¯¹Bçš„ä¾èµ–ã€‚Stub åšçš„äº‹æƒ…æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªBå¯¹è±¡ï¼Œè®¾ç½®å¥½æ¨¡æ‹ŸBå¯¹è±¡çš„ callFunc() è¿™ä¸ªæ–¹æ³•çš„è¾“å…¥ä¸è¾“å‡ºå³å¯ã€‚<br><br>è€ŒMockï¼Œé™¤äº†ä¸Šè¿°çš„å®‰æ’å¥½è¾“å…¥ä¸è¾“å‡ºä¹‹å¤–ï¼Œè¿˜è¦å¯¹B.callFunc() è¿™ä¸ªæ–¹æ³•æœ¬èº«çš„è¡Œä¸ºåšæ ¡éªŒã€‚æ¯”å¦‚verify(C,atLeast(1)).callMethod(any());<br><br>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼šå¦‚æœåªæ˜¯å‡†å¤‡ä¸€ä¸ªè¢«æ¨¡æ‹Ÿå¯¹è±¡çš„è¾“å…¥è¾“å‡ºï¼Œå°±æ˜¯Stubï¼›å¦‚æœè¦æ£€æŸ¥è¢«æ¨¡æ‹Ÿå¯¹è±¡å†…éƒ¨çš„è¡Œä¸ºï¼Œå°±æ˜¯Mockã€‚","like_count":2,"discussions":[{"author":{"id":1087302,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/46/fe1f21d8.jpg","nickname":"åŒ—é£ä¸€å¶","note":"","ucode":"30310E66341D2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391653,"discussion_content":"æˆ‘èƒ½è¯´æˆ‘çœ‹äº†è¿™ä¸ªï¼Œæ‰ç†è§£æ–‡ç« å•¥æ„æ€ä¹ˆã€‚ã€‚ã€‚ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1630566690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1258861,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg","nickname":"éƒ‘æ™”","note":"","ucode":"1EBD5AA5D4FC89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525267,"discussion_content":"ä½ è¿™ä¸ªç†è§£æ²¡é—®é¢˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629416638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1756505,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/59/493b8eab.jpg","nickname":"ç»†å¿ƒç‚¹","note":"","ucode":"F4D0EF8C71718E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588749,"discussion_content":"ç†è§£äº† è°¢è°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664072638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348051,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1654690444,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654690444","product_id":100085101,"comment_content":"ä½¿ç”¨ Mock æ¡†æ¶ï¼Œå°‘ç”¨ verifyã€‚--è®°ä¸‹æ¥","like_count":0},{"had_liked":false,"id":341454,"user_name":"èŠ±èŠ±å¤§è„¸çŒ«","can_delete":false,"product_type":"c1","uid":1117318,"ip_address":"","ucode":"8ABDB3F7F4FB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","comment_is_top":false,"comment_ctime":1649636828,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649636828","product_id":100085101,"comment_content":"å¦‚ä½•ç¡®å®šverifyå¤šå†™äº†ï¼Œè¿‡åº¦ä¾èµ–ï¼Œè¿™æœ‰æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†ï¼Œå¦‚æœæˆ‘ä¸€ä¸ªvoidè¿”å›çš„æ–¹æ³•ï¼Œéœ€è¦å¤„ç†å•å…ƒæµ‹è¯•ï¼Œé‡Œé¢æœ‰å‡ ä¸ªä¾èµ–å¯¹è±¡ï¼Œé‚£å¯¹äºæ•´ä¸ªæµç¨‹æ¥è¯´ï¼Œæˆ‘å†™å•å…ƒæµ‹è¯•è‚¯å®šæ˜¯éœ€è¦verifyè°ƒç”¨åˆ°å®ƒä»¬çš„æ—¶å€™å…¥å‚æ˜¯ä¸æ˜¯åˆæ³•çš„ï¼Œè°ƒç”¨äº†å‡ æ¬¡ï¼Œæ˜¯ä¸æ˜¯è¿™æ ·çš„é¡ºåºè°ƒç”¨ï¼Œé‚£è¿™æ ·åŠ¿å¿…è¦æœ‰å¤šä¸ªverifyï¼Ÿè¿™å—æœ‰ç‚¹ç–‘æƒ‘å¸Œæœ›è€å¸ˆè§£ç­”ä¸‹","like_count":0},{"had_liked":false,"id":329204,"user_name":"ownraul","can_delete":false,"product_type":"c1","uid":1080963,"ip_address":"","ucode":"37A3D24BE83D0E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/83/27fd9c50.jpg","comment_is_top":false,"comment_ctime":1641208235,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641208235","product_id":100085101,"comment_content":"ä¹‹å‰çš„ä»£ç ä¸­ç”¨äº†ä¸€ä¸ª RestTemplate çš„mock æ¥æ¨¡æ‹Ÿç¬¬ä¸‰æ–¹çš„è¿”å›, ä¸å¥½åœ°æ–¹åœ¨äºä¸€æ—¦ä½¿ç”¨äº†ä¹‹åå…¨éƒ¨çš„  restTemplate éƒ½è¢«æ¨¡æ‹Ÿ, ç”¨ Moco ç›´æ¥æ¨¡æ‹Ÿè¿”å›ç»“æœæ˜¯ä¸ªæ›´åŠ ä¼˜é›…çš„æ–¹å¼äº†, åªè¦æŠŠç¬¬ä¸‰æ–¹çš„ url éƒ½è§£è€¦å¼€, ç”¨æœ¬åœ°ä¸åŒçš„ç«¯å£è¿›è¡Œæ¨¡æ‹Ÿå°±å¥½","like_count":0}]}