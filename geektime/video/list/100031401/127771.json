{"id":127771,"title":"74 | NodePort vs LoadBalancer vs Ingress","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":258210,"user_name":"龙彦极客","can_delete":false,"product_type":"c3","uid":2272998,"ip_address":"","ucode":"20D380C00D8B05","user_header":"https://static001.geekbang.org/account/avatar/00/22/ae/e6/0c41e48d.jpg","comment_is_top":false,"comment_ctime":1604326179,"is_pvip":false,"replies":[{"id":94569,"content":"像staffjoy中的faraday网关，或者zuul或spring cloud gateway这类网关，可以在k8s中部署成service，这样就可以按需水平扩展(通过ReplicaSet&#47;Deployment机制)。网关的前置可以对接公有云的LoadBalancer对service进行负载均衡。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1605013444,"ip_address":"","comment_id":258210,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，无状态的网关，如果要水平扩展，是不是只要配置成loadBalancer和replicaset的数量即可？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508580,"discussion_content":"像staffjoy中的faraday网关，或者zuul或spring cloud gateway这类网关，可以在k8s中部署成service，这样就可以按需水平扩展(通过ReplicaSet/Deployment机制)。网关的前置可以对接公有云的LoadBalancer对service进行负载均衡。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605013444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203668,"user_name":"Kevin","can_delete":false,"product_type":"c3","uid":1818854,"ip_address":"","ucode":"56BB1FEE80280D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWUXnsTRNCnUXgRYZOY6sgN1x1hpxszzdkR2aUgAPw7FBkWb7Zw0BRYvXmfAodfaziaE2CGPWbkNw/132","comment_is_top":false,"comment_ctime":1586252103,"is_pvip":false,"replies":[{"id":76323,"content":"因为k8s是一个数据中心操作系统，把原来几十甚至几百个运维团队维护的物理数据中心抽象打包浓缩到可以运行在一台笔记本上，这点复杂性是难免的，其实已经很简单了，只要掌握一些核心概念即可上手，你说呢？\n\n如果还是不能理解，请关注我的B站空间，上面有本课的补充内容，对本课难点做进一步讲解和演示：\nhttps:&#47;&#47;space.bilibili.com&#47;518029478","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1586353340,"ip_address":"","comment_id":203668,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"节点网络、pod网络、service网络，还有外部访问转发，感觉从用户角度只是找到要访问的服务就复杂死了。为什么要搞得这么复杂？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490925,"discussion_content":"因为k8s是一个数据中心操作系统，把原来几十甚至几百个运维团队维护的物理数据中心抽象打包浓缩到可以运行在一台笔记本上，这点复杂性是难免的，其实已经很简单了，只要掌握一些核心概念即可上手，你说呢？\n\n如果还是不能理解，请关注我的B站空间，上面有本课的补充内容，对本课难点做进一步讲解和演示：\nhttps://space.bilibili.com/518029478","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586353340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292771,"user_name":"BBQ","can_delete":false,"product_type":"c3","uid":1656804,"ip_address":"","ucode":"683BBF7F7AE370","user_header":"https://static001.geekbang.org/account/avatar/00/19/47/e4/17cb3df1.jpg","comment_is_top":false,"comment_ctime":1620972451,"is_pvip":false,"replies":[{"id":107197,"content":"请看我的文章《k8s网路三部曲》\nhttps:&#47;&#47;blog.csdn.net&#47;yang75108&#47;category_9317769.html\n还有我的k8s基本概念视频：\nhttps:&#47;&#47;www.bilibili.com&#47;video&#47;BV1Ja4y1x748?p=4\n\n如果要把Service暴露到k8s集群以外，是要走NodePort暴露端口的(对应的Service Type = NodePort)，这样外网Load Balancer才能接入进来，这时流量会经过kube-proxy。如果Service只是k8s内部的服务，对应的Service Type = ClusterIP，这种服务只在k8s内部可见，不会通过NodePort暴露出去。\n\n在K8s内部做服务路由(Service网络)的时候，如果走传统kube-proxy模式，是穿透kube-proxy的；如果走iptable&#47;ipvs，那么不会穿透kube-proxy。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1622389744,"ip_address":"","comment_id":292771,"utype":1}],"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，非常感谢您的课程，讲得非常清晰、有层次。\n我这里有两个问题想问一下：\n1. 是不是一个服务就得暴露1个 NodePort，十个服务就得暴露10个不同的NodePort\n2. 在Service 网络章节我们说到 在 iptable&#47;ipvs 模式下，kube-proxy已经不参与转发， 在这节课上，Kube-proxy是监听node端口，一定要参与转发的吧，还有其他机制吗？\n\n","like_count":1},{"had_liked":false,"id":131360,"user_name":"JefferLiu","can_delete":false,"product_type":"c3","uid":1213125,"ip_address":"","ucode":"3186C9CCC8AEF6","user_header":"https://static001.geekbang.org/account/avatar/00/12/82/c5/bf83a009.jpg","comment_is_top":false,"comment_ctime":1567730561,"is_pvip":false,"replies":[{"id":49881,"content":"学员有收获，也是我制作课程的最大收获，加油！","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567774131,"ip_address":"","comment_id":131360,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"bobo老师，我马上就听完了，由于目前实际工作正在实践云原生，听起来比较流畅，还是学了很多新知识，感谢bobo老师。","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466409,"discussion_content":"学员有收获，也是我制作课程的最大收获，加油！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567774131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137255,"user_name":"杨波","can_delete":false,"product_type":"c3","uid":1030344,"ip_address":"","ucode":"FA3418BB703BCA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","comment_is_top":false,"comment_ctime":1569668948,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"课程补充材料，作者亲自撰写的博文《Kubernetes网络三部曲之三 ~ NodePort vs LoadBalancer vs Ingress》\nhttps:&#47;&#47;blog.csdn.net&#47;yang75108&#47;article&#47;details&#47;101268208","like_count":5},{"had_liked":false,"id":396514,"user_name":"linux888","can_delete":false,"product_type":"c3","uid":1049517,"ip_address":"陕西","ucode":"773567EC9D185B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/0BtSzG2FO9pNWT64RD9nPzWCSRrIiaxwKdLuP63t03wtOMiac0SicIxG8znMF2O4O8EattRncciaN8wI6XhwDCLFIs0f614kRhGkibibpZBl1Gpe8/132","comment_is_top":false,"comment_ctime":1734781660,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"service本身不就是一个vip，后面接多个复本提供HA，为啥ervice暴露给k8s外面，还要加lb，意义在哪？","like_count":0},{"had_liked":false,"id":364625,"user_name":"魏","can_delete":false,"product_type":"c3","uid":1284637,"ip_address":"浙江","ucode":"E7E3CD2AB399BB","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/1d/b304371c.jpg","comment_is_top":false,"comment_ctime":1671205694,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，请问视频中的ppt中很多图，看起来挺好的，都是用哪些工具画，想参考下。","like_count":0}]}