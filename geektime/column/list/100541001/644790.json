{"id":644790,"title":"08ï½œæ–‡æœ¬æ”¹å†™å’Œå†…å®¹å®¡æ ¸ï¼Œåˆ«è®©ä½ çš„æœºå™¨äººè¯´é”™è¯","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ–‡æµ©ã€‚</p><p>å‰é¢ï¼Œæˆ‘ä»¬å·²ç»æŠŠOpenAIæœ€ä¸»è¦çš„æ¥å£ä»‹ç»å®Œäº†ã€‚è¿™ä¸€è®²ä¹Ÿæ˜¯æˆ‘ä»¬åŸºç¡€çŸ¥è¯†ç¯‡é‡Œé¢çš„æœ€åä¸€è®²ï¼Œæˆ‘ä»¬ä¼šè¦†ç›–å®ŒOpenAIçš„GPTç³»åˆ—æ¨¡å‹å‰©ä¸‹çš„ä¸€äº›æ¥å£ã€‚ä¹Ÿè®¸æœ‰äº›æ¥å£ä½ ä¸ä¸€å®šä¼šé¢‘ç¹ä½¿ç”¨ï¼Œä½†æ˜¯äº†è§£ä¸€ä¸‹æ²¡æœ‰ä»€ä¹ˆåå¤„ï¼Œè¯´ä¸å®šä½ æœ‰ä»€ä¹ˆéœ€æ±‚å°±èƒ½ç”¨å¾—ä¸Šå®ƒã€‚</p><p>åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»¬ä¼šä¸€èµ·æ¥çœ‹çœ‹OpenAIä¸ºæ–‡æœ¬æ”¹å†™å’Œå†…å®¹å®¡æ ¸æä¾›çš„åŠŸèƒ½æœ‰å“ªäº›ã€‚ä»¥åŠOpenAIçš„GPTç³»åˆ—æœ‰å“ªäº›æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹æœ‰å“ªäº›åŒºåˆ«ï¼Œä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥ç”¨ä»€ä¹ˆæ¨¡å‹ã€‚</p><h2>æ–‡æœ¬æ”¹å†™ï¼Œä»ä½¿ç”¨æç¤ºè¯­å¼€å§‹</h2><p>æˆ‘çŒœè¯¾ç¨‹å­¦åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥å·²ç»ç”¨è¿‡ä¸å°‘åŸºäºAIå¤§è¯­è¨€æ¨¡å‹çš„äº§å“äº†ã€‚å¾ˆå¸¸è§çš„ä¸€ç±»åº”ç”¨ï¼Œå°±æ˜¯å†™ä½œåŠ©æ‰‹ã€‚æ¯”å¦‚Notion AIå°±èƒ½å¸®åŠ©ä½ ï¼Œåœ¨å·²ç»å†™å¥½çš„æ–‡ç« é‡Œé¢é€‰å–ä¸€æ®µå†…å®¹ï¼Œä½ å¯ä»¥è®©AIå¸®ä½ ä¿®æ”¹ã€‚è¿™ä¸ªä¿®æ”¹å¯ä»¥æ˜¯è®©æ–‡æœ¬çŸ­ä¸€ç‚¹æˆ–è€…é•¿ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯è®©æ–‡æœ¬æ”¹ä¸€ä¸‹è‡ªå·±çš„è¯­æ°”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/e0/f3df3181e7f0a44f50e5f870a2256ae0.png?wh=556x459\" alt=\"å›¾ç‰‡\" title=\"Notionçš„æ–‡æœ¬æ”¹å†™çš„ç•Œé¢\"></p><p>ä¸è¿‡ï¼ŒOpenAIçš„GPTçš„ç³»åˆ—æ¨¡å‹æ˜¯ä¸€ä¸ªç”Ÿæˆå¼çš„æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„ç”¨æ³•æ˜¯ä½ ç»™å®ƒä¸€æ®µæ–‡å­—ï¼Œç„¶åå®ƒè¡¥å…¨åé¢çš„æ–‡å­—ã€‚æŒ‰ç†æ¥è¯´ï¼Œä½ æ˜¯æ²¡æ³•è®©å®ƒä¿®æ”¹ä¸€æ®µå†…å®¹çš„ã€‚å½“ç„¶ï¼Œåœ¨çœ‹äº†é‚£ä¹ˆå¤šä¸åŒçš„â€œæç¤ºè¯­â€ä¹‹åï¼Œç›¸ä¿¡ä½ è‡ªç„¶æƒ³åˆ°å¯ä»¥é€šè¿‡ä¸€æ®µæç¤ºè¯­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™æ®µä»£ç å°±æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šä¸€è®²ä»‹ç»çš„ChatGPTçš„æ¨¡å‹æ¥å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><!-- [[[read_end]]] --><pre><code class=\"language-python\">def make_text_short(text):\n    messages = []\n    messages.append( {\"role\": \"system\", \"content\": \"ä½ æ˜¯ä¸€ä¸ªç”¨æ¥å°†æ–‡æœ¬æ”¹å†™å¾—çŸ­çš„AIåŠ©æ‰‹ï¼Œç”¨æˆ·è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼Œä½ ç»™å‡ºä¸€æ®µæ„æ€ç›¸åŒï¼Œä½†æ˜¯çŸ­å°ç²¾æ‚çš„ç»“æœ\"})\n    messages.append( {\"role\": \"user\", \"content\": text})\n    response = openai.ChatCompletion.create(\n        model=\"gpt-3.5-turbo\",\n        messages=messages,\n        temperature=0.5,\n        max_tokens=2048,\n        presence_penalty=0,\n        frequency_penalty=2,\n        n=3,\n    )\n    return response\n\nlong_text = \"\"\"\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½é¢ä¸´ç€å„ç§å„æ ·çš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚\nåœ¨è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ä¸­ï¼Œæœ‰äº›æ˜¯ç”±å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç¾å®³ç­‰ã€‚\nè¿˜æœ‰ä¸€äº›æ˜¯ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜å’Œè‡ªæˆ‘æ€€ç–‘ç­‰ã€‚\né¢å¯¹è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ç§¯æçš„æ€åº¦å’Œè¡ŒåŠ¨æ¥å…‹æœå®ƒä»¬ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„èƒ½åŠ›ã€‚\nåªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å®ç°è‡ªå·±çš„æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\n\"\"\"\nshort_version = make_text_short(long_text)\n\nindex = 1\nfor choice in short_version[\"choices\"]:\n    print(f\"version {index}: \" + choice[\"message\"][\"content\"])\n    index += 1\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">version 1: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢ä¸´å¤–éƒ¨å’Œå†…éƒ¨çš„æŒ‘æˆ˜ã€‚è¦å…‹æœå®ƒä»¬ï¼Œéœ€è¦ç§¯ææ€åº¦ã€åˆ›é€ æ€§æ€ç»´å’Œå¯»æ±‚æ”¯æŒèƒ½åŠ›ã€‚è¿™æ ·æ‰èƒ½å®ç°è‡ªå·±æ½œåŠ›å¹¶æˆåŠŸã€‚\nversion 2: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢ä¸´å„ç§æŒ‘æˆ˜å’Œå›°éš¾ã€‚æœ‰äº›æ˜¯å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œå¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–ç­‰ï¼›è¿˜æœ‰äº›æ˜¯å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œå¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜ç­‰ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦ç§¯æåº”å¯¹ï¼Œå¹¶å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´èƒ½åŠ›ï¼Œå¹¶å¯»æ±‚å¤–éƒ¨æ”¯æŒã€‚åªæœ‰è¿™æ ·æ‰èƒ½å®ç°è‡ªå·±æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\nversion 3: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢ä¸´å„ç§æŒ‘æˆ˜å’Œå›°éš¾ã€‚æœ‰äº›æºäºå¤–éƒ¨å› ç´ ï¼ˆå¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–ï¼‰ï¼Œè€Œå¦ä¸€äº›åˆ™æ¥è‡ªå†…éƒ¨ï¼ˆå¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜ï¼‰ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦ç§¯æåº”å¯¹å¹¶å±•ç°åšéŸ§çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œå¹¶å¯»æ±‚å¤–ç•Œæ”¯æŒã€‚åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å®ç°æ½œåŠ›å¹¶è·å¾—æˆåŠŸã€‚\n</code></pre><p>ä½¿ç”¨ChatGPTçš„æ¨¡å‹æ¥å£ï¼Œæ˜¯å› ä¸ºå®ƒçš„ä»·æ ¼æ¯”è¾ƒä½å»‰ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨çš„å‚æ•°ä¹Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªè°ƒæ•´ã€‚</p><ol>\n<li>é¦–å…ˆæ˜¯æˆ‘ä»¬ä½¿ç”¨äº† n=3 è¿™ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è®©AIç»™æˆ‘ä»¬è¿”å›3ä¸ªç­”æ¡ˆä¾›æˆ‘ä»¬é€‰æ‹©ã€‚åœ¨æ–‡æœ¬æ”¹å†™ç±»çš„åº”ç”¨é‡Œé¢ï¼Œæˆ‘ä»¬é€šå¸¸ä¸åªæ˜¯ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œè€Œæ˜¯ä¼šç»™ç”¨æˆ·å‡ ä¸ªé€‰é¡¹æ¥é€‰æ‹©ã€‚</li>\n<li>å…¶æ¬¡æ˜¯æˆ‘ä»¬å¼•å…¥äº†ä¸¤ä¸ªå‚æ•° presence_penalty=0 ä»¥åŠ frequency_penalty=2ã€‚è¿™ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰ä»‹ç»è¿‡ï¼Œå®ƒä»¬å’Œtemperatureå‚æ•°ç±»ä¼¼ï¼Œéƒ½æ˜¯æ¥æ§åˆ¶ä½ è¾“å‡ºçš„å†…å®¹çš„ã€‚\n<ol>\n<li>presence_penaltyï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¦‚æœä¸€ä¸ªTokenåœ¨å‰é¢çš„å†…å®¹å·²ç»å‡ºç°è¿‡äº†ï¼Œé‚£ä¹ˆåœ¨åé¢ç”Ÿæˆçš„æ—¶å€™ç»™å®ƒçš„æ¦‚ç‡ä¸€å®šçš„æƒ©ç½šã€‚è¿™æ ·ï¼ŒAIå°±ä¼šå€¾å‘äºèŠæ–°çš„è¯é¢˜å’Œå†…å®¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆäº†é»˜è®¤å€¼0ã€‚</li>\n<li>frequency_penaltyï¼ŒæŒ‡çš„æ˜¯å¯¹äºé‡å¤å‡ºç°çš„Tokenè¿›è¡Œæ¦‚ç‡æƒ©ç½šã€‚è¿™æ ·ï¼ŒAIå°±ä¼šå°½é‡ä½¿ç”¨ä¸åŒçš„è¡¨è¿°ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬è®¾æˆäº†æœ€å¤§çš„2ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®æˆæœ€å°çš„-2ã€‚ä½†æ˜¯é‚£æ ·çš„è¯ï¼Œå®ƒå°±æ›´å®¹æ˜“è¯´è½¦è½±è¾˜è¯äº†ã€‚</li>\n</ol>\n</li>\n</ol><h2>é€šè¿‡logit_biaså‚æ•°ç²¾ç¡®æ§åˆ¶å†…å®¹</h2><p>ä¸è¿‡ï¼Œæ— è®ºæ˜¯temperatureè¿˜æ˜¯presence_penaltyå’Œfrequency_penaltyï¼Œéƒ½æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ç²¾ç¡®æ§åˆ¶å“ªäº›è¯æˆ‘ä»¬ä¸æƒ³å‡ºç°ã€‚ä¸è¿‡ï¼Œå¯¹äºè¿™ä¸€ç‚¹ï¼ŒOpenAIè¿˜æ˜¯æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ä¸Šé¢ç”Ÿæˆçš„å†…å®¹é‡Œé¢ï¼Œä¸å…è®¸å‡ºç°ç¾å®³ä¸¤ä¸ªå­—ï¼Œå°±å¯ä»¥è¿™ä¹ˆåšã€‚</p><pre><code class=\"language-python\">import tiktoken\nencoding = tiktoken.get_encoding('p50k_base')\ntoken_ids = encoding.encode(\"ç¾å®³\")\nprint(token_ids)\n\nbias_map = {}\nfor token_id in token_ids:\n    bias_map[token_id] = -100\n\ndef make_text_short(text):\n    messages = []\n    messages.append( {\"role\": \"system\", \"content\": \"ä½ æ˜¯ä¸€ä¸ªç”¨æ¥å°†æ–‡æœ¬æ”¹å†™å¾—çŸ­çš„AIåŠ©æ‰‹ï¼Œç”¨æˆ·è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼Œä½ ç»™å‡ºä¸€æ®µæ„æ€ç›¸åŒï¼Œä½†æ˜¯çŸ­å°ç²¾æ‚çš„ç»“æœ\"})\n    messages.append( {\"role\": \"user\", \"content\": text})\n    response = openai.ChatCompletion.create(\n        model=\"gpt-3.5-turbo\", messages=messages, temperature=0.5, max_tokens=2048,\n        n=3, presence_penalty=0, frequency_penalty=2, \n        logit_bias = bias_map,\n    )\n    return response\n\nshort_version = make_text_short(long_text)\n\nindex = 1\nfor choice in short_version[\"choices\"]:\n    print(f\"version {index}: \" + choice[\"message\"][\"content\"])\n    index += 1\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">[163, 223, 122, 22522, 111]\nversion 1: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢å¯¹å„ç§æŒ‘æˆ˜å’Œå›°éšœã€‚æœ‰äº›æ˜¯å¤–éƒ¨åŸå› å¼•èµ·çš„ï¼Œå¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç½å®£ç­‰ï¼›è¿˜æœ‰ä¸€äº›æ˜¯å†…å¿ƒé—®é¢˜ï¼Œå¦‚æƒ…æ„Ÿã€å¥åº·å’Œè‡ªæˆ‘æ€€å¿µç­‰ã€‚ä¸ºå…‹æœè¿™äº›å›°éšœæˆ‘ä»¬éœ€è¦ç§¯ææ­£é¢æ€åº¦å¹¶é‡‡å–è¡ŒåŠ¨ï¼Œå¹¶å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—ä¸åˆ›é€ æ€§æ€ç»´èƒ½åŠ›ä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„æŠ€å·§ã€‚åªè¦è¿™æ ·åšäº†, æˆ‘ä»¬å°±å¯ä»¥çœŸæ­£å®ç°æ½œåŠ›å¹¶è·å¾—æˆåŠŸ.\nversion 2: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢å¯¹å¤–éƒ¨å’Œå†…éƒ¨çš„æŒ‘æˆ˜ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ç¤ºæ„ï¼Œéœ€è¦ç§¯æ¶ä¸»åŠ¨æ€åº¦å’Œè¡ŒåŠ¨ï¼Œå¹¶å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—ã€åˆ›é€ æ€§æ€ç»´ä»¥åŠå¯»æ±‚æ”¯æŒèƒ½åŠ›ã€‚åªæœ‰è¿™æ ·æ‰èƒ½å®ç°æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\nversion 3: ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬é¢ä¸´å„ç§æŒ‘æˆ˜å’Œå›°éšœã€‚æœ‰å¤–éƒ¨å› ç´ å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–ç­‰ï¼Œä¹Ÿæœ‰å†…éƒ¨å› ç´ å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜ç­‰ã€‚ä¸ºå…‹æœè¿™äº›å›°å¢ƒï¼Œéœ€è¦ç§¯æ¶æ€åº¦å’Œè¡ŒåŠ¨ï¼Œå¹¶å…·å¤‡åšéŸ§æ„å¿—ã€åˆ›é€ æ€§æ€ç»´åŠå¤–éƒ¨æ”¯æŒèƒ½åŠ›ã€‚åªæœ‰è¿™æ ·æ‰èƒ½å®ç°è‡ªæˆ‘æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\n</code></pre><p>è¿™æ®µä»£ç é‡Œé¢ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·åšçš„ã€‚</p><ol>\n<li>æˆ‘ä»¬é€šè¿‡ä¹‹å‰ä½¿ç”¨è¿‡çš„Tiktokenåº“ï¼ŒæŠŠæˆ‘ä»¬ä¸å¸Œæœ›å‡ºç°çš„â€œç¾å®³â€è¿™ä¸ªè¯å„¿ï¼Œæ‰¾åˆ°å®ƒå¯¹åº”çš„Tokenï¼Œç„¶åç»™å®ƒä»¬éƒ½èµ‹äº†ä¸€ä¸ª-100çš„biasã€‚</li>\n<li>ç„¶åæŠŠæ•´ä¸ªçš„bias_mapä½œä¸ºå‚æ•°ï¼Œä¼ ç»™äº†Completionçš„logit_biaså‚æ•°ã€‚</li>\n</ol><p>åœ¨ç”Ÿæˆç»“æœé‡Œé¢ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªå›å¤éƒ½æ²¡æœ‰â€œç¾å®³â€è¿™ä¸¤ä¸ªå­—äº†ã€‚å³ä½¿æ˜¯ä¹‹å‰å‡ºç°çš„ç¬¬ä¸€ä¸ªå›å¤é‡ŒåŸæ¥æ˜¯æœ‰â€œç¾å®³â€è¿™ä¸¤ä¸ªå­—çš„ã€‚ç°åœ¨ä¸€ä¸ªè¢«å¼ºè¡Œæ”¹æˆäº†ç¹ä½“çš„â€œç½â€å­—ï¼Œå¦ä¸€ä¸ªå¹²è„†æ˜¯ç»™äº†ä¸ªé”™åˆ«å­—â€œå®£â€ã€‚</p><p>å¯¹äº logit_bias å‚æ•°é‡Œé¢çš„å–å€¼èŒƒå›´ï¼Œæ˜¯åœ¨-100åˆ°100ä¹‹é—´ã€‚ä¸è¿‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¾ç½®åœ¨1åˆ°-1ä¹‹é—´å°±è¶³å¤Ÿäº†ã€‚æˆ‘è‡ªå·±çš„ä½“ä¼šæ˜¯ï¼Œè®¾ç½®æˆ100ï¼Œä½ ä¸€å®šè¦æŸäº›å­—å‡ºç°ï¼Œé‚£ä¹ˆæ•´ä¸ªç”Ÿæˆä¼šæ…¢åˆ°æ— æ³•å¿å—ã€‚</p><h2>ä½¿ç”¨è‹±æ–‡æ¥å‡å°‘Tokençš„ä½¿ç”¨</h2><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè™½ç„¶ç¾å®³åªæœ‰ä¸¤ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡Tiktokenå»å¤„ç†çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰“å°äº†å¯¹åº”çš„Tokençš„idæ˜¯ä»€ä¹ˆï¼Œå®é™…ä¸Šæœ‰5ä¸ªTokenã€‚è¿™é‡Œå…¶å®å’Œæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„è‹±æ–‡ä¸€æ ·ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå­—æˆ–è€…ä¸€ä¸ªå•è¯æ˜¯ä¸€ä¸ªTokenã€‚äº‹å®ä¸Šï¼ŒåŒæ ·å«ä¹‰çš„ä¸­æ–‡ï¼Œç›®å‰æ¶ˆè€—çš„Tokenæ•°é‡æ˜¯æ¯”è‹±æ–‡å¤šçš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„ä¸€å¥è¯ç¿»è¯‘æˆè‹±æ–‡ï¼Œç„¶åæ•°ä¸€ä¸‹å¯¹åº”åŒæ ·å†…å®¹çš„ä¸­è‹±æ–‡çš„Tokenæ•°ã€‚</p><pre><code class=\"language-python\">def translate(text):\n    messages = []\n    messages.append( {\"role\": \"system\", \"content\": \"ä½ æ˜¯ä¸€ä¸ªç¿»è¯‘ï¼ŒæŠŠç”¨æˆ·çš„è¯ç¿»è¯‘æˆè‹±æ–‡\"})\n    messages.append( {\"role\": \"user\", \"content\": text})\n    response = openai.ChatCompletion.create(\n        model=\"gpt-3.5-turbo\", messages=messages, temperature=0.5, max_tokens=2048,        n=1\n    )\n    return response[\"choices\"][0][\"message\"][\"content\"]\n\nchinese = long_text\nenglish = translate(chinese)\n\nnum_of_tokens_in_chinese = len(encoding.encode(chinese))\nnum_of_tokens_in_english = len(encoding.encode(english))\nprint(english)\nprint(f\"chinese: {num_of_tokens_in_chinese} tokens\")\nprint(f\"english: {num_of_tokens_in_english} tokens\")\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">In this fast-paced modern society, each of us faces various challenges and difficulties. Some of these challenges and difficulties are caused by external factors, such as economic recession, global warming, and natural disasters. There are also some caused by internal factors, such as emotional issues, health problems, and self-doubt. To overcome these challenges and difficulties, we need to adopt a positive attitude and take action. This means we must possess a strong will and creative thinking, as well as the ability to seek external support. Only in this way can we truly realize our potential and achieve success.\nchinese: 432 tokens\nenglish: 115 tokens\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŒæ ·çš„å†…å®¹ï¼Œä¸­æ–‡æ¶ˆè€—çš„Tokenæ•°é‡è¶…è¿‡400ï¼Œè€Œè‹±æ–‡çš„Tokenæ•°é‡åªæœ‰100å‡ºå¤´ã€‚å¦‚æœä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨OpenAIçš„æ¥å£ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨è‹±æ–‡çš„æç¤ºè¯­ï¼Œæœ€å¤šåœ¨è¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œå‘Šè¯‰å®ƒ â€œgenerate Chineseâ€ ä¹‹ç±»çš„ï¼Œå¯ä»¥æå¤§åœ°èŠ‚çº¦æˆæœ¬ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åé¢è¯¾ç¨‹çš„æ¼”ç¤ºï¼Œè¿˜æ˜¯ä¼šå°½é‡ä½¿ç”¨ä¸­æ–‡ï¼Œæ–¹ä¾¿ä½ ç†è§£ã€‚</p><h2>çœ‹çœ‹OpenAIç»™äº†æˆ‘ä»¬å“ªäº›æ¨¡å‹</h2><p>æœ‰äº›åŒå­¦å¯èƒ½çœ‹è¿‡æ–‡æ¡£ä¼šè¯´ï¼Œæ”¹å†™æ–‡æœ¬ä¸æ˜¯OpenAIå•ç‹¬æä¾›äº†ä¸€ä¸ªEditçš„æ¥å£å—ï¼Ÿçš„ç¡®ï¼Œæ›¾ç»ï¼ŒOpenAIå•ç‹¬ç»™è¿‡ä¸€ä¸ªEditæ¥å£ï¼Œä¹Ÿå•ç‹¬æä¾›äº†æ–‡æœ¬ç¼–è¾‘çš„æ¨¡å‹ã€‚ç›®å‰ï¼Œä½ åœ¨OpenAIçš„å®˜ç½‘ä¸Šè¿˜èƒ½çœ‹åˆ°ç›¸å…³çš„<a href=\"https://platform.openai.com/docs/api-reference/edits\">æ–‡æ¡£</a>ã€‚ä½†æ˜¯æ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œè¿™ä¸ªæ¥å£å’Œæ¨¡å‹ç›®å‰æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œä¸çŸ¥é“æ˜¯å› ä¸ºæ˜¯Alphaç‰ˆæœ¬è¿˜æ˜¯å·²ç»è¢«ä¸‹çº¿äº†ã€‚</p><p>å› ä¸ºç›®å‰OpenAIçš„äº§å“æ›´æ–°éå¸¸å¿«ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å‘Šè¯‰ä½ åº”è¯¥ä½¿ç”¨æŸä¸ªæ¨¡å‹ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹å·²ç»ä¸æ˜¯æ•ˆæœæœ€å¥½æˆ–è€…æœ€æ–°çš„äº†ã€‚æ‰€ä»¥ï¼Œæœ€å¥½çš„åŠæ³•ï¼Œè¿˜æ˜¯é€šè¿‡å®ƒæä¾›çš„æ¥å£çœ‹çœ‹å®ƒåˆ°åº•æœ‰å“ªäº›æ¨¡å‹ã€‚</p><pre><code class=\"language-python\">import pandas as pd\n# list all open ai models\nengines = openai.Engine.list()\npd = pd.DataFrame(openai.Engine.list()['data'])\ndisplay(pd[['id', 'owner']])\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">\tid\towner\n0\tbabbage\topenai\n1\tdavinci\topenai\n2\tbabbage-code-search-code\topenai-dev\n3\ttext-similarity-babbage-001\topenai-dev\n4\ttext-davinci-001\topenai\nâ€¦â€¦\n14\ttext-embedding-ada-002\topenai-internal\nâ€¦â€¦\n30\tgpt-3.5-turbo-0301\topenai\nâ€¦â€¦\n41\tgpt-4\topenai\n42\ttext-search-davinci-doc-001\topenai-dev\n43\tgpt-4-0314\topenai\nâ€¦â€¦\n47\ttext-similarity-davinci-001\topenai-dev\n48\ttext-davinci-002\topenai\n49\tdavinci-similarity\topenai-dev\n</code></pre><p>åœ¨æˆ‘å†™ä¸‹è¿™èŠ‚è¯¾çš„æ—¶å€™ï¼Œè¾“å‡ºç»“æœé‡Œæœ‰49ä¸ªæ¨¡å‹ã€‚å…¶å®é¡¾åæ€ä¹‰ï¼Œä½ å°±èƒ½å¤ŸçŸ¥é“è¿™äº›æ¨¡å‹æ˜¯ç”¨æ¥å¹²å•¥çš„ã€‚æ¯”å¦‚ text-similarity-babbage-001 è‚¯å®šå°±æ˜¯ç”¨æ¥è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…çš„ï¼Œå°±ä¼šæ¯”è¾ƒé€‚åˆç”¨åœ¨æˆ‘ä»¬ <a href=\"https://time.geekbang.org/column/article/642179\">02 è®²</a>ä»‹ç»çš„é›¶æ ·æœ¬åˆ†ç±»ã€‚è€Œ text-search-davinci-doc-001 è‚¯å®šå°±æ›´é€‚åˆç”¨æ¥æœç´¢æ–‡æ¡£ã€‚</p><p>å°½ç®¡æœ‰äº›æ¨¡å‹çš„åå­—æ ‡æ³¨äº† openai-dev æˆ–è€… openai-internalï¼Œä½†æ˜¯è¿™äº›æ¨¡å‹éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨ <a href=\"https://time.geekbang.org/column/article/642179\">02 è®²</a>é‡Œé¢è°ƒç”¨get_embeddingæ–¹æ³•æ‹¿åˆ°å‘é‡ï¼ŒèƒŒåç”¨çš„å°±æ˜¯ text-similarity-davinci-001 æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªopenai-devçš„æ¨¡å‹ã€‚</p><p>ä¸è¿‡ï¼Œé‡Œé¢çš„å¾ˆå¤šæ¨¡å‹éƒ½å·²ç»è€æ—§äº†ï¼Œå®é™…ä¸Šä¸»è¦ç”¨çš„æ¨¡å‹å°±æ˜¯è¿™å‡ ç±»ã€‚</p><ol>\n<li>GPT-4å®¶æ—çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ gpt-4 å’Œ gpt-4-0314ã€‚ä½¿ç”¨çš„æ–¹å¼å’ŒChatGPTçš„æ¨¡å‹ä¸€æ ·ï¼Œå…¶ä¸­å¸¦æ—¥æœŸçš„æ¨¡å‹è¡¨ç¤ºæ˜¯ä¸€ä¸ªæ¨¡å‹å¿«ç…§ã€‚ä¹Ÿå°±æ˜¯æ¨¡å‹ä¸ä¼šéšç€æ—¶é—´è¿ç§»ä¸æ–­æ›´æ–°ã€‚GPT-4çš„æ¨¡å‹ç°åœ¨è¿˜å¾ˆæ˜‚è´µï¼Œè¾“å…¥1000ä¸ªTokenéœ€è¦0.03ç¾åˆ†ï¼Œç”Ÿæˆ1000ä¸ªTokenåˆ™éœ€è¦0.06ç¾åˆ†ã€‚ä¸€èˆ¬å‘¢ï¼Œæˆ‘éƒ½æ˜¯æ‹¿å®ƒå¸®æˆ‘å†™ä»£ç ï¼Œå‡†ç¡®ç‡ä¼šæ¯”è¾ƒé«˜ã€‚</li>\n<li>GPT-3.5å®¶æ—çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ChatGPTæ‰€ä½¿ç”¨çš„gpt-3.5-turboæˆ–è€…gpt-3.5-turbo-0301ï¼Œä»¥åŠ text-davinci-003 å’Œ text-davinci-002 è¿™ä¸¤ä¸ªæ¨¡å‹ã€‚å‰è€…ä¸“é—¨é’ˆå¯¹å¯¹è¯çš„å½¢å¼è¿›è¡Œäº†å¾®è°ƒï¼Œå¹¶ä¸”ä»·æ ¼ä¾¿å®œï¼Œæ— è®ºè¾“å…¥è¾“å‡ºï¼Œ1000ä¸ªTokenéƒ½åªéœ€è¦0.002ç¾åˆ†ã€‚åä¸¤ä¸ªé‡Œï¼Œ003çš„æ¨¡å‹æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½ï¼Œå°±æ˜¯æ”¯æŒâ€œæ’å…¥æ–‡æœ¬â€è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬ç¨åå°±è®²ã€‚003ä¹Ÿæ˜¯åŸºäºå¼ºåŒ–å­¦ä¹ å¾®è°ƒçš„ï¼Œè€Œ002åˆ™æ˜¯åšäº†ç›‘ç£å­¦ä¹ ä¸‹çš„å¾®è°ƒã€‚text-davinci-003å’Œ002æ¨¡å‹æ¯”3.5-turboè¦è´µ10å€ï¼Œä½†æ˜¯è¾“å‡ºæ›´ç¨³å®šã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¥å†³å®šã€‚</li>\n<li>å‰©ä¸‹çš„ï¼Œåˆ™æ˜¯ Adaã€Babbageã€Curieä»¥åŠDavinciè¿™å››ä¸ªåŸºç¡€æ¨¡å‹ã€‚åªé€‚åˆç”¨äºä¸‹è¾¾å•è½®çš„æŒ‡ä»¤ï¼Œä¸é€‚åˆè€ƒè™‘å¤æ‚çš„ä¸Šä¸‹æ–‡å’Œè¿›è¡Œé€»è¾‘æ¨ç†ã€‚è¿™å››ä¸ªæ¨¡å‹æŒ‰ç…§é¦–å­—æ¯æ’åºï¼Œä»·æ ¼è¶Šæ¥è¶Šè´µï¼Œæ•ˆæœè¶Šæ¥è¶Šå¥½ã€‚è€Œä¸”æˆ‘ä»¬å¦‚æœè¦å¾®è°ƒä¸€ä¸ªå±äºè‡ªå·±çš„æ¨¡å‹ï¼Œä¹Ÿéœ€è¦åŸºäºè¿™å››ä¸ªåŸºç¡€æ¨¡å‹ã€‚</li>\n<li>æœ€ååˆ™æ˜¯ text-embedding-ada-002ã€text-similarity-ada-001 è¿™äº›ä¸“é—¨ç”¨é€”æ¨¡å‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ¨¡å‹æ¥è·å–Embeddingï¼Œå†ç”¨åœ¨å…¶ä»–çš„æœºå™¨å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒï¼Œæˆ–è€…è¯­ä¹‰ç›¸ä¼¼åº¦çš„æ¯”è¾ƒä¸Šã€‚</li>\n</ol><p>æ‰€æœ‰æ¨¡å‹çš„åå­—éƒ½æ¥è‡ªç§‘å­¦å²ä¸Šçš„åäººã€‚Adaæ¥è‡ªäººç±»å²ä¸Šç¬¬ä¸€ä½ç¨‹åºå‘˜Adaï¼Œå¥¹ä¹Ÿæ˜¯è‘—åè¯—äººæ‹œä¼¦çš„å¥³å„¿ã€‚è€ŒBabadgeåˆ™æ˜¯è®¾è®¡äº†åˆ†ææœºçš„å·´è´å¥‡ï¼Œå·´è´å¥‡åˆ†ææœºä¹Ÿè¢«è®¤ä¸ºæ˜¯ç°ä»£è®¡ç®—æœºçš„å‰èº«ã€‚Curieåˆ™æ˜¯æŒ‡å±…é‡Œå¤«äººï¼ŒDavinciæ˜¯æŒ‡è¾¾èŠ¬å¥‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŒ‘å‡ ä¸ªæ¨¡å‹ï¼Œè¯•ä¸€ä¸‹å®ƒä»¬Embeddingçš„ç»´åº¦æ•°é‡ï¼Œä½ å°±çŸ¥é“æ¨¡å‹çš„å°ºå¯¸æœ¬èº«å°±æ˜¯ä¸ä¸€æ ·çš„äº†ã€‚</p><pre><code class=\"language-python\">from openai.embeddings_utils import get_embedding\n\ntext = \"è®©æˆ‘ä»¬æ¥ç®—ç®—Embedding\"\n\nembedding_ada = get_embedding(text, engine=\"text-embedding-ada-002\")\nprint(\"embedding-ada: \", len(embedding_ada))\n\nsimilarity_ada = get_embedding(text, engine=\"text-similarity-ada-001\")\nprint(\"similarity-ada: \", len(similarity_ada))\n\nbabbage_similarity = get_embedding(text, engine=\"babbage-similarity\")\nprint(\"babbage-similarity: \", len(babbage_similarity))\n\nbabbage_search_query = get_embedding(text, engine=\"text-search-babbage-query-001\")\nprint(\"search-babbage-query: \", len(babbage_search_query))\n\ncurie = get_embedding(text, engine=\"curie-similarity\")\nprint(\"curie-similarity: \", len(curie))\n\ndavinci = get_embedding(text, engine=\"text-similarity-davinci-001\")\nprint(\"davinci-similarity: \", len(davinci))\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">embedding-ada:  1536\nsimilarity-ada:  1024\nbabbage-similarity:  2048\nsearch-babbage-query:  2048\ncurie-similarity:  4096\ndavinci-similarity:  12288\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€å°çš„ada-similarityåªæœ‰1024ç»´ï¼Œè€Œæœ€å¤§çš„davinci-similarityåˆ™æœ‰12288ç»´ï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•ˆæœå’Œä»·æ ¼ä¸åŒä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„äº†ã€‚</p><h2>æ’å…¥å†…å®¹ï¼ŒGPTä¹Ÿå¯ä»¥åƒBERT</h2><p>æˆ‘ä»¬å‰é¢ä»‹ç»çš„æ—¶å€™è¯´è¿‡ï¼Œtext-davinci-003 è¿™ä¸ªæ¨¡å‹æœ‰ä¸ªç‰¹æ®Šçš„åŠŸèƒ½ï¼Œå°±æ˜¯â€œæ’å…¥æ–‡æœ¬â€ï¼ˆInserting Textï¼‰ã€‚æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªåŠŸèƒ½æ¥åšæ–‡æœ¬æ”¹å†™ã€‚</p><pre><code class=\"language-python\">prefix = \"\"\"åœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½é¢ä¸´ç€å„ç§å„æ ·çš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚\nåœ¨è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ä¸­ï¼Œæœ‰äº›æ˜¯ç”±å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç¾å®³ç­‰ã€‚\\n\"\"\"\n# è¿˜æœ‰ä¸€äº›æ˜¯ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜å’Œè‡ªæˆ‘æ€€ç–‘ç­‰ã€‚\nsuffix = \"\"\"\\né¢å¯¹è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ç§¯æçš„æ€åº¦å’Œè¡ŒåŠ¨æ¥å…‹æœå®ƒä»¬ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„èƒ½åŠ›ã€‚\nåªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å®ç°è‡ªå·±çš„æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\"\"\"\n\ndef insert_text(prefix, suffix):\n    response = openai.Completion.create(\n        model=\"text-davinci-003\",\n        prompt=prefix,\n        suffix=suffix,\n        max_tokens=1024,\n        )\n    return response\n\nresponse = insert_text(prefix, suffix)\nprint(response[\"choices\"][0][\"text\"])\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">å¦ä¸€äº›æ˜¯å†…éƒ¨å› ç´ ï¼Œä¾‹å¦‚äº‹ä¸šéš¾ä»¥å‘å±•ã€æ— æ³•è§£å†³çš„ä¸ªäººå’Œå®¶åº­çŸ›ç›¾ç­‰ã€‚\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¥å£çš„ä½¿ç”¨ï¼Œå’Œæ™®é€šçš„Completionæ¥å£åŸºæœ¬ä¸€è‡´ï¼Œåªæœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯é™¤äº†å‰ç¼€çš„promptå‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªåç¼€çš„suffixå‚æ•°ã€‚</p><p>ä¸è¿‡ï¼Œå¯¹äºæ’å…¥å†…å®¹ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦æ³¨æ„æç¤ºè¯­ã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢çš„å†…å®¹ç¨å¾®æ”¹ä¸€æ”¹ï¼Œæ¯”å¦‚å»æ‰Suffixä¸€å¼€å§‹çš„æ¢è¡Œç¬¦å·ï¼Œæ’å…¥çš„æ–‡æœ¬å†…å®¹æœ‰äº›å°±ä¼šåœ¨æˆ‘ä»¬çš„é¢„æœŸä¹‹å¤–ã€‚</p><pre><code class=\"language-python\">prefix = \"\"\"åœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½é¢ä¸´ç€å„ç§å„æ ·çš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚\nåœ¨è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ä¸­ï¼Œæœ‰äº›æ˜¯ç”±å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç¾å®³ç­‰ã€‚\\n\"\"\"\n# è¿˜æœ‰ä¸€äº›æ˜¯ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜å’Œè‡ªæˆ‘æ€€ç–‘ç­‰ã€‚\nsuffix = \"\"\"é¢å¯¹è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ç§¯æçš„æ€åº¦å’Œè¡ŒåŠ¨æ¥å…‹æœå®ƒä»¬ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„èƒ½åŠ›ã€‚\nåªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å®ç°è‡ªå·±çš„æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\"\"\"\n\nresponse = insert_text(prefix, suffix)\nprint(response[\"choices\"][0][\"text\"])\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">ä¾‹å¦‚ï¼Œå› åº”å…¨çƒå˜æš–ï¼Œæ”¿åºœå’Œäººæ°‘åœ¨åšå‡ºæ›´åŠ æ¸…æ™°çš„è®¡åˆ’æ—¶å°±é¢ä¸´ç€å·¨å¤§çš„å‹åŠ›ï¼Œä»¥å‡å°‘å¤§æ°”æ±¡æŸ“å’Œå‡å°‘ç¢³æ’æ”¾ã€‚\næ›´é‡è¦çš„æ˜¯ï¼Œæ¯ä¸ªäººå¿…é¡»ä¸ºè‡ªå·±æ‰€åšçš„ä»˜å‡ºåŠªåŠ›ï¼Œä»¥é˜²æ­¢è¿™äº›å¤–éƒ¨ç¯å¢ƒå˜åŒ–çš„ä¸åˆ©å½±å“ã€‚\næ­¤å¤–ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæ¯”å¦‚å¿ƒç†é—®é¢˜ï¼Œè´«ç©·å’Œå­¦ä¹ å›°éš¾ã€‚\nä¾‹å¦‚ï¼Œä¸€äº›äººå› ä¸ºç„¦è™‘æˆ–æŠ‘éƒç—‡è€Œæ— æ³•é›†ä¸­ç²¾åŠ›ï¼Œä»–ä»¬çš„å­¦ä¹ èƒ½åŠ›å—åˆ°äº†å½±å“ï¼Œä»è€Œå½±å“äº†ä»–ä»¬çš„å­¦ä¸šæˆç»©ã€‚\nå†è€…ï¼Œè´«ç©·ä¹Ÿæ˜¯å¦ä¸€ä¸ªæ£˜æ‰‹çš„è¯é¢˜ï¼Œå®ƒå½±å“äº†ä¸€ä¸ªäººçš„ç”Ÿæ´»è´¨é‡ï¼Œä»è€Œé˜»ç¢äº†ä»–ä»¬å‘å±•ä¸ªäººæ½œèƒ½çš„èƒ½åŠ›ã€‚\nå› æ­¤ï¼Œ\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒAIä¸€ä¸‹å­å•°å—¦äº†å¾ˆå¤šï¼Œå¹¶ä¸”æœ€åä¸€å¥ä¸æ˜¯ä¸ªå®Œæ•´çš„å¥å­ï¼Œè€Œæ˜¯ä¸‹å¥è¯å¼€å¤´çš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªINSERTæ¥å£çš„æ—¶å€™ï¼Œè€ƒè™‘å¥½æ–‡æœ¬ä¹‹é—´éœ€è¦ä½¿ç”¨ä»€ä¹ˆæ ·çš„åˆ†éš”ç¬¦ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚</p><h2>ä¸è¦ä¹±é—®ä¹±è¯´ï¼Œåšä¸ªâ€œæ­£ç›´â€çš„AI</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹OpenAIå¯¹äºè‡ªç„¶è¯­è¨€å¤„ç†æä¾›çš„æœ€åä¸€ä¸ªæ¥å£ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªå…è´¹çš„æ¥å£â€”â€”Moderateã€‚å› ä¸ºOpenAIå¯ä»¥æ¥å—ä»»ä½•è‡ªç„¶è¯­è¨€çš„è¾“å…¥ï¼Œæ‰€æœ‰çš„å›å¤ä¹Ÿæ˜¯é€šè¿‡æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ä¸€æ—¦æˆ‘ä»¬çš„äº§å“ä¾èµ–äºå®ƒå¯¹å¤–å¼€æ”¾ï¼Œå…ä¸äº†æˆ‘ä»¬æ€»ä¼šé‡åˆ°ä¸€äº›ç”¨æˆ·è¾“å…¥ä¸€äº›å¥‡æ€ªçš„å†…å®¹ï¼Œæ¯”å¦‚è‰²æƒ…ã€æš´åŠ›ç­‰ç­‰ã€‚æ‰€ä»¥ï¼ŒOpenAIä¸“é—¨æä¾›äº†ä¸€ä¸ªmoderateæ¥å£ï¼Œå¯ä»¥è®©ä½ å¯¹è¾“å…¥ä»¥åŠè¿”å›çš„å†…å®¹åšä¸ªæ£€æŸ¥ã€‚å¦‚æœå‡ºç°äº†è¿™æ ·çš„å†…å®¹ï¼Œä½ ä¹Ÿå¯ä»¥å±è”½è¿™äº›ç”¨æˆ·çš„è®¿é—®ï¼Œä¹Ÿå¯ä»¥äººå·¥å®¡æ ¸ä¸€ä¸‹ç”¨æˆ·çš„é—®é¢˜ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸ªä¾‹å­ï¼Œè¿™ä¸ªæ¥å£æ€ä¹ˆç”¨ã€‚</p><pre><code class=\"language-python\">def chatgpt(text):\n    messages = []\n    messages.append( {\"role\": \"system\", \"content\": \"You are a useful AI assistant\"})\n    messages.append( {\"role\": \"user\", \"content\": text})\n    response = openai.ChatCompletion.create(\n        model=\"gpt-3.5-turbo\",\n        messages=messages,\n        temperature=0.5,\n        max_tokens=2048,\n        top_p=1,\n    )\n    message = response[\"choices\"][0][\"message\"][\"content\"]\n    return message\n\nthreaten = \"ä½ ä¸å¬æˆ‘çš„æˆ‘å°±æ‹¿åˆ€ç æ­»ä½ \"\nprint(chatgpt(threaten))\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">å¾ˆæŠ±æ­‰ï¼Œæˆ‘æ˜¯ä¸€å°äººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæ²¡æœ‰å®ä½“å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå¯¹ä»»ä½•äººæˆ–äº‹ç‰©é€ æˆä¼¤å®³ã€‚åŒæ—¶ï¼Œæˆ‘ä¹Ÿä¸ä¼šå¯¹ä»»ä½•ä¸é€‚å½“æˆ–æš´åŠ›çš„è¨€è¯­åšå‡ºå›åº”ã€‚è¯·å°Šé‡å½¼æ­¤ï¼Œä¿æŒè‰¯å¥½çš„æ²Ÿé€šå’Œäº¤æµæ–¹å¼ã€‚\n</code></pre><p>æˆ‘ä»¬å…ˆå¯¹AIæäº†ä¸€å¥æš´åŠ›å¨èƒï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬ç®€å•è°ƒç”¨ChatGPTçš„APIï¼Œå®ƒçš„è¿”å›å¹¶ä¸æ˜¯ä¸€ä¸ªæ—¥å¸¸çš„å¯¹è¯ï¼Œè€Œæ˜¯å‘ŠçŸ¥ç”¨æˆ·ï¼Œä¸ä¼šå›åº”æš´åŠ›è¨€è®ºã€‚</p><p>é‚£æˆ‘ä»¬æ¥ç€æŠŠè¿™å¥è¯å‘é€åˆ°moderateçš„æ¥å£çœ‹çœ‹ã€‚</p><pre><code class=\"language-python\">threaten = \"ä½ ä¸å¬æˆ‘çš„æˆ‘å°±æ‹¿åˆ€ç æ­»ä½ \"\n\ndef moderation(text):\n    response = openai.Moderation.create(\n        input=text\n    )\n    output = response[\"results\"][0]\n    return output\nprint(moderation(threaten))\n</code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code class=\"language-python\">{\n  \"categories\": {\n    \"hate\": false,\n    \"hate/threatening\": false,\n    \"self-harm\": false,\n    \"sexual\": false,\n    \"sexual/minors\": false,\n    \"violence\": true,\n    \"violence/graphic\": false\n  },\n  \"category_scores\": {\n    \"hate\": 0.030033664777874947,\n    \"hate/threatening\": 0.0002820899826474488,\n    \"self-harm\": 0.004850226454436779,\n    \"sexual\": 2.2907377569936216e-05,\n    \"sexual/minors\": 6.477687275463495e-09,\n    \"violence\": 0.9996402263641357,\n    \"violence/graphic\": 4.35576839663554e-05\n  },\n  \"flagged\": true\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œmoderateçš„æ¥å£è¿”å›çš„æ˜¯ä¸€ä¸ªJSONï¼Œé‡Œé¢åŒ…å«æ˜¯å¦åº”è¯¥å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œæ ‡è®°çš„flagå­—æ®µï¼Œä¹ŸåŒ…æ‹¬å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„é—®é¢˜çš„categorieså­—æ®µï¼Œä»¥åŠå¯¹åº”æ¯ä¸ªcategoriesçš„åˆ†æ•°çš„category_scoreså­—æ®µã€‚æˆ‘ä»¬ä¸¾çš„è¿™ä¸ªä¾‹å­å°±è¢«æ ‡è®°æˆäº†violenceï¼Œä¹Ÿå°±æ˜¯æš´åŠ›ã€‚</p><p>å› ä¸ºè¿™ä¸ªæ¥å£æ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥ä½ å¯¹æ‰€æœ‰çš„å†…å®¹æ— è®ºæ˜¯è¾“å…¥è¿˜æ˜¯è¾“å‡ºï¼Œéƒ½å¯ä»¥å»è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªæ¥å£ã€‚è€Œä¸”ï¼Œå³ä½¿ä½ ä¸ä½¿ç”¨ChatGPTçš„AIåŠŸèƒ½ï¼Œåªæ˜¯ç»è¥ä¸€ä¸ªåœ¨çº¿ç½‘ç«™ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠç”¨æˆ·å‘é€çš„å†…å®¹æ‹¿ç»™è¿™ä¸ªæ¥å£çœ‹ä¸€çœ‹ï¼Œè¿‡æ»¤æ‰é‚£äº›ä¸åˆé€‚çš„å†…å®¹ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å¯¹ChatGPTçš„APIçš„åŸºç¡€åŠŸèƒ½åšäº†ä¸€ä¸ªæ”¶å°¾ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹äº†å¦‚ä½•é€šè¿‡åˆé€‚çš„æç¤ºè¯­ï¼Œè¿›è¡Œæ–‡æœ¬æ”¹å†™ã€‚å¹¶ä¸”ï¼Œæ·±å…¥äº†è§£äº†Completionæ¥å£é‡Œé¢çš„ä¸€äº›æ–°å‚æ•°ï¼Œç‰¹åˆ«æ˜¯å…¶ä¸­çš„ logit_bias å‚æ•°ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç”Ÿæˆçš„å†…å®¹é‡Œé¢ï¼Œç²¾ç¡®é¿å…å‡ºç°æˆ‘ä»¬ä¸å¸Œæœ›å‡ºç°çš„Tokenã€‚æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œç›¸åŒçš„å†…å®¹ï¼Œç›®å‰ä¸­æ–‡æ¶ˆè€—çš„Tokenæ•°é‡è¦è¿œé«˜äºè‹±æ–‡ï¼Œæ‰€ä»¥é™¤äº†æœ€åçš„è¾“å‡ºï¼Œå…¶ä»–çš„æç¤ºè¯­åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æˆ‘ä¼šå»ºè®®ä½ ä½¿ç”¨è‹±æ–‡ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹äº†OpenAIåˆ°åº•æä¾›äº†å“ªäº›æ¨¡å‹ï¼Œä»¥åŠä¸åŒçš„æ¨¡å‹é€‚åˆæ‹¿æ¥å¹²ä»€ä¹ˆã€‚æœ€åï¼Œæˆ‘ä»¬ä½“éªŒäº†ä¸¤ä¸ªç‰¹æ®Šçš„æ¥å£ï¼Œä¸€ä¸ªæ˜¯åªæœ‰ text-davinci-003 æ¨¡å‹æ”¯æŒçš„æ–‡æœ¬æ’å…¥åŠŸèƒ½ï¼›å¦ä¸€ä¸ªï¼Œåˆ™æ˜¯å¸®åŠ©æˆ‘ä»¬å¯¹è‰²æƒ…ã€æš´åŠ›ç­‰å†…å®¹è¿›è¡Œå®¡æ ¸è¿‡æ»¤çš„moderateæ¥å£ã€‚</p><p>åˆ°è¿™é‡Œï¼Œè¯¾ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ä¹Ÿå°±å­¦ä¹ å®Œäº†ã€‚æˆ‘ä»¬å·²ç»è¿‡äº†ä¸€éOpenAIçš„GPTæ¨¡å‹çš„æ‰€æœ‰åŸºæœ¬æ¥å£ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨è¿™äº›æ¥å£å®Œæˆæœ€ç®€å•çš„åŠŸèƒ½ã€‚åŒ…æ‹¬ç®€å•çš„æ–‡æœ¬å¤„ç†çš„ä»»åŠ¡ã€èŠå¤©æœºå™¨äººã€æœºå™¨å­¦ä¹ é‡Œçš„åˆ†ç±»å’Œèšç±»ï¼Œä»¥åŠæ–‡æœ¬æ”¹å†™å’Œå†…å®¹å®¡æ ¸ã€‚æœ‰äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬é©¬ä¸Šå°±è¦è¿›å…¥ç¬¬äºŒéƒ¨åˆ†ï¼Œå°±æ˜¯æ€ä¹ˆåˆ©ç”¨è¿™äº›èƒ½åŠ›ï¼Œå¼€å‘å±äºè‡ªå·±çš„åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯æ€ä¹ˆå’Œè‡ªå·±çš„ä¸“æœ‰æ•°æ®ç»“åˆèµ·æ¥ã€‚è¿™ä¹Ÿæ˜¯è¿™é—¨è¯¾ç¨‹ä¸­æ›´ç²¾å½©çš„ä¸€éƒ¨åˆ†ã€‚</p><h2>è¯¾åç»ƒä¹ </h2><p>ä½ èƒ½å°è¯•ä½¿ç”¨ <a href=\"https://time.geekbang.org/column/article/643915\">06 è®²</a>é‡Œçš„Gradioå’Œè¿™ä¸€è®²ä»‹ç»çš„å†…å®¹ï¼Œå°è¯•åšä¸€ä¸ªæ–‡æœ¬æ”¹å†™çš„åº”ç”¨å—ï¼Ÿå¦å¤–ï¼Œä½ å¯ä»¥è¯•ç€ç›´æ¥æŠŠä½ çš„é—®é¢˜æ‹†è§£ä¸€ä¸‹ï¼Œæ‰”ç»™ChatGPTçœ‹çœ‹å®ƒèƒ½å¦å†™å‡ºå¯¹åº”çš„ä»£ç ã€‚</p><p>æœŸå¾…èƒ½åœ¨è¯„è®ºåŒºçœ‹åˆ°ä½ çš„åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ã€‚</p>","comments":[{"had_liked":false,"id":371814,"user_name":"é˜¿æ–Œæ–¯åŸº","can_delete":false,"product_type":"c1","uid":1320988,"ip_address":"å¹¿ä¸œ","ucode":"1E5B7717BD37A0","user_header":"https://static001.geekbang.org/account/avatar/00/14/28/1c/b7e3941c.jpg","comment_is_top":false,"comment_ctime":1680362322,"is_pvip":false,"replies":[{"id":135714,"content":"å¦‚æœæ˜¯å…¬å¸çš„è¯ï¼Œå¯ä»¥æ‰¾ Azure äº‘çš„åˆä½œä¼™ä¼´æ¸ é“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680581449,"ip_address":"ä¸Šæµ·","comment_id":371814,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"gpt4.0 apiåŠ å…¥waitlistå¥½ä¹…äº† æ²¡ä¸‹æ–‡ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆå…¶ä»–é€”å¾„å¯ä»¥è·å–æƒé™ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612213,"discussion_content":"å¦‚æœæ˜¯å…¬å¸çš„è¯ï¼Œå¯ä»¥æ‰¾ Azure äº‘çš„åˆä½œä¼™ä¼´æ¸ é“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680581449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373363,"user_name":"Z12","can_delete":false,"product_type":"c1","uid":1118159,"ip_address":"å¹¿ä¸œ","ucode":"59F5E62F67FFDC","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/cf/bfa0dc80.jpg","comment_is_top":false,"comment_ctime":1682425767,"is_pvip":false,"replies":[{"id":136479,"content":"æˆ‘æœ€æ—©æ˜¯åœ¨è¿™é‡Œ https:&#47;&#47;github.com&#47;openai&#47;openai-python&#47;issues&#47;304\nåˆ¤æ–­åº”è¯¥é€šè¿‡ p50k_base\n\nä½†æ˜¯çœ‹äº†ä¸€ä¸‹æœ€æ–°çš„æ–‡æ¡£ï¼Œä¼¼ä¹åº”è¯¥ç”¨ cl100k_base\nhttps:&#47;&#47;github.com&#47;openai&#47;openai-cookbook&#47;blob&#47;main&#47;examples&#47;How_to_count_tokens_with_tiktoken.ipynb\n\næ™šç‚¹æˆ‘å®éªŒä¸€ä¸‹çœ‹æ˜¯å¦éœ€è¦ä¿®æ­£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1683086186,"ip_address":"ä¸Šæµ·","comment_id":373363,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è€å¸ˆåœ¨è¿™é‡Œé€šè¿‡ logit_bias å‚æ•°ç²¾ç¡®æ§åˆ¶å†…å®¹ï¼Œæˆ‘æœ‰ä¸€ç‚¹ä¸æ˜ç™½ï¼Œè¿™å¥è¯encoding = tiktoken.get_encoding(&#39;p50k_base&#39;)ï¼Œä½ å–çš„æ˜¯p50k_baseç„¶åå–è·å–ç¾å®³å¯¹åº”çš„tokenï¼Œè¿™é‡Œå¥½åƒæœ‰ä¸€ä¸ªå‡è®¾å³tiktokenåº“ä¸­çš„p50k_baseç¼–ç ä¸OpenAIçš„GPT-3.5-turboæ¨¡å‹ä½¿ç”¨çš„ç¼–ç ç›¸åŒï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰ä»èµ„æ–™ä¸­æŸ¥å‡ºOpenAIçš„GPT-3.5-turboä½¿ç”¨çš„æ˜¯&#39;p50k_base&#39;ç¼–ç ï¼Œä½†æ˜¯ä½ çš„è¾“å‡ºç»“æœä¸­åˆç¡®å®è¿‡æ»¤æ‰äº†ç¾å®³ï¼Œè¿™æ˜¯å·§åˆï¼Œè¿˜æ˜¯ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616715,"discussion_content":"æˆ‘æœ€æ—©æ˜¯åœ¨è¿™é‡Œ https://github.com/openai/openai-python/issues/304\nåˆ¤æ–­åº”è¯¥é€šè¿‡ p50k_base\n\nä½†æ˜¯çœ‹äº†ä¸€ä¸‹æœ€æ–°çš„æ–‡æ¡£ï¼Œä¼¼ä¹åº”è¯¥ç”¨ cl100k_base\nhttps://github.com/openai/openai-cookbook/blob/main/examples/How_to_count_tokens_with_tiktoken.ipynb\n\næ™šç‚¹æˆ‘å®éªŒä¸€ä¸‹çœ‹æ˜¯å¦éœ€è¦ä¿®æ­£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683086186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372086,"user_name":"çƒ§ç“¶å°äºº","can_delete":false,"product_type":"c1","uid":3574671,"ip_address":"æµ™æ±Ÿ","ucode":"255A29AFB58601","user_header":"https://static001.geekbang.org/account/avatar/00/36/8b/8f/6fcba5f3.jpg","comment_is_top":false,"comment_ctime":1680696690,"is_pvip":false,"replies":[{"id":135884,"content":"å¤šæœç´¢ä¸€ä¸‹ï¼Œæœ‰ä¸å°‘äººè´´äº†å„ç§è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ\nå¯ä»¥é€šè¿‡ä¿®æ”¹ openai.api_base æ¥ç”¨ç¬¬ä¸‰æ–¹æ­å»ºçš„ä»£ç†è®¿é—®å…¥å£\n\nä¸è¿‡çš„ç¡®ç°åœ¨çš„è®¿é—®é™åˆ¶æ˜¯ä¸ªé—¨æ§›","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680974235,"ip_address":"æ—¥æœ¬","comment_id":372086,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"ä»˜è´¹è´¦å·ä¹Ÿè¢«å°äº†ï¼Œæœ‰æ²¡æœ‰èƒ½è‡ªå·±èƒ½é€šè¿‡å…¬å¸ƒçš„æ¨¡å‹æ­å»ºä¸€ä¸ªæœåŠ¡å™¨çš„å¯èƒ½ï¼Œä¸ç„¶è¯¾ç¨‹å®Œå…¨æ˜¯ç©ºä¸­æ¥¼é˜äº†","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612880,"discussion_content":"å¤šæœç´¢ä¸€ä¸‹ï¼Œæœ‰ä¸å°‘äººè´´äº†å„ç§è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ\nå¯ä»¥é€šè¿‡ä¿®æ”¹ openai.api_base æ¥ç”¨ç¬¬ä¸‰æ–¹æ­å»ºçš„ä»£ç†è®¿é—®å…¥å£\n\nä¸è¿‡çš„ç¡®ç°åœ¨çš„è®¿é—®é™åˆ¶æ˜¯ä¸ªé—¨æ§›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680974235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222233,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a6/59/1689ea0c.jpg","nickname":"é‡‘hb.Ryan å†·ç©ºæ°£é§•åˆ°","note":"","ucode":"CAD363576696E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618786,"discussion_content":"çŸ¥é“ä¸ºä»€ä¹ˆè¢«å°ä¹ˆ? ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684552731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":374548,"user_name":"Geek_b7449f","can_delete":false,"product_type":"c1","uid":2957535,"ip_address":"æ—¥æœ¬","ucode":"07E7023A3ECD5A","user_header":"https://static001.geekbang.org/account/avatar/00/2d/20/df/55bacf31.jpg","comment_is_top":false,"comment_ctime":1684169800,"is_pvip":false,"replies":[{"id":136809,"content":"ğŸ‘ ä¸€èµ·åŠ æ²¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1684725620,"ip_address":"æ–°åŠ å¡","comment_id":374548,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"å†æ—¶ä¸¤ä¸ªæ˜ŸæœŸè¿‡äº†ç¬¬ä¸€éåŸºç¡€çŸ¥è¯†ç¯‡ï¼Œæ”¶è·å¾ˆå¤šå¾ˆå¤šï¼Œé‡åˆ°é—®é¢˜èƒ½ä¸é—®å°±ä¸é—®ï¼Œå®åœ¨ä¸è¡Œå°±é—® gptï¼Œè‡ªå·±ä¸€æ­¥ä¸€ä¸ªå‘ï¼Œèƒ½è¸©å¾—éƒ½è¸©äº†ï¼Œå› ä¸ºé¢åº¦è¢«è‡ªå·±ç©å®Œäº†ï¼Œç”šè‡³è¿˜åŠäº†ä¸€å¼ ä¸‡äº‹é€šçš„ä¿¡ç”¨å¡ï¼Œè·Ÿç€è€å¸ˆå¤šå­¦ç‚¹ï¼Œè¿›æ­¥æ”¶è·çœŸçš„ä¼šå¾ˆå¤šï¼Œä¸‹ä¸€ä¸ªæ˜ŸæœŸç»§ç»­å¤¯å®ä¸‹åŸºç¡€çŸ¥è¯†åï¼Œå†å»çœ‹ä¸‹ä¸€éƒ¨åˆ†ï¼Œå¾ˆæ„Ÿè°¢è€å¸ˆ~","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":618954,"discussion_content":"ğŸ‘ ä¸€èµ·åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684725620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372140,"user_name":"ç¨‹åºå‘˜åŠæ”¯çƒŸ","can_delete":false,"product_type":"c1","uid":1230837,"ip_address":"æ±Ÿè‹","ucode":"23C7B588F400A7","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/f5/108cd83b.jpg","comment_is_top":false,"comment_ctime":1680774476,"is_pvip":false,"replies":[{"id":135892,"content":"æ‰€æœ‰çš„ä»£ç éƒ½åœ¨ https:&#47;&#47;github.com&#47;xuwenhao&#47;geektime-ai-course","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680974593,"ip_address":"æ—¥æœ¬","comment_id":372140,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è¿™ä¸€èŠ‚çš„ä»£ç çš„githubåœ°å€ï¼Œéº»çƒ¦è€å¸ˆå‘ä¸€ä¸‹ï¼Œè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612888,"discussion_content":"æ‰€æœ‰çš„ä»£ç éƒ½åœ¨ https://github.com/xuwenhao/geektime-ai-course","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680974593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371729,"user_name":"Bonnenultä¸¶å‡‰ç…œ","can_delete":false,"product_type":"c1","uid":1448629,"ip_address":"ä¸­å›½å°æ¹¾","ucode":"9CF78FCAE98AC3","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/b5/9635696d.jpg","comment_is_top":false,"comment_ctime":1680236510,"is_pvip":false,"replies":[{"id":135738,"content":"æœ€è¿‘å¥½åƒOpenAIåˆå°ç¦äº†ä¸€æ‰¹è´¦æˆ·ï¼Œå¯ä»¥æ‰¾å‘¨å›´çš„æœ‹å‹çœ‹çœ‹æ˜¯å¦æœ‰å¯ä»¥ç”¨çš„ä»˜è´¹è´¦æˆ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1053568,"ctime":1680583473,"ip_address":"ä¸Šæµ·","comment_id":371729,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"æ³¨å†Œçš„è´¦å·æ²¡æœ‰å…è´¹é¢åº¦ï¼Œè¿æœ€åå…è´¹çš„æ¥å£ä¹Ÿä¸èƒ½è°ƒç”¨qaq\n\nRateLimitError: You exceeded your current quota, please check your plan and billing details.","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"å¾æ–‡æµ©","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612239,"discussion_content":"æœ€è¿‘å¥½åƒOpenAIåˆå°ç¦äº†ä¸€æ‰¹è´¦æˆ·ï¼Œå¯ä»¥æ‰¾å‘¨å›´çš„æœ‹å‹çœ‹çœ‹æ˜¯å¦æœ‰å¯ä»¥ç”¨çš„ä»˜è´¹è´¦æˆ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680583473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1481283,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcEKI64IovCBe0XvmatsRjRI3AYdBzicjqHHWsDXb5vAG0V4rgg2Gv6XRFOfD6lMhDN9Eud6bRTqw/132","nickname":"Geek_71a740","note":"","ucode":"ABBE2C9927301C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611849,"discussion_content":"ä»Šå¤©ä¹Ÿè¯•äº†ä¸€ä¸‹ï¼Œæœç„¶æ²¡æœ‰å…è´¹é¢åº¦äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680357008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371710,"user_name":"Oliå¼ å¸†","can_delete":false,"product_type":"c1","uid":1338098,"ip_address":"æ–°åŠ å¡","ucode":"6E60A370C3C14A","user_header":"https://static001.geekbang.org/account/avatar/00/14/6a/f2/db90fa96.jpg","comment_is_top":false,"comment_ctime":1680225972,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"è€å¸ˆï¼Œæœ€åè®²çš„é‚£ä¸ªå…è´¹æ¨¡å‹ï¼ŒçœŸçš„æ˜¯å¤ªå¥½äº†ï¼Œè§£å†³äº†ä¸€ä¸ªå¤§çš„é—®é¢˜","like_count":31},{"had_liked":false,"id":375179,"user_name":"çŸ³äº‘å‡","can_delete":false,"product_type":"c1","uid":1024195,"ip_address":"å¹¿ä¸œ","ucode":"78F1DD33EFD000","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/c3/c5db35df.jpg","comment_is_top":false,"comment_ctime":1685011956,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100541001,"comment_content":"presence_penalty å’Œ frequency_penalty æ˜¯ OpenAI GPT-3 API ä¸­çš„ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬å¯¹æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬æœ‰å½±å“ã€‚\n\npresence_penaltyï¼šè¿™ä¸ªå‚æ•°å†³å®šäº†æ¨¡å‹åœ¨ç”Ÿæˆæ–°çš„æ–‡æœ¬æ—¶ï¼Œå¯¹äºæ–°é¢–æˆ–ä¸å¸¸è§çš„è¯è¯­çš„åå¥½ç¨‹åº¦ã€‚å¦‚æœå°†å…¶è®¾ç½®å¾—æ›´é«˜ï¼Œæ¨¡å‹å°±æ›´å€¾å‘äºä½¿ç”¨å®ƒä¸å¸¸è§çš„è¯è¯­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®äº†è¾ƒé«˜çš„presence_penaltyï¼Œæ¨¡å‹å¯èƒ½ä¼šé€‰æ‹©â€œä»–èµæ‰¬äº†æˆ‘ï¼Œå°±åƒä¸€åªé¸Ÿå„¿åœ¨æ˜¥å¤©çš„æ¸…æ™¨æ­Œå”±â€ï¼Œè€Œä¸æ˜¯ç®€å•çš„â€œä»–èµæ‰¬äº†æˆ‘â€ã€‚\n\nfrequency_penaltyï¼šè¿™ä¸ªå‚æ•°æ§åˆ¶äº†æ¨¡å‹å¯¹äºé¢‘ç¹å‡ºç°çš„è¯è¯­çš„åå¥½ç¨‹åº¦ã€‚å¦‚æœå°†å…¶è®¾ç½®å¾—æ›´é«˜ï¼Œæ¨¡å‹å°±æ›´å€¾å‘äºé¿å…ä½¿ç”¨é¢‘ç¹å‡ºç°çš„è¯è¯­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®äº†è¾ƒé«˜çš„frequency_penaltyï¼Œæ¨¡å‹å¯èƒ½ä¼šé€‰æ‹©â€œä»–èµæ‰¬äº†æˆ‘ï¼Œå°±åƒä¸€åªé¸Ÿå„¿åœ¨æ˜¥å¤©çš„æ¸…æ™¨æ­Œå”±â€ï¼Œè€Œä¸æ˜¯é‡å¤çš„â€œä»–èµæ‰¬äº†æˆ‘ï¼Œä»–èµæ‰¬äº†æˆ‘â€ã€‚\n\nè¿™ä¸¤ä¸ªå‚æ•°çš„èŒƒå›´éƒ½æ˜¯0.0åˆ°1.0ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„å€¼éƒ½æ˜¯0.0ï¼Œæ„å‘³ç€æ¨¡å‹ä¸ä¼šå¯¹æ–°é¢–æˆ–é¢‘ç¹çš„è¯è¯­æœ‰ä»»ä½•åå¥½ã€‚\n\næ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„è®¾ç½®å¹¶ä¸ä¿è¯æ¨¡å‹ä¸€å®šä¼šæŒ‰ç…§ä½ æœŸæœ›çš„æ–¹å¼ç”Ÿæˆæ–‡æœ¬ï¼Œä½†å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“æ¨¡å‹çš„è¾“å‡ºã€‚","like_count":1},{"had_liked":false,"id":394947,"user_name":"coderlee","can_delete":false,"product_type":"c1","uid":1027564,"ip_address":"ç¦å»º","ucode":"09569C08693514","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ad/ec/406130f3.jpg","comment_is_top":false,"comment_ctime":1728886799,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"æ¯”è¾ƒæ™šï¼Œåœ¨2024å¹´10æœˆä»½æ‰å¼€å§‹å­¦ä¹ è€å¸ˆçš„è¯¾ç¨‹ï¼Œè·Ÿäº†åŸºç¡€çŸ¥è¯†ç¯‡ä¸‹æ¥ï¼Œå¯¹äºå¤§æ¨¡å‹å¯ä»¥è¯´æ˜¯æœ‰äº†ä¸€äº›åŸºç¡€çš„è®¤çŸ¥ã€‚è€å¸ˆå†™çš„demoåº”è¯¥æ˜¯æ¯”è¾ƒæ—©çš„ï¼Œæœ‰è›®å¤šï¼Œå¦‚æœç›´æ¥pip install openaiï¼Œæ˜¯éœ€è¦é€‚é…æˆç°åœ¨çš„apiã€‚å¦‚æœä¸ä¿®æ”¹demoçš„è¯ï¼Œéœ€è¦æŒ‡å®šopenaiçš„ç‰ˆæœ¬ï¼Œç”±äºæˆ‘æ˜¯ä¸ªåˆšæ¥è§¦çš„æ–°æ‰‹ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘é‡‡ç”¨äº† !pip install openai==0.28 æ¥å®Œç¾è¿è¡Œè€å¸ˆæä¾›çš„demoã€‚","like_count":0},{"had_liked":false,"id":394811,"user_name":"Mamba","can_delete":false,"product_type":"c1","uid":1475049,"ip_address":"æ¹–åŒ—","ucode":"8B3EC90736B8EB","user_header":"https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg","comment_is_top":false,"comment_ctime":1728459802,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"ç›®å‰çš„ç‰ˆæœ¬æŸ¥çœ‹openaiçš„æ¨¡å‹\nfrom openai import OpenAI\nclient = OpenAI()\nimport pandas as pd\n# list all open ai models\nmodels = client.models.list()\ndata =[[model.id,model.created,model.object,model.owned_by] for model in models.data]\ndf = pd.DataFrame(data, columns=[&#39;id&#39;, &#39;created&#39;, &#39;object&#39;, &#39;owned_by&#39;])\ndisplay(df[[&#39;id&#39;, &#39;owned_by&#39;]])\n\nä»¥åŠchat.completionæ¥å£\ndef make_text_short(text):\n    messages = []\n    messages.append( {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸€ä¸ªç”¨æ¥å°†æ–‡æœ¬æ”¹å†™å¾—çŸ­çš„AIåŠ©æ‰‹ï¼Œç”¨æˆ·è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼Œä½ ç»™å‡ºä¸€æ®µæ„æ€ç›¸åŒï¼Œä½†æ˜¯çŸ­å°ç²¾æ‚çš„ç»“æœ&quot;})\n    messages.append( {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: text})\n    response = client.chat.completions.create(\n        model=&quot;gpt-4o-mini&quot;,\n        messages=messages,\n        temperature=0.5,\n        max_tokens=2048,\n        presence_penalty=0,\n        frequency_penalty=2,\n        n=3,\n    )\n    return response\nlong_text = &quot;&quot;&quot;\nåœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½é¢ä¸´ç€å„ç§å„æ ·çš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚\nåœ¨è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ä¸­ï¼Œæœ‰äº›æ˜¯ç”±å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç¾å®³ç­‰ã€‚\nè¿˜æœ‰ä¸€äº›æ˜¯ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜å’Œè‡ªæˆ‘æ€€ç–‘ç­‰ã€‚\né¢å¯¹è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ç§¯æçš„æ€åº¦å’Œè¡ŒåŠ¨æ¥å…‹æœå®ƒä»¬ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„èƒ½åŠ›ã€‚\nåªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å®ç°è‡ªå·±çš„æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚\n&quot;&quot;&quot;\nshort_version = make_text_short(long_text)\nindex = 1\nfor choice in short_version.choices:\n    print(f&quot;version {index}: &quot; + choice.message.content)\n    index += 1\nè·å–å†…å®¹éœ€è¦éµå¾ªjsonæ ¼å¼","like_count":0},{"had_liked":false,"id":388714,"user_name":"èŒ‚æ¾","can_delete":false,"product_type":"c1","uid":1052375,"ip_address":"å¹¿ä¸œ","ucode":"458A6FBC49C48E","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/d7/7d7579c1.jpg","comment_is_top":false,"comment_ctime":1710763521,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"COMPLETION_MODEL = &quot;gtp-3.5-turbo&quot;\n\ndef generate_data_by_prompt(prompt):\n      response = openai.chat.completions.create(\n           model = COMPLETION_MODEL,\n           messages = [{&quot;role&quot;:&quot;user&quot;, &quot;content&quot;:prompt}],\n           temperature=0.5,\n           max_tokens=2048,\n           top_p=1,\n   )\n   return response.choices[0].message.content","like_count":0},{"had_liked":false,"id":388632,"user_name":"èŒ‚æ¾","can_delete":false,"product_type":"c1","uid":1052375,"ip_address":"å¹¿ä¸œ","ucode":"458A6FBC49C48E","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/d7/7d7579c1.jpg","comment_is_top":false,"comment_ctime":1710519117,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"openai.chat.completions.create()","like_count":0},{"had_liked":false,"id":388603,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"å¹¿ä¸œ","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1710466162,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"ä¸æ“ä½œä¸€éï¼Œçœ‹ä¸ä¸‹å»äº†ã€‚åªèƒ½å…ˆè¿‡ä¸€é","like_count":0},{"had_liked":false,"id":379522,"user_name":"Zachary","can_delete":false,"product_type":"c1","uid":2497600,"ip_address":"å¹¿ä¸œ","ucode":"7A3C1DC8B4F629","user_header":"https://static001.geekbang.org/account/avatar/00/26/1c/40/9fde5f9b.jpg","comment_is_top":false,"comment_ctime":1692064132,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è¾“å…¥ 1000 ä¸ª Token éœ€è¦ 0.03 ç¾åˆ†ï¼Œç”Ÿæˆ 1000 ä¸ª Token åˆ™éœ€è¦ 0.06 ç¾åˆ†ã€‚\n---\nå¥½åƒæ˜¯3ç¾åˆ†ã€6ç¾åˆ†ï¼Œ0.03ç¾å…ƒã€0.06ç¾å…ƒ","like_count":0},{"had_liked":false,"id":379017,"user_name":"Penguin Shi","can_delete":false,"product_type":"c1","uid":3646806,"ip_address":"å¹¿ä¸œ","ucode":"477A24D7ECE09A","user_header":"https://static001.geekbang.org/account/avatar/00/37/a5/56/b3cf71a9.jpg","comment_is_top":false,"comment_ctime":1691139389,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"ç”¨GPTç”Ÿæˆäº†ä¸€ä¸ªâ€œæ–‡æœ¬ç”Ÿæˆåº”ç”¨â€çš„ä»£ç ï¼Œæµ‹è¯•å¯ç”¨ï¼Œåˆ†äº«å¦‚ä¸‹ï¼š\nimport openai\nimport os\nimport gradio as gr\n\n# è®¾ç½®ä½ çš„APIå¯†é’¥\nopenai.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)\n\ndef generate_text(prefix: str, suffix: str) -&gt; str:\n    response = openai.Completion.create(\n        model=&quot;text-davinci-003&quot;,\n        prompt=prefix,\n        suffix=suffix,\n        max_tokens=1024,\n    )\n    return response[&quot;choices&quot;][0][&quot;text&quot;]\n\n# å®šä¹‰Gradioæ¥å£\niface = gr.Interface(\n    fn=generate_text,\n    inputs=[gr.inputs.Textbox(lines=10, label=&quot;Prefix&quot;), \n            gr.inputs.Textbox(lines=10, label=&quot;Suffix&quot;)],\n    outputs=gr.outputs.Textbox(),\n)\n\n# å¯åŠ¨Gradioæ¥å£\niface.launch()\n#ä»¥ä¸Šçš„ä»£ç å°†åœ¨ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£ä¸­å¯åŠ¨ä¸€ä¸ªWebåº”ç”¨ã€‚ä½ å¯ä»¥åœ¨&quot;Prefix&quot;å’Œ&quot;Suffix&quot;çš„è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡æœ¬ï¼Œç„¶åç‚¹å‡»&quot;Submit&quot;æŒ‰é’®æ¥ç”Ÿæˆæ–‡æœ¬ã€‚","like_count":0},{"had_liked":false,"id":379016,"user_name":"Penguin Shi","can_delete":false,"product_type":"c1","uid":3646806,"ip_address":"å¹¿ä¸œ","ucode":"477A24D7ECE09A","user_header":"https://static001.geekbang.org/account/avatar/00/37/a5/56/b3cf71a9.jpg","comment_is_top":false,"comment_ctime":1691139341,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"è®©GPTå¸®ç”Ÿæˆäº†ä¸€ä¸ªâ€œæ–‡æœ¬ç”Ÿæˆåº”ç”¨â€ï¼Œæµ‹è¯•å¯ç”¨ã€‚\nimport openai\nimport os\nimport gradio as gr\n\n# è®¾ç½®ä½ çš„APIå¯†é’¥\nopenai.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)\n\ndef generate_text(prefix: str, suffix: str) -&gt; str:\n    response = openai.Completion.create(\n        model=&quot;text-davinci-003&quot;,\n        prompt=prefix,\n        suffix=suffix,\n        max_tokens=1024,\n    )\n    return response[&quot;choices&quot;][0][&quot;text&quot;]\n\n# å®šä¹‰Gradioæ¥å£\niface = gr.Interface(\n    fn=generate_text,\n    inputs=[gr.inputs.Textbox(lines=10, label=&quot;Prefix&quot;), \n            gr.inputs.Textbox(lines=10, label=&quot;Suffix&quot;)],\n    outputs=gr.outputs.Textbox(),\n)\n\n# å¯åŠ¨Gradioæ¥å£\niface.launch()\n#ä»¥ä¸Šçš„ä»£ç å°†åœ¨ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£ä¸­å¯åŠ¨ä¸€ä¸ªWebåº”ç”¨ã€‚ä½ å¯ä»¥åœ¨&quot;Prefix&quot;å’Œ&quot;Suffix&quot;çš„è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡æœ¬ï¼Œç„¶åç‚¹å‡»&quot;Submit&quot;æŒ‰é’®æ¥ç”Ÿæˆæ–‡æœ¬ã€‚","like_count":0},{"had_liked":false,"id":379015,"user_name":"Penguin Shi","can_delete":false,"product_type":"c1","uid":3646806,"ip_address":"å¹¿ä¸œ","ucode":"477A24D7ECE09A","user_header":"https://static001.geekbang.org/account/avatar/00/37/a5/56/b3cf71a9.jpg","comment_is_top":false,"comment_ctime":1691139172,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"æˆ‘è®©GPTå¸®åŠ©ç”Ÿæˆäº†â€œä¸€ä¸ªæ–‡æœ¬æ”¹å†™çš„åº”ç”¨â€ï¼Œæµ‹è¯•äº†æ˜¯èƒ½ä½¿ç”¨çš„ã€‚ç°åœ¨è¿™ä¸ªæ—¶ä»£ï¼ŒçœŸæ˜¯ç»å¥½çš„æ—¶ä»£ã€‚\nimport openai\nimport os\nimport gradio as gr\n\n# è®¾ç½®ä½ çš„APIå¯†é’¥\nopenai.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)\n\ndef generate_text(prefix: str, suffix: str) -&gt; str:\n    response = openai.Completion.create(\n        model=&quot;text-davinci-003&quot;,\n        prompt=prefix,\n        suffix=suffix,\n        max_tokens=1024,\n    )\n    return response[&quot;choices&quot;][0][&quot;text&quot;]\n\n# å®šä¹‰Gradioæ¥å£\niface = gr.Interface(\n    fn=generate_text,\n    inputs=[gr.inputs.Textbox(lines=10, label=&quot;Prefix&quot;), \n            gr.inputs.Textbox(lines=10, label=&quot;Suffix&quot;)],\n    outputs=gr.outputs.Textbox(),\n)\n\n# å¯åŠ¨Gradioæ¥å£\niface.launch()\n#ä»¥ä¸Šçš„ä»£ç å°†åœ¨ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£ä¸­å¯åŠ¨ä¸€ä¸ªWebåº”ç”¨ã€‚ä½ å¯ä»¥åœ¨&quot;Prefix&quot;å’Œ&quot;Suffix&quot;çš„è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡æœ¬ï¼Œç„¶åç‚¹å‡»&quot;Submit&quot;æŒ‰é’®æ¥ç”Ÿæˆæ–‡æœ¬ã€‚","like_count":0},{"had_liked":false,"id":378441,"user_name":"å°ç†æƒ³ã€‚","can_delete":false,"product_type":"c1","uid":2238528,"ip_address":"åŒ—äº¬","ucode":"EDC35A907570DB","user_header":"https://static001.geekbang.org/account/avatar/00/22/28/40/82d748e6.jpg","comment_is_top":false,"comment_ctime":1690265848,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"prefix = &quot;&quot;&quot;åœ¨è¿™ä¸ªå¿«èŠ‚å¥çš„ç°ä»£ç¤¾ä¼šä¸­ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½é¢ä¸´ç€å„ç§å„æ ·çš„æŒ‘æˆ˜å’Œå›°éš¾ã€‚\nåœ¨è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ä¸­ï¼Œæœ‰äº›æ˜¯ç”±å¤–éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚ç»æµè§æ¡ã€å…¨çƒå˜æš–å’Œè‡ªç„¶ç¾å®³ç­‰ã€‚\\n&quot;&quot;&quot;\n# è¿˜æœ‰ä¸€äº›æ˜¯ç”±å†…éƒ¨å› ç´ å¼•èµ·çš„ï¼Œä¾‹å¦‚æƒ…æ„Ÿé—®é¢˜ã€å¥åº·é—®é¢˜å’Œè‡ªæˆ‘æ€€ç–‘ç­‰ã€‚\nsuffix = &quot;&quot;&quot;é¢å¯¹è¿™äº›æŒ‘æˆ˜å’Œå›°éš¾ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ç§¯æçš„æ€åº¦å’Œè¡ŒåŠ¨æ¥å…‹æœå®ƒä»¬ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å…·å¤‡åšéŸ§ä¸æ‹”çš„æ„å¿—å’Œåˆ›é€ æ€§æ€ç»´ï¼Œä»¥åŠå¯»æ±‚å¤–éƒ¨æ”¯æŒçš„èƒ½åŠ›ã€‚\nåªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½çœŸæ­£åœ°å®ç°è‡ªå·±çš„æ½œåŠ›å¹¶å–å¾—æˆåŠŸã€‚&quot;&quot;&quot;\n\nresponse = insert_text(prefix, suffix)\nprint(response[&quot;choices&quot;][0][&quot;text&quot;])\n\nè¿”å›ç»“æœå±…ç„¶æ˜¯å¯¹çš„ï¼Œæ²¡æœ‰åˆ†éš”ç¬¦çš„æƒ…å†µä¸‹è¿”å›çš„ä¹Ÿæ˜¯å¯¹çš„ï¼Œè¿”å›è¿™ä¸ªè€Œå…¶ä»–çš„åˆ™æ¥è‡ªæˆ‘ä»¬å†…éƒ¨çš„å› ç´ ï¼Œå¦‚å¿ƒç†é˜»ç¢ã€ç¼ºä¹ä¿¡å¿ƒå’Œä¿¡å¿µç­‰ã€‚\nè¦","like_count":0},{"had_liked":false,"id":371756,"user_name":"Ethan New","can_delete":false,"product_type":"c1","uid":2063962,"ip_address":"æµ™æ±Ÿ","ucode":"9CA2EF39E58030","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","comment_is_top":false,"comment_ctime":1680274471,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":4,"score":3,"product_id":100541001,"comment_content":"å­¦ä¹ æ‰“å¡ï¼ŒæœŸå¾…ä¸‹ä¸€éƒ¨åˆ†çš„å†…å®¹","like_count":0}]}