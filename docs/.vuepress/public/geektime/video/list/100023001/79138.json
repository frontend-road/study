{"id":79138,"title":"29 | 房价预测模型之创建与训练","content":"<h2>课件及源码下载地址：</h2><p><a href=\"https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/beginners\">https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/beginners</a></p>","comments":[{"had_liked":false,"id":63569,"user_name":"松涛","can_delete":false,"product_type":"c3","uid":1382495,"ip_address":"","ucode":"C69B1CDCE2735C","user_header":"https://static001.geekbang.org/account/avatar/00/15/18/5f/47e9d1c2.jpg","comment_is_top":false,"comment_ctime":1548403215,"is_pvip":false,"replies":[{"id":26666,"content":"对的:)","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1551848968,"ip_address":"","comment_id":63569,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"一个epoch表示：使用所有training data 训练一遍模型\nbatch：是因为随机梯度下降等原因才设置的，一个batch表示很小的已部分训练数据\none epoch = one forward pass and one backward pass of all the training examples\nbatch size = the number of training examples in one forward&#47;backward pass. The higher the batch size, the more memory space you&#39;ll need.\nnumber of iterations = number of passes, each pass using [batch size] number of examples. To be clear, one pass = one forward pass + one backward pass (we do not count the forward pass and backward pass as two different passes).","like_count":5,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437640,"discussion_content":"对的:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551848968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224307,"user_name":"大魔王","can_delete":false,"product_type":"c3","uid":1308552,"ip_address":"","ucode":"5EB049D18E122F","user_header":"https://static001.geekbang.org/account/avatar/00/13/f7/88/da243c77.jpg","comment_is_top":false,"comment_ctime":1591341685,"is_pvip":false,"replies":[{"id":83647,"content":"✔","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1592288811,"ip_address":"","comment_id":224307,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"👍,讲的很细","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497435,"discussion_content":"✔","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592288811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85945,"user_name":"ace","can_delete":false,"product_type":"c3","uid":1371287,"ip_address":"","ucode":"1DFD4A96505A2C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/oxEWlb3CAXfbSmYUcOKACdmRbKweyGIe3fmtMiccHlP7zFKBztI9zmnlewvl6ROPYPibwU8PV9G355tOVtMGBwkg/132","comment_is_top":false,"comment_ctime":1555297650,"is_pvip":false,"replies":[{"id":36121,"content":"对的，谢谢指正！","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1559540587,"ip_address":"","comment_id":85945,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"13:05 处，500 epochs 模型参数有误：\n\n0.8304*x1 + 8.239^{-4} x2 + 4.138^{-9}\n应修正为：\n0.8304*x1 + 8.239*10^{-4} x2 + 4.138*10^{-9}","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446876,"discussion_content":"对的，谢谢指正！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559540587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79004,"user_name":"深蓝","can_delete":false,"product_type":"c3","uid":1349621,"ip_address":"","ucode":"FB960A0C612996","user_header":"https://static001.geekbang.org/account/avatar/00/14/97/f5/e247de21.jpg","comment_is_top":false,"comment_ctime":1553317094,"is_pvip":false,"replies":[{"id":35436,"content":"是的，Opt 内部有个 apply_gradients 方法，会更新 weights。","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1559110951,"ip_address":"","comment_id":79004,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"老师，并没有看到代码中哪里有把w的值重新修改的地方，是梯度下降函数tf.train.GradientDescentOptimizer自动去做的吗？","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444322,"discussion_content":"是的，Opt 内部有个 apply_gradients 方法，会更新 weights。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559110951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78614,"user_name":"长脖子树","can_delete":false,"product_type":"c3","uid":1182802,"ip_address":"","ucode":"D9090EF67EEB1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","comment_is_top":false,"comment_ctime":1553183298,"is_pvip":true,"replies":[{"id":36072,"content":"之前有提到，只有 Session 中实际运行的 operator，才能从数据流图中获取到执行的数据。","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1559535226,"ip_address":"","comment_id":78614,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"最后输出结果那里应该  先进行sess.run(W)，否则无法输出W［1］","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444166,"discussion_content":"之前有提到，只有 Session 中实际运行的 operator，才能从数据流图中获取到执行的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559535226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72445,"user_name":"Ken","can_delete":false,"product_type":"c3","uid":1109228,"ip_address":"","ucode":"DE8E7AACEDEE76","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/ec/6ed1a360.jpg","comment_is_top":false,"comment_ctime":1551627908,"is_pvip":false,"replies":[{"id":26621,"content":"之前用的什么镜像呢？","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1551845850,"ip_address":"","comment_id":72445,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"&quot;我也是，把源码chapter-4导入到Jupyter，运行2-training-model.ipynb，结果训练出来的模型全是 Model: y = 0x1 + 0x2 + 0 ，是有什么问题吗？&quot;\n找到原因了，换了一个Docker镜像，“tensorflow&#47;tensorflow:latest-py3-jupyter&quot; 之后就正常了","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441592,"discussion_content":"之前用的什么镜像呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551845850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63645,"user_name":"姜昆","can_delete":false,"product_type":"c3","uid":1369770,"ip_address":"","ucode":"2B14C5503DFC63","user_header":"https://static001.geekbang.org/account/avatar/00/14/e6/aa/7c0fc559.jpg","comment_is_top":false,"comment_ctime":1548430138,"is_pvip":false,"replies":[{"id":36105,"content":"Up to u\nEpoch 表示数据集所有的 samples\nStep 表示一次前向和后向使用的 samples\nBatch 表示一个批次的数据包含的 samples\n","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1559539753,"ip_address":"","comment_id":63645,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"我问的是如果train example被分成512个minibatch，那么每个epoch(或这说每个step)是训练1个minibath还是512个minibatch，因为我看到网上有些代码两种情况都有，但是更倾向于每个epoch训练512个minibatch(也就是所有的train example)","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437669,"discussion_content":"Up to u\nEpoch 表示数据集所有的 samples\nStep 表示一次前向和后向使用的 samples\nBatch 表示一个批次的数据包含的 samples\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559539753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63544,"user_name":"姜昆","can_delete":false,"product_type":"c3","uid":1369770,"ip_address":"","ucode":"2B14C5503DFC63","user_header":"https://static001.geekbang.org/account/avatar/00/14/e6/aa/7c0fc559.jpg","comment_is_top":false,"comment_ctime":1548397452,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"老师，我问一下，你视频里面说的step和epoch的训练能不能再详细一点，涉及到batch数据训练事，是个怎么回事，有些代码里面将所有的的batchs训练完当成一个epoch，有些代码直接就把一个batch当成一个epoch，这样差别会很大吗","like_count":3},{"had_liked":false,"id":239912,"user_name":"cy","can_delete":false,"product_type":"c3","uid":2026044,"ip_address":"","ucode":"B244B60A11CB1B","user_header":"https://static001.geekbang.org/account/avatar/00/1e/ea/3c/36cc138a.jpg","comment_is_top":false,"comment_ctime":1596690894,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"第一圈计算损失值的时候就为 0 了，debug 看了下\n，loss_op = 1 &#47; (2 * len(X_data)) * tf.matmul((y_pred - y), (y_pred - y), transpose_a=True) 里，1 需要改成 1.0；","like_count":2},{"had_liked":false,"id":67929,"user_name":"Elvis","can_delete":false,"product_type":"c3","uid":1308724,"ip_address":"","ucode":"1FDE773C5AA43D","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/34/2ce5e546.jpg","comment_is_top":false,"comment_ctime":1550325394,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"老师，请问下我把你的源码chapter-4导入到Jupyter，运行2-training-model.ipynb，结果训练出来的模型全是 Model: y = 0x1 + 0x2 + 0， 感觉没有生效，请问可能是什么原因， 是否是因为我是用的容器，硬件设备不能进行训练呢","like_count":2,"discussions":[{"author":{"id":2026044,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/ea/3c/36cc138a.jpg","nickname":"cy","note":"","ucode":"B244B60A11CB1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296862,"discussion_content":"loss_op = 1 / (2 * len(X_data)) * tf.matmul((y_pred - y), (y_pred - y), transpose_a=True) 里，1 改成 1.0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596690188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383826,"user_name":"Geek_685e06","can_delete":false,"product_type":"c3","uid":3779899,"ip_address":"内蒙古","ucode":"5B5680BC8BCCD5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/190Bpss4s4ZYiazzm2GjeNzeJWrRTZmua0xolhLGYbVz0yM9y1ZNshQNicC3bwpW0UKm6kGkQnCC0JDAfNCCwRaA/132","comment_is_top":false,"comment_ctime":1699760384,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"目前从房产预测这块，你的代码都不可用了。更新一下版本。","like_count":0},{"had_liked":false,"id":231147,"user_name":"子曰","can_delete":false,"product_type":"c3","uid":1161256,"ip_address":"","ucode":"34127192DD8876","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/28/8c83d109.jpg","comment_is_top":false,"comment_ctime":1593593306,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"输出一直都是\nEpoch 10 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 20 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 30 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 40 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 50 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 60 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 70 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 80 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 90 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\nEpoch 100 \t Loss=0 \t Model: y = 0x1 + 0x2 + 0\n也不知道哪里出问题了","like_count":0},{"had_liked":false,"id":175161,"user_name":"Diserver","can_delete":false,"product_type":"c3","uid":1238856,"ip_address":"","ucode":"B2D853BB43ABB2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJw1XoOvKHBm6WM83XoFQwmVtsDtwFMSDvgq3ic1YKh2mXHFR7mQd8EkyfQX8NT4Kw8gWGBqHUmQwA/132","comment_is_top":false,"comment_ctime":1580577122,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"500轮公式：\ny = 0.8304*x1 + 0.0008239*x2 + 0.000000004138\n\n带入数据：\n2104,3,399900\n2300,4,449900\n2238,3,329900\n\n0.8304*2104 + 0.0008239*3 + 0.000000004138= 1747.164071704138\n0.8304*2300 + 0.0008239*4 + 0.000000004138= 1909.923295604138\n0.8304*2238 + 0.0008239*3 + 0.000000004138= 1858.437671704138\n请问是这样带入么？为什么算出的值和测试数据中价格有差距？","like_count":0},{"had_liked":false,"id":109973,"user_name":"Eric","can_delete":false,"product_type":"c3","uid":1050035,"ip_address":"","ucode":"0386D768CCB3DB","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/b3/1d23fbe7.jpg","comment_is_top":false,"comment_ctime":1562143701,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"我是在pycharm里面实现了这些代码，但是输出的值也全是y=0x1+0x2+0；loss也等于0；为什么呢？老师！","like_count":0},{"had_liked":false,"id":82696,"user_name":"zhaobk","can_delete":false,"product_type":"c3","uid":1291596,"ip_address":"","ucode":"30BEE12D2CF020","user_header":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","comment_is_top":false,"comment_ctime":1554278724,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"我没用Jupyter，直接自己搭的python3环境，安装了TensorFlow，可是用data1数据训练出来的，也是  \nEpoch 100 \t Loss = nan \t Model:y = nanxl + nanx2 + nan   是TensorFlow的版本问题吗？","like_count":0},{"had_liked":false,"id":72424,"user_name":"Ken","can_delete":false,"product_type":"c3","uid":1109228,"ip_address":"","ucode":"DE8E7AACEDEE76","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/ec/6ed1a360.jpg","comment_is_top":false,"comment_ctime":1551622810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"我也是，把源码chapter-4导入到Jupyter，运行2-training-model.ipynb，结果训练出来的模型全是 Model: y = 0x1 + 0x2 + 0 ，是有什么问题吗？","like_count":0}]}