{"id":1059,"title":"17 | 故障处理最佳实践：应对故障","content":"<p>你好，我是陈皓，网名左耳朵耗子。</p><p>或多或少我们都会经历线上的故障。在我的职业生涯中，就经历过很多的线上故障。老实说，线上故障是我们技术人员成长中必须要经历的事。从故障中我们可以吸取到很多教训，也能让我们学到很多书本上学不到的知识。坑踩多了，我们会变得越来越有经验，也就成为老司机了。</p><p>不过，我看到很多公司处理线上故障的方式并不科学，而且存在很多问题，所以，今天这节课就来分享一些我的经验。这些经验主要来自亚马逊和阿里这两家互联网公司，以及我个人的经验总结。希望这套方法能够对你有帮助。</p><h1>故障发生时</h1><p>在故障发生时，最重要的是快速恢复故障。而快速恢复故障的前提是快速定位故障源。因为在很多分布式系统中，一旦发生故障就会出现“多米诺骨牌效应”。也就是说，系统会随着一个故障开始一点一点地波及到其它系统，而且这个过程可能会很快。一旦很多系统都在报警，要想快速定位到故障源就不是一件简单的事了。</p><p>在亚马逊内部，每个开发团队至少都会有一位oncall的工程师。在oncall的时候，工程师要专心处理线上故障，轮换周期为每人一周。一旦发生比较大的故障，比如，S1全部不可用，或S2某功能不可用，而且找不到替代方案，那么这个故障就会被提交到一个工单系统里。几乎所有相关团队oncall的工程师都会被叫到线上处理问题。</p><!-- [[[read_end]]] --><p>工作流是这样的，工程师先线上签到，然后自查自己的服务，如果自己的服务没有问题，那么就可以在旁边待命（standby），以备在需要时进行配合。如果问题没有被及时解决，就会自动升级到高层，直到SVP级别。</p><p>大家都知道，在亚马逊，不是按技能分工，而是按职责分工，也就是一个团队不是按前端、后端、运维等来分工，而是按所负责的Service来分工。</p><p>所以，亚马逊的开发人员都是前端、后端、测试、运维全部都要干的。而亚马逊内部有很多的服务，一旦出现问题，为了避免一个工单在各个团队流转，需要所有团队上线处理，这样是最快的。</p><p>如果我们的系统架构是分布式服务化的，那么一个用户的请求可能会经过很多的服务，开发和运维起来是非常麻烦的。此时，跨团队跨部门的开发和运维就变得非常重要了。</p><p>就我的经历而言，在故障发生时，亚马逊的处理过程是比较有效和快速的，尤其是能够快速地定位故障源。对于被影响的其他团队也可以做一定的处理，比如做降级处理，这样可以控制故障的范围不被扩散。</p><p>故障源团队通常会有以下几种手段来恢复系统。</p><ul>\n<li>\n<p><strong>重启和限流</strong>。重启和限流主要解决的是可用性的问题，不是功能性的问题。重启还好说，但是限流这个事就需要相关的流控中间件了。</p>\n</li>\n<li>\n<p><strong>回滚操作</strong>。回滚操作一般来说是解决新代码的bug，把代码回滚到之前的版本是快速的方式。</p>\n</li>\n<li>\n<p><strong>降级操作</strong>。并不是所有的代码变更都是能够回滚的，如果无法回滚，就需要降级功能了。也就是说，需要挂一个停止服务的故障公告，主要是不要把事态扩大。</p>\n</li>\n<li>\n<p><strong>紧急更新</strong>。紧急更新是常用的手段，这个需要强大的自动化系统，尤其是自动化测试和自动化发布系统。假如你要紧急更新1000多台服务器，没有一个强大的自动化发布系统是很难做到的。</p>\n</li>\n</ul><p>也就是说，出现故障时，<strong>最重要的不是debug故障，而是尽可能地减少故障的影响范围，并尽可能快地修复问题</strong>。</p><p>国内的很多公司，都是由专职的运维团队来处理线上问题的。然而，运维团队通常只能处理一些基础设施方面的问题，或是非功能性的问题。对于一些功能性的问题，运维团队是完全没有能力处理的，只能通过相应的联系人，把相关的开发人员叫到线上来看。</p><p>而可能这个开发人员看到的是别的系统有问题，又会叫上其它团队的人来。所以，一级一级地传递下去，会浪费很多时间。</p><h1>故障前的准备工作</h1><p>为了能够在面临故障时做得有条不紊，我们需要做一些前期的准备工作。这些准备工作做得越细，故障处理起来也就越有条理。我们知道，故障来临时，一切都会变得混乱。此时，对于需要处理故障的我们来说，事可以乱，但人不能乱。如果人跟着事一起乱，那就是真正的混乱了。</p><p>所以，我们需要做一些故障前的准备工作。在这里，我给出一些我的经验。</p><ul>\n<li>\n<p><strong>以用户功能为索引的服务和资源的全视图</strong>。首先，我们需要一个系统来记录前端用户操作界面和后端服务，以及服务使用到的硬件资源之间的关联关系。这个系统有点像CMDB（配置管理数据库），但是比CMDB要大得多，是以用户端的功能来做索引的。然后，把后端的服务、服务的调用关系，以及服务使用到的资源都关联起来做成一个视图。</p>\n<p>这个视图最好是由相应的自动化监控系统生成。有了这个资源图后，我们就可以很容易地找到处理故障的路径了。<strong>这就好像一张地图，如果没有地图，我们只能像个无头苍蝇一样乱试了</strong>。</p>\n</li>\n<li>\n<p><strong>为地图中的各个服务制定关键指标，以及一套运维流程和工具，包括应急方案</strong>。以用户功能为索引，为每个用户功能的服务都制定一个服务故障的检测、处理和恢复手册，以及相关的检测、查错或是恢复的运维工具。对于基础层和一些通用的中间件，也需要有相应的最佳实践的方法。</p>\n<p>比如Redis，怎样检查其是否存在问题，怎样查看其健康和运行状态？哪些是关键指标，面对常见的故障应该怎么应对，服务不可用的服务方案是什么，服务需要回滚了应该怎么操作，等等。<strong>这就好像一个导航仪，能够告诉你怎么做。而没有导航仪，就没有章法，会导致混乱</strong>。</p>\n</li>\n<li>\n<p><strong>设定故障的等级</strong>。还要设定不同故障等级的处理方式。比如，亚马逊一般将故障分为4级：1级是全站不可用；2级是某功能不可用，且无替代方案；3级是某功能不可用，但有替代方案；4级是非功能性故障，或是用户不关心的故障。阿里内的分类更多样一些，有时会根据影响多少用户来定故障等级。</p>\n<p>制定故障等级，主要是为了确定该故障要牵扯进多大规模的人员来处理。故障级别越高，牵扯进来的人就越多，参与进来的管理层级别也就越高。就像亚马逊的全员上线oncall一样。<strong>这就好像是我们社会中常用的“红色警报”、“橙色警报”、“黄色警报”之类的，会触发不同的处理流程</strong>。</p>\n</li>\n<li>\n<p><strong>故障演练</strong>。故障是需要演练的。因为故障并不会时常发生，但我们又需要不断提升处理故障的能力，所以需要经常演练。一些大公司，如Netflix，会有一个叫Chaos Monkey的东西，随机地在生产线上乱来。Facebook也会有一些故障演习，比如，随机关掉线上的一些服务器。总之，要提升故障处理水平，最好的方式就是实践。见得多了，处理得多了，才能驾轻就熟。<strong>故障演练是一个非常好的实践</strong>。</p>\n</li>\n<li>\n<p><strong>灰度发布系统</strong>。要减少线上故障的影响范围，通过灰度发布系统来发布是一个很不错的方式。毕竟，我们在测试环境中很难模拟出线上环境的所有情况，所以，在生产线上进行灰度发布或是A/B测试是一件很好的事。</p>\n</li>\n</ul><p>在亚马逊，发布系统中有一个叫Weblab的系统，就是用来做灰度发布的。另外，亚马逊全球会有多个站点。一般来说，会先发中国区。如果中国区没什么问题了，就发日本区，然后发欧洲区，最后是美国区。而如果没有很多站点的话，那么你就需要一个流量分配系统来做这个事了。</p><p>好了。今天就分享这么多。我觉得，只要能做好上面的几点，你处理起故障来就一定会比较游刃有余了。</p><p>在这节课的末尾，我想发个邀请给你。请你来聊聊，你所经历过的线上故障，以及有哪些比较好的故障处理方法。</p>","comments":[{"had_liked":false,"id":1204,"user_name":"左耳朵","can_delete":false,"product_type":"c1","uid":1001269,"ip_address":"","ucode":"8A4741D677702E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","comment_is_top":true,"comment_ctime":1512465019,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"9.2233724850438001e+18","product_id":100002201,"comment_content":"自动地图生成一般用APM式的系统。开源的可以看看zipkin","like_count":105,"discussions":[{"author":{"id":2046976,"avatar":"","nickname":"Geek_46143c","note":"","ucode":"D0A458771AFC08","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319747,"discussion_content":"开源skywalking 国人做的Apache的顶级项目，特点无侵入\n还有pinpont ，韩国人开发的","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1604111415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1566027,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e5/4b/2063d200.jpg","nickname":"朱开番","note":"","ucode":"0F87DD224B6C8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325613,"discussion_content":"apm生成的是所有请求，一个功能含有多个请求，所以是不同的纬度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605363502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1120761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/19/f9/62ae32d7.jpg","nickname":"Ken","note":"","ucode":"9F829156E855C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251043,"discussion_content":"APM的自动生成的地图大概率不可看，尤其是在微服务架构上生成的，图的元素复杂程度会让人分不清请求关系。皓哥有什么建议吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588059540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":1118,"user_name":"kimi","can_delete":false,"product_type":"c1","uid":1014643,"ip_address":"","ucode":"4DBCA231850D6A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/73/e5b46aa9.jpg","comment_is_top":false,"comment_ctime":1512193120,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"641462320224","product_id":100002201,"comment_content":"2013 年，应该是 8 月吧，和耗子哥一起处理巨石塔上千台服务器宕机的故障，搞到凌晨三四点","like_count":150,"discussions":[{"author":{"id":1121111,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1b/57/150c9b10.jpg","nickname":"柏元刚","note":"","ucode":"A88968932063CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54001,"discussion_content":"聚石塔","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574249449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":980,"user_name":"ibrothergang","can_delete":false,"product_type":"c1","uid":1002191,"ip_address":"","ucode":"4151DA353A1DDC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/cf/5cbccd62.jpg","comment_is_top":false,"comment_ctime":1511829964,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"224850129356","product_id":100002201,"comment_content":"“请你来聊聊，你所经历过的线上故障，以及有哪些比较好的故障处理方法。”<br><br>我是一名移动端开发的工程师。移动端的开发工作和前端(线上环境)开发还是有一点区别的。移动端的开发一般在上线前会做测试，严重的问题一般在测试过程就解决了，很少情况发版后出现大面积的奔溃情况。但是线上环境不一样，线上环境发版的周期会大大短于客户端，很多的活动都会频繁的上线和下线。影响的范围也大于移动端。<br><br>遇到过最严重的一次事故是由于服务端的修改引起了移动端的奔溃。而且这个奔溃发生在 app 启动的时候。也就是说用户点了应用图标，起来马上就又闪退了。当时的 app 设计是起来后会去请求服务端的相关配置信息，相信很多的 app 也是这么做的。造成这个故障的原因是由于 app 对异常的处理不够完备，服务器端又恰巧修改了配置数据，导致 app 端拿到了一个引起奔溃的数据结果。后来因为是上班时间，发现问题后大家都在，及时恢复了服务端数据，遏制了事态的进一步发展，但是已经出现奔溃的用户由于在重新请求服务端数据前就奔溃了，只能通过发布新版本解决这个问题。<br><br>一旦服务端和移动端相互影响(往往是服务端影响移动端)引起的奔溃，往往是比较严重的，很多时候不得不通过发布新版本才能解决问题。所以移动端一定要做好服务端的异常处理。","like_count":53,"discussions":[{"author":{"id":1112212,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/94/33684620.jpg","nickname":"libli","note":"","ucode":"1840E906171B83","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240794,"discussion_content":"app缓存了脏数据这个问题很常见，有个处理办法可以参考下，app连续crash三次时，启动app时清除所有缓存数据。","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1587388284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030759,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ba/67/c764be06.jpg","nickname":"🐾mc🐾","note":"","ucode":"CE47F9316D6E14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6745,"discussion_content":"一般来说，会先发中国区。如果中国区没什么问题了，就发日本区，然后发欧洲区，最后是美国区。而如果没有很多站点的话，那么你就需要一个流量分配系统来做这个事了。 这句亮了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1567079526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1273306,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epXxiaZoxYCUM6ppy3SpQmeEL3JqicRhLI9NhMsibBAQRHoNWibJwvCZ8DfQKlfJxUYe8pP44ufiaSqUtg/132","nickname":"Gavin","note":"","ucode":"B8F5B500DFA829","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348868,"discussion_content":"一句话，代码写的真不健壮，","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612756144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1830971,"avatar":"","nickname":"Yuge","note":"","ucode":"E31DF51CD7BEA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339992,"discussion_content":"崩(beng)溃~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609856823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":2511,"user_name":"金胖子","can_delete":false,"product_type":"c1","uid":1045261,"ip_address":"","ucode":"132386ECB4D407","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/0d/6caad172.jpg","comment_is_top":false,"comment_ctime":1517532052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"194791060372","product_id":100002201,"comment_content":"最典型的一次，项目组成员在测试版本中加了sleep来debug，结果上线的时候就把版本发布到生产，直接影响我第二天下午没能去看变形金刚","like_count":46},{"had_liked":false,"id":16730,"user_name":"paul.yang","can_delete":false,"product_type":"c1","uid":1157036,"ip_address":"","ucode":"FCF6F08C191525","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eptCuRBA5qaBLSeWiadmRtibDATwbTCGbaedich6E4krkBr52YDc8RtCibz8Dz69txWJlLhG3IYozpcJg/132","comment_is_top":false,"comment_ctime":1532139753,"is_pvip":false,"replies":[{"id":"5826","content":"微博回了","user_name":"作者回复","user_name_real":"左耳朵","uid":"1001269","ctime":1532177280,"ip_address":"","comment_id":16730,"utype":1}],"discussion_count":1,"race_medal":0,"score":"78841551081","product_id":100002201,"comment_content":"耗子叔，我是个自学转行做后端的程序员。最近在日活快接近2亿的一个后端团队里面犯了个错误导致某一个功能20分钟不可用，受到了打击，我微博给你留了言，希望能跟你交流下，寻求指导帮助。希望你能看到我的微博留言，呵呵的卫国杨","like_count":19,"discussions":[{"author":{"id":1001269,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/35/89726f5f.jpg","nickname":"左耳朵","note":"","ucode":"8A4741D677702E","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420912,"discussion_content":"微博回了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532177280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192546,"user_name":"艺漫漫","can_delete":false,"product_type":"c1","uid":1055491,"ip_address":"","ucode":"F66FA55D6BA5B3","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/03/4d5c017f.jpg","comment_is_top":false,"comment_ctime":1584859187,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74599303219","product_id":100002201,"comment_content":"每次线上故障处理都是知识体系验证和应用的战场。<br><br>2020-03-20&#47;21这两天处理了2个p1级别的问题，一个问题导致几乎所有竞价服务宕机了，这个问题是因为redis内存使用达到机器的限制上限被杀了，导致使用该redis的server重启异常，立即处理操作是rm rdb后重启redis，后续预防措施是增加redis内存和cpu使用监控。另一个问题是所有订单竞价异常，查了很久，定位到直接原因是预算同步机制变慢导致订单因为预算问题不竞价，根本原因是大数据包导致网络延时，进而导致预算同步变慢。查找2问题的过程很值得记录：根据其他服务处理时间监控，发现其他非竞价模块处理时间也严重变慢，进而使用iftop观察网络吞吐，发现有一个server1的入口带宽异常，而server1上的服务处理时间正常，最后根据这台server1上redis的cpu使用率和slowlog找到一条高达13M的异常数据。<br>","like_count":18},{"had_liked":false,"id":13710,"user_name":"郭新鹏","can_delete":false,"product_type":"c1","uid":1154281,"ip_address":"","ucode":"F9D76691B335FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/e9/5ba8b1a3.jpg","comment_is_top":false,"comment_ctime":1529941880,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"48774582136","product_id":100002201,"comment_content":"代码逻辑错误，导致查看分享的人能看到分享者所有信息，记录的上一个人的cookie.<br><br>Session存储在redis,  flush db。所有用户重新登陆","like_count":11,"discussions":[{"author":{"id":1218937,"avatar":"https://static001.geekbang.org/account/avatar/00/12/99/79/74d4f24f.jpg","nickname":"anker","note":"","ucode":"6EDF1FB9D45238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267246,"discussion_content":"2这种情况在于过度依赖redis，高可用的登录授权服务会有一个高容错率的登录信息持久化的过程作为服务兜底，或者直接使用jwt","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589619767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":8158,"user_name":"liin","can_delete":false,"product_type":"c1","uid":1038705,"ip_address":"","ucode":"92AE8958DDED4E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d9/71/8e38dc01.jpg","comment_is_top":false,"comment_ctime":1525930135,"is_pvip":true,"discussion_count":2,"race_medal":1,"score":"48770570391","product_id":100002201,"comment_content":"楼上的，类似工具:鹰眼，watchMan,京东的CallGraph","like_count":11,"discussions":[{"author":{"id":1119907,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/a3/03ac92d0.jpg","nickname":"Geek_0dc445","note":"","ucode":"FE747E43F0098F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55294,"discussion_content":"开源pinpoint skywalking zpkin 其它就是鹰眼等闭源产品","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574348729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1042793,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/e9/69/779b48c2.jpg","nickname":"苏忆","note":"","ucode":"B8BE78280CCB99","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3921,"discussion_content":"看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564982598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15207,"user_name":"晏","can_delete":false,"product_type":"c1","uid":1110078,"ip_address":"","ucode":"F6F601BFA9442C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/3e/ea2c1d43.jpg","comment_is_top":false,"comment_ctime":1531010235,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31595781307","product_id":100002201,"comment_content":"出现故障时，最重要的不是 debug 故障，而是尽可能地减少故障的影响范围，并尽可能快地修复问题。","like_count":7},{"had_liked":false,"id":286324,"user_name":"凉人。","can_delete":false,"product_type":"c1","uid":1659177,"ip_address":"","ucode":"4DB16004A62015","user_header":"https://static001.geekbang.org/account/avatar/00/19/51/29/24739c58.jpg","comment_is_top":false,"comment_ctime":1617256409,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23092092889","product_id":100002201,"comment_content":"在bd实习的时候，有个很小的独立项目<br>项目中使用到容器和分布式文件系统，有种情况，当容器心跳检测时，如果检测失败，容器实例将产生漂移，漂移的过程会删除原容器的数据，所以产生一个情况，就是分布式文件系统里的数据都被删除。<br>导师和leader们快速定位了问题，数据也在是采用move的方式删除，很庆幸数据恢复了。也知道了一个项目的伟大是由一群有预见性的大佬们，和一堆可靠的同事们一起完成的。","like_count":6},{"had_liked":false,"id":210584,"user_name":"Geek_7b1383","can_delete":false,"product_type":"c1","uid":1310716,"ip_address":"","ucode":"A2F03709F77122","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLndPicaib35sSOgGib8iafFBq8B0hoBO3Bfp3QViblYQ669lRFjPD1RSX2rDibmElID00l5oWokhuZBJnw/132","comment_is_top":false,"comment_ctime":1587791955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23062628435","product_id":100002201,"comment_content":"故障源团队恢复系统：<br>重启和限流---可用性的问题，不是功能性的问题。<br>回滚操作---解决新代码的 bug<br>降级操作---挂一个停止服务的故障公告，主要是不要把事态扩大。<br>紧急更新---尤其需要强大的自动化测试和自动化发布系统<br>故障前的准备工作:<br>以用户功能为索引的服务和资源的全视图。<br>在地图中设置关键指标，以及运维流程和方案。<br>设定故障等级。<br>故障演练。<br>灰度系统<br><br>降级操作，除了皓哥这种，是否有一种业务配合降级譬如风险降级，通过开关避开相关校验，通过补偿措施解决线上故障","like_count":5},{"had_liked":false,"id":1103,"user_name":"林子","can_delete":false,"product_type":"c1","uid":1023794,"ip_address":"","ucode":"EA8C33A6BFD834","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/32/277b55a9.jpg","comment_is_top":false,"comment_ctime":1512129278,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18691998462","product_id":100002201,"comment_content":"自动生成地图那是有什么工具推荐的吗？同问耗子哥","like_count":4,"discussions":[{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"凯文小猪","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375581,"discussion_content":"现代的apm工具都可以 比如skywalking zipkin","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621753988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":1059,"user_name":"小桥流水","can_delete":false,"product_type":"c1","uid":1011273,"ip_address":"","ucode":"C1582AE2FB5299","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6e/49/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1512055498,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"18691924682","product_id":100002201,"comment_content":"自动生成地图那是有什么工具推荐的吗？","like_count":4,"discussions":[{"author":{"id":1609530,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/l4nngwyggBGqeMXC0micwO8bM1hSttgQXa1Y5frJSqWa8NibDhia5icwPcHM5wOpV3hfsf0UicDY0ypFqnQ3iarG0T1w/132","nickname":"Trident","note":"","ucode":"53E6788CF33398","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34232,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571186330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98436,"user_name":"edisonhuang","can_delete":false,"product_type":"c1","uid":1530167,"ip_address":"","ucode":"BB2F639A779F96","user_header":"https://static001.geekbang.org/account/avatar/00/17/59/37/bd2de0a4.jpg","comment_is_top":false,"comment_ctime":1559004432,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14443906320","product_id":100002201,"comment_content":"故障应对方法，分别包括故障发生时的恢复措施，自己故障发生前可做的准备。<br>故障发生时最重要的是限制故障影响的范围，尽最大可能保障服务的可用性，包括转发和限流，回滚，降级，服务重启，紧急更新，紧急发布等。<br>故障发生前应做好防范，需要以用户功能为索引建立全站服务和资源的地图，利用地图为各个服务生成关键性指标，并建立一套自动化运维的方案和工具。为故障设立等级，知道故障时我在哪，严重程度，进行必要的故障演练，做灰度发布等","like_count":3},{"had_liked":false,"id":93305,"user_name":"西北偏北","can_delete":false,"product_type":"c1","uid":1043160,"ip_address":"","ucode":"64BD69C84EE6A1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdpKbFgRLnicjsr6qkrPVKZcFrG3aS2V51HhjFP6Mh2CYcjWric9ud1Qiclo8A49ia3eZ1NhibDib0AOCg/132","comment_is_top":false,"comment_ctime":1557451371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14442353259","product_id":100002201,"comment_content":"凡事预则立，故障诊断和处理不是依赖人员的瞎猜，盲查，而是要在故障前就想好对应的预案，基础系统的研发支持，日志埋点等等。毕竟线上不方便像本地一样debug","like_count":3},{"had_liked":false,"id":15208,"user_name":"晏","can_delete":false,"product_type":"c1","uid":1110078,"ip_address":"","ucode":"F6F601BFA9442C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/3e/ea2c1d43.jpg","comment_is_top":false,"comment_ctime":1531010492,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14415912380","product_id":100002201,"comment_content":"故障前的准备工作:<br>以用户功能为索引的服务和资源的全视图。<br>在地图中设置关键指标，以及运维流程和方案。<br>设定故障等级。<br>故障演练。<br>","like_count":3},{"had_liked":false,"id":977,"user_name":"小沫","can_delete":false,"product_type":"c1","uid":1000977,"ip_address":"","ucode":"52341656210E0D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/11/1cf8c174.jpg","comment_is_top":false,"comment_ctime":1511825464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14396727352","product_id":100002201,"comment_content":"之前有一次线上系统出现故障，导致工单无法处理。原因是北向接口服务出现故障，定位起来不太方便。因为接口为集群部署（使用F5）当时没有好的运维工具，只能模拟请求接口，经过一轮验证后才发现接口故障点。想问下耗子叔，对于你文章中说的自动生成地图那是有什么工具推荐的吗？","like_count":3},{"had_liked":false,"id":265572,"user_name":"枫笑天涯","can_delete":false,"product_type":"c1","uid":1444990,"ip_address":"","ucode":"792377D8C58476","user_header":"https://static001.geekbang.org/account/avatar/00/16/0c/7e/64ebc2c6.jpg","comment_is_top":false,"comment_ctime":1606955746,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5901923042","product_id":100002201,"comment_content":"添加apm系统时也要注意，这种系统的漏洞和bug也可能导致生产服务不可用","like_count":1},{"had_liked":false,"id":193671,"user_name":"秦穆之","can_delete":false,"product_type":"c1","uid":1489177,"ip_address":"","ucode":"709C49BFCBB776","user_header":"https://static001.geekbang.org/account/avatar/00/16/b9/19/f4ef2c9a.jpg","comment_is_top":false,"comment_ctime":1584946502,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879913798","product_id":100002201,"comment_content":"根据过往的经验来看，首先进行在服务稳定版本上的性能压测和全链路压测，掌握服务本身以及上下游的性能瓶颈和各项指标的情况。其次，针对故障类型预备各种预案，包括但不限于（定位问题，扩容，上下线，主备切换，数据源切换，数据预热等）一定要具体到操作流程。预案可以不复杂，但是一定要有效。然后就是故障演习，多模拟一些场景，熟练一下操作，规范一下流程，完善一下预案。最后，临阵时，要冷静，要对服务的各项指标了然于胸。指标出现异常，要及时处理，不能等到出了问题才开始修补。","like_count":1},{"had_liked":false,"id":190885,"user_name":"oci","can_delete":false,"product_type":"c1","uid":1200077,"ip_address":"","ucode":"091547A9B22E19","user_header":"","comment_is_top":false,"comment_ctime":1584705111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879672407","product_id":100002201,"comment_content":"听老师分享，就是一种享受","like_count":1},{"had_liked":false,"id":72205,"user_name":"KaitoShy","can_delete":false,"product_type":"c1","uid":1038415,"ip_address":"","ucode":"E2E2E9BD3F5048","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/4f/65abc6f0.jpg","comment_is_top":false,"comment_ctime":1551534203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846501499","product_id":100002201,"comment_content":"遇到的故障还是蛮多的，由于网站是PHP在请求过密的时候，出现502","like_count":1},{"had_liked":false,"id":68687,"user_name":"Eleven","can_delete":false,"product_type":"c1","uid":1168452,"ip_address":"","ucode":"FB4A0C8CA732BE","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/44/0ec958f4.jpg","comment_is_top":false,"comment_ctime":1550572565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5845539861","product_id":100002201,"comment_content":"故障发生时，我们公司一般按照顺序：重启和限流、紧急更新、版本回退、服务降级.","like_count":1},{"had_liked":false,"id":38740,"user_name":"Geek_fb3db2","can_delete":false,"product_type":"c1","uid":1218254,"ip_address":"","ucode":"8089B8311B6C80","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/ce/8c3bdbe5.jpg","comment_is_top":false,"comment_ctime":1542118338,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5837085634","product_id":100002201,"comment_content":"咨询下耗子叔 文章提到的降级限流有没有有什么成熟的解决方案 目前项目中领导提到了 但是不知道如何做","like_count":1},{"had_liked":false,"id":23830,"user_name":"永立","can_delete":false,"product_type":"c1","uid":1174935,"ip_address":"","ucode":"9FEABE66F490FA","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/97/0356ef1e.jpg","comment_is_top":false,"comment_ctime":1536676757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5831644053","product_id":100002201,"comment_content":"技术不太够，这章很多内容看的不是很懂。","like_count":1},{"had_liked":false,"id":16781,"user_name":"山哥","can_delete":false,"product_type":"c1","uid":1172679,"ip_address":"","ucode":"7C8585B021CAC4","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/c7/7f8be879.jpg","comment_is_top":false,"comment_ctime":1532181436,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5827148732","product_id":100002201,"comment_content":"大佬，CMDB的服务视图能发出来看下？","like_count":1},{"had_liked":false,"id":12957,"user_name":"KingPoker","can_delete":false,"product_type":"c1","uid":1050751,"ip_address":"","ucode":"1BEF76F900EC0A","user_header":"https://static001.geekbang.org/account/avatar/00/10/08/7f/a0b0ac74.jpg","comment_is_top":false,"comment_ctime":1529206477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5824173773","product_id":100002201,"comment_content":"去年生产遇到不少问题，处理了几次，越来越有思路。<br>文章提到的各种工程化的管理，还需要很长的路","like_count":1},{"had_liked":false,"id":8051,"user_name":"yun","can_delete":false,"product_type":"c1","uid":1054906,"ip_address":"","ucode":"3727BF0E566A76","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ba/fb86482f.jpg","comment_is_top":false,"comment_ctime":1525878388,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5820845684","product_id":100002201,"comment_content":"最关键的定位故障原因，怎么没有说呢？<br>我通过监控能定位具体出问题的服务，可是服务出问题的原因如果没有定位出来的话，是不大能知道如何恢复系统的吧？","like_count":1},{"had_liked":false,"id":349391,"user_name":"killer","can_delete":false,"product_type":"c1","uid":1141036,"ip_address":"","ucode":"22BF63C05CFACE","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/2c/046c7265.jpg","comment_is_top":false,"comment_ctime":1655944313,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655944313","product_id":100002201,"comment_content":"前端监控一般怎么搞？","like_count":0},{"had_liked":false,"id":340369,"user_name":"怀揣梦想的学渣","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1648781781,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648781781","product_id":100002201,"comment_content":"我经历的线上故障大多是客户在云主机内的业务异常，需要帮客户排查是否是云平台出现异常。大概率是客户内部软件出现变更导致。客户侧的业务开发大概率标准甩锅三连（肯定是云平台故障了。我啥都没做就这样了。肯定是别人做的。）。这种扯皮让人心累。<br>后来我就想到定期统计云平台主要参数的变化，定时监测云平台组件可用性，输出汇总数据提供给报异常的客户，同时协助客户排查其业务系统的异常。除非真遇到重大平台组件故障，基本无异常。客户业务系统故障也能快速定位。<br>在领导统一规划下，这种工作方式中断，变为非云平台内部告警不参与处理。<br>受限于内部管理策略，有时个人除了离职，找不到内部技术拓展的机会点。","like_count":0},{"had_liked":false,"id":315954,"user_name":"方勇(gopher)","can_delete":false,"product_type":"c1","uid":1290625,"ip_address":"","ucode":"D199911C4CFEF5","user_header":"https://static001.geekbang.org/account/avatar/00/13/b1/81/13f23d1e.jpg","comment_is_top":false,"comment_ctime":1634086547,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634086547","product_id":100002201,"comment_content":"目前在做微服务治理云平台，涉及发布，熔断限流，故障演练相关！在尝试混沌工程！目前遇到的难题是告警收敛","like_count":0},{"had_liked":false,"id":313079,"user_name":"ladba","can_delete":false,"product_type":"c1","uid":1232522,"ip_address":"","ucode":"78ADCE66B403A4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/K8uoNDBqLNQicA8KOecJIb6DWrt7YJuy99VsVpAqPZia2SzSGyECAaPhFU5td1cO9wqjWIqLWIzfxd5DqmUXTKibw/132","comment_is_top":false,"comment_ctime":1632272159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632272159","product_id":100002201,"comment_content":"昨天中秋节，晚上11点运维打电话过来说线上有个topic的2个分区堆积严重。远程会议分析，该topic消费端微服务，在2个月前上线了一个功能，该功能在某个原有功能的基础上增加了一个检验，该检验会去用户数据源地区请求用户数据。该问题的原因是中国区只打通了中国区的专有网络，中国区与海外的并不通，而该用户是亚非拉用户，网络不通，异常直接抛出，消息not commit，故出现消息堆积。这种问题第一时间考虑规避，线上数据库插入数据，绕过该检验，然后出补丁版本解决。","like_count":0},{"had_liked":false,"id":282983,"user_name":"Geek_fbfc4f","can_delete":false,"product_type":"c1","uid":2446418,"ip_address":"","ucode":"7010B242A3F474","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/zdK3dSkFwicZHtx5CLAKFJRORRibq2YqvHOP0tySLxVx0X1oD9AJanan2wia2hHaswgxdrCzEEGyVgFTVZ8sElTzQ/132","comment_is_top":false,"comment_ctime":1615510209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615510209","product_id":100002201,"comment_content":"故障准备工作大部分中小公司能做到第二个就不错了。","like_count":0},{"had_liked":false,"id":272635,"user_name":"akka","can_delete":false,"product_type":"c1","uid":1178108,"ip_address":"","ucode":"71271D17D9695C","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/fc/f01e160f.jpg","comment_is_top":false,"comment_ctime":1610181465,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610181465","product_id":100002201,"comment_content":"1.对于关联应用都会有监控，发现应用状态不正常就触发报警，相关负责人员确定原因；<br>2.如果能够快速定位且可快速修复的，在相关故障群同步原因及处理方案，这个过程可以是多个相关人一起；如果确认是故障且短时间内不可修复或问题未定位，则首先在故障群同步问题，定期同步进度；对应用进行限流、降级或拒绝服务；<br>3.相关人员从多个纬度进行排查，优先通过告警工具提供的信息进行确定故障应用；其次通过日志，一般能看出问题；之后依次是内存，cpu，磁盘等信息，最后没办法要亮出dump工具进行更为细致的排查；","like_count":0},{"had_liked":false,"id":231782,"user_name":"梅端","can_delete":false,"product_type":"c1","uid":1525335,"ip_address":"","ucode":"FEC08731457770","user_header":"https://static001.geekbang.org/account/avatar/00/17/46/57/fe38a6db.jpg","comment_is_top":false,"comment_ctime":1593769013,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593769013","product_id":100002201,"comment_content":"处理故障的流程很重要，运维能做的事却很有限，我经常戏称:运维的天花板就是重启。","like_count":0,"discussions":[{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306870,"discussion_content":"你这运维的几台机器吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600406429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225807,"user_name":"阿斯蒂芬","can_delete":false,"product_type":"c1","uid":1024164,"ip_address":"","ucode":"61D5E3BDA4EBC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","comment_is_top":false,"comment_ctime":1591864249,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591864249","product_id":100002201,"comment_content":"曾经线上的MongoDB集群间歇性挂掉节点，急于恢复重启过几次，后来排查得知是从节点部署到同一个物理机上导致该物理机压力过大，，说到底就是拓扑结构有问题。那时候也没什么可视化监控，真是原始，都靠人工一步步查。其实一些健康检查的指标，即使没有开箱即用的集成产品，自己做一些也是可以的，归根结底还是对故障不够重视。至于文档，手册类的，大家都知道它是好东西，但很多时候大家都不愿意去写或者写了就不维护了，也是个难题。","like_count":0},{"had_liked":false,"id":212171,"user_name":"simonren","can_delete":false,"product_type":"c1","uid":1974906,"ip_address":"","ucode":"DFB59C705310C2","user_header":"","comment_is_top":false,"comment_ctime":1588070606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588070606","product_id":100002201,"comment_content":"最重要的不是 debug 故障，而是尽可能地减少故障的影响范围，并尽可能快地修复问题","like_count":0},{"had_liked":false,"id":212112,"user_name":"ɴɪᴋᴇʀ","can_delete":false,"product_type":"c1","uid":1616622,"ip_address":"","ucode":"DB7D92CBB5FD15","user_header":"https://static001.geekbang.org/account/avatar/00/18/aa/ee/15c328ca.jpg","comment_is_top":false,"comment_ctime":1588061387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588061387","product_id":100002201,"comment_content":"故障应对方法，分别包括故障发生时的恢复措施，自己故障发生前可做的准备。<br>故障发生时最重要的是限制故障影响的范围，尽最大可能保障服务的可用性，包括转发和限流，回滚，降级，服务重启，紧急更新，紧急发布等。<br>故障发生前应做好防范，需要以用户功能为索引建立全站服务和资源的地图，利用地图为各个服务生成关键性指标，并建立一套自动化运维的方案和工具。为故障设立等级，知道故障时我在哪，严重程度，进行必要的故障演练，做灰度发布等<br>","like_count":0},{"had_liked":false,"id":211290,"user_name":"lubiaook","can_delete":false,"product_type":"c1","uid":1368040,"ip_address":"","ucode":"C59CD6E7DAD729","user_header":"https://static001.geekbang.org/account/avatar/00/14/df/e8/359adede.jpg","comment_is_top":false,"comment_ctime":1587946411,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587946411","product_id":100002201,"comment_content":"上线前先准备一个上线list  一步一步操作  如果出问题无法解决就直接回滚到上一个版本","like_count":0},{"had_liked":false,"id":210910,"user_name":"Nothing","can_delete":false,"product_type":"c1","uid":1963769,"ip_address":"","ucode":"4965CFE43ADA62","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f6/f9/0cfd3016.jpg","comment_is_top":false,"comment_ctime":1587864351,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587864351","product_id":100002201,"comment_content":"重启能解决80的问题，说到底还是有些计算机底层太模糊","like_count":0},{"had_liked":false,"id":210464,"user_name":"Geek_130e9e","can_delete":false,"product_type":"c1","uid":1587628,"ip_address":"","ucode":"518AAF2F228C17","user_header":"","comment_is_top":false,"comment_ctime":1587755830,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587755830","product_id":100002201,"comment_content":"最宝贵的财富并不是钱，而是你的时间，时间比钱更宝贵，因为钱你不用还在那里，而时间你不用就浪费掉了。你把你的时间投资在哪些地方，就意味着你未来会走什么样的路。所以，利用好你的时间，投到一些有意义的地方吧","like_count":0},{"had_liked":false,"id":209683,"user_name":"style_月月","can_delete":false,"product_type":"c1","uid":1329116,"ip_address":"","ucode":"59489E1BDB0090","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/BJjGmy4ooNjeURBDhVeJ7EslNbyVd6jNricALVsx1QriczD2EXddKLkXxLQK02nExosCJdyfvicVcZwfpDk64iazmQ/132","comment_is_top":false,"comment_ctime":1587600837,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587600837","product_id":100002201,"comment_content":"App上线都会走回归测试，解决应用上线前的大部分问题，但是上线后，由于系统版本及用户操作的不可控，会导致一些非常奇葩的问题，针对这个有采取一些措施：例如加入线上崩溃日志收集等，但是仍然还是会有不好定位的问题，耗子叔，针对这种不可控的问题，一般是如何处理的呢？","like_count":0},{"had_liked":false,"id":208579,"user_name":"墨华","can_delete":false,"product_type":"c1","uid":1910208,"ip_address":"","ucode":"588C72545ED549","user_header":"https://static001.geekbang.org/account/avatar/00/1d/25/c0/afacbf22.jpg","comment_is_top":false,"comment_ctime":1587386588,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1587386588","product_id":100002201,"comment_content":"大多数故障都是代码引起，看日志，如果严重就用备用系统","like_count":0},{"had_liked":false,"id":202023,"user_name":"刘三通","can_delete":false,"product_type":"c1","uid":1201414,"ip_address":"","ucode":"A89C586FC1EE3E","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/06/a495741c.jpg","comment_is_top":false,"comment_ctime":1585888707,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585888707","product_id":100002201,"comment_content":"JAVA工程 使用lucene ，非法内存访问导致jvm crush掉，weblogic自动重启，由于quartz框架中不允许配置过期的cron表达式，服务自动重启失败","like_count":0},{"had_liked":false,"id":201292,"user_name":"Geek_07e215","can_delete":false,"product_type":"c1","uid":1854881,"ip_address":"","ucode":"5B055794ED7109","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLU7AAZsf7SNjzITysl1E8Gg5DebwzSWOkhKdq6ZSgheScSawkcFyfvibpIzttEYoUtw1vkAdDTwuA/132","comment_is_top":false,"comment_ctime":1585746789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585746789","product_id":100002201,"comment_content":"灰度发布并配合nginx分流能预防很多问题","like_count":0},{"had_liked":false,"id":195000,"user_name":"GZC","can_delete":false,"product_type":"c1","uid":1928513,"ip_address":"","ucode":"1A96BC07D8BC42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6d/41/256f7238.jpg","comment_is_top":false,"comment_ctime":1585126322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585126322","product_id":100002201,"comment_content":"今天一个同事又来傻傻求解决方案却不肯快速回滚版本解决线上问题了……","like_count":0},{"had_liked":false,"id":178529,"user_name":"爱学习的大叔","can_delete":false,"product_type":"c1","uid":1085152,"ip_address":"","ucode":"91F9ABF1EC98D0","user_header":"https://static001.geekbang.org/account/avatar/00/10/8e/e0/847348b1.jpg","comment_is_top":false,"comment_ctime":1581735528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581735528","product_id":100002201,"comment_content":"最近一年记得比较深刻的是我们线上环境登录用户后，信息会有时候串的问题,后来发现一个对象用了一个静态类型","like_count":0},{"had_liked":false,"id":122268,"user_name":"Geek_03bf3e","can_delete":false,"product_type":"c1","uid":1622962,"ip_address":"","ucode":"DF92688B2C1DDB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0lekib0VOFiaibwzsfuObncyRLJXib77V9HTE8XwfdYFfDCHvFwrJcaWLPq4baHGvM05Eq99nE1dGRA/132","comment_is_top":false,"comment_ctime":1565327504,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1565327504","product_id":100002201,"comment_content":"有一次做数据库某字段扩容升级，需求提给dba后，第二天大量新增用户无法注册，原因是dba更新数据库是，将自增索引更没了","like_count":0,"discussions":[{"author":{"id":2660844,"avatar":"","nickname":"Geek_53f12a","note":"","ucode":"AA2FB07145A076","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591465,"discussion_content":"这个冒烟测试时通不过吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666590106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2542376,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cb/28/21a8a29e.jpg","nickname":"夏天","note":"","ucode":"5F224DDAC94DFF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370345,"discussion_content":"alter table 语句和原先的不匹配吧，少了 auto increment。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619366195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115192,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1563504829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563504829","product_id":100002201,"comment_content":"现在再小公司，经常改一些代码的逻辑上的bug，谢谢分享。","like_count":0},{"had_liked":false,"id":2690,"user_name":"依然didala","can_delete":false,"product_type":"c1","uid":1048487,"ip_address":"","ucode":"085ADABE1972F8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/a7/977e479c.jpg","comment_is_top":false,"comment_ctime":1518356634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1518356634","product_id":100002201,"comment_content":"还有一个处理，紧急切FO。","like_count":0},{"had_liked":false,"id":1123,"user_name":"Frankzhang","can_delete":false,"product_type":"c1","uid":1017884,"ip_address":"","ucode":"5E80C66BC02CB7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/1c/55d31f2f.jpg","comment_is_top":false,"comment_ctime":1512211407,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1512211407","product_id":100002201,"comment_content":"同求服务地图工具","like_count":0}]}