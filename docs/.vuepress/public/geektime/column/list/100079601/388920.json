{"id":388920,"title":"14 | é¡¹ç›®ç®¡ç†ï¼šå¦‚ä½•ç¼–å†™é«˜è´¨é‡çš„Makefileï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠå¦‚ä½•ç¼–å†™é«˜è´¨é‡çš„Makefileã€‚</p><p>æˆ‘ä»¬åœ¨ <a href=\"https://time.geekbang.org/column/article/384648\">ç¬¬10è®²</a> å­¦ä¹ è¿‡ï¼Œè¦å†™å‡ºä¸€ä¸ªä¼˜é›…çš„Goé¡¹ç›®ï¼Œä¸ä»…ä»…æ˜¯è¦å¼€å‘ä¸€ä¸ªä¼˜ç§€çš„Goåº”ç”¨ï¼Œè€Œä¸”è¿˜è¦èƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†é¡¹ç›®ã€‚æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯é€šè¿‡Makefileæ¥ç®¡ç†æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬è¦ä¸ºé¡¹ç›®ç¼–å†™Makefileæ–‡ä»¶ã€‚</p><p>åœ¨å’Œå…¶ä»–å¼€å‘åŒå­¦äº¤æµæ—¶ï¼Œæˆ‘å‘ç°å¤§å®¶éƒ½è®¤å¯Makefileå¼ºå¤§çš„é¡¹ç›®ç®¡ç†èƒ½åŠ›ï¼Œä¹Ÿä¼šè‡ªå·±ç¼–å†™Makefileã€‚ä½†æ˜¯å…¶ä¸­çš„ä¸€äº›äººé¡¹ç›®ç®¡ç†åšå¾—å¹¶ä¸å¥½ï¼Œæˆ‘å’Œä»–ä»¬è¿›ä¸€æ­¥äº¤æµåå‘ç°ï¼Œè¿™äº›åŒå­¦åœ¨ç”¨Makefileç®€å•çš„è¯­æ³•é‡å¤ç¼–å†™ä¸€äº›ä½è´¨é‡Makefileæ–‡ä»¶ï¼Œæ ¹æœ¬æ²¡æœ‰æŠŠMakefileçš„åŠŸèƒ½å……åˆ†å‘æŒ¥å‡ºæ¥ã€‚</p><p>ä¸‹é¢ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œä½ å°±ä¼šç†è§£ä½è´¨é‡çš„Makefileæ–‡ä»¶æ˜¯ä»€ä¹ˆæ ·çš„äº†ã€‚</p><pre><code>build: clean vet\n\t@mkdir -p ./Role\n\t@export GOOS=linux &amp;&amp; go build -v .\n\nvet:\n\tgo vet ./...\n\nfmt:\n\tgo fmt ./...\n\nclean:\n\trm -rf dashboard\n</code></pre><p>ä¸Šé¢è¿™ä¸ªMakefileå­˜åœ¨ä¸å°‘é—®é¢˜ã€‚ä¾‹å¦‚ï¼šåŠŸèƒ½ç®€å•ï¼Œåªèƒ½å®Œæˆæœ€åŸºæœ¬çš„ç¼–è¯‘ã€æ ¼å¼åŒ–ç­‰æ“ä½œï¼Œåƒæ„å»ºé•œåƒã€è‡ªåŠ¨ç”Ÿæˆä»£ç ç­‰ä¸€äº›é«˜é˜¶çš„åŠŸèƒ½éƒ½æ²¡æœ‰ï¼›æ‰©å±•æ€§å·®ï¼Œæ²¡æ³•ç¼–è¯‘å‡ºå¯åœ¨Macä¸‹è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›æ²¡æœ‰HelpåŠŸèƒ½ï¼Œä½¿ç”¨éš¾åº¦é«˜ï¼›å•Makefileæ–‡ä»¶ï¼Œç»“æ„å•ä¸€ï¼Œä¸é€‚åˆæ·»åŠ ä¸€äº›å¤æ‚çš„ç®¡ç†åŠŸèƒ½ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸å…‰è¦ç¼–å†™Makefileï¼Œè¿˜è¦ç¼–å†™é«˜è´¨é‡çš„Makefileã€‚é‚£ä¹ˆå¦‚ä½•ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileå‘¢ï¼Ÿæˆ‘è§‰å¾—ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹4ä¸ªæ–¹æ³•æ¥å®ç°ï¼š</p><!-- [[[read_end]]] --><ol>\n<li>æ‰“å¥½åŸºç¡€ï¼Œä¹Ÿå°±æ˜¯ç†Ÿç»ƒæŒæ¡Makefileçš„è¯­æ³•ã€‚</li>\n<li>åšå¥½å‡†å¤‡å·¥ä½œï¼Œä¹Ÿå°±æ˜¯æå‰è§„åˆ’Makefileè¦å®ç°çš„åŠŸèƒ½ã€‚</li>\n<li>è¿›è¡Œè§„åˆ’ï¼Œè®¾è®¡ä¸€ä¸ªåˆç†çš„Makefileç»“æ„ã€‚</li>\n<li>æŒæ¡æ–¹æ³•ï¼Œç”¨å¥½Makefileçš„ç¼–å†™æŠ€å·§ã€‚</li>\n</ol><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¯¦ç»†çœ‹çœ‹è¿™äº›æ–¹æ³•ã€‚</p><h2>ç†Ÿç»ƒæŒæ¡Makefileè¯­æ³•</h2><p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ç¼–å†™é«˜è´¨é‡Makefileçš„ç¬¬ä¸€æ­¥ï¼Œä¾¿æ˜¯ç†Ÿç»ƒæŒæ¡Makefileçš„æ ¸å¿ƒè¯­æ³•ã€‚</p><p>å› ä¸ºMakefileçš„è¯­æ³•æ¯”è¾ƒå¤šï¼Œæˆ‘æŠŠä¸€äº›å»ºè®®ä½ é‡ç‚¹æŒæ¡çš„è¯­æ³•æ”¾åœ¨äº†è¿‘æœŸä¼šæ›´æ–°çš„ç‰¹åˆ«æ”¾é€ä¸­ï¼ŒåŒ…æ‹¬Makefileè§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡ã€å˜é‡èµ‹å€¼ã€æ¡ä»¶è¯­å¥å’ŒMakefileå¸¸ç”¨å‡½æ•°ç­‰ç­‰ã€‚</p><p>å¦‚æœä½ æƒ³æ›´æ·±å…¥ã€å…¨é¢åœ°å­¦ä¹ Makefileçš„è¯­æ³•ï¼Œæˆ‘æ¨èä½ å­¦ä¹ é™ˆçš“è€å¸ˆç¼–å†™çš„<a href=\"https://github.com/seisman/how-to-write-makefile\">ã€Šè·Ÿæˆ‘ä¸€èµ·å†™ Makefileã€‹ (PDF é‡åˆ¶ç‰ˆ)</a>ã€‚</p><h2>è§„åˆ’Makefileè¦å®ç°çš„åŠŸèƒ½</h2><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦è§„åˆ’Makefileè¦å®ç°çš„åŠŸèƒ½ã€‚æå‰è§„åˆ’å¥½åŠŸèƒ½ï¼Œæœ‰åˆ©äºä½ è®¾è®¡Makefileçš„æ•´ä½“ç»“æ„å’Œå®ç°æ–¹æ³•ã€‚</p><p>ä¸åŒé¡¹ç›®æ‹¥æœ‰ä¸åŒçš„MakefileåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸­ä¸€å°éƒ¨åˆ†æ˜¯é€šè¿‡ç›®æ ‡æ–‡ä»¶æ¥å®ç°çš„ï¼Œä½†æ›´å¤šçš„åŠŸèƒ½æ˜¯é€šè¿‡ä¼ªç›®æ ‡æ¥å®ç°çš„ã€‚å¯¹äºGoé¡¹ç›®æ¥è¯´ï¼Œè™½ç„¶ä¸åŒé¡¹ç›®é›†æˆçš„åŠŸèƒ½ä¸ä¸€æ ·ï¼Œä½†ç»å¤§éƒ¨åˆ†é¡¹ç›®éƒ½éœ€è¦å®ç°ä¸€äº›é€šç”¨çš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œåœ¨ä¸€ä¸ªå¤§å‹Goé¡¹ç›®ä¸­Makefileé€šå¸¸å¯ä»¥å®ç°çš„åŠŸèƒ½ã€‚</p><p>ä¸‹é¢æ˜¯IAMé¡¹ç›®çš„Makefileæ‰€é›†æˆçš„åŠŸèƒ½ï¼Œå¸Œæœ›ä¼šå¯¹ä½ æ—¥åè®¾è®¡Makefileæœ‰ä¸€äº›å¸®åŠ©ã€‚</p><pre><code>$ make help\n\nUsage: make &lt;TARGETS&gt; &lt;OPTIONS&gt; ...\n\nTargets:\n  # ä»£ç ç”Ÿæˆç±»å‘½ä»¤\n  gen                Generate all necessary files, such as error code files.\n\n  # æ ¼å¼åŒ–ç±»å‘½ä»¤\n  format             Gofmt (reformat) package sources (exclude vendor dir if existed).\n\n  # é™æ€ä»£ç æ£€æŸ¥\n  lint               Check syntax and styling of go sources.\n\n  # æµ‹è¯•ç±»å‘½ä»¤\n  test               Run unit test.\n  cover              Run unit test and get test coverage.\n\n  # æ„å»ºç±»å‘½ä»¤\n  build              Build source code for host platform.\n  build.multiarch    Build source code for multiple platforms. See option PLATFORMS.\n\n  # Dockeré•œåƒæ‰“åŒ…ç±»å‘½ä»¤\n  image              Build docker images for host arch.\n  image.multiarch    Build docker images for multiple platforms. See option PLATFORMS.\n  push               Build docker images for host arch and push images to registry.\n  push.multiarch     Build docker images for multiple platforms and push images to registry.\n\n  # éƒ¨ç½²ç±»å‘½ä»¤\n  deploy             Deploy updated components to development env.\n\n  # æ¸…ç†ç±»å‘½ä»¤\n  clean              Remove all files that are created by building.\n\n  # å…¶ä»–å‘½ä»¤ï¼Œä¸åŒé¡¹ç›®ä¼šæœ‰åŒºåˆ«\n  release            Release iam\n  verify-copyright   Verify the boilerplate headers for all files.\n  ca                 Generate CA files for all iam components.\n  install            Install iam system with all its components.\n  swagger            Generate swagger document.\n  tools              install dependent tools.\n\n  # å¸®åŠ©å‘½ä»¤\n  help               Show this help info.\n\n# é€‰é¡¹\nOptions:\n  DEBUG        Whether to generate debug symbols. Default is 0.\n  BINS         The binaries to build. Default is all of cmd.\n               This option is available when using: make build/build.multiarch\n               Example: make build BINS=&quot;iam-apiserver iam-authz-server&quot;\n  ...\n</code></pre><p>æ›´è¯¦ç»†çš„å‘½ä»¤ï¼Œä½ å¯ä»¥åœ¨IAMé¡¹ç›®ä»“åº“æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>make help</code>æŸ¥çœ‹ã€‚</p><p>é€šå¸¸è€Œè¨€ï¼ŒGoé¡¹ç›®çš„Makefileåº”è¯¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼šæ ¼å¼åŒ–ä»£ç ã€é™æ€ä»£ç æ£€æŸ¥ã€å•å…ƒæµ‹è¯•ã€ä»£ç æ„å»ºã€æ–‡ä»¶æ¸…ç†ã€å¸®åŠ©ç­‰ç­‰ã€‚å¦‚æœé€šè¿‡dockeréƒ¨ç½²ï¼Œè¿˜éœ€è¦æœ‰dockeré•œåƒæ‰“åŒ…åŠŸèƒ½ã€‚å› ä¸ºGoæ˜¯è·¨å¹³å°çš„è¯­è¨€ï¼Œæ‰€ä»¥æ„å»ºå’Œdockeræ‰“åŒ…å‘½ä»¤ï¼Œè¿˜è¦èƒ½å¤Ÿæ”¯æŒä¸åŒçš„CPUæ¶æ„å’Œå¹³å°ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶Makefileå‘½ä»¤çš„è¡Œä¸ºï¼Œè¿˜éœ€è¦æ”¯æŒOptionsã€‚</p><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹Makefileé›†æˆäº†å“ªäº›åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒhelpå‘½ä»¤ã€‚helpå‘½ä»¤æœ€å¥½é€šè¿‡è§£æMakefileæ–‡ä»¶æ¥è¾“å‡ºé›†æˆçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p><pre><code>## help: Show this help info.\n.PHONY: help\nhelp: Makefile\n  @echo -e &quot;\\nUsage: make &lt;TARGETS&gt; &lt;OPTIONS&gt; ...\\n\\nTargets:&quot;\n  @sed -n 's/^##//p' $&lt; | column -t -s ':' | sed -e 's/^/ /'\n  @echo &quot;$$USAGE_OPTIONS&quot;\n</code></pre><p>ä¸Šé¢çš„helpå‘½ä»¤ï¼Œé€šè¿‡è§£æMakefileæ–‡ä»¶ä¸­çš„<code>##</code>æ³¨é‡Šï¼Œè·å–æ”¯æŒçš„å‘½ä»¤ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä»¥åæ–°åŠ å‘½ä»¤æ—¶ï¼Œå°±ä¸ç”¨å†å¯¹helpå‘½ä»¤è¿›è¡Œä¿®æ”¹äº†ã€‚</p><p>ä½ å¯ä»¥å‚è€ƒä¸Šé¢çš„Makefileç®¡ç†åŠŸèƒ½ï¼Œç»“åˆè‡ªå·±é¡¹ç›®çš„éœ€æ±‚ï¼Œæ•´ç†å‡ºä¸€ä¸ªMakefileè¦å®ç°çš„åŠŸèƒ½åˆ—è¡¨ï¼Œå¹¶åˆæ­¥ç¡®å®šå®ç°æ€è·¯å’Œæ–¹æ³•ã€‚åšå®Œè¿™äº›ï¼Œä½ çš„ç¼–å†™å‰å‡†å¤‡å·¥ä½œå°±åŸºæœ¬å®Œæˆäº†ã€‚</p><h2>è®¾è®¡åˆç†çš„Makefileç»“æ„</h2><p>è®¾è®¡å®ŒMakefileéœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›å…¥Makefileç¼–å†™é˜¶æ®µã€‚ç¼–å†™é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯è®¾è®¡ä¸€ä¸ªåˆç†çš„Makefileç»“æ„ã€‚</p><p>å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œéœ€è¦ç®¡ç†çš„å†…å®¹å¾ˆå¤šï¼Œæ‰€æœ‰ç®¡ç†åŠŸèƒ½éƒ½é›†æˆåœ¨ä¸€ä¸ªMakefileä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´Makefileå¾ˆå¤§ï¼Œéš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼Œæ‰€ä»¥<strong>å»ºè®®é‡‡ç”¨åˆ†å±‚çš„è®¾è®¡æ–¹æ³•ï¼Œæ ¹ç›®å½•ä¸‹çš„Makefileèšåˆæ‰€æœ‰çš„Makefileå‘½ä»¤ï¼Œå…·ä½“å®ç°åˆ™æŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œæ”¾åœ¨å¦å¤–çš„Makefileä¸­</strong>ã€‚</p><p>æˆ‘ä»¬ç»å¸¸ä¼šåœ¨Makefileå‘½ä»¤ä¸­é›†æˆshellè„šæœ¬ï¼Œä½†å¦‚æœshellè„šæœ¬è¿‡äºå¤æ‚ï¼Œä¹Ÿä¼šå¯¼è‡´Makefileå†…å®¹è¿‡å¤šï¼Œéš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚å¹¶ä¸”åœ¨Makefileä¸­é›†æˆå¤æ‚çš„shellè„šæœ¬ï¼Œç¼–å†™ä½“éªŒä¹Ÿå¾ˆå·®ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œ<strong>å¯ä»¥å°†å¤æ‚çš„shellå‘½ä»¤å°è£…åœ¨shellè„šæœ¬ä¸­ï¼Œä¾›Makefileç›´æ¥è°ƒç”¨ï¼Œè€Œä¸€äº›ç®€å•çš„å‘½ä»¤åˆ™å¯ä»¥ç›´æ¥é›†æˆåœ¨Makefileä¸­</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæœ€ç»ˆæˆ‘æ¨èçš„Makefileç»“æ„å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5c/f7/5c524e0297b6d6e4e151643d2e1bbbf7.png?wh=2575x1017\" alt=\"\"></p><p>åœ¨ä¸Šé¢çš„Makefileç»„ç»‡æ–¹å¼ä¸­ï¼Œæ ¹ç›®å½•ä¸‹çš„Makefileèšåˆäº†é¡¹ç›®æ‰€æœ‰çš„ç®¡ç†åŠŸèƒ½ï¼Œè¿™äº›ç®¡ç†åŠŸèƒ½é€šè¿‡Makefileä¼ªç›®æ ‡çš„æ–¹å¼å®ç°ã€‚åŒæ—¶ï¼Œè¿˜å°†è¿™äº›ä¼ªç›®æ ‡è¿›è¡Œåˆ†ç±»ï¼ŒæŠŠç›¸åŒç±»åˆ«çš„ä¼ªç›®æ ‡æ”¾åœ¨åŒä¸€ä¸ªMakefileä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—Makefileæ›´å®¹æ˜“ç»´æŠ¤ã€‚å¯¹äºå¤æ‚çš„å‘½ä»¤ï¼Œåˆ™ç¼–å†™æˆç‹¬ç«‹çš„shellè„šæœ¬ï¼Œå¹¶åœ¨Makefileå‘½ä»¤ä¸­è°ƒç”¨è¿™äº›shellè„šæœ¬ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯IAMé¡¹ç›®çš„Makefileç»„ç»‡ç»“æ„ï¼š</p><pre><code>â”œâ”€â”€ Makefile\nâ”œâ”€â”€ scripts\nâ”‚   â”œâ”€â”€ gendoc.sh\nâ”‚   â”œâ”€â”€ make-rules\nâ”‚   â”‚   â”œâ”€â”€ gen.mk\nâ”‚   â”‚   â”œâ”€â”€ golang.mk\nâ”‚   â”‚   â”œâ”€â”€ image.mk\nâ”‚   â”‚   â””â”€â”€ ...\n    â””â”€â”€ ...\n</code></pre><p>æˆ‘ä»¬å°†ç›¸åŒç±»åˆ«çš„æ“ä½œç»Ÿä¸€æ”¾åœ¨scripts/make-rulesç›®å½•ä¸‹çš„Makefileæ–‡ä»¶ä¸­ã€‚Makefileçš„æ–‡ä»¶åå‚è€ƒåˆ†ç±»å‘½åï¼Œä¾‹å¦‚ golang.mkã€‚æœ€åï¼Œåœ¨/Makefile ä¸­ include è¿™äº› Makefileã€‚</p><p>ä¸ºäº†è·ŸMakefileçš„å±‚çº§ç›¸åŒ¹é…ï¼Œgolang.mkä¸­çš„æ‰€æœ‰ç›®æ ‡éƒ½æŒ‰<code>go.xxx</code>è¿™ç§æ–¹å¼å‘½åã€‚é€šè¿‡è¿™ç§å‘½åæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åˆ†è¾¨å‡ºæŸä¸ªç›®æ ‡å®Œæˆä»€ä¹ˆåŠŸèƒ½ï¼Œæ”¾åœ¨ä»€ä¹ˆæ–‡ä»¶é‡Œï¼Œè¿™åœ¨å¤æ‚çš„Makefileä¸­å°¤å…¶æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯IAMé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ŒMakefileçš„å†…å®¹æ‘˜å½•ï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹ï¼Œä½œä¸ºå‚è€ƒï¼š</p><pre><code>include scripts/make-rules/golang.mk\ninclude scripts/make-rules/image.mk\ninclude scripts/make-rules/gen.mk\ninclude scripts/make-rules/...\n\n## build: Build source code for host platform.\n.PHONY: build\nbuild:\n\t@$(MAKE) go.build\n\n## build.multiarch: Build source code for multiple platforms. See option PLATFORMS.\n.PHONY: build.multiarch\nbuild.multiarch:\n\t@$(MAKE) go.build.multiarch\n\n## image: Build docker images for host arch.\n.PHONY: image\nimage:\n\t@$(MAKE) image.build\n\n## push: Build docker images for host arch and push images to registry.\n.PHONY: push\npush:\n\t@$(MAKE) image.push\n\n## ca: Generate CA files for all iam components.\n.PHONY: ca\nca:\n\t@$(MAKE) gen.ca\n</code></pre><p>å¦å¤–ï¼Œä¸€ä¸ªåˆç†çš„Makefileç»“æ„åº”è¯¥å…·æœ‰å‰ç»æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åœ¨ä¸æ”¹å˜ç°æœ‰ç»“æ„çš„æƒ…å†µä¸‹ï¼Œæ¥çº³åé¢çš„æ–°åŠŸèƒ½ã€‚è¿™å°±éœ€è¦ä½ æ•´ç†å¥½Makefileå½“å‰è¦å®ç°çš„åŠŸèƒ½ã€å³å°†è¦å®ç°çš„åŠŸèƒ½å’Œæœªæ¥å¯èƒ½ä¼šå®ç°çš„åŠŸèƒ½ï¼Œç„¶ååŸºäºè¿™äº›åŠŸèƒ½ï¼Œåˆ©ç”¨Makefileç¼–ç¨‹æŠ€å·§ï¼Œç¼–å†™å¯æ‰©å±•çš„Makefileã€‚</p><p>è¿™é‡Œéœ€è¦ä½ æ³¨æ„ï¼šä¸Šé¢çš„Makefileé€šè¿‡ <code>.PHONY</code> æ ‡è¯†å®šä¹‰äº†å¤§é‡çš„ä¼ªç›®æ ‡ï¼Œå®šä¹‰ä¼ªç›®æ ‡ä¸€å®šè¦åŠ  <code>.PHONY</code> æ ‡è¯†ï¼Œå¦åˆ™å½“æœ‰åŒåçš„æ–‡ä»¶æ—¶ï¼Œä¼ªç›®æ ‡å¯èƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><h2>æŒæ¡Makefileç¼–å†™æŠ€å·§</h2><p>æœ€åï¼Œåœ¨ç¼–å†™è¿‡ç¨‹ä¸­ï¼Œä½ è¿˜éœ€è¦æŒæ¡ä¸€äº›Makefileçš„ç¼–å†™æŠ€å·§ï¼Œè¿™äº›æŠ€å·§å¯ä»¥ä½¿ä½ ç¼–å†™çš„Makefileæ‰©å±•æ€§æ›´å¼ºï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šæŠŠè‡ªå·±é•¿æœŸå¼€å‘è¿‡ç¨‹ä¸­ç§¯ç´¯çš„ä¸€äº›Makefileç¼–å†™ç»éªŒåˆ†äº«ç»™ä½ ã€‚è¿™äº›æŠ€å·§ï¼Œä½ éœ€è¦åœ¨å®é™…ç¼–å†™ä¸­å¤šåŠ ç»ƒä¹ ï¼Œå¹¶å½¢æˆç¼–å†™ä¹ æƒ¯ã€‚</p><h3>æŠ€å·§1ï¼šå–„ç”¨é€šé…ç¬¦å’Œè‡ªåŠ¨å˜é‡</h3><p>Makefileå…è®¸å¯¹ç›®æ ‡è¿›è¡Œç±»ä¼¼æ­£åˆ™è¿ç®—çš„åŒ¹é…ï¼Œä¸»è¦ç”¨åˆ°çš„é€šé…ç¬¦æ˜¯<code>%</code>ã€‚é€šè¿‡ä½¿ç”¨é€šé…ç¬¦ï¼Œå¯ä»¥ä½¿ä¸åŒçš„ç›®æ ‡ä½¿ç”¨ç›¸åŒçš„è§„åˆ™ï¼Œä»è€Œä½¿Makefileæ‰©å±•æ€§æ›´å¼ºï¼Œä¹Ÿæ›´ç®€æ´ã€‚</p><p>æˆ‘ä»¬çš„IAMå®æˆ˜é¡¹ç›®ä¸­ï¼Œå°±å¤§é‡ä½¿ç”¨äº†é€šé…ç¬¦<code>%</code>ï¼Œä¾‹å¦‚ï¼š<code>go.build.%</code>ã€<code>ca.gen.%</code>ã€<code>deploy.run.%</code>ã€<code>tools.verify.%</code>ã€<code>tools.install.%</code>ç­‰ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œ<code>tools.verify.%</code>ï¼ˆä½äº<a href=\"https://github.com/marmotedu/iam/blob/master/scripts/make-rules/tools.mk#L17\">scripts/make-rules/tools.mk</a>æ–‡ä»¶ä¸­ï¼‰å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>tools.verify.%:\n  @if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi\n</code></pre><p><code>make tools.verify.swagger</code>, <code>make tools.verify.mockgen</code>ç­‰å‡å¯ä»¥ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„è§„åˆ™ï¼Œ<code>%</code>åˆ†åˆ«ä»£è¡¨äº†<code>swagger</code>å’Œ<code>mockgen</code>ã€‚</p><p>å¦‚æœä¸ä½¿ç”¨<code>%</code>ï¼Œåˆ™æˆ‘ä»¬éœ€è¦åˆ†åˆ«ä¸º<code>tools.verify.swagger</code>å’Œ<code>tools.verify.mockgen</code>å®šä¹‰è§„åˆ™ï¼Œå¾ˆéº»çƒ¦ï¼Œåé¢ä¿®æ”¹ä¹Ÿå›°éš¾ã€‚</p><p>å¦å¤–ï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡º<code>tools.verify.%</code>è¿™ç§å‘½åæ–¹å¼çš„å¥½å¤„ï¼štoolsè¯´æ˜ä¾èµ–çš„å®šä¹‰ä½äº<code>scripts/make-rules/tools.mk</code> Makefileä¸­ï¼›<code>verify</code>è¯´æ˜<code>tools.verify.%</code>ä¼ªç›®æ ‡å±äºverifyåˆ†ç±»ï¼Œä¸»è¦ç”¨æ¥éªŒè¯å·¥å…·æ˜¯å¦å®‰è£…ã€‚é€šè¿‡è¿™ç§å‘½åæ–¹å¼ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°çŸ¥é“ç›®æ ‡ä½äºå“ªä¸ªMakefileæ–‡ä»¶ä¸­ï¼Œä»¥åŠæƒ³è¦å®Œæˆçš„åŠŸèƒ½ã€‚</p><p>å¦å¤–ï¼Œä¸Šé¢çš„å®šä¹‰ä¸­è¿˜ç”¨åˆ°äº†è‡ªåŠ¨å˜é‡<code>$*</code>ï¼Œç”¨æ¥æŒ‡ä»£è¢«åŒ¹é…çš„å€¼<code>swagger</code>ã€<code>mockgen</code>ã€‚</p><h3>æŠ€å·§2ï¼šå–„ç”¨å‡½æ•°</h3><p>Makefileè‡ªå¸¦çš„å‡½æ•°èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬ç¼–å†™Makefileçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ä¼˜å…ˆä½¿ç”¨è¿™äº›å‡½æ•°ã€‚æˆ‘æŠŠå¸¸ç”¨çš„å‡½æ•°ä»¥åŠå®ƒä»¬å®ç°çš„åŠŸèƒ½æ•´ç†åœ¨äº† <a href=\"https://github.com/marmotedu/geekbang-go/blob/master/makefile/Makefile%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8.md\">Makefileå¸¸ç”¨å‡½æ•°åˆ—è¡¨</a> ä¸­ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹ã€‚</p><p>IAMçš„Makefileæ–‡ä»¶ä¸­å¤§é‡ä½¿ç”¨äº†ä¸Šè¿°å‡½æ•°ï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹è¿™äº›å‡½æ•°çš„å…·ä½“ä½¿ç”¨æ–¹æ³•å’Œåœºæ™¯ï¼Œå¯ä»¥å‚è€ƒIAMé¡¹ç›®çš„Makefileæ–‡ä»¶ <a href=\"https://github.com/marmotedu/iam/tree/master/scripts/make-rules\">make-rules</a>ã€‚</p><h3>æŠ€å·§3ï¼šä¾èµ–éœ€è¦ç”¨åˆ°çš„å·¥å…·</h3><p>å¦‚æœMakefileæŸä¸ªç›®æ ‡çš„å‘½ä»¤ä¸­ç”¨åˆ°äº†æŸä¸ªå·¥å…·ï¼Œå¯ä»¥å°†è¯¥å·¥å…·æ”¾åœ¨ç›®æ ‡çš„ä¾èµ–ä¸­ã€‚è¿™æ ·ï¼Œå½“æ‰§è¡Œè¯¥ç›®æ ‡æ—¶ï¼Œå°±å¯ä»¥æŒ‡å®šæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å®‰è£…è¯¥å·¥å…·ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…åˆ™è‡ªåŠ¨å®‰è£…ï¼Œä»è€Œå®ç°æ›´é«˜ç¨‹åº¦çš„è‡ªåŠ¨åŒ–ã€‚ä¾‹å¦‚ï¼Œ/Makefileæ–‡ä»¶ä¸­ï¼Œformatä¼ªç›®æ ‡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>.PHONY: format\nformat: tools.verify.golines tools.verify.goimports\n  @echo &quot;===========&gt; Formating codes&quot;\n  @$(FIND) -type f -name '*.go' | $(XARGS) gofmt -s -w\n  @$(FIND) -type f -name '*.go' | $(XARGS) goimports -w -local $(ROOT_PACKAGE)\n  @$(FIND) -type f -name '*.go' | $(XARGS) golines -w --max-len=120 --reformat-tags --shorten-comments --ignore-generated .\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œformatä¾èµ–<code>tools.verify.golines tools.verify.goimports</code>ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>tools.verify.golines</code>çš„å®šä¹‰ï¼š</p><pre><code>tools.verify.%:\n  @if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi\n</code></pre><p>å†æ¥çœ‹ä¸‹<code>tools.install.$*</code>è§„åˆ™ï¼š</p><pre><code>.PHONY: install.golines\ninstall.golines:\n  @$(GO) get -u github.com/segmentio/golines\n</code></pre><p>é€šè¿‡<code>tools.verify.%</code>è§„åˆ™å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>tools.verify.%</code>ä¼šå…ˆæ£€æŸ¥å·¥å…·æ˜¯å¦å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå°±ä¼šæ‰§è¡Œ<code>tools.install.$*</code>æ¥å®‰è£…ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>tools.verify.%</code>ç›®æ ‡æ—¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£…golineså‘½ä»¤ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨<code>go get</code>å®‰è£…ï¼Œæé«˜äº†Makefileçš„è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚</p><h3>æŠ€å·§4ï¼šæŠŠå¸¸ç”¨åŠŸèƒ½æ”¾åœ¨/Makefileä¸­ï¼Œä¸å¸¸ç”¨çš„æ”¾åœ¨åˆ†ç±»Makefileä¸­</h3><p>ä¸€ä¸ªé¡¹ç›®ï¼Œå°¤å…¶æ˜¯å¤§å‹é¡¹ç›®ï¼Œæœ‰å¾ˆå¤šéœ€è¦ç®¡ç†çš„åœ°æ–¹ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†éƒ½å¯ä»¥é€šè¿‡Makefileå®ç°è‡ªåŠ¨åŒ–æ“ä½œã€‚ä¸è¿‡ï¼Œä¸ºäº†ä¿æŒ/Makefileæ–‡ä»¶çš„æ•´æ´æ€§ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„å‘½ä»¤éƒ½æ·»åŠ åœ¨/Makefileæ–‡ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å»ºè®®æ˜¯ï¼Œå°†å¸¸ç”¨åŠŸèƒ½æ”¾åœ¨/Makefileä¸­ï¼Œä¸å¸¸ç”¨çš„æ”¾åœ¨åˆ†ç±»Makefileä¸­ï¼Œå¹¶åœ¨/Makefileä¸­includeè¿™äº›åˆ†ç±»Makefileã€‚</p><p>ä¾‹å¦‚ï¼ŒIAMé¡¹ç›®çš„/Makefileé›†æˆäº†<code>format</code>ã€<code>lint</code>ã€<code>test</code>ã€<code>build</code>ç­‰å¸¸ç”¨å‘½ä»¤ï¼Œè€Œå°†<code>gen.errcode.code</code>ã€<code>gen.errcode.doc</code>è¿™ç±»ä¸å¸¸ç”¨çš„åŠŸèƒ½æ”¾åœ¨scripts/make-rules/gen.mkæ–‡ä»¶ä¸­ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œ <code>make gen.errcode.code</code>æ¥æ‰§è¡Œ<code>gen.errcode.code</code>ä¼ªç›®æ ‡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ—¢å¯ä»¥ä¿è¯/Makefileçš„ç®€æ´ã€æ˜“ç»´æŠ¤ï¼Œåˆå¯ä»¥é€šè¿‡<code>make</code>å‘½ä»¤æ¥è¿è¡Œä¼ªç›®æ ‡ï¼Œæ›´åŠ çµæ´»ã€‚</p><h3>æŠ€å·§5ï¼šç¼–å†™å¯æ‰©å±•çš„Makefile</h3><p>ä»€ä¹ˆå«å¯æ‰©å±•çš„Makefileå‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œå¯æ‰©å±•çš„MakefileåŒ…å«ä¸¤å±‚å«ä¹‰ï¼š</p><ol>\n<li>å¯ä»¥åœ¨ä¸æ”¹å˜Makefileç»“æ„çš„æƒ…å†µä¸‹æ·»åŠ æ–°åŠŸèƒ½ã€‚</li>\n<li>æ‰©å±•é¡¹ç›®æ—¶ï¼Œæ–°åŠŸèƒ½å¯ä»¥è‡ªåŠ¨çº³å…¥åˆ°Makefileç°æœ‰é€»è¾‘ä¸­ã€‚</li>\n</ol><p>å…¶ä¸­çš„ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾è®¡åˆç†çš„Makefileç»“æ„æ¥å®ç°ã€‚è¦å®ç°ç¬¬äºŒç‚¹ï¼Œå°±éœ€è¦æˆ‘ä»¬åœ¨ç¼–å†™Makefileæ—¶é‡‡ç”¨ä¸€å®šçš„æŠ€å·§ï¼Œä¾‹å¦‚å¤šç”¨é€šé…ç¬¦ã€è‡ªåŠ¨å˜é‡ã€å‡½æ•°ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥è®©ä½ æ›´å¥½åœ°ç†è§£ã€‚</p><p>åœ¨æˆ‘ä»¬IAMå®æˆ˜é¡¹ç›®çš„<a href=\"https://github.com/marmotedu/iam/blob/v1.0.0/scripts/make-rules/golang.mk#L34\">golang.mk</a>ä¸­ï¼Œæ‰§è¡Œ <code>make go.build</code> æ—¶èƒ½å¤Ÿæ„å»ºcmd/ç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æœ‰æ–°ç»„ä»¶æ·»åŠ æ—¶ï¼Œ <code>make go.build</code> ä»ç„¶èƒ½å¤Ÿæ„å»ºæ–°å¢çš„ç»„ä»¶ï¼Œè¿™å°±å®ç°äº†ä¸Šé¢è¯´çš„ç¬¬äºŒç‚¹ã€‚</p><p>å…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>COMMANDS ?= $(filter-out %.md, $(wildcard ${ROOT_DIR}/cmd/*))\nBINS ?= $(foreach cmd,${COMMANDS},$(notdir ${cmd}))\n\n.PHONY: go.build\ngo.build: go.build.verify $(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS)))\n.PHONY: go.build.%               \n\ngo.build.%:             \n  $(eval COMMAND := $(word 2,$(subst ., ,$*)))\n  $(eval PLATFORM := $(word 1,$(subst ., ,$*)))\n  $(eval OS := $(word 1,$(subst _, ,$(PLATFORM))))           \n  $(eval ARCH := $(word 2,$(subst _, ,$(PLATFORM))))                         \n  @echo &quot;===========&gt; Building binary $(COMMAND) $(VERSION) for $(OS) $(ARCH)&quot;\n  @mkdir -p $(OUTPUT_DIR)/platforms/$(OS)/$(ARCH)\n  @CGO_ENABLED=0 GOOS=$(OS) GOARCH=$(ARCH) $(GO) build $(GO_BUILD_FLAGS) -o $(OUTPUT_DIR)/platforms/$(OS)/$(ARCH)/$(COMMAND)$(GO_OUT_EXT) $(ROOT_PACKAGE)/cmd/$(COMMAND)\n</code></pre><p>å½“æ‰§è¡Œ<code>make go.build</code> æ—¶ï¼Œä¼šæ‰§è¡Œgo.buildçš„ä¾èµ– <code>$(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS)))</code> ,<code>addprefix</code>å‡½æ•°æœ€ç»ˆè¿”å›å­—ç¬¦ä¸² <code>go.build.linux_amd64.iamctl go.build.linux_amd64.iam-authz-server go.build.linux_amd64.iam-apiserver ...</code> ï¼Œè¿™æ—¶å€™å°±ä¼šæ‰§è¡Œ <code>go.build.%</code> ä¼ªç›®æ ‡ã€‚</p><p>åœ¨ <code>go.build.%</code> ä¼ªç›®æ ‡ä¸­ï¼Œé€šè¿‡evalã€wordã€substå‡½æ•°ç»„åˆï¼Œç®—å‡ºäº†COMMANDçš„å€¼ <code>iamctl/iam-apiserver/iam-authz-server/...</code>ï¼Œæœ€ç»ˆé€šè¿‡ <code>$(ROOT_PACKAGE)/cmd/$(COMMAND)</code> å®šä½åˆ°éœ€è¦æ„å»ºçš„ç»„ä»¶çš„mainå‡½æ•°æ‰€åœ¨ç›®å½•ã€‚</p><p>ä¸Šè¿°å®ç°ä¸­æœ‰ä¸¤ä¸ªæŠ€å·§ï¼Œä½ å¯ä»¥æ³¨æ„ä¸‹ã€‚é¦–å…ˆï¼Œé€šè¿‡</p><pre><code>COMMANDS ?= $(filter-out %.md, $(wildcard ${ROOT_DIR}/cmd/*))\nBINS ?= $(foreach cmd,${COMMANDS},$(notdir ${cmd}))\n</code></pre><p>è·å–åˆ°äº†cmd/ç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶åã€‚</p><p>æ¥ç€ï¼Œé€šè¿‡ä½¿ç”¨é€šé…ç¬¦å’Œè‡ªåŠ¨å˜é‡ï¼Œè‡ªåŠ¨åŒ¹é…åˆ°<code>go.build.linux_amd64.iam-authz-server</code> è¿™ç±»ä¼ªç›®æ ‡å¹¶æ„å»ºã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæƒ³è¦ç¼–å†™ä¸€ä¸ªå¯æ‰©å±•çš„Makefileï¼Œç†Ÿç»ƒæŒæ¡Makefileçš„ç”¨æ³•æ˜¯åŸºç¡€ï¼Œæ›´å¤šçš„æ˜¯éœ€è¦æˆ‘ä»¬åŠ¨è„‘æ€è€ƒå¦‚ä½•å»ç¼–å†™Makefileã€‚</p><h3>æŠ€å·§6ï¼šå°†æ‰€æœ‰è¾“å‡ºå­˜æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ–¹ä¾¿æ¸…ç†å’ŒæŸ¥æ‰¾</h3><p>åœ¨æ‰§è¡ŒMakefileçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè¾“å‡ºå„ç§å„æ ·çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ Go ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€æµ‹è¯•è¦†ç›–ç‡æ•°æ®ç­‰ï¼Œæˆ‘å»ºè®®ä½ æŠŠè¿™äº›æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ–¹ä¾¿åæœŸçš„æ¸…ç†å’ŒæŸ¥æ‰¾ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¾åœ¨<code>_output</code>è¿™ç±»ç›®å½•ä¸‹ï¼Œè¿™æ ·æ¸…ç†æ—¶å°±å¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦æ¸…ç†<code>_output</code>æ–‡ä»¶å¤¹å°±å¯ä»¥ï¼Œä¾‹å¦‚ï¼š</p><pre><code>.PHONY: go.clean\ngo.clean:\n  @echo &quot;===========&gt; Cleaning all build output&quot;\n  @-rm -vrf $(OUTPUT_DIR)\n</code></pre><p>è¿™é‡Œè¦æ³¨æ„ï¼Œè¦ç”¨<code>-rm</code>ï¼Œè€Œä¸æ˜¯<code>rm</code>ï¼Œé˜²æ­¢åœ¨æ²¡æœ‰<code>_output</code>ç›®å½•æ—¶ï¼Œæ‰§è¡Œ<code>make go.clean</code>æŠ¥é”™ã€‚</p><h3>æŠ€å·§7ï¼šä½¿ç”¨å¸¦å±‚çº§çš„å‘½åæ–¹å¼</h3><p>é€šè¿‡ä½¿ç”¨å¸¦å±‚çº§çš„å‘½åæ–¹å¼ï¼Œä¾‹å¦‚<code>tools.verify.swagger</code> ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°<strong>ç›®æ ‡åˆ†ç»„ç®¡ç†</strong>ã€‚è¿™æ ·åšçš„å¥½å¤„æœ‰å¾ˆå¤šã€‚é¦–å…ˆï¼Œå½“Makefileæœ‰å¤§é‡ç›®æ ‡æ—¶ï¼Œé€šè¿‡åˆ†ç»„ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°ç®¡ç†è¿™äº›ç›®æ ‡ã€‚å…¶æ¬¡ï¼Œåˆ†ç»„ä¹Ÿèƒ½æ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥é€šè¿‡ç»„åä¸€çœ¼è¯†åˆ«å‡ºè¯¥ç›®æ ‡çš„åŠŸèƒ½ç±»åˆ«ã€‚æœ€åï¼Œè¿™æ ·åšè¿˜å¯ä»¥å¤§å¤§å‡å°ç›®æ ‡é‡åçš„æ¦‚ç‡ã€‚</p><p>ä¾‹å¦‚ï¼ŒIAMé¡¹ç›®çš„Makefileå°±å¤§é‡é‡‡ç”¨äº†ä¸‹é¢è¿™ç§å‘½åæ–¹å¼ã€‚</p><pre><code>.PHONY: gen.run\ngen.run: gen.clean gen.errcode gen.docgo\n\n.PHONY: gen.errcode\ngen.errcode: gen.errcode.code gen.errcode.doc\n\n.PHONY: gen.errcode.code\ngen.errcode.code: tools.verify.codegen\n    ...\n.PHONY: gen.errcode.doc\ngen.errcode.doc: tools.verify.codegen\n    ...\n</code></pre><h3>æŠ€å·§8ï¼šåšå¥½ç›®æ ‡æ‹†åˆ†</h3><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå®ç”¨çš„æŠ€å·§ï¼šæˆ‘ä»¬è¦åˆç†åœ°æ‹†åˆ†ç›®æ ‡ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®‰è£…å·¥å…·æ‹†åˆ†æˆä¸¤ä¸ªç›®æ ‡ï¼šéªŒè¯å·¥å…·æ˜¯å¦å·²å®‰è£…å’Œå®‰è£…å·¥å…·ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ç»™æˆ‘ä»¬çš„Makefileå¸¦æ¥æ›´å¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æ€§åœ°æ‰§è¡Œå…¶ä¸­ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªæ“ä½œä¸€èµ·æ‰§è¡Œã€‚</p><p>è¿™é‡Œæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>gen.errcode.code: tools.verify.codegen\n\ntools.verify.%:    \n  @if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi  \n\n.PHONY: install.codegen\ninstall.codegen:              \n  @$(GO) install ${ROOT_DIR}/tools/codegen/codegen.go\n</code></pre><p>ä¸Šé¢çš„Makefileä¸­ï¼Œgen.errcode.codeä¾èµ–äº†tools.verify.codegenï¼Œtools.verify.codegenä¼šå…ˆæ£€æŸ¥codegenå‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå†è°ƒç”¨install.codegenæ¥å®‰è£…codegenå·¥å…·ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„Makefileè®¾è®¡æ˜¯ï¼š</p><pre><code>gen.errcode.code: install.codegen\n</code></pre><p>é‚£æ¯æ¬¡æ‰§è¡Œgen.errcode.codeéƒ½è¦é‡æ–°å®‰è£…codegenå‘½ä»¤ï¼Œè¿™ç§æ“ä½œæ˜¯ä¸å¿…è¦çš„ï¼Œè¿˜ä¼šå¯¼è‡´ <code>make gen.errcode.code</code> æ‰§è¡Œå¾ˆæ…¢ã€‚</p><h3>æŠ€å·§9ï¼šè®¾ç½®OPTIONS</h3><p>ç¼–å†™Makefileæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠä¸€äº›å¯å˜çš„åŠŸèƒ½é€šè¿‡OPTIONSæ¥æ§åˆ¶ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œè¿™é‡Œè¿˜æ˜¯æ‹¿IAMé¡¹ç›®çš„Makefileæ¥ä¸¾ä¾‹ã€‚</p><p>å‡è®¾æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªé€‰é¡¹ <code>V</code> ï¼Œæ¥æ§åˆ¶æ˜¯å¦éœ€è¦åœ¨æ‰§è¡ŒMakefileæ—¶æ‰“å°è¯¦ç»†çš„ä¿¡æ¯ã€‚è¿™å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ­¥éª¤æ¥å®ç°ã€‚</p><p><strong>é¦–å…ˆï¼Œ</strong>åœ¨/Makefileä¸­å®šä¹‰ <code>USAGE_OPTIONS</code> ã€‚å®šä¹‰ <code>USAGE_OPTIONS</code> å¯ä»¥ä½¿å¼€å‘è€…åœ¨æ‰§è¡Œ <code>make help</code> åæ„ŸçŸ¥åˆ°æ­¤OPTIONï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè®¾ç½®ã€‚</p><pre><code>define USAGE_OPTIONS    \n                         \nOptions:\n  ...\n  BINS         The binaries to build. Default is all of cmd.\n               ...\n  ...\n  V            Set to 1 enable verbose build. Default is 0.    \nendef    \nexport USAGE_OPTIONS    \n</code></pre><p><strong>æ¥ç€ï¼Œ</strong>åœ¨<a href=\"https://github.com/marmotedu/iam/blob/master/scripts/make-rules/common.mk#L70\">scripts/make-rules/common.mk</a>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰è®¾ç½®Vé€‰é¡¹ï¼Œæ¥é€‰æ‹©ä¸åŒçš„è¡Œä¸ºï¼š</p><pre><code>ifndef V    \nMAKEFLAGS += --no-print-directory    \nendif\n</code></pre><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥ä½¿ç”¨ <code>V</code> ï¼š</p><pre><code>ifeq ($(origin V), undefined)                                \nMAKEFLAGS += --no-print-directory              \nendif\n</code></pre><p>ä¸Šé¢ï¼Œæˆ‘ä»‹ç»äº† <code>V</code> OPTIONï¼Œæˆ‘ä»¬åœ¨Makefileä¸­é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰å®šä¹‰ <code>V</code> ï¼Œæ¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚å…¶å®è¿˜æœ‰ä¸€ç§OPTIONï¼Œè¿™ç§OPTIONçš„å€¼æˆ‘ä»¬åœ¨Makefileä¸­æ˜¯ç›´æ¥ä½¿ç”¨çš„ï¼Œä¾‹å¦‚<code>BINS</code>ã€‚é’ˆå¯¹è¿™ç§OPTIONï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥ä½¿ç”¨ï¼š</p><pre><code>BINS ?= $(foreach cmd,${COMMANDS},$(notdir ${cmd}))\n...\ngo.build: go.build.verify $(addprefix go.build., $(addprefix $(PLATFORM)., $(BINS)))\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ <strong>?=</strong> æ¥åˆ¤æ–­ <code>BINS</code> å˜é‡æœ‰æ²¡æœ‰è¢«èµ‹å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™èµ‹äºˆç­‰å·åçš„å€¼ã€‚æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥åœ¨Makefileè§„åˆ™ä¸­ä½¿ç”¨å®ƒã€‚</p><h3>æŠ€å·§10ï¼šå®šä¹‰ç¯å¢ƒå˜é‡</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨Makefileä¸­å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼š</p><pre><code>GO := go                                          \nGO_SUPPORTED_VERSIONS ?= 1.13|1.14|1.15|1.16|1.17    \nGO_LDFLAGS += -X $(VERSION_PACKAGE).GitVersion=$(VERSION) \\    \n  -X $(VERSION_PACKAGE).GitCommit=$(GIT_COMMIT) \\       \n  -X $(VERSION_PACKAGE).GitTreeState=$(GIT_TREE_STATE) \\                          \n  -X $(VERSION_PACKAGE).BuildDate=$(shell date -u +'%Y-%m-%dT%H:%M:%SZ')    \nifneq ($(DLV),)                                                                                                                              \n  GO_BUILD_FLAGS += -gcflags &quot;all=-N -l&quot;    \n  LDFLAGS = &quot;&quot;      \nendif                                                                                   \nGO_BUILD_FLAGS += -tags=jsoniter -ldflags &quot;$(GO_LDFLAGS)&quot; \n...\nFIND := find . ! -path './third_party/*' ! -path './vendor/*'    \nXARGS := xargs --no-run-if-empty \n</code></pre><p>è¿™äº›ç¯å¢ƒå˜é‡å’Œç¼–ç¨‹ä¸­ä½¿ç”¨å®å®šä¹‰çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼šåªè¦ä¿®æ”¹ä¸€å¤„ï¼Œå°±å¯ä»¥ä½¿å¾ˆå¤šåœ°æ–¹åŒæ—¶ç”Ÿæ•ˆï¼Œé¿å…äº†é‡å¤çš„å·¥ä½œã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†GOã€GO_BUILD_FLAGSã€FINDè¿™ç±»å˜é‡å®šä¹‰ä¸ºç¯å¢ƒå˜é‡ã€‚</p><h3>æŠ€å·§11ï¼šè‡ªå·±è°ƒç”¨è‡ªå·±</h3><p>åœ¨ç¼–å†™Makefileçš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸€ç§æƒ…å†µï¼šA-Targetç›®æ ‡å‘½ä»¤ä¸­ï¼Œéœ€è¦å®Œæˆæ“ä½œB-Actionï¼Œè€Œæ“ä½œB-Actionæˆ‘ä»¬å·²ç»é€šè¿‡ä¼ªç›®æ ‡B-Targetå®ç°è¿‡ã€‚ä¸ºäº†è¾¾åˆ°æœ€å¤§çš„ä»£ç å¤ç”¨åº¦ï¼Œè¿™æ—¶å€™æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨A-Targetçš„å‘½ä»¤ä¸­æ‰§è¡ŒB-Targetã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>tools.verify.%:\n  @if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi\n</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ <code>$(MAKE)</code> è°ƒç”¨äº†ä¼ªç›®æ ‡ <code>tools.install.$*</code> ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMakefileåœ¨åˆ‡æ¢ç›®å½•æ—¶ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p><pre><code>$ make tools.install.codegen\n===========&gt; Installing codegen\nmake[1]: Entering directory `/home/colin/workspace/golang/src/github.com/marmotedu/iam'\nmake[1]: Leaving directory `/home/colin/workspace/golang/src/github.com/marmotedu/iam'\n</code></pre><p>å¦‚æœè§‰å¾—<strong>Entering directory</strong>è¿™ç±»ä¿¡æ¯å¾ˆçƒ¦äººï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>MAKEFLAGS += --no-print-directory</code> æ¥ç¦æ­¢Makefileæ‰“å°è¿™äº›ä¿¡æ¯ã€‚</p><h2>æ€»ç»“</h2><p>å¦‚æœä½ æƒ³è¦é«˜æ•ˆç®¡ç†é¡¹ç›®ï¼Œä½¿ç”¨Makefileæ¥ç®¡ç†æ˜¯ç›®å‰çš„æœ€ä½³å®è·µã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‡ ä¸ªæ–¹æ³•ï¼Œæ¥ç¼–å†™ä¸€ä¸ªé«˜è´¨é‡çš„Makefileã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦ç†Ÿç»ƒæŒæ¡Makefileçš„è¯­æ³•ã€‚æˆ‘å»ºè®®ä½ é‡ç‚¹æŒæ¡ä»¥ä¸‹è¯­æ³•ï¼šMakefileè§„åˆ™è¯­æ³•ã€ä¼ªç›®æ ‡ã€å˜é‡èµ‹å€¼ã€ç‰¹æ®Šå˜é‡ã€è‡ªåŠ¨åŒ–å˜é‡ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦æå‰è§„åˆ’Makefileè¦å®ç°çš„åŠŸèƒ½ã€‚ä¸€ä¸ªå¤§å‹Goé¡¹ç›®é€šå¸¸éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼šä»£ç ç”Ÿæˆç±»å‘½ä»¤ã€æ ¼å¼åŒ–ç±»å‘½ä»¤ã€é™æ€ä»£ç æ£€æŸ¥ã€ æµ‹è¯•ç±»å‘½ä»¤ã€æ„å»ºç±»å‘½ä»¤ã€Dockeré•œåƒæ‰“åŒ…ç±»å‘½ä»¤ã€éƒ¨ç½²ç±»å‘½ä»¤ã€æ¸…ç†ç±»å‘½ä»¤ï¼Œç­‰ç­‰ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡MakefileåŠŸèƒ½åˆ†ç±»ã€æ–‡ä»¶åˆ†å±‚ã€å¤æ‚å‘½ä»¤è„šæœ¬åŒ–ç­‰æ–¹å¼ï¼Œæ¥è®¾è®¡ä¸€ä¸ªåˆç†çš„Makefileç»“æ„ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒæ¡ä¸€äº›Makefileç¼–å†™æŠ€å·§ï¼Œä¾‹å¦‚ï¼šå–„ç”¨é€šé…ç¬¦ã€è‡ªåŠ¨å˜é‡å’Œå‡½æ•°ï¼›ç¼–å†™å¯æ‰©å±•çš„Makefileï¼›ä½¿ç”¨å¸¦å±‚çº§çš„å‘½åæ–¹å¼ï¼Œç­‰ç­‰ã€‚é€šè¿‡è¿™äº›æŠ€å·§ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¿è¯æˆ‘ä»¬ç¼–å†™å‡ºä¸€ä¸ªé«˜è´¨é‡çš„Makefileã€‚</p><h2>è¯¾åç»ƒä¹ </h2><ol>\n<li>èµ°è¯»IAMé¡¹ç›®çš„Makefileå®ç°ï¼Œçœ‹ä¸‹IAMé¡¹ç›®æ˜¯å¦‚ä½•é€šè¿‡ <code>make tools.install</code> ä¸€é”®å®‰è£…æ‰€æœ‰åŠŸèƒ½ï¼Œé€šè¿‡ <code>make tools.install.xxx</code> æ¥æŒ‡å®šå®‰è£… <code>xxx</code> å·¥å…·çš„ã€‚</li>\n<li>ä½ ç¼–å†™Makefileçš„æ—¶å€™ï¼Œè¿˜ç”¨åˆ°è¿‡å“ªäº›ç¼–å†™æŠ€å·§å‘¢ï¼Ÿæ¬¢è¿å’Œæˆ‘åˆ†äº«ä½ çš„ç»éªŒï¼Œæˆ–è€…ä½ è¸©è¿‡çš„å‘ã€‚</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿å’Œæˆ‘ä¸€èµ·æ¢è®¨å…³äºMakefileçš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":299542,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1624698675,"is_pvip":false,"replies":[{"id":"108615","content":"ide&#47;vimä¸ä¼šè¿›è¡Œé™æ€ä»£ç æ£€æŸ¥ã€‚<br><br>ide&#47;vimçš„æ ¼å¼åŒ–æ˜¯å¯é…çš„ã€‚è€Œä¸”ide&#47;vimçš„æ ¼å¼åŒ–æ›´å¤šçš„æ˜¯ç”¨äº†gofmt -wè¿™ç§æ ¼å¼åŒ–ã€‚<br><br>è¿™é‡Œå°†æ ¼å¼åŒ–ä»£ç æ”¾åœ¨Makefileæœ‰ä¸ªé€‰æ‹©ï¼š<br>1. æ›´ä¸°å¯Œï¼Œå¯é…ç½®çš„æ ¼å¼åŒ–ä»£ç åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šæ”¯æŒgolinesã€goimportã€gofmtåé¢è¿˜å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ›´å¤š<br>2. ç¡®ä¿æ¯ä¸€ä¸ªå¼€å‘è€…ç”¨çš„éƒ½æ˜¯åŒä¸€ç§æ ¼å¼åŒ–æ–¹æ³•ï¼ˆide&#47;vimçš„æ ¼å¼åŒ–ä¸ä¸€å®šæ¯ä¸€ä¸ªå¼€å‘è€…éƒ½ä¼šé™ªï¼Œæ›´ä¸ä¸€å®šé…ç½®çš„æ ¼å¼åŒ–é€‰é¡¹æ˜¯ä¸€è‡´çš„ï¼‰<br><br>å°†æ ¼å¼åŒ–æ”¾åœ¨Makefileä¸­ï¼Œå¯ä»¥ç¡®ä¿æŸä¸ªåŠ¨ä½œä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”æ‰§è¡Œçš„æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚<br>","user_name":"ä½œè€…å›å¤","comment_id":299542,"uid":"1167883","ip_address":"","utype":1,"ctime":1624704103,"user_name_real":"CK1.0"}],"discussion_count":4,"race_medal":0,"score":"66049208115","product_id":100079601,"comment_content":"æ ¼å¼åŒ–ä»£ç ã€é™æ€ä»£ç æ£€æŸ¥ï¼Œè¿™ç§ideæˆ–viméƒ½ä¼šé…ç½®ä¿å­˜æ—¶æ ¼å¼åŒ–å’Œä»£ç æ£€æŸ¥ï¼Œè¿˜æœ‰å¿…è¦å†™åœ¨makefileä¸­å—","like_count":15,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522466,"discussion_content":"ide/vimä¸ä¼šè¿›è¡Œé™æ€ä»£ç æ£€æŸ¥ã€‚\n\nide/vimçš„æ ¼å¼åŒ–æ˜¯å¯é…çš„ã€‚è€Œä¸”ide/vimçš„æ ¼å¼åŒ–æ›´å¤šçš„æ˜¯ç”¨äº†gofmt -wè¿™ç§æ ¼å¼åŒ–ã€‚\n\nè¿™é‡Œå°†æ ¼å¼åŒ–ä»£ç æ”¾åœ¨Makefileæœ‰ä¸ªé€‰æ‹©ï¼š\n1. æ›´ä¸°å¯Œï¼Œå¯é…ç½®çš„æ ¼å¼åŒ–ä»£ç åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šæ”¯æŒgolinesã€goimportã€gofmtåé¢è¿˜å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ›´å¤š\n2. ç¡®ä¿æ¯ä¸€ä¸ªå¼€å‘è€…ç”¨çš„éƒ½æ˜¯åŒä¸€ç§æ ¼å¼åŒ–æ–¹æ³•ï¼ˆide/vimçš„æ ¼å¼åŒ–ä¸ä¸€å®šæ¯ä¸€ä¸ªå¼€å‘è€…éƒ½ä¼šé™ªï¼Œæ›´ä¸ä¸€å®šé…ç½®çš„æ ¼å¼åŒ–é€‰é¡¹æ˜¯ä¸€è‡´çš„ï¼‰\n\nå°†æ ¼å¼åŒ–æ”¾åœ¨Makefileä¸­ï¼Œå¯ä»¥ç¡®ä¿æŸä¸ªåŠ¨ä½œä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”æ‰§è¡Œçš„æ•ˆæœæ˜¯ä¸€è‡´çš„ã€‚\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1624704103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067224,"avatar":"https://static001.geekbang.org/account/avatar/00/10/48/d8/d0e9bd80.jpg","nickname":"å½“è¿å…ƒå®","note":"","ucode":"525542C70260F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407778,"discussion_content":"vimä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨golangci-lintæ’ä»¶è¿›è¡Œä»£ç é™æ€åŒ–æ£€æŸ¥ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635121776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380876,"discussion_content":"vim+aleæ’ä»¶æ˜¯å¯ä»¥åšä»£ç é™æ€æ£€æŸ¥çš„ï¼Œç”šè‡³å¯ä»¥é…ç½®è‡ªåŠ¨ä¿®å¤ç®€å•çš„ä»£ç é”™è¯¯ï¼ŒideåŒç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624770857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028811,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/0b/73628618.jpg","nickname":"å…”å˜Ÿå˜Ÿ","note":"","ucode":"5A9042B4C7670C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548862,"discussion_content":"æ‰€ä»¥è¿™æ˜¯è¦é¢å¤–é…çš„æ’ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643425937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":380876,"ip_address":""},"score":548862,"extra":""}]}]},{"had_liked":false,"id":314181,"user_name":"Juniper","can_delete":false,"product_type":"c1","uid":1174794,"ip_address":"","ucode":"1BC24554034BD3","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/0a/18201290.jpg","comment_is_top":false,"comment_ctime":1632887837,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"35992626205","product_id":100079601,"comment_content":"è¿™éƒ¨åˆ†ä»¥å‰æ²¡æ¥è§¦è¿‡ï¼Œå…ˆæˆ˜ç•¥æ€§æ”¾å¼ƒï¼Œåé¢å†å›æ¥å¥½å¥½å•ƒ","like_count":8,"discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399490,"discussion_content":"ä¸èƒ½æ”¾å¼ƒï¼ŒMakefileæ˜¯è¿™é—¨è¯¾çš„ä¸»çº¿ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632973862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299562,"user_name":"Vackine","can_delete":false,"product_type":"c1","uid":1139588,"ip_address":"","ucode":"8E412EE82D3B59","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg","comment_is_top":false,"comment_ctime":1624711330,"is_pvip":false,"replies":[{"id":"108649","content":"æŒç»­å‘å¸ƒéœ€è¦CI&#47;CDç³»ç»Ÿçš„æ”¯æŒã€‚<br><br>å†™å¥½Makefileåªèƒ½è¯´æ–¹ä¾¿CIç³»ç»Ÿç›´æ¥è°ƒç”¨ã€‚ç¦»CI&#47;Cå·®çš„è¿˜è¿œ","user_name":"ä½œè€…å›å¤","comment_id":299562,"uid":"1167883","ip_address":"","utype":1,"ctime":1624760319,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"14509613218","product_id":100079601,"comment_content":"å†™å¥½ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„é¡¹ç›®çš„makefileï¼Œç„¶ååªå¯¹makefile çš„å„ä¸ªåŠŸèƒ½åšç¼–æ’ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åšåˆ°åŸºæœ¬çš„æŒç»­å‘å¸ƒäº†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522474,"discussion_content":"æŒç»­å‘å¸ƒéœ€è¦CI/CDç³»ç»Ÿçš„æ”¯æŒã€‚\n\nå†™å¥½Makefileåªèƒ½è¯´æ–¹ä¾¿CIç³»ç»Ÿç›´æ¥è°ƒç”¨ã€‚ç¦»CI/Cå·®çš„è¿˜è¿œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624760319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323510,"user_name":"yandongxiao","can_delete":false,"product_type":"c1","uid":1017700,"ip_address":"","ucode":"D397F4DB0109C8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg","comment_is_top":false,"comment_ctime":1637941116,"is_pvip":false,"replies":[{"id":"117666","content":"ç›´æ¥copyå¯èƒ½æ›´é¦™","user_name":"ä½œè€…å›å¤","comment_id":323510,"uid":"1167883","ip_address":"","utype":1,"ctime":1638360891,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"10227875708","product_id":100079601,"comment_content":"æ€»ç»“ï¼šMakefile æ˜¯é«˜æ•ˆé¡¹ç›®ç®¡ç†çš„é‡è¦å·¥å…·ï¼Œç¼–å†™é«˜è´¨é‡çš„ Makefileï¼Œæ–¹ä¾¿ä½ åšCIçš„æ£€æŸ¥ï¼Œä¸è‡³äºè‡ªå·±çš„ä»£ç æäº¤ä¸Šä»¥åï¼Œè¢«æç¤ºå„ç§ä¸é€šè¿‡ï¼ˆé™æ€ä»£ç æ£€æŸ¥ã€æ ¼å¼é”™è¯¯ã€å•å…ƒæµ‹è¯•ç­‰ï¼‰ã€‚<br><br>è¦åšå¥½ Makefile çš„ç®¡ç†ï¼Œå¯æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ï¼š1. å­¦ä¹  Makefile è¯­æ³•ï¼›2. è§„åˆ’ Makefile è¦å®ç°çš„åŠŸèƒ½ï¼›3. è§„åˆ’ Makefile ç»“æ„ï¼›4. å–„ç”¨ Makefile æŠ€å·§ã€‚<br><br>ç›´æ¥æ‹·è´IAMé¡¹ç›®çš„Makefileï¼Œä¹Ÿå¾ˆé¦™ã€‚","like_count":2,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535137,"discussion_content":"ç›´æ¥copyå¯èƒ½æ›´é¦™","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1638360891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1017700,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg","nickname":"yandongxiao","note":"","ucode":"D397F4DB0109C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535183,"discussion_content":"å¿…é¡»çš„ï¼Œå·²ç»ç›´æ¥æŠŠä¸€æ•´å¥—çš„makefile å’Œ è„šæœ¬ç”¨åˆ°äº†é¡¹ç›®å†…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638363487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360157,"user_name":"tinyğŸŒ¾","can_delete":false,"product_type":"c1","uid":1119851,"ip_address":"æ¹–åŒ—","ucode":"7A4DE00381D1F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/6b/af7c7745.jpg","comment_is_top":false,"comment_ctime":1666239171,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1666239171","product_id":100079601,"comment_content":"è¿è¡Œmake lintæŠ¥é”™ ï¼Œè¿™ä¸ªæ€ä¹ˆæ’æŸ¥<br>make[1]: *** [go.lint] Error 1<br>make: *** [lint] Error 2<br>","like_count":0},{"had_liked":false,"id":359604,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"æ²³åŒ—","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1665672578,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665672578","product_id":100079601,"comment_content":"ç”¨winå¼€å‘çš„è¡¨ç¤º äºšå†å±±å¤§","like_count":0},{"had_liked":false,"id":355323,"user_name":"å·¦è€³æœµä¸œ","can_delete":false,"product_type":"c1","uid":1160678,"ip_address":"åŒ—äº¬","ucode":"60134ACF12BB52","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","comment_is_top":false,"comment_ctime":1661267377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661267377","product_id":100079601,"comment_content":".PHONY: format<br>format: tools.verify.golines<br>.PHONY: tools.verify.%<br>tools.verify.%:<br>\t@if ! which $* &amp;&gt;&#47;dev&#47;null; then $(MAKE) tools.install.$*; fi<br>è¿™é‡Œçš„ $* æ˜¯æŒ‡ â€˜golinesâ€™ è¿˜æ˜¯ â€˜tools.verify.golinesâ€™ å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":342374,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","comment_is_top":false,"comment_ctime":1650213806,"is_pvip":false,"replies":[{"id":"125528","content":"è¿˜æœ‰äº›åœ¨Macä¸Šå¼€å‘ã€‚<br><br>è¿™ä¸ªæ•™ç¨‹æ²¡å¿…è¦åœ¨Macã€Windowså¹³å°ä¸‹éƒ½é€‚é…ä¸€ä»½ã€‚<br>ä¹‹æ‰€ä»¥é€‰æ‹©Linuxæ˜¯å› ä¸ºä»¥ä¸‹åŸå› ï¼š<br><br>1. å› ä¸ºWindowsã€Macã€Linuxéƒ½æœ‰å¼€å‘è€…ï¼Œä½†è¯¥æ•™ç¨‹åªèƒ½é€‰æ‹©ä¸€ä¸ªå¹³å°ï¼Œæ‰€ä»¥é€‰æ‹©äº†Linux<br>2. å°†æ¥éƒ¨ç½²æœåŠ¡æ˜¯åœ¨Linuxä¸Šéƒ¨ç½²çš„ï¼Œåœ¨å­¦ä¹ æ—¶ï¼Œåœ¨Linuxä¸Šå®Œæˆå¼€å‘éƒ¨ç½²ï¼Œä¹Ÿæ˜¯å­¦ä¹ Linuxçš„ä¸€ä¸ªé€”å¾„ï¼Œä¸ºå°†æ¥å·¥ä½œä¸­ï¼Œ åœ¨Linuxä¸‹æ“ä½œæ‰“ä¸‹åŸºç¡€","user_name":"ä½œè€…å›å¤","comment_id":342374,"uid":"1167883","ip_address":"","utype":1,"ctime":1651078505,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1650213806","product_id":100079601,"comment_content":"å¯¹ Windows ç³»ç»Ÿä¸å‹å¥½ï¼Œå®é™… CRUD ä¸šåŠ¡ä¸­ï¼Œæ›´å¤šäººæ˜¯åœ¨ Windows ä¸‹å¼€å‘å§ï¼ˆIDE é€‰ VSCode æˆ– GoLandï¼‰ã€‚","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568219,"discussion_content":"è¿˜æœ‰äº›åœ¨Macä¸Šå¼€å‘ã€‚\n\nè¿™ä¸ªæ•™ç¨‹æ²¡å¿…è¦åœ¨Macã€Windowså¹³å°ä¸‹éƒ½é€‚é…ä¸€ä»½ã€‚\nä¹‹æ‰€ä»¥é€‰æ‹©Linuxæ˜¯å› ä¸ºä»¥ä¸‹åŸå› ï¼š\n\n1. å› ä¸ºWindowsã€Macã€Linuxéƒ½æœ‰å¼€å‘è€…ï¼Œä½†è¯¥æ•™ç¨‹åªèƒ½é€‰æ‹©ä¸€ä¸ªå¹³å°ï¼Œæ‰€ä»¥é€‰æ‹©äº†Linux\n2. å°†æ¥éƒ¨ç½²æœåŠ¡æ˜¯åœ¨Linuxä¸Šéƒ¨ç½²çš„ï¼Œåœ¨å­¦ä¹ æ—¶ï¼Œåœ¨Linuxä¸Šå®Œæˆå¼€å‘éƒ¨ç½²ï¼Œä¹Ÿæ˜¯å­¦ä¹ Linuxçš„ä¸€ä¸ªé€”å¾„ï¼Œä¸ºå°†æ¥å·¥ä½œä¸­ï¼Œ åœ¨Linuxä¸‹æ“ä½œæ‰“ä¸‹åŸºç¡€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651078505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338204,"user_name":"ç‰›2ç‰¹å·¥","can_delete":false,"product_type":"c1","uid":1042036,"ip_address":"","ucode":"57712732654956","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e6/74/8b8097c1.jpg","comment_is_top":false,"comment_ctime":1647352445,"is_pvip":true,"replies":[{"id":"125551","content":"ç¼–è¯‘å·¥å…·ï¼Œä¸å¤ªé€‚åˆé›†æˆå¤ªå¤šè¿™ç±»åŠŸèƒ½ã€‚<br><br>è€Œä¸”è¿™ç±»åŠŸèƒ½å…·ä½“å®ç°ä¹Ÿè·Ÿé¡¹ç›®æœ‰å…³ç³»ï¼Œä¸å¥½æ ‡å‡†åŒ–å¤„ç†","user_name":"ä½œè€…å›å¤","comment_id":338204,"uid":"1167883","ip_address":"","utype":1,"ctime":1651079836,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1647352445","product_id":100079601,"comment_content":"goä¸ºä»€ä¹ˆä¸è®¾è®¡ä¸“ç”¨çš„æ„å»ºå·¥å…· <br>æŠŠå¸¸è§é€šç”¨çš„ä»»åŠ¡éƒ½é›†æˆäº†","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568248,"discussion_content":"ç¼–è¯‘å·¥å…·ï¼Œä¸å¤ªé€‚åˆé›†æˆå¤ªå¤šè¿™ç±»åŠŸèƒ½ã€‚\n\nè€Œä¸”è¿™ç±»åŠŸèƒ½å…·ä½“å®ç°ä¹Ÿè·Ÿé¡¹ç›®æœ‰å…³ç³»ï¼Œä¸å¥½æ ‡å‡†åŒ–å¤„ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651079836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336468,"user_name":"CSB22","can_delete":false,"product_type":"c1","uid":2084707,"ip_address":"","ucode":"D66335E41D3025","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/63/23db516f.jpg","comment_is_top":false,"comment_ctime":1646179985,"is_pvip":true,"replies":[{"id":"123431","content":"æš‚æ—¶æ²¡æœ‰ï¼Œç›´æ¥ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å…¶å®ä¹Ÿæ²¡å•¥é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":336468,"uid":"1167883","ip_address":"","utype":1,"ctime":1647038675,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1646179985","product_id":100079601,"comment_content":"æ‚¨æœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„makefile editoræ¨èä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555691,"discussion_content":"æš‚æ—¶æ²¡æœ‰ï¼Œç›´æ¥ç”¨ç¼–è¾‘å™¨ç¼–è¾‘å…¶å®ä¹Ÿæ²¡å•¥é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647038675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333840,"user_name":"å¤å¿ƒC.J","can_delete":false,"product_type":"c1","uid":2909700,"ip_address":"","ucode":"1EC503C737724C","user_header":"https://static001.geekbang.org/account/avatar/00/2c/66/04/1919d4b4.jpg","comment_is_top":false,"comment_ctime":1644560724,"is_pvip":false,"replies":[{"id":"123448","content":"ä¸ä¼šçš„","user_name":"ä½œè€…å›å¤","comment_id":333840,"uid":"1167883","ip_address":"","utype":1,"ctime":1647039615,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1644560724","product_id":100079601,"comment_content":"$*æ˜¯æŒ‡ç¤ºç›®æ ‡æ¨¡å¼ä¸­ % åŠå…¶ä¹‹å‰çš„éƒ¨åˆ†ï¼Œä¸æ˜¯æŒ‡ä»£è¢«åŒ¹é…çš„å€¼swaggerã€mockgenå§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555708,"discussion_content":"ä¸ä¼šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647039615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333476,"user_name":"yangchnet","can_delete":false,"product_type":"c1","uid":1805922,"ip_address":"","ucode":"0527DE4777A5DB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/8e/62/5cb377fd.jpg","comment_is_top":false,"comment_ctime":1644377551,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644377551","product_id":100079601,"comment_content":"ç¬¬äºŒéäº†ï¼Œè¶Šè¯»è¶Šè§‰å¾—æ€»ç»“çš„åˆ°ä½ç²¾è¾Ÿã€‚","like_count":0},{"had_liked":false,"id":332409,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1643210826,"is_pvip":false,"replies":[{"id":"121557","content":"winä¸Šæ²¡è¯•è¿‡ï¼Œä½ å¯ä»¥è°ƒç ”ä¸‹æ€ä¹ˆæã€‚è¿™ä¸ªè¯¾ç¨‹å…¨éƒ½æ˜¯åœ¨Linuxä¸Šæçš„","user_name":"ä½œè€…å›å¤","comment_id":332409,"uid":"1167883","ip_address":"","utype":1,"ctime":1643454989,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1643210826","product_id":100079601,"comment_content":"winä¸Šæ²¡æœ‰makeå‘½ä»¤ è€å¸ˆä½ çš„å¼€å‘ç¯å¢ƒæ˜¯linuxæˆ–è€…macä¹ˆ winä¸Šæ€ä¹ˆæmake","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548950,"discussion_content":"winä¸Šæ²¡è¯•è¿‡ï¼Œä½ å¯ä»¥è°ƒç ”ä¸‹æ€ä¹ˆæã€‚è¿™ä¸ªè¯¾ç¨‹å…¨éƒ½æ˜¯åœ¨Linuxä¸Šæçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643454989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318334,"user_name":"å…”å˜Ÿå˜Ÿ","can_delete":false,"product_type":"c1","uid":2028811,"ip_address":"","ucode":"5A9042B4C7670C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/0b/73628618.jpg","comment_is_top":false,"comment_ctime":1635247052,"is_pvip":false,"replies":[{"id":"115975","content":"æˆ‘æ„Ÿè§‰Makefileæ²¡è¿‡æ—¶ï¼Œkubernetesç­‰å¤§å‹é¡¹ç›®éƒ½æ˜¯ç”¨çš„Makefileã€‚<br><br>MakefileåŠŸèƒ½å¼ºå¤§ï¼Œåº”å¯¹è¶…å¤§å‹çš„é¡¹ç›®éƒ½æ²¡é—®é¢˜ï¼Œå¯¹äºä¸€èˆ¬çš„é¡¹ç›®æ›´ä¸æ˜¯ç“¶é¢ˆäº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":318334,"uid":"1167883","ip_address":"","utype":1,"ctime":1636004927,"user_name_real":"å­”ä»¤é£"}],"discussion_count":1,"race_medal":0,"score":"1635247052","product_id":100079601,"comment_content":"è¯·é—®è€å¸ˆå¦‚ä½•çœ‹å¾…Makefileå·²è¿‡æ—¶çš„è¨€è®ºï¼Ÿ<br>åœ¨çŸ¥ä¹ä¸ŠæŸ¥æ‰¾ç›¸å…³èµ„æ–™æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè®¤ä¸ºMakefileè¿‡æ—¶äº†ï¼Œåªéœ€è¦å­¦ä¹ cmakeã€bazelä¹‹ç±»çš„ï¼Œå„ç§è¯´æ³•éƒ½æœ‰ï¼Œç°åœ¨æœ‰ç‚¹æ™•","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529195,"discussion_content":"æˆ‘æ„Ÿè§‰Makefileæ²¡è¿‡æ—¶ï¼Œkubernetesç­‰å¤§å‹é¡¹ç›®éƒ½æ˜¯ç”¨çš„Makefileã€‚\n\nMakefileåŠŸèƒ½å¼ºå¤§ï¼Œåº”å¯¹è¶…å¤§å‹çš„é¡¹ç›®éƒ½æ²¡é—®é¢˜ï¼Œå¯¹äºä¸€èˆ¬çš„é¡¹ç›®æ›´ä¸æ˜¯ç“¶é¢ˆäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636004927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316170,"user_name":"ggchangan","can_delete":false,"product_type":"c1","uid":1093094,"ip_address":"","ucode":"C742135C2F45F7","user_header":"https://static001.geekbang.org/account/avatar/00/10/ad/e6/bf43ee14.jpg","comment_is_top":false,"comment_ctime":1634189846,"is_pvip":false,"replies":[{"id":"114934","content":"è°ƒç ”äº†ä¸‹ï¼Œå½“å‰åº”è¯¥æ²¡æœ‰è¿™ç±»å·¥å…·ã€‚å¦‚æœä½ äº†è§£æœ‰ï¼Œæ¬¢è¿è¯„è®ºåŒºåˆ†äº«ã€‚","user_name":"ä½œè€…å›å¤","comment_id":316170,"uid":"1167883","ip_address":"","utype":1,"ctime":1634742290,"user_name_real":"å­”ä»¤é£"}],"discussion_count":1,"race_medal":0,"score":"1634189846","product_id":100079601,"comment_content":"è€å¸ˆçš„è¯¾ç¨‹çœŸæ˜¯è¶…å€¼ï¼Œç‰¹åˆ«æ„Ÿè°¢ï¼æœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸‹ï¼Œæ€ä¹ˆè‡ªåŠ¨ç”ŸæˆåŸºäºsuiteçš„æµ‹è¯•ä»£ç å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528291,"discussion_content":"è°ƒç ”äº†ä¸‹ï¼Œå½“å‰åº”è¯¥æ²¡æœ‰è¿™ç±»å·¥å…·ã€‚å¦‚æœä½ äº†è§£æœ‰ï¼Œæ¬¢è¿è¯„è®ºåŒºåˆ†äº«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634742290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313404,"user_name":"Daiver","can_delete":false,"product_type":"c1","uid":1466447,"ip_address":"","ucode":"9B1A03AFBC79BC","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","comment_is_top":false,"comment_ctime":1632410272,"is_pvip":false,"replies":[{"id":"113662","content":"ä¹Ÿæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œiamä¸­å¾ˆå¤šéƒ½æ˜¯é€šè¿‡å·¥å…·æ¥æçš„","user_name":"ä½œè€…å›å¤","comment_id":313404,"uid":"1167883","ip_address":"","utype":1,"ctime":1632757545,"user_name_real":"CK1.0"}],"discussion_count":2,"race_medal":0,"score":"1632410272","product_id":100079601,"comment_content":"è€å¸ˆï¼Œçœ‹åˆ°iamé¡¹ç›®ä¸‹é¢çš„license æ–‡ä»¶ä¸­æ·»åŠ äº†å…¶ä»–åº“çš„è¯´æ˜ï¼Œè¿™ä¸ªæ˜¯æ‰‹åŠ¨åŠ ä¸Šå»çš„å—","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527339,"discussion_content":"ä¹Ÿæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œiamä¸­å¾ˆå¤šéƒ½æ˜¯é€šè¿‡å·¥å…·æ¥æçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632757545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1466447,"avatar":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","nickname":"Daiver","note":"","ucode":"9B1A03AFBC79BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398342,"discussion_content":"è¿™ä¸ªå·¥å…·å«å•¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632758301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306401,"user_name":"Sch0ng","can_delete":false,"product_type":"c1","uid":1145554,"ip_address":"","ucode":"73F6113931B1AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg","comment_is_top":false,"comment_ctime":1628526104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628526104","product_id":100079601,"comment_content":"ä½¿ç”¨Makefileå¯ä»¥é«˜æ•ˆç®¡ç†goé¡¹ç›®ã€‚","like_count":0},{"had_liked":false,"id":299791,"user_name":"Tiandh","can_delete":false,"product_type":"c1","uid":1114508,"ip_address":"","ucode":"581C14BAE84AE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/8c/41adb537.jpg","comment_is_top":false,"comment_ctime":1624862448,"is_pvip":false,"replies":[{"id":"108754","content":"è¿™ä¸ªå‘½ä»¤ç›®å‰è¿˜åªæ˜¯ä¸ªå ä½ç¬¦ï¼Œä¸å»ºè®®ç”¨ã€‚åº•å±‚ä»£ç å·²å®ç°ï¼Œä½†è¿˜æ²¡æµ‹è¯•ï¼Œåç»­ä¼šè¡¥ä¸Š","user_name":"ä½œè€…å›å¤","comment_id":299791,"uid":"1167883","ip_address":"","utype":1,"ctime":1624930050,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"1624862448","product_id":100079601,"comment_content":"[going@dev iam]$ make install<br>make[1]: *** No rule to make target &#39;install.install&#39;.  Stop.<br>make: *** [Makefile:154: install] Error 2<br>[going@dev iam]$ ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522544,"discussion_content":"è¿™ä¸ªå‘½ä»¤ç›®å‰è¿˜åªæ˜¯ä¸ªå ä½ç¬¦ï¼Œä¸å»ºè®®ç”¨ã€‚åº•å±‚ä»£ç å·²å®ç°ï¼Œä½†è¿˜æ²¡æµ‹è¯•ï¼Œåç»­ä¼šè¡¥ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624930050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299563,"user_name":"éª‘èœ—ç‰›çš„å‹‡å£«","can_delete":false,"product_type":"c1","uid":1143338,"ip_address":"","ucode":"2702AEEA14BC4F","user_header":"https://static001.geekbang.org/account/avatar/00/11/72/2a/c4042a20.jpg","comment_is_top":false,"comment_ctime":1624712524,"is_pvip":false,"replies":[{"id":"108648","content":"è¿”å›çš„æ˜¯å·²ç»åˆå§‹åŒ–å¥½çš„å®ä¾‹","user_name":"ä½œè€…å›å¤","comment_id":299563,"uid":"1167883","ip_address":"","utype":1,"ctime":1624760256,"user_name_real":"CK1.0"}],"discussion_count":1,"race_medal":0,"score":"1624712524","product_id":100079601,"comment_content":"çœ‹iamæºç ï¼Œå„åŠŸèƒ½çš„serviceå’Œstoreéƒ½æ˜¯æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè¿™æ ·å¯¹æ€§èƒ½æœ‰å½±å“å—ï¼Œæˆ–è€…æ˜¯æœ‰åˆ«çš„è€ƒè™‘å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522475,"discussion_content":"è¿”å›çš„æ˜¯å·²ç»åˆå§‹åŒ–å¥½çš„å®ä¾‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624760256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}