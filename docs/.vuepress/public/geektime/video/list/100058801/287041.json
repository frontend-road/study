{"id":287041,"title":"23 | Watermark与Window的关系","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":249163,"user_name":"Allan","can_delete":false,"product_type":"c3","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1600488581,"is_pvip":false,"replies":[{"id":93558,"content":"正解","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603844713,"ip_address":"","comment_id":249163,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"12:15的时候减去10i是12:05已经比之前的12:04大了，所以应该更新watermark了。如果进来的时间没有上次watermark的时间大，则不更新watermark并且按照这个eventtime的时间放到对应的时间区间窗口中。","like_count":4,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505854,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603844713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442992,"avatar":"https://static001.geekbang.org/account/avatar/00/16/04/b0/27719251.jpg","nickname":"Tim Qi","note":"","ucode":"61A417DA9A10E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375461,"discussion_content":"如果进来的时间没有上次watermark大，不是应该丢弃吗？没有上次eventtime大-才不更新。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621670283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2028954,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9a/63dc81a2.jpg","nickname":"Geek1185","note":"","ucode":"47BEE492EF4C1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1442992,"avatar":"https://static001.geekbang.org/account/avatar/00/16/04/b0/27719251.jpg","nickname":"Tim Qi","note":"","ucode":"61A417DA9A10E4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392028,"discussion_content":"这老师讲的真的听不懂，是没有之前最大的eventtime大才不更新","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630770489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375461,"ip_address":"","group_id":0},"score":392028,"extra":""},{"author":{"id":2001720,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/8b/38/9992f7bb.jpg","nickname":"黑bai照","note":"","ucode":"C61508005933B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2028954,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9a/63dc81a2.jpg","nickname":"Geek1185","note":"","ucode":"47BEE492EF4C1A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564126,"discussion_content":"这条数据的eventtime是12:15 当前wm是12:04 数据不该丢弃，应该更新wm。但是图里的wm是5min更新一次,5min内来了一条eventtime是12:21的数据。所以wm又变成了12:11 5min到达后 最新的wm是12:11","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650164632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":392028,"ip_address":"","group_id":0},"score":564126,"extra":""}]},{"author":{"id":2153662,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXbxuhFpUq10M3H87WiaE4bbqI5gTtmxfQCZDPUad4KrCJn8NiaPxhask5YSzRyQiaRaEJqaGoax35A/132","nickname":"最烦起名字","note":"","ucode":"405A886940AD46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314092,"discussion_content":"我也关注到12:05这条记录了，课程讲解中，没有更新watermark。请老师给回答下吧~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603116591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254443,"user_name":"最烦起名字","can_delete":false,"product_type":"c3","uid":2153662,"ip_address":"","ucode":"405A886940AD46","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXbxuhFpUq10M3H87WiaE4bbqI5gTtmxfQCZDPUad4KrCJn8NiaPxhask5YSzRyQiaRaEJqaGoax35A/132","comment_is_top":false,"comment_ctime":1603116624,"is_pvip":false,"replies":[{"id":93567,"content":"Watermark更新也要有周期的，所以叫period watermark，通常情况时延为0，Ppt里没有说明这点","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603845284,"ip_address":"","comment_id":254443,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"12:05这条记录了，课程讲解中，没有更新watermark。请老师给回答下吧~","like_count":3,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507398,"discussion_content":"Watermark更新也要有周期的，所以叫period watermark，通常情况时延为0，Ppt里没有说明这点","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603845284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2687232,"avatar":"https://static001.geekbang.org/account/avatar/00/29/01/00/82a864ed.jpg","nickname":"🔥HelloWorld🔥","note":"","ucode":"69F52DB8747F15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":573974,"discussion_content":"老师，那为什么 12:08 的数据更新了 wm 呢？应该可以没到 5min 周期吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653752295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":507398,"ip_address":"","group_id":0},"score":573974,"extra":""}]},{"author":{"id":2348970,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKu91INK055zppBLDjVaNyNaCJZGqKYaZzsy24HD3gic7iaW6Xj7FWHAZ947jAiaYibfJuMU7zEDKeJibg/132","nickname":"Geek_85ee81","note":"","ucode":"04251E1FE43384","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369873,"discussion_content":"就是说有可能来了可以触发窗口的一条记录，比如时间是12:20分的记录，但是由于watermark是有产生间隔的，然后watermark没有更新，导致窗口没有触发，是有这种可能的吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619186208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1100064,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","nickname":"zj","note":"","ucode":"E3329CCF694AC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361788,"discussion_content":"这里的watermark，是周期性的5分钟一更新吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616755943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1283203,"avatar":"https://static001.geekbang.org/account/avatar/00/13/94/83/c551e211.jpg","nickname":"岱芸清","note":"","ucode":"78598792BD7E6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334963,"discussion_content":"老师你好，这里没理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608036879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2153662,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXbxuhFpUq10M3H87WiaE4bbqI5gTtmxfQCZDPUad4KrCJn8NiaPxhask5YSzRyQiaRaEJqaGoax35A/132","nickname":"最烦起名字","note":"","ucode":"405A886940AD46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320600,"discussion_content":"了解了，谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604409561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249063,"user_name":"鱼","can_delete":false,"product_type":"c3","uid":1030615,"ip_address":"","ucode":"6BCC544FF89D9C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b9/d7/fceacbd8.jpg","comment_is_top":false,"comment_ctime":1600418086,"is_pvip":false,"replies":[{"id":91410,"content":"触发计算要需要两个条件：\n1、Watermark是否大于窗口右边界，并触发窗口计算。\n2、该事件的时间在窗口范围以内；\n只要满足以上两个条件就能将该事件纳入到所在窗口中并触发计算，然后输出结果。","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1600482112,"ip_address":"","comment_id":249063,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"假如有一个事件 12:01 cat 在12:02到达的话，这种情况下这条记录不会在12:05-12:15的窗口之内，那么最终的输出应该是什么样的呢？","like_count":1,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505815,"discussion_content":"触发计算要需要两个条件：\n1、Watermark是否大于窗口右边界，并触发窗口计算。\n2、该事件的时间在窗口范围以内；\n只要满足以上两个条件就能将该事件纳入到所在窗口中并触发计算，然后输出结果。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600482112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269849,"user_name":"想","can_delete":false,"product_type":"c3","uid":1750872,"ip_address":"","ucode":"3F7BFC0288C7A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/evOHNGVfmUMclQ2VfBDIicu6otLzibEJG6QNfCz2wuvhqAZXyPibYN15n7YAGWwmygq34tmV1boIFjYnKS6Xv45Bg/132","comment_is_top":false,"comment_ctime":1608809843,"is_pvip":false,"replies":[{"id":98223,"content":"不理解，这种情况一般都是增量计算的，也就是结果值，另外窗口的原始数据只会记录当前窗口的，不属于的或者超时的都会丢弃","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1609242273,"ip_address":"","comment_id":269849,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，我想请教下，每个窗口都包含上个窗口的记录，会导致最后一个窗口的数据记录特别大吧！这个问题有什么机制控制下","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512415,"discussion_content":"不理解，这种情况一般都是增量计算的，也就是结果值，另外窗口的原始数据只会记录当前窗口的，不属于的或者超时的都会丢弃","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609242273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249821,"user_name":"qiufang","can_delete":false,"product_type":"c3","uid":2149430,"ip_address":"","ucode":"822FCE34BDF97E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/vPdGZoRwzVpaXL3oL4ogjqdlt8egaotZCMmwWGZKR0wy3Km2nx7XibYwPeTFDtowN52JBibQNb9KL2zzd2hucicibg/132","comment_is_top":false,"comment_ctime":1600823782,"is_pvip":false,"replies":[{"id":93560,"content":"可以参考后面table接口中temporaral table的使用","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603844886,"ip_address":"","comment_id":249821,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师你好，我们这边有个场景，用flink消费一张表，每来一条数据，需要关联维表，进行数据转换。这个维表数据量比较大，更新不是频繁，flink 表可以直接关联关系型数据库中这张维表吗，或者有没有更好的实现方式。","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506026,"discussion_content":"可以参考后面table接口中temporaral table的使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603844886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000638,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/be/4d7169cf.jpg","nickname":"Sean","note":"","ucode":"AE5ACABB7FBC3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308207,"discussion_content":"我这边也有类似的场景，从MQ中每来一条数据，需要根据这一条数据从数据库中查出大量数据，来做计算。不知道该怎么实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600869334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282763,"user_name":"danvid","can_delete":false,"product_type":"c3","uid":1270415,"ip_address":"","ucode":"84C50611B1DEA5","user_header":"https://static001.geekbang.org/account/avatar/00/13/62/8f/c0f40d98.jpg","comment_is_top":false,"comment_ctime":1615390100,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"12:15这个消息，没有触发watermark更新，老师你讲错了吧","like_count":16,"discussions":[{"author":{"id":1046152,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/88/ee32fde9.jpg","nickname":"章光辉","note":"","ucode":"49ACA750CAF19E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382516,"discussion_content":"翻了很下面的评论，老师说这是 period watermark...这么重要的前置条件没说明，很影响读者理解","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1625622447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1620299,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b9/4b/2376a469.jpg","nickname":"DN","note":"","ucode":"74BC2FB01FB89E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592339,"discussion_content":"老师自己讲了会触发更新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667315765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442992,"avatar":"https://static001.geekbang.org/account/avatar/00/16/04/b0/27719251.jpg","nickname":"Tim Qi","note":"","ucode":"61A417DA9A10E4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375458,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621669992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288494,"user_name":"桂林","can_delete":false,"product_type":"c3","uid":1117548,"ip_address":"","ucode":"95906EF7338C48","user_header":"https://static001.geekbang.org/account/avatar/00/11/0d/6c/cb52f6f7.jpg","comment_is_top":false,"comment_ctime":1618491739,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"看明白了，这个图中的watermark是每5分钟更新一次。12:15的数据进来时，没到更新时间，所以watermark不变，还是12:04。processingTime为12:20时，12:15-12:20这个processingTime时间窗口里因为进来了一条12:21,owl的数据，所以更新watermark为12:11。12:26,owl这条数据进来时要等到processingTime为12:25时，更新watermark，并计算12:05-12:15的窗口数据","like_count":5,"discussions":[{"author":{"id":1620299,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b9/4b/2376a469.jpg","nickname":"DN","note":"","ucode":"74BC2FB01FB89E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592341,"discussion_content":"这个图本身就有挺大的问题，在 12:21这个点，右图中的 event time 竟然小于 process time","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667315999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2892249,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/21/d9/86382523.jpg","nickname":"杨晓燕","note":"","ucode":"F74D592F68F0DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583283,"discussion_content":"11:58，老师的左侧列表，不应该有11:57的watermark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660012026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2892249,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/21/d9/86382523.jpg","nickname":"杨晓燕","note":"","ucode":"F74D592F68F0DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583282,"discussion_content":"那是不是也不应该有12:07的watermark，应该那个是12:08watermark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660011968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362086,"user_name":"Geek_7825d4","can_delete":false,"product_type":"c3","uid":1520056,"ip_address":"中国香港","ucode":"F1A22F22FAE723","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK8qkY7FUvM17qTNadTAWzWgHtJTmnduMiaqNXJnJia0ffnpc5v6ToC139SI4FUb226eCQmBTBQzUMw/132","comment_is_top":false,"comment_ctime":1668139316,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老实讲的透彻, 似乎自己也没特别明白","like_count":2},{"had_liked":false,"id":312141,"user_name":"偶尔复活下","can_delete":false,"product_type":"c3","uid":1018685,"ip_address":"","ucode":"18B1D525CD50D3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8b/3d/0c3a2fd4.jpg","comment_is_top":false,"comment_ctime":1631660021,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"看明白了，左右两个图要结合起来看。\n\n右图中的watermark更新设定是每5分钟更新一次（ppt里没说明，是period wm）。\n\n事件时间为12:15的数据进来时（处理时间大约是12:19分），还没到period wm的更新时间（更新时间是12:20），所以watermark不变，还是12:04。\n\nprocessingTime为12:20时，12:15-12:20这个processingTime时间窗口里因为进来了一条事件时间为12:21,owl的数据，所以更新watermark为12:11。\n\n12:26,owl这条数据进来时要等到processingTime为12:25时，才会更新watermark，并计算12:05-12:15的窗口数据","like_count":2,"discussions":[{"author":{"id":3553421,"avatar":"","nickname":"Geek_3360b0","note":"","ucode":"8E16877BCD71EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":617016,"discussion_content":"那为啥 12:07 更新 wm，12:08 也更新 wm？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683266917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360217,"user_name":"sonald","can_delete":false,"product_type":"c3","uid":1028090,"ip_address":"北京","ucode":"BBE5F144978952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/af/fa/5714677b.jpg","comment_is_top":false,"comment_ctime":1666311545,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"这个图好像是spark官网的？","like_count":1},{"had_liked":false,"id":301852,"user_name":"CycleGAN","can_delete":false,"product_type":"c3","uid":1679661,"ip_address":"","ucode":"9FD04813911A02","user_header":"https://static001.geekbang.org/account/avatar/00/19/a1/2d/599e9051.jpg","comment_is_top":false,"comment_ctime":1625915057,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"图中有几个问题\n1.appen模式中，出现了事件时间大于处理时间的现象，说明时间没对齐，也是可能的，那么在最后一个曲线图中，曲线也可能在虚线以下的。\n2.append模式中，看分析原来是水印5min更新，一直感觉在20时间点就能触发00-10的计算了，猜测是到了20，检测了水印，还是04不是11，所以没触发，等检测完不用计算后，才将水印更新为11吗","like_count":1,"discussions":[{"author":{"id":1364034,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d0/42/6fd01fb9.jpg","nickname":"我已经设置了昵称","note":"","ucode":"ED672C5EBDBDC4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406174,"discussion_content":"应该是先比较，再更新。先判断了wm是否大于右边界，04<10, 再去更新04->11,到下一个5分钟又开始比较vm,11>10才触发计算。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634717245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290497,"user_name":"W.H","can_delete":false,"product_type":"c3","uid":2571103,"ip_address":"","ucode":"762928FB4A4882","user_header":"https://static001.geekbang.org/account/avatar/00/27/3b/5f/85b2fd6f.jpg","comment_is_top":false,"comment_ctime":1619591449,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"老师您好，我有个疑问，针对窗口的Update模式，为什么在水印还没大于窗口边界的时候就触发了窗口的计算了；比如在processTime在12:15分时，水印更新为12:04；这时却已经开始计算了12:00-12:10的窗口内容和12:05-12:15，12:10-12:20的窗口结果了呀？这里不解，请老师解答！十分感激！","like_count":1},{"had_liked":false,"id":280712,"user_name":"Allan","can_delete":false,"product_type":"c3","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1614324911,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"watermark自身没有太大意义，只有与window才会产生价值。之前看过一遍没感觉到啥，今天再看第二遍这个watermark图有好多疑问越看越糊涂，咱们是10分钟的窗口，5分钟滑动一次。我看了很久这个图，可能转牛角尖了，现在想了想理解一下。我们窗口是10分钟，5分钟触发计算一次，五分钟到了不是真正的触发了，而是要等到watermark更新了才会触发上一次窗口。比如：0-10窗口是在12:21数据达到后，watermark时间11&gt;10触发了一次窗口计算，而此时processtime已经是12:20。那么图中12:05-12:15多会儿触发呢，本应该10 五分钟一次计算，但是watermark没有大于15的所以没有触发计算，至于途中计算的结果都是假设的后面的数据有watermark大于窗口最大时间从而触发算的结果。","like_count":1},{"had_liked":false,"id":389883,"user_name":"Geek_ea3747","can_delete":false,"product_type":"c3","uid":2027802,"ip_address":"江苏","ucode":"22C908580C0925","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f1/1a/b1de30c8.jpg","comment_is_top":false,"comment_ctime":1713772464,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"没有新的数据产生了，12:15之后的数据就无法继续参与计算了？","like_count":0},{"had_liked":false,"id":387046,"user_name":"Geek_dd0edd","can_delete":false,"product_type":"c3","uid":2856093,"ip_address":"加拿大","ucode":"CCB51F3132268C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er23qJbxVLUdcibHiccibSKsz5Mp0Hrw3ic7XA37VwZBJv4yfW4xqiaSCIIK8oHQ0JT0BRbokfptGLcwKA/132","comment_is_top":false,"comment_ctime":1706271498,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"始终都没有理解为什么12:15的eventtime的watermark不是12.05","like_count":0},{"had_liked":false,"id":383730,"user_name":"亚林","can_delete":false,"product_type":"c3","uid":1018972,"ip_address":"广东","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1699522493,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"看原文看懂了。\nhttps:&#47;&#47;spark.apache.org&#47;docs&#47;latest&#47;structured-streaming-programming-guide.html#handling-late-data-and-watermarking","like_count":0},{"had_liked":false,"id":383723,"user_name":"亚林","can_delete":false,"product_type":"c3","uid":1018972,"ip_address":"广东","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1699518426,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"https:&#47;&#47;spark.apache.org&#47;docs&#47;latest&#47;structured-streaming-programming-guide.html","like_count":0},{"had_liked":false,"id":367198,"user_name":"Geek_23e1e5","can_delete":false,"product_type":"c3","uid":1702570,"ip_address":"广东","ucode":"CD051334954DFA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/HRazkg5nEVh63WwB0VEtB9I89qOhibs9j9iaR1VicWVOAj99VMJz6uctow6SMpywQcCnkGshd05XKn1ebbn8yzxAw/132","comment_is_top":false,"comment_ctime":1675006548,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"老师，12点15那条数据我弄明白了，但是这个图是不是有问题，event time12点21那条数据的processing time 怎么会比12点20还早？","like_count":0},{"had_liked":false,"id":359984,"user_name":"MoFanDon","can_delete":false,"product_type":"c3","uid":1053363,"ip_address":"广东","ucode":"F8A9D26EA0171D","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/b3/9e8f4b4f.jpg","comment_is_top":false,"comment_ctime":1666097804,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"1. 横轴是processtime，processtime每隔5mins 触发一次生产 wm\n2. wm = eventtime -10 ，这里的10 是指允许数据乱序的最大时间 BoundedOutOfOrdernessTimestampExtractor\n3. 一般来说 eventtime &lt; processtime ，所以数据聚合延时 &gt; 允许数据乱序的最大时间","like_count":0},{"had_liked":false,"id":357107,"user_name":"骚动","can_delete":false,"product_type":"c3","uid":2280216,"ip_address":"北京","ucode":"EBEBF417C866D4","user_header":"https://static001.geekbang.org/account/avatar/00/22/cb/18/0139e086.jpg","comment_is_top":false,"comment_ctime":1662965274,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"- 12:09,cat小于之前的最大事件时间，不更新watermark\n- 12:15,cat小于更新周期，这时的wm为12:05，与12:04间隔没有超过更新周期，不更新\n- 12:21,owl的wm为12:11，wm时间大于12:00—12：10窗口的右边界，触发12:00—12：10窗口的统计操作\n- 12:26,owl的wm为12:16, wm时间大于12:05—12：15窗口的右边界，触发12:05—12：15窗口的统计操作\n- 12:04和12:09均是迟到事件，在触发窗口操作时，不会纳入计算","like_count":0},{"had_liked":false,"id":337617,"user_name":"任继连","can_delete":false,"product_type":"c3","uid":1835028,"ip_address":"","ucode":"B92A64FD1A9E2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/liag8rgxjhSdk4VNpd6IeHricw2xKGicFIsiavZIZZTETib2XZYhibmTsuEeX0XtZ3pKHDBxvV7COktl2ibA1M5ntZ0OA/132","comment_is_top":false,"comment_ctime":1646917868,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"明明没有更新","like_count":0},{"had_liked":false,"id":332217,"user_name":"1011001","can_delete":false,"product_type":"c3","uid":1573301,"ip_address":"","ucode":"8658491E9386FB","user_header":"https://static001.geekbang.org/account/avatar/00/18/01/b5/3fd2a38d.jpg","comment_is_top":false,"comment_ctime":1643098477,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"event time和window的对应关系没看太懂 为啥12：14那条消息不是在12：05~12：15那个窗口 而是在12：10~12：20那个窗口","like_count":0},{"had_liked":false,"id":298870,"user_name":"卡洛梅特","can_delete":false,"product_type":"c3","uid":1234998,"ip_address":"","ucode":"A9997083BF684A","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/36/badf4003.jpg","comment_is_top":false,"comment_ctime":1624352564,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"这里的窗口时间是如何产生的，是机器每10分钟产生一个，还是设定开始时间，可以直接就创建好窗口的，数据在哪个窗口是以事件时间还是到达时间","like_count":0},{"had_liked":false,"id":298684,"user_name":"卡洛梅特","can_delete":false,"product_type":"c3","uid":1234998,"ip_address":"","ucode":"A9997083BF684A","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/36/badf4003.jpg","comment_is_top":false,"comment_ctime":1624262679,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"进来的时间&gt;之前的时间 : 更新WM，进入窗口中\n之前的时间&gt;进来的时间&gt;=WM ： 不更新，进入窗口中，\n触发更新后的WM &gt; 窗口边界：统计窗口","like_count":0},{"had_liked":false,"id":287237,"user_name":"Geek_xiaotudou","can_delete":false,"product_type":"c3","uid":1993907,"ip_address":"","ucode":"47BC3FFD6CBEC3","user_header":"","comment_is_top":false,"comment_ctime":1617851183,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"event_time为12:21的事件，processing_time 是12:19？希望老师重点讲讲period watermark的更新机制 ","like_count":0},{"had_liked":false,"id":285369,"user_name":"zj","can_delete":false,"product_type":"c3","uid":1100064,"ip_address":"","ucode":"E3329CCF694AC2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","comment_is_top":false,"comment_ctime":1616755909,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"老师讲的这个watermark应该是也是5分钟一更新吧","like_count":0},{"had_liked":false,"id":275467,"user_name":"Wesley","can_delete":false,"product_type":"c3","uid":1359325,"ip_address":"","ucode":"187A0185A2D3FD","user_header":"https://static001.geekbang.org/account/avatar/00/14/bd/dd/4620ba79.jpg","comment_is_top":false,"comment_ctime":1611553848,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"第一个window的开始结束时间点是如何计算出来的？","like_count":0},{"had_liked":false,"id":270388,"user_name":"旭东(Frank)","can_delete":false,"product_type":"c3","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1609112668,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"比如是5分钟的统计，都是1-5分钟[0,6)","like_count":0},{"had_liked":false,"id":270387,"user_name":"旭东(Frank)","can_delete":false,"product_type":"c3","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1609112582,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"窗口开始时间是则么设定了","like_count":0},{"had_liked":false,"id":264201,"user_name":"cqfan12","can_delete":false,"product_type":"c3","uid":2288789,"ip_address":"","ucode":"24E3417A64E74C","user_header":"","comment_is_top":false,"comment_ctime":1606378610,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100058801,"comment_content":"Update模式举例中触发窗口计算的条件也是Watermark是否大于窗口右边界吗？还是说每处理时间5min触发时，也触发各窗口计算呢？看图标Result Table像是后者？","like_count":0,"discussions":[{"author":{"id":1234998,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d8/36/badf4003.jpg","nickname":"卡洛梅特","note":"","ucode":"A9997083BF684A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380130,"discussion_content":"我也在疑惑这问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624352195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249267,"user_name":"Geek_89b737","can_delete":false,"product_type":"c3","uid":2149763,"ip_address":"","ucode":"9DE397277404C4","user_header":"","comment_is_top":false,"comment_ctime":1600533155,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100058801,"comment_content":"不错，wartermark 单调增","like_count":0},{"had_liked":false,"id":249164,"user_name":"Allan","can_delete":false,"product_type":"c3","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1600488982,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100058801,"comment_content":"老师，我想用processFunction做延迟操作，比如让这条数据5分钟以后执行。我这边设置eventtime，然后watermark一秒，没有窗口，直接process，目前的问题是，我在process中ctx.timestamp()时候总是空指针。搞得有点费劲儿","like_count":0}]}