{"id":98374,"title":"19 | ç»¼åˆæ¡ˆä¾‹å®æˆ˜ï¼šå¤„ç†åŠ å·æˆ¿å±‹ä¿¡æ¯ï¼Œæ„å»ºçº¿æ€§å›å½’æ¨¡å‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è”¡å…ƒæ¥ ã€‚</p><p>ä»Šå¤©æˆ‘è¦ä¸ä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯â€œç»¼åˆæ¡ˆä¾‹å®æˆ˜ï¼šå¤„ç†åŠ å·æˆ¿å±‹ä¿¡æ¯ï¼Œæ„å»ºçº¿æ€§å›å½’æ¨¡å‹â€ã€‚</p><p>é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹Sparkå„ç§APIçš„åŸºæœ¬ç”¨æ³•æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œè¿˜é€šè¿‡ç»Ÿè®¡è¯é¢‘çš„å®ä¾‹æŒæ¡äº†å¦‚ä½•ä»é›¶å¼€å§‹å†™ä¸€ä¸ªSparkç¨‹åºã€‚é‚£ä¹ˆç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªçœŸå®çš„æ•°æ®é›†å‡ºå‘ï¼Œçœ‹çœ‹å¦‚ä½•ç”¨Sparkè§£å†³å®é™…é—®é¢˜ã€‚</p><h2>æ•°æ®é›†ä»‹ç»</h2><p>ä¸ºäº†å®Œæˆä»Šå¤©çš„ç»¼åˆæ¡ˆä¾‹å®æˆ˜ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ç¾å›½åŠ å·1990å¹´æˆ¿å±‹æ™®æŸ¥çš„æ•°æ®é›†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a9/5c/a9c1d749f2d1c43261a043aa77056f5c.png?wh=1142*593\" alt=\"\"></p><p>æ•°æ®é›†ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®éƒ½ä»£è¡¨ç€ä¸€å—åŒºåŸŸå†…æˆ¿å±‹å’Œäººå£çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ€»å…±åŒ…æ‹¬9é¡¹ï¼š</p><ol>\n<li>è¯¥åœ°åŒºä¸­å¿ƒçš„çº¬åº¦ï¼ˆlatitudeï¼‰</li>\n<li>è¯¥åœ°åŒºä¸­å¿ƒçš„ç»åº¦ï¼ˆlongitudeï¼‰</li>\n<li>åŒºåŸŸå†…æ‰€æœ‰æˆ¿å±‹å±‹é¾„çš„ä¸­ä½æ•°ï¼ˆhousingMedianAgeï¼‰</li>\n<li>åŒºåŸŸå†…æ€»æˆ¿é—´æ•°ï¼ˆtotalRoomsï¼‰</li>\n<li>åŒºåŸŸå†…æ€»å§å®¤æ•°ï¼ˆtotalBedroomsï¼‰</li>\n<li>åŒºåŸŸå†…æ€»äººå£æ•°ï¼ˆpopulationï¼‰</li>\n<li>åŒºåŸŸå†…æ€»å®¶åº­æ•°ï¼ˆhouseholdsï¼‰</li>\n<li>åŒºåŸŸå†…äººå‡æ”¶å…¥ä¸­ä½æ•°ï¼ˆmedianIncomeï¼‰</li>\n<li>è¯¥åŒºåŸŸæˆ¿ä»·çš„ä¸­ä½æ•°ï¼ˆmedianHouseValueï¼‰</li>\n</ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ªæ•°æ®çœ‹ä½œä¸€ä¸ªåœ°åŒºï¼Œå®ƒå«æœ‰9é¡¹æˆ‘ä»¬å…³å¿ƒçš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„9ä¸ªæŒ‡æ ‡ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ•°æ®ï¼š</p><pre><code>-122.230000,37.880000,41.000000,880.000000,129.000000,322.000000,126.000000,8.325200,452600.000000'\n</code></pre><p>è¿™ä¸ªæ•°æ®ä»£è¡¨è¯¥åœ°åŒºçš„ç»çº¬åº¦æ˜¯ï¼ˆ-122.230000,37.880000ï¼‰ï¼Œè¿™ä¸ªåœ°åŒºæˆ¿å±‹å†å²çš„ä¸­ä½æ•°æ˜¯41å¹´ï¼Œæ‰€æœ‰æˆ¿å±‹æ€»å…±æœ‰880ä¸ªæˆ¿é—´ï¼Œå…¶ä¸­æœ‰129ä¸ªå§å®¤ã€‚è¿™ä¸ªåœ°åŒºå†…å…±æœ‰126ä¸ªå®¶åº­å’Œ322ä½å±…æ°‘ï¼Œäººå‡æ”¶å…¥ä¸­ä½æ•°æ˜¯8.3252ä¸‡ï¼Œæˆ¿ä»·ä¸­ä½æ•°æ˜¯45.26ä¸‡ã€‚</p><!-- [[[read_end]]] --><p>è¿™é‡Œçš„åœ°åŸŸå•ä½æ˜¯ç¾å›½åšäººå£æ™®æŸ¥çš„æœ€å°åœ°åŸŸå•ä½ï¼Œå¹³å‡ä¸€ä¸ªåœ°åŸŸå•ä½ä¸­æœ‰1400å¤šäººã€‚åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­å…±æœ‰ä¸¤ä¸‡å¤šä¸ªè¿™æ ·çš„æ•°æ®ã€‚æ˜¾ç„¶ï¼Œè¿™æ ·å°çš„æ•°æ®é‡æˆ‘ä»¬å¹¶â€œä¸éœ€è¦â€ç”¨Sparkæ¥å¤„ç†ï¼Œä½†æ˜¯ï¼Œå®ƒå¯ä»¥èµ·åˆ°ä¸€ä¸ªå¾ˆå¥½çš„ç¤ºä¾‹ä½œç”¨ã€‚è¿™ä¸ªæ•°æ®é›†å¯ä»¥ä»<a href=\"http://www.dcc.fc.up.pt/~ltorgo/Regression/cal_housing.html\">ç½‘ä¸Š</a>ä¸‹è½½åˆ°ã€‚è¿™ä¸ªæ•°æ®é›†æ˜¯åœ¨1997å¹´çš„ä¸€ç¯‡å­¦æœ¯è®ºæ–‡ä¸­åˆ›å»ºçš„ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»äº²è‡ªä¸‹è½½ï¼Œå¹¶åŠ ä»¥å®è·µã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä»Šå¤©çš„ç›®æ ‡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯ç”¨å·²æœ‰çš„æ•°æ®ï¼Œæ„å»ºä¸€ä¸ª<strong>çº¿æ€§å›å½’æ¨¡å‹</strong>ï¼Œæ¥é¢„æµ‹æˆ¿ä»·ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‰8ä¸ªå±æ€§éƒ½å¯èƒ½å¯¹æˆ¿ä»·æœ‰å½±å“ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾è¿™ç§å½±å“æ˜¯çº¿æ€§çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼<strong>A=b<em>B+c</em>C+d<em>D+â€¦+i</em>I</strong>çš„å…¬å¼ï¼ŒAä»£è¡¨æˆ¿ä»·ï¼ŒBåˆ°Iåˆ†åˆ«ä»£è¡¨å¦å¤–å…«ä¸ªå±æ€§ã€‚è¿™æ ·ï¼Œå¯¹äºä¸åœ¨æ•°æ®é›†ä¸­çš„æˆ¿å­ï¼Œæˆ‘ä»¬å¯ä»¥å¥—ç”¨è¿™ä¸ªå…¬å¼æ¥è®¡ç®—å‡ºä¸€ä¸ªè¿‘ä¼¼çš„æˆ¿ä»·ã€‚ç”±äºä¸“æ çš„å®šä½æ˜¯å¤§è§„æ¨¡æ•°æ®å¤„ç†ä¸“æ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šç»†è®²ç»Ÿè®¡å­¦çš„çŸ¥è¯†ã€‚å¦‚æœä½ å¯¹ç»Ÿè®¡å­¦çŸ¥è¯†æ„Ÿå…´è¶£ï¼Œæˆ–è€…è¿˜ä¸ç†è§£ä»€ä¹ˆæ˜¯çº¿æ€§å›å½’çš„è¯ï¼Œå¯ä»¥å»è‡ªè¡Œå­¦ä¹ ä¸€ä¸‹ã€‚</p><h2>è¿›ä¸€æ­¥äº†è§£æ•°æ®é›†</h2><p>æ¯å½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªæ•°æ®é›†è¿›è¡Œå¤„ç†æ—¶ï¼Œä¸è¦æ€¥ç€å†™ä»£ç ã€‚ä½ ä¸€å®šè¦å…ˆè§‚å¯Ÿæ•°æ®é›†ï¼Œäº†è§£å®ƒçš„ç‰¹æ€§ï¼Œå¹¶å°è¯•å¯¹å®ƒåšä¸€äº›ç®€å•çš„é¢„å¤„ç†ï¼Œè®©æ•°æ®çš„å¯è¯»æ€§æ›´å¥½ã€‚è¿™äº›å·¥ä½œæˆ‘ä»¬æœ€å¥½åœ¨Sparkçš„äº¤äº’å¼Shellä¸Šå®Œæˆï¼Œè€Œä¸æ˜¯åˆ›å»ºpythonçš„æºæ–‡ä»¶å¹¶æ‰§è¡Œã€‚å› ä¸ºï¼Œåœ¨Shellä¸Šæˆ‘ä»¬å¯ä»¥éå¸¸ç›´è§‚è€Œç®€ä¾¿åœ°çœ‹åˆ°æ¯ä¸€æ­¥çš„è¾“å‡ºã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æŠŠæ•°æ®é›†è¯»å…¥Sparkã€‚</p><pre><code>from pyspark.sql import SparkSession\n\n# åˆå§‹åŒ–SparkSessionå’ŒSparkContext\nspark = SparkSession.builder\n  .master(&quot;local&quot;)\n  .appName(&quot;California Housing &quot;)\n  .config(&quot;spark.executor.memory&quot;, &quot;1gb&quot;)\n  .getOrCreate()\nsc = spark.sparkContext\n\n# è¯»å–æ•°æ®å¹¶åˆ›å»ºRDD\nrdd = sc.textFile('/Users/yourName/Downloads/CaliforniaHousing/cal_housing.data')\n\n# è¯»å–æ•°æ®æ¯ä¸ªå±æ€§çš„å®šä¹‰å¹¶åˆ›å»ºRDD\nheader = sc.textFile('/Users/yourName/Downloads/CaliforniaHousing/cal_housing.domain')\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠæˆ¿å±‹ä¿¡æ¯æ•°æ®å’Œæ¯ä¸ªå±æ€§çš„å®šä¹‰è¯»å…¥äº†Sparkï¼Œå¹¶åˆ›å»ºäº†ä¸¤ä¸ªç›¸åº”çš„RDDã€‚ä½ è¿˜è®°å¾—å§ï¼ŸRDDæ˜¯æœ‰ä¸€ä¸ªæƒ°æ€§æ±‚å€¼çš„ç‰¹æ€§çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨collect()å‡½æ•°æ¥æŠŠæ•°æ®è¾“å‡ºåœ¨Shellä¸Šã€‚</p><pre><code>header.collect()\n\n[u'longitude: continuous.', u'latitude: continuous.', u'housingMedianAge: continuous. ', u'totalRooms: continuous. ', u'totalBedrooms: continuous. ', u'population: continuous. ', u'households: continuous. ', u'medianIncome: continuous. ', u'medianHouseValue: continuous. ']\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†æ¯ä¸ªæ•°æ®æ‰€åŒ…å«çš„ä¿¡æ¯ï¼Œè¿™å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„9ä¸ªå±æ€§çš„é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸”å®ƒä»¬éƒ½æ˜¯è¿ç»­çš„å€¼ï¼Œè€Œä¸æ˜¯ç¦»æ•£çš„ã€‚ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcollect()å‡½æ•°ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ•°æ®å¾ˆå¤§çš„è¯ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥è¦å°å¿ƒä½¿ç”¨ã€‚å¹³æ—¶æ¯”è¾ƒå¸¸è§çš„æ–¹æ³•æ˜¯ç”¨take()å‡½æ•°å»åªè¯»å–RDDä¸­çš„æŸå‡ ä¸ªå…ƒç´ ã€‚</p><p>ç”±äºRDDä¸­çš„æ•°æ®å¯èƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¯»å–å®ƒçš„å‰ä¸¤ä¸ªæ•°æ®ã€‚</p><pre><code>rdd.take(2)\n\n[u'-122.230000,37.880000,41.000000,880.000000,129.000000,322.000000,126.000000,8.325200,452600.000000', u'-122.220000,37.860000,21.000000,7099.000000,1106.000000,2401.000000,1138.000000,8.301400,358500.000000']\n</code></pre><p>ç”±äºæˆ‘ä»¬æ˜¯ç”¨SparkContextçš„textFileå‡½æ•°å»åˆ›å»ºRDDï¼Œæ‰€ä»¥æ¯ä¸ªæ•°æ®å…¶å®æ˜¯ä¸€ä¸ªå¤§çš„å­—ç¬¦ä¸²ï¼Œå„ä¸ªå±æ€§ä¹‹é—´ç”¨é€—å·åˆ†éš”å¼€æ¥ã€‚è¿™ä¸åˆ©äºæˆ‘ä»¬ä¹‹åçš„å¤„ç†ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦åˆ†åˆ«è¯»å–æ¯ä¸ªå¯¹è±¡çš„å„ä¸ªå±æ€§ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ç”¨mapå‡½æ•°æŠŠå¤§å­—ç¬¦ä¸²åˆ†éš”æˆæ•°ç»„ï¼Œè¿™ä¼šæ–¹ä¾¿æˆ‘ä»¬çš„åç»­æ“ä½œã€‚</p><pre><code>rdd = rdd.map(lambda line: line.split(&quot;,&quot;))\nrdd.take(2)\n\n[[u'-122.230000', u'37.880000', u'41.000000', u'880.000000', u'129.000000', u'322.000000', u'126.000000', u'8.325200', u'452600.000000'], [u'-122.220000', u'37.860000', u'21.000000', u'7099.000000', u'1106.000000', u'2401.000000', u'1138.000000', u'8.301400', u'358500.000000']]\n</code></pre><p>æˆ‘ä»¬åœ¨å‰é¢å­¦è¿‡ï¼ŒSpark SQLçš„DataFrame APIåœ¨æŸ¥è¯¢ç»“æ„åŒ–æ•°æ®æ—¶æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œè€Œä¸”æ€§èƒ½æ›´å¥½ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®çš„schemaæ˜¯å®šä¹‰å¥½çš„ï¼Œæˆ‘ä»¬éœ€è¦å»æŸ¥è¯¢å„ä¸ªåˆ—ï¼Œæ‰€ä»¥DataFrame APIæ˜¾ç„¶æ›´åŠ é€‚ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠRDDè½¬æ¢ä¸ºDataFrameã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯éœ€è¦æŠŠä¹‹å‰ç”¨æ•°ç»„ä»£è¡¨çš„å¯¹è±¡ï¼Œè½¬æ¢æˆä¸ºRowå¯¹è±¡ï¼Œå†ç”¨toDF()å‡½æ•°è½¬æ¢æˆDataFrameã€‚</p><pre><code>from pyspark.sql import Row\n\ndf = rdd.map(lambda line: Row(longitude=line[0],\n                             latitude=line[1],\n                             housingMedianAge=line[2],\n                             totalRooms=line[3],\n                             totalBedRooms=line[4],\n                             population=line[5],\n                             households=line[6],\n                             medianIncome=line[7],\n                             medianHouseValue=line[8])).toDF()\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨show()å‡½æ•°æ‰“å°å‡ºè¿™ä¸ªDataFrameæ‰€å«çš„æ•°æ®è¡¨ã€‚</p><pre><code>df.show()\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/de/24/de91764e7e7cc3d143a8217400ec0524.png?wh=1142*488\" alt=\"\"></p><p>è¿™é‡Œæ¯ä¸€åˆ—çš„æ•°æ®æ ¼å¼éƒ½æ˜¯stringï¼Œä½†æ˜¯ï¼Œå®ƒä»¬å…¶å®éƒ½æ˜¯æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡cast()å‡½æ•°æŠŠæ¯ä¸€åˆ—çš„ç±»å‹è½¬æ¢æˆfloatã€‚</p><pre><code>def convertColumn(df, names, newType)\n for name in names:\n    df = df.withColumn(name, df[name].cast(newType))\n return df\n\ncolumns = ['households', 'housingMedianAge', 'latitude', 'longitude', 'medianHouseValue', 'medianIncome', 'population', 'totalBedRooms', 'totalRooms']\n\ndf = convertColumn(df, columns, FloatType())\n</code></pre><p>è½¬æ¢æˆæ•°å­—æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æŸä¸€åˆ—ï¼Œå¯¹æ‰€æœ‰å¯¹è±¡è¿›è¡Œæ’åºï¼Œä¹Ÿå¯ä»¥è®¡ç®—å¹³å‡å€¼ç­‰ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™æ®µä»£ç å°±å¯ä»¥ç»Ÿè®¡å‡ºæ‰€æœ‰å»ºé€ å¹´é™å„æœ‰å¤šå°‘ä¸ªæˆ¿å­ã€‚</p><pre><code>df.groupBy(&quot;housingMedianAge&quot;).count().sort(&quot;housingMedianAge&quot;,ascending=False).show()\n</code></pre><h2>é¢„å¤„ç†</h2><p>é€šè¿‡ä¸Šé¢çš„æ•°æ®åˆ†æï¼Œä½ å¯èƒ½ä¼šå‘ç°è¿™äº›æ•°æ®è¿˜æ˜¯ä¸å¤Ÿç›´è§‚ã€‚å…·ä½“çš„é—®é¢˜æœ‰ï¼š</p><ol>\n<li>æˆ¿ä»·çš„å€¼æ™®ééƒ½å¾ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒè°ƒæ•´æˆç›¸å¯¹è¾ƒå°çš„æ•°å­—ï¼›</li>\n<li>æœ‰çš„å±æ€§æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œæ¯”å¦‚æ‰€æœ‰æˆ¿å­çš„æ€»æˆ¿é—´æ•°å’Œæ€»å§å®¤æ•°ï¼Œæˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„æ˜¯å¹³å‡æˆ¿é—´æ•°ï¼›</li>\n<li>åœ¨æˆ‘ä»¬æƒ³è¦æ„å»ºçš„çº¿æ€§æ¨¡å‹ä¸­ï¼Œæˆ¿ä»·æ˜¯ç»“æœï¼Œå…¶ä»–å±æ€§æ˜¯è¾“å…¥å‚æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬åˆ†ç¦»å¤„ç†ï¼›</li>\n<li>æœ‰çš„å±æ€§æœ€å°å€¼å’Œæœ€å¤§å€¼èŒƒå›´å¾ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ ‡å‡†åŒ–å¤„ç†ã€‚</li>\n</ol><p>å¯¹äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°å¤§å¤šæ•°æˆ¿ä»·éƒ½æ˜¯åä¸‡èµ·çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨withColumn()å‡½æ•°æŠŠæ‰€æœ‰æˆ¿ä»·éƒ½é™¤ä»¥100000ã€‚</p><pre><code>df = df.withColumn(&quot;medianHouseValue&quot;, col(&quot;medianHouseValue&quot;)/100000)\n</code></pre><p>å¯¹äºç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¦‚ä¸‹ä¸‰ä¸ªæ–°çš„åˆ—ï¼š</p><ul>\n<li>æ¯ä¸ªå®¶åº­çš„å¹³å‡æˆ¿é—´æ•°ï¼šroomsPerHousehold</li>\n<li>æ¯ä¸ªå®¶åº­çš„å¹³å‡äººæ•°ï¼špopulationPerHousehold</li>\n<li>å§å®¤åœ¨æ€»æˆ¿é—´çš„å æ¯”ï¼šbedroomsPerRoom</li>\n</ul><p>å½“ç„¶ï¼Œä½ ä»¬å¯ä»¥è‡ªç”±æ·»åŠ ä½ ä»¬è§‰å¾—æœ‰æ„ä¹‰çš„åˆ—ï¼Œè¿™é‡Œçš„ä¸‰ä¸ªæ˜¯æˆ‘è§‰å¾—æ¯”è¾ƒå…¸å‹çš„ã€‚åŒæ ·ï¼Œç”¨withColumn()å‡½æ•°å¯ä»¥å®¹æ˜“åœ°æ–°å»ºåˆ—ã€‚</p><pre><code>df = df.withColumn(&quot;roomsPerHousehold&quot;, col(&quot;totalRooms&quot;)/col(&quot;households&quot;))\n  .withColumn(&quot;populationPerHousehold&quot;, col(&quot;population&quot;)/col(&quot;households&quot;))\n  .withColumn(&quot;bedroomsPerRoom&quot;, col(&quot;totalBedRooms&quot;)/col(&quot;totalRooms&quot;))\n</code></pre><p>åŒæ ·ï¼Œæœ‰çš„åˆ—æ˜¯æˆ‘ä»¬å¹¶ä¸å…³å¿ƒçš„ï¼Œæ¯”å¦‚ç»çº¬åº¦ï¼Œè¿™ä¸ªæ•°å€¼å¾ˆéš¾æœ‰çº¿æ€§çš„æ„ä¹‰ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åªç•™ä¸‹é‡è¦çš„ä¿¡æ¯åˆ—ã€‚</p><pre><code>df = df.select(&quot;medianHouseValue&quot;,\n             &quot;totalBedRooms&quot;,\n             &quot;population&quot;,\n             &quot;households&quot;,\n             &quot;medianIncome&quot;,\n             &quot;roomsPerHousehold&quot;,\n             &quot;populationPerHousehold&quot;,\n             &quot;bedroomsPerRoom&quot;)\n</code></pre><p>å¯¹äºç¬¬ä¸‰ç‚¹ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯æŠŠDataFrameè½¬æ¢æˆRDDï¼Œç„¶åç”¨map()å‡½æ•°æŠŠæ¯ä¸ªå¯¹è±¡åˆ†æˆä¸¤éƒ¨åˆ†ï¼šæˆ¿ä»·å’Œä¸€ä¸ªåŒ…å«å…¶ä½™å±æ€§çš„åˆ—è¡¨ï¼Œç„¶ååœ¨è½¬æ¢å›DataFrameã€‚</p><pre><code>from pyspark.ml.linalg import DenseVector\n\ninput_data = df.rdd.map(lambda x: (x[0], DenseVector(x[1:])))\ndf = spark.createDataFrame(input_data, [&quot;label&quot;, &quot;features&quot;])\n</code></pre><p>æˆ‘ä»¬é‡æ–°æŠŠä¸¤éƒ¨åˆ†é‡æ–°æ ‡è®°ä¸ºâ€œlabelâ€å’Œâ€œfeaturesâ€ï¼Œlabelä»£è¡¨çš„æ˜¯æˆ¿ä»·ï¼Œfeaturesä»£è¡¨åŒ…æ‹¬å…¶ä½™å‚æ•°çš„åˆ—è¡¨ã€‚</p><p>å¯¹äºç¬¬å››ç‚¹ï¼Œæ•°æ®çš„æ ‡å‡†åŒ–æˆ‘ä»¬å¯ä»¥å€ŸåŠ©Sparkçš„æœºå™¨å­¦ä¹ åº“Spark MLæ¥å®Œæˆã€‚Spark MLä¹Ÿæ˜¯åŸºäºDataFrameï¼Œå®ƒæä¾›äº†å¤§é‡æœºå™¨å­¦ä¹ çš„ç®—æ³•å®ç°ã€æ•°æ®æµæ°´çº¿ï¼ˆpipelineï¼‰ç›¸å…³å·¥å…·å’Œå¾ˆå¤šå¸¸ç”¨åŠŸèƒ½ã€‚ç”±äºæœ¬ä¸“æ çš„é‡ç‚¹æ˜¯å¤§æ•°æ®å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰ä»‹ç»Spark MLï¼Œä½†æ˜¯æˆ‘å¼ºçƒˆæ¨èåŒå­¦ä»¬æœ‰ç©ºå»äº†è§£ä¸€ä¸‹å®ƒã€‚</p><p>åœ¨è¿™ä¸ªAIå’Œæœºå™¨å­¦ä¹ çš„æ—¶ä»£ï¼Œæˆ‘ä»¬ä¸èƒ½è½ä¼ã€‚</p><pre><code>from pyspark.ml.feature import StandardScaler\n\nstandardScaler = StandardScaler(inputCol=&quot;features&quot;, outputCol=&quot;features_scaled&quot;)\nscaler = standardScaler.fit(df)\nscaled_df = scaler.transform(df)\n</code></pre><p>åœ¨ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªStandardScalerï¼Œå®ƒçš„è¾“å…¥æ˜¯featuresåˆ—ï¼Œè¾“å‡ºè¢«æˆ‘ä»¬å‘½åä¸ºfeatures_scaledã€‚ç¬¬ä¸‰ã€ç¬¬å››è¡Œï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªscalerå¯¹å·²æœ‰çš„DataFrameè¿›è¡Œå¤„ç†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ä»£ç å—é‡Œæ˜¾ç¤ºçš„è¾“å‡ºç»“æœã€‚</p><pre><code>scaled_df.take(1)\n\n[Row(label=4.526, features=DenseVector([129.0, 322.0, 126.0, 8.3252, 6.9841, 2.5556, 0.1466]), features_scaled=DenseVector([0.3062, 0.2843, 0.3296, 4.3821, 2.8228, 0.2461, 2.5264]))]\n</code></pre><p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™ä¸€è¡Œæ–°å¢äº†ä¸€ä¸ªfeatures_scaledçš„åˆ—ï¼Œå®ƒé‡Œé¢æ¯ä¸ªæ•°æ®éƒ½æ˜¯æ ‡å‡†åŒ–è¿‡çš„ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å®ƒï¼Œè€Œéfeaturesæ¥è®­ç»ƒæ¨¡å‹ã€‚</p><h2>åˆ›å»ºæ¨¡å‹</h2><p>ä¸Šé¢çš„é¢„å¤„ç†éƒ½åšå®Œåï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥å¼€å§‹æ„å»ºçº¿æ€§å›å½’æ¨¡å‹äº†ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè®­ç»ƒé›†ç”¨æ¥è®­ç»ƒæ¨¡å‹ï¼Œæµ‹è¯•é›†ç”¨æ¥è¯„ä¼°æ¨¡å‹çš„æ­£ç¡®æ€§ã€‚DataFrameçš„randomSplit()å‡½æ•°å¯ä»¥å¾ˆå®¹æ˜“çš„éšæœºåˆ†å‰²æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬å°†80%çš„æ•°æ®ç”¨äºè®­ç»ƒï¼Œå‰©ä¸‹20%ä½œä¸ºæµ‹è¯•é›†ã€‚</p><pre><code>train_data, test_data = scaled_df.randomSplit([.8,.2],seed=123)\n</code></pre><p>ç”¨Spark MLæä¾›çš„LinearRegressionåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¾—æ„å»ºä¸€ä¸ªçº¿æ€§å›å½’æ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>from pyspark.ml.regression import LinearRegression\n\nlr = LinearRegression(featuresCol='features_scaled', labelCol=&quot;label&quot;, maxIter=10, regParam=0.3, elasticNetParam=0.8)\nlinearModel = lr.fit(train_data)\n</code></pre><p>LinearRegressionå¯ä»¥è°ƒèŠ‚çš„å‚æ•°è¿˜æœ‰å¾ˆå¤šï¼Œä½ å¯ä»¥å»<a href=\"https://spark.apache.org/docs/latest/api/python/pyspark.ml.html#pyspark.ml.regression.LinearRegression\">å®˜æ–¹APIæ–‡æ¡£</a>æŸ¥é˜…ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯ç¤ºèŒƒä¸€ä¸‹ã€‚</p><h2>æ¨¡å‹è¯„ä¼°</h2><p>ç°åœ¨æœ‰äº†æ¨¡å‹ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥ç”¨linearModelçš„transform()å‡½æ•°æ¥é¢„æµ‹æµ‹è¯•é›†ä¸­çš„æˆ¿ä»·ï¼Œå¹¶ä¸çœŸå®æƒ…å†µè¿›è¡Œå¯¹æ¯”ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>predicted = linearModel.transform(test_data)\npredictions = predicted.select(&quot;prediction&quot;).rdd.map(lambda x: x[0])\nlabels = predicted.select(&quot;label&quot;).rdd.map(lambda x: x[0])\npredictionAndLabel = predictions.zip(labels).collect()\n</code></pre><p>æˆ‘ä»¬ç”¨RDDçš„zip()å‡½æ•°æŠŠé¢„æµ‹å€¼å’ŒçœŸå®å€¼æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ¯”è¾ƒã€‚æ¯”å¦‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‰ä¸¤ä¸ªå¯¹æ¯”ç»“æœã€‚</p><pre><code>predictionAndLabel.take(2)\n\n[(1.4491508524918457, 1.14999), (1.5831547768979277, 0.964)]\n</code></pre><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„æ¨¡å‹é¢„æµ‹çš„ç»“æœæœ‰äº›åå°ï¼Œè¿™å¯èƒ½æœ‰å¤šä¸ªå› ç´ é€ æˆã€‚æœ€ç›´æ¥çš„åŸå› å°±æ˜¯æˆ¿ä»·ä¸æˆ‘ä»¬æŒ‘é€‰çš„åˆ—å¹¶æ²¡æœ‰å¼ºçº¿æ€§å…³ç³»ï¼Œè€Œä¸”æˆ‘ä»¬ä½¿ç”¨çš„å‚æ•°ä¹Ÿå¯èƒ½ä¸å¤Ÿå‡†ç¡®ã€‚</p><p>è¿™ä¸€è®²æˆ‘åªæ˜¯æƒ³å¸¦ç€ä½ ä¸€èµ·ä½“éªŒä¸‹å¤„ç†çœŸå®æ•°æ®é›†å’Œè§£å†³å®é™…é—®é¢˜çš„æ„Ÿè§‰ï¼Œæƒ³è¦å‘Šè¯‰ä½ çš„æ˜¯è¿™ç§é€šç”¨çš„æ€æƒ³ï¼Œå¹¶å¸®åŠ©ä½ ç»§ç»­ç†Ÿæ‚‰Sparkå„ç§åº“çš„ç”¨æ³•ï¼Œå¹¶ä¸æ˜¯è¯´æˆ¿ä»·ä¸€å®šå°±æ˜¯ç”±è¿™äº›å‚æ•°çº¿æ€§å†³å®šäº†ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»ç»§ç»­ä¼˜åŒ–ï¼Œæˆ–è€…å°è¯•åˆ«çš„æ¨¡å‹ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªçœŸå®çš„æ•°æ®é›†ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤è§£å†³äº†ä¸€ä¸ªå®é™…çš„æ•°æ®å¤„ç†é—®é¢˜ï¼š</p><ol>\n<li>è§‚å¯Ÿå¹¶äº†è§£æ•°æ®é›†</li>\n<li>æ•°æ®æ¸…æ´—</li>\n<li>æ•°æ®çš„é¢„å¤„ç†</li>\n<li>è®­ç»ƒæ¨¡å‹</li>\n<li>è¯„ä¼°æ¨¡å‹</li>\n</ol><p>å…¶å®è¿™é‡Œè¿˜å¯ä»¥æœ‰ä¸â€œä¼˜åŒ–ä¸æ”¹è¿›â€ç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œæ²¡æœ‰å»é˜è¿°æ˜¯å› ä¸ºæˆ‘ä»¬çš„é¦–è¦ç›®çš„ä¾ç„¶æ˜¯ç†Ÿæ‚‰ä¸ä½¿ç”¨Sparkå„ç±»APIã€‚ç›¸ä¿¡é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œä½ åˆæ­¥äº†è§£äº†æ•°æ®å¤„ç†é—®é¢˜çš„ä¸€èˆ¬æ€è·¯ï¼Œå¹¶å¼ºåŒ–äº†å¯¹RDDã€DataFrameå’Œæœºå™¨å­¦ä¹ APIçš„ä½¿ç”¨ã€‚</p><h2>å®è·µä¸æ€è€ƒé¢˜</h2><p>ä»Šå¤©è¯·ä½ ä¸‹è½½è¿™ä¸ªæ•°æ®é›†ï¼ŒæŒ‰æ–‡ç« çš„ä»‹ç»å»åŠ¨æ‰‹å®è·µä¸€æ¬¡ã€‚å¦‚æœæœ‰æ—¶é—´çš„è¯ï¼Œè¿˜å¯ä»¥å¯¹è¿™ä¸ªè¿‡ç¨‹çš„ä¼˜åŒ–å’Œæ”¹è¿›æå‡ºé—®é¢˜å¹¶åŠ ä»¥è§£å†³ã€‚</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€æ¿è´´å‡ºè‡ªå·±çš„ideaã€‚å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠæ–‡ç« åˆ†äº«ç»™æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"18 | Word Countï¼šä»é›¶å¼€å§‹è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªSparkåº”ç”¨","id":97658},"right":{"article_title":"20 | æµå¤„ç†æ¡ˆä¾‹å®æˆ˜ï¼šåˆ†æçº½çº¦å¸‚å‡ºç§Ÿè½¦è½½å®¢ä¿¡æ¯","id":98537}},"comments":[{"had_liked":false,"id":99674,"user_name":"coder","can_delete":false,"product_type":"c1","uid":1399673,"ip_address":"","ucode":"929E3FFD14EFC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/5b/79/d55044ac.jpg","comment_is_top":false,"comment_ctime":1559277071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70278753807","product_id":100025301,"comment_content":"è€å¸ˆçš„ä»£ç å¯ä»¥poåˆ°Githubä¸Šï¼Œè¿™æ ·å¤§å®¶éƒ½å¯ä»¥å­¦ä¹ äº†ğŸŒğŸŒğŸŒ","like_count":17},{"had_liked":false,"id":130262,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1567414829,"is_pvip":false,"replies":[{"id":"49311","content":"ç»™ä½ ç‚¹èµğŸ‘åŠ æ²¹","user_name":"ä½œè€…å›å¤","user_name_real":"Yuannanè”¡å…ƒæ¥ ","uid":"1257426","ctime":1567618495,"ip_address":"","comment_id":130262,"utype":1}],"discussion_count":3,"race_medal":0,"score":"48812055085","product_id":100025301,"comment_content":"ç»ˆäºè·‘é€šäº†ï¼Œä¸å®¹æ˜“å•Šï¼Œåˆšå¼€å§‹æ•°æ®é›†æ²¡ä¸‹è½½æ­£ç¡®ã€‚æœ‰ç©ºå€¼ï¼Œè€å¸ˆç»™çš„æ•°æ®é›†è¾ƒå¹²å‡€ã€‚<br>åˆ«çš„æ•°æ®é›†ï¼Œè¦è®°å¾—å»é™¤ç©ºå€¼ã€‚<br>ä¸‹é¢æ˜¯å®è·µä»£ç jupyter<br>https:&#47;&#47;github.com&#47;LearningChanging&#47;spark-exercise&#47;blob&#47;master&#47;19&#47;CaliforniaHousing.ipynb","like_count":12,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465878,"discussion_content":"ç»™ä½ ç‚¹èµğŸ‘åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567618495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1096652,"avatar":"https://static001.geekbang.org/account/avatar/00/10/bb/cc/fac12364.jpg","nickname":"xxx","note":"","ucode":"E79CEA70430449","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542836,"discussion_content":"è°¢è°¢å¤§å“¥ï¼Œè·‘é€šäº†ã€‚ä¸è¿‡è¿™ä¸ªçº¿æ€§å›å½’ä¸€ç‚¹ä¹Ÿä¸å‡†å•ŠğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640858108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028947,"avatar":"","nickname":"Geek5350","note":"","ucode":"6EB4553707C357","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375351,"discussion_content":"è¯·é—®æ•°æ®é›†åœ¨å“ªé‡Œä¸‹è½½ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621586963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99862,"user_name":"kylin","can_delete":false,"product_type":"c1","uid":1351248,"ip_address":"","ucode":"3588B62A4F9534","user_header":"https://static001.geekbang.org/account/avatar/00/14/9e/50/21e0beca.jpg","comment_is_top":false,"comment_ctime":1559345251,"is_pvip":true,"replies":[{"id":"42766","content":"PySparkçš„SQLåº“åªæœ‰DataFrameï¼Œå¹¶æ²¡æœ‰DataSetã€‚ä¸è¿‡åœ¨Scalaå’ŒJavaä¸­ï¼ŒDataSetå·²ç»æˆä¸ºäº†ç»Ÿä¸€çš„SQLå…¥å£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å»¿ä¸ƒ","uid":"1386753","ctime":1563948592,"ip_address":"","comment_id":99862,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48803985507","product_id":100025301,"comment_content":"è¯·é—®ä¸ºä»€ä¹ˆä¸ç”¨datesetè¿›è¡Œæ•°æ®å¤„ç†è€Œæ˜¯ç”¨dateFrame? ","like_count":12,"discussions":[{"author":{"id":1386753,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/01/20caec2f.jpg","nickname":"Yeon","note":"","ucode":"ED3549F94EB36E","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452300,"discussion_content":"PySparkçš„SQLåº“åªæœ‰DataFrameï¼Œå¹¶æ²¡æœ‰DataSetã€‚ä¸è¿‡åœ¨Scalaå’ŒJavaä¸­ï¼ŒDataSetå·²ç»æˆä¸ºäº†ç»Ÿä¸€çš„SQLå…¥å£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563948592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058818,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/02/a6d7ece6.jpg","nickname":"refactor","note":"","ucode":"EC8FF55FE6EC8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2701,"discussion_content":"python ä¸æ”¯æŒ dataset","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563869173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104094,"user_name":"hufox","can_delete":false,"product_type":"c1","uid":1022874,"ip_address":"","ucode":"94675994D8EE16","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/9a/dcb2b713.jpg","comment_is_top":false,"comment_ctime":1560650203,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14445552091","product_id":100025301,"comment_content":"æœ€åä¸€å¥çš„ä»£ç æ”¹æˆ predictionAndLabel[:2] ï¼Œå¯ä»¥äº†ï¼","like_count":3,"discussions":[{"author":{"id":1220750,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a0/8e/6e4c7509.jpg","nickname":"ä¸€","note":"","ucode":"28E0605EA1AE88","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14597,"discussion_content":"æ„Ÿè°¢åˆ†äº«ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568772654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149798,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8b/66/2b55a7ac.jpg","nickname":"å‘¨","note":"","ucode":"E4D57FF40B355A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5786,"discussion_content":"è¯·é—®ä½ çš„æ•°æ®æœ‰æƒé™ä¸‹è½½ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566465022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177713,"user_name":"å’¸é±¼ä¸æœæ±","can_delete":false,"product_type":"c1","uid":1283861,"ip_address":"","ucode":"F79383599ACB02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRyUPicEMqGsbsMicHPuvwM8nibfgK8Yt0AibAGUmnic7rLF4zUZ4dBj4ialYz54fOD6sURKwuJIWBNjhg/132","comment_is_top":false,"comment_ctime":1581478761,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5876446057","product_id":100025301,"comment_content":"spark dfçš„æ•°æ®å¤„ç†è¿˜æ˜¯ç•¥æ˜¾å¤æ‚ï¼Œæ„Ÿè§‰å¤§éƒ¨åˆ†çš„ç®—æ³•äººå‘˜è¿˜æ˜¯ä½¿ç”¨pandasè¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼Œè¯·é—®ä½¿ç”¨pandasæ˜¯ä¸æ˜¯å°±æ— æ³•å‘æŒ¥spark RDDçš„å¨åŠ›äº†ï¼Ÿè¿™ç§æƒ…å†µä¸‹sparkå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¤„ç†æ¡†æ¶ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1110662,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/86/d689f77e.jpg","nickname":"Hank_Yan","note":"","ucode":"86899B561C502B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289637,"discussion_content":"æ•°æ®é‡å¤ªå¤§çš„æ—¶å€™ï¼Œpandasä¹åŠ›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594169715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134100,"user_name":"henry","can_delete":false,"product_type":"c1","uid":1122491,"ip_address":"","ucode":"7FD012EE0D3035","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/bb/43d63c5f.jpg","comment_is_top":false,"comment_ctime":1568743082,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863710378","product_id":100025301,"comment_content":"æœ€åä¸€æ­¥ï¼Œâ€œæ¨¡å‹é¢„æµ‹çš„ç»“æœæœ‰äº›åå°â€ï¼Œè¿™ä¸€ç‚¹ï¼Œä»ç»“æœä¸Šçœ‹ï¼Œä¸æ˜¯åº”è¯¥é¢„æµ‹çš„ç»“æœè¦å¤§ä¸€äº›å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":123526,"user_name":"é»„æ™ºå¯¿","can_delete":false,"product_type":"c1","uid":1249951,"ip_address":"","ucode":"43685DE62F720B","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/9f/b6eb3471.jpg","comment_is_top":false,"comment_ctime":1565693416,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5860660712","product_id":100025301,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæ•°æ®é›†çš„ä¸‹è½½åœ°å€èƒ½å‘ä¸€ä¸‹å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":106284,"user_name":"æ¯›æ¯›","can_delete":false,"product_type":"c1","uid":1257705,"ip_address":"","ucode":"D6F93A13E9046A","user_header":"https://static001.geekbang.org/account/avatar/00/13/30/e9/13fb8d51.jpg","comment_is_top":false,"comment_ctime":1561255194,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5856222490","product_id":100025301,"comment_content":"è€å¸ˆï¼Œå»ºè®®åœ¨æ¡ˆä¾‹è®²è§£æ—¶å¯¹ç”¨åˆ°çš„ç®—æ³•å¤§æ¦‚è§£é‡Šä¸‹ï¼Œæ¯”å¦‚srandscalerï¼Œè¿™ä¸æ˜¯å¤ªæ¸…æ¥šä»€ä¹ˆç”¨å¤„ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1897610,"avatar":"","nickname":"Fiery","note":"","ucode":"CDB000687A6B14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202828,"discussion_content":"scalerå°±æ˜¯çº¿æ€§ä»£æ•°ä¸­å¯¹å¤šç»´æ•°æ®çš„è½¬æ¢å‡½æ•°ï¼Œä½ å¦‚æœäº†è§£æ•°æ®å½’ä¸€åŒ–å°±çŸ¥é“è¿™æ˜¯åšä»€ä¹ˆçš„äº†ï¼Œå¤§æ¦‚æ¥è®²å°±æ˜¯è¦æŠŠæ•°æ®é›†ä¸­çš„æ•°æ®æ— æŸçš„æ˜ å°„åˆ°[0,1]è¿™ä¸ªåŒºé—´ä¹‹ä¸­ï¼Œæ–¹ä¾¿è®­ç»ƒçš„æ—¶ç®—æ³•å¿«é€Ÿæ”¶æ•›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583958768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104093,"user_name":"hufox","can_delete":false,"product_type":"c1","uid":1022874,"ip_address":"","ucode":"94675994D8EE16","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/9a/dcb2b713.jpg","comment_is_top":false,"comment_ctime":1560649780,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5855617076","product_id":100025301,"comment_content":"åœ¨æ‰§è¡Œæœ€åä¸€å¥ä»£ç predictionAndLabel.take(2)æ—¶æŠ¥é”™ï¼š<br>AttributeError                            Traceback (most recent call last)<br>&lt;ipython-input-35-0700ca2381fb&gt; in &lt;module&gt;<br>----&gt; 1 predictionAndLabel.take(2)<br><br>AttributeError: &#39;list&#39; object has no attribute &#39;take&#39;","like_count":2,"discussions":[{"author":{"id":1022874,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9b/9a/dcb2b713.jpg","nickname":"hufox","note":"","ucode":"94675994D8EE16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6146,"discussion_content":"ä½ å¯ä»¥ä»è¿™é‡Œä¸‹è½½ https://ndownloader.figshare.com/files/5976036","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566725774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170811,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/7b/c1efb1d9.jpg","nickname":"èƒ¡æ°¸","note":"","ucode":"931DA91D191FEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350751,"discussion_content":"å¯ä»¥æ”¹ä¸º predictionAndLabel[:2]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613998353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149798,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8b/66/2b55a7ac.jpg","nickname":"å‘¨","note":"","ucode":"E4D57FF40B355A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5810,"discussion_content":"è¯·é—®è¿™ä¸ªæ ·æœ¬æ•°æ®é›† ä½ æœ‰ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566467718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100904,"user_name":"gotojeff","can_delete":false,"product_type":"c1","uid":1212606,"ip_address":"","ucode":"1E49871F44F9E5","user_header":"https://static001.geekbang.org/account/avatar/00/12/80/be/8350f94d.jpg","comment_is_top":false,"comment_ctime":1559683553,"is_pvip":false,"replies":[{"id":"42767","content":"æ„Ÿè°¢æé—®ã€‚PySparkç°åœ¨ä¸æ”¯æŒDataSetï¼Œåªæœ‰Scalaå’ŒJavaæ”¯æŒã€‚è¿™æ˜¯ç”±è¯­è¨€ç‰¹æ€§å†³å®šçš„ï¼ŒPythonæ˜¯åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œè€ŒDataSetæ˜¯å¼ºç±»å‹çš„ï¼Œè¦æ±‚åœ¨ç¼–è¯‘æ—¶æ£€æµ‹ç±»å‹å®‰å…¨ã€‚æ‰€ä»¥ï¼Œåœ¨æ‰€æœ‰ç”¨Pythonçš„ä»£ç ä¾‹å­ä¸­ï¼Œæˆ‘ç”¨çš„éƒ½æ˜¯DataFrameã€‚<br><br>å¤§éƒ¨åˆ†äººéƒ½åŒæ„åœ¨Sparkä¸­ï¼ŒScalaå’ŒPythonæ˜¯ä¼˜äºJavaå’ŒRçš„ã€‚è‡³äºåœ¨Sparkç”Ÿæ€ä¸­ï¼ŒScalaå’ŒPythonå­°ä¼˜å­°åŠ£ï¼Œè¿™æ˜¯ä¸ªå¾ˆä¸»è§‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½åªå› ä¸ºä¸æ”¯æŒDataSetè¿™ä¸€ç‚¹å°±è¯´Pythonæ¯”Scalaå·®ã€‚<br><br>Scalaç¡®å®å¾ˆä¼˜ç§€ï¼ŒSparkåŸç”Ÿçš„å®ç°å°±æ˜¯ç”¨Scalaå†™çš„ï¼Œæ‰€ä»¥ä»»ä½•æ–°å‘å¸ƒçš„åŠŸèƒ½è‚¯å®šæ”¯æŒScalaï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿéƒ½æ˜¯ç”¨Scalaæ¥ä¸¾ä¾‹å­ã€‚è€Œä¸”Scalaçš„æ€§èƒ½è¦ä¼˜äºPythonã€‚ä½†æ˜¯Pythonä¹Ÿæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚å®¹æ˜“å­¦ä¹ ã€åº”ç”¨åœºæ™¯å¹¿ã€‚è¿™ä¸¤ç§è¯­è¨€åœ¨Sparkçš„ä¸–ç•Œä¸­éƒ½å¯ä»¥æ»¡è¶³æˆ‘ä»¬ç»å¤§å¤šæ•°çš„éœ€æ±‚ï¼Œé€‰æ‹©ä»»ä½•ä¸€ä¸ªéƒ½ä¸æ˜¯é”™è¯¯çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å»¿ä¸ƒ","uid":"1386753","ctime":1563948702,"ip_address":"","comment_id":100904,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5854650849","product_id":100025301,"comment_content":"datasetä¸æ”¯æŒpython, æ‰€ä»¥åœ¨pythoné‡Œåªæœ‰DFï¼Œè¿™ç®—ä¸ç®—pythonçš„ä¸€å¤§åŠ£åŠ¿ï¼Ÿscalaæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1386753,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/01/20caec2f.jpg","nickname":"Yeon","note":"","ucode":"ED3549F94EB36E","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452729,"discussion_content":"æ„Ÿè°¢æé—®ã€‚PySparkç°åœ¨ä¸æ”¯æŒDataSetï¼Œåªæœ‰Scalaå’ŒJavaæ”¯æŒã€‚è¿™æ˜¯ç”±è¯­è¨€ç‰¹æ€§å†³å®šçš„ï¼ŒPythonæ˜¯åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œè€ŒDataSetæ˜¯å¼ºç±»å‹çš„ï¼Œè¦æ±‚åœ¨ç¼–è¯‘æ—¶æ£€æµ‹ç±»å‹å®‰å…¨ã€‚æ‰€ä»¥ï¼Œåœ¨æ‰€æœ‰ç”¨Pythonçš„ä»£ç ä¾‹å­ä¸­ï¼Œæˆ‘ç”¨çš„éƒ½æ˜¯DataFrameã€‚\n\nå¤§éƒ¨åˆ†äººéƒ½åŒæ„åœ¨Sparkä¸­ï¼ŒScalaå’ŒPythonæ˜¯ä¼˜äºJavaå’ŒRçš„ã€‚è‡³äºåœ¨Sparkç”Ÿæ€ä¸­ï¼ŒScalaå’ŒPythonå­°ä¼˜å­°åŠ£ï¼Œè¿™æ˜¯ä¸ªå¾ˆä¸»è§‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½åªå› ä¸ºä¸æ”¯æŒDataSetè¿™ä¸€ç‚¹å°±è¯´Pythonæ¯”Scalaå·®ã€‚\n\nScalaç¡®å®å¾ˆä¼˜ç§€ï¼ŒSparkåŸç”Ÿçš„å®ç°å°±æ˜¯ç”¨Scalaå†™çš„ï¼Œæ‰€ä»¥ä»»ä½•æ–°å‘å¸ƒçš„åŠŸèƒ½è‚¯å®šæ”¯æŒScalaï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿéƒ½æ˜¯ç”¨Scalaæ¥ä¸¾ä¾‹å­ã€‚è€Œä¸”Scalaçš„æ€§èƒ½è¦ä¼˜äºPythonã€‚ä½†æ˜¯Pythonä¹Ÿæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚å®¹æ˜“å­¦ä¹ ã€åº”ç”¨åœºæ™¯å¹¿ã€‚è¿™ä¸¤ç§è¯­è¨€åœ¨Sparkçš„ä¸–ç•Œä¸­éƒ½å¯ä»¥æ»¡è¶³æˆ‘ä»¬ç»å¤§å¤šæ•°çš„éœ€æ±‚ï¼Œé€‰æ‹©ä»»ä½•ä¸€ä¸ªéƒ½ä¸æ˜¯é”™è¯¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563948702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149798,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8b/66/2b55a7ac.jpg","nickname":"å‘¨","note":"","ucode":"E4D57FF40B355A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5809,"discussion_content":"è¯·é—®è¿™ä¸ªæ ·æœ¬æ•°æ®é›† ä½ æœ‰ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566467697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100381,"user_name":"abc-web","can_delete":false,"product_type":"c1","uid":1371804,"ip_address":"","ucode":"DE3B873863EFF9","user_header":"https://static001.geekbang.org/account/avatar/00/14/ee/9c/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1559542989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854510285","product_id":100025301,"comment_content":"è€å¸ˆä»£ç å¯ä»¥ä¸Šgithubå—ï¼Œè¿™æ ·åŒå­¦ä»¬å¯ä»¥å‚è€ƒä¸‹","like_count":1},{"had_liked":false,"id":99648,"user_name":"Zoe","can_delete":false,"product_type":"c1","uid":1528912,"ip_address":"","ucode":"A5D671919EE7B1","user_header":"https://static001.geekbang.org/account/avatar/00/17/54/50/8a76a8cc.jpg","comment_is_top":false,"comment_ctime":1559273293,"is_pvip":false,"replies":[{"id":"36674","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_Test","uid":"1568170","ctime":1559990482,"ip_address":"","comment_id":99648,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5854240589","product_id":100025301,"comment_content":"çœ‹å‰ä¸¤ç¯‡æ–‡ç« æ—¶è¿˜åœ¨æƒ³ï¼Œæ²¡ä»€ä¹ˆç»ƒæ‰‹çš„æœºä¼šå•Šï¼Œä»Šå¤©å°±æ¨é€äº†å®æˆ˜ç»ƒä¹ ï¼Œæœ‰ä¸€ç§ç»ˆäºè·Ÿä¸Šå¤§ç¥æ€ç»´çš„å¹»è§‰ï¼Œå¼€å¿ƒï¼","like_count":1,"discussions":[{"author":{"id":1568170,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ed/aa/c2b9e399.jpg","nickname":"Geek_Test","note":"","ucode":"2A70B596E8F49D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452204,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559990482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293885,"user_name":"Geek5350","can_delete":false,"product_type":"c1","uid":2028947,"ip_address":"","ucode":"6EB4553707C357","user_header":"","comment_is_top":false,"comment_ctime":1621587032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621587032","product_id":100025301,"comment_content":"è¯·é—®æ•°æ®é›†åœ¨å“ªé‡Œä¸‹è½½ï¼Ÿ","like_count":0},{"had_liked":false,"id":272985,"user_name":"å¯»æ°´çš„å°é±¼","can_delete":false,"product_type":"c1","uid":1502696,"ip_address":"","ucode":"A3935497FEAD1C","user_header":"https://static001.geekbang.org/account/avatar/00/16/ed/e8/8985d6e0.jpg","comment_is_top":false,"comment_ctime":1610377690,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1610377690","product_id":100025301,"comment_content":"&gt;&gt;&gt; <br>&gt;&gt;&gt; def convertColumn(df, names, newType)<br>  File &quot;&lt;stdin&gt;&quot;, line 1<br>    def convertColumn(df, names, newType)<br>                                        ^<br>SyntaxError: invalid syntax<br>","like_count":0},{"had_liked":false,"id":243192,"user_name":"ä¹‹æ¸Š","can_delete":false,"product_type":"c1","uid":1876212,"ip_address":"","ucode":"02B9299DBB4881","user_header":"https://static001.geekbang.org/account/avatar/00/1c/a0/f4/7e122a67.jpg","comment_is_top":false,"comment_ctime":1597989592,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597989592","product_id":100025301,"comment_content":"java ç‰ˆçš„ä»£ç demo : https:&#47;&#47;gitee.com&#47;oumin12345&#47;daimademojihe&#47;tree&#47;master&#47;cloudx&#47;bigdata&#47;src&#47;main&#47;java&#47;test&#47;spark<br>å»ºè®®åˆå­¦è€…æ²¡å†™è¿‡çš„å¯ä»¥è‡ªå·±æ•²ä¸€ä¸‹ã€‚<br>æœºå™¨å­¦ä¹ çš„å…¥é—¨å¯ä»¥çœ‹çœ‹ ï¼š<br>https:&#47;&#47;my.oschina.net&#47;ouminzy&#47;blog&#47;4437101","like_count":0},{"had_liked":false,"id":216146,"user_name":"xianhai","can_delete":false,"product_type":"c1","uid":1073505,"ip_address":"","ucode":"906578663CEB3E","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/61/677e8f92.jpg","comment_is_top":false,"comment_ctime":1589196462,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589196462","product_id":100025301,"comment_content":"æœ€å¥½è¿˜æ˜¯ç»™å®Œæ•´çš„ä»£ç ï¼ŒèŠ‚çœåˆå­¦è€…çš„æ—¶é—´ã€‚","like_count":0},{"had_liked":false,"id":178490,"user_name":"Chloe","can_delete":false,"product_type":"c1","uid":1004953,"ip_address":"","ucode":"C4848ED5B35752","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/99/4bdadfd3.jpg","comment_is_top":false,"comment_ctime":1581704431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581704431","product_id":100025301,"comment_content":"æŠ¥é”™ï¼š<br>&quot;<br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>NameError: name &#39;FloatType&#39; is not defined<br>&quot;<br>Googleäº†ä¸€ä¸‹: https:&#47;&#47;stackoverflow.com&#47;questions&#47;40701122&#47;unexpected-type-class-pyspark-sql-types-datatypesingleton-when-casting-to-i<br><br>åŠ äº†è¿™å¥å°±å¥½äº†ï¼š<br>from pyspark.sql.types import FloatType<br><br>å¤§å®¶è¿˜æœ‰äººä¹Ÿé‡åˆ°è¿™ä¸ªé”™è¯¯å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":130255,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1567413618,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567413618","product_id":100025301,"comment_content":"StandardScaler å½’ä¸€åŒ–ä¹‹åï¼Œä¸¤åˆ—å˜æˆ NaN äº†æä¸æ˜ç™½<br>+-----+--------------------+--------------------+<br>|label|            features|     features_scaled|<br>+-----+--------------------+--------------------+<br>|4.526|[129.0,322.0,126....|[NaN,0.2843362208...|<br>|3.585|[1106.0,2401.0,11...|[NaN,2.1201592122...|<br>+-----+--------------------+--------------------+<br><br>scaled_df.take(2)<br>[Row(label=4.526, features=DenseVector([129.0, 322.0, 126.0, 8.3252, 6.9841, 2.5556, 0.1466]), features_scaled=DenseVector([nan, 0.2843, 0.3296, 4.3821, 2.8228, 0.2461, nan])),<br> Row(label=3.585, features=DenseVector([1106.0, 2401.0, 1138.0, 8.3014, 6.2381, 2.1098, 0.1558]), features_scaled=DenseVector([nan, 2.1202, 2.9765, 4.3696, 2.5213, 0.2031, nan]))]","like_count":0,"discussions":[{"author":{"id":1127175,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","nickname":"JustDoDT","note":"","ucode":"6AF0B80F00EAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7174,"discussion_content":"åŸå› æ˜¯æˆ‘è‡ªå·±æ‰¾çš„åŸå§‹æ•°æ®é›†é‡Œé¢å«æœ‰ç©ºå€¼ã€‚ç”¨ä¹‹å‰è¦å¯¹ç©ºå€¼è¿›è¡Œå¤„ç†ï¼Œè¦ä¸ç„¶å°±æ˜¯è¿™ä¸ªç»“æœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567414975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120666,"user_name":"è¥¿åŒ—ååŒ—","can_delete":false,"product_type":"c1","uid":1043160,"ip_address":"","ucode":"64BD69C84EE6A1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdpKbFgRLnicjsr6qkrPVKZcFrG3aS2V51HhjFP6Mh2CYcjWric9ud1Qiclo8A49ia3eZ1NhibDib0AOCg/132","comment_is_top":false,"comment_ctime":1564969067,"is_pvip":false,"replies":[{"id":"47611","content":"åœ¨å®è·µä¸­çœ‹åˆ°éœ€è¦å¯ä»¥å›å¤´çœ‹ä¸€ä¸‹åŸºç¡€çŸ¥è¯†","user_name":"ä½œè€…å›å¤","user_name_real":"Yuannanè”¡å…ƒæ¥ ","uid":"1257426","ctime":1566883126,"ip_address":"","comment_id":120666,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564969067","product_id":100025301,"comment_content":"ä¸€äº›å®é™…çš„å¤§æ•°æ®å¤„ç†ï¼Œç¡®å®éœ€è¦æ•°å­¦å•Šâ€¦â€¦æ€ä¹ˆæ‰èƒ½æŠŠæ•°å­¦å­¦å¥½ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461424,"discussion_content":"åœ¨å®è·µä¸­çœ‹åˆ°éœ€è¦å¯ä»¥å›å¤´çœ‹ä¸€ä¸‹åŸºç¡€çŸ¥è¯†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566883126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}