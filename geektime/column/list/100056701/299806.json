{"id":299806,"title":"29 | æ— é”çš„åŸå­æ“ä½œï¼šRediså¦‚ä½•åº”å¯¹å¹¶å‘è®¿é—®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å¾·é’§ã€‚</p><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Redisæ—¶ï¼Œä¸å¯é¿å…åœ°ä¼šé‡åˆ°å¹¶å‘è®¿é—®çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´å¦‚æœå¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•ï¼Œå°±ä¼šå¯¹ç¼“å­˜åœ¨Redisä¸­çš„å•†å“åº“å­˜å¹¶å‘æ›´æ–°ã€‚ä¸€æ—¦æœ‰äº†å¹¶å‘å†™æ“ä½œï¼Œæ•°æ®å°±ä¼šè¢«ä¿®æ”¹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹å¹¶å‘å†™è¯·æ±‚åšå¥½æ§åˆ¶ï¼Œå°±å¯èƒ½å¯¼è‡´æ•°æ®è¢«æ”¹é”™ï¼Œå½±å“åˆ°ä¸šåŠ¡çš„æ­£å¸¸ä½¿ç”¨ï¼ˆä¾‹å¦‚åº“å­˜æ•°æ®é”™è¯¯ï¼Œå¯¼è‡´ä¸‹å•å¼‚å¸¸ï¼‰ã€‚</p><p>ä¸ºäº†ä¿è¯å¹¶å‘è®¿é—®çš„æ­£ç¡®æ€§ï¼ŒRedisæä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯åŠ é”å’ŒåŸå­æ“ä½œã€‚</p><p>åŠ é”æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•ï¼Œåœ¨è¯»å–æ•°æ®å‰ï¼Œå®¢æˆ·ç«¯éœ€è¦å…ˆè·å¾—é”ï¼Œå¦åˆ™å°±æ— æ³•è¿›è¡Œæ“ä½œã€‚å½“ä¸€ä¸ªå®¢æˆ·ç«¯è·å¾—é”åï¼Œå°±ä¼šä¸€ç›´æŒæœ‰è¿™æŠŠé”ï¼Œç›´åˆ°å®¢æˆ·ç«¯å®Œæˆæ•°æ®æ›´æ–°ï¼Œæ‰é‡Šæ”¾è¿™æŠŠé”ã€‚</p><p>çœ‹ä¸Šå»å¥½åƒæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œå…¶å®è¿™é‡Œä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä¸€ä¸ªæ˜¯ï¼Œå¦‚æœåŠ é”æ“ä½œå¤šï¼Œä¼šé™ä½ç³»ç»Ÿçš„å¹¶å‘è®¿é—®æ€§èƒ½ï¼›ç¬¬äºŒä¸ªæ˜¯ï¼ŒRediså®¢æˆ·ç«¯è¦åŠ é”æ—¶ï¼Œéœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œè€Œåˆ†å¸ƒå¼é”å®ç°å¤æ‚ï¼Œéœ€è¦ç”¨é¢å¤–çš„å­˜å‚¨ç³»ç»Ÿæ¥æä¾›åŠ è§£é”æ“ä½œï¼Œæˆ‘ä¼šåœ¨ä¸‹èŠ‚è¯¾å‘ä½ ä»‹ç»ã€‚</p><p><strong>åŸå­æ“ä½œæ˜¯å¦ä¸€ç§æä¾›å¹¶å‘è®¿é—®æ§åˆ¶çš„æ–¹æ³•</strong>ã€‚åŸå­æ“ä½œæ˜¯æŒ‡æ‰§è¡Œè¿‡ç¨‹ä¿æŒåŸå­æ€§çš„æ“ä½œï¼Œè€Œä¸”åŸå­æ“ä½œæ‰§è¡Œæ—¶å¹¶ä¸éœ€è¦å†åŠ é”ï¼Œå®ç°äº†æ— é”æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œæ—¢èƒ½ä¿è¯å¹¶å‘æ§åˆ¶ï¼Œè¿˜èƒ½å‡å°‘å¯¹ç³»ç»Ÿå¹¶å‘æ€§èƒ½çš„å½±å“ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘å°±æ¥å’Œä½ èŠèŠRedisä¸­çš„åŸå­æ“ä½œã€‚åŸå­æ“ä½œçš„ç›®æ ‡æ˜¯å®ç°å¹¶å‘è®¿é—®æ§åˆ¶ï¼Œé‚£ä¹ˆå½“æœ‰å¹¶å‘è®¿é—®è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å…·ä½“éœ€è¦æ§åˆ¶ä»€ä¹ˆå‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆå‘ä½ ä»‹ç»ä¸‹å¹¶å‘æ§åˆ¶çš„å†…å®¹ã€‚</p><!-- [[[read_end]]] --><h2>å¹¶å‘è®¿é—®ä¸­éœ€è¦å¯¹ä»€ä¹ˆè¿›è¡Œæ§åˆ¶ï¼Ÿ</h2><p>æˆ‘ä»¬è¯´çš„å¹¶å‘è®¿é—®æ§åˆ¶ï¼Œæ˜¯æŒ‡å¯¹å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®æ“ä½œåŒä¸€ä»½æ•°æ®çš„è¿‡ç¨‹è¿›è¡Œæ§åˆ¶ï¼Œä»¥ä¿è¯ä»»ä½•ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€çš„æ“ä½œåœ¨Rediså®ä¾‹ä¸Šæ‰§è¡Œæ—¶å…·æœ‰äº’æ–¥æ€§ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯Açš„è®¿é—®æ“ä½œåœ¨æ‰§è¡Œæ—¶ï¼Œå®¢æˆ·ç«¯Bçš„æ“ä½œä¸èƒ½æ‰§è¡Œï¼Œéœ€è¦ç­‰åˆ°Açš„æ“ä½œç»“æŸåï¼Œæ‰èƒ½æ‰§è¡Œã€‚</p><p>å¹¶å‘è®¿é—®æ§åˆ¶å¯¹åº”çš„æ“ä½œä¸»è¦æ˜¯æ•°æ®ä¿®æ”¹æ“ä½œã€‚å½“å®¢æˆ·ç«¯éœ€è¦ä¿®æ”¹æ•°æ®æ—¶ï¼ŒåŸºæœ¬æµç¨‹åˆ†æˆä¸¤æ­¥ï¼š</p><ol>\n<li>å®¢æˆ·ç«¯å…ˆæŠŠæ•°æ®è¯»å–åˆ°æœ¬åœ°ï¼Œåœ¨æœ¬åœ°è¿›è¡Œä¿®æ”¹ï¼›</li>\n<li>å®¢æˆ·ç«¯ä¿®æ”¹å®Œæ•°æ®åï¼Œå†å†™å›Redisã€‚</li>\n</ol><p>æˆ‘ä»¬æŠŠè¿™ä¸ªæµç¨‹å«åšâ€œè¯»å–-ä¿®æ”¹-å†™å›â€æ“ä½œï¼ˆRead-Modify-Writeï¼Œç®€ç§°ä¸ºRMWæ“ä½œï¼‰ã€‚å½“æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¯¹åŒä¸€ä»½æ•°æ®æ‰§è¡ŒRMWæ“ä½œçš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦è®©RMWæ“ä½œæ¶‰åŠçš„ä»£ç ä»¥åŸå­æ€§æ–¹å¼æ‰§è¡Œã€‚è®¿é—®åŒä¸€ä»½æ•°æ®çš„RMWæ“ä½œä»£ç ï¼Œå°±å«åšä¸´ç•ŒåŒºä»£ç ã€‚</p><p>ä¸è¿‡ï¼Œå½“æœ‰å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘æ‰§è¡Œä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå°±ä¼šå­˜åœ¨ä¸€äº›æ½œåœ¨é—®é¢˜ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ç”¨ä¸€ä¸ªå¤šå®¢æˆ·ç«¯æ›´æ–°å•†å“åº“å­˜çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ä¸´ç•ŒåŒºä»£ç ã€‚å‡è®¾å®¢æˆ·ç«¯è¦å¯¹å•†å“åº“å­˜æ‰§è¡Œæ‰£å‡1çš„æ“ä½œï¼Œä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>current = GET(id)\ncurrent--\nSET(id, current)\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯é¦–å…ˆä¼šæ ¹æ®å•†å“idï¼Œä»Redisä¸­è¯»å–å•†å“å½“å‰çš„åº“å­˜å€¼currentï¼ˆå¯¹åº”Read)ï¼Œç„¶åï¼Œå®¢æˆ·ç«¯å¯¹åº“å­˜å€¼å‡1ï¼ˆå¯¹åº”Modifyï¼‰ï¼Œå†æŠŠåº“å­˜å€¼å†™å›Redisï¼ˆå¯¹åº”Writeï¼‰ã€‚å½“æœ‰å¤šä¸ªå®¢æˆ·ç«¯æ‰§è¡Œè¿™æ®µä»£ç æ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä»½ä¸´ç•ŒåŒºä»£ç ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¯¹ä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œæ²¡æœ‰æ§åˆ¶æœºåˆ¶ï¼Œå°±ä¼šå‡ºç°æ•°æ®æ›´æ–°é”™è¯¯ã€‚åœ¨åˆšæ‰çš„ä¾‹å­ä¸­ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯Aå’ŒBï¼ŒåŒæ—¶æ‰§è¡Œåˆšæ‰çš„ä¸´ç•ŒåŒºä»£ç ï¼Œå°±ä¼šå‡ºç°é”™è¯¯ï¼Œä½ å¯ä»¥çœ‹ä¸‹ä¸‹é¢è¿™å¼ å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/5c/dce821cd00c1937b4aab1f130424335c.jpg?wh=2925*1801\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯Aåœ¨t1æ—¶è¯»å–åº“å­˜å€¼10å¹¶æ‰£å‡1ï¼Œåœ¨t2æ—¶ï¼Œå®¢æˆ·ç«¯Aè¿˜æ²¡æœ‰æŠŠæ‰£å‡åçš„åº“å­˜å€¼9å†™å›Redisï¼Œè€Œåœ¨æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯Bè¯»åˆ°åº“å­˜å€¼10ï¼Œä¹Ÿæ‰£å‡äº†1ï¼ŒBè®°å½•çš„åº“å­˜å€¼ä¹Ÿä¸º9äº†ã€‚ç­‰åˆ°t3æ—¶ï¼ŒAå¾€Rediså†™å›äº†åº“å­˜å€¼9ï¼Œè€Œåˆ°t4æ—¶ï¼ŒBä¹Ÿå†™å›äº†åº“å­˜å€¼9ã€‚</p><p>å¦‚æœæŒ‰æ­£ç¡®çš„é€»è¾‘å¤„ç†ï¼Œå®¢æˆ·ç«¯Aå’ŒBå¯¹åº“å­˜å€¼å„åšäº†ä¸€æ¬¡æ‰£å‡ï¼Œåº“å­˜å€¼åº”è¯¥ä¸º8ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œçš„åº“å­˜å€¼æ˜æ˜¾æ›´æ–°é”™äº†ã€‚</p><p>å‡ºç°è¿™ä¸ªç°è±¡çš„åŸå› æ˜¯ï¼Œä¸´ç•ŒåŒºä»£ç ä¸­çš„å®¢æˆ·ç«¯è¯»å–æ•°æ®ã€æ›´æ–°æ•°æ®ã€å†å†™å›æ•°æ®æ¶‰åŠäº†ä¸‰ä¸ªæ“ä½œï¼Œè€Œè¿™ä¸‰ä¸ªæ“ä½œåœ¨æ‰§è¡Œæ—¶å¹¶ä¸å…·æœ‰äº’æ–¥æ€§ï¼Œå¤šä¸ªå®¢æˆ·ç«¯åŸºäºç›¸åŒçš„åˆå§‹å€¼è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸æ˜¯åŸºäºå‰ä¸€ä¸ªå®¢æˆ·ç«¯ä¿®æ”¹åçš„å€¼å†ä¿®æ”¹ã€‚</p><p>ä¸ºäº†ä¿è¯æ•°æ®å¹¶å‘ä¿®æ”¹çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é”æŠŠå¹¶è¡Œæ“ä½œå˜æˆä¸²è¡Œæ“ä½œï¼Œä¸²è¡Œæ“ä½œå°±å…·æœ‰äº’æ–¥æ€§ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”åï¼Œå…¶ä»–å®¢æˆ·ç«¯åªèƒ½ç­‰åˆ°é”é‡Šæ”¾ï¼Œæ‰èƒ½æ‹¿é”å†è¿›è¡Œä¿®æ”¹ã€‚</p><p>ä¸‹é¢çš„ä¼ªä»£ç æ˜¾ç¤ºäº†ä½¿ç”¨é”æ¥æ§åˆ¶ä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><pre><code>LOCK()\ncurrent = GET(id)\ncurrent--\nSET(id, current)\nUNLOCK()\n</code></pre><p>è™½ç„¶åŠ é”ä¿è¯äº†äº’æ–¥æ€§ï¼Œä½†æ˜¯<strong>åŠ é”ä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿå¹¶å‘æ€§èƒ½é™ä½</strong>ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“å®¢æˆ·ç«¯AåŠ é”æ‰§è¡Œæ“ä½œæ—¶ï¼Œå®¢æˆ·ç«¯Bã€Cå°±éœ€è¦ç­‰å¾…ã€‚Aé‡Šæ”¾é”åï¼Œå‡è®¾Bæ‹¿åˆ°é”ï¼Œé‚£ä¹ˆCè¿˜éœ€è¦ç»§ç»­ç­‰å¾…ï¼Œæ‰€ä»¥ï¼Œt1æ—¶æ®µå†…åªæœ‰Aèƒ½è®¿é—®å…±äº«æ•°æ®ï¼Œt2æ—¶æ®µå†…åªæœ‰Bèƒ½è®¿é—®å…±äº«æ•°æ®ï¼Œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å½“ç„¶å°±ä¸‹é™äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/25/845b4694700264482d64a3dbb7a36525.jpg?wh=2620*1414\" alt=\"\"></p><p>å’ŒåŠ é”ç±»ä¼¼ï¼ŒåŸå­æ“ä½œä¹Ÿèƒ½å®ç°å¹¶å‘æ§åˆ¶ï¼Œä½†æ˜¯åŸå­æ“ä½œå¯¹ç³»ç»Ÿå¹¶å‘æ€§èƒ½çš„å½±å“è¾ƒå°ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ä¸‹Redisä¸­çš„åŸå­æ“ä½œã€‚</p><h2>Redisçš„ä¸¤ç§åŸå­æ“ä½œæ–¹æ³•</h2><p>ä¸ºäº†å®ç°å¹¶å‘æ§åˆ¶è¦æ±‚çš„ä¸´ç•ŒåŒºä»£ç äº’æ–¥æ‰§è¡Œï¼ŒRedisçš„åŸå­æ“ä½œé‡‡ç”¨äº†ä¸¤ç§æ–¹æ³•ï¼š</p><ol>\n<li>æŠŠå¤šä¸ªæ“ä½œåœ¨Redisä¸­å®ç°æˆä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯å•å‘½ä»¤æ“ä½œï¼›</li>\n<li>æŠŠå¤šä¸ªæ“ä½œå†™åˆ°ä¸€ä¸ªLuaè„šæœ¬ä¸­ï¼Œä»¥åŸå­æ€§æ–¹å¼æ‰§è¡Œå•ä¸ªLuaè„šæœ¬ã€‚</li>\n</ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Redisæœ¬èº«çš„å•å‘½ä»¤æ“ä½œã€‚</p><p>Redisæ˜¯ä½¿ç”¨å•çº¿ç¨‹æ¥ä¸²è¡Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ“ä½œå‘½ä»¤çš„ï¼Œæ‰€ä»¥ï¼Œå½“Redisæ‰§è¡ŒæŸä¸ªå‘½ä»¤æ“ä½œæ—¶ï¼Œå…¶ä»–å‘½ä»¤æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œè¿™ç›¸å½“äºå‘½ä»¤æ“ä½œæ˜¯äº’æ–¥æ‰§è¡Œçš„ã€‚å½“ç„¶ï¼ŒRedisçš„å¿«ç…§ç”Ÿæˆã€AOFé‡å†™è¿™äº›æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨åå°çº¿ç¨‹æˆ–è€…æ˜¯å­è¿›ç¨‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å’Œä¸»çº¿ç¨‹çš„æ“ä½œå¹¶è¡Œæ‰§è¡Œã€‚ä¸è¿‡ï¼Œè¿™äº›æ“ä½œåªæ˜¯è¯»å–æ•°æ®ï¼Œä¸ä¼šä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹å®ƒä»¬åšå¹¶å‘æ§åˆ¶ã€‚</p><p>ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œè™½ç„¶Redisçš„å•ä¸ªå‘½ä»¤æ“ä½œå¯ä»¥åŸå­æ€§åœ°æ‰§è¡Œï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ•°æ®ä¿®æ”¹æ—¶å¯èƒ½åŒ…å«å¤šä¸ªæ“ä½œï¼Œè‡³å°‘åŒ…æ‹¬è¯»æ•°æ®ã€æ•°æ®å¢å‡ã€å†™å›æ•°æ®ä¸‰ä¸ªæ“ä½œï¼Œè¿™æ˜¾ç„¶å°±ä¸æ˜¯å•ä¸ªå‘½ä»¤æ“ä½œäº†ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>åˆ«æ‹…å¿ƒï¼ŒRedisæä¾›äº†INCR/DECRå‘½ä»¤ï¼ŒæŠŠè¿™ä¸‰ä¸ªæ“ä½œè½¬å˜ä¸ºä¸€ä¸ªåŸå­æ“ä½œäº†ã€‚INCR/DECRå‘½ä»¤å¯ä»¥å¯¹æ•°æ®è¿›è¡Œ<strong>å¢å€¼/å‡å€¼</strong>æ“ä½œï¼Œè€Œä¸”å®ƒä»¬æœ¬èº«å°±æ˜¯å•ä¸ªå‘½ä»¤æ“ä½œï¼ŒRedisåœ¨æ‰§è¡Œå®ƒä»¬æ—¶ï¼Œæœ¬èº«å°±å…·æœ‰äº’æ–¥æ€§ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œåœ¨åˆšæ‰çš„åº“å­˜æ‰£å‡ä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œç›´æ¥å®Œæˆå¯¹å•†å“idçš„åº“å­˜å€¼å‡1æ“ä½œã€‚å³ä½¿æœ‰å¤šä¸ªå®¢æˆ·ç«¯æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå‡ºç°åº“å­˜å€¼æ‰£å‡é”™è¯¯çš„é—®é¢˜ã€‚</p><pre><code>DECR id \n</code></pre><p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œçš„RMWæ“ä½œæ˜¯å¯¹æ•°æ®è¿›è¡Œå¢å‡å€¼çš„è¯ï¼ŒRedisæä¾›çš„åŸå­æ“ä½œINCRå’ŒDECRå¯ä»¥ç›´æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦æ‰§è¡Œçš„æ“ä½œä¸æ˜¯ç®€å•åœ°å¢å‡æ•°æ®ï¼Œè€Œæ˜¯æœ‰æ›´åŠ å¤æ‚çš„åˆ¤æ–­é€»è¾‘æˆ–è€…æ˜¯å…¶ä»–æ“ä½œï¼Œé‚£ä¹ˆï¼ŒRedisçš„å•å‘½ä»¤æ“ä½œå·²ç»æ— æ³•ä¿è¯å¤šä¸ªæ“ä½œçš„äº’æ–¥æ‰§è¡Œäº†ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Luaè„šæœ¬ã€‚</p><p>Redisä¼šæŠŠæ•´ä¸ªLuaè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ï¼Œä»è€Œä¿è¯äº†Luaè„šæœ¬ä¸­æ“ä½œçš„åŸå­æ€§ã€‚å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªæ“ä½œè¦æ‰§è¡Œï¼Œä½†æ˜¯åˆæ— æ³•ç”¨INCR/DECRè¿™ç§å‘½ä»¤æ“ä½œæ¥å®ç°ï¼Œå°±å¯ä»¥æŠŠè¿™äº›è¦æ‰§è¡Œçš„æ“ä½œç¼–å†™åˆ°ä¸€ä¸ªLuaè„šæœ¬ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Redisçš„EVALå‘½ä»¤æ¥æ‰§è¡Œè„šæœ¬ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›æ“ä½œåœ¨æ‰§è¡Œæ—¶å°±å…·æœ‰äº†äº’æ–¥æ€§ã€‚</p><p>æˆ‘å†ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œæ¥å…·ä½“è§£é‡Šä¸‹Luaçš„ä½¿ç”¨ã€‚</p><p>å½“ä¸€ä¸ªä¸šåŠ¡åº”ç”¨çš„è®¿é—®ç”¨æˆ·å¢åŠ æ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦é™åˆ¶æŸä¸ªå®¢æˆ·ç«¯åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…çš„è®¿é—®æ¬¡æ•°ï¼Œæ¯”å¦‚çˆ†æ¬¾å•†å“çš„è´­ä¹°é™æµã€ç¤¾äº¤ç½‘ç»œä¸­çš„æ¯åˆ†é’Ÿç‚¹èµæ¬¡æ•°é™åˆ¶ç­‰ã€‚</p><p>é‚£è¯¥æ€ä¹ˆé™åˆ¶å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠå®¢æˆ·ç«¯IPä½œä¸ºkeyï¼ŒæŠŠå®¢æˆ·ç«¯çš„è®¿é—®æ¬¡æ•°ä½œä¸ºvalueï¼Œä¿å­˜åˆ°Redisä¸­ã€‚å®¢æˆ·ç«¯æ¯è®¿é—®ä¸€æ¬¡åï¼Œæˆ‘ä»¬å°±ç”¨INCRå¢åŠ è®¿é—®æ¬¡æ•°ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå®¢æˆ·ç«¯é™æµå…¶å®åŒæ—¶åŒ…å«äº†å¯¹è®¿é—®æ¬¡æ•°å’Œæ—¶é—´èŒƒå›´çš„é™åˆ¶ï¼Œä¾‹å¦‚æ¯åˆ†é’Ÿçš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡20ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œç»™å¯¹åº”é”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º60såè¿‡æœŸã€‚åŒæ—¶ï¼Œåœ¨å®¢æˆ·ç«¯æ¯æ¬¡è®¿é—®æ—¶ï¼Œæˆ‘ä»¬è¯»å–å®¢æˆ·ç«¯å½“å‰çš„è®¿é—®æ¬¡æ•°ï¼Œå¦‚æœæ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œå°±æŠ¥é”™ï¼Œé™åˆ¶å®¢æˆ·ç«¯å†æ¬¡è®¿é—®ã€‚ä½ å¯ä»¥çœ‹ä¸‹ä¸‹é¢çš„è¿™æ®µä»£ç ï¼Œå®ƒå®ç°äº†å¯¹å®¢æˆ·ç«¯æ¯åˆ†é’Ÿè®¿é—®æ¬¡æ•°ä¸è¶…è¿‡20æ¬¡çš„é™åˆ¶ã€‚</p><pre><code>//è·å–ipå¯¹åº”çš„è®¿é—®æ¬¡æ•°\ncurrent = GET(ip)\n//å¦‚æœè¶…è¿‡è®¿é—®æ¬¡æ•°è¶…è¿‡20æ¬¡ï¼Œåˆ™æŠ¥é”™\nIF current != NULL AND current &gt; 20 THEN\n    ERROR &quot;exceed 20 accesses per second&quot;\nELSE\n    //å¦‚æœè®¿é—®æ¬¡æ•°ä¸è¶³20æ¬¡ï¼Œå¢åŠ ä¸€æ¬¡è®¿é—®è®¡æ•°\n    value = INCR(ip)\n    //å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå°†é”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º60så\n    IF value == 1 THEN\n        EXPIRE(ip,60)\n    END\n    //æ‰§è¡Œå…¶ä»–æ“ä½œ\n    DO THINGS\nEND\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†INCRæ¥åŸå­æ€§åœ°å¢åŠ è®¡æ•°ã€‚ä½†æ˜¯ï¼Œå®¢æˆ·ç«¯é™æµçš„é€»è¾‘ä¸åªæœ‰è®¡æ•°ï¼Œè¿˜åŒ…æ‹¬<strong>è®¿é—®æ¬¡æ•°åˆ¤æ–­å’Œè¿‡æœŸæ—¶é—´è®¾ç½®</strong>ã€‚</p><p>å¯¹äºè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä¿è¯å®ƒä»¬çš„åŸå­æ€§ã€‚å¦åˆ™ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨å¤šçº¿ç¨‹è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°åˆå§‹å€¼ä¸º0ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†INCR(ip)æ“ä½œåï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ç´§æ¥ç€ä¹Ÿæ‰§è¡Œäº†INCR(ip)ï¼Œæ­¤æ—¶ï¼Œipå¯¹åº”çš„è®¿é—®æ¬¡æ•°å°±è¢«å¢åŠ åˆ°äº†2ï¼Œæˆ‘ä»¬å°±æ— æ³•å†å¯¹è¿™ä¸ªipè®¾ç½®è¿‡æœŸæ—¶é—´äº†ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œè¿™ä¸ªipå¯¹åº”çš„å®¢æˆ·ç«¯è®¿é—®æ¬¡æ•°è¾¾åˆ°20æ¬¡ä¹‹åï¼Œå°±æ— æ³•å†è¿›è¡Œè®¿é—®äº†ã€‚å³ä½¿è¿‡äº†60sï¼Œä¹Ÿä¸èƒ½å†ç»§ç»­è®¿é—®ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªä¾‹å­ä¸­çš„æ“ä½œæ— æ³•ç”¨Rediså•ä¸ªå‘½ä»¤æ¥å®ç°ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯å¹¶å‘æ§åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè®¿é—®æ¬¡æ•°åŠ 1ã€åˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦ä¸º1ï¼Œä»¥åŠè®¾ç½®è¿‡æœŸæ—¶é—´è¿™ä¸‰ä¸ªæ“ä½œå†™å…¥ä¸€ä¸ªLuaè„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>local current\ncurrent = redis.call(&quot;incr&quot;,KEYS[1])\nif tonumber(current) == 1 then\n    redis.call(&quot;expire&quot;,KEYS[1],60)\nend\n</code></pre><p>å‡è®¾æˆ‘ä»¬ç¼–å†™çš„è„šæœ¬åç§°ä¸ºlua.scriptï¼Œæˆ‘ä»¬æ¥ç€å°±å¯ä»¥ä½¿ç”¨Rediså®¢æˆ·ç«¯ï¼Œå¸¦ä¸Ševalé€‰é¡¹ï¼Œæ¥æ‰§è¡Œè¯¥è„šæœ¬ã€‚è„šæœ¬æ‰€éœ€çš„å‚æ•°å°†é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¸­çš„keyså’Œargsè¿›è¡Œä¼ é€’ã€‚</p><pre><code>redis-cli  --eval lua.script  keys , args\n</code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œè®¿é—®æ¬¡æ•°åŠ 1ã€åˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦ä¸º1ï¼Œä»¥åŠè®¾ç½®è¿‡æœŸæ—¶é—´è¿™ä¸‰ä¸ªæ“ä½œå°±å¯ä»¥åŸå­æ€§åœ°æ‰§è¡Œäº†ã€‚å³ä½¿å®¢æˆ·ç«¯æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼ŒRedisä¹Ÿä¼šä¾æ¬¡ä¸²è¡Œæ‰§è¡Œè„šæœ¬ä»£ç ï¼Œé¿å…äº†å¹¶å‘æ“ä½œå¸¦æ¥çš„æ•°æ®é”™è¯¯ã€‚</p><h2>å°ç»“</h2><p>åœ¨å¹¶å‘è®¿é—®æ—¶ï¼Œå¹¶å‘çš„RMWæ“ä½œä¼šå¯¼è‡´æ•°æ®é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚æ‰€è°“å¹¶å‘æ§åˆ¶ï¼Œå°±æ˜¯è¦ä¿è¯ä¸´ç•ŒåŒºä»£ç çš„äº’æ–¥æ‰§è¡Œã€‚</p><p>Redisæä¾›äº†ä¸¤ç§åŸå­æ“ä½œçš„æ–¹æ³•æ¥å®ç°å¹¶å‘æ§åˆ¶ï¼Œåˆ†åˆ«æ˜¯å•å‘½ä»¤æ“ä½œå’ŒLuaè„šæœ¬ã€‚å› ä¸ºåŸå­æ“ä½œæœ¬èº«ä¸ä¼šå¯¹å¤ªå¤šçš„èµ„æºé™åˆ¶è®¿é—®ï¼Œå¯ä»¥ç»´æŒè¾ƒé«˜çš„ç³»ç»Ÿå¹¶å‘æ€§èƒ½ã€‚</p><p>ä½†æ˜¯ï¼Œå•å‘½ä»¤åŸå­æ“ä½œçš„é€‚ç”¨èŒƒå›´è¾ƒå°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„RMWæ“ä½œéƒ½èƒ½è½¬å˜æˆå•å‘½ä»¤çš„åŸå­æ“ä½œï¼ˆä¾‹å¦‚INCR/DECRå‘½ä»¤åªèƒ½åœ¨è¯»å–æ•°æ®ååšåŸå­å¢å‡ï¼‰ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹è¯»å–çš„æ•°æ®åšæ›´å¤šåˆ¤æ–­ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬å¯¹æ•°æ®çš„ä¿®æ”¹ä¸æ˜¯ç®€å•çš„å¢å‡æ—¶ï¼Œå•å‘½ä»¤æ“ä½œå°±ä¸é€‚ç”¨äº†ã€‚</p><p>è€ŒRedisçš„Luaè„šæœ¬å¯ä»¥åŒ…å«å¤šä¸ªæ“ä½œï¼Œè¿™äº›æ“ä½œéƒ½ä¼šä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œç»•å¼€äº†å•å‘½ä»¤æ“ä½œçš„é™åˆ¶ã€‚ä¸è¿‡ï¼Œå¦‚æœæŠŠå¾ˆå¤šæ“ä½œéƒ½æ”¾åœ¨Luaè„šæœ¬ä¸­åŸå­æ‰§è¡Œï¼Œä¼šå¯¼è‡´Redisæ‰§è¡Œè„šæœ¬çš„æ—¶é—´å¢åŠ ï¼ŒåŒæ ·ä¹Ÿä¼šé™ä½Redisçš„å¹¶å‘æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œæˆ‘ç»™ä½ ä¸€ä¸ªå°å»ºè®®ï¼š<strong>åœ¨ç¼–å†™Luaè„šæœ¬æ—¶ï¼Œä½ è¦é¿å…æŠŠä¸<strong><strong>éœ€è¦</strong></strong>åšå¹¶å‘æ§åˆ¶çš„æ“ä½œå†™å…¥è„šæœ¬ä¸­</strong>ã€‚</p><p>å½“ç„¶ï¼ŒåŠ é”ä¹Ÿèƒ½å®ç°ä¸´ç•ŒåŒºä»£ç çš„äº’æ–¥æ‰§è¡Œï¼Œåªæ˜¯å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŠ é”æ—¶ï¼Œå°±éœ€è¦åˆ†å¸ƒå¼é”çš„æ”¯æŒäº†ã€‚æ‰€ä»¥ï¼Œä¸‹èŠ‚è¯¾ï¼Œæˆ‘å°±æ¥å’Œä½ èŠèŠåˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><h2>æ¯è¯¾ä¸€é—®</h2><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘å‘ä½ æä¸ªå°é—®é¢˜ï¼ŒRedisåœ¨æ‰§è¡ŒLuaè„šæœ¬æ—¶ï¼Œæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„ï¼Œé‚£ä¹ˆï¼Œåœ¨æˆ‘ä¸¾çš„Luaè„šæœ¬ä¾‹å­ï¼ˆlua.scriptï¼‰ä¸­ï¼Œä½ è§‰å¾—æ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ipçš„è®¿é—®æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡20çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ°Luaè„šæœ¬ä¸­å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":256519,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1603646721,"is_pvip":true,"discussion_count":35,"race_medal":0,"score":"1234259260673","product_id":100056701,"comment_content":"æ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•° GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ° Lua è„šæœ¬ä¸­ï¼Ÿ<br><br>æˆ‘è§‰å¾—ä¸éœ€è¦ï¼Œç†ç”±ä¸»è¦æœ‰2ä¸ªã€‚<br><br>1ã€è¿™2ä¸ªé€»è¾‘éƒ½æ˜¯è¯»æ“ä½œï¼Œä¸ä¼šå¯¹èµ„æºä¸´ç•ŒåŒºäº§ç”Ÿä¿®æ”¹ï¼Œæ‰€ä»¥ä¸éœ€è¦åšå¹¶å‘æ§åˆ¶ã€‚<br><br>2ã€å‡å°‘ lua è„šæœ¬ä¸­çš„å‘½ä»¤ï¼Œå¯ä»¥é™ä½Redisæ‰§è¡Œè„šæœ¬çš„æ—¶é—´ï¼Œé¿å…é˜»å¡ Redisã€‚<br><br>å¦å¤–ä½¿ç”¨luaè„šæœ¬æ—¶ï¼Œè¿˜æœ‰ä¸€äº›æ³¨æ„ç‚¹ï¼š<br><br>1ã€lua è„šæœ¬å°½é‡åªç¼–å†™é€šç”¨çš„é€»è¾‘ä»£ç ï¼Œé¿å…ç›´æ¥å†™æ­»å˜é‡ã€‚å˜é‡é€šè¿‡å¤–éƒ¨è°ƒç”¨æ–¹ä¼ é€’è¿›æ¥ï¼Œè¿™æ · lua è„šæœ¬çš„å¯å¤ç”¨åº¦æ›´é«˜ã€‚<br><br>2ã€å»ºè®®å…ˆä½¿ç”¨SCRIPT LOADå‘½ä»¤æŠŠ lua è„šæœ¬åŠ è½½åˆ° Redis ä¸­ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªè„šæœ¬å”¯ä¸€æ‘˜è¦å€¼ï¼Œå†é€šè¿‡EVALSHAå‘½ä»¤ + è„šæœ¬æ‘˜è¦å€¼æ¥æ‰§è¡Œè„šæœ¬ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å‘é€è„šæœ¬å†…å®¹åˆ° Redisï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚","like_count":288,"discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318214,"discussion_content":"æˆ‘å¯èƒ½æè¿°çš„ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œè¿™é‡Œå†è¯¦ç»†è¯´ä¸€ä¸‹ã€‚\n\næ–‡ç« ä¸­çš„é™æµé—®é¢˜ï¼Œå¦‚æœä¸šåŠ¡å¹¶å‘ä¸æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥ä¸æŠŠè¯»å–å®¢æˆ·ç«¯ ip è®¿é—®æ¬¡æ•°å’Œåˆ¤æ–­æ¬¡é€»è¾‘æ”¾åœ¨ lua è„šæœ¬ä¸­ã€‚å¦‚æœå®¢æˆ·ç«¯å¹¶å‘é‡å¾ˆå¤§ï¼Œä¸ºäº†ä¿è¯é€»è¾‘æ­£ç¡®æ€§ï¼Œæ˜¯éœ€è¦æŠŠé€»è¾‘æ”¾åˆ° lua è„šæœ¬ä¸­çš„ã€‚\n\nä¸æŠŠåˆ¤æ–­é€»è¾‘æ”¾åˆ° lua è„šæœ¬ä¸­çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\n\n1ã€å®¢æˆ·ç«¯å…ˆè¯»å– ip è®¿é—®æ¬¡æ•°ï¼Œç„¶ååˆ¤æ–­æ¬¡æ•°æ˜¯å¦è¿‡ 20\n2ã€å¦‚æœæ²¡è¶…è¿‡ 20ï¼Œåˆ™æ‰§è¡Œluaè„šæœ¬ï¼ˆå¢åŠ æ¬¡æ•°ã€åˆ¤æ–­æ˜¯å¦ç¬¬ä¸€æ¬¡è®¿é—®ã€è®¾ç½®è¿‡æœŸï¼‰\n3ã€å¦‚æœè¶…è¿‡ 20ï¼Œä¸šåŠ¡ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸æ‰§è¡Œåç»­æµç¨‹\n\nå¦‚æœå¹¶å‘ç¨‹åº¦ä¸é«˜ï¼Œå½“è®¿é—®æ¬¡æ•°è¶…è¿‡ 20 æ—¶ï¼ŒåŸºæœ¬éƒ½ä¼šèµ°åˆ°æ­¥éª¤3ã€‚\n\nä¸è¿‡æœ‰ä¸€ç§æƒ…å†µä¼šå¯¼è‡´å®¢æˆ·ç«¯è®¿é—®æ¬¡æ•°è¶…è¿‡ 20ï¼Œä¾‹å¦‚è¶…è¿‡ 20 ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œéƒ½èµ°åˆ°äº†æ­¥éª¤1ï¼Œç„¶åå®¢æˆ·ç«¯éƒ½è®¤ä¸ºæ¬¡æ•°æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œä¹‹åéƒ½æ‰§è¡Œäº†æ­¥éª¤2ï¼Œè¿›å…¥åç»­ä¸šåŠ¡æµç¨‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¿é—®æ¬¡æ•°ä¼šè¶…è¿‡ 20ï¼Œä½†ä¸‹æ¬¡å†æœ‰çº¿ç¨‹è¯·æ±‚è¿›æ¥æ—¶ï¼Œä¼šç›´æ¥èµ°åˆ°æ­¥éª¤3åè¿”å›ã€‚\n\nè¿™ç§æ–¹æ¡ˆä¼šå­˜åœ¨å°‘é‡è¯·æ±‚æ²¡æœ‰é™åˆ¶ä½çš„æƒ…å†µï¼Œä½†æ˜¯æˆ‘ä»¬å¹³æ—¶ä¸šåŠ¡é‡åˆ°è¿™ç§æŒç»­æ€§å¹¶å‘çš„åœºæ™¯å¹¶ä¸å¤šï¼Œæ‰€ä»¥é‡‡ç”¨è¿™ç§æ–¹æ¡ˆå¯¹ä¸šåŠ¡çš„å½±å“ä¸å¤§ã€‚è€Œä¸”ä¸æŠŠåˆ¤æ–­é€»è¾‘æ”¾åœ¨ lua è„šæœ¬ä¸­ï¼Œè¿™æ ·åšå¦å¤–çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥å‡å°‘è„šæœ¬æ‰§è¡Œçš„æ—¶é—´ï¼Œä»è€Œé™ä½ Redis é˜»å¡æ—¶é—´ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœå‘ç”Ÿäº†æç«¯æƒ…å†µï¼ˆä¾‹å¦‚æ¶æ„è¯·æ±‚ï¼‰ï¼Œå¹¶å‘é‡å¾ˆå¤§ï¼Œå¹¶å‘æ•°ç»å¸¸è¿œè¶…è¿‡ 20ï¼Œé‚£ä¹ˆæœ€å¥½è¿˜æ˜¯æŠŠè¯»å–æ¬¡æ•°å’Œåˆ¤æ–­æ¬¡æ•°çš„é€»è¾‘æ”¾åˆ° lua è„šæœ¬ä¸­ï¼Œä¿è¯åœ¨æœåŠ¡ç«¯èƒ½å¤Ÿä¸²è¡Œæ‰§è¡Œæ¯ä¸ªçº¿ç¨‹çš„æ“ä½œã€‚ä½†è¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯ï¼Œä¼šå¢åŠ  Redis é˜»å¡æ—¶é—´ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½æœ‰ä¸€å®šå½±å“ã€‚","likes_number":37,"is_delete":false,"is_hidden":false,"ctime":1603680819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":11,"child_discussions":[{"author":{"id":1113937,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg","nickname":"å¥½è¿æ¥","note":"","ucode":"F469ED6CEFEF30","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":320091,"discussion_content":"ç¡®å®å¹¶å‘æ•°è¶…è¿‡20ä¹‹åï¼Œå­˜åœ¨è¶…å‡ºé¢„æœŸå°‘é‡è¯·æ±‚æ²¡æœ‰é™åˆ¶ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604239435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318214,"ip_address":""},"score":320091,"extra":""},{"author":{"id":1386818,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/42/43d4b1a8.jpg","nickname":"çƒ«çƒ«çƒ«","note":"","ucode":"C06018670DE76A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":324670,"discussion_content":"ä½ è¿™ä¸ªæè¿°è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¹¶ä¸éœ€è¦20ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå¦‚æœå·²ç»è®¿é—®19æ¬¡äº†ï¼Œæ­¤æ—¶åªè¦æœ‰2ä¸ªå¹¶å‘å°±ç›´æ¥è¶…äº†","likes_number":22,"is_delete":false,"is_hidden":false,"ctime":1605150366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318214,"ip_address":""},"score":324670,"extra":""},{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1386818,"avatar":"https://static001.geekbang.org/account/avatar/00/15/29/42/43d4b1a8.jpg","nickname":"çƒ«çƒ«çƒ«","note":"","ucode":"C06018670DE76A","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":324677,"discussion_content":"æ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605151374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":324670,"ip_address":""},"score":324677,"extra":""}]},{"author":{"id":1312184,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/b8/8d468842.jpg","nickname":"JulyRemember","note":"","ucode":"9E3D5D60D82999","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318166,"discussion_content":"æˆ‘è§‰å¾—å¤§äº20åº”è¯¥è¦æ”¾å…¥luaè„šæœ¬å§ã€‚æˆ‘çŸ¥é“è¯»å–æ•°æ®ä¸éœ€è¦åŸå­æ€§æ§åˆ¶ï¼Œä½†æ˜¯å› ä¸ºä½ åœ¨è¯»å–æ•°æ®åˆ°å®¢æˆ·ç«¯çš„æ—¶é—´é‡Œå¯èƒ½å€¼å°±è¢«ä¿®æ”¹äº†ï¼Œå¯¹äºä¸€åˆ†é’Ÿ20æ¬¡è®¿é—®çš„åˆ¤æ–­å°±æœ‰é—®é¢˜å§ï¼Œè¿™æ˜¯æˆ‘çš„æƒ³æ³•ï¼Œä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜ã€‚è¿˜æœ‰ç¬¬äºŒç‚¹æ³¨æ„ç‚¹è¿™ä¸ªæ˜¯è¦åœ¨æœåŠ¡å™¨æ‰§è¡Œçš„å§ï¼Œè¿˜æ˜¯åœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥æ“ä½œï¼Ÿ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1603670875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":6,"child_discussions":[{"author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"LbbNiu","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1312184,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/b8/8d468842.jpg","nickname":"JulyRemember","note":"","ucode":"9E3D5D60D82999","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318182,"discussion_content":"èµåŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603673629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318166,"ip_address":""},"score":318182,"extra":""},{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1312184,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/b8/8d468842.jpg","nickname":"JulyRemember","note":"","ucode":"9E3D5D60D82999","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318216,"discussion_content":"ä½ åˆ†æçš„æœ‰é“ç†ï¼Œæˆ‘åœ¨è¯„è®ºé‡Œåˆè¯¦ç»†åˆ†æäº†ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹çœ‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603680871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318166,"ip_address":""},"score":318216,"extra":""},{"author":{"id":1022411,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/99/cb/8964faab.jpg","nickname":"-åªæ˜¯å°å°é…è§’_","note":"","ucode":"EFC1CD54A23F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1312184,"avatar":"https://static001.geekbang.org/account/avatar/00/14/05/b8/8d468842.jpg","nickname":"JulyRemember","note":"","ucode":"9E3D5D60D82999","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349168,"discussion_content":"å…ˆè¯»å†ä¿®æ”¹çš„è¯æ˜¯ä¼šé‡åˆ°è®¿é—®é‡è¶…äº†çš„æƒ…å†µï¼Œä½†å…ˆä¿®æ”¹å†è¯»çš„è¯æ˜¯ä¸æ˜¯å°±å¯ä»¥é¿å…ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612946724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318166,"ip_address":""},"score":349168,"extra":""}]},{"author":{"id":1119593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","nickname":"å—å±±","note":"","ucode":"94656FE4A6C378","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318176,"discussion_content":"è¯·æ•™ä¸€ä¸‹ï¼Œluaè„šæœ¬åœ¨æ•°æ®åˆ†ç‰‡é›†ç¾¤ä½¿ç”¨æœ‰æ²¡æœ‰æ³¨æ„äº‹é¡¹å‘¢ï¼Ÿæ¯”å¦‚è®¿é—®çš„ç¼“å­˜æ•°æ®ä¸åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šçš„æƒ…å†µä¼šå’‹æ ·ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603672838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1119593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","nickname":"å—å±±","note":"","ucode":"94656FE4A6C378","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":318219,"discussion_content":"ä¸åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œè¿™ç‚¹ä¹Ÿéœ€è¦æ³¨æ„ã€‚","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1603680976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318176,"ip_address":""},"score":318219,"extra":""},{"author":{"id":1253310,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/be/551454e0.jpg","nickname":"zxy","note":"","ucode":"FFAA3F6667305D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1119593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","nickname":"å—å±±","note":"","ucode":"94656FE4A6C378","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":572617,"discussion_content":"hash tag","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652871208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318176,"ip_address":""},"score":572617,"extra":""},{"author":{"id":2058852,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/6a/64/3d4fccf8.jpg","nickname":"Z_Z","note":"","ucode":"654BE3F3C7DBA4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1253310,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/be/551454e0.jpg","nickname":"zxy","note":"","ucode":"FFAA3F6667305D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573078,"discussion_content":"å¥½åƒæœ‰ä¸€ç« è®²åˆ°åœ¨set keyå€¼ä¸­ä½¿ç”¨hash tagï¼Œæ¯”å¦‚{user:}å°±ä¼šæŠŠè¿™ç±»æ•°æ®éƒ½æ”¾åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ç‰‡åŒº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653194739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":572617,"ip_address":""},"score":573078,"extra":""}]},{"author":{"id":1434196,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e2/54/ccd36eda.jpg","nickname":"æˆ‘çˆ±å­¦ä¹ ","note":"","ucode":"8B850B794272C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341129,"discussion_content":"å¦‚æœè¯»æ“ä½œå°±ä¸éœ€è¦åŸå­æ€§çš„è¯ï¼Œé‚£incrçš„è®¾è®¡ç›®çš„æ˜¯å•¥å‘¢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1610324626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1822190,"avatar":"","nickname":"Geek_45f84a","note":"","ucode":"5CA117BDBE4FF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1434196,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e2/54/ccd36eda.jpg","nickname":"æˆ‘çˆ±å­¦ä¹ ","note":"","ucode":"8B850B794272C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377686,"discussion_content":"incr è¿˜åŒ…æ‹¬å†™ï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ªRMWæ“ä½œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622775670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":341129,"ip_address":""},"score":377686,"extra":""}]},{"author":{"id":2063962,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","nickname":"Ethan New","note":"","ucode":"9CA2EF39E58030","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390353,"discussion_content":"â€œè¿™2ä¸ªé€»è¾‘éƒ½æ˜¯è¯»æ“ä½œï¼Œä¸ä¼šå¯¹èµ„æºä¸´ç•ŒåŒºäº§ç”Ÿä¿®æ”¹ï¼Œæ‰€ä»¥ä¸éœ€è¦åšå¹¶å‘æ§åˆ¶ã€‚â€è¿™å¥è¯ä¸å¯¹ï¼Œä½ ä¸ä¿®æ”¹èƒ½ç®¡å¾—äº†åˆ«äººä¸ä¿®æ”¹ï¼Ÿè¿˜æ˜¯æœ‰å¹¶å‘é—®é¢˜çš„ã€‚åªä¸è¿‡è¯»å–çš„å€¼ä¸ç²¾ç¡®ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ç²¾ç¡®ä¸ç²¾ç¡®æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629795076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1272315,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/nSvVtStiaQzslFM7YRnlhPyTgSHGoXvOqlSQS8rMEmfnFCtasNxRiaVfrRcMlkuOSq1iaReQD0CiaGHMVibsVMNkAxQ/132","nickname":"justin","note":"","ucode":"09AE502D6A28D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2063962,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","nickname":"Ethan New","note":"","ucode":"9CA2EF39E58030","race_medal":4,"user_type":1,"is_pvip":true},"discussion":{"id":413628,"discussion_content":"æ˜¯çš„ï¼Œget(ip)æ“ä½œå³ä½¿è¯»åˆ°åˆ«çš„çº¿ç¨‹ä¿®æ”¹åçš„å€¼ï¼Œ åˆ¤æ–­å¤§äº20è¿”å›äº†ã€‚ å¦‚æœå°äº20ï¼Œ åˆ™å’Œå…¶ä»–çº¿ç¨‹äº’æ–¥è‡ªå¢å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ è¿™ä¸ªä¾‹å­åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636530074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":390353,"ip_address":""},"score":413628,"extra":""},{"author":{"id":1749015,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b0/17/451cb87c.jpg","nickname":"åŠ æ²¹ï¼","note":"","ucode":"947E97762DB6EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1272315,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/nSvVtStiaQzslFM7YRnlhPyTgSHGoXvOqlSQS8rMEmfnFCtasNxRiaVfrRcMlkuOSq1iaReQD0CiaGHMVibsVMNkAxQ/132","nickname":"justin","note":"","ucode":"09AE502D6A28D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540448,"discussion_content":"ä½†æ˜¯ä¸èƒ½ç²¾ç¡®æ§åˆ¶20æ¬¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640059351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":413628,"ip_address":""},"score":540448,"extra":""}]},{"author":{"id":2310617,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZGbq9QcsysWhYJvIXaZ0S9llXDVicF0Tvm2ibgGehHCPYWxHzZ2Z34SVOyIOKkH44qPFCANBbib2iawqrWU7azD3og/132","nickname":"Geek_750e24","note":"","ucode":"7C8D33FEEA47B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330260,"discussion_content":"æœ‰ä¸ªç–‘é—®ï¼ŒINCRå‘½ä»¤è¿”å›valueä¸æ˜¯åŸå­æ“ä½œä¹ˆï¼Ÿ å°±ç®—ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œäº†INCRå‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹çš„è¿”å›å€¼éš¾é“ä¸æ˜¯1ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606551330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2310617,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZGbq9QcsysWhYJvIXaZ0S9llXDVicF0Tvm2ibgGehHCPYWxHzZ2Z34SVOyIOKkH44qPFCANBbib2iawqrWU7azD3og/132","nickname":"Geek_750e24","note":"","ucode":"7C8D33FEEA47B0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330269,"discussion_content":"æ˜¯çš„ï¼Œç”¨è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606553327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":330260,"ip_address":""},"score":330269,"extra":""},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2310617,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZGbq9QcsysWhYJvIXaZ0S9llXDVicF0Tvm2ibgGehHCPYWxHzZ2Z34SVOyIOKkH44qPFCANBbib2iawqrWU7azD3og/132","nickname":"Geek_750e24","note":"","ucode":"7C8D33FEEA47B0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377067,"discussion_content":"æ„Ÿè§‰è€å¸ˆçš„ç¤ºä¾‹ï¼Œvalue æ˜¯å…¨å±€å˜é‡ï¼Œæ‰€ä»¥æ–‡ç« ä¸­çš„åˆ†æç»“è®ºï¼šexpire å¤±è´¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622476034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":330260,"ip_address":""},"score":377067,"extra":""},{"author":{"id":1675882,"avatar":"https://static001.geekbang.org/account/avatar/00/19/92/6a/dd37a054.jpg","nickname":"å¼ y .","note":"","ucode":"85918469492F4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2310617,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZGbq9QcsysWhYJvIXaZ0S9llXDVicF0Tvm2ibgGehHCPYWxHzZ2Z34SVOyIOKkH44qPFCANBbib2iawqrWU7azD3og/132","nickname":"Geek_750e24","note":"","ucode":"7C8D33FEEA47B0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413019,"discussion_content":"valueæ˜¯å…¨å±€å˜é‡çš„è¯ï¼Œå¤šçº¿ç¨‹æ“ä½œçš„å°±æ˜¯ä¸€å—å†…å­˜valueå€¼äº†ï¼Œæ‰§è¡Œifä¹‹å‰å°±æ”¹æˆ2.æ­¤æ—¶å°±ä¸æ˜¯1äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636361503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":330260,"ip_address":""},"score":413019,"extra":""}]},{"author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"LbbNiu","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318183,"discussion_content":"å¦‚æœä¸éœ€è¦ï¼Œæ€ä¹ˆä¿è¯åŸå­æ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603673697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"LbbNiu","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":318217,"discussion_content":"æˆ‘åœ¨è¯„è®ºä¸‹åˆè¯¦ç»†åˆ†æäº†é—®é¢˜åœºæ™¯ï¼Œå¯ä»¥çœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603680905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318183,"ip_address":""},"score":318217,"extra":""}]}]},{"had_liked":false,"id":258532,"user_name":"Geek_fb6ea6","can_delete":false,"product_type":"c1","uid":2104979,"ip_address":"","ucode":"2B0FBBFD9E957A","user_header":"","comment_is_top":false,"comment_ctime":1604475971,"is_pvip":false,"replies":[{"id":"98023","content":"è¿™é‡Œçš„å¹¶å‘æ˜¯æŒ‡æœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®Redisï¼Œè€Œå®¢æˆ·ç«¯æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ä¸åªä¸€ä¸ªå‘½ä»¤æ“ä½œã€‚å‡è®¾å®¢æˆ·ç«¯Aè¦å…ˆä»Redisè¯»æ•°æ®ï¼Œç„¶ååšäº†ä¿®æ”¹æŠŠæ•°æ®å†å†™å›Redisï¼Œæ­¤æ—¶ï¼Œåœ¨è¯»æ•°æ®å’Œå†™å›æ•°æ®çš„æœŸé—´å°±å¯èƒ½æœ‰å…¶ä»–å®¢æˆ·ç«¯çš„å¹¶å‘æ“ä½œæ‰§è¡Œï¼Œæ‰€ä»¥ä»ç„¶å­˜åœ¨å¹¶å‘è¯»å†™é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è’‹å¾·é’§","uid":"1609687","ctime":1609082735,"ip_address":"","comment_id":258532,"utype":1}],"discussion_count":8,"race_medal":0,"score":"74618920003","product_id":100056701,"comment_content":"Redisä¸æ˜¯å•çº¿ç¨‹å—ï¼Ÿæ€ä¹ˆè¿˜ä¼šæœ‰å¹¶å‘è¯»å†™çš„é—®é¢˜å‘¢","like_count":17,"discussions":[{"author":{"id":1609687,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8f/d7/fb60129d.jpg","nickname":"è’‹å¾·é’§","note":"","ucode":"833985C2C37C0A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508683,"discussion_content":"è¿™é‡Œçš„å¹¶å‘æ˜¯æŒ‡æœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®Redisï¼Œè€Œå®¢æˆ·ç«¯æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ä¸åªä¸€ä¸ªå‘½ä»¤æ“ä½œã€‚å‡è®¾å®¢æˆ·ç«¯Aè¦å…ˆä»Redisè¯»æ•°æ®ï¼Œç„¶ååšäº†ä¿®æ”¹æŠŠæ•°æ®å†å†™å›Redisï¼Œæ­¤æ—¶ï¼Œåœ¨è¯»æ•°æ®å’Œå†™å›æ•°æ®çš„æœŸé—´å°±å¯èƒ½æœ‰å…¶ä»–å®¢æˆ·ç«¯çš„å¹¶å‘æ“ä½œæ‰§è¡Œï¼Œæ‰€ä»¥ä»ç„¶å­˜åœ¨å¹¶å‘è¯»å†™é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609082735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1998387,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/7e/33/b16f6c0a.jpg","nickname":"é»„å¶èˆä¸œé£","note":"","ucode":"4E6F5C37819420","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542351,"discussion_content":"æˆ‘ä¸Šé¢è¯´çš„Aå’ŒBåŒæ—¶getä¸å‡†ç¡®ï¼Œç”±äºæ˜¯å•è¿›ç¨‹çš„åŸå› ï¼Œåº”è¯¥æ˜¯Aå’ŒBå…ˆåGETï¼Œä¸è¿‡æ­¤æ—¶æ‹¿åˆ°çš„éƒ½æ˜¯10ï¼Œä¸å½±å“åé¢çš„æè¿°","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640738756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1998387,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/7e/33/b16f6c0a.jpg","nickname":"é»„å¶èˆä¸œé£","note":"","ucode":"4E6F5C37819420","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542349,"discussion_content":"æ¯”å¦‚ç°åœ¨æœ‰ä¸€ç»„æ“ä½œGET+SET, è¿™ä¸¤ä¸ªæ“ä½œå¯¹åº”ç€ä¸¤ä¸ªåˆ°redis serverçš„ TCPè¿æ¥ï¼Œè¯·æ±‚Aå’ŒBåŒæ—¶è¿‡æ¥ï¼ŒAå’ŒBåŒæ—¶getï¼Œç„¶åæ¯”å¦‚å¾—åˆ°ç»“æœ10ï¼Œæ­¤æ—¶10æ˜¯æ”¾åˆ°äº†è°ƒç”¨æ–¹çš„å†…å­˜é‡Œï¼Œç„¶åAå’ŒBå„è°ƒç”¨ä¸€æ¬¡SET(æ¯”å¦‚éƒ½+1)ï¼Œæ­¤æ—¶Aå’ŒBçš„æ“ä½œéƒ½æ˜¯set(key,11), Aå’ŒBçš„SETçš„tcpè¿æ¥åˆ°redisåï¼Œä¼šè¢«é¡ºåºæ‰§è¡Œ(å•è¿›ç¨‹)ï¼Œä¹Ÿå°±è¢«è®¾ç½®äº†ä¸¤ä¸ª11, å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªè®¾ç½®11ï¼Œä¸€ä¸ªè®¾ç½®12æ‰å¯¹ã€‚æ‰€ä»¥éœ€è¦æŠŠè¿™ä¸¤ä¸ªåŠ¨ä½œæ”¾åˆ°ä¸€ä¸ªluaè„šæœ¬é‡Œé¢ï¼ŒæŠŠæ•´ä¸ªè„šæœ¬é€šè¿‡ä¸€ä¸ªtcpè¿æ¥å‘è¿‡å»ï¼Œç”±äºrediså•è¿›ç¨‹çš„ç‰¹æ€§ï¼Œæ­¤æ—¶luaè„šæœ¬å°±ä¼šè¢«å®Œæ•´æ‰§è¡Œï¼Œåœ¨Açš„luaè„šæœ¬ä¸­ï¼Œå…ˆå¾—åˆ°10ï¼Œç„¶åsetæˆ11ï¼Œåœ¨Bçš„è„šæœ¬ä¸­ï¼Œå…ˆå¾—åˆ°11ï¼Œç„¶åsetæˆ12ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒGETå’ŒSETå°±æ˜¯åŸå­çš„äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640738268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028954,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9a/63dc81a2.jpg","nickname":"Geek1185","note":"","ucode":"47BEE492EF4C1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389551,"discussion_content":"å•çº¿ç¨‹åªä¿è¯äº†å•æ“ä½œçš„åŸå­æ€§ã€‚ç±»ä¼¼äºvolatile","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629336310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376681,"discussion_content":"å®¢æˆ·ç«¯Aè¯»æ•°æ®ã€ä¿®æ”¹æ•°æ®ã€å†™æ•°æ®ï¼Œä¸­é—´çš„æ­¥éª¤å­˜åœ¨å…¶ä»–å®¢æˆ·ç«¯å¹¶å‘ä¿®æ”¹ï¼Œå¯¼è‡´é”™è¯¯å‘ç”Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622276358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1193874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","nickname":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","note":"","ucode":"BD53829E924B66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1886331,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","nickname":"å¤œè¾‰","note":"","ucode":"9421385F51FF9E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415241,"discussion_content":"å³ä¾¿ä¸­é—´æ­¥éª¤å­˜åœ¨å¹¶å‘ï¼Œå¯¹äºRedisæ¥è¯´ï¼Œä»ç„¶æ˜¯åœ¨æœåŠ¡Aç»“æŸåï¼Œæ‰èƒ½æœåŠ¡ Bã€‚å¯¹äº Redis æ¥è¯´ï¼Œå¹¶ä¸ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜ã€‚æ­¤å¤„çš„é”™è¯¯æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637034212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376681,"ip_address":""},"score":415241,"extra":""},{"author":{"id":2924014,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/9d/ee/a58e330a.jpg","nickname":"åˆ˜è¶Šé˜³","note":"","ucode":"FC3EE6E01D8C92","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1193874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","nickname":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","note":"","ucode":"BD53829E924B66","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":553072,"discussion_content":"Aè¯»æ•°æ®ï¼Œä¿®æ”¹æ•°æ®ï¼Œå†™æ•°æ®åˆä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸­é—´å®Œå…¨å¯èƒ½ç©¿æ’å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚å‘€","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1645706635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":415241,"ip_address":""},"score":553072,"extra":""}]},{"author":{"id":1297375,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cb/df/e72646dd.jpg","nickname":"å¤šå–çƒ­æ°´","note":"","ucode":"8DB7DB144B7E30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333309,"discussion_content":"å¯èƒ½æ˜¯å¤šä¸ªè¿æ¥å¯¼è‡´çš„å¹¶å‘é—®é¢˜å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607499257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258001,"user_name":"å¥½è¿æ¥","can_delete":false,"product_type":"c1","uid":1113937,"ip_address":"","ucode":"F469ED6CEFEF30","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg","comment_is_top":false,"comment_ctime":1604239378,"is_pvip":true,"discussion_count":7,"race_medal":1,"score":"74618683410","product_id":100056701,"comment_content":"â€œå¯¹äºè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä¿è¯å®ƒä»¬çš„åŸå­æ€§ã€‚å¦åˆ™ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨å¤šçº¿ç¨‹è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°åˆå§‹å€¼ä¸º 0ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº† INCR(ip) æ“ä½œåï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ç´§æ¥ç€ä¹Ÿæ‰§è¡Œäº† INCR(ip)ï¼Œæ­¤æ—¶ï¼Œip å¯¹åº”çš„è®¿é—®æ¬¡æ•°å°±è¢«å¢åŠ åˆ°äº† 2ï¼Œæˆ‘ä»¬å°±æ— æ³•å†å¯¹è¿™ä¸ª ip è®¾ç½®è¿‡æœŸæ—¶é—´äº†ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œè¿™ä¸ª ip å¯¹åº”çš„å®¢æˆ·ç«¯è®¿é—®æ¬¡æ•°è¾¾åˆ° 20 æ¬¡ä¹‹åï¼Œå°±æ— æ³•å†è¿›è¡Œè®¿é—®äº†ã€‚å³ä½¿è¿‡äº† 60sï¼Œä¹Ÿä¸èƒ½å†ç»§ç»­è®¿é—®ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚&quot;<br><br>å¯¹äºè¿™æ®µè¯æˆ‘æœ‰ç–‘æƒ‘ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼Œåˆå§‹ipè®¡æ•°æ˜¯0ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bå¹¶å‘æ‰§è¡Œï¼Œä¸ç®¡çº¿ç¨‹Aå’Œçº¿ç¨‹Bè°å…ˆæ‰§è¡Œåˆ° value = INCR(ip) ï¼Œè·å–åˆ°çš„valueå€¼æ€»ä¼šæœ‰ä¸€ä¸ªæ˜¯1ï¼Œè€Œvalueä½œä¸ºçº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œé‚£ä¸å°±æ˜¯èƒ½å¤Ÿæ‰§è¡Œåˆ° IF value == 1 THEN        EXPIRE(ip,60)    END è¿™ä¸ªåˆ¤æ–­é€»è¾‘äº†å—ï¼Œä¸æ˜ç™½ä¸ºä»€ä¹ˆè¯´ä¸èƒ½è®¾ç½®å…ˆåˆ°çš„ipè¿‡æœŸæ—¶é—´60säº†?<br><br><br><br>","like_count":17,"discussions":[{"author":{"id":1229875,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c4/33/1ffdbf6c.jpg","nickname":"phoenix","note":"","ucode":"036F265771459D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323539,"discussion_content":"å³ä½¿å­˜åœ¨å¹¶å‘ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹è¿”å›1çš„ï¼Œè¿™ä¸ªä¾‹å­æœ‰é—®é¢˜ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1604967176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135901,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/1d/01777aef.jpg","nickname":"åº·ç†™","note":"","ucode":"09D80813A37D41","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569707,"discussion_content":"Incræ˜¯åŸå­æ“ä½œï¼Œä¸¤ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶æ‰§è¡Œè¿™ä¸€è¡Œä»£ç åï¼Œå†æ‰§è¡Œåˆ¤æ–­è¯­å¥æ—¶ï¼Œæ¡ä»¶å·²ç»ä¸æ»¡è¶³äº†ï¼ŒåŸå› æ˜¯incrçš„keyæ˜¯ipè€Œéå±€éƒ¨å˜é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651534901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1993942,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6c/d6/22360bd3.jpg","nickname":"æµ·é˜”å¤©ç©º","note":"","ucode":"003AB0764CA7A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555902,"discussion_content":" å•ç‹¬çš„INCRæ˜¯åŸå­æ“ä½œï¼Œä½†value = INCR(ip)ä¸æ˜¯ï¼›å¯èƒ½ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†INCRæ“ä½œåï¼Œå®¢æˆ·ç«¯æ‰è·å–åˆ°è¿”å›å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647096379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2345422,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c9/ce/6d059da3.jpg","nickname":"çµçŸ³ï¼ˆè¯·å‹¿ä¹±åƒï¼‰","note":"","ucode":"81467807211055","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407308,"discussion_content":"åŒæ²¡çœ‹æ‡‚ï¼Œå¸Œæœ›ä½œè€…ç»™ä¸ªè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634975940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2041396,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","nickname":"å®™æ–¯","note":"","ucode":"80DF36BAD298AD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343306,"discussion_content":"ä½ ä»¬å¯ä»¥çœ‹ä¸‹æ–‡ç« çš„æ³¨é‡Šçœ‹æ˜¯å¦åˆç†ï¼Œæ„¿å¤šå¤šäº¤æµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610993179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1784022,"avatar":"","nickname":"pippin","note":"","ucode":"F7619FCE24D481","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332665,"discussion_content":"ä¸‹ä¸€ç« çš„é—®ç­”åŒºæœ‰ç­”æ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607302588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110944,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f3/a0/5979d4a4.jpg","nickname":"ç¥","note":"","ucode":"34563625CA1206","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320334,"discussion_content":"å¯¹å•Šï¼Œredis å•çº¿ç¨‹ï¼Œæ€»æœ‰ä¸€ä¸ªè¿”å› 1 å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604322288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259395,"user_name":"dfuru","can_delete":false,"product_type":"c1","uid":2110772,"ip_address":"","ucode":"0222FADA093D95","user_header":"","comment_is_top":false,"comment_ctime":1604717820,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"61734259964","product_id":100056701,"comment_content":"è·å–è®¿é—®æ¬¡æ•°å’Œåˆ¤æ–­è®¿é—®æ˜¯å¦å¤§äº20ï¼Œ<br>è‹¥æ”¾åˆ°luaè„šæœ¬ä¸­ï¼Œè·å–åˆ°çš„è®¿é—®æ¬¡æ•°æ˜¯å‡†ç¡®çš„æœ€æ–°å€¼ï¼Œè¿›è¡Œåˆ¤æ–­æ›´å‡†ç¡®ï¼›<br>å½“æ”¾åˆ°luaè„šæœ¬å¤–ï¼Œå¹¶å‘è®¿é—®æ—¶æŸçº¿ç¨‹è·å–åˆ°çš„è®¿é—®æ¬¡æ•°å¯èƒ½æ—§(åå°)ï¼Œå½“è·å–åˆ°è®¿é—®æ¬¡æ•°ä¸º19æ—¶(å®é™…å¯èƒ½å·²ç»è¾¾åˆ°20äº†)ï¼Œè¯¥çº¿ç¨‹ä»ç„¶ä¼šå¯¹è®¿é—®æ¬¡æ•°æ‰§è¡Œ+1ï¼Œæ‰€ä»¥åº”è¯¥æ”¾åˆ°luaä¸­ã€‚","like_count":14,"discussions":[{"author":{"id":1749015,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b0/17/451cb87c.jpg","nickname":"åŠ æ²¹ï¼","note":"","ucode":"947E97762DB6EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540450,"discussion_content":"ä¿ºä¹Ÿæ˜¯\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640059425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1099321,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/39/0b837f63.jpg","nickname":"ä¸éå‹è² ","note":"","ucode":"A1CB36404DB884","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329410,"discussion_content":"æˆ‘ç†è§£ä¹Ÿæ˜¯è¿™æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606381037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1107550,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/5e/62158841.jpg","nickname":"å–ç»äºº","note":"","ucode":"C3668CA65200DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1099321,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/39/0b837f63.jpg","nickname":"ä¸éå‹è² ","note":"","ucode":"A1CB36404DB884","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332196,"discussion_content":"ä¿ºä¹Ÿæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607091180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":329410,"ip_address":""},"score":332196,"extra":""}]}]},{"had_liked":false,"id":261359,"user_name":"Mr.èœœ","can_delete":false,"product_type":"c1","uid":1035257,"ip_address":"","ucode":"C911B81198B3F5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cb/f9/75d08ccf.jpg","comment_is_top":false,"comment_ctime":1605285735,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"35965024103","product_id":100056701,"comment_content":"æ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•° GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ° Lua è„šæœ¬ä¸­ï¼Ÿ<br><br>æˆ‘è§‰å¾—éœ€è¦åˆ†3æ­¥æ¥ä¼˜åŒ–ï¼š<br>1.åœ¨æ‰§è¡Œluaä¹‹å‰ï¼Œget(ip)ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå¤§äº20ï¼Œå°±ç›´æ¥æŠ¥é”™äº†ï¼Œè¿™æ ·ä¹Ÿå°±å‡å°‘äº†æ‰§è¡Œluaçš„å¼€é”€ï¼›<br>2.åœ¨æ‰§è¡Œluaæ—¶ï¼Œåˆ¤æ–­incrï¼ˆipï¼‰çš„è¿”å›å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯åŠ ä¸€ä¹‹åçš„å€¼ï¼Œç›´æ¥åˆ¤æ–­è¿™ä¸ªå€¼æ˜¯å¦å¤§äº20ï¼Œè¿”å›é”™è¯¯ã€‚<br>3.å¦‚æœå¹¶å‘é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨incrå‰å†åˆ¤æ–­ä¸€æ¬¡getï¼ˆipï¼‰ï¼Œå‡å°‘incrçš„å¼€é”€ã€‚","like_count":8,"discussions":[{"author":{"id":1749015,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b0/17/451cb87c.jpg","nickname":"åŠ æ²¹ï¼","note":"","ucode":"947E97762DB6EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540455,"discussion_content":"è¿™ä¸ªè§£å†³æ–¹æ¡ˆå°±æ¯”è¾ƒå¥½äº†ï¼Œä¹Ÿçœå»äº†get(ip)çš„å¼€é”€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640059784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":257450,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1082187,"ip_address":"","ucode":"FC323371453C97","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","comment_is_top":false,"comment_ctime":1603974827,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"35963713195","product_id":100056701,"comment_content":"å¯¹äºè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä¿è¯å®ƒä»¬çš„åŸå­æ€§ã€‚å¦åˆ™ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨å¤šçº¿ç¨‹è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°åˆå§‹å€¼ä¸º 0ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº† INCR(ip) æ“ä½œåï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ç´§æ¥ç€ä¹Ÿæ‰§è¡Œäº† INCR(ip)ï¼Œæ­¤æ—¶ï¼Œip å¯¹åº”çš„è®¿é—®æ¬¡æ•°å°±è¢«å¢åŠ åˆ°äº† 2ï¼Œæˆ‘ä»¬å°±æ— æ³•å†å¯¹è¿™ä¸ª ip è®¾ç½®è¿‡æœŸæ—¶é—´äº†ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œè¿™ä¸ª ip å¯¹åº”çš„å®¢æˆ·ç«¯è®¿é—®æ¬¡æ•°è¾¾åˆ° 20 æ¬¡ä¹‹åï¼Œå°±æ— æ³•å†è¿›è¡Œè®¿é—®äº†ã€‚å³ä½¿è¿‡äº† 60sï¼Œä¹Ÿä¸èƒ½å†ç»§ç»­è®¿é—®ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚<br><br><br>ä¸å¤ªæ˜ç™½ä¸ºä½•è¿‡äº† 60 ç§’ï¼Œä¹Ÿä¸èƒ½ç»§ç»­è®¿é—®å‘¢","like_count":8,"discussions":[{"author":{"id":2017580,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c9/2c/9ed40921.jpg","nickname":"BOB","note":"","ucode":"E86596709EAB1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346976,"discussion_content":"æˆ‘æ²¡ä»”ç»†çœ‹æ–‡ä¸­ä»£ç å—çš„æ—¶å€™ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œä½ çœ‹æ–‡ç¨¿ä¸­çš„ä»£ç å—ï¼Œæ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ª IF value == 1 çš„åˆ¤æ–­ï¼Ÿæ‰€ä»¥å¦‚æœ value å˜æˆ 2 çš„è¯ï¼Œå°±ä¸ä¼šèµ°åˆ°è¿™é‡Œè®¾ç½® EXPIRE äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612111161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1099484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/dc/37dac825.jpg","nickname":"é˜¿è±ª","note":"","ucode":"AF3CB1CE262CEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535483,"discussion_content":"å¦‚æœ value = INCR(ip) ä¸­çš„ value æ˜¯å±€éƒ¨å˜é‡ï¼Œå°±æ€»ä¼šæœ‰ä¸ªçº¿ç¨‹è®¾ç½® EXPIRE","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638449237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327990,"discussion_content":"åŸå› ï¼šä»£ç çš„æ„å›¾æ˜¯é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´60sï¼Œé”®è‡ªåŠ¨æ·˜æ±°ï¼Œæ¥å®ç°å®¢æˆ·ç«¯å¯ä»¥å†æ¬¡è®¿é—®çš„åŠŸèƒ½ã€‚ç°åœ¨ç”±äºæ— æ³•è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´é”®ä¸ä¼šè‡ªåŠ¨æ·˜æ±°ã€‚å› æ­¤åœ¨åˆ¤æ–­åˆ° é”®çš„å€¼åœ¨å¤§äº20åï¼Œæ‹’ç»äº†å®¢æˆ·ç«¯çš„è®¿é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606037417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2107375,"avatar":"https://static001.geekbang.org/account/avatar/00/20/27/ef/a7f94eda.jpg","nickname":"Jerry You","note":"","ucode":"679A44B505482F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326528,"discussion_content":"ä¸²è¡Œæ‰§è¡Œé¡ºåºä¸‹ï¼Œæƒ³è±¡ä¸€ä¸‹ä»»ä½•ä¸€ä¸ªæ“ä½œéƒ½å¯èƒ½åœ¨å¹¶å‘åœºæ™¯ä¸­è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™valueçš„å€¼å°±èƒ½ä¸æ˜¯â‘ äº†ï¼Œå°±æ— æ³•æ‰§è¡Œè®¾ç½®è¶…æ—¶è¿™ä¸ªæ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªkeyå°±ä¸ä¼šè¿‡æœŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605613090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2120877,"avatar":"https://static001.geekbang.org/account/avatar/00/20/5c/ad/3934e3cc.jpg","nickname":"æ–°å¹´å¿«ä¹å•Š","note":"","ucode":"50811438BFAFA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320337,"discussion_content":"åŒé—®ï¼Œæˆ‘ä¹Ÿæ˜¯æœ‰ç‚¹ä¸æ˜ç™½ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œæ€»æœ‰ä¸€ä¸ªçº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªæ‰§è¡ŒINCR(ip)çš„å§ï¼Œè¿™ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹INCRå°±è¿”å›1ï¼Œåº”è¯¥å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´æ‰æ˜¯å‘€ï¼Œæœ‰ç†è§£é”™ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604322799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274321,"user_name":"æ°¸ä¸æ­¢æ­¥","can_delete":false,"product_type":"c1","uid":1098221,"ip_address":"","ucode":"B5228B7EDF5921","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIY8df9yV6vQjOMxv5xym070hFT2GWYELpqBhxSicQoq5IqBx6teS1xJaomkOBeuzv4vkXRJfibqcMw/132","comment_is_top":false,"comment_ctime":1610964212,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"31675735284","product_id":100056701,"comment_content":"é™¤äº†æŠ€æœ¯ä¹‹å¤–ï¼Œæˆ‘è§‰å¾—é‚£æ®µä»£ç çš„åˆ¤æ–­é€»è¾‘åº”è¯¥å±äºä¸šåŠ¡èŒƒç•´ï¼Œæœ€å¥½ä¸è¦æ”¾luaä¸­ï¼Œå› ä¸ºä¸šåŠ¡æ˜¯ç»å¸¸å˜åŒ–çš„ï¼Œluaè„šæœ¬æœ€å¥½ä¸å…·ä½“ä¸šåŠ¡æ— å…³","like_count":7,"discussions":[{"author":{"id":1749015,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b0/17/451cb87c.jpg","nickname":"åŠ æ²¹ï¼","note":"","ucode":"947E97762DB6EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540454,"discussion_content":"é‚£å°±éœ€è¦ä¸šåŠ¡ä»£ç åšå¹¶å‘æ§åˆ¶äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640059570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311122,"user_name":"éƒ‘å°","can_delete":false,"product_type":"c1","uid":1005282,"ip_address":"","ucode":"181B0FDE5E1532","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/e2/2dcab30d.jpg","comment_is_top":false,"comment_ctime":1631081025,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18810950209","product_id":100056701,"comment_content":"æ„Ÿè§‰ â€œRedis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„â€  è¿™å¥è¯æœ‰è¯¯å¯¼ï¼Œå½“luaè„šæœ¬ä¸­é—´æœ‰å‘½ä»¤æ‰§è¡Œå‡ºé”™æ—¶ï¼Œä»¥æ‰§è¡Œçš„å‘½ä»¤è¿˜æ˜¯ç”Ÿæ•ˆäº†çš„ï¼Œè¿™æ ·ä¸èƒ½å®Œå…¨ç§°ä¹‹ä¸ºåŸå­æ€§ã€‚redisåªæ˜¯é€šè¿‡luaè„šæœ¬è®©ä¸€ç»„å‘½ä»¤æƒ³ä¸€ä¸ªå‘½ä»¤ä¸€æ ·æ‰§è¡Œåœ¨åŠ ä¸Šå•çº¿ç¨‹çš„ç‰¹æ€§é¿å…äº†å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ï¼Œè€Œä¸èƒ½ç§°ä¹‹ä¸ºåŸå­æ€§ã€‚","like_count":4,"discussions":[{"author":{"id":1368768,"avatar":"https://static001.geekbang.org/account/avatar/00/14/e2/c0/e7a59706.jpg","nickname":"chongsheng","note":"","ucode":"859DF328FCA608","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576398,"discussion_content":"è¿™é‡Œçš„åŸå­æ€§æŒ‡çš„æ˜¯åŸå­æ“ä½œï¼Œå¹¶ä¸æ˜¯äº‹åŠ¡çš„åŸå­æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655519134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1675882,"avatar":"https://static001.geekbang.org/account/avatar/00/19/92/6a/dd37a054.jpg","nickname":"å¼ y .","note":"","ucode":"85918469492F4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413023,"discussion_content":"æ˜¯çš„ï¼Œè¿™ä¸ªæè¿°æ˜¯å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636361927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1292669,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaaDFHiag4sFcO7JUn028Mtk1YvFpibIibLzcTE7Qak0icJklMpqh7k5dSK27dibicMuNgYMozgaibeYppA/132","nickname":"Bball","note":"","ucode":"E483CAFE50CB99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412681,"discussion_content":"åŒæ„ï¼ŒLuaæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œä¸ä¿è¯åŸå­æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636253667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277072,"user_name":"huiye","can_delete":false,"product_type":"c1","uid":2225782,"ip_address":"","ucode":"8B57DE0F3C92E6","user_header":"https://static001.geekbang.org/account/avatar/00/21/f6/76/f7666f76.jpg","comment_is_top":false,"comment_ctime":1612253043,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14497154931","product_id":100056701,"comment_content":"é™¤äº†æŠŠå¤šä¸ªæ“ä½œåœ¨ Redis ä¸­å®ç°æˆä¸€ä¸ªæ“ä½œï¼Œå’Œä½¿ç”¨luaè„šæœ¬ï¼Œä½¿ç”¨redisçš„äº‹åŠ¡ï¼ŒæŠŠå¤šä¸ªå‘½ä»¤æ”¾å…¥é˜Ÿåˆ—é‡Œä¸€èµ·æ‰§è¡Œï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½ä¿è¯åŸå­æ€§å‘¢","like_count":3,"discussions":[{"author":{"id":2049478,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/45/c6/ba5176a6.jpg","nickname":"ä»ä¸å–èŒ","note":"","ucode":"E9B7B1C8FAFE0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352622,"discussion_content":"åŸç†æ˜¯ä¸€æ ·çš„ï¼Œæ”¾åœ¨é˜Ÿåˆ—é¢å¤–æ¶ˆè€—æ€§èƒ½ï¼Œå®˜ç½‘æœ‰æä¾›pipeline,å…·ä½“å¯ä»¥å‚è€ƒhttps://blog.csdn.net/u013870094/article/details/82461527","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614781732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":257412,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1603962914,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"14488864802","product_id":100056701,"comment_content":"æ€è€ƒé¢˜<br>æ€è€ƒé¢˜ï¼šæ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯ GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ° Lua è„šæœ¬ä¸­å—ï¼Ÿ<br>æˆ‘è§‰å¾—ä¸éœ€è¦å°†å…¶æ·»åŠ åˆ° Lua è„šæœ¬ä¸­ï¼Œç†ç”±å¦‚ä¸‹ï¼š<br>1.è·å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•°å’Œåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 å¹¶æ²¡æœ‰è¿›è¡Œ R-M-W æ“ä½œå³è¿™ä¸ªä»£ç æ²¡æœ‰æ“ä½œä¸´ç•ŒåŒºä»£ç ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜<br>2.å› ä¸ºå¦‚æœæŠŠæ›´å¤šæ“ä½œåŠ åˆ° Lua è„šæœ¬ä¸­ï¼Œä¼šå¯¼è‡´ Redis æ‰§è¡Œ Lua è„šæœ¬çš„æ—¶é—´å¢åŠ ï¼Œä¼šé™ä½ Redis çš„å¹¶å‘æ€§èƒ½ï¼Œå»ºè®®å°±æ˜¯åœ¨ç¼–å†™ Lua è„šæœ¬ä¸­ï¼Œè¦é¿å…æ·»åŠ ä¸éœ€è¦åšå¹¶å‘æ§åˆ¶çš„ä»£ç <br><br>è¡¥å……<br>ä¸Šé¢çš„ Lua è„šæœ¬ä¸­æœ‰ä¸€ä¸ªæ˜¯åˆ¤æ–­æ¬¡æ•°æ˜¯å¦ä¸º 1ï¼ŒæŒ‰é“ç†è¿™ä¸ªæ“ä½œä¹Ÿæ˜¯è¯»æ“ä½œï¼Œæ²¡æœ‰æ“ä½œä¸´ç•ŒåŒºçš„ä»£ç ï¼Œä¸ºä½•è¦æŠŠå®ƒåŠ åˆ° Lua è„šæœ¬ä¸­å‘¢ï¼Ÿ<br>è¿™ä¸ªæ˜¯å› ä¸ºå®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•° +1 å’Œ åˆ¤æ–­æ˜¯å¦ç­‰äº 1 ï¼Œå’Œåé¢çš„è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¸€ä¸ªæœ€å°çš„é€»è¾‘å•å…ƒï¼Œè¿™ä¸ªåˆ¤æ–­ä¼šå½±å“åˆ°åé¢è¿‡æœŸæ—¶é—´çš„è®¾ï¼Œæ‰€ä»¥è¿™ä¸ªè¯»æ“ä½œè¦åŠ å…¥åˆ° Lua è„šæœ¬ä¸­","like_count":3},{"had_liked":false,"id":256624,"user_name":"æ³ å°å¢¨","can_delete":false,"product_type":"c1","uid":1178634,"ip_address":"","ucode":"73D296D9F42911","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/0a/0c4b9170.jpg","comment_is_top":false,"comment_ctime":1603692520,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"14488594408","product_id":100056701,"comment_content":"å…³äºæœ€åçš„é—®é¢˜ï¼Œæˆ‘è§‰å¾—å¯ä»¥ä¸åˆ¤æ–­è®¿é—®æ¬¡æ•°ï¼Œå‰æç¨å¾®ä¿®æ”¹ä¸‹luaè„šæœ¬ï¼Œå°†currentçš„å€¼è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®è¿”å›å€¼è¿›è¡Œå¤„ç†ï¼›<br>local current <br>current = redis.call(&#39;incr&#39;,KEYS[1]) <br>if tonumber(current)==1 then redis.call(&#39;expire&#39;,KEYS[1],60) <br>end  <br>return current","like_count":3,"discussions":[{"author":{"id":2253496,"avatar":"","nickname":"Geek_3d87cb","note":"","ucode":"F09334D60C3BC8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318617,"discussion_content":"æç«¯åœºæ™¯ä¸‹è¿˜ä¼šæœ‰é—®é¢˜å§,å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‹¿åˆ°è®¿é—®æ¬¡æ•°ä¸º20","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603791144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1622022,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJia6zEsh2u119zJicmq7wApvnricZEKiawaZicice1cOzujWdFicFwPtavlHiaVpCNgCpxBtdl7ynd3y0wkQ/132","nickname":"james_xu","note":"","ucode":"12E50291F5BA89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2253496,"avatar":"","nickname":"Geek_3d87cb","note":"","ucode":"F09334D60C3BC8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362963,"discussion_content":"å¤šä¸ªluaè„šæœ¬ä¼šä¸²è¡Œæ‰§è¡Œï¼Œä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ‹¿åˆ°20çš„å§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617080707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318617,"ip_address":""},"score":362963,"extra":""},{"author":{"id":1675882,"avatar":"https://static001.geekbang.org/account/avatar/00/19/92/6a/dd37a054.jpg","nickname":"å¼ y .","note":"","ucode":"85918469492F4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1622022,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJia6zEsh2u119zJicmq7wApvnricZEKiawaZicice1cOzujWdFicFwPtavlHiaVpCNgCpxBtdl7ynd3y0wkQ/132","nickname":"james_xu","note":"","ucode":"12E50291F5BA89","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413022,"discussion_content":"Rediså…ˆæ‰§è¡Œçš„å¤šä¸ªè¯»ï¼Œç„¶åå†æ‰§è¡Œå†™ä¸å°±æœ‰é—®é¢˜äº†ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636361891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":362963,"ip_address":""},"score":413022,"extra":""},{"author":{"id":2436755,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2e/93/81e3e4ca.jpg","nickname":"à¸…Slekà¸…","note":"","ucode":"B732C672B3D301","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2253496,"avatar":"","nickname":"Geek_3d87cb","note":"","ucode":"F09334D60C3BC8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558797,"discussion_content":"å¤šä¸ªçº¿ç¨‹è¯»æ“ä½œå¯¼è‡´æ‹¿åˆ°çš„éƒ½æ˜¯20ä¹Ÿæ²¡äº‹ï¼Œå› ä¸ºæœ€ç»ˆéƒ½æ˜¯ä¸²è¡Œåœ°æ‰§è¡Œluaã€‚æ‰§è¡Œluaçš„æ—¶å€™ä¾æ—§ä¼šåˆ¤æ–­currentå€¼çš„å¤§å°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648469669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318617,"ip_address":""},"score":558797,"extra":""}]}]},{"had_liked":false,"id":320698,"user_name":"James_Shangguan","can_delete":false,"product_type":"c1","uid":1262808,"ip_address":"","ucode":"F5855BC008DDEA","user_header":"https://static001.geekbang.org/account/avatar/00/13/44/d8/1a1761f9.jpg","comment_is_top":false,"comment_ctime":1636459335,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10226393927","product_id":100056701,"comment_content":"ä¸éœ€è¦åŠ åˆ°Luaè„šæœ¬é‡Œé¢ã€‚å¹¶å‘ç¼–ç¨‹æ€æƒ³é‡Œé¢ï¼Œé™ä½é”çš„ç²’åº¦ï¼Œæé«˜å¹¶å‘çš„æ€§èƒ½ã€‚","like_count":2,"discussions":[{"author":{"id":2649276,"avatar":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","nickname":"Leo","note":"","ucode":"CEBAD9CDCFC2A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561280,"discussion_content":"éœ€è¦çš„ï¼Œå¦‚æœä¸å¦¨çš„è¯ä¼šè¶…20æ¬¡çš„è®¿é—®é™åˆ¶ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649592671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277991,"user_name":"Geek_89e362","can_delete":false,"product_type":"c1","uid":2308075,"ip_address":"","ucode":"E596C2CFE1CFAF","user_header":"","comment_is_top":false,"comment_ctime":1612691620,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10202626212","product_id":100056701,"comment_content":"æˆ‘æ„Ÿè§‰éœ€è¦ï¼Œæ¯”å¦‚å½“å‰ count ä¸º19 ï¼Œä½†æ˜¯å¹¶å‘ä¸Šæ¥ä¸‰ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨getè·å–çš„éƒ½æ˜¯19ï¼Œå°äº20ï¼Œé‚£ä¹ˆè®¿é—®çš„æ¬¡æ•°å¯èƒ½å°±ä¼šè¶…è¿‡20äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1566642,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e7/b2/4cb8356a.jpg","nickname":"å°ç”²é±¼","note":"","ucode":"DDF8A3A4976681","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352389,"discussion_content":"æ˜¯çš„ï¼Œæ‰€ä»¥å¦‚æœå¹¶å‘ä¸Šæ¥äº†ï¼Œè¿™ä¸ªå†™åˆ°Luaä¸­è¿˜æ˜¯ä¿é™©ä¸€ç‚¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614699324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264623,"user_name":"Geek_750e24","can_delete":false,"product_type":"c1","uid":2310617,"ip_address":"","ucode":"7C8D33FEEA47B0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZGbq9QcsysWhYJvIXaZ0S9llXDVicF0Tvm2ibgGehHCPYWxHzZ2Z34SVOyIOKkH44qPFCANBbib2iawqrWU7azD3og/132","comment_is_top":false,"comment_ctime":1606551176,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10196485768","product_id":100056701,"comment_content":"  value = INCR(ip)    &#47;&#47;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå°†é”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º60så  <br>  IF value == 1 <br>  THEN       <br>  EXPIRE(ip,60)    <br>END<br>æ‰§è¡Œ INCRå‘½ä»¤è¿”å›valueä¸æ˜¯åŸå­æ“ä½œä¹ˆï¼Ÿå°±ç®—ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œäº†INCRï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿”å›çš„ä¸æ˜¯1ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377069,"discussion_content":"è€å¸ˆåº”è¯¥å°† value è€ƒè™‘ä¸ºå…¨å±€å˜é‡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622476339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256553,"user_name":"å¯æ€œå¤§ç°ç‹¼","can_delete":false,"product_type":"c1","uid":1928373,"ip_address":"","ucode":"6CA9D6D460B967","user_header":"https://static001.geekbang.org/account/avatar/00/1d/6c/b5/32374f93.jpg","comment_is_top":false,"comment_ctime":1603676414,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10193611006","product_id":100056701,"comment_content":"æˆ‘è§‰å¾—get(ip)å¯ä»¥ä¸éœ€è¦ï¼Œå› ä¸ºincrå·²ç»å¯ä»¥è¿”å›å½“å‰è®¿é—®æ¬¡æ•°ï¼Œcurrentå€¼å¤§äº20çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›å®¢æˆ·ç«¯åŠ é”å¤±è´¥ã€‚ä½†æ˜¯åˆ¤æ–­æ˜¯å¦è¶…è¿‡20æ¬¡é€»è¾‘ï¼Œåº”è¯¥è¦åŠ åˆ°luaè„šæœ¬ä¸­ï¼Œä¸ç„¶æ²¡æ³•ä¿è¯å¯¹æ§åˆ¶æ¬¡æ•°çš„åŸå­æ€§","like_count":2},{"had_liked":false,"id":256538,"user_name":"å†¯ä¼ åš","can_delete":false,"product_type":"c1","uid":1177787,"ip_address":"","ucode":"91B9A1EF0FF042","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/bb/8b2ba45d.jpg","comment_is_top":false,"comment_ctime":1603672866,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10193607458","product_id":100056701,"comment_content":"å¯¹äºè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä¿è¯å®ƒä»¬çš„åŸå­æ€§ã€‚å¦åˆ™ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨å¤šçº¿ç¨‹è®¿é—®ï¼Œè®¿é—®æ¬¡æ•°åˆå§‹å€¼ä¸º 0ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº† INCR(ip) æ“ä½œåï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ç´§æ¥ç€ä¹Ÿæ‰§è¡Œäº† INCR(ip)ï¼Œæ­¤æ—¶ï¼Œip å¯¹åº”çš„è®¿é—®æ¬¡æ•°å°±è¢«å¢åŠ åˆ°äº† 2ï¼Œæˆ‘ä»¬å°±æ— æ³•å†å¯¹è¿™ä¸ª ip è®¾ç½®è¿‡æœŸæ—¶é—´äº†ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œè¿™ä¸ª ip å¯¹åº”çš„å®¢æˆ·ç«¯è®¿é—®æ¬¡æ•°è¾¾åˆ° 20 æ¬¡ä¹‹åï¼Œå°±æ— æ³•å†è¿›è¡Œè®¿é—®äº†ã€‚å³ä½¿è¿‡äº† 60sï¼Œä¹Ÿä¸èƒ½å†ç»§ç»­è®¿é—®ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚<br><br><br>å¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹æ­£å¸¸æ‰§è¡Œï¼Œæ˜¯èƒ½å¤Ÿç»™ipè®¾ç½®è¿‡æœŸæ—¶é—´çš„ï¼Œä¹Ÿå°±èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡ã€‚å‡ºç°æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„æƒ…æ™¯ï¼Œæ˜¯çº¿ç¨‹ä¸€åœ¨è®¾ç½®è¿‡æœŸæ—¶é—´ä¹‹å‰é€€å‡ºäº†ã€‚<br><br>è¿™æ®µä»£ç è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨é«˜å¹¶å‘çš„æ—¶å€™20æ¬¡çš„è®¿é—®é™åˆ¶å¯èƒ½ä¼šè¢«å‡»ç©¿ï¼Œä¹Ÿå°±æ˜¯è®¿é—®æ¬¡æ•°èƒ½å¤Ÿè¶…è¿‡20æ¬¡ã€‚<br><br>ä¸çŸ¥ç†è§£æ˜¯å¦äº‰å–ï¼Œè¯·è€å¸ˆæŒ‡æ•™","like_count":2,"discussions":[{"author":{"id":1221628,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a3/fc/379387a4.jpg","nickname":"ly","note":"","ucode":"5E2B85252DABF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370599,"discussion_content":"incræ˜¯åŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹ä¸‹æ¯ä¸ªçº¿ç¨‹çš„è¿”å›å€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸ªçº¿ç¨‹è‚¯å®šä¼šå¾—åˆ°1è¿™ä¸ªå€¼ï¼Œå¦‚æœcurrentæ˜¯å…¨å±€å˜é‡å¯èƒ½å°±æœ‰é—®é¢˜ã€‚  åæ§½ä¸€ä¸‹ï¼šè¿™ä¸ªä¸“æ ä¿¡æ¯é‡è¿˜æ˜¯å¾ˆå¤§ï¼Œå°±æ˜¯è¯„è®ºåŒºçš„ç–‘é—®è€å¸ˆéƒ½ä¸å‡ºæ¥å›ç­”ï¼Œå’Œmysqlä¸“æ æ¯”èµ·æ¥ç¡®å®æœ‰ç›¸å½“çš„è½å·®æ„Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619482857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098221,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIY8df9yV6vQjOMxv5xym070hFT2GWYELpqBhxSicQoq5IqBx6teS1xJaomkOBeuzv4vkXRJfibqcMw/132","nickname":"æ°¸ä¸æ­¢æ­¥","note":"","ucode":"B5228B7EDF5921","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343176,"discussion_content":"è¿™æ®µä»£ç å°±æ˜¯ä¸ªç¤ºä¾‹ï¼Œä½œè€…è¦è¡¨è¾¾çš„æ˜¯å¤šæ“ä½œçš„åŸå­æ€§ï¼Œä¸å¿…å¤ªè¿‡çº ç»“è¿™é‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610962001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1774561,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/13/e1/5b02e391.jpg","nickname":"lafjkdlsfdk","note":"","ucode":"95C45C8ABB1485","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321892,"discussion_content":"è¯´çš„æœ‰é“ç†ï¼Œæœ‰äº›åœ°æ–¹ï¼Œè¿™è€å¸ˆéƒ½è®²çš„ä¸æ¸…ä¸æ¥šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604646221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290369,"user_name":"è€å¤§ä¸å°","can_delete":false,"product_type":"c1","uid":1295609,"ip_address":"","ucode":"35BCDD3CB13467","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJRFRX8kNzNet7FibNvtavbVpAwK09AhIhrib9k762qWtH6mre8ickP7hM5mgZC4ytr8NnmIfmAhxMSQ/132","comment_is_top":false,"comment_ctime":1619516817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5914484113","product_id":100056701,"comment_content":"ä¹‹å‰æ–‡ç« é‡Œä¸æ˜¯æœ‰è®²å¦å¤–ä¸€ç§æ–¹å¼â€”â€”MULTIå’ŒEXECå—ï¼Ÿè¿™ç§æ˜¯ä¸æ˜¯å¯ä»¥å®ç°luaè„šæœ¬ä¸€æ ·çš„åŠŸèƒ½ï¼Ÿ","like_count":1},{"had_liked":false,"id":256864,"user_name":"éƒ­åµ©é˜³","can_delete":false,"product_type":"c1","uid":1080998,"ip_address":"","ucode":"9DC42C7B73F580","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/a6/188817b6.jpg","comment_is_top":false,"comment_ctime":1603767913,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5898735209","product_id":100056701,"comment_content":"æƒ³é—®ä¸‹è€å¸ˆ,ä½ ä»¬åœ¨å¼€å‘é¡¹ç›®ä¸­æ˜¯å¦ï¼Œç»å¸¸ä½¿ç”¨luaè„šæœ¬.æˆ–è€…æ˜¯å¦å»ºè®®ç»å¸¸å»ä½¿ç”¨luaè„šæœ¬,ä¸ªäººè§‰å¾—luaè„šæœ¬ç»´æŠ¤ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œç›¸å¬ä¸€ä¸‹è€å¸ˆçš„æ„è§","like_count":1},{"had_liked":false,"id":359473,"user_name":"beifengzhishen001","can_delete":false,"product_type":"c1","uid":2109853,"ip_address":"é‡åº†","ucode":"77D42B7DD9E754","user_header":"","comment_is_top":false,"comment_ctime":1665563881,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665563881","product_id":100056701,"comment_content":"multi&#47;execæ‰§è¡Œçš„ç»„åˆè¯­å¥ï¼Œå‡è®¾æ‰€æœ‰è¯­å¥éƒ½æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œç®—ä¸ç®—åŸå­æ“ä½œå‘¢ï¼Ÿè€ƒè™‘åˆ°redisæ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚éƒ½æ˜¯å¹¶è¡Œæ“ä½œï¼Œçœ‹åˆ°ç¬¬31èŠ‚çš„å†…å®¹åï¼Œå›è¿‡å¤´æ¥çœ‹æœ¬èŠ‚æœ‰äº†è¿™ä¸ªç–‘é—®ã€‚","like_count":0},{"had_liked":false,"id":341419,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2649276,"ip_address":"","ucode":"CEBAD9CDCFC2A3","user_header":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","comment_is_top":false,"comment_ctime":1649592151,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649592151","product_id":100056701,"comment_content":"ä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªluaè„šæœ¬å†…å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š<br>1. åˆ¤æ–­æ”¹ipæ˜¯å¦ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œæ˜¯çš„è¯è®¾ç½®è¿‡æœŸæ—¶é—´60ç§’ï¼ŒåŒæ—¶è¯¥ipè®¿é—®æ¬¡æ•°+1;<br>2. å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œä¸”è®¿é—®æ¬¡æ•°å°äº20ï¼Œé‚£ä¹ˆåˆ™åœ¨å½“å‰æ¬¡æ•°ä¸Š+1ï¼›<br>3.å¦‚æœå½“å‰æ¬¡æ•°å¤§äºç­‰äº20ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸è¿›è¡Œåç»­é€»è¾‘ï¼›<br>è¿™æ ·æ‰€æœ‰æ“ä½œéƒ½é€šè¿‡luaè„šæœ¬å®ç°åŸå­æ€§ï¼Œæ›´èƒ½ä¿è¯å‡†ç¡®åŠå¹¶å‘æ€§ï¼›ä¸ºä»€ä¹ˆæ–‡ç« ä¸­æ²¡æœ‰è¿™ç§æ–¹å¼","like_count":0},{"had_liked":false,"id":341417,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2649276,"ip_address":"","ucode":"CEBAD9CDCFC2A3","user_header":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","comment_is_top":false,"comment_ctime":1649591505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649591505","product_id":100056701,"comment_content":"è¿™ç§è¯»å–æ–¹å¼å’Œå¡å…¥æ–¹å¼åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¸€å®šä¼šè¶…è¿‡20ï¼Œå› ä¸ºè¯»å–å’Œå¢åŠ å€¼è¿™ä¸¤ä¸ªåŠ¨ä½œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŸå­æ€§æ“ä½œï¼›é‚£ä¹ˆå¿…å®šä¼šäº§ç”Ÿä¸¤ä¸ªçº¿ç¨‹éƒ½è¯»å–æ¬¡æ•°ä¸º19ï¼Œç„¶åä¸¤ä¸ªçº¿ç¨‹éƒ½åŠ 1è¶…è¿‡20æ¬¡çš„æƒ…å†µï¼›","like_count":0},{"had_liked":false,"id":340052,"user_name":"å¼ æ½‡èµŸ","can_delete":false,"product_type":"c1","uid":1132192,"ip_address":"","ucode":"1A45B57F9E0723","user_header":"https://static001.geekbang.org/account/avatar/00/11/46/a0/aa6d4ecd.jpg","comment_is_top":false,"comment_ctime":1648555875,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648555875","product_id":100056701,"comment_content":"è€å¸ˆè¯´çš„åœºæ™¯æ˜¯é™æµï¼Œæ‰€ä»¥æˆ‘ç†è§£å¦‚æœå¤šå‡ æ¬¡è®¿é—®åº”è¯¥æ˜¯é—®é¢˜ä¸å¤§çš„ã€‚æ‰€ä»¥å¯ä»¥å°†get å’Œæ¯”è¾ƒæ”¾åœ¨luaè„šæœ¬å¤–æ‰§è¡Œã€‚è¿™æ ·å°½å¯èƒ½çš„é™ä½luaè„šæœ¬çš„æˆæœ¬","like_count":0},{"had_liked":false,"id":336263,"user_name":"woJA1wCgAAhIGt04eEHVRfOeioAo1Eng","can_delete":false,"product_type":"c1","uid":2921031,"ip_address":"","ucode":"59FA0B04617F5C","user_header":"","comment_is_top":false,"comment_ctime":1646040240,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646040240","product_id":100056701,"comment_content":"ç›¸å½“äºæŠŠå®¢æˆ·ç«¯å¤šçº¿ç¨‹å¯èƒ½äº§ç”Ÿçš„å¹¶å‘äº¤ç»™rediså•çº¿ç¨‹æ¨¡å‹æ¥è§£å†³ï¼Œä½†æ˜¯åŒæ—¶å°†redisçŸ­æš‚é˜»å¡ä½œä¸ºä»£ä»·äº¤æ¢ã€‚ä¸çŸ¥é“è¿™ä¸ªç†è§£å¯¹ä¸å¯¹","like_count":0},{"had_liked":false,"id":336256,"user_name":"woJA1wCgAAhIGt04eEHVRfOeioAo1Eng","can_delete":false,"product_type":"c1","uid":2921031,"ip_address":"","ucode":"59FA0B04617F5C","user_header":"","comment_is_top":false,"comment_ctime":1646039115,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646039115","product_id":100056701,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„è¿™ç¯‡æ–‡ç« ï¼Œè¯»å®Œæ‰æ˜ç™½åŸå­æ“ä½œå’Œluaè„šæœ¬å¦‚ä½•å®ç°å®¢æˆ·ç«¯å¯¹redisçš„å¹¶å‘è®¿é—®ã€‚è§‰å¾—å¦‚æœå¯¹è¿™ç‚¹ä¸å¤ªæ¸…æ¥šçš„åŒå­¦å¯ä»¥è¿”å›ç»“åˆæœ¬ç‰‡å’Œredisçš„å•çº¿ç¨‹æ¨¡å‹é‚£ä¸€ç¯‡çœ‹ä¸€ä¸‹å¯èƒ½ä¼šæ›´æ¸…æ™°ã€‚","like_count":0},{"had_liked":false,"id":331844,"user_name":"å‰‘å…«","can_delete":false,"product_type":"c1","uid":1297630,"ip_address":"","ucode":"0A09F41DB8A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","comment_is_top":false,"comment_ctime":1642825029,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642825029","product_id":100056701,"comment_content":"ä¸šåŠ¡åœºæ™¯ä¸è¦æ±‚ç‰¹åˆ«ç²¾ç¡®çš„è¯ï¼Œä¸éœ€è¦åŸå­å¹¶å‘<br>åŸºæœ¬é€»è¾‘è·å–keyï¼Œä¸å­˜åœ¨è®¾ç½®ä¸‹keyåŠè¶…æ—¶æ—¶é—´ï¼Œå­˜åœ¨å°±åŠ ä¸‹æ”¾å›å»","like_count":0},{"had_liked":false,"id":321230,"user_name":"adrian_xia","can_delete":false,"product_type":"c1","uid":1101454,"ip_address":"","ucode":"957C329EAFD31C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/8e/204736bb.jpg","comment_is_top":false,"comment_ctime":1636718394,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1636718394","product_id":100056701,"comment_content":"å¯ä»¥å¢åŠ åŒé‡çš„æ ¡éªŒï¼Œé¦–æ¬¡å…ˆè¿›è¡Œåˆ¤æ–­ï¼Œè‹¥æ˜¯å°äº20çš„è¯ï¼Œåˆ™å¯ä»¥å†luaè„šæœ¬å†…å†å¢åŠ ä¸€æ¬¡æ ¡éªŒã€‚","like_count":0},{"had_liked":false,"id":320470,"user_name":"ç“œç‰›","can_delete":false,"product_type":"c1","uid":2273620,"ip_address":"","ucode":"5EB7D2F4400A70","user_header":"https://static001.geekbang.org/account/avatar/00/22/b1/54/6d663b95.jpg","comment_is_top":false,"comment_ctime":1636344974,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636344974","product_id":100056701,"comment_content":"é‚£æ®µluaè„šæœ¬é‡ŒåŠ è¿‡æœŸæ—¶é—´æ˜¯ç›´æ¥ç”¨çš„incrè¿”å›å€¼==1è¿›è¡Œåˆ¤æ–­çš„ï¼Œincræ˜¯åŸå­æ€§çš„ï¼Œä¸ºå•¥å¹¶å‘è¿˜ä¼šå¯¼è‡´è®¾ç½®è¿‡æœŸæ—¶é—´ä¸æˆåŠŸï¼Ÿ","like_count":0},{"had_liked":false,"id":308730,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1629773888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629773888","product_id":100056701,"comment_content":"ä¸Šé¢å·²ç»è¯´äº†,éœ€è¦é¿å…å°†ä¸éœ€è¦åšå¹¶å‘æ§åˆ¶çš„æ“ä½œå†™å…¥è„šæœ¬ä¸­<br>æ‰€ä»¥ä¸åº”è¯¥æ”¾è¿›å»<br>è€Œä¸”åœ¨ä¸Šé¢incrçš„ä»£ç ä¸­,å¾ˆæ˜æ˜¾,valueæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…çš„å˜é‡å°±è¡Œ,è®¾ç½®ä¸ºå…¨å±€å˜é‡æ˜¯ä¸€ä¸ªç¼–ç¨‹ä¸Šçš„çº°æ¼","like_count":0},{"had_liked":false,"id":308597,"user_name":"æ„ç¦è¡Œ","can_delete":false,"product_type":"c1","uid":1637619,"ip_address":"","ucode":"B940AA60B5CCEE","user_header":"https://static001.geekbang.org/account/avatar/00/18/fc/f3/28fe16cf.jpg","comment_is_top":false,"comment_ctime":1629695116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629695116","product_id":100056701,"comment_content":"åœ¨ç¼–å†™ Lua è„šæœ¬æ—¶ï¼Œä½ è¦é¿å…æŠŠä¸éœ€è¦åšå¹¶å‘æ§åˆ¶çš„æ“ä½œå†™å…¥è„šæœ¬ä¸­ã€‚Redis ä¸æ˜¯ä¸²è¡Œåœ¨æ‰§è¡Œå‘½ä»¤å—ï¼ŒåŒæ ·çš„å‘½ä»¤å†™åœ¨ Lua è„šæœ¬é‡Œå’Œç›´æ¥æ‰§è¡Œåº”è¯¥æ˜¯ä¸€æ ·çš„å§ï¼Œæ˜¯å› ä¸º Lua è„šæœ¬é‡Œçš„å‘½ä»¤å¤šäº†ä¼šå¯¼è‡´æ‰§è¡Œæ—¶é—´å˜é•¿ï¼Œå¯¼è‡´ Redis é˜»å¡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":302053,"user_name":"åŒ—é£å°‘å¹´","can_delete":false,"product_type":"c1","uid":2462472,"ip_address":"","ucode":"35FADF0C69564B","user_header":"https://static001.geekbang.org/account/avatar/00/25/93/08/7fcf715d.jpg","comment_is_top":false,"comment_ctime":1626057092,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626057092","product_id":100056701,"comment_content":"å¦‚æœå•çº¯æ˜¯ä¸ºäº†åŸå­æ€§æ‰§è¡Œå¤šæ¡Rediså‘½ä»¤ï¼Œjavaé‡Œé¢æˆ‘å€’æ˜¯ç»å¸¸ç”¨Redissonï¼Œå®ƒæœ€ç»ˆä¹Ÿæ˜¯æ‰§è¡Œçš„luaè„šæœ¬ï¼Œç›´æ¥ä½¿ç”¨luaè„šæœ¬ï¼Œä¸ªäººæ„Ÿè§‰è°ƒè¯•èµ·æ¥ä¸æ˜¯ç‰¹åˆ«ä¾¿æ·","like_count":0},{"had_liked":false,"id":296002,"user_name":"å°é±¼","can_delete":false,"product_type":"c1","uid":1248115,"ip_address":"","ucode":"022B6D5D69DB68","user_header":"https://static001.geekbang.org/account/avatar/00/13/0b/73/44fe2df9.jpg","comment_is_top":false,"comment_ctime":1622699944,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622699944","product_id":100056701,"comment_content":"ç®€å•æ€»ç»“å°±æ˜¯redisæ‰§è¡Œå‘½ä»¤æ˜¯åŸå­æ“ä½œçš„ï¼Œä½†æ˜¯æœ‰äº›æ“ä½œä¸æ˜¯ä¸€ä¸ªå‘½ä»¤å¯ä»¥æå®šçš„å°±éœ€è¦è€ƒè™‘å¹¶å‘ã€‚rediså¤„ç†å¹¶å‘æœ‰ä¸¤ç§æ–¹å¼ï¼šç¬¬ä¸€ç§åŠ é”ï¼ˆåˆ†å¸ƒå¼é”ï¼‰ï¼›ç¬¬äºŒç§luaè„šæœ¬æˆ–è€…incr,decr æœ¬è´¨ä¸Šè¿˜æ˜¯æŠŠå‘½ä»¤å˜æˆåŸå­å‘½ä»¤","like_count":0},{"had_liked":false,"id":295165,"user_name":"å¤œè¾‰","can_delete":false,"product_type":"c1","uid":1886331,"ip_address":"","ucode":"9421385F51FF9E","user_header":"https://static001.geekbang.org/account/avatar/00/1c/c8/7b/153181d7.jpg","comment_is_top":false,"comment_ctime":1622277317,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622277317","product_id":100056701,"comment_content":"é—®é¢˜ï¼šRedis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œæ˜¯å¯ä»¥ä¿è¯åŸå­æ€§çš„ï¼Œé‚£ä¹ˆï¼Œ åœ¨æˆ‘ä¸¾çš„ Lua è„šæœ¬ä¾‹å­ï¼ˆlua.scriptï¼‰ä¸­ï¼Œä½ è§‰å¾—æ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•°ï¼Œ ä¹Ÿå°±æ˜¯ GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ° Lua è„šæœ¬ä¸­å—ï¼Ÿ<br><br>åŠ å…¥ï¼Œé™ä½æ‰§è¡Œå¹¶å‘é‡<br>ä¸åŠ å…¥ï¼Œå‡†ç¡®é™æµåŠŸèƒ½å­˜åœ¨é—®é¢˜","like_count":0},{"had_liked":false,"id":286283,"user_name":"ä¸‰å£ä¸€å¤´çŒ«","can_delete":false,"product_type":"c1","uid":1317496,"ip_address":"","ucode":"96261B6675E63B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/78/74275977.jpg","comment_is_top":false,"comment_ctime":1617239865,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1617239865","product_id":100056701,"comment_content":"è¯·é—®è€å¸ˆ å¦‚æœæ˜¯åšåˆ‡ç‰‡é›†ç¾¤æˆ–è€…ä¸»ä»æ¨¡å¼è¿™ç§è¿˜é€‚åˆä½¿ç”¨luaå—","like_count":0,"discussions":[{"author":{"id":1299673,"avatar":"https://static001.geekbang.org/account/avatar/00/13/d4/d9/c3296187.jpg","nickname":"airmyä¸¶","note":"","ucode":"41959C9F5B4B65","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367387,"discussion_content":"åº”è¯¥æ˜¯è¦çœ‹luaè„šæœ¬ä¸­éœ€è¦æ“ä½œå¤šå°‘ä¸ªkeyï¼Œå¦‚æœæ˜¯å•ä¸ªkeyçš„è¯ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªkeyçš„è¯ï¼Œé€šå¸¸æ˜¯ä¸èƒ½æ‰§è¡Œçš„ï¼Œå› ä¸ºredisåˆ‡ç‰‡é›†ç¾¤éœ€è¦åˆ†é…å“ˆå¸Œæ§½ï¼Œéœ€è¦ä¿è¯å¤šä¸ªkeyåœ¨åŒä¸€ä¸ªslotä¸Šï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618329367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286068,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1617149755,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1617149755","product_id":100056701,"comment_content":"Redis åŒæ ·ä¼šé‡åˆ°å¹¶å‘è®¿é—®é—®é¢˜ï¼Œä¸ºäº†ä¿è¯å¹¶å‘è®¿é—®ï¼ŒRedis æä¾›äº†åŠ é”å’ŒåŸå­æ“ä½œä¸¤ç§æ–¹å¼ã€‚<br><br>å…¶å®åŸå­æ“ä½œå¬ä¸Šå»æ¯”è¾ƒé«˜ç«¯ï¼Œä½†å®é™…ä¸Šå°±æ˜¯è®©å¤šä¸ªæ“ä½œå˜æˆä¸€æ­¥ï¼Œå’Œäº‹åŠ¡æœ‰ç‚¹åƒã€‚åŠ ä¸€å‡ä¸€è¿™ç§æ¯”è¾ƒç®€å•çš„ï¼ŒRedis è‡ªèº«å°±æä¾›äº† INCR&#47;DECR çš„å‘½ä»¤ï¼›å¯¹äºå¤æ‚å¤šæ­¥éª¤çš„ï¼Œå¯ä»¥ç¼–å†™ Lua è„šæœ¬ï¼Œè€Œ Redis æŠŠ Lua è„šæœ¬å½“åšâ€œä¸€æ¡â€å‘½ä»¤æ¥å¤„ç†ã€‚<br><br>å½“ç„¶ï¼Œå¦‚æœ Lua è„šæœ¬å†…çš„æ“ä½œè¿‡äºå¤æ‚ï¼Œè€—æ—¶è¿‡é•¿ï¼ŒRedis çš„æ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ã€‚<br><br>æˆ‘è§‰çš„ Redis ä»ä¸€å‡ºç”Ÿï¼Œå°±æ˜¯å½“åšç¼“å­˜æ¥è®¾è®¡çš„ï¼Œæœ€å¥½åªåšç®€å•çš„è¯»å†™æ“ä½œï¼ˆè¦æ˜¯ç”¨ä½œåªè¯»ç¼“å­˜å°±æ›´åˆé€‚äº†ï¼‰ã€‚<br><br>å¯¹äºè¯¾åé¢˜ï¼Œè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•°ï¼Œä¸éœ€è¦æ·»åŠ åˆ° Lua è„šæœ¬é‡Œé¢ã€‚å‡è®¾æœ‰å¤šä¸ªå¹¶å‘è®¿é—®ï¼Œè·å–åˆ°äº†å½“å‰çš„ ip è®¿é—®æ¬¡æ•°ï¼Œå‡è®¾ä¸è¶…è¿‡ 20 ä¸”ä¸ä¸º NULL å€¼ï¼Œé‚£ä¹ˆæ¯æ¬¡ï¼ˆå¹¶å‘ï¼‰è®¿é—®ï¼Œéƒ½ç»™è®¿é—®æ¬¡æ•°åŠ ä¸€ï¼Œè¿™ä¸ªæ²¡æœ‰é—®é¢˜ã€‚å¦‚æœ value == 1ï¼Œé‚£ä¹ˆå°±è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå“ªä¸€ä¸ªå¹¶å‘è®¿é—®åˆ°äº†ï¼Œéƒ½å¯ä»¥æ‰§è¡Œã€‚<br><br>å”¯ä¸€å¯èƒ½æœ‰é—®é¢˜çš„åœ°æ–¹ï¼Œå°±æ˜¯æœ‰è¶…è¿‡ 20 ä¸ªå¹¶å‘åŒæ—¶è®¿é—®åˆ°äº† GET(ip)ï¼Œå¹¶ä¸”å¾—åˆ°çš„å€¼å°äº 20ï¼Œç„¶åéƒ½æ‰§è¡Œäº†åŠ ä¸€æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šè¶…è¿‡ 20 çš„è®¿é—®æ¬¡æ•°é™åˆ¶ã€‚","like_count":0},{"had_liked":false,"id":286015,"user_name":"çŒ«çŒ«è™«","can_delete":false,"product_type":"c1","uid":2507099,"ip_address":"","ucode":"3028263C7D44D8","user_header":"https://static001.geekbang.org/account/avatar/00/26/41/5b/23baaded.jpg","comment_is_top":false,"comment_ctime":1617105949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617105949","product_id":100056701,"comment_content":"æ— è®ºæ˜¯ä½¿ç”¨luaè„šæœ¬è¿˜æ˜¯ä¸šåŠ¡åŠ é”ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¿è¯è¯»å¹¶ä¿®æ”¹çš„åŸå­æ€§ï¼Œè¯»å¹¶ä¿®æ”¹æœªæ‰§è¡Œå®Œæˆå‰éƒ½ä¼šé˜»å¡å…¶ä»–è¯·æ±‚ï¼Œé‚£ä¸ºä»€ä¹ˆæ›´æ¨èluaè„šæœ¬å‘¢ï¼Œredisåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•å®ç°è¯»å†™é”çš„åŠŸèƒ½ï¼Œå¹¶ä¿è¯æ¯”ä¸šåŠ¡åŠ é”æ•ˆç‡æ›´é«˜å‘¢","like_count":0},{"had_liked":false,"id":277993,"user_name":"Geek_89e362","can_delete":false,"product_type":"c1","uid":2308075,"ip_address":"","ucode":"E596C2CFE1CFAF","user_header":"","comment_is_top":false,"comment_ctime":1612692443,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612692443","product_id":100056701,"comment_content":"å†æ¬¡æ›´æ­£ï¼Œæˆ‘æ„Ÿè§‰æ˜¯ä¸éœ€è¦ï¼š<br><br>&#47;&#47; è°ƒç”¨è„šæœ¬ å¯¹æ–¹é—®æ¬¡æ•°åŠ  1<br>current = EVAL lua.script ip<br>&#47;&#47;å¦‚æœè¶…è¿‡è®¿é—®æ¬¡æ•°è¶…è¿‡20æ¬¡ï¼Œåˆ™æŠ¥é”™<br>IF current != NULL AND current &gt; 20 THEN<br>    ERROR &quot;exceed 20 accesses per second&quot;<br>ELSE<br>    &#47;&#47;æ‰§è¡Œå…¶ä»–æ“ä½œ<br>    DO THINGS<br>END<br><br>æŠŠæ‰§è¡Œä»£ç æ”¹æˆè¿™æ ·æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†ï¼Œç›´æ¥æŠŠ get(ip) å»æ‰ã€‚ç›´æ¥å»å¢åŠ ã€‚å¦‚æœè¿”å›çš„å€¼ å¤§äº 20 é‚£ä¹ˆå°±ç›´æ¥æŠ¥é”™ã€‚","like_count":0},{"had_liked":false,"id":276164,"user_name":"svenğŸ¦–","can_delete":false,"product_type":"c1","uid":2144395,"ip_address":"","ucode":"D52C7F8B0A6E64","user_header":"https://static001.geekbang.org/account/avatar/00/20/b8/8b/524d7c8e.jpg","comment_is_top":false,"comment_ctime":1611818450,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1611818450","product_id":100056701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œ<br>ä¹‹å‰éƒ½æ˜¯å‚»å‚»çš„åŠ é”æ“ä½œï¼Œæƒ³ä¸åˆ°è¿˜å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨luaè„šæœ¬è§£å†³å¹¶è¡Œä¸²è¡Œã€‚ getï¼ï¼<br>æœ€åæå‡ºä¸€ä¸ªé—®é¢˜ï¼š lua è„šæœ¬ä¸­å¦‚æœå­˜åœ¨å¤šä¸ªæ‰§è¡Œè¯­å¥ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼Œèƒ½å¦åšåˆ°äº‹åŠ¡å›æ»šï¼Ÿ  ","like_count":0,"discussions":[{"author":{"id":2049478,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/45/c6/ba5176a6.jpg","nickname":"ä»ä¸å–èŒ","note":"","ucode":"E9B7B1C8FAFE0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352621,"discussion_content":"ä¸èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614781633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271615,"user_name":"å°è¶…äºº","can_delete":false,"product_type":"c1","uid":1411096,"ip_address":"","ucode":"0D8A433F3E3737","user_header":"https://static001.geekbang.org/account/avatar/00/15/88/18/9744d5ec.jpg","comment_is_top":false,"comment_ctime":1609732973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609732973","product_id":100056701,"comment_content":"å¦‚æœè¦é™åˆ¶æŸä¸ª ip åœ¨é™å®šçš„æ—¶é—´å†…çš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡ 20 æ¬¡ SET $ip 9223372036854775787 EX 60ï¼›<br>å¯ä»¥ $ip æŒ‡å®šçš„ ip çš„é”®ï¼Œ ç„¶å è®¾ç½®å€¼ä¸º Long.MAX_VALUE - 20; è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 60s, ä¹‹åè®¿é—®å¯¹åº”çš„ $ipæ—¶ï¼Œ ä½¿ç”¨å‘½ä»¤ INCR $ipã€‚ å¦‚æœ æ²¡æœ‰æº¢å‡ºè¡¨ç¤ºè®¿é—®æ­£å¸¸ï¼Œ å¦‚æœæº¢å‡º è¡¨ç¤ºè®¿é—®çš„æ¬¡æ•°è¶…è¿‡äº† 20 æ¬¡äº† ï¼›<br>å®æ“: <br>127.0.0.1:6379&gt; set access 9223372036854775787 EX 60<br>OK<br>127.0.0.1:6379&gt; INCR access<br>(integer) 9223372036854775788","like_count":0},{"had_liked":false,"id":265640,"user_name":"èŒƒé—²","can_delete":false,"product_type":"c1","uid":1073125,"ip_address":"","ucode":"F21FD7DF6BA53C","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/e5/54325854.jpg","comment_is_top":false,"comment_ctime":1606967408,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606967408","product_id":100056701,"comment_content":"ä¸éœ€è¦ã€‚è¯»æ“ä½œä¸æ¶‰åŠä¸´ç•Œèµ„æºåŒºçš„ä¿®æ”¹ã€‚<br>å‡å°‘luaçš„å‘½ä»¤ï¼Œå‡å°‘redisæ‰§è¡Œçš„æ—¶é—´ã€‚","like_count":0},{"had_liked":false,"id":264211,"user_name":"ä¸éå‹è² ","can_delete":false,"product_type":"c1","uid":1099321,"ip_address":"","ucode":"A1CB36404DB884","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/39/0b837f63.jpg","comment_is_top":false,"comment_ctime":1606380993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606380993","product_id":100056701,"comment_content":"å¦‚æœéœ€è¦ä¸¥æ ¼æ§åˆ¶æŸä¸ªipåœ°å€1åˆ†é’Ÿ20å†…çš„è®¿é—®å‡èƒ½å¤Ÿæ­£å¸¸å—ç†ï¼Œå°±éœ€è¦åœ¨luaè„šæœ¬é‡ŒæŸ¥è¯¢å¹¶åˆ¤æ–­ï¼›<br>ä¸ç„¶åœ¨æŸipé«˜å¹¶å‘è®¿é—®æ—¶ï¼Œåº”ç”¨è¯·æ±‚redisç”¨luaè„šæœ¬å…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œç„¶ååŠ åˆ°20ä»¥ä¸Šï¼Œè¿™æ—¶åº”ç”¨å†å»æŸ¥ç»“æœä¼šè¿”å›20+ï¼Œæç«¯æƒ…å†µä¸‹ä¼šå¯¼è‡´æŸipæ‰€æœ‰è¯·æ±‚éƒ½æ‹’ç»æ‰ã€‚","like_count":0},{"had_liked":false,"id":264057,"user_name":"çŸ³å°å¤©","can_delete":false,"product_type":"c1","uid":1484861,"ip_address":"","ucode":"BB965629AD7BB3","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJzvM4MKTUJULLl6LESKLun90dPx33OZiaNJ3U5QvAicjDLib6akk52dMHgLwmRTBJ1VicSeKobSeopJA/132","comment_is_top":false,"comment_ctime":1606320871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606320871","product_id":100056701,"comment_content":"åˆ¤æ–­æ˜¯å¦å¤§äº20é€»è¾‘å’Œincrä¸æ˜¯åŸå­æ€§çš„éœ€è¦ï¼Œå¦åˆ™æ¬¡æ•°ä¼šè¶…å‡ºã€‚","like_count":0},{"had_liked":false,"id":263465,"user_name":"äº¢ï¼ˆçŸ¥è¡Œåˆä¸€çš„è·¯ä¸Šï¼‰","can_delete":false,"product_type":"c1","uid":1347013,"ip_address":"","ucode":"958AF7C96EB9E8","user_header":"https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg","comment_is_top":false,"comment_ctime":1606139892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606139892","product_id":100056701,"comment_content":"luaè„šæœ¬å¼º","like_count":0},{"had_liked":false,"id":263189,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1606037485,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606037485","product_id":100056701,"comment_content":"ä¸éœ€è¦ï¼Œå¹¶å‘æ§åˆ¶æ˜¯å¤šçº¿ç¨‹å†™æ“ä½œçš„é¡ºåºæ— æ³•ä¿è¯å¼•èµ·çš„ï¼›è€Œè¯»æ“ä½œå¹¶ä¸å½±å“åŠŸèƒ½ã€‚","like_count":0},{"had_liked":false,"id":260096,"user_name":"åˆ˜å¤§äºº","can_delete":false,"product_type":"c1","uid":1577210,"ip_address":"","ucode":"F66AE613E80398","user_header":"https://static001.geekbang.org/account/avatar/00/18/10/fa/d977627e.jpg","comment_is_top":false,"comment_ctime":1604923328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604923328","product_id":100056701,"comment_content":"Javaéœ€è¦  å¯ä»¥ æ“ä½œluaè„šæœ¬  è°ƒç”¨rediså— æ¯”å¦‚spring biotç­‰","like_count":0},{"had_liked":false,"id":256808,"user_name":"æ–°ä¸–ç•Œ","can_delete":false,"product_type":"c1","uid":1079495,"ip_address":"","ucode":"4473DC1505F158","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/c7/083a3a0b.jpg","comment_is_top":false,"comment_ctime":1603757744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603757744","product_id":100056701,"comment_content":"å®¢æˆ·ç«¯æ‰§è¡ŒåŸå­æ“ä½œå¤±è´¥åæ˜¯ç­‰å¾…ï¼Ÿè¿˜æ˜¯ç›´æ¥å°±å¤±è´¥äº†ï¼Œå¦‚æœç›´æ¥å¤±è´¥äº†ä¸éœ€è¦ï¼Œå¦‚æœç­‰å¾…æ„Ÿè§‰éœ€è¦","like_count":0},{"had_liked":false,"id":256668,"user_name":"snailshen","can_delete":false,"product_type":"c1","uid":1436839,"ip_address":"","ucode":"C4875C476649B1","user_header":"https://static001.geekbang.org/account/avatar/00/15/ec/a7/7d44c655.jpg","comment_is_top":false,"comment_ctime":1603701026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603701026","product_id":100056701,"comment_content":"æ˜¯å¦éœ€è¦æŠŠè¯»å–å®¢æˆ·ç«¯ ip çš„è®¿é—®æ¬¡æ•° GET(ip)ï¼Œä»¥åŠåˆ¤æ–­è®¿é—®æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 20 çš„åˆ¤æ–­é€»è¾‘ï¼Œä¹ŸåŠ åˆ° Lua è„šæœ¬ä¸­ï¼Ÿ<br>è¿™ä¸ªæ“ä½œä¸»è¦æ˜¯ä¿è¯incrä¸º1æ—¶ï¼Œexpireæ“ä½œï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤ä¿è¯åŸå­æ€§å³å¯ï¼Œæ‰€ä»¥æˆ‘å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼š<br>1ã€åˆ¤æ–­20çš„é€»è¾‘ä¸ç”¨æ”¾åœ¨è„šæœ¬ä¸­ï¼Œå¯ä»¥é€šè¿‡luaè„šæœ¬è¿”å›incrçš„è®¿é—®æ¬¡æ•°<br>2ã€incråçš„å€¼ï¼Œæ ¡éªŒä¸º1çš„é€»è¾‘å’Œexpireçš„æ“ä½œè¦æ”¾åˆ°è„šæœ¬ä¸­ï¼Œè¿™æ ·ä¸¥æ ¼ä¿è¯äº†ç¬¬ä¸€ä¸ªæ—¶é—´æ®µç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œè®¾ç½®çš„å¤±æ•ˆæ—¶é—´æ˜¯å‡†ç¡®çš„ã€‚<br>","like_count":0},{"had_liked":false,"id":256662,"user_name":"dieaway","can_delete":false,"product_type":"c1","uid":2113930,"ip_address":"","ucode":"E647D810F4BAD1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqSs32JeiaWYicZE3LZPLZgVXMcBjkd9SadOK8pxjwda6m9vMb0qIz5rha8pfubewic46jBiafejqGWXw/132","comment_is_top":false,"comment_ctime":1603700212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603700212","product_id":100056701,"comment_content":"è¯·é—®è€å¸ˆ ï¼Œredis4.0ä¹‹åå¼•å…¥äº†redis moduleæ‰©å±•  ï¼Œè¿™ä¸ªredis module ä¹Ÿå¯ä»¥å®ç°å’Œluaè„šæœ¬ç±»ä¼¼çš„åŠŸèƒ½ï¼Œ ä¼˜ç‚¹æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨redisçš„åº•å±‚å‘½ä»¤ã€‚ æƒ³é—®ä¸€ä¸‹redis moduleæ˜¯åŸå­æ€§çš„å—   è€å¸ˆæœ‰äº†è§£è¿‡å—","like_count":0},{"had_liked":false,"id":256599,"user_name":"test","can_delete":false,"product_type":"c1","uid":1065849,"ip_address":"","ucode":"9A4973E591DD12","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","comment_is_top":false,"comment_ctime":1603689412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603689412","product_id":100056701,"comment_content":"è¯¾åé¢˜ï¼šä¸éœ€è¦ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ“ä½œä¸ä¼šä¿®æ”¹ä¸´ç•ŒåŒºèµ„æºï¼Œéƒ½æ˜¯è¯»æ“ä½œã€‚","like_count":0},{"had_liked":false,"id":256540,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1603672915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603672915","product_id":100056701,"comment_content":"è¯·é—®è€å¸ˆï¼Œredisåœ¨ç”Ÿæˆå¿«ç…§å’Œå†™AOFçš„æ—¶å€™æ²¡æœ‰åšå¹¶å‘æ§åˆ¶ï¼Œé‚£ä¹ˆå¯¹MULTIå’ŒLuaè„šæœ¬è¿™ç§å¤šæŒ‡ä»¤æƒ…å†µï¼Œä¼šä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè­¬å¦‚ä¸šåŠ¡é€»è¾‘è¦æ±‚Aï¼ŒBï¼ŒCä¸‰ä¸ªæ•°æ®åŒæ­¥åŸå­ä¿®æ”¹ä¿æŒé€»è¾‘ä¸€è‡´ï¼Œbgsaveçš„æ—¶å€™ä¼šå‡ºç°ç”Ÿæˆçš„å¿«ç…§ä¸­Aè¢«ä¿®æ”¹ï¼Œè€ŒBCçš„ä¿®æ”¹è¢«é—æ¼çš„æƒ…å†µä¹ˆï¼Ÿ","like_count":0}]}