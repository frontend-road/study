{"id":15273,"title":"08 | 如何追踪微服务调用？","content":"<p>在微服务架构下，由于进行了服务拆分，一次请求往往需要涉及多个服务，每个服务可能是由不同的团队开发，使用了不同的编程语言，还有可能部署在不同的机器上，分布在不同的数据中心。</p>\n<p>下面这张图描述了用户访问微博首页，一次请求所涉及的服务（这张图仅作为示意，实际上可能远远比这张图还要复杂），你可以想象如果这次请求失败了，要想查清楚到底是哪个应用导致，会是多么复杂的一件事情。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/b6/7b/b63bd8abd8e90ff75fb012068d419f7b.png?wh=982*834\" alt=\"\" /></p>\n<p>如果有一个系统，可以跟踪记录一次用户请求都发起了哪些调用，经过哪些服务处理，并且记录每一次调用所涉及的服务的详细信息，这时候如果发生调用失败，你就可以通过这个日志快速定位是在哪个环节出了问题，<span class=\"orange\">这个系统就是今天我要讲解的服务追踪系统</span>。</p>\n<h2>服务追踪的作用</h2>\n<p>在介绍追踪原理与实现之前，我们先来看看服务追踪的作用。除了刚才说的能够快速定位请求失败的原因以外，我这里再列出四点，它们可以帮你在微服务改造过程中解决不少问题。</p>\n<p><strong>第一，优化系统瓶颈。</strong></p>\n<p>通过记录调用经过的每一条链路上的耗时，我们能快速定位整个系统的瓶颈点在哪里。比如你访问微博首页发现很慢，肯定是由于某种原因造成的，有可能是运营商网络延迟，有可能是网关系统异常，有可能是某个服务异常，还有可能是缓存或者数据库异常。通过服务追踪，可以从全局视角上去观察，找出整个系统的瓶颈点所在，然后做出针对性的优化。</p><!-- [[[read_end]]] -->\n<p><strong>第二，优化链路调用。</strong></p>\n<p>通过服务追踪可以分析调用所经过的路径，然后评估是否合理。比如一个服务调用下游依赖了多个服务，通过调用链分析，可以评估是否每个依赖都是必要的，是否可以通过业务优化来减少服务依赖。</p>\n<p>还有就是，一般业务都会在多个数据中心都部署服务，以实现异地容灾，这个时候经常会出现一种状况就是服务A调用了另外一个数据中心的服务B，而没有调用同处于一个数据中心的服务B。</p>\n<p>根据我的经验，跨数据中心的调用视距离远近都会有一定的网络延迟，像北京和广州这种几千公里距离的网络延迟可能达到30ms以上，这对于有些业务几乎是不可接受的。通过对调用链路进行分析，可以找出跨数据中心的服务调用，从而进行优化，尽量规避这种情况出现。</p>\n<p><strong>第三，生成网络拓扑。</strong></p>\n<p>通过服务追踪系统中记录的链路信息，可以生成一张系统的网络调用拓扑图，它可以反映系统都依赖了哪些服务，以及服务之间的调用关系是什么样的，可以一目了然。除此之外，在网络拓扑图上还可以把服务调用的详细信息也标出来，也能起到服务监控的作用。</p>\n<p><strong>第四，透明传输数据。</strong></p>\n<p>除了服务追踪，业务上经常有一种需求，期望能把一些用户数据，从调用的开始一直往下传递，以便系统中的各个服务都能获取到这个信息。比如业务想做一些A/B测试，这时候就想通过服务追踪系统，把A/B测试的开关逻辑一直往下传递，经过的每一层服务都能获取到这个开关值，就能够统一进行A/B测试。</p>\n<h2>服务追踪系统原理</h2>\n<p>讲到这里，你一定很好奇，服务追踪有这么多好处，那它是怎么做到的呢？</p>\n<p>这就不得不提到服务追踪系统的鼻祖：Google发布的一篇的论文<a href=\"http://bigbully.github.io/Dapper-translation/\"><code>Dapper, a Large-Scale Distributed Systems Tracing Infrastructure</code></a>，里面详细讲解了服务追踪系统的实现原理。它的核心理念就是<strong>调用链</strong>：通过一个全局唯一的ID将分布在各个服务节点上的同一次请求串联起来，从而还原原有的调用关系，可以追踪系统问题、分析调用数据并统计各种系统指标。</p>\n<p>可以说后面的诞生各种服务追踪系统都是基于Dapper衍生出来的，比较有名的有Twitter的<a href=\"http://zipkin.io\">Zipkin</a>、阿里的<a href=\"http://www.slideshare.net/terryice/eagleeye-with-taobaojavaone\">鹰眼</a>、美团的<a href=\"http://tech.meituan.com/mt_mtrace.html\">MTrace</a>等。</p>\n<p>要理解服务追踪的原理，首先必须搞懂一些基本概念：traceId、spanId、annonation等。Dapper这篇论文讲得比较清楚，但对初学者来说理解起来可能有点困难，美团的MTrace的原理介绍理解起来相对容易一些，下面我就以MTrace为例，给你详细讲述服务追踪系统的实现原理。虽然原理有些晦涩，但却是你必须掌握的，只有理解了服务追踪的基本概念，才能更好地将其实现出来。</p>\n<p>首先看下面这张图，我来给你讲解下服务追踪系统中几个最基本概念。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/cf/7b/cf4089dce4ab2e2a028159585eb37f7b.png?wh=2100*818\" alt=\"\" /><br />\n（图片来源：<a href=\"http://tech.meituan.com/img/mt-mtrace/mtrace7.png\">http://tech.meituan.com/img/mt-mtrace/mtrace7.png</a> ）</p>\n<ul>\n<li>\n<p>traceId，用于标识某一次具体的请求ID。当用户的请求进入系统后，会在RPC调用网络的第一层生成一个全局唯一的traceId，并且会随着每一层的RPC调用，不断往后传递，这样的话通过traceId就可以把一次用户请求在系统中调用的路径串联起来。</p>\n</li>\n<li>\n<p>spanId，用于标识一次RPC调用在分布式请求中的位置。当用户的请求进入系统后，处在RPC调用网络的第一层A时spanId初始值是0，进入下一层RPC调用B的时候spanId是0.1，继续进入下一层RPC调用C时spanId是0.1.1，而与B处在同一层的RPC调用E的spanId是0.2，这样的话通过spanId就可以定位某一次RPC请求在系统调用中所处的位置，以及它的上下游依赖分别是谁。</p>\n</li>\n<li>\n<p>annotation，用于业务自定义埋点数据，可以是业务感兴趣的想上传到后端的数据，比如一次请求的用户UID。</p>\n</li>\n</ul>\n<p>上面这三段内容我用通俗语言再给你小结一下，traceId是用于串联某一次请求在系统中经过的所有路径，spanId是用于区分系统不同服务之间调用的先后关系，而annotation是用于业务自定义一些自己感兴趣的数据，在上传traceId和spanId这些基本信息之外，添加一些自己感兴趣的信息。</p>\n<h2>服务追踪系统实现</h2>\n<p>讲到这里，你应该已经理解服务追踪系统里最重要的概念和原理了，我们先来看看服务追踪系统的架构，让你了解一下系统全貌。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/d7/3e/d792225033bf313c6b8fdccbef189e3e.png?wh=2162*924\" alt=\"\" /><br />\n（图片来源：<a href=\"https://tech.meituan.com/img/mt-mtrace/mtrace6.png\">https://tech.meituan.com/img/mt-mtrace/mtrace6.png</a> ）</p>\n<p>上面是服务追踪系统架构图，你可以看到一个服务追踪系统可以分为三层。</p>\n<ul>\n<li>\n<p>数据采集层，负责数据埋点并上报。</p>\n</li>\n<li>\n<p>数据处理层，负责数据的存储与计算。</p>\n</li>\n<li>\n<p>数据展示层，负责数据的图形化展示。</p>\n</li>\n</ul>\n<p>下面来看看具体每一层的实现方式是什么样的。</p>\n<p><strong>1. 数据采集层</strong></p>\n<p>数据采集层的作用就是在系统的各个不同模块中进行埋点，采集数据并上报给数据处理层进行处理。</p>\n<p>那么该如何进行数据埋点呢？结合下面这张图来了解一下数据埋点的流程。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/d1/2f/d1f1ddc7e405dba6687733fbfd34bb2f.png?wh=1920*874\" alt=\"\" /><br />\n（图片来源：<a href=\"https://tech.meituan.com/img/mt-mtrace/mtrace9.png\">https://tech.meituan.com/img/mt-mtrace/mtrace9.png</a> ）</p>\n<p>以红色方框里圈出的A调用B的过程为例，一次RPC请求可以分为四个阶段。</p>\n<ul>\n<li>\n<p>CS（Client Send）阶段 : 客户端发起请求，并生成调用的上下文。</p>\n</li>\n<li>\n<p>SR（Server Recieve）阶段 : 服务端接收请求，并生成上下文。</p>\n</li>\n<li>\n<p>SS（Server  Send）阶段 : 服务端返回请求，这个阶段会将服务端上下文数据上报，下面这张图可以说明上报的数据有：traceId=123456，spanId=0.1，appKey=B，method=B.method，start=103，duration=38。</p>\n</li>\n<li>\n<p>CR（Client Recieve）阶段 : 客户端接收返回结果，这个阶段会将客户端上下文数据上报，上报的数据有：traceid=123456，spanId=0.1，appKey=A，method=B.method，start=103，duration=38。</p>\n</li>\n</ul>\n<p><img src=\"https://static001.geekbang.org/resource/image/61/c1/6111097a42e4888403d59c910a32f6c1.png?wh=1936*946\" alt=\"\" /><br />\n（图片来源：<a href=\"https://tech.meituan.com/img/mt-mtrace/mtrace10.png\">https://tech.meituan.com/img/mt-mtrace/mtrace10.png</a> ）</p>\n<p><strong>2. 数据处理层</strong></p>\n<p>数据处理层的作用就是把数据采集层上报的数据按需计算，然后落地存储供查询使用。</p>\n<p>据我所知，数据处理的需求一般分为两类，一类是实时计算需求，一类是离线计算需求。</p>\n<p>实时计算需求对计算效率要求比较高，一般要求对收集的链路数据能够在秒级别完成聚合计算，以供实时查询。而离线计算需求对计算效率要求就没那么高了，一般能在小时级别完成链路数据的聚合计算即可，一般用作数据汇总统计。针对这两类不同的数据处理需求，采用的计算方法和存储也不相同。</p>\n<ul>\n<li>实时数据处理</li>\n</ul>\n<p>针对实时数据处理，一般采用Storm或者Spark Streaming来对链路数据进行实时聚合加工，存储一般使用OLTP数据仓库，比如HBase，使用traceId作为RowKey，能天然地把一整条调用链聚合在一起，提高查询效率。</p>\n<ul>\n<li>离线数据处理</li>\n</ul>\n<p>针对离线数据处理，一般通过运行MapReduce或者Spark批处理程序来对链路数据进行离线计算，存储一般使用Hive。</p>\n<p><strong>3. 数据展示层</strong></p>\n<p>数据展示层的作用就是将处理后的链路信息以图形化的方式展示给用户。</p>\n<p>根据我的经验，实际项目中主要用到两种图形展示，一种是调用链路图，一种是调用拓扑图。</p>\n<ul>\n<li>调用链路图</li>\n</ul>\n<p>下面以一张Zipkin的调用链路图为例，通过这张图可以看出下面几个信息。</p>\n<p><strong>服务整体情况</strong>：服务总耗时、服务调用的网络深度、每一层经过的系统，以及多少次调用。下图展示的一次调用，总共耗时209.323ms，经过了5个不同的系统模块，调用深度为7层，共发生了24次系统调用。</p>\n<p><strong>每一层的情况</strong>：每一层发生了几次调用，以及每一层调用的耗时。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/13/13/13ea5d45ff39006f14368f44169e5813.png?wh=1920*940\" alt=\"\" /><br />\n（图片来源：<a href=\"https://zipkin.io/public/img/web-screenshot.png\">https://zipkin.io/public/img/web-screenshot.png</a> ）</p>\n<p>根据我的经验，调用链路图在实际项目中，主要是被用来做故障定位，比如某一次用户调用失败了，可以通过调用链路图查询这次用户调用经过了哪些环节，到底是哪一层的调用失败所导致。</p>\n<ul>\n<li>调用拓扑图</li>\n</ul>\n<p>下面是一张Pinpoint的调用拓扑图，通过这张图可以看出系统内都包含哪些应用，它们之间是什么关系，以及依赖调用的QPS、平均耗时情况。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/21/ec/213d15b515b8dbff700e170d001f32ec.png?wh=1547*943\" alt=\"\" /><br />\n（图片来源：<a href=\"https://raw.githubusercontent.com/naver/pinpoint/master/doc/images/ss_server-map.png\">https://raw.githubusercontent.com/naver/pinpoint/master/doc/images/ss_server-map.png</a> ）</p>\n<p>调用拓扑图是一种全局视野图，在实际项目中，主要用作全局监控，用于发现系统中异常的点，从而快速做出决策。比如，某一个服务突然出现异常，那么在调用链路拓扑图中可以看出对这个服务的调用耗时都变高了，可以用红色的图样标出来，用作监控报警。</p>\n<h2>总结</h2>\n<p>今天我给你讲解了服务追踪的基本原理以及实现方式，可以说服务追踪是分布式系统中必不可少的功能，它能够帮助我们查询一次用户请求在系统中的具体执行路径，以及每一条路径的上下游的详细情况，对于追查问题十分有用。</p>\n<p>实现一个服务追踪系统，涉及数据采集、数据处理和数据展示这三个流程，有多种实现方式，具体采用哪一种要根据自己的业务情况来选择。关于服务追踪系统的选型我在专栏后面会详细展开介绍，这里你只需要了解它的基本工作原理就可以了。</p>\n<h2>思考题</h2>\n<p>通过这两期的学习，你应该了解到服务追踪系统和服务监控系统的搭建都需要数据采集、处理和展示这三个步骤，你认为它们是否有相同和不同之处呢？</p>\n<p>欢迎你在留言区写下自己的思考，与我一起讨论。</p>\n<p></p>\n","neighbors":{"left":{"article_title":"07 | 如何监控微服务调用？","id":15109},"right":{"article_title":"09 | 微服务治理的手段有哪些？","id":18651}},"comments":[{"had_liked":false,"id":23438,"user_name":"Realm","can_delete":false,"product_type":"c1","uid":1081299,"ip_address":"","ucode":"30CBEBE619D1A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg","comment_is_top":false,"comment_ctime":1536370801,"is_pvip":true,"replies":[{"id":"8476","content":"嗯","user_name":"作者回复","comment_id":23438,"uid":"1010144","ip_address":"","utype":1,"ctime":1536374021,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"138975324273","product_id":100014401,"comment_content":"1 监控是若干个局部，单独采集、分析、展示；追踪是全局视角，有链的上下游传递的概念，通过某个id串联相关的监控；<br>2 诊断故障一般从链上分析出现问题的点，然后定位到点上的监控数据，看具体原因；","like_count":32,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423563,"discussion_content":"嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536374021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":24449,"user_name":"topsion","can_delete":false,"product_type":"c1","uid":1158152,"ip_address":"","ucode":"01366517C6F564","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/08/8b99367c.jpg","comment_is_top":false,"comment_ctime":1537012769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"100321260577","product_id":100014401,"comment_content":"胡老师，微博个人主页刷半天才能出来？为啥现在还没修复？","like_count":23},{"had_liked":false,"id":23482,"user_name":"郁","can_delete":false,"product_type":"c1","uid":1058787,"ip_address":"","ucode":"905D8D5FA60172","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ynEtBO8iayrGrbbekL9g8CJ7Mnl1u2Dom2Bt4XNPNZyTJ5woicYTewvxwTEhEyQ2UEBszRLEj5TkJxicaEb5rW0Cw/132","comment_is_top":false,"comment_ctime":1536406290,"is_pvip":false,"replies":[{"id":"8701","content":"mesh思路可以","user_name":"作者回复","comment_id":23482,"uid":"1010144","ip_address":"","utype":1,"ctime":1536664042,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"74550850322","product_id":100014401,"comment_content":"要是结合docker，不用侵入式的追踪系统就完美了","like_count":17,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423582,"discussion_content":"mesh思路可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536664042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23461,"user_name":"拉欧","can_delete":false,"product_type":"c1","uid":1206605,"ip_address":"","ucode":"40996A8093A95F","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg","comment_is_top":false,"comment_ctime":1536379722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"61665921866","product_id":100014401,"comment_content":"两者的维度不同:服务追踪系统关心的是单次调用的性能，这其中可能跨越多个服务；服务监控系统关心的是单个服务的性能，主要包括服务质量，甚至机器性能等指标；<br>两者是互为补充的关系，服务监控系统可以及时发现服务内部出现的问题，但是所有服务运行正常，不代表跨服务调用一定正常，因为网络本身就是不可靠的，所以需要服务追踪系统发现服务之间可能出现的问题，这样对于系统的监控才算完备<br>","like_count":15},{"had_liked":false,"id":23648,"user_name":"楼下小黑哥","can_delete":false,"product_type":"c1","uid":1014680,"ip_address":"","ucode":"453B099B0EE52E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/98/8f1aecf4.jpg","comment_is_top":false,"comment_ctime":1536570023,"is_pvip":false,"replies":[{"id":"8699","content":"对的","user_name":"作者回复","comment_id":23648,"uid":"1010144","ip_address":"","utype":1,"ctime":1536663950,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"40191275687","product_id":100014401,"comment_content":"相同：<br>1.整个流程一致。<br><br><br>不同：<br>数据采集维度不一样。监控采集单个服务或整个业务详细业务数据，而追踪系统采集是调用链路过程中调用埋点数据即非业务数据。<br>","like_count":10,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423659,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536663950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23453,"user_name":"Liam","can_delete":false,"product_type":"c1","uid":1094597,"ip_address":"","ucode":"1D15D3B64F2606","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg","comment_is_top":false,"comment_ctime":1536376876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35896115244","product_id":100014401,"comment_content":"一般排查bug都是从整体到局部，分布式链路追踪就是从整体把握业务执行的的过程，定位问题的区域后再具体分析，监控系统会收集每个节点的数据，包括日志，性能，资源，异常等，根据这些数据进一步定位问题的原因","like_count":8},{"had_liked":false,"id":35971,"user_name":"kane","can_delete":false,"product_type":"c1","uid":1147517,"ip_address":"","ucode":"DA4D916BD770BE","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/7d/d213fb2c.jpg","comment_is_top":false,"comment_ctime":1540877163,"is_pvip":false,"replies":[{"id":"13216","content":"主动上报采用udp方式对性能影响可以接受，另外服务调用的耗时也可以靠上报调用耗时来统计","user_name":"作者回复","comment_id":35971,"uid":"1010144","ip_address":"","utype":1,"ctime":1541427578,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"27310680939","product_id":100014401,"comment_content":"我们团队当前也有这个痛点，我们的解决办法是：1.在调用链的源头生成TraceID,每个微服务在处理请求的时候将相关信息打印到日志文件2.通过ELK进行日志收集，可以在elk里进行traceid的检索。这样每次检索就把一次调用处理的所有日志都显示出来，提高问题定位的效率。对于老师讲的内容主要有两个问题，1.日志主动上报，会不会对微服务的资源有比较大的消耗呢？特别是比较频繁的调用处理。2.服务调用的耗时怎么计算的，没太看懂。","like_count":6,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427723,"discussion_content":"主动上报采用udp方式对性能影响可以接受，另外服务调用的耗时也可以靠上报调用耗时来统计","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541427578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23692,"user_name":"丢","can_delete":false,"product_type":"c1","uid":1193884,"ip_address":"","ucode":"5DD0257588FC4F","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/9c/4c56ff47.jpg","comment_is_top":false,"comment_ctime":1536590721,"is_pvip":false,"replies":[{"id":"8698","content":"对，客户端等到超时或者异常，就会记录下错误上报","user_name":"作者回复","comment_id":23692,"uid":"1010144","ip_address":"","utype":1,"ctime":1536663934,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"18716459905","product_id":100014401,"comment_content":"回复何磊“日志上报的阶段是不是在rpc的四个过程中都应该上报？比如在ss阶段，由于服务端挂了，没有响应数据。那么这次rpc调用就无法查询了？”<br>服务端挂了，客户端会收到异常，还是可以在cr阶段上报","like_count":4,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423681,"discussion_content":"对，客户端等到超时或者异常，就会记录下错误上报","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536663934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23514,"user_name":"何磊","can_delete":false,"product_type":"c1","uid":1047604,"ip_address":"","ucode":"78934C3ED4A342","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/34/c733b116.jpg","comment_is_top":false,"comment_ctime":1536459629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18716328813","product_id":100014401,"comment_content":"日志上报的阶段是不是在rpc的四个过程中都应该上报？比如在ss阶段，由于服务端挂了，没有响应数据。那么这次rpc调用就无法查询了？","like_count":4},{"had_liked":false,"id":96668,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1558486609,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14443388497","product_id":100014401,"comment_content":"好东西呀😄<br>我们好像没有这个，有调用链的追踪也是进程内的，而且使用起来也不太方便。<br><br>正如其他同学回答的，监控系统的关注点在局部，凡人视角。追踪系统的关注点在全局，上帝视角。<br><br>关注局部是为了了解更多的个体信息，关注整体一般是为了定位瓶颈看谁最慢。<br><br>单机性能压测时通过监控系统能了解单机的最佳性能，以及机器的各种性能指标，可以针对单机的性能瓶颈进行优化。<br><br>全链路压测时，如果有分布式的性能追踪系统，那定位性能瓶颈就方便多啦！","like_count":3},{"had_liked":false,"id":23502,"user_name":"弥朵","can_delete":false,"product_type":"c1","uid":1229125,"ip_address":"","ucode":"9DDBA5C769CF88","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/45/4db31046.jpg","comment_is_top":false,"comment_ctime":1536429360,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14421331248","product_id":100014401,"comment_content":"请问什么是埋点呀","like_count":3,"discussions":[{"author":{"id":1438037,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f1/55/8ac4f169.jpg","nickname":"陈国林","note":"","ucode":"83D12F3E79F197","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187817,"discussion_content":"业务定制的数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582770942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23458,"user_name":"云中漫步","can_delete":false,"product_type":"c1","uid":1172978,"ip_address":"","ucode":"7E3BE72888E307","user_header":"https://static001.geekbang.org/account/avatar/00/11/e5/f2/262a7364.jpg","comment_is_top":false,"comment_ctime":1536377849,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14421279737","product_id":100014401,"comment_content":"一直不太懂，微服务怎么把一个交易组装起来，怎么编排，调用哪些服务。希望能得到这方面的知识。^_^","like_count":3,"discussions":[{"author":{"id":1438037,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f1/55/8ac4f169.jpg","nickname":"陈国林","note":"","ucode":"83D12F3E79F197","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187818,"discussion_content":"跟具体服务的调用链有关系吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582770967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73946,"user_name":"t7ink","can_delete":false,"product_type":"c1","uid":1057762,"ip_address":"","ucode":"7D822FAE8E34FA","user_header":"https://static001.geekbang.org/account/avatar/00/10/23/e2/06575acb.jpg","comment_is_top":false,"comment_ctime":1552040434,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10141975026","product_id":100014401,"comment_content":"角度不同，粒度也不同。<br>服务监控是确认服务的存活状态。<br>而服务追踪是站在业务角度，记录每一个业务请求的路径及节点状态。<br>换句话说：一个有业务bug的服务，在服务监控的角度来看是存活的，正常的。而在服务追踪角度来说一个有bug的服务是不能正确响应的，在服务追踪的角度来说是不正常的。","like_count":2},{"had_liked":false,"id":32118,"user_name":"波波安","can_delete":false,"product_type":"c1","uid":1002452,"ip_address":"","ucode":"2A677908E5A75D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4b/d4/b7719327.jpg","comment_is_top":false,"comment_ctime":1539421363,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5834388659","product_id":100014401,"comment_content":"<br><br>相同之处有系统的搭建都需要数据采集，数据处理，数据存储和数据展示这些步骤<br><br>不同之处是服务监控系统主要监控局部的业务数据和日志，服务状况等。服务追踪系统是全局链路的一个调用跟踪。一般与业务无关<br><br>","like_count":1},{"had_liked":false,"id":24257,"user_name":"九斤鱼","can_delete":false,"product_type":"c1","uid":1014365,"ip_address":"","ucode":"3F1423E87D79D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/5d/b2e68df2.jpg","comment_is_top":false,"comment_ctime":1536885028,"is_pvip":false,"replies":[{"id":"8938","content":"可以设置采样率","user_name":"作者回复","comment_id":24257,"uid":"1010144","ip_address":"","utype":1,"ctime":1536995725,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"5831852324","product_id":100014401,"comment_content":"这么频繁的上报，怎么避免影响性能呢？","like_count":1,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423898,"discussion_content":"可以设置采样率","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536995725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23613,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1536546187,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5831513483","product_id":100014401,"comment_content":"1.在每个请求涉及的四个点都要收集数据并上报，这样在原始业务代码里写上报代码是不是耦合性太强了？<br>2.假如其中一个调用超市未返回数据，导致多次调用都无法收到服务端的返回信息，如何处理？","like_count":1,"discussions":[{"author":{"id":1438037,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f1/55/8ac4f169.jpg","nickname":"陈国林","note":"","ucode":"83D12F3E79F197","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187819,"discussion_content":"一般RPC框架会做一层封装，trace相关的数据上报自动封装在框架里面了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582771065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23439,"user_name":"铂金小猪","can_delete":false,"product_type":"c1","uid":1058099,"ip_address":"","ucode":"94A9A3A329D557","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/33/1044ec38.jpg","comment_is_top":false,"comment_ctime":1536372291,"is_pvip":false,"replies":[{"id":"8475","content":"也可以的，就是埋点采集的代码不同","user_name":"作者回复","comment_id":23439,"uid":"1010144","ip_address":"","utype":1,"ctime":1536374010,"user_name_real":"古月中心相心"}],"discussion_count":1,"race_medal":0,"score":"5831339587","product_id":100014401,"comment_content":"链路不是http呢？  <br>","like_count":1,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423564,"discussion_content":"也可以的，就是埋点采集的代码不同","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536374010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349986,"user_name":"zzzaqqqq","can_delete":false,"product_type":"c1","uid":2282907,"ip_address":"","ucode":"4E188E6AD498D2","user_header":"","comment_is_top":false,"comment_ctime":1656486445,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656486445","product_id":100014401,"comment_content":"看google文章看了2小时，看文章看了10分钟...","like_count":0},{"had_liked":false,"id":316666,"user_name":"Vivion","can_delete":false,"product_type":"c1","uid":1242310,"ip_address":"","ucode":"C62C4F46B8EB4D","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/c6/aed9e44a.jpg","comment_is_top":false,"comment_ctime":1634480993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634480993","product_id":100014401,"comment_content":"服务监控用来监测、发现问题，服务追踪用来定位问题","like_count":0},{"had_liked":false,"id":314917,"user_name":"俯瞰风景.","can_delete":false,"product_type":"c1","uid":1044166,"ip_address":"","ucode":"A6DB68B7B84AEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/c6/bebcbcf0.jpg","comment_is_top":false,"comment_ctime":1633578670,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633578670","product_id":100014401,"comment_content":"服务追踪的主要目的：<br>  1、发现系统瓶颈<br>  2、优化链路调用<br>  3、生成网络拓扑<br>  4、透明传输数据<br><br>服务追踪的原理主要是通过一个全局唯一的 ID 将分布在各个服务节点上的同一次请求串联起来，从而还原原有的调用关系，可以追踪系统问题、分析调用数据并统计各种系统指标。<br><br>主要功能是数据采集(埋点上报)、数据处理(实时处理、离线处理)、数据展示(调用链路图和调用拓扑图)。","like_count":0},{"had_liked":false,"id":309808,"user_name":"Sch0ng","can_delete":false,"product_type":"c1","uid":1145554,"ip_address":"","ucode":"73F6113931B1AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg","comment_is_top":false,"comment_ctime":1630338395,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630338395","product_id":100014401,"comment_content":"链路追踪，将一次请求的所有日志串起来，再通过对串起来的日志的加工，排查定位问题。","like_count":0},{"had_liked":false,"id":249352,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1600605818,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600605818","product_id":100014401,"comment_content":"监控系统上报的数据应该都是汇总后的数据，上报率会更低","like_count":0},{"had_liked":false,"id":249351,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1600605509,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600605509","product_id":100014401,"comment_content":"采用率，可以是指上报的几率不？ 数据还是一直生成。这样可以在调用链出错时，可以被采集到","like_count":0},{"had_liked":false,"id":241430,"user_name":"黄卫江","can_delete":false,"product_type":"c1","uid":1652895,"ip_address":"","ucode":"0366942B81E7FC","user_header":"https://static001.geekbang.org/account/avatar/00/19/38/9f/895353ab.jpg","comment_is_top":false,"comment_ctime":1597291258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597291258","product_id":100014401,"comment_content":"所有服务都主动调用监控系统进行上报，这对健康系统的并发能力是不是也有很高要求啊<br>","like_count":0},{"had_liked":false,"id":220964,"user_name":"蓝猫","can_delete":false,"product_type":"c1","uid":1128676,"ip_address":"","ucode":"A2E11FF854013C","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/e4/17ffa30b.jpg","comment_is_top":false,"comment_ctime":1590367891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590367891","product_id":100014401,"comment_content":"追踪系统主要用来定位问题，更关注每次调用的全过程，可以快速定位到出现问题的机器和服务上；而监控系统用来解决问题，监控系统记录了每个服务的日志，可以帮助排查解决问题","like_count":0},{"had_liked":false,"id":182342,"user_name":"陈国林","can_delete":false,"product_type":"c1","uid":1438037,"ip_address":"","ucode":"83D12F3E79F197","user_header":"https://static001.geekbang.org/account/avatar/00/15/f1/55/8ac4f169.jpg","comment_is_top":false,"comment_ctime":1582770847,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1582770847","product_id":100014401,"comment_content":"1. 服务监控的采集的数据维度更多，服务追踪系统采集的数据则更偏向与业务本身<br>2. 处理流程上有异曲同工之妙，大多都是通过Kafka进行数据传递，下游使用 Flink、Storm 或 Spark streaming 等流式处理平台进行处理<br>3. 数据存储上，服务监控的数据可以使用 ES 或者 TSDB（Prometheus、InfluxDB），服务追踪系统数据应该也是类似吧","like_count":0,"discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"程序员9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382053,"discussion_content":"服务追踪系统采集的数据是非业务性的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625389528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1735152,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/79/f0/19c6ae1c.jpg","nickname":"Geek_7324de","note":"","ucode":"B1C2CB60D75FB5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299129,"discussion_content":"应该是服务监控系统采集的数据更偏向业务本身吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597570305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144407,"user_name":"钟杰","can_delete":false,"product_type":"c1","uid":1402407,"ip_address":"","ucode":"05DF8246596992","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/27/407ad79a.jpg","comment_is_top":false,"comment_ctime":1571913120,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571913120","product_id":100014401,"comment_content":"服务追踪主要是发现故障点，服务监控数据用于找出什么原因导致这个故障点发生故障","like_count":0},{"had_liked":false,"id":116269,"user_name":"小土豆爸爸","can_delete":false,"product_type":"c1","uid":1175495,"ip_address":"","ucode":"E3FED198AB803A","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/c7/07bffbf3.jpg","comment_is_top":false,"comment_ctime":1563810440,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1563810440","product_id":100014401,"comment_content":"容器现在已经很厉害，所有的追踪都在容器化这一层做了处理","like_count":0},{"had_liked":false,"id":76055,"user_name":"gongxt","can_delete":false,"product_type":"c1","uid":1170750,"ip_address":"","ucode":"222C46E0615152","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/3e/c3028cd5.jpg","comment_is_top":false,"comment_ctime":1552526346,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552526346","product_id":100014401,"comment_content":"老师列举的似乎都是侵入性太强的工具，有没有其它方法呢？","like_count":0,"discussions":[{"author":{"id":1616445,"avatar":"https://static001.geekbang.org/account/avatar/00/18/aa/3d/c14e338e.jpg","nickname":"建锋","note":"","ucode":"DF4AAE135B152B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362024,"discussion_content":"skywalking  agent方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616828121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76053,"user_name":"gongxt","can_delete":false,"product_type":"c1","uid":1170750,"ip_address":"","ucode":"222C46E0615152","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/3e/c3028cd5.jpg","comment_is_top":false,"comment_ctime":1552526248,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552526248","product_id":100014401,"comment_content":"相同点：<br>1、都有采集端（agent）进行独立上报<br>2、服务端收到数据都会对数据进行聚合计算，原始值的存储。这里不同的存储服务有不同的实现<br>不同点：<br>1、业务不一样，链接追踪主要针对请求链路进行处理，监控主要是针对服务内的业务指标包括不限于指标，日志等<br>2、实现方式不一样，监控是时间序列数据库（基于lsm），而trace就不是了（应该是基于树）","like_count":0},{"had_liked":false,"id":74796,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1552299107,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552299107","product_id":100014401,"comment_content":"监控是对某种对象(功能，接口，硬件资源)的特定性能指标的监测，数据采集的过程可以不侵入业务代码。<br>追踪是对服务整个RPC调用关系链的追踪，采集数据一般要通过在业务代码埋点获取。","like_count":0},{"had_liked":false,"id":69570,"user_name":"Tony","can_delete":false,"product_type":"c1","uid":1041154,"ip_address":"","ucode":"137608CF629DFD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e3/02/0c228d1c.jpg","comment_is_top":false,"comment_ctime":1550770682,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550770682","product_id":100014401,"comment_content":"调用链全局考量，针对一次请求定位错误或是延迟部分<br>metrics监控，更像对应用健康检测，比如针对某api某段时间500错误率等<br><br><br><br><br><br>","like_count":0},{"had_liked":false,"id":46473,"user_name":"🍀 🍀 🍀 🐼","can_delete":false,"product_type":"c1","uid":1252056,"ip_address":"","ucode":"1D22FEE1E50117","user_header":"https://static001.geekbang.org/account/avatar/00/13/1a/d8/4a051faa.jpg","comment_is_top":false,"comment_ctime":1543929743,"is_pvip":false,"replies":[{"id":"18050","content":"一般都可以相互调用","user_name":"作者回复","user_name_real":"古月中心相心","uid":"1010144","ctime":1544944250,"ip_address":"","comment_id":46473,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543929743","product_id":100014401,"comment_content":"微服务之间是否允许或者不允许互相调用呢","like_count":0,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431468,"discussion_content":"一般都可以相互调用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544944250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23861,"user_name":"Mac Kwan","can_delete":false,"product_type":"c1","uid":1001958,"ip_address":"","ucode":"FC80EBC9CD37A8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/e6/4f00fe55.jpg","comment_is_top":false,"comment_ctime":1536710682,"is_pvip":false,"replies":[{"id":"8748","content":"专栏后面有个章节会对比选型","user_name":"作者回复","user_name_real":"古月中心相心","uid":"1010144","ctime":1536721644,"ip_address":"","comment_id":23861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1536710682","product_id":100014401,"comment_content":"胡老师，这些跟踪系统有哪些是能供我们使用的呢？","like_count":0,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423759,"discussion_content":"专栏后面有个章节会对比选型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536721644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23693,"user_name":"丢","can_delete":false,"product_type":"c1","uid":1193884,"ip_address":"","ucode":"5DD0257588FC4F","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/9c/4c56ff47.jpg","comment_is_top":false,"comment_ctime":1536590860,"is_pvip":false,"replies":[{"id":"8661","content":"都可以实时生成","user_name":"作者回复","user_name_real":"古月中心相心","uid":"1010144","ctime":1536639663,"ip_address":"","comment_id":23693,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1536590860","product_id":100014401,"comment_content":"实时备理生成链路图，离线处理生成拓扑图？","like_count":0,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423682,"discussion_content":"都可以实时生成","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536639663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23655,"user_name":"招耳","can_delete":false,"product_type":"c1","uid":1001825,"ip_address":"","ucode":"D163E1A6377CF6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/61/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1536575490,"is_pvip":false,"replies":[{"id":"8650","content":"专栏会拿使用最广泛的举个例子","user_name":"作者回复","user_name_real":"古月中心相心","uid":"1010144","ctime":1536633455,"ip_address":"","comment_id":23655,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1536575490","product_id":100014401,"comment_content":"老师为啥没有提及opentracing呢，都已经加入cncf了呀","like_count":0,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423663,"discussion_content":"专栏会拿使用最广泛的举个例子","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536633455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23499,"user_name":"sudden","can_delete":false,"product_type":"c1","uid":1128846,"ip_address":"","ucode":"7FEF669F63CC02","user_header":"https://static001.geekbang.org/account/avatar/00/11/39/8e/9973100b.jpg","comment_is_top":false,"comment_ctime":1536425890,"is_pvip":false,"replies":[{"id":"8663","content":"读错了，抱歉","user_name":"作者回复","user_name_real":"古月中心相心","uid":"1010144","ctime":1536640297,"ip_address":"","comment_id":23499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1536425890","product_id":100014401,"comment_content":"老师，实时计算的存储那里，我听您的音频，应该是OLAP吧。文字版上写是OLTP","like_count":0,"discussions":[{"author":{"id":1010144,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/69/e0/ff8ee2e2.jpg","nickname":"胡忠想","note":"","ucode":"0792605FC265B4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423591,"discussion_content":"读错了，抱歉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536640297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23469,"user_name":"搬砖匠","can_delete":false,"product_type":"c1","uid":1214120,"ip_address":"","ucode":"3D2D7C1FD14DB6","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/a8/427879a9.jpg","comment_is_top":false,"comment_ctime":1536394476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1536394476","product_id":100014401,"comment_content":"数据处理的实时和离线在实操中适用哪些业务需求，能否列举个代表性的真实场景？","like_count":0},{"had_liked":false,"id":23424,"user_name":"柏林","can_delete":false,"product_type":"c1","uid":1221666,"ip_address":"","ucode":"0542FCB44BB01C","user_header":"https://static001.geekbang.org/account/avatar/00/12/a4/22/0d1a27b1.jpg","comment_is_top":false,"comment_ctime":1536366165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1536366165","product_id":100014401,"comment_content":"一楼沙发","like_count":0}]}