{"id":138519,"title":"12 | æœåŠ¡é«˜å¯ç”¨ï¼šä¿è¯æ ¸å¿ƒé“¾è·¯ç¨³å®šæ€§çš„æµæ§å’Œç†”æ–­æœºåˆ¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è¢æ­¦æ—ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/137000\">ç¬¬10è®²â€œè‡ªåŠ¨æ™ºèƒ½æ‰©ç¼©å®¹ï¼šç›´æ’­äº’åŠ¨åœºæ™¯ä¸­å³°å€¼æµé‡çš„åº”å¯¹â€</a>ä¸­ï¼Œæˆ‘åˆ†æäº†ç›´æ’­äº’åŠ¨åœºæ™¯ä¸­â€œçªå‘æµé‡â€å’Œâ€œé«˜å¹¶å‘å³°å€¼â€ä¸šåŠ¡å½¢æ€ä¸‹çš„å‡ ä¸ªå…³é”®æŠ€æœ¯ç‚¹ï¼Œå¹¶ä»‹ç»äº†å…·ä½“çš„åº”å¯¹æ–¹å¼ã€‚</p><p>ä½†æ˜¯ï¼Œä»…ä»è®¾è®¡ä¼˜åŒ–ã€æœåŠ¡æ‹†åˆ†ã€è‡ªåŠ¨æ‰©å®¹ç­‰æ–¹é¢è¿›è¡Œä¼˜åŒ–ï¼Œæœ‰æ—¶å€™å¹¶ä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæœ‰æ—¶æµé‡å¢é•¿è¿‡å¿«ï¼Œæ‰©å®¹æµç¨‹è¿˜æ¥ä¸åŠå®Œæˆï¼ŒæœåŠ¡å™¨å¯èƒ½å°±å·²ç»æŠ—ä¸ä½äº†ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼Œåœ¨å³æ—¶æ¶ˆæ¯ç³»ç»Ÿçš„å¾ˆå¤šå®ç°ä¸­ï¼Œä¸šåŠ¡ä¸Šå¯¹äºå¤–éƒ¨æ¥å£æˆ–è€…èµ„æºçš„ä¾èµ–æ¯”è¾ƒå¤šã€‚æ¯”å¦‚ï¼šå‘æ¶ˆæ¯å¯èƒ½éœ€è¦ä¾èµ–â€œåƒåœ¾å†…å®¹è¯†åˆ«â€çš„APIæ¥è¿›è¡Œæ¶ˆæ¯å†…å®¹çš„è¿‡æ»¤ï¼›ä¸‹æ¨å›¾ç‰‡æ¶ˆæ¯æ—¶ï¼Œæ¨é€æœåŠ¡éœ€è¦ä¾èµ–å›¾ç‰‡æœåŠ¡è·å–ç¼©ç•¥å›¾æ¥è¿›è¡Œæ¨æµï¼›æœ‰çš„æ—¶å€™ï¼Œå½“ä¸šåŠ¡ä¸­ä¾èµ–çš„è¿™äº›æ¥å£ã€èµ„æºä¸å¯ç”¨æˆ–å˜æ…¢æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡æ•´ä½“å¤±è´¥æˆ–è€…è¢«æ‹–æ…¢è€Œé€ æˆè¶…æ—¶ï¼Œå½±å“æœåŠ¡çš„æ•´ä½“å¯ç”¨æ€§ã€‚</p><p>å¯¹äºä¸Šé¢è¿™äº›é—®é¢˜ï¼Œåœ¨å®é™…çº¿ä¸Šä¸šåŠ¡ä¸­å…¶å®å¹¶ä¸å°‘è§ï¼Œç”šè‡³å¯ä»¥è¯´æ˜¯å¸¸æ€åŒ–ã€‚æ—¢ç„¶çªå‘æµé‡æˆ‘ä»¬æ²¡æ³•é¢„æµ‹ï¼Œä¸šåŠ¡ä¸Šä¹Ÿä¸å¯èƒ½ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æœåŠ¡å’Œèµ„æºï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•èƒ½å°½é‡é¿å…ï¼Œæˆ–è€…é™ä½å‡ºç°è¿™äº›é—®é¢˜æ—¶å¯¹æ ¸å¿ƒä¸šåŠ¡çš„å½±å“å‘¢ï¼Ÿ</p><h2>æµé‡æ§åˆ¶</h2><p>é’ˆå¯¹è¶…é«˜æµé‡å¸¦æ¥çš„è¯·æ±‚å‹åŠ›ï¼Œä¸šç•Œæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹å¼å°±æ˜¯â€œæµæ§â€ã€‚</p><p>â€œæµæ§â€è¿™ä¸ªè¯ä½ åº”è¯¥ä¸é™Œç”Ÿï¼Œå½“æˆ‘ä»¬åé£æœºèˆªç­å»¶è¯¯æˆ–è€…è¢«å–æ¶ˆæ—¶ï¼Œèˆªç©ºå…¬å¸ç»™å‡ºçš„åŸå› ç»å¸¸å°±æ˜¯â€œå› ä¸ºç›®çš„æœºåœºæµé‡æ§åˆ¶â€ã€‚å¯¹äºæœºåœºæ¥è¯´ï¼Œå½“æ‰¿è½½çš„èˆªç­é‡è¶…è¿‡æé™è´Ÿè·æ—¶ï¼Œå°±ä¼šé™åˆ¶åç»­å‡ºæ¸¯å’Œåˆ°æ¸¯çš„èˆªç­æ¥è¿›è¡Œæ’é˜Ÿç­‰å€™ï¼Œä»è€Œä¿æŠ¤æ•´ä¸ªæœºåœºçš„æ­£å¸¸è¿è½¬ã€‚</p><!-- [[[read_end]]] --><p>åŒæ ·ï¼Œåœ¨å³æ—¶æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œçªå‘è¶…é«˜æµé‡æ—¶ï¼Œä¸ºäº†é¿å…æœåŠ¡å™¨æ•´ä½“è¢«æµé‡æ‰“æ­»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµæ§æ¥æ‰”æ‰æˆ–è€…é€šè¿‡æ’é˜Ÿçš„æ–¹å¼æ¥ä¿æŠ¤ç³»ç»Ÿåœ¨èƒ½åŠ›èŒƒå›´å†…çš„è¿è½¬ã€‚æ¯”å¦‚ï¼Œæˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/137000\">ç¬¬10è®²â€œè‡ªåŠ¨æ™ºèƒ½æ‰©ç¼©å®¹ï¼šç›´æ’­äº’åŠ¨åœºæ™¯ä¸­å³°å€¼æµé‡çš„åº”å¯¹â€</a>ä¸­è®²åˆ°ï¼Œå½“æœ‰çªå‘çš„é«˜çƒ­åº¦ç›´æ’­æ´»åŠ¨æ—¶ï¼Œä¸ºäº†ä¿æŠ¤æ¨é€æœåŠ¡çš„æ•´ä½“å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµæ§æ‰”æ‰ä¸€äº›éæ ¸å¿ƒçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ä¸€äº›æ™®é€šçš„è¿›å‡ºåœºæ¶ˆæ¯æˆ–ç‚¹èµæ¶ˆæ¯ã€‚</p><h2>æµæ§çš„å¸¸ç”¨ç®—æ³•</h2><p>ç›®å‰ï¼Œä¸šç•Œå¸¸ç”¨çš„æµæ§ç®—æ³•æœ‰ä¸¤ç§ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><h3>æ¼æ¡¶ç®—æ³•</h3><p>â€œæ¼æ¡¶ç®—æ³•â€çš„ä¸»è¦ç›®çš„æ˜¯æ§åˆ¶æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œçš„é€Ÿç‡ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘æµé‡ã€‚â€œæ¼æ¡¶ç®—æ³•â€åœ¨å®ç°ä¸Šæ–‡å¦‚å…¶åï¼šå®ƒæ¨¡æ‹Ÿçš„æ˜¯ä¸€ä¸ªæ¼æ°´çš„æ¡¶ï¼Œæ‰€æœ‰å¤–éƒ¨çš„æ°´éƒ½å…ˆæ”¾è¿›è¿™ä¸ªæ°´æ¡¶ï¼Œè€Œè¿™ä¸ªæ¡¶ä»¥åŒ€é€Ÿå¾€å¤–å‡åŒ€æ¼æ°´ï¼Œå¦‚æœæ°´æ¡¶æ»¡äº†ï¼Œå¤–éƒ¨çš„æ°´å°±ä¸èƒ½å†å¾€æ¡¶é‡Œå€’äº†ã€‚</p><p>è¿™é‡Œä½ å¯ä»¥æŠŠè¿™äº›å¤–éƒ¨çš„æ°´æƒ³è±¡æˆåŸå§‹çš„è¯·æ±‚ï¼Œæ¡¶é‡Œæ¼å‡ºçš„æ°´å°±æ˜¯è¢«ç®—æ³•å¹³æ»‘è¿‡åçš„è¯·æ±‚ã€‚ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¼æ¡¶ç®—æ³•å¯ä»¥æ¯”è¾ƒå¥½åœ°æ§åˆ¶æµé‡çš„è®¿é—®é€Ÿåº¦ã€‚</p><h3>ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯æµæ§ä¸­å¦ä¸€ç§å¸¸ç”¨ç®—æ³•ï¼Œæ§åˆ¶çš„æ˜¯ä¸€ä¸ªæ—¶é—´çª—å£å†…é€šè¿‡çš„æ•°æ®é‡ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•å¤§æ¦‚å®ç°æ˜¯è¿™æ ·çš„ï¼š</p><ol>\n<li>æ¯ 1/rç§’å¾€æ¡¶é‡Œæ”¾å…¥ä¸€ä¸ªä»¤ç‰Œï¼Œræ˜¯ç”¨æˆ·é…ç½®çš„å¹³å‡å‘é€é€Ÿç‡ï¼ˆä¹Ÿå°±æ˜¯æ¯ç§’ä¼šæœ‰rä¸ªä»¤ç‰Œæ”¾å…¥ï¼‰ã€‚</li>\n<li>æ¡¶é‡Œæœ€å¤šå¯ä»¥æ”¾å…¥bä¸ªä»¤ç‰Œï¼Œå¦‚æœæ¡¶æ»¡äº†ï¼Œæ–°æ”¾å…¥çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒã€‚</li>\n<li>å¦‚æœæ¥äº†nä¸ªè¯·æ±‚ï¼Œä¼šä»æ¡¶é‡Œæ¶ˆè€—æ‰nä¸ªä»¤ç‰Œã€‚</li>\n<li>å¦‚æœæ¡¶é‡Œå¯ç”¨ä»¤ç‰Œæ•°å°äºnï¼Œé‚£ä¹ˆè¿™nä¸ªè¯·æ±‚ä¼šè¢«ä¸¢å¼ƒæ‰æˆ–è€…ç­‰å¾…æ–°çš„ä»¤ç‰Œæ”¾å…¥ã€‚</li>\n</ol><p>è¯·æ±‚é€šè¿‡ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°é™æµçš„å¤§æ¦‚è¿‡ç¨‹ï¼Œæˆ‘åœ¨è¿™é‡Œç”»äº†ä¸€å¼ å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/53/9e/5328b89d5145d5c9fdf52f654e74859e.png?wh=1142*1040\" alt=\"\"></p><p>ç®—æ³•æŒ‰ä¸€å®šé€Ÿåº¦å‡åŒ€å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼ŒåŸå§‹è¯·æ±‚è¿›å…¥åï¼Œæ ¹æ®è¯·æ±‚é‡ä»ä»¤ç‰Œæ¡¶é‡Œå–å‡ºéœ€è¦çš„ä»¤ç‰Œæ•°ï¼Œå¦‚æœä»¤ç‰Œæ•°ä¸å¤Ÿï¼Œä¼šç›´æ¥æŠ›å¼ƒæ‰è¶…é™çš„è¯·æ±‚æˆ–è€…è¿›è¡Œç­‰å¾…ï¼Œèƒ½æˆåŠŸè·å–åˆ°ä»¤ç‰Œçš„è¯·æ±‚æ‰ä¼šè¿›å…¥åˆ°åç«¯æœåŠ¡å™¨ã€‚</p><p>ä¸æ¼æ¡¶ç®—æ³•â€œç²¾ç¡®æ§åˆ¶é€Ÿç‡â€ä¸å¤ªä¸€æ ·çš„æ˜¯ï¼Œç”±äºä»¤ç‰Œæ¡¶çš„æ¡¶æœ¬èº«å…·å¤‡ä¸€å®šçš„å®¹é‡ï¼Œå¯ä»¥å…è®¸ä¸€æ¬¡æŠŠæ¡¶é‡Œçš„ä»¤ç‰Œå…¨éƒ½å–å‡ºï¼Œå› æ­¤ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•åœ¨é™åˆ¶è¯·æ±‚çš„å¹³å‡é€Ÿç‡çš„åŒæ—¶ï¼Œè¿˜å…è®¸ä¸€å®šç¨‹åº¦çš„çªå‘æµé‡ã€‚</p><p>æ¯”å¦‚ï¼Œæ˜æ˜Ÿç²‰ä¸ç¾¤çš„åœºæ™¯é‡Œï¼Œå¹³æ—¶ç”¨æˆ·å‘æ¶ˆæ¯çš„è¯·æ±‚æ˜¯æ¯”è¾ƒå°çš„ï¼Œä¸€èˆ¬éƒ½æ¯”è®¾ç½®çš„é˜ˆå€¼å°å¾ˆå¤šï¼Œè¿™æ ·ä»¤ç‰Œæ¡¶å¹³æ—¶éƒ½æ˜¯å¤„äºâ€œæ»¡â€çš„çŠ¶æ€ï¼›å¦‚æœç¾¤éš¶å±çš„æ˜æ˜Ÿçªç„¶ç©ºé™å‡ºç°åœ¨ç¾¤é‡Œï¼Œç¾¤é‡Œçš„ç²‰ä¸ç¬é—´æ´»è·ƒèµ·æ¥ï¼Œä¼šå¿«é€Ÿã€çªå‘åœ°æ¶ˆè€—æ‰ä»¤ç‰Œæ¡¶é‡Œç¼“å­˜çš„bä¸ªä»¤ç‰Œï¼Œå¯¹äºåç«¯ä¸šåŠ¡å±‚å°±ä¼šå‡ºç°ä¸€å®šçš„å³°å€¼æµé‡ã€‚</p><p>é€šè¿‡ä»¤ç‰Œæ¡¶ç®—æ³•æ¥é™æµçš„åº”ç”¨å®ä¾‹æ˜¯æ¯”è¾ƒå¤šçš„ï¼ŒGoogleå¼€æºçš„Guavaå°±é€šè¿‡ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°äº†ä¸€ä¸ªå•æœºç‰ˆçš„RateLimiterï¼ŒGoogleåœ¨å·¥ç¨‹å®ç°ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚SmoothBurstyç‰¹æ€§æ”¯æŒç´¯è®¡Nä¸ªæ—¶é—´çª—å£äº§ç”Ÿçš„ä»¤ç‰Œæ¡¶ï¼Œè¿™æ ·åº”å¯¹çªå‘æµé‡çš„èƒ½åŠ›ä¼šæ›´å¥½ä¸€äº›ã€‚</p><h2>å…¨å±€æµæ§</h2><p>å¯¹äºå•æœºç“¶é¢ˆçš„é—®é¢˜ï¼Œé€šè¿‡å•æœºç‰ˆçš„æµæ§ç®—æ³•å’Œç»„ä»¶å°±èƒ½å¾ˆå¥½åœ°å®ç°å•æœºä¿æŠ¤ã€‚ä½†åœ¨åˆ†å¸ƒå¼æœåŠ¡çš„åœºæ™¯ä¸‹ï¼Œå¾ˆå¤šæ—¶å€™çš„ç“¶é¢ˆç‚¹åœ¨äºå…¨å±€çš„èµ„æºæˆ–è€…ä¾èµ–ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦åˆ†å¸ƒå¼çš„å…¨å±€æµæ§æ¥å¯¹æ•´ä½“ä¸šåŠ¡è¿›è¡Œä¿æŠ¤ã€‚</p><p>ä¸šç•Œæ¯”è¾ƒé€šç”¨çš„å…¨å±€æµæ§æ–¹æ¡ˆï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸­å¤®å¼çš„èµ„æºï¼ˆå¦‚ï¼šRedisã€Nginxï¼‰é…åˆè„šæœ¬æ¥å®ç°å…¨å±€çš„è®¡æ•°å™¨ï¼Œæˆ–è€…å®ç°æ›´ä¸ºå¤æ‚çš„æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡Redisçš„INCRå‘½ä»¤é…åˆLuaå®ç°ä¸€ä¸ªé™åˆ¶QPSï¼ˆæ¯ç§’æŸ¥è¯¢é‡ï¼‰çš„æµæ§ç»„ä»¶ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„Redis+Luaå®ç°å…¨å±€æµæ§çš„ä¾‹å­ï¼š</p><pre><code>-- æ“ä½œçš„Redis Key\nlocal rate_limit_key = KEYS[1]\n-- æ¯ç§’æœ€å¤§çš„QPSè®¸å¯æ•°\nlocal max_permits = ARGV[1]\n-- æ­¤æ¬¡ç”³è¯·çš„è®¸å¯æ•°\nlocal incr_by_count_str = ARGV[2]\n\n-- å½“å‰å·²ç”¨çš„è®¸å¯æ•°\nlocal currentStr = redis.call('get', rate_limit_key)\nlocal current = 0\nif currentStr then\n    current = tonumber(currentStr)\nend\n\n-- å‰©ä½™å¯åˆ†å‘çš„è®¸å¯æ•°\nlocal remain_permits = tonumber(max_permits) - current\nlocal incr_by_count = tonumber(incr_by_count_str)\n-- å¦‚æœå¯åˆ†å‘çš„è®¸å¯æ•°å°äºç”³è¯·çš„è®¸å¯æ•°ï¼Œåªèƒ½ç”³è¯·åˆ°å¯åˆ†å‘çš„è®¸å¯æ•°\nif remain_permits &lt; incr_by_count then\n    incr_by_count = remain_permits\nend\n\n-- å°†æ­¤æ¬¡å®é™…ç”³è¯·çš„è®¸å¯æ•°åŠ åˆ°Redis Keyé‡Œé¢\nlocal result = redis.call('incrby', rate_limit_key, incr_by_count)\n-- åˆæ¬¡æ“ä½œRedis Keyè®¾ç½®1ç§’çš„è¿‡æœŸ\nif result == incr_by_count then\n    redis.call('expire', rate_limit_key, 1)\nend\n\n-- è¿”å›å®é™…ç”³è¯·åˆ°çš„è®¸å¯æ•°\nreturn incr_by_co\n</code></pre><p>ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç»†èŠ‚æ˜¯ï¼šåœ¨æ¯æ¬¡åˆ›å»ºå®Œå¯¹åº”çš„é™æµKeyåï¼Œä½ éœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸçš„æ—¶é—´ã€‚æ•´ä¸ªæ“ä½œæ˜¯åŸå­åŒ–çš„ï¼Œè¿™æ ·èƒ½é¿å…åˆ†å¸ƒå¼æ“ä½œæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´å¤±è´¥ï¼Œå¯¼è‡´é™æµçš„Keyä¸€ç›´æ— æ³•é‡ç½®ï¼Œä»è€Œä½¿é™æµåŠŸèƒ½ä¸å¯ç”¨ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨å®ç°å…¨å±€æµæ§æ—¶è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼šä¸€ä¸ªæ˜¯æµæ§çš„ç²’åº¦é—®é¢˜ï¼Œå¦ä¸€ä¸ªæ˜¯æµæ§ä¾èµ–èµ„æºå­˜åœ¨ç“¶é¢ˆçš„é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹ï¼Œåœ¨å®ç°å…¨å±€æµæ§æ—¶æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚</p><h3>ç»†ç²’åº¦æ§åˆ¶</h3><p>é¦–å…ˆæ˜¯é’ˆå¯¹æµæ§çš„ç²’åº¦é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼šåœ¨é™åˆ¶QPSçš„æ—¶å€™ï¼Œæµæ§ç²’åº¦å¤ªç²—ï¼Œæ²¡æœ‰æŠŠQPSå‡åŒ€åˆ†æ‘Šåˆ°æ¯ä¸ªæ¯«ç§’é‡Œï¼Œè€Œä¸”è¾¹ç•Œå¤„ç†æ—¶ä¸å¤Ÿå¹³æ»‘ï¼Œæ¯”å¦‚ä¸Šä¸€ç§’çš„æœ€åä¸€ä¸ªæ¯«ç§’å’Œä¸‹ä¸€ç§’çš„ç¬¬ä¸€ä¸ªæ¯«ç§’éƒ½å‡ºç°äº†æœ€å¤§æµé‡ï¼Œå°±ä¼šå¯¼è‡´ä¸¤ä¸ªæ¯«ç§’å†…çš„QPSç¿»å€ã€‚</p><p>ä¸€ä¸ªç®€å•çš„å¤„ç†æ–¹å¼æ˜¯æŠŠä¸€ç§’åˆ†æˆè‹¥å¹²ä¸ªNæ¯«ç§’çš„æ¡¶ï¼Œé€šè¿‡æ»‘åŠ¨çª—å£çš„æ–¹å¼ï¼Œå°†æµæ§ç²’åº¦ç»†åŒ–åˆ°Næ¯«ç§’ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½æ˜¯åŸºäºæ»‘åŠ¨çª—å£æ¥ç»Ÿè®¡QPSï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…è¾¹ç•Œå¤„ç†æ—¶ä¸å¹³æ»‘çš„é—®é¢˜ã€‚</p><h3>æµæ§ä¾èµ–èµ„æºç“¶é¢ˆ</h3><p>å…¨å±€æµæ§å®ç°ä¸­å¯èƒ½ä¼šå‡ºç°çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæœ‰æ—¶å…¥å£æµé‡å¤ªå¤§ï¼Œå¯¼è‡´å®ç°æµæ§çš„èµ„æºå‡ºç°è®¿é—®ç“¶é¢ˆï¼Œåè€Œå½±å“äº†æ­£å¸¸ä¸šåŠ¡çš„å¯ç”¨æ€§ã€‚åœ¨å¾®åšæ¶ˆæ¯ç®±ä¸šåŠ¡ä¸­ï¼Œå°±å‘ç”Ÿè¿‡æµæ§ä½¿ç”¨çš„Redisèµ„æºç”±äºè®¿é—®é‡å¤ªå¤§å¯¼è‡´å‡ºç°ä¸å¯ç”¨çš„æƒ…å†µã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œæœ¬åœ°æ‰¹é‡é¢„å–â€çš„æ–¹å¼æ¥é™ä½å¯¹èµ„æºçš„å‹åŠ›ã€‚</p><p>æ‰€è°“çš„â€œæœ¬åœ°æ‰¹é‡é¢„å–â€ï¼Œæ˜¯æŒ‡è®©ä½¿ç”¨é™æµæœåŠ¡çš„ä¸šåŠ¡è¿›ç¨‹ï¼Œæ¯æ¬¡ä»è¿œç¨‹èµ„æºé¢„å–å¤šä¸ªä»¤ç‰Œåœ¨æœ¬åœ°ç¼“å­˜ï¼Œå¤„ç†é™æµé€»è¾‘æ—¶å…ˆä»æœ¬åœ°ç¼“å­˜æ¶ˆè€—ä»¤ç‰Œï¼Œæœ¬åœ°æ¶ˆè´¹å®Œå†è§¦å‘ä»è¿œç¨‹èµ„æºè·å–åˆ°æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœè¿œç¨‹è·å–èµ„æºæ—¶é…é¢å·²ç»ä¸å¤Ÿäº†ï¼Œæœ¬æ¬¡è¯·æ±‚å°±ä¼šè¢«æŠ›å¼ƒã€‚</p><p>é€šè¿‡â€œæœ¬åœ°æ‰¹é‡é¢„å–â€çš„æ–¹å¼ï¼Œèƒ½å¤§å¹…é™ä½å¯¹èµ„æºçš„å‹åŠ›ï¼Œæ¯”å¦‚æ¯æ¬¡é¢„å–10ä¸ªä»¤ç‰Œï¼Œé‚£ä¹ˆç›¸åº”åœ°å¯¹èµ„æºçš„å‹åŠ›èƒ½é™ä½åˆ°1/10ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæœ¬åœ°é¢„å–å¯èƒ½ä¼šå¯¼è‡´ä¸€å®šèŒƒå›´çš„é™æµè¯¯å·®ã€‚æ¯”å¦‚ï¼šä¸Šä¸€ç§’é¢„å–çš„10ä¸ªä»¤ç‰Œï¼Œåœ¨å®é™…ä¸šåŠ¡ä¸­ä¸‹ä¸€ç§’æ‰ç”¨åˆ°ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸‹ä¸€ç§’ä¸šåŠ¡å®é™…çš„è¯·æ±‚é‡ä¼šå¤šä¸€äº›ï¼Œå› æ­¤æœ¬åœ°é¢„å–å¯¹äºéœ€è¦ç²¾å‡†æ§åˆ¶è®¿é—®é‡çš„åœºæ™¯æ¥è¯´å¯èƒ½ä¸æ˜¯ç‰¹åˆ«é€‚åˆã€‚</p><h2>è‡ªåŠ¨ç†”æ–­æœºåˆ¶</h2><p>é’ˆå¯¹çªå‘æµé‡ï¼Œé™¤äº†æ‰©å®¹å’Œæµæ§å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªèƒ½æœ‰æ•ˆä¿æŠ¤ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§çš„æ‰‹æ®µå°±æ˜¯ç†”æ–­æœºåˆ¶ã€‚</p><p>ä¸è¿‡åœ¨ä»‹ç»ç†”æ–­æœºåˆ¶å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å¤šä¾èµ–çš„å¾®æœåŠ¡ä¸­çš„é›ªå´©æ•ˆåº”ï¼Œå› ä¸ºåœ¨æ²¡æœ‰â€œç†”æ–­æœºåˆ¶â€å‰ï¼Œé›ªå´©æ•ˆåº”åœ¨å¤šä¾èµ–æœåŠ¡ä¸­å¾€å¾€ä¼šå¯¼è‡´ä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜ï¼Œä»è€Œæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿçš„æƒ…å†µã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/137000\">ç¬¬10è®²â€œè‡ªåŠ¨æ™ºèƒ½æ‰©ç¼©å®¹ï¼šç›´æ’­äº’åŠ¨åœºæ™¯ä¸­å³°å€¼æµé‡çš„åº”å¯¹â€</a>ä¸­æœ‰è®²è¿‡ï¼Œä¸ºäº†ä¾¿äºç®¡ç†å’Œéš”ç¦»ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¯¹æœåŠ¡è¿›è¡Œè§£è€¦ï¼Œç‹¬ç«‹æ‹†åˆ†è§£è€¦åˆ°ä¸åŒçš„å¾®æœåŠ¡ä¸­ï¼Œå¾®æœåŠ¡é—´é€šè¿‡RPCæ¥è¿›è¡Œè°ƒç”¨å’Œä¾èµ–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b4/48/b401778f630e9f919f2042489cbf8548.png?wh=1142*768\" alt=\"\"></p><p>API 1å’ŒAPI 2ä¸€èµ·å…³è”éƒ¨ç½²ï¼Œè€Œä¸”å…±åŒä¾èµ–å¤šä¸ªä¾èµ–æœåŠ¡Aã€Bã€Cã€‚å¦‚æœæ­¤æ—¶API 1ä¾èµ–çš„æœåŠ¡Bç”±äºèµ„æºæˆ–è€…ç½‘ç»œç­‰åŸå› é€ æˆæ¥å£å˜æ…¢ï¼Œå°±ä¼šå¯¼è‡´å’ŒAPI 1ä¸€èµ·å…³è”éƒ¨ç½²çš„API 2ä¹Ÿå‡ºç°æ•´ä½“æ€§èƒ½è¢«æ‹–ç´¯å˜æ…¢çš„æƒ…å†µï¼Œç»§è€Œå¯¼è‡´ä¾èµ–API 1å’ŒAPI 2çš„å…¶ä»–ä¸Šå±‚çš„æœåŠ¡ä¹Ÿçº§è”åœ°æ€§èƒ½å˜å·®ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„é›ªå´©ã€‚</p><p>è™½ç„¶æœåŠ¡é—´çš„è°ƒç”¨èƒ½å¤Ÿé€šè¿‡è¶…æ—¶æ§åˆ¶æ¥é™ä½è¢«å½±å“çš„ç¨‹åº¦ï¼Œä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå•çº¯ä¾èµ–è¶…æ—¶æ§åˆ¶å¾ˆéš¾é¿å…ä¾èµ–æœåŠ¡æ€§èƒ½æ¶åŒ–çš„é—®é¢˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦èƒ½å¿«é€Ÿâ€œç†”æ–­â€å¯¹è¿™äº›æ€§èƒ½å‡ºç°é—®é¢˜çš„ä¾èµ–è°ƒç”¨ã€‚</p><p>ä¸€ç§å¸¸è§çš„æ–¹å¼æ˜¯æ‰‹åŠ¨é€šè¿‡å¼€å…³æ¥è¿›è¡Œä¾èµ–çš„é™çº§ï¼Œå¾®åšçš„å¾ˆå¤šåœºæ™¯å’Œä¸šåŠ¡éƒ½æœ‰ç”¨åˆ°å¼€å…³æ¥å®ç°ä¸šåŠ¡æˆ–è€…èµ„æºä¾èµ–çš„é™çº§ã€‚</p><p>å¦ä¸€ç§æ›´æ™ºèƒ½çš„æ–¹å¼æ˜¯è‡ªåŠ¨ç†”æ–­æœºåˆ¶ã€‚è‡ªåŠ¨ç†”æ–­æœºåˆ¶ä¸»è¦æ˜¯é€šè¿‡æŒç»­æ”¶é›†è¢«ä¾èµ–æœåŠ¡æˆ–è€…èµ„æºçš„è®¿é—®æ•°æ®å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå½“æ€§èƒ½å‡ºç°ä¸€å®šç¨‹åº¦çš„æ¶åŒ–æˆ–è€…å¤±è´¥é‡è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ç†”æ–­ï¼Œè®©å½“å‰ä¾èµ–å¿«é€Ÿå¤±è´¥ï¼ˆFail-fastï¼‰ï¼Œå¹¶é™çº§åˆ°å…¶ä»–å¤‡ç”¨ä¾èµ–ï¼Œæˆ–è€…æš‚å­˜åˆ°å…¶ä»–åœ°æ–¹ä¾¿äºåç»­é‡è¯•æ¢å¤ã€‚åœ¨ç†”æ–­è¿‡ç¨‹ä¸­ï¼Œå†é€šè¿‡ä¸åœæ¢æµ‹è¢«ä¾èµ–æœåŠ¡æˆ–è€…èµ„æºæ˜¯å¦æ¢å¤ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨å…³é—­ç†”æ–­ï¼Œæ¢å¤ä¸šåŠ¡ã€‚</p><p>è‡ªåŠ¨ç†”æ–­è¿™ä¸€æœºåˆ¶ç›®å‰ä¸šç•Œå·²ç»æœ‰å¾ˆå¤šæ¯”è¾ƒæˆç†Ÿçš„æ¡†æ¶å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼ŒNetflixå…¬å¸å‡ºå“çš„Hystrixï¼Œä»¥åŠç›®å‰ç¤¾åŒºå¾ˆç«çƒ­çš„Resilience4jç­‰ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä¸»è¦ä»æœåŠ¡é«˜å¯ç”¨çš„è§’åº¦å‡ºå‘ï¼Œå¸¦ä½ äº†è§£äº†å¦‚ä½•åœ¨é¢å¯¹çªå‘æµé‡æ—¶ï¼Œé€šè¿‡æµæ§æ¥ä¿éšœç³»ç»Ÿæ•´ä½“è¿è¡Œåœ¨å‹åŠ›é˜ˆå€¼èŒƒå›´å†…ï¼Œä»è€Œè®©ä¸šåŠ¡å¤§éƒ¨åˆ†ä»ç„¶å¤„äºâ€œæŸ”æ€§å¯ç”¨â€çš„çŠ¶æ€ï¼Œè€Œä¸è‡³äºè¢«æµé‡æ‰“æ­»ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»‹ç»äº†ä¸€ä¸‹æµæ§å®ç°çš„ä¸¤å¤§ç®—æ³•ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><ul>\n<li><strong>æ¼æ¡¶ç®—æ³•</strong>çš„æ ¸å¿ƒèƒ½åŠ›åœ¨äºå¹³æ»‘å®é™…æµé‡çš„é€Ÿåº¦ï¼Œè®©è¢«æµæ§çš„æœåŠ¡å§‹ç»ˆæŒ‰å›ºå®šé€Ÿåº¦æ¥å¤„ç†æµé‡ã€‚</li>\n<li><strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong>å¹¶ä¸ç²¾ç¡®é™åˆ¶æµé‡ç»™åˆ°è¢«æµæ§æœåŠ¡çš„é€Ÿåº¦ï¼Œä¸»è¦æ˜¯é™åˆ¶è¯·æ±‚çš„<strong>å¹³å‡é€Ÿåº¦</strong>ï¼Œè€Œä¸”å…è®¸è¢«æµæ§æœåŠ¡å‡ºç°ä¸€å®šçªå‘æµé‡è¯·æ±‚ã€‚</li>\n</ul><p>æ­¤å¤–ï¼Œé’ˆå¯¹åˆ†å¸ƒå¼ä¸šåŠ¡éœ€è¦æ§åˆ¶å…¨å±€æµé‡çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¿˜å¯ä»¥é€šè¿‡ä¸­å¤®å¼çš„èµ„æºæ¥å®ç°ï¼Œæ¯”å¦‚Redis+Luaã€‚</p><p>åœ¨å…¨å±€æµæ§å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ»‘åŠ¨çª—å£å’Œç»†ç²’åº¦åˆ†æ¡¶æ¥è§£å†³æµé‡ä¸å‡è¡¡å’Œè¾¹ç•Œå¤„ç†ä¸å¹³æ»‘çš„é—®é¢˜ï¼›å¯¹äºè¶…å¤§æµé‡å¯èƒ½å¯¼è‡´ä¸­å¤®èµ„æºå‡ºç°ç“¶é¢ˆçš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡â€œæœ¬åœ°æ‰¹é‡é¢„å–â€æ¥é™ä½ä¸­å¤®èµ„æºçš„å‹åŠ›ã€‚</p><p>å¦å¤–ï¼Œå¯¹äºçªå‘æµé‡å’Œå¾®æœåŠ¡é—´ä¾èµ–å¤æ‚å¯¼è‡´çš„é›ªå´©é—®é¢˜ï¼Œå°±éœ€è¦é€šè¿‡â€œç†”æ–­æœºåˆ¶â€æ¥è¿›è¡Œå¿«é€Ÿå¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨é™çº§å’Œè‡ªåŠ¨ç†”æ–­æ¥äº’ç›¸é…åˆï¼Œä»¥ä¿éšœç³»ç»Ÿçš„æ•´ä½“ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><p>â€œé™æµâ€â€œç†”æ–­æœºåˆ¶â€å’Œâ€œç¼“å­˜â€ä¸€èµ·è¢«åˆ—ä¸ºé«˜å¹¶å‘åº”ç”¨å·¥ç¨‹å®ç°ä¸­çš„ä¸‰æ¿æ–§ï¼Œå¯è§å…¶å¯¹é«˜å¹¶å‘ä¸šåŠ¡ç¨³å®šæ€§çš„é‡è¦ç¨‹åº¦ã€‚åœ¨åŒ…æ‹¬å³æ—¶é€šè®¯çš„å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè¶…é«˜å¹¶å‘çš„çªå‘æµé‡ä¹Ÿæ˜¯éšå¤„å¯è§ã€‚æ‰€ä»¥ï¼ŒæŒæ¡å¥½æµæ§å’Œç†”æ–­è¿™ä¸¤ç§åˆ©å™¨ï¼Œä¹Ÿæ˜¯å¯¹æˆ‘ä»¬åç«¯æ¶æ„èƒ½åŠ›çš„ä¸€ç§å¾ˆå¥½çš„æå‡ã€‚</p><p>æœ€åç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ï¼š<strong>è‡ªåŠ¨ç†”æ–­æœºåˆ¶ä¸­ï¼Œå¦‚ä½•æ¥ç¡®è®¤Fail-fastæ—¶çš„ç†”æ–­é˜ˆå€¼ï¼ˆæ¯”å¦‚ï¼šå½“å•ä½æ—¶é—´å†…è®¿é—®è€—æ—¶è¶…è¿‡1sçš„æ¯”ä¾‹è¾¾åˆ°50%æ—¶ï¼Œå¯¹è¯¥ä¾èµ–è¿›è¡Œç†”æ–­ï¼‰ï¼Ÿ</strong></p><p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©è¯¾ç¨‹çš„å†…å®¹ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç•™è¨€åŒºä¸€èµ·è®¨è®ºã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p></p>","comments":[{"had_liked":false,"id":135783,"user_name":"é’¢","can_delete":false,"product_type":"c1","uid":1106184,"ip_address":"","ucode":"A49848BF63A579","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/08/3dc76043.jpg","comment_is_top":false,"comment_ctime":1569279913,"is_pvip":false,"replies":[{"id":"52220","content":"æŠ±æ­‰ï¼Œå°½é‡ä¸åœ¨è¿™é‡Œè®¨è®ºå…¬å¸ç›¸å…³çš„è¯é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569410474,"ip_address":"","comment_id":135783,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53108887465","product_id":100034901,"comment_content":"è€å¸ˆï¼Œå‰é˜µå­å¿—ç²ç»“å©šæ¶ˆæ¯å¼•èµ·å¾®åšç˜«ç—ªï¼Œèƒ½åˆ†æä¸‹å½“æ—¶å…·ä½“æƒ…å†µå—ï¼Œæ˜¯å“ªä¸ªæ‰©å®¹ï¼Œé™æµï¼Œç†”æ–­ä¸­å“ªä¸ªç¯èŠ‚å¼•èµ·çš„ï¼Œåé¢åˆæ˜¯å¦‚ä½•æ”¹è¿›çš„","like_count":13,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468338,"discussion_content":"æŠ±æ­‰ï¼Œå°½é‡ä¸åœ¨è¿™é‡Œè®¨è®ºå…¬å¸ç›¸å…³çš„è¯é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569410474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2249227,"avatar":"https://static001.geekbang.org/account/avatar/00/22/52/0b/50bf0f05.jpg","nickname":"æ©™å­æ©™","note":"","ucode":"CD51367A14D955","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318365,"discussion_content":"å“ˆå“ˆå“ˆ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603718459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135536,"user_name":"ä¸œä¸œğŸˆ","can_delete":false,"product_type":"c1","uid":1326338,"ip_address":"","ucode":"D1BBE24CF76426","user_header":"https://static001.geekbang.org/account/avatar/00/14/3d/02/ecdb4e66.jpg","comment_is_top":false,"comment_ctime":1569206205,"is_pvip":false,"replies":[{"id":"52019","content":"ä¸ªäººè§‰å¾—ä¸éœ€è¦é’ˆå¯¹ç¾¤æ¥ç»´æŠ¤åœ¨çº¿çŠ¶æ€ï¼Œç›´æ¥æŠŠæ‰€æœ‰ç¾¤æ¶ˆæ¯éƒ½pubç»™ç½‘å…³æœºï¼Œç½‘å…³æœºæ ¹æ®æœ¬æœºç»´æŠ¤çš„â€œå½“å‰è¿™æ¡æ¶ˆæ¯çš„ç¾¤çš„ç”¨æˆ·å“ªäº›åœ¨æˆ‘æœ¬æœºä¸Šâ€è¿™ä¸ªæ˜ å°„æ¥ä¸‹æ¨å°±å¯ä»¥äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569238255,"ip_address":"","comment_id":135536,"utype":1}],"discussion_count":5,"race_medal":0,"score":"18749075389","product_id":100034901,"comment_content":"è€å¸ˆï¼Œé—®ä¸ªè®¾è®¡é—®é¢˜ï¼Œå‘ç¾¤æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ€ä¹ˆæŸ¥è¯¢è¿™ä¸ªç¾¤çš„åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468237,"discussion_content":"ä¸ªäººè§‰å¾—ä¸éœ€è¦é’ˆå¯¹ç¾¤æ¥ç»´æŠ¤åœ¨çº¿çŠ¶æ€ï¼Œç›´æ¥æŠŠæ‰€æœ‰ç¾¤æ¶ˆæ¯éƒ½pubç»™ç½‘å…³æœºï¼Œç½‘å…³æœºæ ¹æ®æœ¬æœºç»´æŠ¤çš„â€œå½“å‰è¿™æ¡æ¶ˆæ¯çš„ç¾¤çš„ç”¨æˆ·å“ªäº›åœ¨æˆ‘æœ¬æœºä¸Šâ€è¿™ä¸ªæ˜ å°„æ¥ä¸‹æ¨å°±å¯ä»¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569238255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1326338,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3d/02/ecdb4e66.jpg","nickname":"ä¸œä¸œğŸˆ","note":"","ucode":"D1BBE24CF76426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19950,"discussion_content":"è€å¸ˆè¯´å¾—å¯¹ï¼Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569242116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1376654,"avatar":"https://static001.geekbang.org/account/avatar/00/15/01/8e/48e7c474.jpg","nickname":"ä¸€è·¯å‘åŒ—","note":"","ucode":"54D8F1687AE1ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19766,"discussion_content":"è¿™å…³ä¹äºä½ æ˜¯å¦‚ä½•ç»´æŠ¤ç³»ç»Ÿåœ¨çº¿ç”¨æˆ·åˆ—è¡¨çš„ï¼Œè·ŸæŸä¸ªäººçš„åœ¨çº¿å¥½å‹åˆ—è¡¨æ˜¯ä¸€ä¸ªé“ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569223025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1326338,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3d/02/ecdb4e66.jpg","nickname":"ä¸œä¸œğŸˆ","note":"","ucode":"D1BBE24CF76426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1376654,"avatar":"https://static001.geekbang.org/account/avatar/00/15/01/8e/48e7c474.jpg","nickname":"ä¸€è·¯å‘åŒ—","note":"","ucode":"54D8F1687AE1ED","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19885,"discussion_content":"ä¸€ä¸ª2000äººçš„ç¾¤ï¼Œä¸å¯èƒ½æ¯ä¸ªéƒ½å»åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨çº¿å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569235216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":19766,"ip_address":""},"score":19885,"extra":""},{"author":{"id":1005030,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","nickname":"GeekAmI","note":"","ucode":"232C0B6DFB9F56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1376654,"avatar":"https://static001.geekbang.org/account/avatar/00/15/01/8e/48e7c474.jpg","nickname":"ä¸€è·¯å‘åŒ—","note":"","ucode":"54D8F1687AE1ED","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46238,"discussion_content":"æˆ‘ç†è§£çš„è¿™ä¸ªåœ¨çº¿çŠ¶æ€  éœ€è¦ç±»ä¼¼redisçš„ä¸­å¤®å­˜å‚¨é‡Œç»´æŠ¤ã€‚è¿™å°±æ¶‰åŠå’ŒçŠ¶æ€æœºçš„ç”¨æˆ·åœ¨çº¿çŠ¶æ€çš„ä¸€è‡´æ€§é—®é¢˜å•¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573134504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":19766,"ip_address":""},"score":46238,"extra":""}]}]},{"had_liked":false,"id":135512,"user_name":"é¥­å›¢","can_delete":false,"product_type":"c1","uid":1332557,"ip_address":"","ucode":"E24F240CC91BE8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","comment_is_top":false,"comment_ctime":1569201246,"is_pvip":false,"replies":[{"id":"52017","content":"å•æœºé™æµæ¨èguavaçš„RateLimiterï¼Œå…¨å±€é™æµç›´æ¥åŸºäºRedis+Luaå†™ä¸€ä¸ªå¾ˆç®€å•ã€‚<br>å¯¹ï¼Œé™æµé˜ˆå€¼éœ€è¦æ¨¡æ‹Ÿå‹æµ‹ï¼Œé¿å…ç”±äºé˜ˆå€¼è®¾ç½®å¤ªå®½æ¾å¯¼è‡´æœåŠ¡ä»ç„¶å¯èƒ½è¢«æ‹–æ­»æˆ–è€…é˜ˆå€¼å¤ªæ•æ„Ÿå¯¼è‡´ä¸€ç‚¹æŠ–åŠ¨ä¹Ÿä¼šæ•´ä½“ç†”æ–­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569237987,"ip_address":"","comment_id":135512,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18749070430","product_id":100034901,"comment_content":"è€å¸ˆã€‚è¯·é—®åšé™æµæœ‰å¥½çš„å¼€æºä»£ç æ¨ä»‹å—ï¼Ÿè™½è¯´åŸç†å¾ˆç®€å•ï¼Œä½†æ˜¯å¯¹äºæ²¡åšè¿‡çš„äººè¿˜æ˜¯çœ‹çœ‹å…·ä½“çš„å®ç°æ¯”è¾ƒå¥½ï¼<br>è‡³äºè€å¸ˆçš„é—®é¢˜ï¼æˆ‘æ„Ÿè§‰åœ¨æœåŠ¡ä¸Šçº¿å‰è‚¯å®šä¼šåšå‹åŠ›æµ‹è¯•ï¼æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è®°å½•ä¸‹å½“æ—¶çš„å„é¡¹æœåŠ¡çš„æŒ‡æ ‡ï¼Œå½“æˆ‘ä»¬çº¿ä¸ŠæœåŠ¡å•ä½æ—¶é—´å†…æœåŠ¡çš„10%æˆ–è€…ä¸€ä¸ªåˆé€‚çš„æ¯”ä¾‹ï¼Œè¶…è¿‡ç›¸åº”æŒ‡æ ‡çš„æ—¶å€™å°±å¾—åšç†”æ–­äº†ï¼","like_count":4,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468222,"discussion_content":"å•æœºé™æµæ¨èguavaçš„RateLimiterï¼Œå…¨å±€é™æµç›´æ¥åŸºäºRedis+Luaå†™ä¸€ä¸ªå¾ˆç®€å•ã€‚\nå¯¹ï¼Œé™æµé˜ˆå€¼éœ€è¦æ¨¡æ‹Ÿå‹æµ‹ï¼Œé¿å…ç”±äºé˜ˆå€¼è®¾ç½®å¤ªå®½æ¾å¯¼è‡´æœåŠ¡ä»ç„¶å¯èƒ½è¢«æ‹–æ­»æˆ–è€…é˜ˆå€¼å¤ªæ•æ„Ÿå¯¼è‡´ä¸€ç‚¹æŠ–åŠ¨ä¹Ÿä¼šæ•´ä½“ç†”æ–­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569237987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1093794,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b0/a2/3757fc18.jpg","nickname":"é²å¤§å–µ","note":"","ucode":"BC880649611A08","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310003,"discussion_content":"å¯ä»¥å…³æ³¨æˆ‘å†™è¿‡çš„ä¸€ä¸ªåŸºäºredisçš„åˆ†å¸ƒå¼é™æµç»„ä»¶ï¼ŒåŸºæœ¬æ€è·¯å°±æ˜¯æŠŠguavaçš„ratelimiterç”¨luaè„šæœ¬å®ç°ï¼Œç›¸æ¯”incr+expireè¿™ç§æ–¹å¼ï¼Œæ›´åŠ å¹³æ»‘ã€‚https://github.com/diracccc/redis-rate-limiter","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601557486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251441,"user_name":"é²å¤§å–µ","can_delete":false,"product_type":"c1","uid":1093794,"ip_address":"","ucode":"BC880649611A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/b0/a2/3757fc18.jpg","comment_is_top":false,"comment_ctime":1601557554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14486459442","product_id":100034901,"comment_content":"å…³äºåˆ†å¸ƒå¼é™æµï¼Œå¯ä»¥å…³æ³¨æˆ‘å†™è¿‡çš„ä¸€ä¸ªåŸºäºredisçš„åˆ†å¸ƒå¼é™æµç»„ä»¶ï¼Œæ¬¢è¿æŒ‡æ•™ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯æŠŠguavaçš„ratelimiterç”¨luaè„šæœ¬å®ç°ï¼Œç›¸æ¯”incr+expireè¿™ç§æ–¹å¼ï¼Œæ›´åŠ å¹³æ»‘ï¼Œå¯ä»¥å®ç°æ¯”è¾ƒç²¾å‡†çš„æ§é€Ÿã€‚é¡¹ç›®åœ°å€https:&#47;&#47;github.com&#47;diracccc&#47;redis-rate-limiter","like_count":3},{"had_liked":false,"id":135706,"user_name":"é’¢","can_delete":false,"product_type":"c1","uid":1106184,"ip_address":"","ucode":"A49848BF63A579","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/08/3dc76043.jpg","comment_is_top":false,"comment_ctime":1569243610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14454145498","product_id":100034901,"comment_content":"åœ¨å…¨é“¾è·¯å‹æµ‹ç›‘æ§ä¸­ï¼Œç»Ÿè®¡å“ªä¸ªæ¨¡å—æœ€è„†å¼±ï¼Œå¾—å‡ºè¯¥æ¨¡å—æœ€å¤§è®¿é—®æ¬¡æ•°ï¼Œå®é™…åº”ç”¨ä¸­å¯¹è¯¥æ¨¡å—è¯·æ±‚æ¬¡æ•°è¿›è¡Œç»Ÿè®¡ï¼Œè¶…è¿‡æœ€å¤§è®¿é—®æ¬¡æ•°åˆ™è¿›è¡Œç†”æ–­","like_count":3},{"had_liked":false,"id":135589,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1569221972,"is_pvip":false,"replies":[{"id":"52023","content":"å¯ä»¥ä½¿ç”¨åŸå­æ€§çš„ã€çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ä»¤ç‰Œï¼Œæ¯”å¦‚AotomicLongç­‰ï¼Œè¿™ç§æ•°æ®ç»“æ„æ”¯æŒä¸€æ¬¡decrå¤šä¸ªè€Œä¸”èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨å’Œé«˜æ€§èƒ½çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569238747,"ip_address":"","comment_id":135589,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10159156564","product_id":100034901,"comment_content":"è€å¸ˆï¼Œæµæ§ä»¤ç‰Œçš„æœ¬åœ°æ‰¹é‡é¢„å–ï¼Œæ˜¯å•çº¿ç¨‹è´Ÿè´£ç»´æŠ¤çš„å—ï¼Ÿå¦‚æœå¤šçº¿ç¨‹æ˜¯ä¸æ˜¯è¦ä½¿ç”¨é”æ¥æ§åˆ¶å¹¶å‘ä¿®æ”¹æ•°æ®é—®é¢˜ï¼Ÿè¿™æ ·ä¸ä¼šæŠŠè¯·æ±‚çš„å“åº”æ—¶é—´æ‹‰çš„å¾ˆé•¿å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468258,"discussion_content":"å¯ä»¥ä½¿ç”¨åŸå­æ€§çš„ã€çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ä»¤ç‰Œï¼Œæ¯”å¦‚AotomicLongç­‰ï¼Œè¿™ç§æ•°æ®ç»“æ„æ”¯æŒä¸€æ¬¡decrå¤šä¸ªè€Œä¸”èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨å’Œé«˜æ€§èƒ½çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569238747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005030,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","nickname":"GeekAmI","note":"","ucode":"232C0B6DFB9F56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46240,"discussion_content":"è€å¸ˆ  æˆ‘ç†è§£é¢˜ä¸»çš„æ„è¯†ä»redis decræ˜¯éœ€è¦åŠ é”çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573134643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135513,"user_name":"Geek_e986e3","can_delete":false,"product_type":"c1","uid":1642716,"ip_address":"","ucode":"EF53D2DEA59A8F","user_header":"","comment_is_top":false,"comment_ctime":1569201523,"is_pvip":false,"replies":[{"id":"52018","content":"å¤±è´¥éœ€è¦ç†”æ–­ï¼Œè¶…æ—¶åŒæ ·ä¹Ÿéœ€è¦ç†”æ–­ï¼Œè¦ä¸ç„¶ä¹Ÿä¼šæŠŠæœåŠ¡æ‹–æ­»ã€‚é™çº§çš„è¯çœ‹æƒ…å†µå§ï¼Œå¦‚æœæ˜¯æ—è·¯éæ ¸å¿ƒï¼Œå¯¹ç”¨æˆ·å½±å“ä¸å¤§çš„å¯ä»¥ç›´æ¥â€œè½»å¾®æœ‰æŸè¿”å›â€ï¼Œå¯¹äºæ ¸å¿ƒçš„é“¾è·¯çš„ç†”æ–­ï¼Œå¯ä»¥ç›´æ¥è¿”å›å¤±è´¥è®©ç”¨æˆ·é‡è¯•ï¼ˆç†”æ–­çš„ä»·å€¼åœ¨äºé¿å…æœåŠ¡æ•´ä½“ä¸å¯ç”¨ï¼‰ï¼Œæˆ–è€…é€šè¿‡é‡è¯•é˜Ÿåˆ—æŠŠå½“æ—¶å¤±è´¥çš„è¯·æ±‚å…ˆbufferèµ·æ¥åç»­æ¢å¤åå†ç»§ç»­å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569238172,"ip_address":"","comment_id":135513,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10159136115","product_id":100034901,"comment_content":"æ„Ÿè§‰åº”è¯¥ç”¨æœ€è¿‘è¯·æ±‚xæ¬¡ å¤±è´¥yæ¬¡åšé˜ˆå€¼ï¼Ÿè¿˜æœ‰è€å¸ˆ æƒ³é—®é—® é™çº§çš„æ—¶å€™ä¸€èˆ¬éƒ½æ˜¯æ€ä¹ˆå¤„ç†çš„ æ˜¯ç›´æ¥å¯¹å¤–åé¦ˆæœåŠ¡ä¸å¯ç”¨å—ï¼Ÿ æˆ–è€…è¿”å›ä¹‹å‰ç¼“å­˜æˆ–è€…é»˜è®¤å€¼ä¹‹ç±»çš„å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468223,"discussion_content":"å¤±è´¥éœ€è¦ç†”æ–­ï¼Œè¶…æ—¶åŒæ ·ä¹Ÿéœ€è¦ç†”æ–­ï¼Œè¦ä¸ç„¶ä¹Ÿä¼šæŠŠæœåŠ¡æ‹–æ­»ã€‚é™çº§çš„è¯çœ‹æƒ…å†µå§ï¼Œå¦‚æœæ˜¯æ—è·¯éæ ¸å¿ƒï¼Œå¯¹ç”¨æˆ·å½±å“ä¸å¤§çš„å¯ä»¥ç›´æ¥â€œè½»å¾®æœ‰æŸè¿”å›â€ï¼Œå¯¹äºæ ¸å¿ƒçš„é“¾è·¯çš„ç†”æ–­ï¼Œå¯ä»¥ç›´æ¥è¿”å›å¤±è´¥è®©ç”¨æˆ·é‡è¯•ï¼ˆç†”æ–­çš„ä»·å€¼åœ¨äºé¿å…æœåŠ¡æ•´ä½“ä¸å¯ç”¨ï¼‰ï¼Œæˆ–è€…é€šè¿‡é‡è¯•é˜Ÿåˆ—æŠŠå½“æ—¶å¤±è´¥çš„è¯·æ±‚å…ˆbufferèµ·æ¥åç»­æ¢å¤åå†ç»§ç»­å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569238172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195950,"user_name":"ç›˜å°¼è¥¿æ—","can_delete":false,"product_type":"c1","uid":1197347,"ip_address":"","ucode":"B59569FC25144F","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/23/28311447.jpg","comment_is_top":false,"comment_ctime":1585225535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880192831","product_id":100034901,"comment_content":"hystrix https:&#47;&#47;github.com&#47;Netflix&#47;Hystrix å®ç°è‡ªåŠ¨ç†”æ–­","like_count":1},{"had_liked":false,"id":137052,"user_name":"ä¸œä¸œğŸˆ","can_delete":false,"product_type":"c1","uid":1326338,"ip_address":"","ucode":"D1BBE24CF76426","user_header":"https://static001.geekbang.org/account/avatar/00/14/3d/02/ecdb4e66.jpg","comment_is_top":false,"comment_ctime":1569585055,"is_pvip":false,"replies":[{"id":"52858","content":"nettyçš„æ°´ä½åº”è¯¥åªæ˜¯å’Œtcp bufferç›¸å…³çš„ï¼Œå¦‚æœéœ€è¦æ¶ˆæ¯æ¡æ•°ç»´åº¦çš„æ§åˆ¶è¿˜æ˜¯guavaã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569804249,"ip_address":"","comment_id":137052,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864552351","product_id":100034901,"comment_content":"è€å¸ˆï¼Œå¯¹äºnettyçš„å•æœºæœåŠ¡ç«¯æ”¶æ¶ˆæ¯æµæ§æ–¹æ¡ˆï¼Œé«˜ä½æ°´ä½å¥½è¿˜æ˜¯guavaå¥½ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468919,"discussion_content":"nettyçš„æ°´ä½åº”è¯¥åªæ˜¯å’Œtcp bufferç›¸å…³çš„ï¼Œå¦‚æœéœ€è¦æ¶ˆæ¯æ¡æ•°ç»´åº¦çš„æ§åˆ¶è¿˜æ˜¯guavaã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569804249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303807,"user_name":"æ˜¯é˜¿æ˜¥å‘€","can_delete":false,"product_type":"c1","uid":2071892,"ip_address":"","ucode":"5FEAF587A8C24D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/KibH7lic1ibeW4sUAnnQV1xuibTjQLQB8pKw9nVQT1HCVdfB1gZMiariaraolQMqFzyU6hDvkstabBNuh6zZY4deKPCA/132","comment_is_top":false,"comment_ctime":1627007414,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1627007414","product_id":100034901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå¯èƒ½æ˜¯å› ä¸ºè‡ªèº«èƒ½åŠ›ä¸è¶³ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ æœ¬èŠ‚ä¸­ï¼Œå¯¹äºç»†ç²’åº¦æ§åˆ¶ä¸­ä¸¾çš„ä¾‹å­ä»ç„¶ä¸ç”šç†è§£ï¼Œæƒ³è¯¢é—®ä¸ºä»€ä¹ˆåœ¨ä¸¤ä¸ªæ¯«ç§’ä¹‹é—´QPSç¿»å€ï¼Ÿ<br>åŸæ–‡éƒ¨åˆ†å¦‚ä¸‹ï¼š<br>åœ¨é™åˆ¶ QPS çš„æ—¶å€™ï¼Œæµæ§ç²’åº¦å¤ªç²—ï¼Œæ²¡æœ‰æŠŠ QPS å‡åŒ€åˆ†æ‘Šåˆ°æ¯ä¸ªæ¯«ç§’é‡Œï¼Œè€Œä¸”è¾¹ç•Œå¤„ç†æ—¶ä¸å¤Ÿå¹³æ»‘ï¼Œæ¯”å¦‚ä¸Šä¸€ç§’çš„æœ€åä¸€ä¸ªæ¯«ç§’å’Œä¸‹ä¸€ç§’çš„ç¬¬ä¸€ä¸ªæ¯«ç§’éƒ½å‡ºç°äº†æœ€å¤§æµé‡ï¼Œå°±ä¼šå¯¼è‡´ä¸¤ä¸ªæ¯«ç§’å†…çš„ QPS ç¿»å€ã€‚","like_count":0,"discussions":[{"author":{"id":1649662,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2b/fe/7925eb7e.jpg","nickname":"pdf","note":"","ucode":"A44250955878BB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551208,"discussion_content":"å‡è®¾ä½ ç”¨redisåšé™æµçš„keyï¼Œå¹¶ä¸”è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º1sï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°ä¸Š1sçš„æœ€å1msæ‹¿åˆ°æ‰€æœ‰çš„ä»¤ç‰Œå’Œè¿™1sçš„ç¬¬1msæ‹¿åˆ°æ‰€æœ‰çš„ä»¤ç‰Œï¼Œè¡¨ç°å‡ºæ¥å°±æ˜¯çŸ­æ—¶å†…è¶…è¿‡é¢„æœŸçš„æµé‡ï¼Œä½†æ˜¯ä»2ä¸ª1sçœ‹åˆæ˜¯æ²¡æœ‰è¶…å‡º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644928926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209832,"user_name":"äºš","can_delete":false,"product_type":"c1","uid":1445123,"ip_address":"","ucode":"CDF4DFC3F3619A","user_header":"https://static001.geekbang.org/account/avatar/00/16/0d/03/e59341b4.jpg","comment_is_top":false,"comment_ctime":1587622153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587622153","product_id":100034901,"comment_content":"æ€è€ƒé¢˜ï¼Œå¯¹äºç°ç½‘ç¯å¢ƒï¼Œå¯ä»¥è®¡ç®—æ¯æ¡æ¶ˆæ¯çš„è€—æ—¶ï¼ˆè·å–æ¶ˆæ¯å…¥å£å’Œå‡ºå£çš„æ—¶é—´æˆ³ï¼‰ï¼Œç»Ÿè®¡è€—æ—¶è¶…è¿‡1sçš„æ¶ˆæ¯æ•°é‡ã€‚å¦å¤–è¿˜éœ€è¦ç»´æŠ¤ä¸ªå…¨å±€çš„ æœªå¤„ç†çš„æ¶ˆæ¯æ•°é‡ï¼Œè®¡ç®—1så†…è¶…æ—¶æ¶ˆæ¯å’Œæœªå¤„ç†æ¶ˆæ¯çš„æ¯”ä¾‹ã€‚è¶…è¿‡1sï¼Œåˆ™æ¸…ç©ºè¶…æ—¶çš„æ¶ˆæ¯æ•°é‡ã€‚è¿™ç§æ•°æ®è¿˜å¯ä»¥ä¸ŠæŠ¥åˆ°webé¡µï¼Œç”¨äºè§‚å¯Ÿå®æ—¶å¤±è´¥çš„å æ¯”ä»¥åŠä¸å†å²å¤±è´¥ç‡æ¯”è¾ƒï¼Œä¾¿äºå®šä½é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":186905,"user_name":"kamida","can_delete":false,"product_type":"c1","uid":1904146,"ip_address":"","ucode":"16D7CA59870AC0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/jXbwicoDwia7ooDfwBTRyvNYQkefnVwF1CMicMS8FqKfuFAdvVZo2pqc4ic0R9kSdHTIxaE6YyqxwX8BdNGv5PqSIw/132","comment_is_top":false,"comment_ctime":1583959211,"is_pvip":false,"replies":[{"id":"72300","content":"æœ¬åœ°é¢„å–å’Œæ˜¯å¦é’ˆå¯¹ç”¨æˆ·åˆ†åˆ«é™æµæœ¬èº«æ²¡æœ‰å¿…ç„¶çš„ä¾èµ–å…³ç³»ï¼Œåªä¸è¿‡ç”¨æˆ·æœªè¯»çš„é¢„å–å¦‚æœç”¨æˆ·å¤ªå¤šï¼Œå°±æ„ä¹‰ä¸å¤§äº†ï¼ŒåŒæ ·å¯èƒ½å•uidçš„å¹¶å‘å°äº†ï¼Œä¹Ÿæ²¡å¿…è¦é¢„å–æ¥ä¼˜åŒ–äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1584086435,"ip_address":"","comment_id":186905,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583959211","product_id":100034901,"comment_content":"è€å¸ˆ å¦‚æœæˆ‘ä»¬è¦é’ˆå¯¹ç”¨æˆ·åˆ†åˆ«é™æµ æ˜¯ä¸æ˜¯æœ¬åœ°é¢„å–å°±ä¸èƒ½ç”¨äº†","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486912,"discussion_content":"æœ¬åœ°é¢„å–å’Œæ˜¯å¦é’ˆå¯¹ç”¨æˆ·åˆ†åˆ«é™æµæœ¬èº«æ²¡æœ‰å¿…ç„¶çš„ä¾èµ–å…³ç³»ï¼Œåªä¸è¿‡ç”¨æˆ·æœªè¯»çš„é¢„å–å¦‚æœç”¨æˆ·å¤ªå¤šï¼Œå°±æ„ä¹‰ä¸å¤§äº†ï¼ŒåŒæ ·å¯èƒ½å•uidçš„å¹¶å‘å°äº†ï¼Œä¹Ÿæ²¡å¿…è¦é¢„å–æ¥ä¼˜åŒ–äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584086435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138561,"user_name":"HelloTalk","can_delete":false,"product_type":"c1","uid":1618633,"ip_address":"","ucode":"F898E6A7C61D39","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/c9/b414a77c.jpg","comment_is_top":false,"comment_ctime":1570336702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570336702","product_id":100034901,"comment_content":"è‡ªåŠ¨ç†”æ–­æœºåˆ¶ä¸­ï¼Œå¦‚ä½•æ¥ç¡®è®¤ Fail-fast æ—¶çš„ç†”æ–­é˜ˆå€¼ï¼ˆæ¯”å¦‚ï¼šå½“å•ä½æ—¶é—´å†…è®¿é—®è€—æ—¶è¶…è¿‡ 1s çš„æ¯”ä¾‹è¾¾åˆ° 50% æ—¶ï¼Œå¯¹è¯¥ä¾èµ–è¿›è¡Œç†”æ–­ï¼‰ï¼Ÿ<br><br>ä¸€æ–¹é¢åšå‹åŠ›æµ‹è¯• å¦å¤–ä¸€æ–¹é¢å¯ä»¥åšåŠç†”æ–­æœºåˆ¶ ç»“åˆæµæ§ åªæ”¾è¡Œ50%çš„æµé‡ã€‚","like_count":0},{"had_liked":false,"id":137156,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1109482,"ip_address":"","ucode":"3084CA025D7394","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/ea/a2175a73.jpg","comment_is_top":false,"comment_ctime":1569637064,"is_pvip":false,"replies":[{"id":"52863","content":"ä¸çŸ¥é“æˆ‘ç†è§£å¯¹æ²¡ï¼Œå¦‚æœæ˜¯è¦é™åˆ¶è¿™ä¸ªäº¤äº’çš„é¢‘æ¬¡ï¼Œå¯ä»¥åœ¨è¿™ä¸ªäº¤äº’çš„å…¥å£æ¥å£è¿›è¡Œé™æµå°±å¯ä»¥å‘€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"coldwalker","uid":"1297490","ctime":1569805279,"ip_address":"","comment_id":137156,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1569637064","product_id":100034901,"comment_content":"æœ‰æ—¶å€™ä¸€ä¸ªäº¤äº’éœ€è¦å¤šä¸ªæ¥å£ç»„åˆã€‚ä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼Œæ¯”å¦‚ç™»å½•ï¼Œè¦éªŒè¯å¯†ç ï¼Œè¿˜è¦éªŒè¯éªŒè¯ç ï¼Œç”šè‡³å¯èƒ½è¿˜è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£åšä¸€äº›éªŒè¯ã€‚è¿™ç§åœºæ™¯ä¸‹å¦‚æœå»å¯¹æ¯ä¸ªæ¥å£å•ç‹¬é™æµï¼Œå¿…å®šå¯¼è‡´æ•´ä½“ç™»å½•å¤±è´¥ç‡å¤§å¤§æé«˜ï¼Œè¯·é—®è¿™ç§åœºæ™¯æ€ä¹ˆè¿›è¡Œé™æµ","like_count":0,"discussions":[{"author":{"id":1297490,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epK1zyWib7IKYCoRSxIa6dDjrcyBqObGfj1lDVia1pOrSVxyltKI7RfGekdXPQNObwaBQg3gwvarlQA/132","nickname":"coldwalker","note":"","ucode":"AF9AF257A745C9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468962,"discussion_content":"ä¸çŸ¥é“æˆ‘ç†è§£å¯¹æ²¡ï¼Œå¦‚æœæ˜¯è¦é™åˆ¶è¿™ä¸ªäº¤äº’çš„é¢‘æ¬¡ï¼Œå¯ä»¥åœ¨è¿™ä¸ªäº¤äº’çš„å…¥å£æ¥å£è¿›è¡Œé™æµå°±å¯ä»¥å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569805279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109482,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/ea/a2175a73.jpg","nickname":"Ray","note":"","ucode":"3084CA025D7394","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23715,"discussion_content":"æ— æ³•ä¿è¯ä¸€ä¸ªæ¥å£åªè¢«ä¸€ä¸ªä¸šåŠ¡åœºæ™¯ä½¿ç”¨çš„ï¼ŒçœŸæ˜¯å¤´ç–¼çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569860894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135593,"user_name":"Keep-Moving","can_delete":false,"product_type":"c1","uid":1182631,"ip_address":"","ucode":"76F33C06E07A27","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/a7/6ef32187.jpg","comment_is_top":false,"comment_ctime":1569223572,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569223572","product_id":100034901,"comment_content":"æµæ§å®ç°çš„ä¸¤å¤§ç®—æ³•ï¼š<br>1. æ¼æ¡¶ç®—æ³•<br>2.ä»¤ç‰Œæ¡¶ç®—æ³•","like_count":0}]}