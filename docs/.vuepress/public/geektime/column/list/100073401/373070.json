{"id":373070,"title":"26 | Join HintsæŒ‡å—ï¼šä¸åŒåœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€‰æ‹©Joinç­–ç•¥ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨æ•°æ®åˆ†æé¢†åŸŸï¼Œæ•°æ®å…³è”å¯ä»¥è¯´æ˜¯æœ€å¸¸è§çš„è®¡ç®—åœºæ™¯äº†ã€‚å› ä¸ºä½¿ç”¨çš„é¢‘ç‡å¾ˆé«˜ï¼Œæ‰€ä»¥Sparkä¸ºæˆ‘ä»¬å‡†å¤‡äº†éå¸¸ä¸°å¯Œçš„å…³è”å½¢å¼ï¼ŒåŒ…æ‹¬Inner Joinã€Left Joinã€Right Joinã€Anti Joinã€Semi Joinç­‰ç­‰ã€‚</p><p>ææ‡‚ä¸åŒå…³è”å½¢å¼çš„åŒºåˆ«ä¸ä½œç”¨ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿåœ°å®ç°ä¸šåŠ¡é€»è¾‘ã€‚ä¸è¿‡ï¼Œè¿™åªæ˜¯åŸºç¡€ï¼Œè¦æƒ³æé«˜æ•°æ®å…³è”åœºæ™¯ä¸‹Sparkåº”ç”¨çš„æ‰§è¡Œæ€§èƒ½ï¼Œæ›´ä¸ºå…³é”®çš„æ˜¯æˆ‘ä»¬è¦èƒ½å¤Ÿæ·±å…¥ç†è§£Joinçš„å®ç°åŸç†ã€‚</p><p>æ‰€ä»¥ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´è¯´ï¼Œå•æœºç¯å¢ƒä¸­Joinéƒ½æœ‰å“ªå‡ ç§å®ç°æ–¹å¼ï¼Œå®ƒä»¬çš„ä¼˜åŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚ç†è§£äº†è¿™äº›å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬å†ç»“åˆå®ƒä»¬ä¸€èµ·æ¢è®¨ï¼Œåˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­Sparkéƒ½æ”¯æŒå“ªäº›Joinç­–ç•¥ã€‚å¯¹äºä¸åŒçš„Joinç­–ç•¥ï¼ŒSparkæ˜¯æ€ä¹ˆåšå–èˆçš„ã€‚</p><h2>Joinçš„å®ç°æ–¹å¼è¯¦è§£</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ•°æ®å…³è”æ€»å…±æœ‰3ç§Joinå®ç°æ–¹å¼ã€‚æŒ‰ç…§å‡ºç°çš„æ—¶é—´é¡ºåºï¼Œåˆ†åˆ«æ˜¯åµŒå¥—å¾ªç¯è¿æ¥ï¼ˆNLJï¼ŒNested Loop Join ï¼‰ã€æ’åºå½’å¹¶è¿æ¥ï¼ˆSMJï¼ŒShuffle Sort Merge Joinï¼‰å’Œå“ˆå¸Œè¿æ¥ï¼ˆHJï¼ŒHash Joinï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å€ŸåŠ©ä¸€ä¸ªæ•°æ®å…³è”çš„åœºæ™¯ï¼Œæ¥åˆ†åˆ«è¯´ä¸€è¯´è¿™3ç§Joinå®ç°æ–¹å¼çš„å·¥ä½œåŸç†ã€‚</p><p>å‡è®¾ï¼Œç°åœ¨æœ‰äº‹å®è¡¨orderså’Œç»´åº¦è¡¨usersã€‚å…¶ä¸­ï¼Œusersè¡¨å­˜å‚¨ç”¨æˆ·å±æ€§ä¿¡æ¯ï¼Œordersè®°å½•ç€ç”¨æˆ·çš„æ¯ä¸€ç¬”äº¤æ˜“ã€‚ä¸¤å¼ è¡¨çš„Schemaå¦‚ä¸‹ï¼š</p><!-- [[[read_end]]] --><pre><code>// è®¢å•è¡¨orderså…³é”®å­—æ®µ\nuserId, Int\nitemId, Int\nprice, Float\nquantity, Int\n \n// ç”¨æˆ·è¡¨userså…³é”®å­—æ®µ\nid, Int\nname, String\ntype, String //æšä¸¾å€¼ï¼Œåˆ†ä¸ºå¤´éƒ¨ç”¨æˆ·å’Œé•¿å°¾ç”¨æˆ·\n</code></pre><p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è¦åŸºäºè¿™ä¸¤å¼ è¡¨åšå†…å…³è”ï¼ˆInner Joinï¼‰ï¼ŒåŒæ—¶æŠŠç”¨æˆ·åã€å•ä»·ã€äº¤æ˜“é¢ç­‰å­—æ®µæŠ•å½±å‡ºæ¥ã€‚å…·ä½“çš„SQLæŸ¥è¯¢è¯­å¥å¦‚ä¸‹è¡¨ï¼š</p><pre><code>//SQLæŸ¥è¯¢è¯­å¥\nselect orders.quantity, orders.price, orders.userId, users.id, users.name\nfrom orders inner join users on orders.userId = users.id\n</code></pre><p>é‚£ä¹ˆï¼Œå¯¹äºè¿™æ ·ä¸€ä¸ªå…³è”æŸ¥è¯¢ï¼Œåœ¨3ç§ä¸åŒçš„Joinå®ç°æ–¹å¼ä¸‹ï¼Œå®ƒæ˜¯å¦‚ä½•å®Œæˆè®¡ç®—çš„å‘¢ï¼Ÿ</p><h3>NLJçš„å·¥ä½œåŸç†</h3><p>å¯¹äºå‚ä¸å…³è”çš„ä¸¤å¼ æ•°æ®è¡¨ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ ¹æ®å®ƒä»¬æ‰®æ¼”çš„è§’è‰²æ¥åšåŒºåˆ†ã€‚å…¶ä¸­ï¼Œä½“é‡è¾ƒå¤§ã€ä¸»åŠ¨æ‰«ææ•°æ®çš„è¡¨ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä½œå¤–è¡¨æˆ–æ˜¯é©±åŠ¨è¡¨ï¼›ä½“é‡è¾ƒå°ã€è¢«åŠ¨å‚ä¸æ•°æ®æ‰«æçš„è¡¨ï¼Œæˆ‘ä»¬ç®¡å®ƒå«åšå†…è¡¨æˆ–æ˜¯åŸºè¡¨ã€‚é‚£ä¹ˆï¼ŒNLJæ˜¯å¦‚ä½•å…³è”è¿™ä¸¤å¼ æ•°æ®è¡¨çš„å‘¢ï¼Ÿ</p><p><strong>NLJæ˜¯é‡‡ç”¨â€œåµŒå¥—å¾ªç¯â€çš„æ–¹å¼æ¥å®ç°å…³è”çš„ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒNLJä¼šä½¿ç”¨å†…ã€å¤–ä¸¤ä¸ªåµŒå¥—çš„forå¾ªç¯ä¾æ¬¡æ‰«æå¤–è¡¨å’Œå†…è¡¨ä¸­çš„æ•°æ®è®°å½•ï¼Œåˆ¤æ–­å…³è”æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„orders.userId = users.idï¼Œå¦‚æœæ»¡è¶³å°±æŠŠä¸¤è¾¹çš„è®°å½•æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åå¯¹å¤–è¾“å‡ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/be/13/be0774ffca24f9c20caa2ef6bd88d013.jpg?wh=2829*1431\" alt=\"\" title=\"Nested Loop Joinç¤ºæ„å›¾\"></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¤–å±‚çš„forå¾ªç¯è´Ÿè´£éå†å¤–è¡¨ä¸­çš„æ¯ä¸€æ¡æ•°æ®ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤1æ‰€ç¤ºã€‚è€Œå¯¹äºå¤–è¡¨ä¸­çš„æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œå†…å±‚çš„forå¾ªç¯ä¼šé€æ¡æ‰«æå†…è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œä¾æ¬¡åˆ¤æ–­è®°å½•çš„Join Keyæ˜¯å¦æ»¡è¶³å…³è”æ¡ä»¶ï¼Œå¦‚æ­¥éª¤2æ‰€ç¤ºã€‚å‡è®¾ï¼Œå¤–è¡¨æœ‰Mè¡Œæ•°æ®ï¼Œå†…è¡¨æœ‰Nè¡Œæ•°æ®ï¼Œé‚£ä¹ˆ<strong>NLJç®—æ³•çš„è®¡ç®—å¤æ‚åº¦æ˜¯O(M * N)</strong>ã€‚ä¸å¾—ä¸è¯´ï¼Œå°½ç®¡NLJå®ç°æ–¹å¼ç®€å•è€Œåˆç›´æ¥ï¼Œä½†å®ƒçš„æ‰§è¡Œæ•ˆç‡å®åœ¨è®©äººä¸æ•¢æ­ç»´ã€‚</p><h3>SMJçš„å·¥ä½œåŸç†</h3><p>æ­£æ˜¯å› ä¸ºNLJæä½çš„æ‰§è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥åœ¨å®ƒæ¨å‡ºä¹‹åæ²¡å¤šä¹…ä¹‹åï¼Œå°±æœ‰äººç”¨æ’åºã€å½’å¹¶çš„ç®—æ³•ä»£æ›¿NLJå®ç°äº†æ•°æ®å…³è”ï¼Œè¿™ç§ç®—æ³•å°±æ˜¯SMJã€‚<strong>SMJçš„æ€è·¯æ˜¯å…ˆæ’åºã€å†å½’å¹¶ã€‚</strong>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å‚ä¸Joinçš„ä¸¤å¼ è¡¨å…ˆåˆ†åˆ«æŒ‰ç…§Join Keyåšå‡åºæ’åºã€‚ç„¶åï¼ŒSMJä¼šä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„æ¸¸æ ‡å¯¹æ’å¥½åºçš„ä¸¤å¼ è¡¨å®Œæˆå½’å¹¶å…³è”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/b2/e2a8f8d1b2572ff456fa83a3f25ccbb2.jpg?wh=1183*1048\" alt=\"\" title=\"Sort Merge Joinç¤ºæ„å›¾\"></p><p>SMJåˆšå¼€å§‹å·¥ä½œçš„æ—¶å€™ï¼Œå†…å¤–è¡¨çš„æ¸¸æ ‡éƒ½ä¼šå…ˆé”šå®šåœ¨ä¸¤å¼ è¡¨çš„ç¬¬ä¸€æ¡è®°å½•ä¸Šï¼Œç„¶åå†å¯¹æ¯”æ¸¸æ ‡æ‰€åœ¨è®°å½•çš„Join Keyã€‚å¯¹æ¯”ç»“æœä»¥åŠåç»­æ“ä½œä¸»è¦åˆ†ä¸º3ç§æƒ…å†µï¼š</p><ol>\n<li>å¤–è¡¨Join Keyç­‰äºå†…è¡¨Join Keyï¼Œæ»¡è¶³å…³è”æ¡ä»¶ï¼ŒæŠŠä¸¤è¾¹çš„æ•°æ®è®°å½•æ‹¼æ¥å¹¶è¾“å‡ºï¼Œç„¶åæŠŠå¤–è¡¨çš„æ¸¸æ ‡æ»‘åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•</li>\n<li>å¤–è¡¨Join Keyå°äºå†…è¡¨Join Keyï¼Œä¸æ»¡è¶³å…³è”æ¡ä»¶ï¼ŒæŠŠå¤–è¡¨çš„æ¸¸æ ‡æ»‘åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•</li>\n<li>å¤–è¡¨Join Keyå¤§äºå†…è¡¨Join Keyï¼Œä¸æ»¡è¶³å…³è”æ¡ä»¶ï¼ŒæŠŠå†…è¡¨çš„æ¸¸æ ‡æ»‘åŠ¨åˆ°ä¸‹ä¸€æ¡è®°å½•</li>\n</ol><p>SMJæ­£æ˜¯åŸºäºè¿™3ç§æƒ…å†µï¼Œä¸åœåœ°å‘ä¸‹æ»‘åŠ¨æ¸¸æ ‡ï¼Œç›´åˆ°æŸå¼ è¡¨çš„æ¸¸æ ‡æ»‘åˆ°å¤´ï¼Œå³å®£å‘Šå…³è”ç»“æŸã€‚å¯¹äºSMJä¸­å¤–è¡¨çš„æ¯ä¸€æ¡è®°å½•ï¼Œç”±äºå†…è¡¨æŒ‰Join Keyå‡åºæ’åºï¼Œä¸”æ‰«æçš„èµ·å§‹ä½ç½®ä¸ºæ¸¸æ ‡æ‰€åœ¨ä½ç½®ï¼Œå› æ­¤<strong>SMJç®—æ³•çš„è®¡ç®—å¤æ‚åº¦ä¸ºO(M + N)</strong>ã€‚</p><p>ä¸è¿‡ï¼ŒSMJè®¡ç®—å¤æ‚åº¦çš„é™ä½ï¼Œä»°ä»—çš„æ˜¯ä¸¤å¼ è¡¨å·²ç»äº‹å…ˆæ’å¥½åºã€‚è¦çŸ¥é“ï¼Œæ’åºæœ¬èº«å°±æ˜¯ä¸€é¡¹éå¸¸è€—æ—¶çš„æ“ä½œï¼Œæ›´ä½•å†µï¼Œä¸ºäº†å®Œæˆå½’å¹¶å…³è”ï¼Œå‚ä¸Joinçš„ä¸¤å¼ è¡¨éƒ½éœ€è¦æ’åºã€‚å› æ­¤ï¼ŒSMJçš„è®¡ç®—è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç”¨â€œå…ˆè‹¦åç”œâ€æ¥å½¢å®¹ã€‚è‹¦çš„æ˜¯è¦å…ˆèŠ±è´¹æ—¶é—´ç»™ä¸¤å¼ è¡¨åšæ’åºï¼Œç”œçš„æ˜¯æœ‰åºè¡¨çš„å½’å¹¶å…³è”èƒ½å¤Ÿäº«å—åˆ°çº¿æ€§çš„è®¡ç®—å¤æ‚åº¦ã€‚</p><h3>HJçš„å·¥ä½œåŸç†</h3><p>è€ƒè™‘åˆ°SMJå¯¹æ’åºçš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ï¼Œæ‰€ä»¥åæ¥åˆæœ‰äººæå‡ºäº†æ•ˆç‡æ›´é«˜çš„å…³è”ç®—æ³•ï¼šHJã€‚HJçš„è®¾è®¡åˆè¡·éå¸¸æ˜ç¡®ï¼š<strong>æŠŠå†…è¡¨æ‰«æçš„è®¡ç®—å¤æ‚åº¦é™ä½è‡³O(1)</strong>ã€‚æŠŠä¸€ä¸ªæ•°æ®é›†åˆçš„è®¿é—®æ•ˆç‡æå‡è‡³O(1)ï¼Œä¹Ÿåªæœ‰Hash Mapèƒ½åšåˆ°äº†ã€‚ä¹Ÿæ­£å› ä¸ºJoinçš„å…³è”è¿‡ç¨‹å¼•å…¥äº†Hashè®¡ç®—ï¼Œæ‰€ä»¥å®ƒå«HJã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5c/e4/5c81d814591eba9d08e6a3174ffe22e4.jpg?wh=3960*1659\" alt=\"\"></p><p>HJçš„è®¡ç®—åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯Buildé˜¶æ®µå’ŒProbeé˜¶æ®µã€‚åœ¨Buildé˜¶æ®µï¼ŒåŸºäºå†…è¡¨ï¼Œç®—æ³•ä½¿ç”¨æ—¢å®šçš„å“ˆå¸Œå‡½æ•°æ„å»ºå“ˆå¸Œè¡¨ï¼Œå¦‚ä¸Šå›¾çš„æ­¥éª¤1æ‰€ç¤ºã€‚å“ˆå¸Œè¡¨ä¸­çš„Keyæ˜¯Join Keyåº”ç”¨ï¼ˆApplyï¼‰å“ˆå¸Œå‡½æ•°ä¹‹åçš„å“ˆå¸Œå€¼ï¼Œè¡¨ä¸­çš„ValueåŒæ—¶åŒ…å«äº†åŸå§‹çš„Join Keyå’ŒPayloadã€‚</p><p>åœ¨Probeé˜¶æ®µï¼Œç®—æ³•éå†æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œå…ˆæ˜¯ä½¿ç”¨åŒæ ·çš„å“ˆå¸Œå‡½æ•°ï¼Œä»¥åŠ¨æ€çš„æ–¹å¼ï¼ˆOn The Flyï¼‰è®¡ç®—Join Keyçš„å“ˆå¸Œå€¼ã€‚ç„¶åï¼Œç”¨è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼å»æŸ¥è¯¢åˆšåˆšåœ¨Buildé˜¶æ®µåˆ›å»ºå¥½çš„å“ˆå¸Œè¡¨ã€‚å¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œè¯´æ˜è¯¥æ¡è®°å½•ä¸ç»´åº¦è¡¨ä¸­çš„æ•°æ®ä¸å­˜åœ¨å…³è”å…³ç³»ï¼›å¦‚æœæŸ¥è¯¢æˆåŠŸï¼Œåˆ™ç»§ç»­å¯¹æ¯”ä¸¤è¾¹çš„Join Keyã€‚å¦‚æœJoin Keyä¸€è‡´ï¼Œå°±æŠŠä¸¤è¾¹çš„è®°å½•è¿›è¡Œæ‹¼æ¥å¹¶è¾“å‡ºï¼Œä»è€Œå®Œæˆæ•°æ®å…³è”ã€‚</p><h2>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„Join</h2><p>æŒæ¡äº†è¿™3ç§æœ€ä¸»è¦çš„æ•°æ®å…³è”å®ç°æ–¹å¼çš„å·¥ä½œåŸç†ä¹‹åï¼Œåœ¨å•æœºç¯å¢ƒä¸­ï¼Œæ— è®ºæ˜¯é¢å¯¹å¸¸è§çš„Inner Joinã€Left Joinã€Right Joinï¼Œè¿˜æ˜¯ä¸å¸¸éœ²é¢çš„Anti Joinã€Semi Joinï¼Œä½ éƒ½èƒ½å¯¹æ•°æ®å…³è”çš„æ€§èƒ½è°ƒä¼˜åšåˆ°æ¸¸åˆƒæœ‰ä½™äº†ã€‚</p><p>ä¸è¿‡ï¼Œä½ ä¹Ÿå¯èƒ½ä¼šè¯´ï¼šâ€œSparkæ¯•ç«Ÿæ˜¯ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…‰å­¦å•æœºå®ç°æœ‰ä»€ä¹ˆç”¨å‘€ï¼Ÿâ€</p><p>æ‰€è°“ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œå®é™…ä¸Šï¼Œ<strong>ç›¸æ¯”å•æœºç¯å¢ƒï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„æ•°æ®å…³è”åœ¨è®¡ç®—ç¯èŠ‚ä¾ç„¶éµå¾ªç€NLJã€SMJå’ŒHJè¿™3ç§å®ç°æ–¹å¼ï¼Œåªä¸è¿‡æ˜¯å¢åŠ äº†ç½‘ç»œåˆ†å‘è¿™ä¸€å˜æ•°</strong>ã€‚åœ¨Sparkçš„åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ï¼Œæ•°æ®åœ¨ç½‘ç»œä¸­çš„åˆ†å‘ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯Shuffleå’Œå¹¿æ’­ã€‚é‚£ä¹ˆï¼Œä¸åŒçš„ç½‘ç»œåˆ†å‘æ–¹å¼ï¼Œå¯¹äºæ•°æ®å…³è”çš„è®¡ç®—åˆéƒ½æœ‰å“ªäº›å½±å“å‘¢ï¼Ÿ</p><p>å¦‚æœé‡‡ç”¨Shuffleçš„åˆ†å‘æ–¹å¼æ¥å®Œæˆæ•°æ®å…³è”ï¼Œé‚£ä¹ˆå¤–è¡¨å’Œå†…è¡¨éƒ½éœ€è¦æŒ‰ç…§Join Keyåœ¨é›†ç¾¤ä¸­åšå…¨é‡çš„æ•°æ®åˆ†å‘ã€‚å› ä¸ºåªæœ‰è¿™æ ·ï¼Œä¸¤ä¸ªæ•°æ®è¡¨ä¸­Join Keyç›¸åŒçš„æ•°æ®è®°å½•æ‰èƒ½åˆ†é…åˆ°åŒä¸€ä¸ªExecutorè¿›ç¨‹ï¼Œä»è€Œå®Œæˆå…³è”è®¡ç®—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b1/28/b1b2a574eb7ef33e2315f547ecdc0328.jpg?wh=5124*1599\" alt=\"\"></p><p>å¦‚æœé‡‡ç”¨å¹¿æ’­æœºåˆ¶çš„è¯ï¼Œæƒ…å†µä¼šå¤§æœ‰ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSparkåªéœ€è¦æŠŠå†…è¡¨ï¼ˆåŸºè¡¨ï¼‰å°è£…åˆ°å¹¿æ’­å˜é‡ï¼Œç„¶ååœ¨å…¨ç½‘è¿›è¡Œåˆ†å‘ã€‚ç”±äºå¹¿æ’­å˜é‡ä¸­åŒ…å«äº†å†…è¡¨çš„<strong>å…¨é‡æ•°æ®</strong>ï¼Œå› æ­¤ä½“é‡è¾ƒå¤§çš„å¤–è¡¨åªè¦â€œå¾…åœ¨åŸåœ°ã€ä¿æŒä¸åŠ¨â€ï¼Œå°±èƒ½è½»æ¾åœ°å®Œæˆå…³è”è®¡ç®—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/2a/b3c5ab392c2303bf7923488623b4022a.jpg?wh=5094*1695\" alt=\"\"></p><p>ä¸éš¾å‘ç°ï¼Œç»“åˆShuffleã€å¹¿æ’­è¿™ä¸¤ç§ç½‘ç»œåˆ†å‘æ–¹å¼å’ŒNLJã€SMJã€HJè¿™3ç§è®¡ç®—æ–¹å¼ï¼Œå¯¹äºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®å…³è”ï¼Œæˆ‘ä»¬å°±èƒ½ç»„åˆå‡º6ç§Joinç­–ç•¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/48/e9bf1720ac13289a9e49e0f33a334548.jpg?wh=1989*1149\" alt=\"\"></p><p>è¿™6ç§Joinç­–ç•¥ï¼Œå¯¹åº”å›¾ä¸­6ä¸ªé’è‰²åœ†è§’çŸ©å½¢ï¼Œä»ä¸Šåˆ°ä¸‹é¢œè‰²ä¾æ¬¡å˜æµ…ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯Cartesian Product Joinã€Shuffle Sort Merge Joinå’ŒShuffle Hash Joinã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨Shuffleæœºåˆ¶å®ç°çš„NLJã€SMJå’ŒHJï¼Œä»¥åŠBroadcast Nested Loop Joinã€Broadcast Sort Merge Joinå’ŒBroadcast Hash Joinã€‚</p><p><strong>ä»æ‰§è¡Œæ€§èƒ½æ¥è¯´ï¼Œ6ç§ç­–ç•¥ä»ä¸Šåˆ°ä¸‹ç”±å¼±å˜å¼ºã€‚</strong>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCPJçš„æ‰§è¡Œæ•ˆç‡æ˜¯æ‰€æœ‰å®ç°æ–¹å¼å½“ä¸­æœ€å·®çš„ï¼Œç½‘ç»œå¼€é”€ã€è®¡ç®—å¼€é”€éƒ½å¾ˆå¤§ï¼Œå› è€Œåœ¨å›¾ä¸­çš„é¢œè‰²ä¹Ÿæ˜¯æœ€æ·±çš„ã€‚BHJæ˜¯æœ€å¥½çš„åˆ†å¸ƒå¼æ•°æ®å…³è”æœºåˆ¶ï¼Œç½‘ç»œå¼€é”€å’Œè®¡ç®—å¼€é”€éƒ½æ˜¯æœ€å°çš„ï¼Œå› è€Œé¢œè‰²ä¹Ÿæœ€æµ…ã€‚æ­¤å¤–ï¼Œä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†ï¼ŒBroadcast Sort Merge Joinè¢«æ ‡è®°æˆäº†ç°è‰²ï¼Œè¿™æ˜¯å› ä¸ºSparkå¹¶æ²¡æœ‰é€‰æ‹©æ”¯æŒBroadcast + Sort Merge Joinè¿™ç§ç»„åˆæ–¹å¼ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ˜æ˜æ˜¯6ç§ç»„åˆç­–ç•¥ï¼Œä¸ºä»€ä¹ˆSparkååæ²¡æœ‰æ”¯æŒè¿™ä¸€ç§å‘¢ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦å›è¿‡å¤´æ¥å¯¹æ¯”SMJä¸HJå®ç°æ–¹å¼çš„å·®å¼‚ä¸ä¼˜åŠ£åŠ¿ã€‚</p><p>ç›¸æ¯”SMJï¼ŒHJå¹¶ä¸è¦æ±‚å‚ä¸Joinçš„ä¸¤å¼ è¡¨æœ‰åºï¼Œä¹Ÿä¸éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ¸¸æ ‡æ¥åˆ¤æ–­å½“å‰çš„è®°å½•ä½ç½®ï¼Œåªè¦åŸºè¡¨åœ¨Buildé˜¶æ®µæ„å»ºçš„å“ˆå¸Œè¡¨å¯ä»¥æ”¾è¿›å†…å­˜ï¼ŒHJç®—æ³•å°±å¯ä»¥åœ¨Probeé˜¶æ®µéå†å¤–è¡¨ï¼Œä¾æ¬¡ä¸å“ˆå¸Œè¡¨è¿›è¡Œå…³è”ã€‚</p><p>å½“æ•°æ®èƒ½ä»¥å¹¿æ’­çš„å½¢å¼åœ¨ç½‘ç»œä¸­è¿›è¡Œåˆ†å‘æ—¶ï¼Œè¯´æ˜è¢«åˆ†å‘çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åŸºè¡¨çš„æ•°æ®è¶³å¤Ÿå°ï¼Œå®Œå…¨å¯ä»¥æ”¾åˆ°å†…å­˜ä¸­å»ã€‚è¿™ä¸ªæ—¶å€™ï¼Œç›¸æ¯”NLJã€SMJï¼ŒHJçš„æ‰§è¡Œæ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚å› æ­¤ï¼Œåœ¨å¯ä»¥é‡‡ç”¨HJçš„æƒ…å†µä¸‹ï¼ŒSparkè‡ªç„¶å°±æ²¡æœ‰å¿…è¦å†å»ç”¨SMJè¿™ç§å‰ç½®å¼€é”€æ¯”è¾ƒå¤§çš„æ–¹å¼å»å®Œæˆæ•°æ®å…³è”ã€‚</p><h2>Sparkå¦‚ä½•é€‰æ‹©Joinç­–ç•¥ï¼Ÿ</h2><p>é‚£ä¹ˆï¼Œåœ¨ä¸åŒçš„æ•°æ®å…³è”åœºæ™¯ä¸­ï¼Œå¯¹äºè¿™5ç§Joinç­–ç•¥æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯CPJã€BNLJã€SHJã€SMJä»¥åŠBHJï¼ŒSparkä¼šåŸºäºä»€ä¹ˆé€»è¾‘å–èˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†ä¸¤ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼Œåˆ†åˆ«æ˜¯ç­‰å€¼Joinï¼Œå’Œä¸ç­‰å€¼Joinã€‚</p><h3>ç­‰å€¼Joinä¸‹ï¼ŒSparkå¦‚ä½•é€‰æ‹©Joinç­–ç•¥ï¼Ÿ</h3><p>ç­‰å€¼Joinæ˜¯æŒ‡ä¸¤å¼ è¡¨çš„Join Keyæ˜¯é€šè¿‡ç­‰å€¼æ¡ä»¶è¿æ¥åœ¨ä¸€èµ·çš„ã€‚åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œè¿™ç§Joinå½¢å¼æ˜¯æœ€å¸¸è§çš„ï¼Œå¦‚t1 inner join t2 on <strong>t1.id = t2.id</strong>ã€‚</p><p><strong>åœ¨ç­‰å€¼æ•°æ®å…³è”ä¸­ï¼ŒSparkä¼šå°è¯•æŒ‰ç…§BHJ &gt; SMJ &gt; SHJçš„é¡ºåºä¾æ¬¡é€‰æ‹©Joinç­–ç•¥ã€‚</strong>åœ¨è¿™ä¸‰ç§ç­–ç•¥ä¸­ï¼Œæ‰§è¡Œæ•ˆç‡æœ€é«˜çš„æ˜¯BHJï¼Œå…¶æ¬¡æ˜¯SHJï¼Œå†æ¬¡æ˜¯SMJã€‚å…¶ä¸­ï¼ŒSMJå’ŒSHJç­–ç•¥æ”¯æŒæ‰€æœ‰è¿æ¥ç±»å‹ï¼Œå¦‚å…¨è¿æ¥ã€Anti Joinç­‰ç­‰ã€‚BHJå°½ç®¡æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼šä¸€æ˜¯è¿æ¥ç±»å‹ä¸èƒ½æ˜¯å…¨è¿æ¥ï¼ˆFull Outer Joinï¼‰ï¼›äºŒæ˜¯åŸºè¡¨è¦è¶³å¤Ÿå°ï¼Œå¯ä»¥æ”¾åˆ°å¹¿æ’­å˜é‡é‡Œé¢å»ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆSHJæ¯”SMJæ‰§è¡Œæ•ˆç‡é«˜ï¼Œæ’åå´ä¸å¦‚SMJé å‰å‘¢ï¼Ÿè¿™æ˜¯ä¸ªéå¸¸å¥½çš„é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥è¯´ç»“è®ºï¼Œç›¸æ¯”SHJï¼ŒSparkä¼˜å…ˆé€‰æ‹©SMJçš„åŸå› åœ¨äºï¼ŒSMJçš„å®ç°æ–¹å¼æ›´åŠ ç¨³å®šï¼Œæ›´ä¸å®¹æ˜“OOMã€‚</p><p>å›é¡¾HJçš„å®ç°æœºåˆ¶ï¼Œåœ¨Buildé˜¶æ®µï¼Œç®—æ³•æ ¹æ®å†…è¡¨åˆ›å»ºå“ˆå¸Œè¡¨ã€‚åœ¨Probeé˜¶æ®µï¼Œä¸ºäº†è®©å¤–è¡¨èƒ½å¤ŸæˆåŠŸâ€œæ¢æµ‹â€ï¼ˆProbeï¼‰åˆ°æ¯ä¸€ä¸ªHash Keyï¼Œå“ˆå¸Œè¡¨è¦å…¨éƒ¨æ”¾è¿›å†…å­˜æ‰è¡Œã€‚å¦ç™½è¯´ï¼Œè¿™ä¸ªå‰æè¿˜æ˜¯è›®è‹›åˆ»çš„ï¼Œä»…è¿™ä¸€ç‚¹è¦æ±‚å°±è¶³ä»¥è®©Sparkå¯¹å…¶æœ›è€Œå´æ­¥ã€‚è¦çŸ¥é“ï¼Œåœ¨ä¸åŒçš„è®¡ç®—åœºæ™¯ä¸­ï¼Œæ•°æ®åˆ†å¸ƒçš„å¤šæ ·æ€§å¾ˆéš¾ä¿è¯å†…è¡¨ä¸€å®šèƒ½å…¨éƒ¨æ”¾è¿›å†…å­˜ã€‚</p><p>è€Œä¸”åœ¨Sparkä¸­ï¼ŒSHJç­–ç•¥è¦æƒ³è¢«é€‰ä¸­å¿…é¡»è¦æ»¡è¶³ä¸¤ä¸ªå…ˆå†³æ¡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½æ˜¯å¯¹æ•°æ®å°ºå¯¸çš„è¦æ±‚ã€‚<strong>é¦–å…ˆï¼Œå¤–è¡¨å¤§å°è‡³å°‘æ˜¯å†…è¡¨çš„3å€ã€‚å…¶æ¬¡ï¼Œå†…è¡¨æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å°è¦å°äºå¹¿æ’­å˜é‡é˜ˆå€¼ã€‚</strong>ç¬¬ä¸€ä¸ªæ¡ä»¶çš„åŠ¨æœºå¾ˆå¥½ç†è§£ï¼Œåªæœ‰å½“å†…å¤–è¡¨çš„å°ºå¯¸æ‚¬æ®Šåˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼ŒHJçš„ä¼˜åŠ¿æ‰ä¼šæ¯”SMJæ›´æ˜¾è‘—ã€‚ç¬¬äºŒä¸ªé™åˆ¶çš„ç›®çš„æ˜¯ï¼Œç¡®ä¿å†…è¡¨çš„æ¯ä¸€ä¸ªæ•°æ®åˆ†ç‰‡éƒ½èƒ½å…¨éƒ¨æ”¾è¿›å†…å­˜ã€‚</p><p>å’ŒSHJç›¸æ¯”ï¼ŒSMJæ²¡æœ‰è¿™ä¹ˆå¤šçš„é™„åŠ æ¡ä»¶ï¼Œæ— è®ºæ˜¯å•è¡¨æ’åºï¼Œè¿˜æ˜¯ä¸¤è¡¨åšå½’å¹¶å…³è”ï¼Œéƒ½å¯ä»¥å€ŸåŠ©ç£ç›˜æ¥å®Œæˆã€‚å†…å­˜ä¸­æ”¾ä¸ä¸‹çš„æ•°æ®ï¼Œå¯ä»¥ä¸´æ—¶æº¢å‡ºåˆ°ç£ç›˜ã€‚å•è¡¨æ’åºçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒShuffle Mapé˜¶æ®µç”Ÿæˆä¸­é—´æ–‡ä»¶çš„è¿‡ç¨‹ã€‚åœ¨åšå½’å¹¶å…³è”çš„æ—¶å€™ï¼Œç®—æ³•å¯ä»¥æŠŠç£ç›˜ä¸­çš„æœ‰åºæ•°æ®ç”¨åˆç†çš„ç²’åº¦ï¼Œä¾æ¬¡åŠ è½½è¿›å†…å­˜å®Œæˆè®¡ç®—ã€‚è¿™ä¸ªç²’åº¦å¯å¤§å¯å°ï¼Œå¤§åˆ°ä»¥æ•°æ®åˆ†ç‰‡ä¸ºå•ä½ï¼Œå°åˆ°é€æ¡æ‰«æã€‚</p><p>æ­£æ˜¯è€ƒè™‘åˆ°è¿™äº›å› ç´ ï¼Œç›¸æ¯”SHJï¼ŒSpark SQLä¼šä¼˜å…ˆé€‰æ‹©SMJã€‚äº‹å®ä¸Šï¼Œåœ¨é…ç½®é¡¹spark.sql.join.preferSortMergeJoiné»˜è®¤ä¸ºTrueçš„æƒ…å†µä¸‹ï¼ŒSpark SQLä¼šç”¨SMJç­–ç•¥æ¥å…œåº•ï¼Œç¡®ä¿ä½œä¸šæ‰§è¡Œçš„ç¨³å®šæ€§ï¼Œå‹æ ¹å°±ä¸ä¼šæ‰“ç®—å»å°è¯•SHJã€‚å¼€å‘è€…å¦‚æœæƒ³é€šè¿‡é…ç½®é¡¹æ¥è°ƒæ•´Joinç­–ç•¥ï¼Œéœ€è¦æŠŠè¿™ä¸ªå‚æ•°æ”¹ä¸ºFalseï¼Œè¿™æ ·Spark SQLæ‰æœ‰å¯èƒ½å»å°è¯•SHJã€‚</p><h3>ä¸ç­‰å€¼Joinä¸‹ï¼ŒSparkå¦‚ä½•é€‰æ‹©Joinç­–ç•¥ï¼Ÿ</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ä¸ç­‰å€¼Joinï¼Œå®ƒæŒ‡çš„æ˜¯ä¸¤å¼ è¡¨çš„Join Keyæ˜¯é€šè¿‡ä¸ç­‰å€¼æ¡ä»¶è¿æ¥åœ¨ä¸€èµ·çš„ã€‚ä¸ç­‰å€¼Joinå…¶å®æˆ‘ä»¬åœ¨ä»¥å‰çš„ä¾‹å­ä¸­ä¹Ÿè§è¿‡ï¼Œæ¯”å¦‚åƒæŸ¥è¯¢è¯­å¥t1 inner join t2 on <strong>t1.date &gt; t2.beginDate and t1.date &lt;= t2.endDate</strong>ï¼Œå…¶ä¸­çš„å…³è”å…³ç³»æ˜¯ä¾é ä¸ç­‰å¼è¿æ¥åœ¨ä¸€èµ·çš„ã€‚</p><p><strong>ç”±äºä¸ç­‰å€¼Joinåªèƒ½ä½¿ç”¨NLJæ¥å®ç°ï¼Œå› æ­¤Spark SQLå¯é€‰çš„Joinç­–ç•¥åªå‰©ä¸‹BNLJå’ŒCPJã€‚</strong>åœ¨åŒä¸€ç§è®¡ç®—æ¨¡å¼ä¸‹ï¼Œç›¸æ¯”Shuffleï¼Œå¹¿æ’­çš„ç½‘ç»œå¼€é”€æ›´å°ã€‚æ˜¾ç„¶ï¼Œåœ¨ä¸¤ç§ç­–ç•¥çš„é€‰æ‹©ä¸Šï¼ŒSpark SQLä¸€å®šä¼šæŒ‰ç…§BNLJ &gt; CPJçš„é¡ºåºè¿›è¡Œå°è¯•ã€‚å½“ç„¶ï¼ŒBNLJç”Ÿæ•ˆçš„å‰æè‡ªç„¶æ˜¯å†…è¡¨å°åˆ°å¯ä»¥æ”¾è¿›å¹¿æ’­å˜é‡ã€‚å¦‚æœè¿™ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œé‚£ä¹ˆSpark SQLåªå¥½å§”æ›²æ±‚å…¨ï¼Œä½¿ç”¨ç¬¨é‡çš„CPJç­–ç•¥å»å®Œæˆå…³è”è®¡ç®—ã€‚</p><h2>å¼€å‘è€…èƒ½åšäº›ä»€ä¹ˆï¼Ÿ</h2><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥èŠèŠï¼Œé¢å¯¹ä¸Šè¿°çš„5ç§Joinç­–ç•¥ï¼Œå¼€å‘è€…è¿˜èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿé€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒSpark SQLå¯¹äºè¿™äº›ç­–ç•¥çš„å–èˆä¹ŸåŸºäºä¸€äº›æ—¢å®šçš„è§„åˆ™ã€‚æ‰€è°“è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œé¢„ç½®çš„è§„åˆ™è‡ªç„¶å¾ˆéš¾è¦†ç›–å¤šæ ·ä¸”å˜åŒ–æ— å¸¸çš„è®¡ç®—åœºæ™¯ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æŒæ¡äº†ä¸åŒJoinç­–ç•¥çš„å·¥ä½œåŸç†ï¼Œç»“åˆæˆ‘ä»¬å¯¹äºä¸šåŠ¡å’Œæ•°æ®çš„æ·±åˆ»ç†è§£ï¼Œå®Œå…¨å¯ä»¥è‡ªè¡Œå†³å®šåº”è¯¥é€‰æ‹©å“ªç§Joinç­–ç•¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/94/b8/9436f0f9352ffa381b238be57d2ecdb8.jpeg?wh=1920*1080\" alt=\"\"></p><p>åœ¨æœ€æ–°å‘å¸ƒçš„3.0ç‰ˆæœ¬ä¸­ï¼ŒSparkä¸ºå¼€å‘è€…æä¾›äº†å¤šæ ·åŒ–çš„Join Hintsï¼Œå…è®¸ä½ æŠŠä¸“å®¶ç»éªŒå‡Œé©¾äºSpark SQLçš„é€‰æ‹©é€»è¾‘ä¹‹ä¸Šã€‚<strong>åœ¨æ»¡è¶³å‰ææ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå¦‚ç­‰å€¼æ¡ä»¶ã€è¿æ¥ç±»å‹ã€è¡¨å¤§å°ç­‰ç­‰ï¼ŒSparkä¼šä¼˜å…ˆå°Šé‡å¼€å‘è€…çš„æ„æ„¿ï¼Œå»é€‰å–å¼€å‘è€…é€šè¿‡Join HintsæŒ‡å®šçš„Joinç­–ç•¥ã€‚</strong>å…³äºSpark 3.0æ”¯æŒçš„Join Hintså…³é”®å­—ï¼Œä»¥åŠå¯¹åº”çš„é€‚ç”¨åœºæ™¯ï¼Œæˆ‘æŠŠå®ƒä»¬æ€»ç»“åˆ°äº†å¦‚ä¸Šçš„è¡¨æ ¼ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥æ‹¿æ¥å‚è€ƒã€‚</p><p>ç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥æŒ‡å®šJoin Hintsï¼Œä¸€ç§æ˜¯é€šè¿‡SQLç»“æ„åŒ–æŸ¥è¯¢è¯­å¥ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨DataFrameçš„DSLè¯­è¨€ï¼Œéƒ½å¾ˆæ–¹ä¾¿ã€‚è‡³äºæ›´å…¨é¢çš„è®²è§£ï¼Œä½ å¯ä»¥å»<a href=\"https://time.geekbang.org/column/article/360837\">ç¬¬13è®²</a>çœ‹çœ‹ï¼Œè¿™é‡Œæˆ‘å°±ä¸å¤šè¯´äº†ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»æ•°æ®å…³è”çš„å®ç°åŸç†ï¼Œåˆ°Spark SQLä¸åŒJoinç­–ç•¥çš„é€‚ç”¨åœºæ™¯ï¼ŒæŒæ¡è¿™äº›å…³é”®çŸ¥è¯†ç‚¹ï¼Œå¯¹äºæ•°æ®å…³è”åœºæ™¯ä¸­çš„æ€§èƒ½è°ƒä¼˜è‡³å…³é‡è¦ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦æŒæ¡3ç§Joinå®ç°æœºåˆ¶çš„å·¥ä½œåŸç†ã€‚ä¸ºäº†æ–¹ä¾¿ä½ å¯¹æ¯”ï¼Œæˆ‘æŠŠå®ƒä»¬æ€»ç»“åœ¨äº†ä¸‹é¢çš„è¡¨æ ¼é‡Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/86/bc/86bb13a5b7b96da4f5128df8b54b96bc.jpeg?wh=1920*864\" alt=\"\"></p><p>æŒæ¡äº†3ç§å…³è”æœºåˆ¶çš„å®ç°åŸç†ï¼Œä½ å°±èƒ½æ›´å¥½åœ°ç†è§£Spark SQLçš„Joinç­–ç•¥ã€‚ç»“åˆæ•°æ®çš„ç½‘ç»œåˆ†å‘æ–¹å¼ï¼ˆShuffleå’Œå¹¿æ’­ï¼‰ï¼ŒSpark SQLæ”¯æŒ5ç§Joinç­–ç•¥ï¼ŒæŒ‰ç…§æ‰§è¡Œæ•ˆç‡æ’åºå°±æ˜¯BHJ &gt; SHJ &gt; SMJ &gt; BNLJ &gt; CPJã€‚åŒæ ·ï¼Œä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„è¡¨æ ¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/9e/7be7f01b383463f804a2db74a68d5e9e.jpeg?wh=1920*716\" alt=\"\"></p><p>æœ€åï¼Œå½“ä½ æŒæ¡äº†ä¸åŒJoinç­–ç•¥çš„å·¥ä½œåŸç†ï¼Œç»“åˆå¯¹äºä¸šåŠ¡å’Œæ•°æ®çš„æ·±åˆ»ç†è§£ï¼Œå®é™…ä¸Šä½ å¯ä»¥è‡ªè¡Œå†³å®šåº”è¯¥é€‰æ‹©å“ªç§Joinç­–ç•¥ï¼Œä¸å¿…å®Œå…¨ä¾èµ–Spark SQLçš„åˆ¤æ–­ã€‚</p><p>Sparkä¸ºå¼€å‘è€…æä¾›äº†å¤šæ ·åŒ–çš„Join Hintsï¼Œå…è®¸ä½ æŠŠä¸“å®¶ç»éªŒå‡Œé©¾äºSpark SQLçš„é€‰æ‹©é€»è¾‘ä¹‹ä¸Šã€‚æ¯”å¦‚ï¼Œå½“ä½ ç¡®ä¿¡å¤–è¡¨æ¯”å†…è¡¨å¤§å¾—å¤šï¼Œè€Œä¸”å†…è¡¨æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼Œä½¿ç”¨SHJè¿œæ¯”é»˜è®¤çš„SMJæ•ˆç‡é«˜å¾—å¤šçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥é€šè¿‡æŒ‡å®šJoin Hintsæ¥å¼ºåˆ¶Spark SQLæŒ‰ç…§ä½ çš„æ„æ„¿å»é€‰æ‹©Joinç­–ç•¥ã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>å¦‚æœå…³è”çš„åœºæ™¯æ˜¯äº‹å®è¡¨Joinäº‹å®è¡¨ï¼Œä½ è§‰å¾—æˆ‘ä»¬ä»Šå¤©è®²çš„Sort Merge Joinå®ç°æ–¹å¼è¿˜é€‚ç”¨å—ï¼Ÿå¦‚æœè®©ä½ æ¥è®¾è®¡ç®—æ³•çš„å®ç°æ­¥éª¤ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</li>\n<li>ä½ è§‰å¾—ï¼Œä¸ç­‰å€¼Joinå¯ä»¥å¼ºè¡Œç”¨Sort Merge Joinå’ŒHash Joinä¸¤ç§æœºåˆ¶æ¥å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","neighbors":{"left":{"article_title":"25 | Spark 3.0ï¼ˆäºŒï¼‰ï¼šDPPç‰¹æ€§è¯¥æ€ä¹ˆç”¨ï¼Ÿ","id":372234},"right":{"article_title":"27 | å¤§è¡¨Joinå°è¡¨ï¼šå¹¿æ’­å˜é‡å®¹ä¸ä¸‹å°è¡¨æ€ä¹ˆåŠï¼Ÿ","id":373089}},"comments":[{"had_liked":false,"id":292454,"user_name":"kingcall","can_delete":false,"product_type":"c1","uid":1056982,"ip_address":"","ucode":"508884DC684B5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","comment_is_top":false,"comment_ctime":1620828246,"is_pvip":false,"replies":[{"id":"105901","content":"åˆ°ä½~<br><br>1. Shuffle Sort Merge Joinï¼Œå¯¹äºâ€œå¤§è¡¨Joinå¤§è¡¨â€æ¥è¯´ï¼Œæ˜¯æœ€ç¨³å®šçš„å®ç°æ–¹å¼ï¼Œä¸è¿‡å…³äºâ€œå¤§è¡¨Joinå¤§è¡¨â€ï¼Œå’±ä»¬è¿˜æ˜¯æœ‰ä¸€äº›è°ƒä¼˜æ‰‹æ®µçš„ï¼Œè¿™å—å¯ä»¥å…³æ³¨28ã€29è®²å“ˆ~<br><br>2. ç¡®å®ï¼Œæ’åºå’Œæ„å»ºhash tableæœ¬èº«æˆäº†å¼€é”€ï¼Œåœ¨ä¸ç­‰å€¼çš„æƒ…å†µä¸‹ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620860887,"ip_address":"","comment_id":292454,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27390632022","product_id":100073401,"comment_content":"å›ç­”ï¼š<br>é—®é¢˜1ï¼šä¸ªäººè§‰å¾—SMJ å°±æ˜¯ç”¨åœ¨ä¸¤å¼ å¤§è¡¨ä¸Šçš„å…³è”æ‰æœ‰æ„æ€å•Šï¼Œä¹Ÿå°±æ˜¯äº‹å®è¡¨ Join äº‹å®è¡¨ï¼Œä½†æ˜¯è¿™é‡Œè¦æ±‚æ˜¯ç­‰å€¼å…³è”ï¼Œå¦‚æœæ˜¯ä¸ç­‰å€¼å…³è”å°±åªèƒ½CPJ<br>é—®é¢˜2ï¼šå¯ä»¥åˆ†æƒ…å†µè®¨è®ºä¸€ä¸‹ï¼Œä½†æ˜¯è‚¯å®šæ˜¯å¯ä»¥å®ç°çš„<br>    1. != è¿™æ ·çš„å…³è”ï¼ŒSort Merge Join å’Œ Hash Join éƒ½æ˜¯ä¸åˆ’ç®—çš„ï¼Œä½†æ˜¯æ˜¯å¯ä»¥å®ç°çš„ã€‚<br>    2. å¤§äºç­‰äºã€å°äºç­‰äº ã€å¤§äº ã€å°äº Sort Merge Join è¿˜æ˜¯æœ‰å¯å–ä¹‹å¤„çš„ï¼Œä½†æ˜¯è¿˜æ˜¯è€ƒè™‘åˆ°äº†æ’åºçš„æˆæœ¬ï¼Œä½†æ˜¯è¿™ä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªé—®é¢˜é‚£å°±æ˜¯æˆ‘ä»¬çš„shuffleè¾“å‡ºçš„æ•°æ®çš„æœ¬èº«å°±æ˜¯æœ‰åºçš„å•Šï¼Œæ‰€ä»¥æˆ‘è§‰å¾— Sort Merge Join æ˜¯å¯ä»¥çš„ï¼ŒHash Join å°±ç®—äº†ï¼Œå…¶å®å¯ä»¥çœ‹å‡ºæ¥hash åªé€‚åˆç­‰å€¼ï¼Œè¿™æ˜¯å–å†³äºhash æœ¬èº«çš„ç‰¹ç‚¹çš„ã€‚","like_count":7,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519837,"discussion_content":"åˆ°ä½~\n\n1. Shuffle Sort Merge Joinï¼Œå¯¹äºâ€œå¤§è¡¨Joinå¤§è¡¨â€æ¥è¯´ï¼Œæ˜¯æœ€ç¨³å®šçš„å®ç°æ–¹å¼ï¼Œä¸è¿‡å…³äºâ€œå¤§è¡¨Joinå¤§è¡¨â€ï¼Œå’±ä»¬è¿˜æ˜¯æœ‰ä¸€äº›è°ƒä¼˜æ‰‹æ®µçš„ï¼Œè¿™å—å¯ä»¥å…³æ³¨28ã€29è®²å“ˆ~\n\n2. ç¡®å®ï¼Œæ’åºå’Œæ„å»ºhash tableæœ¬èº«æˆäº†å¼€é”€ï¼Œåœ¨ä¸ç­‰å€¼çš„æƒ…å†µä¸‹ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620860887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306648,"user_name":"louis","can_delete":false,"product_type":"c1","uid":1535795,"ip_address":"","ucode":"E5C06FB94C3C6A","user_header":"https://static001.geekbang.org/account/avatar/00/17/6f/33/8a26a19a.jpg","comment_is_top":false,"comment_ctime":1628656479,"is_pvip":false,"replies":[{"id":"111316","content":"éå¸¸å¥½çš„é—®é¢˜~ åŒæ„ä½ çš„è¯´æ³•ï¼Œæ›´ä¸¥è°¨ï¼Œç¡®å®æ˜¯åº”è¯¥æ¯ä¸ªåˆ†ç‰‡éƒ½èƒ½æ”¾å…¥å†…å­˜ï¼Œæ‰æ˜¯æ›´ä¸¥è°¨çš„è¦æ±‚ã€‚<br><br>ä¸è¿‡ï¼Œè¿™ç§è¯´æ³•çš„å¯æ“ä½œæ€§ä¸å¼ºï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆéš¾ç¡®è®¤ï¼Œæ¯ä¸ªæ•°æ®åˆ†ç‰‡çš„å¤§å°ï¼Œæ›´éš¾ç¡®è®¤çš„æ˜¯ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½èƒ½åˆšå¥½æ”¾è¿›å†…å­˜ã€‚<br><br>â€œå†…è¡¨æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å°è¦å°äºå¹¿æ’­å˜é‡é˜ˆå€¼â€ï¼Œè¿™ç§è¯´æ³•ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§â€œä¸å‡†ç¡®â€ä½†æ˜¯æ“ä½œæ€§æ›´å¼ºçš„åŠæ³•ï¼Œè®¡ç®—åˆ†ç‰‡çš„å¹³å‡å¤§å°è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå†è€…å¹¿æ’­å˜é‡é˜ˆå€¼å…¶å®æ˜¯ä¸ªå¾ˆå¥½çš„â€œå‚ç…§ç³»â€ã€‚å¦‚æœåˆ†ç‰‡å¹³å‡å¤§å°èƒ½å¤Ÿæ¯”å¹¿æ’­é˜ˆå€¼è¿˜è¦å°ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡SHJèƒ½å¤Ÿé¡ºåˆ©åœ°æ‰§è¡ŒæˆåŠŸã€‚<br><br>ä½ è¯´çš„å¯¹ï¼Œè¿™é‡Œè·Ÿå¹¿æ’­æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè·Ÿå¹¿æ’­é˜ˆå€¼ä½œå¯¹æ¯”ï¼Œæ›´å¤šåœ°æ˜¯ç»™å¤§å®¶ä¸€ä¸ªæ˜ç¡®çš„â€œå‚ç…§ç³»â€ã€‚ä¸ºä»€ä¹ˆé€‰å®ƒå‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå’±ä»¬éƒ½ä¼šåœ¨å¹¿æ’­é˜ˆå€¼ä¸Šâ€œç²¾æ‰“ç»†ç®—â€ï¼Œå¯¹å®ƒçš„è®¾ç½®éƒ½ä¼šæ¯”è¾ƒè°¨æ…ï¼Œæ‰€ä»¥æ‹¿ä»–åšå‚ç…§ï¼Œä¼šæ¯”è¾ƒç¨³å¦¥ä¸€äº›ã€‚<br><br>ä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå°±æ˜¯åº”è¯¥æŒ‰ç…§ä½ è¯´çš„ï¼Œç¡®ä¿æ‰€æœ‰åˆ†ç‰‡ï¼Œå¯ä»¥æ”¾è¿›å†…å­˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1629107121,"ip_address":"","comment_id":306648,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23103492959","product_id":100073401,"comment_content":"SHJçš„ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œâ€œå†…è¡¨æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å°è¦å°äºå¹¿æ’­å˜é‡é˜ˆå€¼â€ã€‚<br>è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯å¹¿æ’­å˜é‡é˜ˆå€¼ï¼Œè¿™é‡Œä¸æ¶‰åŠå¹¿æ’­å•Šï¼Ÿä¸åº”è¯¥æ˜¯å†…è¡¨çš„æ¯ä¸€ä¸ªæ•°æ®åˆ†ç‰‡éƒ½æ°å¥½æ”¾å…¥æ‰§è¡Œå†…å­˜ä¸­ã€‚","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524857,"discussion_content":"éå¸¸å¥½çš„é—®é¢˜~ åŒæ„ä½ çš„è¯´æ³•ï¼Œæ›´ä¸¥è°¨ï¼Œç¡®å®æ˜¯åº”è¯¥æ¯ä¸ªåˆ†ç‰‡éƒ½èƒ½æ”¾å…¥å†…å­˜ï¼Œæ‰æ˜¯æ›´ä¸¥è°¨çš„è¦æ±‚ã€‚\n\nä¸è¿‡ï¼Œè¿™ç§è¯´æ³•çš„å¯æ“ä½œæ€§ä¸å¼ºï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆéš¾ç¡®è®¤ï¼Œæ¯ä¸ªæ•°æ®åˆ†ç‰‡çš„å¤§å°ï¼Œæ›´éš¾ç¡®è®¤çš„æ˜¯ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½èƒ½åˆšå¥½æ”¾è¿›å†…å­˜ã€‚\n\nâ€œå†…è¡¨æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å°è¦å°äºå¹¿æ’­å˜é‡é˜ˆå€¼â€ï¼Œè¿™ç§è¯´æ³•ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§â€œä¸å‡†ç¡®â€ä½†æ˜¯æ“ä½œæ€§æ›´å¼ºçš„åŠæ³•ï¼Œè®¡ç®—åˆ†ç‰‡çš„å¹³å‡å¤§å°è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå†è€…å¹¿æ’­å˜é‡é˜ˆå€¼å…¶å®æ˜¯ä¸ªå¾ˆå¥½çš„â€œå‚ç…§ç³»â€ã€‚å¦‚æœåˆ†ç‰‡å¹³å‡å¤§å°èƒ½å¤Ÿæ¯”å¹¿æ’­é˜ˆå€¼è¿˜è¦å°ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡SHJèƒ½å¤Ÿé¡ºåˆ©åœ°æ‰§è¡ŒæˆåŠŸã€‚\n\nä½ è¯´çš„å¯¹ï¼Œè¿™é‡Œè·Ÿå¹¿æ’­æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè·Ÿå¹¿æ’­é˜ˆå€¼ä½œå¯¹æ¯”ï¼Œæ›´å¤šåœ°æ˜¯ç»™å¤§å®¶ä¸€ä¸ªæ˜ç¡®çš„â€œå‚ç…§ç³»â€ã€‚ä¸ºä»€ä¹ˆé€‰å®ƒå‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå’±ä»¬éƒ½ä¼šåœ¨å¹¿æ’­é˜ˆå€¼ä¸Šâ€œç²¾æ‰“ç»†ç®—â€ï¼Œå¯¹å®ƒçš„è®¾ç½®éƒ½ä¼šæ¯”è¾ƒè°¨æ…ï¼Œæ‰€ä»¥æ‹¿ä»–åšå‚ç…§ï¼Œä¼šæ¯”è¾ƒç¨³å¦¥ä¸€äº›ã€‚\n\nä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå°±æ˜¯åº”è¯¥æŒ‰ç…§ä½ è¯´çš„ï¼Œç¡®ä¿æ‰€æœ‰åˆ†ç‰‡ï¼Œå¯ä»¥æ”¾è¿›å†…å­˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629107121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294015,"user_name":"å¿«è·‘","can_delete":false,"product_type":"c1","uid":1564645,"ip_address":"","ucode":"90ED7E6D40C58E","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg","comment_is_top":false,"comment_ctime":1621678940,"is_pvip":false,"replies":[{"id":"106636","content":"å¥½é—®é¢˜ï¼Œä¸€ä¸ªä¸ªæ¥è¯´ã€‚<br><br>å…ˆè¯´ç¬¬ä¸€ä¸ªï¼Œæ˜¯çš„ï¼ŒJoinçš„æ“ä½œæ˜¯å‘ç”Ÿåœ¨Reduceé˜¶æ®µï¼ŒåŸå› å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸¤å¼ è¡¨Join Keysç›¸åŒçš„recordsï¼Œè¦åˆ†å‘åˆ°åŒä¸€ä¸ªExecutorsè¿›ç¨‹ï¼Œè¿™æ ·æ‰èƒ½å®Œæˆå…³è”è®¡ç®—ã€‚ä¸€æ—¦ä¸¤è¡¨çš„recordsè¿›å…¥åˆ°åŒä¸€ä¸ªExecutorsï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯çœ‹é‡‡ç”¨ä»€ä¹ˆå®ç°æœºåˆ¶äº†ï¼Œä¹Ÿå°±æ˜¯hash joinï¼Œsort merge joinï¼Œè¿˜æ˜¯nested loop joinã€‚<br><br>ç¬¬äºŒä¸ªï¼Œ å…¶å®æ˜¯åè¿‡æ¥çš„ï¼Œå°±æ˜¯å¦‚æœSparké€‰æ‹©Shuffle SMJç­–ç•¥ï¼Œé‚£ä¹ˆmapé˜¶æ®µå°±ä¼šæŒ‰ç…§ï¼ˆpartitionIdï¼ŒJoin Keyï¼‰æ¥æ’åºã€‚ä½†å¦‚æœé‡‡ç”¨äº†Shuffle Hash Joinçš„ç­–ç•¥ï¼ŒMapé˜¶æ®µåªéœ€è¦å¯¹partitionIdåšæ’åºå°±å¯ä»¥ï¼Œä¸éœ€è¦å¯¹Join Keyåšæ’åºï¼Œè®¡ç®—å¤æ‚åº¦è¿˜æ˜¯ä¼šæœ‰æ‰€é™ä½çš„ã€‚<br><br>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œè¶…çº§å¥½çš„é—®é¢˜ï¼Œå¯¹äºCPJï¼Œå®ƒå…¶å®å°±ä¸å†æ˜¯ç®€å•çš„Shuffleè¿‡ç¨‹äº†ï¼Œä¸€èˆ¬çš„Shuffleè¿‡ç¨‹ï¼Œæ˜¯æ¯ä»½æ•°æ®åªåˆ†å‘ä¸€æ¬¡ã€‚ä½†å¯¹äºCPJï¼Œå°±åƒä½ è¯´çš„ï¼Œå®ƒæ˜¯æ•°æ®é›†çš„å…¨ç½‘åˆ†å‘ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€å¼ è¡¨â€œå¾…åœ¨åŸåœ°ã€ä¿æŒä¸åŠ¨â€ï¼Œè€Œå¦ä¸€å¼ è¡¨çš„æ‰€æœ‰æ•°æ®åˆ†ç‰‡ï¼Œéƒ½éœ€è¦åœ¨å…¨ç½‘æ¯ä¸ªExecutorsä¸­å…¨éƒ½åˆ†å‘ä¸€éï¼Œè¿™ä¹Ÿæ˜¯Cartesian Product Joinè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå°±æ˜¯ç¬›å¡å°”ç§¯ä¹ˆï¼Œéå¸¸å˜æ€åŠ å¤¸å¼ çš„è®¡ç®—å¤æ‚åº¦ã€‚æ‰€ä»¥ä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œè¦å°½é‡ç¦»CPJè¿œè¿œåœ°~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621695253,"ip_address":"","comment_id":294015,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18801548124","product_id":100073401,"comment_content":"è€å¸ˆä½ å¥½ï¼Œäº§ç”Ÿäº†å‡ ä¸ªç–‘é—®ï¼Œè¯·å¸®å¿™çœ‹çœ‹æˆ‘ç†è§£çš„å¯¹ä¹ˆ<br>1ã€ä»MapReduceé˜¶æ®µæ¥çœ‹JOINï¼Œå¸¦Shuffleçš„Joinåº”è¯¥éƒ½å‘ç”Ÿåœ¨Reduceé˜¶æ®µï¼Ÿ<br><br>2ã€ç»è¿‡Shuffleåçš„æ•°æ®ä¸å°±å·²ç»æ˜¯æ’åºçš„ä¹ˆï¼Œè¿™æ ·å­ä½¿ç”¨SMJæ˜¯ä¸æ˜¯æ¯”SHJå°‘äº†Hashè®¡ç®—ï¼Œä¹Ÿå‡å°‘æ„å»ºHashçš„å†…å­˜å¼€é”€ã€‚<br><br>3ã€ä¸ç­‰å€¼è¿æ¥çš„æƒ…å†µï¼ŒBNLJä¸ç”Ÿæ•ˆçš„æ—¶å€™ï¼Œé‡‡ç”¨CPJç­–ç•¥æ—¶å€™ï¼ŒJOINå‘ç”Ÿåœ¨Reduceé˜¶æ®µï¼Ÿ è¿™ä¸ªæ—¶å€™æ•°æ®ä¸éƒ½åˆ†æ•£åœ¨å„ä¸ªèŠ‚ç‚¹ä¹ˆã€‚ å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ€ä¹ˆè·Ÿå…¶ä»–èŠ‚ç‚¹çš„æ•°æ®æ¯”è¾ƒå‘¢ã€‚<br>è¿™ä¸ªæ—¶å€™ä¸ä»…ä»…æ˜¯æ•°æ®é€»è¾‘ä¸Šè¦Nested Loopã€‚å°±è¿æ•°æ®ä¹Ÿéœ€è¦é€šè¿‡ç½‘ç»œæŒ¨ä¸ªèŠ‚ç‚¹ä¼ è¾“ä¸€éä¹ˆ","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520465,"discussion_content":"å¥½é—®é¢˜ï¼Œä¸€ä¸ªä¸ªæ¥è¯´ã€‚\n\nå…ˆè¯´ç¬¬ä¸€ä¸ªï¼Œæ˜¯çš„ï¼ŒJoinçš„æ“ä½œæ˜¯å‘ç”Ÿåœ¨Reduceé˜¶æ®µï¼ŒåŸå› å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸¤å¼ è¡¨Join Keysç›¸åŒçš„recordsï¼Œè¦åˆ†å‘åˆ°åŒä¸€ä¸ªExecutorsè¿›ç¨‹ï¼Œè¿™æ ·æ‰èƒ½å®Œæˆå…³è”è®¡ç®—ã€‚ä¸€æ—¦ä¸¤è¡¨çš„recordsè¿›å…¥åˆ°åŒä¸€ä¸ªExecutorsï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯çœ‹é‡‡ç”¨ä»€ä¹ˆå®ç°æœºåˆ¶äº†ï¼Œä¹Ÿå°±æ˜¯hash joinï¼Œsort merge joinï¼Œè¿˜æ˜¯nested loop joinã€‚\n\nç¬¬äºŒä¸ªï¼Œ å…¶å®æ˜¯åè¿‡æ¥çš„ï¼Œå°±æ˜¯å¦‚æœSparké€‰æ‹©Shuffle SMJç­–ç•¥ï¼Œé‚£ä¹ˆmapé˜¶æ®µå°±ä¼šæŒ‰ç…§ï¼ˆpartitionIdï¼ŒJoin Keyï¼‰æ¥æ’åºã€‚ä½†å¦‚æœé‡‡ç”¨äº†Shuffle Hash Joinçš„ç­–ç•¥ï¼ŒMapé˜¶æ®µåªéœ€è¦å¯¹partitionIdåšæ’åºå°±å¯ä»¥ï¼Œä¸éœ€è¦å¯¹Join Keyåšæ’åºï¼Œè®¡ç®—å¤æ‚åº¦è¿˜æ˜¯ä¼šæœ‰æ‰€é™ä½çš„ã€‚\n\nç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œè¶…çº§å¥½çš„é—®é¢˜ï¼Œå¯¹äºCPJï¼Œå®ƒå…¶å®å°±ä¸å†æ˜¯ç®€å•çš„Shuffleè¿‡ç¨‹äº†ï¼Œä¸€èˆ¬çš„Shuffleè¿‡ç¨‹ï¼Œæ˜¯æ¯ä»½æ•°æ®åªåˆ†å‘ä¸€æ¬¡ã€‚ä½†å¯¹äºCPJï¼Œå°±åƒä½ è¯´çš„ï¼Œå®ƒæ˜¯æ•°æ®é›†çš„å…¨ç½‘åˆ†å‘ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€å¼ è¡¨â€œå¾…åœ¨åŸåœ°ã€ä¿æŒä¸åŠ¨â€ï¼Œè€Œå¦ä¸€å¼ è¡¨çš„æ‰€æœ‰æ•°æ®åˆ†ç‰‡ï¼Œéƒ½éœ€è¦åœ¨å…¨ç½‘æ¯ä¸ªExecutorsä¸­å…¨éƒ½åˆ†å‘ä¸€éï¼Œè¿™ä¹Ÿæ˜¯Cartesian Product Joinè¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå°±æ˜¯ç¬›å¡å°”ç§¯ä¹ˆï¼Œéå¸¸å˜æ€åŠ å¤¸å¼ çš„è®¡ç®—å¤æ‚åº¦ã€‚æ‰€ä»¥ä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œè¦å°½é‡ç¦»CPJè¿œè¿œåœ°~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621695253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318676,"user_name":"To_Drill","can_delete":false,"product_type":"c1","uid":1415245,"ip_address":"","ucode":"7E6FFAF1986EC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/98/4d/582d24f4.jpg","comment_is_top":false,"comment_ctime":1635388323,"is_pvip":false,"replies":[{"id":"115574","content":"å¯¹çš„ï¼Œæ²¡é”™ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635425480,"ip_address":"","comment_id":318676,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10225322915","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªç–‘é—®æƒ³è¯·æ•™ä¸‹ï¼Œå¦‚æœé€‰æ‹©äº†SMJï¼Œé‚£ä¹ˆåœ¨mapç«¯shuffleçš„è¾“å‡ºæ–‡ä»¶ä¸­æ˜¯æŒ‰partitionIDå’Œkeyæ’åºçš„ï¼Œä½†æ˜¯mapç«¯ä¸åº”è¯¥åªæ˜¯å±€éƒ¨æ•°æ®çš„æ’åºå˜›ï¼Œå½“reduceç«¯æ‹‰å–å„ä¸ªè¾“å‡ºæ–‡ä»¶çš„æ—¶å€™è¿˜æ˜¯ä¼šåšä¸€æ¬¡å…¨å±€æ’åºï¼ˆç²’åº¦ä¸ºpartitionï¼‰çš„å§ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯é‚£ä¹ˆmapç«¯çš„æ’åºåªæ˜¯åŠ å¿«äº†åç»­reduceç«¯å…¨å±€æ’åºçš„æ•ˆç‡ï¼Œè€Œä¸æ˜¯mapç«¯æ’åºäº†ä¹‹åreduceç«¯å°±ä¸éœ€è¦æ’åºäº†æ˜¯å§ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529341,"discussion_content":"å¯¹çš„ï¼Œæ²¡é”™ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635425480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292497,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1620860014,"is_pvip":false,"replies":[{"id":"105923","content":"æ²¡æœ‰åŒºåˆ«å“ˆ~<br><br>å°è¡¨Joinå¤§è¡¨ï¼Œæ‰è¿‡æ¥ä¸å°±æ˜¯å¤§è¡¨Joinå°è¡¨ä¹ˆï¼Ÿå…¶å®ä¸è®ºè°Joinè°ï¼Œå…¶å®ä¼˜åŒ–å™¨éƒ½æ˜¯ä¼šåšåŒºåˆ†çš„ã€‚ä¸è¿‡é€šå¸¸æ¥è¯´ï¼Œåœ¨å½¢å¼ä¸Šï¼Œæˆ‘ä»¬æŠŠå¤–è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾å·¦è¾¹ï¼Œè€Œå†…è¡¨ï¼ˆåŸºè¡¨ï¼‰æ”¾å³è¾¹ï¼Œæ‰€ä»¥ä¸“æ é‡Œé¢ï¼Œåœ¨æè¿°çš„æ—¶å€™ï¼Œéƒ½æ˜¯â€œå¤§è¡¨Joinå°è¡¨â€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620887855,"ip_address":"","comment_id":292497,"utype":1}],"discussion_count":6,"race_medal":0,"score":"10210794606","product_id":100073401,"comment_content":"è€å¸ˆä¸€èˆ¬SQLçš„æ•™ç¨‹é‡Œéƒ½æ˜¯joinçš„ä¼˜åŒ–æ–¹æ³•ä¹‹ä¸€æ˜¯å°è¡¨joinå¤§è¡¨ï¼Œä½†æˆ‘çœ‹Sparké‡Œä½ éƒ½æ˜¯å¤§è¡¨joinå°è¡¨ï¼Œåœ¨å¤§æ•°æ®é‡Œè°joinè°è¦ç´§å—ï¼Œæ„Ÿè§‰å¥½åƒæ— æ‰€è°“ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519853,"discussion_content":"æ²¡æœ‰åŒºåˆ«å“ˆ~\n\nå°è¡¨Joinå¤§è¡¨ï¼Œæ‰è¿‡æ¥ä¸å°±æ˜¯å¤§è¡¨Joinå°è¡¨ä¹ˆï¼Ÿå…¶å®ä¸è®ºè°Joinè°ï¼Œå…¶å®ä¼˜åŒ–å™¨éƒ½æ˜¯ä¼šåšåŒºåˆ†çš„ã€‚ä¸è¿‡é€šå¸¸æ¥è¯´ï¼Œåœ¨å½¢å¼ä¸Šï¼Œæˆ‘ä»¬æŠŠå¤–è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾å·¦è¾¹ï¼Œè€Œå†…è¡¨ï¼ˆåŸºè¡¨ï¼‰æ”¾å³è¾¹ï¼Œæ‰€ä»¥ä¸“æ é‡Œé¢ï¼Œåœ¨æè¿°çš„æ—¶å€™ï¼Œéƒ½æ˜¯â€œå¤§è¡¨Joinå°è¡¨â€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620887855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179298,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","nickname":"å¯¹æ–¹æ­£åœ¨è¾“å…¥ã€‚ã€‚ã€‚","note":"","ucode":"7B0DEB4D9B43D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374144,"discussion_content":"å·¦è¿æ¥çš„è¯å°è¡¨å¾—æ”¾å³è¾¹ï¼Œå³è¿æ¥çš„è¯å°è¡¨å¾—æ”¾å·¦è¾¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621041950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1179298,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","nickname":"å¯¹æ–¹æ­£åœ¨è¾“å…¥ã€‚ã€‚ã€‚","note":"","ucode":"7B0DEB4D9B43D2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375926,"discussion_content":"æ­£è§£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621870706,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374144,"ip_address":""},"score":375926,"extra":""},{"author":{"id":1789481,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","nickname":"é™å¿ƒ","note":"","ucode":"B80DE4B5C923D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1179298,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","nickname":"å¯¹æ–¹æ­£åœ¨è¾“å…¥ã€‚ã€‚ã€‚","note":"","ucode":"7B0DEB4D9B43D2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414030,"discussion_content":"why?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636639009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374144,"ip_address":""},"score":414030,"extra":""}]},{"author":{"id":1018685,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/3d/0c3a2fd4.jpg","nickname":"å¶å°”å¤æ´»ä¸‹","note":"","ucode":"18B1D525CD50D3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536046,"discussion_content":"æ–°ç‰ˆæœ¬ä¼šè‡ªè¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥å¤§å°è¡¨æ”¾å“ªè¾¹éƒ½å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638665054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2304851,"avatar":"https://static001.geekbang.org/account/avatar/00/23/2b/53/1adc2037.jpg","nickname":"é£å‘å†³å®šå‘å‹","note":"","ucode":"7EE798C3ADFC11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410776,"discussion_content":"å› ä¸ºåŸºè¡¨æ— æ³•è¢«å¹¿æ’­ï¼Œæ‰€ä»¥sparkä¸­å¤§è¡¨joinå°è¡¨ä¼šå¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635774600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292417,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1620812378,"is_pvip":false,"replies":[{"id":"105899","content":"æ»¡åˆ†ğŸ’¯<br><br>ç¬¬ä¸€é¢˜ç­”å¾—å°¤å…¶å¥½ï¼Œè¿™é“é¢˜çš„åˆè¡·å°±æ˜¯é¼“åŠ±å¤§å®¶å‘æ•£æ€ç»´ï¼Œå¤§å¼€è„‘æ´ï¼Œå»æ€è€ƒæ›´å¤šçš„å®ç°æ–¹å¼~ ä½ è¯´çš„å®ç°æ–¹å¼ï¼Œæˆ‘è§‰å¾—è›®æœ‰æ„æ€ï¼Œç®—æ³•å¤æ‚åº¦ä»‹äºNLJå’ŒSMJä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯Oï¼ˆM*logNï¼‰ï¼Œå‰ç½®å¼€é”€æ˜¯ä¸€æ¬¡æ’åºï¼Œè¿™ç§å®ç°å…¶å®è¿˜æ˜¯èƒ½é€‚é…ä¸€äº›åœºæ™¯çš„~ 666~<br><br>ç¬¬äºŒé¢˜åˆ†æçš„å¾ˆåˆ°ä½ï¼Œå¼ºè¡Œç”¨SMJçš„æ—¶å€™ï¼Œæ’åºå°±æˆäº†â€œæˆ´æ–—ç¬ æ‰“é›¨ä¼â€ï¼Œå¤šæ­¤ä¸€ä¸¾ã€‚ï¼ˆå…¶å®æˆ‘ç‰¹åˆ«æƒ³è¯´ï¼Œè„±äº†è£¤å­æ”¾å±ï¼Œä¸è¿‡ä¸å¤ªæ–‡é›…ï¼Œå“ˆå“ˆï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620859221,"ip_address":"","comment_id":292417,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10210746970","product_id":100073401,"comment_content":"1. å¯ä»¥å¯¹ Sort Merge Join åšä¸€ä¸ªå˜ç§ï¼Œä¾‹å¦‚ä¸€ä¸ªè¡¨æ’åºï¼Œä¸€ä¸ªè¡¨ä¸æ’åºï¼Œä¸æ’åºçš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œæ’åºçš„è¡¨å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç­‰æ–¹å¼å¿«é€Ÿå®šä½é©±åŠ¨è¡¨çš„ Join Keyã€‚<br>2. ä¹Ÿå¯ä»¥å¼ºè¡Œå®ç°ï¼Œä½† Sort Merge Join æ–¹é¢çš„æ’åºå°±ä¼šå˜å¾—æ¯«æ— æ„ä¹‰ï¼ŒåŒæ—¶ Sort Merge Joinã€Hash Join çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¹¶æœªé™ä½ï¼Œåè€Œå¸¦æ¥äº†é¢å¤–çš„æ’åºå¼€é”€ä¸å†…å­˜å¼€é”€ã€‚","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519820,"discussion_content":"æ»¡åˆ†ğŸ’¯\n\nç¬¬ä¸€é¢˜ç­”å¾—å°¤å…¶å¥½ï¼Œè¿™é“é¢˜çš„åˆè¡·å°±æ˜¯é¼“åŠ±å¤§å®¶å‘æ•£æ€ç»´ï¼Œå¤§å¼€è„‘æ´ï¼Œå»æ€è€ƒæ›´å¤šçš„å®ç°æ–¹å¼~ ä½ è¯´çš„å®ç°æ–¹å¼ï¼Œæˆ‘è§‰å¾—è›®æœ‰æ„æ€ï¼Œç®—æ³•å¤æ‚åº¦ä»‹äºNLJå’ŒSMJä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯Oï¼ˆM*logNï¼‰ï¼Œå‰ç½®å¼€é”€æ˜¯ä¸€æ¬¡æ’åºï¼Œè¿™ç§å®ç°å…¶å®è¿˜æ˜¯èƒ½é€‚é…ä¸€äº›åœºæ™¯çš„~ 666~\n\nç¬¬äºŒé¢˜åˆ†æçš„å¾ˆåˆ°ä½ï¼Œå¼ºè¡Œç”¨SMJçš„æ—¶å€™ï¼Œæ’åºå°±æˆäº†â€œæˆ´æ–—ç¬ æ‰“é›¨ä¼â€ï¼Œå¤šæ­¤ä¸€ä¸¾ã€‚ï¼ˆå…¶å®æˆ‘ç‰¹åˆ«æƒ³è¯´ï¼Œè„±äº†è£¤å­æ”¾å±ï¼Œä¸è¿‡ä¸å¤ªæ–‡é›…ï¼Œå“ˆå“ˆï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620859221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292313,"user_name":"Bennan","can_delete":false,"product_type":"c1","uid":2427818,"ip_address":"","ucode":"8B6EE3DCBB1356","user_header":"https://static001.geekbang.org/account/avatar/00/25/0b/aa/09c1215f.jpg","comment_is_top":false,"comment_ctime":1620781491,"is_pvip":false,"replies":[{"id":"105900","content":"æ²¡é”™ï¼Œå¤§è¡¨Joinå¤§è¡¨æœ€ç¨³å®šçš„æ–¹å¼ï¼Œç¡®å®å°±æ˜¯Shuffle <br> Sort Merge Joinã€‚åŒæ—¶å¦‚æœMapé˜¶æ®µè®¡ç®—æŒ‰ç…§ï¼ˆpartitionIdï¼Œjoin keyï¼‰æ’å¥½åºçš„è¯ï¼Œåç»­Reduceé˜¶æ®µå¯ä»¥ç›´æ¥åšSMJçš„è®¡ç®—ï¼Œç›¸å½“äºå‰ç½®æ¡ä»¶å·²ç»æ»¡è¶³ã€‚<br><br>ç¬¬äºŒé¢˜è¯´çš„æ²¡é”™ï¼Œæ’åºã€æ„å»ºå“ˆå¸Œè¡¨æœ¬èº«æˆäº†å¼€é”€ã€å¤šæ­¤ä¸€ä¸¾~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620860620,"ip_address":"","comment_id":292313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5915748787","product_id":100073401,"comment_content":"1.ä¸¤å¼ äº‹å®è¡¨æœ€å¥½çš„ç­‰å€¼è¿æ¥æ–¹å¼å°±æ˜¯smjï¼Œå¯ä»¥è®©mapç«¯è¾“å‡ºçš„æ—¶å€™å…ˆè¿›è¡Œæ’åºï¼Œreduceæ‹‰å–æ•°æ®çš„æ—¶å€™å°±å¯ä»¥å¯¹ä¸¤ä¸ªè¡¨çš„å¤šä¸ªæ•°æ®æµè¿›è¡Œjoinæ“ä½œ<br>2å¯ä»¥å¼ºè¡Œä½¿ç”¨smjå’Œhjï¼Œä½†æ˜¯è¿™æ ·å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæœ€åjoinè¿˜æ˜¯m*nçš„å¤æ‚åº¦(å½“æ—¶å¦‚æœæ˜¯å¤§äºæˆ–è€…å°äºçš„è¿æ¥æ–¹å¼ï¼Œåœ¨è¿›è¡Œè¿æ¥çš„å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹)ï¼Œè€Œsmjä¼šå¸¦æ¥é¢å¤–çš„æ’åºå¼€é”€ï¼Œhjè¦æ±‚å†…å­˜èƒ½å¤Ÿæ”¾å¾—ä¸‹å¹¶ä¸”éœ€è¦æ„å»ºhashè¡¨","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519770,"discussion_content":"æ²¡é”™ï¼Œå¤§è¡¨Joinå¤§è¡¨æœ€ç¨³å®šçš„æ–¹å¼ï¼Œç¡®å®å°±æ˜¯Shuffle \n Sort Merge Joinã€‚åŒæ—¶å¦‚æœMapé˜¶æ®µè®¡ç®—æŒ‰ç…§ï¼ˆpartitionIdï¼Œjoin keyï¼‰æ’å¥½åºçš„è¯ï¼Œåç»­Reduceé˜¶æ®µå¯ä»¥ç›´æ¥åšSMJçš„è®¡ç®—ï¼Œç›¸å½“äºå‰ç½®æ¡ä»¶å·²ç»æ»¡è¶³ã€‚\n\nç¬¬äºŒé¢˜è¯´çš„æ²¡é”™ï¼Œæ’åºã€æ„å»ºå“ˆå¸Œè¡¨æœ¬èº«æˆäº†å¼€é”€ã€å¤šæ­¤ä¸€ä¸¾~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620860620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345309,"user_name":"C2H4","can_delete":false,"product_type":"c1","uid":2212841,"ip_address":"","ucode":"2F8B3F47208329","user_header":"https://static001.geekbang.org/account/avatar/00/21/c3/e9/8cb4e2e5.jpg","comment_is_top":false,"comment_ctime":1652186493,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652186493","product_id":100073401,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜,ä¸ºä»€ä¹ˆBHJçš„è¿æ¥ç±»å‹ä¸èƒ½æ˜¯å…¨è¿æ¥å‘¢","like_count":0},{"had_liked":false,"id":321034,"user_name":"ä¸ƒå¤ã€","can_delete":false,"product_type":"c1","uid":2839761,"ip_address":"","ucode":"58535A9EAAA97A","user_header":"https://static001.geekbang.org/account/avatar/00/2b/54/d1/d548f376.jpg","comment_is_top":false,"comment_ctime":1636626379,"is_pvip":false,"replies":[{"id":"116596","content":"åœ¨æ²¡æœ‰å¼€å¯AQEçš„æƒ…å†µä¸‹ï¼Œä½ è¯´çš„è¿™ç§æƒ…å†µï¼Œä¸ä¼šå¹¿æ’­ï¼Œå› ä¸º210Mçš„Aè¡¨ï¼Œè¶…è¿‡äº†å¹¿æ’­é˜ˆå€¼ã€‚<br><br>ä½†æ˜¯ï¼Œå¦‚æœå¼€å¯äº†AQEï¼Œè‡ªåŠ¨Joinç­–ç•¥è°ƒæ•´ï¼ŒAQEä¼šæŠŠåŸæœ¬çš„Shuffle Joinè½¬åŒ–ä¸ºBroadcast Joinï¼Œè¿™éƒ¨åˆ†ç»†èŠ‚ï¼Œå¯ä»¥çœ‹å‰é¢AQEçš„é‚£ä¸€è®²ï¼ˆ24è®²ï¼‰å“ˆ~<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1636646057,"ip_address":"","comment_id":321034,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636626379","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ‚¨ç­”æƒ‘ä¸‹ï¼š<br>å…³äºspark sql ä¸­çš„å¹¿æ’­æœºåˆ¶ï¼Œsparkæ˜¯ä¼šå°†æ»¡è¶³æ¡ä»¶çš„åŸè¡¨å¹¿æ’­è¿˜æ˜¯è¿‡æ»¤åçš„ç»“æœè¡¨å‘¢ï¼Ÿ <br>æ¯”å¦‚ å…³è” Aè¡¨ Açš„å¤§å°ä¸º210M ä½†æ˜¯å¹¿æ’­æœºåˆ¶æ˜¯ä»¥hdfs 200Må¤§å°ä¸ºé˜ˆå€¼çš„ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä¸ä¼šè¢«å¹¿æ’­çš„ï¼Œé‚£å¦‚æœæˆ‘åœ¨Aè¡¨åšäº† where æ¡ä»¶å è¿‡æ»¤åçš„Aè¡¨åªæœ‰120Mï¼Œè¿™ä¸ªæ—¶å€™ä¼šè¢«å¹¿æ’­ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530193,"discussion_content":"åœ¨æ²¡æœ‰å¼€å¯AQEçš„æƒ…å†µä¸‹ï¼Œä½ è¯´çš„è¿™ç§æƒ…å†µï¼Œä¸ä¼šå¹¿æ’­ï¼Œå› ä¸º210Mçš„Aè¡¨ï¼Œè¶…è¿‡äº†å¹¿æ’­é˜ˆå€¼ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœå¼€å¯äº†AQEï¼Œè‡ªåŠ¨Joinç­–ç•¥è°ƒæ•´ï¼ŒAQEä¼šæŠŠåŸæœ¬çš„Shuffle Joinè½¬åŒ–ä¸ºBroadcast Joinï¼Œè¿™éƒ¨åˆ†ç»†èŠ‚ï¼Œå¯ä»¥çœ‹å‰é¢AQEçš„é‚£ä¸€è®²ï¼ˆ24è®²ï¼‰å“ˆ~\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636646057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294253,"user_name":"å¤©ç¿¼","can_delete":false,"product_type":"c1","uid":2459638,"ip_address":"","ucode":"82153820B786E0","user_header":"https://static001.geekbang.org/account/avatar/00/25/87/f6/bc199560.jpg","comment_is_top":false,"comment_ctime":1621850896,"is_pvip":false,"replies":[{"id":"106772","content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è¡¨å¤§å°ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¤§å¤šæ•°æ•°æ®åº“å¼•æ“ï¼Œéƒ½ä¼šæŠŠå°ºå¯¸æ¯”è¾ƒå¤§çš„è¡¨ï¼Œå½“ä½œå¤–è¡¨ã€æˆ–è€…è¯´é©±åŠ¨è¡¨ï¼›è€Œå°ºå¯¸è¾ƒå°çš„è¡¨ï¼Œå½“ä½œå†…è¡¨ã€ä¹Ÿå«åŸºè¡¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621866762,"ip_address":"","comment_id":294253,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1621850896","product_id":100073401,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œä¸»åŠ¨æ‰«æçš„ä½œä¸ºå¤–è¡¨ï¼Œè¢«åŠ¨å‚ä¸æ‰«æçš„è¡¨å«åšå†…è¡¨ï¼Œä¸»åŠ¨ä¸è¢«åŠ¨æ˜¯æ€ä¹ˆåŒºåˆ†çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520573,"discussion_content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è¡¨å¤§å°ï¼Œé€šå¸¸æ¥è¯´ï¼Œå¤§å¤šæ•°æ•°æ®åº“å¼•æ“ï¼Œéƒ½ä¼šæŠŠå°ºå¯¸æ¯”è¾ƒå¤§çš„è¡¨ï¼Œå½“ä½œå¤–è¡¨ã€æˆ–è€…è¯´é©±åŠ¨è¡¨ï¼›è€Œå°ºå¯¸è¾ƒå°çš„è¡¨ï¼Œå½“ä½œå†…è¡¨ã€ä¹Ÿå«åŸºè¡¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621866762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2673906,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJG2MT85PrpeLzBcusbvaOgJtJFVXoibNBxNaGiaRczM6ZyHotpH588u4ORk2h6wia6PUUWic1euQfA1A/132","nickname":"å§šæ™“å","note":"","ucode":"E87112F64FABA8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":554072,"discussion_content":"è€å¸ˆï¼Œæ˜¯ä¸æ˜¯è¯´åäº†å‘¢ï¼Œå¤–è¡¨æ•°æ®é‡å°ï¼Œå¾ªç¯æ¬¡æ•°å°‘ä¸æ˜¯æ›´å¥½å—ï¼Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646205550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":520573,"ip_address":""},"score":554072,"extra":""}]}]},{"had_liked":false,"id":293396,"user_name":"è¾°","can_delete":false,"product_type":"c1","uid":2172635,"ip_address":"","ucode":"2E898EAC5AA141","user_header":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","comment_is_top":false,"comment_ctime":1621383101,"is_pvip":false,"replies":[{"id":"106331","content":"å¤§å°è¡¨æ”¾å“ªè¾¹å…¶å®æ²¡å…³ç³»çš„ï¼ŒSpark SQLåœ¨ä¼˜åŒ–é˜¶æ®µä¼šè‡ªè¡Œåˆ¤æ–­ã€‚å®é™…ä¸Šä¸¤å¼ è¡¨é‡è¦çš„æ˜¯â€œå¤§ã€å°â€ï¼Œè€Œä¸æ˜¯â€œå·¦ã€å³â€ï¼Œå¯¹äºSpark SQLä¼˜åŒ–å¼•æ“æ¥è¯´ï¼Œå¤§å°é‡è¦ï¼Œå·¦å³ä¸é‡è¦ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥åŒºåˆ†å·¦å³ï¼Œä¸»è¦æ˜¯ä¸ºäº†å™è¿°æ–¹ä¾¿è€Œå·²~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621434810,"ip_address":"","comment_id":293396,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1621383101","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ–¯ç›–ä¸¸åŒå­¦çš„å¤§è¡¨joinå°è¡¨ï¼Œåœ¨sparkä¸­ï¼Œå¤§è¡¨ä½œä¸ºé©±åŠ¨è¡¨æ”¾åœ¨å·¦è¾¹ï¼Œé‚£å’Œæ”¾åœ¨å³è¾¹æœ‰æ•ˆç‡å½±å“å—ï¼Ÿè¿˜æ˜¯ä¸æˆæ–‡çš„è§„èŒƒï¼Œç¬¬äºŒç‚¹ï¼Œåœ¨hiveä¸­ï¼Œå°è¡¨æ˜¯æ”¾åœ¨å·¦è¾¹çš„ï¼Œå¦‚æœè¶³å¤Ÿå°çš„è¯ï¼Œhiveä¼šè‡ªåŠ¨æŠŠå°è¡¨æ”¾è¿›å†…å­˜ä¸­ï¼Œç›¸å½“äºå¹¿æ’­å˜é‡äº†","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520194,"discussion_content":"å¤§å°è¡¨æ”¾å“ªè¾¹å…¶å®æ²¡å…³ç³»çš„ï¼ŒSpark SQLåœ¨ä¼˜åŒ–é˜¶æ®µä¼šè‡ªè¡Œåˆ¤æ–­ã€‚å®é™…ä¸Šä¸¤å¼ è¡¨é‡è¦çš„æ˜¯â€œå¤§ã€å°â€ï¼Œè€Œä¸æ˜¯â€œå·¦ã€å³â€ï¼Œå¯¹äºSpark SQLä¼˜åŒ–å¼•æ“æ¥è¯´ï¼Œå¤§å°é‡è¦ï¼Œå·¦å³ä¸é‡è¦ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥åŒºåˆ†å·¦å³ï¼Œä¸»è¦æ˜¯ä¸ºäº†å™è¿°æ–¹ä¾¿è€Œå·²~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621434810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293134,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1621237545,"is_pvip":false,"replies":[{"id":"106414","content":"è¿™ä¸ªå¬ä¸Šå»æœ‰ç‚¹è¹Šè··ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒmaxResultSize=5Gï¼ŒautoBroadcastThreshold=3Gï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å°è¯•åˆ›å»ºå¹¿æ’­å˜é‡çš„æ—¶å€™æŠ¥é”™ï¼Œå¯¹å§ï¼ŸæŠ¥çš„é”™è¯¯æ˜¯maxResultSizeè¶…å‡ºé˜ˆå€¼é™åˆ¶ï¼Ÿ<br><br>ç»“åˆç°è±¡çš„è¯ï¼Œæˆ‘è§‰å¾—æœ‰ä¸€ç§å¯èƒ½æ˜¯ï¼Œå¯¹äºæ•°æ®é›†å¤§å°ï¼ŒSparkåˆ¤æ–­å…¶å°äº3Gï¼Œä½†å®é™…ä¸Šå®ƒçš„å°ºå¯¸æ˜¯6Gï¼Œè¿™ä¸ªæ—¶å€™Sparkè¿˜æ˜¯ä¼šå°è¯•åˆ›å»ºå¹¿æ’­å˜é‡ï¼Œä½†æ˜¯å®é™…å¹¿æ’­å˜é‡å°ºå¯¸å¾ˆå¤§ï¼Œè¶…è¿‡äº†maxResultSizeï¼Œæ‰€ä»¥ä¼šæŠ¥ä½ è¯´çš„é”™è¯¯ã€‚<br><br>æ‰€ä»¥è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œä½ è¦å¹¿æ’­çš„æ•°æ®é›†ï¼Œå¤§å°ç©¶ç«Ÿæ˜¯å¤šå¤§ï¼Ÿè¿™ä¸ªå¯ä»¥ç”¨æˆ‘ä»¬ä¹‹å‰è¯´çš„æ–¹æ³•å»è®¡ç®—ã€éªŒè¯ä¸€ä¸‹ï¼Œç„¶åå†æ¥åˆ¤æ–­ï¼Œå’±ä»¬çš„çŒœæµ‹æ˜¯ä¸æ˜¯å¯¹çš„ã€‚å¯¹äºæ•°æ®é›†å°ºå¯¸çš„é¢„ä¼°ï¼ŒSparkç¡®å®æœ‰â€œçœ‹èµ°çœ¼â€çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½èƒ½åšåˆ°ååˆ†ç²¾ç¡®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621509226,"ip_address":"","comment_id":293134,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1621237545","product_id":100073401,"comment_content":"è€å¸ˆï¼Œé—®ä¸ªç”Ÿäº§ä¸Šçš„é—®é¢˜ï¼Œæˆ‘æŠŠautoBroadcastThresholdå€¼è°ƒåˆ°äº†3gï¼Œç„¶åå°±é‡åˆ°äº†spark.driver.maxResultSizeè¶…å‡ºæœ€å¤§å€¼çš„é”™è¯¯ã€‚è¯¥å€¼é»˜è®¤1gï¼Œæˆ‘è°ƒåˆ°äº†5gï¼Œå·²ç»å¤§äºautoBroadcastThresholdçš„3gäº†ï¼Œå¯ä¸ºä»€ä¹ˆè¿˜æŠ¥é”™ï¼Œè¯·é—®ç”Ÿäº§ä¸Šè¿™ä¸¤ä¸ªå‚æ•°çš„æœ€ä½³å®è·µè¯¥æ€ä¹ˆäº’ç›¸æŒ‡å®šå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520089,"discussion_content":"è¿™ä¸ªå¬ä¸Šå»æœ‰ç‚¹è¹Šè··ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒmaxResultSize=5Gï¼ŒautoBroadcastThreshold=3Gï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å°è¯•åˆ›å»ºå¹¿æ’­å˜é‡çš„æ—¶å€™æŠ¥é”™ï¼Œå¯¹å§ï¼ŸæŠ¥çš„é”™è¯¯æ˜¯maxResultSizeè¶…å‡ºé˜ˆå€¼é™åˆ¶ï¼Ÿ\n\nç»“åˆç°è±¡çš„è¯ï¼Œæˆ‘è§‰å¾—æœ‰ä¸€ç§å¯èƒ½æ˜¯ï¼Œå¯¹äºæ•°æ®é›†å¤§å°ï¼ŒSparkåˆ¤æ–­å…¶å°äº3Gï¼Œä½†å®é™…ä¸Šå®ƒçš„å°ºå¯¸æ˜¯6Gï¼Œè¿™ä¸ªæ—¶å€™Sparkè¿˜æ˜¯ä¼šå°è¯•åˆ›å»ºå¹¿æ’­å˜é‡ï¼Œä½†æ˜¯å®é™…å¹¿æ’­å˜é‡å°ºå¯¸å¾ˆå¤§ï¼Œè¶…è¿‡äº†maxResultSizeï¼Œæ‰€ä»¥ä¼šæŠ¥ä½ è¯´çš„é”™è¯¯ã€‚\n\næ‰€ä»¥è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œä½ è¦å¹¿æ’­çš„æ•°æ®é›†ï¼Œå¤§å°ç©¶ç«Ÿæ˜¯å¤šå¤§ï¼Ÿè¿™ä¸ªå¯ä»¥ç”¨æˆ‘ä»¬ä¹‹å‰è¯´çš„æ–¹æ³•å»è®¡ç®—ã€éªŒè¯ä¸€ä¸‹ï¼Œç„¶åå†æ¥åˆ¤æ–­ï¼Œå’±ä»¬çš„çŒœæµ‹æ˜¯ä¸æ˜¯å¯¹çš„ã€‚å¯¹äºæ•°æ®é›†å°ºå¯¸çš„é¢„ä¼°ï¼ŒSparkç¡®å®æœ‰â€œçœ‹èµ°çœ¼â€çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½èƒ½åšåˆ°ååˆ†ç²¾ç¡®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621509226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292986,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1621141806,"is_pvip":false,"replies":[{"id":"106276","content":"æˆ‘åŒæ„ä½ çš„è¯´æ³•ï¼Œå°±æ˜¯ä»ç»Ÿè®¡æ¦‚ç‡æ¥è¯´ï¼Œåœ¨æ‰«æçš„æ—¶å€™ä¼šæœ‰ä¸€å®šçš„æå‡ï¼Œä¸è¿‡SMJæœ‰ä¸ªå‰æå“¦ï¼Œé‚£å°±æ˜¯å‚ä¸Joinçš„ä¸¤è¡¨è¦æå‰æ’åºï¼Œè¿™ä¸ªå¼€é”€è¿˜æ˜¯è›®å¤§çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621411779,"ip_address":"","comment_id":292986,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1621141806","product_id":100073401,"comment_content":"ç¬¬äºŒé¢˜ï¼Œå¦‚æœä½¿ç”¨SMJå®ç°ä¸ç­‰å€¼Joinï¼Œæ¯”å¦‚åœ¨å¤§äºæˆ–å°äºçš„å…³è”æ¡ä»¶ä¸‹ï¼Œæ’åºè¿˜æ˜¯æœ‰äº›ç”¨å¤„çš„ï¼Œå› ä¸ºæ‹¿ä¸€ä¸ªè¡¨çš„Join keyå»å¦ä¸€ä¸ªè¡¨æ‰«æçš„æ—¶å€™ï¼Œéå†åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•æ—¶ï¼Œå°±å¯ä»¥ä¸ç”¨ç»§ç»­éå†äº†ã€‚ä½†æ˜¯å¦‚æœä¸æ’åºï¼Œæ¯æ¬¡éƒ½æ˜¯æ— è„‘å…¨éƒ¨éå†ï¼Œè™½ç„¶åœ¨è®¡ç®—æ—¶é—´å¤æ‚åº¦çš„æ—¶å€™å¯èƒ½è¿˜æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ï¼ŒæŒ‰æ¦‚ç‡æ¥è®²ï¼Œå¤šæ•°æ—¶å€™ï¼Œå®é™…çš„éå†è®°å½•æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿˜æ˜¯æœ‰æ€§èƒ½æå‡çš„ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520035,"discussion_content":"æˆ‘åŒæ„ä½ çš„è¯´æ³•ï¼Œå°±æ˜¯ä»ç»Ÿè®¡æ¦‚ç‡æ¥è¯´ï¼Œåœ¨æ‰«æçš„æ—¶å€™ä¼šæœ‰ä¸€å®šçš„æå‡ï¼Œä¸è¿‡SMJæœ‰ä¸ªå‰æå“¦ï¼Œé‚£å°±æ˜¯å‚ä¸Joinçš„ä¸¤è¡¨è¦æå‰æ’åºï¼Œè¿™ä¸ªå¼€é”€è¿˜æ˜¯è›®å¤§çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621411779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292443,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1620823181,"is_pvip":false,"replies":[{"id":"105898","content":"åˆ†æçš„å¾ˆåˆ°ä½~<br><br>1. Shuffle sort merge join åœ¨Shuffle Joinsé‡Œé¢ç¡®å®æ˜¯æœ€ç¨³å®šçš„å®ç°æ–¹å¼äº†ã€‚ä¸è¿‡å¯¹äºâ€œå¤§è¡¨Joinå¤§è¡¨â€æ¥è¯´ï¼Œå…¶å®å’±ä»¬è¿˜æ˜¯æœ‰ä¸€äº›ä¼˜åŒ–æ‰‹æ®µçš„ï¼Œè¿™å—å¯ä»¥å…³æ³¨ä¸‹28ã€29è®²å“ˆ~<br><br>2. æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆå›äº‹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620858709,"ip_address":"","comment_id":292443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620823181","product_id":100073401,"comment_content":"é—®é¢˜å›ç­”<br>1.ç­‰å€¼æ¡ä»¶æ—¶ï¼Œå†…å¤–è¡¨ä»»æ„å¤§å°éƒ½å¯ä»¥ç”¨SMJï¼Œåªä¸è¿‡å½“å†…è¡¨æ¯”è¾ƒå°æˆ–è€…å†…è¡¨å¹³å‡åˆ†ç‰‡å°äºé˜ˆå€¼æ—¶ï¼Œæœ‰æ€§èƒ½æ›´å¥½çš„BHJä¸SHJå¯ä»¥é€‰æ‹©ã€‚ç‰¹åˆ«æ˜¯å¤§è¡¨joinå¤§è¡¨æ—¶ï¼Œä¸æ»¡è¶³ä½¿ç”¨å…¶ä»–ä¸¤ä¸ªçš„æ¡ä»¶ï¼ŒSMJå°±æ˜¯æœ€ä¼˜è§£ã€‚<br><br>å¤§è¡¨joinå¤§è¡¨ï¼Œæˆ‘ç†è§£ç›®å‰æœ€å¥½çš„æ–¹å¼å°±æ˜¯Shuffle sort merge join<br><br>2.ä¸ç­‰å€¼æ¡ä»¶å¯ä»¥å¼ºè¡Œç”¨SMJï¼Œé‚£ä»–çš„æ—¶é—´å¤æ‚åº¦åˆå˜æˆäº†O(M*N)ï¼Œä¸¤è¡¨å‰æœŸæ’åºä¹Ÿæ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519832,"discussion_content":"åˆ†æçš„å¾ˆåˆ°ä½~\n\n1. Shuffle sort merge join åœ¨Shuffle Joinsé‡Œé¢ç¡®å®æ˜¯æœ€ç¨³å®šçš„å®ç°æ–¹å¼äº†ã€‚ä¸è¿‡å¯¹äºâ€œå¤§è¡¨Joinå¤§è¡¨â€æ¥è¯´ï¼Œå…¶å®å’±ä»¬è¿˜æ˜¯æœ‰ä¸€äº›ä¼˜åŒ–æ‰‹æ®µçš„ï¼Œè¿™å—å¯ä»¥å…³æ³¨ä¸‹28ã€29è®²å“ˆ~\n\n2. æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆå›äº‹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620858709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}