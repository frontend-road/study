{"id":154597,"title":"33 | è‡ªå·±åŠ¨æ‰‹å†™é«˜æ€§èƒ½HTTPæœåŠ¡å™¨ï¼ˆäºŒï¼‰ï¼šI/Oæ¨¡å‹å’Œå¤šçº¿ç¨‹æ¨¡å‹å®ç°","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬33è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å»¶ç»­ç¬¬32è®²çš„è¯é¢˜ï¼Œç»§ç»­è§£æé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹æ¡†æ¶çš„I/Oæ¨¡å‹å’Œå¤šçº¿ç¨‹æ¨¡å‹è®¾è®¡éƒ¨åˆ†ã€‚</p><h2>å¤šçº¿ç¨‹è®¾è®¡çš„å‡ ä¸ªè€ƒè™‘</h2><p>åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œmain reactorçº¿ç¨‹æ˜¯ä¸€ä¸ªacceptorçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸€æ—¦åˆ›å»ºï¼Œä¼šä»¥event_loopå½¢å¼é˜»å¡åœ¨event_dispatcherçš„dispatchæ–¹æ³•ä¸Šï¼Œå®é™…ä¸Šï¼Œå®ƒåœ¨ç­‰å¾…ç›‘å¬å¥—æ¥å­—ä¸Šçš„äº‹ä»¶å‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯å·²å®Œæˆçš„è¿æ¥ï¼Œä¸€æ—¦æœ‰è¿æ¥å®Œæˆï¼Œå°±ä¼šåˆ›å»ºå‡ºè¿æ¥å¯¹è±¡tcp_connectionï¼Œä»¥åŠchannelå¯¹è±¡ç­‰ã€‚</p><p>å½“ç”¨æˆ·æœŸæœ›ä½¿ç”¨å¤šä¸ªsub-reactorå­çº¿ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»ºå¤šä¸ªå­çº¿ç¨‹ï¼Œæ¯ä¸ªå­çº¿ç¨‹åœ¨åˆ›å»ºä¹‹åï¼ŒæŒ‰ç…§ä¸»çº¿ç¨‹æŒ‡å®šçš„å¯åŠ¨å‡½æ•°ç«‹å³è¿è¡Œï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–ã€‚éšä¹‹è€Œæ¥çš„é—®é¢˜æ˜¯ï¼Œ<strong>ä¸»çº¿ç¨‹å¦‚ä½•åˆ¤æ–­å­çº¿ç¨‹å·²ç»å®Œæˆåˆå§‹åŒ–å¹¶å¯åŠ¨ï¼Œç»§ç»­æ‰§è¡Œä¸‹å»å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªéœ€è¦è§£å†³çš„é‡ç‚¹é—®é¢˜ã€‚</strong></p><p>åœ¨è®¾ç½®äº†å¤šä¸ªçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å°†æ–°åˆ›å»ºçš„å·²è¿æ¥å¥—æ¥å­—å¯¹åº”çš„è¯»å†™äº‹ä»¶äº¤ç»™ä¸€ä¸ªsub-reactorçº¿ç¨‹å¤„ç†ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œä»thread_poolä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹ï¼Œ<strong>é€šçŸ¥è¿™ä¸ªçº¿ç¨‹æœ‰æ–°çš„äº‹ä»¶åŠ å…¥ã€‚è€Œè¿™ä¸ªçº¿ç¨‹å¾ˆå¯èƒ½æ˜¯å¤„äºäº‹ä»¶åˆ†å‘çš„é˜»å¡è°ƒç”¨ä¹‹ä¸­ï¼Œå¦‚ä½•åè°ƒä¸»çº¿ç¨‹æ•°æ®å†™å…¥ç»™å­çº¿ç¨‹ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªéœ€è¦è§£å†³çš„é‡ç‚¹é—®é¢˜ã€‚</strong></p><!-- [[[read_end]]] --><p>å­çº¿ç¨‹æ˜¯ä¸€ä¸ªevent_loopçº¿ç¨‹ï¼Œå®ƒé˜»å¡åœ¨dispatchä¸Šï¼Œä¸€æ—¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå®ƒå°±ä¼šæŸ¥æ‰¾channel_mapï¼Œæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°å¹¶æ‰§è¡Œå®ƒã€‚ä¹‹åå®ƒå°±ä¼šå¢åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹pendingäº‹ä»¶ï¼Œå†æ¬¡è¿›å…¥ä¸‹ä¸€è½®çš„dispatchã€‚</p><p>è¿™å¼ å›¾é˜è¿°äº†çº¿ç¨‹çš„è¿è¡Œå…³ç³»ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/55/14/55bb7ef8659395e39395b109dbd28f14.png?wh=1122*968\" alt=\"\"><br>\nä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘æŠŠå¯¹åº”çš„å‡½æ•°å®ç°åˆ—åœ¨äº†å¦å¤–ä¸€å¼ å›¾ä¸­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/da/ca/dac29d3a8fc4f26a09af9e18fc16b2ca.jpg?wh=3500*3002\" alt=\"\"></p><h2>ä¸»çº¿ç¨‹ç­‰å¾…å¤šä¸ªsub-reactorå­çº¿ç¨‹åˆå§‹åŒ–å®Œ</h2><p>ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è·å–å­çº¿ç¨‹å¯¹åº”æ•°æ®çš„åé¦ˆï¼Œè€Œå­çº¿ç¨‹åˆå§‹åŒ–ä¹Ÿæ˜¯å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹çš„é€šçŸ¥é—®é¢˜ã€‚é‡‡ç”¨çš„åšæ³•åœ¨<a href=\"https://time.geekbang.org/column/article/145464\">å‰é¢</a>è®²å¤šçº¿ç¨‹çš„æ—¶å€™ä¹Ÿæåˆ°è¿‡ï¼Œä½¿ç”¨mutexå’Œconditionä¸¤ä¸ªä¸»è¦æ­¦å™¨ã€‚</p><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯ä¸»çº¿ç¨‹å‘èµ·çš„å­çº¿ç¨‹åˆ›å»ºï¼Œè°ƒç”¨event_loop_thread_initå¯¹æ¯ä¸ªå­çº¿ç¨‹åˆå§‹åŒ–ï¼Œä¹‹åè°ƒç”¨event_loop_thread_startæ¥å¯åŠ¨å­çº¿ç¨‹ã€‚æ³¨æ„ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæŒ‡å®šçš„çº¿ç¨‹æ± å¤§å°ä¸º0ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œè¿™æ ·acceptorå’ŒI/Oäº‹ä»¶éƒ½ä¼šåœ¨åŒä¸€ä¸ªä¸»çº¿ç¨‹é‡Œå¤„ç†ï¼Œå°±é€€åŒ–ä¸ºå•reactoræ¨¡å¼ã€‚</p><pre><code>//ä¸€å®šæ˜¯main threadå‘èµ·\nvoid thread_pool_start(struct thread_pool *threadPool) {\n    assert(!threadPool-&gt;started);\n    assertInSameThread(threadPool-&gt;mainLoop);\n\n    threadPool-&gt;started = 1;\n    void *tmp;\n\n    if (threadPool-&gt;thread_number &lt;= 0) {\n        return;\n    }\n\n    threadPool-&gt;eventLoopThreads = malloc(threadPool-&gt;thread_number * sizeof(struct event_loop_thread));\n    for (int i = 0; i &lt; threadPool-&gt;thread_number; ++i) {\n        event_loop_thread_init(&amp;threadPool-&gt;eventLoopThreads[i], i);\n        event_loop_thread_start(&amp;threadPool-&gt;eventLoopThreads[i]);\n    }\n}\n</code></pre><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹event_loop_thread_startè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸€å®šæ˜¯ä¸»çº¿ç¨‹è¿è¡Œçš„ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†pthread_createåˆ›å»ºäº†å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¸€æ—¦åˆ›å»ºï¼Œç«‹å³æ‰§è¡Œevent_loop_thread_runï¼Œæˆ‘ä»¬ç¨åå°†çœ‹åˆ°ï¼Œevent_loop_thread_runè¿›è¡Œäº†å­çº¿ç¨‹çš„åˆå§‹åŒ–å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯ä½¿ç”¨äº†pthread_mutex_lockå’Œpthread_mutex_unlockè¿›è¡Œäº†åŠ é”å’Œè§£é”ï¼Œå¹¶ä½¿ç”¨äº†pthread_cond_waitæ¥å®ˆå€™eventLoopThreadä¸­çš„eventLoopçš„å˜é‡ã€‚</p><pre><code>//ç”±ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶ä¸”è®©å­çº¿ç¨‹å¼€å§‹è¿è¡Œevent_loop\nstruct event_loop *event_loop_thread_start(struct event_loop_thread *eventLoopThread) {\n    pthread_create(&amp;eventLoopThread-&gt;thread_tid, NULL, &amp;event_loop_thread_run, eventLoopThread);\n\n    assert(pthread_mutex_lock(&amp;eventLoopThread-&gt;mutex) == 0);\n\n    while (eventLoopThread-&gt;eventLoop == NULL) {\n        assert(pthread_cond_wait(&amp;eventLoopThread-&gt;cond, &amp;eventLoopThread-&gt;mutex) == 0);\n    }\n    assert(pthread_mutex_unlock(&amp;eventLoopThread-&gt;mutex) == 0);\n\n    yolanda_msgx(&quot;event loop thread started, %s&quot;, eventLoopThread-&gt;thread_name);\n    return eventLoopThread-&gt;eventLoop;\n}\n</code></pre><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿçœ‹ä¸€ä¸‹å­çº¿ç¨‹çš„ä»£ç ä½ å°±ä¼šå¤§è‡´æ˜ç™½ã€‚å­çº¿ç¨‹æ‰§è¡Œå‡½æ•°event_loop_thread_runä¸€ä¸Šæ¥ä¹Ÿæ˜¯è¿›è¡Œäº†åŠ é”ï¼Œä¹‹ååˆå§‹åŒ–event_loopå¯¹è±¡ï¼Œå½“åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè°ƒç”¨äº†pthread_cond_signalå‡½æ•°æ¥é€šçŸ¥æ­¤æ—¶é˜»å¡åœ¨pthread_cond_waitä¸Šçš„ä¸»çº¿ç¨‹ã€‚è¿™æ ·ï¼Œä¸»çº¿ç¨‹å°±ä¼šä»waitä¸­è‹é†’ï¼Œä»£ç å¾—ä»¥å¾€ä¸‹æ‰§è¡Œã€‚å­çº¿ç¨‹æœ¬èº«ä¹Ÿé€šè¿‡è°ƒç”¨event_loop_runè¿›å…¥äº†ä¸€ä¸ªæ— é™å¾ªç¯çš„äº‹ä»¶åˆ†å‘æ‰§è¡Œä½“ä¸­ï¼Œç­‰å¾…å­çº¿ç¨‹reatorä¸Šæ³¨å†Œè¿‡çš„äº‹ä»¶å‘ç”Ÿã€‚</p><pre><code>void *event_loop_thread_run(void *arg) {\n    struct event_loop_thread *eventLoopThread = (struct event_loop_thread *) arg;\n\n    pthread_mutex_lock(&amp;eventLoopThread-&gt;mutex);\n\n    // åˆå§‹åŒ–åŒ–event loopï¼Œä¹‹åé€šçŸ¥ä¸»çº¿ç¨‹\n    eventLoopThread-&gt;eventLoop = event_loop_init();\n    yolanda_msgx(&quot;event loop thread init and signal, %s&quot;, eventLoopThread-&gt;thread_name);\n    pthread_cond_signal(&amp;eventLoopThread-&gt;cond);\n\n    pthread_mutex_unlock(&amp;eventLoopThread-&gt;mutex);\n\n    //å­çº¿ç¨‹event loop run\n    eventLoopThread-&gt;eventLoop-&gt;thread_name = eventLoopThread-&gt;thread_name;\n    event_loop_run(eventLoopThread-&gt;eventLoop);\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å…±äº«çš„å˜é‡æ­£æ˜¯æ¯ä¸ªevent_loop_threadçš„eventLoopå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¸ºNULLï¼Œåªæœ‰å½“å­çº¿ç¨‹å®Œæˆäº†åˆå§‹åŒ–ï¼Œæ‰å˜æˆä¸€ä¸ªéNULLçš„å€¼ï¼Œè¿™ä¸ªå˜åŒ–æ˜¯å­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–çš„æ ‡å¿—ï¼Œä¹Ÿæ˜¯ä¿¡å·é‡å®ˆæŠ¤çš„å˜é‡ã€‚é€šè¿‡ä½¿ç”¨é”å’Œä¿¡å·é‡ï¼Œè§£å†³äº†ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚å½“å­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ä¹‹åï¼Œä¸»çº¿ç¨‹æ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><pre><code>struct event_loop_thread {\n    struct event_loop *eventLoop;\n    pthread_t thread_tid;        /* thread ID */\n    pthread_mutex_t mutex;\n    pthread_cond_t cond;\n    char * thread_name;\n    long thread_count;    /* # connections handled */\n};\n</code></pre><p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸»çº¿ç¨‹æ˜¯å¾ªç¯åœ¨ç­‰å¾…æ¯ä¸ªå­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œå¦‚æœè¿›å…¥ç¬¬äºŒä¸ªå¾ªç¯ï¼Œç­‰å¾…ç¬¬äºŒä¸ªå­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œè€Œæ­¤æ—¶ç¬¬äºŒä¸ªå­çº¿ç¨‹å·²ç»åˆå§‹åŒ–å®Œæˆäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æ³¨æ„æˆ‘ä»¬è¿™é‡Œä¸€ä¸Šæ¥æ˜¯åŠ é”çš„ï¼Œåªè¦å–å¾—äº†è¿™æŠŠé”ï¼ŒåŒæ—¶å‘ç°event_loop_threadçš„eventLoopå¯¹è±¡å·²ç»å˜æˆéNULLå€¼ï¼Œå¯ä»¥è‚¯å®šç¬¬äºŒä¸ªçº¿ç¨‹å·²ç»åˆå§‹åŒ–ï¼Œå°±ç›´æ¥é‡Šæ”¾é”å¾€ä¸‹æ‰§è¡Œäº†ã€‚</p><p>ä½ å¯èƒ½è¿˜ä¼šé—®ï¼Œåœ¨æ‰§è¡Œpthread_cond_waitçš„æ—¶å€™ï¼Œéœ€è¦æŒæœ‰é‚£æŠŠé”ä¹ˆï¼Ÿè¿™é‡Œï¼Œçˆ¶çº¿ç¨‹åœ¨è°ƒç”¨pthread_cond_waitå‡½æ•°ä¹‹åï¼Œä¼šç«‹å³è¿›å…¥ç¡çœ ï¼Œå¹¶é‡Šæ”¾æŒæœ‰çš„é‚£æŠŠäº’æ–¥é”ã€‚è€Œå½“çˆ¶çº¿ç¨‹å†ä»pthread_cond_waitè¿”å›æ—¶ï¼ˆè¿™æ˜¯å­çº¿ç¨‹é€šè¿‡pthread_cond_signalé€šçŸ¥è¾¾æˆçš„ï¼‰ï¼Œè¯¥çº¿ç¨‹å†æ¬¡æŒæœ‰é‚£æŠŠé”ã€‚</p><h2>å¢åŠ å·²è¿æ¥å¥—æ¥å­—äº‹ä»¶åˆ°sub-reactorçº¿ç¨‹ä¸­</h2><p>å‰é¢æåˆ°ï¼Œä¸»çº¿ç¨‹æ˜¯ä¸€ä¸ªmain reactorçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹è´Ÿè´£æ£€æµ‹ç›‘å¬å¥—æ¥å­—ä¸Šçš„äº‹ä»¶ï¼Œå½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿æ¥å·²å®Œæˆå»ºç«‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªsub-reactorå­çº¿ç¨‹ï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªå·²è¿æ¥å¥—æ¥å­—ç›¸å…³çš„I/Oäº‹ä»¶äº¤ç»™sub-reactorå­çº¿ç¨‹è´Ÿè´£æ£€æµ‹ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œmain reactoråªè´Ÿè´£è¿æ¥å¥—æ¥å­—çš„å»ºç«‹ï¼Œå¯ä»¥ä¸€ç›´ç»´æŒåœ¨ä¸€ä¸ªéå¸¸é«˜çš„å¤„ç†æ•ˆç‡ï¼Œåœ¨å¤šæ ¸çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªsub-reactorå¯ä»¥å¾ˆå¥½åœ°åˆ©ç”¨ä¸Šå¤šæ ¸å¤„ç†çš„ä¼˜åŠ¿ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä»¤äººè‹¦æ¼çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œsub-reactorçº¿ç¨‹æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„event loopæ‰§è¡Œä½“ï¼Œåœ¨æ²¡æœ‰å·²æ³¨å†Œäº‹ä»¶å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹é˜»å¡åœ¨event_dispatcherçš„dispatchä¸Šã€‚ä½ å¯ä»¥ç®€å•åœ°è®¤ä¸ºé˜»å¡åœ¨pollè°ƒç”¨æˆ–è€…epoll_waitä¸Šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å¦‚ä½•èƒ½æŠŠå·²è¿æ¥å¥—æ¥å­—äº¤ç»™sub-reactorå­çº¿ç¨‹å‘¢ï¼Ÿ</p><p>å½“ç„¶æœ‰åŠæ³•ã€‚</p><p>å¦‚æœæˆ‘ä»¬èƒ½è®©sub-reactorçº¿ç¨‹ä»event_dispatcherçš„dispatchä¸Šè¿”å›ï¼Œå†è®©sub-reactorçº¿ç¨‹è¿”å›ä¹‹åèƒ½å¤ŸæŠŠæ–°çš„å·²è¿æ¥å¥—æ¥å­—äº‹ä»¶æ³¨å†Œä¸Šï¼Œè¿™ä»¶äº‹æƒ…å°±ç®—å®Œæˆäº†ã€‚</p><p>é‚£å¦‚ä½•è®©sub-reactorçº¿ç¨‹ä»event_dispatcherçš„dispatchä¸Šè¿”å›å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ„å»ºä¸€ä¸ªç±»ä¼¼ç®¡é“ä¸€æ ·çš„æè¿°å­—ï¼Œè®©event_dispatcheræ³¨å†Œè¯¥ç®¡é“æè¿°å­—ï¼Œå½“æˆ‘ä»¬æƒ³è®©sub-reactorçº¿ç¨‹è‹é†’æ—¶ï¼Œå¾€ç®¡é“ä¸Šå‘é€ä¸€ä¸ªå­—ç¬¦å°±å¯ä»¥äº†ã€‚</p><p>åœ¨event_loop_initå‡½æ•°é‡Œï¼Œè°ƒç”¨äº†socketpairå‡½æ•°åˆ›å»ºäº†å¥—æ¥å­—å¯¹ï¼Œè¿™ä¸ªå¥—æ¥å­—å¯¹çš„ä½œç”¨å°±æ˜¯æˆ‘åˆšåˆšè¯´è¿‡çš„ï¼Œå¾€è¿™ä¸ªå¥—æ¥å­—çš„ä¸€ç«¯å†™æ—¶ï¼Œå¦å¤–ä¸€ç«¯å°±å¯ä»¥æ„ŸçŸ¥åˆ°è¯»çš„äº‹ä»¶ã€‚å…¶å®ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨UNIXä¸Šçš„pipeç®¡é“ï¼Œä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</p><pre><code>struct event_loop *event_loop_init() {\n    ...\n    //add the socketfd to event è¿™é‡Œåˆ›å»ºçš„æ˜¯å¥—æ¥å­—å¯¹ï¼Œç›®çš„æ˜¯ä¸ºäº†å”¤é†’å­çº¿ç¨‹\n    eventLoop-&gt;owner_thread_id = pthread_self();\n    if (socketpair(AF_UNIX, SOCK_STREAM, 0, eventLoop-&gt;socketPair) &lt; 0) {\n        LOG_ERR(&quot;socketpair set fialed&quot;);\n    }\n    eventLoop-&gt;is_handle_pending = 0;\n    eventLoop-&gt;pending_head = NULL;\n    eventLoop-&gt;pending_tail = NULL;\n    eventLoop-&gt;thread_name = &quot;main thread&quot;;\n\n    struct channel *channel = channel_new(eventLoop-&gt;socketPair[1], EVENT_READ, handleWakeup, NULL, eventLoop);\n    event_loop_add_channel_event(eventLoop, eventLoop-&gt;socketPair[1], channel);\n\n    return eventLoop;\n}\n</code></pre><p>è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è¿™å¥ä»£ç ï¼Œè¿™å‘Šè¯‰event_loopçš„ï¼Œæ˜¯æ³¨å†Œäº†socketPair[1]æè¿°å­—ä¸Šçš„READäº‹ä»¶ï¼Œå¦‚æœæœ‰READäº‹ä»¶å‘ç”Ÿï¼Œå°±è°ƒç”¨handleWakeupå‡½æ•°æ¥å®Œæˆäº‹ä»¶å¤„ç†ã€‚</p><pre><code>struct channel *channel = channel_new(eventLoop-&gt;socketPair[1], EVENT_READ, handleWakeup, NULL, eventLoop);\n</code></pre><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªhandleWakeupå‡½æ•°ï¼š</p><p>äº‹å®ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç®€å•çš„ä»socketPair[1]æè¿°å­—ä¸Šè¯»å–äº†ä¸€ä¸ªå­—ç¬¦è€Œå·²ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»€ä¹ˆä¹Ÿæ²¡å¹²ã€‚å®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯è®©å­çº¿ç¨‹ä»dispatchçš„é˜»å¡ä¸­è‹é†’ã€‚</p><pre><code>int handleWakeup(void * data) {\n    struct event_loop *eventLoop = (struct event_loop *) data;\n    char one;\n    ssize_t n = read(eventLoop-&gt;socketPair[1], &amp;one, sizeof one);\n    if (n != sizeof one) {\n        LOG_ERR(&quot;handleWakeup  failed&quot;);\n    }\n    yolanda_msgx(&quot;wakeup, %s&quot;, eventLoop-&gt;thread_name);\n}\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´çœ‹çœ‹ï¼Œå¦‚æœæœ‰æ–°çš„è¿æ¥äº§ç”Ÿï¼Œä¸»çº¿ç¨‹æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Ÿåœ¨handle_connection_establishedä¸­ï¼Œé€šè¿‡acceptè°ƒç”¨è·å–äº†å·²è¿æ¥å¥—æ¥å­—ï¼Œå°†å…¶è®¾ç½®ä¸ºéé˜»å¡å¥—æ¥å­—ï¼ˆåˆ‡è®°ï¼‰ï¼Œæ¥ä¸‹æ¥è°ƒç”¨thread_pool_get_loopè·å–ä¸€ä¸ªevent_loopã€‚thread_pool_get_loopçš„é€»è¾‘éå¸¸ç®€å•ï¼Œä»thread_poolçº¿ç¨‹æ± ä¸­æŒ‰ç…§é¡ºåºæŒ‘é€‰å‡ºä¸€ä¸ªçº¿ç¨‹æ¥æœåŠ¡ã€‚æ¥ä¸‹æ¥æ˜¯åˆ›å»ºäº†tcp_connectionå¯¹è±¡ã€‚</p><pre><code>//å¤„ç†è¿æ¥å·²å»ºç«‹çš„å›è°ƒå‡½æ•°\nint handle_connection_established(void *data) {\n    struct TCPserver *tcpServer = (struct TCPserver *) data;\n    struct acceptor *acceptor = tcpServer-&gt;acceptor;\n    int listenfd = acceptor-&gt;listen_fd;\n\n    struct sockaddr_in client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    //è·å–è¿™ä¸ªå·²å»ºç«‹çš„å¥—é›†å­—ï¼Œè®¾ç½®ä¸ºéé˜»å¡å¥—é›†å­—\n    int connected_fd = accept(listenfd, (struct sockaddr *) &amp;client_addr, &amp;client_len);\n    make_nonblocking(connected_fd);\n\n    yolanda_msgx(&quot;new connection established, socket == %d&quot;, connected_fd);\n\n    //ä»çº¿ç¨‹æ± é‡Œé€‰æ‹©ä¸€ä¸ªeventloopæ¥æœåŠ¡è¿™ä¸ªæ–°çš„è¿æ¥å¥—æ¥å­—\n    struct event_loop *eventLoop = thread_pool_get_loop(tcpServer-&gt;threadPool);\n\n    // ä¸ºè¿™ä¸ªæ–°å»ºç«‹å¥—æ¥å­—åˆ›å»ºä¸€ä¸ªtcp_connectionå¯¹è±¡ï¼Œå¹¶æŠŠåº”ç”¨ç¨‹åºçš„callbackå‡½æ•°è®¾ç½®ç»™è¿™ä¸ªtcp_connectionå¯¹è±¡\n    struct tcp_connection *tcpConnection = tcp_connection_new(connected_fd, eventLoop,tcpServer-&gt;connectionCompletedCallBack,tcpServer-&gt;connectionClosedCallBack,tcpServer-&gt;messageCallBack,tcpServer-&gt;writeCompletedCallBack);\n    //callbackå†…éƒ¨ä½¿ç”¨\n    if (tcpServer-&gt;data != NULL) {\n        tcpConnection-&gt;data = tcpServer-&gt;data;\n    }\n    return 0;\n}\n</code></pre><p>åœ¨è°ƒç”¨tcp_connection_newåˆ›å»ºtcp_connectionå¯¹è±¡çš„ä»£ç é‡Œï¼Œå¯ä»¥çœ‹åˆ°å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªchannelå¯¹è±¡ï¼Œå¹¶æ³¨å†Œäº†READäº‹ä»¶ï¼Œä¹‹åè°ƒç”¨event_loop_add_channel_eventæ–¹æ³•å¾€å­çº¿ç¨‹ä¸­å¢åŠ channelå¯¹è±¡ã€‚</p><pre><code>tcp_connection_new(int connected_fd, struct event_loop *eventLoop,\n                   connection_completed_call_back connectionCompletedCallBack,\n                   connection_closed_call_back connectionClosedCallBack,\n                   message_call_back messageCallBack, write_completed_call_back writeCompletedCallBack) {\n    ...\n    //ä¸ºæ–°çš„è¿æ¥å¯¹è±¡åˆ›å»ºå¯è¯»äº‹ä»¶\n    struct channel *channel1 = channel_new(connected_fd, EVENT_READ, handle_read, handle_write, tcpConnection);\n    tcpConnection-&gt;channel = channel1;\n\n    //å®Œæˆå¯¹connectionCompletedçš„å‡½æ•°å›è°ƒ\n    if (tcpConnection-&gt;connectionCompletedCallBack != NULL) {\n        tcpConnection-&gt;connectionCompletedCallBack(tcpConnection);\n    }\n  \n    //æŠŠè¯¥å¥—é›†å­—å¯¹åº”çš„channelå¯¹è±¡æ³¨å†Œåˆ°event_loopäº‹ä»¶åˆ†å‘å™¨ä¸Š\n    event_loop_add_channel_event(tcpConnection-&gt;eventLoop, connected_fd, tcpConnection-&gt;channel);\n    return tcpConnection;\n}\n</code></pre><p>è¯·æ³¨æ„ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢çš„æ“ä½œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œæ‰§è¡Œçš„ã€‚ä¸‹é¢çš„event_loop_do_channel_eventä¹Ÿä¸ä¾‹å¤–ï¼Œæ¥ä¸‹æ¥çš„è¡Œä¸ºæˆ‘æœŸæœ›ä½ æ˜¯ç†Ÿæ‚‰çš„ï¼Œé‚£å°±æ˜¯åŠ è§£é”ã€‚</p><p>å¦‚æœèƒ½å¤Ÿè·å–é”ï¼Œä¸»çº¿ç¨‹å°±ä¼šè°ƒç”¨event_loop_channel_buffer_nolockå¾€å­çº¿ç¨‹çš„æ•°æ®ä¸­å¢åŠ éœ€è¦å¤„ç†çš„channel eventå¯¹è±¡ã€‚æ‰€æœ‰å¢åŠ çš„channelå¯¹è±¡ä»¥åˆ—è¡¨çš„å½¢å¼ç»´æŠ¤åœ¨å­çº¿ç¨‹çš„æ•°æ®ç»“æ„ä¸­ã€‚</p><p>æ¥ä¸‹æ¥çš„éƒ¨åˆ†æ˜¯é‡ç‚¹ï¼Œå¦‚æœå½“å‰å¢åŠ channel eventçš„ä¸æ˜¯å½“å‰event loopçº¿ç¨‹è‡ªå·±ï¼Œå°±ä¼šè°ƒç”¨event_loop_wakeupå‡½æ•°æŠŠevent_loopå­çº¿ç¨‹å”¤é†’ã€‚å”¤é†’çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å¾€åˆšåˆšçš„socketPair[0]ä¸Šå†™ä¸€ä¸ªå­—èŠ‚ï¼Œåˆ«å¿˜äº†ï¼Œevent_loopå·²ç»æ³¨å†Œäº†socketPair[1]çš„å¯è¯»äº‹ä»¶ã€‚å¦‚æœå½“å‰å¢åŠ channel eventçš„æ˜¯å½“å‰event loopçº¿ç¨‹è‡ªå·±ï¼Œåˆ™ç›´æ¥è°ƒç”¨event_loop_handle_pending_channelå¤„ç†æ–°å¢åŠ çš„channel eventäº‹ä»¶åˆ—è¡¨ã€‚</p><pre><code>int event_loop_do_channel_event(struct event_loop *eventLoop, int fd, struct channel *channel1, int type) {\n    //get the lock\n    pthread_mutex_lock(&amp;eventLoop-&gt;mutex);\n    assert(eventLoop-&gt;is_handle_pending == 0);\n    //å¾€è¯¥çº¿ç¨‹çš„channelåˆ—è¡¨é‡Œå¢åŠ æ–°çš„channel\n    event_loop_channel_buffer_nolock(eventLoop, fd, channel1, type);\n    //release the lock\n    pthread_mutex_unlock(&amp;eventLoop-&gt;mutex);\n    //å¦‚æœæ˜¯ä¸»çº¿ç¨‹å‘èµ·æ“ä½œï¼Œåˆ™è°ƒç”¨event_loop_wakeupå”¤é†’å­çº¿ç¨‹\n    if (!isInSameThread(eventLoop)) {\n        event_loop_wakeup(eventLoop);\n    } else {\n        //å¦‚æœæ˜¯å­çº¿ç¨‹è‡ªå·±ï¼Œåˆ™ç›´æ¥å¯ä»¥æ“ä½œ\n        event_loop_handle_pending_channel(eventLoop);\n    }\n\n    return 0;\n}\n</code></pre><p>å¦‚æœæ˜¯event_loopè¢«å”¤é†’ä¹‹åï¼Œæ¥ä¸‹æ¥ä¹Ÿä¼šæ‰§è¡Œevent_loop_handle_pending_channelå‡½æ•°ã€‚ä½ å¯ä»¥çœ‹åˆ°åœ¨å¾ªç¯ä½“å†…ä»dispatché€€å‡ºä¹‹åï¼Œä¹Ÿè°ƒç”¨äº†event_loop_handle_pending_channelå‡½æ•°ã€‚</p><pre><code>int event_loop_run(struct event_loop *eventLoop) {\n    assert(eventLoop != NULL);\n\n    struct event_dispatcher *dispatcher = eventLoop-&gt;eventDispatcher;\n\n    if (eventLoop-&gt;owner_thread_id != pthread_self()) {\n        exit(1);\n    }\n\n    yolanda_msgx(&quot;event loop run, %s&quot;, eventLoop-&gt;thread_name);\n    struct timeval timeval;\n    timeval.tv_sec = 1;\n\n    while (!eventLoop-&gt;quit) {\n        //block here to wait I/O event, and get active channels\n        dispatcher-&gt;dispatch(eventLoop, &amp;timeval);\n\n        //è¿™é‡Œå¤„ç†pending channelï¼Œå¦‚æœæ˜¯å­çº¿ç¨‹è¢«å”¤é†’ï¼Œè¿™ä¸ªéƒ¨åˆ†ä¹Ÿä¼šç«‹å³æ‰§è¡Œåˆ°\n        event_loop_handle_pending_channel(eventLoop);\n    }\n\n    yolanda_msgx(&quot;event loop end, %s&quot;, eventLoop-&gt;thread_name);\n    return 0;\n}\n</code></pre><p>event_loop_handle_pending_channelå‡½æ•°çš„ä½œç”¨æ˜¯éå†å½“å‰event loopé‡Œpendingçš„channel eventåˆ—è¡¨ï¼Œå°†å®ƒä»¬å’Œevent_dispatcherå…³è”èµ·æ¥ï¼Œä»è€Œä¿®æ”¹æ„Ÿå…´è¶£çš„äº‹ä»¶é›†åˆã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼Œå› ä¸ºevent loopçº¿ç¨‹å¾—åˆ°æ´»åŠ¨äº‹ä»¶ä¹‹åï¼Œä¼šå›è°ƒäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¿™æ ·åƒonMessageç­‰åº”ç”¨ç¨‹åºä»£ç ä¹Ÿä¼šåœ¨event loopçº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æœè¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘è¿‡äºå¤æ‚ï¼Œå°±ä¼šå¯¼è‡´event_loop_handle_pending_channelæ‰§è¡Œçš„æ—¶é—´ååï¼Œä»è€Œå½±å“I/Oçš„æ£€æµ‹ã€‚æ‰€ä»¥ï¼Œå°†I/Oçº¿ç¨‹å’Œä¸šåŠ¡é€»è¾‘çº¿ç¨‹éš”ç¦»ï¼Œè®©I/Oçº¿ç¨‹åªè´Ÿè´£å¤„ç†I/Oäº¤äº’ï¼Œè®©ä¸šåŠ¡çº¿ç¨‹å¤„ç†ä¸šåŠ¡ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšæ³•ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»¬é‡ç‚¹è®²è§£äº†æ¡†æ¶ä¸­æ¶‰åŠå¤šçº¿ç¨‹çš„ä¸¤ä¸ªé‡è¦é—®é¢˜ï¼Œç¬¬ä¸€æ˜¯ä¸»çº¿ç¨‹å¦‚ä½•ç­‰å¾…å¤šä¸ªå­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œç¬¬äºŒæ˜¯å¦‚ä½•é€šçŸ¥å¤„äºäº‹ä»¶åˆ†å‘ä¸­çš„å­çº¿ç¨‹æœ‰æ–°çš„äº‹ä»¶åŠ å…¥ã€åˆ é™¤ã€ä¿®æ”¹ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜é€šè¿‡ä½¿ç”¨é”å’Œä¿¡å·é‡åŠ ä»¥è§£å†³ï¼›ç¬¬äºŒä¸ªé—®é¢˜é€šè¿‡ä½¿ç”¨socketpairï¼Œå¹¶å°†sockerpairä½œä¸ºchannelæ³¨å†Œåˆ°event loopä¸­æ¥è§£å†³ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç»™ä½ å¸ƒç½®ä¸¤é“æ€è€ƒé¢˜ï¼š</p><p>ç¬¬ä¸€é“ï¼Œ ä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œè®©sub-reactoré»˜è®¤çš„çº¿ç¨‹ä¸ªæ•°ä¸ºcpu*2ã€‚</p><p>ç¬¬äºŒé“ï¼Œå½“å‰é€‰æ‹©çº¿ç¨‹çš„ç®—æ³•æ˜¯round-robinçš„ç®—æ³•ï¼Œä½ è§‰å¾—æœ‰æ²¡æœ‰æ”¹è¿›çš„ç©ºé—´ï¼Ÿå¦‚æœæ”¹è¿›çš„è¯ï¼Œä½ å¯èƒ½ä¼šæ€ä¹ˆåšï¼Ÿ</p><p>æ¬¢è¿åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµè¿›æ­¥ä¸€ä¸‹ã€‚</p>","neighbors":{"left":{"article_title":"32 | è‡ªå·±åŠ¨æ‰‹å†™é«˜æ€§èƒ½HTTPæœåŠ¡å™¨ï¼ˆä¸€ï¼‰ï¼šè®¾è®¡å’Œæ€è·¯","id":152668},"right":{"article_title":"34 | è‡ªå·±åŠ¨æ‰‹å†™é«˜æ€§èƒ½HTTPæœåŠ¡å™¨ï¼ˆä¸‰ï¼‰ï¼šTCPå­—èŠ‚æµå¤„ç†å’ŒHTTPåè®®å®ç°","id":155273}},"comments":[{"had_liked":false,"id":161008,"user_name":"é…¸è‘¡è„","can_delete":false,"product_type":"c1","uid":1154146,"ip_address":"","ucode":"9D059C4FB327C0","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","comment_is_top":false,"comment_ctime":1576077473,"is_pvip":false,"replies":[{"id":"63934","content":"æˆ‘ä»¬è¿˜æ˜¯ç”¨acceptorçº¿ç¨‹å’ŒI&#47;Oçº¿ç¨‹è¿™æ ·æ¥åŒºåˆ†æ¯”è¾ƒå¥½ã€‚<br><br>acceptorçº¿ç¨‹åœ¨å‘ç°æœ‰è¿æ¥åˆ°è¾¾åï¼Œé€šè¿‡è°ƒç”¨event_loop_channel_buffer_nolockå‡½æ•°ï¼Œå¾€I&#47;Oçº¿ç¨‹çš„eventLoopé‡Œé¢å¢åŠ äº†æ–°çš„å¥—æ¥å­—ï¼Œä¹Ÿå°±æ˜¯ä½ è¯´çš„æ³¨å†Œé“¾è¡¨ã€‚<br><br>è¿™é‡Œçš„å…³é”®æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„eventLoopï¼Œacceptoræœ‰è‡ªå·±çš„eventLoopï¼ŒI&#47;Oçº¿ç¨‹æœ‰è‡ªå·±çš„eventLoopã€‚æ²¡æœ‰ä¸»å­çº¿ç¨‹å…±äº«eventLoopï¼Œä¸€ä¸ªeventLoopå°±å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1577605460,"ip_address":"","comment_id":161008,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23050913953","product_id":100032701,"comment_content":"è€å¸ˆ,ä½ å¥½,æœ‰ä¸ªåœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½,<br>ä¸ºä»€ä¹ˆevent_loop_channel_buffer_nolock(eventLoop, fd, channel1, type);æ˜¯å¾€å­çº¿ç¨‹çš„æ•°æ®ä¸­å¢åŠ éœ€è¦å¤„ç†çš„ channel event å¯¹è±¡å‘¢?<br><br>void event_loop_channel_buffer_nolock(struct event_loop *eventLoop, int fd, struct channel *channel1, int type) {<br>    &#47;&#47;add channel into the pending list<br>    struct channel_element *channelElement = malloc(sizeof(struct channel_element));<br>    channelElement-&gt;channel = channel1;<br>    channelElement-&gt;type = type;&#47;&#47;1 add  (1: add  2: delete)<br>    channelElement-&gt;next = NULL;<br>    &#47;&#47;ç¬¬ä¸€ä¸ªå…ƒç´   channel_elementæ˜¯channelçš„é“¾è¡¨ï¼Œ<br>    &#47;&#47; eventLoop pending_headå’Œpending_tailç»´æŠ¤çš„æ˜¯channelElementçš„é“¾è¡¨<br>    &#47;&#47;è¿™æ ·çš„è¯æœ€ç»ˆè¿˜æ˜¯event_loopåŒ…å«äº†channel(event_loop-&gt;channelElement-&gt;channel)<br>    if (eventLoop-&gt;pending_head == NULL) {<br>        eventLoop-&gt;pending_head = eventLoop-&gt;pending_tail = channelElement;<br>    } else {<br>        eventLoop-&gt;pending_tail-&gt;next = channelElement;<br>        eventLoop-&gt;pending_tail = channelElement;<br>    }<br>}<br><br><br>void *event_loop_thread_run(void *arg) {<br>    struct event_loop_thread *eventLoopThread = (struct event_loop_thread *) arg;<br><br>    pthread_mutex_lock(&amp;eventLoopThread-&gt;mutex);<br><br>    &#47;&#47; åˆå§‹åŒ–åŒ–event loopï¼Œä¹‹åé€šçŸ¥ä¸»çº¿ç¨‹<br>    eventLoopThread-&gt;eventLoop = event_loop_init_with_name(eventLoopThread-&gt;thread_name);<br>    yolanda_msgx(&quot;event loop thread init and signal, %s&quot;, eventLoopThread-&gt;thread_name);<br>    pthread_cond_signal(&amp;eventLoopThread-&gt;cond);<br><br>    pthread_mutex_unlock(&amp;eventLoopThread-&gt;mutex);<br><br>    &#47;&#47;å­çº¿ç¨‹event loop run<br>    event_loop_run(eventLoopThread-&gt;eventLoop);<br>}<br>struct event_loop_thread {<br>    struct event_loop *eventLoop;&#47;&#47;ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å…±äº«<br>    pthread_t thread_tid;        &#47;* thread ID *&#47;<br>    pthread_mutex_t mutex;<br>    pthread_cond_t cond;<br>    char * thread_name;<br>    long thread_count;    &#47;* # connections handled *&#47;<br>};<br><br><br>event_loop_channel_buffer_nolockè¿™ä¸ªå‡½æ•°ä¸­æ˜¯å¾€eventLoopçš„é“¾è¡¨ä¸­æ³¨å†Œäº‹ä»¶,å¯æ˜¯è¿™é‡Œçš„eventLoopæ˜¯å’Œå­çº¿ç¨‹å¤„ç†å‡½æ•°<br>event_loop_thread_runä¸­eventLoopThread-&gt;eventLoopä¸æ˜¯ä¸€ä¸ªeventLoopå•Š,è¿™ä¸ªeventLoopThread-&gt;eventLoopä¸æ‰æ˜¯ä¸»å­çº¿ç¨‹å…±äº«çš„å—?","like_count":5,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477567,"discussion_content":"æˆ‘ä»¬è¿˜æ˜¯ç”¨acceptorçº¿ç¨‹å’ŒI/Oçº¿ç¨‹è¿™æ ·æ¥åŒºåˆ†æ¯”è¾ƒå¥½ã€‚\n\nacceptorçº¿ç¨‹åœ¨å‘ç°æœ‰è¿æ¥åˆ°è¾¾åï¼Œé€šè¿‡è°ƒç”¨event_loop_channel_buffer_nolockå‡½æ•°ï¼Œå¾€I/Oçº¿ç¨‹çš„eventLoopé‡Œé¢å¢åŠ äº†æ–°çš„å¥—æ¥å­—ï¼Œä¹Ÿå°±æ˜¯ä½ è¯´çš„æ³¨å†Œé“¾è¡¨ã€‚\n\nè¿™é‡Œçš„å…³é”®æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„eventLoopï¼Œacceptoræœ‰è‡ªå·±çš„eventLoopï¼ŒI/Oçº¿ç¨‹æœ‰è‡ªå·±çš„eventLoopã€‚æ²¡æœ‰ä¸»å­çº¿ç¨‹å…±äº«eventLoopï¼Œä¸€ä¸ªeventLoopå°±å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577605460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267321,"user_name":"YUAN","can_delete":false,"product_type":"c1","uid":2153838,"ip_address":"","ucode":"98EF68EEE21893","user_header":"https://static001.geekbang.org/account/avatar/00/20/dd/6e/8f6f79d2.jpg","comment_is_top":false,"comment_ctime":1607679633,"is_pvip":false,"replies":[{"id":"98874","content":"é‚£ä¸»çº¿ç¨‹å¹²å•¥å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1610285922,"ip_address":"","comment_id":267321,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18787548817","product_id":100032701,"comment_content":"ä¸ºä»€ä¹ˆä¸ç›´æ¥è®©å­çº¿ç¨‹è‡ªå·±è°ƒç”¨acceptè€Œè¦ä¸»çº¿ç¨‹è°ƒç”¨å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511595,"discussion_content":"é‚£ä¸»çº¿ç¨‹å¹²å•¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610285922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249996,"user_name":"æ—¶é—´","can_delete":false,"product_type":"c1","uid":1822792,"ip_address":"","ucode":"61007748189A5C","user_header":"https://static001.geekbang.org/account/avatar/00/1b/d0/48/0a865673.jpg","comment_is_top":false,"comment_ctime":1600876159,"is_pvip":false,"replies":[{"id":"92052","content":"å¥½é—®é¢˜ã€‚<br><br>çº¿ç¨‹ä¸æ˜¯æ¯æ—¶æ¯åˆ»éƒ½è¦å¹²æ´»çš„ï¼Œå°±å¥½æ¯”ä¸€ä¸ªæµæ°´çº¿å·¥äººï¼Œåªæœ‰è½®åˆ°ä»–çš„æ—¶å€™ï¼Œä»–æ‰éœ€è¦å‡ºåŠ›å¹²æ´»ã€‚å¦‚æœè¿™å››ä¸ªè¿æ¥éƒ½åœ¨å¹²æ´»ï¼Œé‚£ç¬¬äº”ä¸ªåªå¥½ç­‰ä»»æ„ä¸€ä¸ªçº¿ç¨‹ç©ºé—²å‡ºæ¥ã€‚<br><br>æ‰€æœ‰çš„äº‹æƒ…ï¼Œç§˜è¯€éƒ½åœ¨äº&quot;åˆ†æ—¶å¤ç”¨&quot;ï¼Œæ¯”å¦‚ä½ çš„cpuï¼Œä¹Ÿå°±4ä¸ªcoreï¼Œä¸ºå•¥åŒæ—¶å¯ä»¥æ‰“æ¸¸æˆï¼Œå†™æ–‡ç¨¿ï¼Œçœ‹ç”µå½±ï¼Œè·‘ç¨‹åº.....æƒ³é€šäº†è¿™ä¸ªï¼Œå°±æƒ³é€šäº†å¦‚ä½•å¤„ç†å¤šä¸ªè¿æ¥äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1601870967,"ip_address":"","comment_id":249996,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18780745343","product_id":100032701,"comment_content":"çº¿ç¨‹æ± ä¸ªæ•°æœ‰é™ï¼Œå¦‚ä½•å¤„ç†æˆåƒä¸Šä¸‡çš„é“¾æ¥ï¼Ÿå‡å¦‚çº¿ç¨‹æ± å…±å››ä¸ªçº¿ç¨‹ï¼Œæ­£åœ¨å¤„ç†å››ä¸ªé“¾æ¥ã€‚å†æ¥ä¸€ä¸ªé“¾æ¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":2413440,"avatar":"https://static001.geekbang.org/account/avatar/00/24/d3/80/dd0b26cb.jpg","nickname":"ç½—å…†å³°","note":"","ucode":"05A7F73E7F6C58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551894,"discussion_content":"è€å¸ˆè¿™é‡Œçš„æ„æ€æ˜¯ï¼Œ å››ä¸ªsub-reactor IO çº¿ç¨‹å¹¶ä¸æ˜¯å¯¹åº”åªèƒ½æ¥å—4ä¸ªconnected_fd, äºŒååœ¨æ¯ä¸ªIO çº¿ç¨‹ä¸‹ç®¡ç†ä¸€ä¸ªfd-å¤„ç†å‡½æ•°çš„é›†åˆï¼ˆchannel_map)ï¼Œ å½“æ–°çš„è¿æ¥fd è¢«acceptäº†ä¹‹åï¼Œ éšæœºé€‰æ‹©ä¸€ä¸ªIO çº¿ç¨‹ï¼ˆIO çº¿ç¨‹é‡Œä¹Ÿæœ‰è‡ªå·±ç‹¬ç«‹çš„eventloopï¼‰å¹¶åŠ å…¥åˆ°è¿™ä¸ªå¤„ç†å‡½æ•°çš„é›†åˆé‡Œ, ç­‰å¾…IO äº‹ä»¶åˆ°æ¥çš„æ—¶å€™å°±å»æŸ¥æ‰¾è¿™ä¸ªé›†åˆç›¸å…³çš„å¤„ç†å‡½æ•°ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645167343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506093,"discussion_content":"å¥½é—®é¢˜ã€‚\n\nçº¿ç¨‹ä¸æ˜¯æ¯æ—¶æ¯åˆ»éƒ½è¦å¹²æ´»çš„ï¼Œå°±å¥½æ¯”ä¸€ä¸ªæµæ°´çº¿å·¥äººï¼Œåªæœ‰è½®åˆ°ä»–çš„æ—¶å€™ï¼Œä»–æ‰éœ€è¦å‡ºåŠ›å¹²æ´»ã€‚å¦‚æœè¿™å››ä¸ªè¿æ¥éƒ½åœ¨å¹²æ´»ï¼Œé‚£ç¬¬äº”ä¸ªåªå¥½ç­‰ä»»æ„ä¸€ä¸ªçº¿ç¨‹ç©ºé—²å‡ºæ¥ã€‚\n\næ‰€æœ‰çš„äº‹æƒ…ï¼Œç§˜è¯€éƒ½åœ¨äº&amp;quot;åˆ†æ—¶å¤ç”¨&amp;quot;ï¼Œæ¯”å¦‚ä½ çš„cpuï¼Œä¹Ÿå°±4ä¸ªcoreï¼Œä¸ºå•¥åŒæ—¶å¯ä»¥æ‰“æ¸¸æˆï¼Œå†™æ–‡ç¨¿ï¼Œçœ‹ç”µå½±ï¼Œè·‘ç¨‹åº.....æƒ³é€šäº†è¿™ä¸ªï¼Œå°±æƒ³é€šäº†å¦‚ä½•å¤„ç†å¤šä¸ªè¿æ¥äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601870967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2075086,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/a9/ce/23f2e185.jpg","nickname":"Running man","note":"","ucode":"F3357D6696A5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585882,"discussion_content":"è¿™é‡Œå…¶å®ä¸æ˜¯éšæœºé€‰æ‹©ï¼Œè€Œæ˜¯é€ä¸ªé€‰æ‹©ï¼Œæ¯æ–°å¢ä¸€ä¸ªè¿æ¥ï¼Œå¾€ä¸‹ä¸€ä¸ªå­çº¿ç¨‹é‡Œæ·»åŠ äº‹ä»¶ï¼Œå››ä¸ªçº¿ç¨‹å¦‚æ­¤åå¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661864352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243676,"user_name":"keepgoing","can_delete":false,"product_type":"c1","uid":1471387,"ip_address":"","ucode":"A2FE0687FB17E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/73/9b/67a38926.jpg","comment_is_top":false,"comment_ctime":1598246044,"is_pvip":false,"replies":[{"id":"90117","content":"ä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿæ¯ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1598795293,"ip_address":"","comment_id":243676,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5893213340","product_id":100032701,"comment_content":"æƒ³é—®é—®è€å¸ˆå…³äºåŸºç¡€è¯­æ³•çš„é—®é¢˜ï¼Œä»£ç é‡Œå¾ˆå¤šåœ°æ–¹å¯¹è±¡éƒ½æ˜¯ç›¸äº’å¼•ç”¨çš„ï¼Œæ¯”å¦‚tcp_connectioné‡Œå¼•ç”¨äº†channelæŒ‡é’ˆ, channel å¯¹è±¡é‡Œå¼•ç”¨äº†tcp_connectionæŒ‡é’ˆ, dispatcheré‡Œå¼•ç”¨äº†event_loopæŒ‡é’ˆ, event_loopé‡Œä¹Ÿå¼•ç”¨äº†dispatcheræŒ‡é’ˆã€‚è¿™æ ·ä»£ç ç¼–è¯‘çš„æ—¶å€™ä¸ºä»€ä¹ˆä¸ä¼šå¼•èµ·æŠ¥é”™ã€‚ã€‚","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504357,"discussion_content":"ä¸ºä»€ä¹ˆä¼šæŠ¥é”™å‘¢ï¼Ÿæ¯ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598795293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2231430,"avatar":"https://static001.geekbang.org/account/avatar/00/22/0c/86/2c64563f.jpg","nickname":"åˆ˜ç£Š","note":"","ucode":"B2222602633B76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534300,"discussion_content":"ç¼–è¯‘æŠ¥é”™çš„è¯ï¼Œéœ€è¦å‰å‘å£°æ˜ï¼Œäº†è§£ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638157599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234742,"user_name":"éƒ‘ç¥–ç…Œ","can_delete":false,"product_type":"c1","uid":1469608,"ip_address":"","ucode":"49A0D2E3279826","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/a8/1922a0f5.jpg","comment_is_top":false,"comment_ctime":1594784805,"is_pvip":false,"replies":[{"id":"86817","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1594908199,"ip_address":"","comment_id":234742,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5889752101","product_id":100032701,"comment_content":"ç¬¬ä¸€é“ï¼Œ å¯ä»¥ç›´æ¥åœ¨åº”ç”¨å±‚ä¸Šå°†è¾“å…¥çš„çº¿ç¨‹ä¸ªæ•°*2 ã€‚  ç¬¬äºŒé“ï¼Œ(1)å¯ä»¥åˆ¤æ–­å·²ç»åˆ›å»ºå¥½çš„çº¿ç¨‹ é‚£ä¸ªçº¿ç¨‹çš„äº‹ä»¶ä¸ªæ•°æœ€å°‘ï¼ŒæŒ‚åœ¨äº‹ä»¶æœ€å°‘çš„é‚£ä¸ªçº¿ç¨‹ä¸Šã€‚ ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501492,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594908199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143816,"user_name":"MoonGod","can_delete":false,"product_type":"c1","uid":1254337,"ip_address":"","ucode":"CB39976963F37A","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/c1/54ef6885.jpg","comment_is_top":false,"comment_ctime":1571795011,"is_pvip":false,"replies":[{"id":"55820","content":"å¥½é—®é¢˜ï¼Œ æˆ‘ç­”ç–‘ç»Ÿä¸€å›ç­”å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1572057864,"ip_address":"","comment_id":143816,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5866762307","product_id":100032701,"comment_content":"è€å¸ˆå…³äºåŠ é”è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœåŠ é”çš„ç›®çš„æ˜¯è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹åˆå§‹åŒ–event loopã€‚é‚£ä¸åŠ é”ä¸æ˜¯ä¹Ÿå¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„å—ï¼Ÿä¸»çº¿ç¨‹while å¾ªç¯é‡Œé¢ä¸æ–­åˆ¤æ–­å­çº¿ç¨‹çš„event loopæ˜¯å¦ä¸ä¸ºnullä¸å°±å¯ä»¥äº†ï¼Ÿä¸ºå•¥ä¸€å®šè¦åŠ ä¸€æŠŠé”å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471702,"discussion_content":"å¥½é—®é¢˜ï¼Œ æˆ‘ç­”ç–‘ç»Ÿä¸€å›ç­”å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572057864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1236766,"avatar":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","nickname":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","note":"","ucode":"103543D6E706BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39493,"discussion_content":"æˆ‘çš„çŒœæƒ³æ˜¯è·Ÿä½ ä¸åœçš„è½®è¯¢i/oæœ‰æ²¡æœ‰å°±ç»ªäº‹ä»¶ä¸€ä¸ªé“ç† ä½ è¦ä¸åœçš„åˆ¤æ–­ å ç”¨cpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571931207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143811,"user_name":"é±¼å‘åŒ—æ¸¸","can_delete":false,"product_type":"c1","uid":1439908,"ip_address":"","ucode":"580EC7DCE57E9A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","comment_is_top":false,"comment_ctime":1571794663,"is_pvip":false,"replies":[{"id":"55821","content":"å—¯ï¼Œæ¶¨çŸ¥è¯†äº†ï¼Œä»£ç è´´ä¸€ä¸ªï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1572057926,"ip_address":"","comment_id":143811,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5866761959","product_id":100032701,"comment_content":"nettyé€‰å­çº¿ç¨‹æ˜¯ä¸¤ç§ç®—æ³•ï¼Œéƒ½æ˜¯æœ‰ä¸ªåŸå­è‡ªå¢è®¡æ•°ï¼Œå¦‚æœçº¿ç¨‹æ•°ä¸æ˜¯2çš„å¹‚ç”¨å–æ¨¡ï¼Œå¦‚æœæ˜¯å°±æ˜¯æŒ‰ä½ä¸çº¿ç¨‹æ•°å‡ä¸€","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471699,"discussion_content":"å—¯ï¼Œæ¶¨çŸ¥è¯†äº†ï¼Œä»£ç è´´ä¸€ä¸ªï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572057926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2163653,"avatar":"https://static001.geekbang.org/account/avatar/00/21/03/c5/600fd645.jpg","nickname":"tianbingJ","note":"","ucode":"666141CAD8260F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551179,"discussion_content":"\næ˜¯çš„ï¼Œä»…ä»…æ˜¯è¿ç®—æ•ˆç‡é«˜ä¸€ç‚¹ï¼Œè¿˜æ˜¯round robin   \n\n private static final class PowerOfTwoEventExecutorChooser implements EventExecutorChooser {\n        private final AtomicInteger idx = new AtomicInteger();\n        private final EventExecutor[] executors;\n\n        PowerOfTwoEventExecutorChooser(EventExecutor[] executors) {\n            this.executors = executors;\n        }\n\n        @Override\n        public EventExecutor next() {\n            return executors[idx.getAndIncrement() &amp; executors.length - 1];\n   \n        }\n    }\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644918165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1816560,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/b7/f0/380183ff.jpg","nickname":"AriseFX","note":"","ucode":"274CCBA62CCCF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405888,"discussion_content":"ã€Œ2çš„næ¬¡æ–¹ã€è¿™ä¸ªç‚¹åªæ˜¯ä¸ºäº†é«˜æ•ˆå–æ¨¡å§......åªæ˜¯ä½è¿ç®—çš„ä¸€ä¸ªå°æŠ€å·§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634656161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356762,"user_name":"èœé¸¡äº’å•„","can_delete":false,"product_type":"c1","uid":2765079,"ip_address":"ä¸Šæµ·","ucode":"59162B81398399","user_header":"https://static001.geekbang.org/account/avatar/00/2a/31/17/ab2c27a6.jpg","comment_is_top":false,"comment_ctime":1662562752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662562752","product_id":100032701,"comment_content":"è€å¸ˆä½ å¥½ æœ€è¿‘åœ¨ç”¨C++é‡å†™ç¤ºä¾‹ä»£ç ã€‚æˆ‘å‘ç°ä¸ªé—®é¢˜ã€‚åœ¨Cä»£ç ä¸­ ä¸åŒçº¿ç¨‹åŒæ—¶åœ¨pollåŒä¸€ä»½event_setã€‚å¦‚æœpollå‡½æ•°æ—¶é—´å‚æ•°å†™æˆ-1ã€‚å¤šå¯å‡ ä¸ªç»ˆç«¯æ‰§è¡ŒncæŒ‡ä»¤ã€‚ç»å¸¸ä¼šå‡ºç°æ²¡æœ‰callbackçš„ç°è±¡ã€‚å¦‚æœpollä¸æ˜¯åŒä¸€ä»½event_set å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚ç½‘ä¸Šä¹Ÿæœ‰åˆ«äººçš„ä¸€äº›è®¨è®ºã€‚å¯¹æ­¤è€å¸ˆæ€ä¹ˆçœ‹ã€‚æœ›å›å¤ã€‚https:&#47;&#47;stackoverflow.com&#47;questions&#47;18891500&#47;multiple-threads-doing-poll-or-select-on-a-single-socket-or-pipe","like_count":0},{"had_liked":false,"id":356214,"user_name":"Running man","can_delete":false,"product_type":"c1","uid":2075086,"ip_address":"æµ™æ±Ÿ","ucode":"F3357D6696A5C1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/a9/ce/23f2e185.jpg","comment_is_top":false,"comment_ctime":1662044418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662044418","product_id":100032701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå­çº¿ç¨‹channelä»¥åŠchannel_elementå¯¹è±¡éƒ½æ˜¯åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä½†åœ¨è¿æ¥closeåå¹¶æœªçœ‹åˆ°é‡Šæ”¾ï¼Œæ˜¯å¦æ˜¯å†…å­˜æ³„éœ²äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":336261,"user_name":"é›¨é‡Œ","can_delete":false,"product_type":"c1","uid":2675399,"ip_address":"","ucode":"C475DE8B5375AB","user_header":"https://static001.geekbang.org/account/avatar/00/28/d2/c7/b7f52df2.jpg","comment_is_top":false,"comment_ctime":1646040010,"is_pvip":false,"replies":[{"id":"123122","content":"ä¸»çº¿ç¨‹ï¼Œå¯ä»¥å¾€å­çº¿ç¨‹çš„ç®¡é“ä¸Šå†™æ•°æ®ï¼Œä»è€Œå”¤é†’å­çº¿ç¨‹ã€‚<br>ä¼ é€’fdçš„ä»£ç åœ¨è¿™ä¸ªå‡½æ•°é‡Œã€‚<br>int event_loop_do_channel_event(struct event_loop *eventLoop, int fd, struct channel *channel1, int type) {<br>    &#47;&#47;get the lock<br>    pthread_mutex_lock(&amp;eventLoop-&gt;mutex);<br>    assert(eventLoop-&gt;is_handle_pending == 0);<br>    event_loop_channel_buffer_nolock(eventLoop, fd, channel1, type);<br>    &#47;&#47;release the lock<br>    pthread_mutex_unlock(&amp;eventLoop-&gt;mutex);<br>    if (!isInSameThread(eventLoop)) {<br>        event_loop_wakeup(eventLoop);<br>    } else {<br>        event_loop_handle_pending_channel(eventLoop);<br>    }<br><br>    return 0;<br>}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1646487637,"ip_address":"","comment_id":336261,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1646040010","product_id":100032701,"comment_content":"æ²¡æœ‰çœ‹æ˜ç™½ä¸»ä»reactorè¿™ä¸ªä¸»çº¿ç¨‹æ˜¯å¦‚ä½•å”¤é†’å­çº¿ç¨‹çš„ï¼Ÿï¼Ÿï¼Ÿ<br>1ã€å°±å•reactorè€Œè¨€ï¼Œä¸»çº¿ç¨‹åˆ›å»ºç®¡é“fdï¼Œæ­£å¸¸æ¥è¯´åº”è¯¥æ˜¯åœ¨epoll_waitä¸Šæ³¨å†Œ0ç«¯è¯»äº‹ä»¶ï¼Œå¾€ç®¡é“1ç«¯å†™æ•°æ®çš„æ–¹å¼æ¥å”¤é†’epollã€‚<br>2ã€è€Œä¸»ä»reactorä»£ç æ¥çœ‹ï¼Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹éƒ½åˆ›å»ºäº†ä¸€å¯¹pairfdï¼Œä¸»çº¿ç¨‹çš„ç®¡é“1ç«¯æ³¨å†Œåœ¨ä¸»çº¿ç¨‹çš„epollä¸Šï¼Œè¿™æ ·å³ä½¿å¾€ç®¡é“ä¸­å†™æ•°æ®ï¼Œä¹Ÿåªæ˜¯å”¤é†’ä¸»çº¿ç¨‹ï¼Œæ€ä¹ˆä¼šå”¤é†’å­çº¿ç¨‹å‘¢ï¼Ÿï¼Ÿï¼Œä»£ç ä¸­å¥½åƒæ²¡æœ‰å°†ä¸»çº¿ç¨‹çš„ç®¡é“fdä¸€ç«¯æ³¨å†Œåœ¨å­çº¿ç¨‹çš„epollä¸Šã€‚æ˜¯ä¸æ˜¯ä¸‹é¢çš„è¿™è¡Œä»£ç å¯¼è‡´çš„<br>eventLoop-&gt;eventDispatcher = &amp;poll_dispatcher;<br>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å…±ç”¨ä¸€ä¸ªåŒä¸€ä¸ªpoll_dispatcherå¯¹è±¡ï¼Œè¿˜æ˜¯æ²¡æœ‰çœ‹å‡ºåœ¨å“ªä¸ªåœ°æ–¹ä¼ é€’çš„fd??","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554608,"discussion_content":"ä¸»çº¿ç¨‹ï¼Œå¯ä»¥å¾€å­çº¿ç¨‹çš„ç®¡é“ä¸Šå†™æ•°æ®ï¼Œä»è€Œå”¤é†’å­çº¿ç¨‹ã€‚\nä¼ é€’fdçš„ä»£ç åœ¨è¿™ä¸ªå‡½æ•°é‡Œã€‚\nint event_loop_do_channel_event(struct event_loop *eventLoop, int fd, struct channel *channel1, int type) {\n    //get the lock\n    pthread_mutex_lock(&amp;eventLoop-&gt;mutex);\n    assert(eventLoop-&gt;is_handle_pending == 0);\n    event_loop_channel_buffer_nolock(eventLoop, fd, channel1, type);\n    //release the lock\n    pthread_mutex_unlock(&amp;eventLoop-&gt;mutex);\n    if (!isInSameThread(eventLoop)) {\n        event_loop_wakeup(eventLoop);\n    } else {\n        event_loop_handle_pending_channel(eventLoop);\n    }\n\n    return 0;\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646487637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2075086,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/a9/ce/23f2e185.jpg","nickname":"Running man","note":"","ucode":"F3357D6696A5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586217,"discussion_content":"isInSameThreadè¿™ä¸ªæ¥å£å¾ˆå…³é”®ï¼Œevent_loop_do_channel_eventæ˜¯ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œè€Œchannelå¯¹è±¡æ˜¯å­çº¿ç¨‹çš„ï¼Œå› æ­¤å°±è¿›å…¥åˆ°å”¤é†’å­çº¿ç¨‹çš„æ“ä½œï¼Œwrite socketpair","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662044672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335109,"user_name":"zssdhr","can_delete":false,"product_type":"c1","uid":1010602,"ip_address":"","ucode":"2DFE1F017A46EB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/aa/ec09c4b4.jpg","comment_is_top":false,"comment_ctime":1645338914,"is_pvip":false,"replies":[{"id":"122806","content":"1.å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼›<br>2.ä½ è¯´çš„æ²¡é”™ï¼Œæ˜¯æŒ‰ç…§é¡ºåºçš„ï¼Œç¬¬ä¸€ä¸ªå®Œæˆï¼Œå†ç¬¬äºŒä¸ªï¼Œé—®é¢˜æ˜¯åˆ°ç¬¬äºŒä¸ªä»¥åï¼Œå¦‚ä½•åˆ¤æ–­ç¬¬äºŒä¸ªå·²ç»å®Œæˆåˆå§‹åŒ–äº†ï¼Œå› ä¸ºè¿™é‡Œçš„çº¿ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½çº¿ç¨‹åˆå§‹åŒ–å®Œæˆäº†ï¼Œæ‰è¿›å…¥åˆ¤æ–­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1645882902,"ip_address":"","comment_id":335109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645338914","product_id":100032701,"comment_content":"è€å¸ˆï¼Œå…³äº event_loop_thread æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚<br><br>1. ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹è¦ç­‰å¾…å­çº¿ç¨‹åˆå§‹åŒ–å®Œæˆï¼Ÿæ˜¯æ‹…å¿ƒ tcp_server_init åã€ä½†å­çº¿ç¨‹è¿˜æœªåˆå§‹åŒ–å®Œæˆæ—¶ï¼Œthread_pool_get_loop æ— æ³•æ‰¾åˆ°å­çº¿ç¨‹æ¥å¤„ç†æ–°æ¥çš„è¿æ¥å—ï¼Ÿ<br><br>2. æ–‡ä¸­æåˆ°â€ä½ å¯èƒ½ä¼šé—®ï¼Œä¸»çº¿ç¨‹æ˜¯å¾ªç¯åœ¨ç­‰å¾…æ¯ä¸ªå­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œå¦‚æœè¿›å…¥ç¬¬äºŒä¸ªå¾ªç¯ï¼Œç­‰å¾…ç¬¬äºŒä¸ªå­çº¿ç¨‹å®Œæˆåˆå§‹åŒ–ï¼Œè€Œæ­¤æ—¶ç¬¬äºŒä¸ªå­çº¿ç¨‹å·²ç»åˆå§‹åŒ–å®Œæˆäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿâ€œ<br>ä¸»çº¿ç¨‹ä¸æ˜¯ç­‰ç¬¬ä¸€ä¸ªå­çº¿ç¨‹åˆå§‹åŒ–å®Œæˆåæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯å¯åŠ¨ç¬¬äºŒä¸ªå­çº¿ç¨‹å—ï¼Ÿæ€ä¹ˆä¼šå‡ºç°â€è€Œæ­¤æ—¶ç¬¬äºŒä¸ªå­çº¿ç¨‹å·²ç»åˆå§‹åŒ–å®Œæˆäº†â€œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553421,"discussion_content":"1.å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼›\n2.ä½ è¯´çš„æ²¡é”™ï¼Œæ˜¯æŒ‰ç…§é¡ºåºçš„ï¼Œç¬¬ä¸€ä¸ªå®Œæˆï¼Œå†ç¬¬äºŒä¸ªï¼Œé—®é¢˜æ˜¯åˆ°ç¬¬äºŒä¸ªä»¥åï¼Œå¦‚ä½•åˆ¤æ–­ç¬¬äºŒä¸ªå·²ç»å®Œæˆåˆå§‹åŒ–äº†ï¼Œå› ä¸ºè¿™é‡Œçš„çº¿ç¨‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½çº¿ç¨‹åˆå§‹åŒ–å®Œæˆäº†ï¼Œæ‰è¿›å…¥åˆ¤æ–­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645882902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330167,"user_name":"Janus Pen","can_delete":false,"product_type":"c1","uid":2667580,"ip_address":"","ucode":"70B3F972739278","user_header":"https://static001.geekbang.org/account/avatar/00/28/b4/3c/e4a08d98.jpg","comment_is_top":false,"comment_ctime":1641825569,"is_pvip":false,"replies":[{"id":"120793","content":"ä¸ä¼šã€‚<br><br>ä¸¤ä¸ªçš„ç”¨å¤„ä¸ä¸€æ ·ï¼Œå…¶ä¸­ï¼Œevent_loop_runä¸­ï¼Œæ˜¯ä¸ºäº†å¤„ç†æ‰€æœ‰å¾…æ·»åŠ çš„äº‹ä»¶ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯åœ¨dispatchçº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚<br><br>è€Œevent_loop_do_channel_eventï¼Œæ˜¯æ—¢å¯èƒ½åœ¨dispatchçº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½ä¸åœ¨ï¼Œè€Œåœ¨dispatchçº¿ç¨‹ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨event_loop_handle_pending_channelå®Œæˆäº‹ä»¶çš„å®æ—¶æ·»åŠ ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å”¤é†’dispatchçº¿ç¨‹ï¼Œè®©å®ƒè‡ªå·±å®Œæˆæ·»åŠ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1642310089,"ip_address":"","comment_id":330167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641825569","product_id":100032701,"comment_content":"è€å¸ˆï¼ševent_loop_do_channel_eventå‡½æ•°ä¸­çš„event_loop_handle_pending_channelå‡½æ•°è°ƒç”¨ä¸event_loop_runå‡½æ•°ä¸­çš„event_loop_handle_pending_channelå‡½æ•°è°ƒç”¨æ˜¯å¦é‡å¤?","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546433,"discussion_content":"ä¸ä¼šã€‚\n\nä¸¤ä¸ªçš„ç”¨å¤„ä¸ä¸€æ ·ï¼Œå…¶ä¸­ï¼Œevent_loop_runä¸­ï¼Œæ˜¯ä¸ºäº†å¤„ç†æ‰€æœ‰å¾…æ·»åŠ çš„äº‹ä»¶ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯åœ¨dispatchçº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚\n\nè€Œevent_loop_do_channel_eventï¼Œæ˜¯æ—¢å¯èƒ½åœ¨dispatchçº¿ç¨‹ï¼Œä¹Ÿå¯èƒ½ä¸åœ¨ï¼Œè€Œåœ¨dispatchçº¿ç¨‹ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨event_loop_handle_pending_channelå®Œæˆäº‹ä»¶çš„å®æ—¶æ·»åŠ ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å”¤é†’dispatchçº¿ç¨‹ï¼Œè®©å®ƒè‡ªå·±å®Œæˆæ·»åŠ ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642310089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329845,"user_name":"æ¶ˆå¤±çš„æ—¶å…‰","can_delete":false,"product_type":"c1","uid":2458932,"ip_address":"","ucode":"291EA7E21762F4","user_header":"https://static001.geekbang.org/account/avatar/00/25/85/34/ad4cbfe4.jpg","comment_is_top":false,"comment_ctime":1641570810,"is_pvip":false,"replies":[{"id":"120795","content":"epollä¸å…è®¸è¿™ä¹ˆå¹²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1642310159,"ip_address":"","comment_id":329845,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1641570810","product_id":100032701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œä¸æ˜¯å¾ˆç†è§£ä¸ºä»€ä¹ˆè¦socketpairå”¤é†’ï¼Œç›´æ¥æŠŠæ–°è¿æ¥çš„socketåŠ åˆ°epollé‡Œé¢ï¼Œæœ‰å‘é€å°±çš„æ•°æ®è¿‡æ¥ï¼Œè¿™ä¸ªçº¿ç¨‹è‡ªå·±ä¸ä¼šé†’å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546435,"discussion_content":"epollä¸å…è®¸è¿™ä¹ˆå¹²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642310159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1010602,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6b/aa/ec09c4b4.jpg","nickname":"zssdhr","note":"","ucode":"2DFE1F017A46EB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552196,"discussion_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘æŸ¥çš„ epoll_wait çš„ man page è¯´å¯ä»¥è¿™ä¹ˆå¹²ï¼šWhile one thread is blocked in a call to epoll_wait(), it is possible for another thread to add a file descriptor to the waited-upon epoll instance. If the new file descriptor becomes ready, it will cause the epoll_wait() call to unblock.  \n\nhttps://man7.org/linux/man-pages/man2/epoll_wait.2.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645342857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":546435,"ip_address":""},"score":552196,"extra":""}]},{"author":{"id":2740779,"avatar":"https://static001.geekbang.org/account/avatar/00/29/d2/2b/af13fcd6.jpg","nickname":"ç®€ç®€å•å•å°±æ˜¯å¹¸ç¦","note":"","ucode":"A08080E6FD255F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580722,"discussion_content":"æŒ‰ç…§zssdhræä¾›çš„æ–‡çŒ®ï¼Œæ˜¯ä¸æ˜¯epollå¯ä»¥è¿™ä¹ˆåšï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658361330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329497,"user_name":"èœé¸¡äº’å•„","can_delete":false,"product_type":"c1","uid":2765079,"ip_address":"","ucode":"59162B81398399","user_header":"https://static001.geekbang.org/account/avatar/00/2a/31/17/ab2c27a6.jpg","comment_is_top":false,"comment_ctime":1641372190,"is_pvip":false,"replies":[{"id":"120806","content":"æ˜¯çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1642310510,"ip_address":"","comment_id":329497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641372190","product_id":100032701,"comment_content":"è€å¸ˆä½ å¥½ å…³äºç¬¬äºŒç‚¹ æ˜¯ä¸æ˜¯ç›¸å½“äºæ²¡æœ‰éœ€è¦éå†çš„æè¿°ç¬¦ å¯¼è‡´ä¸€ç›´å¡åœ¨pollæˆ–è€…selectä¸Šã€‚æ‰€ä»¥æ‰‹åŠ¨æ„é€ socketpairä½œä¸ºåˆå§‹æè¿°ç¬¦ã€‚å†æ·»åŠ çœŸæ­£æ–°çš„æè¿°ç¬¦æ—¶ ç”¨socketpairæŠŠç¨‹åºä»pollæˆ–è€…selecté˜»å¡ä¸Šè§£æ”¾å‡ºæ¥ ä»¥è·å–è¾¾åˆ°æ·»åŠ æè¿°ç¬¦çš„æ—¶æœºï¼Ÿæˆ‘çš„ç†è§£å¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546448,"discussion_content":"æ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642310510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321135,"user_name":"ç¾¤ä¹¦","can_delete":false,"product_type":"c1","uid":1437036,"ip_address":"","ucode":"BA9EE71D2D818A","user_header":"https://static001.geekbang.org/account/avatar/00/15/ed/6c/6fb35017.jpg","comment_is_top":false,"comment_ctime":1636686669,"is_pvip":true,"replies":[{"id":"116710","content":"å¸¸è§„åšæ³•æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è¿˜æƒ³ä¸å‡ºè¶…å¸¸è§„åšæ³•ğŸ˜¢ã€‚<br><br>è¿™ä¸ªä¸ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ï¼Œä¸ç”¨æ‹…å¿ƒã€‚è¿Nettyéƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1636875230,"ip_address":"","comment_id":321135,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636686669","product_id":100032701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œé€»è¾‘çº¿ç¨‹å†™æ•°æ®åˆ°å‘é€é˜Ÿåˆ—ï¼ŒåŒæ—¶é€šçŸ¥å”¤é†’ioçº¿ç¨‹ï¼Œè¿™ä¸ªé€šçŸ¥æ–¹å¼ç›®å‰æ¯”è¾ƒå¸¸è§„çš„åšæ³•æ˜¯å¥—æ¥å­—å¯¹æˆ–è€…äº‹ä»¶fd å®é™…æµ‹è¯•ä¸‹æ¥ éƒ½ä¼šå¢åŠ ä¸»çº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ æœ‰ä»€ä¹ˆä¼˜åŒ–åŠæ³•å‘¢","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530227,"discussion_content":"å¸¸è§„åšæ³•æ˜¯è¿™æ ·çš„ï¼Œæˆ‘è¿˜æƒ³ä¸å‡ºè¶…å¸¸è§„åšæ³•ğŸ˜¢ã€‚\n\nè¿™ä¸ªä¸ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ï¼Œä¸ç”¨æ‹…å¿ƒã€‚è¿Nettyéƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636875230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265798,"user_name":"YUAN","can_delete":false,"product_type":"c1","uid":2153838,"ip_address":"","ucode":"98EF68EEE21893","user_header":"https://static001.geekbang.org/account/avatar/00/20/dd/6e/8f6f79d2.jpg","comment_is_top":false,"comment_ctime":1607039399,"is_pvip":false,"replies":[{"id":"98880","content":"å”¤é†’çš„ç›®çš„æ˜¯è®©ä¸»çº¿ç¨‹é‚£ä¸ªè´Ÿè´£åˆ†å‘çš„å®¶ä¼™é†’æ¥å¹²æ´»ï¼Œä¸è¦ç»§ç»­ç­‰å¾…äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1610286249,"ip_address":"","comment_id":265798,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607039399","product_id":100032701,"comment_content":"ä¸»çº¿ç¨‹å’Œä¸›çº¿ç¨‹ä¸æ˜¯å…±äº«å†…å­˜å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦socketpairå”¤é†’å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511048,"discussion_content":"å”¤é†’çš„ç›®çš„æ˜¯è®©ä¸»çº¿ç¨‹é‚£ä¸ªè´Ÿè´£åˆ†å‘çš„å®¶ä¼™é†’æ¥å¹²æ´»ï¼Œä¸è¦ç»§ç»­ç­‰å¾…äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610286249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246511,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1599384856,"is_pvip":false,"replies":[{"id":"90594","content":"æˆ‘è®¤ä¸ºä¸ä¼šã€‚åŸå› æ˜¯æ¯ä¸ªeventloopå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„dispatchã€‚è™½ç„¶å…¬ç”¨çš„æ˜¯ä¸€ä¸ªepoll_dispatcherï¼Œä½†æ˜¯ä½ å¯ä»¥æ³¨æ„åˆ°åœ¨è°ƒç”¨epoll_waitå‡½æ•°æ—¶ï¼Œæ˜¯å–è‡ªå„è‡ªevent_loopé‡Œçš„ç‹¬ç«‹æ•°æ®ã€‚<br><br>    epoll_dispatcher_data *epollDispatcherData = (epoll_dispatcher_data *) eventLoop-&gt;event_dispatcher_data;<br>","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1599401119,"ip_address":"","comment_id":246511,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1599384856","product_id":100032701,"comment_content":"è€å¸ˆï¼Œmain-EventLoopå’Œsub-EventLoopé‡Œé¢çš„eventLoop-&gt;eventDispatcher = &amp;epoll_dispatcher;éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªepoll_dispatcherã€‚å…¶ä¸­main-EventLoopç”¨äºacceptæ–°è¿æ¥ï¼Œè·å¾—æ–°è¿æ¥å°è£…channeläº¤ç»™æŸä¸€ä¸ªsub-EventLoopå»å¤„ç†ã€‚å‡å¦‚dispatchæœ‰äº‹ä»¶ï¼Œæ˜¯ä¸æ˜¯å­çº¿ç¨‹ä¹Ÿä¼šä»dispatchå¤„æƒŠé†’ï¼Œè¿™æ˜¯ä¸æ˜¯æœ‰â€œæƒŠç¾¤æ•ˆåº”â€å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505169,"discussion_content":"æˆ‘è®¤ä¸ºä¸ä¼šã€‚åŸå› æ˜¯æ¯ä¸ªeventloopå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„dispatchã€‚è™½ç„¶å…¬ç”¨çš„æ˜¯ä¸€ä¸ªepoll_dispatcherï¼Œä½†æ˜¯ä½ å¯ä»¥æ³¨æ„åˆ°åœ¨è°ƒç”¨epoll_waitå‡½æ•°æ—¶ï¼Œæ˜¯å–è‡ªå„è‡ªevent_loopé‡Œçš„ç‹¬ç«‹æ•°æ®ã€‚\n\n    epoll_dispatcher_data *epollDispatcherData = (epoll_dispatcher_data *) eventLoop-&amp;gt;event_dispatcher_data;\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599401119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2075086,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/a9/ce/23f2e185.jpg","nickname":"Running man","note":"","ucode":"F3357D6696A5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586218,"discussion_content":"ä¸åŒçš„epollç›‘å¬ä¸åŒçš„å¥—æ¥å­—ï¼Œä¸ä¼šç›¸äº’å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662044860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"å¿†æ°´å¯’","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303957,"discussion_content":"æ˜ç™½äº†ï¼Œä¹Ÿå°±åˆ›å»ºä¸€æ¬¡epoll_createï¼Œå¤šä¸ªeventloopéƒ½å¯ä»¥è°ƒç”¨epoll_waitå»ç›‘å¬äº‹ä»¶ã€‚åªæ˜¯ä¸»eventloopç›‘å¬acceptäº‹ä»¶ï¼Œsub-eventloopç›‘å¬è¯»å†™äº‹ä»¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599432249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223479,"user_name":"Geek_76f04f","can_delete":false,"product_type":"c1","uid":2020720,"ip_address":"","ucode":"2A3D34C303E19A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d5/70/93a34aa5.jpg","comment_is_top":false,"comment_ctime":1591099683,"is_pvip":false,"replies":[{"id":"84257","content":"æˆ‘è®¤ä¸ºä¸éœ€è¦","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1592739231,"ip_address":"","comment_id":223479,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1591099683","product_id":100032701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜æƒ³å’¨è¯¢ä¸€ä¸‹ï¼Œæˆ‘çœ‹èµ„æ–™è¯´çº¿ç¨‹æˆ–è€…è¿›ç¨‹éœ€è¦ç»‘å®šå†…æ ¸ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåƒè¿™ç§reactoræ¨¡å‹ä¸­ï¼Œå¦‚æœå¼€è¾Ÿcorenumä¸ªçº¿ç¨‹ï¼Œä¸€èˆ¬éœ€è¦ç»‘å®šå†…æ ¸å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497140,"discussion_content":"æˆ‘è®¤ä¸ºä¸éœ€è¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592739231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210216,"user_name":"ä¸­å¹´ç”·å­","can_delete":false,"product_type":"c1","uid":1039204,"ip_address":"","ucode":"027C86B3370150","user_header":"https://static001.geekbang.org/account/avatar/00/0f/db/64/06d54a80.jpg","comment_is_top":false,"comment_ctime":1587698827,"is_pvip":true,"replies":[{"id":"78410","content":"ä»£ç å·²ç»ä¿®å¤ï¼Œæ–‡ç¨¿æˆ‘å†çœ‹ä¸‹å“ˆã€‚<br><br>ä½ è¯´çš„æ˜¯å¯¹çš„ï¼Œchannelé‡Œç¡®å®æœ‰è¿™ä¸ªfdï¼Œè¿™é‡Œæ˜¯ä¸ºäº†çªå‡ºè¿™ä¸ªä½œç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1587803591,"ip_address":"","comment_id":210216,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1587698827","product_id":100032701,"comment_content":"event_loop_initä¸­ï¼Œä»£ç ç‰‡æ®µï¼š<br>event_loop_add_channel_event(eventLoop, eventLoop-&gt;socketPair[0], channel);<br>å…¶ä¸­ä¼ å…¥çš„åº”è¯¥æ˜¯socketPair[1]<br>æ–‡ç¨¿ä¸­çš„ä»£ç è¿˜æœªä¿®æ­£ï¼Œå¦å¤–æˆ‘è®¤ä¸ºè¿™ä¸ªfdä½œä¸ºå‚æ•°å®é™…ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œevent_loop_add_channel_event å¾€åè°ƒç”¨çš„å‡ ä¸ªå‡½æ•°é‡Œå®é™…ä¸Šéƒ½ç”¨ä¸åˆ°è¿™ä¸ªfdï¼Œåªéœ€è¦channel å°±å¯ä»¥äº†ï¼Œå› ä¸ºchannelé‡Œå·²æœ‰è¿™ä¸ªfdã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492974,"discussion_content":"ä»£ç å·²ç»ä¿®å¤ï¼Œæ–‡ç¨¿æˆ‘å†çœ‹ä¸‹å“ˆã€‚\n\nä½ è¯´çš„æ˜¯å¯¹çš„ï¼Œchannelé‡Œç¡®å®æœ‰è¿™ä¸ªfdï¼Œè¿™é‡Œæ˜¯ä¸ºäº†çªå‡ºè¿™ä¸ªä½œç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587803591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2675399,"avatar":"https://static001.geekbang.org/account/avatar/00/28/d2/c7/b7f52df2.jpg","nickname":"é›¨é‡Œ","note":"","ucode":"C475DE8B5375AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553725,"discussion_content":"è¿™ä¸ªåº”è¯¥éƒ½å¯ä»¥çš„ï¼Œsocketpairåˆ›å»ºçš„æ˜¯ä¸€å¯¹å…¨åŒå·¥é€šä¿¡çš„fdï¼Œä¸€ç«¯è¯»ï¼Œå¦ä¸€ç«¯å†™å°±è¡Œï¼Œä¸€èˆ¬åº”è¯¥ç›‘å¬0è¯»ç«¯ï¼Œå¾€1å†™ç«¯å†™æ•°æ®ï¼Œå¦‚æœä¸€ä¸ªç®¡é“çš„è¯åº”è¯¥ä¼ å…¥0ç«¯ï¼Œç›‘å¬å¯è¯»äº‹ä»¶æ‰æ˜¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1646041218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179941,"user_name":"wzp","can_delete":false,"product_type":"c1","uid":1120298,"ip_address":"","ucode":"2C511B2755A1E1","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/2a/9c18a3c4.jpg","comment_is_top":false,"comment_ctime":1582124489,"is_pvip":false,"replies":[{"id":"71041","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583053274,"ip_address":"","comment_id":179941,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582124489","product_id":100032701,"comment_content":"å¹²è´§æ»¡æ»¡ï¼Œæœ‰æ”¶è·","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484457,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583053274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178079,"user_name":"å‡‰äººã€‚","can_delete":false,"product_type":"c1","uid":1659177,"ip_address":"","ucode":"4DB16004A62015","user_header":"https://static001.geekbang.org/account/avatar/00/19/51/29/24739c58.jpg","comment_is_top":false,"comment_ctime":1581583631,"is_pvip":false,"replies":[{"id":"71018","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583050956,"ip_address":"","comment_id":178079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1581583631","product_id":100032701,"comment_content":"æ¯”è¾ƒéš¾ã€‚ä½†å¤šçœ‹å‡ éè¿˜æ˜¯æœ‰æ”¶è·","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483659,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583050956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177089,"user_name":"xupeng1644","can_delete":false,"product_type":"c1","uid":1596906,"ip_address":"","ucode":"B3110D74266886","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83errIIarFicghpKamvkUaJmGdIV488iaOUyUqcTwbQ6IeRS40ZFfIOfb369fgleydAT8pkucHuj2x45A/132","comment_is_top":false,"comment_ctime":1581265065,"is_pvip":false,"replies":[{"id":"71014","content":"ç¡®å®æ˜¯ï¼Œå·²æ”¹æ­£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583050688,"ip_address":"","comment_id":177089,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1581265065","product_id":100032701,"comment_content":"event_loop_initä¸­ï¼Œä»£ç ç‰‡æ®µï¼š<br>event_loop_add_channel_event(eventLoop, eventLoop-&gt;socketPair[0], channel);<br>å…¶ä¸­ä¼ å…¥çš„åº”è¯¥æ˜¯socketPair[1]å§ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483305,"discussion_content":"ç¡®å®æ˜¯ï¼Œå·²æ”¹æ­£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583050688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1039204,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/db/64/06d54a80.jpg","nickname":"ä¸­å¹´ç”·å­","note":"","ucode":"027C86B3370150","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":245760,"discussion_content":"æ–‡ç¨¿é‡Œçš„ä»£ç è¿˜æ²¡æœ‰ä¿®æ­£ï¼Œ å¹¶ä¸”æˆ‘è®¤ä¸ºè¿™ä¸ªfdä½œä¸ºå‚æ•°å®é™…ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œevent_loop_add_channel_event å¾€åè°ƒç”¨çš„å‡ ä¸ªå‡½æ•°é‡Œå®é™…ä¸Šéƒ½ç”¨ä¸åˆ°è¿™ä¸ªfdï¼Œåªéœ€è¦channel å°±å¯ä»¥äº†ï¼Œå› ä¸ºchannelé‡Œå·²æœ‰è¿™ä¸ªfdã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587697765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145610,"user_name":"é±¼å‘åŒ—æ¸¸","can_delete":false,"product_type":"c1","uid":1439908,"ip_address":"","ucode":"580EC7DCE57E9A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","comment_is_top":false,"comment_ctime":1572329649,"is_pvip":false,"replies":[{"id":"56626","content":"æ„Ÿè§‰è¿˜æ˜¯æŒ‰ç…§é¡ºåºåœ¨å–çº¿ç¨‹å·å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1572574322,"ip_address":"","comment_id":145610,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1572329649","product_id":100032701,"comment_content":"å›è€å¸ˆä¸Šä¸€æ¡ æŠŠä»£ç nettyè´´è¿‡æ¥äº†<br>     private static final class PowerOfTwoEventExecutorChooser implements EventExecutorChooser {<br>        private final AtomicInteger idx = new AtomicInteger();<br>        private final EventExecutor[] executors;<br><br>        PowerOfTwoEventExecutorChooser(EventExecutor[] executors) {<br>            this.executors = executors;<br>        }<br><br>        @Override<br>        public EventExecutor next() {<br>            return executors[idx.getAndIncrement() &amp; executors.length - 1];<br>        }<br>    }<br><br>    private static final class GenericEventExecutorChooser implements EventExecutorChooser {<br>        private final AtomicInteger idx = new AtomicInteger();<br>        private final EventExecutor[] executors;<br><br>        GenericEventExecutorChooser(EventExecutor[] executors) {<br>            this.executors = executors;<br>        }<br><br>        @Override<br>        public EventExecutor next() {<br>            return executors[Math.abs(idx.getAndIncrement() % executors.length)];<br>        }<br>    }","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472489,"discussion_content":"æ„Ÿè§‰è¿˜æ˜¯æŒ‰ç…§é¡ºåºåœ¨å–çº¿ç¨‹å·å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572574322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1439908,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132","nickname":"é±¼å‘åŒ—æ¸¸","note":"","ucode":"580EC7DCE57E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42040,"discussion_content":"æœ¬è´¨è¿˜æ˜¯è½®è¯¢ï¼Œè¿™ä¸ªåªæ˜¯ä»£ç æŠ€å·§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572575475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143806,"user_name":"ç¨‹åºæ°´æœå®","can_delete":false,"product_type":"c1","uid":1371633,"ip_address":"","ucode":"1700DDFE073A56","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132","comment_is_top":false,"comment_ctime":1571794384,"is_pvip":false,"replies":[{"id":"55514","content":"ä»£ç é“¾æ¥è¯·å»è¯¦æƒ…é¡µæŸ¥çœ‹ã€‚","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ä½•æ˜Œæ¢…","uid":"1165037","ctime":1571797211,"ip_address":"","comment_id":143806,"utype":2}],"discussion_count":2,"race_medal":0,"score":"1571794384","product_id":100032701,"comment_content":"æ±‚å®Œæ•´çš„ä»£ç é“¾æ¥","like_count":0,"discussions":[{"author":{"id":1165037,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c6/ed/89a2dc13.jpg","nickname":"ä¸¢äº†ä¸ªä¸¢ä¸¢ä¸¢","note":"","ucode":"BDD7E97E0E5E96","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471697,"discussion_content":"ä»£ç é“¾æ¥è¯·å»è¯¦æƒ…é¡µæŸ¥çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571797211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"éƒ­è•¾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248285,"discussion_content":"https://github.com/froghui/yolanda","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587861939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}