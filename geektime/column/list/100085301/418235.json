{"id":418235,"title":"11ï½œå†…å­˜ç®¡ç†ï¼šä»åˆ›å»ºåˆ°æ¶ˆäº¡ï¼Œå€¼éƒ½ç»å†äº†ä»€ä¹ˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚</p><p>åˆæ¢ Rust ä»¥æ¥ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å­¦ä¹ æœ‰å…³æ‰€æœ‰æƒå’Œç”Ÿå‘½å‘¨æœŸçš„å†…å®¹ï¼Œæƒ³å¿…ç°åœ¨ï¼Œä½ å¯¹ Rust å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæ€æƒ³å·²ç»æœ‰è¶³å¤Ÿç†è§£äº†ã€‚</p><p>é€šè¿‡å•ä¸€æ‰€æœ‰æƒæ¨¡å¼ï¼ŒRust è§£å†³äº†å †å†…å­˜è¿‡äºçµæ´»ã€ä¸å®¹æ˜“å®‰å…¨é«˜æ•ˆåœ°é‡Šæ”¾çš„é—®é¢˜ï¼Œæ—¢é¿å…äº†æ‰‹å·¥é‡Šæ”¾å†…å­˜å¸¦æ¥çš„å·¨å¤§å¿ƒæ™ºè´Ÿæ‹…å’Œæ½œåœ¨çš„é”™è¯¯ï¼›åˆé¿å…äº†å…¨å±€å¼•å…¥è¿½è¸ªå¼ GC æˆ–è€… ARC è¿™æ ·çš„é¢å¤–æœºåˆ¶å¸¦æ¥çš„æ•ˆç‡é—®é¢˜ã€‚</p><p>ä¸è¿‡æ‰€æœ‰æƒæ¨¡å‹ä¹Ÿå¼•å…¥äº†å¾ˆå¤šæ–°æ¦‚å¿µï¼Œä» Move / Copy / Borrow è¯­ä¹‰åˆ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ‰€ä»¥å­¦èµ·æ¥æœ‰äº›éš¾åº¦ã€‚</p><p>ä½†æ˜¯ï¼Œä½ å‘ç°äº†å—ï¼Œå…¶å®å¤§éƒ¨åˆ†æ–°å¼•å…¥çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ Copy è¯­ä¹‰å’Œå€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å…¶å®ƒè¯­è¨€ä¸­éƒ½æ˜¯éšå¼å­˜åœ¨çš„ï¼Œåªä¸è¿‡ Rust <strong>æŠŠå®ƒä»¬å®šä¹‰å¾—æ›´æ¸…æ™°ï¼Œæ›´æ˜ç¡®åœ°ç•Œå®šäº†ä½¿ç”¨çš„èŒƒå›´è€Œå·²</strong>ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬æ²¿ç€ä¹‹å‰çš„æ€è·¯ï¼Œå…ˆæ¢³ç†å’Œæ€»ç»“ Rust å†…å­˜ç®¡ç†çš„åŸºæœ¬å†…å®¹ï¼Œç„¶åä»ä¸€ä¸ªå€¼çš„å¥‡å¹»ä¹‹æ—…è®²èµ·ï¼Œçœ‹çœ‹åœ¨å†…å­˜ä¸­ï¼Œä¸€ä¸ªå€¼ï¼Œä»åˆ›å»ºåˆ°æ¶ˆäº¡éƒ½ç»å†äº†ä»€ä¹ˆï¼ŒæŠŠä¹‹å‰è®²çš„èä¼šè´¯é€šã€‚</p><p>åˆ°è¿™é‡Œä½ å¯èƒ½æœ‰ç‚¹ä¸è€çƒ¦äº†å§ï¼Œæ€ä¹ˆä»Šå¤©åˆè¦è®²å†…å­˜çš„çŸ¥è¯†ã€‚å…¶å®æ˜¯å› ä¸ºï¼Œ<strong>å†…å­˜ç®¡ç†æ˜¯ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒ</strong>ï¼Œé‡è¦æ€§å°±åƒæ­¦å­¦ä¸­çš„å†…åŠŸã€‚åªæœ‰å½“æˆ‘ä»¬æŠŠæ•°æ®åœ¨å†…å­˜ä¸­å¦‚ä½•åˆ›å»ºã€å¦‚ä½•å­˜æ”¾ã€å¦‚ä½•é”€æ¯å¼„æ˜ç™½ï¼Œä¹‹åé˜…è¯»ä»£ç ã€åˆ†æé—®é¢˜æ‰ä¼šæœ‰ä¸€ç§æ¸¸åˆƒæœ‰ä½™çš„æ„Ÿè§‰ã€‚</p><h2>å†…å­˜ç®¡ç†</h2><!-- [[[read_end]]] --><p>æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/408409\">ç¬¬ä¸€è®²</a>è¯´è¿‡å †å’Œæ ˆï¼Œå®ƒä»¬æ˜¯ä»£ç ä¸­ä½¿ç”¨å†…å­˜çš„ä¸»è¦åœºåˆã€‚</p><p>æ ˆå†…å­˜â€œåˆ†é…â€å’Œâ€œé‡Šæ”¾â€éƒ½å¾ˆé«˜æ•ˆï¼Œåœ¨ç¼–è¯‘æœŸå°±ç¡®å®šå¥½äº†ï¼Œå› è€Œå®ƒæ— æ³•å®‰å…¨æ‰¿è½½åŠ¨æ€å¤§å°æˆ–è€…ç”Ÿå‘½å‘¨æœŸè¶…å‡ºå¸§å­˜æ´»èŒƒå›´å¤–çš„å€¼ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œæ—¶å¯ä»¥è‡ªç”±æ“æ§çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜ï¼Œæ¥å¼¥è¡¥æ ˆçš„ç¼ºç‚¹ã€‚</p><p>å †å†…å­˜è¶³å¤Ÿçµæ´»ï¼Œç„¶è€Œå †ä¸Šæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸè¯¥å¦‚ä½•ç®¡ç†ï¼Œæˆä¸ºäº†å„é—¨è¯­è¨€çš„å¿ƒå¤´å¤§æ‚£ã€‚</p><p>C é‡‡ç”¨äº†æœªå®šä¹‰çš„æ–¹å¼ï¼Œç”±å¼€å‘è€…æ‰‹å·¥æ§åˆ¶ï¼›C++ åœ¨ C çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼Œå¼•å…¥æ™ºèƒ½æŒ‡é’ˆï¼ŒåŠæ‰‹å·¥åŠè‡ªåŠ¨ã€‚Java å’Œ DotNet ä½¿ç”¨ GC å¯¹å †å†…å­˜å…¨é¢æ¥ç®¡ï¼Œå †å†…å­˜è¿›å…¥äº†å—æ§ï¼ˆmanagedï¼‰æ—¶ä»£ã€‚æ‰€è°“å—æ§ä»£ç ï¼ˆmanaged codeï¼‰ï¼Œå°±æ˜¯ä»£ç åœ¨ä¸€ä¸ªâ€œè¿è¡Œæ—¶â€ä¸‹å·¥ä½œï¼Œç”±è¿è¡Œæ—¶æ¥ä¿è¯å †å†…å­˜çš„å®‰å…¨è®¿é—®ã€‚</p><p>æ•´ä¸ªå †å†…å­˜ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„å‘å±•å²å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src=\"https://static001.geekbang.org/resource/image/c7/d7/c7eec71df0fdc85c905c60ab78db15d7.jpg?wh=3624x1574\" alt=\"\"></p><p>è€ŒRust çš„åˆ›é€ è€…ä»¬ï¼Œé‡æ–°å®¡è§†äº†å †å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸï¼Œå‘ç°<strong>å¤§éƒ¨åˆ†å †å†…å­˜çš„éœ€æ±‚åœ¨äºåŠ¨æ€å¤§å°ï¼Œå°éƒ¨åˆ†éœ€æ±‚æ˜¯æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚æ‰€ä»¥å®ƒé»˜è®¤å°†å †å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸå’Œä½¿ç”¨å®ƒçš„æ ˆå†…å­˜çš„ç”Ÿå‘½å‘¨æœŸç»‘åœ¨ä¸€èµ·ï¼Œå¹¶ç•™äº†ä¸ªå°å£å­ leakedæœºåˆ¶ï¼Œè®©å †å†…å­˜åœ¨éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰è¶…å‡ºå¸§å­˜æ´»æœŸçš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹å›¾çš„å¯¹æ¯”æ€»ç»“ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/e3/b1/e381fa9ab73036480df9c8a182dab4b1.jpg?wh=2562x1394\" alt=\"\"></p><p>æœ‰äº†è¿™äº›åŸºæœ¬çš„è®¤çŸ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹åœ¨å€¼çš„åˆ›å»ºã€ä½¿ç”¨å’Œé”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œ Rust æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ã€‚</p><p>å¸Œæœ›å­¦å®Œä»Šå¤©çš„å†…å®¹ä¹‹åï¼Œçœ‹åˆ°ä¸€ä¸ª Rust çš„æ•°æ®ç»“æ„ï¼Œä½ å°±å¯ä»¥åœ¨è„‘æµ·ä¸­å¤§è‡´æµ®ç°å‡ºï¼Œè¿™ä¸ªæ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼šå“ªäº›å­—æ®µåœ¨æ ˆä¸Šã€å“ªäº›åœ¨å †ä¸Šï¼Œä»¥åŠå®ƒå¤§è‡´çš„å¤§å°ã€‚</p><h2>å€¼çš„åˆ›å»º</h2><p>å½“æˆ‘ä»¬ä¸ºæ•°æ®ç»“æ„åˆ›å»ºä¸€ä¸ªå€¼ï¼Œå¹¶å°†å…¶èµ‹ç»™ä¸€ä¸ªå˜é‡æ—¶ï¼Œæ ¹æ®å€¼çš„æ€§è´¨ï¼Œå®ƒæœ‰å¯èƒ½è¢«åˆ›å»ºåœ¨æ ˆä¸Šï¼Œä¹Ÿæœ‰å¯èƒ½è¢«åˆ›å»ºåœ¨å †ä¸Šã€‚</p><p>ç®€å•å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/408409\">ç¬¬ä¸€</a>ã€<a href=\"https://time.geekbang.org/column/article/410038\">ç¬¬äºŒè®²</a>è¯´è¿‡ï¼Œç†è®ºä¸Šï¼Œç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šå¤§å°çš„å€¼éƒ½ä¼šæ”¾åœ¨æ ˆä¸Šï¼ŒåŒ…æ‹¬ Rust æä¾›çš„åŸç”Ÿç±»å‹æ¯”å¦‚å­—ç¬¦ã€æ•°ç»„ã€å…ƒç»„ï¼ˆtupleï¼‰ç­‰ï¼Œä»¥åŠå¼€å‘è€…è‡ªå®šä¹‰çš„å›ºå®šå¤§å°çš„ç»“æ„ä½“ï¼ˆstructï¼‰ã€æšä¸¾ï¼ˆenumï¼‰ ç­‰ã€‚</p><p>å¦‚æœæ•°æ®ç»“æ„çš„å¤§å°æ— æ³•ç¡®å®šï¼Œæˆ–è€…å®ƒçš„å¤§å°ç¡®å®šä½†æ˜¯åœ¨ä½¿ç”¨æ—¶éœ€è¦æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°±æœ€å¥½æ”¾åœ¨å †ä¸Šã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ struct / enum / vec&lt;T&gt; / String è¿™å‡ ç§é‡è¦çš„æ•°æ®ç»“æ„åœ¨åˆ›å»ºæ—¶çš„å†…å­˜å¸ƒå±€ã€‚</p><h3>struct</h3><p>Rust åœ¨å†…å­˜ä¸­æ’å¸ƒæ•°æ®æ—¶ï¼Œ<strong>ä¼šæ ¹æ®æ¯ä¸ªåŸŸçš„å¯¹é½ï¼ˆaligmentï¼‰å¯¹æ•°æ®è¿›è¡Œé‡æ’</strong>ï¼Œä½¿å…¶å†…å­˜å¤§å°å’Œè®¿é—®æ•ˆç‡æœ€å¥½ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåŒ…å« Aã€Bã€C ä¸‰ä¸ªåŸŸçš„ structï¼Œå®ƒåœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯èƒ½æ˜¯ Aã€Cã€Bï¼š<img src=\"https://static001.geekbang.org/resource/image/0a/c4/0a1151168af2a19a23f8db16df101cc4.jpg?wh=2483x979\" alt=\"\"></p><p>ä¸ºä»€ä¹ˆ Rust ç¼–è¯‘å™¨ä¼šè¿™ä¹ˆåšå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ C è¯­è¨€åœ¨å†…å­˜ä¸­è¡¨è¿°ä¸€ä¸ªç»“æ„ä½“æ—¶é‡åˆ°çš„é—®é¢˜ã€‚æ¥å†™ä¸€æ®µä»£ç ï¼Œå…¶ä¸­ä¸¤ä¸ªæ•°æ®ç»“æ„ S1 å’Œ S2 éƒ½æœ‰ä¸‰ä¸ªåŸŸ aã€bã€cï¼Œå…¶ä¸­ a å’Œ c æ˜¯ u8ï¼Œå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œb æ˜¯ u16ï¼Œå ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚S1 åœ¨å®šä¹‰æ—¶é¡ºåºæ˜¯ aã€bã€cï¼Œè€Œ S2 åœ¨å®šä¹‰æ—¶é¡ºåºæ˜¯ aã€cã€bï¼š</p><p>çŒœçŒœçœ‹ S1 å’Œ S2 çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿ</p><pre><code class=\"language-c++\">#include &lt;stdio.h&gt;\n\nstruct S1 {\n    u_int8_t a;\n    u_int16_t b;\n    u_int8_t c;\n};\n\nstruct S2 {\n    u_int8_t a;\n    u_int8_t c;\n    u_int16_t b;\n};\n\nvoid main() {\n    printf(\"size of S1: %d, S2: %d\", sizeof(struct S1), sizeof(struct S2));\n    }\n</code></pre><p>æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š6 å’Œ 4ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜æ˜åªç”¨äº† 4 ä¸ªå­—èŠ‚ï¼ŒS1 çš„å¤§å°å´æ˜¯ 6 å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º CPU åœ¨åŠ è½½ä¸å¯¹é½çš„å†…å­˜æ—¶ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ï¼Œæ‰€ä»¥<strong>è¦é¿å…ç”¨æˆ·å®šä¹‰ä¸å¯¹é½çš„æ•°æ®ç»“æ„æ—¶ï¼Œé€ æˆçš„æ€§èƒ½å½±å“</strong>ã€‚</p><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒC è¯­è¨€ä¼šå¯¹ç»“æ„ä½“ä¼šåšè¿™æ ·çš„å¤„ç†ï¼š</p><ol>\n<li>é¦–å…ˆç¡®å®šæ¯ä¸ªåŸŸçš„é•¿åº¦å’Œå¯¹é½é•¿åº¦ï¼ŒåŸå§‹ç±»å‹çš„å¯¹é½é•¿åº¦å’Œç±»å‹çš„é•¿åº¦ä¸€è‡´ã€‚</li>\n<li>æ¯ä¸ªåŸŸçš„èµ·å§‹ä½ç½®è¦å’Œå…¶å¯¹é½é•¿åº¦å¯¹é½ï¼Œå¦‚æœæ— æ³•å¯¹é½ï¼Œåˆ™æ·»åŠ  padding ç›´è‡³å¯¹é½ã€‚</li>\n<li>ç»“æ„ä½“çš„å¯¹é½å¤§å°å’Œå…¶æœ€å¤§åŸŸçš„å¯¹é½å¤§å°ç›¸åŒï¼Œè€Œç»“æ„ä½“çš„é•¿åº¦åˆ™å››èˆäº”å…¥åˆ°å…¶å¯¹é½çš„å€æ•°ã€‚</li>\n</ol><p>å­—é¢ä¸Šçœ‹è¿™ä¸‰æ¡è§„åˆ™ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—åƒç»•å£ä»¤ï¼Œåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬ç»“åˆåˆšæ‰çš„ä»£ç å†æ¥çœ‹ï¼Œå…¶å®å¾ˆå®¹æ˜“ç†è§£ã€‚</p><p>å¯¹äº S1ï¼Œå­—æ®µ a æ˜¯ u8 ç±»å‹ï¼Œæ‰€ä»¥å…¶é•¿åº¦å’Œå¯¹é½éƒ½æ˜¯ 1ï¼Œb æ˜¯ u16ï¼Œå…¶é•¿åº¦å’Œå¯¹é½æ˜¯ 2ã€‚ç„¶è€Œå› ä¸º a åªå äº†ä¸€ä¸ªå­—èŠ‚ï¼Œb çš„åç§»æ˜¯ 1ï¼Œæ ¹æ®ç¬¬äºŒæ¡è§„åˆ™ï¼Œèµ·å§‹ä½ç½®å’Œ b çš„é•¿åº¦æ— æ³•å¯¹é½ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šæ·»åŠ ä¸€ä¸ªå­—èŠ‚çš„ paddingï¼Œè®© b çš„åç§»ä¸º 2ï¼Œè¿™æ · b å°±å¯¹é½äº†ã€‚<img src=\"https://static001.geekbang.org/resource/image/f7/37/f724ce693e12745d7ba976044e5aa937.jpg?wh=2956x1113\" alt=\"\"></p><p>éšå c é•¿åº¦å’Œå¯¹é½éƒ½æ˜¯ 1ï¼Œä¸éœ€è¦ paddingã€‚è¿™æ ·ç®—ä¸‹æ¥ï¼ŒS1 çš„å¤§å°æ˜¯ 5ï¼Œä½†æ ¹æ®ä¸Šé¢çš„ç¬¬ä¸‰æ¡è§„åˆ™ï¼ŒS1 çš„å¯¹é½æ˜¯ 2ï¼Œå’Œ 5 æœ€æ¥è¿‘çš„â€œ2 çš„å€æ•°â€æ˜¯ 6ï¼Œæ‰€ä»¥ S1 æœ€ç»ˆçš„é•¿åº¦æ˜¯ 6ã€‚å…¶å®ï¼Œè¿™æœ€åä¸€æ¡è§„åˆ™æ˜¯ä¸ºäº†è®© S1 æ”¾åœ¨æ•°ç»„ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆå¯¹é½ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœç»“æ„ä½“çš„å®šä¹‰è€ƒè™‘åœ°ä¸å¤Ÿå‘¨å…¨ï¼Œä¼šä¸ºäº†å¯¹é½æµªè´¹å¾ˆå¤šç©ºé—´</strong>ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œä¿å­˜åŒæ ·çš„æ•°æ®ï¼ŒS1 å’Œ S2 çš„å¤§å°ç›¸å·®äº† 50%ã€‚</p><p>ä½¿ç”¨ C è¯­è¨€æ—¶ï¼Œå®šä¹‰ç»“æ„ä½“çš„æœ€ä½³å®è·µæ˜¯ï¼Œå……åˆ†è€ƒè™‘æ¯ä¸€ä¸ªåŸŸçš„å¯¹é½ï¼Œåˆç†åœ°æ’åˆ—å®ƒä»¬ï¼Œä½¿å…¶å†…å­˜ä½¿ç”¨æœ€é«˜æ•ˆã€‚è¿™ä¸ªå·¥ä½œç”±å¼€å‘è€…åšä¼šå¾ˆè´¹åŠ²ï¼Œå°¤å…¶æ˜¯åµŒå¥—çš„ç»“æ„ä½“ï¼Œéœ€è¦ä»”ç»†åœ°è®¡ç®—æ‰èƒ½å¾—åˆ°æœ€ä¼˜è§£ã€‚</p><p>è€Œ Rust ç¼–è¯‘å™¨æ›¿æˆ‘ä»¬è‡ªåŠ¨å®Œæˆäº†è¿™ä¸ªä¼˜åŒ–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Rust ä¼šè‡ªåŠ¨é‡æ’ä½ å®šä¹‰çš„ç»“æ„ä½“ï¼Œæ¥è¾¾åˆ°æœ€é«˜æ•ˆç‡ã€‚æˆ‘ä»¬çœ‹åŒæ ·çš„ä»£ç ï¼Œåœ¨ Rust ä¸‹ï¼ŒS1 å’Œ S2 å¤§å°éƒ½æ˜¯ 4ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=c82908a73aedc9b0d8ac2be0b43f6f6d\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::mem::{align_of, size_of};\n\nstruct S1 {\n    a: u8,\n    b: u16,\n    c: u8,\n}\n\nstruct S2 {\n    a: u8,\n    c: u8,\n    b: u16,\n}\n\nfn main() {\n    println!(\"sizeof S1: {}, S2: {}\", size_of::&lt;S1&gt;(), size_of::&lt;S2&gt;());\n    println!(\"alignof S1: {}, S2: {}\", align_of::&lt;S1&gt;(), align_of::&lt;S2&gt;());\n}\n</code></pre><p>ä½ ä¹Ÿå¯ä»¥çœ‹è¿™å¼ å›¾æ¥ç›´è§‚å¯¹æ¯”ï¼Œ C å’Œ Rust çš„è¡Œä¸ºï¼š<img src=\"https://static001.geekbang.org/resource/image/3d/42/3db1a2ccebf936aa10d9c1bd7fcf8a42.jpg?wh=3612x2093\" alt=\"\"></p><p>è™½ç„¶ï¼ŒRust ç¼–è¯‘å™¨é»˜è®¤ä¸ºå¼€å‘è€…ä¼˜åŒ–ç»“æ„ä½“çš„æ’åˆ—ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>#[repr]</code> å®ï¼Œå¼ºåˆ¶è®© Rust ç¼–è¯‘å™¨ä¸åšä¼˜åŒ–ï¼Œå’Œ C çš„è¡Œä¸ºä¸€è‡´ï¼Œè¿™æ ·ï¼ŒRust ä»£ç å¯ä»¥æ–¹ä¾¿åœ°å’Œ C ä»£ç æ— ç¼äº¤äº’ã€‚</p><p>åœ¨æ˜ç™½äº† Rust ä¸‹ struct çš„å¸ƒå±€åï¼ˆ tuple ç±»ä¼¼ï¼‰ï¼Œæˆ‘ä»¬çœ‹çœ‹ enum ã€‚</p><h3>enum</h3><p>enum æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œåœ¨ Rust ä¸‹å®ƒæ˜¯ä¸€ä¸ªæ ‡ç­¾è”åˆä½“ï¼ˆtagged unionï¼‰ï¼Œå®ƒçš„å¤§å°æ˜¯æ ‡ç­¾çš„å¤§å°ï¼ŒåŠ ä¸Šæœ€å¤§ç±»å‹çš„é•¿åº¦ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/411632\">ç¬¬ä¸‰è®²</a>åŸºç¡€è¯­æ³•ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ enum æ•°æ®ç»“æ„æ—¶ï¼Œç®€å•æåˆ°æœ‰ Option&lt;T&gt; å’Œ Result&lt;T, E&gt; ä¸¤ç§è®¾è®¡ä¸¾ä¾‹ï¼Œ Option æ˜¯æœ‰å€¼/æ— å€¼è¿™ç§æœ€ç®€å•çš„æšä¸¾ç±»å‹ï¼ŒResult åŒ…æ‹¬æˆåŠŸè¿”å›æ•°æ®å’Œé”™è¯¯è¿”å›æ•°æ®çš„æšä¸¾ç±»å‹ï¼Œåé¢ä¼šè¯¦ç»†è®²åˆ°ã€‚è¿™é‡Œæˆ‘ä»¬ç†è§£å…¶å†…å­˜è®¾è®¡å°±å¯ä»¥äº†ã€‚</p><p>æ ¹æ®åˆšæ‰è¯´çš„ä¸‰æ¡å¯¹é½è§„åˆ™ï¼Œtag åçš„å†…å­˜ï¼Œä¼šæ ¹æ®å…¶å¯¹é½å¤§å°è¿›è¡Œå¯¹é½ï¼Œæ‰€ä»¥å¯¹äº Option&lt;u8&gt;ï¼Œå…¶é•¿åº¦æ˜¯ 1 + 1 = 2 å­—èŠ‚ï¼Œè€Œ Option&lt;f64&gt;ï¼Œé•¿åº¦æ˜¯ 8 + 8 =16 å­—èŠ‚ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œ64 ä½ CPU ä¸‹ï¼Œenum çš„æœ€å¤§é•¿åº¦æ˜¯ï¼šæœ€å¤§ç±»å‹çš„é•¿åº¦ + 8ï¼Œå› ä¸º 64 ä½ CPU çš„æœ€å¤§å¯¹é½æ˜¯ 64bitï¼Œä¹Ÿå°±æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº† enumã€Option&lt;T&gt;ä»¥åŠResult&lt;T, E&gt; çš„å¸ƒå±€ï¼š<img src=\"https://static001.geekbang.org/resource/image/f2/82/f22b2700de556385efbc44f04dd6b982.jpg?wh=2956x996\" alt=\"\"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRust ç¼–è¯‘å™¨ä¼šå¯¹ enum åšä¸€äº›é¢å¤–çš„ä¼˜åŒ–ï¼Œè®©æŸäº›å¸¸ç”¨ç»“æ„çš„å†…å­˜å¸ƒå±€æ›´ç´§å‡‘ã€‚æˆ‘ä»¬å…ˆæ¥å†™ä¸€æ®µä»£ç ï¼Œå¸®ä½ æ›´å¥½åœ°äº†è§£ä¸åŒæ•°æ®ç»“æ„å ç”¨çš„å¤§å°ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=34c66e50a56c5e4bb3a3dd97c3a90358\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::collections::HashMap;\nuse std::mem::size_of;\n\nenum E {\n    A(f64),\n    B(HashMap&lt;String, String&gt;),\n    C(Result&lt;Vec&lt;u8&gt;, String&gt;),\n}\n\n// è¿™æ˜¯ä¸€ä¸ªå£°æ˜å®ï¼Œå®ƒä¼šæ‰“å°å„ç§æ•°æ®ç»“æ„æœ¬èº«çš„å¤§å°ï¼Œåœ¨ Option ä¸­çš„å¤§å°ï¼Œä»¥åŠåœ¨ Result ä¸­çš„å¤§å°\nmacro_rules! show_size {\n    (header) =&gt; {\n        println!(\n            \"{:&lt;24} {:&gt;4}    {}    {}\",\n            \"Type\", \"T\", \"Option&lt;T&gt;\", \"Result&lt;T, io::Error&gt;\"\n        );\n        println!(\"{}\", \"-\".repeat(64));\n    };\n    ($t:ty) =&gt; {\n        println!(\n            \"{:&lt;24} {:4} {:8} {:12}\",\n            stringify!($t),\n            size_of::&lt;$t&gt;(),\n            size_of::&lt;Option&lt;$t&gt;&gt;(),\n            size_of::&lt;Result&lt;$t, std::io::Error&gt;&gt;(),\n        )\n    };\n}\n\nfn main() {\n    show_size!(header);\n    show_size!(u8);\n    show_size!(f64);\n    show_size!(&amp;u8);\n    show_size!(Box&lt;u8&gt;);\n    show_size!(&amp;[u8]);\n\n    show_size!(String);\n    show_size!(Vec&lt;u8&gt;);\n    show_size!(HashMap&lt;String, String&gt;);\n    show_size!(E);\n}\n</code></pre><p>è¿™æ®µä»£ç åŒ…å«äº†ä¸€ä¸ªå£°æ˜å®ï¼ˆdeclarative macroï¼‰show_sizeï¼Œæˆ‘ä»¬å…ˆä¸å¿…ç®¡å®ƒã€‚è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šå‘ç°ï¼ŒOption é…åˆå¸¦æœ‰å¼•ç”¨ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ &amp;u8ã€Boxã€Vecã€HashMap ï¼Œ<strong>æ²¡æœ‰é¢å¤–å ç”¨ç©ºé—´</strong>ï¼Œè¿™å°±å¾ˆæœ‰æ„æ€äº†ã€‚</p><pre><code class=\"language-plain\">Type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; T&nbsp; &nbsp; Option&lt;T&gt;&nbsp; &nbsp; Result&lt;T, io::Error&gt;\n----------------------------------------------------------------\nu8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24\nf64&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8&nbsp; &nbsp; &nbsp; &nbsp;16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24\n&amp;u8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8&nbsp; &nbsp; &nbsp; &nbsp; 8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24\nBox&lt;u8&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8&nbsp; &nbsp; &nbsp; &nbsp; 8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24\n&amp;[u8]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16&nbsp; &nbsp; &nbsp; &nbsp;16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24\nString&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24&nbsp; &nbsp; &nbsp; &nbsp;24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32\nVec&lt;u8&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24&nbsp; &nbsp; &nbsp; &nbsp;24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32\nHashMap&lt;String, String&gt;&nbsp; &nbsp; 48&nbsp; &nbsp; &nbsp; &nbsp;48&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;56\nE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 56&nbsp; &nbsp; &nbsp; &nbsp;56&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;64\n</code></pre><p>å¯¹äº Option ç»“æ„è€Œè¨€ï¼Œå®ƒçš„ tag åªæœ‰ä¸¤ç§æƒ…å†µï¼š0 æˆ– 1ï¼Œ tag ä¸º 0 æ—¶ï¼Œè¡¨ç¤º Noneï¼Œtag ä¸º 1 æ—¶ï¼Œè¡¨ç¤º Someã€‚</p><p>æ­£å¸¸æ¥è¯´ï¼Œå½“æˆ‘ä»¬æŠŠå®ƒå’Œä¸€ä¸ªå¼•ç”¨æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œè™½ç„¶ tag åªå  1 ä¸ª bitï¼Œä½† 64 ä½ CPU ä¸‹ï¼Œå¼•ç”¨ç»“æ„çš„å¯¹é½æ˜¯ 8ï¼Œæ‰€ä»¥å®ƒè‡ªå·±åŠ ä¸Šé¢å¤–çš„ paddingï¼Œä¼šå æ® 8 ä¸ªå­—èŠ‚ï¼Œä¸€å…±16å­—èŠ‚ï¼Œè¿™éå¸¸æµªè´¹å†…å­˜ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>Rust æ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¼•ç”¨ç±»å‹çš„ç¬¬ä¸€ä¸ªåŸŸæ˜¯ä¸ªæŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆæ˜¯ä¸å¯èƒ½ç­‰äº 0 çš„ï¼Œä½†æ˜¯æˆ‘ä»¬<strong>å¯ä»¥å¤ç”¨è¿™ä¸ªæŒ‡é’ˆï¼šå½“å…¶ä¸º 0 æ—¶ï¼Œè¡¨ç¤º Noneï¼Œå¦åˆ™æ˜¯ Some</strong>ï¼Œå‡å°‘äº†å†…å­˜å ç”¨ï¼Œè¿™æ˜¯ä¸ªéå¸¸å·§å¦™çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ã€‚</p><h3>vec&lt;T&gt; å’Œ String</h3><p>ä»åˆšæ‰ä»£ç çš„ç»“æœä¸­ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ° String å’Œ Vec&lt;u8&gt; å ç”¨ç›¸åŒçš„å¤§å°ï¼Œéƒ½æ˜¯ 24 ä¸ªå­—èŠ‚ã€‚å…¶å®ï¼Œå¦‚æœä½ æ‰“å¼€ String ç»“æ„çš„<a href=\"https://doc.rust-lang.org/src/alloc/string.rs.html#279-281\">æºç </a>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå®ƒå†…éƒ¨å°±æ˜¯ä¸€ä¸ª Vec&lt;u8&gt;ã€‚</p><p>è€Œ <a href=\"https://doc.rust-lang.org/src/alloc/vec/mod.rs.html#294-302\">Vec&lt;T&gt;ç»“æ„</a>æ˜¯ 3 ä¸ª word çš„èƒ–æŒ‡é’ˆï¼ŒåŒ…å«ï¼šä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆpointerã€åˆ†é…çš„å †å†…å­˜çš„å®¹é‡capacityï¼Œä»¥åŠæ•°æ®åœ¨å †å†…å­˜çš„é•¿åº¦lengthï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src=\"https://static001.geekbang.org/resource/image/c2/37/c2234ab79c2eaf2c76698c8f11b24d37.jpg?wh=2368x977\" alt=\"\"></p><p>å¾ˆå¤šåŠ¨æ€å¤§å°çš„æ•°æ®ç»“æ„ï¼Œåœ¨åˆ›å»ºæ—¶éƒ½æœ‰ç±»ä¼¼çš„å†…å­˜å¸ƒå±€ï¼š<strong>æ ˆå†…å­˜æ”¾çš„èƒ–æŒ‡é’ˆï¼ŒæŒ‡å‘å †å†…å­˜åˆ†é…å‡ºæ¥çš„æ•°æ®</strong>ï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„ Rc ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å…³äºå€¼åœ¨åˆ›å»ºæ—¶çš„å†…å­˜å¸ƒå±€ï¼Œä»Šå¤©å°±å…ˆè®²è¿™ä¹ˆå¤šã€‚å¦‚æœä½ å¯¹å…¶å®ƒæ•°æ®ç»“æ„çš„å†…å­˜å¸ƒå±€æ„Ÿå…´è¶£ï¼Œå¯ä»¥è®¿é—® <a href=\"https://cheats.rs/#data-layout\">cheats.rs</a>ï¼Œå®ƒæ˜¯ Rust è¯­è¨€çš„å¤‡å¿˜æ¸…å•ï¼Œéå¸¸é€‚åˆéšæ—¶ç¿»é˜…ã€‚æ¯”å¦‚ï¼Œå¼•ç”¨ç±»å‹çš„å†…å­˜å¸ƒå±€ï¼š<img src=\"https://static001.geekbang.org/resource/image/98/a5/98e80265d8fbe77a9c6e53df22efafa5.png?wh=1640x402\" alt=\"\"></p><p>ç°åœ¨ï¼Œå€¼å·²ç»åˆ›å»ºæˆåŠŸäº†ï¼Œæˆ‘ä»¬å¯¹å®ƒçš„å†…å­˜å¸ƒå±€æœ‰äº†è¶³å¤Ÿçš„è®¤è¯†ã€‚é‚£åœ¨ä½¿ç”¨æœŸé—´ï¼Œå®ƒçš„å†…å­˜ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„å˜åŒ–å‘¢ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ã€‚</p><h2>å€¼çš„ä½¿ç”¨</h2><p>åœ¨è®²æ‰€æœ‰æƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œå¯¹ Rust è€Œè¨€ï¼Œä¸€ä¸ªå€¼å¦‚æœæ²¡æœ‰å®ç° Copyï¼Œåœ¨èµ‹å€¼ã€ä¼ å‚ä»¥åŠå‡½æ•°è¿”å›æ—¶ä¼šè¢« Moveã€‚</p><p><strong>å…¶å® Copy å’Œ Move åœ¨å†…éƒ¨å®ç°ä¸Šï¼Œéƒ½æ˜¯æµ…å±‚çš„æŒ‰ä½åšå†…å­˜å¤åˆ¶</strong>ï¼Œåªä¸è¿‡ Copy å…è®¸ä½ è®¿é—®ä¹‹å‰çš„å˜é‡ï¼Œè€Œ Move ä¸å…è®¸ã€‚æˆ‘ä»¬çœ‹å›¾ï¼š<img src=\"https://static001.geekbang.org/resource/image/4a/55/4a0fd813e6722c9efef3c8be91b3d155.jpg?wh=2547x1578\" alt=\"\"></p><p>åœ¨æˆ‘ä»¬çš„è®¤çŸ¥ä¸­ï¼Œå†…å­˜å¤åˆ¶æ˜¯ä¸ªå¾ˆé‡çš„æ“ä½œï¼Œæ•ˆç‡å¾ˆä½ã€‚ç¡®å®æ˜¯è¿™æ ·ï¼Œå¦‚æœä½ çš„å…³é”®è·¯å¾„ä¸­çš„æ¯æ¬¡è°ƒç”¨ï¼Œéƒ½è¦å¤åˆ¶å‡ ç™¾ k çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§æ•°ç»„ï¼Œæ˜¯å¾ˆä½æ•ˆçš„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ è¦å¤åˆ¶çš„åªæ˜¯åŸç”Ÿç±»å‹ï¼ˆCopyï¼‰æˆ–è€…æ ˆä¸Šçš„èƒ–æŒ‡é’ˆï¼ˆMoveï¼‰ï¼Œä¸æ¶‰åŠå †å†…å­˜çš„å¤åˆ¶ä¹Ÿå°±æ˜¯æ·±æ‹·è´ï¼ˆdeep copyï¼‰ï¼Œé‚£è¿™ä¸ªæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ¯æ¬¡èµ‹å€¼æˆ–è€…æ¯æ¬¡ä¼ å‚å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><p>æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ Copy è¿˜æ˜¯ Moveï¼Œå®ƒçš„æ•ˆç‡éƒ½æ˜¯éå¸¸é«˜çš„ã€‚</p><p>ä¸è¿‡ä¹Ÿæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œè¦è¯´æ˜ï¼šå¯¹æ ˆä¸Šçš„å¤§æ•°ç»„ä¼ å‚ï¼Œç”±äºéœ€è¦å¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œä¼šå½±å“æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æˆ‘ä»¬<strong>å»ºè®®åœ¨æ ˆä¸Šä¸è¦æ”¾å¤§æ•°ç»„</strong>ï¼Œå¦‚æœå®åœ¨éœ€è¦ï¼Œé‚£ä¹ˆä¼ é€’è¿™ä¸ªæ•°ç»„æ—¶ï¼Œæœ€å¥½ç”¨ä¼ å¼•ç”¨è€Œä¸æ˜¯ä¼ å€¼ã€‚</p><p>åœ¨ä½¿ç”¨å€¼çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº† Moveï¼Œä½ è¿˜éœ€è¦æ³¨æ„å€¼çš„åŠ¨æ€å¢é•¿ã€‚å› ä¸ºRust ä¸‹ï¼Œé›†åˆç±»å‹çš„æ•°æ®ç»“æ„ï¼Œéƒ½ä¼šåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨æ‰©å±•ã€‚</p><p>ä»¥ä¸€ä¸ª Vec&lt;T&gt; ä¸ºä¾‹ï¼Œå½“ä½ ä½¿ç”¨å®Œå †å†…å­˜ç›®å‰çš„å®¹é‡åï¼Œè¿˜ç»§ç»­æ·»åŠ æ–°çš„å†…å®¹ï¼Œå°±ä¼šè§¦å‘å †å†…å­˜çš„è‡ªåŠ¨å¢é•¿ã€‚æœ‰æ—¶å€™ï¼Œé›†åˆç±»å‹é‡Œçš„æ•°æ®ä¸æ–­è¿›è¿›å‡ºå‡ºï¼Œå¯¼è‡´é›†åˆä¸€ç›´å¢é•¿ï¼Œä½†åªä½¿ç”¨äº†å¾ˆå°éƒ¨åˆ†çš„å®¹é‡ï¼Œå†…å­˜çš„ä½¿ç”¨æ•ˆç‡å¾ˆä½ï¼Œæ‰€ä»¥ä½ è¦è€ƒè™‘ä½¿ç”¨ï¼Œæ¯”å¦‚  <code>shrink_to_fit</code> æ–¹æ³•ï¼Œæ¥èŠ‚çº¦å¯¹å†…å­˜çš„ä½¿ç”¨ã€‚</p><h2>å€¼çš„é”€æ¯</h2><p>å¥½ï¼Œè¿™ä¸ªå€¼çš„æ—…ç¨‹å·²ç»è¿‡åŠï¼Œåˆ›å»ºå’Œä½¿ç”¨éƒ½å·²ç»è®²å®Œäº†ï¼Œæœ€åæˆ‘ä»¬è°ˆè°ˆå€¼çš„é”€æ¯ã€‚</p><p>ä¹‹å‰ç¬¼ç»Ÿåœ°è°ˆåˆ°ï¼Œå½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒæ‹¥æœ‰çš„å€¼ä¼šè¢«ä¸¢å¼ƒã€‚é‚£ä»ä»£ç å±‚é¢è®²ï¼ŒRust åˆ°åº•æ˜¯å¦‚ä½•ä¸¢å¼ƒçš„å‘¢ï¼Ÿ</p><p>è¿™é‡Œç”¨åˆ°äº† Drop traitã€‚Drop trait ç±»ä¼¼é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ææ„å‡½æ•°ï¼Œ<strong>å½“ä¸€ä¸ªå€¼è¦è¢«é‡Šæ”¾ï¼Œå®ƒçš„ Drop trait ä¼šè¢«è°ƒç”¨</strong>ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå˜é‡ greeting æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨é€€å‡ºä½œç”¨åŸŸæ—¶ï¼Œå…¶ drop() å‡½æ•°è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œé‡Šæ”¾å †ä¸ŠåŒ…å« â€œhello worldâ€ çš„å†…å­˜ï¼Œç„¶åå†é‡Šæ”¾æ ˆä¸Šçš„å†…å­˜ï¼š<img src=\"https://static001.geekbang.org/resource/image/0c/ae/0c0d83776e12a099453c837c997d93ae.jpg?wh=2170x1207\" alt=\"\"></p><p>å¦‚æœè¦é‡Šæ”¾çš„å€¼æ˜¯ä¸€ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ä¸€ä¸ªç»“æ„ä½“ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æ„ä½“åœ¨è°ƒç”¨ drop() æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨æ¯ä¸€ä¸ªåŸŸçš„ drop() å‡½æ•°ï¼Œå¦‚æœåŸŸåˆæ˜¯ä¸€ä¸ªå¤æ‚çš„ç»“æ„æˆ–è€…é›†åˆç±»å‹ï¼Œå°±ä¼šé€’å½’ä¸‹å»ï¼Œç›´åˆ°æ¯ä¸€ä¸ªåŸŸéƒ½é‡Šæ”¾å¹²å‡€ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹è¿™ä¸ªä¾‹å­ï¼š<img src=\"https://static001.geekbang.org/resource/image/b8/94/b80ec8eac77944512626bdfc3byy0094.jpg?wh=2170x1207\" alt=\"\"></p><p>ä»£ç ä¸­çš„ student å˜é‡æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæœ‰ nameã€ageã€scoresã€‚å…¶ä¸­ name æ˜¯ Stringï¼Œscores æ˜¯ HashMapï¼Œå®ƒä»¬æœ¬èº«éœ€è¦é¢å¤– drop()ã€‚åˆå› ä¸º HashMap çš„ key æ˜¯ Stringï¼Œæ‰€ä»¥è¿˜éœ€è¦è¿›ä¸€æ­¥è°ƒç”¨è¿™äº› key çš„ drop()ã€‚æ•´ä¸ªé‡Šæ”¾é¡ºåºä»å†…åˆ°å¤–æ˜¯ï¼šå…ˆé‡Šæ”¾ HashMap ä¸‹çš„ keyï¼Œç„¶åé‡Šæ”¾ HashMap å †ä¸Šçš„è¡¨ç»“æ„ï¼Œæœ€åé‡Šæ”¾æ ˆä¸Šçš„å†…å­˜ã€‚</p><h3>å †å†…å­˜é‡Šæ”¾</h3><p>æ‰€æœ‰æƒæœºåˆ¶è§„å®šäº†ï¼Œä¸€ä¸ªå€¼åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œæ‰€ä»¥åœ¨é‡Šæ”¾å †å†…å­˜çš„æ—¶å€™ï¼Œæ•´ä¸ªè¿‡ç¨‹ç®€å•æ¸…æ™°ï¼Œå°±æ˜¯å•çº¯è°ƒç”¨ Drop traitï¼Œä¸éœ€è¦æœ‰å…¶ä»–é¡¾è™‘ã€‚è¿™ç§å¯¹å€¼å®‰å…¨ï¼Œä¹Ÿæ²¡æœ‰é¢å¤–è´Ÿæ‹…çš„é‡Šæ”¾èƒ½åŠ›ï¼Œæ˜¯ Rust ç‹¬æœ‰çš„ã€‚</p><p>æˆ‘è§‰å¾— Rust åœ¨å†…å­˜ç®¡ç†æ–¹é¢çš„è®¾è®¡ç‰¹åˆ«åƒèšç¾¤ã€‚åœ¨èšç¾¤ä¸­ï¼Œæ¯ä¸ªä¸ªä½“çš„è¡Œä¸ºéƒ½éµå¾ªç€éå¸¸ç®€å•æ­»æ¿çš„è§„èŒƒï¼Œæœ€ç»ˆï¼Œ<strong>å¤§é‡ç®€å•çš„ä¸ªä½“èƒ½æ„é€ å‡ºä¸€ä¸ªé«˜æ•ˆä¸”ä¸å‡ºé”™çš„ç³»ç»Ÿ</strong>ã€‚</p><p>åè§‚å…¶å®ƒè¯­è¨€ï¼Œæ¯ä¸ªä¸ªä½“æˆ–è€…è¯´å€¼ï¼Œéƒ½éå¸¸çµæ´»ï¼Œå¼•ç”¨ä¼ æ¥ä¼ å»ï¼Œæœ€ç»ˆå´æ„é€ å‡ºæ¥ä¸€ä¸ªå¾ˆéš¾åˆ†æçš„å¤æ‚ç³»ç»Ÿã€‚å•é ç¼–è¯‘å™¨æ— æ³•å†³å®šï¼Œæ¯ä¸ªå€¼åœ¨å„ä¸ªä½œç”¨åŸŸä¸­ç©¶ç«Ÿèƒ½ä¸èƒ½å®‰å…¨åœ°é‡Šæ”¾ï¼Œå¯¼è‡´ç³»ç»Ÿï¼Œè¦ä¹ˆåƒ C/C++ ä¸€æ ·å°†è¿™ä¸ªé‡æ‹…éƒ¨åˆ†æˆ–è€…å…¨éƒ¨åœ°äº¤ç»™å¼€å‘è€…ï¼Œè¦ä¹ˆåƒ Java é‚£æ ·æ„å»ºå¦ä¸€ä¸ªç³»ç»Ÿæ¥ä¸“é—¨åº”å¯¹å†…å­˜å®‰å…¨é‡Šæ”¾çš„é—®é¢˜ã€‚</p><p>åœ¨Rusté‡Œï¼Œä½ è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å®ç°è‡ªå·±çš„ Drop traitï¼Œç¼–è¯‘å™¨ç¼ºçœçš„è¡Œä¸ºå°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è‡ªå·±æ§åˆ¶ drop è¡Œä¸ºï¼Œä½ ä¹Ÿå¯ä»¥ä¸ºè¿™äº›æ•°æ®ç»“æ„å®ç°å®ƒã€‚</p><p>å¦‚æœä½ å®šä¹‰çš„ drop() å‡½æ•°å’Œç³»ç»Ÿè‡ªå®šä¹‰çš„ drop() å‡½æ•°éƒ½ drop() æŸä¸ªåŸŸï¼ŒRust ç¼–è¯‘å™¨ä¼šç¡®ä¿ï¼Œè¿™ä¸ªåŸŸåªä¼šè¢« drop ä¸€æ¬¡ã€‚è‡³äº Drop trait æ€ä¹ˆå®ç°ã€æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ã€ä»€ä¹ˆåœºåˆä¸‹éœ€è¦è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬åœ¨åç»­çš„è¯¾ç¨‹ä¸­ä¼šå†è¯¦ç»†å±•å¼€ã€‚</p><h3>é‡Šæ”¾å…¶ä»–èµ„æº</h3><p>æˆ‘ä»¬åˆšæ‰è®² Rust çš„ Drop trait ä¸»è¦æ˜¯ä¸ºäº†åº”å¯¹å †å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œå…¶å®ï¼Œå®ƒè¿˜å¯ä»¥é‡Šæ”¾ä»»ä½•èµ„æºï¼Œæ¯”å¦‚ socketã€æ–‡ä»¶ã€é”ç­‰ç­‰ã€‚Rust å¯¹æ‰€æœ‰çš„èµ„æºéƒ½æœ‰å¾ˆå¥½çš„ <a href=\"https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization\">RAII æ”¯æŒ</a>ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ fileï¼Œå¾€é‡Œé¢å†™å…¥ â€œhello worldâ€ï¼Œå½“ file ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¸ä½†å®ƒçš„å†…å­˜ä¼šè¢«é‡Šæ”¾ï¼Œå®ƒå ç”¨çš„èµ„æºã€æ“ä½œç³»ç»Ÿæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ä¼šè‡ªåŠ¨è¢«å…³é—­ã€‚ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f24400d9341994809c8e568d4a54fc62\">ä»£ç </a>ï¼‰</p><pre><code class=\"language-rust\">use std::fs::File;\nuse std::io::prelude::*;\nfn main() -&gt; std::io::Result&lt;()&gt; {\n    let mut file = File::create(\"foo.txt\")?;\n    file.write_all(b\"hello world\")?;\n    Ok(())\n}\n</code></pre><p>åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œæ— è®º Javaã€Python è¿˜æ˜¯ Golangï¼Œä½ éƒ½éœ€è¦æ˜¾å¼åœ°å…³é—­æ–‡ä»¶ï¼Œé¿å…èµ„æºçš„æ³„éœ²ã€‚è¿™æ˜¯å› ä¸ºï¼Œå³ä¾¿ GC èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æœ€ç»ˆé‡Šæ”¾ä¸å†å¼•ç”¨çš„å†…å­˜ï¼Œå®ƒå¹¶ä¸èƒ½é‡Šæ”¾é™¤å†…å­˜å¤–çš„å…¶å®ƒèµ„æºã€‚</p><p>è€Œ Rustï¼Œå†ä¸€æ¬¡åœ°ï¼Œå› ä¸ºå…¶æ¸…æ™°çš„æ‰€æœ‰æƒç•Œå®šï¼Œä½¿ç¼–è¯‘å™¨æ¸…æ¥šåœ°çŸ¥é“ï¼šå½“ä¸€ä¸ªå€¼ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¸ä¼šæœ‰ä»»ä½•äººå¼•ç”¨ï¼Œå®ƒå ç”¨çš„ä»»ä½•èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜èµ„æºï¼Œéƒ½å¯ä»¥ç«‹å³é‡Šæ”¾ï¼Œè€Œä¸ä¼šå¯¼è‡´é—®é¢˜ï¼ˆä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹è¿™ä¸ª<a href=\"https://github.com/rust-lang/rfcs/blob/master/text/3128-io-safety.md\"> RFC</a>ï¼‰ã€‚</p><p>è¯´åˆ°è¿™ï¼Œä½ ä¹Ÿè®¸è§‰å¾—ä¸ç”¨æ˜¾å¼åœ°å…³é—­æ–‡ä»¶ã€å…³é—­ socketã€é‡Šæ”¾é”ï¼Œä¸è¿‡æ˜¯çœäº†ä¸€å¥ â€œclose()â€ è€Œå·²ï¼Œæœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Ÿ</p><p>ç„¶è€Œï¼Œä¸è¦å¿˜äº†ï¼Œåœ¨åºå¤§çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†è¦ç”¨æ¥å¤„ç†é”™è¯¯ã€‚å½“é”™è¯¯å¤„ç†æ…å’Œè¿›æ¥ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä»£ç ï¼Œé€»è¾‘æ›´å¤æ‚ï¼Œéœ€è¦æ·»åŠ  close() è°ƒç”¨çš„ä¸Šä¸‹æ–‡æ›´å¤šã€‚è™½ç„¶Python çš„ withã€Golang çš„ deferï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³èµ„æºé‡Šæ”¾çš„é—®é¢˜ï¼Œä½†è¿˜ä¸å¤Ÿå®Œç¾ã€‚</p><p><strong>ä¸€æ—¦ï¼Œå¤šä¸ªå˜é‡å’Œå¤šç§å¼‚å¸¸æˆ–è€…é”™è¯¯å åŠ ï¼Œæˆ‘ä»¬å¿˜è®°é‡Šæ”¾èµ„æºçš„é£é™©æ•å£ä¼šæˆå€å¢åŠ </strong>ï¼Œå¾ˆå¤šæ­»é”æˆ–è€…èµ„æºæ³„éœ²å°±æ˜¯è¿™ä¹ˆäº§ç”Ÿçš„ã€‚</p><p>ä» Drop trait ä¸­æˆ‘ä»¬å†ä¸€æ¬¡çœ‹åˆ°ï¼Œä»äº‹ç‰©çš„æœ¬åŸå‡ºå‘è§£å†³é—®é¢˜ï¼Œä¼šæå…¶ä¼˜é›…åœ°è§£å†³æ‰å¾ˆå¤šå…¶ä»–å…³è”é—®é¢˜ã€‚å¥½æ¯”ï¼Œæ‰€æœ‰æƒï¼Œå‡ ä¸ªç®€å•è§„åˆ™ï¼Œå°±è®©æˆ‘ä»¬é¡ºå¸¦å¤„ç†æ‰äº†èµ„æºé‡Šæ”¾çš„å¤§éš¾é¢˜ã€‚</p><h2>å°ç»“</h2><p>æˆ‘ä»¬è¿›ä¸€æ­¥æ¢è®¨äº† Rust çš„å†…å­˜ç®¡ç†ï¼Œåœ¨æ‰€æœ‰æƒå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†çš„åŸºç¡€ä¸Šï¼Œä»‹ç»äº†ä¸€ä¸ªå€¼åœ¨å†…å­˜ä¸­åˆ›å»ºã€ä½¿ç”¨å’Œé”€æ¯çš„è¿‡ç¨‹ï¼Œå­¦ä¹ äº†æ•°æ®ç»“æ„åœ¨åˆ›å»ºæ—¶ï¼Œæ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å¸ƒå±€çš„ï¼Œå¤§å°å’Œå¯¹é½ä¹‹é—´çš„å…³ç³»ï¼›æ•°æ®åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦‚ä½• Move å’Œè‡ªåŠ¨å¢é•¿çš„ï¼›ä»¥åŠæ•°æ®æ˜¯å¦‚ä½•é”€æ¯çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/9b/7d3760f88297fc5900c74193cae5e39b.jpg?wh=1920x900\" alt=\"\"></p><p>æ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼Œå°¤å…¶æ˜¯å“ªäº›éƒ¨åˆ†æ”¾åœ¨æ ˆä¸Šï¼Œå“ªäº›éƒ¨åˆ†æ”¾åœ¨å †ä¸Šï¼Œéå¸¸æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä»£ç çš„ç»“æ„å’Œæ•ˆç‡ã€‚</p><p>ä½ ä¸å¿…å¼ºè¡Œè®°å¿†è¿™äº›å†…å®¹ï¼Œåªè¦æœ‰ä¸ªæ€è·¯ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œç¿»é˜…æœ¬æ–‡æˆ–è€… <a href=\"https://cheats.rs\">cheats.rs</a> å³å¯ã€‚å½“æˆ‘ä»¬æŒæ¡äº†æ•°æ®ç»“æ„å¦‚ä½•åˆ›å»ºã€åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¦‚ä½• Move æˆ–è€… Copyã€æœ€åå¦‚ä½•é”€æ¯ï¼Œæˆ‘ä»¬åœ¨é˜…è¯»åˆ«äººçš„ä»£ç æˆ–è€…è‡ªå·±æ’°å†™ä»£ç æ—¶å°±ä¼šæ›´åŠ æ¸¸åˆƒæœ‰ä½™ã€‚</p><h2>æ€è€ƒé¢˜</h2><p><code>Result&lt;String, ()&gt;</code> å ç”¨å¤šå°‘å†…å­˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œå¦‚æœä½ è§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·è®¨è®ºã€‚ä½ çš„Rustå­¦ä¹ ç¬¬11æ¬¡æ‰“å¡å®Œæˆï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p><h2>å‚è€ƒèµ„æ–™</h2><ol>\n<li>Rust è¯­è¨€çš„å¤‡å¿˜æ¸…å• <a href=\"https://cheats.rs\">cheats.rs</a></li>\n<li>ä»£ç å—è¿™ä¸ª<a href=\"https://stackoverflow.com/questions/27324821/why-does-an-enum-require-extra-memory-size\">Stack Overflow å¸–å­</a>å¯å‘ï¼Œæœ‰åˆ æ”¹</li>\n<li>String ç»“æ„çš„<a href=\"https://doc.rust-lang.org/src/alloc/string.rs.html#279-281\">æºç </a></li>\n<li>Vec&lt;T&gt; ç»“æ„<a href=\"https://doc.rust-lang.org/src/alloc/vec/mod.rs.html#294-302\">æºç </a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization\">RAII</a> æ˜¯ä¸€ä¸ªæ‹—å£çš„åè¯ï¼Œä¸­æ–‡æ„æ€æ˜¯â€œèµ„æºè·å–å³åˆå§‹åŒ–â€ã€‚</li>\n</ol>","comments":[{"had_liked":false,"id":316088,"user_name":"dotfiles","can_delete":false,"product_type":"c1","uid":1217723,"ip_address":"","ucode":"F915599EC2F6E5","user_header":"https://static001.geekbang.org/account/avatar/00/12/94/bb/1c8384a0.jpg","comment_is_top":true,"comment_ctime":1634128491,"is_pvip":false,"replies":[{"id":"115275","content":"éå¸¸æ£’ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1635131344,"ip_address":"","comment_id":316088,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233721157983007e+18","product_id":100085301,"comment_content":"1. æ¯ä¸ªå†…å­˜å¯¹è±¡ä»…æœ‰ä¸€ä¸ªæ‰€æœ‰è€…<br>æ‰€æœ‰å †ä¸Šçš„å†…å­˜ä¸€å®šåœ¨æ ˆä¸Šæœ‰å¯¹åº”çš„å˜é‡.å †ä¸Šçš„å†…å­˜æ˜¯ä¸èƒ½ç‹¬ç«‹å­˜åœ¨çš„,å¦åˆ™æ— æ³•ç®¡ç†ä¹Ÿæ— æ³•ä½¿ç”¨.é‚£ä¹ˆé™¤äº†é™æ€åŠ è½½çš„é‚£éƒ¨åˆ†å†…å­˜,çœŸæ­£éœ€è¦ç®¡ç†çš„å†…å­˜å¯ä»¥åˆ†ä¸ºä¸¤ç§: æ•°æ®éƒ½åœ¨æ ˆä¸Š, éƒ¨åˆ†æ•°æ®åœ¨å †ä¸Šéƒ¨åˆ†æ•°æ®åœ¨æ ˆä¸Š.æ¯”å¦‚i32éƒ½åœ¨æ ˆä¸Š, stringåˆ™éƒ¨åˆ†åœ¨å †ä¸Šéƒ¨åˆ†åœ¨æ ˆä¸Š.<br><br>å¯¹äºæ•°æ®éƒ½åœ¨æ ˆä¸Šçš„å†…å­˜å¯¹è±¡,æˆ‘ä»¬å¯ä»¥å®ç°copy Trait,è¿™æ ·ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿.ç±»ä¼¼å…¶ä»–è¯­è¨€çš„å€¼æ‹·è´.åœ¨ä¼ é€’çš„æ—¶å€™,å†…å­˜å¯¹è±¡ä¼šæ‹·è´ä¸€ä»½.æ ‡å‡†æä¾›çš„å¾ˆå¤šåŸºæœ¬ç±»å‹éƒ½å®ç°äº†copy Trait,æ¯”å¦‚i32, usize, &amp;str<br>å½“ç„¶è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„,æ¯”å¦‚ç»“æ„ä½“,ä½ ä¹Ÿå¯ä»¥ä¸å®ç°copy Trait,é‚£ä¹ˆè¿™é‡Œå°±ç‰µæ‰¯åˆ°å†…å­˜å¯¹è±¡æ‰€æœ‰æƒmoveçš„é—®é¢˜.æ— è®ºå†…å­˜å¯¹è±¡æ˜¯ä»…åœ¨æ ˆä¸Šè¿˜æ˜¯æ··åˆçš„,åœ¨è½¬ç§»å¯¹è±¡æ‰€æœ‰æƒæ—¶,æ ˆä¸Šçš„å†…å®¹æ˜¯å®Œæ•´å¤åˆ¶è¿‡å»çš„,æŒ‡å‘å †çš„æŒ‡é’ˆä¹Ÿä¼šå¤åˆ¶è¿‡å».åŒæ—¶,æ—§çš„æ ˆå¯¹è±¡æ— æ³•å†ä½¿ç”¨.<br><br>å®ç°Copy Traitçš„å¯¹è±¡,ä¸èƒ½å®ç°Drop Trait; åœ¨å†…å­˜å¯¹è±¡è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶,ä¼šè‡ªåŠ¨è°ƒç”¨å…¶Drop Trait.å½“ç„¶rustä¸ºäº†ä¿ç•™å®Œæ•´çš„åŠŸèƒ½,ä¹Ÿé€šè¿‡mem::ManuallyDropæä¾›äº†ä¸å—é™çš„å†…å­˜.<br>è¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºrustå†…å­˜ç®¡ç†çš„ä¸€äº›è®¾è®¡ç†å¿µ,åœ¨å¤Ÿç”¨çš„æƒ…å†µä¸‹,å°½é‡æŠŠå†…å­˜ç®¡ç†äº¤ç»™rustç¼–è¯‘å™¨å»æ£€æŸ¥; åœ¨éœ€è¦æ›´å¼ºçš„æ‰©å±•æ—¶,é€šè¿‡ç•™çš„å°å£å­è·å¾—åŠŸèƒ½å¢å¼º; åœ¨å®¡è§†å®‰å…¨é—®é¢˜æ—¶,éœ€è¦checkçš„ä»£ç å°±éå¸¸å°‘.<br><br>2. æ¯ä¸ªå€Ÿç”¨éƒ½ä¸èƒ½è¶…å‡ºå…¶å¼•ç”¨å¯¹è±¡çš„ä½œç”¨åŸŸèŒƒå›´<br>è¿™é‡Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜,æœ‰ä¸€äº›æ¯”è¾ƒå¤§çš„å†…å­˜å¯¹è±¡,æˆ‘ä»¬ä¸å¸Œæœ›ç»å¸¸æ‹·è´æ¥æ‹·è´å»,é‚£ä¹ˆå°±éœ€è¦å®ç°ç±»ä¼¼å¼•ç”¨çš„åŠŸèƒ½. rustä¸ºäº†é¿å…æ‚¬å‚æŒ‡é’ˆ,å°±å¼•å…¥äº†ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µ.<br>æ¯ä¸ªå¯¹è±¡å’Œæ¯ä¸ªå€Ÿç”¨éƒ½æœ‰å…¶ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨. åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,è¯¥æ ‡æ³¨éƒ½æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ å’Œæ£€æŸ¥çš„.<br>ä½†æ˜¯è¿˜æ˜¯æœ‰éƒ¨åˆ†åœºæ™¯æ˜¯ç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šçš„,è¿™å°±éœ€è¦å¼€å‘è€…æ‰‹åŠ¨æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨,æ¥æŒ‡æ˜å„å€Ÿç”¨åŠå…¶å¯¹è±¡é—´çš„å…³ç³».<br>ç¼–è¯‘å™¨åˆ™ä¼šåœ¨å‡½æ•°è°ƒç”¨æ–¹å’Œå®ç°æ–¹ä¸¤ä¾§è¿›è¡Œæ£€æŸ¥,åªè¦èƒ½é€šè¿‡æ£€æŸ¥,è‡³å°‘æ˜¯å†…å­˜å®‰å…¨çš„.<br><br>ä¸ºä»€ä¹ˆéœ€è¦ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨? <br>æˆ‘æƒ³å¯èƒ½è¿˜æœ‰ç§åŸå› æ˜¯ä¸ºäº†ç¼–è¯‘çš„é€Ÿåº¦,rustæ˜¯æŒ‰å„å‡½æ•°å•å…ƒç¼–è¯‘çš„.å› æ­¤æ— æ³•æŒ‰ç…§è°ƒç”¨é“¾åšå…¨å±€åˆ†æ,æ‰€ä»¥æœ‰äº›ä»ä¸Šä¸‹æ–‡å¾ˆå®¹æ˜“çœ‹å‡ºæ¥çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨,rustä¾ç„¶éœ€è¦å¼€å‘è€…å»æ ‡æ³¨.<br><br>åœ¨æ ‡æ³¨çš„æ—¶å€™,è¿˜æ˜¯è¦ç‰¢è®°: å¯è¯»ä¸å¯å†™,å¯å†™ä¸å¯è¯».å¯å˜å¼•ç”¨æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª;<br><br>å…³äºç”Ÿå‘½å‘¨æœŸè¿™å—å‘ç°ä¸ªä¸é”™çš„å¸–å­: https:&#47;&#47;github.com&#47;pretzelhammer&#47;rust-blog&#47;blob&#47;master&#47;posts&#47;common-rust-lifetime-misconceptions.md&#47;","like_count":18,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528260,"discussion_content":"éå¸¸æ£’ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635131344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020529,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/71/9fd7cd7a.jpg","nickname":"Daniel","note":"","ucode":"282E09B3146501","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564919,"discussion_content":"æ„Ÿè°¢åˆ†äº«å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650355347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312155,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1631668223,"is_pvip":false,"replies":[{"id":"113128","content":"å¯¹ï¼é¦–å…ˆ () çš„ç¡®ä¸å å†…å­˜ã€‚ç„¶ååœ¨æ–‡ä¸­æˆ‘ä¹Ÿæåˆ°ï¼ŒRust ç¼–è¯‘å™¨ä¼šåšä¸€äº›ä¼˜åŒ–ï¼š<br><br>&gt; Rust æ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¼•ç”¨ç±»å‹çš„ç¬¬ä¸€ä¸ªåŸŸæ˜¯ä¸ªæŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆæ˜¯ä¸å¯èƒ½ç­‰äº 0 çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¤ç”¨è¿™ä¸ªæŒ‡é’ˆï¼šå½“å…¶ä¸º 0 æ—¶ï¼Œè¡¨ç¤º Noneï¼Œå¦åˆ™æ˜¯ Someã€‚<br><br>å¯¹äº Result&lt;String, ()&gt; ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒString ç¬¬ä¸€ä¸ªåŸŸæ˜¯æŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥å½“å®ƒä¸ºç©ºçš„æ—¶å€™ï¼Œæ­£å¥½å¯ä»¥è¡¨è¿° Err(())ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631671440,"ip_address":"","comment_id":312155,"utype":1}],"discussion_count":5,"race_medal":0,"score":"57466243071","product_id":100085301,"comment_content":"Result&lt;String, ()&gt; å ç”¨å¤šå°‘å†…å­˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ<br><br>è¿˜æ˜¯ 24ï¼Œä¹Ÿå°±æ˜¯è¯´ () å‹æ ¹ä¸å å†…å­˜ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œé¿å…äº†å†…å­˜æµªè´¹ã€‚","like_count":13,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526883,"discussion_content":"å¯¹ï¼é¦–å…ˆ () çš„ç¡®ä¸å å†…å­˜ã€‚ç„¶ååœ¨æ–‡ä¸­æˆ‘ä¹Ÿæåˆ°ï¼ŒRust ç¼–è¯‘å™¨ä¼šåšä¸€äº›ä¼˜åŒ–ï¼š\n\n&amp;gt; Rust æ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¼•ç”¨ç±»å‹çš„ç¬¬ä¸€ä¸ªåŸŸæ˜¯ä¸ªæŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆæ˜¯ä¸å¯èƒ½ç­‰äº 0 çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¤ç”¨è¿™ä¸ªæŒ‡é’ˆï¼šå½“å…¶ä¸º 0 æ—¶ï¼Œè¡¨ç¤º Noneï¼Œå¦åˆ™æ˜¯ Someã€‚\n\nå¯¹äº Result&amp;lt;String, ()&amp;gt; ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒString ç¬¬ä¸€ä¸ªåŸŸæ˜¯æŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥å½“å®ƒä¸ºç©ºçš„æ—¶å€™ï¼Œæ­£å¥½å¯ä»¥è¡¨è¿° Err(())ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1631671440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2851308,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epEexjZIhNpYNiaAibdLD0Jsl797U6hianjrDs2QT4Q4HOicIEeILxjOcEF7gXGyQeJRJHaeenibb3N9QQ/132","nickname":"enbool","note":"","ucode":"BB460DCCA87099","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535087,"discussion_content":"å½“Errä¸æ˜¯()æ—¶ï¼ŒResultæ˜¯ä¸æ˜¯éœ€è¦1ä¸ªtagæ ‡è¯†æ˜¯OKè¿˜æ˜¯Errï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638348615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394103,"discussion_content":"ä½†æ˜¯Stringä¸æ˜¯å¼•ç”¨ç±»å‹å•Š?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631721577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1201350,"avatar":"https://static001.geekbang.org/account/avatar/00/12/54/c6/c2481790.jpg","nickname":"lisiur","note":"","ucode":"CEB2DBCE29CAA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395334,"discussion_content":"å¦‚æœä½ å¯¹ String çš„å®šä¹‰è¿›è¡Œå±‚å±‚åˆ†è§£ï¼Œä½ ä¼šå‘ç° String æœ¬è´¨ä¸Šå°±æ˜¯ç”± ptr,cap,len ä¸‰ä¸ªå­—æ®µæ„æˆï¼Œç¬¬ä¸€åŸŸ ptr å°±æ˜¯ *const u8 è£¸æŒ‡é’ˆ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1632283435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394103,"ip_address":""},"score":395334,"extra":""},{"author":{"id":2755534,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0b/ce/f0c520d1.jpg","nickname":"é¹…å¸®é€®","note":"","ucode":"A6DB1BEFDA5D9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567004,"discussion_content":"Stringæ˜¯å¼•ç”¨ç±»å‹å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650811840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394103,"ip_address":""},"score":567004,"extra":""}]}]},{"had_liked":false,"id":312200,"user_name":"Marvichov","can_delete":false,"product_type":"c1","uid":1111835,"ip_address":"","ucode":"7482099415C41C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","comment_is_top":false,"comment_ctime":1631680238,"is_pvip":false,"replies":[{"id":"113168","content":"1. ä½ å¼•ç”¨çš„æ–‡å­—å†™çš„å¾ˆæ¸…æ¥šï¼šwhich generally means that the data&#39;s memory address is a multiple of the *data size*ã€‚ä½ æƒ³æƒ³ä¸€ä¸ª struct A {a: u8}ï¼Œå®ƒçš„ data size æ˜¯å¤šå°‘ï¼Ÿå¦‚æœè¦æŠŠå®ƒ align åœ¨ 64bit ä¸Šï¼Œé‚£æ‰€æœ‰çš„ network buffer ï¼ˆç›¸å½“äº Vec&lt;u8&gt;ï¼‰éƒ½å®Œè›‹äº†ï¼Œéœ€è¦è†¨èƒ€ 8 å€ã€‚<br><br>è¿™é‡Œæœ‰æ®µä»£ç ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼Œæ€è€ƒä¸€ä¸‹æ¯ä¸ªæ‰“å°åœ°å€éƒ½å¦‚ä½•å¯¹é½ï¼Œç„¶åè¿è¡Œæ„Ÿå—ä¸€ä¸‹ï¼š<br><br>```rust<br>#[derive(Default)]<br>struct Align1 {<br>    a: u8,<br>    b: usize,<br>    c: u32<br>}<br><br>#[derive(Default)]<br>struct Align2 {<br>    a: u8,<br>}<br><br><br>fn main() {<br>    let s1 = &quot;a&quot;;<br>    let s2 = &quot;aaaa&quot;;<br>    let s3 = &quot;hello&quot;;<br>    let a = Align1::default();<br>    let b = Align2::default();<br>    <br>    println!(&quot;{:p}&quot;, s1);<br>    println!(&quot;{:p}&quot;, s2);<br>    println!(&quot;{:p}&quot;, s3);<br>    <br>    println!(&quot;Align1.a: {:p}&quot;, &amp;a.a);<br>    println!(&quot;Align1.b: {:p}&quot;, &amp;a.b);<br>    println!(&quot;Align1.c: {:p}&quot;, &amp;a.c);<br>    println!(&quot;Align2.a: {:p}&quot;, &amp;b.a);<br>    <br>}<br>```<br><br>playground: https:&#47;&#47;play.rust-lang.org&#47;?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9ab8c85b7065fb0374b046548517821f<br><br>2. c å¯¹é½æ˜¯ 1ï¼Œb å¯¹é½æ˜¯ 2ï¼Œæ‰€ä»¥ s2 æ˜¯ 2ã€‚æ³¨æ„ align æ˜¯å¯¹é½ï¼Œä¸æ˜¯é•¿åº¦ï¼Œåˆ‡è®°ã€‚å°±åƒ [u8; 1024] é•¿åº¦æ˜¯ 1024ï¼Œå¯¹é½ä¾æ—§æ˜¯ 1ã€‚<br><br>3. Rust ç›®å‰ä¸å¯¹å¤–æä¾›ç¨³å®šçš„ ABIã€‚æ‰€ä»¥å¦‚æœè¦æƒ³ä»¥äºŒè¿›åˆ¶å½¢å¼åˆ†å‘ï¼Œéœ€è¦æä¾› C ABI çš„æ¥å£ã€‚æ¯”å¦‚ struct éœ€è¦ä½¿ç”¨ #[repr(c)]ï¼Œå¾ˆå¤šæ ‡å‡†åº“çš„æ•°æ®ç»“æ„éœ€è¦ä½¿ç”¨å¯¹åº”çš„ C ç»“æ„ï¼ˆå¦‚ Stringï¼‰ã€‚æ‰€æœ‰çš„æ³›å‹å‡½æ•°ï¼Œtrait æ–¹æ³•ï¼Œstruct æ–¹æ³•ï¼Œéƒ½éœ€è¦å¯¹åº”çš„ C å‡½æ•°å°è£…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631761624,"ip_address":"","comment_id":312200,"utype":1}],"discussion_count":5,"race_medal":0,"score":"44581353198","product_id":100085301,"comment_content":"1. alignå’Œpaddingä¸åº”è¯¥å’Œbus sizeæœ‰å…³å—? å¦‚æœ32bitæœºå™¨, structçš„èµ·å§‹åœ°å€éœ€è¦æ˜¯4çš„å€æ•°å˜›? è¿˜æ˜¯è¯´éšä¾¿ä»å“ªé‡Œå¼€å§‹éƒ½å¯ä»¥? alignä¸ºå•¥ä¸æ˜¯4çš„å€æ•°å‘¢?<br><br>wiki: The CPU in modern computer hardware performs reads and writes to memory most efficiently when the data is **naturally** aligned, which generally means that the data&#39;s memory address is a multiple of the data size. For instance, in a 32-bit architecture, the data may be aligned if the data is stored in four consecutive bytes and the first byte lies on a 4-byte boundary.<br><br>    fn main() {<br>        &#47;&#47; 4, 4<br>        println!(&quot;sizeof S1: {}, S2: {}&quot;, size_of::&lt;S1&gt;(), size_of::&lt;S2&gt;());<br>        &#47;&#47; 2, 2<br>        println!(&quot;alignof S1: {}, S2: {}&quot;, align_of::&lt;S1&gt;(), align_of::&lt;S2&gt;());<br>        &#47;&#47; 4, 8<br>        println!(<br>            &quot;alignof i32: {}, i64: {}&quot;,<br>            align_of::&lt;i32&gt;(),<br>            align_of::&lt;i64&gt;()<br>        );<br>    }<br><br>2. ä¸ºå•¥ä¸æ˜¯3çš„å€æ•°å‘¢?<br>    struct S2 {<br>        c: [u8; 3],<br>        b: u16,<br>    }<br>    &#47;&#47; align_of&lt;S2&gt; is 2<br><br>3. rustèƒ½è‡ªåŠ¨å¸®äººreorder memory layout, ä¼šä¸ä¼šå¯¼è‡´structçš„abiä¸ç¨³å®š?<br>","like_count":10,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526893,"discussion_content":"1. ä½ å¼•ç”¨çš„æ–‡å­—å†™çš„å¾ˆæ¸…æ¥šï¼šwhich generally means that the data&amp;#39;s memory address is a multiple of the *data size*ã€‚ä½ æƒ³æƒ³ä¸€ä¸ª struct A {a: u8}ï¼Œå®ƒçš„ data size æ˜¯å¤šå°‘ï¼Ÿå¦‚æœè¦æŠŠå®ƒ align åœ¨ 64bit ä¸Šï¼Œé‚£æ‰€æœ‰çš„ network buffer ï¼ˆç›¸å½“äº Vec&amp;lt;u8&amp;gt;ï¼‰éƒ½å®Œè›‹äº†ï¼Œéœ€è¦è†¨èƒ€ 8 å€ã€‚\n\nè¿™é‡Œæœ‰æ®µä»£ç ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼Œæ€è€ƒä¸€ä¸‹æ¯ä¸ªæ‰“å°åœ°å€éƒ½å¦‚ä½•å¯¹é½ï¼Œç„¶åè¿è¡Œæ„Ÿå—ä¸€ä¸‹ï¼š\n\n```rust\n#[derive(Default)]\nstruct Align1 {\n    a: u8,\n    b: usize,\n    c: u32\n}\n\n#[derive(Default)]\nstruct Align2 {\n    a: u8,\n}\n\n\nfn main() {\n    let s1 = &amp;quot;a&amp;quot;;\n    let s2 = &amp;quot;aaaa&amp;quot;;\n    let s3 = &amp;quot;hello&amp;quot;;\n    let a = Align1::default();\n    let b = Align2::default();\n    \n    println!(&amp;quot;{:p}&amp;quot;, s1);\n    println!(&amp;quot;{:p}&amp;quot;, s2);\n    println!(&amp;quot;{:p}&amp;quot;, s3);\n    \n    println!(&amp;quot;Align1.a: {:p}&amp;quot;, &amp;amp;a.a);\n    println!(&amp;quot;Align1.b: {:p}&amp;quot;, &amp;amp;a.b);\n    println!(&amp;quot;Align1.c: {:p}&amp;quot;, &amp;amp;a.c);\n    println!(&amp;quot;Align2.a: {:p}&amp;quot;, &amp;amp;b.a);\n    \n}\n```\n\nplayground: https://play.rust-lang.org/?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=9ab8c85b7065fb0374b046548517821f\n\n2. c å¯¹é½æ˜¯ 1ï¼Œb å¯¹é½æ˜¯ 2ï¼Œæ‰€ä»¥ s2 æ˜¯ 2ã€‚æ³¨æ„ align æ˜¯å¯¹é½ï¼Œä¸æ˜¯é•¿åº¦ï¼Œåˆ‡è®°ã€‚å°±åƒ [u8; 1024] é•¿åº¦æ˜¯ 1024ï¼Œå¯¹é½ä¾æ—§æ˜¯ 1ã€‚\n\n3. Rust ç›®å‰ä¸å¯¹å¤–æä¾›ç¨³å®šçš„ ABIã€‚æ‰€ä»¥å¦‚æœè¦æƒ³ä»¥äºŒè¿›åˆ¶å½¢å¼åˆ†å‘ï¼Œéœ€è¦æä¾› C ABI çš„æ¥å£ã€‚æ¯”å¦‚ struct éœ€è¦ä½¿ç”¨ #[repr(c)]ï¼Œå¾ˆå¤šæ ‡å‡†åº“çš„æ•°æ®ç»“æ„éœ€è¦ä½¿ç”¨å¯¹åº”çš„ C ç»“æ„ï¼ˆå¦‚ Stringï¼‰ã€‚æ‰€æœ‰çš„æ³›å‹å‡½æ•°ï¼Œtrait æ–¹æ³•ï¼Œstruct æ–¹æ³•ï¼Œéƒ½éœ€è¦å¯¹åº”çš„ C å‡½æ•°å°è£…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631761624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394870,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„example! runäº†ä¸€ä¸‹, æœ‰ç‚¹æ˜ç™½äº†! åˆ†äº«ä¸€ä¸ªå…³äºalignmentçš„SOç»™éœ€è¦çš„æœ‹å‹ä»¬: https://stackoverflow.com/questions/381244/purpose-of-memory-alignment","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632108689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409036,"discussion_content":"Align1.a: 0x7ffe2c88092c\nAlign1.b: 0x7ffe2c880920\nAlign1.c: 0x7ffe2c880928\nAlign2.a: 0x7ffe2c880937\nè€å¸ˆä¾‹å­ï¼Œ1æ˜¯8å­—èŠ‚å¯¹é½ï¼Œæ ˆä¸Šæ˜¯ä»é«˜ä½å¼€å§‹åˆ†é…ï¼Œé‚£2çš„åœ°å€å8ä½37(00110111)å¾€å‰çš„8å­—èŠ‚å¯¹é½åœ°å€æ˜¯åˆ†åˆ«æ˜¯30(00110000)ï¼Œ28(00101000)ï¼Œ20(00100000)ç­‰ï¼Œ1å 16å­—èŠ‚(1+4+8ï¼Œ13 åŠ ä¸Šå¯¹é½)ï¼Œåˆšå¥½å æ®äº†20åˆ°30è¿™ä¸ªç©ºé—´ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿ28åˆ°38ä¼šå’Œ2å†²çªã€‚æ ˆå¯¹é½ä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼ŒğŸ˜„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635355975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394101,"discussion_content":"good point! åŠ äº†ä¹Ÿæ˜¯ä¸€æ ·çš„ç»“æœ! è¿™ä¸ªç»“æ„ä½“è€Œè¨€, reorderç»“æœä¸€æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631721121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394052,"discussion_content":"æˆ‘çŒœä½ éœ€è¦#[repr(C)]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631700634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312561,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1631865372,"is_pvip":false,"replies":[{"id":"113267","content":"Result&lt;T, E&gt; éœ€è¦æä¾›ä¸€ä¸ª E ç±»å‹ä»£è¡¨é”™è¯¯ï¼Œè€Œåœ¨ show_size! å®ä¸­ï¼Œæˆ‘ä»¬åªä¼ å…¥äº† T çš„ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œå°±éšä¾¿æŠŠ E å†™æ­»æˆ std::io::Error äº†ã€‚std::io::Error æ˜¯ 16 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ Result&lt;T, E&gt;ï¼Œå¦‚æœä¸èƒ½ä¼˜åŒ–çš„è¯ï¼Œè¦ä¹ˆæ˜¯ T + 8 ä¸ªå­—èŠ‚ï¼ˆT &gt; 16ï¼‰ï¼Œè¦ä¹ˆæ˜¯ 24 ä¸ªå­—èŠ‚ï¼ˆ16 + 8ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631927135,"ip_address":"","comment_id":312561,"utype":1}],"discussion_count":2,"race_medal":2,"score":"23106701852","product_id":100085301,"comment_content":"å¯¹äº Result&lt;T, io::Error&gt; è¿™ä¸€åˆ—çš„å€¼ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œè€å¸ˆå¯èƒ½è§£é‡Šä¸€ä¸‹å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527025,"discussion_content":"Result&amp;lt;T, E&amp;gt; éœ€è¦æä¾›ä¸€ä¸ª E ç±»å‹ä»£è¡¨é”™è¯¯ï¼Œè€Œåœ¨ show_size! å®ä¸­ï¼Œæˆ‘ä»¬åªä¼ å…¥äº† T çš„ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œå°±éšä¾¿æŠŠ E å†™æ­»æˆ std::io::Error äº†ã€‚std::io::Error æ˜¯ 16 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ Result&amp;lt;T, E&amp;gt;ï¼Œå¦‚æœä¸èƒ½ä¼˜åŒ–çš„è¯ï¼Œè¦ä¹ˆæ˜¯ T + 8 ä¸ªå­—èŠ‚ï¼ˆT &amp;gt; 16ï¼‰ï¼Œè¦ä¹ˆæ˜¯ 24 ä¸ªå­—èŠ‚ï¼ˆ16 + 8ï¼‰ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631927135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2372564,"avatar":"https://static001.geekbang.org/account/avatar/00/24/33/d4/02774d66.jpg","nickname":"æ²ä½‘","note":"","ucode":"2643B3CB341906","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548320,"discussion_content":"ä¸ºä»€ä¹ˆStd::io::Erroræ˜¯16ä¸ªå­—èŠ‚ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643124302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312299,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1631722289,"is_pvip":false,"replies":[{"id":"113161","content":"feature ç”¨ä½œæ¡ä»¶ç¼–è¯‘ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨åº“çš„æŸäº› featureã€‚å®ƒçš„å¥½å¤„æ˜¯å¯ä»¥è®©ç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶æ¯”è¾ƒçµæ´»ï¼Œæ ¹æ®éœ€è¦è£…å…¥ä¸åŒçš„åŠŸèƒ½ã€‚åœ¨ docs.rs ä¸‹çš„æŸä¸ªåº“çš„æ–‡æ¡£ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒéƒ½æœ‰å“ªäº› featureã€‚<br><br>å®šä¹‰ featureï¼Œä½ å¯ä»¥çœ‹ cargo bookï¼šhttps:&#47;&#47;doc.rust-lang.org&#47;cargo&#47;reference&#47;features.htmlã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š<br><br>åœ¨ cargo.toml ä¸­ï¼Œå¯ä»¥å®šä¹‰ï¼š<br><br>[features]<br>filter = [&quot;futures-util&quot;] &#47;&#47; å®šä¹‰ filter featureï¼Œå®ƒæœ‰é¢å¤–å¯¹ futures-util çš„ä¾èµ–ã€‚<br><br>[dependencies]<br>futures-util = { version = &quot;0.3&quot;, optional = true } &#47;&#47; è¿™ä¸ª dep å£°æ˜æˆ optional<br><br>åœ¨ lib.rs ä¸­ï¼š<br>#[cfg(feature = &quot;filter&quot;)]<br>pub mod filter_all; &#47;&#47; åªæœ‰ç¼–è¯‘ feature filter æ—¶ï¼Œæ‰å¼•å…¥ mod feature_all ç¼–è¯‘","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631758397,"ip_address":"","comment_id":312299,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18811591473","product_id":100085301,"comment_content":"è€å¸ˆï¼Œæƒ³çŸ¥é“ rust ä¸­çš„ feature æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œæ€ä¹ˆå¼€å‘ï¼Ÿç°åœ¨èƒ½çœ‹åˆ°ç»å¸¸æœ‰æ ‡å‡†åº“ä¸­çš„ï¼š<br><br>#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]<br><br>æˆ–è€… Cargo.tomlä¸­çš„<br><br>tokio = { version = &quot;1&quot;, features = [&quot;full&quot;] } <br><br>è¿™äº›éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ€ä¹ˆè‡ªå·±å®šä¹‰","like_count":4,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526930,"discussion_content":"feature ç”¨ä½œæ¡ä»¶ç¼–è¯‘ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨åº“çš„æŸäº› featureã€‚å®ƒçš„å¥½å¤„æ˜¯å¯ä»¥è®©ç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶æ¯”è¾ƒçµæ´»ï¼Œæ ¹æ®éœ€è¦è£…å…¥ä¸åŒçš„åŠŸèƒ½ã€‚åœ¨ docs.rs ä¸‹çš„æŸä¸ªåº“çš„æ–‡æ¡£ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒéƒ½æœ‰å“ªäº› featureã€‚\n\nå®šä¹‰ featureï¼Œä½ å¯ä»¥çœ‹ cargo bookï¼šhttps://doc.rust-lang.org/cargo/reference/features.htmlã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\nåœ¨ cargo.toml ä¸­ï¼Œå¯ä»¥å®šä¹‰ï¼š\n\n[features]\nfilter = [&amp;quot;futures-util&amp;quot;] // å®šä¹‰ filter featureï¼Œå®ƒæœ‰é¢å¤–å¯¹ futures-util çš„ä¾èµ–ã€‚\n\n[dependencies]\nfutures-util = { version = &amp;quot;0.3&amp;quot;, optional = true } // è¿™ä¸ª dep å£°æ˜æˆ optional\n\nåœ¨ lib.rs ä¸­ï¼š\n#[cfg(feature = &amp;quot;filter&amp;quot;)]\npub mod filter_all; // åªæœ‰ç¼–è¯‘ feature filter æ—¶ï¼Œæ‰å¼•å…¥ mod feature_all ç¼–è¯‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631758397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118976,"avatar":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","nickname":"Michael","note":"","ucode":"35F4FFAC4A4B15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394275,"discussion_content":"è°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631806356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312174,"user_name":"Christian","can_delete":false,"product_type":"c1","uid":1089000,"ip_address":"","ucode":"D84F866015BA07","user_header":"https://static001.geekbang.org/account/avatar/00/10/9d/e8/39433235.jpg","comment_is_top":false,"comment_ctime":1631672403,"is_pvip":false,"replies":[{"id":"113171","content":"æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631761713,"ip_address":"","comment_id":312174,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14516574291","product_id":100085301,"comment_content":"ä¸‰ä¸ªå­—é•¿â•ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™ç§æƒ…å†µä¸‹è¿™ä¸ªå­—èŠ‚å¯èƒ½ä¼šè¢«ä¼˜åŒ–æ‰ï¼ŒåŸç†åŒ Optionã€‚","like_count":3,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526888,"discussion_content":"æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631761713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312622,"user_name":"0@1","can_delete":false,"product_type":"c1","uid":1549191,"ip_address":"","ucode":"932A4139DB8169","user_header":"https://static001.geekbang.org/account/avatar/00/17/a3/87/eb923eb3.jpg","comment_is_top":false,"comment_ctime":1631894288,"is_pvip":false,"replies":[{"id":"113274","content":"A ä¸éœ€è¦æ˜¾ç¤ºå®ç° Dropã€‚æ–‡ä¸­å·²ç»è¯´è¿‡ç¼–è¯‘å™¨ä¼šä¾æ¬¡ä¸ºæ•°æ®ç»“æ„çš„æ¯ä¸ªå­—æ®µè°ƒç”¨å…¶ Dropï¼ˆå¦‚æœæœ‰ Drop å®ç°çš„è¯ï¼‰ã€‚ä½ å¯ä»¥è®¤ä¸ºå½“ä¸€ä¸ªéœ€è¦ drop çš„å€¼ a é€€å‡ºä½œç”¨åŸŸæ—¶ï¼Œéƒ½ä¼šè¿›è¡Œç±»ä¼¼ drop(a) çš„æ“ä½œã€‚<br><br>ä½ å¯ä»¥çœ‹è¿™ä¸ªä»£ç ï¼šhttps:&#47;&#47;play.rust-lang.org&#47;?version=nightly&amp;mode=debug&amp;edition=2018ã€‚æŠŠ playground åˆ‡åˆ° Show MIR å†è¿è¡Œçœ‹æ’å…¥çš„ dropã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631928511,"ip_address":"","comment_id":312622,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10221828880","product_id":100085301,"comment_content":"è€å¸ˆä¸‹é¢çš„ä»£ç ï¼ŒAæ²¡å®ç°Drop, ç¼–è¯‘å™¨æ˜¯ä¸æ˜¯ä¼šç»™ä»–ç”Ÿæˆä¸ªé»˜è®¤çš„å®ç°ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ç¼–è¯‘å™¨å†…éƒ¨æ˜¯ä¸æ˜¯æœ‰å¦å¤–ä¸€ç§ç±»ä¼¼çš„æœºåˆ¶æ¯”å¦‚xx callbackï¼Œå½“æŸä¸ªç»“æ„ä½“ç”Ÿå‘½ç»“æŸæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨ï¼Œåªä¸è¿‡ä¸å‘å¼€å‘è€…å¼€æ”¾?<br>struct A(B);<br>struct B;<br><br>impl Drop for B {<br>    fn drop(&amp;mut self) {<br>        println!(&quot;B droped&quot;);<br>    }<br>}","like_count":2,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527050,"discussion_content":"A ä¸éœ€è¦æ˜¾ç¤ºå®ç° Dropã€‚æ–‡ä¸­å·²ç»è¯´è¿‡ç¼–è¯‘å™¨ä¼šä¾æ¬¡ä¸ºæ•°æ®ç»“æ„çš„æ¯ä¸ªå­—æ®µè°ƒç”¨å…¶ Dropï¼ˆå¦‚æœæœ‰ Drop å®ç°çš„è¯ï¼‰ã€‚ä½ å¯ä»¥è®¤ä¸ºå½“ä¸€ä¸ªéœ€è¦ drop çš„å€¼ a é€€å‡ºä½œç”¨åŸŸæ—¶ï¼Œéƒ½ä¼šè¿›è¡Œç±»ä¼¼ drop(a) çš„æ“ä½œã€‚\n\nä½ å¯ä»¥çœ‹è¿™ä¸ªä»£ç ï¼šhttps://play.rust-lang.org/?version=nightly&amp;amp;mode=debug&amp;amp;edition=2018ã€‚æŠŠ playground åˆ‡åˆ° Show MIR å†è¿è¡Œçœ‹æ’å…¥çš„ dropã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631928511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1037669,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d5/65/1c9f1530.jpg","nickname":"NorthWind","note":"","ucode":"459ADF3B0945E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576247,"discussion_content":"åœ¨èŠ±æ‹¬å·å…³é—­å¤„ drop","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655371254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328939,"user_name":"nobel","can_delete":false,"product_type":"c1","uid":1130651,"ip_address":"","ucode":"29274748E1E5FA","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/9b/c5b0029a.jpg","comment_is_top":false,"comment_ctime":1640945340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5935912636","product_id":100085301,"comment_content":"å¥½éš¾","like_count":1},{"had_liked":false,"id":316593,"user_name":"overheat","can_delete":false,"product_type":"c1","uid":2675695,"ip_address":"","ucode":"DD82D9194C26D0","user_header":"https://static001.geekbang.org/account/avatar/00/28/d3/ef/b3b88181.jpg","comment_is_top":false,"comment_ctime":1634438289,"is_pvip":true,"replies":[{"id":"114666","content":"å•Šç¡®å®æ˜¯ï¼Œå·²ç»ä¿®æ”¹è¿‡æ¥å•¦ï¼Œæ„Ÿè°¢åé¦ˆï½","user_name":"ç¼–è¾‘å›å¤","user_name_real":"å¶å¦‚èŠŠ","uid":"2547771","ctime":1634522583,"ip_address":"","comment_id":316593,"utype":2}],"discussion_count":1,"race_medal":0,"score":"5929405585","product_id":100085301,"comment_content":"æ­£æ–‡ä¸­ç¬¬ä¸€æ¬¡æåˆ°cheats.rsçš„æ—¶å€™ï¼Œå†™æˆäº†cheat.rsã€‚","like_count":1,"discussions":[{"author":{"id":2547771,"avatar":"https://static001.geekbang.org/account/avatar/00/26/e0/3b/8ec916b2.jpg","nickname":"å¤šå°‘","note":"","ucode":"0A6EF7AA6E4BB7","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528426,"discussion_content":"å•Šç¡®å®æ˜¯ï¼Œå·²ç»ä¿®æ”¹è¿‡æ¥å•¦ï¼Œæ„Ÿè°¢åé¦ˆï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634522583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312274,"user_name":"æ…¢åŠ¨ä½œ","can_delete":false,"product_type":"c1","uid":1133945,"ip_address":"","ucode":"62C944F4A4D8AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","comment_is_top":false,"comment_ctime":1631712960,"is_pvip":true,"replies":[{"id":"113163","content":"å¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631758513,"ip_address":"","comment_id":312274,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5926680256","product_id":100085301,"comment_content":"â€œä¸€èˆ¬è€Œè¨€ï¼Œ64 ä½ CPU ä¸‹ï¼Œenum çš„æœ€å¤§é•¿åº¦æ˜¯ï¼šæœ€å¤§ç±»å‹çš„é•¿åº¦ + 8ï¼Œå› ä¸º 64 ä½ CPU çš„æœ€å¤§å¯¹é½æ˜¯ 64bitï¼Œä¹Ÿå°±æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚â€ï¼Œå¦‚æœæœ€å¤§ç±»å‹æ˜¯10ï¼Œé‚£æ˜¯18å¯¹é½åˆ°24å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526922,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631758513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1042983,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/27/a3737d61.jpg","nickname":"Shanks-ç‹å†²","note":"","ucode":"C4B90A17850E20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584499,"discussion_content":"ä½ å¥½ï¼Œæˆ‘æ¥å°è¯•ç†è§£ï¼Œéœ€è¦ä½ ç»™ä¸ªåé¦ˆï¼šæœ€å¤§ç±»å‹æ˜¯10ï¼Œå¯¹é½åˆ°24ï¼Œé‚£èƒ½ç†è§£ä½ è¿™ä¸ª enum å¤§å°æ˜¯ 24å­—èŠ‚ï¼Œè¿˜æ˜¯18å­—èŠ‚å‘¢ï¼Ÿè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660883238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312264,"user_name":"Arthur","can_delete":false,"product_type":"c1","uid":1784009,"ip_address":"","ucode":"1C064405490769","user_header":"https://static001.geekbang.org/account/avatar/00/1b/38/c9/63ea8fe6.jpg","comment_is_top":false,"comment_ctime":1631708763,"is_pvip":true,"replies":[{"id":"113165","content":"éå¸¸æ£’ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631758583,"ip_address":"","comment_id":312264,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5926676059","product_id":100085301,"comment_content":"`()`ä¸ºunit typeï¼Œå±äºZero Sized Types, https:&#47;&#47;doc.rust-lang.org&#47;nightly&#47;nomicon&#47;exotic-sizes.html#zero-sized-types-zsts;<br>å› æ­¤æ ¹æ®`Result&lt;T, E&gt;`çš„å†…å­˜å¸ƒå±€ï¼Œä¼˜åŒ–å‰åº”è¯¥ä¸ºæœ€å¤§é•¿åº¦+8ï¼Œä½†æ˜¯å¦‚æœEä¸º()ï¼Œé‚£ä¹ˆRustå¯ä»¥å°†`Result&lt;String, ()&gt;`ä¼˜åŒ–ä¸ºï¼šåœ¨éé›¶æ—¶ä¸ºStringï¼Œä¸º0æ—¶åˆ™ä¸º`()`ï¼›æ‰€ä»¥`Result&lt;String, ()&gt;`çš„å¤§å°åº”è¯¥åŒ`Option&lt;String&gt;`çš„å¤§å°ä¸€æ ·ï¼Œä¸º24å­—èŠ‚","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526916,"discussion_content":"éå¸¸æ£’ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631758583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312176,"user_name":"GengTeng","can_delete":false,"product_type":"c1","uid":1224623,"ip_address":"","ucode":"3F926F5EF1D075","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/af/8b03ce2c.jpg","comment_is_top":false,"comment_ctime":1631672916,"is_pvip":false,"replies":[{"id":"113170","content":"æ˜¯çš„ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631761704,"ip_address":"","comment_id":312176,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5926640212","product_id":100085301,"comment_content":"```<br>struct S(String);<br>struct U;<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;(), ()&gt;&gt;());         &#47;&#47; 1<br>println!(&quot;{}&quot;, size_of::&lt;String&gt;());                  &#47;&#47; 24<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;String, ()&gt;&gt;());  &#47;&#47; 24<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;String, U&gt;&gt;());  &#47;&#47; 24<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;S, U&gt;&gt;());        &#47;&#47; 24<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;String, u8&gt;&gt;());  &#47;&#47; 32<br>println!(&quot;{}&quot;, size_of::&lt;Result&lt;S, u8&gt;&gt;());       &#47;&#47; 32<br>```<br><br>Rustç¼–è¯‘å™¨å¯¹è¿™ä¸ªåšäº†ä¼˜åŒ–ã€‚<br><br>ä½†æ˜¯å¦‚æœç±»å‹Eçš„å¤§å°ä¸æ˜¯0ï¼Œæˆ–è€…ä¸¤è€…å¤§å°éƒ½æ˜¯0ï¼Œå°±æ— æ³•é€šè¿‡å€¼å†…å®¹æ¥åŒºåˆ†æšä¸¾ï¼Œæ— æ³•ä¼˜åŒ–æ‰è¿™ä¸€ä¸ªå­—èŠ‚äº†ã€‚","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526889,"discussion_content":"æ˜¯çš„ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631761704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355650,"user_name":"Geek_16633d","can_delete":false,"product_type":"c1","uid":1473599,"ip_address":"åŒ—äº¬","ucode":"B3D6A698D05694","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erboZHuicZ2Cyj4RheyFialwYta32RLQrFbfGuEcvib5segWEq9hp07amCibEZX8a7eGlMNN3xpaqMicWA/132","comment_is_top":false,"comment_ctime":1661591995,"is_pvip":true,"replies":[{"id":"129424","content":"excalidrawï¼Œç”»å›¾å¾ˆå¥½ç”¨","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":"2547771","ctime":1661611417,"ip_address":"åŒ—äº¬","comment_id":355650,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1661591995","product_id":100085301,"comment_content":"å¾ˆæƒ³çŸ¥é“é™ˆè€å¸ˆç”¨çš„æ˜¯ä»€ä¹ˆç”»å›¾å·¥å…·ï¼Œå¾ˆæ˜¯æ–¹ä¾¿åšç¬”è®°å­¦ä¹ å‘¢ï¼","like_count":0,"discussions":[{"author":{"id":2547771,"avatar":"https://static001.geekbang.org/account/avatar/00/26/e0/3b/8ec916b2.jpg","nickname":"å¤šå°‘","note":"","ucode":"0A6EF7AA6E4BB7","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585504,"discussion_content":"excalidrawï¼Œç”»å›¾å¾ˆå¥½ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661611417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354926,"user_name":"Shanks-ç‹å†²","can_delete":false,"product_type":"c1","uid":1042983,"ip_address":"å¹¿ä¸œ","ucode":"C4B90A17850E20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/27/a3737d61.jpg","comment_is_top":false,"comment_ctime":1660886804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660886804","product_id":100085301,"comment_content":"Result&lt;T, io::Error&gt;ï¼ŒT=u8ï¼Œåœ¨2021ç‰ˆå·²ç»ä¼˜åŒ–äº†ï¼Œsizeæ˜¯16ï¼Œè€Œéæ–‡ç« ä¸­è¡¨è¿°çš„24ï¼›è¯„è®ºä¸‹æ–¹è€å¸ˆä¹Ÿæè¿‡ï¼Œæœ‰ä¼˜åŒ–çš„æƒ…å†µä¼šæ˜¯16ï¼Œå¦åˆ™å°±å¾—åŠ ä¸Šå¯¹é½é•¿åº¦8ï¼ˆä¸€èˆ¬è€Œè¨€ 64ä½8å­—èŠ‚å¯¹é½ï¼‰ã€‚","like_count":0},{"had_liked":false,"id":348749,"user_name":"NorthWind","can_delete":false,"product_type":"c1","uid":1037669,"ip_address":"","ucode":"459ADF3B0945E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d5/65/1c9f1530.jpg","comment_is_top":false,"comment_ctime":1655367215,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655367215","product_id":100085301,"comment_content":"æ ¸å¿ƒæ€æƒ³æ„Ÿè§‰æ˜¯ï¼šç”¨æ ˆä¸Šå†…å­˜å¯çŸ¥å¤§å°çš„ç»“æ„æ¥éš”ç¦»å †å†…å­˜å¯å˜ç»“æ„ï¼Œéš”ç¦»å˜åŒ–ã€‚","like_count":0},{"had_liked":false,"id":333092,"user_name":"Geek_05de53","can_delete":false,"product_type":"c1","uid":1494311,"ip_address":"","ucode":"20872B89D6A782","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epdUKuOV21hnfTmXPibv5ReJCCIxiamtzXkibh9p41sSJeYQ87swreLWlTNEibh5ibefsoJfFppOvR088Q/132","comment_is_top":false,"comment_ctime":1644060699,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1644060699","product_id":100085301,"comment_content":"&gt; std::io::Error æ˜¯ 16 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ Result&lt;T, E&gt;ï¼Œå¦‚æœä¸èƒ½ä¼˜åŒ–çš„è¯ï¼Œè¦ä¹ˆæ˜¯ T + 8 ä¸ªå­—èŠ‚ï¼ˆT &gt; 16ï¼‰ï¼Œè¦ä¹ˆæ˜¯ 24 ä¸ªå­—èŠ‚ï¼ˆ16 + 8ï¼‰ã€‚<br><br>è€å¸ˆï¼ŒResultåˆ—ä¸ºä»€ä¹ˆ å½“T &gt; 16æ—¶å°±åªéœ€è¦+8å­—èŠ‚äº†ï¼Ÿè€ŒT &lt; 16æ—¶éœ€è¦+16å­—èŠ‚ï¼Œè¿™é‡Œæ²¡å¤ªç†è§£ã€‚æ˜¯å› ä¸ºå½“T &gt; 16æ—¶å¤ç”¨äº†Tå°¾éƒ¨çš„å­—èŠ‚ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2905523,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDqHQQByGiaXcAk94MdDn3ftupZLXyR6bAKibxOzMxy5h3uBwZ7QiaCiaIfbCMK0cIQfGNax8iawoiaQAg/132","nickname":"nuan","note":"","ucode":"55FF98EB85404D","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549818,"discussion_content":"T&gt;16 æ—¶ æ˜¯ T+8ï¼Œ T&lt;=16 æ—¶æ˜¯ 16+8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644245039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321285,"user_name":"Ignis","can_delete":false,"product_type":"c1","uid":2837051,"ip_address":"","ucode":"94A55C81E2F86C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL7ibAFViaJqhTRquzLKhS0SebmHON4RKeaL9I9R9wKHWt6ehcu0QtN8icvmPicU8wvDYIZiaaxqGWSxlw/132","comment_is_top":false,"comment_ctime":1636738897,"is_pvip":false,"replies":[{"id":"118932","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1639853797,"ip_address":"","comment_id":321285,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636738897","product_id":100085301,"comment_content":"æ–‡ä¸­ç»™å‡ºçš„Cä»£ç ç¤ºä¾‹ï¼Œä¸å¤ªç¬¦åˆCè¯­è¨€æ ‡å‡†ï¼Œå¯èƒ½æœ‰äº›åŒå­¦çš„ç¯å¢ƒç¼–è¯‘ä¼šæœ‰é—®é¢˜ã€‚ä¸»è¦é—®é¢˜ï¼š<br><br>1. å®šé•¿æ•´æ•°ç±»å‹å®šä¹‰åœ¨&lt;stdint.h&gt;å¤´æ–‡ä»¶ä¸­ï¼›<br>2. mainå‡½æ•°çš„è¿”å›å€¼æ˜¯intï¼›<br>3. sizeofè¿”å›çš„ç±»å‹æ˜¯size_tï¼Œåº”è¯¥ç”¨%zuæ¥æ ¼å¼åŒ–ï¼›<br><br>å»ºè®®æ”¹çš„æ›´è§„èŒƒä¸€äº›ï¼š<br><br>```c<br>#include &lt;stdio.h&gt;<br>#include &lt;stdint.h&gt;<br><br>struct S1 {<br>    uint8_t a;<br>    uint16_t b;<br>    uint8_t c;<br>};<br><br>struct S2 {<br>    uint8_t a;<br>    uint8_t c;<br>    uint16_t b;<br>};<br><br>int main(void) {<br>    printf(&quot;size of S1: %zu, S2: %zu\\n&quot;, sizeof(struct S1), sizeof(struct S2));<br>    return 0;<br>}<br>```","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539893,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639853797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321284,"user_name":"Ignis","can_delete":false,"product_type":"c1","uid":2837051,"ip_address":"","ucode":"94A55C81E2F86C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL7ibAFViaJqhTRquzLKhS0SebmHON4RKeaL9I9R9wKHWt6ehcu0QtN8icvmPicU8wvDYIZiaaxqGWSxlw/132","comment_is_top":false,"comment_ctime":1636738642,"is_pvip":false,"replies":[{"id":"118931","content":"å¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1639853785,"ip_address":"","comment_id":321284,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636738642","product_id":100085301,"comment_content":"Result&lt;String,()&gt;å ç”¨çš„å†…å­˜å’ŒStringä¸€æ ·å¤§å°ï¼Œå½“pträ¸ºç©ºæ—¶ï¼Œå°±æ˜¯()ï¼Œå¦åˆ™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539892,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639853785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315757,"user_name":"æ¸æçº¢èŒ¶","can_delete":false,"product_type":"c1","uid":2738941,"ip_address":"","ucode":"03D80953AF984E","user_header":"https://static001.geekbang.org/account/avatar/00/29/ca/fd/4e6dd31c.jpg","comment_is_top":false,"comment_ctime":1633964771,"is_pvip":false,"replies":[{"id":"115290","content":"åŸŸï¼šfield<br>å¯¹é½ï¼šalign<br>é•¿åº¦ï¼šlength","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1635132911,"ip_address":"","comment_id":315757,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1633964771","product_id":100085301,"comment_content":"åŸŸ å¯¹é½é•¿åº¦ è¿™äº›æ¦‚å¿µæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œå¦‚æœèƒ½æ”¾å‡ºè‹±æ–‡æˆ–è€…èµ„æ–™é“¾æ¥ï¼Œèƒ½æ›´å¥½ç†è§£çš„","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528161,"discussion_content":"åŸŸï¼šfield\nå¯¹é½ï¼šalign\né•¿åº¦ï¼šlength","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635132911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2738941,"avatar":"https://static001.geekbang.org/account/avatar/00/29/ca/fd/4e6dd31c.jpg","nickname":"æ¸æçº¢èŒ¶","note":"","ucode":"03D80953AF984E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403199,"discussion_content":"è¿™é‡Œçš„åŸŸæ˜¯structé‡Œå„æˆåˆ†å˜é‡ï¼Œè‹±æ–‡æ˜¯field. \nwe define the names and types of the pieces of data, which we call fields. \nhttps://doc.rust-lang.org/book/ch05-01-defining-structs.html\nè·Ÿå†…å­˜åŸŸçš„æ¦‚å¿µæ˜¯ä¸ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634030807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315292,"user_name":"èŸ‹èŸ€å¤§å”","can_delete":false,"product_type":"c1","uid":2186045,"ip_address":"","ucode":"0FB40046EC3596","user_header":"https://static001.geekbang.org/account/avatar/00/21/5b/3d/634776c9.jpg","comment_is_top":false,"comment_ctime":1633788574,"is_pvip":false,"replies":[{"id":"115301","content":"ç”¨ gcc å¯ä»¥ç¼–è¿‡ï¼ˆæœ‰ä¸€äº› warningï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1635133666,"ip_address":"","comment_id":315292,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633788574","product_id":100085301,"comment_content":"C ä»£ç æ²¡æœ‰ç¼–è¯‘é€šè¿‡ï¼Œ æ”¹æˆä¸‹é¢ç¼–è¯‘è¿‡äº†<br>#include &lt;stdio.h&gt;<br>#include &lt;stdint.h&gt;<br><br>struct S1 { uint8_t a; uint16_t b; uint8_t c;};<br>struct S2 { uint8_t a; uint8_t c; uint16_t b;};<br><br>void main()  { <br>    printf(&quot;size of S1: %d, S2: %d&quot;, sizeof(struct S1), sizeof(struct S2)); <br>}","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527926,"discussion_content":"ç”¨ gcc å¯ä»¥ç¼–è¿‡ï¼ˆæœ‰ä¸€äº› warningï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635133666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312784,"user_name":"newzai","can_delete":false,"product_type":"c1","uid":1102367,"ip_address":"","ucode":"D5E34D427D65FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/1f/2ef2514b.jpg","comment_is_top":false,"comment_ctime":1632012540,"is_pvip":false,"replies":[{"id":"113407","content":"å—¯ã€‚è¿™æ®µæ—¶é—´å…³ç³»ä¸å¯¹ï¼Œåº”è¯¥æŠŠã€Œéšåã€äºŒå­—å»æ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1632240453,"ip_address":"","comment_id":312784,"utype":1}],"discussion_count":2,"race_medal":1,"score":"1632012540","product_id":100085301,"comment_content":"C é‡‡ç”¨äº†æœªå®šä¹‰çš„æ–¹å¼ï¼Œç”±å¼€å‘è€…æ‰‹å·¥æ§åˆ¶ï¼›C++ åœ¨ C çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼Œå¼•å…¥æ™ºèƒ½æŒ‡é’ˆï¼ŒåŠæ‰‹å·¥åŠè‡ªåŠ¨ã€‚éšå Java å’Œ DotNet ä½¿ç”¨ GC å¯¹å †å†…å­˜å…¨é¢æ¥ç®¡ï¼Œå †å†…å­˜è¿›å…¥äº†å—æ§ï¼ˆmanagedï¼‰æ—¶ä»£ã€‚æ‰€è°“å—æ§ä»£ç ï¼ˆmanaged codeï¼‰ï¼Œå°±æ˜¯ä»£ç åœ¨ä¸€ä¸ªâ€œè¿è¡Œæ—¶â€ä¸‹å·¥ä½œï¼Œç”±è¿è¡Œæ—¶æ¥ä¿è¯å †å†…å­˜çš„å®‰å…¨è®¿é—®ã€‚<br><br><br>è¿™æ®µè¯æè¿°é”™è¯¯ï¼ŒC++æ™ºèƒ½æŒ‡é’ˆåœ¨11ç‰ˆæœ¬å¼•å…¥ï¼Œåœ¨ä¹‹å‰è™½ç„¶æœ‰trç‰ˆæœ¬ï¼Œé‚£ä¹Ÿæ˜¯2008å¹´å‰åçš„äº‹æƒ…ï¼Œè€Œjavaï¼ŒC#ä¸€å¼€å±€å°±å¼•å…¥äº†GCï¼ŒjavaC#æ€ä¹ˆå°±å˜æˆäº†åœ¨C++ä¹‹åå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527111,"discussion_content":"å—¯ã€‚è¿™æ®µæ—¶é—´å…³ç³»ä¸å¯¹ï¼Œåº”è¯¥æŠŠã€Œéšåã€äºŒå­—å»æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632240453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154366,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9d/3e/a4112830.jpg","nickname":"å³°","note":"","ucode":"96F6667A57AF3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399561,"discussion_content":"C++ç›¸æ¯”Cåº”è¯¥æ˜¯ä¸€å¼€å§‹æœ‰æ„é€ ææ„, è®©æ ˆä¸Šçš„å¯¹è±¡å¯ä»¥æœ‰æœºä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜.\nåæ¥å¼•å…¥æ™ºèƒ½æŒ‡é’ˆ, è®©å†…å­˜ç®¡ç†æ›´&#34;è‡ªåŠ¨&#34;ä¸€äº›.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632991969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312531,"user_name":"èŒ¶åº•","can_delete":false,"product_type":"c1","uid":1188926,"ip_address":"","ucode":"687DD3686A84D2","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/3e/692a93f7.jpg","comment_is_top":false,"comment_ctime":1631850381,"is_pvip":false,"replies":[{"id":"113269","content":"æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631927334,"ip_address":"","comment_id":312531,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1631850381","product_id":100085301,"comment_content":"string ptr ä¸º0 è¡¨ç¤º (),æ‰€ä»¥æ˜¯24","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527004,"discussion_content":"æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631927334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2755534,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0b/ce/f0c520d1.jpg","nickname":"é¹…å¸®é€®","note":"","ucode":"A6DB1BEFDA5D9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533643,"discussion_content":"Stringä¸ºä»€ä¹ˆæ˜¯8ä¸ªå­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637922943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312335,"user_name":"Kerry","can_delete":false,"product_type":"c1","uid":2061524,"ip_address":"","ucode":"92F809EC998FC6","user_header":"https://static001.geekbang.org/account/avatar/00/1f/74/d4/38d813f0.jpg","comment_is_top":false,"comment_ctime":1631758500,"is_pvip":false,"replies":[{"id":"113198","content":"å¯¹ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631802337,"ip_address":"","comment_id":312335,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631758500","product_id":100085301,"comment_content":"println!(&quot;sizeof Result&lt;String, ()&gt;: {}&quot;, size_of::&lt;Result&lt;String, ()&gt;&gt;());<br><br>sizeof Result&lt;String, ()&gt;: 24<br><br>ä¼˜åŒ–æ€è·¯åº”è¯¥æ˜¯è·ŸOption&lt;T&gt;ç±»ä¼¼ã€‚Result&lt;String, ()&gt;çš„false caseæ˜¯()ï¼Œå°±ç›¸å½“äºæ˜¯Option&lt;String&gt;ï¼Œå¯ä»¥ç”¨Stringé‡Œçš„ptrçš„å€¼æ¥å®ç°é›¶æˆæœ¬æŠ½è±¡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526942,"discussion_content":"å¯¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631802337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312273,"user_name":"è®°äº‹æœ¬","can_delete":false,"product_type":"c1","uid":1401568,"ip_address":"","ucode":"FA942636EE0CC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/62/e0/d2ff52da.jpg","comment_is_top":false,"comment_ctime":1631712951,"is_pvip":false,"replies":[{"id":"113164","content":"ä½ å¯ä»¥è¿è¡Œä¸€ä¸‹æ–‡ä¸­çš„ä»£ç ï¼Œçœ‹çœ‹å®ƒå¤šå¤§ï¼ˆ24 å­—èŠ‚ï¼‰ã€‚æˆ‘åœ¨ä¹‹å‰çš„å›å¤ä¸­è¯¦ç»†è®²äº†ä¸ºä»€ä¹ˆæ˜¯ 24ã€‚ä½ å¯ä»¥çœ‹çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631758569,"ip_address":"","comment_id":312273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631712951","product_id":100085301,"comment_content":"Result&lt;String, ()&gt; å ç”¨å¤šå°‘å†…å­˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526921,"discussion_content":"ä½ å¯ä»¥è¿è¡Œä¸€ä¸‹æ–‡ä¸­çš„ä»£ç ï¼Œçœ‹çœ‹å®ƒå¤šå¤§ï¼ˆ24 å­—èŠ‚ï¼‰ã€‚æˆ‘åœ¨ä¹‹å‰çš„å›å¤ä¸­è¯¦ç»†è®²äº†ä¸ºä»€ä¹ˆæ˜¯ 24ã€‚ä½ å¯ä»¥çœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631758569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312195,"user_name":"noisyes","can_delete":false,"product_type":"c1","uid":2538540,"ip_address":"","ucode":"94EC310B284AD2","user_header":"https://static001.geekbang.org/account/avatar/00/26/bc/2c/963688bb.jpg","comment_is_top":false,"comment_ctime":1631677589,"is_pvip":false,"replies":[{"id":"113169","content":"ä¸ä¼šã€‚move å‡ºç°çš„åœºåˆéƒ½å‘ç”Ÿåœ¨æ ˆå¸§ä¸Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631761675,"ip_address":"","comment_id":312195,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1631677589","product_id":100085301,"comment_content":"moveæ˜¯ä¼šæŠŠæ ˆå†…å­˜å¯¹è±¡è½¬ç§»åˆ°å †å†…å­˜ä¸Šå—ï¼Ÿè¿˜æ˜¯åªæ˜¯æ‰€æœ‰æƒçš„äº¤æ¥å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526892,"discussion_content":"ä¸ä¼šã€‚move å‡ºç°çš„åœºåˆéƒ½å‘ç”Ÿåœ¨æ ˆå¸§ä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631761675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1206690,"avatar":"https://static001.geekbang.org/account/avatar/00/12/69/a2/c30ac459.jpg","nickname":"hughieyu","note":"","ucode":"FC1A64B2BAB784","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394053,"discussion_content":"moveä¹Ÿæ˜¯æ ˆä¸ŠæŒ‰ä½å¤åˆ¶ï¼Œåªæ˜¯é™åˆ¶äº†å¯¹åŸå§‹å€¼çš„è®¿é—®ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ‰€æœ‰æƒçš„äº¤æ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631700939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312148,"user_name":"Arthur","can_delete":false,"product_type":"c1","uid":1784009,"ip_address":"","ucode":"1C064405490769","user_header":"https://static001.geekbang.org/account/avatar/00/1b/38/c9/63ea8fe6.jpg","comment_is_top":false,"comment_ctime":1631665938,"is_pvip":true,"replies":[{"id":"113121","content":"æ‰€ä»¥å¯¹äº Option&lt;u8&gt;ï¼Œå…¶é•¿åº¦æ˜¯ 1 + 1 = 2 å­—èŠ‚ï¼Œè€Œ Option&lt;f64&gt;ï¼Œé•¿åº¦æ˜¯ 8 + 8 =16 å­—èŠ‚ã€‚åº”è¯¥æ˜¯æ›´æ–°çš„é—®é¢˜ï¼Œæˆ‘è·Ÿç¼–è¾‘è¯´ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1631670343,"ip_address":"","comment_id":312148,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1631665938","product_id":100085301,"comment_content":"&quot;æ ¹æ®åˆšæ‰è¯´çš„ä¸‰æ¡å¯¹é½è§„åˆ™ï¼Œtag åçš„å†…å­˜ï¼Œä¼šæ ¹æ®å…¶å¯¹é½å¤§å°è¿›è¡Œå¯¹é½ï¼Œæ‰€ä»¥å¯¹äº Optionï¼Œå…¶é•¿åº¦æ˜¯ 1 + 1 = 2 å­—èŠ‚ï¼Œè€Œ Optionï¼Œé•¿åº¦æ˜¯ 8 + 8 =16 å­—èŠ‚ã€‚&quot;<br><br>æ­¤å¤„æ˜¯ä¸æ˜¯æœ‰ç¬”è¯¯ï¼Œå¹¶æ²¡æœ‰çœ‹æ‡‚ä¸¤ä¸ªOptionä¸ºä»€ä¹ˆå¤§å°ä¸ä¸€æ ·äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526879,"discussion_content":"æ‰€ä»¥å¯¹äº Option&amp;lt;u8&amp;gt;ï¼Œå…¶é•¿åº¦æ˜¯ 1 + 1 = 2 å­—èŠ‚ï¼Œè€Œ Option&amp;lt;f64&amp;gt;ï¼Œé•¿åº¦æ˜¯ 8 + 8 =16 å­—èŠ‚ã€‚åº”è¯¥æ˜¯æ›´æ–°çš„é—®é¢˜ï¼Œæˆ‘è·Ÿç¼–è¾‘è¯´ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631670343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024788,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a3/14/1f03f07d.jpg","nickname":"æ‡’èˆèˆ","note":"","ucode":"574F2CF1A705F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393956,"discussion_content":"å¯¹äºu8çš„  Optionï¼Œå…¶é•¿åº¦æ˜¯ 1 + 1 = 2 å­—èŠ‚ï¼Œè€Œ f64çš„Optionï¼Œé•¿åº¦æ˜¯ 8 + 8 =16 å­—èŠ‚ã€‚ å¯¹äºå¼•ç”¨å‹ç±»å‹çš„Option é•¿åº¦å¹¶æ²¡æœ‰å¢åŠ å­—æ®µï¼Œæ˜¯å› ä¸ºåšäº†ä¼˜åŒ–ï¼Œå¤ç”¨å¼•ç”¨ç±»å‹ä¸­çš„æŒ‡é’ˆï¼šå½“å…¶ä¸º 0 æ—¶ï¼Œè¡¨ç¤º Noneï¼Œå¦åˆ™æ˜¯ Someã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631670570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320487,"avatar":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","nickname":"ç½—æ°","note":"","ucode":"96BAFAA147341F","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393952,"discussion_content":"å—¯ å¥½åƒæ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631669804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}