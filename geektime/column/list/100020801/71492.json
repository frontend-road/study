{"id":71492,"title":"11 |  怎么给字符串字段加索引？","content":"<p>现在，几乎所有的系统都支持邮箱登录，如何在邮箱这样的字段上建立合理的索引，是我们今天要讨论的问题。</p><p>假设，你现在维护一个支持邮箱登录的系统，用户表是这么定义的：</p><pre><code>mysql&gt; create table SUser(\nID bigint unsigned primary key,\nemail varchar(64), \n... \n)engine=innodb; \n</code></pre><p>由于要使用邮箱登录，所以业务代码中一定会出现类似于这样的语句：</p><pre><code>mysql&gt; select f1, f2 from SUser where email='xxx';\n</code></pre><p>从第4和第5篇讲解索引的文章中，我们可以知道，如果email这个字段上没有索引，那么这个语句就只能做全表扫描。</p><p>同时，MySQL是支持前缀索引的，也就是说，你可以定义字符串的一部分作为索引。默认地，如果你创建索引的语句不指定前缀长度，那么索引就会包含整个字符串。</p><p>比如，这两个在email字段上创建索引的语句：</p><pre><code>mysql&gt; alter table SUser add index index1(email);\n或\nmysql&gt; alter table SUser add index index2(email(6));\n</code></pre><p>第一个语句创建的index1索引里面，包含了每个记录的整个字符串；而第二个语句创建的index2索引里面，对于每个记录都是只取前6个字节。</p><p>那么，这两种不同的定义在数据结构和存储上有什么区别呢？如图2和3所示，就是这两个索引的示意图。</p><p><img src=\"https://static001.geekbang.org/resource/image/d3/b7/d31da662bee595991862c439a5567eb7.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">图1 email 索引结构</span></center><p><img src=\"https://static001.geekbang.org/resource/image/13/42/134583875561de914991fc2e192cf842.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">图2 email(6) 索引结构</span></center><p>从图中你可以看到，由于email(6)这个索引结构中每个邮箱字段都只取前6个字节（即：zhangs），所以占用的空间会更小，这就是使用前缀索引的优势。</p><!-- [[[read_end]]] --><p>但，这同时带来的损失是，可能会增加额外的记录扫描次数。</p><p>接下来，我们再看看下面这个语句，在这两个索引定义下分别是怎么执行的。</p><pre><code>select id,name,email from SUser where email='zhangssxyz@xxx.com';\n</code></pre><p><strong>如果使用的是index1</strong>（即email整个字符串的索引结构），执行顺序是这样的：</p><ol>\n<li>\n<p>从index1索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得ID2的值；</p>\n</li>\n<li>\n<p>到主键上查到主键值是ID2的行，判断email的值是正确的，将这行记录加入结果集；</p>\n</li>\n<li>\n<p>取index1索引树上刚刚查到的位置的下一条记录，发现已经不满足email='zhangssxyz@xxx.com’的条件了，循环结束。</p>\n</li>\n</ol><p>这个过程中，只需要回主键索引取一次数据，所以系统认为只扫描了一行。</p><p><strong>如果使用的是index2</strong>（即email(6)索引结构），执行顺序是这样的：</p><ol>\n<li>\n<p>从index2索引树找到满足索引值是’zhangs’的记录，找到的第一个是ID1；</p>\n</li>\n<li>\n<p>到主键上查到主键值是ID1的行，判断出email的值不是’zhangssxyz@xxx.com’，这行记录丢弃；</p>\n</li>\n<li>\n<p>取index2上刚刚查到的位置的下一条记录，发现仍然是’zhangs’，取出ID2，再到ID索引上取整行然后判断，这次值对了，将这行记录加入结果集；</p>\n</li>\n<li>\n<p>重复上一步，直到在idxe2上取到的值不是’zhangs’时，循环结束。</p>\n</li>\n</ol><p>在这个过程中，要回主键索引取4次数据，也就是扫描了4行。</p><p>通过这个对比，你很容易就可以发现，使用前缀索引后，可能会导致查询语句读数据的次数变多。</p><p>但是，对于这个查询语句来说，如果你定义的index2不是email(6)而是email(7），也就是说取email字段的前7个字节来构建索引的话，即满足前缀’zhangss’的记录只有一个，也能够直接查到ID2，只扫描一行就结束了。</p><p>也就是说<strong>使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。</strong></p><p>于是，你就有个问题：当要给字符串创建前缀索引时，有什么方法能够确定我应该使用多长的前缀呢？</p><p>实际上，我们在建立索引时关注的是区分度，区分度越高越好。因为区分度越高，意味着重复的键值越少。因此，我们可以通过统计索引上有多少个不同的值来判断要使用多长的前缀。</p><p>首先，你可以使用下面这个语句，算出这个列上有多少个不同的值：</p><pre><code>mysql&gt; select count(distinct email) as L from SUser;\n</code></pre><p>然后，依次选取不同长度的前缀来看这个值，比如我们要看一下4~7个字节的前缀索引，可以用这个语句：</p><pre><code>mysql&gt; select \n  count(distinct left(email,4)）as L4,\n  count(distinct left(email,5)）as L5,\n  count(distinct left(email,6)）as L6,\n  count(distinct left(email,7)）as L7,\nfrom SUser;\n</code></pre><p>当然，使用前缀索引很可能会损失区分度，所以你需要预先设定一个可以接受的损失比例，比如5%。然后，在返回的L4~L7中，找出不小于 L * 95%的值，假设这里L6、L7都满足，你就可以选择前缀长度为6。</p><h1>前缀索引对覆盖索引的影响</h1><p>前面我们说了使用前缀索引可能会增加扫描行数，这会影响到性能。其实，前缀索引的影响不止如此，我们再看一下另外一个场景。</p><p>你先来看看这个SQL语句：</p><pre><code>select id,email from SUser where email='zhangssxyz@xxx.com';\n</code></pre><p>与前面例子中的SQL语句</p><pre><code>select id,name,email from SUser where email='zhangssxyz@xxx.com';\n</code></pre><p>相比，这个语句只要求返回id和email字段。</p><p>所以，如果使用index1（即email整个字符串的索引结构）的话，可以利用覆盖索引，从index1查到结果后直接就返回了，不需要回到ID索引再去查一次。而如果使用index2（即email(6)索引结构）的话，就不得不回到ID索引再去判断email字段的值。</p><p>即使你将index2的定义修改为email(18)的前缀索引，这时候虽然index2已经包含了所有的信息，但InnoDB还是要回到id索引再查一下，因为系统并不确定前缀索引的定义是否截断了完整信息。</p><p>也就是说，使用前缀索引就用不上覆盖索引对查询性能的优化了，这也是你在选择是否使用前缀索引时需要考虑的一个因素。</p><h1>其他方式</h1><p>对于类似于邮箱这样的字段来说，使用前缀索引的效果可能还不错。但是，遇到前缀的区分度不够好的情况时，我们要怎么办呢？</p><p>比如，我们国家的身份证号，一共18位，其中前6位是地址码，所以同一个县的人的身份证号前6位一般会是相同的。</p><p>假设你维护的数据库是一个市的公民信息系统，这时候如果对身份证号做长度为6的前缀索引的话，这个索引的区分度就非常低了。</p><p>按照我们前面说的方法，可能你需要创建长度为12以上的前缀索引，才能够满足区分度要求。</p><p>但是，索引选取的越长，占用的磁盘空间就越大，相同的数据页能放下的索引值就越少，搜索的效率也就会越低。</p><p>那么，如果我们能够确定业务需求里面只有按照身份证进行等值查询的需求，还有没有别的处理方法呢？这种方法，既可以占用更小的空间，也能达到相同的查询效率。</p><p>答案是，有的。</p><p><strong>第一种方式是使用倒序存储。</strong>如果你存储身份证号的时候把它倒过来存，每次查询的时候，你可以这么写：</p><pre><code>mysql&gt; select field_list from t where id_card = reverse('input_id_card_string');\n</code></pre><p>由于身份证号的最后6位没有地址码这样的重复逻辑，所以最后这6位很可能就提供了足够的区分度。当然了，实践中你不要忘记使用count(distinct)方法去做个验证。</p><p><strong>第二种方式是使用hash字段。</strong>你可以在表上再创建一个整数字段，来保存身份证的校验码，同时在这个字段上创建索引。</p><pre><code>mysql&gt; alter table t add id_card_crc int unsigned, add index(id_card_crc);\n</code></pre><p>然后每次插入新记录的时候，都同时用crc32()这个函数得到校验码填到这个新字段。由于校验码可能存在冲突，也就是说两个不同的身份证号通过crc32()函数得到的结果可能是相同的，所以你的查询语句where部分要判断id_card的值是否精确相同。</p><pre><code>mysql&gt; select field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string'\n</code></pre><p>这样，索引的长度变成了4个字节，比原来小了很多。</p><p>接下来，我们再一起看看<strong>使用倒序存储和使用hash字段这两种方法的异同点。</strong></p><p>首先，它们的相同点是，都不支持范围查询。倒序存储的字段上创建的索引是按照倒序字符串的方式排序的，已经没有办法利用索引方式查出身份证号码在[ID_X, ID_Y]的所有市民了。同样地，hash字段的方式也只能支持等值查询。</p><p>它们的区别，主要体现在以下三个方面：</p><ol>\n<li>\n<p>从占用的额外空间来看，倒序存储方式在主键索引上，不会消耗额外的存储空间，而hash字段方法需要增加一个字段。当然，倒序存储方式使用4个字节的前缀长度应该是不够的，如果再长一点，这个消耗跟额外这个hash字段也差不多抵消了。</p>\n</li>\n<li>\n<p>在CPU消耗方面，倒序方式每次写和读的时候，都需要额外调用一次reverse函数，而hash字段的方式需要额外调用一次crc32()函数。如果只从这两个函数的计算复杂度来看的话，reverse函数额外消耗的CPU资源会更小些。</p>\n</li>\n<li>\n<p>从查询效率上看，使用hash字段方式的查询性能相对更稳定一些。因为crc32算出来的值虽然有冲突的概率，但是概率非常小，可以认为每次查询的平均扫描行数接近1。而倒序存储方式毕竟还是用的前缀索引的方式，也就是说还是会增加扫描行数。</p>\n</li>\n</ol><h1>小结</h1><p>在今天这篇文章中，我跟你聊了聊字符串字段创建索引的场景。我们来回顾一下，你可以使用的方式有：</p><ol>\n<li>\n<p>直接创建完整索引，这样可能比较占用空间；</p>\n</li>\n<li>\n<p>创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引；</p>\n</li>\n<li>\n<p>倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题；</p>\n</li>\n<li>\n<p>创建hash字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描。</p>\n</li>\n</ol><p>在实际应用中，你要根据业务字段的特点选择使用哪种方式。</p><p>好了，又到了最后的问题时间。</p><p>如果你在维护一个学校的学生信息数据库，学生登录名的统一格式是”学号@gmail.com\", 而学号的规则是：十五位的数字，其中前三位是所在城市编号、第四到第六位是学校编号、第七位到第十位是入学年份、最后五位是顺序编号。</p><p>系统登录的时候都需要学生输入登录名和密码，验证正确后才能继续使用系统。就只考虑登录验证这个行为的话，你会怎么设计这个登录名的索引呢？</p><p>你可以把你的分析思路和设计结果写在留言区里，我会在下一篇文章的末尾和你讨论这个问题。感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><h1>上期问题时间</h1><p>上篇文章中的第一个例子，评论区有几位同学说没有复现，大家要检查一下隔离级别是不是RR（Repeatable Read，可重复读），创建的表t是不是InnoDB引擎。我把复现过程做成了一个视频，供你参考。</p><p><video preload=\"none\" controls=\"\"><source src=\"https://static001.geekbang.org/resource/video/2a/76/2a3ac914a325cdff1ca6ba999d1b8c76.mp4\" type=\"video/mp4\"><source src=\"https://res001.geekbang.org/media/video/2a/76/2a3ac914a325cdff1ca6ba999d1b8c76/sd/sd.m3u8\" type=\"application/x-mpegURL\"><source src=\"https://res001.geekbang.org/media/video/2a/76/2a3ac914a325cdff1ca6ba999d1b8c76/hd/hd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>在上一篇文章最后，我给你留的问题是，为什么经过这个操作序列，explain的结果就不对了？这里，我来为你分析一下原因。</p><p>delete 语句删掉了所有的数据，然后再通过call idata()插入了10万行数据，看上去是覆盖了原来的10万行。</p><p>但是，session A开启了事务并没有提交，所以之前插入的10万行数据是不能删除的。这样，之前的数据每一行数据都有两个版本，旧版本是delete之前的数据，新版本是标记为deleted的数据。</p><p>这样，索引a上的数据其实就有两份。</p><p>然后你会说，不对啊，主键上的数据也不能删，那没有使用force index的语句，使用explain命令看到的扫描行数为什么还是100000左右？（潜台词，如果这个也翻倍，也许优化器还会认为选字段a作为索引更合适）</p><p>是的，不过这个是主键，主键是直接按照表的行数来估计的。而表的行数，优化器直接用的是show table status的值。</p><p>这个值的计算方法，我会在后面有文章为你详细讲解。</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/67/e0e4c8381f3feae4d87958470760d367.png?wh=1400*679\" alt=\"\"><br>\n评论区留言点赞板：</p><blockquote>\n<p>@斜面镜子 Bill 的评论最接近答案；<br>\n@某、人 做了两个很不错的对照试验；<br>\n@ye7zi 等几位同学很认真的验证，赞态度。大家的机器如果IO能力比较差的话，做这个验证的时候，可以把innodb_flush_log_at_trx_commit 和 sync_binlog 都设置成0。</p>\n</blockquote><p></p>","comments":[{"had_liked":false,"id":47990,"user_name":"封建的风","can_delete":false,"product_type":"c1","uid":1302600,"ip_address":"","ucode":"811C24F093AF0F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/48/3d72e81c.jpg","comment_is_top":false,"comment_ctime":1544282609,"is_pvip":false,"replies":[{"id":"17096","content":"从业务量预估优化和收益，这个意识很好呢👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544331361,"ip_address":"","comment_id":47990,"utype":1}],"discussion_count":32,"race_medal":0,"score":"2720258580977","product_id":100020801,"comment_content":"原谅我偷懒的想法，一个学校每年预估2万新生，50年才100万记录，能节省多少空间，直接全字段索引。省去了开发转换及局限性风险，碰到超大量迫不得已再用后两种办法","like_count":634,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117233,"discussion_content":"脱离业务谈技术方案都是耍流氓，哈哈哈","likes_number":49,"is_delete":false,"is_hidden":false,"ctime":1578103636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1765527,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/f0/97/905050b4.jpg","nickname":"小【Z】～D男","note":"","ucode":"EEE97C5FAD07A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":247193,"discussion_content":"我可能读书读傻了,还是兄台高见","likes_number":39,"is_delete":false,"is_hidden":false,"ctime":1587804941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2232546,"avatar":"https://static001.geekbang.org/account/avatar/00/22/10/e2/35f2fc23.jpg","nickname":"吉法师","note":"","ucode":"F1E3F4F526CA13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345913,"discussion_content":"说个直白点的话，如果哪个公司是给学校和机关做系统的，其实挺low的，学不到啥技术，给的钱也相对低。\n\n但工作量未必比互联网的少。","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1611813221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":2453498,"avatar":"https://static001.geekbang.org/account/avatar/00/25/6f/fa/615a0df3.jpg","nickname":"小周","note":"","ucode":"7ED7BC27A46C4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2232546,"avatar":"https://static001.geekbang.org/account/avatar/00/22/10/e2/35f2fc23.jpg","nickname":"吉法师","note":"","ucode":"F1E3F4F526CA13","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384915,"discussion_content":"艹，我现在待的公司就是学校和机关两条产品线，你这直接给我整破防了","likes_number":28,"is_delete":false,"is_hidden":false,"ctime":1626791455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345913,"ip_address":""},"score":384915,"extra":""},{"author":{"id":1061161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/31/29/44b9e36a.jpg","nickname":"zack","note":"","ucode":"DC5E2354E0EC78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2453498,"avatar":"https://static001.geekbang.org/account/avatar/00/25/6f/fa/615a0df3.jpg","nickname":"小周","note":"","ucode":"7ED7BC27A46C4C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533648,"discussion_content":"😂 吉法师 直白了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637924755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":384915,"ip_address":""},"score":533648,"extra":""},{"author":{"id":1066189,"avatar":"https://static001.geekbang.org/account/avatar/00/10/44/cd/b8673fc2.jpg","nickname":"薛定谔猫🐈","note":"","ucode":"A3210DAC2CD7BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2453498,"avatar":"https://static001.geekbang.org/account/avatar/00/25/6f/fa/615a0df3.jpg","nickname":"小周","note":"","ucode":"7ED7BC27A46C4C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548652,"discussion_content":"跑路没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643292810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":384915,"ip_address":""},"score":548652,"extra":""}]},{"author":{"id":2038589,"avatar":"","nickname":"Geek_ssswww","note":"","ucode":"135BE6E18507C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293420,"discussion_content":"我也这么觉得，很多业务量都没大到那种程度","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1595525766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34259,"discussion_content":"太秀了，抬走哈哈哈","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1571188297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1357623,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJmBKrLvqOIXDDbj3ocEIJzqsQx2e5VLDBSX6LmofYtprWwKaVAmHUqU2z3mjREHX8n9eLLiavlPg/132","nickname":"wg1993","note":"","ucode":"D5112FEFDB1DF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":86929,"discussion_content":"老艿艿？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576632807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":34259,"ip_address":""},"score":86929,"extra":""},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1357623,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJmBKrLvqOIXDDbj3ocEIJzqsQx2e5VLDBSX6LmofYtprWwKaVAmHUqU2z3mjREHX8n9eLLiavlPg/132","nickname":"wg1993","note":"","ucode":"D5112FEFDB1DF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87077,"discussion_content":"嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576641365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":86929,"ip_address":""},"score":87077,"extra":""}]},{"author":{"id":1650748,"avatar":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","nickname":"盘胧","note":"","ucode":"5386CC4C92ECC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216126,"discussion_content":"是在下输了","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1585406882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431976,"discussion_content":"从业务量预估优化和收益，这个意识很好呢👍🏿","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1544331361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2449618,"avatar":"https://static001.geekbang.org/account/avatar/00/25/60/d2/02a5b667.jpg","nickname":"如是我闻，一时","note":"","ucode":"2989772EEDAB9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354132,"discussion_content":"想法很好，但这只是1座城市1所学校的数据量","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615251921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2862052,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/ab/e4/9c64475b.jpg","nickname":"听风","note":"","ucode":"4BB3F3F790825B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2449618,"avatar":"https://static001.geekbang.org/account/avatar/00/25/60/d2/02a5b667.jpg","nickname":"如是我闻，一时","note":"","ucode":"2989772EEDAB9B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537346,"discussion_content":"就算一个城市也达不到多少的并发, 你一年看过能有10次教务在线吗?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639039370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":354132,"ip_address":""},"score":537346,"extra":""},{"author":{"id":2622364,"avatar":"https://static001.geekbang.org/account/avatar/00/28/03/9c/5a0b8825.jpg","nickname":"Bin Watson","note":"","ucode":"33E3487896E859","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2862052,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/ab/e4/9c64475b.jpg","nickname":"听风","note":"","ucode":"4BB3F3F790825B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548891,"discussion_content":"所以一到抢课全盘崩溃","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1643438194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537346,"ip_address":""},"score":548891,"extra":""}]},{"author":{"id":1834181,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/fc/c5/ff8b770e.jpg","nickname":"BugBean","note":"","ucode":"B51232281AD9BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258152,"discussion_content":"你说的对，根本不用加索引哈哈","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588653785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1158349,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/cd/fda6374f.jpg","nickname":"Louis","note":"","ucode":"BC667839F17937","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1834181,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/fc/c5/ff8b770e.jpg","nickname":"BugBean","note":"","ucode":"B51232281AD9BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281605,"discussion_content":" 别人的意思是不用加前缀索引 不是不用加索引哈哈","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1591774940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":258152,"ip_address":""},"score":281605,"extra":""},{"author":{"id":2369545,"avatar":"https://static001.geekbang.org/account/avatar/00/24/28/09/0ac42cff.jpg","nickname":"慕苏","note":"","ucode":"7ED14D00429C21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1834181,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/fc/c5/ff8b770e.jpg","nickname":"BugBean","note":"","ucode":"B51232281AD9BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335690,"discussion_content":"。。哈哈啊哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608274946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":258152,"ip_address":""},"score":335690,"extra":""}]},{"author":{"id":1155036,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9f/dc/fec470a0.jpg","nickname":"飞来横肉","note":"","ucode":"836E342BAAE170","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374305,"discussion_content":"遇到过类似的问题，线上数据和我们本地开发环境的数据都不是很大，然后没有添加索引。但是有天测试说，他们的测试环境的查询特别慢。看了表之后，他们把数据量做到特别大……","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621131900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2171958,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibdLHjEF6Xe5jBrsrUjRWFpgXXpLkVdHofLbILGBGfbwSbFudJM8ecDl5wZFOESy7a67ZicjZSeCQUvWt2koibk1g/132","nickname":"Geek_726d9a","note":"","ucode":"A4E794BF6A4E6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":314503,"discussion_content":"每个学生一年不可能只登陆一次哇 = = 极端一点 每个学生一周登录一次 50万也得将近4800万数据  不过也还是不多哈哈哈哈 ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603163739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1015189,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/95/dd73022c.jpg","nickname":"我是曾经那个少年","note":"","ucode":"9F02F7FF147D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2171958,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibdLHjEF6Xe5jBrsrUjRWFpgXXpLkVdHofLbILGBGfbwSbFudJM8ecDl5wZFOESy7a67ZicjZSeCQUvWt2koibk1g/132","nickname":"Geek_726d9a","note":"","ucode":"A4E794BF6A4E6D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334274,"discussion_content":"数据还是50W，你说的这个是QPS吧。和数据存储方案没啥关系哈。","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1607782055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":314503,"ip_address":""},"score":334274,"extra":""}]},{"author":{"id":2036694,"avatar":"","nickname":"Geek_a0f064","note":"","ucode":"7A44BE8B5BDF39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283281,"discussion_content":"哈哈哈哈，优秀","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592227869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1895744,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxUlVydHpM5PNRvg9C29H0cQQ0Uby1LZyK5hdn9sqUy1OGOpVOfMHYn578WyYiaCNOrzcaor6KzjQ/132","nickname":"Geek_b403af","note":"","ucode":"686D2606E47EF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":247702,"discussion_content":"你说得对","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587822536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204057,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5f/59/57a7a896.jpg","nickname":"暂且听风","note":"","ucode":"F4CAFC0920CBC4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":72680,"discussion_content":"你说的对","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575515120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003327,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4f/3f/6f62f982.jpg","nickname":"王坤祥","note":"","ucode":"FB988B9F381A33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410301,"discussion_content":"非常有道理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635655094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1731047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/GmtqEx7x5hagZtXbd8Xs8ocUuHHLGIgiaqTwTcibPnpla1PVTbed2Ax7ZfzCjN2Qpeyao6ogq7L3icLzSB3vY1rlg/132","nickname":"Chanson","note":"","ucode":"74B3B180B4B953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355961,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615512582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2449618,"avatar":"https://static001.geekbang.org/account/avatar/00/25/60/d2/02a5b667.jpg","nickname":"如是我闻，一时","note":"","ucode":"2989772EEDAB9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354114,"discussion_content":"，，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615251726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306307,"discussion_content":"优秀。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600242589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1099706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c7/ba/4c449be2.jpg","nickname":"zhaozp","note":"","ucode":"BF390F5ED762CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38685,"discussion_content":"赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571818759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1214194,"avatar":"https://static001.geekbang.org/account/avatar/00/12/86/f2/82315f2c.jpg","nickname":"张建东","note":"","ucode":"17B6477E697D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5822,"discussion_content":"！！！哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566473520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47549,"user_name":"老杨同志","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1544153187,"is_pvip":false,"replies":[{"id":"16955","content":"Bigint 8 个字节哦，赞思路。<br><br>嗯问题不是唯一答案，大家集思广益哈","user_name":"作者回复","comment_id":47549,"uid":"1264162","ip_address":"","utype":1,"ctime":1544159850,"user_name_real":"林晓斌"}],"discussion_count":9,"race_medal":0,"score":"525530163299","product_id":100020801,"comment_content":"老师整篇都讲的是字符串索引，但是思考题的学号比较特殊，15位数字+固定后缀“@gmail.com”<br>这种特殊的情况，可以把学号使用bigint存储,占4个字节，比前缀索引空间占用要小。跟hash索引比，<br>也有区间查询的优势","like_count":122,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431804,"discussion_content":"Bigint 8 个字节哦，赞思路。\n\n嗯问题不是唯一答案，大家集思广益哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544159850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1232527,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/8f/6daf02db.jpg","nickname":"心灵捕手","note":"","ucode":"6D0BC463A000C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382358,"discussion_content":"思路很不错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625542437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074742,"avatar":"https://static001.geekbang.org/account/avatar/00/10/66/36/b4a4e6fb.jpg","nickname":"Edon du","note":"","ucode":"1648624751AAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339894,"discussion_content":"思路是很赞，但固定后缀有局限性了，如果做平台的话，不可能只对接一个厂商的邮箱。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609834092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"洗洗睡吧","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1074742,"avatar":"https://static001.geekbang.org/account/avatar/00/10/66/36/b4a4e6fb.jpg","nickname":"Edon du","note":"","ucode":"1648624751AAE9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387710,"discussion_content":"那就15位数字+2位数字，2位数字可以表达99种邮箱了，应该够用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628374110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339894,"ip_address":""},"score":387710,"extra":""},{"author":{"id":1686405,"avatar":"https://static001.geekbang.org/account/avatar/00/19/bb/85/60af36ed.jpg","nickname":"sch_","note":"","ucode":"CFB9B457DD951C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1641326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDdmHm6txEVtEXEDibSdIsRLEpghOoMt2kfZHetY9QLWHygicKCfhVoYiaylAZJoXbcCMBhXqMF4icgw/132","nickname":"洗洗睡吧","note":"","ucode":"DE7F8B4CA512F6","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":390663,"discussion_content":"把邮箱转为数字需要维护 邮箱和数字的映射关系，而且 99 种如果不够用呢？在加一位数字刷库吗？这种情况我认为为后缀单独建一个列，建立联合索引比较合适","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1629963687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387710,"ip_address":""},"score":390663,"extra":""},{"author":{"id":1035917,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ce/8d/759e3bfb.jpg","nickname":"dengup","note":"","ucode":"CF82F232CA35BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1686405,"avatar":"https://static001.geekbang.org/account/avatar/00/19/bb/85/60af36ed.jpg","nickname":"sch_","note":"","ucode":"CFB9B457DD951C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536795,"discussion_content":"赞同你的思路，邮箱后缀单独一个varchar字段，则更加通用，映射也是需要开销的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1638868901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":390663,"ip_address":""},"score":536795,"extra":""}]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Java垒墙工程师","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299971,"discussion_content":"把年份调整到后面，年份也是固定长度的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597891247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098916,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a4/b9b12d71.jpg","nickname":"刺客","note":"","ucode":"607ABD2F2B5898","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216684,"discussion_content":"思路太赞了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585477247,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47432,"user_name":"小文","can_delete":false,"product_type":"c1","uid":1198258,"ip_address":"","ucode":"4D6257B8D63FA4","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/b2/cca85581.jpg","comment_is_top":false,"comment_ctime":1544143844,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"400976102372","product_id":100020801,"comment_content":"首先排除全部索引，占空间，其次排除前缀索引，区分度不高，再排除倒序索引，区分度还没前缀索引高。<br>最后hash索引适合，而且只是登录检验，不需要范围查询。","like_count":93,"discussions":[{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284802,"discussion_content":"你这样不分应用场景的直接抛出答案，一般都不会让人满意的，如果说，应用场景是都采用电脑教室教学，每节课上课时学生都需要使用电脑登录教学系统，或者别的类似需要大量验证的场景，此时你还会觉得建立一个联合索引进行索引覆盖浪费一点空间代价高吗？","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1592644592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1250807,"avatar":"https://static001.geekbang.org/account/avatar/00/13/15/f7/744720a2.jpg","nickname":"DriveMan_邱佳源","note":"","ucode":"A4C83BF07DEE7A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131021,"discussion_content":"倒数索引后取五位数做索引，最多也就是花费五个字节+reverse()函数性能；但是添加hash字段需要花费四个字节+crc32()函数，crc32()比reverse()耗费大的资源不是一丁半点","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1578819669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1739834,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/eBicObx4oYda2xhxI98OiayPvx0sJiaNFT94PuuaDjckf5icmibdkBDBNv41IvPV43QryKOQyUlasl3OolPGaeBTvnw/132","nickname":"study more","note":"","ucode":"9E6BF84AC0F806","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1250807,"avatar":"https://static001.geekbang.org/account/avatar/00/13/15/f7/744720a2.jpg","nickname":"DriveMan_邱佳源","note":"","ucode":"A4C83BF07DEE7A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201612,"discussion_content":"email 是15位数字和固定后缀@gmail.com, 取五位数字的话其实还要用字符串截取函数, 感觉还是 hash 索引合适","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583815211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":131021,"ip_address":""},"score":201612,"extra":""},{"author":{"id":2649276,"avatar":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","nickname":"Leo","note":"","ucode":"CEBAD9CDCFC2A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1739834,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/eBicObx4oYda2xhxI98OiayPvx0sJiaNFT94PuuaDjckf5icmibdkBDBNv41IvPV43QryKOQyUlasl3OolPGaeBTvnw/132","nickname":"study more","note":"","ucode":"9E6BF84AC0F806","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382169,"discussion_content":"其实直接存学号就行了反正@gmail.com是固定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625457135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":201612,"ip_address":""},"score":382169,"extra":""},{"author":{"id":1263977,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/69/c0fcf4e8.jpg","nickname":"def","note":"","ucode":"39BDBEA0560C13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2649276,"avatar":"https://static001.geekbang.org/account/avatar/00/28/6c/bc/f751786b.jpg","nickname":"Leo","note":"","ucode":"CEBAD9CDCFC2A3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390278,"discussion_content":"直接整个存学号的话前面好多位都相同，有点浪费空间，而且区分度不高吧?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629740694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":382169,"ip_address":""},"score":390278,"extra":""}]}]},{"had_liked":false,"id":48081,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1544344813,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"375206499565","product_id":100020801,"comment_content":"把该讲内容总结为几个问题, 大家复习的时候可以先尝试回答这些问题检查自己的掌握程度:<br><br>\t1. <br>采用整个字符串作为索引. 在查询操作时, 执行顺序是怎样的?<br>\t2. <br>采用部分字段做索引, 在查询操作时, 执行顺序是怎样的?<br>\t3. <br>使用什么语句可以分析不同长度前缀的索引区分度是多少?<br>\t4. <br>前缀索引相比较整个字段做索引有什么优势和劣势?<br>\t5. <br>采用反序存储和hash字段作为索引有什么异同点?<br><br>","like_count":87,"discussions":[{"author":{"id":1920896,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4f/80/19f946ba.jpg","nickname":"Zain","note":"","ucode":"03EDF7B1BE9CF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358920,"discussion_content":"请允许我再叫你一声 学习课代表","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1616075452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2408066,"avatar":"https://static001.geekbang.org/account/avatar/00/24/be/82/d7f602da.jpg","nickname":"Geek_czhh8","note":"","ucode":"8872D618FC5B46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393948,"discussion_content":"感谢总结","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631669365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785448,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/68/c2b2a285.jpg","nickname":"will","note":"","ucode":"6843B14B09192F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333830,"discussion_content":"请允许我叫你一声 学习课代表 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607646280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"下个目标45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1785448,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/68/c2b2a285.jpg","nickname":"will","note":"","ucode":"6843B14B09192F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334209,"discussion_content":"233 ,这个哥们每次问题提炼的都非常好","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607766246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333830,"ip_address":""},"score":334209,"extra":""}]}]},{"had_liked":false,"id":47363,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1544114174,"is_pvip":false,"replies":[{"id":"16966","content":"1. 这里说的“不能删”，其实就是说的，undo log不能删，逻辑上还在<br><br>2. 你说的对… 😓我最开始的例子是用自增主键，改完自己晕了，堪误了哈","user_name":"作者回复","comment_id":47363,"uid":"1264162","ip_address":"","utype":1,"ctime":1544167862,"user_name_real":"林晓斌"}],"discussion_count":13,"race_medal":0,"score":"263537119230","product_id":100020801,"comment_content":"老师针对上一期的答案有两个问题:<br>1.为什么事务A未提交,之前插入的10W数据不能删除啊？不是应该都进undo和change buffer了嘛,<br>根据mvcc查之前的版本就可以了啊。<br>2.不明白为什么第二次调用插入的存储过程,id就变为100000-200000,id是固定插入的,又不是自增的","like_count":61,"discussions":[{"author":{"id":1152599,"avatar":"https://static001.geekbang.org/account/avatar/00/11/96/57/397ead08.jpg","nickname":"一个米屌","note":"","ucode":"8470D3FB4456F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218395,"discussion_content":"😓我最开始的例子是用自增主键，改完自己晕了，堪误了哈\n——————————————————\n多少人浪费了测试时间","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1585654907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431752,"discussion_content":"1. 这里说的“不能删”，其实就是说的，undo log不能删，逻辑上还在\n\n2. 你说的对… 😓我最开始的例子是用自增主键，改完自己晕了，堪误了哈","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544167862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289134,"discussion_content":"我想请问下各位，我知道redolog是什么了，也只道undolog是做什么用的，是根据当前版本结合undolog计算上一个版本的值，但我不明白undolog是以怎样的形式存在的，是redolog里面记录的逆向过程吗？还是单独一个文件进行存储，望知道的朋友，不吝赐教","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594000924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330645,"discussion_content":"undo log在内存里有专门的undo buffer,分为insert buffer和update buffer,在磁盘里默认是保存在ibdata文件里,也可以配置成单独保存在一个文件里。undo log记录的是聚簇索引记录的变化。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1606661302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289134,"ip_address":""},"score":330645,"extra":""}]},{"author":{"id":1318914,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","nickname":"公共号","note":"","ucode":"4759B517D4CD5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52123,"discussion_content":"并且，插入的过程也有错误，插入的时候不应该指定 id 的值（否则无法复现。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573997764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1050906,"avatar":"http://q.qlogo.cn/qzapp/101418266/E227B13802B7C25841211C73649BF479/100","nickname":"...","note":"","ucode":"C30B466AF40526","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318914,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","nickname":"公共号","note":"","ucode":"4759B517D4CD5E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312093,"discussion_content":"确实，不能指定id","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602581816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":52123,"ip_address":""},"score":312093,"extra":""}]},{"author":{"id":3005736,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/dd/28/156e88a6.jpg","nickname":"桑榆","note":"","ucode":"232239337CD097","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572344,"discussion_content":"为什么使用自增索引的时候就能复现了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652713960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357359,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b6/2f/f0def7b8.jpg","nickname":"juven","note":"","ucode":"A4D0B88B742264","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348997,"discussion_content":"终于知道是自增的...老师可以改回来....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612839236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1997293,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","nickname":"雪の雫·雨の音","note":"","ucode":"0693DA3939A321","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266589,"discussion_content":"查之前的版本不是应该根据当前的版本加上undo log推算得出来的嘛，如果把当前版本删了那就没办法得出之前版本了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589536677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2280126,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ca/be/3771706c.jpg","nickname":"卖火柴的加菲猫","note":"","ucode":"9146C9E232A156","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1997293,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/79/ed/4737a49b.jpg","nickname":"雪の雫·雨の音","note":"","ucode":"0693DA3939A321","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325999,"discussion_content":"插眼，希望能回来解答一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605496552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":266589,"ip_address":""},"score":325999,"extra":""}]},{"author":{"id":1666517,"avatar":"https://static001.geekbang.org/account/avatar/00/19/6d/d5/81e72368.jpg","nickname":"王智洋","note":"","ucode":"B38934EA504663","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":239322,"discussion_content":"对于老师给出的答案还是没看懂。\n执行计划依据的是数据页的抽样结果。如果数据页被物理删除了  \n执行计划应该统计不到这部分数据了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587293226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"汉江","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1666517,"avatar":"https://static001.geekbang.org/account/avatar/00/19/6d/d5/81e72368.jpg","nickname":"王智洋","note":"","ucode":"B38934EA504663","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365955,"discussion_content":"最开始也有这样的疑问 后面看了其他同学的回答加上老师第13篇文章讲的，其实delelte 只是把数据页里面的数据标记为删除 并没有物理上删除 所以统计的时候还是会进行统计","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1617931814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":239322,"ip_address":""},"score":365955,"extra":""}]},{"author":{"id":1318914,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","nickname":"公共号","note":"","ucode":"4759B517D4CD5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52131,"discussion_content":"还有，你怎么看出来 id 变为了 100000~200000 了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573998287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47546,"user_name":"小潘","can_delete":false,"product_type":"c1","uid":1304219,"ip_address":"","ucode":"6BBB4ACAA7B221","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/9b/afe3bb0d.jpg","comment_is_top":false,"comment_ctime":1544153004,"is_pvip":false,"replies":[{"id":"16956","content":"这个有点高端了😄","user_name":"作者回复","comment_id":47546,"uid":"1264162","ip_address":"","utype":1,"ctime":1544159878,"user_name_real":"林晓斌"}],"discussion_count":13,"race_medal":0,"score":"224882452396","product_id":100020801,"comment_content":"可以考虑根据字符串字段业务特性做进制压缩，业务上一般会限制每个字符的范围(如字母数字下划线)。<br>从信息论的角度看，每个字节并没有存8 bit的信息量。如果单个字符的取值只有n种可能性(把字符转成0到n-1的数字)，可以考虑把n进制转为为更高进制存储(ascii可看做是128进制)。<br>这样既可以减少索引长度，又可以很大程度上兼顾前缀匹配。","like_count":52,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431802,"discussion_content":"这个有点高端了😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544159878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2226219,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","nickname":"Wangyf","note":"","ucode":"349068A07CB1D4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329085,"discussion_content":"根据大毛同学的评论，我理解的是，在 32 位机器中，int 类型可以表示的最大的正整数是2147483647，所以学号可以被覆盖。至于进制，4 位二进制可以表示 1 位 16 进制，采用 16 进制节约了位数。如果学号前四位表示十进制入学年份：2020，换算成 16 进制就是 7E4，节省了一位。如果采用更高进制，比如 100 进制，那可能，用个两三位就把冗余的信息保存了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606309012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1118559,"avatar":"https://static001.geekbang.org/account/avatar/00/11/11/5f/0d24dba2.jpg","nickname":"在路上","note":"","ucode":"0BEC28E0772A39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405423,"discussion_content":"转换可以，还原是个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634564750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2229257,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erRCf8vWbWibaiaKibNyTC3BMLWDIPK7xUlEy2oVBykrcSIjS5PP4xTDDZRYBicMfK44ia7uWV5cxugVHg/132","nickname":"Geek_e56b38","note":"","ucode":"40625CF22A974C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332637,"discussion_content":"这个是牺牲可读性做到的呀，我们业务也有类似的做法，比如说有n种不同类型的权限，可以拥有一个或多个标志位，多个标志位置1，常规linux的做法- -","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607273704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1232984,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d0/58/ac40120f.jpg","nickname":"biubiubiu","note":"","ucode":"3310E95533D22B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284809,"discussion_content":"上流","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592646319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1180676,"avatar":"https://static001.geekbang.org/account/avatar/00/12/04/04/0af56558.jpg","nickname":"Jc.Chen","note":"","ucode":"36886491352CD4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267943,"discussion_content":"只有n种可能性，怎么转为更高进制存储？可以解释下吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589715529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":7,"child_discussions":[{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"大毛","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1180676,"avatar":"https://static001.geekbang.org/account/avatar/00/12/04/04/0af56558.jpg","nickname":"Jc.Chen","note":"","ucode":"36886491352CD4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276291,"discussion_content":"这种思路非常高级，但是会有很多细节，在这里，我尝试帮你解释一下这个过程的大致思路，具体情况还要具体分析。\n假设一个学生的学号是 &#39;20200517&#39;，这是一个长度为 8 的字符串，以asc编码为例，这个字符串需要占据 8 个字节的空间。\n但是，你发现，这个字符串里面所有的内容都是数字，而一个数字有 10 种可能，也就是说，这个长度的学号最多有 10 ^ 8 种可能性，也就是一亿种可能性。\n在计算机中，使用 32 位二进制数就可以表示 2 ^ 32 种可能性，这个数字是远远大于一亿的，所以也就是说，你完全可以用 4 字节的内存存下这个学号的所有信息（所以你完全可以使用 int 进行存储）。\n所以，正面回答你的问题，在我的例子中，学号只有 一亿 种可能性，你可将它转化成  2^32 进制进行存储。\n当然，只是最粗略的方法，你可以设计一种方法，将这种受限的字符串压缩，这样就能减少存储空间的利用了。\n但是不建议这样做，这种操作可以将信息压缩到极致（实际上极值情况就和哈希有点像了），但是设计这种方法可能会增加复杂性，在数据规模没有达到极其庞大的底部，它带来的收益其实是有限的。","likes_number":36,"is_delete":false,"is_hidden":false,"ctime":1590849316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":267943,"ip_address":""},"score":276291,"extra":""},{"author":{"id":1022267,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/99/3b/791d0f5e.jpg","nickname":"王先森","note":"","ucode":"1AF1A395107479","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"大毛","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":277493,"discussion_content":"这是大哥,解释的思路很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591061943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":276291,"ip_address":""},"score":277493,"extra":""},{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"大毛","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1022267,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/99/3b/791d0f5e.jpg","nickname":"王先森","note":"","ucode":"1AF1A395107479","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278625,"discussion_content":"一同进步🥳","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591199574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277493,"ip_address":""},"score":278625,"extra":""}]}]},{"had_liked":false,"id":80367,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1553652215,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"164762409463","product_id":100020801,"comment_content":"因为mail的格式是学号@gmail.com ,所以@gmail.com可以不存储,使用倒叙前缀索引即可","like_count":38,"discussions":[{"author":{"id":1348819,"avatar":"https://static001.geekbang.org/account/avatar/00/14/94/d3/1861fa96.jpg","nickname":"哲子兄","note":"","ucode":"6D6B6FE1ED2583","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555590,"discussion_content":"如果业务支持其他邮箱注册，或者邮箱业务的后缀变更了，是不是有点麻烦了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646984694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2753834,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/05/2a/cfbcb0b2.jpg","nickname":"Donkey","note":"","ucode":"3DB4DFF6D99035","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1348819,"avatar":"https://static001.geekbang.org/account/avatar/00/14/94/d3/1861fa96.jpg","nickname":"哲子兄","note":"","ucode":"6D6B6FE1ED2583","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557935,"discussion_content":"后缀另起一个字段存储，同时还可以实现统计不同邮箱类型的账号数量","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1648028932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555590,"ip_address":""},"score":557935,"extra":""}]},{"author":{"id":2149067,"avatar":"https://static001.geekbang.org/account/avatar/00/20/ca/cb/8161898c.jpg","nickname":"Launch","note":"","ucode":"057B564EAB7065","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307117,"discussion_content":"这个主意不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600501125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79007,"user_name":"ccccc","can_delete":false,"product_type":"c1","uid":1152893,"ip_address":"","ucode":"55A093B24D7651","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo9biaLzxibM9SHsOWbfHicXbWNFK10Fa5BVJfibzrMtiafez93nctsBmbJg8jAYsaxQdicjZQD7iaRFs0Vw/132","comment_is_top":false,"comment_ctime":1553319201,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"147582207265","product_id":100020801,"comment_content":"实际操作上直接全字段索引就行了，一个学校数据库的数据量和查询压力都不会大到哪儿去。<br>如果单从优化数据表的角度：<br>1. 后缀@gmail可以单独一个字段来存，或者用业务代码来保证，<br>2. 城市编号和学校编号估计也不会变，也可以用业务代码来配置<br>3. 然后直接存年份和顺序编号就行了，这个字段可以全字段索引","like_count":34},{"had_liked":false,"id":48076,"user_name":"一撮韶光","can_delete":false,"product_type":"c1","uid":1238244,"ip_address":"","ucode":"79EE882D86E374","user_header":"https://static001.geekbang.org/account/avatar/00/12/e4/e4/7fdd90b1.jpg","comment_is_top":false,"comment_ctime":1544343616,"is_pvip":false,"replies":[{"id":"17139","content":"👍🏿","user_name":"作者回复","comment_id":48076,"uid":"1264162","ip_address":"","utype":1,"ctime":1544357049,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"138983297088","product_id":100020801,"comment_content":"删的时候，由于有未提交事务开启的一致性视图read-view，所以导致了存在两个数据版本的数据，貌似优化器在&quot;看&quot;二级索引的时候，&quot;看到&quot;了多个历史版本的数据，错误以为有很多数据<br><br>而主键索引数量由于确认机制不同，数量没有变，综合考虑，优化器选择了主键索引","like_count":32,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432017,"discussion_content":"👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544357049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47692,"user_name":"进阶的码农","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1544183268,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"121803267556","product_id":100020801,"comment_content":"老师按照你视频里的例子又做了一下还是不行<br>mysql版本8.0.12<br>+-----------+<br>| version() |<br>+-----------+<br>| 8.0.12    |<br>+-----------+<br>是innodb 隔离级别是RR<br>1.先打开一个客户端A 执行start transaction with  consistent snapshot;没有commit<br>2.然后在重新打开一个mysql客户端B 执行 <br>delete from t;call idata(); explain select * from t between 10000 and 20000;<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+-------+----------+-----------------------+<br>| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                 |<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+-------+----------+-----------------------+<br>|  1 | SIMPLE      | t     | NULL       | range | a             | a    | 5       | NULL | 10001 |   100.00 | Using index condition |<br>+----+-------------+-------+------------+-------+---------------+------+---------+------+-------+----------+-----------------------+","like_count":28,"discussions":[{"author":{"id":1144333,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/0d/781aa509.jpg","nickname":"路飞桑","note":"","ucode":"2EA3B61395FBA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7750,"discussion_content":"作者回复: 2. 你说的对… 😓我最开始的例子是用自增主键，改完自己晕了，堪误了哈；\n改成自增主键就可以复现问题了","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1567660658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2824858,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/1a/9a/f2f9f5dd.jpg","nickname":"李坤龙","note":"","ucode":"68346B996EE22B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411674,"discussion_content":"8.0可能已经修复了这个问题，我8.0也没有模拟出来。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635982364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2803255,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ZwLEEpglswdPM2nXy9w0yQpI3V4vAlgQjz3UfOj1C4p9k2dwzUTXlSQhPxflkD3Qrb73wno4HnnkxvnsPLTic6Q/132","nickname":"Geek_57b9b2","note":"","ucode":"9175C609C7E18C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2824858,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/1a/9a/f2f9f5dd.jpg","nickname":"李坤龙","note":"","ucode":"68346B996EE22B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534330,"discussion_content":"使用自增主键就可以复现了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638165455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":411674,"ip_address":""},"score":534330,"extra":""},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2824858,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/1a/9a/f2f9f5dd.jpg","nickname":"李坤龙","note":"","ucode":"68346B996EE22B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534654,"discussion_content":"使用insert into t (a,b) values(i,i)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638251916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":411674,"ip_address":""},"score":534654,"extra":""},{"author":{"id":2159643,"avatar":"http://thirdwx.qlogo.cn/mmopen/ajNVdqHZLLD8hzI6ucs3wxac0lEDST8abqXG5TAs8xkicmiaygmIhWKYrtrtCSj71j1oAIcellZ2Ah1js5kenUfA/132","nickname":"Geek_fd11f2","note":"","ucode":"B5E61D41A7DB1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590034,"discussion_content":"哎 早点看到这篇就好了 弄了一下午 我就说怎么一直没有复现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665482016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":534654,"ip_address":"四川"},"score":590034,"extra":""}]},{"author":{"id":1318661,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1f/05/8a06692e.jpg","nickname":"喻茂","note":"","ucode":"C8BD8086A17365","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303230,"discussion_content":"我的mysql版本是8.0.21 改成自增主键也不行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599196479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318661,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1f/05/8a06692e.jpg","nickname":"喻茂","note":"","ucode":"C8BD8086A17365","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310333,"discussion_content":"存储过程改了没","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601780290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303230,"ip_address":""},"score":310333,"extra":""}]}]},{"had_liked":false,"id":47761,"user_name":"lttzzlll","can_delete":false,"product_type":"c1","uid":1105387,"ip_address":"","ucode":"FA160F7C02ABAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","comment_is_top":false,"comment_ctime":1544191870,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"100328439678","product_id":100020801,"comment_content":"只取 四位年份+五位编号 并转化为int类型作为唯一主键","like_count":23,"discussions":[{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Java垒墙工程师","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299975,"discussion_content":"不用hash，年份放在编码后面就好了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597891495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2770660,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/46/e4/0860c82f.jpg","nickname":"东泽","note":"","ucode":"7B621B43909E07","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400889,"discussion_content":"作为唯一主键的话是不是还涉及个知识点，在这种也业务场景和楼主的方案下新生入学主键仍是自增的，索引不会出现稀疏情况（具体术语忘了，谁说一下）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633459674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563854,"avatar":"https://static001.geekbang.org/account/avatar/00/17/dc/ce/03fdeb60.jpg","nickname":"白色纯度","note":"","ucode":"7ABC830EE468A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7086,"discussion_content":"后面的5个数字的全排列有100000个，如果学校太大，同一年入学人数多，那么重复性较高，还是hash靠谱一点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567347133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1563854,"avatar":"https://static001.geekbang.org/account/avatar/00/17/dc/ce/03fdeb60.jpg","nickname":"白色纯度","note":"","ucode":"7ABC830EE468A1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302554,"discussion_content":"好奇，什么样的学校一年入学人数超过10w","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1598952999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7086,"ip_address":""},"score":302554,"extra":""},{"author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"子瞻","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313604,"discussion_content":"哈哈哈，同好奇什么样的学校一年入学人数超过10w。还是要有一点常识，不然会尴尬的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603075140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302554,"ip_address":""},"score":313604,"extra":""}]}]},{"had_liked":false,"id":47527,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1544151101,"is_pvip":false,"replies":[{"id":"16945","content":"理解对的，<br><br>方法就是避免长事务（session A 就是模拟一个长事务）","user_name":"作者回复","comment_id":47527,"uid":"1264162","ip_address":"","utype":1,"ctime":1544152418,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"96033431613","product_id":100020801,"comment_content":"对于上一期的问题的回答，“索引 a 上的数据其实就有两份”，是不是这样理解，<br>其中一份是已经被标记为deleted的数据，另一份是新插入的数据，对索引数据的预估把已经被标记为deleted的数据也算上去了？MySQL对索引数据的预估为什么不去check 被标记为deleted的数据？<br>这种场景一旦发生，就会导致预估索引数据不准确，有什么好的方法去避免和解决？<br><br>","like_count":22,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431795,"discussion_content":"理解对的，\n\n方法就是避免长事务（session A 就是模拟一个长事务）","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544152418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47967,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1544270605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"78853681933","product_id":100020801,"comment_content":"回答下今天老师的问题:<br>1.在user建立索引,由于学号的最后7位才能确定到某个学生.不满足最左前缀,那么select from where &#39;%1234567%&#39;无法使用索引,是全表扫描。但是这种情况也有优化的办法,如果该表上的字段比较多,可以这样改写select password from t join (select id from where user like &#39;%1234567%&#39;) as a on a.id=t.id<br>通过全扫描二级索引得到唯一id值.再用id值与t表关联的时候,就能迅速的定位到某一行了,避免全表扫描<br>不过在本次问题里,这种方式效果不好<br>  <br>2.hash索引,建立(hashuser,user,password)索引,不用回表,覆盖索引,但是索引占用长度长。<br>或者建立(hashuser)索引,因为hashuser基本上能确定到唯一值,虽然回表但是扫描的行数也就两行,效率也挺高。但是hash索引对于insert和update操作要多做一些额外的操作。要嘛通过程序计算出hash值,插入表里,要嘛就通过触发器来做。<br><br>3.建立前缀索引,由于后面是固定email,可以考虑只存学号.由于学号后面7位就能确定到某一个学生,可以用倒序存储+前缀索引。不过由于前缀索引不能在int类型上建立,只能用varchar类型。虽然前缀索引无法用到覆盖索引,不过回表扫描的行数也就一行,效率也挺高。这种方式来说,对insert和update相对还好。还有前缀索引还有个影响是不能用于排序。<br>","like_count":18},{"had_liked":false,"id":108781,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1561880804,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"57396455652","product_id":100020801,"comment_content":"怎么给字符串字段加索引？<br><br>1：直接创建完整索引，这样可能比较占用空间；<br><br>这种方式最简单，如果性能没问题，我会这么创建，简单直接且存储空间的费用越来越低<br><br>2：创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引；<br><br>这种方式需要判断出前缀的长度多少合适，需要根据自己的业务来定，主要是看区分度多少合适<br><br>3：倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题；<br><br>这种方式用于前缀区分度不高后缀区分度高的场景，目的还是要提高索引的区分度，使用这种方式不适合范围检索<br><br>4：创建 hash 字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描。<br><br>终于不太烧脑啦😄<br><br>学习这个专栏感觉速度好慢，需要反复听，另外，我喜欢看评论，这个评论太多了，好像买一赠一。<br><br>非常棒，非常感谢，这样感觉确实是在重构MySQL的知识网络！<br><br><br>","like_count":13},{"had_liked":false,"id":127694,"user_name":"alioo","can_delete":false,"product_type":"c1","uid":1022507,"ip_address":"","ucode":"F36A38C1F5FFAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","comment_is_top":false,"comment_ctime":1566780825,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44516453785","product_id":100020801,"comment_content":"去掉@gmail.com后倒序存储，取7位创建前缀索引","like_count":10},{"had_liked":false,"id":61058,"user_name":"叶剑峰","can_delete":false,"product_type":"c1","uid":1069186,"ip_address":"","ucode":"3974D917C69C29","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","comment_is_top":false,"comment_ctime":1547609935,"is_pvip":true,"replies":[{"id":"21759","content":"差不多是这样的<br>一般在你说的这个迭代之前，会再多一个“业务量预估”😆","user_name":"作者回复","comment_id":61058,"uid":"1264162","ip_address":"","utype":1,"ctime":1547621436,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"44497282895","product_id":100020801,"comment_content":"我觉得建立索引和插入数据在实际生产过程中可能是相互迭代的。先建立索引--后插入数据--再优化索引，再插入数据，所以文中说的几种方法都要知道下，具体不同情况不同看。像人员表邮箱这个字段，会先建立全字符串索引，要是业务发展到人员表暴增，导致磁盘比较多，才会想到优化某种长度的字符串索引","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436727,"discussion_content":"差不多是这样的\n一般在你说的这个迭代之前，会再多一个“业务量预估”😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547621436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47428,"user_name":"Hunter","can_delete":false,"product_type":"c1","uid":1143762,"ip_address":"","ucode":"7372EA139F4E78","user_header":"https://static001.geekbang.org/account/avatar/00/11/73/d2/f5cb4e9c.jpg","comment_is_top":false,"comment_ctime":1544143765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44493816725","product_id":100020801,"comment_content":"是不是还是之前的思路，把邮件的地址里面@的前一段做倒排存储，然后就可以使用前缀索引了。<br>或者也可以用年份和顺序号单独存一列，这样就有点类似哈希了，优点是还可以支持范围查询。","like_count":10},{"had_liked":false,"id":49400,"user_name":"V","can_delete":false,"product_type":"c1","uid":1060726,"ip_address":"","ucode":"7CA43B0FBFFA68","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/76/a382a707.jpg","comment_is_top":false,"comment_ctime":1544680997,"is_pvip":false,"replies":[{"id":"17805","content":"只能用一个索引，如果两个都用就是merge-index算法，一般优化器很少采用","user_name":"作者回复","comment_id":49400,"uid":"1264162","ip_address":"","utype":1,"ctime":1544709428,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"35904419365","product_id":100020801,"comment_content":"请教一个问题, 下面这条SQL order_id 和 user_id 都是 int 类型，都加了索引，在看 EXPLAIN  的时候 执行只使用了 order_id 索引， 为什么 user_id 索引没有采用呢？如果WHERE 条件后面都有索引是否都会执行、还是优化器会选择最有效率都一个索引执行？ 将两个调整成组合索引也没有效果, 如果 force index(user_id) 则全表扫描。 能帮忙解答下吗？谢谢<br>SELECT<br>\tcount(1)<br>FROM<br>\tA a<br>WHERE<br>\t  EXISTS(<br>\tSELECT<br>\t\t1<br>\tFROM<br>\t\tB b<br>\tWHERE<br>\t\tb.order_id = a.order_id<br>\tAND b.user_id = a.user_id <br>);","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432606,"discussion_content":"只能用一个索引，如果两个都用就是merge-index算法，一般优化器很少采用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544709428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47393,"user_name":"Livis","can_delete":false,"product_type":"c1","uid":1081671,"ip_address":"","ucode":"4CC7E2B7DCC971","user_header":"https://static001.geekbang.org/account/avatar/00/10/81/47/3c284e4a.jpg","comment_is_top":false,"comment_ctime":1544141132,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35903879500","product_id":100020801,"comment_content":"课后题思考：可以使用学号拼接密码构建一个hash值，每次登录校验时重新计算hash值匹配；","like_count":8},{"had_liked":false,"id":203802,"user_name":"博弈","can_delete":false,"product_type":"c1","uid":1433344,"ip_address":"","ucode":"B1A69837E41972","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EcYNib1bnDf5dz6JcrE8AoyZYMdqic2VNmbBtCcVZTO9EoDZZxqlQDEqQKo6klCCmklOtN9m0dTd2AOXqSneJYLw/132","comment_is_top":false,"comment_ctime":1586268374,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14471170262","product_id":100020801,"comment_content":"老师，您好，针对上一期的回答不是太明白，“session A 开启了事务并没有提交，所以之前插入的 10 万行数据是不能删除的。这样，之前的数据每一行数据都有两个版本，旧版本是 delete 之前的数据，新版本是标记为 deleted 的数据。”<br>为什么旧版本是 delete 之前的数据，新版本是标记为 deleted 的数据？<br>不应该是 旧版本是标记为deleted的数据，新版本是新插入的数据吗？","like_count":3,"discussions":[{"author":{"id":2280126,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ca/be/3771706c.jpg","nickname":"卖火柴的加菲猫","note":"","ucode":"9146C9E232A156","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326005,"discussion_content":"这是要根据 deleted 去找旧的数据去删除么？还是笔误，将旧数据的 deleted 的标记写在了新版本上？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605497945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150709,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1573604255,"is_pvip":true,"discussion_count":2,"race_medal":1,"score":"14458506143","product_id":100020801,"comment_content":"前缀索引和整个字段的索引在索引树上是没有区分的吗？ 能不能通过某个属性判断一个索引是不是前缀索引？<br><br>还有个问题，就是文中使用整个字段的索引的时候，取出邮箱的值后还要回表判断一下邮箱是否正确，但是下面讲解覆盖索引的时候又不需要\b回表判断邮箱的值是否正确， 这个如果是整个字段的索引就不需要回表判断是否正确了吧<br><br>下面是文中的内容<br>****************************<br>如果使用的是 index1（即 email 整个字符串的索引结构），执行顺序是这样的：从 index1 索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得 ID2 的值；到主键上查到主键值是 ID2 的行，判断 email 的值是正确的，将这行记录加入结果集；取 index1 索引树上刚刚查到的位置的下一条记录，发现已经不满足 email=&#39;zhangssxyz@xxx.com’的条件了，循环结束。<br>****************************","like_count":3,"discussions":[{"author":{"id":1145068,"avatar":"https://static001.geekbang.org/account/avatar/00/11/78/ec/f7f0d21a.jpg","nickname":"Dev-L","note":"","ucode":"485E940C3F17B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84019,"discussion_content":"我感觉是非覆盖索引的问题，所以需要多check一下，可能是代码框架的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576481344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1145068,"avatar":"https://static001.geekbang.org/account/avatar/00/11/78/ec/f7f0d21a.jpg","nickname":"Dev-L","note":"","ucode":"485E940C3F17B9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84054,"discussion_content":"这个问题，我知道了，这是因为在进行查询的时候server层可能会进行截取，所以会多判断一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576483729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":84019,"ip_address":""},"score":84054,"extra":""}]}]},{"had_liked":false,"id":146349,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1572503685,"is_pvip":false,"replies":[{"id":"56568","content":"😆 这个评价很高呢😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1572539646,"ip_address":"","comment_id":146349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14457405573","product_id":100020801,"comment_content":"干货满满， 做个笔记感觉把文章有抄了一遍。","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472812,"discussion_content":"😆 这个评价很高呢😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572539646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48923,"user_name":"马若飞","can_delete":false,"product_type":"c1","uid":1046394,"ip_address":"","ucode":"3D0327329A10AE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","comment_is_top":false,"comment_ctime":1544578286,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14429480174","product_id":100020801,"comment_content":"通常我们都是在创建表的时候根据业务创建索引，这时候分析前缀没意义，因为没数。等表大了上千万行后再执行前缀分析也不合适啊。<br>另外，不是不推荐在where中使用函数吗？使用reverse不影响性能？","like_count":3,"discussions":[{"author":{"id":1516214,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIHib1LQqcflrt3hGRHJcxugqQ7dbT64A6JXsJoTYDNueuoO36qicePtbbaaHNicD65qaw3GMhazvQWg/132","nickname":"斩月","note":"","ucode":"9C5ADBCD4DEDD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4660,"discussion_content":"是不建议对列使用函数","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565627897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1246178,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg","nickname":"inrtyx","note":"","ucode":"81CD18FF34ABAB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215060,"discussion_content":"是不建议对列使用函数\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585278704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145068,"avatar":"https://static001.geekbang.org/account/avatar/00/11/78/ec/f7f0d21a.jpg","nickname":"Dev-L","note":"","ucode":"485E940C3F17B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84013,"discussion_content":"是不建议对等号左边使用函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576480958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48161,"user_name":"Smile","can_delete":false,"product_type":"c1","uid":1021017,"ip_address":"","ucode":"2002460CB3D869","user_header":"https://static001.geekbang.org/account/avatar/00/0f/94/59/ac2aa72b.jpg","comment_is_top":false,"comment_ctime":1544373164,"is_pvip":true,"replies":[{"id":"17158","content":"1. 是的<br><br>2. 你看下，三万多行的对应的key字段和十万多行的key字段不一样<br><br>3. 会的<br><br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544404464,"ip_address":"","comment_id":48161,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14429275052","product_id":100020801,"comment_content":"老师，你好，针对session A 和session B 问题统计不一致问题是否可以理解为：<br><br>1. 由于session A 对之前的记录还有引用，所以session B即便做了delete，purge还是无法删除undo log和记录本身，加上新的insert，产生了新的数据页，老的数据页和新的数据页，对采样的结果产生了影响。<br><br>2. 上述采样的影响，由于是采样，不同mysql系统的统计的结果应该是会有差别的，比如第十节课中是3W多行，而第十一节课演示中显示有10W多行。<br><br>3. 如果是一个session， 假设purge线程在回收其他内容（purge线程很繁忙），无暇回收这个session的delete的内容， 那是否可能也出现，统计结果差很大的情况呢？<br><br>还望老师抽空解答。感谢！","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432058,"discussion_content":"1. 是的\n\n2. 你看下，三万多行的对应的key字段和十万多行的key字段不一样\n\n3. 会的\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544404464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312547,"discussion_content":"可以参考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602731509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312545,"discussion_content":"这位老哥回答的可以.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602731471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258213,"user_name":"废材姑娘","can_delete":false,"product_type":"c1","uid":1047537,"ip_address":"","ucode":"6AFB48B2A4939A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/f1/a2cde35e.jpg","comment_is_top":false,"comment_ctime":1604326632,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10194261224","product_id":100020801,"comment_content":"难道只有我一人在实际业务中用户的email 和身份证之类的是加密存储的吗？这种情况咋搞","like_count":2,"discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"汉江","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340805,"discussion_content":"我们也是加密存储 而且超长","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1610163744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582602,"discussion_content":"那就是用hash等值查询了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659522938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066229,"avatar":"https://static001.geekbang.org/account/avatar/00/10/44/f5/486d696c.jpg","nickname":"ethan","note":"","ucode":"DA70975A40ABE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360245,"discussion_content":"加密就只能等值匹配了，密文=加密(输入)，这个和hash一样效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616398610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305281,"user_name":"vegas","can_delete":false,"product_type":"c1","uid":1882795,"ip_address":"","ucode":"312B85FFF1151F","user_header":"https://static001.geekbang.org/account/avatar/00/1c/ba/ab/31ce4a20.jpg","comment_is_top":false,"comment_ctime":1627901815,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5922869111","product_id":100020801,"comment_content":"倒叙和hash在实际开发中基本用不到，现在对空间的容忍都挺大的，逻辑怎么简单怎么来","like_count":1},{"had_liked":false,"id":297021,"user_name":"kyra","can_delete":false,"product_type":"c1","uid":1241673,"ip_address":"","ucode":"26918E763F1D9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/49/43f222e4.jpg","comment_is_top":false,"comment_ctime":1623285805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5918253101","product_id":100020801,"comment_content":"这个还挺容易的，取@前面的字符串做个reverse，然后前缀索引取前五位","like_count":1},{"had_liked":false,"id":248627,"user_name":"木子00","can_delete":false,"product_type":"c1","uid":1314724,"ip_address":"","ucode":"8F78CA722EB29B","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","comment_is_top":false,"comment_ctime":1600246288,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5895213584","product_id":100020801,"comment_content":"index1 中 email是完整索引了，为什么还会回表呢？","like_count":1,"discussions":[{"author":{"id":2718621,"avatar":"https://static001.geekbang.org/account/avatar/00/29/7b/9d/43209590.jpg","nickname":"闹闹她爸","note":"","ucode":"6DFAACB6BCC7CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388536,"discussion_content":"需要查密码是否一致 做登录校验啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628826682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198843,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585470253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880437549","product_id":100020801,"comment_content":"是做微信开发的，通常我们会以公众号openid和appid建立一个组合索引用来查询用户，看完这边需要把我们数据库的索引调整优化一下","like_count":1},{"had_liked":false,"id":190981,"user_name":"南山","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1584715722,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5879683018","product_id":100020801,"comment_content":"经常碰到联合索引超过755的情况","like_count":1,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301242,"discussion_content":"MySQL 8 将字段长度增加到了 3072","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598450712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121944,"user_name":"小罗希冀","can_delete":false,"product_type":"c1","uid":1311995,"ip_address":"","ucode":"88416458FF0041","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/fb/40f298bb.jpg","comment_is_top":false,"comment_ctime":1565253627,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5860220923","product_id":100020801,"comment_content":"数据倒序存的话可支持范围查询的吧，只需要在业务代码将需查询字段反转就可以了","like_count":1,"discussions":[{"author":{"id":1193958,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/e6/71bcbc93.jpg","nickname":"渴望飞的哺乳类","note":"","ucode":"D16372552A2415","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24483,"discussion_content":"不能呀，123，124，114， 倒序的话是321，421，411了，要范围查询 123-124，倒序之后查询不到","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570155780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120955,"user_name":"菜鸟","can_delete":false,"product_type":"c1","uid":1618066,"ip_address":"","ucode":"9C28351664D773","user_header":"https://static001.geekbang.org/account/avatar/00/18/b0/92/8db901ad.jpg","comment_is_top":false,"comment_ctime":1565018005,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5859985301","product_id":100020801,"comment_content":"老师，请教您一个问题，上一章的问题，由于session A 的一致性非锁定读，session B delete之后，undo log肯定不能purge。那么在insert之前，物理磁盘上的 数据页 和 索引页 是真正的删除，还是打个已delete的标记呢，还是什么也不做？如果是打个delete标记，那么下一步如果进行rollback, 是把delete标记去掉吗？<br>","like_count":1,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301238,"discussion_content":"有可能是在 commit 的时候，对数据进行 merge, 将 deleted 的数据直接删除之后再保存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598449941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94541,"user_name":"张珂","can_delete":false,"product_type":"c1","uid":1249512,"ip_address":"","ucode":"E0AFA940BEAC1C","user_header":"https://static001.geekbang.org/account/avatar/00/13/10/e8/172b5915.jpg","comment_is_top":false,"comment_ctime":1557837086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5852804382","product_id":100020801,"comment_content":"老师我想再问一下关于上期问题的解答，有些疑惑：<br>1，结合老师前几节所讲，走主键来统计信息是正确的原因，我总觉得是因为：数据页上存在一份数据就行了，其他版本的通过读undo log能够得到。<br><br>2，索引 a 上的数据其实就有两份。这里为什么会有两份呢？难道是这样：（k=5，id=5）和（k=5，id=5【已删除】）。好想麻烦老师再次画出结构图一目了然啊。","like_count":1},{"had_liked":false,"id":87889,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1555743522,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"5850710818","product_id":100020801,"comment_content":"刚开头的地方，对比index1和index2时，index1的流程：<br>2、到主键上查到主键值是 ID2 的行，判断 email 的值是是正确的，将这行记录加入结果集；<br><br>回表不需要要在判断email值了吧，email值本就是完整的字符串索引了。 覆盖索引就肯定不会回表，所以也不会走这个流程。","like_count":1,"discussions":[{"author":{"id":1344208,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoB0vTIoGqianmDuY7EDHvmmjT96phwxblianV3q0iaib9qtaG9ia8ibTJaWgsQR6WoA0c6xKZicgWrr8LYA/132","nickname":"15216769624","note":"","ucode":"C5D6F13F02AC93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":255482,"discussion_content":"我也是这么想的，麻烦大佬解释一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588404557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2030361,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/fb/19/aa7931c0.jpg","nickname":"橄榄","note":"","ucode":"72CF90BD7B4EDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1344208,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoB0vTIoGqianmDuY7EDHvmmjT96phwxblianV3q0iaib9qtaG9ia8ibTJaWgsQR6WoA0c6xKZicgWrr8LYA/132","nickname":"15216769624","note":"","ucode":"C5D6F13F02AC93","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290195,"discussion_content":"还select了email之外的列","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594373455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":255482,"ip_address":""},"score":290195,"extra":""}]}]},{"had_liked":false,"id":82059,"user_name":"徐徐轻锋","can_delete":false,"product_type":"c1","uid":1145553,"ip_address":"","ucode":"BCD4A73461EF19","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d1/9977a685.jpg","comment_is_top":false,"comment_ctime":1554111827,"is_pvip":false,"replies":[{"id":"30017","content":"对，但是crc32比reverse函数的计算复杂些😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554432404,"ip_address":"","comment_id":82059,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849079123","product_id":100020801,"comment_content":"使用倒叙存储和hash字段的索引区别第二点里，crc32() 函数读和写时不也是各调用一次吗","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445451,"discussion_content":"对，但是crc32比reverse函数的计算复杂些😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554432404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61218,"user_name":"allean","can_delete":false,"product_type":"c1","uid":1051470,"ip_address":"","ucode":"A0D2DB4F219EAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/0b/4e/fd946cb2.jpg","comment_is_top":false,"comment_ctime":1547639569,"is_pvip":false,"replies":[{"id":"21794","content":"MySQL （InnoDB）不适合做这个，找个ES一类的吧^_^","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547658716,"ip_address":"","comment_id":61218,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842606865","product_id":100020801,"comment_content":"请教一个问题，公司有一个文章内容表，文章内容字段为content，类型为longtext，寄存数据大约50万，模糊查询特别慢，加fulltext索引，不起作用，该怎么解决啊","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436788,"discussion_content":"MySQL （InnoDB）不适合做这个，找个ES一类的吧^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547658716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48781,"user_name":"书策稠浊","can_delete":false,"product_type":"c1","uid":1307497,"ip_address":"","ucode":"A29875CE15FDA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","comment_is_top":false,"comment_ctime":1544535492,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5839502788","product_id":100020801,"comment_content":"直接把最后的五位顺序号放到前面存储。然后根据这5位做前缀索引。既省空间，又能排序。","like_count":1,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154147,"discussion_content":"那也会有重复的可能，应该是5位+后两位年份。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580122424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48354,"user_name":"csoulsi","can_delete":false,"product_type":"c1","uid":1227336,"ip_address":"","ucode":"96C9BBE9097FB3","user_header":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","comment_is_top":false,"comment_ctime":1544427337,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5839394633","product_id":100020801,"comment_content":"老师，<br>“session A 开启了事务并没有提交，所以之前插入的 100000万行数据是不能删除的“<br>有几个疑问：<br>1.这个不能删除是逻辑上不能删除，仅仅是因为有事务没有commit，要保持读一致性吗？<br>2.那么是不是说，对于delete的数据，如果没有事务访问，delete之后，逻辑和物理上都会删除掉？<br>3.delete操作，对于行保留的历史版本，怎么控制的？<br>4.逻辑上不能删除，这些逻辑存放在undo段中，undo段是位于共享表空间中，这是不delete操作后，不会释放物理磁盘空间的原因？<br>5.如果不手动对表进行缩表操作，是不是意味着能够保留行的历史版本？<br><br><br><br>","like_count":1,"discussions":[{"author":{"id":1199348,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4c/f4/8eda0b19.jpg","nickname":"吃鸡吃鸡","note":"","ucode":"7C54E2C1A3E8B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233833,"discussion_content":"跟读一致性没关系，session A就是在模拟一个长事务，从而则塞purge线程，进而导致session B删除的数据不能被purge掉，最终影响了执行计划。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586948065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47957,"user_name":"斜面镜子 Bill","can_delete":false,"product_type":"c1","uid":1305242,"ip_address":"","ucode":"B5505F94540D52","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/9a/02d589f9.jpg","comment_is_top":false,"comment_ctime":1544266483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839233779","product_id":100020801,"comment_content":"登录名＝学号＋gmail.com<br>首先，考虑到学号的唯一性，可以直接在登录名存储时去除共用确定的字符串“@gmail.com”，减少存储成本<br>其次，如果只是用作学生登录使用，是不存在range统计等需求的，只是key查询；<br>这里有两种选择：<br>效率优先：学号字段用作表的主键定义<br>空间优先：因为学号部分由城市编号＋学校编号＋入学年份＋顺序编号组成，和身份证使用很类似，可以采用倒序存储、再创建前缀索引的方案，具体前缀单独采用顺序还是加入入学年份或者学校编号，可以count(distinct)统计，看看真实数据的区分度；","like_count":1},{"had_liked":false,"id":47768,"user_name":"李","can_delete":false,"product_type":"c1","uid":1188596,"ip_address":"","ucode":"4E69496C6AF335","user_header":"","comment_is_top":false,"comment_ctime":1544193455,"is_pvip":false,"replies":[{"id":"17016","content":"是说跟原来的顺序存储相比，没有增加额外存储空间","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544195367,"ip_address":"","comment_id":47768,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839160751","product_id":100020801,"comment_content":"从占用的额外空间来看，倒序存储方式在主键索引上<br><br>为什么是存储在主键上呢，不也是一个普通的二级索引嘛，我的理解他比hash只是不需要额外的字段<br><br>不知道理解的对不对😊","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431880,"discussion_content":"是说跟原来的顺序存储相比，没有增加额外存储空间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544195367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47751,"user_name":"张永志","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1544190715,"is_pvip":false,"replies":[{"id":"17001","content":"核心就是delete的数据其实没删","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544191804,"ip_address":"","comment_id":47751,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839158011","product_id":100020801,"comment_content":"对上节课问题的解答没看明白，还是很困惑。<br>请老师再解答一下。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431877,"discussion_content":"核心就是delete的数据其实没删","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544191804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47726,"user_name":"权恒星","can_delete":false,"product_type":"c1","uid":1090619,"ip_address":"","ucode":"2700E28092020D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a4/3b/a29c8eec.jpg","comment_is_top":false,"comment_ctime":1544187266,"is_pvip":false,"replies":[{"id":"17004","content":"死锁有可能，如果确定是gap lock导致，那就是其它索引引起的吧。<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544192069,"ip_address":"","comment_id":47726,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839154562","product_id":100020801,"comment_content":"老师，如果字符串作为唯一索引呢？最近在做这方面的优化，使用duplicate key update来更新数据。老师，有什么好的优化思路啊？还有一个问题，经常会出现gap lock的死锁，可是我已经使用read committed隔离级别了啊，很奇怪。请老师多多指教","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431872,"discussion_content":"死锁有可能，如果确定是gap lock导致，那就是其它索引引起的吧。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544192069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360682,"user_name":"雨落浅析","can_delete":false,"product_type":"c1","uid":2694014,"ip_address":"广东","ucode":"C851AFBC886414","user_header":"https://static001.geekbang.org/account/avatar/00/29/1b/7e/1db58898.jpg","comment_is_top":false,"comment_ctime":1666755731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666755731","product_id":100020801,"comment_content":"普通索引会回表判断条件值是否正确和满足覆盖索引条件时不需要回表，感觉这里有点矛盾。","like_count":0},{"had_liked":false,"id":353883,"user_name":"MrCh1ppy","can_delete":false,"product_type":"c1","uid":3075132,"ip_address":"四川","ucode":"446FFD98667571","user_header":"https://static001.geekbang.org/account/avatar/00/2e/ec/3c/5b9d2fdc.jpg","comment_is_top":false,"comment_ctime":1659884522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659884522","product_id":100020801,"comment_content":"Hash字段索引和前缀索引应该都是不可以使用覆盖索引吧","like_count":0},{"had_liked":false,"id":351619,"user_name":"Castlery1","can_delete":false,"product_type":"c1","uid":3043741,"ip_address":"","ucode":"2F1EA06A1B30BB","user_header":"","comment_is_top":false,"comment_ctime":1658021271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658021271","product_id":100020801,"comment_content":"有个问题，为身份证添加一个额外的hash字段的话，我们查询的时候还需要自己做转换。那为什么不可以直接在身份证号上直接做一个hash索引","like_count":0},{"had_liked":false,"id":349611,"user_name":"小鬼","can_delete":false,"product_type":"c1","uid":1315049,"ip_address":"","ucode":"52EE8A18B90C6D","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/e9/f5e55ccf.jpg","comment_is_top":false,"comment_ctime":1656139741,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656139741","product_id":100020801,"comment_content":"感觉在设计登录的时候可以先选择城市，再选择学校，这样前几位的就可以拆分成两个字段，然后对后续的字符串进行整体保存","like_count":0},{"had_liked":false,"id":349438,"user_name":"Geek_f9d911","can_delete":false,"product_type":"c1","uid":2954601,"ip_address":"","ucode":"BA21B5531D8F29","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/14fmXaURYnMo2eqmBBZhSWQBcW7grDD68ckrk9IiaiaZMSumfnCzFfqs8d44of7zFVgpByMNdn1OxvOSPIiaD4TiaQ/132","comment_is_top":false,"comment_ctime":1655969966,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1655969966","product_id":100020801,"comment_content":"为什么前缀索引不支持范围查询","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582603,"discussion_content":"不是前缀索引不支持范围查询，而是字段值倒叙后的前缀索引不支持范围查询。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659523137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348348,"user_name":"千锤百炼领悟之极限","can_delete":false,"product_type":"c1","uid":1744257,"ip_address":"","ucode":"224B5CF2101716","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9d/81/d748b7eb.jpg","comment_is_top":false,"comment_ctime":1655010358,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655010358","product_id":100020801,"comment_content":"给字符串加索引的方式<br>1.直接存储完整字符串索引，缺点是占用空间。<br>2.使用前缀索引，优点是节省空间，缺点是有额外的查询次数，不能使用覆盖索引。<br>3.先倒序存储，再使用前缀索引，用于字符串前缀索引区分度不高的场景。<br>4.使用hash字段存储索引，缺点是需要额外增加hash字段。","like_count":0},{"had_liked":false,"id":347834,"user_name":"Aron","can_delete":false,"product_type":"c1","uid":2869650,"ip_address":"","ucode":"AA42F3CD8B8532","user_header":"https://static001.geekbang.org/account/avatar/00/2b/c9/92/0004e785.jpg","comment_is_top":false,"comment_ctime":1654499341,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654499341","product_id":100020801,"comment_content":"- 查询数据的时候（注意顺序）A = 0 and C = 0 and B &gt;1 这个时候，会走什么索引？<br>","like_count":0},{"had_liked":false,"id":347287,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1653902192,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653902192","product_id":100020801,"comment_content":"文中：“旧版本是 delete 之前的数据，新版本是标记为 deleted 的数据”<br>这是不是打错了？。。新版本怎么会是标记为 deleted 的数据呢？<br>","like_count":0},{"had_liked":false,"id":346117,"user_name":"LIU","can_delete":false,"product_type":"c1","uid":1324845,"ip_address":"","ucode":"CB8BAB022F5B9F","user_header":"","comment_is_top":false,"comment_ctime":1652846183,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652846183","product_id":100020801,"comment_content":"crc32 ，之前还自己实现了一个类似函数，😓<br>重新学习一遍 ","like_count":0},{"had_liked":false,"id":341901,"user_name":"再见理想","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1649908675,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649908675","product_id":100020801,"comment_content":"直接创建完整索引，这样可能比较占用空间；<br>创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引；<br>倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题；<br>创建 hash 字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描。","like_count":0},{"had_liked":false,"id":339571,"user_name":"溯","can_delete":false,"product_type":"c1","uid":2897143,"ip_address":"","ucode":"9E693CCB835FE0","user_header":"https://static001.geekbang.org/account/avatar/00/2c/34/f7/dee5feb9.jpg","comment_is_top":false,"comment_ctime":1648198182,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1648198182","product_id":100020801,"comment_content":"在什么量级的数据下才需要用到这种优化呢？理论上我觉得大部分业务都是建全字段索引了，这个做法的优点是提高了查询效率和空间(但是微乎其微),甚至第三种方法还增加了开发工作量。","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582605,"discussion_content":"生产数据表有些字段很大，而且一张表通常不止一个索引，对于一张大表来说，如kw级别，可能索引的大小大于数据的大小。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659523235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337707,"user_name":"哲子兄","can_delete":false,"product_type":"c1","uid":1348819,"ip_address":"","ucode":"6D6B6FE1ED2583","user_header":"https://static001.geekbang.org/account/avatar/00/14/94/d3/1861fa96.jpg","comment_is_top":false,"comment_ctime":1646984582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646984582","product_id":100020801,"comment_content":"城市和学校编号的重复性太高，可以新增一个学号的int字段，记录 年份+学号顺序（9位数字），并对学号字段做索引，比前缀索引空间更小，又可以查询区间","like_count":0},{"had_liked":false,"id":336904,"user_name":"lliill","can_delete":false,"product_type":"c1","uid":1179412,"ip_address":"","ucode":"E01B1377D3EE57","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/14/4d5dfbfb.jpg","comment_is_top":false,"comment_ctime":1646459541,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646459541","product_id":100020801,"comment_content":"对于课后问题，我的想法本着能简单就不复杂的想法，完全可以直接给用户名字段建立完整索引，感觉没必要使用前缀索引、hash、倒排的方式。","like_count":0},{"had_liked":false,"id":336903,"user_name":"BeckerHan","can_delete":false,"product_type":"c1","uid":1906047,"ip_address":"","ucode":"110F02EE6E4CD2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/15/7f/739b643a.jpg","comment_is_top":false,"comment_ctime":1646458238,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646458238","product_id":100020801,"comment_content":"直接在where上对字段计算hash值， 不是会导致mysql用不上该字段的索引么，是不是这个哈希方法，应该在业务层做？","like_count":0},{"had_liked":false,"id":332921,"user_name":"到道可道","can_delete":false,"product_type":"c1","uid":1031181,"ip_address":"","ucode":"12B94B6C26BE0D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/0d/00424e81.jpg","comment_is_top":false,"comment_ctime":1643817102,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1643817102","product_id":100020801,"comment_content":"可以考虑去掉@gmail.com的后缀后，将学号倒序存储，对前7位进行前缀索引（5位顺序号+2位年份）。","like_count":0},{"had_liked":false,"id":330694,"user_name":"idiot","can_delete":false,"product_type":"c1","uid":2526391,"ip_address":"","ucode":"D7A6E980B530B4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132","comment_is_top":false,"comment_ctime":1642123771,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642123771","product_id":100020801,"comment_content":"什么场景才适合应用这里说的前缀索引？感觉缺少个实际的案例。<br>倒序有点反直觉，对开发来说是个坑。<br>加个hash字段还好，对于超长字段，比如程序堆栈，用hash来索引省空间（否则多一倍存储？），查询应该也快些吧。","like_count":0},{"had_liked":false,"id":327171,"user_name":"大卜点点","can_delete":false,"product_type":"c1","uid":2094012,"ip_address":"","ucode":"4D8D78ADB42675","user_header":"","comment_is_top":false,"comment_ctime":1639967494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639967494","product_id":100020801,"comment_content":"我寻思应该可以把前十位和后五位当作两个字段建立联合索引吧？<br>前十位用 int，后五位用 medium int，都是整型，占用的空间应该不大吧？","like_count":0},{"had_liked":false,"id":325216,"user_name":"InfoQ_小汤","can_delete":false,"product_type":"c1","uid":1739070,"ip_address":"","ucode":"E4C30DB7A9B54C","user_header":"https://static001.geekbang.org/account/avatar/00/1a/89/3e/0dd8e96b.jpg","comment_is_top":false,"comment_ctime":1638867212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638867212","product_id":100020801,"comment_content":"登录名是统一的邮箱格式，并且后缀都是@gmail.com<br>可以考虑不存储邮箱的全值即只存储邮箱的学位号部分，学位按照城市-学校编号-年份-顺序号规则拼接，顺序号出现重合的概率相对比较小的，可以采取倒叙截取顺序号+年份部分做索引，四年制（仅考虑毕业以后学号就不存在 实际上会有保留）来说这种仅会有招生城市个数*4个重合的数据。这个时候可以评估采用学号索引和倒叙截取索引之间存储和查询性能之间的差异，如果学号保留的话我觉得数据量大用学号可能会好一些","like_count":0},{"had_liked":false,"id":324226,"user_name":"小可","can_delete":false,"product_type":"c1","uid":1006735,"ip_address":"","ucode":"8834AF621FA67D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","comment_is_top":false,"comment_ctime":1638344216,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638344216","product_id":100020801,"comment_content":"老师好，请教个问题，给同一个字段加两个索引，抛开合理性，一个是全长度索引fuidx，一个是前缀索引suidx，mysql 5.7本地测试在精确查询时使用的是fuidx，即使加了force index(suidx)也是使用的是fuidx。按照第10讲内容所述“如果 force index 指定的索引在候选索引列表中，就直接选择这个索引，不再评估其他索引的执行代价。”，为什么测试的结果不符合预期，这种情况mysql特殊内部有特殊处理？","like_count":0},{"had_liked":false,"id":324221,"user_name":"LY","can_delete":false,"product_type":"c1","uid":1794879,"ip_address":"","ucode":"165C7C626C545F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/63/3f/51b2a1f4.jpg","comment_is_top":false,"comment_ctime":1638343211,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638343211","product_id":100020801,"comment_content":"如果没有区间查询需求，为什么不增加哈希索引呢？","like_count":0},{"had_liked":false,"id":322846,"user_name":"子房","can_delete":false,"product_type":"c1","uid":1438860,"ip_address":"","ucode":"CB05938C248BB3","user_header":"https://static001.geekbang.org/account/avatar/00/15/f4/8c/0866b228.jpg","comment_is_top":false,"comment_ctime":1637631692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637631692","product_id":100020801,"comment_content":"没固定答案，都行，依旧数据量，其实那种都对查询效率音响不大","like_count":0},{"had_liked":false,"id":322296,"user_name":"Geek_4c72df","can_delete":false,"product_type":"c1","uid":1763486,"ip_address":"","ucode":"361CE31F4976C3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqwURicicejDP5IlicpyCYxlfzufmGLjvb07WwibTSjdH1V9WfyALhicDxF6l0pq1LgAtroWkxChetsO5Q/132","comment_is_top":false,"comment_ctime":1637292505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637292505","product_id":100020801,"comment_content":"确实因为本身数据量不大，而且只是登录验证，不涉及部门班级部分取的情况直接全部存储。我个人想法是按对对七到十五位进行hash加密，然后存储校验码行不行呢？其实跟倒序加校验码差不多。","like_count":0},{"had_liked":false,"id":321328,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1636793995,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636793995","product_id":100020801,"comment_content":"思考题，首先登录名有统一后缀，这个后缀不需要存储到数据库中，只要在登录验证时，由程序自动拼上这个后缀；其次考虑学生大都在同一城市，且都在同一学校，因此，学号的前几为区分度不太好，而最后5位的顺序号区分度最大，所以，设计登录名时，按倒序方式，取后5位做前缀索引","like_count":0},{"had_liked":false,"id":318757,"user_name":"VG_xiao","can_delete":false,"product_type":"c1","uid":2766682,"ip_address":"","ucode":"8FFCA731216464","user_header":"https://static001.geekbang.org/account/avatar/00/2a/37/5a/33ae8d59.jpg","comment_is_top":false,"comment_ctime":1635414269,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635414269","product_id":100020801,"comment_content":"DROP TABLE IF EXISTS `t`;<br>CREATE TABLE `t`  (<br>  `id1` bigint(20) UNSIGNED NOT NULL DEFAULT 0 COMMENT &#39;id1&#39;,<br>  `id2` int(11) UNSIGNED NOT NULL DEFAULT 0 COMMENT &#39;id2&#39;,<br>  `time` int(11) UNSIGNED NOT NULL DEFAULT 0 COMMENT &#39;时间&#39;,<br>  PRIMARY KEY (`id1`, `id2`) USING BTREE<br>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &#39;测试&#39; ROW_FORMAT = DYNAMIC;<br>语句1：<br>insert into `t` (id1, id2, time) values (&#39;1220&#39;,&#39;1&#39;, &#39;21&#39;) ON DUPLICATE KEY UPDATE  id1=values(id1) and id2=values(id2) and time=values(time);<br>语句2：<br>insert into `t` (id1, id2, time) values (&#39;1220&#39;,&#39;2&#39;, &#39;25&#39;) ON DUPLICATE KEY UPDATE id1=values(id1),id2=values(id2), time=values(time);<br><br>mysql版本5.7.28。当我第一次执行2条语句，数据库插入对应的数据。第二次执行语句1，数据库会修改原来插入的数据（&#39;1220&#39;,&#39;1&#39;, &#39;21&#39;）变成（&#39;1&#39;,&#39;1&#39;, &#39;21&#39;）；第二次执行语句2没有变化。<br><br>尝试修改语句1，改为语句3：<br>insert into `t` (id1, id2, time) values (&#39;1220&#39;,&#39;3&#39;, &#39;21&#39;) ON DUPLICATE KEY UPDATE time=values(time) and id2=values(id2) and id1=values(id1) ;<br>重复执行2次数据由(&#39;1220&#39;,&#39;3&#39;, &#39;21&#39;)变成(&#39;1220&#39;,&#39;3&#39;, &#39;1&#39;)。<br><br>问题：1. ON DUPLICATE KEY UPDATE语句后面使用&#39;and&#39;和&#39;,(逗号)&#39;有什么区别？<br>2.为什么第一个and的前的值会变成1？<br><br>查阅官网资料，google也没找到答案。求助","like_count":0},{"had_liked":false,"id":317394,"user_name":"🏀switch","can_delete":false,"product_type":"c1","uid":2790511,"ip_address":"","ucode":"4449F4A87D49D6","user_header":"https://static001.geekbang.org/account/avatar/00/2a/94/6f/9697953b.jpg","comment_is_top":false,"comment_ctime":1634784144,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634784144","product_id":100020801,"comment_content":"城市和学校相对固定，邮箱格式常见的也就那么几个，唯一变动较大的是年份+学号，这种直接单独存一个字段吧，也就没必要做前缀索引或者翻转前缀索引了。如果按文中的角度上说，那建对应hash值应该比较合适吧，毕竟登录只是精确查询。","like_count":0},{"had_liked":false,"id":309679,"user_name":"咦","can_delete":false,"product_type":"c1","uid":2283781,"ip_address":"","ucode":"2E0D5A488489A4","user_header":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","comment_is_top":false,"comment_ctime":1630299429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630299429","product_id":100020801,"comment_content":"课后题:<br>将重复的前缀单独存放一个字段，再将不重复的存放一个字段，对后面进行索引即可，而将前面的前缀分开，可以防止系统扩展","like_count":0},{"had_liked":false,"id":305287,"user_name":"cake","can_delete":false,"product_type":"c1","uid":1966533,"ip_address":"","ucode":"55A7FC6CC1204C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/01/c5/b48d25da.jpg","comment_is_top":false,"comment_ctime":1627903978,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627903978","product_id":100020801,"comment_content":"老师 请问个问题 这个问题困扰我恒久了，我请教了很多次你也没有回复我，请问下你指的扫描行数 到底是 rows_exmined 还是 回表次数，还是调用引擎次数，还是调用引擎获取数据加一呢？ 我看了很多文章，你都没有说清楚。你可以解释下吗，我真的困扰我半年了。","like_count":0},{"had_liked":false,"id":304504,"user_name":"Fly","can_delete":false,"product_type":"c1","uid":1998881,"ip_address":"","ucode":"1314C93980803E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/av0CCmWNyJqOH8iae2XAG6OuOkGyJTuK6kJ1DeYvz9x4Jbic6C8dcUe1pDXAhBC05rFJTDicBzJdFy7cwO2NnaVow/132","comment_is_top":false,"comment_ctime":1627458313,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1627458313","product_id":100020801,"comment_content":"老师，你下面两句话矛盾了吧？<br><br>“所以，如果使用 index1（即 email 整个字符串的索引结构）的话，可以利用覆盖索引，从 index1 查到结果后直接就返回了，不需要回到 ID 索引再去查一次。”<br><br>1、从 index1 索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得 ID2 的值；<br>2、到主键上查到主键值是 ID2 的行，判断 email 的值是正确的，将这行记录加入结果集；<br>3、取 index1 索引树上刚刚查到的位置的下一条记录，发现已经不满足 email=&#39;zhangssxyz@xxx.com’的条件了，循环结束。","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"键盘上的魔术","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391489,"discussion_content":"sql不一样啊。 用覆盖索引的例子只查了id和email列。 另一个sql多查了name列，name列在email二级索引树中是没有的，要到主键索引上回表。\n不过第二个sql，回表后，还要检查一下email字段是否对，感觉没必要，本来就是根据索引查出来的email肯定是对的。可能是mysql内部自身的什么机制，再多检查一遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630483217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303391,"user_name":"西安","can_delete":false,"product_type":"c1","uid":2678578,"ip_address":"","ucode":"CB67C7EE61A94B","user_header":"","comment_is_top":false,"comment_ctime":1626766202,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626766202","product_id":100020801,"comment_content":"老师, 你好请问一下.<br>如果使用的是 index1. <br>1. 第一步已经通过 index1 判断了 email 的值, 为什么在第二步回表的时候还去判断 email 的值?<br>2. 为什么只取了第一条, 这个既不是唯一索引也没有在 SQL 语句加了 limit 1.","like_count":0},{"had_liked":false,"id":300995,"user_name":"king🐳","can_delete":false,"product_type":"c1","uid":2557346,"ip_address":"","ucode":"88DA7981062AB5","user_header":"https://static001.geekbang.org/account/avatar/00/27/05/a2/24d5e88e.jpg","comment_is_top":false,"comment_ctime":1625479193,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1625479193","product_id":100020801,"comment_content":"千万级数据如何分页查询，根据条件拆查询出来的数据id不连续，使用覆盖索引再子连接也有百万级别","like_count":0,"discussions":[{"author":{"id":1619091,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b4/93/7d690458.jpg","nickname":"浪","note":"","ucode":"30EFA17E82551D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385382,"discussion_content":"你得思考下如何提高索引的区分度了。好比千万级的学生表的字段性别值为男，女这种情况，在性别上建索引用于查询是没什么意义的事情。得结合你业务来说了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627022267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300994,"user_name":"king🐳","can_delete":false,"product_type":"c1","uid":2557346,"ip_address":"","ucode":"88DA7981062AB5","user_header":"https://static001.geekbang.org/account/avatar/00/27/05/a2/24d5e88e.jpg","comment_is_top":false,"comment_ctime":1625479154,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625479154","product_id":100020801,"comment_content":"老师 请教个问题.对于经纬度（精确到小数点后八位）的怎么优化？<br>比如：where 经度 &gt; 0.11111111 and 纬度 &gt; 0.22222222","like_count":0},{"had_liked":false,"id":300567,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1625219055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625219055","product_id":100020801,"comment_content":"<br>mysql 创建索引<br>1 直接创建索引，这样比较占用空间；<br>2 创建前缀索引，节省空间，但会增加查询扫描，并且不能使用覆盖索引；<br>3 倒叙存储，再创建前缀索引，用于绕过字符串本身前缀区分度不够的问题；<br>4 创建hash字段索引，查询新能稳定，有额外的存储和计算消耗，不支持范围扫描。","like_count":0},{"had_liked":false,"id":299669,"user_name":"yezj","can_delete":false,"product_type":"c1","uid":1832266,"ip_address":"","ucode":"38BD97834AC8F8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIIP4P45S9HTzVH2SAH7u9UoKcjibh3smlme8Ieh4921diaaRJYcRcBWwq7XiaCySXO9lopRpDtzp7yA/132","comment_is_top":false,"comment_ctime":1624787491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624787491","product_id":100020801,"comment_content":"刚那个评论我想换个行，不小心直接发送了。<br>我还是没明白老师关于上一期的答案的意思。<br>按照老师的意思，即使没有sessionA，单单只有sessionB，使用show table status看到的行数也是10万多行，那么单单只有sessionB应该也不走索引了，但实际上单单只有sessionB是走a的索引的。","like_count":0},{"had_liked":false,"id":293431,"user_name":"颜桦","can_delete":false,"product_type":"c1","uid":1099576,"ip_address":"","ucode":"1CD7250E052B32","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/38/d1a50cd6.jpg","comment_is_top":false,"comment_ctime":1621388920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621388920","product_id":100020801,"comment_content":"关于倒叙和hash消耗cpu的问题，这个不可以业务代码里面处理吗，也许代码直接用倒叙好的身份证号和已经hash的值来查询，这样是不是就能减少数据库的cpu消耗","like_count":0},{"had_liked":false,"id":289048,"user_name":"红白的小菲","can_delete":false,"product_type":"c1","uid":2552093,"ip_address":"","ucode":"E005511D93EB73","user_header":"","comment_is_top":false,"comment_ctime":1618832301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618832301","product_id":100020801,"comment_content":"我觉得可以把学号后五位的顺序编号专门提出来做一个字段last，然后把它作为索引，每次存的时候就在业务逻辑上把学号的后五位提取出来存进数据库，然后查询的时候使用select * from t where last=last,email=email,passwd=passwd，之所以还要检验email是怕出现后五位输对了，但整体邮箱没输对的情况","like_count":0},{"had_liked":false,"id":286275,"user_name":"Mlong","can_delete":false,"product_type":"c1","uid":2184517,"ip_address":"","ucode":"E62E581F6BB225","user_header":"","comment_is_top":false,"comment_ctime":1617238800,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617238800","product_id":100020801,"comment_content":"有个问题，上一节的问题，既然索引数翻倍，为什么执行的行数却是近4倍，不太明白这个是怎么回事","like_count":0},{"had_liked":false,"id":285145,"user_name":"杯莫停","can_delete":false,"product_type":"c1","uid":1759325,"ip_address":"","ucode":"4FA1D5CBBEF702","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg","comment_is_top":false,"comment_ctime":1616641456,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1616641456","product_id":100020801,"comment_content":"直接用后面九位做索引应该就可以了，毕竟一个学校就算再大能有几个校区呢，扫描次数应该不会多多多少。或者用hash或者倒序都可以。或者我们可以将前三位，第四到第六位、第七位到第十位，后五位分开存储，毕竟这张表应该还需要供其他业务使用，这样我们就可以做复合索引。","like_count":0},{"had_liked":false,"id":285011,"user_name":"陆野","can_delete":false,"product_type":"c1","uid":2338021,"ip_address":"","ucode":"4971B0389F5011","user_header":"","comment_is_top":false,"comment_ctime":1616578244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616578244","product_id":100020801,"comment_content":"问一个问题：varchar 在表里占用的实际空间是由实际存储字符串长度决定的，那么在索引中占用的空间是不是也是由其实际长度决定的？varchar长度限制很短跟限制长相比，是不是没有很大的性能优势？","like_count":0},{"had_liked":false,"id":280723,"user_name":"吃饭","can_delete":false,"product_type":"c1","uid":1692756,"ip_address":"","ucode":"AF0D7165D5F049","user_header":"https://static001.geekbang.org/account/avatar/00/19/d4/54/7263deb2.jpg","comment_is_top":false,"comment_ctime":1614327328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614327328","product_id":100020801,"comment_content":"索引长度最大支持700+个字节，这个机制是怎么来的","like_count":0},{"had_liked":false,"id":280496,"user_name":"帝江","can_delete":false,"product_type":"c1","uid":1590610,"ip_address":"","ucode":"93CBA4E4D05DA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","comment_is_top":false,"comment_ctime":1614235711,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614235711","product_id":100020801,"comment_content":"我直接把登录名字段拆开存.一共15位,  比如拆成俩.第一个字段存前十位.第二个字段存后五位.将用户输入的登录名拆成两部分.where f1 = x and f2 = x.<br>索引建立复合索引,  login(f2, f1, password).<br>话说我这种做法跟本节课的内容好像无关...","like_count":0},{"had_liked":false,"id":280103,"user_name":"明大爷","can_delete":false,"product_type":"c1","uid":2064704,"ip_address":"","ucode":"452E6EC687953D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eovAqV0iaSBQIPaibA9NTKgaQY83RSg3Z5YCmVzE0IKVwlZhdAMWXrrKsvE5U5GMlbolb6V2G25Qmcw/132","comment_is_top":false,"comment_ctime":1614080405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614080405","product_id":100020801,"comment_content":"年份后三位+顺序编号即可。段时间没有超过千年的建校学校，其次8位正好满足int型","like_count":0},{"had_liked":false,"id":278202,"user_name":"sotondolphin","can_delete":false,"product_type":"c1","uid":1307088,"ip_address":"","ucode":"42198CE9B201FD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QZBHia4nXtspEaRibpmMIMVcDA2HHkNypfvVJ2IllQC3FeFCt7f9iaHW7z5yQ4lcB79ibJwia6tNtpuFroufntMhc2g/132","comment_is_top":false,"comment_ctime":1612800750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612800750","product_id":100020801,"comment_content":"学校的编号由入学年份+入学顺序编号就已经能满足系统要求了。如果有不同的校区，可以再多加两位的校区编号。所以我会先建议重新定义学号的构成。然后用所有的学号作为前缀索引","like_count":0},{"had_liked":false,"id":277579,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1612483630,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612483630","product_id":100020801,"comment_content":"二刷第8天，<br>温故知新：前缀索引，无法使用覆盖索引，且潜在的增加了遍历次数。","like_count":0},{"had_liked":false,"id":276900,"user_name":"葱味黑咖啡","can_delete":false,"product_type":"c1","uid":2063970,"ip_address":"","ucode":"9BF75E8CCF8E0B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/8YX35AFKL60uUNM5YGloEx8uDbv0VGB5VddYvqKDgPRiauyW1ggJIs9p6B7ad3AricFMZAp8ahAqP4FmzaTP1few/132","comment_is_top":false,"comment_ctime":1612170344,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612170344","product_id":100020801,"comment_content":"老师说的倒序存储无法支持范围查询，我想到的是能否通过外部干预来实现支持，比如在前端或者业务逻辑上对身份证号取反，当做一个新字符串存入mysql，创建索引时取前6个字节，这样保证区分度也节省了空间，是否也能支持范围查询？","like_count":0},{"had_liked":false,"id":274903,"user_name":"微信还是支付宝","can_delete":false,"product_type":"c1","uid":1731048,"ip_address":"","ucode":"E9C27DEFB6908C","user_header":"https://static001.geekbang.org/account/avatar/00/1a/69/e8/bba34199.jpg","comment_is_top":false,"comment_ctime":1611215239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611215239","product_id":100020801,"comment_content":"和优秀的人一起学习！","like_count":0},{"had_liked":false,"id":273521,"user_name":"Wangyf","can_delete":false,"product_type":"c1","uid":2226219,"ip_address":"","ucode":"349068A07CB1D4","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","comment_is_top":false,"comment_ctime":1610622615,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1610622615","product_id":100020801,"comment_content":"index1 那里的第 2 步，为什么要判断 email 的值是否正确？？不正确的话，直接在 index1 上不就判断出来了？？？？？？？？？","like_count":0,"discussions":[{"author":{"id":2226219,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","nickname":"Wangyf","note":"","ucode":"349068A07CB1D4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342294,"discussion_content":"你别给我精选啊，你倒是给我解答一下啊，精选出来有个锤子用啊？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610627717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266639,"user_name":"zhukovasky","can_delete":false,"product_type":"c1","uid":1920213,"ip_address":"","ucode":"B79625AB0C6CF1","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4c/d5/d30c941c.jpg","comment_is_top":false,"comment_ctime":1607422442,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1607422442","product_id":100020801,"comment_content":"问下大佬，varchar类型的主键在bptree中怎么做查找和维护？","like_count":0},{"had_liked":false,"id":260266,"user_name":"玄真","can_delete":false,"product_type":"c1","uid":2237677,"ip_address":"","ucode":"D21A7096AFB816","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLg04lnicnUNWVmohBVoWiaKPpuYu8j0CHVIjjurfO3YcJqicHZBMYFqjoEpiaa3jrNmRzyzXiaPPt29cA/132","comment_is_top":false,"comment_ctime":1604972175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604972175","product_id":100020801,"comment_content":"将学号的最后5位做冗余字段，建立索引","like_count":0},{"had_liked":false,"id":257655,"user_name":"秀秀","can_delete":false,"product_type":"c1","uid":1145162,"ip_address":"","ucode":"9D4D327324570B","user_header":"https://static001.geekbang.org/account/avatar/00/11/79/4a/10348395.jpg","comment_is_top":false,"comment_ctime":1604049903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604049903","product_id":100020801,"comment_content":"1. 前缀索引：right(学号，7)，城市+学校对于同一所学校都一样，无需考虑；年份4位，取后2位，一百年才有重复索引，时间太久远，勉强无视，故取学号右侧2位年份+5位学号，基本不会重复；如转为int，应该更好<br>2. 年份，编号，作为2个int字段单独存储，一起作为索引(year, number)","like_count":0},{"had_liked":false,"id":254238,"user_name":"dbtiger","can_delete":false,"product_type":"c1","uid":1324202,"ip_address":"","ucode":"05E8447593318C","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/aa/431de942.jpg","comment_is_top":false,"comment_ctime":1603089227,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603089227","product_id":100020801,"comment_content":"上期问题时间<br>MySQL版本8.0.21GPL<br>--隔离参数<br>select @@transaction_isolation;--是REPEATABLE-READ<br>--存储引擎<br>show create table t;--innodb<br>但是2个执行计划是完全一样？？？TYPE是range","like_count":0},{"had_liked":false,"id":250644,"user_name":"Ht","can_delete":false,"product_type":"c1","uid":1620981,"ip_address":"","ucode":"91E3A107280519","user_header":"https://static001.geekbang.org/account/avatar/00/18/bb/f5/f60a479f.jpg","comment_is_top":false,"comment_ctime":1601184472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601184472","product_id":100020801,"comment_content":"老师 我一直不明白 联合索引在索引树上的各个节点的存值是什么样的，所以不知道搜索是根据什么判断往左还是往右。比如ab两个字段联合索引：某一行的(a值是&#39;abc1dds&#39;, b值是&#39;张三&#39;)，另一行的(a值是&#39;cef2dad&#39;, b值是&#39;王五&#39;),想知道索引树上是怎么存的呢，是把索引值按单个字符进行比对吗？还是对这个索引值算一个类crc32的校验码 转为数字在进行比对，叶子节点才存具体的索引值（abc1dds张三、cef2dad王五）呢？","like_count":0},{"had_liked":false,"id":250606,"user_name":"Geek_0edebc","can_delete":false,"product_type":"c1","uid":2196902,"ip_address":"","ucode":"8CDEFEE590BA5F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erxFToiccYblCoE20xC3F4LbdnPKAKXgJuBeDHiaTW1ApyNXQrxdYs5ice4w3Z2asvug2m8WwicnvXAbQ/132","comment_is_top":false,"comment_ctime":1601169126,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601169126","product_id":100020801,"comment_content":"为什么索引下一个取值不满足要求就可以断定接下来的没有符合要求的数据，检索结束???他是建了索引就排好序的吗，那字符串是怎么排序的","like_count":0},{"had_liked":false,"id":242826,"user_name":"天敌","can_delete":false,"product_type":"c1","uid":1059944,"ip_address":"","ucode":"CD29A622197197","user_header":"https://static001.geekbang.org/account/avatar/00/10/2c/68/c299bc71.jpg","comment_is_top":false,"comment_ctime":1597849645,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597849645","product_id":100020801,"comment_content":"数据库只存储学号，然后倒序索引。","like_count":0},{"had_liked":false,"id":240055,"user_name":"prepared","can_delete":false,"product_type":"c1","uid":1194853,"ip_address":"","ucode":"00E54A5C7CDCBE","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/65/3a4fc8cf.jpg","comment_is_top":false,"comment_ctime":1596728084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596728084","product_id":100020801,"comment_content":"答题：<br>1、占用空间，每个学号15位；<br>2、前缀索引，几个字符都区分度不够，不使用；<br>3、倒序索引，加前缀索引。倒序后使用前 5 位即可；<br>4、hash字段索引，增加一个字段，使用hash算法，查询性能稳定，只考虑登录场景，可以使用这种方案。<br>当然我觉得第三种也可以~","like_count":0},{"had_liked":false,"id":237668,"user_name":"Z","can_delete":false,"product_type":"c1","uid":1588016,"ip_address":"","ucode":"13BB106EABA035","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz50ciaONXadCquPf8WDzKzyMYMeDSChgZcMR605sMfSibdw1vXbXvpAFkQxW70GkRtDqFu9lwPlFg/132","comment_is_top":false,"comment_ctime":1595920081,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595920081","product_id":100020801,"comment_content":"这里面select的时候用到了函数，mysql里不是有条规范说不要在对数据库操作让数据库进行计算或者使用函数么，这样不是会导致索引失效么","like_count":0},{"had_liked":false,"id":233978,"user_name":"Geek_4660f3","can_delete":false,"product_type":"c1","uid":1757482,"ip_address":"","ucode":"8B59B0C29EF88A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIMFaaIb1ZyU6zuYrT2WlD4RrsV2orxLonpIFwsx3ic01OLJ0N4dnSXQ3mFQxnbemiabKDw9810rX4Q/132","comment_is_top":false,"comment_ctime":1594543630,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594543630","product_id":100020801,"comment_content":"请问一下老师，在执行sql的时候where条件中带有函数计算为啥会不走索引呢","like_count":0},{"had_liked":false,"id":233629,"user_name":"Garwen","can_delete":false,"product_type":"c1","uid":1045062,"ip_address":"","ucode":"C76346E1734AB8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/46/09c457eb.jpg","comment_is_top":false,"comment_ctime":1594370997,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594370997","product_id":100020801,"comment_content":"思考题，将学号分为两部分存储，城市号+学校号为一个字段，入学年份+顺序编号为一个字段，将索引设置在入学年份+顺序编号这个字段上。将整个字符串作为索引，回表次数1次。","like_count":0},{"had_liked":false,"id":233023,"user_name":"Ps天花乱坠","can_delete":false,"product_type":"c1","uid":2038714,"ip_address":"","ucode":"E95A5A2E3B5EA6","user_header":"https://static001.geekbang.org/account/avatar/00/1f/1b/ba/1a929eaf.jpg","comment_is_top":false,"comment_ctime":1594195989,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1594195989","product_id":100020801,"comment_content":"老师，有这样一个问题，如果业务上查询语句里面是 “select * from T where a like &#39;%xxx&#39;,但是这个a字段系统上要支持正向和反向的模糊匹配，目前系统上只存了一个反向的 revers_a,来满足这种查询，因为‘xxx%’是不支持索引的，但是总觉得这样不妥，不知道有什么好的办法没？","like_count":0,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301240,"discussion_content":"`xxx%` 是支持前缀索引的吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598450524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232426,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1594001716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594001716","product_id":100020801,"comment_content":"老师，采用hash字段的话，除了增加一个字段，还需要增加响应的索引空间吗？这个字段上应该采用的就是哈希索引吧，哈希索引的数据结构我清楚，但是不明白他在mysql里是以怎样的方式进行存储的，可以解惑下吗？","like_count":0},{"had_liked":false,"id":231174,"user_name":"H","can_delete":false,"product_type":"c1","uid":1793962,"ip_address":"","ucode":"04D7D030245E27","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5f/aa/63e641c1.jpg","comment_is_top":false,"comment_ctime":1593600751,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593600751","product_id":100020801,"comment_content":"学习笔记：<br>关键字：前缀索引，倒序索引，哈希索引（需要额外多加一个字段）","like_count":0},{"had_liked":false,"id":219560,"user_name":"青石向晚","can_delete":false,"product_type":"c1","uid":1155598,"ip_address":"","ucode":"EA568D69879B07","user_header":"https://static001.geekbang.org/account/avatar/00/11/a2/0e/7b6eed24.jpg","comment_is_top":false,"comment_ctime":1590041721,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590041721","product_id":100020801,"comment_content":"您好，想请问下index1 为什么还需要回表时在比对下email是否相等，是字符串索引都需要回表再过滤吗？引擎知道索引是前缀索引还是完整字段的索引吗？","like_count":0},{"had_liked":false,"id":217658,"user_name":"怕什么，抱紧我","can_delete":false,"product_type":"c1","uid":1318633,"ip_address":"","ucode":"CBCEA76E9EF33B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/e9/dcc63d8f.jpg","comment_is_top":false,"comment_ctime":1589560198,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1589560198","product_id":100020801,"comment_content":"可能我太笨了,字符串怎么排序,直接用hashcode值,来维护索引的顺序吗!那也有hash冲突啊","like_count":0},{"had_liked":false,"id":217298,"user_name":"xuanyuan","can_delete":false,"product_type":"c1","uid":1113737,"ip_address":"","ucode":"1EC79B9372868F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2icbib62icXtibTkThtyRksbuJLoTLMts7zook2S30MiaBtbz0f5JskwYicwqXkhpYfvCpuYkcvPTibEaQ/132","comment_is_top":false,"comment_ctime":1589459353,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589459353","product_id":100020801,"comment_content":"对数据做分割也可以吧？比如把身份证切成三部分","like_count":0},{"had_liked":false,"id":201347,"user_name":"、落叶为你舞","can_delete":false,"product_type":"c1","uid":1756562,"ip_address":"","ucode":"A196460774A33F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/cd/92/f75a00dd.jpg","comment_is_top":false,"comment_ctime":1585754014,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585754014","product_id":100020801,"comment_content":"“如果使用的是 index1，从 index1 索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得 ID2 的值；到主键上查到主键值是 ID2 的行，判断 email 的值是正确的”，email不是前缀索引为什么还要判断email的值？<br>email索引扫描了一行，email(6)索引扫描了4行，这个行数是指 rows_examined 吗？这里 server 层调用存储引擎的接口是“查询满足条件的一条”还是“查询满足条件的全部”？如果是前者，email 是普通索引的情况下，server 会调用两次，第二次返回空，那这次查询 rows_examined 会加一吗？","like_count":0},{"had_liked":false,"id":199040,"user_name":"刺客","can_delete":false,"product_type":"c1","uid":1098916,"ip_address":"","ucode":"607ABD2F2B5898","user_header":"https://static001.geekbang.org/account/avatar/00/10/c4/a4/b9b12d71.jpg","comment_is_top":false,"comment_ctime":1585477331,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1585477331","product_id":100020801,"comment_content":"不太明白完整索引和前缀索引的查执行顺序，为什么前缀索引会第一次匹配不到会继续下一次匹配，这是引擎的内部逻辑吗？","like_count":0,"discussions":[{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"阿凯文","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282594,"discussion_content":"不会啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592023801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191751,"user_name":"贾森安德森","can_delete":false,"product_type":"c1","uid":1071680,"ip_address":"","ucode":"7FF58646E0AD86","user_header":"https://static001.geekbang.org/account/avatar/00/10/5a/40/59de94de.jpg","comment_is_top":false,"comment_ctime":1584794301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584794301","product_id":100020801,"comment_content":"笔记：<br>如果表没有创建索引，查询语句就只能全表扫描。<br>字段的完整索引：<br>扫描行数少，占用的空间比前缀索引多。<br><br>前缀索引：<br>占用空间小，可能会增加额外的记录扫描次数。<br>如果定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本<br><br>如何确定使用多长的前缀索引合适？<br>建立索引时关注的是区分度，区分度越高越好。区分度越高，意味着重复的键值越少。<br>计算这个列上有多少不同的值：<br>mysql&gt; select count(distinct email) as L from SUser;<br><br>依次选取不同长度的前缀来看这个值：<br>mysql&gt; select<br>  count(distinct left(email,4)）as L4,<br>  count(distinct left(email,5)）as L5,<br>  count(distinct left(email,6)）as L6,<br>  count(distinct left(email,7)）as L7,<br>from SUser;<br> 设定一个可以接受的损失比例，比如5%，查找满足条件的前缀长度。<br><br>前缀索引对覆盖索引的影响：<br><br>如果索引是整个字符串的索引结构，只读主键和字符索引，可以利用覆盖索引，不需要回表。<br>如果是前缀索引，即使email(18)包含了字符串所有的信息，还是要再查询一次主键索引的信息。<br><br>索引选取的越长，占用的磁盘空间就越大，相同的数据页能放下的索引值就越少，搜索的效率也就会越低。<br><br>提高效率的方法：<br>1）、倒序存储<br>   存储的时候字符串倒序了，查询的时候也要倒序。<br>   不支持范围查询<br>   倒序存储方式在主键索引上，不会消耗额外的存储空间。如果使用超过4个字节的前缀长度，这个消耗跟额外的这个hash差不多。<br><br>2）、hash字段<br>   在表上再创建一个整数字段，来保存身份证的校验码，同时加上索引。<br>   每次插入新纪录的时候，用crc32()这个函数得到校验码填到这个新字段。<br>   不支持范围查询，只支持等值查询。<br>   新增一个字段，会有额外的消耗。<br>   查询性能相对更稳定一些。","like_count":0},{"had_liked":false,"id":191109,"user_name":"alex_lai","can_delete":false,"product_type":"c1","uid":1903459,"ip_address":"","ucode":"3057F2A593A6DB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/m7fLWyJrnwEPoIefiaxusQRh6D1Nq7PCXA8RiaxkmzdNEmFARr5q8L4qouKNaziceXia92an8hzYa5MLic6N6cNMEoQ/132","comment_is_top":false,"comment_ctime":1584742407,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584742407","product_id":100020801,"comment_content":"transaction with consistent snapshot就是consistent read？ 在innoDB中这个是当前schema下所有table的consistent read吗？","like_count":0},{"had_liked":false,"id":191108,"user_name":"alex_lai","can_delete":false,"product_type":"c1","uid":1903459,"ip_address":"","ucode":"3057F2A593A6DB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/m7fLWyJrnwEPoIefiaxusQRh6D1Nq7PCXA8RiaxkmzdNEmFARr5q8L4qouKNaziceXia92an8hzYa5MLic6N6cNMEoQ/132","comment_is_top":false,"comment_ctime":1584742218,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584742218","product_id":100020801,"comment_content":"回本期题目：<br><br>其实主要是看业务需求，只维护这个学校的话，从这个邮件格式上看，人数是有上限的大概是每年10万人。<br>如果要保持所有以往到现在得学生信息，我也许会选择 concate 后5位字符作为索引 + 第七到第十位 作为索引，搜索的时候需要用到两个条件。<br><br>","like_count":0},{"had_liked":false,"id":188659,"user_name":"哈密锅儿","can_delete":false,"product_type":"c1","uid":1792142,"ip_address":"","ucode":"35B34503F530AB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/58/8e/97b20eb3.jpg","comment_is_top":false,"comment_ctime":1584401328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584401328","product_id":100020801,"comment_content":"直接用前15位数字做索引可还行？","like_count":0},{"had_liked":false,"id":187048,"user_name":"Hoo-Ah","can_delete":false,"product_type":"c1","uid":1306913,"ip_address":"","ucode":"823093A6C7DEE7","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/21/52e8267b.jpg","comment_is_top":false,"comment_ctime":1584000298,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584000298","product_id":100020801,"comment_content":"老师，我刚给一主一备的MySQL建立索引花了10分钟还没好，会是什么原因导致的？只是给一个建了一个索引。","like_count":0},{"had_liked":false,"id":186299,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1583821810,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583821810","product_id":100020801,"comment_content":"对于字符串，加索引有4种方式：<br>1、创建完整索引<br>2、创建前缀索引<br>3、倒序存储<br>4、创建hash字段索引<br>每种方式有自己的特点。数据量要是不大，我们姑且认为低于500w行的数据都不算大吧，直接使用完整索引，简单粗暴，也没风险","like_count":0},{"had_liked":false,"id":175176,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1580603878,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1580603878","product_id":100020801,"comment_content":"从对上一期问题的回答里面，也能够看的出来，其实之前的表 t，是有一个自增主键字段的。在 show table status 里面，注意到 Auto_increment: 300001。<br><br><br><br>对于本期的问题，我觉的一个学校的学生，人数可能并不是很多，应该不会超过十万级，按照规则，后五位是顺序编号，其实也就是暗示每年的学生不超过十万。<br><br>因为邮箱都是 @gmail.com，那么其实对登录名使用前缀索引(15)是不是就可以了？如果更复杂一些，使用学号的后7位做索引，增加一个字段，但是感觉这样其实得不偿失。<br><br>看了这一篇专栏之后，我感觉似乎在业界对于如何给身份证号码或者邮箱建立索引，应该是有最佳实践的，当然，也要考虑数据表的实际情况和使用方式。<br><br>假设学生的记录比较多，同时有按年度查询的需求，不限定为登录验证功能，那么是否应该把年份抽取出来作为一个独立的字段？还是使用学号甚至是登录名，截取其中的字段，来进行查询？感觉上应该采用空间换时间的方式，建立一个年份字段。<br><br>在留言里面看到一个问题，如果主键用 UUID……，我自己感觉用 UUID 做主键并利于查询效率，可能的好处是保密性，不知道林老师，你怎么看？","like_count":0},{"had_liked":false,"id":175015,"user_name":"与狼共舞","can_delete":false,"product_type":"c1","uid":1391144,"ip_address":"","ucode":"02AC04B43F0194","user_header":"https://static001.geekbang.org/account/avatar/00/15/3a/28/cf707831.jpg","comment_is_top":false,"comment_ctime":1580527524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580527524","product_id":100020801,"comment_content":"老师请教一个问题，对于字段值只有0,1,2这种值变化比较小的字段是否需要加索引？我在本地测试加了和没有加没感觉有多大的区别(行数一样就是过滤百分比值不一样)。我使用的环境是mysql8.x.比如下面的SQL:<br>EXPLAIN select * from user_log where is_deleted = 0  and merchant_no = &#39;1875932406833493&#39; and user_id = 1;<br>EXPLAIN select * from user_log where merchant_no = &#39;1875932406833493&#39; and user_id = 1;<br>EXPLAIN select * from user_log where user_id = 1;","like_count":0},{"had_liked":false,"id":172963,"user_name":"William","can_delete":false,"product_type":"c1","uid":1346215,"ip_address":"","ucode":"55F5D9DEE485B1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","comment_is_top":false,"comment_ctime":1579397366,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1579397366","product_id":100020801,"comment_content":"针对问题：<br> 抛开整个字符串加索引；<br> 新增一个字段，存储第七位之后的计算出来的值（不包含邮箱后缀）再整体加字段索引.","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154150,"discussion_content":"那就来个倒序就行了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580122489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1346215,"avatar":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","nickname":"William","note":"","ucode":"55F5D9DEE485B1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":160164,"discussion_content":"嗯那是比较简便的，邮箱后缀我没要.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580776876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154150,"ip_address":""},"score":160164,"extra":""}]}]},{"had_liked":false,"id":165988,"user_name":"书中迷梦","can_delete":false,"product_type":"c1","uid":1103010,"ip_address":"","ucode":"1C6B697F41698F","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/a2/fa41c8a8.jpg","comment_is_top":false,"comment_ctime":1577359111,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1577359111","product_id":100020801,"comment_content":"<br>select id,name,email from SUser where email=&#39;zhangssxyz@xxx.com&#39;;  这个Sql执行的时候，为啥通过回表查询以后，还要在判断一下email是否等于条件里面的值？这是不是多此一举吗？直接取name不就好了？","like_count":0,"discussions":[{"author":{"id":1809799,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNxMqDoNODfL1aFpkJboxlZPyFANAt9ovzksYtMUIGo3KbHr4Qy8j20Txrpiau6iaJGgAr1nCfpy9w/132","nickname":"爱学习的老吴","note":"","ucode":"E515F50E7A8A68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":157278,"discussion_content":"这个我也不太理解，可能是server层内部的一个确认操作？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580463285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154182,"discussion_content":"以防email字段返回的值不对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580124322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161366,"user_name":"Sic Pavis","can_delete":false,"product_type":"c1","uid":1106088,"ip_address":"","ucode":"48B5F0118347C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/a8/4e739cf6.jpg","comment_is_top":false,"comment_ctime":1576198510,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576198510","product_id":100020801,"comment_content":"正常简单的办法是建立一个hash字段索引即可。<br>不过学生系统因为不能像普通用户一样自然增长，数量有限，直接建全字段索引也不费事。<br><br>不过既然账号是明确分段的可以考虑另外一种思路：登录请求后，将登录用户名按照规则切分出城市、学校、入学年、随机数等字段，数据库也是分这些字段记录（要不要冗余记一份全用户名看需求，问题不大），查询时我认为仅在随机数一列建索引效率已经比较高了，不够的话考虑加入入学年等字段组合索引，都是整数，索引效率高","like_count":0},{"had_liked":false,"id":161334,"user_name":"🖱","can_delete":false,"product_type":"c1","uid":1715588,"ip_address":"","ucode":"ADD5081012964F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/2d/84/18851954.jpg","comment_is_top":false,"comment_ctime":1576195336,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1576195336","product_id":100020801,"comment_content":"老师，前缀索引判断长度的时候。您教程上是基于有数据的时候。但是日常工作中都是见空表的时候就会把索引建好了。如果等到日后数量大的时候再来见索引。这个操作会很占用内存吧","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154153,"discussion_content":"不会啊，只是会表锁一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580122698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160375,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1575942796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575942796","product_id":100020801,"comment_content":"倒序存学号 如果顺序号唯一就取前五个 不唯一就取前9个为普通索引？","like_count":0},{"had_liked":false,"id":147000,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1618607,"ip_address":"","ucode":"8179D167D99CB9","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/af/81303f5a.jpg","comment_is_top":false,"comment_ctime":1572757388,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572757388","product_id":100020801,"comment_content":"请问老师一个问题，业务中有需要select * from t_user where user_name like &#39;%张三%&#39;，这样的查询，前缀索引、倒序索引、hash均不适用，但是使用全部索引耗时比较高，如何优化呢","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154158,"discussion_content":"那这种还用啥索引，直接全表扫描吧。或者用ES。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580122819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146295,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1572490679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572490679","product_id":100020801,"comment_content":"干货满满笔记都不好记<br>","like_count":0},{"had_liked":false,"id":144323,"user_name":"Scott","can_delete":false,"product_type":"c1","uid":1149152,"ip_address":"","ucode":"8736333CBF3F0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/88/e0/576c9598.jpg","comment_is_top":false,"comment_ctime":1571897530,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571897530","product_id":100020801,"comment_content":"老师好，帮忙解释下“从占用的额外空间来看，倒序存储方式在主键索引上，不会消耗额外的存储空间”，倒叙索引存储在主键索引上有点没理解，能说明下吗","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154160,"discussion_content":"倒序索引是普通索引，而主键索引是指主键索引表，也就是索引组织表。因为普通索引的列只是采用的是倒序，还是占用的原来的列空间，没有建立额外的存储空间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580122930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139986,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1570780777,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1570780777","product_id":100020801,"comment_content":"老师使用index1查询时“3. 取 index1 索引树上刚刚查到的位置的下一条记录”，MySQL为什么要获取下一条数据，这是MySQL采用索引查询时采用的机制吗？","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117240,"discussion_content":"”获取下一条数据“是因为不是唯一索引，可能下一个还是需要的结果。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578104260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130253,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1567413251,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1567413251","product_id":100020801,"comment_content":"之前的索引文章里面不是说不是主键索引的其他索引字段都是辅助索引并且在查询的时候需要回表么？ 为什么这篇文章里面的索引又不需要回表了？ 难道这个覆盖索引不是辅助索引？看到现在有点蒙了。。。。","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117258,"discussion_content":"首先辅助索引是索引，而索引覆盖不是索引，只是查询的信息刚好在索引中有，而不需要回表，比如你有AB联合索引，查询&#34;select B from t where A=&#39;xxx&#39;&#34;,此时&#34;select B&#34;中的B，已经在AB联合索引中&#34;覆盖&#34;了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578105360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1338831,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","nickname":"jc9090kkk","note":"","ucode":"6C992D07A2E78F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120515,"discussion_content":"多谢，已然懂了，之前的文章没仔细看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578278997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":117258,"ip_address":""},"score":120515,"extra":""}]}]},{"had_liked":false,"id":128887,"user_name":"Viola","can_delete":false,"product_type":"c1","uid":1528096,"ip_address":"","ucode":"CF8FF5323AE43A","user_header":"","comment_is_top":false,"comment_ctime":1566980368,"is_pvip":false,"replies":[{"id":"48718","content":"这个确实是实情。。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1567488192,"ip_address":"","comment_id":128887,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1566980368","product_id":100020801,"comment_content":"有点“杠精”的想法，一开始设计的时候并没有实际数据来供分析，然而等上线之后再分析，可能由于新的需求任务等原因，无法再投入人力物力去修改之前的设计，凑合能继续用就行了，这可能是很多线上项目的问题（捂脸","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465155,"discussion_content":"这个确实是实情。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567488192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301243,"discussion_content":"所以需要 DBA 半夜升级 :)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598450775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154163,"discussion_content":"这种情况还是需要跟上头反映的，相信他们会给出时间来做优化的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580123090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122623,"user_name":"凯文1985","can_delete":false,"product_type":"c1","uid":1036921,"ip_address":"","ucode":"9A42344649072B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d2/79/0a432fde.jpg","comment_is_top":false,"comment_ctime":1565442640,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1565442640","product_id":100020801,"comment_content":"如果是全索引的情况下 为什么已经按照索引完全匹配到整个邮件地址了 还需要回去跟where语句进行匹配一次？","like_count":0,"discussions":[{"author":{"id":1022507,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","nickname":"alioo","note":"","ucode":"F36A38C1F5FFAB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6193,"discussion_content":"匹配到记录的ID值，还需要回表取其他字段放到结果集","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566780581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122399,"user_name":"菜鸟起飞🛫","can_delete":false,"product_type":"c1","uid":1091783,"ip_address":"","ucode":"6B78994D10755B","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/c7/c2ccb449.jpg","comment_is_top":false,"comment_ctime":1565357915,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1565357915","product_id":100020801,"comment_content":"难道就不能在后台首先将输入的用户名进行处理一下吗？同学们都输入了这个邮箱，我直接将输入的和我要处理的都拿到，然后再截取一部分去匹配，匹配查询完后删选了一部分了，再通过精确比对，不也很省时间？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154164,"discussion_content":"那不依然是前缀索引的处理吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580123181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120301,"user_name":"加勒比海贼王","can_delete":false,"product_type":"c1","uid":1003465,"ip_address":"","ucode":"D922A1A5B3B04B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/c9/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1564823429,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1564823429","product_id":100020801,"comment_content":"请问一下，date类型的字段可以加索引吗？为什么我在本地机器没有报错，线上机器就报错了","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154165,"discussion_content":"date类型这样的列基数不是很高吧，当然也要看你的数据量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580123243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119201,"user_name":"Simon","can_delete":false,"product_type":"c1","uid":1112456,"ip_address":"","ucode":"6C0A97CC0625FA","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/88/e7feec91.jpg","comment_is_top":false,"comment_ctime":1564536622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564536622","product_id":100020801,"comment_content":"我感觉单纯考虑效率选择普通索引<br>1. 把插入的邮箱号，从0截断到@位置，得到值:201900001<br>2. 再把这个数字存入字段seriesNo（int），这个字段创建普通索引。<br><br>无论效率查询，还是排序都ok。<br><br>总的来说<br>1.新增一个字段seriesNo.<br>2.但是对上层代码逻辑有一些约束（一般项目初建，不会搞这么麻烦的。）","like_count":0},{"had_liked":false,"id":118908,"user_name":"陈耿伟","can_delete":false,"product_type":"c1","uid":1532171,"ip_address":"","ucode":"7B3B1BF22371FC","user_header":"https://static001.geekbang.org/account/avatar/00/17/61/0b/d94852de.jpg","comment_is_top":false,"comment_ctime":1564465221,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1564465221","product_id":100020801,"comment_content":"老师,一个select语句只会使用一个索引吗?","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117262,"discussion_content":"是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578105561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2215928,"avatar":"https://static001.geekbang.org/account/avatar/00/21/cf/f8/86076de4.jpg","nickname":"宏彬","note":"","ucode":"8EFDD45EA62342","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386540,"discussion_content":"建议你在查查，有情况是可以使用两个索引的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627630756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":117262,"ip_address":""},"score":386540,"extra":""}]}]},{"had_liked":false,"id":118834,"user_name":"Augustus Wang","can_delete":false,"product_type":"c1","uid":1009377,"ip_address":"","ucode":"89B4D3012A7364","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/e1/3075aea0.jpg","comment_is_top":false,"comment_ctime":1564450721,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1564450721","product_id":100020801,"comment_content":"1.从占用的额外空间来看，倒序存储方式在主键索引上<br><br>这句话不是很懂，怎么理解?","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154172,"discussion_content":"倒序索引是普通索引，而主键索引是指主键索引表，也就是索引组织表。因为普通索引的列只是采用的是倒序，还是占用的原来的列空间，没有建立额外的存储空间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580123795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117265,"discussion_content":"就是需要存储到主键索引树吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578105621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1614934,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/xGfyljtpSmic6s0Z7ibhNHsne9eCuicOwqsYzJAQknm6RZKCJbRgd5tGBI26kvaiblKmDtR0Vxlfe1f7icVKLQKiaMibA/132","nickname":"PeterLiao","note":"","ucode":"93245EE74AA76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5452,"discussion_content":"老师的意思应该这样，对于倒序存储方式而言，在主键索引上，不会消耗额外的存储空间（把该句话分隔下看就好）。因为对于倒序而言，本身就会有一个字段，在索引树叶上本来就会有主见索引，而hash的话，它多建立了一个字段且会在该字段加索引，所以在索引树叶上，也会有主键索引，所以相对倒序的方式就要多花费存储空间来储存主键索引。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566281835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113348,"user_name":"王斯拉","can_delete":false,"product_type":"c1","uid":1593957,"ip_address":"","ucode":"D00DD3CE432189","user_header":"https://static001.geekbang.org/account/avatar/00/18/52/65/320eccb3.jpg","comment_is_top":false,"comment_ctime":1562982423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562982423","product_id":100020801,"comment_content":"我觉得如果量级大到需要考虑索引的话，固定后缀是不用存的，在业务层做处理就好。<br>比如用户输入了12313123123213@gmail.com 业务里把@gmail.com去掉去存，查的时候也去掉去查<br>现在的问题就是存前缀很相似的15位数学号了。<br>那就倒序+前缀索引就ok了","like_count":0},{"had_liked":false,"id":108816,"user_name":"Mr.钧👻","can_delete":false,"product_type":"c1","uid":1249939,"ip_address":"","ucode":"D781E030E79245","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg","comment_is_top":false,"comment_ctime":1561888764,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1561888764","product_id":100020801,"comment_content":"老师，想请教下，使用navicat 怎么打开两个session呢？","like_count":0,"discussions":[{"author":{"id":1212009,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLyfaTNuvbkicpu3mTujhbQ2Xr6KSbfNJrukFv1gSmtdicxTNgN61M2ibxZdQpRToicQNJDKDuB27F3Ag/132","nickname":"路人甲","note":"","ucode":"D6247E2F110FC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170134,"discussion_content":"navicat选中库，右键命令列界面打开2次应该就是了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581671739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117267,"discussion_content":"学习建议命令行，工具帮我们做了太多的事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578105691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108167,"user_name":"浩","can_delete":false,"product_type":"c1","uid":1394346,"ip_address":"","ucode":"BD7FE280C83152","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKoGnC6068nQia1bOiaPxMRmkOQsaDsw5ib2drXic4gKOLzIFyZnnFm4uJ6KniboKG1nQD3J15y4d3QxLA/132","comment_is_top":false,"comment_ctime":1561689511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561689511","product_id":100020801,"comment_content":"今天遇到了一个神奇的问题，我在批量处理一批数据，都是根据身份证号查询，多条语句涉及到身份证号查询，所以就使用了变量，操作如下：set @idno=1*********44;select * from crm_customers where id_no= @idno;结果：1*********44，1*********45,查询出来两条数据，明明查询的是44结尾的，但是出来了44，,45结尾的两条数据，请老师帮我解惑吧！","like_count":0},{"had_liked":false,"id":107967,"user_name":"张洪磊","can_delete":false,"product_type":"c1","uid":1298582,"ip_address":"","ucode":"6D432C58D92C30","user_header":"https://static001.geekbang.org/account/avatar/00/13/d0/96/8bb17b5f.jpg","comment_is_top":false,"comment_ctime":1561642076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561642076","product_id":100020801,"comment_content":"我的想法是把登陆名分成3个字符保存，前面不变的城市学校一个字符，年份序号一个字段，@gmail.com一个字段，给年份序号建个索引，不过感觉和课题无关了<br><br>","like_count":0},{"had_liked":false,"id":107154,"user_name":"hungki","can_delete":false,"product_type":"c1","uid":1214543,"ip_address":"","ucode":"354F2D91259DFD","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/4f/9679f64a.jpg","comment_is_top":false,"comment_ctime":1561470294,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561470294","product_id":100020801,"comment_content":"先不看评论自己回答，存储时去掉@gmail.com，然后倒序存储，建立五位前缀索引。但是觉得还是要根据实际业务场景，比如有没有范围查找，实际学校学生数量等","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154174,"discussion_content":"5位+4位年份","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580123966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105165,"user_name":"二星球","can_delete":false,"product_type":"c1","uid":1111552,"ip_address":"","ucode":"89EC5FEB98E7CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/00/2a248fd8.jpg","comment_is_top":false,"comment_ctime":1560932036,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560932036","product_id":100020801,"comment_content":"老师好，请教一个问题：我在二级索引上匹配了10条数据，然后回表取数据，回表的时候是一条一条的回表查数据，还是传10个id一次把数据取回来呢？","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117275,"discussion_content":"一条一条","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578105946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100261,"user_name":"连边","can_delete":false,"product_type":"c1","uid":1391748,"ip_address":"","ucode":"54B5DA38449728","user_header":"https://static001.geekbang.org/account/avatar/00/15/3c/84/608f679b.jpg","comment_is_top":false,"comment_ctime":1559518789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559518789","product_id":100020801,"comment_content":"把“学号”单独储存一个字段，类比之前说的hash，因为“学号”联合一起来，已经是唯一的了。所有直接单独储存一个字段“学号”，然后用“学号”做索引。","like_count":0},{"had_liked":false,"id":94542,"user_name":"calljson","can_delete":false,"product_type":"c1","uid":1505262,"ip_address":"","ucode":"A5F81A6A5B4497","user_header":"https://static001.geekbang.org/account/avatar/00/16/f7/ee/6eeb58a3.jpg","comment_is_top":false,"comment_ctime":1557837260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557837260","product_id":100020801,"comment_content":"膜拜大神，学习完后真的发现以前做的sql优化都是不能算作优化。希望能出更多优秀课程","like_count":0},{"had_liked":false,"id":94538,"user_name":"张珂","can_delete":false,"product_type":"c1","uid":1249512,"ip_address":"","ucode":"E0AFA940BEAC1C","user_header":"https://static001.geekbang.org/account/avatar/00/13/10/e8/172b5915.jpg","comment_is_top":false,"comment_ctime":1557836159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557836159","product_id":100020801,"comment_content":"不知道我现在如果问问题，老师是否还能看到并解答：<br>我的困惑跟@某、人的问题差不多：为什么事务A未提交,之前插入的10W数据不能删除啊？不是应该都进undo和change buffer了嘛，根据mvcc查之前的版本就可以了啊。<br>老师回答：这里说的“不能删”，其实就是说的，undo log不能删，逻辑上还在<br>那么我想追问：难道在统计数据的时候，还去查看一下undo log能推算出几个版本吗？","like_count":0},{"had_liked":false,"id":92711,"user_name":"　","can_delete":false,"product_type":"c1","uid":1172538,"ip_address":"","ucode":"DBE2DB5CC52C91","user_header":"https://static001.geekbang.org/account/avatar/00/11/e4/3a/16545faf.jpg","comment_is_top":false,"comment_ctime":1557315156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557315156","product_id":100020801,"comment_content":"回答问题：<br>密码的区分度就很高呀，然后硬要给登录名做索引，可以新建一个字段里头放了根据登录名算出的值。","like_count":0},{"had_liked":false,"id":91927,"user_name":"Jzzw","can_delete":false,"product_type":"c1","uid":1508208,"ip_address":"","ucode":"4B642AADF48BD6","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/70/01dc4853.jpg","comment_is_top":false,"comment_ctime":1557135725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557135725","product_id":100020801,"comment_content":"后缀不往数据库里面存  前面的部分反序存 前9位做前缀索引","like_count":0},{"had_liked":false,"id":91175,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1556889455,"is_pvip":false,"replies":[{"id":"32683","content":"char（N）表示“最长存N，但是如果字符串小于N，用空格补到N”<br><br>varchar（N）表示“最长存N，如果字符串小于N，按照实际长度来存”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1556901262,"ip_address":"","comment_id":91175,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556889455","product_id":100020801,"comment_content":"老师，char 和 varchar 可以设置长度，这个长度是干什么的，对于不同字符集又有什么影响？一直看到不同的解释，恳请老师专业的解释一下","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448835,"discussion_content":"char（N）表示“最长存N，但是如果字符串小于N，用空格补到N”\n\nvarchar（N）表示“最长存N，如果字符串小于N，按照实际长度来存”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556901262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90736,"user_name":"无菇朋友","can_delete":false,"product_type":"c1","uid":1035562,"ip_address":"","ucode":"80482C5F0464A3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/2a/bdbed6ed.jpg","comment_is_top":false,"comment_ctime":1556620136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556620136","product_id":100020801,"comment_content":"林老师您好，有个疑问：<br>对于email字段，无论是采用倒序存储+前缀索引还是字段的hash值做索引，排序似乎都是不可用的吧，假如真的有order by email这种需求，那该如何处理？","like_count":0},{"had_liked":false,"id":86868,"user_name":"Nil","can_delete":false,"product_type":"c1","uid":1283364,"ip_address":"","ucode":"9C6AE0FE267316","user_header":"https://static001.geekbang.org/account/avatar/00/13/95/24/515fa7b7.jpg","comment_is_top":false,"comment_ctime":1555468545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555468545","product_id":100020801,"comment_content":"我觉得可以这样，只存学号，再倒序索引","like_count":0},{"had_liked":false,"id":84793,"user_name":"史浩东","can_delete":false,"product_type":"c1","uid":1100770,"ip_address":"","ucode":"6B5EF74052B321","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/e2/a6a883b4.jpg","comment_is_top":false,"comment_ctime":1554908124,"is_pvip":false,"replies":[{"id":"30741","content":"问题没看懂，时间字段用timestamp，需要的时候建索引😅","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1555146299,"ip_address":"","comment_id":84793,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554908124","product_id":100020801,"comment_content":"时间类型的哪个索引更好？老师","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446450,"discussion_content":"问题没看懂，时间字段用timestamp，需要的时候建索引😅","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81224,"user_name":"Lucus","can_delete":false,"product_type":"c1","uid":1198800,"ip_address":"","ucode":"CE8EB70CB9D9F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/d0/d319c44a.jpg","comment_is_top":false,"comment_ctime":1553835376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553835376","product_id":100020801,"comment_content":"只需要对密码做hash后保持密码的hash值为passwd_hash字段，可以用32字节，并且对该字段做6字节前缀索引。感觉用户名不用做索引，因为无论做前缀索引，还是倒序后前缀都区分度不大。","like_count":0},{"had_liked":false,"id":80356,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1553651549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553651549","product_id":100020801,"comment_content":"添加hash字段不一样浪费储存空间么?而且计算hash值也浪费时间","like_count":0},{"had_liked":false,"id":80151,"user_name":"gitpull","can_delete":false,"product_type":"c1","uid":1004911,"ip_address":"","ucode":"A21C9419800C99","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/6f/800a11be.jpg","comment_is_top":false,"comment_ctime":1553609947,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553609947","product_id":100020801,"comment_content":"覆盖索引  索引必须包含所查询的列吧  那select id,name,email from t where email=xxx这个语句中name字段并不在索引中啊","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154177,"discussion_content":"所以要回表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580124127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71607,"user_name":"Scott","can_delete":false,"product_type":"c1","uid":1149152,"ip_address":"","ucode":"8736333CBF3F0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/88/e0/576c9598.jpg","comment_is_top":false,"comment_ctime":1551401002,"is_pvip":false,"replies":[{"id":"25737","content":"hash字段方法要额外创建一个字段；<br>倒序存储就是把原来&#39;abc&#39;改成&#39;cba&#39;，没有额外消耗空间","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551404579,"ip_address":"","comment_id":71607,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1551401002","product_id":100020801,"comment_content":"老师好，有句话麻烦老师在解释下没有明白<br>使用倒序存储和使用 hash 字段这两种方法的异同点，倒序存储方式在主键索引上，不会消耗额外的存储空间？ 是什么意思，没太明白<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441230,"discussion_content":"hash字段方法要额外创建一个字段；\n倒序存储就是把原来&amp;#39;abc&amp;#39;改成&amp;#39;cba&amp;#39;，没有额外消耗空间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551404579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1276373,"avatar":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","nickname":"Ethan","note":"","ucode":"016F1DEBA895B8","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287913,"discussion_content":"默认想成，先倒序再前缀索引了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593586864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70949,"user_name":"Pana","can_delete":false,"product_type":"c1","uid":1016571,"ip_address":"","ucode":"6E016D4966B187","user_header":"https://static001.geekbang.org/account/avatar/00/0f/82/fb/9d232a7a.jpg","comment_is_top":false,"comment_ctime":1551232036,"is_pvip":false,"replies":[{"id":"25424","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551235409,"ip_address":"","comment_id":70949,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551232036","product_id":100020801,"comment_content":"前缀索引占用空间小，需要根据区分度设置长度","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440914,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551235409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69175,"user_name":"兵王","can_delete":false,"product_type":"c1","uid":1122900,"ip_address":"","ucode":"03F92B88C7362B","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/54/45d8cba0.jpg","comment_is_top":false,"comment_ctime":1550672914,"is_pvip":false,"replies":[{"id":"24560","content":"跟业务负责人确定数据分布和查询模式<br><br>其实这个不止是评估前缀索引长度时需要，<br><br>整个表的索引该怎么设计，都是应该事先根据数据分布和查询来决定的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550679781,"ip_address":"","comment_id":69175,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550672914","product_id":100020801,"comment_content":"老师，在评估前缀索引长度的时候，如果是新表的话，表中还没有数据，这个时候没法估计区分度，只能按照业务先去设计，后续再优化吗？还有其他什么评估办法吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439983,"discussion_content":"跟业务负责人确定数据分布和查询模式\n\n其实这个不止是评估前缀索引长度时需要，\n\n整个表的索引该怎么设计，都是应该事先根据数据分布和查询来决定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550679781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67404,"user_name":"huolang","can_delete":false,"product_type":"c1","uid":1346708,"ip_address":"","ucode":"FDC4A6B6151C5E","user_header":"https://static001.geekbang.org/account/avatar/00/14/8c/94/5282994c.jpg","comment_is_top":false,"comment_ctime":1550140130,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1550140130","product_id":100020801,"comment_content":"老师你好，我有一个案例需要请教，有以下这样一个表<br>CREATE TABLE `cameras` (<br>    `id` int NOT NULL AUTO_INCREMENT,<br>    `uuid` varchar(64) NOT NULL,<br>    `zone_uuid` varchar(64) NOT NULL,<br>    `device_id` varchar(256) NOT NULL,<br>    `platform_id` int DEFAULT &#39;0&#39;,<br>    PRIMARY KEY (`id`),<br>    UNIQUE KEY `index_cameras_on_zone_uuid_and_uuid` (`zone_uuid`, `uuid`),<br>    UNIQUE KEY `index_cameras_on_platform_id_and_device_id` (`platform_id`, `device_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;<br><br>explain select count(1) from cameras where zone_uuid = &quot;xxx&quot;时，extra 显示的是&quot;using where;using index&quot;， 用上了唯一索引`index_cameras_on_zone_uuid_and_uuid`。<br><br>explain select count(1) from cameras where platform_id = 1时， extra显示的是using index，用上了唯一索引`index_cameras_on_platform_id_and_device_id`。<br><br>然后使用platform_id作为条件select count时比使用zone_uuid作为条件select count时要快不少，这应该是因为使用zone_uuid作为条件select count时需要&quot;using where&quot;。<br><br>但是为什么使用zone_uuid作为条件select count时需要&quot;using where&quot;呢？我没有想明白，烦请老师指教一下。","like_count":0,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301247,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598451300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1548221,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9f/bd/e69a61f2.jpg","nickname":"cc标","note":"","ucode":"BE150C734F758C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201,"discussion_content":"朗哥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561274590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63557,"user_name":"lmj","can_delete":false,"product_type":"c1","uid":1387177,"ip_address":"","ucode":"59F5FB0D322EE6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJo9Y9TSibEk0lHzPtKpkyJ1ARVNAbAFx0J8icnjib2WYHcCbYpiaN8K0BicYicaS0qHwcnynUGIp7kAYRw/132","comment_is_top":false,"comment_ctime":1548399935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548399935","product_id":100020801,"comment_content":"@后面的可以不储存，放在业务当中处理，采用后5位的倒序索引，加上密码，组成联合索引。","like_count":0},{"had_liked":false,"id":62915,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1306334,"ip_address":"","ucode":"B2F2E2F28397BC","user_header":"https://static001.geekbang.org/account/avatar/00/13/ee/de/eb2baece.jpg","comment_is_top":false,"comment_ctime":1548206933,"is_pvip":false,"replies":[{"id":"22254","content":"以防email字段返回的值不对，<br>对于server层来说，这个成本也并不大就是了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548223255,"ip_address":"","comment_id":62915,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548206933","product_id":100020801,"comment_content":"老师，为什么index1回表后还要判断email的值？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437399,"discussion_content":"以防email字段返回的值不对，\n对于server层来说，这个成本也并不大就是了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548223255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62646,"user_name":"Larwas","can_delete":false,"product_type":"c1","uid":1105436,"ip_address":"","ucode":"AF6BAA7769311A","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/1c/60ff644d.jpg","comment_is_top":false,"comment_ctime":1548124155,"is_pvip":false,"replies":[{"id":"22193","content":"这样也是可以的哈😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548139069,"ip_address":"","comment_id":62646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548124155","product_id":100020801,"comment_content":"因为维护的是一个学校的学生信息数据库，所以，城市、学校这六位是不变的，@gmail.com 也是不变的，变的只有第七到十五这9位（每年这9位的后五位也是有很多重复的）。那设计之初是不是就可以只保存这9位就够了呢。然后做这个9位的全索引。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437289,"discussion_content":"这样也是可以的哈😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548139069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61826,"user_name":"FreeMason","can_delete":false,"product_type":"c1","uid":1340120,"ip_address":"","ucode":"3D58AC2F9AB345","user_header":"https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg","comment_is_top":false,"comment_ctime":1547810989,"is_pvip":false,"replies":[{"id":"21933","content":"额。。这个问题有点大，可否具体性","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547825156,"ip_address":"","comment_id":61826,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547810989","product_id":100020801,"comment_content":"如果 innodb 把索引字段设为可为 null，在引擎层索引、存储、查询时是如何处理的？查询时优化器对 is_null 的处理？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437009,"discussion_content":"额。。这个问题有点大，可否具体性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547825156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61342,"user_name":"Douglas","can_delete":false,"product_type":"c1","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1547684105,"is_pvip":false,"replies":[{"id":"21825","content":"字符串存储和数字类型存储一样的，<br>顺序就是按照字符串的大小判断规则， &#39;b&#39;&gt;&#39;a&#39;, &#39;9&#39;&gt;&#39;10&#39;","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547690588,"ip_address":"","comment_id":61342,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547684105","product_id":100020801,"comment_content":"正如主键id 是整形的，b+tree 存储的时候，主键索引每个节点内的索引可以是顺序存储主键索引1，2,3依次存储，如果查询某个id 用二分查找效率可以很高，如果主键是字符串类型的呢，也会是顺序存储的吗？这个顺序是如何的，定义呢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436840,"discussion_content":"字符串存储和数字类型存储一样的，\n顺序就是按照字符串的大小判断规则， &amp;#39;b&amp;#39;&amp;gt;&amp;#39;a&amp;#39;, &amp;#39;9&amp;#39;&amp;gt;&amp;#39;10&amp;#39;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547690588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442605,"avatar":"https://static001.geekbang.org/account/avatar/00/16/03/2d/404627dc.jpg","nickname":"Anryg Zhun","note":"","ucode":"76DF8560BA9D14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":187779,"discussion_content":"字符串就是按照字典序进行排序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582767986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61219,"user_name":"Douglas","can_delete":false,"product_type":"c1","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1547639779,"is_pvip":false,"replies":[{"id":"21795","content":"InnoDB都是b+树结构，你问的“都是顺序存储的吗”没看懂，顺序的意思是？<br><br>索引是字符串类型不影响呀，在机器存储的时候，是无所谓ascii码的，全是二进制","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547658784,"ip_address":"","comment_id":61219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547639779","product_id":100020801,"comment_content":"老师，主键索引和非主键索引在存储的时候，都是顺序存储的吗？都是b+ tree 数据结构？如果索引是字符串类型的呢，转asc码后顺序存储吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436789,"discussion_content":"InnoDB都是b+树结构，你问的“都是顺序存储的吗”没看懂，顺序的意思是？\n\n索引是字符串类型不影响呀，在机器存储的时候，是无所谓ascii码的，全是二进制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547658784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54909,"user_name":"SaimSaim","can_delete":false,"product_type":"c1","uid":1344007,"ip_address":"","ucode":"E4755472EF6C1E","user_header":"https://static001.geekbang.org/account/avatar/00/14/82/07/5940b400.jpg","comment_is_top":false,"comment_ctime":1545980471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545980471","product_id":100020801,"comment_content":"没看懂答案,上期题目说rows其实还是1W,现在这里又说是10W","like_count":0},{"had_liked":false,"id":52144,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1545319012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545319012","product_id":100020801,"comment_content":"我会考虑用hash字段方式，因为这个场景下用hash字段方式查询效率更稳定。<br><br>另外，我能平时做业务的时候出于更通用的考虑，好像很少在业务上用函数，","like_count":0},{"had_liked":false,"id":51537,"user_name":"轻歌赋","can_delete":false,"product_type":"c1","uid":1251574,"ip_address":"","ucode":"22F62446208805","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/f6/2ff7bc7a.jpg","comment_is_top":false,"comment_ctime":1545195475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545195475","product_id":100020801,"comment_content":"从第9位开始截取到末尾，额外增加一个字段存储该值，然后在上面建立索引。因为是一个学校的同一年入学的学生的顺序号不可能一样，因此可以直接这样做。空间增加了一个字段和相应的索引长度。时间上根据建立的索引来，如果支持查找一个范围内，那么推荐b树。否则推荐hash。","like_count":0},{"had_liked":false,"id":51042,"user_name":"成葛格","can_delete":false,"product_type":"c1","uid":1030745,"ip_address":"","ucode":"A09A57D891FA50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/59/ffa298a2.jpg","comment_is_top":false,"comment_ctime":1545105092,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545105092","product_id":100020801,"comment_content":"数据量有多大才考虑用后两种索引，怎样去平衡这个（业务量与收益）？","like_count":0},{"had_liked":false,"id":50848,"user_name":"假装有网名","can_delete":false,"product_type":"c1","uid":1023922,"ip_address":"","ucode":"A47E2975D36CCF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/b2/ca764e25.jpg","comment_is_top":false,"comment_ctime":1545054411,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545054411","product_id":100020801,"comment_content":"邮箱后缀是一样的了，然后去掉后缀倒序索引","like_count":0},{"had_liked":false,"id":50725,"user_name":"William","can_delete":false,"product_type":"c1","uid":1346215,"ip_address":"","ucode":"55F5D9DEE485B1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","comment_is_top":false,"comment_ctime":1545035759,"is_pvip":true,"replies":[{"id":"18204","content":"倒序索引的话建议把邮箱部分去掉哈。<br>可以看一下其它同学评论，和下期末尾","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545041497,"ip_address":"","comment_id":50725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545035759","product_id":100020801,"comment_content":"针对本章问题想法如下：<br>1、将按照规则生成的名称 ，存入单独字段，做全列索引。<br><br>2、按规则生成的名称做倒序索引。<br>优先级 1 &gt; 2<br>请老师指教。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433075,"discussion_content":"倒序索引的话建议把邮箱部分去掉哈。\n可以看一下其它同学评论，和下期末尾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545041497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49900,"user_name":"萧箫萧","can_delete":false,"product_type":"c1","uid":1218358,"ip_address":"","ucode":"B8259F3CDFCCAD","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/36/6addd2b6.jpg","comment_is_top":false,"comment_ctime":1544785993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544785993","product_id":100020801,"comment_content":"问个问题<br>a.xxx=100 int类型<br>a.mmm=-1<br>执行<br>select  * from a where a.xxx=&quot;01e2g5hg3afasf4t4j65&quot; and a.mmm =&quot;-1&quot;<br>为什么这样搜索也可以获取到a.xxx是100的这条信息","like_count":0},{"had_liked":false,"id":49349,"user_name":"树下品茶","can_delete":false,"product_type":"c1","uid":1141653,"ip_address":"","ucode":"90591411778080","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI6VXLO35tTZ0H2rKj97CH53lUC9icgkUTAuGjpqEicJecDoDpMvwKGrsV6ZNicVOJStocM16zZicpYiaA/132","comment_is_top":false,"comment_ctime":1544669314,"is_pvip":false,"replies":[{"id":"17753","content":"嗯你说的对，数据量和压力预估，是先于语句具体设计的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544675323,"ip_address":"","comment_id":49349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544669314","product_id":100020801,"comment_content":"如果是维护“一个学校”的学生信息数据库，那数据量会非常小，但感觉老师指的是维护一个“学校的学生信息数据库”，应该是多个学校，可能是市级或者省级或者国家级的一个学校登录系统，那么数据量会大不少。因为学生不是一般app的用户或者政府机关里记录的公民，学生是会离校的，如果定期把已经离校的学生从表中转移到历史表，那么数据量是可控的。<br>在定期清理离校学生信息的情况下，如果总数据量预估不太大，不如直接把登录编号作为索引，那么回表取一次密码就行了。如果再追求速度且空间也允许，那么把索引和密码做个联合索引，连回表都不用回。如果总数据量预估还是有点大的话就通过hash索引走比较好。不了解现在学生数量没法估计，只是一个思路","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432585,"discussion_content":"嗯你说的对，数据量和压力预估，是先于语句具体设计的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544675323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49267,"user_name":"拓拔泽","can_delete":false,"product_type":"c1","uid":1323257,"ip_address":"","ucode":"1EB797F64CE26D","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f9/e4e49771.jpg","comment_is_top":false,"comment_ctime":1544657668,"is_pvip":false,"replies":[{"id":"17756","content":"啊，不是吧，你可以截个图，然后发私信给“极客时间”这个微博账号反馈下， 网页版应该可以的吧？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544675514,"ip_address":"","comment_id":49267,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544657668","product_id":100020801,"comment_content":"老师，你的课程说的很详细。但每次举例子的SQL语句，可能由于软件的原因，我总看不到完整的SQL语句。😂","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432552,"discussion_content":"啊，不是吧，你可以截个图，然后发私信给“极客时间”这个微博账号反馈下， 网页版应该可以的吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544675514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49214,"user_name":"杰之7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1544624784,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544624784","product_id":100020801,"comment_content":"通过这节文章的阅读学习，熟悉了Mysql完整索引和前缀索引及其他一些索引方式.在实践通过中，能合理的使用前缀索引当然是最好的，技能做到节省空间，也不会使用太多的查询成本。但前索引就用不上对查询性能的优化了。<br>在当使用前缀索引不能符合我们的饿索引要求时，例如维护某个市的身份证号，我们可以通过使用倒序索引来达到我们的查询需求，还可以使用Hash索引来进行查询。所以是倒序查询，所以就不支持查询范围了，Hash同样也不支持范围查询。它们的不同点可以从储存空间，CPU，查询效率方面进行比较。<br>通过阅读学习，今天能跟上老师的节奏学习数据库技术，也算是同步的老师的思维，跟老师互动，也是自我的一种有效反馈。<br>","like_count":0},{"had_liked":false,"id":48787,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1544537373,"is_pvip":true,"replies":[{"id":"17523","content":"后面会慢慢发现还有不少这样的动作😓<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544546728,"ip_address":"","comment_id":48787,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1544537373","product_id":100020801,"comment_content":"在全字段索引的分析中写到“从 index1 索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得 ID2 的值；在主键上查到主键值是ID2的行，判断email是否正确，将这行记录加入结果集”；为什么根据辅助索引查找到主键索引值后进行回表时，还需要判断email是否正确呢，是不是有点多此一举呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432351,"discussion_content":"后面会慢慢发现还有不少这样的动作😓\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544546728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48724,"user_name":"罗杰","can_delete":false,"product_type":"c1","uid":1316843,"ip_address":"","ucode":"7D440AFAA78678","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/eb/8bfd69b0.jpg","comment_is_top":false,"comment_ctime":1544522770,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544522770","product_id":100020801,"comment_content":"undo是前面写的redo吗","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154190,"discussion_content":"严格来说不是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580125020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48641,"user_name":"Zp","can_delete":false,"product_type":"c1","uid":1186467,"ip_address":"","ucode":"A15C8753F2D3AA","user_header":"https://static001.geekbang.org/account/avatar/00/12/1a/a3/a7da014c.jpg","comment_is_top":false,"comment_ctime":1544504790,"is_pvip":false,"replies":[{"id":"17484","content":"啊？按照字符串大小比较的规则来构建树。（我怀疑我没有get到你的问题","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544523948,"ip_address":"","comment_id":48641,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544504790","product_id":100020801,"comment_content":"老师，字符串类型的索引树，是怎么排序的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432288,"discussion_content":"啊？按照字符串大小比较的规则来构建树。（我怀疑我没有get到你的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48599,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1544493566,"is_pvip":false,"replies":[{"id":"17412","content":"索引小，占用内存也小的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544500982,"ip_address":"","comment_id":48599,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544493566","product_id":100020801,"comment_content":"老师，之前有说到索引的键越短，一个数据页中能存的索引也就越多，从而减少了数据页的访问，提高了查询效率。<br>我想问下，即使使用完整的键，在查询的过程中可能也就是多一次磁盘访问，但是随着固态硬盘的普及，读磁盘的速度会变得非常快，这么一来这种优化对于性能的提升是不是并不明显了呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432266,"discussion_content":"索引小，占用内存也小的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544500982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48546,"user_name":"果然如此","can_delete":false,"product_type":"c1","uid":1210003,"ip_address":"","ucode":"C7543BD0A67505","user_header":"https://static001.geekbang.org/account/avatar/00/12/76/93/c78a132a.jpg","comment_is_top":false,"comment_ctime":1544486498,"is_pvip":false,"replies":[{"id":"17417","content":"👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544501310,"ip_address":"","comment_id":48546,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544486498","product_id":100020801,"comment_content":"由于只是一个学校，不用存学校和城市代码，邮箱后缀也一样，所以只存年份和序号为学号，用学号和秘密做联合索引。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432239,"discussion_content":"👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48339,"user_name":"杨智晓 ✟","can_delete":false,"product_type":"c1","uid":1024263,"ip_address":"","ucode":"E3B56F4A38F63D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/07/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1544424764,"is_pvip":false,"replies":[{"id":"17260","content":"嗯，中间的就是fulltext索引才支持了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544430318,"ip_address":"","comment_id":48339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544424764","product_id":100020801,"comment_content":"都固定了后缀了，而且前缀全是数字，干嘛不直接存数字呢，后缀查询的时候再加上去嘛，数字索引查询效率高、而且还可以区间查询；另外我想问一下，MySQL只有前缀索引吗？有没有取字符串中间部分作为子串来建索引呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432137,"discussion_content":"嗯，中间的就是fulltext索引才支持了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544430318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48329,"user_name":"东华","can_delete":false,"product_type":"c1","uid":1325307,"ip_address":"","ucode":"B87788E1205AA2","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/fb/65fed8de.jpg","comment_is_top":false,"comment_ctime":1544422720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544422720","product_id":100020801,"comment_content":"老师，我看了下网上资料替补crc32的不足，产生碰撞的概率，用mysql的crc64补充函数（安装 common_schema database函数库）不知道这个方案可行性怎么样？","like_count":0},{"had_liked":false,"id":48301,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1544415045,"is_pvip":true,"replies":[{"id":"17245","content":"就叫id吧😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544418381,"ip_address":"","comment_id":48301,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1544415045","product_id":100020801,"comment_content":"记得之前看到《阿里巴巴Java开发手册》上MySQL建表公约部分有如下说明：主键索引名为pk_字段名；唯一索引名为uk_字段名；普通索引名则为idx_字段名。<br>如果使用自增字段作为主键，那如何给这个字段添加一个自定义的主键索引名称呢？<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432115,"discussion_content":"就叫id吧😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48283,"user_name":"少雷","can_delete":false,"product_type":"c1","uid":1199547,"ip_address":"","ucode":"4D010DE272BA0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/bb/c0c02d46.jpg","comment_is_top":false,"comment_ctime":1544410942,"is_pvip":false,"replies":[{"id":"17251","content":"这个没辙了，要用全文检索(full text)索引","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544418823,"ip_address":"","comment_id":48283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544410942","product_id":100020801,"comment_content":"请问老师，模糊查询like &#39;%name%&#39; 应该怎么加索引呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432103,"discussion_content":"这个没辙了，要用全文检索(full text)索引","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48278,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1544410130,"is_pvip":true,"replies":[{"id":"17238","content":"1. 不能再加了，主键定义本身就是索引了<br>2. 不用，（11）里面就是填充位，不用就可以放默认<br>3. 对，“区分度足够高的前缀索引”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544413657,"ip_address":"","comment_id":48278,"utype":1}],"discussion_count":1,"race_medal":2,"score":"1544410130","product_id":100020801,"comment_content":"老师，有三个问题希望您解答：<br>0：将自增字段作为主键，需要给这个主键加索引么；加了主键索引与不加区别在哪？<br>1：数据表字段如果不需要填充零，像int bigint这种类型，还需要设置位数么，比如int(11)这种<br>2：一般来说，在需要给字符串字段添加辅助索引的前提下，是不是更推荐使用区分度高的前缀索引（或是其它变形）而不是完整的字段索引","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432101,"discussion_content":"1. 不能再加了，主键定义本身就是索引了\n2. 不用，（11）里面就是填充位，不用就可以放默认\n3. 对，“区分度足够高的前缀索引”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544413657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48242,"user_name":"Hesher","can_delete":false,"product_type":"c1","uid":1026832,"ip_address":"","ucode":"99AB8B1704CB7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg","comment_is_top":false,"comment_ctime":1544405722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544405722","product_id":100020801,"comment_content":"回家一下课后问题，由于有gmail.com后缀，使用倒叙+前缀索引就比较浪费了，区分度最高的部分是学号的后8位，也就是年份+序号。不如把这8位单独存储再倒叙建立索引，或者直接对登录名hash索引。","like_count":0},{"had_liked":false,"id":48080,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1544344785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544344785","product_id":100020801,"comment_content":"思考题: 可以用@前的学号部分作为前缀索引.","like_count":0},{"had_liked":false,"id":48053,"user_name":"产品助理","can_delete":false,"product_type":"c1","uid":1019821,"ip_address":"","ucode":"39A76D346A96E9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8f/ad/6e3e9e15.jpg","comment_is_top":false,"comment_ctime":1544334702,"is_pvip":false,"replies":[{"id":"17134","content":"这个是server 层的行为，其实反正肯定要读入数据，蛮判断一下…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544354005,"ip_address":"","comment_id":48053,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544334702","product_id":100020801,"comment_content":"如果使用的是 index1（即 email 整个字符串的索引结构），执行顺序是这样的：<br><br>从 index1 索引树找到满足索引值是’zhangssxyz@xxx.com’的这条记录，取得 ID2 的值；<br><br>到主键上查到主键值是 ID2 的行，判断 email 的值是正确的，将这行记录加入结果集；<br><br>取 index1 索引树上刚刚查到的位置的下一条记录，发现已经不满足 email=&#39;zhangssxyz@xxx.com’的条件了，循环结束。<br><br>这个过程中，只需要回主键索引取一次数据，所以系统认为只扫描了一行。<br><br><br>上述场景下，为什么要到主键id2上再判断下email是否一致呢？什么时候可能不一致啊？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432009,"discussion_content":"这个是server 层的行为，其实反正肯定要读入数据，蛮判断一下…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544354005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48039,"user_name":"王金龙","can_delete":false,"product_type":"c1","uid":1106058,"ip_address":"","ucode":"E1BD8BC7CB426B","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/8a/38118387.jpg","comment_is_top":false,"comment_ctime":1544328224,"is_pvip":true,"replies":[{"id":"17136","content":"Where crc字段= crc32()这样可以用索引的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544354129,"ip_address":"","comment_id":48039,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544328224","product_id":100020801,"comment_content":"查询条件中有计算属性应该不能用索引吧，像例子中的crc计算。如果要用，\b应该得在代码里把crc的计算值传到sql语句中。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431997,"discussion_content":"Where crc字段= crc32()这样可以用索引的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544354129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48016,"user_name":"力挽狂澜爆炸输出的臭臭宁","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1544323025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544323025","product_id":100020801,"comment_content":"老师可不可以讲一下mysql的in、exists、join的原理与性能对比","like_count":0},{"had_liked":false,"id":47874,"user_name":"特斯拉","can_delete":false,"product_type":"c1","uid":1230807,"ip_address":"","ucode":"C65901BD39AF0F","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/d7/b9f93eec.jpg","comment_is_top":false,"comment_ctime":1544242184,"is_pvip":false,"replies":[{"id":"17107","content":"这样写没错的，你发一下报错的提示内容和show create表结构","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544333702,"ip_address":"","comment_id":47874,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544242184","product_id":100020801,"comment_content":"请问林老师，假设一张表上有四列，分别是ID，公司名，商品名，价格。其中公司名互不相同，商品名和价格有的相同有的不同。我如果想要对商品名进行排序，并且对相同商品名的商品再次利用价格进行排序，使用的代码如下：<br>SELECT products <br>FROM tb1<br>ORDER BY products, price;<br>这个句子有什么问题，为什么总是出现语法错误。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431923,"discussion_content":"这样写没错的，你发一下报错的提示内容和show create表结构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544333702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47852,"user_name":"404","can_delete":false,"product_type":"c1","uid":1313407,"ip_address":"","ucode":"2E7815DDCBA8AB","user_header":"","comment_is_top":false,"comment_ctime":1544236588,"is_pvip":false,"replies":[{"id":"17110","content":"确实是要看前缀过滤效果的；<br><br>用户昵称一般多长，如果平均长度大，比如平均长度12个字节，那可能有收益。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544333887,"ip_address":"","comment_id":47852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544236588","product_id":100020801,"comment_content":"完整索引跟前缀索引比，空间上会大多少呢。比如1000万条数据。邮箱的前缀索引按照现有算法假定算出来的长度是6，单随着业务的发展，如果发现不合适了，是不是就要改变长度了（比如之前只有网易邮箱，后面有QQ邮箱，Google邮箱等），这样带来的成本有多大呢。<br>还有一个是hash 索引这个，我们现在很多情况下会有用户昵称登陆，且是唯一的。那是不是也可以加一个字段存hash 值，并且加索引，那这个索引用前缀索引好还是完整索引好，假定hash s算法是md5.","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431911,"discussion_content":"确实是要看前缀过滤效果的；\n\n用户昵称一般多长，如果平均长度大，比如平均长度12个字节，那可能有收益。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544333887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47790,"user_name":"Bolor","can_delete":false,"product_type":"c1","uid":1314048,"ip_address":"","ucode":"536456A7D5FB0C","user_header":"https://static001.geekbang.org/account/avatar/00/14/0d/00/ed8ce979.jpg","comment_is_top":false,"comment_ctime":1544197509,"is_pvip":false,"replies":[{"id":"17021","content":"两个思路都不错哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544204918,"ip_address":"","comment_id":47790,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544197509","product_id":100020801,"comment_content":"老师好，我觉得应该把入学年份和顺序单拉出来存进一个字段，加索引。登录是照样从登录名截取入学年份和顺序与新建的字段比较。<br><br>或者对登录名直接hash单独存进一个字段，登录时hash后与新字段比较。<br><br>请老师给与评价吧，谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431888,"discussion_content":"两个思路都不错哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544204918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47787,"user_name":"Kaer","can_delete":false,"product_type":"c1","uid":1113558,"ip_address":"","ucode":"1BD233D3FAC2B1","user_header":"https://static001.geekbang.org/account/avatar/00/10/fd/d6/71e1cc29.jpg","comment_is_top":false,"comment_ctime":1544197098,"is_pvip":false,"replies":[{"id":"17022","content":"其实看冲突概率，<br><br>如果冲突多，肯定是先update ，这样直接没有后面的insert的事；<br>如果冲突少，先update就浪费一次交互。<br><br>另外你说的“有热点去”我不太理解，是热点行吗？如果是热点行，那先update也是一样慢呀","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544205129,"ip_address":"","comment_id":47787,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544197098","product_id":100020801,"comment_content":"老师，insert on duplicated key update 这个语句和先update再insert的效率哪个高呀。我们现在系统用的第一种，有热点更新被吐槽很厉害，就修改为第二种方式了。我理解应该第二种效率更高才对啊，锁的粒度更小。能不能开个专题讲一讲。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431887,"discussion_content":"其实看冲突概率，\n\n如果冲突多，肯定是先update ，这样直接没有后面的insert的事；\n如果冲突少，先update就浪费一次交互。\n\n另外你说的“有热点去”我不太理解，是热点行吗？如果是热点行，那先update也是一样慢呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544205129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47763,"user_name":"lttzzlll","can_delete":false,"product_type":"c1","uid":1105387,"ip_address":"","ucode":"FA160F7C02ABAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/eb/80f9d212.jpg","comment_is_top":false,"comment_ctime":1544192208,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544192208","product_id":100020801,"comment_content":"城市 学校编号等信息是不变的，不用存，每次查询程序拼出学生的完整学号就行。或者单独一张元信息表用来存城市，学校等信息。因为是一个学校的学生管理系统。","like_count":0},{"had_liked":false,"id":47687,"user_name":"包子木有馅","can_delete":false,"product_type":"c1","uid":1318851,"ip_address":"","ucode":"9B8712D4DC7471","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/c3/1ef2bccf.jpg","comment_is_top":false,"comment_ctime":1544181773,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544181773","product_id":100020801,"comment_content":"老师好，这里有个问题请教一下：<br>innodb的undolog是存在共享表空间ibdata1的，然后普通的数据页和索引页是在独立表空间ibd里，当我select一个值的时候（快照读），通过辅助索引的B+树找到根节点，这个时候我要去找旧版本的数据（mvcc）,必然是通过undolog来做，那么innodb是怎么从辅助索引页（独立表空间）跳到 undolog（共享表空间）的呢，是通过指针吗，我看书上说 “Innodb引擎的主键索引记录的头上包含有6字节的事务ID（DB_TX_ID）与7字节指向回滚段中旧版本的指针（DB_ROLL_PTR）”，所以可以从主键索引的根节点通过指针跳过去，但是辅助索引的根节点有没有这个指针呢，如果没有要怎么跳过去呢，难道要先跳到主键索引上，然后再跳undolog吗，如果是这样，那岂不是只要是快照读，都得回主键索引一趟，覆盖索引不就没用了吗。<br>非常疑惑","like_count":0},{"had_liked":false,"id":47675,"user_name":"依然范儿特西","can_delete":false,"product_type":"c1","uid":1197901,"ip_address":"","ucode":"A0E621F4FF4F21","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/4d/25a5963d.jpg","comment_is_top":false,"comment_ctime":1544176846,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544176846","product_id":100020801,"comment_content":"我来了","like_count":0},{"had_liked":false,"id":47663,"user_name":"AstonPutting","can_delete":false,"product_type":"c1","uid":1303239,"ip_address":"","ucode":"1DB579A7922964","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/c7/d6a0927a.jpg","comment_is_top":false,"comment_ctime":1544174355,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544174355","product_id":100020801,"comment_content":"“从占用的额外空间来看，倒序存储方式在主键索引上，不会消耗额外的存储空间”，为什么倒序存储方式在主键索引上。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154197,"discussion_content":"看前面的评论，有回答。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580125500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47662,"user_name":"cheriston","can_delete":false,"product_type":"c1","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1544174142,"is_pvip":false,"replies":[{"id":"17023","content":"可以走的，函数值没在字段上呀","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544205396,"ip_address":"","comment_id":47662,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544174142","product_id":100020801,"comment_content":"老师:倒序存储那条sql 也不走索引吧,where 条件 是个函数值.","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431848,"discussion_content":"可以走的，函数值没在字段上呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544205396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47637,"user_name":"库淘淘","can_delete":false,"product_type":"c1","uid":1310240,"ip_address":"","ucode":"90813B0C46E978","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibSwKPg7hiapc49qoM4dibhM3fYANPjfltF2ibBZ3dHX2hibjg5EIIcziahrmjO5R2XrcRibvU39TQS7jg/132","comment_is_top":false,"comment_ctime":1544170118,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544170118","product_id":100020801,"comment_content":"使用hash 对11到15做crc32 作为一列并加索引 where name_crc=crc 32(substring(值，11，15））and ID=列","like_count":0},{"had_liked":false,"id":47609,"user_name":"郭江伟","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1544164899,"is_pvip":false,"replies":[{"id":"16969","content":"也是不错的思路","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544167997,"ip_address":"","comment_id":47609,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1544164899","product_id":100020801,"comment_content":"根据题目，设计一个学校的学生数据库，学生登录名的统一格式是”学号 @gmail.com&quot;, <br>1，其中只有学号部分不一样，可以考虑只存储学号，不存储后缀，考虑到后缀有变的可能性，也可以用单独的字段或者表存后缀，<br>2，学号规则里面只有年份和顺序编号有区分度，城市编号和学校编号也可以跟后缀一样单独放一个字段或者单独建一个表；<br>3，顺序编号为5位，可以考虑单独将顺序编号做一个字段，然后建立索引<br>4，应用程序查询登陆名时，可以根据规则将登陆名拆开，以顺序号作为查询条件，同时查询语句需要匹配前缀和后缀信息，","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431830,"discussion_content":"也是不错的思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544167997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154198,"discussion_content":"顺序编号当面临数据多时，也是要重复的。还不如年份+顺序号做为索引呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580125709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47544,"user_name":"kunsect","can_delete":false,"product_type":"c1","uid":1299322,"ip_address":"","ucode":"2CC4ADF82887FC","user_header":"https://static001.geekbang.org/account/avatar/00/13/d3/7a/dd7d35b5.jpg","comment_is_top":false,"comment_ctime":1544152883,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544152883","product_id":100020801,"comment_content":"课后题：因为前六位区分度太低，所以只拿取 7-15 位的数字建立倒序索引。占用字节数跟 hash 一样只需 4 个字节，而且消耗资源更少。","like_count":0},{"had_liked":false,"id":47530,"user_name":"铁皮","can_delete":false,"product_type":"c1","uid":1013200,"ip_address":"","ucode":"E20FB02D9ABD20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/d0/0053c9ba.jpg","comment_is_top":false,"comment_ctime":1544151225,"is_pvip":false,"replies":[{"id":"16952","content":"给细致思考点赞","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544153043,"ip_address":"","comment_id":47530,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544151225","product_id":100020801,"comment_content":"课后思考<br>我的解决思路是：<br>增加一个学号的列，类型是bigint（int类型范围不够）。并对这个列创建一个索引。<br>分析：bigint占用存储空间是8byte。而且数字比较肯定要优于字符的比较。这是我个人的想法。<br>select * from student where no = input_no<br><br>按老师讲的思路是：<br>1. 使用倒序存储<br>增加一个学号的列，并且是倒序存储的。类型是varchar(15) 或是 char(15) 。可能char(15)更好些。<br>并对这个列创建一个前缀索引，取前8个字符。<br>select * from student where re_no = reverse(&#39;input_no&#39;);<br><br>2. 使用hash字段<br>增加一个对email进行crc32后存储的列。类型是varchar(10)或是char(10)。并对这个列创建索引。<br>select * from student where crc_email = CRC32(&#39;input_email&#39;) and email = &#39;input_email&#39;;<br><br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431797,"discussion_content":"给细致思考点赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544153043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47508,"user_name":"殿小二","can_delete":false,"product_type":"c1","uid":1284986,"ip_address":"","ucode":"E979673B257C24","user_header":"https://static001.geekbang.org/account/avatar/00/13/9b/7a/58327b6d.jpg","comment_is_top":false,"comment_ctime":1544148774,"is_pvip":false,"replies":[{"id":"16950","content":"Where条件顺序，优化器会自动调整的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544152991,"ip_address":"","comment_id":47508,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544148774","product_id":100020801,"comment_content":"老师,你好,mysql where 条件后面的执行顺序是 左-&gt;右吗?,还是说优化器会自动选择顺序,如果是自动选择的话,他先id_card=(&#39;input_string&#39;) 再过滤crc32岂不是多做无用功了啊","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431786,"discussion_content":"Where条件顺序，优化器会自动调整的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544152991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47438,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1544144244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544144244","product_id":100020801,"comment_content":"课后题解答：一个学校内的数据，只需年份和顺序编号即可确定一个学生的唯一性。再来考虑索引数据长度的问题，年份只需取后两位即可，跨百年的学校很少；顺序编码是五位，可以统计一下该校历年的学生人数，如果基本不超过1万，可考虑只使用四位编码，大概率只需回表一次","like_count":0},{"had_liked":false,"id":47433,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1544143871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544143871","product_id":100020801,"comment_content":"1 可重复读隔离级别，会在事务启动前创建个视图，视图里面包含哪几部分？老师讲的先删除10万条数据，再新增10万条数据，这种情况下，索引树和存储的数据是怎么变化的？老的索引树和数据什么时候删除？","like_count":0},{"had_liked":false,"id":47430,"user_name":"码上有钱","can_delete":false,"product_type":"c1","uid":1081524,"ip_address":"","ucode":"BB10B8686DE9B0","user_header":"https://static001.geekbang.org/account/avatar/00/10/80/b4/4bce6198.jpg","comment_is_top":false,"comment_ctime":1544143809,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544143809","product_id":100020801,"comment_content":"对于一个学校的登录名，地区编码和学校编码是一样的，邮箱的后缀@gmail.com也是一样的，区分度最大的在入学年份和顺序编号，使用完整索引，空间消耗大；如果使用前缀索引，需要loginname(15)，这样空间消耗比较大；我会新增一个字段，暂且叫学生标识，截取入学年份和顺序编号作为该字段的值，给这个字段建完整索引。(PS:对于学号来说，入学年份加顺序编号应该是唯一的)","like_count":0},{"had_liked":false,"id":47422,"user_name":"不靠谱的琴谱","can_delete":false,"product_type":"c1","uid":1243964,"ip_address":"","ucode":"D388EDFD6E5F8C","user_header":"https://static001.geekbang.org/account/avatar/00/12/fb/3c/e92d40f6.jpg","comment_is_top":false,"comment_ctime":1544143428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544143428","product_id":100020801,"comment_content":"不整那些花里胡哨的，学号是15位数字，前面提到是一个学校内，前6位基本一致，直接把学号后9位提取存一个int字段加索引","like_count":0},{"had_liked":false,"id":47416,"user_name":"杨","can_delete":false,"product_type":"c1","uid":1105205,"ip_address":"","ucode":"D0D765F986AF59","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/35/f9cbab6a.jpg","comment_is_top":false,"comment_ctime":1544143169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544143169","product_id":100020801,"comment_content":"请教一个问题，业务上有这样的需求，A、B两个用户，如果互相喜欢，则成为好友。设计上是有两张表，一个是like表，一个是friend表，like表有user_id、liker_id两个字段，我设置为复合唯一索引即uk_user_id_liker_id。语句执行顺序是这样的：<br>以A喜欢B为例：<br>1、先查询对方有没有喜欢自己（B有没有喜欢A）<br>select * from like where user_id = B and liker_id = A<br>2、如果有，则成为好友<br>insert into friend<br>3、没有，则只是喜欢关系<br>insert into like<br><br>如果A、B同时喜欢对方，会出现不会成为好友的问题。因为上面第1步，双方都没喜欢对方。第1步即使使用了排他锁也不行，因为记录不存在，行锁无法生效。请问这种情况，在mysql锁层面有没有办法处理         这个问题是怎么解决的啊","like_count":0},{"had_liked":false,"id":47406,"user_name":"读书看报","can_delete":false,"product_type":"c1","uid":1306147,"ip_address":"","ucode":"3B4717314B52A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/ee/23/b92b0811.jpg","comment_is_top":false,"comment_ctime":1544142472,"is_pvip":false,"replies":[{"id":"16936","content":"额，做都做了…😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544149439,"ip_address":"","comment_id":47406,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1544142472","product_id":100020801,"comment_content":"所有业务系统的主键均是用的uuid , 该怎么办😂","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431760,"discussion_content":"额，做都做了…😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544149439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117335,"discussion_content":"负责人拉出去枪毙十分钟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578109079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47400,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1544142135,"is_pvip":false,"replies":[{"id":"16954","content":"平时根据快递单号和之间，是同时传入，还是两个不同的语句？<br>别的字段没用的就不要建到索引里了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544159742,"ip_address":"","comment_id":47400,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544142135","product_id":100020801,"comment_content":"老师，我们有这样一个表，里面存的是快递信息，主要有快递单号，快递公司，添加时间，订单号这几个列，都是字符串，500w 左右的数据，列的长度大概是10-50之间，平时的查询是通过快递单号和时间查找，如果我给每一个列单独加索引和快递单号、快递公司、时间做联合索引，以及快递单号前缀索引，我认为联合索引的速度会最快，但是会增加索引的长度和占用空间，老师您觉得该怎么修改，联合索引会额外占用多少物理空间，这个对查询速度影响大吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431758,"discussion_content":"平时根据快递单号和之间，是同时传入，还是两个不同的语句？\n别的字段没用的就不要建到索引里了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544159742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47394,"user_name":"张永志","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1544141417,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544141417","product_id":100020801,"comment_content":"因为登录名邮箱是固定格式，所以表中可只存储入学年份+序号，即学号的第7到第15位，共计9位。<br>由于存储值为数值形式，所以字段可设为int类型。<br>当类型为int时，登录索引为了避免回表取密码字段，直接创建学号、密码两个字段的覆盖索引就可以。查询时需要将登录名进行截取以匹配表中数据。<br>当学号字段为字符串类型，学号可倒序存储，也可不倒序，这里性能影响不大。索引设计为学号密码两字段的覆盖索引，学号无需前缀。","like_count":0},{"had_liked":false,"id":47353,"user_name":"张翀","can_delete":false,"product_type":"c1","uid":1241064,"ip_address":"","ucode":"835A01424FDD5E","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/e8/076a6f59.jpg","comment_is_top":false,"comment_ctime":1544112852,"is_pvip":true,"replies":[{"id":"16967","content":"这个后面会有文章说到哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544167881,"ip_address":"","comment_id":47353,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544112852","product_id":100020801,"comment_content":"请问老师，count(1) 和count(*)以及count(列)的区别呢？或者说在什么场景下(比如对某列加了索引后)，哪句性能更有优势呢，谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431747,"discussion_content":"这个后面会有文章说到哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544167881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47349,"user_name":"张翀","can_delete":false,"product_type":"c1","uid":1241064,"ip_address":"","ucode":"835A01424FDD5E","user_header":"https://static001.geekbang.org/account/avatar/00/12/ef/e8/076a6f59.jpg","comment_is_top":false,"comment_ctime":1544112499,"is_pvip":true,"replies":[{"id":"16891","content":"后面有文章会展开这个话题","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544114359,"ip_address":"","comment_id":47349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544112499","product_id":100020801,"comment_content":"请问一下老师解释下count(1)和count(*)的区别呢，谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431746,"discussion_content":"后面有文章会展开这个话题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544114359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}