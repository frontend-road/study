{"id":167678,"title":"10 | 复制集机制及原理","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":155407,"user_name":"Julien","can_delete":false,"product_type":"c3","uid":1204568,"ip_address":"","ucode":"2A3F0CF46B4034","user_header":"https://static001.geekbang.org/account/avatar/00/12/61/58/7b078879.jpg","comment_is_top":false,"comment_ctime":1574686005,"is_pvip":false,"replies":[{"id":59919,"content":"“MongoDB官方好像是建议1主1从1arbiter” 请提供相应的文章。\n\n主节点挂了以后，两个从节点的投票算法会防止你说的现象发生。具体来说，如果两个从节点条件完全一样，那么第一个主张的节点就获胜。如果两个从节点同时主张自己，那么两个人同时放弃，并用一个随机值等待一小段时间（数秒），然后重试。所以总有一个节点会在另一个之前选为主节点。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574812934,"ip_address":"","comment_id":155407,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师你好。MongoDB官方好像是建议1主1从1arbiter。如果是1主2从，主节点挂掉后，两个从节点都投票给自己，这样僵持，不是会没法产生新的master吗？","like_count":10,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475742,"discussion_content":"“MongoDB官方好像是建议1主1从1arbiter” 请提供相应的文章。\n\n主节点挂了以后，两个从节点的投票算法会防止你说的现象发生。具体来说，如果两个从节点条件完全一样，那么第一个主张的节点就获胜。如果两个从节点同时主张自己，那么两个人同时放弃，并用一个随机值等待一小段时间（数秒），然后重试。所以总有一个节点会在另一个之前选为主节点。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574812934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363671,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","nickname":"不负青春不负己🤘","note":"","ucode":"A6DD8E8B20EA6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588446,"discussion_content":"raft 共识","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663764178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1514463,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1b/df/4caad64d.jpg","nickname":"李慢慢","note":"","ucode":"AED7F0708400B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307985,"discussion_content":"改个名字而已.. 大概是&#34;主从&#34;这个词会被联想到奴隶买卖那段历史","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600821796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60465,"discussion_content":"主从模式已过时，应该用副本集替换主从模式\n从 MongoDB 3.2 开始，分片集群弃用（deprecate）主从模式作为组件\n从 MongoDB 3.6 开始，弃用（deprecate）主从模式\n从 MongoDB 4.0 开始，移除（remove）主从模式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574732496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"奕","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291641,"discussion_content":"主从模式 和副本集有什么区别呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594895681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":60465,"ip_address":"","group_id":0},"score":291641,"extra":""},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"奕","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292018,"discussion_content":"副本集算是高阶版的主从吧，主挂了可以自动选主切换。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595053399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291641,"ip_address":"","group_id":0},"score":292018,"extra":""}]}]},{"had_liked":false,"id":154406,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1574423709,"is_pvip":false,"replies":[{"id":59930,"content":"- 升级存储是最直接的方案，如PCIE + SSD\n- 注意索引的数量：索引越多写入越慢\n- 分片： 增加写的节点来提供并发\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574813682,"ip_address":"","comment_id":154406,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"通常怎样提高写性能？","like_count":6,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475459,"discussion_content":"- 升级存储是最直接的方案，如PCIE + SSD\n- 注意索引的数量：索引越多写入越慢\n- 分片： 增加写的节点来提供并发\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574813682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186614,"user_name":"Allen_","can_delete":false,"product_type":"c3","uid":1677187,"ip_address":"","ucode":"CA5E00E4644CD5","user_header":"https://static001.geekbang.org/account/avatar/00/19/97/83/845b48e2.jpg","comment_is_top":false,"comment_ctime":1583891377,"is_pvip":false,"replies":[{"id":72143,"content":"谢谢夸奖😊","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584002112,"ip_address":"","comment_id":186614,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"不得不个体TJ赞一个。都是干货而且很清楚，并且把原因讲出来了，还有对应的practice。完美。","like_count":5,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486817,"discussion_content":"谢谢夸奖😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584002112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156335,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1574858065,"is_pvip":false,"replies":[{"id":60151,"content":"通过水平扩展可以提高整体的吞吐量，但是单个（比如说，查询 id=1234 这条记录）查询是不会得到改善的。因为这个查询就是会在一个节点上发生。\n\n提高单个查询性能就是把数据放在内存里，加上合适的索引可以来提升性能（降低读取延迟）","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574943720,"ip_address":"","comment_id":156335,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师前面答复中说，增加副本集节点，只能提高并发访问能力，单个查询并不会变快。\n那么有办法通过水平扩展的方式提高单个查询的性能吗？","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476073,"discussion_content":"通过水平扩展可以提高整体的吞吐量，但是单个（比如说，查询 id=1234 这条记录）查询是不会得到改善的。因为这个查询就是会在一个节点上发生。\n\n提高单个查询性能就是把数据放在内存里，加上合适的索引可以来提升性能（降低读取延迟）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574943720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":65385,"discussion_content":"好的，谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574999289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153966,"user_name":"公众号：程序员大兵","can_delete":false,"product_type":"c3","uid":1142526,"ip_address":"","ucode":"AD0D05864C6913","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","comment_is_top":false,"comment_ctime":1574338130,"is_pvip":true,"replies":[{"id":59385,"content":"总数是看最初的配置，如你部署并配置了3个，虽然坏了一个，但是你的拓扑还是3节点， 按3节点的规则，剩下2个存活就可以正常工作。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574518968,"ip_address":"","comment_id":153966,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"如果是奇数节点，那么主节点挂掉，不就变成偶数节点了？","like_count":4,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475340,"discussion_content":"总数是看最初的配置，如你部署并配置了3个，虽然坏了一个，但是你的拓扑还是3节点， 按3节点的规则，剩下2个存活就可以正常工作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574518968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"公众号：程序员大兵","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":56848,"discussion_content":"如果是5个节点，当主节点挂了，现在只有4个节点可以参与选举，然后2个节点选了A，剩余的2个节点选了B呢？会怎么处理呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574519233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1309984,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","nickname":"cheriston","note":"","ucode":"617CBFCE0925C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"公众号：程序员大兵","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":69048,"discussion_content":"Raft协议了解下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575254835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":56848,"ip_address":"","group_id":0},"score":69048,"extra":""}]}]},{"had_liked":false,"id":239535,"user_name":"青丝成雪","can_delete":false,"product_type":"c3","uid":2094439,"ip_address":"","ucode":"27E67AC3AA31A0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjTY9B9a8iaG4iaHiaqdXywEDa99XNx6ZqcIc2IHCqN35d8hWgsKgHF2icXC9N3BnbfEADR7K920we5w/132","comment_is_top":false,"comment_ctime":1596558756,"is_pvip":false,"replies":[{"id":88684,"content":"对。读写分离的读一般指的是对时效性要求不高的读场景。如果要求高一般都建议读主节点。如果主节点性能扛不住，这个时候就要采用分片集群来分担压力(读和写)。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596792070,"ip_address":"","comment_id":239535,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师您好，复制集主从读写分离看起来很美好，但是如果对主从同步延时要求高，使用就很受限。\n比如某些业务会写操作多，实时要求高的读场景多，这样主节点压力就很大，而从节点可以分担的业务场景非常有限。\n老师如何看待复制集架构在这种业务场景中的应用和优化呢？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503132,"discussion_content":"对。读写分离的读一般指的是对时效性要求不高的读场景。如果要求高一般都建议读主节点。如果主节点性能扛不住，这个时候就要采用分片集群来分担压力(读和写)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596792070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234901,"user_name":"polk","can_delete":false,"product_type":"c3","uid":1165455,"ip_address":"","ucode":"1B6E948BA4DFAF","user_header":"https://static001.geekbang.org/account/avatar/00/11/c8/8f/e13a6552.jpg","comment_is_top":false,"comment_ctime":1594822569,"is_pvip":false,"replies":[{"id":88161,"content":"复制集也是集群，3个节点以上的高可用集群。数据不做分布式存储，只是主从热备","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596277566,"ip_address":"","comment_id":234901,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"复制集，有没有集群？就是分布式存储","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501540,"discussion_content":"复制集也是集群，3个节点以上的高可用集群。数据不做分布式存储，只是主从热备","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596277566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171034,"user_name":"ezekiel","can_delete":false,"product_type":"c3","uid":1158795,"ip_address":"","ucode":"AB4AB6FA8612D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/8b/43ce01ca.jpg","comment_is_top":false,"comment_ctime":1578827687,"is_pvip":false,"replies":[{"id":66776,"content":"可以学习后面的writeConcern, 写事务 这一节，你就了解答案了。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579132935,"ip_address":"","comment_id":171034,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"如果master中数据，没同步到slave之前挂了，数据是否会丢失？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481210,"discussion_content":"可以学习后面的writeConcern, 写事务 这一节，你就了解答案了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579132935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159858,"user_name":"标","can_delete":false,"product_type":"c3","uid":1136272,"ip_address":"","ucode":"D7FDCF388DE02C","user_header":"https://static001.geekbang.org/account/avatar/00/11/56/90/bfb92de9.jpg","comment_is_top":false,"comment_ctime":1575812654,"is_pvip":false,"replies":[{"id":61199,"content":"主从复制会有延迟。常见因素：\n1） 网络抖动 （没办法）\n2）网络拥挤  （评估数据增量需求，给予足够的带宽）\n3）节点之间延迟太长\n4）主节点压力过大  （注意监控，压力过大要扩容）\n5）从节点配置不均衡，低于主节点配置（尽量均衡）\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575944225,"ip_address":"","comment_id":159858,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师你好，主从复制是否会产生延迟，如果有延迟，那么常见有哪些因素会导致延迟，该如何避免或者降低延迟","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477192,"discussion_content":"主从复制会有延迟。常见因素：\n1） 网络抖动 （没办法）\n2）网络拥挤  （评估数据增量需求，给予足够的带宽）\n3）节点之间延迟太长\n4）主节点压力过大  （注意监控，压力过大要扩容）\n5）从节点配置不均衡，低于主节点配置（尽量均衡）\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575944225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157584,"user_name":"ousei","can_delete":false,"product_type":"c3","uid":1293645,"ip_address":"","ucode":"1660787A7DE509","user_header":"https://static001.geekbang.org/account/avatar/00/13/bd/4d/2381f135.jpg","comment_is_top":false,"comment_ctime":1575203496,"is_pvip":false,"replies":[{"id":60788,"content":"太多从节点会增加主节点的压力，大概是每增加一个节点会有10%左右的性能影响。\n\n主从读写分离还是比较常见的。所有读操作对数据时效（如报表型，或者历史数据）不高的都可以用从节点。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575471431,"ip_address":"","comment_id":157584,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"太多的slave 数据节点。都从主节点拉oplog 是否反而增加了主节点的压力？反而让主节点性能变差了？\n\n写主 读取从的这种配置是否还被推荐？什么场景适合这种？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476473,"discussion_content":"太多从节点会增加主节点的压力，大概是每增加一个节点会有10%左右的性能影响。\n\n主从读写分离还是比较常见的。所有读操作对数据时效（如报表型，或者历史数据）不高的都可以用从节点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575471431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153550,"user_name":"朱仁欢","can_delete":false,"product_type":"c3","uid":1307047,"ip_address":"","ucode":"1FF64ED7A60B0F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/lUnAGTC1HOCZPicMibj9SWpT2WkGLCuGA5XuFlVEJoCic6Y9z1JianocKibTeApsY4HOWKQ7D0zGKmJttwD5sTQTG0w/132","comment_is_top":false,"comment_ctime":1574257318,"is_pvip":false,"replies":[{"id":59031,"content":"主节点故障如果是进程crash或者server crash，那么它当然无法进行选举。\n\n如果故障是因为节点之间网络不通，那失联的主节点会自动降级为从节点。\n\n如果是短暂故障马上回复后，主节点（这个时候已经是从节点了）会重新加入选举，但是有个30秒的等待期。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574296965,"ip_address":"","comment_id":153550,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐老师，选举是发生在主节点故障时，那么它也会参与投票么？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475206,"discussion_content":"主节点故障如果是进程crash或者server crash，那么它当然无法进行选举。\n\n如果故障是因为节点之间网络不通，那失联的主节点会自动降级为从节点。\n\n如果是短暂故障马上回复后，主节点（这个时候已经是从节点了）会重新加入选举，但是有个30秒的等待期。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574296965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238463,"user_name":"川川","can_delete":false,"product_type":"c3","uid":1382517,"ip_address":"","ucode":"DA092CAC7F294D","user_header":"https://static001.geekbang.org/account/avatar/00/15/18/75/68487e89.jpg","comment_is_top":false,"comment_ctime":1596175877,"is_pvip":false,"replies":[{"id":88154,"content":"这样做是OKAY的，当然要注意InMemory Engine是商业版产品需要付费。\n\n之前有人用RAMDISK方式来模拟InMemory，但是由于代码还是WT，所以和真正的InMemory Engine还是有些差别。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596276586,"ip_address":"","comment_id":238463,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师你好， 想请教下对这种使用方式有什么看法：我们想使用此方式来提高mongodb的查询性能， 复制集采用一主两从，主节点使用memeory，从节点wiredtiger。  这样是否能够提供查询效率","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502757,"discussion_content":"这样做是OKAY的，当然要注意InMemory Engine是商业版产品需要付费。\n\n之前有人用RAMDISK方式来模拟InMemory，但是由于代码还是WT，所以和真正的InMemory Engine还是有些差别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596276586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161559,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1576231300,"is_pvip":false,"replies":[{"id":61727,"content":"1）是的会重新同步。节点之间判断是否需要同步是根据local库里的元数据决定的。里面记录了节点同步的状态信息，并不是看你实际存储的数据。 \n\n2）建议用SSL&#47;TLS 加密链路就可以有效防止数据被窃取。\n\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;tutorial&#47;configure-ssl&#47;index.html\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1576479734,"ip_address":"","comment_id":161559,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，\n1.建立3个独立的单机库，然后导入同一份数据，然后将3个节点设置为复制集模式，那么被设置为从节点的数据库里面的数据会被清空，然后再从主节点再同步回来吗？\n2.如果3个节点通过公网ip地址互连，那么这中间的数据通信需要做安全防护吗？也就是这个时候节点间的通信数据被窃取，是否有泄露数据的风险？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477763,"discussion_content":"1）是的会重新同步。节点之间判断是否需要同步是根据local库里的元数据决定的。里面记录了节点同步的状态信息，并不是看你实际存储的数据。 \n\n2）建议用SSL/TLS 加密链路就可以有效防止数据被窃取。\n\nhttps://docs.mongodb.com/manual/tutorial/configure-ssl/index.html\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576479734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1165671,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c9/67/7d446501.jpg","nickname":"大展宏兔","note":"","ucode":"21E6001F29951B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576420,"discussion_content":"&#34;节点之间判断是否需要同步是根据local库里的元数据决定的&#34;,看起来和Redis 主从全量、增量同步很像，是比较主从之间的复制进度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655534746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155650,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1574732633,"is_pvip":false,"replies":[{"id":59913,"content":"通过增加节点，并且每个节点同时提供服务来提高并发访问能力。\n\n单个查询的性能不受影响（不会变快）。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574811279,"ip_address":"","comment_id":155650,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"副本集提高读性能，是指提高并发访问的性能，还是指单个查询会变快？或者二者兼有之？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475819,"discussion_content":"通过增加节点，并且每个节点同时提供服务来提高并发访问能力。\n\n单个查询的性能不受影响（不会变快）。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574811279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":62523,"discussion_content":"好的，谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574849357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155432,"user_name":"dream","can_delete":false,"product_type":"c3","uid":1117793,"ip_address":"","ucode":"65B33D32FA8BE9","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","comment_is_top":false,"comment_ctime":1574688930,"is_pvip":false,"replies":[{"id":59918,"content":"主从复制是由从节点的线程发起的。通过监听主节点的oplog表的变化，并把oplog的entries pull到从节点进行回放。\n\noplog变化通知的方式类似于你在linux 下执行一个tail -f 命令，一旦你tail的文件（oplog）有变化，马上就会打印出来。或者在java里是类似于observable pattern。 ","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574812672,"ip_address":"","comment_id":155432,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"请问 mongodb 的复制线程是主节点上的线程还是从节点上的线程？复制是主节点通知从节点还是从节点定时拉去呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475752,"discussion_content":"主从复制是由从节点的线程发起的。通过监听主节点的oplog表的变化，并把oplog的entries pull到从节点进行回放。\n\noplog变化通知的方式类似于你在linux 下执行一个tail -f 命令，一旦你tail的文件（oplog）有变化，马上就会打印出来。或者在java里是类似于observable pattern。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574812672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1117793,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","nickname":"dream","note":"","ucode":"65B33D32FA8BE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":132408,"discussion_content":"从 java 里面的观察者模式来理解，\n是不是主节点维护一个列表，这个列表里面的元素就是从节点，加入或者移除从节点就是操作这个列表。\n当主节点发生变化，主节点就通过这个列表的从节点告知从节点它(主节点发生了变化)，然后各个从主节点就拉取主节点oplog表的变化改变从节点的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578905588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153557,"user_name":"尘封","can_delete":false,"product_type":"c3","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1574258060,"is_pvip":false,"replies":[{"id":59030,"content":"如果是因为同步滞后，超过oplog window大小，或者是数据库损坏，或者是刚加入主库，都需要执行initial syn的操作，这个就会清空本地库再同步。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574296825,"ip_address":"","comment_id":153557,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"Mongodb2.4主从架构，从库复制从主库复制数据时会清空本地所有数据库吗？然后再同步？包括admin库","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475208,"discussion_content":"如果是因为同步滞后，超过oplog window大小，或者是数据库损坏，或者是刚加入主库，都需要执行initial syn的操作，这个就会清空本地库再同步。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574296825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201656,"user_name":"早早凡","can_delete":false,"product_type":"c3","uid":1161584,"ip_address":"","ucode":"4AA7CAB2CAF20D","user_header":"https://static001.geekbang.org/account/avatar/00/11/b9/70/c454312c.jpg","comment_is_top":false,"comment_ctime":1585817221,"is_pvip":false,"replies":[{"id":75801,"content":"这个功能提了几年了，但是还没支持。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586080890,"ip_address":"","comment_id":201656,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"复制集只能同步所有数据库吗？能只同步选择的数据库吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490391,"discussion_content":"这个功能提了几年了，但是还没支持。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586080890,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196029,"user_name":"早早凡","can_delete":false,"product_type":"c3","uid":1161584,"ip_address":"","ucode":"4AA7CAB2CAF20D","user_header":"https://static001.geekbang.org/account/avatar/00/11/b9/70/c454312c.jpg","comment_is_top":false,"comment_ctime":1585231711,"is_pvip":false,"replies":[{"id":74387,"content":"复制集的设计原理是基于3个节点是完全等同的基础上（因为会主从切换）。当然，对于某些指定的非主节点（第4个以上，priority为0)， 技术上实现库级&#47;选择性同步是可以的的，只不过这个优先级不高，没有在mongo产品路线图里实现而已。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1585265206,"ip_address":"","comment_id":196029,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"复制集能基于数据库粒度吗?  公司项目数据库服务实例有多个数据库,但是只想迁移部分数据库.   dump oplog选项也不支持数据库粒度, 但是阿里云DTS和tapData又能基于oplog做数据库粒度的毫秒级同步增量迁移,怎么做到的呢? ","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489212,"discussion_content":"复制集的设计原理是基于3个节点是完全等同的基础上（因为会主从切换）。当然，对于某些指定的非主节点（第4个以上，priority为0)， 技术上实现库级/选择性同步是可以的的，只不过这个优先级不高，没有在mongo产品路线图里实现而已。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585265206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185493,"user_name":"贵州 IT民工","can_delete":false,"product_type":"c3","uid":1110946,"ip_address":"","ucode":"7AED88C12FD672","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/a2/70ed46ae.jpg","comment_is_top":false,"comment_ctime":1583593109,"is_pvip":false,"replies":[{"id":72150,"content":"主挂掉了，但是节点的架构没有变，还是3个节点（2个好的，1个坏的）。符合大多数原则，可以选举主节点","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584003005,"ip_address":"","comment_id":185493,"utype":1}],"discussion_count":1,"race_medal":1,"score":3,"product_id":100040001,"comment_content":"老师，这点还是有点疑惑\n1主2从的复制集节点，当主挂掉了，怎么从2个从节点中选择新的主节点呢","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486378,"discussion_content":"主挂掉了，但是节点的架构没有变，还是3个节点（2个好的，1个坏的）。符合大多数原则，可以选举主节点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584003005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165608,"user_name":"张珮磊想静静","can_delete":false,"product_type":"c3","uid":1084732,"ip_address":"","ucode":"2E582ED7BB178E","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/3c/9025c2ca.jpg","comment_is_top":false,"comment_ctime":1577267488,"is_pvip":true,"replies":[{"id":66854,"content":"1. 你的理解是正确的。需要分片或者增加容量。\n2. 如果不是为别的考量，只是数据量，通常我见的比较多的是亿级以上的数据量，可以考虑mongodb\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579170489,"ip_address":"","comment_id":165608,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师您好，有两个问题请教下您：\n1.主从这种配置实现了高可用和高并发，一主二从的配置其实就是一份数据最终落到了三台机器，如果数据太多，导致磁盘不够用，增加从节点是没有用的对吧？是不是只能增加磁盘容量才可以\n2.对于mongo，究竟多大的数据量和并发量适合使用mongo，这个有什么评估标准吗","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479225,"discussion_content":"1. 你的理解是正确的。需要分片或者增加容量。\n2. 如果不是为别的考量，只是数据量，通常我见的比较多的是亿级以上的数据量，可以考虑mongodb\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579170489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157747,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1575254738,"is_pvip":false,"replies":[{"id":60787,"content":"你可以描述的详细点吗？如何不均匀？","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575470988,"ip_address":"","comment_id":157747,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"老师，MongoDB 4.2 集群分片不均匀，怎么办？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476518,"discussion_content":"你可以描述的详细点吗？如何不均匀？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575470988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154529,"user_name":"雷敏","can_delete":false,"product_type":"c3","uid":1434403,"ip_address":"","ucode":"732B945AEFF268","user_header":"","comment_is_top":false,"comment_ctime":1574474907,"is_pvip":false,"replies":[{"id":59379,"content":"1）投票节点的最早设计初衷：需要奇数节点满足一致性协议，但同时又想节省资源。为何不建议用？降低的可用性（丢一个数据节点后风险很高），无法使用更高的writeConcern（后续章节会讲）来保证在主从切换的时候保证不丢失数据\n\n2） 这种现象出现的可能性不大，你可以尝试下画下网络拓扑，具体到物理层链路。如果真的出现了，应该是可以继续工作的。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574517905,"ip_address":"","comment_id":154529,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"TJ老师：\n菜鸟 有2个疑问：\n1 投票节点疑问：\n投票节点为什么不建议用？我看有的书上，如果是偶数的时候，又增加一个投票节点，这样就变成奇数了，比如3个数据节点，2个投票节点。mongo为什么要设计投票节点？\n\n2 集群部署问题：\n1 从节点之间出现心跳不通，但是都和主节点是通的，这个会出现问题么？是不是网络结构部署有问题？\n","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475498,"discussion_content":"1）投票节点的最早设计初衷：需要奇数节点满足一致性协议，但同时又想节省资源。为何不建议用？降低的可用性（丢一个数据节点后风险很高），无法使用更高的writeConcern（后续章节会讲）来保证在主从切换的时候保证不丢失数据\n\n2） 这种现象出现的可能性不大，你可以尝试下画下网络拓扑，具体到物理层链路。如果真的出现了，应该是可以继续工作的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574517905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153911,"user_name":"蓝魔丶","can_delete":false,"product_type":"c3","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1574329521,"is_pvip":false,"replies":[{"id":59391,"content":"可以 - 剩下两个满足大多数（2）就可以正常完成选举并工作。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574520163,"ip_address":"","comment_id":153911,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"选举这块，如果有三个节点，leader节点挂了，剩余的两个节点能对外提供服务吗？能完成选举不？\n","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475319,"discussion_content":"可以 - 剩下两个满足大多数（2）就可以正常完成选举并工作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574520163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1219438,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","nickname":"蓝魔丶","note":"","ucode":"2AE4359E263558","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58428,"discussion_content":"按理论总感觉不行，剩余的两个节点都投了自己一票，感觉不能过半数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574675123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153698,"user_name":"尘封","can_delete":false,"product_type":"c3","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1574297930,"is_pvip":false,"replies":[{"id":67864,"content":"抱歉回复完了，这个确实和我的期待不一样。你确认C是在同步A的数据吗？","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580281927,"ip_address":"","comment_id":153698,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"多谢TJ答复，不过经过多次测试发现一个问题\n假如A是master,B是slave，复制架构如下所示，里面有个库是db23，库里的集合有tb1 tb2 tb3\nA(master) ----&gt; B(slave)\n现在新加入一个slave C，但是C在加入之前已经存在db23这个库，里面有一个集合tb1\n当C从A复制后发现，db23并没有被删掉db23重新同步，而是保留了C之前的db23这个库，里面只有tb1集合，其它tb2 tb3并没有同步过来。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475248,"discussion_content":"抱歉回复完了，这个确实和我的期待不一样。你确认C是在同步A的数据吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580281927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159196,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","nickname":"旺旺","note":"","ucode":"FE2CF90F446BFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87237,"discussion_content":"不会吧，会这样吧，不是会把slave上数据库给删掉的吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576654274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153424,"user_name":"乘坐Tornado的线程魔法师","can_delete":false,"product_type":"c3","uid":1132661,"ip_address":"","ucode":"C4C9915866E769","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","comment_is_top":false,"comment_ctime":1574234293,"is_pvip":false,"replies":[{"id":59399,"content":"选举节点必须是奇数，过半数（4）才可以工作和选举","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1574521824,"ip_address":"","comment_id":153424,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"TJ你好！请问下有关选举过程：对于保证大多数选举节点存活这一个条件。举例有7个选举节点，是不是意味着必须有4个节点以上存活才可以进行选举？如果有4个节点存活，但是存活节点是偶数个，是否可以完成RAFT算法完成选举。还是说选举节点必须是奇数个？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475161,"discussion_content":"选举节点必须是奇数，过半数（4）才可以工作和选举","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574521824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153566,"user_name":"趁早","can_delete":false,"product_type":"c3","uid":1031970,"ip_address":"","ucode":"949FB3AA250D80","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg","comment_is_top":false,"comment_ctime":1574259496,"is_pvip":false,"replies":null,"discussion_count":4,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"为什么最多只有7个节点能拥有投票权","like_count":5,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":56886,"discussion_content":"\n具有投票权的节点互相之间必须两两进行通讯，随着节点数量增加，两两通讯的复杂度呈指数级别增长，并且在真正需要投票的时候，越多的节点参与越不容易达成一致。  \n7个节点是通常情况下足够使用，同时又不会造成过大复杂度的最佳经验值。","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1574521700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304541,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e7/dd/e68f9cf5.jpg","nickname":"易翔","note":"","ucode":"8C63DB7379186C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136666,"discussion_content":"为什么TCP握手是三次。为了性能与可靠性的权衡。。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1579156239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1512599,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/88nXicqmkJWm3IXVfPfGQSk8SKIBVKjuC4qhzaCkf5Ud88uvKgS4Vf5AzCJ1uaFO0gpPnxdh4CowfhpxV1kSbXw/132","nickname":"lixin","note":"","ucode":"94D99DAFB6C929","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620164,"discussion_content":"如果选取节点过多，按着raft的选主机制。在正常情况下拥有选主的从节点是存在大量的心跳包。过多的选主节点是个很大的消耗。至于为什么是7个，这个有什么实验和经验来说明不太清楚.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685888207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1142526,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6e/fe/79955244.jpg","nickname":"公众号：程序员大兵","note":"","ucode":"AD0D05864C6913","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55084,"discussion_content":"同问，为什么最多只有7个节点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574338260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331645,"user_name":"piboye","can_delete":false,"product_type":"c3","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1642684103,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"复制集 是 强一致的吗？  是raft 那种复制方式吗？","like_count":1},{"had_liked":false,"id":375710,"user_name":"lixin","can_delete":false,"product_type":"c3","uid":1512599,"ip_address":"广东","ucode":"94D99DAFB6C929","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/88nXicqmkJWm3IXVfPfGQSk8SKIBVKjuC4qhzaCkf5Ud88uvKgS4Vf5AzCJ1uaFO0gpPnxdh4CowfhpxV1kSbXw/132","comment_is_top":false,"comment_ctime":1685889060,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"对于一个复制集，是否可以配置多个master. 每个master分配多个丛节点做数据备份？","like_count":0},{"had_liked":false,"id":375706,"user_name":"lixin","can_delete":false,"product_type":"c3","uid":1512599,"ip_address":"广东","ucode":"94D99DAFB6C929","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/88nXicqmkJWm3IXVfPfGQSk8SKIBVKjuC4qhzaCkf5Ud88uvKgS4Vf5AzCJ1uaFO0gpPnxdh4CowfhpxV1kSbXw/132","comment_is_top":false,"comment_ctime":1685885505,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"那数据一致性如何？","like_count":0},{"had_liked":false,"id":348905,"user_name":"大展宏兔","can_delete":false,"product_type":"c3","uid":1165671,"ip_address":"","ucode":"21E6001F29951B","user_header":"https://static001.geekbang.org/account/avatar/00/11/c9/67/7d446501.jpg","comment_is_top":false,"comment_ctime":1655534099,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"选主条件 和Redis Sentinel 选主可以说一模一样了(网络联通情况、从库复制进度repl_offset, 从库id优先级)","like_count":0},{"had_liked":false,"id":342774,"user_name":"Geek_66968d","can_delete":false,"product_type":"c3","uid":2873455,"ip_address":"","ucode":"A5E85EE9E54EC8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVpGfkkH8rqDSv2zqAKkLSSwXnIPmC96xSVS8Mq1BUrjLAk97NlhOvqUicWzJILlqDpaNCiaGtw0Yw/132","comment_is_top":false,"comment_ctime":1650455750,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100040001,"comment_content":"老师您好，想问一下，两个区域之间，数据同步的一个效率有数据吗？比如两个区域间隔多少距离，多少数据，复制过去需要的一个时间","like_count":0},{"had_liked":false,"id":329173,"user_name":"朱雯","can_delete":false,"product_type":"c3","uid":1035744,"ip_address":"","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1641194955,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100040001,"comment_content":"老师好，最近在某个实际的生产环境中发现，mongo的数据库中有一个从节点的数据比主节点多出一些，左思右想想不出啥原因，按照这些理论，实际上不太可能会发生阿。","like_count":0},{"had_liked":false,"id":183351,"user_name":"亮亮","can_delete":false,"product_type":"c3","uid":1229397,"ip_address":"","ucode":"6A99D378CCA894","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/w1FCduEibtUaib0dhRpUkqDL4xqkqc4ADibiaZzKwsA6dLNiaociatH9zpJcQ08HUQRbBpwt9iaQySbYEsk6ZOqwE8hzg/132","comment_is_top":false,"comment_ctime":1583027122,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100040001,"comment_content":"老师，你好！如果说复制集因为服务器修改IP或者其他原因导致没有选举成功，所有节点都编程了从节点，这时候怎么尽快恢复复制集，对外提供服务？","like_count":0},{"had_liked":false,"id":153593,"user_name":"Aaron niu","can_delete":false,"product_type":"c3","uid":1315335,"ip_address":"","ucode":"8CB10D7494DDAC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epujZ0vpjYD4KiaCI400YdfFenDotavczNpxzQ1AZdEichAhdEXWOyoGIksnG5meRibRTwTEibdmcPo1Q/132","comment_is_top":false,"comment_ctime":1574264174,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100040001,"comment_content":"增加节点之后增加延迟","like_count":0}]}