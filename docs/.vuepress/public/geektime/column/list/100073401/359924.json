{"id":359924,"title":"12 | å¹¿æ’­å˜é‡ï¼ˆä¸€ï¼‰ï¼šå…‹åˆ¶Shuffleï¼Œå¦‚ä½•ä¸€æ‹›åˆ¶èƒœï¼","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨æ•°æ®åˆ†æé¢†åŸŸï¼Œæ•°æ®å…³è”ï¼ˆJoinsï¼‰æ˜¯Shuffleæ“ä½œçš„é«˜å‘åŒºï¼ŒäºŒè€…å¦‚å½±éšä»ã€‚å¯ä»¥è¯´ï¼Œæœ‰Joinsçš„åœ°æ–¹ï¼Œå°±æœ‰Shuffleã€‚</p><p>æˆ‘ä»¬è¯´è¿‡ï¼Œé¢å¯¹Shuffleï¼Œå¼€å‘è€…åº”å½“â€œèƒ½çœåˆ™çœã€èƒ½æ‹–åˆ™æ‹–â€ã€‚æˆ‘ä»¬å·²ç»è®²è¿‡äº†æ€ä¹ˆæ‹–ï¼Œæ‹–æŒ‡çš„å°±æ˜¯ï¼ŒæŠŠåº”ç”¨ä¸­ä¼šå¼•å…¥Shuffleçš„æ“ä½œå°½å¯èƒ½åœ°å¾€åé¢çš„è®¡ç®—æ­¥éª¤å»æ‹–ã€‚é‚£å…·ä½“è¯¥æ€ä¹ˆçœå‘¢ï¼Ÿ</p><p>åœ¨æ•°æ®å…³è”åœºæ™¯ä¸­ï¼Œå¹¿æ’­å˜é‡å°±å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°çœå»Shuffleã€‚æ‰€ä»¥ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±å…ˆè¯´ä¸€è¯´å¹¿æ’­å˜é‡çš„å«ä¹‰å’Œä½œç”¨ï¼Œå†è¯´ä¸€è¯´å®ƒæ˜¯å¦‚ä½•å¸®åŠ©å¼€å‘è€…çœå»Shuffleæ“ä½œçš„ã€‚</p><h2>å¦‚ä½•ç†è§£å¹¿æ’­å˜é‡ï¼Ÿ</h2><p>æ¥ä¸‹æ¥ï¼Œå’±ä»¬å€ŸåŠ©ä¸€ä¸ªå°ä¾‹å­ï¼Œæ¥è®²ä¸€è®²å¹¿æ’­å˜é‡çš„å«ä¹‰ä¸ä½œç”¨ã€‚è¿™ä¸ªä¾‹å­å’ŒWord Countæœ‰å…³ï¼Œå®ƒå¯ä»¥è¯´æ˜¯åˆ†å¸ƒå¼ç¼–ç¨‹é‡Œçš„Hello worldäº†ï¼ŒWord Countå°±æ˜¯ç”¨æ¥ç»Ÿè®¡æ–‡ä»¶ä¸­å…¨éƒ¨å•è¯çš„ï¼Œä½ è‚¯å®šå·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¾‹å­ä¸­çš„éœ€æ±‚å¢åŠ äº†ä¸€ç‚¹éš¾åº¦ï¼Œæˆ‘ä»¬è¦å¯¹æŒ‡å®šåˆ—è¡¨ä¸­ç»™å®šçš„å•è¯è®¡æ•°ã€‚</p><pre><code>val dict = List(â€œsparkâ€, â€œtuneâ€)\nval words = spark.sparkContext.textFile(â€œ~/words.csvâ€)\nval keywords = words.filter(word =&gt; dict.contains(word))\nkeywords.map((_, 1)).reduceByKey(_ + _).collect\n</code></pre><p>æŒ‰ç…§è¿™ä¸ªéœ€æ±‚ï¼ŒåŒå­¦å°Aå®ç°äº†å¦‚ä¸Šçš„ä»£ç ï¼Œä¸€å…±æœ‰4è¡Œï¼Œæˆ‘ä»¬é€ä¸€æ¥çœ‹ã€‚ç¬¬1è¡Œåœ¨Driverç«¯ç»™å®šå¾…æŸ¥å•è¯åˆ—è¡¨dictï¼›ç¬¬2è¡Œä»¥textFile APIè¯»å–åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œå†…å®¹åŒ…å«ä¸€åˆ—ï¼Œå­˜å‚¨çš„æ˜¯å¸¸è§çš„å•è¯ï¼›ç¬¬3è¡Œç”¨åˆ—è¡¨dictä¸­çš„å•è¯è¿‡æ»¤åˆ†å¸ƒå¼æ–‡ä»¶å†…å®¹ï¼Œåªä¿ç•™dictä¸­ç»™å®šçš„å•è¯ï¼›ç¬¬4è¡Œè°ƒç”¨reduceByKeyå¯¹å•è¯è¿›è¡Œç´¯åŠ è®¡æ•°ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/ba/39/ba45d47a910ccb92861b1fd153b36839.jpg?wh=3540*1482\" alt=\"\" title=\"æ•°æ®ç»“æ„dictéšç€Taskä¸€èµ·åˆ†å‘åˆ°Executors\"></p><p>å­¦ä¹ è¿‡è°ƒåº¦ç³»ç»Ÿä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œç¬¬ä¸€è¡Œä»£ç å®šä¹‰çš„dictåˆ—è¡¨è¿å¸¦åé¢çš„3è¡Œä»£ç ä¼šä¸€åŒæ‰“åŒ…åˆ°Taské‡Œé¢å»ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒTaskå°±åƒæ˜¯ä¸€æ¶æ¶å°é£æœºï¼Œæºå¸¦ç€è¿™äº›â€œè¡Œæâ€ï¼Œé£å¾€é›†ç¾¤ä¸­ä¸åŒçš„Executorsã€‚å¯¹äºè¿™äº›â€œè¡Œæâ€æ¥è¯´ï¼Œä»£ç çš„â€œè´Ÿé‡â€è¾ƒè½»ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œè€Œæ•°æ®çš„è´Ÿé‡å äº†å¤§å¤´ï¼Œæˆäº†æœ€ä¸»è¦çš„è´Ÿæ‹…ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œä¹Ÿè¿˜å¥½å§ï¼Œdictåˆ—è¡¨åˆä¸å¤§ï¼Œä¹Ÿæ²¡ä»€ä¹ˆè¦ç´§çš„â€ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å‡è®¾è¿™ä¸ªä¾‹å­ä¸­çš„å¹¶è¡Œåº¦æ˜¯10000ï¼Œé‚£ä¹ˆï¼ŒDriverç«¯éœ€è¦é€šè¿‡ç½‘ç»œåˆ†å‘æ€»å…±10000ä»½dictæ‹·è´ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé›†ç¾¤å†…æ‰€æœ‰çš„Executorséœ€è¦æ¶ˆè€—å¤§é‡å†…å­˜æ¥å­˜å‚¨è¿™10000ä»½çš„æ‹·è´ï¼Œå¯¹å®è´µçš„ç½‘ç»œå’Œå†…å­˜èµ„æºæ¥è¯´ï¼Œè¿™å·²ç»æ˜¯ä¸€ç¬”ä¸å°çš„æµªè´¹äº†ã€‚æ›´ä½•å†µï¼Œå¦‚æœæ¢åšä¸€ä¸ªæ›´å¤§çš„æ•°æ®ç»“æ„ï¼ŒTaskåˆ†å‘æ‰€å¼•å…¥çš„ç½‘ç»œä¸å†…å­˜å¼€é”€ä¼šæ›´å¯æ€•ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œç»Ÿè®¡è®¡æ•°çš„ä¸šåŠ¡é€»è¾‘è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œï¼ŒSparkå°±å·²ç»æ¶ˆè€—äº†å¤§é‡çš„ç½‘ç»œå’Œå­˜å‚¨èµ„æºï¼Œè¿™ç®€ç›´ä¸å¯ç†å–»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç¤ºä¾‹ä¸­çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œè·³å‡ºè¿™æ ·çš„çª˜å¢ƒã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ç€æ‰‹ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆæ¥æƒ³ä¸€æƒ³ï¼Œç°æœ‰çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬è¦è¾¾åˆ°çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚ç»“åˆåˆšåˆšçš„åˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ<strong>Word Countçš„æ ¸å¿ƒç—›ç‚¹åœ¨äºï¼Œæ•°æ®ç»“æ„çš„åˆ†å‘å’Œå­˜å‚¨å—åˆ¶äºå¹¶è¡Œï¼Œå¹¶ä¸”æ˜¯ä»¥Taskä¸ºç²’åº¦çš„ï¼Œå› æ­¤å¾€å¾€é¢‘æ¬¡è¿‡é«˜ã€‚ç—›ç‚¹æ˜ç¡®äº†ï¼Œè°ƒä¼˜çš„ç›®çš„ä¹Ÿå°±æ¸…æ™°äº†ï¼Œæˆ‘ä»¬éœ€è¦é™ä½æ•°æ®ç»“æ„åˆ†å‘çš„é¢‘æ¬¡</strong>ã€‚</p><p>è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯é™ä½å¹¶è¡Œåº¦ã€‚ä¸è¿‡ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå¹¶è¡Œåº¦ä¸€æ—¦è°ƒæ•´ï¼Œå…¶ä»–ä¸CPUã€å†…å­˜æœ‰å…³çš„é…ç½®é¡¹éƒ½è¦è·Ÿç€é€‚é…ï¼Œè¿™éš¾å…æŠŠè°ƒä¼˜å˜å¤æ‚äº†ã€‚å®é™…ä¸Šï¼Œè¦é™ä½æ•°æ®ç»“æ„çš„åˆ†å‘é¢‘æ¬¡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å¹¿æ’­å˜é‡ã€‚</p><p><strong>å¹¿æ’­å˜é‡æ˜¯ä¸€ç§åˆ†å‘æœºåˆ¶ï¼Œå®ƒä¸€æ¬¡æ€§å°è£…ç›®æ ‡æ•°æ®ç»“æ„ï¼Œä»¥Executorsä¸ºç²’åº¦å»åšæ•°æ®åˆ†å‘ã€‚</strong>æ¢å¥è¯è¯´ï¼Œåœ¨å¹¿æ’­å˜é‡çš„å·¥ä½œæœºåˆ¶ä¸‹ï¼Œæ•°æ®åˆ†å‘çš„é¢‘æ¬¡ç­‰åŒäºé›†ç¾¤ä¸­çš„Executorsä¸ªæ•°ã€‚é€šå¸¸æ¥è¯´ï¼Œé›†ç¾¤ä¸­çš„Executorsæ•°é‡éƒ½è¿œè¿œå°äºTaskæ•°é‡ï¼Œç›¸å·®ä¸¤åˆ°ä¸‰ä¸ªæ•°é‡çº§æ˜¯å¸¸æœ‰çš„äº‹ã€‚é‚£ä¹ˆï¼Œå¯¹äºç¬¬ä¸€ç‰ˆçš„Word Countå®ç°ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¹¿æ’­å˜é‡çš„è¯ï¼Œä¼šæœ‰å“ªäº›å˜åŒ–å‘¢ï¼Ÿ</p><p>ä»£ç çš„æ”¹åŠ¨å¾ˆç®€å•ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ”¹åŠ¨ï¼šç¬¬ä¸€ä¸ªæ”¹åŠ¨æ˜¯ç”¨broadcastå°è£…dictåˆ—è¡¨ï¼Œç¬¬äºŒä¸ªæ”¹åŠ¨æ˜¯åœ¨è®¿é—®dictåˆ—è¡¨çš„åœ°æ–¹æ”¹ç”¨broadcast.valueæ›¿ä»£ã€‚</p><pre><code>val dict = List(â€œsparkâ€, â€œtuneâ€)\nval bc = spark.sparkContext.broadcast(dict)\nval words = spark.sparkContext.textFile(â€œ~/words.csvâ€)\nval keywords = words.filter(word =&gt; bc.value.contains(word))\nkeywords.map((_, 1)).reduceByKey(_ + _).collect\n</code></pre><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¿™ä¸ªæ”¹åŠ¨çœ‹ä¸Šå»ä¹Ÿæ²¡ä»€ä¹ˆå‘€ï¼â€åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ï¼Œæ”¹åŠ¨ä¹‹åçš„ä»£ç åœ¨è¿è¡Œæ—¶éƒ½æœ‰å“ªäº›å˜åŒ–ã€‚</p><p><strong>åœ¨å¹¿æ’­å˜é‡çš„è¿è¡Œæœºåˆ¶ä¸‹ï¼Œå°è£…æˆå¹¿æ’­å˜é‡çš„æ•°æ®ï¼Œç”±Driverç«¯ä»¥Executorsä¸ºç²’åº¦åˆ†å‘ï¼Œæ¯ä¸€ä¸ªExecutorsæ¥æ”¶åˆ°å¹¿æ’­å˜é‡ä¹‹åï¼Œå°†å…¶äº¤ç»™BlockManagerç®¡ç†</strong>ã€‚ç”±äºå¹¿æ’­å˜é‡æºå¸¦çš„æ•°æ®å·²ç»é€šè¿‡ä¸“é—¨çš„é€”å¾„å­˜å‚¨åˆ°BlockManagerä¸­ï¼Œå› æ­¤åˆ†å‘åˆ°Executorsçš„Taskä¸éœ€è¦å†æºå¸¦åŒæ ·çš„æ•°æ®ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥æŠŠå¹¿æ’­å˜é‡æƒ³è±¡æˆä¸€æ¶æ¶ä¸“ç”¨è´§æœºï¼Œä¸“é—¨ä¸ºTaskè¿™äº›å°é£æœºè¿é€â€œå¤§ä»¶è¡Œæâ€ã€‚Driverä¸æ¯ä¸€ä¸ªExecutorsä¹‹é—´éƒ½å¼€é€šä¸€æ¡è¿™æ ·çš„ä¸“ç”¨è´§æœºèˆªçº¿ï¼Œç»Ÿä¸€è¿è½½è´Ÿé‡è¾ƒå¤§çš„â€œæ•°æ®è¡Œæâ€ã€‚æœ‰äº†ä¸“ç”¨è´§æœºæ¥å¸®å¿™ï¼ŒTaskå°é£æœºåªéœ€è¦æºå¸¦é‚£äº›è´Ÿé‡è¾ƒè½»çš„ä»£ç å°±å¥½äº†ã€‚ç­‰è¿™äº›Taskå°é£æœºåœ¨Executorsç€é™†ï¼Œå®ƒä»¬å°±å¯ä»¥åˆ°Executorsçš„å…¬ç”¨ä»“åº“BlockManageré‡Œå»æå–å®ƒä»¬çš„â€œå¤§ä»¶è¡Œæâ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/f7/2cfe084a106a01bf14a63466fa2146f7.jpg?wh=3729*1314\" alt=\"\" title=\"ç”¨å¹¿æ’­å˜é‡å°è£…dictåˆ—è¡¨\"></p><p>æ€»ä¹‹ï¼Œåœ¨å¹¿æ’­å˜é‡çš„æœºåˆ¶ä¸‹ï¼Œdictåˆ—è¡¨æ•°æ®éœ€è¦åˆ†å‘å’Œå­˜å‚¨çš„æ¬¡æ•°é”å‡ã€‚æˆ‘ä»¬å‡è®¾é›†ç¾¤ä¸­æœ‰20ä¸ªExecutorsï¼Œä¸è¿‡ä»»åŠ¡å¹¶è¡Œåº¦è¿˜æ˜¯10000ï¼Œé‚£ä¹ˆï¼ŒDriveréœ€è¦é€šè¿‡ç½‘ç»œåˆ†å‘çš„dictåˆ—è¡¨æ‹·è´å°±ä¼šç”±åŸæ¥çš„10000ä»½å‡å°‘åˆ°20ä»½ã€‚åŒç†ï¼Œé›†ç¾¤èŒƒå›´å†…æ‰€æœ‰Executorséœ€è¦å­˜å‚¨çš„dictæ‹·è´ï¼Œä¹Ÿç”±åŸæ¥çš„10000ä»½ï¼Œå‡å°‘è‡³20ä»½ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¼•å…¥å¹¿æ’­å˜é‡åçš„å¼€é”€åªæ˜¯åŸæ¥Taskåˆ†å‘çš„1/500ï¼</p><h2>å¹¿æ’­åˆ†å¸ƒå¼æ•°æ®é›†</h2><p>é‚£åœ¨åˆšåˆšçš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¹¿æ’­å˜é‡å°è£…çš„æ˜¯Driverç«¯åˆ›å»ºçš„æ™®é€šå˜é‡ï¼šå­—ç¬¦ä¸²åˆ—è¡¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>å¹¿æ’­å˜é‡ä¹Ÿå¯ä»¥å°è£…åˆ†å¸ƒå¼æ•°æ®é›†</strong>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚åœ¨ç”µå­å•†åŠ¡é¢†åŸŸä¸­ï¼Œå¼€å‘è€…å¾€å¾€ç”¨äº‹å®è¡¨æ¥å­˜å‚¨äº¤æ˜“ç±»æ•°æ®ï¼Œç”¨ç»´åº¦è¡¨æ¥å­˜å‚¨åƒç‰©å“ã€ç”¨æˆ·è¿™æ ·çš„æè¿°æ€§æ•°æ®ã€‚äº‹å®è¡¨çš„ç‰¹ç‚¹æ˜¯è§„æ¨¡åºå¤§ï¼Œæ•°æ®ä½“é‡éšç€ä¸šåŠ¡çš„å‘å±•ä¸æ–­åœ°å¿«é€Ÿå¢é•¿ã€‚ç»´åº¦è¡¨çš„è§„æ¨¡è¦æ¯”äº‹å®è¡¨å°å¾ˆå¤šï¼Œæ•°æ®ä½“é‡çš„å˜åŒ–ä¹Ÿç›¸å¯¹ç¨³å®šã€‚</p><p>å‡è®¾ç”¨æˆ·ç»´åº¦æ•°æ®ä»¥Parquetæ–‡ä»¶æ ¼å¼å­˜å‚¨åœ¨HDFSæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸šåŠ¡éƒ¨é—¨éœ€è¦æˆ‘ä»¬è¯»å–ç”¨æˆ·æ•°æ®å¹¶åˆ›å»ºå¹¿æ’­å˜é‡ä»¥å¤‡åç”¨ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå‡ è¡Œä»£ç å°±å¯ä»¥æå®šï¼</p><pre><code>val userFile: String = â€œhdfs://ip:port/rootDir/userDataâ€\nval df: DataFrame = spark.read.parquet(userFile)\nval bc_df: Broadcast[DataFrame] = spark.sparkContext.broadcast(df)\n</code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨Parquet APIè¯»å–HDFSåˆ†å¸ƒå¼æ•°æ®æ–‡ä»¶ç”ŸæˆDataFrameï¼Œç„¶åç”¨broadcastå°è£…DataFrameã€‚ä»ä»£ç ä¸Šæ¥çœ‹ï¼Œè¿™ç§å®ç°æ–¹å¼å’Œå°è£…æ™®é€šå˜é‡æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œå®ƒä»¬éƒ½è°ƒç”¨äº†broadcast APIï¼Œåªæ˜¯ä¼ å…¥çš„å‚æ•°ä¸åŒã€‚</p><p>ä½†å¦‚æœä¸ä»å¼€å‘çš„è§†è§’æ¥çœ‹ï¼Œè½¬è€Œå»è§‚å¯Ÿè¿è¡Œæ—¶å¹¿æ’­å˜é‡çš„åˆ›å»ºè¿‡ç¨‹çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†ä¸æ™®é€šå˜é‡ä¹‹é—´çš„å·®å¼‚éå¸¸æ˜¾è‘—ã€‚</p><p>ä»æ™®é€šå˜é‡åˆ›å»ºå¹¿æ’­å˜é‡ï¼Œç”±äºæ•°æ®æºå°±åœ¨Driverç«¯ï¼Œå› æ­¤ï¼Œåªéœ€è¦DriveræŠŠæ•°æ®åˆ†å‘åˆ°å„ä¸ªExecutorsï¼Œå†è®©ExecutorsæŠŠæ•°æ®ç¼“å­˜åˆ°BlockManagerå°±å¥½äº†ã€‚</p><p>ä½†æ˜¯ï¼Œä»åˆ†å¸ƒå¼æ•°æ®é›†åˆ›å»ºå¹¿æ’­å˜é‡å°±è¦å¤æ‚å¤šäº†ï¼Œå…·ä½“çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8a/6c/8ac91a174803b97966289ff51938106c.jpg?wh=3954*1614\" alt=\"\" title=\"ä»åˆ†å¸ƒå¼æ•°æ®é›†åˆ›å»ºå¹¿æ’­å˜é‡çš„è¿‡ç¨‹\"></p><p>ä¸æ™®é€šå˜é‡ç›¸æ¯”ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†çš„æ•°æ®æºä¸åœ¨Driverç«¯ï¼Œè€Œæ˜¯æ¥è‡ªæ‰€æœ‰çš„Executorsã€‚Executorsä¸­çš„æ¯ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è´Ÿè´£ç”Ÿäº§å…¨é‡æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ä¸åŒçš„æ•°æ®åˆ†åŒºã€‚å› æ­¤ï¼Œæ­¥éª¤1å°±æ˜¯<strong>Driverä»æ‰€æœ‰çš„Executorsæ‹‰å–è¿™äº›æ•°æ®åˆ†åŒºï¼Œç„¶ååœ¨æœ¬åœ°æ„å»ºå…¨é‡æ•°æ®ã€‚</strong>æ­¥éª¤2ä¸ä»æ™®é€šå˜é‡åˆ›å»ºå¹¿æ’­å˜é‡çš„è¿‡ç¨‹ç±»ä¼¼ã€‚  <strong>DriveræŠŠæ±‡æ€»å¥½çš„å…¨é‡æ•°æ®åˆ†å‘ç»™å„ä¸ªExecutorsï¼ŒExecutorså°†æ¥æ”¶åˆ°çš„å…¨é‡æ•°æ®ç¼“å­˜åˆ°å­˜å‚¨ç³»ç»Ÿçš„BlockManagerä¸­</strong>ã€‚</p><p>ä¸éš¾å‘ç°ï¼Œç›¸æ¯”ä»æ™®é€šå˜é‡åˆ›å»ºå¹¿æ’­å˜é‡ï¼Œä»åˆ†å¸ƒå¼æ•°æ®é›†åˆ›å»ºå¹¿æ’­å˜é‡çš„ç½‘ç»œå¼€é”€æ›´å¤§ã€‚åŸå› ä¸»è¦æœ‰äºŒï¼šä¸€æ˜¯ï¼Œå‰è€…æ¯”åè€…å¤šäº†ä¸€æ­¥ç½‘ç»œé€šä¿¡ï¼›äºŒæ˜¯ï¼Œå‰è€…çš„æ•°æ®ä½“é‡é€šå¸¸æ¯”åè€…å¤§å¾ˆå¤šã€‚</p><h2>å¦‚ä½•ç”¨å¹¿æ’­å˜é‡å…‹åˆ¶Shuffleï¼Ÿ</h2><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œDriverä»Executorsæ‹‰å–DataFrameçš„æ•°æ®åˆ†ç‰‡ï¼Œæ‰æˆä¸€ä»½å…¨é‡æ•°æ®ï¼Œç„¶åå†å¹¿æ’­å‡ºå»ï¼ŒæŠ›å¼€ç½‘ç»œå¼€é”€ä¸è¯´ï¼Œæ¥æ¥å›å›å¾—è´¹è¿™ä¹ˆå¤§åŠ²ï¼Œå›¾å•¥å‘¢ï¼Ÿâ€è¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œå› ä¸ºä»¥å¹¿æ’­å˜é‡çš„å½¢å¼ç¼“å­˜åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ­£æ˜¯å…‹åˆ¶Shuffleæ€æ‰‹é”ã€‚</p><h3>Shuffle Joins</h3><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘è¿˜æ˜¯æ‹¿ç”µå­å•†åŠ¡åœºæ™¯ä¸¾ä¾‹ã€‚æœ‰äº†ç”¨æˆ·çš„æ•°æ®ä¹‹åï¼Œä¸ºäº†åˆ†æä¸åŒç”¨æˆ·çš„è´­ç‰©ä¹ æƒ¯ï¼Œä¸šåŠ¡éƒ¨é—¨è¦æ±‚æˆ‘ä»¬å¯¹äº¤æ˜“è¡¨å’Œç”¨æˆ·è¡¨è¿›è¡Œæ•°æ®å…³è”ã€‚è¿™æ ·çš„æ•°æ®å…³è”éœ€æ±‚åœ¨æ•°æ®åˆ†æé¢†åŸŸè¿˜æ˜¯ç›¸å½“æ™®éçš„ã€‚</p><pre><code>val transactionsDF: DataFrame = _\nval userDF: DataFrame = _\ntransactionsDF.join(userDF, Seq(â€œuserIDâ€), â€œinnerâ€)\n</code></pre><p>å› ä¸ºéœ€æ±‚éå¸¸æ˜ç¡®ï¼ŒåŒå­¦å°Aç«‹å³è°ƒç”¨Parquetæ•°æ®æºAPIï¼Œè¯»å–åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œåˆ›å»ºäº¤æ˜“è¡¨å’Œç”¨æˆ·è¡¨çš„DataFrameï¼Œç„¶åè°ƒç”¨DataFrameçš„Joinæ–¹æ³•ï¼Œä»¥userIDä½œä¸ºJoin keysï¼Œç”¨å†…å…³è”ï¼ˆInner Joinï¼‰çš„æ–¹å¼å®Œæˆäº†ä¸¤è¡¨çš„æ•°æ®å…³è”ã€‚</p><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œäº¤æ˜“è¡¨å’Œç”¨æˆ·è¡¨æƒ³è¦ä»¥userIDä¸ºJoin keysè¿›è¡Œå…³è”ï¼Œå°±å¿…é¡»è¦ç¡®ä¿ä¸€ä¸ªå‰æï¼šäº¤æ˜“è®°å½•å’Œä¸ä¹‹å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯åœ¨åŒä¸€ä¸ªExecutorså†…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨æˆ·é»„å°ä¹™çš„è´­ç‰©ä¿¡æ¯éƒ½å­˜å‚¨åœ¨Executor 0ï¼Œè€Œä¸ªäººå±æ€§ä¿¡æ¯ç¼“å­˜åœ¨Executor 2ï¼Œé‚£ä¹ˆï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œè¿™ä¸¤ç§ä¿¡æ¯å¿…é¡»è¦å‡‘åˆ°åŒä¸€ä¸ªè¿›ç¨‹é‡Œæ‰èƒ½å®ç°å…³è”è®¡ç®—ã€‚</p><p>åœ¨ä¸è¿›è¡Œä»»ä½•è°ƒä¼˜çš„æƒ…å†µä¸‹ï¼ŒSparké»˜è®¤é‡‡ç”¨Shuffle Joinçš„æ–¹å¼æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚Shuffle Joinçš„è¿‡ç¨‹ä¸»è¦æœ‰ä¸¤æ­¥ã€‚</p><p><strong>ç¬¬ä¸€æ­¥å°±æ˜¯å¯¹å‚ä¸å…³è”çš„å·¦å³è¡¨åˆ†åˆ«è¿›è¡ŒShuffle</strong>ï¼ŒShuffleçš„åˆ†åŒºè§„åˆ™æ˜¯å…ˆå¯¹Join keysè®¡ç®—å“ˆå¸Œå€¼ï¼Œå†æŠŠå“ˆå¸Œå€¼å¯¹åˆ†åŒºæ•°å–æ¨¡ã€‚ç”±äºå·¦å³è¡¨çš„åˆ†åŒºæ•°æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤Shuffleè¿‡åï¼Œä¸€å®šèƒ½å¤Ÿä¿è¯userIDç›¸åŒçš„äº¤æ˜“è®°å½•å’Œç”¨æˆ·æ•°æ®åè½åœ¨åŒä¸€ä¸ªExecutorså†…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b1/28/b1b2a574eb7ef33e2315f547ecdc0328.jpg?wh=5124*1599\" alt=\"\" title=\"Shuffle Joinä¸­å·¦å³è¡¨çš„æ•°æ®åˆ†å‘\"></p><p>Shuffleå®Œæˆä¹‹åï¼Œ<strong>ç¬¬äºŒæ­¥å°±æ˜¯åœ¨åŒä¸€ä¸ªExecutorså†…ï¼ŒReduce taskå°±å¯ä»¥å¯¹userIDä¸€è‡´çš„è®°å½•è¿›è¡Œå…³è”æ“ä½œ</strong>ã€‚ä½†æ˜¯ï¼Œç”±äºäº¤æ˜“è¡¨æ˜¯äº‹å®è¡¨ï¼Œæ•°æ®ä½“é‡å¼‚å¸¸åºå¤§ï¼Œå¯¹TBçº§åˆ«çš„æ•°æ®è¿›è¡ŒShuffleï¼Œæƒ³æƒ³éƒ½è§‰å¾—å¯æ€•ï¼å› æ­¤ï¼Œä¸Šé¢å¯¹ä¸¤ä¸ªDataFrameç›´æ¥å…³è”çš„ä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤§çš„è°ƒä¼˜ç©ºé—´ã€‚æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¯å¥è¯è¯´ï¼Œå¯¹äºåˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„æ•°æ®å…³è”æ¥è¯´ï¼Œè¦æƒ³ç¡®ä¿äº¤æ˜“è®°å½•å’Œä¸ä¹‹å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯åœ¨åŒä¸€ä¸ªExecutorsä¸­ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰å…¶ä»–åŠæ³•å‘¢ï¼Ÿ</p><h3>å…‹åˆ¶Shuffleçš„æ–¹å¼</h3><p>è¿˜è®°å¾—ä¹‹å‰ä¸šåŠ¡éƒ¨é—¨è¦æ±‚æˆ‘ä»¬æŠŠç”¨æˆ·è¡¨å°è£…ä¸ºå¹¿æ’­å˜é‡ï¼Œä»¥å¤‡åç”¨å—ï¼Ÿç°åœ¨å®ƒç»ˆäºæ´¾ä¸Šç”¨åœºäº†ï¼</p><pre><code>import org.apache.spark.sql.functions.broadcast\n \nval transactionsDF: DataFrame = _\nval userDF: DataFrame = _\n \nval bcUserDF = broadcast(userDF)\ntransactionsDF.join(bcUserDF, Seq(â€œuserIDâ€), â€œinnerâ€)\n\n</code></pre><p>Driverä»æ‰€æœ‰Executorsæ”¶é›†userDFæ‰€å±çš„æ‰€æœ‰æ•°æ®åˆ†ç‰‡ï¼Œåœ¨æœ¬åœ°æ±‡æ€»ç”¨æˆ·æ•°æ®ï¼Œç„¶åç»™æ¯ä¸€ä¸ªExecutorséƒ½å‘é€ä¸€ä»½å…¨é‡æ•°æ®çš„æ‹·è´ã€‚æ—¢ç„¶æ¯ä¸ªExecutorséƒ½æœ‰userDFçš„<strong>å…¨é‡æ•°æ®</strong>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œäº¤æ˜“è¡¨çš„æ•°æ®åˆ†åŒºå¾…åœ¨åŸåœ°ã€ä¿æŒä¸åŠ¨ï¼Œå°±å¯ä»¥è½»æ¾åœ°å…³è”åˆ°ä¸€è‡´çš„ç”¨æˆ·æ•°æ®ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹æ•°æ®ä½“é‡å·¨å¤§çš„äº¤æ˜“è¡¨è¿›è¡ŒShuffleï¼ŒåŒæ ·å¯ä»¥åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå®Œæˆä¸¤å¼ è¡¨çš„æ•°æ®å…³è”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/2a/b3c5ab392c2303bf7923488623b4022a.jpg?wh=5094*1695\" alt=\"\" title=\"Broadcast Joinå°†å°è¡¨å¹¿æ’­ï¼Œé¿å…å¤§è¡¨Shuffle\n\"></p><p>åˆ©ç”¨å¹¿æ’­å˜é‡ï¼Œæˆ‘ä»¬æˆåŠŸåœ°é¿å…äº†æµ·é‡æ•°æ®åœ¨é›†ç¾¤å†…çš„å­˜å‚¨ã€åˆ†å‘ï¼ŒèŠ‚çœäº†åŸæœ¬ç”±Shuffleå¼•å…¥çš„ç£ç›˜å’Œç½‘ç»œå¼€é”€ï¼Œå¤§å¹…æå‡è¿è¡Œæ—¶æ‰§è¡Œæ€§èƒ½ã€‚å½“ç„¶ï¼Œé‡‡ç”¨å¹¿æ’­å˜é‡ä¼˜åŒ–ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ï¼Œæ¯•ç«Ÿå¹¿æ’­å˜é‡çš„åˆ›å»ºå’Œåˆ†å‘ï¼Œä¹Ÿæ˜¯ä¼šå¸¦æ¥ç½‘ç»œå¼€é”€çš„ã€‚ä½†æ˜¯ï¼Œç›¸æ¯”å¤§è¡¨çš„å…¨ç½‘åˆ†å‘ï¼Œå°è¡¨çš„ç½‘ç»œå¼€é”€å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™ç§å°æŠ•å…¥ã€å¤§äº§å‡ºï¼Œç”¨æå°çš„æˆæœ¬å»åšå–é«˜é¢çš„æ€§èƒ½æ”¶ç›Šï¼ŒçœŸå¯ä»¥è¯´æ˜¯â€œå››ä¸¤æ‹¨åƒæ–¤â€ï¼</p><h2>å°ç»“</h2><p>åœ¨æ•°æ®å…³è”åœºæ™¯ä¸­ï¼Œå¹¿æ’­å˜é‡æ˜¯å…‹åˆ¶Shuffleçš„æ€æ‰‹é”ã€‚æŒæ¡äº†å®ƒï¼Œæˆ‘ä»¬å°±èƒ½ä»¥æå°çš„æˆæœ¬ï¼Œè·å¾—é«˜é¢çš„æ€§èƒ½æ”¶ç›Šã€‚å…³é”®æ˜¯æˆ‘ä»¬è¦æŒæ¡ä¸¤ç§åˆ›å»ºå¹¿æ’­å˜é‡çš„æ–¹å¼ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œä»æ™®é€šå˜é‡åˆ›å»ºå¹¿æ’­å˜é‡ã€‚åœ¨å¹¿æ’­å˜é‡çš„è¿è¡Œæœºåˆ¶ä¸‹ï¼Œæ™®é€šå˜é‡å­˜å‚¨çš„æ•°æ®å°è£…æˆå¹¿æ’­å˜é‡ï¼Œç”±Driverç«¯ä»¥Executorsä¸ºç²’åº¦è¿›è¡Œåˆ†å‘ï¼Œæ¯ä¸€ä¸ªExecutorsæ¥æ”¶åˆ°å¹¿æ’­å˜é‡ä¹‹åï¼Œå°†å…¶äº¤ç”±BlockManagerç®¡ç†ã€‚</p><p>ç¬¬äºŒç§ï¼Œä»åˆ†å¸ƒå¼æ•°æ®é›†åˆ›å»ºå¹¿æ’­å˜é‡ï¼Œè¿™å°±è¦æ¯”ç¬¬ä¸€ç§æ–¹å¼å¤æ‚ä¸€äº›äº†ã€‚ç¬¬ä¸€æ­¥ï¼ŒDriveréœ€è¦ä»æ‰€æœ‰çš„Executorsæ‹‰å–æ•°æ®åˆ†ç‰‡ï¼Œç„¶ååœ¨æœ¬åœ°æ„å»ºå…¨é‡æ•°æ®ï¼›ç¬¬äºŒæ­¥ï¼ŒDriveræŠŠæ±‡æ€»å¥½çš„å…¨é‡æ•°æ®åˆ†å‘ç»™å„ä¸ªExecutorsï¼ŒExecutorså†å°†æ¥æ”¶åˆ°çš„å…¨é‡æ•°æ®ç¼“å­˜åˆ°å­˜å‚¨ç³»ç»Ÿçš„BlockManagerä¸­ã€‚</p><p>ç»“åˆè¿™ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨åšæ•°æ®å…³è”çš„æ—¶å€™ï¼ŒæŠŠShuffle Joinsè½¬æ¢ä¸ºBroadcast Joinsï¼Œå°±å¯ä»¥ç”¨å°è¡¨å¹¿æ’­æ¥ä»£æ›¿å¤§è¡¨çš„å…¨ç½‘åˆ†å‘ï¼ŒçœŸæ­£åšåˆ°å…‹åˆ¶Shuffleã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>Sparkå¹¿æ’­æœºåˆ¶ç°æœ‰çš„å®ç°æ–¹å¼æ˜¯å­˜åœ¨éšæ‚£çš„ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒDriverå¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆï¼Œä½ èƒ½æƒ³åˆ°æ›´å¥½çš„æ–¹å¼æ¥é‡æ–°å®ç°Sparkçš„å¹¿æ’­æœºåˆ¶å—ï¼Ÿï¼ˆæç¤ºï¼š<a href=\"https://issues.apache.org/jira/browse/SPARK-17556\">SPARK-17556</a>ï¼‰</li>\n<li>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä¸é€‚åˆæŠŠShuffle Joinsè½¬æ¢ä¸ºBroadcast Joinsï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","neighbors":{"left":{"article_title":"11 | ä¸ºä»€ä¹ˆè¯´Shuffleæ˜¯ä¸€æ—¶æ— ä¸¤çš„æ€§èƒ½æ€æ‰‹ï¼Ÿ","id":359907},"right":{"article_title":"13 | å¹¿æ’­å˜é‡ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•è®©Spark SQLé€‰æ‹©Broadcast Joinsï¼Ÿ","id":360837}},"comments":[{"had_liked":false,"id":287404,"user_name":"Bennan","can_delete":false,"product_type":"c1","uid":2427818,"ip_address":"","ucode":"8B6EE3DCBB1356","user_header":"https://static001.geekbang.org/account/avatar/00/25/0b/aa/09c1215f.jpg","comment_is_top":false,"comment_ctime":1617932642,"is_pvip":false,"replies":[{"id":"104398","content":"Perfectï¼æ»¡åˆ†ğŸ’¯ï¼Œä¸¤é“é¢˜ç­”çš„éƒ½å¾ˆå¥½ï½","user_name":"ä½œè€…å›å¤","comment_id":287404,"uid":"1043100","ip_address":"","utype":1,"ctime":1617955091,"user_name_real":"å´ç£Š"}],"discussion_count":4,"race_medal":0,"score":"83222311266","product_id":100073401,"comment_content":"1. æ”¹æˆç”±driverè·å–åˆ°æ•°æ®åˆ†å¸ƒï¼Œç„¶åé€šçŸ¥å„ä¸ªexecutorä¹‹é—´è¿›è¡Œæ‹‰å–ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨å¤šä¸ªexecutorç½‘ç»œï¼Œé¿å…åªæœ‰driverç»„è£…ä»¥åå†ä¸€ä¸ªä¸€ä¸ªå‘é€æ•ˆç‡è¿‡ä½<br><br>2.å½“ä¸¤ä¸ªéœ€è¦joinçš„æ•°æ®é›†éƒ½å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨broadcast joinéœ€è¦å°†ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†è¿›è¡Œç½‘ç»œåˆ†å‘å¤šæ¬¡ï¼Œå·²ç»è¿œè¶…å‡ºäº†shuffle joinéœ€è¦ä¼ è¾“çš„æ•°æ®","like_count":20,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518294,"discussion_content":"Perfectï¼æ»¡åˆ†ğŸ’¯ï¼Œä¸¤é“é¢˜ç­”çš„éƒ½å¾ˆå¥½ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617955091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2635387,"avatar":"https://static001.geekbang.org/account/avatar/00/28/36/7b/b06aad84.jpg","nickname":"ç©º","note":"","ucode":"01F63669AE814A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378921,"discussion_content":"è¯·é—®ç¬¬ä¸€ç§è¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623510820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2855459,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/icJzoUc02ECdBbFgGzVIwYfpRgL3TXuRRE5GsDqZFmAlAAm1KUQS1rHewgj5FB4TChovo3YaceicEZE2MgZJ1ftw/132","nickname":"Geek_eb29a4","note":"","ucode":"CF88D4ED5F4A25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537966,"discussion_content":"è¯·é—®ç¬¬ä¸€ç§è¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639281940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2273076,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo1QZQ0eoOqvOyMyAzcsyEK8bQaZTd9aJHTTCYicicUm9gmhUFaxQe6IBc3caLVD8PhqtmhhicrNHe0w/132","nickname":"Severus4","note":"","ucode":"79BC6487B595EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2855459,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/icJzoUc02ECdBbFgGzVIwYfpRgL3TXuRRE5GsDqZFmAlAAm1KUQS1rHewgj5FB4TChovo3YaceicEZE2MgZJ1ftw/132","nickname":"Geek_eb29a4","note":"","ucode":"CF88D4ED5F4A25","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556851,"discussion_content":"æ²¡å®ç°æˆåŠŸï¼Œå¤šä¸ªexecutoräº’ç›¸å¹¿æ’­çš„è¯ç½‘ç»œä¹‹ç±»çš„å¼€é”€ååˆ†å·¨å¤§ï¼Œall-to-allçš„æ—¶å€™ä¸ä¸€å®šåƒå¾—æ¶ˆï¼Œæ¯•ç«Ÿexecutorçš„é…ç½®ä¸€èˆ¬éƒ½ä¼šæ¯”driverå·®ç‚¹ï¼ŒåŸä½œè€…æäº¤äº†å¾ˆå¤šæ¬¡éƒ½æ²¡è¿‡ï¼Œåé¢è§‰å¾—æš‚æ—¶ä¹Ÿæ²¡è¿«åˆ‡çš„éœ€æ±‚è¦å®ç°executor broadcastï¼Œå°±ç»™å…³é—­äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647537129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537966,"ip_address":""},"score":556851,"extra":""}]}]},{"had_liked":false,"id":292464,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1620830703,"is_pvip":false,"replies":[{"id":"105936","content":"ä½ æ˜¯å¯¹çš„ï¼Œç¡®å®ä¼šæŠ¥é”™ã€‚è¿™é‡Œæˆ‘æ²¡æœ‰äº¤ä»£æ¸…æ¥šï¼ŒRDDç¡®å®ä¸èƒ½ç›´æ¥ç”¨å¹¿æ’­å˜é‡å°è£…ï¼Œå®ƒä¸åƒDataFrameï¼ŒDataFrameå¹¿æ’­çš„é‚£éƒ¨åˆ†æºç åœ¨å†…éƒ¨æŠŠcollectè¿™ä¸ªäº‹åšäº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ç”¨å¹¿æ’­å°è£…DataFrameï¼Œä½†æ˜¯RDDæ²¡æœ‰ï¼Œç¡®å®éœ€è¦å…ˆæ‰‹åŠ¨collect RDDæ•°æ®é›†ï¼Œç„¶åå†åœ¨driverç«¯ç”¨å¹¿æ’­å˜é‡å°è£…ï¼Œæˆ‘çš„é”…ï¼Œæ²¡æœ‰äº¤ä»£æ¸…æ¥š~<br><br>ä¸è¿‡ï¼Œæ­ªæ‰“æ­£ç€ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£Driveråœ¨æ„å»ºå¹¿æ’­å˜é‡æ—¶çš„è®¡ç®—è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ­¥éƒ½æ˜¯æŠŠæ•°æ®é›†collectåˆ°Driverç«¯ï¼Œä¸ç®¡æ˜¯RDDã€DataFrameã€Datasetï¼ŒåŒºåˆ«æ— éæ˜¯collectè¿™ä»¶äº‹æ˜¯è°åšçš„ã€‚RDDæ˜¯å¼€å‘è€…æ¥åšï¼Œè€ŒDataFrameã€Datasetæ˜¯Sparkè‡ªå·±â€œå·å·â€åšäº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":292464,"uid":"1043100","ip_address":"","utype":1,"ctime":1620899739,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"66045340143","product_id":100073401,"comment_content":"ç£Šå“¥ï¼Œä¸ºä»€ä¹ˆæˆ‘æµ‹è¯•äº†å¹¿æ’­rddä¸è¡Œï¼š<br>æˆ‘å†™äº†ä¸ªdemoï¼Œå¹¿æ’­rddæ˜¯æŠ¥é”™çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š<br>    val userFile: String =&quot;spark-basic&#47;File&#47;csv_data.csv&quot;<br>    val df: DataFrame = spark.read.csv(userFile)<br>    val rdd = spark.sparkContext.textFile(&quot;userFile&quot;)<br>    val bc_df: Broadcast[RDD[String]] = spark.sparkContext.broadcast(rdd)<br>    bc_df.value.collect().foreach(println)<br><br>æŠ¥é”™å¦‚ä¸‹ï¼šException in thread &quot;main&quot; java.lang.IllegalArgumentException: requirement failed: Can not directly broadcast RDDs; instead, call collect() and broadcast the result.<br><br>ç„¶åçœ‹äº†ä¸€ä¸‹æºç ï¼šSparkContextä¸­çš„broadcastæ–¹æ³•ï¼š<br><br>def broadcast[T: ClassTag](value: T): Broadcast[T] = {<br>    assertNotStopped()<br>    require(!classOf[RDD[_]].isAssignableFrom(classTag[T].runtimeClass),<br>      &quot;Can not directly broadcast RDDs; instead, call collect() and broadcast the result.&quot;)<br>    val bc = env.broadcastManager.newBroadcast[T](value, isLocal)<br>    val callSite = getCallSite<br>    logInfo(&quot;Created broadcast &quot; + bc.id + &quot; from &quot; + callSite.shortForm)<br>    cleaner.foreach(_.registerBroadcastForCleanup(bc))<br>    bc<br>  }<br><br>ç¬¬4è¡Œçš„ä»£ç æ˜¾ç¤ºçš„Can not directly broadcast RDDs<br>æ˜¯ä¸æ˜¯æˆ‘å“ªé‡Œä¸å¤ªå¯¹ï¼Ÿ","like_count":16,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519840,"discussion_content":"ä½ æ˜¯å¯¹çš„ï¼Œç¡®å®ä¼šæŠ¥é”™ã€‚è¿™é‡Œæˆ‘æ²¡æœ‰äº¤ä»£æ¸…æ¥šï¼ŒRDDç¡®å®ä¸èƒ½ç›´æ¥ç”¨å¹¿æ’­å˜é‡å°è£…ï¼Œå®ƒä¸åƒDataFrameï¼ŒDataFrameå¹¿æ’­çš„é‚£éƒ¨åˆ†æºç åœ¨å†…éƒ¨æŠŠcollectè¿™ä¸ªäº‹åšäº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ç”¨å¹¿æ’­å°è£…DataFrameï¼Œä½†æ˜¯RDDæ²¡æœ‰ï¼Œç¡®å®éœ€è¦å…ˆæ‰‹åŠ¨collect RDDæ•°æ®é›†ï¼Œç„¶åå†åœ¨driverç«¯ç”¨å¹¿æ’­å˜é‡å°è£…ï¼Œæˆ‘çš„é”…ï¼Œæ²¡æœ‰äº¤ä»£æ¸…æ¥š~\n\nä¸è¿‡ï¼Œæ­ªæ‰“æ­£ç€ï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£Driveråœ¨æ„å»ºå¹¿æ’­å˜é‡æ—¶çš„è®¡ç®—è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ­¥éƒ½æ˜¯æŠŠæ•°æ®é›†collectåˆ°Driverç«¯ï¼Œä¸ç®¡æ˜¯RDDã€DataFrameã€Datasetï¼ŒåŒºåˆ«æ— éæ˜¯collectè¿™ä»¶äº‹æ˜¯è°åšçš„ã€‚RDDæ˜¯å¼€å‘è€…æ¥åšï¼Œè€ŒDataFrameã€Datasetæ˜¯Sparkè‡ªå·±â€œå·å·â€åšäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620899739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476427,"avatar":"https://static001.geekbang.org/account/avatar/00/16/87/4b/16ea3997.jpg","nickname":"tiankonghewo","note":"","ucode":"7A55A9C17DD9DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532342,"discussion_content":"å¤§èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637582041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287506,"user_name":"Jack","can_delete":false,"product_type":"c1","uid":1297112,"ip_address":"","ucode":"F3863DAEF449D5","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/d8/b109ed85.jpg","comment_is_top":false,"comment_ctime":1617981402,"is_pvip":true,"replies":[{"id":"104431","content":"éå¸¸èµå“ˆğŸ‘å“ˆï½ å‡¡æ˜¯çœ‹æºç çš„åŒå­¦ï¼Œéƒ½å…ˆç»™ä¸ªèµï½<br><br>è¿™å—éå¸¸å€¼å¾—æ¢è®¨ã€‚æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œä»£ç å±‚é¢ï¼Œsparkç¡®å®å·²ç»æœ‰codeåœ¨å°è¯•ç”¨p2pçš„æ–¹å¼æ¥åˆ†å‘å¹¿æ’­å˜é‡ï¼Œä»è€Œå‡è½»driverè´Ÿæ‹…ã€‚<br><br>ä½†æ˜¯ï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œè¿™éƒ¨åˆ†ä»£ç å°šæœªç”Ÿæ•ˆã€‚ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™ä¸ªticketï¼šã€Executor side broadcast for broadcast joinsã€‘https:&#47;&#47;issues.apache.org&#47;jira&#47;browse&#47;SPARK-17556ï¼Œçœ‹ä¸Šå»è¿˜æ˜¯è¿›è¡Œä¸­çš„çŠ¶æ€ã€‚<br><br>å¦å¤–ï¼Œä»ä»£ç çœ‹ï¼Œç›®å‰è¿˜æ˜¯å…ˆç”¨collectæ‹‰åˆ°driverï¼Œç„¶åå†åˆ†å‘å‡ºå»ï¼š<br><br>BroadcastExchangeExecä¸­çš„relationFutureç”¨äºè·å–å¹¿æ’­å˜é‡å†…å®¹<br>åœ¨relationFutureå†…éƒ¨ï¼š<br>  1. å…ˆæ˜¯è°ƒç”¨executeCollectIteratorç”Ÿæˆå†…å®¹relationï¼›<br>     å…¶ä¸­ï¼ŒexecuteCollectIteratorè°ƒç”¨collectæŠŠç»“æœé›†æ”¶é›†åˆ°driverç«¯<br>  2. ç„¶åç”¨sparkContext.broadcast(relation)ï¼ŒæŠŠç”Ÿæˆå¥½çš„å†…å®¹å¹¿æ’­åˆ°å„ä¸ªExecutors<br>å¹¶æ²¡æœ‰çœ‹åˆ°å“ªé‡Œä»Executorsæ‹‰å–æ•°æ®åˆ†ç‰‡ã€æ¥å‡è½»driverè´Ÿè½½ã€‚<br><br>å¹¶ä¸”ï¼Œè¿™é‡Œè¿˜æœ‰æç¤ºdriverå†…å­˜ä¸å¤Ÿçš„exceptionï¼š<br>new OutOfMemoryError(&quot;Not enough memory to build and broadcast the table to all &quot; + &quot;worker nodes. As a workaround, you can either disable broadcast by setting &quot; + s&quot;${SQLConf.AUTO_BROADCASTJOIN_THRESHOLD.key} to -1 or increase the spark &quot; + s&quot;driver memory by setting ${SparkLauncher.DRIVER_MEMORY} to a higher value.&quot;).initCause(oe.getCause))<br><br>ä½ è´´çš„è¿™æ®µä»£ç ç¡®å®åœ¨å°è¯•ç”¨ç‰‡2ç‰‡ï¼Œä¸è¿‡ï¼Œéœ€è¦ä»”ç»†çœ‹çœ‹ï¼Œå®ƒåœ¨å“ªé‡Œè°ƒç”¨ï¼Œè¢«è°è°ƒç”¨ï½","user_name":"ä½œè€…å›å¤","comment_id":287506,"uid":"1043100","ip_address":"","utype":1,"ctime":1618055686,"user_name_real":"å´ç£Š"}],"discussion_count":8,"race_medal":0,"score":"23092817882","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå¯¹äºç¬¬1é¢˜ï¼Œçœ‹äº†ä¸‹sparkçš„æºç ï¼Œç›®å‰Broadcaståªæœ‰ä¸€ä¸ªå®ç°ç±»TorrentBroadcastï¼Œçœ‹ä»£ç çš„æ³¨é‡Šï¼Œè¿™ä¸ªç±»é€šè¿‡ä½¿ç”¨ç±»ä¼¼Bit-torrentåè®®çš„æ–¹æ³•è§£å†³äº†Driveræˆä¸ºç“¶é¢ˆçš„é—®é¢˜ã€‚ç›®å‰Sparkè¿˜ä¼šå­˜åœ¨å¹¿æ’­å˜é‡çš„æ•°æ®å¤ªå¤§é€ æˆDriveræˆä¸ºç“¶é¢ˆçš„é—®é¢˜å—ï¼Ÿ<br><br>&#47;**<br> * A BitTorrent-like implementation of [[org.apache.spark.broadcast.Broadcast]].<br> *<br> * The mechanism is as follows:<br> *<br> * The driver divides the serialized object into small chunks and<br> * stores those chunks in the BlockManager of the driver.<br> *<br> * On each executor, the executor first attempts to fetch the object from its BlockManager. If<br> * it does not exist, it then uses remote fetches to fetch the small chunks from the driver and&#47;or<br> * other executors if available. Once it gets the chunks, it puts the chunks in its own<br> * BlockManager, ready for other executors to fetch from.<br> *<br> * This prevents the driver from being the bottleneck in sending out multiple copies of the<br> * broadcast data (one per executor).<br> *<br> * When initialized, TorrentBroadcast objects read SparkEnv.get.conf.<br> *<br> * @param obj object to broadcast<br> * @param id A unique identifier for the broadcast variable.<br> *&#47;<br>private[spark] class TorrentBroadcast[T: ClassTag](obj: T, id: Long)<br>  extends Broadcast[T](id) with Logging with Serializable {<br>","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518328,"discussion_content":"éå¸¸èµå“ˆğŸ‘å“ˆï½ å‡¡æ˜¯çœ‹æºç çš„åŒå­¦ï¼Œéƒ½å…ˆç»™ä¸ªèµï½\n\nè¿™å—éå¸¸å€¼å¾—æ¢è®¨ã€‚æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œä»£ç å±‚é¢ï¼Œsparkç¡®å®å·²ç»æœ‰codeåœ¨å°è¯•ç”¨p2pçš„æ–¹å¼æ¥åˆ†å‘å¹¿æ’­å˜é‡ï¼Œä»è€Œå‡è½»driverè´Ÿæ‹…ã€‚\n\nä½†æ˜¯ï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œè¿™éƒ¨åˆ†ä»£ç å°šæœªç”Ÿæ•ˆã€‚ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™ä¸ªticketï¼šã€Executor side broadcast for broadcast joinsã€‘https://issues.apache.org/jira/browse/SPARK-17556ï¼Œçœ‹ä¸Šå»è¿˜æ˜¯è¿›è¡Œä¸­çš„çŠ¶æ€ã€‚\n\nå¦å¤–ï¼Œä»ä»£ç çœ‹ï¼Œç›®å‰è¿˜æ˜¯å…ˆç”¨collectæ‹‰åˆ°driverï¼Œç„¶åå†åˆ†å‘å‡ºå»ï¼š\n\nBroadcastExchangeExecä¸­çš„relationFutureç”¨äºè·å–å¹¿æ’­å˜é‡å†…å®¹\nåœ¨relationFutureå†…éƒ¨ï¼š\n  1. å…ˆæ˜¯è°ƒç”¨executeCollectIteratorç”Ÿæˆå†…å®¹relationï¼›\n     å…¶ä¸­ï¼ŒexecuteCollectIteratorè°ƒç”¨collectæŠŠç»“æœé›†æ”¶é›†åˆ°driverç«¯\n  2. ç„¶åç”¨sparkContext.broadcast(relation)ï¼ŒæŠŠç”Ÿæˆå¥½çš„å†…å®¹å¹¿æ’­åˆ°å„ä¸ªExecutors\nå¹¶æ²¡æœ‰çœ‹åˆ°å“ªé‡Œä»Executorsæ‹‰å–æ•°æ®åˆ†ç‰‡ã€æ¥å‡è½»driverè´Ÿè½½ã€‚\n\nå¹¶ä¸”ï¼Œè¿™é‡Œè¿˜æœ‰æç¤ºdriverå†…å­˜ä¸å¤Ÿçš„exceptionï¼š\nnew OutOfMemoryError(&amp;quot;Not enough memory to build and broadcast the table to all &amp;quot; + &amp;quot;worker nodes. As a workaround, you can either disable broadcast by setting &amp;quot; + s&amp;quot;${SQLConf.AUTO_BROADCASTJOIN_THRESHOLD.key} to -1 or increase the spark &amp;quot; + s&amp;quot;driver memory by setting ${SparkLauncher.DRIVER_MEMORY} to a higher value.&amp;quot;).initCause(oe.getCause))\n\nä½ è´´çš„è¿™æ®µä»£ç ç¡®å®åœ¨å°è¯•ç”¨ç‰‡2ç‰‡ï¼Œä¸è¿‡ï¼Œéœ€è¦ä»”ç»†çœ‹çœ‹ï¼Œå®ƒåœ¨å“ªé‡Œè°ƒç”¨ï¼Œè¢«è°è°ƒç”¨ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618055686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181606,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/a6/662bcc6b.jpg","nickname":"æ¥ä¸–æ„¿åšå‹äºº A","note":"","ucode":"EF20966B0F27E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366422,"discussion_content":"é¢ï¼Œçœ‹èµ·æ¥è€å¸ˆå’Œå±‚ä¸»å¥½åƒä¸åœ¨ä¸€ä¸ªé¢‘é“ä¸Šï¼Œå±‚ä¸»çš„ BitTorrent æ˜¯ executor ä» driver fetch å¹¿æ’­æ•°æ®çš„é˜¶æ®µï¼Œä½¿ç”¨ p2p çš„æ–¹å¼ã€‚è€Œè€å¸ˆè¯´çš„æ˜¯ executor äº§ç”Ÿéœ€è¦å¹¿æ’­çš„æ•°æ®è¢« driver ç«¯æ”¶é›†çš„é˜¶æ®µï¼Œè¿™æ—¶å€™åº”è¯¥ä¸æ˜¯ p2pã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618057173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1112182,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/76/3db69173.jpg","nickname":"onepieceJT2018","note":"","ucode":"C8C214C3D5D285","race_medal":3,"user_type":1,"is_pvip":true},"reply_author":{"id":1181606,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/a6/662bcc6b.jpg","nickname":"æ¥ä¸–æ„¿åšå‹äºº A","note":"","ucode":"EF20966B0F27E1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373592,"discussion_content":"å±‚ä¸»åˆ†äº«çš„è¿™ä¸ªç±»å°±æ˜¯broadcastç°åœ¨çš„æ‹‰å–çš„æ–¹å¼ è€å¸ˆåˆ†äº«çš„è¿™ä¸ªjiraæ˜¯è¯´å»ä¸­å¿ƒåŒ– ä¸ç”±driverå»ç®¡ç†æ‹‰å– è€Œæ˜¯executorä¹‹é—´è‡ªå·±æ‹‰å–ç¼ºå¤±çš„éƒ¨åˆ†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620794023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":366422,"ip_address":""},"score":373592,"extra":""},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1112182,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/76/3db69173.jpg","nickname":"onepieceJT2018","note":"","ucode":"C8C214C3D5D285","race_medal":3,"user_type":1,"is_pvip":true},"discussion":{"id":373605,"discussion_content":"æ˜¯çš„ï¼Œå¤§å®¶è¯´çš„éƒ½å¯¹ï¼Œè¿™é‡Œæˆ‘åŸæ–‡æ²¡æœ‰è¯´æ¸…æ¥šï¼Œæ˜¯æˆ‘çš„é”…å“ˆã€‚è¿™é‡Œå…¶å®åˆ†ä¸¤ä¸ªæ­¥éª¤ï¼š\n1. ç¬¬ä¸€ä¸ªæ˜¯Driverä»æ‰€æœ‰Executorsæ”¶é›†æ•°æ®ï¼Œæ„å»ºå¹¿æ’­å˜é‡ï¼Œä¹Ÿå°±æ˜¯å…¨é‡æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹Driveræ˜¯ç“¶é¢ˆï¼›\n2. ç¬¬äºŒä¸ªæ˜¯å„ä¸ªExecutorså†å»æ‹‰å–å¹¿æ’­å˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒä½ ä»¬è¯´çš„ï¼Œç°åœ¨åªæœ‰TorrentBroadcastè¿™ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒExecutorsä¹‹é—´ç”¨ç±»ä¼¼â€œP2Pâ€çš„æ–¹å¼å»æ‹‰å–å¹¿æ’­å˜é‡çš„æ¯ä¸€ä¸ªblockã€‚ä¼˜å…ˆä»æœ¬æœºçš„å…¶ä»–Executorsæ‹‰å–ã€å…¶æ¬¡æœ¬Rackçš„å…¶ä»–æœºå™¨å»æ‹‰å–ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä»»åŠ¡æœ¬åœ°æ€§ï¼Œæ€»ä¹‹å¯¹äºtarget blockï¼Œç»™å®šblockåœ°å€åˆ—è¡¨ï¼ŒBlockManagerä¼šä¼˜å…ˆé€‰å–æ‹‰å–æˆæœ¬æœ€ä½çš„é‚£ä¸ªå»å°è¯•ã€‚ä¹‹æ‰€æœ‰è¯´æ˜¯ç±»ä¼¼â€œP2Pâ€ï¼ŒåŸå› åœ¨äºå®ƒæ‹‰å–çš„å½¢å¼æ˜¯P2Pï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆP2Påè®®ï¼Œè€Œæ˜¯åˆ©ç”¨BlockManageræ¥å®ç°å®šå‘æ‹‰å–ã€‚BlockManagerä»BlockManagerMasterè·å–ç›®æ ‡blockåœ°å€åˆ—è¡¨ï¼Œç„¶åæŒ‰ç…§åˆšåˆšè¯´çš„é¡ºåºï¼Œä¾æ¬¡å°è¯•æ‹‰å–Blockã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620797510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373592,"ip_address":""},"score":373605,"extra":""},{"author":{"id":2485585,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","nickname":"Geek_d794f8","note":"","ucode":"1E20DA4FF8B800","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":373741,"discussion_content":"é‚£å°±æ˜¯è¯´TorrentBroadcastè¿™ä¸ªå®ç°ç±»ä¸‹çš„ä»£ç ç›®å‰æ˜¯ç”Ÿæ•ˆçš„å¯¹å§ã€‚å¦‚æœæ˜¯ç”±driverä¾æ¬¡å‘é€ç»™å„ä¸ªexecutorï¼Œè€Œæ˜¯å„ä¸ªexecutorä¹‹é—´æ‹‰å–ï¼Œé‚£ä¹ˆdriveræ„å»ºå…¨é‡æ•°æ®çš„æ„ä¹‰æ˜¯ä»€ä¹ˆ?","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1620863136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373605,"ip_address":""},"score":373741,"extra":""}]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366415,"discussion_content":"p2pï¼Œä¸æ˜¯ç‰‡2ç‰‡ï¼Œæ‰‹æœºä¸Šæ‰“å­—ï¼Œå®¹æ˜“å‡ºé”™ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618056631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297057,"user_name":"å†¯æ°","can_delete":false,"product_type":"c1","uid":1950765,"ip_address":"","ucode":"61C92D62D49A66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/qmdZbyxrRD5qQLKjWkmdp3PCVhwmWTcp0cs04s39pic2RcNw0nNKTDgKqedSQ54bAGWjAVSc9p4vWP8RJRKB6nA/132","comment_is_top":false,"comment_ctime":1623293288,"is_pvip":false,"replies":[{"id":"107957","content":"å…ˆæ¥è¯´ç¬¬ä¸€ä¸ªé—®é¢˜~<br><br>aï¼‰ä½ è¯´çš„æ²¡é”™ï¼ŒæŒ‰ç†è¯´ï¼Œåº”è¯¥èµ°å¹¿æ’­ï¼Œæ¯•ç«Ÿå¹¿æ’­é˜ˆå€¼é»˜è®¤10MBï¼Œä½ çš„æ•°æ®é›†è¶³å¤Ÿå°ï¼Œç£ç›˜ä¸Š1MBï¼Œå†…å­˜é‡Œ4MBï¼Œæ€ä¹ˆçœ‹éƒ½æ¯”å¹¿æ’­é˜ˆå€¼å°ã€‚æˆ‘èƒ½æƒ³åˆ°çš„å¯èƒ½çš„åŸå› ï¼Œå°±æ˜¯Spark SQLå¯¹äºæ•°æ®é›†å¤§å°çš„è¯¯åˆ¤ï¼Œå°±æ˜¯å®ƒå¯¹äºDIMçš„é¢„ä¼°å¤§äº10MBã€‚ä½ ä¸å¦¨ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œè®¡ç®—ä¸€ä¸‹DIMåœ¨Spark SQLä¸‹çš„é¢„åˆ¤å¤§å°ï¼š<br><br>val df: DataFrame = _<br>df.cache.count<br> <br>val plan = df.queryExecution.logical<br>val estimated: BigInt = spark<br>.sessionState<br>.executePlan(plan)<br>.optimizedPlan<br>.stats<br>.sizeInBytes<br><br>çœ‹çœ‹èƒ½ä¸èƒ½å‘ç°ä»€ä¹ˆç«¯å€ªã€‚è™½ç„¶å’±ä»¬ä¸èƒ½å®Œå…¨ç¡®è®¤åŸå› ï¼Œä¸è¿‡è¦è§£å†³è¿™ä¸ªé—®é¢˜å€’æ˜¯è›®ç®€å•çš„ã€‚ä¸€æ¥å¯ä»¥ç”¨broadcastå‡½æ•°ï¼ŒäºŒæ¥å¯ä»¥ç”¨join hintsï¼Œæ€»ä¹‹å°±æ˜¯å„ç§èŠ±å¼å¼ºåˆ¶å¹¿æ’­ã€‚<br><br>bï¼‰è¿™é‡Œå°±éœ€è¦æ›´å¤šä¿¡æ¯æ¥åˆ¤æ–­äº†ï¼Œ6Gæ˜¯ä»å“ªé‡Œå¾—åˆ°çš„ï¼ŸSpark UIçš„DAGå›¾å—ï¼Ÿsorté˜¶æ®µçš„6Gï¼Œä»…ä»…æ˜¯DIMè¡¨çš„å¤§å°ï¼Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼ŒæŠŠå®Œæ•´çš„DAGè´´ç»™æˆ‘~","user_name":"ä½œè€…å›å¤","comment_id":297057,"uid":"1043100","ip_address":"","utype":1,"ctime":1623396857,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"14508195176","product_id":100073401,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…³äºbroacast joinï¼Œé‡åˆ°äº†ä¸€ä¸ªç‰¹åˆ«çš„é—®é¢˜è¯·æ•™ä¸€ä¸‹ã€‚<br>1ã€Fact(è®¢å•) å’Œ DIM(é—¨åº—) å…³è”ã€‚  å…¶ä¸­é—¨åº—è¡¨é‡çº§ä¸º 3w(æ¡æ•°) * 10ä¸ª(å­—æ®µ)ï¼Œé‡‡ç”¨Parquetå­˜å‚¨åœ¨Hiveä¸Šï¼Œå¤§å°1Må·¦å³ã€‚<br>2ã€è¿è¡Œå‚æ•°ï¼Œå¹¶è¡Œåº¦ = 200ï¼ŒExecutor = 50ï¼ŒCPUæ ¸æ•° = 2ï¼Œå†…å­˜&#47;Executor = 6Gï¼ŒDrvierå†…å­˜=2Gã€‚ PSï¼šæ²¡æœ‰ç‰¹åˆ«é…ç½®Broadcast ç›¸å…³å‚æ•°<br>3ã€æ‰§è¡Œæ—¶ï¼Œæœ‰ä¸¤ä¸ªç–‘é—®ç‚¹ï¼Œä¸å¾—å…¶è§£<br>    aï¼‰Spark UI æ˜¾ç¤ºï¼Œå¹¶æ²¡æœ‰æ‰§è¡ŒBHJï¼Œåè€Œæ‰§è¡Œäº† hash sort merge joinã€‚   ç…§ç†ï¼Œå¦‚æ­¤å°çš„æ•°æ®ï¼Œåº”è¯¥èµ°å‰è€…<br>    bï¼‰Spark UI æ˜¾ç¤ºï¼Œèµ°hash sort merge joinåï¼Œshuffleé˜¶æ®µçš„å†…å­˜è®¡ç®—å¤§å°ä¸º4MBï¼Œsorté˜¶æ®µçš„å†…å­˜è®¡ç®—å¤§å°ä¸º6Gã€‚    ä¸ºä½•sortå®Œåï¼Œä¸ºè†¨èƒ€çš„å¦‚æ­¤å‰å®³ã€‚<br><br>","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521701,"discussion_content":"å…ˆæ¥è¯´ç¬¬ä¸€ä¸ªé—®é¢˜~\n\naï¼‰ä½ è¯´çš„æ²¡é”™ï¼ŒæŒ‰ç†è¯´ï¼Œåº”è¯¥èµ°å¹¿æ’­ï¼Œæ¯•ç«Ÿå¹¿æ’­é˜ˆå€¼é»˜è®¤10MBï¼Œä½ çš„æ•°æ®é›†è¶³å¤Ÿå°ï¼Œç£ç›˜ä¸Š1MBï¼Œå†…å­˜é‡Œ4MBï¼Œæ€ä¹ˆçœ‹éƒ½æ¯”å¹¿æ’­é˜ˆå€¼å°ã€‚æˆ‘èƒ½æƒ³åˆ°çš„å¯èƒ½çš„åŸå› ï¼Œå°±æ˜¯Spark SQLå¯¹äºæ•°æ®é›†å¤§å°çš„è¯¯åˆ¤ï¼Œå°±æ˜¯å®ƒå¯¹äºDIMçš„é¢„ä¼°å¤§äº10MBã€‚ä½ ä¸å¦¨ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œè®¡ç®—ä¸€ä¸‹DIMåœ¨Spark SQLä¸‹çš„é¢„åˆ¤å¤§å°ï¼š\n\nval df: DataFrame = _\ndf.cache.count\n \nval plan = df.queryExecution.logical\nval estimated: BigInt = spark\n.sessionState\n.executePlan(plan)\n.optimizedPlan\n.stats\n.sizeInBytes\n\nçœ‹çœ‹èƒ½ä¸èƒ½å‘ç°ä»€ä¹ˆç«¯å€ªã€‚è™½ç„¶å’±ä»¬ä¸èƒ½å®Œå…¨ç¡®è®¤åŸå› ï¼Œä¸è¿‡è¦è§£å†³è¿™ä¸ªé—®é¢˜å€’æ˜¯è›®ç®€å•çš„ã€‚ä¸€æ¥å¯ä»¥ç”¨broadcastå‡½æ•°ï¼ŒäºŒæ¥å¯ä»¥ç”¨join hintsï¼Œæ€»ä¹‹å°±æ˜¯å„ç§èŠ±å¼å¼ºåˆ¶å¹¿æ’­ã€‚\n\nbï¼‰è¿™é‡Œå°±éœ€è¦æ›´å¤šä¿¡æ¯æ¥åˆ¤æ–­äº†ï¼Œ6Gæ˜¯ä»å“ªé‡Œå¾—åˆ°çš„ï¼ŸSpark UIçš„DAGå›¾å—ï¼Ÿsorté˜¶æ®µçš„6Gï¼Œä»…ä»…æ˜¯DIMè¡¨çš„å¤§å°ï¼Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€ï¼ŒæŠŠå®Œæ•´çš„DAGè´´ç»™æˆ‘~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623396857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287605,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1618046452,"is_pvip":false,"replies":[{"id":"104547","content":"æ€è€ƒçš„å¾ˆæ·±å…¥ï¼ŒğŸ‘èµä¸€ä¸ª~<br><br>1. æˆ‘ç†è§£ï¼Œä½ é—®çš„æ˜¯è¿™å¥å§ï¼Ÿâ€œç”±äºå·¦å³è¡¨çš„åˆ†åŒºæ•°æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤ Shuffle è¿‡åï¼Œä¸€å®šèƒ½å¤Ÿä¿è¯ userID ç›¸åŒçš„äº¤æ˜“è®°å½•å’Œç”¨æˆ·æ•°æ®åè½åœ¨åŒä¸€ä¸ª Executors å†…ã€‚â€ HadoopRDDçš„åˆ†åŒºæ•°ã€æˆ–è€…è¯´å¹¶è¡Œåº¦ï¼Œç¡®å®æ˜¯ç”±HDFSæ–‡ä»¶ç³»ç»Ÿå†³å®šçš„ï¼›ä½†æ˜¯ï¼ŒShuffleè¿‡åï¼Œæ¯ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†çš„å¹¶è¡Œåº¦ï¼Œå°±ç”±å‚æ•°spark.sql.shuffle.partitionsæ¥å†³å®šäº†ï¼Œè¿™ä¸ªå’±ä»¬åœ¨é…ç½®é¡¹å“ªä¸€è®²è¯´è¿‡å“Ÿ~ å› æ­¤ï¼Œå¦‚æœä½ æ²¡æœ‰æ‰‹å·¥ç”¨repartitionæˆ–æ˜¯Coalesceå»è°ƒæ•´å¹¶è¡Œåº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å®¶Shuffleè¿‡åï¼ˆåœ¨Reduceé˜¶æ®µï¼‰éƒ½æ˜¯è¿™ä¸ªå¹¶è¡Œåº¦ã€‚<br><br>2. é»˜è®¤ç¡®å®æ˜¯å¼€å¯çš„ï¼Œé»˜è®¤å€¼ç¡®å®ä¹Ÿæ˜¯10MBï¼Œä½†æ˜¯ï¼Œè¿™ä¸ª10MBå¤ªå¤ªå¤ªå¤ªå¤ªå¤ªï¼ˆå¤ª x Nï¼‰å°äº†ï¼å¾ˆå¤šå°è¡¨å…¶å®éƒ½è¶…è¿‡äº†è¿™ä¸ªé˜ˆå€¼ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æ‡’å¾—å»è°ƒæ•´è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥ç›´æ¥ç”¨broadcast(userDF)è¿™ç§å¼ºåˆ¶å¹¿æ’­çš„æ–¹å¼ï¼Œçœæ—¶çœåŠ›ï¼Œæ¯”è¾ƒæ–¹ä¾¿~","user_name":"ä½œè€…å›å¤","comment_id":287605,"uid":"1043100","ip_address":"","utype":1,"ctime":1618220469,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"10207981044","product_id":100073401,"comment_content":"è€å¸ˆæœ‰ä¸¤ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼š<br>1.æ–‡ä¸­æåˆ°ä¸¤ä¸ªè¡¨joinï¼Œä¸¤ä¸ªè¡¨æ•°æ®é‡ç›¸å·®å¾ˆå¤§å‘€ï¼Œä¸ºä»€ä¹ˆä»–ä»¬çš„çš„åˆ†åŒºæ•°æ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸”åˆ†åŒºæ•°ä¸æ˜¯æ ¹æ®hadoopçš„åˆ‡ç‰‡è§„åˆ™å»åˆ’åˆ†çš„å—ï¼Ÿ<br>2.å¹¿æ’­joinä¸æ˜¯é»˜è®¤å¼€å¯çš„å—ï¼Œå¥½åƒå°è¡¨é»˜è®¤10Mï¼›è¿˜éœ€åƒæ–‡ä¸­ä»£ç val bcUserDF = broadcast(userDF)è¿™æ ·å£°æ˜å—ï¼Ÿ<br>å¸Œæœ›å¾—åˆ°æ‚¨çš„æŒ‡å¯¼ï¼Œå¤šè°¢ï¼","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518364,"discussion_content":"æ€è€ƒçš„å¾ˆæ·±å…¥ï¼ŒğŸ‘èµä¸€ä¸ª~\n\n1. æˆ‘ç†è§£ï¼Œä½ é—®çš„æ˜¯è¿™å¥å§ï¼Ÿâ€œç”±äºå·¦å³è¡¨çš„åˆ†åŒºæ•°æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤ Shuffle è¿‡åï¼Œä¸€å®šèƒ½å¤Ÿä¿è¯ userID ç›¸åŒçš„äº¤æ˜“è®°å½•å’Œç”¨æˆ·æ•°æ®åè½åœ¨åŒä¸€ä¸ª Executors å†…ã€‚â€ HadoopRDDçš„åˆ†åŒºæ•°ã€æˆ–è€…è¯´å¹¶è¡Œåº¦ï¼Œç¡®å®æ˜¯ç”±HDFSæ–‡ä»¶ç³»ç»Ÿå†³å®šçš„ï¼›ä½†æ˜¯ï¼ŒShuffleè¿‡åï¼Œæ¯ä¸ªåˆ†å¸ƒå¼æ•°æ®é›†çš„å¹¶è¡Œåº¦ï¼Œå°±ç”±å‚æ•°spark.sql.shuffle.partitionsæ¥å†³å®šäº†ï¼Œè¿™ä¸ªå’±ä»¬åœ¨é…ç½®é¡¹å“ªä¸€è®²è¯´è¿‡å“Ÿ~ å› æ­¤ï¼Œå¦‚æœä½ æ²¡æœ‰æ‰‹å·¥ç”¨repartitionæˆ–æ˜¯Coalesceå»è°ƒæ•´å¹¶è¡Œåº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å®¶Shuffleè¿‡åï¼ˆåœ¨Reduceé˜¶æ®µï¼‰éƒ½æ˜¯è¿™ä¸ªå¹¶è¡Œåº¦ã€‚\n\n2. é»˜è®¤ç¡®å®æ˜¯å¼€å¯çš„ï¼Œé»˜è®¤å€¼ç¡®å®ä¹Ÿæ˜¯10MBï¼Œä½†æ˜¯ï¼Œè¿™ä¸ª10MBå¤ªå¤ªå¤ªå¤ªå¤ªå¤ªï¼ˆå¤ª x Nï¼‰å°äº†ï¼å¾ˆå¤šå°è¡¨å…¶å®éƒ½è¶…è¿‡äº†è¿™ä¸ªé˜ˆå€¼ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æ‡’å¾—å»è°ƒæ•´è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥ç›´æ¥ç”¨broadcast(userDF)è¿™ç§å¼ºåˆ¶å¹¿æ’­çš„æ–¹å¼ï¼Œçœæ—¶çœåŠ›ï¼Œæ¯”è¾ƒæ–¹ä¾¿~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618220469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291288,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1620184984,"is_pvip":false,"replies":[{"id":"105524","content":"è¿™é‡Œå…¶å®æœ‰ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µå“ˆ~<br><br>ä¸€ä¸ªæ˜¯å¹¶è¡Œåº¦ï¼Œå¹¶è¡Œåº¦å…¶å®æ˜¯ä»æ•°æ®è§’åº¦å‡ºå‘ï¼Œè¡¨ç¤ºçš„æ˜¯ä½ çš„åˆ†å¸ƒå¼æ•°æ®é›†åˆ’åˆ†çš„ç²’åº¦ï¼Œå†ç›´ç™½ç‚¹è¯´ï¼Œå®ƒå’Œåˆ†åŒºæ•°æ˜¯ç­‰æ•ˆçš„ã€‚å› æ­¤ï¼Œå®ƒå…¶å®è·Ÿä½ é›†ç¾¤æœ‰å¤šå°‘Executorsï¼Œæ¯ä¸ªExecutorsé…ç½®äº†å¤šå°‘coresï¼Œæ²¡æœ‰å…³ç³»~<br><br>ç¬¬äºŒä¸ªæ˜¯å¹¶å‘åº¦ï¼Œæˆ–è€…å«Executorsçº¿ç¨‹æ± å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä½ ç”¨spark.executor.coresç±»ä¼¼çš„å‚æ•°ï¼Œç»™ExecutorsæŒ‡å®šçš„coresèµ„æºã€‚å®ƒé™åˆ¶äº†åœ¨åŒä¸€æ—¶é—´ï¼Œä½ çš„Executorsä¸­æœ€å¤šåŒæ—¶èƒ½è·‘å¤šå°‘ä¸ªä»»åŠ¡ã€‚Executorså¹¶å‘åº¦ä¹˜ä»¥é›†ç¾¤ä¸­çš„Executorsæ•°é‡ï¼Œå…¶å®å°±æ˜¯ä½ é›†ç¾¤çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œå¾ˆå¤šåœ°æ–¹ä¹Ÿå«å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚å…¶å®è›‹ç–¼çš„åœ°æ–¹åœ¨äºï¼Œä¸åŒçš„ä½œè€…ã€ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘å’Œå¹¶è¡Œè¿™ä¸¤ä¸ªè¯ï¼Œæ€»æ˜¯æ··ç”¨ã€‚æ‰€ä»¥ä¹Ÿå°±é€ æˆå¤§å®¶éƒ½æ¯”è¾ƒå›°æƒ‘ã€‚<br><br>å’±ä»¬åœ¨é…ç½®é¡¹ç¬¬ä¸€è®²ï¼Œå…¶å®å°±åœ¨å°è¯•å˜æ¸…ã€çº¦å®šè¿™ä¸¤ä¸ªè¯çš„å®šä¹‰ï¼Œä¸€æ¥æ–¹ä¾¿å¤§å®¶ç†è§£ï¼ŒäºŒæ¥æ–¹ä¾¿åç»­è®¨è®ºã€‚<br><br>æ‰€ä»¥ï¼Œå›ç­”ä½ çš„é—®é¢˜ï¼Œå…¶å®æ²¡ä»€ä¹ˆä¸å¥åº·çš„å“ˆ~ 10000å¹¶è¡Œåº¦ï¼Œæ„å‘³ç€10000ä¸ªåˆ†åŒºçš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œè¿™ä¸ªåº”è¯¥ä¸éš¾è§åˆ°ã€‚å¦å¤–100ä¸ªcoresçš„é›†ç¾¤ï¼Œå…¶å®ä¹Ÿä¸ç®—å°äº†~ ä¸è¿‡ä½ è¯´çš„2000ä»»åŠ¡æˆ‘æ²¡æœ‰getåˆ°ï¼Œä¸çŸ¥é“æ˜¯2000å¹¶è¡Œåº¦ï¼Œè¿˜æ˜¯2000çš„é›†ç¾¤å¹¶å‘ã€‚å¦‚æœæ˜¯2000é›†ç¾¤å¹¶å‘çš„è¯ï¼Œè¿™ä¸ªæ•°å’Œ100coreså¯¹ä¸ä¸Šã€‚è¿™æ„å‘³ç€ä½ çš„æ¯ä¸ªcoreéœ€è¦20ä¸ªè¶…çº¿ç¨‹ï¼Œå“ˆå“ˆï¼Œç›®å‰è¿˜æ²¡æœ‰è¿™ä¹ˆç»™åŠ›çš„CPUã€‚ä¸€èˆ¬CPUä¹Ÿå°±2ä¸ªè¶…çº¿ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","comment_id":291288,"uid":"1043100","ip_address":"","utype":1,"ctime":1620227396,"user_name_real":"å´ç£Š"}],"discussion_count":3,"race_medal":0,"score":"5915152280","product_id":100073401,"comment_content":"è€å¸ˆæˆ‘ç”Ÿäº§ä¸­ä¸ºå•¥ä»æ²¡æœ‰é‡åˆ°è¿‡10000å¹¶è¡Œåº¦é‚£ä¹ˆå¤§çš„stageï¼Œå¯èƒ½æˆ‘å…¬å¸æ¯”è¾ƒå°å§ï¼Œé›†ç¾¤æœ€å¤šæ‰100å¤šä¸ªæ ¸ï¼Œå¤šæ•°æ—¶æ‰å‡ ç™¾ä¸ªä»»åŠ¡ï¼Œæœ€å¤šæ—¶ä¹Ÿæ‰2000å¤šä¸ªä»»åŠ¡ã€‚è¿™å¥åº·å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519429,"discussion_content":"è¿™é‡Œå…¶å®æœ‰ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µå“ˆ~\n\nä¸€ä¸ªæ˜¯å¹¶è¡Œåº¦ï¼Œå¹¶è¡Œåº¦å…¶å®æ˜¯ä»æ•°æ®è§’åº¦å‡ºå‘ï¼Œè¡¨ç¤ºçš„æ˜¯ä½ çš„åˆ†å¸ƒå¼æ•°æ®é›†åˆ’åˆ†çš„ç²’åº¦ï¼Œå†ç›´ç™½ç‚¹è¯´ï¼Œå®ƒå’Œåˆ†åŒºæ•°æ˜¯ç­‰æ•ˆçš„ã€‚å› æ­¤ï¼Œå®ƒå…¶å®è·Ÿä½ é›†ç¾¤æœ‰å¤šå°‘Executorsï¼Œæ¯ä¸ªExecutorsé…ç½®äº†å¤šå°‘coresï¼Œæ²¡æœ‰å…³ç³»~\n\nç¬¬äºŒä¸ªæ˜¯å¹¶å‘åº¦ï¼Œæˆ–è€…å«Executorsçº¿ç¨‹æ± å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä½ ç”¨spark.executor.coresç±»ä¼¼çš„å‚æ•°ï¼Œç»™ExecutorsæŒ‡å®šçš„coresèµ„æºã€‚å®ƒé™åˆ¶äº†åœ¨åŒä¸€æ—¶é—´ï¼Œä½ çš„Executorsä¸­æœ€å¤šåŒæ—¶èƒ½è·‘å¤šå°‘ä¸ªä»»åŠ¡ã€‚Executorså¹¶å‘åº¦ä¹˜ä»¥é›†ç¾¤ä¸­çš„Executorsæ•°é‡ï¼Œå…¶å®å°±æ˜¯ä½ é›†ç¾¤çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œå¾ˆå¤šåœ°æ–¹ä¹Ÿå«å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚å…¶å®è›‹ç–¼çš„åœ°æ–¹åœ¨äºï¼Œä¸åŒçš„ä½œè€…ã€ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å‘å’Œå¹¶è¡Œè¿™ä¸¤ä¸ªè¯ï¼Œæ€»æ˜¯æ··ç”¨ã€‚æ‰€ä»¥ä¹Ÿå°±é€ æˆå¤§å®¶éƒ½æ¯”è¾ƒå›°æƒ‘ã€‚\n\nå’±ä»¬åœ¨é…ç½®é¡¹ç¬¬ä¸€è®²ï¼Œå…¶å®å°±åœ¨å°è¯•å˜æ¸…ã€çº¦å®šè¿™ä¸¤ä¸ªè¯çš„å®šä¹‰ï¼Œä¸€æ¥æ–¹ä¾¿å¤§å®¶ç†è§£ï¼ŒäºŒæ¥æ–¹ä¾¿åç»­è®¨è®ºã€‚\n\næ‰€ä»¥ï¼Œå›ç­”ä½ çš„é—®é¢˜ï¼Œå…¶å®æ²¡ä»€ä¹ˆä¸å¥åº·çš„å“ˆ~ 10000å¹¶è¡Œåº¦ï¼Œæ„å‘³ç€10000ä¸ªåˆ†åŒºçš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œè¿™ä¸ªåº”è¯¥ä¸éš¾è§åˆ°ã€‚å¦å¤–100ä¸ªcoresçš„é›†ç¾¤ï¼Œå…¶å®ä¹Ÿä¸ç®—å°äº†~ ä¸è¿‡ä½ è¯´çš„2000ä»»åŠ¡æˆ‘æ²¡æœ‰getåˆ°ï¼Œä¸çŸ¥é“æ˜¯2000å¹¶è¡Œåº¦ï¼Œè¿˜æ˜¯2000çš„é›†ç¾¤å¹¶å‘ã€‚å¦‚æœæ˜¯2000é›†ç¾¤å¹¶å‘çš„è¯ï¼Œè¿™ä¸ªæ•°å’Œ100coreså¯¹ä¸ä¸Šã€‚è¿™æ„å‘³ç€ä½ çš„æ¯ä¸ªcoreéœ€è¦20ä¸ªè¶…çº¿ç¨‹ï¼Œå“ˆå“ˆï¼Œç›®å‰è¿˜æ²¡æœ‰è¿™ä¹ˆç»™åŠ›çš„CPUã€‚ä¸€èˆ¬CPUä¹Ÿå°±2ä¸ªè¶…çº¿ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620227396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549032,"avatar":"","nickname":"Zzz","note":"","ucode":"9323254354868B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388745,"discussion_content":"å¦‚æœå…¬å¸ä¸šåŠ¡æ•°æ®é‡å¤§çš„è¯ï¼Œå®é™…åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œtaskä¸Šä¸‡çš„æ¯”æ¯”çš†æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628932560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","nickname":"æ–¯ç›–ä¸¸","note":"","ucode":"B881D14B028F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372407,"discussion_content":"è€å¸ˆæˆ‘æŒ‡çš„æ˜¯2000ä¸ªtaskï¼Œæ˜¯å¹¶è¡Œåº¦ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620309793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335340,"user_name":"é™Œç”Ÿçš„å¿ƒé…¸","can_delete":false,"product_type":"c1","uid":2829738,"ip_address":"","ucode":"2F221D93403D20","user_header":"https://static001.geekbang.org/account/avatar/00/2b/2d/aa/e33e9edd.jpg","comment_is_top":false,"comment_ctime":1645457490,"is_pvip":false,"replies":[{"id":"122825","content":"å¯ä»¥å‚è€ƒBennanåŒå­¦çš„ç­”æ¡ˆå“ˆï¼š<br><br>1. P2Pæ€è·¯ï¼šæ”¹æˆç”±driverè·å–åˆ°æ•°æ®åˆ†å¸ƒï¼Œç„¶åé€šçŸ¥å„ä¸ªexecutorä¹‹é—´è¿›è¡Œæ‹‰å–ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨å¤šä¸ªexecutorç½‘ç»œï¼Œé¿å…åªæœ‰driverç»„è£…ä»¥åå†ä¸€ä¸ªä¸€ä¸ªå‘é€æ•ˆç‡è¿‡ä½<br><br>2.å½“ä¸¤ä¸ªéœ€è¦joinçš„æ•°æ®é›†éƒ½å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨broadcast joinéœ€è¦å°†ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†è¿›è¡Œç½‘ç»œåˆ†å‘å¤šæ¬¡ï¼Œå·²ç»è¿œè¶…å‡ºäº†shuffle joinéœ€è¦ä¼ è¾“çš„æ•°æ®","user_name":"ä½œè€…å›å¤","comment_id":335340,"uid":"1043100","ip_address":"","utype":1,"ctime":1645889783,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1645457490","product_id":100073401,"comment_content":"1&gt;.å½“æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¯¹æ•°æ®è¿›è¡Œå¹¿æ’­åï¼ŒåŒæ—¶è¿˜è¦æ¥å—å„ä¸ªExecutorçš„ä¸­é—´ç»“æœä¸ŠæŠ¥ï¼ŒçŠ¶æ€ç®¡ç†ï¼Œå¯¼è‡´ç½‘ç»œç¹å¿™ï¼Œç»§è€Œä¼šå‘ç”Ÿåˆ†å‘ä»»åŠ¡åˆ°Executoräº§ç”Ÿå¤±è´¥<br><br>2&gt; ä¸¤ä¸ªå¤§è¡¨ã€è¶…è¿‡å¹¿æ’­å˜é‡çš„é˜ˆå€¼å‚æ•°è®¾ç½®ã€‘è¿›è¡Œjoinï¼Œæ•°æ®éœ€è¦åˆ†å‘å¤šæ¬¡ï¼Œæ•ˆç‡ä¸ä½³","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553466,"discussion_content":"å¯ä»¥å‚è€ƒBennanåŒå­¦çš„ç­”æ¡ˆå“ˆï¼š\n\n1. P2Pæ€è·¯ï¼šæ”¹æˆç”±driverè·å–åˆ°æ•°æ®åˆ†å¸ƒï¼Œç„¶åé€šçŸ¥å„ä¸ªexecutorä¹‹é—´è¿›è¡Œæ‹‰å–ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨å¤šä¸ªexecutorç½‘ç»œï¼Œé¿å…åªæœ‰driverç»„è£…ä»¥åå†ä¸€ä¸ªä¸€ä¸ªå‘é€æ•ˆç‡è¿‡ä½\n\n2.å½“ä¸¤ä¸ªéœ€è¦joinçš„æ•°æ®é›†éƒ½å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨broadcast joinéœ€è¦å°†ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†è¿›è¡Œç½‘ç»œåˆ†å‘å¤šæ¬¡ï¼Œå·²ç»è¿œè¶…å‡ºäº†shuffle joinéœ€è¦ä¼ è¾“çš„æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645889783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320862,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1636533825,"is_pvip":false,"replies":[{"id":"116385","content":"å…³äºCacheï¼ˆPersistï¼‰çš„éƒ¨åˆ†ï¼Œå»ºè®®è€å¼Ÿå…³æ³¨ç¬¬16è®²ï¼šå†…å­˜è§†è§’ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•æœ‰æ•ˆé¿å…Cacheæ»¥ç”¨ï¼Ÿè¿™ä¸€è®²ï¼Œæ¯”è¾ƒç³»ç»Ÿã€ç»†è‡´åœ°ä»‹ç»äº†Cacheçš„ä½¿ç”¨åœºæ™¯ã€åŸåˆ™ï¼Œå’Œä¸€èˆ¬æ³¨æ„äº‹é¡¹ï¼Œå°¤å…¶æ˜¯ä»€ä¹ˆæ—¶å€™è¯¥Cacheï¼Œä»€ä¹ˆæ—¶å€™ä¸èƒ½æ»¥ç”¨Cacheï¼Œè€å¼Ÿå¯ä»¥å…ˆçœ‹çœ‹å“ˆ~","user_name":"ä½œè€…å›å¤","comment_id":320862,"uid":"1043100","ip_address":"","utype":1,"ctime":1636556328,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1636533825","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œåœ¨æ•´ä¸ªåº”ç”¨èµ„æºè¾ƒä¸ºç´§å¼ ï¼Œæ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼šspark coreè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆä¸€ä¸ªè¾ƒå¤§çš„RDD , å®ƒè¢«å¼•ç”¨ä¸€æ¬¡ï¼Œä½†æˆ‘è¿˜æ˜¯å¯¹å®ƒpersist(disk)ï¼Œæˆ‘åœ¨ç”¨å®Œå¹¶ä¸”åŠ¨ä½œç®—å­åï¼Œç«‹åˆ»å¯¹å®ƒè¿›è¡Œäº†é‡Šæ”¾unpersistï¼Œè¿™æ ·æ“ä½œæ˜¯å¦èƒ½åŠ å¿«spark å¯¹è¿™ä¸ªrdd çš„æ¸…ç†ï¼ŒåŠ å¿«å†…å­˜çš„é‡Šæ”¾ï¼Œç¼“è§£å†…å­˜å‹åŠ›ï¼Ÿå¦‚æœæ˜¯persist(memory and disk)ï¼Œç”¨å®Œå¹¶ä¸”åœ¨åŠ¨ä½œç®—å­åç«‹å³é‡Šæ”¾unpersistï¼Œæ˜¯å¦èƒ½ç¼“è§£å†…å­˜å‹åŠ›ï¼Ÿå¦‚æœä¸persistï¼Œç”¨å®Œå¹¶ä¸”åœ¨åŠ¨ä½œç®—å­åç«‹å³é‡Šæ”¾unpersistï¼Œæ˜¯å¦èƒ½ç¼“è§£å†…å­˜å‹åŠ›ï¼Ÿ æ–‡å­—æœ‰äº›é•¿ï¼Œå¸Œæœ›æ²¡ç»™è€å¸ˆé€ æˆå›°æ‰°ï¼Œè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530146,"discussion_content":"å…³äºCacheï¼ˆPersistï¼‰çš„éƒ¨åˆ†ï¼Œå»ºè®®è€å¼Ÿå…³æ³¨ç¬¬16è®²ï¼šå†…å­˜è§†è§’ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•æœ‰æ•ˆé¿å…Cacheæ»¥ç”¨ï¼Ÿè¿™ä¸€è®²ï¼Œæ¯”è¾ƒç³»ç»Ÿã€ç»†è‡´åœ°ä»‹ç»äº†Cacheçš„ä½¿ç”¨åœºæ™¯ã€åŸåˆ™ï¼Œå’Œä¸€èˆ¬æ³¨æ„äº‹é¡¹ï¼Œå°¤å…¶æ˜¯ä»€ä¹ˆæ—¶å€™è¯¥Cacheï¼Œä»€ä¹ˆæ—¶å€™ä¸èƒ½æ»¥ç”¨Cacheï¼Œè€å¼Ÿå¯ä»¥å…ˆçœ‹çœ‹å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636556328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320857,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1636532429,"is_pvip":false,"replies":[{"id":"116381","content":"å…ˆè¯´é—®é¢˜2ï¼‰è€å¼Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€ï¼Œæˆ–æ˜¯â€œrJuniorâ€ï¼Œæˆ‘æŠŠä½ æ‹‰è¿›å»<br><br>å†æ¥è¯´1ï¼‰ä»ä¸¤ä¸ªè§’åº¦æ¥è¯´ï¼š<br><br>é¦–å…ˆï¼Œ driveråˆ›å»ºå®Œå¹¿æ’­å˜é‡ã€åˆ†å‘ç»™Executorsä¹‹åï¼Œå¹¿æ’­å˜é‡åœ¨Driverç«¯å…¶å®æ˜¯æ²¡æœ‰å¼•ç”¨çš„ï¼Œæ‰€ä»¥éšç€æ—¶é—´æµé€ï¼Œè¿™äº›åœ¨Driverç«¯åˆ›å»ºçš„å¹¿æ’­å˜é‡ï¼Œä¼šæ…¢æ…¢åœ°è¢«GCæ‰ï¼Œæ‰€ä»¥è¯´ï¼Œä¸å­˜åœ¨é•¿æœŸç§¯å‹å¯¼è‡´å†…å­˜ä¸æ–­æ¶ˆè€—çš„é—®é¢˜~<br><br>å†ä¸€ä¸ªï¼Œå³ä¾¿å¹¿æ’­å˜é‡æ²¡æœ‰è¢«GCï¼Œé‚£ä¹ˆå‡ºç°ä½ è¯´çš„é‚£ç§æƒ…å†µï¼Œå‰æä¹Ÿæ˜¯ä½ åœ¨åº”ç”¨ä¸­åˆ›å»ºäº†å¾ˆå¤šçš„å¹¿æ’­å˜é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¹¿æ’­å˜é‡ç¡®å®å¯ä»¥æ”¹å–„Shuffle joinï¼Œä½†æ˜¯ï¼Œæ»¥ç”¨ä¹Ÿä¸è¡Œï¼Œé€‚å¾—å…¶åã€‚å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½å¯ç€ä¸€åªç¾Šè–…ç¾Šæ¯›ï¼Œä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœå¹¿æ’­å˜é‡éå¸¸å¾—å¤šï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®é›†ä¸Šçš„å¹¿æ’­å˜é‡ï¼Œé‚£æˆ‘ä»¬åº”è¯¥è€ƒè™‘ï¼Œæ˜¯å¦åº”ç”¨çš„å®ç°æ–¹å¼æ˜¯åˆç†çš„ï¼Œæœ‰æ²¡æœ‰å…¶ä»–é€”å¾„ï¼Œå®ç°åŒæ ·çš„ä¸šåŠ¡é€»è¾‘","user_name":"ä½œè€…å›å¤","comment_id":320857,"uid":"1043100","ip_address":"","utype":1,"ctime":1636556107,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1636532429","product_id":100073401,"comment_content":"1 è€å¸ˆï¼Œæ‚¨å¥½ï¼Œspark coreè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é¢‘ç¹çš„ä½¿ç”¨broadCast æ“ä½œï¼Œ è¿™æ ·ç´¯è®¡å‡ æ¬¡ådriver ç«¯å†…å­˜ä¼šå¾ˆæœ‰å‹åŠ›ï¼Œæ€æ ·è®¾ç½®å‚æ•°æˆ–è€…æ‰‹åŠ¨æ¸…é™¤ä¹‹å‰ç”¨æ¥broadCast çš„æ•°æ®ï¼Ÿè°¢è°¢è€å¸ˆ<br>2 è€å¸ˆè¿™ä¸ªè¯¾ç¨‹çš„å¾®ä¿¡äº¤æµç¾¤æ€ä¹ˆæ·»åŠ å‘¢ï¼ŸæœŸå¾…åŠ å…¥å­¦ä¹ <br><br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530145,"discussion_content":"å…ˆè¯´é—®é¢˜2ï¼‰è€å¼Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼Œæœç´¢â€œæ–¹å—Kâ€ï¼Œæˆ–æ˜¯â€œrJuniorâ€ï¼Œæˆ‘æŠŠä½ æ‹‰è¿›å»\n\nå†æ¥è¯´1ï¼‰ä»ä¸¤ä¸ªè§’åº¦æ¥è¯´ï¼š\n\né¦–å…ˆï¼Œ driveråˆ›å»ºå®Œå¹¿æ’­å˜é‡ã€åˆ†å‘ç»™Executorsä¹‹åï¼Œå¹¿æ’­å˜é‡åœ¨Driverç«¯å…¶å®æ˜¯æ²¡æœ‰å¼•ç”¨çš„ï¼Œæ‰€ä»¥éšç€æ—¶é—´æµé€ï¼Œè¿™äº›åœ¨Driverç«¯åˆ›å»ºçš„å¹¿æ’­å˜é‡ï¼Œä¼šæ…¢æ…¢åœ°è¢«GCæ‰ï¼Œæ‰€ä»¥è¯´ï¼Œä¸å­˜åœ¨é•¿æœŸç§¯å‹å¯¼è‡´å†…å­˜ä¸æ–­æ¶ˆè€—çš„é—®é¢˜~\n\nå†ä¸€ä¸ªï¼Œå³ä¾¿å¹¿æ’­å˜é‡æ²¡æœ‰è¢«GCï¼Œé‚£ä¹ˆå‡ºç°ä½ è¯´çš„é‚£ç§æƒ…å†µï¼Œå‰æä¹Ÿæ˜¯ä½ åœ¨åº”ç”¨ä¸­åˆ›å»ºäº†å¾ˆå¤šçš„å¹¿æ’­å˜é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¹¿æ’­å˜é‡ç¡®å®å¯ä»¥æ”¹å–„Shuffle joinï¼Œä½†æ˜¯ï¼Œæ»¥ç”¨ä¹Ÿä¸è¡Œï¼Œé€‚å¾—å…¶åã€‚å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½å¯ç€ä¸€åªç¾Šè–…ç¾Šæ¯›ï¼Œä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœå¹¿æ’­å˜é‡éå¸¸å¾—å¤šï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®é›†ä¸Šçš„å¹¿æ’­å˜é‡ï¼Œé‚£æˆ‘ä»¬åº”è¯¥è€ƒè™‘ï¼Œæ˜¯å¦åº”ç”¨çš„å®ç°æ–¹å¼æ˜¯åˆç†çš„ï¼Œæœ‰æ²¡æœ‰å…¶ä»–é€”å¾„ï¼Œå®ç°åŒæ ·çš„ä¸šåŠ¡é€»è¾‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636556107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319622,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1635867716,"is_pvip":false,"replies":[{"id":"116038","content":"å…¶å®è·Ÿinnerç›¸æ¯”ï¼Œleftåªæ˜¯åœ¨å½¢å¼ä¸Šä¸åŒå“ˆï¼Œå®é™…åœ¨è¿è¡Œæ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å‡¡æ˜¯é€‚åˆinnerçš„ä¼˜åŒ–æ–¹æ³•ï¼Œleftã€rightã€semiã€antiï¼Œéƒ½é€‚ç”¨çš„~<br><br>","user_name":"ä½œè€…å›å¤","comment_id":319622,"uid":"1043100","ip_address":"","utype":1,"ctime":1636094379,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1635867716","product_id":100073401,"comment_content":"è€å¸ˆ, è¯¾ç¨‹é‡Œæ‚¨è®²äº†å†…è¿æ¥å·¦å³å·¦å³ä¸¤è¡¨çš„è¿æ¥è¿‡ç¨‹ï¼Œæ‚¨èƒ½å¦å†è®²ä¸€ä¸‹å·¦å¤–è¿æ¥leftoutjoin çš„å‘¢ï¼Ÿå¯¹shuffleè¿‡ç¨‹ä¸å¤ªæ¸…æ™°ï¼Œè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529691,"discussion_content":"å…¶å®è·Ÿinnerç›¸æ¯”ï¼Œleftåªæ˜¯åœ¨å½¢å¼ä¸Šä¸åŒå“ˆï¼Œå®é™…åœ¨è¿è¡Œæ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å‡¡æ˜¯é€‚åˆinnerçš„ä¼˜åŒ–æ–¹æ³•ï¼Œleftã€rightã€semiã€antiï¼Œéƒ½é€‚ç”¨çš„~\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636094379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317504,"user_name":"ç‹—å“­","can_delete":false,"product_type":"c1","uid":2725399,"ip_address":"","ucode":"56E48A6FC1298A","user_header":"https://static001.geekbang.org/account/avatar/00/29/96/17/200c21f0.jpg","comment_is_top":false,"comment_ctime":1634817598,"is_pvip":false,"replies":[{"id":"115138","content":"èƒ½å¦å¹¿æ’­ï¼Œå–å†³äºbè¡¨çš„å­˜å‚¨å¤§å°ï¼Œæ˜¯å¦å°äºå¹¿æ’­é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯ï¼šspark.sql.autoBroadcastJoinThresholdã€‚å¦‚æœå°äºè¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šå¹¿æ’­ï¼Œå¦åˆ™å°±ä¸ä¼šã€‚<br><br>å¦‚æœæ‡’å¾—è®¾é˜ˆå€¼ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ API å¼ºåˆ¶å¹¿æ’­ï¼Œè¿™é‡Œçš„å…·ä½“ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒç¬¬13è®²å“ˆï¼Œå°±æ˜¯åé¢çš„ä¸€è®²~ ä¼šè¯¦ç»†è¯´ï¼Œæ€ä¹ˆæŠŠShuffle Joinï¼Œè½¬åŒ–ä¸ºBroadcast Join","user_name":"ä½œè€…å›å¤","comment_id":317504,"uid":"1043100","ip_address":"","utype":1,"ctime":1634890022,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"1634817598","product_id":100073401,"comment_content":"select * from<br>(select id from table1) a -- ç»“æœå¾ˆå¤§<br>left join<br>(select id from table2) b -- ç»“æœå¾ˆå°<br>on t1.id = t2.id;<br>è€å¸ˆè¯·æ•™ä¸‹ï¼Œè¿™ç§æƒ…å†µbè¡¨ä¼šå¹¿æ’­å—ï¼Ÿå¦‚æœä¸ä¼šæ€ä¹ˆå¤„ç†èƒ½è®©å…¶å¹¿æ’­å‡ºå»å‘¢","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528840,"discussion_content":"èƒ½å¦å¹¿æ’­ï¼Œå–å†³äºbè¡¨çš„å­˜å‚¨å¤§å°ï¼Œæ˜¯å¦å°äºå¹¿æ’­é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯ï¼šspark.sql.autoBroadcastJoinThresholdã€‚å¦‚æœå°äºè¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šå¹¿æ’­ï¼Œå¦åˆ™å°±ä¸ä¼šã€‚\n\nå¦‚æœæ‡’å¾—è®¾é˜ˆå€¼ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ API å¼ºåˆ¶å¹¿æ’­ï¼Œè¿™é‡Œçš„å…·ä½“ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒç¬¬13è®²å“ˆï¼Œå°±æ˜¯åé¢çš„ä¸€è®²~ ä¼šè¯¦ç»†è¯´ï¼Œæ€ä¹ˆæŠŠShuffle Joinï¼Œè½¬åŒ–ä¸ºBroadcast Join","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634890022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2725399,"avatar":"https://static001.geekbang.org/account/avatar/00/29/96/17/200c21f0.jpg","nickname":"ç‹—å“­","note":"","ucode":"56E48A6FC1298A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408439,"discussion_content":"è€å¸ˆæˆ‘ä»¬ç”¨çš„æ˜¯spark2.0ï¼Œå¦‚æœæˆ‘åœ¨ä¹‹å‰å¯¹bè¡¨è¿›è¡Œäº†ç¼“å­˜ä¸”è§¦å‘è®¡ç®—ï¼Œè¿™é‡Œæ‰ä¼šèµ°broadcastjoinï¼Œå¦åˆ™ä¸ä¼šèµ°ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635248138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310784,"user_name":"zhongmin","can_delete":false,"product_type":"c1","uid":1265621,"ip_address":"","ucode":"C7AB10205A4F04","user_header":"https://static001.geekbang.org/account/avatar/00/13/4f/d5/1666b7d0.jpg","comment_is_top":false,"comment_ctime":1630909620,"is_pvip":true,"replies":[{"id":"112637","content":"ä¸€èˆ¬æ¥è¯´ï¼Œå¹¿æ’­å˜é‡å°è£…çš„ï¼Œéƒ½æ˜¯immutable dataï¼Œå°±æ˜¯ä¸å¯å˜æ•°æ®ï¼ˆé›†ï¼‰ã€‚å¦‚æœå°è£…çš„å˜é‡å€¼æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºæ–°çš„å¹¿æ’­å˜é‡ï¼Œä¹‹å‰åˆ›å»ºçš„å¹¿æ’­å˜é‡æ‰€æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è·Ÿç€æ›´æ–°çš„~","user_name":"ä½œè€…å›å¤","comment_id":310784,"uid":"1043100","ip_address":"","utype":1,"ctime":1630937414,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1630909620","product_id":100073401,"comment_content":"å´è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜ï¼Œåœ¨å¹¿æ’­åˆ†å¸ƒå¼å˜é‡çš„æ—¶å€™ï¼Œå¦‚æœå˜é‡çš„å†…å®¹å‘ç”Ÿæ”¹å˜ï¼Œæ˜¯æ€ä¹ˆå»åšå˜é‡çš„åŒæ­¥å’Œæ›´æ–°å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526351,"discussion_content":"ä¸€èˆ¬æ¥è¯´ï¼Œå¹¿æ’­å˜é‡å°è£…çš„ï¼Œéƒ½æ˜¯immutable dataï¼Œå°±æ˜¯ä¸å¯å˜æ•°æ®ï¼ˆé›†ï¼‰ã€‚å¦‚æœå°è£…çš„å˜é‡å€¼æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºæ–°çš„å¹¿æ’­å˜é‡ï¼Œä¹‹å‰åˆ›å»ºçš„å¹¿æ’­å˜é‡æ‰€æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è·Ÿç€æ›´æ–°çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630937414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305117,"user_name":"wow_xiaodi","can_delete":false,"product_type":"c1","uid":1511712,"ip_address":"","ucode":"B3FB301556A7EA","user_header":"https://static001.geekbang.org/account/avatar/00/17/11/20/9f31c4f4.jpg","comment_is_top":false,"comment_ctime":1627826813,"is_pvip":false,"replies":[{"id":"110494","content":"å¥½é—®é¢˜ï½<br><br>1ï¼‰ä¼˜å…ˆæ”¾å†…å­˜ï¼Œç©ºé—´ä¸è¶³æ”¾ç£ç›˜<br><br>2ï¼‰ä¸€æ¥å®é™…ä¸Šå¹¶æ²¡æœ‰èŠ‚çœç½‘ç»œå¼€é”€ï¼ˆä¸å¦¨ä»”ç»†æƒ³æƒ³ä¸ºä»€ä¹ˆï¼‰ï¼Œå†è€…è¿™æ ·çš„åº”ç”¨åœºæ™¯å¤ªæœ‰é™äº†ã€‚è¿™ç§caseåªé€‚ç”¨äºé‚£ç§æ•°æ®åˆšè¯»è¿›æ¥å°±å¹¿æ’­ï¼Œåœºæ™¯å¤ªæœ‰é™ã€‚","user_name":"ä½œè€…å›å¤","comment_id":305117,"uid":"1043100","ip_address":"","utype":1,"ctime":1628042194,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1627826813","product_id":100073401,"comment_content":"è€å¸ˆå¯¹äºè¿™èŠ‚æœ‰ä¸€äº›é—®é¢˜ï¼š<br>(1)executorå¯¹äºå¾…å›ä¼ driverç«¯çš„å¹¿æ’­æ•°æ®é›†æ˜¯å…ˆå­˜åœ¨å†…å­˜è¿˜æ˜¯è½åœ°ç¡¬ç›˜å‘¢ï¼Ÿ<br>(2)ç”±executoræ¥å¤„ç†åˆ†ç‰‡å†å›ä¼ ï¼Œå¯èƒ½åˆ†ç‰‡éœ€è¦è¿›è¡Œä¸€å®šçš„è®¡ç®—å†ç”±driveræ±‡æ€»å¹¿æ’­ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯æ— éœ€è®¡ç®—çš„åŸå§‹åˆ†ç‰‡å‘¢ï¼Œdriverå¯å¦äº²è‡ªæ“åˆ€è¯»å–æ‰€æœ‰åŸå§‹åˆ†ç‰‡ç›´æ¥æ±‡æ€»å†åˆ†å‘å‘¢ï¼Œæ„Ÿè§‰è¿™æ ·å¯ä»¥èŠ‚çœç½‘ç»œå¼€é”€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524281,"discussion_content":"å¥½é—®é¢˜ï½\n\n1ï¼‰ä¼˜å…ˆæ”¾å†…å­˜ï¼Œç©ºé—´ä¸è¶³æ”¾ç£ç›˜\n\n2ï¼‰ä¸€æ¥å®é™…ä¸Šå¹¶æ²¡æœ‰èŠ‚çœç½‘ç»œå¼€é”€ï¼ˆä¸å¦¨ä»”ç»†æƒ³æƒ³ä¸ºä»€ä¹ˆï¼‰ï¼Œå†è€…è¿™æ ·çš„åº”ç”¨åœºæ™¯å¤ªæœ‰é™äº†ã€‚è¿™ç§caseåªé€‚ç”¨äºé‚£ç§æ•°æ®åˆšè¯»è¿›æ¥å°±å¹¿æ’­ï¼Œåœºæ™¯å¤ªæœ‰é™ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628042194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293236,"user_name":"xuchuan","can_delete":false,"product_type":"c1","uid":1954690,"ip_address":"","ucode":"3967199AA078C7","user_header":"https://static001.geekbang.org/account/avatar/00/1d/d3/82/c3e57eb3.jpg","comment_is_top":false,"comment_ctime":1621300126,"is_pvip":false,"replies":[{"id":"106288","content":"è¿™å—å…¶å®æ¶‰åŠåˆ°Joinçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸è®ºæŸ¥è¯¢è¯­å¥ä¸­æœ¬èº«æœ‰å¤šå°‘ä¸ªJoinï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¼ ç»Ÿçš„DBMSä¹Ÿå¥½ï¼ŒSpark SQLä¹Ÿå¥½ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸¤å¼ è¡¨ã€ä¸¤å¼ è¡¨åœ°åšJoinã€‚æ¯”å¦‚è¯´ï¼Œæœ‰ä¸ªæŸ¥è¯¢ï¼Œa join bï¼Œbåˆjoin cï¼Œåœ¨è¿è¡Œæ—¶ï¼Œa join bä¼šç”Ÿæˆä¸´æ—¶ç»“æœï¼Œæ¯”å¦‚å«xxxï¼Œé‚£ä¹ˆåç»­ä¸cåšå…³è”çš„ï¼Œä¸å†æ˜¯bï¼Œè€Œæ˜¯è¿™ä¸ªxxxã€‚å› æ­¤ï¼Œä¸cçš„å…³è”æ˜¯å¦èƒ½åšBroadcast Joinçš„è½¬åŒ–ï¼Œå–å†³äºxxxçš„ä¸­é—´å¤§å°ï¼Œè€Œä¸æ˜¯bçš„å¤§å°ã€‚<br><br>æ•°ä»“è¿™ä¸ªæ˜¯ä¸ªå¥½é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´ï¼ŒSparkéœ€è¦é¢å¤–çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥ç®¡ç†æ•°ä»“å…ƒæ•°æ®ï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨Hiveæ„å»ºæ•°ä»“çš„å­˜å‚¨å±‚ï¼Œè€Œç”¨Sparkåšè®¡ç®—å±‚ã€‚","user_name":"ä½œè€…å›å¤","comment_id":293236,"uid":"1043100","ip_address":"","utype":1,"ctime":1621413985,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1621300126","product_id":100073401,"comment_content":"2.å¤šä¸ªå¤§è¡¨joinåº”è¯¥å°±æ²¡æ³•ç”¨å¹¿æ’­è§£å†³ï¼Œè¿™ä¸ªå»¶ä¼¸ä¸€ä¸ªé—®é¢˜ï¼Œä»¥ç”µå•†ä¸ºä¾‹ï¼Œå³å¸­æŸ¥è¯¢åº”è¯¥è¿˜è¦æœ‰æ•°ä»“å§ï¼Œè¿™ä¸æ˜¯sparkçš„ä¸»è¦è¦†ç›–èŒƒç•´ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520126,"discussion_content":"è¿™å—å…¶å®æ¶‰åŠåˆ°Joinçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸è®ºæŸ¥è¯¢è¯­å¥ä¸­æœ¬èº«æœ‰å¤šå°‘ä¸ªJoinï¼Œåœ¨è¿è¡Œæ—¶ï¼Œä¼ ç»Ÿçš„DBMSä¹Ÿå¥½ï¼ŒSpark SQLä¹Ÿå¥½ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸¤å¼ è¡¨ã€ä¸¤å¼ è¡¨åœ°åšJoinã€‚æ¯”å¦‚è¯´ï¼Œæœ‰ä¸ªæŸ¥è¯¢ï¼Œa join bï¼Œbåˆjoin cï¼Œåœ¨è¿è¡Œæ—¶ï¼Œa join bä¼šç”Ÿæˆä¸´æ—¶ç»“æœï¼Œæ¯”å¦‚å«xxxï¼Œé‚£ä¹ˆåç»­ä¸cåšå…³è”çš„ï¼Œä¸å†æ˜¯bï¼Œè€Œæ˜¯è¿™ä¸ªxxxã€‚å› æ­¤ï¼Œä¸cçš„å…³è”æ˜¯å¦èƒ½åšBroadcast Joinçš„è½¬åŒ–ï¼Œå–å†³äºxxxçš„ä¸­é—´å¤§å°ï¼Œè€Œä¸æ˜¯bçš„å¤§å°ã€‚\n\næ•°ä»“è¿™ä¸ªæ˜¯ä¸ªå¥½é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´ï¼ŒSparkéœ€è¦é¢å¤–çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥ç®¡ç†æ•°ä»“å…ƒæ•°æ®ï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨Hiveæ„å»ºæ•°ä»“çš„å­˜å‚¨å±‚ï¼Œè€Œç”¨Sparkåšè®¡ç®—å±‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621413985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292241,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1620736269,"is_pvip":false,"replies":[{"id":"105816","content":"ä¸¤è€…éƒ½å¯ä»¥å¹¿æ’­å“ˆ~ ä»–ä»¬éƒ½æ˜¯åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œä½ è¯´çš„å¯¹ï¼ŒDataFrameåªæ˜¯å¤šäº†ä¸ªSchemaè€Œå·²ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†éƒ½æ˜¯å¯ä»¥å¹¿æ’­çš„~ <br><br>æ–‡ä¸­ä¸¾ä¾‹å¤šç”¨DataFrameï¼ŒRDDç”¨å¾—å°‘ï¼ŒåŸå› åœ¨äºDataFrame APIç›®å‰æ˜¯ä¸»æµï¼Œå®ƒèƒ½äº«å—åˆ°Spark SQLå¸¦æ¥çš„ç§ç§ä¼˜åŒ–æœºåˆ¶ã€‚<br><br>ä½†åƒå¹¿æ’­è¿™ç§ä¼˜åŒ–æœºåˆ¶ï¼ŒäºŒè€…éƒ½å¯ä»¥çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":292241,"uid":"1043100","ip_address":"","utype":1,"ctime":1620797809,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1620736269","product_id":100073401,"comment_content":"ç£Šå“¥ï¼Œä¸ºä»€ä¹ˆdataframeå¯ä»¥å¹¿æ’­ï¼Œè€Œrddä¸èƒ½å¹¿æ’­ã€‚dataframeä¹Ÿä¸å­˜æ•°æ®å‘€ï¼Œå®ƒåªæ˜¯æ¯”rdd å¤šäº†schemaä¿¡æ¯ã€‚è¿™å—ä¸å¤ªç†è§£ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519744,"discussion_content":"ä¸¤è€…éƒ½å¯ä»¥å¹¿æ’­å“ˆ~ ä»–ä»¬éƒ½æ˜¯åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œä½ è¯´çš„å¯¹ï¼ŒDataFrameåªæ˜¯å¤šäº†ä¸ªSchemaè€Œå·²ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†éƒ½æ˜¯å¯ä»¥å¹¿æ’­çš„~ \n\næ–‡ä¸­ä¸¾ä¾‹å¤šç”¨DataFrameï¼ŒRDDç”¨å¾—å°‘ï¼ŒåŸå› åœ¨äºDataFrame APIç›®å‰æ˜¯ä¸»æµï¼Œå®ƒèƒ½äº«å—åˆ°Spark SQLå¸¦æ¥çš„ç§ç§ä¼˜åŒ–æœºåˆ¶ã€‚\n\nä½†åƒå¹¿æ’­è¿™ç§ä¼˜åŒ–æœºåˆ¶ï¼ŒäºŒè€…éƒ½å¯ä»¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620797809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291545,"user_name":"å¼¦æ–­è§…çŸ¥éŸ³","can_delete":false,"product_type":"c1","uid":1283398,"ip_address":"","ucode":"6234916B97268C","user_header":"https://static001.geekbang.org/account/avatar/00/13/95/46/1cd5ab5f.jpg","comment_is_top":false,"comment_ctime":1620356283,"is_pvip":false,"replies":[{"id":"105815","content":"è¿™é‡Œæˆ‘åŸæ–‡æ²¡æœ‰è¯´æ¸…æ¥šï¼Œæ˜¯æˆ‘çš„é”…å“ˆã€‚è¿™é‡Œå¹¿æ’­å˜é‡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œå…¶å®åˆ†ä¸¤ä¸ªæ­¥éª¤ï¼š<br><br>1. å¹¿æ’­å˜é‡åˆ›å»ºï¼šç¬¬ä¸€ä¸ªæ˜¯Driverä»æ‰€æœ‰Executorsæ”¶é›†æ•°æ®ï¼Œæ„å»ºå¹¿æ’­å˜é‡ï¼Œä¹Ÿå°±æ˜¯å…¨é‡æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹Driveræ˜¯ç“¶é¢ˆï¼›<br><br>2. å¹¿æ’­å˜é‡ä½¿ç”¨&#47;è¯»å–ï¼šç¬¬äºŒä¸ªæ˜¯å„ä¸ªExecutorså†å»æ‹‰å–å¹¿æ’­å˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ç°åœ¨åªæœ‰TorrentBroadcastè¿™ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒExecutorsä¹‹é—´ç”¨ç±»ä¼¼â€œP2Pâ€çš„æ–¹å¼å»æ‹‰å–å¹¿æ’­å˜é‡çš„æ¯ä¸€ä¸ªblockã€‚ä¼˜å…ˆä»æœ¬æœºçš„å…¶ä»–Executorsæ‹‰å–ã€å…¶æ¬¡æœ¬Rackçš„å…¶ä»–æœºå™¨å»æ‹‰å–ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä»»åŠ¡æœ¬åœ°æ€§ï¼Œæ€»ä¹‹å¯¹äºtarget blockï¼Œç»™å®šblockåœ°å€åˆ—è¡¨ï¼ŒBlockManagerä¼šä¼˜å…ˆé€‰å–æ‹‰å–æˆæœ¬æœ€ä½çš„é‚£ä¸ªå»å°è¯•ã€‚ä¹‹æ‰€æœ‰è¯´æ˜¯ç±»ä¼¼â€œP2Pâ€ï¼ŒåŸå› åœ¨äºå®ƒæ‹‰å–çš„å½¢å¼æ˜¯P2Pï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆP2Påè®®ï¼Œè€Œæ˜¯åˆ©ç”¨BlockManageræ¥å®ç°å®šå‘æ‹‰å–ã€‚BlockManagerä»BlockManagerMasterè·å–ç›®æ ‡blockåœ°å€åˆ—è¡¨ï¼Œç„¶åæŒ‰ç…§åˆšåˆšè¯´çš„é¡ºåºï¼Œä¾æ¬¡å°è¯•æ‹‰å–Blockã€‚","user_name":"ä½œè€…å›å¤","comment_id":291545,"uid":"1043100","ip_address":"","utype":1,"ctime":1620797634,"user_name_real":"å´ç£Š"}],"discussion_count":3,"race_medal":0,"score":"1620356283","product_id":100073401,"comment_content":"è¯·æ•™è€å¸ˆç¬¬ä¸€ä¸ªé—®é¢˜ï¼š ç”¨ä»€ä¹ˆæ–¹å¼ æ”¹ä¸ºç”±driverè·å–åˆ°æ•°æ®åˆ†å¸ƒï¼Œç„¶åé€šçŸ¥å„ä¸ªexecutorä¹‹é—´è¿›è¡Œæ‹‰å–ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519502,"discussion_content":"è¿™é‡Œæˆ‘åŸæ–‡æ²¡æœ‰è¯´æ¸…æ¥šï¼Œæ˜¯æˆ‘çš„é”…å“ˆã€‚è¿™é‡Œå¹¿æ’­å˜é‡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œå…¶å®åˆ†ä¸¤ä¸ªæ­¥éª¤ï¼š\n\n1. å¹¿æ’­å˜é‡åˆ›å»ºï¼šç¬¬ä¸€ä¸ªæ˜¯Driverä»æ‰€æœ‰Executorsæ”¶é›†æ•°æ®ï¼Œæ„å»ºå¹¿æ’­å˜é‡ï¼Œä¹Ÿå°±æ˜¯å…¨é‡æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹Driveræ˜¯ç“¶é¢ˆï¼›\n\n2. å¹¿æ’­å˜é‡ä½¿ç”¨/è¯»å–ï¼šç¬¬äºŒä¸ªæ˜¯å„ä¸ªExecutorså†å»æ‹‰å–å¹¿æ’­å˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ç°åœ¨åªæœ‰TorrentBroadcastè¿™ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒExecutorsä¹‹é—´ç”¨ç±»ä¼¼â€œP2Pâ€çš„æ–¹å¼å»æ‹‰å–å¹¿æ’­å˜é‡çš„æ¯ä¸€ä¸ªblockã€‚ä¼˜å…ˆä»æœ¬æœºçš„å…¶ä»–Executorsæ‹‰å–ã€å…¶æ¬¡æœ¬Rackçš„å…¶ä»–æœºå™¨å»æ‹‰å–ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä»»åŠ¡æœ¬åœ°æ€§ï¼Œæ€»ä¹‹å¯¹äºtarget blockï¼Œç»™å®šblockåœ°å€åˆ—è¡¨ï¼ŒBlockManagerä¼šä¼˜å…ˆé€‰å–æ‹‰å–æˆæœ¬æœ€ä½çš„é‚£ä¸ªå»å°è¯•ã€‚ä¹‹æ‰€æœ‰è¯´æ˜¯ç±»ä¼¼â€œP2Pâ€ï¼ŒåŸå› åœ¨äºå®ƒæ‹‰å–çš„å½¢å¼æ˜¯P2Pï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆP2Påè®®ï¼Œè€Œæ˜¯åˆ©ç”¨BlockManageræ¥å®ç°å®šå‘æ‹‰å–ã€‚BlockManagerä»BlockManagerMasterè·å–ç›®æ ‡blockåœ°å€åˆ—è¡¨ï¼Œç„¶åæŒ‰ç…§åˆšåˆšè¯´çš„é¡ºåºï¼Œä¾æ¬¡å°è¯•æ‹‰å–Blockã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620797634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549032,"avatar":"","nickname":"Zzz","note":"","ucode":"9323254354868B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388741,"discussion_content":"æˆ‘è§‰å¾—è€å¸ˆè¿™å—åŸç†æ²¡æœ‰è°ƒæŸ¥æ¸…æ¥šï¼Œæ—¢ç„¶sparkç›®å‰æ”¯æŒexecutorä¹‹é—´å¯¹æ‹‰ï¼Œé‚£ä¹ˆdriverä¸ºä½•è¿˜è¦æ”¶é›†ï¼Œå®ƒä¸æ˜¯åªè¦ç»´æŠ¤ä¸€ä»½å…ƒæ•°æ®å°±è¡Œäº†ä¹ˆï¼Œä¸å¤Ÿåˆç†ï¼Œé“ç†è¯´ä¸é€š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628932276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2821687,"avatar":"","nickname":"huangjian01","note":"","ucode":"CF834272C1C64A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536047,"discussion_content":"ä½ å¾—å…ˆæœ‰æ•°æ®æ‰èƒ½å¯¹æ‹‰ï¼ŒDFå¿…é¡»è¢«è§£ææ‰è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638665674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290746,"user_name":"å°çµèŠ","can_delete":false,"product_type":"c1","uid":2071355,"ip_address":"","ucode":"6DCB7CF8D5A7F1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9b/3b/dc3f819f.jpg","comment_is_top":false,"comment_ctime":1619730533,"is_pvip":false,"replies":[{"id":"105416","content":"ä¸¾ä¸ªä¾‹å­å“ˆï¼Œæ¯”å¦‚ä½ çš„åˆ†åŒºæ•°ï¼Œæ˜¯é»˜è®¤çš„200ä¸ªã€‚é‚£ä¹ˆæ‹¿userId = &#39;é»„å°ä¹™&#39;æ¥è¯´ï¼Œå®ƒçš„å“ˆå¸Œå€¼å‡è®¾æ˜¯201ï¼Œé‚£ä¹ˆå¯¹200å–æ¨¡ï¼ˆæ•°å­¦è¿ç®—ï¼šmodã€moduloï¼‰å°±æ˜¯1ï¼Œé‚£ä¹ˆå‡¡æ˜¯userId = &#39;é»„å°ä¹™&#39;çš„æ•°æ®è®°å½•ï¼Œå°±éƒ½è¢«å­˜å‚¨åˆ°#1å·æ•°æ®åˆ†åŒºï¼Œå…¶ä»–userIdä»¥æ­¤ç±»æ¨ã€‚","user_name":"ä½œè€…å›å¤","comment_id":290746,"uid":"1043100","ip_address":"","utype":1,"ctime":1619862864,"user_name_real":"å´ç£Š"}],"discussion_count":0,"race_medal":0,"score":"1619730533","product_id":100073401,"comment_content":"â€œç¬¬ä¸€æ­¥å°±æ˜¯å¯¹å‚ä¸å…³è”çš„å·¦å³è¡¨åˆ†åˆ«è¿›è¡Œ Shuffleï¼ŒShuffle çš„åˆ†åŒºè§„åˆ™æ˜¯å…ˆå¯¹ Join keys è®¡ç®—å“ˆå¸Œå€¼ï¼Œå†æŠŠå“ˆå¸Œå€¼å¯¹åˆ†åŒºæ•°å–æ¨¡ã€‚ç”±äºå·¦å³è¡¨çš„åˆ†åŒºæ•°æ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤ Shuffle è¿‡åï¼Œä¸€å®šèƒ½å¤Ÿä¿è¯ userID ç›¸åŒçš„äº¤æ˜“è®°å½•å’Œç”¨æˆ·æ•°æ®åè½åœ¨åŒä¸€ä¸ª Executors å†…ã€‚â€<br><br>è€å¸ˆè¯·é—®ä»€ä¹ˆå«å§å“ˆå¸Œå€¼å¯¹åˆ†åŒºå–æ¨¡ï¼Ÿå–æ¨¡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br><br>æå‰æ„Ÿè°¢~","like_count":0},{"had_liked":false,"id":288871,"user_name":"ä¸ƒ","can_delete":false,"product_type":"c1","uid":1078874,"ip_address":"","ucode":"4C3CCC276D0B68","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/5a/4393d800.jpg","comment_is_top":false,"comment_ctime":1618740899,"is_pvip":false,"replies":[{"id":"104855","content":"Data Sourceçš„å¹¶è¡Œåº¦ï¼Œå–å†³äºåˆ†å¸ƒå¼æ–‡ä»¶æœ¬èº«ï¼Œæ¯”å¦‚HDFSæ–‡ä»¶ç³»ç»Ÿä¸­çš„æºæ•°æ®ï¼Œå®ƒæœ¬èº«çš„å¹¶è¡Œåº¦ï¼Œå°±æ˜¯Sparkæ„å»ºçš„HadoopRDDçš„åˆå§‹å¹¶è¡Œåº¦ã€‚æ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨HDFSæœ‰1204ä¸ªåˆ†ç‰‡ï¼Œé‚£ä¹ˆæœ‰å®ƒæ„å»ºçš„HadoopRDDçš„åˆå§‹å¹¶è¡Œåº¦ï¼Œå°±æ˜¯1024ã€‚<br><br>è¿™ä¸€ç‚¹ï¼Œé€šè¿‡Spark UIä¹Ÿå¯ä»¥çœ‹å‡ºæ¥å“ˆ~ æ¯”å¦‚ä½ åœ¨æ‰§è¡Œæ•°æ®æºè¯»å–çš„æ—¶å€™ï¼Œå‘ç°Spark UIä¸Šæ˜¾ç¤ºï¼šâ€œ238&#47;1024â€ï¼Œè¿™æ„å‘³ç€ä½ çš„æºæ•°æ®æœ‰1024ä¸ªåˆ†ç‰‡ï¼ŒSparkæ€»å…±éœ€è¦1024ä¸ªtaskæ¥å®Œæˆæ•°æ®è¯»å–ï¼Œå…¶ä¸­å·²ç»å®Œæˆäº†238ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸè¯»å–äº†238ä¸ªåˆ†åŒºæ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","comment_id":288871,"uid":"1043100","ip_address":"","utype":1,"ctime":1618759522,"user_name_real":"å´ç£Š"}],"discussion_count":1,"race_medal":0,"score":"1618740899","product_id":100073401,"comment_content":"è€å¸ˆï¼Œé—®ä¸€ä¸‹ ä»hdfsåŠ è½½parquetæ–‡ä»¶æ—¶ï¼Œä¾‹å¦‚spark.read.parquet(&quot;xx&quot;)ï¼Œæ˜¯æ€ä¹ˆç¡®å®šåˆ†åŒºæ•°çš„å‘¢ï¼Ÿé˜…è¯»æºç DataFrameReaderæ²¡æœ‰æ‰¾åˆ°ç›¸å…³é…ç½®ï¼Œå¸Œæœ›è€å¸ˆç»™æŒ‡æ¡è·¯ï¼Œè§£ç­”ä¸€ä¸‹ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518756,"discussion_content":"Data Sourceçš„å¹¶è¡Œåº¦ï¼Œå–å†³äºåˆ†å¸ƒå¼æ–‡ä»¶æœ¬èº«ï¼Œæ¯”å¦‚HDFSæ–‡ä»¶ç³»ç»Ÿä¸­çš„æºæ•°æ®ï¼Œå®ƒæœ¬èº«çš„å¹¶è¡Œåº¦ï¼Œå°±æ˜¯Sparkæ„å»ºçš„HadoopRDDçš„åˆå§‹å¹¶è¡Œåº¦ã€‚æ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨HDFSæœ‰1204ä¸ªåˆ†ç‰‡ï¼Œé‚£ä¹ˆæœ‰å®ƒæ„å»ºçš„HadoopRDDçš„åˆå§‹å¹¶è¡Œåº¦ï¼Œå°±æ˜¯1024ã€‚\n\nè¿™ä¸€ç‚¹ï¼Œé€šè¿‡Spark UIä¹Ÿå¯ä»¥çœ‹å‡ºæ¥å“ˆ~ æ¯”å¦‚ä½ åœ¨æ‰§è¡Œæ•°æ®æºè¯»å–çš„æ—¶å€™ï¼Œå‘ç°Spark UIä¸Šæ˜¾ç¤ºï¼šâ€œ238/1024â€ï¼Œè¿™æ„å‘³ç€ä½ çš„æºæ•°æ®æœ‰1024ä¸ªåˆ†ç‰‡ï¼ŒSparkæ€»å…±éœ€è¦1024ä¸ªtaskæ¥å®Œæˆæ•°æ®è¯»å–ï¼Œå…¶ä¸­å·²ç»å®Œæˆäº†238ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸè¯»å–äº†238ä¸ªåˆ†åŒºæ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618759522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288380,"user_name":"è¾°","can_delete":false,"product_type":"c1","uid":2172635,"ip_address":"","ucode":"2E898EAC5AA141","user_header":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","comment_is_top":false,"comment_ctime":1618449673,"is_pvip":false,"replies":[{"id":"104696","content":"è¿™äº›å‚æ•°ä¹‹é—´çš„å…³ç³»å’Œè®¾ç½®ï¼Œå…¶å®æˆ‘ä»¬åœ¨é…ç½®é¡¹é‚£ä¸¤è®²æœ‰è¿‡è¯¦ç»†çš„å±•å¼€å“ˆ~ å…³äºå¹¿æ’­é˜ˆå€¼çš„é—®é¢˜ï¼Œå°±æˆ‘çš„ç»éªŒï¼Œå¹³æ—¶å·¥ä½œä¸­ï¼Œ2GBå·¦å³ï¼Œæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›å‚æ•°çš„è®¾ç½®ï¼Œéƒ½æ²¡æœ‰ç»å¯¹å€¼ï¼Œå¦åˆ™å’±ä»¬å°±ä¸éœ€è¦è°ƒä¼˜äº†ï¼Œå¤§å®¶éƒ½ç”¨ä¸€å¥—ç»å¯¹å€¼å°±å¥½äº†ã€‚å°±æ˜¯å› ä¸ºå¤§å®¶çš„åœºæ™¯ã€éƒ¨ç½²ã€æƒ…å†µå„è‡ªä¸åŒï¼Œæ‰€ä»¥æ‰éœ€è¦è°ƒä¼˜ï¼Œè€Œè°ƒä¼˜çš„åŸåˆ™ï¼Œå°±å¯ä»¥followé…ç½®é¡¹é‚£ä¸¤è®²å»æ“ä½œã€‚<br><br>æ¯”å¦‚ä½ ç°åœ¨è®©æˆ‘ç»™å‡ºä¸€ä¸ªæœ€ä½³ç»„åˆï¼Œå…¶å®è¿™ä¸ªå‘½é¢˜æ˜¯ä¸æˆç«‹çš„ï¼Œå› ä¸ºä½ éœ€è¦ç»™å®šä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘æ‰èƒ½å…·ä½“è¯´ä¸€ä¸ªä»€ä¹ˆæ ·çš„ä½œä¸šï¼Œåœ¨ä½ çš„éƒ¨ç½²ä¸‹ï¼Œæœ€ä½³çš„é…ç½®ç»„åˆæ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥ï¼Œè°ƒä¼˜ï¼Œæ˜¯ä»¥åœºæ™¯ä¸ºåŸºç¡€çš„å“ˆï¼Œä¹Ÿå°±æ˜¯å’±ä»¬åªèƒ½å°±äº‹è®ºäº‹ï¼Œä½†è¿™ä¸ä»£è¡¨æˆ‘ä»¬å°±æ˜¯çè’™ï¼Œç›¸åï¼Œæˆ‘ä»¬è®¾ç½®ä¸åŒçš„å‚æ•°ç»„åˆæ˜¯åŸºäºä¸€äº›åŸºæœ¬åŸåˆ™çš„ï¼Œè€Œè¿™äº›åŸåˆ™ï¼Œå°±æ˜¯é…ç½®é¡¹é‚£ä¸¤è®²çš„å†…å®¹æ‰€åœ¨~","user_name":"ä½œè€…å›å¤","comment_id":288380,"uid":"1043100","ip_address":"","utype":1,"ctime":1618485689,"user_name_real":"å´ç£Š"}],"discussion_count":2,"race_medal":0,"score":"1618449673","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œé—®é¢˜ä¸€å’Œé—®é¢˜äºŒæœ‰æ²¡æœ‰ä¸€ç§çŸ›ç›¾åœ¨é‡Œé¢ï¼Œé—®é¢˜ä¸€æ˜¯æ•°æ®é‡å¤§ï¼Œå¦‚ä½•ä½¿ç”¨å¹¿æ’­ï¼Œé—®é¢˜äºŒæˆ‘çŸ¥é“çš„æ˜¯ï¼Œå½“joinçš„è¡¨æ•°æ®é‡éƒ½å¾ˆå¤§æ—¶å°±ä¸é€‚åˆå¹¿æ’­äº†ï¼Œä¸€æ˜¯å› ä¸ºç½‘ç»œå¼€é”€ï¼ŒäºŒæ˜¯å› ä¸ºexecutorå†…å­˜ä¸å¤Ÿå¤§ä¸è¶³ä»¥å­˜å‚¨å¤§æ•°æ®é‡ï¼Œè¿˜æœ‰è€å¸ˆï¼Œèƒ½ä¸èƒ½è¯´ä¸€ä¸‹å¹¿æ’­çš„é˜ˆå€¼å¤šå°‘åˆé€‚ï¼Œè¿™ä¸ªå’Œå…¶ä»–çš„å‚æ•°ä¹Ÿæœ‰å…³ç³»ï¼Œæ¯”å¦‚æ•´ä½“çš„å‚æ•°å¦‚ä½•è®¾ç½®ï¼Œèƒ½ä¸èƒ½è®²ä¸€ä¸‹ï¼Œexecutoræ•°é‡ï¼Œcoreçš„æ•°é‡ï¼Œåˆ†åŒºå¤§å°ä»¥åŠå†…å­˜å¤§å°è®¾ç½®","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518609,"discussion_content":"è¿™äº›å‚æ•°ä¹‹é—´çš„å…³ç³»å’Œè®¾ç½®ï¼Œå…¶å®æˆ‘ä»¬åœ¨é…ç½®é¡¹é‚£ä¸¤è®²æœ‰è¿‡è¯¦ç»†çš„å±•å¼€å“ˆ~ å…³äºå¹¿æ’­é˜ˆå€¼çš„é—®é¢˜ï¼Œå°±æˆ‘çš„ç»éªŒï¼Œå¹³æ—¶å·¥ä½œä¸­ï¼Œ2GBå·¦å³ï¼Œæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›å‚æ•°çš„è®¾ç½®ï¼Œéƒ½æ²¡æœ‰ç»å¯¹å€¼ï¼Œå¦åˆ™å’±ä»¬å°±ä¸éœ€è¦è°ƒä¼˜äº†ï¼Œå¤§å®¶éƒ½ç”¨ä¸€å¥—ç»å¯¹å€¼å°±å¥½äº†ã€‚å°±æ˜¯å› ä¸ºå¤§å®¶çš„åœºæ™¯ã€éƒ¨ç½²ã€æƒ…å†µå„è‡ªä¸åŒï¼Œæ‰€ä»¥æ‰éœ€è¦è°ƒä¼˜ï¼Œè€Œè°ƒä¼˜çš„åŸåˆ™ï¼Œå°±å¯ä»¥followé…ç½®é¡¹é‚£ä¸¤è®²å»æ“ä½œã€‚\n\næ¯”å¦‚ä½ ç°åœ¨è®©æˆ‘ç»™å‡ºä¸€ä¸ªæœ€ä½³ç»„åˆï¼Œå…¶å®è¿™ä¸ªå‘½é¢˜æ˜¯ä¸æˆç«‹çš„ï¼Œå› ä¸ºä½ éœ€è¦ç»™å®šä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘æ‰èƒ½å…·ä½“è¯´ä¸€ä¸ªä»€ä¹ˆæ ·çš„ä½œä¸šï¼Œåœ¨ä½ çš„éƒ¨ç½²ä¸‹ï¼Œæœ€ä½³çš„é…ç½®ç»„åˆæ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥ï¼Œè°ƒä¼˜ï¼Œæ˜¯ä»¥åœºæ™¯ä¸ºåŸºç¡€çš„å“ˆï¼Œä¹Ÿå°±æ˜¯å’±ä»¬åªèƒ½å°±äº‹è®ºäº‹ï¼Œä½†è¿™ä¸ä»£è¡¨æˆ‘ä»¬å°±æ˜¯çè’™ï¼Œç›¸åï¼Œæˆ‘ä»¬è®¾ç½®ä¸åŒçš„å‚æ•°ç»„åˆæ˜¯åŸºäºä¸€äº›åŸºæœ¬åŸåˆ™çš„ï¼Œè€Œè¿™äº›åŸåˆ™ï¼Œå°±æ˜¯é…ç½®é¡¹é‚£ä¸¤è®²çš„å†…å®¹æ‰€åœ¨~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618485689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2172635,"avatar":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","nickname":"è¾°","note":"","ucode":"2E898EAC5AA141","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368001,"discussion_content":"è¿™ä¸ªæˆ‘ç†è§£å‚æ•°æ²¡æœ‰å”¯ä¸€ï¼Œå› ä¸ºä½ è¯´çš„å¹¿æ’­é˜ˆå€¼2gæ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œå°±æ¯”å¦‚å¯¹åº”çš„è¿è¡Œå†…å­˜åº”è¯¥å¤šå°‘å‘¢ï¼Œå› ä¸ºæˆ‘å¹¿æ’­ç”¨çš„500å…†å·¦å³ï¼Œå†å¾€ä¸ŠåŠ å®¹æ˜“æŠ¥é”™ï¼Œç±»ä¼¼äºå†…å­˜æº¢å‡ºä¹‹ç±»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618536072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287493,"user_name":"Jack","can_delete":false,"product_type":"c1","uid":1297112,"ip_address":"","ucode":"F3863DAEF449D5","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/d8/b109ed85.jpg","comment_is_top":false,"comment_ctime":1617977118,"is_pvip":true,"replies":[{"id":"104436","content":"æ€è€ƒçš„å¾ˆæ·±å…¥ï¼Œå…ˆèµä¸€ä¸ªï½ æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œshuffleåˆ†å‘çš„ï¼Œæ˜¯éƒ¨åˆ†æ•°æ®ã€‚å¹¿æ’­åˆ†å‘çš„ï¼Œæ˜¯å…¨é‡æ•°æ®ã€‚å½“ç„¶ï¼Œåƒä½ è¯´çš„ï¼Œå¹¿æ’­çš„ç²’åº¦å¤§ï¼Œæ˜¯executor levelã€‚shuffleç²’åº¦å°ï¼Œæ˜¯task levelã€‚å¦‚æœå…¨é‡æ•°æ®å¾ˆå¤§ï¼Œå³ä½¿èƒ½å¡è¿›å¹¿æ’­å˜é‡ï¼Œå³ä¾¿æ˜¯executorç²’åº¦ï¼Œæˆ‘è§‰å¾—å®ƒçš„å¼€é”€ï¼Œä¹Ÿè¿œå¤§äºå®ƒçš„æ”¶ç›Šï¼Œç”šè‡³è¿˜æœ‰driverç«¯oomçš„é£é™©ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µï¼Œè¿˜ä¸å¦‚é‡‡ç”¨shuffle joinã€‚ å½“ç„¶ï¼Œè¿™ä¹ˆè¯´æ¯”è¾ƒç¬¼ç»Ÿï¼Œå¹¶æ²¡æœ‰ç²¾ç¡®çš„å¼€é”€å’Œæ”¶ç›Šçš„è®¡ç®—ã€‚è¿™é‡Œå…¶å®æ›´å¤šçš„ï¼Œæ˜¯æƒ³å¼ºè°ƒå¹¿æ’­ä¸æ˜¯é“¶å¼¹ï¼Œä¸è¦æ»¥ç”¨å¹¿æ’­ã€‚","user_name":"ä½œè€…å›å¤","comment_id":287493,"uid":"1043100","ip_address":"","utype":1,"ctime":1618056553,"user_name_real":"å´ç£Š"}],"discussion_count":4,"race_medal":0,"score":"1617977118","product_id":100073401,"comment_content":"è€å¸ˆï¼Œç¬¬2é¢˜@Bennançš„å›ç­”æœ‰ç–‘æƒ‘ã€‚ä¸ºä»€ä¹ˆå½“ä¸¤ä¸ªéœ€è¦joinçš„æ•°æ®é›†éƒ½å¾ˆå¤§æ—¶ï¼Œbroadcast joinä¼šè¶…å‡ºshuffle joinéœ€è¦ä¼ è¾“çš„æ•°æ®ã€‚<br>å‡è®¾æœ‰Aï¼ŒBä¸¤è¡¨ï¼Œå„è‡ªå¤§å°éƒ½æ˜¯100Gï¼Œæœ‰4ä¸ªexecutorï¼Œæ¯ä¸ªexecutoræœ‰4ä¸ªtaskå¯¹åº”4ä¸ªåˆ†åŒºï¼Œæ€»å…±16ä¸ªtaskã€‚ï¼ŒæŠŠshuffleçš„è¿‡ç¨‹ç”¨äºŒåˆ†å›¾åˆ»ç”»ï¼Œä¸¤è¾¹éƒ½å„è‡ªæœ‰16ä¸ªé¡¶ç‚¹ï¼Œè¾¹æœ‰16*16æ¡ã€‚<br>å¯¹äºshuffle joinï¼Œå‡è®¾shuffleå‰ååˆ†åŒºä¸ªæ•°ä¸å˜ï¼Œæ¯ä¸ªtaskéœ€è¦å»å…¶ä»–12ä¸ªtaskï¼ˆæœ‰3ä¸ªtaskå’Œè‡ªå·±åœ¨åŒä¸€ä¸ªexecutorä¸Šï¼‰æ‹‰å–æ•°æ®ï¼ŒæŠŠshuffleçš„è¿‡ç¨‹çœ‹åšæ˜¯äºŒåˆ†å›¾ï¼Œä¸¤è¾¹éƒ½å„è‡ªæœ‰16ä¸ªé¡¶ç‚¹ï¼Œè¾¹æœ‰16*16æ¡ï¼ˆtaskåˆ°taskï¼‰ã€‚<br>å¯¹äºbroadcast joinï¼Œdriverä»å„ä¸ªåˆ†åŒºè·å–æ•°æ®ï¼Œæœ‰16æ¡ä»åˆ†åŒºåˆ°driverçš„è¾¹ï¼ˆç›¸å½“äº16æ¡taskåˆ°taskçš„è¾¹ï¼‰ï¼Œç„¶ådriverå¹¿æ’­ç»™å„ä¸ªexecutorï¼Œæ€»å…±æœ‰4æ¡driveråˆ°executorçš„è¾¹ã€‚<br>broadcast joinçš„ç²’åº¦æ˜¯executorï¼Œshuffleçš„ç²’åº¦æ˜¯taskï¼Œæ„Ÿè§‰è¿˜æ˜¯broadcast joinçš„æ•°æ®å°‘ä¸€ç‚¹ã€‚å› ä¸ºåŒä¸€ä»½æ•°æ®ï¼Œå³ä½¿ä¸¤ä¸ªtaskåœ¨åŒä¸€ä¸ªexecutorï¼Œå¯¹äºshuffleï¼Œè¿˜æ˜¯ä¼šåœ¨åŒä¸€ä¸ªexecutorä¸Šæœ‰ä¸¤ä»½ç›¸åŒçš„æ•°æ®ï¼Œè€Œbroadcastï¼Œåœ¨ä¸€ä¸ªexecutorä¸Šåªæœ‰ä¸€ä»½æ•°æ®ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518324,"discussion_content":"æ€è€ƒçš„å¾ˆæ·±å…¥ï¼Œå…ˆèµä¸€ä¸ªï½ æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œshuffleåˆ†å‘çš„ï¼Œæ˜¯éƒ¨åˆ†æ•°æ®ã€‚å¹¿æ’­åˆ†å‘çš„ï¼Œæ˜¯å…¨é‡æ•°æ®ã€‚å½“ç„¶ï¼Œåƒä½ è¯´çš„ï¼Œå¹¿æ’­çš„ç²’åº¦å¤§ï¼Œæ˜¯executor levelã€‚shuffleç²’åº¦å°ï¼Œæ˜¯task levelã€‚å¦‚æœå…¨é‡æ•°æ®å¾ˆå¤§ï¼Œå³ä½¿èƒ½å¡è¿›å¹¿æ’­å˜é‡ï¼Œå³ä¾¿æ˜¯executorç²’åº¦ï¼Œæˆ‘è§‰å¾—å®ƒçš„å¼€é”€ï¼Œä¹Ÿè¿œå¤§äºå®ƒçš„æ”¶ç›Šï¼Œç”šè‡³è¿˜æœ‰driverç«¯oomçš„é£é™©ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µï¼Œè¿˜ä¸å¦‚é‡‡ç”¨shuffle joinã€‚ å½“ç„¶ï¼Œè¿™ä¹ˆè¯´æ¯”è¾ƒç¬¼ç»Ÿï¼Œå¹¶æ²¡æœ‰ç²¾ç¡®çš„å¼€é”€å’Œæ”¶ç›Šçš„è®¡ç®—ã€‚è¿™é‡Œå…¶å®æ›´å¤šçš„ï¼Œæ˜¯æƒ³å¼ºè°ƒå¹¿æ’­ä¸æ˜¯é“¶å¼¹ï¼Œä¸è¦æ»¥ç”¨å¹¿æ’­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618056553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181606,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/a6/662bcc6b.jpg","nickname":"æ¥ä¸–æ„¿åšå‹äºº A","note":"","ucode":"EF20966B0F27E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366418,"discussion_content":"æ²¡æœ‰ä¸¤ä»½æ•°æ®ä¹‹è¯´å§ï¼Œå¯¹äº shuffle join ä¸åŒçš„ task æ‹‰å–çš„å°±æ˜¯ä¸åŒçš„ map åˆ†åŒºã€‚æ‰€ä»¥ reduce ç«¯è‚¯å®šåªæœ‰ä¸€ä»½å§ã€‚è€Œ broadcast æ˜¯ä¸€ä¸ª executor ä¸€ä»½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618056898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366416,"discussion_content":"æˆ‘åŒæ„è¿™ç§è¯´æ³•\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618056646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1265135,"avatar":"","nickname":"licl1008","note":"","ucode":"6467D6DB97A00A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366362,"discussion_content":"shuffleåªè¦ä¼ ä¸€éƒ¨åˆ† è€Œbroadcastæ˜¯ä¼ å…¨é‡å§ è¿™æ˜¯æˆ‘ä¸ªäººç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618043114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287482,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1617969637,"is_pvip":false,"replies":[{"id":"104434","content":"æ˜¯çš„ï¼Œä»¥å°åšå¤§","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618055992,"ip_address":"","comment_id":287482,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1617969637","product_id":100073401,"comment_content":"åŸæ¥å°è¡¨å’Œå¤§è¡¨joinæ˜¯èŠ‚çœäº†å¤§è¡¨çš„shuffleï¼Œä¸ç„¶å¤§è¡¨åªèƒ½æ ¹æ®joinçš„åˆ—åœ¨æ‰€æœ‰æœºå™¨ä¸Šé‡æ–°åˆ†å¸ƒä¸€éï¼Œç°åœ¨æ‡‚äº†","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518320,"discussion_content":"æ˜¯çš„ï¼Œä»¥å°åšå¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618055992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287472,"user_name":"ğŸš¤","can_delete":false,"product_type":"c1","uid":1460463,"ip_address":"","ucode":"95D7F773789B74","user_header":"https://static001.geekbang.org/account/avatar/00/16/48/ef/4750cb14.jpg","comment_is_top":false,"comment_ctime":1617965268,"is_pvip":false,"replies":[{"id":"104435","content":"codeå…¶å®æœ‰ï¼Œä½†æ˜¯å°±æˆ‘ç†è§£ï¼Œå‡ºäºå„ç§åŸå› ï¼Œå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒç»™Jackçš„å›å¤å“ˆï½","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618056087,"ip_address":"","comment_id":287472,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1617965268","product_id":100073401,"comment_content":"Executorç«¯çš„Broadcastè¿™ä¸ªåŠŸèƒ½ï¼Œç›®å‰çš„sparkç‰ˆæœ¬æ˜¯ä¸æ˜¯æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½å‘€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518318,"discussion_content":"codeå…¶å®æœ‰ï¼Œä½†æ˜¯å°±æˆ‘ç†è§£ï¼Œå‡ºäºå„ç§åŸå› ï¼Œå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒç»™Jackçš„å›å¤å“ˆï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618056087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}