{"id":96340,"title":"31 | 认识观察者模式KVO并展示页面加载进度","content":"<p><strong>PDF 课件和源代码下载地址：</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geektime-ios-course\">https://gitee.com/geektime-geekbang/geektime-ios-course</a></p>","comments":[{"had_liked":false,"id":133190,"user_name":"VZ","can_delete":false,"product_type":"c3","uid":1120681,"ip_address":"","ucode":"63D7745CED2CDC","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/a9/e019cea3.jpg","comment_is_top":false,"comment_ctime":1568439261,"is_pvip":false,"replies":[{"id":51089,"content":"加油！","user_name":"作者回复","user_name_real":"朱德权","uid":1041455,"ctime":1568508265,"ip_address":"","comment_id":133190,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师讲得太好了。老师可以再出一门进阶的课程，继续订阅。","like_count":3,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467288,"discussion_content":"加油！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568508265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117692,"user_name":"cyzjnu","can_delete":false,"product_type":"c3","uid":1609391,"ip_address":"","ucode":"FE83C7C4C304B9","user_header":"https://static001.geekbang.org/account/avatar/00/18/8e/af/d225f059.jpg","comment_is_top":false,"comment_ctime":1564112093,"is_pvip":false,"replies":[{"id":43114,"content":"File - Open Quickly 快捷键就是Shift + Commend + O,可以快速的搜索类或者函数","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1564116302,"ip_address":"","comment_id":117692,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，那个查看信息进度以及打印出NSKeyValueChangeDictionary,是怎么按出来的呀","like_count":3,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460087,"discussion_content":"File - Open Quickly 快捷键就是Shift + Commend + O,可以快速的搜索类或者函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564116302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176449,"user_name":"乐只君子","can_delete":false,"product_type":"c3","uid":1317994,"ip_address":"","ucode":"DBBDB0AB9474C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/6a/988ad74a.jpg","comment_is_top":false,"comment_ctime":1581062495,"is_pvip":false,"replies":[{"id":74587,"content":"对于Frame来说，你理解的没有问题，如果我们设置OriginY=0，那么应该被导航条盖住。实际上如果加断点或者使用xcode自带的debug view hierarchy, 就会发现WKWebView也确实在导航条下面。那么为什么我们看起来wkwebview没有被遮挡呢。因为wkwebview本身渲染在scrollView上。对于scrollView来说，我们可以设置contentInset来调节它内部内容的位置，可以加断点看下，虽然此时wkwebview的OriginY是0，但是它的contentInset不为0，所以它虽然在导航条下，但是内容因为有inset所以没有被遮挡。那么为什么wkwebview中scrollView的contentInset不为0，且默认有准确的数字呢？是因为在iOS11系统为UIScrollView引入了contentInsetAdjustmentBehavior 这样一个属性，默认系统会为所有的scrollView设置默认的inset。如果我们不需要这个特性，可以增加self.webView.scrollView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever; 这样你会发现整体的表现就符合你的预期了。contentInsetAdjustmentBehavior这个属性一般在使用frame布局的项目中，也都默认设置成UIScrollViewContentInsetAdjustmentNever。","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1585381894,"ip_address":"","comment_id":176449,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"搞懵了，WKWebView x: 0, y: 0, width: self.view.bounds.width, height: self.view.bounds.height 没被导航条盖住。UIProgressView x: 0, y: 0, width: self.view.bounds.width, height: 20 却被导航条挡住了。\n为啥啊？模拟器 iPhone 6s iOS 10.3.1","like_count":2,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483110,"discussion_content":"对于Frame来说，你理解的没有问题，如果我们设置OriginY=0，那么应该被导航条盖住。实际上如果加断点或者使用xcode自带的debug view hierarchy, 就会发现WKWebView也确实在导航条下面。那么为什么我们看起来wkwebview没有被遮挡呢。因为wkwebview本身渲染在scrollView上。对于scrollView来说，我们可以设置contentInset来调节它内部内容的位置，可以加断点看下，虽然此时wkwebview的OriginY是0，但是它的contentInset不为0，所以它虽然在导航条下，但是内容因为有inset所以没有被遮挡。那么为什么wkwebview中scrollView的contentInset不为0，且默认有准确的数字呢？是因为在iOS11系统为UIScrollView引入了contentInsetAdjustmentBehavior 这样一个属性，默认系统会为所有的scrollView设置默认的inset。如果我们不需要这个特性，可以增加self.webView.scrollView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever; 这样你会发现整体的表现就符合你的预期了。contentInsetAdjustmentBehavior这个属性一般在使用frame布局的项目中，也都默认设置成UIScrollViewContentInsetAdjustmentNever。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585381894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1876931,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/txSaX2pa3CQ6m9cFRGda2JTlcMS53IbyQESz4EoIEAywHwBCH8WcZTymOSt4oSguSk5DQmISjR5KqZGBicfWw5g/132","nickname":"华哥506","note":"","ucode":"5314BF42F25DA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197980,"discussion_content":"6S导航栏高度是44，设置y为0肯定会被挡住的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583459827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110022,"user_name":"起风了001","can_delete":false,"product_type":"c3","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1562152227,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师在视频里提到的KVO的一些优化方法, 我写了一篇文章帮助大家更深入理解. 系统的KVO真的是不好用, 有很多导致crash的场景, 一般还是不要直接使用好, 可以使用我下面的方法来处理.\nhttp:&#47;&#47;blog.cocosdever.com&#47;2019&#47;07&#47;03&#47;Let-the-system-s-kvo-also-support-block","like_count":4},{"had_liked":false,"id":306747,"user_name":"omitchen","can_delete":false,"product_type":"c3","uid":1571798,"ip_address":"","ucode":"38517395BB7A74","user_header":"https://static001.geekbang.org/account/avatar/00/17/fb/d6/e0fc5252.jpg","comment_is_top":false,"comment_ctime":1628690224,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"刘海屏 y 设置 88 是显示不出来的，需要设到90以上","like_count":1},{"had_liked":false,"id":302887,"user_name":"Geek_98wavm","can_delete":false,"product_type":"c3","uid":2621085,"ip_address":"","ucode":"F8994CE6184B49","user_header":"","comment_is_top":false,"comment_ctime":1626422279,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"为啥我的iPhone11模拟器。progressView = UIProgressView(frame: CGRect(x: 0, y: 88, width: view.frame.size.width, height: 20))也会显示不出来。老师的就能显示出来","like_count":1,"discussions":[{"author":{"id":2076600,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/af/b8/458866d3.jpg","nickname":"Bo","note":"","ucode":"D5DD3300310C02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386370,"discussion_content":"把y设置大一点","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627551965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332634,"user_name":"the sword the god","can_delete":false,"product_type":"c3","uid":1471307,"ip_address":"","ucode":"07DA7A167FA32A","user_header":"https://static001.geekbang.org/account/avatar/00/16/73/4b/0b74915a.jpg","comment_is_top":false,"comment_ctime":1643426431,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"把进度条的addSubView放到webView的addSubView下面去，进度条就能显示出来啦。应该是后加的层级更高一点。","like_count":0},{"had_liked":false,"id":302886,"user_name":"Geek_98wavm","can_delete":false,"product_type":"c3","uid":2621085,"ip_address":"","ucode":"F8994CE6184B49","user_header":"","comment_is_top":false,"comment_ctime":1626422253,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"为啥我的iPhone11模拟器","like_count":0},{"had_liked":false,"id":257697,"user_name":"用户","can_delete":false,"product_type":"c3","uid":2266972,"ip_address":"","ucode":"52D639FB1ABCE7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6XOX1f5g3RJFznbPQdO4j1iaRISEVR6Xn4BviaehPOoqAjfrDswIIsaKPA5DNs9iaHeG3tCGd1icbNQ/132","comment_is_top":false,"comment_ctime":1604066537,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"进度条高度为20，为什么看上去还这么窄呢？","like_count":0}]}