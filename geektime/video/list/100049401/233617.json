{"id":233617,"title":"31 | 实战演练（一）：项目准备和构建过程","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-servicemesh\">https://gitee.com/geektime-geekbang/geektime-servicemesh</a></p>","comments":[{"had_liked":false,"id":258421,"user_name":"无需昵称","can_delete":false,"product_type":"c3","uid":1686247,"ip_address":"","ucode":"CD0C2D8E611C32","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIuhXBviaVUj8PEIoAjdmnMMUkzI1xVUvxm2icu3DWkszjmLVkXjKGF2RpAER8ztklyVhTCTvnxxfgQ/132","comment_is_top":false,"comment_ctime":1604419600,"is_pvip":false,"replies":[{"id":94503,"content":"flux只是监控你的repo变化，同步你的修改；具体的ns是你自己在helm 里面控制的，它只是自动帮你apply一下而已。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1604981795,"ip_address":"","comment_id":258421,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，Flux是怎么知道我们要sync到哪个name space下去呢？这个部分在什么地方配置呢？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508648,"discussion_content":"flux只是监控你的repo变化，同步你的修改；具体的ns是你自己在helm 里面控制的，它只是自动帮你apply一下而已。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604981795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247266,"user_name":"gaofubin","can_delete":false,"product_type":"c3","uid":1158526,"ip_address":"","ucode":"325639D4D6DB51","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoib2DhicgRJicgJplnlXjAEwXDBvAvcYkBS1MQQVgL84mrgrvEtH58uU2cicpxbbIQ9qhD6VM2plXYWA/132","comment_is_top":false,"comment_ctime":1599643330,"is_pvip":false,"replies":[{"id":91193,"content":"我记得好像是没法在一个Operator支持多个repo，可以去官网文档看看。\n另外，100个应用我理解应该是由各自的团队负责，如果统一由一个flux去管理就显得不合理了。我个人觉得flux更适合共享资源的发布，比如mesh的配置。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1600061326,"ip_address":"","comment_id":247266,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"请教下，flux operator 1个项目配置1个git repo， 如果我有100个应用，这块flux该如何配置呢？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505358,"discussion_content":"我记得好像是没法在一个Operator支持多个repo，可以去官网文档看看。\n另外，100个应用我理解应该是由各自的团队负责，如果统一由一个flux去管理就显得不合理了。我个人觉得flux更适合共享资源的发布，比如mesh的配置。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600061326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222508,"user_name":"小猪","can_delete":false,"product_type":"c3","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1590823518,"is_pvip":false,"replies":[{"id":82052,"content":"优秀！","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1590836883,"ip_address":"","comment_id":222508,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"我终于把flux连接本地私有gitlab服务的配置方法做好啦！","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496822,"discussion_content":"优秀！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590836883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1333523,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/13/ff6f3ed5.jpg","nickname":"王章涛","note":"","ucode":"6EC55EC116A58D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366186,"discussion_content":"请问您flux连接本地仓库是怎么做的啊 谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617976924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2072091,"avatar":"","nickname":"杨永新","note":"","ucode":"395163C9A780D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304884,"discussion_content":"请问您flux连接本地仓库是怎么做的啊 谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599706244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221649,"user_name":"小猪","can_delete":false,"product_type":"c3","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1590558503,"is_pvip":false,"replies":[{"id":81818,"content":"Deploy key 配的对吗？看上去是没有权限访问仓库","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1590641241,"ip_address":"","comment_id":221649,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，我运行fluxctl同步，报错如下，请问这个错误是什么情况？没搜索到解决方案呢！实验进行不下去了！\n[root@ph ~]# fluxctl sync --k8s-fwd-ns flux\nError: git repository ssh:&#47;&#47;git@10.46.1.16&#47;yq&#47;fluxtest.git is not ready to sync\n\nFull error message: git clone --mirror: fatal: Could not read from remote repository., full output:\n Cloning into bare repository &#39;&#47;tmp&#47;flux-gitclone182994097&#39;...\nNo ECDSA host key is known for 10.46.1.16 and you have requested strict checking.\nHost key verification failed.\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n\nRun &#39;fluxctl sync --help&#39; for usage.\n[root@ph ~]# ","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496521,"discussion_content":"Deploy key 配的对吗？看上去是没有权限访问仓库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590641241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1333523,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/13/ff6f3ed5.jpg","nickname":"王章涛","note":"","ucode":"6EC55EC116A58D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365999,"discussion_content":"我遇到同样的问题，请问是什么解决的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617937952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1333523,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/13/ff6f3ed5.jpg","nickname":"王章涛","note":"","ucode":"6EC55EC116A58D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366823,"discussion_content":"我是用的账号密码，https://docs.fluxcd.io/en/1.22.1/guides/use-git-https/，老师的哪个是不是只使用与github","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618199986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595855,"avatar":"https://static001.geekbang.org/account/avatar/00/18/59/cf/168ac16d.jpg","nickname":"李俊-John","note":"","ucode":"AE9056C59D60D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295168,"discussion_content":"遇到同样的问题，请问是什么解决的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596107970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201662,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","nickname":"小猪","note":"","ucode":"EAD6A4876CEF3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274989,"discussion_content":"是的，通过命令fluxctl identity --k8s-fwd-ns flux获取的密钥，然后在gitlab上配置的deploy keys，不知道为什么不行呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590642036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1333523,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/13/ff6f3ed5.jpg","nickname":"王章涛","note":"","ucode":"6EC55EC116A58D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1201662,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","nickname":"小猪","note":"","ucode":"EAD6A4876CEF3B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366185,"discussion_content":"你问题解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617976899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":274989,"ip_address":"","group_id":0},"score":366185,"extra":""}]}]},{"had_liked":false,"id":221400,"user_name":"小猪","can_delete":false,"product_type":"c3","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1590491908,"is_pvip":false,"replies":[{"id":81668,"content":"代码仓库页面 - settings - deploy key","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1590507067,"ip_address":"","comment_id":221400,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，我如果用flux管理gitlab仓库，需要把ssh key配置到gitlab的哪里？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496445,"discussion_content":"代码仓库页面 - settings - deploy key","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590507067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1286375,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjzTQ6HPGw2LWLiaiciaibfdMMlmxEwBkBjxOPxeYynZlBKCf6U1b0ezM9IZYibB6yKR7HpRuAOdtj29Q/132","nickname":"小西几","note":"","ucode":"ED1DDE17534508","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559483,"discussion_content":"gitlab 仓库页面没有这个配置，同学，你最好在哪里配置的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648794061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238321,"user_name":"李俊-John","can_delete":false,"product_type":"c3","uid":1595855,"ip_address":"","ucode":"AE9056C59D60D6","user_header":"https://static001.geekbang.org/account/avatar/00/18/59/cf/168ac16d.jpg","comment_is_top":false,"comment_ctime":1596120854,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"flux 连接私有仓库，参考 https:&#47;&#47;docs.fluxcd.io&#47;en&#47;1.18.0&#47;guides&#47;use-private-git-host.html","like_count":1},{"had_liked":false,"id":218981,"user_name":"空空如也","can_delete":false,"product_type":"c3","uid":1194238,"ip_address":"","ucode":"342F3A2C8A3C11","user_header":"https://static001.geekbang.org/account/avatar/00/12/38/fe/988bf0d9.jpg","comment_is_top":false,"comment_ctime":1589908865,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"我们用的微软那个tfs，也是传统的devops的方式，对集群建立连接，调用脚本去做服务启停 。 挺累。。","like_count":1},{"had_liked":false,"id":312894,"user_name":"kissrain","can_delete":false,"product_type":"c3","uid":1120583,"ip_address":"","ucode":"2177C53E3B2DCC","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/47/b27f1314.jpg","comment_is_top":false,"comment_ctime":1632109206,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"感觉flux是一个非常粗糙的发布","like_count":0},{"had_liked":false,"id":280801,"user_name":"杨","can_delete":false,"product_type":"c3","uid":1971269,"ip_address":"","ucode":"7EFEFE285975C6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/oltLEqTrmHm2aJP99BK6tHu5h7hp4aj08wR5Wt6H31iadFduDAVvjYKmhQ2nvGbLV3lkVdiat2GRasgWXoJeTibUg/132","comment_is_top":false,"comment_ctime":1614396725,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"如果需要通过jenkins打包镜像  那这样做意义不大   因为现在发布也有web  点击更换镜像版本就行了   还有flux怎样配置多个项目的url呀","like_count":0}]}