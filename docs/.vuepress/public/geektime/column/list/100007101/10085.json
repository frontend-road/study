{"id":10085,"title":"第20讲 | CDN：你去小卖部取过快递么？","content":"<p>上一节，我们看到了网站的一般访问模式。</p><p>当一个用户想访问一个网站的时候，指定这个网站的域名，DNS就会将这个域名解析为地址，然后用户请求这个地址，返回一个网页。就像你要买个东西，首先要查找商店的位置，然后去商店里面找到自己想要的东西，最后拿着东西回家。</p><p><strong>那这里面还有没有可以优化的地方呢？</strong></p><p>例如你去电商网站下单买个东西，这个东西一定要从电商总部的中心仓库送过来吗？原来基本是这样的，每一单都是单独配送，所以你可能要很久才能收到你的宝贝。但是后来电商网站的物流系统学聪明了，他们在全国各地建立了很多仓库，而不是只有总部的中心仓库才可以发货。</p><p>电商网站根据统计大概知道，北京、上海、广州、深圳、杭州等地，每天能够卖出去多少书籍、卫生纸、包、电器等存放期比较长的物品。这些物品用不着从中心仓库发出，所以平时就可以将它们分布在各地仓库里，客户一下单，就近的仓库发出，第二天就可以收到了。</p><p>这样，用户体验大大提高。当然，这里面也有个难点就是，生鲜这类东西保质期太短，如果提前都备好货，但是没有人下单，那肯定就坏了。这个问题，我后文再说。</p><p><strong>我们先说，我们的网站访问可以借鉴“就近配送”这个思路。</strong></p><p>全球有这么多的数据中心，无论在哪里上网，临近不远的地方基本上都有数据中心。是不是可以在这些数据中心里部署几台机器，形成一个缓存的集群来缓存部分数据，那么用户访问数据的时候，就可以就近访问了呢？</p><!-- [[[read_end]]] --><p>当然是可以的。这些分布在各个地方的各个数据中心的节点，就称为<strong>边缘节点</strong>。</p><p>由于边缘节点数目比较多，但是每个集群规模比较小，不可能缓存下来所有东西，因而可能无法命中，这样就会在边缘节点之上。有区域节点，规模就要更大，缓存的数据会更多，命中的概率也就更大。在区域节点之上是中心节点，规模更大，缓存数据更多。如果还不命中，就只好回源网站访问了。</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/25/5fbe602d9b85966d9a1748d2e6aa6425.jpeg?wh=1920*1080\" alt=\"\"></p><p>这就是<strong>CDN分发系统的架构</strong>。CDN系统的缓存，也是一层一层的，能不访问后端真正的源，就不打扰它。这也是电商网站物流系统的思路，北京局找不到，找华北局，华北局找不到，再找北方局。</p><p>有了这个分发系统之后，接下来，<strong>客户端如何找到相应的边缘节点进行访问呢？</strong></p><p>还记得我们讲过的基于DNS的全局负载均衡吗？这个负载均衡主要用来选择一个就近的同样运营商的服务器进行访问。你会发现，CDN分发网络也是一个分布在多个区域、多个运营商的分布式系统，也可以用相同的思路选择最合适的边缘节点。</p><p><img src=\"https://static001.geekbang.org/resource/image/c4/24/c4d826188e664605d6f8dfb82e348824.jpeg?wh=1920*1080\" alt=\"\"></p><p><strong>在没有CDN的情况下</strong>，用户向浏览器输入www.web.com这个域名，客户端访问本地DNS服务器的时候，如果本地DNS服务器有缓存，则返回网站的地址；如果没有，递归查询到网站的权威DNS服务器，这个权威DNS服务器是负责web.com的，它会返回网站的IP地址。本地DNS服务器缓存下IP地址，将IP地址返回，然后客户端直接访问这个IP地址，就访问到了这个网站。</p><p>然而<strong>有了CDN之后，情况发生了变化</strong>。在web.com这个权威DNS服务器上，会设置一个CNAME别名，指向另外一个域名 www.web.cdn.com，返回给本地DNS服务器。</p><p>当本地DNS服务器拿到这个新的域名时，需要继续解析这个新的域名。这个时候，再访问的就不是web.com的权威DNS服务器了，而是web.cdn.com的权威DNS服务器，这是CDN自己的权威DNS服务器。在这个服务器上，还是会设置一个CNAME，指向另外一个域名，也即CDN网络的全局负载均衡器。</p><p>接下来，本地DNS服务器去请求CDN的全局负载均衡器解析域名，全局负载均衡器会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：</p><ul>\n<li>\n<p>根据用户IP地址，判断哪一台服务器距用户最近；</p>\n</li>\n<li>\n<p>用户所处的运营商；</p>\n</li>\n<li>\n<p>根据用户所请求的URL中携带的内容名称，判断哪一台服务器上有用户所需的内容；</p>\n</li>\n<li>\n<p>查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。</p>\n</li>\n</ul><p>基于以上这些条件，进行综合分析之后，全局负载均衡器会返回一台缓存服务器的IP地址。</p><p>本地DNS服务器缓存这个IP地址，然后将IP返回给客户端，客户端去访问这个边缘节点，下载资源。缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。</p><p><strong>CDN可以进行缓存的内容有很多种。</strong></p><p>保质期长的日用品比较容易缓存，因为不容易过期，对应到就像电商仓库系统里，就是静态页面、图片等，因为这些东西也不怎么变，所以适合缓存。</p><p><img src=\"https://static001.geekbang.org/resource/image/ca/1d/caec3ba1086557cbf694c621e7e01e1d.jpeg?wh=1254*1080\" alt=\"\"></p><p>还记得这个<strong>接入层缓存的架构</strong>吗？在进入数据中心的时候，我们希望通过最外层接入层的缓存，将大部分静态资源的访问拦在边缘。而CDN则更进一步，将这些静态资源缓存到离用户更近的数据中心。越接近客户，访问性能越好，时延越低。</p><p>但是静态内容中，有一种特殊的内容，也大量使用了CDN，这个就是前面讲过的<a href=\"https://time.geekbang.org/column/article/9688\">流媒体</a>。</p><p>CDN支持<strong>流媒体协议</strong>，例如前面讲过的RTMP协议。在很多情况下，这相当于一个代理，从上一级缓存读取内容，转发给用户。由于流媒体往往是连续的，因而可以进行预先缓存的策略，也可以预先推送到用户的客户端。</p><p>对于静态页面来讲，内容的分发往往采取<strong>拉取</strong>的方式，也即当发现未命中的时候，再去上一级进行拉取。但是，流媒体数据量大，如果出现<strong>回源</strong>，压力会比较大，所以往往采取主动<strong>推送</strong>的模式，将热点数据主动推送到边缘节点。</p><p>对于流媒体来讲，很多CDN还提供<strong>预处理服务</strong>，也即文件在分发之前，经过一定的处理。例如将视频转换为不同的码流，以适应不同的网络带宽的用户需求；再如对视频进行分片，降低存储压力，也使得客户端可以选择使用不同的码率加载不同的分片。这就是我们常见的，“我要看超清、标清、流畅等”。</p><p>对于流媒体CDN来讲，有个关键的问题是<strong>防盗链</strong>问题。因为视频是要花大价钱买版权的，为了挣点钱，收点广告费，如果流媒体被其他的网站盗走，在人家的网站播放，那损失可就大了。</p><p>最常用也最简单的方法就是<strong>HTTP头的referer字段</strong>， 当浏览器发送请求的时候，一般会带上referer，告诉服务器是从哪个页面链接过来的，服务器基于此可以获得一些信息用于处理。如果refer信息不是来自本站，就阻止访问或者跳到其它链接。</p><p><strong>referer的机制相对比较容易破解，所以还需要配合其他的机制。</strong></p><p>一种常用的机制是<strong>时间戳防盗链</strong>。使用CDN的管理员可以在配置界面上，和CDN厂商约定一个加密字符串。</p><p>客户端取出当前的时间戳，要访问的资源及其路径，连同加密字符串进行签名算法得到一个字符串，然后生成一个下载链接，带上这个签名字符串和截止时间戳去访问CDN。</p><p>在CDN服务端，根据取出过期时间，和当前 CDN 节点时间进行比较，确认请求是否过期。然后CDN服务端有了资源及路径，时间戳，以及约定的加密字符串，根据相同的签名算法计算签名，如果匹配则一致，访问合法，才会将资源返回给客户。</p><p>然而比如在电商仓库中，我在前面提过，有关生鲜的缓存就是非常麻烦的事情，这对应着就是动态的数据，比较难以缓存。怎么办呢？现在也有<strong>动态CDN，主要有两种模式</strong>。</p><ul>\n<li>\n<p>一种为<strong>生鲜超市模式</strong>，也即<strong>边缘计算的模式</strong>。既然数据是动态生成的，所以数据的逻辑计算和存储，也相应的放在边缘的节点。其中定时从源数据那里同步存储的数据，然后在边缘进行计算得到结果。就像对生鲜的烹饪是动态的，没办法事先做好缓存，因而将生鲜超市放在你家旁边，既能够送货上门，也能够现场烹饪，也是边缘计算的一种体现。</p>\n</li>\n<li>\n<p>另一种是<strong>冷链运输模式</strong>，也即<strong>路径优化的模式</strong>。数据不是在边缘计算生成的，而是在源站生成的，但是数据的下发则可以通过CDN的网络，对路径进行优化。因为CDN节点较多，能够找到离源站很近的边缘节点，也能找到离用户很近的边缘节点。中间的链路完全由CDN来规划，选择一个更加可靠的路径，使用类似专线的方式进行访问。</p>\n</li>\n</ul><p>对于常用的TCP连接，在公网上传输的时候经常会丢数据，导致TCP的窗口始终很小，发送速度上不去。根据前面的TCP流量控制和拥塞控制的原理，在CDN加速网络中可以调整TCP的参数，使得TCP可以更加激进地传输数据。</p><p>可以通过多个请求复用一个连接，保证每次动态请求到达时。连接都已经建立了，不必临时三次握手或者建立过多的连接，增加服务器的压力。另外，可以通过对传输数据进行压缩，增加传输效率。</p><p>所有这些手段就像冷链运输，整个物流优化了，全程冷冻高速运输。不管生鲜是从你旁边的超市送到你家的，还是从产地送的，保证到你家是新鲜的。</p><h2>小结</h2><p>好了，这节就到这里了。咱们来总结一下，你记住这两个重点就好。</p><ul>\n<li>\n<p>CDN和电商系统的分布式仓储系统一样，分为中心节点、区域节点、边缘节点，而数据缓存在离用户最近的位置。</p>\n</li>\n<li>\n<p>CDN最擅长的是缓存静态数据，除此之外还可以缓存流媒体数据，这时候要注意使用防盗链。它也支持动态数据的缓存，一种是边缘计算的生鲜超市模式，另一种是链路优化的冷链运输模式。</p>\n</li>\n</ul><p>最后，给你留两个思考题：</p><ol>\n<li>\n<p>这一节讲了CDN使用DNS进行全局负载均衡的例子，CDN如何使用HttpDNS呢？</p>\n</li>\n<li>\n<p>客户端对DNS、HttpDNS、CDN访问了半天，还没进数据中心，你知道数据中心里面什么样吗？</p>\n</li>\n</ol><p>我们的专栏更新到第20讲，不知你掌握得如何？每节课后我留的思考题，你都有没有认真思考，并在留言区写下答案呢？我会从<strong>已发布的文章中选出一批认真留言的同学</strong>，赠送<span class=\"orange\">学习奖励礼券</span>和我整理的<span class=\"orange\">独家网络协议知识图谱</span>。</p><p>欢迎你留言和我讨论。趣谈网络协议，我们下期见！</p>","comments":[{"had_liked":false,"id":14734,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1530623373,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"224868922765","product_id":100007101,"comment_content":"1. 参照阿里云CDN HTTPDNS方式；客户端请求服务URL:umc.danuoyi.alicdn.com xxx，参数是客户端ip地址和待解析的域名；然后返回多个ip地址，客户端轮训这些ip地址。<br>2. 如果把边缘节点比作小卖部，那数据中心就是超级市场，里面商品应有尽有，是所有子节点的父集。","like_count":52},{"had_liked":false,"id":15199,"user_name":"米兰的小铁匠","can_delete":false,"product_type":"c1","uid":1024303,"ip_address":"","ucode":"5CCE3C8AE4FDC2","user_header":"","comment_is_top":false,"comment_ctime":1530985392,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"100315233200","product_id":100007101,"comment_content":"我的理解是 CDN 只是节点，网络传输只能走公网的线路。文章中说走 dns 专用线路，难道是像运营商一样自建电缆？希望老师解惑。","like_count":23,"discussions":[{"author":{"id":1994656,"avatar":"","nickname":"天辰","note":"","ucode":"DC28560B07CF29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332744,"discussion_content":"看各家能力 大的云厂商是自有的专线网络 公网是指的出网的骨干网 因避免不了跨网交互","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607329646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20763,"user_name":"lfn","can_delete":false,"product_type":"c1","uid":1026593,"ip_address":"","ucode":"2E1558C6A12A89","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/21/6c3ba9af.jpg","comment_is_top":false,"comment_ctime":1534736550,"is_pvip":false,"replies":[{"id":"7295","content":"cdn技术详解","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1534739255,"ip_address":"","comment_id":20763,"utype":1}],"discussion_count":1,"race_medal":0,"score":"96024017062","product_id":100007101,"comment_content":"搜了一圈儿，没找到cdn权威指南这本书，您是不是写错了？","like_count":22,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422401,"discussion_content":"cdn技术详解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534739255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113281,"user_name":"stark","can_delete":false,"product_type":"c1","uid":1143399,"ip_address":"","ucode":"ADC5C2AE5B97C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/72/67/aa52812a.jpg","comment_is_top":false,"comment_ctime":1562932972,"is_pvip":false,"replies":[{"id":"46676","content":"nginx是在网站的接入层缓存静态资源，CDN是在数据中心之外，离客户端很近的地方缓存静态资源","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566379065,"ip_address":"","comment_id":113281,"utype":1}],"discussion_count":2,"race_medal":0,"score":"70282409708","product_id":100007101,"comment_content":"我有个疑问，CDN是内容分发系统，之前在NGINX的学习中，那个老师说主要是为了静态资源，我有点不理解，超哥能稍微解释一下么","like_count":16,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458150,"discussion_content":"nginx是在网站的接入层缓存静态资源，CDN是在数据中心之外，离客户端很近的地方缓存静态资源","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566379065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1088169,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9a/a9/ae10f6cd.jpg","nickname":"影随","note":"","ucode":"48BC4CFCAD3C2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9995,"discussion_content":"关于cdn的具体使用还是不清楚， 假如你的服务器只在阿里云有两台实例（上海地区的），前端使用了cdn， 那么北京和深圳的用户访问的话， 该网站的cnd缓存数据就存在该cdn服务商在北京、深圳的服务器节点上 ？？？ 如果是这样的话，那么cdn就取决于cdn服务方的服务器节点位置 ？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568254385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":24423,"user_name":"ZACK","can_delete":false,"product_type":"c1","uid":1103378,"ip_address":"","ucode":"1BB305D323570D","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/12/f799997f.jpg","comment_is_top":false,"comment_ctime":1536992188,"is_pvip":false,"replies":[{"id":"8945","content":"理解正确，cdn其他厂商提供的服务，是指在外网工作","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1537018970,"ip_address":"","comment_id":24423,"utype":1}],"discussion_count":7,"race_medal":0,"score":"65961501628","product_id":100007101,"comment_content":"由于多dc，静态资源图片同步是个很大的问题，因为网速，后来我们尝试用cdn去解决，但被公司一自称很牛的哥们否掉，原因是cdn只支持外网的，至今没有完全理解是否正确","like_count":15,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423978,"discussion_content":"理解正确，cdn其他厂商提供的服务，是指在外网工作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537018970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154400,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9d/60/55b9660f.jpg","nickname":"theivanxu","note":"","ucode":"7A4794EACA6C97","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":244478,"discussion_content":"首先说了多数据中心，而数据中心之间资源同步一般是使用内部网络，现有商用CDN大部分是提供面向用户的公网服务，也就是“用户—CDN”这样的关系，所以无法满足内部使用需求。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1587605595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1657925,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4c/45/1042c1fd.jpg","nickname":"淡忘如风","note":"","ucode":"464DBE34300A6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218777,"discussion_content":"外网是公网的意思吧，就是能访问百度的。。公司开发一般都是内网进行开发测试吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585700161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576049,"discussion_content":"能直接通过公网访问到～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655259474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267273,"discussion_content":"vpn可以解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589622952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1693116,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d5/bc/23e0c5de.jpg","nickname":"陈启明","note":"","ucode":"9B7DA0226DBA10","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":179560,"discussion_content":"同问，支持外网是什么意思？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582228389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580358,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ZMALpD4bKCVdsx8ymCC5Oo0oxibxIFGQzT6fP2B8MEgLGLktQRX4ictobkbcNBDTQibjoQNKBmWCKomNibWqHZ5kpg/132","nickname":"Long","note":"","ucode":"D85B99FD0C4B76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46282,"discussion_content":"支持外网是什么意思?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573137955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36661,"user_name":"tommyCmd","can_delete":false,"product_type":"c1","uid":1208393,"ip_address":"","ucode":"4ADBB1FA44668D","user_header":"https://static001.geekbang.org/account/avatar/00/12/70/49/d7690979.jpg","comment_is_top":false,"comment_ctime":1541223346,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"40195929010","product_id":100007101,"comment_content":"根据ip地址，怎么判断服务器的远近呢？","like_count":9,"discussions":[{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296913,"discussion_content":"ip地址本身并不包含地理位置信息。你知道ip地址有ABCD四类，但其实每个国家、每个城市、每个运营商，都能拿到其中的一小段，所以ip的某一小段，到底分配给了那个国家，那个城市，那个运营商，有专门的机构维护这部分信息。所以拿你的ip，去查这个数据库，看看位于哪一段，就知道你所在的城市及运营商了","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1596704553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267274,"discussion_content":"百度输入ip，就能看到你在哪个地方，说明IP里面蕴含了位置的秘密","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589623024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2047392,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/3d/a0/acf6b165.jpg","nickname":"奋斗","note":"","ucode":"C84C2D030ACA51","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374748,"discussion_content":"你ping的过程中会走省、市的路由器，这些路由器一般都是知道的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621334868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113587,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fd/f3/77223a8c.jpg","nickname":"清新灬小柠檬","note":"","ucode":"F3004F2F385096","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5204,"discussion_content":"部分ip是有物理地址的，ipipnet了解一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566046062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18641,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1533518245,"is_pvip":true,"discussion_count":2,"race_medal":1,"score":"27303322021","product_id":100007101,"comment_content":"老师，DNS的作用相当于客户端找到最近最合适DNS运营商，而CDN相当于DNS运营商找到最合适的服务器获取内容。可以这样理解吗？","like_count":6,"discussions":[{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576053,"discussion_content":"补充，当然，从上图中，可以看到CDN要访问的节点比直接的DNS更多，如果内容访问的命中率不高，反而得不偿失。CDN本质上就是缓存，节点会配置一定的缓存策略，过期策略，更新策略等，同时会CDN厂商或者云服务器厂商，如阿里，会提供监控数据，包含，访问次数，回源统计，命中率等。\nhttps://help.aliyun.com/document_detail/123330.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655261226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576052,"discussion_content":"个人观点：\nDNS的作用有两个，一个是域名解析，一个是做负载均衡【内部和全局】，这里明显讨论的是负载均衡的作用，最终的结果还是返回最近最合适的Server IP。\n\nCDN是对上述DNS过程的补充，优化的方案，通过自身的分发网络，主要是针对静态资源，以及一些动态资源进行传输的优化，使之在地理位置上更加接近用户。\n\n简而言之，前者负载均衡是针对机房层面【部署的机房不会有很多，地理上寥寥无几】，后者则是在更小更细的层面，比如边缘节点，【有很多，地理上更加分散，大的cdn厂商几乎分不在全国各个角落】，从而能达到对于所有用户更加低的延时。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655260679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14796,"user_name":"u","can_delete":false,"product_type":"c1","uid":1140276,"ip_address":"","ucode":"88FA7BA089807C","user_header":"https://static001.geekbang.org/account/avatar/00/11/66/34/0508d9e4.jpg","comment_is_top":false,"comment_ctime":1530668566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27300472342","product_id":100007101,"comment_content":"专栏前15讲偏基础，后面的偏架构，后面的内容虽然工作中不一定接触的到，但里面的架构思想值得总结学习！超哥厉害！👍🏻👍🏻👍🏻","like_count":6},{"had_liked":false,"id":165028,"user_name":"dayspring","can_delete":false,"product_type":"c1","uid":1181357,"ip_address":"","ucode":"FAD33FF71D6BAF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wYPdGBibR1FJWWMzFzYBy4tNTd22rMgtlYTgR7wuicFLQjiaozuRWM2VSMFxPYjVdkLJLGvMav2icH3icgz07hmDsDw/132","comment_is_top":false,"comment_ctime":1577149301,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18757018485","product_id":100007101,"comment_content":"超哥，请问一下cdn的权威dns服务器为什么还需要配置cname指向全局负载均衡器的域名呢？","like_count":4,"discussions":[{"author":{"id":1947974,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/b9/46/604b3dcf.jpg","nickname":"蓝色海洋","note":"","ucode":"C1BF85D9E5C881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552933,"discussion_content":"因为网站内容较多，一台服务器可能没有全部的资源，需要根据策略灵活分发内容，就是分配不同的服务器提供内容，就是说我们访问一个网址，访问的过程中可能有多台服务器轮流提供浏览内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645663369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94014,"user_name":"do it","can_delete":false,"product_type":"c1","uid":1309911,"ip_address":"","ucode":"E0753912E8F2AF","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d7/b102034a.jpg","comment_is_top":false,"comment_ctime":1557706919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18737576103","product_id":100007101,"comment_content":"个人小结<br>CDN(content delivery network)内容分发网络：分为边缘节点、区域节点、中心节点，数据缓存在离用户最近的位置。<br>CDN最擅长的是缓存静态数据，还可以缓存流媒体数据，这时需要注意使用防盗链(refer机制，时间戳防盗链)。也支持动态数据的缓存，一种是边缘计算的生鲜超市模式，另一种是链路优化的冷链运输模式。","like_count":4},{"had_liked":false,"id":90890,"user_name":"圆嗝嗝","can_delete":false,"product_type":"c1","uid":1123048,"ip_address":"","ucode":"6410A72C017C88","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/e8/8e154de6.jpg","comment_is_top":false,"comment_ctime":1556714373,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18736583557","product_id":100007101,"comment_content":"客户端发送一个HTTP请求给HTTPDNS，HTTPDNS返回含有请求内容的CDN服务器的IP地址。<br>与基于DNS进行负载均衡相比，少了DNS先递归查询CDN负载均衡服务器IP地址再通过CDN负载均衡服务器获取CDN服务器IP地址两个步骤。","like_count":4,"discussions":[{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335515,"discussion_content":"为什么不是通过httpDNS找到CDN负载均衡器地址，再通过CDN负载均衡器去找到合适的边缘服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608212046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14674,"user_name":"易轻尘","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1530591074,"is_pvip":true,"replies":[{"id":"4950","content":"是的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1530626196,"ip_address":"","comment_id":14674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18710460258","product_id":100007101,"comment_content":"貌似cdn要访问的节点比直接的dns更多啊，要是内容命中率不高的话反而得不偿失。所以cdn的边缘节点是有像cache那样的缓存机制吧，最近最少访问之类的？","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420087,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530626196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14601,"user_name":"云学","can_delete":false,"product_type":"c1","uid":1027233,"ip_address":"","ucode":"366AE90BA06356","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg","comment_is_top":false,"comment_ctime":1530572048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18710441232","product_id":100007101,"comment_content":"数据中心里面是一排排大机柜","like_count":4},{"had_liked":false,"id":119896,"user_name":"小毅(Eric)","can_delete":false,"product_type":"c1","uid":1081516,"ip_address":"","ucode":"CBFF9C432E6C69","user_header":"https://static001.geekbang.org/account/avatar/00/10/80/ac/37afe559.jpg","comment_is_top":false,"comment_ctime":1564722699,"is_pvip":false,"replies":[{"id":"46374","content":"网上查查资料，尤其是公有云，一般都提供这种服务的","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566297620,"ip_address":"","comment_id":119896,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14449624587","product_id":100007101,"comment_content":"听了专栏20集,每天上班中午休息的时候听一级然后做记录. 感觉将的听上去明白,但是其实不明白.由于在工作中其实并没有碰到那么多关于网络优化的实例(仅仅做后开开发的工作),所以有点一知半解.感觉似懂非懂.不知道后面如何继续?","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461119,"discussion_content":"网上查查资料，尤其是公有云，一般都提供这种服务的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566297620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1028395,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b1/2b/79b81df8.jpg","nickname":"iamcxc","note":"","ucode":"C519F51552DC12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277033,"discussion_content":"我是做前端开发的，听的过程感觉跟你差不多 。虽然目前工作中也是用不到，但觉得就当开拓自己技术眼界了吧。😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590986593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14561,"user_name":"Hurt","can_delete":false,"product_type":"c1","uid":1050946,"ip_address":"","ucode":"DCE7428CCF08EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg","comment_is_top":false,"comment_ctime":1530532718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14415434606","product_id":100007101,"comment_content":"认真的思考了 但又的确实是自己底子薄 不过会反复的学习","like_count":3},{"had_liked":false,"id":196255,"user_name":"Geek_f0bd6b","can_delete":false,"product_type":"c1","uid":1905495,"ip_address":"","ucode":"54C2BD14F77F72","user_header":"","comment_is_top":false,"comment_ctime":1585267718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175202310","product_id":100007101,"comment_content":"冷链运输模式，离源近的节点和离客户近的节点之间的链路是怎么实现优化成“专线”的，如果还是承载在公网上，那他们之间的路径本身不就应该是最优的了吗？请教老师解惑，谢谢！","like_count":2},{"had_liked":false,"id":193626,"user_name":"哇哈哈","can_delete":false,"product_type":"c1","uid":1175537,"ip_address":"","ucode":"47453D1C96A1DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/f1/8b06801a.jpg","comment_is_top":false,"comment_ctime":1584935960,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10174870552","product_id":100007101,"comment_content":"其实我还是没有理解 cdn 和 dns 的区别，dns 能帮找到最近的服务器，在这些最近的服务器上做静态资源存储不就可以吗？为什么还要分发到 cdn？我个人的理解是，打个比方，可能web.com 的服务器因为资源问题不会部署到每个城市，例如只在一些大区域部署，例如华东部署一个集群华南区域部署一个集群，但是 cdn 因为基本只有存储逻辑，资源开销比服务集群小，所以可以铺开部署到下一层深入到城市级别，例如上海，广州，这样 cdn 比 web.com 的集群更接近用户，所以这就是 cdn 能存在的意义？<br>","like_count":2,"discussions":[{"author":{"id":1947974,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/b9/46/604b3dcf.jpg","nickname":"蓝色海洋","note":"","ucode":"C1BF85D9E5C881","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552935,"discussion_content":"不懂啊，同疑惑中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645663642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107599,"user_name":"Yangjing","can_delete":false,"product_type":"c1","uid":1018061,"ip_address":"","ucode":"D88DFD4958D07C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/cd/2c3808ce.jpg","comment_is_top":false,"comment_ctime":1561562458,"is_pvip":true,"replies":[{"id":"48850","content":"是的，缓存规则","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567501087,"ip_address":"","comment_id":107599,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10151497050","product_id":100007101,"comment_content":"那 CDN 是怎么样把数据推送到到各个节点的呢？ 运营商给的规则吗","like_count":2,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455580,"discussion_content":"是的，缓存规则","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567501087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14736,"user_name":"凡凡","can_delete":false,"product_type":"c1","uid":1056142,"ip_address":"","ucode":"134C1E1E6B22BF","user_header":"https://static001.geekbang.org/account/avatar/00/10/1d/8e/0a546871.jpg","comment_is_top":false,"comment_ctime":1530624485,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10120559077","product_id":100007101,"comment_content":"1.需要客户端增加httpdns的sdk包，通过一次http请求完成最近节点的获取，然后请求cdn节点获取数据。相较于dns方式，少了一次cname域名的获取过程，少了dns域名的解析过程，而且能避免dns的偶尔失效问题。不过，现在主流的cdn似是采用的dns方式，比如阿里云和七牛云。2.到了服务地址之后，一般会有防火墙，nat，负载均衡器，网关，rpc等参与请求处理。","like_count":2},{"had_liked":false,"id":222518,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1590826265,"is_pvip":false,"replies":[{"id":"83165","content":"别人家的数据中心","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1591839334,"ip_address":"","comment_id":222518,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5885793561","product_id":100007101,"comment_content":"文中说cdn部署在数据中心；但老师评论的回复提到：cdn在数据中心之外。所以cdn到底是在数据中心之内还是之外呢？。。。。。<br>","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496826,"discussion_content":"别人家的数据中心","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591839334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222517,"user_name":"信信","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1590825901,"is_pvip":false,"replies":[{"id":"83166","content":"配置cdn的时候，会让你配置","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1591839395,"ip_address":"","comment_id":222517,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5885793197","product_id":100007101,"comment_content":"老师，这里有个疑问：<br>再访问的就不是 web.com 的权威 DNS 服务器了，而是 web.cdn.com 的权威 DNS 服务器，这是 CDN 自己的权威 DNS 服务器。<br>那本地dns是怎么知道CDN 自己的权威 DNS 服务器的ip的？   上一步的web.com 这个权威 DNS 服务器只返回了 CNAME 别名吧？","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496825,"discussion_content":"配置cdn的时候，会让你配置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591839395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296921,"discussion_content":"不只返回别名，其实此时会返回两条记录：一条是web.cdn.com的CNAME记录，另一条是web.cdn.com的ip地址的A记录。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596705703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584065,"discussion_content":"需再次解析一下吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660613895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":215297,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1588949958,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5883917254","product_id":100007101,"comment_content":"1.必然可以,同样是请求了DNS服务器,不过是放在了本地客户端去请求,而不是委托本地DNS服务器去请求,只要到了解析服务器上,依然可以走CDN的全局负载均衡器<br>2.数据中心应该是缓存了大量数据的服务器集群吧<br>","like_count":1},{"had_liked":false,"id":193745,"user_name":"King-ZJ","can_delete":false,"product_type":"c1","uid":1915385,"ip_address":"","ucode":"7448A4BBB5A118","user_header":"https://static001.geekbang.org/account/avatar/00/1d/39/f9/b946719a.jpg","comment_is_top":false,"comment_ctime":1584957332,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879924628","product_id":100007101,"comment_content":"CDN里包含中心节点、区域节点和边缘节点，而且数据是缓存在离用户最近的节点上。CDN擅长缓存静态的数据，同时也包含流媒体；当然对于动态的数据，CDN也采用两种方式：一个是分布式计算，另一个是链路优化，更快、更好地提供服务。","like_count":1},{"had_liked":false,"id":151188,"user_name":"江山如画","can_delete":false,"product_type":"c1","uid":1188280,"ip_address":"","ucode":"BEB6228E6135B5","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/b8/aca814dd.jpg","comment_is_top":false,"comment_ctime":1573662865,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5868630161","product_id":100007101,"comment_content":"今日学习笔记：<br><br>什么是CDN?<br><br>CDN 内容分发网络，content delivery network，用于加快客户端的数据访问速度。<br><br><br>CDN如何加快数据访问速度?<br><br>边缘节点-&gt;区域节点-&gt;中心节点，类似于多级Cache的设计，CDN 负载均衡器会根据 用户IP，所在运营商，访问内容，当前服务器负载情况 等因素选择一台合适边缘节点的地址供客户端进行访问。<br><br><br>流媒体CDN的特点？<br><br>a. 音视频流数据量比较大，一般会将热点数据从中心节点主动推送到边缘节点进行缓存，以减少被动回源对中心服务器造成的压力。<br>b. 流媒体CDN支持对音视频流进行预处理，比如视频的标清，高清，蓝光，视频会被处理为不同码率，以便适应不同带宽，或者对视频进行分片处理，加载时只加载用户当前访问分片以加快访问速度。<br>c. 流媒体CDN需要注意防盗链，一般在http报头中添加 referer 字段指明访问来自哪里，在通信时服务器端需要根据加解密算法验证访问方是否可靠，也需要验证访问是否已过期。<br><br><br>CDN 如何加快动态数据的访问？<br><br>a. 将数据计算放在边缘节点，边缘节点定期从中心节点同步数据<br>b. 计算仍放在中心节点，但是访问路径进行优化","like_count":1},{"had_liked":false,"id":97149,"user_name":"起风了001","can_delete":false,"product_type":"c1","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1558597956,"is_pvip":false,"replies":[{"id":"49267","content":"加密字符串是写在程序里面的，盗版网站得不到","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567608855,"ip_address":"","comment_id":97149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853565252","product_id":100007101,"comment_content":"时间戳防盗链这个不是很清楚, 如果客户端可以得到加密字符串, 那么盗版网站也可以先获取这个字符串然后再进行同样的加密, 是不是也可以呢?","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451155,"discussion_content":"加密字符串是写在程序里面的，盗版网站得不到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567608855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64955,"user_name":"c","can_delete":false,"product_type":"c1","uid":1137153,"ip_address":"","ucode":"B5DB37FD5359A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/01/4c000f56.jpg","comment_is_top":false,"comment_ctime":1548984587,"is_pvip":false,"replies":[{"id":"25958","content":"本来就是呀","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1551438434,"ip_address":"","comment_id":64955,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5843951883","product_id":100007101,"comment_content":"web.com的权威dns服务器为啥不直接cname到cdn的负载均衡服务器？","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438250,"discussion_content":"本来就是呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551438434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1036921,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d2/79/0a432fde.jpg","nickname":"凯文1985","note":"","ucode":"9A42344649072B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":582388,"discussion_content":"web.com的权威服务器从图上看是直接先到了CDN的权威服务器，然后才到CDN的全局负载均衡服务器，我也有这个疑问，为什么还要中间的CDN权威服务器？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1659420178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":438250,"ip_address":"上海"},"score":582388,"extra":""}]},{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335518,"discussion_content":"所以CDN 用httpDNS服务就是避开权威dns服务，直接通过http服务找到cdn的负载均衡器","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608212175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19095,"user_name":"笑一笑","can_delete":false,"product_type":"c1","uid":1133131,"ip_address":"","ucode":"48BF17B4EABCB6","user_header":"","comment_is_top":false,"comment_ctime":1533683369,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5828650665","product_id":100007101,"comment_content":"在特定网络里面，为了加快传输，TCP参数调整主要涉及哪些方面呢？","like_count":1},{"had_liked":false,"id":16592,"user_name":"kaka.Song","can_delete":false,"product_type":"c1","uid":1088820,"ip_address":"","ucode":"35E3C8E1CCC8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/9d/34/177bf988.jpg","comment_is_top":false,"comment_ctime":1532048234,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5827015530","product_id":100007101,"comment_content":"CDN是怎么样把数据缓存到各个节点的啊？","like_count":1,"discussions":[{"author":{"id":1088169,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9a/a9/ae10f6cd.jpg","nickname":"影随","note":"","ucode":"48BC4CFCAD3C2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":10169,"discussion_content":"这里只讲到了读取缓存，存缓存没讲到。 是不是没有专门写，而是读不到时，从源站读到数据后，再沿着线路在各个路径上缓存下来？ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568269535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394861,"avatar":"https://static001.geekbang.org/account/avatar/00/15/48/ad/8be724da.jpg","nickname":"陈泽坛","note":"","ucode":"C81B402868E9E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2542,"discussion_content":"请求源站，然后将数据缓存在节点服务器上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563766084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354539,"user_name":"Geek_64f925","can_delete":false,"product_type":"c1","uid":2064877,"ip_address":"广东","ucode":"53145B690D4FE4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Gg1doG856ec8BWgFregO01XwjnfygRmXpqb9cJ63JzAyH08yCYkCItuYN71p4Vk0JDhODiaHbGVdmRpeRVIyuuA/132","comment_is_top":false,"comment_ctime":1660520733,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660520733","product_id":100007101,"comment_content":"CDN和DNS中的GSLB有什么区别 都是可以根据自定义策略寻找到更优的服务器","like_count":0},{"had_liked":false,"id":329547,"user_name":"Geek_ab94c1","can_delete":false,"product_type":"c1","uid":1734282,"ip_address":"","ucode":"180F60F9E69AC7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/52TEuxuQgXb6Gqg5EhZry8bibIkVDnF9omEiaa2px78meQ5hHWibmcEnnIqUZtxPpNWn2l6OvPaqVTiceTHXPtXkTg/132","comment_is_top":false,"comment_ctime":1641395028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641395028","product_id":100007101,"comment_content":"从客户端到本地域名服务器是递归查询，从本地域名服务器到外网是迭代查询","like_count":0},{"had_liked":false,"id":295919,"user_name":"杰良","can_delete":false,"product_type":"c1","uid":2567349,"ip_address":"","ucode":"5DC1D1C58A4731","user_header":"https://static001.geekbang.org/account/avatar/00/27/2c/b5/10141329.jpg","comment_is_top":false,"comment_ctime":1622641284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622641284","product_id":100007101,"comment_content":"CDN，Content Delivery Network，即内容分发网络。","like_count":0},{"had_liked":false,"id":290234,"user_name":"John","can_delete":false,"product_type":"c1","uid":1036468,"ip_address":"","ucode":"449164FE4255CB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d0/b4/a6c27fd0.jpg","comment_is_top":false,"comment_ctime":1619443138,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619443138","product_id":100007101,"comment_content":"一个网站如果既有动态数据也有静态数据，那怎么让请求去cdn获取静态资源，去源站获取动态数据(比如动态数据每次获取都是不一样的)呢？","like_count":0},{"had_liked":false,"id":288516,"user_name":"XYZ","can_delete":false,"product_type":"c1","uid":1359354,"ip_address":"","ucode":"C58AC0BA1F3459","user_header":"https://static001.geekbang.org/account/avatar/00/14/bd/fa/ccf696d9.jpg","comment_is_top":false,"comment_ctime":1618500958,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1618500958","product_id":100007101,"comment_content":"有个疑问，每个边缘节点的数据是怎么保持一致的","like_count":0,"discussions":[{"author":{"id":2989416,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLia17ibYsLic20bEFNkvObLpXicfUpYd9OeWvKxml0rNic3NDyRQ6KHl7wtEp0x993tJsTDsLHX2UHRYw/132","nickname":"Geek_761876","note":"","ucode":"D87D0B6D815DE1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580950,"discussion_content":"不需要保持一致，是源站推或拉的数据。每一个边缘节点的热点数据也不一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658412293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273556,"user_name":"勿忘初心🍃","can_delete":false,"product_type":"c1","uid":1341504,"ip_address":"","ucode":"02A5D0C357ADE0","user_header":"https://static001.geekbang.org/account/avatar/00/14/78/40/7ca70d5d.jpg","comment_is_top":false,"comment_ctime":1610637493,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610637493","product_id":100007101,"comment_content":"&quot;全局负载均衡器会为用户选择一台合适的缓存服务器提供服务&quot;，这里可以把URL里的参数也作为调度参数吗？DNS解析不携带HTTP的参数吧。","like_count":0},{"had_liked":false,"id":254634,"user_name":"紫日","can_delete":false,"product_type":"c1","uid":1207410,"ip_address":"","ucode":"73A8DEE323AC19","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXSb2jAzlMM0JdTjWrNiaq2uR9eeloBYp906POddb9evmuj5f4CUoO6ge8TibibwtZicnl1sRHic9rW7g/132","comment_is_top":false,"comment_ctime":1603160800,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1603160800","product_id":100007101,"comment_content":"CDN 和电商系统的分布式仓储系统一样，分为中心节点、区域节点、边缘节点，而数据缓存在离用户最近的位置。CDN 最擅长的是缓存静态数据，除此之外还可以缓存流媒体数据，这时候要注意使用防盗链。它也支持动态数据的缓存，一种是边缘计算的生鲜超市模式，另一种是链路优化的冷链运输模式。","like_count":0},{"had_liked":false,"id":232291,"user_name":"fmouse","can_delete":false,"product_type":"c1","uid":1202325,"ip_address":"","ucode":"9A8858CFFAB858","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/95/640b6465.jpg","comment_is_top":false,"comment_ctime":1593946937,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1593946937","product_id":100007101,"comment_content":"老师这里提到动态CDN，数据的逻辑计算和存储，也相应的放在边缘的节点。<br>如果将所有的数据逻辑计算和存储放在边缘节点，就是云服务？这样理解是否正确。","like_count":0},{"had_liked":false,"id":204954,"user_name":"雷刚","can_delete":false,"product_type":"c1","uid":1655725,"ip_address":"","ucode":"115FE2BE1AAB61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pTD8nS0SsORKiaRD3wB0NK9Bpd0wFnPWtYLPfBRBhvZ68iaJErMlM2NNSeEibwQfY7GReILSIYZXfT9o8iaicibcyw3g/132","comment_is_top":false,"comment_ctime":1586500177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586500177","product_id":100007101,"comment_content":"现在通用的 API 签名算法好像都和时间戳防盗链法差不多：<br>1. 客户端生成一个随机数 salt，然后 (url + salt +  secret + ...) 生成的字符串一起进行 md5，生成签名 sign，然后将 salt 和 sign 一起发给服务端。<br>2. 服务端同样也会生成 sign，对比这两个签名是否相等。<br><br>即使这个签名 sign 被中间人拦截，也不能用这个签名去破解其它的请求数据包，因为客户端每一个请求的 sign 都不一样。比如，百度翻译 API 就是这么设计的：https:&#47;&#47;api.fanyi.baidu.com&#47;doc&#47;21","like_count":0},{"had_liked":false,"id":203831,"user_name":"海盗船长","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1586271202,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586271202","product_id":100007101,"comment_content":"各大网站都要部署自己的CDN吗","like_count":0},{"had_liked":false,"id":203397,"user_name":"KK","can_delete":false,"product_type":"c1","uid":1324863,"ip_address":"","ucode":"FFC31A3FE3A285","user_header":"https://static001.geekbang.org/account/avatar/00/14/37/3f/a9127a73.jpg","comment_is_top":false,"comment_ctime":1586184074,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1586184074","product_id":100007101,"comment_content":"A content delivery network (CDN) increases network performance and uptime by caching frequently-accessed content on local servers that are positioned at the Internet’s edge.","like_count":0},{"had_liked":false,"id":199099,"user_name":"wsjx","can_delete":false,"product_type":"c1","uid":1039932,"ip_address":"","ucode":"5A89612ADF71CD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/3c/b1fe1f52.jpg","comment_is_top":false,"comment_ctime":1585478664,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585478664","product_id":100007101,"comment_content":"现在好多视频视频网站都用cdn","like_count":0},{"had_liked":false,"id":196253,"user_name":"Geek_f0bd6b","can_delete":false,"product_type":"c1","uid":1905495,"ip_address":"","ucode":"54C2BD14F77F72","user_header":"","comment_is_top":false,"comment_ctime":1585267499,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585267499","product_id":100007101,"comment_content":"时间戳防盗链中，我理解防盗链是通过签名来验证请求是来自自己cdn下面的用户的。那文中提到的过期时间还有什么作用呢？没想明白，请教老师解惑。","like_count":0,"discussions":[{"author":{"id":1140080,"avatar":"https://static001.geekbang.org/account/avatar/00/11/65/70/7e137498.jpg","nickname":"FOCUS","note":"","ucode":"DFE3078B632026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556320,"discussion_content":"大意是 set a window of timeout","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647313457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183176,"user_name":"Chuan","can_delete":false,"product_type":"c1","uid":1438352,"ip_address":"","ucode":"FACEC5DAC36A7A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4akcIyIOXB2OqibTe7FF90hwsBicxkjdicUNTMorGeIictdr3OoMxhc20yznmZWwAvQVThKPFWgOyMw/132","comment_is_top":false,"comment_ctime":1582967648,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582967648","product_id":100007101,"comment_content":"老师，请教个问题。CDN的地址转换也是依赖于DNS的，当我们输入一个域名时进行访问时，我们只会根据这个域名去找IP地址，权威DNS服务器怎么知道是应该给源站的地址（比如我们请求动态数据），还是通过CNAME，给CDN的权威DNS服务器地址呢？这个时候时将我们请求的资源路径URL等也发到DNS服务器了吗？","like_count":0},{"had_liked":false,"id":177494,"user_name":"涤生","can_delete":false,"product_type":"c1","uid":1796720,"ip_address":"","ucode":"09084D994BEFA4","user_header":"","comment_is_top":false,"comment_ctime":1581404781,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581404781","product_id":100007101,"comment_content":"静态页面的推送，是广播推送吗？","like_count":0},{"had_liked":false,"id":158402,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1575364849,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575364849","product_id":100007101,"comment_content":"CDN，只闻其名，未曾使用。","like_count":0},{"had_liked":false,"id":134079,"user_name":"水先生","can_delete":false,"product_type":"c1","uid":1249714,"ip_address":"","ucode":"362A71DF511E3E","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/b2/dd0606b2.jpg","comment_is_top":false,"comment_ctime":1568734208,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568734208","product_id":100007101,"comment_content":"刘老师~请问在静态内容里面，为什么“流媒体”会作为静态资源看待…是不是因为流媒体的传输近似一种稳定、持续的传输？（蒙的~_~）<br>谢谢刘老师~","like_count":0},{"had_liked":false,"id":132715,"user_name":"影随","can_delete":false,"product_type":"c1","uid":1088169,"ip_address":"","ucode":"48BC4CFCAD3C2F","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/a9/ae10f6cd.jpg","comment_is_top":false,"comment_ctime":1568201153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568201153","product_id":100007101,"comment_content":"老师，您好。 还是不太明白CDN是如何使用的，在哪种情况会使用到？ 在架构层面需要另外做部署吗？ CDN算不算第三方的工具呢？  不是很明白CDN作为一个产品在架构中如何呈现？","like_count":0},{"had_liked":false,"id":132652,"user_name":"JStFs","can_delete":false,"product_type":"c1","uid":1241121,"ip_address":"","ucode":"636E85653555DD","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/21/7168f973.jpg","comment_is_top":false,"comment_ctime":1568185653,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568185653","product_id":100007101,"comment_content":"又从头撸了一遍，刚撸到这一节，第二遍清晰多了，再结合看书查资料，觉得刘老师功力实在深厚！","like_count":0},{"had_liked":false,"id":112395,"user_name":"蜉蝣","can_delete":false,"product_type":"c1","uid":1229070,"ip_address":"","ucode":"77CF92496855D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/0e/2b987d54.jpg","comment_is_top":false,"comment_ctime":1562728312,"is_pvip":false,"replies":[{"id":"46720","content":"签名的意思就是原来的数据还在，不是加密。","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1566386449,"ip_address":"","comment_id":112395,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562728312","product_id":100007101,"comment_content":"老师，这一句我没懂：“然后 CDN 服务端有了资源及路径，时间戳，以及约定的加密字符串”。<br><br>CDN 服务端是如何获得资源路径，时间戳等客户端给的信息的？因为客户端已经加密过了。如果说服务端可以解密，那么为什么要把这些数据“根据相同的签名算法计算签名”，再去匹配呢？直接把解密出来的、之前约定的加密字符串对比就可以了吧。","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457716,"discussion_content":"签名的意思就是原来的数据还在，不是加密。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566386449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91611,"user_name":"Geek_8cf9dd","can_delete":false,"product_type":"c1","uid":1333611,"ip_address":"","ucode":"F64BB2A317017C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKicUXKVXIQAmToH3CkpQGjjDHRGSh0RjBpUf82r9WibfrrJMHxZXcuNVgCy8icpI9Mo4He8umCspDDA/132","comment_is_top":false,"comment_ctime":1557061148,"is_pvip":false,"replies":[{"id":"49479","content":"多刷几遍，加油","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567674727,"ip_address":"","comment_id":91611,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557061148","product_id":100007101,"comment_content":"cdn和httpcdn区别没看太明白，小白要多刷几遍了","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448965,"discussion_content":"多刷几遍，加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567674727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74304,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1552185226,"is_pvip":false,"replies":[{"id":"50270","content":"dns是解析ip的时候，在多个里面选择一个。","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1567838711,"ip_address":"","comment_id":74304,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552185226","product_id":100007101,"comment_content":"dns负载均衡是根据用户配置的本地dns地址作智能调度，不是用户实际的ip。http 负载均衡是根据用户ip做作调度的吧","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442519,"discussion_content":"dns是解析ip的时候，在多个里面选择一个。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567838711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68346,"user_name":"牙小木","can_delete":false,"product_type":"c1","uid":1172050,"ip_address":"","ucode":"E5C12D37A62949","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/52/56dbb738.jpg","comment_is_top":false,"comment_ctime":1550486432,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1550486432","product_id":100007101,"comment_content":"最佩服老师的举一反三，","like_count":0},{"had_liked":false,"id":30553,"user_name":"星河寒水","can_delete":false,"product_type":"c1","uid":1236277,"ip_address":"","ucode":"93BF42859D12A0","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/35/7897de3c.jpg","comment_is_top":false,"comment_ctime":1538920966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538920966","product_id":100007101,"comment_content":"生鲜超市模式能给个图示意一下吗？感觉关系不大明白","like_count":0},{"had_liked":false,"id":29114,"user_name":"张张张 💭","can_delete":false,"product_type":"c1","uid":1132934,"ip_address":"","ucode":"91240B99999C68","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/86/554cc50e.jpg","comment_is_top":false,"comment_ctime":1538270482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538270482","product_id":100007101,"comment_content":"终于有时间又过来看了，这个事一定要坚持，我是做开发的，对网络这快比较小白，每次都要看好几遍。所以问题基本上都不会，不过收获挺多","like_count":0},{"had_liked":false,"id":20267,"user_name":"lfn","can_delete":false,"product_type":"c1","uid":1026593,"ip_address":"","ucode":"2E1558C6A12A89","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/21/6c3ba9af.jpg","comment_is_top":false,"comment_ctime":1534342515,"is_pvip":false,"replies":[{"id":"7274","content":"cdn权威指南","user_name":"作者回复","user_name_real":"刘超@网易云","uid":"1001590","ctime":1534730726,"ip_address":"","comment_id":20267,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1534342515","product_id":100007101,"comment_content":"老师，您好。能推荐一些讲cdn比较好的资料或书么？","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"刘超","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422179,"discussion_content":"cdn权威指南","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534730726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19396,"user_name":"Quan","can_delete":false,"product_type":"c1","uid":1100503,"ip_address":"","ucode":"1DA6D8A5FCE363","user_header":"https://static001.geekbang.org/account/avatar/00/10/ca/d7/ee885390.jpg","comment_is_top":false,"comment_ctime":1533807226,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533807226","product_id":100007101,"comment_content":"第一遍看不懂，再看第二遍，第三遍，第四遍……终于搞清楚些了<br>所以，看不懂的筒子们，多看几遍就懂啦","like_count":0},{"had_liked":false,"id":18897,"user_name":"孙悟空","can_delete":false,"product_type":"c1","uid":1055660,"ip_address":"","ucode":"28356CBC83C464","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/ac/41ec8c80.jpg","comment_is_top":false,"comment_ctime":1533604884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533604884","product_id":100007101,"comment_content":"客户端http请求cdn指定的httpdns服务端，绕过了运营商的local dns，httpdns依托遍布各地的二级dns节点解析域名，获得域名解析结果并返回给客户端","like_count":0},{"had_liked":false,"id":16379,"user_name":"rtoday","can_delete":false,"product_type":"c1","uid":1174402,"ip_address":"","ucode":"DFAA788C96ABAC","user_header":"https://static001.geekbang.org/account/avatar/00/11/eb/82/4b56fa5f.jpg","comment_is_top":false,"comment_ctime":1531917946,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1531917946","product_id":100007101,"comment_content":"请问冷链运输模式<br>是谁可以决定最优最短路径呢？<br>1.Server，由服务器的网管人员设定<br>2.Client，用户端自己可以设定<br>3.CDN自己有一套算法，上面两者都无法更改<br><br>请问是哪一个呢？又或者上述三者都可以决定呢？","like_count":0},{"had_liked":false,"id":15105,"user_name":"zcpromising","can_delete":false,"product_type":"c1","uid":1131966,"ip_address":"","ucode":"4F29D98A436D09","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/be/494010aa.jpg","comment_is_top":false,"comment_ctime":1530864219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530864219","product_id":100007101,"comment_content":"老师，后面的内容对于基础差的人来说的确有点困难，问题想回答也回答不出来。不过还是有认真思考过。希望能得到老师整理的独家网络协议知识图谱","like_count":0},{"had_liked":false,"id":15034,"user_name":"pony","can_delete":false,"product_type":"c1","uid":1021530,"ip_address":"","ucode":"B72FA864CDD286","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/5a/846a09f7.jpg","comment_is_top":false,"comment_ctime":1530830933,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530830933","product_id":100007101,"comment_content":"CDN现在懂了","like_count":0},{"had_liked":false,"id":14595,"user_name":"马天奇","can_delete":false,"product_type":"c1","uid":1070478,"ip_address":"","ucode":"623F4F9C86B609","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/8e/6a26f34b.jpg","comment_is_top":false,"comment_ctime":1530549664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530549664","product_id":100007101,"comment_content":"1.使用httpdns需要客户端支持，将dns请求改造为使用http 协议进行，请求中的url直接是ip，响应的是cdn节点ip<br>2.数据中心是缓存的源站资源。","like_count":0},{"had_liked":false,"id":14586,"user_name":"Chao","can_delete":false,"product_type":"c1","uid":1108745,"ip_address":"","ucode":"DD7742F5537521","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/09/ba5f0135.jpg","comment_is_top":false,"comment_ctime":1530541854,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530541854","product_id":100007101,"comment_content":"cdn 不使用 httpdns 吧","like_count":0},{"had_liked":false,"id":14580,"user_name":"andyZhang","can_delete":false,"product_type":"c1","uid":1082172,"ip_address":"","ucode":"4BC34DAB06D8C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/3c/87367829.jpg","comment_is_top":false,"comment_ctime":1530540888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530540888","product_id":100007101,"comment_content":"1.通过自定义的HTTPDNS服务，可以实现粒度更细的内容分发，比如可以根据请求发起者的用户资料进行不同的分发调度。<br>2.数据中心内是一个个运行的应用服务，给请求者提供各种服务，它们或相互独立（不同的应用）或相互协助（SOA或微服务）或分发流量（集群）。","like_count":0},{"had_liked":false,"id":14490,"user_name":"你说说吧","can_delete":false,"product_type":"c1","uid":1025018,"ip_address":"","ucode":"C1E275AAD9B0DF","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJaPUrpMFvXETYiafhKRAQt5gd4m3LYxH1kjViboCpfeOicBNzM6SyopMEF6dnwDTNpPt9IuDwib3LbZg/132","comment_is_top":false,"comment_ctime":1530493195,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1530493195","product_id":100007101,"comment_content":"前排😄","like_count":0}]}