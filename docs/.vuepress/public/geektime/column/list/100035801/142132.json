{"id":142132,"title":"05 | 系统设计目标（三）：如何让系统易于扩展？","content":"<p>从架构设计上来说，高可扩展性是一个设计的指标，它表示可以通过增加机器的方式来线性提高系统的处理能力，从而承担更高的流量和并发。</p><p>你可能会问：“在架构设计之初，为什么不预先考虑好使用多少台机器，支持现有的并发呢？”这个问题我在“<a href=\"https://time.geekbang.org/column/article/139474\">03 | 系统设计目标（一）：如何提升系统性能？</a>”一课中提到过，答案是峰值的流量不可控。</p><p>一般来说，基于成本考虑，在业务平稳期，我们会预留30%～50%的冗余以应对运营活动或者推广可能带来的峰值流量，但是当有一个突发事件发生时，流量可能瞬间提升到2～3倍甚至更高，我们还是以微博为例。</p><p>鹿晗和关晓彤互圈公布恋情，大家会在两个人的微博下面，或围观，或互动，微博的流量短时间内增长迅速，微博信息流也短暂出现无法刷出新的消息的情况。</p><p>那我们要如何应对突发的流量呢？架构的改造已经来不及了，最快的方式就是堆机器。不过我们需要保证，\b扩容了三倍的机器之后，相应的我们的系统也能支撑三倍的流量。有的人可能会产生疑问：“这不是显而易见的吗？很简单啊。”真的是这样吗？我们来看看做这件事儿难在哪儿。</p><h2>为什么提升扩展性会很复杂</h2><p>在上一讲中，我提到可以在单机系统中通过增加处理核心的方式，来增加系统的并行处理能力，但这个方式并不总奏效。因为当并行的任务数较多时，系统会因为争抢资源而达到性能上的拐点，系统处理能力不升反降。</p><!-- [[[read_end]]] --><p>而对于由多台机器组成的集群系统来说也是如此。集群系统中，不同的系统分层上可能存在一些“瓶颈点”，这些瓶颈点制约着系统的横向扩展能力。这句话比较抽象，我举个例子你就明白了。</p><p>比方说，你系统的流量是每秒1000次请求，对数据库的请求量也是每秒1000次。如果流量增加10倍，虽然系统可以通过扩容正常服务，数据库却成了瓶颈。再比方说，单机网络带宽是50Mbps，那么如果扩容到30台机器，前端负载均衡的带宽就超过了千兆带宽的限制，也会成为瓶颈点。那么，我们的系统中存在哪些服务会成为制约系统扩展的重要因素呢？</p><p>其实，无状态的服务和组件更易于扩展，而像MySQL这种存储服务是有状态的，就比较难以扩展。因为向存储集群中增加或者减少机器时，会涉及大量数据的迁移，而一般传统的关系型数据库都不支持。这就是为什么提升系统扩展性会很复杂的主要原因。</p><p>除此之外，从例子中你可以看到，我们需要站在整体架构的角度，而不仅仅是业务服务器的角度来考虑系统的扩展性 。<strong>所以说，数据库、缓存、依赖的第三方、负载均衡、交换机带宽等等</strong>都是系统扩展时需要考虑的因素。我们要知道系统并发到了某一个量级之后，哪一个因素会成为我们的瓶颈点，从而针对性地进行扩展。</p><p>针对这些复杂的扩展性问题，我提炼了一些系统设计思路，供你了解。</p><h2>高可扩展性的设计思路</h2><p><strong>拆分</strong>是提升系统扩展性最重要的一个思路，它会把庞杂的系统拆分成独立的，有单一职责的模块。相对于大系统来说，考虑一个一个小模块的扩展性当然会简单一些。<strong>将复杂的问题简单化，这就是我们的思路。</strong></p><p>但对于不同类型的模块，我们在拆分上遵循的原则是不一样的。我给你举一个简单的例子，假如你要设计一个社区，那么社区会有几个模块呢？可能有5个模块。</p><ul>\n<li>用户：负责维护社区用户信息，注册，登陆等；</li>\n<li>关系：用户之间关注、好友、拉黑等关系的维护；</li>\n<li>内容：社区发的内容，就像朋友圈或者微博的内容；</li>\n<li>评论、赞：用户可能会有的两种常规互动操作；</li>\n<li>搜索：用户的搜索，内容的搜索。</li>\n</ul><p>而部署方式按照最简单的三层部署架构，负载均衡负责请求的分发，应用服务器负责业务逻辑的处理，数据库负责数据的存储落地。这时，所有模块的业务代码都混合在一起了，数据也都存储在一个库里。</p><p><img src=\"https://static001.geekbang.org/resource/image/58/a6/5803451931917e0806c37c39802410a6.jpg?wh=1142*920\" alt=\"\"></p><h4>1.存储层的扩展性</h4><p>无论是存储的数据量，还是并发访问量，不同的业务模块之间的量级相差很大，比如说成熟社区中，关系的数据量是远远大于用户数据量的，但是用户数据的访问量却远比关系数据要大。所以假如存储目前的瓶颈点是容量，那么我们只需要针对关系模块的数据做拆分就好了，而不需要拆分用户模块的数据。<strong>所以存储拆分首先考虑的维度是业务维度。</strong></p><p>拆分之后，这个简单的社区系统就有了用户库、内容库、评论库、点赞库和关系库。这么做还能隔离故障，某一个库“挂了”不会影响到其它的数据库。</p><p><img src=\"https://static001.geekbang.org/resource/image/5e/b6/5ee6e1350e2d4d5514a05032b10bd3b6.jpg?wh=1142*854\" alt=\"\"></p><p>按照业务拆分，在一定程度上提升了系统的扩展性，但系统运行时间长了之后，单一的业务数据库在容量和并发请求量上仍然会超过单机的限制。<strong>这时，我们就需要针对数据库做第二次拆分。</strong></p><p>这次拆分是按照数据特征做水平的拆分，比如说我们可以给用户库增加两个节点，然后按照某些算法将用户的数据拆分到这三个库里面，具体的算法我会在后面讲述数据库分库分表时和你细说。</p><p>水平拆分之后，我们就可以让数据库突破单机的限制了。但这里要注意，我们不能随意地增加节点，因为一旦增加节点就需要手动地迁移数据，成本还是很高的。所以基于长远的考虑，我们最好一次性增加足够的节点以避免频繁的扩容。</p><p>当数据库按照业务和数据维度拆分之后，我们尽量不要使用事务。因为当一个事务中同时更新不同的数据库时，需要使用二阶段提交，来协调所有数据库要么全部更新成功，要么全部更新失败。这个协调的成本会随着资源的扩展不断升高，最终达到无法承受的程度。</p><p>说完了存储层的扩展性，我们来看看业务层是如何做到易于扩展的。</p><h4>2.业务层的扩展性</h4><p>我们一般会从三个维度考虑业务层的拆分方案，它们分别是：业务维度，重要性维度和请求来源维度。</p><p>首先，我们需要把相同业务的服务拆分成单独的业务池，比方说上面的社区系统中，我们可以按照业务的维度拆分成用户池、内容池、关系池、评论池、点赞池和搜索池。</p><p>每个业务依赖独自的数据库资源，不会依赖其它业务的数据库资源。这样当某一个业务的接口成为瓶颈时，我们只需要扩展业务的池子，以及确认上下游的依赖方就可以了，这样就大大减少了扩容的复杂度。</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/b5/a62e9add7797fc8e55c06fa8a21065b5.jpg?wh=1142*664\" alt=\"\"></p><p>除此之外，我们还可以根据业务接口的重要程度，把业务分为核心池和非核心池。打个比方，就关系池而言，关注、取消关注接口相对重要一些，可以放在核心池里面；拉黑和取消拉黑的操作就相对不那么重要，可以放在非核心池里面。这样，我们可以优先保证核心池的性能，当整体流量上升时优先扩容核心池，降级部分非核心池的接口，从而保证整体系统的稳定性。</p><p><img src=\"https://static001.geekbang.org/resource/image/ce/28/ce6e856238d8af7059c44b3a47eced28.jpg?wh=1142*499\" alt=\"\"></p><p>最后，你还可以根据接入客户端类型的不同做业务池的拆分。比如说，服务于客户端接口的业务可以定义为外网池，服务于小程序或者HTML5页面的业务可以定义为H5池，服务于内部其它部门的业务可以定义为内网池，等等。</p><h2>课程小结</h2><p>本节课我带你了解了提升系统扩展性的复杂度以及系统拆分的思路。拆分看起来比较简单，可是什么时候做拆分，如何做拆分还是有很多细节考虑的。</p><p>未做拆分的系统虽然可扩展性不强，但是却足够简单，无论是系统开发还是运行维护都不需要投入很大的精力。拆分之后，需求开发需要横跨多个系统多个小团队，排查问题也需要涉及多个系统，运行维护上，可能每个子系统都需要有专人来负责，对于团队是一个比较大的考验。这个考验是我们必须要经历的一个大坎，需要我们做好准备。</p><h2>一课一思</h2><p>在今天的课程中，我们谈到了传统关系型数据库的可扩展性是很差的，那么在你看来，常见的NoSQL数据库是如何解决扩展性的问题呢？欢迎在留言区和我一起讨论。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，也欢迎你将它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"04 | 系统设计目标（二）：系统怎样做到高可用？","id":140763},"right":{"article_title":"06 | 面试现场第一期：当问到组件实现原理时，面试官是在刁难你吗？","id":143305}},"comments":[{"had_liked":false,"id":136907,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1569551469,"is_pvip":false,"replies":[{"id":"52809","content":"👍👍👍👍","user_name":"作者回复","comment_id":136907,"uid":"1448977","ip_address":"","utype":1,"ctime":1569739656,"user_name_real":"唐扬"}],"discussion_count":4,"race_medal":0,"score":"203433014381","product_id":100035801,"comment_content":"memcached 官方没有提供集群特性，一般第三方会使用一致性哈希算法来进行负载均衡实现集群扩展。<br>redis 官方的集群选择把数据根据key来哈希分配到固定数量的 slot 上，然后把 slot 再分配到具体的redis实例上来实现集群，当需要扩展时，只需要把 slot 分配一些到新加入的 redis 实例即可。这种多加一层来实现集群扩展的方式，类似于我们数据库分表时使用的索引表。","like_count":48,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468855,"discussion_content":"👍👍👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009831,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/68/a7/c3fd1fd9.jpg","nickname":"聪","note":"","ucode":"9D672A8580A945","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311674,"discussion_content":"但是要注意redis cluster 是最终一致性，有些业务需要强一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602460571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1079507,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/d3/1dc40aa2.jpg","nickname":"Jonah","note":"","ucode":"2C4799BD2FF0DE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79344,"discussion_content":"一致性hash","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576073468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25085,"discussion_content":"一看就是深入精通Redis😃","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570416606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136891,"user_name":"coffee","can_delete":false,"product_type":"c1","uid":1391640,"ip_address":"","ucode":"DF831C481B7949","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/vK7WwQG23CI29w0iamcgetTicMdQ8NsJsQWSXIia3aSUbVE6dqfTiaVtqTdibJu31f7k2BkOSkQianxOUaqojEYP6ic3w/132","comment_is_top":false,"comment_ctime":1569548451,"is_pvip":false,"replies":[{"id":"52517","content":"不只是schema free，还在于支持auto sharding","user_name":"作者回复","comment_id":136891,"uid":"1448977","ip_address":"","utype":1,"ctime":1569554984,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"121828632739","product_id":100035801,"comment_content":"关系型数据库是强schema约束，并且支持事务，所以扩展性相对较差。<br>NOSQL一般都不是强schema约束的，所以可扩展性比关系型数据库要好。","like_count":29,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468846,"discussion_content":"不只是schema free，还在于支持auto sharding","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569554984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141542,"user_name":"岁寒","can_delete":false,"product_type":"c1","uid":1066921,"ip_address":"","ucode":"D062733384F4BF","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/a9/3ace68b6.jpg","comment_is_top":false,"comment_ctime":1571189239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"104650404343","product_id":100035801,"comment_content":"很很有感触，最近在做微服务拆分，面试过许多人，他们做拆分，是按照接口拆分，并不会按业务拆分，在我自己做的时候，就很容易发现，按业务确实不好拆。但是拆分的纬度不仅仅是业务，还有并发，比如块业务，是读多，还是写多，也可以按照这个纬度来分，在存储层，如果上层用redis做缓存，下层是mysql，也可以按redis拆，还是共mysql库<br>架构就是折中。","like_count":25},{"had_liked":false,"id":162549,"user_name":"YY","can_delete":false,"product_type":"c1","uid":1666905,"ip_address":"","ucode":"9E9F9A824D6129","user_header":"https://static001.geekbang.org/account/avatar/00/19/6f/59/21beefcb.jpg","comment_is_top":false,"comment_ctime":1576552698,"is_pvip":false,"replies":[{"id":"62152","content":"梳理依赖关系，如果有相互依赖的话，看看能不能拆出更基础的服务，让其他服务都依赖它","user_name":"作者回复","comment_id":162549,"uid":"1448977","ip_address":"","utype":1,"ctime":1576736923,"user_name_real":"唐扬"}],"discussion_count":3,"race_medal":0,"score":"61706094842","product_id":100035801,"comment_content":"数据库拆分后，但是各个库还是有相互依赖的，比如关系池，内容池都会依赖用户池，这种相互依赖的关系怎么解决？","like_count":15,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478083,"discussion_content":"梳理依赖关系，如果有相互依赖的话，看看能不能拆出更基础的服务，让其他服务都依赖它","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576736923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1607565,"avatar":"https://static001.geekbang.org/account/avatar/00/18/87/8d/7a654f2a.jpg","nickname":"ROOT","note":"","ucode":"3EB41234E12174","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":181270,"discussion_content":"这种服务之间互相调用的话，算是分布式事务么？要保证一致性吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582352685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1599768,"avatar":"https://static001.geekbang.org/account/avatar/00/18/69/18/ca8a5c22.jpg","nickname":"收","note":"","ucode":"EC3338DB7AEF34","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1607565,"avatar":"https://static001.geekbang.org/account/avatar/00/18/87/8d/7a654f2a.jpg","nickname":"ROOT","note":"","ucode":"3EB41234E12174","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":294892,"discussion_content":"都逃不出CAP的圈","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596025650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":181270,"ip_address":""},"score":294892,"extra":""}]}]},{"had_liked":false,"id":137668,"user_name":"xu晓晨","can_delete":false,"product_type":"c1","uid":1513945,"ip_address":"","ucode":"EE0374EB48FBDC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKoTDBX4a5u3Oc0zDpKDp6UbcYDcwAJXfBSmicqQwoyxaoVLEWzjIoUqYBiaDJHAYkO8icLtXqk4ibqKg/132","comment_is_top":false,"comment_ctime":1569815158,"is_pvip":false,"replies":[{"id":"52886","content":"👍","user_name":"作者回复","comment_id":137668,"uid":"1448977","ip_address":"","utype":1,"ctime":1569815387,"user_name_real":"唐扬"}],"discussion_count":6,"race_medal":0,"score":"48814455414","product_id":100035801,"comment_content":"redis扩展主要两方面。主备方案以及集群方案。<br>主备的话可以用redis的sentinel（哨兵）方案主要是解决redis主节点故障后的自动切换。它负责持续监控主从节点的健康，当主节点挂掉时，自动选择一个最优的从节点切换为主节点。<br>集群方案的话主流的是两种 一种是codis另一种是redis官方提供的cluster。","like_count":11,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469202,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569815387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1277041,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/71/ecfde294.jpg","nickname":"钛合金猪头","note":"","ucode":"5919ACDA6739E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396658,"discussion_content":"redis 哨兵集群主要是高可用，支持主备切换，但是支撑不了海量数据；redis cluster 既可以支持主备切换，还可以支撑海量数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632471628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1865908,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/78/b4/af163d12.jpg","nickname":"雨天的七毫米","note":"","ucode":"963BBAFE8EF97B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295786,"discussion_content":"redis cluster 每个节点都报存了集群信息，通过 rumor gossip 这类流言传播协议来同步集群信息，相对比较慢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596342807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074640,"avatar":"https://static001.geekbang.org/account/avatar/00/10/65/d0/c11d4a31.jpg","nickname":"滴水藏海","note":"","ucode":"9C1F9C91189F69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229556,"discussion_content":"redis的哨兵，支持扩容缩容的时的数据迁移么，对这块不是很了解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586664814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074640,"avatar":"https://static001.geekbang.org/account/avatar/00/10/65/d0/c11d4a31.jpg","nickname":"滴水藏海","note":"","ucode":"9C1F9C91189F69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229551,"discussion_content":"我理解概念上这属于HA纬度，一致性hash属于扩展性纬度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586664447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179437,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ff/2d/6bcdb733.jpg","nickname":"华勇","note":"","ucode":"6A3EB0228837E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79232,"discussion_content":"我们拆分都是按照数据资源进行拆分，这样更合理一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576069520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137343,"user_name":"A.Windy","can_delete":false,"product_type":"c1","uid":1128146,"ip_address":"","ucode":"254868B270F26D","user_header":"https://static001.geekbang.org/account/avatar/00/11/36/d2/32d3545a.jpg","comment_is_top":false,"comment_ctime":1569720090,"is_pvip":true,"replies":[{"id":"52800","content":"是的哦","user_name":"作者回复","comment_id":137343,"uid":"1448977","ip_address":"","utype":1,"ctime":1569739238,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"48814360346","product_id":100035801,"comment_content":"这不就是微服务嘛😄","like_count":11,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469042,"discussion_content":"是的哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139306,"user_name":"hailong","can_delete":false,"product_type":"c1","uid":1629824,"ip_address":"","ucode":"240E818261829D","user_header":"https://static001.geekbang.org/account/avatar/00/18/de/80/dd4da55b.jpg","comment_is_top":false,"comment_ctime":1570608315,"is_pvip":false,"replies":[{"id":"53783","content":"分表的话还是不是在一个机器上，突破不了单机的限制","user_name":"作者回复","comment_id":139306,"uid":"1448977","ip_address":"","utype":1,"ctime":1570665432,"user_name_real":"唐扬"}],"discussion_count":4,"race_medal":0,"score":"35930346683","product_id":100035801,"comment_content":"为了一个服务就要一个库？ 本次课程举的例子一个数据库分不同的表就行了，没懂分库啥意思","like_count":8,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469890,"discussion_content":"分表的话还是不是在一个机器上，突破不了单机的限制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570665432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018685,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/3d/0c3a2fd4.jpg","nickname":"偶尔复活下","note":"","ucode":"18B1D525CD50D3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392038,"discussion_content":"数据量大吧。如果没多少数据，其实可以一个数据库实例，不同schema隔离；或同schema不同前缀的表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630798608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244248,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg","nickname":"随风","note":"","ucode":"86A78303C9AB9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319049,"discussion_content":"每个服务又可以做分库分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603933464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244248,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg","nickname":"随风","note":"","ucode":"86A78303C9AB9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319048,"discussion_content":"分服务，一个服务一个库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603933439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138671,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1570417374,"is_pvip":false,"replies":[{"id":"53458","content":"是的","user_name":"作者回复","comment_id":138671,"uid":"1448977","ip_address":"","utype":1,"ctime":1570492219,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"18750286558","product_id":100035801,"comment_content":"系统的易扩展之从存储和业务拆分来考虑。业务拆分是容易理解的，专人专事；从存储角度来考虑我想是因为所有应用的功能的最终的结果都是把一些结果存储起来，于是存储就是重点，是重点就必然引起量大，量大了必然成瓶颈。打卡04。","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469615,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570492219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138002,"user_name":"StarKing","can_delete":false,"product_type":"c1","uid":1004192,"ip_address":"","ucode":"EB825CFA70AC1F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/a0/d308434e.jpg","comment_is_top":false,"comment_ctime":1569977283,"is_pvip":false,"replies":[{"id":"53113","content":"这样看你团地的运维能力了","user_name":"作者回复","comment_id":138002,"uid":"1448977","ip_address":"","utype":1,"ctime":1570060652,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"18749846467","product_id":100035801,"comment_content":"预测未来的数据库一定会综合ES+MONGODB的能力，直接选择库的模式就可以像NOSQL一样使用。","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469346,"discussion_content":"这样看你团地的运维能力了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570060652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172647,"user_name":"Christopher","can_delete":false,"product_type":"c1","uid":1757265,"ip_address":"","ucode":"1AC6035DFA4ECB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","comment_is_top":false,"comment_ctime":1579243254,"is_pvip":false,"replies":[{"id":"67144","content":"感谢您的支持和肯定，预祝新年快乐，事事如意","user_name":"作者回复","comment_id":172647,"uid":"1448977","ip_address":"","utype":1,"ctime":1579445617,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"14464145142","product_id":100035801,"comment_content":"看的是真过瘾，很有逻辑和条理性，不像一些课程要么都是曲高和寡的技术细节，要么都是泛泛白话","like_count":3,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481805,"discussion_content":"感谢您的支持和肯定，预祝新年快乐，事事如意","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579445617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146561,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1572573840,"is_pvip":false,"replies":[{"id":"56832","content":"可以看看黄建宏的redis设计与实现","user_name":"作者回复","comment_id":146561,"uid":"1448977","ip_address":"","utype":1,"ctime":1572832969,"user_name_real":"唐扬"}],"discussion_count":5,"race_medal":0,"score":"14457475728","product_id":100035801,"comment_content":"redis相关的书籍或者博客有推荐吗？前段时间刚看了一个分布式锁的文章，收获很大。","like_count":3,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472915,"discussion_content":"可以看看黄建宏的redis设计与实现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572832969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104850,"avatar":"https://static001.geekbang.org/account/avatar/00/10/db/d2/e29f8834.jpg","nickname":"lidashuang","note":"","ucode":"560ABE8032760E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297361,"discussion_content":"刚出了新的redis课程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596887467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097416,"avatar":"https://static001.geekbang.org/account/avatar/00/10/be/c8/7c5f324f.jpg","nickname":"港岛妹夫","note":"","ucode":"9F6AAA29B60D8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48979,"discussion_content":"老师推荐的书偏重原理, 如果是使用层面的话, 有一本叫Redis深度历险. 可以通读. 可以有个整体的了解, 如果平时经常用一些Redis比较简单的命令, 但是没有整体了解,可以看看这本, 过渡一下然后再看设计与实现. 上来就啃原理容易被劝退.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573542894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1079293,"avatar":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","nickname":"XD","note":"","ucode":"DC9DCFB3841A4E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1097416,"avatar":"https://static001.geekbang.org/account/avatar/00/10/be/c8/7c5f324f.jpg","nickname":"港岛妹夫","note":"","ucode":"9F6AAA29B60D8F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49383,"discussion_content":"好的，谢谢老哥~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573574195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":48979,"ip_address":""},"score":49383,"extra":""},{"author":{"id":1152145,"avatar":"https://static001.geekbang.org/account/avatar/00/11/94/91/6d6ca42f.jpg","nickname":"怀草诗","note":"","ucode":"78F8B9B4628F15","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1097416,"avatar":"https://static001.geekbang.org/account/avatar/00/10/be/c8/7c5f324f.jpg","nickname":"港岛妹夫","note":"","ucode":"9F6AAA29B60D8F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305753,"discussion_content":"西班牙馅饼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600076023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":48979,"ip_address":""},"score":305753,"extra":""}]}]},{"had_liked":false,"id":138983,"user_name":"吃饭饭","can_delete":false,"product_type":"c1","uid":1231549,"ip_address":"","ucode":"95CFA07CDA2957","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","comment_is_top":false,"comment_ctime":1570522826,"is_pvip":false,"replies":[{"id":"53637","content":"1. 其实我还没有遇到什么场景是必须要使用分布式事务的，以前做过的社区产品对一致性的要求不是很高<br>2. 池子指的是一组服务器组成的集群，比如用户池就是这个集群只提供用户相关的功能","user_name":"作者回复","comment_id":138983,"uid":"1448977","ip_address":"","utype":1,"ctime":1570582887,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"14455424714","product_id":100035801,"comment_content":"两个问题：<br>1）尽量不适用事务，这里是不是需要使用分布式事务？类似于使用消息中间件等？<br>2）图示中的`池`指的是单个的微服务吗？我第一次听说这个概念，希望老师帮忙回答：）","like_count":3,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469724,"discussion_content":"1. 其实我还没有遇到什么场景是必须要使用分布式事务的，以前做过的社区产品对一致性的要求不是很高\n2. 池子指的是一组服务器组成的集群，比如用户池就是这个集群只提供用户相关的功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570582887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074640,"avatar":"https://static001.geekbang.org/account/avatar/00/10/65/d0/c11d4a31.jpg","nickname":"滴水藏海","note":"","ucode":"9C1F9C91189F69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229552,"discussion_content":"我理解是尽量不使用分布式事务吧，单机事务还是OK的，互联网领域对于强一致性要求比较少，一般不采用分布式事务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586664591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136861,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1569544578,"is_pvip":true,"replies":[{"id":"52482","content":"池子就是一组机器组成的集群","user_name":"作者回复","comment_id":136861,"uid":"1448977","ip_address":"","utype":1,"ctime":1569545145,"user_name_real":"唐扬"}],"discussion_count":4,"race_medal":0,"score":"14454446466","product_id":100035801,"comment_content":"老师。不太理解什么是池？ 用户池 里是一台机器还是多台机器呀？","like_count":3,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468832,"discussion_content":"池子就是一组机器组成的集群","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569545145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"水目沾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37457,"discussion_content":"内存池、线程池、数据库连接池等等，我相信你能从中找到池的含义。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571620053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323868,"avatar":"https://static001.geekbang.org/account/avatar/00/14/33/5c/8c0a372a.jpg","nickname":"Fourty Seven","note":"","ucode":"DD213225842F68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29238,"discussion_content":"我理解的是线程池隔离","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570756537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1011793,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg","nickname":"Lugyedo","note":"","ucode":"EB5E456B638E70","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21857,"discussion_content":"就是一个服务集群","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569548094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145539,"user_name":"Hwan","can_delete":false,"product_type":"c1","uid":1205627,"ip_address":"","ucode":"A728C6790511BD","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/7b/66b9befd.jpg","comment_is_top":false,"comment_ctime":1572312210,"is_pvip":false,"replies":[{"id":"56181","content":"需要制定迁移方案，加餐中有介绍哦","user_name":"作者回复","comment_id":145539,"uid":"1448977","ip_address":"","utype":1,"ctime":1572319929,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"10162246802","product_id":100035801,"comment_content":"看评论说auto shard ，最近在看redis，redis通过哨兵做主从备份和主从迁移，通过集群做增加主节点和减少主节点的事情，基本可以做好自动扩容和缩容了，请问下关系型数据库里面有类似的吗，能够实现自动的扩容之类的，还是说必须需要人工来呢","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472453,"discussion_content":"需要制定迁移方案，加餐中有介绍哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572319929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207415,"user_name":"王三好","can_delete":false,"product_type":"c1","uid":1439903,"ip_address":"","ucode":"7528CB2B1EFA4B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKw8ictgYcqf6kicJ4RlmicgKvCAGLTQFmmvCWwGzGJeY5SJ8KxXNtNh12FI0IzJNYfUx1PbJcHriadbA/132","comment_is_top":false,"comment_ctime":1587084852,"is_pvip":false,"replies":[{"id":"78084","content":"👍","user_name":"作者回复","comment_id":207415,"uid":"1448977","ip_address":"","utype":1,"ctime":1587472822,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5882052148","product_id":100035801,"comment_content":"一直都是这么做的，没有系统整理过，业务池子拆分还可以根据，业务是否经常变化，经常变化的抽取出来","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492115,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587472822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195740,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1585214553,"is_pvip":false,"replies":[{"id":"75148","content":"池子里是接口","user_name":"作者回复","comment_id":195740,"uid":"1448977","ip_address":"","utype":1,"ctime":1585659131,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5880181849","product_id":100035801,"comment_content":"老师，您好！<br><br>原文“把相同业务的服务拆分成单独的业务池”<br>这里为啥取名为“池”，池子里的最小单位是服务实例，还是接口吖？<br><br>产生这样的疑问，是因为学习到按业务维度划分时，池子里都是相同业务的服务，如内容池都是一组内容服务。而按核心非核心划分时，是对接口划分。<br><br>谢谢老师！！","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489156,"discussion_content":"池子里是接口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585659131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189493,"user_name":"芳菲菲兮满堂","can_delete":false,"product_type":"c1","uid":1000860,"ip_address":"","ucode":"C8D89999C201F1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/9c/5b06d143.jpg","comment_is_top":false,"comment_ctime":1584522153,"is_pvip":true,"replies":[{"id":"73094","content":"嘿嘿😁","user_name":"作者回复","comment_id":189493,"uid":"1448977","ip_address":"","utype":1,"ctime":1584590519,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":1,"score":"5879489449","product_id":100035801,"comment_content":"如果说it存在万金油 那么可能就是拆分和分层","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487709,"discussion_content":"嘿嘿😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584590519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176414,"user_name":"JOHN","can_delete":false,"product_type":"c1","uid":1692942,"ip_address":"","ucode":"6936DE275AA543","user_header":"https://static001.geekbang.org/account/avatar/00/19/d5/0e/dae566c7.jpg","comment_is_top":false,"comment_ctime":1581054100,"is_pvip":false,"replies":[{"id":"68826","content":"是解释层面不一样吧<br><br>从写代码的角度来说，可扩展可以认为是封装变化<br><br>从架构层面来说，我认为可扩展性是可灵活扩容","user_name":"作者回复","comment_id":176414,"uid":"1448977","ip_address":"","utype":1,"ctime":1581334987,"user_name_real":"唐扬"}],"discussion_count":4,"race_medal":0,"score":"5876021396","product_id":100035801,"comment_content":"查阅了一些资料，我发现作者对于可扩展和网上大部分的解读不一样，网上的解读是架构上要封装变化，以此实现对扩展开放（开闭原则），我更加认同网上的解读，我觉得作者的这个解读更加适合 可扩容 这个词。概不过话说回来，可扩容也给我们读者提供了一个新的视角来看系统，也很棒的。","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483095,"discussion_content":"是解释层面不一样吧\n\n从写代码的角度来说，可扩展可以认为是封装变化\n\n从架构层面来说，我认为可扩展性是可灵活扩容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581334987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009831,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/68/a7/c3fd1fd9.jpg","nickname":"聪","note":"","ucode":"9D672A8580A945","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311675,"discussion_content":"代码的可扩展 \n架构的可扩展 \n中文都一样，但说的不是一回事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602460772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136684,"avatar":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","nickname":"易轻尘","note":"","ucode":"0D0CB9D6D45A70","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289321,"discussion_content":"说实话国外的教材上对scalability的定义与唐扬老师是一致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594051251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2119272,"avatar":"https://static001.geekbang.org/account/avatar/00/20/56/68/2b5ed596.jpg","nickname":"赵惠民","note":"","ucode":"C8680E4090D6E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1136684,"avatar":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","nickname":"易轻尘","note":"","ucode":"0D0CB9D6D45A70","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":366593,"discussion_content":"没错，这个词我觉得应该翻译为可伸缩性比较合适","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618128698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289321,"ip_address":""},"score":366593,"extra":""}]}]},{"had_liked":false,"id":140943,"user_name":"书中迷梦","can_delete":false,"product_type":"c1","uid":1103010,"ip_address":"","ucode":"1C6B697F41698F","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/a2/fa41c8a8.jpg","comment_is_top":false,"comment_ctime":1571097936,"is_pvip":false,"replies":[{"id":"54579","content":"支付需要考虑一致性，订单应该还好<br>","user_name":"作者回复","comment_id":140943,"uid":"1448977","ip_address":"","utype":1,"ctime":1571117417,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5866065232","product_id":100035801,"comment_content":"存储层扩展的时候，是不是加个限定词比较好，对于数据不敏感的业务可以考虑不使用事物！而不是直接不使用事物！像支付和订单这些系统，数据肯定需要一致性","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470628,"discussion_content":"支付需要考虑一致性，订单应该还好\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571117417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138803,"user_name":"longslee","can_delete":false,"product_type":"c1","uid":1465986,"ip_address":"","ucode":"C24E32E5B1B6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","comment_is_top":false,"comment_ctime":1570457148,"is_pvip":false,"replies":[{"id":"53453","content":"👍","user_name":"作者回复","comment_id":138803,"uid":"1448977","ip_address":"","utype":1,"ctime":1570491879,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5865424444","product_id":100035801,"comment_content":"nosql数据库扩容缩容，都是涉及到数据的再分配，手段是减少节点变化带来的数据迁移代价，以及减少节点变化造成的缓存失效。 老师我有个问题，有没有哪款产品是基于一致性Hash理论来做的呢，比如Redis是用的Slot，而不是一致性Hash。","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469651,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570491879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137174,"user_name":"醇梨子","can_delete":false,"product_type":"c1","uid":1089040,"ip_address":"","ucode":"25D498248A855C","user_header":"https://static001.geekbang.org/account/avatar/00/10/9e/10/3cb10bf7.jpg","comment_is_top":false,"comment_ctime":1569639941,"is_pvip":true,"replies":[{"id":"52804","content":"主要要监控一下线程池中任务的堆积情况，然后动态调整大小","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739512,"ip_address":"","comment_id":137174,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864607237","product_id":100035801,"comment_content":"我们在实际生产环境中，线程池隔离及线程池设置大小的依据是什么？","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468970,"discussion_content":"主要要监控一下线程池中任务的堆积情况，然后动态调整大小","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137109,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1569611214,"is_pvip":false,"replies":[{"id":"52805","content":"：）","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739516,"ip_address":"","comment_id":137109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5864578510","product_id":100035801,"comment_content":"坐等干货","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468944,"discussion_content":"：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341679,"user_name":"秋天","can_delete":false,"product_type":"c1","uid":1057056,"ip_address":"","ucode":"A7E1D953EF7E17","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg","comment_is_top":false,"comment_ctime":1649766513,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649766513","product_id":100035801,"comment_content":"它们一般都是基于分片和多副本的机制保障扩展性","like_count":0},{"had_liked":false,"id":322159,"user_name":"独孤九剑","can_delete":false,"product_type":"c1","uid":2230909,"ip_address":"","ucode":"6C1253E2B8C1D4","user_header":"https://static001.geekbang.org/account/avatar/00/22/0a/7d/ac715471.jpg","comment_is_top":false,"comment_ctime":1637210835,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637210835","product_id":100035801,"comment_content":"“可扩展”架构要素的关键是“拆分”，可分为“业务”层面+“数据”层面的拆分：<br>业务层面可面向“职责”、“功能”、“服务”(SOA-&gt;微服务[新服务或旧.推倒式重构：按DDD.“服务边界”+“高性能|高可用|可扩展”要素组合；旧.演进式重构：圈表-&gt;迁库-&gt;消除跨库join(分发-&gt;冗余+“流聚合”服务-&gt;大数据平台+“接口”收口即不允许应用直接访问数据库)]-&gt;中台化)拆分。<br>数据层面的拆分有“分库分表”、“分布式数据库”、Nosql...","like_count":0},{"had_liked":false,"id":320460,"user_name":"扬一场远远的风","can_delete":false,"product_type":"c1","uid":1357801,"ip_address":"","ucode":"AB47E3D2EAB8A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/b7/e9/5400cdf3.jpg","comment_is_top":false,"comment_ctime":1636341585,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636341585","product_id":100035801,"comment_content":"老师，你好。<br>“按照业务的维度拆分成用户池、内容池、关系池、评论池、点赞池和搜索池”， 这些池子是独立出来服务单独布署么？还是分模块，整体为一个服务，统一布署？","like_count":0},{"had_liked":false,"id":312489,"user_name":"亚林","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1631841377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631841377","product_id":100035801,"comment_content":"和高可用一样 第一步都是业务分级","like_count":0},{"had_liked":false,"id":306127,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1065986,"ip_address":"","ucode":"3D3D10273BED18","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/02/5c8e4b81.jpg","comment_is_top":false,"comment_ctime":1628393962,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1628393962","product_id":100035801,"comment_content":"业务池这个怎么理解，是逻辑划分（单体应用），还是物理划分（使用另一个项目来实现）","like_count":0},{"had_liked":false,"id":305984,"user_name":"钟小强","can_delete":false,"product_type":"c1","uid":1433570,"ip_address":"","ucode":"012B705562FDE9","user_header":"https://static001.geekbang.org/account/avatar/00/15/df/e2/c6d9cb4c.jpg","comment_is_top":false,"comment_ctime":1628257101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628257101","product_id":100035801,"comment_content":"高可扩展：增加机器。<br>业务平衡期，预留30%~50%的冗余。<br><br>存储层的扩展性:<br>1.分库，同一类型的库还可以有多个节点。（不能随意地增加节点，增加节点意味着要手动迁移数据）<br>业务层的扩展性：<br>拆分维度：业务维度，重要性维度，请求维度。","like_count":0},{"had_liked":false,"id":305640,"user_name":"看山","can_delete":false,"product_type":"c1","uid":1014260,"ip_address":"","ucode":"F030DD58D0BDC3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/f4/d85e7e58.jpg","comment_is_top":false,"comment_ctime":1628082114,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1628082114","product_id":100035801,"comment_content":"请问文章中的图是使用什么软件画的，可否分享一下。","like_count":0,"discussions":[{"author":{"id":3119895,"avatar":"","nickname":"李林峰","note":"","ucode":"F92DB206076FDD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588144,"discussion_content":"keynote","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663574479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"贵州"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299149,"user_name":"悟空聊架构","can_delete":false,"product_type":"c1","uid":1123163,"ip_address":"","ucode":"C2F482A0CF8AF1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","comment_is_top":false,"comment_ctime":1624493287,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1624493287","product_id":100035801,"comment_content":"数据库存储拆分和业务拆分","like_count":0},{"had_liked":false,"id":279930,"user_name":"宙斯","can_delete":false,"product_type":"c1","uid":2041396,"ip_address":"","ucode":"80DF36BAD298AD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","comment_is_top":false,"comment_ctime":1614004942,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614004942","product_id":100035801,"comment_content":"传统关系数据库需要自动实现或采用三方中间件方式扩展数据库，引入了更多层级，增大了故障发生概率且排查也更耗时。采用 nosql像 redis 其内部有实现分片扩容功能（16384插槽可分片），可自定义每个实例的插槽数，且可以作为内存数据库快速访问。","like_count":0},{"had_liked":false,"id":278539,"user_name":"陈衎","can_delete":false,"product_type":"c1","uid":1810649,"ip_address":"","ucode":"8A6535DDB4B611","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a0/d9/49578be1.jpg","comment_is_top":false,"comment_ctime":1613031637,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1613031637","product_id":100035801,"comment_content":"当数据库按照业务和数据维度拆分之后，我们尽量不要使用事务。<br>老师问下下，多业务服务之间的命令编排，若不用事务，如何有效得保证数据得一致性和原子性。","like_count":0,"discussions":[{"author":{"id":2586341,"avatar":"","nickname":"石头","note":"","ucode":"EB3C9A277C7B0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369895,"discussion_content":"一致性加分布式事务就可以了吧，原子性这个就很难了吧，都拆库了，还咋原子性？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619189550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275556,"user_name":"冰王子","can_delete":false,"product_type":"c1","uid":1310285,"ip_address":"","ucode":"6806D610AD5A3E","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/4d/c744592a.jpg","comment_is_top":false,"comment_ctime":1611583597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611583597","product_id":100035801,"comment_content":"老师，如果规划基础网络硬件设施呢？比如边界防火墙，waf，IPs，交换机等这些硬件设备呢？","like_count":0},{"had_liked":false,"id":263700,"user_name":"下个目标45k","can_delete":false,"product_type":"c1","uid":1066508,"ip_address":"","ucode":"193BA8C3AA9A61","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","comment_is_top":false,"comment_ctime":1606222682,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606222682","product_id":100035801,"comment_content":"领域驱动最重要的点就在于 业务划分 ","like_count":0},{"had_liked":false,"id":245404,"user_name":"東","can_delete":false,"product_type":"c1","uid":1657218,"ip_address":"","ucode":"B59125E442234D","user_header":"https://static001.geekbang.org/account/avatar/00/19/49/82/e34f9ce9.jpg","comment_is_top":false,"comment_ctime":1598938045,"is_pvip":false,"replies":[{"id":"90312","content":"靠后面人工补数据","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1599008861,"ip_address":"","comment_id":245404,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1598938045","product_id":100035801,"comment_content":"当数据库按照业务和数据维度拆分之后，我们尽量不要使用事务。因为当一个事务中同时更新不同的数据库时，需要使用二阶段提交，来协调所有数据库要么全部更新成功，要么全部更新失败。这个协调的成本会随着资源的扩展不断升高，最终达到无法承受的程度。<br><br>这里所说的不使用事务，那如果需要更新多张表则怎么实现统一性呢？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504875,"discussion_content":"靠后面人工补数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599008861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242099,"user_name":"~patience","can_delete":false,"product_type":"c1","uid":1614285,"ip_address":"","ucode":"8D9BC78A241CEA","user_header":"https://static001.geekbang.org/account/avatar/00/18/a1/cd/bc74741c.jpg","comment_is_top":false,"comment_ctime":1597589665,"is_pvip":false,"replies":[{"id":"90315","content":"统计的话就不太好把数据库拆分了，可以考虑别的数据存储工具","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1599009563,"ip_address":"","comment_id":242099,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1597589665","product_id":100035801,"comment_content":"数据库拆分的太细了，如果有多表联合查询，并且要分页怎么弄呢？有些统计也是","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503922,"discussion_content":"统计的话就不太好把数据库拆分了，可以考虑别的数据存储工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599009563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232612,"user_name":"易轻尘","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1594050223,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1594050223","product_id":100035801,"comment_content":"常见的 NoSQL 数据库是如何解决扩展性的问题呢？<br>1. 通过放弃关系型数据库的某些特性，例如事务的ACID特性不保证完全实现<br>2. 还是通过做数据的分片，将不同的数据映射到不同的存储服务器上","like_count":0},{"had_liked":false,"id":228540,"user_name":"xiaochao321","can_delete":false,"product_type":"c1","uid":1083596,"ip_address":"","ucode":"8F5AC46CD9400C","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/cc/11b10a6f.jpg","comment_is_top":false,"comment_ctime":1592729997,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592729997","product_id":100035801,"comment_content":"业务拆分以后，涉及到关联查询怎么处理？","like_count":0},{"had_liked":false,"id":210004,"user_name":"辰砂","can_delete":false,"product_type":"c1","uid":1434623,"ip_address":"","ucode":"09983281C39CC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/e3/ff/51ea6737.jpg","comment_is_top":false,"comment_ctime":1587650716,"is_pvip":false,"replies":[{"id":"78349","content":"谢谢~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1587699341,"ip_address":"","comment_id":210004,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587650716","product_id":100035801,"comment_content":"条理清晰，非常感谢！","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492912,"discussion_content":"谢谢~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587699341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203300,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1586168133,"is_pvip":false,"replies":[{"id":"78261","content":"存储上容器的还是少","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1587623695,"ip_address":"","comment_id":203300,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586168133","product_id":100035801,"comment_content":"如何让系统易于扩展？老师，这里核心就是拆，服务拆分＋数据存储拆分，职责单一利于维护和扩展。不过我觉得是容器化技术的发展，使的这一切变得容易的，否则加机器减机器编译构建发布上线，很耗时费力和笨重。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490824,"discussion_content":"存储上容器的还是少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587623695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187582,"user_name":"xuanyuan","can_delete":false,"product_type":"c1","uid":1113737,"ip_address":"","ucode":"1EC79B9372868F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2icbib62icXtibTkThtyRksbuJLoTLMts7zook2S30MiaBtbz0f5JskwYicwqXkhpYfvCpuYkcvPTibEaQ/132","comment_is_top":false,"comment_ctime":1584164074,"is_pvip":false,"replies":[{"id":"73111","content":"组件后面有介绍","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1584591158,"ip_address":"","comment_id":187582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584164074","product_id":100035801,"comment_content":"这和隔壁《从0开始学微服务》的服务拆分思路一样，这里更详细一点，但是还不够全面。比如公共组件、性能等维度的考虑","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487155,"discussion_content":"组件后面有介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584591158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182803,"user_name":"polebug","can_delete":false,"product_type":"c1","uid":1701390,"ip_address":"","ucode":"02F2CCDFE693C3","user_header":"https://static001.geekbang.org/account/avatar/00/19/f6/0e/2e07610e.jpg","comment_is_top":false,"comment_ctime":1582868671,"is_pvip":false,"replies":[{"id":"71093","content":"数据库连接池没有数据，只有连接，数据是存储在库中的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1583114900,"ip_address":"","comment_id":182803,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582868671","product_id":100035801,"comment_content":"您说到mysql存储是有状态的，增加或减少机器需要数据迁移<br>那么使用数据库池，就没有这个问题了吗？数据库池里的数据是怎么存储的，没有一致性问题吗？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485459,"discussion_content":"数据库连接池没有数据，只有连接，数据是存储在库中的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583114900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162229,"user_name":"大龄程序员在线治掉发","can_delete":false,"product_type":"c1","uid":1763091,"ip_address":"","ucode":"A246D4E4683589","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e7/13/6f76ada6.jpg","comment_is_top":false,"comment_ctime":1576480752,"is_pvip":false,"replies":[{"id":"62153","content":"确实，改造老系统极为蛋疼","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1576737129,"ip_address":"","comment_id":162229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576480752","product_id":100035801,"comment_content":"按模块拆分,可以理解为业务分库吧,但是在一些关系型数据库的老系统,太多的关系查询,改起来也是个蛋疼得问题","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477983,"discussion_content":"确实，改造老系统极为蛋疼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576737129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157815,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1575264060,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1575264060","product_id":100035801,"comment_content":"拆分的关键， 信息正交。","like_count":0,"discussions":[{"author":{"id":1755152,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VTPuhJb5xxuRwH1iblqrAe3De4PoETgNWibZRkLlhvszysdtpAvSPZFuYtsJfWJmoXOFFWnpR02W9NGIiammU8UPg/132","nickname":"Info_E","note":"","ucode":"97207B2CC4C776","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352036,"discussion_content":"对 如果子系统间有依赖关系，那是不好拆分的，不知道后面有没有解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614580737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157072,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1575024675,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575024675","product_id":100035801,"comment_content":"拆服务  冷热隔离","like_count":0},{"had_liked":false,"id":148038,"user_name":"雷霹雳的爸爸","can_delete":false,"product_type":"c1","uid":1119490,"ip_address":"","ucode":"99BBA6D83DD11F","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg","comment_is_top":false,"comment_ctime":1572932108,"is_pvip":true,"replies":[{"id":"57339","content":"其实也不难，实现方式大同小异","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1573170364,"ip_address":"","comment_id":148038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572932108","product_id":100035801,"comment_content":"按文中描述，如果NoSQL有这种优势得话，应该主要体现在分片和自动数据迁移的能力上，这块儿还真不熟，一直觉得就是支持这两个功能，实现起来也挺难的，有很多的中间状态要考虑对外响应过程中的一致性问题，依然是一个巨大的挑战，先往后看...","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473377,"discussion_content":"其实也不难，实现方式大同小异","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573170364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146301,"user_name":"无形","can_delete":false,"product_type":"c1","uid":1016889,"ip_address":"","ucode":"B740E2A68A17A5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/39/c8772466.jpg","comment_is_top":false,"comment_ctime":1572491927,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1572491927","product_id":100035801,"comment_content":"对于一个较为复杂的系统，业务上按照功能拆分为不同的子系统，子系统之间解藕，降低整体实现的复杂度，如果子系统是分布式服务，要提高扩展性，要做到服务之间的无状态，解决数据的一致性，请求量大时就能随时扩充机器，提高系统的整体服务能力","like_count":0},{"had_liked":false,"id":138108,"user_name":"Gojustforfun","can_delete":false,"product_type":"c1","uid":1187021,"ip_address":"","ucode":"7513A40F27344F","user_header":"https://static001.geekbang.org/account/avatar/00/12/1c/cd/8d552516.jpg","comment_is_top":false,"comment_ctime":1570025048,"is_pvip":true,"replies":[{"id":"53119","content":"软件方面也可以成为可扩展，两者在思想上是一样的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1570060913,"ip_address":"","comment_id":138108,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1570025048","product_id":100035801,"comment_content":"老师文中的“可扩展”更侧重于“硬件”，其实还有“软件”方面的——更易于添加新的功能或模块。我看到有的书中将前者称为“可伸缩”，后者称为“可扩展”。另外，系统设计的目标中还可以加上安全性","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469388,"discussion_content":"软件方面也可以成为可扩展，两者在思想上是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570060913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274495,"avatar":"https://static001.geekbang.org/account/avatar/00/13/72/7f/5da093c5.jpg","nickname":"水目沾","note":"","ucode":"FDD1D15C277D58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37459,"discussion_content":"哈哈，李运华那里过来的吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571620191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137790,"user_name":"蓝魔丶","can_delete":false,"product_type":"c1","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1569851685,"is_pvip":false,"replies":[{"id":"53106","content":"是的，这些是横向扩展的方式","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1570060266,"ip_address":"","comment_id":137790,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569851685","product_id":100035801,"comment_content":"比如elasticsearch的分片，集群，副本","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469263,"discussion_content":"是的，这些是横向扩展的方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570060266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137530,"user_name":"Lugyedo","can_delete":false,"product_type":"c1","uid":1011793,"ip_address":"","ucode":"EB5E456B638E70","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg","comment_is_top":false,"comment_ctime":1569766911,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1569766911","product_id":100035801,"comment_content":"MongoDB可以根据key在集群内自动分片","like_count":0},{"had_liked":false,"id":137424,"user_name":"小凡","can_delete":false,"product_type":"c1","uid":1201372,"ip_address":"","ucode":"F9BBA28150D278","user_header":"https://static001.geekbang.org/account/avatar/00/12/54/dc/c158a8c4.jpg","comment_is_top":false,"comment_ctime":1569738619,"is_pvip":false,"replies":[{"id":"52867","content":"我这里说的二阶段提交指的是为了在分布式架构中为了保证事务一致性的算法","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569807111,"ip_address":"","comment_id":137424,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569738619","product_id":100035801,"comment_content":"当一个事务中同时更新不同的数据库时，需要使用二阶段提交<br>––––––––––––––––––––––––––––––––––<br>请问下，难道更新一样的库，就不会使用二阶段提交了吗。二阶段提交不是只要是innodb引擎的事务都会有的么，为了保证redo log和binlog的一致性","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469083,"discussion_content":"我这里说的二阶段提交指的是为了在分布式架构中为了保证事务一致性的算法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569807111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137266,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1569672883,"is_pvip":false,"replies":[{"id":"52802","content":"业务池其实是一种隔离部署的方式，不是平台或者中台。","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739407,"ip_address":"","comment_id":137266,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1569672883","product_id":100035801,"comment_content":"nosql是牺牲ACID做到的扩展性的<br>业务池这个概念第一次接触，这更像是按领域划分的服务化&#47;微服务，还是更像平台&#47;中台？<br>如果这是个概念模型，尤其是业务池也区分核心池与非核心池，希望在未来课程中有“相应现实架构的对照”的内容，能举例讲解一下如何用核心与非核心指导系统做降级设计。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469007,"discussion_content":"业务池其实是一种隔离部署的方式，不是平台或者中台。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1232334,"avatar":"","nickname":"13761642169","note":"","ucode":"68137695FC2120","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192739,"discussion_content":"为什么这么多人问这个问题，这个不就是相当于 一个服务集群的概念嘛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583078595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"约书亚","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23508,"discussion_content":"明白了，谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569828162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137209,"user_name":"Wilson","can_delete":false,"product_type":"c1","uid":1084864,"ip_address":"","ucode":"24216CBE879275","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/c0/e412677e.jpg","comment_is_top":false,"comment_ctime":1569650758,"is_pvip":false,"replies":[{"id":"52803","content":"数据库分类还不算是微服务，是对数据库的一种扩展方式。rdbms如果有外键，那么就尽量考虑使用外键来作为分库分表键","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739476,"ip_address":"","comment_id":137209,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569650758","product_id":100035801,"comment_content":"數據庫分類是指微服務嗎？若是rdbms會有外鍵等關聯，該怎麼拆分呢？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468984,"discussion_content":"数据库分类还不算是微服务，是对数据库的一种扩展方式。rdbms如果有外键，那么就尽量考虑使用外键来作为分库分表键","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137041,"user_name":"Jasper","can_delete":false,"product_type":"c1","uid":1202174,"ip_address":"","ucode":"A07ABF45D39089","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/fe/beab006d.jpg","comment_is_top":false,"comment_ctime":1569582286,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1569582286","product_id":100035801,"comment_content":"打卡，唐老师好","like_count":0},{"had_liked":false,"id":137030,"user_name":"正在减肥的胖籽。","can_delete":false,"product_type":"c1","uid":1033728,"ip_address":"","ucode":"99E2E4DF599236","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c6/00/683bb4f0.jpg","comment_is_top":false,"comment_ctime":1569578743,"is_pvip":false,"replies":[{"id":"52807","content":"后面实战篇会专门说到哈~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739633,"ip_address":"","comment_id":137030,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569578743","product_id":100035801,"comment_content":"老师您好，像微博这种UGC的产品，用户不停的发帖。但是APP需要展现出用户发帖,（根据一定规则排序）实施查库肯定是不太可行的。老师这种场景的例子可以说下怎么优化吗？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468912,"discussion_content":"后面实战篇会专门说到哈~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136896,"user_name":"jack","can_delete":false,"product_type":"c1","uid":1182934,"ip_address":"","ucode":"D3DBD1DC490E1E","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/d6/2677ec43.jpg","comment_is_top":false,"comment_ctime":1569549382,"is_pvip":false,"replies":[{"id":"52810","content":"👍👍👍","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569739669,"ip_address":"","comment_id":136896,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569549382","product_id":100035801,"comment_content":"心得：在业务发展的不同时期扩容的瓶颈点可能涉及到数据库连接，磁盘IO，网络带宽。以及从存储与业务两个维度去扩容：存储维度涉及到垂直与水平拆分，业务层把每块业务拆分成单独的业务池，并且区分核心与非核心接口，非核心接口在访问量大时降级熔断。希望老师在后面的课程有对系统在不同阶段拆分细节统一案例的介绍。<br>思考时间：现在常见的NoSQL数据库redis是通过固定数目slot来对数据水平拆分，扩容的时候只需要移动slot","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468850,"discussion_content":"👍👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569739669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136866,"user_name":"小可","can_delete":false,"product_type":"c1","uid":1006735,"ip_address":"","ucode":"8834AF621FA67D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","comment_is_top":false,"comment_ctime":1569545046,"is_pvip":false,"replies":[{"id":"52500","content":"可以考虑多网卡绑定","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569548122,"ip_address":"","comment_id":136866,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1569545046","product_id":100035801,"comment_content":"老师我问下，像流量打满网卡的多个服务，怎么做负载均衡？请求很大，响应很小的，瓶颈都在前置机网卡了，nginx,lvs都不满足","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468834,"discussion_content":"可以考虑多网卡绑定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569548122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004192,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/a0/d308434e.jpg","nickname":"StarKing","note":"","ucode":"EB825CFA70AC1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23992,"discussion_content":"在交换机上有个东东叫TRUNK，另外可以扩展为光口模块，速度更快。如果不够真的不能用硬件堆砌来解决的，这时候要考虑全局了，甚至要限流保证核心服务的高可用!不要盲目的加。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1569977122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1006735,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","nickname":"小可","note":"","ucode":"8834AF621FA67D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004192,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/a0/d308434e.jpg","nickname":"StarKing","note":"","ucode":"EB825CFA70AC1F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23995,"discussion_content":"厉害厉害，灰常感谢👍🏻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569978020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":23992,"ip_address":""},"score":23995,"extra":""}]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25087,"discussion_content":"对于TYUNK隐隐约约有点印象，多学习吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570416915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136859,"user_name":"Lion","can_delete":false,"product_type":"c1","uid":1046693,"ip_address":"","ucode":"294219DA53038C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/a5/08b868e8.jpg","comment_is_top":false,"comment_ctime":1569544520,"is_pvip":false,"replies":[{"id":"52483","content":"主从架构可能还无法很好解决热key的问题","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569545188,"ip_address":"","comment_id":136859,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1569544520","product_id":100035801,"comment_content":"1、如果是读多写少，可用主从架构；这个能较好解决热key问题。<br>2、如果读写都多用集群。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468831,"discussion_content":"主从架构可能还无法很好解决热key的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569545188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046693,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/a5/08b868e8.jpg","nickname":"Lion","note":"","ucode":"294219DA53038C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22339,"discussion_content":"除了代码优化，还有什么架构能很好解决的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569628360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136855,"user_name":"饭团","can_delete":false,"product_type":"c1","uid":1332557,"ip_address":"","ucode":"E24F240CC91BE8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","comment_is_top":false,"comment_ctime":1569544258,"is_pvip":false,"replies":[{"id":"52484","content":"如何做缓存的话，就要尽量避免穿透。至于如何避免穿透，后面有专门的介绍哦<br>","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569545279,"ip_address":"","comment_id":136855,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1569544258","product_id":100035801,"comment_content":"考虑到Nosql一般作为缓存系统使用，如果缓存系统没有对应数据会回表查询数据！所以当加减机器时我们应该尽量避免大量数据的损失，比如使用一致性hash算法做一些均衡处理！","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468828,"discussion_content":"如何做缓存的话，就要尽量避免穿透。至于如何避免穿透，后面有专门的介绍哦\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569545279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1332557,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","nickname":"饭团","note":"","ucode":"E24F240CC91BE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21826,"discussion_content":"嗯嗯！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569545369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136851,"user_name":"榕","can_delete":false,"product_type":"c1","uid":1053178,"ip_address":"","ucode":"4611A40E21ECEB","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/fa/e0dcc1bf.jpg","comment_is_top":false,"comment_ctime":1569543845,"is_pvip":false,"replies":[{"id":"52485","content":"NoSQL也不一定会有NameServier这种结构","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1569545336,"ip_address":"","comment_id":136851,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1569543845","product_id":100035801,"comment_content":"Nosql拓展性一般都是采用NameServer+DataServer+分布式存储系统（hdfs）的架构模式。数据以块为单位进行管理。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468827,"discussion_content":"NoSQL也不一定会有NameServier这种结构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569545336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244248,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg","nickname":"随风","note":"","ucode":"86A78303C9AB9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223483,"discussion_content":"打卡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586229625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}