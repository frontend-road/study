{"id":615378,"title":"13ï½œé›†æˆæ¡†æ¶ï¼šæ¡†æ¶å¦‚ä½•ä¸Springæœ‰æœºç»“åˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•è¾‰ã€‚ä¸Šä¸€è®²æˆ‘ä»¬çºµè§ˆäº†æ¡†æ¶åœ¨æºç ä¸­æ˜¯æ€ä¹ˆä½“ç°çš„ï¼Œä»Šå¤©æ¥å­¦ä¹ æ¡†æ¶çš„é›†æˆã€‚</p><p>å¦‚æœä½ å¼€å‘è¿‡ä»¥ Spring æ¡†æ¶ä¸ºåŸºç¡€çš„åº”ç”¨ï¼Œå°±ä¼šçŸ¥é“ Dubbo æ¡†æ¶å¸¸è¢«å½“ä½œç¬¬ä¸‰æ–¹æ¡†æ¶é›†æˆåˆ°åº”ç”¨ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ ä¼šç»å¸¸çœ‹åˆ° Spring é›†æˆ Dubbo æ¡†æ¶ã€Spring Boot é›†æˆ Dubbo æ¡†æ¶ã€‚</p><p>ç„¶è€Œå½“ Spring é›†æˆ Dubbo æ¡†æ¶åï¼Œä¸ºä»€ä¹ˆä½ åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œåªç”¨äº† @DubboReference æ³¨è§£å°±å¯ä»¥è°ƒç”¨æä¾›æ–¹çš„æœåŠ¡äº†å‘¢ï¼Ÿå°±åƒä½¿ç”¨ Spring çš„ @Autowiredã€@Resource æ³¨è§£ä¸€æ ·æ–¹ä¾¿ï¼Œç©¶ç«Ÿ Dubbo æ¡†æ¶æ˜¯æ€ä¹ˆä¸ Spring æ— ç¼ç»“åˆçš„å‘¢ï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„å­¦ä¹ ã€‚</p><p>ä¸€åˆ‡éƒ½è¦ä»æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç¼–å†™ä»£ç è°ƒç”¨è¿œç¨‹æ¥å£è®²èµ·ã€‚</p><h2>ç°çŠ¶ integration å±‚ä»£ç ç¼–å†™å½¢å¼</h2><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªå·²ç»é›†æˆäº† Dubbo æ¡†æ¶çš„æ¶ˆè´¹æ–¹ç³»ç»Ÿï¼Œä½ éœ€è¦ç¼–å†™ä»£ç è¿œç¨‹è°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿï¼Œè·å–ä¸šåŠ¡æ•°æ®ã€‚è¿™æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚äº†ã€‚</p><p>å½“ç³»ç»Ÿè®¾è®¡çš„å±‚æ¬¡æ¯”è¾ƒé²œæ˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠè°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿçš„åŠŸèƒ½éƒ½æ”¾åœ¨ integration å±‚ï¼Œä¹Ÿå°±æ„å‘³ç€å½“å‰ç³»ç»Ÿè°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿçš„å¼•ç”¨å…³ç³»éƒ½å°è£…åœ¨ integration å±‚ã€‚é‚£ä½ çš„ä»£ç å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š</p><pre><code class=\"language-java\">public interface SamplesFacade {\n    QueryOrderRes queryOrder(QueryOrderReq req);\n}\n</code></pre><!-- [[[read_end]]] --><pre><code class=\"language-java\">public interface SamplesFacadeClient {\n    QueryOrderResponse queryRemoteOrder(QueryOrderRequest req);\n}\n\npublic class SamplesFacadeClientImpl implements SamplesFacadeClient {\n    @DubboReference\n    private SamplesFacade samplesFacade;\n    @Override\n    public QueryOrderResponse queryRemoteOrder(QueryOrderRequest req){\n        // æ„å»ºä¸‹æ¸¸ç³»ç»Ÿéœ€è¦çš„è¯·æ±‚å…¥å‚å¯¹è±¡\n        QueryOrderReq integrationReq = buildIntegrationReq(req);\n        \n        // è°ƒç”¨ Dubbo æ¥å£è®¿é—®ä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿ\n        QueryOrderRes resp = samplesFacade.queryOrder(integrationReq);\n        \n        // åˆ¤æ–­è¿”å›çš„é”™è¯¯ç æ˜¯å¦æˆåŠŸ\n        if(!\"000000\".equals(resp.getRespCode())){\n            throw new RuntimeException(\"ä¸‹æ¸¸ç³»ç»Ÿ XXX é”™è¯¯ä¿¡æ¯\");\n        }\n        \n        // å°†ä¸‹æ¸¸çš„å¯¹è±¡è½¬æ¢ä¸ºå½“å‰ç³»ç»Ÿçš„å¯¹è±¡\n        return convert2Response(resp);\n    }\n}\n</code></pre><p>å¤§æ€è·¯å¾ˆæ¸…æ™°ï¼š</p><ul>\n<li>SamplesFacade æ˜¯ä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿå®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä¸­æœ‰ä¸€ä¸ª queryOrder çš„æ–¹æ³•ã€‚</li>\n<li>SamplesFacadeClient æ˜¯åœ¨ integration å±‚ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”ä¹Ÿå®šä¹‰äº†ä¸€ä¸ª queryRemoteOrder æ–¹æ³•ï¼Œä¸“é—¨è´Ÿè´£ä¸ SamplesFacade çš„ queryOrder æ‰“äº¤é“ã€‚</li>\n<li>SamplesFacadeClientImpl ä¹Ÿæ˜¯å®šä¹‰åœ¨ integration å±‚ä¸­ï¼Œå¹¶ä¸”å®ç°äº† SamplesFacadeClient æ¥å£ï¼Œé‡å†™äº† queryRemoteOrder æ–¹æ³•ã€‚</li>\n</ul><p>é‡ç‚¹çœ‹å°è£…äº†è°ƒç”¨ä¸‹æ¸¸æ¥å£é€»è¾‘çš„ queryRemoteOrder æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæ„å»ºè°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿçš„å¯¹è±¡ï¼Œç„¶åæŠŠå¯¹è±¡ä¼ å…¥ä¸‹æ¸¸ç³»ç»Ÿçš„æ¥å£ä¸­ï¼Œå†æ¥æ”¶è¿”å‚å¹¶é’ˆå¯¹é”™è¯¯ç åˆ¤æ–­ä¸€ä¸‹ï¼Œæœ€åè½¬æˆè‡ªå·±çš„ Bean å¯¹è±¡ã€‚</p><p>å°è£…èµ·æ¥æ˜¯å¥½äº‹ï¼Œç›®çš„ä¹Ÿæ˜¯æƒ³åˆ©ç”¨ integration å±‚æ¥å±è”½ä¸‹æ¸¸æä¾›æ–¹å„ç§æ¥å£çš„å·®å¼‚æ€§ã€‚</p><p>ç„¶è€Œï¼Œå½“æˆ‘ä»¬åœ¨ integration å±‚ä¸­éœ€è¦å¯¹æ¥å¾ˆå¤šä¸‹æ¸¸æä¾›æ–¹ç³»ç»Ÿçš„æ¥å£æ—¶ï¼Œå°±æ„å‘³ç€éœ€è¦å†™å¾ˆå¤šå’Œ queryRemoteOrder è°ƒç”¨æµç¨‹ç›¸ä¼¼çš„ä»£ç ï¼ŒåŸºæœ¬ç»“æ„éƒ½æ˜¯<strong>è¯·æ±‚å¯¹è±¡ç»„è£…ã€è¿œç¨‹è°ƒç”¨ã€è¿”å‚æ•°æ®çš„åˆ¤æ–­ä¸è½¬æ¢</strong>ã€‚</p><p>ä¸€æƒ³åˆ°è¦å†™ä¸€å †ç›¸ä¼¼çš„ä»£ç ï¼Œä½ ä¹Ÿè®¸å°±æœ‰ç‚¹çƒ¦èºäº†ï¼Œè¿™äº›éƒ½æ˜¯é‡å¤æ€§çš„æœºæ¢°åŠ³åŠ¨å•Šï¼Œä¸ºä»€ä¹ˆ integration å±‚çš„ä»£ç ä¸èƒ½ç®€å•ç‚¹å‘¢ï¼Ÿ</p><h2>å¦‚ä½•æ”¹å–„ integration å±‚ä»£ç </h2><p>æƒ³ç®€åŒ– integration å±‚çš„ä»£ç ç¼–å†™ï¼Œé¦–å…ˆæˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šintegration å±‚ä¸­æœ‰å¾ˆå¤šå’Œ SamplesFacadeClientImpl ç›¸ä¼¼çš„ç±»ï¼Œè€Œä¸”æ¯ä¸ªæ–¹æ³•çš„å®ç°é€»è¾‘éƒ½å’Œ queryRemoteOrder å·®ä¸å¤šï¼Œè¯¥æ€ä¹ˆç®€åŒ–å‘¢ï¼Ÿ</p><p>â€œç®€åŒ–â€è¿™ä¸ªè¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸å¤ªå¸¸ç”¨ï¼Œä½†ç®€åŒ–ä»£ç ï¼Œæœ€ç»ˆéƒ½æ˜¯éœ€è¦é€šè¿‡åˆ›å»ºç±»ã€æ–¹æ³•ã€å˜é‡æ¥ç¼–å†™å„ç§ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¹ˆè¯´ä½ æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰äº†ã€‚</p><p>é‚£æˆ‘ä»¬å†ç»†æƒ³ä¸€ä¸‹ï¼Œåˆ›å»ºç±»ã€æ–¹æ³•ã€å˜é‡ï¼Œåˆåœ¨é¢å‘è°è¿›è¡Œç¼–ç å‘¢ï¼Ÿçœ¼å‰ä¸€äº®çš„ä½ è¿…é€Ÿè¯´å‡ºâ€œé¢å‘å¯¹è±¡â€ã€‚é‚£é¢å‘å¯¹è±¡çš„ç‰¹å¾åˆæ˜¯ä»€ä¹ˆï¼Ÿä½ åœ¨è„‘æµ·é‡Œè¿…é€Ÿå›é¡¾äº†ä¸€é Java å…¥é—¨çº§åˆ«çš„å…«è‚¡æ–‡ï¼Œè¯´å‡ºäº†â€œæŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€â€ã€‚</p><p>æ²¡é”™ï¼Œé‚£å¯¹äºä»Šå¤©çš„é—®é¢˜ï¼Œå¾ˆå¤šä»£ç éƒ½æ˜¯ç›¸ä¼¼æµç¨‹ï¼Œæˆ‘ä»¬åˆè¯¥ç”¨é¢å‘å¯¹è±¡çš„å“ªä¸ªç‰¹å¾è¿›è¡Œæ€è€ƒå‘¢ï¼Ÿ</p><p>ä½ è¯•ç€ä¸€ä¸ªä¸ªå¥—ç”¨ï¼Œå‘ç°å¯ä»¥å°†ç›¸ä¼¼æµç¨‹çš„éª¨æ¶æŠ½è±¡å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥å°†ç›¸ä¼¼æµç¨‹ä¸­å˜åŒ–çš„å› ç´ æå–ä¸ºå˜é‡ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨ä¸€ä¸ªç»Ÿä¸€çš„å°è£…æ–¹æ³•ã€‚å‘ç°æ²¡ï¼Œä½ ä¸€ä¸‹å°±ç”¨åˆ°äº†<strong>â€œæŠ½è±¡â€â€œå°è£…â€</strong>ä¸¤ä¸ªç‰¹å¾ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆæŠŠè¿™ä¸¤ä¸ªç‰¹å¾çš„æ€è·¯è½åœ°äº†ã€‚æˆ‘ä»¬ä¸å¦¨å…ˆæ¥çœ‹çœ‹å¦‚ä½•å°è£…ã€‚</p><h3>1. å°è£…</h3><p>å°è£…ï¼Œå¯ä»¥æŠŠç›¸ä¼¼æµç¨‹ä¸­å˜åŒ–çš„å› ç´ æå–ä¸ºå˜é‡ï¼Œé‚£ä¹ˆåœ¨ç»Ÿä¸€çš„å°è£…æ–¹æ³•ä¸­ï¼Œæœ‰å“ªäº›å˜é‡å› ç´ å‘¢ï¼Ÿæˆ‘ä»¬é¡ºç€è°ƒç”¨é“¾ç»§ç»­æ€è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/25/d0/25756f010c64e74ec919160bc5bfb7d0.jpg?wh=1920x717\" alt=\"å›¾ç‰‡\"></p><ul>\n<li>å› ç´ 1ï¼šæ€ä¹ˆçŸ¥é“è°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹çš„å“ªä¸ªæ¥å£å‘¢ï¼Ÿè¿™è¯´æ˜ä¸‹æ¸¸çš„æ¥å£ç±»åã€æ–¹æ³•åã€æ–¹æ³•å…¥å‚ç±»åæ˜¯å˜é‡å› ç´ ã€‚</li>\n<li>å› ç´ 2ï¼šæ€ä¹ˆåŒºåˆ†å„ä¸ªè°ƒç”¨æ–¹çš„ timeoutã€retriesã€cacheã€loadbalance ç­‰å‚æ•°å±æ€§å‘¢ï¼Ÿè¿™è¯´æ˜æ¶ˆè´¹æ–¹æ¥å£çº§åˆ«çš„Dubboå‚æ•°å±æ€§ä¹Ÿæ˜¯å˜é‡å› ç´ ã€‚</li>\n<li>å› ç´ 3ï¼šè°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹æ¥å£åæ‹¿åˆ°è¿”å›ï¼Œæœ‰äº›æ¥å£éœ€è¦åˆ¤æ–­é”™è¯¯ç ï¼Œæœ‰äº›æ¥å£ä¸éœ€è¦åˆ¤æ–­ï¼Œè€Œä¸”ä¸åŒæ¥å£çš„é”™è¯¯ç å­—æ®µã€é”™è¯¯ç å­—æ®µçš„å€¼ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚è¿™è¯´æ˜è¿”å‚é”™è¯¯ç çš„åˆ¤æ–­å½¢å¼ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡å› ç´ ã€‚</li>\n<li>å› ç´ 4ï¼šæ‹¿åˆ°ä¸‹æ¸¸æ¥å£çš„è¿”å›æ•°æ®åï¼Œæ€ä¹ˆè½¬æˆå„ä¸ªè°ƒç”¨æ–¹æƒ³è¦çš„å¯¹è±¡å‘¢ï¼Ÿè¿™è¯´æ˜å°†æ•°æ®è½¬æˆå„ä¸ªè°ƒç”¨æ–¹æœŸæœ›çš„å¯¹è±¡ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡å› ç´ ã€‚</li>\n</ul><p>å¦‚æœæŠŠè¿™å››ç§å› ç´ éƒ½å˜æˆç›¸åº”å¯¹è±¡ï¼Œå°±ç›¸å½“äº<strong>åœ¨ç»Ÿä¸€çš„å°è£…æ–¹æ³•ä¸­æ¥æ”¶å››å¤§å¯¹è±¡ï¼Œè€Œåœ¨ SamplesFacadeClientImpl è¿™æ ·çš„å®ç°ç±»ä¸­ï¼Œæœ€ç»ˆå°±åªéœ€è¦è°ƒç”¨ç»Ÿä¸€çš„å°è£…æ–¹æ³•</strong>ï¼Œåªæ˜¯åœ¨æ„å»ºæ–¹æ³•å‚æ•°éœ€è¦çš„å››å¤§å¯¹è±¡æœ‰åŒºåˆ«ç½¢äº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/39/6c9866687ffb1346545a49903d3dc339.jpg?wh=1920x829\" alt=\"å›¾ç‰‡\"></p><p>åˆ†æä¸€ä¸‹ç°åœ¨çš„æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥æ˜¯æŠŠé€»è¾‘å°è£…å¥½äº†ï¼Œå¯æ˜¯ä»ç„¶ä¼šå»ºç«‹å¥½å¤šåƒ SamplesFacadeClientImpl çš„å®ç°ç±»ï¼Œè€Œä¸”åœ¨å®ç°ç±»ä¸­è¿˜å¾—ç»„è£…å„ç§å‚æ•°å‡‘é½4ä¸ªå¤§å¯¹è±¡ï¼Œæœ‰ç‚¹ç¹çï¼Œä¸å°½å¦‚äººæ„ã€‚ä½†å‹‰å¼ºç”¨ä¹Ÿè¿˜å‡‘åˆï¼Œæš‚æ—¶ä¹Ÿæ²¡èƒ½æƒ³åˆ°æ›´å¥½çš„å°è£…æ–¹å¼ã€‚</p><p>æˆ‘ä»¬ä¸å¦¨æ¥ç€æ¢ç´¢æŠ½è±¡æ€è·¯çœ‹çœ‹ã€‚</p><h3>2. æŠ½è±¡</h3><p>æŠ½è±¡ï¼Œæ˜¯æŠŠç›¸ä¼¼æµç¨‹çš„éª¨æ¶æŠ½è±¡å‡ºæ¥ï¼Œå¯æ˜¯åˆ°åº•è¯¥æ€ä¹ˆæŠ½è±¡å‘¢ï¼Ÿ</p><p>æˆ‘ç†è§£çš„æŠ½è±¡å°±æ˜¯å»æ‰è¡¨è±¡ä¿ç•™ç›¸å¯¹ä¸å˜çš„ï¼Œå¥½æ¯”æ ‘å¶å»æ‰è¡¨çš®å’Œå¶è‚‰ï¼Œæœ€åç•™ä¸‹äº†ç›¸å¯¹ç¨³å®šçš„å¶è„‰ç»“æ„ï¼Œæˆ–è€…å¤§è±¡å»æ‰çš®å’Œè‚‰ï¼Œæœ€åç•™ä¸‹äº†ç›¸å¯¹ç¨³å®šçš„éª¨éª¼ç»“æ„ã€‚</p><p>å°±ä»£ç æ¥è¯´ï¼Œä»€ä¹ˆæ˜¯ç›¸å¯¹ç¨³å®šä¸å˜çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯æµç¨‹ã€‚</p><p>ä¸€æ®µä»£ç çš„æµç¨‹ï¼Œå¯ä»¥æ˜¯ä¸šåŠ¡æµç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£ç æµç¨‹ï¼Œè¿˜å¯ä»¥æ˜¯è°ƒç”¨æµç¨‹ï¼Œå½“ç„¶æœ¬è´¨éƒ½æ˜¯ä¸€å°å—ç›¸å¯¹èšç„¦çš„ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒä¸»å¹²æµç¨‹ï¼ŒæŠŠä¸å˜çš„æµç¨‹å›ºåŒ–ä¸‹æ¥å˜æˆæ¨¡æ¿ï¼Œç„¶åæŠŠå˜åŒ–çš„å› ç´ äº¤ç»™å„ä¸ªè°ƒç”¨æ–¹ï¼Œæ„åœ¨æ±‚åŒå­˜å¼‚ï¼Œè¿½æ±‚â€œä¸å˜â€çš„ç¨³å®šï¼Œæ”¾ä»»â€œå˜åŒ–â€çš„è‡ªç”±ã€‚</p><p>é‚£æˆ‘ä»¬ç›®å‰çš„ä»£ç ï¼Œç›¸å¯¹ä¸å˜çš„æµç¨‹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æœºæ™ºçš„ä½ ä¸€ä¸‹æƒ³åˆ°ä¸å˜çš„æµç¨‹å°±æ˜¯è¦é‡å¤å†™çš„é‚£æ®µé€»è¾‘ï¼šå…ˆæ„å»ºè°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿçš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶å°†è¯·æ±‚å¯¹è±¡ä¼ å…¥ä¸‹æ¸¸ç³»ç»Ÿçš„æ¥å£ä¸­ï¼Œç„¶åæ¥æ”¶è¿”å‚å¹¶é’ˆå¯¹é”™è¯¯ç è¿›è¡Œåˆ¤æ–­ï¼Œæœ€åè½¬æˆè‡ªå·±çš„ Bean å¯¹è±¡ã€‚</p><p>é€»è¾‘æ˜¯æŠ½è±¡å‡ºæ¥äº†ï¼Œä½†æ¥ä¸‹æ¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å…¶å®è¿™é‡Œçš„å…³é”®åœ¨äºæ¢ä½æ€è€ƒï¼Œä»£ç è°ƒç”¨æµç¨‹æˆ‘ä»¬çŸ¥é“äº†ï¼Œä¹Ÿå·²ç»å°è£…äº†å››å¤§å˜é‡ï¼Œæ‰€ä»¥<strong>ç›®å‰æœ€å…³å¿ƒçš„æ˜¯æ€ä¹ˆåˆ©ç”¨å››ä¸ªå˜åŒ–çš„å› ç´ ï¼Œä¿ƒä½¿å¼€å‘è€…åœ¨ç¼–å†™è¿™æ®µä»£ç è°ƒç”¨æµç¨‹æ—¶æ›´åŠ ç®€å•</strong>ï¼Œæ¢è¨€ä¹‹å°±æ˜¯åœ¨å›ºåŒ–æµç¨‹ä¸ºæ¨¡æ¿æ—¶ï¼Œæ€ä¹ˆæŠŠå˜åŒ–çš„å› ç´ ç»™åˆ°å„ä¸ªè°ƒç”¨æ–¹çš„å®ç°ç±»æ¥åšã€‚</p><p>åˆ°è¿™é‡Œï¼Œé—®é¢˜å°±è½¬å‘äº†æ€ä¹ˆå°†å˜åŒ–çš„å› ç´ åˆ†å‘ç»™å„ä¸ªå…·ä½“åŠŸèƒ½ä¸šåŠ¡çš„å®ç°ç±»ï¼Œæˆ‘ä»¬ç»§ç»­ç¢ç£¨ã€‚</p><p>å¦‚æœç»§ç»­æŠŠå˜åŒ–çš„å› ç´ æ”¾åœ¨å®ç°ç±»ä¸­ï¼Œå²‚ä¸æ˜¯åˆåœ¨èµ°ä¹‹å‰çš„è€è·¯ï¼Ÿä¸å¯è¡Œã€‚ä½†è¦æ˜¯æŠŠå®ç°ç±»å¹²æ‰çš„è¯ï¼Œå°±å‰©ä¸‹ä¸€ä¸ªå­¤é›¶é›¶çš„æ¥å£äº†ï¼Œåˆèƒ½å¹²å•¥å‘¢ï¼Ÿ</p><p>çªç„¶ä½ çœ¼å‰ä¸€äº®ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨æ¥å£ä¸Šåšç‚¹æ–‡ç« å‘¢ï¼Ÿç¿»çœ‹äº†Dubboæºç ä¸­çš„ä¸€äº›å·²æœ‰æ¥å£ç›¸å…³ç±»çš„è®¾è®¡æ€è·¯ï¼Œä¸€å †å †çš„æ³¨è§£è®©ä½ è‹¥æœ‰æ‰€æ‚Ÿï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨ SamplesFacadeClient æ¥å£ä¸Šè‡ªå®šä¹‰ä¸€äº›æ³¨è§£ï¼Œç”±æ³¨è§£æ¥æ¶ˆåŒ–å˜åŒ–çš„å› ç´ å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ²¿ç€æ³¨è§£çš„æ–¹å‘ç»§ç»­æ€è€ƒå‰é¢çš„4å¤§å˜åŒ–å› ç´ ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/92/3d02482ca6b75143097ecccc72979c92.jpg?wh=1920x829\" alt=\"å›¾ç‰‡\"></p><ul>\n<li>å› ç´ 1æ˜¯ä¸‹æ¸¸çš„æ¥å£ç±»åã€æ–¹æ³•åã€æ–¹æ³•å…¥å‚ç±»åï¼Œæ¶‰åŠçš„ç±»å¯ä»¥æ”¾åœ¨<strong>ç±»æ³¨è§£</strong>ä¸Šï¼Œæ–¹æ³•åã€æ–¹æ³•å…¥å‚å¯ä»¥æ”¾åœ¨<strong>æ–¹æ³•æ³¨è§£</strong>ä¸Šã€‚</li>\n<li>å› ç´ 2ä¸­æ¶ˆè´¹æ–¹æ¥å£çº§åˆ«çš„ timeoutã€retriesã€loadbalance ç­‰å±æ€§ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨<strong>æ–¹æ³•æ³¨è§£</strong>ä¸Šã€‚</li>\n<li>å› ç´ 3ä¸­çš„é”™è¯¯ç ï¼Œç†è®ºä¸Šä¸‹æ¸¸æä¾›æ–¹ä¸€ä¸ªç±»ä¸­å¤šä¸ªæ–¹æ³•è¿”å›çš„æ ¼å¼åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¦‚ä½•åˆ¤æ–­é”™è¯¯ç çš„å˜é‡å› ç´ å¯ä»¥æ”¾åœ¨<strong>ç±»æ³¨è§£</strong>ä¸Šã€‚</li>\n<li>å› ç´ 4ä¸­å¦‚ä½•å°†ä¸‹æ¸¸æ•°æ®ç±»å‹è½¬æ¢ä¸ºæœ¬ç³»ç»Ÿçš„ Bean ç±»å‹ï¼Œå…¶å®æœ€ç»ˆè¿˜æ˜¯æ¥å£çº§åˆ«çš„äº‹ï¼Œè²Œä¼¼è¿˜æ˜¯å¯ä»¥æ”¾åˆ°<strong>æ–¹æ³•æ³¨è§£</strong>ä¸Šã€‚</li>\n</ul><p>æŠŠå˜åŒ–çš„å› ç´ å¾€æ³¨è§£æ–¹å‘å¥—ç”¨æ—¶ï¼Œæˆ‘ä»¬çªç„¶å‘ç°é—®é¢˜éƒ½è¿åˆƒè€Œè§£äº†ã€‚å…´å¥‹çš„ä½ ä¸€å®šè¿«ä¸åŠå¾…æƒ³å»æŠŠ SamplesFacadeClient æ¥å£è®¾è®¡ä¸€ç•ªäº†ï¼š</p><pre><code class=\"language-java\">@DubboFeignClient(\n        remoteClass = SamplesFacade.class,\n        needResultJudge = true,\n        resultJudge = (remoteCodeNode = \"respCode\", remoteCodeSuccValueList = \"000000\", remoteMsgNode = \"respMsg\")\n)\npublic interface SamplesFacadeClient {\n    @DubboMethod(\n            timeout = \"5000\",\n            retries = \"3\",\n            loadbalance&nbsp;= \"random\",\n            remoteMethodName = \"queryRemoteOrder\",\n            remoteMethodParamsTypeName = {\"com.hmily.QueryOrderReq\"}\n     )\n    QueryOrderResponse queryRemoteOrderInfo(QueryOrderRequest req);\n}\n</code></pre><p>æˆ‘ä»¬é’ˆå¯¹ SamplesFacadeClient å®šä¹‰äº†ä¸¤ä¸ªæ³¨è§£ï¼Œ@DubboFeignClient æ˜¯ç±»æ³¨è§£ï¼Œ@DubboMethod æ˜¯æ–¹æ³•æ³¨è§£ã€‚</p><ul>\n<li>ç±»æ³¨è§£ä¸­çš„å‚æ•°ä½“ç°äº†è°ƒç”¨ç³»ç»Ÿæ–¹æ¥å£å½’å±çš„ç±»ï¼Œä»¥åŠæ€ä¹ˆå¤„ç†è¿™ä¸ªç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„è¿”å‚é”™è¯¯ç æƒ…å†µã€‚</li>\n<li>æ–¹æ³•æ³¨è§£ä¸­çš„å‚æ•°ä½“ç°äº†ä¸‹æ¸¸æä¾›æ–¹çš„æ–¹æ³•åå’Œæ–¹æ³•å…¥å‚ã€è¿”å‚å¯¹è±¡ç±»å‹è½¬æ¢ã€æ¥å£çº§åˆ«çš„ timeoutã€retriesã€loadbalance ç­‰å±æ€§æƒ…å†µã€‚</li>\n</ul><p>æŠŠ SamplesFacadeClient è®¾è®¡å¥½åï¼Œå¼€å‘è€…ç”¨èµ·æ¥ä¹Ÿç‰¹åˆ«èˆ’æœï¼Œä¹‹å‰è°ƒç”¨ä¸‹æ¸¸æä¾›æ–¹æ¥å£æ—¶è¦å†™çš„ä¸€å †ä»£ç ï¼Œç°åœ¨åªéœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªæ¥å£å¹¶æ·»åŠ ä¸¤ç§æ³¨è§£å°±å®Œäº‹äº†ã€‚</p><p>å¯æ˜¯è¦æƒ³åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œè¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬è¿˜å¾—ç»§ç»­æƒ³åŠæ³•ã€‚</p><h3>3. ä»¿ç…§ Spring ç±»æ‰«æ</h3><p>æˆ‘ä»¬æŒ‰ç…§æ¥å£æœ€èˆ’æœçš„ä½¿ç”¨æ–¹å¼ï¼Œæ¥åæ¨è¯¥å¦‚ä½•å®ç°ã€‚</p><p>æŒ‰ç…§è¿™ä¸ªæ¥å£çš„è®¾è®¡æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ°å°†æ¥ integration å±‚è‚¯å®šä¼šæœ‰ä¸€å †åƒ  SamplesFacadeClient è¿™æ ·çš„æ¥å£ï¼Œæ¯ä¸ªæ¥å£ä¸Šè¿˜æœ‰ @DubboFeignClient å’Œ @DubboMethod ä¸¤ä¸ªæ³¨è§£ã€‚ä¸¾ä¸ªå…·ä½“ä¾‹å­æ›´å®¹æ˜“æ€è€ƒï¼Œåœ¨ä½¿ç”¨æ¥å£æ—¶å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š</p><pre><code class=\"language-java\">@Autowired\nprivate SamplesFacadeClient&nbsp;samplesClient;\n</code></pre><p>ä»£ç åœ¨ä½¿ç”¨ SamplesFacadeClient&nbsp;æ¥å£æ—¶ï¼Œä¼šåœ¨å­—æ®µ samplesClient ä¸ŠåŠ ä¸€ä¸ª @Autowired æ³¨è§£ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ samplesClient.queryRemoteOrderInfo è¿™æ ·çš„æ–¹å¼è°ƒç”¨æ–¹æ³•äº†ã€‚</p><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼ŒsamplesClient è¦æƒ³åœ¨è¿è¡Œæ—¶è°ƒç”¨æ–¹æ³•ï¼Œé¦–å…ˆ samplesClient å¿…é¡»å¾—æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚<strong>å¯æ˜¯æˆ‘ä»¬ä»£ç é‡Œæ ¹æœ¬å°±ä¸å­˜åœ¨ SamplesFacadeClient&nbsp;æ¥å£çš„ä»»ä½•å®ç°ç±»ï¼Œé‚£è¯¥æ€ä¹ˆæŠŠä¸€ä¸ªæ¥å£å˜æˆè¿è¡Œæ—¶çš„å®ä¾‹å¯¹è±¡å‘¢ï¼Ÿ</strong>åœ¨è¿™ä¸ªå…·ä½“ä¾‹å­é‡Œå°±æ˜¯ï¼šå¦‚ä½•ä½¿å˜é‡ samplesClient è¢« @Autowired æ³¨è§£ä¿®é¥°åå°±å˜æˆå®ä¾‹å¯¹è±¡ï¼Ÿ@Autowired æ˜¯è°ï¼Œä»å“ªé‡Œå†’å‡ºæ¥çš„ï¼Œè°èµ‹äºˆäº† @Autowired è¿™ç¥å¥‡çš„åŠŸèƒ½å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸€ä¸‹å­å°±è”æƒ³åˆ°äº† Spring æ¡†æ¶ï¼Œå› ä¸º @Autowired æ˜¯åœ¨ Spring æ¡†æ¶ä¸­å®šä¹‰çš„ï¼Œåœ¨ Spring æ¡†æ¶ä¸­è¢«æ³¨è§£ä¿®é¥°å˜é‡å¯èƒ½æ˜¯åŸå‹å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»£ç†å¯¹è±¡ã€‚æ‰€ä»¥æ€ä¹ˆæŠŠæ¥å£å˜æˆå®ä¾‹å¯¹è±¡ç°åœ¨å°±æœ‰äº†ç­”æ¡ˆï¼Œå¯ä»¥æƒ³åŠæ³•<strong>æŠŠæ¥å£å˜æˆè¿è¡Œæ—¶çš„ä»£ç†å¯¹è±¡</strong>ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å€¼å¾—æ€è€ƒï¼šSpring æ¡†æ¶æ˜¯æ€ä¹ˆçŸ¥é“ @Componentã€@Configuration ç­‰æ³¨è§£çš„å­˜åœ¨å‘¢ï¼Œå…³é”®æ˜¯è¿™äº›æ³¨è§£éå¸ƒåœ¨å·¥ç¨‹ä»£ç çš„å„ä¸ªè§’è½ï¼ŒSpring åˆæ˜¯æ€ä¹ˆæ‰¾åˆ°çš„å‘¢ï¼Ÿ</p><p>è¿™å°±éœ€è¦ä½ äº†è§£ Spring æºç é‡Œçš„ä¸€ä¸ªç±» org.springframework.context.annotation.ClassPathBeanDefinitionScannerï¼Œå®ƒæ˜¯ Spring ä¸ºäº†æ‰«æä¸€å †çš„ BeanDefinition è€Œè®¾è®¡ï¼Œç›®çš„å°±æ˜¯è¦<strong>ä» @SpringBootApplication æ³¨è§£ä¸­è®¾ç½®è¿‡çš„åŒ…è·¯å¾„åŠå…¶å­åŒ…è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»æ–‡ä»¶ä¸­ï¼Œæ‰«æå‡ºå«æœ‰ @Componentã€@Configuration ç­‰æ³¨è§£çš„ç±»ï¼Œå¹¶æ„å»º BeanDefinition å¯¹è±¡</strong>ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ Spring çš„è¿™å¥—æ‰«ææœºåˆ¶ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªæ‰«æå™¨ç±»ï¼Œç„¶ååœ¨è‡ªå®šä¹‰æ‰«æå™¨ç±»ä¸­è‡ªå·±æ‰‹åŠ¨æ„å»º BeanDefinition å¯¹è±¡å¹¶ä¸”åç»­åˆ›å»ºä»£ç†å¯¹è±¡å‘¢ï¼Ÿ</p><p>å€Ÿé‰´äº†æºç æ€æƒ³ï¼Œæˆ‘ä»¬å†™ä¸‹äº†è¿™æ ·çš„ä»£ç ï¼š</p><pre><code class=\"language-java\">public class DubboFeignScanner extends ClassPathBeanDefinitionScanner {\n    // å®šä¹‰ä¸€ä¸ª FactoryBean ç±»å‹çš„å¯¹è±¡ï¼Œæ–¹ä¾¿å°†æ¥å®ä¾‹åŒ–æ¥å£ä½¿ç”¨\n    private DubboClientFactoryBean&lt;?&gt; factoryBean = new DubboClientFactoryBean&lt;&gt;();\n    // é‡å†™çˆ¶ç±» ClassPathBeanDefinitionScanner çš„æ„é€ æ–¹æ³•\n    public DubboFeignScanner(BeanDefinitionRegistry registry) {\n        super(registry);\n    }\n    // æ‰«æå„ä¸ªæ¥å£æ—¶å¯ä»¥åšä¸€äº›æ‹¦æˆªå¤„ç†\n    // ä½†æ˜¯è¿™é‡Œä¸éœ€è¦åšä»»ä½•æ‰«ææ‹¦æˆªï¼Œå› æ­¤å†…ç½®æ¶ˆåŒ–æ‰è¿”å›trueä¸éœ€è¦æ‹¦æˆª\n    public void registerFilters() {\n        addIncludeFilter((metadataReader, metadataReaderFactory) -&gt; true);\n    }\n    // é‡å†™çˆ¶ç±»çš„ doScan æ–¹æ³•ï¼Œå¹¶å°† protected ä¿®é¥°èŒƒå›´æ”¾å¤§ä¸º public å±æ€§ä¿®é¥°\n    @Override\n    public Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {\n        // åˆ©ç”¨çˆ¶ç±»çš„doScanæ–¹æ³•æ‰«ææŒ‡å®šçš„åŒ…è·¯å¾„\n        // åœ¨æ­¤ï¼ŒDubboFeignScannerè‡ªå®šä¹‰æ‰«æå™¨å°±æ˜¯åˆ©ç”¨Springè‡ªèº«çš„æ‰«æç‰¹æ€§ï¼Œ\n        // æ¥è¾¾åˆ°æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»æ–‡ä»¶ï¼Œçœå»äº†è‡ªå·±å†™ä»£ç å»æ‰«æè¿™ä¸ªåºå¤§çš„ä½“åŠ›æ´»äº†\n        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages);\n        if(beanDefinitions == null || beanDefinitions.isEmpty()){\n            return beanDefinitions;\n        }\n        processBeanDefinitions(beanDefinitions);\n        return beanDefinitions;\n    }\n    // è‡ªå·±æ‰‹åŠ¨æ„å»º BeanDefinition å¯¹è±¡\n    private void processBeanDefinitions(Set&lt;BeanDefinitionHolder&gt; beanDefinitions) {\n        GenericBeanDefinition definition = null;\n        for (BeanDefinitionHolder holder : beanDefinitions) {\n            definition = (GenericBeanDefinition)holder.getBeanDefinition();\n            definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName());\n            // ç‰¹æ„é’ˆå¯¹ BeanDefinition è®¾ç½® DubboClientFactoryBean.class\n            // ç›®çš„å°±æ˜¯åœ¨å®ä¾‹åŒ–æ—¶èƒ½å¤Ÿåœ¨ DubboClientFactoryBean ä¸­åˆ›å»ºä»£ç†å¯¹è±¡\n            definition.setBeanClass(factoryBean.getClass());\n            definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);\n        }\n    }\n}\n</code></pre><p>é€šè¿‡å®šä¹‰ DubboFeignScanner å¯¹è±¡å¹¶ä¸”ç»§æ‰¿ ClassPathBeanDefinitionScanner å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡å†™ doScan æ–¹æ³•æ¥æ”¶ä¸€ä¸ªåŒ…è·¯å¾„ï¼ˆSamplesFacadeClient æ¥å£æ‰€åœ¨çš„åŒ…è·¯å¾„ï¼‰ï¼Œç„¶ååˆ©ç”¨ super.doScan è®© Spring å¸®æˆ‘ä»¬å»æ‰«ææŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»æ–‡ä»¶ã€‚</p><p>è¿™æ ·å°±ç®€å•å¤šäº†ï¼Œä¸ç”¨å†™ä»£ç æŒ¨ä¸ªæ‰«æåŒ…ä¸‹é¢çš„ç±»æ–‡ä»¶æ“ä½œï¼Œè¿˜èƒ½æ‰‹åŠ¨åœ¨ processBeanDefinitions æ–¹æ³•ä¸­åˆ›å»º BeanDefinition å¯¹è±¡ã€‚</p><p>ç†æƒ³ä¸­æ­£å¸¸é€»è¾‘æ˜¯è¿™æ ·ï¼Œä½†å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ç»å¸¸å‘ç°æŒ‡å®šçš„åŒ…è·¯å¾„ä¸‹æœ‰ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ç±»æ–‡ä»¶ï¼Œå¯¼è‡´æŒ‰ DubboFeignScanner.doScan æ–¹æ³•æ‰«æåï¼Œä¸å‡†ç¡®æˆ–è€…å‡ºç°å„ç§æŠ¥é”™ï¼Œæ¯•ç«ŸåŠŸèƒ½ä»£ç æ˜¯å±‚å±‚è¿­ä»£ä¸‹æ¥çš„ï¼Œä¸åŒå¼€å‘äººå‘˜æœ‰å„è‡ªçš„å†™æ³•å§¿åŠ¿ï¼Œä¸å¯æ§ã€‚</p><p>é‚£æˆ‘ä»¬å¦‚ä½•ä¿éšœç²¾å‡†æ‰«æå‡ºæŒ‡å®šæ³¨è§£çš„ç±»å‘¢ï¼Ÿéš¾é“è¦æƒ³åŠæ³•å†æ¬¡è¿‡æ»¤ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜å…¶å® Spring æ¡†æ¶ä¹Ÿé‡åˆ°äº†ï¼Œå¯¹äºæŒ‡å®šçš„ @Componentã€@Configuration ç­‰æ³¨è§£ï¼ŒSpring æ¡†æ¶æ˜¯æ€ä¹ˆçŸ¥é“éœ€è¦æ‹¾å–çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ç²¾å¿ƒè®¾è®¡ã€‚</p><p>è¿™é‡Œç»™ä½ ä¼ æˆä¸€ä¸ªå°ç§˜è¯€ï¼Œ<strong>å°è¯•åœ¨ ClassPathBeanDefinitionScanner çš„æ‰€æœ‰æ–¹æ³•ä¸­å¯»æ‰¾é‚£äº›å¯è¢« Override é‡å†™çš„æ–¹æ³•</strong>ã€‚</p><p>ä½ ä¼šå‘ç° Spring æºç åœ¨æ·»åŠ  BeanDefinition æ—¶ï¼Œéœ€è¦å€ŸåŠ©ä¸€ä¸ª org.springframework.context.annotation.ClassPathScanningCandidateComponentProvider#isCandidateComponent æ–¹æ³•ï¼Œæ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å€™é€‰ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯ï¼Œæ˜¯ä¸æ˜¯éœ€è¦æ‹¾å–æŒ‡å®šæ³¨è§£ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•åœ¨ DubboFeignScanner ç±»ä¸­é‡å†™ isCandidateComponent æ–¹æ³•ï¼Œå¹¶ä¸”åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœæ‰«æå‡ºæ¥çš„ç±»å«æœ‰ @DubboFeignClient æ³¨è§£ï¼Œæˆ‘ä»¬å°±æ·»åŠ  BeanDefinition å¯¹è±¡ï¼Œå¦åˆ™ä¸äºˆå¤„ç†ã€‚</p><p>äºæ˜¯ä½ å¯¹ä»£ç åšäº†ä¿®æ”¹ï¼š</p><pre><code class=\"language-java\">public class DubboFeignScanner extends ClassPathBeanDefinitionScanner {\n    // å®šä¹‰ä¸€ä¸ª FactoryBean ç±»å‹çš„å¯¹è±¡ï¼Œæ–¹ä¾¿å°†æ¥å®ä¾‹åŒ–æ¥å£ä½¿ç”¨\n    private DubboClientFactoryBean&lt;?&gt; factoryBean = new DubboClientFactoryBean&lt;&gt;();\n    // é‡å†™çˆ¶ç±» ClassPathBeanDefinitionScanner çš„æ„é€ æ–¹æ³•\n    public DubboFeignScanner(BeanDefinitionRegistry registry) {\n        super(registry);\n    }\n    // æ‰«æå„ä¸ªæ¥å£æ—¶å¯ä»¥åšä¸€äº›æ‹¦æˆªå¤„ç†\n    // ä½†æ˜¯è¿™é‡Œä¸éœ€è¦åšä»»ä½•æ‰«ææ‹¦æˆªï¼Œå› æ­¤å†…ç½®æ¶ˆåŒ–æ‰è¿”å›trueä¸éœ€è¦æ‹¦æˆª\n    public void registerFilters() {\n        addIncludeFilter((metadataReader, metadataReaderFactory) -&gt; true);\n    }\n    // é‡å†™çˆ¶ç±»çš„ doScan æ–¹æ³•ï¼Œå¹¶å°† protected ä¿®é¥°èŒƒå›´æ”¾å¤§ä¸º public å±æ€§ä¿®é¥°\n    @Override\n    public Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {\n        // åˆ©ç”¨çˆ¶ç±»çš„doScanæ–¹æ³•æ‰«ææŒ‡å®šçš„åŒ…è·¯å¾„\n        // åœ¨æ­¤ï¼ŒDubboFeignScannerè‡ªå®šä¹‰æ‰«æå™¨å°±æ˜¯åˆ©ç”¨Springè‡ªèº«çš„æ‰«æç‰¹æ€§ï¼Œ\n        // æ¥è¾¾åˆ°æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»æ–‡ä»¶ï¼Œçœå»äº†è‡ªå·±å†™ä»£ç å»æ‰«æè¿™ä¸ªåºå¤§çš„ä½“åŠ›æ´»äº†\n        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages);\n        if(beanDefinitions == null || beanDefinitions.isEmpty()){\n            return beanDefinitions;\n        }\n        processBeanDefinitions(beanDefinitions);\n        return beanDefinitions;\n    }\n    // è‡ªå·±æ‰‹åŠ¨æ„å»º BeanDefinition å¯¹è±¡\n    private void processBeanDefinitions(Set&lt;BeanDefinitionHolder&gt; beanDefinitions) {\n        GenericBeanDefinition definition = null;\n        for (BeanDefinitionHolder holder : beanDefinitions) {\n            definition = (GenericBeanDefinition)holder.getBeanDefinition();\n            definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName());\n            // ç‰¹æ„é’ˆå¯¹ BeanDefinition è®¾ç½® DubboClientFactoryBean.class\n            // ç›®çš„å°±æ˜¯åœ¨å®ä¾‹åŒ–æ—¶èƒ½å¤Ÿåœ¨ DubboClientFactoryBean ä¸­åˆ›å»ºä»£ç†å¯¹è±¡\n            definition.setBeanClass(factoryBean.getClass());\n            definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);\n        }\n    }\n    // é‡å†™çˆ¶ç±»ä¸­â€œæ˜¯å¦æ˜¯å€™é€‰ç»„ä»¶â€çš„æ–¹æ³•ï¼Œå³æˆ‘ä»¬è®¤ä¸ºå“ªäº›æ‰«æåˆ°çš„ç±»å¯ä»¥æ˜¯å€™é€‰ç±»\n    @Override\n    protected boolean isCandidateComponent(AnnotatedBeanDefinition beanDefinition) {\n        AnnotationMetadata metadata = beanDefinition.getMetadata();\n        if (!(metadata.isInterface() &amp;&amp; metadata.isIndependent())) {\n            return false;\n        }\n        // é’ˆå¯¹æ‰«æåˆ°çš„ç±»ï¼Œç„¶åçœ‹çœ‹æ‰«æåˆ°çš„ç±»ä¸­æ˜¯å¦æœ‰ DubboFeignClient æ³¨è§£ä¿¡æ¯\n        Map&lt;String, Object&gt; attributes = metadata\n        .getAnnotationAttributes(DubboFeignClient.class.getName());\n        // è‹¥æ‰«æåˆ°çš„ç±»ä¸Šæ²¡æœ‰ DubboFeignClient æ³¨è§£ä¿¡æ¯åˆ™è®¤ä¸ºä¸æ˜¯è®¤å¯çš„ç±»\n        if (attributes == null) {\n            return false;\n        }\n        // è‹¥æ‰«æåˆ°çš„ç±»ä¸Šæœ‰ DubboFeignClient æ³¨è§£ä¿¡æ¯åˆ™èµ·ç æ˜¯è®¤å¯çš„ç±»\n        AnnotationAttributes annoAttrs = AnnotationAttributes.fromMap(attributes);\n        if (annoAttrs == null) {\n            return false;\n        }\n        // æ—¢ç„¶æ˜¯è®¤å¯çš„ç±»ï¼Œé‚£å†çœ‹çœ‹ç±»æ³¨è§£ä¸­æ˜¯å¦æœ‰ remoteClass å­—æ®µä¿¡æ¯\n        // è‹¥ remoteClass å­—æ®µä¿¡æ¯æœ‰å€¼çš„è¯ï¼Œåˆ™è®¤ä¸ºæ˜¯æˆ‘ä»¬æœ€ç»ˆè®¤å®šåˆæ³•çš„å€™é€‰ç±»\n        Object remoteClass = annoAttrs.get(\"remoteClass\");\n        if (remoteClass == null) {\n            return false;\n        }\n        return true;\n    }\n}\n</code></pre><p>ä»£ç ä¸­åœ¨ isCandidateComponent æ–¹æ³•ä¸­è¿›è¡Œäº†è¯†åˆ« DubboFeignClient ç±»æ³¨è§£çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¦‚æœæœ‰ç±»æ³¨è§£ä¸”æœ‰ remoteClass å±æ€§çš„è¯ï¼Œå°±è®¤ä¸ºæ˜¯æˆ‘ä»¬å¯»æ‰¾çš„ç±»ã€‚</p><p>è¿™æ ·ï¼Œæ‰€æœ‰å«æœ‰ @DubboFeignClient æ³¨è§£çš„ç±»çš„ BeanDefinition å¯¹è±¡éƒ½è¢«æ‰«ææ”¶é›†èµ·æ¥äº†ï¼Œæ¥ä¸‹æ¥å°±äº¤ç»™ Spring æœ¬èº« refresh æ–¹æ³•ä¸­çš„ org.springframework.beans.factory.support.DefaultListableBeanFactory#preInstantiateSingletons æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–äº†ï¼Œè€Œå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå¦‚æœå‘ç° BeanDefinition å¯¹è±¡æ˜¯ org.springframework.beans.factory.FactoryBean ç±»å‹ï¼Œä¼šè°ƒç”¨ FactoryBean çš„ getObject æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p><p>é’ˆå¯¹æ¥å£è¿›è¡Œä»£ç†å¯¹è±¡çš„åˆ›å»ºï¼Œä½ ä¹Ÿä¸€å®šèƒ½å¾ˆå¿«æƒ³åˆ° JDK ä¸­çš„ java.lang.reflect.Proxy ç±»ï¼Œå¯ä»¥è¿™ä¹ˆåˆ›å»ºä»£ç†å¯¹è±¡ï¼š</p><pre><code class=\"language-java\">public class DubboClientFactoryBean&lt;T&gt; implements FactoryBean&lt;T&gt;, ApplicationContextAware {\n    private Class&lt;T&gt; dubboClientInterface;\n    private ApplicationContext appCtx;\n    public DubboClientFactoryBean() {\n    }\n    // è¯¥æ–¹æ³•æ˜¯åœ¨ DubboFeignScanner è‡ªå®šä¹‰æ‰«æå™¨çš„ processBeanDefinitions æ–¹æ³•ä¸­ï¼Œ\n    // é€šè¿‡ definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName()) ä»£ç è®¾ç½®è¿›æ¥çš„\n    // è¿™é‡Œçš„ dubboClientInterface å°±ç­‰ä»·äº SamplesFacadeClient&nbsp;æ¥å£\n    public DubboClientFactoryBean(Class&lt;T&gt; dubboClientInterface) {\n        this.dubboClientInterface = dubboClientInterface;\n    }\n    \n    // Springæ¡†æ¶å®ä¾‹åŒ–FactoryBeanç±»å‹çš„å¯¹è±¡æ—¶çš„å¿…ç»ä¹‹è·¯\n    @Override\n    public T getObject() throws Exception {\n        // ä¸º dubboClientInterface åˆ›å»ºä¸€ä¸ª JDK ä»£ç†å¯¹è±¡\n        // åŒæ—¶ä»£ç†å¯¹è±¡ä¸­çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘äº¤ç»™äº† DubboClientProxy æ ¸å¿ƒä»£ç†ç±»å¤„ç†\n        return (T) Proxy.newProxyInstance(dubboClientInterface.getClassLoader(),\n                new Class[]{dubboClientInterface}, new DubboClientProxy&lt;&gt;(appCtx));\n    }\n    // æ ‡è¯†è¯¥å®ä¾‹åŒ–å¯¹è±¡çš„æ¥å£ç±»å‹\n    @Override\n    public Class&lt;?&gt; getObjectType() {\n        return dubboClientInterface;\n    }\n    // æ ‡è¯† SamplesFacadeClient&nbsp;æœ€ååˆ›å»ºå‡ºæ¥çš„ä»£ç†å¯¹è±¡æ˜¯å•ä¾‹å¯¹è±¡\n    @Override\n    public boolean isSingleton() {\n        return true;\n    }\n    @Override\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        this.appCtx = applicationContext;\n    }\n}\n</code></pre><p>ä»£ç ä¸­ getObject æ˜¯æˆ‘ä»¬åˆ›å»ºä»£ç†å¯¹è±¡çš„æ ¸å¿ƒè¿‡ç¨‹ï¼Œç»†å¿ƒçš„ä½ å¯èƒ½ä¼šå‘ç°æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ª DubboClientProxy å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ”¾åœ¨ <code>java.lang.reflect.Proxy#newProxyInstance(java.lang.ClassLoader, java.lang.Class&lt;?&gt;[], **java.lang.reflect.InvocationHandler**)</code> æ–¹æ³•ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œå°†æ¥å«æœ‰ @DubboFeignClient æ³¨è§£çš„ç±»çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¸€å®šä¼šè§¦å‘è°ƒç”¨ DubboClientProxy ç±»ï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬å¯ä»¥åœ¨ DubboClientProxy ç±»æ‹¦æˆªæ–¹æ³•ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ¢¦å¯ä»¥æ±‚çš„æ ¸å¿ƒæ‹¦æˆªæ–¹æ³•çš„åœ°æ–¹ã€‚</p><p>å¥½ï¼Œåˆ°ç°åœ¨ï¼Œæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ç»ˆäºåˆ°äº†ï¼Œæˆ‘ä»¬åœ¨ DubboClientProxy ä¸­å¯ä»¥å°†é‚£å¥—ä¸å˜çš„ä»£ç æµç¨‹å†™åœ¨è¿™å„¿äº†ï¼Œä¹‹å‰è€ƒè™‘çš„å››å¤§å› ç´ ç›´æ¥ä» @DubboFeignClientã€@DubboMethod ä¸¤ä¸ªæ³¨è§£è¯»å–ä¿¡æ¯ã€‚</p><p>æ¥çœ‹DubboClientProxy çš„å®ç°ï¼š</p><pre><code class=\"language-java\">public class DubboClientProxy&lt;T&gt; implements InvocationHandler, Serializable {\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        // çœç•¥å‰é¢çš„ä¸€äº›ä»£ç \n        \n        // è¯»å–æ¥å£ï¼ˆä¾‹ï¼šSamplesFacadeClientï¼‰ä¸Šå¯¹åº”çš„æ³¨è§£ä¿¡æ¯\n        DubboFeignClient dubboClientAnno = declaringClass.getAnnotation(DubboFeignClient.class);\n        // è¯»å–æ–¹æ³•ï¼ˆä¾‹ï¼šqueryRemoteOrderInfoï¼‰ä¸Šå¯¹åº”çš„æ³¨è§£ä¿¡æ¯\n        DubboMethod methodAnno = method.getDeclaredAnnotation(DubboMethod.class);\n        // è·å–éœ€è¦è°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿçš„ç±»ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ç±»å‹\n        Class&lt;?&gt; remoteClass = dubboClientAnno.remoteClass();\n        String mtdName = getMethodName(method.getName(), methodAnno);\n        Method remoteMethod = MethodCache.cachedMethod(remoteClass, mtdName, methodAnno);\n        Class&lt;?&gt; returnType = method.getReturnType();\n        \n        // å‘èµ·çœŸæ­£è¿œç¨‹è°ƒç”¨\n        Object resultObject = doInvoke(remoteClass, remoteMethod, args, methodAnno);\n        \n        // åˆ¤æ–­è¿”å›ç ï¼Œå¹¶è§£æè¿”å›ç»“æœ\n        return doParse(dubboClientAnno, returnType, resultObject);\n    }\n}\n</code></pre><p>çœ‹DubboClientProxy.invoke æ–¹æ³•ï¼ŒæŒ‰ç…§ä¸å˜çš„ä»£ç è°ƒç”¨æµç¨‹ï¼Œä»ç±»æ³¨è§£ã€æ–¹æ³•æ³¨è§£åˆ†åˆ«å°†å˜åŒ–çš„å› ç´ è¯»å–å‡ºæ¥ï¼Œç„¶åæ„å»ºè°ƒç”¨ä¸‹æ¸¸ç³»ç»Ÿçš„è¯·æ±‚å¯¹è±¡ï¼Œå¹¶å°†è¯·æ±‚å¯¹è±¡ä¼ å…¥ä¸‹æ¸¸ç³»ç»Ÿçš„æ¥å£ä¸­ï¼Œç„¶åæ¥æ”¶è¿”å‚å¹¶é’ˆå¯¹é”™è¯¯ç è¿›è¡Œåˆ¤æ–­ï¼Œæœ€åè½¬æˆè‡ªå·±çš„ Bean å¯¹è±¡ã€‚</p><p>è¿™ä¸‹æ˜¯çœŸæ­£åšåˆ°äº†ç”¨ä¸€å¥—ä»£ç è§£å†³äº†æ‰€æœ‰ integration å±‚æ¥å£çš„è¿œç¨‹è°ƒç”¨ï¼Œç®€åŒ–äº†é‡å¤ä»£ç å¼€å‘çš„åŠ³åŠ¨åŠ›æˆæœ¬ï¼Œè€Œä¸”ä¹Ÿä½¿ä»£ç çš„ç¼–å†™æ›´åŠ ç®€æ´ç¾è§‚ã€‚</p><h2>Dubboæ‰«æåŸç†æœºåˆ¶</h2><p>æœ‰äº†å‰é¢çš„å­¦ä¹ åŸºç¡€ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ org.springframework.context.annotation.ClassPathBeanDefinitionScanner çš„æ‰€æœ‰å­ç±»ï¼Œæœ‰æ²¡æœ‰ä¸€ç§çœ¼å‰ä¸€äº®çš„æ„Ÿè§‰ï¼š</p><pre><code class=\"language-java\">// Dubbo æ¡†æ¶å®šä¹‰çš„æ‰«æå™¨ï¼Œå¹¶ä¸”ä¹Ÿç»§æ‰¿äº† ClassPathBeanDefinitionScanner ç±»\npublic class DubboClassPathBeanDefinitionScanner extends ClassPathBeanDefinitionScanner {\n\n    // æ‰«æå™¨çš„æ„é€ æ–¹æ³•\n    public DubboClassPathBeanDefinitionScanner(BeanDefinitionRegistry registry, boolean useDefaultFilters, Environment environment,\n                                               ResourceLoader resourceLoader) {\n        super(registry, useDefaultFilters);\n        setEnvironment(environment);\n        setResourceLoader(resourceLoader);\n        registerAnnotationConfigProcessors(registry);\n    }\n    // æ‰«æå™¨çš„æ„é€ æ–¹æ³•\n    public DubboClassPathBeanDefinitionScanner(BeanDefinitionRegistry registry, Environment environment,\n                                               ResourceLoader resourceLoader) {\n        this(registry, false, environment, resourceLoader);\n    }\n    // ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„doScanï¼Œå³åˆ©ç”¨Springè‡ªèº«çš„æ‰«æç‰¹æ€§å»æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰ç±»\n    @Override\n    public Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {\n        return super.doScan(basePackages);\n    }\n    @Override\n    public boolean checkCandidate(String beanName, BeanDefinition beanDefinition) throws IllegalStateException {\n        return super.checkCandidate(beanName, beanDefinition);\n    }\n    \n    // å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè¢«publicä¿®é¥°çš„çˆ¶ç±»addIncludeFilteræ–¹æ³•ï¼Œ\n    // è°ƒç”¨æ–¹ä¼šå°†éœ€è¦å…³æ³¨çš„æ³¨è§£ä¸€å¾‹éƒ½é€šè¿‡addIncludeFilteræ·»åŠ è¿›æ¥ï¼Œ\n    // æºç è°ƒç”¨çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n    \n    // private final static List&lt;Class&lt;? extends Annotation&gt;&gt; serviceAnnotationTypes = asList(\n    //         // @since 2.7.7 Add the @DubboService , the issue : https://github.com/apache/dubbo/issues/6007\n    //         DubboService.class,\n    //         // @since 2.7.0 the substitute @com.alibaba.dubbo.config.annotation.Service\n    //         Service.class,\n    //         // @since 2.7.3 Add the compatibility for legacy Dubbo's @Service , the issue : https://github.com/apache/dubbo/issues/4330\n    //         com.alibaba.dubbo.config.annotation.Service.class\n    //     );    \n    \n    // for (Class&lt;? extends Annotation&gt; annotationType : serviceAnnotationTypes) {\n    //   scanner.addIncludeFilter(new AnnotationTypeFilter(annotationType));\n    // }\n}\n</code></pre><p>ä½ ä¼šå‘ç° Dubbo è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ª DubboClassPathBeanDefinitionScanner ç±»ç»§æ‰¿äº† ClassPathBeanDefinitionScannerï¼ŒDubbo ä¹Ÿåœ¨å……åˆ†åˆ©ç”¨ Spring è‡ªèº«å·²æœ‰çš„æ‰©å±•ç‰¹æ€§æ¥æ‰«æè‡ªå·±éœ€è¦å…³æ³¨çš„ä¸‰ä¸ªæ³¨è§£ç±»ï¼Œorg.apache.dubbo.config.annotation.DubboServiceã€org.apache.dubbo.config.annotation.Serviceã€com.alibaba.dubbo.config.annotation.Serviceï¼Œç„¶åå®Œæˆ BeanDefinition å¯¹è±¡çš„åˆ›å»ºï¼Œå†å®Œæˆ Proxy ä»£ç†å¯¹è±¡çš„åˆ›å»ºï¼Œæœ€ååœ¨è¿è¡Œæ—¶å°±å¯ä»¥ç›´æ¥è¢«æ‹¿æ¥ä½¿ç”¨äº†ã€‚</p><p>Dubboçš„æ‰«æåŸç†æœºåˆ¶ï¼Œç›¸ä¿¡ä½ ç°åœ¨å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œé‚£å“ªäº›åº”ç”¨åœºæ™¯å¯ä»¥è€ƒè™‘æ‰«ææœºåˆ¶å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ç»“åˆæºç æ€è€ƒã€‚</p><p>ç¬¬ä¸€ï¼Œéè‡ªç ”æ¡†æ¶ï¼Œåœ¨ç³»ç»Ÿä¸­å•ç‹¬å®šä¹‰åƒ SamplesFacadeClient è¿™ç§æ¥å£ä¸è‡ªå®šä¹‰æ³¨è§£ç›¸ç»“åˆçš„æƒ…å†µï¼Œåˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£å®šä¹‰å„ç§ä¸šåŠ¡é€»è¾‘çš„è§„åˆ™ï¼Œç„¶åå¯¹ SamplesFacadeClient ç›´æ¥è¿›è¡Œ @Autowired æˆ– @Resource ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘åˆ©ç”¨æ‰«ææœºåˆ¶ï¼Œç»Ÿä¸€å°†è¿™ä¸€ç±»æ¥å£åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨æ ¸å¿ƒä»£ç†ç±»ä¸­å½’ä¸€åŒ–å¤„ç†æ ¸å¿ƒé€»è¾‘ã€‚</p><p>ç¬¬äºŒï¼Œè‡ªç ”æ¡†æ¶ï¼Œæ¯”å¦‚ Dubbo å¯¹ Spring æ¥è¯´å°±æ˜¯ç¬¬ä¸‰æ–¹è‡ªç ”æ¡†æ¶ï¼Œè‹¥è‡ªç ”æ¡†æ¶å®šä¹‰çš„æ¥å£æƒ³è¦è¢«æ³¨è§£ä¿®é¥°åç›´æ¥ä½¿ç”¨çš„è¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åˆ©ç”¨æ‰«ææœºåˆ¶ç»Ÿä¸€é›†æˆDubboæ¡†æ¶ï¼Œå¹¶å¤„ç†ç”Ÿæˆä»£ç†ç±»ã€‚</p><p>æ€»ä¹‹ï¼Œä¸ç®¡æ˜¯åœ¨ç³»ç»Ÿä¸­å®šä¹‰æ¥å£ä¹Ÿå¥½ï¼Œè¿˜æ˜¯åœ¨è‡ªç ”æ¡†æ¶ä¸­å®šä¹‰æ¥å£ä¹Ÿå¥½ï¼Œ<strong>å¦‚æœè¿™äº›æ¥å£æ˜¯åŒç±»æ€§è´¨çš„ï¼Œè€Œä¸”Springè¿˜æ— æ³•é€šè¿‡æ³¨è§£ä¿®é¥°æ¥å£ç›´æ¥ä½¿ç”¨çš„è¯ï¼Œéƒ½å¯ä»¥é‡‡å–æ‰«ææœºåˆ¶ç»Ÿä¸€å¤„ç†å…±æ€§é€»è¾‘</strong>ï¼Œå°†ä¸å˜çš„æµç¨‹é€»è¾‘ä¸‹æ²‰ï¼Œå°†å˜åŒ–çš„å› ç´ é‡Šæ”¾ç»™å„ä¸ªæ¥å£ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä»ä¸€æ®µintegrationå±‚ç°çŠ¶çš„ä»£ç å¼€å§‹ï¼Œåˆ†æè¦å†™å¾ˆå¤šç›¸ä¼¼ä»£ç çš„æ—¶å€™ï¼Œå¦‚ä½•è¿›è¡Œå°è£…ã€æŠ½è±¡å¤„ç†ï¼Œä»¥è¾¾åˆ°ç®€åŒ–ä»£ç ç¼–å†™ã€èŠ‚çœé‡å¤åŠ³åŠ¨åŠ›çš„ç›®çš„ã€‚æ”¹å–„çš„æ ¸å¿ƒè¦ç‚¹ï¼Œéœ€è¦æˆ‘ä»¬ç´§æŠ“é¢å‘å¯¹è±¡çš„<strong>æŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å¤šæ€</strong>è¿™äº›ç‰¹å¾ï¼Œæ¥å……åˆ†æŒ–æ˜ç°çŠ¶ä»£ç çš„â€œåå‘³é“â€ã€‚</p><p>å¯¹äºintegrationå±‚ä»£ç ï¼Œæ”¹å–„çš„å®ç°æ€è·¯ä¹Ÿå¾ˆæ¸…æ™°ï¼š</p><ul>\n<li>é¦–å…ˆé€šè¿‡å°è£…æ€è·¯å°†æ—§ä»£ç å½’ä¸€åŒ–å¤„ç†ï¼Œæç‚¼ç»Ÿä¸€çš„å°è£…æ–¹æ³•ï¼›</li>\n<li>ç´§æ¥ç€é€šè¿‡æŠ½è±¡æ€è·¯ï¼Œé€æ¸æç‚¼ä¸å˜çš„æµç¨‹æ­¥éª¤ï¼Œå°†ä¸å˜çš„æµç¨‹å›ºåŒ–æˆ–æ¨¡æ¿åŒ–ï¼Œå°†å˜åŒ–çš„äº¤ç»™å„ä¸ªå®ç°ç±»å»å®ç°ï¼›</li>\n<li>ç„¶åé€šè¿‡ä»¿ç…§Springçš„ClassPathBeanDefinitionScanner.doScançš„ç±»æ‰«ææœºåˆ¶ï¼Œè§£å†³æ¥å£å˜æˆä»£ç†å®ä¾‹å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ä»£ç ä¸­èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼›</li>\n<li>æœ€ååœ¨æ ¸å¿ƒä»£ç†ç±»DubboClientProxyä¸­ï¼Œå°†å°è£…æ€è·¯ä¸æŠ½è±¡æ€è·¯å…¨éƒ¨æ•´åˆåˆ°ä¸€å—ï¼Œå®ç°æ³¨è§£åŒ–è¿œç¨‹è°ƒç”¨ã€‚</li>\n</ul><p>æ‰«ææœºåˆ¶çš„åº”ç”¨åœºæ™¯æœ‰è‡ªç ”æ¡†æ¶ä¸éè‡ªç ”æ¡†æ¶ä¸¤ç§ï¼Œä½†è¿™ä¸¤ç±»åœºæ™¯éƒ½æ˜¯åœ¨è§£å†³æŸç§æ¯”è¾ƒèšç„¦çš„é—®é¢˜ï¼Œè€Œä¸”äº§ç”Ÿçš„æ¥å£è¿˜æ— æ³•è¢«Springç›´æ¥è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå°±å¯ä»¥é‡‡å–ç±»æ‰«ææœºåˆ¶å°†ä¸å˜çš„æµç¨‹é€šè¿‡æ ¸å¿ƒä»£ç†ç±»ç»Ÿä¸€å¤„ç†ï¼Œå°†å˜åŒ–çš„å› ç´ é‡Šæ”¾ç»™å„ä¸ªæ¥å£ã€‚</p><h3>æ€è€ƒé¢˜</h3><p>ä½ å·²ç»å­¦ä¼šäº†Springä¸ç³»ç»Ÿä»£ç æˆ–è‡ªç ”æ¡†æ¶çš„é›†æˆï¼Œæ ¸å¿ƒå°±æ˜¯åˆ©ç”¨æ‰«ææœºåˆ¶ç»Ÿä¸€ç”Ÿæˆä»£ç†æ¥å½’ä¸€åŒ–å¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä½ èƒ½å¦å°è¯•ç ”ç©¶ä¸‹Springä¸Mybatisæ˜¯æ€ä¹ˆæœ‰æœºç»“åˆèµ·æ¥ä½¿ç”¨çš„å‘¢ï¼Ÿ</p><p>æœŸå¾…çœ‹åˆ°ä½ çš„æ€è€ƒï¼Œå¦‚æœè§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ä¸€èµ·è®¨è®ºã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p><h3>12æ€è€ƒé¢˜å‚è€ƒ</h3><p>ä¸Šä¸€æœŸç•™äº†ä¸ªä½œä¸šï¼Œé€šè¿‡ä¸€æ¬¡ç®€å•çš„è°ƒç”¨ï¼Œçœ‹çœ‹ä¼šæ¶‰åŠåˆ°å“ªäº›æ¨¡å—ï¼Ÿ</p><p>è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬è¿˜æ˜¯åƒå¾€å¸¸ä¸€æ ·åˆ¶é€ å‡ºä¸€ç§å¼‚å¸¸ï¼Œç„¶åä»å¼‚å¸¸ä¸­åˆ†æé—®é¢˜ã€‚æ¥ä¸‹æ¥ä½ éœ€è¦åšè¿™ä¸‰æ­¥ï¼š</p><ul>\n<li>å¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼›</li>\n<li>å¯åŠ¨æä¾›æ–¹ï¼›</li>\n<li>å¯åŠ¨æ¶ˆè´¹æ–¹ï¼Œå¾…æ¶ˆè´¹æ–¹å¯åŠ¨åçœ‹åˆ°å¯åŠ¨æˆåŠŸçš„æ—¥å¿—åï¼Œå†å…³é—­æä¾›æ–¹ã€‚</li>\n</ul><pre><code class=\"language-java\">// æ¶ˆè´¹æ–¹çš„ç®€å•ç¤ºæ„ä»£ç \n@ImportResource(\"classpath:dubbo-12-arch-consumer.xml\")\n@SpringBootApplication\npublic class Dubbo12ArchConsumerApplication {\n    public static void main(String[] args) {\n        // å¯åŠ¨æ¶ˆè´¹æ–¹çš„ä¸€è¡Œæ ‡å‡†é€šç”¨ä»£ç \n        ConfigurableApplicationContext ctx =\n                SpringApplication.run(Dubbo12ArchConsumerApplication.class, args);\n        // æ‰“å°æ¶ˆè´¹æ–¹å¯åŠ¨æˆåŠŸçš„æ—¥å¿—\n        System.out.println(\"ã€ã€ã€ã€ã€ã€ Dubbo12ArchConsumerApplication ã€‘ã€‘ã€‘ã€‘ã€‘ã€‘å·²å¯åŠ¨.\");\n        \n        // æ¶ˆè´¹æ–¹å¯åŠ¨æˆåŠŸåï¼Œå°±å¯ä»¥å»å°†æä¾›æ–¹å…³é—­æ‰äº†ï¼Œ10 ç§’é’Ÿçš„ç¼“å†²æœŸå°±æ˜¯å»å…³é—­æä¾›æ–¹çš„æ—¶é—´\n        TimeUtils.sleep(10 * 1000);\n        \n        // å‘èµ·è¿œç¨‹è°ƒç”¨\n        DemoFacade demoFacade = ctx.getBean(DemoFacade.class);\n        System.out.println(demoFacade.sayHello(\"Geek\"));\n    }\n}\n</code></pre><p>ç»è¿‡è¿™ä¸‰æ­¥æ“ä½œï¼Œä½ ä¼šåœ¨æ¶ˆè´¹æ–¹çœ‹åˆ°å¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ï¼š</p><pre><code class=\"language-java\">Caused by: org.apache.dubbo.remoting.RemotingException: client(url: dubbo://192.168.100.183:28040/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&amp;application=dubbo-12-arch-consumer&amp;background=false&amp;category=providers,configurators,routers&amp;check=false&amp;codec=dubbo&amp;deprecated=false&amp;dubbo=2.0.2&amp;dynamic=true&amp;generic=false&amp;heartbeat=60000&amp;interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&amp;methods=sayHello,say&amp;pid=14664&amp;qos.enable=false&amp;release=3.0.7&amp;retries=-1&amp;service-name-mapping=true&amp;side=consumer&amp;sticky=false) failed to connect to server /192.168.100.183:28040, error message is:Connection refused: no further information: /192.168.100.183:28040\n\tat org.apache.dubbo.remoting.transport.netty4.NettyClient.doConnect(NettyClient.java:192)\n\tat org.apache.dubbo.remoting.transport.AbstractClient.connect(AbstractClient.java:214)\n\tat org.apache.dubbo.remoting.transport.AbstractClient.send(AbstractClient.java:190)\n\tat org.apache.dubbo.remoting.transport.AbstractPeer.send(AbstractPeer.java:53)\n\tat org.apache.dubbo.remoting.exchange.support.header.HeaderExchangeChannel.request(HeaderExchangeChannel.java:135)\n\tat org.apache.dubbo.remoting.exchange.support.header.HeaderExchangeClient.request(HeaderExchangeClient.java:100)\n\tat org.apache.dubbo.rpc.protocol.dubbo.ReferenceCountExchangeClient.request(ReferenceCountExchangeClient.java:93)\n\tat org.apache.dubbo.rpc.protocol.dubbo.DubboInvoker.doInvoke(DubboInvoker.java:111)\n\tat org.apache.dubbo.rpc.protocol.AbstractInvoker.doInvokeAndReturn(AbstractInvoker.java:221)\n\tat org.apache.dubbo.rpc.protocol.AbstractInvoker.invoke(AbstractInvoker.java:182)\n\tat org.apache.dubbo.rpc.listener.ListenerInvokerWrapper.invoke(ListenerInvokerWrapper.java:78)\n\tat org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.invokeWithContext(AbstractClusterInvoker.java:378)\n\tat org.apache.dubbo.rpc.cluster.support.FailoverClusterInvoker.doInvoke(FailoverClusterInvoker.java:80)\n\t... 24 more\nCaused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: no further information: /192.168.100.183:28040\nCaused by: java.net.ConnectException: Connection refused: no further information\n\tat java.base/sun.nio.ch.Net.pollConnect(Native Method)\n\tat java.base/sun.nio.ch.Net.pollConnectNow(Net.java:579)\n\tat java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:820)\n\tat io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:337)\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:776)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:830)\n</code></pre><p>é€šè¿‡ä»å¼‚å¸¸æ—¥å¿—ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œæ—¥å¿—ä¸­ç¬¬ 17 è¡ŒæŠ¥çš„æ˜¯ ConnectException è¿æ¥å¼‚å¸¸ï¼Œåé¢ç´§è·Ÿç€è¿æ¥è¢«æ‹’ç»ï¼ˆConnection refused: no further information: /192.168.100.183:28040ï¼‰çš„æç¤ºä¿¡æ¯ã€‚</p><p>å†å¾€ä¸Šçœ‹ï¼Œä½ ä¼šå‘ç°å¼‚å¸¸æ—¥å¿—ä¸­æ˜¯ç”¨ Netty å»è¿æ¥æä¾›æ–¹ï¼Œä½†ä¸å·§çš„æ˜¯ï¼Œè¿ä¸ä¸Šæä¾›æ–¹ã€‚</p><p>äºæ˜¯æˆ‘ä»¬æŠ“ç€æ—¥å¿—ç¬¬ 2 è¡Œï¼Œå» NettyClient ä»£ç çš„ç¬¬ 192 è¡Œç›´æ¥æ‰“ä¸ªæ–­ç‚¹ï¼Œæ–­ç‚¹éœ€è¦æ³¨æ„ä¸€å®šå¾—æ¶ˆè´¹æ–¹å¯åŠ¨æˆåŠŸåï¼Œç«‹é©¬å…³é—­æä¾›æ–¹ï¼Œç„¶åç«‹é©¬åœ¨æ¶ˆè´¹æ–¹è¿™è¾¹æ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶åé™é™ç­‰å¾…æ–­ç‚¹çš„åˆ°æ¥ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/12/8db2fc5b7fa3acf63e13772ffb54b212.png?wh=1920x2111\" alt=\"å›¾ç‰‡\"></p><p>é’ˆå¯¹æ–­ç‚¹çš„è°ƒç”¨å †æ ˆè¿›è¡Œåˆ†æåï¼Œä½ ä¼šå‘ç°ä¸€æ¬¡è°ƒç”¨æ¶‰åŠçš„æ¨¡å—æŒºå¤šçš„ã€‚æˆ‘è¿™é‡Œå±•ç¤ºçš„åªæ˜¯é’ˆå¯¹çœ‹åˆ°çš„å¼‚å¸¸ä¿¡æ¯è¿›è¡Œæ–­ç‚¹åçœ‹åˆ°çš„ä¸€äº›æ¨¡å—ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–æ¨¡å—æ²¡æœ‰åœ¨å †æ ˆä¸­ä½“ç°å‡ºæ¥ã€‚</p><p>å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥ç»§ç»­è·Ÿè¿› NettyClient çš„ doConnect æ–¹æ³•ï¼Œçœ‹çœ‹æœ€åæ˜¯æ€ä¹ˆå°† Request å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å‘é€å‡ºå»çš„ã€‚</p>","comments":[{"had_liked":false,"id":366705,"user_name":"èƒ¡æœˆğŸŒˆ","can_delete":false,"product_type":"c1","uid":1255734,"ip_address":"åŒ—äº¬","ucode":"D50890B8FF24A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/29/36/c6bb0893.jpg","comment_is_top":false,"comment_ctime":1674095009,"is_pvip":false,"replies":[{"id":133611,"content":"ä½ å¥½ï¼Œèƒ¡æœˆğŸŒˆï¼šæ˜¯çš„ï¼Œä½ æ€»ç»“çš„è¨€ç®€æ„èµ…ï¼Œéå¸¸niceï½è¿™äº›å¥—è·¯çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€è‡´çš„ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1674132702,"ip_address":"æ¹–å—","comment_id":366705,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"æ„Ÿè§‰å’Œspringé›†æˆçš„æ¡†æ¶ï¼Œfeignã€mybatiséƒ½æ˜¯è¿™ä¸ªå¥—è·¯ï¼šè‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰«æï¼ŒåŠ¨æ€ä»£ç†ç”Ÿæˆç›®æ ‡ç±»ã€‚","like_count":6,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600249,"discussion_content":"ä½ å¥½ï¼Œèƒ¡æœˆğŸŒˆï¼šæ˜¯çš„ï¼Œä½ æ€»ç»“çš„è¨€ç®€æ„èµ…ï¼Œéå¸¸niceï½è¿™äº›å¥—è·¯çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€è‡´çš„ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674132702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366458,"user_name":"æ–¯ç“¦è¾›æ­¦Roy","can_delete":false,"product_type":"c1","uid":2087578,"ip_address":"ä¸Šæµ·","ucode":"0A6AE232481B86","user_header":"https://static001.geekbang.org/account/avatar/00/1f/da/9a/ed524797.jpg","comment_is_top":false,"comment_ctime":1673831607,"is_pvip":false,"replies":[{"id":133535,"content":"ä½ å¥½ï¼Œæ–¯ç“¦è¾›æ­¦Royï¼šè¿™ä¸ªè¯¾ä¸»è¦æ˜¯æƒ³è®©å¤§å®¶æ·±åˆ»äº†è§£é›†æˆæ¡†æ¶çš„æ€æƒ³ï¼Œè‡³äºå¯¹åº”çš„Demoä»£ç æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å»äº†è§£è¿™ä¸ªåˆ†æ”¯ä»£ç çš„å®ç°ï¼šhttps:&#47;&#47;gitee.com&#47;ylimhhmily&#47;dubbo-feign-spring-boot-starter-master","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1364525,"ctime":1673855633,"ip_address":"æ¹–å—","comment_id":366458,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100312101,"comment_content":"ä½ çš„æºç é‡Œæ²¡çœ‹åˆ°è¿™ä¸€èŠ‚çš„ä»£ç å‘¢","like_count":1,"discussions":[{"author":{"id":1364525,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d2/2d/d303cfe0.jpg","nickname":"HMILYYLIMH","note":"","ucode":"9355AB4A1A1B97","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599876,"discussion_content":"ä½ å¥½ï¼Œæ–¯ç“¦è¾›æ­¦Royï¼šè¿™ä¸ªè¯¾ä¸»è¦æ˜¯æƒ³è®©å¤§å®¶æ·±åˆ»äº†è§£é›†æˆæ¡†æ¶çš„æ€æƒ³ï¼Œè‡³äºå¯¹åº”çš„Demoä»£ç æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å»äº†è§£è¿™ä¸ªåˆ†æ”¯ä»£ç çš„å®ç°ï¼šhttps://gitee.com/ylimhhmily/dubbo-feign-spring-boot-starter-master","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673855633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2087578,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/da/9a/ed524797.jpg","nickname":"æ–¯ç“¦è¾›æ­¦Roy","note":"","ucode":"0A6AE232481B86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600020,"discussion_content":"ä¹°è¿™ä¸ªè¯¾çš„ç›®çš„å°±æ˜¯æœ‰demoè·Ÿç€è€å¸ˆå­¦ä¹ ä¸€ä¸‹ç»éªŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673946216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2087578,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/da/9a/ed524797.jpg","nickname":"æ–¯ç“¦è¾›æ­¦Roy","note":"","ucode":"0A6AE232481B86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600018,"discussion_content":"è¿˜æ˜¯å»ºè®®æœ‰demoï¼Œå¥½å¤šäººéƒ½æ˜¯ä»demoå¼€å§‹å­¦ä¹ çš„ï¼Œç„¶åæ…¢æ…¢æ¨¡ä»¿ï¼Œæœ€åæ‰æœ‰äº†è‡ªå·±çš„æ€è·¯å’Œåˆ›æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673946180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}