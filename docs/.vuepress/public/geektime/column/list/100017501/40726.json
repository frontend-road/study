{"id":40726,"title":"01 | 设计秒杀系统时应该注意的5个架构原则","content":"<p>说起秒杀，我想你肯定不陌生，这两年，从双十一购物到春节抢红包，再到12306抢火车票，“秒杀”的场景处处可见。简单来说，秒杀就是在同一个时刻有大量的请求争抢购买同一个商品并完成交易的过程，用技术的行话来说就是大量的并发读和并发写。</p><p>不管是哪一门语言，并发都是程序员们最为头疼的部分。同样，对于一个软件而言也是这样，你可以很快增删改查做出一个秒杀系统，但是要让它支持高并发访问就没那么容易了。比如说，如何让系统面对百万级的请求流量不出故障？如何保证高并发情况下数据的一致性写？完全靠堆服务器来解决吗？这显然不是最好的解决方案。</p><p>在我看来，<strong>秒杀系统本质上就是一个满足大并发、高性能和高可用的分布式系统</strong>。今天，我们就来聊聊，如何在满足一个良好架构的分布式系统基础上，针对秒杀这种业务做到极致的性能改进。</p><h2>架构原则：“4要1不要”</h2><p>如果你是一个架构师，你首先要勾勒出一个轮廓，想一想如何构建一个超大流量并发读写、高性能，以及高可用的系统，这其中有哪些要素需要考虑。我把这些要素总结为“4要1不要”。</p><p><span class=\"orange\">1. 数据要尽量少</span></p><p>所谓“数据要尽量少”，首先是指用户请求的数据能少就少。请求的数据包括上传给系统的数据和系统返回给用户的数据（通常就是网页）。</p><!-- [[[read_end]]] --><p>为啥“数据要尽量少”呢？因为首先这些数据在网络上传输需要时间，其次不管是请求数据还是返回数据都需要服务器做处理，而服务器在写网络时通常都要做压缩和字符编码，这些都非常消耗CPU，所以减少传输的数据量可以显著减少CPU的使用。例如，我们可以简化秒杀页面的大小，去掉不必要的页面装修效果，等等。</p><p>其次，“数据要尽量少”还要求系统依赖的数据能少就少，包括系统完成某些业务逻辑需要读取和保存的数据，这些数据一般是和后台服务以及数据库打交道的。调用其他服务会涉及数据的序列化和反序列化，而这也是CPU的一大杀手，同样也会增加延时。而且，数据库本身也容易成为一个瓶颈，所以和数据库打交道越少越好，数据越简单、越小则越好。</p><p><span class=\"orange\">2. 请求数要尽量少</span></p><p>用户请求的页面返回后，浏览器渲染这个页面还要包含其他的额外请求，比如说，这个页面依赖的CSS/JavaScript、图片，以及Ajax请求等等都定义为“额外请求”，这些额外请求应该尽量少。因为浏览器每发出一个请求都多少会有一些消耗，例如建立连接要做三次握手，有的时候有页面依赖或者连接数限制，一些请求（例如JavaScript）还需要串行加载等。另外，如果不同请求的域名不一样的话，还涉及这些域名的DNS解析，可能会耗时更久。所以你要记住的是，减少请求数可以显著减少以上这些因素导致的资源消耗。</p><p>例如，减少请求数最常用的一个实践就是合并CSS和JavaScript文件，把多个JavaScript文件合并成一个文件，在URL中用逗号隔开（<a href=\"https://g.xxx.com/tm/xx-b/4.0.94/mods/\">https://g.xxx.com/tm/xx-b/4.0.94/mods/</a>??module-preview/index.xtpl.js,module-jhs/index.xtpl.js,module-focus/index.xtpl.js）。这种方式在服务端仍然是单个文件各自存放，只是服务端会有一个组件解析这个URL，然后动态把这些文件合并起来一起返回。</p><p><span class=\"orange\">3. 路径要尽量短</span></p><p>所谓“路径”，就是用户发出请求到返回数据这个过程中，需求经过的中间的节点数。</p><p>通常，这些节点可以表示为一个系统或者一个新的Socket连接（比如代理服务器只是创建一个新的Socket连接来转发请求）。每经过一个节点，一般都会产生一个新的Socket连接。</p><p>然而，每增加一个连接都会增加新的不确定性。从概率统计上来说，假如一次请求经过5个节点，每个节点的可用性是99.9%的话，那么整个请求的可用性是：99.9%的5次方，约等于99.5%。</p><p>所以缩短请求路径不仅可以增加可用性，同样可以有效提升性能（减少中间节点可以减少数据的序列化与反序列化），并减少延时（可以减少网络传输耗时）。</p><p>要缩短访问路径有一种办法，就是多个相互强依赖的应用合并部署在一起，把远程过程调用（RPC）变成JVM内部之间的方法调用。在《大型网站技术架构演进与性能优化》一书中，我也有一章介绍了这种技术的详细实现。</p><p><span class=\"orange\">4. 依赖要尽量少</span></p><p>所谓依赖，指的是要完成一次用户请求必须依赖的系统或者服务，这里的依赖指的是强依赖。</p><p>举个例子，比如说你要展示秒杀页面，而这个页面必须强依赖商品信息、用户信息，还有其他如优惠券、成交列表等这些对秒杀不是非要不可的信息（弱依赖），这些弱依赖在紧急情况下就可以去掉。</p><p>要减少依赖，我们可以给系统进行分级，比如0级系统、1级系统、2级系统、3级系统，0级系统如果是最重要的系统，那么0级系统强依赖的系统也同样是最重要的系统，以此类推。</p><p>注意，0级系统要尽量减少对1级系统的强依赖，防止重要的系统被不重要的系统拖垮。例如支付系统是0级系统，而优惠券是1级系统的话，在极端情况下可以把优惠券给降级，防止支付系统被优惠券这个1级系统给拖垮。</p><p><span class=\"orange\">5. 不要有单点</span></p><p>系统中的单点可以说是系统架构上的一个大忌，因为单点意味着没有备份，风险不可控，我们设计分布式系统最重要的原则就是“消除单点”。</p><p>那如何避免单点呢？我认为关键点是避免将服务的状态和机器绑定，即把服务无状态化，这样服务就可以在机器中随意移动。</p><p>如何那把服务的状态和机器解耦呢？这里也有很多实现方式。例如把和机器相关的配置动态化，这些参数可以通过配置中心来动态推送，在服务启动时动态拉取下来，我们在这些配置中心设置一些规则来方便地改变这些映射关系。</p><p>应用无状态化是有效避免单点的一种方式，但是像存储服务本身很难无状态化，因为数据要存储在磁盘上，本身就要和机器绑定，那么这种场景一般要通过冗余多个备份的方式来解决单点问题。</p><p>前面介绍了这些设计上的一些原则，但是你有没有发现，我一直说的是“尽量”而不是“绝对”？</p><p>我想你肯定会问是不是请求最少就一定最好，我的答案是“不一定”。我们曾经把有些CSS内联进页面里，这样做可以减少依赖一个CSS的请求从而加快首页的渲染，但是同样也增大了页面的大小，又不符合“数据要尽量少”的原则，这种情况下我们为了提升首屏的渲染速度，只把首屏的HTML依赖的CSS内联进来，其他CSS仍然放到文件中作为依赖加载，尽量实现首屏的打开速度与整个页面加载性能的平衡。</p><p>所以说，<strong>架构是一种平衡的艺术，而最好的架构一旦脱离了它所适应的场景，一切都将是空谈</strong>。我希望你记住的是，这里所说的几点都只是一个个方向，你应该尽量往这些方向上去努力，但也要考虑平衡其他因素。</p><h2>不同场景下的不同架构案例</h2><p>前面我说了一些架构上的原则，那么针对“秒杀”这个场景，怎样才是一个好的架构呢？下面我以淘宝早期秒杀系统架构的演进为主线，来帮你梳理不同的请求体量下，我认为的最佳秒杀系统架构。</p><p>如果你想快速搭建一个简单的秒杀系统，只需要把你的商品购买页面增加一个“定时上架”功能，仅在秒杀开始时才让用户看到购买按钮，当商品的库存卖完了也就结束了。这就是当时第一个版本的秒杀系统实现方式。</p><p>但随着请求量的加大（比如从1w/s到了10w/s的量级），这个简单的架构很快就遇到了瓶颈，因此需要做架构改造来提升系统性能。这些架构改造包括：</p><ol>\n<li>把秒杀系统独立出来单独打造一个系统，这样可以有针对性地做优化，例如这个独立出来的系统就减少了店铺装修的功能，减少了页面的复杂度；</li>\n<li>在系统部署上也独立做一个机器集群，这样秒杀的大流量就不会影响到正常的商品购买集群的机器负载；</li>\n<li>将热点数据（如库存数据）单独放到一个缓存系统中，以提高“读性能”；</li>\n<li>增加秒杀答题，防止有秒杀器抢单。</li>\n</ol><p>此时的系统架构变成了下图这个样子。最重要的就是，秒杀详情成为了一个独立的新系统，另外核心的一些数据放到了缓存（Cache）中，其他的关联系统也都以独立集群的方式进行部署。</p><p><img src=\"https://static001.geekbang.org/resource/image/ba/3d/ba65c2b4e2a2bae28192e1d456131f3d.jpg?wh=1052*748\" alt=\"\"></p><center><span class=\"reference\">图1 改造后的系统架构</span></center><p>然而这个架构仍然支持不了超过100w/s的请求量，所以为了进一步提升秒杀系统的性能，我们又对架构做进一步升级，比如：</p><ol>\n<li>对页面进行彻底的动静分离，使得用户秒杀时不需要刷新整个页面，而只需要点击抢宝按钮，借此把页面刷新的数据降到最少；</li>\n<li>在服务端对秒杀商品进行本地缓存，不需要再调用依赖系统的后台服务获取数据，甚至不需要去公共的缓存集群中查询数据，这样不仅可以减少系统调用，而且能够避免压垮公共缓存集群。</li>\n<li>增加系统限流保护，防止最坏情况发生。</li>\n</ol><p>经过这些优化，系统架构变成了下图中的样子。在这里，我们对页面进行了进一步的静态化，秒杀过程中不需要刷新整个页面，而只需要向服务端请求很少的动态数据。而且，最关键的详情和交易系统都增加了本地缓存，来提前缓存秒杀商品的信息，热点数据库也做了独立部署，等等。</p><p><img src=\"https://static001.geekbang.org/resource/image/50/65/5010fe68abebec4ed71e87147c0ee665.jpg?wh=1346*853\" alt=\"\"></p><center><span class=\"reference\">图2 进一步改造后的系统架构</span></center><p>从前面的几次升级来看，其实越到后面需要定制的地方越多，也就是越“不通用”。例如，把秒杀商品缓存在每台机器的内存中，这种方式显然不适合太多的商品同时进行秒杀的情况，因为单机的内存始终有限。所以要取得极致的性能，就要在其他地方（比如，通用性、易用性、成本等方面）有所牺牲。</p><h2>总结</h2><p>来让我们回顾下前面的内容，我首先介绍了构建大并发、高性能、高可用系统中几种通用的优化思路，并抽象总结为“4要1不要”原则，也就是：数据要尽量少、请求数要尽量少、路径要尽量短、依赖要尽量少，以及不要有单点。当然，这几点是你要努力的方向，具体操作时还是要密切结合实际的场景和具体条件来进行。</p><p>然后，我给出了实际构建秒杀系统时，根据不同级别的流量，由简单到复杂打造的几种系统架构，希望能供你参考。当然，这里面我没有说具体的解决方案，比如缓存用什么、页面静态化用什么，因为这些对于架构来说并不重要，作为架构师，你应该时刻提醒自己主线是什么。</p><p>说了这么多，总体上我希望给你一个方向，就是想构建大并发、高性能、高可用的系统应该从哪几个方向上去努力，然后在不同性能要求的情况下系统架构应该从哪几个方面去做取舍。同时你也要明白，越追求极致性能，系统定制开发就会越多，同时系统的通用性也就会越差。</p><p>最后，欢迎你在评论区和我分享你在设计秒杀系统时的一些经验和思考，你的经验对我们这个专栏来说也很重要。</p><p></p>","neighbors":{"left":{"article_title":"开篇词 | 秒杀系统架构设计都有哪些关键点？","id":40153},"right":{"article_title":"02 | 如何才能做好动静分离？有哪些方案可选？","id":40727}},"comments":[{"had_liked":false,"id":29349,"user_name":"黄金的太阳","can_delete":false,"product_type":"c1","uid":1105079,"ip_address":"","ucode":"9D7F2397124AB9","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg","comment_is_top":false,"comment_ctime":1538356778,"is_pvip":false,"replies":[{"id":"11706","content":"架构升级的逻辑要具体问题具体分析的<br>例如秒杀的场景来说，不同QPS量级下瓶颈也会不一样，10w级别可能瓶颈就在数据读取上，通过增加缓存一般就能解决，如果要到100w那么，可能服务端的网络可能都是瓶颈，所以要把大部分的静态数据放到cdn上甚至缓存在浏览器里<br>所以要做架构升级，还是主要要分析在预估的QPS下，整个系统的瓶颈会在什么地方，要针对这起瓶颈来重新设计架构方案","user_name":"作者回复","comment_id":29349,"uid":"1253339","ip_address":"","utype":1,"ctime":1539499043,"user_name_real":"君山"}],"discussion_count":3,"race_medal":0,"score":"1174064428586","product_id":100017501,"comment_content":"希望老师可以分别从1W QPS，10W QPS ，100WQPS在架构升级前遇到的性能瓶颈做为讲解入口点，为什么这样设计之后就能解决问题的方式，为什么切分点是1万，10万和100万，瓶颈的分析方式等等，感觉效果更好，否则看到一堆架构，但并不清楚为什么要这样做还是很难平移到自己的系统设计中，一点拙见，希望老师能够解惑","like_count":273,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425559,"discussion_content":"架构升级的逻辑要具体问题具体分析的\n例如秒杀的场景来说，不同QPS量级下瓶颈也会不一样，10w级别可能瓶颈就在数据读取上，通过增加缓存一般就能解决，如果要到100w那么，可能服务端的网络可能都是瓶颈，所以要把大部分的静态数据放到cdn上甚至缓存在浏览器里\n所以要做架构升级，还是主要要分析在预估的QPS下，整个系统的瓶颈会在什么地方，要针对这起瓶颈来重新设计架构方案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539499043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1158156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/0c/f3e37765.jpg","nickname":"夏","note":"","ucode":"2DE213960503A8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577037,"discussion_content":"感觉除了标题什么也没讲，浪费时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655896425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1253652,"avatar":"https://static001.geekbang.org/account/avatar/00/13/21/14/423a821f.jpg","nickname":"Steven","note":"","ucode":"3FE64459842015","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387641,"discussion_content":"硬件配置也没有提到，整体上感觉挺模糊的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628314885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29651,"user_name":"Mr.钧👻","can_delete":false,"product_type":"c1","uid":1249939,"ip_address":"","ucode":"D781E030E79245","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg","comment_is_top":false,"comment_ctime":1538469517,"is_pvip":false,"replies":[{"id":"11687","content":"👍","user_name":"作者回复","comment_id":29651,"uid":"1253339","ip_address":"","utype":1,"ctime":1539497147,"user_name_real":"君山"}],"discussion_count":2,"race_medal":0,"score":"353725787789","product_id":100017501,"comment_content":"高并发系统的几大方向<br>1.请求数据尽量少，从而减少cpu消耗<br>2.访问路径尽量短，减少节点消耗<br>3.强依赖尽量少，减少加载时间<br>4.不要有单点，要有备份<br>5.减少额外请求，减少加载时间","like_count":82,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425680,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2033730,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/08/42/b14f3a32.jpg","nickname":"Geek_2ecc5d","note":"","ucode":"4B6D777B754A80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285606,"discussion_content":"这些1年开发人员都知道的，基本常识，你不懂吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592891252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29394,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1538362556,"is_pvip":false,"replies":[{"id":"10656","content":"1.本地cache一般就是用内存实现，用java集合类型就行<br>2.用订阅的方式，在初始化时加载到内存<br>3.有两种方法，一是定时更新取3秒，二是，主动更新，数据库字段更新后发消息更新缓存，这个需要用到一个组件阿里叫metaq就是就是数据库字段更新会产生一条消息。另外cache里库存不需要100%和数据库一致，这个在后面的文章也有介绍","user_name":"作者回复","comment_id":29394,"uid":"1253339","ip_address":"","utype":1,"ctime":1538474665,"user_name_real":"君山"}],"discussion_count":3,"race_medal":0,"score":"190516923580","product_id":100017501,"comment_content":"1 .本地cache用什么实现好呢？<br>2. 通过什么方式往本地cache  写数据呢？ <br>3. 秒杀系统的及时性非常高，把库存写进cache  ，怎么及时更新呢？<br>","like_count":45,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425578,"discussion_content":"1.本地cache一般就是用内存实现，用java集合类型就行\n2.用订阅的方式，在初始化时加载到内存\n3.有两种方法，一是定时更新取3秒，二是，主动更新，数据库字段更新后发消息更新缓存，这个需要用到一个组件阿里叫metaq就是就是数据库字段更新会产生一条消息。另外cache里库存不需要100%和数据库一致，这个在后面的文章也有介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538474665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2288362,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","nickname":"耶马","note":"","ucode":"3A3CF67B016CDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351775,"discussion_content":"可以进行预扣的,比如现在库存还有1000多,可以直接redis进行扣除,如果数据量到了0台,这个时候进行数据库库存更新也是可以的,但是就怕担心redis 挂了,数据丢失","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614435031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793962,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5f/aa/63e641c1.jpg","nickname":"H","note":"","ucode":"04D7D030245E27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319516,"discussion_content":"期待老师讲解一下内存的数据为什么不用100%和数据库一致？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604043327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30889,"user_name":"酱了个油","can_delete":false,"product_type":"c1","uid":1059627,"ip_address":"","ucode":"5A13CA4EAACB81","user_header":"https://static001.geekbang.org/account/avatar/00/10/2b/2b/bebf6eed.jpg","comment_is_top":false,"comment_ctime":1539043974,"is_pvip":false,"replies":[{"id":"11671","content":"👍","user_name":"作者回复","comment_id":30889,"uid":"1253339","ip_address":"","utype":1,"ctime":1539495490,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"117503160966","product_id":100017501,"comment_content":"库存不会放在localcache，localcache只放静态数据。<br>库存是放在独立的缓存系统里，如redis，库存是采用主动失效的方式来失效缓存","like_count":28,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426132,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539495490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29397,"user_name":"Edward","can_delete":false,"product_type":"c1","uid":1058243,"ip_address":"","ucode":"7C8DE1047BB62E","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/c3/da248508.jpg","comment_is_top":false,"comment_ctime":1538362781,"is_pvip":false,"replies":[{"id":"10574","content":"在内存的数据是静态数据，不会更新，没有一致性问题","user_name":"作者回复","comment_id":29397,"uid":"1253339","ip_address":"","utype":1,"ctime":1538386465,"user_name_real":"君山"}],"discussion_count":4,"race_medal":0,"score":"113207512477","product_id":100017501,"comment_content":"数据缓存在机器内存中的话，集群内如何实现多台机器数据一致性？","like_count":26,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425580,"discussion_content":"在内存的数据是静态数据，不会更新，没有一致性问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1538386465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/86/3be94807.jpg","nickname":"angel😇txy🤓","note":"","ucode":"C0AEE0D8BAF7ED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6951,"discussion_content":"作者的意思应该是，只是将秒杀开始之前的库存信息，商品详情信息加载到cache，后面库存减少之后也不管内存数据得一致性了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567196561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2209419,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b6/8b/96b1bbb2.jpg","nickname":"大雨大雨跑","note":"","ucode":"5CE70A2305B7A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1133702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/86/3be94807.jpg","nickname":"angel😇txy🤓","note":"","ucode":"C0AEE0D8BAF7ED","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":374070,"discussion_content":"这样还不超卖?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620985847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6951,"ip_address":""},"score":374070,"extra":""},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2209419,"avatar":"https://static001.geekbang.org/account/avatar/00/21/b6/8b/96b1bbb2.jpg","nickname":"大雨大雨跑","note":"","ucode":"5CE70A2305B7A2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393005,"discussion_content":"读取时要快但不保证准确，更新时才真正去db操作保证强一致性，也就是说会有请求提交后才发现库存用完了。作者的意思是这样的吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631200736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374070,"ip_address":""},"score":393005,"extra":""}]}]},{"had_liked":false,"id":29366,"user_name":"王永旺","can_delete":false,"product_type":"c1","uid":1075751,"ip_address":"","ucode":"81D1F1DF8D92B8","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI8qNibLrzJyrNv6C3BKRm0ibbibrSrcLxiaWOicQUEcUuk75hG5tdCnAYiapHrHuSdxyXhp1B5ZDKiahHIg/0","comment_is_top":false,"comment_ctime":1538358650,"is_pvip":false,"replies":[{"id":"10572","content":"单点就是没有备份，挂了系统没法正常服务了","user_name":"作者回复","comment_id":29366,"uid":"1253339","ip_address":"","utype":1,"ctime":1538385763,"user_name_real":"君山"}],"discussion_count":4,"race_medal":0,"score":"74552802682","product_id":100017501,"comment_content":"单点的概念是啥意思，不太明白","like_count":17,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425565,"discussion_content":"单点就是没有备份，挂了系统没法正常服务了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538385763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609967,"avatar":"https://static001.geekbang.org/account/avatar/00/18/90/ef/06254713.jpg","nickname":"higherzjm","note":"","ucode":"A8DE03930D41D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349500,"discussion_content":"可以理解为分布式部署","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613270832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2033730,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/08/42/b14f3a32.jpg","nickname":"Geek_2ecc5d","note":"","ucode":"4B6D777B754A80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285607,"discussion_content":"我很好奇，实习生都知道一台服务挂了，就挂了，你不懂吗，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592891344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1085152,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8e/e0/847348b1.jpg","nickname":"爱学习的大叔","note":"","ucode":"91F9ABF1EC98D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261752,"discussion_content":"我还以为是单点登陆呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589002098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29610,"user_name":"王虹凯","can_delete":false,"product_type":"c1","uid":1018862,"ip_address":"","ucode":"CA01E64E125CFF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8b/ee/56823fd7.jpg","comment_is_top":false,"comment_ctime":1538451763,"is_pvip":false,"replies":[{"id":"11684","content":"你想了解那块内容，我可以单独发给你😊","user_name":"作者回复","comment_id":29610,"uid":"1253339","ip_address":"","utype":1,"ctime":1539497027,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"61667993907","product_id":100017501,"comment_content":"能不能给一些你认为的关键知识点在文章最后加一些对这些点的外链。这样可以更详细，当然更具系统性。 极客时间也可以考虑这样的一个功能，整个当前专栏共用这些链接。<br><br>当然，作者不加这些也没问题，只是觉得那样是不是更权威些。不过要求作者太多了！","like_count":14,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425671,"discussion_content":"你想了解那块内容，我可以单独发给你😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29502,"user_name":"MeazZa","can_delete":false,"product_type":"c1","uid":1061193,"ip_address":"","ucode":"D65DC7742618EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/49/c83d3d1a.jpg","comment_is_top":false,"comment_ctime":1538396822,"is_pvip":false,"replies":[{"id":"11703","content":"缓存的更新一般都是没命中时再填充更新<br><br>没命中的原因一种是主动失效，一种是定时失效<br><br>公用缓存主动失效较多，本地缓存，定时失效更常用","user_name":"作者回复","comment_id":29502,"uid":"1253339","ip_address":"","utype":1,"ctime":1539498867,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"61667938966","product_id":100017501,"comment_content":"请问一下减库存的结果分别是如何更新到公共缓存和本地缓存的呢？","like_count":15,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425644,"discussion_content":"缓存的更新一般都是没命中时再填充更新\n\n没命中的原因一种是主动失效，一种是定时失效\n\n公用缓存主动失效较多，本地缓存，定时失效更常用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539498867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44115,"user_name":"云飞","can_delete":false,"product_type":"c1","uid":1257826,"ip_address":"","ucode":"EDA647669DC9F6","user_header":"https://static001.geekbang.org/account/avatar/00/13/31/62/6f1bb71e.jpg","comment_is_top":false,"comment_ctime":1543369925,"is_pvip":false,"replies":[{"id":"16252","content":"这里的单点有两层含义<br>一是本身的系统是单点系统，比如你说的登录系统，所以其他系统需要验证登录状态时都需要调用他，那他就是一个单点，怎么解决？解决的办法就是尽量让这个系统简单，减少更改保持稳定。<br>另外一种是状态单点或者叫数据单点，也就是状态一旦丢失比较难恢复，这个就比较麻烦，比如保存登录状态的session保存在一台机器内存中，一旦这台机器挂掉，状态丢失就比较难恢复，这个单点就比较严重","user_name":"作者回复","comment_id":44115,"uid":"1253339","ip_address":"","utype":1,"ctime":1543726286,"user_name_real":"君山"}],"discussion_count":2,"race_medal":0,"score":"48788010181","product_id":100017501,"comment_content":"老师你好，刚才说要设计时候尽量做到4要1不要，1不要就是不要用单点，也就是因为没有数据备份，想问这个单点和单点登录系统的单点有什么关系吗？希望老师有时间可以解答一下。","like_count":11,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430633,"discussion_content":"这里的单点有两层含义\n一是本身的系统是单点系统，比如你说的登录系统，所以其他系统需要验证登录状态时都需要调用他，那他就是一个单点，怎么解决？解决的办法就是尽量让这个系统简单，减少更改保持稳定。\n另外一种是状态单点或者叫数据单点，也就是状态一旦丢失比较难恢复，这个就比较麻烦，比如保存登录状态的session保存在一台机器内存中，一旦这台机器挂掉，状态丢失就比较难恢复，这个单点就比较严重","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1543726286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2088626,"avatar":"","nickname":"志江","note":"","ucode":"8A07D53769B3C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296311,"discussion_content":"老师回答的真好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596507044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42950,"user_name":"1024","can_delete":false,"product_type":"c1","uid":1325126,"ip_address":"","ucode":"9DFAF1F44D469F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dglMUGgevn9w5w3AGtTDibGhqGjf7G3GHwlOGXQl25xD7g2EsEktgxh2v4dgriaI2yLG2j45IhZCbhVg1eDrugOQ/132","comment_is_top":false,"comment_ctime":1543117893,"is_pvip":false,"replies":[{"id":"16250","content":"😊","user_name":"作者回复","comment_id":42950,"uid":"1253339","ip_address":"","utype":1,"ctime":1543724024,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"48787758149","product_id":100017501,"comment_content":"阅读5分钟，留言中回复看了半个多小时；感觉从读者讨论中收益更大，许神加油！","like_count":11,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430255,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543724024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67670,"user_name":"broken_open","can_delete":false,"product_type":"c1","uid":1313347,"ip_address":"","ucode":"764CF5EEACC4AD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJjTz6oOKAXefgCNHTuTmwibBPJX9a4c407GHYmFPdMRgX67nZiavj2KhbiczicaaeSGxOxiaibnqH7icnVw/132","comment_is_top":false,"comment_ctime":1550220852,"is_pvip":false,"replies":[{"id":"26117","content":"😉","user_name":"作者回复","comment_id":67670,"uid":"1253339","ip_address":"","utype":1,"ctime":1551524966,"user_name_real":"君山"}],"discussion_count":11,"race_medal":0,"score":"44499893812","product_id":100017501,"comment_content":"老师你好，减库存操作，update  count = count-1  where  count&gt;0，这种做法不会多卖吧？","like_count":10,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439319,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551524966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"慎独明强","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299777,"discussion_content":"不会多卖，但是性能不高啊。类似于在数据库层面加锁","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597813293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005124,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/44/e9592c2b.jpg","nickname":"科学养猪","note":"","ucode":"D7CA668074D4F6","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":110656,"discussion_content":"我们之前做的一个秒杀就是这么干的😌","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577751152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2415448,"avatar":"https://static001.geekbang.org/account/avatar/00/24/db/58/a7a0a85b.jpg","nickname":"二饼","note":"","ucode":"48120565D135F7","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586126,"discussion_content":"赞同不会超卖但是对数据库性能有影响，每次update都会获取行锁，如果并发量上去了，同时又大量的请求要求对这条记录进行操作，会造成数据库的性能瓶颈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661997345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"重庆"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2272953,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ae/b9/12a8ec62.jpg","nickname":"松","note":"","ucode":"59BB9AAC7863B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359690,"discussion_content":"老师也不回答，更新时会加锁，数据库层是串行更新，所以肯定不会超卖，update是当前读，读的都是最新事物提交的，当更新返回数据行小于1，就说明失败了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616251446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1939320,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/97/78/9229749e.jpg","nickname":"未见","note":"","ucode":"EC8F9B0E5F3D9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351496,"discussion_content":"秒杀的话就可能出现多卖的现象了，你得在代码业务层做些加锁操作了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614305913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2029554,"avatar":"","nickname":"Geek_63c469","note":"","ucode":"ADB81C5F27AB09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335812,"discussion_content":"一次可秒杀多个就超卖了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608341400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1641662,"avatar":"https://static001.geekbang.org/account/avatar/00/19/0c/be/ee3e52cf.jpg","nickname":"魏龙云","note":"","ucode":"7D6B5D9DA359A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2029554,"avatar":"","nickname":"Geek_63c469","note":"","ucode":"ADB81C5F27AB09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382141,"discussion_content":"不会啊大哥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625449200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":335812,"ip_address":""},"score":382141,"extra":""}]},{"author":{"id":1486601,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL2dAokNdibVZvaBwpQ8ZJ9DDZtAoIKvW32YpdK499WpjpmJiakLCxvn5fX5MNIlehiaibRX4IgSuwckw/132","nickname":"Dawn","note":"","ucode":"8764B8812E5FF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297444,"discussion_content":"并发上来的时候，这种更新就不现实了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596940001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1158349,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/cd/fda6374f.jpg","nickname":"Louis","note":"","ucode":"BC667839F17937","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270782,"discussion_content":"这不三岁小孩玩泥沙吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590053521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813559,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/37/8704144f.jpg","nickname":"覃丰","note":"","ucode":"CA3239CD545D06","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228944,"discussion_content":"你觉得呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586593466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30133,"user_name":"李海凡","can_delete":false,"product_type":"c1","uid":1127184,"ip_address":"","ucode":"64A0AD89F139BF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/10/0592f684.jpg","comment_is_top":false,"comment_ctime":1538695857,"is_pvip":false,"replies":[{"id":"11681","content":"架构升级的逻辑要具体问题具体分析的<br><br>例如秒杀的场景来说，不同QPS量级下瓶颈也会不一样，10w级别可能瓶颈就在数据读取上，通过增加缓存一般就能解决，如果要到100w那么，可能服务端的网络可能都是瓶颈，所以要把大部分的静态数据放到cdn上甚至缓存在浏览器里<br><br>所以要做架构升级，还是主要要分析在预估的QPS下，整个系统的瓶颈会在什么地方，要针对这起瓶颈来重新设计架构方案","user_name":"作者回复","comment_id":30133,"uid":"1253339","ip_address":"","utype":1,"ctime":1539496904,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"35898434225","product_id":100017501,"comment_content":"想了解系统性能和架构升级背后的逻辑是什么，这样设计系统解决了具体什么瓶颈，例如您举的例子中，qps只能到10w、为什么只能到10w,瓶颈在什么地方，如何分析，如何解决","like_count":8,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425864,"discussion_content":"架构升级的逻辑要具体问题具体分析的\n\n例如秒杀的场景来说，不同QPS量级下瓶颈也会不一样，10w级别可能瓶颈就在数据读取上，通过增加缓存一般就能解决，如果要到100w那么，可能服务端的网络可能都是瓶颈，所以要把大部分的静态数据放到cdn上甚至缓存在浏览器里\n\n所以要做架构升级，还是主要要分析在预估的QPS下，整个系统的瓶颈会在什么地方，要针对这起瓶颈来重新设计架构方案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539496904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29520,"user_name":"Lugyedo","can_delete":false,"product_type":"c1","uid":1011793,"ip_address":"","ucode":"EB5E456B638E70","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg","comment_is_top":false,"comment_ctime":1538402113,"is_pvip":true,"replies":[{"id":"10775","content":"减库存一章会有介绍","user_name":"作者回复","comment_id":29520,"uid":"1253339","ip_address":"","utype":1,"ctime":1538621807,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"31603173185","product_id":100017501,"comment_content":"缓存中的热点数据在高并发情况下如何保证一致","like_count":7,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425650,"discussion_content":"减库存一章会有介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538621807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29508,"user_name":"潘政宇","can_delete":false,"product_type":"c1","uid":1254758,"ip_address":"","ucode":"9A6658EE862D95","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/66/4835d92e.jpg","comment_is_top":false,"comment_ctime":1538398388,"is_pvip":true,"replies":[{"id":"11700","content":"就是每经过一个节点会产生一个新的tcp连接","user_name":"作者回复","comment_id":29508,"uid":"1253339","ip_address":"","utype":1,"ctime":1539498200,"user_name_real":"君山"}],"discussion_count":3,"race_medal":0,"score":"31603169460","product_id":100017501,"comment_content":"每经过一个节点，一般都会产生一个新的 Socket 连接。什么意思啊，不是一个tcp连接就有一个socket吗，从客户端到server就是一个tcp连接啊？","like_count":7,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425646,"discussion_content":"就是每经过一个节点会产生一个新的tcp连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539498200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1289318,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ac/66/a256008b.jpg","nickname":"SuperDai","note":"","ucode":"0CA86D253754CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14899,"discussion_content":"中间如果有反向代理服务器，Client和Server就不是直连的了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1568788074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1f/e5/053ebfc9.jpg","nickname":"•••","note":"","ucode":"D7F185FC4BFE14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565663,"discussion_content":"应该是客户请求的这个服务内部，又请求了多个远程服务，从而产生的tcp连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650510991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87422,"user_name":"Mine","can_delete":false,"product_type":"c1","uid":1253597,"ip_address":"","ucode":"85C3A3117FD9CB","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/dd/82d8eff2.jpg","comment_is_top":false,"comment_ctime":1555590175,"is_pvip":false,"replies":[{"id":"34288","content":"发消息就是为了更新缓存啊","user_name":"作者回复","comment_id":87422,"uid":"1253339","ip_address":"","utype":1,"ctime":1558246073,"user_name_real":"君山"}],"discussion_count":8,"race_medal":0,"score":"27325393951","product_id":100017501,"comment_content":"库存cache的更新为什么要通过mq去处理呢，感觉直接在操作数据库之后更新下缓存就可以了啊～ 为什么还要发一条消息呢～ ","like_count":6,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447438,"discussion_content":"发消息就是为了更新缓存啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558246073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000439,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","nickname":"刘冲","note":"","ucode":"0C4F66921AE76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":144547,"discussion_content":"这个主要是异步处理，减少阻塞","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579529719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1498680,"avatar":"https://static001.geekbang.org/account/avatar/00/16/de/38/79a02d5d.jpg","nickname":"OverWatcher","note":"","ucode":"DCB76E429CA6D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24157,"discussion_content":"单机的情况可以，集群的环境下通过消息通知所有机器去更新缓存","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1570020930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2415448,"avatar":"https://static001.geekbang.org/account/avatar/00/24/db/58/a7a0a85b.jpg","nickname":"二饼","note":"","ucode":"48120565D135F7","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586131,"discussion_content":"因为MySQL操作是BIO，同步阻塞的，因此这里我们加一个mq，异步操作数据库，减少等待时间，同时也对业务进行解耦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661998221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"重庆"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124777,"avatar":"https://static001.geekbang.org/account/avatar/00/11/29/a9/4c114382.jpg","nickname":"qpy","note":"","ucode":"4D95DDF313DDCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354746,"discussion_content":"因为是异步消息，那在这个异步消息被消费前(就是缓存没有失效前)有请求进来了，读到了缓存里的旧数据，这种数据不一致问题，怎么解决？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615338901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1122277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1f/e5/053ebfc9.jpg","nickname":"•••","note":"","ucode":"D7F185FC4BFE14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1124777,"avatar":"https://static001.geekbang.org/account/avatar/00/11/29/a9/4c114382.jpg","nickname":"qpy","note":"","ucode":"4D95DDF313DDCF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565665,"discussion_content":"这种读的弱一致性是允许的，在最后的更新层面实现最终一次性吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650511105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":354746,"ip_address":""},"score":565665,"extra":""}]},{"author":{"id":1158349,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ac/cd/fda6374f.jpg","nickname":"Louis","note":"","ucode":"BC667839F17937","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270784,"discussion_content":"数据库和缓存的双写一致性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590053688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1063308,"avatar":"https://static001.geekbang.org/account/avatar/00/10/39/8c/089525aa.jpg","nickname":"小乙哥","note":"","ucode":"C77E79BEA0C325","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42099,"discussion_content":"主动更新缓存存在更新失败的情况下，导致数据不一致的情况。一般采用主动失效缓存，在读未命中的情况下，再更新缓存。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572585902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108519,"user_name":"小黄鸡","can_delete":false,"product_type":"c1","uid":1052618,"ip_address":"","ucode":"9497430EB4CDAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/ca/532d8e8e.jpg","comment_is_top":false,"comment_ctime":1561790915,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"23036627395","product_id":100017501,"comment_content":"想问下许老师，<br>1. 基于canal同步mysql的数据到redis中，如果是更新操作，redis有延时怎么办呢？<br>2. 从mysql同步主mysql，如果有延时，怎么办呢？<br>这两个问题一直困扰着我","like_count":5,"discussions":[{"author":{"id":1675882,"avatar":"https://static001.geekbang.org/account/avatar/00/19/92/6a/dd37a054.jpg","nickname":"张y .","note":"","ucode":"85918469492F4C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388915,"discussion_content":"1、有延迟就延迟，就想买火车票似的，看到界面有余票但是点不进去。\n2、在主写，从 那个短暂的延时可以忽略，强一致，可以sharding-jdbc设置当前读主","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629040034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073657,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/1mQHJjAyFjypbiaheQ9hDWRoictrVn2VggIZiaPLm50UiatHu9NqExMicScs9f7zYicbTQPliatTT18hr4csibRh4ARYbA/132","nickname":"leo","note":"","ucode":"614A2F77A6B553","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300971,"discussion_content":"分布式的系统只能保证最终一致性，中间某个时间点允许不同步的情况。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598348439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1073657,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/1mQHJjAyFjypbiaheQ9hDWRoictrVn2VggIZiaPLm50UiatHu9NqExMicScs9f7zYicbTQPliatTT18hr4csibRh4ARYbA/132","nickname":"leo","note":"","ucode":"614A2F77A6B553","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326578,"discussion_content":"1，既然你选择了canal去同步缓存，那就是你业务上能接受短暂的数据不一致，否则不能这样同步缓存。\n2，主从延时多发生在更新数据量巨大的情况下，也可能网络问题，看具体什么情况吧。如果必须强一致，都主库。但是要考虑对主库的压力。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1605620189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":300971,"ip_address":""},"score":326578,"extra":""},{"author":{"id":2288362,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","nickname":"耶马","note":"","ucode":"3A3CF67B016CDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"圆圆满满","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351776,"discussion_content":"同时库的读写分离也相当于是失效的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614435125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326578,"ip_address":""},"score":351776,"extra":""},{"author":{"id":1122277,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1f/e5/053ebfc9.jpg","nickname":"•••","note":"","ucode":"D7F185FC4BFE14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2288362,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","nickname":"耶马","note":"","ucode":"3A3CF67B016CDB","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":565673,"discussion_content":"强一致性的业务肯定只能用主库了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650512923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351776,"ip_address":""},"score":565673,"extra":""}]},{"author":{"id":2582372,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/sTmCOXh19off3uvUDIsDic4SYJGulgl1v6o3R4E32OZCkZAVzZw751jg9Tya8jLicxKzQWHC4Bu6o08J55YJib9oQ/132","nickname":"wsyzwddsg111","note":"","ucode":"7C59E81ECFF8AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372556,"discussion_content":"现实中哪个没有延迟你告诉我","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620375825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1515024,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL7J5Yb5nofkD1Wp7gEtoEhNCuv70DUDcu26XtOK0UrFyuQltje0P1icTLMOW2unCa5u6nCdWQNrlg/132","nickname":"Better","note":"","ucode":"4170A84A7EB378","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356802,"discussion_content":"实时同步的系统基本不存在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615685136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31038,"user_name":"南琛一梦","can_delete":false,"product_type":"c1","uid":1030082,"ip_address":"","ucode":"6338D5428DB2B0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/c2/196932c7.jpg","comment_is_top":false,"comment_ctime":1539074804,"is_pvip":false,"replies":[{"id":"11670","content":"😊，可以看看后面的文章，会有更一些详细的介绍","user_name":"作者回复","comment_id":31038,"uid":"1253339","ip_address":"","utype":1,"ctime":1539495452,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"23013911284","product_id":100017501,"comment_content":"文中讲的原则在后续给出的架构演变例子中，并没有很好的进行说明，看完之后，并没有对此有深刻体会","like_count":5,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426194,"discussion_content":"😊，可以看看后面的文章，会有更一些详细的介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539495452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29509,"user_name":"猎户星座","can_delete":false,"product_type":"c1","uid":1254963,"ip_address":"","ucode":"D9CF2DF5315E79","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/33/6beaea17.jpg","comment_is_top":false,"comment_ctime":1538398702,"is_pvip":false,"replies":[{"id":"11699","content":"都是以服务端的时间为准，服务端的时间同步需要依赖一个时间同步组件完成如ntp<br>当然当前的服务器时间同步还是有一定的时间延时，但是也不是太影响","user_name":"作者回复","comment_id":29509,"uid":"1253339","ip_address":"","utype":1,"ctime":1539498144,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"23013235182","product_id":100017501,"comment_content":"请问秒杀的时间是怎么控制的，比如十点开始，十点十分结束。各个客户端、客户端与服务器、以及集群内的服务器之间。时间如何精确同步？","like_count":5,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425647,"discussion_content":"都是以服务端的时间为准，服务端的时间同步需要依赖一个时间同步组件完成如ntp\n当然当前的服务器时间同步还是有一定的时间延时，但是也不是太影响","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539498144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81245,"user_name":"xiaoxiangran","can_delete":false,"product_type":"c1","uid":1007520,"ip_address":"","ucode":"E58E09261D1916","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5f/a0/bc54404a.jpg","comment_is_top":false,"comment_ctime":1553841631,"is_pvip":false,"replies":[{"id":"30087","content":"各有利弊，就看你最在意什么：）","user_name":"作者回复","comment_id":81245,"uid":"1253339","ip_address":"","utype":1,"ctime":1554532029,"user_name_real":"君山"}],"discussion_count":2,"race_medal":0,"score":"18733710815","product_id":100017501,"comment_content":"我对秒杀系统有个最大的疑惑，就是从页面发出的请求用同步还是异步？如果用同步的话：1，后端服务必然是分布式的，需要经过多个节点，时间可能会被拉的很长，同时失败的可能性也会增大；2，基于1的情况，会有一个长连接长时间存在，这样随着请求的增多，连接资源越来越少，系统吞吐量会是瓶颈。如果用异步的话：不断的轮询必然会增加系统的请求量，对连接资源也是一种浪费。所以，这应该怎么选择呢？","like_count":4,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445129,"discussion_content":"各有利弊，就看你最在意什么：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554532029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1139455,"avatar":"https://static001.geekbang.org/account/avatar/00/11/62/ff/f71034e9.jpg","nickname":"悟空WuKong","note":"","ucode":"49AFD2B048C1BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217447,"discussion_content":"为啥非得轮询，可以异步处理完后websocket推动前端呀","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585560491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76224,"user_name":"机遇号","can_delete":false,"product_type":"c1","uid":1105053,"ip_address":"","ucode":"A2940DE77BCAEA","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/9d/e20b37d7.jpg","comment_is_top":false,"comment_ctime":1552553222,"is_pvip":false,"replies":[{"id":"30094","content":"几句话很难解释清楚，建议看看《大型网站技术架构演进》的合并部署一章有详细的解释","user_name":"作者回复","comment_id":76224,"uid":"1253339","ip_address":"","utype":1,"ctime":1554532795,"user_name_real":"君山"}],"discussion_count":1,"race_medal":0,"score":"18732422406","product_id":100017501,"comment_content":"您好，<br>关于这个没搞懂。<br>把远程过程调用（RPC）变成 JVM 内部之间的方法调用。<br>这个怎么解释一下吗","like_count":4,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443224,"discussion_content":"几句话很难解释清楚，建议看看《大型网站技术架构演进》的合并部署一章有详细的解释","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554532795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69337,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1550719161,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18730588345","product_id":100017501,"comment_content":"什么是秒杀:<br><br>简单来说,秒杀就是在同一个时刻有大量的请求争抢购买同一个商品并完成交易的过程,用技术的行话来说就是大量的并发读和并发写。<br><br>秒杀系统:<br><br>秒杀其实主要解决两个问题,一个是并发读,一个是并发写。并发读的核心优化理念是尽量减少用户到服务端来&quot;读”数据,或者让他们读更少的数据;并发写的处理原则也一样,它要求我们在数据库层面独立出来一个库,做特殊的处理。另外,我们还要针对秒杀系统做一些保护,针对意料之外的情况设计兜底方案,以防止最坏的情况发生。<br><br>要想打造并维护一个超大流量并发读写、高性能、高可用的系统,在整个用户请求路径上从浏览器到服务端我们要遵循几个原则,就是要保证用户请求的数据尽量少、请求数尽量少、路径尽量短、依赖尽量少,并且不要有单点。<br><br>秒杀系统本质上就是一个满足大并发、高性能和高可用的分布式系统。<br><br><br>&quot;4要1不要&quot;原则:数据要尽量少、请求数要尽量少、路径要尽量短、依赖要尽量少,以及不要有单点。<br><br><br><br>淘宝秒杀系统的演变(不同量级的秒杀系统架构方案):<br><br>一  把你的商品购买页面增加一个&quot;定时上·架&quot;功能,仅在秒杀开始时才让用户看到购买按钮,当商品的库存卖完了也就结束了。<br><br><br>二<br>1,把秒杀系统独立出来单独打造一个系统,这样可以有针对性地做优化,例如这个独立出来的系统就减少了店铺装修的功能,减少了页面的复杂度;,<br>2,在系统部署上也独立做一个机器集群,这样秒杀的大流量就不会影响到正常的商品购买集群的机器负载;<br>3,将热点数据(如库存数据)单独放到一个缓存系统中,以提高&quot;读性能&quot;<br>4,增加秒杀答题,防止有秒杀器抢单。<br><br><br>三<br>1,对页面进行彻底的动静分离,使得用户秒杀时不需要刷新整个页面,而只需要点击抢宝按钮，借此把页面刷新的数据降到最少;<br>2,在服务端对秒杀商品进行本地缓存,不需要再调用依赖系统的后台服务获取数据,甚不需要去公共的缓存集群中查询数据,这样不仅可以减少系统调用,而且能够避免压塔公共缓存集群。<br>3,增加系统限流保护,防止最坏情况发生。<br>","like_count":4},{"had_liked":false,"id":69063,"user_name":"nico","can_delete":false,"product_type":"c1","uid":1068837,"ip_address":"","ucode":"A7A1471CB238AB","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/25/75316ed6.jpg","comment_is_top":false,"comment_ctime":1550654560,"is_pvip":false,"replies":[{"id":"26123","content":"不太明白你问啥意思，是说压测工具吗？ Apache ab就很好","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1551525529,"ip_address":"","comment_id":69063,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18730523744","product_id":100017501,"comment_content":"老师 ，测试秒杀系统现在比较好用的工具都有哪些？可否推荐一下。","like_count":4,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439939,"discussion_content":"不太明白你问啥意思，是说压测工具吗？ Apache ab就很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551525529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41943,"user_name":"一成","can_delete":false,"product_type":"c1","uid":1321338,"ip_address":"","ucode":"E0CEC89BFD144A","user_header":"https://static001.geekbang.org/account/avatar/00/14/29/7a/a60948c3.jpg","comment_is_top":false,"comment_ctime":1542878790,"is_pvip":false,"replies":[{"id":"16245","content":"感谢😄","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1543723697,"ip_address":"","comment_id":41943,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427780678","product_id":100017501,"comment_content":"读过作者的《深入分析java技术内幕》,看到作者的专栏直接订阅了","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429952,"discussion_content":"感谢😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543723697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31476,"user_name":"王维","can_delete":false,"product_type":"c1","uid":1091684,"ip_address":"","ucode":"836E6CDB1A56BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg","comment_is_top":false,"comment_ctime":1539216362,"is_pvip":false,"replies":[{"id":"11663","content":"嗯，看的很仔细，是要从cache读取数据的，只不过用这一个箭头表示了，应该加个说明会更好","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539494233,"ip_address":"","comment_id":31476,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14424118250","product_id":100017501,"comment_content":"老师好，我觉得图1有个地方有问题，秒杀详情系统需要从cache中读取缓存数据，那么是不是缺少一个从读cache到秒杀详情系统的箭头→？","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426359,"discussion_content":"嗯，看的很仔细，是要从cache读取数据的，只不过用这一个箭头表示了，应该加个说明会更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539494233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29589,"user_name":"九號","can_delete":false,"product_type":"c1","uid":1259408,"ip_address":"","ucode":"02AA27926653CE","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/90/48ff56fe.jpg","comment_is_top":false,"comment_ctime":1538448498,"is_pvip":false,"replies":[{"id":"10657","content":"一般都是存商品的静态数据，如商品的描述信息这些","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538474924,"ip_address":"","comment_id":29589,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14423350386","product_id":100017501,"comment_content":"localCache存的是什么样的数据？","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425666,"discussion_content":"一般都是存商品的静态数据，如商品的描述信息这些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538474924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29392,"user_name":"樊亚楠","can_delete":false,"product_type":"c1","uid":1226035,"ip_address":"","ucode":"F894B15CADAEB8","user_header":"https://static001.geekbang.org/account/avatar/00/12/b5/33/9220b644.jpg","comment_is_top":false,"comment_ctime":1538362244,"is_pvip":false,"replies":[{"id":"12245","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540098106,"ip_address":"","comment_id":29392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14423264132","product_id":100017501,"comment_content":"虽然还没看，但是很期待","like_count":3,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425577,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540098106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41163,"user_name":"火腿","can_delete":false,"product_type":"c1","uid":1308116,"ip_address":"","ucode":"40F17DBC18F5D5","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/d4/5a0a2f8d.jpg","comment_is_top":false,"comment_ctime":1542748074,"is_pvip":false,"replies":[{"id":"16244","content":"服务端的","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1543723670,"ip_address":"","comment_id":41163,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10132682666","product_id":100017501,"comment_content":"&quot;最关键的详情和交易系统都增加了本地缓存&quot;, 这里的本地缓存是指保存在用户浏览器的缓存还是服务器端的缓存? ","like_count":2,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429718,"discussion_content":"服务端的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543723670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29892,"user_name":"Plantegg","can_delete":false,"product_type":"c1","uid":1140931,"ip_address":"","ucode":"4C2B78D41C7820","user_header":"https://static001.geekbang.org/account/avatar/00/11/68/c3/8e1a8dbf.jpg","comment_is_top":false,"comment_ctime":1538582014,"is_pvip":false,"replies":[{"id":"10759","content":"实践还是要大家自己去尝试，本课程还是主要给大家提供一些思路，这些思路其实也是实践中总结出来的<br><br>另外秒杀系统的设计也不都是一个模子能够套出来的，他需要根据不同的场景来设计，就像我文章里介绍的，不同流量对应不同的架构可以简单也可以很复杂<br>所以更多的想给大家传递在不同的场景下应该如何进行取舍思路","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538618681,"ip_address":"","comment_id":29892,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10128516606","product_id":100017501,"comment_content":"还是偏理论性概念性的介绍，我想大家更多是希望可以看到可以复制的具体操作，能扛住了自然能升华到这下理论，我们缺的是具体可以复制的落地套路","like_count":2,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425762,"discussion_content":"实践还是要大家自己去尝试，本课程还是主要给大家提供一些思路，这些思路其实也是实践中总结出来的\n\n另外秒杀系统的设计也不都是一个模子能够套出来的，他需要根据不同的场景来设计，就像我文章里介绍的，不同流量对应不同的架构可以简单也可以很复杂\n所以更多的想给大家传递在不同的场景下应该如何进行取舍思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538618681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028943,"avatar":"","nickname":"Geek9625","note":"","ucode":"8110B0DE0432E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590864,"discussion_content":"流量决定了架构，否则，直接套用容易杀鸡用牛刀的尴尬场景","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666142025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29301,"user_name":"G小调","can_delete":false,"product_type":"c1","uid":1145529,"ip_address":"","ucode":"8F3D50E2C1A559","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/b9/c3d3a92f.jpg","comment_is_top":false,"comment_ctime":1538340163,"is_pvip":true,"replies":[{"id":"12249","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540098163,"ip_address":"","comment_id":29301,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10128274755","product_id":100017501,"comment_content":"很赞 给自己订个目标 看完课程后 也能设计一个好的秒杀系统","like_count":2,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425545,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540098163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289993,"user_name":"xmr","can_delete":false,"product_type":"c1","uid":1009622,"ip_address":"","ucode":"1BBF165F91F10B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg","comment_is_top":false,"comment_ctime":1619312105,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5914279401","product_id":100017501,"comment_content":"4少1多:<br>少数据<br>少请求<br>少路径<br>少依赖<br>多点","like_count":1},{"had_liked":false,"id":160400,"user_name":"我是小妖怪🇨🇳","can_delete":false,"product_type":"c1","uid":1758660,"ip_address":"","ucode":"A5381FA2D2C713","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d5/c4/62b2cd5a.jpg","comment_is_top":false,"comment_ctime":1575945059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5870912355","product_id":100017501,"comment_content":"一种是状态单点或者叫数据单点，不是很明白你说的意思，能不能有资料或者白话一点","like_count":1},{"had_liked":false,"id":149338,"user_name":"星一","can_delete":false,"product_type":"c1","uid":1103829,"ip_address":"","ucode":"EF550131FAE1BF","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/d5/6fbf1070.jpg","comment_is_top":false,"comment_ctime":1573197029,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5868164325","product_id":100017501,"comment_content":"老师您好，图中的读数据cache组件是指类似redis的这种缓存组件吗，还有访问读数据cache之前的多种条件校验指的是什么","like_count":1},{"had_liked":false,"id":113457,"user_name":"杨晓维","can_delete":false,"product_type":"c1","uid":1434854,"ip_address":"","ucode":"4B657DD4A1E2C4","user_header":"https://static001.geekbang.org/account/avatar/00/15/e4/e6/5795b1aa.jpg","comment_is_top":false,"comment_ctime":1563017518,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5857984814","product_id":100017501,"comment_content":"为什么10w级别的是读数据的困难？","like_count":1,"discussions":[{"author":{"id":2582372,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/sTmCOXh19off3uvUDIsDic4SYJGulgl1v6o3R4E32OZCkZAVzZw751jg9Tya8jLicxKzQWHC4Bu6o08J55YJib9oQ/132","nickname":"wsyzwddsg111","note":"","ucode":"7C59E81ECFF8AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372563,"discussion_content":"每秒10w读，数据库就会有压力了啊，而且每个请求不一定读一行数据，可能三四个表都要读，然后组装数据返回，如果这样那就是每秒30-40w的读","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620376392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1584786,"avatar":"https://static001.geekbang.org/account/avatar/00/18/2e/92/e1c38ca6.jpg","nickname":"KamTo  Hung","note":"","ucode":"00D5A6479DB784","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2582372,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/sTmCOXh19off3uvUDIsDic4SYJGulgl1v6o3R4E32OZCkZAVzZw751jg9Tya8jLicxKzQWHC4Bu6o08J55YJib9oQ/132","nickname":"wsyzwddsg111","note":"","ucode":"7C59E81ECFF8AB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374732,"discussion_content":"10w条···单库是顶不住的，10w级别读数据基本等于redis最高支持10wQPS吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621330286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372563,"ip_address":""},"score":374732,"extra":""}]},{"author":{"id":1198046,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/de/7b923db2.jpg","nickname":"曦","note":"","ucode":"AFB48B6C606EB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319271,"discussion_content":"我也想问下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603976726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79484,"user_name":"Fine","can_delete":false,"product_type":"c1","uid":1474857,"ip_address":"","ucode":"125270FDD41FDB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/YxDsehVIaqpebiaUXWXh2NFUBI3mhrNAZSzH2aiaJGFCFclgYNX7icqeV7E6WcmobZ5mSnoW1IQ2GffNWibH6cv6icw/132","comment_is_top":false,"comment_ctime":1553495441,"is_pvip":false,"replies":[{"id":"30088","content":"分布式部署如果每个节点都是无状态的，否则也可能有单点的","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1554532415,"ip_address":"","comment_id":79484,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848462737","product_id":100017501,"comment_content":"不要单点，可以理解成要做分布式部署吗","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444512,"discussion_content":"分布式部署如果每个节点都是无状态的，否则也可能有单点的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554532415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42876,"user_name":"与你为邻","can_delete":false,"product_type":"c1","uid":1266803,"ip_address":"","ucode":"19D82053B1915E","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/73/4c3179ab.jpg","comment_is_top":false,"comment_ctime":1543069557,"is_pvip":false,"replies":[{"id":"16248","content":"这个问题要具体分析，如果加锁可以简化系统的设计，但会影响并发度。不加锁系统设计会比较复杂，也有超卖的风险。还是要根据自己的场景来选择","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1543723974,"ip_address":"","comment_id":42876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838036853","product_id":100017501,"comment_content":"大佬好，库存要不要加锁","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430225,"discussion_content":"这个问题要具体分析，如果加锁可以简化系统的设计，但会影响并发度。不加锁系统设计会比较复杂，也有超卖的风险。还是要根据自己的场景来选择","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543723974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38183,"user_name":"无尘","can_delete":false,"product_type":"c1","uid":1298401,"ip_address":"","ucode":"0DDE50A1F94807","user_header":"https://static001.geekbang.org/account/avatar/00/13/cf/e1/adacde45.jpg","comment_is_top":false,"comment_ctime":1541984094,"is_pvip":false,"replies":[{"id":"14456","content":"当然可以支持了，只要有需求，没有理由拒绝啊","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542528721,"ip_address":"","comment_id":38183,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5836951390","product_id":100017501,"comment_content":"老师这个秒杀系统，支持多种库存扣减或者回补策略吗？例如订单超时回补，库存预扣，支付或者拍下等扣减时机的不同处理策略","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428633,"discussion_content":"当然可以支持了，只要有需求，没有理由拒绝啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542528721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35708,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1540773079,"is_pvip":false,"replies":[{"id":"13020","content":"商品页面并不是所有数据都是静态数据，他还有动态的部分，所以最终还需要有结合的地方","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1541240699,"ip_address":"","comment_id":35708,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5835740375","product_id":100017501,"comment_content":"老师你好，商品页面直接生成静态页面会不会效果更好？这样还省去了从本地缓存读取商品信息，构建页面的时间，还请老师指教！","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427639,"discussion_content":"商品页面并不是所有数据都是静态数据，他还有动态的部分，所以最终还需要有结合的地方","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541240699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31477,"user_name":"王维","can_delete":false,"product_type":"c1","uid":1091684,"ip_address":"","ucode":"836E6CDB1A56BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg","comment_is_top":false,"comment_ctime":1539216554,"is_pvip":false,"replies":[{"id":"11662","content":"图1有三个箭头没标<br>商品、库存系统对应的两个箭头分别是表示从这个系统读取商品和库存数据<br>另外一个指向支付系统的箭头就是调用支付接口付款了","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539494084,"ip_address":"","comment_id":31477,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5834183850","product_id":100017501,"comment_content":"而且个人觉得，您在绘制图1时，没有注意区别好箭头的意义，有的箭头表示数据流的走向，有的却是表示调用其他的系统，建议在有箭头的地方标注一下要表示的内容，不然我们读者很容易费解，读了您文章也是白读","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426360,"discussion_content":"图1有三个箭头没标\n商品、库存系统对应的两个箭头分别是表示从这个系统读取商品和库存数据\n另外一个指向支付系统的箭头就是调用支付接口付款了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539494084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31083,"user_name":"mike","can_delete":false,"product_type":"c1","uid":1109306,"ip_address":"","ucode":"FF8EC7347CAC29","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/3a/e61ba233.jpg","comment_is_top":false,"comment_ctime":1539084582,"is_pvip":false,"replies":[{"id":"11669","content":"降级后面会有介绍","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539495315,"ip_address":"","comment_id":31083,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5834051878","product_id":100017501,"comment_content":"如何做到降级呢","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426221,"discussion_content":"降级后面会有介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539495315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31068,"user_name":"肖建一","can_delete":false,"product_type":"c1","uid":1133414,"ip_address":"","ucode":"E3413BE9EF2D7E","user_header":"https://static001.geekbang.org/account/avatar/00/11/4b/66/71b5bcff.jpg","comment_is_top":false,"comment_ctime":1539079586,"is_pvip":false,"replies":[{"id":"11185","content":"这个平衡只能你自己根据当前的场景来安排，你要问我如何平衡要给我一个具体的实际场景才能分析","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539084261,"ip_address":"","comment_id":31068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5834046882","product_id":100017501,"comment_content":"老师，你好！<br>实际业务场景设计的时候，如何平衡这五大原则。比如依赖要尽量少，比如涉及到支付第三方系统的时候，如何做到商家后台订单模块、库存模块、第三方交易模块之间的依赖？","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426212,"discussion_content":"这个平衡只能你自己根据当前的场景来安排，你要问我如何平衡要给我一个具体的实际场景才能分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539084261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29518,"user_name":"一首歌一个故事。","can_delete":false,"product_type":"c1","uid":1259767,"ip_address":"","ucode":"184435256D5DCB","user_header":"https://static001.geekbang.org/account/avatar/00/13/38/f7/0ee3b6f9.jpg","comment_is_top":false,"comment_ctime":1538401819,"is_pvip":false,"replies":[{"id":"11685","content":"😊","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497040,"ip_address":"","comment_id":29518,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5833369115","product_id":100017501,"comment_content":"刚注册，就买了这个，因为这是我正好需要的。期待后面几个章节。","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425649,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29390,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1538362117,"is_pvip":false,"replies":[{"id":"10571","content":"虚线表示不是在主流程上的同步操作","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538385667,"ip_address":"","comment_id":29390,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5833329413","product_id":100017501,"comment_content":"请问实线剪头→表示什么含义呢？还有虚拟剪头，在迁移的虚拟，有表示什么含义呢？","like_count":1,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425576,"discussion_content":"虚线表示不是在主流程上的同步操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538385667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29297,"user_name":"八百","can_delete":false,"product_type":"c1","uid":1253530,"ip_address":"","ucode":"79F1F79ADF5A00","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/9a/3b1c65fd.jpg","comment_is_top":false,"comment_ctime":1538331070,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5833298366","product_id":100017501,"comment_content":"🙄果然十一凌晨","like_count":1},{"had_liked":false,"id":29286,"user_name":"莫笑","can_delete":false,"product_type":"c1","uid":1211821,"ip_address":"","ucode":"EED4760C598430","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/ad/d9148d3e.jpg","comment_is_top":false,"comment_ctime":1538325249,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5833292545","product_id":100017501,"comment_content":"hhh 第一时间拜读","like_count":1},{"had_liked":false,"id":354532,"user_name":"MClink","can_delete":false,"product_type":"c1","uid":1435733,"ip_address":"广东","ucode":"F479190923355C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/55/92f82281.jpg","comment_is_top":false,"comment_ctime":1660490637,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660490637","product_id":100017501,"comment_content":"架构的升级往往会提高的系统的复杂性以及维护成本","like_count":0},{"had_liked":false,"id":308265,"user_name":"北极的大企鹅","can_delete":false,"product_type":"c1","uid":1045577,"ip_address":"","ucode":"8935346D08E109","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/49/2add4f6b.jpg","comment_is_top":false,"comment_ctime":1629500313,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629500313","product_id":100017501,"comment_content":"讲得挺好的","like_count":0},{"had_liked":false,"id":280880,"user_name":"耶马","can_delete":false,"product_type":"c1","uid":2288362,"ip_address":"","ucode":"3A3CF67B016CDB","user_header":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","comment_is_top":false,"comment_ctime":1614434856,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614434856","product_id":100017501,"comment_content":"单点系统  <br>名词解释:  不是大家理解的单点登录或者jwt那种来实现登录或者sessionkey的校验<br>分为:  有状态和无状态<br>有状态服务的单点系统:可以理解和数据 或者 Redis一样 是 主从关系(master + slave) 应用层正常是  在加zk进行监听心跳来实现的,这样保证这个应用的高可用<br>无状态:很简单,也是很容易的 横向扩展,但是问题也容易暴露一挂皆挂,这个模块就挂了","like_count":0},{"had_liked":false,"id":264152,"user_name":"几点了","can_delete":false,"product_type":"c1","uid":1029537,"ip_address":"","ucode":"3F690A93A352A7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/a1/7706597c.jpg","comment_is_top":false,"comment_ctime":1606363267,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606363267","product_id":100017501,"comment_content":"今日笔记：<br>4要：<br>（1）访问路径要尽量短，端到端的访问中间节点要尽量少，每多经过一个节点，就要会新增加失败的风险。<br>（2）访问的数据要尽量少，用户上传或请求的数据要尽量少，数据量大则需要更多的网络上传时间。<br>（3）依赖要尽量少，即完成一次访问，依赖的服务尽量少。<br>（4）请求数要尽量少。<br>1不要：<br>不要有单点系统，单点系统可靠性不足","like_count":0},{"had_liked":false,"id":262662,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1605796791,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1605796791","product_id":100017501,"comment_content":"秒杀就是在同一个时刻有大量的请求争抢购买同一个商品并完成交易的过程。<br><br>秒杀系统的架构原则：数据要尽量少，请求数要尽量少，路径要尽量短，依赖要尽量少，不要有单点。<br><br>花了不少时间看留言，其中确实有不少是我之前读正文的时候没有注意到的事情，比如图2 中的库存热点库，以及两幅图中的箭头。<br><br>有一个好奇，为什么从业务上不把秒杀改为抽奖？为什么要秒杀？为了吸引流量么？那么抽奖也可以。","like_count":0},{"had_liked":false,"id":261484,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1605353307,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605353307","product_id":100017501,"comment_content":"数据尽量少，请求数尽量少，路径尽量短，依赖尽量少。 核心 是 网络和cpu两个方向上的优化。<br>不要单点服务， 是保证高可用，","like_count":0},{"had_liked":false,"id":259361,"user_name":"欧阳俊","can_delete":false,"product_type":"c1","uid":2085307,"ip_address":"","ucode":"62F06565C333F7","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d1/bb/52d9afcb.jpg","comment_is_top":false,"comment_ctime":1604713116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604713116","product_id":100017501,"comment_content":"设计选择四要一不要原则<br>数据要少<br>请求要少<br>路径要少<br>依赖少<br><br>不要单点","like_count":0},{"had_liked":false,"id":256343,"user_name":"liu","can_delete":false,"product_type":"c1","uid":1914817,"ip_address":"","ucode":"51F12E4AD09700","user_header":"https://static001.geekbang.org/account/avatar/00/1d/37/c1/280c238a.jpg","comment_is_top":false,"comment_ctime":1603603495,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603603495","product_id":100017501,"comment_content":"秒杀系统设计的几个原则：数据要尽量少、请求数要尽量少、路径要尽量短、依赖要尽量少，以及不要有单点。","like_count":0},{"had_liked":false,"id":247495,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1599725339,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599725339","product_id":100017501,"comment_content":"老师，你好，在讲解系统改造的架构1后，后面又说了一个结论“架构仍然支持不了超过 100w&#47;s 的请求量”，关键是这个结论是怎么推导出来的？或者说是如何分析出来的？我们更想关注的是为什么？掌握一个推导的过程","like_count":0},{"had_liked":false,"id":243995,"user_name":"leo","can_delete":false,"product_type":"c1","uid":1073657,"ip_address":"","ucode":"614A2F77A6B553","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1mQHJjAyFjypbiaheQ9hDWRoictrVn2VggIZiaPLm50UiatHu9NqExMicScs9f7zYicbTQPliatTT18hr4csibRh4ARYbA/132","comment_is_top":false,"comment_ctime":1598347635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598347635","product_id":100017501,"comment_content":"有什么方法或者工具可以帮助分析系统的QPS吗","like_count":0},{"had_liked":false,"id":242990,"user_name":"编程界的小学生","can_delete":false,"product_type":"c1","uid":1593289,"ip_address":"","ucode":"4A5BE9A5E877FA","user_header":"https://static001.geekbang.org/account/avatar/00/18/4f/c9/9f51fd27.jpg","comment_is_top":false,"comment_ctime":1597912627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597912627","product_id":100017501,"comment_content":"尽量非必须。 比如尽量少的跨过多的服务，但是微服务热火朝天，不跨几个是不可能的，所以尽量非必须很经典。","like_count":0},{"had_liked":false,"id":240464,"user_name":"Dawn","can_delete":false,"product_type":"c1","uid":1486601,"ip_address":"","ucode":"8764B8812E5FF8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL2dAokNdibVZvaBwpQ8ZJ9DDZtAoIKvW32YpdK499WpjpmJiakLCxvn5fX5MNIlehiaibRX4IgSuwckw/132","comment_is_top":false,"comment_ctime":1596939823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596939823","product_id":100017501,"comment_content":"请问在服务端对秒杀商品进行本地缓存，这里的对秒杀商品进行本地缓存是缓存商品的详情吗，比如sku等，库存是有状态的数据，应该不能放到本地缓存吧。","like_count":0},{"had_liked":false,"id":224255,"user_name":"td901105","can_delete":false,"product_type":"c1","uid":1348830,"ip_address":"","ucode":"32D42A4F36FA02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","comment_is_top":false,"comment_ctime":1591325193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591325193","product_id":100017501,"comment_content":"老师，有一个问题。对于本地缓存预热的情况，是用类似databus组件监听数据库，在插入秒杀商品信息和库存信息时产生一条消息，然后由秒杀系统进行数据加载吗？还有就是商品信息和库存信息是一起加载的吗？","like_count":0},{"had_liked":false,"id":192074,"user_name":"Mango","can_delete":false,"product_type":"c1","uid":1734886,"ip_address":"","ucode":"EC2D20BD322E22","user_header":"","comment_is_top":false,"comment_ctime":1584836853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584836853","product_id":100017501,"comment_content":"在极端洪峰下对性能的要求很高","like_count":0},{"had_liked":false,"id":184651,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1583377586,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1583377586","product_id":100017501,"comment_content":"老师，我真不是杠，数据要少和请求数据要少，前者不是包含后者吗？这两个原则不能合并为一个吗？？？","like_count":0,"discussions":[{"author":{"id":1252504,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1c/98/ef64b0a4.jpg","nickname":"钟学瑜","note":"","ucode":"84E034EF583117","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197984,"discussion_content":"数据少不一定请求少呀，如果重复请求呢","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1583460244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136657,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1569488161,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569488161","product_id":100017501,"comment_content":"刚刚才在极客时间发现这么好的课程，感谢老师的分享，对于上面的内容有几个疑问，希望老师能解答一下：<br>1.对于多个js文件加载，合并成一个传给后端组件去解析，这个不是无形中也增加了服务端的成本吗？为什么减少必须要的http请求带来的损耗，这么做的优势是什么吗？不是很理解<br>2.对于用户操作路径短的这个概念，现在的一些大型系统内部逻辑都非常复杂，所以才有了一些拆分服务来进行逻辑的解耦的解决方案，但是这样做又有了新的问题就是依赖关系，链路追踪也是个麻烦事，这样的两种解决方案的平衡点该如何取舍？老师能否说下自己的理解<br>平时碰到这样的场景，最基本的思路就是，尽量把热点数据提前缓存起来，不让请求打到数据库引起雪崩，另外一个思路就是尽量让抢的请求能够排队来降低并发请求打来的影响，之前有过一次这样的经历，就是把秒杀的用户分成两部分，一部分归类为肯定抢不到的用户，另一部分是走抢逻辑的用户，在配合redis来保证秒杀的商品库存，不过这样的做法个人感觉是对业务有损的，如果页面上还要显示当前商品的秒杀进度的话，这个方案就行不通了。","like_count":0},{"had_liked":false,"id":115823,"user_name":"张浩","can_delete":false,"product_type":"c1","uid":1588393,"ip_address":"","ucode":"1A5A6BECBF70B6","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/a9/25e8b2f2.jpg","comment_is_top":false,"comment_ctime":1563755177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563755177","product_id":100017501,"comment_content":"请老师解释一个我的疑惑：您在文章里面说道，把css和js文件放在一起请求（url中）和返回，服务器上有一个组件去解析这个url，然后动态把这些文件合并起来一起返回。这句话的意思是：单个的css&#47;js文件，我单个返回的，有多少个文件服务器就会返回多少次（响应次数）吗？单个文件浏览器接收到后是怎么去放置这些文件的地址的呢？多个文件一起返回时，浏览器又是怎么解析并安防这些文件的地址的呢？请老师不吝赐教<br><br>","like_count":0},{"had_liked":false,"id":111321,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1562545454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562545454","product_id":100017501,"comment_content":"老师您好，文中提到这个架构可以支撑100w的请求量，另一个架构无法支持，能看出差异，但不知道具体是如何估算出来的？还请老师给些指点！","like_count":0},{"had_liked":false,"id":100800,"user_name":"ds","can_delete":false,"product_type":"c1","uid":1564879,"ip_address":"","ucode":"615991339A1662","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/9dTx3AVia8Lbx2iaP3dibFvo8aI2ico21jGGYibKibxxOFY0ogZrfgVhYCfC1VAMys5go2s4WZmf4uH5YdUIUpaRUqgw/132","comment_is_top":false,"comment_ctime":1559641513,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559641513","product_id":100017501,"comment_content":"如果有工程代码辅助讲解，就完美了，可以卖到79。只讲理论，太空洞。","like_count":0},{"had_liked":false,"id":84235,"user_name":"街北","can_delete":false,"product_type":"c1","uid":1428932,"ip_address":"","ucode":"A939324AC5A93B","user_header":"https://static001.geekbang.org/account/avatar/00/15/cd/c4/406ab0fb.jpg","comment_is_top":false,"comment_ctime":1554810953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554810953","product_id":100017501,"comment_content":"静态页面放cdn，读取数据走缓存，写数据异步","like_count":0},{"had_liked":false,"id":83382,"user_name":"calvin sheng","can_delete":false,"product_type":"c1","uid":1372119,"ip_address":"","ucode":"D992BDA50DACC7","user_header":"https://static001.geekbang.org/account/avatar/00/14/ef/d7/2f700986.jpg","comment_is_top":false,"comment_ctime":1554551753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554551753","product_id":100017501,"comment_content":"乐观锁思想","like_count":0},{"had_liked":false,"id":81279,"user_name":"威猛小茂然","can_delete":false,"product_type":"c1","uid":1196929,"ip_address":"","ucode":"E4E9B1ED9021C0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTA5BZT4zapBbpHctcDGs2M9NFIkwEWXoicUwBsmCZSRlNzGI7NYXicZAOibLKVyE2u7ib8PuibXibel9g/132","comment_is_top":false,"comment_ctime":1553847970,"is_pvip":false,"replies":[{"id":"30086","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1554531931,"ip_address":"","comment_id":81279,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553847970","product_id":100017501,"comment_content":"嗯，挺不错的","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445137,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554531931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77903,"user_name":"王锦","can_delete":false,"product_type":"c1","uid":1383603,"ip_address":"","ucode":"41E7462D68D9D8","user_header":"https://static001.geekbang.org/account/avatar/00/15/1c/b3/03a2591f.jpg","comment_is_top":false,"comment_ctime":1553039394,"is_pvip":false,"replies":[{"id":"30091","content":"组件是阿里版Nginx的一个插件，你可以去阿里代码上去找找","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1554532634,"ip_address":"","comment_id":77903,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553039394","product_id":100017501,"comment_content":"在 URL 中用逗号隔开，服务端会有一个组件解析这个 URL，这个组件是什么，可以介绍下么<br><br>另外，JS合并下发无所谓，但是css合并下发的话里面引用到的图片地址如果是相对地址会不会有问题，而且图片是否也要考虑自动合并呢？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443890,"discussion_content":"组件是阿里版Nginx的一个插件，你可以去阿里代码上去找找","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554532634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77173,"user_name":"威猛小茂然","can_delete":false,"product_type":"c1","uid":1196929,"ip_address":"","ucode":"E4E9B1ED9021C0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTA5BZT4zapBbpHctcDGs2M9NFIkwEWXoicUwBsmCZSRlNzGI7NYXicZAOibLKVyE2u7ib8PuibXibel9g/132","comment_is_top":false,"comment_ctime":1552875942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552875942","product_id":100017501,"comment_content":"嗯，学习到了，很好很好","like_count":0},{"had_liked":false,"id":74656,"user_name":"扭断翅膀的猪","can_delete":false,"product_type":"c1","uid":1251238,"ip_address":"","ucode":"E94AE44B950C91","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/a6/fae3dd91.jpg","comment_is_top":false,"comment_ctime":1552273986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552273986","product_id":100017501,"comment_content":"..... 入门东东。现在最基础的后台服务也完全动静分享，也不会有减少静态文件传输对真正的动态后台服务造成影响。","like_count":0},{"had_liked":false,"id":74524,"user_name":"灯火可亲","can_delete":false,"product_type":"c1","uid":1241170,"ip_address":"","ucode":"BBC0FBD8BD4FA4","user_header":"https://static001.geekbang.org/account/avatar/00/12/f0/52/2afffb1f.jpg","comment_is_top":false,"comment_ctime":1552230354,"is_pvip":false,"replies":[{"id":"30097","content":"缓存没有必要极致追求数据的准确性，只要保证最终一致性。缓存本身为了减少数据库的压力，后面的章节也介绍了数据的准确性和一致性由数据库来保证。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1554533153,"ip_address":"","comment_id":74524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552230354","product_id":100017501,"comment_content":"用户从缓存中读取数据 如果缓存数据一旦失效 就有大量请求到数据库服务器 也许会造成服务器宕机的情况 请问这种场景怎么解决 而且秒杀对于数据到的及时性要求极高 缓存有效时间怎么设置能达到一个平衡了","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442589,"discussion_content":"缓存没有必要极致追求数据的准确性，只要保证最终一致性。缓存本身为了减少数据库的压力，后面的章节也介绍了数据的准确性和一致性由数据库来保证。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554533153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68207,"user_name":"世间哪有坦途","can_delete":false,"product_type":"c1","uid":1421195,"ip_address":"","ucode":"5538E577FBB1E7","user_header":"https://static001.geekbang.org/account/avatar/00/15/af/8b/72b10414.jpg","comment_is_top":false,"comment_ctime":1550457554,"is_pvip":false,"replies":[{"id":"26119","content":"就是随手举个例子，这个不是重点😁","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1551525227,"ip_address":"","comment_id":68207,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550457554","product_id":100017501,"comment_content":"module-jhs，大神，这个jhs 是认真的么 -.-!!","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439567,"discussion_content":"就是随手举个例子，这个不是重点😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551525227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66100,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1549877270,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1549877270","product_id":100017501,"comment_content":"四要一不要 总结的","like_count":0},{"had_liked":false,"id":58352,"user_name":"Mk","can_delete":false,"product_type":"c1","uid":1111162,"ip_address":"","ucode":"47B5A800BA8065","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/7a/c24cc939.jpg","comment_is_top":false,"comment_ctime":1547042824,"is_pvip":false,"replies":[{"id":"21999","content":"mq也可以，当数据有更新时再主动更新过来，但是就像你说的如果频繁的更新会影响性能，所以缓存的数据不应该频繁的更新","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1547981413,"ip_address":"","comment_id":58352,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547042824","product_id":100017501,"comment_content":"老师你好 针对 上面小喵喵回复 结果 启动加载这个我理解 但是用mq 可以吗 定时3秒 当系统已经起来了如果数据库有改动 这样不合理吧 那么大并发量一旦更新 对性能会有影响吧 不知道我说的对不","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436024,"discussion_content":"mq也可以，当数据有更新时再主动更新过来，但是就像你说的如果频繁的更新会影响性能，所以缓存的数据不应该频繁的更新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547981413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005066,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/0a/b551e430.jpg","nickname":"qx","note":"","ucode":"240CFCE8E9EB07","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51470,"discussion_content":"库存数据不就是频繁更新吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573879533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54101,"user_name":"Tiger","can_delete":false,"product_type":"c1","uid":1284857,"ip_address":"","ucode":"6F9CAB3C29BAD7","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/f9/6d55ee0b.jpg","comment_is_top":false,"comment_ctime":1545793999,"is_pvip":false,"replies":[{"id":"19620","content":"热点库的作用是保存热点数据；当热点数据已经影响到正常数据库的稳定时就要考虑将热点数据迁移出来了；","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1545821533,"ip_address":"","comment_id":54101,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545793999","product_id":100017501,"comment_content":"请问老师，热点库存库的作用是什么？怎么样的场景才会考虑将数据从库存库迁移到热点库？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434356,"discussion_content":"热点库的作用是保存热点数据；当热点数据已经影响到正常数据库的稳定时就要考虑将热点数据迁移出来了；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545821533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53387,"user_name":"寻觅","can_delete":false,"product_type":"c1","uid":1080624,"ip_address":"","ucode":"97BA25595E2012","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/30/cfcd3e03.jpg","comment_is_top":false,"comment_ctime":1545636444,"is_pvip":false,"replies":[{"id":"19629","content":"我的两本书中有更详细的介绍，啊哈哈","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1545822251,"ip_address":"","comment_id":53387,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545636444","product_id":100017501,"comment_content":"能不能给一些你认为的关键知识点在文章最后加一些对这些点的外链。这样可以更详细，当然更具系统性。 极客时间也可以考虑这样的一个功能，整个当前专栏共用这些链接。<br><br>😂 我也伸手跟大神要一下，谢谢！","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434122,"discussion_content":"我的两本书中有更详细的介绍，啊哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545822251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49570,"user_name":"leepong","can_delete":false,"product_type":"c1","uid":1347655,"ip_address":"","ucode":"17114B48C26FFA","user_header":"https://static001.geekbang.org/account/avatar/00/14/90/47/c2c02a6e.jpg","comment_is_top":false,"comment_ctime":1544717918,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544717918","product_id":100017501,"comment_content":"前两篇，详读用了二十分钟，留言板看了一个小时左右，受益匪浅，非常感谢！","like_count":0},{"had_liked":false,"id":48452,"user_name":"亚斯兰特","can_delete":false,"product_type":"c1","uid":1342425,"ip_address":"","ucode":"05ABA0A35A0ACC","user_header":"https://static001.geekbang.org/account/avatar/00/14/7b/d9/c8163d63.jpg","comment_is_top":false,"comment_ctime":1544447162,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544447162","product_id":100017501,"comment_content":"架构是一门平衡的艺术，受教了V(^_^)V","like_count":0},{"had_liked":false,"id":48029,"user_name":"学无止境","can_delete":false,"product_type":"c1","uid":1029272,"ip_address":"","ucode":"632D9643604605","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/98/793e2aa5.jpg","comment_is_top":false,"comment_ctime":1544325917,"is_pvip":false,"replies":[{"id":"19659","content":"数据的更新可以参考一下最后的小节<br>静态资源合并目前还是采用ESI的方式来实现的<br>合并部署的实现可以参考我的《大型网站……》一书中有一章专门介绍","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1545826431,"ip_address":"","comment_id":48029,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544325917","product_id":100017501,"comment_content":"今天有空看了下几点原则总结很到位，受益了，但还有几个疑问：<br>1.在秒杀系统中缓存这块应该起了很大的作用，有没有整个缓存设计介绍，如公共的动态数据是否也缓存在用户端、web服务器、应用服务器端，这个数据更新如何控制？<br>2.提升用户体验，减少网络传输，性能指标如何定义，页面大小、请求数、请求内容大小、动态请求性能如何定义，前端设计可以分享下？<br>3.在web服务静态资源请求合大并发下，需消费大量资源，之前看到有你们开源组件，现在如何实现静态资源请求合并？<br>4.减少路径，把都个应用部署一个jvm中，资源争用有什么好的经验分享？<br><br>","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431994,"discussion_content":"数据的更新可以参考一下最后的小节\n静态资源合并目前还是采用ESI的方式来实现的\n合并部署的实现可以参考我的《大型网站……》一书中有一章专门介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545826431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48007,"user_name":"有渔@蔡","can_delete":false,"product_type":"c1","uid":1099829,"ip_address":"","ucode":"4AB669229892C8","user_header":"","comment_is_top":false,"comment_ctime":1544319604,"is_pvip":false,"replies":[{"id":"19647","content":"也是用这个hashmap：）","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1545825666,"ip_address":"","comment_id":48007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544319604","product_id":100017501,"comment_content":"老师，，localcache我是用concurrentHashMap实现的，你们是怎么做的呢？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431983,"discussion_content":"也是用这个hashmap：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545825666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43150,"user_name":"Kevin","can_delete":false,"product_type":"c1","uid":1103597,"ip_address":"","ucode":"3CA477F2DE7C7B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/ed/e518b5f2.jpg","comment_is_top":false,"comment_ctime":1543192524,"is_pvip":false,"replies":[{"id":"19654","content":"详细的可以再看一下我的两本书，里面有些引用链接，哈哈","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1545826001,"ip_address":"","comment_id":43150,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543192524","product_id":100017501,"comment_content":"能不能给一些你认为的关键知识点在文章最后加一些对这些点的外链。这样可以更详细，当然更具系统性。 极客时间也可以考虑这样的一个功能，整个当前专栏共用这些链接。<br><br>感谢，我也需要","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430309,"discussion_content":"详细的可以再看一下我的两本书，里面有些引用链接，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545826001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39234,"user_name":"阿豪","can_delete":false,"product_type":"c1","uid":1212157,"ip_address":"","ucode":"8E37AA47459581","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/fd/5d0b2681.jpg","comment_is_top":false,"comment_ctime":1542214325,"is_pvip":false,"replies":[{"id":"14441","content":"这个问题太大，没发回答😊","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542527185,"ip_address":"","comment_id":39234,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542214325","product_id":100017501,"comment_content":"老师，请问经常变的数据怎么缓存好？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428975,"discussion_content":"这个问题太大，没发回答😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542527185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38837,"user_name":"wupf","can_delete":false,"product_type":"c1","uid":1047524,"ip_address":"","ucode":"43C994B6ED6940","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/e4/661eadcf.jpg","comment_is_top":false,"comment_ctime":1542153758,"is_pvip":false,"replies":[{"id":"14444","content":"现在的负载均衡一般都是集群的，早期的f5硬件路由一般也都是两台","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542527351,"ip_address":"","comment_id":38837,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542153758","product_id":100017501,"comment_content":"秒杀系统不能有单点，但是负载均衡的设备或组件有可能是单点吧？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428825,"discussion_content":"现在的负载均衡一般都是集群的，早期的f5硬件路由一般也都是两台","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542527351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":38320,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1542021107,"is_pvip":false,"replies":[{"id":"14455","content":"希望大家带着这些原则再去看具体实际，会有不一样的视角😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542528648,"ip_address":"","comment_id":38320,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542021107","product_id":100017501,"comment_content":"设计秒杀系统的原则-尽量懒，在能实现功能的前提下越懒越好。<br>感觉稍微范范，没办法需要具体问题具体分析，不过典型场景可以细致一些。","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428671,"discussion_content":"希望大家带着这些原则再去看具体实际，会有不一样的视角😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542528648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37596,"user_name":"落叶飞逝的恋","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1541646660,"is_pvip":false,"replies":[{"id":"14460","content":"秒到了就付款，秒到了就说明创建了订单，付款失败再重新付款就好了","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542529097,"ip_address":"","comment_id":37596,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541646660","product_id":100017501,"comment_content":"秒杀详情系统与秒杀交易系统是怎么先后顺序连接的？是在秒杀活动结束后，详情系统再把秒到商品的人提交给秒杀交易系统？还是边秒杀边交易？如果秒杀详情已经抢到了，但是调用交易系统失败怎么办？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428414,"discussion_content":"秒到了就付款，秒到了就说明创建了订单，付款失败再重新付款就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542529097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37394,"user_name":"阿伦","can_delete":false,"product_type":"c1","uid":1285349,"ip_address":"","ucode":"D5D98B0BD746F2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLX3x2VhToib7pfibOH6OVlAyO5g1bZ2YT2N2OXRYINBtib30HiaxzaOURyJLib5vDE7r2VUjF4pR9CSyw/132","comment_is_top":false,"comment_ctime":1541568986,"is_pvip":true,"replies":[{"id":"14462","content":"Localcache中数据的一致性肯定不是太严格，否则得不偿失，保证最终一致性就行","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1542529258,"ip_address":"","comment_id":37394,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541568986","product_id":100017501,"comment_content":"君山好：动态数据，比如库存扣减应该需要操作共享缓存或者数据库吧，如果用localcache怎么保证一致性","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428322,"discussion_content":"Localcache中数据的一致性肯定不是太严格，否则得不偿失，保证最终一致性就行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542529258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35336,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1540519142,"is_pvip":false,"replies":[{"id":"12650","content":"你看后面的文章就知道了，热点库是为了隔离热点数据，迁移这些热点数据，是为了保护系统被这些热点请求拖垮<br><br>迁移一般采用异步的方式比较好，同步的风险较大<br><br>如果商品被迁移到单独的热点库的话，一般保证数据的一致性，只存在一份数据在热点库。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540720154,"ip_address":"","comment_id":35336,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1540519142","product_id":100017501,"comment_content":"老师，您好！<br>图 2 的“商品、库存”迁移到“库存热点库”的作用是啥？迁移什么数据，为什么要迁移？<br>这里的迁移是同步么？比如从“商品、库存”迁移数据 A 到“库存热点库”，迁移是不是表示数据 A 就不存在于“商品、库存”，而同步却却表示数据 A 都存在两台数据库？<br>谢谢老师！","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427517,"discussion_content":"你看后面的文章就知道了，热点库是为了隔离热点数据，迁移这些热点数据，是为了保护系统被这些热点请求拖垮\n\n迁移一般采用异步的方式比较好，同步的风险较大\n\n如果商品被迁移到单独的热点库的话，一般保证数据的一致性，只存在一份数据在热点库。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540720154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31864,"user_name":"wjwang","can_delete":false,"product_type":"c1","uid":1256256,"ip_address":"","ucode":"7D8EAD27A13529","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLOMsicefbvfIZ87bVrNUMKJLTqj8LlMEo46QnqoHrujAibjP30HtibZe1ZI3DZIZbs02abbdicOzwmEw/132","comment_is_top":false,"comment_ctime":1539314748,"is_pvip":false,"replies":[{"id":"11614","content":"一般专门的缓存系统都有内存保护机制，一般超过内存空间都会淘汰一部分数据，你说的溢出是不是出现软件bug了才会出现","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539419882,"ip_address":"","comment_id":31864,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539314748","product_id":100017501,"comment_content":"将大量的数据都放在缓存中，如何防止内存溢出了，内存溢出后的挽救方案怎么设计了","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426542,"discussion_content":"一般专门的缓存系统都有内存保护机制，一般超过内存空间都会淘汰一部分数据，你说的溢出是不是出现软件bug了才会出现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539419882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31116,"user_name":"LIN","can_delete":false,"product_type":"c1","uid":1151018,"ip_address":"","ucode":"73C146C3BA43E5","user_header":"","comment_is_top":false,"comment_ctime":1539094896,"is_pvip":false,"replies":[{"id":"11665","content":"单点就是一个状态值存储在一台机器上，这台机器挂了，这个状态就丢了，导致整个服务不可用。最常用的就是本机存储数据，而这个数据没有备份的情况<br><br>目前大部分系统都是集群了，即使是数据库，一般都是高可用的架构，例如MySQL、redis基本都有集群版了，所以只要不是我们自己存储一些数据，一般也很少会出现单点问题了。","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539494681,"ip_address":"","comment_id":31116,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539094896","product_id":100017501,"comment_content":"读了老师的文章收益颇多。<br>之前也有幸参与了支付营销系统的开发， 里面就有一些类似的秒杀场景。现在想来老师总结的一些方法其实在之前也用到了。如缓存，秒杀答题，集群部署，限流等。另外还有一些我们用到的方法，如多线程的改造，数据的异步更新等。<br>另外有个疑问就是，老师提到不要有单点，做到服务无状态化。老师能给一个具体点的例子么？我的理解是现在的服务基本都是集群部署，另外我们做的很多服务都要求具有幂等性。这一点，所以感觉有点迷糊。","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426237,"discussion_content":"单点就是一个状态值存储在一台机器上，这台机器挂了，这个状态就丢了，导致整个服务不可用。最常用的就是本机存储数据，而这个数据没有备份的情况\n\n目前大部分系统都是集群了，即使是数据库，一般都是高可用的架构，例如MySQL、redis基本都有集群版了，所以只要不是我们自己存储一些数据，一般也很少会出现单点问题了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539494681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31094,"user_name":"秋天","can_delete":false,"product_type":"c1","uid":1057056,"ip_address":"","ucode":"A7E1D953EF7E17","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg","comment_is_top":false,"comment_ctime":1539088222,"is_pvip":true,"replies":[{"id":"11668","content":"减库存也可以在缓存中完成，这个在后面也有介绍<br><br>秒杀当然要依赖交易系统","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539495289,"ip_address":"","comment_id":31094,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539088222","product_id":100017501,"comment_content":"这个缓存商品是不是减库存也是缓存减完，在一次更新到数据库？秒杀系统后面的交易系统是其依赖的系统吧图中所画？？？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426226,"discussion_content":"减库存也可以在缓存中完成，这个在后面也有介绍\n\n秒杀当然要依赖交易系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539495289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31062,"user_name":"王维","can_delete":false,"product_type":"c1","uid":1091684,"ip_address":"","ucode":"836E6CDB1A56BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg","comment_is_top":false,"comment_ctime":1539078707,"is_pvip":false,"replies":[{"id":"11201","content":"表示读商品和库存数据","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539086939,"ip_address":"","comment_id":31062,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539078707","product_id":100017501,"comment_content":"商品库存系统和秒杀详情系统的实线箭头是什么意思？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426207,"discussion_content":"表示读商品和库存数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539086939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30313,"user_name":"小火车","can_delete":false,"product_type":"c1","uid":1121879,"ip_address":"","ucode":"0843BE33B9F7B9","user_header":"https://static001.geekbang.org/account/avatar/00/11/1e/57/dc431a52.jpg","comment_is_top":false,"comment_ctime":1538789407,"is_pvip":false,"replies":[{"id":"10936","content":"库存不会放在localcache，localcache只放静态数据。<br>库存是放在独立的缓存系统里，如redis，库存是采用主动失效的方式来失效缓存","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538818391,"ip_address":"","comment_id":30313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538789407","product_id":100017501,"comment_content":"感觉描述的稍微有点不清晰，所以作者的意思是缓存中只是放的库存商品的描述信息，并没有库存数量这些需要实时更新的信息 对吗？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425938,"discussion_content":"库存不会放在localcache，localcache只放静态数据。\n库存是放在独立的缓存系统里，如redis，库存是采用主动失效的方式来失效缓存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538818391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30244,"user_name":"没主流","can_delete":false,"product_type":"c1","uid":1240379,"ip_address":"","ucode":"AE328C5A0AEB72","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/3b/e2b62803.jpg","comment_is_top":false,"comment_ctime":1538737518,"is_pvip":false,"replies":[{"id":"11696","content":"😉","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497565,"ip_address":"","comment_id":30244,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538737518","product_id":100017501,"comment_content":"好","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425912,"discussion_content":"😉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30169,"user_name":"平。凡与幸福","can_delete":false,"product_type":"c1","uid":1254566,"ip_address":"","ucode":"89F8C137EF0659","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/a6/d95f69a0.jpg","comment_is_top":false,"comment_ctime":1538711172,"is_pvip":false,"replies":[{"id":"10944","content":"包含这些，也包括商品中的静态数据","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538819665,"ip_address":"","comment_id":30169,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538711172","product_id":100017501,"comment_content":"您好，架构二中CDN中静态cache数据是指Js、css、图片这些？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425879,"discussion_content":"包含这些，也包括商品中的静态数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538819665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29870,"user_name":"衣申人","can_delete":false,"product_type":"c1","uid":1115777,"ip_address":"","ucode":"887FE9109B97DE","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/81/28418795.jpg","comment_is_top":false,"comment_ctime":1538574539,"is_pvip":false,"replies":[{"id":"10766","content":"这个内容再后面会介绍，你到时关注一下哈","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538619832,"ip_address":"","comment_id":29870,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538574539","product_id":100017501,"comment_content":"库存数是写热点而且往往是单点，这一块是秒杀系统吞吐量的关键，请问如何处理和优化呢？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425750,"discussion_content":"这个内容再后面会介绍，你到时关注一下哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538619832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29867,"user_name":"steven999","can_delete":false,"product_type":"c1","uid":1100274,"ip_address":"","ucode":"40EA668EE91D84","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epgIxW36uQWrWqBibKDmLicQovvnts9kQxb0tJY6s6JXibibRq2L0Aicicvd2Qatv2mqLjJRib5wBTpIyAsQ/132","comment_is_top":false,"comment_ctime":1538572654,"is_pvip":false,"replies":[{"id":"10769","content":"这个在减库存一章会有介绍，你到时关注下","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538620521,"ip_address":"","comment_id":29867,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538572654","product_id":100017501,"comment_content":"分布式系统扣除商品库存，如何保证数据一致性？分布式锁？库存应该在缓存和DB都有一份吧","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425748,"discussion_content":"这个在减库存一章会有介绍，你到时关注下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538620521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29511,"user_name":"超","can_delete":false,"product_type":"c1","uid":1100075,"ip_address":"","ucode":"0E4C60D9238851","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/hDFZJXfNCG9cIXaysJZEZ931YIdeyRWzUP1oxNCdBZUyjmWtMzM05GibKb8F04m235kCMz4fINK6Q6A9l3DRvvg/132","comment_is_top":false,"comment_ctime":1538400027,"is_pvip":false,"replies":[{"id":"11698","content":"主要是静态数据","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539497943,"ip_address":"","comment_id":29511,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538400027","product_id":100017501,"comment_content":"LocalCache里具体可以存放那些数据？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425648,"discussion_content":"主要是静态数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539497943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29444,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1538374916,"is_pvip":false,"replies":[{"id":"11702","content":"你这两个问题好大啊，可以分别再写两篇文章😉，这两个问题都是分布式场景下的通用问题，建议你专门看一下分布式相关的书籍","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1539498717,"ip_address":"","comment_id":29444,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538374916","product_id":100017501,"comment_content":"1.集群如何做到数据的同步？<br>2.请求如何做到平均分派到集群节点呢？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425609,"discussion_content":"你这两个问题好大啊，可以分别再写两篇文章😉，这两个问题都是分布式场景下的通用问题，建议你专门看一下分布式相关的书籍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539498717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29435,"user_name":"mangoliu","can_delete":false,"product_type":"c1","uid":1253634,"ip_address":"","ucode":"B065A045A806C8","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/02/a691a1d2.jpg","comment_is_top":false,"comment_ctime":1538371515,"is_pvip":false,"replies":[{"id":"10570","content":"减库存那章会介绍","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1538385612,"ip_address":"","comment_id":29435,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538371515","product_id":100017501,"comment_content":"减库存是在下单的时候就操作吗？不是支付的时候？","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425601,"discussion_content":"减库存那章会介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538385612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29362,"user_name":"okJohn","can_delete":false,"product_type":"c1","uid":1071413,"ip_address":"","ucode":"0E0A0CCF0EABE5","user_header":"https://static001.geekbang.org/account/avatar/00/10/59/35/b967e113.jpg","comment_is_top":false,"comment_ctime":1538358239,"is_pvip":false,"replies":[{"id":"12246","content":"😊","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540098113,"ip_address":"","comment_id":29362,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538358239","product_id":100017501,"comment_content":"回家的路上严重堵车，顺便把许神的文章读了","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425564,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540098113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29331,"user_name":"大老杨","can_delete":false,"product_type":"c1","uid":1114792,"ip_address":"","ucode":"51694DBB013715","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/a8/ff61bff2.jpg","comment_is_top":false,"comment_ctime":1538354847,"is_pvip":false,"replies":[{"id":"12247","content":"☺","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540098122,"ip_address":"","comment_id":29331,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538354847","product_id":100017501,"comment_content":"真的很准时","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425554,"discussion_content":"☺","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540098122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":29316,"user_name":"爱学习","can_delete":false,"product_type":"c1","uid":1182718,"ip_address":"","ucode":"9E5BDA4C8E95F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/fe/d738d7cf.jpg","comment_is_top":false,"comment_ctime":1538352132,"is_pvip":false,"replies":[{"id":"12248","content":"😊","user_name":"作者回复","user_name_real":"君山","uid":"1253339","ctime":1540098133,"ip_address":"","comment_id":29316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538352132","product_id":100017501,"comment_content":"4要1不要,赞👍","like_count":0,"discussions":[{"author":{"id":1253339,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1f/db/d7d863ed.jpg","nickname":"君山","note":"","ucode":"F8ACCB6FBFAFCD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425550,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540098133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}