{"id":216830,"title":"11 | ç©ºå€¼å¤„ç†ï¼šåˆ†ä¸æ¸…æ¥šçš„nullå’Œæ¼äººçš„ç©ºæŒ‡é’ˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘è¦å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼Œç©ºå€¼å¤„ç†ï¼šåˆ†ä¸æ¸…æ¥šçš„nullå’Œæ¼äººçš„ç©ºæŒ‡é’ˆã€‚</p><p>æœ‰ä¸€å¤©æˆ‘æ”¶åˆ°ä¸€æ¡çŸ­ä¿¡ï¼Œå†…å®¹æ˜¯â€œå°Šæ•¬çš„nullä½ å¥½ï¼ŒXXXâ€ã€‚å½“æ—¶æˆ‘å°±ç¬‘äº†ï¼Œè¿™æ˜¯ç¨‹åºå‘˜éƒ½èƒ½Getçš„ç¬‘ç‚¹ï¼Œç¨‹åºæ²¡æœ‰è·å–åˆ°æˆ‘çš„å§“åï¼Œç„¶åæŠŠç©ºæ ¼å¼åŒ–ä¸ºäº†nullã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯æ²¡å¤„ç†å¥½nullã€‚å“ªæ€•æŠŠnullæ›¿æ¢ä¸ºè´µå®¾ã€é¡¾å®¢ï¼Œä¹Ÿä¸ä¼šå¼•å‘è¿™æ ·çš„ç¬‘è¯ã€‚</p><p>ç¨‹åºä¸­çš„å˜é‡æ˜¯nullï¼Œå°±æ„å‘³ç€å®ƒæ²¡æœ‰å¼•ç”¨æŒ‡å‘æˆ–è€…è¯´æ²¡æœ‰æŒ‡é’ˆã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œä»»ä½•æ“ä½œï¼Œéƒ½å¿…ç„¶ä¼šå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œåœ¨Javaä¸­å°±æ˜¯NullPointerExceptionã€‚é‚£ä¹ˆï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸å®¹æ˜“åœ¨å“ªäº›æƒ…å†µä¸‹å‡ºç°ï¼Œåˆåº”è¯¥å¦‚ä½•ä¿®å¤å‘¢ï¼Ÿ</p><p>ç©ºæŒ‡é’ˆå¼‚å¸¸è™½ç„¶æ¼äººä½†å¥½åœ¨å®¹æ˜“å®šä½ï¼Œæ›´éº»çƒ¦çš„æ˜¯è¦å¼„æ¸…æ¥šnullçš„å«ä¹‰ã€‚æ¯”å¦‚ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯çš„ä¸€ä¸ªæ•°æ®æ˜¯nullï¼Œé‚£ä¹ˆå…¶æ„å›¾åˆ°åº•æ˜¯ç»™ä¸€ä¸ªç©ºå€¼ï¼Œè¿˜æ˜¯æ²¡æä¾›å€¼å‘¢ï¼Ÿå†æ¯”å¦‚ï¼Œæ•°æ®åº“ä¸­å­—æ®µçš„NULLå€¼ï¼Œæ˜¯å¦æœ‰ç‰¹æ®Šçš„å«ä¹‰å‘¢ï¼Œé’ˆå¯¹æ•°æ®åº“ä¸­çš„NULLå€¼ï¼Œå†™SQLéœ€è¦ç‰¹åˆ«æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬å¸¦ç€è¿™äº›é—®é¢˜å¼€å§‹nullçš„è¸©å‘ä¹‹æ—…å§ã€‚</p><h2>ä¿®å¤å’Œå®šä½æ¼äººçš„ç©ºæŒ‡é’ˆé—®é¢˜</h2><p><strong>NullPointerExceptionæ˜¯Javaä»£ç ä¸­æœ€å¸¸è§çš„å¼‚å¸¸ï¼Œæˆ‘å°†å…¶æœ€å¯èƒ½å‡ºç°çš„åœºæ™¯å½’ä¸ºä»¥ä¸‹5ç§</strong>ï¼š</p><!-- [[[read_end]]] --><ul>\n<li>å‚æ•°å€¼æ˜¯Integerç­‰åŒ…è£…ç±»å‹ï¼Œä½¿ç”¨æ—¶å› ä¸ºè‡ªåŠ¨æ‹†ç®±å‡ºç°äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</li>\n<li>å­—ç¬¦ä¸²æ¯”è¾ƒå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</li>\n<li>è¯¸å¦‚ConcurrentHashMapè¿™æ ·çš„å®¹å™¨ä¸æ”¯æŒKeyå’ŒValueä¸ºnullï¼Œå¼ºè¡Œput nullçš„Keyæˆ–Valueä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</li>\n<li>Aå¯¹è±¡åŒ…å«äº†Bï¼Œåœ¨é€šè¿‡Aå¯¹è±¡çš„å­—æ®µè·å¾—Bä¹‹åï¼Œæ²¡æœ‰å¯¹å­—æ®µåˆ¤ç©ºå°±çº§è”è°ƒç”¨Bçš„æ–¹æ³•å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</li>\n<li>æ–¹æ³•æˆ–è¿œç¨‹æœåŠ¡è¿”å›çš„Listä¸æ˜¯ç©ºè€Œæ˜¯nullï¼Œæ²¡æœ‰è¿›è¡Œåˆ¤ç©ºå°±ç›´æ¥è°ƒç”¨Listçš„æ–¹æ³•å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</li>\n</ul><p>ä¸ºæ¨¡æ‹Ÿè¯´æ˜è¿™5ç§åœºæ™¯ï¼Œæˆ‘å†™äº†ä¸€ä¸ªwrongMethodæ–¹æ³•ï¼Œå¹¶ç”¨ä¸€ä¸ªwrongæ–¹æ³•æ¥è°ƒç”¨å®ƒã€‚wrongæ–¹æ³•çš„å…¥å‚testæ˜¯ä¸€ä¸ªç”±0å’Œ1æ„æˆçš„ã€é•¿åº¦ä¸º4çš„å­—ç¬¦ä¸²ï¼Œç¬¬å‡ ä½è®¾ç½®ä¸º1å°±ä»£è¡¨ç¬¬å‡ ä¸ªå‚æ•°ä¸ºnullï¼Œç”¨æ¥æ§åˆ¶wrongMethodæ–¹æ³•çš„4ä¸ªå…¥å‚ï¼Œä»¥æ¨¡æ‹Ÿå„ç§ç©ºæŒ‡é’ˆæƒ…å†µï¼š</p><pre><code>private List&lt;String&gt; wrongMethod(FooService fooService, Integer i, String s, String t) {\n    log.info(&quot;result {} {} {} {}&quot;, i + 1, s.equals(&quot;OK&quot;), s.equals(t),\n            new ConcurrentHashMap&lt;String, String&gt;().put(null, null));\n    if (fooService.getBarService().bar().equals(&quot;OK&quot;))\n        log.info(&quot;OK&quot;);\n    return null;\n}\n\n@GetMapping(&quot;wrong&quot;)\npublic int wrong(@RequestParam(value = &quot;test&quot;, defaultValue = &quot;1111&quot;) String test) {\n    return wrongMethod(test.charAt(0) == '1' ? null : new FooService(),\n            test.charAt(1) == '1' ? null : 1,\n            test.charAt(2) == '1' ? null : &quot;OK&quot;,\n            test.charAt(3) == '1' ? null : &quot;OK&quot;).size();\n}\n\nclass FooService {\n    @Getter\n    private BarService barService;\n\n}\n\nclass BarService {\n    String bar() {\n        return &quot;OK&quot;;\n    }\n}\n</code></pre><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ¡ˆä¾‹å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯å› ä¸ºå˜é‡æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œå°è¯•è·å¾—å˜é‡çš„å€¼æˆ–è®¿é—®å˜é‡çš„æˆå‘˜ä¼šè·å¾—ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ä½†ï¼Œè¿™ä¸ªå¼‚å¸¸çš„å®šä½æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>åœ¨æµ‹è¯•æ–¹æ³•wrongMethodä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€è¡Œæ—¥å¿—è®°å½•çš„æ“ä½œï¼Œåœ¨ä¸€è¡Œä»£ç ä¸­æ¨¡æ‹Ÿäº†4å¤„ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š</p><ul>\n<li>å¯¹å…¥å‚Integer iè¿›è¡Œ+1æ“ä½œï¼›</li>\n<li>å¯¹å…¥å‚String sè¿›è¡Œæ¯”è¾ƒæ“ä½œï¼Œåˆ¤æ–­å†…å®¹æ˜¯å¦ç­‰äº\"OK\"ï¼›</li>\n<li>å¯¹å…¥å‚String så’Œå…¥å‚String tè¿›è¡Œæ¯”è¾ƒæ“ä½œï¼Œåˆ¤æ–­ä¸¤è€…æ˜¯å¦ç›¸ç­‰ï¼›</li>\n<li>å¯¹newå‡ºæ¥çš„ConcurrentHashMapè¿›è¡Œputæ“ä½œï¼ŒKeyå’ŒValueéƒ½è®¾ç½®ä¸ºnullã€‚</li>\n</ul><p>è¾“å‡ºçš„å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre><code>java.lang.NullPointerException: null\n\tat org.geekbang.time.commonmistakes.nullvalue.demo2.AvoidNullPointerExceptionController.wrongMethod(AvoidNullPointerExceptionController.java:37)\n\tat org.geekbang.time.commonmistakes.nullvalue.demo2.AvoidNullPointerExceptionController.wrong(AvoidNullPointerExceptionController.java:20)\n</code></pre><p>è¿™æ®µä¿¡æ¯ç¡®å®æç¤ºäº†è¿™è¡Œä»£ç å‡ºç°äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æˆ‘ä»¬å¾ˆéš¾å®šä½å‡ºåˆ°åº•æ˜¯å“ªé‡Œå‡ºç°äº†ç©ºæŒ‡é’ˆï¼Œå¯èƒ½æ˜¯æŠŠå…¥å‚Integeræ‹†ç®±ä¸ºintçš„æ—¶å€™å‡ºç°çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¥å‚çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä»»æ„ä¸€ä¸ªä¸ºnullï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæŠŠnullåŠ å…¥äº†ConcurrentHashMapã€‚</p><p>ä½ å¯èƒ½ä¼šæƒ³åˆ°ï¼Œè¦æ’æŸ¥è¿™æ ·çš„é—®é¢˜ï¼Œåªè¦è®¾ç½®ä¸€ä¸ªæ–­ç‚¹çœ‹ä¸€ä¸‹å…¥å‚å³å¯ã€‚ä½†ï¼Œåœ¨çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç©ºæŒ‡é’ˆé—®é¢˜å¾€å¾€æ˜¯åœ¨ç‰¹å®šçš„å…¥å‚å’Œä»£ç åˆ†æ”¯ä¸‹æ‰ä¼šå‡ºç°ï¼Œæœ¬åœ°éš¾ä»¥é‡ç°ã€‚å¦‚æœè¦æ’æŸ¥ç”Ÿäº§ä¸Šå‡ºç°çš„ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œè®¾ç½®ä»£ç æ–­ç‚¹ä¸ç°å®ï¼Œé€šå¸¸æ˜¯è¦ä¹ˆæŠŠä»£ç è¿›è¡Œæ‹†åˆ†ï¼Œè¦ä¹ˆå¢åŠ æ›´å¤šçš„æ—¥å¿—ï¼Œä½†éƒ½æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æ¨èä½¿ç”¨é˜¿é‡Œå¼€æºçš„Javaæ•…éšœè¯Šæ–­ç¥å™¨<a href=\"https://alibaba.github.io/arthas/\">Arthas</a>ã€‚Arthasç®€å•æ˜“ç”¨åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥å®šä½å‡ºå¤§å¤šæ•°çš„Javaç”Ÿäº§é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ æ¼”ç¤ºä¸‹å¦‚ä½•åœ¨30ç§’å†…çŸ¥é“wrongMethodæ–¹æ³•çš„å…¥å‚ï¼Œä»è€Œå®šä½åˆ°ç©ºæŒ‡é’ˆåˆ°åº•æ˜¯å“ªä¸ªå…¥å‚å¼•èµ·çš„ã€‚å¦‚ä¸‹æˆªå›¾ä¸­æœ‰ä¸‰ä¸ªçº¢æ¡†ï¼Œæˆ‘å…ˆå’Œä½ åˆ†æç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªçº¢æ¡†ï¼š</p><ul>\n<li>ç¬¬äºŒä¸ªçº¢æ¡†è¡¨ç¤ºï¼ŒArthaså¯åŠ¨åè¢«é™„åŠ åˆ°äº†JVMè¿›ç¨‹ï¼›</li>\n<li>ç¬¬ä¸‰ä¸ªçº¢æ¡†è¡¨ç¤ºï¼Œé€šè¿‡watchå‘½ä»¤ç›‘æ§wrongMethodæ–¹æ³•çš„å…¥å‚ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/e2/6b/e2d39e5da91a8258c5aab3691e515c6b.png?wh=2194*1796\" alt=\"\"></p><p>watchå‘½ä»¤çš„å‚æ•°åŒ…æ‹¬ç±»åè¡¨è¾¾å¼ã€æ–¹æ³•è¡¨è¾¾å¼å’Œè§‚å¯Ÿè¡¨è¾¾å¼ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®è§‚å¯Ÿç±»ä¸ºAvoidNullPointerExceptionControllerï¼Œè§‚å¯Ÿæ–¹æ³•ä¸ºwrongMethodï¼Œè§‚å¯Ÿè¡¨è¾¾å¼ä¸ºparamsè¡¨ç¤ºè§‚å¯Ÿå…¥å‚ï¼š</p><pre><code>watch org.geekbang.time.commonmistakes.nullvalue.demo2.AvoidNullPointerExceptionController wrongMethod params\n</code></pre><p>å¼€å¯watchåï¼Œæ‰§è¡Œ2æ¬¡wrongæ–¹æ³•åˆ†åˆ«è®¾ç½®testå…¥å‚ä¸º1111å’Œ1101ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡ä¼ å…¥wrongMethodçš„4ä¸ªå‚æ•°éƒ½ä¸ºnullï¼Œç¬¬äºŒæ¬¡ä¼ å…¥çš„ç¬¬1ã€2å’Œ4ä¸ªå‚æ•°ä¸ºnullã€‚</p><p>é…åˆå›¾ä¸­ç¬¬ä¸€å’Œç¬¬å››ä¸ªçº¢æ¡†å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²OKå…¶ä»–å‚æ•°æ˜¯nullï¼ŒArchasæ­£ç¡®è¾“å‡ºäº†æ–¹æ³•çš„æ‰€æœ‰å…¥å‚ï¼Œè¿™æ ·æˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½å®šä½åˆ°ç©ºæŒ‡é’ˆçš„é—®é¢˜äº†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œå¦‚æœæ˜¯ç®€å•çš„ä¸šåŠ¡é€»è¾‘çš„è¯ï¼Œä½ å°±å¯ä»¥å®šä½åˆ°ç©ºæŒ‡é’ˆå¼‚å¸¸äº†ï¼›å¦‚æœæ˜¯åˆ†æ”¯å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½ éœ€è¦å†å€ŸåŠ©stackå‘½ä»¤æ¥æŸ¥çœ‹wrongMethodæ–¹æ³•çš„è°ƒç”¨æ ˆï¼Œå¹¶é…åˆwatchå‘½ä»¤æŸ¥çœ‹å„æ–¹æ³•çš„å…¥å‚ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®šä½åˆ°ç©ºæŒ‡é’ˆçš„æ ¹æºäº†ã€‚</p><p>ä¸‹å›¾æ¼”ç¤ºäº†é€šè¿‡stackå‘½ä»¤è§‚å¯ŸwrongMethodçš„è°ƒç”¨è·¯å¾„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/ef/6c9ac7f4345936ece0b0d31c1ad974ef.png?wh=2862*308\" alt=\"\"></p><p>å¦‚æœä½ æƒ³äº†è§£Arthaså„ç§å‘½ä»¤çš„è¯¦ç»†ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥<a href=\"https://alibaba.github.io/arthas/commands.html\">ç‚¹å‡»</a>è¿™é‡ŒæŸ¥çœ‹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¿®å¤ä¸Šé¢å‡ºç°çš„5ç§ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>å…¶å®ï¼Œå¯¹äºä»»ä½•ç©ºæŒ‡é’ˆå¼‚å¸¸çš„å¤„ç†ï¼Œæœ€ç›´ç™½çš„æ–¹å¼æ˜¯å…ˆåˆ¤ç©ºåæ“ä½œã€‚ä¸è¿‡ï¼Œè¿™åªèƒ½è®©å¼‚å¸¸ä¸å†å‡ºç°ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ‰¾åˆ°ç¨‹åºé€»è¾‘ä¸­å‡ºç°çš„ç©ºæŒ‡é’ˆç©¶ç«Ÿæ˜¯æ¥æºäºå…¥å‚è¿˜æ˜¯Bugï¼š</p><ul>\n<li>å¦‚æœæ˜¯æ¥æºäºå…¥å‚ï¼Œè¿˜è¦è¿›ä¸€æ­¥åˆ†æå…¥å‚æ˜¯å¦åˆç†ç­‰ï¼›</li>\n<li>å¦‚æœæ˜¯æ¥æºäºBugï¼Œé‚£ç©ºæŒ‡é’ˆä¸ä¸€å®šæ˜¯çº¯ç²¹çš„ç¨‹åºBugï¼Œå¯èƒ½è¿˜æ¶‰åŠä¸šåŠ¡å±æ€§å’Œæ¥å£è°ƒç”¨è§„èŒƒç­‰ã€‚</li>\n</ul><p>åœ¨è¿™é‡Œï¼Œå› ä¸ºæ˜¯Demoï¼Œæ‰€ä»¥æˆ‘ä»¬åªè€ƒè™‘çº¯ç²¹çš„ç©ºæŒ‡é’ˆåˆ¤ç©ºè¿™ç§ä¿®å¤æ–¹å¼ã€‚å¦‚æœè¦å…ˆåˆ¤ç©ºåå¤„ç†ï¼Œå¤§å¤šæ•°äººä¼šæƒ³åˆ°ä½¿ç”¨if-elseä»£ç å—ã€‚ä½†ï¼Œè¿™ç§æ–¹å¼æ—¢å¢åŠ ä»£ç é‡åˆä¼šé™ä½æ˜“è¯»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ©ç”¨Java 8çš„Optionalç±»æ¥æ¶ˆé™¤è¿™æ ·çš„if-elseé€»è¾‘ï¼Œä½¿ç”¨ä¸€è¡Œä»£ç è¿›è¡Œåˆ¤ç©ºå’Œå¤„ç†ã€‚</p><p>ä¿®å¤æ€è·¯å¦‚ä¸‹ï¼š</p><ul>\n<li>å¯¹äºIntegerçš„åˆ¤ç©ºï¼Œå¯ä»¥ä½¿ç”¨Optional.ofNullableæ¥æ„é€ ä¸€ä¸ªOptional<integer>ï¼Œç„¶åä½¿ç”¨orElse(0)æŠŠnullæ›¿æ¢ä¸ºé»˜è®¤å€¼å†è¿›è¡Œ+1æ“ä½œã€‚</integer></li>\n<li>å¯¹äºStringå’Œå­—é¢é‡çš„æ¯”è¾ƒï¼Œå¯ä»¥æŠŠå­—é¢é‡æ”¾åœ¨å‰é¢ï¼Œæ¯”å¦‚\"OK\".equals(s)ï¼Œè¿™æ ·å³ä½¿sæ˜¯nullä¹Ÿä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›è€Œå¯¹äºä¸¤ä¸ªå¯èƒ½ä¸ºnullçš„å­—ç¬¦ä¸²å˜é‡çš„equalsæ¯”è¾ƒï¼Œå¯ä»¥ä½¿ç”¨Objects.equalsï¼Œå®ƒä¼šåšåˆ¤ç©ºå¤„ç†ã€‚</li>\n<li>å¯¹äºConcurrentHashMapï¼Œæ—¢ç„¶å…¶Keyå’ŒValueéƒ½ä¸æ”¯æŒnullï¼Œä¿®å¤æ–¹å¼å°±æ˜¯ä¸è¦æŠŠnullå­˜è¿›å»ã€‚HashMapçš„Keyå’ŒValueå¯ä»¥å­˜å…¥nullï¼Œè€ŒConcurrentHashMapçœ‹ä¼¼æ˜¯HashMapçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œå´ä¸æ”¯æŒnullå€¼çš„Keyå’ŒValueï¼Œè¿™æ˜¯å®¹æ˜“äº§ç”Ÿè¯¯åŒºçš„ä¸€ä¸ªåœ°æ–¹ã€‚</li>\n<li>å¯¹äºç±»ä¼¼fooService.getBarService().bar().equals(â€œOKâ€)çš„çº§è”è°ƒç”¨ï¼Œéœ€è¦åˆ¤ç©ºçš„åœ°æ–¹æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬fooServiceã€getBarService()æ–¹æ³•çš„è¿”å›å€¼ï¼Œä»¥åŠbaræ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ã€‚å¦‚æœä½¿ç”¨if-elseæ¥åˆ¤ç©ºçš„è¯å¯èƒ½éœ€è¦å¥½å‡ è¡Œä»£ç ï¼Œä½†ä½¿ç”¨Optionalçš„è¯ä¸€è¡Œä»£ç å°±å¤Ÿäº†ã€‚</li>\n<li>å¯¹äºrightMethodè¿”å›çš„List<string>ï¼Œç”±äºä¸èƒ½ç¡®è®¤å…¶æ˜¯å¦ä¸ºnullï¼Œæ‰€ä»¥åœ¨è°ƒç”¨sizeæ–¹æ³•è·å¾—åˆ—è¡¨å¤§å°ä¹‹å‰ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨Optional.ofNullableåŒ…è£…ä¸€ä¸‹è¿”å›å€¼ï¼Œç„¶åé€šè¿‡.orElse(Collections.emptyList())å®ç°åœ¨Listä¸ºnullçš„æ—¶å€™è·å¾—ä¸€ä¸ªç©ºçš„Listï¼Œæœ€åå†è°ƒç”¨sizeæ–¹æ³•ã€‚</string></li>\n</ul><pre><code>private List&lt;String&gt; rightMethod(FooService fooService, Integer i, String s, String t) {\n    log.info(&quot;result {} {} {} {}&quot;, Optional.ofNullable(i).orElse(0) + 1, &quot;OK&quot;.equals(s), Objects.equals(s, t), new HashMap&lt;String, String&gt;().put(null, null));\n    Optional.ofNullable(fooService)\n            .map(FooService::getBarService)\n            .filter(barService -&gt; &quot;OK&quot;.equals(barService.bar()))\n            .ifPresent(result -&gt; log.info(&quot;OK&quot;));\n    return new ArrayList&lt;&gt;();\n}\n\n@GetMapping(&quot;right&quot;)\npublic int right(@RequestParam(value = &quot;test&quot;, defaultValue = &quot;1111&quot;) String test) {\n    return Optional.ofNullable(rightMethod(test.charAt(0) == '1' ? null : new FooService(),\n            test.charAt(1) == '1' ? null : 1,\n            test.charAt(2) == '1' ? null : &quot;OK&quot;,\n            test.charAt(3) == '1' ? null : &quot;OK&quot;))\n            .orElse(Collections.emptyList()).size();\n}\n</code></pre><p>ç»è¿‡ä¿®å¤åï¼Œè°ƒç”¨rightæ–¹æ³•ä¼ å…¥1111ï¼Œä¹Ÿå°±æ˜¯ç»™rightMethodçš„4ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸ºnullï¼Œæ—¥å¿—ä¸­ä¹Ÿçœ‹ä¸åˆ°ä»»ä½•ç©ºæŒ‡é’ˆå¼‚å¸¸äº†ï¼š</p><pre><code>[21:43:40.619] [http-nio-45678-exec-2] [INFO ] [.AvoidNullPointerExceptionController:45  ] - result 1 false true null\n</code></pre><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¿®æ”¹rightæ–¹æ³•å…¥å‚ä¸º0000ï¼Œå³ä¼ ç»™rightMethodæ–¹æ³•çš„4ä¸ªå‚æ•°éƒ½ä¸å¯èƒ½æ˜¯nullï¼Œæœ€åæ—¥å¿—ä¸­ä¹Ÿæ— æ³•å‡ºç°OKå­—æ ·ã€‚è¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŒBarServiceçš„baræ–¹æ³•ä¸æ˜¯è¿”å›äº†OKå­—ç¬¦ä¸²å—ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯ç”¨Arthasæ¥å®šä½é—®é¢˜ï¼Œä½¿ç”¨watchå‘½ä»¤æ¥è§‚å¯Ÿæ–¹æ³•rightMethodçš„å…¥å‚ï¼Œ-xå‚æ•°è®¾ç½®ä¸º2ä»£è¡¨å‚æ•°æ‰“å°çš„æ·±åº¦ä¸º2å±‚ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0c/82/0ce3c96788f243791cbd512aecfa6382.png?wh=2404*460\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒFooServiceä¸­çš„barServiceå­—æ®µä¸ºnullï¼Œè¿™æ ·ä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆæœ€ç»ˆå‡ºç°è¿™ä¸ªBugäº†ã€‚</p><p>è¿™åˆå¼•ç”³å‡ºä¸€ä¸ªé—®é¢˜ï¼Œ<strong>ä½¿ç”¨åˆ¤ç©ºæ–¹å¼æˆ–Optionalæ–¹å¼æ¥é¿å…å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä¸ä¸€å®šæ˜¯è§£å†³é—®é¢˜çš„æœ€å¥½æ–¹å¼ï¼Œç©ºæŒ‡é’ˆæ²¡å‡ºç°å¯èƒ½éšè—äº†æ›´æ·±çš„Bug</strong>ã€‚å› æ­¤ï¼Œè§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè¿˜æ˜¯è¦çœŸæ­£case by caseåœ°å®šä½åˆ†ææ¡ˆä¾‹ï¼Œç„¶åå†å»åšåˆ¤ç©ºå¤„ç†ï¼Œè€Œå¤„ç†æ—¶ä¹Ÿå¹¶ä¸åªæ˜¯åˆ¤æ–­éç©ºç„¶åè¿›è¡Œæ­£å¸¸ä¸šåŠ¡æµç¨‹è¿™ä¹ˆç®€å•ï¼ŒåŒæ ·éœ€è¦è€ƒè™‘ä¸ºç©ºçš„æ—¶å€™æ˜¯åº”è¯¥å‡ºå¼‚å¸¸ã€è®¾é»˜è®¤å€¼è¿˜æ˜¯è®°å½•æ—¥å¿—ç­‰ã€‚</p><h2>POJOä¸­å±æ€§çš„nullåˆ°åº•ä»£è¡¨äº†ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨æˆ‘çœ‹æ¥ï¼Œç›¸æ¯”åˆ¤ç©ºé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ›´å®¹æ˜“å‡ºé”™çš„æ˜¯nullçš„å®šä½é—®é¢˜ã€‚å¯¹ç¨‹åºæ¥è¯´ï¼Œnullå°±æ˜¯æŒ‡é’ˆæ²¡æœ‰ä»»ä½•æŒ‡å‘ï¼Œè€Œç»“åˆä¸šåŠ¡é€»è¾‘æƒ…å†µå°±å¤æ‚å¾—å¤šï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼š</p><ul>\n<li>DTOä¸­å­—æ®µçš„nullåˆ°åº•æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ˜¯å®¢æˆ·ç«¯æ²¡æœ‰ä¼ ç»™æˆ‘ä»¬è¿™ä¸ªä¿¡æ¯å—ï¼Ÿ</li>\n<li>æ—¢ç„¶ç©ºæŒ‡é’ˆé—®é¢˜å¾ˆè®¨åŒï¼Œé‚£ä¹ˆDTOä¸­çš„å­—æ®µè¦è®¾ç½®é»˜è®¤å€¼ä¹ˆï¼Ÿ</li>\n<li>å¦‚æœæ•°æ®åº“å®ä½“ä¸­çš„å­—æ®µæœ‰nullï¼Œé‚£ä¹ˆé€šè¿‡æ•°æ®è®¿é—®æ¡†æ¶ä¿å­˜æ•°æ®æ˜¯å¦ä¼šè¦†ç›–æ•°æ®åº“ä¸­çš„æ—¢æœ‰æ•°æ®ï¼Ÿ</li>\n</ul><p>å¦‚æœä¸èƒ½æ˜ç¡®åœ°å›ç­”è¿™äº›é—®é¢˜ï¼Œé‚£ä¹ˆå†™å‡ºçš„ç¨‹åºé€»è¾‘å¾ˆå¯èƒ½ä¼šæ··ä¹±ä¸å ªã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…æ¡ˆä¾‹å§ã€‚</p><p>æœ‰ä¸€ä¸ªUserçš„POJOï¼ŒåŒæ—¶æ‰®æ¼”DTOå’Œæ•°æ®åº“Entityè§’è‰²ï¼ŒåŒ…å«ç”¨æˆ·IDã€å§“åã€æ˜µç§°ã€å¹´é¾„ã€æ³¨å†Œæ—¶é—´ç­‰å±æ€§ï¼š</p><pre><code>@Data\n@Entity\npublic class User {\n    @Id\n    @GeneratedValue(strategy = IDENTITY)\n    private Long id;\n    private String name;\n    private String nickname;\n    private Integer age;\n    private Date createDate = new Date();\n}\n</code></pre><p>æœ‰ä¸€ä¸ªPostæ¥å£ç”¨äºæ›´æ–°ç”¨æˆ·æ•°æ®ï¼Œæ›´æ–°é€»è¾‘éå¸¸ç®€å•ï¼Œæ ¹æ®ç”¨æˆ·å§“åè‡ªåŠ¨è®¾ç½®ä¸€ä¸ªæ˜µç§°ï¼Œæ˜µç§°çš„è§„åˆ™æ˜¯â€œç”¨æˆ·ç±»å‹+å§“åâ€ï¼Œç„¶åç›´æ¥æŠŠå®¢æˆ·ç«¯åœ¨RequestBodyä¸­ä½¿ç”¨JSONä¼ è¿‡æ¥çš„Userå¯¹è±¡é€šè¿‡JPAæ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œæœ€åè¿”å›ä¿å­˜åˆ°æ•°æ®åº“çš„æ•°æ®ã€‚</p><pre><code>@Autowired\nprivate UserRepository userRepository;\n\n@PostMapping(&quot;wrong&quot;)\npublic User wrong(@RequestBody User user) {\n    user.setNickname(String.format(&quot;guest%s&quot;, user.getName()));\n    return userRepository.save(user);\n}\n\n@Repository\npublic interface UserRepository extends JpaRepository&lt;User, Long&gt; {\n}\n</code></pre><p>é¦–å…ˆï¼Œåœ¨æ•°æ®åº“ä¸­åˆå§‹åŒ–ä¸€ä¸ªç”¨æˆ·ï¼Œage=36ã€name=zhuyeã€create_date=2020å¹´1æœˆ4æ—¥ã€nicknameæ˜¯NULLï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/de/67/de1bcb580ea63505a8e093c51c4cd567.png?wh=1004*128\" alt=\"\"></p><p>ç„¶åï¼Œä½¿ç”¨cURLæµ‹è¯•ä¸€ä¸‹ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ¥å£Postï¼Œä¼ å…¥ä¸€ä¸ªid=1ã€name=nullçš„JSONå­—ç¬¦ä¸²ï¼ŒæœŸæœ›æŠŠIDä¸º1çš„ç”¨æˆ·å§“åè®¾ç½®ä¸ºç©ºï¼š</p><pre><code>curl -H &quot;Content-Type:application/json&quot; -X POST -d '{ &quot;id&quot;:1, &quot;name&quot;:null}' http://localhost:45678/pojonull/wrong\n\n{&quot;id&quot;:1,&quot;name&quot;:null,&quot;nickname&quot;:&quot;guestnull&quot;,&quot;age&quot;:null,&quot;createDate&quot;:&quot;2020-01-05T02:01:03.784+0000&quot;}%\n</code></pre><p>æ¥å£è¿”å›çš„ç»“æœå’Œæ•°æ®åº“ä¸­è®°å½•ä¸€è‡´ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/af/fd/af9c07a63ba837683ad059a6afcceafd.png?wh=1012*124\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå­˜åœ¨å¦‚ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>è°ƒç”¨æ–¹åªå¸Œæœ›é‡ç½®ç”¨æˆ·åï¼Œä½†ageä¹Ÿè¢«è®¾ç½®ä¸ºäº†nullï¼›</li>\n<li>nicknameæ˜¯ç”¨æˆ·ç±»å‹åŠ å§“åï¼Œnameé‡ç½®ä¸ºnullçš„è¯ï¼Œè®¿å®¢ç”¨æˆ·çš„æ˜µç§°åº”è¯¥æ˜¯guestï¼Œè€Œä¸æ˜¯guestnullï¼Œé‡ç°äº†æ–‡é¦–æåˆ°çš„é‚£ä¸ªç¬‘ç‚¹ï¼›</li>\n<li>ç”¨æˆ·çš„åˆ›å»ºæ—¶é—´åŸæ¥æ˜¯1æœˆ4æ—¥ï¼Œæ›´æ–°äº†ç”¨æˆ·ä¿¡æ¯åå˜ä¸ºäº†1æœˆ5æ—¥ã€‚</li>\n</ul><p>å½’æ ¹ç»“åº•ï¼Œè¿™æ˜¯å¦‚ä¸‹5ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p><ul>\n<li>æ˜ç¡®DTOä¸­nullçš„å«ä¹‰ã€‚<strong>å¯¹äºJSONåˆ°DTOçš„ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œnullçš„è¡¨è¾¾æ˜¯æœ‰æ­§ä¹‰çš„ï¼Œå®¢æˆ·ç«¯ä¸ä¼ æŸä¸ªå±æ€§ï¼Œæˆ–è€…ä¼ nullï¼Œè¿™ä¸ªå±æ€§åœ¨DTOä¸­éƒ½æ˜¯nullã€‚</strong>ä½†ï¼Œå¯¹äºç”¨æˆ·ä¿¡æ¯æ›´æ–°æ“ä½œï¼Œä¸ä¼ æ„å‘³ç€å®¢æˆ·ç«¯ä¸éœ€è¦æ›´æ–°è¿™ä¸ªå±æ€§ï¼Œç»´æŒæ•°æ®åº“åŸå…ˆçš„å€¼ï¼›ä¼ äº†nullï¼Œæ„å‘³ç€å®¢æˆ·ç«¯å¸Œæœ›é‡ç½®è¿™ä¸ªå±æ€§ã€‚å› ä¸ºJavaä¸­çš„nullå°±æ˜¯æ²¡æœ‰è¿™ä¸ªæ•°æ®ï¼Œæ— æ³•åŒºåˆ†è¿™ä¸¤ç§è¡¨è¾¾ï¼Œæ‰€ä»¥æœ¬ä¾‹ä¸­çš„ageå±æ€§ä¹Ÿè¢«è®¾ç½®ä¸ºäº†nullï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥å€ŸåŠ©Optionalæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li>\n<li><strong>POJOä¸­çš„å­—æ®µæœ‰é»˜è®¤å€¼ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸ä¼ å€¼ï¼Œå°±ä¼šèµ‹å€¼ä¸ºé»˜è®¤å€¼ï¼Œå¯¼è‡´åˆ›å»ºæ—¶é—´ä¹Ÿè¢«æ›´æ–°åˆ°äº†æ•°æ®åº“ä¸­ã€‚</strong></li>\n<li><strong>æ³¨æ„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ—¶å¯èƒ½ä¼šæŠŠnullå€¼æ ¼å¼åŒ–ä¸ºnullå­—ç¬¦ä¸²ã€‚</strong>æ¯”å¦‚æ˜µç§°çš„è®¾ç½®ï¼Œæˆ‘ä»¬åªæ˜¯è¿›è¡Œäº†ç®€å•çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œå­˜å…¥æ•°æ®åº“å˜ä¸ºäº†guestnullã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œä¹Ÿæ˜¯å¼€å¤´æˆ‘ä»¬è¯´çš„ç¬‘è¯çš„æ¥æºï¼Œè¿˜éœ€è¦è¿›è¡Œåˆ¤æ–­ã€‚</li>\n<li><strong>DTOå’ŒEntityå…±ç”¨äº†ä¸€ä¸ªPOJO</strong>ã€‚å¯¹äºç”¨æˆ·æ˜µç§°çš„è®¾ç½®æ˜¯ç¨‹åºæ§åˆ¶çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æŠŠå®ƒä»¬æš´éœ²åœ¨DTOä¸­ï¼Œå¦åˆ™å¾ˆå®¹æ˜“æŠŠå®¢æˆ·ç«¯éšæ„è®¾ç½®çš„å€¼æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚æ­¤å¤–ï¼Œåˆ›å»ºæ—¶é—´æœ€å¥½è®©æ•°æ®åº“è®¾ç½®ä¸ºå½“å‰æ—¶é—´ï¼Œä¸ç”¨ç¨‹åºæ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡åœ¨å­—æ®µä¸Šè®¾ç½®columnDefinitionæ¥å®ç°ã€‚</li>\n<li><strong>æ•°æ®åº“å­—æ®µå…è®¸ä¿å­˜nullï¼Œä¼šè¿›ä¸€æ­¥å¢åŠ å‡ºé”™çš„å¯èƒ½æ€§å’Œå¤æ‚åº¦</strong>ã€‚å› ä¸ºå¦‚æœæ•°æ®çœŸæ­£è½åœ°çš„æ—¶å€™ä¹Ÿæ”¯æŒNULLçš„è¯ï¼Œå¯èƒ½å°±æœ‰NULLã€ç©ºå­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²nullä¸‰ç§çŠ¶æ€ã€‚è¿™ä¸€ç‚¹æˆ‘ä¼šåœ¨ä¸‹ä¸€å°èŠ‚å±•å¼€ã€‚å¦‚æœæ‰€æœ‰å±æ€§éƒ½æœ‰é»˜è®¤å€¼ï¼Œé—®é¢˜ä¼šç®€å•ä¸€ç‚¹ã€‚</li>\n</ul><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯¹DTOå’ŒEntityè¿›è¡Œæ‹†åˆ†ï¼Œä¿®æ”¹åä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul>\n<li>UserDtoä¸­åªä¿ç•™idã€nameå’Œageä¸‰ä¸ªå±æ€§ï¼Œä¸”nameå’Œageä½¿ç”¨Optionalæ¥åŒ…è£…ï¼Œä»¥åŒºåˆ†å®¢æˆ·ç«¯ä¸ä¼ æ•°æ®è¿˜æ˜¯æ•…æ„ä¼ nullã€‚</li>\n<li>åœ¨UserEntityçš„å­—æ®µä¸Šä½¿ç”¨@Columnæ³¨è§£ï¼ŒæŠŠæ•°æ®åº“å­—æ®µnameã€nicknameã€ageå’ŒcreateDateéƒ½è®¾ç½®ä¸ºNOT NULLï¼Œå¹¶è®¾ç½®createDateçš„é»˜è®¤å€¼ä¸ºCURRENT_TIMESTAMPï¼Œç”±æ•°æ®åº“æ¥ç”Ÿæˆåˆ›å»ºæ—¶é—´ã€‚</li>\n<li>ä½¿ç”¨Hibernateçš„@DynamicUpdateæ³¨è§£å®ç°æ›´æ–°SQLçš„åŠ¨æ€ç”Ÿæˆï¼Œå®ç°åªæ›´æ–°ä¿®æ”¹åçš„å­—æ®µï¼Œä¸è¿‡éœ€è¦å…ˆæŸ¥è¯¢ä¸€æ¬¡å®ä½“ï¼Œè®©Hibernateå¯ä»¥â€œè·Ÿè¸ªâ€å®ä½“å±æ€§çš„å½“å‰çŠ¶æ€ï¼Œä»¥ç¡®ä¿æœ‰æ•ˆã€‚</li>\n</ul><pre><code>@Data\npublic class UserDto {\n    private Long id;\n    private Optional&lt;String&gt; name;\n    private Optional&lt;Integer&gt; age;\n; \n\n@Data\n@Entity\n@DynamicUpdate\npublic class UserEntity {\n    @Id\n    @GeneratedValue(strategy = IDENTITY)\n    private Long id;\n    @Column(nullable = false)\n    private String name;\n    @Column(nullable = false)\n    private String nickname;\n    @Column(nullable = false)\n    private Integer age;\n    @Column(nullable = false, columnDefinition = &quot;TIMESTAMP DEFAULT CURRENT_TIMESTAMP&quot;)\n    private Date createDate;\n}\n</code></pre><p>åœ¨é‡æ„äº†DTOå’ŒEntityåï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰ä¸€ä¸ªrightæ¥å£ï¼Œä»¥ä¾¿å¯¹æ›´æ–°æ“ä½œè¿›è¡Œæ›´ç²¾ç»†åŒ–çš„å¤„ç†ã€‚é¦–å…ˆæ˜¯å‚æ•°æ ¡éªŒï¼š</p><ul>\n<li>å¯¹ä¼ å…¥çš„UserDtoå’ŒIDå±æ€§å…ˆåˆ¤ç©ºï¼Œå¦‚æœä¸ºç©ºç›´æ¥æŠ›å‡ºIllegalArgumentExceptionã€‚</li>\n<li>æ ¹æ®idä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºå®ä½“åè¿›è¡Œåˆ¤ç©ºï¼Œå¦‚æœä¸ºç©ºç›´æ¥æŠ›å‡ºIllegalArgumentExceptionã€‚</li>\n</ul><p>ç„¶åï¼Œç”±äºDTOä¸­å·²ç»å·§å¦™ä½¿ç”¨äº†Optionalæ¥åŒºåˆ†å®¢æˆ·ç«¯ä¸ä¼ å€¼å’Œä¼ nullå€¼ï¼Œé‚£ä¹ˆä¸šåŠ¡é€»è¾‘å®ç°ä¸Šå°±å¯ä»¥æŒ‰ç…§å®¢æˆ·ç«¯çš„æ„å›¾æ¥åˆ†åˆ«å®ç°é€»è¾‘ã€‚å¦‚æœä¸ä¼ å€¼ï¼Œé‚£ä¹ˆOptionalæœ¬èº«ä¸ºnullï¼Œç›´æ¥è·³è¿‡Entityå­—æ®µçš„æ›´æ–°å³å¯ï¼Œè¿™æ ·åŠ¨æ€ç”Ÿæˆçš„SQLå°±ä¸ä¼šåŒ…å«è¿™ä¸ªåˆ—ï¼›å¦‚æœä¼ äº†å€¼ï¼Œé‚£ä¹ˆè¿›ä¸€æ­¥åˆ¤æ–­ä¼ çš„æ˜¯ä¸æ˜¯nullã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ†åˆ«å¯¹å§“åã€å¹´é¾„å’Œæ˜µç§°è¿›è¡Œæ›´æ–°ï¼š</p><ul>\n<li>å¯¹äºå§“åï¼Œæˆ‘ä»¬è®¤ä¸ºå®¢æˆ·ç«¯ä¼ nullæ˜¯å¸Œæœ›æŠŠå§“åé‡ç½®ä¸ºç©ºï¼Œå…è®¸è¿™æ ·çš„æ“ä½œï¼Œä½¿ç”¨Optionalçš„orElseæ–¹æ³•ä¸€é”®æŠŠç©ºè½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²å³å¯ã€‚</li>\n<li>å¯¹äºå¹´é¾„ï¼Œæˆ‘ä»¬è®¤ä¸ºå¦‚æœå®¢æˆ·ç«¯å¸Œæœ›æ›´æ–°å¹´é¾„å°±å¿…é¡»ä¼ ä¸€ä¸ªæœ‰æ•ˆçš„å¹´é¾„ï¼Œå¹´é¾„ä¸å­˜åœ¨é‡ç½®æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨Optionalçš„orElseThrowæ–¹æ³•åœ¨å€¼ä¸ºç©ºçš„æ—¶å€™æŠ›å‡ºIllegalArgumentExceptionã€‚</li>\n<li>å¯¹äºæ˜µç§°ï¼Œå› ä¸ºæ•°æ®åº“ä¸­å§“åä¸å¯èƒ½ä¸ºnullï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒåœ°æŠŠæ˜µç§°è®¾ç½®ä¸ºgueståŠ ä¸Šæ•°æ®åº“å–å‡ºæ¥çš„å§“åã€‚</li>\n</ul><pre><code>@PostMapping(&quot;right&quot;)\npublic UserEntity right(@RequestBody UserDto user) {\n    if (user == null || user.getId() == null)\n        throw new IllegalArgumentException(&quot;ç”¨æˆ·Idä¸èƒ½ä¸ºç©º&quot;);\n\n    UserEntity userEntity = userEntityRepository.findById(user.getId())\n            .orElseThrow(() -&gt; new IllegalArgumentException(&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;));\n\n    if (user.getName() != null) {\n        userEntity.setName(user.getName().orElse(&quot;&quot;));\n    }\n    userEntity.setNickname(&quot;guest&quot; + userEntity.getName());\n    if (user.getAge() != null) {\n        userEntity.setAge(user.getAge().orElseThrow(() -&gt; new IllegalArgumentException(&quot;å¹´é¾„ä¸èƒ½ä¸ºç©º&quot;)));\n    }\n    return userEntityRepository.save(userEntity);\n}\n</code></pre><p>å‡è®¾æ•°æ®åº“ä¸­å·²ç»æœ‰è¿™ä¹ˆä¸€æ¡è®°å½•ï¼Œid=1ã€age=36ã€create_date=2020å¹´1æœˆ4æ—¥ã€name=zhuyeã€nickname=guestzhuyeï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/47/5f1d46ea87f37a570b32f94ac44ca947.png?wh=980*118\" alt=\"\"></p><p>ä½¿ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨rightæ¥å£ï¼Œå†æ¥è¯•è¯•æ˜¯å¦è§£å†³äº†æ‰€æœ‰é—®é¢˜ã€‚ä¼ å…¥ä¸€ä¸ªid=1ã€name=nullçš„JSONå­—ç¬¦ä¸²ï¼ŒæœŸæœ›æŠŠidä¸º1çš„ç”¨æˆ·å§“åè®¾ç½®ä¸ºç©ºï¼š</p><pre><code>curl -H &quot;Content-Type:application/json&quot; -X POST -d '{ &quot;id&quot;:1, &quot;name&quot;:null}' http://localhost:45678/pojonull/right\n\n{&quot;id&quot;:1,&quot;name&quot;:&quot;&quot;,&quot;nickname&quot;:&quot;guest&quot;,&quot;age&quot;:36,&quot;createDate&quot;:&quot;2020-01-04T11:09:20.000+0000&quot;}%\n</code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/4a/a68db8e14e7dca3ff9b22e2348272a4a.png?wh=860*108\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œrightæ¥å£å®Œç¾å®ç°äº†ä»…é‡ç½®nameå±æ€§çš„æ“ä½œï¼Œæ˜µç§°ä¹Ÿä¸å†æœ‰nullå­—ç¬¦ä¸²ï¼Œå¹´é¾„å’Œåˆ›å»ºæ—¶é—´å­—æ®µä¹Ÿæ²¡è¢«ä¿®æ”¹ã€‚</p><p>é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼ŒHibernateç”Ÿæˆçš„SQLè¯­å¥åªæ›´æ–°äº†nameå’Œnicknameä¸¤ä¸ªå­—æ®µï¼š</p><pre><code>Hibernate: update user_entity set name=?, nickname=? where id=?\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†æµ‹è¯•ä½¿ç”¨Optionalæ˜¯å¦å¯ä»¥æœ‰æ•ˆåŒºåˆ†JSONä¸­æ²¡ä¼ å±æ€§è¿˜æ˜¯ä¼ äº†nullï¼Œæˆ‘ä»¬åœ¨JSONä¸­è®¾ç½®äº†ä¸€ä¸ªnullçš„ageï¼Œç»“æœæ˜¯æ­£ç¡®å¾—åˆ°äº†å¹´é¾„ä¸èƒ½ä¸ºç©ºçš„é”™è¯¯æç¤ºï¼š</p><pre><code>curl -H &quot;Content-Type:application/json&quot; -X POST -d '{ &quot;id&quot;:1, &quot;age&quot;:null}' http://localhost:45678/pojonull/right\n\n{&quot;timestamp&quot;:&quot;2020-01-05T03:14:40.324+0000&quot;,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;message&quot;:&quot;å¹´é¾„ä¸èƒ½ä¸ºç©º&quot;,&quot;path&quot;:&quot;/pojonull/right&quot;}%\n</code></pre><h2>å°å¿ƒMySQLä¸­æœ‰å…³NULLçš„ä¸‰ä¸ªå‘</h2><p>å‰é¢æåˆ°ï¼Œæ•°æ®åº“è¡¨å­—æ®µå…è®¸å­˜NULLé™¤äº†ä¼šè®©æˆ‘ä»¬å›°æƒ‘å¤–ï¼Œè¿˜å®¹æ˜“æœ‰å‘ã€‚è¿™é‡Œæˆ‘ä¼šç»“åˆNULLå­—æ®µï¼Œå’Œä½ ç€é‡è¯´æ˜sumå‡½æ•°ã€countå‡½æ•°ï¼Œä»¥åŠNULLå€¼æ¡ä»¶å¯èƒ½è¸©çš„å‘ã€‚</p><p>ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªåªæœ‰idå’Œscoreä¸¤ä¸ªå­—æ®µçš„å®ä½“ï¼š</p><pre><code>@Entity\n@Data\npublic class User {\n    @Id\n    @GeneratedValue(strategy = IDENTITY)\n    private Long id;\n    private Long score;\n}\n</code></pre><p>ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå¾€å®ä½“åˆå§‹åŒ–ä¸€æ¡æ•°æ®ï¼Œå…¶idæ˜¯è‡ªå¢åˆ—è‡ªåŠ¨è®¾ç½®çš„1ï¼Œscoreæ˜¯NULLï¼š</p><pre><code>@Autowired\nprivate UserRepository userRepository;\n\n@PostConstruct\npublic void init() {\n    userRepository.save(new User());\n}\n</code></pre><p>ç„¶åï¼Œæµ‹è¯•ä¸‹é¢ä¸‰ä¸ªç”¨ä¾‹ï¼Œæ¥çœ‹çœ‹ç»“åˆæ•°æ®åº“ä¸­çš„nullå€¼å¯èƒ½ä¼šå‡ºç°çš„å‘ï¼š</p><ul>\n<li>é€šè¿‡sumå‡½æ•°ç»Ÿè®¡ä¸€ä¸ªåªæœ‰NULLå€¼çš„åˆ—çš„æ€»å’Œï¼Œæ¯”å¦‚SUM(score)ï¼›</li>\n<li>selectè®°å½•æ•°é‡ï¼Œcountä½¿ç”¨ä¸€ä¸ªå…è®¸NULLçš„å­—æ®µï¼Œæ¯”å¦‚COUNT(score)ï¼›</li>\n<li>ä½¿ç”¨=NULLæ¡ä»¶æŸ¥è¯¢å­—æ®µå€¼ä¸ºNULLçš„è®°å½•ï¼Œæ¯”å¦‚score=nullæ¡ä»¶ã€‚</li>\n</ul><pre><code>@Repository\npublic interface UserRepository extends JpaRepository&lt;User, Long&gt; {\n    @Query(nativeQuery=true,value = &quot;SELECT SUM(score) FROM `user`&quot;)\n    Long wrong1();\n    @Query(nativeQuery = true, value = &quot;SELECT COUNT(score) FROM `user`&quot;)\n    Long wrong2();\n    @Query(nativeQuery = true, value = &quot;SELECT * FROM `user` WHERE score=null&quot;)\n    List&lt;User&gt; wrong3();\n}\n</code></pre><p>å¾—åˆ°çš„ç»“æœï¼Œåˆ†åˆ«æ˜¯nullã€0å’Œç©ºListï¼š</p><pre><code>[11:38:50.137] [http-nio-45678-exec-1] [INFO ] [t.c.nullvalue.demo3.DbNullController:26  ] - result: null 0 [] \n</code></pre><p>æ˜¾ç„¶ï¼Œè¿™ä¸‰æ¡SQLè¯­å¥çš„æ‰§è¡Œç»“æœå’Œæˆ‘ä»¬çš„æœŸæœ›ä¸åŒï¼š</p><ul>\n<li>è™½ç„¶è®°å½•çš„scoreéƒ½æ˜¯NULLï¼Œä½†sumçš„ç»“æœåº”è¯¥æ˜¯0æ‰å¯¹ï¼›</li>\n<li>è™½ç„¶è¿™æ¡è®°å½•çš„scoreæ˜¯NULLï¼Œä½†è®°å½•æ€»æ•°åº”è¯¥æ˜¯1æ‰å¯¹ï¼›</li>\n<li>ä½¿ç”¨=NULLå¹¶æ²¡æœ‰æŸ¥è¯¢åˆ°id=1çš„è®°å½•ï¼ŒæŸ¥è¯¢æ¡ä»¶å¤±æ•ˆã€‚</li>\n</ul><p>åŸå› æ˜¯ï¼š</p><ul>\n<li><strong>MySQLä¸­sumå‡½æ•°æ²¡ç»Ÿè®¡åˆ°ä»»ä½•è®°å½•æ—¶ï¼Œä¼šè¿”å›nullè€Œä¸æ˜¯0</strong>ï¼Œå¯ä»¥ä½¿ç”¨IFNULLå‡½æ•°æŠŠnullè½¬æ¢ä¸º0ï¼›</li>\n<li><strong>MySQLä¸­countå­—æ®µä¸ç»Ÿè®¡nullå€¼</strong>ï¼ŒCOUNT(*)æ‰æ˜¯ç»Ÿè®¡æ‰€æœ‰è®°å½•æ•°é‡çš„æ­£ç¡®æ–¹å¼ã€‚</li>\n<li><strong>MySQLä¸­ä½¿ç”¨è¯¸å¦‚=ã€&lt;ã€&gt;è¿™æ ·çš„ç®—æ•°æ¯”è¾ƒæ“ä½œç¬¦æ¯”è¾ƒNULLçš„ç»“æœæ€»æ˜¯NULL</strong>ï¼Œè¿™ç§æ¯”è¾ƒå°±æ˜¾å¾—æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œéœ€è¦ä½¿ç”¨IS NULLã€IS NOT NULLæˆ– ISNULL()å‡½æ•°æ¥æ¯”è¾ƒã€‚</li>\n</ul><p>ä¿®æ”¹ä¸€ä¸‹SQLï¼š</p><pre><code>@Query(nativeQuery = true, value = &quot;SELECT IFNULL(SUM(score),0) FROM `user`&quot;)\nLong right1();\n@Query(nativeQuery = true, value = &quot;SELECT COUNT(*) FROM `user`&quot;)\nLong right2();\n@Query(nativeQuery = true, value = &quot;SELECT * FROM `user` WHERE score IS NULL&quot;)\nList&lt;User&gt; right3();\n</code></pre><p>å¯ä»¥å¾—åˆ°ä¸‰ä¸ªæ­£ç¡®ç»“æœï¼Œåˆ†åˆ«ä¸º0ã€1ã€[User(id=1, score=null)] ï¼š</p><pre><code>[14:50:35.768] [http-nio-45678-exec-1] [INFO ] [t.c.nullvalue.demo3.DbNullController:31  ] - result: 0 1 [User(id=1, score=null)] \n</code></pre><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ è®¨è®ºäº†åšå¥½ç©ºå€¼å¤„ç†éœ€è¦æ³¨æ„çš„å‡ ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘é¦–å…ˆæ€»ç»“äº†ä¸šåŠ¡ä»£ç ä¸­5ç§æœ€å®¹æ˜“å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸çš„å†™æ³•ï¼Œä»¥åŠç›¸åº”çš„ä¿®å¤æ–¹å¼ã€‚é’ˆå¯¹åˆ¤ç©ºï¼Œé€šè¿‡Optionalé…åˆStreamå¯ä»¥é¿å…å¤§å¤šæ•°å†—é•¿çš„if-elseåˆ¤ç©ºé€»è¾‘ï¼Œå®ç°ä¸€è¡Œä»£ç ä¼˜é›…åˆ¤ç©ºã€‚å¦å¤–ï¼Œè¦å®šä½å’Œä¿®å¤ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œé™¤äº†å¯ä»¥é€šè¿‡å¢åŠ æ—¥å¿—è¿›è¡Œæ’æŸ¥å¤–ï¼Œåœ¨ç”Ÿäº§ä¸Šä½¿ç”¨Arthasæ¥æŸ¥çœ‹æ–¹æ³•çš„è°ƒç”¨æ ˆå’Œå…¥å‚ä¼šæ›´å¿«æ·ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œä¸šåŠ¡ç³»ç»Ÿæœ€åŸºæœ¬çš„æ ‡å‡†æ˜¯ä¸èƒ½å‡ºç°æœªå¤„ç†çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› ä¸ºå®ƒå¾€å¾€ä»£è¡¨äº†ä¸šåŠ¡é€»è¾‘çš„ä¸­æ–­ï¼Œæ‰€ä»¥æˆ‘å»ºè®®æ¯å¤©æŸ¥è¯¢ä¸€æ¬¡ç”Ÿäº§æ—¥å¿—æ¥æ’æŸ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæœ‰æ¡ä»¶çš„è¯å»ºè®®è®¢é˜…ç©ºæŒ‡é’ˆå¼‚å¸¸æŠ¥è­¦ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°åŠæ—¶å¤„ç†ã€‚</p><p>POJOä¸­å­—æ®µçš„nullå®šä½ï¼Œä»æœåŠ¡ç«¯çš„è§’åº¦å¾€å¾€å¾ˆéš¾åˆ†æ¸…æ¥šï¼Œåˆ°åº•æ˜¯å®¢æˆ·ç«¯å¸Œæœ›å¿½ç•¥è¿™ä¸ªå­—æ®µè¿˜æ˜¯æœ‰æ„ä¼ äº†nullï¼Œå› æ­¤æˆ‘ä»¬å°è¯•ç”¨Optional<t>ç±»æ¥åŒºåˆ†nullçš„å®šä½ã€‚åŒæ—¶ï¼Œä¸ºé¿å…æŠŠç©ºå€¼æ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œå¯ä»¥å®ç°åŠ¨æ€SQLï¼Œåªæ›´æ–°å¿…è¦çš„å­—æ®µã€‚</t></p><p>æœ€åï¼Œæˆ‘åˆ†äº«äº†æ•°æ®åº“å­—æ®µä½¿ç”¨NULLå¯èƒ½ä¼šå¸¦æ¥çš„ä¸‰ä¸ªå‘ï¼ˆåŒ…æ‹¬sumå‡½æ•°ã€countå‡½æ•°ï¼Œä»¥åŠNULLå€¼æ¡ä»¶ï¼‰ï¼Œä»¥åŠè§£å†³æ–¹å¼ã€‚</p><p>æ€»ç»“æ¥è®²ï¼Œnullçš„æ­£ç¡®å¤„ç†ä»¥åŠé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œç»ä¸æ˜¯åˆ¤ç©ºè¿™ä¹ˆç®€å•ï¼Œè¿˜è¦æ ¹æ®ä¸šåŠ¡å±æ€§ä»å‰åˆ°åä»”ç»†è€ƒè™‘ï¼Œå®¢æˆ·ç«¯ä¼ å…¥çš„nullä»£è¡¨äº†ä»€ä¹ˆï¼Œå‡ºç°äº†nullæ˜¯å¦å…è®¸ä½¿ç”¨é»˜è®¤å€¼æ›¿ä»£ï¼Œå…¥åº“çš„æ—¶å€™åº”è¯¥ä¼ å…¥nullè¿˜æ˜¯ç©ºå€¼ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªé€»è¾‘å¤„ç†çš„ä¸€è‡´æ€§ï¼Œæ‰èƒ½å°½é‡é¿å…Bugã€‚</p><p>ä¸ºå¤„ç†å¥½nullï¼Œä½œä¸ºå®¢æˆ·ç«¯çš„å¼€å‘è€…ï¼Œéœ€è¦å’ŒæœåŠ¡ç«¯å¯¹é½å­—æ®µnullçš„å«ä¹‰ä»¥åŠé™çº§é€»è¾‘ï¼›è€Œä½œä¸ºæœåŠ¡ç«¯çš„å¼€å‘è€…ï¼Œéœ€è¦å¯¹å…¥å‚è¿›è¡Œå‰ç½®åˆ¤æ–­ï¼Œæå‰æŒ¡æ‰æœåŠ¡ç«¯ä¸å¯æ¥å—çš„ç©ºå€¼ï¼ŒåŒæ—¶åœ¨æ•´ä¸ªä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­è¿›è¡Œå®Œå–„çš„ç©ºå€¼å¤„ç†ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>ConcurrentHashMapçš„Keyå’ŒValueéƒ½ä¸èƒ½ä¸ºnullï¼Œè€ŒHashMapå´å¯ä»¥ï¼Œä½ çŸ¥é“è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ä»€ä¹ˆå—ï¼ŸTreeMapã€Hashtableç­‰Mapçš„Keyå’ŒValueæ˜¯å¦æ”¯æŒnullå‘¢ï¼Ÿ</li>\n<li>å¯¹äºHibernateæ¡†æ¶å¯ä»¥ä½¿ç”¨@DynamicUpdateæ³¨è§£å®ç°å­—æ®µçš„åŠ¨æ€æ›´æ–°ï¼Œå¯¹äºMyBatisæ¡†æ¶å¦‚ä½•å®ç°ç±»ä¼¼çš„åŠ¨æ€SQLåŠŸèƒ½ï¼Œå®ç°æ’å…¥å’Œä¿®æ”¹SQLåªåŒ…å«POJOä¸­çš„éç©ºå­—æ®µï¼Ÿ</li>\n</ol><p>å…³äºç¨‹åºå’Œæ•°æ®åº“ä¸­çš„nullã€ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œä½ è¿˜é‡åˆ°è¿‡ä»€ä¹ˆå‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"10 | é›†åˆç±»ï¼šå‘æ»¡åœ°çš„Liståˆ—è¡¨æ“ä½œ","id":216778},"right":{"article_title":"12 | å¼‚å¸¸å¤„ç†ï¼šåˆ«è®©è‡ªå·±åœ¨å‡ºé—®é¢˜çš„æ—¶å€™å˜ä¸ºçå­","id":220230}},"comments":[{"had_liked":false,"id":201496,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1585795776,"is_pvip":true,"replies":[{"id":"75375","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":201496,"uid":"1001470","ip_address":"","utype":1,"ctime":1585797794,"user_name_real":"æœ±æ™”"}],"discussion_count":10,"race_medal":0,"score":"276463702720","product_id":100047701,"comment_content":"è¡¥å……ä¸‹ï¼šåœ¨MySQLçš„ä½¿ç”¨ä¸­ï¼Œå¯¹äºç´¢å¼•åˆ—ï¼Œå»ºè®®éƒ½è®¾ç½®ä¸ºnot nullï¼Œå› ä¸ºå¦‚æœæœ‰nullçš„è¯ï¼ŒMySQLéœ€è¦å•ç‹¬ä¸“é—¨å¤„ç†nullå€¼ï¼Œä¼šé¢å¤–è€—è´¹æ€§èƒ½ã€‚<br>å›ç­”ä¸‹é—®é¢˜ï¼š<br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<br>ä»ConcurrentHashMapä»–è‡ªå·±çš„ä½œè€…ï¼ˆDoug Leaï¼‰ï¼š<br><br>http:&#47;&#47;cs.oswego.edu&#47;pipermail&#47;concurrency-interest&#47;2006-May&#47;002485.html<br><br>The main reason that nulls aren&#39;t allowed in ConcurrentMaps<br>(ConcurrentHashMaps, ConcurrentSkipListMaps) is that<br>ambiguities that may be just barely tolerable in non-concurrent<br>maps can&#39;t be accommodated. The main one is that if<br>map.get(key) returns null, you can&#39;t detect whether the<br>key explicitly maps to null vs the key isn&#39;t mapped.<br>In a non-concurrent map, you can check this via map.contains(key),<br>but in a concurrent one, the map might have changed between calls.<br><br>ConcurrentMapsï¼ˆConcurrentHashMapsï¼ŒConcurrentSkipListMapsï¼‰ä¸å…è®¸ä½¿ç”¨nullçš„ä¸»è¦åŸå› æ˜¯ï¼Œæ— æ³•å®¹çº³åœ¨éå¹¶è¡Œæ˜ å°„ä¸­å‡ ä¹æ— æ³•å®¹å¿çš„æ­§ä¹‰ã€‚æœ€ä¸»è¦çš„æ˜¯ï¼Œå¦‚æœmap.get(key)return nullï¼Œåˆ™æ— æ³•æ£€æµ‹åˆ°è¯¥é”®æ˜¯å¦æ˜¾å¼æ˜ å°„åˆ°nullè¯¥é”®ã€‚åœ¨éå¹¶è¡Œæ˜ å°„ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿›è¡Œæ£€æŸ¥ map.contains(key)ï¼Œä½†åœ¨å¹¶è¡Œæ˜ å°„ä¸­ï¼Œä¸¤æ¬¡è°ƒç”¨ä¹‹é—´çš„æ˜ å°„å¯èƒ½å·²æ›´æ”¹ã€‚<br><br>hashtableä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯keyå’Œvalueä¹Ÿæ˜¯ä¸å¯ä»¥nullçš„<br>treeMap çº¿ç¨‹ä¸å®‰å…¨ï¼Œä½†æ˜¯å› ä¸ºéœ€è¦æ’åºï¼Œè¿›è¡Œkeyçš„compareToæ–¹æ³•ï¼Œæ‰€ä»¥keyæ˜¯ä¸èƒ½nullä¸­ï¼Œvalueæ˜¯å¯ä»¥çš„<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼š<br>MyBatis @Columnæ³¨è§£çš„updateIfNullå±æ€§ï¼Œå¯ä»¥æ§åˆ¶ï¼Œå½“å¯¹åº”çš„åˆ—valueä¸ºnullæ—¶ï¼ŒupdateIfNullçš„trueå’Œfalseå¯ä»¥æ§åˆ¶","like_count":64,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490353,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585797794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1589989,"avatar":"https://static001.geekbang.org/account/avatar/00/18/42/e5/61cfe267.jpg","nickname":"Eclipse","note":"","ucode":"E7EB0BA99FA644","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266033,"discussion_content":"æ€€ç–‘ä½ æ˜¯è€å¸ˆçš„å°å·ï¼Œæ¯æ¬¡éƒ½è¿™ä¹ˆä¼˜ç§€","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589466729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"éƒ­è•¾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228927,"discussion_content":"å­¦ä¹ åˆ°äº†ï¼Œè¿™ä¸ªç•™è¨€éƒ½èƒ½å€¼å›ç¥¨ä»·","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586591135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"éƒ­è•¾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"discussion":{"id":229775,"discussion_content":"è¿˜éœ€è¦åœ¨æå®¢æ—¶é—´å¤šå¤šå­¦ä¹ ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586689562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":228927,"ip_address":""},"score":229775,"extra":""}]},{"author":{"id":1396147,"avatar":"https://static001.geekbang.org/account/avatar/00/15/4d/b3/85828cc4.jpg","nickname":"f","note":"","ucode":"686BD6C21FE02B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220350,"discussion_content":"ç‚¹ç›ä¹‹ç¬”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585855020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1396147,"avatar":"https://static001.geekbang.org/account/avatar/00/15/4d/b3/85828cc4.jpg","nickname":"f","note":"","ucode":"686BD6C21FE02B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220743,"discussion_content":"è°¢è°¢ï¼Œå¤§å®¶ä¸€èµ·è·Ÿç€è€å¸ˆè¿›æ­¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585922555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":220350,"ip_address":""},"score":220743,"extra":""}]},{"author":{"id":1750549,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b6/15/e2cfd10d.jpg","nickname":"ImYoursÂ°","note":"","ucode":"51F653129034C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375771,"discussion_content":"å¤šå…°å“¥ï¼ŒğŸ‚ğŸº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621845999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1992424,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep3sqfTQey7eKYgGibLnAvaNj9k8gVvIYKVADicOA3DxmXZcDrAkeM8iaJLruiblmEVUr3q2LOVLvYicTw/132","nickname":"éƒ‘å…ˆç”Ÿ","note":"","ucode":"AA0BA751C4F132","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281521,"discussion_content":"mybatisä½¿ç”¨åŠ¨æ€sqlåº”è¯¥ä¹Ÿèƒ½å®ç°è€å¸ˆè¯´çš„é‚£ç§å§ï¼Œæ³¨è§£æ²¡ç”¨è¿‡^~^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591758475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1012361,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","nickname":"yihang","note":"","ucode":"A5506F085D1793","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236415,"discussion_content":"@Darren mybatis é‡Œæ²¡æœ‰ @Column æ³¨è§£å•Šï¼Œä½ æ˜¯ç”¨äº†ç¬¬ä¸‰æ–¹åŒ…å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587091982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1012361,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","nickname":"yihang","note":"","ucode":"A5506F085D1793","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236536,"discussion_content":"https://wz2cool.gitbooks.io/mybatis-dynamic-query-zh-cn/content/column.html\n\ndynamic query åº”è¯¥æ˜¯è¿™ä¸ª","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1587100975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":236415,"ip_address":""},"score":236536,"extra":""}]}]},{"had_liked":false,"id":202186,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1585918469,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"100370166277","product_id":100047701,"comment_content":"ä»Šå¤©æœ€å¤§çš„æƒŠå–œå°±æ˜¯arthasï¼Œä»¥å‰å¬è¯´è¿‡ï¼Œä½†æ˜¯ä»æ¥æ²¡ä½¿ç”¨è¿‡ï¼ŒçœŸå¿ƒç¥å™¨ï¼Œæ„Ÿè°¢ï¼Œæ„Ÿè°¢ï¼ï¼ï¼","like_count":24},{"had_liked":false,"id":207067,"user_name":"Asha","can_delete":false,"product_type":"c1","uid":1796527,"ip_address":"","ucode":"69F227707A9EDD","user_header":"https://static001.geekbang.org/account/avatar/00/1b/69/af/ceb4450c.jpg","comment_is_top":false,"comment_ctime":1587002310,"is_pvip":false,"replies":[{"id":"77376","content":"æ–‡ä¸­æœ‰è¯´ã€ç”±äº DTO ä¸­å·²ç»å·§å¦™ä½¿ç”¨äº† Optional æ¥åŒºåˆ†å®¢æˆ·ç«¯ä¸ä¼ å€¼å’Œä¼  null å€¼ï¼Œé‚£ä¹ˆä¸šåŠ¡é€»è¾‘å®ç°ä¸Šå°±å¯ä»¥æŒ‰ç…§å®¢æˆ·ç«¯çš„æ„å›¾æ¥åˆ†åˆ«å®ç°é€»è¾‘ã€‚å¦‚æœä¸ä¼ å€¼ï¼Œé‚£ä¹ˆ Optional æœ¬èº«ä¸º nullï¼Œç›´æ¥è·³è¿‡ Entity å­—æ®µçš„æ›´æ–°å³å¯ï¼Œè¿™æ ·åŠ¨æ€ç”Ÿæˆçš„ SQL å°±ä¸ä¼šåŒ…å«è¿™ä¸ªåˆ—ï¼›å¦‚æœä¼ äº†å€¼ï¼Œé‚£ä¹ˆè¿›ä¸€æ­¥åˆ¤æ–­ä¼ çš„æ˜¯ä¸æ˜¯ nullã€<br><br>ä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ŒJSONä¸ä¼ è¿™ä¸ªå±æ€§ï¼ŒOptionalç›´æ¥æ˜¯nullï¼Œå¦‚æœä¼ äº†å±æ€§å€¼ä¸ºnullï¼Œé‚£ä¹ˆOptionalå…¶å®å°±æ˜¯Optional.emptyï¼ˆå†…éƒ¨valueä¸ºnullï¼‰å¯ä»¥èµ°åˆ°orElseé€»è¾‘<br><br>ObjectMapper objectMapper = new ObjectMapper();<br>        objectMapper.registerModule(new Jdk8Module());<br>        UserDto result = objectMapper.readValue(&quot;{\\&quot;id\\&quot;:\\&quot;1\\&quot;, \\&quot;age\\&quot;:30, \\&quot;name\\&quot;:null}&quot;,UserDto.class);<br>        log.info(&quot;field name with null value dto:{} name:{}&quot;, result, result.getName().orElse(&quot;N&#47;A&quot;));<br>        &#47;&#47;field name with null value dto:UserDto(id=1, name=Optional.empty, age=Optional[30]) name:N&#47;A<br>        log.info(&quot;missing field name dto:{}&quot;,objectMapper.readValue(&quot;{\\&quot;id\\&quot;:\\&quot;1\\&quot;, \\&quot;age\\&quot;:30}&quot;,UserDto.class));<br>        &#47;&#47; missing field name dto:UserDto(id=1, name=null, age=Optional[30])","user_name":"ä½œè€…å›å¤","comment_id":207067,"uid":"1001470","ip_address":"","utype":1,"ctime":1587012207,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"53126609862","product_id":100047701,"comment_content":"è€å¸ˆï¼Œéº»çƒ¦é—®ä¸‹<br>UserDto ä¸­åªä¿ç•™ idã€name å’Œ age ä¸‰ä¸ªå±æ€§ï¼Œä¸” name å’Œ age ä½¿ç”¨ Optional æ¥åŒ…è£…ï¼Œä»¥åŒºåˆ†å®¢æˆ·ç«¯ä¸ä¼ æ•°æ®è¿˜æ˜¯æ•…æ„ä¼  nullï¼Œ è¿™ä¸ªæˆ‘ä¸å¤ªæ˜ç™½æ˜¯æ€ä¹ˆåŒºåˆ†å‡ºæ¥çš„å‘¢ï¼Ÿ<br>è¿˜æœ‰ä¸‹é¢çš„è¿™å¥è¯ï¼Œä»–èƒ½èµ°åˆ°orElseä¸Šå—ï¼Ÿ<br>if (user.getName() != null) { userEntity.setName(user.getName().orElse(&quot;&quot;)); }","like_count":12,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491999,"discussion_content":"æ–‡ä¸­æœ‰è¯´ã€ç”±äº DTO ä¸­å·²ç»å·§å¦™ä½¿ç”¨äº† Optional æ¥åŒºåˆ†å®¢æˆ·ç«¯ä¸ä¼ å€¼å’Œä¼  null å€¼ï¼Œé‚£ä¹ˆä¸šåŠ¡é€»è¾‘å®ç°ä¸Šå°±å¯ä»¥æŒ‰ç…§å®¢æˆ·ç«¯çš„æ„å›¾æ¥åˆ†åˆ«å®ç°é€»è¾‘ã€‚å¦‚æœä¸ä¼ å€¼ï¼Œé‚£ä¹ˆ Optional æœ¬èº«ä¸º nullï¼Œç›´æ¥è·³è¿‡ Entity å­—æ®µçš„æ›´æ–°å³å¯ï¼Œè¿™æ ·åŠ¨æ€ç”Ÿæˆçš„ SQL å°±ä¸ä¼šåŒ…å«è¿™ä¸ªåˆ—ï¼›å¦‚æœä¼ äº†å€¼ï¼Œé‚£ä¹ˆè¿›ä¸€æ­¥åˆ¤æ–­ä¼ çš„æ˜¯ä¸æ˜¯ nullã€\n\nä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ŒJSONä¸ä¼ è¿™ä¸ªå±æ€§ï¼ŒOptionalç›´æ¥æ˜¯nullï¼Œå¦‚æœä¼ äº†å±æ€§å€¼ä¸ºnullï¼Œé‚£ä¹ˆOptionalå…¶å®å°±æ˜¯Optional.emptyï¼ˆå†…éƒ¨valueä¸ºnullï¼‰å¯ä»¥èµ°åˆ°orElseé€»è¾‘\n\nObjectMapper objectMapper = new ObjectMapper();\n        objectMapper.registerModule(new Jdk8Module());\n        UserDto result = objectMapper.readValue(&amp;quot;{\\&amp;quot;id\\&amp;quot;:\\&amp;quot;1\\&amp;quot;, \\&amp;quot;age\\&amp;quot;:30, \\&amp;quot;name\\&amp;quot;:null}&amp;quot;,UserDto.class);\n        log.info(&amp;quot;field name with null value dto:{} name:{}&amp;quot;, result, result.getName().orElse(&amp;quot;N/A&amp;quot;));\n        //field name with null value dto:UserDto(id=1, name=Optional.empty, age=Optional[30]) name:N/A\n        log.info(&amp;quot;missing field name dto:{}&amp;quot;,objectMapper.readValue(&amp;quot;{\\&amp;quot;id\\&amp;quot;:\\&amp;quot;1\\&amp;quot;, \\&amp;quot;age\\&amp;quot;:30}&amp;quot;,UserDto.class));\n        // missing field name dto:UserDto(id=1, name=null, age=Optional[30])","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587012207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291703,"discussion_content":"{ &#34;id&#34;:1, &#34;name&#34;:null}  name ç›´æ¥ä¼ é€’null,ä¸ºOptional.empty; è€Œageæ²¡æœ‰ä¼ é€’åˆ™ä¸ºnull\nå¯ä»¥debugä¸€ä¸‹!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594911696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201475,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1585793011,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48830433267","product_id":100047701,"comment_content":"ç¬¬äºŒä¸ªé—®é¢˜ï¼Œmybatis å¯ä»¥ä½¿ç”¨ if æ ‡ç­¾æ¥åˆ¤æ–­å±æ€§æ˜¯å¦ä¸º null ä»è€ŒåŠ¨æ€ç”Ÿæˆä¸å«è¯¥å±æ€§çš„ sqlã€‚","like_count":11},{"had_liked":false,"id":201452,"user_name":"å¤±ç«çš„å¤å¤©","can_delete":false,"product_type":"c1","uid":1241770,"ip_address":"","ucode":"10C6E66EB2A65F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","comment_is_top":false,"comment_ctime":1585790088,"is_pvip":false,"replies":[{"id":"75356","content":"Keyä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæ­¤å¤–ï¼Œæˆ‘ä¹Ÿæ›´åŒæ„ä»–çš„è§‚ç‚¹ï¼Œå°±æ˜¯æ™®é€šçš„Mapå…è®¸nullæ˜¯å¦æ˜¯ä¸€ä¸ªæ­£ç¡®çš„åšæ³•ä¹Ÿæ˜¯å€¼å¾—å•†æ¦·çš„ï¼Œä¼šå¢åŠ çŠ¯é”™çš„å¯èƒ½<br><br>ä¸€ä¸ªæ›´å¥½çš„ç±»åº“å’Œæ¡†æ¶å¹¶ä¸æ˜¯æŠŠæœ€ä½³å®è·µå†™åœ¨æ–‡æ¡£ä¸­ï¼Œè€Œæ˜¯ç›´æ¥ç¼–ç åœ¨å®ç°ä¸­","user_name":"ä½œè€…å›å¤","comment_id":201452,"uid":"1001470","ip_address":"","utype":1,"ctime":1585791370,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"48830430344","product_id":100047701,"comment_content":"ConcurrentHashMap çš„ Key å’Œ Value éƒ½ä¸èƒ½ä¸º nullï¼Œè€Œ HashMap å´å¯ä»¥ã€‚<br><br>ConcurrentHashMapè¿™ä¸ªè€çˆ·å­åªè¯´äº†valueå¦‚æœæ˜¯ç©ºï¼Œä¼šæœ‰äºŒä¹‰æ€§ã€‚å°±æ˜¯åœ¨çº¿ç¨‹å®‰å…¨æƒ…å†µä¸‹ï¼Œä»–åˆ°åº•æ˜¯è®¾ç½®äº†ä¸€ä¸ªnullè¿˜æ˜¯æ ¹æœ¬å°±æ²¡è¿™ç©æ„ï¼Œkeyä»–è€äººå®¶æ²¡è¯´ã€‚ã€‚ã€‚è€å¸ˆå¯ä»¥è¯´ä¸‹ç†è§£å—ï¼Ÿ<br><br>TreeMapçš„Keyä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºTreeMapæ˜¯åŸºäºcompareçš„ï¼Œç©ºå€¼ä¸èƒ½compareã€‚valueå¯ä»¥ä¸ºç©ºï¼ŒTreeMapå¹¶ä¸çº¿ç¨‹å®‰å…¨ã€‚Hashtable çš„ Key å’Œ Valueä¹Ÿä¸èƒ½ç©ºï¼Œæˆ‘æƒ³åŸç†åº”è¯¥å’ŒConcurrentHashMapä¸€æ ·ã€‚","like_count":11,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490339,"discussion_content":"Keyä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæ­¤å¤–ï¼Œæˆ‘ä¹Ÿæ›´åŒæ„ä»–çš„è§‚ç‚¹ï¼Œå°±æ˜¯æ™®é€šçš„Mapå…è®¸nullæ˜¯å¦æ˜¯ä¸€ä¸ªæ­£ç¡®çš„åšæ³•ä¹Ÿæ˜¯å€¼å¾—å•†æ¦·çš„ï¼Œä¼šå¢åŠ çŠ¯é”™çš„å¯èƒ½\n\nä¸€ä¸ªæ›´å¥½çš„ç±»åº“å’Œæ¡†æ¶å¹¶ä¸æ˜¯æŠŠæœ€ä½³å®è·µå†™åœ¨æ–‡æ¡£ä¸­ï¼Œè€Œæ˜¯ç›´æ¥ç¼–ç åœ¨å®ç°ä¸­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585791370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132448,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/a0/f12115b7.jpg","nickname":"Sam.å¼ æœ","note":"","ucode":"FB20554D94B250","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283983,"discussion_content":"å¾ˆå¤šæ¡†æ¶ï¼Œå»ç¼ºå°‘æœ€ä½³å®è·µçš„æ–‡æ¡£ï¼Œæ¯”å¦‚quartz","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592409284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201711,"user_name":"Jerry Wu","can_delete":false,"product_type":"c1","uid":1203567,"ip_address":"","ucode":"AD29B6942AAAA6","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","comment_is_top":false,"comment_ctime":1585823081,"is_pvip":false,"replies":[{"id":"75412","content":"ä¹Ÿå¯¹","user_name":"ä½œè€…å›å¤","comment_id":201711,"uid":"1001470","ip_address":"","utype":1,"ctime":1585834859,"user_name_real":"æœ±æ™”"}],"discussion_count":16,"race_medal":0,"score":"35945561449","product_id":100047701,"comment_content":"è¿™æ˜¯æˆ‘ä¸ªäººçš„ä¸€äº›å·¥ä½œç»å†ã€‚<br><br>ä»¥å‰å°è¯•è¿‡Optionalï¼Œä½†å…¶ä»–äººåé¦ˆçœ‹ä¸æ‡‚ï¼Œæœ€åè¿˜æ˜¯æ¢å›äº†if-elseã€‚<br><br>å¾—å‡ºç»“è®ºï¼ŒæŠ€æœ¯è¦è€ƒè™‘å›¢é˜Ÿçš„æ¥å—ç¨‹åº¦ã€‚<br><br>æ–°æŠ€æœ¯ã€æ–°ç‰¹æ€§è™½å¥½ï¼Œä½†å›¢é˜Ÿæ¯ä¸ªäººçš„èƒ½åŠ›ä¸åŒï¼Œè€Œå†³å®šæŠ€æœ¯èµ°å‘çš„ï¼Œæ˜¯å›¢é˜Ÿæœ€å¼±çš„é‚£ä¸ªäººã€‚","like_count":8,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490401,"discussion_content":"ä¹Ÿå¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585834859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249636,"discussion_content":"è€Œå†³å®šæŠ€æœ¯èµ°å‘çš„ï¼Œæ˜¯å›¢é˜Ÿæœ€å¼±çš„é‚£ä¸ªäººã€‚\nâ€”â€”æœ‰æ²¡æœ‰æé”™ï¼Ÿè¿™æ˜æ˜æ˜¯ä½ æ— åº•çº¿å¦¥åçš„ç»“æœï¼æŒ‰ä½ çš„è§‚ç‚¹ï¼Œå¤§å®¶éƒ½ä¸åº”è¯¥åŠªåŠ›æé«˜æŠ€æœ¯èƒ½åŠ›ï¼Œåæ­£è¦ä»¥æœ€å·®çš„ä¸ºåŸºå‡†ï¼Œæˆ‘æœ€å·®æˆ‘æœ€ç¬¨æ‰€ä»¥æ•´ä¸ªå›¢é˜Ÿå°±åº”è¯¥å°†å°±æˆ‘ï¼è¿™ä¸æ˜¯åŠ£å¸é©±é€è‰¯å¸æ˜¯ä»€ä¹ˆï¼Ÿï¼","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1587949959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1203567,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","nickname":"Jerry Wu","note":"","ucode":"AD29B6942AAAA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249863,"discussion_content":"é‚£ä¸ªæ˜¯è€æ¿ï¼Œæœ‰äº›å…¬å¸ä¸é€‚åˆç•™å¤ªä¹…ï¼Œç¦»å¼€æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587968448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":249636,"ip_address":""},"score":249863,"extra":""},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1203567,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","nickname":"Jerry Wu","note":"","ucode":"AD29B6942AAAA6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291704,"discussion_content":"å…¬å¸å¾ˆå¤šè€å‘˜å·¥...java8æ–°ç‰¹æ€§éƒ½çœ‹ä¸æ‡‚...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594911895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":249863,"ip_address":""},"score":291704,"extra":""}]},{"author":{"id":1162714,"avatar":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","nickname":"çœ‹ä¸åˆ°deé¢œè‰²","note":"","ucode":"88348CCAE81931","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228914,"discussion_content":"æ˜¯æ—¶å€™æ¢æ³¢é˜Ÿå‹äº†ã€‚ç”¨äº†java8çš„ç‰¹æ€§åçœŸçš„å›ä¸å»äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586589041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","nickname":"Michael","note":"","ucode":"C233DF1D224EC1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226499,"discussion_content":"å¤ªæœ‰æ„Ÿè§¦äº†ï¼Œæˆ‘ç”¨ä¸ªJava8çš„æµéƒ½å› ä¸ºä¸Šè¿°ç†ç”±è¢«å–·äº†ä¸€é¡¿","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586435223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211223,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","nickname":"QQæ€ª","note":"","ucode":"1A39B8433D9208","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225674,"discussion_content":"æ„ŸåŒèº«å—å•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586391721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1206187,"avatar":"https://static001.geekbang.org/account/avatar/00/12/67/ab/fcf0cec4.jpg","nickname":"å¯’å…‰","note":"","ucode":"061BE413595F21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360439,"discussion_content":"è¿™æ ·çš„å›¢é˜Ÿï¼Œèµ¶ç´§ç¦»å¼€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616453954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307837,"discussion_content":"ä¸èƒ½å­¦å—ï¼Ÿæœ‰é‚£ä¹ˆéš¾å—ï¼Ÿéš¾é“ä¸æ˜¯å¤§å®¶ä¸€èµ·è¿›æ­¥ï¼Œå˜æˆå¤§å®¶ä¸€èµ·é€€æ­¥ã€ã€ã€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600768956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1203567,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","nickname":"Jerry Wu","note":"","ucode":"AD29B6942AAAA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307873,"discussion_content":"ä¸èƒ½ã€‚\n\nç¯å¢ƒå¾ˆé‡è¦ã€‚åˆ·çŸ¥ä¹è´´å§çš„å¿«ä¹ï¼Œæ¯”å­¦ä¹ è¿›æ­¥æ¥å¾—å¿«ã€‚\n\næˆ‘è¿ç»­ä¸¤å®¶å…¬å¸éƒ½æ˜¯è¿™æ ·ã€‚ä½ æŠ€æœ¯å¥½ã€å­¦ä¹ èƒ½åŠ›å¼ºï¼Œç»™çš„å·¥ä½œæœ€å¤šï¼Œå…¶ä»–äººåè€Œç”©èµ·æ‰‹æ¥ï¼Œæ•´å¤©åˆ·è´´å§çŸ¥ä¹ã€‚\n\næœ€åï¼Œè¦ä¸ä½ ä¹Ÿæ­»æ°”æ²‰æ²‰ï¼Œè¦ä¸ç›´æ¥ç¦»å¼€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600777268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307837,"ip_address":""},"score":307873,"extra":""},{"author":{"id":2987951,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/yTn9elsxHxy5jMtOXFMT9gpxcWkS5Ym1DEI7g9XLrHzCt9son9KSnGynFJxUMQ530e3Ibb6baUiadSibF7Uib0ntQ/132","nickname":"Geek_704c8f","note":"","ucode":"91C52A1760C7DF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1203567,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","nickname":"Jerry Wu","note":"","ucode":"AD29B6942AAAA6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590672,"discussion_content":"å»å®¶å¤§å…¬å¸å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665994302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307873,"ip_address":"å¹¿ä¸œ"},"score":590672,"extra":""}]},{"author":{"id":1018182,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/46/0b7828a1.jpg","nickname":"å°èƒ¡å­","note":"","ucode":"79FEC6400D25DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302307,"discussion_content":"Java8çš„ç‰¹æ€§æ„Ÿè§‰éƒ½å–œæ¬¢ç”¨ï¼Œä½†æ˜¯Optionalæ€»æ„Ÿè§‰ç”¨çš„æ€ªæ€ªçš„ï¼Œæ˜¯æˆ‘æ‰“å¼€æ–¹å¼ä¸æ­£ç¡®å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598876284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1877862,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLu3MgZBAyyiavX2CMF2KRib791j3bBGiaQDzuQwBF2k6AKHANV2uTAAss2vVaeC7xcSYYD8vjmibRpTQ/132","nickname":"çºµä¸æœ½","note":"","ucode":"DB2CA2C46B2EF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1018182,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/46/0b7828a1.jpg","nickname":"å°èƒ¡å­","note":"","ucode":"79FEC6400D25DA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402149,"discussion_content":"è¿˜æ˜¯ä¸ç†Ÿï¼Œä»¥å‰æˆ‘ä¹Ÿè·Ÿä½ ä¸€æ ·çš„æ„Ÿè§‰ï¼Œç”šè‡³æ„Ÿè§‰è¿™ç©æ„å°±æ˜¯é¸¡è‚‹ï¼Œçœ‹äº†å‡ ç« ä¸‹æ¥ï¼Œè§‰å¾—getåˆ°äº†ç”¨å¤„äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633795460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302307,"ip_address":""},"score":402149,"extra":""}]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":232089,"discussion_content":"åé¦ˆçœ‹ä¸æ‡‚ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586852154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1227789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","nickname":"ğŸ‘»","note":"","ucode":"1648C82AC73C1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228862,"discussion_content":"è¿™é˜Ÿå‹ä¹Ÿå¤ªèœäº†ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586584691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1203567,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","nickname":"Jerry Wu","note":"","ucode":"AD29B6942AAAA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1227789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","nickname":"ğŸ‘»","note":"","ucode":"1648C82AC73C1D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229078,"discussion_content":"æ²¡åŠæ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586607752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":228862,"ip_address":""},"score":229078,"extra":""}]}]},{"had_liked":false,"id":203835,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1586271548,"is_pvip":false,"discussion_count":4,"race_medal":1,"score":"31651042620","product_id":100047701,"comment_content":"è°¢è°¢è€å¸ˆã€‚å°ä¼™ä¼´ä»¬ï¼Œæˆ‘ä»¬è¿™è¾¹UserDtoéƒ½è¦æ±‚å†™æˆUserDTOï¼Œä½ ä»¬æ˜¯å“ªç§å‘¢","like_count":7,"discussions":[{"author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249638,"discussion_content":"UserDTOæ˜¯æ ‡å‡†çš„ï¼Œå›½é™…é€šç”¨","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1587950026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1877862,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLu3MgZBAyyiavX2CMF2KRib791j3bBGiaQDzuQwBF2k6AKHANV2uTAAss2vVaeC7xcSYYD8vjmibRpTQ/132","nickname":"çºµä¸æœ½","note":"","ucode":"DB2CA2C46B2EF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402150,"discussion_content":"è§„èŒƒå¥½ï¼ŒDtoçœ‹çš„å¤ªéš¾å—äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633795502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1451715,"avatar":"https://static001.geekbang.org/account/avatar/00/16/26/c3/bf93615e.jpg","nickname":"æ¶ˆé€çš„å°ç¡®å¹¸","note":"","ucode":"AB38614BC45799","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331514,"discussion_content":"DTOï¼ŒVOï¼ŒDO ç­‰è¿™äº›å®ä½“ç±»åçš„åç¼€å¤§å†™ï¼Œé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¹Ÿæ˜¯è¿™ä¹ˆè§„å®šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606892047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1052859,"avatar":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","nickname":"Demon.Lee","note":"","ucode":"7F0E5493A8E345","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1451715,"avatar":"https://static001.geekbang.org/account/avatar/00/16/26/c3/bf93615e.jpg","nickname":"æ¶ˆé€çš„å°ç¡®å¹¸","note":"","ucode":"AB38614BC45799","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331535,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606895111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":331514,"ip_address":""},"score":331535,"extra":""}]}]},{"had_liked":false,"id":201649,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1585816553,"is_pvip":false,"replies":[{"id":"75394","content":"å…¶å®ä¸»è¦æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„éº»çƒ¦ï¼ˆå…¼å®¹é—®é¢˜ï¼‰ï¼Œç°åœ¨ä½¿ç”¨spring boot + jacksonå·²ç»æ²¡é—®é¢˜äº†ï¼Œè‡ªåŠ¨å¼•å…¥äº†Jdk8Moduleï¼Œå¦‚æœä½ ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–æ¡†æ¶çš„è¯å¯èƒ½è¦è€ƒè™‘ä¸€ä¸‹è¿™ç§æ–¹å¼æ˜¯å¦é€‚åˆï¼å…¶å®å¾ˆå¤šæ—¶å€™æœ€ä½³å®è·µå‘¢ä¹Ÿæ˜¯éœ€è¦éšç€å˜è¿ä¸æ–­è°ƒæ•´çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":201649,"uid":"1001470","ip_address":"","utype":1,"ctime":1585819282,"user_name_real":"æœ±æ™”"}],"discussion_count":5,"race_medal":0,"score":"27355620329","product_id":100047701,"comment_content":"æœ‰ä¸ªè§„èŒƒæˆ‘è®°å¾—æ˜¯è¯´ï¼Œä¸è¦åœ¨å­—æ®µï¼Œæ–¹æ³•å‚æ•°ï¼Œé›†åˆä¸­ä½¿ç”¨Optional","like_count":6,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490390,"discussion_content":"å…¶å®ä¸»è¦æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„éº»çƒ¦ï¼ˆå…¼å®¹é—®é¢˜ï¼‰ï¼Œç°åœ¨ä½¿ç”¨spring boot + jacksonå·²ç»æ²¡é—®é¢˜äº†ï¼Œè‡ªåŠ¨å¼•å…¥äº†Jdk8Moduleï¼Œå¦‚æœä½ ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–æ¡†æ¶çš„è¯å¯èƒ½è¦è€ƒè™‘ä¸€ä¸‹è¿™ç§æ–¹å¼æ˜¯å¦é€‚åˆï¼å…¶å®å¾ˆå¤šæ—¶å€™æœ€ä½³å®è·µå‘¢ä¹Ÿæ˜¯éœ€è¦éšç€å˜è¿ä¸æ–­è°ƒæ•´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585819282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219889,"discussion_content":"https://stackoverflow.com/questions/31922866/why-should-java-8s-optional-not-be-used-in-arguments/31924845#31924845 è¿™ä¸€å—å„æ–¹ä¹Ÿåœ¨äº‰è®ºï¼Œé’ˆå¯¹æ–¹æ³•ä¼ å‚æˆ‘è§‰å¾—æš‚æ—¶è¿˜æ˜¯ä¸è¦ä½¿ç”¨Optionalæ¯”è¾ƒå¥½ï¼Œè¿”å›å€¼å¯ä»¥","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585821506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":219901,"discussion_content":"å—¯å—¯ï¼Œè¿™ç‚¹æˆ‘ä»¬èƒ½è¾¾æˆå…±è¯†ï¼Œæˆ‘æ˜¯è§‰å¾—dtoä¸­çš„å­—æ®µä¸è¦å£°æ˜ä¸ºOptionalï¼Œè¿™æ ·ç›¸å½“äºæŠŠä¸€ä¸ªä¸æ˜ç¡®çš„å­—æ®µä¼ æ¥ä¼ å»ï¼Œå°±åƒæˆ‘ä»¬å¸Œæœ›åœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶ç»™listèµ‹å€¼ç©ºlistï¼Œmapèµ‹å€¼ç©ºmapï¼Œstringç©ºä¸²ä¸€æ ·ï¼Œå°½é‡å‡å°‘nullå€¼çš„ä¼ é€’ï¼Œå¦‚æœæŠŠå­—æ®µç”¨Optionalä¼ é€’äº†ï¼Œæ„Ÿè§‰å°±èƒŒé“è€Œé©°äº†ã€‚ä»…ä»…æ˜¯ä¸ªäººæƒ³æ³•ï¼Œæ¬¢è¿äº¤æµï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585822428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":219889,"ip_address":""},"score":219901,"extra":""},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219903,"discussion_content":"æœ¬ä¾‹ä¸­çš„DTOå…¶å®åªæ˜¯ç”¨æ¥ååºåˆ—åŒ–ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç‚¹å»åº”ç”¨Optionalçš„ç‰¹æ€§ä¸é”™ï¼Œä¸ä¸€å®šæ˜¯æœ€ä½³å®è·µï¼Œè¿™ä¸ªå¯ä»¥è®¨è®ºã€‚è‡³äºå’Œå¤–éƒ¨äº¤äº’çš„æ¥å£DTOï¼Œä¸å»ºè®®ä½¿ç”¨Optionalã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585822704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":219901,"ip_address":""},"score":219903,"extra":""}]},{"author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219878,"discussion_content":"é™¤äº†åºåˆ—åŒ–å¤–ï¼Œè¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œä¸åº”è¯¥ è®©ä¸€ä¸ªä¸ç¡®å®šå€¼çš„å­—æ®µä¸€ç›´ä¼ é€’ï¼Œç¼ºå°‘æ˜ç¡®çš„è¯­ä¹‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585820249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247665,"user_name":"jacy","can_delete":false,"product_type":"c1","uid":1103456,"ip_address":"","ucode":"0022A8759DDCE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg","comment_is_top":false,"comment_ctime":1599789160,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"18779658344","product_id":100047701,"comment_content":"1ã€ä»¥å‰é‡åˆ°è¿‡å¥½å‡ æ¬¡nullå¼‚å¸¸ï¼Œéƒ½æ˜¯é€šè¿‡æ‰“æ—¥å¿—æå®šçš„ï¼Œååˆ†ä½æ•ˆï¼Œarthasæ˜¯ä¸ªå¥½å·¥å…·ï¼Œæ”¶è—äº†ã€‚<br>2ã€Optionalå¾ˆå°‘ç”¨ï¼Œç¡®å®æ˜¯ä¸ªå¥½ä¸œä¸œã€‚<br>3ã€mapæˆ‘è§‰å¾—éƒ½ä¸åº”è¯¥æ”¯æŒNullï¼Œéçº¿ç¨‹å®‰å…¨map getè¿”å›Nullæ—¶ï¼Œåˆ°åº•æ˜¯æ²¡æœ‰keyï¼Œè¿˜æ˜¯valueä¸ºNullæœ‰äºŒä¹‰æ€§ï¼ˆä½†å¯ä»¥é€šè¿‡æ¢æµ‹ç ´è§£äºŒä¹‰ï¼Œè¿™å¯èƒ½æ˜¯æ”¯æŒäº†Nullçš„åŸå› ï¼‰ï¼Œçº¿ç¨‹å®‰å…¨map æ¢æµ‹ç»“æœæœ¬èº«å°±ä¸å¯é ï¼ˆå¯èƒ½è¢«å¹¶å‘ä¿®æ”¹ï¼‰ï¼Œæ‰€ä»¥ä½œè€…é€‰åˆ™ä¸æ”¯æŒï¼Œåˆ—å¦‚ï¼š<br>B put key null   Bå¾€çº¿ç¨‹å®‰å…¨mapä¸­æ’å…¥å€¼ä¸ºnullçš„æ•°æ®<br>A contain key   Aæ¢æµ‹keyå­˜åœ¨<br>B remove key   Bç§»é™¤key<br>A get key         Aè·å–keyå¾—åˆ°nullï¼ŒAè®¤ä¸ºkeyçš„å€¼ä¸ºnullï¼Œå®é™…è¿”å›çš„nullå¹¶ékeyçš„å€¼","like_count":4},{"had_liked":false,"id":211484,"user_name":"ä¹¦æ—","can_delete":false,"product_type":"c1","uid":1064791,"ip_address":"","ucode":"28D3224E8CBB6B","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/57/a014199a.jpg","comment_is_top":false,"comment_ctime":1587971785,"is_pvip":false,"replies":[{"id":"78592","content":"ä½ è¯´çš„æ²¡é”™ï¼Œæˆ‘æ”¹ä¸€ä¸‹è¿™å¥è¯<br><br>The NULL value can be surprising until you get used to it. Conceptually, NULL means â€œa missing unknown valueâ€ and it is treated somewhat differently from other values. You cannot use arithmetic comparison operators such as =, &lt;, or &lt;&gt; to test for NULL. Because the result of any arithmetic comparison with NULL is also NULL, you cannot obtain any meaningful results from such comparisons.","user_name":"ä½œè€…å›å¤","comment_id":211484,"uid":"1001470","ip_address":"","utype":1,"ctime":1587978428,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14472873673","product_id":100047701,"comment_content":"å…³äºSQL åˆ¤æ–­ç©ºæœ‰ä¸€ç‚¹æƒ³æå‡ºæ¥è®¨è®ºï¼Œ=NULL ä¸æ˜¯èµ‹å€¼ç¡®å®æ˜¯åˆ¤æ–­ï¼Œåªæ˜¯NULLå’Œä»»ä½•å€¼çš„ç›´æ¥æ¯”è¾ƒéƒ½ä¸ºNULLï¼Œæ¯”å¦‚NULL&lt;&gt;NULL, NULL=NULL, NULL=1ç»“æœéƒ½ä¸ºNULLã€‚å¯¹ NULL è¿›è¡Œåˆ¤æ–­åªèƒ½ä½¿ç”¨ IS NULL æˆ–è€… IS NOT NULLï¼Œæˆ–è€…ISNULL()ã€‚","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493277,"discussion_content":"ä½ è¯´çš„æ²¡é”™ï¼Œæˆ‘æ”¹ä¸€ä¸‹è¿™å¥è¯\n\nThe NULL value can be surprising until you get used to it. Conceptually, NULL means â€œa missing unknown valueâ€ and it is treated somewhat differently from other values. You cannot use arithmetic comparison operators such as =, &amp;lt;, or &amp;lt;&amp;gt; to test for NULL. Because the result of any arithmetic comparison with NULL is also NULL, you cannot obtain any meaningful results from such comparisons.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587978428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207469,"user_name":"yihang","can_delete":false,"product_type":"c1","uid":1012361,"ip_address":"","ucode":"A5506F085D1793","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/89/1a83120a.jpg","comment_is_top":false,"comment_ctime":1587089954,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14471991842","product_id":100047701,"comment_content":"è§£å†³æ–¹æ¡ˆé‡Œï¼Œæˆ‘è§‰å¾—æ—¢ç„¶å…ˆæŸ¥äº†ä¸€æ¬¡å®ä½“ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨ @DynamicUpdate éƒ¨åˆ†æ›´æ–°å­—æ®µäº†å‘€ï¼Ÿè¿™æ—¶å…¨å­—æ®µæ›´æ–°ä¹Ÿæ²¡æœ‰é—®é¢˜çš„","like_count":3},{"had_liked":false,"id":204891,"user_name":"å¤§å¤§å¤§ç†Šmyeh","can_delete":false,"product_type":"c1","uid":1139413,"ip_address":"","ucode":"4832C2E7CEB151","user_header":"https://static001.geekbang.org/account/avatar/00/11/62/d5/1f5c5ab6.jpg","comment_is_top":false,"comment_ctime":1586487730,"is_pvip":false,"replies":[{"id":"76579","content":"æ˜ç¡® DTO ä¸­ null çš„å«ä¹‰ï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","comment_id":204891,"uid":"1001470","ip_address":"","utype":1,"ctime":1586494308,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14471389618","product_id":100047701,"comment_content":"åŸæ–‡ï¼šâ€œå½’æ ¹ç»“åº•ï¼Œè¿™æ˜¯å¦‚ä¸‹ 5 ä¸ªæ–¹é¢çš„é—®é¢˜ï¼šæ˜ç¡® DTO ç§ null çš„å«ä¹‰â€æˆ–è®¸æ˜¯â€œæ˜ç¡® DTOå„ç§ null çš„å«ä¹‰â€å§.<br><br>MySQLä¸­<br>count(1)é€‰å–æ¯ä¸€è¡Œå¹¶èµ‹å€¼ä¸º1ï¼Œè¿›è¡Œç»Ÿè®¡<br>count(*)é€‰å–æ¯ä¸€è¡Œè¿›è¡Œç»Ÿè®¡<br>count(å­—æ®µ)é€‰å–æ¯ä¸€è¡Œä¸­çš„è¯¥å­—æ®µï¼Œé€‰æ‹©ä¸ä¸ºnullçš„è¡Œè¿›è¡Œç»Ÿè®¡<br><br>æˆ‘è®¤ä¸ºOptionalå¯ä»¥ä»£æ›¿åŸæ¥çš„if-elseèµ‹å€¼ï¼Œä½¿ä»£ç çœ‹ä¸Šå»ç¨è®¸ç®€æ´ã€‚ä½†éœ€è¦æ³¨æ„å¦‚Optional.ofNullable(number).orElse(0)ï¼Œå½“numberä¸ºnullæ—¶ï¼Œè¿”å›çš„0ä¸ä¼šèµ‹å€¼ç»™numberï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°åœ°å€ï¼ˆå¯¹è±¡ï¼‰ã€‚<br><br>æ€è€ƒé¢˜1ï¼Œæ¥¼ä¸ŠDarrenè€å…„è¯´çš„å¾ˆå¯¹ã€‚æ›´åŠ ç™½è¯çš„è¯´æ˜â€œéå¹¶è¡Œæ˜ å°„ä¸­å‡ ä¹æ— æ³•å®¹å¿çš„æ­§ä¹‰â€å°±æ˜¯â€”â€”å¦‚æœmap.get(key)è¿”å›äº†nullï¼Œæ— æ³•æ˜ç¡®æ˜¯å› ä¸ºmapä¸­æ²¡æœ‰æ‰¾åˆ°è¯¥keyè¿”å›çš„nullï¼Œè¿˜æ˜¯å› ä¸ºè¯¥keyåŒ…å«çš„valueå°±æ˜¯nullã€‚<br><br>æ€è€ƒé¢˜2ï¼Œxmlé…ç½®æ–‡ä»¶ä¸­çš„ifæ ‡ç­¾&lt;if test=&quot;id!=null and id !=&#39;&#39;&quot;&gt;&lt;&#47;if&gt;éœ€è¦æ³¨æ„ifæ ‡ç­¾ä¸­çš„å­—æ®µidå¦‚æœæ˜¯Dateç±»å‹çš„è¯ï¼Œä¸è¦å†™id!=&#39;&#39;ï¼Œè¿™æ˜¯ç”±äºDataç±»å‹ä¸å­—ç¬¦ä¸²ç±»å‹è¿›è¡Œæ¯”è¾ƒçš„æŠ¥é”™ï¼Œæ­¤æ—¶åªéœ€å†™nullçš„åˆ¤æ–­å³å¯ã€‚<br><br>ä»¥å‰ä¸çŸ¥é“@Columnæ³¨è§£çš„updateIfNullå±æ€§ï¼Œå­¦åˆ°äº†ã€‚<br>","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491319,"discussion_content":"æ˜ç¡® DTO ä¸­ null çš„å«ä¹‰ï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586494308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201462,"user_name":"åˆ˜æ¥ ","can_delete":false,"product_type":"c1","uid":1120773,"ip_address":"","ucode":"9F19D44CBEE039","user_header":"https://static001.geekbang.org/account/avatar/00/11/1a/05/f154d134.jpg","comment_is_top":false,"comment_ctime":1585790930,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14470692818","product_id":100047701,"comment_content":"ConcurrentHashMap<br> final V putVal(K key, V value, boolean onlyIfAbsent) {<br>        if (key == null || value == null) throw new NullPointerException();<br>å› ä¸ºç›´æ¥å¯¹keyè¿›è¡Œäº†hashCode,è¦è¿›è¡Œæ¯”è¾ƒ<br><br>putæ–¹æ³•å¯¹keyå’Œvalueåšäº†åˆ¤æ–­çš„ï¼Œ<br><br>HashMap<br>keyï¼Œåªèƒ½æœ‰ä¸€ä¸ªkeyä¸ºnull,valueæ²¡é™åˆ¶ï¼Œ<br><br><br>TreeMap <br><br>keyä¹Ÿæ˜¯ä¸èƒ½ä¸ºèƒ½ä¸ºnullçš„,putæ–¹æ³•ä¸­è¦è°ƒç”¨comparatoræ–¹æ³•å»æ¯”è¾ƒkey<br>valueå¯ä»¥ä¸ºnull<br><br>Hashtable<br>key,valueéƒ½ä¸èƒ½ä¸ºnull<br>å› ä¸ºç›´æ¥å¯¹keyè¿›è¡Œäº†hashCode,åŒæ—¶å¯¹valueåšäº†åˆ¤æ–­ä¸ºnullç›´æ¥æŠ›å‡ºå¼‚å¸¸äº†","like_count":3},{"had_liked":false,"id":201413,"user_name":"ç»ˆç»“è€…999å·","can_delete":false,"product_type":"c1","uid":1055854,"ip_address":"","ucode":"33ADE61580B6DD","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","comment_is_top":false,"comment_ctime":1585785178,"is_pvip":true,"replies":[{"id":"75351","content":"æ˜¯","user_name":"ä½œè€…å›å¤","comment_id":201413,"uid":"1001470","ip_address":"","utype":1,"ctime":1585788657,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14470687066","product_id":100047701,"comment_content":"åœ¨å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œå¯¹äºDTOçš„å€¼éªŒè¯æ€§æ ¡éªŒä¹Ÿå¯ä»¥ä½¿ç”¨Hibernate Validatorï¼Œä¹Ÿå¯ä»¥æœç»ç”¨æˆ·ä¸æŒ‰æ¥å£æ–‡æ¡£ä¸­æ‰€å®šä¹‰çš„æ ¼å¼è¾“å…¥ï¼Œæ„Ÿè§‰ä¹Ÿå¯ä»¥ä½¿ç”¨","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490326,"discussion_content":"æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585788657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258708,"user_name":"Geek_Gary","can_delete":false,"product_type":"c1","uid":2059767,"ip_address":"","ucode":"3A477DD245D8DE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/VGh9ULc7y9ZzVp5aHQLb4J9qmQOAE4ibYHfeia1F8s08PwvhH9kKZ1wr91gTfTEnj0LtybegsFibPcceyTIkHJTcw/132","comment_is_top":false,"comment_ctime":1604541374,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5899508670","product_id":100047701,"comment_content":"Optionalè¿˜æœ‰è¿™ç§ç”¨æ³•ï¼Œè°¨å—æ•™ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","like_count":1},{"had_liked":false,"id":243958,"user_name":"Geek_fe5e8a","can_delete":false,"product_type":"c1","uid":2103563,"ip_address":"","ucode":"B4CC300397BD6A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/dgox0m94vr6w2Vxk0N6651pyL5wKWicqgwIxU9iahlIn5LKeFfQJDjzUoQKM8WNibS7Yuxyulmic1Xxfia5ibFc6ia0Hw/132","comment_is_top":false,"comment_ctime":1598340575,"is_pvip":false,"replies":[{"id":"89851","content":"æ„Ÿè°¢","user_name":"ä½œè€…å›å¤","comment_id":243958,"uid":"1001470","ip_address":"","utype":1,"ctime":1598352537,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5893307871","product_id":100047701,"comment_content":"è€å¸ˆè®²çš„çœŸçš„å¥½  æ»¡åˆ†","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504440,"discussion_content":"æ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598352537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241157,"user_name":"æå’Œæ¡ƒ","can_delete":false,"product_type":"c1","uid":1015877,"ip_address":"","ucode":"97E66953070EE0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/45/d719f7df.jpg","comment_is_top":false,"comment_ctime":1597204535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5892171831","product_id":100047701,"comment_content":"1ã€ConcurrentHashMapä¸èƒ½ä¸ºnullçš„åŸå› ä¸»è¦æ˜¯å› ä¸ºè€ƒè™‘åˆ°å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µã€‚åœ¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†ä¸‹ï¼Œå¦‚æœkey = null or value = nullï¼Œå¾ˆéš¾åˆ¤æ–­æ˜¯è®¾ç½®key=nullè¿˜æ˜¯keyæ ¹æœ¬ä¸å­˜åœ¨ã€‚HashMapæœ¬èº«å»ºè®®æ˜¯åœ¨å•çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œæ—¶ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®ä¸ºnullã€‚<br>TreeMapçš„keyæ˜¯ä¸å¯ä»¥ä¸ºnullçš„ï¼Œvalueå¯ä»¥æ˜¯nullã€‚ä¸ºäº†ä¿è¯æœ‰åºï¼Œtreemapä¸­çš„keyè¿˜éœ€è¦å®ç°comparatorçš„compareæ–¹æ³•ã€‚<br>HashTableçš„keyå’Œvalueéƒ½ä¸å¯ä»¥ä¸ºnullï¼Œè¿™ä¸ªåŸå› ä¸ªäººçŒœæµ‹ï¼Œç»§æ‰¿äº†å­—å…¸ç±»ï¼Œå­—å…¸é‡Œé¢æœ‰nullä¸åˆé€‚ã€‚HashMapå¯¹nullçš„å¤„ç†æ˜¯ä¸“é—¨ç»™äº†ä¸€ä¸ª0çš„æ§½ï¼Œè€Œä¸”è¿™ä¸ªæ§½åªä¼šæœ‰ä¸€ä¸ªentry.<br>2ã€é‡‡ç”¨if-testæ ‡ç­¾çš„æ–¹å¼ï¼Œå¯¹å­—æ®µè¿›è¡Œæ˜¯å¦ä¸ºnullçš„åˆ¤æ–­ã€‚","like_count":1},{"had_liked":false,"id":241056,"user_name":"2019","can_delete":false,"product_type":"c1","uid":1025580,"ip_address":"","ucode":"6514258263FC00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/2c/b73b9dfe.jpg","comment_is_top":false,"comment_ctime":1597161421,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5892128717","product_id":100047701,"comment_content":"æ‰“ä¸ªå¡å¡ã€‚é‚£ä¸ªè¯´å†™Java8æ–°ç‰¹æ•ˆè¢«å–·çš„ï¼Œä½ åŒäº‹é‚£æ˜¯å±äºä¸æƒ³è¿›æ­¥ã€‚è®©ä»–å¾…åœ¨èˆ’é€‚åŒºå¥½äº†ã€‚","like_count":1},{"had_liked":false,"id":208937,"user_name":"Seven.Linæ¾¤è€¿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1587467413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882434709","product_id":100047701,"comment_content":"å­¦ä¹ äº†ï¼Œoptionalè¿˜å¯ä»¥è¿™ä¹ˆç”¨ï¼ŒSpringMVCæ•°æ®ç»‘å®šä¹Ÿä¼šæ”¯æŒå—ï¼Ÿ","like_count":1},{"had_liked":false,"id":208757,"user_name":"yanghao","can_delete":false,"product_type":"c1","uid":1031387,"ip_address":"","ucode":"624261F3198739","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/db/ddfe411f.jpg","comment_is_top":false,"comment_ctime":1587433007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5882400303","product_id":100047701,"comment_content":"åŸæ¥ä¸€ç›´åœ¨å‘é‡Œï¼Œæœ€è¿‘é¡¹ç›®é‡Œå°±æ˜¯å„ç§åˆ¤ç©º","like_count":1},{"had_liked":false,"id":207484,"user_name":"å½­å‘çº¢","can_delete":false,"product_type":"c1","uid":1461374,"ip_address":"","ucode":"9BAC208700791E","user_header":"https://static001.geekbang.org/account/avatar/00/16/4c/7e/4771d8a4.jpg","comment_is_top":false,"comment_ctime":1587091651,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5882058947","product_id":100047701,"comment_content":"ä¸ªäººä¹ æƒ¯å¯¹äºæ•°æ®çš„éªŒè¯éƒ½ä¼šåœ¨æ§åˆ¶å±‚é€šè¿‡@Validatedæ¥å®ç°ç¬¬ä¸€é“ä¸šåŠ¡æ•°æ®éªŒè¯ï¼Œç„¶åå†é€šè¿‡Optional","like_count":1},{"had_liked":false,"id":205146,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1586543547,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881510843","product_id":100047701,"comment_content":"åŠæ—¶å‘ç°åŠæ—¶å¤„ç†æ—¥å¿—ç©ºæŒ‡é’ˆå¼‚å¸¸","like_count":1},{"had_liked":false,"id":202098,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1585902916,"is_pvip":false,"replies":[{"id":"75534","content":"Hashtableè™½ç„¶è¿™ç§å†™æ³•ä¸æ€ä¹ˆå¥½çœ‹ï¼Œä½†ç»“æœéƒ½æ˜¯ä¸€ä¸ªNullPointerExceptionï¼Œä½œè€…å¯èƒ½è§‰å¾—        int hash = key.hashCode();<br>ä¼šæŠ›ç©ºæŒ‡é’ˆå°±æ²¡å¿…è¦æå‰åˆ¤æ–­äº†å§","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585907540,"ip_address":"","comment_id":202098,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5880870212","product_id":100047701,"comment_content":"é—®é¢˜å¤§å®¶éƒ½ç­”çš„å¾ˆå¥½ï¼Œæˆ‘å°±ç›´æ¥é—®é—®é¢˜å§ã€‚<br>è€å¸ˆï¼ŒHashtableçš„putä¼šå¯¹valueåšnullåˆ¤æ–­ï¼Œkeyæ˜¯åœ¨è°ƒç”¨hashcodeæ–¹æ³•æ—¶æŠ¥ç©ºæŒ‡é’ˆï¼Œè€ŒConcurrentHashMapæ˜¯ç›´æ¥å¯¹keyå’Œvalueåšnullåˆ¤æ–­ï¼Œæ˜¯ä¸æ˜¯Hashtableçš„è®¾è®¡æœ‰é—®é¢˜ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490503,"discussion_content":"Hashtableè™½ç„¶è¿™ç§å†™æ³•ä¸æ€ä¹ˆå¥½çœ‹ï¼Œä½†ç»“æœéƒ½æ˜¯ä¸€ä¸ªNullPointerExceptionï¼Œä½œè€…å¯èƒ½è§‰å¾—        int hash = key.hashCode();\nä¼šæŠ›ç©ºæŒ‡é’ˆå°±æ²¡å¿…è¦æå‰åˆ¤æ–­äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585907540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350612,"user_name":"Geek_d3928c","can_delete":false,"product_type":"c1","uid":2450893,"ip_address":"","ucode":"7CB09FD1F7CB23","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/L8EpqHoAnmvkzCIsdOkv5QvhIzu5tMaF2FDusXShqukv5ZBkS8DbicWaErjnYydibiaqBrs70wQ8P6axvC2FbWpbQ/132","comment_is_top":false,"comment_ctime":1657037818,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657037818","product_id":100047701,"comment_content":"çº¿ä¸Šæœºå™¨ä¹Ÿä¸å…è®¸ä½¿ç”¨arthaså‘€","like_count":0},{"had_liked":false,"id":342532,"user_name":"èŠ±èŠ±å¤§è„¸çŒ«","can_delete":false,"product_type":"c1","uid":1117318,"ip_address":"","ucode":"8ABDB3F7F4FB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","comment_is_top":false,"comment_ctime":1650328537,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1650328537","product_id":100047701,"comment_content":"é«˜ç‰ˆæœ¬çš„jdkå¯¹äºnpeçš„æ”¯æŒä¸æç¤ºå·²ç»å¾ˆå‹å¥½äº†ï¼Œå…¶å®ä¸»è¦è¿˜æ˜¯å¯¹äºä»£ç ä¹¦å†™å¥å£®æ€§ä¸åˆç†æ€§çš„è€ƒè™‘ã€‚å¤§éƒ¨åˆ†å¼€å‘äººå‘˜å…¶å®è¿˜æ˜¯æ²¡æœ‰æ„è¯†åˆ°å¯¹äºnullçš„å¤„ç†ï¼Œåªæ˜¯é‡åˆ°äº†npeç„¶ååœ¨è¿›è¡Œè¡¥å……ã€‚","like_count":0},{"had_liked":false,"id":301697,"user_name":"æœ¨å‡ ä¸¶","can_delete":false,"product_type":"c1","uid":2420294,"ip_address":"","ucode":"FFDB958DA64F8C","user_header":"https://static001.geekbang.org/account/avatar/00/24/ee/46/7d65ae37.jpg","comment_is_top":false,"comment_ctime":1625816049,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"1625816049","product_id":100047701,"comment_content":"ConcurrentHashMapï¼ŒHashtableç­‰çº¿ç¨‹å®‰å…¨çš„é›†åˆkey valueä¸èƒ½ä¸ºnullï¼Œå› ä¸ºä¼šæœ‰äºŒä¹‰æ€§ï¼šgetæ—¶è¿”å›nullåˆ°åº•æ˜¯æ²¡æœ‰è¿˜æ˜¯å°±æ˜¯nullï¼Ÿä¸ºä»€ä¹ˆhashmapå¯ä»¥å‘¢ï¼Œå› ä¸ºå¯¹äºå•çº¿ç¨‹çš„é›†åˆå¯ä»¥ç”¨containsKeyè¾…åŠ©åˆ¤æ–­ï¼Œè€Œå¤šçº¿ç¨‹ä¸‹ç”¨containsKeyåˆ¤æ–­ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆgetå’ŒcontainsKeyä¹‹é—´æ’å…¥äº†putï¼‰","like_count":0}]}