{"id":72147,"title":"10 | 案例篇：系统的软中断CPU使用率升高，我该怎么办？","content":"<p>你好，我是倪朋飞。</p><p>上一期我给你讲了软中断的基本原理，我们先来简单复习下。</p><p>中断是一种异步的事件处理机制，用来提高系统的并发处理能力。中断事件发生，会触发执行中断处理程序，而中断处理程序被分为上半部和下半部这两个部分。</p><ul>\n<li>\n<p>上半部对应硬中断，用来快速处理中断；</p>\n</li>\n<li>\n<p>下半部对应软中断，用来异步处理上半部未完成的工作。</p>\n</li>\n</ul><p>Linux 中的软中断包括网络收发、定时、调度、RCU锁等各种类型，我们可以查看 proc 文件系统中的 /proc/softirqs  ，观察软中断的运行情况。</p><p>在 Linux 中，每个 CPU 都对应一个软中断内核线程，名字是 ksoftirqd/CPU编号。当软中断事件的频率过高时，内核线程也会因为CPU 使用率过高而导致软中断处理不及时，进而引发网络收发延迟、调度缓慢等性能问题。</p><p>软中断 CPU 使用率过高也是一种最常见的性能问题。今天，我就用最常见的反向代理服务器 Nginx 的案例，教你学会分析这种情况。</p><h2>案例</h2><h3>你的准备</h3><p>接下来的案例基于 Ubuntu 18.04，也同样适用于其他的 Linux 系统。我使用的案例环境是这样的：</p><ul>\n<li>\n<p>机器配置：2 CPU、8 GB 内存。</p>\n</li>\n<li>\n<p>预先安装 docker、sysstat、sar 、hping3、tcpdump 等工具，比如 apt-get install <a href=\"http://docker.io\">docker.io</a> sysstat hping3 tcpdump。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>这里我又用到了三个新工具，sar、  hping3 和 tcpdump，先简单介绍一下：</p><ul>\n<li>\n<p>sar 是一个系统活动报告工具，既可以实时查看系统的当前活动，又可以配置保存和报告历史统计数据。</p>\n</li>\n<li>\n<p>hping3 是一个可以构造 TCP/IP 协议数据包的工具，可以对系统进行安全审计、防火墙测试等。</p>\n</li>\n<li>\n<p>tcpdump 是一个常用的网络抓包工具，常用来分析各种网络问题。</p>\n</li>\n</ul><p>本次案例用到两台虚拟机，我画了一张图来表示它们的关系。</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/96/5f9487847e937f955ebc2ec86d490b96.png?wh=1632*1032\" alt=\"\"></p><p>你可以看到，其中一台虚拟机运行 Nginx ，用来模拟待分析的 Web 服务器；而另一台当作Web 服务器的客户端，用来给 Nginx 增加压力请求。使用两台虚拟机的目的，是为了相互隔离，避免“交叉感染”。</p><p>接下来，我们打开两个终端，分别 SSH 登录到两台机器上，并安装上面提到的这些工具。</p><p>同以前的案例一样，下面的所有命令都默认以 root 用户运行，如果你是用普通用户身份登陆系统，请运行 sudo su root 命令切换到 root 用户。</p><p>如果安装过程中有什么问题，同样鼓励你先自己搜索解决，解决不了的，可以在留言区向我提问。如果你以前已经安装过了，就可以忽略这一点了。</p><h3>操作和分析</h3><p>安装完成后，我们先在第一个终端，执行下面的命令运行案例，也就是一个最基本的 Nginx 应用：</p><pre><code># 运行Nginx服务并对外开放80端口\n$ docker run -itd --name=nginx -p 80:80 nginx\n</code></pre><p>然后，在第二个终端，使用 curl 访问 Nginx 监听的端口，确认 Nginx 正常启动。假设 192.168.0.30 是 Nginx 所在虚拟机的 IP 地址，运行 curl 命令后你应该会看到下面这个输出界面：</p><pre><code>$ curl http://192.168.0.30/\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Welcome to nginx!&lt;/title&gt;\n...\n</code></pre><p>接着，还是在第二个终端，我们运行 hping3 命令，来模拟 Nginx 的客户端请求：</p><pre><code># -S参数表示设置TCP协议的SYN（同步序列号），-p表示目的端口为80\n# -i u100表示每隔100微秒发送一个网络帧\n# 注：如果你在实践过程中现象不明显，可以尝试把100调小，比如调成10甚至1\n$ hping3 -S -p 80 -i u100 192.168.0.30\n</code></pre><p>现在我们再回到第一个终端，你应该发现了异常。是不是感觉系统响应明显变慢了，即便只是在终端中敲几个回车，都得很久才能得到响应？这个时候应该怎么办呢？</p><p>虽然在运行 hping3 命令时，我就已经告诉你，这是一个 SYN FLOOD 攻击，你肯定也会想到从网络方面入手，来分析这个问题。不过，在实际的生产环境中，没人直接告诉你原因。</p><p>所以，我希望你把 hping3 模拟 SYN FLOOD 这个操作暂时忘掉，然后重新从观察到的问题开始，分析系统的资源使用情况，逐步找出问题的根源。</p><p>那么，该从什么地方入手呢？刚才我们发现，简单的 SHELL 命令都明显变慢了，先看看系统的整体资源使用情况应该是个不错的注意，比如执行下 top 看看是不是出现了 CPU 的瓶颈。我们在第一个终端运行 top 命令，看一下系统整体的资源使用情况。</p><pre><code># top运行后按数字1切换到显示所有CPU\n$ top\ntop - 10:50:58 up 1 days, 22:10,  1 user,  load average: 0.00, 0.00, 0.00\nTasks: 122 total,   1 running,  71 sleeping,   0 stopped,   0 zombie\n%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni, 96.7 id,  0.0 wa,  0.0 hi,  3.3 si,  0.0 st\n%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni, 95.6 id,  0.0 wa,  0.0 hi,  4.4 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n    7 root      20   0       0      0      0 S   0.3  0.0   0:01.64 ksoftirqd/0\n   16 root      20   0       0      0      0 S   0.3  0.0   0:01.97 ksoftirqd/1\n 2663 root      20   0  923480  28292  13996 S   0.3  0.3   4:58.66 docker-containe\n 3699 root      20   0       0      0      0 I   0.3  0.0   0:00.13 kworker/u4:0\n 3708 root      20   0   44572   4176   3512 R   0.3  0.1   0:00.07 top\n    1 root      20   0  225384   9136   6724 S   0.0  0.1   0:23.25 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.03 kthreadd\n...\n</code></pre><p>这里你有没有发现异常的现象？我们从第一行开始，逐个看一下：</p><ul>\n<li>\n<p>平均负载全是0，就绪队列里面只有一个进程（1 running）。</p>\n</li>\n<li>\n<p>每个CPU的使用率都挺低，最高的CPU1的使用率也只有4.4%，并不算高。</p>\n</li>\n<li>\n<p>再看进程列表，CPU使用率最高的进程也只有 0.3%，还是不高呀。</p>\n</li>\n</ul><p>那为什么系统的响应变慢了呢？既然每个指标的数值都不大，那我们就再来看看，这些指标对应的更具体的含义。毕竟，哪怕是同一个指标，用在系统的不同部位和场景上，都有可能对应着不同的性能问题。</p><p>仔细看 top 的输出，两个 CPU的使用率虽然分别只有 3.3%和4.4%，但都用在了软中断上；而从进程列表上也可以看到，CPU使用率最高的也是软中断进程 ksoftirqd。看起来，软中断有点可疑了。</p><p>根据上一期的内容，既然软中断可能有问题，那你先要知道，究竟是哪类软中断的问题。停下来想想，上一节我们用了什么方法，来判断软中断类型呢？没错，还是proc文件系统。观察 /proc/softirqs 文件的内容，你就能知道各种软中断类型的次数。</p><p>不过，这里的各类软中断次数，又是什么时间段里的次数呢？它是系统运行以来的<strong>累积中断次数</strong>。所以我们直接查看文件内容，得到的只是累积中断次数，对这里的问题并没有直接参考意义。因为，这些<strong>中断次数的变化速率</strong>才是我们需要关注的。</p><p>那什么工具可以观察命令输出的变化情况呢？我想你应该想起来了，在前面案例中用过的  watch 命令，就可以定期运行一个命令来查看输出；如果再加上 -d 参数，还可以高亮出变化的部分，从高亮部分我们就可以直观看出，哪些内容变化得更快。</p><p>比如，还是在第一个终端，我们运行下面的命令：</p><pre><code>$ watch -d cat /proc/softirqs\n                    CPU0       CPU1\n          HI:          0          0\n       TIMER:    1083906    2368646\n      NET_TX:         53          9\n      NET_RX:    1550643    1916776\n       BLOCK:          0          0\n    IRQ_POLL:          0          0\n     TASKLET:     333637       3930\n       SCHED:     963675    2293171\n     HRTIMER:          0          0\n         RCU:    1542111    1590625\n</code></pre><p>通过 /proc/softirqs 文件内容的变化情况，你可以发现， TIMER（定时中断）、NET_RX（网络接收）、SCHED（内核调度）、RCU（RCU锁）等这几个软中断都在不停变化。</p><p>其中，NET_RX，也就是网络数据包接收软中断的变化速率最快。而其他几种类型的软中断，是保证 Linux 调度、时钟和临界区保护这些正常工作所必需的，所以它们有一定的变化倒是正常的。</p><p>那么接下来，我们就从网络接收的软中断着手，继续分析。既然是网络接收的软中断，第一步应该就是观察系统的网络接收情况。这里你可能想起了很多网络工具，不过，我推荐今天的主人公工具  sar  。</p><p>sar  可以用来查看系统的网络收发情况，还有一个好处是，不仅可以观察网络收发的吞吐量（BPS，每秒收发的字节数），还可以观察网络收发的 PPS，即每秒收发的网络帧数。</p><p>我们在第一个终端中运行 sar 命令，并添加 -n DEV 参数显示网络收发的报告：</p><pre><code># -n DEV 表示显示网络收发的报告，间隔1秒输出一组数据\n$ sar -n DEV 1\n15:03:46        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil\n15:03:47         eth0  12607.00   6304.00    664.86    358.11      0.00      0.00      0.00      0.01\n15:03:47      docker0   6302.00  12604.00    270.79    664.66      0.00      0.00      0.00      0.00\n15:03:47           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n15:03:47    veth9f6bbcd   6302.00  12604.00    356.95    664.66      0.00      0.00      0.00      0.05\n</code></pre><p>对于 sar 的输出界面，我先来简单介绍一下，从左往右依次是：</p><ul>\n<li>\n<p>第一列：表示报告的时间。</p>\n</li>\n<li>\n<p>第二列：IFACE 表示网卡。</p>\n</li>\n<li>\n<p>第三、四列：rxpck/s 和 txpck/s 分别表示每秒接收、发送的网络帧数，也就是  PPS。</p>\n</li>\n<li>\n<p>第五、六列：rxkB/s 和 txkB/s 分别表示每秒接收、发送的千字节数，也就是  BPS。</p>\n</li>\n<li>\n<p>后面的其他参数基本接近0，显然跟今天的问题没有直接关系，你可以先忽略掉。</p>\n</li>\n</ul><p>我们具体来看输出的内容，你可以发现：</p><ul>\n<li>\n<p>对网卡 eth0来说，每秒接收的网络帧数比较大，达到了 12607，而发送的网络帧数则比较小，只有 6304；每秒接收的千字节数只有 664 KB，而发送的千字节数更小，只有 358 KB。</p>\n</li>\n<li>\n<p>docker0 和 veth9f6bbcd 的数据跟 eth0 基本一致，只是发送和接收相反，发送的数据较大而接收的数据较小。这是 Linux 内部网桥转发导致的，你暂且不用深究，只要知道这是系统把 eth0 收到的包转发给 Nginx 服务即可。具体工作原理，我会在后面的网络部分详细介绍。</p>\n</li>\n</ul><p>从这些数据，你有没有发现什么异常的地方？</p><p>既然怀疑是网络接收中断的问题，我们还是重点来看 eth0 ：接收的 PPS 比较大，达到 12607，而接收的 BPS 却很小，只有 664 KB。直观来看网络帧应该都是比较小的，我们稍微计算一下，664*1024/12607 = 54 字节，说明平均每个网络帧只有 54 字节，这显然是很小的网络帧，也就是我们通常所说的小包问题。</p><p>那么，有没有办法知道这是一个什么样的网络帧，以及从哪里发过来的呢？</p><p>使用 tcpdump 抓取 eth0 上的包就可以了。我们事先已经知道， Nginx 监听在 80 端口，它所提供的 HTTP 服务是基于 TCP 协议的，所以我们可以指定 TCP 协议和 80 端口精确抓包。</p><p>接下来，我们在第一个终端中运行 tcpdump 命令，通过 -i eth0 选项指定网卡 eth0，并通过 tcp port 80 选项指定 TCP 协议的 80 端口：</p><pre><code># -i eth0 只抓取eth0网卡，-n不解析协议名和主机名\n# tcp port 80表示只抓取tcp协议并且端口号为80的网络帧\n$ tcpdump -i eth0 -n tcp port 80\n15:11:32.678966 IP 192.168.0.2.18238 &gt; 192.168.0.30.80: Flags [S], seq 458303614, win 512, length 0\n...\n</code></pre><p>从 tcpdump 的输出中，你可以发现</p><ul>\n<li>\n<p>192.168.0.2.18238 &gt; 192.168.0.30.80  ，表示网络帧从 192.168.0.2 的 18238 端口发送到 192.168.0.30 的 80 端口，也就是从运行 hping3 机器的 18238 端口发送网络帧，目的为 Nginx 所在机器的 80 端口。</p>\n</li>\n<li>\n<p>Flags [S] 则表示这是一个 SYN 包。</p>\n</li>\n</ul><p>再加上前面用 sar 发现的， PPS 超过 12000的现象，现在我们可以确认，这就是从 192.168.0.2 这个地址发送过来的 SYN FLOOD 攻击。</p><p>到这里，我们已经做了全套的性能诊断和分析。从系统的软中断使用率高这个现象出发，通过观察 /proc/softirqs 文件的变化情况，判断出软中断类型是网络接收中断；再通过 sar 和 tcpdump  ，确认这是一个 SYN FLOOD 问题。</p><p>SYN FLOOD 问题最简单的解决方法，就是从交换机或者硬件防火墙中封掉来源 IP，这样 SYN FLOOD 网络帧就不会发送到服务器中。</p><p>至于 SYN FLOOD 的原理和更多解决思路，你暂时不需要过多关注，后面的网络章节里我们都会学到。</p><p>案例结束后，也不要忘了收尾，记得停止最开始启动的 Nginx 服务以及 hping3 命令。</p><p>在第一个终端中，运行下面的命令就可以停止 Nginx 了：</p><pre><code># 停止 Nginx 服务\n$ docker rm -f nginx\n</code></pre><p>然后到第二个终端中按下 Ctrl+C 就可以停止 hping3。</p><h2>小结</h2><p>软中断CPU使用率（softirq）升高是一种很常见的性能问题。虽然软中断的类型很多，但实际生产中，我们遇到的性能瓶颈大多是网络收发类型的软中断，特别是网络接收的软中断。</p><p>在碰到这类问题时，你可以借用 sar、tcpdump 等工具，做进一步分析。不要害怕网络性能，后面我会教你更多的分析方法。</p><h2>思考</h2><p>最后，我想请你一起来聊聊，你所碰到的软中断问题。你所碰到的软中问题是哪种类型，是不是这个案例中的小包问题？你又是怎么分析它们的来源并解决的呢？可以结合今天的案例，总结你自己的思路和感受。如果遇到过其他问题，也可以留言给我一起解决。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","comments":[{"had_liked":false,"id":49106,"user_name":"倪朋飞","can_delete":false,"product_type":"c1","uid":1001282,"ip_address":"","ucode":"F0FAC195CDE7AC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","comment_is_top":true,"comment_ctime":1544605330,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"9.2233722789175992e+18","product_id":100020901,"comment_content":"统一回复一下终端卡顿的问题，这个是由于网络延迟增大（甚至是丢包）导致的。比如你可以再拿另外一台机器（也就是第三台）在 hping3 运行的前后 ping 一下案例机器，ping -c3 &lt;ip&gt;<br><br>hping3 运行前，你可能看到最长的也不超过 1 ms：<br><br>3 packets transmitted, 3 received, 0% packet loss, time 2028ms<br>rtt min&#47;avg&#47;max&#47;mdev = 0.815&#47;0.914&#47;0.989&#47;0.081 ms<br><br>而 hping3 运行时，不仅平均延迟增长到了 245 ms，而且还会有丢包的发生：<br><br>3 packets transmitted, 2 received, 33% packet loss, time 2026ms<br>rtt min&#47;avg&#47;max&#47;mdev = 240.637&#47;245.758&#47;250.880&#47;5.145 ms<br><br>网络问题的排查方法在后面的文章中还会讲，这儿只是从 CPU 利用率的角度出发，你可以发现也有可能是网络导致的问题。","like_count":56,"discussions":[{"author":{"id":1118091,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0f/8b/25d118be.jpg","nickname":"Aitozi","note":"","ucode":"B8096312BAD560","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572481,"discussion_content":"这就说明这个例子讲软中断问题很牵强","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1652799823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"莫名","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384281,"discussion_content":"可以使用 bcc 工具 softirqs 进一步确认下网络相关软中断的延迟分布情况，理论上可以看到一部分延迟较大的离散点。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1626482415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217712,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/b0/b073fe8b.jpg","nickname":"aMaMiMoU","note":"","ucode":"AF1E6CA541E482","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333593,"discussion_content":"&#34;由于网络延迟增大（甚至是丢包）导致的&#34;,如果再深究的话，估计是backlog队列满导致新的syn连接无法入队建立连接，这个数据包被丢弃，从而出现丢包和超时","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1607570654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2802,"discussion_content":"我先运行hping3 ,然后通过ssh登录服务器，发现登录不了，暂停以后就又可以登录了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563947824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1787187,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","nickname":"zwm","note":"","ucode":"BDF98B3A1CD406","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591231,"discussion_content":"可能是半链接队列满了。停止之后链接队列回复又可以访问了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666420292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2802,"ip_address":"山东"},"score":591231,"extra":""}]}]},{"had_liked":false,"id":49325,"user_name":"Days","can_delete":false,"product_type":"c1","uid":1317834,"ip_address":"","ucode":"4DDB1CD8F493E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/ca/9afb89a2.jpg","comment_is_top":false,"comment_ctime":1544665779,"is_pvip":false,"replies":[{"id":"17830","content":"正解👍","user_name":"作者回复","comment_id":49325,"uid":"1001282","ip_address":"","utype":1,"ctime":1544745000,"user_name_real":"倪朋飞"}],"discussion_count":6,"race_medal":0,"score":"396681657011","product_id":100020901,"comment_content":"软终端不高导致系统卡顿，我的理解是这样的，其实不是系统卡顿，而是由于老师用的ssh远程登录，在这期间hping3大量发包，导致其他网络连接延迟，ssh通过网络连接，使ssh客户端感觉卡顿现象。","like_count":93,"discussions":[{"author":{"id":1050508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","nickname":"蚂蚁内推+v","note":"","ucode":"24B10AEE54B3FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":184573,"discussion_content":"就是相当于请求量太大，处理不过来了？那为啥CPU不高啊","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1582557096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1976061,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/26/fd/0f3e8198.jpg","nickname":"十","note":"","ucode":"F49299A4AE8C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1050508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","nickname":"蚂蚁内推+v","note":"","ucode":"24B10AEE54B3FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":251903,"discussion_content":"这个地方是网络问题，网络通道堵满了人，SSH链接相当于在挤满了人的网络通道中操作，所以很卡","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1588125223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":184573,"ip_address":""},"score":251903,"extra":""},{"author":{"id":1801058,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/7b/62/ec94cee4.jpg","nickname":"彭文达","note":"","ucode":"8DCC27EC5AF263","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1050508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","nickname":"蚂蚁内推+v","note":"","ucode":"24B10AEE54B3FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538316,"discussion_content":"感觉应该是CPU对软中断不是那么敏感，虽然软中断很多，但是不至于导致CPU很高，这里ssh窗口操作的时候很卡，是因为大量网络包占用了带宽，导致网络卡慢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639398277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":184573,"ip_address":""},"score":538316,"extra":""}]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432575,"discussion_content":"正解👍","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544745000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2587479,"avatar":"https://static001.geekbang.org/account/avatar/00/27/7b/57/e9b3d886.jpg","nickname":"阿昌","note":"","ucode":"C7AF1905B72AD3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586245,"discussion_content":"搞条专线","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662078649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2012804,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/b6/84/49c5f817.jpg","nickname":"给陈某举个例子。","note":"","ucode":"818D65EEA7B172","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340650,"discussion_content":"我可以这样理解么？SSH会话应该收到的数据还在软中断处理队列中，所以会感觉到卡顿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610088055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54578,"user_name":"向阳胜","can_delete":false,"product_type":"c1","uid":1039984,"ip_address":"","ucode":"BDD8C2B43B7F17","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/70/3d0546ae.jpg","comment_is_top":false,"comment_ctime":1545903750,"is_pvip":false,"replies":[{"id":"19830","content":"也很高兴看到大家有所收获😊","user_name":"作者回复","comment_id":54578,"uid":"1001282","ip_address":"","utype":1,"ctime":1545953697,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"173344595590","product_id":100020901,"comment_content":"搞运维好些年了。一些底层性能的东西，感觉自己始终是一知半解，通过这个专栏了解的更深入了，确实学到了很多。而且老师也一直在积极回复同学们的问题，相比某些专栏的老师发出来就不管的状态好太多。给老师点赞。<br>","like_count":41,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434499,"discussion_content":"也很高兴看到大家有所收获😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545953697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49057,"user_name":"卿卿子衿","can_delete":false,"product_type":"c1","uid":1137707,"ip_address":"","ucode":"D988779597CBA2","user_header":"https://static001.geekbang.org/account/avatar/00/11/5c/2b/25c1c14c.jpg","comment_is_top":false,"comment_ctime":1544596159,"is_pvip":false,"replies":[{"id":"17672","content":"谢谢分享","user_name":"作者回复","comment_id":49057,"uid":"1001282","ip_address":"","utype":1,"ctime":1544660876,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"143278516927","product_id":100020901,"comment_content":"有同学说在查看软中断数据时会显示128个核的数据，我的也是，虽然只有一个核，但是会显示128个核的信息，用下面的命令可以提取有数据的核，我的1核，所以这个命令只能显示1核，多核需要做下修改<br><br>watch -d &quot;&#47;bin&#47;cat &#47;proc&#47;softirqs | &#47;usr&#47;bin&#47;awk &#39;NR == 1{printf  \\&quot;%13s %s\\n\\&quot;,\\&quot; \\&quot;,\\$1}; NR &gt; 1{printf \\&quot;%13s %s\\n\\&quot;,\\$1,\\$2}&#39;&quot;","like_count":33,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432469,"discussion_content":"谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101611,"avatar":"","nickname":"庄生 • 晓梦 • 蝴蝶","note":"","ucode":"9281045A5B3F5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537069,"discussion_content":"虚机关机。打开这个虚机的vmx文件，找到vcpu.hotadd或者类似的参数，改成&#34;FALSE&#34;：\nvcpu.hotadd = &#34;FALSE&#34;\n重新开机，就不会有这问题了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638949908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2660316,"avatar":"https://static001.geekbang.org/account/avatar/00/28/97/dc/8eacc8f1.jpg","nickname":"漠博嵩","note":"","ucode":"33704880E9790F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1101611,"avatar":"","nickname":"庄生 • 晓梦 • 蝴蝶","note":"","ucode":"9281045A5B3F5D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550369,"discussion_content":"真硬核, 还以为是VMware 的问题呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644499737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":537069,"ip_address":""},"score":550369,"extra":""}]}]},{"had_liked":false,"id":49026,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1544590448,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"78854001776","product_id":100020901,"comment_content":"倪老师，案例中硬中断CPU占用率为啥是0呢，硬中断和软中断次数不是基本一致的吗?","like_count":18,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5282,"discussion_content":"不是的，硬中断和软中断不是一一对应的","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1566133851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1447569,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","nickname":"脱缰的野马__","note":"","ucode":"D5F993E7232C61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":377425,"discussion_content":"为啥呢？难道是网卡会接收多次网络包数据然后再触发硬中断吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622640011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5282,"ip_address":""},"score":377425,"extra":""}]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171801,"discussion_content":"mark， 硬中断和软中断的不是一一对应的，可能是来一次硬中断，然后软中断就会轮询一会儿那个网卡。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581748853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2688267,"avatar":"https://static001.geekbang.org/account/avatar/00/29/05/0b/489e5481.jpg","nickname":"周 勇","note":"","ucode":"2DFB0BFD8CCF6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382921,"discussion_content":"NAPI","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625792535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2355476,"avatar":"https://static001.geekbang.org/account/avatar/00/23/f1/14/7306a747.jpg","nickname":"林夕","note":"","ucode":"9B94FFED6BF24A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580153,"discussion_content":"硬中断处理比较快，所以你看不到cpu利用率高，但不代表有网络请求时没发生硬中断！老师说的不是一一对应是指不是所有软中断都是有硬中断引起的！我是这么理解的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657930757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66365,"user_name":"bruceding","can_delete":false,"product_type":"c1","uid":1024057,"ip_address":"","ucode":"D35A2B05487EAE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/39/ddcf26ac.jpg","comment_is_top":false,"comment_ctime":1549933257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"61679475401","product_id":100020901,"comment_content":"找网络相关的错误，可以有几种方式。<br>1. 找系统类的错误， dmesg | tail <br>2. 直接的网络错误   sar -n ETCP 1 或者 sar -n EDEV 1 <br>3.查看网络状态， netstat -s  或者 watch -d netstat -s <br>4.网络状态的统计  ss -ant | awk &#39;{++s[$1]} END {for(k in s) print k,s[k]}&#39;","like_count":15},{"had_liked":false,"id":231029,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593568351,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"48838208607","product_id":100020901,"comment_content":"软中断对系统的影响排查思路：<br>1. 当发现服务器或业务卡顿的时候，首先通过top命令来查看服务器负载，cpu使用率和各个cpu参数，然后排查cpu占用较高的进程；<br>2. 如果发现cpu使用率并不高，但是si很高，而且ksoftirqd进程cpu占用率高，则说明服务器一直在发生软中断；<br>3. 通过cat &#47;proc&#47;softirqs来分析是哪方面的软中断次数最多，可以通过watch命令来查看变化最快的值；<br>4. 一般情况下网络发生中断的情况会比较多，如果发现是网络收发包导致的软中断，则通过sar命令来查看此时的收发包速率和收发包数据量来验证是否真的是网络收发包过多导致，也可以计算每个包的大小，以此来计算服务器是否收到了flood攻击；<br>5. 通过tcpdump来抓包分析数据包来源ip和数据包类型，通过抓包数据中的Flags来分析数据包类型；<br>6. 通过防火墙封堵异常ip；","like_count":11,"discussions":[{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326733,"discussion_content":"谢谢，感觉总结得很详细，参考了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605669983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48874,"user_name":"2xshu","can_delete":false,"product_type":"c1","uid":1188473,"ip_address":"","ucode":"71584CB9676EDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132","comment_is_top":false,"comment_ctime":1544575134,"is_pvip":false,"replies":[{"id":"17694","content":"参考置顶回复","user_name":"作者回复","comment_id":48874,"uid":"1001282","ip_address":"","utype":1,"ctime":1544661822,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"48789215390","product_id":100020901,"comment_content":"老师，网络软中断明明只占了百分之四左右。为什么终端会感觉那么卡呢？不是很理解这点呢","like_count":11,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432399,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243430,"user_name":"陈文庆","can_delete":false,"product_type":"c1","uid":1213442,"ip_address":"","ucode":"95F593C7B8216E","user_header":"https://static001.geekbang.org/account/avatar/00/12/84/02/e9937c31.jpg","comment_is_top":false,"comment_ctime":1598104382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31662875454","product_id":100020901,"comment_content":"很喜欢这个专栏，只有干货，诚意满满。做业务研发的天天堆业务代码，对系统底层一直不了解，出了问题总是抓瞎，临时网上找的方法不系统，不深入讲原理，多年也不进步，能通过专栏系统学习，真是打开了一扇门，感谢老师！","like_count":7},{"had_liked":false,"id":48968,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1544583335,"is_pvip":false,"replies":[{"id":"17691","content":"👍<br><br>最后一个问题其实前面已经看到PPS了","user_name":"作者回复","comment_id":48968,"uid":"1001282","ip_address":"","utype":1,"ctime":1544661806,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"31609354407","product_id":100020901,"comment_content":"[D10打卡]<br> &quot;hping3 -S -p 80 -i u100 192.168.0.30&quot; 这里的u100改为了1 也没觉得终端卡,top的软中断%si倒是从4%上升了不少,吃满了一个cpu.<br>可能是我直接在宿主机上开终端的原因,本身两个虚拟机都在这个宿主机上,都是走的本地网络.<br>本地网卡可能还处理的过来.<br>-----------<br>在工作中,倒是没有遇到小包导致的性能问题.<br>也许是用户数太少,流量不够.[才二三十兆带宽], 也许是之前发生了,自己并不知道.<br>在工作中遇到的软中间导致的性能问题就是上期说的usleep(1)了.<br>-----------<br>本期又学到新东西了:<br>1.sar 原来可以这么方便的看各网卡流量,甚至是网络帧数.<br>到目前为止,我都是用的最原始的方法:在网上找的一个脚本,分析ifconfig中的数据,来统计某个网卡的流量.一来需要指定某个网卡(默认eth0),二来显示的数据不太准确且不友好(sleep 1做差值).<br>2.nping3 居然可以用来模拟SYN FLOOD. (不要用来做坏事哦)<br>3.tcpdump 之前有所耳闻. 用的不多. 平常有解包需求,都是在windows下用wireshark,毕竟是图形界面.<br>-----------<br>有同学说&quot;仅凭tcpdump发现一个syn包就断定是SYN FLOOD，感觉有些草断&quot;<br>我是这样认为的:<br>你tcpdump 截取一段时间的日志, 除去正常的流量, 着重分析异常的,再根据ip来统计出现的次数, 还是可以合理推理出来老师结论的.<br>毕竟平常不会有哪个ip每秒产生这么多的syn,且持续这么长时间.","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432442,"discussion_content":"👍\n\n最后一个问题其实前面已经看到PPS了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2587091,"avatar":"https://static001.geekbang.org/account/avatar/00/27/79/d3/99d4e09f.jpg","nickname":"凯旋","note":"","ucode":"7E8D0932FA5690","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382639,"discussion_content":"我也是，完全没有卡顿的感觉😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625651574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48918,"user_name":"黄海峰","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1544577898,"is_pvip":false,"replies":[{"id":"17685","content":"😊 ","user_name":"作者回复","comment_id":48918,"uid":"1001282","ip_address":"","utype":1,"ctime":1544661396,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"31609348970","product_id":100020901,"comment_content":"这真是非常干货和务实的一个专栏，这么便宜，太值了。。。","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432418,"discussion_content":"😊 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48994,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1544586019,"is_pvip":false,"replies":[{"id":"17675","content":"我们是SSH登陆的机器，还是走网络而不是键盘中断😓","user_name":"作者回复","comment_id":48994,"uid":"1001282","ip_address":"","utype":1,"ctime":1544661078,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"23019422499","product_id":100020901,"comment_content":"1. 网络收发软中断过多导致命令行比较卡，是因为键盘敲击命令行属于硬中断，内核也需要去处理的原因吗？<br>2. 观察&#47;proc&#47;softirqs，发现变化的值是TIMER、NET_RX、BLOCK、RCU，奇怪的是SCHED一直为0，求老师解答","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432453,"discussion_content":"我们是SSH登陆的机器，还是走网络而不是键盘中断😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986708,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","nickname":"欧阳洲","note":"","ucode":"94606A6315F2BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291752,"discussion_content":"老师，因为ssh远程登录，所以键盘的中断发生在客户端机器上，没有在目标主机吗.\n那如果不用ssh，直接在一台物理机上登录，\n会因为有大量网络接收软中断，而导致键盘中断被变卡吗？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594946520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49226,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1544626348,"is_pvip":false,"replies":[{"id":"17655","content":"对的","user_name":"作者回复","comment_id":49226,"uid":"1001282","ip_address":"","utype":1,"ctime":1544660323,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18724495532","product_id":100020901,"comment_content":"ssh的tty其实也是通过网络传输的，既然是经过网卡，当然会卡，这就是攻击所带来的结果","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432539,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":209757,"user_name":"kyra","can_delete":false,"product_type":"c1","uid":1241673,"ip_address":"","ucode":"26918E763F1D9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/49/43f222e4.jpg","comment_is_top":false,"comment_ctime":1587609431,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14472511319","product_id":100020901,"comment_content":"最近刚遇到这个问题，si高达80%，试着分析了下，但是不知道分析思路对不对<br>环境：1C1G的虚拟机上启动docker容器的nginx<br>场景：在物理机上用jmeter，1线程间隔1秒，永久循环压测nginx<br>结果：服务器si高达80%，TPS达到1200多，响应时间1ms以下<br>分析：<br>开始压测的时候就是有top监控服务器的情况，发现si很快飙到80%，并且一直维持在这个比例<br>然后查看&#47;proc&#47;softirqs里的数据，NET_RX数据变化最快，根据文章提供的办法，所以分析网络，使用sar分析网络，通过计算发现每帧字节数在115字节左右，不确定是不是小包，但是感觉直接关闭压测工具，这里不是很理解，万一是正常压测呢？<br>然后我又使用vmstat查看了cpu的情况，发现nginx的cs变化比较大，没有压测的时候是80多，压测的时候达到了20000多，然后通过pidstat -wt查看发现nginx和docker 容器的上下文切换废材频繁，且都是主动上下文切换，所以考虑是压测过快，响应时间才1ms不到，CPU资源不足造成的如此频繁的上下文切换，但是又总觉得哪里不太对，希望老师能够指正一下","like_count":3,"discussions":[{"author":{"id":1485279,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIzVGyhMctYa2jumzLicZVLia0UCTqrWfiaY8pY4c3AbGH2tH5TxONcbicoXGdE3ia43TpXxbZWPZoS6Jg/132","nickname":"InfoQ_31da8ff7fcb1","note":"","ucode":"AEF58B6E4F9E59","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374189,"discussion_content":"提高nginx日志级别可能会好一些，容器的日志是由docker落盘的，容器和docker中间有两个pipe，nginx容器输出日志写到pipe中就会唤醒docker，docker可能会强占当前的nginx，如此反复。如果调度器是cfs可以通过设置内核参数\nsched_wakeup_granularity_ns = 3000000\n缓解这个问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621056547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274588,"discussion_content":"时间片切换得太快了，可以考虑把压测调高一点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590592854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50752,"user_name":"男人十八一枝花","can_delete":false,"product_type":"c1","uid":1315898,"ip_address":"","ucode":"F7CC38E9252DBB","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/3a/94e25d0c.jpg","comment_is_top":false,"comment_ctime":1545039147,"is_pvip":false,"replies":[{"id":"18483","content":"谢谢分享👍 不懂awk的赶紧去学习😊","user_name":"作者回复","comment_id":50752,"uid":"1001282","ip_address":"","utype":1,"ctime":1545145046,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"14429941035","product_id":100020901,"comment_content":"cat &#47;proc&#47;softirqs时我有4个cpu，可用<br>watch -d &quot;&#47;bin&#47;cat &#47;proc&#47;softirqs | &#47;usr&#47;bin&#47;awk &#39;NR == 1{printf \\&quot;%-15s %-15s %-15s %-15s %-15s\\n\\&quot;,\\&quot; \\&quot;,\\$1,\\$2,\\$3,\\$4}; NR &gt; 1{printf \\&quot;%-15s %-15s %-15s %-15s %-15s\\n\\&quot;,\\$1,\\$2,\\$3,\\$4,\\$5}&#39;&quot;<br>查看","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433083,"discussion_content":"谢谢分享👍 不懂awk的赶紧去学习😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326734,"discussion_content":"有4个CPU也可以直接用watch -d cat /proc/softirqd查出来呢，为什么要用这个复杂得命令(是真心提问)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605670232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1746897,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/a7/d1/2147ce10.jpg","nickname":"crazy jing","note":"","ucode":"EF29D972B49CEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381274,"discussion_content":"我有100多个cpu，直接看简直大海捞针。这个方法很有用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624977624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326734,"ip_address":""},"score":381274,"extra":""}]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296444,"discussion_content":"感谢，正发愁中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596544132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185605,"user_name":"Geek_c92584","can_delete":false,"product_type":"c1","uid":1290469,"ip_address":"","ucode":"D9DA02DA718977","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Um0fKCDsGBRStZBF1M4HLPSq8jiancnNoYKiaYyYldFX0NObkyUFmnVKTgjm6Y7wUiaCQ3Vm9Ic213l65kJfUzq4w/132","comment_is_top":false,"comment_ctime":1583643140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10173577732","product_id":100020901,"comment_content":"老师说的这些工具的使用是基础中的基础，值得反复实践。<br><br>另外推荐 netdata 这个监控神器，下载了netdata&#47;netdata docker 镜像的前提下，可以瞬间一个从监控指标采集、存储、到展示的整套监控系统，老师说的这些案例可以直接用其分析。<br><br>这套系统可以和其他外围的监控系统整合。并且，通过 netdata registery 整合管理多个 netdata 示例。值得一试！","like_count":2},{"had_liked":false,"id":124285,"user_name":"lumence","can_delete":false,"product_type":"c1","uid":1144080,"ip_address":"","ucode":"00BA0ECFA6F002","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJtl3p4gcguAZy580SyoQAic79Z7QAvTcibnicV9K8x2Yzbxa8BlknwhquzTPPklaWPDDbrECQG3uurg/132","comment_is_top":false,"comment_ctime":1565852500,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10155787092","product_id":100020901,"comment_content":"是不是不能用内网网卡来测。我docker的ip是 172.17.0.2。可是我开启 -i u1 或者 --flood 依然没有卡顿现象<br>sudo hping3 -S -p 80 --flood 172.17.0.2<br>HPING 172.17.0.2 (docker0 172.17.0.2): S set, 40 headers + 0 data bytes<br>hping in flood mode, no replies will be shown","like_count":2},{"had_liked":false,"id":102516,"user_name":"王星旗","can_delete":false,"product_type":"c1","uid":1026042,"ip_address":"","ucode":"F1C742527D3A05","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/fa/1dca9fd5.jpg","comment_is_top":false,"comment_ctime":1560241744,"is_pvip":false,"replies":[{"id":"37078","content":"👍","user_name":"作者回复","comment_id":102516,"uid":"1001282","ip_address":"","utype":1,"ctime":1560258901,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"10150176336","product_id":100020901,"comment_content":"hping3 -S --flood  -p 80 ip，这样压力更大，哈哈","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453459,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560258901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"文敦复","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535116,"discussion_content":"这个太猛了...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638356029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63273,"user_name":"几叶星辰","can_delete":false,"product_type":"c1","uid":1145486,"ip_address":"","ucode":"F85CB0459217DA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/8e/934cbcbc.jpg","comment_is_top":false,"comment_ctime":1548315961,"is_pvip":false,"replies":[{"id":"22583","content":"配置 smp_affinity 或者开启 irqbalance 服务","user_name":"作者回复","comment_id":63273,"uid":"1001282","ip_address":"","utype":1,"ctime":1548576447,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10138250553","product_id":100020901,"comment_content":"怎么让网卡中断平衡呢，可以请教下linux 2.6.40。中断平衡问题吗，以及内核版本更高的版本？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437531,"discussion_content":"配置 smp_affinity 或者开启 irqbalance 服务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548576447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48970,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1544583689,"is_pvip":false,"replies":[{"id":"17678","content":"可能太猛了，调整下参数再试试","user_name":"作者回复","comment_id":48970,"uid":"1001282","ip_address":"","utype":1,"ctime":1544661223,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10134518281","product_id":100020901,"comment_content":"执行了一下hping3，机器直接卡死了，登录不上去了，哈哈","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432444,"discussion_content":"可能太猛了，调整下参数再试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48924,"user_name":"chenjt","can_delete":false,"product_type":"c1","uid":1111120,"ip_address":"","ucode":"341AF6A98B32DB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/50/3b604b3b.jpg","comment_is_top":false,"comment_ctime":1544578569,"is_pvip":false,"replies":[{"id":"17683","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661362,"ip_address":"","comment_id":48924,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134513161","product_id":100020901,"comment_content":"同问，这种情况下cpu使用率这么低，为什么会感到卡顿呢","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432420,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195791,"user_name":"斑马Z","can_delete":false,"product_type":"c1","uid":1500262,"ip_address":"","ucode":"ABB55B4652452F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0K9AM6xxDzVV6pF66jyus5NuuxZzT9icad8AQDMKibwUOy3UnoZIZdyKIKd9sA06rgFnIWwiakSeOQ/132","comment_is_top":false,"comment_ctime":1585215286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880182582","product_id":100020901,"comment_content":"实战操作<br>\t1. <br>用到的工具<br><br><br>sar 是一个系统活动报告工具，既可以实时查看系统的当前活动，又可以配置保存和报告历史统计数据。<br>hping3 是一个可以构造 TCP&#47;IP 协议数据包的工具，可以对系统进行安全审计、防火墙测试等。<br>tcpdump 是一个常用的网络抓包工具，常用来分析各种网络问题。<br>\t2. <br>场景概述<br><br><br><br>两台虚拟机，其中一台虚拟机运行 Nginx ，用来模拟待分析的 Web 服务器；而另一台当作 Web 服务器的客户端，用来给 Nginx 增加压力请求。<br>nginx的机器用docker安装    docker run -itd --name=nginx -p 80:80 nginx<br>客户端机器发送请求：hping3 -S -p 80 -i u100 IP<br><br>关于hping3命令的安装https:&#47;&#47;www.cnblogs.com&#47;shuter&#47;p&#47;11430876.html<br>        3. 问题描述<br><br>发送请求后，在服务端top，发现软中断百分比提高，且有ksoftirqd 这类命令占据cpu。然后cat &#47;proc&#47;softirqs，发现其中 TIMER（定时中断）、NET_RX（网络接收）、SCHED（内核调度）、RCU（RCU 锁）等这几个软中断都在不停变化。<br>然后通过sar&#47;tcpdump分析问题原因<br>sar -n DEV 1  （-n DEV 表示显示网络收发的报告，间隔1秒输出一组数据）<br>tcpdump -i eth0 -n tcp port 80  （-i eth0 只抓取eth0网卡，-n不解析协议名和主机名）<br><br><br>        4. 结论<br><br>从系统的软中断使用率高这个现象出发，通过观察 &#47;proc&#47;softirqs 文件的变化情况，判断出软中断类型是网络接收中断；再通过 sar 和 tcpdump ，确认这是一个 SYN FLOOD 问题。SYN FLOOD 问题最简单的解决方法，就是从交换机或者硬件防火墙中封掉来源 IP，这样 SYN FLOOD 网络帧就不会发送到服务器中。<br>","like_count":1},{"had_liked":false,"id":48921,"user_name":"bluefantasy1","can_delete":false,"product_type":"c1","uid":1106810,"ip_address":"","ucode":"83440E87C4EED3","user_header":"","comment_is_top":false,"comment_ctime":1544578084,"is_pvip":false,"replies":[{"id":"17684","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661371,"ip_address":"","comment_id":48921,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5839545380","product_id":100020901,"comment_content":"老师，既然软中断并没有占用太多cpu资源，为啥会影响其他任务的性能？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432419,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1124692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/29/54/b9fec917.jpg","nickname":"菜鸟一枚","note":"","ucode":"34052769B97FEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386393,"discussion_content":"老师这个答案有点过分了啊，没审题啊。 我可以简单回答下，中断过多会导致CPU频繁的响应中断事件，内核线程和用户进程频繁切换上下文。 另外，同时io密集导致iowait升高，cpu负载也会升高，但使用率不一定会升高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627561341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48916,"user_name":"zqing","can_delete":false,"product_type":"c1","uid":1106603,"ip_address":"","ucode":"2EF31AE75DA0A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/e2/ab/430c24df.jpg","comment_is_top":false,"comment_ctime":1544577838,"is_pvip":false,"replies":[{"id":"17686","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661403,"ip_address":"","comment_id":48916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839545134","product_id":100020901,"comment_content":"同问:老师，网络软中断明明只占了百分之四左右。为什么终端会感觉那么卡呢？不是很理解这点呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432416,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359375,"user_name":"月歌","can_delete":false,"product_type":"c1","uid":1144218,"ip_address":"江苏","ucode":"EC46401A1F91FC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/D4KnXmgkeITtk6ibZvIKDMD0ga7aVibNyaQbYicqJZRNtibrQnMEmKsCttEPLA6oJl0qlBMhvZb4PticpKOOibOL5oibQ/132","comment_is_top":false,"comment_ctime":1665482641,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665482641","product_id":100020901,"comment_content":"老师 自己的理解 软中断处理程序是在内核态运行的，大量触发软中断的话，cpu sys应该上升。<br>但是 si 上升了，这里有些迷惑。","like_count":0},{"had_liked":false,"id":356405,"user_name":"*","can_delete":false,"product_type":"c1","uid":2901446,"ip_address":"福建","ucode":"575AECA891950A","user_header":"https://static001.geekbang.org/account/avatar/00/2c/45/c6/28dfdbc9.jpg","comment_is_top":false,"comment_ctime":1662275812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662275812","product_id":100020901,"comment_content":"只是知道有大量网络小包，为啥可以定位到80这个端口抓包，如果是生产环境的话，不知道有运行nginx","like_count":0},{"had_liked":false,"id":352111,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1658389369,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1658389369","product_id":100020901,"comment_content":"[root@loaclhost queues]# top<br>top - 07:33:57 up  6:13,  2 users,  load average: 0.85, 0.76, 0.82<br>Tasks: 111 total,   3 running, 108 sleeping,   0 stopped,   0 zombie<br>%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni,  2.8 id,  0.0 wa,  0.0 hi, 97.2 si,  0.0 st<br>KiB Mem :  1881928 total,  1194252 free,   262476 used,   425200 buff&#47;cache<br>KiB Swap:   839676 total,   839676 free,        0 used.  1463096 avail Mem <br><br>  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                       <br>   14 root      20   0       0      0      0 R  80.7  0.0  94:32.02 ksoftirqd&#47;1                                                                   <br>    9 root      20   0       0      0      0 R   0.7  0.0   0:54.28 rcu_sched<br><br><br>[root@loaclhost queues]# service irqbalance status<br>Redirecting to &#47;bin&#47;systemctl status irqbalance.service<br>● irqbalance.service - irqbalance daemon<br>   Loaded: loaded (&#47;usr&#47;lib&#47;systemd&#47;system&#47;irqbalance.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Wed 2022-07-20 01:20:36 EDT; 6h ago<br> Main PID: 641 (irqbalance)<br>    Tasks: 1<br>   Memory: 16.0K<br>   CGroup: &#47;system.slice&#47;irqbalance.service<br>           └─641 &#47;usr&#47;sbin&#47;irqbalance --foreground<br><br>开启 irqbalance 服务，还是中断不均衡呢","like_count":0},{"had_liked":false,"id":343773,"user_name":"cshzet","can_delete":false,"product_type":"c1","uid":2593667,"ip_address":"","ucode":"A343CCB6E5D519","user_header":"https://static001.geekbang.org/account/avatar/00/27/93/83/cb37c46e.jpg","comment_is_top":false,"comment_ctime":1651047801,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1651047801","product_id":100020901,"comment_content":"发现一个问题，就是测试机1在两个CPU下不会产生卡顿的现象，看了下软中断情况，只有CPU2的NET_RX有大幅度增加的情况，将测试机1修改成单个CPU就会产生卡顿现象了。<br>楼下兄弟的命令 sudo hping3 -S --flood  -p 80 IP，执行完后直接卡死。。。","like_count":0},{"had_liked":false,"id":343686,"user_name":"极客最靓的仔","can_delete":false,"product_type":"c1","uid":1252439,"ip_address":"","ucode":"156C3A03DBC055","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/57/1f8c580e.jpg","comment_is_top":false,"comment_ctime":1650981819,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650981819","product_id":100020901,"comment_content":"老师，现在我的机器出现了一个php 程序导致软中断过高，我该怎么定位是代码哪个函数造成的呢<br>我pidstat  -p 进程号，看不到使用率","like_count":0},{"had_liked":false,"id":340727,"user_name":"Geek_278a2c","can_delete":false,"product_type":"c1","uid":2379572,"ip_address":"","ucode":"7EC0366896F0E6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/zWLzhGrHubcMJnNFz0s0akeMpefNBVy2jic3rxetxHIjy1icPjJBXFQc78AW10icVN47BLrWicHcSm9MOfG38J2kKw/132","comment_is_top":false,"comment_ctime":1649081128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649081128","product_id":100020901,"comment_content":"2c8g跟这两台虚拟机的关系是？","like_count":0},{"had_liked":false,"id":339346,"user_name":"舟 leo","can_delete":false,"product_type":"c1","uid":2165530,"ip_address":"","ucode":"DE2BA1E906F2FB","user_header":"https://static001.geekbang.org/account/avatar/00/21/0b/1a/b793ca36.jpg","comment_is_top":false,"comment_ctime":1648041039,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648041039","product_id":100020901,"comment_content":"PPS 超过 12000 的现象，从这里面发现是syn flood 这里是如何评判的呢，为什么是12000？","like_count":0},{"had_liked":false,"id":318420,"user_name":"张超","can_delete":false,"product_type":"c1","uid":1368351,"ip_address":"","ucode":"5F10B994EC00C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqK5fiaup3J7UyZOibDzCh3rnibYSicxMQQAuWMmxsQCe4iaglqUMEb0mvruQ07JQUkbgL1aNYOt5n1zOw/132","comment_is_top":false,"comment_ctime":1635296703,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635296703","product_id":100020901,"comment_content":"如果发现软中断高，并且就是正常流量导致软中断高，比如我遇到过万兆网卡下，redis流量大导致软中断高影响性能。我以前尝试绑定中断到cpu，但是有时候效果好有时候效果差。这是为什么","like_count":0},{"had_liked":false,"id":312448,"user_name":"无涯","can_delete":false,"product_type":"c1","uid":1354372,"ip_address":"","ucode":"BBC8D19F61E90E","user_header":"https://static001.geekbang.org/account/avatar/00/14/aa/84/b89bc795.jpg","comment_is_top":false,"comment_ctime":1631805511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631805511","product_id":100020901,"comment_content":"请教一下老师，cpu有40个，跑的kafka，top查看负载基本在30左右，定位问题后发现是有几个ksoftirqd CPU 100%，不知道如何解决，望老师提供思路","like_count":0},{"had_liked":false,"id":308465,"user_name":"阿信","can_delete":false,"product_type":"c1","uid":1399663,"ip_address":"","ucode":"CC7B15CE63264B","user_header":"https://static001.geekbang.org/account/avatar/00/15/5b/6f/113e24e6.jpg","comment_is_top":false,"comment_ctime":1629633027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629633027","product_id":100020901,"comment_content":"top查看整体资源情况还有个疑问点，总任务122，一个运行71个sleep，还有的呢？","like_count":0},{"had_liked":false,"id":290770,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1619747410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619747410","product_id":100020901,"comment_content":"这次的案例问题其实很简单,SYN必然会触发网络的软中断,网络的软中断上去了,必然会导致对应的网络延迟增加,以至于网络延迟增加,从而导致远程终端访问变慢","like_count":0},{"had_liked":false,"id":282066,"user_name":"Geek_d60e46","can_delete":false,"product_type":"c1","uid":2466127,"ip_address":"","ucode":"AB8E529461DCA5","user_header":"","comment_is_top":false,"comment_ctime":1615042861,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615042861","product_id":100020901,"comment_content":"老师您好，我想请教一下，上面的模拟cpu利用率只有4%左右，pps1万多，在经验上来看，pps到多少就能对cpu造成比较大的影响呢","like_count":0},{"had_liked":false,"id":273157,"user_name":"噜噜噜","can_delete":false,"product_type":"c1","uid":1984457,"ip_address":"","ucode":"B37C2CD3B836DB","user_header":"https://static001.geekbang.org/account/avatar/00/1e/47/c9/1bf79dfa.jpg","comment_is_top":false,"comment_ctime":1610458888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610458888","product_id":100020901,"comment_content":"为什么这个案例中的软终端的cpu利用率是3%， 但是硬中断的确实0呢","like_count":0},{"had_liked":false,"id":270225,"user_name":"出手无招","can_delete":false,"product_type":"c1","uid":2126939,"ip_address":"","ucode":"9EFBBA6AA16CD3","user_header":"https://static001.geekbang.org/account/avatar/00/20/74/5b/6c63e85f.jpg","comment_is_top":false,"comment_ctime":1608993428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608993428","product_id":100020901,"comment_content":"倪老师您好，我是在设备端做性能优化，软中断比较高，类型是RCU锁比较高，这个怎么解？","like_count":0},{"had_liked":false,"id":269429,"user_name":"A今天 🏃","can_delete":false,"product_type":"c1","uid":1275531,"ip_address":"","ucode":"556DA711491DFC","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/8b/6654810a.jpg","comment_is_top":false,"comment_ctime":1608642599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608642599","product_id":100020901,"comment_content":"请教一下老师，两个虚拟机centos7.5的环境无法模拟出被syn flood攻击的现象，可能是啥原因？<br>谢谢","like_count":0},{"had_liked":false,"id":260908,"user_name":"耳机戴半边","can_delete":false,"product_type":"c1","uid":2214777,"ip_address":"","ucode":"65235E8857F799","user_header":"https://static001.geekbang.org/account/avatar/00/21/cb/79/1f5208d0.jpg","comment_is_top":false,"comment_ctime":1605150312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605150312","product_id":100020901,"comment_content":"请教一点问题：<br>如果是通过代理服务器访问，有没有可能产生大量的syn，且长时间持续。<br>另外，还是不能理解，PPS高了，加上因为tcpdump结果存在大量的SYN来确定的是SYN FLOOD吗？","like_count":0},{"had_liked":false,"id":254398,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1603111387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603111387","product_id":100020901,"comment_content":"打卡<br>软中断性能问题中主要是网络收发类型特别是网络接收软中断<br>查看软中断，通过sar和tcpdump工具分析","like_count":0},{"had_liked":false,"id":238362,"user_name":"酸辣土豆丝","can_delete":false,"product_type":"c1","uid":1751234,"ip_address":"","ucode":"0E3E4AFB31E1E6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b8/c2/d1904d74.jpg","comment_is_top":false,"comment_ctime":1596151284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596151284","product_id":100020901,"comment_content":"每天早晨起来当课文度读，坚持","like_count":0},{"had_liked":false,"id":222635,"user_name":"邱荣财","can_delete":false,"product_type":"c1","uid":1958681,"ip_address":"","ucode":"414D74823F8AA5","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e3/19/7eba0a69.jpg","comment_is_top":false,"comment_ctime":1590853382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590853382","product_id":100020901,"comment_content":"同问，如果是其他的没有网络攻击的要怎么调优","like_count":0},{"had_liked":false,"id":221924,"user_name":"阿飞","can_delete":false,"product_type":"c1","uid":1298046,"ip_address":"","ucode":"F8B1FC8521264D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","comment_is_top":false,"comment_ctime":1590634770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590634770","product_id":100020901,"comment_content":"我的目的机器是2cpu ，使用命令 hping3 -S -p 80 -i u10 192.168.0.23 ,在目的机器可以看到cpu 使用率，其中sy、us、hi为0 ，而si高达60%。根据资料hi表示硬中断，si表示软中断。","like_count":0},{"had_liked":false,"id":220949,"user_name":"。。。","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1590364953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590364953","product_id":100020901,"comment_content":"软中断太高的话要怎么进行调优呢？我现在就遇到这个情况了，但是我们的架构师不知道怎样进行调优","like_count":0},{"had_liked":false,"id":216906,"user_name":"西出十三归","can_delete":false,"product_type":"c1","uid":1527323,"ip_address":"","ucode":"693417E8D75F74","user_header":"https://static001.geekbang.org/account/avatar/00/17/4e/1b/ba80a35e.jpg","comment_is_top":false,"comment_ctime":1589366140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589366140","product_id":100020901,"comment_content":"对于查看&#47;proc&#47;softirqs 显示很多cpu的，我用的方法比较简单，watch -d sh a.sh ,a.sh 里是cat  &#47;proc&#47;softirqs |awk &#39;{print $1,$2,$3}&#39;","like_count":0},{"had_liked":false,"id":209290,"user_name":"Geek_685c59","can_delete":false,"product_type":"c1","uid":1905578,"ip_address":"","ucode":"6088CF98E4EB44","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqw5fgosCan8hiawicP0icAxqfvOrUJ47XBn3hgyib8YOC13qb7UWnAUb0JlCcA7MF4jUUUg9ic4fr9acA/132","comment_is_top":false,"comment_ctime":1587530522,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1587530522","product_id":100020901,"comment_content":"老师，我最近遇到出现软中断比较高的情况，但是并非在网卡上，集中在TIMER和RCU上，两个参赛值都有上亿了，这个情况应该怎么排查？","like_count":0,"discussions":[{"author":{"id":2401422,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","nickname":"geek","note":"","ucode":"FF0845140D72A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549219,"discussion_content":"文件里面记录的是自开机以来的累计值，看变化有这么高吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643728302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207962,"user_name":"xuty","can_delete":false,"product_type":"c1","uid":1310250,"ip_address":"","ucode":"986CF5DCF02762","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/2a/5ee47dda.jpg","comment_is_top":false,"comment_ctime":1587223126,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587223126","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":172689,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579251952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579251952","product_id":100020901,"comment_content":"打卡，Day 9，在实际生产中，软中断导致的性能瓶颈大多是网络收发类型的，特别是网络接收的软中断。在碰到这类问题时，可以借用 sar、tcpdump 等工具，做进一步分析。sar 可以用来查看系统的网络收发情况，tcpdump用来抓包具体分析。","like_count":0},{"had_liked":false,"id":172355,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1579159990,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579159990","product_id":100020901,"comment_content":"D6 打卡","like_count":0},{"had_liked":false,"id":164235,"user_name":"丁小疯","can_delete":false,"product_type":"c1","uid":1631373,"ip_address":"","ucode":"8FD320587FB63C","user_header":"https://static001.geekbang.org/account/avatar/00/18/e4/8d/1c49755d.jpg","comment_is_top":false,"comment_ctime":1576912609,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1576912609","product_id":100020901,"comment_content":"请教案例中是如何判断的哪个端口受到了syn flood呢？","like_count":0,"discussions":[{"author":{"id":2401422,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","nickname":"geek","note":"","ucode":"FF0845140D72A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549221,"discussion_content":"抓包的时候指定了端口","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643728378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132000,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1246017,"ip_address":"","ucode":"6856180D7B2525","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/41/ba59e1ee.jpg","comment_is_top":false,"comment_ctime":1568002530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568002530","product_id":100020901,"comment_content":"在centos 7下，使用hping3，完全感觉不到慢，就是网络可能会丢包而已，其实是网络问题不是CPU使用率或者软中断导致的问题。","like_count":0},{"had_liked":false,"id":131595,"user_name":"Abu","can_delete":false,"product_type":"c1","uid":1301948,"ip_address":"","ucode":"297D7C7A2944E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/bc/8969d111.jpg","comment_is_top":false,"comment_ctime":1567821318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567821318","product_id":100020901,"comment_content":"请问老师，中断打散是否可以将&#47;proc&#47;interrupts文件里面的中断号取出来，然后以round robin方式平均分到所有CPU core上面呢？","like_count":0},{"had_liked":false,"id":124162,"user_name":"wking","can_delete":false,"product_type":"c1","uid":1294634,"ip_address":"","ucode":"47D52E4280D1E6","user_header":"https://static001.geekbang.org/account/avatar/00/13/c1/2a/e7102065.jpg","comment_is_top":false,"comment_ctime":1565831453,"is_pvip":false,"replies":[{"id":"45966","content":"你的意思是存储空间不够用？tcpdump的数据可以复制出来，这样就会只在抓取的那一会占用磁盘空间。也可以排查的时候加上过滤条件，只抓取关系的数据","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566132908,"ip_address":"","comment_id":124162,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565831453","product_id":100020901,"comment_content":"老师，你经常使用tcpdump，但是真正在线上环境是不能随便使用的。比如我们线上环境，如果使用tcpdump一分钟左右就产生1G的文档，有些问题也不是经常出现，如果一直使用tcpdump，系统受不了。老师，有什么好办法吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463037,"discussion_content":"你的意思是存储空间不够用？tcpdump的数据可以复制出来，这样就会只在抓取的那一会占用磁盘空间。也可以排查的时候加上过滤条件，只抓取关系的数据","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566132908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108785,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1561881558,"is_pvip":false,"replies":[{"id":"40094","content":"用的什么程序抓包？抓包对性能是有很大影响的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249491,"ip_address":"","comment_id":108785,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561881558","product_id":100020901,"comment_content":"不知道老师还看留言不，遇到一个问题请教，我用tcpreplay对另外一台机器的直连网卡p1p2去打流量，如果用我程序抓这个p1p2的包发现网卡lo的流量很大，对端发送的速度就上不去，如果不抓流量则流量上的去都体现在p1p2上了请问是什么原因，用sar看的流量情况","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456115,"discussion_content":"用的什么程序抓包？抓包对性能是有很大影响的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99038,"user_name":"羁绊12221","can_delete":false,"product_type":"c1","uid":1463686,"ip_address":"","ucode":"15B47C5053388A","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","comment_is_top":false,"comment_ctime":1559133991,"is_pvip":false,"replies":[{"id":"35814","content":"你看的是中断次数还是中断CPU使用率？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559280498,"ip_address":"","comment_id":99038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559133991","product_id":100020901,"comment_content":"老师好，我是从网络部分跳回来的，按照网络部分的说法，包达到网卡后通过DMA方式进入收包队列，然后通过硬中断将包拷贝到sk_buffer中，再通知软中断处理。。。在syn flood的场景中，应该硬中断和软中断次数都非常多才对，为什么只有软中断比较多，%softirq比较高？希望老师能解惑，非常感谢！！！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451943,"discussion_content":"你看的是中断次数还是中断CPU使用率？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559280498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98384,"user_name":"林贻民","can_delete":false,"product_type":"c1","uid":1202213,"ip_address":"","ucode":"F7185C61CAE4D0","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/25/2088864b.jpg","comment_is_top":false,"comment_ctime":1558973688,"is_pvip":false,"replies":[{"id":"35921","content":"中断拆分的目的就是减少上半部的工作，这样大部分工作都在下半部处理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559428783,"ip_address":"","comment_id":98384,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558973688","product_id":100020901,"comment_content":"老师您好，有个问题，既然中断分上部分（硬中断，快速处理）和下部分（软中断，消耗一定时间）， 那为什么， SYC FLOOD时只有软中断的CPU利用率升高而硬件中断的CPU使用率没有升高呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451670,"discussion_content":"中断拆分的目的就是减少上半部的工作，这样大部分工作都在下半部处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559428783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91710,"user_name":"shawn","can_delete":false,"product_type":"c1","uid":1516046,"ip_address":"","ucode":"1A52A00A0A6610","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIkkg9icSGleYMAnwlb7A9MMJYOdovl8kOCA0asMkDe6grPNF74ib0prQMicicJTNa1WsdpMJ4p1CWkUQ/132","comment_is_top":false,"comment_ctime":1557098228,"is_pvip":false,"replies":[{"id":"33121","content":"不是没有提高，而是提高了，但提高的不是很明显。不过，即便不明显，也是排查问题的线索","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557325650,"ip_address":"","comment_id":91710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557098228","product_id":100020901,"comment_content":"既然卡顿是由于网络攻击造成的，并且cpu的使用率没有提高，那么标题可否换一下呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448997,"discussion_content":"不是没有提高，而是提高了，但提高的不是很明显。不过，即便不明显，也是排查问题的线索","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557325650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91189,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1556895873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556895873","product_id":100020901,"comment_content":"把hping3调到u1去发动攻击，在node1上发现一种奇特的现象，cpu0 的使用率很低，但高软中断，会导致低的idle ，请教老师为什么会这样.<br>[root@master ~]# mpstat -P ALL 1<br>Linux 3.10.0-957.10.1.el7.x86_64 (master)       05&#47;03&#47;2019      _x86_64_        (2 CPU)<br><br>11:02:07 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>11:02:08 AM  all    0.00    0.00    0.00    0.00    0.00   44.79    0.00    0.00    0.00   55.21<br>11:02:08 AM    0    0.00    0.00    0.00    0.00    0.00   91.49    0.00    0.00    0.00    8.51<br>11:02:08 AM    1    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00<br><br>11:02:08 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>11:02:09 AM  all    0.51    0.00    1.02    0.00    0.00   43.65    0.00    0.00    0.00   54.82<br>11:02:09 AM    0    0.00    0.00    1.01    0.00    0.00   86.87    0.00    0.00    0.00   12.12<br>11:02:09 AM    1    0.00    0.00    1.03    0.00    0.00    0.00    0.00    0.00    0.00   98.97<br><br>11:02:09 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>11:02:10 AM  all    0.00    0.00    0.00    0.00    0.00   50.00    0.00    0.00    0.00   50.00<br>11:02:10 AM    0    0.00    0.00    0.00    0.00    0.00  100.00    0.00    0.00    0.00    0.00<br>11:02:10 AM    1    0.00    0.00    1.01    0.00    0.00    0.00    0.00    0.00    0.00   98.99<br><br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all    0.26    0.00    0.64    0.00    0.00   45.19    0.00    0.00    0.00   53.92<br>Average:       0    0.00    0.00    0.26    0.00    0.00   91.43    0.00    0.00    0.00    8.31<br>Average:       1    0.25    0.00    1.02    0.00    0.00    0.00    0.00    0.00    0.00   98.73<br>","like_count":0},{"had_liked":false,"id":90891,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1556714728,"is_pvip":false,"replies":[{"id":"33128","content":"仔细看的话，CPU使用率都有升高，只是可能没有你想象的那么高","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557326573,"ip_address":"","comment_id":90891,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556714728","product_id":100020901,"comment_content":"老师，我有个疑惑，cpu使用率和用户cpu和系统cpu，iowait还有软硬中断有关，我们这几篇讲iowait和软中断，都是软中断和iowait很高，但是cpu的使用率却并没有上升，如果没有直接关联性，那iowait和软硬中断怎么算影响cpu使用率的影响因子呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448711,"discussion_content":"仔细看的话，CPU使用率都有升高，只是可能没有你想象的那么高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557326573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89443,"user_name":"manatee","can_delete":false,"product_type":"c1","uid":1041112,"ip_address":"","ucode":"708D90E7A265BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg","comment_is_top":false,"comment_ctime":1556175476,"is_pvip":false,"replies":[{"id":"32226","content":"是不是被攻击机器已经做过调优了？或者被攻击机器本身性能比攻击机器高？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556370449,"ip_address":"","comment_id":89443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556175476","product_id":100020901,"comment_content":"继续打卡，使用hping3 即使设置参数为-i u10,被攻击的机器仍旧不卡。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448136,"discussion_content":"是不是被攻击机器已经做过调优了？或者被攻击机器本身性能比攻击机器高？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556370449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87844,"user_name":"王伟","can_delete":false,"product_type":"c1","uid":1046001,"ip_address":"","ucode":"ABA3781E6DD5DB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/f1/4b26ac7d.jpg","comment_is_top":false,"comment_ctime":1555730116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555730116","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":83342,"user_name":"Joe","can_delete":false,"product_type":"c1","uid":1033290,"ip_address":"","ucode":"79AC38C1F44D76","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/4a/c02c597b.jpg","comment_is_top":false,"comment_ctime":1554540576,"is_pvip":false,"replies":[{"id":"30185","content":"可以用iptraf或者iftop查看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554638267,"ip_address":"","comment_id":83342,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554540576","product_id":100020901,"comment_content":"从网络统计中看到很大的流量，有没有办法知道流量到底是访问哪个端口呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445985,"discussion_content":"可以用iptraf或者iftop查看","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1554638267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82787,"user_name":"冰凌","can_delete":false,"product_type":"c1","uid":1394578,"ip_address":"","ucode":"5C9EADFEDBF4E5","user_header":"https://static001.geekbang.org/account/avatar/00/15/47/92/f6a832c3.jpg","comment_is_top":false,"comment_ctime":1554306038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554306038","product_id":100020901,"comment_content":"1. 中断的理解<br>        中断本质上是一种异步的事件处理机制，可以提高系统的并发能力<br>        但是中断会打断程序的正常运行，所以为了减少对正常运行进程的影响，中断处理程序就需要尽可能快的运行。<br><br>2. 中断的处理事件过长和中断丢失怎么办？<br>         将中断处理过程分成两个部分，上半部和下半部<br>         上半部：快速处理中断，在中断禁止模式下运行，主要处理和硬件紧密相关或者时间敏感的工作<br>         下半部：延迟处理上半部未护理的工作，通常以内核线程的方式运行<br>          也可以这样理解：<br>          上半部：直接处理硬件请求，特点是快速执行<br>          下半部：常说的软中断，特点是延迟执行<br><br>3. Linux如何查看中断情况<br>          ／proc／softirqs提供了软中断的运行情况<br>            注意中断的类型（第一列），中断在各个CPU上的分布情况<br>           ／proc／interrupts提供了硬中断的运行情况<br>          <br>4. 发生软中断怎么办？<br>          很多情况下发生软中断都是网络收发类型的软中断，特别是网络接受的小包软中断<br>          首先通过／proc／softirqs观察软中断类型<br>           如果是网络软中断导致的，然后再通过sar和tcpdump工具来分析","like_count":0},{"had_liked":false,"id":79131,"user_name":"D.A.Y","can_delete":false,"product_type":"c1","uid":1238529,"ip_address":"","ucode":"A9B60EBE6AC011","user_header":"https://static001.geekbang.org/account/avatar/00/12/e6/01/ae2468f3.jpg","comment_is_top":false,"comment_ctime":1553362946,"is_pvip":false,"replies":[{"id":"29059","content":"也可以分享下你们最后怎么优化的？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526927,"ip_address":"","comment_id":79131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553362946","product_id":100020901,"comment_content":"之前我们的l3节点就是因为软中断跑到了4点几。ovs处理不过来。导致机器卡死，各种丢包，读完本章有了更深入的认识了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444366,"discussion_content":"也可以分享下你们最后怎么优化的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78796,"user_name":"JJj","can_delete":false,"product_type":"c1","uid":1196463,"ip_address":"","ucode":"EA53F2CEAFCFF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/af/4307867a.jpg","comment_is_top":false,"comment_ctime":1553241710,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553241710","product_id":100020901,"comment_content":"老师，您好，请问下：<br>1、有网络收发，硬中断怎么会是0<br>2、看上去软中断并没有使用大量的CPU，为什么会引起网络延迟这么严重","like_count":0},{"had_liked":false,"id":73817,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1552008489,"is_pvip":false,"replies":[{"id":"27327","content":"嗯嗯 监控看趋势","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552348557,"ip_address":"","comment_id":73817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552008489","product_id":100020901,"comment_content":"此问题的关键一部是如何判断因为中断导致的性能问题，中断指标不像其他那么直白，还是需要进行监控","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442293,"discussion_content":"嗯嗯 监控看趋势","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552348557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69312,"user_name":"平少","can_delete":false,"product_type":"c1","uid":1218742,"ip_address":"","ucode":"EC76D35D0C2CBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/b6/0c0ed771.jpg","comment_is_top":false,"comment_ctime":1550714976,"is_pvip":false,"replies":[{"id":"24842","content":"这时候就需要排查主要的性能都消耗到了哪里，这可以参考后面的网络模块来排查","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550849761,"ip_address":"","comment_id":69312,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550714976","product_id":100020901,"comment_content":"老师，你好，请问下我这边在对一台1核1G的服务器上部署的工程接口进行性能压测，发现cpu使用率30%多，但是si软终端占了10%多，根据提供的方法排查是小包问题，那这样该如何处理呢？并发上不去了，再调高的话延时会很高，请问下如何来优化使并发数上去呢？总的cpu使用率还不到50%","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440054,"discussion_content":"这时候就需要排查主要的性能都消耗到了哪里，这可以参考后面的网络模块来排查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550849761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67605,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1550207853,"is_pvip":false,"replies":[{"id":"24040","content":"嗯嗯，这正是我们专栏的目标。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325816,"ip_address":"","comment_id":67605,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550207853","product_id":100020901,"comment_content":"生产中常遇到看起来什么都正常没有做任何调整情况下，程序性能就是不行了，很无奈那种感觉急得我想钻进机器看看，学了老师的课多了很多手段，真的很值感谢老师。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439274,"discussion_content":"嗯嗯，这正是我们专栏的目标。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67277,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550120153,"is_pvip":false,"replies":[{"id":"24028","content":"这个应该没有标准，我见到的大多涉及小包的讨论都是 100 以下的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550324870,"ip_address":"","comment_id":67277,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550120153","product_id":100020901,"comment_content":"有个问题，网络收到的数据。平均每帧多少算是小包呢，文中是50字节，如果是200或者300字节算是小包吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439127,"discussion_content":"这个应该没有标准，我见到的大多涉及小包的讨论都是 100 以下的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550324870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66616,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1549967326,"is_pvip":false,"replies":[{"id":"23711","content":"看起来PPS比较小，可能是hping发的包被VM外面丢掉了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550069232,"ip_address":"","comment_id":66616,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549967326","product_id":100020901,"comment_content":"我用的是vmware虚拟机，网络连接是NAT,CPU是 I7 8750U 4C8T,运行案例场景时，并没有任何卡顿?<br>还有，我这边使用 sar命令查看的结果和你的差别很大是什么原因呢？<br>18时23分07秒     ens33   4462.00   2237.00    261.45    127.87      0.00      0.00      0.00     31.89","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438850,"discussion_content":"看起来PPS比较小，可能是hping发的包被VM外面丢掉了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550069232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65704,"user_name":"keyboard_chen_-","can_delete":false,"product_type":"c1","uid":1012204,"ip_address":"","ucode":"E95757BEAF5573","user_header":"https://static001.geekbang.org/account/avatar/00/0f/71/ec/bfecf21b.jpg","comment_is_top":false,"comment_ctime":1549596493,"is_pvip":false,"replies":[{"id":"23692","content":"是的，所以后面还有专门的网络模块，讲解网络的性能分析方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550066399,"ip_address":"","comment_id":65704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549596493","product_id":100020901,"comment_content":"这个案例刚好是其他进程cpu利用率低，假如其他进程利用率比较高时，是不是比较难定位是软中断的问题了？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438557,"discussion_content":"是的，所以后面还有专门的网络模块，讲解网络的性能分析方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550066399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63186,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1548294357,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548294357","product_id":100020901,"comment_content":"lesson 10打卡","like_count":0},{"had_liked":false,"id":57921,"user_name":"Kian.Lee","can_delete":false,"product_type":"c1","uid":1086568,"ip_address":"","ucode":"3FB08A00F2DFD7","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/68/56794ea3.jpg","comment_is_top":false,"comment_ctime":1546941372,"is_pvip":false,"replies":[{"id":"20992","content":"看来是压力还不够大 试试ping的延迟是不是没多大变化？也可以再增大压力试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547027898,"ip_address":"","comment_id":57921,"utype":1}],"discussion_count":1,"race_medal":5,"score":"1546941372","product_id":100020901,"comment_content":"老师，我的电脑一点都不卡，core i5 5 代 cpu，MacBook Pro 2014 13 寸，环境 vmware fusion，两台 ubuntu 1804，iTerm ssh 到 a ubuntu 开启 docker 80 端口，iTerm ssh 到 b ubuntu 运行 hping3，a ubuntu 中断 30% 左右，所有数据跟文章里的一样，但终端就是不卡，一点也不卡…","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435829,"discussion_content":"看来是压力还不够大 试试ping的延迟是不是没多大变化？也可以再增大压力试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547027898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57920,"user_name":"Kian.Lee","can_delete":false,"product_type":"c1","uid":1086568,"ip_address":"","ucode":"3FB08A00F2DFD7","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/68/56794ea3.jpg","comment_is_top":false,"comment_ctime":1546941371,"is_pvip":false,"discussion_count":0,"race_medal":5,"score":"1546941371","product_id":100020901,"comment_content":"老师，我的电脑一点都不卡，core i5 5 代 cpu，MacBook Pro 2014 13 寸，环境 vmware fusion，两台 ubuntu 1804，iTerm ssh 到 a ubuntu 开启 docker 80 端口，iTerm ssh 到 b ubuntu 运行 hping3，a ubuntu 中断 30% 左右，所有数据跟文章里的一样，但终端就是不卡，一点也不卡…","like_count":0},{"had_liked":false,"id":57047,"user_name":"kevinwang527","can_delete":false,"product_type":"c1","uid":1140629,"ip_address":"","ucode":"3EE30B2E3ADD8C","user_header":"https://static001.geekbang.org/account/avatar/00/11/67/95/5bd8911f.jpg","comment_is_top":false,"comment_ctime":1546607111,"is_pvip":false,"replies":[{"id":"22284","content":"是本机内部打的流量？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548246358,"ip_address":"","comment_id":57047,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546607111","product_id":100020901,"comment_content":"老师请问，为什么我用ping3把流量打过去，用sar查看确实可以看到流量加大，但是用cat查看软中断NET_RX没有变化，试了几次都是这样，不知道为什么求解答。 环境是mac内建的两台虚拟机。 谢谢<br> CPU0<br>          HI: 0<br>       TIMER: 72239<br>      NET_TX: 52<br>      NET_RX: 91<br>       BLOCK: 6500<br>    IRQ_POLL: 0<br>     TASKLET: 246<br>       SCHED: 71442<br>     HRTIMER: 0<br>         RCU: 87424","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435377,"discussion_content":"是本机内部打的流量？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548246358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54038,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1545788154,"is_pvip":false,"replies":[{"id":"19727","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545839992,"ip_address":"","comment_id":54038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545788154","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434336,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545839992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53899,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545750045,"is_pvip":false,"replies":[{"id":"19734","content":"当然可以监控的。后面这部分没太理解问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545840667,"ip_address":"","comment_id":53899,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545750045","product_id":100020901,"comment_content":"mark <br><br>老师，软中断使用的cpu资源不会被监控到吗？不是 应该是中断处理程序占满CPU么","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434286,"discussion_content":"当然可以监控的。后面这部分没太理解问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545840667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53439,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1545644856,"is_pvip":false,"replies":[{"id":"19437","content":"嗯嗯，机器配置不同，现象会差别，不过不影响分析的思路","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545694528,"ip_address":"","comment_id":53439,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545644856","product_id":100020901,"comment_content":"DAY10，打卡<br>我测试时输入：hping3 -S -p 80 -i u10 192.168.1.X ，<br>在被测试的虚拟机用top可以看到%Cpu(s)：<br>%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,100.0 si,  0.0 st<br>%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu2  :  0.0 us,  0.3 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu3  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>si已经明显高达100%了，ksoftirqd&#47;0的使用率也是100%，和老师的现象并不一样？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434140,"discussion_content":"嗯嗯，机器配置不同，现象会差别，不过不影响分析的思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545694528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52094,"user_name":"Schmilençé","can_delete":false,"product_type":"c1","uid":1257721,"ip_address":"","ucode":"4CD7341BD2F428","user_header":"https://static001.geekbang.org/account/avatar/00/13/30/f9/6dbf31a7.jpg","comment_is_top":false,"comment_ctime":1545309573,"is_pvip":true,"replies":[{"id":"18876","content":"开个虚拟机实践😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545312450,"ip_address":"","comment_id":52094,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545309573","product_id":100020901,"comment_content":"打卡。红帽内网服务器，还没研究怎么装docker，只能先看看效果了。。。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433738,"discussion_content":"开个虚拟机实践😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545312450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51713,"user_name":"腾达","can_delete":false,"product_type":"c1","uid":1079876,"ip_address":"","ucode":"72F9CFBA44FDEE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL9hlAIKQ1sGDu16oWLOHyCSicr18XibygQSMLMjuDvKk73deDlH9aMphFsj41WYJh121aniaqBLiaMNg/132","comment_is_top":false,"comment_ctime":1545227484,"is_pvip":false,"replies":[{"id":"18900","content":"类似的，根据类型找出相关的内核线程，然后再分析内核线程。这里其实需要你对这些中断的工作原理有一定了解","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545313738,"ip_address":"","comment_id":51713,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545227484","product_id":100020901,"comment_content":"除了网络，如果是其他类型的si，该如何判断是由何种程序引起的si? 先找到引起si的类型，再怎么找呢？本文里是通过&#47;proc&#47;softirqs找到类型，再通过sar找到网络问题，如果是其他类型的softirq，该如何办？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433592,"discussion_content":"类似的，根据类型找出相关的内核线程，然后再分析内核线程。这里其实需要你对这些中断的工作原理有一定了解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545313738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50575,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1545011086,"is_pvip":false,"replies":[{"id":"18491","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145491,"ip_address":"","comment_id":50575,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545011086","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433025,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49977,"user_name":"allan","can_delete":false,"product_type":"c1","uid":1142819,"ip_address":"","ucode":"CA0BE868AA9FF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/70/23/972dcd30.jpg","comment_is_top":false,"comment_ctime":1544805655,"is_pvip":false,"replies":[{"id":"18108","content":"你的环境有没有配防火墙？我怀疑是不是都给过滤掉了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004511,"ip_address":"","comment_id":49977,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544805655","product_id":100020901,"comment_content":"老师，我这里 测试，sar 输出显示 收发的字节数和网络帧数 都很小，只有 0.64kB&#47;s，每秒只有几帧 ，是怎么回事呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432821,"discussion_content":"你的环境有没有配防火墙？我怀疑是不是都给过滤掉了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49576,"user_name":"萧董","can_delete":false,"product_type":"c1","uid":1341895,"ip_address":"","ucode":"7AD87DE458F5B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqvaPTSYCtlXUc9DZxe6MWHeRJEKEr9fNPXMveWtia4Kic3BOicwCuRK6SVKymvvw9PZ5unxiaSukvSXQ/132","comment_is_top":false,"comment_ctime":1544719099,"is_pvip":false,"replies":[{"id":"17837","content":"发的快，写的可就慢多了，所有周末都花在调案例写新文章了😢","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745440,"ip_address":"","comment_id":49576,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544719099","product_id":100020901,"comment_content":"写的很好，希望每周在多更新几篇，看的不过瘾啊。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432666,"discussion_content":"发的快，写的可就慢多了，所有周末都花在调案例写新文章了😢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49515,"user_name":"燕羽阳","can_delete":false,"product_type":"c1","uid":1015063,"ip_address":"","ucode":"AF9430187F66EE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/17/179b24f4.jpg","comment_is_top":false,"comment_ctime":1544703627,"is_pvip":false,"replies":[{"id":"17822","content":"1. 是的，网络延迟变大了<br>2. 跟网卡、系统、应用都有关","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544743883,"ip_address":"","comment_id":49515,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544703627","product_id":100020901,"comment_content":"<br>请教一下：<br>1.卡的核心原因是因为pps比较高么？<br>2.pps的上限一般是由网卡确定么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432643,"discussion_content":"1. 是的，网络延迟变大了\n2. 跟网卡、系统、应用都有关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544743883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49437,"user_name":"威","can_delete":false,"product_type":"c1","uid":1068542,"ip_address":"","ucode":"C921CDCB22B9A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/fe/882eaf0f.jpg","comment_is_top":false,"comment_ctime":1544688144,"is_pvip":false,"replies":[{"id":"17824","content":"一般会有点影响，不过还是取决于具体的系统，比如单核比多核的影响肯定要大得多","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744373,"ip_address":"","comment_id":49437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544688144","product_id":100020901,"comment_content":"老师，虽然软中断高，导致shell会卡顿，但是目前cpu上使用率还是很低。<br>那假设现在有一个cpu密集型应用，这种情况下应该不会对这个应用造成很大影响吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432616,"discussion_content":"一般会有点影响，不过还是取决于具体的系统，比如单核比多核的影响肯定要大得多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49378,"user_name":"Rod","can_delete":false,"product_type":"c1","uid":1183042,"ip_address":"","ucode":"A3F675888D9061","user_header":"https://static001.geekbang.org/account/avatar/00/12/0d/42/22eae851.jpg","comment_is_top":false,"comment_ctime":1544674644,"is_pvip":false,"replies":[{"id":"17826","content":"会的，不要急😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744676,"ip_address":"","comment_id":49378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544674644","product_id":100020901,"comment_content":"老师赶紧说下磁盘问题吧，急用。我目前就是磁盘不释放，du和df命令差别很大，也没发现有僵尸进程，lsof也找不到指定分区下的deleted文件。脑壳痛！不知道咋办😂😂","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432599,"discussion_content":"会的，不要急😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49371,"user_name":"2xshu","can_delete":false,"product_type":"c1","uid":1188473,"ip_address":"","ucode":"71584CB9676EDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132","comment_is_top":false,"comment_ctime":1544673099,"is_pvip":false,"replies":[{"id":"17827","content":"嗯嗯，我也经常吐槽这个评论功能😓 碰到的问题可以先在留言分享一下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744755,"ip_address":"","comment_id":49371,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544673099","product_id":100020901,"comment_content":"谢谢老师的回答！极客时间居然不能对评论进行回答啊！！！<br>老师，什么时候开始内存的讲解啊。最近遇到一个坑爹的掉内存的问题。虽然解决了，但是不知道原理呢。期待老师的内存讲解部分","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432594,"discussion_content":"嗯嗯，我也经常吐槽这个评论功能😓 碰到的问题可以先在留言分享一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49316,"user_name":"Christmas","can_delete":false,"product_type":"c1","uid":1219172,"ip_address":"","ucode":"F48F6BE4A7595B","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/64/ad837224.jpg","comment_is_top":false,"comment_ctime":1544664410,"is_pvip":false,"replies":[{"id":"17831","content":"只有超过内核配置的网络选项之后才有告警","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745111,"ip_address":"","comment_id":49316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544664410","product_id":100020901,"comment_content":"Sync flood在var log里面会有报警的，所以如果仅仅是这个case的话有更容易的方法判断。当然小包问题需要用本文的方式。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432573,"discussion_content":"只有超过内核配置的网络选项之后才有告警","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49311,"user_name":"夜行观星","can_delete":false,"product_type":"c1","uid":1010389,"ip_address":"","ucode":"C880CB39033929","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/d5/73c75eb3.jpg","comment_is_top":false,"comment_ctime":1544663757,"is_pvip":false,"replies":[{"id":"17833","content":"不好意思，这个问题还真不清楚😢 不过你可以安装下试试，欢迎留言你的结果😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745200,"ip_address":"","comment_id":49311,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544663757","product_id":100020901,"comment_content":"老师，请教个问题，非x86架构，如arm或者mips下能够使用perf吗？若不能用，有啥好的可选工具呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432569,"discussion_content":"不好意思，这个问题还真不清楚😢 不过你可以安装下试试，欢迎留言你的结果😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49275,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1544659232,"is_pvip":false,"replies":[{"id":"17842","content":"+1","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745554,"ip_address":"","comment_id":49275,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544659232","product_id":100020901,"comment_content":"D10","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432554,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49171,"user_name":"LT","can_delete":false,"product_type":"c1","uid":1254920,"ip_address":"","ucode":"14EFAD348E85BB","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/08/a59f930b.jpg","comment_is_top":false,"comment_ctime":1544616432,"is_pvip":false,"replies":[{"id":"17660","content":"想要看到这么多数据，其实换其他工具也是类似的问题。可以试试导出到编辑器里","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660488,"ip_address":"","comment_id":49171,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1544616432","product_id":100020901,"comment_content":"如果设备cpu核数比较多，比如，40核的设备，cat &#47;proc&#47;softirqs每行在屏幕换行了，几乎没法看。有没有其他合适的查看工具<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432513,"discussion_content":"想要看到这么多数据，其实换其他工具也是类似的问题。可以试试导出到编辑器里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000023,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/57/3a7abbe9.jpg","nickname":"古思为","note":"","ucode":"5B01DD4BAEE130","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":55865,"discussion_content":"cat /proc/softirqs | less -S","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574407237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49162,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1544615006,"is_pvip":false,"replies":[{"id":"17662","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660499,"ip_address":"","comment_id":49162,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544615006","product_id":100020901,"comment_content":"源码安装hping3命令，实践观察验证。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432509,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49119,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1544606750,"is_pvip":false,"replies":[{"id":"17666","content":"这些中断要观察变化情况才有意义。试试调整hping3参数，观察下攻击方是因为什么导致的卡死","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660718,"ip_address":"","comment_id":49119,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544606750","product_id":100020901,"comment_content":"做了实验，攻击发起方hping3物理机卡死了，被攻击方好像没事，这是双方的软中断<br>hping3发起方<br>NET_TX:     465082      49231\t 55119      44929<br>NET_RX: 1345976657   95205644  100569762   93646694<br>被攻击端口方<br>NET_TX:\t   87992       3060\t  4018       3302\t2579\t   2496       3607 2538    <br>NET_RX:  752814284   73240931   74034870   65061558   59129909   55944945   54086050   51229292<br>老师怎么看起来发起攻击者自己把自己弄死机了，被攻击方没事这是什么原因","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432489,"discussion_content":"这些中断要观察变化情况才有意义。试试调整hping3参数，观察下攻击方是因为什么导致的卡死","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49077,"user_name":"holen","can_delete":false,"product_type":"c1","uid":1104199,"ip_address":"","ucode":"2C7D342AFE4DF0","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/47/247fd305.jpg","comment_is_top":false,"comment_ctime":1544599365,"is_pvip":false,"replies":[{"id":"17668","content":"不是，网络延迟的问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660752,"ip_address":"","comment_id":49077,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544599365","product_id":100020901,"comment_content":"执行 hping3 并没有导致我的服务器卡住， 我的服务器配置 2核4G 配置算低的， 但是从 vmstat 3 可以看出 中断数 和 上下文切换数 是有明显的升高。 导到卡是不是因为 中断数 跟 上下文切换数 变高了？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432476,"discussion_content":"不是，网络延迟的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49068,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1544598039,"is_pvip":false,"replies":[{"id":"17671","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660859,"ip_address":"","comment_id":49068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544598039","product_id":100020901,"comment_content":"老师你是不是写漏了，最关键的问题：为啥如此低的软中断会导致系统变的反应迟缓呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432472,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49055,"user_name":"郭江伟","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1544595884,"is_pvip":false,"replies":[{"id":"17673","content":"谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660895,"ip_address":"","comment_id":49055,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544595884","product_id":100020901,"comment_content":"在老师的例子上我补充一个正常的文件传输的例子作为对比：<br>该机器正在通过nfs往其他服务器拷贝文件用dstat查看：<br>[root@elmes fxnas]# dstat <br>----total-cpu-usage---- -dsk&#47;total- -net&#47;total- ---paging-- ---system--<br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw <br>  0   0  98   1   0   0| 365k  479k|   0     0 |   1B   16B| 308   842 <br>  0   3  76  21   0   0|  24M  236k| 238k   22M|   0     0 |6587  7070 <br>  0   3  77  20   0   0|  22M    0 | 265k   23M|   0     0 |7399  8275 <br>  0   3  77  19   0   0|  25M    0 | 232k   26M|   0     0 |7008  7388 <br>用sar查看：<br>sar -n DEV 5<br>02:17:42 PM     IFACE   rxpck&#47;s   txpck&#47;s    rxkB&#47;s    txkB&#47;s   rxcmp&#47;s   txcmp&#47;s  rxmcst&#47;s<br>02:17:47 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00<br>02:17:47 PM      eth0   4110.26   3316.90    269.08  23743.63      0.00      0.00      1.61<br>02:17:47 PM    virbr0      0.00      0.00      0.00      0.00      0.00      0.00      0.00<br>02:17:47 PM virbr0-nic      0.00      0.00      0.00      0.00      0.00      0.00      0.00<br>可以看到这种情况下发送包为每秒3316 ，发送字节数为每秒23743.63 KB     <br>另外用tcpdump跟踪：<br>14:15:11.823846 IP 172.16.9.74.ssh &gt; 172.16.9.72.4939: Flags [P.], seq 432448:433008, ack 6561, win 199, length 560<br>14:15:11.824120 IP 172.16.9.72.4939 &gt; 172.16.9.74.ssh: Flags [.], ack 431888, win 65535, length 0<br>14:15:11.824228 IP 172.16.9.74.ssh &gt; 172.16.9.72.4939: Flags [P.], seq 433152:433712, ack 6641, win 199, length 560<br>14:15:11.824261 IP 172.16.9.74.ssh &gt; 172.16.9.72.4939: Flags [P.], seq 433712:434272, ack 6641, win 199, length 560<br>14:15:11.824370 IP 172.xxx.72.4939 &gt; 172.1xxx.74.ssh: Flags [.], ack 433008, win 64415, length 0<br>可以看到发送的包长度比较长，并且flag是P，应答包长度为0 flag为.<br>模拟的案例length是0，flag是S ，并且非常频繁，也没有应答包基本可以判断为网络攻击，<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432467,"discussion_content":"谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49037,"user_name":"ichiro","can_delete":false,"product_type":"c1","uid":1086179,"ip_address":"","ucode":"D1708D87538F42","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/e3/1be13204.jpg","comment_is_top":false,"comment_ctime":1544593098,"is_pvip":false,"replies":[{"id":"17674","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660901,"ip_address":"","comment_id":49037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544593098","product_id":100020901,"comment_content":"老师，既然软中断并没有占用太多cpu资源，为啥会影响其他任务的性能？同问","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432463,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48969,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1544583685,"is_pvip":false,"replies":[{"id":"17679","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661290,"ip_address":"","comment_id":48969,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544583685","product_id":100020901,"comment_content":"想到sar可以看各网卡流量,就想来吐槽下腾讯云.<br>腾讯云的主机上eth0就是一个局域网ip,根本就看不到外网真实ip.<br>这个网卡上的流量就包含了与局域网中其他服务器通信的流量.<br>如果想看外网带宽的使用情况,还只能在网页上去查看.<br>以前阿里云上的服务器用ifconfig是可以看到一个网卡单独绑定的外网真实ip.","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432443,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48927,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1544578959,"is_pvip":false,"replies":[{"id":"17681","content":"前面已经看到PPS了呀","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661348,"ip_address":"","comment_id":48927,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544578959","product_id":100020901,"comment_content":"有两个问题：<br>   1，我的虚拟机使用lscpu 查看只有8<br>     使用cat &#47;proc&#47;softirqs查看却有128，导致观察很不方便<br>2，仅凭tcpdump发现一个syn包就断定是SYN FLOOD，感觉有些草断，正常情况下这种包应该也是很多的<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432422,"discussion_content":"前面已经看到PPS了呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48925,"user_name":"胡萝卜","can_delete":false,"product_type":"c1","uid":1056926,"ip_address":"","ucode":"306139A86C182D","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/9e/3278e1d8.jpg","comment_is_top":false,"comment_ctime":1544578736,"is_pvip":false,"replies":[{"id":"17682","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661354,"ip_address":"","comment_id":48925,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544578736","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432421,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48905,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1544577227,"is_pvip":false,"replies":[{"id":"17688","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661602,"ip_address":"","comment_id":48905,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544577227","product_id":100020901,"comment_content":"D10打卡，现象：终端变卡，cpu负载较低。top命令显示ksoftirq进程较多。<br>分析: 可能是网络问题引起的软中断太多。<br>切入点: sar 分析报告 tcpdump抓包 得到结论 ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432412,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48895,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1544576434,"is_pvip":false,"replies":[{"id":"17689","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661606,"ip_address":"","comment_id":48895,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544576434","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432407,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48881,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1544575615,"is_pvip":false,"replies":[{"id":"17690","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661611,"ip_address":"","comment_id":48881,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544575615","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432403,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48880,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1544575614,"is_pvip":false,"replies":[{"id":"17693","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661817,"ip_address":"","comment_id":48880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544575614","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432402,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48865,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1544574343,"is_pvip":false,"replies":[{"id":"17695","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661835,"ip_address":"","comment_id":48865,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544574343","product_id":100020901,"comment_content":"day11打卡<br>软中断包括网络收发、定时、调度、RCU 锁等各种类型，而定时，调度，RCU锁都是系统自身保障正常运行必须的，所以软中断基本就绝大部分是网络收发引起的。 &#47;proc&#47;softirqs ，观察软中断的运行情况。<br>发生软中断时，cpu总体占用率可能不高，但软中断使用率会有变化，可以通过sar 查看网卡收发情况，用tcpdump抓包分析，直接的解决手段是封来源IP，期待后续能通过优化内核参数之类的来解决","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432393,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48859,"user_name":"铁皮","can_delete":false,"product_type":"c1","uid":1013200,"ip_address":"","ucode":"E20FB02D9ABD20","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/d0/0053c9ba.jpg","comment_is_top":false,"comment_ctime":1544573477,"is_pvip":false,"replies":[{"id":"17698","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661939,"ip_address":"","comment_id":48859,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544573477","product_id":100020901,"comment_content":"满满的干货，发现自己每天都有进步。谢谢老师。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432391,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48844,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1544570351,"is_pvip":false,"replies":[{"id":"17697","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661934,"ip_address":"","comment_id":48844,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1544570351","product_id":100020901,"comment_content":"【D10打卡】<br>今天学习的是软中断CPU使用率升高的案例，实际中一般性能瓶颈在网络收发的软中断。一般使用sar、tcpdump进行分析包，找到原因。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432382,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48843,"user_name":"俊飞","can_delete":false,"product_type":"c1","uid":1137490,"ip_address":"","ucode":"A67B07520E0715","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/52/fea5ec99.jpg","comment_is_top":false,"comment_ctime":1544570058,"is_pvip":false,"replies":[{"id":"17699","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661944,"ip_address":"","comment_id":48843,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544570058","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432381,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48827,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1544545097,"is_pvip":false,"replies":[{"id":"17702","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662073,"ip_address":"","comment_id":48827,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544545097","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432374,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}