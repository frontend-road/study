{"id":323701,"title":"01 | 业务初探：扫了二维码之后发生了什么？","content":"<p>你好，我是任杰。今天我们进入第一个模块：金融业务及系统。</p><p>通过这个模块，我会带你了解常见的金融业务有哪些，盈利模式又是怎样的。了解了业务端的规律，我们就可以沿着这个线索推导出相应的系统核心需求以及具体组件，推测出相对应的系统设计要点。有了这些铺垫，后面我们动手去设计金融架构的时候，你的思路就会更加清晰。</p><p>金融业务有很多种，按业务模式划分，包括交易类业务和信贷类业务两种。今天是课程的第一讲，我想带你了解一个标志性的交易类业务，也就是扫码支付。</p><p>虽然扫码支付非常普遍，但是它并不简单。把这个内容安排在第一讲，我有这样三点考量：</p><p>第一，是扫码支付最具有代表性，扫码支付是现在最常见的金融场景。</p><p>第二，传统银行业务的标志性机构大多都参与到了扫码支付的过程当中，你可以通过扫码支付来了解国家金融系统的运作原理。</p><p>第三，是扫码业务同时具有互联网应用和机构应用的技术特点。扫码支付既要对接互联网用户，也要对接金融机构。你可以了解不同的架构设计思想和他们之间沟通的方式。</p><p><strong>总之，一旦你理解了扫码支付，也就在金融技术这个领域入了门。\b</strong>现在就让我们从第三方支付出发，一起来探索扫了二维码之后发生了什么吧。</p><h2>情景假设</h2><p>扫码支付其实也分很多场景。但我们是不可能把所有的场景都讲一遍，我们在这里需要做更进一步的选择。一方面要典型，另一方面又要能给你多介绍一些参与机构。综合考虑后，我选择了与跨境电商相关的扫码跨境支付场景，具体的假设有这些：</p><!-- [[[read_end]]] --><p>1.付款方用户支付的是人民币。<br>\n2.付款方的借记卡是国内银行A发行的，简称<strong>买家开户行</strong>。<br>\n3.第三方支付公司的备付金账户在国内银行B，简称<strong>第三方开户行</strong>。<br>\n4.收款方接受的是美元。<br>\n5.收款方的借记卡是国外银行C发行的，简称<strong>卖家开户行。</strong><br>\n6.第三方公司是通过银行D进行外币兑换业务，简称<strong>汇兑提供行</strong>。</p><p>由于国内对人民币相关的外汇交易有管制，本外币交易需要满足一定要求，比如要求电商平台有对应的交易明细。为了方便你理解，我们假设已经在其他部分完成了相应的合规流程。</p><p>那么接下来，我会分4个部分给你讲解整个支付过程：用户扫码支付、第三方公司进行本币代收、外汇交易以及外币代付。</p><h2>用户扫码</h2><p>扫二维码支付显然是以用户扫码作为整个业务的起点。从终端用户的角度来看，扫码由鉴权、支付和拉取状态三个步骤组成。接下来，我们就来详细看看这几个步骤。</p><h3>鉴权</h3><p>扫码支付最终会用买家的银行卡进行支付。在你开始扫码支付之前，第三方公司需要核实你是否有这张卡的使用权，俗称“绑卡”。</p><p>那第三方公司是怎么验证用户的使用权呢？在国内，我们一般采用下面这4个要素来进行验证：</p><ol>\n<li>用户姓名</li>\n<li>用户身份证号码</li>\n<li>银行卡号码</li>\n<li>银行注册的手机号</li>\n</ol><p>这4个要素都是银行记录的信息，因此虽然看起来你是在第三方支付公司的App上进行绑卡操作，其实是银行在背后进行相关信息的验证工作。</p><p>由于这4个要素都是电子信息，可能会被人盗用，所以为了进一步增强安全性，银行在验证手机号码的时候还需要验证你是否拥有这个手机号码。具体的方式是发一条验证码给在你在银行柜台办借记卡时注册的手机号码。</p><p>结合前面的内容，我们可以把鉴权的过程分为4步：第1步，用户填写前3个要素和手机号码；第2步，银行发短信验证码给用户手机号；第3步，用户将前3个要素和短信验证码发给第三方支付公司；第4步，第三方支付公司再将所有信息发送给银行进行确认。</p><p>所以鉴权的过程其实是验证了5个信息，其中4个是静态信息，1个是动态信息。</p><p>在用户绑卡通过之后，银行会返回给第三方支付公司这个用户的内部ID信息（也叫Token）。之后第三方支付公司就可以拿这个ID进行所有合法的操作。</p><p>刚才给你讲解的流程示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/59/32/59bef589edd40a17ccfb71b2334b9132.png?wh=1920*926\" alt=\"\"></p><h3>支付</h3><p>鉴权完成之后，就可以扫二维码，进行支付了。二维码其实是一个图形化的字符串，背后是这笔交易对应的订单。当用户点击“确认”之后，就会开始整个支付流程。</p><h3>拉取支付状态</h3><p>那为什么需要拉取支付状态呢？我们还是从台前转到幕后，从系统功能的角度思考。</p><p>用户App的支付确认按钮是有局限的，它只能确认后台是否已经收到了支付请求，并不能确认支付是否已经成功。这是因为支付后台需要花一些时间和银行沟通，在这个期间后台并不知道银行的支付流程进行到了哪一步。</p><p>由于不知道支付什么时候才能完成，用户App需要每隔一段时间就向支付后台拉取交易情况，我们通常会把这个过程叫作<strong>轮询</strong>。这个过程一般在几百毫秒内就能结束，所以你一般察觉不到延时。</p><p>那为什么会出现轮询这种系统对接方式呢？金融机构每天会面对大量的用户资金操作，这些操作的时间和频率有很大的偶然性。</p><p>为了应对用户操作的峰值情况，金融机构普遍通过<strong>异步消息处理</strong>的架构来对极端流量进行削峰填谷。如果流量突然增大，异步消息架构会缓存所有请求，慢慢处理。这样就能避免核心金融系统超载。异步消息架构的结果就是用户不会及时得到处理结果，需要自己不断地去查询处理情况。</p><p>当银行处理完支付后，银行会把支付成功的消息推送给用户和第三方支付公司。第三方支付公司也会推送给你支付成功的消息。所以你在扫码支付成功后，通常还能听到两个手机消息通知的声音。</p><p>到这里我们看到了两种不同的获取最新状态的方式。一种是用户定期去拉取状态，另一种是服务器将状态消息实时推送给用户。这种<strong>推拉结合</strong>的消息通知方式，其实是架构设计中常见的异步系统处理方式。支付状态获取的流程图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/cc/b1/cc4e483abaf4a4b12a741fec9bb30bb1.jpg?wh=3200*1800\" alt=\"\"></p><h2>本币代收</h2><p>前面我们假设了这笔支付涉及到外汇交易，由于买家的和卖家使用的币种不同，就无法直接转账。这时候就需要第三方支付公司这个中间人来帮忙了。中间人角色要做3件事情：</p><p>1.本币代收<br>\n2.外汇交易<br>\n3.外币代付</p><p>我先给你说说本币代收，也就是第三方支付公司代收用户资金。通俗一点来说，本币代收就是将你该付的钱先打到第三方支付公司账上。</p><p>由于第三方支付公司的账号和买家的银行卡在两家不同的银行，本币代收需要进行跨行转账。跨行转账会涉及到整个银行系统的大小额系统和超级网银等，非常复杂。所以这里我们对场景进行一些简化，但是会和现实有一些出入，主要是方便你理解。</p><h3>央行和清算机构</h3><p>跨行转账的时候，钱是在不同的银行。因此我们想要实现跨行转账，就需要解决两个问题。<strong>第一个问题是怎么将钱在两家银行之间转来转去，另一个问题是转的金额是多少。</strong></p><p>我们先看第一个问题，那就是怎么跨行搬钱。最直接的方法是用汽车将钱从一家银行的金库搬到另一家银行。但这个方法其实不太实用，汽车能运的钱重量有限，路上也不太安全。所以钱最好不要挪动地方。</p><p>这时候又需要另一个第三方机构出马了。所有银行都在这个新的第三方机构里放足够多的钱，一般叫做<strong>存款准备金</strong>。当两家银行之间需要转账的时候，第三方机构在内部搬运一下就好。比如美国的黄金交易所就是这种工作模式，每个客户都有自己专属的黄金仓库，很多小车在仓库之间搬运黄金。</p><p>如果这个第三方机构足够可信，那么连内部搬运都不需要。这个第三方机构只需要记录一下谁的钱有多少，以及从哪里搬了多少到另一个地方就行。信用级别最高的金融机构就是国家的中央银行，简称<strong>央行</strong>。<strong>所以央行解决了真实资金的转移问题。</strong></p><p>我们再来看另一个问题，那就是怎么知道转移的金额有多少。会有这个问题的原因是每天银行之间的跨行交易非常多，不可能每一笔都通过央行转一次钱。所以银行系统对跨行转账的流程进行了优化。那就是在白天只做记录，不进行<strong>任何实质性的跨行转账</strong>。等每天结束的时候计算一下两个银行之间交易金额的差额是多少，最后通过央行进行一笔跨行转账就可以了。这种计算交易差额的方式叫做<strong>轧差</strong>。</p><p>这个记录白天跨行转账细节和晚上进行交易轧差的第三方机构叫作<strong>清算机构</strong>。你熟悉的银联及网联，以及国外的万事达，它们都是清算机构。</p><p>前面我们在介绍拉取支付状态的时候，讲过金融系统采用异步消息处理架构应对支付流量。轧差是另一种金融机构应对大流量的一种处理方式。<strong>轧差的本质是实时消息的批量处理</strong>，从某种程度来讲是延时更大的异步处理框架。</p><h3>跨行转账流程</h3><p>讲完央行和清算机构之后，我们就可以对跨行转账过程做一个详细的梳理了。整个过程分为七步：</p><p>第一步，第三方支付公司发送指令给<strong>第三方开户行</strong>，要求将钱从用户的<strong>买家开户行</strong>转到<strong>第三方开户行</strong>。</p><p>第二步，第三方支付公司拥有用户在<strong>买家开户行</strong>的Token，所以可以合法发起这笔转账。跨行转账流程开始。</p><p>接着到了第三步，<strong>第三方开户行</strong>将所有信息交给清算机构。<strong>清算机构</strong>作为第三方负责记录这些信息，并通知<strong>买家开户行</strong>和<strong>第三方开户行</strong>记录这笔转账。</p><p>第四步，<strong>买家开户行</strong>记录的结果是对用户的账号进行扣款。扣款结束后用短信的方式通知用户。</p><p>然后是第五步，<strong>第三方开户行</strong>记录的结果是对第三方支付公司的账号进行打款。打款结束后第三方支付公司可以通过银行网页看到对公账户金额发生变化。白天的工作到此结束。此时<strong>买家开户行</strong>的账面上的资金虽然减少，但是减少的钱并没有实质性到达<strong>第三方开户行</strong>。</p><p>第六步，到了晚上，<strong>清算机构</strong>对白天发生的交易进行盘存，发现有一笔从<strong>买家开户行</strong>到<strong>第三方开户行</strong>的跨行转账还没有真正完成。<strong>清算机构</strong>会将这笔未完成的跨行转账信息发送给<strong>央行</strong>。</p><p>还有最后一步，<strong>央行</strong>收到信息之后，将<strong>买家开户行</strong>在央行的存款准备金调低，并将<strong>第三方开户行</strong>在央行的存款准备金调高。这样钱就真正地从<strong>买家开户行</strong>转到了<strong>第三方开户行</strong>。</p><p>这七步的示意图如下：<br>\n<img src=\"https://static001.geekbang.org/resource/image/a0/44/a05832c24e6370d3096c27cb3a6f5944.png?wh=1920*1444\" alt=\"\"></p><h2>外汇交易</h2><p>转账交易的第二步是第三方支付公司进行外汇交易。当第三方支付公司完成了用户的本币代扣之后，第三方支付公司账上就有了对应的人民币。接下来的一步是将这些人民币变成美元，这样才能将美元转给国外的卖家。</p><p>那么外汇交易的过程又是怎样的呢？按照交易量的大小，可以分为C端外汇零售业务和B端外汇批发业务两个部分。</p><h3>C端外汇零售业务</h3><p>外汇交易和电商一样，也是一个买卖的过程。第三方支付公司作为中间人，需要用人民币购买美元。那美元从哪里购买呢？人民币有外汇管制，不能随意买卖，需要通过一些有特殊资质的银行才行。如果外汇不涉及到人民币，那么选择面会宽泛很多，银行、投行或者其他金融机构都可以。</p><p>账务原理建议一个账号只处理同一个币种的交易。外汇交易涉及到两个币种的货币，因此需要两个不同的账号。</p><p>在这节课的最开始，我假设了第三方支付公司是通过<strong>汇兑提供行</strong>进行外汇交易的。那么第三方公司需要在<strong>汇兑提供行</strong>里建两个账号，一个人民币账号和一个美元账号。同时，汇兑提供行内部也需要有对应两个币种的账号，一个对应着人民币资金池，另一个则是美元资金池。</p><p>所以，一笔外币的购买涉及到4个账号之间的2笔支付订单。交易过程的示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/33/12/3359eb5e5b0d08c3a1cc5bb27b2ec512.png?wh=1920*1197\" alt=\"\"></p><p>外汇交易完成之后，第三方支付公司在<strong>汇兑提供行</strong>的人民币账户金额减少，美元账户金额增加。这样第三方支付公司就有了足够的美元来支付给卖家。</p><p>我们需要注意的是，外汇交易是有成本的。第一个成本是<strong>时间成本</strong>。当天购买的外汇可能隔天才到账。另一个成本是<strong>交易成本</strong>。外汇交易一般会按照交易次数收费。因此为了节省成本，第三方支付公司通常会提前购买大量的外汇，用来应对日间的业务。只有当外汇储备下降到警戒线之后再做下一笔大额外汇的购买。</p><p>讲到这里，我们解决了第三方支付公司美元账户不足的问题，但是它用来购汇的人民币账户一直在往外出钱，总会有枯竭的一天，又该怎么办呢。</p><p>所以我们还需要考虑从外部调资金进来。由于第三方支付公司的备付金账户在<strong>第三方开户行</strong>，因此需要做从<strong>第三方开户行</strong>到<strong>汇兑提供行</strong>的跨行转账，示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/75/84/75a91b3a675a8a1db40499cf2275fd84.png?wh=1920*1071\" alt=\"\"></p><p>但是第三方公司在<strong>第三方开户行</strong>的账户也在一直出钱，我们往上推演一步，就会发现第三方开户行账户也需要有进来资金的渠道。这个是由前面我们提到的本币代收的过程实现的。我们把买家出资的流程补充完整。整个过程的示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/0a/d3/0a01f80965bcb884cd488e1ee50712d3.png?wh=1920*868\" alt=\"\"></p><p>这样梳理下来，你是不是觉得我们已经考虑得足够全面了呢？</p><p>其实这里还有一个问题需要我们考虑：<strong>汇兑提供行</strong>帮助第三方支付公司实现了外汇购买。但是<strong>汇兑提供行</strong>的美元账户一直在出钱。那这个美元账户钱不够了怎么办？这时候<strong>汇兑提供行</strong>需要从其他银行寻求帮助。这个过程就涉及到了B端外汇批发交易。</p><h3>B端外汇批发业务</h3><p>前面提到的电商相关的外汇交易属于外汇的零售业务。银行、投行和其他外汇提供商之间形成了一个有层级的跨国组织，专门从事外汇的批发业务。批发业务的业务量非常巨大，通常每天都有几万亿美元的规模。</p><p>外汇市场是按照交易量大小来划分层次的。最底层的是面对终端用户的外汇零售商。这些零售商负责给一般用户提供小额的外汇交易。这些小笔的外汇交易汇集在一起之后，就会形成一笔大的外汇订单，然后继续往上层交易。</p><p>和底层的外汇零售商一样，上一层的机构将所有外汇交易汇集在一起之后，形成更大的外汇订单，再往更上一层交易。</p><p>一直往上汇集这种事情不会永无止境地进行下去。这个流程的尽头是全球最大的<strong>外汇做市商</strong>，一般是巨型的跨国商业银行。</p><p>这些跨国商业银行面对的是全球不同国家大量的储蓄用户，所以它们手上就拥有不同币种的巨额存款。这些做市商之间通过<strong>交换不同币种的大额固定利息存折</strong>来实现外汇交易，从而决定最终汇率。示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/92/fa/92c49aa31fc90f61f15a962f94ddd6fa.png?wh=1920*1672\" alt=\"\"></p><p>之前我给你提到过外汇交易有时间成本，当天购买的外汇需要隔天才能到账。在这一天的时间间隔之内，外汇市场可能会有巨大的波动，从而造成金融机构账面上的资金亏损。所以，参与外汇业务的金融机构都会处理外汇相关的市场风险，比如用期货、期权等衍生品来对冲风险。这些金融衍生品，我们会在后面的章节详细展开，这里你先有个印象就行。</p><p>为了方便你理解，我们把到目前为止的流程画一个简单的示意图：</p><p><img src=\"https://static001.geekbang.org/resource/image/4c/12/4c3dd63bf3be60824c525007bd270e12.png?wh=1920*1398\" alt=\"\"></p><h2>外币代付</h2><p>外币代付流程和本币代收流程在原则上是一样的。不同点在于外币代付的金额是美元，流出账号是第三方支付公司的美元账号。由于卖家的账号在<strong>卖家开户行</strong>，第三方支付的美元账号在<strong>汇兑提供行</strong>，这时候需要走的是国际的清结算过程。</p><p>流程的核心思想和之前的类似，只是具体的细节会更加复杂。下图展示了简化版的支付流程。</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/21/b56afd2d461efef5e2757d37b6bafd21.png?wh=1920*1173\" alt=\"\"></p><h2>小结</h2><p>用户在扫码支付前需要证明自己合法拥有银行卡，需要给开卡行提供<strong>4要素</strong>：姓名、身份证、银行卡号和手机号。验证通过后便可以开始支付流程。支付完成后用户可以通过轮询的方式<strong>异步获取支付状态</strong>。异步处理是金融机构应对支付流量的一种架构设计。</p><p>在第三方支付公司收到支付请求后，开始进行本币代收业务。由于账号设立的关系，需要进行跨行转账。此时清算中心和央行一起提供了跨行转账功能。跨行转账一般采用了日间交易、日终轧差结算的方式进行。轧差处理是金融机构应对支付流量的另一种架构设计。</p><p>第三方支付公司在完成本币代收业务之后，还要进行汇兑业务，具体分为外汇零售业务和批发业务。如果涉及外币代付业务，第三方支付公司还需要借助国际清结算组织的相关功能。</p><p>你需要注意的是，二维码支付涉及的大多数环节都是<strong>异步系统</strong>，比如用户App的异步支付状态查询，以及清算中心和央行及银行之间的跨行转账清结算过程。异步系统不会将结果同步返回给调用方。因此，我们在设计系统的时候，<strong>就需要支持状态的查询以及状态消息的推送功能。</strong></p><p>本节课的知识点整体的结构图如下：<br>\n<img src=\"https://static001.geekbang.org/resource/image/20/a9/20321d2ec6c580db82f3f6yycc756ea9.jpg?wh=3075*2327\" alt=\"\"></p><h2>思考题</h2><p>第三方支付公司在做外汇交易的时候，不会只碰到单一方向的汇兑业务。既然有人民币到美元的转换，那么也会碰到美元到人民币的转换。汇兑提供商的收费只和交易数量有关，和交易币种无关。如果你是负责第三方支付公司的资金管理，你有什么方法能进一步降低汇兑成本吗？</p><p>欢迎留言和我分享你的想法。如果学了这节课让你有所收获，也欢迎把这篇文章分享给你的朋友，一起交流和讨论支付系统的问题。</p>","comments":[{"had_liked":false,"id":270243,"user_name":"Jerry Wu","can_delete":false,"product_type":"c1","uid":1203567,"ip_address":"","ucode":"AD29B6942AAAA6","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","comment_is_top":false,"comment_ctime":1609001910,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"87508347830","product_id":100067701,"comment_content":"虽然整个过程经过简化，但我还是有些懵。好在回答完思考题，思路清晰了些，请老师指教。<br><br>作为第三方支付公司，该怎么降低汇兑成本？<br><br>首先，第三方支付公司的业务仅限于一个国家，那只能在现有的交易流程优化。<br><br>比如，你的支付服务只在中国能用，中国客户转账到国外，却没有国外客户转帐进来。那么，你只能老老实实走外汇交易的流程，但也是能降低汇兑成本的。<br><br>你可以低价买一大笔外汇，降低汇率、时间、交易等风险；又或者找投资银行，让他们用掉期合约规避你的汇率、交易、库存等风险；再或者，转账机制能不能优化，像是最低金额、到账时间之类的。<br><br>然后，第三方支付公司有多国业务，那自建资金池能进一步降低成本。<br><br>比如，你的支付服务中美两开花，中国客户转账到美国，美国客户转账到中国。那么，你可以建两个资金池，一个装人民币，一个装美元。如果发生转账，你划上两笔，一笔划在中国资金池上，一笔划在美国资金池上。<br><br>如果走到这一步，原有的交易流程就被简化了，你可以看看这个例子。<br><br>假设汇率是 7，有 A 客户转 700 人民币到美国，那么你只需要在 A 客户的账上减去 700 人民币，你的人民币-资金池增加 700，美元-资金池减少 100。与此同时，有个 B 客户要转 100 美元到中国，那么 B 客户的账上减去 100 美元，你的美元-资金池增加 100，人民币资金池减少 700。<br><br>在这个例子中，你把这两笔交易结合起来看，会发现一个有趣的现象。人民币-资金池先增加 700，然后又减少 700；美元-资金池先减少 100，然后又增加 100。换句话说，你两个资金池里的钱不增不减。<br><br>这样一来，你相当于踢开了外汇市场，自己就能走完中美转账的流程。当然，资金池的花样很多，现实也没这么理想，你还是离不开外汇市场，但也够你省下一大笔，给员工买辣条了。<br><br>综上所述，如果第三方支付公司的业务仅限于一国，要降低汇兑成本，可以买一大笔外汇，找投资银行，优化用户转账机制；如果第三方支付公司的业务遍布多国，要进一步降低汇兑成本，可以自建资金池。","like_count":21,"discussions":[{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"吴小智","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386924,"discussion_content":"同问，这合法吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627893720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072711,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/47/b73d24b3.jpg","nickname":"Dong·YE0","note":"","ucode":"72DBF4A1EF517A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387033,"discussion_content":"没有汇兑行做对手交易 自己报汇率吃损益 这损益风险谁来背。另外 这么操作要外汇牌照了吧🌚🌚🌚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627956996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264392,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg","nickname":"丁乐洪","note":"","ucode":"549CE57AB20B49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349503,"discussion_content":"资金池违规吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613271445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270013,"user_name":"飞翔的企鹅","can_delete":false,"product_type":"c1","uid":1246652,"ip_address":"","ucode":"BB531FA5A4AFF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/bc/4fbab441.jpg","comment_is_top":false,"comment_ctime":1608878678,"is_pvip":false,"replies":[{"id":"97936","content":"飞翔的企鹅你好。备付金的管理一般属于司库（Treasury）或者财务（Finance）部门来管理。<br><br>如果第三方金融机构不允许挪用备付金，那么资金永远是足够的。<br><br>如果允许第三方金融机构部分或者全部挪用备付金，那么有可能出现不足的情况。这时候监管机构会要求金融机构预留一定百分比的备付金作为缓冲，因此会留给金融机构几天的预警时间。<br><br>如果万一真的资金不够了，机构之间对接的时候会出现机构账户余额不足的错误。这时候会导致大面积用户支付业务失败。由于备付金里的钱的所有者是用户，这笔钱对于金融公司来说是一笔债务。无法还债会导致金融公司破产，所以后果不堪设想。<br><br>备付金的管理属于金融行业的流动性风险管理（liquidity risk management）。它需要对过去的资金行为进行统计分析和预测，是一门以统计和经验为主的学科，也是人工智能可能会发挥巨大作用的一个场所。","user_name":"作者回复","user_name_real":"任杰","uid":"2068304","ctime":1608999602,"ip_address":"","comment_id":270013,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48853518934","product_id":100067701,"comment_content":"我想知道银行的备付金不够会怎样？","like_count":12,"discussions":[{"author":{"id":2068304,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8f/50/612732c9.jpg","nickname":"任杰","note":"","ucode":"CB79E0CFF8E068","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512489,"discussion_content":"飞翔的企鹅你好。备付金的管理一般属于司库（Treasury）或者财务（Finance）部门来管理。\n\n如果第三方金融机构不允许挪用备付金，那么资金永远是足够的。\n\n如果允许第三方金融机构部分或者全部挪用备付金，那么有可能出现不足的情况。这时候监管机构会要求金融机构预留一定百分比的备付金作为缓冲，因此会留给金融机构几天的预警时间。\n\n如果万一真的资金不够了，机构之间对接的时候会出现机构账户余额不足的错误。这时候会导致大面积用户支付业务失败。由于备付金里的钱的所有者是用户，这笔钱对于金融公司来说是一笔债务。无法还债会导致金融公司破产，所以后果不堪设想。\n\n备付金的管理属于金融行业的流动性风险管理（liquidity risk management）。它需要对过去的资金行为进行统计分析和预测，是一门以统计和经验为主的学科，也是人工智能可能会发挥巨大作用的一个场所。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608999602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270352,"user_name":"Geek_74107b","can_delete":false,"product_type":"c1","uid":1521315,"ip_address":"","ucode":"85425A027D4A68","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/FoE5JTn2hmicRVXiatP2ibbe10CTbiassOskjkqDWaWZ4dDIw4Z9KMrALLPIkVfdIbLYB5ro4U7AQ0elPtVDibt31sA/132","comment_is_top":false,"comment_ctime":1609078288,"is_pvip":false,"replies":[{"id":"98244","content":"这位同学你好。比特币这些加密货币的出现改变了大家对信用体系的看法。在传统的金融体系下，机构的信用体系依靠的是国家背书，因此采用的是集中决策机制。如果一个交易涉及到多个决策主体，那么就需要这些主体之间互相沟通，或者通过清算主体来代为沟通。这就是为什么流程比较长的原因。加密货币由于采用了分散决策，所有主体都参与到了决策过程，所以就不需要清算的过程。但是加密货币是以牺牲交易速度为代价的，在监管和合规方面也有很多需要加强的地方，需要合理的看待。加密货币带来了一些货币数字化的思考，我们国家也在试点数字人民币，你有兴趣可以关注这方面的进展。<br><br>清算机构的出现有历史原因。比如银联是本世纪初为了解决银行卡的通用问题出现的。前面已经提到过，清算机构是所有集中决策的机构都认可的信用最高的第三方。所以重要的是它的权力和权力的来源，而不是它的形式。","user_name":"作者回复","user_name_real":"任杰","uid":"2068304","ctime":1609259558,"ip_address":"","comment_id":270352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31673849360","product_id":100067701,"comment_content":"您好任老师，第一章就非常烧脑，但是让我更好的理解了比特币xrp之类的虚拟币跨国转账的价值，因为流程要简化太多了，交易即清算！<br>另外在这个场景里，我理解第三方支付可以看成一个银行间的中介，清算机构属于银行间的会计负责记账，央行作为一个完全中心化的背书机构，负责银行间的最终转账清算。<br>那我的疑问是，清算机构存在意义是什么呢？ 为什么不能让央行去兼容它的记账职责呢？ 是因为它是央行的“缓存”，为了减轻央行的压力？","like_count":8,"discussions":[{"author":{"id":2068304,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8f/50/612732c9.jpg","nickname":"任杰","note":"","ucode":"CB79E0CFF8E068","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512593,"discussion_content":"这位同学你好。比特币这些加密货币的出现改变了大家对信用体系的看法。在传统的金融体系下，机构的信用体系依靠的是国家背书，因此采用的是集中决策机制。如果一个交易涉及到多个决策主体，那么就需要这些主体之间互相沟通，或者通过清算主体来代为沟通。这就是为什么流程比较长的原因。加密货币由于采用了分散决策，所有主体都参与到了决策过程，所以就不需要清算的过程。但是加密货币是以牺牲交易速度为代价的，在监管和合规方面也有很多需要加强的地方，需要合理的看待。加密货币带来了一些货币数字化的思考，我们国家也在试点数字人民币，你有兴趣可以关注这方面的进展。\n\n清算机构的出现有历史原因。比如银联是本世纪初为了解决银行卡的通用问题出现的。前面已经提到过，清算机构是所有集中决策的机构都认可的信用最高的第三方。所以重要的是它的权力和权力的来源，而不是它的形式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609259558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270611,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1609170291,"is_pvip":false,"replies":[{"id":"98214","content":"谢谢你的肯定，加油，咱们一起学习进步！","user_name":"编辑回复","user_name_real":"赵宇新","uid":"1501385","ctime":1609237310,"ip_address":"","comment_id":270611,"utype":2}],"discussion_count":2,"race_medal":0,"score":"23084006771","product_id":100067701,"comment_content":"小小的二维码支付，金融业务还真多。牵涉多个银行用户账户，多家银行。本节学到了不少的金融名词。","like_count":5,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"听水的湖","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512689,"discussion_content":"谢谢你的肯定，加油，咱们一起学习进步！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609237310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341906,"discussion_content":"俺也一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610540091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269221,"user_name":"小动物","can_delete":false,"product_type":"c1","uid":1031683,"ip_address":"","ucode":"BCC35CE768EB99","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/03/404edf37.jpg","comment_is_top":false,"comment_ctime":1608560437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23083396917","product_id":100067701,"comment_content":"尽可能自建资金池，不在用户交易时进行兑换，直接使用池子中的资金。同时资金池在满足业务的情况下尽可能的最大化，，，类似股票里的高抛低吸。","like_count":5},{"had_liked":false,"id":275860,"user_name":"三产","can_delete":false,"product_type":"c1","uid":1104814,"ip_address":"","ucode":"7D0AAC8A36387C","user_header":"https://static001.geekbang.org/account/avatar/00/10/db/ae/41b6c60b.jpg","comment_is_top":false,"comment_ctime":1611709358,"is_pvip":true,"replies":[{"id":"100788","content":"三产同学你好。个人支付业务的资金量只占银行日常资金量很小的一部分，大部分的资金往来是企业的对公业务，因此银行的准备金受个人支付业务影响不大。之所以有每日限额的原因更多是为了保护个人消费者。<br><br>转账一定有手续费，因为转账不是免费的公益服务，而是商业行为。手续费可能由用户支付，或者由支付公司支付，这取决于支付公司自己的盈利模式和发展战略。","user_name":"作者回复","user_name_real":"任杰","uid":"2068304","ctime":1612591409,"ip_address":"","comment_id":275860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14496611246","product_id":100067701,"comment_content":"老师，一般网上支付都会有每日限额，并且不同银行限额不同，这个是不是和存款准备金有关呢？<br>转账有手续费，是否也是因为转账会涉及清算机构，清算机构会收取一部分费用，而转账业务并不会为发起转账机构产生利益所以这部分费用需要用户自行支付呢？","like_count":4,"discussions":[{"author":{"id":2068304,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8f/50/612732c9.jpg","nickname":"任杰","note":"","ucode":"CB79E0CFF8E068","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514506,"discussion_content":"三产同学你好。个人支付业务的资金量只占银行日常资金量很小的一部分，大部分的资金往来是企业的对公业务，因此银行的准备金受个人支付业务影响不大。之所以有每日限额的原因更多是为了保护个人消费者。\n\n转账一定有手续费，因为转账不是免费的公益服务，而是商业行为。手续费可能由用户支付，或者由支付公司支付，这取决于支付公司自己的盈利模式和发展战略。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612591409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269884,"user_name":"楼下小黑哥","can_delete":false,"product_type":"c1","uid":1014680,"ip_address":"","ucode":"453B099B0EE52E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/98/8f1aecf4.jpg","comment_is_top":false,"comment_ctime":1608826745,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5903794041","product_id":100067701,"comment_content":"因为限定了交易费用跟交易数量有关，所以为了减少费用就需要减少汇兑次数。<br>第一，发生汇兑的时候 ，仅记录信息流，日终的时候计算需要汇总总金额，再去真正汇兑。<br>第二，既然存在两个方向的互相汇兑，那么两边账户都有相应的资金。<br>那如果里面资金足够代付，那其实无需汇兑。举个例子<br>假设当前人民币账户余额100w，美元账户100w。而当天如果仅需要美元账户代付50w，那么这个时候都无需购汇，直接使用账户内余额即可<br>","like_count":1},{"had_liked":false,"id":269449,"user_name":"aderm","can_delete":false,"product_type":"c1","uid":1068825,"ip_address":"","ucode":"1C8FCBA02AEA34","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/19/05834ca2.jpg","comment_is_top":false,"comment_ctime":1608650886,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5903618182","product_id":100067701,"comment_content":"第三方支付公司可以无限建立外汇资金池，只有当发生外汇资金池钱不够时，才和外汇提供商进行一次大额交易。同时存在双向外汇交易，也就能保证外汇资金池波动变小","like_count":1},{"had_liked":false,"id":269262,"user_name":"garlic","can_delete":false,"product_type":"c1","uid":1019579,"ip_address":"","ucode":"FEB147EDB5774E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/bb/c039dc11.jpg","comment_is_top":false,"comment_ctime":1608594400,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"5903561696","product_id":100067701,"comment_content":"参考日间交易，日终轧差模式， 轧差后再进行外汇交易。 ","like_count":1},{"had_liked":false,"id":355207,"user_name":"哈哈哈哈哈哈哈哈","can_delete":false,"product_type":"c1","uid":1120350,"ip_address":"广东","ucode":"8186E8CF7D39BE","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/5e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1661171030,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661171030","product_id":100067701,"comment_content":"有什么相关偏业务的书推荐吗老师","like_count":0},{"had_liked":false,"id":350844,"user_name":"风","can_delete":false,"product_type":"c1","uid":1147929,"ip_address":"","ucode":"AFDBEFA49F269E","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/19/7ed2ffa6.jpg","comment_is_top":false,"comment_ctime":1657253685,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657253685","product_id":100067701,"comment_content":"老师，每天晚上才进行储备金转账，但是我看实际生活中，跨行转账可以当天完成的呀，麻烦老师帮忙解惑","like_count":0},{"had_liked":false,"id":350842,"user_name":"风","can_delete":false,"product_type":"c1","uid":1147929,"ip_address":"","ucode":"AFDBEFA49F269E","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/19/7ed2ffa6.jpg","comment_is_top":false,"comment_ctime":1657251918,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657251918","product_id":100067701,"comment_content":"最后通过央行进行一笔跨行转账就可以了。这种计算交易差额的方式叫做轧差。<br>每天跨行转账的业务很多吧，每天晚上把这些支付汇总成一笔支付指令，是只需要汇总总额从买方开户行备用金账户打款到第三方开户行，第三方开户行根据记录将总额打到第三方公司的账户吗？","like_count":0},{"had_liked":false,"id":350840,"user_name":"风","can_delete":false,"product_type":"c1","uid":1147929,"ip_address":"","ucode":"AFDBEFA49F269E","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/19/7ed2ffa6.jpg","comment_is_top":false,"comment_ctime":1657250746,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657250746","product_id":100067701,"comment_content":"然后是第五步，第三方开户行记录的结果是对第三方支付公司的账号进行打款。打款结束后第三方支付公司可以通过银行网页看到对公账户金额发生变化。白天的工作到此结束。此时买家开户行的账面上的资金虽然减少，但是减少的钱并没有实质性到达第三方开户行。<br>1、这个打款结束只是扣减买方账户的余额吗？这个时候第三方通过银行网页是可以看到自己的账户金额增加，但是钱还没有实际到第三方的账户吗？<br>2、第三方开户行准备金收到钱之后，再从准备金账户将款打给第三方支付公司的账户？","like_count":0},{"had_liked":false,"id":346307,"user_name":"stonejianbu","can_delete":false,"product_type":"c1","uid":2648637,"ip_address":"","ucode":"EDC0732496ECFB","user_header":"https://static001.geekbang.org/account/avatar/00/28/6a/3d/0529b877.jpg","comment_is_top":false,"comment_ctime":1653012383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653012383","product_id":100067701,"comment_content":"解：<br>既然汇兑提供商的收费只和交易数量有关，明显的解决方案是少次多兑，管理多种币的资金池<br>但是考虑到汇率是变动的，各种币的资金池积压而没能资金最大化使用<br>所以还要权衡市场汇率变动的因素以及自身汇兑业务量<br>如果有政策限制原因还得做相应调整等等<br>最后根据自己情况来决定每次汇兑量以进一步降低汇兑成本。","like_count":0},{"had_liked":false,"id":324943,"user_name":"云师兄","can_delete":false,"product_type":"c1","uid":1010459,"ip_address":"","ucode":"4475AF1598FBFD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6b/1b/4b397b80.jpg","comment_is_top":false,"comment_ctime":1638751959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638751959","product_id":100067701,"comment_content":"清算机构作为第三方负责记录这些信息，并通知买家开户行和第三方开户行记录这笔转账。<br>这个操作非原子性，中间需要分布式事务处理机制吗","like_count":0},{"had_liked":false,"id":311497,"user_name":"bearlu","can_delete":false,"product_type":"c1","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1631257089,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1631257089","product_id":100067701,"comment_content":"老师。会不会存在第三方机构。存在多个银行账户，交易的时候就不需要跨行转账？","like_count":0},{"had_liked":false,"id":307507,"user_name":"liupan","can_delete":false,"product_type":"c1","uid":1612910,"ip_address":"","ucode":"C6C7C48BCCAE12","user_header":"https://static001.geekbang.org/account/avatar/00/18/9c/6e/01b4d5d2.jpg","comment_is_top":false,"comment_ctime":1629127253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629127253","product_id":100067701,"comment_content":"目前在银行做金融，和转账也经常有关联，但更多的是关注银行内部的处理逻辑。感觉目前接触的扫码和刚刚读到的有一定差异，扫码很少外币场景，主要是做银行自身内部逻辑，因此流程上有所差异，银行与银行之间还有通道没有体现","like_count":0},{"had_liked":false,"id":300789,"user_name":"羿达","can_delete":false,"product_type":"c1","uid":1659275,"ip_address":"","ucode":"48559E9D480C34","user_header":"https://static001.geekbang.org/account/avatar/00/19/51/8b/e3b827b7.jpg","comment_is_top":false,"comment_ctime":1625387200,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625387200","product_id":100067701,"comment_content":"老师,这个情景中商户接受美元,买家如何确定该支付多少人民币啊?汇率转换的过程在哪一步完成?实在二维码生成之前就已经完成了吗","like_count":0},{"had_liked":false,"id":299235,"user_name":"学习使人快乐","can_delete":false,"product_type":"c1","uid":1478759,"ip_address":"","ucode":"1EC27CE663EE65","user_header":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","comment_is_top":false,"comment_ctime":1624521717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624521717","product_id":100067701,"comment_content":"有没有课代表做个笔记分享出来","like_count":0},{"had_liked":false,"id":299233,"user_name":"学习使人快乐","can_delete":false,"product_type":"c1","uid":1478759,"ip_address":"","ucode":"1EC27CE663EE65","user_header":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","comment_is_top":false,"comment_ctime":1624521018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624521018","product_id":100067701,"comment_content":"老师图用什么软件画的","like_count":0},{"had_liked":false,"id":280047,"user_name":"wulab","can_delete":false,"product_type":"c1","uid":2379579,"ip_address":"","ucode":"496CDD4F853A3B","user_header":"https://static001.geekbang.org/account/avatar/00/24/4f/3b/e1f67cc2.jpg","comment_is_top":false,"comment_ctime":1614065339,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614065339","product_id":100067701,"comment_content":"降低汇兑成本的想法不知是否可行<br>  1.  敞口管理风险管控<br>  2. 传统的建模往往需要专业的算法人员进行业务理解，可以基于预测智能化的形式来做交易量预测、资金流动性管控，降低外汇购汇成本<br>","like_count":0},{"had_liked":false,"id":273159,"user_name":"Ellie","can_delete":false,"product_type":"c1","uid":1604390,"ip_address":"","ucode":"DC9D6AE471765E","user_header":"https://static001.geekbang.org/account/avatar/00/18/7b/26/67157c40.jpg","comment_is_top":false,"comment_ctime":1610459308,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610459308","product_id":100067701,"comment_content":"首先在本币和外币账户上储备足够的资金，进行本、外币内部流动，并在两个账户设定触发汇兑的阈值，当外币账户余额低于阈值时购买一定数额外币，当本币账户余额低于阈值时卖出一定数额外币，可以监控外汇买卖交易频率，优化本、外币账户的汇兑阈值。","like_count":0},{"had_liked":false,"id":272031,"user_name":"_你说了不算","can_delete":false,"product_type":"c1","uid":1185159,"ip_address":"","ucode":"212F890565FE5C","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/87/d22d8c3e.jpg","comment_is_top":false,"comment_ctime":1609914783,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609914783","product_id":100067701,"comment_content":"每天都在用扫码支付，原来每笔交易后藏着这么东西，这篇文章需要反复读一下啊。","like_count":0},{"had_liked":false,"id":271976,"user_name":"Geek_fd2f7c","can_delete":false,"product_type":"c1","uid":1903069,"ip_address":"","ucode":"8412D99B3509DE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erObO6EFRxGTiaJBt2RPf1Q7qveic9pQVAUuHX2jAia1eBtszk9ZHlXDibRMspkolacZ9A29YZ6Ga6jBg/132","comment_is_top":false,"comment_ctime":1609900716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609900716","product_id":100067701,"comment_content":"汇兑提供行自己轧差成一笔然后进行","like_count":0},{"had_liked":false,"id":271716,"user_name":"Better me","can_delete":false,"product_type":"c1","uid":1261959,"ip_address":"","ucode":"CADF08D357489A","user_header":"https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg","comment_is_top":false,"comment_ctime":1609766701,"is_pvip":true,"replies":[{"id":"98634","content":"这位同学你好。提前做外币的代付除了需要支付公司垫资外，没有什么影响，其实一些跨境支付公司为了提高体验还会提前做外币代付。<br><br>这节课为了方便理解，假设所有步骤都是按顺序一一执行。时间上有一些可以并行或者提前处理的步骤，主要还是看业务方有多少资金量，想要提高多少体验和能承担多少风险。","user_name":"作者回复","user_name_real":"任杰","uid":"2068304","ctime":1609937921,"ip_address":"","comment_id":271716,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1609766701","product_id":100067701,"comment_content":"老师您好，以下几个问题还不太清楚，希望老师解惑<br>1、一笔跨境交易中在本币代收的央行准备金调拨之前就发起了外汇交易会有什么影响吗？<br>按道理来说是会先用上第三方公司在汇兑提供行的人民币账户余额，但这里人民币账户的资金来源是买家账户。<br>2、央行准备金轧差的交易方式、外汇交易的时间成本对整个交易流程周期会有什么影响吗","like_count":0,"discussions":[{"author":{"id":2068304,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8f/50/612732c9.jpg","nickname":"任杰","note":"","ucode":"CB79E0CFF8E068","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513017,"discussion_content":"这位同学你好。提前做外币的代付除了需要支付公司垫资外，没有什么影响，其实一些跨境支付公司为了提高体验还会提前做外币代付。\n\n这节课为了方便理解，假设所有步骤都是按顺序一一执行。时间上有一些可以并行或者提前处理的步骤，主要还是看业务方有多少资金量，想要提高多少体验和能承担多少风险。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609937921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270470,"user_name":"glutton","can_delete":false,"product_type":"c1","uid":1200223,"ip_address":"","ucode":"F73A9EC0C83E53","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/5f/d10a39c4.jpg","comment_is_top":false,"comment_ctime":1609141454,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1609141454","product_id":100067701,"comment_content":"节省成本的话，是不是这样:<br>支付的人民币和外币也做一个日终轧差<br>最终只需要支付一笔人民币或者是外币，这样行不？","like_count":0,"discussions":[{"author":{"id":2940659,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/de/f3/91dbd7da.jpg","nickname":"Mark","note":"","ucode":"28132BA4855996","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572533,"discussion_content":"汇兑提供行不能做轧差的，它只是个&#34;卖货币的电商&#34;，货币需要提前购买，汇兑行的美元账户有钱，才可以实时转账给卖家（这里要注意，卖家是能实时收到钱的），所以解决频繁购买货币的办法，就是在两个货币的户头，都存够足额的钱，这样两个户头的钱就会不断浮动，但是只要不到警戒线，就不用去购买货币，不过这样带来的问题是资金成本太大，所以钱也不是存越多越好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652840711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":270468,"user_name":"glutton","can_delete":false,"product_type":"c1","uid":1200223,"ip_address":"","ucode":"F73A9EC0C83E53","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/5f/d10a39c4.jpg","comment_is_top":false,"comment_ctime":1609141194,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609141194","product_id":100067701,"comment_content":"老师好，有个问题想讨论下:<br>备付金集中存管后，已经没有支付机构备付金银行了吧？<br>情景假设的第三点，是不是有点儿问题？","like_count":0},{"had_liked":false,"id":269216,"user_name":"Arvin","can_delete":false,"product_type":"c1","uid":1636235,"ip_address":"","ucode":"E3DB5171058118","user_header":"https://static001.geekbang.org/account/avatar/00/18/f7/8b/854a9a7a.jpg","comment_is_top":false,"comment_ctime":1608558728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608558728","product_id":100067701,"comment_content":"第三方支付机构的备付金已经全额上缴央行","like_count":0},{"had_liked":false,"id":269197,"user_name":"Geek_e36d41","can_delete":false,"product_type":"c1","uid":2199852,"ip_address":"","ucode":"6B4AB568F1EE98","user_header":"","comment_is_top":false,"comment_ctime":1608554799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608554799","product_id":100067701,"comment_content":"既然是按数量收费，那么每个账户都定制一个最低金额，当做汇率转换时，如果没有达到限额，就在自己的币种账户做汇率转换，当达到最低限额时，将购买对应的币种，减少和外汇零售的交互","like_count":0}]}