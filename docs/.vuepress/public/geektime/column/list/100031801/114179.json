{"id":114179,"title":"11 | 如何通过Node.js实现一套最简单的信令系统？","content":"<p>通过前面几篇文章的讲解，我想现在你应该已经对 WebRTC 有了一个清楚的认知了。接下来的章节咱们就使用 WebRTC 逐步实现一套真实可用的 1 对 1 实时直播系统吧。</p><p>WebRTC 1.0 规范对 WebRTC 要实现的功能、API 等相关信息做了大量的约束，比如规范中定义了如何采集音视频数据、如何录制以及如何传输等。甚至更细的，还定义了都有哪些 API，以及这些API 的作用是什么。但这些约束只针对于客户端，并没有对服务端做任何限制。</p><p>那WebRTC规范中为什么不对服务器也做约束呢？其实，这样做有以下三点好处。</p><ul>\n<li><strong>第一点，可以集中精力将 WebRTC 库做好</strong>。WebRTC的愿景是使浏览器能够方便地处理音视频相关的应用，规范中不限制服务端的事儿，可以使它更聚焦。</li>\n<li><strong>第二点，让用户更好地对接业务</strong>。你也清楚，信令服务器一般都与公司的业务有着密切的关系，每家公司的业务都各有特色，让它们按照自已的业务去实现信令服务器会更符合它们的要求。</li>\n<li><strong>第三点，能得到更多公司的支持</strong>。WebRTC扩展了浏览器的基础设施及能力，而不涉及到具体的业务或产品，这样会更容易得到像苹果、微软这种大公司的支持，否则这些大公司之间就会产生抗衡。</li>\n</ul><p>当然，这样做也带来了一些坏处，最明显的一个就是增加了学习 WebRTC 的成本，因为你在学习WebRTC的时候，必须<strong>自己去实现信令服务器</strong>，否则你就没办法让 WebRTC 运转起来，这确实增加了不少学习成本。</p><!-- [[[read_end]]] --><p>不过有了本专栏，你就不用再担心这个问题了。接下来，我就向你讲解一下，<strong>如何实现一套最简单的 WebRTC 信令服务系统</strong>。有了这套信令服务系统，WebRTC就能运转起来，这样你就能真正地体验到 WebRTC 的强大之处了。</p><h2>在WebRTC 处理过程中的位置</h2><p>在开始讲解 WebRTC 信令服务器之前，我们先来看一下本文在 WebRTC 处理过程中的位置。</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/3e/a7489c842514a707501afd1953d82a3e.png?wh=1142*509\" alt=\"\"></p><center><span class=\"reference\">WebRTC处理过程图</span></center><p>通过上面这幅图，你可以清楚地知道本文所讲的主要内容就是红色方框中的<strong>信令服务器</strong>部分。</p><h2>WebRTC信令服务器的作用</h2><p>你若想要实现 WebRTC 信令服务器，首先就要知道它在 WebRTC 1 对 1 通信中所起的作用。实际上它的功能是蛮简单的，就是<strong>进行信令的交换，但作用却十分关键。在通信双方彼此连接、传输媒体数据之前，它们要通过信令服务器交换一些信息，如媒体协商</strong>。</p><p>举个例子，假设 A 与 B 要进行音视频通信，那么 A 要知道 B 已经上线了，同样，B 也要知道 A 在等着与它通信呢。也就是说，<strong>只有双方都知道彼此存在，才能由一方向另一方发起音视频通信请求，并最终实现音视频通话</strong>。比如我们在<a href=\"https://time.geekbang.org/column/article/111675\">《08 | 有话好商量，论媒体协商》</a>一文中讲的媒体信息协商的过程就是这样一个非常典型的案例，双方的 SDP 信息生成后，要通过信令服务器进行交换，从而达到媒体协商的目的。</p><p>那在 WebRTC 信令服务器上要实现哪些功能，才能实现上述结果呢？我想至少要实现下面两个功能：</p><ol>\n<li><strong>房间管理</strong>。即每个用户都要加入到一个具体的房间里，比如两个用户 A 与 B 要进行通话，那么它们必须加入到同一个房间里。</li>\n<li><strong>信令的交换</strong>。即在同一个房间里的用户之间可以相互发送信令。</li>\n</ol><h2>信令服务器的实现</h2><p>了解了 WebRTC 信令服务器的作用，并且还知道了信令服务器要实现的功能，接下来我们就操练起来，看看如何实现信令服务器吧！我将从下面5个方面来向你逐步讲解如何实现一个信令服务器。</p><h3>1. 为什么选择 Node.js？</h3><p>要实现信令服务器，你可以使用 C/C++、Java 等语言一行一行从头开始编写代码，也可以以现有的、成熟的服务器为基础，做二次开发。具体使用哪种方式来实现，关键看你的服务器要实现什么功能，以及使用什么传输协议等信息来决策。</p><p>以我们要实现的信令服务器为例，因它只需要传输几个简单的信令，而这些信令既可以使用 TCP、 HTTP/HTTPS传输，也可以用 WebSocket/WSS 协议传输，所以根据它使用的传输协议，你就可以很容易地想到，通过 Web 服务器（如Nginx、Node.js）来构建我们的信令服务器是最理想、最省时的、且是最优的方案。</p><p>你可以根据自己的喜好选择不同的 Web 服务器（如 Apache、Nginx 或 Node.js）来实现，而今天我们选择的是Node.js，所以接下来我们将要讲解的是<strong>如何使用 Node.js 来搭建信令服务器</strong>。</p><p>实际上，Apache、Nginx和Node.js都是非常优秀、且成熟的Web服务器，其中 Nginx 可以说是性能最好的Web服务器了，但<strong>从未来的发展角度来说，Node.js则会更有优势</strong>。</p><p><strong>Node.js 的最大优点是可以使用 JavaScript 语言开发服务器程序</strong>。这样使得大量的前端同学可以无缝转到服务器开发，甚至有可能前后端使用同一套代码实现。对于使用 JavaScript 语言实现全栈开发这一点来说，我想无论是对于个人还是对于企业都是极大的诱惑。更可贵的是 <strong>Node.js 的生态链非常完整</strong>，有各种各样的功能库，你可以根据自己的需要通过安装工具（如 NPM）快速将它们引入到你的项目中，这极大地提高了 JavaScript 研发同学的开发效率。</p><p>Node.js 的核心是V8（JavaScript）引擎，Node.js通过它解析JavaScript 脚本来达到控制服务器的目的。对于 JavaScript 同学来说，Node.js的出现是革命性的，它不仅让 JavaScript 同学成为了全栈开发工程师，而且还让JavaScript开发同学的幸福指数飙升，真正地感受到了 JavaScript 无所不能的能力。对于我这样的开发“老鸟”来说，10年前还不敢想象通过 JavaScript 来写服务器程序呢，现在它却已成为现实！</p><p>当然， Node.js 不仅可以让你用 JavaScript 控制服务器，它还为你留了拓展接口，这些拓展接口甚至可以让你使用 C/C++ 为它编写模块，这样 Node.js 的功能就更加强大了。</p><h3>2. Node.js的基本工作原理</h3><p><img src=\"https://static001.geekbang.org/resource/image/38/3f/380311a689cf4adc1dff6fdb91aa8b3f.png?wh=1142*692\" alt=\"\"></p><center><span class=\"reference\">Node.js 工作原理图</span></center><p>Node.js的工作原理如上图所示，其核心是 V8 引擎。通过该引擎，可以让 JavaScript 调用 C/C++方法或对象。反过来讲，通过它也可以让 C/C++ 访问JavaScript方法和变量。</p><p>Node.js 首先将 JavaScript 写好的应用程序交给 V8 引擎进行解析，V8理解应用程序的语义后，再调用 Node.js 底层的 C/C++ API将服务启动起来。所以 <strong>Node.js 的强大就在于JavaScript 与 C/C++ 可以相互调用，从而达到使其能力可以无限扩展的效果</strong>。</p><p>我们以Node.js开发一个 HTTP 服务为例，Node.js 打开侦听的服务端口后，底层会调用 libuv 处理该端口的所有 HTTP 请求。其网络事件处理的过程就如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/6b/fe606ed87d72b94c4e65da9d6148b26b.png?wh=1142*746\" alt=\"\"></p><center><span class=\"reference\">Node.js 事件处理模型图</span></center><p>当有网络请求过来时，首先会被插入到一个事件处理队列中。libuv会监控该事件队列，当发现有事件时，先对请求做判断，如果是简单的请求，就直接返回响应了；如果是复杂请求，则从线程池中取一个线程进行异步处理。</p><p>线程处理完后，有两种可能：一种是已经处理完成，则向用户发送响应；另一种情况是还需要进一步处理，则再生成一个事件插入到事件队列中等待处理。事件处理就这样循环往复下去，永不停歇。</p><h3>3. 安装与使用 Node.js</h3><p>了解了 Node.js的基本原理后，接下来我们还是要脚踏实地来看看具体如何安装、使用Node.js。</p><p><strong>（1）安装Node.js</strong></p><p>不同环境下安装 Node.js的方法也不一样，不过都很简单。</p><p>在Ubuntu系统下执行：</p><pre><code>apt install nodejs\n</code></pre><p>或在Mac 系统下执行：</p><pre><code>brew install nodejs\n</code></pre><p>通过以上步骤，Node.js 很快就安装好了（我这里安装的 Node.js版本为：v8.10.0）。</p><p><strong>（2）安装 NPM</strong></p><p>除了安装 Node.js 之外，还要安装NPM（Node Package Manager），也就是 Node.js 的包管理器，或叫包安装工具。它与 Ubuntu 下的 APT（Advanced Package Tool）命令或 Mac 系统下的 BREW 命令类似，是专门用来管理各种依赖库的。</p><p>以Linux为例，在 APT 没有出现之前，在Linux上安装软件是件特别麻烦的事儿，比如要安装一个编辑器，其基本步骤有如下:</p><ul>\n<li>先将这个工具（编辑器）的源码下载下来；</li>\n<li>执行./configure 生成Makefile 文件；</li>\n<li>执行 make 命令对源码进行编译；</li>\n<li>如果编译成功，执行 <code>make install</code> 将其安装到指定目录下；</li>\n<li>如果编译过程中发现还需要其他库，则要对依赖库执行前面的4步，也就是先将依赖库安装好，然后再来安装该工具。</li>\n</ul><p>由这你可以看出，以前在Linux下安装个程序或工具是多么麻烦。</p><p>不过 Linux 有了 APT工具后，一切都变得简单了。你只要执行<code>apt install xxx</code>一条命令就好了，它会帮你完成上面的一堆操作。</p><p>对于 Node.js的安装包也是如此，<strong>NPM就是相当于 Linux 下的 APT 工具，它的出现大大提高了JavaScript 开发人员的工作效率</strong>。</p><p>下面我们就来看一下如何安装 NPM 工具，实际上，NPM 的安装就像前面安装 Node.js 一样简单。</p><p>在Ubuntu下执行：</p><pre><code>apt install npm\n</code></pre><p>或在Mac下执行：</p><pre><code>brew install npm\n</code></pre><h3>4. Socket.io的使用</h3><p>除了 Node.js 外，我们最终还要借助Socket.io来实现 WebRTC 信令服务器。Socket.io特别适合用来开发WebRTC的信令服务器，通过它来构建信令服务器大大简化了信令服务器的实现复杂度，这主要是因为它内置了<strong>房间</strong>的概念。</p><p><img src=\"https://static001.geekbang.org/resource/image/d1/41/d172dc2cfab792759dbe2c1bc098ce41.png?wh=1142*585\" alt=\"\"></p><center><span class=\"reference\">Socket.io 与 Node.js关系图</span></center><p>上图是 Socket.io 与 Node.js配合使用的逻辑关系图，其逻辑非常简单。Socket.io 分为服务端和客户端两部分。服务端由 Node.js加载后侦听某个服务端口，客户端要想与服务端相连，首先要加载 Socket.io 的客户端库，然后调用 <code>io.connect();</code>即可与服务端连接上。</p><p>这里需要特别强调的是 Socket.io 消息的发送与接收。Socket.io 有很多种发送消息的方式，其中最常见的有下面几种，也是你必须要掌握的。</p><ul>\n<li>给本次连接发消息</li>\n</ul><pre><code>\tsocket.emit()\n</code></pre><ul>\n<li>给某个房间内所有人发消息</li>\n</ul><pre><code>\tio.in(room).emit()\n</code></pre><ul>\n<li>除本连接外，给某个房间内所有人发消息</li>\n</ul><pre><code>\tsocket.to(room).emit()\n</code></pre><ul>\n<li>除本连接外，给所有人发消息</li>\n</ul><pre><code>\tsocket.broadcast.emit()\n</code></pre><p>你也可以看看下面的例子，其中S 表示服务器，C 表示客户端，它们是发送消息与接收消息的比对。</p><ul>\n<li>发送 command 命令</li>\n</ul><pre><code>\tS: socket.emit('cmd’);\n\tC: socket.on('cmd',function(){...});\n</code></pre><ul>\n<li>发送了一个 command 命令，带 data 数据</li>\n</ul><pre><code>\tS: socket.emit('action', data);\n\tC: socket.on('action',function(data){...});\n</code></pre><ul>\n<li>发送了command命令，还有两个数据</li>\n</ul><pre><code>\tS: socket.emit(action,arg1,arg2);\n\tC: socket.on('action',function(arg1,arg2){...});\n</code></pre><p>有了以上这些知识，你就可以实现信令数据通讯了。</p><h3>5. 实现信令服务器</h3><p>接下来我们来看一下，如何通过 Node.js下的 Socket.io 来构建一个服务器。</p><p><strong>首先是客户端代码，也就是在浏览器里执行的代码</strong>。以下是index.html代码：</p><pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;WebRTC client&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;script src='/socket.io/socket.io.js'&gt;&lt;/script&gt;\n    &lt;script src='js/client.js'&gt;&lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>该代码十分简单，就是在body里引入了两段 JavaScript 代码。其中，socket.io.js 是用来与服务端建立 Socket 连接的；client.js 的作用是做一些业务逻辑，并最终通过 Socket 与服务端通讯。</p><p>下面是client.js的代码：</p><pre><code>var isInitiator;\n\nroom = prompt('Enter room name:'); //弹出一个输入窗口\n\nconst socket = io.connect(); //与服务端建立socket连接\n\nif (room !== '') { //如果房间不空，则发送 &quot;create or join&quot; 消息\n  console.log('Joining room ' + room);\n  socket.emit('create or join', room);\n}\n\nsocket.on('full', (room) =&gt; { //如果从服务端收到 &quot;full&quot; 消息\n  console.log('Room ' + room + ' is full');\n});\n\nsocket.on('empty', (room) =&gt; { //如果从服务端收到 &quot;empty&quot; 消息\n  isInitiator = true;\n  console.log('Room ' + room + ' is empty');\n});\n\nsocket.on('join', (room) =&gt; { //如果从服务端收到 “join&quot; 消息\n  console.log('Making request to join room ' + room);\n  console.log('You are the initiator!');\n});\n\nsocket.on('log', (array) =&gt; {\n  console.log.apply(console, array);\n});\n</code></pre><p>在该代码中，首先弹出一个输入框，要求用户写入要加入的房间；然后，通过 io.connect() 建立与服务端的连接；最后再根据socket返回的消息做不同的处理，比如收到房间满或空的消息等。</p><p><strong>以上是客户端（也就是在浏览器）中执行的代码。下面我们来看一下服务端的处理逻辑。</strong></p><p>服务器端代码，server.js是这样的：</p><pre><code>const static = require('node-static');\nconst http = require('http');\nconst file = new(static.Server)();\nconst app = http.createServer(function (req, res) {\n  file.serve(req, res);\n}).listen(2013);\n\nconst io = require('socket.io').listen(app); //侦听 2013\n\nio.sockets.on('connection', (socket) =&gt; {\n\n  // convenience function to log server messages to the client\n  function log(){ \n    const array = ['&gt;&gt;&gt; Message from server: ']; \n    for (var i = 0; i &lt; arguments.length; i++) {\n      array.push(arguments[i]);\n    } \n      socket.emit('log', array);\n  }\n\n  socket.on('message', (message) =&gt; { //收到message时，进行广播\n    log('Got message:', message);\n    // for a real app, would be room only (not broadcast)\n    socket.broadcast.emit('message', message); //在真实的应用中，应该只在房间内广播\n  });\n\n  socket.on('create or join', (room) =&gt; { //收到 “create or join” 消息\n\n\tvar clientsInRoom = io.sockets.adapter.rooms[room];\n    var numClients = clientsInRoom ? Object.keys(clientsInRoom.sockets).length : 0; //房间里的人数\n\n    log('Room ' + room + ' has ' + numClients + ' client(s)');\n    log('Request to create or join room ' + room);\n\n    if (numClients === 0){ //如果房间里没人\n      socket.join(room);\n      socket.emit('created', room); //发送 &quot;created&quot; 消息\n    } else if (numClients === 1) { //如果房间里有一个人\n\t  io.sockets.in(room).emit('join', room);\n      socket.join(room);\n      socket.emit('joined', room); //发送 “joined”消息\n    } else { // max two clients\n      socket.emit('full', room); //发送 &quot;full&quot; 消息\n    }\n    socket.emit('emit(): client ' + socket.id +\n      ' joined room ' + room);\n    socket.broadcast.emit('broadcast(): client ' + socket.id +\n      ' joined room ' + room);\n\n  });\n\n});\n</code></pre><p>该段代码中，在服务端引入了 node-static 库，使服务器具有发布静态文件的功能。服务器具有此功能后，当客户端（浏览器）向服务端发起请求时，服务器通过该模块获得客户端（浏览器）运行的代码，也就是上面我们讲到的 index.html 和 client.js，下发给客户端（浏览器）。</p><p>服务端侦听 2013 这个端口，对不同的消息做相应的处理：</p><ul>\n<li>服务器收到 message 消息时，它会直接进行广播，这样所有连接到该服务器的客户端都会收到广播的消息。</li>\n<li>服务端收到“create or join”消息时，它会对房间里的人数进行统计，如果房间里没有人，则发送“created”消息；如果房间里有一个人，发送“join”消息和“joined”消息；如果超过两个人，则发送“full”消息。</li>\n</ul><p>要运行该程序，需要使用 NPM 安装 socket.io 和<a href=\"https://github.com/cloudhead/node-static\">node-static</a>，安装方法如下：</p><pre><code>npm install socket.io\nnpm install node-static\n</code></pre><h2>启动服务器并测试</h2><p>通过上面的步骤，你就使用“Socket.io + Node.js”实现了一个信令服务器。现在你还可以通过下面的命令将服务启动起来了：</p><pre><code>node server.js\n</code></pre><p>如果你是在本机上搭建的服务，则可以在浏览器中输入“localhost:2013”，然后在浏览器中新建一个tab ，在里边再次输入“localhost:2013”。这时，你就可以通过浏览器的控制台去看看发生了什么吧！</p><p>最后，再说一个快捷键小技巧吧，在Chrome下，你可以使用Command-Option-J或Ctrl-Shift-J的DevTools快速访问控制台。</p><h2>小结</h2><p>在本文中，我们介绍了 Node.js 的工作原理、Node.js的安装与布署，以及如何使用“Sokcet.io + Node.js”实现 WebRTC 信令消息服务器。Socket.io 由于有房间的概念，所以与WebRTC非常匹配，因此，用它开发WebRTC信令服务器就会大大地减少工作量。</p><p>另外，本文中的例子虽说很简单，但在后面的文章中我会以这个例子为基础，在其上面不断增加一些功能，这样最终你就会看到一个完整的Demo程序。所以你现在还是要学习好这每一个知识点，打好基础，积跬步才能至千里。</p><h2>思考时间</h2><p>文中所讲的JavaScript代码需要运行在两个不同的 V8 引擎上，你知道它们的对应关系吗？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p><p><a href=\"https://github.com/avdance/webrtc_web/tree/master/11_signal\">所做Demo的GitHub链接（有需要可以点这里）</a></p><p></p>","neighbors":{"left":{"article_title":"10 | WebRTC NAT穿越原理","id":113560},"right":{"article_title":"12 | RTCPeerConnection：音视频实时通讯的核心","id":116324}},"comments":[{"had_liked":false,"id":132384,"user_name":"花果山の酸梅汤","can_delete":false,"product_type":"c1","uid":1606018,"ip_address":"","ucode":"E4A71E8AD52CB3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoicwtj6x3l7NEcODqsXHjUTjzbl99pesNbydQUSfR6IywcKKyyaY9AIhBS0bCz3R8icMRIploDdUQA/132","comment_is_top":false,"comment_ctime":1568104805,"is_pvip":false,"replies":[{"id":"50824","content":"very good!","user_name":"作者回复","comment_id":132384,"uid":"1507837","ip_address":"","utype":1,"ctime":1568195264,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"27337908581","product_id":100031801,"comment_content":"client代码运行于浏览器渲染引擎中的V8引擎，server代码运行于Node.js的JS运行时的V8引擎部分。一个面向渲染一个面向提供后台服务。","like_count":7,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466906,"discussion_content":"very good!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568195264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150099,"user_name":"jike","can_delete":false,"product_type":"c1","uid":1724147,"ip_address":"","ucode":"CD8BB7CD308DBE","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJaCVXshyiclaBQpxvIWQknKdEeicJ6vv69ZsjPmlIa69Ba32kXe10Djk4kBjiap4j6yuicTA1xaptFfA/132","comment_is_top":false,"comment_ctime":1573461864,"is_pvip":false,"replies":[{"id":"58303","content":"如果你对 node 不熟悉的话，确实会有这类问题。建议你看一下我在imooc.com中的webrtc入门与实战的视频，在那个视频中有讲具体的步骤！","user_name":"作者回复","comment_id":150099,"uid":"1507837","ip_address":"","utype":1,"ctime":1573780720,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"10163396456","product_id":100031801,"comment_content":"不懂 node 的小白<br>客户端运行报错 404  http:&#47;&#47;127.0.0.1:8000&#47;socket.io&#47;?EIO=3&amp;transport=polling&amp;t=MvPeDk4；<br>服务端运行没有任何输出 浏览器也访问不了","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474064,"discussion_content":"如果你对 node 不熟悉的话，确实会有这类问题。建议你看一下我在imooc.com中的webrtc入门与实战的视频，在那个视频中有讲具体的步骤！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573780720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122123,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1245831,"ip_address":"","ucode":"A216242291A7BE","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/87/047259c9.jpg","comment_is_top":false,"comment_ctime":1565307968,"is_pvip":false,"replies":[{"id":"44958","content":"可以，用websoket你要自己写一个房间服务器","user_name":"作者回复","comment_id":122123,"uid":"1507837","ip_address":"","utype":1,"ctime":1565410053,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"10155242560","product_id":100031801,"comment_content":"客户端一定要引入socket. io吗？可以直接用 websocket api吗","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462111,"discussion_content":"可以，用websoket你要自己写一个房间服务器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565410053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310612,"user_name":"bohao","can_delete":false,"product_type":"c1","uid":1064024,"ip_address":"","ucode":"8BB2AFA9462FBE","user_header":"https://static001.geekbang.org/account/avatar/00/10/3c/58/81307481.jpg","comment_is_top":false,"comment_ctime":1630771439,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5925738735","product_id":100031801,"comment_content":"新版本的 socket.io 代码需要修改下，比如 io.sockets.adapter.rooms[room] 是个 Map&lt;String, Set&lt;String&gt;&gt;","like_count":1,"discussions":[{"author":{"id":2166878,"avatar":"https://static001.geekbang.org/account/avatar/00/21/10/5e/42f4faf7.jpg","nickname":"天择","note":"","ucode":"ED2B08DB2F2B38","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538254,"discussion_content":"确实如此，获取房间当前大小，可以直接使用Set的size属性：\nvar myRoom = io.sockets.adapter.rooms.get(room);\nvar users = (myRoom)? myRoom.size : 0;\n每个room维护的是一个socket Set：\nhttps://github.com/socketio/socket.io-adapter/blob/master/lib/index.ts","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639384513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248293,"user_name":"宇宙之王","can_delete":false,"product_type":"c1","uid":1981915,"ip_address":"","ucode":"5E6C28F8CCFF6D","user_header":"","comment_is_top":false,"comment_ctime":1600092068,"is_pvip":false,"replies":[{"id":"91440","content":"你觉得呢？实际上它会利用浏览器的连接，你再好好理解一下","user_name":"作者回复","comment_id":248293,"uid":"1507837","ip_address":"","utype":1,"ctime":1600529642,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"5895059364","product_id":100031801,"comment_content":"老师好，有个问题不明白，socket = io.connect(); 没指定端口也能连接通吗？第一次接触node，废了半天劲，这章源码和课程不太一致，运行不了，安装各种node模块又把server.js 做了如下修改 暂时去掉了https和log4j，已部署到服务器测试，大家有调不通的先试试这个，有问题互相多沟通<br>&#39;use strict&#39;<br><br>var http = require(&#39;http&#39;);<br>var https = require(&#39;https&#39;);<br>var fs = require(&#39;fs&#39;);<br>var socketIo = require(&#39;socket.io&#39;);<br><br>var express = require(&#39;express&#39;);<br>var serveIndex = require(&#39;serve-index&#39;);<br><br>var USERCOUNT = 4;<br><br>var app = express();<br>app.use(serveIndex(&#39;.&#47;public&#39;));<br>app.use(express.static(&#39;.&#47;public&#39;));<br><br>&#47;&#47;http server<br>var http_server = http.createServer(app);<br>var io = socketIo.listen(http_server);<br><br>io.sockets.on(&#39;connection&#39;, (socket)=&gt; {<br><br>\tsocket.on(&#39;message&#39;, (room, data)=&gt;{<br>\t    console.log(&#39;message, room: &#39; + room + &quot;, data, type:&quot; + data);<br>\t\tsocket.to(room).emit(&#39;message&#39;,room, data+&#39;from server!&#39;);<br>\t});<br><br>\tsocket.on(&#39;join&#39;, (room)=&gt;{<br>\t\tsocket.join(room);<br>\t\tvar myRoom = io.sockets.adapter.rooms[room]; <br>\t\tvar users = (myRoom)? Object.keys(myRoom.sockets).length : 0;<br>\t\tconsole.log(&#39;the user number of room (&#39; + room + &#39;) is: &#39; + users);<br><br>\t\tif(users &lt; USERCOUNT){<br>\t\t\tsocket.emit(&#39;joined&#39;, room, socket.id); &#47;&#47;发给除自己之外的房间内的所有人<br>\t\t\tif(users &gt; 1){<br>\t\t\t\tsocket.to(room).emit(&#39;otherjoin&#39;, room, socket.id);<br>\t\t\t}<br>\t\t<br>\t\t}else{<br>\t\t\tsocket.leave(room);\t<br>\t\t\tsocket.emit(&#39;full&#39;, room, socket.id);<br>\t\t}<br>\t});<br><br>\tsocket.on(&#39;leave&#39;, (room)=&gt;{<br><br>\t\tsocket.leave(room);<br><br>\t\tvar myRoom = io.sockets.adapter.rooms[room]; <br>\t\tvar users = (myRoom)? Object.keys(myRoom.sockets).length : 0;<br>\t\tconsole.log(&#39;the user number of room is: &#39; + users);<br><br>\t\tsocket.to(room).emit(&#39;bye&#39;, room, socket.id);<br>\t\tsocket.emit(&#39;leaved&#39;, room, socket.id);<br>\t});<br><br>});<br><br>http_server.listen(8080, &#39;0.0.0.0&#39;);<br><br><br><br>","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505609,"discussion_content":"你觉得呢？实际上它会利用浏览器的连接，你再好好理解一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600529642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193724,"user_name":"like_wind","can_delete":false,"product_type":"c1","uid":1755021,"ip_address":"","ucode":"2733C299AE56AE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eolBabicK5OTVJJJlUA4wwRtwCohCb75ahtbiaopsicnG3HRQTBOVEUrRY1KYCRZH78cDweQllh0Jzeg/132","comment_is_top":false,"comment_ctime":1584954988,"is_pvip":false,"replies":[{"id":"73964","content":"是的，就是指后者“一个直播间”","user_name":"作者回复","comment_id":193724,"uid":"1507837","ip_address":"","utype":1,"ctime":1585037245,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5879922284","product_id":100031801,"comment_content":"没太理解老师说的这个房间的概念，文中提到的“房间概念”是指客户端和服务端的一个连接就是一个房间吗？还是说这个房间指的是业务上的某一个房间，比如说某直播平台的一个直播间?","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488637,"discussion_content":"是的，就是指后者“一个直播间”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585037245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160716,"user_name":"天天","can_delete":false,"product_type":"c1","uid":1429387,"ip_address":"","ucode":"277B665E8207CF","user_header":"https://static001.geekbang.org/account/avatar/00/15/cf/8b/2b4ef30f.jpg","comment_is_top":false,"comment_ctime":1576025432,"is_pvip":true,"replies":[{"id":"66625","content":"nodejs 底层用的 libuv, 在 libuv 中使用了线程池，你可以看一下libuv的源码 https:&#47;&#47;github.com&#47;libuv&#47;libuv&#47;tree&#47;v1.x&#47;src","user_name":"作者回复","comment_id":160716,"uid":"1507837","ip_address":"","utype":1,"ctime":1579016230,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5870992728","product_id":100031801,"comment_content":"老师，您在介绍node. js的Reactor模式时和我以往理解的有点出入。您说道有个线程池的概念，我的理解应该是没有的喔(虽然我们可以使用worker来创建）还请提点一下我呦，推我篇文章也行😁谢谢啦","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477459,"discussion_content":"nodejs 底层用的 libuv, 在 libuv 中使用了线程池，你可以看一下libuv的源码 https://github.com/libuv/libuv/tree/v1.x/src","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579016230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139683,"user_name":"dahaowenge","can_delete":false,"product_type":"c1","uid":1677266,"ip_address":"","ucode":"90E104E004F79C","user_header":"https://static001.geekbang.org/account/avatar/00/19/97/d2/daaed7d8.jpg","comment_is_top":false,"comment_ctime":1570704425,"is_pvip":false,"replies":[{"id":"54147","content":"你要使用自己的证书，这是我的证书你是不能用的。另外要使用真正的证书，你可以通过购买域的，然后申请免费证书的方式获取。购买一个域名最便宜的 6元。但如果在国内购买域名的话，还要进行备案，这个在北京需要 20天的时间","user_name":"作者回复","comment_id":139683,"uid":"1507837","ip_address":"","utype":1,"ctime":1570818440,"user_name_real":"garrylee"}],"discussion_count":3,"race_medal":0,"score":"5865671721","product_id":100031801,"comment_content":"node serves.js     Error: ENOENT: no such file or directory, open &#39;.&#47;cert&#47;1557605_www.learningrtc.cn.key&#39;","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470055,"discussion_content":"你要使用自己的证书，这是我的证书你是不能用的。另外要使用真正的证书，你可以通过购买域的，然后申请免费证书的方式获取。购买一个域名最便宜的 6元。但如果在国内购买域名的话，还要进行备案，这个在北京需要 20天的时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570818440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1876823,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","nickname":"Geek_427d0c","note":"","ucode":"D7A04138C4B8CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350676,"discussion_content":"制作自己的证书。方法是在当前目录下新建cert目录，进去后执行三个命令：\n　　openssl genrsa -out 1557605_www.learningrtc.cn.key 2048\n　　openssl req -new -sha256 -key 1557605_www.learningrtc.cn.key -out csr.pem\n　　openssl x509 -req -in csr.pem -signkey 1557605_www.learningrtc.cn.key -out 1557605_www.learningrtc.cn.pem","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613976528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1987829,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlIBYWVBmevjIuaMickvceJ2JX4IHOaibrmEWmia1gM29jhjLCJcYU9lSXLInNlToAbc5Gg/132","nickname":"张伟","note":"","ucode":"3A45B9536F91E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368676,"discussion_content":"可用！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618799341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128339,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1053390,"ip_address":"","ucode":"ABB3F1A63E102A","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/ce/a8c8b5e8.jpg","comment_is_top":false,"comment_ctime":1566872314,"is_pvip":false,"replies":[{"id":"47571","content":"实现了，不过对他的讲解在第23篇文章中才会做详细介绍","user_name":"作者回复","comment_id":128339,"uid":"1507837","ip_address":"","utype":1,"ctime":1566878489,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5861839610","product_id":100031801,"comment_content":"老师好，问一下， 这套简单的信令系统，已经实现了交换各端sdp信息的功能了吗？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464904,"discussion_content":"实现了，不过对他的讲解在第23篇文章中才会做详细介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566878489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121971,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565260053,"is_pvip":false,"replies":[{"id":"44824","content":"没错！","user_name":"作者回复","comment_id":121971,"uid":"1507837","ip_address":"","utype":1,"ctime":1565278895,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5860227349","product_id":100031801,"comment_content":"两个不同的 V8 引擎上，你知道它们的对应关系吗<br>一个是nodejs服务端的V8，一个是浏览器中客户端的V8。","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462033,"discussion_content":"没错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565278895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340033,"user_name":"忧天小鸡","can_delete":false,"product_type":"c1","uid":1073947,"ip_address":"","ucode":"A1412BDC108FD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/63/1b/83ac7733.jpg","comment_is_top":false,"comment_ctime":1648548103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648548103","product_id":100031801,"comment_content":"这client对不懂前端的人来说，完全跑不起来","like_count":0},{"had_liked":false,"id":313329,"user_name":"no ne","can_delete":false,"product_type":"c1","uid":1768793,"ip_address":"","ucode":"15295B9864D4C7","user_header":"https://static001.geekbang.org/account/avatar/00/1a/fd/59/7f653e69.jpg","comment_is_top":false,"comment_ctime":1632379732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632379732","product_id":100031801,"comment_content":"最新的版本的socket.io会有不兼容问题(如服务器代码里的socketIo.listen(https_server)会报错)","like_count":0},{"had_liked":false,"id":258541,"user_name":"人生在事","can_delete":false,"product_type":"c1","uid":1819983,"ip_address":"","ucode":"5CDDD20DDD9BC5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/c5/4f/0a1c7334.jpg","comment_is_top":false,"comment_ctime":1604477915,"is_pvip":false,"replies":[{"id":"94549","content":"就是引入 socket.io库","user_name":"作者回复","comment_id":258541,"uid":"1507837","ip_address":"","utype":1,"ctime":1605004310,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1604477915","product_id":100031801,"comment_content":"&lt;script src=&#39;&#47;socket.io&#47;socket.io.js&#39;&gt;&lt;&#47;script&gt;这段代码没看到，李老师。第一次接触nodejs和socket.io.js，不太明白，希望指导一下<br>","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508687,"discussion_content":"就是引入 socket.io库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605004310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258540,"user_name":"人生在事","can_delete":false,"product_type":"c1","uid":1819983,"ip_address":"","ucode":"5CDDD20DDD9BC5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/c5/4f/0a1c7334.jpg","comment_is_top":false,"comment_ctime":1604477601,"is_pvip":false,"replies":[{"id":"94535","content":"按说你应该能想到才对，它与浏览器用的同一个连接","user_name":"作者回复","comment_id":258540,"uid":"1507837","ip_address":"","utype":1,"ctime":1605003035,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"1604477601","product_id":100031801,"comment_content":"李老师，文章实例里客户端都没有指明连哪个端口，服务端怎么监听的啊？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508686,"discussion_content":"按说你应该能想到才对，它与浏览器用的同一个连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605003035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1935262,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/87/9e/e18f55ec.jpg","nickname":"张一画","note":"","ucode":"53209E3BD46FC3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321206,"discussion_content":"我问的就是一样的的问题，没有指明就是用的当前页面访问的默认端口和地址去访问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604547400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172488,"user_name":"SherwinFeng","can_delete":false,"product_type":"c1","uid":1747728,"ip_address":"","ucode":"1754290DCF5CB7","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoNVHqRL5iatEoMgfFAaGFZxD8ic6CicxKI9Facp4bzAkNMAfaduSENlPOafs6dOGawibhNv3V9lVowQ/132","comment_is_top":false,"comment_ctime":1579188095,"is_pvip":false,"replies":[{"id":"70170","content":"看一下是不是客户端与服务端的参数没有匹配上？","user_name":"作者回复","comment_id":172488,"uid":"1507837","ip_address":"","utype":1,"ctime":1582430565,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1579188095","product_id":100031801,"comment_content":"老师，我运行了github上的demo，遇到了一个问题：<br>client端不能显示发送出去的消息<br>已尝试的排查：<br>①查看了日志发现client发送的消息服务器端已经接收到了，并且显示了消息内容（这里自己修改了demo中的debug信息，以便记录消息内容，原demo只能显示data.type）<br>②F12调试时发现client.js中的监听“message”事件没有执行<br>这是什么原因造成呢？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481756,"discussion_content":"看一下是不是客户端与服务端的参数没有匹配上？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582430565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2290293,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f2/75/85105d71.jpg","nickname":"史景峰","note":"","ucode":"B1A1FEFADB1942","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365546,"discussion_content":"好像是jion（room）这个方法没成功，不知道你的问题解决了没，刚学习，也是遇到这个问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617835881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153776,"user_name":"人生苦短","can_delete":false,"product_type":"c1","uid":1437661,"ip_address":"","ucode":"9F9BC22175969E","user_header":"https://static001.geekbang.org/account/avatar/00/15/ef/dd/3068679b.jpg","comment_is_top":false,"comment_ctime":1574305664,"is_pvip":false,"replies":[{"id":"59345","content":"应该是你的环境问题，你看一下你的node版本和npm版本是不是太低了？","user_name":"作者回复","comment_id":153776,"uid":"1507837","ip_address":"","utype":1,"ctime":1574501091,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1574305664","product_id":100031801,"comment_content":"老师你好，我下载了您的代码，更改了cert，但是报了一个错误，我不知道怎么解决<br> node server.js <br>&#47;root&#47;node_modules&#47;streamroller&#47;lib&#47;RollingFileWriteStream.js:133<br>  async _shouldRoll() {<br>        ^^^^^^^^^^^<br><br>SyntaxError: Unexpected identifier<br>    at createScript (vm.js:56:10)<br>    at Object.runInThisContext (vm.js:97:10)<br>    at Module._compile (module.js:549:28)<br>    at Object.Module._extensions..js (module.js:586:10)<br>    at Module.load (module.js:494:32)<br>    at tryModuleLoad (module.js:453:12)<br>    at Function.Module._load (module.js:445:3)<br>    at Module.require (module.js:504:17)<br>    at require (internal&#47;module.js:20:19)<br>    at Object.&lt;anonymous&gt; (&#47;root&#47;node_modules&#47;streamroller&#47;lib&#47;index.js:2:27)<br><br>是我的环境有问题么","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475269,"discussion_content":"应该是你的环境问题，你看一下你的node版本和npm版本是不是太低了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574501091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1437661,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ef/dd/3068679b.jpg","nickname":"人生苦短","note":"","ucode":"9F9BC22175969E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54969,"discussion_content":"我自己解决了哦，真是环境的问题。centos7默认node的版本是8。。升级了一下就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574329832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147399,"user_name":"而立斋","can_delete":false,"product_type":"c1","uid":1087258,"ip_address":"","ucode":"5FED6E9E148195","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/1a/389eab84.jpg","comment_is_top":false,"comment_ctime":1572862314,"is_pvip":false,"replies":[{"id":"57399","content":"web信令服务器没有搭建好吧！","user_name":"作者回复","comment_id":147399,"uid":"1507837","ip_address":"","utype":1,"ctime":1573191671,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1572862314","product_id":100031801,"comment_content":"跑起来报啦个错误，页面显示Cannot GET ","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473240,"discussion_content":"web信令服务器没有搭建好吧！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573191671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1876823,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","nickname":"Geek_427d0c","note":"","ucode":"D7A04138C4B8CB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350696,"discussion_content":"我也是报相同的错误，app.use(serveIndex(&#39;./public&#39;));和app.use(express.static(&#39;./public&#39;));说明，node server.js启动后，项目的根目录在public文件夹下（public文件夹和server.js文件在同一个目录下，public文件夹下有index.html文件、css文件和js文件夹等），所以需要把css和client.js的目录移到public下面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613982313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139681,"user_name":"dahaowenge","can_delete":false,"product_type":"c1","uid":1677266,"ip_address":"","ucode":"90E104E004F79C","user_header":"https://static001.geekbang.org/account/avatar/00/19/97/d2/daaed7d8.jpg","comment_is_top":false,"comment_ctime":1570704149,"is_pvip":false,"replies":[{"id":"54148","content":"应该是你的log4js 没有装好，你可以找个懂nodejs的同学帮忙安装一下。实在不行，你可以将 log4js注释掉。","user_name":"作者回复","comment_id":139681,"uid":"1507837","ip_address":"","utype":1,"ctime":1570818508,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1570704149","product_id":100031801,"comment_content":"老师，用的是官方demo，但是运行node server.js时，报错  Error: Cannot find module &#39;log4js&#39;","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470054,"discussion_content":"应该是你的log4js 没有装好，你可以找个懂nodejs的同学帮忙安装一下。实在不行，你可以将 log4js注释掉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570818508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130516,"user_name":"Geek_leo长沙","can_delete":false,"product_type":"c1","uid":1617384,"ip_address":"","ucode":"2AEEAF499FBDC1","user_header":"","comment_is_top":false,"comment_ctime":1567476391,"is_pvip":false,"replies":[{"id":"48918","content":"MESH, SFU, MCU三种","user_name":"作者回复","comment_id":130516,"uid":"1507837","ip_address":"","utype":1,"ctime":1567517742,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1567476391","product_id":100031801,"comment_content":"老师，要做多短在线音视频的话是不是就得考虑mesh,router,mix这三种架构呢。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465990,"discussion_content":"MESH, SFU, MCU三种","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567517742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617384,"avatar":"","nickname":"Geek_leo长沙","note":"","ucode":"2AEEAF499FBDC1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7493,"discussion_content":"好的，谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567517903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129271,"user_name":"小狂","can_delete":false,"product_type":"c1","uid":1197420,"ip_address":"","ucode":"08A2CFA90C4444","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/6c/3393668d.jpg","comment_is_top":false,"comment_ctime":1567075541,"is_pvip":false,"replies":[{"id":"48412","content":"代码已经提交了，https:&#47;&#47;github.com&#47;avdance&#47;webrtc_web&#47;tree&#47;master&#47;11_signal","user_name":"作者回复","comment_id":129271,"uid":"1507837","ip_address":"","utype":1,"ctime":1567266232,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1567075541","product_id":100031801,"comment_content":"老师,是否能发一下这节的代码","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465374,"discussion_content":"代码已经提交了，https://github.com/avdance/webrtc_web/tree/master/11_signal","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567266232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127074,"user_name":"hao11111205","can_delete":false,"product_type":"c1","uid":1617232,"ip_address":"","ucode":"E97F515CE3D7E3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/sIfDHQxDV6iaanrd8PcdVWZnke6nJmqBOLMx0iazR1yNN3FI6ib7PtXCfzicWcuEwSIqzfqiaFMf7PMYNPiaRibiaFHgcw/132","comment_is_top":false,"comment_ctime":1566550186,"is_pvip":false,"replies":[{"id":"47169","content":"我这两天把代码放上去，到时候你对照着看一下吧！","user_name":"作者回复","comment_id":127074,"uid":"1507837","ip_address":"","utype":1,"ctime":1566714518,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1566550186","product_id":100031801,"comment_content":"老师，启动服务，报错，什么原因？<br>hao@hao-Aspire-4820TG:~$ node server.js<br>&#47;home&#47;hao&#47;node_modules&#47;debug&#47;src&#47;node.js:165<br>\tconst (namespace: name, useColors) = this;<br>\t                ^<br><br>SyntaxError: Unexpected token :<br>    at exports.runInThisContext (vm.js:53:16)<br>    at Module._compile (module.js:374:25)<br>    at Object.Module._extensions..js (module.js:417:10)<br>    at Module.load (module.js:344:32)<br>    at Function.Module._load (module.js:301:12)<br>    at Module.require (module.js:354:17)<br>    at require (internal&#47;module.js:12:17)<br>    at Object.&lt;anonymous&gt; (&#47;home&#47;hao&#47;node_modules&#47;debug&#47;src&#47;index.js:9:19)<br>    at Module._compile (module.js:410:26)<br>    at Object.Module._extensions..js (module.js:417:10)<br>","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464308,"discussion_content":"我这两天把代码放上去，到时候你对照着看一下吧！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566714518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122171,"user_name":"Beast-Of-Prey","can_delete":false,"product_type":"c1","uid":1615956,"ip_address":"","ucode":"C8BAEB1EFA50EE","user_header":"https://static001.geekbang.org/account/avatar/00/18/a8/54/06da255b.jpg","comment_is_top":false,"comment_ctime":1565312898,"is_pvip":false,"replies":[{"id":"44959","content":"Http:&#47;&#47;file&#47;. ?这个开头？你是本地文件访问的？","user_name":"作者回复","comment_id":122171,"uid":"1507837","ip_address":"","utype":1,"ctime":1565410154,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1565312898","product_id":100031801,"comment_content":"老师 http:&#47;&#47;file&#47;socket.io&#47;?EIO=3&amp;transport=polling&amp;t=MnpuVBE net::ERR_NAME_NOT_RESOLVED 这个错误是什么原因导致的？我百度了 说是浏览器设置了代理，但是我检查我的浏览器，没有进行设置啊。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462131,"discussion_content":"Http://file/. ?这个开头？你是本地文件访问的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565410154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1615956,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a8/54/06da255b.jpg","nickname":"Beast-Of-Prey","note":"","ucode":"C8BAEB1EFA50EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4424,"discussion_content":"终端启的服务 浏览器开了2个输入localhost：2013的页面 应该也么什么问题啊\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565410318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122039,"user_name":"Beast-Of-Prey","can_delete":false,"product_type":"c1","uid":1615956,"ip_address":"","ucode":"C8BAEB1EFA50EE","user_header":"https://static001.geekbang.org/account/avatar/00/18/a8/54/06da255b.jpg","comment_is_top":false,"comment_ctime":1565273996,"is_pvip":false,"replies":[{"id":"44829","content":"是库没有加载对，改为这样试试  &lt;script src=&quot;https:&#47;&#47;cdnjs.cloudflare.com&#47;ajax&#47;libs&#47;socket.io&#47;2.0.3&#47;socket.io.js&quot;&gt;&lt;&#47;script&gt;","user_name":"作者回复","comment_id":122039,"uid":"1507837","ip_address":"","utype":1,"ctime":1565279401,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1565273996","product_id":100031801,"comment_content":"老师  我按步骤安装了 socket.io 但是 我本地 html 加载 socket.io.js文件的时候 提示2 个错误，1、文件未发现ERR_FILE_NOT_FOUND，2、io 未定义 io is not defined。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462070,"discussion_content":"是库没有加载对，改为这样试试  &amp;lt;script src=&amp;quot;https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565279401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121878,"user_name":"Beast-Of-Prey","can_delete":false,"product_type":"c1","uid":1615956,"ip_address":"","ucode":"C8BAEB1EFA50EE","user_header":"https://static001.geekbang.org/account/avatar/00/18/a8/54/06da255b.jpg","comment_is_top":false,"comment_ctime":1565241449,"is_pvip":false,"replies":[{"id":"44825","content":"赞！","user_name":"作者回复","comment_id":121878,"uid":"1507837","ip_address":"","utype":1,"ctime":1565278912,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1565241449","product_id":100031801,"comment_content":"读了好几遍 ","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461986,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565278912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121823,"user_name":"彭刚","can_delete":false,"product_type":"c1","uid":1250060,"ip_address":"","ucode":"E59D05C1EADB99","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDMOwpv5uMgy4HhoS0VPczxfXQldueafaaq2hznQx51nxZung0kYWukicNP3a3MFrhguVrjBwlwAg/132","comment_is_top":false,"comment_ctime":1565228788,"is_pvip":true,"replies":[{"id":"44827","content":"谢谢！","user_name":"作者回复","comment_id":121823,"uid":"1507837","ip_address":"","utype":1,"ctime":1565279081,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1565228788","product_id":100031801,"comment_content":"期待更新 每篇文章都能看好几次 都是精华","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461963,"discussion_content":"谢谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565279081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}