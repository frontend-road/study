{"id":109718,"title":"27 | 网关需要分集群部署吗？","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":127567,"user_name":"死者苏生","can_delete":false,"product_type":"c3","uid":1029285,"ip_address":"","ucode":"830E0483DE52A6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/a5/396268e5.jpg","comment_is_top":false,"comment_ctime":1566741980,"is_pvip":false,"replies":[{"id":47227,"content":"很好的建议，后面考虑专门就这个主题写一篇公众号文章，作为技术普及铺垫，请留意我的公众号《波波微课》。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566746763,"ip_address":"","comment_id":127567,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师也可以拓展下负载均衡的方式，比如软件负载（操作系统和应用）、硬件负载，再来学习网关和反向代理可能会更好","like_count":4,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464553,"discussion_content":"很好的建议，后面考虑专门就这个主题写一篇公众号文章，作为技术普及铺垫，请留意我的公众号《波波微课》。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566746763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008312,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/b8/0e1b655e.jpg","nickname":"fireshort","note":"","ucode":"10550CA9C6C730","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588509,"discussion_content":"波波老师的公众号去年就停更了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663808280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132219,"user_name":"宝宝太喜欢极客时间了","can_delete":false,"product_type":"c3","uid":1215152,"ip_address":"","ucode":"9CDB679C257612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoOGZ6lbHiboIZMN9USbeutnmCWBahVLtSlKlIENKvrZQCUQzpzeZQOxTntIkBUeDk6qZUPdqmfKrQ/132","comment_is_top":false,"comment_ctime":1568044168,"is_pvip":false,"replies":[{"id":50645,"content":"对，拆分成微服务了，但是这些微服务的前端应用模块，有些可是单页应用形式，有些仍然可以是web mvc应用形式，后台则一般都是api&#47;服务。比如，携程网站后台基本都微服务了，前台的主站还是web mvc形式，也有支持无线的h5单页应用形式。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1568122284,"ip_address":"","comment_id":132219,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，您说的单页应用web应用是什么？不是都拆分成单个服务了吗？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466827,"discussion_content":"对，拆分成微服务了，但是这些微服务的前端应用模块，有些可是单页应用形式，有些仍然可以是web mvc应用形式，后台则一般都是api/服务。比如，携程网站后台基本都微服务了，前台的主站还是web mvc形式，也有支持无线的h5单页应用形式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568122284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117113,"user_name":"grey927","can_delete":false,"product_type":"c3","uid":1202782,"ip_address":"","ucode":"833E02ED835B4A","user_header":"https://static001.geekbang.org/account/avatar/00/12/5a/5e/a897cb0d.jpg","comment_is_top":false,"comment_ctime":1563970838,"is_pvip":false,"replies":[{"id":42998,"content":"Spring Cloud Gateway还比较新，生产级落地案例还不多。可以关注测试和试点，课程后面有一节主流网关概览也会谈到Spring Cloud Gateway。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1564058827,"ip_address":"","comment_id":117113,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"请问杨老师，Spring Cloud Gateway目前可以替代zuul作为生产环境的网关么？","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459827,"discussion_content":"Spring Cloud Gateway还比较新，生产级落地案例还不多。可以关注测试和试点，课程后面有一节主流网关概览也会谈到Spring Cloud Gateway。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564058827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288339,"user_name":"宇飞","can_delete":false,"product_type":"c3","uid":1105513,"ip_address":"","ucode":"D64C53CD189164","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/69/113da382.jpg","comment_is_top":false,"comment_ctime":1618412943,"is_pvip":false,"replies":[{"id":104804,"content":"网关躲在负载均衡器后面，一般无状态，可以按需部署多台，分摊负载。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1618669867,"ip_address":"","comment_id":288339,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"所有流量都走网关，网关能抗住吗","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518595,"discussion_content":"网关躲在负载均衡器后面，一般无状态，可以按需部署多台，分摊负载。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618669867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167893,"user_name":"wind","can_delete":false,"product_type":"c3","uid":1507189,"ip_address":"","ucode":"5EC77AEB18130E","user_header":"https://static001.geekbang.org/account/avatar/00/16/ff/75/9c1b2ece.jpg","comment_is_top":false,"comment_ctime":1577958946,"is_pvip":false,"replies":[{"id":65216,"content":"Nginx可以做集群实现HA，例如采用keepalived可实现Active-Active HA，具体可以参考nginx官方文档：\nhttps:&#47;&#47;docs.nginx.com&#47;nginx&#47;admin-guide&#47;high-availability&#47;ha-keepalived-nodes&#47;\n\n另外，对于中大规模企业应用，建议nginx采用无状态集群部署，前置硬件负载均衡器(如F5)对nginx进行负载均衡，点评camel可以对分布式nginx集群进行集中管控，参考：https:&#47;&#47;github.com&#47;dianping&#47;camel","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1577972372,"ip_address":"","comment_id":167893,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，Nginx可以集群吗？有哪些高可用方式呢？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480047,"discussion_content":"Nginx可以做集群实现HA，例如采用keepalived可实现Active-Active HA，具体可以参考nginx官方文档：\nhttps://docs.nginx.com/nginx/admin-guide/high-availability/ha-keepalived-nodes/\n\n另外，对于中大规模企业应用，建议nginx采用无状态集群部署，前置硬件负载均衡器(如F5)对nginx进行负载均衡，点评camel可以对分布式nginx集群进行集中管控，参考：https://github.com/dianping/camel","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577972372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142511,"user_name":"Geek_cha","can_delete":false,"product_type":"c3","uid":1510045,"ip_address":"","ucode":"6AB056704FF22E","user_header":"","comment_is_top":false,"comment_ctime":1571383808,"is_pvip":false,"replies":[{"id":54984,"content":"课程案例staffjoy应用是前后分离的微服务架构，所有应用&#47;微服务都可以部署在容器云(如k8s)集群中，并且所有应用&#47;微服务都是躲在网关Fraday后面，这里的Faraday起的作用即是网关，也是反向代理(和nginx类似)。\n\n目前不少企业的前后分离和微服务架构，因为遗留系统等因素，做法不一，把前端和nginx部署在一起也是一种做法，不过部署起来比较麻烦一点。staffjoy是支持一键部署到容器云环境，可以单个服务部署，也可以一起部署，都很简单，因为不管前端单页还是Spring微服务，都是等价的应用或服务。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1571397736,"ip_address":"","comment_id":142511,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师你好，这个web应用是前后端分离的吗，前后端分别部署在哪里，我们一个项目时前端跟nginx部署在一起，后端是另外的机器。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471155,"discussion_content":"课程案例staffjoy应用是前后分离的微服务架构，所有应用/微服务都可以部署在容器云(如k8s)集群中，并且所有应用/微服务都是躲在网关Fraday后面，这里的Faraday起的作用即是网关，也是反向代理(和nginx类似)。\n\n目前不少企业的前后分离和微服务架构，因为遗留系统等因素，做法不一，把前端和nginx部署在一起也是一种做法，不过部署起来比较麻烦一点。staffjoy是支持一键部署到容器云环境，可以单个服务部署，也可以一起部署，都很简单，因为不管前端单页还是Spring微服务，都是等价的应用或服务。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571397736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128749,"user_name":"forever","can_delete":false,"product_type":"c3","uid":1049967,"ip_address":"","ucode":"5B9409BED703BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/6f/4f5e9789.jpg","comment_is_top":false,"comment_ctime":1566956420,"is_pvip":false,"replies":[{"id":47889,"content":"考虑kong&#47;traefik&#47;envoy等这些支持通过api动态热加载的反向代理，或者采用支持动态热加载的nginx扩展，如点评的camel：https:&#47;&#47;github.com&#47;dianping&#47;camel","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566998955,"ip_address":"","comment_id":128749,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师好，我们现在正在做的产品是企业saas，我们想的是新增一个企业，就新增一个pod，拉取我们系统的镜像，每一新增一个企业就对应一个域名去访问，如果是用nginx配置不同的域名访问不同的应用，需要重启才可以，请教一下波波老师有什么好的建议，在新增的时候不需要重启就可以实现。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465085,"discussion_content":"考虑kong/traefik/envoy等这些支持通过api动态热加载的反向代理，或者采用支持动态热加载的nginx扩展，如点评的camel：https://github.com/dianping/camel","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566998955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1049967,"avatar":"https://static001.geekbang.org/account/avatar/00/10/05/6f/4f5e9789.jpg","nickname":"forever","note":"","ucode":"5B9409BED703BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6898,"discussion_content":"好的，感谢老师解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567164648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127152,"user_name":"Aaron","can_delete":false,"product_type":"c3","uid":1066251,"ip_address":"","ucode":"B0C504A76297C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/0Qp9pxHBvgdZAveKzsvUFFUicCJfe7ONzhC7jSNFQDNFvg0jRMXuqqZOdxG1qKosylUYrpIHUR2Q76w5m4HtVkg/132","comment_is_top":false,"comment_ctime":1566569871,"is_pvip":false,"replies":[{"id":47216,"content":"nginx是通用反向代理，网关也可以部署在nginx后面，这个时候nginx可以对网关做反向路由和负载均衡等功能。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566744266,"ip_address":"","comment_id":127152,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"网关也需要放在NGINX后面吧？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464343,"discussion_content":"nginx是通用反向代理，网关也可以部署在nginx后面，这个时候nginx可以对网关做反向路由和负载均衡等功能。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566744266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1037755,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d5/bb/98b93862.jpg","nickname":"古德","note":"","ucode":"E3F646BB73F60E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6018,"discussion_content":"网关集群前面最好有一个能确保高可用的组件，以前我们用的是阿里云的slb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566614712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337971,"user_name":"$兜兜里有钱","can_delete":false,"product_type":"c3","uid":1105031,"ip_address":"","ucode":"731AE27A13EC1D","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/87/1901ddaa.jpg","comment_is_top":false,"comment_ctime":1647190807,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师开放平台网关、h5网关、无线网关之间都是独立的么","like_count":0},{"had_liked":false,"id":196873,"user_name":"林明忠","can_delete":false,"product_type":"c3","uid":1911192,"ip_address":"","ucode":"F5444908C1A2B3","user_header":"","comment_is_top":false,"comment_ctime":1585320162,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"网关的架构和部署，对新手来说很有帮助","like_count":0}]}