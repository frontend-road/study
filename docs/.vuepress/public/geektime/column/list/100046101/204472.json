{"id":204472,"title":"07 | Raft算法（一）：如何选举领导者？","content":"<p>你好，我是韩健。</p><p>通过前两节课，我带你打卡了Paxos算法，今天我想和你聊聊最常用的共识算法，Raft算法。</p><p>Raft算法属于Multi-Paxos算法，它是在兰伯特Multi-Paxos思想的基础上，做了一些简化和限制，比如增加了日志必须是连续的，只支持领导者、跟随者和候选人三种状态，在理解和算法实现上都相对容易许多。</p><p><strong>除此之外，Raft算法是现在分布式系统开发首选的共识算法。</strong>绝大多数选用Paxos算法的系统（比如Cubby、Spanner）都是在Raft算法发布前开发的，当时没得选；而全新的系统大多选择了Raft算法（比如Etcd、Consul、CockroachDB）。</p><p>对你来说，掌握这个算法，可以得心应手地处理绝大部分场景的容错和一致性需求，比如分布式配置系统、分布式NoSQL存储等等，轻松突破系统的单机限制。</p><p><strong>如果要用一句话概括Raft算法，我觉得是这样的：从本质上说，Raft算法是通过一切以领导者为准的方式，实现一系列值的共识和各节点日志的一致。</strong>这句话比较抽象，我来做个比喻，领导者就是Raft算法中的霸道总裁，通过霸道的“一切以我为准”的方式，决定了日志中命令的值，也实现了各节点日志的一致。</p><!-- [[[read_end]]] --><p>我会用三讲的时间，分别以领导者选举、日志复制、成员变更为核心，讲解Raft算法的原理，在实战篇中，会带你进一步剖析Raft算法的实现，介绍基于Raft算法的分布式系统开发实战。那么我希望从原理到实战，在帮助你掌握分布式系统架构设计技巧和开发实战能力的同时，加深你对Raft算法的理解。</p><p>在课程开始之前，我们先来看一道思考题。</p><p>假设我们有一个由节点A、B、C组成的Raft集群（如图所示），因为Raft算法一切以领导者为准，所以如果集群中出现了多个领导者，就会出现不知道谁来做主的问题。在这样一个有多个节点的集群中，在节点故障、分区错误等异常情况下，Raft算法如何保证在同一个时间，集群中只有一个领导者呢？带着这个问题，我们正式进入今天的学习。</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/33/b99084301cf7b944af0490aa0297ff33.jpg?wh=1142*474\" alt=\"\"></p><p>既然要选举领导者，那要从哪些成员中选举呢？除了领导者，Raft算法还支持哪些成员身份呢？这部分内容是你需要掌握的，最基础的背景知识。</p><h2>有哪些成员身份？</h2><p>成员身份，又叫做服务器节点状态，<strong>Raft算法支持领导者（Leader）、跟随者（Follower）和候选人（Candidate） 3种状态。</strong>为了方便讲解，我们使用不同的图形表示不同的状态。在任何时候，每一个服务器节点都处于这3个状态中的1个。</p><p><img src=\"https://static001.geekbang.org/resource/image/28/03/280eff8a48c50fc3566ddbde9a97ee03.jpg?wh=1142*320\" alt=\"\"></p><ul>\n<li>\n<p>跟随者：就相当于普通群众，默默地接收和处理来自领导者的消息，当等待领导者心跳信息超时的时候，就主动站出来，推荐自己当候选人。</p>\n</li>\n<li>\n<p>候选人：候选人将向其他节点发送请求投票（RequestVote）RPC消息，通知其他节点来投票，如果赢得了大多数选票，就晋升当领导者。</p>\n</li>\n<li>\n<p>领导者：蛮不讲理的霸道总裁，一切以我为准，平常的主要工作内容就是3部分，处理写请求、管理日志复制和不断地发送心跳信息，通知其他节点“我是领导者，我还活着，你们现在不要发起新的选举，找个新领导者来替代我。”</p>\n</li>\n</ul><p><strong>需要你注意的是，Raft算法是强领导者模型，集群中只能有一个“霸道总裁”。</strong></p><h2>选举领导者的过程</h2><p>那么这三个成员是怎么选出来领导者的呢？为了方便你理解，我以图例的形式演示一个典型的领导者选举过程。</p><p>首先，在初始状态下，集群中所有的节点都是跟随者的状态。</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/a2/5b391fd6cb9ed54ba77b0b96efed75a2.jpg?wh=1142*905\" alt=\"\"></p><p>Raft算法实现了随机超时时间的特性。也就是说，每个节点等待领导者节点心跳信息的超时时间间隔是随机的。通过上面的图片你可以看到，集群中没有领导者，而节点A的等待超时时间最小（150ms），它会最先因为没有等到领导者的心跳信息，发生超时。</p><p>这个时候，节点A就增加自己的任期编号，并推举自己为候选人，先给自己投上一张选票，然后向其他节点发送请求投票RPC消息，请它们选举自己为领导者。</p><p><img src=\"https://static001.geekbang.org/resource/image/aa/9c/aac5704d69f142ead5e92d33f893a69c.jpg?wh=1142*962\" alt=\"\"></p><p>如果其他节点接收到候选人A的请求投票RPC消息，在编号为1的这届任期内，也还没有进行过投票，那么它将把选票投给节点A，并增加自己的任期编号。</p><p><img src=\"https://static001.geekbang.org/resource/image/a4/95/a4bb6d1fa7c8c48106a4cf040b7b1095.jpg?wh=1142*1121\" alt=\"\"></p><p>如果候选人在选举超时时间内赢得了大多数的选票，那么它就会成为本届任期内新的领导者。</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/2c/ffaa3f6e9e87d6cea2a3bfc29647e22c.jpg?wh=1142*1033\" alt=\"\"></p><p>节点A当选领导者后，他将周期性地发送心跳消息，通知其他服务器我是领导者，阻止跟随者发起新的选举，篡权。</p><p><img src=\"https://static001.geekbang.org/resource/image/0a/91/0a626f52c2e2a147c59c862b148be691.jpg?wh=1142*1036\" alt=\"\"></p><p>讲到这儿，你是不是发现领导者选举很容易理解？与现实中的议会选举也蛮类似？当然，你可能还是对一些细节产生一些疑问：</p><ul>\n<li>节点间是如何通讯的呢？</li>\n<li>什么是任期呢？</li>\n<li>选举有哪些规则？</li>\n<li>随机超时时间又是什么？</li>\n</ul><h2>选举过程四连问</h2><p>老话说，细节是魔鬼。这些细节也是很多同学在学习Raft算法的时候比较难掌握的，所以我认为有必要具体分析一下。咱们一步步来，先来看第一个问题。</p><h4>节点间如何通讯？</h4><p>在Raft算法中，服务器节点间的沟通联络采用的是远程过程调用（RPC），在领导者选举中，需要用到这样两类的RPC：</p><p>1.请求投票（RequestVote）RPC，是由候选人在选举期间发起，通知各节点进行投票；</p><p>2.日志复制（AppendEntries）RPC，是由领导者发起，用来复制日志和提供心跳消息。</p><p>我想强调的是，日志复制RPC只能由领导者发起，这是实现强领导者模型的关键之一，希望你能注意这一点，后续能更好地理解日志复制，理解日志的一致是怎么实现的。</p><h4>什么是任期？</h4><p>我们知道，议会选举中的领导者是有任期的，领导者任命到期后，要重新开会再次选举。Raft算法中的领导者也是有任期的，每个任期由单调递增的数字（任期编号）标识，比如节点A的任期编号是1。任期编号是随着选举的举行而变化的，这是在说下面几点。</p><ol>\n<li>\n<p>跟随者在等待领导者心跳信息超时后，推举自己为候选人时，会增加自己的任期号，比如节点A的当前任期编号为0，那么在推举自己为候选人时，会将自己的任期编号增加为1。</p>\n</li>\n<li>\n<p>如果一个服务器节点，发现自己的任期编号比其他节点小，那么它会更新自己的编号到较大的编号值。比如节点B的任期编号是0，当收到来自节点A的请求投票RPC消息时，因为消息中包含了节点A的任期编号，且编号为1，那么节点B将把自己的任期编号更新为1。</p>\n</li>\n</ol><p>我想强调的是，与现实议会选举中的领导者的任期不同，Raft算法中的任期不只是时间段，而且任期编号的大小，会影响领导者选举和请求的处理。</p><ol>\n<li>\n<p>在Raft算法中约定，如果一个候选人或者领导者，发现自己的任期编号比其他节点小，那么它会立即恢复成跟随者状态。比如分区错误恢复后，任期编号为3的领导者节点B，收到来自新领导者的，包含任期编号为4的心跳消息，那么节点B将立即恢复成跟随者状态。</p>\n</li>\n<li>\n<p>还约定如果一个节点接收到一个包含较小的任期编号值的请求，那么它会直接拒绝这个请求。比如节点C的任期编号为4，收到包含任期编号为3的请求投票RPC消息，那么它将拒绝这个消息。</p>\n</li>\n</ol><p>在这里，你可以看到，Raft算法中的任期比议会选举中的任期要复杂。同样，在Raft算法中，选举规则的内容也会比较多。</p><h4>选举有哪些规则</h4><p>在议会选举中，比成员的身份、领导者的任期还要重要的就是选举的规则，比如一人一票、弹劾制度等。“无规矩不成方圆”，在Raft算法中，也约定了选举规则，主要有这样几点。</p><ol>\n<li>\n<p>领导者周期性地向所有跟随者发送心跳消息（即不包含日志项的日志复制RPC消息），通知大家我是领导者，阻止跟随者发起新的选举。</p>\n</li>\n<li>\n<p>如果在指定时间内，跟随者没有接收到来自领导者的消息，那么它就认为当前没有领导者，推举自己为候选人，发起领导者选举。</p>\n</li>\n<li>\n<p>在一次选举中，赢得大多数选票的候选人，将晋升为领导者。</p>\n</li>\n<li>\n<p>在一个任期内，领导者一直都会是领导者，直到它自身出现问题（比如宕机），或者因为网络延迟，其他节点发起一轮新的选举。</p>\n</li>\n<li>\n<p>在一次选举中，每一个服务器节点最多会对一个任期编号投出一张选票，并且按照“先来先服务”的原则进行投票。比如节点C的任期编号为3，先收到了1个包含任期编号为4的投票请求（来自节点A），然后又收到了1个包含任期编号为4的投票请求（来自节点B）。那么节点C将会把唯一一张选票投给节点A，当再收到节点B的投票请求RPC消息时，对于编号为4的任期，已没有选票可投了。</p>\n</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/33/84/3373232d5c10813c7fc87f2fd4a12d84.jpg?wh=1142*855\" alt=\"\"></p><ol start=\"6\">\n<li>日志完整性高的跟随者（也就是最后一条日志项对应的任期编号值更大，索引号更大），拒绝投票给日志完整性低的候选人。比如节点B的任期编号为3，节点C的任期编号是4，节点B的最后一条日志项对应的任期编号为3，而节点C为2，那么当节点C请求节点B投票给自己时，节点B将拒绝投票。</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/99/6d/9932935b415e37c2ca758ab99b34f66d.jpg?wh=1142*197\" alt=\"\"></p><p>我想强调的是，选举是跟随者发起的，推举自己为候选人；大多数选票是指集群成员半数以上的选票；大多数选票规则的目标，是为了保证在一个给定的任期内最多只有一个领导者。</p><p>其实在选举中，除了选举规则外，我们还需要避免一些会导致选举失败的情况，比如同一任期内，多个候选人同时发起选举，导致选票被瓜分，选举失败。那么在Raft算法中，如何避免这个问题呢？答案就是随机超时时间。</p><h4>如何理解随机超时时间</h4><p>在议会选举中，常出现未达到指定票数，选举无效，需要重新选举的情况。在Raft算法的选举中，也存在类似的问题，那它是如何处理选举无效的问题呢？</p><p>其实，Raft算法巧妙地使用随机选举超时时间的方法，把超时时间都分散开来，在大多数情况下只有一个服务器节点先发起选举，而不是同时发起选举，这样就能减少因选票瓜分导致选举失败的情况。</p><p>我想强调的是，<strong>在Raft算法中，随机超时时间是有2种含义的，这里是很多同学容易理解出错的地方，需要你注意一下：</strong></p><p>1.跟随者等待领导者心跳信息超时的时间间隔，是随机的；</p><p>2.如果候选人在一个随机时间间隔内，没有赢得过半票数，那么选举无效了，然后候选人发起新一轮的选举，也就是说，等待选举超时的时间间隔，是随机的。</p><h2>内容小结</h2><p>以上就是本节课的全部内容了，本节课我主要带你了解了Raft算法的特点、领导者选举等。我希望你明确这样几个重点。</p><ul>\n<li>\n<p>Raft算法和兰伯特的Multi-Paxos不同之处，主要有2点。首先，在Raft中，不是所有节点都能当选领导者，只有日志较完整的节点（也就是日志完整度不比半数节点低的节点），才能当选领导者；其次，在Raft中，日志必须是连续的。</p>\n</li>\n<li>\n<p>Raft算法通过任期、领导者心跳消息、随机选举超时时间、先来先服务的投票原则、大多数选票原则等，保证了一个任期只有一位领导，也极大地减少了选举失败的情况。</p>\n</li>\n<li>\n<p>本质上，Raft算法以领导者为中心，选举出的领导者，以“一切以我为准”的方式，达成值的共识，和实现各节点日志的一致。</p>\n</li>\n</ul><p>在本讲，我们使用Raft算法在集群中选出了领导者节点A，那么选完领导者之后，领导者需要处理来自客户的写请求，并通过日志复制实现各节点日志的一致（下节课我会重点带你了解这一部分内容）。</p><h2>课堂思考</h2><p>既然我提到，Raft算法实现了“一切以我为准”的强领导者模型，那么你不妨思考，这个设计有什么限制和局限呢？欢迎在留言区分享你的看法，与我一同讨论。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，也欢迎你将它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"06 | Paxos算法（二）：Multi-Paxos不是一个算法，而是统称","id":202772},"right":{"article_title":"08 | Raft算法（二）：如何复制日志？","id":205784}},"comments":[{"had_liked":false,"id":182887,"user_name":"Jialin","can_delete":false,"product_type":"c1","uid":1112955,"ip_address":"","ucode":"12583269732A75","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/7b/2d4b38fb.jpg","comment_is_top":false,"comment_ctime":1582883372,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"242101051948","product_id":100046101,"comment_content":"Raft 算法本质：通过一切以领导者为准的方式，实现一系列值的共识和各节点日志的一致<br>服务节点状态：<br>• 领导者（Leader）：处理写请求、管理日志复制、与跟随者间维持心跳服务<br>• 跟随者（Follower）：接受和处理来自领导者的消息，当领导者节点故障时，推荐自己进行选举<br>• 候选人（Candidate）：向其他跟随者节点发送请求投票 RPC 消息，通知投票，若获得大多数节点的投票，则成功竞选为领导者。<br>服务节点状态变更：<br>• 跟随者 -&gt; 候选人 -&gt; 领导者<br>• 领导者 -&gt; 跟随者<br>• 候选人 -&gt; 跟随者<br>Raft 算法通过任期、领导者心跳消息、随机选举超时时间、先来先服务的投票原则、大多数选票原则等，保证了一个任期只有一位领导，也极大地减少了选举失败的情况。具体的选举细节如下：<br>• 节点间通讯方式：RPC 通讯，分为请求投票 RPC 和日志复制 RPC。投票 RPC 由候选人发起，通知其他阶段进行投票选举； 日志复制 RPC 由领导者发起，用于日志复制和维持心跳服务。<br>• 领导者任期：与现实生活中领导者任期不同的是，这里的任期是指任期编号，而非任期时间。跟随者在等待领导者心跳信息超时后，推举自己为候选人时，会增加自己的任期号；如果一个服务器节点，发现自己的任期编号比其他节点小，那么它会更新自己的编号到较大的编号值。<br>• 在 Raft 算法中约定，如果一个候选人或者领导者，发现自己的任期编号比其他节点小，那么它会立即恢复成跟随者状态<br>• 如果一个节点接收到一个包含较小的任期编号值的请求，那么它会直接拒绝这个请求<br>• 选举规则：<br>• 领导者周期性地向所有跟随者发送心跳信息，维持自己的领导者状态<br>• 跟随者在随机超时时间内没有收到领导者的心跳信息，则发起领导者选举，节点状态变更为候选人，进入选举阶段<br>• 选举阶段，候选人收到超过半数以上的投票，节点状态变更为领导者，选举结束<br>• 选举阶段，一个服务节点最多会对一个任期编号投出一张选票，按照“先来先服务”原则进行投票；若任期编号同，则按照“日志完整性”原则进行投票。（日志完整性是服务节点的最后一条日志项对应的任期编号值和索引号。一般情况下，任期编号值更大，索引号更大）。<br>• 随机超时时间：<br>• 跟随者等待领导者心跳信息超时的时间间隔，是随机的<br>• 当没有候选人赢得过半票数，选举无效了，这时需要等待一个随机时间间隔，也就是说，等待选举超时的时间间隔，是随机的","like_count":56,"discussions":[{"author":{"id":1058800,"avatar":"https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg","nickname":"Skysper","note":"","ucode":"164B3CAF81A7C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373907,"discussion_content":"任期内领导者正常 候选人发起的新的领导者选举是会被拒绝的吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620912908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1058800,"avatar":"https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg","nickname":"Skysper","note":"","ucode":"164B3CAF81A7C5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388556,"discussion_content":"拒绝","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628834084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373907,"ip_address":""},"score":388556,"extra":""}]}]},{"had_liked":false,"id":182041,"user_name":"益军","can_delete":false,"product_type":"c1","uid":1002317,"ip_address":"","ucode":"5629FA62A01F25","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4b/4d/0239bc19.jpg","comment_is_top":false,"comment_ctime":1582698887,"is_pvip":false,"replies":[{"id":"70763","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582924802,"ip_address":"","comment_id":182041,"utype":1}],"discussion_count":2,"race_medal":0,"score":"164791456135","product_id":100046101,"comment_content":"关于raft的领导者选举限制和局限，我的理解：<br>1.读写请求和数据转发压力落在领导者节点，导致领导者压力。<br>2.大规模跟随者的集群，领导者需要承担大量元数据维护和心跳通知的成本。<br>3.领导者单点问题，故障后直到新领导者选举出来期间集群不可用。<br>4.随着候选人规模增长，收集半数以上投票的成本更大。","like_count":38,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485206,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582924802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1559704,"avatar":"https://static001.geekbang.org/account/avatar/00/17/cc/98/4ad0a02f.jpg","nickname":"小骏","note":"","ucode":"E95300431D8BB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555496,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646926094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213397,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1588401982,"is_pvip":true,"replies":[{"id":"80031","content":"加一颗星:)，不直接采用Basic Paxos，是因为在Raft中不是所有的节点都能当选领导者，只有大多数节点中日志最完整的节点才能当选领导者。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1589233752,"ip_address":"","comment_id":213397,"utype":1}],"discussion_count":3,"race_medal":0,"score":"117552518974","product_id":100046101,"comment_content":"为什么raft不采用paxos方式选主？","like_count":27,"discussions":[{"author":{"id":1691800,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d0/98/609fded1.jpg","nickname":"felixchina","note":"","ucode":"4499AE35460213","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281536,"discussion_content":"不是日志完整度只要在半数以上的区间就有可能当选领导者么","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1591761176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2704324,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqiawDUKTib2pdv15pybjicd1kR7pXr3JuHKrTo5KdMvRSyLsu19jk8u63HnAiaDI3mtMZNxbvmksibWUw/132","nickname":"Terry","note":"","ucode":"D92AB290080F33","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1691800,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d0/98/609fded1.jpg","nickname":"felixchina","note":"","ucode":"4499AE35460213","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551108,"discussion_content":"是的 这里作者说的不严谨，不过下面这个评论，作者也说了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644901025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":281536,"ip_address":""},"score":551108,"extra":""}]},{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493766,"discussion_content":"加一颗星:)，不直接采用Basic Paxos，是因为在Raft中不是所有的节点都能当选领导者，只有大多数节点中日志最完整的节点才能当选领导者。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589233752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203107,"user_name":"starwolf","can_delete":false,"product_type":"c1","uid":1340759,"ip_address":"","ucode":"124152634E7CC7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eondPEiaia6ugMDzWTRZXt6X5RLVtsYPBwiaskicyJADq1hD0KxyiaNiaRhBxgwTGia1fmDgfDo0y8YxjzKQ/132","comment_is_top":false,"comment_ctime":1586140926,"is_pvip":false,"replies":[{"id":"77631","content":"加一颗星:)，问题1：集群配置不是随时变化的，需要按照一定的算法，比如联合共识、单节点变更，来添加和移除节点，也就是集群当前的节点数是已知的。问题2：是的，日志较完整的节点能当选，只要完整度不比大多数节点低，就可以了，感谢反馈，已修正。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587237074,"ip_address":"","comment_id":203107,"utype":1}],"discussion_count":8,"race_medal":0,"score":"108960323326","product_id":100046101,"comment_content":"老师有两个问题请教一下，第一就是投票要获得大多数的选票，但是投票发起者怎么知道现在的票数已经超过半数了？因为分布式环境的机器数目是随时变化的。第二个问题，您在课程中说过，raft算法会让日志最完整的当选，这个不一定吧，如果第二完整的节点先发起投票，并获得大多数选票，也是可以当选的吧。这两个问题请帮忙解答一下，谢谢","like_count":25,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490767,"discussion_content":"加一颗星:)，问题1：集群配置不是随时变化的，需要按照一定的算法，比如联合共识、单节点变更，来添加和移除节点，也就是集群当前的节点数是已知的。问题2：是的，日志较完整的节点能当选，只要完整度不比大多数节点低，就可以了，感谢反馈，已修正。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587237074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260326,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/66/f26d71a7.jpg","nickname":"♪Check King","note":"","ucode":"11BFD41B905FEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318172,"discussion_content":"就这个问题继续问韩老师，第二个问题中，您回复只要完整度不比大多数节点低，就可以。那么哪些少数节点中更多的日志后续怎么处理呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603672328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1109389,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/8d/377c106a.jpg","nickname":"KW💤","note":"","ucode":"290DD7016F4EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2260326,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/66/f26d71a7.jpg","nickname":"♪Check King","note":"","ucode":"11BFD41B905FEB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411454,"discussion_content":"你要理解，系统只需要保证提交了的日志不丢失，而提交的前提是大多数节点同步了日志。因此即便有节点的日志更多，但那是未提交的，因为并没同步到大多数节点，因此这部分日志是可以覆盖的，这部分节点最终要与header的日志保持一致，也就是“一切以header为准”的要义","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635933068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318172,"ip_address":""},"score":411454,"extra":""}]},{"author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375161,"discussion_content":"又是如何知道选择的候选节点不比大多数低呢？是不是有一个地方可以存储每个节点的日志完整性？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621498875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388897,"discussion_content":"只要候选人的完整度大于等于大多数节点，就能收到大多数节点的赞成票了，不需要单独存储完整性信息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629031400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375161,"ip_address":""},"score":388897,"extra":""},{"author":{"id":1466447,"avatar":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","nickname":"Daiver","note":"","ucode":"9B1A03AFBC79BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399340,"discussion_content":"这个应该是发起投票的时候，会带上自己的日志index吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632931521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388897,"ip_address":""},"score":399340,"extra":""},{"author":{"id":1109389,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/8d/377c106a.jpg","nickname":"KW💤","note":"","ucode":"290DD7016F4EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411461,"discussion_content":"发起投票时candidate会把自己日志的log index以及term也发到follower那里的，follow通过与自己日志的log index以及term比较判断谁的日志更完整（有的地方说更新），若candidate日志更新则follower会投票给它否则不会，在投票timeout时间里candidate如果获得了大多数支持则会成为leader","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635933368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375161,"ip_address":""},"score":411461,"extra":""}]},{"author":{"id":1151715,"avatar":"https://static001.geekbang.org/account/avatar/00/11/92/e3/cf0c0909.jpg","nickname":"frank","note":"","ucode":"5B984105B453D5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335430,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608193071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183005,"user_name":"Jialin","can_delete":false,"product_type":"c1","uid":1112955,"ip_address":"","ucode":"12583269732A75","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/7b/2d4b38fb.jpg","comment_is_top":false,"comment_ctime":1582908214,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"78892319542","product_id":100046101,"comment_content":"https:&#47;&#47;zhuanlan.zhihu.com&#47;p&#47;27207160 这篇文档值得看看","like_count":18},{"had_liked":false,"id":181889,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1582672105,"is_pvip":false,"replies":[{"id":"70765","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582924917,"ip_address":"","comment_id":181889,"utype":1}],"discussion_count":1,"race_medal":1,"score":"74597116137","product_id":100046101,"comment_content":"Raft这种&quot;一切以我为主&quot;的强领导模型和上一讲中的chubby有点类似，chubby是只能从主节点读取，相当于单机，性能和吞吐量有限<br>Raft的强领导模型是写要以主为主，也相当于单机了。性能和吞吐量也会受到限制","like_count":17,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485156,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582924917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240906,"user_name":"ξ！","can_delete":false,"product_type":"c1","uid":1636657,"ip_address":"","ucode":"F9797D21EBE10E","user_header":"https://static001.geekbang.org/account/avatar/00/18/f9/31/b75cc6d5.jpg","comment_is_top":false,"comment_ctime":1597113663,"is_pvip":false,"replies":[{"id":"95928","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1606565410,"ip_address":"","comment_id":240906,"utype":1}],"discussion_count":2,"race_medal":0,"score":"70316590399","product_id":100046101,"comment_content":"http:&#47;&#47;thesecretlivesofdata.com&#47;raft&#47;     raft算法动态演示，看完老师的再看这个清晰明了","like_count":16,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503593,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606565410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2578845,"avatar":"https://static001.geekbang.org/account/avatar/00/27/59/9d/d08d869f.jpg","nickname":"cleanwk","note":"","ucode":"D717CC81A55415","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559695,"discussion_content":"很棒的图解谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648884048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221148,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1590417295,"is_pvip":false,"replies":[{"id":"86996","content":"加一颗星:)，如果新领导者不包含这部分日志，这部分日志会覆盖，即“以领导者日志为准，实现各节点日志的一致”，需要我们注意的是，复制到大多数节点的日志项，是不会丢失和改变的，而只被成功复制到少数节点的日志项，可能会被覆盖，也可能最终会被提交。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595092788,"ip_address":"","comment_id":221148,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44540090255","product_id":100046101,"comment_content":"老师请教一个问题，如果一个日志完整度最高的节点由于随机超时时间较长，没能帅先发起投票，没能当上领导者，那么这部分日志要怎么处理？","like_count":10,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496355,"discussion_content":"加一颗星:)，如果新领导者不包含这部分日志，这部分日志会覆盖，即“以领导者日志为准，实现各节点日志的一致”，需要我们注意的是，复制到大多数节点的日志项，是不会丢失和改变的，而只被成功复制到少数节点的日志项，可能会被覆盖，也可能最终会被提交。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595092788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1716827,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/32/5b/d0c7e813.jpg","nickname":"luo","note":"","ucode":"1A1DA8EB916ECF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549335,"discussion_content":"我的理解是 它应该完成不了半数节点通过，因为半数节点肯定是有最新日志的，因为写入成功需要半数节点以上，而写入成功肯定是之前的旧日志也成功了的，按顺序复制日志的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643863555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185819,"user_name":"旅途","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1583684297,"is_pvip":false,"replies":[{"id":"77637","content":"加一颗星:)，不是，因为日志完整度比它高的节点，不会投票给它，也就是文中提到的选举规则的第6条。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587239977,"ip_address":"","comment_id":185819,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40238389961","product_id":100046101,"comment_content":"老师 问个问题 如果 大多数跟随者节点 被相同任期编号 但是日志序号小的  先联络到了 这样的话 不是日志序号小节点 当选了吗","like_count":9,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486513,"discussion_content":"加一颗星:)，不是，因为日志完整度比它高的节点，不会投票给它，也就是文中提到的选举规则的第6条。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587239977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186457,"user_name":"欧阳","can_delete":false,"product_type":"c1","uid":1196886,"ip_address":"","ucode":"2612576E262813","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/56/62c38c36.jpg","comment_is_top":false,"comment_ctime":1583847464,"is_pvip":true,"replies":[{"id":"76358","content":"加一颗星:)，一般而言，在实际环境中，领导者任期长达数天（Chubby团队的观察值），具体取决于系统运行、网络状况等；在Hashcorp Raft中，任期索引是uint64，足够大了。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586373786,"ip_address":"","comment_id":186457,"utype":1}],"discussion_count":3,"race_medal":0,"score":"31648618536","product_id":100046101,"comment_content":"请问任期一般多长呢？还是只要不故障，任期一直不变？任期索引是用32位整数表示么？如果达到最大int，怎么处理呢？","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486763,"discussion_content":"加一颗星:)，一般而言，在实际环境中，领导者任期长达数天（Chubby团队的观察值），具体取决于系统运行、网络状况等；在Hashcorp Raft中，任期索引是uint64，足够大了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586373786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209101,"avatar":"https://static001.geekbang.org/account/avatar/00/12/73/0d/ad806980.jpg","nickname":"hh","note":"","ucode":"18E668B2777AEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206376,"discussion_content":"即使超时时间为1s这么短，也就是每隔1s任期加1，那2^31也是很长的时间了，要60多年了，什么系统能一直运行60多年？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584402813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1209101,"avatar":"https://static001.geekbang.org/account/avatar/00/12/73/0d/ad806980.jpg","nickname":"hh","note":"","ucode":"18E668B2777AEF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388557,"discussion_content":"太阳系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628834353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":206376,"ip_address":""},"score":388557,"extra":""}]}]},{"had_liked":false,"id":185023,"user_name":"岁月如歌","can_delete":false,"product_type":"c1","uid":1428828,"ip_address":"","ucode":"1AEBD6F79941B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QFE00aXGzaS6ibbfJSJsDrpIkqs0OrIYjzZv6L9vZmMhOlut2j24iaeZb0MCQazToE6FRXN960nNiaTrsmw09YjGw/132","comment_is_top":false,"comment_ctime":1583466805,"is_pvip":false,"replies":[{"id":"77772","content":"加一颗星:)，问题1：每个节点都存储有集群配置，也就集群成员的地址信息，所以，一个节点就能通过rpc消息和其它节点交互，另外，知道了当前集群的成员数，也就能判断“接收多少票数时，票数过半了”。问题2：任期编号，要持久化存储，并以原子变量的形式实现，集群重启，需要恢复到之前的值。问题3：感谢反馈，已修正。跟随者会比较日志完整性，来判断是否投票给候选人的，这个特性，能保证，只有日志较完整的节点（也就是包含所有已提交日志项的节点）才能当选领导者。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587308919,"ip_address":"","comment_id":185023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31648237877","product_id":100046101,"comment_content":"raft算法的局限：<br>1、强领导模型对于写功能基本退化单机性能，量大任然会出现性能瓶颈，适得其反。<br>2、选举期间会集群将出现短暂不可用现象，影响时长与选举时间相关。<br><br>有几个细节需要跟韩老师请教：<br>1、raft集群如何感知其他节点呢？候选节点如何判断获得的票数已经过半，从而晋升为领导者？<br>2、节点是如何存储任期编号？集群如果关闭重启是否任期编号归零？<br>3、<br>{1.当任期编号相同时，日志完整性高的跟随者（也就是最后一条日志项对应的任期编号值更大，索引号更大），拒绝投票给日志完整性低的候选人。比如节点 B、C 的任期编号都是 3，节点 B 的最后一条日志项对应的任期编号为 3，而节点 C 为 2，那么当节点 C 请求节点 B 投票给自己时，节点 B 将拒绝投票。}<br>-------------------------------------------------------------<br>文中该陈述应该标注为 选举有哪些规则 第6点。且表达意思与配图有所冲突: B节点(任期编号3)、C节点(任期编号4)，C节点任期编号更大，为何B节点拒绝C节点投票请求？ 请老师解析一下。","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486219,"discussion_content":"加一颗星:)，问题1：每个节点都存储有集群配置，也就集群成员的地址信息，所以，一个节点就能通过rpc消息和其它节点交互，另外，知道了当前集群的成员数，也就能判断“接收多少票数时，票数过半了”。问题2：任期编号，要持久化存储，并以原子变量的形式实现，集群重启，需要恢复到之前的值。问题3：感谢反馈，已修正。跟随者会比较日志完整性，来判断是否投票给候选人的，这个特性，能保证，只有日志较完整的节点（也就是包含所有已提交日志项的节点）才能当选领导者。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587308919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183702,"user_name":"Geek_niu","can_delete":false,"product_type":"c1","uid":1856903,"ip_address":"","ucode":"9C02ACC12F2D4B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Uv4icib4ZLZVa4RTW7CUibJAh6h23IPM5eiaibKzlmZfxWPWibUmAmxmnpafsesQiazcy5TtghOFwaMgppv58gbAgnRicA/132","comment_is_top":false,"comment_ctime":1583118114,"is_pvip":false,"replies":[{"id":"76198","content":"加一颗星:),可以理解为广播，广播给其他所有节点。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586287440,"ip_address":"","comment_id":183702,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31647889186","product_id":100046101,"comment_content":"候选者在向别的节点发布请求投票的RPC时，他是通过广播洪泛，还是gossip那样的方式","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485751,"discussion_content":"加一颗星:),可以理解为广播，广播给其他所有节点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586287440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182725,"user_name":"Happy","can_delete":false,"product_type":"c1","uid":1281479,"ip_address":"","ucode":"A19C5ECF0AE5FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/c7/d66952bc.jpg","comment_is_top":false,"comment_ctime":1582856387,"is_pvip":false,"replies":[{"id":"77624","content":"加一颗星:)，会的，因为一个节点对一个任期编号只有一张选票，投完就没了，如果不加一，也没法进行新一轮选举。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587234133,"ip_address":"","comment_id":182725,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31647627459","product_id":100046101,"comment_content":"老师您好，如果加了随机的超时时间，但是为了选取日志完整性较高的节点，导致一轮下来还是没有选举成功，那么会进行第二轮选举吗？此时的第二轮选举任期编号会 +1 吗？","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485429,"discussion_content":"加一颗星:)，会的，因为一个节点对一个任期编号只有一张选票，投完就没了，如果不加一，也没法进行新一轮选举。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587234133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1035607,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/57/94d49207.jpg","nickname":"Dear。","note":"","ucode":"FF9BD22F77CE8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377797,"discussion_content":"第一个candidate第一次没当选,是会由整个集群中的某个先超时(等待leader通知的超时)的节点继续发起投票吗？ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622861875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208632,"user_name":"QQ怪","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1587393413,"is_pvip":false,"replies":[{"id":"77948","content":"加一颗星:)，领导者挂了，会选举出新的领导者，Raft具有节点故障容错能力。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587397674,"ip_address":"","comment_id":208632,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23062229893","product_id":100046101,"comment_content":"leader挂了会导致集群不可用，读写都在leader上会有性能瓶颈，类似单机","like_count":5,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492550,"discussion_content":"加一颗星:)，领导者挂了，会选举出新的领导者，Raft具有节点故障容错能力。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587397674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211223,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","nickname":"QQ怪","note":"","ucode":"1A39B8433D9208","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241369,"discussion_content":"选举出新领导者这段时间集群不可用吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1587399275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1213078,"avatar":"https://static001.geekbang.org/account/avatar/00/12/82/96/aa795685.jpg","nickname":"mghio","note":"","ucode":"74883EDE4FD0DC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1211223,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","nickname":"QQ怪","note":"","ucode":"1A39B8433D9208","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560869,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649474734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":241369,"ip_address":""},"score":560869,"extra":""}]},{"author":{"id":1780905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ9oIRvWZARRnzyCuxbWU7vqgp9oSb6QyTF1YLyUOLhr1e4nyey39tKJRDj2LdggCHQahkuqrt3mw/132","nickname":"凌凌漆","note":"","ucode":"23233C5708B159","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393139,"discussion_content":"如果是由于负载过重领导者宕机，新选举的领导者还是会挂。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631264889,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208340,"user_name":"longyi","can_delete":false,"product_type":"c1","uid":1318113,"ip_address":"","ucode":"204CC8D3E98AAC","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/e1/c99d1473.jpg","comment_is_top":false,"comment_ctime":1587342469,"is_pvip":false,"replies":[{"id":"77863","content":"加一颗星:)，不会，比如，其它节点接收到来自它的请求投票RPC消息后，会更新自己的term到这个值（它的值），然后会比较日志完整性，决定是否投票给它。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587357095,"ip_address":"","comment_id":208340,"utype":1}],"discussion_count":4,"race_medal":0,"score":"18767211653","product_id":100046101,"comment_content":"如果一个节点孤立了，这个节点可能不断的发起选举，但是又成不了leader，所以它的term会越变越大。当它回到集群的时候，它拥有一个很大的term，会对集群其他节点造成什么影响吗？","like_count":4,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492427,"discussion_content":"加一颗星:)，不会，比如，其它节点接收到来自它的请求投票RPC消息后，会更新自己的term到这个值（它的值），然后会比较日志完整性，决定是否投票给它。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587357095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318113,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1c/e1/c99d1473.jpg","nickname":"longyi","note":"","ucode":"204CC8D3E98AAC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241915,"discussion_content":"\n我了解到，raft为了解决单个follower断开后term不断增大的问题，引入了prevote机制。\n因为这个节点回到集群后会把正常的leader给step down。为啥呢？follower拥有很大的term，它会发起选举，如果它的日志也不少，那么其他节点就会投票给它，它成了新的leader。老的leader就stepdown了。不知道我分析的对不对？","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1587448275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318113,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1c/e1/c99d1473.jpg","nickname":"longyi","note":"","ucode":"204CC8D3E98AAC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388902,"discussion_content":"如果孤立的follower回来之后，数据比较老了，那么会通过投票请求更新其它节点的term，但是leader不会改变，然后这个follower收到leader的心跳（请求中term已更新为较大值），那么就会接受这个leader，不知道是不是这样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629034087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":241915,"ip_address":""},"score":388902,"extra":""}]},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315934,"discussion_content":"是的, 之前的leader发现集群中有更高的term, 会直接放弃选举, 但同时会更新自己term为最大的term, 在后续选举中, 会因为log更新而选出正确的leader.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603338113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206283,"user_name":"侧耳倾听","can_delete":false,"product_type":"c1","uid":1512642,"ip_address":"","ucode":"5BF2A2440B54F0","user_header":"https://static001.geekbang.org/account/avatar/00/17/14/c2/46ebe3a0.jpg","comment_is_top":false,"comment_ctime":1586834523,"is_pvip":true,"replies":[{"id":"77176","content":"加一颗星:)，主要目标是减少选票被瓜分的情况。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586885221,"ip_address":"","comment_id":206283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18766703707","product_id":100046101,"comment_content":"随机时间的问题上，我理解的是每个跟随者随机一个超时时间，所以时间范围上从小到大的随机数，这个随机时间间隔不会太大，要不然时间小的跟随者要发起多次选举，时间的作用是为了避免同一节点多个选举的情况出现，那么，如果一个跟随者想要选举自己成为领导者，必须要得到超过半数追随者的投票，实际等待下一个超时时间间隔的意思是要一直等到跟随者失联数目超过半数，这之间可能需要经过数个间隔","like_count":4,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491740,"discussion_content":"加一颗星:)，主要目标是减少选票被瓜分的情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586885221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233887,"user_name":"小宇宙","can_delete":false,"product_type":"c1","uid":1029649,"ip_address":"","ucode":"BBFFC39CB9E26F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/11/e8506a04.jpg","comment_is_top":false,"comment_ctime":1594491507,"is_pvip":false,"replies":[{"id":"86544","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1594742128,"ip_address":"","comment_id":233887,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14479393395","product_id":100046101,"comment_content":"leader为中心主要有三个问题：1)性能问题，如果leader为慢节点会导致长尾。2)日志的同步必须是有序提交   3)切换leader时会有一段时间的不可用","like_count":3,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501206,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594742128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185643,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1236305,"ip_address":"","ucode":"847168EE0E7D44","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/51/a7e82963.jpg","comment_is_top":false,"comment_ctime":1583654161,"is_pvip":false,"replies":[{"id":"76185","content":"加一颗星:)，会的，按照文中提到的选举规则，进行投票。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586285060,"ip_address":"","comment_id":185643,"utype":1}],"discussion_count":8,"race_medal":0,"score":"14468556049","product_id":100046101,"comment_content":"老师你好，如果一个跟随者因为网络原因未收到领导者心跳，这时这个节点变成候选节点，此时这个节点发起的投票，其他正常的节点会回应投票结果么？","like_count":3,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486448,"discussion_content":"加一颗星:)，会的，按照文中提到的选举规则，进行投票。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586285060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107398,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/c6/11e0f717.jpg","nickname":"苍漠胡杨","note":"","ucode":"E19B685A05F893","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216923,"discussion_content":"细节是魔鬼。当follower接收到candidate的requestvote rpc时，在献出自己在本term的珍贵的一票之前，不但确认term，还需要确认candidate的log是否比自己的log新，新则投票，否则拒绝。判断是否是新的准则是：最后一条log的term和index，term大则新，term相同index大则新。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1585492264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1637026,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fa/a2/1d1d3880.jpg","nickname":"学徒","note":"","ucode":"9D2513D1D361DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1107398,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/c6/11e0f717.jpg","nickname":"苍漠胡杨","note":"","ucode":"E19B685A05F893","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265025,"discussion_content":"想问下，有没有这样一种情况，就是那个和leader由于网络原因未收到心跳而成为候选人的节点，在成为候选人到发起投票的那段时间内，leader节点没有处理任何读写请求，那么这样的话，该候选人的日志是和其他跟随者节点的日志是相同的，那么这种情况，其他跟随者怎么进行投票决定？如果投票了，并收到大多数节点同意的话，岂不是有了两个leader？还是说，旧leader会变成跟随者？还是其他跟随者拒绝了旧leader相关读写请求？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589368740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":216923,"ip_address":""},"score":265025,"extra":""},{"author":{"id":1351148,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/ec/235b74c0.jpg","nickname":"ppyh","note":"","ucode":"14022ADEC9B53F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637026,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fa/a2/1d1d3880.jpg","nickname":"学徒","note":"","ucode":"9D2513D1D361DA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283919,"discussion_content":"感觉确实会有两个leader节点，并且两个leader节点的网络不同，但是两个leader节点分别和其他节点都是通的，客户端在写数据时肯定转发到新的任期较大的新节点（纯属瞎猜），等我看完下一节再回过头来想想这个问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592399913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":265025,"ip_address":""},"score":283919,"extra":""},{"author":{"id":2095550,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/f9/be/6c3a1b6c.jpg","nickname":"小郑","note":"","ucode":"F52BDD1BD35FF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637026,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fa/a2/1d1d3880.jpg","nickname":"学徒","note":"","ucode":"9D2513D1D361DA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295151,"discussion_content":"假设集群中只有leader和节点A直接不通，其他节点和他俩都是畅通的，那么节点A确实会因为未收到心跳和发起竞选，然后因为其任期较大而得到大多数follower的选票成为新的leader。此时集群内确实会短暂存在两个leader的情况，但是随着旧leader自以为是地向其他follower发送心跳，它会发现follower返回的心跳回应消息的term竟然比自己更高，因此它会自觉降级成为follower。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1596103864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":265025,"ip_address":""},"score":295151,"extra":""}]},{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"吴小智","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208348,"discussion_content":"也在想这个问题，希望老师可以回答一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584542335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181910,"user_name":"黄海峰","can_delete":false,"product_type":"c1","uid":1275357,"ip_address":"","ucode":"E9340719BC96B2","user_header":"https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg","comment_is_top":false,"comment_ctime":1582678617,"is_pvip":false,"replies":[{"id":"70764","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582924846,"ip_address":"","comment_id":181910,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14467580505","product_id":100046101,"comment_content":"写请求无法扩容","like_count":3,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485164,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582924846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388562,"discussion_content":"why？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628836162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1333380,"avatar":"https://static001.geekbang.org/account/avatar/00/14/58/84/fd5031e5.jpg","nickname":"别忘微笑","note":"","ucode":"855266F40976E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551852,"discussion_content":"因为只能又一个leader","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645153864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388562,"ip_address":""},"score":551852,"extra":""}]}]},{"had_liked":false,"id":238520,"user_name":"林万伟","can_delete":false,"product_type":"c1","uid":1188304,"ip_address":"","ucode":"099CC4B8CC5B1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/d0/aa5422f2.jpg","comment_is_top":false,"comment_ctime":1596187703,"is_pvip":false,"replies":[{"id":"88144","content":"加一颗星:)，问题1：可能是A，取决于投票情况；需要我们注意的是，当其他节点接收到A的投票请求后，会将自己的term更新到这个较大的值。问题2：可能是B或C，不可能是A，因为A不是“大多数”节点中日志最完整的节点。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1596251112,"ip_address":"","comment_id":238520,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10186122295","product_id":100046101,"comment_content":"老师，请问A、B、C三个节点，B为leader，三个节点term都为1，然后发生网络分区，A一个子网，B、C一个子网。A因为一直选举，导致term很大。这时候会有两种情况：<br>1.分区期间，日志没有变化，A、B、C三个节点的日志完整性都一样，这时候A节点网络恢复。此时Leader会是谁？<br>2.分区期间，日志发生变化，必然是B、C子网的日志完整性更高。此时A节点网络恢复，这个时候Leader会是谁呢？<br><br>","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502774,"discussion_content":"加一颗星:)，问题1：可能是A，取决于投票情况；需要我们注意的是，当其他节点接收到A的投票请求后，会将自己的term更新到这个较大的值。问题2：可能是B或C，不可能是A，因为A不是“大多数”节点中日志最完整的节点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596251112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182708,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1582853932,"is_pvip":false,"replies":[{"id":"77709","content":"加一颗星:)，感谢反馈，这个表达有点歧义，我修正下。可以这么理解，当候选人的任期编号大于跟随者时，将会比较日志完整性，日志完整性高的跟随者，拒绝投票给日志完整性低的候选人。因为B的日志比C的，要完整，所以B拒绝投票给C。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587303117,"ip_address":"","comment_id":182708,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10172788524","product_id":100046101,"comment_content":"当任期编号相同时，日志完整性高的跟随者（也就是最后一条日志项对应的任期编号值更大，索引号更大），拒绝投票给日志完整性低的候选人。比如节点 B、C 的任期编号都是 3，节点 B 的最后一条日志项对应的任期编号为 3，而节点 C 为 2，那么当节点 C 请求节点 B 投票给自己时，节点 B 将拒绝投票。<br>————<br>关于这种情况，跟配图不太一致，如果B，C任期编号相同，都是3，节点C发起的选举投票应该是4，B不就应该接受投票吗？麻烦老师解惑","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485421,"discussion_content":"加一颗星:)，感谢反馈，这个表达有点歧义，我修正下。可以这么理解，当候选人的任期编号大于跟随者时，将会比较日志完整性，日志完整性高的跟随者，拒绝投票给日志完整性低的候选人。因为B的日志比C的，要完整，所以B拒绝投票给C。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587303117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306806,"user_name":"大当家","can_delete":false,"product_type":"c1","uid":1005988,"ip_address":"","ucode":"5FD8ABF38434CB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/a4/bad75a73.jpg","comment_is_top":false,"comment_ctime":1628731110,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5923698406","product_id":100046101,"comment_content":"老师好，请教个问题。对比MySQL Redis 主从的模型（一般master是写死的）。raft协议的leader是选举出来的，在切leader过程中我理解到的是整个服务是不提供写操作的，我想问的是采用raft协议构建的应用是如何处理这种不可以的操作过程（或者说有没有线上实测过写不可用时间）","like_count":1},{"had_liked":false,"id":249266,"user_name":"ezekiel","can_delete":false,"product_type":"c1","uid":1158795,"ip_address":"","ucode":"AB4AB6FA8612D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/8b/43ce01ca.jpg","comment_is_top":false,"comment_ctime":1600531866,"is_pvip":false,"replies":[{"id":"91813","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1601301111,"ip_address":"","comment_id":249266,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5895499162","product_id":100046101,"comment_content":"我觉得任期，理解成朝代更合适","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505881,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601301111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242078,"user_name":"仲夏夜空星星多","can_delete":false,"product_type":"c1","uid":1744596,"ip_address":"","ucode":"DB512D7722E551","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9e/d4/95f6fb65.jpg","comment_is_top":false,"comment_ctime":1597585837,"is_pvip":false,"replies":[{"id":"96376","content":"加一颗星:)，1. 会的，直到有领导者当选；2. 随机时间大小，一般在实现的时候，做成可配置的，在一个时间范围内，怎么查看，与具体实现有关。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1606830602,"ip_address":"","comment_id":242078,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5892553133","product_id":100046101,"comment_content":"感觉还是有些细节没有说到，比如候选人如果没选上，那下一个谁来竞选，由随机时间决定的话，刚刚失败那个候选人会不会再来，会不会总是它。候选随机时间怎么确定，怎么查看是否到了候选随机时间","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503916,"discussion_content":"加一颗星:)，1. 会的，直到有领导者当选；2. 随机时间大小，一般在实现的时候，做成可配置的，在一个时间范围内，怎么查看，与具体实现有关。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606830602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241420,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1597289194,"is_pvip":false,"replies":[{"id":"95942","content":"加一颗星:)，可以这么理解，需要突破领导者的性能限制。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1606569781,"ip_address":"","comment_id":241420,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5892256490","product_id":100046101,"comment_content":"从早晨将这节课的文章读完,到在午休时候又品了一边,现在看来Raft暴露的&#39;一切以我为准&#39;还是没有跳脱Chubby的只有主节点能服务的限制,没有实际的增加吞吐量,相当于一个只保证了可用性的单机系统","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503739,"discussion_content":"加一颗星:)，可以这么理解，需要突破领导者的性能限制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606569781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229593,"user_name":"贰的11次方","can_delete":false,"product_type":"c1","uid":1813810,"ip_address":"","ucode":"73299BAA100131","user_header":"https://static001.geekbang.org/account/avatar/00/1b/ad/32/8d4ca29e.jpg","comment_is_top":false,"comment_ctime":1593069373,"is_pvip":false,"replies":[{"id":"88050","content":"加一颗星:)，包含的，这样就能避免参加了“高任期编号”对应的领导者选举，再去参加“低任期编号”对应的领导者选举。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1596136485,"ip_address":"","comment_id":229593,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5888036669","product_id":100046101,"comment_content":"老师，关于本章节中“当收到来自节点 A 的请求投票 RPC 消息时，因为消息中包含了节点 A 的任期编号，且编号为 1，那么节点 B 将把自己的任期编号更新为 1” 这段话，我有一点疑问：节点更新自己的任期编号的时机应该不包含 投票请求这一种情况吧。 因为，我的理解是，如果直接更新了任期编号，但是你的投票最终是无效的（没有超过半数）那么这个来自候选人的任期编号也是无效的吧。","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499549,"discussion_content":"加一颗星:)，包含的，这样就能避免参加了“高任期编号”对应的领导者选举，再去参加“低任期编号”对应的领导者选举。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596136485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225646,"user_name":"余向华","can_delete":false,"product_type":"c1","uid":1119778,"ip_address":"","ucode":"263773616D2C83","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/22/2205cf0a.jpg","comment_is_top":false,"comment_ctime":1591804190,"is_pvip":false,"replies":[{"id":"87283","content":"加一颗星：），一般，设置为不同的值，因为这两个时间间隔背后的消息数，是不同的。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595348633,"ip_address":"","comment_id":225646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5886771486","product_id":100046101,"comment_content":"老师你好，请教个问题，你说到的是随机时间是有两种含义的，那么这两种不同含义的随机时间的值是一样的吗还是不同的？","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497926,"discussion_content":"加一颗星：），一般，设置为不同的值，因为这两个时间间隔背后的消息数，是不同的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595348633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217140,"user_name":"Geek_yuanhe","can_delete":false,"product_type":"c1","uid":1981636,"ip_address":"","ucode":"8452947BBF1C36","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","comment_is_top":false,"comment_ctime":1589425103,"is_pvip":false,"replies":[{"id":"80714","content":"加一颗星:)，算法本身没这个限制，取决于Raft系统准备的提供的一致性，如果实现的最终一致性，可以设置所有节点都可读的，也就是说，接收到读请求后，响应本地数据，类似ZooKeeper。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1589769422,"ip_address":"","comment_id":217140,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884392399","product_id":100046101,"comment_content":"raft算法中，是不是读只能读leader节点？ ","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495052,"discussion_content":"加一颗星:)，算法本身没这个限制，取决于Raft系统准备的提供的一致性，如果实现的最终一致性，可以设置所有节点都可读的，也就是说，接收到读请求后，响应本地数据，类似ZooKeeper。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589769422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216957,"user_name":"Geek_yuanhe","can_delete":false,"product_type":"c1","uid":1981636,"ip_address":"","ucode":"8452947BBF1C36","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJExu8mFzkasuz32FLic5HaYMXicEBnpl63CxZoyYywLY3c59uGicCr9FmWicqKfEA73rmYgtglc1ztAg/132","comment_is_top":false,"comment_ctime":1589376384,"is_pvip":false,"replies":[{"id":"80774","content":"加一颗星:)，不会一直选举不出来。这个问题是在设计选举机制时，需要考虑如何避免的问题，也是为什么要引入随机超时时间的原因。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1589824555,"ip_address":"","comment_id":216957,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5884343680","product_id":100046101,"comment_content":"老师，如果一直选举不出来，会不会出现僵死的情况？这是不是挺严重的","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494993,"discussion_content":"加一颗星:)，不会一直选举不出来。这个问题是在设计选举机制时，需要考虑如何避免的问题，也是为什么要引入随机超时时间的原因。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589824555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205859,"user_name":"ξ！","can_delete":false,"product_type":"c1","uid":1636657,"ip_address":"","ucode":"F9797D21EBE10E","user_header":"https://static001.geekbang.org/account/avatar/00/18/f9/31/b75cc6d5.jpg","comment_is_top":false,"comment_ctime":1586747850,"is_pvip":false,"replies":[{"id":"77162","content":"加一颗星:)，这个随机是指间隔时长在一定范围内随机，比如Hashicorp Raft默认值是在1s ~ 2s内随机，而且，选举出新的领导者后，集群状态就稳定下来了。另外，我想补充一点，算法论文相比代码实现，还是比较理论的，可以边阅读代码，边研究论文。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586876037,"ip_address":"","comment_id":205859,"utype":1}],"discussion_count":0,"race_medal":0,"score":"5881715146","product_id":100046101,"comment_content":"老师!跟随者等待领导者心跳信息超时的时间间隔，是随机的；<br>这样的话不会频繁的发生选举过程么???","like_count":1},{"had_liked":false,"id":183392,"user_name":"高山仰止","can_delete":false,"product_type":"c1","uid":1190305,"ip_address":"","ucode":"8C2E839345E734","user_header":"https://static001.geekbang.org/account/avatar/00/12/29/a1/220b99b6.jpg","comment_is_top":false,"comment_ctime":1583032497,"is_pvip":false,"replies":[{"id":"77621","content":"加一颗星:)，当前的任期编号加1，可以研究下Hashicorp Raft的runCandidate()函数来辅助理解。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587232263,"ip_address":"","comment_id":183392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5877999793","product_id":100046101,"comment_content":"老师你好！如果有一个跟随者因领导者心跳检测超时，变成了候选者，那么此时该候选者的提交任期编号是基于节点上一次接受到的最大任期编号+1，还是随机生成呢？","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485675,"discussion_content":"加一颗星:)，当前的任期编号加1，可以研究下Hashicorp Raft的runCandidate()函数来辅助理解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587232263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182303,"user_name":"bc","can_delete":false,"product_type":"c1","uid":1009801,"ip_address":"","ucode":"3899698EA715EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/68/89/173601c5.jpg","comment_is_top":false,"comment_ctime":1582766317,"is_pvip":false,"replies":[{"id":"76517","content":"加一颗星:)，应该是没有收到心跳时吧。如果其他节点没有投出针对该任期的选票，它将投出一票。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586474685,"ip_address":"","comment_id":182303,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5877733613","product_id":100046101,"comment_content":"某个节点为收到心跳，于是发起新一轮投票，其他节点如何处理，毕竟任期编号+1","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485295,"discussion_content":"加一颗星:)，应该是没有收到心跳时吧。如果其他节点没有投出针对该任期的选票，它将投出一票。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586474685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182252,"user_name":"邵邵","can_delete":false,"product_type":"c1","uid":1201070,"ip_address":"","ucode":"E9AAC822185AFD","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/ae/26faa892.jpg","comment_is_top":false,"comment_ctime":1582734402,"is_pvip":false,"replies":[{"id":"70762","content":"存储用户指定的指令的一种数据格式，可以简单理解为一组指令:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582924704,"ip_address":"","comment_id":182252,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5877701698","product_id":100046101,"comment_content":"raft节点中的日志如何理解？","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485271,"discussion_content":"存储用户指定的指令的一种数据格式，可以简单理解为一组指令:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582924704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182216,"user_name":"燃烧的M豆","can_delete":false,"product_type":"c1","uid":1355000,"ip_address":"","ucode":"BEDA9FC8852F5D","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/f8/a56b7475.jpg","comment_is_top":false,"comment_ctime":1582730054,"is_pvip":false,"replies":[{"id":"76374","content":"加一颗星:)，会的，可以这么理解，领导者不是一部分人的领导者，是所有人的领导者，当有人发现他可能“出事”时，就要发起新的选举。另外，可以研究raft实现（比如Hashicorp raft）来辅助理解。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586377842,"ip_address":"","comment_id":182216,"utype":1}],"discussion_count":8,"race_medal":0,"score":"5877697350","product_id":100046101,"comment_content":"有个疑问 在发起选举之前 如果 leader 给 follower appendEntries 心跳的时候短暂失败了几次 follower 这个时候以为没有 leader 了从而提升自己的 term 然后向大家发起投票请求 但是其他连接上之前 leader 的节点并未断掉服务也都正常。这会造成整个 raft 重新选 leader 吗？ 不知道这么说清不清除 请老师解答一下","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485256,"discussion_content":"加一颗星:)，会的，可以这么理解，领导者不是一部分人的领导者，是所有人的领导者，当有人发现他可能“出事”时，就要发起新的选举。另外，可以研究raft实现（比如Hashicorp raft）来辅助理解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586377842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg","nickname":"Geek_5244fa","note":"","ucode":"B87A550526F74C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189313,"discussion_content":"再看论文，发现只要收到term比自己大，自己就会变成更新term并且变成follower，最后的确是会导致集群重选leader。\n\n后来作者在Consensus: Bridging Theory and Practice 这篇论文里加了Pre-Vote 算法来避免触发不必要的选举。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1582868223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg","nickname":"Geek_5244fa","note":"","ucode":"B87A550526F74C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189291,"discussion_content":"你看 RequestVote RPC里，有 term（candidate的term） 、 lastLogIndex、lastLogTerm。判断日志是否最新，是判断先判断lastLogTerm再判断lastLogIndex。\n\n即使candidate的term比follower大，但是lastLogTerm和lastLogIndex比follower的小，也是被拒绝的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1582865047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg","nickname":"Geek_5244fa","note":"","ucode":"B87A550526F74C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188925,"discussion_content":"选举过程中，除了term还要比较已提交的日志。如果一个follower的日志比candidate的新，即使 candidate 的term 比较大，它的投票请求也会被拒绝掉。如果candidate包含全部已交的日志，是有可能成功挤掉原来的leader，不过这种情况也不会丢失数据。不知有没理解错。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582820791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1355000,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ac/f8/a56b7475.jpg","nickname":"燃烧的M豆","note":"","ucode":"BEDA9FC8852F5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1072743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg","nickname":"Geek_5244fa","note":"","ucode":"B87A550526F74C","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":189172,"discussion_content":"论文有说先看 term 后看 日志。如果我 term 比你大 你就算日志比我大也不行吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582855898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":188925,"ip_address":""},"score":189172,"extra":""},{"author":{"id":1179952,"avatar":"https://static001.geekbang.org/account/avatar/00/12/01/30/cb3a729e.jpg","nickname":"XHH","note":"","ucode":"3EF89099982977","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1355000,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ac/f8/a56b7475.jpg","nickname":"燃烧的M豆","note":"","ucode":"BEDA9FC8852F5D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":190262,"discussion_content":"虽然是发起请求投票了，follower会比较日志的新旧，如果比自己的旧就拒绝，voter denies its vote if its own log is more up-to-date than that of the candidate.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582911349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":189172,"ip_address":""},"score":190262,"extra":""},{"author":{"id":1275690,"avatar":"https://static001.geekbang.org/account/avatar/00/13/77/2a/244d98aa.jpg","nickname":"cp★钊","note":"","ucode":"6B86D4D538BDF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1179952,"avatar":"https://static001.geekbang.org/account/avatar/00/12/01/30/cb3a729e.jpg","nickname":"XHH","note":"","ucode":"3EF89099982977","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202003,"discussion_content":"我也觉得先判断日志比较合理，那老师应该描述错了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583853607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":190262,"ip_address":""},"score":202003,"extra":""}]},{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"约书亚","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192845,"discussion_content":"好像sofajraft就针对这个问题做了优化，这应该是个挺常见的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583106441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182129,"user_name":"姜川","can_delete":false,"product_type":"c1","uid":1684311,"ip_address":"","ucode":"0F8A349623EAB5","user_header":"https://static001.geekbang.org/account/avatar/00/19/b3/57/2d92cf9a.jpg","comment_is_top":false,"comment_ctime":1582714549,"is_pvip":false,"replies":[{"id":"76375","content":"加一颗星:)，每个节点对每个任期只有一张选票，如果任期相同，就不会投，因为已经投过了，投给了自己；如果收到的投票请求的任期编号大于自己的当前值，就会投票；如果收到的投票请求的任期编号小于自己的当前值，拒绝该请求。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586378202,"ip_address":"","comment_id":182129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5877681845","product_id":100046101,"comment_content":"关键点就在于随机，不知道会不会有这种，某个节点等待领导者超时了，然后任期编号+1发起投票，收到响应之前又收到了其他节点的投票，这是这个节点是会投票的吧","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485230,"discussion_content":"加一颗星:)，每个节点对每个任期只有一张选票，如果任期相同，就不会投，因为已经投过了，投给了自己；如果收到的投票请求的任期编号大于自己的当前值，就会投票；如果收到的投票请求的任期编号小于自己的当前值，拒绝该请求。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586378202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181895,"user_name":"忆水寒","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1582674715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877642011","product_id":100046101,"comment_content":"单点故障","like_count":1},{"had_liked":false,"id":358390,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1002095,"ip_address":"河北","ucode":"1A44368083A19E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/6f/e36b3908.jpg","comment_is_top":false,"comment_ctime":1664265766,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664265766","product_id":100046101,"comment_content":"心跳消息维持领导地位<br>日志较完整是成为领导者的必要条件<br>一次选举，一个节点投票一张，先来先得，只能投给日志日志更完整的候选人<br>两个随机超时时间：心态随机超时时间、选举随机超时时间","like_count":0},{"had_liked":false,"id":346961,"user_name":"Geek_417e74","can_delete":false,"product_type":"c1","uid":2113978,"ip_address":"","ucode":"BEA8915879274D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLniccwC1Mootc7IQsRGUTX3ZkkCKPc7lYV0g8CAqscWtAjd8xkHYcY3UFbYvicm42FXuAO5bZP6WQ/132","comment_is_top":false,"comment_ctime":1653560989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653560989","product_id":100046101,"comment_content":"为什么raft领导者选举没发起二阶段请求呢？因为领导者选举不需要就某个值达成共识（不需要设置key的value）。只需要执行basic paxos的准备阶段就知道哪个节点收到了大多数选票，他就成为领导者。比较basic paxos优点：增加了任期（相当于多个basic paxos实例，改变领导者更简单）；日志更完整的才能当选领导者（生产环境这一点很重要）","like_count":0},{"had_liked":false,"id":335163,"user_name":"Geek_31e6fe","can_delete":false,"product_type":"c1","uid":1779530,"ip_address":"","ucode":"90A7D6B01A6E38","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/OgopVGSkwlFuyHV0hWtzxvd34smRic25lYwwQ1MTCuyZbwEiaPQ6tGafH3nLY12wJfAiaC1Qeiaiazq9jumGtolhTZw/132","comment_is_top":false,"comment_ctime":1645368058,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645368058","product_id":100046101,"comment_content":"raft leader ，收到更高的term的candidate的请求投票的请求，为什么一定要转为follower？不能对比日志吗","like_count":0},{"had_liked":false,"id":333507,"user_name":"大林 Kralite","can_delete":false,"product_type":"c1","uid":1380723,"ip_address":"","ucode":"68EA1DA9720F02","user_header":"https://static001.geekbang.org/account/avatar/00/15/11/73/524c1395.jpg","comment_is_top":false,"comment_ctime":1644390187,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644390187","product_id":100046101,"comment_content":"请问老师：如果某一个follower节点A因为网络原因没有收到leader的心跳，它会变成Candidate发起一次选举，并且term+1。<br>但是此时只有A是没收到心跳，其它节点是正常收到心跳的，那其它节点会因为A的选举消息的触发，也变成Candidate去请求选举吗?<br>1. 如果其它节点也变成Candidate，那岂不是只有有一个节点有一次收心跳超时，就会触发一次全局重新选举，成本有点高；<br>2. 如果其它节点没变成Candidate，并且因为日志完整性不给A投票，那A的 term+1是不是会回退到term（A后续又收到了leader的心跳）? 如果不回退的话，整个集群是否都要跟着的term+1?","like_count":0},{"had_liked":false,"id":331988,"user_name":"大鹏哥","can_delete":false,"product_type":"c1","uid":1053443,"ip_address":"","ucode":"89DAC3E966B08D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKBuyKI3jn9fEdWoMaBkDibgHxxRu4FfHe1B7QTajlc3Lf1l1ddRUDMpwmtELqH9UcZ9Eia51XibVmjw/132","comment_is_top":false,"comment_ctime":1642945549,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642945549","product_id":100046101,"comment_content":"如果 两个节点的随机超时时间 相同 会怎么样？","like_count":0},{"had_liked":false,"id":330306,"user_name":"浩然","can_delete":false,"product_type":"c1","uid":1295043,"ip_address":"","ucode":"D1FB4E3E7ADE5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/c2/c3/da31c9c2.jpg","comment_is_top":false,"comment_ctime":1641901159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641901159","product_id":100046101,"comment_content":"如果有节点 ABC，如果节点 A 发起投票任期为3，最新日志时间是1，节点 B 的最新日志时间是2，拒绝投票，但是有什么用呢？节点 AC 都投票给节点 A，A 还是领导者。","like_count":0},{"had_liked":false,"id":330116,"user_name":"Jerry","can_delete":false,"product_type":"c1","uid":1127081,"ip_address":"","ucode":"D785295EEC1489","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/a9/698de007.jpg","comment_is_top":false,"comment_ctime":1641802430,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641802430","product_id":100046101,"comment_content":"如果A节点没有收到leader的心跳，发起候选人选举投票，任期编号为1，在还没有完成选举时。B节点也接收leader心跳超时，会再发起一个任期编号为2的选举吗？","like_count":0},{"had_liked":false,"id":329978,"user_name":"Jerry","can_delete":false,"product_type":"c1","uid":1127081,"ip_address":"","ucode":"D785295EEC1489","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/a9/698de007.jpg","comment_is_top":false,"comment_ctime":1641711369,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641711369","product_id":100046101,"comment_content":"如果只是A节点接受leader的消息超时了。当前的任期编号是0，A向B节点以及其他阶段发送编号为1的请求，B节点以及其他大部分节点更新为1，那不就篡权了吗？","like_count":0},{"had_liked":false,"id":329401,"user_name":"核桃","can_delete":false,"product_type":"c1","uid":1385204,"ip_address":"","ucode":"7AB05270CBCCCB","user_header":"https://static001.geekbang.org/account/avatar/00/15/22/f4/9fd6f8f0.jpg","comment_is_top":false,"comment_ctime":1641316842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641316842","product_id":100046101,"comment_content":"这里再次回看Raft算法的问题，leader选举问题，elasticsearch这些工具其实已经给出了很多工程实现方案， 关于超时选举，在es中其实并不使用这种方式，而是通过ping其他节点，然后知道节点 id，根据活跃的最大最小的候选者id来得到，然后次大或者次小的节点作为第二leader候选者，那么一旦发生切换了，就不需要再次选举了。<br>当然这里切换过程中会导致的问题，例如是否会触发修复或者请求异常，就需要非常小心地处理了。<br><br>总的来说，个人还是喜欢glusterfs的无中心架构，而且Raft的很多实现，包括etcd，性能其实不太好的，因此目前业界对于这套算法的实现，有很多很多的争议。","like_count":0},{"had_liked":false,"id":313475,"user_name":"严海波","can_delete":false,"product_type":"c1","uid":1264573,"ip_address":"","ucode":"8D4E230FD95383","user_header":"https://static001.geekbang.org/account/avatar/00/13/4b/bd/fe8c68b3.jpg","comment_is_top":false,"comment_ctime":1632455206,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632455206","product_id":100046101,"comment_content":"raft如何处理这种情况，领导者和某个跟随者网路通路出现故障，而分别和其他节点通信正常。那个跟随者收不到领导者心跳会发起新的选举，然后被选举成新的领导者，原来的领导者这个时候变成跟随者，然后收不到领导者的心跳从而又发起新一轮选举，如此以往，周而复始","like_count":0},{"had_liked":false,"id":312640,"user_name":"臧咔嚓","can_delete":false,"product_type":"c1","uid":1101627,"ip_address":"","ucode":"827758EC99C34F","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/3b/679b518b.jpg","comment_is_top":false,"comment_ctime":1631923639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631923639","product_id":100046101,"comment_content":"我感觉如果能从三个角色及其变化条件来谈可能会更清晰易懂：follow满足什么条件接受&#47;拒绝Request vote，什么时候变成Candidate；Candidate在什么条件下又变成follow、Candidate在什么条件下变成Leader；Leader什么条件下变成follow","like_count":0},{"had_liked":false,"id":310625,"user_name":"lhgdy","can_delete":false,"product_type":"c1","uid":1301502,"ip_address":"","ucode":"92140E9AB7659A","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/fe/90446b61.jpg","comment_is_top":false,"comment_ctime":1630808364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630808364","product_id":100046101,"comment_content":"在某一时刻是否会存在 不同term的leader？ abcde 五个节点图，abc 中 a成为leader cde 发起新的一轮选举，e成为了leader，此时是不是算是有两个leader了？","like_count":0},{"had_liked":false,"id":306152,"user_name":"乘修","can_delete":false,"product_type":"c1","uid":1745932,"ip_address":"","ucode":"45FB065DDD94D3","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a4/0c/be3ac2ca.jpg","comment_is_top":false,"comment_ctime":1628408368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628408368","product_id":100046101,"comment_content":"领导者节点因为高负载问题,导致存在有延迟问题,导致某追随者在超时时间内,没有收到领导者的心跳信息,因此发起了选举投票,它是否会当选?按照我的理解,它将会当选.但是如果它在当选之后依旧存在高负载问题,这样是否会导致重复选举?","like_count":0},{"had_liked":false,"id":299817,"user_name":"牛牛","can_delete":false,"product_type":"c1","uid":1030135,"ip_address":"","ucode":"3FC01F8D66B2FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/f7/b2423197.jpg","comment_is_top":false,"comment_ctime":1624871015,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1624871015","product_id":100046101,"comment_content":"心跳随机时间和选举随机时间两者是同一个时间吗？如果两者不相同麻烦解析一下，谢谢!!@老师","like_count":0},{"had_liked":false,"id":299815,"user_name":"牛牛","can_delete":false,"product_type":"c1","uid":1030135,"ip_address":"","ucode":"3FC01F8D66B2FB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/f7/b2423197.jpg","comment_is_top":false,"comment_ctime":1624870835,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1624870835","product_id":100046101,"comment_content":"如果一个掉队的节点重新回到集群，发起投票请求，如果日志完整度一样的情况下，集群当前的主节点会投票给掉队的节点，让他接任主节点吗？","like_count":0},{"had_liked":false,"id":297635,"user_name":"对方正在输入。。。","can_delete":false,"product_type":"c1","uid":1179298,"ip_address":"","ucode":"7B0DEB4D9B43D2","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/a2/5252a278.jpg","comment_is_top":false,"comment_ctime":1623681743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623681743","product_id":100046101,"comment_content":"老师，如果选举失败，发起新的选举，任期编号还需要再加1吗","like_count":0},{"had_liked":false,"id":293699,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1621498702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621498702","product_id":100046101,"comment_content":"有两个问题：<br>1. 选举时，要得到半数多的节点同意，是不是表示同意节点至少要 &quot;总节点&#47;2+1&quot;个节点同意？<br>2. 如果选举的领导者，日志落后于原来的leader或者其它跟随节点，是不是有影响？有的话，如何解决？","like_count":0},{"had_liked":false,"id":290717,"user_name":"二十四桥","can_delete":false,"product_type":"c1","uid":2216842,"ip_address":"","ucode":"B10EF01554D1FF","user_header":"https://static001.geekbang.org/account/avatar/00/21/d3/8a/ace47eb0.jpg","comment_is_top":false,"comment_ctime":1619699315,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619699315","product_id":100046101,"comment_content":"请问，如果我收到领导者(当前任期编号为5）心跳超时了，那么我设置自己为候选者并且任期编号加一(6)，发送给其他节点投票给我，但是这时部分节点没有收到，这造成一部分节点任期更新为6，一部分还是5会有什么影响吗？如果领导者也是5？","like_count":0},{"had_liked":false,"id":285131,"user_name":"FD","can_delete":false,"product_type":"c1","uid":2052521,"ip_address":"","ucode":"ED396BD322489E","user_header":"https://static001.geekbang.org/account/avatar/00/1f/51/a9/741b5ad9.jpg","comment_is_top":false,"comment_ctime":1616636583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616636583","product_id":100046101,"comment_content":"文中没描述如果又有一个节点和领导者失联了，其他节点还是好好的，那失连接点把自己的任期+1在广播给其他节点，其他节点还会投票吗？","like_count":0},{"had_liked":false,"id":284937,"user_name":"充值一万","can_delete":false,"product_type":"c1","uid":1519086,"ip_address":"","ucode":"1B4B3AEFA9C8C2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epRK5v3IkvSfjicKNKlRLE2nTQUowhMvQkwWWWUSESat8EBbcPvMk4aAjZHGcsE5DCibES9WicHcC9Qw/132","comment_is_top":false,"comment_ctime":1616551397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616551397","product_id":100046101,"comment_content":"集群中某个节点，因为某些原因收到leader的心跳超时了，但是除它之外其他节点都正常；比如，短暂网络异常。假设当前任期是m，这时候该节点切换成候选者给其他节点发选举请求（m+1）；这个时候网络正常了，其他节点收到了m+1任期的选举请求，自己收到了leader的m（&lt; m+1）任期的心跳。这种情况会怎么办？","like_count":0},{"had_liked":false,"id":281374,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1614732455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614732455","product_id":100046101,"comment_content":"一道面试题问了我：任期编号是如何初始化和递增的，老师能解答一下吗","like_count":0},{"had_liked":false,"id":278816,"user_name":"Geek1560","can_delete":false,"product_type":"c1","uid":2028949,"ip_address":"","ucode":"5F27A28B8002E6","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/95/a362f01b.jpg","comment_is_top":false,"comment_ctime":1613363757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613363757","product_id":100046101,"comment_content":"韩老师，假设5个节点的集群，ABC拥有最新日志，而DE日志比较落后，如果此时出现BC同时故障宕机无法恢复，这时候如果把BC节点从集群摘除，DE是否会成为新的Leader？","like_count":0},{"had_liked":false,"id":271270,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1609504759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609504759","product_id":100046101,"comment_content":"面试被问到了两个深入的问题：1.Raft的任期编号是怎样进行初始化的？2.集群中的大多数是如何确定的，比如A、B、C三节点集群，怎么就知道2个响应就是大多数？","like_count":0},{"had_liked":false,"id":264413,"user_name":"妥协","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1606460298,"is_pvip":false,"replies":[{"id":"96005","content":"加一颗星:)，持续递增。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1606639079,"ip_address":"","comment_id":264413,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606460298","product_id":100046101,"comment_content":"任期号增加后，日志索引号重新计数吗？还日志索引号一直累加？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510558,"discussion_content":"加一颗星:)，持续递增。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606639079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260481,"user_name":"朱东旭","can_delete":false,"product_type":"c1","uid":1242338,"ip_address":"","ucode":"C48DD620A63868","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/e2/dbc4a5f2.jpg","comment_is_top":false,"comment_ctime":1605020172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605020172","product_id":100046101,"comment_content":"一个比较极限的例子,假如集群中日志完整性最低的节点a与leader节点失联,但是其他节点与leader通信正常,节点a任期自增变成候选者之后发起的投票请求将被其他节点拒绝(因为日志完整性最低),此时将会陷入尴尬的局面:<br>1&gt;a的任期编号比其他所有节点都高,但是其他节点都不接受他.<br>2&gt;a又与领导者恢复通信了,此时关系难以定位.<br>此时a节点该如何重新加入集群呢?","like_count":0},{"had_liked":false,"id":248824,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1600325641,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600325641","product_id":100046101,"comment_content":"raft有租约的概念吧？因为租约的时间限制会导致raft比paxos在异常情况下可用性更低吧。 任期时间和心跳时间选举时间的关系也可以讲讲","like_count":0},{"had_liked":false,"id":234689,"user_name":"Gopher","can_delete":false,"product_type":"c1","uid":1206229,"ip_address":"","ucode":"3C1F9012BB486D","user_header":"https://static001.geekbang.org/account/avatar/00/12/67/d5/1b26b725.jpg","comment_is_top":false,"comment_ctime":1594774546,"is_pvip":false,"replies":[{"id":"87640","content":"加一颗星:)，因为集群没有领导者，写请求将被拒绝，需要客户端重试。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595752044,"ip_address":"","comment_id":234689,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594774546","product_id":100046101,"comment_content":"如果当前leader挂了，集群正在选举新leader，当有请求来时如何处理呢？<br>是客户端重试么？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501471,"discussion_content":"加一颗星:)，因为集群没有领导者，写请求将被拒绝，需要客户端重试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595752044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234688,"user_name":"Gopher","can_delete":false,"product_type":"c1","uid":1206229,"ip_address":"","ucode":"3C1F9012BB486D","user_header":"https://static001.geekbang.org/account/avatar/00/12/67/d5/1b26b725.jpg","comment_is_top":false,"comment_ctime":1594774277,"is_pvip":false,"replies":[{"id":"87639","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595751960,"ip_address":"","comment_id":234688,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594774277","product_id":100046101,"comment_content":"强领导模型的问题主要在写操作的时候会有单机性能问题","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501470,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595751960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230302,"user_name":"shen","can_delete":false,"product_type":"c1","uid":1215066,"ip_address":"","ucode":"AE5737B0C7DC4F","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/5a/b67a82e3.jpg","comment_is_top":false,"comment_ctime":1593342237,"is_pvip":false,"replies":[{"id":"87387","content":"加一颗星：），term越大和log index越小，不是必然的关系。但可能会因为多次选举和节点故障，出现term较大，log index较小的情况。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595439693,"ip_address":"","comment_id":230302,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593342237","product_id":100046101,"comment_content":"老师我想问下：什么时候会出现term越大而log index越小的情况？<br>","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499831,"discussion_content":"加一颗星：），term越大和log index越小，不是必然的关系。但可能会因为多次选举和节点故障，出现term较大，log index较小的情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595439693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227038,"user_name":"funnyx","can_delete":false,"product_type":"c1","uid":1115049,"ip_address":"","ucode":"A9B8E27919AE4D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoZqcVJzUjfu5noOW6OPAh6ibrBicibLmicibnVyVLHdf7GwAzf2th5s1oQ9pUbLpmq2mlVBauUZn8QUnw/132","comment_is_top":false,"comment_ctime":1592271183,"is_pvip":false,"replies":[{"id":"87377","content":"加一颗星:)，完整是相对的，可以通过本地日志项索引最大值来判断，比如，节点A的本地日志项索引最大值为4，节点B的本地日志项索引最大值为3，那么，节点A就比节点B完整，即节点A比节点B多了一条日志项。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595437498,"ip_address":"","comment_id":227038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592271183","product_id":100046101,"comment_content":"老师您好，这个日志是否完整是怎么决定的？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498469,"discussion_content":"加一颗星:)，完整是相对的，可以通过本地日志项索引最大值来判断，比如，节点A的本地日志项索引最大值为4，节点B的本地日志项索引最大值为3，那么，节点A就比节点B完整，即节点A比节点B多了一条日志项。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595437498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223287,"user_name":"慢动作","can_delete":false,"product_type":"c1","uid":1133945,"ip_address":"","ucode":"62C944F4A4D8AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","comment_is_top":false,"comment_ctime":1591056266,"is_pvip":true,"replies":[{"id":"82329","content":"加一颗星:)，如果日志的任期编号为4，那么节点的任期编号也会更新为4。需要咱们注意的是，在这个图中，4是日志记录的索引值，对应的日志项的任期编号为3。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1591088081,"ip_address":"","comment_id":223287,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1591056266","product_id":100046101,"comment_content":"选举6的图不对吧，为什么有日志任期编号是4，节点的任期编号还是3，不应该更新为4吗？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497088,"discussion_content":"加一颗星:)，如果日志的任期编号为4，那么节点的任期编号也会更新为4。需要咱们注意的是，在这个图中，4是日志记录的索引值，对应的日志项的任期编号为3。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591088081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"慢动作","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277678,"discussion_content":"看错了，抱歉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591091065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219910,"user_name":"What for","can_delete":false,"product_type":"c1","uid":1254381,"ip_address":"","ucode":"1308573CE047B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/ed/a4a774a8.jpg","comment_is_top":false,"comment_ctime":1590117260,"is_pvip":false,"replies":[{"id":"87248","content":"加一颗星:)，问题1：这是日常学习时，大家很容易感到困惑的点，根源在于，兰伯特虽然提出了Paxos，也提到一些细节功能点，但它还是缺乏编程实现的必须细节，这就导致了，后续大家提出了新的改进后的共识算法，基于Paxos改进的，比如Raft等，这些算法被称为multi-paxos算法，但是有时，大家又会把这些算法和兰伯特提出的最原始的算法，做对比。<br>问题2：日志完整度，是指日志项的多少，比如，节点A有10条日志项，节点B有8条日志项（少了2条日志项），那么节点A的日志完整度高。日志连续，是指不存在空日志项，要按照顺序提交日志项，比如，在提交索引值为4的日志项之前，索引值为3的日志项，是必须要提交的。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595342657,"ip_address":"","comment_id":219910,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590117260","product_id":100046101,"comment_content":"有一些疑惑：<br>1、上一节课提到multi-paxos是一种思想，raft是它的一种实现，这节课又提到了multi-paxos和raft的不同之处，感觉有点矛盾<br>2、日志完整度和日志连续是指什么","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495989,"discussion_content":"加一颗星:)，问题1：这是日常学习时，大家很容易感到困惑的点，根源在于，兰伯特虽然提出了Paxos，也提到一些细节功能点，但它还是缺乏编程实现的必须细节，这就导致了，后续大家提出了新的改进后的共识算法，基于Paxos改进的，比如Raft等，这些算法被称为multi-paxos算法，但是有时，大家又会把这些算法和兰伯特提出的最原始的算法，做对比。\n问题2：日志完整度，是指日志项的多少，比如，节点A有10条日志项，节点B有8条日志项（少了2条日志项），那么节点A的日志完整度高。日志连续，是指不存在空日志项，要按照顺序提交日志项，比如，在提交索引值为4的日志项之前，索引值为3的日志项，是必须要提交的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219625,"user_name":"宁悦","can_delete":false,"product_type":"c1","uid":1901403,"ip_address":"","ucode":"68844C314FEEF8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/03/5b/3cdbc9fa.jpg","comment_is_top":false,"comment_ctime":1590052781,"is_pvip":false,"replies":[{"id":"87238","content":"加一颗星:)，是的。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1595341224,"ip_address":"","comment_id":219625,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1590052781","product_id":100046101,"comment_content":"老师，如果因为网络原因，跟随者未收到领导者的心跳信号，导致了选举，跟随者成为新的领导者后，那么原来的领导者在收到新领导者的心跳信号的时候，就会自动变成跟随者，这样理解对吗？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495879,"discussion_content":"加一颗星:)，是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595341224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2700925,"avatar":"https://static001.geekbang.org/account/avatar/00/29/36/7d/eab0d26a.jpg","nickname":"丹尼尔-雪碧","note":"","ucode":"F098396F4B7500","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554614,"discussion_content":"新的leader的任期号比旧的leader的任期号，根据candidate、leader如果收到比自己任期号的heart beat消息，就是自动变成follower","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646490221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216681,"user_name":"BMX","can_delete":false,"product_type":"c1","uid":1160849,"ip_address":"","ucode":"DB01EAE73B7D24","user_header":"https://static001.geekbang.org/account/avatar/00/11/b6/91/e7df4173.jpg","comment_is_top":false,"comment_ctime":1589328437,"is_pvip":false,"replies":[{"id":"80780","content":"加一颗星:)，上文中的“投票”是指投票请求吧，为了演示方便，假设B、C的日志比A的要完整，那么，当A接收到节点B的投票请求时，投出任期编号2对应选票给节点B。当A收到节点C的投票请求时，投出任期编号3对应选票给节点C。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1589830703,"ip_address":"","comment_id":216681,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1589328437","product_id":100046101,"comment_content":"如果节点A(任期编号:1)收到节点B的投票(任期编号:2)，又收到节点C的投票(任期编号:3)，按选举规则第5点“先来先服务”的原则该怎么处理？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494909,"discussion_content":"加一颗星:)，上文中的“投票”是指投票请求吧，为了演示方便，假设B、C的日志比A的要完整，那么，当A接收到节点B的投票请求时，投出任期编号2对应选票给节点B。当A收到节点C的投票请求时，投出任期编号3对应选票给节点C。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589830703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030135,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b7/f7/b2423197.jpg","nickname":"牛牛","note":"","ucode":"3FC01F8D66B2FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381029,"discussion_content":"这时候好像B和C都判定为自己是主了，这时候如果来了写请求不知道集群怎么弄。如果没有写请求的话，B在收到C的心跳的时候会把自己降为跟随吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624871969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1082132,"avatar":"https://static001.geekbang.org/account/avatar/00/10/83/14/099742ae.jpg","nickname":"xzy","note":"","ucode":"483350A630625E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270702,"discussion_content":"这种情况会出现双主的可能性吗？假设集群中有很多个节点，多个节点投出了不同任期的票","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590039358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213437,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1588414261,"is_pvip":true,"replies":[{"id":"80029","content":"加一颗星:)，“a，b的超时设置都比c小”，这个前提不成立的，因为咱们引入随机超时，就是为了减少选举冲突，能更快的选举出领导者，在实现（比如Hashicorp Raft）中，3个节点的超时时间，都是在一个时间段随机取值。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1589233396,"ip_address":"","comment_id":213437,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1588414261","product_id":100046101,"comment_content":"若果a-b网络不通，但a-c，b-c网络是通的，但是a，b的超时设置都比c小， 系统是不是会反复在a，b为leader之间切换，导致一直不可用啊","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493778,"discussion_content":"加一颗星:)，“a，b的超时设置都比c小”，这个前提不成立的，因为咱们引入随机超时，就是为了减少选举冲突，能更快的选举出领导者，在实现（比如Hashicorp Raft）中，3个节点的超时时间，都是在一个时间段随机取值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589233396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389051,"discussion_content":"如果数据没有变化，感觉a和b会轮流做leader","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629104043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210704,"user_name":"黄骏","can_delete":false,"product_type":"c1","uid":1849733,"ip_address":"","ucode":"3C41D02F4F712C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/39/85/c6110f83.jpg","comment_is_top":false,"comment_ctime":1587812106,"is_pvip":true,"replies":[{"id":"79081","content":"加一颗星:)，Paxos的思想很经典，Raft是Multi-Paxos算法。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1588279615,"ip_address":"","comment_id":210704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587812106","product_id":100046101,"comment_content":"和ceph的paxos实现大同小异，所有写类型的请求必须让leader处理，读类型的请求可以让跟随者处理","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493090,"discussion_content":"加一颗星:)，Paxos的思想很经典，Raft是Multi-Paxos算法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588279615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208337,"user_name":"longyi","can_delete":false,"product_type":"c1","uid":1318113,"ip_address":"","ucode":"204CC8D3E98AAC","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/e1/c99d1473.jpg","comment_is_top":false,"comment_ctime":1587342281,"is_pvip":false,"replies":[{"id":"77864","content":"加一颗星:)，是的。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587357110,"ip_address":"","comment_id":208337,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587342281","product_id":100046101,"comment_content":"在选举的时候，要看term和日志index，如果term很大index很小，那也不会投票给它吧？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492424,"discussion_content":"加一颗星:)，是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587357110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201046,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1585709090,"is_pvip":false,"replies":[{"id":"75430","content":"加一颗星:)，领导者是Raft的核心，“一切以领导者为准”，简化了共识和一致性的实现。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1585838973,"ip_address":"","comment_id":201046,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585709090","product_id":100046101,"comment_content":"一致性问题的复杂性，不管是使用什么算法都不能降低。Raft 将主要矛盾转移到了leader 上面","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490224,"discussion_content":"加一颗星:)，领导者是Raft的核心，“一切以领导者为准”，简化了共识和一致性的实现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585838973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201044,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1585708844,"is_pvip":false,"replies":[{"id":"75431","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1585838987,"ip_address":"","comment_id":201044,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585708844","product_id":100046101,"comment_content":"没有leader 的情况下，不可用。","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490223,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585838987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200832,"user_name":"语法糖不甜","can_delete":false,"product_type":"c1","uid":1476387,"ip_address":"","ucode":"8346BCFF20CA45","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/23/f6835d17.jpg","comment_is_top":false,"comment_ctime":1585658551,"is_pvip":false,"replies":[{"id":"75990","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586191623,"ip_address":"","comment_id":200832,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585658551","product_id":100046101,"comment_content":"比如节点 B、C 的任期编号都是 3，节点 B 的最后一条日志项对应的任期编号为 3，而节点 C 为 2，那么当节点 C 请求节点 B 投票给自己时，节点 B 将拒绝投票。","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490146,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586191623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197481,"user_name":"月迷津渡","can_delete":false,"product_type":"c1","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1585381184,"is_pvip":false,"replies":[{"id":"77236","content":"加一颗星:)，感谢反馈，已修正，等待投票响应的时间间隔，也就是等待选举超时的时间间隔。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586939287,"ip_address":"","comment_id":197481,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585381184","product_id":100046101,"comment_content":"选举超时 解释的第二点有前后半句有歧义，前半句是将 等待投票响应的时间？后半句是说选举失败后该节点等待的时间？应该是取哪个意思","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489530,"discussion_content":"加一颗星:)，感谢反馈，已修正，等待投票响应的时间间隔，也就是等待选举超时的时间间隔。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586939287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192549,"user_name":"月迷津渡","can_delete":false,"product_type":"c1","uid":1264111,"ip_address":"","ucode":"2B18B2FE3DAC3B","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/ef/02401473.jpg","comment_is_top":false,"comment_ctime":1584859280,"is_pvip":false,"replies":[{"id":"77185","content":"加一个星:)，有个超时时间，也就是等待选举超时的时间间隔，如果在这个时间间隔内，没有得到大多数选票，则选举失败，发起新的选举。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586891071,"ip_address":"","comment_id":192549,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1584859280","product_id":100046101,"comment_content":"问题：如果出现多个候选者发起投票都不过半数，那么此时会重新选举。我的问题是某个候选节点怎么知道这次投票结束了呢，就是说在没有满足票过半数情况的下，节点怎么知道是没有新的投票进来了呢，是会每次接受投票有个超时时间还是？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488420,"discussion_content":"加一个星:)，有个超时时间，也就是等待选举超时的时间间隔，如果在这个时间间隔内，没有得到大多数选票，则选举失败，发起新的选举。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586891071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107398,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/c6/11e0f717.jpg","nickname":"苍漠胡杨","note":"","ucode":"E19B685A05F893","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216948,"discussion_content":"本term投过票的follower会直接响应拒绝投票信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585493050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187336,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1584087038,"is_pvip":false,"replies":[{"id":"77635","content":"加一颗星:)，有可能，此时候选人是能赢得跟随者的选票的。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587239524,"ip_address":"","comment_id":187336,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584087038","product_id":100046101,"comment_content":"有没有可能任期编号和日志完整性都相同的情况","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487080,"discussion_content":"加一颗星:)，有可能，此时候选人是能赢得跟随者的选票的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587239524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182598,"user_name":"Dovelol","can_delete":false,"product_type":"c1","uid":1253384,"ip_address":"","ucode":"9B5DDF7720F307","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg","comment_is_top":false,"comment_ctime":1582814060,"is_pvip":false,"replies":[{"id":"77627","content":"加一颗星:)，不需要，请求投票RPC消息，包含候选人的最新日志项的索引值lastLogIndex，和候选人最新日志项的任期编号lastLogTerm，比较这两个，就可以了。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587235039,"ip_address":"","comment_id":182598,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1582814060","product_id":100046101,"comment_content":"老师好，想问一个问题，规则中为啥还要求日志完整性呢，那是不是选举通信还要带上自己完整的日志数据？如果特别多，会不会影响通信的效率。","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485382,"discussion_content":"加一颗星:)，不需要，请求投票RPC消息，包含候选人的最新日志项的索引值lastLogIndex，和候选人最新日志项的任期编号lastLogTerm，比较这两个，就可以了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587235039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5e/67/133d2da6.jpg","nickname":"Geek_5244fa","note":"","ucode":"B87A550526F74C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189503,"discussion_content":"只要带上日志最后的下标和任期数就可以判断了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582889134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182339,"user_name":"施耀南","can_delete":false,"product_type":"c1","uid":1634138,"ip_address":"","ucode":"480ECE7BA29606","user_header":"https://static001.geekbang.org/account/avatar/00/18/ef/5a/5d424d50.jpg","comment_is_top":false,"comment_ctime":1582770167,"is_pvip":false,"replies":[{"id":"70920","content":"加一颗星:)，单机性能瓶颈。一般而言，集群中的机型是相同的，节点的处理性能都是相同的。日志全和性能好，不是一回事，性能主要指的是写入性能，因为写操作必须在领导者节点上处理。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1583005204,"ip_address":"","comment_id":182339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582770167","product_id":100046101,"comment_content":"局限在于领导的单机性能问题，而且可能选了处理速度不佳的领导！当然我有些对日志全是否等于性能好不大了解","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485310,"discussion_content":"加一颗星:)，单机性能瓶颈。一般而言，集群中的机型是相同的，节点的处理性能都是相同的。日志全和性能好，不是一回事，性能主要指的是写入性能，因为写操作必须在领导者节点上处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583005204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182285,"user_name":"Purson","can_delete":false,"product_type":"c1","uid":1446120,"ip_address":"","ucode":"5F0C1BB3C0C0A2","user_header":"https://static001.geekbang.org/account/avatar/00/16/10/e8/ec11e306.jpg","comment_is_top":false,"comment_ctime":1582763003,"is_pvip":false,"replies":[{"id":"76515","content":"加一颗星:)，基于Raft能实现强一致性（也就是线性一致性），是CP。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586474366,"ip_address":"","comment_id":182285,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1582763003","product_id":100046101,"comment_content":"Raft是CP还是AP，怎么快速区别？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485285,"discussion_content":"加一颗星:)，基于Raft能实现强一致性（也就是线性一致性），是CP。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586474366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107398,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/c6/11e0f717.jpg","nickname":"苍漠胡杨","note":"","ucode":"E19B685A05F893","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216961,"discussion_content":"是cp。a（可用性）没有保证，是因为当过半数的节点宕机，集群就不能提供正常的服务了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585493550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","nickname":"88591","note":"","ucode":"04CE3E46455185","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218868,"discussion_content":"CP ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585708970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182284,"user_name":"石头","can_delete":false,"product_type":"c1","uid":1065776,"ip_address":"","ucode":"87921CA52689DC","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/30/4c12618b.jpg","comment_is_top":false,"comment_ctime":1582762906,"is_pvip":false,"replies":[{"id":"76516","content":"加一颗星:)，不会被影响，","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586474536,"ip_address":"","comment_id":182284,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582762906","product_id":100046101,"comment_content":"在一次选举中，每一个服务器节点最多会对一个任期编号投出一张选票，并且按照“先来先服务”的原则进行投票。比如节点 C 的任期编号为 3，先收到了 1 个包含任期编号为 4 的投票请求（来自节点 A），然后又收到了 1 个包含任期编号为 4 的投票请求（来自节点 B）。那么节点 C 将会把唯一一张选票投给节点 A，当再收到节点 B 的投票请求 RPC 消息时，对于编号为 4 的任期，已没有选票可投了。<br><br>老师你好！如果A先来，但他之前不是前任领导者，B后来的他是前任领导者。极端情况下领导者可能反复切换，是否会受影响？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485284,"discussion_content":"加一颗星:)，不会被影响，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586474536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182154,"user_name":"小晏子","can_delete":false,"product_type":"c1","uid":1132337,"ip_address":"","ucode":"3AAA6FB5ACB6AE","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg","comment_is_top":false,"comment_ctime":1582721926,"is_pvip":false,"replies":[{"id":"70607","content":"加一颗星:)","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582778157,"ip_address":"","comment_id":182154,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1582721926","product_id":100046101,"comment_content":"“一切以我为准”的领导者模型显而易见的问题就是需要领导者的实现非常复杂，需要发送心跳信息，日志信息等，一人承担了所有职责，另一个问题就是读写如果都以领导者为准，那么领导者就是性能瓶颈，影响系统并发度。","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485238,"discussion_content":"加一颗星:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582778157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182144,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1582719957,"is_pvip":false,"replies":[{"id":"77629","content":"加一颗星:)，不会，B发起选举，任期编号为2，当C接收到来自C的投票请求rpc消息时，任期编号会更新为2，所以当C发起选举时，任期编号为3，同理，当D发起选举时，任期编号是4，能赢得来自B、C、D的3张选票，当选领导者。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1587236641,"ip_address":"","comment_id":182144,"utype":1}],"discussion_count":6,"race_medal":0,"score":"1582719957","product_id":100046101,"comment_content":"有个问题涉及到文章没提到的知识，可能跟后面课程有关， 但也想问一下：<br>选举时，当term编号相同时，·会对比最后一条日志的任期。如果也相同，(paper提到)会对比最后一个日志的index，高的一方不会给低的投票。这里没提日志是否一定是commit的，我理解未commit的日志也算。那是否会存在这种情况：<br>假设A,B,C,D,E 5个节点，A是leader当宕机了，现在的任期都是1，其他4个节点的最后一条日志的index分别是：<br>B: 1 C: 2 D: 3 E: 4 <br>恰巧，4个节点超时时间也是从B到E的逐渐增加。那B先发起选举，自己得一票，但由于日志index小所以被其他3个节点拒绝投票。之后是C拉票，虽然比B更update-to-date，但由于B已经自投，所以也是1票。以此类推。最终一轮结束，无主，继续下一轮选主，如此循环下去？处于一种活锁的状态。<br>请问会有这种情况么？","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485237,"discussion_content":"加一颗星:)，不会，B发起选举，任期编号为2，当C接收到来自C的投票请求rpc消息时，任期编号会更新为2，所以当C发起选举时，任期编号为3，同理，当D发起选举时，任期编号是4，能赢得来自B、C、D的3张选票，当选领导者。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587236641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2700925,"avatar":"https://static001.geekbang.org/account/avatar/00/29/36/7d/eab0d26a.jpg","nickname":"丹尼尔-雪碧","note":"","ucode":"F098396F4B7500","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"discussion":{"id":554613,"discussion_content":"作者的回答应该有问题，B发起选举，任期编号为1+1=2，然后B会发起Request Vote RPC请求，C、D收到B的Request Vote RPC请求，会更新自己的任期为2，但是由于C、D的最后一条日志比B新，所以C、D会拒绝B的Request Vote请求。然后C会发起请求，此时C的任期编号为2+1=3，C发起Request Vote PRC请求，B收到C的Request Vote请求，发现C的任期号和最后一条日志都比自己新，所以B会为C投自己的一票。D收到Request Vote RPC请求，会更新自己的任期号为3+1=4，但是由于D的最后一条日志比C的新，所以D会拒绝C的Request Vote RPC请求。\n\n另外，记住，只要集群中大多数节点都承认了某条日志，那么这条日志就不能达成一致，不能被更改了，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646488803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":485237,"ip_address":""},"score":554613,"extra":""}]},{"author":{"id":1003233,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4e/e1/436a7576.jpg","nickname":"皮皮厮","note":"","ucode":"18EFAA3BFCDC26","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201742,"discussion_content":"流弊 哪里都能看见老哥的发言","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583833224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"约书亚","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1003233,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4e/e1/436a7576.jpg","nickname":"皮皮厮","note":"","ucode":"18EFAA3BFCDC26","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201745,"discussion_content":"厮大流弊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583833533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":201742,"ip_address":""},"score":201745,"extra":""}]},{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"约书亚","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189445,"discussion_content":"我揣测你的疑问是: 如果C在发现leader宕机之前，就收到了B的任期+1投票请求，如果它拒绝了投票并且等到自身设置的leader超时，此时C如果发起投票任期应该是+1还是+2。我觉得是+1。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582883712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189166,"discussion_content":"“如果一个服务器节点，发现自己的任期编号比其他节点小，那么它会更新自己的编号到较大的编号值。”\n如果A任期是1，B发起选举的任期是2，C发起的任期值是不是就到3了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582855642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181922,"user_name":"盘胧","can_delete":false,"product_type":"c1","uid":1650748,"ip_address":"","ucode":"5386CC4C92ECC2","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","comment_is_top":false,"comment_ctime":1582680826,"is_pvip":false,"replies":[{"id":"76376","content":"加一颗星:)，成员变更不影响领导者的状态；raft是开发强一致性分布式系统的首选，比如，Consul、InfluxDB、TiDB、etcd等等。另外，猝死，如何理解呢？","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1586378408,"ip_address":"","comment_id":181922,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582680826","product_id":100046101,"comment_content":"类似单点问题肯定是存在的，重新选就好了。raf t选举出来以后的领导者，性能上就会有单机的问题。<br>就raft算法选举过程来讲，稳定性好像还不错，就是要和1每个节点都来回通信，如果节点多了，可能整个压力就比较大了，会不会出现猝死的情况呢？<br>2如果有新的节点加入进来或者有节点频繁进出，是不是就会一直触发选主呢。<br>老师能不能说下现在流行的一些框架，在管理上都哪些用了raft。<br>谢谢老师。","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485169,"discussion_content":"加一颗星:)，成员变更不影响领导者的状态；raft是开发强一致性分布式系统的首选，比如，Consul、InfluxDB、TiDB、etcd等等。另外，猝死，如何理解呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586378408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181868,"user_name":"chapin","can_delete":false,"product_type":"c1","uid":1070020,"ip_address":"","ucode":"BB1800A771A8E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/c4/dea5d7f3.jpg","comment_is_top":false,"comment_ctime":1582648174,"is_pvip":false,"replies":[{"id":"70766","content":"加一颗星:)，领导者故障后，在选取新领导者之前，这段时间，集群无法写入。","user_name":"作者回复","user_name_real":"hanj4096","uid":"1642497","ctime":1582925028,"ip_address":"","comment_id":181868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582648174","product_id":100046101,"comment_content":"Leader节点单点问题","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485145,"discussion_content":"加一颗星:)，领导者故障后，在选取新领导者之前，这段时间，集群无法写入。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582925028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}