{"id":789323,"title":"31｜泛型声明 （二）：函数与类","content":"","comments":[{"had_liked":false,"id":396379,"user_name":"fatme","can_delete":false,"product_type":"c3","uid":1034451,"ip_address":"广东","ucode":"75A805D2BB2AD1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c8/d3/3020ae46.jpg","comment_is_top":false,"comment_ctime":1734172252,"is_pvip":false,"replies":[{"id":143938,"content":"非常准确。你的几个注释点都说到了关键处。赞+5","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1734747998,"ip_address":"江苏","comment_id":396379,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"&#47;&#47; SuperFoo 是一个泛型函数类型，它实例化后的类型是一个带泛型参数的函数类型。这个实例化后的泛型参数函数类型能够被泛型函数赋值。\ntype SuperFoo&lt;T&gt; = &lt;X&gt;(x: T) =&gt; X;\n&#47;&#47; SuperFoo 可以被实例化。实例化后的类型是一个带泛型参数的函数类型。\ntype SuperFoo_string = SuperFoo&lt;string&gt;;\nlet f: &lt;X&gt;(x: string) =&gt; X = &lt;X&gt;(x: string) =&gt; {return x as any as X;};\ntype T = typeof f;\ntype T2 = T extends SuperFoo_string ? SuperFoo_string extends T ? true : false : false; &#47;&#47; T2 = true\ntype T3 = &lt;X&gt;(x: string) =&gt; X;\ntype T4 = T3 extends SuperFoo_string ? SuperFoo_string extends T ? true : false : false; &#47;&#47; T4 = true\n&#47;&#47; SuperFoo_string 限制对应的 javascript function 必须声明为带泛型参数的函数\nfunction Foo&lt;X&gt;(a: string): X {return a as any as X;}\nlet v4: SuperFoo_string = Foo;\nlet v5: SuperFoo_string = f;\n&#47;&#47; f 的调用方式。关键是要么显式声明泛型参数的类型，要么能令编译器推断出函数返回结果的类型。\nlet v = f&lt;string&gt;(&quot;a&quot;);\nlet v6: string = f(&quot;a&quot;);\n&#47;&#47; 注意下面 v2&#47;v3 的两个错误，SuperFoo_string 限制对应的 javascript function 必须声明为带泛型参数的函数\nfunction foo(x: string): number {return 1;}\nlet v2: SuperFoo_string = foo;\nlet v3: SuperFoo_string = (a: string) =&gt; parseFloat(a);","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655377,"discussion_content":"非常准确。你的几个注释点都说到了关键处。赞+5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734747998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393495,"user_name":"Jack Q","can_delete":false,"product_type":"c3","uid":1160078,"ip_address":"广东","ucode":"A7DBC311884FFA","user_header":"https://static001.geekbang.org/account/avatar/00/11/b3/8e/1c564eb2.jpg","comment_is_top":false,"comment_ctime":1724046815,"is_pvip":false,"replies":[{"id":142892,"content":"高分答案。条理清晰，对每个知识点都把握得很到位。赞的👍+5","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1724061902,"ip_address":"江苏","comment_id":393495,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"1、解释如下声明：\ntype SuperFoo&lt;T&gt; = &lt;X&gt;(t: T) =&gt; X\n\nSuperFoo 是一个接受类型参数T的范型函数类型。它表示一个接受类型为T的参数并返回一个类型为X的函数。其中X是在函数内部定义的泛型类型。\n\nconst Foo: SuperFoo&lt;number&gt; = &lt;T extends any&gt;(x:number): T =&gt; { &#47;&#47;  T extends any 是为了兼容 支持 jsx 的场景\n  return x as T;\n}\n\nconst v = Foo&lt;1&gt;(1);&#47;&#47; typeof v = 1\n2、阅读理解课件中的 t3.ts\nfunction IsTransporter&lt;Target extends Transportations&gt;(t: any, target: Target): t is Transporters[Target] {\n    return &#39;type&#39; in t &amp;&amp; t.type === target;\n}\n\nfunction IsTransporter2&lt;Target extends Transportations&gt;(t: T, target: Target): t is Transporters[Target] {\n    return [T1, T2, T3].some(T =&gt; t instanceof T &amp;&amp; t.type === target);\n}\n\nfunction IsTransporter3&lt;Target extends new(...args: any[]) =&gt; any&gt;(t: T, target: Target): t is InstanceType&lt;Target&gt; {\n    return t instanceof target;\n}\nlet xx!: T;\n&#47;&#47; 方式1\nswitch (true) {\n    case IsTransporter(xx, Transportations.motorcycle):\n        xx\n        break;\n    case IsTransporter(xx, Transportations.car):\n        xx\n        break;\n    case IsTransporter(xx, Transportations.truck):\n        xx\n        break;\n}\n&#47;&#47; 方式2\nswitch (true) {\n    case IsTransporter3(xx, T1):\n        xx\n        break;\n    case IsTransporter3(xx, T2):\n        xx\n        break;\n    case IsTransporter3(xx, T3):\n        xx\n        break;\n}\n1、分析IsTransporter、IsTransporter2、IsTransporte3的实现\nIsTransporter 通过 type in t 进行类型收束，确认type属性存在于 t， 然后通过 type 进行判断\nIsTransporter2 通过 instance 确认t是否基于 T 来确认 t 上是否存在 type 属性， 然后通过 type 进行判断。相较于 IsTransporter， instance 得到的结果更加安全\nIsTransporte3 则是直接判断 t 和 target 是否 是基于相同的构造 函数\n2、理解 IsTransporte3的设计与使用\n其中 IsTransporter 和 IsTransporter2 都可以使用 方式1 进行断言\n其中 IsTransporte3 需要 使用 方式2 进行断言\n通过对比断言函数的调用方式以及参数类型，IsTransporte3 是基于构造函数进行判断的，IsTransporter和IsTransporter2则是基于标识型属性判断的","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649858,"discussion_content":"高分答案。条理清晰，对每个知识点都把握得很到位。赞的👍+5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724061902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393255,"user_name":"Geek_aeb936","can_delete":false,"product_type":"c3","uid":3887128,"ip_address":"日本","ucode":"863338D4895F25","user_header":"","comment_is_top":false,"comment_ctime":1723288086,"is_pvip":false,"replies":[{"id":142829,"content":"谢谢提醒，已追加。:)","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1723386726,"ip_address":"江苏","comment_id":393255,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"https:&#47;&#47;github.com&#47;aimingoo&#47;jike2&#47;tree&#47;main&#47;src&#47;31\n\n我看好像没有t3.ts文件(课后作业）","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649445,"discussion_content":"谢谢提醒，已追加。:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723386726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393254,"user_name":"Geek_aeb936","can_delete":false,"product_type":"c3","uid":3887128,"ip_address":"日本","ucode":"863338D4895F25","user_header":"","comment_is_top":false,"comment_ctime":1723287989,"is_pvip":false,"replies":[{"id":142830,"content":"+1 👍","user_name":"作者回复","user_name_real":"编辑","uid":1521669,"ctime":1723387241,"ip_address":"江苏","comment_id":393254,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100761001,"comment_content":"type SuperFoo&lt;T&gt; = &lt;X&gt;(x: T) =&gt; X;\n\nconst mySuperFoo: SuperFoo&lt;number&gt; = &lt;X&gt;(x: number): X =&gt; {\n    return (x as unknown) as X;\n};\n\nconst result = mySuperFoo&lt;string&gt;(42);\n\ntype ResultType = typeof result; &#47;&#47; type ResultType = string","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649446,"discussion_content":"+1 👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723387241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]}]}