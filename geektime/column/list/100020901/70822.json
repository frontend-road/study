{"id":70822,"title":"06 | 案例篇：系统的 CPU 使用率很高，但为啥却找不到高 CPU 的应用？","content":"<p>你好，我是倪朋飞。</p><p>上一节我讲了 CPU 使用率是什么，并通过一个案例教你使用 top、vmstat、pidstat 等工具，排查高 CPU 使用率的进程，然后再使用 perf top 工具，定位应用内部函数的问题。不过就有人留言了，说似乎感觉高 CPU 使用率的问题，还是挺容易排查的。</p><p>那是不是所有 CPU 使用率高的问题，都可以这么分析呢？我想，你的答案应该是否定的。</p><p>回顾前面的内容，我们知道，系统的 CPU 使用率，不仅包括进程用户态和内核态的运行，还包括中断处理、等待 I/O 以及内核线程等。所以，<strong>当你发现系统的 CPU 使用率很高的时候，不一定能找到相对应的高 CPU 使用率的进程</strong>。</p><p>今天，我就用一个 Nginx + PHP 的 Web 服务的案例，带你来分析这种情况。</p><h2>案例分析</h2><h3>你的准备</h3><p>今天依旧探究系统CPU使用率高的情况，所以这次实验的准备工作，与上节课的准备工作基本相同，差别在于案例所用的 Docker 镜像不同。</p><p>本次案例还是基于 Ubuntu 18.04，同样适用于其他的 Linux 系统。我使用的案例环境如下所示：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存</p>\n</li>\n<li>\n<p>预先安装 docker、sysstat、perf、ab 等工具，如 apt install <a href=\"http://docker.io\">docker.io</a> sysstat linux-tools-common apache2-utils</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>前面我们讲到过，ab（apache bench）是一个常用的 HTTP 服务性能测试工具，这里同样用来模拟 Nginx 的客户端。由于 Nginx 和 PHP 的配置比较麻烦，我把它们打包成了两个 <a href=\"https://github.com/feiskyer/linux-perf-examples/tree/master/nginx-short-process\">Docker 镜像</a>，这样只需要运行两个容器，就可以得到模拟环境。</p><p>注意，这个案例要用到两台虚拟机，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/90/3d/90c30b4f555218f77241bfe2ac27723d.png?wh=408*258\" alt=\"\"></p><p>你可以看到，其中一台用作 Web 服务器，来模拟性能问题；另一台用作 Web 服务器的客户端，来给 Web 服务增加压力请求。使用两台虚拟机是为了相互隔离，避免“交叉感染”。</p><p>接下来，我们打开两个终端，分别 SSH 登录到两台机器上，并安装上述工具。</p><p>同样注意，下面所有命令都默认以 root 用户运行，如果你是用普通用户身份登陆系统，请运行 sudo su root 命令切换到 root 用户。</p><p>走到这一步，准备工作就完成了。接下来，我们正式进入操作环节。</p><blockquote>\n<p>温馨提示：案例中 PHP 应用的核心逻辑比较简单，你可能一眼就能看出问题，但实际生产环境中的源码就复杂多了。所以，我依旧建议，<strong>操作之前别看源码</strong>，避免先入为主，而要把它当成一个黑盒来分析。这样，你可以更好把握，怎么从系统的资源使用问题出发，分析出瓶颈所在的应用，以及瓶颈在应用中大概的位置。</p>\n</blockquote><h3>操作和分析</h3><p>首先，我们在第一个终端，执行下面的命令运行 Nginx 和 PHP 应用：</p><pre><code>$ docker run --name nginx -p 10000:80 -itd feisky/nginx:sp\n$ docker run --name phpfpm -itd --network container:nginx feisky/php-fpm:sp\n</code></pre><p>然后，在第二个终端，使用 curl 访问 http://[VM1的IP]:10000，确认 Nginx 已正常启动。你应该可以看到 It works! 的响应。</p><pre><code># 192.168.0.10是第一台虚拟机的IP地址\n$ curl http://192.168.0.10:10000/\nIt works!\n</code></pre><p>接着，我们来测试一下这个 Nginx 服务的性能。在第二个终端运行下面的 ab 命令。要注意，与上次操作不同的是，这次我们需要并发100个请求测试Nginx性能，总共测试1000个请求。</p><pre><code># 并发100个请求测试Nginx性能，总共测试1000个请求\n$ ab -c 100 -n 1000 http://192.168.0.10:10000/\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, \n...\nRequests per second:    87.86 [#/sec] (mean)\nTime per request:       1138.229 [ms] (mean)\n...\n</code></pre><p>从ab的输出结果我们可以看到，Nginx能承受的每秒平均请求数，只有 87 多一点，是不是感觉它的性能有点差呀。那么，到底是哪里出了问题呢？我们再用 top 和 pidstat 来观察一下。</p><p>这次，我们在第二个终端，将测试的并发请求数改成5，同时把请求时长设置为10分钟（-t 600）。这样，当你在第一个终端使用性能分析工具时， Nginx 的压力还是继续的。</p><p>继续在第二个终端运行 ab 命令：</p><pre><code>$ ab -c 5 -t 600 http://192.168.0.10:10000/\n</code></pre><p>然后，我们在第一个终端运行 top 命令，观察系统的 CPU 使用情况：</p><pre><code>$ top\n...\n%Cpu(s): 80.8 us, 15.1 sy,  0.0 ni,  2.8 id,  0.0 wa,  0.0 hi,  1.3 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 6882 root      20   0    8456   5052   3884 S   2.7  0.1   0:04.78 docker-containe\n 6947 systemd+  20   0   33104   3716   2340 S   2.7  0.0   0:04.92 nginx\n 7494 daemon    20   0  336696  15012   7332 S   2.0  0.2   0:03.55 php-fpm\n 7495 daemon    20   0  336696  15160   7480 S   2.0  0.2   0:03.55 php-fpm\n10547 daemon    20   0  336696  16200   8520 S   2.0  0.2   0:03.13 php-fpm\n10155 daemon    20   0  336696  16200   8520 S   1.7  0.2   0:03.12 php-fpm\n10552 daemon    20   0  336696  16200   8520 S   1.7  0.2   0:03.12 php-fpm\n15006 root      20   0 1168608  66264  37536 S   1.0  0.8   9:39.51 dockerd\n 4323 root      20   0       0      0      0 I   0.3  0.0   0:00.87 kworker/u4:1\n...\n</code></pre><p>观察 top 输出的进程列表可以发现，CPU 使用率最高的进程也只不过才 2.7%，看起来并不高。</p><p>然而，再看系统 CPU 使用率（ %Cpu ）这一行，你会发现，系统的整体 CPU 使用率是比较高的：用户 CPU 使用率（us）已经到了 80%，系统 CPU 为 15.1%，而空闲 CPU （id）则只有 2.8%。</p><p>为什么用户 CPU 使用率这么高呢？我们再重新分析一下进程列表，看看有没有可疑进程：</p><ul>\n<li>\n<p>docker-containerd 进程是用来运行容器的，2.7% 的 CPU 使用率看起来正常；</p>\n</li>\n<li>\n<p>Nginx 和 php-fpm 是运行 Web 服务的，它们会占用一些 CPU 也不意外，并且 2% 的 CPU 使用率也不算高；</p>\n</li>\n<li>\n<p>再往下看，后面的进程呢，只有 0.3% 的 CPU 使用率，看起来不太像会导致用户 CPU 使用率达到 80%。</p>\n</li>\n</ul><p>那就奇怪了，明明用户 CPU 使用率都80%了，可我们挨个分析了一遍进程列表，还是找不到高 CPU 使用率的进程。看来top是不管用了，那还有其他工具可以查看进程 CPU 使用情况吗？不知道你记不记得我们的老朋友  pidstat，它可以用来分析进程的 CPU 使用情况。</p><p>接下来，我们还是在第一个终端，运行 pidstat 命令：</p><pre><code># 间隔1秒输出一组数据（按Ctrl+C结束）\n$ pidstat 1\n...\n04:36:24      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n04:36:25        0      6882    1.00    3.00    0.00    0.00    4.00     0  docker-containe\n04:36:25      101      6947    1.00    2.00    0.00    1.00    3.00     1  nginx\n04:36:25        1     14834    1.00    1.00    0.00    1.00    2.00     0  php-fpm\n04:36:25        1     14835    1.00    1.00    0.00    1.00    2.00     0  php-fpm\n04:36:25        1     14845    0.00    2.00    0.00    2.00    2.00     1  php-fpm\n04:36:25        1     14855    0.00    1.00    0.00    1.00    1.00     1  php-fpm\n04:36:25        1     14857    1.00    2.00    0.00    1.00    3.00     0  php-fpm\n04:36:25        0     15006    0.00    1.00    0.00    0.00    1.00     0  dockerd\n04:36:25        0     15801    0.00    1.00    0.00    0.00    1.00     1  pidstat\n04:36:25        1     17084    1.00    0.00    0.00    2.00    1.00     0  stress\n04:36:25        0     31116    0.00    1.00    0.00    0.00    1.00     0  atopacctd\n...\n</code></pre><p>观察一会儿，你是不是发现，所有进程的 CPU 使用率也都不高啊，最高的 Docker 和 Nginx 也只有 4% 和 3%，即使所有进程的 CPU 使用率都加起来，也不过是 21%，离 80% 还差得远呢！</p><p>最早的时候，我碰到这种问题就完全懵了：明明用户 CPU 使用率已经高达 80%，但我却怎么都找不到是哪个进程的问题。到这里，你也可以想想，你是不是也遇到过这种情况？还能不能再做进一步的分析呢？</p><p>后来我发现，会出现这种情况，很可能是因为前面的分析漏了一些关键信息。你可以先暂停一下，自己往上翻，重新操作检查一遍。或者，我们一起返回去分析 top 的输出，看看能不能有新发现。</p><p>现在，我们回到第一个终端，重新运行 top 命令，并观察一会儿：</p><pre><code>$ top\ntop - 04:58:24 up 14 days, 15:47,  1 user,  load average: 3.39, 3.82, 2.74\nTasks: 149 total,   6 running,  93 sleeping,   0 stopped,   0 zombie\n%Cpu(s): 77.7 us, 19.3 sy,  0.0 ni,  2.0 id,  0.0 wa,  0.0 hi,  1.0 si,  0.0 st\nKiB Mem :  8169348 total,  2543916 free,   457976 used,  5167456 buff/cache\nKiB Swap:        0 total,        0 free,        0 used.  7363908 avail Mem\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 6947 systemd+  20   0   33104   3764   2340 S   4.0  0.0   0:32.69 nginx\n 6882 root      20   0   12108   8360   3884 S   2.0  0.1   0:31.40 docker-containe\n15465 daemon    20   0  336696  15256   7576 S   2.0  0.2   0:00.62 php-fpm\n15466 daemon    20   0  336696  15196   7516 S   2.0  0.2   0:00.62 php-fpm\n15489 daemon    20   0  336696  16200   8520 S   2.0  0.2   0:00.62 php-fpm\n 6948 systemd+  20   0   33104   3764   2340 S   1.0  0.0   0:00.95 nginx\n15006 root      20   0 1168608  65632  37536 S   1.0  0.8   9:51.09 dockerd\n15476 daemon    20   0  336696  16200   8520 S   1.0  0.2   0:00.61 php-fpm\n15477 daemon    20   0  336696  16200   8520 S   1.0  0.2   0:00.61 php-fpm\n24340 daemon    20   0    8184   1616    536 R   1.0  0.0   0:00.01 stress\n24342 daemon    20   0    8196   1580    492 R   1.0  0.0   0:00.01 stress\n24344 daemon    20   0    8188   1056    492 R   1.0  0.0   0:00.01 stress\n24347 daemon    20   0    8184   1356    540 R   1.0  0.0   0:00.01 stress\n...\n</code></pre><p>这次从头开始看 top 的每行输出，咦？Tasks 这一行看起来有点奇怪，就绪队列中居然有 6 个 Running 状态的进程（6 running），是不是有点多呢？</p><p>回想一下 ab 测试的参数，并发请求数是 5。再看进程列表里， php-fpm 的数量也是 5，再加上 Nginx，好像同时有 6 个进程也并不奇怪。但真的是这样吗？</p><p>再仔细看进程列表，这次主要看 Running（R） 状态的进程。你有没有发现， Nginx 和所有的 php-fpm 都处于Sleep（S）状态，而真正处于 Running（R）状态的，却是几个 stress 进程。这几个 stress 进程就比较奇怪了，需要我们做进一步的分析。</p><p>我们还是使用 pidstat 来分析这几个进程，并且使用 -p 选项指定进程的 PID。首先，从上面 top 的结果中，找到这几个进程的 PID。比如，先随便找一个 24344，然后用 pidstat 命令看一下它的 CPU 使用情况：</p><pre><code>$ pidstat -p 24344\n\n16:14:55      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n</code></pre><p>奇怪，居然没有任何输出。难道是pidstat 命令出问题了吗？之前我说过，<strong>在怀疑性能工具出问题前，最好还是先用其他工具交叉确认一下</strong>。那用什么工具呢？ ps 应该是最简单易用的。我们在终端里运行下面的命令，看看 24344 进程的状态：</p><pre><code># 从所有进程中查找PID是24344的进程\n$ ps aux | grep 24344\nroot      9628  0.0  0.0  14856  1096 pts/0    S+   16:15   0:00 grep --color=auto 24344\n</code></pre><p>还是没有输出。现在终于发现问题，原来这个进程已经不存在了，所以 pidstat 就没有任何输出。既然进程都没了，那性能问题应该也跟着没了吧。我们再用 top 命令确认一下：</p><pre><code>$ top\n...\n%Cpu(s): 80.9 us, 14.9 sy,  0.0 ni,  2.8 id,  0.0 wa,  0.0 hi,  1.3 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 6882 root      20   0   12108   8360   3884 S   2.7  0.1   0:45.63 docker-containe\n 6947 systemd+  20   0   33104   3764   2340 R   2.7  0.0   0:47.79 nginx\n 3865 daemon    20   0  336696  15056   7376 S   2.0  0.2   0:00.15 php-fpm\n  6779 daemon    20   0    8184   1112    556 R   0.3  0.0   0:00.01 stress\n...\n</code></pre><p>好像又错了。结果还跟原来一样，用户 CPU 使用率还是高达 80.9%，系统 CPU 接近 15%，而空闲 CPU 只有 2.8%，Running 状态的进程有 Nginx、stress等。</p><p>可是，刚刚我们看到stress 进程不存在了，怎么现在还在运行呢？再细看一下 top 的输出，原来，这次 stress 进程的 PID 跟前面不一样了，原来的 PID 24344 不见了，现在的是 6779。</p><p>进程的 PID 在变，这说明什么呢？在我看来，要么是这些进程在不停地重启，要么就是全新的进程，这无非也就两个原因：</p><ul>\n<li>\n<p>第一个原因，进程在不停地崩溃重启，比如因为段错误、配置错误等等，这时，进程在退出后可能又被监控系统自动重启了。</p>\n</li>\n<li>\n<p>第二个原因，这些进程都是短时进程，也就是在其他应用内部通过 exec 调用的外面命令。这些命令一般都只运行很短的时间就会结束，你很难用 top 这种间隔时间比较长的工具发现（上面的案例，我们碰巧发现了）。</p>\n</li>\n</ul><p>至于 stress，我们前面提到过，它是一个常用的压力测试工具。它的 PID 在不断变化中，看起来像是被其他进程调用的短时进程。要想继续分析下去，还得找到它们的父进程。</p><p>要怎么查找一个进程的父进程呢？没错，用 pstree  就可以用树状形式显示所有进程之间的关系：</p><pre><code>$ pstree | grep stress\n        |-docker-containe-+-php-fpm-+-php-fpm---sh---stress\n        |         |-3*[php-fpm---sh---stress---stress]\n</code></pre><p>从这里可以看到，stress 是被 php-fpm 调用的子进程，并且进程数量不止一个（这里是3个）。找到父进程后，我们能进入 app 的内部分析了。</p><p>首先，当然应该去看看它的源码。运行下面的命令，把案例应用的源码拷贝到 app 目录，然后再执行 grep 查找是不是有代码再调用 stress 命令：</p><pre><code># 拷贝源码到本地\n$ docker cp phpfpm:/app .\n\n# grep 查找看看是不是有代码在调用stress命令\n$ grep stress -r app\napp/index.php:// fake I/O with stress (via write()/unlink()).\napp/index.php:$result = exec(&quot;/usr/local/bin/stress -t 1 -d 1 2&gt;&amp;1&quot;, $output, $status);\n</code></pre><p>找到了，果然是 app/index.php 文件中直接调用了 stress 命令。</p><p>再来看看<a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-short-process/app/index.php\"> app/index.php </a>的源代码：</p><pre><code>$ cat app/index.php\n&lt;?php\n// fake I/O with stress (via write()/unlink()).\n$result = exec(&quot;/usr/local/bin/stress -t 1 -d 1 2&gt;&amp;1&quot;, $output, $status);\nif (isset($_GET[&quot;verbose&quot;]) &amp;&amp; $_GET[&quot;verbose&quot;]==1 &amp;&amp; $status != 0) {\n  echo &quot;Server internal error: &quot;;\n  print_r($output);\n} else {\n  echo &quot;It works!&quot;;\n}\n?&gt;\n</code></pre><p>可以看到，源码里对每个请求都会调用一个 stress 命令，模拟 I/O 压力。从注释上看，stress 会通过 write() 和 unlink() 对 I/O 进程进行压测，看来，这应该就是系统 CPU 使用率升高的根源了。</p><p>不过，stress 模拟的是 I/O 压力，而之前在 top 的输出中看到的，却一直是用户 CPU 和系统 CPU 升高，并没见到 iowait 升高。这又是怎么回事呢？stress 到底是不是 CPU 使用率升高的原因呢？</p><p>我们还得继续往下走。从代码中可以看到，给请求加入 verbose=1 参数后，就可以查看 stress 的输出。你先试试看，在第二个终端运行：</p><pre><code>$ curl http://192.168.0.10:10000?verbose=1\nServer internal error: Array\n(\n    [0] =&gt; stress: info: [19607] dispatching hogs: 0 cpu, 0 io, 0 vm, 1 hdd\n    [1] =&gt; stress: FAIL: [19608] (563) mkstemp failed: Permission denied\n    [2] =&gt; stress: FAIL: [19607] (394) &lt;-- worker 19608 returned error 1\n    [3] =&gt; stress: WARN: [19607] (396) now reaping child worker processes\n    [4] =&gt; stress: FAIL: [19607] (400) kill error: No such process\n    [5] =&gt; stress: FAIL: [19607] (451) failed run completed in 0s\n)\n</code></pre><p>看错误消息 <span class=\"orange\">mkstemp failed: Permission denied </span>，以及 <span class=\"orange\">failed run completed in 0s</span>。原来 stress 命令并没有成功，它因为权限问题失败退出了。看来，我们发现了一个 PHP 调用外部 stress 命令的 bug：没有权限创建临时文件。</p><p>从这里我们可以猜测，正是由于权限错误，大量的 stress 进程在启动时初始化失败，进而导致用户 CPU 使用率的升高。</p><p>分析出问题来源，下一步是不是就要开始优化了呢？当然不是！既然只是猜测，那就需要再确认一下，这个猜测到底对不对，是不是真的有大量的 stress 进程。该用什么工具或指标呢？</p><p>我们前面已经用了 top、pidstat、pstree 等工具，没有发现大量的 stress 进程。那么，还有什么其他的工具可以用吗？</p><p>还记得上一期提到的 perf 吗？它可以用来分析 CPU 性能事件，用在这里就很合适。依旧在第一个终端中运行 perf record -g 命令 ，并等待一会儿（比如15秒）后按 Ctrl+C 退出。然后再运行 perf report 查看报告：</p><pre><code># 记录性能事件，等待大约15秒后按 Ctrl+C 退出\n$ perf record -g\n\n# 查看报告\n$ perf report\n</code></pre><p>这样，你就可以看到下图这个性能报告：</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/33/c99445b401301147fa41cb2b5739e833.png?wh=720*527\" alt=\"\"></p><p>你看，stress 占了所有CPU时钟事件的 77%，而 stress  调用调用栈中比例最高的，是随机数生成函数 random()，看来它的确就是 CPU 使用率升高的元凶了。随后的优化就很简单了，只要修复权限问题，并减少或删除 stress 的调用，就可以减轻系统的 CPU 压力。</p><p>当然，实际生产环境中的问题一般都要比这个案例复杂，在你找到触发瓶颈的命令行后，却可能发现，这个外部命令的调用过程是应用核心逻辑的一部分，并不能轻易减少或者删除。</p><p>这时，你就得继续排查，为什么被调用的命令，会导致 CPU 使用率升高或 I/O 升高等问题。这些复杂场景的案例，我会在后面的综合实战里详细分析。</p><p>最后，在案例结束时，不要忘了清理环境，执行下面的 Docker 命令，停止案例中用到的 Nginx 进程：</p><pre><code>$ docker rm -f nginx phpfpm\n</code></pre><h2>execsnoop</h2><p>在这个案例中，我们使用了 top、pidstat、pstree 等工具分析了系统 CPU 使用率高的问题，并发现 CPU 升高是短时进程 stress 导致的，但是整个分析过程还是比较复杂的。对于这类问题，有没有更好的方法监控呢？</p><p><a href=\"https://github.com/brendangregg/perf-tools/blob/master/execsnoop\">execsnoop</a> 就是一个专为短时进程设计的工具。它通过 ftrace 实时监控进程的 exec() 行为，并输出短时进程的基本信息，包括进程 PID、父进程 PID、命令行参数以及执行的结果。</p><p>比如，用 execsnoop 监控上述案例，就可以直接得到 stress 进程的父进程 PID 以及它的命令行参数，并可以发现大量的 stress 进程在不停启动：</p><pre><code># 按 Ctrl+C 结束\n$ execsnoop\nPCOMM            PID    PPID   RET ARGS\nsh               30394  30393    0\nstress           30396  30394    0 /usr/local/bin/stress -t 1 -d 1\nsh               30398  30393    0\nstress           30399  30398    0 /usr/local/bin/stress -t 1 -d 1\nsh               30402  30400    0\nstress           30403  30402    0 /usr/local/bin/stress -t 1 -d 1\nsh               30405  30393    0\nstress           30407  30405    0 /usr/local/bin/stress -t 1 -d 1\n...\n</code></pre><p>execsnoop 所用的 ftrace 是一种常用的动态追踪技术，一般用于分析 Linux 内核的运行时行为，后面课程我也会详细介绍并带你使用。</p><h2>小结</h2><p>碰到常规问题无法解释的 CPU 使用率情况时，首先要想到有可能是短时应用导致的问题，比如有可能是下面这两种情况。</p><ul>\n<li>\n<p>第一，<strong>应用里直接调用了其他二进制程序，这些程序通常运行时间比较短，通过 top 等工具也不容易发现</strong>。</p>\n</li>\n<li>\n<p>第二，<strong>应用本身在不停地崩溃重启，而启动过程的资源初始化，很可能会占用相当多的 CPU</strong>。</p>\n</li>\n</ul><p>对于这类进程，我们可以用 pstree 或者 execsnoop 找到它们的父进程，再从父进程所在的应用入手，排查问题的根源。</p><h2>思考</h2><p>最后，我想邀请你一起来聊聊，你所碰到的 CPU 性能问题。有没有哪个印象深刻的经历可以跟我分享呢？或者，在今天的案例操作中，你遇到了什么问题，又解决了哪些呢？你可以结合我的讲述，总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","comments":[{"had_liked":false,"id":45871,"user_name":"sotey","can_delete":false,"product_type":"c1","uid":1221689,"ip_address":"","ucode":"7D3B7E45FC18BA","user_header":"https://static001.geekbang.org/account/avatar/00/12/a4/39/6a5cd1d8.jpg","comment_is_top":false,"comment_ctime":1543807781,"is_pvip":false,"replies":[{"id":"16421","content":"举一反三动手实践的楷模😊 希望看到更多的人把这些思路用起来","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543831267,"ip_address":"","comment_id":45871,"utype":1}],"discussion_count":2,"race_medal":0,"score":"701623477029","product_id":100020901,"comment_content":"对老师膜拜！今天一早生产tomcat夯住了，16颗cpu全部98%以上，使用老师的方法加上java的工具成功定位到了问题线程和问题函数。","like_count":163,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431247,"discussion_content":"举一反三动手实践的楷模😊 希望看到更多的人把这些思路用起来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543831267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1331828,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IZKGetBZDuMEa2VwwtesTELvLORIyV749ItgfAqNPv30n4zEv71wuGNr1aNVIVltG0icvH53DHDuqPuzNpiauWAg/132","nickname":"Geek_bb89c3","note":"","ucode":"0F97B5B0F2DDD6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349802,"discussion_content":"直接看错误日志，是不是能够更快的定位到系统中的错误信息？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1613555782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48456,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":1258789,"ip_address":"","ucode":"63A002997462E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/35/25/bab760a1.jpg","comment_is_top":false,"comment_ctime":1544447550,"is_pvip":false,"replies":[{"id":"17467","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544521665,"ip_address":"","comment_id":48456,"utype":1}],"discussion_count":1,"race_medal":0,"score":"285012289086","product_id":100020901,"comment_content":"perf record -ag -- sleep 2;perf report<br>一部到位","like_count":66,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432187,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544521665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66315,"user_name":"bruceding","can_delete":false,"product_type":"c1","uid":1024057,"ip_address":"","ucode":"D35A2B05487EAE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/39/ddcf26ac.jpg","comment_is_top":false,"comment_ctime":1549929024,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"250658032192","product_id":100020901,"comment_content":"sar -w 或者 sar -w 1  也能直观的看到每秒生成线程或者进程的数量。Brendan Gregg 确实是这个领域的大师，贡献了很多的技术理念和实践经验。他的《性能之巅》 可以和本课对比着看，会有更多的理解。","like_count":58,"discussions":[{"author":{"id":1250922,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIzGGthScz54sECZJKX3lgyjCATkgrvSt5N3eOsYB34jibCr3SkAX88QaZ5IVmME9Ec7VdkQGwRSPw/132","nickname":"哈哈哈","note":"","ucode":"8AC20A1C9C7DF8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589974,"discussion_content":"牛！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665414836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452675,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJhbjhkN9mVxxA3wfMCmZ5BmoFVHXyaOkqDH5uRXGQNFngDdJDYqkf82ictdicZ9WibLjoiapcom4XbGw/132","nickname":"木易","note":"","ucode":"7CCA6255570E6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568446,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651138466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66073,"user_name":"bruceding","can_delete":false,"product_type":"c1","uid":1024057,"ip_address":"","ucode":"D35A2B05487EAE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/39/ddcf26ac.jpg","comment_is_top":false,"comment_ctime":1549870738,"is_pvip":false,"replies":[{"id":"23697","content":"赞，再加上APM定位就更简单了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550067571,"ip_address":"","comment_id":66073,"utype":1}],"discussion_count":2,"race_medal":0,"score":"173348562578","product_id":100020901,"comment_content":"http:&#47;&#47;blog.bruceding.com&#47;420.html  这个是之前的优化经历，通过 perf + 火焰图，定位热点代码，结合业务和网络分析，最终确定问题原因","like_count":40,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438692,"discussion_content":"赞，再加上APM定位就更简单了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550067571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2593667,"avatar":"https://static001.geekbang.org/account/avatar/00/27/93/83/cb37c46e.jpg","nickname":"cshzet","note":"","ucode":"A343CCB6E5D519","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567860,"discussion_content":"老哥，你的服务器好像过期了，网页上不去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651020350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46624,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543965533,"is_pvip":false,"discussion_count":6,"race_medal":1,"score":"134687951709","product_id":100020901,"comment_content":"【D6补卡】<br>如果碰到不好解释的CPU问题时，比如现象：<br>通过top观察CPU使用率很高，但是看下面的进程的CPU使用率好像很正常，通过pidstat命令查看cpu也很正常。但通过top查看task数量不正常，处于R状态的进程是可疑点。<br><br>首先要想到可能是短时间的应用导致的问题，如下面的两个：<br>（1）应用里直接调用了其他二进制程序，这些程序通常运行时间比较短，通过top等工具发现不了<br>（2）应用本身在不停地崩溃重启，而启动过程的资源初始化，很可能会占用很多CPU资源<br><br>对于这类进程就需要 pstree 或execsnoop命令查找父进程，再从父进程的应用入手，找原因。<br>我实战的问题：<br>（1）centos的系统，发现通过 yum install pstress命令或其他命令，总是说没有匹配的软件包，这个很头疼<br>①pstress装不上可以尝试 yum install psmisc<br>②execsnoop这个命令我没有装上，想请教下老师如何解决这种yum install命令报没有匹配包的情况<br>（2）然后就是通过perf命令只能看到十六进制符号，看不到具体函数名的问题，这个可以使用上篇文章中我的留言的方法，我在copy一份，供大家参考<br>分析：当没有看到函数名，只看到十六进制时，说明perf无法找到待分析进程所依赖的库。<br>解决办法：<br>在容器外面把分析记录保存，到容器里面查看结果<br>操作：<br>（1）在centos系统上运行 perf record -g ，执行一会儿按ctrl+c停止<br>（2）把生成的perf.data（通常文件生成在命令执行的当前目录下，当然可以通过find | grep perf.data或 find &#47; -name perf.data查看路径）文件拷贝到容器里面分析：<br>docker cp perf.data phpfpm:&#47;tpm<br>docker exec -i -t phpfpm bash<br>cd &#47;tmp&#47;<br>apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps<br>perf_4.9 report<br>这样就可以看到函数名了","like_count":31,"discussions":[{"author":{"id":1640292,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/pnpwGEBxicgdYWEX1CPAibVUKL7ricsI0NK7XrFh0iaBUrZdLoYC5jojQfMib7ePJKj0icScdf4sv0LmZ82nFWa9OBibw/132","nickname":"曾中铭","note":"","ucode":"C3F974ED43F82C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40638,"discussion_content":"对于 yum install 命令报没有匹配包的问题，可以通过 yum provides 查询需要安装的工具被包含在哪个 rpm 里，再用 yum install 安装该 rpm 包","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1572247457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200299,"avatar":"https://static001.geekbang.org/account/avatar/00/12/50/ab/6584e520.jpg","nickname":"陈顺吉","note":"","ucode":"315732AEA35CD1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301799,"discussion_content":"找不到对应的命令、库文件、头文件时，直接使用 yum provides &#34;*/FILENAME&#34; 就可以找到该文件对应的 rpm 包了。另外，是 pstree 不是 pstress，tree 是树的意思。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598664055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076264,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6c/28/a1f9f0ad.jpg","nickname":"陈树义","note":"","ucode":"AF83C4BDC192B5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585052,"discussion_content":"学习了~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661311379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2110494,"avatar":"https://static001.geekbang.org/account/avatar/00/20/34/1e/8a9f7cd5.jpg","nickname":"慢慢来","note":"","ucode":"3AF18A1AEC3E61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300878,"discussion_content":"补充一点，老师里面的docker环境为debian，对应的安装源应该更新为较快的阿里源或其他，否则update等上个一天都搞不定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598286521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336009,"avatar":"https://static001.geekbang.org/account/avatar/00/14/62/c9/7da27891.jpg","nickname":"DKSky","note":"","ucode":"69371A81033949","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21150,"discussion_content":"execsnoop点进去就在github中，直接下载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569424155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321192,"avatar":"https://static001.geekbang.org/account/avatar/00/14/28/e8/a0936291.jpg","nickname":"龙小宝","note":"","ucode":"39A3FBD4040508","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4161,"discussion_content":"前一篇中你提到的解决函数名变更为16进制的办法在这里我试了行不通，把perf.data放进去之后，使用perf_4.9运行不了，提示需要安装3.10的内核更新，但是内核更新又更新不了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565178884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203541,"user_name":"EncodedStar","can_delete":false,"product_type":"c1","uid":1504234,"ip_address":"","ucode":"03958CA7DDD6AE","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/ea/2b2adda5.jpg","comment_is_top":false,"comment_ctime":1586230212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"126140281796","product_id":100020901,"comment_content":"这种课程，多学多益，一旦遇到被你解决了，你就是公司最靓的仔~~~","like_count":29},{"had_liked":false,"id":180358,"user_name":"罗辑思维","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1582267050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"104661482154","product_id":100020901,"comment_content":"#下载execsnoop#<br>1 cd &#47;usr&#47;bin<br>2 wget https:&#47;&#47;raw.githubusercontent.com&#47;brendangregg&#47;perf-tools&#47;master&#47;execsnoop<br>3 chmod 755 execsnoop ","like_count":24},{"had_liked":false,"id":47142,"user_name":"western","can_delete":false,"product_type":"c1","uid":1215550,"ip_address":"","ucode":"21BCB130722780","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/3e/e767c15f.jpg","comment_is_top":false,"comment_ctime":1544062789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"91738376005","product_id":100020901,"comment_content":"感觉看侦探小说，遍看遍等老师说那句话——”真相只有一个”","like_count":21},{"had_liked":false,"id":46281,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1543892584,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"87443238504","product_id":100020901,"comment_content":"今天早上收到线上一台机器的CPU使用率告警邮件，马上登陆机器查看告警进程号的&#47;proc情况，使用uptime、pidstat和top命令查当前运行情况，后面定位到是crontab定时任务中的程序引起负载过高。","like_count":20,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591474,"discussion_content":"你就是公司最亮的仔","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666595547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50462,"user_name":"风","can_delete":false,"product_type":"c1","uid":1177916,"ip_address":"","ucode":"E054CE4AABF790","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/3c/f75ab868.jpg","comment_is_top":false,"comment_ctime":1544974078,"is_pvip":false,"replies":[{"id":"18094","content":"嗯嗯 很好的问题。简单的说，swapper跟我们要分析的对象无关。这也是为什么我们不上来就用perf，而是先用其他方法缩小范围。我还会在答疑篇里解释swapper的作用","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545003241,"ip_address":"","comment_id":50462,"utype":1}],"discussion_count":6,"race_medal":0,"score":"61674516222","product_id":100020901,"comment_content":"老师好，我在实验的过程中，在最后使用 perf record -ag 的时候，发现记录下来的值，其中 stress 并不是消耗 CPU 最猛的进程，而是swapper，不知道什么原因？碰到这种情况时，该如何继续排查下去？以下是我的 perf report<br>Samples: 223K of event &#39;cpu-clock&#39;, Event count (approx.): 55956000000<br>  Children      Self  Command          Shared Object            Symbol<br>+   11.54%     0.00%  swapper          [kernel.kallsyms]        [k] cpu_startup_entry<br>+   11.42%     0.00%  swapper          [kernel.kallsyms]        [k] default_idle_call<br>+   11.42%     0.00%  swapper          [kernel.kallsyms]        [k] arch_cpu_idle<br>+   11.42%     0.00%  swapper          [kernel.kallsyms]        [k] default_idle<br>+   11.05%    11.05%  swapper          [kernel.kallsyms]        [k] native_safe_halt<br>+    8.69%     0.00%  swapper          [kernel.kallsyms]        [k] start_secondary<br>+    4.36%     4.36%  stress           libc-2.24.so             [.] 0x0000000000036387<br>+    3.44%     0.00%  php-fpm          libc-2.24.so             [.] 0xffff808406d432e1<br>+    3.44%     0.00%  php-fpm          [unknown]                [k] 0x6cb6258d4c544155<br>+    3.43%     3.43%  stress           stress                   [.] 0x0000000000002eff<br>+    3.20%     0.00%  stress           [kernel.kallsyms]        [k] page_fault<br>+    3.20%     0.00%  stress           [kernel.kallsyms]        [k] do_page_fault<br>+    3.15%     0.76%  stress           [kernel.kallsyms]        [k] __do_page_fault","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432986,"discussion_content":"嗯嗯 很好的问题。简单的说，swapper跟我们要分析的对象无关。这也是为什么我们不上来就用perf，而是先用其他方法缩小范围。我还会在答疑篇里解释swapper的作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545003241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39208,"discussion_content":"我跟你的情况是一样的，我的虚拟机用了8个CPU，8G内存","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571905208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591475,"discussion_content":"swapper是一个空任务不需要管","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666595595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1769504,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","nickname":"Geek_f93234","note":"","ucode":"1E5DC903A5429E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580374,"discussion_content":"+   23.56%     0.00%  swapper          [kernel.kallsyms]               [k] start_cpu\n+   23.55%     0.00%  swapper          [kernel.kallsyms]               [k] cpu_startup_entry\n+   23.55%     0.00%  swapper          [kernel.kallsyms]               [k] arch_cpu_idle\n+   23.55%     0.00%  swapper          [kernel.kallsyms]               [k] default_idle\n+   22.62%    22.62%  swapper          [kernel.kallsyms]               [k] native_safe_halt\n+   18.06%     0.00%  swapper          [kernel.kallsyms]               [k] start_secondary\n+   13.38%     0.00%  nginx            [kernel.kallsyms]               [k] do_softirq\n+   13.38%     0.00%  nginx            [kernel.kallsyms]               [k] call_softirq\n+   13.38%     0.01%  nginx            [kernel.kallsyms]               [k] __do_softirq\n+   13.33%     0.02%  nginx            [kernel.kallsyms]               [k] net_rx_action\n+   12.87%     0.02%  nginx            [kernel.kallsyms]               [k] __local_bh_enable_ip\n+   11.58%     0.01%  nginx            [kernel.kallsyms]               [k] ip_output\n+   11.55%     0.00%  nginx            [kernel.kallsyms]               [k] ip_finish_output\n+   11.31%     0.02%  nginx            [kernel.kallsyms]               [k] tcp_transmit_skb\n+   11.28%     0.01%  nginx            [kernel.kallsyms]               [k] ip_local_out_sk\n+   11.27%     0.01%  nginx            [kernel.kallsyms]               [k] ip_queue_xmit\n+   11.24%     0.01%  nginx            [kernel.kallsyms]               [k] __tcp_push_pending_frames\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658132929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39210,"discussion_content":"+    6.48%     0.00%  swapper          [unknown]                [k] 0xffffffff94d85885\n+    6.48%     0.00%  swapper          [unknown]                [k] 0xffffffff94d8572f\n+    6.48%     0.00%  swapper          [unknown]                [k] 0xffffffff94d861c6\n+    6.48%     0.00%  swapper          [unknown]                [k] 0xffffffff94751117\n     2.57%     2.57%  stress           libc-2.24.so             [.] 0x0000000000036387\n+    2.49%     0.00%  stress           [unknown]                [.] 0xffffffff9476c768\n+    2.49%     0.00%  stress           [unknown]                [.] 0xffffffff94770925\n     2.43%     2.43%  stress           stress                   [.] 0x0000000000002eff\n+    2.28%     0.00%  php-fpm          [unknown]                [k] 0x6cb6258d4c544155\n+    2.28%     0.00%  php-fpm          libc-2.24.so             [.] 0x00007fbb4f0912e1\n+    1.62%     0.00%  stress           [unknown]                [.] 0xffffffff94770603","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571905295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39209,"discussion_content":"+   46.72%     0.00%  swapper          [unknown]                [k] 0xffffffff940000d5\n+   46.44%     0.00%  swapper          [unknown]                [k] 0xffffffff940fc65a\n+   46.44%     0.00%  swapper          [unknown]                [k] 0xffffffff940366f0\n+   46.43%     0.00%  swapper          [unknown]                [k] 0xffffffff9476ac8e\n+   46.10%    46.10%  swapper          [kernel.kallsyms]        [k] native_safe_halt\n+   46.10%     0.00%  swapper          [unknown]                [k] 0xffffffff9476ae9b\n+   40.23%     0.00%  swapper          [unknown]                [k] 0xffffffff94057ff7","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571905271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46275,"user_name":"looperX","can_delete":false,"product_type":"c1","uid":1054948,"ip_address":"","ucode":"AB13DFCF9D6DE9","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/e4/46d002ed.jpg","comment_is_top":false,"comment_ctime":1543892257,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"48788532513","product_id":100020901,"comment_content":"Day03留言。<br>Github上找到一个链接，里面有各种工具，包括execsnoop。","like_count":11,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578928,"discussion_content":"牛逼压\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657096093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135912,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","nickname":"黑色毛衣","note":"","ucode":"FF7E235F91BA5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577514,"discussion_content":"git clone --depth 1 https://github.com/brendangregg/perf-tools","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656157546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1538486,"avatar":"https://static001.geekbang.org/account/avatar/00/17/79/b6/98834766.jpg","nickname":"August","note":"","ucode":"72A0CB0C74CD35","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369597,"discussion_content":"地址发一下，谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619089765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1303623,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e4/47/d6469ffa.jpg","nickname":"橙子","note":"","ucode":"019A02ADD2E9F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1538486,"avatar":"https://static001.geekbang.org/account/avatar/00/17/79/b6/98834766.jpg","nickname":"August","note":"","ucode":"72A0CB0C74CD35","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402063,"discussion_content":"git clone --depth 1 https://github.com/brendangregg/perf-tools\n在./perf-tools/bin/目录下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633789454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":369597,"ip_address":""},"score":402063,"extra":""}]},{"author":{"id":1106209,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e1/21/5f0bf9a0.jpg","nickname":"阿文","note":"","ucode":"BB4DB62141971F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1078,"discussion_content":"地址发一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562312939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90906,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1556719532,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"44506392492","product_id":100020901,"comment_content":"分析步骤：<br>1，在top中，可见用户态cpu使用率很高，但未见相关有问题的进程；<br>2，尝试pidstat 1 找出问题进程，无果；<br>3，再次top,从load average 可见负载高，shift + f ，然后选择以s (进程状态）排序，按R倒序，可见running的进程主要就是几个stress进程，观察发现，running的stress进程的pid一直在变化；<br>4，watch -d &#39;ps aux | grep stress | grep -v grep&#39; 发现多个stress进程在不断生成，由R变S再变Z（由于watch的时间间隔是1秒，所以只是看到有多个stress进程，有的状态是R有的是S有的是Z，所以我推断其生命周期是如此）<br>5，进程Pid再不断变化，有以下两个原因：<br>5.1，进程在不断崩溃重启，如因为段错误，配置错误等，这时进程在退出后又被监控系统自动重启<br>5.2，这些都是短进程，即在应用内部通过exec调用外部命令。这些命令一般只运行很短的时间就会结束，很难用时间间隔长的工具，如top去发现<br>6，用pstress去找其父进程<br><br>7，发现是php容器，故查看php源码<br># 拷贝源码到本地<br>$ docker cp phpfpm:&#47;app .<br># grep 查找看看是不是有代码在调用 stress 命令<br>$ grep stress -r app<br><br>8，从源代码中找相关字段<br><br>9，stress -t 1 -d 1 是模拟IO压力的，但在之前的top中，未见%iowait异常；<br>10，通过代码中的判断字段，手动赋值访问<br>curl http:&#47;&#47;192.168.0.10:10000?verbose=1<br>Server internal error: Array<br>(<br>    [0] =&gt; stress: info: [19607] dispatching hogs: 0 cpu, 0 io, 0 vm, 1 hdd<br>    [1] =&gt; stress: FAIL: [19608] (563) mkstemp failed: Permission denied<br>    [2] =&gt; stress: FAIL: [19607] (394) &lt;-- worker 19608 returned error 1<br>    [3] =&gt; stress: WARN: [19607] (396) now reaping child worker processes<br>    [4] =&gt; stress: FAIL: [19607] (400) kill error: No such process<br>    [5] =&gt; stress: FAIL: [19607] (451) failed run completed in 0s<br>)<br>11，从这里可以猜测，由于权限错误，大量的stress进程在启动时初始化失败，结合第4点，我认为CPU消耗在进程上下文切换，从vmstat可见cs由问题出现前的100多骤升并稳定维持在3000多<br>[root@master ~]# vmstat 1<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 9  0      0 6932288   2160 790400    0    0    20    24   44   71  8  5 87  0  0<br> 8  0      0 6932784   2160 790560    0    0     0     0 4027 3512 71 27  3  0  0<br>11  0      0 6934920   2160 790488    0    0     0     0 4170 3646 72 28  1  0  0<br><br>但pidstat -w |grep stress 却未见异常，因为同名进程一直在更换，所以用pidstat -w在这里是不太适用的<br>[root@master ~]# pidstat -w 2 | grep stress<br>09:55:29 AM     1     18583      0.50      0.50  stress<br>09:55:29 AM     1     18584      0.50      0.50  stress<br>09:55:29 AM     1     18586      0.50      0.00  stress<br>。。。<br>请问以上对吗？","like_count":10,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591477,"discussion_content":"查看僵尸进程直接就是 ps -A -ostat,ppid,pid,cmd|egrep -e &#34;^[zZ]&#34;就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666596038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219979,"user_name":"阿飞","can_delete":false,"product_type":"c1","uid":1298046,"ip_address":"","ucode":"F8B1FC8521264D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","comment_is_top":false,"comment_ctime":1590130273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23064966753","product_id":100020901,"comment_content":"关于使用perf工具分析docker容器共用3种可行的办法，详见：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;10833689.html","like_count":5},{"had_liked":false,"id":48054,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1544334825,"is_pvip":false,"replies":[{"id":"17291","content":"嗯嗯，这是一个模块，侧重于CPU的分析，后面还会讲磁盘、网络等等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544437300,"ip_address":"","comment_id":48054,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23019171305","product_id":100020901,"comment_content":"实际生产环境中的进程更多，stress藏在ps中根本不容易发现，pstree的结果也非常大。老师有空讲讲如何找到这些异常进程的方法和灵感。","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432010,"discussion_content":"嗯嗯，这是一个模块，侧重于CPU的分析，后面还会讲磁盘、网络等等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544437300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46032,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1543836612,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23018673092","product_id":100020901,"comment_content":"倪老师您好，我在网上看到一个关于iowait指标的解释，非常形象，但不确定是否准确，帮忙鉴别一下，谢谢，链接 http:&#47;&#47;linuxperf.com&#47;?p=33","like_count":5},{"had_liked":false,"id":45811,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543798976,"is_pvip":false,"discussion_count":2,"race_medal":1,"score":"23018635456","product_id":100020901,"comment_content":"【D6打卡】这几天回丈母娘家，没带电脑，没能实战，只能看文章了，回来后要补上","like_count":5,"discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136545,"discussion_content":"重点在。。。有丈母娘的人","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1579146984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293232,"discussion_content":"有丈母娘的小伙","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595488231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76260,"user_name":"汤🐠🥣昱","can_delete":false,"product_type":"c1","uid":1332781,"ip_address":"","ucode":"46842C90E59A1A","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/2d/dd3b12b8.jpg","comment_is_top":false,"comment_ctime":1552560322,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18732429506","product_id":100020901,"comment_content":"1： 对于pidstat,vmstat,top无法定位到问题的时候。<br>2： 可以选择perf record -g 记录。<br>3： 用perf report查看是否可以定位到问题。<br>4： 用pstree | grep [xx],这样定位到具体的调用方法里。<br>5： 用grep [xx] -r [项目文件],找到具体代码位置。<br>6： 查找源码，定位到具体位置，修改。","like_count":4,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591478,"discussion_content":"还可以用strace -p -f 去进行追踪","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666596115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72557,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1551667699,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18731536883","product_id":100020901,"comment_content":"打卡，对于大数据的系统分析起来还是比较困难的，进程已经达到上千，只能用top去分析","like_count":4},{"had_liked":false,"id":53496,"user_name":"每一段路都是一种领悟","can_delete":false,"product_type":"c1","uid":1123452,"ip_address":"","ucode":"B23F0D4B02197B","user_header":"https://static001.geekbang.org/account/avatar/00/11/24/7c/b76ad65d.jpg","comment_is_top":false,"comment_ctime":1545657533,"is_pvip":false,"replies":[{"id":"19395","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545664294,"ip_address":"","comment_id":53496,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18725526717","product_id":100020901,"comment_content":"今天一个程序负载飙到140，最高点240，我们的服务器没有挂掉，真的是牛逼，另外使用这几天的方法，基本确认了程序的问题，质问开发后，他不好意思的告诉我，io高是因为自己程序偷了懒，好在这次找到证据了，作为以后的分析案例","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434156,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545664294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1804356,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/88/44/87cc5c0f.jpg","nickname":"小学生","note":"","ucode":"0DBB26031234FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266493,"discussion_content":"这就是上面说的：公司里最亮的仔。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589522565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45862,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1543805037,"is_pvip":false,"replies":[{"id":"16423","content":"点击链接到github上。<br><br>完全一样的工具应该没有，但可以基于内核追踪技术（比如BPF）来自己写一个。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543831617,"ip_address":"","comment_id":45862,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18723674221","product_id":100020901,"comment_content":"execsnoop这个工具在centos里找不到，有类似的代替品吗","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431243,"discussion_content":"点击链接到github上。\n\n完全一样的工具应该没有，但可以基于内核追踪技术（比如BPF）来自己写一个。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543831617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591496,"discussion_content":"没有大佬你这个水平去写，只能用现成的工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666599411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":431243,"ip_address":"浙江"},"score":591496,"extra":""}]}]},{"had_liked":false,"id":66316,"user_name":"bruceding","can_delete":false,"product_type":"c1","uid":1024057,"ip_address":"","ucode":"D35A2B05487EAE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/39/ddcf26ac.jpg","comment_is_top":false,"comment_ctime":1549929112,"is_pvip":false,"replies":[{"id":"23703","content":"👍，谢谢分享经验。使用低版本内核的用户可以试试 链接里面的 thread-times.stp。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550068279,"ip_address":"","comment_id":66316,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14434831000","product_id":100020901,"comment_content":"对于内核函数的调试，4.0 的内核可以使用 eBPF 工具，2.6 或者 4.0 以下的工具，使用 systemtap。perf 是基于采样的原理。本文的例子 execsnoop 可以替换成 https:&#47;&#47;sourceware.org&#47;systemtap&#47;SystemTap_Beginners_Guide&#47;threadtimessect.html。systemtap 中文资料比较少，本人也翻译了相关文档，参考：http:&#47;&#47;systemtap.bruceding.com&#47;。","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438778,"discussion_content":"👍，谢谢分享经验。使用低版本内核的用户可以试试 链接里面的 thread-times.stp。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550068279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52706,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1545482800,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14430384688","product_id":100020901,"comment_content":"环境已搭建好，但现在不知道怎么通过github链接来安装execsnoop","like_count":3,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578944,"discussion_content":"git clone  https://github.com/brendangregg/perf-tools 拉下来进入目录/root/perf-tools/execsnoop或者设置环境变量即可","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657097189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1912653,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","nickname":"Yong","note":"","ucode":"0ADA75C5C68619","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265400,"discussion_content":"execsnoop就是个bash脚本，复制内容到本地，然后chmod +x 就ok","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589385359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1031677,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/bd/fd/3f5d5db5.jpg","nickname":"scorpiozj","note":"","ucode":"C66EA76809F9BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4433,"discussion_content":"链接上级就是perf-tools主页，有下载说明；脚本命令，下载即用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565417274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46049,"user_name":"学习学习再学习","can_delete":false,"product_type":"c1","uid":1291177,"ip_address":"","ucode":"7F85F036A150A8","user_header":"https://static001.geekbang.org/account/avatar/00/13/b3/a9/46cbb52f.jpg","comment_is_top":false,"comment_ctime":1543838956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14428740844","product_id":100020901,"comment_content":"老师在某楼的回复中说 strace 没有统计功能，这里提一下，-c 可以统计某 pid 的系统调用次数，但确实没法对整个系统进行统计。","like_count":3},{"had_liked":false,"id":45931,"user_name":"夜空中最亮的星","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1543820981,"is_pvip":false,"replies":[{"id":"16416","content":"之前的链接有错误，已经修复了，可以点击链接跳过去","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543830011,"ip_address":"","comment_id":45931,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428722869","product_id":100020901,"comment_content":"execsnoop<br>这个工具没找到","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431277,"discussion_content":"之前的链接有错误，已经修复了，可以点击链接跳过去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543830011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258202,"user_name":"didi迪迪","can_delete":false,"product_type":"c1","uid":1244282,"ip_address":"","ucode":"0FF1C8A5162695","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/7a/f4dec0b9.jpg","comment_is_top":false,"comment_ctime":1604325256,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10194259848","product_id":100020901,"comment_content":"老师，为什么top命令中的%us可以统计到%80，但是后面详细进程信息中却统计不到占用cpu多的进程呢？","like_count":2,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387241,"discussion_content":"分享一下我个人的理解：top统计的是系统全局的状态指标。它默认的采样间隔是 3 秒。上一节课，有说到top会用 /proc/stat 里面的数据，计算各个类型的CPU指标。在 /proc/stat 里都有累计，所以可以统计到全局的状态——CPU的 %us 有 80% 这样的数据。而下面详细的进程信息是通过 /proc/[PID]/stat 读取的。例如，这节课的 stress 启动之后很快就消失了，所以统计不到。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1628066451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230564,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593419515,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10183354107","product_id":100020901,"comment_content":"如果cpu用户空间使用率非常高，但是通过top查看又找不到cpu占用高的进程的时候可以这样排查：<br>1. 通过top命令查看当前处于running状态的进程数量；<br>2. 找到running进程，看是否有可疑进程；<br>3. 通过ps或者pidstat查看此进程的cpu使用率；<br>4. 同时查看此进程的pid是否会经常变，如果经常变，那么此进程可以是没有正常启动或者是异常退出后循环启动导致；<br>5. 通过pstree查看top中查到的异常进程，找到主进程，然后通过主进程来排查问题；<br>6. 通过perf命令来查找占用cpu时长最高的进程，然后排查内部异常函数；","like_count":2},{"had_liked":false,"id":116880,"user_name":"kingkang","can_delete":false,"product_type":"c1","uid":1064567,"ip_address":"","ucode":"13E1FC8E51CE4A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/77/22843055.jpg","comment_is_top":false,"comment_ctime":1563933936,"is_pvip":false,"replies":[{"id":"43471","content":"看起来像是mongodb操作没有有效利用缓存，可以试试分析mongodb的查询是否合理","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410337,"ip_address":"","comment_id":116880,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10153868528","product_id":100020901,"comment_content":"倪老师你好，我自己用go写了一套微服务框架（基本网络架构是 一台http server+一台grpc server +三台mongodb 副本集群）；如果grpc server不调用mongodb 查询的话，qps能稳定在36000左右，而且压测的时候，grpc server 的cpu使用率大概在60%左右，平均负载最高不会超过2.5（服务器都是四核8G的 ）。如果一旦调用了mongodb查询的话，cpu使用率基本都能达到95%，平均负载最高能到4.6，而qps也下降到了6k左右。两种情况的内存差别并不大，系统内存一直维持在800M上下。我用老师教的方法，mongol db  find方法cpu占用过高。这个方法并没办法做到进一步优化，请问老师我这个框架cpu使用率过高的情况是不是就没办法进一步优化了？另外就是，如果我在加一台grpc server,也就是http server 调用两个grpc server  对系统qps 增加并不大，这是为什么我一直想不明白？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459717,"discussion_content":"看起来像是mongodb操作没有有效利用缓存，可以试试分析mongodb的查询是否合理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2065762,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/85/62/fadf9016.jpg","nickname":"光暗精灵","note":"","ucode":"500D1285D8B6DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291375,"discussion_content":"你这个是优化数据库读写性能，这个得看数据库操作的代码，一句一句找问题优化了，读写分离出来。。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594796687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2065762,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/85/62/fadf9016.jpg","nickname":"光暗精灵","note":"","ucode":"500D1285D8B6DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291377,"discussion_content":"服务器的并发瓶颈都是卡在数据库操作上面了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594796722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91138,"user_name":"小贝_No_7","can_delete":false,"product_type":"c1","uid":1063224,"ip_address":"","ucode":"84C39D64EF04C3","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/38/4c962666.jpg","comment_is_top":false,"comment_ctime":1556876184,"is_pvip":false,"replies":[{"id":"33125","content":"请参考 14 | 答疑（二）：如何用perf工具分析Java程序","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557326170,"ip_address":"","comment_id":91138,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10146810776","product_id":100020901,"comment_content":"最后的perf -g有疑问。这里并没有展示出明显的stress占比较高的情况。相反是swapper较多, stress的占比其实在10%一下。请问这个怎么解释? 我看到底下也有其他朋友有类似的疑问但是没得到很好的解析。谢谢啦。  ","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448824,"discussion_content":"请参考 14 | 答疑（二）：如何用perf工具分析Java程序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557326170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72945,"user_name":"刘韦菠","can_delete":false,"product_type":"c1","uid":1423328,"ip_address":"","ucode":"7DEE07AEB11973","user_header":"https://static001.geekbang.org/account/avatar/00/15/b7/e0/5fdb9fc2.jpg","comment_is_top":false,"comment_ctime":1551758001,"is_pvip":false,"replies":[{"id":"26744","content":"以前还真没注意有这个函数。查了下，这是 stress 源码里面的函数，你可以去看看它的源码","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551883532,"ip_address":"","comment_id":72945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10141692593","product_id":100020901,"comment_content":"我的perf record 里面 random 函数调用占比不是最高的, 最高的是一个叫做hoghdd 的函数, 这个函数里面包含了一些内存段错误和换页的函数. 这个是为什么呢? <br>我的机器是mac, 然后这个批次的mac ssd 性能有问题, 官方曾经给我发过返厂维修的通知邮件, 但是因为是公司的电脑, 所以我并没有弄去维修. hog hdd 是不是 占用hdd硬盘的意思呢?<br><br>-   57.30%     0.03%  stress           stress                    [.] main                                                                                                                                  ▒<br>   - main                                                                                                                                                                                                  ▒<br>      + 21.77% hoghdd                                                                                                                                                                                      ▒<br>      + 16.12% random_r                                                                                                                                                                                    ▒<br>      + 12.09% random                                                                                                                                                                                      ▒","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441839,"discussion_content":"以前还真没注意有这个函数。查了下，这是 stress 源码里面的函数，你可以去看看它的源码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551883532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48061,"user_name":"张德","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1544338014,"is_pvip":false,"replies":[{"id":"17289","content":"没想到专栏还带动大家学习docker了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544437063,"ip_address":"","comment_id":48061,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134272606","product_id":100020901,"comment_content":"每天都在进步  看来得好好熟悉docker了  打卡打卡","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432013,"discussion_content":"没想到专栏还带动大家学习docker了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544437063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46265,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1543890998,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10133825590","product_id":100020901,"comment_content":"因为开放面比较窄，老师后面提到的一些php，docker，ngix都比较陌生，新的虚拟机环境都需要安装，操作起来就困难重重，不过确实能通过案例领会解决问题的思路，还是会坚持下去","like_count":2,"discussions":[{"author":{"id":2291160,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f5/d8/121e4b68.jpg","nickname":"Woa 🤞","note":"","ucode":"6033F496082F3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553285,"discussion_content":"相必现在也是大牛了🐮","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645804687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228318,"user_name":"Thomas.Wu","can_delete":false,"product_type":"c1","uid":1433711,"ip_address":"","ucode":"9B8980EE4FE08C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6f/aef2e3ce.jpg","comment_is_top":false,"comment_ctime":1592640292,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5887607588","product_id":100020901,"comment_content":"膜拜大神，讲的确实不错","like_count":1},{"had_liked":false,"id":126851,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1566490492,"is_pvip":false,"replies":[{"id":"47197","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566742982,"ip_address":"","comment_id":126851,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5861457788","product_id":100020901,"comment_content":"这种实操案例真是太赞了。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464202,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566742982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113493,"user_name":"孙志博","can_delete":false,"product_type":"c1","uid":1206306,"ip_address":"","ucode":"338B3218553440","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/22/b9eb397f.jpg","comment_is_top":false,"comment_ctime":1563031410,"is_pvip":false,"replies":[{"id":"41985","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563457334,"ip_address":"","comment_id":113493,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857998706","product_id":100020901,"comment_content":"确实遇到了第1种情况的问题，使用了此解决方案，点赞","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458248,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563457334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81918,"user_name":"Silver bullet","can_delete":false,"product_type":"c1","uid":1145022,"ip_address":"","ucode":"5FE5FEC8DC56AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/78/be/7bf3f1b0.jpg","comment_is_top":false,"comment_ctime":1554082553,"is_pvip":false,"replies":[{"id":"29841","content":"第11篇有讲到这些","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554210393,"ip_address":"","comment_id":81918,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849049849","product_id":100020901,"comment_content":"老是您好 看了6篇文章学了不少工具  也跟着里面的案例联系了  但是有些不常用的工具容易忘  比如vmstat 前天学的 今天就忘了  有没有什么办法记住所学过的工具呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445390,"discussion_content":"第11篇有讲到这些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554210393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80557,"user_name":"Geek_32a1cf","can_delete":false,"product_type":"c1","uid":1203854,"ip_address":"","ucode":"319DDD9BAB6772","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDC4cj2XKjHPNdOiaZR6oxeO36umdW8cnuW0YfyKCfpia883ib4RheBicuL2TPhMY14HQ7e7Dl4Zvhd8w/132","comment_is_top":false,"comment_ctime":1553681555,"is_pvip":false,"replies":[{"id":"29323","content":"这就是要分析的了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553697213,"ip_address":"","comment_id":80557,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848648851","product_id":100020901,"comment_content":"老师，有个疑问，咱们讨论的都是有问题导致了cpu使用率较高的情况，那怎么判断是程序本身调用就需要大量的耗费cpu（例如程序纯计算）还是说程序有问题才导致了cpu的升高呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444902,"discussion_content":"这就是要分析的了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79420,"user_name":"rm -rf 😊ི","can_delete":false,"product_type":"c1","uid":1070908,"ip_address":"","ucode":"BC448EC4206D95","user_header":"https://static001.geekbang.org/account/avatar/00/10/57/3c/081b89ec.jpg","comment_is_top":false,"comment_ctime":1553479792,"is_pvip":false,"replies":[{"id":"29034","content":"嗯 有可能是短时进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553525450,"ip_address":"","comment_id":79420,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848447088","product_id":100020901,"comment_content":"想请教一下老师，running进程突然变多，突然变少的，是什么情况，主要是短时进程的问题吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444494,"discussion_content":"嗯 有可能是短时进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553525450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59618,"user_name":"Wind～","can_delete":false,"product_type":"c1","uid":1335448,"ip_address":"","ucode":"C72A7DE7DB21DB","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/98/b519a361.jpg","comment_is_top":false,"comment_ctime":1547392903,"is_pvip":false,"replies":[{"id":"21517","content":"全是16进制的符号，请参考性能答疑篇查看解决方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547447648,"ip_address":"","comment_id":59618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842360199","product_id":100020901,"comment_content":"之前给老师留言的问题已经自己搞定了，在后续的实验中我发现我的实验有些不太一样，还是希望老师看到后可以再指点一二，老师的ps和pidstat都没有输出，而我的则是有输出，但是分析的结果导向是一致的——线索都指向了stress<br><br>----通过pidstat<br>[wind@aaa ~]$ pidstat -p 39945<br>Linux 3.10.0-862.el7.x86_64 (aaa)     2019年01月14日     _x86_64_    (1 CPU)<br><br>06时31分09秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>06时31分09秒     1     89962    0.00    0.00    0.00    0.00     0  php-fpm<br>[wind@aaa ~]$ <br><br>----通过ps aux<br>[wind@aaa ~]$ ps aux | grep 39945<br>bin       39945  1.3  0.7 336684  7688 pts&#47;2    S+   06:36   0:01 php-fpm: pool www<br>wind      54077  0.0  0.0 112704   664 pts&#47;3    R+   06:38   0:00 grep --color=auto 39945<br>[wind@aaa ~]$ <br><br>----再通过ps -efl<br>[wind@aaa ~]$ ps -lef | grep 121267<br>0 S bin       58233 121267  0  80   0 -  1070 do_wai 07:00 pts&#47;2    00:00:00 sh -c &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1 2&gt;&amp;1<br>0 S wind      58250  42935  0  80   0 - 28180 pipe_w 07:00 pts&#47;3    00:00:00 grep --color=auto 121267<br>5 S bin      121267  75443  1  80   0 - 84171 pipe_w 06:52 pts&#47;2    00:00:06 php-fpm: pool www<br><br>----但是我的实验中有些不同的地方是，php-fpm的京城并不会发生改变但是基本上都处于S状态很少会有R状态出现，但是如果出现R状态的话，那么在过0.5秒后，就必然会出现一个Z进程<br>----并且在后续的perf report 中占比最高的也没有random函数<br>-   66.20%     0.00%  stress           stress                          [.] 0x000000000000168d                                       ▒<br>   - 0x168d                                                                                                                         ▒<br>      - 5.49% 0x2f25                                                                                                                ▒<br>         - 3.75% 0xffffffffba116768                                                                                                 ▒<br>            - 3.74% 0xffffffffba11a925                                                                                              ▒<br>               - 2.94% 0xffffffffba11a597","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436367,"discussion_content":"全是16进制的符号，请参考性能答疑篇查看解决方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547447648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46505,"user_name":"","can_delete":false,"product_type":"c1","uid":1187469,"ip_address":"","ucode":"B4A70F7D96BECF","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/8d/4239f463.jpg","comment_is_top":false,"comment_ctime":1543931150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838898446","product_id":100020901,"comment_content":"400%cpu  150%user   3%nice  119%sys   127%idle  0% iow  0%irq  1%  sirq 0%host <br>PID    USER    PR   NI   VIRT   RES    SHR  S[%CPU] %MEM   TIME+ARGS<br>4149  system  10  -10 1.8G    176M  113M   141        6.4         7:13.67<br>4127   root      20   0     0        0         0          98.3        0            7:23.93<br>老师你好，板卡上linux 系统好多工具无法使用，只能用top查看CPU使用率很高，<br>uptime  load average:  9.26  4.37  1.70  <br><br>目前分析到 用户空间占用CPU比较高，内核态的CPU占用也比较高。有没有什么可以进一步分析的工具或方法吗？感谢","like_count":1},{"had_liked":false,"id":46381,"user_name":"阿成（Matthew）","can_delete":false,"product_type":"c1","uid":1315901,"ip_address":"","ucode":"935985DD00A1F6","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/3d/70764fdc.jpg","comment_is_top":false,"comment_ctime":1543911918,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838879214","product_id":100020901,"comment_content":"如果一个线程处于io状态，等待网络response，那么 这个线程。会被cpu调度的时候调用么？还是等到response有数据的时候，才会被调度到？","like_count":1},{"had_liked":false,"id":46112,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1543848770,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5838816066","product_id":100020901,"comment_content":"整理下今天学到的知识：<br>1、遇到CPU使用率高，但又无法通过top定位到某个进程时，就需要考虑是否是短时应用所导致，如：<br>（1）应用本身问题，导致反复重启<br>（2）应用通过exec调用了其他二进制程序，这些程序运行时间又比较短<br>2、使用top工具查看CPU时，还需要同时关注下其他参数，比如，运行的进程数<br>3、对perf工具有了近一步的实操；后续可以切换到Ubuntu再试下，有机会需要看下The<br>Flame Graph<br>4、execsnoop转为短时程序设计的工具，通过ftrace来实时监控exec()的行为；<br>5、接着实操的机会，顺便温习了下docker的一些简单命令。","like_count":1},{"had_liked":false,"id":45944,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1543823426,"is_pvip":false,"replies":[{"id":"16413","content":"strace可以跟踪系统调用，但没有统计功能。要跟踪的话需要使用动态追踪工具，比如bcc&#47;BPF、systemtap 等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543829690,"ip_address":"","comment_id":45944,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838790722","product_id":100020901,"comment_content":"如果是短时间内有大量进程在不断重启，每秒的fork调用应该很多，如果能监控到一段内都调用了哪些系统函数，同样的问题应该也能先出来吧，有这样的查看一段时间内系统函数调用情况的工具吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431283,"discussion_content":"strace可以跟踪系统调用，但没有统计功能。要跟踪的话需要使用动态追踪工具，比如bcc/BPF、systemtap 等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543829690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45750,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1543768708,"is_pvip":false,"replies":[{"id":"16296","content":"最好是先做性能分析，找出Nginx的瓶颈之后再优化","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543794326,"ip_address":"","comment_id":45750,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838736004","product_id":100020901,"comment_content":"曾经碰到CPU利用率很高，也知道是nginx造成的，整个团队都在优化，效果不理想啊","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431191,"discussion_content":"最好是先做性能分析，找出Nginx的瓶颈之后再优化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543794326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360494,"user_name":"Geek_b3b8da","can_delete":false,"product_type":"c1","uid":3065276,"ip_address":"浙江","ucode":"5461CD95B1D764","user_header":"","comment_is_top":false,"comment_ctime":1666602113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666602113","product_id":100020901,"comment_content":"我线上有一台服务器的su是僵尸进程而且在不断的死掉启动，我通过execsnoop 和pstree perf找到那个程序名字了，因为shell脚本不是我写的导致无法找到是那个程序调用了su一直在重启，而且用execsnoop 查看进程太多了很难判断哪些程序在不断的更换pid号","like_count":0},{"had_liked":false,"id":352374,"user_name":"龍蝦","can_delete":false,"product_type":"c1","uid":1000076,"ip_address":"","ucode":"BE1D500833F070","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","comment_is_top":false,"comment_ctime":1658593960,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658593960","product_id":100020901,"comment_content":"execsnoop 在 CentOS-8.5&#47;Rocky-8.6 （kernel 4.18）未能显示短时进程，根据 execsnoop 文件中的说明，应该是不支持比较新的内核的<br>https:&#47;&#47;github.com&#47;brendangregg&#47;perf-tools&#47;blob&#47;master&#47;execsnoop#L22:L23<br>This implementation is designed to work on older kernel versions, and without kernel debuginfo.","like_count":0},{"had_liked":false,"id":342227,"user_name":"Peter","can_delete":false,"product_type":"c1","uid":2425556,"ip_address":"","ucode":"5E57A0FE948966","user_header":"https://static001.geekbang.org/account/avatar/00/25/02/d4/1e0bb504.jpg","comment_is_top":false,"comment_ctime":1650114743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650114743","product_id":100020901,"comment_content":"CPU 升高是短时进程 stress 导致的  想问下短时进程是什么意思的啊？","like_count":0},{"had_liked":false,"id":340584,"user_name":"罗杰","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1648954394,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1648954394","product_id":100020901,"comment_content":"C++ 游戏服务器，每个进程上大概有一千用户的时候，CPU 就达到了 100%，找不到原因。用最笨的方法，加日志看那个函数调用最耗时，最后发现是在一个高频次的调用函数中处理会需要几百毫秒。经过一番分析，原来是 C++11 auto 惹的祸（也不能全怪 auto），auto 一时爽，但是没有意识到此处是有很大的拷贝成本，并非拷贝了指针（正确的操作就应该是拷贝指针，而不是拷贝这一块内存），而这块内存大概在 50KB 左右。修复完之后，单个服务的支持的用户超过 5000，CPU 都没超过 50%。","like_count":0},{"had_liked":false,"id":338002,"user_name":"智者夏末","can_delete":false,"product_type":"c1","uid":2598358,"ip_address":"","ucode":"0CFAB842980A93","user_header":"https://static001.geekbang.org/account/avatar/00/27/a5/d6/41967892.jpg","comment_is_top":false,"comment_ctime":1647227876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647227876","product_id":100020901,"comment_content":"对老师讲解和同学们的实践经历顶礼膜拜，自己还需要加强实践和学习理解啦","like_count":0},{"had_liked":false,"id":332050,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1642995714,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642995714","product_id":100020901,"comment_content":"老师，对于实时产生的进程，不知道其PID信息，该进程在启动之后，CPU飙升大概1秒然后降低，这种如何定位呢？","like_count":0},{"had_liked":false,"id":318895,"user_name":"🎉晶晶🎉😄","can_delete":false,"product_type":"c1","uid":1169422,"ip_address":"","ucode":"76B608C42E06A8","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/0e/1bf7f57a.jpg","comment_is_top":false,"comment_ctime":1635475378,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635475378","product_id":100020901,"comment_content":"centos下构建php-fpm的镜像时运行不了RUN apt-get update &amp;&amp; apt-get install -y stress &amp;&amp; apt-get clean，大家怎么解决的呢？","like_count":0},{"had_liked":false,"id":309828,"user_name":"咕咕咕","can_delete":false,"product_type":"c1","uid":1319375,"ip_address":"","ucode":"E939C1FD951235","user_header":"https://static001.geekbang.org/account/avatar/00/14/21/cf/f47e092d.jpg","comment_is_top":false,"comment_ctime":1630365566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630365566","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":309748,"user_name":"Geek_5227ac","can_delete":false,"product_type":"c1","uid":1607208,"ip_address":"","ucode":"8C468F5C45696E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKiay65IMyD82E59Xnbp370ChMG3N9XQuXoKwfhZJ19zotzKMlJhwzBDxE61bp26jdkf54NY9L41yg/132","comment_is_top":false,"comment_ctime":1630319588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630319588","product_id":100020901,"comment_content":"$ docker run --name nginx -p 10000:80 -itd feisky&#47;nginx:sp<br>$ docker run --name phpfpm -itd --network container:nginx feisky&#47;php-fpm:sp<br>老师，现在这里的镜像现在拉不下来了，地址变更了吗？","like_count":0},{"had_liked":false,"id":305572,"user_name":"Geek_aef4be","can_delete":false,"product_type":"c1","uid":2723576,"ip_address":"","ucode":"F1C3F2AE3CCA0F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epxppZUun6eqepI5hGHjU3fP8yVIicUq7gYRZfR3PoDCMQqd2ia8CmCSa1mIIf6OYGFjbW28RCXmrJQ/132","comment_is_top":false,"comment_ctime":1628052903,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1628052903","product_id":100020901,"comment_content":"我之前遇到过CPU％的情况。通过ps命令一下就找到了异常进程（后来才知道是挖矿程序），然后把他kill掉，但是过了一会这个进程又自动启动，然后就定位到这个进程所在文件，把文件删掉，以为就万事大吉了，结果过了一会又启动了，当时懵逼了。没办法，百度，才发现是挖矿程序，之所以文件删掉还能启动，是因为还有一个守护进程再监控，一旦进程被kill，他就在启动，进程文件被删，就自动去下载，然后再执行这个进程脚本。而服务器之所以被黑，就是因为redis服务没有设置密码，通过redis掌握了系统控制权","like_count":0,"discussions":[{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"草根","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540214,"discussion_content":"外网可以直接访问redis？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639992311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298908,"user_name":"愚公移山","can_delete":false,"product_type":"c1","uid":1487110,"ip_address":"","ucode":"395029049DCFFC","user_header":"https://static001.geekbang.org/account/avatar/00/16/b1/06/de844599.jpg","comment_is_top":false,"comment_ctime":1624365787,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624365787","product_id":100020901,"comment_content":"前面我们讲到过，ab（apache bench）是一个常用的 HTTP 服务性能测试工具，这里同样用来模拟 Nginx 的客户端。由于 Nginx 和 PHP 的配置比较麻烦，我把它们打包成了两个 Docker 镜像，这样只需要运行两个容器，就可以得到模拟环境  --这个需要下载吗?如何运行这个镜像<br><br>$ docker run --name nginx -p 10000:80 -itd feisky&#47;nginx:sp<br>$ docker run --name phpfpm -itd --network container:nginx feisky&#47;php-fpm:sp 这两个命令依赖什么文件吗?我已经在git下来原文件了，但不如何使用？<br>","like_count":0},{"had_liked":false,"id":298735,"user_name":"愚公移山","can_delete":false,"product_type":"c1","uid":1487110,"ip_address":"","ucode":"395029049DCFFC","user_header":"https://static001.geekbang.org/account/avatar/00/16/b1/06/de844599.jpg","comment_is_top":false,"comment_ctime":1624282253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624282253","product_id":100020901,"comment_content":"老师你好，为什么我第二次运行这个容器，运行不了root@100ask:&#47;home&#47;book#  docker run --name nginx -p 10000:80 -itd feisky&#47;nginx:sp<br>docker: Error response from daemon: Conflict. The container name &quot;&#47;nginx&quot; is already in use by container &quot;058dd0f37aa9db1297c4c0b51bb693a5cb8c4b843ffbb82855d5dd2620563031&quot;. You have to remove (or rename) that container to be able to reuse that name.<br>","like_count":0},{"had_liked":false,"id":297596,"user_name":"ywz","can_delete":false,"product_type":"c1","uid":2401841,"ip_address":"","ucode":"A93F43B3506FA9","user_header":"https://static001.geekbang.org/account/avatar/00/24/a6/31/0242f7d6.jpg","comment_is_top":false,"comment_ctime":1623659255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623659255","product_id":100020901,"comment_content":"老师，请问下perf抓出来的火焰图，用户空间找不到相应的栈回溯可能是什么原因导致的？","like_count":0},{"had_liked":false,"id":293826,"user_name":"dyh","can_delete":false,"product_type":"c1","uid":2039139,"ip_address":"","ucode":"4E20FDA64495C2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/1d/63/35c38c6c.jpg","comment_is_top":false,"comment_ctime":1621566468,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621566468","product_id":100020901,"comment_content":"execsnoop 这种有用的工具怎么在嵌入式设备上使用","like_count":0},{"had_liked":false,"id":290180,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1619420243,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619420243","product_id":100020901,"comment_content":"之前曾经出过cpu过高的问题,使用对应的top命令确定是jar运行后,利用ps命令确定了是哪个jar包,并使用jmap获取到了相关的堆栈信息,分析后发现是新开线程没有合理回收导致的","like_count":0},{"had_liked":false,"id":289586,"user_name":"August","can_delete":false,"product_type":"c1","uid":1538486,"ip_address":"","ucode":"72A0CB0C74CD35","user_header":"https://static001.geekbang.org/account/avatar/00/17/79/b6/98834766.jpg","comment_is_top":false,"comment_ctime":1619090271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619090271","product_id":100020901,"comment_content":"老师，centos6 一台64核cpu，256g内存，多个kworker和migration两个系统进程占cpu 百分百，会是什么问题呢？","like_count":0},{"had_liked":false,"id":284765,"user_name":"海丹丹","can_delete":false,"product_type":"c1","uid":2412456,"ip_address":"","ucode":"4901931CC85521","user_header":"https://static001.geekbang.org/account/avatar/00/24/cf/a8/6f511f02.jpg","comment_is_top":false,"comment_ctime":1616463899,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1616463899","product_id":100020901,"comment_content":"想记录一下最近遇到的问题，很多开发板上的系统是裁减过的，在利用Perf做测试时也会遇到好多问题。比如symbol只显示 地址不显示函数名， 还有一些功能不全。想办法解决中。。","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591495,"discussion_content":"参考地址https://www.cnblogs.com/luoahong/p/10833689.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666599087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284763,"user_name":"海丹丹","can_delete":false,"product_type":"c1","uid":2412456,"ip_address":"","ucode":"4901931CC85521","user_header":"https://static001.geekbang.org/account/avatar/00/24/cf/a8/6f511f02.jpg","comment_is_top":false,"comment_ctime":1616463736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616463736","product_id":100020901,"comment_content":"今天遇到了问题，嵌入式开发板上没有pstree，其实我也知道我们的软件模块底下，有500个左右子线程，但还是想试一下pstree。于是下载了psmisc的代码包，交叉编译成LSB elf，之前每次编译时执行autoreconf --ifv会导致最终编出来的包，不可知性，纯干瞪眼。 不敲这条就OK。还没去查。<br><br>anyway，跟着课程学的很开心~~","like_count":0},{"had_liked":false,"id":256866,"user_name":"志强","can_delete":false,"product_type":"c1","uid":1141536,"ip_address":"","ucode":"1C5DC9C7D70A82","user_header":"https://static001.geekbang.org/account/avatar/00/11/6b/20/004af747.jpg","comment_is_top":false,"comment_ctime":1603768575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603768575","product_id":100020901,"comment_content":"老师和各位大神们，请问有什么方式可以看到cpu实时在处理的任务数量(linux系统)","like_count":0},{"had_liked":false,"id":253655,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602819764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602819764","product_id":100020901,"comment_content":"打卡<br>碰到无法解释的cpu高问题，想想是不是短时进程导致<br>这个时候用top、vmstata、pidstat就找不到问题根源<br>可以考虑pstree查看下进程树，用perf或者execsnoop来记录分析短时进程","like_count":0},{"had_liked":false,"id":252976,"user_name":"ming","can_delete":false,"product_type":"c1","uid":2084718,"ip_address":"","ucode":"FF2C74CBA5E7BC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/6e/366a8247.jpg","comment_is_top":false,"comment_ctime":1602552390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602552390","product_id":100020901,"comment_content":"perf top是否只能在linux发行版上使用，如果是开发板，是否也可以通过perf top去排查问题","like_count":0},{"had_liked":false,"id":242913,"user_name":"Geek_8c2731","can_delete":false,"product_type":"c1","uid":1928194,"ip_address":"","ucode":"A87F938209D65A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkGGBK46EQpqE6zWCncMs14Jw95s191Y6pk3x3gQpNrvSc2YWoFEgUxmJWicibGp7XsFFKaZxuTSnA/132","comment_is_top":false,"comment_ctime":1597891108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597891108","product_id":100020901,"comment_content":"是我测试的服务器性能太强了么？ 咋压根没把它当回事情，负载不高，stress进程没看到，php-fpm top中也没发现","like_count":0},{"had_liked":false,"id":240935,"user_name":"🐮","can_delete":false,"product_type":"c1","uid":2112298,"ip_address":"","ucode":"3FAD9EA59E1713","user_header":"https://static001.geekbang.org/account/avatar/00/20/3b/2a/f05e546a.jpg","comment_is_top":false,"comment_ctime":1597125851,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1597125851","product_id":100020901,"comment_content":"倪老师，我这边有个现象，pidstst分析出某个线程占CPU很高，但使用perf去分析这个线程是里面热点函数没有很高的，最高也就3.5这个应该怎么继续分析啊","like_count":0,"discussions":[{"author":{"id":2112298,"avatar":"https://static001.geekbang.org/account/avatar/00/20/3b/2a/f05e546a.jpg","nickname":"🐮","note":"","ucode":"3FAD9EA59E1713","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298132,"discussion_content":"使用perf record记录分析也没有明显偏高的热点函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597201710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237274,"user_name":"Geek_e92fa6","can_delete":false,"product_type":"c1","uid":2015094,"ip_address":"","ucode":"36EE2386861098","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3FmianZ3EBmffWJFZkJ1VjLUWPIOKCicdblsg0Z37eGWajZ77JoM9WM5kN7zUpCoicMkSo4fgSM5KQ/132","comment_is_top":false,"comment_ctime":1595763888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595763888","product_id":100020901,"comment_content":"我按照老师的步骤试了一下，发现top并看不到stress进程的信息，可能还是要通过top和pstree综合看下觉得有问题的进程的吧，看来实际应用中的问题还要复杂得多。","like_count":0},{"had_liked":false,"id":236640,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595488135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595488135","product_id":100020901,"comment_content":"总结：<br>※ PID一直在变的原因：<br>① 进程不停崩溃重启<br>②应用内部通过exec调用的外部命令，短时间就结束，是短时进程。<br><br>※ 查找短时进程的父进程：pstree | grep [procname]<br>※ 短时进程监控工具execsnoop：<br>execsnoop 就是一个专为短时进程设计的工具。它通过 ftrace 实时监控进程的 exec() 行为，并输出短时进程的基本信息，包括进程 PID、父进程 PID、命令行参数以及执行的结果","like_count":0},{"had_liked":false,"id":232325,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1593958123,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1593958123","product_id":100020901,"comment_content":"top 时看不到 stress 进程记录，加上 i 也看不到。这是为什么呢？只看到 kworker 或 ksoftirqd 在 running","like_count":0},{"had_liked":false,"id":230272,"user_name":"柏森森","can_delete":false,"product_type":"c1","uid":1285420,"ip_address":"","ucode":"F370AD99BA71B9","user_header":"https://static001.geekbang.org/account/avatar/00/13/9d/2c/6248ffbd.jpg","comment_is_top":false,"comment_ctime":1593332629,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593332629","product_id":100020901,"comment_content":"用的是ubuntu16.04,然后制作make build的时候报错了，standard_init_linux.go:211 exec user process caused &quot;exec format error&quot;，应该怎么解决？<br>另外dockerI下载的话，需要在hub.docker上面注册一个账号吗？","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591494,"discussion_content":"切换docker的加速器地址为阿里就ok了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226035,"user_name":"Trident","can_delete":false,"product_type":"c1","uid":1609530,"ip_address":"","ucode":"53E6788CF33398","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/l4nngwyggBGqeMXC0micwO8bM1hSttgQXa1Y5frJSqWa8NibDhia5icwPcHM5wOpV3hfsf0UicDY0ypFqnQ3iarG0T1w/132","comment_is_top":false,"comment_ctime":1591932543,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591932543","product_id":100020901,"comment_content":"遇到过相同的问题，CPU飙高，各个进程占用比较少","like_count":0},{"had_liked":false,"id":224404,"user_name":"竹林","can_delete":false,"product_type":"c1","uid":1006947,"ip_address":"","ucode":"60E76BCE7AFE2C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/63/25fbd0be.jpg","comment_is_top":false,"comment_ctime":1591370028,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1591370028","product_id":100020901,"comment_content":"老师，我想问下，要是一台Linux服务器cpu会偶尔抖动一下，秒级监控(1s)能看到cpu有个峰值，不频繁，一天可能就出现一两次没有规律，用top -d 1 抓不到，用excesnoop由于进程多，每时每刻都会打出来很多进程也不好找。这种要如何定位是哪个进程导致的呢？有什么好办法吗？","like_count":0},{"had_liked":false,"id":219999,"user_name":"阿飞","can_delete":false,"product_type":"c1","uid":1298046,"ip_address":"","ucode":"F8B1FC8521264D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","comment_is_top":false,"comment_ctime":1590133628,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1590133628","product_id":100020901,"comment_content":"在我的环境(centos7.5)里使用top无法看到stress进程，其次docker主机里无法安装linux-tools。虽然在宿主机上执行per record 1分钟后，再用perf report分析也能看到stress调用占用比率很高，但既然能通过bindfs的方式把docker进程的用户空间挂载到目录中使用perf report来分析（https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;10833689.html），是否有别的方法可以把docker进程的调用链和环境也映射到宿主机来分析呢","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591493,"discussion_content":"参考这个https://www.cnblogs.com/luoahong/p/10833689.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217012,"user_name":"Yong","can_delete":false,"product_type":"c1","uid":1912653,"ip_address":"","ucode":"0ADA75C5C68619","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","comment_is_top":false,"comment_ctime":1589385177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589385177","product_id":100020901,"comment_content":"打卡：碰到非常规的cpu使用率较高的问题时，使用pstree 和execsnoop 分析一下","like_count":0},{"had_liked":false,"id":212970,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1588250888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588250888","product_id":100020901,"comment_content":"老师您好，<br>我在ubuntu 18.04, kernel版本 5.3.0-51-generic，使用execsnoop没有办法顺利抓到stress。请问可以怎么解决该问题呢？<br><br>谢谢老师的解答！","like_count":0},{"had_liked":false,"id":204609,"user_name":"田振宇","can_delete":false,"product_type":"c1","uid":1127162,"ip_address":"","ucode":"668341D1B4D9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/fa/990a6a58.jpg","comment_is_top":false,"comment_ctime":1586428919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586428919","product_id":100020901,"comment_content":"执行execsnoop，输出内容：<br>Tracing exec()s. Ctrl-C to end.<br>Instrumenting do_execve<br>   PID   PPID ARGS<br><br>然后就没有其他信息了，为啥别人的截图都能看到进程信息？<br>","like_count":0},{"had_liked":false,"id":183886,"user_name":"sierlu","can_delete":false,"product_type":"c1","uid":1449460,"ip_address":"","ucode":"3CBAB057E90FDA","user_header":"","comment_is_top":false,"comment_ctime":1583154858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583154858","product_id":100020901,"comment_content":"老师，服务器中部署了几个服务都在docker中，我用perf工具时，打印的信号都是16位地址信息，是不是需要进入到docker中使用perf工具？","like_count":0},{"had_liked":false,"id":180991,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582454382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582454382","product_id":100020901,"comment_content":"ab   pstree &#47; execsnoop   这些工具都是头一次用，不学不知道啊","like_count":0},{"had_liked":false,"id":179482,"user_name":"王金刚","can_delete":false,"product_type":"c1","uid":1813219,"ip_address":"","ucode":"FD8D6D19310DC7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq3fQlPJzwQRfpg2AlCpaD1znKGeBDX8D4JrJ6KJhuzonicU7FLNelZYDFQzsclNEcdVGzCSUKls3w/132","comment_is_top":false,"comment_ctime":1582013459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582013459","product_id":100020901,"comment_content":"老师在进行：ab -c 5 -t 600 http:&#47;&#47;192.168.0.10:10000&#47;操作后，结果：<br>%Cpu(s):  2.0 us, 13.3 sy, 80.9 ni,  3.4 id,  0.0 wa,  0.0 hi,  0.5 si,  0.0 st<br>ni的使用率比较到，这是为何》》","like_count":0},{"had_liked":false,"id":177322,"user_name":"Carey","can_delete":false,"product_type":"c1","uid":1295041,"ip_address":"","ucode":"D31D1ECFAE0027","user_header":"https://static001.geekbang.org/account/avatar/00/13/c2/c1/48785057.jpg","comment_is_top":false,"comment_ctime":1581346769,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581346769","product_id":100020901,"comment_content":"perf report 都是函数地址，怎么看到函数名？","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591492,"discussion_content":"1是在宿主机创建和容器内部一样的环境比较复杂，2是在宿主机外面执行完，然后把data那个文件负责进容器里面，在容器里面安装perf然后执行命令查看，具体参考https://www.cnblogs.com/luoahong/p/10833689.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174566,"user_name":"꯭小꯭凯꯭","can_delete":false,"product_type":"c1","uid":1335260,"ip_address":"","ucode":"AF96BE095507C9","user_header":"https://static001.geekbang.org/account/avatar/00/14/5f/dc/2a8440ed.jpg","comment_is_top":false,"comment_ctime":1580281082,"is_pvip":false,"discussion_count":0,"race_medal":3,"score":"1580281082","product_id":100020901,"comment_content":"我在本地的虚拟机上按照上面讲的做时，发现CPU使用率大概是 40%，Task任务中， running 状态的 一般就四五个，使用的指令是：ab -c 50 -n 1000000 http:&#47;&#47;192.168.194.150:10000&#47;  进行模拟。虚拟机 CPU是8核，硬盘是固态。 <br>","like_count":0},{"had_liked":false,"id":173573,"user_name":"linker","can_delete":false,"product_type":"c1","uid":1803259,"ip_address":"","ucode":"6C5799F2FC2C82","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","comment_is_top":false,"comment_ctime":1579599033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579599033","product_id":100020901,"comment_content":"如果知道父进程的话，可以用strace","like_count":0},{"had_liked":false,"id":172849,"user_name":"TTTTan","can_delete":false,"product_type":"c1","uid":1669818,"ip_address":"","ucode":"709B6AD19750A1","user_header":"https://static001.geekbang.org/account/avatar/00/19/7a/ba/2850504a.jpg","comment_is_top":false,"comment_ctime":1579334295,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579334295","product_id":100020901,"comment_content":"打卡<br>","like_count":0},{"had_liked":false,"id":171963,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1579058425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579058425","product_id":100020901,"comment_content":"D6 打卡","like_count":0},{"had_liked":false,"id":171812,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579017116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579017116","product_id":100020901,"comment_content":"补打卡，Day 5，碰到常规问题无法解释的 CPU 使用率情况时，首先要想到有可能是短时应用导致的问题。常用命令有：top、pidstat、ps、pstree、perf","like_count":0},{"had_liked":false,"id":159786,"user_name":"xdargs","can_delete":false,"product_type":"c1","uid":1063740,"ip_address":"","ucode":"EB8326D3A72DE5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoH9Mlw0kLK0p39vhQpdvkbQP5TX96DB9HMJ1POaTVDpMZg4rjlO3WCAqiaWWMc77ffS3vTo8qWdXA/132","comment_is_top":false,"comment_ctime":1575788776,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1575788776","product_id":100020901,"comment_content":"碰到非常规CPU问题时想到程序异常重启的情况，使用pstree和exexsnoop工具查看调用和记录短时进程信息","like_count":0},{"had_liked":false,"id":144370,"user_name":"黄展志","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1571905481,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571905481","product_id":100020901,"comment_content":"很赞，好想把所有的评论都看完，但还是先学习其它篇章，值得多看几遍","like_count":0},{"had_liked":false,"id":134353,"user_name":"Geek_e986e3","can_delete":false,"product_type":"c1","uid":1642716,"ip_address":"","ucode":"EF53D2DEA59A8F","user_header":"","comment_is_top":false,"comment_ctime":1568812014,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568812014","product_id":100020901,"comment_content":"这几篇看下来感觉pref和万金油一样 能分析各种cpu问题。还能顺带查找热点调用。老师我能这么理解吗？","like_count":0},{"had_liked":false,"id":132741,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1568209217,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568209217","product_id":100020901,"comment_content":"请问老师这个调用stress遇到的权限问题该怎么修复呢？","like_count":0},{"had_liked":false,"id":125647,"user_name":"18601611625","can_delete":false,"product_type":"c1","uid":1334444,"ip_address":"","ucode":"53D7412DCFD74C","user_header":"","comment_is_top":false,"comment_ctime":1566220240,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566220240","product_id":100020901,"comment_content":"老师，我在操作中发现您的docker image下载速度极慢，有什么建议吗？是否可以将镜像上传一份到daocloud<br>","like_count":0},{"had_liked":false,"id":119755,"user_name":"小苏","can_delete":false,"product_type":"c1","uid":1501618,"ip_address":"","ucode":"1A4776F948C6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/e9/b2/6a9203b5.jpg","comment_is_top":false,"comment_ctime":1564673541,"is_pvip":false,"replies":[{"id":"44403","content":"Java程序的分析请参考第14篇的答疑","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565015423,"ip_address":"","comment_id":119755,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564673541","product_id":100020901,"comment_content":"老师我写了一个测试程序java的 (cpu密集型): 命令:top -g -p 27476<br>    while (true) {<br>         Math.pow(RandomUtils.nextInt(100), RandomUtils.nextInt(100));<br>     }<br>cpu升上来了但是并没有明确的显示是由于计算次方也就是pow方法造成的<br>接下来我改如何用 perf  定位<br>+   67.60%     0.00%  perf-27476.map      [.] 0x00007f8de749930c                                                                                                                                           ▒<br>-   67.27%     0.90%  libjvm.so           [.] JVM_GetStackTraceElement                                                                                                                                     ▒<br>   - 11.07% JVM_GetStackTraceElement                                                                                                                                                                       ▒<br>      - 15.16% java_lang_Throwable::get_stack_trace_element                                                                                                                                                ▒<br>         - 23.20% java_lang_StackTraceElement::create                                                                                                                                                      ▒<br>            - 14.01% StringTable::intern                                                                                                                                                                   ▒<br>               + 9.21% StringTable::intern                                                                                                                                                                 ▒<br>                 3.22% UTF8::convert_to_unicode                                                                                                                                                            ▒<br>                 3.01% UTF8::unicode_length","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461056,"discussion_content":"Java程序的分析请参考第14篇的答疑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113577,"user_name":"少盐","can_delete":false,"product_type":"c1","uid":1305743,"ip_address":"","ucode":"BCC7E264B75702","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/8f/8299495a.jpg","comment_is_top":false,"comment_ctime":1563085372,"is_pvip":false,"replies":[{"id":"41983","content":"从 docker.io 上面下载镜像速度比较慢，一般多重试几次就可以了。当然，也可以试试国内的 Docker Registry Proxy，比如 http:&#47;&#47;mirror.azure.cn&#47;help&#47;docker-registry-proxy-cache.html","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563456835,"ip_address":"","comment_id":113577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563085372","product_id":100020901,"comment_content":"docker build -t feisky&#47;nginx:cpu -f Dockerfile.nginx .<br>Sending build context to Docker daemon  32.26kB<br>Step 1&#47;4 : FROM nginx<br>Get https:&#47;&#47;registry-1.docker.io&#47;v2&#47;: net&#47;http: TLS handshake timeout<br>Makefile:8: recipe for target &#39;build&#39; failed<br>make: *** [build] Error 1<br>为什么输入make build 出现这个错误","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458289,"discussion_content":"从 docker.io 上面下载镜像速度比较慢，一般多重试几次就可以了。当然，也可以试试国内的 Docker Registry Proxy，比如 http://mirror.azure.cn/help/docker-registry-proxy-cache.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563456835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109163,"user_name":"hadoop_admin","can_delete":false,"product_type":"c1","uid":1300466,"ip_address":"","ucode":"7EAFA775505C7E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGMphabeneYXs9otkAtr67RvxJClDa7jPe7w8yExg4YaS2FGJruDKMj5yN1E90o6MFibnicH8gM0ibg/132","comment_is_top":false,"comment_ctime":1561973364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561973364","product_id":100020901,"comment_content":"hadoop环境下的CPU问题比较难定位，思路后面可以借鉴下","like_count":0},{"had_liked":false,"id":103266,"user_name":"Butter Fly","can_delete":false,"product_type":"c1","uid":1564473,"ip_address":"","ucode":"D2B488B465FC3C","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/39/6ead11bc.jpg","comment_is_top":false,"comment_ctime":1560406589,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560406589","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":97511,"user_name":"Vincent","can_delete":false,"product_type":"c1","uid":1110967,"ip_address":"","ucode":"A14BA4C418315F","user_header":"https://static001.geekbang.org/account/avatar/00/10/f3/b7/d7377f0c.jpg","comment_is_top":false,"comment_ctime":1558686736,"is_pvip":false,"replies":[{"id":"34967","content":"请查询top的手册","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558793371,"ip_address":"","comment_id":97511,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558686736","product_id":100020901,"comment_content":"使用top时，如何只展示R状态的进程，或者按照状态排序也可以~","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451306,"discussion_content":"请查询top的手册","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558793371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86593,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1555405864,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555405864","product_id":100020901,"comment_content":"瞅的眼睛疼，瞅不见stress 不过perf report 到是看到了stress","like_count":0},{"had_liked":false,"id":85695,"user_name":"Warren","can_delete":false,"product_type":"c1","uid":1041381,"ip_address":"","ucode":"64A3C45BABC6A2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e3/e5/7b2586cb.jpg","comment_is_top":false,"comment_ctime":1555203335,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1555203335","product_id":100020901,"comment_content":"想跟老师确认下自己的理解，<br>1. cpu使用率高是因为大量stress进程使用了很多CPU，即使没有权限的问题，也会有高cpu的问题，对吗?<br>2. CPU使用率高跟很多stress进程的抢占和上下午切换有关系吗? ","like_count":0},{"had_liked":false,"id":82983,"user_name":"强友谅","can_delete":false,"product_type":"c1","uid":1475358,"ip_address":"","ucode":"C13F01A12D72A0","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/1e/bdc4f811.jpg","comment_is_top":false,"comment_ctime":1554365058,"is_pvip":false,"replies":[{"id":"30189","content":"这是DNS配置成了本地地址并且docker继承过去了。解决方法是升级Docker到最新版本，或者网络搜索127.0.0.53解决","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554638825,"ip_address":"","comment_id":82983,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554365058","product_id":100020901,"comment_content":"在做相关的实验，由于环境中存在代理。<br>1.make build报错无法拉取镜像Get https:&#47;&#47;registry-1.docker.io&#47;v2&#47;: dial tcp: lookup registry-1.docker.io on 127.0.0.53:53: read udp 127.0.0.1:40789-&gt;127.0.0.53:53: i&#47;o timeout<br>2.在vim &#47;lib&#47;systemd&#47;system&#47;docker.service中添加仍报该错误。<br>3.&#47;etc&#47;profile中通过export http_proxy=http:&#47;&#47;172.16.10.12:808<br>export https_proxy=http:&#47;&#47;172.16.10.12:808配置代理 ，wget www.baidu.com验证可通<br><br>4.一直纠结在我这种网络情况下如何欢畅的拖取镜像，官方文档也参照设置过，daocloud加速器也有尝试。<br>问题：请问现在的问题是docker仓库的问题，还是网络配置仍有问题？期望大牛的回答^_^<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445802,"discussion_content":"这是DNS配置成了本地地址并且docker继承过去了。解决方法是升级Docker到最新版本，或者网络搜索127.0.0.53解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554638825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79113,"user_name":"Geek_fce8cb","can_delete":false,"product_type":"c1","uid":1166928,"ip_address":"","ucode":"DCEFB11A493DD0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/S2RCl03ejxSqsShDO7uExD8AREBK5O4xroRXQMjBzFRtbEvcaGNKgIPlZJNBBa1C9QSXrhGFWtttukIAvrdoBQ/132","comment_is_top":false,"comment_ctime":1553354788,"is_pvip":false,"replies":[{"id":"29061","content":"ab是客户端，而stress是要分析的Web应用内部调用的。在应用程序里面调用外部的命令时，有的时候会导致性能问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553527013,"ip_address":"","comment_id":79113,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553354788","product_id":100020901,"comment_content":"老师，没太明白 这个分析app目录下调用了stress是啥意思，这不是用的ab命令测试的吗，怎么又扯上stress去了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444361,"discussion_content":"ab是客户端，而stress是要分析的Web应用内部调用的。在应用程序里面调用外部的命令时，有的时候会导致性能问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553527013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78055,"user_name":"梦回汉唐","can_delete":false,"product_type":"c1","uid":1321581,"ip_address":"","ucode":"9C66E35165F813","user_header":"https://static001.geekbang.org/account/avatar/00/14/2a/6d/0e436c1c.jpg","comment_is_top":false,"comment_ctime":1553064047,"is_pvip":false,"replies":[{"id":"28777","content":"watch的间隔时间是1s，1s内就结束的进程还是会漏掉","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553319593,"ip_address":"","comment_id":78055,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553064047","product_id":100020901,"comment_content":"查看瞬时进程，还可以用这个方法：<br><br>watch -n 1 -d &quot;ps -A -ostat,pid,ppid,cmd | grep -i &#39;^r&#39; | grep -v ps&quot;<br><br>下面是输出：<br><br>Every 1.0s: ps -A -ostat,pid,ppid,cmd | grep -i &#39;^r&#39; | grep -v ps       Wed Mar 20 02:39:50 2019<br><br>R+   13308 13307 &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1<br>R+   13313 13312 &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1<br>R+   13314 13311 &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1<br>R+   13319 13317 &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1<br>R+   13320 13318 &#47;usr&#47;local&#47;bin&#47;stress -t 1 -d 1","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443949,"discussion_content":"watch的间隔时间是1s，1s内就结束的进程还是会漏掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553319593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76640,"user_name":"Ignacio","can_delete":false,"product_type":"c1","uid":1130334,"ip_address":"","ucode":"AEAA24A58B6D29","user_header":"https://static001.geekbang.org/account/avatar/00/11/3f/5e/2fa1377d.jpg","comment_is_top":false,"comment_ctime":1552653709,"is_pvip":false,"replies":[{"id":"28064","content":"这应该是ipv6被禁止导致的，可以开启ipv6或者修改监听在 ipv4，比如listen = 0.0.0.0:9000","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552751003,"ip_address":"","comment_id":76640,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552653709","product_id":100020901,"comment_content":"[root@rhel7 ~]# docker logs 6117d3a95fda<br>[15-Mar-2019 12:33:07] ERROR: failed to create new listening socket: socket(): Address family not supported by protocol (97)<br>[15-Mar-2019 12:33:07] ERROR: FPM initialization failed<br>镜像都可以拉下来，nginx可以启动，php-fpm起不来。。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443386,"discussion_content":"这应该是ipv6被禁止导致的，可以开启ipv6或者修改监听在 ipv4，比如listen = 0.0.0.0:9000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552751003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":76587,"user_name":"Geek_00d753","can_delete":false,"product_type":"c1","uid":1253949,"ip_address":"","ucode":"2ED08B1A425994","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUP6ibuQssqJBNtQdSaFNhzzibdf7I3nyVGCeJPoDYqfsRndqRY19GpOJCOibMXQmOv2EchtHh0SXow/132","comment_is_top":false,"comment_ctime":1552635668,"is_pvip":false,"replies":[{"id":"28066","content":"这是正常的，不同的选项会影响gcc的编译过程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552751293,"ip_address":"","comment_id":76587,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552635668","product_id":100020901,"comment_content":"老师你好，C++的程序，perf record 加 &quot;-g&quot; 参数，会依赖于编译时开启-fno-omit-frame-pointer选项，我在编译的时候，同时加入-fno-omit-frame-pointer 和-ggdb3选项。但我通过 perf record -g 和perf record --call-graph dwarf抓出来的采样信息有很大的区别，两者生产的火焰图也不一样。请问这个是什么原因？同样的情况也使用于perf top中对&quot;-g&quot;的限定。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443364,"discussion_content":"这是正常的，不同的选项会影响gcc的编译过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552751293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75335,"user_name":"vvsuperman","can_delete":false,"product_type":"c1","uid":1021518,"ip_address":"","ucode":"F393A3FB894124","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/4e/2acbc3a8.jpg","comment_is_top":false,"comment_ctime":1552381060,"is_pvip":false,"replies":[{"id":"27486","content":"可以看到的，docker 内的进程在主机中都可以看到","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552399655,"ip_address":"","comment_id":75335,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1552381060","product_id":100020901,"comment_content":"登陆到docker环境中top看到的都是整个主机的信息，而不是docker自身的进程的信息，查看不到呀","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442866,"discussion_content":"可以看到的，docker 内的进程在主机中都可以看到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552399655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591487,"discussion_content":"docker的容器本身就是宿主机的一个进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72990,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1551772088,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551772088","product_id":100020901,"comment_content":"豁然开朗，感谢","like_count":0},{"had_liked":false,"id":70955,"user_name":"L33K","can_delete":false,"product_type":"c1","uid":1046063,"ip_address":"","ucode":"2F8E105F44E347","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/2f/d3f1dae6.jpg","comment_is_top":false,"comment_ctime":1551233114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551233114","product_id":100020901,"comment_content":"mark","like_count":0},{"had_liked":false,"id":70562,"user_name":"仙道","can_delete":false,"product_type":"c1","uid":1402218,"ip_address":"","ucode":"3F3B35929E08C9","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/6a/67f55083.jpg","comment_is_top":false,"comment_ctime":1551141531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551141531","product_id":100020901,"comment_content":"mark","like_count":0},{"had_liked":false,"id":70316,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1551072097,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551072097","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":68421,"user_name":"每日都想上班","can_delete":false,"product_type":"c1","uid":1060466,"ip_address":"","ucode":"1DE64120C8B14A","user_header":"https://static001.geekbang.org/account/avatar/00/10/2e/72/145c10db.jpg","comment_is_top":false,"comment_ctime":1550498245,"is_pvip":false,"replies":[{"id":"24376","content":"是不是快捷键设置的问题？我用的是 Ubuntu 自带的终端或者iterm","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570373,"ip_address":"","comment_id":68421,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1550498245","product_id":100020901,"comment_content":"老师，我用securecrt中远程linux，然后在里面运行perf top 后按上下键没有用，请问你们是用什么工具进行ssh的","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439668,"discussion_content":"是不是快捷键设置的问题？我用的是 Ubuntu 自带的终端或者iterm","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591486,"discussion_content":"xhell","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66968,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550049344,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550049344","product_id":100020901,"comment_content":"打卡，公司服务器上不能执行perf命令，有限制。回去自己搭环境再整一次吧","like_count":0},{"had_liked":false,"id":62219,"user_name":"让熊猫飞上天","can_delete":false,"product_type":"c1","uid":1348156,"ip_address":"","ucode":"7D6D349B6E3730","user_header":"https://static001.geekbang.org/account/avatar/00/14/92/3c/9116abf4.jpg","comment_is_top":false,"comment_ctime":1547986462,"is_pvip":false,"replies":[{"id":"22141","content":"谢谢分享实践经验","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548116761,"ip_address":"","comment_id":62219,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547986462","product_id":100020901,"comment_content":"我的系统是centos7.5，在安装老师这节的实验docker容器的时候，发现pull不下来，报如下错误：<br>[root@xuegod63 ~]# docker run --name nginx -p 10000:80 -itd feisky&#47;nginx:sp<br>Unable to find image &#39;feisky&#47;nginx:sp&#39; locally<br>sp: Pulling from feisky&#47;nginx<br>......<br>docker: error pulling image configuration: Get https:&#47;&#47;production.cloudflare.docker.com&#47;registry-v2&#47;docker&#47;registry&#47;v2&#47;blobs&#47;sha256&#47;91&#47;915c06c7382480f7f09e079a5668b14a30c945d0f92b520ff6ed772849046c06&#47;data?verify=1547988802-0w2CCTWkCUWJrCEvBPLV%2BZNygkc%3D: EOF.<br>See &#39;docker run --help&#39;.<br>后来在网上查看了一下，给出了如下的解决方法(我安装容器软件用的方式是curl -sSL https:&#47;&#47;get.docker.com&#47; | sh)所以在&#47;etc&#47;sysconfig&#47;下面没有那个docker的配置文件，我是直接新建的，把下面内容全部粘进去了，然后重启docker服务<br>参考这个网址上的内容https:&#47;&#47;www.cnblogs.com&#47;guyeshanrenshiwoshifu&#47;p&#47;9025104.html<br>就是上面的内容，然后再去执行docker run --name nginx -p 10000:80 -itd feisky&#47;nginx:sp就可以正常下载了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437140,"discussion_content":"谢谢分享实践经验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548116761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62213,"user_name":"让熊猫飞上天","can_delete":false,"product_type":"c1","uid":1348156,"ip_address":"","ucode":"7D6D349B6E3730","user_header":"https://static001.geekbang.org/account/avatar/00/14/92/3c/9116abf4.jpg","comment_is_top":false,"comment_ctime":1547985236,"is_pvip":false,"replies":[{"id":"22335","content":"网络错误，可以稍后再试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548251708,"ip_address":"","comment_id":62213,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547985236","product_id":100020901,"comment_content":"[root@xuegod63 ~]# docker run --name phpfpm -itd --network container:nginx feisky&#47;php-fpm:sp<br>Unable to find image &#39;feisky&#47;php-fpm:sp&#39; locally<br>sp: Pulling from feisky&#47;php-fpm<br>a02fbcf48e6b: Downloading [==&gt;                                                ]  916.6kB&#47;22.05MB<br>0fd90e182cc5: Pulling fs layer <br>554d282927ec: Pulling fs layer <br>805a76c208d2: Waiting <br>7815988b0b73: Waiting <br>5937bbd596b6: Waiting <br>eb60d700b9c1: Waiting <br>a1fc81bebde7: Waiting <br>a4ae4e49d6a5: Waiting <br>b71e96a90b11: Waiting <br>8ce6d254af53: Waiting <br>docker: error pulling image configuration: Get https:&#47;&#47;production.cloudflare.docker.com&#47;registry-v2&#47;docker&#47;registry&#47;v2&#47;blobs&#47;sha256&#47;65&#47;65aa1224020319c62d5f1045ecf096797ce0db3b895c4bf00d083a97e837bb3c&#47;data?verify=1547988073-3m6OqcKpNgL9ybEbjvlDHHK7p9w%3D: net&#47;http: TLS handshake timeout.<br>See &#39;docker run --help&#39;.<br>老师为什么试验用的镜像不能正常下载了呢？我的是CENTOS7的系统","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437139,"discussion_content":"网络错误，可以稍后再试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591485,"discussion_content":"你需要设置docker的加速器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59131,"user_name":"Yangjing","can_delete":false,"product_type":"c1","uid":1018061,"ip_address":"","ucode":"D88DFD4958D07C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/cd/2c3808ce.jpg","comment_is_top":false,"comment_ctime":1547303859,"is_pvip":true,"replies":[{"id":"21524","content":"默认命令应该是可以的，我在centos7和ubuntu18测试过。你的系统版本是什么？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547448451,"ip_address":"","comment_id":59131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547303859","product_id":100020901,"comment_content":"这里的 perf 命令是否有问题？ 实际使用的时候，发现 &quot;perf record -g&quot; 需要改为 &quot;perf record -ag&quot; 才能实际记录数据到 perf.data 文件。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436302,"discussion_content":"默认命令应该是可以的，我在centos7和ubuntu18测试过。你的系统版本是什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547448451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58299,"user_name":"closer","can_delete":false,"product_type":"c1","uid":1368990,"ip_address":"","ucode":"69F38480DF8491","user_header":"https://static001.geekbang.org/account/avatar/00/14/e3/9e/b26da70d.jpg","comment_is_top":false,"comment_ctime":1547029283,"is_pvip":false,"replies":[{"id":"21157","content":"请把具体的错误贴出来","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547125063,"ip_address":"","comment_id":58299,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1547029283","product_id":100020901,"comment_content":"perf record -g 执行不行，要求还要加参数，什么问题?谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435996,"discussion_content":"请把具体的错误贴出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547125063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591484,"discussion_content":"perf record -g -F 99 -p 进程的pid号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52722,"user_name":"speace","can_delete":false,"product_type":"c1","uid":1132600,"ip_address":"","ucode":"F068042179AFB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/38/2a4abf0a.jpg","comment_is_top":false,"comment_ctime":1545487650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545487650","product_id":100020901,"comment_content":"你好，execsnoop可以看到那些进程？在那些地方可以用到？为什么只显示一部分进程？","like_count":0},{"had_liked":false,"id":52248,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545354305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545354305","product_id":100020901,"comment_content":"mark ","like_count":0},{"had_liked":false,"id":52082,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1545306899,"is_pvip":false,"replies":[{"id":"18877","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545312455,"ip_address":"","comment_id":52082,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545306899","product_id":100020901,"comment_content":"lesson6打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433734,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545312455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50241,"user_name":"铁鸟","can_delete":false,"product_type":"c1","uid":1227710,"ip_address":"","ucode":"D89CDBEA75BD40","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/be/0f96379d.jpg","comment_is_top":false,"comment_ctime":1544931099,"is_pvip":false,"replies":[{"id":"18102","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004101,"ip_address":"","comment_id":50241,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544931099","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432924,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49126,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544607722,"is_pvip":false,"replies":[{"id":"17664","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660516,"ip_address":"","comment_id":49126,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544607722","product_id":100020901,"comment_content":"DAY6，打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432493,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48622,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1544498662,"is_pvip":false,"replies":[{"id":"17707","content":"嗯 不完全一致是正常的，展开行再看看调用栈","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662527,"ip_address":"","comment_id":48622,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544498662","product_id":100020901,"comment_content":"Samples: 319K of event &#39;cycles&#39;, Event count (approx.): 158249991282                                                                            <br>  Children      Self  Command          Shared Object                   Symbol                                                                  <br>+    5.78%     0.00%  php-fpm          libc-2.24.so                    [.] 0xffff80c6b4c1e2e1                                                  <br>+    5.78%     0.00%  php-fpm          [unknown]                       [.] 0x6cb6258d4c544155                                                  <br>+    5.56%     1.11%  stress           [kernel.kallsyms]               [k] async_page_fault                                                    <br>+    5.49%     5.49%  stress           libc-2.24.so                    [.] 0x0000000000036387                                                  <br>+    4.45%     0.04%  stress           [kernel.kallsyms]               [k] do_async_page_fault                                                 <br>+    4.42%     0.03%  stress           [kernel.kallsyms]               [k] trace_do_page_fault                                                 <br>为什么我perf report 的结果是这样                                           ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432279,"discussion_content":"嗯 不完全一致是正常的，展开行再看看调用栈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48612,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1544496368,"is_pvip":false,"replies":[{"id":"17847","content":"看起来还是没有抓取到数据，有没有看到警告信息？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746318,"ip_address":"","comment_id":48612,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1544496368","product_id":100020901,"comment_content":"perf record -g 得到的文件进行perf report的时候<br><br>遇到第一个问题：<br>[root@VM_0_5_centos ~]# perf report <br>WARNING: The perf.data file&#39;s data size field is 0 which is unexpected.<br>Was the &#39;perf record&#39; command properly terminated?<br>然后猜测是抓取的时间太长了，又缩短到了大概七八秒的样子<br><br>新的问题：<br>Samples: 16K of event &#39;cpu-clock&#39;, Event count (approx.): 4248000000                                                                                                                  <br>  Children      Self  Command  Shared Object  Symbol                                                                                                                                  <br>此处显示空白，什么都没有<br><br>请问老师，是什么原因呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432275,"discussion_content":"看起来还是没有抓取到数据，有没有看到警告信息？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591482,"discussion_content":"WARNING: The perf.data file&#39;s data size field is 0 which is unexpected.\nWas the &#39;perf record&#39; command properly terminated?这是告警信息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666598088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48042,"user_name":"wumin","can_delete":false,"product_type":"c1","uid":1297749,"ip_address":"","ucode":"419A9FDDC9636D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJSYNNABBxXCme5FMGUYTPbvnT6IvpzPP3qiaSibZficAfabydnwWOV6LlQ4lAtF0aeN3ficv0S3iavmxQ/132","comment_is_top":false,"comment_ctime":1544328773,"is_pvip":false,"replies":[{"id":"17853","content":"嗯嗯","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746850,"ip_address":"","comment_id":48042,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544328773","product_id":100020901,"comment_content":"make build后自动启动docker。docker run就不需要执行了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432000,"discussion_content":"嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47978,"user_name":"wumin","can_delete":false,"product_type":"c1","uid":1297749,"ip_address":"","ucode":"419A9FDDC9636D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJSYNNABBxXCme5FMGUYTPbvnT6IvpzPP3qiaSibZficAfabydnwWOV6LlQ4lAtF0aeN3ficv0S3iavmxQ/132","comment_is_top":false,"comment_ctime":1544276428,"is_pvip":false,"replies":[{"id":"17071","content":"两个虚拟机，这是为了避免ab干扰性能分析的过程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544311793,"ip_address":"","comment_id":47978,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544276428","product_id":100020901,"comment_content":"这里两个虚拟机是两个ubuntu的os，还是两个docker","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431968,"discussion_content":"两个虚拟机，这是为了避免ab干扰性能分析的过程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544311793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47733,"user_name":"shuifa","can_delete":false,"product_type":"c1","uid":1040063,"ip_address":"","ucode":"636733F5C88A7B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/bf/4df4224d.jpg","comment_is_top":false,"comment_ctime":1544188926,"is_pvip":false,"replies":[{"id":"17006","content":"下一篇得发布出来才能有链接😓 这些链接可能要事后才能加进来。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544192946,"ip_address":"","comment_id":47733,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1544188926","product_id":100020901,"comment_content":"又掌握新姿势了！问下，老师文章末尾能否加下上一篇和下一篇的链接呢，看其它专栏有这个，以为是app的功能呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431875,"discussion_content":"下一篇得发布出来才能有链接😓 这些链接可能要事后才能加进来。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544192946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47108,"user_name":"小强","can_delete":false,"product_type":"c1","uid":1294353,"ip_address":"","ucode":"154A18AD4028F3","user_header":"https://static001.geekbang.org/account/avatar/00/13/c0/11/3d59119f.jpg","comment_is_top":false,"comment_ctime":1544058918,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544058918","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":47083,"user_name":"Linux云计算网络","can_delete":false,"product_type":"c1","uid":1114062,"ip_address":"","ucode":"8E1F8B049D3C95","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/ce/73ee54bf.jpg","comment_is_top":false,"comment_ctime":1544052491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544052491","product_id":100020901,"comment_content":"mark","like_count":0},{"had_liked":false,"id":46710,"user_name":"卡卡","can_delete":false,"product_type":"c1","uid":1064855,"ip_address":"","ucode":"E696CC0386FA27","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/97/8d7a6460.jpg","comment_is_top":false,"comment_ctime":1543973241,"is_pvip":false,"replies":[{"id":"16773","content":"这里的意思是把容器内部的&#47;app目录拷贝到当前目录中。所以你就会在执行这条命令的目录中看到一个新的app目录","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544018743,"ip_address":"","comment_id":46710,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543973241","product_id":100020901,"comment_content":"docker cp phpfpm:&#47;app .<br>phpfpm:&#47;app 是什么？是一个文件吗？怎么确认是要进入到app？而不是别的地方？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431512,"discussion_content":"这里的意思是把容器内部的/app目录拷贝到当前目录中。所以你就会在执行这条命令的目录中看到一个新的app目录","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544018743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46677,"user_name":"阿巍-豆夫","can_delete":false,"product_type":"c1","uid":1005123,"ip_address":"","ucode":"732188848B0A85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1543970870,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543970870","product_id":100020901,"comment_content":"老师，我这里是个java应用，用top jstack追踪代码，发现cpu标高发生在一个动态字节码生成的类，然后这块是没有源码的，是不知道那一段函数的调用引起的。然后用perf top -v 可以发现这个应用，kernal _spin_lock 这个长期占用80%的cpu 我现在一点办法都没有，因为我不知道应用中那段程序使用了自旋锁，这个有什么办法追踪整个调用链呢？","like_count":0},{"had_liked":false,"id":46424,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1543922687,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543922687","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46402,"user_name":"Enterprize","can_delete":false,"product_type":"c1","uid":1215130,"ip_address":"","ucode":"3C120E9023B6C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg","comment_is_top":false,"comment_ctime":1543916350,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543916350","product_id":100020901,"comment_content":"就绪队列中居然有 6 个 Running 状态的进程（6 running），是不是有点多呢？<br><br>请教下这个 running 多少是怎么看的呢？谢谢","like_count":0},{"had_liked":false,"id":46202,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1543884528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543884528","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46145,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1543853705,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543853705","product_id":100020901,"comment_content":"D6","like_count":0},{"had_liked":false,"id":46092,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1543844960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543844960","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46061,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543840391,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543840391","product_id":100020901,"comment_content":"execsnoop这个命令执行第一次，确实发现了好多stress进程；<br>但是后面再执行的话就不行了<br>","like_count":0},{"had_liked":false,"id":46041,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543838284,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543838284","product_id":100020901,"comment_content":"请问老师execsnoop这个工具是要装google的perf-tools吗？","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540982,"discussion_content":"是的  \n#下载execsnoop#\n1 cd /usr/bin\n2 wget https://raw.githubusercontent.com/brendangregg/perf-tools/master/execsnoop\n3 chmod 755 execsnoop\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640225228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46019,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1543834217,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543834217","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46018,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1543834198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543834198","product_id":100020901,"comment_content":"打卡day07","like_count":0},{"had_liked":false,"id":45997,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1543829822,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543829822","product_id":100020901,"comment_content":"*.execsnoop这个工具莫非是Ubuntu独有的？我放狗都没法找到CentOS下如何安装<br>*我用perf top对MySQL检测的时候发现了一个奇怪的现象，单独用perf top命令，和使用perf top -p命令独自针对mysql的进程时，显示的CPU占用率最高的函数，是不一样的，比如perf top时显示的mysql占用cpu最高的函数是row_search_mvcc。perf top -p命令显示的函数名称却是do_command。这如何解释？","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591481,"discussion_content":"execsnoop这个工具有2种方法一是升级内核2是https://github.com/brendangregg/perf-tools","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666597837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45967,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1543826163,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543826163","product_id":100020901,"comment_content":"看到其他的小伙伴的留言，也跟我一样的遇到问题了，希望老师能集中解答下","like_count":0},{"had_liked":false,"id":45966,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1543826115,"is_pvip":false,"replies":[{"id":"16414","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部再执行 perf report 来分析。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543829829,"ip_address":"","comment_id":45966,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543826115","product_id":100020901,"comment_content":"老师，我按照你的操作没有看到调用的函数，难道是系统问题或者是软件版本问题，你能给个邮箱吗，我把问题截图和描述发给你，这里面说不清楚","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431292,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部再执行 perf report 来分析。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543829829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45889,"user_name":"饼子","can_delete":false,"product_type":"c1","uid":1085953,"ip_address":"","ucode":"981A44836A5216","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/01/c723d180.jpg","comment_is_top":false,"comment_ctime":1543813146,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543813146","product_id":100020901,"comment_content":"一般都是找到有问题的进程，然后ps找到对应的PPID","like_count":0},{"had_liked":false,"id":45886,"user_name":"花似雾中看","can_delete":false,"product_type":"c1","uid":1317682,"ip_address":"","ucode":"D9979D86CB7AD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/32/467683eb.jpg","comment_is_top":false,"comment_ctime":1543812156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543812156","product_id":100020901,"comment_content":"mark！","like_count":0},{"had_liked":false,"id":45883,"user_name":"末班车","can_delete":false,"product_type":"c1","uid":1335855,"ip_address":"","ucode":"FC7A7AB51A9C8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/62/2f/bb04ae52.jpg","comment_is_top":false,"comment_ctime":1543811168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543811168","product_id":100020901,"comment_content":"打卡，打卡，猜到了，但没有下手的方法，学到了","like_count":0},{"had_liked":false,"id":45847,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543803212,"is_pvip":false,"replies":[{"id":"16424","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部再执行 perf report 来分析。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543831628,"ip_address":"","comment_id":45847,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1543803212","product_id":100020901,"comment_content":"day7打卡，上一节中遗留问题<br>perf top -p -g pid 无法定位到sqrt函数，老师有时间解答下，谢谢🙏","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431237,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部再执行 perf report 来分析。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543831628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591480,"discussion_content":"可以在宿主机运行perf把结果拷贝进容器里面去安装perf然后查看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666597765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45846,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1543803209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543803209","product_id":100020901,"comment_content":"[D6打卡]<br>又学了个乖。<br>虽然前面猜到了可能是短时进程，但是没想到居然有专用工具来分析。<br>要是以前,可能会傻傻的多刷几次ps aufx，然后找这些临时进程的父pid，而不会直接用pstree了。<br>目前几个测试环境比较简单，只需要一个虚拟机即可，另一个直接在物理机上用ab命令，或者在物理机上装docker。","like_count":0},{"had_liked":false,"id":45832,"user_name":"C","can_delete":false,"product_type":"c1","uid":1171389,"ip_address":"","ucode":"74B4B21EA7D0C3","user_header":"https://static001.geekbang.org/account/avatar/00/11/df/bd/46614a70.jpg","comment_is_top":false,"comment_ctime":1543801596,"is_pvip":false,"replies":[{"id":"16425","content":"谢谢，加油👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543831647,"ip_address":"","comment_id":45832,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543801596","product_id":100020901,"comment_content":"今天内容给力呢，多认识两个新工具，给老师点赞","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431228,"discussion_content":"谢谢，加油👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543831647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45823,"user_name":"付盼星","can_delete":false,"product_type":"c1","uid":1055542,"ip_address":"","ucode":"E0E4B74E8B361F","user_header":"https://static001.geekbang.org/account/avatar/00/10/1b/36/abe6d066.jpg","comment_is_top":false,"comment_ctime":1543800642,"is_pvip":false,"replies":[{"id":"16434","content":"这个问题跟今天的案例有点类似，需要找出这些进程的父进程，把父进程清理掉。<br><br>我的建议是两个思路：<br><br>1. 跟本文类似，用类似execsnoop的方法跟踪fork调用，定位出父进程，再把它清理掉<br>2. 重装系统<br><br>我更推荐重装系统，因为即使定位出来这些进程的根源，也不能确保其他地方就没有被感染。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543832444,"ip_address":"","comment_id":45823,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543800642","product_id":100020901,"comment_content":"老师好，之前就遇到过一次短进程的问题导致cpu使用率过高，因为我们发布应用用的是容器，把重启策略设置为always，结果容器启动时候调用java -jar 启动应用，因为配置原因，无法启动，然后它就不停启动，现象是cpu使用率过高，好在用top能发现，毕竟进程一直在。不过还有个场景就比较难搞了，系统被入侵，不停启动进程消耗资源，你杀掉之后，它又启动新的进程，pid也不同，这种情况，有处理办法么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431220,"discussion_content":"这个问题跟今天的案例有点类似，需要找出这些进程的父进程，把父进程清理掉。\n\n我的建议是两个思路：\n\n1. 跟本文类似，用类似execsnoop的方法跟踪fork调用，定位出父进程，再把它清理掉\n2. 重装系统\n\n我更推荐重装系统，因为即使定位出来这些进程的根源，也不能确保其他地方就没有被感染。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543832444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45819,"user_name":"一禅小和尚","can_delete":false,"product_type":"c1","uid":1182806,"ip_address":"","ucode":"5A2A0875DE062A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/56/02fba09b.jpg","comment_is_top":false,"comment_ctime":1543800000,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543800000","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45818,"user_name":"一禅小和尚","can_delete":false,"product_type":"c1","uid":1182806,"ip_address":"","ucode":"5A2A0875DE062A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/56/02fba09b.jpg","comment_is_top":false,"comment_ctime":1543799999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543799999","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45786,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1543796455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543796455","product_id":100020901,"comment_content":"打卡，day7<br>笔记：当cpu使用率高，但用top等常规工具，观察进程使用率并不高时，要优先考虑现有进程启动的一些瞬时进程，此类进程执行周期短，不易察觉，进程自身有可能因为逻辑或内部错误引发cpu占用高<br>工具：perf统计一段时间内的性能报告，或execsnoop(可查看到瞬时进程的信息)进行分析","like_count":0},{"had_liked":false,"id":45779,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1543795248,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543795248","product_id":100020901,"comment_content":"打卡","like_count":0}]}