{"id":596369,"title":"24｜工程化与团队协作：让我们合作开发一个大型React项目","content":"<p>你好，我是宋一玮，欢迎回到React应用开发的学习。</p><p>前面我们用两节课的时间，学习了大中型React项目最重要的实践之一：自动化测试。我们先后学习了如何利用Playwright框架开发自动化E2E测试用例，以及如何用Jest + RTL为React组件和Hooks编写单元测试。</p><p>我们也通过对测试金字塔概念的学习，理解了E2E和单元测试互为补充的关系，认识到可以在项目中同时加入这两种自动化测试用例，来提高整体覆盖率、提升项目质量。</p><p>这节课是模块三，也是这个专栏的最后一节正课内容。我会带着你总结一下前面学习过的知识点，然后把它们串联起来，介绍大型React应用项目中的团队协作和工程化。</p><p>最后还有一个特别企划。这个专栏其实在立项之初，就设计了一小一大两个React项目，其中的小项目就是模块二的 <code>oh-my-kanban</code> 。相信你对它印象深刻，毕竟我基本每节课都会像写字楼电梯间的洗脑广告一样，反复提到它。</p><p>那么大项目呢？这不，马上就来了：我会新搭建一个开源React项目，在其中设计一系列扩展点，然后请你跟我一起，合作开发这个大型React项目。</p><p>下面开始这节课的内容。</p><h2>本专栏的知识地图</h2><p>如果你是从第一节课开始，按课程连载顺序一节一节学到这里，那么你应该会发现，这个专栏跟市面上其他教程有些许不同：</p><!-- [[[read_end]]] --><p>首先，本专栏从课程设计上，采用了学习曲线的变体——<strong>螺旋学习曲线</strong>（<a href=\"https://time.geekbang.org/column/article/562726?\">第6节课</a>），即：学习技术表层 → 学习技术底层 → 回过头来理解表层 → 继续学习更多表层 → 底层 → …如此往复… → 掌握技术。</p><p><img src=\"https://static001.geekbang.org/resource/image/3f/0c/3ff89382512d88101f28821a52d5980c.jpg?wh=1920x1089\" alt=\"图片\"></p><p>其次，在内容上，本专栏极力避免单纯的技术点罗列，而是强调与技术点相关的<strong>逻辑</strong>，包括React从旧版到新版发生变化的逻辑、React技术点与背后的前端领域知识间的逻辑，还有为React项目引入各种现代工程化技术和实践的逻辑。这样设计的好处，可以帮你加深理解，让学习到的知识真正转化成自己的能力。</p><p>但如果万一，比如你的朋友是从课程中间开始学起的，他/她有可能需要花些功夫来适应这个专栏的节奏。</p><p>一是为了带着你复习，二是为了帮助你的朋友尽快融入这个专栏，我总结了一份本专栏专用的<strong>知识地图</strong>，放在这里供你们参考。</p><p><img src=\"https://static001.geekbang.org/resource/image/34/ea/34407fa71e327d54a0d3d16f8b75ddea.jpg?wh=1920x987\" alt=\"图片\"></p><h2>前端团队的分工协作</h2><p>前面一直提到“团队协作开发大中型React应用项目”，并不是说一个人就没办法独立开发大中型React应用项目，而更多是从软件工程角度探讨开发效率和效果。</p><p>现代软件开发的<strong>任务拆解（WBS）<strong>和</strong>迭代计划（Iteration Plan）</strong>，都无法脱离具体技术存在。</p><p>比如，正因为React技术支持组件拆分，按组件分配工作任务才是可行的。先有若干工作任务，再分派给开发团队成员，这样大家就可以齐头并进、并行不悖了。</p><p>在团队人力不足的情况下，每位团队成员往往会被分派到多个工作任务；极端情况下，团队如果只有一人，那这一个人就会接手所有工作任务，但这并不会否定工作任务拆分的价值，它依旧是制定开发计划的基础。</p><p>在上面的知识地图中，有一列是“在大中型React项目中的相关实践”，里面很多内容都与团队协作相关。</p><p>当团队规模大于等于2人时，分工可以考虑横向和纵向分工。<strong>横向分工是按业务功能分派工作任务</strong>，<strong>纵向则是按应用架构层次分派工作任务</strong>。在真实项目中，往往是结合这两种方式来分工的。</p><p>这里用<a href=\"https://time.geekbang.org/column/article/580893\">第20节课</a>中的“按业务功能划分为主，结合按组件、按文件职能的方式，划分”的文件目录结构作为线索，举一个横向加纵向分工的例子。团队一共6人， <code>#</code> 号后面是团队成员的名字：</p><pre><code class=\"language-bash\">src\n├── components\n│   ├── Button           # 小花\n│   ├── Dialog           # 大壮\n│   ├── ErrorBoundary    # 大壮\n│   ├── Form             # 小花\n│   ├── ...\n│   └── Tooltip          # 小花\n├── context\n│   ├── ...\n│   └── UserContext.js   # 阿强\n├── features\n│   ├── admin            # 小黑\n│   ├── dashboard        # 小黑\n│   │   ├── activies     # 小白\n│   │   ├── charts       # 大壮\n│   │   ├── news         # 小黑\n│   │   ├── ...\n│   │   └── index.js     # 小黑\n│   ├── kanban           # 小白\n│   ├── home             # 阿珍\n│   ├── login            # 阿强\n│   ├── ...\n│   └── user             # 阿强\n├── hooks\n│   ├── ...\n│   └── useLocation.js   # 阿珍\n└── servies\n    ├── kanbanService.js # 小白\n    ├── ...\n    └── userService.js   # 阿强\n</code></pre><p>我们大都希望团队协作的开发效率是 <code>1 + 1 &gt; 2</code> ，只要产品需求、工作分配、团队人员别掉链子，这相对还是容易达到的。</p><p>但要注意，随着团队规模的扩大， <code>1 + 1 + 1 &gt; 3</code> 、 <code>1 + 1 + 1 + 1 &gt; 4</code> 这样线性的效率提升会越来越难做到。究其原因，还是人。<strong>人是团队最大的财富，也是最大的变量</strong>。团队成员间沟通顺畅、配合默契，每位成员也具备相当的开发能力、发挥稳定，团队协作才能更有效，反之，项目开发就会出问题。</p><p>现代软件项目的工程化实践，可以为团队提供助力，减小包括人在内的不稳定因素的影响，最大化地保证团队整体稳定输出。</p><h2>现代大型React项目的工程化</h2><p>我们在前面<a href=\"https://time.geekbang.org/column/article/574579\">第14节课</a>里，已经介绍过一部分适用于React项目的现代工程化技术。这里我们会从更宏观一些的层面，介绍现代大型React项目的工程化。</p><p>首先，我们来一块看一下大型React项目工程化的目标和要点。</p><p><strong>1.项目、团队可扩展</strong>。</p><p>在项目开发过程中，可以根据需要，相对灵活地在项目代码中加入新功能，也可以无缝地在团队中加入新的成员，这样的项目，才有可能成为健康的项目。</p><p><strong>2.简化开发流程，缩短迭代周期</strong>。</p><p>比起早期的瀑布式开发，敏捷开发是更加轻流程的。无论是流程推动人，还是人推动流程，都需要让流程更加优化，减少资源的浪费。</p><p><strong>3.减少重复性工作，降低人为出错可能性</strong>。</p><p>还是我一贯的观点，人会出错，不用避讳。比起每次出错时把精力放在甩锅上，倒不如在容易出错的地方引入自动化，减少人的参与。节省出来的精力，可以投入到更具有创造性的工作上。</p><p><strong>4.贯彻团队约定，统一标准</strong>。</p><p>根据2020年中国青年报发起的调研，我国年轻人有40%以上自称“社恐”。这与我观察到的现象类似：软件工程师里年轻人居多，确实不少年轻工程师不愿意在例会上主动发言。</p><p>但项目开发需要整个团队的工作符合一定标准，对项目建立一定共识。比如代码缩进是Tab还是空格，是2个空格还是4个空格；再比如新提交的代码测试覆盖率必须达到80%以上还是90%以上，等等。不愿交流怎么建立共识呢？鼓励大家改善社恐的同时，工程化实践也可以替“沉默的大多数”发声。</p><p><strong>5.权责清晰，变更可追溯</strong>。</p><p>你可能会说：“刚说完不鼓励甩锅，这马上就强调工程化可以作为甩锅利器。”其实不是这样，可追溯首先还是帮助降低项目长期的成本和风险。</p><p>比如产品上线发现Bug，需要回退，要确定回退的目标版本吧？这样做可以使权责清晰，也确保了没有“三不管”的代码，整个项目的代码就都是可控的。消极来说，当所有人甩锅都变得如此简单，那甩锅也就不是什么需要花心思培养的特技了。</p><p>大型React项目的工程化贯穿了整个软件生命周期，下图来自于<a href=\"https://time.geekbang.org/column/article/576221\">直播加餐01</a>：</p><p><img src=\"https://static001.geekbang.org/resource/image/36/cf/369180yy88dc4f82379825b026a322cf.jpg?wh=1059x619\" alt=\"图片\"></p><p>从上图的第3阶段开发阶段开始，工程化会覆盖多个环境：</p><ul>\n<li>本地开发环境。<a href=\"https://time.geekbang.org/column/article/574579\">第14节课</a>介绍的工程化实践基本都体现在这个环境中，与开发者密切相关；</li>\n<li>持续集成环境。一般而言企业里会为CI/CD搭建专门的服务器，常见的软件比如Jenkins。CI Pipeline常会运行在虚拟机或者Docker里。团队多位开发者的工作成果将汇聚到这里；</li>\n<li>测试环境。这里部署的产品服务会被用来跑E2E测试或其他人工测试；</li>\n<li>生产环境或准生产环境。在部分企业，线上监控、报警也被视为工程化的一部分；</li>\n<li>用户浏览器环境。生产环境的特殊组成部分。</li>\n</ul><h2>开源React项目oh-my-kit</h2><p>我们课程的收官大项目名字就叫 <code>oh-my-kit</code>（哦我的工具箱），嗯，我给项目起名字的水平也就这样了（摊手）。</p><p>在紧张的工作学习过程中，你经常需要用到一些提升自己效率的工具，而这些工具经常分散在各个地方，比如手机App、小程序、PC软件、某个网页，而且它们的体验也参差不齐，相互间也缺乏连通性。<strong>《哦我的工具箱》是一款集（duī）成（qì）了大量生产力工具的桌面Web应用软件，可以通过便捷的导航，轻松访问到趁手的、体验一致的工具</strong>。</p><p>JS开源社区是非常活跃的，我相信你之前即使没有参与过开源项目的开发，也应该看过不少开源框架或开源库的网站和代码仓库了。<strong>开源软件是软件开发领域最伟大的创举之一</strong>，这里我们不去揣测开源项目后面经济利益之类的动机，单从结果来看，开源推动了软件行业的共同进步，也成就了许多团体和个人。</p><p>我们的 <code>oh-my-kit</code> 项目会作为<strong>开源项目</strong>托管在Gitee上。一开始会由我来搭建项目的脚手架，加入并维护通用模块：</p><p><img src=\"https://static001.geekbang.org/resource/image/70/2f/70ed6e697ded831939a7d41255c9632f.png?wh=1164x1694\" alt=\"图片\"></p><pre><code class=\"language-bash\">├── dist&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 发布目录\n├── docs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 文档目录\n│&nbsp; &nbsp;├── diagrams&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 文档中的图表目录\n│&nbsp; &nbsp;└── architecture.md&nbsp; &nbsp;# 此文档\n├── public&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 静态资源目录\n│&nbsp; &nbsp;├── mock&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 模拟远程数据目录\n│&nbsp; &nbsp;└── vite.svg\n├── src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 源代码目录\n│&nbsp; &nbsp;├── components&nbsp; &nbsp; &nbsp; &nbsp; # 公共组件目录，通过 #components/* 导入\n│&nbsp; &nbsp;├── context&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 公共React context目录\n│&nbsp; &nbsp;├── features&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 功能模块目录\n│&nbsp; &nbsp;│&nbsp; &nbsp;├── App&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 主体布局模块\n│&nbsp; &nbsp;│&nbsp; &nbsp;├── Example&nbsp; &nbsp; &nbsp; &nbsp;# 例子模块\n│&nbsp; &nbsp;│&nbsp; &nbsp;├── Home&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 首页模块\n│&nbsp; &nbsp;│&nbsp; &nbsp;└── Routes.tsx&nbsp; &nbsp; # 模块路由集中配置文件\n│&nbsp; &nbsp;├── hooks&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 公共React Hooks目录，通过 #hooks/* 导入\n│&nbsp; &nbsp;│&nbsp; &nbsp;└── useService.ts # 远程服务Hook\n│&nbsp; &nbsp;├── services&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 远程服务目录\n│&nbsp; &nbsp;└── types&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 公共Types定义目录，通过 #types/* 导入\n├── index.html\n├── package.json\n├── tsconfig.json&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TypeScript配置\n├── tsconfig.node.json\n└── vite.config.ts&nbsp; &nbsp; &nbsp; &nbsp; # Vite配置\n</code></pre><p>也会配置对应的CI/CD，将发行版部署在Gitee Pages上：</p><p><img src=\"https://static001.geekbang.org/resource/image/7y/af/7yy1caf90fd70f0934d7eb21d3474faf.gif?wh=1200x580\" alt=\"图片\"></p><p>同时我会为 <code>oh-my-kit</code> 项目加入产品路线图（Roadmap）和轻量级的产品需求文档（PRD），也会在代码中设置一系列扩展点，为这些需求留出位置：</p><p><img src=\"https://static001.geekbang.org/resource/image/da/64/da83013b3c9c90b639c5765ecf3f5064.png?wh=1920x1302\" alt=\"图片\"></p><p>接下来我会请你认领其中的产品需求。你将Fork代码仓库，拉出你自己的功能分支，编写代码实现需求，然后提交<strong>拉取请求（Pull Request）</strong>。</p><p>我会定期对拉取请求做代码评审，通过评审和测试的代码，会被合并到主代码仓库中，并最终在Gitee Pages部署新版。希望通过这样的方式，在你练手的同时，也能保证项目具备一定的质量，让 <code>oh-my-kit</code> 成为一款基本可用的开源Web应用。</p><p>该项目也会参考一些成功开源项目的维护方式，欢迎你和你的朋友们提出Issue，我们会根据优先级做迭代计划。</p><p>目前的服务器端我会采用<strong>模拟（Mock）<strong>方式，但也会尽量利用</strong>浏览器存储</strong>来满足一部分持久化的需求。当项目具有一定规模时，会根据大家的反馈，决定是否加入真实的服务器端。</p><p>开源项目的URL是：</p><p><a href=\"https://gitee.com/evisong/geektime-column-oh-my-kit\">https://gitee.com/evisong/geektime-column-oh-my-kit</a></p><h2>小结</h2><p>好的，到这里本专栏的正课内容就告一段落了。</p><p>这节课我们用知识地图的方式，复习了前面课程的大部分知识点，介绍了前端团队在大型React项目中横向和纵向的分工方法。也从宏观层面介绍了现代大型React项目工程化的目标，以及工程化过程中包含的几个环境。最后，我们约好，在新建的开源React项目 <code>oh-my-kit</code> 中协作开发，实践整个专栏所学。</p><p>这节课没有思考题，非常欢迎你提交代码。</p><p>我们下节课结束语再见。</p>","neighbors":{"left":{"article_title":"23｜质量保证（下）：测试金字塔与React单元测试","id":595456},"right":{"article_title":"加餐01｜留言区心愿单：真·子组件以及jsx-runtime","id":572534}},"comments":[{"had_liked":false,"id":360705,"user_name":"东方奇骥","can_delete":false,"product_type":"c1","uid":1354850,"ip_address":"北京","ucode":"DEE7085F7E55A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/62/37912d51.jpg","comment_is_top":false,"comment_ctime":1666769946,"is_pvip":true,"replies":[{"id":"131286","content":"你好，东方奇骥，久等啦，开源项目的地址在这里： <br><br>    https:&#47;&#47;gitee.com&#47;evisong&#47;geektime-column-oh-my-kit <br><br>稍后也会请编辑更新到正文中。有任何意见或建议请随时留言，谢谢～","user_name":"作者回复","comment_id":360705,"uid":"1033973","ip_address":"北京","utype":1,"ctime":1666954106,"user_name_real":"编辑"}],"discussion_count":1,"race_medal":0,"score":"1666769946","product_id":100119601,"comment_content":"老师，文中没有开源项目的地址呢，后续会更新？","like_count":1,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"宋一玮","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591955,"discussion_content":"你好，东方奇骥，久等啦，开源项目的地址在这里： \n\n    https://gitee.com/evisong/geektime-column-oh-my-kit \n\n稍后也会请编辑更新到正文中。有任何意见或建议请随时留言，谢谢～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666954107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}