{"id":161802,"title":"80 | 更高级的抽象：Cocoa Operation","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":279332,"user_name":"Geek_462d99","can_delete":false,"product_type":"c3","uid":1483085,"ip_address":"","ucode":"856996824B91C3","user_header":"https://static001.geekbang.org/account/avatar/00/16/a1/4d/107d8201.jpg","comment_is_top":false,"comment_ctime":1613722936,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"我自定义继承Operation类之后，然后下载图片之后FPS会非常低，请问此时对于一些耗时操作的应该在什么时机调用比较好？代码如下：\n\n```\nclass OperationManager: Operation {\n    var imgURL: String = String()\n    \n    init(with imgURL: String?) {\n        super.init()\n        self.imgURL = imgURL ?? String()\n    }\n    \n    \n    func downImg(closures: @escaping (_ image: UIImage?) -&gt; Void) {\n        guard let img = DownloaderManager.downloadImageWithURL(self.imgURL) else {\n            return\n        }\n        closures(img)\n    }\n}\n```\n\n这是调用的代码：\n\n```\nlet queue = OperationQueue()\nfor (index, imgurl) in DownloaderManager.imageArray.enumerated() {\n let operation = OperationManager(with: imgurl)\n            operation.downImg { (image) in\n                OperationQueue.main.addOperation {\n                    girlsImg.image = image\n                }\n            }\n            operation.completionBlock = {\n                print(&quot;-----------------operation\\(index),\\(operation.isCancelled)&quot;)\n            }\n            queue.addOperation(operation)\n}\n```","like_count":0,"discussions":[{"author":{"id":1454945,"avatar":"https://static001.geekbang.org/account/avatar/00/16/33/61/da6d8713.jpg","nickname":"Xinming","note":"","ucode":"F7330DD975D248","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382031,"discussion_content":"建议用 Time Profiler 定位主线程被什么方法阻塞时间最多，单看代码发现不了问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625376681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}