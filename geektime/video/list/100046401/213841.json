{"id":213841,"title":"25 | PyTorchç®€ä»‹ï¼šTensorå’Œç›¸å…³è¿ç®—","content":"<p><strong>è¯¾ä»¶å’ŒDemoåœ°å€</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NLP\">https://gitee.com/geektime-geekbang/NLP</a></p>","comments":[{"had_liked":false,"id":190124,"user_name":"Tofacto","can_delete":false,"product_type":"c3","uid":1888008,"ip_address":"","ucode":"52C83F46206D7B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wg4obeslvaze1cqWEuIqwrcibbUIKs8LOycSSKxj3Exo5v5Zo4kFd2TFgVjuBugXTJD6FGnvtFmic6OibeibkvWCHA/132","comment_is_top":false,"comment_ctime":1584604681,"is_pvip":false,"replies":[{"id":73205,"content":"ä¸è¡Œçš„è¯æˆ‘é‡æ–°å½•ä¸€ä¸‹è¿™ä¸ªç„¶ååœ¨ç™½æ¿ä¸Šè§£é‡Šä¸€ä¸‹å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç„¶","uid":1813673,"ctime":1584631007,"ip_address":"","comment_id":190124,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"è§†é¢‘çš„æœ€å\nA = torch.randn(3, 5, 4)\nl = torch.randn(2, 5)\nr = torch.randn(2, 4)\ntorch.einsum(&#39;bn, anm, bm-&gt;ba&#39;, l, A, r)\næœ€ç»ˆç»“æœæ˜¯baï¼Œæ²¡æœ‰å‡ºç°nå’Œm\nåœ¨è§†é¢‘ä¸­è®²è§£nå’Œmæ˜¯æ€ä¹ˆæ“ä½œçš„æ—¶å€™ï¼Œè€å¸ˆè¯´ï¼šâ€œå®ƒå°±æ˜¯å¯¹åº”åœ°å»æŠŠå®ƒåŠ èµ·æ¥ï¼Œåšè¿™æ ·çš„ä¸€ä¸ªæ±‚å’Œçš„æ“ä½œï¼Œé‚£ä¹ˆå¯¹åº”çš„å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªBilinearè¿‡ç¨‹â€\nè¯·é—®è€å¸ˆè¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¬ä¸æ˜ç™½ï¼è¯·åœ¨è¿™é‡Œç»™è§£é‡Šä¸€ä¸‹å§ï¼Œè°¢è°¢\næˆ‘ç”¨ç¨‹åºè·‘äº†ä¸€ä¸‹ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼š\ntensor([[10.3107, -2.2290, -1.1836],\n        [ 7.3258,  2.1568, -3.5209]])\nä¸è¿‡è¿˜æ˜¯çœ‹ä¸æ˜ç™½ï¼Œè¯·è€å¸ˆå›å¤ï¼Œè°¢è°¢ï¼","like_count":5,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"ç‹ç„¶","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487895,"discussion_content":"ä¸è¡Œçš„è¯æˆ‘é‡æ–°å½•ä¸€ä¸‹è¿™ä¸ªç„¶ååœ¨ç™½æ¿ä¸Šè§£é‡Šä¸€ä¸‹å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584631007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1673587,"avatar":"https://static001.geekbang.org/account/avatar/00/19/89/73/9a7b0dfe.jpg","nickname":"Ayaya","note":"","ucode":"FC47B194CFD014","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210487,"discussion_content":"è¿™é‡Œæˆ‘çš„ç†è§£æ˜¯, åœ¨ einsum ä¸­, ç›¸é‚»ä¸¤ä¸ªå¼ é‡ä¼šé¦–å…ˆè¿›è¡Œç»´åº¦æ‰©å±•(å…¶å®ä¹Ÿåº”è¯¥å°±æ˜¯ broadcast), ç„¶åæŒ‰ä½ç›¸ä¹˜ä¹‹å, æŒ‰éœ€ç›¸åŠ , å¯¹æ­¤æˆ‘è¿›è¡Œäº†ä¸€äº›æµ‹è¯•.\n\nimport torch\n# å‡†å¤‡æ•°æ®\nA = torch.arange(60).reshape(3,5,4)\nl = torch.arange(10).reshape(2,5)\nr = torch.arange(8).reshape(2,4)    # è¿™æ ·æ˜¯ä¸ºäº†æ˜“äºæ‰‹åŠ¨è®¡ç®—éªŒè¯, å¹¶ä¸”æ˜“å¤çº¿\n# ä¸ºäº†æ–¹ä¾¿, åˆ—å‡º einsum ä¸­å­—æ¯å¯¹åº”ç»´åº¦å¤§å°: b=2, a=3, n=5, m=4\n\n# ç»è¿‡æˆ‘çš„æµ‹è¯•, åŸå¼å¯åˆ†è§£ä¸ºä¸¤æ­¥\noutput1 = torch.einsum(&#39;bn, anm, bm->ba&#39;, l, A, r)      # original\nmeta1 = torch.einsum(&#39;bn, anm->bam&#39;, l, A)              # First Step\noutput = torch.einsum(&#39;bam, bm->ba&#39;, meta1, r)        # Second Step\n\n# è¿™è¯´æ˜å¤šé¡¹ einsum çš„å·¥ä½œé¡ºåºæ˜¯ä»å·¦åˆ°å³, ä¸”æœ‰\noutput1 == output\n\n# ç„¶åå…³äºç¬¬ä¸€æ­¥, å…¶å®å¯ä»¥ç†è§£ä¸º\nl1 = l.unsqueeze(-1).expand(2, 5, 4)    \nmeta2 = torch.einsum(&#39;bnm, anm->bam&#39;, l1, A)\n\n# ä¹Ÿå°±æ˜¯è¯´å…ˆåšäº†ä¸€ä¸ªæ‰©ç»´, ç„¶åè¿›è¡Œå¯¹åº”ä½æŒ‰ä½ä¹˜. å¯ä»¥æµ‹è¯• \nmeta1 == meta2  # Return a bool matrix of size (2, 3, 4)\n\n# é‚£ä¹ˆåœ¨è®¡ç®— meta2 çš„è¿‡ç¨‹ä¸­, å®é™…ä¸Š einsum åšçš„äº‹æƒ…æ˜¯è¿™æ ·çš„(è¿™é‡Œç”¨ meta3 å’Œ meta4 å˜é‡æ¼”ç¤º): \nmeta3 = torch.empty(2, 3, 5, 4)\nfor i in range(2):\n    for j in range(3):\n            meta3[i, j, :, :] = l1[i] * A[j] \n\nmeta4 = meta3.sum(dim=2)   # ä¸è¦çš„ n åœ¨ dim=2 çš„ä½ç½®, å› ä¸ºè¿™ä¸ªæ—¶å€™ meta3 çš„ shape æ˜¯ (b, a, n, m)\n# å¯ä»¥æµ‹è¯•: \nmeta4 == meta2 \n\n# ç„¶åç¬¬äºŒæ­¥å‘¢, å…¶å®å’Œç¬¬ä¸€æ­¥ä¸€æ¨¡ä¸€æ ·, åªæ˜¯ç”±äºæ‰©å±•åç»´åº¦ç›¸ç­‰, å¯ä»¥æ›´ç®€æ˜“ä¸€ç‚¹:\nmeta5 = (r.unsqueeze(1).expand(2,3,4) * meta1).sum(dim=2)\nmeta5 == output\n\nä¸ºäº†æ–¹ä¾¿ä½  copy è¿›è¡Œæµ‹è¯•, è¿™é‡Œæ‰€æœ‰çš„è¯´æ˜æˆ‘éƒ½ä½¿ç”¨äº†æ³¨é‡Š, ä½ å¯ä»¥ç›´æ¥å…¨éƒ¨ copy å¹¶æµ‹è¯•.\nç„¶åæƒ³è¡¥å……çš„ä¸€ç‚¹æ˜¯, è¿™é‡Œæˆ‘æ˜¯ç”¨**æ‰©å±•ç»´åº¦**çš„æ–¹å¼æ¥ç†è§£çš„, ä½†æ˜¯å®é™…ä¸Š, åº”è¯¥æ˜¯é€šè¿‡ pytorch çš„ broadcast æœºåˆ¶å®Œæˆè¿™äº›ä»»åŠ¡. ä¸è¿‡æŒ‰ç…§æˆ‘çš„ç†è§£, broadcast åº”è¯¥ä¹Ÿæ˜¯é è¿™ç§ expand çš„æ–¹å¼å®ç°çš„.\n\nå¦å¤–æ˜¯æˆ‘å‘ç°çš„ä¸€ä¸ªåˆ«äººçš„å›ç­”. å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©\nhttps://stackoverflow.com/questions/55894693/understanding-pytorch-einsum\nå¦‚æœæˆ‘çš„ç†è§£æˆ–è€…ç¨‹åºä¸­æœ‰ä»»ä½•çš„é”™è¯¯, å¸Œæœ›ä½ èƒ½å¸®æˆ‘æŒ‡æ­£, æˆ‘å°†æ— æ¯”æ„Ÿè°¢.","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1584742637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1888008,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/wg4obeslvaze1cqWEuIqwrcibbUIKs8LOycSSKxj3Exo5v5Zo4kFd2TFgVjuBugXTJD6FGnvtFmic6OibeibkvWCHA/132","nickname":"Tofacto","note":"","ucode":"52C83F46206D7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211408,"discussion_content":"è°¢è°¢ï¼Œæˆ‘ä»”ç»†çœ‹çœ‹(^_^)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584848291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190982,"user_name":"äººå·¥æ™ºèƒ½æ··é¥­äºº","can_delete":false,"product_type":"c3","uid":1104354,"ip_address":"","ucode":"71CF953311BD81","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/e2/d75009ef.jpg","comment_is_top":false,"comment_ctime":1584715740,"is_pvip":false,"replies":[{"id":73363,"content":"å…·ä½“æŒ‡å“ªé‡Œå‘¢ï¼Ÿå¯ä»¥å…·ä½“è¯´ä¸€ä¸‹ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹ç„¶","uid":1813673,"ctime":1584756560,"ip_address":"","comment_id":190982,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"ä¸€ç›´å¯¹è¿™äº›tensorçš„å½¢çŠ¶å˜æ¢ç†è§£ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè€å¸ˆæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è®²ä¸€ä¸‹å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"ç‹ç„¶","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488093,"discussion_content":"å…·ä½“æŒ‡å“ªé‡Œå‘¢ï¼Ÿå¯ä»¥å…·ä½“è¯´ä¸€ä¸‹ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584756560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1914504,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/36/88/20b6a6ee.jpg","nickname":"Simon","note":"","ucode":"A8A2E3E57BD029","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229642,"discussion_content":"éœ€è¦çŸ¥é“æ¯ä¸€å±‚ç½‘ç»œçš„å…·ä½“æ“ä½œã€‚æ¯”å¦‚CNNï¼Œå·ç§¯æ ¸å¤šå¤§ï¼Œæ­¥é•¿æ˜¯å¤šå°‘ï¼Œfilteræœ‰å‡ ä¸ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586677291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104354,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/e2/d75009ef.jpg","nickname":"äººå·¥æ™ºèƒ½æ··é¥­äºº","note":"","ucode":"71CF953311BD81","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210656,"discussion_content":"å°±æ˜¯ç»è¿‡å„ç§ç½‘ç»œä¹‹åtensorçš„å½¢çŠ¶ï¼Œè¿™ä¸ªæ˜¯åªéœ€è¦è®°ä½å‘¢ï¼Ÿè¿˜æ˜¯éœ€è¦è‡ªå·±æ¨ç†ä¸€ä¸‹ã€‚æ¶‰åŠåˆ°ç»´åº¦æ¯”è¾ƒé«˜çš„ï¼Œç†è§£èµ·æ¥å°±å¾ˆæŠ½è±¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584758368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323224,"user_name":"EiLenğŸ–","can_delete":false,"product_type":"c3","uid":2760384,"ip_address":"","ucode":"998AADC238AACC","user_header":"https://static001.geekbang.org/account/avatar/00/2a/1e/c0/fa6afd6a.jpg","comment_is_top":false,"comment_ctime":1637768209,"is_pvip":false,"replies":[{"id":117740,"content":"æ„Ÿè°¢ï½çš„ç¡®æ˜¯é”™è¯¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1813673,"ctime":1638448615,"ip_address":"","comment_id":323224,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"è€å¸ˆçš„ç™½æ¿å†™æˆäº†bc.. å…¶å®æ˜¯ba","like_count":0,"discussions":[{"author":{"id":1813673,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ac/a9/fbcddd1f.jpg","nickname":"ç‹ç„¶","note":"","ucode":"45A7F34120DF47","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535468,"discussion_content":"æ„Ÿè°¢ï½çš„ç¡®æ˜¯é”™è¯¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638448615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229399,"user_name":"ä¼Ÿå¤§çš„å°æ˜","can_delete":false,"product_type":"c3","uid":2042843,"ip_address":"","ucode":"1337BCD4A417DA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/XeCJSINicu0zWk9v9JDNkAib2yfsFpocjewiaf5Cw2icN23W65Ayiba1WkfXgSEpWAS7Y8NUHBjp38Awsz0zsaTpTMQ/132","comment_is_top":false,"comment_ctime":1592984754,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"Einsumå»ºè®®æŒ‰ç…§è€å¸ˆ16åˆ†30ç§’å·¦å³çš„æƒ³æ³•ï¼Œçœ‹ä¸€ä¸‹https:&#47;&#47;www.cnblogs.com&#47;mengnan&#47;p&#47;10319701.html","like_count":4},{"had_liked":false,"id":250101,"user_name":"Jinru Wu å´çå¦‚","can_delete":false,"product_type":"c3","uid":1193229,"ip_address":"","ucode":"16D012A47E8E47","user_header":"https://static001.geekbang.org/account/avatar/00/12/35/0d/8cb4c57f.jpg","comment_is_top":false,"comment_ctime":1600935324,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"einsumæ•°å­¦ä¸Šçš„è®²è§£å¯ä»¥å‚è€ƒè¿™ä¸¤ä¸ªè§†é¢‘ï¼š\nhttps:&#47;&#47;www.youtube.com&#47;watch?v=CLrTj7D2fLM \nhttps:&#47;&#47;www.youtube.com&#47;watch?v=-SYDZXNFWXg\nåˆšçœ‹ä¸€å¤´é›¾æ°´ï¼Œä½†çœ‹å®Œè‡ªå·±åœ¨çº¸ä¸Šåšä¸€é torch.einsum(&#39;bn,anm,bm-&gt;ba&#39;, l, A, r) è¿™é‡Œçš„ä¸‰ä¸ªçŸ©é˜µä¹˜æ³•å°±èƒ½å¤§è‡´ç†è§£äº†ã€‚\n","like_count":2},{"had_liked":false,"id":289175,"user_name":"hallo128","can_delete":false,"product_type":"c3","uid":1212044,"ip_address":"","ucode":"3921D6E11CFCB1","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/8c/f029535a.jpg","comment_is_top":false,"comment_ctime":1618903210,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"æ¢¯åº¦ä¸‹é™ï¼šhttps:&#47;&#47;pytorch.apachecn.org&#47;docs&#47;1.7&#47;04.html\nå¼ é‡tensorä»‹ç»ï¼šhttps:&#47;&#47;pytorch.apachecn.org&#47;docs&#47;1.7&#47;03.html","like_count":0},{"had_liked":false,"id":193126,"user_name":"JaneIDK","can_delete":false,"product_type":"c3","uid":1883313,"ip_address":"","ucode":"8F6E293767C62B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/bc/b1/3ba14f09.jpg","comment_is_top":false,"comment_ctime":1584884249,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"å•Šä¿¡æ¯é‡å¥½å¤§","like_count":0},{"had_liked":false,"id":192445,"user_name":"éŸ©å‘æ°‘","can_delete":false,"product_type":"c3","uid":1310021,"ip_address":"","ucode":"C0335C3785C303","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/45/a498dcb9.jpg","comment_is_top":false,"comment_ctime":1584851288,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100046401,"comment_content":"è¯¥è®²éœ€è¦åå¤å®é™…çš„æ“ä½œæ¥è¾¾åˆ°ç†Ÿç»ƒ","like_count":0}]}