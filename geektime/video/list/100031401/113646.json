{"id":113646,"title":"43 | Spring Boot微服务测试该如何分类？","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":189232,"user_name":"彬清","can_delete":false,"product_type":"c3","uid":1220372,"ip_address":"","ucode":"04620BAC60F15F","user_header":"https://static001.geekbang.org/account/avatar/00/12/9f/14/b9505789.jpg","comment_is_top":false,"comment_ctime":1584491753,"is_pvip":false,"replies":[{"id":73408,"content":"单元测试做到什么样程度，没有统一的标准，我觉得具体还是要看业务的关键程度，有些系统是使命(比如核心支付逻辑)甚至性命(医疗软件)攸关的，那么再怎么细致测试都不为过。其它系统可能粗粒度接口测试就够了。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1584789811,"ip_address":"","comment_id":189232,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师好，对于单一微服务来说，功能应该都不会太复杂，有必要针对每一层都进行单元测试吗？编写单元测试也是挺花时间的。是不是做好接口测试就可以了？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487640,"discussion_content":"单元测试做到什么样程度，没有统一的标准，我觉得具体还是要看业务的关键程度，有些系统是使命(比如核心支付逻辑)甚至性命(医疗软件)攸关的，那么再怎么细致测试都不为过。其它系统可能粗粒度接口测试就够了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584789811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293219,"user_name":"Geek_xrec2g","can_delete":false,"product_type":"c3","uid":1159098,"ip_address":"","ucode":"E2FE70FBB163C9","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/ba/7f7d243b.jpg","comment_is_top":false,"comment_ctime":1621293688,"is_pvip":false,"replies":[{"id":107201,"content":"使用数据库存储过程会产生耦合性问题，是典型的反模式，建议先想办法消除存储过程，存储过程应该搬到service或者job中去。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1622390275,"ip_address":"","comment_id":293219,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师好，我们的repository层调用的是oracle的存储过程存取数据的，而存储过程也是有很复杂的逻辑，无法使用memory db，这种情况下集成测试和组件测试应该如何设计？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520119,"discussion_content":"使用数据库存储过程会产生耦合性问题，是典型的反模式，建议先想办法消除存储过程，存储过程应该搬到service或者job中去。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622390275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293217,"user_name":"Geek_xrec2g","can_delete":false,"product_type":"c3","uid":1159098,"ip_address":"","ucode":"E2FE70FBB163C9","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/ba/7f7d243b.jpg","comment_is_top":false,"comment_ctime":1621292742,"is_pvip":false,"replies":[{"id":107200,"content":"有点怪，但是如果能解决你的实际业务问题，就没什么不合理的。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1622390161,"ip_address":"","comment_id":293217,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"在我们的架构里，proxy是在repository之下的，隔离了domain对象的来源是来自数据库或者其它服务，这样做合理吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520118,"discussion_content":"有点怪，但是如果能解决你的实际业务问题，就没什么不合理的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622390161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210811,"user_name":"严晨宁","can_delete":false,"product_type":"c3","uid":1852261,"ip_address":"","ucode":"7B9FD8266CEF6D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJMBpqetWJYtPod6SICmWe6mtayV3ib4MQ7rGOkXDUfZntpMVsBzCeZoyTpnBBW3cgn2iaeZgQuTicKA/132","comment_is_top":false,"comment_ctime":1587828071,"is_pvip":false,"replies":[{"id":78522,"content":"建议参考stackoverflow上两个帖子，各自下面的第一个回复赞同的人不少：\n\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;17681708&#47;mocking-files-in-java-mock-contents-mockito\n\nhttps:&#47;&#47;stackoverflow.com&#47;questions&#47;17163484&#47;mockito-mocking-behaviour-of-a-file&#47;17164103","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587906228,"ip_address":"","comment_id":210811,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师  你好\n我们现在单元测试遇到这样一个问题，就是文件类的方法怎么进行mock，如何模拟文件内容？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493115,"discussion_content":"建议参考stackoverflow上两个帖子，各自下面的第一个回复赞同的人不少：\n\nhttps://stackoverflow.com/questions/17681708/mocking-files-in-java-mock-contents-mockito\n\nhttps://stackoverflow.com/questions/17163484/mockito-mocking-behaviour-of-a-file/17164103","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587906228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201354,"user_name":"春哥","can_delete":false,"product_type":"c3","uid":1103105,"ip_address":"","ucode":"C20FED6AE27B76","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/01/befc9f3e.jpg","comment_is_top":false,"comment_ctime":1585755199,"is_pvip":false,"replies":[{"id":75441,"content":"当然会，这个是测试资源投入的问题，具体看企业的体量规模，一般大公司都有专门的测试用数据库，并且有专门DBA管理维护。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585839837,"ip_address":"","comment_id":201354,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"如果测试环境，用和开发环境不一致的数据库，会不会增加数据库人员的工作量。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490310,"discussion_content":"当然会，这个是测试资源投入的问题，具体看企业的体量规模，一般大公司都有专门的测试用数据库，并且有专门DBA管理维护。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585839837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333956,"user_name":"放飞心情","can_delete":false,"product_type":"c3","uid":1244845,"ip_address":"","ucode":"75A2192D91D86C","user_header":"https://static001.geekbang.org/account/avatar/00/12/fe/ad/7fa85a7d.jpg","comment_is_top":false,"comment_ctime":1644638530,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"波波老师，你好！类似代码需要调用Redis或者MQ等中间件的测试，我们是否可以将相关中间件的操作抽象为接口+实现的方案；生产环境调用中间件；测试环境下直接按接口实现一套，然后调用自己实现的接口进行测试。","like_count":0,"discussions":[{"author":{"id":1117318,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","nickname":"花花大脸猫","note":"","ucode":"8ABDB3F7F4FB0F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598884,"discussion_content":"直接mock一个返回结果就可以，不过你的这种想法是对的，就看实际场景需不需要都去做成接口实现的逻辑","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673185733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}