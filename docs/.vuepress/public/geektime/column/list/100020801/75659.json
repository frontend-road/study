{"id":75659,"title":"21 | ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ","content":"<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†é—´éš™é”å’Œnext-key lockçš„æ¦‚å¿µï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´æ˜åŠ é”è§„åˆ™ã€‚é—´éš™é”çš„æ¦‚å¿µç†è§£èµ·æ¥ç¡®å®æœ‰ç‚¹å„¿éš¾ï¼Œå°¤å…¶åœ¨é…åˆä¸Šè¡Œé”ä»¥åï¼Œå¾ˆå®¹æ˜“åœ¨åˆ¤æ–­æ˜¯å¦ä¼šå‡ºç°é”ç­‰å¾…çš„é—®é¢˜ä¸ŠçŠ¯é”™ã€‚</p><p>æ‰€ä»¥ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å…ˆä»è¿™ä¸ªåŠ é”è§„åˆ™å¼€å§‹å§ã€‚</p><p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œè¿™äº›åŠ é”è§„åˆ™æˆ‘æ²¡åœ¨åˆ«çš„åœ°æ–¹çœ‹åˆ°è¿‡æœ‰ç±»ä¼¼çš„æ€»ç»“ï¼Œä»¥å‰æˆ‘è‡ªå·±åˆ¤æ–­çš„æ—¶å€™éƒ½æ˜¯æƒ³ç€ä»£ç é‡Œé¢çš„å®ç°æ¥è„‘è¡¥çš„ã€‚è¿™æ¬¡ä¸ºäº†æ€»ç»“æˆä¸çœ‹ä»£ç çš„åŒå­¦ä¹Ÿèƒ½ç†è§£çš„è§„åˆ™ï¼Œæ˜¯æˆ‘åˆé‡æ–°åˆ·äº†ä»£ç ä¸´æ—¶æ€»ç»“å‡ºæ¥çš„ã€‚æ‰€ä»¥ï¼Œ<strong>è¿™ä¸ªè§„åˆ™æœ‰ä»¥ä¸‹ä¸¤æ¡å‰æè¯´æ˜ï¼š</strong></p><ol>\n<li>\n<p>MySQLåé¢çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¹å˜åŠ é”ç­–ç•¥ï¼Œæ‰€ä»¥è¿™ä¸ªè§„åˆ™åªé™äºæˆªæ­¢åˆ°ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå³5.xç³»åˆ—&lt;=5.7.24ï¼Œ8.0ç³»åˆ— &lt;=8.0.13ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå¤§å®¶åœ¨éªŒè¯ä¸­æœ‰å‘ç°bad caseçš„è¯ï¼Œè¯·æå‡ºæ¥ï¼Œæˆ‘ä¼šå†è¡¥å……è¿›è¿™ç¯‡æ–‡ç« ï¼Œä½¿å¾—ä¸€èµ·å­¦ä¹ æœ¬ä¸“æ çš„æ‰€æœ‰åŒå­¦éƒ½èƒ½å—ç›Šã€‚</p>\n</li>\n</ol><p>å› ä¸ºé—´éš™é”åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ¥ä¸‹æ¥çš„æè¿°ï¼Œè‹¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚</p><p><strong>æˆ‘æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</strong></p><ol>\n<li>\n<p>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockã€‚å¸Œæœ›ä½ è¿˜è®°å¾—ï¼Œnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</p>\n</li>\n<li>\n<p>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚</p>\n</li>\n<li>\n<p>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”ã€‚</p>\n</li>\n<li>\n<p>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</p>\n</li>\n<li>\n<p>ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</p>\n</li>\n</ol><!-- [[[read_end]]] --><p>æˆ‘è¿˜æ˜¯ä»¥ä¸Šç¯‡æ–‡ç« çš„è¡¨tä¸ºä¾‹ï¼Œå’Œä½ è§£é‡Šä¸€ä¸‹è¿™äº›è§„åˆ™ã€‚è¡¨tçš„å»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ã€‚</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n</code></pre><p>æ¥ä¸‹æ¥çš„ä¾‹å­åŸºæœ¬éƒ½æ˜¯é…åˆç€å›¾ç‰‡è¯´æ˜çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ å¯ä»¥å¯¹ç…§ç€æ–‡ç¨¿çœ‹ï¼Œæœ‰äº›ä¾‹å­å¯èƒ½ä¼šâ€œæ¯ä¸‰è§‚â€ï¼Œä¹Ÿå»ºè®®ä½ è¯»å®Œæ–‡ç« åäº²æ‰‹å®è·µä¸€ä¸‹ã€‚</p><h1>æ¡ˆä¾‹ä¸€ï¼šç­‰å€¼æŸ¥è¯¢é—´éš™é”</h1><p>ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å…³äºç­‰å€¼æ¡ä»¶æ“ä½œé—´éš™ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/58/6c/585dfa8d0dd71171a6fa16bed4ba816c.png?wh=936*313\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ç­‰å€¼æŸ¥è¯¢çš„é—´éš™é”</span></center><p>ç”±äºè¡¨tä¸­æ²¡æœ‰id=7çš„è®°å½•ï¼Œæ‰€ä»¥ç”¨æˆ‘ä»¬ä¸Šé¢æåˆ°çš„åŠ é”è§„åˆ™åˆ¤æ–­ä¸€ä¸‹çš„è¯ï¼š</p><ol>\n<li>\n<p>æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œsession AåŠ é”èŒƒå›´å°±æ˜¯(5,10]ï¼›</p>\n</li>\n<li>\n<p>åŒæ—¶æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢(id=7)ï¼Œè€Œid=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œnext-key locké€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯(5,10)ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥ï¼Œsession Bè¦å¾€è¿™ä¸ªé—´éš™é‡Œé¢æ’å…¥id=8çš„è®°å½•ä¼šè¢«é”ä½ï¼Œä½†æ˜¯session Cä¿®æ”¹id=10è¿™è¡Œæ˜¯å¯ä»¥çš„ã€‚</p><h1>æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”</h1><p>ç¬¬äºŒä¸ªä¾‹å­æ˜¯å…³äºè¦†ç›–ç´¢å¼•ä¸Šçš„é”ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/46/65/465990fe8f6b418ca3f9992bd1bb5465.png?wh=1244*462\" alt=\"\"></p><center><span class=\"reference\">å›¾2 åªåŠ åœ¨éå”¯ä¸€ç´¢å¼•ä¸Šçš„é”</span></center><p>çœ‹åˆ°è¿™ä¸ªä¾‹å­ï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§â€œè¯¥é”çš„ä¸é”ï¼Œä¸è¯¥é”çš„ä¹±é”â€çš„æ„Ÿè§‰ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å§ã€‚</p><p>è¿™é‡Œsession Aè¦ç»™ç´¢å¼•cä¸Šc=5çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚</p><ol>\n<li>\n<p>æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œå› æ­¤ä¼šç»™(0,5]åŠ ä¸Šnext-key lockã€‚</p>\n</li>\n<li>\n<p>è¦æ³¨æ„cæ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—®c=5è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™(5,10]åŠ next-key lockã€‚</p>\n</li>\n<li>\n<p>ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ–2ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³c=5è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é”(5,10)ã€‚</p>\n</li>\n<li>\n<p>æ ¹æ®åŸåˆ™2 ï¼Œ<strong>åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”</strong>ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆsession Bçš„updateè¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆã€‚</p>\n</li>\n</ol><p>ä½†session Cè¦æ’å…¥ä¸€ä¸ª(7,7,7)çš„è®°å½•ï¼Œå°±ä¼šè¢«session Açš„é—´éš™é”(5,10)é”ä½ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlock in share modeåªé”è¦†ç›–ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœæ˜¯for updateå°±ä¸ä¸€æ ·äº†ã€‚ æ‰§è¡Œ for updateæ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚</p><p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼›åŒæ—¶ï¼Œå®ƒç»™æˆ‘ä»¬çš„æŒ‡å¯¼æ˜¯ï¼Œå¦‚æœä½ è¦ç”¨lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚æ¯”å¦‚ï¼Œå°†session Açš„æŸ¥è¯¢è¯­å¥æ”¹æˆselect d from t where c=5 lock in share modeã€‚ä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹æ•ˆæœã€‚</p><h1>æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”</h1><p>ç¬¬ä¸‰ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ã€‚</p><p>ä¸¾ä¾‹ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šå¯¹äºæˆ‘ä»¬è¿™ä¸ªè¡¨tï¼Œä¸‹é¢è¿™ä¸¤æ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŠ é”èŒƒå›´ç›¸åŒå—ï¼Ÿ</p><pre><code>mysql&gt; select * from t where id=10 for update;\nmysql&gt; select * from t where id&gt;=10 and id&lt;11 for update;\n</code></pre><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œidå®šä¹‰ä¸ºintç±»å‹ï¼Œè¿™ä¸¤ä¸ªè¯­å¥å°±æ˜¯ç­‰ä»·çš„å§ï¼Ÿå…¶å®ï¼Œå®ƒä»¬å¹¶ä¸å®Œå…¨ç­‰ä»·ã€‚</p><p>åœ¨é€»è¾‘ä¸Šï¼Œè¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°±è®©session Aæ‰§è¡Œç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ¥çœ‹çœ‹åŠ é”æ•ˆæœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/30/80/30b839bf941f109b04f1a36c302aea80.png?wh=1244*718\" alt=\"\"></p><center><span class=\"reference\">å›¾3 ä¸»é”®ç´¢å¼•ä¸ŠèŒƒå›´æŸ¥è¯¢çš„é”</span></center><p>ç°åœ¨æˆ‘ä»¬å°±ç”¨å‰é¢æåˆ°çš„åŠ é”è§„åˆ™ï¼Œæ¥åˆ†æä¸€ä¸‹session A ä¼šåŠ ä»€ä¹ˆé”å‘¢ï¼Ÿ</p><ol>\n<li>\n<p>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªid=10çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯next-key lock(5,10]ã€‚ æ ¹æ®ä¼˜åŒ–1ï¼Œ ä¸»é”®idä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº†id=10è¿™ä¸€è¡Œçš„è¡Œé”ã€‚</p>\n</li>\n<li>\n<p>èŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ°id=15è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œå› æ­¤éœ€è¦åŠ next-key lock(10,15]ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥ï¼Œsession Aè¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé”id=10å’Œnext-key lock(10,15]ã€‚è¿™æ ·ï¼Œsession Bå’Œsession Cçš„ç»“æœä½ å°±èƒ½ç†è§£äº†ã€‚</p><p>è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé¦–æ¬¡session Aå®šä½æŸ¥æ‰¾id=10çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ°id=15çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚</p><h1>æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´é”</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸¤ä¸ªèŒƒå›´æŸ¥è¯¢åŠ é”çš„ä¾‹å­ï¼Œä½ å¯ä»¥å¯¹ç…§ç€æ¡ˆä¾‹ä¸‰æ¥çœ‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„whereéƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µcã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/73/7a/7381475e9e951628c9fc907f5a57697a.png?wh=1246*550\" alt=\"\"></p><center><span class=\"reference\">å›¾4 éå”¯ä¸€ç´¢å¼•èŒƒå›´é”</span></center><p>è¿™æ¬¡session Aç”¨å­—æ®µcæ¥åˆ¤æ–­ï¼ŒåŠ é”è§„åˆ™è·Ÿæ¡ˆä¾‹ä¸‰å”¯ä¸€çš„ä¸åŒæ˜¯ï¼šåœ¨ç¬¬ä¸€æ¬¡ç”¨c=10å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼•cä¸ŠåŠ äº†(5,10]è¿™ä¸ªnext-key lockåï¼Œç”±äºç´¢å¼•cæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆsesion AåŠ çš„é”æ˜¯ï¼Œç´¢å¼•cä¸Šçš„(5,10] å’Œ(10,15] è¿™ä¸¤ä¸ªnext-key lockã€‚</p><p>æ‰€ä»¥ä»ç»“æœä¸Šæ¥çœ‹ï¼Œsesson Bè¦æ’å…¥ï¼ˆ8,8,8)çš„è¿™ä¸ªinsertè¯­å¥æ—¶å°±è¢«å µä½äº†ã€‚</p><p>è¿™é‡Œéœ€è¦æ‰«æåˆ°c=15æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸ºInnoDBè¦æ‰«åˆ°c=15ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚</p><h1>æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é”bug</h1><p>å‰é¢çš„å››ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å·²ç»ç”¨åˆ°äº†åŠ é”è§„åˆ™ä¸­çš„ä¸¤ä¸ªåŸåˆ™å’Œä¸¤ä¸ªä¼˜åŒ–ï¼Œæ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…³äºåŠ é”è§„åˆ™ä¸­bugçš„æ¡ˆä¾‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b1/6d/b105f8c4633e8d3a84e6422b1b1a316d.png?wh=1250*590\" alt=\"\"></p><center><span class=\"reference\">å›¾5 å”¯ä¸€ç´¢å¼•èŒƒå›´é”çš„bug</span></center><p>session Aæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™1çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼•idä¸ŠåªåŠ (10,15]è¿™ä¸ªnext-key lockï¼Œå¹¶ä¸”å› ä¸ºidæ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ°id=15è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚</p><p>ä½†æ˜¯å®ç°ä¸Šï¼ŒInnoDBä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯id=20ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼•idä¸Šçš„(15,20]è¿™ä¸ªnext-key lockä¹Ÿä¼šè¢«é”ä¸Šã€‚</p><p>æ‰€ä»¥ä½ çœ‹åˆ°äº†ï¼Œsession Bè¦æ›´æ–°id=20è¿™ä¸€è¡Œï¼Œæ˜¯ä¼šè¢«é”ä½çš„ã€‚åŒæ ·åœ°ï¼Œsession Cè¦æ’å…¥id=16çš„ä¸€è¡Œï¼Œä¹Ÿä¼šè¢«é”ä½ã€‚</p><p>ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½id=20è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ°id=15ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚ä½†å®ç°ä¸Šè¿˜æ˜¯è¿™ä¹ˆåšäº†ï¼Œå› æ­¤æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ªbugã€‚</p><p>æˆ‘ä¹Ÿæ›¾æ‰¾ç¤¾åŒºçš„ä¸“å®¶è®¨è®ºè¿‡ï¼Œå®˜æ–¹bugç³»ç»Ÿä¸Šä¹Ÿæœ‰æåˆ°ï¼Œä½†æ˜¯å¹¶æœªè¢«verifiedã€‚æ‰€ä»¥ï¼Œè®¤ä¸ºè¿™æ˜¯bugè¿™ä¸ªäº‹å„¿ï¼Œä¹Ÿåªèƒ½ç®—æˆ‘çš„ä¸€å®¶ä¹‹è¨€ï¼Œå¦‚æœä½ æœ‰å…¶ä»–è§è§£çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æå‡ºæ¥ã€‚</p><h1>æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨\"ç­‰å€¼\"çš„ä¾‹å­</h1><p>æ¥ä¸‹æ¥çš„ä¾‹å­ï¼Œæ˜¯ä¸ºäº†æ›´å¥½åœ°è¯´æ˜â€œé—´éš™â€è¿™ä¸ªæ¦‚å¿µã€‚è¿™é‡Œï¼Œæˆ‘ç»™è¡¨tæ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚</p><pre><code>mysql&gt; insert into t values(30,10,30);\n</code></pre><p>æ–°æ’å…¥çš„è¿™ä¸€è¡Œc=10ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨è¡¨é‡Œæœ‰ä¸¤ä¸ªc=10çš„è¡Œã€‚é‚£ä¹ˆï¼Œè¿™æ—¶å€™ç´¢å¼•cä¸Šçš„é—´éš™æ˜¯ä»€ä¹ˆçŠ¶æ€äº†å‘¢ï¼Ÿä½ è¦çŸ¥é“ï¼Œç”±äºéå”¯ä¸€ç´¢å¼•ä¸ŠåŒ…å«ä¸»é”®çš„å€¼ï¼Œæ‰€ä»¥æ˜¯ä¸å¯èƒ½å­˜åœ¨â€œç›¸åŒâ€çš„ä¸¤è¡Œçš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/59/c1fda36c1502606eb5be3908011ba159.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾6 éå”¯ä¸€ç´¢å¼•ç­‰å€¼çš„ä¾‹å­</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æœ‰ä¸¤ä¸ªc=10ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼idæ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯10å’Œ30ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚</p><p>å›¾ä¸­æˆ‘ç”»å‡ºäº†ç´¢å¼•cä¸Šçš„ä¸»é”®idã€‚ä¸ºäº†è·Ÿé—´éš™é”çš„å¼€åŒºé—´å½¢å¼è¿›è¡ŒåŒºåˆ«ï¼Œæˆ‘ç”¨(c=10,id=30)è¿™æ ·çš„å½¢å¼ï¼Œæ¥è¡¨ç¤ºç´¢å¼•ä¸Šçš„ä¸€è¡Œã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¡ˆä¾‹å…­ã€‚</p><p>è¿™æ¬¡æˆ‘ä»¬ç”¨deleteè¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œdeleteè¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿselect ... for update æ˜¯ç±»ä¼¼çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b5/78/b55fb0a1cac3500b60e1cf9779d2da78.png?wh=1248*556\" alt=\"\"></p><center><span class=\"reference\">å›¾7 delete ç¤ºä¾‹</span></center><p>è¿™æ—¶ï¼Œsession Aåœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ªc=10çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™1ï¼Œè¿™é‡ŒåŠ çš„æ˜¯(c=5,id=5)åˆ°(c=10,id=10)è¿™ä¸ªnext-key lockã€‚</p><p>ç„¶åï¼Œsession Aå‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ°(c=15,id=15)è¿™ä¸€è¡Œï¼Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ(c=10,id=10) åˆ° (c=15,id=15)çš„é—´éš™é”ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªdeleteè¯­å¥åœ¨ç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/bb/24/bb0ad92483d71f0dcaeeef278f89cb24.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾8 deleteåŠ é”æ•ˆæœç¤ºä¾‹</span></center><p>è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³(c=5,id=5)å’Œ(c=15,id=15)è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”ã€‚</p><h1>æ¡ˆä¾‹ä¸ƒï¼šlimit è¯­å¥åŠ é”</h1><p>ä¾‹å­6ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹ï¼Œåœºæ™¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/af/2e/afc3a08ae7a254b3251e41b2a6dae02e.png?wh=954*318\" alt=\"\"></p><center><span class=\"reference\">å›¾9 limit è¯­å¥åŠ é”</span></center><p>è¿™ä¸ªä¾‹å­é‡Œï¼Œsession Açš„deleteè¯­å¥åŠ äº† limit 2ã€‚ä½ çŸ¥é“è¡¨té‡Œc=10çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ limit 2ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åŠ é”çš„æ•ˆæœå´ä¸åŒã€‚å¯ä»¥çœ‹åˆ°ï¼Œsession Bçš„insertè¯­å¥æ‰§è¡Œé€šè¿‡äº†ï¼Œè·Ÿæ¡ˆä¾‹å…­çš„ç»“æœä¸åŒã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„deleteè¯­å¥æ˜ç¡®åŠ äº†limit 2çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ°(c=10, id=30)è¿™ä¸€è¡Œä¹‹åï¼Œæ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚</p><p>å› æ­¤ï¼Œç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆc=5,id=5)åˆ°ï¼ˆc=10,id=30)è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/e5/d5/e5408ed94b3d44985073255db63bd0d5.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾10 å¸¦limit 2çš„åŠ é”æ•ˆæœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œ(c=10,id=30ï¼‰ä¹‹åçš„è¿™ä¸ªé—´éš™å¹¶æ²¡æœ‰åœ¨åŠ é”èŒƒå›´é‡Œï¼Œå› æ­¤insertè¯­å¥æ’å…¥c=12æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ã€‚</p><p>è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œ<strong>åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ limit</strong>ã€‚è¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´ã€‚</p><h1>æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­</h1><p>å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ†æçš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§next-key lockçš„é€»è¾‘æ¥åˆ†æçš„ï¼Œå› ä¸ºè¿™æ ·åˆ†ææ¯”è¾ƒæ–¹ä¾¿ã€‚æœ€åæˆ‘ä»¬å†çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼Œç›®çš„æ˜¯è¯´æ˜ï¼šnext-key lockå®é™…ä¸Šæ˜¯é—´éš™é”å’Œè¡Œé”åŠ èµ·æ¥çš„ç»“æœã€‚</p><p>ä½ ä¸€å®šä¼šç–‘æƒ‘ï¼Œè¿™ä¸ªæ¦‚å¿µä¸æ˜¯ä¸€å¼€å§‹å°±è¯´äº†å—ï¼Ÿä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/06/7b911a4c995706e8aa2dd96ff0f36506.png?wh=1106*650\" alt=\"\"></p><center><span class=\"reference\">å›¾11 æ¡ˆä¾‹å…«çš„æ“ä½œåºåˆ—</span></center><p>ç°åœ¨ï¼Œæˆ‘ä»¬æŒ‰æ—¶é—´é¡ºåºæ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ç»“æœã€‚</p><ol>\n<li>\n<p>session A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ lock in share modeï¼Œåœ¨ç´¢å¼•cä¸ŠåŠ äº†next-key lock(5,10] å’Œé—´éš™é”(10,15)ï¼›</p>\n</li>\n<li>\n<p>session B çš„updateè¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼•cä¸ŠåŠ next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼›</p>\n</li>\n<li>\n<p>ç„¶åsession Aè¦å†æ’å…¥(8,8,8)è¿™ä¸€è¡Œï¼Œè¢«session Bçš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼ŒInnoDBè®©session Bå›æ»šã€‚</p>\n</li>\n</ol><p>ä½ å¯èƒ½ä¼šé—®ï¼Œsession Bçš„next-key lockä¸æ˜¯è¿˜æ²¡ç”³è¯·æˆåŠŸå—ï¼Ÿ</p><p>å…¶å®æ˜¯è¿™æ ·çš„ï¼Œsession Bçš„â€œåŠ next-key lock(5,10] â€æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ (5,10)çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ c=10çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨åˆ†æåŠ é”è§„åˆ™çš„æ—¶å€™å¯ä»¥ç”¨next-key lockæ¥åˆ†æã€‚ä½†æ˜¯è¦çŸ¥é“ï¼Œå…·ä½“æ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯è¦åˆ†æˆé—´éš™é”å’Œè¡Œé”ä¸¤æ®µæ¥æ‰§è¡Œçš„ã€‚</p><h1>å°ç»“</h1><p>è¿™é‡Œæˆ‘å†æ¬¡è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸Šé¢çš„æ‰€æœ‰æ¡ˆä¾‹éƒ½æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«(repeatable-read)ä¸‹éªŒè¯çš„ã€‚åŒæ—¶ï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«éµå®ˆä¸¤é˜¶æ®µé”åè®®ï¼Œæ‰€æœ‰åŠ é”çš„èµ„æºï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤æˆ–è€…å›æ»šçš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚</p><p>åœ¨æœ€åçš„æ¡ˆä¾‹ä¸­ï¼Œä½ å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“next-key lockå®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ã€‚å¦‚æœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ«(read-committed)çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†ã€‚</p><p>å…¶å®è¯»æäº¤éš”ç¦»çº§åˆ«åœ¨å¤–é”®åœºæ™¯ä¸‹è¿˜æ˜¯æœ‰é—´éš™é”ï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä»Šå¤©å…ˆä¸å±•å¼€ã€‚</p><p>å¦å¤–ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå³ï¼šè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ ä¸Šçš„è¡Œé”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå°±è¦æŠŠâ€œä¸æ»¡è¶³æ¡ä»¶çš„è¡Œâ€ä¸Šçš„è¡Œé”ç›´æ¥é‡Šæ”¾äº†ï¼Œä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œé”çš„èŒƒå›´æ›´å°ï¼Œé”çš„æ—¶é—´æ›´çŸ­ï¼Œè¿™ä¹Ÿæ˜¯ä¸å°‘ä¸šåŠ¡éƒ½é»˜è®¤ä½¿ç”¨è¯»æäº¤éš”ç¦»çº§åˆ«çš„åŸå› ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘å¸Œæœ›ä½ å­¦è¿‡ä»Šå¤©çš„è¯¾ç¨‹ä»¥åï¼Œå¯ä»¥å¯¹next-key lockçš„æ¦‚å¿µæœ‰æ›´æ¸…æ™°çš„è®¤è¯†ï¼Œå¹¶ä¸”ä¼šç”¨åŠ é”è§„åˆ™å»åˆ¤æ–­è¯­å¥çš„åŠ é”èŒƒå›´ã€‚</p><p>åœ¨ä¸šåŠ¡éœ€è¦ä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ›´ç»†è‡´åœ°è®¾è®¡æ“ä½œæ•°æ®åº“çš„è¯­å¥ï¼Œè§£å†³å¹»è¯»é—®é¢˜çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°æå‡ç³»ç»Ÿå¹¶è¡Œå¤„ç†äº‹åŠ¡çš„èƒ½åŠ›ã€‚</p><p>ç»è¿‡è¿™ç¯‡æ–‡ç« çš„ä»‹ç»ï¼Œä½ å†çœ‹ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« æœ€åçš„æ€è€ƒé¢˜ï¼Œå†æ¥å°è¯•åˆ†æä¸€æ¬¡ã€‚</p><p>æˆ‘æŠŠé¢˜ç›®é‡æ–°æè¿°å’Œç®€åŒ–ä¸€ä¸‹ï¼šè¿˜æ˜¯æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´åˆå§‹åŒ–çš„è¡¨tï¼Œé‡Œé¢æœ‰6æ¡è®°å½•ï¼Œå›¾12çš„è¯­å¥åºåˆ—ä¸­ï¼Œä¸ºä»€ä¹ˆsession Bçš„insertæ“ä½œï¼Œä¼šè¢«é”ä½å‘¢ï¼Ÿ<br>\n<img src=\"https://static001.geekbang.org/resource/image/3a/1e/3a7578e104612a188a2d574eaa3bd81e.png?wh=942*270\" alt=\"\"></p><center><span class=\"reference\">å›¾12 é”åˆ†ææ€è€ƒé¢˜</span></center><p>å¦å¤–ï¼Œå¦‚æœä½ æœ‰å…´è¶£å¤šåšä¸€äº›å®éªŒçš„è¯ï¼Œå¯ä»¥è®¾è®¡å¥½è¯­å¥åºåˆ—ï¼Œåœ¨æ‰§è¡Œä¹‹å‰å…ˆè‡ªå·±åˆ†æä¸€ä¸‹ï¼Œç„¶åå®é™…åœ°éªŒè¯ç»“æœæ˜¯å¦è·Ÿä½ çš„åˆ†æä¸€è‡´ã€‚</p><p>å¯¹äºé‚£äº›ä½ è‡ªå·±æ— æ³•è§£é‡Šçš„ç»“æœï¼Œå¯ä»¥å‘åˆ°è¯„è®ºåŒºé‡Œï¼Œåé¢æˆ‘äº‰å–æŒ‘ä¸€äº›æœ‰è¶£çš„æ¡ˆä¾‹åœ¨æ–‡ç« ä¸­åˆ†æã€‚</p><p>ä½ å¯ä»¥æŠŠä½ å…³äºæ€è€ƒé¢˜çš„åˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œä¹Ÿå¯ä»¥åˆ†äº«ä½ è‡ªå·±è®¾è®¡çš„é”éªŒè¯æ–¹æ¡ˆï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºè·Ÿå¤§å®¶åˆ†äº«ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h2>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h2><p>ä¸ŠæœŸçš„é—®é¢˜ï¼Œæˆ‘åœ¨æœ¬æœŸç»§ç»­ä½œä¸ºäº†è¯¾åæ€è€ƒé¢˜ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« å†ä¸€èµ·å…¬å¸ƒâ€œç­”æ¡ˆâ€ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å±•å¼€å›ç­”ä¸€ä¸‹è¯„è®ºåŒºå‡ ä½åŒå­¦çš„é—®é¢˜ã€‚</p><ul>\n<li>@ä»¤ç‹å°‘ä¾  è¯´ï¼Œä»¥å‰ä¸€ç›´è®¤ä¸ºé—´éš™é”åªåœ¨äºŒçº§ç´¢å¼•ä¸Šæœ‰ã€‚ç°åœ¨ä½ çŸ¥é“äº†ï¼Œæœ‰é—´éš™çš„åœ°æ–¹å°±å¯èƒ½æœ‰é—´éš™é”ã€‚</li>\n<li>@æµªé‡Œç™½æ¡ åŒå­¦é—®ï¼Œå¦‚æœæ˜¯varcharç±»å‹ï¼ŒåŠ é”è§„åˆ™æ˜¯ä»€ä¹ˆæ ·çš„ã€‚<br>\nå›ç­”ï¼šå®é™…ä¸Šåœ¨åˆ¤æ–­é—´éš™çš„æ—¶å€™ï¼Œvarcharå’Œintæ˜¯ä¸€æ ·çš„ï¼Œæ’å¥½åºä»¥åï¼Œç›¸é‚»ä¸¤ä¸ªå€¼ä¹‹é—´å°±æœ‰é—´éš™ã€‚</li>\n<li>æœ‰å‡ ä½åŒå­¦æåˆ°è¯´ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è‡ªå·±éªŒè¯çš„ç»“æœè·Ÿæ¡ˆä¾‹ä¸€ä¸åŒï¼Œå°±æ˜¯åœ¨session Aæ‰§è¡Œå®Œè¿™ä¸¤ä¸ªè¯­å¥ï¼š</li>\n</ul><pre><code>begin;\nselect * from t where d=5 for update; /*Q1*/\n</code></pre><p>ä»¥åï¼Œsession B çš„update å’Œsession Cçš„insert éƒ½ä¼šè¢«å µä½ã€‚è¿™æ˜¯ä¸æ˜¯è·Ÿæ–‡ç« çš„ç»“è®ºçŸ›ç›¾ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ï¼Œè¿™ä¸ªä¾‹å­ç”¨çš„æ˜¯åè¯å‡è®¾ï¼Œå°±æ˜¯å‡è®¾ä¸å µä½ï¼Œä¼šå‡ºç°é—®é¢˜ï¼›ç„¶åï¼Œæ¨å¯¼å‡ºsession Aéœ€è¦é”æ•´ä¸ªè¡¨æ‰€æœ‰çš„è¡Œå’Œæ‰€æœ‰é—´éš™ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@ æŸã€äºº ã€@éƒ­æ±Ÿä¼Ÿ ä¸¤ä½åŒå­¦å°è¯•åˆ†æäº†ä¸ŠæœŸé—®é¢˜ï¼Œå¹¶ç»™äº†æœ‰å¯å‘æ€§çš„è§£ç­”ã€‚</p>\n</blockquote><p></p>","neighbors":{"left":{"article_title":"20 | å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ","id":75173},"right":{"article_title":"22 | MySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ","id":75746}},"comments":[{"had_liked":false,"id":56632,"user_name":"å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥Â·å·´å•¦å•¦èƒ½é‡Â·å •è½è¾¾","can_delete":false,"product_type":"c1","uid":1185642,"ip_address":"","ucode":"080BBCEF7DE985","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/6a/c979163e.jpg","comment_is_top":true,"comment_ctime":1546512022,"is_pvip":false,"replies":[{"id":"20433","content":"1. Next-key lock å°±æ˜¯é—´éš™é”â•è¡Œé”ï¼Œæ‰€ä»¥åŒ…å«=5è¿™ä¸€è¡Œ<br>2. å¯¹<br>3. (c=5,id=50)æ˜¯åœ¨è¿™ä¸ªgapé‡Œå“¦ï¼Œä½ è¯•è¯•æ’å…¥(1,5,50)å¯¹æ¯”ä¸€ä¸‹ã€‚å¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546526369,"ip_address":"","comment_id":56632,"utype":1}],"discussion_count":28,"race_medal":0,"score":"9.2233723046892995e+18","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚å‡æœŸçš„æ²¡è·Ÿä¸Šï¼Œä»Šå¤©è¡¥åˆ°äº†è¿™èŠ‚è¯¾ï¼Œçœ‹äº†ä¹‹åæœ‰å‡ ç‚¹ä¸æ˜¯å¤ªæ˜ç™½ã€‚æœ›èƒ½è§£ç­”ä¸€ä¸‹ã€‚<br>1. ç´¢å¼•cä¸Šçš„é”ç®—ä¸ç®—æ˜¯è¡Œé”ã€‚å‡å¦‚ç´¢å¼•cä¸Šçš„next-key lockä¸º(0,5] (5,10]ï¼Œé‚£ä¹ˆ5ç®—ä¸ç®—æ˜¯cä¸Šçš„è¡Œé”ï¼Ÿ<br>2. åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œæ‰§è¡Œ â€œdelete from t where c=10;â€ è¯­å¥ï¼Œç´¢å¼•cä¸Šçš„next-key lockæ˜¯(5,10],(10,10],(10,15)ã€‚é‚£ä¹ˆä¸»é”®ç´¢å¼•ä¸Šçš„é”æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯åªæœ‰è¡Œé”ï¼Œé”ä½çš„æ˜¯ (10,10,10) å’Œ (30,10,30) ä¸¤è¡Œå—ï¼Ÿ<br>3. ä¹Ÿæ˜¯åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œsession Aä¸å˜ï¼Œåœ¨session Bä¸­æ‰§è¡Œ â€œupdate t_20 set d=50 where c=5;â€ã€â€œupdate t_20 set d=50 where c=15;â€ã€â€œinsert into t_20 values(40,15,40);â€å‡æ‰§è¡ŒæˆåŠŸï¼Œä½†æ‰§è¡Œâ€œinsert into t_20 values(50,5,50);â€ æ—¶ï¼Œå´è¢«é˜»å¡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…·ä½“æ‰§è¡Œè¯­å¥å¦‚ä¸‹<br>session A<br>mysql&gt; begin;<br>mysql&gt; explain delete from t_20 where c=10;<br>id\tselect_type\ttable\tpartitions\ttype\tpossible_keys\tkey\tkey_len\tref\trows\tfiltered\tExtra<br>1\tDELETE\tt_20\t\trange\tc\tc\t5\tconst\t2\t100\tUsing where<br>mysql&gt; delete from t_20 where c=10;<br><br>session B<br>mysql&gt; update t_20 set d=50 where c=5;<br>Query OK, 1 row affected (0.01 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; update t_20 set d=50 where c=15;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; insert into t_20 values(40,15,40);<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; explain insert into t_20 values(50,5,50);<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>|  1 | INSERT      | t_20  | NULL       | ALL  | c             | NULL | NULL    | NULL | NULL |     NULL | NULL  |<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into t_20 values(50,5,50);<br>ï¼ˆblockï¼‰<br><br>æˆ‘ä½¿ç”¨çš„mysqlç‰ˆæœ¬æ˜¯ï¼š5.7.23-0ubuntu0.16.04.1<br>show variablesçš„ç»“æœå¤ªå¤šï¼Œæˆ‘æˆªå–äº†ä¸€éƒ¨åˆ†ï¼Œæˆ–è®¸å¯¹æ‚¨åˆ†ææœ‰å¸®åŠ©ï¼š<br>innodb_version\t5.7.23<br>protocol_version\t10<br>slave_type_conversions\t<br>tls_version\tTLSv1,TLSv1.1<br>version\t5.7.23-0ubuntu0.16.04.1<br>version_comment\t(Ubuntu)<br>version_compile_machine\tx86_64<br>version_compile_os\tLinux","like_count":63,"discussions":[{"author":{"id":2497728,"avatar":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","nickname":"æˆ‘æ˜¯å¤§æ©™å­132","note":"","ucode":"61660568CF07C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565652,"discussion_content":"å¥½é—®é¢˜ï¼Œå¥½å›ç­”ã€‚é—´éš™é”åŠ åœ¨æ™®é€šç´¢å¼•ä¸Šè¦æ³¨æ„ç´¢å¼•å€¼å¯èƒ½é‡å¤çš„æƒ…å†µï¼Œæƒ³ç­‰æƒ…å†µä¸‹ï¼Œä¸åŒä¸»é”®idé—´è¿˜æœ‰é—´éš™ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1650509828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435160,"discussion_content":"1. Next-key lock å°±æ˜¯é—´éš™é”â•è¡Œé”ï¼Œæ‰€ä»¥åŒ…å«=5è¿™ä¸€è¡Œ\n2. å¯¹\n3. (c=5,id=50)æ˜¯åœ¨è¿™ä¸ªgapé‡Œå“¦ï¼Œä½ è¯•è¯•æ’å…¥(1,5,50)å¯¹æ¯”ä¸€ä¸‹ã€‚å¥½é—®é¢˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546526369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"è‰¿è‰¿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38298,"discussion_content":"3 çš„å›ç­”å¥½è¯„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571757098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672042,"avatar":"https://static001.geekbang.org/account/avatar/00/19/83/6a/ea7e304e.jpg","nickname":"ğŸ¥","note":"","ucode":"0F8DC29949CDAE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410743,"discussion_content":"æ ‡è®°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635768886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005217,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/a1/abb7bfe3.jpg","nickname":"skyitachi","note":"","ucode":"FED5D96CC717B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284843,"discussion_content":"ä¸ºå•¥æˆ‘çš„insert values(1, 5, 50) ä¹Ÿä¼šè¢«é”ä½å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592659036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236602,"discussion_content":"æœ‰ä¸ªéå¸¸ä¸è§£çš„é—®é¢˜ï¼Œæ¡ˆä¾‹8ï¼Œå¦‚æœæˆ‘åœ¨sessionAå‡ºæ‰§è¡ŒINSERT INTO t VALUES(12,12,12);ç«Ÿç„¶èƒ½æ’å…¥æˆåŠŸï¼›session Bçš„updateè¯­å¥éš¾é“æ²¡ç»™cåŠ  ï¼ˆ10ï¼Œ15ï¼‰çš„next-key lockå—ï¼Ÿä¸ºä»€ä¹ˆæˆ‘å•ç‹¬æ‰§è¡Œsession Bï¼Œå®ƒå°±ä¼šåŠ ï¼ˆ10ï¼Œ15ï¼‰çš„next-key lockï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587108128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1240510,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/UXCLpCDP4o2LFpLIrEup2arUOHzwhPY3X8nOoNSRwS6NgNiaQEduN8exnEDicc8goGCARIthOzwEpGATpiadzv3oQ/132","nickname":"formain","note":"","ucode":"D0B7816D6A40E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274800,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯æ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œç”±äºsession2è¢«c=10çš„è¡Œé”é˜»å¡ï¼Œä¸ä¼šç»§ç»­å¾€åæŸ¥æ‰¾ï¼Œæ‰€æœ‰æ²¡æœ‰æŒæœ‰ï¼ˆ10ï¼Œ15ï¼‰çš„é—´éš™é”ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590623626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":236602,"ip_address":""},"score":274800,"extra":""},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"ä¸€å…ƒ(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304365,"discussion_content":"ç¡®å®æ²¡åŠ å“¦ï¼Œå› ä¸º next-key lock æ˜¯è¦åˆ†æˆé—´éš™é”å’Œè¡Œé”ä¸¤æ®µæ¥æ‰§è¡Œçš„ï¼Œå…ˆåŠ é—´éš™é”ï¼ˆ5ï¼Œ10ï¼‰,å†åŠ è¡Œé”10ï¼Œç”±äºé—´éš™é”ä¹‹é—´æ˜¯ä¸ä¼šå†²çªçš„ï¼Œæ‰€ä»¥åŠ é—´éš™é”(5,10)ä¸ä¼šé˜»å¡ï¼Œè€ŒåŠ è¡Œé”10ï¼Œå°±ç«‹åˆ»é˜»å¡äº†ï¼Œå¯¼è‡´åé¢çš„é—´éš™é”ï¼ˆ10ï¼Œ15ï¼‰æ˜¯æ²¡æœ‰åŠ çš„","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1599554206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":236602,"ip_address":""},"score":304365,"extra":""},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589503,"discussion_content":"(5,10)é—´éš™é”åŠ æˆåŠŸäº†ï¼Œå°è¯•åŠ c=10è¢«é˜»å¡ï¼Œå› æ­¤æ²¡æœ‰åé¢çš„è¿‡ç¨‹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665049867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":236602,"ip_address":"é™•è¥¿"},"score":589503,"extra":""}]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":144047,"discussion_content":"æˆ‘çš„ç‰ˆæœ¬æ˜¯5.7.25-28,å‘ç°é—´éš™çš„ä¾‹å­å…¨æ²¡å¤ç°ï¼Œæ˜¯ä¸æ˜¯è¿™äº›ç‰ˆæœ¬åŠ é”æœºåˆ¶åˆå‘ç”Ÿå˜åŒ–äº†å•Šï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579520052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344891,"discussion_content":"å…ˆè¦ç¡®è®¤ä¸€ä¸‹ éš”ç¦»çº§åˆ«æ˜¯å¦æ˜¯ rr  è‡ªåŠ¨æäº¤æ˜¯å¦å…³é—­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611622591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":144047,"ip_address":""},"score":344891,"extra":""}]},{"author":{"id":1640757,"avatar":"https://static001.geekbang.org/account/avatar/00/19/09/35/7d2ced23.jpg","nickname":"æ ·å„¿","note":"","ucode":"AB01047991559C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":89937,"discussion_content":"å“ˆå“ˆï¼Œå­¦åˆ°äº†ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576764656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83023,"discussion_content":"æ˜ç™½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576411945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":8,"child_discussions":[{"author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":85717,"discussion_content":"æ²¡çœ‹æ˜ç™½(c=5, id=50)åœ¨å“ªä¸ªé—´éš™é‡Œï¼Œå¯ä»¥å¸®å¿™è§£é‡Šä¸€ä¸‹å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576569256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":83023,"ip_address":""},"score":85717,"extra":""},{"author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":85755,"discussion_content":"æ˜ç™½äº†ï¼Œåœ¨cç´¢å¼•æ ‘ä¸Šï¼Œ(c=5,id=50)æ˜¯åœ¨(c=5,id=5),(c=10,id=10)çš„èŒƒå›´å†…çš„,æ‰€ä»¥æ˜¯åœ¨(5,10)çš„é—´éš™é”èŒƒå›´å†…çš„","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1576572452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":83023,"ip_address":""},"score":85755,"extra":""},{"author":{"id":1293877,"avatar":"https://static001.geekbang.org/account/avatar/00/13/be/35/dd79037e.jpg","nickname":"a...Z","note":"","ucode":"5A5A44903785FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":98598,"discussion_content":"é—´éš™é”æ˜¯å‰å¼€åé—­åŒºé—´ï¼Œ5æ˜¯å¼€åŒºé—´ï¼Œæ€ä¹ˆä¼šåœ¨é—´éš™é”å†…å‘¢ï¼Ÿï¼Œå¸®å¿™è§£ç­”ä¸‹ï¼Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577175944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":85755,"ip_address":""},"score":98598,"extra":""}]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82961,"discussion_content":"é—®é¢˜3æ²¡æœ‰æ˜ç™½ï¼Œ(c=5, id=50) æ˜¯åœ¨å“ªä¸ªé—´éš™é‡Œé¢çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576405859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1652085,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKORTofsU89GYKtywquzKuEiabvZnEOonfMYKuCPlo8GDlXqZuJdBicu0XtlaeodH4BnmHV1kldSAwQ/132","nickname":"æœªæ¥æ€æ ·","note":"","ucode":"4E54EB62595B27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":138642,"discussion_content":"æ˜¯è¿™æ ·çš„ï¼Œc=5,id=50åœ¨cç´¢å¼•æ ‘ä¸‹æ˜¯è¿™ä¹ˆæ‰¾ä½ç½®çš„ï¼Œå…ˆæ ¹æ®c=5æ‰¾åˆ°ç¬¬ä¸€ä¸ªc=5çš„ä½ç½®å³ï¼ˆ5ï¼Œ5ï¼‰ï¼Œç„¶ååˆ¤æ–­idçš„å€¼ï¼Œå½“å‰æ’å…¥çš„idå€¼ä¸º50å¤§äº5ï¼Œæ‰€ä»¥è¦æ’åˆ° ï¼ˆ5ï¼Œ5ï¼‰ä¹‹åï¼Œä½†æ˜¯ï¼ˆ5ï¼Œ5ï¼‰ä¹‹åçš„è¿™ä¸ªé—´éš™è¢«é”äº†ï¼Œæ‰€ä»¥æ’å…¥å¤±è´¥ã€‚åŒç†å¦‚æœæ’å…¥çš„æ•°æ®æ˜¯c=5,id=1çš„è¯ï¼Œå› ä¸º1<5ï¼Œæ‰€ä»¥éœ€è¦æ’å…¥åˆ°ï¼ˆ5ï¼Œ5ï¼‰ä¹‹å‰ï¼Œè¿™ä¸ªé—´éš™æ²¡æœ‰è¢«é”ï¼Œæ‰€ä»¥å¯ä»¥æ’å…¥ã€‚ æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼šå…ˆæ ¹æ®ç´¢å¼•æ‰¾åˆ°é—´éš™é”çš„è¾¹ç•Œï¼Œç„¶åæ ¹æ®ä¸»é”®çš„å¤§å°åˆ¤æ–­æ’å…¥çš„ä½ç½®æ˜¯å¦åœ¨è¢«é”çš„é—´éš™ä¹‹å†…ã€‚æˆ‘æ˜¯çœ‹äº†ä¸‹é¢è¯„è®ºæ‰ç†è§£çš„ã€‚å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚","likes_number":40,"is_delete":false,"is_hidden":false,"ctime":1579258636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":82961,"ip_address":""},"score":138642,"extra":""},{"author":{"id":1115724,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","nickname":"ä¹˜é£","note":"","ucode":"0420C5535DACB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":250578,"discussion_content":"ä¸€æ­¥ä¸€æ­¥è¯´ã€‚\ndelete from t where c = 10 ;  é”å®šèŒƒå›´ä¸º (5,10] ,(10,15) ,æ³¨æ„ (5,10)çš„é—´éš™å·²é”å®šï¼Œè€Œå¯¹äº5è¿™ä¸ªèŠ‚ç‚¹å…¶å®æ˜¯ä¸åŒ…å«çš„ï¼Œå…¶ç´¢å¼•å€¼ä¸º(5,5)ã€‚\ninsert into t values(50,5,50)ï¼› ä¼šå‘è¾…åŠ©ç´¢å¼•Cæ’å…¥ä¸€ä¸ªå€¼ï¼Œå…¶å€¼ä¸º(5ï¼Œ50) , å› ä¸º(5,50) æ˜¯åœ¨ (5,5)è¿™ä¸ªç‚¹å³ä¾§ï¼Œè€Œè¿™ä¸ªé—´éš™å·²ç»è¢«é”å®šäº†ï¼Œå³åŒºé—´(5ï¼Œ10)è¿™ä¸ªåŒºé—´é”å®šçš„ï¼Œæ‰€ä»¥æ’å…¥å¤±è´¥ï¼Œè€Œæ’å…¥(5,1) åœ¨(5ï¼Œ5)ä¹‹å‰ï¼Œä¸åœ¨è¿™ä¸ªé—´éš™é”èŒƒå›´å†…\n\n\n","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1588030170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":82961,"ip_address":""},"score":250578,"extra":""},{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"é¢†å­","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1652085,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKORTofsU89GYKtywquzKuEiabvZnEOonfMYKuCPlo8GDlXqZuJdBicu0XtlaeodH4BnmHV1kldSAwQ/132","nickname":"æœªæ¥æ€æ ·","note":"","ucode":"4E54EB62595B27","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294829,"discussion_content":"æ‰€ä»¥æ¡ˆä¾‹äºŒçš„ç»“æœå¹¶ä¸æ­£ç¡®ï¼Œbegin ;insert into t values (7,10,7); è¿˜æ˜¯ä¼šé”ä½ï¼Œ10åˆ°åº•æ˜¯ä¸æ˜¯é—­åŒºé—´ï¼Œè¿˜è¦æ ¹æ®idåˆ¤æ–­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596011402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":138642,"ip_address":""},"score":294829,"extra":""}]},{"author":{"id":1732823,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/70/d7/d1049bae.jpg","nickname":"Geek_3004e0","note":"","ucode":"441D39BDC39E4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":73786,"discussion_content":"é—®é¢˜3åˆå­¦ä¹ åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575596244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55610,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1546242796,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1045223295724","product_id":100020801,"comment_content":"Happy New Year !è¿™ä¸ªä¸“æ ç»å¯¹æ˜¯æå®¢æ—¶é—´æœ€å¥½æˆ‘ä¹°è¿‡æœ€å€¼çš„ä¸“æ ã€‚","like_count":244,"discussions":[{"author":{"id":1270296,"avatar":"https://static001.geekbang.org/account/avatar/00/13/62/18/fa2b8381.jpg","nickname":"fishcried","note":"","ucode":"859D4460CF17F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266255,"discussion_content":"éå¸¸èµåŒ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589488513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018696,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/48/e2279b0e.jpg","nickname":"ç»µé˜³ç±³ç²‰å„¿çœŸå¥½åƒ","note":"","ucode":"F82499FD76B5EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4337,"discussion_content":"èµåŒ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565321471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2069361,"avatar":"","nickname":"æ—é™","note":"","ucode":"492618873E9B1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591593,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666683927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ç¾å›½"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56298,"user_name":"Chu~â™¡Â·ã®~","can_delete":false,"product_type":"c1","uid":1057960,"ip_address":"","ucode":"69B0FBEC66FD48","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/a8/c0148cb8.jpg","comment_is_top":false,"comment_ctime":1546417473,"is_pvip":false,"replies":[{"id":"20257","content":"å—¯å—¯ï¼Œå¯ä»¥çš„ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546421286,"ip_address":"","comment_id":56298,"utype":1}],"discussion_count":6,"race_medal":0,"score":"615726740801","product_id":100020801,"comment_content":"æ˜¯ä¸æ˜¯å¯ä»¥æ€»ç»“ä¸ºï¼š<br>1ã€æŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè€ŒåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼ˆå‰å¼€åé—­ï¼‰ï¼›<br>2ã€ç­‰å€¼æŸ¥è¯¢ä¸ŠMySQLçš„ä¼˜åŒ–ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œnext-key lockä¼šé€€åŒ–ä¸ºè¡Œé”ï¼Œå¦‚æœä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œéœ€è¦è®¿é—®åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œæ­¤æ—¶next-key lockä¼šé€€åŒ–ä¸ºé—´éš™é”ï¼›<br>3ã€èŒƒå›´æŸ¥è¯¢ï¼šæ— è®ºæ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒèŒƒå›´æŸ¥è¯¢éƒ½éœ€è¦è®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ï¼›","like_count":144,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434977,"discussion_content":"å—¯å—¯ï¼Œå¯ä»¥çš„ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546421286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1433095,"avatar":"https://static001.geekbang.org/account/avatar/00/15/de/07/9525a99b.jpg","nickname":"èšŠå­ä¸ºä»€ä¹ˆä¸å’¬çŒ«","note":"","ucode":"7C2D2461D6494A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334009,"discussion_content":"ç¬¬ä¸‰ç‚¹ï¼šå¦‚æœæŸ¥è¯¢æ˜¯id>5ï¼Œä¼šä¸ä¼šå˜æˆè¡¨é”ï¼Ÿï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607692561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2435796,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2a/d4/c991387b.jpg","nickname":"what","note":"","ucode":"F9139063942C4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561542,"discussion_content":"æ€»ç»“åˆ°ä½ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649667171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2845977,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/6d/19/204b0900.jpg","nickname":"Black Jack","note":"","ucode":"CB16C8F44EF422","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537034,"discussion_content":"æ€»ç»“çš„å¥½â€˜â€™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638939189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2340277,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIj43LHM3EMNT9m1zRuluxXcHicoiaq2lSibicGFUjQamExNxKicQYLboXPmhFsT6T0SriakzDpGkFkWBag/132","nickname":"Geek_88e281","note":"","ucode":"0724F70BEE2A30","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370907,"discussion_content":"å°äº5çš„å¯ä»¥æ’å…¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619577791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2359215,"avatar":"https://static001.geekbang.org/account/avatar/00/23/ff/af/0dd061e6.jpg","nickname":"jet","note":"","ucode":"FDF6CEB9BE6622","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339971,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609852757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57700,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1546870286,"is_pvip":false,"replies":[{"id":"21105","content":"å¥½é—®é¢˜ï¼Œè´¨é‡å¾ˆé«˜çš„ç¬”è®°","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547117592,"ip_address":"","comment_id":57700,"utype":1}],"discussion_count":50,"race_medal":0,"score":"504058043918","product_id":100020801,"comment_content":"é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œåœ¨è€å¸ˆçš„è§£ç­”ä¸‹ç»ˆäºå¼„æ˜ç™½äº†ï¼š<br><br>CREATE TABLE z (<br>  id INT PRIMARY KEY AUTO_INCREMENT,<br>  b  INT,<br>  KEY b(b)<br>)<br>  ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8;<br><br>INSERT INTO z (id, b)<br>VALUES (1, 2),<br>  (3, 4),<br>  (5, 6),<br>  (7, 8),<br>  (9, 10);<br><br>session A<br><br>BEGIN;<br>SELECT *<br>FROM z<br>WHERE b = 6 FOR UPDATE;<br><br>session B <br>INSERT INTO z VALUES (0, 4);<br>è¿™é‡Œä¸ºä»€ä¹ˆä¼šè¢«é”ä½<br><br>ç­”æ¡ˆæ¯”è¾ƒé•¿ï¼Œå†™åœ¨æˆ‘è‡ªå·±çš„ç¬”è®°é‡Œäº†ï¼Œåœ°å€æ˜¯ https:&#47;&#47;helloworlde.github.io&#47;blog&#47;blog&#47;MySQL&#47;MySQL-%E4%B8%AD%E5%85%B3%E4%BA%8Egap-lock-next-key-lock-%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98.html<br><br>å¤§å®¶å¯ä»¥çœ‹çœ‹","like_count":118,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435710,"discussion_content":"å¥½é—®é¢˜ï¼Œè´¨é‡å¾ˆé«˜çš„ç¬”è®°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547117592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293862,"discussion_content":"æˆ‘æ¥æŒ‡å‡ºç­”ä¸»çš„ç¬”è®°å­˜åœ¨çš„é—®é¢˜ï¼šç­”ä¸»æ–‡ç« ä¸­æåˆ°bç´¢å¼•çš„é”èŒƒå›´ä¼šéšç€idçš„å€¼å˜åŒ–è€Œå˜åŒ–ï¼Œè¿™å®Œå…¨æ˜¯å› æœå€’ç½®çš„ï¼›\nä¸ºä»€ä¹ˆä¼šå‡ºç°session2çš„å„æ¡è¯­å¥çš„ç°è±¡å‘¢ï¼Ÿæ˜¯å› ä¸ºæ’å…¥çš„æ•°æ®çš„é¡ºåºæ˜¯å…ˆä»¥bç´¢å¼•æ’åºï¼Œç„¶åæŒ‰idç´¢å¼•æ’åºï¼Œbç´¢å¼•ä¸Šçš„é”æ˜¯(4, 6], (6,8)ï¼Œå³ï¼ˆ4ï¼Œ8ï¼‰éƒ½æ˜¯é”ä½çš„ï¼Œè¿™é‡Œåªæ˜¯é”ä½äº†bç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•æ²¡é”ï¼Œå’±ä»¬ä¸€æ¡è¯­å¥ä¸€æ¡è¯­å¥è§£é‡Šï¼š\nè¡¨é‡Œå·²æœ‰æ•°æ®\n+----+------+\n| id | b    |\n+----+------+\n|  1 |    2 |\n|  3 |    4 |\n|  5 |    6 |\n|  7 |    8 |\n|  9 |   10 |\n+----+------+\n1. INSERT INTO z VALUES (2, 4);/*success*/    id=2 b=4, è¿™æ—¶4å¯ä»¥æ’åœ¨ç¬¬äºŒè¡Œï¼ˆ3ï¼Œ4ï¼‰æ•°æ®ä¹‹å‰æˆ–è€…ä¹‹åï¼Œä½†å› ä¸ºid=2,åªèƒ½æ’åœ¨ç¬¬äºŒè¡Œï¼Œå› ä¸ºä¹Ÿä¼šæŒ‰ç…§ä¸»é”®idæ’åºï¼Œè¿™æ—¶å¯ä»¥æ’å…¥æˆåŠŸ\n2. INSERT INTO z VALUES (2, 8);/*blocked*/   id=2 b=8, 8å¯ä»¥æ’åœ¨ç¬¬å››è¡Œï¼ˆ7ï¼Œ8ï¼‰å‰æˆ–è€…åï¼Œä½†æ˜¯å› ä¸º2æ¯”ç¬¬å››è¡Œçš„id=7å°ï¼Œæ‰€ä»¥åªä¼šæ’åœ¨å‰é¢ï¼Œä½†è¿™é‡Œbå·²ç»è¢«é”ä½äº†ï¼Œåªèƒ½blockedäº†\n3. INSERT INTO z VALUES (4, 4);/*blocked*/  å’Œä»¥ä¸Šåˆ†æä¸€è‡´ï¼Œåªèƒ½æ’åœ¨ç¬¬äºŒè¡Œåé¢ï¼Œå¯æ˜¯è¿™ä¸ªèŒƒå›´bä¸Šå·²åŠ é”ï¼Œä¹Ÿåªèƒ½è¢«blockä½\n\nåé¢è¯­å¥åŒç†","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1595690281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":9,"child_discussions":[{"author":{"id":1363230,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cd/1e/692c3313.jpg","nickname":"å¤å…´","note":"","ucode":"C172A87873001A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300422,"discussion_content":"é‚£ä¸ºä»€ä¹ˆbç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œè¦ä¿æŒidæœ‰åºå‘¢ï¼Œè¿™ä¸ªæˆ‘æ‰¾ä¸åˆ°ç›¸åº”èµ„æ–™æ¥è¯æ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598090363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293862,"ip_address":""},"score":300422,"extra":""},{"author":{"id":2122601,"avatar":"https://static001.geekbang.org/account/avatar/00/20/63/69/e16ed359.jpg","nickname":"æœ¨æœ‰æ¢¦æƒ³","note":"","ucode":"6366D107BBA553","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1363230,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cd/1e/692c3313.jpg","nickname":"å¤å…´","note":"","ucode":"C172A87873001A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309417,"discussion_content":"æœ€å·¦å‰ç¼€åŸåˆ™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601283768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":300422,"ip_address":""},"score":309417,"extra":""},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"æµ·æµª","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327761,"discussion_content":"çº æ­£ä½ ä¸€ä¸‹ï¼ŒUpdate/deleteè¯­å¥ï¼Œé€šè¿‡è¾…åŠ©ç´¢å¼•åŠ é”çš„è¯­å¥ï¼Œè€ƒè™‘é¢å¤–åœ°ä¸»é”®ç´¢å¼•ä¸Šä¹Ÿè¦åŠ é”ã€‚--å¯ä»¥çœ‹çœ‹å§œæ‰¿å°§ã€ŠMYSQLå†…æ ¸ã€‹ç¬¬ä¹ç« \n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605940464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293862,"ip_address":""},"score":327761,"extra":""}]},{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195371,"discussion_content":"æ’å…¥è‡ªå¢id=0çš„æ—¶å€™,ä¼šåˆ¤æ–­id=0åè‡ªåŠ¨ç”Ÿæˆä¸»é”®id=10 session bç›¸å½“äºæ’å…¥çš„æ˜¯(id=10,b=4)çš„æ•°æ®;å› ä¸ºsession AæŸ¥è¯¢äº†b=6æ—¶,ä¼šç»™bç´¢å¼•ä¸Š(4,6] next-key lock (6,8) gap,å…¶ä¸­4å¯¹åº”çš„æ˜¯(d=4,id=3)çš„æ•°æ®;é‚£ä¹ˆæ’å…¥id=10,b=4çš„æ•°æ®åŒºé—´æ˜¯åœ¨d=4,id=3ä¹‹åçš„å³åœ¨(4,6]next-key lockä¸­æ‰€ä»¥é˜»å¡","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1583272936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1310826,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/6a/da96c764.jpg","nickname":"å°¹å¸Œé—¯","note":"","ucode":"A35F70179808D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214577,"discussion_content":"è¯·é—®ï¼ˆ4,6]å“ªé‡Œæ¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585210280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":195371,"ip_address":""},"score":214577,"extra":""},{"author":{"id":1018685,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/3d/0c3a2fd4.jpg","nickname":"å¶å°”å¤æ´»ä¸‹","note":"","ucode":"18B1D525CD50D3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1310826,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/6a/da96c764.jpg","nickname":"å°¹å¸Œé—¯","note":"","ucode":"A35F70179808D8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299381,"discussion_content":"çœ‹è®°å½•ï¼Œä»è®°å½•ä¸­æ¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597669582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":214577,"ip_address":""},"score":299381,"extra":""},{"author":{"id":2287841,"avatar":"https://static001.geekbang.org/account/avatar/00/22/e8/e1/6045b299.jpg","nickname":"LPF","note":"","ucode":"036C552D7251E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330858,"discussion_content":"ä¸åŒ…å«(4,10)åŒ…å«åœ¨(4,3)~(6,5)å·¦å¼€å³é—­åŒºé—´ï¼Œæ‰€ä»¥æ’å…¥ä¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606723287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":195371,"ip_address":""},"score":330858,"extra":""}]},{"author":{"id":1374445,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f8/ed/60fb8fba.jpg","nickname":"é™ˆå°æ¸£ğŸ‘»","note":"","ucode":"6B968B06C76C63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324163,"discussion_content":"æ’å…¥ï¼ˆ0,4ï¼‰mysqlä¸»é”®ä¸ä¸º0ä¼šå˜æˆæ’å…¥ï¼ˆ10,4ï¼‰è¿™ä¸ªæ—¶å€™éœ€è¦æ’å…¥åœ¨ï¼ˆ3,4ï¼‰ï¼ˆ5,6ï¼‰ä¹‹é—´ï¼Œä½†æ˜¯è¿™ä¸ªä½ç½®æœ‰é—´éš™é”ï¼Œæ‰€ä»¥è¢«é˜»å¡","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1605063517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344034,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c4/62/269aae3f.jpg","nickname":"æ°´æœˆ","note":"","ucode":"78FC68615016DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411389,"discussion_content":"å°±å¡åœ¨auto_incrementçš„ä¸»é”®ä¸Šäº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1635915965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2254917,"avatar":"https://static001.geekbang.org/account/avatar/00/22/68/45/ddf89612.jpg","nickname":"bestgopher","note":"","ucode":"D89735C8CA9C6E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":2344034,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c4/62/269aae3f.jpg","nickname":"æ°´æœˆ","note":"","ucode":"78FC68615016DB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552171,"discussion_content":"idä¸º0ä¼šè‡ªåŠ¨å˜æˆid=10","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1645335927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":411389,"ip_address":""},"score":552171,"extra":""}]},{"author":{"id":2357566,"avatar":"https://static001.geekbang.org/account/avatar/00/23/f9/3e/0d5f27c4.jpg","nickname":"è‚¥çŒ«ä¸å¼€å¿ƒ","note":"","ucode":"FA9204B84913C0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384045,"discussion_content":"å¯ä»¥ 0å˜10é‚£ä¸ªæˆ‘è¿˜çœŸä¸çŸ¥é“â€¦æˆ‘å°±çŸ¥é“nullå˜10","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1626343550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266466,"discussion_content":"çœ‹äº†è¿™ç¯‡æ³¨æ„åˆ°è¦éä¸»é”®ç´¢å¼•ä¸Šé”ä¹Ÿè€ƒè™‘äº†idçš„å€¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589519284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589505,"discussion_content":"ç”±äºidæ˜¯è‡ªå¢å€¼ï¼Œæ’å…¥0æˆ–è€…nullï¼Œç³»ç»Ÿéƒ½ä¼šåˆ†é…ä¸‹ä¸€æ¬¡è‡ªå¢å€¼10ï¼Œå› æ­¤å®é™…æ’å…¥çš„æ˜¯ï¼ˆ10,4ï¼‰ï¼›ï¼ˆ10,4ï¼‰æ˜¯åœ¨ï¼ˆ6,4ï¼‰çš„å³è¾¹ï¼Œåœ¨é—´éš™é”çš„èŒƒå›´å†…ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1665050306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2459923,"avatar":"https://static001.geekbang.org/account/avatar/00/25/89/13/0d3c5008.jpg","nickname":"æœ€å¥½ä¸è¿‡","note":"","ucode":"C7DBCD08402DF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378570,"discussion_content":"ç¡®å®è§£å†³äº†æˆ‘ä¸Šä¸€è®²ä¸­è¯„è®ºåŒºupdate t set c=10 where id=0ï¼›ä¸ºä»€ä¹ˆé˜»å¡çš„ç–‘æƒ‘","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623290028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2837603,"avatar":"","nickname":"Geek_18e6f5","note":"","ucode":"3700BC57DD6FF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2459923,"avatar":"https://static001.geekbang.org/account/avatar/00/25/89/13/0d3c5008.jpg","nickname":"æœ€å¥½ä¸è¿‡","note":"","ucode":"C7DBCD08402DF8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413652,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ï¼Œæƒ³å“­äº†ï¼Œç°åœ¨æ˜ç™½ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636535473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":378570,"ip_address":""},"score":413652,"extra":""}]},{"author":{"id":2557344,"avatar":"https://static001.geekbang.org/account/avatar/00/27/05/a0/a8218edd.jpg","nickname":"å†è§æ—§æ—¶å…‰","note":"","ucode":"00EE3724636749","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372200,"discussion_content":"çœ‹äº†ç¬”è®°ï¼Œå¾ˆniceï¼Œç»†å“ä¸€ä¸‹ï¼Œæœ‰æ”¶è·ã€‚ä»¥ä¸‹çº¯å±ä¸ªäººç†è§£ï¼šé¦–å…ˆé”çš„èŒƒå›´æ˜¯ã€b, idã€‘ï¼ˆ4,3ï¼‰åˆ°ï¼ˆ8, 7ï¼‰ï¼Œå…ˆçœ‹æ’å…¥çš„æ•°æ®\nINSERT INTO z VALUES (2, 4);/*success*/\nINSERT INTO z VALUES (2, 8);/*blocked*/\nINSERT INTO z VALUES (4, 4);/*blocked*/\nINSERT INTO z VALUES (4, 8);/*blocked*/\nINSERT INTO z VALUES (8, 4);/*blocked*/\nINSERT INTO z VALUES (8, 8);/*success*/\nINSERT INTO z VALUES (0, 4);/*blocked*/\nINSERT INTO z VALUES (-1, 4);/*success*/\n\nï¼ˆ4,  2ï¼‰ç»´åº¦ä¸Šå°äºï¼ˆ4,  3ï¼‰ï¼Œä¸ä¼šé˜»å¡ï¼Œ\nï¼ˆ8ï¼Œ2ï¼‰ç»´åº¦ä¸Šå°äºï¼ˆ8, 7ï¼‰ï¼Œåœ¨ï¼ˆ8,7ï¼‰çš„å·¦è¾¹ï¼Œå·¦è¾¹å¤„äºé”èŒƒå›´ï¼Œé˜»å¡\nï¼ˆ4ï¼Œ4ï¼‰ç»´åº¦ä¸Šå¤§äºï¼ˆ4, 3ï¼‰ï¼Œåœ¨ï¼ˆ4,3ï¼‰çš„å³è¾¹ï¼Œå³è¾¹å¤„äºé”èŒƒå›´ï¼Œé˜»å¡\nï¼ˆ8, 4ï¼‰ç»´åº¦ä¸Šå°äºï¼ˆ8,7ï¼‰ï¼Œåœ¨ï¼ˆ8,7ï¼‰å·¦è¾¹ï¼Œå¤„äºé”èŒƒå›´å†…ï¼Œé˜»å¡\nï¼ˆ8,8ï¼‰ç»´åº¦ä¸Šå¤§äºï¼ˆ8,7ï¼‰ï¼Œåœ¨ï¼ˆ8,7ï¼‰å³è¾¹ï¼Œä¸å¤„äºé”èŒƒå›´ï¼Œå¯ä»¥æ’å…¥æˆåŠŸ\nï¼ˆ0ï¼Œ4ï¼‰ç”±äºæ˜¯è‡ªå¢ä¸»é”®ï¼Œæ‰€ä»¥0ä¼šè¢«æ›¿æ¢æˆ10ï¼Œç›¸å½“äºæ’å…¥ï¼ˆ4, 10ï¼‰,åŒæ ·å¤„äºé”èŒƒå›´å†…ï¼Œé˜»å¡ã€‚æ ¸å¿ƒå°±æ˜¯é”èŒƒå›´çš„åˆ¤æ–­ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620223352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2797976,"avatar":"","nickname":"Geek_323a60","note":"","ucode":"CDC276EC255411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2557344,"avatar":"https://static001.geekbang.org/account/avatar/00/27/05/a0/a8218edd.jpg","nickname":"å†è§æ—§æ—¶å…‰","note":"","ucode":"00EE3724636749","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585208,"discussion_content":"è¿™é‡Œ (0,4) é˜»å¡ä¸ºä»€ä¹ˆæ˜¯è‡ªå¢ä¸»é”®ï¼Œåˆä¸ºä»€ä¹ˆä¼šå°†0 å˜æˆ 10ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661397511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372200,"ip_address":"å››å·"},"score":585208,"extra":""}]},{"author":{"id":1261360,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/30/23f6b413.jpg","nickname":"äº”åä¹ç§’","note":"","ucode":"1F34F62193CFF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307740,"discussion_content":"ä¸é”™çš„åˆ†ææ€è·¯ï¼Œåªæ˜¯ç»“è®ºæœ‰ç‚¹åƒçœ‹èµ°è¿‘ç§‘å­¦çš„æ„Ÿè§‰ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600747197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243331,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f8/c3/1d557354.jpg","nickname":"o my love","note":"","ucode":"307601ACAC5DCC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577338,"discussion_content":"å…³é”®å°±æ˜¯insert è‡ªåŠ¨å¢é•¿idå¡«å†™ä¸º0ï¼Œidä¼šå˜æˆå¢é•¿å€¼ï¼Œnext-key lockåé—­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656040764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1049761,"avatar":"https://static001.geekbang.org/account/avatar/00/10/04/a1/c853ee82.jpg","nickname":"heartzwj410","note":"","ucode":"9C3E9F393F7C09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568501,"discussion_content":"ç¬”è®°å¥½åƒçœ‹ä¸äº†äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651152644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2856577,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NfCE5nCYiavXpVbHxZpHthACZNlHic0T82L7qldaLiatibS8npKt6bcmkIyYAiaD9Lic9M81YCY9E2JmnWZ412lBDG9w/132","nickname":"Geek_3b519f","note":"","ucode":"C5B1B6D12FA356","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560074,"discussion_content":"éœ‡æ’¼å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649155953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2837603,"avatar":"","nickname":"Geek_18e6f5","note":"","ucode":"3700BC57DD6FF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413651,"discussion_content":"å°è€å¼Ÿå¾ˆå¼º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636535450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1063308,"avatar":"https://static001.geekbang.org/account/avatar/00/10/39/8c/089525aa.jpg","nickname":"å°ä¹™å“¥","note":"","ucode":"C77E79BEA0C325","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401990,"discussion_content":"å­¦ä¹ äº†ï¼Œå‰å®³ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633779019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1517390,"avatar":"https://static001.geekbang.org/account/avatar/00/17/27/4e/cfc94866.jpg","nickname":"é±¼å¡˜å±€ç å†œ","note":"","ucode":"D265DB38AC5EA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387069,"discussion_content":"ç‰›é€¼ï¼Œå…„å¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627971631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1321726,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2a/fe/197449a0.jpg","nickname":"Hero","note":"","ucode":"33D7939CC3C815","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380457,"discussion_content":"æ¥¼ä¸»è¯·é—®åšå®¢æ˜¯æŒ‰ç…§ä»€ä¹ˆæ­å»ºçš„ï¼Ÿgitè¿˜æ˜¯å•¥ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624511876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1253634,"avatar":"https://static001.geekbang.org/account/avatar/00/13/21/02/a691a1d2.jpg","nickname":"mangoliu","note":"","ucode":"B065A045A806C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377897,"discussion_content":"å¤ªæ£’äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622954527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"å¼ ä¸‰ä¸°","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374334,"discussion_content":"è¿™ä¸ªåˆ†ææœ‰ç‚¹ç‰›é€¼äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621141864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005330,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/12/041c04fd.jpg","nickname":"ç‹æ˜Š","note":"","ucode":"CF0FB78E23ABD4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373475,"discussion_content":"å­¦ä¹ äº†~ å¾ˆæ£’ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620738333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2206508,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/O6qftWBakkjQHrAhF5tia21GKkQxibJaPy2nWUKc9eiaouaqb67Hj60RRKgjgHhzPmaxaHkLszcNYrDSkj21lPylQ/132","nickname":"Geek_a852c8","note":"","ucode":"D925A9D71A76BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363370,"discussion_content":"å…„å¼Ÿã€‚ç‰›é€¼ã€‚æ‡‚äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617182093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2099279,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erId7l2ynzbHOic3Ric8ZppfBDxVDfVeH3UtNFjsoFCCh0DHDzPeHDMVmEW7WIgNIba4CaIGGkNQVicg/132","nickname":"NaNrailgun","note":"","ucode":"32A674E8837380","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348618,"discussion_content":"è¯·é—®åœ°å€æ˜¯æ‰“ä¸å¼€äº†å—?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612667378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2108271,"avatar":"https://static001.geekbang.org/account/avatar/00/20/2b/6f/65a61041.jpg","nickname":"han","note":"","ucode":"1596D492F7CFB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2099279,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erId7l2ynzbHOic3Ric8ZppfBDxVDfVeH3UtNFjsoFCCh0DHDzPeHDMVmEW7WIgNIba4CaIGGkNQVicg/132","nickname":"NaNrailgun","note":"","ucode":"32A674E8837380","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388598,"discussion_content":"å¯ä»¥æ‰“å¼€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628844697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348618,"ip_address":""},"score":388598,"extra":""}]},{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277195,"discussion_content":"è¶…çº§æ£’çš„ç¬”è®°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591016088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1637598,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fc/de/5e20d32d.jpg","nickname":"JustRun","note":"","ucode":"8FC84531118FB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261016,"discussion_content":"éå¸¸è¯¦ç»†çš„ç¬”è®°ï¼Œå­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588930112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1756491,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/4b/36acd180.jpg","nickname":"Hhhhcl","note":"","ucode":"588D28DA42AFEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":67926,"discussion_content":"ä½ å¥½ï¼Œæˆ‘æƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ã€‚\nä¸ºä»€ä¹ˆæ’å…¥çš„è¿™äº›å€¼éƒ½æ˜¯æŒ‰ç…§å­—æ®µbæ¥æ’åºçš„ï¼Ÿè€Œä¸æ˜¯æŒ‰ç…§ä¸»é”®idæ¥æ’åºçš„\nå³ä¸ºä»€ä¹ˆï¼ˆ2ï¼Œ8ï¼‰æ˜¯æ’å…¥åœ¨ï¼ˆ5, 6ï¼‰~ï¼ˆ7,8ï¼‰\nè€Œä¸æ˜¯æ’å…¥åœ¨ï¼ˆ1,2ï¼‰~ï¼ˆ3,4ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575189059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1756491,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/4b/36acd180.jpg","nickname":"Hhhhcl","note":"","ucode":"588D28DA42AFEF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":85757,"discussion_content":"å› ä¸ºæ˜¯åœ¨bç´¢å¼•æ ‘ä¸Šï¼Œä¸æ˜¯åœ¨idä¸»é”®ç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576572595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":67926,"ip_address":""},"score":85757,"extra":""}]},{"author":{"id":1157761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/aa/81/97e36f32.jpg","nickname":"å½±å½±å½±","note":"","ucode":"5BE8847256B6B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22702,"discussion_content":"å¯èƒ½æ˜¯ç†è§£åŠ›ä¸è¶³çš„åŸå› ï¼Œçœ‹äº†ç¬”è®°å¹¶æ²¡èƒ½æ˜ç™½ã€‚ç¬”è®°ä¸­çš„ç»“è®ºä¹Ÿæ˜¯åæ¨å‡ºæ¥çš„ï¼ˆå› ä¸ºè¢«blockï¼Œæ‰€ä»¥æŸä¸ªä¸´ç•Œç‚¹è¢«åŠ äº†é”ï¼‰ã€‚å¸Œæœ›è€å¸ˆæˆ–è€…@undifinedèƒ½å†è§£é‡Šä¸‹ã€‚è°¢è°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569674523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1640757,"avatar":"https://static001.geekbang.org/account/avatar/00/19/09/35/7d2ced23.jpg","nickname":"æ ·å„¿","note":"","ucode":"AB01047991559C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1157761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/aa/81/97e36f32.jpg","nickname":"å½±å½±å½±","note":"","ucode":"5BE8847256B6B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":90111,"discussion_content":"ä¸ªäººæ„Ÿè§‰å±‚ä¸»ç¬”è®°å·²ç»å¾ˆè¯¦ç»†äº†ã€‚å†ç»“åˆè€å¸ˆçš„ä¾‹å­ç¢ç£¨ç¢ç£¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576766734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":22702,"ip_address":""},"score":90111,"extra":""},{"author":{"id":1934802,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/85/d2/045c63fb.jpg","nickname":"ç‹å»ºæ–°","note":"","ucode":"E3151DDC0EEF0D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1157761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/aa/81/97e36f32.jpg","nickname":"å½±å½±å½±","note":"","ucode":"5BE8847256B6B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336942,"discussion_content":"ä»–çš„ç¬”è®°ç¡®å®ä¸è¡Œ...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608731442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":22702,"ip_address":""},"score":336942,"extra":""}]},{"author":{"id":1142674,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6f/92/535160b0.jpg","nickname":"å•†ç¿é€†","note":"","ucode":"FA9522CEDA5635","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19390,"discussion_content":"çœŸä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569166597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618066,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/92/8db901ad.jpg","nickname":"èœé¸Ÿ","note":"","ucode":"9C28351664D773","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4188,"discussion_content":"ä½ å¥½ï¼Œä½ çš„ç¬”è®°é‡Œï¼Œä¸ºä»€ä¹ˆbçš„ç´¢å¼•é”èŒƒå›´æ ¹æ®ä¸åŒçš„idå–å€¼èŒƒå›´ä¸åŒå‘¢ï¼Œèƒ½å†ç»™è§£é‡Šä¸€ä¸‹å—ï¼Œæ„Ÿè°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565204380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":4,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1087300,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/44/52b5e2e2.jpg","nickname":"cweioo","note":"","ucode":"E48D291E6C6993","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1618066,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/92/8db901ad.jpg","nickname":"èœé¸Ÿ","note":"","ucode":"9C28351664D773","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34634,"discussion_content":"\næˆ‘ç†è§£æ˜¯è¿™æ ·çš„ï¼Œé”ä½çš„æ˜¯ï¼ˆ3ï¼Œ4ï¼‰åˆ°ï¼ˆ7ï¼Œ8ï¼‰ï¼ˆæ³¨ï¼šï¼ˆidï¼Œdï¼‰çš„æ ¼å¼ã€‚å½“è¦æ’å…¥ï¼ˆ4ï¼Œ4ï¼‰æ—¶ï¼Œå®ƒçš„ä½ç½®åœ¨é”ä½çš„åŒºé—´å†…ï¼ˆåœ¨ï¼ˆ3ï¼Œ4ï¼‰çš„åé¢ï¼‰ä¼šå¯¼è‡´é”ä½åŒºé—´å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ä¸å…è®¸æ’å…¥","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1571211690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4188,"ip_address":""},"score":34634,"extra":""},{"author":{"id":1087300,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/44/52b5e2e2.jpg","nickname":"cweioo","note":"","ucode":"E48D291E6C6993","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1618066,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/92/8db901ad.jpg","nickname":"èœé¸Ÿ","note":"","ucode":"9C28351664D773","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34636,"discussion_content":"æ’å…¥ï¼ˆ2ï¼Œ8ï¼‰åœ¨ï¼ˆ7ï¼Œ8ï¼‰å‰é¢ï¼Œæœ‰å¯¼è‡´è¿™ä¸ªåŒºé—´å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸å…è®¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571211837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4188,"ip_address":""},"score":34636,"extra":""}]}]},{"had_liked":false,"id":147981,"user_name":"Jayden ç‹å‡¯è±ª","can_delete":false,"product_type":"c1","uid":1592236,"ip_address":"","ucode":"6CAADB9B449892","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/ac/2a48928f.jpg","comment_is_top":false,"comment_ctime":1572924809,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"495494163849","product_id":100020801,"comment_content":"è·ŸOracle ç¡®è®¤è¿‡äº†ï¼Œå”¯ä¸€ç´¢å¼•èŒƒå›´é”çš„bugåœ¨æœ€æ–°çš„8.0.18å·²ç»ä¿®å¤ï¼","like_count":116,"discussions":[{"author":{"id":1106631,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e2/c7/f671bd93.jpg","nickname":"amy","note":"","ucode":"C6DAA11AFD3EC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297601,"discussion_content":"å¹¸å¥½çœ‹åˆ°è¿™ä¸ªè¯„è®ºï¼Œæˆ‘è‡ªå·±çš„mysqlç‰ˆæœ¬æ˜¯8.0.21ï¼Œæˆ‘å°±è¯´æ€ä¹ˆæˆ‘æ­»æ´»å¤ç°ä¸äº†å”¯ä¸€ç´¢å¼•èŒƒå›´é”çš„bug","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1596981967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058015,"avatar":"https://static001.geekbang.org/account/avatar/00/10/24/df/645f8087.jpg","nickname":"Yayu","note":"","ucode":"5E7842458D8229","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302257,"discussion_content":"è¿™ä¸ªè¯„è®ºåº”è¯¥ç½®é¡¶ï¼Œç”šè‡³åº”è¯¥è¡¥å……åˆ°å†…å®¹ä¸­å»ã€‚\næˆ‘çš„æ•°æ®åº“ç‰ˆæœ¬æ˜¯ 8.0.30 ä¹Ÿä¸å­˜åœ¨è¿™ä¸ªbugã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1598861294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1797216,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/6c/60/dadcf0b4.jpg","nickname":"æ³¡æ³¡é¾™","note":"","ucode":"F72BDC55C1DDFD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538203,"discussion_content":"æ–‡ä¸­æœ‰è¯´è§„åˆ™çš„é€‚ç”¨èŒƒå›´ ---â€œMySQL åé¢çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¹å˜åŠ é”ç­–ç•¥ï¼Œæ‰€ä»¥è¿™ä¸ªè§„åˆ™åªé™äºæˆªæ­¢åˆ°ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå³ 5.x ç³»åˆ— &lt;=5.7.24ï¼Œ8.0 ç³»åˆ— &lt;=8.0.13ã€‚â€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639365827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318233,"discussion_content":"å¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603684904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2283781,"avatar":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","nickname":"å’¦","note":"","ucode":"2E0D5A488489A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395394,"discussion_content":"mysql5.7.10 ç‰ˆæœ¬ï¼ŒRCçº§åˆ«ï¼ŒäºŒçº§å”¯ä¸€ç´¢å¼•ä¸‹çš„èŒƒå›´é”bugä¹‹å‰ä¹Ÿè¢«fixè¿‡ï¼Œä½†æ˜¯å¼•å‘äº†æ–°çš„é—®é¢˜ï¼Œåæ¥å¥½åƒåˆè¢«è¿˜åŸäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632298810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58264,"user_name":"Geek_9ca34e","can_delete":false,"product_type":"c1","uid":1222861,"ip_address":"","ucode":"9A9FDBBCCBE19B","user_header":"","comment_is_top":false,"comment_ctime":1547022859,"is_pvip":false,"replies":[{"id":"21017","content":"å¥½é—®é¢˜ï¼Œæˆ‘ä¼šåŠ åˆ°ç­”ç–‘æ–‡ç« ä¸­ï¼Œ<br>Gapæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547043896,"ip_address":"","comment_id":58264,"utype":1}],"discussion_count":6,"race_medal":0,"score":"310784668171","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼š<br>æˆ‘ç»ƒä¹ å®ä¾‹çš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é” bug<br>begin;<br>select * from t where id&gt;10 and id&lt;=15 for update;<br>1ã€æ‰§è¡Œå¦‚ä¸Šè¯­å¥åŠ é”èŒƒå›´(10,15]å’Œ(15,20]ï¼›<br>2ã€å› ä¸º10æœªåŠ é”ï¼Œæ‰€ä»¥æˆ‘å•ç‹¬å†å¼€ä¸€ä¸ªè¿æ¥ï¼Œæ‰§è¡Œdelete from t where id=10;ä¸ä¼šé”ç­‰å¾…ï¼Œèƒ½æ­£å¸¸åˆ é™¤ï¼›<br>3ã€ä½†æ˜¯æˆ‘å†æ‰§è¡Œinsert into t values(10,10,10); è¯­å¥ä¼šç­‰å¾…ï¼Œæ— æ³•æ­£å¸¸æ‰§è¡Œï¼›<br>4ã€ç»è¿‡åˆ†ææˆ‘å‘ç°ç¬¬ä¸€ä¸ªè¿æ¥æ‰§è¡Œçš„è¯­å¥çš„åŠ é”èŒƒå›´å·²ç»å˜æˆ(5,15]å’Œ(15,20]ï¼Œä»£è¡¨é”è”“å»¶äº†ï¼›è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":73,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435979,"discussion_content":"å¥½é—®é¢˜ï¼Œæˆ‘ä¼šåŠ åˆ°ç­”ç–‘æ–‡ç« ä¸­ï¼Œ\nGapæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547043896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"æµ·æµª","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327762,"discussion_content":"delete id=10ä¹‹åï¼Œä¸ºäº†åŸå…ˆçš„(10,15]ä¸­çš„gapé”ï¼Œä¼šç”¨10çš„ä¸Šä¸€ä¸ªå€¼5æ¥ä»£æ›¿","likes_number":14,"is_delete":false,"is_hidden":false,"ctime":1605941046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342221,"discussion_content":"é‡åˆ°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œæ›´æ–°è¾¹ç•Œå€¼å¯¼è‡´é—´éš™å˜å¤§ï¼Œå†æ”¹æˆåŸå€¼æ”¹ä¸å›å»ï¼Œè¢«é˜»å¡","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1610616921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661365,"avatar":"https://static001.geekbang.org/account/avatar/00/19/59/b5/26d3c637.jpg","nickname":"Yc","note":"","ucode":"407776D104D6F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366609,"discussion_content":"ä¸ºå•¥ï¼Œ10ä¸ä¼šè¢«é”ä½å‘¢ï¼Ÿæ¡ä»¶æ˜¯id>10ï¼ŒæŸ¥è¯¢è§„åˆ™æ˜¯é¦–å…ˆæ‰¾åˆ°id=10çš„è¿™è¡Œæ•°æ®ï¼Œç„¶åæ ¹æ®è¿™è¡Œæ•°æ®è¿›è¡Œå‘å³éå†ã€‚æŒ‰ç…§åŠ é”è§„åˆ™ï¼šåŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚\nåŠ é”çš„è¯ åœ¨æ ¹æ®ä¼˜åŒ–1ï¼šä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚  è¿™ä¸ªä¾‹å­ä¸ºå•¥ID=10ä¸åŠ é”ï¼ï¼ï¼ï¼Œæ±‚è€å¸ˆç¿»ç‰Œ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618132314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661365,"avatar":"https://static001.geekbang.org/account/avatar/00/19/59/b5/26d3c637.jpg","nickname":"Yc","note":"","ucode":"407776D104D6F8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374527,"discussion_content":"ä¼˜åŒ–1æ˜¯ç´¢å¼•ä¸Šé¢çš„ç­‰å€¼æŸ¥è¯¢ï¼Œè¿™ä¸ªæ˜¯å‰ææ¡ä»¶ï¼Œ>10ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621235346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":366609,"ip_address":""},"score":374527,"extra":""},{"author":{"id":1067438,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/ae/db795abf.jpg","nickname":"å·¨äºº","note":"","ucode":"5C41F6F1AF2A8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661365,"avatar":"https://static001.geekbang.org/account/avatar/00/19/59/b5/26d3c637.jpg","nickname":"Yc","note":"","ucode":"407776D104D6F8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391997,"discussion_content":"ä¸€æ ·ä¹Ÿæ²¡æ˜ç™½ï¼Œç¬¬30ç« é‡Œè¯´ä¸ç­‰äºé‡Œçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå’Œè¿™ä¸ªä¾‹å­æ„Ÿè§‰å†²çª","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630753440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":366609,"ip_address":""},"score":391997,"extra":""}]}]},{"had_liked":false,"id":55789,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1546309236,"is_pvip":false,"replies":[{"id":"20108","content":"æ–°å¹´å¥½<br><br>å¯¹çš„ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546315488,"ip_address":"","comment_id":55789,"utype":1}],"discussion_count":12,"race_medal":0,"score":"242064477812","product_id":100020801,"comment_content":"é¦–å…ˆè€å¸ˆæ–°å¹´å¿«ä¹ï¼Œå­¦ä¹ ä¸“æ å—ç›Šè‰¯å¤šï¼<br>ä¸ŠæœŸé—®è¿‡è€å¸ˆçš„é—®é¢˜å·²äº†è§£ç­”æ¡ˆï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€‚å†å°è¯•å›ç­”é—®é¢˜ã€‚cä¸Šæ˜¯æ™®é€šç´¢å¼•ï¼Œæ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œåœ¨æŸ¥è¯¢c&gt;=15è¿™ä¸ªæ¡ä»¶æ—¶ï¼Œåœ¨æŸ¥æ‰¾åˆ°15ååŠ é”ï¼ˆ10ï¼Œ15ï¼½ï¼Œç»§ç»­å¾€å³æŸ¥æ‰¾ï¼ŒæŒ‰ç†è¯´ä¸ä¼šé”ä½6è¿™ä¸ªç´¢å¼•å€¼ï¼Œä½†æŸ¥è¯¢è¯­å¥ä¸­åŠ äº†order by c descï¼Œæˆ‘çŒœæƒ³ä¼šä¼˜åŒ–ä¸ºä½¿ç”¨c&lt;=20è¿™æ¡è¯­å¥ï¼ŒæŸ¥æ‰¾åˆ°20åå¾€å·¦æŸ¥æ‰¾ï¼Œè¿™æ ·ä¼šè®¿é—®åˆ°15å·¦è¾¹çš„å€¼10ï¼Œä»è€ŒåŠ é”ï¼ˆ5ï¼Œ10ï¼½ï¼Œä¸çŸ¥æˆ‘ç†è§£å¯¹å¦ï¼Ÿ","like_count":56,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434843,"discussion_content":"æ–°å¹´å¥½\n\nå¯¹çš„ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546315488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309890,"discussion_content":"æ ¹æ®æ¡ä»¶<=20,ä¼šå‘å·¦æŸ¥æ‰¾ï¼ŒæŸ¥åˆ°15å‘ç°æ»¡è¶³ï¼Œé”å®š(10,15),ç”±äºæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œéœ€è¦ç»§ç»­å‘å·¦æ‰¾ï¼Œæ‰¾åˆ°10è¿™æ¡è®°å½•ï¼Œå‘ç°ä¸æ»¡è¶³äº†ï¼Œä¸ç»§ç»­å‘å·¦æ‰¾ã€‚ç”±äºæ‰«æè¿‡çš„è®°å½•éƒ½è¦åŠ é”ï¼Œå°±é”ä½äº†ï¼ˆ5ï¼Œ10ï¼‰è¿™ä¸ªèŒƒå›´","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1601479329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184061,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/3d/7b9161ca.jpg","nickname":"è½çŸ³","note":"","ucode":"11F60E700E96B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279327,"discussion_content":"è¯·é—®åœ¨æ¡ä»¶ c<= 20ï¼Œæ‰«æåˆ°15ä¸å°±å¯ä»¥äº†ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦è®¿é—®åˆ°10å‘¢ï¼Ÿ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1591324805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1184061,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/3d/7b9161ca.jpg","nickname":"è½çŸ³","note":"","ucode":"11F60E700E96B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309889,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601478693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279327,"ip_address":""},"score":309889,"extra":""},{"author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1184061,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/3d/7b9161ca.jpg","nickname":"è½çŸ³","note":"","ucode":"11F60E700E96B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318227,"discussion_content":"é—®å°±æ˜¯ MySQLä»£ç é‡Œæ˜¯è¿™ä¹ˆå†™çš„ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603683669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279327,"ip_address":""},"score":318227,"extra":""},{"author":{"id":1124692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/29/54/b9fec917.jpg","nickname":"èœé¸Ÿä¸€æš","note":"","ucode":"34052769B97FEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1184061,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/3d/7b9161ca.jpg","nickname":"è½çŸ³","note":"","ucode":"11F60E700E96B6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343457,"discussion_content":"å› ä¸ºcæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥æ‰«æåˆ°15ä»¥åï¼Œä¸èƒ½ç¡®å®š15çš„å·¦è¾¹è¿˜æ˜¯ä¸æ˜¯15ã€‚æ‰€ä»¥åªèƒ½ç»§ç»­ï¼Œæ‰€ä»¥å°±åˆ°äº†10","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1611049130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":279327,"ip_address":""},"score":343457,"extra":""}]},{"author":{"id":1163715,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c1/c3/bd84ed76.jpg","nickname":"î„½","note":"","ucode":"35216097CB0379","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557707,"discussion_content":"æˆ‘çŒœæƒ³ä¼šä¼˜åŒ–ä¸ºä½¿ç”¨c&lt;=20è¿™æ¡è¯­å¥ï¼ŒæŸ¥æ‰¾åˆ°20åå¾€å·¦æŸ¥æ‰¾ï¼Œè¿™æ ·ä¼šè®¿é—®åˆ°15å·¦è¾¹çš„å€¼10ï¼Œä»è€ŒåŠ é”ï¼ˆ5ï¼Œ10ï¼½ã€‚è¿™é‡Œæ²¡æœ‰ä¼˜åŒ–äºŒå— å› ä¸º10ä¸æ»¡è¶³=15è¿™ä¸ªæ¡ä»¶ æ‰€ä»¥é€€åŒ–ä¸º(5,10) ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647937879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793962,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5f/aa/63e641c1.jpg","nickname":"H","note":"","ucode":"04D7D030245E27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291361,"discussion_content":"ä¸ºå•¥ä¼šæŠŠï¼ˆ20ï¼Œ25]è¿™ä¸ªèŒƒå›´ä¹Ÿé”äº†å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594792167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1793962,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5f/aa/63e641c1.jpg","nickname":"H","note":"","ucode":"04D7D030245E27","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336641,"discussion_content":"ç­‰äº20ï¼Œæ‰¾ä¸‹ä¸€ä¸ªä¸ç­‰äºçš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608642571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291361,"ip_address":""},"score":336641,"extra":""}]},{"author":{"id":1435349,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e6/d5/7c9d95d5.jpg","nickname":"é—¨é¥","note":"","ucode":"B0A445E190544C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290344,"discussion_content":"å‘ä¸‹æ‰«æåˆ°c=10ï¼Œåªæ˜¯ä¸ºäº†æ‰¾15ï¼›ç„¶è€Œï¼Œæ—¢ç„¶æ‰«æåˆ°c=10ï¼Œé‚£å°±è¦åŠ next-key lockå“ˆï¼Œå¸Œæœ›ä½ èƒ½ç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594437858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64593,"user_name":"æ—¶éšæ—¶ç°","can_delete":false,"product_type":"c1","uid":1111899,"ip_address":"","ucode":"DA4D622FF84920","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/5b/d2e7c2c4.jpg","comment_is_top":false,"comment_ctime":1548831536,"is_pvip":false,"replies":[{"id":"23192","content":"<br>å¥½é—®é¢˜ï¼Œåœ¨read-commitedéš”ç¦»çº§åˆ«ä¸‹ï¼Œupdateè¯­å¥<br>æœ‰ä¸€ä¸ªâ€œsemi-consistentâ€ readä¼˜åŒ–ï¼Œ<br><br>æ„æ€æ˜¯ï¼Œå¦‚æœupdateè¯­å¥ç¢°åˆ°ä¸€ä¸ªå·²ç»è¢«é”äº†çš„è¡Œï¼Œä¼šè¯»å…¥æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ<br>a)å¦‚æœä¸æ»¡è¶³ï¼Œå°±ç›´æ¥è·³è¿‡ï¼›<br>b) å¦‚æœæ»¡è¶³ï¼Œæ‰è¿›å…¥é”ç­‰å¾…<br><br>ä½ çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼šè¿™ä¸ªç­–ç•¥ï¼Œåªå¯¹updateæœ‰æ•ˆï¼Œdeleteæ— æ•ˆ<br><br>æ–°æ˜¥å¿«ä¹~","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549276326,"ip_address":"","comment_id":64593,"utype":1}],"discussion_count":8,"race_medal":0,"score":"164757588784","product_id":100020801,"comment_content":"ä¸å¥½æ„æ€ï¼Œè¿™æ¬¡åˆæ¥æ™šäº†ï¼Œçœ‹è¿™ç§è¿è½½æŠ€æœ¯æ–‡ç« ï¼Œå’Œçœ‹å°è¯´ä¸€æ ·ï¼Œå…»è‚¥äº†é›†ä¸­çœ‹~~<br>è¿™æ¬¡çš„é—®é¢˜å¦‚ä¸‹ï¼Œå¸Œæœ›ä¸è€å¸ˆæœ‰ç©ºè§£ç­”ä¸€ä¸‹ã€‚<br>ç‰ˆæœ¬ï¼šmysql 5.6.39<br>CREATE TABLE `t` (<br>  `a` int(11) NOT NULL,<br>  `b` int(11) DEFAULT NULL<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br>insert into t values(1,1),(2,2),(3,3),(4,4),(5,5);<br>é‡‡ç”¨READ-COMMITTEDéš”ç¦»çº§åˆ«<br>æ¡ˆä¾‹1ã€<br>session Aï¼š<br>begin;<br>update t set a=6 where b=1;<br>session Bï¼š<br>begin;<br>update t set a=7 where b=2;<br>Aå’ŒBå‡èƒ½æ‰§è¡ŒæˆåŠŸ<br>é—®é¢˜1ï¼šå®˜æ¡£ä¸Šè¯´å¯¹äºRCä¸”å…¨è¡¨æ‰«æçš„updateï¼Œå…ˆé€è¡Œæ·»åŠ è¡Œé”ç„¶åé‡Šæ”¾æ‰ä¸ç¬¦åˆwhereæ¡ä»¶çš„ï¼Œé‚£ä¹ˆsession AæˆåŠŸå¯¹(1,1)åŠ é”ï¼Œç†è®ºä¸Šsession Båœ¨æ‰«æ(1,1)å¹¶å°è¯•åŠ é”æ—¶ä¼šè¢«é˜»å¡ï¼Œä¸ºä½•è¿˜èƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿå®˜æ¡£é“¾æ¥ï¼šhttps:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;innodb-transaction-isolation-levels.html<br><br>æ¡ˆä¾‹2ï¼š<br>session Aï¼š<br>begin;<br>update t set a=6 where b=1;<br>session Bï¼š<br>begin;<br>delete from t where b=2; -- è¢«é˜»å¡<br>é—®é¢˜2ï¼šä¸ºä½•æ¡ˆä¾‹1 ä¸­çš„session Bä¸ä¼šè¢«é˜»å¡ï¼Œè€Œæ¡ˆä¾‹2çš„å´è¢«session Açš„è¡Œæ•°é˜»å¡ï¼Œupdateå’Œdeleteéƒ½æ˜¯å…¨éƒ¨æ‰«æï¼Œéš¾é“åŠ é”æœºåˆ¶ä¸ä¸€æ ·ï¼Ÿ","like_count":38,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438090,"discussion_content":"\nå¥½é—®é¢˜ï¼Œåœ¨read-commitedéš”ç¦»çº§åˆ«ä¸‹ï¼Œupdateè¯­å¥\næœ‰ä¸€ä¸ªâ€œsemi-consistentâ€ readä¼˜åŒ–ï¼Œ\n\næ„æ€æ˜¯ï¼Œå¦‚æœupdateè¯­å¥ç¢°åˆ°ä¸€ä¸ªå·²ç»è¢«é”äº†çš„è¡Œï¼Œä¼šè¯»å…¥æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ\na)å¦‚æœä¸æ»¡è¶³ï¼Œå°±ç›´æ¥è·³è¿‡ï¼›\nb) å¦‚æœæ»¡è¶³ï¼Œæ‰è¿›å…¥é”ç­‰å¾…\n\nä½ çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼šè¿™ä¸ªç­–ç•¥ï¼Œåªå¯¹updateæœ‰æ•ˆï¼Œdeleteæ— æ•ˆ\n\næ–°æ˜¥å¿«ä¹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549276326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542617,"discussion_content":"8.0.27å¯ä»¥é‡ç°ï¼Œæç¤ºè¢«ç¬¬ä¸€è¡Œçš„è¡Œé”æŒ¡ä½ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°å·²ç»è¢«æ”¹aå·²ç»è¢«æ”¹æˆ6","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640795299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":130979,"discussion_content":"è€å¸ˆè¾›è‹¦äº†ï¼Œæƒ³è¯·é—®ä¸‹â€˜è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå³ï¼šè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ ä¸Šçš„è¡Œé”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå°±è¦æŠŠâ€œä¸æ»¡è¶³æ¡ä»¶çš„è¡Œâ€ä¸Šçš„è¡Œé”ç›´æ¥é‡Šæ”¾äº†ï¼Œä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤ã€‚  \nsession Aä¸­å¯¹åº”çš„update t set a=6 where b=1;è¿™ä¸ªè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå…¶ä»–ä¸æ»¡è¶³æ¡ä»¶ä¸Šçš„è¡Œé”åº”è¯¥éƒ½è¢«é‡Šæ”¾æ‰äº†ï¼Œä¸ºä»€ä¹ˆsessiion Bçš„è¿™ä¸ªdelete from t where b=2; è¿™ä¸ªè¯­å¥è¿˜ä¼šè¢«é˜»å¡ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578816244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195374,"discussion_content":"å¯¹deleteçš„ä¼˜åŒ–æ˜¯ä¸å­˜åœ¨çš„,åªæœ‰å¯¹updateæœ‰æ•ˆ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583273209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":130979,"ip_address":""},"score":195374,"extra":""},{"author":{"id":1588794,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3e/3a/2267d2a3.jpg","nickname":"hoppo","note":"","ucode":"B0C7C124A99B2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312598,"discussion_content":"åº”è¯¥è¿™ä¹ˆè¯´ &#39; å°±è¦æŠŠ  ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸Š çš„è¡Œé”ç›´æ¥é‡Šæ”¾äº†&#39;ï¼Œæ˜¯åšäº†çš„ï¼Œåªé”äº†b=1è¿™ä¸€è¡Œï¼ˆb=1æ»¡è¶³æ¡ä»¶ï¼‰ã€‚ä½†SessionBå¼€å§‹çš„æ—¶å€™ï¼Œä¹Ÿä¼šæŒ‰è¡Œä»1å¼€å§‹åŠ é”ï¼ˆæ²¡æœ‰ç´¢å¼•ï¼‰ï¼Œæ‰€ä»¥é˜»å¡äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602744446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":130979,"ip_address":""},"score":312598,"extra":""}]},{"author":{"id":1612570,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Xibh27ZicBhXls5KsPibBXZI4RKlR0MUbUiaEuOS2ORibKaxWSicpIjd4lvWUWqtNAde7EeDDTpWKAiapGdHeaiaDqczWQ/132","nickname":"ã€‚ã€‚ã€‚ã€‚ã€‚","note":"","ucode":"985B1561AC9152","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4838,"discussion_content":"æˆ‘ç”¨mysql 8.0.13è¯•äº†ä¸‹ï¼Œä¸¤ç§éƒ½ä¼šè¢«é˜»å¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565764420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1612570,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Xibh27ZicBhXls5KsPibBXZI4RKlR0MUbUiaEuOS2ORibKaxWSicpIjd4lvWUWqtNAde7EeDDTpWKAiapGdHeaiaDqczWQ/132","nickname":"ã€‚ã€‚ã€‚ã€‚ã€‚","note":"","ucode":"985B1561AC9152","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329806,"discussion_content":"ä½ æ˜¯ä¸æ˜¯æ²¡æœ‰æ”¹éš”ç¦»çº§åˆ«ä¸ºRCï¼Œé»˜è®¤æ˜¯RR","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1606462710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4838,"ip_address":""},"score":329806,"extra":""}]},{"author":{"id":1082785,"avatar":"https://static001.geekbang.org/account/avatar/00/10/85/a1/2442332c.jpg","nickname":"éƒ­ä¿Šæ°","note":"","ucode":"D328E5738A4413","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1826,"discussion_content":"å¥½é—®é¢˜ï¼Œå€¼å¾—ä¸€çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562930388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64235,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1548725019,"is_pvip":false,"replies":[{"id":"23045","content":"å¥½é—®é¢˜ï¼Œæ–°å¹´å¿«ä¹<br><br>ä¼šé”çš„ï¼Œåªæ˜¯å› ä¸ºåœ¨(5,10]å°±è¢«é”ä½äº†ï¼Œæ‰€ä»¥åé¢çš„é”åŠ ä¸ä¸Šå»äº†ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549009795,"ip_address":"","comment_id":64235,"utype":1}],"discussion_count":9,"race_medal":0,"score":"147577613083","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹å…«session Bçš„æ“ä½œè¯­å¥update t set d = d + 1 where c =10; ç”±äºcæ˜¯éå”¯ä¸€é”®ç´¢å¼•ï¼Œé”ï¼ˆ5ï¼Œ10ã€å¯ä»¥ç†è§£<br>ï¼Œä¸ºä»€ä¹ˆä¸é”(10,15} å‘¢ï¼Œä¸æ˜¯åº”è¯¥ç»§ç»­å‘åæ‰«æç›´åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ä¸ºæ­¢å—","like_count":34,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437917,"discussion_content":"å¥½é—®é¢˜ï¼Œæ–°å¹´å¿«ä¹\n\nä¼šé”çš„ï¼Œåªæ˜¯å› ä¸ºåœ¨(5,10]å°±è¢«é”ä½äº†ï¼Œæ‰€ä»¥åé¢çš„é”åŠ ä¸ä¸Šå»äº†ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549009795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1174548,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ec/14/c6e9e99a.jpg","nickname":"å¼ ä¹‹è±ª","note":"","ucode":"936B996DDE87CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126753,"discussion_content":"é”(5,10]åˆ†ä¸¤æ­¥,é—´éš™é”(5,10);è¡Œé”10 ç„¶è€Œè¡Œé”è¢«sessionAé”ä½äº†,æ‰€ä»¥é˜»å¡äº†?","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1578535861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1174548,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ec/14/c6e9e99a.jpg","nickname":"å¼ ä¹‹è±ª","note":"","ucode":"936B996DDE87CE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277201,"discussion_content":"â€œè¡Œé”è¢«sessionAé”ä½â€è¿™ç§è¡¨è¾¾ä¸å¤ªå¥½ç†è§£ã€‚æˆ‘è§‰å¾—â€œè¡Œé”10è¢«sessionAæŒæœ‰â€è¿™æ ·è¡¨è¾¾æ›´å¥½ç†è§£ï¼Œæ‰€ä»¥sessionBæƒ³è¦è·å–è¡Œé”10çš„æ—¶å€™ï¼Œé™·å…¥äº†é˜»å¡","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1591016789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":126753,"ip_address":""},"score":277201,"extra":""}]},{"author":{"id":1188023,"avatar":"https://static001.geekbang.org/account/avatar/00/12/20/b7/bdb3bcf0.jpg","nickname":"Eternal","note":"","ucode":"EA6FE7CC98F740","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394769,"discussion_content":"ç¬¬ä¸€æ­¥ï¼šé” ï¼ˆ5ï¼Œ10ï¼‰ æˆåŠŸ\nç¬¬äºŒæ­¥ï¼š[10]  é˜»å¡\nç¬¬ä¸‰æ­¥ï¼š(10,15] ä¼˜åŒ–ä¸º ï¼ˆ10ï¼Œ15ï¼‰ç­‰ç¬¬äºŒæ­¥å®Œæˆ","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1632042322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810189,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZHw73tgCqGKhvticUWGRz4icgicu4hFWfKtacoFJeItH7maNuNUmjnEgDTJvOibwUWgGV0p6guNPibMVWDV4BUmEmlA/132","nickname":"Ethan","note":"","ucode":"75F613D58909DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366738,"discussion_content":"æŒ‰ç…§è€å¸ˆç»™çš„ç­”å¤ï¼Œä¸ºä»€ä¹ˆæ¡ˆä¾‹6ä¸­Session A çš„deleteè¯­å¥åœ¨(5,10]å°±ä¸èƒ½é”ä¸»ï¼Œåé¢è¿˜èƒ½ç»§ç»­åŠ é”ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618157884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691695,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d0/2f/f4de1b14.jpg","nickname":"è«å¤±è«å¿˜","note":"","ucode":"0BAA76C08DA2C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":115468,"discussion_content":"å°ç™½ç–‘æƒ‘  å‰é¢å­¦ä¹ åˆ° â€œä¸ºä¿è¯binlogè®°å½•é¡ºåºï¼Œéç´¢å¼•æ›´æ–°ä¼šé”ä½å…¨è¡¨è®°å½•â€ã€‚è¿™é‡Œæ›´æ–°æœ‰é—´éš™é”ã€‚è¿™ä¸¤ç§é”ä¼šåŒæ—¶å­˜åœ¨ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578015125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691695,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d0/2f/f4de1b14.jpg","nickname":"è«å¤±è«å¿˜","note":"","ucode":"0BAA76C08DA2C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164172,"discussion_content":"ä¼šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581160650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":115468,"ip_address":""},"score":164172,"extra":""},{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691695,"avatar":"https://static001.geekbang.org/account/avatar/00/19/d0/2f/f4de1b14.jpg","nickname":"è«å¤±è«å¿˜","note":"","ucode":"0BAA76C08DA2C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195373,"discussion_content":"éæ‰€æœ‰å­—æ®µçš„æ›´æ–°,rcä¸‹é”ä½æ‰€æœ‰çš„è¡Œ,æ²¡æœ‰é—´éš™é” rrä¸‹æ‰€æœ‰çš„è¡Œ+åŒºé—´å³æ•´ä¸ªè¡¨next-key lock","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583273054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":115468,"ip_address":""},"score":195373,"extra":""},{"author":{"id":1135593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/53/e9/f244988e.jpg","nickname":"NIRVANA","note":"","ucode":"F3A979679AA44E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309408,"discussion_content":"ç¢°åˆ°ç†Ÿäººäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601281979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":195373,"ip_address":""},"score":309408,"extra":""}]}]},{"had_liked":false,"id":58820,"user_name":"é™ˆ","can_delete":false,"product_type":"c1","uid":1304668,"ip_address":"","ucode":"81A54B3BA9C721","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg","comment_is_top":false,"comment_ctime":1547201230,"is_pvip":false,"replies":[{"id":"21285","content":"è¿™ä¸€è¡Œå­˜åœ¨çš„æ—¶å€™æ˜¯è¡Œé”ï¼Œè¿™ä¸€è¡Œä¸å­˜åœ¨ï¼Œé‚£å°±æ˜¯é—´éš™é”å•¦ã€‚<br><br>insert into t values(8,8,8)æ˜¯è¢«ä¸»é”®ä¸Š(5,10)çš„é—´éš™é”é”ä½çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547205340,"ip_address":"","comment_id":58820,"utype":1}],"discussion_count":6,"race_medal":0,"score":"134691187406","product_id":100020801,"comment_content":"è€å¸ˆåœ¨æ¡ˆåˆ—ä¸€ä¸­update t set d=d+1 where id=7 ä¸­idæ˜¯ä¸»é”®ä¹Ÿæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒæŒ‰ä¼˜åŒ–1åº”è¯¥é€€åŒ–æˆè¡Œé”æ‰å¯¹ï¼Œä¸ºä»€ä¹ˆinsert into t values(8,8,8)ä¼šè¢«é”ä½ï¼Œæˆ‘æ˜¯é‚£å„¿ç†è§£é”™äº†?","like_count":31,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436219,"discussion_content":"è¿™ä¸€è¡Œå­˜åœ¨çš„æ—¶å€™æ˜¯è¡Œé”ï¼Œè¿™ä¸€è¡Œä¸å­˜åœ¨ï¼Œé‚£å°±æ˜¯é—´éš™é”å•¦ã€‚\n\ninsert into t values(8,8,8)æ˜¯è¢«ä¸»é”®ä¸Š(5,10)çš„é—´éš™é”é”ä½çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547205340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","nickname":"é…¸è‘¡è„","note":"","ucode":"9D059C4FB327C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309021,"discussion_content":"mysql 8.0.17 \nç–‘é—®ï¼šé—´éš™é”ä¸ä¼šé˜»å¡updateå—ï¼Ÿ\næ¡ˆä¾‹ä¸€ï¼š\n(5,10)ä¸Šæœ‰é—´éš™é”ï¼Œä¸ºä»€ä¹ˆ\nupdate t set d=d+1 where id = 5/7/8/9;éƒ½å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä¸ä¼šé˜»å¡å‘¢ï¼Ÿ\næ‰€ä»¥çŒœæµ‹é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œdä¸æ˜¯ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹ã€‚\n\nç»§ç»­å®éªŒï¼š\nupdate t set id=id+1 where id =7;\nå‘ç°ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œæ˜¯ä¸æ˜¯å› ä¸ºæ•°æ®åº“ä¸­æ²¡æœ‰id=7è¿™ä¸ªè®°å½•ï¼Ÿ\nupdate t set id=id+1 where id =5;é˜»å¡äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¡Œé”ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601173320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1649057,"avatar":"https://static001.geekbang.org/account/avatar/00/19/29/a1/41607383.jpg","nickname":"hello","note":"","ucode":"4F42DAA5DB5C38","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1154146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","nickname":"é…¸è‘¡è„","note":"","ucode":"9D059C4FB327C0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362235,"discussion_content":" 5.x ç³»åˆ— <=5.7.24ï¼Œ8.0 ç³»åˆ— <=8.0.13","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616899381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309021,"ip_address":""},"score":362235,"extra":""},{"author":{"id":2597649,"avatar":"https://static001.geekbang.org/account/avatar/00/27/a3/11/30d913f0.jpg","nickname":"R","note":"","ucode":"006403528E7F59","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1154146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","nickname":"é…¸è‘¡è„","note":"","ucode":"9D059C4FB327C0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375173,"discussion_content":"å…„å¼Ÿè§£å†³äº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621501390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309021,"ip_address":""},"score":375173,"extra":""}]},{"author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"å¼ ä¸‰ä¸°","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372620,"discussion_content":"æ„Ÿè§‰è¿™ä¸ªè§£é‡Šæœ‰ç‚¹ç‰µå¼ºï¼Œid=7æ˜¯å› ä¸ºæŸ¥ä¸åˆ°è¿™è¡Œï¼Œæ‰€ä»¥åšäº†æ‰«æï¼Œæ‰«æèŒƒå›´æ˜¯ï¼ˆ5,10ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªåŒºé—´åŠ äº†é—´éš™é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620394243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"å¼ ä¸‰ä¸°","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587733,"discussion_content":"id=7æ˜¯è¿›è¡Œæ ‘æœç´¢å§ä¸éœ€è¦æ‰«æ....è¿™ä¸ªå…¶å®å¾ˆå¥½ç†è§£å•Šï¼Œid =7ä¸å­˜åœ¨åŠ é—´éš™é”å°±æ˜¯ä¸ºäº†é˜²æ­¢å…¶å®ƒäº‹åŠ¡æ’å…¥ä¸€ä¸ªid =7å¯¼è‡´statementçš„binlogæ•°æ®ä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663244515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372620,"ip_address":"å¹¿ä¸œ"},"score":587733,"extra":""}]}]},{"had_liked":false,"id":70474,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1551104284,"is_pvip":false,"replies":[{"id":"25167","content":"ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œ<br>ä¸€è‡´æ€§è§†å›¾çš„ç”Ÿæˆæ—¶é—´æ˜¯ ç¬¬ä¸€æ¬¡æ‰§è¡Œä¸€è‡´æ€§è¯»çš„æ—¶å€™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551139785,"ip_address":"","comment_id":70474,"utype":1}],"discussion_count":11,"race_medal":0,"score":"108925286684","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚åœ¨è‡ªå·±è·‘æ¡ˆä¾‹å››çš„æ—¶å€™ï¼Œå›æƒ³èµ·ä¹‹å‰MVCCçš„å†…å®¹å°±å¯¹æ¡ˆä¾‹åšäº†äº›è°ƒæ•´ï¼Œæ­¤æ—¶äº§ç”Ÿä¸€äº›æœ‰å…³ä¸€è‡´æ€§è¯•å›¾çš„ç–‘æƒ‘ï¼Œè¿˜æƒ³è¯·è€å¸ˆæ’ç–‘è§£æƒ‘ã€‚<br>MySQL8.0.13ï¼ŒRRéš”ç¦»çº§åˆ«ä¸‹ï¼Œè¡¨ç»“æ„åŠæ•°æ®æŒ‰ç…§ä¾‹å­ä¸­ä¸å˜ï¼Œæ‰§è¡Œè¯­å¥å¦‚ä¸‹ï¼š<br>session Aï¼šbegin; select * from t where c&gt;=10 and c&lt;11 for update;  --é”ä½(5,15]<br>session Bï¼šupdate t set d=d+1 where c=5;                                           --æˆåŠŸï¼Œchanged:1<br>session Aï¼šselect * from t;                                                                      --è¯»åˆ°d=6<br>æ­¤æ—¶ï¼Œsession Aå±…ç„¶è¯»åˆ°äº†session B updateåçš„ç»“æœã€‚è¯­å¥è°ƒæ•´åï¼ŒæŠŠsession Aä¸­çš„ for updateå»æ‰ï¼Œä¾æ®RRçº§åˆ«ä¸‹ä¸€è‡´æ€§è§†å›¾åŸç†ä¸ä¼šè¯»åˆ°session Bæ›´æ–°åçš„ç»“æœã€‚<br>é‚£ä¹ˆï¼Œæ˜¯å¦å¯ä»¥ç†è§£beginåæ‰§è¡Œçš„selectè¯­å¥ä½¿ç”¨for update&#47;lock in share modeå¹¶ä¸ä¼šç”Ÿæˆä¸€è‡´æ€§è§†å›¾å‘¢ï¼Ÿ<br>è¿˜è¯·è€å¸ˆæŒ‡ç‚¹è¿·æ´¥ï¼Œæ„Ÿæ¿€ä¸å°½(âÂ´Ï‰`â)","like_count":25,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440653,"discussion_content":"ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œ\nä¸€è‡´æ€§è§†å›¾çš„ç”Ÿæˆæ—¶é—´æ˜¯ ç¬¬ä¸€æ¬¡æ‰§è¡Œä¸€è‡´æ€§è¯»çš„æ—¶å€™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551139785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351063,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaByN5IfYbE9jMtWrtTDXtPEIHeV77KW1p7ZkiasiaGgA50VXaibo4fbp5ib2JkFP3iaIe4AUudLibufkEIofu5euCNHg/132","nickname":"å°åˆ€","note":"","ucode":"94DF8C45E09E42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":224268,"discussion_content":"for update å½“å‰è¯»","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1586274732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2771089,"avatar":"","nickname":"Geek_126edf","note":"","ucode":"D5C8819DF40803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395035,"discussion_content":"æ„Ÿè°¢äº†ï¼Œå®Œå…¨æ²¡æ„è¯†åˆ°","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1632195316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585142,"discussion_content":"666  ä»Šå¤©åˆšæµ‹è¯•æ—¶é‡åˆ°äº†ï¼Œè·Ÿæˆ‘æƒ³çš„ä¸€æ ·","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1661341224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1887586,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPADhxxzOzukMar8nV5Tc3ic2dz4FQIxMX3WmX5a2V3sdD121eWpvfQI8NXIkkDZoDFw/132","nickname":"Geek_536b54","note":"","ucode":"F62BC7781D9212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328989,"discussion_content":"å¥½é—®é¢˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606292675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2957548,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/TCc0icvama5VVOH4B3icFjcofPXVD7LrcS6GkBa09rMMM33Dgicg3adaNGYJwMS2u5BNnG7SXWPvXIGuKjFdXTnIA/132","nickname":"Geek_3c04cb","note":"","ucode":"F24EAE4985A372","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583960,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660530634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1163715,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c1/c3/bd84ed76.jpg","nickname":"î„½","note":"","ucode":"35216097CB0379","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557791,"discussion_content":"æœ‰ä¸ªé—®é¢˜ è¿™é‡Œçš„for updateä¹‹å äºŒçº§ç´¢å¼•cä¼šåŠ é” (5, 15] å¯¹åº”çš„èšç°‡ç´¢å¼•ä¸¤æ¡è®°å½• id=10 id=15 ä¼šåŠ è¡Œé”å—ï¼Ÿåœ¨5.7ç‰ˆæœ¬ RRéš”ç¦»çº§åˆ«ä¸‹ æˆ‘å¦ä¸€ä¸ªäº‹åŠ¡update where id = 15æ˜¯å¯ä»¥æ›´æ–°æˆåŠŸçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647961037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","nickname":"å¼ è¯š","note":"","ucode":"F623703194769B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367427,"discussion_content":"æˆ‘ä¹Ÿæ˜¯å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œå‘ç°è·Ÿä¹¦ä¸Šè®²çš„ä¹Ÿä¸ä¸€æ ·ï¼Œæ²¡æƒ³åˆ°åœ¨è¯„è®ºä¸­æ‰¾åˆ°äº†è€å¸ˆçš„å›ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618361685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1115702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","nickname":"å¼ è¯š","note":"","ucode":"F623703194769B","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":576322,"discussion_content":"for updateæœ¬æ¥å°±æ˜¯å½“å‰è¯»å•Šï¼Œç›´æ¥è¯»æœ€æ–°çš„ç‰ˆæœ¬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655432225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":367427,"ip_address":""},"score":576322,"extra":""}]},{"author":{"id":1181248,"avatar":"https://static001.geekbang.org/account/avatar/00/12/06/40/ff77554d.jpg","nickname":"å…»ğŸ±","note":"","ucode":"3CBBBEFD3945B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311993,"discussion_content":"ä¸€è‡´æ€§è¯»ä¼šåˆ¤æ–­æ•°æ®æ˜¯å¦å¯¹å½“å‰äº‹åŠ¡å¯è§ï¼Œä¸å¯è§å°±å›æ»šè‡³ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ç»§ç»­åˆ¤æ–­ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602557885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1644950,"avatar":"https://static001.geekbang.org/account/avatar/00/19/19/96/3b49b437.jpg","nickname":"éƒ­æŸæŸ","note":"","ucode":"5E53B60527DCDF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287659,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593505096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55479,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1546209176,"is_pvip":false,"replies":[{"id":"20071","content":"é£é›¨æ— é˜» èŠ‚å‡æ—¥ä¸ä¼‘ï¼ŒåŒ…æ‹¬å…ƒæ—¦å’Œæ˜¥èŠ‚ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546217334,"ip_address":"","comment_id":55479,"utype":1}],"discussion_count":2,"race_medal":0,"score":"108920391576","product_id":100020801,"comment_content":"æ—©æ™¨ç¡ä¸ç€æ‰“å¼€æå®¢æ—¶é—´ä¸€çœ‹ï¼Œç«Ÿç„¶æ›´æ–°äº†ã€‚ä»Šå¤©æ˜¯å‘¨æ—¥è€Œä¸”åœ¨å‡æœŸä¸­å“...","like_count":26,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434786,"discussion_content":"é£é›¨æ— é˜» èŠ‚å‡æ—¥ä¸ä¼‘ï¼ŒåŒ…æ‹¬å…ƒæ—¦å’Œæ˜¥èŠ‚ğŸ˜„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1546217334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1082785,"avatar":"https://static001.geekbang.org/account/avatar/00/10/85/a1/2442332c.jpg","nickname":"éƒ­ä¿Šæ°","note":"","ucode":"D328E5738A4413","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1823,"discussion_content":"å…¶å®è€å¸ˆéƒ½æ˜¯æå‰æ•´å¥½åé¢çš„è¯¾ï¼Œå‡†æ—¶æ›´æ–°çš„ï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562929129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55939,"user_name":"ä¹¾å¤","can_delete":false,"product_type":"c1","uid":1130585,"ip_address":"","ucode":"DC2505711FB7D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/59/f93698ec.jpg","comment_is_top":false,"comment_ctime":1546351878,"is_pvip":true,"replies":[{"id":"20142","content":"æ„Ÿè§‰æ²¡å¤§å·®åˆ«ï¼Œå—¯å—¯ï¼Œç†è§£å°±å¥½ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546361548,"ip_address":"","comment_id":55939,"utype":1}],"discussion_count":2,"race_medal":0,"score":"104625566982","product_id":100020801,"comment_content":"æ‚¨å¥½ï¼Œå…³äº&quot;ä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚&quot;ï¼Œæˆ‘è§‰å¾—æ”¹ä¸º&quot;ä»ç¬¬ä¸€ä¸ªæ»¡è¶³ç­‰å€¼æ¡ä»¶çš„ç´¢å¼•è®°å½•å¼€å§‹å‘å³éå†åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶è®°å½•ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶è®°å½•ä¸Šçš„next-key lock é€€åŒ–ä¸ºé—´éš™é”&quot;æ›´æ˜ç¡®äº›","like_count":24,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434892,"discussion_content":"æ„Ÿè§‰æ²¡å¤§å·®åˆ«ï¼Œå—¯å—¯ï¼Œç†è§£å°±å¥½ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542775,"discussion_content":"æˆ‘è‡ªå·±å†™ç¬”è®°çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å†™æˆ ä¸æ»¡è¶³æ¡ä»¶ç¬¬ä¸€ä¸ªçš„è®°å½•ï¼Œæ„Ÿè§‰è¿™æ ·è¡¨è¿°æ¯”è¾ƒå‡†ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640840716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83258,"user_name":"ç‹ä¼¯è½©","can_delete":false,"product_type":"c1","uid":1108650,"ip_address":"","ucode":"546814BA7E5839","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/aa/cdd13ad2.jpg","comment_is_top":false,"comment_ctime":1554482974,"is_pvip":false,"replies":[{"id":"30155","content":"å¯¹çš„ï¼Œè¦updateå’Œdeleteçš„æ—¶å€™ï¼Œè¦â€œå…ˆè¯»åå†™â€ï¼Œè¿™ä¸ªè¯»å°±å¼€å§‹åŠ é”äº†ã€‚<br><br>insertçš„æ—¶å€™è¦æœ‰æ’å…¥æ„å‘é”ï¼ˆå°±æ˜¯ä¼šè·Ÿgap lockå†²çªçš„é‚£ä¸ªï¼‰<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1554616329,"ip_address":"","comment_id":83258,"utype":1}],"discussion_count":2,"race_medal":0,"score":"83158861598","product_id":100020801,"comment_content":"è¿™ä¸¤ç« ä»Šå¤©æ¥æ¥å›å›å•ƒäº†å¥½å‡ éï¼Œç»ˆäºæ„Ÿè§‰æœ‰å…³é”çš„çŸ¥è¯†æˆä½“ç³»äº†ã€‚ <br><br>å°¤å…¶æ˜¯æ€»ç»“çš„åŠ é”åŸåˆ™ï¼Œç®€ç›´å¤ªç²¾è¾Ÿäº†ï¼Œæ„Ÿè°¢ä¸è€å¸ˆ.<br><br>åŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚<br><br>å¯¹äºåŸåˆ™2 æˆ‘æœ‰ä¸ªç–‘é—®ï¼Œè®¿é—®åˆ°çš„å¯¹è±¡åº”è¯¥è¿˜åº”è¯¥åŒ…å«å…¶å½±å“åˆ°çš„ç´¢å¼•ã€‚<br><br>è€å¸ˆçš„ä¾‹å­ä¸­æŸäº›éšå«äº†è¿™äº›ä¸œè¥¿ï¼Œå…¶ä»–åŒå­¦çš„ç•™è¨€ä¸­ä¹Ÿè¡¨æ˜äº†è¿™ç‚¹ï¼Œæœ›è€å¸ˆæŒ‡ç‚¹<br><br>æ¯”å¦‚ ä¸€ä¸ªè¡¨tï¼ˆid ï¼Œc,d,eï¼‰<br>idæ˜¯ä¸»é”® ï¼Œå…¶ä»–åˆ—éƒ½æœ‰éå”¯ä¸€ç´¢å¼•ã€‚ <br>æ‰§è¡Œinsert éœ€è¦è·å–æ‰€æœ‰ç´¢å¼•ä¸Šçš„é”ï¼›<br>æ‰§è¡Œåˆ é™¤ï¼ˆå³ä½¿æ ¹æ®idåˆ é™¤ï¼‰ä¹Ÿéœ€è¦è·å–å…¶ä»–ç´¢å¼•çš„é”ï¼›<br>æ‰§è¡Œupdateï¼ˆå³ä½¿whereæ¡ä»¶ä½¿ç”¨idï¼‰å¦‚æœæ›´æ–°çš„æœ‰ç´¢å¼•åˆ—ï¼Œä¹Ÿéœ€è¦è·å–ä¸Šé¢çš„é”<br><br>å› ä¸ºæ›´æ–°æ“ä½œè‚¯å®šä¼šå¯¼è‡´ç´¢å¼•æ ‘çš„ä¿®æ”¹ï¼Œå¦‚æœä¸æ›´æ”¹ï¼Œä¼šå¯¼è‡´ç´¢å¼•æœç´¢æ—¶è¿”å›çš„æ•°æ®å’Œå®é™…ä¸ä¸€æ ·ï¼›å¦‚æœæ›´æ”¹çš„è¯ï¼Œè‚¯å®šéœ€è¦é˜²æ­¢å¹¶å‘å°±éœ€è¦åŠ é”<br><br>ä¸çŸ¥é“ç†è§£çš„æ˜¯å¦æ­£ç¡®","like_count":20,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445942,"discussion_content":"å¯¹çš„ï¼Œè¦updateå’Œdeleteçš„æ—¶å€™ï¼Œè¦â€œå…ˆè¯»åå†™â€ï¼Œè¿™ä¸ªè¯»å°±å¼€å§‹åŠ é”äº†ã€‚\n\ninsertçš„æ—¶å€™è¦æœ‰æ’å…¥æ„å‘é”ï¼ˆå°±æ˜¯ä¼šè·Ÿgap lockå†²çªçš„é‚£ä¸ªï¼‰\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554616329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","nickname":"å¼ ä¸‰ä¸°","note":"","ucode":"3A6215A40B3B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378384,"discussion_content":"è¿™ä¸ªè§£é‡Šå¤ªåˆ°ä½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623202657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55582,"user_name":"éƒ­æ±Ÿä¼Ÿ","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1546236687,"is_pvip":false,"replies":[{"id":"20081","content":"å—¯ä½ è¯´çš„å¯¹<br><br>ä¸è¿‡æ˜¯æˆ‘å°‘æ‰“ä¸€ä¸ªè¯äº†ï¼ŒåŠ ä¸Šå»äº†ï¼Œè¦descå“¦<br><br>é‡æ–°åˆ†æä¸‹ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546244070,"ip_address":"","comment_id":55582,"utype":1}],"discussion_count":2,"race_medal":0,"score":"65970746127","product_id":100020801,"comment_content":"è€å¸ˆè¿™æ¬¡çš„ç•™ä¸‹çš„é—®é¢˜ï¼Œè¯­å¥è·Ÿä¸Šæ¬¡ä¸ä¸€æ ·ï¼Œä¸ŠæœŸé—®é¢˜è¯­å¥æ˜¯select id  from t where c&gt;=15 and c&lt;=20 order by c desc  for update;ï¼›è¿™æ¬¡ç¼ºå°‘äº† order by c desc ï¼Œä¸åŠ descçš„è¯insert into t values(6,6,6);ä¸ä¼šè¢«å µå¡ï¼›<br>æ ¹æ®ä¼˜åŒ–3ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œåœ¨å‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™next-key locké€€åŒ–ä¸ºé—´éš™é”ï¼›<br>é—®é¢˜ä¸­çš„sqlè¯­å¥åŠ äº†desc ï¼Œæ˜¯å‘å·¦æ‰«æï¼Œè¯¥ä¼˜åŒ–ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥ä¸‹é™10æ˜¯é—­åŒºé—´ï¼Œä¸ºäº†é˜²æ­¢cä¸º10çš„è¡ŒåŠ å…¥ï¼Œéœ€è¦é”å®šåˆ°ç´¢å¼•cé”®ï¼ˆ5,5ï¼‰<br>æ­¤ä¾‹ä¸­insert into t values(6,5,6) ä¼šå µå¡ï¼Œinsert into t values(4,5,6) ä¸ä¼šå µå¡ï¼Œ","like_count":16,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434803,"discussion_content":"å—¯ä½ è¯´çš„å¯¹\n\nä¸è¿‡æ˜¯æˆ‘å°‘æ‰“ä¸€ä¸ªè¯äº†ï¼ŒåŠ ä¸Šå»äº†ï¼Œè¦descå“¦\n\né‡æ–°åˆ†æä¸‹ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546244070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1886364,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoIDpqWcd3vuowkXguSkPuH2TcwmD9iak0sscUzCDrGAMln89vdC3GuH6KcQJkGg4xjdnb0bdnz2A/132","nickname":"shirly","note":"","ucode":"46875D2FCB9A6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587052,"discussion_content":"åŸæ¥æ˜¯å‘å·¦æ‰«æï¼Œä¼˜åŒ–äºŒæ²¡ç”¨ä¸Šï¼Œæ‰€ä»¥ï¼ˆ5,10]ï¼Œç–‘æƒ‘äº†å¥½ä¹…ï¼Œæ„Ÿæ©~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662715141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176231,"user_name":"Flash","can_delete":false,"product_type":"c1","uid":1236163,"ip_address":"","ucode":"E285075C9E0B02","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/c3/e4ba51d5.jpg","comment_is_top":false,"comment_ctime":1580996129,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"53120603681","product_id":100020801,"comment_content":"çŒœæƒ³æ˜¯å› ä¸ºå¤šäº†ä¸€ä¸ªorder by c descï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢c=20ï¼ŒåŠ é”(15,20]ï¼Œå› ä¸ºcä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥ä¸ä¼šä¼˜åŒ–ã€é€€åŒ–æˆè¡Œé”ã€‚ç»§ç»­å‘å·¦ï¼Œç­‰å€¼æŸ¥åˆ°c=15ï¼ŒåŠ é”(10,15]ï¼Œç›´åˆ°æ‰¾åˆ°c=10ï¼Œä¸æ»¡è¶³æ¡ä»¶c&gt;=15ï¼Œæ ¹æ®åŸåˆ™2ï¼Œæ‰«æåˆ°çš„éƒ½è¦åŠ é”ï¼Œæ‰€ä»¥æœ€ååŠ é”(5,10]ï¼Œå› ä¸ºæ˜¯èŒƒå›´æŸ¥è¯¢ä¸ä¼šä¼˜åŒ–ã€‚æ‰€ä»¥ï¼Œæœ€åsession Açš„åŠ é”èŒƒå›´æ˜¯(5,20]ï¼Œå³(5,10],(10,15],(15,20]ã€‚","like_count":12,"discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587986,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ã€‚è¿™æ˜¯ä¸€ä¸ªå‘å·¦çš„èŒƒå›´æ‰«æï¼Œå› æ­¤10ä¼šæ”˜æ‹¬ï¼Œæ ¹æ®å·¦å¼€å³é—­æ‰€ä»¥å°±å¾—å†åŠ ä¸€ä¸ªnext key lockï¼ˆ5ï¼Œ10ã€‘ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663425365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2945508,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/kTIwKz8eeicPsWibiavOkCnhfys2HkhLFmNKN7hV3ax1GNsjs8Ss2BlH0ekelxFibZz4C3cy1R1YcEMopJhXCghqyQ/132","nickname":"Geek_c22ad7","note":"","ucode":"6A3ACF366C02CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556786,"discussion_content":"5æ˜¯æ€ä¹ˆæ‰«åˆ°çš„..","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647512127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545162,"discussion_content":"ä½ å’Œæˆ‘åˆ†æçš„ä¸€æ ·ã€‚ä½†å®é™…æƒ…å†µæ˜¯(20ï¼Œ25)ä¹ŸåŠ é”äº†ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641868617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64774,"user_name":"æ˜¯æˆ‘çš„æµ·","can_delete":false,"product_type":"c1","uid":1197457,"ip_address":"","ucode":"4BCE240829676A","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/91/afda3094.jpg","comment_is_top":false,"comment_ctime":1548904997,"is_pvip":false,"replies":[{"id":"22938","content":"ä¸€å®šè¦ä½è°ƒå“ˆğŸ˜†<br><br>å¦‚æœé¢è¯•çš„æ—¶å€™èƒ½å¤Ÿè®©å¤§å®¶å›ç­”æ›´æœ‰åº•æ°”ï¼Œé‚£å°±å¤ªå¥½å•¦ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548923241,"ip_address":"","comment_id":64774,"utype":1}],"discussion_count":3,"race_medal":0,"score":"53088512549","product_id":100020801,"comment_content":"å…¨æ˜¯å¹²è´§èµèµèµï¼Œä»¥åå‡ºå»é¢è¯•å†ä¹Ÿä¸æ€•é¢è¯•å®˜è£…Xé—®é”çš„é—®é¢˜äº†","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438171,"discussion_content":"ä¸€å®šè¦ä½è°ƒå“ˆğŸ˜†\n\nå¦‚æœé¢è¯•çš„æ—¶å€™èƒ½å¤Ÿè®©å¤§å®¶å›ç­”æ›´æœ‰åº•æ°”ï¼Œé‚£å°±å¤ªå¥½å•¦ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548923241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318297,"discussion_content":"æˆ‘ä¹Ÿæƒ³ä½è°ƒå•Š å®åŠ›ä¸å…è®¸å•Šã€‚ã€‚ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1603700657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2760780,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKghO4kJwQ5ccuBA2Yox1WlZmq0JUICpNAsgYlOHX0wHGv48xVRKSvF9a6Eic5l2UOjFjnvTnsibibiaw/132","nickname":"Geek_94045a","note":"","ucode":"B8F23BA9D1411B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546270,"discussion_content":"ä¹Ÿè®¸ä½ çš„é¢è¯•å®˜ä¹Ÿåœ¨çœ‹è¿™ä¸ªä¸“æ  å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642260879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57560,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1546834438,"is_pvip":false,"replies":[{"id":"20745","content":"ç¬¬äºŒä¸ªè¯­å¥æŠŠç¬¬ä¸€ä¸ªgapå˜æˆ(1,10]äº†<br><br>ç¬¬ä¸‰ä¸ªupdateçš„é€»è¾‘é‡Œé¢ï¼ŒåŒ…å«äº†â€œè¦æ’å…¥ä¸€ä¸ªc=5çš„è¡Œâ€<br><br>å¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546844476,"ip_address":"","comment_id":57560,"utype":1}],"discussion_count":3,"race_medal":0,"score":"48791474694","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè‡ªå·±åŸºäºæ–‡ä¸­å¼€å¤´çš„è¡¨åšäº†ä¸€ä¸ªå®éªŒï¼Œ<br>session1ï¼š<br>mysql&gt; begin;<br>mysql&gt; explain select c from t where c &gt;5 lock in share mode;<br>åˆ†æï¼š(5,10],(10,15],(15,20],(20,25],(25,æ­£æ— ç©·)æœ‰é”ã€‚<br>session2:<br>mysql&gt; update t set c = 5 where c = 1;#(æ‰§è¡ŒæˆåŠŸ)<br>mysql&gt; update t set c = 1 where c = 5;#(æ‰§è¡ŒæˆåŠŸ)<br>mysql&gt; update t set c = 5 where c = 1;#(é˜»å¡)<br>æœ€åä¸€æ¡é˜»å¡ï¼Œæ— æ³•ç”¨åŸç†åˆ†æï¼Œè‚¯è¯·è€å¸ˆè§£ç­”ã€‚","like_count":11,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435642,"discussion_content":"ç¬¬äºŒä¸ªè¯­å¥æŠŠç¬¬ä¸€ä¸ªgapå˜æˆ(1,10]äº†\n\nç¬¬ä¸‰ä¸ªupdateçš„é€»è¾‘é‡Œé¢ï¼ŒåŒ…å«äº†â€œè¦æ’å…¥ä¸€ä¸ªc=5çš„è¡Œâ€\n\nå¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546844476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1722479,"avatar":"","nickname":"é©¬é’è‰³","note":"","ucode":"388E4689BED388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303933,"discussion_content":"ç¬¬äºŒå¥æ‰§è¡Œå®Œæˆåï¼Œå°±æ²¡æœ‰c=5çš„è®°å½•äº†ï¼Œ è¿™ä¸ªæ—¶å€™é”å°±æ‰©å±•åˆ°ï¼ˆ1ï¼Œ10]äº†ã€‚ ç¬¬ä¸‰å¥è‡ªç„¶ä¼šè¢«é˜»å¡","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1599411133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"æµ·æµª","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327782,"discussion_content":"ä¸ç”¨æŠŠéšå¼é”è½¬æ¢è€ƒè™‘è¿›å»ä¹ˆã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605947162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56526,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1546482249,"is_pvip":false,"replies":[{"id":"20384","content":"å‘å³æ‰«æå˜æˆäº†å‘å·¦æ‰«æï¼Œ<br>å‰å¼€åé—­è¿˜æ˜¯å‰å¼€åé—­ğŸ˜„<br>è§„åˆ™è¿˜æœ‰æ•ˆçš„<br>å¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546485984,"ip_address":"","comment_id":56526,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44496155209","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœåŠ äº†å…³é”®å­—descï¼Œæ˜¯ä¸æ˜¯æ–‡ä¸­çš„ä¼˜åŒ–è§„åˆ™ä¾ç„¶æœ‰æ•ˆï¼Œåªæ˜¯å·¦å¼€å³é—­åŒºé—´å˜æˆäº†å³å¼€å·¦é—­åŒºé—´ï¼Œå‘å³æ‰«æå˜æˆäº†å‘å·¦æ‰«æï¼Œè¿™æ ·ç†è§£å¯¹å—ï¼ŸğŸ¤”","like_count":10,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435094,"discussion_content":"å‘å³æ‰«æå˜æˆäº†å‘å·¦æ‰«æï¼Œ\nå‰å¼€åé—­è¿˜æ˜¯å‰å¼€åé—­ğŸ˜„\nè§„åˆ™è¿˜æœ‰æ•ˆçš„\nå¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546485984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58482,"user_name":"é¸ ç¿±","can_delete":false,"product_type":"c1","uid":1116568,"ip_address":"","ucode":"7D498AF2BC4289","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/98/b11c372b.jpg","comment_is_top":false,"comment_ctime":1547088919,"is_pvip":false,"replies":[{"id":"21183","content":"ä»£ç å®ç°ä¸Šæ˜¯è¿™æ ·å­çš„ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547140443,"ip_address":"","comment_id":58482,"utype":1}],"discussion_count":2,"race_medal":0,"score":"40201794583","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘ä»Šå¤©åœ¨å›é¡¾çš„æ—¶å€™åˆæƒ³åˆ°ä¸€ä¸ªæ–°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆRRçº§åˆ«ä¸‹è¦ä»¥next-key lockä½œä¸ºåŠ é”çš„åŸºæœ¬å•ä½å‘¢ï¼Ÿ<br>æ¯”å¦‚è¯´æ¡ˆä¾‹5ä¸­çš„é‚£ä¸ªä¾‹å­ï¼Œæˆ‘å°†å…¶ä¿®æ”¹æˆselect * from t where id &gt; 10 and id &lt; 15 for upadateï¼ŒæŒ‰ç…§åŠ é”è§„åˆ™ï¼Œéœ€è¦å¯¹(10,15]ä¸Šé”ï¼Œé‚£ä¹ˆæŒ‰ç…§é€»è¾‘æ¥çœ‹ï¼Œ15çš„é‚£ä¸ªè¡Œé”å…¶å®æ²¡å¿…è¦çš„ï¼ˆéš¾é“æ˜¯æœ‰å¿…è¦çš„å˜›ï¼Ÿï¼‰ï¼Œæ—¢ç„¶next-key lockæœ¬è´¨ä¹Ÿæ˜¯å…ˆåŠ é—´éš™é”å†åŠ è¡Œé”ï¼Œä¸ºä»€ä¹ˆéè¦æŠŠé‚£ä¸ªè¡Œé”ä¹ŸåŠ ä¸Šï¼Œå°±æ˜¯å› ä¸ºnext-key lockæ˜¯åŠ é”åŸºæœ¬å•ä½å˜›ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436084,"discussion_content":"ä»£ç å®ç°ä¸Šæ˜¯è¿™æ ·å­çš„ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547140443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1384866,"avatar":"https://static001.geekbang.org/account/avatar/00/15/21/a2/280e29ff.jpg","nickname":"dawn","note":"","ucode":"40CEAC0FD6567C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285617,"discussion_content":"æˆ‘è‡ªå·±è¯•äº†ä¸‹ï¼Œå‘ç°15å¹¶æ²¡æœ‰åŠ é”å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592895790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55927,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1546349094,"is_pvip":false,"discussion_count":8,"race_medal":0,"score":"35906087462","product_id":100020801,"comment_content":"è¿™å’Œåˆ†ä¸¤æ­¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ<br>(5,10]å·²ç»æ˜¯è¢«é”ä½ï¼Œåˆ†ä¸åˆ†ä¸¤æ­¥æ¥åŠ é”ï¼Œè¿™ä¸ªé—´éš™å’Œè¡Œé”éƒ½è¢«é”ä½äº†ï¼Œsession båº”è¯¥æ˜¯æ‹¿ä¸åˆ°é”æ‰å¯¹ã€‚","like_count":8,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584114,"discussion_content":"å› ä¸ºGAPé—´éš™é”ä¸ä¼šäº’æ–¥ï¼Œå³è¿™é‡Œçš„ï¼ˆ5,10ï¼‰ï¼Œå½“åœ¨åŠ ä¸Š[10]è¡Œé”å‘ç”Ÿé”ç­‰å¾…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660634477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164178,"discussion_content":"session bæ˜¯æ‹¿ä¸åˆ°é”å•Šï¼Œæ‰€ä»¥æ‰é˜»å¡äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581161159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"è‰¿è‰¿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38301,"discussion_content":"é—´éš™é”ï¼Œæ’ä»–çš„åŸå› ï¼Œå¾€é—´éš™é‡Œæ’å…¥è®°å½•ã€‚è¿™ä¸ªåœ¨ä¸Šä¸€èŠ‚è®²åˆ°è½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571757405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1458684,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ57v6PaIS3wZIqA5eEFyrOdsYcTicSmvpX8s8icUJcFTicFHt2Bh9z4WonglpQjf8UjNN9V8icRVtmOw/132","nickname":"Geek_feb353","note":"","ucode":"59B71C6A84689D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7113,"discussion_content":"åŒé—®ï¼Œå¸Œæœ›è€å¸ˆèƒ½ç»™è§£ç­”ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567389614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1588794,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3e/3a/2267d2a3.jpg","nickname":"hoppo","note":"","ucode":"B0C7C124A99B2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1458684,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ57v6PaIS3wZIqA5eEFyrOdsYcTicSmvpX8s8icUJcFTicFHt2Bh9z4WonglpQjf8UjNN9V8icRVtmOw/132","nickname":"Geek_feb353","note":"","ucode":"59B71C6A84689D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":190562,"discussion_content":"å°±å› ä¸ºåˆ†ä¸¤æ­¥ï¼ŒBå…ˆåŠ ä¸Šé—´éš™é”ï¼ˆ5,10) ã€‚ç„¶åå‡†å¤‡åŠ è¡Œé”ï¼Œå‘ç°åŠ ä¸ä¸Šè¿›å…¥é”ç­‰å¾…ã€‚æ­¤æ—¶A insert (8,8,8)ï¼Œå‘ç°BåŠ è¿‡äº†é—´éš™é”ï¼Œæ— æ³•æˆåŠŸï¼Œä¹Ÿè¿›å…¥é”ç­‰å¾…ï¼Œæ‰€ä»¥æ­»é”äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1582959961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7113,"ip_address":""},"score":190562,"extra":""},{"author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1588794,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3e/3a/2267d2a3.jpg","nickname":"hoppo","note":"","ucode":"B0C7C124A99B2D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289203,"discussion_content":"ä¸æ˜¯aå…ˆåŠ çš„ï¼ˆ5,10ï¼‰ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594024646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":190562,"ip_address":""},"score":289203,"extra":""},{"author":{"id":1722479,"avatar":"","nickname":"é©¬é’è‰³","note":"","ucode":"388E4689BED388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1148422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","nickname":"ç¾ç¾","note":"","ucode":"44CC95C45AF345","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303934,"discussion_content":"é—´éš™é”å¹¶ä¸ä¼šäº’æ–¥ï¼Œ Aäº‹åŠ¡åŠ äº†é—´éš™é”ï¼Œ Bäº‹åŠ¡ä¹Ÿå¯ä»¥å†æ¬¡åŠ ä¸Šé—´éš™é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599411213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":289203,"ip_address":""},"score":303934,"extra":""}]}]},{"had_liked":false,"id":55798,"user_name":"nero","can_delete":false,"product_type":"c1","uid":1110627,"ip_address":"","ucode":"BACD4A95B5FA09","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/63/1f495e51.jpg","comment_is_top":false,"comment_ctime":1546311451,"is_pvip":false,"replies":[{"id":"20107","content":"è¿™ä¸€è¡Œå¦‚æœå­˜åœ¨å°±æ˜¯ä¼˜åŒ–ä¸€<br><br>ä½†æ˜¯åœ¨æˆ‘ä»¬ä¾‹å­é‡Œï¼Œè¿™è¡Œä¸å­˜åœ¨","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546315465,"ip_address":"","comment_id":55798,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31611082523","product_id":100020801,"comment_content":"è¯·é—®ä¸‹æ¡ˆä¾‹ä¸€ä¸ºå•¥æ²¡ç”¨åˆ°ä¼˜åŒ–ä¸€ï¼š<br>ä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚<br>å› ä¸ºidæ˜¯ä¸»é”®ç´¢å¼•ï¼Œæ»¡è¶³å”¯ä¸€ç´¢å¼•ï¼ŒæŒ‰é“ç†åº”è¯¥èµ°ä¼˜åŒ–ä¸€çš„é€»è¾‘ï¼Œåªå¯¹id=7è¿™ä¸€è¡ŒåŠ é”","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434845,"discussion_content":"è¿™ä¸€è¡Œå¦‚æœå­˜åœ¨å°±æ˜¯ä¼˜åŒ–ä¸€\n\nä½†æ˜¯åœ¨æˆ‘ä»¬ä¾‹å­é‡Œï¼Œè¿™è¡Œä¸å­˜åœ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546315465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57618,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1546852203,"is_pvip":false,"replies":[{"id":"20771","content":"æ˜¯çš„ï¼Œä¸ä¸¥è°¨<br><br>ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„å¿«é€Ÿå®šä½èƒ½åŠ›","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546854633,"ip_address":"","comment_id":57618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27316655979","product_id":100020801,"comment_content":"æ¥ä¸Šä¸€ä¸ªæé—®ï¼Œè€å¸ˆå›ç­”ï¼šç¬¬äºŒä¸ªè¯­å¥æŠŠç¬¬ä¸€ä¸ªgapå˜æˆ(1,10]äº†ã€‚<br>å¯¹æ­¤éå¸¸æƒŠè®¶ï¼Œç›¸å½“äºå½“å‰çº¿ç¨‹çš„é”çš„èŒƒå›´å¯ä»¥è¢«åŠ¨å—åˆ«çš„çº¿ç¨‹å½±å“ï¼Œæ„Ÿè§‰æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>å¦å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæ‰§è¡Œ explain select c from t where c!=1;<br>å‘ç°possible_keyså’Œkeyéƒ½æ˜¯c,ä½†å…¶å®çœ‹ç€å¹¶æ²¡æœ‰ç”¨åˆ°æ ‘æœç´¢åŠŸèƒ½ï¼Œåªæ˜¯éå†äº†ç´¢å¼•ã€‚<br>ç½‘ä¸ŠåŸºæœ¬éƒ½è¯´!=ç”¨ä¸äº†ç´¢å¼•ï¼Œæ‰€ä»¥è¿™ç§è¯´æ³•æ˜¯ä¸ä¸¥è°¨çš„ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435669,"discussion_content":"æ˜¯çš„ï¼Œä¸ä¸¥è°¨\n\nç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„å¿«é€Ÿå®šä½èƒ½åŠ›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546854633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60733,"user_name":"ä»»æ´‹çˆ±åƒè‚‰","can_delete":false,"product_type":"c1","uid":1126168,"ip_address":"","ucode":"14AA217CB8C672","user_header":"https://static001.geekbang.org/account/avatar/00/11/2f/18/e437681f.jpg","comment_is_top":false,"comment_ctime":1547539955,"is_pvip":false,"replies":[{"id":"21671","content":"update æ²¡ç´¢å¼•å°±æ˜¯é”ä½ä¸»é”®ç´¢å¼•ä¸Šæ‰€æœ‰çš„è¡Œå’Œé—´éš™<br>é”çš„å†…å®¹å¤ªå¤šäº†ï¼Œ è¿™æ ·ç¡®å®å®¹æ˜“å‡ºç°æ­»é”å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547551977,"ip_address":"","comment_id":60733,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23022376435","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ€è¿‘åœ¨çº¿ä¸Šé‡åˆ°ä¸€ä¸ªé—®é¢˜å¦‚ä¸‹ï¼šæ‰§è¡Œä¸€ä¸ªç®€å•çš„updateè¯­å¥æ›´æ–°æ•°æ®åº“ï¼Œwhereåé¢çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œè¿™ä¸ªå­—æ®µçš„æ•°æ®åº“ä¸­å€¼å¯èƒ½æœ‰é‡å¤ï¼Œåœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¼šå¶å‘å‡ºç°æ•°æ®åº“æ­»é”çš„æƒ…å†µã€‚åé¢é€šè¿‡ï¼ŒæŸ¥è¯¢å‡ºä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®è¿›è¡Œæ›´æ–°ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œèƒ½éº»å‘è§£é‡Šä¸‹å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436603,"discussion_content":"update æ²¡ç´¢å¼•å°±æ˜¯é”ä½ä¸»é”®ç´¢å¼•ä¸Šæ‰€æœ‰çš„è¡Œå’Œé—´éš™\né”çš„å†…å®¹å¤ªå¤šäº†ï¼Œ è¿™æ ·ç¡®å®å®¹æ˜“å‡ºç°æ­»é”å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547551977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56245,"user_name":"rains","can_delete":false,"product_type":"c1","uid":1276520,"ip_address":"","ucode":"540BB449B0D52F","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/68/d6b53fbb.jpg","comment_is_top":false,"comment_ctime":1546411311,"is_pvip":false,"replies":[{"id":"20238","content":"é€ä¸ªåŠ ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546411883,"ip_address":"","comment_id":56245,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23021247791","product_id":100020801,"comment_content":"æ— ç´¢å¼•çš„åˆ—åšç­‰å€¼çš„updateï¼Œæ‰«æè¿‡çš„100è¡Œè®°å½•ï¼Œæ˜¯åŠ 1ä¸ªé”ï¼Œè¿˜æ˜¯ä¸€è¡Œä¸€è¡Œé€ä¸ªåŠ 100ä¸ªè¡Œé”","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434963,"discussion_content":"é€ä¸ªåŠ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546411883,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55875,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1546336626,"is_pvip":false,"replies":[{"id":"20121","content":"åŠ äº†limit 2æ˜¯å¯¹çš„<br><br><br>æ²¡åŠ çš„ä¸å®Œæ•´å“¦ã€‚éœ€è¦æ³¨æ„cä¸æ˜¯å”¯ä¸€ç´¢å¼•ã€‚<br>è¿™ä¸ªçœŸæ˜¯ä¸ªå¥½é—®é¢˜ï¼Œæˆ‘ç•™ç€ç­”ç–‘ç¯‡ç»™å¤§å®¶å½“ä½œæ€è€ƒé¢˜ä½ çœ‹è¡Œå—ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546341911,"ip_address":"","comment_id":55875,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23021173106","product_id":100020801,"comment_content":"è€å¸ˆ  ï¼Œ æŸ¥è¯¢ç‰¹å®šå€¼ å’Œ èŒƒå›´æŸ¥è¯¢éƒ½æœ‰äº† ã€‚ <br><br>é‚£ä¹ˆå¦‚æœæ˜¯ :<br>select id from t where c in ï¼ˆ5 ï¼Œ20ï¼Œ10ï¼‰ <br><br>è¿™ç§æƒ…å†µæœç´¢å¼•æ“æ˜¯æ€ä¹ˆèµ°çš„å‘¢ ï¼Œ æ˜¯å…ˆæŠŠ in ä¸­çš„å€¼è¿›è¡Œæ’åºç„¶åå†æŒ‰ç…§ c ç´¢å¼•å»åˆ†åˆ«å®šä½ä¸‰è¡Œ ã€‚ ä¹‹åçš„é”æ˜¯(0,5] ã€(5,10] ã€ï¼ˆ15,20] è¿™æ ·ä¹ˆ ã€‚<br><br>å¦‚æœå†åŠ ä¸Š limit 2<br><br>è¿™æ—¶å€™å°±åªæ˜¯ (0,5] ã€(5,10] ","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434871,"discussion_content":"åŠ äº†limit 2æ˜¯å¯¹çš„\n\n\næ²¡åŠ çš„ä¸å®Œæ•´å“¦ã€‚éœ€è¦æ³¨æ„cä¸æ˜¯å”¯ä¸€ç´¢å¼•ã€‚\nè¿™ä¸ªçœŸæ˜¯ä¸ªå¥½é—®é¢˜ï¼Œæˆ‘ç•™ç€ç­”ç–‘ç¯‡ç»™å¤§å®¶å½“ä½œæ€è€ƒé¢˜ä½ çœ‹è¡Œå—ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546341911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255843,"user_name":"David","can_delete":false,"product_type":"c1","uid":1509145,"ip_address":"","ucode":"EB1306748F7A86","user_header":"https://static001.geekbang.org/account/avatar/00/17/07/19/76943b89.jpg","comment_is_top":false,"comment_ctime":1603441905,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"18783311089","product_id":100020801,"comment_content":"æ¡ˆä¾‹å››ï¼š<br>è¿™æ¬¡ session A ç”¨å­—æ®µ c æ¥åˆ¤æ–­ï¼ŒåŠ é”è§„åˆ™è·Ÿæ¡ˆä¾‹ä¸‰å”¯ä¸€çš„ä¸åŒæ˜¯ï¼šåœ¨ç¬¬ä¸€æ¬¡ç”¨ c=10 å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼• c ä¸ŠåŠ äº† (5,10]è¿™ä¸ª next-key lock åï¼Œç”±äºç´¢å¼• c æ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆ sesion A åŠ çš„é”æ˜¯ï¼Œç´¢å¼• c ä¸Šçš„ (5,10] å’Œ (10,15] è¿™ä¸¤ä¸ª next-key lockã€‚<br><br>è¿™ä¸€å—ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åŒ¹é…åˆ°ä¼˜åŒ–äºŒï¼Œæ²¡æœ‰é€€åŒ–æˆé—´éš™é”ï¼Œè¿™å—æ²¡çœ‹æ‡‚ï¼Œæœ›è€å¸ˆå’Œæœ‹å‹ä»¬æŒ‡æ­£ä¸€ä¸‹ã€‚","like_count":4,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545169,"discussion_content":"æ¡ˆä¾‹4æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œä¼˜åŒ–2è¦æ±‚ç­‰å€¼æŸ¥è¯¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641869145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":213484,"user_name":"ğŸ‘€","can_delete":false,"product_type":"c1","uid":1979938,"ip_address":"","ucode":"6CE9845298DC4D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/36/22/c0b183ab.jpg","comment_is_top":false,"comment_ctime":1588430087,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18768299271","product_id":100020801,"comment_content":"æ‚¨å¥½ æˆ‘å¯¹äºæ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”æœ‰ä¸ªé—®é¢˜ åœ¨session A æ‰§è¡Œselectè¯­å¥ä¹‹åï¼Œæ˜¯ä¸æ˜¯cç­‰äº(0, 10)çš„åŒºé—´å°±è¢«é”å®šä½äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘å®éªŒæ„Ÿè§‰æ˜¯é”å®šä½äº†[0, 10]çš„èŒƒå›´å‘¢ï¼Ÿæˆ‘æ‰§è¡Œäº†å¦‚ä¸‹ä¸¤æ¡sqlè¯­å¥<br>1. insert into t values(1, 0,0);<br>2. insert into t values(1, 10, 0);<br>å‘ç°åŒæ ·æ˜¯é˜»å¡çš„æ•ˆæœï¼Œå¸Œæœ›æ‚¨èƒ½è§£ç­”ä¸€ä¸‹ï¼è°¢è°¢ï¼ï¼ï¼","like_count":4,"discussions":[{"author":{"id":1556722,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c0/f2/1b2ed786.jpg","nickname":"å·´è¨å·´è¨ï¼ï¼ï¼","note":"","ucode":"C204AD44347738","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296660,"discussion_content":"åœ¨ç´¢å¼•cçš„ä¸´ç•Œ0å’Œ10ä¸Šåº”è¯¥æœ‰å•ç‹¬çš„åˆ¤æ–­ï¼Œå¦‚æœidåœ¨(0,10)ä¹‹é—´ï¼Œé‚£ä¹ˆä¸å…è®¸æ’å…¥ï¼Œå¦‚æœä¸åœ¨å…è®¸æ’å…¥ï¼Œå¯ä»¥è¯•è¯•insert into t values(11, 0,0)  å’Œ   insert into t values(11, 10,0)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596616344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1245528,"avatar":"https://static001.geekbang.org/account/avatar/00/13/01/58/1788a7e6.jpg","nickname":"TheTingTings","note":"","ucode":"729CCE441856F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1556722,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c0/f2/1b2ed786.jpg","nickname":"å·´è¨å·´è¨ï¼ï¼ï¼","note":"","ucode":"C204AD44347738","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401947,"discussion_content":"å°è¯•äº†ä¸‹  insert into t values(11, 0,0)  è¢«é˜»å¡äº†ï¼Œ  insert into t values(11, 10,0) æ²¡è¢«é˜»å¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633771405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296660,"ip_address":""},"score":401947,"extra":""}]}]},{"had_liked":false,"id":85702,"user_name":"Geek_maxwell","can_delete":false,"product_type":"c1","uid":1446442,"ip_address":"","ucode":"15FBD7BE46AC81","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epbtcXw5PHzibHcXlupLmnZOYXBLR10U4Hvn5tib14EYlkMBERYgGlgZ63BxgFSBTQmUErfSXibcKl6w/132","comment_is_top":false,"comment_ctime":1555207117,"is_pvip":true,"discussion_count":7,"race_medal":0,"score":"18735076301","product_id":100020801,"comment_content":"è€å¸ˆæœ‰ä¸ªç–‘é—®ï¼Œå°±æ˜¯æ—¢ç„¶repeat readå·²ç»è§£å†³äº†å¹»è¯»ï¼ˆåˆ©ç”¨next key lock)ï¼Œé‚£ä¸‹ä¸€ä¸ªäº‹åŠ¡çº§åˆ«ï¼ˆåºåˆ—åŒ–ï¼‰ä¸»è¦æ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ å› ä¸ºåŸæœ¬æˆ‘ä»¥ä¸ºrepeat read å…¶å®æ²¡æœ‰è§£å†³å¹»è¯»","like_count":4,"discussions":[{"author":{"id":1101473,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ce/a1/76f4e230.jpg","nickname":"toyz","note":"","ucode":"47209F04FF8982","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3625,"discussion_content":"éš”ç¦»çº§åˆ«æœ¬èº«æ²¡æ³•è§£å†³å§,åªæ˜¯InnoDBæä¾›äº†è§£å†³æ–¹æ¡ˆ,æ¢ä¸ªå¼•æ“å°±ä¸è¡Œäº†","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1564646611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164179,"discussion_content":"RRé é—´éš™é”è§£å†³å¹»è¯»äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581161362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1052994,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/226NabDEu1IGMN7Om1gQqG22hk2dZKojpB0KDpAK0vtujQLdlgZsVaPbIc4ymcib0NdH3Syh8YibRuL7Lv5kVCkg/132","nickname":"æœå­","note":"","ucode":"D7B288A3E722F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404164,"discussion_content":"å¥½é—®é¢˜ï¼Œå¯æƒœè€å¸ˆæ²¡æœ‰å›ç­”ä½ ï¼Œæˆ‘è‡ªå·±æ‰¾åˆ°äº†ç­”æ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634227877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2351720,"avatar":"https://static001.geekbang.org/account/avatar/00/23/e2/68/ce547a12.jpg","nickname":"zjm1314","note":"","ucode":"63B0EAB7045054","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341619,"discussion_content":"æœ‰æ²¡æœ‰å…·ä½“ä¸²è¡ŒåŒ–çš„çº§åˆ«ï¼Œåˆ°åº•æ€ä¹ˆè§£å†³å¹»è¯»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610463055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1476730,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epm9ZuB7Cupiau858icuC98XI18qDeuFZR2jaYM6eniauwtLibYDoll3Jew2DJE1gp4ggdM9tGNdQJWzA/132","nickname":"ddup","note":"","ucode":"9DF454672A3ADA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278371,"discussion_content":"ä¼šæœ‰ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591178442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009000,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/68/93c05ab0.jpg","nickname":"laugh","note":"","ucode":"1CB29054325D1D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276221,"discussion_content":"é—´éš™é”è§£å†³ä¸äº†å†™å€¾æ–œé—®é¢˜ï¼Œæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡è¿™æœ¬ä¹¦é‡Œé¢æœ‰ä»‹ç»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590843093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115724,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","nickname":"ä¹˜é£","note":"","ucode":"0420C5535DACB7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250601,"discussion_content":"å¯ä»¥è¯•ä¸‹ï¼Œä¸»é”®ç´¢å¼•æ ‘æŸ¥è¯¢å¹¶æ²¡æœ‰è§£å†³å¹»è¯»ï¼Œå”¯ä¸€ç´¢å¼•é™çº§ä¸ºrl","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588032008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71405,"user_name":"åŒåŒ","can_delete":false,"product_type":"c1","uid":1306576,"ip_address":"","ucode":"8225BD50C00AF9","user_header":"","comment_is_top":false,"comment_ctime":1551334699,"is_pvip":false,"replies":[{"id":"25557","content":"åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœè¯´â€œè®°å½•ä¸Šçš„é”â€ï¼Œç´¢å¼•cä¸Šæœ‰c=10å’Œc=15ï¼Œ ä¸»é”®ä¸Šæœ‰id=10ã€‚<br><br>ä¸æ˜¯æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯ â€œæŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„è¡Œå’Œé—´éš™â€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551353899,"ip_address":"","comment_id":71405,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18731203883","product_id":100020801,"comment_content":"æ¡ˆä¾‹å››ï¼šselect * from t where c&gt;=10 and c&lt;11 for update;<br>ç´¢å¼•cä¸Šæœ‰ä¸¤ä¸ªnext-key lock,(5,10]å’Œ(10,15]ã€‚é‚£ç”±äºfor updateä¼šç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ï¼Œè¿™ä¸ªæ»¡è¶³æ¡ä»¶çš„è¡Œæ˜¯id=10è¿™ä¸€è¡Œå§ï¼Ÿæ»¡è¶³æ¡ä»¶æ˜¯æŒ‡æŸ¥è¯¢ç»“æœä¹ˆï¼Ÿ<br>","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441137,"discussion_content":"åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœè¯´â€œè®°å½•ä¸Šçš„é”â€ï¼Œç´¢å¼•cä¸Šæœ‰c=10å’Œc=15ï¼Œ ä¸»é”®ä¸Šæœ‰id=10ã€‚\n\nä¸æ˜¯æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯ â€œæŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„è¡Œå’Œé—´éš™â€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551353899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55636,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1546248806,"is_pvip":true,"replies":[{"id":"20085","content":"å¯¹ï¼Œå°±æ˜¯å”¯ä¸€ç´¢å¼•åŠ è¡Œé”","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546259336,"ip_address":"","comment_id":55636,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18726117990","product_id":100020801,"comment_content":"è€å¸ˆï¼Œ insert æ˜¯å¦‚ä½•åŠ é”çš„å‘¢ï¼Ÿ æ˜¯ä¸æ˜¯åªåŠ è¡Œé”å‘¢ï¼Ÿ   æˆ‘åœ¨session aä¸­æ’å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•ï¼ŒæˆåŠŸï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æäº¤ï¼Œç„¶ååœ¨session bä¸­é‡å¤æ’å…¥è¿™ä¸ªè®°å½•ï¼Œä¼šè¢«é˜»å¡ã€‚","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434817,"discussion_content":"å¯¹ï¼Œå°±æ˜¯å”¯ä¸€ç´¢å¼•åŠ è¡Œé”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546259336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3139195,"avatar":"https://static001.geekbang.org/account/avatar/00/2f/e6/7b/5b6f741b.jpg","nickname":"å‹‡æ•¢çš„å¿ƒ","note":"","ucode":"4922FEDA30DD50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584085,"discussion_content":"æ’å…¥æ„å‘é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660629450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211092,"user_name":"éŸ©æ–°å®‡","can_delete":false,"product_type":"c1","uid":1960906,"ip_address":"","ucode":"A51D23BE382250","user_header":"","comment_is_top":false,"comment_ctime":1587894216,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14472796104","product_id":100020801,"comment_content":"æ¡ˆä¾‹å…«session Aå·²ç»è·å–åˆ°äº†next-key lock(5,10] å’Œé—´éš™é” (10,15)ï¼›è¿™ä¸¤ä¸ªé”ï¼Œä¸ºä»€ä¹ˆsession Bè¿˜èƒ½è·å–åˆ°(5,10)é‚£ï¼Ÿé—´éš™é”ã€è¡Œé”ã€next-key lockæ˜¯å®Œå…¨ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1002403,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4b/a3/3cbffe77.jpg","nickname":"dtt","note":"","ucode":"923D4FE62FC1A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300757,"discussion_content":"å°è¯•è§£ç­”ï¼š\nnext-key lockåŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼šé—´éš™é”å’Œè¡Œé”ã€‚é—´éš™é”ä¸é—´éš™é”ä¹‹é—´ä¸å­˜åœ¨å†²çªå…³ç³»ï¼Œé—´éš™é”åªè·Ÿå¾€è¿™ä¸ªé—´éš™çš„æ’å…¥æ“ä½œå­˜åœ¨å†²çªï¼›è¡Œé”åŒ…å«è¯»é”å’Œå†™é”ï¼šè¯»é”ä¹‹é—´ä¸å­˜åœ¨å†²çªï¼Œ<è¯»é”, å†™é”> å’Œ <å†™é”, å†™é”>å‡å­˜åœ¨å†²çªã€‚\nåœ¨æ¡ˆä¾‹å…«ä¸­ï¼ŒSession Aå·²ç»è·å–äº†next-key lock(5,10] å’Œé—´éš™é” (10,15)ï¼Œè¿™é‡Œçš„next-key lockåŒ…å«é—´éš™é” (5, 10) å’Œ è¡Œé” {10}ï¼›Session Bé¦–å…ˆè¦è·å–next-key lock (5, 10]ï¼ˆæ³¨ï¼šåº”è¯¥è¿˜éœ€è¦è·å–next-key lock (10, 15]ï¼Œä¸è¿‡æ‰§è¡Œä¸åˆ°äº†ï¼‰ï¼š1. next-key lockä¸­åŒ…å«é—´éš™é”(5, 10)ï¼Œå› ä¸ºé—´éš™é”ä¹‹é—´æ²¡æœ‰å†²çªå…³ç³»ï¼Œå› æ­¤å¯ä»¥è·å–ï¼›2. è¡Œé”{10}ä¸Session Açš„è¡Œé”{10}å­˜åœ¨å†²çªï¼Œå› æ­¤è¢«blockä½ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1598257623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061082,"avatar":"https://static001.geekbang.org/account/avatar/00/10/30/da/8ec33b04.jpg","nickname":"Hony","note":"","ucode":"898C8C345A340D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370983,"discussion_content":"æ¡ˆä¾‹3ä¸æ˜¯è¯´æ˜¯è¦†ç›–ç´¢å¼•ï¼Œä¸ä¼šåŠ è¡Œé”10å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619600467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201799,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585838694,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14470740582","product_id":100020801,"comment_content":"è¿™ç¯‡å¾—çœ‹å¥½å‡ é","like_count":3,"discussions":[{"author":{"id":2020865,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d6/01/eaa50203.jpg","nickname":"zft","note":"","ucode":"74DEC5FBA610B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277218,"discussion_content":"è¯„è®ºåŒºä¼˜ç§€çš„è¯„è®ºä¹Ÿä¸å°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591017807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163877,"user_name":"Bourne","can_delete":false,"product_type":"c1","uid":1311299,"ip_address":"","ucode":"1286279F70B13F","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","comment_is_top":false,"comment_ctime":1576816386,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14461718274","product_id":100020801,"comment_content":"è¿™ä¸ªä¸“æ å¾ˆå€¼ï¼Œèƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œåœ¨æ­¤è°¢è°¢è€å¸ˆï¼Œè°¢è°¢æ‚¨ã€‚è¯´å®è¯çœ‹è¯„è®ºéƒ½èƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œè€å¸ˆä¹Ÿå¾ˆè´Ÿè´£ï¼Œç»™åŒå­¦ä»¬ç­”ç–‘è§£æƒ‘ï¼ŒçœŸçš„å¾ˆæ„Ÿè°¢ï¼Œå¸Œæœ›è€å¸ˆä»¥åè¿˜èƒ½å‡ºæ›´å¤šä¸“æ ã€åŒæ—¶è‡ªå·±ä¹Ÿèƒ½åšæŒå­¦ã€‚","like_count":3},{"had_liked":false,"id":85573,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1555129311,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14440031199","product_id":100020801,"comment_content":"@å”¯å¥¹å‘½ çš„é—®é¢˜ï¼Œæ¡ˆä¾‹ä¸€ä¸ºå•¥æ˜¯é—´éš™é”ï¼Œè€Œä¸æ˜¯è¡Œé”ï¼Ÿ<br><br>æˆ‘è‡ªå·±çš„ç†è§£ï¼šå› ä¸º id=7 çš„è®°å½•ä¸å­˜åœ¨ï¼Œæ²¡æœ‰ä¸Šé”çš„å®ä½“ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¼˜åŒ– 1ã€‚<br><br>ä¼˜åŒ– 1 æ˜¯è¯´ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä¸”è®°å½•å­˜åœ¨ï¼Œå°±é€€åŒ–æˆè¡Œé”ã€‚<br>ä¼˜åŒ– 2 æ˜¯è¯´åœ¨ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œä¸ç®¡æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œè¿˜æ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œåªæœ‰å‘å³éå†æ—¶ï¼Œæœ€åä¸€ä¸ªå€¼ä¸ç­‰äºç­‰å€¼æŸ¥è¯¢çš„æ¡ä»¶ï¼Œå°±ä¼šé€€åŒ–æˆé—´éš™é”ã€‚å¦‚ where id=7ï¼Œæ‰«æå®Œ id=5ï¼Œæ¥ç€æ‰«æ id=10ï¼Œä½†æ˜¯ 7 ä¸ç­‰äº 10ï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆé—´éš™é”ã€‚<br><br>å¦‚æœç†è§£æœ‰è¯¯ï¼Œè¿˜æœ›è€å¸ˆæŒ‡æ­£ğŸ˜ğŸ˜","like_count":3,"discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345584,"discussion_content":"ç†è§£çš„æ˜¯å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611748723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046172,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg","nickname":"ä¸èƒ½æ‰®æ¼”å¤©ä½¿","note":"","ucode":"9922330BFF7FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":85712,"discussion_content":"åŒæœ‰ç–‘é—®ï¼Œæ„Ÿè§‰ä½ è¯´çš„å¯¹ï¼Œè®°å½•ä¸å­˜åœ¨æ²¡æœ‰ä¸Šé”å¯¹è±¡ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576568964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150214,"user_name":"æ¬§é˜³","can_delete":false,"product_type":"c1","uid":1086986,"ip_address":"","ucode":"A72179D45213F6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqqj7ickh69y1Biau8xG4ogXA8ibqxpia69CiaQAQ6lqO0Qb9ujxiacAJq6ZwbzxmvgyQkuNwWaRUCXsYzA/132","comment_is_top":false,"comment_ctime":1573479393,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10163413985","product_id":100020801,"comment_content":"æ¡ˆä¾‹äº” åœ¨mysql8.0.18çš„ç‰ˆæœ¬ä¸­è²Œä¼¼æ”¹äº†ï¼Œä¸ä¼šåœ¨(15,20)ä¹‹é—´åŠ é—´éš™é”ï¼Œæ‰§è¡Œinsert into t values(16,16,16)å¯ä»¥æ’å…¥","like_count":2,"discussions":[{"author":{"id":2094225,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/f4/91/8723738b.jpg","nickname":"ç¨‹åºå‘˜å°èˆª","note":"","ucode":"00B8AE08DA916E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377815,"discussion_content":"å¹¶æ²¡æœ‰å®Œå…¨ä¿®å¤è¿™ä¸ª bug","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622884242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1384866,"avatar":"https://static001.geekbang.org/account/avatar/00/15/21/a2/280e29ff.jpg","nickname":"dawn","note":"","ucode":"40CEAC0FD6567C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285631,"discussion_content":"æˆ‘ä¹ŸåŒæ ·å‘ç°äº†è¿™ä¸ªï¼Œæ„Ÿè§‰æ˜¯ä¸æ˜¯å› ä¸ºç‰ˆæœ¬çš„å…³ç³»ï¼Œè¿™ç‰ˆæœ¬ä¿®å¤äº†bugï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592898476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146940,"user_name":"stand by me","can_delete":false,"product_type":"c1","uid":1643251,"ip_address":"","ucode":"66E43DD6441354","user_header":"https://static001.geekbang.org/account/avatar/00/19/12/f3/e54dae78.jpg","comment_is_top":false,"comment_ctime":1572709041,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10162643633","product_id":100020801,"comment_content":"è€å¸ˆçœŸçš„è®²çš„å¤ªå¥½äº†ï¼ï¼ï¼å—ç›ŠåŒªæµ…ã€‚<br><br>æ¯ä¸ªä¾‹å­æˆ‘éƒ½è¯•äº†ä¸€ä¸‹ã€‚æˆ‘å‘ç°ç¬¬ä¸‰ä¸ªä¸»é”®ç´¢å¼•èŒƒå›´ç¾¤è¿™ä¸ªä¾‹å­é‡Œé¢MYSQL 8.0.18ç‰ˆæœ¬ä¸ä¼šåœ¨ä¸»é”®15ä¸ŠåŠ ä¸Šé”äº†ï¼Œå› æ­¤æ›´æ–°å¯ä»¥æˆåŠŸã€‚èµ¶ç´§çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°è€å¸ˆæå‰å°±è¯´äº†ä¸åŒ…æ‹¬è¿™ä¸ªç‰ˆæœ¬ï¼ŒMySQLçš„åŠ é”è§„åˆ™åº”è¯¥æ˜¯å˜äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319966,"discussion_content":"åŒæ ·é‡åˆ°8.0+ç‰ˆæœ¬å¤ç°ä¸å‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604215653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142142,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1571299663,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10161234255","product_id":100020801,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œ<br>A:update  t  set = 2 where  h  = 5<br>B:update  t  set = 2 where  K  = 5<br><br>h,kéƒ½ä¸æ˜¯ç´¢å¼•ï¼Œå¦‚æœæ‰§è¡Œè¯­å¥Aä¸æäº¤ï¼Œæ­¤æ—¶Bä¼šæ‰§è¡Œå—ï¼Ÿ<br>å› ä¸ºé”æ˜¯é’ˆå¯¹ç´¢å¼•çš„ï¼Œå¯¹ä¸åŒçš„ç´¢å¼•åŠ é”å½¼æ­¤éƒ½ä¸ä¼šå½±å“ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•å‘¢ï¼Ÿä¸¤æ¡è¯­å¥éƒ½é”å…¨è¡¨å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83042,"discussion_content":"è¿™ä¸¤ä¸ªè¯­å¥éƒ½ä¼šé”å…¨è¡¨æ‰«æçš„ï¼Œé”å…¨è¡¨ï¼Œæ²¡æœ‰ç´¢å¼•ä¼šèµ°ä¸»é”®ç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576412910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"discussion":{"id":164187,"discussion_content":"æŒ‰è¿™ä¸ªè¯´æ³•çš„è¯ï¼ŒAä¸æäº¤ï¼ŒBå°±ä¸èƒ½æ‰§è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581161789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":83042,"ip_address":""},"score":164187,"extra":""},{"author":{"id":3007210,"avatar":"","nickname":"Geek_a1699c","note":"","ucode":"CF7DB00BE36B77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576324,"discussion_content":"æˆ‘è¯•éªŒäº†ä¸€ä¸‹ï¼Œæ˜¯ä½ è¿™è¯´çš„è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655434665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164187,"ip_address":""},"score":576324,"extra":""}]}]},{"had_liked":false,"id":74335,"user_name":"Barnett","can_delete":false,"product_type":"c1","uid":1072638,"ip_address":"","ucode":"18516BD03E2D67","user_header":"https://static001.geekbang.org/account/avatar/00/10/5d/fe/028dd54b.jpg","comment_is_top":false,"comment_ctime":1552193154,"is_pvip":false,"replies":[{"id":"27199","content":"(5,10]æ˜¯ä¸ªç®€å†™<br><br>å…¶å®å°±æ˜¯å·¦è¾¹ç•Œæ˜¯ ï¼ˆc=5,id=5) , å³è¾¹ç•Œæ˜¯(c=10, id=10)ï¼Œ<br><br>å·¦å¼€å³é—­<br><br>è¿™æ ·ä½ å†çœ‹ä¸‹è¿™ä¸ªç»“è®ºğŸ˜†<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1552229220,"ip_address":"","comment_id":74335,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10142127746","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå…³äºç²¾é€‰ç•™è¨€ä¸­å •è½å¤©ä½¿çš„ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œnext-key lockæ˜¯(5,10],(10,10],(10,15)ï¼Œæ‚¨çš„å›ç­”æ˜¯(c=5,id=50)ä¹Ÿæ˜¯åœ¨è¿™ä¸ªgapé‡Œçš„ã€‚ä½†æ˜¯5ä¸æ˜¯å¼€åŒºé—´çš„å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442536,"discussion_content":"(5,10]æ˜¯ä¸ªç®€å†™\n\nå…¶å®å°±æ˜¯å·¦è¾¹ç•Œæ˜¯ ï¼ˆc=5,id=5) , å³è¾¹ç•Œæ˜¯(c=10, id=10)ï¼Œ\n\nå·¦å¼€å³é—­\n\nè¿™æ ·ä½ å†çœ‹ä¸‹è¿™ä¸ªç»“è®ºğŸ˜†\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552229220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61280,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1547651451,"is_pvip":false,"replies":[{"id":"21797","content":"3ã€åˆ¤æ–­c&gt;=15ï¼Œæ™®é€šç´¢å¼•c=15ï¼Œç»§ç»­å‘å·¦éå†åˆ°c=5ä¸ç¬¦åˆæ¡ä»¶ï¼Œå¹¶ä¸”ä¼˜åŒ–2ç­‰å€¼ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®é™ä¸ºé—´éš™é”(5,15)<br>æ‰€ä»¥é”çš„èŒƒå›´æ˜¯(5,15)+[15,20)+[20,25)<br><br>è¿™ä¸ªä¸å¤ªå¯¹å“ˆï¼ˆæˆ–è€…è¯´è·Ÿæˆ‘æ–‡ç« é‡Œé¢è¯´çš„è§„åˆ™ä¸åŒ¹é…ï¼‰ã€‚<br>c&gt;=15è¿™ä¸ªæ¡ä»¶ï¼Œåªä¼šå‘å·¦åŒ¹é…åˆ°c=10è¿™ä¸ªè®°å½•ï¼Œ<br>åªæ˜¯å› ä¸ºnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ï¼Œæ‰€ä»¥å°±æ˜¯(5,10].<br><br>ç»“è®ºçš„èŒƒå›´ä¹Ÿç¡®å®æ˜¯(5,15)+[15,20)+[20,25) ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547658981,"ip_address":"","comment_id":61280,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10137586043","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ï¼š<br><br>order by descä¼˜åŒ–å™¨ä¼šå‘å·¦éå†<br>1ã€å…ˆåˆ¤æ–­æ¡ä»¶c&lt;=20ï¼Œæ™®é€šç´¢å¼•ç­‰å€¼c=20ï¼Œæ‰€ä»¥next-key-lock:ï¼ˆ25ï¼Œ20]<br>2ã€20åˆ°15ï¼Œæ‰€ä»¥next-key-lock:ï¼ˆ20ï¼Œ15]<br>3ã€åˆ¤æ–­c&gt;=15ï¼Œæ™®é€šç´¢å¼•c=15ï¼Œç»§ç»­å‘å·¦éå†åˆ°c=5ä¸ç¬¦åˆæ¡ä»¶ï¼Œå¹¶ä¸”ä¼˜åŒ–2ç­‰å€¼ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®é™ä¸ºé—´éš™é”(5,15)<br>æ‰€ä»¥é”çš„èŒƒå›´æ˜¯(5,15)+[15,20)+[20,25)","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436815,"discussion_content":"3ã€åˆ¤æ–­c&amp;gt;=15ï¼Œæ™®é€šç´¢å¼•c=15ï¼Œç»§ç»­å‘å·¦éå†åˆ°c=5ä¸ç¬¦åˆæ¡ä»¶ï¼Œå¹¶ä¸”ä¼˜åŒ–2ç­‰å€¼ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®é™ä¸ºé—´éš™é”(5,15)\næ‰€ä»¥é”çš„èŒƒå›´æ˜¯(5,15)+[15,20)+[20,25)\n\nè¿™ä¸ªä¸å¤ªå¯¹å“ˆï¼ˆæˆ–è€…è¯´è·Ÿæˆ‘æ–‡ç« é‡Œé¢è¯´çš„è§„åˆ™ä¸åŒ¹é…ï¼‰ã€‚\nc&amp;gt;=15è¿™ä¸ªæ¡ä»¶ï¼Œåªä¼šå‘å·¦åŒ¹é…åˆ°c=10è¿™ä¸ªè®°å½•ï¼Œ\nåªæ˜¯å› ä¸ºnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ï¼Œæ‰€ä»¥å°±æ˜¯(5,10].\n\nç»“è®ºçš„èŒƒå›´ä¹Ÿç¡®å®æ˜¯(5,15)+[15,20)+[20,25) ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547658981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2716512,"avatar":"https://static001.geekbang.org/account/avatar/00/29/73/60/469bcdfb.jpg","nickname":"ææ‰¿èŠ³","note":"","ucode":"0848375E0178E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":540698,"discussion_content":"5,10è¿™ä¸ªnext-key lock ä¸é€€åŒ–æ˜¯ä¸ºä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640140725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":436815,"ip_address":""},"score":540698,"extra":""}]},{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"é˜¿å‡¯æ–‡","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283869,"discussion_content":"è¿™ä¸ªäººç•™è¨€çœŸæ€ªï¼Œéè¦å¤§çš„æ•°æ”¾åœ¨ä¸‹é™ï¼Œè®©çœ‹çš„äººä¸åˆ«æ‰­è´¹è§£å˜›ï¼Œè€Œä¸”å‰é—­åå¼€ï¼Œéä¹Ÿè·Ÿä½œè€…æä¸€å¥—åçš„è¡¨è¾¾æ–¹å¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592386648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58392,"user_name":"è¢ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1000862,"ip_address":"","ucode":"30BCA7B2705247","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/9e/57e18908.jpg","comment_is_top":false,"comment_ctime":1547050200,"is_pvip":false,"replies":[{"id":"21051","content":"ğŸ‘ğŸ¿ è¿™ç§æ„Ÿè§‰æœ€æ£’","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547085184,"ip_address":"","comment_id":58392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10136984792","product_id":100020801,"comment_content":"æ„Ÿè°¢è€å¸ˆï¼Œç”¨è¿™äº›çŸ¥è¯†æˆåŠŸçš„æ‰¾åˆ°äº†æœ€è¿‘å‡ºç°çš„æ­»é”","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436044,"discussion_content":"ğŸ‘ğŸ¿ è¿™ç§æ„Ÿè§‰æœ€æ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547085184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57006,"user_name":"å¤å¨œæ‹‰é»‘æš—ä¹‹ç¥Â·å·´å•¦å•¦èƒ½é‡Â·å •è½è¾¾","can_delete":false,"product_type":"c1","uid":1185642,"ip_address":"","ucode":"080BBCEF7DE985","user_header":"https://static001.geekbang.org/account/avatar/00/12/17/6a/c979163e.jpg","comment_is_top":false,"comment_ctime":1546598617,"is_pvip":false,"replies":[{"id":"20569","content":"æˆ‘è§‰å¾—æ¡ˆä¾‹6ã€7å°±æ˜¯è®²åˆ°äº†å“¦ï¼Œæ™®é€šç´¢å¼•æ˜¯å¸¦ç€ä¸»é”®å€¼çš„ï¼›<br><br>åº”è¯¥è¯´(c=5,id=50)æ‰€åœ¨çš„é—´éš™æ˜¯ (c=5,id=5)åˆ°(c=10,id=10)<br><br>ä½ å¯ä»¥åƒæ¡ˆä¾‹5é‚£æ ·è‡ªå·±ç”»ä¸ªç´¢å¼•å›¾","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546609558,"ip_address":"","comment_id":57006,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10136533209","product_id":100020801,"comment_content":"å •è½å¤©ä½¿ï¼š<br>è€å¸ˆï¼Œæ‚¨å¥½ã€‚å‡æœŸçš„æ²¡è·Ÿä¸Šï¼Œä»Šå¤©è¡¥åˆ°äº†è¿™èŠ‚è¯¾ï¼Œçœ‹äº†ä¹‹åæœ‰å‡ ç‚¹ä¸æ˜¯å¤ªæ˜ç™½ã€‚æœ›èƒ½è§£ç­”ä¸€ä¸‹ã€‚<br>1. ç´¢å¼•cä¸Šçš„é”ç®—ä¸ç®—æ˜¯è¡Œé”ã€‚å‡å¦‚ç´¢å¼•cä¸Šçš„next-key lockä¸º(0,5] (5,10]ï¼Œé‚£ä¹ˆ5ç®—ä¸ç®—æ˜¯cä¸Šçš„è¡Œé”ï¼Ÿ<br>2. åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œæ‰§è¡Œ â€œdelete from t where c=10;â€ è¯­å¥ï¼Œç´¢å¼•cä¸Šçš„next-key lockæ˜¯(5,10],(10,10],(10,15)ã€‚é‚£ä¹ˆä¸»é”®ç´¢å¼•ä¸Šçš„é”æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯åªæœ‰è¡Œé”ï¼Œé”ä½çš„æ˜¯ (10,10,10) å’Œ (30,10,30) ä¸¤è¡Œå—ï¼Ÿ<br>3. ä¹Ÿæ˜¯åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œsession Aä¸å˜ï¼Œåœ¨session Bä¸­æ‰§è¡Œ â€œupdate t_20 set d=50 where c=5;â€ã€â€œupdate t_20 set d=50 where c=15;â€ã€â€œinsert into t_20 values(40,15,40);â€å‡æ‰§è¡ŒæˆåŠŸï¼Œä½†æ‰§è¡Œâ€œinsert into t_20 values(50,5,50);â€ æ—¶ï¼Œå´è¢«é˜»å¡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>ä½œè€…å›å¤<br>1. Next-key lock å°±æ˜¯é—´éš™é”â•è¡Œé”ï¼Œæ‰€ä»¥åŒ…å«=5è¿™ä¸€è¡Œ<br>2. å¯¹<br>3. (c=5,id=50)æ˜¯åœ¨è¿™ä¸ªgapé‡Œå“¦ï¼Œä½ è¯•è¯•æ’å…¥(1,5,50)å¯¹æ¯”ä¸€ä¸‹ã€‚å¥½é—®é¢˜<br><br>æˆ‘çš„å›å¤ï¼š<br>è€å¸ˆï¼Œæ‚¨å¥½ï¼š<br>åœ¨ç¬¬ä¸‰ä¸ªé—®é¢˜ä¸­ï¼Œå¯¹äºç´¢å¼•cçš„é”åº”è¯¥æ˜¯ (5,10]ã€(10,10]ã€(10,15)ï¼›ä¸»é”®ç´¢å¼•ä¸Šçš„é”ä¸ºè¡Œé”ï¼Œæ˜¯â€œ(10,10,10) å’Œ (30,10,30) â€ä¸¤è¡Œè®°å½•ã€‚é‚£ä¹ˆ(c=5,id=50) æ˜¯åœ¨å“ªä¸ªé—´éš™é”ä¸Šå‘¢ï¼Ÿæ˜¯è¿˜æ²¡æœ‰è®²è¿˜æ˜¯æˆ‘ç²—å¿ƒæ²¡çœ‹åˆ°å‘¢ï¼Ÿå¦å¤–ç»è¿‡æ‚¨çš„å¯å‘ï¼Œæˆ‘åœ¨ sessio B ä¸­åˆæ’å…¥äº†å‡ æ¡è®°å½•ï¼Œå¦‚ä¸‹:<br>â€œinsert into t_20 values(1,5,50);â€ã€â€œinsert into t_20 values(60,1,50);â€ã€â€œinsert into t_20 values(80,4,50);â€ ã€â€œinsert into t_20 values(70,15,50);â€ å‡æ’å…¥æˆåŠŸã€‚<br>ä½†æ’å…¥â€œinsert into t_20 values(100,5,50);â€ã€â€œinsert into t_20 values(300,5,50);â€å‡è¢«é˜»å¡ã€‚<br>æˆ‘å¤§èƒ†çŒœæƒ³ä¸€ä¸‹ï¼Œ(c=5,id=50) çš„é—´éš™é”æ˜¯ä¸æ˜¯&quot;c=5 å¹¶ä¸” id=(30,+suprenum]&quot; ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435356,"discussion_content":"æˆ‘è§‰å¾—æ¡ˆä¾‹6ã€7å°±æ˜¯è®²åˆ°äº†å“¦ï¼Œæ™®é€šç´¢å¼•æ˜¯å¸¦ç€ä¸»é”®å€¼çš„ï¼›\n\nåº”è¯¥è¯´(c=5,id=50)æ‰€åœ¨çš„é—´éš™æ˜¯ (c=5,id=5)åˆ°(c=10,id=10)\n\nä½ å¯ä»¥åƒæ¡ˆä¾‹5é‚£æ ·è‡ªå·±ç”»ä¸ªç´¢å¼•å›¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546609558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348490,"discussion_content":"ä¸€çœ‹åˆ°ä½ çš„é—®é¢˜æ„Ÿè§‰å¾—æ­‡ä¸€ä¸‹ï¼Œå…»è¶³ç²¾ç¥æ‰èƒ½ç»§ç»­^.^ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612600370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56899,"user_name":"é’±å½¬å½¬","can_delete":false,"product_type":"c1","uid":1108171,"ip_address":"","ucode":"218C6814E73C16","user_header":"https://static001.geekbang.org/account/avatar/00/10/e8/cb/be4388db.jpg","comment_is_top":false,"comment_ctime":1546574437,"is_pvip":false,"replies":[{"id":"20535","content":"é¢ï¼Œä¸æ˜¯æ•°å€¼5å“¦ï¼Œæ˜¯ä¸¤ä¸ªè®°å½•ä¹‹é—´ï¼Œå°±æ˜¯é—´éš™<br><br>å­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€æ ·ï¼ŒæŒ‰é¡ºåºå­˜ï¼Œä¸åŒè¡Œä¹‹é—´å°±æœ‰é—´éš™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546577632,"ip_address":"","comment_id":56899,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10136509029","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚gapé”çš„èŒƒå›´æ˜¯å¯ä»¥è®¾ç½®çš„å—ï¼Ÿå¦‚æœæ˜¯æ€ä¹ˆè®¾ç½®å‘€ï¼Ÿå¦‚æœä¸æ˜¯ä¸ºä»€ä¹ˆæ˜¯èŒƒå›´5å‘¢ï¼Ÿ <br>æˆ‘ä»¬è¿™äº›ä¾‹å­ä¸­éƒ½æ˜¯æ•°å€¼ç±»å‹çš„ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œgapé”æ€ä¹ˆç¡®å®šè¿™ä¸ªåŒºé—´ï¼Ÿè¾›è‹¦è€å¸ˆäº†ã€‚","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435303,"discussion_content":"é¢ï¼Œä¸æ˜¯æ•°å€¼5å“¦ï¼Œæ˜¯ä¸¤ä¸ªè®°å½•ä¹‹é—´ï¼Œå°±æ˜¯é—´éš™\n\nå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€æ ·ï¼ŒæŒ‰é¡ºåºå­˜ï¼Œä¸åŒè¡Œä¹‹é—´å°±æœ‰é—´éš™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546577632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310524,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1630722343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5925689639","product_id":100020801,"comment_content":"<br>session A : begin; select d from t where c=5 lock in share mode;<br>session B : ä»¥ä¸‹å„æ¡å•ç‹¬æ‰§è¡Œç»“æœå¦‚ä¸‹<br>1. update t set d=d+1 where id = 5;  -- blocked<br>2. insert into t values(4,100,100);  -- success<br>3. insert into t values(6,100,100);  -- success<br><br>4. insert into t values(100,4,100);  -- blocked<br>5. insert into t values(100,6,100);  -- blocked<br>6. insert into t values(100,0,100);  -- bolcked(æŸ¥çœ‹innodb_locksè¡¨ï¼Œæ˜¯é”çš„ç´¢å¼•cï¼Œä½†æ˜¯æˆ‘åˆ†æä¸å‡ºæ¥åŸå› )<br>7. insert into t values(-1,0,100);   -- success<br>8. insert into t values(100,10,100); -- success<br><br><br>æ€»ç»“ï¼šsession Aä¼šé”ä½ä¸¤ä¸ªç´¢å¼•(ä»¥ä¸‹èŒƒå›´ä»…è¡¨ç¤ºå„ç´¢å¼•ä¸Šçš„å€¼)ï¼š<br>1.ä¸»é”®ç´¢å¼•: è¡Œé”-5   é€‚åˆä¼˜åŒ–1<br>2.æ™®é€šç´¢å¼•c: (0,5], (5,10) <br><br>é—®é¢˜ç¬¬6ä¸ªè„šæœ¬æ€ä¹ˆæ‰§è¡Œä¸é€šè¿‡ï¼Ÿä½†æ˜¯ç¬¬7ä¸ªè„šæœ¬é€šè¿‡äº†ã€‚ã€‚","like_count":1},{"had_liked":false,"id":255785,"user_name":"é±¼ä¸¸ç²—é¢","can_delete":false,"product_type":"c1","uid":1805050,"ip_address":"","ucode":"F91B7535C2A8BE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/8a/fa/6c0a3826.jpg","comment_is_top":false,"comment_ctime":1603429650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898396946","product_id":100020801,"comment_content":"è€å¸ˆ, æˆ‘æœ‰ä¸ªå¾ˆç–‘æƒ‘çš„åœºæ™¯,<br>å‚è€ƒæ¡ˆä¾‹3, å¦‚æœåŠ ä¸€ä¸ªå­—æ®µb, ä¸ºå”¯ä¸€ç´¢å¼•, å€¼å’Œidä¸€æ ·,<br>é‚£å½“æ‰§è¡Œè¯­å¥select * from t where b&gt;=10 and b&lt;11 for update;çš„æ—¶å€™, ä¸»é”®ç´¢å¼•æ ‘ä¸Šä¼šåŠ ä»€ä¹ˆé”.<br>æˆ‘æµ‹è¯•ä¸‹æ¥, å‘ç°ç»“æœæ˜¯:<br>1. bç´¢å¼•æ ‘ä¸Šä¼šåŠ (5, 10],(10, 15]è¿™ä¸¤ä¸ªnext-key lock, è¿™ä¸ªè·Ÿæ¡ˆä¾‹ä¸‰çš„ç»“æœä¸€æ ·,<br>2. ä½†æ˜¯ä¸»é”®ç´¢å¼•æ ‘ä¸Šåªä¼šç»™id=10è¿™ä¸€è¡ŒåŠ è¡Œé”, è€Œid=15è¿™ä¸€è¡Œå¹¶ä¸ä¼šé”ä½(update t set d=d+1 where id = 15å¯ä»¥æ‰§è¡Œ),<br>æˆ‘è¿™é‡Œç–‘æƒ‘çš„æ˜¯, select * æŸ¥è¯¢ä¸æ˜¯è¦å›è¡¨å—, é‚£æ ¹æ®åŸåˆ™2, æ‰«æåˆ°çš„è¡Œéƒ½è¦åŠ é”, é‚£å¦‚æœå›è¡¨äº†, id=15è¿™ä¸€è¡Œå°±ä¼šè¢«æ‰«æåˆ°, é‚£ä¸ºä»€ä¹ˆid=15è¿™ä¸€è¡Œæ²¡æœ‰ä¸Šé”,<br>æˆ‘èƒ½æƒ³åˆ°çš„ç­”æ¡ˆåªæœ‰ä¸€ä¸ª, é‚£å°±æ˜¯å› ä¸ºb=15è¿™ä¸€è¡Œ, ä¸ç¬¦åˆæŸ¥è¯¢æ¡ä»¶, æ‰€ä»¥åˆ°è¿™é‡Œæ‰«æå°±ç»“æŸäº†, å°±æ²¡æœ‰å›è¡¨çš„æ“ä½œ, ä¹Ÿå°±ä¸ä¼šç»™id=15è¿™ä¸€è¡ŒåŠ è¡Œé”äº†,<br><br>è®¢é˜…çš„æ¯”è¾ƒæ™š, ä¸çŸ¥é“è€å¸ˆèƒ½ä¸èƒ½çœ‹åˆ°è¯„è®º,å¸Œæœ›è€å¸ˆæŒ‡æ­£.","like_count":1},{"had_liked":false,"id":220482,"user_name":"é˜¿èƒ–","can_delete":false,"product_type":"c1","uid":1302380,"ip_address":"","ucode":"86FA4A5B694A43","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/6c/0ee21bef.jpg","comment_is_top":false,"comment_ctime":1590248214,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885215510","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨mysql5.7ä»¥åŠ8.0.12 æ“ä½œæ¡ˆä¾‹å…«ï¼Œæ²¡æœ‰å‡ºç°æ­»é”ã€‚<br><br>æ¡ˆä¾‹å…«ï¼šsession Bçš„æ“ä½œè¯­å¥update t set d = d + 1 where c =10; <br>éœ€è¦åŠ é” ï¼ˆ5ï¼Œ10ã€  ï¼ˆ10ï¼Œ15ã€ï¼Œä½†æ˜¯è¿™äº›å·²ç»è¢«sessionAæ‰§è¡Œselectæ—¶å ç”¨äº†ï¼Œæ•…sessionBæ²¡æœ‰è·å¾—é”ï¼ŒsessionAå†æ¬¡æ‰§è¡Œinsertä¹Ÿä¸ä¼šæ­»é”ã€‚<br>","like_count":1},{"had_liked":false,"id":187761,"user_name":"è›‹ç‚’é¥­åŠ é¸¡è›‹","can_delete":false,"product_type":"c1","uid":1628398,"ip_address":"","ucode":"C75E27B9FB3336","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","comment_is_top":false,"comment_ctime":1584235140,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5879202436","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸Šç¯‡ç¬¬ä¸€ä¸ªç½®é¡¶è¯„è®ºï¼Œ@ä»¤ç‹å°‘ä¾ çš„é—®é¢˜ï¼Œé€šè¿‡è¿™ç¯‡çš„å­¦ä¹ ï¼Œå¯¹äºselect * from t where c = 5 for update;<br>çŸ¥é“äº†åŠ é”å•ä½ä¸ºnext-key lockï¼Œå³å…ˆåœ¨ç´¢å¼•c(0,5]åŠ next-key lockï¼Œç”±äºcä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œç»§ç»­æ‰«æï¼Œæ‰«æåˆ°10åœæ­¢ï¼Œå³åˆåŠ äº†(5,10]è¿™ä¸ªnext-key lockï¼Œä½†æ˜¯ç”±äºä¼˜åŒ–2ï¼Œæ‰€ä»¥next-key locké€€åŒ–æˆé—´éš™é”ï¼Œå³æœ€ç»ˆåŠ é”èŒƒå›´ä¸º(0,5],(5,10),æ˜¯ä¸åŒ…å«10çš„ï¼Œä½†æ˜¯æˆ‘å®éªŒ@ä»¤ç‹å°‘ä¾ çš„ä¾‹å­ï¼Œ10æ˜¯ä¸èƒ½æ›´æ–°çš„ï¼Œè¢«é”ä½äº†ï¼Œè€å¸ˆèƒ½è§£é‡Šä¸‹å—ï¼Ÿä½†æ˜¯æˆ‘å®éªŒäº†æœ¬ç¯‡çš„è¿™å‡ ä¸ªä¾‹å­éƒ½æ˜¯å’Œè€å¸ˆçš„ç»“æœä¸€æ ·ï¼Œmysqlç‰ˆæœ¬æ˜¯æ˜¯5.7.26","like_count":1,"discussions":[{"author":{"id":1323560,"avatar":"https://static001.geekbang.org/account/avatar/00/14/32/28/90cceab3.jpg","nickname":"æœˆæ²³","note":"","ucode":"702B30A1F2C149","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241992,"discussion_content":"æˆ‘æ˜¯å¯ä»¥çš„ï¼Œå¹¶æ²¡æœ‰é”ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587455074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176925,"user_name":"DBRE","can_delete":false,"product_type":"c1","uid":1106706,"ip_address":"","ucode":"FEB779C5D2946C","user_header":"https://static001.geekbang.org/account/avatar/00/10/e3/12/fd02db2e.jpg","comment_is_top":false,"comment_ctime":1581228880,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5876196176","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚å¯¹æ¡ˆä¾‹å››çš„å˜ç§æœ‰äº›ç–‘é—®ï¼Œå¸Œæœ›å¸®å¿™è§£ç­”ã€‚<br><br>session A:<br>mysql&gt; begin; select * from t where c&gt;10 for update; <br>Query OK, 0 rows affected (0.00 sec)<br><br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 15 |   15 |   15 |<br>| 20 |   20 |   20 |<br>| 25 |   25 |   25 |<br>+----+------+------+<br>3 rows in set (0.00 sec)<br><br>Session B:<br>mysql&gt; insert into t values(8,8,8);<br>å‘ç”Ÿé˜»å¡<br><br>Session C:<br>mysql&gt; insert into t values(4,4,4); <br>å‘ç”Ÿé˜»å¡<br><br>ç–‘é—®ï¼šè‡ªå·±åˆ†æsession Aä¸­ åœ¨cç´¢å¼•ä¸ŠåŠ çš„é”æ˜¯next-key(10,15],(15,20],(20,25],(25,+âˆ], ä¸ºä»€ä¹ˆsession Bå’ŒCä¼šè¢«é˜»å¡å‘¢? éœ€è¦å¦‚ä½•åˆ†æå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1106706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e3/12/fd02db2e.jpg","nickname":"DBRE","note":"","ucode":"FEB779C5D2946C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":166029,"discussion_content":"æˆ‘æƒ³æ˜ç™½äº†ï¼Œæ•°æ®å¤ªå°‘ï¼Œsession Aæ˜¯å…¨è¡¨æ‰«æäº†ï¼Œå¯¹æ¯ä¸€è¡ŒåŠè¡Œä¹‹é—´çš„gapéƒ½åŠ é”äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581346083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176462,"user_name":"æ–æ³¢é‚£å¥‘","can_delete":false,"product_type":"c1","uid":1464006,"ip_address":"","ucode":"85E2EBC01392B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","comment_is_top":false,"comment_ctime":1581064692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5876031988","product_id":100020801,"comment_content":"æˆ‘çš„MySQLæ˜¯8.0.19<br>ç›®å‰æ¡ˆä¾‹äº”çš„bugå·²ç»è§£å†³äº† session bå’Œsession céƒ½ä¸ä¼šé˜»å¡ ä¹Ÿå°±æ˜¯è¯´ æŸ¥è¯¢æ¡ä»¶æ˜¯id&lt;=15 å½“æ‰¾åˆ°id=15çš„æ—¶å€™é€€åŒ–æˆè¡Œé”å¹¶ä¸”ä¹Ÿä¸åœ¨å¾€ä¸‹æœç´¢äº†<br>åŒæ—¶æ¡ˆä¾‹ä¸‰ä¸­session cæ²¡æœ‰é˜»å¡<br>æ˜¯ä¸æ˜¯å¯ä»¥è¯´8.0å¯¹å”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥æ‰¾è¿›è¡Œäº†ä¼˜åŒ– åªè¦æ˜¯ç­‰å€¼æŸ¥è¯¢åˆ°å°±é€€åŒ–æˆè¡Œé”","like_count":1},{"had_liked":false,"id":169822,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1578452531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873419827","product_id":100020801,"comment_content":"1ã€RR éš”ç¦»çº§åˆ«å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡å½“å‰è¯»çš„ç»“æœé›†ä¸€è‡´ã€‚å½“å‰è¯»æœ¬èº«å¯¹è®°å½•æœ‰åŠ é”ï¼ˆä»»æ„éš”ç¦»çº§åˆ«ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä¸å…¶ä»–äº‹åŠ¡äº’æ–¥ã€‚å‡ºäº†ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯æœ‰æ–°çš„insert è¯­å¥ã€‚æ–°çš„è®°å½•ä¸åœ¨é”çš„èŒƒå›´å†…ã€‚è¿™æ ·å°±ä¿è¯ä¸äº†ä¸¤æ¬¡å½“å‰è¯»çš„ç»“æœä¸€è‡´ã€‚æ‰€ä»¥RR éš”ç¦»çº§åˆ«åŠ å¤§é”çš„èŒƒå›´ä½¿ç”¨ äº† next-key lock ã€ gap lock ã€‚åŒæ—¶è¿™ä¹Ÿé™ä½äº†å¹¶å‘åº¦ã€‚<br><br>2ã€ next-key lock éœ€è¦æ‰©å¤§åŠ é”èŒƒå›´ï¼ŒåŠ é”èŒƒå›´çš„ä¾æ®å°±æ˜¯è¦èƒ½ä¿è¯ä¸¤æ¬¡å½“å‰è¯»ç»“æœä¸€è‡´ï¼ˆrr è¯­ä¹‰ å¯é‡å¤è¯»ï¼‰ã€‚<br><br>3ã€æ¡ˆä¾‹ç†è§£<br>      c åˆ—éå”¯ä¸€ç´¢å¼•next key locké”ï¼š (-,0]ï¼ˆ0ï¼Œ5]ï¼ˆ5ï¼Œ10]ï¼ˆ10ï¼Œ15]ï¼ˆ15ï¼Œ20]ï¼ˆ20ï¼Œ25],(25,+]<br>      id åˆ—å”¯ä¸€ç´¢å¼•next key locké”ï¼š   (-,0]ï¼ˆ0ï¼Œ5]ï¼ˆ5ï¼Œ10]ï¼ˆ10ï¼Œ15]ï¼ˆ15ï¼Œ20]ï¼ˆ20ï¼Œ25],(25,+]<br><br>     æ¡ˆä¾‹1<br>    update t set d=d+1 where id =7<br>      id ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ–°å¢ idä¸º7çš„è®°å½• ï¼Œæ–°çš„ç´¢å¼•ä¸€å®šåœ¨ï¼ˆ5ï¼Œ10] è¿™ä¸ªèŒƒå›´å†…ï¼Œè‚¯å®šåˆä¸ä¼šç”¨åˆ°id=10 è¿™æ¡è®°å½•ï¼ˆä¼˜åŒ–ï¼‰ã€‚æ‰€ä»¥<br>          é”çš„èŒƒå›´ä¸ºï¼ˆ5ï¼Œ10ï¼‰<br><br>     æ¡ˆä¾‹2<br>      select id from t where c=5 lock in share mode<br>       c ä¸ºéå”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”c=5 åˆåœ¨next lock é”çš„è¾¹ç•Œä¸Šé¢  ï¼Œå¦‚æœæ–°å¢è®°å½• c=5 ,(id,c,d) (4,5,5)ï¼Œ(5,5,5)  (7,5,5)ï¼Œ(8,5,5)ï¼Œ(9,5,5)<br>     cç´¢å¼•çš„èŒƒå›´å°±å¯èƒ½åœ¨ï¼ˆ0ï¼Œ5]ï¼ˆ5ï¼Œ10] è¿™ä¸¤ä¸ªåŒºé—´å†…ï¼ŒåŒç† c=10 è¿™æ¡è®°å½•çš„é”ï¼Œè‚¯å®šç”¨ä¸åˆ°ï¼Œå¯ä»¥ä¼˜åŒ–ï¼Œæ‰€ä»¥èŒƒå›´ä¸ºï¼ˆ0ï¼Œ10ï¼‰<br>    <br>    æ¡ˆä¾‹3<br>            select *from t where id &gt;=10 ,and id&lt;11 for update<br>       id ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œid &gt;=10 ç´¢å¼•èŒƒå›´ä¸º ï¼ˆ5ï¼Œ10]ï¼ˆ10ï¼Œ15]ï¼ˆ15ï¼Œ20]ï¼ˆ20ï¼Œ25],(25,+],<br>                          id &lt;11 ç´¢å¼•èŒƒå›´ä¸º    ï¼ˆ5ï¼Œ10]ï¼ˆ10ï¼Œ15]<br>      ä¼˜åŒ– ï¼ˆ5ï¼Œ10] ä¸­åªèƒ½ç”¨åˆ°id=10 çš„ç´¢å¼•ï¼Œæ‰€ä»¥èŒƒå›´ä¸º [10,15]<br>      <br>     æ¡ˆä¾‹4<br>         select * from t where c&gt;=10 and c&lt;11 for update<br>         c ä¸ºéå”¯ä¸€ç´¢å¼•ï¼Œè§æ¡ˆä¾‹2ï¼Œ3ï¼Œå¯ä»¥åˆ¤æ–­èŒƒå›´ä¸º (5,15]<br><br>     æ¡ˆä¾‹5 bug<br>          çŒœæƒ³æ˜¯ä¸æ˜¯å› ä¸ºæŸ¥è¯¢çš„ç´¢å¼•åœ¨åŠ é”çš„åŒºé—´çš„ä¸´ç•Œç‚¹ä¸Šé—¨ï¼Œæ‰€ä»¥æ‰©å¤§äº†åŠ é”çš„èŒƒå›´ã€‚","like_count":1},{"had_liked":false,"id":94417,"user_name":"æœ¨å­","can_delete":false,"product_type":"c1","uid":1390997,"ip_address":"","ucode":"66B9C493F25B11","user_header":"https://static001.geekbang.org/account/avatar/00/15/39/95/a72ef023.jpg","comment_is_top":false,"comment_ctime":1557805214,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5852772510","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œå›å¤´çœ‹ç¬¬äºŒéçš„æ—¶å€™ï¼Œçªç„¶å‘ç°ä¸€ä¸ªåœ°æ–¹æ²¡æ˜ç™½ï¼šåœ¨æ¡ˆä¾‹1ä¸­ id=7ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œidæ˜¯ä¸»é”®ï¼Œä¹Ÿæ»¡è¶³å”¯ä¸€ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰æ ¹æ®ä¼˜åŒ–1 next-key lock é€€åŒ–ä¸ºè¡Œé”è€Œæ˜¯åŠ äº†ï¼ˆ5,10ï¼‰çš„é—´éš™é”ï¼Ÿè€Œæ¡ˆä¾‹ä¸‰ä¸­ ä¸»é”®ç´¢å¼•èŒƒå›´é”æ¡ˆä¾‹ä¸­ ç¬¬ä¸€æ­¥ æ‰¾åˆ°id=10çš„è®°å½• è¿™æ—¶å€™æ˜¯æ ¹æ®ä¼˜åŒ–2 ä¸»é”®ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ é€€åŒ–ä¸ºè¡Œé”ï¼ŸåŒæ ·æ˜¯ä¸»é”®ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ä¸ºä»€ä¹ˆä¸€ä¸ªåŠ äº†é—´éš™é”ä¸€ä¸ªé€€åŒ–æˆäº†è¡Œé”ï¼Ÿéº»çƒ¦è€å¸ˆçœ‹åˆ°ä¹‹åå›å¤ä¸€ä¸‹ï¼Œéå¸¸æ„Ÿè°¢","like_count":1,"discussions":[{"author":{"id":1107305,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e5/69/719ec5d0.jpg","nickname":"Jian","note":"","ucode":"17ED4919F22DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341730,"discussion_content":"id=7è¿™æ¡è®°å½•éƒ½ä¸å­˜åœ¨ï¼ŒåŠ ä¸äº†è¡Œé”å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610506515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85682,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1555174713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5850142009","product_id":100020801,"comment_content":"@å è½å¤©ä½¿ çš„é—®é¢˜ï¼Œæ¡ˆä¾‹å…­çš„ session A ä¸å˜ï¼Œsession B insert (c=5, id=50) çš„è®°å½•è¢« blockï¼Œå¯ä»¥å€Ÿç”¨â€œçº¿æ®µâ€çš„æ¦‚å¿µæ¥å¸®åŠ©ç†è§£ï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå·±çš„ç†è§£ï¼š<br>session A æˆ‘ä»¬åªå…³æ³¨ a (c=5, id=5) å’Œ b (c=10, id=10) è¿™ä¸¤ä¸ªç‚¹ (ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œå…¶ä»–çš„é”æˆ‘ä»¬é€‰æ‹©å¿½ç•¥)ã€‚<br>åœ¨å¹³é¢ä¸Šï¼Œa å’Œ bä¸¤ç‚¹è¿æˆçš„çº¿æ®µï¼Œå°±æ˜¯æˆ‘ä»¬çš„åŠ é”èŒƒå›´ã€‚<br>ç°åœ¨æœ‰ä¸€ä¸ªç‚¹ f(c=5, id=6) éœ€è¦æ’å…¥çº¿æ®µä¸­ï¼Œå› ä¸º a å’Œ f çš„ c å€¼éƒ½æ˜¯ 5ï¼Œä½†æ˜¯ f çš„ id æ¯” a çš„ id è¦å¤§ï¼Œæ‰€ä»¥åœ¨çº¿æ®µä¸Šè¡¨ç¤ºï¼Œf åœ¨ a çš„å³è¾¹ï¼Œè½å…¥äº†çº¿æ®µå†…ï¼Œå³è½å…¥äº†é”åŒºé—´ï¼Œæ‰€ä»¥è¢« block äº†ã€‚<br>æœ‰ä¸€ä¸ªç‚¹ e(c=5, id=4) éœ€è¦åœ¨å¹³é¢å±•ç¤ºï¼ŒåŒç† e ç‚¹æ˜¯åœ¨ a ç‚¹çš„å·¦è¾¹ï¼Œæ²¡è½åˆ°é”åŒºé—´ï¼Œæ‰€ä»¥ insert æˆåŠŸã€‚","like_count":1},{"had_liked":false,"id":79071,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1553343158,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5848310454","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ é€€æ¢æˆ è¡Œé”ï¼Œæ¡ˆä¾‹ä¸€çš„ç­‰å€¼æŸ¥è¯¢ä¸ºå•¥æ˜¯é—´éš™é”ï¼Ÿï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164188,"discussion_content":"å› ä¸ºId=7ä¸å­˜åœ¨ï¼ŒåŠ è¡Œé”åŠ åœ¨å“ªé‡Œå‘¢ã€‚æ‰€ä»¥ï¼Œæ ¹æ®ä¼˜åŒ–2ï¼Œid=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œæ•…é€€åŒ–æˆé—´éš™é”ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581161887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74352,"user_name":"å…«æ€ª","can_delete":false,"product_type":"c1","uid":1328234,"ip_address":"","ucode":"A9200AC057BDAD","user_header":"https://static001.geekbang.org/account/avatar/00/14/44/6a/49f026af.jpg","comment_is_top":false,"comment_ctime":1552200848,"is_pvip":false,"replies":[{"id":"27193","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1552228829,"ip_address":"","comment_id":74352,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5847168144","product_id":100020801,"comment_content":"ä¸å¥‡è€å¸ˆ è¯¾åé—®é¢˜æˆ‘ç®€å•åšäº†ä¸€ä¸‹debug è°ƒç”¨çš„æ˜¯descæ¥å£ åå‘æ‰«æçš„#70x00000000017bebc3 in QUICK_SELECT_DESC::get_next (this=0x7ffe7402d340) at &#47;root&#47;mysqlall&#47;percona-server-locks-detail-5.7.22&#47;sql&#47;opt_range.cc:11579<br>#8  0x00000000014e28dd in rr_quick (info=0x7ffe7403ae40) at &#47;root&#47;mysqlall&#47;percona-server-locks-detail-5.7.22&#47;sql&#47;records.cc:399<br>åé¢çœ‹ä½ ç­”æ¡ˆæœç„¶æ˜¯ è¿˜å¾—ä»”ç»†çœ‹çœ‹ ğŸ˜„","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442544,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552228829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68332,"user_name":"å¸½å­æ‰äº†","can_delete":false,"product_type":"c1","uid":1174781,"ip_address":"","ucode":"344892D6136346","user_header":"https://static001.geekbang.org/account/avatar/00/11/ec/fd/bad2abf5.jpg","comment_is_top":false,"comment_ctime":1550484756,"is_pvip":false,"replies":[{"id":"25096","content":"ä¸ä¼šï¼Œ<br>ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å…ˆå†™å…¥æˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªç­‰å¾…çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551081107,"ip_address":"","comment_id":68332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845452052","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªå…³äº insert into ... on duplicate updateçš„è¯­å¥çš„ç–‘é—®<br>è¿™æ¡è¯­å¥æŒ‰æˆ‘çš„ç†è§£ åº”è¯¥æ˜¯ ä¸€ä¸ªcompare and writeè¯­å¥ï¼Œé‚£ä¹ˆå®ƒæ˜¯éš”ç¦»çš„ä¹ˆï¼Ÿ<br>æ¯”å¦‚ ä¸¤æ¡è¯­å¥<br>1: Insert into t1 ï¼ˆidï¼Œ nameï¼‰values ï¼ˆ1ï¼Œ â€œ1â€ï¼‰ on duplicate xxxxx<br>2. Insert into t1 ï¼ˆidï¼Œ nameï¼‰values ï¼ˆ1ï¼Œ â€œ2â€ï¼‰on duplicate xxxxx<br>æ•°æ®åº“é‡Œé¢éƒ½æ²¡æœ‰idä¸º1çš„è¿™ä¸ªä¸»é”®ã€‚ <br>é‚£ä¹ˆåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œä¼šä¸ä¼šå‘ç”Ÿè¯­å¥1åˆ›å»ºidä¸º1çš„çºªå½•æˆåŠŸï¼Œè¯­å¥2ä¹Ÿåˆ›å»ºidä¸º1çš„çºªå½•ï¼Œåªæ˜¯å› ä¸ºä¸»é”®å†²çªï¼Œå¯¼è‡´æ’å…¥å¤±è´¥ã€‚<br>åŒæ–¹éƒ½å¤„äºcompareé˜¶æ®µï¼Œåˆ¤æ–­æ²¡æœ‰è®°å½•ï¼Œç„¶åæ’å…¥è®°å½•","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439630,"discussion_content":"ä¸ä¼šï¼Œ\nä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å…ˆå†™å…¥æˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªç­‰å¾…çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551081107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67636,"user_name":"daka","can_delete":false,"product_type":"c1","uid":1307998,"ip_address":"","ucode":"A23D82FF956793","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8ibLXicovSNwEJhP4BOIPxEMle1ZUq1He58xztgBXTQFicdp5m5ibRHwUSoUVk5xQMWFwFXhp56ibm1Q/132","comment_is_top":false,"comment_ctime":1550214503,"is_pvip":false,"replies":[{"id":"24004","content":"å¤šè°¢é¼“åŠ±ğŸ¤","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550298746,"ip_address":"","comment_id":67636,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845181799","product_id":100020801,"comment_content":"æ–‡ç« çœ‹åˆ°ä¸€åŠï¼ŒèŒ…å¡é¡¿å¼€, æ”¶è·é¢‡ä¸°ï¼Œè¿«ä¸åŠå¾…ç•™è¨€è¡¨è¾¾å¯¹å¦‚æ­¤æœ‰æ€åº¦ä½œè€…çš„è°¢æ„,å°Šæ•¬ä¸å–œçˆ±ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439293,"discussion_content":"å¤šè°¢é¼“åŠ±ğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550298746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63014,"user_name":"happyæ¶›","can_delete":false,"product_type":"c1","uid":1387892,"ip_address":"","ucode":"9D67FA68C40904","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaxhA2xdIRKUeRaiaMAVxrGJcImhY0qWoDJbLLW3l8uCvXicrHJ4GaRBkZBz4RAdaSh0YsIOJFyrhQ/132","comment_is_top":false,"comment_ctime":1548227985,"is_pvip":false,"replies":[{"id":"22266","content":"å•Š å·²ç»æ˜¯æˆ‘ç®€åŒ–è¿‡çš„è§„åˆ™äº†ã€‚ã€‚éœ€è¦å†ç†è§£ä¸€ä¸‹ã€‚ã€‚<br>ä½ ç”¨session Aã€sessionBè¿™ç§æ¨¡å¼åˆ—ä¸€ä¸‹å¤ç°æ­¥éª¤ï¼Œå“ªä¸ªä¸æ¸…æ¥šçš„ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹å§","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548239046,"ip_address":"","comment_id":63014,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5843195281","product_id":100020801,"comment_content":"è€å¸ˆï¼š<br>ç¯å¢ƒåŒä¸Š.  QQ466096028<br>æ¡ˆäºŒï¼šæ¡ˆä¸‰ä¹Ÿä¸å¯¹ã€‚<br>æ¡ˆä¾‹äº”ï¼šbäº‹ç‰©ä¹Ÿå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œ 16ï¼Œ16ï¼Œ16æˆ‘ä¹Ÿå¯ä»¥å†™å…¥ ï¼Œidï¼ˆ10,15ï¼‰ä¸å¯ä»¥ã€‚<br>æ¡ˆä¾‹å…­ï¼šæˆ‘æ²¡æœ‰æ·»åŠ C10,ID30çš„æ•°ã€‚è¿˜æ˜¯ç”¨0ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼Œ25è¿™å‡ æ¡æ•°æ®ï¼Œ æ¡ˆä¾‹å…­ä¸­çš„ä»£ç æ‰§è¡Œç»“æœæ˜¯IDï¼ˆ10ï¼Œ15ï¼‰ï¼Œc(5,15) .. <br>å¤´å¥½ç–¼ï¼Œæ„Ÿè§‰ç†ä¸æ¸…ï¼Œè§„åˆ™å¤ªä¹±äº†ã€‚<br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437438,"discussion_content":"å•Š å·²ç»æ˜¯æˆ‘ç®€åŒ–è¿‡çš„è§„åˆ™äº†ã€‚ã€‚éœ€è¦å†ç†è§£ä¸€ä¸‹ã€‚ã€‚\nä½ ç”¨session Aã€sessionBè¿™ç§æ¨¡å¼åˆ—ä¸€ä¸‹å¤ç°æ­¥éª¤ï¼Œå“ªä¸ªä¸æ¸…æ¥šçš„ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548239046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62998,"user_name":"happyæ¶›","can_delete":false,"product_type":"c1","uid":1387892,"ip_address":"","ucode":"9D67FA68C40904","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaxhA2xdIRKUeRaiaMAVxrGJcImhY0qWoDJbLLW3l8uCvXicrHJ4GaRBkZBz4RAdaSh0YsIOJFyrhQ/132","comment_is_top":false,"comment_ctime":1548223722,"is_pvip":false,"replies":[{"id":"22267","content":" select id from t where c=6 for update;<br>è¿™ä¸ªåœ¨cä¸Šçš„é”æ˜¯ï¼ˆ5ï¼Œ10ï¼‰è¿™ä¸ªé—´éš™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548239071,"ip_address":"","comment_id":62998,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5843191018","product_id":100020801,"comment_content":"è€å¸ˆï¼šåŒä¸Šä¸€ä¸ªé—®é¢˜ã€‚ è¿˜æ˜¯æ¡ˆä¾‹2.  select id from t where c=6 for update;<br>IDä¸º[0,9)éƒ½ä¸å¯ä»¥æ·»åŠ ï¼ŒåŒ…æ‹¬-1éƒ½å¯ä»¥ã€‚ä¸ºå•¥ä¼šé”è¿™ä¹ˆå¤šã€‚è€Œcé”çš„æ˜¯[5,10),å¤§äºç­‰äº5ï¼Œå°äº10<br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437432,"discussion_content":" select id from t where c=6 for update;\nè¿™ä¸ªåœ¨cä¸Šçš„é”æ˜¯ï¼ˆ5ï¼Œ10ï¼‰è¿™ä¸ªé—´éš™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548239071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005415,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/67/01d1580f.jpg","nickname":"xinnong","note":"","ucode":"3C1F1EB93FBA5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271431,"discussion_content":"ä»æˆ‘çš„å®éªŒç»“æœçœ‹æ€ä¹ˆ5è¿™è¾¹æ˜¯é—­åŒºé—´å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590137600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2147487,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c4/9f/f459ad8d.jpg","nickname":"é‡‘é±¼","note":"","ucode":"559A688572E470","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1005415,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/67/01d1580f.jpg","nickname":"xinnong","note":"","ucode":"3C1F1EB93FBA5B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573152,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ è€Œä¸”æ˜¯ï¼»5ï¼Œ10ï¼½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653222148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":271431,"ip_address":""},"score":573152,"extra":""}]}]},{"had_liked":false,"id":61169,"user_name":"J!","can_delete":false,"product_type":"c1","uid":1305003,"ip_address":"","ucode":"71C946119B59D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg","comment_is_top":false,"comment_ctime":1547630771,"is_pvip":false,"replies":[{"id":"21781","content":"éƒ½ä¸åŠ é”ã€‚ã€‚<br><br>å¦‚æœä½ è¯´çš„æ˜¯åé¢åŠ  for update, åŠ ç´¢èŒƒå›´ä¸€æ ·çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547635494,"ip_address":"","comment_id":61169,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842598067","product_id":100020801,"comment_content":"  select max(id)   from tb1  å’Œ select id from  tb1 order by id desc limit 1; id ä¸ºä¸»é”®ï¼Œè¿™ä¸ªä¸¤ä¸ªçš„åŠ ç´¢è¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·çš„å—","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436771,"discussion_content":"éƒ½ä¸åŠ é”ã€‚ã€‚\n\nå¦‚æœä½ è¯´çš„æ˜¯åé¢åŠ  for update, åŠ ç´¢èŒƒå›´ä¸€æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547635494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57143,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1546658922,"is_pvip":false,"replies":[{"id":"20637","content":"æˆ‘è§‰å¾—å¯èƒ½ä¸€æ–¹é¢æ˜¯å¾ˆå¤šäººå¹¶ä¸çŸ¥é“è¿™ä¸ªå‚æ•°ğŸ˜„<br><br>ä¸è¿‡å¹»è¯»å¦‚æœç¡®è®¤ä¸éœ€è¦ï¼Œä¸€èˆ¬è¡¨ç¤ºå¯é‡å¤è¯»ä¹Ÿä¸éœ€è¦ï¼Œä¸å¦‚ç›´æ¥æ”¹RC+rowæ ¼å¼çš„binlogğŸ˜„<br><br>æˆ‘è¿˜æ²¡æœ‰ç¢°åˆ°è¿‡ä½ è¯´çš„è¿™ç§éœ€æ±‚åœºæ™¯","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546693746,"ip_address":"","comment_id":57143,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841626218","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼š<br>åœ¨è¯»æäº¤æ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬åœºæ™¯æ˜¯æ²¡æœ‰é—´éš™é”çš„ï¼Œå› æ­¤å°†binlogè®¾ç½®ä¸ºrowæ ¼å¼ï¼Œå¯ä»¥è§£å†³binlogæ—¥å¿—é¡ºåºå’Œè¯­å¥å®é™…æ‰§è¡Œé¡ºåºä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆå¹»è¯»é‚£ä¸€ç¯‡æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºrowæ ¼å¼æ˜¯ç›´æ¥è®°å½•æ•°æ®çš„ç»“æœæ”¹å˜ï¼‰<br>é‚£ä¹ˆï¼Œå¦‚æœä½¿ç”¨RRæ¨¡å¼ï¼ŒæŠŠé—´éš™é”å…³é—­ï¼Œå°†binlogè®¾ç½®ä¸ºrowæ ¼å¼ã€‚è¿™æ ·æ—¢å¯ä»¥å®ç°é‡å¤è¯»ï¼Œåˆå¯ä»¥å‡å°é”çš„ç²’åº¦ã€‚è™½ç„¶è¿™æ ·çš„è¯ï¼Œå¹»è¯»çš„æƒ…å†µæ— æ³•è§£å†³ï¼Œä½†æ˜¯å¹»è¯»ä¸€èˆ¬æ¥è¯´å½±å“å¹¶ä¸å¤§ã€‚<br>ç»¼ä¸Šï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰äººåœ¨RRæ¨¡å¼ä¸‹ï¼Œå…³é—­é—´éš™é”ï¼Œå¼€å¯rowæ ¼å¼çš„binlogå‘¢ï¼Ÿï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435427,"discussion_content":"æˆ‘è§‰å¾—å¯èƒ½ä¸€æ–¹é¢æ˜¯å¾ˆå¤šäººå¹¶ä¸çŸ¥é“è¿™ä¸ªå‚æ•°ğŸ˜„\n\nä¸è¿‡å¹»è¯»å¦‚æœç¡®è®¤ä¸éœ€è¦ï¼Œä¸€èˆ¬è¡¨ç¤ºå¯é‡å¤è¯»ä¹Ÿä¸éœ€è¦ï¼Œä¸å¦‚ç›´æ¥æ”¹RC+rowæ ¼å¼çš„binlogğŸ˜„\n\næˆ‘è¿˜æ²¡æœ‰ç¢°åˆ°è¿‡ä½ è¯´çš„è¿™ç§éœ€æ±‚åœºæ™¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546693746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56993,"user_name":"lone","can_delete":false,"product_type":"c1","uid":1311609,"ip_address":"","ucode":"68986F17574B77","user_header":"https://static001.geekbang.org/account/avatar/00/14/03/79/830c68f2.jpg","comment_is_top":false,"comment_ctime":1546595025,"is_pvip":false,"replies":[{"id":"20566","content":"é”è¡Œ&#47;é—´éš™å‘€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546609079,"ip_address":"","comment_id":56993,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5841562321","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œä¸å¤ªç†è§£åœ¨å®é™…å¼€å‘ä¸­SELECT FOR UPDATE å’ŒLOCK IN SHARE MODE å®é™…åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆå®é™…é—®é¢˜ï¼Ÿè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435349,"discussion_content":"é”è¡Œ/é—´éš™å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546609079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545172,"discussion_content":"æƒ³è¦å½“å‰è¯»ï¼Œä¸æƒ³è¦å¿«ç…§è¯»æ—¶å¯ä»¥è¿™æ ·ç”¨ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641870265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56743,"user_name":"Smile","can_delete":false,"product_type":"c1","uid":1021017,"ip_address":"","ucode":"2002460CB3D869","user_header":"https://static001.geekbang.org/account/avatar/00/0f/94/59/ac2aa72b.jpg","comment_is_top":false,"comment_ctime":1546533394,"is_pvip":true,"replies":[{"id":"20462","content":"ä½ çš„<br><br>ç¬¬äºŒç‚¹æˆ‘æ²¡ç†è§£â€¦ <br>å¦‚æœæ˜¯æ²¡æœ‰15è¿™ä¸€è¡Œè‚¯å®šä¸ç®—bug,å› ä¸ºè¦æ‰«åˆ°è¿™ä¸€ä¸ªé—´éš™<br><br>ä¸è¿‡æ²¡å…³ç³» ä¸»è¦æ˜¯ç†è§£å°±è¡ŒğŸ˜„ç°åœ¨å°±æ˜¯è¿™ä¹ˆå®ç°çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546561548,"ip_address":"","comment_id":56743,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841500690","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå…³äºbugæ¡ˆä¾‹çš„é—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ–¹é¢è¯·æ•™ä¸€ä¸‹<br>1. å…³äºbugæ¡ˆä¾‹ç¬¬ä¸€éƒ¨åˆ†é”çš„èŒƒå›´æ˜¯(10,15] , æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œid&gt;10 è¿™ä¸ªé”çš„èŒƒå›´æ˜¯(10, 15] , è€Œid&lt;=15 æœ¬æ¥æ˜¯(10, 15] ç”±äº=15ç¬¦åˆä¼˜åŒ–1 æ‰€ä»¥é€€åŒ–ä¸ºè¡Œé” 15ï¼Œ æœ€ç»ˆç»¼åˆèµ·æ¥çœ‹å°±æ˜¯ (10,15]<br><br>2. ç¬¬äºŒéƒ¨åˆ†çš„(15,20] æˆ‘ä¸ªäººè§‰çš„æ˜¯ä¸æ˜¯ä¸èƒ½ç®—bugï¼Œå‡è®¾æ•°æ®æ˜¯ 0ã€ 5 ã€10ã€ 14ã€ 20 ï¼Œ å°±åº”è¯¥æ˜¯é”åˆ°20ï¼Œåªæ˜¯åˆšå¥½è¿™é‡Œæ˜¯æœ‰15ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ°å¥½çš„ç‰¹åˆ—ï¼‰ï¼Œå¦‚æœä¸ºäº†è¿™ä¸ªç‰¹ä¾‹å†å»å†™if elseåˆ¤æ–­æ˜¯å¦å’Œç­‰å€¼æ¡ä»¶ç›¸ç­‰ ï¼Œç»“åˆç°å®å·¥ä½œä¸­ï¼Œæ¡ä»¶åˆšå¥½ç›¸ç­‰æ¦‚ç‡ï¼Œæ”¶ç›Šæ˜¯ä¸æ˜¯ä¸ä¼šå¾ˆæ˜æ˜¾ï¼Ÿï¼ˆå¦‚æœæœ‰äº›å­—æ®µæ˜¯é•¿å­—ç¬¦ä¸²æ¯”è¾ƒä¹ŸæŒºåºŸæ—¶é—´çš„å§ï¼‰ --ä¸ªäººç†è§£ï¼Œæœ›è€å¸ˆæŒ‡æ­£ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435206,"discussion_content":"ä½ çš„\n\nç¬¬äºŒç‚¹æˆ‘æ²¡ç†è§£â€¦ \nå¦‚æœæ˜¯æ²¡æœ‰15è¿™ä¸€è¡Œè‚¯å®šä¸ç®—bug,å› ä¸ºè¦æ‰«åˆ°è¿™ä¸€ä¸ªé—´éš™\n\nä¸è¿‡æ²¡å…³ç³» ä¸»è¦æ˜¯ç†è§£å°±è¡ŒğŸ˜„ç°åœ¨å°±æ˜¯è¿™ä¹ˆå®ç°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546561548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56725,"user_name":"å¼ æ°¸å¿—","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1546528962,"is_pvip":false,"replies":[{"id":"20444","content":"æ’¤é”€MDL é”ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546532825,"ip_address":"","comment_id":56725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841496258","product_id":100020801,"comment_content":"è€å¸ˆåŠŸåº•æ·±åšå•Šï¼<br>å¾ˆå°‘èƒ½çœ‹åˆ°è¿™ä¹ˆç»†è‡´çš„åˆ†æï¼Œå®åœ¨æ˜¯ä½©æœï¼<br>å¦å¤–ï¼Œè¯·æ•™ä¸€ä¸ªä¹‹å‰è¯¾ç¨‹ä¸­çš„é—®é¢˜ï¼Œmysqldumpåœ¨ä»åº“è¿›è¡Œä¸€è‡´æ€§å¤‡ä»½çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¿å­˜ç‚¹ï¼Œä½ æåˆ°è¿‡è¿™ä¸ªå¾ˆå…³é”®ï¼Œæˆ‘çœ‹äº†ä¸€è‡´æ€§å¤‡ä»½çš„è¿‡ç¨‹ï¼Œå¯¹è¿™ä¸ªä¸€ç›´æ²¡æƒ³æ˜ç™½ã€‚é€šå¸¸savepoint æ˜¯ä¸ºäº†æ§åˆ¶å›æ»šçš„èŒƒå›´ï¼Œæ“ä½œå‡ºé”™åå¯ä»¥å›æ»šæ“ä½œï¼Œè€Œä¸è‡³äºå›æ»šæ‰€æœ‰æ“ä½œã€‚<br>ä¿å­˜ç‚¹å‡ºç°åœ¨è¿™é‡Œæ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ<br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435197,"discussion_content":"æ’¤é”€MDL é”ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546532825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56552,"user_name":"å¤¹å¿ƒé¢åŒ…","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":false,"comment_ctime":1546486836,"is_pvip":false,"replies":[{"id":"20390","content":"ä¸æ˜¯ï¼Œ<br>Order by dçš„è¯ï¼Œè¦æ’åºï¼Œæ‰€ä»¥æ˜¯æŒ‰ç…§â€ç´¢å¼•cé€’å¢é¡ºåºâ€æ‰«æç´¢å¼•çš„<br><br>å› æ­¤åŠ é”æ•ˆæœå’Œorder by c ASCæ˜¯ä¸€æ ·çš„<br><br>ä½ æäº†ä¸ªå¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546489217,"ip_address":"","comment_id":56552,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841454132","product_id":100020801,"comment_content":"è€å¸ˆæœ€åç•™çš„è¯¾é¢˜åº”è¯¥æ˜¯ä¸order by c desc æœ‰å…³,æˆ‘å°è¯•ç”¨order by d desc ä»£æ›¿,æ˜¯å¯ä»¥è¿›è¡Œinsertçš„ã€‚explainå‡ºç°æ–‡ä»¶æ’åº.æˆ‘çš„æ¨æµ‹æ˜¯å…ˆè¿›è¡Œçš„æ’åº,è¿™æ ·å°±é”å®šäº†å…¨è¡Œ,æ˜¯æ— æ³•insertçš„.","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435113,"discussion_content":"ä¸æ˜¯ï¼Œ\nOrder by dçš„è¯ï¼Œè¦æ’åºï¼Œæ‰€ä»¥æ˜¯æŒ‰ç…§â€ç´¢å¼•cé€’å¢é¡ºåºâ€æ‰«æç´¢å¼•çš„\n\nå› æ­¤åŠ é”æ•ˆæœå’Œorder by c ASCæ˜¯ä¸€æ ·çš„\n\nä½ æäº†ä¸ªå¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546489217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56443,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1546444896,"is_pvip":false,"replies":[{"id":"20341","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546447898,"ip_address":"","comment_id":56443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841412192","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæƒ³è¯·é—®ä¸€ä¸‹ï¼Œæ¡ˆä¾‹4ä¸­çš„session Aå¦‚æœæŠŠc&lt;11æ”¹æˆc&lt;=15ï¼Œæ˜¯ä¸æ˜¯è¿˜ä¼šå†åŠ ä¸Šä¸€ä¸ª(15,20]çš„next keyé”ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435038,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546447898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56408,"user_name":"rains","can_delete":false,"product_type":"c1","uid":1276520,"ip_address":"","ucode":"540BB449B0D52F","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/68/d6b53fbb.jpg","comment_is_top":false,"comment_ctime":1546439438,"is_pvip":false,"replies":[{"id":"20328","content":"é”è¦åˆ†å—æ”¾ï¼Œè¿™æ ·è¡¨ç¤ºè¿™äº›é”æ€»å…±æ”¾åœ¨11ä¸ªå—ä¸­ï¼Œå…¶ä¸­10ä¸ªç”¨æ»¡äº†ï¼Œæ¯ä¸ªå—æœ‰ä¸€ä¸ªsuprenum,å› æ­¤ç®—èµ·æ¥å¤šäº†ä¸€ä¸ª","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546442520,"ip_address":"","comment_id":56408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841406734","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œåˆšåˆšçš„é—®é¢˜ï¼Œå†æ¬¡éªŒè¯äº†ä¸‹ï¼Œçš„ç¡®é”ä½äº†å…¨éƒ¨çš„è¡Œï¼Œä½†æ˜¯å‡ºç°ä¸€ä¸ªæ–°çš„ç–‘æƒ‘ï¼ŒåŸè¡¨ä¸­ä¸€å…±æœ‰1604è¡Œæ•°æ®ï¼Œç”¨éç´¢å¼•åˆ—ä½œä¸ºç­‰å€¼æ¡ä»¶è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œé€šè¿‡INNODB_TRXæŸ¥çœ‹ï¼Œtrx_rows_lockedå€¼ä¸º1614ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435024,"discussion_content":"é”è¦åˆ†å—æ”¾ï¼Œè¿™æ ·è¡¨ç¤ºè¿™äº›é”æ€»å…±æ”¾åœ¨11ä¸ªå—ä¸­ï¼Œå…¶ä¸­10ä¸ªç”¨æ»¡äº†ï¼Œæ¯ä¸ªå—æœ‰ä¸€ä¸ªsuprenum,å› æ­¤ç®—èµ·æ¥å¤šäº†ä¸€ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546442520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55934,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1546349648,"is_pvip":false,"replies":[{"id":"20138","content":"Explainç»“æœå‘ä¸€ä¸‹ï¼Œè¿˜æœ‰show variables ç»“æœä¹Ÿå‘ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546361315,"ip_address":"","comment_id":55934,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841316944","product_id":100020801,"comment_content":"session A<br>mysql&gt; select * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share mode;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 20 |   20 |   20 |<br>| 15 |   15 |   15 |<br>+----+------+------+<br>2 rows in set (0.00 sec)<br><br>session b<br>mysql&gt; insert into t values(6,6,6);<br>Query OK, 1 row affected (0.00 sec)<br>å¯ä»¥æ’å…¥æˆåŠŸï¼Œæ²¡æœ‰è¢«é”ä½","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434891,"discussion_content":"Explainç»“æœå‘ä¸€ä¸‹ï¼Œè¿˜æœ‰show variables ç»“æœä¹Ÿå‘ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55929,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1546349246,"is_pvip":false,"replies":[{"id":"20137","content":"Né—´éš™é”ä¹‹é—´æ˜¯ä¸äº’ç›¸é”çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546361238,"ip_address":"","comment_id":55929,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5841316542","product_id":100020801,"comment_content":"ä¸ç®¡æ˜¯é—´éš™é”è¿˜æ˜¯è¡Œé”ï¼Œéƒ½å·²ç»è¢«Aå ä½ï¼Œæ€ä¹ˆBè¿˜èƒ½é—´éš™é”åŠ é”æˆåŠŸï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434887,"discussion_content":"Né—´éš™é”ä¹‹é—´æ˜¯ä¸äº’ç›¸é”çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164202,"discussion_content":"æ‰€ä»¥sessionBçš„é˜»å¡æ˜¯ç”±è¡Œé”å¼•å‘çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581162579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545221,"discussion_content":"ä½†æ˜¯sessionAæ˜¯lock in share modeå…±äº«é”ï¼Œè¡Œé”åº”è¯¥å¯ä»¥åŠ ä¸Šçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641879255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":164202,"ip_address":""},"score":545221,"extra":""}]}]},{"had_liked":false,"id":55869,"user_name":"å°æå­","can_delete":false,"product_type":"c1","uid":1196293,"ip_address":"","ucode":"C5593E33CA6F4C","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/05/5ba603f2.jpg","comment_is_top":false,"comment_ctime":1546334915,"is_pvip":false,"replies":[{"id":"20120","content":"1. æƒ³åŠ ï¼Œä½†æ˜¯æŒ‰é¡ºåºæ˜¯å…ˆï¼Œ(5,10), ç„¶åc=10,ç„¶å(10,15)ï¼Œä½†æ˜¯åœ¨c=10è¢«å µä½äº†ï¼Œ(10,15ï¼‰åŠ ä¸ä¸Š<br><br>2. ä½ æŠŠnext-key lockå½“ä½œé—´éš™é”åŠ è¡Œé”æ¥çœ‹ã€‚ é—´éš™é”ç›´æ¥ä¸æŠ¤é”ï¼›è€Œé—´éš™é”åªä¿æŠ¤é—´éš™ï¼Œä¸è®©insert <br>è¿™ä¸¤ä¸ªéƒ½æ˜¯å¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546341216,"ip_address":"","comment_id":55869,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841302211","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹å…«ä¸­æœ‰ä¸¤ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼š1ã€session Bçš„updateè¯­å¥ï¼Œä¸åŠ (10,15)é—´éš™é”å—ï¼Ÿ 2ã€æŒ‰ç…§æ‚¨å¯¹æ¡ˆä¾‹å…«çš„åˆ†æï¼Œå¦‚æœ session B åªæ˜¯åŠ  (5,10) é—´éš™é”ï¼Œæ˜¯ä¸ä¼šä¸session A çš„ (5,10] next-key lock å†²çªï¼Œè€Œæ˜¯å¯ä»¥åŠ é”æˆåŠŸï¼Œç®€è¨€ä¹‹ï¼Œå¯¹äºåŒä¸€ä¸ªåŒºé—´è€Œè¨€ï¼Œé—´éš™é”å’Œ next-key lockå¹¶ä¸å†²çªï¼Œæ˜¯å¦æ˜¯è¿™æ ·ç†è§£çš„ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434868,"discussion_content":"1. æƒ³åŠ ï¼Œä½†æ˜¯æŒ‰é¡ºåºæ˜¯å…ˆï¼Œ(5,10), ç„¶åc=10,ç„¶å(10,15)ï¼Œä½†æ˜¯åœ¨c=10è¢«å µä½äº†ï¼Œ(10,15ï¼‰åŠ ä¸ä¸Š\n\n2. ä½ æŠŠnext-key lockå½“ä½œé—´éš™é”åŠ è¡Œé”æ¥çœ‹ã€‚ é—´éš™é”ç›´æ¥ä¸æŠ¤é”ï¼›è€Œé—´éš™é”åªä¿æŠ¤é—´éš™ï¼Œä¸è®©insert \nè¿™ä¸¤ä¸ªéƒ½æ˜¯å¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546341216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55851,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1546328029,"is_pvip":false,"replies":[{"id":"20114","content":"å—¯å—¯ï¼Œä½ è¯´çš„å¯¹ï¼Œå¦‚æœé‚£ä¸ªè¯­å¥ï¼Œæ˜¯select *ï¼Œå¤§æ¦‚ç‡ä¼šèµ°å…¨è¡¨æ‰«æï¼Œé‚£å°±ä¼šé”ä½ä¸»é”®ç´¢å¼•ã€‚<br>ä½ å¯ä»¥ç”¨explain çœ‹çœ‹ã€‚<br><br><br>è¿™ä¸ªé—®é¢˜é‡Œä½ è¿™ä¸ªéªŒè¯æ–¹æ³•ä¹Ÿå¾ˆå‡†ç¡®ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546334349,"ip_address":"","comment_id":55851,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841295325","product_id":100020801,"comment_content":"è¯„è®ºä¸æ”¯æŒè¿½åŠ ã€‚ã€‚ã€‚åˆšè€å¸ˆå›ç­”æˆ‘çš„ç¬¬3ä¸ªé—®é¢˜ï¼šâ€œé”ä½äº†ç´¢å¼•cä¸Šæ‰€æœ‰next key lock â€ï¼Œæ˜¯ä¸æ˜¯å£è¯¯äº†ï¼Œé”ä½çš„æ˜¯ä¸»é”®ç´¢å¼•å§ï¼Ÿå› ä¸ºsession Bæ‰§è¡Œï¼šselect id from t where c = 0 lock in share mode;æ˜¯ä¸ä¼šè¢«é˜»å¡çš„ã€‚","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434860,"discussion_content":"å—¯å—¯ï¼Œä½ è¯´çš„å¯¹ï¼Œå¦‚æœé‚£ä¸ªè¯­å¥ï¼Œæ˜¯select *ï¼Œå¤§æ¦‚ç‡ä¼šèµ°å…¨è¡¨æ‰«æï¼Œé‚£å°±ä¼šé”ä½ä¸»é”®ç´¢å¼•ã€‚\nä½ å¯ä»¥ç”¨explain çœ‹çœ‹ã€‚\n\n\nè¿™ä¸ªé—®é¢˜é‡Œä½ è¿™ä¸ªéªŒè¯æ–¹æ³•ä¹Ÿå¾ˆå‡†ç¡®ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546334349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55811,"user_name":"é¸ ç¿±","can_delete":false,"product_type":"c1","uid":1116568,"ip_address":"","ucode":"7D498AF2BC4289","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/98/b11c372b.jpg","comment_is_top":false,"comment_ctime":1546314186,"is_pvip":false,"replies":[{"id":"20111","content":"é™¤äº†ç¬¬ä¸€ä¸ªï¼Œåé¢éƒ½æ˜¯æŒ‰ç…§èŒƒå›´æŸ¥è¯¢æ¥<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546323239,"ip_address":"","comment_id":55811,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5841281482","product_id":100020801,"comment_content":"åœ¨æ¡ˆä¾‹ä¸‰ä¸­ where id &gt;= 10 and id &lt; 11è¿™é‡Œæåˆ°äº†å¯ä»¥ä½¿ç”¨ä¼˜åŒ–1ï¼Œé€€åŒ–ä¸ºid=10çš„è¡Œé”ï¼Œå³&gt;=ä¹Ÿå¯è®¤ä¸ºåŒ…å«äº†ç­‰å€¼æŸ¥è¯¢<br>é‚£ä¹ˆåœ¨æ¡ˆä¾‹äº”ä¸­ï¼Œwhere id &gt; 10 and id &lt;=15ï¼Œæ ¹æ®ä¼˜åŒ–2ï¼Œ(15,20]è¿™ä¸ªé”ï¼Œä¸åº”è¯¥ä¼šé€€åŒ–ä¸º(15,20)è¿™ä¸ªé—´éš™é”å˜›ï¼Ÿéš¾é“&lt;=ä¸åŒ…å«ç­‰å€¼æŸ¥è¯¢å—ï¼Ÿ<br>å¸Œæœ›è€å¸ˆèƒ½å¤Ÿè§£æƒ‘ä¸€ä¸‹","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434847,"discussion_content":"é™¤äº†ç¬¬ä¸€ä¸ªï¼Œåé¢éƒ½æ˜¯æŒ‰ç…§èŒƒå›´æŸ¥è¯¢æ¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546323239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545177,"discussion_content":"å› ä¸ºå®ƒæ˜¯ä»å·¦åˆ°å³æ‰«æç´¢å¼•çš„ï¼Œ å¦‚æœæ˜¯order by id descé‚£ï¼œ=15ï¼Œ 15ä¹Ÿä¼šå½“ç­‰å€¼æŸ¥è¯¢åˆ¤æ–­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641870900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55735,"user_name":"å°˜å°","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1546273302,"is_pvip":false,"replies":[{"id":"20093","content":"è°¢è°¢é¼“åŠ±å“¦<br>æ–°å¹´å¿«ä¹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546275064,"ip_address":"","comment_id":55735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841240598","product_id":100020801,"comment_content":"è¿™ä¹ˆå¥½çš„ä¸“æ ï¼Œè¦å¤šæ¨å¹¿ï¼Œè®©å¤§å®¶éƒ½å­¦ä¹ å­¦ä¹ ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434835,"discussion_content":"è°¢è°¢é¼“åŠ±å“¦\næ–°å¹´å¿«ä¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546275064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356154,"user_name":"éª‘å¢™å¤´åƒç“œå” å—‘","can_delete":false,"product_type":"c1","uid":3040193,"ip_address":"ä¸Šæµ·","ucode":"A4B9CF783F08E9","user_header":"https://static001.geekbang.org/account/avatar/00/2e/63/c1/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1662015853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662015853","product_id":100020801,"comment_content":"ä¹‹å‰é”ä¸€è‡´æ²¡ææ‡‚ï¼Œå¬äº†è€å¸ˆçš„è¯¾ï¼Œä»Šå¤©ç»ˆäºæ˜ç™½äº†ã€‚","like_count":0},{"had_liked":false,"id":354630,"user_name":"å‹‡æ•¢çš„å¿ƒ","can_delete":false,"product_type":"c1","uid":3139195,"ip_address":"å±±ä¸œ","ucode":"4922FEDA30DD50","user_header":"https://static001.geekbang.org/account/avatar/00/2f/e6/7b/5b6f741b.jpg","comment_is_top":false,"comment_ctime":1660629763,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660629763","product_id":100020801,"comment_content":"æµ‹è¯•ç¯å¢ƒ5.7.37ï¼Œæ¡ˆä¾‹äºŒä¸­ï¼šupdate t set d=d+1 where id=5;ä¼šè¢«é˜»å¡å•Šï¼è¿™æ¡åº”è¯¥é”™äº†å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":354089,"user_name":"Geek_d5f06b","can_delete":false,"product_type":"c1","uid":1948495,"ip_address":"å¹¿ä¸œ","ucode":"6DAAA73E552FEC","user_header":"","comment_is_top":false,"comment_ctime":1660093327,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1660093327","product_id":100020801,"comment_content":"åŠ é”è§„åˆ™çš„ä¼˜åŒ–ä¸€ä¸­ï¼Œå”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•éƒ½æ˜¯æ»¡è¶³çš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584137,"discussion_content":"æ˜¯çš„ï¼Œä¸»é”®ä¹Ÿæ˜¯å”¯ä¸€ç´¢å¼•ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660639718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352632,"user_name":"Geek_8f0976","can_delete":false,"product_type":"c1","uid":2647903,"ip_address":"","ucode":"BAA8385F28FF71","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Xp7erNvMXhKnYNsD9icNN0ibzGkgJibeUn5YrtIL1S2IgvoD8gbMpLVpQvwpVFJ8gWfibXr800xnllibbXxLhTeLhBw/132","comment_is_top":false,"comment_ctime":1658822221,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1658822221","product_id":100020801,"comment_content":"é—´éš™é”åªä¼šå¯¹insertè¯­å¥ç”Ÿæ•ˆï¼Œæˆ‘ç†è§£çš„æ²¡é—®é¢˜å§","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584138,"discussion_content":"é—´éš™é”ä¹Ÿä¼šåœ¨æ‰€æœ‰å½“å‰è¯»çš„è¯­å¥ç”Ÿæ•ˆå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660639791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350162,"user_name":"å¹³å‡¡ä¹‹è·¯","can_delete":false,"product_type":"c1","uid":1669273,"ip_address":"","ucode":"96CE12339BD5FD","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/99/6060eb2d.jpg","comment_is_top":false,"comment_ctime":1656634163,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1656634163","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæœ‰ä¸€ç‚¹æˆ‘è¿˜æ˜¯ä¸æ‡‚ï¼Œå¦‚æœä¸€åˆ—æ˜¯æ•´æ•°ç±»å‹ï¼ŒåŠ é”å‰å¼€åé—­ï¼Œæˆ‘è¿˜èƒ½ç†è§£ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²å‘¢ï¼Œå°±æœ‰ç‚¹ä¸èƒ½ç†è§£å‰å¼€åé—­äº†","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584139,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯è·Ÿå­—æ®µç±»å‹ä¹ˆæœ‰å…³ç³»å§ï¼Œé—´éš™é—´éš™ä¸åº”è¯¥æ˜¯è¡Œï¼ˆè®°å½•ï¼‰ä¸è¡Œï¼ˆè®°å½•ï¼‰ä¹‹é—´çš„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660639840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347193,"user_name":"ch_test","can_delete":false,"product_type":"c1","uid":1284088,"ip_address":"","ucode":"0BD681C1D39B39","user_header":"https://static001.geekbang.org/account/avatar/00/13/97/f8/b6fb9567.jpg","comment_is_top":false,"comment_ctime":1653808933,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1653808933","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹å¯é‡å¤è¯»å’Œè¯»å·²æäº¤çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯ä»¥ä»€ä¹ˆæ€è·¯å»è€ƒè™‘çš„","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584141,"discussion_content":"è¯´è¯´æˆ‘çš„ç†è§£ï¼Œä¾›å‚è€ƒï¼å¯é‡å¤è¯»å’Œå·²æäº¤è¯»ä¸¤è€…çš„åŒºåˆ«æ˜¯æäº¤è¯»ä¼šæœ‰å¹»è¯»å‘ç”Ÿï¼Œè€Œå¯é‡å¤è¯»å¯é€šè¿‡é—´éš™é”(gap lock)è§£å†³å¹»è¯»é—®é¢˜ï¼Œä½†æ˜¯å¸¦æ¥çš„æ˜¯æ›´å¤šçš„é”å†²çªï¼Œå¦‚æœè¯´ä¸šåŠ¡ç±»å‹å…è®¸åŒä¸€ä¸ªäº‹åŠ¡åœ¨å‰åæŸ¥è¯¢çš„è®°å½•å¤šè®°å½•æˆ–å°‘è®°å½•ï¼ˆå³å¹»è¯»ï¼‰æˆ‘è§‰å¾—å¯ä»¥RC+ROW binlogæ¨¡å¼ï¼Œä»¥æé«˜æ›´å¤§çš„ç³»ç»Ÿå¹¶å‘å’Œååé‡ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660640256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346541,"user_name":"é‡‘é±¼","can_delete":false,"product_type":"c1","uid":2147487,"ip_address":"","ucode":"559A688572E470","user_header":"https://static001.geekbang.org/account/avatar/00/20/c4/9f/f459ad8d.jpg","comment_is_top":false,"comment_ctime":1653221644,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653221644","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘éƒ½éå”¯ä¸€ç´¢å¼• for updateä¸å­˜åœ¨çš„å€¼ï¼ŒåŠ é”èŒƒå›´æ˜¯å·¦é—­å³é—­å‘€ï¼Ÿ","like_count":0},{"had_liked":false,"id":345872,"user_name":"ã€å…­æœˆï½","can_delete":false,"product_type":"c1","uid":2377928,"ip_address":"","ucode":"E8203B03E1E0A8","user_header":"https://static001.geekbang.org/account/avatar/00/24/48/c8/78d68000.jpg","comment_is_top":false,"comment_ctime":1652669562,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1652669562","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆï¼ŒåŸåˆ™2é‡Œé¢ è®¿é—®åˆ°çš„å¯¹è±¡æ˜¯æŒ‡æœ€ç»ˆæŸ¥çš„å¶å­èŠ‚ç‚¹ï¼Œè¿˜æ˜¯åŒ…å«æŸ¥æ‰¾è¿‡ç¨‹ä¸­çš„å­èŠ‚ç‚¹","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584146,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ï¼šè€å¸ˆè¯´é”æ˜¯åœ¨ç´¢å¼•ä¸Šç”Ÿæ•ˆï¼ä¹Ÿå°±æ˜¯è¯´å¶å­èŠ‚ç‚¹ä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660642465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344226,"user_name":"Geek_4e4ec2","can_delete":false,"product_type":"c1","uid":1603078,"ip_address":"","ucode":"6DAD5EE4FFB195","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zAZv4NyuS21Y1qk45j8JiaoEYdA5Zgc1PqpJsBokz5bZVmdkf6kNWvT4cUAAKAdH6TgN52DWZhiaH6wNFhw14nRg/132","comment_is_top":false,"comment_ctime":1651379452,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1651379452","product_id":100020801,"comment_content":"è¿˜æ˜¯ä¸å¤ªç†è§£æ¡ˆä¾‹5ä¸­ï¼Œä¸ºä»€ä¹ˆåŠ é”ä¸åŒ…æ‹¬10ï¼Œæˆ‘ç†è§£çš„æ˜¯ &gt;10 ä¹Ÿæ˜¯è¦å…ˆæ‰¾åˆ°10è¿™ä¸ªèŠ‚ç‚¹ç„¶åå‘å³éå†åˆ¤æ–­çš„ï¼Œæ‰€ä»¥10åº”è¯¥ä¹Ÿæ˜¯ä¼šè¢«è®¿é—®åˆ°ï¼Œä¸å¤ªç†è§£ &gt;10 è¿™ä¸ªæŸ¥æ‰¾åœ¨ç´¢å¼•æ ‘ä¸Šæ˜¯æ€æ ·ä¸€ä¸ªè¿‡ç¨‹","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584148,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯next-key lockæ˜¯å·¦å¼€æœ‰é—­ï¼Œæ‰€ä»¥è¯´(10,X)æ‰€ä»¥10æ²¡æœ‰è¢«é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660642897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343975,"user_name":"heartzwj410","can_delete":false,"product_type":"c1","uid":1049761,"ip_address":"","ucode":"9C3E9F393F7C09","user_header":"https://static001.geekbang.org/account/avatar/00/10/04/a1/c853ee82.jpg","comment_is_top":false,"comment_ctime":1651151234,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651151234","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘çš„mysqlç‰ˆæœ¬æ˜¯8.0.20ï¼Œæˆ‘è¯•äº†éå”¯ä¸€ç´¢å¼•ç­‰å€¼åŠ é”çš„ä¾‹å­ï¼Œsession1:begin; update t set  d = 3 where c = 20; å‘ç°åœ¨session2æ˜¯ä¸å¯ä»¥æ’å…¥cä¸º15çš„å€¼ï¼ŒæŒ‰ç…§æ–‡ä¸­ç»™çš„è§£é‡Šåº”è¯¥æ˜¯é—´éš™é”(15,20](20,25),15åº”è¯¥æ˜¯å¯ä»¥æ’å…¥æ‰å¯¹ï¼Œæ˜¯å› ä¸ºç‰ˆæœ¬å‡çº§äº†å—","like_count":0},{"had_liked":false,"id":343739,"user_name":"Barbed","can_delete":false,"product_type":"c1","uid":1632860,"ip_address":"","ucode":"EB4B00CD169D9F","user_header":"https://static001.geekbang.org/account/avatar/00/18/ea/5c/cee03aad.jpg","comment_is_top":false,"comment_ctime":1651031027,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1651031027","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ã€‚å°±æ˜¯å¦‚æœè¯´ä¸€å¼ è¡¨é‡Œé¢æˆ‘è¦ä¿®æ”¹ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®ã€‚æŸ¥è¯¢æ¡ä»¶æ˜¯d,æ²¡æœ‰ç´¢å¼•ã€‚è¿™ä¸ªæ—¶å€™ã€‚é”çš„æ˜¯èŒƒå›´å†…çš„æ•°æ®è¿˜æ˜¯è¯´é”çš„æ•´å¼ è¡¨å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584149,"discussion_content":"å› ä¸ºwhereæ¡ä»¶æ˜¯då­—æ®µï¼Œè€Œdå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥åªèƒ½æŒ‰ä¸»é”®è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ•´å¼ è¡¨çš„è¡Œè®°å½•éƒ½è¢«é”ä½ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660642993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343046,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1650609071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650609071","product_id":100020801,"comment_content":"MySQL8å·²ç»æŠŠæ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é” bugçš„é—®é¢˜ä¿®äº†","like_count":0},{"had_liked":false,"id":341924,"user_name":"1","can_delete":false,"product_type":"c1","uid":1514027,"ip_address":"","ucode":"A8AF2E0B7ED275","user_header":"https://static001.geekbang.org/account/avatar/00/17/1a/2b/1e23112d.jpg","comment_is_top":false,"comment_ctime":1649919158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649919158","product_id":100020801,"comment_content":"ç–‘é—®1ï¼Œåœ¨æ¡ˆä¾‹1ä¸­ï¼ŒSession C å°† where id=10ï¼Œæ”¹æˆ where id=7ä¹Ÿä¸blockedï¼Œä¸å¤ªç†è§£ï¼Ÿ<br>ç–‘é—®2ï¼Œåœ¨çœ‹å‰é¢çš„æ–‡ç« æ—¶ï¼Œåˆ°è¯´é—´éš™é”åªæœ‰åœ¨æ’å…¥çš„æ—¶å€™æ‰ä¼šå†²çª","like_count":0},{"had_liked":false,"id":340478,"user_name":"cp","can_delete":false,"product_type":"c1","uid":2634906,"ip_address":"","ucode":"10DCEB5F041CB6","user_header":"https://static001.geekbang.org/account/avatar/00/28/34/9a/2fe8ec6f.jpg","comment_is_top":false,"comment_ctime":1648855948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648855948","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœupdateè¯­å¥çš„æ¡ä»¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä¼šæ€æ ·åŠ é”ï¼Ÿ","like_count":0},{"had_liked":false,"id":340293,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1648723396,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648723396","product_id":100020801,"comment_content":"å¤ªä¹±äº†","like_count":0},{"had_liked":false,"id":336163,"user_name":"ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":2853618,"ip_address":"","ucode":"A52A6043D27D87","user_header":"https://static001.geekbang.org/account/avatar/00/2b/8a/f2/6c6f7886.jpg","comment_is_top":false,"comment_ctime":1645963026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645963026","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ—¢ç„¶ RRï¼ˆé—´éš™é”ï¼‰å·²ç»è§£å†³äº†å¹»è¯»é—®é¢˜ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šä½¿ç”¨ serializable å‘¢ï¼Ÿç»å¸¸ä¼šçœ‹åˆ°åˆ«äººè¯´ RRåªèƒ½è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä¸èƒ½è§£å†³å¹»è¯»ï¼Œè¿™ä¸ªè¯´æ³•æ˜¯é”™çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":335572,"user_name":"é‡‡è˜‘è‡çš„é‡Œå¥¥é©¬","can_delete":false,"product_type":"c1","uid":1411848,"ip_address":"","ucode":"D898FBA62E29B5","user_header":"https://static001.geekbang.org/account/avatar/00/15/8b/08/c7ae6e70.jpg","comment_is_top":false,"comment_ctime":1645591926,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645591926","product_id":100020801,"comment_content":"é—®é¢˜ï¼š<br><br>MySQLç‰ˆæœ¬ï¼š8.0.26<br>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREPEATABLE-READ<br><br>æ¡ˆä¾‹ä¸‰çš„Session 3æ˜¯ä¸ä¼šé˜»å¡çš„ã€‚","like_count":0},{"had_liked":false,"id":334790,"user_name":"bamboo","can_delete":false,"product_type":"c1","uid":1105034,"ip_address":"","ucode":"55286877F22AD3","user_header":"https://static001.geekbang.org/account/avatar/00/10/dc/8a/651ca538.jpg","comment_is_top":false,"comment_ctime":1645111183,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1645111183","product_id":100020801,"comment_content":"1ã€è¯´æ˜ï¼š<br>\t1)ã€\tæ•°æ®åº“ç‰ˆæœ¬ 5.7.36(ä½¿ç”¨ docker å®‰è£…äº† 5.7.30-5.7.36 ç‰ˆæœ¬è¯•äº†è¯•éƒ½å‡ºç°ç›¸åŒçš„é—®é¢˜ã€‚8.0.26 æ²¡é—®é¢˜)<br>\t2)ã€æ•°æ®åº“éš”ç¦»çº§åˆ« RR<br>2ã€æ•°æ®åº“ç›¸å…³è¯­å¥ï¼š<br>\tCREATE TABLE `t` ( `id` int(11) NOT NULL,`c` int(11) DEFAULT NULL,`d` int(11) DEFAULT NULL,PRIMARY KEY (`id`),<br>\t  KEY `c` (`c`)) ENGINE=InnoDB;<br>\tinsert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);<br>3ã€ç°è±¡<br>\täº‹åŠ¡1ï¼š<br>\tbegin;<br>\tselect * from t where c &gt;= 10 and c &lt; 21 for update;<br><br>\täº‹åŠ¡2ï¼š<br>\tmysql&gt; update t set d =d + 1 where id = 5;<br><br>\tæ›´æ–°è¢« block,æŸ¥çœ‹é”çŠ¶æ€çš„è¾“å‡ºï¼š<br>\tRECORD LOCKS space id 47 page no 3 n bits 80 index PRIMARY of table `eshop`.`t` trx id 2577 lock_mode X locks rec but not gap waiting Record lock, heap no 3 PHYSICAL RECORD: n_fields 5; compact format; info bits 0<br>\t\t 0: len 4; hex 80000005; asc     ;;<br>\t\t 1: len 6; hex 000000000a07; asc       ;;<br>\t\t 2: len 7; hex a70000011b011c; asc        ;;<br>\t\t 3: len 4; hex 80000005; asc     ;;<br>\t\t 4: len 4; hex 80000005; asc     ;;<br><br>\tmysql&gt; insert into t values (1,1,1);<br><br>\tæ’å…¥è¢« block,æŸ¥çœ‹é”çŠ¶æ€çš„è¾“å‡ºï¼š\t<br>\tRECORD LOCKS space id 47 page no 3 n bits 80 index PRIMARY of table `eshop`.`t` trx id 2577 lock_mode X locks gap before rec insert intention waiting Record lock, heap no 3 PHYSICAL RECORD: n_fields 5; compact format; info bits 0<br>\t\t 0: len 4; hex 80000005; asc     ;;<br>\t\t 1: len 6; hex 000000000a07; asc       ;;<br>\t\t 2: len 7; hex a70000011b011c; asc        ;;<br>\t\t 3: len 4; hex 80000005; asc     ;;<br>\t\t 4: len 4; hex 80000005; asc     ;;<br><br>\tmysql&gt; insert into t values (26,100,24);<br>\tERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction\t<br>\tæŸ¥çœ‹é”çŠ¶æ€çš„è¾“å‡ºï¼š\t<br>\tRECORD LOCKS space id 47 page no 3 n bits 80 index PRIMARY of table `eshop`.`t` trx id 2624 lock_mode X insert intention waiting Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0<br>\t\t 0: len 8; hex 73757072656d756d; asc supremum;;<br>\tå¯ä»¥çœ‹åˆ°æ›´æ–° id = 5 çš„è®°å½•(å› ä¸ºè¡Œé”)ï¼Œå’Œæ’å…¥ c = 1(gap é”) çš„è®°å½•éƒ½é˜»å¡äº†ã€‚æ²¡æœ‰çœ‹æ˜ç™½ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ (0,5) çš„ gap é”å‘¢?è¿˜æœ‰ä¸ºä»€ä¹ˆä¼šæœ‰ supremum çš„ next-key lock å‘¢?å®åœ¨æ˜¯æä¸æ‡‚äº†?éªŒè¯äº†å¾ˆå¤šæ•°æ®ï¼Œæ„Ÿè§‰å°±æ˜¯æŠŠç´¢å¼• c ä»0 åˆ° supermum éƒ½é”ä½äº†","like_count":0,"discussions":[{"author":{"id":1105034,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dc/8a/651ca538.jpg","nickname":"bamboo","note":"","ucode":"55286877F22AD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554171,"discussion_content":"æœ€åæŸ¥çœ‹äº† æ‰§è¡Œè®¡åˆ’ çœ‹å‡ºæ¥äº†ç‚¹ç«¯å€ª ğŸ˜€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646234388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334378,"user_name":"æ½œé¾™åœ¨å¤©","can_delete":false,"product_type":"c1","uid":1072380,"ip_address":"","ucode":"C7D845DBA3F7D8","user_header":"https://static001.geekbang.org/account/avatar/00/10/5c/fc/5833e4c8.jpg","comment_is_top":false,"comment_ctime":1644908184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644908184","product_id":100020801,"comment_content":"å¯ä»¥ç›´æ¥çœ‹é”çš„å…·ä½“æƒ…å†µäº†<br><br>performance_schema.data_locks<br>performance_schema.data_lock_waits<br><br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;mysql-perfschema-excerpt&#47;8.0&#47;en&#47;performance-schema-data-locks-table.html","like_count":0},{"had_liked":false,"id":333295,"user_name":"Geek_e8d4e4","can_delete":false,"product_type":"c1","uid":2710347,"ip_address":"","ucode":"4C8F9A5B211666","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/bibk95dCnUbkwKYcFTSfOS2VebPneQI0wl2nUk1JuOX6iaphf4ibjzk25noXHhyZ7TlPGA0mYVL0EIxak54aaqxcA/132","comment_is_top":false,"comment_ctime":1644255664,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644255664","product_id":100020801,"comment_content":"å‰ä¸¤è®²çš„ç­”ç–‘æ–‡ç« çœŸçš„ç²¾é«“ï¼Œç¬¬ä¸€éå¬åˆ°è¿™çš„æ—¶å€™æ²¡å¬æ‡‚è·³è¿‡äº†ï¼Œå¬åˆ°30è¯¾çš„æ—¶å€™å›æ¥å¬ï¼Œå‘ç°è¿™é‡Œæ‰æ˜¯é‡ä¸­ä¹‹é‡...æ‰“ç®—æŠŠæœ€è¿‘åé›†é‡è¿‡ä¸€é","like_count":0},{"had_liked":false,"id":333068,"user_name":"å°å¦–","can_delete":false,"product_type":"c1","uid":1730626,"ip_address":"","ucode":"49C01DBFADF101","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJvm1JYIDcS74s4cEYxA1PXMqjortVXEjUKyGQcPvibNJ4EAuksIa6uoHgr6G1yRqAM2KtP3yicKgTA/132","comment_is_top":false,"comment_ctime":1644044366,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644044366","product_id":100020801,"comment_content":"é‡Œè¾¹çš„æŸäº›è§£é‡Šæœ‰äº›å¼ºæ‹—ç»“æœäº†ï¼ŒèŒƒå›´æŸ¥è¯¢å’Œç­‰å€¼å‚»å‚»çš„åˆ†ä¸æ¸…ï¼Œä¾‹å­3å’Œä¾‹å­4ä¸­ï¼ŒåŒæ ·éƒ½æ˜¯&gt;=10,ä¸ºä»€ä¹ˆ3ä¸­æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œ4ä¸­å´æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œæ±‚è§£ç­”<br>","like_count":0},{"had_liked":false,"id":332795,"user_name":"é™ˆé˜³","can_delete":false,"product_type":"c1","uid":2653715,"ip_address":"","ucode":"C8E676C967D23A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKib3vNM6TPT1umvR3TictnLurJPKuQq4iblH5upgBB3kHL9hoN3Pgh3MaR2rjz6fWgMiaDpicd8R5wsAQ/132","comment_is_top":false,"comment_ctime":1643616330,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1643616330","product_id":100020801,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œ mysql8.0 5.7ç‰ˆæœ¬ï¼Œrrçº§åˆ«ä¸‹ï¼ŒsessionCä¸­â€˜update t set d=d+1 where id=10â€™ ä¾‹å­å¯¹sessionAçš„å¿«ç…§è¯»å¯è§(sessionA æ‰§è¡Œ select * from t å idä¸º10çš„è®°å½•ï¼Œd=11)ï¼Œæ¢æˆâ€˜update t set d=d+1 where id=15â€™ å¯¹sessionAçš„å¿«ç…§è¯»ä¸å¯è§ï¼ˆ(sessionA æ‰§è¡Œ select * from t å idä¸º15çš„è®°å½•ï¼Œdè¿˜æ˜¯ç­‰äº15)ï¼‰ è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":328686,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1640841864,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640841864","product_id":100020801,"comment_content":"é—´éš™å¯ä»¥åŠ¨æ€çš„å˜å¤§ï¼Œä»¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œä½†ä¸èƒ½å˜å° ï¼Œä¸çŸ¥é“æ˜¯å¦å¯ä»¥è¿™æ ·ç†è§£","like_count":0},{"had_liked":false,"id":327462,"user_name":"ææ‰¿èŠ³","can_delete":false,"product_type":"c1","uid":2716512,"ip_address":"","ucode":"0848375E0178E9","user_header":"https://static001.geekbang.org/account/avatar/00/29/73/60/469bcdfb.jpg","comment_is_top":false,"comment_ctime":1640140222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640140222","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ä¸­(5,10]çš„é”ä¸ºä»€ä¹ˆä¸é€€åŒ–ä¸º(5,10)","like_count":0},{"had_liked":false,"id":327202,"user_name":"è‹å½§","can_delete":false,"product_type":"c1","uid":1622448,"ip_address":"","ucode":"C016B28DF7449C","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/b0/b52d9ade.jpg","comment_is_top":false,"comment_ctime":1639978659,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1639978659","product_id":100020801,"comment_content":"1ã€æŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè€ŒåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼ˆå‰å¼€åé—­ï¼‰ï¼›<br>2ã€ç­‰å€¼æŸ¥è¯¢ä¸ŠMySQLçš„ä¼˜åŒ–ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œnext-key lockä¼šé€€åŒ–ä¸ºè¡Œé”ï¼Œå¦‚æœä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œéœ€è¦è®¿é—®åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œæ­¤æ—¶next-key lockä¼šé€€åŒ–ä¸ºé—´éš™é”ï¼›<br>3ã€èŒƒå›´æŸ¥è¯¢ï¼šæ— è®ºæ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒèŒƒå›´æŸ¥è¯¢éƒ½éœ€è¦è®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ï¼›","like_count":0},{"had_liked":false,"id":327002,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1049994,"ip_address":"","ucode":"C0859057592720","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/8a/e7c5a7e2.jpg","comment_is_top":false,"comment_ctime":1639826447,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639826447","product_id":100020801,"comment_content":"ç¬¬5ä¸ªæ¡ˆä¾‹bugåœ¨mysql8.0.20é‡ç°ä¸äº†","like_count":0},{"had_liked":false,"id":326892,"user_name":"æœ¨æœ¨ç¬ƒç¬ƒ","can_delete":false,"product_type":"c1","uid":1304879,"ip_address":"","ucode":"4D21F7C93C8388","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/2f/a28bf24c.jpg","comment_is_top":false,"comment_ctime":1639734671,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639734671","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼ŒMySQLç‰ˆæœ¬æ˜¯8.0.23ï¼ŒRRçº§åˆ«ï¼Œæ²¿ç”¨æœ¬è¯¾é‡Œçš„è¡¨tï¼Œä¸»é”®idæ˜¯0,5,10,15,20,25ï¼Œæƒ³è¯·é—®ä¸ºä»€ä¹ˆæ‰§è¡Œselect * from t where id &lt;=25 for update; ä¼šæŠŠï¼ˆ25ï¼Œsupermumï¼‰é”ä¸Šnext-key lockï¼Œè€Œæ‰§è¡Œselect * from t where id &lt;=20 for update; åˆ™ä¸ä¼šé”ä¸Šï¼ˆ20,25ï¼‰ï¼Ÿ","like_count":0},{"had_liked":false,"id":325989,"user_name":"å°å¤©","can_delete":false,"product_type":"c1","uid":1731985,"ip_address":"","ucode":"D24207A1148E14","user_header":"https://static001.geekbang.org/account/avatar/00/1a/6d/91/9745cf49.jpg","comment_is_top":false,"comment_ctime":1639297046,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1639297046","product_id":100020801,"comment_content":"è€å¸ˆï¼Œé—®ä¸€ä¸‹ï¼Œåœ¨æ¡ˆä¾‹ä¸‰ä¸­ï¼Œæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆsessionCæ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¢«é˜»å¡ï¼Œç„¶åæŠŠsessionAæ”¹ä¸ºid&lt;16ï¼Œå°±ä¼šè¢«é˜»å¡äº†ï¼Œæˆ‘çš„mysqlç‰ˆæœ¬8.0.23","like_count":0,"discussions":[{"author":{"id":1411848,"avatar":"https://static001.geekbang.org/account/avatar/00/15/8b/08/c7ae6e70.jpg","nickname":"é‡‡è˜‘è‡çš„é‡Œå¥¥é©¬","note":"","ucode":"D898FBA62E29B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552764,"discussion_content":"ç›¸åŒé—®é¢˜ .","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645591995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323282,"user_name":"æµ…æ—¶å…‰@Smileã€‚","can_delete":false,"product_type":"c1","uid":2555960,"ip_address":"","ucode":"DC66AFD863C65B","user_header":"https://static001.geekbang.org/account/avatar/00/27/00/38/f07e54a0.jpg","comment_is_top":false,"comment_ctime":1637818658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637818658","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªç–‘é—®ã€‚å…³äºæ¡ˆä¾‹å…«çš„æ­»é”ï¼Œä¸ºä»€ä¹ˆæ˜¯å…ˆåŠ çš„é—´éš™é”ï¼Œå†åŠ è¡Œé”å‘¢?<br>æˆ‘å°è¯•äº†ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œå‘ç°sesionAçš„insertå¹¶æ²¡æœ‰é”ä½ï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œå®Œäº†ï¼Œä¹‹åsessionBæ”¶åˆ°æ­»é”çš„é”™è¯¯ï¼Œè¿™æ˜¯ä¸æ˜¯è¯´æ˜äº†åœ¨sessionA insertä¹‹å‰sessionBè¿˜æ²¡æŠŠé—´éš™é”åŠ ä¸Šå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":322181,"user_name":"Geek_b1c2bf","can_delete":false,"product_type":"c1","uid":1640826,"ip_address":"","ucode":"88C5A351097846","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/95xDJc3Jq6sVNEyYqFwibnrjzltzkdXd3R9gRO3ejiaNEiaZveMftMmBZDllvaUchxg7wM67qeDr1YTGo2B85yZHQ/132","comment_is_top":false,"comment_ctime":1637224936,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637224936","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¯¹äºå›¾1çš„ä¾‹å­ï¼Œè¿™æ ·æ€è€ƒå¯¹ä¸å¯¹ï¼Ÿ<br>è¿™é‡ŒSession Cå¯ä»¥æ›´æ–°ï¼Œå¹¶ä¸æ˜¯å› ä¸ºé—´éš™é”èŒƒå›´æ˜¯ï¼ˆ5ï¼Œ10ï¼‰ï¼Œè€Œæ˜¯é—´éš™é”ä¸ä¼šé”ä½ updateè¯­å¥ï¼Œè€Œæ˜¯ä¼šé”ä½insertè¯­å¥ã€‚<br>å‚è€ƒï¼šâ€œè·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚â€","like_count":0},{"had_liked":false,"id":320306,"user_name":"ä¸Šæµ·","can_delete":false,"product_type":"c1","uid":2678569,"ip_address":"","ucode":"6A4F9D80D25028","user_header":"https://static001.geekbang.org/account/avatar/00/28/df/29/3c956177.jpg","comment_is_top":false,"comment_ctime":1636212038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636212038","product_id":100020801,"comment_content":"æ¡ˆä¾‹ä¸€åœ¨8.0.27ç‰ˆæœ¬çš„next-key lockçš„èŒƒå›´æ˜¯[5,10ï¼‰","like_count":0},{"had_liked":false,"id":319703,"user_name":"æ°´æœˆ","can_delete":false,"product_type":"c1","uid":2344034,"ip_address":"","ucode":"78FC68615016DB","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/62/269aae3f.jpg","comment_is_top":false,"comment_ctime":1635916353,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635916353","product_id":100020801,"comment_content":"ç¢°åˆ°é—®é¢˜è¿˜æ˜¯å¾—å¤šè¯·mysql explainä¸€ä¸‹ï¼Œå‘ç°äº†extraé‡Œé™¤äº†Using index conditionï¼Œè¿˜å¤šäº†ä¸ªBackward index scanï¼Œé‚£åº”è¯¥å°±ç”¨ä¸ä¸Šå‘å³æ‰«æå’Œç­‰å€¼æŸ¥è¯¢ä¼˜åŒ–äº†","like_count":0},{"had_liked":false,"id":319505,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1635838379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635838379","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ<br>æœªæ¥é˜²æ­¢å¹»è¯»ï¼Œå’Œäº§ç”Ÿæ•°æ®é”™è¯¯ã€‚æ‰€ä»¥æ·»åŠ äº†è¡Œé”å’Œé—´éš™é”ã€‚","like_count":0},{"had_liked":false,"id":315772,"user_name":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1465344,"ip_address":"","ucode":"1440F96375740A","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/00/5d11e68d.jpg","comment_is_top":false,"comment_ctime":1633992921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633992921","product_id":100020801,"comment_content":"éå”¯ä¸€ç´¢å¼•ç­‰å€¼é”ï¼Œä½¿ç”¨mysql5.7.34ç‰ˆæœ¬ï¼ŒRRæ¨¡å¼ä¸‹ï¼Œsession C æ˜¯å¯ä»¥Query OKçš„ï¼Œå¹¶ä¸”æ’å…¥(7,0,7)æˆ–è€…(7,10,7)éƒ½OKï¼Œå³ä½¿session A  æ”¹ä¸ºfor  update ,RRæ¨¡å¼ä¸‹ï¼Œsession C ä¹Ÿæ˜¯å¯ä»¥Query OKçš„","like_count":0},{"had_liked":false,"id":313155,"user_name":"å’¦","can_delete":false,"product_type":"c1","uid":2283781,"ip_address":"","ucode":"2E0D5A488489A4","user_header":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","comment_is_top":false,"comment_ctime":1632298747,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632298747","product_id":100020801,"comment_content":"ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯ä½ æŠŠæ•°æ®æŒ‰ç…§ç´¢å¼•é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œç„¶åæŒ‰ç…§order byçš„é¡ºåºæ¥è¯»ï¼Œæœ‰å¯èƒ½å¼•å‘å¹¶å‘é—®é¢˜çš„è¡Œæˆ–è€…é—´éš™éƒ½ä¼šè¢«é”ä½ï¼Œé™¤äº†éƒ¨åˆ†bugï¼Œä¾‹å¦‚è€å¸ˆè¯´çš„ï¼Œè¿˜æœ‰5.7.10 ç‰ˆæœ¬çš„äºŒçº§å”¯ä¸€ç´¢å¼•ä¸‹ï¼ŒRCçº§åˆ«å‡ºç°next keyé”çš„æƒ…å†µä¹‹å¤–ï¼Œä¸Šè¿°æ€»ç»“å‡ ä¹éƒ½é€‚ç”¨","like_count":0},{"had_liked":false,"id":311442,"user_name":"è›°ä¼çš„åº¶äºº","can_delete":false,"product_type":"c1","uid":2057372,"ip_address":"","ucode":"77C70C8E54DA88","user_header":"https://static001.geekbang.org/account/avatar/00/1f/64/9c/92536f47.jpg","comment_is_top":false,"comment_ctime":1631239013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631239013","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼æœ‰ä¸¤ä¸ªé—®é¢˜ç†è§£ä¸æ˜¯å¾ˆé€å½»ï¼Œè¯·è€å¸ˆå¸®æˆ‘åˆ†æè§£ç­”ä¸€ä¸‹ï¼š<br>é—®é¢˜1ï¼šåŸåˆ™2ä¸­æåˆ°çš„å¯¹è±¡æ˜¯åªæŒ‡ åŠ é”çš„åŸºæœ¬å•ä½next-key lock å—ï¼Ÿï¼ˆåŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ï¼‰<br>é—®é¢˜2ï¼šä¼˜åŒ–2ä¸­æåˆ° å‘å³éå†æ˜¯æŒ‡å“ªä¸ªä¸œè¥¿å‘å³éå†å‘¢ï¼Ÿï¼ˆä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚ï¼‰","like_count":0},{"had_liked":false,"id":310110,"user_name":"å…¨æ‘çš„å¸Œæœ›","can_delete":false,"product_type":"c1","uid":1598050,"ip_address":"","ucode":"06A2019BAFECF0","user_header":"https://static001.geekbang.org/account/avatar/00/18/62/62/28706daf.jpg","comment_is_top":false,"comment_ctime":1630488174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630488174","product_id":100020801,"comment_content":"[root@localhost][test]&gt; show create table t1\\G<br>*************************** 1. row ***************************<br>Table: t1<br>Create Table: CREATE TABLE `t1` (<br>`id` int(11) NOT NULL,<br>`user_id` int(11) DEFAULT NULL,<br>PRIMARY KEY (`id`),<br>UNIQUE KEY `uniq_userid` (`user_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4<br>1 row in set (0.00 sec)<br><br><br><br>[root@localhost][test]&gt; select * from t1;<br>+----+---------+<br>| id | user_id |<br>+----+---------+<br>| 1 | 1 |<br>| 2 | 2 |<br>| 3 | 3 |<br>+----+---------+<br>3 rows in set (0.00 sec)<br><br><br>time1 session1 trx_id 1904: [root@localhost][test]&gt; update t1 set user_id=4 where user_id=2;<br>time2 session2 trx_id 1905: [root@localhost][test]&gt; update t1 set user_id=4 where user_id=2;<br>time3 session1 trx_id 1904: [root@localhost][test]&gt; update t1 set user_id=4 where user_id=2;<br><br><br>whereæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ›´æ–°å®ƒï¼Œç´§æ¥ç€å°±äº§ç”Ÿäº†æ­»é”ï¼Œä¸ºä»€ä¹ˆ","like_count":0},{"had_liked":false,"id":309163,"user_name":"æˆ‘çˆ±å¦®","can_delete":false,"product_type":"c1","uid":2747406,"ip_address":"","ucode":"54141A00C3C673","user_header":"https://static001.geekbang.org/account/avatar/00/29/ec/0e/d7e815f3.jpg","comment_is_top":false,"comment_ctime":1629964727,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1629964727","product_id":100020801,"comment_content":"æ­»é”æ¡ˆä¾‹ä¸­ä¸ºä»€ä¹ˆæ¢æˆinsert into t values (12,12,12);<br>å°±ä¸ä¼šæ­»é”å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545223,"discussion_content":"ç¬¬ä¸€æ­¥ï¼ŒåŠ (5ï¼Œ10)é—´éš™é”ã€‚ ç¬¬äºŒæ­¥åŠ 10è¡Œé”ã€‚ ç¬¬ä¸‰æ­¥ï¼ŒåŠ (10ï¼Œ15ï¼‰é—´éš™é”ã€‚ è€å¸ˆæ„æ€ç¬¬äºŒæ­¥å¡ä½äº†ï¼Œç¬¬ä¸€æ­¥çš„é”è¿˜æ˜¯åŠ å¥½äº†ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641879648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309104,"user_name":"Kkkoko","can_delete":false,"product_type":"c1","uid":1069583,"ip_address":"","ucode":"C36729C4659F60","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8BIG7fdqVH3xs2o7yDGpbr9FuT93FVN98CC4cYdojcJamJrPS6q8ObOFQwDgbxygiaYaWnuMk0cw/132","comment_is_top":false,"comment_ctime":1629945090,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1629945090","product_id":100020801,"comment_content":"é—®ä¸ªé—®é¢˜ï¼Œ ã€æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­ã€‘<br>c=10ï¼Œcä¸Šé¢æœ‰æ™®é€šç´¢å¼•ï¼Œ æ‰€ä»¥ä¸æ˜¯ä¼šåŠ ä¸Š   (5, 10]ï¼Œ(10ï¼Œ15)çš„é”å˜›ã€‚<br><br>ä¸ºä»€ä¹ˆsession A  insert(12, 12, 12) å¯ä»¥æˆåŠŸ","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545224,"discussion_content":"ç¬¬ä¸€æ­¥ï¼ŒåŠ (5ï¼Œ10)é—´éš™é”ã€‚ ç¬¬äºŒæ­¥åŠ 10è¡Œé”ã€‚ ç¬¬ä¸‰æ­¥ï¼ŒåŠ (10ï¼Œ15ï¼‰é—´éš™é”ã€‚ è€å¸ˆæ„æ€ç¬¬äºŒæ­¥å¡ä½äº†ï¼Œç¬¬ä¸€æ­¥çš„é”è¿˜æ˜¯åŠ å¥½äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641879710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308951,"user_name":"îŒå–å°å–éƒ¨çš„èŒ¶å¶è›‹","can_delete":false,"product_type":"c1","uid":1983770,"ip_address":"","ucode":"7399725246274B","user_header":"https://static001.geekbang.org/account/avatar/00/1e/45/1a/83ef6991.jpg","comment_is_top":false,"comment_ctime":1629869355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629869355","product_id":100020801,"comment_content":"è€å¸ˆè¯´ï¼šç¬¬ä¸€æ¬¡ç”¨c=10å®šä½è®°å½•æ—¶ï¼Œç”±äºç´¢å¼•cæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ã€‚ ä½†æ˜¯ä¼˜åŒ–2ä¸å°±æ˜¯éå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢å—ï¼ŸæŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œåº”è¯¥æ˜¯å½“c=10æ—¶ï¼Œæœ‰(5,10] next-key lockå’Œ(10,15)çš„é—´éš™é”ã€‚ è¿˜æ˜¯è¯´å› ä¸ºwhereæ¡ä»¶æ˜¯c&gt;=10ï¼Œåªä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ª=10çš„æ¡ä»¶ï¼Œä¸å†ç»§ç»­å‘åéå†ï¼Œæ‰€ä»¥ä¸ç¬¦åˆä¼˜åŒ–2çš„è§„åˆ™ï¼Ÿï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":306515,"user_name":"Null","can_delete":false,"product_type":"c1","uid":1041795,"ip_address":"","ucode":"3D0AC488DAC27B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/83/ed10136c.jpg","comment_is_top":false,"comment_ctime":1628590965,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628590965","product_id":100020801,"comment_content":"è€å¸ˆï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼ŒåŠ é”çš„åŸºæœ¬å•ä½ä¹Ÿæ˜¯ next-key lock å—ï¼Ÿå¦‚æœæ˜¯é‚£åœ¨ä»€ä¹ˆé˜¶æ®µé€€åŒ–ä¸ºè¡Œé”å•Šï¼Ÿ","like_count":0},{"had_liked":false,"id":301942,"user_name":"magic","can_delete":false,"product_type":"c1","uid":1024556,"ip_address":"","ucode":"A1BCF486381749","user_header":"","comment_is_top":false,"comment_ctime":1625990403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625990403","product_id":100020801,"comment_content":"update t set column1=x1,column2=x2 where condition1=c1 and condition2=c2,condition1å’Œcondition2éƒ½æ˜¯å•ç‹¬ç´¢å¼•ï¼ŒåŠ é”è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":301674,"user_name":"å¼ è¯š","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1625807596,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625807596","product_id":100020801,"comment_content":"mysql 8.0.21<br>æ‰§è¡Œselect * from t where c&gt;=10 and c&lt;=15 limit 2 for update.<br>è¿™ä¸ªå¯¹åŠ é”èŒƒå›´åšäº†limit ä¼˜åŒ–ï¼Œè®©åŠ é”èŒƒå›´å˜å°äº†<br>ä½†æ˜¯select * from t where c&gt;=10 and c&lt;=15 order by c desc limit2 for update<br>æ²¡æœ‰ç”¨åˆ°limit ä¼˜åŒ–","like_count":0},{"had_liked":false,"id":301670,"user_name":"å¼ è¯š","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1625806666,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625806666","product_id":100020801,"comment_content":"éšç€ç‰ˆæœ¬çš„å˜åŒ–ï¼Œå¯èƒ½æœ‰äº›åœºæ™¯ä¸‹çš„éªŒè¯ç»“æœä¼šä¸ä¸€æ ·ï¼Œä½†æ˜¯æ•´ä½“æ¥è¯´ï¼Œæ€è€ƒé—®é¢˜çš„æ–¹å‘æ˜¯å¾ˆæ­£ç¡®ï¼Œä¹Ÿå¾ˆå¥½æ‡‚å¾—ã€‚æˆ‘æ„Ÿè§‰æˆ‘å·²ç»ç ”ç©¶æ¸…æ¥šäº†","like_count":0},{"had_liked":false,"id":301428,"user_name":"Geek_141bd5","can_delete":false,"product_type":"c1","uid":2232081,"ip_address":"","ucode":"B1EEB7C4386CCD","user_header":"","comment_is_top":false,"comment_ctime":1625673010,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625673010","product_id":100020801,"comment_content":"é€šè¿‡è‡ªå·±ç†è§£è§‰å¾—åŠ é”è§„åˆ™è¿™æ ·ç†è§£ä¼¼ä¹æ›´å¥½è®°å’Œç†è§£ä¸€äº›.ä¹Ÿæ˜¯åœ¨ç”»è„‘å›¾è¿‡ç¨‹ä¸­ä¸æ–­ä¼˜åŒ–åå¾—åˆ°çš„,ä¸çŸ¥é“å¯¹ä¸å¯¹.  https:&#47;&#47;www.yuque.com&#47;docs&#47;share&#47;3b1f778d-0f24-4477-9451-38c1116dc227?# ã€Š21 ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿã€‹","like_count":0},{"had_liked":false,"id":300399,"user_name":"è‰ºç’‡","can_delete":false,"product_type":"c1","uid":2664419,"ip_address":"","ucode":"3C3BF4D4034145","user_header":"https://static001.geekbang.org/account/avatar/00/28/a7/e3/395e0b6d.jpg","comment_is_top":false,"comment_ctime":1625140817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625140817","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå…³äºåŸåˆ™äºŒï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é” ä¸æ˜¯å¾ˆæ˜ç¡®<br>æ­¤å¤„çš„å¯¹è±¡æ˜¯å¦åªå¾—æ˜¯åˆ—ï¼Œâ€è®¿é—®åˆ°â€œæ˜¯å¦æŒ‡çš„æ˜¯whereæ¡ä»¶é‡Œé¢æ¶‰åŠåˆ°ï¼Ÿ","like_count":0},{"had_liked":false,"id":298257,"user_name":"ç§¦èµ›é¾™","can_delete":false,"product_type":"c1","uid":2656049,"ip_address":"","ucode":"EADC8387FB1294","user_header":"https://static001.geekbang.org/account/avatar/00/28/87/31/35ec63d3.jpg","comment_is_top":false,"comment_ctime":1623984086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623984086","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½,ä¸Šé¢è®²åˆ°çš„éƒ½æ˜¯æ£€ç´¢æ¡ä»¶æœ‰ç´¢å¼•çš„æƒ…å†µ,å‡å¦‚<br>select * from T where d=1 for update<br>dä¸Šé¢æ²¡æœ‰ç´¢å¼•,æ˜¯ä¸æ˜¯æŒ‰ç…§ç¬¬äºŒæ¡åŸåˆ™,å› ä¸ºè¿›è¡Œäº†å…¨è¡¨æ‰«æ,æ•´ä¸ªè¡¨ç°åœ¨æœ‰çš„æ•°æ®éƒ½ä¼šè¢«é”ä½<br><br>","like_count":0},{"had_liked":false,"id":297185,"user_name":"bd7xzz","can_delete":false,"product_type":"c1","uid":1003006,"ip_address":"","ucode":"420199A024D4F5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fe/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1623370785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623370785","product_id":100020801,"comment_content":"åœ¨rcéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœç”¨insert into on duplicate updateåº”è¯¥ä¹Ÿä¼šæœ‰é—´éš™é”","like_count":0},{"had_liked":false,"id":295021,"user_name":"linora","can_delete":false,"product_type":"c1","uid":1304307,"ip_address":"","ucode":"925F06ABFD2DB5","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/f3/5de3fe4a.jpg","comment_is_top":false,"comment_ctime":1622187698,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622187698","product_id":100020801,"comment_content":"å…¨ç½‘ç›®å‰æœ¬äººçœ‹è¿‡å¯¹é”æ€»ç»“æœ€é€šé€çš„æ–‡ç« ï¼Œè¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘è„‘å­é‡Œå†’å‡ºè¿™ä¸ªè¯ï¼šæŠ€æœ¯çˆ½æ–‡<br><br>å¼€å¤´â€œè¿™æ¬¡ä¸ºäº†æ€»ç»“æˆä¸çœ‹ä»£ç çš„åŒå­¦ä¹Ÿèƒ½ç†è§£çš„è§„åˆ™ï¼Œæ˜¯æˆ‘åˆé‡æ–°åˆ·äº†ä»£ç ä¸´æ—¶æ€»ç»“å‡ºæ¥çš„â€ï¼Œäº‘æ·¡é£è½»çš„ä¸€å¥è¯ï¼Œå¯ä»¥æƒ³åƒå‡ºæ–Œæ€»ä»˜å‡ºå¤šå°‘ç²¾è¡€ï¼<br><br>æ–Œæ€»å•¥æ—¶å€™å‡ºä¹¦å•Šï¼Œå‡ºä¸€æœ¬æˆ‘ä¹°ä¸€æœ¬çš„é‚£ç§ã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":293678,"user_name":"å±®","can_delete":false,"product_type":"c1","uid":2031129,"ip_address":"","ucode":"10B69240958B6B","user_header":"https://static001.geekbang.org/account/avatar/00/1e/fe/19/21a6d3d3.jpg","comment_is_top":false,"comment_ctime":1621487598,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621487598","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå®æµ‹mysql8.0.18å·²ç»ä¿®å¤äº†æ–‡ä¸­çš„â€œä¸€ä¸ªbugâ€<br>SessionA<br>begin;ï¼ˆå·²æ‰§è¡Œï¼‰<br>select * from t where id &gt; 10 and id &lt;= 15 for update; ï¼ˆå·²æ‰§è¡Œï¼‰<br>SessionB<br>update t set d=d + 1 where id = 20;(æˆåŠŸ)<br>SessionC<br>INSERT INTO t VALUES (16,16,16);(æˆåŠŸ)","like_count":0},{"had_liked":false,"id":292794,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1620982454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620982454","product_id":100020801,"comment_content":"è¿™ç¯‡æ–‡ç« æ¨èçœ‹æ­»é”å’Œ2åŸåˆ™2ä¼˜åŒ–1bugå…¶ä»–çš„ä¾‹å­æ²¡å±Œç”¨","like_count":0},{"had_liked":false,"id":291666,"user_name":"W","can_delete":false,"product_type":"c1","uid":1565949,"ip_address":"","ucode":"C500B4113258F7","user_header":"https://static001.geekbang.org/account/avatar/00/17/e4/fd/3bf6d263.jpg","comment_is_top":false,"comment_ctime":1620404348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620404348","product_id":100020801,"comment_content":"è€å¸ˆæœ‰ä¸ªé—®é¢˜å‘è¯·æ•™<br><br>æ¡ˆä¾‹äºŒä¸­ï¼Œåˆ†æå‡ºåŠ é”èŒƒå›´æ˜¯cç´¢å¼•çš„ï¼ˆ0ï¼Œ10ï¼‰åŒºé—´ï¼Œä¸»é”®ç´¢å¼•æ²¡æœ‰åŠ é”ï¼Œæˆ‘æŠŠsession3çš„ä¾‹å­æ”¹ä¸º <br><br>insert into t values(-10,10,10) <br><br>å´è¢«é˜»å¡äº†ï¼Œæ‰§è¡Œ<br><br>insert into t values(-5,0,10)  å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä»¥ä¸ºåŒºé—´åªæ˜¯å¤šäº†10è€Œå·²ï¼Œä½†å†æ¬¡è¯•éªŒ<br><br>æ‰§è¡Œ insert into t values(3,0,10) å´è¢«é˜»å¡äº†ã€‚<br><br>mysql ç‰ˆæœ¬ 5.7.16ï¼ˆmysql  Ver 14.14 Distrib 5.7.16, for osx10.11 (x86_64) using  EditLine wrapperï¼‰<br><br><br><br><br><br>","like_count":0},{"had_liked":false,"id":290805,"user_name":"NotFoundMoneyException:Â¥0","can_delete":false,"product_type":"c1","uid":2596556,"ip_address":"","ucode":"D454002955D09C","user_header":"https://static001.geekbang.org/account/avatar/00/27/9e/cc/1d57f923.jpg","comment_is_top":false,"comment_ctime":1619761383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619761383","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä½ è¯´é—´éš™é”åªä¼šé”ä½æ’å…¥è®°å½•çš„æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆä¹Ÿé”ä½äº†æ›´æ–°è®°å½•çš„æ“ä½œï¼Œä¸æ˜ç™½äº†ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹","like_count":0},{"had_liked":false,"id":290385,"user_name":"å‘¨æ˜Ÿå¹³","can_delete":false,"product_type":"c1","uid":1494880,"ip_address":"","ucode":"1FDCB487392B03","user_header":"https://static001.geekbang.org/account/avatar/00/16/cf/60/9100ad4f.jpg","comment_is_top":false,"comment_ctime":1619522110,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619522110","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆä¸Šä¸€ç¯‡è¦é”å…¨éƒ¨ï¼Œè¿™ä¸€ç¯‡åªä¼šé”ä¸€éƒ¨åˆ†ï¼Œå¦‚æœå…¶ä»–è¡Œä¿®æ”¹çš„æ•°æ®,åŠ å…¥ï¼ˆ0,5ã€‘åŠ é”ï¼Œupdate t set d=5 where d=10ä¼šä¸ä¼šå‡ºç°å¹»è¯»","like_count":0},{"had_liked":false,"id":290153,"user_name":"ä»¤å¹´æœˆæœªæ‰è¿‡","can_delete":false,"product_type":"c1","uid":1580279,"ip_address":"","ucode":"F29C5C82E6FF76","user_header":"https://static001.geekbang.org/account/avatar/00/18/1c/f7/d47f070f.jpg","comment_is_top":false,"comment_ctime":1619406080,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619406080","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œèšåˆç´¢å¼•(a,b)ä¸ºå”¯ä¸€ç´¢å¼•çš„insertæ“ä½œï¼Œè·å–äº†å…±äº«é”å´æ²¡æœ‰blockï¼Œç»§ç»­æ‰§è¡Œåé¢çš„è¯­å¥ã€‚<br>æˆ‘çŸ¥é“è·å–å…±äº«é”å¯èƒ½æ˜¯å”¯ä¸€æ€§æ£€æµ‹å‘ç°å…¶ä»–äº‹åŠ¡åšäº†åŒä¸€å”¯ä¸€é”®è®°å½•çš„æ’å…¥æ“ä½œï¼Œå¯æ˜¯ä½†ä¸ºä»€ä¹ˆå½“å‰äº‹åŠ¡ä¼šæ²¡æœ‰é˜»å¡å‘¢ã€‚ã€‚ã€‚<br>å¦‚æœè¯´å¹¶éæ˜¯å› ä¸ºä»¥ä¸ŠåŸå› è·å¾—çš„sé”ï¼Œè€Œæ˜¯æœ¬æ¥å°±æ˜¯sé”ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æ˜¯xé”å‘¢ï¼Œå¸Œæœ›è€å¸ˆèƒ½è§£æƒ‘ï¼","like_count":0},{"had_liked":false,"id":288853,"user_name":"å®æ‚¦","can_delete":false,"product_type":"c1","uid":1901403,"ip_address":"","ucode":"68844C314FEEF8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/03/5b/3cdbc9fa.jpg","comment_is_top":false,"comment_ctime":1618732077,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618732077","product_id":100020801,"comment_content":"ååå¤å¤è¯»äº†å¾ˆå¤šéï¼Œç»ˆäºçœ‹æ‡‚äº†ï¼Œè§‰å¾—è¦æ˜¯é…åˆb+æ ‘ç´¢å¼•çš„å›¾æ¥çœ‹åŠ é”çš„è¯ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ä¸€ç‚¹ã€‚","like_count":0},{"had_liked":false,"id":288454,"user_name":"é™ˆæ–‡åº†","can_delete":false,"product_type":"c1","uid":1213442,"ip_address":"","ucode":"95F593C7B8216E","user_header":"https://static001.geekbang.org/account/avatar/00/12/84/02/e9937c31.jpg","comment_is_top":false,"comment_ctime":1618475824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618475824","product_id":100020801,"comment_content":"CREATE TABLE `foo` (<br>  `a` int(11) NOT NULL,<br>  `b` int(11) NOT NULL,<br>  PRIMARY KEY (`a`),<br>  KEY `b` (`b`)<br>) ENGINE=InnoDB;<br>Insert into foo(a,b) values(10,10);<br><br><br>session 1:<br>begin;<br>select b from foo where b=10 lock in share mode;  &#47;&#47;æŒ‰æ–‡ä¸­è§£é‡Šï¼Œè¿™é‡Œåªé”è¦†ç›–ç´¢å¼•bï¼Œä¸å¯¹ç´¢å¼•aä¸Šé”<br><br><br>session 2:<br>begin;<br>update foo set a=100 where a=10;  &#47;&#47;ç­‰å¾…<br><br>è¯·é—®ï¼Œå¦‚ä½•ç†è§£session 2çš„updateè¢«é˜»å¡å‘¢ï¼Ÿ<br>ä»¥ä¸Šæ˜¯åœ¨mysql 5.7ä¸Šã€‚<br>","like_count":0},{"had_liked":false,"id":288199,"user_name":"å¼ è¯š","can_delete":false,"product_type":"c1","uid":1115702,"ip_address":"","ucode":"F623703194769B","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","comment_is_top":false,"comment_ctime":1618362591,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1618362591","product_id":100020801,"comment_content":"ä½†æ˜¯æˆ‘çœ‹åˆ°é«˜æ€§èƒ½Mysqlä¸­å…³äºInnoDBçš„MVCCæè¿°ï¼š<br>æ˜¯é€šè¿‡åœ¨æ¯è¡Œè®°å½•åé¢ä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—æ¥å®ç°çš„ï¼Œè¿™ä¸¤ä¸ªåˆ—ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜çš„è¡Œçš„è¿‡æœŸæ—¶é—´ã€‚å½“ç„¶å­˜å‚¨çš„å¹¶ä¸æ˜¯å®é™…çš„æ—¶é—´å€¼ï¼Œè€Œæ˜¯ç³»ç»Ÿç‰ˆæœ¬å·ã€‚<br>æ²¡å¼€å§‹ä¸€ä¸ªæ–°å¾—äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±å¯¹è‡ªåŠ¨é€’å¢ã€‚äº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç³»ç»Ÿç‰ˆæœ¬å·ä¼šä½œä¸ºäº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œç”¨æ¥å’ŒæŸ¥è¯¢é“å¾·æ¯è¡Œè®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚ç„¶åæè¿°äº†RRä¸‹MVCCçš„å…·ä½“æ“ä½œã€‚<br>ä½†æ˜¯æˆ‘åœ¨8.0ç‰ˆæœ¬åçš„æ‰§è¡Œç»“æœè·Ÿä¹¦ä¸­æè¿°çš„ä¸ä¸€æ ·ã€‚<br>1ã€å¼€å§‹ä¸€ä¸ªæ–°å¾—äº‹åŠ¡ç³»ç»Ÿç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ï¼Œæˆ‘ä»¬å¦‚ä½•å¯ä»¥æ‰€è°“çš„ç³»ç»Ÿç‰ˆæœ¬å·ã€‚<br>2ã€beginï¼›æ‰§è¡Œåï¼ŒæŸ¥è¯¢select * from information_schema.innodb_trx \\Gï¼Œå¹¶æ²¡æœ‰ç»“æœã€‚å½“ç¬¬ä¸€æ¡sqlæ‰§è¡Œåå†æŸ¥è¯¢ä¼šè·å¾—ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”å‘ç°ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç°è±¡ï¼šupdateè¯­å¥çš„trx_idçš„å€¼æ¯”æ‰§è¡Œselectè¯­å¥çš„trx_idè¦å°çš„å¤šçš„å¤šã€‚<br>3ã€ç„¶åå°±æ˜¯æ‚¨è¯´çš„ï¼Œåˆ›å»ºä¸€è‡´æ€§è§†å›¾çš„æ—¶é—´ç‚¹ï¼šæ˜¯ç¬¬ä¸€æ¬¡ä¸€è‡´æ€§è¯»çš„æ—¶é—´ã€‚è¿™ä¸ªæˆ‘ä»æˆ‘å®éªŒçš„ç°è±¡ä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æˆ‘æ²¡åœ¨ä¹¦ä¸Šçœ‹åˆ°ã€‚<br>è€æ˜¯èƒ½ä¸èƒ½è¡¥å……ä¸€æ¬¡è¯¦ç»†è®²ä¸€ä¸‹MVCC.<br>","like_count":0,"discussions":[{"author":{"id":1115702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg","nickname":"å¼ è¯š","note":"","ucode":"F623703194769B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367827,"discussion_content":"è€å¸ˆç¬¬å…«è®²çš„æ—¶å€™å·²ç»è®²äº†ä»€ä¹ˆæ—¶å€™ç”Ÿæˆå¿«ç…§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618477358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286243,"user_name":"10xiaohu","can_delete":false,"product_type":"c1","uid":1589055,"ip_address":"","ucode":"CAB39DBB93E608","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKKKdCyib4iblXC6JIH7HWDfIFVweTb7SgEOuRjquic3GiaiaGInFSiaU8w2y2bjvZjgiaA3IEQuyibXTaeHQ/132","comment_is_top":false,"comment_ctime":1617205935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617205935","product_id":100020801,"comment_content":"æŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œå’±ä»¬ä¸¾å¾—ä¾‹å­æ˜¯ç´¢å¼•å’Œä¸»é”®ç´¢å¼•ï¼Œæˆ‘çš„ç–‘æƒ‘æ˜¯ï¼šæ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢ï¼Œå¦‚where d æ¡ä»¶æŸ¥è¯¢ï¼Œæ˜¯å…¨è¡¨æ‰«æï¼Œç„¶ååŠ è¡Œé”å§ã€‚å› ä¸ºæ²¡æœ‰ç´¢å¼•ï¼Œä¹Ÿæ²¡ä¸é¡ºåºæ²¡æ³•æŒ‰ç…§next-key lockåŠ é”","like_count":0},{"had_liked":false,"id":285373,"user_name":"è¶…çº§è›‹è›‹é¥­","can_delete":false,"product_type":"c1","uid":1249616,"ip_address":"","ucode":"AD2BECE789B365","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wiaQmkQdIh84RibSLrDkIA3HtibAR4IibpnP3VEmiaLzvpiaibXJQEb2LLUrCD4dM7DjvOFD65IbdZm2Mn68O71FxiaAow/132","comment_is_top":false,"comment_ctime":1616759658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616759658","product_id":100020801,"comment_content":"æ„Ÿè§‰ç­‰å€¼æŸ¥è¯¢çš„èŒƒå›´æŸ¥æ‰¾ï¼Œä»ç†è®ºä¸Šæ¥è¯´æ˜¯èƒ½åªåŠ é—´éš™é”çš„ï¼Œæ˜¯æŠ€æœ¯ä¸Šä»£ç å®ç°æ¯”è¾ƒéš¾å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":281714,"user_name":"Khirye","can_delete":false,"product_type":"c1","uid":1080985,"ip_address":"","ucode":"6C54C126FA54B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/99/c4302030.jpg","comment_is_top":false,"comment_ctime":1614855632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614855632","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œinsertè¯­å¥æ˜¯ä¸ä¼šåŠ é—´éš™é”çš„å¯¹å—ï¼Ÿ<br>æ–‡ä¸­ä¾‹å­ä¸­ï¼Œinsert into t value(2,2,2) è¿™ä¸ªè¯­å¥æ˜¯ä¸ä¼šåœ¨ï¼ˆ0ï¼Œ5ï¼‰è¿™ä¸ªåŒºé—´åŠ ä¸Šé—´éš™é”çš„å¯¹å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":281344,"user_name":"å•Šè‰¯æ¢“æ˜¯æˆ‘","can_delete":false,"product_type":"c1","uid":1655117,"ip_address":"","ucode":"E42FC1A60D331C","user_header":"https://static001.geekbang.org/account/avatar/00/19/41/4d/f6d6d13a.jpg","comment_is_top":false,"comment_ctime":1614696020,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1614696020","product_id":100020801,"comment_content":"æˆ‘æœ‰ä¸€ç‚¹ç–‘æƒ‘ï¼Œå°±æ˜¯æ¡ˆä¾‹ä¸‰å¯¹ä¸»é”®ç´¢å¼• è¿›è¡Œäº† ç¬¬ä¸€ä¸ªç­‰å€¼åˆ†æï¼Œä¹Ÿå°±æ˜¯ id=10çš„æ—¶å€™ é€€åŒ–ä¸ºè¡Œé”ï¼Œé‚£ä¹ˆåº”è¯¥æ¡ˆä¾‹å››åº”è¯¥è¿™æ ·å­åˆ†ææ‰å¯¹å•Šï¼Œä¹Ÿå°±æ˜¯c=10çš„æ—¶å€™ï¼Œå°†ï¼ˆ10ï¼Œ15] é€€åŒ–ä¸º ï¼ˆ10ï¼Œ15ï¼‰çš„ï¼Œç„¶ååœ¨åˆ†æ10&lt;c&lt;15çš„æ—¶å€™æ‹¿åˆ° next-key lock ï¼ˆ10ï¼Œ15]ï¼Œåˆèµ·æ¥å°±æ˜¯ ï¼ˆ5ï¼Œ10],(10,15] ??","like_count":0},{"had_liked":false,"id":279785,"user_name":"ä¸ºä½ æ‘˜ä¸‹æ˜Ÿæ˜ŸğŸŒŸ","can_delete":false,"product_type":"c1","uid":2441219,"ip_address":"","ucode":"D52EDF29FBC6A0","user_header":"https://static001.geekbang.org/account/avatar/00/25/40/03/e5152449.jpg","comment_is_top":false,"comment_ctime":1613962341,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613962341","product_id":100020801,"comment_content":"æä¸ªé—®é¢˜ï¼Œå¯¹æ“ä½œæ•°æ®åŠ äº†é”ï¼Œå¹¶ä½¿ç”¨äº‹åŠ¡ï¼Œå¦‚æœåœ¨ä¸­é—´å‘ç”Ÿäº†æŸä¸ªä»£ç å±‚é¢çš„æ‰§è¡Œé”™è¯¯(æ­¤æ—¶å·²å¯¹æ•°æ®åŠ äº†é”)ï¼Œè¯·é—®æ˜¯å¦è¿˜ä¼šé‡Šæ”¾é”","like_count":0},{"had_liked":false,"id":277729,"user_name":"Geek_b25035","can_delete":false,"product_type":"c1","uid":2029428,"ip_address":"","ucode":"0DF572205958E2","user_header":"","comment_is_top":false,"comment_ctime":1612530084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612530084","product_id":100020801,"comment_content":"æ¡ˆä¾‹äºŒï¼Œä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ c=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é” (5,10)ä¸­çš„æœ€åä¸€ä¸ªå€¼è¿™é‡Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå…·ä½“æŒ‡çš„å€¼æ˜¯å“ªä¸ªï¼Ÿ","like_count":0},{"had_liked":false,"id":276163,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1611818419,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611818419","product_id":100020801,"comment_content":"å¯¹äºæ¡ˆä¾‹å…«çš„æ‰§è¡Œæƒ…å†µã€‚å¦‚æœsession BåŠ é—´éš™é”(5,10)æˆåŠŸï¼Œé‚£ä¸ºä»€ä¹ˆsession Aè¿˜å¯ä»¥åœ¨èŒƒå›´ä¸­æ’å…¥æ•°æ®æˆåŠŸï¼Ÿéš¾é“æ˜¯å› ä¸ºåŒä¸€ä¸ªäº‹åŠ¡é‡Œé¢é”ä¸å—å½±å“ï¼Ÿ","like_count":0},{"had_liked":false,"id":275708,"user_name":"ç‹¼çš„è¯±æƒ‘","can_delete":false,"product_type":"c1","uid":1257043,"ip_address":"","ucode":"AE89DFC5963C42","user_header":"https://static001.geekbang.org/account/avatar/00/13/2e/53/bf62683f.jpg","comment_is_top":false,"comment_ctime":1611650383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611650383","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼šé‡åˆ°ä¸€ä¸ªæ­»é”çš„é—®é¢˜è¯·æ•™ä¸‹ï¼Œtoken_check_049 è¡¨ä¸­çš„uuidæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä½†åŒæ—¶å‘ç°é’ˆå¯¹uuidåˆå»ºäº†ä¸€ä¸ªéå”¯ä¸€ç´¢å¼•ï¼ˆå†å²é—®é¢˜ï¼‰ï¼Œé—®é¢˜:ä¸¤æ¡åŒæ ·çš„æ•°æ®å¹¶å‘æ’å…¥æ—¶é€ æˆæ­»é”ï¼Œè¿˜è¯·è€å¸ˆæˆ–å„ä½å¤§ç¥æŒ‡ç‚¹è¿·æ´¥ï¼Œä»¥ä¸‹æ˜¯æ­»é”æ—¥å¿—ï¼š<br>LATEST DETECTED DEADLOCK<br>------------------------<br>*** (2) TRANSACTION:<br>TRANSACTION 1640999824, ACTIVE 0 sec inserting, thread declared inside InnoDB 1<br>mysql tables in use 1, locked 1<br>4 lock struct(s), heap size 1136, 2 row lock(s), undo log entries 1<br>MySQL thread id 13740484, OS thread handle 140432345507584, query id 2165540477 10.13.101.158 user_info update<br>INSERT INTO token_check_049 (uuid, business_id, business_type) VALUES (&#39;4-AS20210121002000029&#39;, &#39;AS20210121002000029&#39;, 4)<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 11945 page no 24 n bits 376 index uuid of table `user_info`.`token_check_049` trx id 1640999824 lock mode S locks gap before rec<br>Record lock, heap no 205 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 14; hex 342d534830303030303032353336; asc 4-SH0000002536;;<br> 1: len 8; hex 80000000000000e7; asc;;<br>*** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 11945 page no 24 n bits 376 index uuid of table `user_info`.`token_check_049` trx id 1640999824 lock_mode X locks gap before rec insert intention waiting<br>Record lock, heap no 205 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 14; hex 342d534830303030303032353336; asc 4-SH0000002536;;<br> 1: len 8; hex 80000000000000e7; asc;;<br>*** WE ROLL BACK TRANSACTION (2)","like_count":0},{"had_liked":false,"id":275056,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1101762,"ip_address":"","ucode":"003700A99A910B","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/c2/a5b3ceaf.jpg","comment_is_top":false,"comment_ctime":1611287909,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1611287909","product_id":100020801,"comment_content":"æ—è€å¸ˆä½ å¥½,è¯·é—®ä¸‹:<br>è¡¨ç»“æ„:<br>create table t (<br>       id int(11) not null,<br>       c int(11),default null,<br>       d int(11) default null,<br>       primary key(id),<br>       key c(c)<br>)engine=InnoDB;<br><br>è¡¨ä¸­å·²å­˜åœ¨çš„æ•°æ®:<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>|  0 |    0 |    0 |<br>|  5 |    6 |    6 |<br>|  8 |    8 |    8 |<br>| 10 |   10 |   10 |<br>| 15 |   15 |   15 |<br>| 20 |   20 |   20 |<br>| 25 |   25 |   25 |<br>+----+------+------+<br><br>æˆ‘çš„æ“ä½œè¿‡ç¨‹:<br>sessionA:  begin; update t set c = c + 1 where id = 5;<br>sessionB:  select id from t where c = 5 lock in share mode;  &#47;&#47;ä¸ä¼šé˜»å¡<br>sessionC:  select id from t where c = 7 lock in share mode;  &#47;&#47;é˜»å¡<br><br>æˆ‘çš„é—®é¢˜:<br>æ ¹æ®è¿™èŠ‚è¯¾è®²çš„åŠ é”è§„åˆ™å’Œä¼˜åŒ–, sessionA  çš„é”æœ‰ id = 5 çš„è¡Œé”,ä»¥åŠç´¢å¼• c ä¸Šçš„é—´éš™é”(0,6],(6,8). sessionC åœ¨ç´¢å¼• c ä¸Šçš„é—´éš™é”æ˜¯ (6,8),  é—´éš™é”æ˜¯ä¸äº’æ–¥çš„, ä¸ºä»€ä¹ˆ sessionC  ä¼šè¢«é˜»å¡å‘¢?æˆ‘ç†è§£ä¸äº†.<br><br>å¸Œæœ›æ—è€å¸ˆæœ‰ç©ºçš„æ—¶å€™å¸®æˆ‘è§£ç­”ä¸‹,è°¢è°¢.","like_count":0,"discussions":[{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348497,"discussion_content":"session Aæ‰§è¡Œåcçš„å€¼å˜ä¸º7äº†ï¼Œsession Cåœ¨è·å–c=7çš„è¡Œé”æ—¶ç­‰å¾…","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612603987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1101762,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cf/c2/a5b3ceaf.jpg","nickname":"helloworld","note":"","ucode":"003700A99A910B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348734,"discussion_content":"è°¢è°¢ä½ ï¼Œæ˜ç™½äº†ã€‚ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612695009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348497,"ip_address":""},"score":348734,"extra":""}]},{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348498,"discussion_content":"root@localhost [test]>select * from sys.innodb_lock_waits where locked_table=&#39;`test`.`t2`&#39;\\G\n*************************** 1. row ***************************\n                wait_started: 2021-02-06 04:36:12\n                    wait_age: 00:00:02\n               wait_age_secs: 2\n                locked_table: `test`.`t2`\n                locked_index: c\n                 locked_type: RECORD\n              waiting_trx_id: 421849629305568\n         waiting_trx_started: 2021-02-06 04:36:12\n             waiting_trx_age: 00:00:02\n     waiting_trx_rows_locked: 1\n   waiting_trx_rows_modified: 0\n                 waiting_pid: 28\n               waiting_query: select id from t2 where c=7 lock in share mode\n             waiting_lock_id: 421849629305568:69:4:3\n           waiting_lock_mode: S\n             blocking_trx_id: 3022234\n                blocking_pid: 27\n              blocking_query: NULL\n            blocking_lock_id: 3022234:69:4:3\n          blocking_lock_mode: X                       --------------æ­¤å¤„ä¸ºè¡Œé”\n        blocking_trx_started: 2021-02-06 04:36:09\n            blocking_trx_age: 00:00:05\n    blocking_trx_rows_locked: 2\n  blocking_trx_rows_modified: 1\n     sql_kill_blocking_query: KILL QUERY 27\nsql_kill_blocking_connection: KILL 27\n1 row in set, 3 warnings (0.00 sec)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612604254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274712,"user_name":"å°å¤ªé˜³","can_delete":false,"product_type":"c1","uid":1477324,"ip_address":"","ucode":"3B1C90425E485D","user_header":"https://static001.geekbang.org/account/avatar/00/16/8a/cc/da9adc82.jpg","comment_is_top":false,"comment_ctime":1611134205,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1611134205","product_id":100020801,"comment_content":"è€å¸ˆ,æˆ‘é‡åˆ°ä¸ªå¥‡æ€ªçš„æ­»é”é—®é¢˜:<br>create table organ_user(<br>id bigint primary key auto_increment,<br> usercode varchar not null,<br>organid bigint not null<br>) engine=innodb default charset=utf8mb4;<br>è¿™æ˜¯å»ºè¡¨è¯­å¥,åªæœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•. æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯read committed. mysqlç‰ˆæœ¬æ˜¯5.7.28<br>äº‹åŠ¡1: æ‰§è¡Œdelete from organ_user where organid in (1042) and usercode = &#39;0075&#39;;<br>äº‹åŠ¡2: æ‰§è¡Œdelete from organ_user where organid in (4042) and usercode = &#39;9001&#39;;<br>è¿™æ˜¯å‡ºç°æ­»é”æ—¶ä¸¤ä¸ªäº‹åŠ¡çš„sql. æ˜¾ç¤ºçš„é”ä¿¡æ¯ç¡®å®ä¹Ÿæ˜¯ä¸»é”®ç´¢å¼•ä¸Šçš„é”.<br>ç°åœ¨é—®é¢˜æ˜¯:deleteè¯­å¥çš„whereæ¡ä»¶åŒ¹é…ä¸åˆ°ç´¢å¼•,åº”è¯¥åªèƒ½é€ä¸ªæ‰«æä¸»é”®ç´¢å¼•,ç„¶åæŒ¨ä¸ªåŠ é”,ä¹Ÿå°±æ˜¯æ‰€æœ‰è®°å½•éƒ½ä¼šè¢«é”ä½,åæ‰§è¡Œçš„äº‹åŠ¡åº”è¯¥ä¼šç­‰å¾…å…ˆæ‰§è¡Œçš„äº‹åŠ¡æ‰§è¡Œå®Œæäº¤åå†æ‰§è¡Œå•Š,æ‰€ä»¥ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæ­»é”. é™¤éä¸¤ä¸ªäº‹åŠ¡æ‰«æé¡ºåºä¸ä¸€æ ·,ä½†æ˜¯ä»–ä»¬çš„sqlæ˜¯ä¸€æ ·çš„,åº”è¯¥éƒ½æ˜¯é¡ºåºæ‰«æå§.","like_count":0,"discussions":[{"author":{"id":1477324,"avatar":"https://static001.geekbang.org/account/avatar/00/16/8a/cc/da9adc82.jpg","nickname":"å°å¤ªé˜³","note":"","ucode":"3B1C90425E485D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346821,"discussion_content":"æ‰¾åˆ°åŸå› äº†ï¼Œè¿™ä¸¤ä¸ªäº‹ç‰©æœ‰å…¶ä¸­ä¸€ä¸ªè¿˜æœ‰ä¸ªæ’å…¥æ“ä½œï¼Œæ’å…¥æ“ä½œå…ˆæ‰§è¡Œï¼Œè€Œä¸”åªé”äº†æ’å…¥çš„é‚£ä¸€è¡Œã€‚ç„¶åç¬¬äºŒä¸ªäº‹ç‰©å†æ‰§è¡Œåˆ é™¤ï¼Œä»ç¬¬ä¸€è¡Œå¼€å§‹é”ï¼Œåˆ°æœ€åä¸€è¡Œé˜»å¡ï¼Œç„¶åç¬¬ä¸€ä¸ªäº‹ç‰©æ’å…¥å®Œå¼€å§‹æ‰§è¡Œåˆ é™¤ï¼Œå°±é€ æˆäº†æ­»é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612072740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271161,"user_name":"ä¸å·¥","can_delete":false,"product_type":"c1","uid":1462843,"ip_address":"","ucode":"A8725E6D0E1765","user_header":"https://static001.geekbang.org/account/avatar/00/16/52/3b/f1501d79.jpg","comment_is_top":false,"comment_ctime":1609423646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609423646","product_id":100020801,"comment_content":"sessionA:<br>begin;<br>SELECT id FROM t2 WHERE c = 5 LOCK IN SHARE MODE;<br>sessionB:<br>begin;<br>update t2 set c=10 where id=15;   ===&gt; ä¸é˜»å¡ï¼Œä½†æ˜¯å¦‚æœæŠŠidæ¢æˆ 5å°±ä¼šé˜»å¡ã€‚<br>æŒ‰ç…§è€å¸ˆçš„æ¨ç†ï¼šsessionAçš„é—´éš™é”æ˜¯ ï¼ˆ0,5] (5, 10),  sessionB æ˜¯åœ¨ç´¢å¼•cä¸Šæ’å…¥ï¼ˆc=10, id=15ï¼‰ï¼ˆc=10, id=0ï¼‰,ä¸ºä»€ä¹ˆä¸€ä¸ªé˜»å¡ï¼Œä¸€ä¸ªä¸é˜»å¡å‘¢ï¼ŸæŒ‰ç…§é“ç†ä¸åº”è¯¥ä¸¤ä¸ªéƒ½ä¸é˜»å¡å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":270577,"user_name":"æ¨è½¦çš„è€ç‹","can_delete":false,"product_type":"c1","uid":1832751,"ip_address":"","ucode":"568A2E436CCFBE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/HrblKDLM0uaYNgJo3ZbG3qzgvpq15vRDKadOkvktJuI6sWf4kUymXXXCM4ibicLcek22qAkd5oysSEVCTZuZJXGA/132","comment_is_top":false,"comment_ctime":1609164733,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609164733","product_id":100020801,"comment_content":"mysqlç‰ˆæœ¬5.7.18<br>sessionA:<br>START TRANSACTION;<br>SELECT * from t where c&gt;= 10 and c &lt; 11 for update;<br>----<br>sessionB:<br>INSERT INTO t (id,c,d) VALUES (2,5,8);<br>----<br>sessionC:<br>INSERT INTO t (id,c,d) VALUES (21,5,8);<br>æŒ‰ç…§ä»Šå¤©å­¦çš„çŸ¥è¯†é‚£ä¹ˆsessionAå¯¹åº”çš„æ˜¯(5,10],(10,15]ä¸¤ä¸ªé”<br>ä¸ºä»€ä¹ˆsessionbæˆåŠŸäº†ä½†æ˜¯sessioncå´é˜»å¡<br>éš¾é“æ˜¯å› ä¸ºsessionbå¯¹åº”çš„æ•°æ®åœ¨cçš„ç´¢å¼•æ ‘åœ¨ï¼ˆ5,5,5ï¼‰è¿™æ¡æ•°æ®çš„å·¦è¾¹æ‰€ä»¥ä¸åœ¨é”çš„èŒƒå›´å†…<br>sessioncå¯¹åº”çš„æ•°æ®åœ¨è¿™æ¡æ•°æ®çš„å³è¾¹æ‰€ä»¥è¢«é”ä½äº†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":270165,"user_name":"huai","can_delete":false,"product_type":"c1","uid":1528843,"ip_address":"","ucode":"18B5B205E052F5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/c3GB3cAibjkR3rFQRtt6L7GAVMicCTgaicDjsH6lItIqFolmVbWiaAkdJQZicp8EwJWFw83b7FlspaJuz1qO3TyPLzg/132","comment_is_top":false,"comment_ctime":1608964706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608964706","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼Œæ–‡ç« ä¸­ ä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚æˆ‘æƒ³é—®ä¸€ä¸‹ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ï¼Œåœ¨æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™ä¸ºä»€ä¹ˆä¸ä¼šä»next-key lock é€€åŒ–æˆgap lockå‘¢ï¼Ÿæ¯”å¦‚æ¡ˆä¾‹ä¸‰","like_count":0},{"had_liked":false,"id":269867,"user_name":"ç‹å»ºæ–°","can_delete":false,"product_type":"c1","uid":1934802,"ip_address":"","ucode":"E3151DDC0EEF0D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/85/d2/045c63fb.jpg","comment_is_top":false,"comment_ctime":1608818927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608818927","product_id":100020801,"comment_content":"è€å¸ˆå•Šå¯¹äºæœ€åä¸€é¢˜inser 666é‚£ä¸ªè¿˜æ˜¯ä¸æ˜ç™½ï¼Œæœ€åé”çš„ä¸åº”è¯¥æ˜¯10-25å— ï¼Œå’Œorder by cæœ‰å…³ç³»å— ä¼šé”åˆ°5-10","like_count":0},{"had_liked":false,"id":269813,"user_name":"ç‹å»ºæ–°","can_delete":false,"product_type":"c1","uid":1934802,"ip_address":"","ucode":"E3151DDC0EEF0D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/85/d2/045c63fb.jpg","comment_is_top":false,"comment_ctime":1608793995,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608793995","product_id":100020801,"comment_content":"æˆ‘æŠŠé¢˜ç›®é‡æ–°æè¿°å’Œç®€åŒ–ä¸€ä¸‹ï¼šè¿˜æ˜¯æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´åˆå§‹åŒ–çš„è¡¨ tï¼Œé‡Œé¢æœ‰ 6 æ¡è®°å½•ï¼Œå›¾ 12 çš„è¯­å¥åºåˆ—ä¸­ï¼Œä¸ºä»€ä¹ˆ session B çš„ insert æ“ä½œï¼Œä¼šè¢«é”ä½å‘¢ï¼Ÿå›¾ 12 é”åˆ†ææ€è€ƒé¢˜å¦å¤–ï¼Œå¦‚æœä½ æœ‰å…´è¶£å¤šåšä¸€äº›å®éªŒçš„è¯ï¼Œå¯ä»¥è®¾è®¡å¥½è¯­å¥åºåˆ—ï¼Œåœ¨æ‰§è¡Œä¹‹å‰å…ˆè‡ªå·±åˆ†æä¸€ä¸‹ï¼Œç„¶åå®é™…åœ°éªŒè¯ç»“æœæ˜¯å¦è·Ÿä½ çš„åˆ†æä¸€è‡´ã€‚","like_count":0},{"had_liked":false,"id":268703,"user_name":"è¥¿è¾¹ä¸€æŠ¹æ®‹é˜³","can_delete":false,"product_type":"c1","uid":1197178,"ip_address":"","ucode":"6836AB08783DC5","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/7a/d27c1ed3.jpg","comment_is_top":false,"comment_ctime":1608298550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608298550","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜<br>æ¡ˆä¾‹8ä¸ºå•¥ä¼šåŠ (5,10],(10,15)è¿™ä¸¤ä¸ªnext-key lockå‘¢ï¼ŒåŠ 10,(10,15)è¿™ä¸¤ä¸ªé”ä¸è¡Œå¥½äº†å—ï¼Ÿå› ä¸ºcå­—æ®µæœ‰ç´¢å¼•ï¼Œåº”è¯¥é€šè¿‡ç´¢å¼•æŸ¥æ‰¾ç›´æ¥å®šä½åˆ°c=10è¿™ä¸ªå¶å­èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œ5-10ä¹‹é—´é—´éš™é”å¯ä»¥å»æ‰å§","like_count":0},{"had_liked":false,"id":266107,"user_name":"Wangyf","can_delete":false,"product_type":"c1","uid":2226219,"ip_address":"","ucode":"349068A07CB1D4","user_header":"https://static001.geekbang.org/account/avatar/00/21/f8/2b/339660f1.jpg","comment_is_top":false,"comment_ctime":1607172208,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1607172208","product_id":100020801,"comment_content":"æ¡ˆä¾‹ä¸‰ä¸­çš„ session C, æˆ‘ç”¨çš„æ˜¯ 8.0.21 ç‰ˆæœ¬ï¼Œæ‰§è¡Œ session C é‡Œé¢çš„è¯­å¥æ—¶ï¼Œæ›´æ–° id = 15 çš„è¡Œå¹¶æ²¡æœ‰è¢«é”ä½ï¼Œbut ..... æˆ‘æƒ³ä¸é€šå®ƒä¸ºå•¥æ²¡é”ä½ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1049994,"avatar":"https://static001.geekbang.org/account/avatar/00/10/05/8a/e7c5a7e2.jpg","nickname":"sky","note":"","ucode":"C0859057592720","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539747,"discussion_content":"ä¿®æ”¹äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639826525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265764,"user_name":"x-rayîŒº","can_delete":false,"product_type":"c1","uid":1140175,"ip_address":"","ucode":"8363F0C4D0AC0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/cf/326c0eea.jpg","comment_is_top":false,"comment_ctime":1607005795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607005795","product_id":100020801,"comment_content":"mariadbçš„next-key lockæ˜¯ä¸æ˜¯å‰é—­åé—­åŒºé—´çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":263586,"user_name":"RedWallGUO","can_delete":false,"product_type":"c1","uid":2250984,"ip_address":"","ucode":"96BECA3717F5D6","user_header":"https://static001.geekbang.org/account/avatar/00/22/58/e8/ee40e86e.jpg","comment_is_top":false,"comment_ctime":1606190333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606190333","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ã€‚æ¡ˆä¾‹5ï¼šid&lt;=15, ä¸æ˜¯åº”è¯¥æ»¡è¶³ä¼˜åŒ–1ä¹ˆï¼Ÿé€€åŒ–æˆè¡Œé”ï¼Ÿå¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ¡ˆä¾‹3ä¸­çš„id&gt;=10åˆæ€ä¹ˆèƒ½å˜æˆè¡Œé”å‘¢ï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":263581,"user_name":"RedWallGUO","can_delete":false,"product_type":"c1","uid":2250984,"ip_address":"","ucode":"96BECA3717F5D6","user_header":"https://static001.geekbang.org/account/avatar/00/22/58/e8/ee40e86e.jpg","comment_is_top":false,"comment_ctime":1606189037,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606189037","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚MySQL 8.0.21ç‰ˆæœ¬ä¸­ï¼ŒRRéš”ç¦»ç•Œåˆ«ä¸‹ï¼Œæ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”ï¼Œçš„Session C æ‰§è¡Œupdate t set d = d+1 where id = 15æ²¡æœ‰é˜»å¡ã€‚æ˜¯ç‰ˆæœ¬çš„åŸå› ï¼Ÿ","like_count":0},{"had_liked":false,"id":262684,"user_name":"t-mac","can_delete":false,"product_type":"c1","uid":1477630,"ip_address":"","ucode":"F648100D8D7C8F","user_header":"https://static001.geekbang.org/account/avatar/00/16/8b/fe/f2b2ae63.jpg","comment_is_top":false,"comment_ctime":1605801623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605801623","product_id":100020801,"comment_content":"è€å¸ˆè¿™é‡Œåªè®²äº†åŠ é”çš„è§„åˆ™ï¼Œå¦‚æœå¯ä»¥è®²è§£ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„è§„åˆ™ï¼Œå¯èƒ½å¤§å®¶ç†è§£çš„ä¼šæ›´æ·±å…¥äº›","like_count":0},{"had_liked":false,"id":260402,"user_name":"ClassNotFound","can_delete":false,"product_type":"c1","uid":2030687,"ip_address":"","ucode":"F57194D1284585","user_header":"https://static001.geekbang.org/account/avatar/00/1e/fc/5f/4b7afeee.jpg","comment_is_top":false,"comment_ctime":1604998811,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604998811","product_id":100020801,"comment_content":"åˆ°äº†next-key lockè¿™é‡Œå½“æ—¶çœ‹äº†è€å¸ˆçš„æ–‡å­—ï¼ŒçœŸçš„æœ‰ç‚¹æ‡µï¼Œå¹¶ä¸æ˜¯è€å¸ˆçš„æ–‡å­—è¡¨è¾¾çš„ä¸å¥½ï¼Œè€Œæ˜¯è¿™æ–¹é¢ç”¨æ–‡å­—è¡¨è¾¾å‡ºæ¥å¾ˆéš¾è¡¨è¾¾ã€‚<br><br>åæ¥æˆ‘æ˜¯æ€ä¹ˆç†è§£çš„å‘¢ï¼Ÿçœ‹å›¾ç†è§£ï¼Œçœ‹å›¾ç†è§£ï¼Œçœ‹å›¾ç†è§£ï¼ˆé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼‰å…¶å®åªè¦æ˜ç™½next-key lock æ˜¯è¡Œé” + gapé”ï¼Œ","like_count":0},{"had_liked":false,"id":258189,"user_name":"Kevin","can_delete":false,"product_type":"c1","uid":1796510,"ip_address":"","ucode":"C23E3390995D95","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKo5jCPQW87sFySwXiaLxibak0qQYuFRTyy8RlNsO9JDyxBk1AYDrsphRskxzXPLPOW8ibWicWlRAnzwg/132","comment_is_top":false,"comment_ctime":1604322589,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604322589","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ‰ä¸€ç‚¹ä¸æ˜ç™½ï¼Œæ¡ˆä¾‹å››ä¸­ï¼ŒC=10æ—¶è¿™ä¸ªç­‰å€¼æŸ¥è¯¢æ—¶åˆ»ï¼Œç”±äºCæ˜¯æ™®é€šç´¢å¼•ï¼Œæ‰€ä»¥æ— æ³•èµ°ä¼˜åŒ–1ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸èƒ½èµ°ä¼˜åŒ–2å‘¢ï¼Ÿæ˜¯ä¸æ˜¯ä¼˜åŒ–è§„åˆ™åªå¯¹å”¯ä¸€ç´¢å¼•æœ‰æ•ˆå‘¢","like_count":0},{"had_liked":false,"id":256500,"user_name":"Geek_1968cf","can_delete":false,"product_type":"c1","uid":2224546,"ip_address":"","ucode":"1839F5CD2CCD63","user_header":"","comment_is_top":false,"comment_ctime":1603639606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603639606","product_id":100020801,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œâ€˜â€™åŒæ—¶æ ¹æ®ä¼˜åŒ– 2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ (id=7)ï¼Œè€Œ id=10 ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œnext-key lock é€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯ (5,10)ã€‚â€˜â€™ è¿™å¥è¯ä¸­çš„é€€åŒ–æˆé—´éš™é”ï¼Œæ˜¯æŒ‡å…ˆåŠ next-locké”å†é‡Šæ”¾è¡Œé”ã€‚è¿˜æ˜¯è¯´ä¸ä¼šæœ‰å…ˆåŠ åé‡Šæ”¾çš„è¿‡ç¨‹ï¼Œç›´æ¥åŠ çš„gapé”ï¼Ÿ","like_count":0},{"had_liked":false,"id":255929,"user_name":"konh","can_delete":false,"product_type":"c1","uid":1275980,"ip_address":"","ucode":"1CAD0D67067CC1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoicSMibHxGmeNXCLAnB6S7icPh814icIsw7VZ5vYzLOyKKUJYmFC5WGPekH5qI7rRbH3n4Y2obiaKlBTQ/132","comment_is_top":false,"comment_ctime":1603459036,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603459036","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚<br>å…³äº æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´é”ã€‚æœ‰ä¸ªé—®é¢˜ä¸å¾—å…¶è§£ã€‚<br>session C  çš„æ›´æ–° update t set d = d + 1 where c=15; ä¼šè¢«é˜»å¡ä½ã€‚å› ä¸ºï¼ˆ5ï¼Œ15] è¢«é”ä½äº†ã€‚<br>ä½†æ˜¯å¦‚æœæ”¹æˆ update t set d = d + 1 where id=15;å´èƒ½æ›´æ–°æˆåŠŸï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸæŒ‰ç†æ¥è¯´ï¼Œsession A æ˜¯ for update ï¼Œé‚£ä¸»é”®ç´¢å¼•çš„ï¼ˆ5,15] çš„åº”è¯¥è¢«é”ä½å§ï¼Ÿä½†æ˜¯ id=10&#47;15å´éƒ½èƒ½æ›´æ–°æˆåŠŸ<br><br><br>","like_count":0},{"had_liked":false,"id":254503,"user_name":"å¤§é¥¶Raysir","can_delete":false,"product_type":"c1","uid":1589208,"ip_address":"","ucode":"0AFA191420A30D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTITcwicqBDYzXtLibUtian172tPs7rJpqG1Vab4oGjnguA9ziaYjDCILSGaS6qRiakvRdUEhdmSG0BGPKw/132","comment_is_top":false,"comment_ctime":1603120575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603120575","product_id":100020801,"comment_content":"æœ€æ£’çš„ä¸“æ äº†ï¼","like_count":0},{"had_liked":false,"id":254465,"user_name":"å¤§é¥¶Raysir","can_delete":false,"product_type":"c1","uid":1589208,"ip_address":"","ucode":"0AFA191420A30D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTITcwicqBDYzXtLibUtian172tPs7rJpqG1Vab4oGjnguA9ziaYjDCILSGaS6qRiakvRdUEhdmSG0BGPKw/132","comment_is_top":false,"comment_ctime":1603118707,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603118707","product_id":100020801,"comment_content":"å¹²è´§æ»¡æ»¡ï¼Œæ‰«æ¸…äº†ä¸€å †çŸ¥è¯†ç›²ç‚¹ï¼Œå¤ªç»™åŠ›äº†ï¼","like_count":0},{"had_liked":false,"id":253558,"user_name":"èœ‰è£","can_delete":false,"product_type":"c1","uid":1229070,"ip_address":"","ucode":"77CF92496855D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/0e/2b987d54.jpg","comment_is_top":false,"comment_ctime":1602775601,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602775601","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œä¸å¤ªæ˜ç™½æ¡ˆä¾‹3ä¸­ id&gt;=10 and id&lt;11 ä¸­çš„ id=10 æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå› æ­¤é€€åŒ–ä¸ºè¡Œé”ï¼›è€Œæ¡ˆä¾‹5ä¸­çš„ id&gt;10 and id&lt;=15 ä¸­çš„ id=15 å› ä¸ºæ˜¯èŒƒå›´æŸ¥è¯¢å°±æ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”ï¼Œæ‰€ä»¥é”ä½äº† (10, 15]ã€‚è¯·é—®èŒƒå›´æŸ¥è¯¢å’Œç­‰å€¼æŸ¥è¯¢åº”è¯¥å¦‚ä½•ç†è§£ï¼Ÿ","like_count":0},{"had_liked":false,"id":253367,"user_name":"å¹³å‡¡ä¹‹è·¯","can_delete":false,"product_type":"c1","uid":1669273,"ip_address":"","ucode":"96CE12339BD5FD","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/99/6060eb2d.jpg","comment_is_top":false,"comment_ctime":1602720709,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602720709","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæ˜¯ä¸æ˜¯åªè¦ä¸»é”®ä¸ŠåŠ é”ï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½ä¿®æ”¹è¯¥è¡Œçš„æ‰€æœ‰å­—æ®µå‘¢ï¼Ÿä½†å¦‚æœåªé”è¦†ç›–ç´¢å¼•ï¼Œå°±å¯ä»¥ä¿®æ”¹å…¶ä»–å­—æ®µï¼ˆä¸èƒ½ä¿®æ”¹ä¸»é”®ï¼‰","like_count":0},{"had_liked":false,"id":252282,"user_name":"å·¦çª","can_delete":false,"product_type":"c1","uid":1468773,"ip_address":"","ucode":"6B797070168A12","user_header":"https://static001.geekbang.org/account/avatar/00/16/69/65/eb778125.jpg","comment_is_top":false,"comment_ctime":1602222740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602222740","product_id":100020801,"comment_content":"æˆ‘åœ¨sessionA æ‰§è¡Œ<br>begin;<br>update  t set d=7 where c=7 ;å› ä¸ºcä¸å­˜åœ¨,ä¼šé”ä½ç´¢å¼•cçš„(5,10);<br>çš„ç¡®,sessionB æ— æ³•æ’å…¥(8,8,8);<br>ä½†æ˜¯sessionC å´å¯ä»¥æˆåŠŸæ‰§è¡Œ update  t set d=7 where c=7 ","like_count":0},{"had_liked":false,"id":251737,"user_name":"æ¶›","can_delete":false,"product_type":"c1","uid":1158168,"ip_address":"","ucode":"48C7BDB7AD650D","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/18/25ae9cf7.jpg","comment_is_top":false,"comment_ctime":1601818246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601818246","product_id":100020801,"comment_content":"ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ c=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é” (5,10)ã€‚è¿™é‡Œ(5,10)æ²¡æœ‰ç†è§£åˆ°ï¼Œæ±‚è§£é‡Šã€‚","like_count":0},{"had_liked":false,"id":251725,"user_name":"å¹³å‡¡ä¹‹è·¯","can_delete":false,"product_type":"c1","uid":1669273,"ip_address":"","ucode":"96CE12339BD5FD","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/99/6060eb2d.jpg","comment_is_top":false,"comment_ctime":1601810208,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601810208","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºæ¡ˆä¾‹äºŒä¸­ï¼Œæ ¹æ®åŸåˆ™ 2 ï¼Œåªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ã€‚é”æ˜¯åŠ åœ¨ä¸»é”®ä¸Šçš„å—ï¼Œæ™®é€šç´¢å¼•ä¸ä¼šåŠ é”å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":251709,"user_name":"å¼ å“","can_delete":false,"product_type":"c1","uid":1209049,"ip_address":"","ucode":"AD840AF264C32E","user_header":"https://static001.geekbang.org/account/avatar/00/12/72/d9/488739d1.jpg","comment_is_top":false,"comment_ctime":1601803431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601803431","product_id":100020801,"comment_content":"ä¸€ä¸ª bugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚<br><br>æˆ‘çš„ç‰ˆæœ¬æ˜¯8.0.19ï¼Œä»ç°è±¡ä¸Šçœ‹å·²ç»ä¿®å¤äº†è¿™ä¸ªbugã€‚<br>sessionA:<br>begin;<br>select * from t where id&gt;10 and id&lt;=15 for update;<br><br>sessionB:<br>insert into t values(16,16,16);<br>ä¸ä¼šé˜»å¡ï¼ŒæˆåŠŸæ‰§è¡Œï¼›<br>update t set d=d+1 where id=20;<br>ä¸ä¼šé˜»å¡ï¼ŒæˆåŠŸæ‰§è¡Œï¼›","like_count":0},{"had_liked":false,"id":251668,"user_name":"åˆ«é—®","can_delete":false,"product_type":"c1","uid":1500187,"ip_address":"","ucode":"B24480E6E5792B","user_header":"https://static001.geekbang.org/account/avatar/00/16/e4/1b/76d3b44c.jpg","comment_is_top":false,"comment_ctime":1601783748,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601783748","product_id":100020801,"comment_content":"CREATE TABLE `b` (<br>  `a` int(11) NOT NULL,<br>  `b` int(11) DEFAULT NULL,<br>  `c` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`a`),<br>  UNIQUE KEY `idx_b` (`b`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br><br>insert(1,1,1);<br>insert(3,3,3);<br>insert(5,5,5);<br>insert(10,10,10);<br>insert(15,15,15);<br><br>session 1:<br>begin;<br>select * from b where b &gt;= 10 for update;<br>commit;<br>æ ¹æ®æ‚¨çš„ä¼˜åŒ–1æˆ‘è®¡ç®—ä»¥ä¸Šè¯­å¥å¯¹bç´¢å¼•çš„åŠ é”èŒƒå›´ä¸º[10],(10,15],(15,+], å¯¹ä¸»é”®ç´¢å¼•ä¸º[10],[15]<br>session 2:<br>insert(9,9,9); -- è¢«é˜»å¡,è¯·é—®è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢<br>å½“æŠŠsession 1 çš„ b&gt;= 10 æ”¹æˆ a &gt;= 10å,session 2å°±å¯ä»¥æ­£å¸¸æ’å…¥.<br>aæ˜¯ä¸»é”®,bä¹Ÿæ˜¯å”¯ä¸€ç´¢å¼•,è¯·é—®è€å¸ˆè¿™æ˜¯ä»€ä¹ˆåŸå› ,æˆ‘é—æ¼äº†ä»€ä¹ˆçŸ¥è¯†ç‚¹","like_count":0},{"had_liked":false,"id":250567,"user_name":"é…¸è‘¡è„","can_delete":false,"product_type":"c1","uid":1154146,"ip_address":"","ucode":"9D059C4FB327C0","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","comment_is_top":false,"comment_ctime":1601133607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601133607","product_id":100020801,"comment_content":"æ¡ˆä¾‹1ï¼š<br>session C:<br>ä¿®æ”¹id=9ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé—´éš™é”ä¸èµ·ä½œç”¨äº†å—ï¼Ÿ<br>æµ‹è¯•å‘ç°update t set d=d+1 where id = 5&#47;7&#47;8&#47;10;éƒ½å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä¸ä¼šé˜»å¡ã€‚<br>æ‰€ä»¥çŒœæµ‹é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œdä¸æ˜¯ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹ã€‚<br><br>ç»§ç»­å®éªŒï¼š<br>update t set id=id+1 where id =7;<br>å‘ç°ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œæ˜¯ä¸æ˜¯å› ä¸ºæ•°æ®åº“ä¸­æ²¡æœ‰id=7è¿™ä¸ªè®°å½•ï¼Ÿ<br>update t set id=id+1 where id =5;é˜»å¡äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¡Œé”ï¼Ÿ","like_count":0},{"had_liked":false,"id":249650,"user_name":"pedestrian","can_delete":false,"product_type":"c1","uid":1484461,"ip_address":"","ucode":"5A5B9AEA0781F0","user_header":"https://static001.geekbang.org/account/avatar/00/16/a6/ad/41b6e0be.jpg","comment_is_top":false,"comment_ctime":1600741596,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600741596","product_id":100020801,"comment_content":"æ²¡çœ‹æ‡‚æ¡ˆä¾‹äº”ï¼Œnext-key lockä¸æ˜¯å‰å¼€åé—­åŸåˆ™å—ï¼Œï¼ˆ15,20ã€‘ ä¸åŒ…æ‹¬20ï¼Œæ€ä¹ˆè¿˜ä¼šæŠŠseesionBé‡Œçš„updateé”ä½å‘¢","like_count":0},{"had_liked":false,"id":244996,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1598776902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598776902","product_id":100020801,"comment_content":"æ„Ÿè§‰å°‘è®²äº†ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½ä¼šæ¶‰åŠåˆ°æ›´æ–°ç´¢å¼• å’Œ è¡¨æ•°æ®ï¼ˆå³ä¸»é”®ç´¢å¼•ï¼‰ã€‚ç›®å‰åªé‡ç‚¹è®²äº†ç´¢å¼•å¦‚ä½•åŠ é”ï¼Œæ²¡æœ‰è®²æ­¤æ—¶ä¸»é”®ç´¢å¼•ä¸Šæ˜¯å¦‚ä½•åŠ é”çš„ã€‚å³ä½¿æ›´æ–°æˆ–æ’å…¥çš„æ•°æ®æ²¡æœ‰è¢«ç´¢å¼•çš„é—´éš™é˜»å¡ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«ä¸»é”®ä¸Šçš„é—´éš™æ‰€é˜»å¡ã€‚è¿™ä¹Ÿæ‰€æœ‰çš„update ä¾‹å¥ä¸­ï¼Œéƒ½å†™æˆäº† update t set d=d+1 where xxx = xxxã€‚","like_count":0},{"had_liked":false,"id":242450,"user_name":"å•¸ç–¯","can_delete":false,"product_type":"c1","uid":1104225,"ip_address":"","ucode":"24792660595DA1","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/61/4999fbc3.jpg","comment_is_top":false,"comment_ctime":1597731557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597731557","product_id":100020801,"comment_content":"æˆ‘æœ¬åœ°çš„ç‰ˆæœ¬ï¼Œæ­£å¥½æ¯”è€å¸ˆçš„æ–°ï¼Œæ‰€ä»¥åšå‡ ç‚¹è¡¥å……ï¼š<br>1 å¯¹äºå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ˜¯å¯¹äºå·²ç»å­˜åœ¨è®°å½•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œåˆ™é€€åŒ–ä¸ºç®€å•çš„è¡Œé”ï¼›å¦‚æœæ˜¯ä¸å­˜åœ¨è®°å½•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œåˆ™ä¼šåŠ next-key lockï¼Œå¹¶ä¸”å·¦å¼€å³å¼€ã€‚<br>2 å¯¹äºéå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœæ˜¯å¯¹äºå·²ç»å­˜åœ¨è®°å½•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œåˆ™ä¼šä»¥ç»™å®šå€¼ä¸ºä¸­å¿ƒï¼Œå‰ååŠ next-key lockï¼Œä¸”å·¦å¼€å³é—­ï¼Œè®¿é—®èŒƒå›´å†…éƒ½åŠ é”ï¼›å¦‚æœæ˜¯å¯¹äºä¸å­˜åœ¨è®°å½•çš„ç­‰å€¼æŸ¥è¯¢ï¼Œåˆ™ä»¥ç»™å®šå€¼ä¸ºä¸­å¿ƒï¼Œå‘å‰åå¯»æ‰¾åŠ next-key lockï¼ŒåŒæ ·æ˜¯å·¦å¼€å³é—­ã€‚<br>3 å¯¹äºèŒƒå›´æŸ¥è¯¢ï¼Œå‡æŒ‰ç…§æŸ¥æ‰¾èŒƒå›´ï¼ŒåŠ next-key lock","like_count":0},{"had_liked":false,"id":235768,"user_name":"zapup","can_delete":false,"product_type":"c1","uid":1397351,"ip_address":"","ucode":"388D6BB5D7B137","user_header":"https://static001.geekbang.org/account/avatar/00/15/52/67/fcba0967.jpg","comment_is_top":false,"comment_ctime":1595179665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595179665","product_id":100020801,"comment_content":"è¿™ç¯‡æ€ä¹ˆèµéƒ½ä¸ä¸ºè¿‡ï¼Œçœ‹äº†ä¸€æ™šä¸Šï¼Œå¿«å“‰å¿«å“‰ï¼<br><br>è¾¹å­¦è¾¹é€šè¿‡ sys.innodb_lock_waits æŸ¥çœ‹åœ¨å“ªä¸ªç´¢å¼•åŠ äº†é” locked_indexã€è°åœ¨æŒ¡è·¯ blocking_lock_modeã€æŒ¡ç€è°çš„è·¯ waiting_lock_modeã€‚<br>åŒæ—¶å¯¹æ¡ˆä¾‹ä¸‰ã€å››ã€äº”æœ‰ä¸ªç–‘é—®ï¼šå‘½åæœ‰é—´éš™é” GAPï¼Œä¸ºä½• blocking_lock_mode åªæœ‰ X&#47;Sï¼Ÿ<br>ç›´åˆ°æ¡ˆä¾‹å…«çš„æ­»é”ä¾‹å­æåˆ°å¯ä»¥åˆ†å¼€ next-key lock ä¸º X&#47;S + GAPï¼Œå°±èƒ½ç†è§£ä¸Šè¿°é—®é¢˜äº†ã€‚<br><br>å¤§èƒ†çŒœæƒ³ï¼Œnext-key lock åªæ˜¯æ¦‚å¿µä¸Šé”æ¨¡å¼ï¼ˆæ ¹æ®åŸåˆ™1è¦åŠ å°±æ†ç»‘ (X&#47;S + GAP) ä¸€èµ·åŠ ï¼Œå¤–éƒ¨æ„Ÿè§‰æ˜¯ä¸€ä¸ªæ•´ä½“ï¼‰ï¼Œä½†å­˜å‚¨å¼•æ“åªè®¤è¡Œé”ä¸é—´éš™é”ï¼Œè¯·é—®è€å¸ˆï¼Œèƒ½è¿™ä¹ˆç†è§£å—ï¼ˆæœªçœ‹æºç ...ï¼‰ï¼Ÿ","like_count":0},{"had_liked":false,"id":235363,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1594984035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594984035","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸‹æ¡ˆä¾‹ä¸€ä¸­ï¼Œäº‹åŠ¡bæ’å…¥æ•°æ®ä¼šæ€æ ·ï¼Œä¸ºå•¥è¦é”å®ƒï¼Ÿ","like_count":0},{"had_liked":false,"id":234186,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1594613055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594613055","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯¥å¦‚ä½•ç†è§£äº‹åŠ¡ä¸­ä¸€è‡´æ€§è¿™ä¸€ç‰¹æ€§å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":233904,"user_name":"Geek_2ac804","can_delete":false,"product_type":"c1","uid":1518795,"ip_address":"","ucode":"EDF69B20030BB8","user_header":"","comment_is_top":false,"comment_ctime":1594513834,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594513834","product_id":100020801,"comment_content":"æœ‰æ²¡æœ‰åƒäº‹åŠ¡å¯è§æ€§é‚£è¾¹çš„æ€»ç»“ï¼Œæ¯”è¾ƒç›´è§‚æ„Ÿå—çš„ï¼Œè™½ç„¶æ ¹æ®è¿™äº›é€‰æ‹©å’Œä¼˜åŒ–ä¹Ÿèƒ½ç®—å‡ºåŠ é”ï¼Œä½†æœ‰çš„æ²¡æ€ä¹ˆæƒ³æ˜ç™½ä¸ºä»€ä¹ˆä¼šåŠ é”ï¼Œå°±æ˜¯ç›®å‰æœ‰æ–¹æ³•èƒ½å¾—åˆ°ç»“è®ºï¼Œä½†å¾—åˆ°ç»“è®ºå´æƒ³ä¸æ˜ç™½ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªç»“è®º","like_count":0},{"had_liked":false,"id":233889,"user_name":"Geek_db6a4b","can_delete":false,"product_type":"c1","uid":1903708,"ip_address":"","ucode":"E5992D1CF088C4","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0c/5c/b03b2cc1.jpg","comment_is_top":false,"comment_ctime":1594494626,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1594494626","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚æœ‰ä¸€ä¸ªç–‘é—®ï¼šå”¯ä¸€ç´¢å¼•çš„**èŒƒå›´æŸ¥è¯¢**next-key lock ä¼šé€€åŒ–ä¸ºgap lockå—ï¼Œè¿™éƒ¨åˆ†æœ‰äº›è¿·æƒ‘<br>æ–‡ä¸­ä¼˜åŒ–äºŒè¯´å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ä¼šé€€åŒ–æˆé—´éš™é”ï¼Œä¸è¿‡èŒƒå›´æŸ¥è¯¢æˆ‘è¿˜æ˜¯æ²¡æ˜ç™½å…·ä½“è§„åˆ™ã€‚<br>ï¼ˆæ‚¨çš„æ¡ˆä¾‹ä¸‰ä¸­èŒƒå›´æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸´å»ºé”æ²¡æœ‰é€€åŒ–æˆé—´éš™é”ï¼Œä½†æ˜¯ä¸Šç¯‡æ–‡ç« ä¸­@è–›ç•… çš„å®éªŒç»“æœæ˜¯é€€åŒ–æˆé—´éš™é”çš„ï¼Œä¹Ÿå¾—åˆ°äº†æ‚¨çš„è‚¯å®šï¼‰","like_count":0,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301857,"discussion_content":"åœ¨mysql 8.23ä¸­æµ‹è¯•ï¼Œsession c å¯ä»¥æ›´æ–°ï¼Œæ„Ÿè§‰æ˜¯ next-key lock:(10,15]ï¼Œé€€åŒ–ä¸ºé—´éš™é”(10,15)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598687070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233883,"user_name":"Geek_66a431","can_delete":false,"product_type":"c1","uid":1484706,"ip_address":"","ucode":"D8941CA3BE8457","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gIE15oOl1IicE8hicpPzuoARricgaL3y4nHDXaFCPX0U3UX3szgtrKCa4zCPc5GkdpceP0mftbJg3MdKHOLJOKJww/132","comment_is_top":false,"comment_ctime":1594489660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594489660","product_id":100020801,"comment_content":"è€å¸ˆå¥½ ï¼Œ ä¸ä½¿ç”¨gapé”ä¼šå¯¼è‡´binlogä¸ä¸€è‡´ï¼Œ ä½†æ˜¯gapé”åªæœ‰rræ‰æœ‰æ•ˆï¼Œ éš¾é“rcä»¥ä¸‹çš„binlogå¯èƒ½å‡ºé—®é¢˜çš„ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":233186,"user_name":"dawn","can_delete":false,"product_type":"c1","uid":1384866,"ip_address":"","ucode":"40CEAC0FD6567C","user_header":"https://static001.geekbang.org/account/avatar/00/15/21/a2/280e29ff.jpg","comment_is_top":false,"comment_ctime":1594256766,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594256766","product_id":100020801,"comment_content":"è¯·é—®ä¸‹è€å¸ˆï¼Œå•çº¯çš„insertè¯­å¥æ˜¯å¦‚ä½•åŠ é”çš„å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":230139,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1593272878,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593272878","product_id":100020801,"comment_content":"ä¸æ˜ç™½ï¼ŒåŠ next-å¯ä»¥é”çš„æ—¶å€™ï¼Œé‚£ä¸ªå‰å¼€åé—­çš„åŒºé—´æ˜¯æ€ä¹ˆç¡®å®šçš„ã€‚æ¯”å¦‚ï¼š<br>select * from t where c&gt;=10 and c &lt; 11 for update<br> ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡ç”¨ c=10 å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼• c ä¸ŠåŠ äº† (5,10]è¿™ä¸ª next-key lockï¼Œè¿™ä¸ª5æ˜¯æ€ä¹ˆç¡®å®šçš„ã€‚ä¸ºä»€ä¹ˆæ˜¯ï¼ˆ5ï¼Œ10]","like_count":0,"discussions":[{"author":{"id":1657055,"avatar":"https://static001.geekbang.org/account/avatar/00/19/48/df/5359b4fc.jpg","nickname":"é›¨è½æœ¬æ— æ™´","note":"","ucode":"E64A60649544B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329004,"discussion_content":"ä»next-key lockæ¥çœ‹ï¼Œ10 å±äº(5,10] è¿™ä¸ªåŒºé—´","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606296157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229105,"user_name":"dawn","can_delete":false,"product_type":"c1","uid":1384866,"ip_address":"","ucode":"40CEAC0FD6567C","user_header":"https://static001.geekbang.org/account/avatar/00/15/21/a2/280e29ff.jpg","comment_is_top":false,"comment_ctime":1592897921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592897921","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæœ‰ä¸ªç–‘é—®ï¼Œæ¡ˆä¾‹äº”æˆ‘è¯•äº†ä¸‹ï¼Œäº‹åŠ¡bå’Œcå¹¶æ²¡æœ‰é˜»å¡ï¼Œæˆ‘çš„éš”ç¦»çº§åˆ«æ²¡é—®é¢˜ï¼Œé—´éš™é”æ˜¯å¼€å¯çš„ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å‘¢","like_count":0},{"had_liked":false,"id":226845,"user_name":"å›¾çµæœº","can_delete":false,"product_type":"c1","uid":2034632,"ip_address":"","ucode":"EB02DB653AD591","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0b/c8/15f055d3.jpg","comment_is_top":false,"comment_ctime":1592214752,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1592214752","product_id":100020801,"comment_content":"ä¸‰è§‚å°½æ¯","like_count":0},{"had_liked":false,"id":226010,"user_name":"æ…•é«˜è¿ª","can_delete":false,"product_type":"c1","uid":1448126,"ip_address":"","ucode":"EB1CB5EA4E3A90","user_header":"https://static001.geekbang.org/account/avatar/00/16/18/be/ad3127e0.jpg","comment_is_top":false,"comment_ctime":1591928381,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591928381","product_id":100020801,"comment_content":"å¤§ä½¬å¥½ï¼Œå¯¹äºèŒƒå›´æŸ¥è¯¢ã€‚æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Ÿ c&gt;=15 and c &lt;=20ï¼Œorder by c desc ã€‚é¦–å…ˆæŸ¥æ‰¾c=20çš„è¡Œï¼Œæ­¤æ—¶ä¼šåŠ é” ( 15,20 ] å’Œ ( 20 , 25 ) ã€‚ç„¶åç”±äºæ˜¯æŒ‰ç…§cå€’å™ï¼Œæ‰€æœ‰ä¼šä»¥æ­¤å‘å·¦æ‰«æï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äº15çš„å€¼ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯10ï¼Œæ­¤æ—¶ä¼šåŠ é”  ( 5, 10 ] , ä½†æ˜¯ç”±äº10ä¸æ»¡è¶³è§„åˆ™ï¼Œæ‰€ä»¥å°±æ˜¯ï¼ˆ5,10ï¼‰çš„é—´éš™é”ï¼Œæ‰€ä»¥æ•´ä¸ªåŠ é”èŒƒå›´æ˜¯( 5 , 10 ) ( 10 , 25 )ï¼›å¦‚æœæŒ‰ç…§æ˜¯cæ­£åºçš„è¯å°±æ˜¯( 10, 25 )ï¼›","like_count":0},{"had_liked":false,"id":225050,"user_name":"zero","can_delete":false,"product_type":"c1","uid":1684113,"ip_address":"","ucode":"27019747CA63FF","user_header":"https://static001.geekbang.org/account/avatar/00/19/b2/91/fbc34225.jpg","comment_is_top":false,"comment_ctime":1591624945,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1591624945","product_id":100020801,"comment_content":"è¯·æ±‚è€å¸ˆè§£ç­”<br>é—®é¢˜æ˜¯ï¼šå¯¹æ™®é€šç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢é”é—®é¢˜<br>å¤ç°è¿‡ç¨‹ï¼š<br>SESSION Aï¼š<br>beginï¼›<br>select * from t where c&gt;=10 and c&lt;22 for update;<br><br>SESSION Bï¼š<br>insert into t values (26,2,6,26); <br><br>è¡¨ç°ï¼šSESSION Bè¢«é”<br><br>ç–‘æƒ‘ï¼šæŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œcæ˜¯æ™®é€šç´¢å¼•ï¼Œåªéœ€è¦é”ä½c ï¼ˆ5ï¼Œ25] å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆ26ä¹Ÿä¼šè¢«é”","like_count":0},{"had_liked":false,"id":224996,"user_name":"lant","can_delete":false,"product_type":"c1","uid":1083330,"ip_address":"","ucode":"FD3FD13E14DD24","user_header":"","comment_is_top":false,"comment_ctime":1591611534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591611534","product_id":100020801,"comment_content":"æ¡ˆä¾‹å›› å¥½åƒæœ‰äº›é—®é¢˜:<br>session A çš„ select * from t where c&gt;=10 and c &lt; 11 for update;<br>è¿™ä¸ªsqlæ˜¯ select*, æ‰€ä»¥ä¼šèµ°èšç°‡ç´¢å¼•å§ ?<br>ç»è¿‡æµ‹è¯•  update t set d=d+1 where id=10;æ˜¯ä¼šè¢«é˜»å¡çš„ï¼Œè€Œ update t set d=d+1 where id=15; ä¸ä¼šè¢«é˜»å¡","like_count":0},{"had_liked":false,"id":224305,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1591341384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591341384","product_id":100020801,"comment_content":"CREATE TABLE `t` (<br>  `id` int(10) NOT NULL AUTO_INCREMENT,<br>  `a` int(10) DEFAULT NULL,<br>  `b` int(10) DEFAULT NULL,<br>  `c` int(10) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_a_b` (`a`,`b`),<br>  KEY `idx_c` (`c`)<br>) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8;<br>(0,0,0,0) (5,5,5,5)(10,10,10,10)(15,15,15,15)(20,20,20,20)<br>session A:<br>begin<br>select id from t where c=15 for update;<br><br>sessionB<br>select * from t where id = 15<br><br>æ ¹æ®åŸåˆ™2åªæœ‰è®¿é—®åˆ°çš„æ‰ä¼šåŠ é”ï¼Œä½†æ˜¯è¿™é‡Œç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šé”ä½id=15è¿™è¡Œå‘¢ã€‚ æ”¹æˆlock in share mode å°±ä¸é”ä½","like_count":0},{"had_liked":false,"id":220138,"user_name":"lg","can_delete":false,"product_type":"c1","uid":1995387,"ip_address":"","ucode":"2878AA634860ED","user_header":"","comment_is_top":false,"comment_ctime":1590168219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590168219","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½,æˆ‘ç†è§£é—´éš™é”æ˜¯ä¸»é”®ä¹‹é—´å­˜åœ¨é—´éš™æ—¶(æ¯”å¦‚1-5)ä¼šåŠ å…¥é—´éš™é”,å¦‚æœä¸»é”®ä½¿ç”¨UUIDæ—¶,è¿˜ä¼šå­˜åœ¨é—´éš™é”å—","like_count":0},{"had_liked":false,"id":220021,"user_name":"xinnong","can_delete":false,"product_type":"c1","uid":1005415,"ip_address":"","ucode":"3C1F1EB93FBA5B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/67/01d1580f.jpg","comment_is_top":false,"comment_ctime":1590136740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590136740","product_id":100020801,"comment_content":"æ¡ˆä¾‹äºŒçš„session cå¦‚æœæ‰§è¡Œinsert into t(id,c,d) values(111,0,0);ä¸ºä»€ä¹ˆä¹Ÿä¼šblockå‘¢ï¼Ÿé”çš„èŒƒå›´çš„å·¦ä¾§çš„0ä¸æ˜¯å¼€åŒºé—´ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":219986,"user_name":"xinnong","can_delete":false,"product_type":"c1","uid":1005415,"ip_address":"","ucode":"3C1F1EB93FBA5B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/67/01d1580f.jpg","comment_is_top":false,"comment_ctime":1590131789,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1590131789","product_id":100020801,"comment_content":"é’ˆå¯¹æ¡ˆä¾‹äºŒï¼Œå¦‚æœæ²¡æœ‰c=5è¿™è¡Œæ•°æ®ï¼Œ<br>session A:<br>begin;<br>select id from t where c=5 lock in share mode;<br><br>session Bï¼š<br>begin;<br>insert into t values(102,0,10); -- ä¸ºä»€ä¹ˆè¿™é‡Œä¼šç­‰å¾…é”ã€‚<br><br>æˆ‘çš„ç†è§£ï¼š<br>è¡¨ t ä¸­æ²¡æœ‰ c=5 çš„è®°å½•ï¼Œæ ¹æ®åŸåˆ™ 1ï¼Œ<br>åŠ é”å•ä½æ˜¯ next-key lockï¼Œsession A åŠ é”èŒƒå›´å°±æ˜¯ (0,10]ï¼›<br>æ ¹æ®ä¼˜åŒ–2ï¼Œnext-key lock é€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯ (0,10)ã€‚<br>æˆ‘çš„é—®é¢˜ï¼š<br>ä¸ºä»€ä¹ˆsession Bä¸­æ‰§è¡Œinsert into t values(102,0,10);æ—¶ä¼šç­‰å¾…é”å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"é˜¿å‡¯æ–‡","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283552,"discussion_content":"æˆ‘çŒœæ˜¯c=0ï¼Œid=102åœ¨é”ï¼ˆ0.10ï¼‰çš„ä¸‹é™c=0ï¼Œid=0çš„å³è¾¹ï¼Œå³åœ¨é”èŒƒå›´å†…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592294747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218477,"user_name":"Justdo","can_delete":false,"product_type":"c1","uid":1525734,"ip_address":"","ucode":"DA36A57DE6CEF2","user_header":"https://static001.geekbang.org/account/avatar/00/17/47/e6/6f63cb13.jpg","comment_is_top":false,"comment_ctime":1589807033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589807033","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºæ¡ˆä¾‹äºŒï¼Œæˆ‘æƒ³é—®ä¸‹ï¼Œæœ€ç»ˆé”çš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿå¦å¤–ï¼Œåˆ†æä¸­çš„å‰ä¸¤ç‚¹ï¼Œæ˜¯è¯¥å–å¹¶é›†ï¼Œè¿˜æ˜¯äº¤é›†ï¼Ÿæˆ–è€…æ€ä¹ˆç†è§£èƒ½æˆä¸ºæœ€ç»ˆçš„ç­”æ¡ˆï¼Ÿçƒ¦è¯·æ‚¨ä¸å¿™æ—¶å¸®å¿™è§£ç­”ä¸‹ï¼Œæˆ–è€…æœ‰çŸ¥é“çš„å°ä¼™ä¼´ï¼Œä¹Ÿè¾›è‹¦æŒ‡æ•™ï¼Œè°¢è°¢","like_count":0},{"had_liked":false,"id":218316,"user_name":"ppd0705","can_delete":false,"product_type":"c1","uid":1155646,"ip_address":"","ucode":"EB63D4E3FD1E9A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","comment_is_top":false,"comment_ctime":1589778292,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1589778292","product_id":100020801,"comment_content":"æ±‚åŠ©ï¼šæ¡ˆä¾‹å››å¥½åƒ idç´¢å¼•10é‚£ä¸€è¡Œæ²¡æœ‰é”ä½ï¼Ÿæ‰§è¡Œ `update t set d=d+1 where id=10;` æ²¡æœ‰é˜»å¡","like_count":0,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301865,"discussion_content":"Update t set d=d+1 where id =15; å¯ä»¥æ‰§è¡Œï¼Œä½† Update t set d=d+1 where id =10; é˜»å¡äº†ï¼Œè¢«è¡Œé” x é˜»å¡ã€‚è¿è¡Œç¯å¢ƒï¼šMySQL8.0.21","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598689457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217820,"user_name":"è‘£å¥","can_delete":false,"product_type":"c1","uid":1666894,"ip_address":"","ucode":"6364F0FBAEC102","user_header":"https://static001.geekbang.org/account/avatar/00/19/6f/4e/b9ef15bf.jpg","comment_is_top":false,"comment_ctime":1589620448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589620448","product_id":100020801,"comment_content":"èŒƒå›´æŸ¥è¯¢ä¸ºä»€ä¹ˆä¸ä¼šç”¨åˆ°ä¼˜åŒ–2å‘¢ï¼Ÿä¸æ¸…æ¥šä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜","like_count":0},{"had_liked":false,"id":215844,"user_name":"kyle","can_delete":false,"product_type":"c1","uid":1444674,"ip_address":"","ucode":"91B332A30CB3EC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8xaOJxaYJJm7ic4jXiaiaLDHfhmYpUVSVDPQFtq1bUzuXNj8WGeticicNnicBnwRfYgphG9JicxKITZeYBIoPrjymUWzA/132","comment_is_top":false,"comment_ctime":1589116790,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589116790","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œæ‚¨å¥½ã€‚æˆ‘å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªä¾‹å­çš„æ­»é”æƒ…å†µä¸å¤ªç†è§£ï¼Œå¸Œæœ›å¯ä»¥å¾—åˆ°æ‚¨çš„æç‚¹ï¼Œä¸‹é¢æ˜¯æˆ‘å¯¹ä¾‹å­çš„åˆ†æä¸ç–‘é—®ï¼š<br><br>create table my1(<br>sno int(11) NOT NULL DEFAULT &#39;0&#39;,<br>name int(11) DEFAULT null,<br>PRIMARY KEY(sno),<br>unique key idx (name)<br>) engine innodb;<br><br><br>1. äº‹åŠ¡aæ‰§è¡Œbegin; insert into my1 values(8,6); &#47;&#47; äº‹åŠ¡aæ­¤æ—¶ä¸Šéšå¼é”(intention gap lock) <br>2. äº‹åŠ¡bæ‰§è¡Œbegin; insert into my1 values(6,6); &#47;&#47; äº‹åŠ¡b çš„é”æƒ…å†µï¼šlock mode S waiting #2 ï¼Œæ­¤æ—¶äº‹åŠ¡açš„é”æƒ…å†µï¼šlock_mode X locks rec but not gap #1<br>Record lock<br>3. äº‹åŠ¡aæ‰§è¡Œinsert into my1 values(7,5) &#47;&#47; æ­¤æ—¶äº‹åŠ¡açš„é”æƒ…å†µï¼Œlock_mode X locks gap before rec insert intention waiting #3 ï¼Œå‘ç”Ÿæ­»é”<br><br><br>èµ„æ–™å¯¹æ­»é”åŸå› è¯´æ˜æ˜¯ï¼š<br>åˆ¤æ–­#2å’Œ#3å†²çªäº†ï¼Œä¸€ä¸ªæ˜¯è¯»ä¸€ä¸ªæ˜¯å†™ã€‚åˆ¤æ–­ä¹‹åï¼Œä¼šåšä¸€æ¬¡æ­»é”æ£€æŸ¥æ‰«æï¼Œé”#3ç­‰å¾…é”#2ï¼Œé”#2æ­¤æ—¶æ­£åœ¨ç­‰é”#1ï¼Œè€Œé”#3å’Œé”#1æ‰€å¯¹åº”çš„äº‹åŠ¡éƒ½æ˜¯äº‹åŠ¡2ï¼Œè¿™é‡Œå‡ºç°äº†ç¯å’Œæ­»é”<br><br>æˆ‘çš„ç–‘é—®ï¼š<br>1ã€éƒ½æ˜¯æ’å…¥è¯­å¥ä¸ºä»€ä¹ˆä¼šéœ€è¦ä¸Šgap lockï¼Œå¹³æ—¶è®¤è¯†åˆ°çš„gap lockéƒ½ç”¨äºé¿å…å¹»è¯»ï¼Œæ­¤å¤„gao lockçš„ä½œç”¨æ˜¯ ï¼Ÿ<br>2ã€ä»æ­»é”æ—¥å¿—ä¸­çœ‹åˆ°#3 çš„é”æƒ…å†µï¼šlock_mode X locks gap before rec insert intention waiting ï¼Œè¿™å¥æ—¥å¿—è¯¥å¦‚ä½•è§£è¯»ï¼Ÿ","like_count":0},{"had_liked":false,"id":212032,"user_name":"Mr_freezing37","can_delete":false,"product_type":"c1","uid":1061402,"ip_address":"","ucode":"BB605A6FEDCEB6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/y5NFbibdKCFCg0lHKK5ERGOQWXYYK7jhnqm2BxQ6r7tWvXx8uDmibglweejDWU39BTmDSAtBJGj1ibOZK2uIHQyqg/132","comment_is_top":false,"comment_ctime":1588049464,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1588049464","product_id":100020801,"comment_content":"å…³äºæ¡ˆä¾‹å››ï¼Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹ç†è§£åƒåŠ›ã€‚<br>æ–‡ä¸­æ¡ˆä¾‹äºŒæœ‰è®²åˆ°select for updateé”è¿‡ç¨‹ï¼Œé¦–å…ˆçæ˜¯å…ˆåŠ åœ¨Cç´¢å¼•æ ‘ä¸Šçš„ï¼Œå†å»ä¸»é”®ç´¢å¼•æ ‘ä¸ŠæŠŠæ»¡è¶³æ¡ä»¶çš„è¡Œé”ä½ã€‚<br>ç»“åˆæ¡ˆä¾‹å››ï¼Œå·²çŸ¥Cç´¢å¼•æ ‘ä¸Šçš„next-key lockèŒƒå›´æ˜¯ï¼ˆ5ï¼Œ15]ï¼Œç”±ä¸¤ä¸ªé—´éš™é”(5, 10), (10,15)å’Œä¸¤ä¸ªè¡Œé”c=10ï¼Œc=15æ„æˆã€‚<br><br>ä¸ºäº†éªŒè¯ï¼Œæˆ‘åœ¨8.0.19ç¯å¢ƒåšäº†æ–‡ä¸­sessionABCï¼Œç»“æœç›¸åŒã€‚å¦å¤–æ·»åŠ äº†ä¸¤ä¸ªä¾‹å­<br>sessionDï¼šupdate t set d=d+1 where id=10ï¼›<br>blocked<br>çœ‹èµ·æ¥æ»¡è¶³c=10æ¡ä»¶çš„è¡Œ(10,10,10)è¢«é”ä½äº†ã€‚<br><br>sessionEï¼šupdate t set d=d+1 where id=15ï¼›<br>æ‰§è¡ŒæˆåŠŸï¼Œçœ‹èµ·æ¥æ²¡æœ‰é”ä½æ»¡è¶³c=15æ¡ä»¶çš„è¡Œï¼š(15,15,15)ã€‚<br><br>é‚£å›è¿‡å¤´æ¥ï¼Œæ ¹æ®éå”¯ä¸€ç´¢å¼•æ ‘ä¸Šçš„next-key locké›†åˆAï¼Œå¦‚ä½•é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„è®°å½•è¡Œå‘¢ï¼Œè¿˜æ˜¯è¯´ç»„å»ºç´¢å¼•ä¸Šä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªnext-key locké›†åˆã€‚<br>","like_count":0,"discussions":[{"author":{"id":1303914,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e5/6a/3c618346.jpg","nickname":"äºŒæ¡ƒæ€ä¸‰å£«","note":"","ucode":"5D7CAB540B0DF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297572,"discussion_content":"è¡¥å……ä¸€ç‚¹ï¼Œå°† c æ¢ä¸º idï¼Œé‚£ä¾æ®è§„åˆ™ï¼Œid=15 è¿™ä¸€è¡Œçš„è¡Œé”å°±å¿…é¡»è¦åŠ äº†ï¼Œä»£ç å®ç°ä¸Šæ˜¯è¿™æ ·å­çš„ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596973339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303914,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e5/6a/3c618346.jpg","nickname":"äºŒæ¡ƒæ€ä¸‰å£«","note":"","ucode":"5D7CAB540B0DF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297564,"discussion_content":"æœ‰ä½@åŒåŒçš„è€å“¥æäº†ä¸ªé—®é¢˜ï¼Œæˆ‘å…ˆå¤åˆ¶ä¸‹ï¼š\n\n-----------\næ¡ˆä¾‹å››ï¼šselect * from t where c>=10 and c<11 for update;\nç´¢å¼•cä¸Šæœ‰ä¸¤ä¸ªnext-key lock,(5,10]å’Œ(10,15]ã€‚é‚£ç”±äºfor updateä¼šç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ï¼Œè¿™ä¸ªæ»¡è¶³æ¡ä»¶çš„è¡Œæ˜¯id=10è¿™ä¸€è¡Œå§ï¼Ÿæ»¡è¶³æ¡ä»¶æ˜¯æŒ‡æŸ¥è¯¢ç»“æœä¹ˆï¼Ÿ\n\nä½œè€…å›å¤: åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœè¯´â€œè®°å½•ä¸Šçš„é”â€ï¼Œç´¢å¼•cä¸Šæœ‰c=10å’Œc=15ï¼Œ ä¸»é”®ä¸Šæœ‰id=10ã€‚\n\nä¸æ˜¯æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯ â€œæŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„è¡Œå’Œé—´éš™â€\n-----------\n\n\né‚£è¿™ä¹ˆè¯´çš„è¯ï¼Œä½œè€…çš„æ„æ€æ˜¯ æŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„è¡Œå’Œé—´éš™ï¼Œè®¿é—® c ç´¢å¼•æ ‘ï¼Œè®¿é—®åˆ°äº† 10ã€15ï¼Œä½† id=15 è®¿é—®åˆ°äº†å—ï¼Ÿæ²¡æœ‰ã€‚åœ¨ã€Š é«˜æ€§èƒ½MySQLã€‹ç¬¬ä¸‰ç‰ˆ p181 è¯´äº† InnoDB åªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”ï¼Œè€å¸ˆåˆè¡¥å……äº†ä¸‹è¯´æ˜¯â€œæŸ¥è¯¢è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„è¡Œå’Œé—´éš™â€ã€‚\n\næˆ‘ä»¬çœ‹ä¸‹ ä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚è¿™é‡Œæˆ‘æ”¹ä¸€ä¸‹æè¿°å‡ºæ¥ï¼Œä½ çœ‹æ˜¯å¦æ­£ç¡®ï¼šâ€œç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³èŒƒå›´æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock ä¸ä¼šé€€åŒ–ä¸ºé—´éš™é”â€ã€‚\n\né‚£ä¹ˆå°±è¯´æ˜è¦åŠ  (10,15] next-key lock æ˜¯æ²¡æœ‰å¼‚è®®çš„ï¼Œéšè—æ¡ä»¶æ˜¯ c=15 è¿™ä¸€è¡Œæ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ï¼Œåªè®¿é—®åˆ°äº†äºŒçº§ç´¢å¼• c=15 è¿™ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±è¿‡æ»¤æ‰äº†ï¼Œä¸ä¼šç»™ id=15 è¿™ä¸€è¡ŒåŠ ä¸Šè¡Œé”ï¼Œå› ä¸ºä¸ä¼šè®¿é—®åˆ°çš„ï¼Œè€Œ id=10 ä¼šä¸ä¼šè¢«è®¿é—®åˆ°åŠ ä¸Šè¡Œé”å‘¢ï¼Ÿä¼šçš„ã€‚ä»¥ä¸Šæ˜¯æˆ‘çš„ç†è§£ï¼Œæœ‰ä¸å¯¹ä¹‹å¤„å¯ä»¥æŒ‡å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596971112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211840,"user_name":"ä¹˜é£","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1588029103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588029103","product_id":100020801,"comment_content":"å†åŠ ä¸€ä¸ªbug2 ï¼š å¯¹äº&lt;=çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¼šå‡çº§ä¸ºNKLï¼Œå¹¶ä¸”åŒ…å«å³ä¾§æœ€åä¸€ä¸ªå€¼ä¸”ä¸åŒ…å«å·¦ä¾§æœ€åä¸€ä¸ªå€¼ï¼Œå‚è€ƒæ¡ˆä¾‹5","like_count":0},{"had_liked":false,"id":211475,"user_name":"ä¹˜é£","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1587969542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587969542","product_id":100020801,"comment_content":"éº»çƒ¦é—®ä¸‹ insertåŠ äº†ä»€ä¹ˆé”?","like_count":0},{"had_liked":false,"id":211399,"user_name":"æ¨æˆ˜æ³¢","can_delete":false,"product_type":"c1","uid":1649157,"ip_address":"","ucode":"6C8395A5942828","user_header":"","comment_is_top":false,"comment_ctime":1587957858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587957858","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜éœ€è¦è¯·æ•™ä¸€ä¸‹ï¼Œoracle æ•°æ®åº“ï¼Œå¤§æ‰¹é‡æ’å…¥æ•°æ®æ—¶ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°æŸä¸ªå­—æ®µä¸ºç©ºçš„æƒ…å†µï¼ˆæœ¬åº”è¯¥æœ‰å€¼çš„ï¼‰ï¼Œè€å¸ˆè§‰å¾—æœ‰å¯èƒ½æœ‰ä»€ä¹ˆåŸå› å¼•èµ·å‘¢","like_count":0},{"had_liked":false,"id":211327,"user_name":"ä¹˜é£","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1587949091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587949091","product_id":100020801,"comment_content":"æœ‰äº›æ—¶å€™å¯ä»¥é”å®šè®°å½•æœ¬èº«,æœ‰äº›æ—¶å€™ä¸ä¼šé”å®šè®°å½•æœ¬èº«,å¦‚rlä¼šé”å®šè®°å½•æœ¬èº«,è€Œgapåªä¼šé”å®šèŒƒå›´é¿å…æ’å…¥,ä½†gapå†…ä»å¯ä»¥æ›´æ–°,è¿™å¦‚ä½•ç†è§£?","like_count":0},{"had_liked":false,"id":211078,"user_name":"bb","can_delete":false,"product_type":"c1","uid":1770466,"ip_address":"","ucode":"9E480BA11D4D89","user_header":"","comment_is_top":false,"comment_ctime":1587891708,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1587891708","product_id":100020801,"comment_content":"ä¸ç®¡åœ¨ä¸åœ¨è¿™ä¸ªåŒºé—´éƒ½å†™ä¸äº†","like_count":0,"discussions":[{"author":{"id":1770466,"avatar":"","nickname":"bb","note":"","ucode":"9E480BA11D4D89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248790,"discussion_content":"æ€ä¹ˆc>10ä¼šå…¨éƒ¨æ‰«æï¼Œæ˜¯ä¸æ˜¯å› ä¸ºå…¨è¡¨æ‰«æå¯¼è‡´éƒ½é”äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587896450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1770466,"avatar":"","nickname":"bb","note":"","ucode":"9E480BA11D4D89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248763,"discussion_content":"cæ˜¯è¦ç´¢å¼•çš„ç°åœ¨æ˜¯ï¼Œ10åˆ°æ— ç©·å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587893937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1770466,"avatar":"","nickname":"bb","note":"","ucode":"9E480BA11D4D89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":248760,"discussion_content":"ä¸ºä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587893820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211069,"user_name":"bb","can_delete":false,"product_type":"c1","uid":1770466,"ip_address":"","ucode":"9E480BA11D4D89","user_header":"","comment_is_top":false,"comment_ctime":1587890989,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587890989","product_id":100020801,"comment_content":"æ¥ä¸Šé¢é—®é¢˜æˆ‘æ˜¯select * from t where c &gt; 10 for update   MySQL5.7.22","like_count":0},{"had_liked":false,"id":211066,"user_name":"bb","can_delete":false,"product_type":"c1","uid":1770466,"ip_address":"","ucode":"9E480BA11D4D89","user_header":"","comment_is_top":false,"comment_ctime":1587890471,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587890471","product_id":100020801,"comment_content":"æ¡ˆä¾‹4ï¼Œæ‚¨æ˜¯è¯´(5,10ã€‘(10,15ã€‘ä½†æ˜¯æˆ‘çš„ç¯å¢ƒåšï¼Œå†™å…¥å°ä½™5æ¯”å¦‚(3,3,3)ä¹Ÿæœ‰é”ã€‚è¯·é—®æ˜¯æˆ‘é‚£é‡Œé”™äº†å—","like_count":0},{"had_liked":false,"id":207175,"user_name":"Tarn","can_delete":false,"product_type":"c1","uid":1112416,"ip_address":"","ucode":"A2717CB81DF84B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/60/8e0f0f17.jpg","comment_is_top":false,"comment_ctime":1587020643,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587020643","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºè¿™ä¸€èŠ‚è¯¾æœ‰ä¸€ç‚¹ç–‘é—®ï¼Œå¦‚æœæ¡ä»¶è¯­å¥æ˜¯where d = xxx çš„è¯ï¼Œç”±äºdä¸Šæœ¬èº«æ˜¯æ²¡æœ‰ç´¢å¼•çš„ï¼Œä½†æ˜¯æ ¹æ®è€å¸ˆè¯´çš„é”ä¸€å®šæ˜¯åŠ åœ¨ç´¢å¼•ä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶æ˜¯ä¸æ˜¯ä¼šèµ°ä¸»é”®ç´¢å¼•ï¼Ÿå¦‚æœèµ°ä¸»é”®ç´¢å¼•çš„è¯ï¼Œç”±äºç´¢å¼•ç»“æ„ï¼Œdå­—æ®µå¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶æ˜¯å¦‚ä½•åŠ çš„é—´éš™é”å‘¢ï¼Ÿå¦ä¸€ç§æƒ…å†µï¼Œå¦‚æœä¸€ä¸ªè¡¨ä¸­æ²¡æœ‰ä»»ä½•ç´¢å¼•ï¼Œé‚£ä¹ˆè¿˜èƒ½åŠ next key lockå—ï¼Ÿæ±‚è€å¸ˆè§£ç­”ä¸€ä¸‹å“ˆ","like_count":0},{"had_liked":false,"id":204663,"user_name":"å°è·³è›™","can_delete":false,"product_type":"c1","uid":1210505,"ip_address":"","ucode":"6C4DADD8414F9D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLUz2nCCzSKibFJibtoAJXo2lP3tmeRUe2EqmQr4kYbCv5q4eexhfN3XicynSx5uZ5EREumRwZxqHjGw/132","comment_is_top":false,"comment_ctime":1586439020,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586439020","product_id":100020801,"comment_content":"åœ¨ä¸šåŠ¡ä¸­è€ƒè™‘å¹¶å‘æ˜¯ä¸æ˜¯åº”è¯¥æŠŠæ¶‰åŠä¸€ä¸ªè¡¨çš„ç›¸å…³sql ç½—åˆ—å‡ºæ¥  ç„¶åçœ‹å„ä¸ªsql æ•°æ®çš„å…³ç³»ï¼Œæƒ³è±¡å¹¶å‘æ‰§è¡Œæ ¹æ®é”çŸ¥è¯†è¿›è¡Œsqlæ¶‰åŠå’Œä¼˜åŒ–ï¼Ÿ","like_count":0},{"had_liked":false,"id":192163,"user_name":"è°¢å°Šé”¦","can_delete":false,"product_type":"c1","uid":1627400,"ip_address":"","ucode":"C1A1050768ED48","user_header":"https://static001.geekbang.org/account/avatar/00/18/d5/08/1e35bb4d.jpg","comment_is_top":false,"comment_ctime":1584841588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584841588","product_id":100020801,"comment_content":"æ›´æ–°ä¸€è¡Œæ•°æ®è€Œå·²ï¼Œä¸ºä»€ä¹ˆè¦é”é‚£ä¹ˆå¤šå‘¢","like_count":0},{"had_liked":false,"id":190160,"user_name":"å¤å…´","can_delete":false,"product_type":"c1","uid":1363230,"ip_address":"","ucode":"C172A87873001A","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/1e/692c3313.jpg","comment_is_top":false,"comment_ctime":1584608279,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1584608279","product_id":100020801,"comment_content":"æ„Ÿè§‰é”éƒ½æ˜¯ç”±è¿™ä¸¤ä¸ªè€Œèµ·ï¼šfor update å’Œ lock in share modeï¼Œä¸€ç›´æƒ³ä¸æ˜ç™½ï¼Œå…·ä½“ä»€ä¹ˆä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦æ‰‹åŠ¨åŠ è¿™ä¸¤ä¸ªé”ï¼Œåæ­£æˆ‘æ²¡æœ‰åŠ è¿‡ã€‚","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545229,"discussion_content":"éœ€è¦å½“å‰è¯»ï¼Œè€Œä¸æ˜¯å¿«ç…§è¯»æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641880323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210505,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLUz2nCCzSKibFJibtoAJXo2lP3tmeRUe2EqmQr4kYbCv5q4eexhfN3XicynSx5uZ5EREumRwZxqHjGw/132","nickname":"å°è·³è›™","note":"","ucode":"6C4DADD8414F9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226665,"discussion_content":"å¯¹ï¼Œæœ€é‡è¦æ˜¯çŸ¥é“åŸç†ç„¶åæ€ä¹ˆåº”ç”¨åˆ°å¼€å‘ä¸­è®©ç¨‹åºæ“ä½œæ•°æ®åº“åˆå¯¹åˆå¿«\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586438726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185976,"user_name":"feixuefubing","can_delete":false,"product_type":"c1","uid":1252730,"ip_address":"","ucode":"5F139C180BC186","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlllSKrpQkhc9qLgtu4I4jc2FO9BJAbfgwz7meGCZqlmWsV3GfjqTecqpkTJMYpunxhKHSdc9gpQ/132","comment_is_top":false,"comment_ctime":1583735724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583735724","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘ä¸çŸ¥é“è¿™ç®—ä¸ç®—æ˜¯ä¸€ç§bad caseï¼Œéº»çƒ¦æ‚¨ç»™çœ‹çœ‹ï¼š<br>é¦–å…ˆæˆ‘æŠŠæ‚¨åœ¨21ç¯‡ç»™å‡ºçš„å»ºè¡¨è¯­å¥ï¼Œidæ”¹ä¸ºäº†è‡ªå¢ä¸»é”®ï¼Œå› ä¸ºè¿™æ ·æ›´ç¬¦åˆæˆ‘å…¬å¸å®è·µä¸­çš„æƒ…å†µã€‚<br>(1,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25)<br>select max(id) from t = 25<br>-----------------------------------------------------------------------------------------<br>sessionA <br>begin;<br>select * from t where id&lt;=(select max(id) from t) order by id desc limit 1 for update;<br><br>sessionB<br>begin;<br>select * from t where id&lt;=(select max(id) from t) order by id desc limit 1 for update;<br>(blocked)<br><br>sessionA <br>insert into t values(null,30,30)<br>(deadlock)<br>-----------------------------------------------------------------------------------------<br>æŒ‰ç…§å¯¹æ‚¨æå‡ºçš„åŠ é”åŸåˆ™ç†è§£ï¼Œç”±äºselect... for updateä¸­æŒ‡å®šdescæ’åºï¼Œåˆ™è¯¥ä¸»é”®èŒƒå›´æŸ¥è¯¢ç”±id=25çš„ç­‰å€¼æŸ¥è¯¢å…¥æ‰‹ï¼ŒæŒ‰ä¼˜åŒ–1é€€åŒ–ä¸ºid=25çš„è¡Œé”ï¼Œç„¶åå‘å·¦æ‰«æï¼ŒæŒ‰åŸåˆ™1ã€2åŠ é”ï¼›<br>æ‰€ä»¥ï¼Œsession A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé” id=25 å’Œ next-key lock(-âˆ,20]ï¼Œè€Œæ²¡æœ‰(25,supremum)ã€‚<br>ä¹‹åsession Bæ‰§è¡Œselect... for updateï¼Œç”±äºè¡Œé” id=25è¢«session AæŒæœ‰è€Œé˜»å¡ï¼›<br>æœ€åä¸€æ­¥æˆ‘çš„å‡è®¾ï¼šsession Aæ‰§è¡Œè‡ªå¢ä¸»é”®çš„æ’å…¥è¯­å¥ï¼Œåˆ¤æ–­(25,supremum)æ— gapé”ï¼Œæ•…æˆåŠŸè·å–æ’å…¥æ„å‘é”ï¼ŒæˆåŠŸæ’å…¥ï¼›<br>ä½†å®é™…ä¸Šsession Aæ‰§è¡Œæ’å…¥è¯­å¥å´å‘ç”Ÿäº†æ­»é”ï¼Œshow engine innodb statusæ˜¾ç¤º(25,supremum)é€ æˆé”å†²çªã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ<br>å¦‚æœæŠŠåœºæ™¯ä¸­çš„select... for updateæ›¿æ¢ä¸ºç®€å•çš„select * from t where id=(select max(id) from t) for update;åˆ™session Aèƒ½å¤Ÿæ’å…¥æˆåŠŸã€‚è€ŒsessionBé˜»å¡ç»“æŸï¼ˆsession A commitï¼‰æŸ¥åˆ°çš„æ˜¯id=25ï¼Œè¿™æˆ‘èƒ½å¤Ÿç†è§£æ˜¯å­æŸ¥è¯¢çš„å¿«ç…§è¯»å¯¼è‡´ã€‚<br>ä»¤æˆ‘æ„Ÿåˆ°å›°æƒ‘çš„æ˜¯ï¼Œorder by xx descè¯­å¥ä¸€å®šä¼šå¯¼è‡´å‘å·¦æ‰«æå—ï¼Ÿå‘å·¦æ‰«ææˆ‘æ„Ÿè§‰ç†è§£ä¸Šä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šã€‚","like_count":0},{"had_liked":false,"id":184733,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1276373,"ip_address":"","ucode":"016F1DEBA895B8","user_header":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","comment_is_top":false,"comment_ctime":1583393016,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1583393016","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºæ¡ˆä¾‹äº”è¿™å¥è¯ï¼Œæœ‰äº›ç–‘é—®ï¼š<br>session A æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™ 1 çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼• id ä¸ŠåªåŠ  (10,15]è¿™ä¸ª next-key lock<br><br><br>æˆ‘çš„ç†è§£æ˜¯ï¼Œé’ˆå¯¹ Session A çš„ select è¯­å¥ï¼Œä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯” 10 çš„å€¼ï¼Œæ˜¯ 15 æ²¡é”™ã€‚å…ˆåŠ ä¸Š (10,15] next-keyï¼Œä½†æˆ‘è§‰å¾—æ‰¾åˆ° 15 çš„è¿‡ç¨‹å±äºç­‰å€¼æŸ¥è¯¢å•Šï¼Œè€Œä¸” id æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥åº”è¯¥é€€åŒ–æˆ id=15 çš„è¡Œé”ã€‚<br><br>æŒ‰ç…§è€å¸ˆçš„ç­”æ¡ˆ  (10,15]ï¼Œè¯´æ˜æ‰¾åˆ° 15 çš„è¿‡ç¨‹æ˜¯èŒƒå›´æŸ¥æ‰¾ï¼Œä¹Ÿå°±è¯´ç¬¬ä¸€æ¬¡æŸ¥æ‰¾ä¸ä¸€å®šéƒ½æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":182946,"user_name":"Bourne","can_delete":false,"product_type":"c1","uid":1311299,"ip_address":"","ucode":"1286279F70B13F","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/43/1c2fb7b3.jpg","comment_is_top":false,"comment_ctime":1582894602,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582894602","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®èƒ½å¦å¸®æˆ‘åˆ†æä¸ªæ­»é”çš„é—®é¢˜ï¼Œæˆ‘åˆ†æäº†å¥½ä¹…æ˜¯åœ¨æƒ³ä¸æ˜ç™½.....","like_count":0},{"had_liked":false,"id":182335,"user_name":"Zeke","can_delete":false,"product_type":"c1","uid":1117206,"ip_address":"","ucode":"312F5285BEFAEB","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/16/179e4fce.jpg","comment_is_top":false,"comment_ctime":1582769974,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1582769974","product_id":100020801,"comment_content":"å¦‚æœå­˜åœ¨å¤–å¥å‘¢ï¼Œæ˜¯ä¸æ˜¯å°±å¤šäº†é”å¤–å¥çš„æ“ä½œï¼Ÿ","like_count":0},{"had_liked":false,"id":181854,"user_name":"é£å¹æ ‘å¶æ²™æ²™æ²™","can_delete":false,"product_type":"c1","uid":1012502,"ip_address":"","ucode":"219F91A66F3DCC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/73/16/d22fbfbe.jpg","comment_is_top":false,"comment_ctime":1582645598,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582645598","product_id":100020801,"comment_content":"ä¸è€å¸ˆï¼Œæˆ‘æœ€è¿‘åœ¨å¤ä¹ åŠ é”æœºåˆ¶è¿™å—å„¿çš„å†…å®¹çš„æ—¶å€™å‘ç°ï¼Œâ€œä¸€ä¸ªbugâ€è¿™æ¡å¥½åƒå¯ä»¥æ‰©å±•åˆ°æ‰€æœ‰çš„äºŒçº§ç´¢å¼•ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¯¹çš„ï¼Œè¿˜è¯·æ‚¨æŒ‡æ•™ä¸‹ã€‚<br><br>æˆ‘åœ¨RUã€RCå’ŒRRçº§åˆ«ä¸‹åˆ†åˆ«åšäº†ä¸‹æµ‹è¯•ï¼Œç»“æœéƒ½å’Œå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢çš„åŠ é”æ•ˆæœä¸€è‡´ã€‚<br><br>æµ‹è¯•è¡¨å¦‚ä¸‹ï¼š<br>CREATE TABLE hero (<br>    number INT,<br>    name VARCHAR(100),<br>    country varchar(100),<br>    PRIMARY KEY (number),<br>    KEY idx_name (name)<br>) Engine=InnoDB CHARSET=utf8;<br><br>æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼š<br>INSERT INTO hero VALUES<br>    (1, &#39;låˆ˜å¤‡&#39;, &#39;èœ€&#39;),<br>    (3, &#39;zè¯¸è‘›äº®&#39;, &#39;èœ€&#39;),<br>    (8, &#39;cæ›¹æ“&#39;, &#39;é­&#39;),<br>    (15, &#39;xè€å½§&#39;, &#39;é­&#39;),<br>    (20, &#39;så­™æƒ&#39;, &#39;å´&#39;);<br><br>åœ¨äº‹åŠ¡ä¸€ä¸­å…ˆæ‰§è¡Œï¼š<br>SELECT * FROM hero FORCE INDEX(idx_name) WHERE name &lt;= &#39;cæ›¹æ“&#39; LOCK IN SHARE MODE;<br><br>ç„¶ååœ¨äº‹åŠ¡äºŒä¸­æ‰§è¡Œï¼š<br>SELECT * FROM hero WHERE name = &#39;låˆ˜å¤‡&#39; FOR UPDATE;<br><br>è¿™ä¸ªæ—¶å€™å¯ä»¥è§‚å¯Ÿåˆ°äº‹åŠ¡äºŒè¢«é˜»å¡ã€‚","like_count":0},{"had_liked":false,"id":181444,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1582541916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582541916","product_id":100020801,"comment_content":"çœ‹å®Œä¸€éï¼Œäº‘é‡Œé›¾é‡Œï¼Œå°±å½“æœ‰ä¸ªå°è±¡ï¼Œä»¥åå†ç¢°è§åŠ é”çš„é—®é¢˜æ—¶ï¼Œæˆ‘å°±ä¼šé¦–å…ˆæƒ³åˆ°è€å¸ˆçš„è¿™ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡åˆ°æ—¶å€™çœ‹ä¼šæ›´åŠ æ·±æœ‰ä½“ä¼šã€‚","like_count":0},{"had_liked":false,"id":178360,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1581669056,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581669056","product_id":100020801,"comment_content":"è€å¸ˆï¼Œmysqlçš„bugè§£å†³äº†  æˆ‘çš„ç‰ˆæœ¬æ˜¯8.0.19","like_count":0},{"had_liked":false,"id":172674,"user_name":"æœªæ¥æ€æ ·","can_delete":false,"product_type":"c1","uid":1652085,"ip_address":"","ucode":"4E54EB62595B27","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKORTofsU89GYKtywquzKuEiabvZnEOonfMYKuCPlo8GDlXqZuJdBicu0XtlaeodH4BnmHV1kldSAwQ/132","comment_is_top":false,"comment_ctime":1579249594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579249594","product_id":100020801,"comment_content":"é†é†çŒé¡¶ï¼å¤ªå‰å®³äº†è€å¸ˆï¼","like_count":0},{"had_liked":false,"id":171212,"user_name":"æ¯›ç«‹å‡¡","can_delete":false,"product_type":"c1","uid":1067251,"ip_address":"","ucode":"7B3BD84187D39D","user_header":"https://static001.geekbang.org/account/avatar/00/10/48/f3/e7f9a26b.jpg","comment_is_top":false,"comment_ctime":1578882264,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578882264","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œç¿»äº†ç•™è¨€å¥½åƒæ²¡æœ‰äººé—®ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼š<br><br>æ¡ˆä¾‹å…­ä¸­ï¼š<br>Session Açš„ç¬¬äºŒæ­¥â€œé€€åŒ–æˆ (c=10,id=10) åˆ° (c=15,id=15) çš„é—´éš™é”â€ï¼Œè¿™ä¸€æ­¥ç©¶ç«Ÿæ˜¯<br>(c=10,id=10) åˆ° (c=10,id=30) çš„next-key lock + (c=10,id=30) åˆ° (c=15,id=15) çš„é—´éš™é”  è¿™ä¸¤ä¸ªé”çš„åˆå¹¶<br>è¿˜æ˜¯<br>ç›´æ¥å•ä¸ª (c=10,id=10) åˆ° (c=15,id=15) çš„é—´éš™é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164209,"discussion_content":"(c=10,id=10) åˆ° (c=10,id=30) çš„next-key lock + (c=10,id=30) åˆ° (c=15,id=15) çš„é—´éš™é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581163123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167574,"user_name":"æ± æ·±å¯","can_delete":false,"product_type":"c1","uid":1271967,"ip_address":"","ucode":"0FEF5B4E7E54E1","user_header":"https://static001.geekbang.org/account/avatar/00/13/68/9f/f85305ac.jpg","comment_is_top":false,"comment_ctime":1577864469,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577864469","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæ‰“æ‰°ä½ äº† æˆ‘å¯¹next-keyä¸¤æ­¥åŠ é”å­˜åœ¨ç‚¹é—®é¢˜   ä¹‹å‰è‡ªå·±ä¸šåŠ¡åœºæ™¯å‘ç”Ÿäº†å¦‚ä¸‹çš„æ­»é”é—®é¢˜ ä½†æ˜¯æˆ‘çœ‹äº†æ‚¨çš„æ–‡ç« ä¹‹åè¿˜æ˜¯æœ‰ç‚¹è§£é‡Šä¸é€šæˆ‘çš„caseï¼Œå¯èƒ½è‡ªå·±ç†è§£å¥½æœ‰ç‚¹é—®é¢˜ã€‚<br>RRæ¨¡å¼ä¸‹<br>CREATE TABLE t (<br>id int(11) NOT NULL,<br>c int(11) DEFAULT NULL,<br>d int(11) DEFAULT NULL,<br>PRIMARY KEY (id),<br>KEY c (c)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br><br>insert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);<br><br>æ‰§è¡Œé¡ºåº<br>session 1<br>insert t values (9,9,9)[è·å–IX]<br>session 2<br>update t set d=9 where c=9 [ç»™session1 ä¸ŠXé”ï¼ŒåŒæ—¶è‡ªå·±éœ€è¦è·å–next-key,é—´éš™é”è·å–æˆåŠŸï¼Œä½†æ˜¯Xé”è·å–å¤±è´¥è¿›å…¥é”ç­‰å¾…]<br>session 1<br>update t set d=9 where c=9[éœ€è¦è·å–next-key,é—´éš™é”ä¹‹é—´ä¸å†²çªï¼Œé—´éš™é”è·å–æˆåŠŸï¼Œä½†æ˜¯Xé”è·å–å¤±è´¥è¿›å…¥é”ç­‰å¾…]<br>æŠ¥å‘ç”Ÿæ­»é” session2å›æ»š<br>ç–‘é—®<br>æ˜æ˜sessionå·²ç»æœ‰Xé”äº† ä¸ºä»€ä¹ˆsession1çš„ updateè¿˜ä¼šç­‰å¾…Xé”é€ æˆæ­»é”<br><br>æ­»é”æ—¥å¿—ä¸­ä¹Ÿæ˜¾ç¤º session1 å·²ç»æ‹¥æœ‰Xé”(lock_mode x locks but not gap)<br>ä½†æ˜¯ç­‰å¾…next-key(lock_mode X) é—´éš™é”+Xé”<br>è¿™ç‚¹å¾ˆå¥‡æ€ª å› ä¸ºæŒ‰ç…§next-keyä¸¤æ­¥åŠ é”  session1çš„insertå·²ç»è·å¾—Xé” ç„¶åsession2çš„updateæ“ä½œè·å–next-keyçš„æ—¶å€™è·å–é—´éš™é”æˆåŠŸè·å–Xé”å¤±è´¥  æ¥ç€session1çš„update  è·å–é—´éš™é”æ²¡æœ‰å†²çªå¯ä»¥è·å¾— Xé”è®²é“ç†session1çš„äº‹ç‰©ä¹Ÿå·²ç»è·å¾—åº”è¯¥å¯ä»¥æˆåŠŸè·å¾—next-key ä¸ºä»€ä¹ˆè¿˜å­˜åœ¨è·å–next-keyéœ€è¦ç­‰å¾…session2 ","like_count":0},{"had_liked":false,"id":167162,"user_name":"é˜¿æœ","can_delete":false,"product_type":"c1","uid":1066705,"ip_address":"","ucode":"349D3572F5ABE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d1/a1ddf49f.jpg","comment_is_top":false,"comment_ctime":1577703131,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577703131","product_id":100020801,"comment_content":"æœ‰è®¿é—®å¯¹è±¡æ‰å¯èƒ½ä¼šåŠ next-key lockï¼›ç­‰å€¼æ—¶ï¼Œå”¯ä¸€ç´¢å¼•çš„é”é€€åŒ–ä¸ºè¡Œé”ï¼Œéå”¯ä¸€ç´¢å¼•çš„é”é€€åŒ–ä¸ºé—´éš™é”ï¼›èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œéœ€è¦è®¿é—®åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³çš„ã€‚","like_count":0},{"had_liked":false,"id":163323,"user_name":"ä¿¡æ¯æŠ€æœ¯éƒ¨","can_delete":false,"product_type":"c1","uid":1722174,"ip_address":"","ucode":"08BCF19EB1357F","user_header":"","comment_is_top":false,"comment_ctime":1576685554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576685554","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒæŒ‰ç…§undifinedåŒå­¦çš„åˆ†æï¼ŒäºŒçº§ç´¢å¼•æ ‘ä¸Šçš„æ’åºä¹Ÿä¼šé¡ºå¸¦è€ƒè™‘idçš„å€¼å—ï¼Ÿæ¯”å¦‚id=1,c=4ä¼šæ’åœ¨id=2,c=4çš„å‰é¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":161959,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1576415017,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1576415017","product_id":100020801,"comment_content":"æ–‡ç« å®éªŒäº†ä¸¤éï¼Œè¯„è®ºçœ‹äº†2ä¸ªå°æ—¶ï¼Œæ¯ä¸€ä¸ªé—®é¢˜éƒ½å»æŒ‰ç…§è‡ªå·±å­¦ä¹ åˆ°äº†å®éªŒéªŒè¯ä¸€ä¸‹ï¼Œæ„Ÿè§‰ç†è§£é€šäº†ï¼Œ<br>èˆ’æœ","like_count":0},{"had_liked":false,"id":160896,"user_name":"Luke","can_delete":false,"product_type":"c1","uid":1590953,"ip_address":"","ucode":"2C8A1FAB8B6301","user_header":"https://static001.geekbang.org/account/avatar/00/18/46/a9/70fa676f.jpg","comment_is_top":false,"comment_ctime":1576056086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576056086","product_id":100020801,"comment_content":"å…³äºæ–‡ä¸­æ­»é”ç¤ºä¾‹æ­»é”åŸå› è¯´æ³•æœ‰ä¸ä¸€æ ·çš„æ„è§ï¼ŒNext-keyé”æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•´ä½“ï¼ŒåŠ é”æ—¶æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡ŒåŠ é”ï¼Œå¹¶éå…ˆåŠ GAPç„¶åå†åŠ è®°å½•é”ï¼Œç¤ºä¾‹ä¸­æ­»é”çš„åŸå› æ˜¯ï¼šäº‹åŠ¡2çš„æ›´æ–°ï¼Œç”³è¯·ç´¢å¼•cè®°å½•10ä¸Šçš„Next-keyé”ï¼ˆLOCK_X | LOCK_ORDINARY|LOCK_RECï¼‰éœ€è¦ç­‰å¾…äº‹åŠ¡1åœ¨ç´¢å¼•cè®°å½•10ä¸Šçš„Next-keyé”ï¼ˆLOCK_S | LOCK_ORDINARY | LOCK_RECï¼‰ï¼Œè€Œä¹‹åäº‹åŠ¡1çš„insertéœ€è¦ç”³è¯·æ’å…¥æ„å‘é”ï¼ˆLOCK_X | LOCK_GAP | LOCK_INSERT_INTENTIONï¼‰,ä¸äº‹åŠ¡2ç”³è¯·çš„é”æ˜¯å†²çªçš„ï¼Œéœ€è¦ç­‰å¾…äº‹åŠ¡2ï¼Œäº‹åŠ¡2è™½ç„¶ä¹Ÿåœ¨ç­‰å¾…ï¼ˆåœ¨æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—å‰è¿˜ä¼šåœ¨åŸæœ‰çš„é”æ¨¡å¼æ‰“ä¸ŠLOCK_WAITæ ‡è®°ï¼Œè¡¨æ˜è¯¥é”æ²¡æœ‰æˆäºˆï¼‰ï¼Œä½†æ˜¯åœ¨é”é˜Ÿåˆ—ä¸­åœ¨äº‹åŠ¡1ç”³è¯·çš„æ’å…¥æ„å‘é”ä¹‹å‰ï¼Œå› æ­¤åˆ¤æ–­æ­»é”å‘ç”Ÿ","like_count":0},{"had_liked":false,"id":159413,"user_name":"looper","can_delete":false,"product_type":"c1","uid":1238396,"ip_address":"","ucode":"DA4BCE83836C04","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/7c/2a5a418b.jpg","comment_is_top":false,"comment_ctime":1575617462,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575617462","product_id":100020801,"comment_content":"ä¸“æ çœ‹åˆ°ç°åœ¨æ”¶è·å¾ˆå¤§ï¼Œæœ‰äº›çŸ¥è¯†ç‚¹è™½ç„¶æ‡µæ‡µæ‡‚æ‡‚ï¼Œä½†æ˜¯æ€»ç®—æœ‰äº†å¯¹mysqlé”çš„æ•´ä½“è®¤çŸ¥ï¼Œæ„Ÿè°¢è€å¸ˆï¼","like_count":0},{"had_liked":false,"id":159102,"user_name":"èåœæ¡","can_delete":false,"product_type":"c1","uid":1692713,"ip_address":"","ucode":"4BC975BBFE50A7","user_header":"https://static001.geekbang.org/account/avatar/00/19/d4/29/5f52a82c.jpg","comment_is_top":false,"comment_ctime":1575538370,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575538370","product_id":100020801,"comment_content":"æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”<br>mysql8<br>æ’å…¥æ•°æ®æ—¶ï¼Œçœ‹é—´éš™é”ç¡®å®æ˜¯10-15<br>ä½†æ˜¯updateåªid=10é˜»å¡ï¼Œå›¾ç¤ºå¹¶ä¸ä¼šé˜»å¡ã€‚","like_count":0},{"had_liked":false,"id":158553,"user_name":"å©‰çº¦çš„å†°è¥¿ç“œ","can_delete":false,"product_type":"c1","uid":1285478,"ip_address":"","ucode":"8BA2D933D1BE82","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erXgjPOkuSIIhkeWcIeAWO2FjLHjNdsAca4icjjZcfPMguSEdaUibkj123Ijr8c1j3yER6W0M6wKEmw/132","comment_is_top":false,"comment_ctime":1575418357,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1575418357","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œæœ¬æ–‡ä¸­çš„æ¡ˆä¾‹äºŒï¼ŒsessionAä¸­ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢è¯­å¥ä¹Ÿè¦åŠ é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164228,"discussion_content":"å¯èƒ½ç”¨æ¥æ›´æ¸…æ™°çš„è®²è§£é”çš„æœºåˆ¶å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581164230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153532,"user_name":"jian","can_delete":false,"product_type":"c1","uid":1185102,"ip_address":"","ucode":"21CDBBB8000F0C","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/4e/4636a81d.jpg","comment_is_top":false,"comment_ctime":1574254178,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574254178","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®æ¡ˆä¾‹å…­ä¸­ï¼Œsession Aæ‰§è¡Œâ€œdelete from t where c=10;â€ï¼Œä¸ºä»€ä¹ˆsession B æ‰§è¡Œâ€œinsert into t values(40,15,40);â€ã€‚ (c=5,id=50)æ˜¯åœ¨è¿™ä¸ªgapé‡Œï¼Ÿ æ³è¯·è§£ç­”ï¼Œè°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":152506,"user_name":"èœé¸¡ç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1308074,"ip_address":"","ucode":"F1DFEC2343FE25","user_header":"https://static001.geekbang.org/account/avatar/00/13/f5/aa/5d520017.jpg","comment_is_top":false,"comment_ctime":1574037680,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574037680","product_id":100020801,"comment_content":"æˆ‘è§‰å¾—é‚£ä¸ªbugä¸ç®—bugï¼Œå¦‚æœæŠŠid=15çš„é‚£ä¸€è¡Œidæ¢ä¸ºid=14ï¼Œé‚£ä¹ˆä»–ä¾¿åˆ©åˆ°14ï¼Œè¿˜ä¼šå‘åä¾¿åˆ©åˆ°20ï¼Œå› ä¸ºä»£ç å¹¶ä¸çŸ¥é“15æ˜¯å¦è¿™ä¸ªèŒƒå›´çš„æœ€åä¸€ä¸ªå€¼ï¼Œæˆ–è€…å› ä¸ºè€ƒè™‘åˆ°åˆ¤æ–­å”¯ä¸€ç´¢å¼•æ˜¯å¦æ˜¯èŒƒå›´æœ€åä¸€ä¸ªå€¼è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥æ²¡æœ‰åŠ è¿™ä¸ªåˆ¤æ–­ã€‚åªæ˜¯æˆ‘ä¸ªäººçš„æƒ³æ³•","like_count":0},{"had_liked":false,"id":147791,"user_name":"Chan","can_delete":false,"product_type":"c1","uid":1158920,"ip_address":"","ucode":"8A7151A7E3F5D1","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/08/49416831.jpg","comment_is_top":false,"comment_ctime":1572890028,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1572890028","product_id":100020801,"comment_content":"å½“æœ‰å¤šä¸ªwhereæ¡ä»¶æ—¶ï¼Œmysqlä¼šé€‰æ‹©å“ªä¸ªç´¢å¼•åŠ ä¸Šnext-key lockï¼ŒæŸ¥äº†ä¸€äº›èµ„æ–™å¯¹è¿™ä¸ªéƒ½æ²¡æœ‰è¯´æ˜ã€‚","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164230,"discussion_content":"innodbä¼šæ ¹æ®æ‰«æè¡Œæ•°æœ€å°‘çš„ç´¢å¼•æ¥é€‰æ‹©ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581164291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145023,"user_name":"ä»‹å€’éœ‰å­©å­","can_delete":false,"product_type":"c1","uid":1576446,"ip_address":"","ucode":"1E670FC070774C","user_header":"https://static001.geekbang.org/account/avatar/00/18/0d/fe/a7769bce.jpg","comment_is_top":false,"comment_ctime":1572163443,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1572163443","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ï¼š lock in share mode å’Œ for update è¿™ä¸¤ç§åŠ é”æ–¹å¼åœ¨æ•ˆæœä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«? åˆ†åˆ«é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿå› ä¸ºæˆ‘æ„Ÿè§‰ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç»™è®¿é—®åˆ°çš„å¯¹è±¡åŠ ä¸Šäº†next -key lock, è™½ç„¶å‰è€…æ˜¯è¯»é”ï¼Œåè€…æ˜¯å†™é”ï¼Œä½†æ˜¯æ„Ÿè§‰å®é™…æ•ˆæœåŒºåˆ«ä¸å¤§ï¼Œè²Œä¼¼éƒ½æ˜¯å…¶å®ƒäº‹åŠ¡å¯ä»¥è¯»ï¼Œä½†æ˜¯ä¸å¯ä»¥å†™ã€‚","like_count":0,"discussions":[{"author":{"id":2697700,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","nickname":"é”®ç›˜ä¸Šçš„é­”æœ¯","note":"","ucode":"A731D721FB8D3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545230,"discussion_content":"äº‹ç‰©1å¯¹æŸä¸€è¡ŒåŠ äº†sé”ï¼Œ äº‹ç‰©2å¯ä»¥ç»§ç»­å¯¹è¿™è¡ŒåŠ sé”ï¼Œ ä½†ä¸èƒ½åŠ xé”ã€‚ å¦‚æœäº‹ç‰©1æŸè¡ŒåŠ äº†xé”ï¼Œé‚£ä¹ˆäº‹ç‰©2ï¼Œxé”å’Œsé”éƒ½ä¸èƒ½åŠ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641880888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164231,"discussion_content":"lock in share modeè¯»é”\nfor updateå†™é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581164325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144618,"user_name":"Jayden ç‹å‡¯è±ª","can_delete":false,"product_type":"c1","uid":1592236,"ip_address":"","ucode":"6CAADB9B449892","user_header":"https://static001.geekbang.org/account/avatar/00/18/4b/ac/2a48928f.jpg","comment_is_top":false,"comment_ctime":1571981755,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571981755","product_id":100020801,"comment_content":"è€å¸ˆ ç°åœ¨MySQLç‰ˆæœ¬å·²ç»æ˜¯8.0.18äº†ï¼Œè¯·é—®bugè§£å†³äº†å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83052,"discussion_content":"è¯•ä¸€ä¸‹å°±çŸ¥é“äº†å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576413468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144295,"user_name":"ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1310187,"ip_address":"","ucode":"CA69A069D3061D","user_header":"","comment_is_top":false,"comment_ctime":1571889355,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1571889355","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘çš„ä¸å µå¡å‘¢ï¼Ÿ<br>mysql&gt; select version();<br>+---------------+<br>| version()     |<br>+---------------+<br>| 5.7.27-30-log |<br>+---------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; show variables like &#39;tx_isolation&#39;;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| tx_isolation  | REPEATABLE-READ |<br>+---------------+-----------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>session A<br>mysql&gt; <br>mysql&gt; select * from t where c&gt;15 and c&lt;=20 order by c desc for update;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 20 |   20 |   20 |<br>+----+------+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; <br><br>ç„¶ååšsessionBï¼š<br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; insert into t values(6,6,6);<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; show variables like &#39;tx_isolation&#39;;<br>+---------------+-----------------+<br>| Variable_name | Value           |<br>+---------------+-----------------+<br>| tx_isolation  | REPEATABLE-READ |<br>+---------------+-----------------+<br>1 row in set (0.01 sec)<br><br><br>å±…ç„¶ä¸€ä¸‹æ•°æ®å°±æ’å…¥äº†ï¼Œå¹¶æ²¡æœ‰å µå¡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83071,"discussion_content":"æˆ‘äº²è‡ªå®éªŒäº†ä¸€ä¸‹ï¼Œ 5.7.27  ç‰ˆæœ¬ä¹Ÿæ˜¯é˜»å¡çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576414420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1487346,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b1/f2/3bcc1fad.jpg","nickname":"Caesar Yang","note":"","ucode":"359561CC3B04B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45365,"discussion_content":"æ–‡ç« å¼€å¤´è¯´äº†  åŠ é”è§„åˆ™åœ¨5.x-5.7.24ä¹‹å‰æœ‰æ•ˆ  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573028501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143959,"user_name":"äº‘é‡Œé›¾èŠ±","can_delete":false,"product_type":"c1","uid":1232383,"ip_address":"","ucode":"98D8E75D1B2B39","user_header":"https://static001.geekbang.org/account/avatar/00/12/cd/ff/b7690816.jpg","comment_is_top":false,"comment_ctime":1571814914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571814914","product_id":100020801,"comment_content":"åœ¨æ¡ˆä¾‹å››çš„æƒ…å†µä¸‹ï¼Œ<br>session1:<br>BEGIN;<br>select * from t where c&gt;=10 and c&lt;11 for update ;<br>åˆ†æåœ¨cçš„ç´¢å¼•é—´éš™é”åŒºé—´æ˜¯ï¼ˆ5,10],(10,15].<br>session2:<br>update t set d=d+1 where c =5;<br>å®éªŒæ’å…¥æ˜¯é˜»å¡çš„ã€‚è¿™é‡Œçš„cçš„å€¼æ˜¯5,åº”è¯¥æ˜¯ä¸é˜»å¡çš„ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ•°æ®åº“ç‰ˆæœ¬é—®é¢˜ï¼Œè¿˜æ˜¯æˆ‘ç†è§£æœ‰é—®é¢˜ã€‚<br>","like_count":0},{"had_liked":false,"id":139662,"user_name":"Lesson","can_delete":false,"product_type":"c1","uid":1181001,"ip_address":"","ucode":"117DEBAFC45BF4","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/49/c697b868.jpg","comment_is_top":false,"comment_ctime":1570700472,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1570700472","product_id":100020801,"comment_content":"è€å¸ˆ å¯ä»¥ä»‹ç»ä¸‹ Insertçš„æ—¶å€™ è·å–äº†ä»€ä¹ˆé”å˜›","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164236,"discussion_content":"è¡Œé”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581164478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136933,"user_name":"å˜‰å…´","can_delete":false,"product_type":"c1","uid":1554570,"ip_address":"","ucode":"6997E7A3E25EE4","user_header":"https://static001.geekbang.org/account/avatar/00/17/b8/8a/7367a69e.jpg","comment_is_top":false,"comment_ctime":1569555995,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569555995","product_id":100020801,"comment_content":"-- T1 äº‹åŠ¡A<br>begin;<br>select * from c20 where id&gt;=15 and id&lt;=20 order by id desc lock in share mode;<br><br>-- T2 äº‹åŠ¡B<br>begin;<br>update c20 set d=d+1 where id=25;\t-- OK<br>insert into c20 values(21,21,21);\t-- é˜»å¡<br><br>ä¸èƒ½ç†è§£, ä¸ºä»€ä¹ˆäº‹åŠ¡Aæ‰§è¡Œçš„è¯­å¥ä¼šç»™ é—´éš™(20,25) åŠ ä¸Šé”.<br>é€šè¿‡ show engine innodb status; æŸ¥çœ‹å‘ç°äº‹åŠ¡Aç¡®å®æŒæœ‰ä¸Šè¿°é—´éš™é”.<br>é€šè¿‡ explain select * from c20 where id&gt;=15 and id&lt;=20 order by id desc lock in share mode; æŸ¥çœ‹ Extra ä¹Ÿæ²¡æœ‰ filesort, key=PRIMARY, å› æ­¤ä¸ªäººè®¤ä¸ºæ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•å‘å·¦éå†å¾—åˆ°ç»“æœ.<br><br>æŒ‰ç…§æˆ‘çš„ç†è§£, ç”±äº `order by id desc` , å› æ­¤é¦–å…ˆæ˜¯åœ¨ä¸»é”®ç´¢å¼•ä¸Šæœç´¢ id=20, åŒæ—¶ç”±äºä¸»é”®ç´¢å¼•ä¸Šè¿™ä¸ªå€¼æ˜¯å”¯ä¸€çš„, å› æ­¤ä¸å¿…å‘å³éå†. ç„¶è€Œäº‹å®ä¸Šå®ƒç¡®å®è¿™ä¹ˆåšäº†, è¿™è®©æˆ‘æƒ³åˆ°äº† BUG1: ä¸»é”®ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šéå†åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ª.<br>ä½†æ˜¯è¿™ä¸€æ­¥çš„æœç´¢è¿‡ç¨‹åº”è¯¥æ˜¯ç­‰å€¼æŸ¥è¯¢æ‰å¯¹, å®Œå…¨ä¸€è„¸æ‡µä½äº†...<br>ä¸çŸ¥é“è€å¸ˆç°åœ¨è¿˜èƒ½çœ‹åˆ°è¿™æ¡è¯„è®ºä¸?","like_count":0},{"had_liked":false,"id":135459,"user_name":"å•†ç¿é€†","can_delete":false,"product_type":"c1","uid":1142674,"ip_address":"","ucode":"FA9522CEDA5635","user_header":"https://static001.geekbang.org/account/avatar/00/11/6f/92/535160b0.jpg","comment_is_top":false,"comment_ctime":1569168694,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569168694","product_id":100020801,"comment_content":"è€å¸ˆå¥½<br>æˆ‘å‘ç°å¯¹äºè§„åˆ™ä¸­è¯´çš„é‚£ä¸ªbugï¼Œå³ä½¿ä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå³æŠŠæ¡ˆä¾‹äº”é‡Œçš„æ¡ä»¶ä»idæ¢æˆcï¼Œsession Bå’ŒCä¹Ÿæ˜¯ä¸€æ ·è¢«blockçš„","like_count":0},{"had_liked":false,"id":131174,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1567660915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567660915","product_id":100020801,"comment_content":"ä¸è€å¸ˆå¥½!<br>å¦‚æœåœ¨RRçº§åˆ«ä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨ä¸»é”®å¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ˜¯ä¹ˆ?å¦‚æœé€šè¿‡å¤–é”®è¿›è¡Œæ›´æ–°ä¼šåŠ é—´éš™é”ï¼Œé—´éš™é”é”çš„å¤šå®¹æ˜“æ­»é”æ˜¯ä¹ˆ?","like_count":0},{"had_liked":false,"id":131172,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1567660693,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1567660693","product_id":100020801,"comment_content":"è€å¸ˆå¥½!æˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œç¬¬äºŒæ¡åŸåˆ™ç”¨åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚<br>å¦‚æœé€šè¿‡ä¸»é”®ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚å¯¹åº”çš„æ™®é€šç´¢å¼•ä¼šåŠ é”ä¹ˆ?","like_count":0,"discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9045,"discussion_content":"ä¸ä¼šï¼Œ1.ä¸»é”®ä¸Šæœ‰å…¨éƒ¨ä¿¡æ¯äº†ï¼Œæ²¡å¿…è¦å†å€’å›å»å¾€æ™®é€šç´¢å¼•ä¸ŠåŠ é”ï¼Œå¦åˆ™mysqlå°±å¤ªç¬¨äº†ã€‚ 2.æˆ‘åšäº†å®éªŒ...ï¼ˆ1ï¼‰SELECT * FROM t WHERE id>=15 AND id <=20 FOR UPDATEï¼›ï¼ˆ2ï¼‰SELECT c FROM t WHERE c = 15 LOCK IN SHARE MODE;...ç¬¬2ä¸ªSQLä¸ä¼šé˜»å¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568125770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9341,"discussion_content":"xè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568158050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":9045,"ip_address":""},"score":9341,"extra":""}]}]},{"had_liked":false,"id":131052,"user_name":"lzh","can_delete":false,"product_type":"c1","uid":1336951,"ip_address":"","ucode":"C3D83DF4230109","user_header":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","comment_is_top":false,"comment_ctime":1567610601,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567610601","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®é—®æ¡ˆä¾‹4ï¼š<br>mysql&gt; select * from t where c&gt;=10 and c&lt;11 for update;<br><br>å½“èŒƒå›´æŸ¥è¯¢æœ‰ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œé‚£ä¸Šé”éƒ½ç¬¦åˆè¿™èŠ‚è¯¾æ€»ç»“çš„è§„å¾‹<br><br>ä½†æ˜¯å»æ‰å…¶ä¸­ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚ï¼š<br>mysql&gt;begin;<br>mysql&gt; select * from t where c&gt;=10 for update; ï¼ˆOKï¼‰<br><br>mysqlæ€ä¹ˆå¥½åƒæŠŠcæ‰€æœ‰è¡Œéƒ½é”ä½äº†ï¼Ÿ<br>æˆ‘åœ¨å¦ä¸€ä¸ªSESSIONæ‰§è¡Œ<br>mysql&gt;begin;<br>mysql&gt;select c from t where c=0 for update;ï¼ˆé˜»å¡ï¼Œå³ä¾¿ç´¢å¼•è¦†ç›–ï¼‰<br><br>å¥½åƒ7æœˆä»½ä¹‹åè€å¸ˆæ²¡å›å¤è¿‡ä¸“æ äº†å•Š....éš¾é“åœæ›´äº†å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9040,"discussion_content":"è‡ªå·±æ‰¾å‡ºäº†ç­”æ¡ˆï¼ŒEXPLAINä¸€ä¸‹ï¼Œç¬¬1æ¡è¯­å¥ä½¿ç”¨äº†ç´¢å¼•ï¼Œç¬¬2æ¡è¯­å¥æœ‰ç´¢å¼•ä½†æ²¡ä½¿ç”¨ï¼Œèµ°äº†å…¨è¡¨æ‰«æã€‚ã€‚ã€‚å¯èƒ½æ•°æ®é‡å°çš„å•èŒƒå›´çš„æŸ¥è¯¢ï¼Œmysqlè§‰å¾—å…¨è¡¨æ‰«ææ¥çš„æ›´å¿«å§ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568125400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127108,"user_name":"é‚±æµ·æ¶›","can_delete":false,"product_type":"c1","uid":1442290,"ip_address":"","ucode":"87285FC6CE4566","user_header":"https://static001.geekbang.org/account/avatar/00/16/01/f2/ad48e316.jpg","comment_is_top":false,"comment_ctime":1566555942,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566555942","product_id":100020801,"comment_content":"ä¸€ä¸ªsessionæ‰§è¡Œselect * from t where c&gt;=10 and c&lt;=15 for update;æ ¹æ®åŠ é”è§„åˆ™æ¨æ–­å‡ºæ˜¯(5,10],(10,20)ã€‚ä½†å®é™…ä¸Šå¦ä¸€ä¸ªsessionæ‰§è¡Œdelete from t where c=20;ä¼šç­‰é”ï¼Œè¿™æ ·æ¥çœ‹å®é™…åŠ é”åŒºé—´æ˜¯(5,10],(10,20]ã€‚æ€ä¹ˆè§£é‡Šå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7677,"discussion_content":"æ˜¯(10,20]ï¼Œ20é‚£é‡Œæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼ŒNEXT KEY LOCK ä¸ä¼šé€€åŒ–æˆGAP LOCK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567608130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127100,"user_name":"é‚±æµ·æ¶›","can_delete":false,"product_type":"c1","uid":1442290,"ip_address":"","ucode":"87285FC6CE4566","user_header":"https://static001.geekbang.org/account/avatar/00/16/01/f2/ad48e316.jpg","comment_is_top":false,"comment_ctime":1566553484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566553484","product_id":100020801,"comment_content":"æ ¹æ®æ¡ˆä¾‹å››æœ€åä¸€å¥è¯æ¥çœ‹ï¼Œéå”¯ä¸€ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢ä¹Ÿä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚æ˜¯ä¸æ˜¯è¿™æ ·ï¼Œä¸ç„¶ä¸ºä»€ä¹ˆä¼šæœ‰(10,15]è¿™ä¸ªnext-key lockï¼Ÿ","like_count":0},{"had_liked":false,"id":127063,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1566547337,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566547337","product_id":100020801,"comment_content":"è¿™é‡Œæ˜¯å› ä¸ºå€’å™åœ¨éå†&lt;=20çš„æ¡ä»¶çš„æ—¶å€™ï¼Œä¸€ç›´ä¼šéå†åˆ°0è¿™ä¸ªå€¼æ‰€ä»¥åº”è¯¥ä¼šå¤šå‡ºä¸¤ä¸ªé—´éš™é”ï¼ˆ0ï¼Œ5ï¼‰ï¼Œï¼ˆ5ï¼Œ10ï¼‰å¯¼è‡´çš„å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":126913,"user_name":"å¢å±±","can_delete":false,"product_type":"c1","uid":1310244,"ip_address":"","ucode":"033EB9C7DEE4DA","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/24/1b5880e7.jpg","comment_is_top":false,"comment_ctime":1566520812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566520812","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹ï¼Œæ¡ˆä¾‹2ä¸­éä¸»é”®ç´¢å¼•å¯ä»¥æœ‰ä¼˜åŒ–ï¼Œä½†æ˜¯æ¡ˆä¾‹4ä¸­æåˆ°cæ˜¯éä¸»é”®ç´¢å¼•ï¼Œä¸ä¼šä¼˜åŒ–ï¼Œè¿™æ˜¯å› ä¸ºæ¡ˆä¾‹å››æ˜¯èŒƒå›´æŸ¥è¯¢çš„åŸå› ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":123806,"user_name":"ã€‚ã€‚ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1612570,"ip_address":"","ucode":"985B1561AC9152","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Xibh27ZicBhXls5KsPibBXZI4RKlR0MUbUiaEuOS2ORibKaxWSicpIjd4lvWUWqtNAde7EeDDTpWKAiapGdHeaiaDqczWQ/132","comment_is_top":false,"comment_ctime":1565764885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565764885","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºæ‚¨åœ¨â€œæ—¶éšæ—¶ç°â€ç•™è¨€ä¸­è¯´çš„é‚£ä¸ªupdateä¼˜åŒ–ç­–ç•¥ï¼Œæˆ‘ç”¨mysql 8.0.13è¯•äº†ä¸‹ï¼Œupdateå’Œdeleteéƒ½ä¼šè¢«é˜»å¡ï¼Œæ²¡æœ‰ç”¨åˆ°updateä¼˜åŒ–ç­–ç•¥","like_count":0},{"had_liked":false,"id":123457,"user_name":"ã€‚ã€‚ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1612570,"ip_address":"","ucode":"985B1561AC9152","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Xibh27ZicBhXls5KsPibBXZI4RKlR0MUbUiaEuOS2ORibKaxWSicpIjd4lvWUWqtNAde7EeDDTpWKAiapGdHeaiaDqczWQ/132","comment_is_top":false,"comment_ctime":1565679365,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565679365","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹ä¸‰ä¸»é”®ç´¢å¼•èŒƒå›´é”<br>ç¬¬2æ­¥ï¼ŒèŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ° id=15 è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œå› æ­¤éœ€è¦åŠ  next-key lock(10,15]<br>ä¸éœ€è¦å†æ ¹æ®ä¼˜åŒ–2ï¼Œé€€åŒ–æˆé—´éš™é”ï¼ˆ10,15ï¼‰å—ï¼Ÿ<br>æ„Ÿè§‰ç¬¬2æ­¥ç¬¦åˆä¼˜åŒ–2çš„æ¡ä»¶å•Š","like_count":0},{"had_liked":false,"id":120667,"user_name":"jasper","can_delete":false,"product_type":"c1","uid":1058086,"ip_address":"","ucode":"245404D19450E7","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/26/fb664d01.jpg","comment_is_top":false,"comment_ctime":1564969494,"is_pvip":false,"replies":[{"id":"44571","content":"å‰å¼€åé—­å“¦ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1565095094,"ip_address":"","comment_id":120667,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564969494","product_id":100020801,"comment_content":"next-key lockå‰å¼€åé—­ è¡¨ç¤ºæ–¹æ³•ä¸åº”è¯¥æ˜¯[5,10ï¼‰å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461425,"discussion_content":"å‰å¼€åé—­å“¦ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565095094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120187,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1564804715,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564804715","product_id":100020801,"comment_content":"è§£å†³å› é«˜å¹¶å‘å¼•èµ·çš„é—®é¢˜ï¼ŒåŸºæœ¬éƒ½å°‘ä¸äº†é”ï¼Œä¸è¿‡è¿™ä¸ªä¸œè¥¿ç¡®å®ä¸å¥½æŒæ¡ï¼Œå°¤å…¶æ˜¯ä»€ä¹ˆæ—¶å€™åŠ é”ï¼Ÿä»€ä¹ˆæ—¶å€™è§£é”ï¼ŸåŠ ä»€ä¹ˆé”ï¼Ÿä½†åŸåˆ™æˆ‘è§‰å¾—å°±ä¸¤ä¸ªï¼Œä¸€æ˜¯è§£å†³é«˜å¹¶å‘çš„é—®é¢˜ï¼Œå¦ä¸€ä¸ªæ˜¯å‡å°‘å› åŠ é”è€Œäº§ç”Ÿçš„æ€§èƒ½æŸè€—ï¼Œæœ¬èŠ‚åŠ é”çš„è§„åˆ™è¿˜éœ€è¦å¤šçœ‹å‡ é<br>æš‚æ—¶å…ˆæ˜ç¡®ä¸€ä¸‹å‡ ç‚¹<br>1ï¼šMySQLè¡¨ä¸­çš„æ•°æ®ä»¥B+æ ‘çš„å½¢å¼å­˜å‚¨<br>2ï¼šå¯¹äºè¡¨ä¸­æ•°æ®çš„æ“ä½œéƒ½æ˜¯æ“ä½œè¿™æ£µæ ‘<br>3ï¼šå¦‚æœæ²¡æœ‰å¹¶å‘æ“ä½œï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜ï¼Œå°±ä¸éœ€è¦åŠ é”ï¼Œé”çš„æœ¬è´¨å°±æ˜¯ä¸€ç§æ•°æ®æ“ä½œçš„åŒæ­¥æœºåˆ¶<br>4ï¼šé”éƒ½æ˜¯åŠ åœ¨è¿™æ£µæ ‘ä¸Šçš„<br>5ï¼šä¸åŒçš„é”ä»£è¡¨ç€ä¸åŒçš„ç‰¹æ€§ï¼Œé”å®šçš„èŒƒå›´æ˜¯å®ƒæœ€ä¸»è¦çš„ç‰¹æ€§<br>6ï¼šè¯¥åŠ ä»€ä¹ˆé”ï¼Œå°±çœ‹æ˜¯å¦èƒ½è§£å†³é—®é¢˜åˆèƒ½å‡å°‘å¯¹æ€§èƒ½çš„å½±å“<br>7ï¼šMySQLçš„é”åˆ†ä¸ºDMLé”&#47;DDLé”&#47;è¡¨é”&#47;è¡Œé”&#47;next key é”&#47;é—´éš™é”ï¼Œåˆé€šè¿‡å…¶ä»–ç‰¹æ€§åˆ†ä¸ºè¯»é”&#47;å†™é”&#47;æ‚²è§‚é”&#47;ä¹è§‚é”","like_count":0},{"had_liked":false,"id":119232,"user_name":"å¼ å¾·","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1564540254,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564540254","product_id":100020801,"comment_content":"æˆ‘çŸ¥é“äº†  æ¨¡æ‹Ÿè¿™ç§æ—¶åºå›¾  åªéœ€åœ¨Navicatå¼€ä¸‰ä¸ªçª—å£  ç¬¬ä¸€ä¸ªäº‹åŠ¡æäº¤ä¸æ‰§è¡Œå°±å¯ä»¥äº† åç»­ä¾æ¬¡æ‰§è¡Œå°±å¯ä»¥äº†","like_count":0},{"had_liked":false,"id":118295,"user_name":"Mr.é’§ğŸ‘»","can_delete":false,"product_type":"c1","uid":1249939,"ip_address":"","ucode":"D781E030E79245","user_header":"https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg","comment_is_top":false,"comment_ctime":1564312792,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564312792","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®å¦‚æœæ˜¯éç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œè¿˜æœ‰é—´éš™ç¾¤å—ï¼Ÿè¿˜æ˜¯è¯´è¦é”å…¨è¡¨ï¼Ÿ<br>è¿˜æœ‰å°±æ˜¯éç´¢å¼•èŒƒå›´åˆ é™¤ï¼Œè¿™ä¸ªæ˜¯é”å…¨è¡¨å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164245,"discussion_content":"æœ‰é—´éš™é”ï¼Œé”å…¨è¡¨ï¼Œéç´¢å¼•èŒƒå›´åˆ é™¤æ˜¯é”å…¨è¡¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581164938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118078,"user_name":"äº”åªé±¼","can_delete":false,"product_type":"c1","uid":1322684,"ip_address":"","ucode":"666F1DAE39EA9C","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/bc/811f8cdd.jpg","comment_is_top":false,"comment_ctime":1564232678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564232678","product_id":100020801,"comment_content":"è€å¸ˆ,ä¸€å¼ å¦‚ä¸‹è¡¨bä¸Šæœ‰éå”¯ä¸€ç´¢å¼•.<br>+----+------+------+<br>| id | a    | b    |<br>+----+------+------+<br>|  1 |    1 |    1 |<br>|  4 |    4 |    4 |<br>|  7 |   7 |    7 |<br>|  8 |   7 |    7 |<br>| 10 |   7 |    7 |<br>| 11 |   11 |   11 |<br>+----+------+------+<br>SessionA                                                                 <br>begin;<br>select * from t where b = 11 lock in share mode;<br><br>SessionBåœ¨SessionAæ‰§è¡Œå®Œç¬¬äºŒæ¡å,æ‰§è¡Œ<br>update t set a = a+1 where b = 7 limit 5ä¸ä¼šé˜»å¡<br>ä½†æ˜¯æ‰§è¡Œupdate t set a = a+1 where b = 7 limit 6ä¼šé˜»å¡.<br>è¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆåˆ†æ.<br>","like_count":0},{"had_liked":false,"id":117320,"user_name":"è¿œæ–¹å¤•é˜³","can_delete":false,"product_type":"c1","uid":1122317,"ip_address":"","ucode":"EEBCD53B2B5D3E","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/0d/93967314.jpg","comment_is_top":false,"comment_ctime":1564023691,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564023691","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæ¡ˆä¾‹3ï¼Œåé¢çš„æ¡ä»¶id&lt;11 è¿™ä¸ªæ¡ä»¶ä¸ºä»€ä¹ˆä¸ç»§ç»­å‚ä¸ä¼˜åŒ–ï¼Œè¿™æ · (10,15] å°±å¯ä»¥æˆä¸ºè¡Œé”ï¼Œè¿˜æ˜¯è¯´ï¼Œé”çš„è§„åˆ™ åªä¼šæ˜¯whereçš„ç¬¬ä¸€ä¸ªæ¡ä»¶æ¥åšåˆ¤æ–­ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164252,"discussion_content":"id<11ï¼Œ11å¹¶ä¸å­˜åœ¨ï¼Œåº”è¯¥æ˜¯ç›´æ¥åˆ°æœ€è¿‘çš„æœ‰æ•ˆå€¼ï¼Œä¹Ÿå°±æ˜¯15.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116441,"user_name":"æœç¾æ´","can_delete":false,"product_type":"c1","uid":1514953,"ip_address":"","ucode":"78354D0430C9DF","user_header":"https://static001.geekbang.org/account/avatar/00/17/1d/c9/c22f4e4b.jpg","comment_is_top":false,"comment_ctime":1563850872,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563850872","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼æ¡ˆä¾‹ä¸‰ï¼Œè®¿é—®åˆ°id=15æ‰ä¼šåœæ­¢ï¼Œï¼ˆ15ï¼Œ20]ä¹Ÿåº”è¯¥åŠ ä¸Šé—´éš™é”å‘€ã€‚è¯¾åä¹ é¢˜ï¼Œè®¿é—®åˆ°10åœæ­¢ï¼Œ5å’Œ10ä¹‹é—´ä¹Ÿæ˜¯åŠ äº†é”çš„","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164258,"discussion_content":"ï¼ˆ15ï¼Œ20]ç›¸å½“äºæ‰«æåˆ°20äº†ï¼Œæ‰«æåˆ°15å°±å‘ç°å·²ç»æ˜¯ç¦»11æœ€è¿‘çš„å€¼äº†ã€‚æ‰€ä»¥ï¼Œæ²¡å¿…è¦ç»§ç»­å‘åæ‰«æäº†ã€‚è€Œè¯¾åä¹ é¢˜ï¼Œæ˜¯c>=15ï¼Œç”±äºæ˜¯é™åºï¼Œæ‰€ä»¥å¿…é¡»å¾—æ‰«æåˆ°ä¸ç­‰äº15çš„é‚£è¡Œã€‚ä¹Ÿå°±æ˜¯10ï¼Œæ•…next-key lock(5,10]ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115634,"user_name":"æ„šäºº","can_delete":false,"product_type":"c1","uid":1355952,"ip_address":"","ucode":"40DE41849EF9EA","user_header":"https://static001.geekbang.org/account/avatar/00/14/b0/b0/30b29949.jpg","comment_is_top":false,"comment_ctime":1563679772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563679772","product_id":100020801,"comment_content":"è¿™ä¸€æ¡è¯­å¥æŠŠtè¡¨ä¸Šç´¢å¼•cçš„è®°å½•å…¨é”ä½äº†ï¼ŒæŒ‰ç…§åˆ†æçš„ç»“æœï¼Œåº”è¯¥åªé”ä½cç´¢å¼•æ ‘ä¸Š10ä»¥ä¸Šçš„èŒƒå›´ã€‚ä¸ºä»€ä¹ˆ[0, 9]ä¹Ÿéƒ½è¢«é”äº†ï¼Œæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„ï¼Ÿ<br>select * from t where c&gt;=15 order by c lock in share mode;","like_count":0},{"had_liked":false,"id":115281,"user_name":"tianyitang","can_delete":false,"product_type":"c1","uid":1440036,"ip_address":"","ucode":"1B7BEBD49E277B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcgKLQZibvbXn8iaPCibDAtKaOhRxDIcxCaclUaG4mxJ9377noTib9RE8VBakCvicQ8VEHkvfE0UbgCAQ/132","comment_is_top":false,"comment_ctime":1563523649,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563523649","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œéš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œå¦‚æœåœ¨æ™®é€šç´¢å¼•ä¸ŠåŠ çš„netkey-locké”ï¼Œæ˜¯å¦ä¼šåŒæ—¶åœ¨ä¸»é”®ç´¢å¼•ä¹ŸåŠ ç›¸åº”çš„é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164259,"discussion_content":"RRæ˜¯é»˜è®¤éš”ç¦»çº§åˆ«ã€‚å¦‚æœåœ¨æ™®é€šç´¢å¼•ä¸ŠåŠ ï¼Œçœ‹æ˜¯ä¸æ˜¯è¦†ç›–ç´¢å¼•ï¼Œå¦‚æœæ˜¯é‚£ä¸»é”®ç´¢å¼•å°±ä¸åŠ äº†ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£å°±å¾—åœ¨ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115268,"user_name":"tianyitang","can_delete":false,"product_type":"c1","uid":1440036,"ip_address":"","ucode":"1B7BEBD49E277B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcgKLQZibvbXn8iaPCibDAtKaOhRxDIcxCaclUaG4mxJ9377noTib9RE8VBakCvicQ8VEHkvfE0UbgCAQ/132","comment_is_top":false,"comment_ctime":1563522266,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563522266","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·æ•™å…³äºé—´éš™é”é—®é¢˜ã€‚æ•°æ®åº“éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œæ ¹æ®åŠ é”è§„åˆ™ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œcä¸ºæ™®é€šç´¢å¼•ï¼Œé—´éš™é”æ˜¯ä¸ä¼šé€€åŒ–çš„ï¼Œæ ¹æ®è¡¨è®°å½•ï¼Œä¸‹é¢è¿™æ¡for updateè¯­å¥ï¼Œåº”è¯¥åœ¨ï¼ˆ0ï¼Œ5]ä¸Šä¹Ÿæœ‰netkey-lockï¼Œä½†æ˜¯ä¼šè¯åœ¨è¿™ä¸ªèŒƒå›´insertå€¼æˆåŠŸäº†ã€‚è¿™ä¸ªé—®é¢˜ä¸å¤ªç†è§£ï¼Œè¯·è€å¸ˆæŒ‡å¯¼ï¼Œè°¢è°¢ï¼<br>ä¼šè¯1.<br>begin;<br>mysql&gt;  select *from t1 where c&gt;=10 and c&lt;11 for update;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 10 |   10 |   10 |<br>+----+------+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select * from t1;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>|  0 |    0 |    0 |<br>|  5 |    5 |    5 |<br>| 10 |   10 |   10 |<br>| 15 |   15 |   15 |<br>| 20 |   20 |   20 |<br>| 25 |   25 |   25 |<br>| 55 |   55 |   55 |<br>+----+------+------+<br>7 rows in set (0.00 sec)<br><br>ä¼šè¯2.<br>mysql&gt;  insert into t1 values(3,3,3);<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt;","like_count":0},{"had_liked":false,"id":113980,"user_name":"chenpiing","can_delete":false,"product_type":"c1","uid":1357056,"ip_address":"","ucode":"C847A30B3FDB8F","user_header":"https://static001.geekbang.org/account/avatar/00/14/b5/00/f4e8fbaf.jpg","comment_is_top":false,"comment_ctime":1563198126,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563198126","product_id":100020801,"comment_content":"ä¸æ€è€ƒé¢˜ç›¸å…³çš„ç–‘é—®<br><br>ä¸ºä½•æ‰§è¡Œselect * from t where c&gt;=10 and c&lt;=15 order by c desc for updateè¿™æ¡è¯­å¥æ—¶ï¼Œc=20è¿™ä¸€è¡Œä¸ä¼šåŠ è¡Œé”ã€‚è€Œæ‰§è¡Œselect * from t where c&gt;=10 and c&lt;=15 order by c for updateè¿™å¥ï¼Œc=20è¿™è¡ŒåŠ äº†è¡Œé”<br><br>æ±‚å¤§ä½¬ä»¬å¸®å¿™è§£ç­”ï¼Œæ„Ÿè°¢","like_count":0,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83073,"discussion_content":"ä¸€ä¸ªæ˜¯å‘ä¸Šæ‰¾éœ€è¦çš„èŒƒå›´ï¼Œä¸€ä¸ªæ˜¯å‘ä¸‹æ‰¾çš„ã€‚åœ¨ç»“åˆè€å¸ˆè®²çš„è§„åˆ™å°±çŸ¥é“äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576414549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112986,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1562860921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562860921","product_id":100020801,"comment_content":"å¯¹åŠ é”çš„åŸåˆ™2ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå®éªŒäº†å‡ æ¬¡ï¼Œä¼¼ä¹æœ‰æ–°çš„è®¤è¯†ï¼š<br>å³ä½¿æ˜¯è¡Œé”ï¼Œxé”å’Œsé”åŠ é”çš„ä½ç½®ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œxé”å°±æ˜¯åŠ åœ¨ä¸»é”®ä¸Šçš„ï¼Œè€Œsé”ï¼Œæ˜¯åŠ åœ¨ä½¿ç”¨çš„ç´¢å¼•ä¸Šçš„ï¼Œå¦‚æœæŸ¥è¯¢éœ€è¦å›è¡¨ï¼Œä¹Ÿä¼šåŠ åœ¨ä¸»é”®ä¸Šã€‚<br><br>è¯·è€å¸ˆæŒ‡æ­£ã€‚","like_count":0},{"had_liked":false,"id":111669,"user_name":"zhima_hu","can_delete":false,"product_type":"c1","uid":1311188,"ip_address":"","ucode":"33A4496556D9B1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rBCoNmJbagIGlkrDDfdQv9YjrtoHfvExqSSiavHwgUaukTxnO2jTBGrrHUF49VZqaS1FBolLc4Bibk883sabroyQ/132","comment_is_top":false,"comment_ctime":1562580572,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562580572","product_id":100020801,"comment_content":"éº»çƒ¦æ‚¨çœ‹ä¸€ä¸‹è¿™ä¸ªinsertè¯­å¥å†™æ³•ï¼Œæ•ˆç‡æ€ä¹ˆæ ·ï¼Œç°åœ¨çº¿ä¸Šæœ‰å¾ˆå¤šè¿™æ ·çš„å†™æ³•<br>explain <br>INSERT INTO rule_prom_activity<br>        (<br>        `act_id`,<br>        `act_name`,<br>        `begin_time`,<br>        `end_time`,<br>        `creator`,<br>        `act_status`,<br>        `act_type`,<br>        `user_level`,<br>        `business_param`,<br>        `create_time`,<br>        `modified_time`)<br>        SELECT<br>       1122,<br>        &quot;huodong&quot;,<br>        &quot;2019-04-15 10:50:07&quot;,<br>        &quot;2019-04-15 10:50:07&quot;,<br>        &quot;huodong&quot;,<br>        3,<br>        3,<br>        1,<br>        &#39;huodong&#39;,<br>        now(),<br>        now()<br>\t\tFROM<br>\t\t\tdual<br>\t\tWHERE NOT EXISTS(SELECT 1 FROM rule_prom_activity WHERE act_id = 1)<br>","like_count":0},{"had_liked":false,"id":110018,"user_name":"....","can_delete":false,"product_type":"c1","uid":1104022,"ip_address":"","ucode":"C9F7F89CD00B13","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/96/60e0d8fe.jpg","comment_is_top":false,"comment_ctime":1562151368,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562151368","product_id":100020801,"comment_content":"èƒ½ä¸èƒ½ä»‹ç»ä¸€ä¸‹æ’å…¥ä¸€è¡Œè®°å½•ï¼Œmysqlä¼šåŠ å“ªäº›é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164261,"discussion_content":"çœ‹åœºæ™¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108884,"user_name":"å¤§å®","can_delete":false,"product_type":"c1","uid":1102771,"ip_address":"","ucode":"224458E5D1A35A","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","comment_is_top":false,"comment_ctime":1561907178,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1561907178","product_id":100020801,"comment_content":"   æ¡ˆä¾‹å››çš„é”åº”è¯¥æ˜¯ï¼ˆ10ï¼Œ15ï¼‰å§ï¼Œå› ä¸ºæœ€åä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œä¼šé€€åŒ–æˆé—´éš™é”","like_count":0,"discussions":[{"author":{"id":1276373,"avatar":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","nickname":"Ethan","note":"","ucode":"016F1DEBA895B8","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373849,"discussion_content":"ä¸ºä»€ä¹ˆè¯´æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620894245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164264,"discussion_content":"è¿™ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œæ˜¯èŒƒå›´æŸ¥è¯¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108163,"user_name":"core dumped","can_delete":false,"product_type":"c1","uid":1103253,"ip_address":"","ucode":"F99C28F2C396E2","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/95/aae1eb2a.jpg","comment_is_top":false,"comment_ctime":1561688945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561688945","product_id":100020801,"comment_content":"è€å¸ˆ æ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼š<br>å½“äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨rræƒ…å†µä¸‹ï¼Œè¡¨ä¸Šæ²¡æœ‰ä¸»é”®å’Œç´¢å¼•ï¼Œæ‰§è¡Œä¸€ä¸ªå…¨è¡¨æ‰«æfor updateï¼ŒæŒ‰ç…§MySQLç°æœ‰çš„æ–¹å¼ä¼šæ·»åŠ å››ä¸ªnext-key lockï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºåªéœ€è¦åœ¨ä¸‰æ¡è®°å½•ä¸Šæ·»åŠ è¡Œé”å’Œæœ€åä¸€ä¸ªæœ€å¤§å€¼ä¸Šæ·»åŠ next-key lockå°±è¡Œäº†ï¼Œå› ä¸ºé»˜è®¤åˆ›å»ºçš„èšé›†ç´¢å¼•æ¯æ¬¡éƒ½æ˜¯è‡ªå¢çš„ï¼Œæ’å…¥éƒ½æ˜¯åœ¨è¡¨æœ€åé¢æ’å…¥ï¼Œä¸ä¼šæ’å…¥åˆ°ä¸‰æ¡è®°å½•ä¹‹é—´ã€‚åˆ é™¤æ“ä½œç”±äºæ¯æ¡è®°å½•æœ‰äº†è¡Œé”ï¼Œæ‰€ä»¥ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ã€‚","like_count":0},{"had_liked":false,"id":105890,"user_name":"æ­£æ˜¯é‚£æœµç«ç‘°","can_delete":false,"product_type":"c1","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1561100331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561100331","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜æƒ³é—®ä¸‹ï¼Œæˆ‘ä»¬ä¸€å¼ è®¢å•è¡¨æœ‰ä¸¤ä¸ªå­—æ®µorder_no(varchar),status(varchar)ï¼Œåœ¨å¹¶å‘æ‰§è¡Œupdateè¯­å¥ï¼šupdate è¡¨ set xxx=xxx where order_no = &#39;xyz&#39; and status = &#39;s&#39;ï¼Œç«Ÿç„¶å‘ç”Ÿæ­»é”äº†ï¼Œorder_no å’Œstatusçš„å€¼éƒ½æ˜¯ä¸€æ ·ï¼Œä¸æ˜ç™½ä»€ä¹ˆåŸå› ï¼Ÿè€å¸ˆèƒ½å¦æŒ‡ç‚¹ç‚¹","like_count":0},{"had_liked":false,"id":105150,"user_name":"é˜¿ç‹¸çˆ±JAVA","can_delete":false,"product_type":"c1","uid":1033566,"ip_address":"","ucode":"597971781B1500","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/5e/24cc5a72.jpg","comment_is_top":false,"comment_ctime":1560930556,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560930556","product_id":100020801,"comment_content":"åœ¨æ¡ˆä¾‹å››ä¸­ï¼Œåœ¨ç´¢å¼•cä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œä¸ºä»€ä¹ˆä¸èµ°ä¼˜åŒ–2ï¼Œå¸Œæœ›è€å¸ˆå¯ä»¥è§£ç­”ä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164265,"discussion_content":"è¿™ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œæ˜¯èŒƒå›´æŸ¥è¯¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103614,"user_name":"ZHANG","can_delete":false,"product_type":"c1","uid":1442437,"ip_address":"","ucode":"BAFD110AE33328","user_header":"https://static001.geekbang.org/account/avatar/00/16/02/85/9a81a973.jpg","comment_is_top":false,"comment_ctime":1560477571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560477571","product_id":100020801,"comment_content":"æœ¬ç¯‡æ–‡ç« ä¸­æˆ‘è§‰å¾—é™¤æ¡ˆä¾‹äºŒçš„å…¶ä»–æ¡ˆä¾‹è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œæ¡ˆä¾‹äºŒä¹ä¸€çœ‹ç¡®å®æœ‰ç‚¹æ¯ä¸‰è§‚ç†è§£èµ·æ¥æœ‰é‚£ä¹ˆä¸€ç‚¹åƒåŠ›ï¼ˆåæ­£æˆ‘æ˜¯åå¤è¯»äº†å¥½å¤šéï¼Œå®é™…è¯•äº†å¥½å¤šé^_^ï¼‰ï¼Œè€Œä¸”å¯èƒ½çœ‹ä¸Šä¸€ä¸¤éè¿˜æœ‰äº›æ‡µï¼Œä½†æ˜¯å¤šçœ‹å‡ éï¼Œç»†ç»†æ¨æ•²ä¸€ç•ªï¼Œå„ç§æƒ…å†µéƒ½æ“ä½œä¸€éï¼Œå°±ä¼šæç„¶å¤§æ‚Ÿï¼Œæ„Ÿè§‰è¿™ä¸ªè®¾è®¡å¥½å·§å¦™ï¼Œä¸‹é¢æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„ç†è§£ï¼Œæˆ‘è§‰å¾—è¿™æ ·ç†è§£ç¨å¾®è½»æ¾ä¸€ç‚¹ï¼Œä¹Ÿå¸Œæœ›ä¸è€å¸ˆèƒ½å¸®å¿™å‚è°‹ä¸€ä¸‹çœ‹è¿™æ ·ç†è§£æœ‰æ²¡æœ‰åå·®ï¼š<br><br>é—®é¢˜ä¸»è¦æ˜¯åœ¨session Bå°½ç„¶èƒ½æ›´æ–°æˆåŠŸä¸Šï¼Œæˆ‘æ˜æ˜ç»™c=5è¿™ä¸€è¡ŒåŠ äº†è¯»é”äº†ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½æ›´æ–°æˆåŠŸå‘¢ï¼Œè€å¸ˆåœ¨åˆ†æçš„ç¬¬4æ­¥è¯´â€œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•â€ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´session Aåœ¨æŸ¥è¯¢çš„æ—¶å€™ä¸ä¼šå›è¡¨ï¼Œæˆ‘è‡ªå·±ç´¢å¼•æ ‘ç»´æŠ¤çš„å†…å®¹å°±å¤Ÿç”¨äº†ï¼Œä¸ç”¨ä¸»é”®ç´¢å¼•æ ‘çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™å„¿é”ä½çš„ä¸æ˜¯c=5è¿™ä¸€æ•´è¡Œï¼Œè€Œåªæ˜¯c=5è¿™ä¸€è¡Œé‡Œçš„cå­—æ®µå’Œidå­—æ®µï¼ˆå› ä¸ºcç´¢å¼•æ ‘é‡Œåªç»´æŠ¤äº†è¿™ä¸¤ä¸ªå­—æ®µï¼‰ï¼Œåªè¦ä½ å…¶ä»–äº‹åŠ¡ä¸æ›´æ–°æˆ‘è¿™ä¸€è¡Œçš„è¿™ä¸¤ä¸ªå­—æ®µå°±è¡Œäº†ï¼Œå…¶ä»–å­—æ®µéšä¾¿æ›´æ–°ï¼Œå› ä¸ºé‚£äº›å­—æ®µæˆ‘ç”¨ä¸ç€ï¼›<br>æˆ‘è¯•è¿‡ï¼Œå¦‚æœç»™è¡¨tå†åŠ ä¸Šå…¶ä»–å­—æ®µï¼ˆä¸ç®¡è¿™ä¸ªå­—æ®µæ˜¯ä¸æ˜¯ç´¢å¼•ï¼‰ï¼Œé‚£äº›å­—æ®µä¹Ÿéƒ½æ˜¯å¯ä»¥æ›´æ–°æˆåŠŸçš„ï¼Œå¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å¯¹è”åˆç´¢å¼•é‡Œé¢æ¶‰åŠåˆ°çš„å­—æ®µä»¥åŠä¸»é”®çš„æ›´æ–°ä¹Ÿä¼šè¢«é”ä½ï¼Œå¦‚ä¸‹ï¼š<br>ç»™è¡¨tåŠ ä¸¤ä¸ªå­—æ®µï¼Œä»¥åŠè¿™ä¸¤ä¸ªå­—æ®µåŠ è”åˆç´¢å¼•ï¼š<br>alter table t add column e int(11) default null;<br>alter table t add column f int(11) default null;<br>alter table t add key ef(e,f);<br><br>session Aæ”¹æˆ<br>begin;<br>select id from t wehre e =5 lock in share mode;<br><br>session B<br>update e set e=e+1 where id=5;   &#47;*è¢«é”ä½*&#47;<br>update f set f=f+1 where id=5;     &#47;*è¢«é”ä½*&#47;<br>update f set d=d+1 where id=5;   &#47;*æ‰§è¡ŒæˆåŠŸ*&#47;<br><br>è¦†ç›–ç´¢å¼•çš„åŠŸåŠ³è¿˜æ˜¯æŒºå¤§çš„ã€‚","like_count":0},{"had_liked":false,"id":103277,"user_name":"Henry","can_delete":false,"product_type":"c1","uid":1018122,"ip_address":"","ucode":"4DC15DB1013A95","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/0a/7a96bfb1.jpg","comment_is_top":false,"comment_ctime":1560407798,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560407798","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½, å¯¹äºä¹‹å‰æˆ‘æçš„é—®é¢˜:<br>sessionA<br>mysql&gt; begin;<br>mysql&gt; select * from t where c&gt;10 for update;<br><br>sessionB<br>mysql&gt; begin;<br>mysql&gt; update t set d=d+1 where id=0;<br>(blocked)<br><br>æˆ‘æƒ³æˆ‘æœ‰ç­”æ¡ˆäº†;<br><br>è¿˜æ˜¯æ ¹æ®åŸåˆ™2ï¼Œ ä½†å‚è€ƒç¬¬10è®²çš„çŸ¥è¯†ï¼Œé€šè¿‡explain select * from t where c&gt;10 for update; å¾—çŸ¥äº†sessionAè¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œæ‰€ä»¥é”ä½äº†æ‰€æœ‰çš„é—´éš™é”å’Œè¡Œé”ï¼›æ‰€ä»¥æ­¤æ—¶sessionBæ— è®ºåœ¨å“ªä¸ªä½ç½®insertæˆ–è€…updateï¼Œéƒ½ä¼šè¢«blockä½ã€‚","like_count":0},{"had_liked":false,"id":103262,"user_name":"Henry","can_delete":false,"product_type":"c1","uid":1018122,"ip_address":"","ucode":"4DC15DB1013A95","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/0a/7a96bfb1.jpg","comment_is_top":false,"comment_ctime":1560406074,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560406074","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå¯¹äºéå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ï¼Œæˆ‘æœ‰å¦‚ä¸‹é—®é¢˜:<br>mysqlç‰ˆæœ¬: MySQL5.6<br>sessionA<br>mysql&gt; begin;<br>mysql&gt; select * from t where c&gt;10 for update;<br><br>sessionB<br>mysql&gt; begin;<br>mysql&gt; update t set d=d+1 where c=0;<br>(blocked)<br><br>è¯·é—®è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ<br>æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæ ¹æ®åŸåˆ™2, sessionAçš„next-key lockè¯¥æ˜¯ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»(c=10,id=10) åˆ°(c=æ­£æ— ç©·, id=æ­£æ— ç©·)çš„å·¦å¼€å³å¼€åŒºé—´äº†å§ï¼ŒæŒ‰è¯´ä¸ä¼šå½±å“(c=10,id=10)å·¦ä¾§çš„èŒƒå›´å†…çš„insertå’Œupdateå§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83077,"discussion_content":"5.6 ç‰ˆæœ¬çš„å¯èƒ½å’Œ 5.7 çš„ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥ç”¨5.7 è¯•ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576414675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102459,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1560224351,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"1560224351","product_id":100020801,"comment_content":"åŠ é”çš„èŒƒå›´ä¸€ç›´å‚»å‚»å¼„ä¸æ¸…æ¥š","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164266,"discussion_content":"æ²‰ä¸‹å¿ƒï¼Œä¸€è¡Œè¡Œå“ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99269,"user_name":"ç‰™ç–¼ç–¼ç–¼ç–¼ç–¼","can_delete":false,"product_type":"c1","uid":1306594,"ip_address":"","ucode":"51D9976552BCE5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqWicVOkCMEUTMB3t8Ann8QniasADdImItesadggumttR1cp9yicPB8acaJA7Fslo76FiaON8EYI8TDzA/132","comment_is_top":false,"comment_ctime":1559183913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559183913","product_id":100020801,"comment_content":"è¯·é—®ä¸‹ï¼Œæ¡ˆä¾‹ä¸€ä¸­ï¼Œæˆ‘å°†Açš„è¯­å¥æ”¹æˆupdate t set d=d+1 where c=7;<br>Bçš„insert into t VALUES(8,8,8) ---é”ä½<br>insert into t VALUES(8,11,8) ---æ‰§è¡Œ<br>insert into t VALUES(8,10,8) ---é”ä½<br>è¿™ç§æƒ…å†µçœ‹èµ·æ¥æ˜¯é”èŒƒå›´æ˜¯ï¼ˆ5,10ã€‘ï¼Œä½†æ˜¯æŒ‰ç…§ä¼˜åŒ–2ä¸æ˜¯åº”è¯¥æ˜¯ï¼ˆ5,10ï¼‰ç¬¬ä¸‰ä¸ªæ’å…¥åº”è¯¥ä¸é”ä½å•Šï¼Œè¿˜æœ›è§£ç­”ã€‚<br>","like_count":0},{"had_liked":false,"id":99087,"user_name":"Geek_qinghe","can_delete":false,"product_type":"c1","uid":1516360,"ip_address":"","ucode":"503849CDFE3236","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersx4icj2Kqlt6cEBmFUiaTkZxgLCFm1Zt6mwicW2OcVeY9n3j3ZTVRbSLElTePrsEE5ahq9WeWJloQg/132","comment_is_top":false,"comment_ctime":1559141160,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559141160","product_id":100020801,"comment_content":"session A <br><br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; select * from t where c&gt;=15 and c &lt;= 20 order by c desc lock in share mode;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 20 |   20 |   20 |<br>| 15 |   15 |   15 |<br>+----+------+------+<br>2 rows in set (0.00 sec)<br><br><br><br>session B<br><br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; insert into t values (6,6,6);<br>Query OK, 1 row affected (0.00 sec)<br><br><br>è€å¸ˆï¼Œæˆ‘è¿™é‡Œå®éªŒä¹Ÿæ˜¯å¯ä»¥æ’å…¥çš„ï¼›æˆ‘çœ‹äº†éš”ç¦»çº§åˆ«æ˜¯æ²¡é—®é¢˜çš„ï¼›<br>ç„¶åæˆ‘å°±çœ‹äº†ä¸€ä¸‹æ•°æ®ï¼Œå‘ç°ä¸åŒçš„æ˜¯æˆ‘çš„tè¡¨å¤šäº†ä¸€æ¡è®°å½•ï¼Œå› ä¸ºæˆ‘åœ¨çœ‹æ–‡ç« çš„æ—¶å€™åœ¨è¡¨äº†é‡Œæ’å…¥äº†ä¸€æ¡è®°å½•(30, 10, 30)ï¼Œç„¶åæˆ‘å°†è¿™ä¸ªè®°å½•åˆ äº†ï¼Œå°±å¤ç°äº†ï¼ç„¶åæˆ‘å°±ä¸æ˜ç™½äº†ï¼Œæˆ‘å¤šçš„è¿™æ¡è®°å½•c=10(è¡¨é‡Œå·²ç»æœ‰äº†ä¸€æ¡c=10çš„è®°å½•)ï¼Œåº”è¯¥ä¸ä¼šå½±å“åŠ é”çš„èŒƒå›´æ‰å¯¹ï¼Œä¸ºä»€ä¹ˆç»“æœå´ä¸åŒï¼Œæ’å…¥(6,6,6)ä¸ä¼šè¢«é˜»å¡ï¼Œå¸Œæœ›è€å¸ˆèƒ½è§£æƒ‘ï¼Œè°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":97426,"user_name":"woaiwnagqiu","can_delete":false,"product_type":"c1","uid":1484333,"ip_address":"","ucode":"2FE9FB90F9EAD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ccdlzibsv0umJB4QeX0K6JDg77STBwaMbTk9WCRRlFiaLCNY0DNUWEH4o9ktOeRYuFbSYuEtOhWlu7Fic2BpLREeg/132","comment_is_top":false,"comment_ctime":1558667942,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558667942","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé’ˆå¯¹æœ¬è®²çš„è¡¨ç»“æ„å’Œæ•°æ®ï¼Œæˆ‘å°è¯•sql select * from t2 where id &lt;=10 order by id desc for update; çœ‹åŠ é”æ—¥å¿—å‘ç° (10,15)é—´éš™è¢«é”ä½ã€‚ä¸æ˜¯å¾ˆæ˜ç™½<br>æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œç”±äºé™åºæ’åˆ—ï¼Œä¼šå…ˆæ‰¾åˆ°10è¿™ä¸ªè®°å½•ï¼Œè¿™æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œç­‰å€¼æŸ¥è¯¢åº”è¯¥æ»¡è¶³ä¼˜åŒ–1ï¼Œé€€åŒ–ä¸ºè¡Œé”æ‰å¯¹å•Š<br><br>","like_count":0},{"had_liked":false,"id":97120,"user_name":"Terrell","can_delete":false,"product_type":"c1","uid":1080388,"ip_address":"","ucode":"1B2C2A183FC881","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/44/3828b24f.jpg","comment_is_top":false,"comment_ctime":1558591823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558591823","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚<br><br>æ¡ˆä¾‹å…«ä¸­ï¼Œâ€œsession A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ  lock in share modeï¼Œåœ¨ç´¢å¼• c ä¸ŠåŠ äº† next-key lock(5,10] å’Œé—´éš™é” (10,15)ï¼›&quot;<br><br>æ˜¯å¦å¯ä»¥è§†ä¸ºåŠ ä¸Šäº†é—´éš™é”(5,10),(10,15) å’Œè¡Œé”10<br><br>å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œâ€œsession B çš„â€œåŠ  next-key lock(5,10] â€æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  c=10 çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„ã€‚&quot;<br><br>åŠ ï¼ˆ5,10ï¼‰é—´éš™é”è¿™æ­¥æ“ä½œä¸æ˜¯åº”è¯¥è¢«é˜»å¡å—ï¼Ÿä¸ºä»€ä¹ˆä¼šåŠ é”æˆåŠŸï¼Œæœ›èƒ½è§£ç­”ä¸€ä¸‹ã€‚","like_count":0},{"had_liked":false,"id":95927,"user_name":"æ·˜æ°”çš„ç‹æ·˜æ°”","can_delete":false,"product_type":"c1","uid":1001781,"ip_address":"","ucode":"188B6E77EA2FBF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/35/d656c61a.jpg","comment_is_top":false,"comment_ctime":1558258330,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1558258330","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼š<br> å½“ç´¢å¼•çš„å­—æ®µç±»å‹ä¸æ˜¯æ•°å€¼å‹æ—¶ï¼Œä¼šå­˜åœ¨next-key lockï¼Ÿå¦‚æœå­˜åœ¨æ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥è®¡ç®—é—´éš”åŒºé—´çš„ï¼Œ<br> åœ¨è¿™æƒ…å†µéœ€è¦æ³¨æ„ä»€ä¹ˆ <br>è¯·è€å¸ˆå¸®å¿™è§£ç­”ä¸‹ è°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":94716,"user_name":"~ç²ç²ç²~å­~å“¥~","can_delete":false,"product_type":"c1","uid":1302741,"ip_address":"","ucode":"89379F3A0427EA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/d5/7485e51f.jpg","comment_is_top":false,"comment_ctime":1557884609,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557884609","product_id":100020801,"comment_content":"lock in share modeå®¹æ˜“å¼•èµ·è¦†ç›–ç´¢å¼•å¯¼è‡´ä¸»é”®ä¸åŠ é”è€Œå¼•èµ·&quot;è¯¥åŠ é”çš„ä¸åŠ é”&quot;çš„æ„Ÿè§‰<br>æ­¤ä¾‹ç”±äºä½¿ç”¨select *æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨è¦†ç›–ç´¢å¼•.<br>åŠ é”èŒƒå›´: (5,10),(10,15],(15,20],(20,25);","like_count":0},{"had_liked":false,"id":93879,"user_name":"å”é¹","can_delete":false,"product_type":"c1","uid":1487943,"ip_address":"","ucode":"4BBEF5937230E6","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/47/8be46019.jpg","comment_is_top":false,"comment_ctime":1557649520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557649520","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼š<br>Mysqlæ™®é€šï¼ˆéå”¯ä¸€ï¼‰ç´¢å¼•ç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™ä¸ºå•¥éœ€è¦é”ä½åé¢ä¸€ä¸ªåŒºé—´å•Šï¼Ÿ<br><br>æˆ–è€…æ¢ç§æè¿°ï¼š<br>ç­‰å€¼æŸ¥è¯¢ç»™å”¯ä¸€ç´¢æ€§åŠ é”çš„æ—¶å€™å¯ä»¥é€€åŒ–ä¸ºè¡Œé”ï¼Œä¸ºä»€ä¹ˆéå”¯ä¸€ç´¢å¼•ä¸åšè¿™ç§é€€åŒ–ï¼Ÿ<br><br><br>ä¸»è¦æ˜¯ä¸ç†ä¼˜åŒ–1ï¼šâ€œä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚â€<br><br>è¿™é‡Œä¸ºä»€ä¹ˆè¦é™å®šå”¯ä¸€ç´¢å¼•ï¼Ÿæ™®é€šç´¢å¼•ç­‰å€¼æŸ¥è¯¢åŠ é”çš„æ—¶å€™ä¸ºå•¥æ²¡æœ‰åšè¿™ä¸ªä¼˜åŒ–ï¼Ÿ","like_count":0},{"had_liked":false,"id":93790,"user_name":"çº¸ç‰‡äºº","can_delete":false,"product_type":"c1","uid":1358508,"ip_address":"","ucode":"84490E7CEF59A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/ac/b44b256a.jpg","comment_is_top":false,"comment_ctime":1557592685,"is_pvip":false,"replies":[{"id":"34312","content":"æ¼‚äº®","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1558261094,"ip_address":"","comment_id":93790,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1557592685","product_id":100020801,"comment_content":"æˆ‘ä»æ¡ˆä¾‹ä¸ƒè·å¾—çµæ„Ÿï¼Œè®¾è®¡äº†ä¸€ä¸ªå®éªŒï¼Œæ¥è¯æ˜InnoDBåŠ é”çš„ä½ç½®æ˜¯ç´¢å¼•ï¼Œè€Œéæ•°æ®è¡Œã€‚æˆ‘ç”¨çš„æ˜¯æ¡ˆä¾‹å…­çš„æµ‹è¯•æ•°æ®ã€‚<br><br>ç¬¬ä¸€ç»„å®éªŒï¼š<br>Session A<br>begin;<br>select * from t where c=10 limit 1 for update;<br>Session B<br>select * from t where c=10 and d=10 lock in share mode; -- blocking --<br>select * from t where c=10 and d=30 lock in share mode; -- blocking --<br>select * from t where id=30 and d=30 lock in share mode; -- success --<br><br>åˆ†æï¼šç†è®ºä¸Šï¼Œä¼šè¯Aåº”è¯¥åªé”ä½äº†(10,10,10)ã€‚å¦‚æœé”åœ¨(10,10,10)ä¸Šï¼Œé‚£ä¹ˆä¼šè¯Bçš„ç¬¬äºŒæ¡è¯­å¥ä¸å¯èƒ½è¢«é˜»å¡ã€‚ç¬¬ä¸‰æ¡è¯­å¥åè¯ï¼Œ(30,10,30)ä¸Šæ²¡æœ‰é”ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡è¯­å¥è¢«é˜»å¡æ˜¯å› ä¸ºè¡Œé”åœ¨c=10ä¸Šã€‚<br><br>å»¶ä¼¸å®éªŒï¼š<br>Session A<br>begin;<br>select * from t where c=10 and d=10 for update;<br>Session B<br>select * from t where c=10 and d=10 lock in share mode; -- blocking --<br>select * from t where c=10 and d=30 lock in share mode; -- blocking --<br>select * from t where id=30 and d=30 lock in share mode; -- blocking --<br><br>åˆ†æï¼šä¼šè¯Bç¬¬ä¸‰æ¡è¯­å¥è¢«é˜»å¡çš„åŸå› æ˜¯ï¼Œç´¢å¼•cä¸Šæ— då€¼ï¼Œæ‰€ä»¥ä¼šè¯Aå›äº†ä¸¤æ¬¡è¡¨ï¼Œä¾æ¬¡ç»™id=10å’Œid=30åŠ äº†è¡Œé”ã€‚<br><br>éªŒè¯å®éªŒï¼š<br>Session A<br>begin;<br>select * from t where c=10 and id=10 for update; -- ç›´æ¥æŸ¥çœ‹ä¸»é”®ç´¢å¼• --<br>Session B<br>select * from t where c=10 and d=10 lock in share mode; -- blockingï¼Œå›è¡¨è¢«é˜»å¡ --<br>select * from t where c=10 and d=30 lock in share mode; -- blockingï¼Œå›è¡¨è¢«é˜»å¡ --<br>select * from t where id=30 and d=30 lock in share mode; -- success --<br>select id from t where c=10 lock in share mode; -- successï¼Œä¸å›è¡¨ï¼Œc=10ä¸Šæ— è¡Œé” --","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449770,"discussion_content":"æ¼‚äº®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558261094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1238436,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e5/a4/e16dca6a.jpg","nickname":"é˜¿å‡¯æ–‡","note":"","ucode":"F17CF201E74849","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283637,"discussion_content":"éš¾é“éªŒè¯è¯•éªŒä¸­sessionAåªå¯¹ä¸»é”®ç´¢å¼•id=10çš„ä¸»é”®åŠ äº†è¡Œé”ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592316031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93784,"user_name":"çº¸ç‰‡äºº","can_delete":false,"product_type":"c1","uid":1358508,"ip_address":"","ucode":"84490E7CEF59A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/ac/b44b256a.jpg","comment_is_top":false,"comment_ctime":1557588750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557588750","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œæ‚¨å¥½ï¼æˆ‘é€šè¿‡å®éªŒå‘ç°ï¼Œè¡Œé”ä¸é˜»å¡ç­‰å€¼çš„Insertã€‚éš”ç¦»çº§åˆ«ä¸ºRCï¼Œå®éªŒæ­¥éª¤å¦‚ä¸‹ï¼š<br>Session Aï¼š<br>mysql&gt; select @@tx_isolation;<br>+----------------+<br>| @@tx_isolation |<br>+----------------+<br>| READ-COMMITTED |<br>+----------------+<br>1 row in set (0.00 sec)<br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; select id from t where c=15 lock in share mode;       --- å­˜åœ¨è¡Œé”c=15 --<br>+----+<br>| id |<br>+----+<br>| 15 |<br>+----+<br>1 row in set (0.00 sec)<br>mysql&gt; select now();<br>+---------------------+<br>| now()               |<br>+---------------------+<br>| 2019-05-11 23:04:53 |<br>+---------------------+<br>1 row in set (0.00 sec)<br><br>Session Bï¼š<br>mysql&gt; select @@tx_isolation;<br>+----------------+<br>| @@tx_isolation |<br>+----------------+<br>| READ-COMMITTED |<br>+----------------+<br>1 row in set (0.00 sec)<br>mysql&gt; select now();<br>+---------------------+<br>| now()               |<br>+---------------------+<br>| 2019-05-11 23:08:24 |<br>+---------------------+<br>1 row in set (0.00 sec)<br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; insert into t value(14,14,14);<br>Query OK, 1 row affected (0.00 sec)<br>mysql&gt; insert into t value(15,15,15);<br>ERROR 1062 (23000): Duplicate entry &#39;15&#39; for key &#39;PRIMARY&#39;<br>mysql&gt; insert into t value(16,16,16);<br>Query OK, 1 row affected (0.00 sec)<br>mysql&gt; insert into t value(17,15,17);    -- è¡Œé”ä¸é˜»å¡insert --<br>Query OK, 1 row affected (0.00 sec)<br>mysql&gt; update t set d=15 where c=15;<br>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction<br>mysql&gt; delete from t where c=15;<br>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction<br>mysql&gt; update t set d=15 where id=15;<br>Query OK, 0 rows affected (0.02 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br><br>æˆ–è®¸æ¡ˆä¾‹äº”æåˆ°çš„bugï¼Œæ˜¯åŸºäºå®Œå–„è¯­ä¹‰çš„è§’åº¦è€ƒè™‘çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":93744,"user_name":"çº¸ç‰‡äºº","can_delete":false,"product_type":"c1","uid":1358508,"ip_address":"","ucode":"84490E7CEF59A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/ac/b44b256a.jpg","comment_is_top":false,"comment_ctime":1557578012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557578012","product_id":100020801,"comment_content":"æˆ‘åå¤æµ‹è¯•äº†ä¸€éåˆä¸€éï¼Œå‘ç°ä»…å½“æŸ¥è¯¢æ¡ä»¶ä¸ºa=0å’Œa=5çš„æ—¶å€™ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚<br><br>æœ‰é—®é¢˜çš„æƒ…å†µä¸‹ï¼š<br>Session A<br>begin;<br>select * from t where c=0&#47;1 lock in share mode;<br>Session B<br>insert into t value(1000,0,1000);<br>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction<br><br>æ­£å¸¸æƒ…å†µä¸‹ï¼š<br>Session A<br>begin;<br>select * from t where c=-1&#47;10&#47;15&#47;20 lock in share mode;<br>Session B<br>insert into t value(1000,0,1000);<br>Query OK, 1 row affected (0.00 sec)<br><br>è¿™ç®—Bugå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":93721,"user_name":"çº¸ç‰‡äºº","can_delete":false,"product_type":"c1","uid":1358508,"ip_address":"","ucode":"84490E7CEF59A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ba/ac/b44b256a.jpg","comment_is_top":false,"comment_ctime":1557569272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557569272","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œæˆ‘è¦æ”¾å¼ƒæ€è€ƒäº†TUTã€‚<br>æˆ‘è®¾è®¡äº†ä¸€ä¸ªå®éªŒï¼Œæƒ³è¦æ£€æµ‹é—´éš™é”å’Œè¡Œé”çš„é˜»å¡æ•ˆæœã€‚åˆšå¼€å§‹å¾ˆé¡ºåˆ©ï¼Œåœ¨ä»…ä¿ç•™ä¸»é”®çš„æƒ…å†µä¸‹ï¼Œæˆ‘æµ‹è¯•å‡ºé—´éš™é”ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡å¾€åŒºé—´å†…insertï¼ˆå…¶ä¸­åŒºé—´è¾¹ç•Œä¸Šçš„æŠ¥é”™æ˜¯â€œDuplicate entry for keyâ€ï¼‰ï¼Œä½†ä¸å½±å“åŒºé—´å†…çš„updateå’Œdeleteï¼Œè¡Œé”ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡åœ¨è¡Œä¸Šçš„updateã€deleteå’Œinsertã€‚å¦‚æœä»…æ­¤è€Œå·²ï¼Œæˆ‘å°±ä¸ä¼šé‚£ä¹ˆç—›è‹¦äº†ã€‚<br>æˆ‘è¿›è¡Œäº†ç¬¬äºŒç»„å®éªŒï¼Œä¸ºäº†æ’é™¤ä¸»é”®ä¸Šé”çš„å½±å“ï¼Œé‡‡ç”¨äº†æ¡ˆä¾‹äºŒçš„æ•°æ®å’Œæ“ä½œã€‚ç„¶åï¼Œæˆ‘å‘ç°å°½ç®¡c=10ä¸Šçš„è¡Œé”ç¡®å®å› ä¸ºä¼˜åŒ–è§„åˆ™2é‡Šæ”¾äº†ï¼ˆå¯ä»¥è¿›è¡Œc=10çš„updateå’Œdeleteï¼‰ï¼Œä½†insert...(-1, 10, -1)ä»ç„¶ä¼šè¢«é˜»å¡ã€‚è¿™æ˜¯å¦æ„å‘³ç€ï¼Œé—´éš™é”çš„ä½œç”¨èŒƒå›´æ˜¯å·¦å¼€å³é—­ï¼Œå³é™åˆ¶å…¶ä»–äº‹åŠ¡åœ¨å³å€¼ä¸Šçš„insertï¼Ÿ<br>å†ç„¶åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå’Œæ–‡ç« è¯´æ³•æœ‰å‡ºå…¥çš„åœ°æ–¹ã€‚ä¸»é”®ç´¢å¼•ä¸Šæœ‰å¤§èŒƒå›´çš„é—´éš™é”ï¼ï¼ï¼ï¼ï¼<br>æˆ‘å°è¯•<br>insert...(-1, 0, -1);<br>insert...(1, 0, 1);<br>insert...(2, 0, 2);<br>insert...(14, 0, 14);<br>insert...(29, 0, 29);<br>insert...(1000, 0, 1000);<br>åªæœ‰ç¬¬ä¸€æ¡æ’å…¥æˆåŠŸï¼Œå…¶ä»–éƒ½è¢«é˜»å¡äº†~~~~ä¸ºå˜›ï¼Ÿè¿™éƒ½æ˜¯ä¸ºå˜›ï¼Ÿtut<br>æˆ‘æ£€æŸ¥äº†è‡ªå·±çš„mysqlç‰ˆæœ¬ï¼Œæ˜¯5.7.18ï¼Œéš”ç¦»çº§åˆ«æ˜¯RRã€‚ä¸æ˜ç™½å•Šï¼ï¼ï¼","like_count":0},{"had_liked":false,"id":91298,"user_name":"QW","can_delete":false,"product_type":"c1","uid":1493185,"ip_address":"","ucode":"71B298F207BD69","user_header":"https://static001.geekbang.org/account/avatar/00/16/c8/c1/60235576.jpg","comment_is_top":false,"comment_ctime":1556967767,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556967767","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„é”é—®é¢˜ï¼ˆmysql ç‰ˆæœ¬ä¸º5.7.24-debugï¼‰<br>åˆ›å»ºä¸€å¼ è¡¨   create table t ( a int primary auto_increment , b int unique key);<br> insert into t(b) values (10),(20),(30),(40);<br>set  global innodb_purge_stop_now=1 å…³æ‰purge<br>åœ¨ä¼šè¯ä¸€ä¸­ æ‰§è¡Œ delete from t where b = 20;  <br>ç„¶ååœ¨ä¼šè¯äºŒä¸­æ‰§è¡Œ beginï¼›insert into t(b) values(20); <br>æŸ¥çœ‹åŠ é”æƒ…å†µï¼š<br>RECORD LOCKS space id 293 page no 4 n bits 72 index b of table `tt`.`t` trx id 819289 lock mode S<br>Record lock, heap no 3 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000014; asc     ;;<br> 1: len 4; hex 80000002; asc     ;;<br><br>Record lock, heap no 4 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 8000001e; asc     ;;<br> 1: len 4; hex 80000003; asc     ;;<br><br>RECORD LOCKS space id 293 page no 4 n bits 72 index b of table `tt`.`t` trx id 819289 lock mode S locks gap before rec<br>Record lock, heap no 6 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000014; asc     ;;<br> 1: len 4; hex 80000005; asc     ;;<br><br>åœ¨å”¯ä¸€é”®ç´¢å¼•æ£€æµ‹ä¸ä»…å¯¹ heap no ä¸º 3 çš„ (20ï¼Œ2)åŠ äº†S lock ï¼Œå¯¹(30ï¼Œ3) ä¹ŸåŠ äº†S  lockã€‚<br><br>å¯¹æ­¤æˆ‘åˆå»ºç«‹ä¸€å¼ ä¸è¡¨t ä¸€æ ·çš„è¡¨tttã€‚<br>insert into ttt(b) values (10),(30),(40)     ä»ç„¶åœ¨å…³é—­purgeçš„æƒ…å†µä¸‹è¿›è¡Œå®éªŒ<br>ä¼šè¯ä¸€:  beginï¼›insert into ttt (b) values (20);<br>ä¼šè¯äºŒ:  begin;  insert into ttt (b) values(20);<br>ä¼šè¯ä¸€:  rollbackï¼›<br>äº§ç”Ÿé”çš„æƒ…å†µå¦‚ä¸‹ï¼š<br>RECORD LOCKS space id 294 page no 4 n bits 72 index b of table `tt`.`ttt` trx id 819305 lock mode S<br>RECORD LOCKS space id 294 page no 4 n bits 72 index b of table `tt`.`ttt` trx id 819305 lock mode S locks gap before rec<br>Record lock, heap no 3 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 8000001e; asc     ;;<br> 1: len 4; hex 80000002; asc     ;;<br><br>Record lock, heap no 5 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000014; asc     ;;<br> 1: len 4; hex 80000005; asc     ;;<br><br>å®éªŒäºŒå¹¶æ²¡æœ‰å‘ç”Ÿç±»ä¼¼å®éªŒä¸€çš„åŠ é”æƒ…å†µï¼Œå¯¹æ­¤æˆ‘æœ‰å‡ ä¸ªé—®é¢˜æƒ³é—®è€å¸ˆï¼š<br>1.å®éªŒä¸€æ˜¯ä¸æ˜¯ç”±delete mark é€ æˆçš„ï¼Ÿ<br>2.å®éªŒäºŒåŠ é”æƒ…å†µä¸å®éªŒä¸€ä¸åŒèƒ½å¦è¯´æ˜insert çš„rollbackæ˜¯ç›´æ¥delete è®°å½•ï¼Œè€Œä¸æ˜¯delete markï¼Ÿ<br>3.å®éªŒäºŒçš„åŠ é”æƒ…å†µæ˜¯ä¸æ˜¯ç”±äºåŠ¨æ€çš„gapé”äº§ç”Ÿçš„ï¼Ÿ<br><br>å¯èƒ½æˆ‘çš„æè¿°ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¯·è€å¸ˆè°…è§£ã€‚å¸Œæœ›è€å¸ˆèƒ½æŒ‡å¯¼ä¸€ä¸‹ã€‚","like_count":0},{"had_liked":false,"id":90469,"user_name":"Break","can_delete":false,"product_type":"c1","uid":1508922,"ip_address":"","ucode":"6D1CCFC60E11EF","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/3a/68bed1d9.jpg","comment_is_top":false,"comment_ctime":1556527795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556527795","product_id":100020801,"comment_content":"å‘ç°ä¸€ä¸ªå’Œæ¡ˆä¾‹2ä¸ç¬¦åˆçš„æƒ…å†µ...ä¾‹å­æ˜¯ç¬¬20è®²é‡Œé¢çš„é‚£ä¸ª. <br>begin;<br>select * from t where c=5 for update;<br>è¿™ä¸ªæ—¶å€™, é”ä½çš„åº”è¯¥æ˜¯å…¨éƒ¨è¡Œ, è€Œä¸æ˜¯ç¬¬0-10è¡Œ. å’Œæ¡ˆä¾‹2ä¸åŒ....","like_count":0},{"had_liked":false,"id":87942,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1555761596,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555761596","product_id":100020801,"comment_content":"ï¼ˆä¸‰ï¼‰<br>çœ‹ä¸€ä¸ªupdateè¯­å¥ï¼Œå¯¹åº”çš„show engine innodb status\\G;æ—¥å¿—è¾“å‡ºæœ‰å¦‚ä¸‹ç–‘é—®<br>lock mode Sæ˜¯ä»€ä¹ˆé”ï¼ŒNext Keyã€é—´éš™é”ã€è®°å½•é”ï¼Ÿ<br>lock mode S locks gap before recæ˜¯ä»€ä¹ˆé”ï¼Œå…±äº«é—´éš™é”ï¼Ÿ<br>é—´éš™é”æˆ‘å°è±¡ä¸­æ˜¯æ²¡æœ‰Sã€XåŒºåˆ†çš„ï¼Œé‚£é—®é¢˜2çš„é”æ˜¯ä»€ä¹ˆé”å‘¢<br>ç´¢å¼• codeä¸Š(1,4)è¿™æ¡è®°å½•çš„é—´éš™ä¸ºä»€ä¹ˆä¸Šäº†lock mode S locks gap before rec<br>ç´¢å¼• codeä¸Š(2,2)è¿™æ¡è®°å½•ä¸ºä»€ä¹ˆä¸Šäº†lock mode S","like_count":0},{"had_liked":false,"id":87941,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1555761479,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555761479","product_id":100020801,"comment_content":"ï¼ˆäºŒï¼‰<br>--TRANSACTION 83138899, ACTIVE 11 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)<br>select * from tmp where code = 1 for update<br>------- TRX HAS BEEN WAITING 11 SEC FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138899 lock_mode X waiting<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000001; asc;;<br> 1: len 4; hex 80000001; asc;;<br>---TRANSACTION 83138898, ACTIVE 16 sec<br>5 lock struct(s), heap size 1136, 5 row lock(s), undo log entries 2<br>TABLE LOCK table `test`.`tmp` trx id 83138898 lock mode IX<br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138898 lock_mode X locks rec but not gap<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000001; asc;;<br> 1: len 4; hex 80000001; asc;;<br>RECORD LOCKS space id 41 page no 3 n bits 80 index PRIMARY of table `test`.`tmp` trx id 83138898 lock_mode X locks rec but not gap<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 5; compact format; info bits 32<br> 0: len 4; hex 80000001;asc;;<br> 1: len 6; hex 000004f49952; ascR;;<br> 2: len 7; hex 40000004a50b87; asc @;;<br> 3: len 4; hex 80000001; asc;;<br> 4: len 1; hex 31; asc 1;;<br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138898 lock mode S<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000001; asc;;<br> 1: len 4; hex 80000001; asc;;<br>Record lock, heap no 7 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000002; asc;;<br> 1: len 4; hex 80000002; asc;;<br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138898 lock mode S locks gap before rec<br>Record lock, heap no 3 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000001; asc;;<br> 1: len 4; hex 80000004; asc;;","like_count":0},{"had_liked":false,"id":87939,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1555761067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555761067","product_id":100020801,"comment_content":"(ä¸€)è€å¸ˆé—®ä¸ªå…³äºupdate åŠ é”çš„é—®é¢˜<br>CREATE TABLE `tmp` (<br>  `id` int(11) NOT NULL,<br>  `code` int(11) DEFAULT NULL,<br>  `name` varchar(255) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `code` (`code`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br>insert into tmp values(1,1,&#39;1&#39;);<br>insert into tmp values(2,2,&#39;2&#39;);<br>session1\t                                        session2<br>update tmp set id =4 where code = 1;\t<br>                                                        select * from tmp where code = 1 for update;é˜»å¡<br>ç„¶åæˆ‘æ‰§è¡Œ show engine innodb status è·å¾—ä¸€ä¸‹ç»“æœ<br>æ¥ä¸‹ä¸€æ¡","like_count":0},{"had_liked":false,"id":87460,"user_name":"octocat","can_delete":false,"product_type":"c1","uid":1314023,"ip_address":"","ucode":"155FC4A6111634","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/e7/8977990f.jpg","comment_is_top":false,"comment_ctime":1555599018,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1555599018","product_id":100020801,"comment_content":"è€å¸ˆ æ‚¨å¥½ æˆ‘æƒ³é—®ä¸‹  select max(c) from t for update è¿™æ¡è¯­å¥çš„åŠ é”è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345789,"discussion_content":"äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯rr mysqlç‰ˆæœ¬ 5.7.17 å®éªŒ ï¼š\nselect max(c) from t for update é”ä½äº† ï¼ˆ20ï¼Œ25]å’Œï¼ˆ25,super]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611795546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164268,"discussion_content":"è¿™ä¸ªåªæ˜¯å¯¹æœ€å¤§çš„é‚£ä¸ªç´¢å¼•åŠ é”å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581165982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86904,"user_name":"æµ·æ½®","can_delete":false,"product_type":"c1","uid":1332573,"ip_address":"","ucode":"7254BDB077D25F","user_header":"https://static001.geekbang.org/account/avatar/00/14/55/5d/28379d01.jpg","comment_is_top":false,"comment_ctime":1555473466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555473466","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼Œå¸Œæœ›è€å¸ˆèƒ½å¤Ÿè§£ç­”ä¸‹ï¼Œé“¾æ¥å¦‚ä¸‹<br>https:&#47;&#47;blog.csdn.net&#47;u010234531&#47;article&#47;details&#47;89352873","like_count":0},{"had_liked":false,"id":85817,"user_name":"woaiwnagqiu","can_delete":false,"product_type":"c1","uid":1484333,"ip_address":"","ucode":"2FE9FB90F9EAD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ccdlzibsv0umJB4QeX0K6JDg77STBwaMbTk9WCRRlFiaLCNY0DNUWEH4o9ktOeRYuFbSYuEtOhWlu7Fic2BpLREeg/132","comment_is_top":false,"comment_ctime":1555245646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555245646","product_id":100020801,"comment_content":"è¿™æœ‰ä¸€ä¸ªé”ç­‰å¾…æ¡ˆä¾‹<br>è¡¨ç»“æ„ <br>CREATE TABLE `tmp` (<br>  `id` int(11) NOT NULL,<br>  `code` int(11) DEFAULT NULL,<br>  `name` varchar(255) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `code` (`code`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br>è¡¨æ•°æ®<br>+----+------+------+<br>| id | code | name |<br>+----+------+------+<br>|  1 |    1 | 1    |<br>|  2 |    2 | 2    |<br>+----+------+------+<br>2 rows in set (0.01 sec)<br>äº‹åŠ¡1æ‰§è¡Œ update tmp set id =4 where code = 1;<br>äº‹åŠ¡2æ‰§è¡Œ select * from tmp where code = 1 for update; è¢«äº‹åŠ¡1é˜»å¡<br><br>show engine innodb status\\Gï¼›æŸ¥çœ‹é”æŒæœ‰æƒ…å†µ<br>äº‹åŠ¡1 <br>ECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138891 lock_mode X locks rec but not gap<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000001; asc     ;;<br> 1: len 4; hex 80000001; asc     ;;<br><br>RECORD LOCKS space id 41 page no 3 n bits 80 index PRIMARY of table `test`.`tmp` trx id 83138891 lock_mode X locks rec but not gap<br> 0: len 4; hex 80000001; asc     ;;<br> 1: len 6; hex 000004f4994b; asc      K;;<br> 2: len 7; hex 3c000004921324; asc &lt;     $;;<br> 3: len 4; hex 80000001; asc     ;;<br> 4: len 1; hex 31; asc 1;;<br><br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138891 lock mode S<br>Record lock, heap no 2 PHYSICAL RECORD: n_fields 2; compact format; info bits 32<br> 0: len 4; hex 80000001; asc     ;;<br> 1: len 4; hex 80000001; asc     ;;<br><br>Record lock, heap no 7 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000002; asc     ;;<br> 1: len 4; hex 80000002; asc     ;;<br><br>RECORD LOCKS space id 41 page no 4 n bits 80 index code of table `test`.`tmp` trx id 83138891 lock mode S locks gap before rec<br>Record lock, heap no 3 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br> 0: len 4; hex 80000001; asc     ;;<br> 1: len 4; hex 80000004; asc     ;;<br>æˆ‘çš„ç–‘é—® <br>1 lock mode Sæ˜¯ä»€ä¹ˆé”ï¼Ÿ NKé”ï¼Œè®°å½•é”ï¼Œé—´éš™é”<br>2 ä¸ºä»€ä¹ˆè¦è·å–2,2çš„lock mode S<br>3 lock mode S locks gap æ˜¯å…±äº«é—´éš™é”ï¼Ÿ æˆ‘è®°å¾—é—´éš™é”æ²¡æœ‰X,SåŒºåˆ†å•Š<br>4 è¿™ä¸ªupdateéƒ½ä¸Šäº†å“ªäº›è®°å½•æˆ–è€…é—´éš™é”","like_count":0},{"had_liked":false,"id":85322,"user_name":"woaiwnagqiu","can_delete":false,"product_type":"c1","uid":1484333,"ip_address":"","ucode":"2FE9FB90F9EAD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Ccdlzibsv0umJB4QeX0K6JDg77STBwaMbTk9WCRRlFiaLCNY0DNUWEH4o9ktOeRYuFbSYuEtOhWlu7Fic2BpLREeg/132","comment_is_top":false,"comment_ctime":1555036643,"is_pvip":false,"replies":[{"id":"30739","content":"ä½ è¦æŠŠgap lockåŠ è¿›å»è€ƒè™‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1555146248,"ip_address":"","comment_id":85322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555036643","product_id":100020801,"comment_content":"æˆ‘é‡åˆ°äº†ä¸ªæ­»é”ï¼Œä¸¤ä¸ªäº‹åŠ¡ï¼Œå¯¹åŒä¸€æ¡è®°å½•æ“ä½œï¼Œäº‹åŠ¡1åˆ é™¤è®°å½•ï¼Œäº‹åŠ¡2åˆ é™¤è®°å½•é˜»å¡ï¼Œäº‹åŠ¡1æ’å…¥è¿™æ¡è®°å½•ï¼Œç„¶åå‘ç”Ÿæ­»é”ï¼Œé€šè¿‡è¿™ä¸ªæ­»é”æˆ‘æƒ³é—®ï¼Œæ˜¯å› ä¸ºäº‹åŠ¡2åœ¨ç­‰å¾…Xé”ï¼Œäº‹åŠ¡1æŒæœ‰Xé”ï¼Œç”³è¯·Sé”ï¼Œå¯¼è‡´äº’ç›¸ç­‰å¾…ç„¶åæ­»é”ä¹ˆï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£æˆ‘æ¨¡æ‹Ÿè¿™ä¸ªæ“ä½œï¼Œå¯¹åŒä¸€æ¡è®°å½•select * from for updateå’Œselect * from lock in share modeï¼Œåº”è¯¥ä¹Ÿä¼šæ­»é”å•Šï¼Œå®é™…å¹¶æ²¡æœ‰ï¼Œè§æ“ä½œé“¾æ¥<br>https:&#47;&#47;www.jianshu.com&#47;p&#47;ab2c8dd3ffa2","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446629,"discussion_content":"ä½ è¦æŠŠgap lockåŠ è¿›å»è€ƒè™‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83749,"user_name":"äº®çš„å¤ªé˜³","can_delete":false,"product_type":"c1","uid":1475752,"ip_address":"","ucode":"8BD77740812984","user_header":"https://static001.geekbang.org/account/avatar/00/16/84/a8/b0746eea.jpg","comment_is_top":false,"comment_ctime":1554710108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554710108","product_id":100020801,"comment_content":"æ¡ˆä¾‹ 3 å’Œ 4 ä¸­ï¼ŒèŒƒå›´æŸ¥è¯¢åˆ° 15 å°±ä¼šåœä¸‹æ¥ï¼Œä¸ä¼šå†åŠ å…¥ (15,20] é—´éš™é”ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ€è€ƒé¢˜ä¸­ï¼ŒèŒƒå›´æŸ¥æ‰¾åˆ° 10ï¼Œå°±ä¼šå†åŠ å…¥ (5,10] çš„é—´éš™é”ï¼Ÿ","like_count":0},{"had_liked":false,"id":83652,"user_name":"zxx","can_delete":false,"product_type":"c1","uid":1228129,"ip_address":"","ucode":"C1D9368A4F544E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GrQsm2lOxnBhFuegVwNxrA2dd9qQLwLOlV3xUB615eqKia5vQPdRcnz1T6sxLcmiaSnibTEIVia9ebThaVWxF2TMnw/132","comment_is_top":false,"comment_ctime":1554690614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554690614","product_id":100020801,"comment_content":"è¯·é—®ä¸‹ï¼Œæ¡ˆä¾‹äºŒã€åŒæ—¶ï¼Œå®ƒç»™æˆ‘ä»¬çš„æŒ‡å¯¼æ˜¯ï¼Œå¦‚æœä½ è¦ç”¨ lock in share mode æ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚æ¯”å¦‚ï¼Œå°† session A çš„æŸ¥è¯¢è¯­å¥æ”¹æˆselect d from t where c=5 lock in share modeã€‘è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆåŠ ä¸Šdçš„æŸ¥è¯¢åï¼Œå°±ä¼šå°†è¿™ä¸€è¡Œä¸Šé”äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":83255,"user_name":"ç‹ä¼¯è½©","can_delete":false,"product_type":"c1","uid":1108650,"ip_address":"","ucode":"546814BA7E5839","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/aa/cdd13ad2.jpg","comment_is_top":false,"comment_ctime":1554481369,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554481369","product_id":100020801,"comment_content":"è¿™ä¸¤ç« ä¸€å¤©æ¥æ¥å›å›å•ƒäº†å¥½å‡ éï¼Œç»ˆäºæ„Ÿè§‰ä¹‹å‰çš„å…³äºé”çš„çŸ¥è¯†æˆé•¿ä½“ç³»äº†ã€‚<br><br>æ„Ÿè°¢ä¸è€å¸ˆï¼<br><br>æˆ‘æœ‰ä¸ªæ„Ÿè§‰ï¼Œè€å¸ˆæ€»ç»“çš„é”åŠ åœ¨æ‰«æçš„","like_count":0},{"had_liked":false,"id":83005,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1554370045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554370045","product_id":100020801,"comment_content":"å¯¹äºæ¡ˆä¾‹8  ä¸ºä»€ä¹ˆsessionA    insert into t3 values(13,13,13);ä¸ä¼šå‡ºç°æ­»é”ï¼Ÿ","like_count":0},{"had_liked":false,"id":81574,"user_name":"ä¸‰æœ¨ç¦¾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1553951073,"is_pvip":false,"replies":[{"id":"30160","content":"æ¯”å¦‚ï¼Œä½ select ... from t where id&gt;=3 and id&lt;=5, å°±ä¼šè®¿é—®åˆ°3ï¼Œ4ï¼Œ5","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1554616635,"ip_address":"","comment_id":81574,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553951073","product_id":100020801,"comment_content":"é—®é¢˜åœ¨äºæ²¡èƒ½ç†è§£åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šè¢«åŠ é”ï¼Œè¿™ä¸ªâ€˜â€™è®¿é—®â€˜â€™æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445256,"discussion_content":"æ¯”å¦‚ï¼Œä½ select ... from t where id&amp;gt;=3 and id&amp;lt;=5, å°±ä¼šè®¿é—®åˆ°3ï¼Œ4ï¼Œ5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554616635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164269,"discussion_content":"ä¸ºä»€ä¹ˆ6ä¸åŠ é”å‘¢ï¼Œå› ä¸º6ä¹Ÿè¢«è®¿é—®åˆ°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81570,"user_name":"ä¸‰æœ¨ç¦¾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1553949820,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553949820","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ–è€…è¿™æ ·é—®ï¼Œåœ¨æ¡ˆä¾‹4ä¸­<br>cæ˜¯æ™®é€šç´¢å¼•ï¼Œæ•…ä¼˜åŒ–1ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥ä¼šåŠ next-key-lock  ,èŒƒå›´ä¸ºï¼ˆ5,10] ,æ ¹æ®ä¼˜åŒ–2 ï¼Œå®ƒä¼šç»§ç»­å‘åéå†ï¼Œç›´åˆ°é‡åˆ°c=15çš„æ—¶å€™ï¼Œnext-key-lock è¦é€€åŒ–æˆé—´éš™é”çš„ï¼Œä½†æ‚¨è¿™è¾¹ä¸ºå•¥èŒƒå›´æ˜¯95,15],å¹¶æ²¡æœ‰é€€åŒ–æˆé—´éš™é”å‘¢ï¼Ÿ <br>","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164270,"discussion_content":"è¿™ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œæ˜¯èŒƒå›´æŸ¥è¯¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81566,"user_name":"ä¸‰æœ¨ç¦¾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1553949256,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553949256","product_id":100020801,"comment_content":"åŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œselect *  from t where c&gt;=10 and  c&lt;11, åœ¨æ¡ˆä¾‹4ä¸­,next-key-lock ä¸ºä»€ä¹ˆä¸æ˜¯(0,10],å› ä¸ºcæ˜¯ç´¢å¼•çš„åŸå› ä¹ˆï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164271,"discussion_content":"ä½ çœ‹ä¸€ä¸‹åŸåˆ™å’Œä¼˜åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80931,"user_name":"é±¼éª¨å¤´","can_delete":false,"product_type":"c1","uid":1366810,"ip_address":"","ucode":"FFFD594DAA3A12","user_header":"https://static001.geekbang.org/account/avatar/00/14/db/1a/dd84ff19.jpg","comment_is_top":false,"comment_ctime":1553758177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553758177","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸€ç‚¹ä¸å¤ªç†è§£ï¼Œéº»çƒ¦è€å¸ˆæŒ‡æ•™ä¸€ä¸‹<br>       æ¡ˆä¾‹ä¸‰ä¸­select * from t where id &gt;=10 and id &lt; 11 for updateï¼Œidå°äºç­‰äº10ä½¿ç”¨åˆ°äº†ä¼˜åŒ–1ï¼ˆå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢next-key locké€€åŒ–ä¸ºrecord lockï¼‰ï¼Œnext-key lock é€€åŒ–æˆäº†record lock<br>       åœ¨æ¡ˆä¾‹5ä¸­çš„select * from t where id &gt; 10 and id &lt;= 15 for update ä¸­ï¼Œå¯¹äºid&lt;=15ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªè§„åˆ™å‘¢ã€‚<br>","like_count":0},{"had_liked":false,"id":78767,"user_name":"Lever","can_delete":false,"product_type":"c1","uid":1071921,"ip_address":"","ucode":"20C0D381677E1D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/31/b26b56bf.jpg","comment_is_top":false,"comment_ctime":1553236466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553236466","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ã€‚å…³äºæ¡ˆä¾‹äº”æˆ‘æœ‰ä¸€äº›é—®é¢˜ï¼š<br>(10,15] æ˜æ˜å·²ç»æœ‰é”äº†ï¼Œä½†æ˜¯æˆ‘åœ¨æ‰§è¡Œ update t set c = c+1 where id = 11;  æ—¶å¯ä»¥æˆåŠŸï¼Œæˆ‘çŒœæµ‹æ˜¯å› ä¸º 11 ä¸å­˜åœ¨ï¼Œå› æ­¤ä¸éœ€è¦ç”³è¯·è¡Œé”ï¼Œæ‰€ä»¥æˆåŠŸäº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":76526,"user_name":"Geek_515b9e","can_delete":false,"product_type":"c1","uid":1335734,"ip_address":"","ucode":"2D041B7679A2AF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dlj3u0jzg1gmCSxZ6daxUhhjtjmgqIwdOyalaEXYDYyQxibOsQdTrKFPPRs2I2XCHoehNaYUPrIffia9ZnR9efqQ/132","comment_is_top":false,"comment_ctime":1552626671,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552626671","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œçœ‹äº†å‡ éæ²¡æ˜ç™½ï¼Œå®ä¾‹2è·Ÿå®ä¾‹8çš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå®ä¾‹2ä¸ä¼šé”ï¼Œå®ä¾‹8çš„sessionBä¼šé”å‘¢ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164275,"discussion_content":"å› ä¸ºæ¡ˆä¾‹2æ˜¯è¦†ç›–ç´¢å¼•ï¼Œä¸»é”®ä¸ä¼šè¢«é”ã€‚è€Œæ¡ˆä¾‹8å°±ä¸ä¸€æ ·äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74711,"user_name":"Demter","can_delete":false,"product_type":"c1","uid":1158439,"ip_address":"","ucode":"BE3B6F726916CE","user_header":"https://static001.geekbang.org/account/avatar/00/11/ad/27/5556ae50.jpg","comment_is_top":false,"comment_ctime":1552285095,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1552285095","product_id":100020801,"comment_content":"è€å¸ˆã€‚æˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜ <br>1 ä½¿ç”¨select for updateä¸select lock in share modeåœ¨åŠ é—´éš™é”æ—¶å€™æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ<br>2 ä¸ºå•¥å”¯ä¸€ç´¢å¼•çš„é—´éš™é”å¯ä»¥é€€åŒ–ä¸ºè¡Œé”ï¼Œè¿™æ—¶å€™å¦‚æœå¾€é—´éš™æ’å…¥ä¸€ä¸ªæ•°æ®ä¸æ˜¯å°±å¯ä»¥äº†å—ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164278,"discussion_content":"2ã€å¯èƒ½è·ŸInnodbçš„å¹¶å‘æœºåˆ¶æœ‰å…³äº†å§ã€‚åŒé—®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73892,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1552026379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552026379","product_id":100020801,"comment_content":"ç»­ä¸Šï¼š<br>è¡¨ç»“æ„:<br>CREATE TABLE `tb_module_status` (<br>  `id` varchar(64) NOT NULL,<br>  `module_id` varchar(64) NOT NULL,<br>  `code` int(11) NOT NULL,<br>  `name` varchar(200) NOT NULL,<br>  `is_mail_notice` tinyint(1) DEFAULT NULL,<br>  `warn_level` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `tb_module_status_pk` (`module_id`,`code`),<br>  KEY `module_id` (`module_id`),<br>  CONSTRAINT `tb_module_status_ibfk_1` FOREIGN KEY (`module_id`) REFERENCES `tb_module` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8","like_count":0},{"had_liked":false,"id":73891,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1552026359,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552026359","product_id":100020801,"comment_content":"ä¸€æ¡ç•™è¨€è¶…å‡ºå­—æ•°é™åˆ¶äº†ï¼Œç»­ä¸Šï¼š<br>*** (2) TRANSACTION:<br>TRANSACTION 51376280536, ACTIVE 0 sec starting index read<br>mysql tables in use 1, locked 1<br>4 lock struct(s), heap size 1136, 4 row lock(s), undo log entries 3<br>MySQL thread id 30371820, OS thread handle 140479596992256, query id 370852524868 10.10.3.33 dms updating<br>UPDATE tb_module_status SET <br>\t\t\tmodule_id = &#39;738570731062956032&#39;,<br>\t\t\tcode = 0,<br>\t\t\tname = &#39;ok&#39;,<br>\t\t\tis_mail_notice = 0,<br>\t\t\twarn_level = 0<br>\t\t WHERE id = &#39;744825864994295808&#39;<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 703 page no 161 n bits 240 index PRIMARY of table `dms`.`tb_module_status` trx id 51376280536 lock_mode X locks rec but not gap<br>Record lock, heap no 67 PHYSICAL RECORD: n_fields 8; compact format; info bits 0<br> 0: len 18; hex 373434383235383635313238353133353336; asc 744825865128513536;;<br> 1: len 6; hex 000bf643d3d8; asc    C  ;;<br> 2: len 7; hex 640013003f1780; asc d   ?  ;;<br> 3: len 18; hex 373338353730353230383635343131303732; asc 738570520865411072;;<br> 4: len 4; hex 80000000; asc     ;;<br> 5: len 2; hex 6f6b; asc ok;;<br> 6: len 1; hex 80; asc  ;;<br> 7: len 4; hex 80000000; asc     ;;<br><br>*** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 703 page no 161 n bits 240 index PRIMARY of table `dms`.`tb_module_status` trx id 51376280536 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 65 PHYSICAL RECORD: n_fields 8; compact format; info bits 0<br> 0: len 18; hex 373434383235383634393934323935383038; asc 744825864994295808;;<br> 1: len 6; hex 000bf643d3e6; asc    C  ;;<br> 2: len 7; hex 6e001ac03b04bc; asc n   ;  ;;<br> 3: len 18; hex 373338353730373331303632393536303332; asc 738570731062956032;;<br> 4: len 4; hex 80000000; asc     ;;<br> 5: len 2; hex 6f6b; asc ok;;<br> 6: len 1; hex 80; asc  ;;<br> 7: len 4; hex 80000000; asc     ;;","like_count":0},{"had_liked":false,"id":73890,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1552026297,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552026297","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæœ€è¿‘é‡åˆ°äº†ä¸€ä¸ªæ­»é”çš„é—®é¢˜ï¼Œä¸€ç›´æ²¡æƒ³æ˜ç™½ï¼Œæœ›è€å¸ˆèƒ½æŠ½å‡ºæ—¶é—´æŒ‡ç‚¹ä¸€äºŒã€‚<br>é—®é¢˜ç®€å•æè¿°æ˜¯ï¼šä¸€æ¡updateè¯­å¥ï¼Œæ˜¯æ ¹æ®ä¸»é”®å»æ›´æ–°å…¶ä»–å­—æ®µçš„å€¼çš„ï¼Œä½†æ˜¯è¯­å¥æ‰§è¡Œæ—¶æŒæœ‰äº†ä¸»é”®ç´¢å¼•ä¸Šçš„å¤šä¸ªè®°å½•é”ï¼ˆlocks rec but not gapï¼‰ï¼Œç„¶åå¯¼è‡´äº†æ­»é”ã€‚æ—¥å¿—å¦‚ä¸‹ï¼š<br><br>------------------------<br>LATEST DETECTED DEADLOCK<br>------------------------<br>2019-03-06 14:41:09 0x7fc3f47a1700<br>*** (1) TRANSACTION:<br>TRANSACTION 51376280550, ACTIVE 0 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s), undo log entries 1<br>MySQL thread id 30371748, OS thread handle 140479596726016, query id 370852524619 10.10.3.34 dms updating<br>UPDATE tb_module_status SET <br>\t\t\tmodule_id = &#39;738570520865411072&#39;,<br>\t\t\tcode = 0,<br>\t\t\tname = &#39;ok&#39;,<br>\t\t\tis_mail_notice = 0,<br>\t\t\twarn_level = 0<br>\t\t WHERE id = &#39;744825865128513536&#39;<br>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 703 page no 161 n bits 240 index PRIMARY of table `dms`.`tb_module_status` trx id 51376280550 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 67 PHYSICAL RECORD: n_fields 8; compact format; info bits 0<br> 0: len 18; hex 373434383235383635313238353133353336; asc 744825865128513536;;<br> 1: len 6; hex 000bf643d3d8; asc    C  ;;<br> 2: len 7; hex 640013003f1780; asc d   ?  ;;<br> 3: len 18; hex 373338353730353230383635343131303732; asc 738570520865411072;;<br> 4: len 4; hex 80000000; asc     ;;<br> 5: len 2; hex 6f6b; asc ok;;<br> 6: len 1; hex 80; asc  ;;<br> 7: len 4; hex 80000000; asc     ;;","like_count":0},{"had_liked":false,"id":73018,"user_name":"æ­£åœ¨å‡è‚¥çš„èƒ–ç±½ã€‚","can_delete":false,"product_type":"c1","uid":1033728,"ip_address":"","ucode":"99E2E4DF599236","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c6/00/683bb4f0.jpg","comment_is_top":false,"comment_ctime":1551777927,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1551777927","product_id":100020801,"comment_content":"æ¡ˆä¾‹äºŒ:æŒ‰ç…§æ‚¨è¯´çš„æ­¥éª¤æˆ‘è¯•éªŒæ˜¯å¯¹çš„ã€‚ä½†æ˜¯æˆ‘æ‰‹å·¥æŠŠIDç­‰äº7è®°å½•åˆ æ‰åï¼Œå†é‡å¤æ­¥éª¤æ¡ˆä¾‹äºŒçš„æ­¥éª¤ï¼Œè®°å½•ä¸º7çš„å°±å¯ä»¥æ’å…¥äº†ã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164281,"discussion_content":"gapæ˜¯åŠ¨æ€è°ƒæ•´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72519,"user_name":"é˜¿æœ","can_delete":false,"product_type":"c1","uid":1066705,"ip_address":"","ucode":"349D3572F5ABE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d1/a1ddf49f.jpg","comment_is_top":false,"comment_ctime":1551663412,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551663412","product_id":100020801,"comment_content":"next-key lockå°±æ˜¯è¡Œé”å’Œé—´éš™é”çš„ç»„åˆï¼Œå½“ç­‰å€¼æŸ¥è¯¢ä¸”å€¼å­˜åœ¨çš„æ—¶å€™å°±é€€åŒ–ä¸ºè¡Œé”ï¼Œå¦åˆ™å°±æ˜¯é—´éš™é”ã€‚é—´éš™é”å°±æ˜¯æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¾€å·¦æˆ–å¾€å³æ‰¾é—´éš™å¹¶é”ä½ï¼Œé—´éš™å†…çš„è¡Œæˆ–ç´¢å¼•å°±ä¼šè¢«é”ä½ï¼Œä¸å…è®¸æ’å…¥æˆ–æ›´æ–°ã€‚é—´éš™é”åšå†³äº†å¹»è¯»çš„é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":70912,"user_name":"Bennet","can_delete":false,"product_type":"c1","uid":1022801,"ip_address":"","ucode":"C85C47A75BA412","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXYib4bOBtUeLniaqjMNaOY4gDPPbL4hYmv1HYHSPibyHVQlAeWhabABIy0YL7qgOqaa8EibxGSoiaw1w/132","comment_is_top":false,"comment_ctime":1551227738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551227738","product_id":100020801,"comment_content":"å…³äºæ¡ˆä¾‹å…­ç»“è®ºï¼ˆâ€œè¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (c=5,id=5) å’Œ (c=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”ã€‚â€ï¼‰çš„ç–‘é—®ã€‚<br><br>å®éªŒè¿‡ç¨‹ï¼š<br>SessionAï¼š<br>T1&gt; begin;<br>T1&gt; delete from t where c=10;<br><br>SessionB:<br>T2&gt; insert into t value(6, 5, 50); block<br>T2&gt; insert into t value(11, 5, 50); block<br>T2&gt; insert into t value(16, 5, 50); block<br>T2&gt; insert into t value(31, 5, 50); block<br>è¿™é‡Œé€€å‡º SessionB<br><br>SessionC:<br>T3&gt; insert into t value(6, 15, 50); block<br>T3&gt; insert into t value(11, 15, 50); block<br>T3&gt; insert into t value(16, 15, 50); success<br>T3&gt; insert into t value(31, 15, 50); success<br><br> â€œ(c=5,id=5) å’Œ (c=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”â€è¦æ€ä¹ˆç†è§£ï¼Ÿï¼ˆæ„Ÿè§‰æ–‡ç« è¿˜è¦çœ‹å‡ éğŸ˜¢ï¼‰<br>ä¸Šé¢å®éªŒä¸­ c=5 å’Œ c=15 çš„å·®å¼‚æ˜¯æ€ä¹ˆé€ æˆçš„ï¼Œä¸»é”®ä¸Šçš„é”è¦æ€ä¹ˆåˆ†æï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":70837,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1551192379,"is_pvip":false,"replies":[{"id":"25361","content":"1. æ¡ˆä¾‹5è¿™ä¸ªæ˜¯â€œéç­‰å€¼æŸ¥è¯¢â€(id&gt;10)çš„å‘å³éå†ï¼Œä¸ä¼šé€€åŒ–<br>2. ä½ è¦è¯´çš„æ˜¯ä¸æ˜¯(c=15,id=15)ï¼Ÿè¿™é‡Œæ˜¯ç­‰å€¼æŸ¥è¯¢(c=10)çš„å‘å³éå†, ä¼šé€€åŒ–æˆé—´éš™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551195289,"ip_address":"","comment_id":70837,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551192379","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå†ä¸€æ¬¡çœ‹å®Œè¿™ç¯‡åè¿˜æ˜¯æœ‰å‡ ä¸ªç–‘é—®ï¼Œçƒ¦è¯·æ‚¨è§£ç­”ä¸€ä¸‹ã€‚<br>1.æ¡ˆä¾‹äº”ä¸­ï¼Œid &gt; 10 and id &lt;= 15; æŒ‰ç…§ä¼˜åŒ–2ï¼Œæ‰«æåˆ°id=20ååˆ¤æ–­ä¸&lt;=15åº”è¯¥é€€åŒ–æˆé—´éš™é”æ‰å¯¹ï¼Œä¸ºä»€ä¹ˆé”èŒƒå›´è¿˜ä¼šæ˜¯(10,20]å‘¢ï¼Œä¸åº”è¯¥é€€åŒ–æˆ(10,20)å—ï¼Ÿ<br>2.æ¡ˆä¾‹å…­ä¸­ï¼ŒSession AåŠ é”èŒƒå›´æ˜¯(c=6,id=6)è‡³(c=14,id=14)ã€‚ä½†æ˜¯æˆ‘åœ¨Session Bä¸­æ‰§è¡Œ insert into t values (14,14,14)å´è¿˜æ˜¯å¯ä»¥æ’å…¥æˆåŠŸã€‚é—´éš™é”å¹¶æ²¡æœ‰æ§åˆ¶ä½c=14çš„æ’å…¥ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>è¿˜æœ›è€å¸ˆåœ¨ç™¾å¿™ä¹‹ä¸­å¯ä»¥æŒ‡ç‚¹è¿·æ´¥ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440854,"discussion_content":"1. æ¡ˆä¾‹5è¿™ä¸ªæ˜¯â€œéç­‰å€¼æŸ¥è¯¢â€(id&amp;gt;10)çš„å‘å³éå†ï¼Œä¸ä¼šé€€åŒ–\n2. ä½ è¦è¯´çš„æ˜¯ä¸æ˜¯(c=15,id=15)ï¼Ÿè¿™é‡Œæ˜¯ç­‰å€¼æŸ¥è¯¢(c=10)çš„å‘å³éå†, ä¼šé€€åŒ–æˆé—´éš™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70566,"user_name":"Bennet","can_delete":false,"product_type":"c1","uid":1022801,"ip_address":"","ucode":"C85C47A75BA412","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXYib4bOBtUeLniaqjMNaOY4gDPPbL4hYmv1HYHSPibyHVQlAeWhabABIy0YL7qgOqaa8EibxGSoiaw1w/132","comment_is_top":false,"comment_ctime":1551141869,"is_pvip":false,"replies":[{"id":"25181","content":" insert(id&amp;gt;5, c=5, 50)<br><br>è¿™ä¸ªå†™æ³•æ²¡çœ‹æ‡‚ã€‚ã€‚ä½ å†™å®Œæ•´çš„è¯­å¥å‡ºæ¥å“ˆã€‚<br><br>æœ€å¥½æŠŠå¤ç°æ­¥éª¤çš„å‰æ–‡ä¹Ÿå†™å‡ºæ¥ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551143192,"ip_address":"","comment_id":70566,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551141869","product_id":100020801,"comment_content":"è€å¸ˆæ—©ï¼Œæ­£åœ¨æ‹¼å‘½è¡¥è¯¾ï¼Œæœ‰ä¸ªç–‘é—®ï¼š<br><br>æ¡ˆä¾‹å…­ä¸­æœ€åçš„ç»“è®ºï¼šâ€œè¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (c=5,id=5) å’Œ (c=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”ã€‚â€<br>å®éªŒç»“æœï¼š insert(id&gt;5, c=5, 50) éƒ½ä¼š blockï¼Œä½†æ˜¯ insert(id&gt;5, c=15, 50) successï¼Œæ²¡æœ‰å¤ªèƒ½ç†è§£ c=5 è¿™ä¸ªé”çš„æƒ…å†µã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440696,"discussion_content":" insert(id&amp;amp;gt;5, c=5, 50)\n\nè¿™ä¸ªå†™æ³•æ²¡çœ‹æ‡‚ã€‚ã€‚ä½ å†™å®Œæ•´çš„è¯­å¥å‡ºæ¥å“ˆã€‚\n\næœ€å¥½æŠŠå¤ç°æ­¥éª¤çš„å‰æ–‡ä¹Ÿå†™å‡ºæ¥ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551143192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62993,"user_name":"happyæ¶›","can_delete":false,"product_type":"c1","uid":1387892,"ip_address":"","ucode":"9D67FA68C40904","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaxhA2xdIRKUeRaiaMAVxrGJcImhY0qWoDJbLLW3l8uCvXicrHJ4GaRBkZBz4RAdaSh0YsIOJFyrhQ/132","comment_is_top":false,"comment_ctime":1548222874,"is_pvip":false,"replies":[{"id":"22270","content":"ä¸æ˜¯å“¦<br>æ¡ˆä¾‹äºŒçš„è¯­å¥æ˜¯  where c=5 lock in share mode, è¿™ä¸ªåœ¨cä¸Šçš„åŠ é”èŒƒå›´æ˜¯(5,10)","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548239230,"ip_address":"","comment_id":62993,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548222874","product_id":100020801,"comment_content":"è€å¸ˆï¼š<br>æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”ï¼Œè¿™ä¸ªæ–‡ç« ä¸­ï¼Œäº‹ç‰©AåŠ è¯»å–ä¹‹åï¼Œ æŒ‰æ‚¨çš„æ–‡ç« èµ°ï¼Œæœ€åç»“æœåŠ çš„æ˜¯ï¼ˆ5ï¼Œ10ï¼‰é—´éš™é”ï¼Œ ä½†æˆ‘è¿™é‡Œä¸ºä»€ä¹ˆæ’å…¥ï¼Œcä»[0,9)éƒ½ä¸èƒ½æ’å…¥ã€‚<br>mysqlç‰ˆæœ¬æ˜¯8.0.12,éš”ç¦»çº§åˆ«æ˜¯RRï¼Œè¡¨ç”¨çš„æ˜¯æ‚¨çš„ä¾‹å­ï¼Œæ•°æ®ä¹Ÿæ˜¯ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437430,"discussion_content":"ä¸æ˜¯å“¦\næ¡ˆä¾‹äºŒçš„è¯­å¥æ˜¯  where c=5 lock in share mode, è¿™ä¸ªåœ¨cä¸Šçš„åŠ é”èŒƒå›´æ˜¯(5,10)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548239230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57876,"user_name":"neptunesong","can_delete":false,"product_type":"c1","uid":1058431,"ip_address":"","ucode":"6592C8724B3D95","user_header":"","comment_is_top":false,"comment_ctime":1546933602,"is_pvip":false,"replies":[{"id":"21114","content":"æˆ‘æ˜¯è¿™ä¹ˆéªŒè¯çš„ï¼Œ <br>session A:<br>begin;<br>delete from t1 where pubtime&gt;1 and pubtime&lt;20 and userid=&#39;hdc&#39; and comment is not null;<br><br>sessionB:<br>update t1 set  comment=&#39;a&#39; where  pubtime=20 and userid=&#39;bbb&#39;;<br>(blocked)<br><br>ä½ çš„éªŒè¯æ–¹æ³•è´´ä¸€ä¸‹<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547118857,"ip_address":"","comment_id":57876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546933602","product_id":100020801,"comment_content":"ä¹‹å‰é—®è¿‡æ‚¨è¿™ç¯‡æ–‡ç« http:&#47;&#47;hedengcheng.com&#47;?p=771ä¸­å…³äº&quot;ä¸€ä¸ªå¤æ‚çš„sql&quot;ä¾‹å­ï¼Œä¸çŸ¥æ‚¨æ˜¯å¦è¿˜è®°å¾—ã€‚æˆ‘æŒ‰ç…§æ‚¨è¯´çš„è¿›è¡Œpubtime=20è¿›è¡Œæµ‹è¯•ï¼Œæ²¡æœ‰å‘ç°è¢«lockä½ï¼Œè¯´æ˜é’ˆå¯¹pubtime&lt;20åŠ çš„æ˜¯gapé”ï¼Œä¸æ˜¯next keyé”ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬æ¡ˆä¾‹4ä¸­åœºæ™¯ä¸€æ ·ï¼Œä½†ç»“æœä¸ä¸€æ ·ã€‚ä¸ç¡®å®šæ˜¯å“ªé‡Œæƒ³é”™äº†ã€‚æ±‚è§£æƒ‘ï¼š)","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435804,"discussion_content":"æˆ‘æ˜¯è¿™ä¹ˆéªŒè¯çš„ï¼Œ \nsession A:\nbegin;\ndelete from t1 where pubtime&amp;gt;1 and pubtime&amp;lt;20 and userid=&amp;#39;hdc&amp;#39; and comment is not null;\n\nsessionB:\nupdate t1 set  comment=&amp;#39;a&amp;#39; where  pubtime=20 and userid=&amp;#39;bbb&amp;#39;;\n(blocked)\n\nä½ çš„éªŒè¯æ–¹æ³•è´´ä¸€ä¸‹\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547118857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57825,"user_name":"ç† è¾°","can_delete":false,"product_type":"c1","uid":1305373,"ip_address":"","ucode":"BEB9B0BD2A2790","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJibUzUHAI2Fe5aq2JZ1UiceYv54icGMt9uQsbViadOibPllsQOyoRcto4TXicNbVvUZYfAhrbicVb6GlSWw/132","comment_is_top":false,"comment_ctime":1546918232,"is_pvip":false,"replies":[{"id":"21111","content":"å¯¹ï¼Œä¸»é”®ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€ç§ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªè§„åˆ™é‡Œé¢æ˜¯ä¸€æ ·çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547118273,"ip_address":"","comment_id":57825,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546918232","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œéº»çƒ¦é—®ä¸‹å¯¹äºè§„åˆ™å½“ä¸­ï¼Œä¼˜åŒ–1ä¸­é’ˆå¯¹çš„å”¯ä¸€ç´¢å¼•åŠ é”ï¼Œè¿™å—ï¼Œå¯¹äºä¸»é”®ç´¢å¼•æ˜¯å¦ä¹Ÿå¯ä»¥ç†è§£ä¸ºå”¯ä¸€ç´¢å¼•çš„åŠ é”è§„åˆ™ï¼Œå¯¹äºæ¡ˆä¾‹2æœ€åselect idæ›´æ”¹ä¸ºselect dæµ‹è¯•ï¼Œupdateä¼šè¢«é˜»å¡ï¼Œå¦‚æœæŒ‰ç…§ä¼˜åŒ–1çš„è§„åˆ™çœ‹çš„è¯ï¼Œæ˜¯å› ä¸ºå­˜åœ¨çš„è¡Œé”å¯¼è‡´çš„é˜»å¡ï¼Œä¸çŸ¥é“æ˜¯å¦ç†è§£çš„æ­£ç¡®ï¼Œå¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ï¼ï¼ï¼","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435777,"discussion_content":"å¯¹ï¼Œä¸»é”®ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€ç§ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªè§„åˆ™é‡Œé¢æ˜¯ä¸€æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547118273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57217,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1546687632,"is_pvip":false,"replies":[{"id":"20642","content":"è¿™ä¸ªå°±æ˜¯å…¸å‹çš„lock ... for updateä¼šå‡ºç°çš„é—®é¢˜ã€‚è¿™ä¸¤ä¸ªäº‹åŠ¡çš„åŠ é”é¡ºåºæ²¡æœ‰ä¿æŒä¸€è‡´ã€‚<br><br>å…ˆå›ç­”ä½ ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€ä¸ªdeleteè¯­å¥ï¼Œå¯ä¸åªæ˜¯ä¼šé”bikeid è¿™ä¸ªç´¢å¼•å“¦ï¼Œå‡è®¾è¦åˆ é™¤çš„è¡Œçš„æ—¶é—´å­—æ®µå€¼æ˜¯Tï¼Œä¹Ÿä¼šå»idx_timeçš„Tä¸ŠåŠ è¡Œé”çš„ã€‚<br><br>å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯æ”¹å˜é”é¡ºåºã€‚åªè€ƒè™‘è¿™ä¸¤ä¸ªè¯­å¥çš„è¯ï¼Œtransaction 2æŸ¥å‡ºbikeidå¯¹åº”çš„Tå€¼ï¼Œå…ˆå»æ‰§è¡Œä¸€ä¸ªwhere update_time=T for update.<br><br>ä¸è¿‡ä¸€èˆ¬å¦‚æœæ­»é”ä¸ä¸¥é‡ï¼Œé—®é¢˜ä¸å¤§ï¼Œé‡è¯•äº‹åŠ¡å°±å¯ä»¥äº†ã€‚<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546695622,"ip_address":"","comment_id":57217,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546687632","product_id":100020801,"comment_content":"--<br>LATEST DETECTED DEADLOCK<br>--<br>2018-12-18 21:03:25 0x7f33248e0700<br>*** (1) TRANSACTION:<br>TRANSACTION 404074133, ACTIVE 1 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)<br>MySQL thread id 176, OS thread handle 139857630418688, query id 36851897 127.0.0.1 user001 Sending data<br>select<br>        bikeId, lat, lng, update_time, state, accuracy<br>        from mbk_location_rawdata<br>        where state = 0<br>         and update_time&lt;&#39;2018-12-18 20:57:25&#39; <br>        LIMIT 500<br>        for update&#47;*user001*&#47;<br>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 29488 page no 269 n bits 344 index PRIMARY of table `mbk_bike`.`mbk_location_rawdata` trx id 404074133 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 23 PHYSICAL RECORD: n_fields 9; compact format; info bits 32<br>*** (2) TRANSACTION:<br>TRANSACTION 404074140, ACTIVE 0 sec updating or deleting<br>mysql tables in use 1, locked 1<br>4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 1<br>MySQL thread id 165, OS thread handle 139857633347328, query id 36851918 127.0.0.1 user001 updating<br>delete from mbk_location_rawdata<br>        where bikeId = &#39;aMho6x8BtC&#39;&#47;*user001*&#47;<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 29488 page no 269 n bits 344 index PRIMARY of table `mbk_bike`.`mbk_location_rawdata` trx id 404074140 lock_mode X locks rec but not gap<br>Record lock, heap no 23 PHYSICAL RECORD: n_fields 9; compact format; info bits 32<br> *** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 29488 page no 201 n bits 1000 index idx_time of table `mbk_bike`.`mbk_location_rawdata` trx id 404074140 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 105 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br>*** WE ROLL BACK TRANSACTION (1)<br>------------<br>TRANSACTIONS<br>é—®é¢˜ï¼š<br>1.å‘ç”Ÿæ­»é”çš„åŸå› ï¼Ÿ<br>2.æ­»é”æ—¥å¿—transaction2é‡Œdeleteè¯­å¥çš„æ¡ä»¶æ˜¯bikeIdï¼Œå°±ç®—è·å–é”ä¹Ÿæ˜¯è·å–bikeIdçš„ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæ­»é”æ—¥å¿—é‡Œé¡¹[WAITING FOR THIS LOCK TO BE GRANTED] æ˜¯indx_time,è¿™æ˜¯æˆ‘æœ€ç–‘æƒ‘çš„åœ°æ–¹<br>å¸Œæœ›è€å¸ˆæ‹¯æ•‘æˆ‘ï¼Œä¸€ç›´æ²¡æƒ³é€šï¼Œç½‘ä¸Šä¹Ÿæ²¡æœ‰æœåˆ°ç±»ä¼¼çš„é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435466,"discussion_content":"è¿™ä¸ªå°±æ˜¯å…¸å‹çš„lock ... for updateä¼šå‡ºç°çš„é—®é¢˜ã€‚è¿™ä¸¤ä¸ªäº‹åŠ¡çš„åŠ é”é¡ºåºæ²¡æœ‰ä¿æŒä¸€è‡´ã€‚\n\nå…ˆå›ç­”ä½ ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€ä¸ªdeleteè¯­å¥ï¼Œå¯ä¸åªæ˜¯ä¼šé”bikeid è¿™ä¸ªç´¢å¼•å“¦ï¼Œå‡è®¾è¦åˆ é™¤çš„è¡Œçš„æ—¶é—´å­—æ®µå€¼æ˜¯Tï¼Œä¹Ÿä¼šå»idx_timeçš„Tä¸ŠåŠ è¡Œé”çš„ã€‚\n\nå¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯æ”¹å˜é”é¡ºåºã€‚åªè€ƒè™‘è¿™ä¸¤ä¸ªè¯­å¥çš„è¯ï¼Œtransaction 2æŸ¥å‡ºbikeidå¯¹åº”çš„Tå€¼ï¼Œå…ˆå»æ‰§è¡Œä¸€ä¸ªwhere update_time=T for update.\n\nä¸è¿‡ä¸€èˆ¬å¦‚æœæ­»é”ä¸ä¸¥é‡ï¼Œé—®é¢˜ä¸å¤§ï¼Œé‡è¯•äº‹åŠ¡å°±å¯ä»¥äº†ã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546695622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57216,"user_name":"è¿›é˜¶çš„ç å†œ","can_delete":false,"product_type":"c1","uid":1017821,"ip_address":"","ucode":"D8991282640334","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg","comment_is_top":false,"comment_ctime":1546687630,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546687630","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½é—®ä¸€ä¸ªæœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°çš„æ­»é”ï¼Œå›°æ‰°äº†æˆ‘å¥½ä¹…ï¼Œä¸€ç›´ä¸çŸ¥é“åŸå› ï¼Œä¸‹é¢ç»™å‡ºéš”ç¦»çº§åˆ«ã€è¡¨ç»“æ„ã€ä¸šåŠ¡é€»è¾‘ã€æ­»é”log<br>1.éš”ç¦»çº§åˆ« <br>rc<br>2.è¡¨ç»“æ„<br>CREATE TABLE `mbk_location_rawdata` (<br>  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,<br>  `bikeId` varchar(15) NOT NULL,<br>  `lat` decimal(11,8) NOT NULL DEFAULT &#39;0.00000000&#39; ,<br>  `lng` decimal(11,8) NOT NULL DEFAULT &#39;0.00000000&#39;,<br>  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP &#39;,<br>  `state` int(8) NOT NULL DEFAULT &#39;0&#39; ,<br>  `accuracy` smallint(6) NOT NULL DEFAULT &#39;0&#39; ,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uniq_bikeid` (`bikeId`),<br>  KEY `idx_time` (`update_time`) USING BTREE,<br>  KEY `idx_state` (`state`)<br>) ENGINE=InnoDB AUTO_INCREMENT=8897633 DEFAULT CHARSET=utf8 <br>3.ä¸šåŠ¡é€»è¾‘<br>@Transaction <br>processData(timeParam){<br>&#47;&#47;å¯¹åº”sql  select * from test_rawdata where state=0 and update_time&lt;timeParam for update limit 500;<br>bikeIds = findForUpdate();<br>&#47;&#47;å–å‡ºæ•°æ®ï¼Œç„¶åå…ˆçŠ¶æ€æ”¹æˆ2<br>&#47;&#47;å¯¹åº”sql update test_rawdata set state = 2 where bikeId in(bikeIds);<br>updateData(bikeIds);<br>}<br>@Transaction<br>deleteData(bikeIdParam){<br>&#47;&#47;sql     delete from mbk_location_rawdata<br>        where bikeId = bikeIdParam<br>}<br>ç•™è¨€å¤ªé•¿ï¼Œä¸‹è¾¹ä¸€æ¡è·Ÿç€æ­»é”æ—¥å¿—","like_count":0},{"had_liked":false,"id":56754,"user_name":"ç§¦å²­","can_delete":false,"product_type":"c1","uid":1103644,"ip_address":"","ucode":"E4C324C08A9DA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/1c/f539a8aa.jpg","comment_is_top":false,"comment_ctime":1546551937,"is_pvip":false,"replies":[{"id":"21082","content":"åœ¨id=15è¿™ä¸ªcaseé‡Œæˆ‘ä¹Ÿè§‰å¾—æ˜¯bug ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547100936,"ip_address":"","comment_id":56754,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546551937","product_id":100020801,"comment_content":"ä¸æ˜ç™½ä¸ºä»€ä¹ˆèŒƒå›´åŠ é”çš„æ—¶å€™è¦æŠŠæœ€åé‚£ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼åŠ é”ï¼Œä¾‹å¦‚æ¡ˆä¾‹ä¸‰ä¸­çš„id=15,æ¡ˆä¾‹å››ä¸­çš„c=15è¿™ä¸¤ä¸ªè¡Œé”ï¼Œæˆ‘åœ¨æƒ³å¦‚æœä¸åŠ é”å¹¶ç”±å¦å¤–sessionåˆ é™¤è¿™ä¸ªå€¼åº”è¯¥ä¹Ÿä¸ä¼šå‡ºç°å¹»è¯»å‘€","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435214,"discussion_content":"åœ¨id=15è¿™ä¸ªcaseé‡Œæˆ‘ä¹Ÿè§‰å¾—æ˜¯bug ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547100936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56738,"user_name":"neptunesong","can_delete":false,"product_type":"c1","uid":1058431,"ip_address":"","ucode":"6592C8724B3D95","user_header":"","comment_is_top":false,"comment_ctime":1546532153,"is_pvip":false,"replies":[{"id":"20469","content":"ä½ å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥éªŒè¯ä¸€ä¸‹ï¼š<br>update t1 set  comment=&#39;a&#39; where  pubtime=20 and userid=&#39;bbb&#39; limit 1;<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546564280,"ip_address":"","comment_id":56738,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546532153","product_id":100020801,"comment_content":"é“æ­‰æå®¢å¥½åƒä¸èƒ½ç•™è¨€ç”¨å›¾ç‰‡æˆªå›¾ï¼Œåªèƒ½ç”¨æ–‡å­—ï¼Œæ‰€ä»¥æˆ‘ç²˜è´´é“¾æ¥äº†ã€‚å¯¹æ¯”ç€ä½•ç™»æˆåœ¨https:&#47;&#47;www.cnblogs.com&#47;metoy&#47;p&#47;8073303.htmlæåˆ°çš„ï¼Œåœ¨å…¶æœ€åç”¨ä¾‹ï¼ˆä¸€æ¡å¤æ‚çš„SQL)æè¿°ï¼Œâ€œç”±Index Keyæ‰€ç¡®å®šçš„èŒƒå›´ï¼Œè¢«åŠ ä¸Šäº†GAPé”â€ã€‚æˆ‘ç†è§£ä»–çš„ç”¨ä¾‹å’Œæˆ‘ä»¬çš„ç”¨ä¾‹4åº”è¯¥æ˜¯ä¸€ä¸ªåœºæ™¯çš„ã€‚ä½†æˆ‘ä»¬è¿™é‡Œç”¨äº†nextkeyä¸ä»…æ˜¯gapã€‚æˆ‘ä¸ç¡®å®šæˆ‘ç†è§£çš„å¯¹è¿™ä¸¤ä¸ªåœºæ™¯æœ‰ä»€ä¹ˆä¸åŒä¼šå¯¼è‡´whereåé¢çš„indexkeyåŠ é”æœ‰ä¸åŒå—ï¼Ÿè¿˜æ˜¯æœ¬èº«è¿™ç¯‡é“¾æ¥æ–‡ç« åœ¨è¿™ä¸ªç‚¹ä¸Šåˆ†æé”™äº†ï¼Ÿè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435204,"discussion_content":"ä½ å¯ä»¥ç”¨è¿™ä¸ªè¯­å¥éªŒè¯ä¸€ä¸‹ï¼š\nupdate t1 set  comment=&amp;#39;a&amp;#39; where  pubtime=20 and userid=&amp;#39;bbb&amp;#39; limit 1;\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546564280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56661,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1546518635,"is_pvip":false,"replies":[{"id":"20425","content":"è¿™ä¸ªä½ è¦é…åˆç´¢å¼•ç»“æ„å’Œæ‰§è¡Œæµæ¥æƒ³å“ˆã€‚<br>æ¯”å¦‚æŸ¥è¯¢æ˜¯where c&lt;=10 for updateï¼Œ é‚£å°±æ˜¯å…ˆæ‰¾cçš„æœ€å°å€¼ï¼Œç„¶åå‘å³éå†åˆ°c&gt;10çš„ç¬¬ä¸€ä¸ªè®°å½•ï¼Œå¯¹å§ã€‚<br><br>å†é…åˆä¸Šâ€œè®¿é—®è¿‡çš„èµ„æºéƒ½åŠ é”â€æ¥åˆ†æ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546524874,"ip_address":"","comment_id":56661,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546518635","product_id":100020801,"comment_content":"è€å¸ˆï¼Œèƒ½æ€»ç»“ä¸‹ä»€ä¹ˆæ—¶å€™å‘å³æ‰«æä»€ä¹ˆæ—¶å€™å‘å·¦æ‰«æå—ï¼Ÿæ„Ÿè§‰æœ‰ç‚¹æ™•ã€‚æ¯”å¦‚è¯´å¯¹äºèŒƒå›´æŸ¥è¯¢éå”¯ä¸€ç´¢å¼•çš„æƒ…å†µï¼ŒæŸ¥è¯¢c&lt;=10 for updateï¼Œæ˜¯å…ˆè¿›è¡Œç­‰å€¼æŸ¥è¯¢æŸ¥åˆ°(5,10]è¿™ä¸ªåŒºé—´ï¼Œç„¶åæ ¹æ®ä¼˜åŒ–äºŒé€€åŒ–æˆgapé”ï¼Œç„¶åå†å‘å·¦æ‰«æå—ï¼Ÿå¦‚æœæ˜¯æŸ¥è¯¢c&lt;10åˆæ˜¯æ€æ ·çš„åŠ é”æµç¨‹å‘¢ï¼Ÿè¿˜ä¼šå…ˆè¿›è¡Œç­‰å€¼æŸ¥è¯¢å—ï¼Ÿæ‹œæ‰˜è€å¸ˆç»™è§£ä¸€ä¸‹æƒ‘ï¼Œç™¾æ€ä¸å¾—å…¶è§£ï¼Œè¾›è‹¦è€å¸ˆäº†ğŸ˜€ğŸ˜™","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435174,"discussion_content":"è¿™ä¸ªä½ è¦é…åˆç´¢å¼•ç»“æ„å’Œæ‰§è¡Œæµæ¥æƒ³å“ˆã€‚\næ¯”å¦‚æŸ¥è¯¢æ˜¯where c&amp;lt;=10 for updateï¼Œ é‚£å°±æ˜¯å…ˆæ‰¾cçš„æœ€å°å€¼ï¼Œç„¶åå‘å³éå†åˆ°c&amp;gt;10çš„ç¬¬ä¸€ä¸ªè®°å½•ï¼Œå¯¹å§ã€‚\n\nå†é…åˆä¸Šâ€œè®¿é—®è¿‡çš„èµ„æºéƒ½åŠ é”â€æ¥åˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546524874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56624,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1546509437,"is_pvip":false,"replies":[{"id":"20432","content":"ä¸æ˜¯å…ˆåŠ å†é‡Šæ”¾ï¼Œå°±æ˜¯ç›´æ¥â€œåªåŠ â€<br><br>å‰é¢é‚£ä¸ªç†è§£ä¸å¤ªå¯¹ ï¼Œè¿™ä¸ªæˆ‘ä¼šå®‰æ’åˆ°åé¢çš„æ–‡ç« ä¸­è¯´","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546525737,"ip_address":"","comment_id":56624,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546509437","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹å››ä¸­ssesionAçš„sqlå¦‚æœæ”¹ä¸ºselect * from t where c&lt;15 for updateï¼Œåˆ™åŠ é”è¿‡ç¨‹æ˜¯å…ˆåšç­‰å€¼æŸ¥è¯¢å¯¹(10,15]åŠ nextkeyé”ï¼Œæ ¹æ®ä¼˜åŒ–æ¡ä»¶äºŒï¼Œnextkeyé”é€€åŒ–ä¸ºgapé”ï¼Œä¹‹åå†å‘å·¦æ‰«æï¼Œä¾æ¬¡å¯¹(5,10]ï¼Œ(0,5],(è´Ÿæ— ç©·ï¼Œ0]åŠ nextkeyé”ï¼Œæ˜¯è¿™æ ·çš„å—ï¼Ÿè¿˜æœ‰å…³äºnextkeyé”é€€åŒ–æˆgapé”æˆ–è¡Œé”çš„è¿‡ç¨‹æ˜¯å…ˆåŠ nextkeyé”ç„¶åå†é‡Šæ”¾gapé”æˆ–è¡Œé”è¿˜æ˜¯åœ¨åŠ é”çš„æ—¶å€™å°±ç›´æ¥åŠ gapé”å’Œè¡Œé”ï¼ŸğŸ¤”","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435154,"discussion_content":"ä¸æ˜¯å…ˆåŠ å†é‡Šæ”¾ï¼Œå°±æ˜¯ç›´æ¥â€œåªåŠ â€\n\nå‰é¢é‚£ä¸ªç†è§£ä¸å¤ªå¯¹ ï¼Œè¿™ä¸ªæˆ‘ä¼šå®‰æ’åˆ°åé¢çš„æ–‡ç« ä¸­è¯´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546525737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56614,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1546506035,"is_pvip":false,"replies":[{"id":"20435","content":"ä¸€å¼€å§‹æˆ‘ç¢°åˆ°è¿™äº›caseä¹Ÿæ˜¯è§‰å¾—æ¯ä¸‰è§‚ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546526945,"ip_address":"","comment_id":56614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546506035","product_id":100020801,"comment_content":"è¯»åˆ°è¿™é‡Œï¼Œæ„Ÿè§‰è·Ÿä¹‹å‰è‡ªå·±çš„è®¤çŸ¥ç›¸å·®å¾ˆå¤§ï¼ŒåŸæ¥mysqlä¹Ÿæœ‰è¿™ä¹ˆå¤§å­¦é—®ï¼Œæ„Ÿè°¢è€å¸ˆï¼","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435148,"discussion_content":"ä¸€å¼€å§‹æˆ‘ç¢°åˆ°è¿™äº›caseä¹Ÿæ˜¯è§‰å¾—æ¯ä¸‰è§‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546526945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56605,"user_name":"ä¸€å—è·‘è·‘","can_delete":false,"product_type":"c1","uid":1177796,"ip_address":"","ucode":"576EC5A37721FD","user_header":"https://static001.geekbang.org/account/avatar/00/11/f8/c4/c7f665df.jpg","comment_is_top":false,"comment_ctime":1546504600,"is_pvip":false,"replies":[{"id":"20420","content":"ä¼˜åŒ–2åªæ˜¯é’ˆå¯¹ç­‰å€¼æŸ¥è¯¢å“¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546514857,"ip_address":"","comment_id":56605,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546504600","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹5ä¸­ï¼Œ(15,20] ä¸Šé”åï¼Œæ ¹æ®ä¼˜åŒ– 2 ä¸æ˜¯ä¼šé€€åŒ–æˆé—´éš™é” (15,20) ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435142,"discussion_content":"ä¼˜åŒ–2åªæ˜¯é’ˆå¯¹ç­‰å€¼æŸ¥è¯¢å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546514857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56556,"user_name":"é¾™æ–‡","can_delete":false,"product_type":"c1","uid":1303084,"ip_address":"","ucode":"D987E8F706FB1D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/2c/0d04f87b.jpg","comment_is_top":false,"comment_ctime":1546487569,"is_pvip":false,"replies":[{"id":"20394","content":"è¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œä¼šåœ¨åé¢çš„æ–‡ç« è¯´å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546491306,"ip_address":"","comment_id":56556,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546487569","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œå¯å¦å¸®å¿™çœ‹ä¸€ä¸ªæ­»é”é—®é¢˜<br>è¡¨ç»“æ„ï¼š<br>CREATE TABLE `uk_test` (<br>  `id` bigint(20) NOT NULL AUTO_INCREMENT,<br>  `a` int(11) NOT NULL,<br>  `b` int(11) NOT NULL,<br>  `c` int(11) NOT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_a_b` (`a`,`b`) USING BTREE<br>) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4<br>è¡¨ä¸­æ•°æ®ï¼š<br>+----+---+---+---+<br>| id | a | b | c |<br>+----+---+---+---+<br>|  1 | 1 | 1 | 2 |<br>|  6 | 1 | 2 | 1 |<br>+----+---+---+---+<br>éš”ç¦»çº§åˆ«ä¸ºrc<br>sql:æ‰§è¡Œé¡ºåº<br>session1:begin;<br>session2:begin;<br>session1:select * from uk_test where a = 1 and b = 1 for update;<br>session2:select * from uk_test where a = 1 and b = 1 for update;<br>session1:insert into uk_test (a,b,c) values(1,1,2) on duplicate key update c = 2;<br>session2:ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction<br>æ­»é”ä¿¡æ¯ï¼š<br>*** (1) TRANSACTION:<br>TRANSACTION 38988310, ACTIVE 5 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 2 lock struct(s), heap size 360, 1 row lock(s)<br>MySQL thread id 215, OS thread handle 0x7000061a7000, query id 1030 localhost root statistics<br>select * from uk_test where a = 1 and b = 1 for update<br>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 837 page no 4 n bits 72 index `uk_a_b` of table `innodb_test`.`uk_test` trx id 38988310 lock_mode X locks rec but not gap waiting<br>*** (2) TRANSACTION:<br>TRANSACTION 38988309, ACTIVE 16 sec inserting<br>mysql tables in use 1, locked 1<br>4 lock struct(s), heap size 1184, 3 row lock(s), undo log entries 1<br>MySQL thread id 35, OS thread handle 0x70000611f000, query id 1033 localhost root update<br>insert into uk_test (a,b,c) values(1,1,2) on duplicate key update c = 2<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 837 page no 4 n bits 72 index `uk_a_b` of table `innodb_test`.`uk_test` trx id 38988309 lock_mode X locks rec but not gap<br>*** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 837 page no 4 n bits 72 index `uk_a_b` of table `innodb_test`.`uk_test` trx id 38988309 lock_mode X waiting<br>*** WE ROLL BACK TRANSACTION (1)<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435115,"discussion_content":"è¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œä¼šåœ¨åé¢çš„æ–‡ç« è¯´å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546491306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56501,"user_name":"Stalary","can_delete":false,"product_type":"c1","uid":1101749,"ip_address":"","ucode":"F69AFF7C958D31","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/b5/d1ec6a7d.jpg","comment_is_top":false,"comment_ctime":1546478628,"is_pvip":false,"replies":[{"id":"20369","content":"æ”¹æˆå°æ‰¹é‡ï¼Œæ­»é”äº†å°±é‡è¯•å§<br><br>å¦å¤–å¦‚æœå¯ä»¥å¯¹æ•°æ®åšä¸€ä¸‹é¢„å¤„ç†ï¼Œå‡å°‘ä¸»é”®å†²çªçš„æ¦‚ç‡ï¼Œä¹Ÿå¯ä»¥å‡å°‘æ­»é”æ¦‚ç‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546481489,"ip_address":"","comment_id":56501,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546478628","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æ›¾ç»é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨å¯é‡å¤è¯»çš„äº‹ç‰©çº§åˆ«ä¸‹ï¼Œæœ‰ä¸€ä¸ªæ‰¹é‡æ’å…¥çš„æ–¹æ³•ï¼Œæˆ‘ä½¿ç”¨äº†insert ignoreï¼Œä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸‹å‘ç”Ÿäº†æ­»é”ï¼Œç°åœ¨æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢æ­»é”ï¼Œæƒ³é—®ä¸€ä¸‹æœ‰ä»€ä¹ˆæ›´å¥½çš„è§£å†³åŠæ³•å˜›","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435074,"discussion_content":"æ”¹æˆå°æ‰¹é‡ï¼Œæ­»é”äº†å°±é‡è¯•å§\n\nå¦å¤–å¦‚æœå¯ä»¥å¯¹æ•°æ®åšä¸€ä¸‹é¢„å¤„ç†ï¼Œå‡å°‘ä¸»é”®å†²çªçš„æ¦‚ç‡ï¼Œä¹Ÿå¯ä»¥å‡å°‘æ­»é”æ¦‚ç‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546481489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56414,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1008071,"ip_address":"","ucode":"9FE5F43055D3AB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/c7/b64ac05e.jpg","comment_is_top":false,"comment_ctime":1546440360,"is_pvip":false,"replies":[{"id":"20329","content":"ä¸»é”®ç´¢å¼•","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546442547,"ip_address":"","comment_id":56414,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546440360","product_id":100020801,"comment_content":"é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œå¦‚æœæŸä¸ªå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ˜¯é”è¡¨ä¹ˆ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435027,"discussion_content":"ä¸»é”®ç´¢å¼•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546442547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56392,"user_name":"rains","can_delete":false,"product_type":"c1","uid":1276520,"ip_address":"","ucode":"540BB449B0D52F","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/68/d6b53fbb.jpg","comment_is_top":false,"comment_ctime":1546435148,"is_pvip":false,"replies":[{"id":"20300","content":"ä¼šé”æ‰€æœ‰è¡Œï¼Œä½ çš„éš”ç¦»çº§åˆ«å’ŒéªŒè¯æ–¹æ³•è´´ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546437615,"ip_address":"","comment_id":56392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546435148","product_id":100020801,"comment_content":"ä¸€ä¸ªæ›´æ–°è¯­å¥ï¼Œwhereæ¡ä»¶ä¸­çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆåº”è¯¥å…¨è¡¨æ‰«æï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€è¿™ä¸ªè¯­å¥è¦é”å…¨éƒ¨çš„è¡Œå‘¢ï¼Ÿå®é™…æ‰§è¡Œå‘ç°ï¼Œå¹¶æ²¡æœ‰è¿™æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435015,"discussion_content":"ä¼šé”æ‰€æœ‰è¡Œï¼Œä½ çš„éš”ç¦»çº§åˆ«å’ŒéªŒè¯æ–¹æ³•è´´ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546437615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56347,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1546426571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546426571","product_id":100020801,"comment_content":"æ­¤ç¯‡éœ€è¦åå¤é˜…è¯»å­¦ä¹ ","like_count":0},{"had_liked":false,"id":56278,"user_name":"è ¢è ¢æ¬²åŠ¨çš„è…¹è‚Œ","can_delete":false,"product_type":"c1","uid":1007326,"ip_address":"","ucode":"B10550BF463017","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/de/4e7ec66d.jpg","comment_is_top":false,"comment_ctime":1546415759,"is_pvip":false,"replies":[{"id":"20259","content":"æ²¡æœ‰æ‰¾åˆ°åœ°æ–¹ï¼Œå…ˆè‡ªå·±åˆ†æå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546421397,"ip_address":"","comment_id":56278,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546415759","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½<br>è¯·é—®ä¸‹mysqlä¸­å¦‚ä½•æŸ¥çœ‹é—´éš™é”å’Œnext key locké”ä½çš„åŒºé—´å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434972,"discussion_content":"æ²¡æœ‰æ‰¾åˆ°åœ°æ–¹ï¼Œå…ˆè‡ªå·±åˆ†æå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546421397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56128,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1056767,"ip_address":"","ucode":"30300D7B752917","user_header":"https://static001.geekbang.org/account/avatar/00/10/1f/ff/aadcf237.jpg","comment_is_top":false,"comment_ctime":1546395148,"is_pvip":false,"replies":[{"id":"20222","content":"å…¶å®æ˜¯åœ¨å”¯ä¸€ç´¢å¼•ä¸‹æˆ‘ä»¬è®¤ä¸ºä¸åˆç†ï¼Œå”¯ä¸€ç´¢å¼•ä¸ä¼šæœ‰é‡å¤æ•°æ®","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546396498,"ip_address":"","comment_id":56128,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546395148","product_id":100020801,"comment_content":"å…³äºé‚£ä¸ªbugï¼Œå¦‚æœæœ‰å¤šæ¡ç›¸åŒæ•°æ®ï¼Œåˆ¤æ–­ç›´åˆ°ç¬¬ä¸€ä¸ªä¸ç­‰äºä»–çš„å°±æœ‰ç”¨äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434940,"discussion_content":"å…¶å®æ˜¯åœ¨å”¯ä¸€ç´¢å¼•ä¸‹æˆ‘ä»¬è®¤ä¸ºä¸åˆç†ï¼Œå”¯ä¸€ç´¢å¼•ä¸ä¼šæœ‰é‡å¤æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546396498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55974,"user_name":"æŸã€äºº","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1546357915,"is_pvip":false,"replies":[{"id":"20136","content":"æˆ‘è§‰å¾—æ™®é€šç´¢å¼•ä¸ç®—ï¼Œå› ä¸ºæ™®é€šç´¢å¼•ç¡®å®æ˜¯éœ€è¦æ‰«ææ‰«c=10,æ‰èƒ½å†³å®šè¦åœä¸‹æ¥<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546361121,"ip_address":"","comment_id":55974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546357915","product_id":100020801,"comment_content":"é¦–å…ˆç¥è€å¸ˆå…ƒæ—¦å¿«ä¹.ä¸ºè€å¸ˆçš„æ•¬ä¸šç‚¹èµ<br>ä»Šå¤©çš„æ¡ˆä¾‹ç¡®å®å¾ˆæ–°é¢–,æ”¶è·é¢‡å¤šã€‚ç­‰ç©ºäº†å†å¥½å¥½æ€»ç»“ä¸‹<br>è‡³äºè¿™æœŸçš„é—®é¢˜.è¯­å¥è·Ÿselect * from t where id&gt;=15 and id&lt;=20 for updateåŠ é”ç±»ä¼¼ã€‚å…¶å®ä¹‹å‰,æˆ‘ä¹Ÿè§‰å¾—ä¸åº”è¯¥åŠ 10å’Œ25è¿™ä¸ªè¡Œé”,ä¸çŸ¥é“åŠ è¿™ä¸ªè¡Œé”çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚æ—¢ç„¶è€å¸ˆéƒ½è®¤ä¸ºid=10è¡Œé”éƒ½æ˜¯ä¸ªbug,é‚£gapé”(5,10)ä¸å°±æ›´æ˜¯ä¸€ä¸ªbugäº†å˜›ğŸ˜„","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434905,"discussion_content":"æˆ‘è§‰å¾—æ™®é€šç´¢å¼•ä¸ç®—ï¼Œå› ä¸ºæ™®é€šç´¢å¼•ç¡®å®æ˜¯éœ€è¦æ‰«ææ‰«c=10,æ‰èƒ½å†³å®šè¦åœä¸‹æ¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55931,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1546349520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546349520","product_id":100020801,"comment_content":"å°ç»“é‡Œé¢çš„é¢˜ç›®ï¼Œæ²¡æœ‰è¢«é”ä½ã€‚<br>è€å¸ˆä½ é‚£æ€ä¹ˆä¼šè¢«é”ä½ï¼Ÿæ˜¯å†é‡å¤éš”ç¦»çº§åˆ«ä¸‹çš„","like_count":0},{"had_liked":false,"id":55928,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1546349206,"is_pvip":false,"replies":[{"id":"20139","content":"æ˜¯çš„ï¼Œå¦‚æœç”¨ä¸Šç´¢å¼•ï¼Œå‰ä¸¤ä¸ªåŸºæœ¬æ˜¯ç¡®å®šçš„<br><br>&gt;13 and &lt;15è¿˜è¦çœ‹order by çš„é¡ºåº","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546361409,"ip_address":"","comment_id":55928,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546349206","product_id":100020801,"comment_content":"è€å¸ˆ æ‚¨åˆšæ‰å›æˆ‘è¯´ å»ç¬¬ä¸€ä¸ªå€¼æ˜¯æŒ‰ç­‰å€¼æ¥å–çš„ã€‚é‚£ç¬¬ä¸€ä¸ªå€¼æ€ä¹ˆé€‰æ‹©å‘¢ &gt;=13 æ˜¯é€‰æ‹©13å˜› ï¼Œ&lt;=15æ˜¯15å˜› ï¼Œ&gt;13å¹¶ä¸”&lt;15æ˜¯é€‰æ‹©13å˜›","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434886,"discussion_content":"æ˜¯çš„ï¼Œå¦‚æœç”¨ä¸Šç´¢å¼•ï¼Œå‰ä¸¤ä¸ªåŸºæœ¬æ˜¯ç¡®å®šçš„\n\n&amp;gt;13 and &amp;lt;15è¿˜è¦çœ‹order by çš„é¡ºåº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546361409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55908,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1546345132,"is_pvip":false,"replies":[{"id":"20127","content":"ä¸æ˜¯ï¼Œå¦‚æœæ¡ä»¶é‡Œåªæœ‰â€œå°äºç­‰äº15â€ä¹Ÿæ˜¯ä¼šçš„<br><br>å°±æ˜¯æŸ¥è¯¢è¿‡ç¨‹ä¸­â€œå–ç¬¬ä¸€ä¸ªå€¼â€ï¼Œæ˜¯æŒ‰ç…§ç­‰å€¼å»æ‰¾çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546348242,"ip_address":"","comment_id":55908,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546345132","product_id":100020801,"comment_content":"å¯ä¸å¯ä»¥è¿™ä¹ˆç†è§£ Id&gt;= 13 ä¼šå…ˆå»æ‰¾ç­‰äº13çš„ å†æ‰¾å¤§äº13çš„ å¦‚æœæ‰¾åˆ°ç­‰äº13çš„ åˆ™ä¸ºç­‰å€¼æŸ¥è¯¢ ã€‚ä½†å¦‚æœId&lt;=15 çš„å°±ä¸ä¼šå»æ‰¾ç­‰äº15çš„ è€Œæ˜¯ç›´æ¥èŒƒå›´æŸ¥è¯¢ã€‚å¯ä»¥è¿™ä¹ˆç†è§£å— ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434878,"discussion_content":"ä¸æ˜¯ï¼Œå¦‚æœæ¡ä»¶é‡Œåªæœ‰â€œå°äºç­‰äº15â€ä¹Ÿæ˜¯ä¼šçš„\n\nå°±æ˜¯æŸ¥è¯¢è¿‡ç¨‹ä¸­â€œå–ç¬¬ä¸€ä¸ªå€¼â€ï¼Œæ˜¯æŒ‰ç…§ç­‰å€¼å»æ‰¾çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546348242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55905,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1546344770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546344770","product_id":100020801,"comment_content":"å“ˆå“ˆ å¯ä»¥å•Š å¤§å®¶ä¸€èµ·æ€è€ƒ","like_count":0},{"had_liked":false,"id":55878,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1546337477,"is_pvip":false,"replies":[{"id":"20116","content":"å–ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™æ˜¯ç­‰å€¼ï¼Œä¹‹åéå†çš„æ—¶å€™æ˜¯èŒƒå›´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546340730,"ip_address":"","comment_id":55878,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546337477","product_id":100020801,"comment_content":"æ¡ˆä¾‹ä¸‰çš„å¤§äºç­‰äºä¸ºä»€ä¹ˆç®—æ˜¯ç­‰å€¼ï¼Œæ¡ˆä¾‹äº” å°äºç­‰äºå°±æ²¡æœ‰è¿›è¡Œä¼˜åŒ– ç®—æˆäº†èŒƒå›´æŸ¥è¯¢å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434873,"discussion_content":"å–ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™æ˜¯ç­‰å€¼ï¼Œä¹‹åéå†çš„æ—¶å€™æ˜¯èŒƒå›´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546340730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55877,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1546337230,"is_pvip":false,"replies":[{"id":"20117","content":"éœ€è¦å¯¹åº”åˆ°æ‰§è¡Œè¿‡ç¨‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546340758,"ip_address":"","comment_id":55877,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1546337230","product_id":100020801,"comment_content":"æ€ä¹ˆåˆ†åˆ«ä½ æ‰€è¯´çš„ç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢å‘¢ï¼Ÿ&gt;= ç®—ç­‰å€¼è¿˜æ˜¯èŒƒå›´æŸ¥è¯¢å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434872,"discussion_content":"éœ€è¦å¯¹åº”åˆ°æ‰§è¡Œè¿‡ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546340758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164284,"discussion_content":"å–ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™æ˜¯ç­‰å€¼ï¼Œä¹‹åéå†çš„æ—¶å€™æ˜¯èŒƒå›´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581166901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55839,"user_name":"è§è‹¥æ„š","can_delete":false,"product_type":"c1","uid":1081558,"ip_address":"","ucode":"E9AD6D1F65E932","user_header":"https://static001.geekbang.org/account/avatar/00/10/80/d6/1f78bc57.jpg","comment_is_top":false,"comment_ctime":1546323812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546323812","product_id":100020801,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æµ‹è¯•æ•°æ®åº“ä¸Šåš like æ¨¡ç³ŠæŸ¥è¯¢æ—¶å‡ºç°äº†äº›é”™è¯¯çš„ç»“æœï¼Œä¸çŸ¥é“åŸå› æ˜¯ä»€ä¹ˆã€‚<br>é’ˆå¯¹è®°å½• r3 = &#39;åŒ…å«&#47;æŸ¥è¯¢&#39;<br>ï¼ˆ1ï¼‰select * from t where r like &#39;%&#47;&#47;%&#39; escape &#39;&#47;&#39;;  æœªæŸ¥åˆ° b3<br>ï¼ˆ2ï¼‰select * from t where r like &#39;%åŒ…å«&#47;&#47;%&#39; escape &#39;&#47;&#39;; å¯ä»¥æŸ¥åˆ° b3<br>ï¼ˆ3ï¼‰select * from t where r like &#39;%&#47;&#47;æŸ¥è¯¢&#39; escape &#39;&#47;&#39;; ä¹ŸæœªæŸ¥è¯¢åˆ° b3<br>ï¼ˆ4ï¼‰select * from t where r like &#39;%&#47;&#47;&#47;%&#39; escape &#39;&#47;&#39;; æŸ¥è¯¢å¯ä»¥æŸ¥åˆ° b3<br>ä½†æ˜¯åœ¨æœ¬åœ°æ•°æ®åº“æŸ¥æŸ¥è¯¢å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚ä¸¤ä¸ªæ•°æ®åº“éƒ½æ˜¯ç”¨çš„ innodb å¼•æ“ï¼Œå­—ç¬¦é›†éƒ½æ˜¯utf8mb4ã€‚ä½¿ç”¨é»˜è®¤çš„åæ–œæ è½¬ä¹‰å­—ç¬¦æ—¶ï¼Œæœ‰å…³åæ–œæ çš„å¤šä¸ªç›¸å…³æŸ¥è¯¢åœ¨æµ‹è¯•æ•°æ®åº“ä¸Šä¹Ÿæ˜¯å¾—ä¸åˆ°æ­£ç¡®ç»“æœï¼Œæœ¬åœ°æ•°æ®åº“ä¸Šä»æ˜¯å¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœã€‚ç°åœ¨æ²¡æœ‰ä¸€ç‚¹å¤´ç»ªï¼Œå¸Œæœ›èƒ½æŒ‡ç‚¹ä¸€ä¸‹ï¼Œè°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":55818,"user_name":"shaw","can_delete":false,"product_type":"c1","uid":1055165,"ip_address":"","ucode":"4C96304CD8A7CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/19/bd/9a7658a7.jpg","comment_is_top":false,"comment_ctime":1546315398,"is_pvip":true,"replies":[{"id":"20112","content":"ä½ éœ€è¦æŸ¥çœ‹ä¸Šä¸€ç¯‡ğŸ˜„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546323296,"ip_address":"","comment_id":55818,"utype":1}],"discussion_count":2,"race_medal":1,"score":"1546315398","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ¡ˆä¾‹å…«ä¸­session Aå·²ç»åŠ äº†next-key lock (5,10]ï¼Œä¹Ÿå°±æ˜¯(5,10)é—´éš™é”å’Œc=10çš„è¡Œé”ï¼Œä¸ºä»€ä¹ˆsession Bçš„(5,10)é—´éš™é”è¿˜èƒ½åŠ ä¸Šï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434850,"discussion_content":"ä½ éœ€è¦æŸ¥çœ‹ä¸Šä¸€ç¯‡ğŸ˜„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546323296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345770,"discussion_content":"é—´éš™é”ä¸äº’æ–¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611793601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55745,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1546277778,"is_pvip":false,"replies":[{"id":"20097","content":"å“¦ï¼Œå›¾6æˆ‘æ”¹ä¸‹ğŸ‘ğŸ¿<br><br>&lt;è¿™ä¸ªä¸æ˜¯bugçš„ï¼Œæ˜¯è§„åˆ™1ï¼›&lt;=å’Œ&gt;=æˆ‘è§‰å¾—æ˜¯ï¼›<br><br>ç¬¬ä¸‰ä¸ªæ˜¯å¥½é—®é¢˜ã€‚ä¸æ˜¯è¡¨é”ï¼Œè€Œæ˜¯å› ä¸ºå…¨ç´¢å¼•æ‰«æï¼Œæ‰€ä»¥é”ä½äº†ç´¢å¼•cä¸Šæ‰€æœ‰next key lock ã€‚<br><br>æ–°å¹´å¿«ä¹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546303861,"ip_address":"","comment_id":55745,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546277778","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå›¾6ä¸­çš„(id=5,c=5)ç”»äº†ä¸¤åˆ—ï¼Œé‡å¤äº†ã€‚ã€‚ã€‚ã€‚è¿˜æœ‰æ„Ÿè§‰é‚£ä¸ªbugè¡¨è¿°æœ‰æ­§ä¹‰ï¼Œæ¯”å¦‚æŸ¥è¯¢æ¡ä»¶ä¸º&quot;&lt;&quot;çš„æ—¶å€™ï¼Œå°±å¿…é¡»è®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢å•Šï¼Œè¿™æ—¶å€™å°±ä¸æ˜¯bugå•¦ã€‚ã€‚ã€‚æœ€åæ— æ„ä¸­å‘ç°ä¸ªç°è±¡ï¼Œå¦‚æœsession Aæ‰§è¡Œçš„æ˜¯select * from t where c &gt;= 10 and c &lt;= 20 lock in share mode;session Bç”šè‡³æ— æ³•æ‰§è¡Œinsert(2,2,2)çš„ï¼Œè‡ªå·±æ£€æŸ¥å¹¶åˆ†æåŸå› æ˜¯ï¼šä¼˜åŒ–å™¨èˆå¼ƒå›è¡¨ï¼Œé€‰æ‹©äº†éå†ä¸»é”®ç´¢å¼•ï¼Œè¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¯·è€å¸ˆæŒ‡æ­£ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434838,"discussion_content":"å“¦ï¼Œå›¾6æˆ‘æ”¹ä¸‹ğŸ‘ğŸ¿\n\n&amp;lt;è¿™ä¸ªä¸æ˜¯bugçš„ï¼Œæ˜¯è§„åˆ™1ï¼›&amp;lt;=å’Œ&amp;gt;=æˆ‘è§‰å¾—æ˜¯ï¼›\n\nç¬¬ä¸‰ä¸ªæ˜¯å¥½é—®é¢˜ã€‚ä¸æ˜¯è¡¨é”ï¼Œè€Œæ˜¯å› ä¸ºå…¨ç´¢å¼•æ‰«æï¼Œæ‰€ä»¥é”ä½äº†ç´¢å¼•cä¸Šæ‰€æœ‰next key lock ã€‚\n\næ–°å¹´å¿«ä¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546303861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55712,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1546266401,"is_pvip":false,"replies":[{"id":"20091","content":"ï¼Ÿ<br>ç‰¹åˆ«è¯´æ˜äº†å‘€<br>â€œå…¶å®æ˜¯è¿™æ ·çš„ï¼Œsession B çš„â€œåŠ  next-key lock(5,10] â€æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  c=10 çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„ã€‚â€<br><br>æ˜¯ä¸æ˜¯æˆ‘ç†è§£é”™ä½ é—®é¢˜äº†â€¦","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546270346,"ip_address":"","comment_id":55712,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546266401","product_id":100020801,"comment_content":"è¯·é—®æ¡ˆä¾‹å…«ä¸­ï¼Œsession Bæ²¡æœ‰æåˆ°åœ¨ï¼ˆ10ï¼Œ15ï¼‰ä¸ŠåŠ é—´éš™é”çš„åŸå› æ˜¯ï¼Œåœ¨åŠ c=10çš„è¡Œé”æ—¶å°±è¢«é˜»å¡ä½äº†ï¼Œæ— æ³•æ‰§è¡Œä¸‹ä¸€æ­¥å˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434830,"discussion_content":"ï¼Ÿ\nç‰¹åˆ«è¯´æ˜äº†å‘€\nâ€œå…¶å®æ˜¯è¿™æ ·çš„ï¼Œsession B çš„â€œåŠ  next-key lock(5,10] â€æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  c=10 çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„ã€‚â€\n\næ˜¯ä¸æ˜¯æˆ‘ç†è§£é”™ä½ é—®é¢˜äº†â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546270346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55684,"user_name":"ä»»å¤§é¹","can_delete":false,"product_type":"c1","uid":1069049,"ip_address":"","ucode":"75D14B0FC68DA5","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/f9/1f0a9665.jpg","comment_is_top":false,"comment_ctime":1546260747,"is_pvip":false,"replies":[{"id":"20088","content":"æ–°å¹´å¿«ä¹ğŸ¤","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546266315,"ip_address":"","comment_id":55684,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546260747","product_id":100020801,"comment_content":"2018æœ€åä¸€å¤©ï¼Œç¬¬ä¸€æ¬¡åœ¨æå®¢æ—¶é—´ç•™è¨€ï¼Œè¯»å®Œé†é†çŒé¡¶ï¼Œæ„Ÿè°¢è€å¸ˆçš„æ€»ç»“ï¼Œæ–°å¹´å¿«ä¹ï¼","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434824,"discussion_content":"æ–°å¹´å¿«ä¹ğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546266315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55650,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1546252772,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1546252772","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ€åæ€è€ƒé¢˜ï¼Œæœ¬åœ°è¿è¡Œsession bæ’å…¥æˆåŠŸäº†ï¼Œå¹¶æ²¡æœ‰é˜»å¡ï¼Œæƒ³ä¸åˆ°æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿæœ‰æ²¡æœ‰å’Œæˆ‘ä¸€æ ·çš„å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":55613,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1546243685,"is_pvip":false,"replies":[{"id":"20083","content":"æ–°å¹´å¥½ğŸ¤","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546259047,"ip_address":"","comment_id":55613,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546243685","product_id":100020801,"comment_content":"åœ¨å¤–é¢è¿˜æ²¡çœ‹ï¼Œ ä¸è¿‡çœ‹åˆ°æ ‡é¢˜å°±çŸ¥é“æ˜¯å¹²è´§æ»¡æ»¡ã€‚ å…ˆç¥è€å¸ˆå…ƒæ—¦å¿«ä¹ ï¼Œ ç­‰åˆ°å®¶äº†ç»†ç»†å“ ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434808,"discussion_content":"æ–°å¹´å¥½ğŸ¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546259047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55541,"user_name":"feixuefubing","can_delete":false,"product_type":"c1","uid":1252730,"ip_address":"","ucode":"5F139C180BC186","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlllSKrpQkhc9qLgtu4I4jc2FO9BJAbfgwz7meGCZqlmWsV3GfjqTecqpkTJMYpunxhKHSdc9gpQ/132","comment_is_top":false,"comment_ctime":1546227390,"is_pvip":false,"replies":[{"id":"20079","content":"åŠ é”çš„åŸåˆ™æ˜¯â€œæŸ¥è¯¢è®¿é—®åˆ°çš„è¦åŠ â€<br>For updateå°±æ˜¯æ»¡è¶³æ¡ä»¶çš„è¡Œä¼šåŠ ä¸Šè¡Œé”<br><br>æ’è¡Œæ¦œçš„è¯è¿˜æ˜¯å°½é‡ç”¨å¯æ™®é€šæŸ¥è¯¢å§ã€‚ä¸å¤ªäº†è§£ä½ å…·ä½“éœ€æ±‚ï¼Œè¯´ä¸€ä¸‹ä¸€ä¸ªåŠŸèƒ½è¯­å¥ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546243402,"ip_address":"","comment_id":55541,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546227390","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·é—®åƒæ’è¡Œæ¦œç­‰å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ï¼Œå¯å¦ä¸ºäº†ä¸€è‡´æ€§ä½¿ç”¨select for updateå»æŸ¥å½“å‰çš„æ•°æ®ï¼Œé‡ç‚¹æ˜¯ï¼Œå¤šè¡¨joinè”æŸ¥ï¼ˆwhereæ¡ä»¶æ˜¯userè¡¨çš„ä¸»é”®idï¼‰çš„æ—¶å€™æ˜¯æ€æ ·åŠ é”çš„å‘¢ï¼Œèƒ½å¦è¾¾åˆ°é¢„æœŸæ•ˆæœï¼Œæ˜¯å¦åŒæ—¶ä¼šç»™æ‰€æœ‰æ¶‰åŠåˆ°çš„è¡¨çš„è¡ŒåŠ é”ï¼Ÿå¦‚æœè”æŸ¥ä¸å¯è¡Œï¼Œå¯¹äºå®æ—¶æ€§è¦æ±‚é«˜ã€éœ€è¦çš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªè¡¨çš„æŸ¥è¯¢ï¼Œæœ‰å…¶ä»–æ›´å¥½çš„å®è·µå—ï¼Ÿè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434794,"discussion_content":"åŠ é”çš„åŸåˆ™æ˜¯â€œæŸ¥è¯¢è®¿é—®åˆ°çš„è¦åŠ â€\nFor updateå°±æ˜¯æ»¡è¶³æ¡ä»¶çš„è¡Œä¼šåŠ ä¸Šè¡Œé”\n\næ’è¡Œæ¦œçš„è¯è¿˜æ˜¯å°½é‡ç”¨å¯æ™®é€šæŸ¥è¯¢å§ã€‚ä¸å¤ªäº†è§£ä½ å…·ä½“éœ€æ±‚ï¼Œè¯´ä¸€ä¸‹ä¸€ä¸ªåŠŸèƒ½è¯­å¥ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546243402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55526,"user_name":"å°ç™½çŒª","can_delete":false,"product_type":"c1","uid":1180615,"ip_address":"","ucode":"BC7FC0E0585B76","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/c7/bd45f0c9.jpg","comment_is_top":false,"comment_ctime":1546223478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546223478","product_id":100020801,"comment_content":"çœ‹å¾—å¾ˆèˆ’æœ","like_count":0},{"had_liked":false,"id":55516,"user_name":"é”…å­","can_delete":false,"product_type":"c1","uid":1323048,"ip_address":"","ucode":"4A9143AFB07FF2","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/28/6e019a7a.jpg","comment_is_top":false,"comment_ctime":1546222140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546222140","product_id":100020801,"comment_content":"è€å¸ˆæ—©å•Šï¼Œæƒ³ä¸åˆ°å‡æœŸä¹Ÿæœ‰æ›´!","like_count":0}]}