{"id":395705,"title":"22 | åº”ç”¨æ„å»ºä¸‰å‰‘å®¢ï¼šPflagã€Viperã€Cobra æ ¸å¿ƒåŠŸèƒ½ä»‹ç»","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚è¿™ä¸€è®²æˆ‘ä»¬æ¥èŠèŠæ„å»ºåº”ç”¨æ—¶å¸¸ç”¨çš„GoåŒ…ã€‚</p><p>å› ä¸ºIAMé¡¹ç›®ä½¿ç”¨äº†Pflagã€Viperå’ŒCobraåŒ…æ¥æ„å»ºIAMçš„åº”ç”¨æ¡†æ¶ï¼Œä¸ºäº†è®©ä½ åé¢å­¦ä¹ æ›´åŠ å®¹æ˜“ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™3ä¸ªåŒ…çš„æ ¸å¿ƒåŠŸèƒ½å’Œä½¿ç”¨æ–¹å¼ã€‚å…¶å®å¦‚æœå•ç‹¬è®²æ¯ä¸ªåŒ…çš„è¯ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šåŠŸèƒ½å¯è®²çš„ï¼Œä½†æˆ‘ä»¬è¿™ä¸€è®²çš„ç›®çš„æ˜¯å‡å°ä½ åé¢å­¦ä¹ IAMæºç çš„éš¾åº¦ï¼Œæ‰€ä»¥æˆ‘ä¼šä¸»è¦ä»‹ç»è·ŸIAMç›¸å…³çš„åŠŸèƒ½ã€‚</p><p>åœ¨æ­£å¼ä»‹ç»è¿™ä¸‰ä¸ªåŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¦‚ä½•æ„å»ºåº”ç”¨çš„æ¡†æ¶ã€‚</p><h2>å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶</h2><p>æƒ³çŸ¥é“å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶ï¼Œé¦–å…ˆä½ è¦æ˜ç™½ï¼Œä¸€ä¸ªåº”ç”¨æ¡†æ¶åŒ…å«å“ªäº›éƒ¨åˆ†ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¸€ä¸ªåº”ç”¨æ¡†æ¶éœ€è¦åŒ…å«ä»¥ä¸‹3ä¸ªéƒ¨åˆ†ï¼š</p><ul>\n<li>å‘½ä»¤è¡Œå‚æ•°è§£æï¼šä¸»è¦ç”¨æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™äº›å‘½ä»¤è¡Œå‚æ•°å¯ä»¥å½±å“å‘½ä»¤çš„è¿è¡Œæ•ˆæœã€‚</li>\n<li>é…ç½®æ–‡ä»¶è§£æï¼šä¸€ä¸ªå¤§å‹åº”ç”¨ï¼Œé€šå¸¸å…·æœ‰å¾ˆå¤šå‚æ•°ï¼Œä¸ºäº†ä¾¿äºç®¡ç†å’Œé…ç½®è¿™äº›å‚æ•°ï¼Œé€šå¸¸ä¼šå°†è¿™äº›å‚æ•°æ”¾åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œä¾›ç¨‹åºè¯»å–å¹¶è§£æã€‚</li>\n<li>åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶ï¼šåº”ç”¨æœ€ç»ˆæ˜¯é€šè¿‡å‘½ä»¤æ¥å¯åŠ¨çš„ã€‚è¿™é‡Œæœ‰3ä¸ªéœ€æ±‚ç‚¹ï¼Œä¸€æ˜¯å‘½ä»¤éœ€è¦å…·å¤‡HelpåŠŸèƒ½ï¼Œè¿™æ ·æ‰èƒ½å‘Šè¯‰ä½¿ç”¨è€…å¦‚ä½•å»ä½¿ç”¨ï¼›äºŒæ˜¯å‘½ä»¤éœ€è¦èƒ½å¤Ÿè§£æå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶ï¼›ä¸‰æ˜¯å‘½ä»¤éœ€è¦èƒ½å¤Ÿåˆå§‹åŒ–ä¸šåŠ¡ä»£ç ï¼Œå¹¶æœ€ç»ˆå¯åŠ¨ä¸šåŠ¡è¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å‘½ä»¤éœ€è¦å…·å¤‡æ¡†æ¶çš„èƒ½åŠ›ï¼Œæ¥çº³ç®¡è¿™3ä¸ªéƒ¨åˆ†ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>è¿™3ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªå·±å¼€å‘ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸šç•Œå·²æœ‰çš„æˆç†Ÿå®ç°ã€‚è·Ÿä¹‹å‰çš„æƒ³æ³•ä¸€æ ·ï¼Œæˆ‘ä¸å»ºè®®ä½ è‡ªå·±å¼€å‘ï¼Œæ›´å»ºè®®ä½ é‡‡ç”¨ä¸šç•Œå·²æœ‰çš„æˆç†Ÿå®ç°ã€‚å‘½ä»¤è¡Œå‚æ•°å¯ä»¥é€šè¿‡<a href=\"https://github.com/spf13/pflag\">Pflag</a>æ¥è§£æï¼Œé…ç½®æ–‡ä»¶å¯ä»¥é€šè¿‡<a href=\"https://github.com/spf13/viper\">Viper</a>æ¥è§£æï¼Œåº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶åˆ™å¯ä»¥é€šè¿‡<a href=\"https://github.com/spf13/cobra\">Cobra</a>æ¥å®ç°ã€‚è¿™3ä¸ªåŒ…ç›®å‰ä¹Ÿæ˜¯æœ€å—æ¬¢è¿çš„åŒ…ï¼Œå¹¶ä¸”è¿™3ä¸ªåŒ…ä¸æ˜¯å‰²è£‚çš„ï¼Œè€Œæ˜¯æœ‰è”ç³»çš„ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æœºåœ°ç»„åˆè¿™3ä¸ªåŒ…ï¼Œä»è€Œå®ç°ä¸€ä¸ªéå¸¸å¼ºå¤§ã€ä¼˜ç§€çš„åº”ç”¨å‘½ä»¤è¡Œæ¡†æ¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†çœ‹ä¸‹ï¼Œè¿™3ä¸ªåŒ…åœ¨Goé¡¹ç›®å¼€å‘ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><h2>å‘½ä»¤è¡Œå‚æ•°è§£æå·¥å…·ï¼šPflagä½¿ç”¨ä»‹ç»</h2><p>GoæœåŠ¡å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦ç»™å¼€å‘çš„ç»„ä»¶åŠ ä¸Šå„ç§å¯åŠ¨å‚æ•°æ¥é…ç½®æœåŠ¡è¿›ç¨‹ï¼Œå½±å“æœåŠ¡çš„è¡Œä¸ºã€‚åƒkube-apiserverå°±æœ‰å¤šè¾¾200å¤šä¸ªå¯åŠ¨å‚æ•°ï¼Œè€Œä¸”è¿™äº›å‚æ•°çš„ç±»å‹å„ä¸ç›¸åŒï¼ˆä¾‹å¦‚ï¼šstringã€intã€ipç±»å‹ç­‰ï¼‰ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿä¸ç›¸åŒï¼ˆä¾‹å¦‚ï¼šéœ€è¦æ”¯æŒ<code>--</code>é•¿é€‰é¡¹ï¼Œ<code>-</code>çŸ­é€‰é¡¹ç­‰ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå‚æ•°è§£æå·¥å…·ã€‚</p><p>è™½ç„¶Goæºç ä¸­æä¾›äº†ä¸€ä¸ªæ ‡å‡†åº“FlagåŒ…ï¼Œç”¨æ¥å¯¹å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œè§£æï¼Œä½†åœ¨å¤§å‹é¡¹ç›®ä¸­åº”ç”¨æ›´å¹¿æ³›çš„æ˜¯å¦å¤–ä¸€ä¸ªåŒ…ï¼šPflagã€‚Pflagæä¾›äº†å¾ˆå¤šå¼ºå¤§çš„ç‰¹æ€§ï¼Œéå¸¸é€‚åˆç”¨æ¥æ„å»ºå¤§å‹é¡¹ç›®ï¼Œä¸€äº›è€³ç†Ÿèƒ½è¯¦çš„å¼€æºé¡¹ç›®éƒ½æ˜¯ç”¨Pflagæ¥è¿›è¡Œå‘½ä»¤è¡Œå‚æ•°è§£æçš„ï¼Œä¾‹å¦‚ï¼šKubernetesã€Istioã€Helmã€Dockerã€Etcdç­‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨Pflagã€‚Pflagä¸»è¦æ˜¯é€šè¿‡åˆ›å»ºFlagå’ŒFlagSetæ¥ä½¿ç”¨çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Flagã€‚</p><h3>PflagåŒ…Flagå®šä¹‰</h3><p>Pflagå¯ä»¥å¯¹å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°åœ¨PflagåŒ…ä¸­ä¼šè§£æä¸ºä¸€ä¸ªFlagç±»å‹çš„å˜é‡ã€‚Flagæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>type Flag struct {\n    Name                string // flagé•¿é€‰é¡¹çš„åç§°\n    Shorthand           string // flagçŸ­é€‰é¡¹çš„åç§°ï¼Œä¸€ä¸ªç¼©å†™çš„å­—ç¬¦\n    Usage               string // flagçš„ä½¿ç”¨æ–‡æœ¬\n    Value               Value  // flagçš„å€¼\n    DefValue            string // flagçš„é»˜è®¤å€¼\n    Changed             bool // è®°å½•flagçš„å€¼æ˜¯å¦æœ‰è¢«è®¾ç½®è¿‡\n    NoOptDefVal         string // å½“flagå‡ºç°åœ¨å‘½ä»¤è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šé€‰é¡¹å€¼æ—¶çš„é»˜è®¤å€¼\n    Deprecated          string // è®°å½•è¯¥flagæ˜¯å¦è¢«æ”¾å¼ƒ\n    Hidden              bool // å¦‚æœå€¼ä¸ºtrueï¼Œåˆ™ä»help/usageè¾“å‡ºä¿¡æ¯ä¸­éšè—è¯¥flag\n    ShorthandDeprecated string // å¦‚æœflagçš„çŸ­é€‰é¡¹è¢«åºŸå¼ƒï¼Œå½“ä½¿ç”¨flagçš„çŸ­é€‰é¡¹æ—¶æ‰“å°è¯¥ä¿¡æ¯\n    Annotations         map[string][]string // ç»™flagè®¾ç½®æ³¨è§£\n}\n</code></pre><p>Flagçš„å€¼æ˜¯ä¸€ä¸ªValueç±»å‹çš„æ¥å£ï¼ŒValueå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>type Value interface {\n    String() string // å°†flagç±»å‹çš„å€¼è½¬æ¢ä¸ºstringç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›stringçš„å†…å®¹\n    Set(string) error // å°†stringç±»å‹çš„å€¼è½¬æ¢ä¸ºflagç±»å‹çš„å€¼ï¼Œè½¬æ¢å¤±è´¥æŠ¥é”™\n    Type() string // è¿”å›flagçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šstringã€intã€ipç­‰\n}\n</code></pre><p>é€šè¿‡å°†Flagçš„å€¼æŠ½è±¡æˆä¸€ä¸ªinterfaceæ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰Flagçš„ç±»å‹äº†ã€‚åªè¦å®ç°äº†Valueæ¥å£çš„ç»“æ„ä½“ï¼Œå°±æ˜¯ä¸€ä¸ªæ–°ç±»å‹ã€‚</p><h3>PflagåŒ…FlagSetå®šä¹‰</h3><p>Pflagé™¤äº†æ”¯æŒå•ä¸ªçš„Flagä¹‹å¤–ï¼Œè¿˜æ”¯æŒFlagSetã€‚FlagSetæ˜¯ä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„Flagçš„é›†åˆï¼Œå‡ ä¹æ‰€æœ‰çš„Pflagæ“ä½œï¼Œéƒ½éœ€è¦å€ŸåŠ©FlagSetæä¾›çš„æ–¹æ³•æ¥å®Œæˆã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥è·å–å¹¶ä½¿ç”¨FlagSetï¼š</p><ul>\n<li>æ–¹æ³•ä¸€ï¼Œè°ƒç”¨NewFlagSetåˆ›å»ºä¸€ä¸ªFlagSetã€‚</li>\n<li>æ–¹æ³•äºŒï¼Œä½¿ç”¨PflagåŒ…å®šä¹‰çš„å…¨å±€FlagSetï¼šCommandLineã€‚å®é™…ä¸ŠCommandLineä¹Ÿæ˜¯ç”±NewFlagSetå‡½æ•°åˆ›å»ºçš„ã€‚</li>\n</ul><p>å…ˆæ¥çœ‹ä¸‹ç¬¬ä¸€ç§æ–¹æ³•ï¼Œè‡ªå®šä¹‰FlagSetã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰FlagSetçš„ç¤ºä¾‹ï¼š</p><pre><code>var version bool\nflagSet := pflag.NewFlagSet(&quot;test&quot;, pflag.ContinueOnError)\nflagSet.BoolVar(&amp;version, &quot;version&quot;, true, &quot;Print version information and quit.&quot;)\n</code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªæ–°çš„FlagSetæ¥å®šä¹‰å‘½ä»¤åŠå…¶å­å‘½ä»¤çš„Flagã€‚</p><p>å†æ¥çœ‹ä¸‹ç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨å…¨å±€FlagSetã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨å…¨å±€FlagSetçš„ç¤ºä¾‹ï¼š</p><pre><code>import (\n    &quot;github.com/spf13/pflag&quot;\n)\n\npflag.BoolVarP(&amp;version, &quot;version&quot;, &quot;v&quot;, true, &quot;Print version information and quit.&quot;)\n</code></pre><p>è¿™å…¶ä¸­ï¼Œpflag.BoolVarPå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>func BoolVarP(p *bool, name, shorthand string, value bool, usage string) {\n    flag := CommandLine.VarPF(newBoolValue(value, p), name, shorthand, usage)\n    flag.NoOptDefVal = &quot;true&quot;\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°pflag.BoolVarPæœ€ç»ˆè°ƒç”¨äº†CommandLineï¼ŒCommandLineæ˜¯ä¸€ä¸ªåŒ…çº§åˆ«çš„å˜é‡ï¼Œå®šä¹‰ä¸ºï¼š</p><pre><code>// CommandLine is the default set of command-line flags, parsed from os.Args.\nvar CommandLine = NewFlagSet(os.Args[0], ExitOnError)\n</code></pre><p>åœ¨ä¸€äº›ä¸éœ€è¦å®šä¹‰å­å‘½ä»¤çš„å‘½ä»¤è¡Œå·¥å…·ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€çš„FlagSetï¼Œæ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p><h3>Pflagä½¿ç”¨æ–¹æ³•</h3><p>ä¸Šé¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨PflagåŒ…çš„ä¸¤ä¸ªæ ¸å¿ƒç»“æ„ä½“ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹Pflagçš„å¸¸è§ä½¿ç”¨æ–¹æ³•ã€‚Pflagæœ‰å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œæˆ‘è¿™é‡Œä»‹ç»7ä¸ªå¸¸è§çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><ol>\n<li>æ”¯æŒå¤šç§å‘½ä»¤è¡Œå‚æ•°å®šä¹‰æ–¹å¼ã€‚</li>\n</ol><p>Pflagæ”¯æŒä»¥ä¸‹4ç§å‘½ä»¤è¡Œå‚æ•°å®šä¹‰æ–¹å¼ï¼š</p><ul>\n<li>æ”¯æŒé•¿é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­ã€‚</li>\n</ul><pre><code>var name = pflag.String(&quot;name&quot;, &quot;colin&quot;, &quot;Input Your Name&quot;)\n</code></pre><ul>\n<li>æ”¯æŒé•¿é€‰é¡¹ã€çŸ­é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­ã€‚</li>\n</ul><pre><code>var name = pflag.StringP(&quot;name&quot;, &quot;n&quot;, &quot;colin&quot;, &quot;Input Your Name&quot;)\n</code></pre><ul>\n<li>æ”¯æŒé•¿é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡ã€‚</li>\n</ul><pre><code>var name string\npflag.StringVar(&amp;name, &quot;name&quot;, &quot;colin&quot;, &quot;Input Your Name&quot;)\n</code></pre><ul>\n<li>æ”¯æŒé•¿é€‰é¡¹ã€çŸ­é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡ã€‚</li>\n</ul><pre><code>var name string\npflag.StringVarP(&amp;name, &quot;name&quot;, &quot;n&quot;,&quot;colin&quot;, &quot;Input Your Name&quot;)\n</code></pre><p>ä¸Šé¢çš„å‡½æ•°å‘½åæ˜¯æœ‰è§„åˆ™çš„ï¼š</p><ul>\n<li>å‡½æ•°åå¸¦<code>Var</code>è¯´æ˜æ˜¯å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡ï¼Œå¦åˆ™æ˜¯å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­ã€‚</li>\n<li>å‡½æ•°åå¸¦<code>P</code>è¯´æ˜æ”¯æŒçŸ­é€‰é¡¹ï¼Œå¦åˆ™ä¸æ”¯æŒçŸ­é€‰é¡¹ã€‚</li>\n</ul><ol start=\"2\">\n<li>ä½¿ç”¨<code>Get&lt;Type&gt;</code>è·å–å‚æ•°çš„å€¼ã€‚</li>\n</ol><p>å¯ä»¥ä½¿ç”¨<code>Get&lt;Type&gt;</code>æ¥è·å–æ ‡å¿—çš„å€¼ï¼Œ<code>&lt;Type&gt;</code>ä»£è¡¨Pflagæ‰€æ”¯æŒçš„ç±»å‹ã€‚ä¾‹å¦‚ï¼šæœ‰ä¸€ä¸ªpflag.FlagSetï¼Œå¸¦æœ‰ä¸€ä¸ªåä¸ºflagnameçš„intç±»å‹çš„æ ‡å¿—ï¼Œå¯ä»¥ä½¿ç”¨<code>GetInt()</code>æ¥è·å–intå€¼ã€‚éœ€è¦æ³¨æ„flagnameå¿…é¡»å­˜åœ¨ä¸”å¿…é¡»æ˜¯intï¼Œä¾‹å¦‚ï¼š</p><pre><code>i, err := flagset.GetInt(&quot;flagname&quot;)\n</code></pre><ol start=\"3\">\n<li>è·å–éé€‰é¡¹å‚æ•°ã€‚</li>\n</ol><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;github.com/spf13/pflag&quot;\n)\n\nvar (\n    flagvar = pflag.Int(&quot;flagname&quot;, 1234, &quot;help message for flagname&quot;)\n)\n\nfunc main() {\n    pflag.Parse()\n\n    fmt.Printf(&quot;argument number is: %v\\n&quot;, pflag.NArg())\n    fmt.Printf(&quot;argument list is: %v\\n&quot;, pflag.Args())\n    fmt.Printf(&quot;the first argument is: %v\\n&quot;, pflag.Arg(0))\n}\n</code></pre><p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>$ go run example1.go arg1 arg2\nargument number is: 2\nargument list is: [arg1 arg2]\nthe first argument is: arg1\n</code></pre><p>åœ¨å®šä¹‰å®Œæ ‡å¿—ä¹‹åï¼Œå¯ä»¥è°ƒç”¨<code>pflag.Parse()</code>æ¥è§£æå®šä¹‰çš„æ ‡å¿—ã€‚è§£æåï¼Œå¯é€šè¿‡<code>pflag.Args()</code>è¿”å›æ‰€æœ‰çš„éé€‰é¡¹å‚æ•°ï¼Œé€šè¿‡<code>pflag.Arg(i)</code>è¿”å›ç¬¬iä¸ªéé€‰é¡¹å‚æ•°ã€‚å‚æ•°ä¸‹æ ‡0åˆ°pflag.NArg() - 1ã€‚</p><ol start=\"4\">\n<li>æŒ‡å®šäº†é€‰é¡¹ä½†æ˜¯æ²¡æœ‰æŒ‡å®šé€‰é¡¹å€¼æ—¶çš„é»˜è®¤å€¼ã€‚</li>\n</ol><p>åˆ›å»ºä¸€ä¸ªFlagåï¼Œå¯ä»¥ä¸ºè¿™ä¸ªFlagè®¾ç½®<code>pflag.NoOptDefVal</code>ã€‚å¦‚æœä¸€ä¸ªFlagå…·æœ‰NoOptDefValï¼Œå¹¶ä¸”è¯¥Flagåœ¨å‘½ä»¤è¡Œä¸Šæ²¡æœ‰è®¾ç½®è¿™ä¸ªFlagçš„å€¼ï¼Œåˆ™è¯¥æ ‡å¿—å°†è®¾ç½®ä¸ºNoOptDefValæŒ‡å®šçš„å€¼ã€‚ä¾‹å¦‚ï¼š</p><pre><code>var ip = pflag.IntP(&quot;flagname&quot;, &quot;f&quot;, 1234, &quot;help message&quot;)\npflag.Lookup(&quot;flagname&quot;).NoOptDefVal = &quot;4321&quot;\n</code></pre><p>ä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿç»“æœï¼Œå…·ä½“ä½ å¯ä»¥å‚ç…§ä¸‹è¡¨ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/3f/fe76a52906c35b49b890225d1f5fc93f.png?wh=1428x336\" alt=\"å›¾ç‰‡\"></p><ol start=\"5\">\n<li>å¼ƒç”¨æ ‡å¿—æˆ–è€…æ ‡å¿—çš„ç®€å†™ã€‚</li>\n</ol><p>Pflagå¯ä»¥å¼ƒç”¨æ ‡å¿—æˆ–è€…æ ‡å¿—çš„ç®€å†™ã€‚å¼ƒç”¨çš„æ ‡å¿—æˆ–æ ‡å¿—ç®€å†™åœ¨å¸®åŠ©æ–‡æœ¬ä¸­ä¼šè¢«éšè—ï¼Œå¹¶åœ¨ä½¿ç”¨ä¸æ¨èçš„æ ‡å¿—æˆ–ç®€å†™æ—¶æ‰“å°æ­£ç¡®çš„ç”¨æ³•æç¤ºã€‚ä¾‹å¦‚ï¼Œå¼ƒç”¨åä¸ºlogmodeçš„æ ‡å¿—ï¼Œå¹¶å‘ŠçŸ¥ç”¨æˆ·åº”è¯¥ä½¿ç”¨å“ªä¸ªæ ‡å¿—ä»£æ›¿ï¼š</p><pre><code>// deprecate a flag by specifying its name and a usage message\npflag.CommandLine.MarkDeprecated(&quot;logmode&quot;, &quot;please use --log-mode instead&quot;)\n</code></pre><p>è¿™æ ·éšè—äº†å¸®åŠ©æ–‡æœ¬ä¸­çš„logmodeï¼Œå¹¶ä¸”å½“ä½¿ç”¨logmodeæ—¶ï¼Œæ‰“å°äº†<code>Flag --logmode has been deprecated, please use --log-mode instead</code>ã€‚</p><ol start=\"6\">\n<li>ä¿ç•™åä¸ºportçš„æ ‡å¿—ï¼Œä½†æ˜¯å¼ƒç”¨å®ƒçš„ç®€å†™å½¢å¼ã€‚</li>\n</ol><pre><code>pflag.IntVarP(&amp;port, &quot;port&quot;, &quot;P&quot;, 3306, &quot;MySQL service host port.&quot;)\n\n// deprecate a flag shorthand by specifying its flag name and a usage message\npflag.CommandLine.MarkShorthandDeprecated(&quot;port&quot;, &quot;please use --port only&quot;)\n</code></pre><p>è¿™æ ·éšè—äº†å¸®åŠ©æ–‡æœ¬ä¸­çš„ç®€å†™Pï¼Œå¹¶ä¸”å½“ä½¿ç”¨ç®€å†™Pæ—¶ï¼Œæ‰“å°äº†<code>Flag shorthand -P has been deprecated, please use --port only</code>ã€‚usage messageåœ¨æ­¤å¤„å¿…ä¸å¯å°‘ï¼Œå¹¶ä¸”ä¸åº”ä¸ºç©ºã€‚</p><ol start=\"7\">\n<li>éšè—æ ‡å¿—ã€‚</li>\n</ol><p>å¯ä»¥å°†Flagæ ‡è®°ä¸ºéšè—çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»å°†æ­£å¸¸è¿è¡Œï¼Œä½†ä¸ä¼šæ˜¾ç¤ºåœ¨usage/helpæ–‡æœ¬ä¸­ã€‚ä¾‹å¦‚ï¼šéšè—åä¸ºsecretFlagçš„æ ‡å¿—ï¼Œåªåœ¨å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å¸Œæœ›å®ƒæ˜¾ç¤ºåœ¨å¸®åŠ©æ–‡æœ¬æˆ–è€…ä½¿ç”¨æ–‡æœ¬ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>// hide a flag by specifying its name\npflag.CommandLine.MarkHidden(&quot;secretFlag&quot;)\n</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»äº†PflagåŒ…çš„é‡è¦ç”¨æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦‚ä½•è§£æé…ç½®æ–‡ä»¶ã€‚</p><h2>é…ç½®è§£æç¥å™¨ï¼šViperä½¿ç”¨ä»‹ç»</h2><p>å‡ ä¹æ‰€æœ‰çš„åç«¯æœåŠ¡ï¼Œéƒ½éœ€è¦ä¸€äº›é…ç½®é¡¹æ¥é…ç½®æˆ‘ä»¬çš„æœåŠ¡ï¼Œä¸€äº›å°å‹çš„é¡¹ç›®ï¼Œé…ç½®ä¸æ˜¯å¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹©åªé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥ä¼ é€’é…ç½®ã€‚ä½†æ˜¯å¤§å‹é¡¹ç›®é…ç½®å¾ˆå¤šï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ é€’å°±å˜å¾—å¾ˆéº»çƒ¦ï¼Œä¸å¥½ç»´æŠ¤ã€‚æ ‡å‡†çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†è¿™äº›é…ç½®ä¿¡æ¯ä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œç”±ç¨‹åºå¯åŠ¨æ—¶åŠ è½½å’Œè§£æã€‚Goç”Ÿæ€ä¸­æœ‰å¾ˆå¤šåŒ…å¯ä»¥åŠ è½½å¹¶è§£æé…ç½®æ–‡ä»¶ï¼Œç›®å‰æœ€å—æ¬¢è¿çš„æ˜¯ViperåŒ…ã€‚</p><p>Viperæ˜¯Goåº”ç”¨ç¨‹åºç°ä»£åŒ–çš„ã€å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿå¤„ç†ä¸åŒæ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬åœ¨æ„å»ºç°ä»£åº”ç”¨ç¨‹åºæ—¶ï¼Œä¸å¿…æ‹…å¿ƒé…ç½®æ–‡ä»¶æ ¼å¼ã€‚Viperä¹Ÿèƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¯¹åº”ç”¨é…ç½®çš„å„ç§éœ€æ±‚ã€‚</p><p>Viperå¯ä»¥ä»ä¸åŒçš„ä½ç½®è¯»å–é…ç½®ï¼Œä¸åŒä½ç½®çš„é…ç½®å…·æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§ç›¸åŒçš„é…ç½®ï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åˆ—å¦‚ä¸‹ï¼š</p><ol>\n<li>é€šè¿‡viper.Setå‡½æ•°æ˜¾ç¤ºè®¾ç½®çš„é…ç½®</li>\n<li>å‘½ä»¤è¡Œå‚æ•°</li>\n<li>ç¯å¢ƒå˜é‡</li>\n<li>é…ç½®æ–‡ä»¶</li>\n<li>Key/Valueå­˜å‚¨</li>\n<li>é»˜è®¤å€¼</li>\n</ol><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼ŒViperé…ç½®é”®ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>Viperæœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œæœ€é‡è¦çš„ä¸¤ç±»åŠŸèƒ½æ˜¯è¯»å…¥é…ç½®å’Œè¯»å–é…ç½®ï¼ŒViperæä¾›ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸¤ç±»åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»ä¸‹Viperå¦‚ä½•è¯»å…¥é…ç½®å’Œè¯»å–é…ç½®ã€‚</p><h3>è¯»å…¥é…ç½®</h3><p>è¯»å…¥é…ç½®ï¼Œå°±æ˜¯å°†é…ç½®è¯»å…¥åˆ°Viperä¸­ï¼Œæœ‰å¦‚ä¸‹è¯»å…¥æ–¹å¼ï¼š</p><ul>\n<li>è®¾ç½®é»˜è®¤çš„é…ç½®æ–‡ä»¶åã€‚</li>\n<li>è¯»å–é…ç½®æ–‡ä»¶ã€‚</li>\n<li>ç›‘å¬å’Œé‡æ–°è¯»å–é…ç½®æ–‡ä»¶ã€‚</li>\n<li>ä»io.Readerè¯»å–é…ç½®ã€‚</li>\n<li>ä»ç¯å¢ƒå˜é‡è¯»å–ã€‚</li>\n<li>ä»å‘½ä»¤è¡Œæ ‡å¿—è¯»å–ã€‚</li>\n<li>ä»è¿œç¨‹Key/Valueå­˜å‚¨è¯»å–ã€‚</li>\n</ul><p>è¿™å‡ ä¸ªæ–¹æ³•çš„å…·ä½“è¯»å…¥æ–¹å¼ï¼Œä½ å¯ä»¥çœ‹ä¸‹é¢çš„å±•ç¤ºã€‚</p><ol>\n<li>è®¾ç½®é»˜è®¤å€¼ã€‚</li>\n</ol><p>ä¸€ä¸ªå¥½çš„é…ç½®ç³»ç»Ÿåº”è¯¥æ”¯æŒé»˜è®¤å€¼ã€‚Viperæ”¯æŒå¯¹keyè®¾ç½®é»˜è®¤å€¼ï¼Œå½“æ²¡æœ‰é€šè¿‡é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€è¿œç¨‹é…ç½®æˆ–å‘½ä»¤è¡Œæ ‡å¿—è®¾ç½®keyæ—¶ï¼Œè®¾ç½®é»˜è®¤å€¼é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå¯ä»¥è®©ç¨‹åºåœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šé…ç½®æ—¶ä¹Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä¾‹å¦‚ï¼š</p><pre><code>viper.SetDefault(&quot;ContentDir&quot;, &quot;content&quot;)\nviper.SetDefault(&quot;LayoutDir&quot;, &quot;layouts&quot;)\nviper.SetDefault(&quot;Taxonomies&quot;, map[string]string{&quot;tag&quot;: &quot;tags&quot;, &quot;category&quot;: &quot;categories&quot;})\n</code></pre><ol start=\"2\">\n<li>è¯»å–é…ç½®æ–‡ä»¶ã€‚</li>\n</ol><p>Viperå¯ä»¥è¯»å–é…ç½®æ–‡ä»¶æ¥è§£æé…ç½®ï¼Œæ”¯æŒJSONã€TOMLã€YAMLã€YMLã€Propertiesã€Propsã€Propã€HCLã€Dotenvã€Envæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚Viper æ”¯æŒæœç´¢å¤šä¸ªè·¯å¾„ï¼Œå¹¶ä¸”é»˜è®¤ä¸é…ç½®ä»»ä½•æœç´¢è·¯å¾„ï¼Œå°†é»˜è®¤å†³ç­–ç•™ç»™åº”ç”¨ç¨‹åºã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Viper æœç´¢å’Œè¯»å–é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ï¼š</p><pre><code>package main\n\nimport (\n\t&quot;fmt&quot;\n\n\t&quot;github.com/spf13/pflag&quot;\n\t&quot;github.com/spf13/viper&quot;\n)\n\nvar (\n\tcfg  = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;Configuration file.&quot;)\n\thelp = pflag.BoolP(&quot;help&quot;, &quot;h&quot;, false, &quot;Show this help message.&quot;)\n)\n\nfunc main() {\n\tpflag.Parse()\n\tif *help {\n\t\tpflag.Usage()\n\t\treturn\n\t}\n\n  // ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®\n\tif *cfg != &quot;&quot; {\n\t\tviper.SetConfigFile(*cfg)   // æŒ‡å®šé…ç½®æ–‡ä»¶å\n\t\tviper.SetConfigType(&quot;yaml&quot;) // å¦‚æœé…ç½®æ–‡ä»¶åä¸­æ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼Œåˆ™éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼Œå‘Šè¯‰viperä»¥ä½•ç§æ ¼å¼è§£ææ–‡ä»¶\n\t} else {\n\t\tviper.AddConfigPath(&quot;.&quot;)          // æŠŠå½“å‰ç›®å½•åŠ å…¥åˆ°é…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸­\n\t\tviper.AddConfigPath(&quot;$HOME/.iam&quot;) // é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„\n\t\tviper.SetConfigName(&quot;config&quot;)     // é…ç½®æ–‡ä»¶åç§°ï¼ˆæ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼‰\n\t}\n\n\tif err := viper.ReadInConfig(); err != nil { // è¯»å–é…ç½®æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†é…ç½®æ–‡ä»¶åï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™åœ¨æ³¨å†Œçš„æœç´¢è·¯å¾„ä¸­æœç´¢\n\t\tpanic(fmt.Errorf(&quot;Fatal error config file: %s \\n&quot;, err))\n\t}\n\n\tfmt.Printf(&quot;Used configuration file is: %s\\n&quot;, viper.ConfigFileUsed())\n}\n</code></pre><p>Viperæ”¯æŒè®¾ç½®å¤šä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œéœ€è¦æ³¨æ„æ·»åŠ æœç´¢è·¯å¾„çš„é¡ºåºï¼ŒViperä¼šæ ¹æ®æ·»åŠ çš„è·¯å¾„é¡ºåºæœç´¢é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°åˆ™åœæ­¢æœç´¢ã€‚å¦‚æœè°ƒç”¨SetConfigFileç›´æ¥æŒ‡å®šäº†é…ç½®æ–‡ä»¶åï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶åæ²¡æœ‰æ–‡ä»¶æ‰©å±•åæ—¶ï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼Œä»¥ä½¿Viperèƒ½å¤Ÿæ­£ç¡®è§£æé…ç½®æ–‡ä»¶ã€‚</p><p>å¦‚æœé€šè¿‡æœç´¢çš„æ–¹å¼æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œåˆ™éœ€è¦æ³¨æ„ï¼ŒSetConfigNameè®¾ç½®çš„é…ç½®æ–‡ä»¶åæ˜¯ä¸å¸¦æ‰©å±•åçš„ï¼Œåœ¨æœç´¢æ—¶Viperä¼šåœ¨æ–‡ä»¶åä¹‹åè¿½åŠ æ–‡ä»¶æ‰©å±•åï¼Œå¹¶å°è¯•æœç´¢æ‰€æœ‰æ”¯æŒçš„æ‰©å±•ç±»å‹ã€‚</p><ol start=\"3\">\n<li>ç›‘å¬å’Œé‡æ–°è¯»å–é…ç½®æ–‡ä»¶ã€‚</li>\n</ol><p>Viperæ”¯æŒåœ¨è¿è¡Œæ—¶è®©åº”ç”¨ç¨‹åºå®æ—¶è¯»å–é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯çƒ­åŠ è½½é…ç½®ã€‚å¯ä»¥é€šè¿‡WatchConfigå‡½æ•°çƒ­åŠ è½½é…ç½®ã€‚åœ¨è°ƒç”¨WatchConfigå‡½æ•°ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å·²ç»æ·»åŠ äº†é…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥ä¸ºViperæä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡å‘ç”Ÿæ›´æ”¹æ—¶è¿è¡Œã€‚è¿™é‡Œæˆ‘ä¹Ÿç»™ä½ ä¸ªç¤ºä¾‹ï¼š</p><pre><code>viper.WatchConfig()\nviper.OnConfigChange(func(e fsnotify.Event) {\n   // é…ç½®æ–‡ä»¶å‘ç”Ÿå˜æ›´ä¹‹åä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•°\n\tfmt.Println(&quot;Config file changed:&quot;, e.Name)\n})\n</code></pre><p>æˆ‘ä¸å»ºè®®åœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨çƒ­åŠ è½½åŠŸèƒ½ï¼Œå› ä¸ºå³ä½¿é…ç½®çƒ­åŠ è½½äº†ï¼Œç¨‹åºä¸­çš„ä»£ç ä¹Ÿä¸ä¸€å®šä¼šçƒ­åŠ è½½ã€‚ä¾‹å¦‚ï¼šä¿®æ”¹äº†æœåŠ¡ç›‘å¬ç«¯å£ï¼Œä½†æ˜¯æœåŠ¡æ²¡æœ‰é‡å¯ï¼Œè¿™æ—¶å€™æœåŠ¡è¿˜æ˜¯ç›‘å¬åœ¨è€çš„ç«¯å£ä¸Šï¼Œä¼šé€ æˆä¸ä¸€è‡´ã€‚<br>\n4) è®¾ç½®é…ç½®å€¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡viper.Set()å‡½æ•°æ¥æ˜¾å¼è®¾ç½®é…ç½®ï¼š</p><pre><code>viper.Set(&quot;user.username&quot;, &quot;colin&quot;)\n</code></pre><ol start=\"5\">\n<li>ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚</li>\n</ol><p>Viperè¿˜æ”¯æŒç¯å¢ƒå˜é‡ï¼Œé€šè¿‡å¦‚ä¸‹5ä¸ªå‡½æ•°æ¥æ”¯æŒç¯å¢ƒå˜é‡ï¼š</p><ul>\n<li>AutomaticEnv()</li>\n<li>BindEnv(input â€¦string) error</li>\n<li>SetEnvPrefix(in string)</li>\n<li>SetEnvKeyReplacer(r *strings.Replacer)</li>\n<li>AllowEmptyEnv(allowEmptyEnv bool)</li>\n</ul><p>è¿™é‡Œè¦æ³¨æ„ï¼šViperè¯»å–ç¯å¢ƒå˜é‡æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚Viperæä¾›äº†ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿Envå˜é‡æ˜¯å”¯ä¸€çš„ã€‚é€šè¿‡ä½¿ç”¨SetEnvPrefixï¼Œå¯ä»¥å‘Šè¯‰Viperåœ¨è¯»å–ç¯å¢ƒå˜é‡æ—¶ä½¿ç”¨å‰ç¼€ã€‚BindEnvå’ŒAutomaticEnvéƒ½å°†ä½¿ç”¨æ­¤å‰ç¼€ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¾ç½®äº†viper.SetEnvPrefix(â€œVIPERâ€)ï¼Œå½“ä½¿ç”¨viper.Get(â€œapiversionâ€)æ—¶ï¼Œå®é™…è¯»å–çš„ç¯å¢ƒå˜é‡æ˜¯<code>VIPER_APIVERSION</code>ã€‚</p><p>BindEnvéœ€è¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®åï¼Œç¬¬äºŒä¸ªæ˜¯ç¯å¢ƒå˜é‡çš„åç§°ï¼Œç¯å¢ƒå˜é‡çš„åç§°åŒºåˆ†å¤§å°å†™ã€‚å¦‚æœæœªæä¾›Envå˜é‡åï¼Œåˆ™Viperå°†å‡å®šEnvå˜é‡åä¸ºï¼š<code>ç¯å¢ƒå˜é‡å‰ç¼€_é”®åå…¨å¤§å†™</code>ã€‚ä¾‹å¦‚ï¼šå‰ç¼€ä¸ºVIPERï¼Œkeyä¸ºusernameï¼Œåˆ™Envå˜é‡åä¸º<code>VIPER_USERNAME</code>ã€‚å½“æ˜¾ç¤ºæä¾›Envå˜é‡åï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰æ—¶ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯IDï¼ŒViperå°†æŸ¥æ‰¾ç¯å¢ƒå˜é‡IDã€‚</p><p>åœ¨ä½¿ç”¨Envå˜é‡æ—¶ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼šæ¯æ¬¡è®¿é—®è¯¥å€¼æ—¶éƒ½å°†è¯»å–å®ƒã€‚Viperåœ¨è°ƒç”¨BindEnvæ—¶ä¸å›ºå®šè¯¥å€¼ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé­”æ³•å‡½æ•°SetEnvKeyReplacerï¼ŒSetEnvKeyReplacerå…è®¸ä½ ä½¿ç”¨strings.Replacerå¯¹è±¡æ¥é‡å†™Envé”®ã€‚å¦‚æœä½ æƒ³åœ¨Get()è°ƒç”¨ä¸­ä½¿ç”¨<code>-</code>æˆ–è€…<code>.</code>ï¼Œä½†å¸Œæœ›ä½ çš„ç¯å¢ƒå˜é‡ä½¿ç”¨<code>_</code>åˆ†éš”ç¬¦ï¼Œå¯ä»¥é€šè¿‡SetEnvKeyReplaceræ¥å®ç°ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¾ç½®äº†ç¯å¢ƒå˜é‡<code>USER_SECRET_KEY=bVix2WBv0VPfrDrvlLWrhEdzjLpPCNYb</code>ï¼Œä½†æˆ‘ä»¬æƒ³ç”¨<code>viper.Get(\"user.secret-key\")</code>ï¼Œé‚£æˆ‘ä»¬å°±è°ƒç”¨å‡½æ•°ï¼š</p><pre><code>viper.SetEnvKeyReplacer(strings.NewReplacer(&quot;.&quot;, &quot;_&quot;, &quot;-&quot;, &quot;_&quot;))\n</code></pre><p>ä¸Šé¢çš„ä»£ç ï¼Œåœ¨è°ƒç”¨viper.Get()å‡½æ•°æ—¶ï¼Œä¼šç”¨_æ›¿æ¢<code>.</code>å’Œ<code>-</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç©ºç¯å¢ƒå˜é‡è¢«è®¤ä¸ºæ˜¯æœªè®¾ç½®çš„ï¼Œå¹¶å°†è¿”å›åˆ°ä¸‹ä¸€ä¸ªé…ç½®æºã€‚è‹¥è¦å°†ç©ºç¯å¢ƒå˜é‡è§†ä¸ºå·²è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨AllowEmptyEnvæ–¹æ³•ã€‚ä½¿ç”¨ç¯å¢ƒå˜é‡ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>// ä½¿ç”¨ç¯å¢ƒå˜é‡\nos.Setenv(&quot;VIPER_USER_SECRET_ID&quot;, &quot;QLdywI2MrmDVjSSv6e95weNRvmteRjfKAuNV&quot;)\nos.Setenv(&quot;VIPER_USER_SECRET_KEY&quot;, &quot;bVix2WBv0VPfrDrvlLWrhEdzjLpPCNYb&quot;)\n\nviper.AutomaticEnv()                                             // è¯»å–ç¯å¢ƒå˜é‡\nviper.SetEnvPrefix(&quot;VIPER&quot;)                                      // è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€ï¼šVIPER_ï¼Œå¦‚æœæ˜¯viperï¼Œå°†è‡ªåŠ¨è½¬å˜ä¸ºå¤§å†™ã€‚\nviper.SetEnvKeyReplacer(strings.NewReplacer(&quot;.&quot;, &quot;_&quot;, &quot;-&quot;, &quot;_&quot;)) // å°†viper.Get(key) keyå­—ç¬¦ä¸²ä¸­'.'å’Œ'-'æ›¿æ¢ä¸º'_'\nviper.BindEnv(&quot;user.secret-key&quot;)\nviper.BindEnv(&quot;user.secret-id&quot;, &quot;USER_SECRET_ID&quot;) // ç»‘å®šç¯å¢ƒå˜é‡ååˆ°key\n</code></pre><ol start=\"6\">\n<li>ä½¿ç”¨æ ‡å¿—ã€‚</li>\n</ol><p>Viperæ”¯æŒPflagåŒ…ï¼Œèƒ½å¤Ÿç»‘å®škeyåˆ°Flagã€‚ä¸BindEnvç±»ä¼¼ï¼Œåœ¨è°ƒç”¨ç»‘å®šæ–¹æ³•æ—¶ï¼Œä¸ä¼šè®¾ç½®è¯¥å€¼ï¼Œä½†åœ¨è®¿é—®å®ƒæ—¶ä¼šè®¾ç½®ã€‚å¯¹äºå•ä¸ªæ ‡å¿—ï¼Œå¯ä»¥è°ƒç”¨BindPFlag()è¿›è¡Œç»‘å®šï¼š</p><pre><code>viper.BindPFlag(&quot;token&quot;, pflag.Lookup(&quot;token&quot;)) // ç»‘å®šå•ä¸ªæ ‡å¿—\n</code></pre><p>è¿˜å¯ä»¥ç»‘å®šä¸€ç»„ç°æœ‰çš„pflagsï¼ˆpflag.FlagSetï¼‰ï¼š</p><pre><code>viper.BindPFlags(pflag.CommandLine)             //ç»‘å®šæ ‡å¿—é›†\n</code></pre><h3>è¯»å–é…ç½®</h3><p>Viperæä¾›äº†å¦‚ä¸‹æ–¹æ³•æ¥è¯»å–é…ç½®ï¼š</p><ul>\n<li>Get(key string) interface{}</li>\n<li>Get<code>&lt;Type&gt;</code>(key string) <code>&lt;Type&gt;</code></li>\n<li>AllSettings() map[string]interface{}</li>\n<li>IsSet(key string) : bool</li>\n</ul><p>æ¯ä¸€ä¸ªGetæ–¹æ³•åœ¨æ‰¾ä¸åˆ°å€¼çš„æ—¶å€™éƒ½ä¼šè¿”å›é›¶å€¼ã€‚ä¸ºäº†æ£€æŸ¥ç»™å®šçš„é”®æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨IsSet()æ–¹æ³•ã€‚<code>&lt;Type&gt;</code>å¯ä»¥æ˜¯Viperæ”¯æŒçš„ç±»å‹ï¼Œé¦–å­—æ¯å¤§å†™ï¼šBoolã€Float64ã€Intã€IntSliceã€Stringã€StringMapã€StringMapStringã€StringSliceã€Timeã€Durationã€‚ä¾‹å¦‚ï¼šGetInt()ã€‚</p><p>å¸¸è§çš„è¯»å–é…ç½®æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ã€‚</p><ol>\n<li>è®¿é—®åµŒå¥—çš„é”®ã€‚</li>\n</ol><p>ä¾‹å¦‚ï¼ŒåŠ è½½ä¸‹é¢çš„JSONæ–‡ä»¶ï¼š</p><pre><code>{\n    &quot;host&quot;: {\n        &quot;address&quot;: &quot;localhost&quot;,\n        &quot;port&quot;: 5799\n    },\n    &quot;datastore&quot;: {\n        &quot;metric&quot;: {\n            &quot;host&quot;: &quot;127.0.0.1&quot;,\n            &quot;port&quot;: 3099\n        },\n        &quot;warehouse&quot;: {\n            &quot;host&quot;: &quot;198.0.0.1&quot;,\n            &quot;port&quot;: 2112\n        }\n    }\n}\n</code></pre><p>Viperå¯ä»¥é€šè¿‡ä¼ å…¥<code>.</code>åˆ†éš”çš„è·¯å¾„æ¥è®¿é—®åµŒå¥—å­—æ®µï¼š</p><pre><code>viper.GetString(&quot;datastore.metric.host&quot;) // (è¿”å› &quot;127.0.0.1&quot;)\n</code></pre><p>å¦‚æœ<code>datastore.metric</code>è¢«ç›´æ¥èµ‹å€¼è¦†ç›–ï¼ˆè¢«Flagã€ç¯å¢ƒå˜é‡ã€set()æ–¹æ³•ç­‰ç­‰ï¼‰ï¼Œé‚£ä¹ˆ<code>datastore.metric</code>çš„æ‰€æœ‰å­é”®éƒ½å°†å˜ä¸ºæœªå®šä¹‰çŠ¶æ€ï¼Œå®ƒä»¬è¢«é«˜ä¼˜å…ˆçº§é…ç½®çº§åˆ«è¦†ç›–äº†ã€‚</p><p>å¦‚æœå­˜åœ¨ä¸åˆ†éš”çš„é”®è·¯å¾„åŒ¹é…çš„é”®ï¼Œåˆ™ç›´æ¥è¿”å›å…¶å€¼ã€‚ä¾‹å¦‚ï¼š</p><pre><code>{\n    &quot;datastore.metric.host&quot;: &quot;0.0.0.0&quot;,\n    &quot;host&quot;: {\n        &quot;address&quot;: &quot;localhost&quot;,\n        &quot;port&quot;: 5799\n    },\n    &quot;datastore&quot;: {\n        &quot;metric&quot;: {\n            &quot;host&quot;: &quot;127.0.0.1&quot;,\n            &quot;port&quot;: 3099\n        },\n        &quot;warehouse&quot;: {\n            &quot;host&quot;: &quot;198.0.0.1&quot;,\n            &quot;port&quot;: 2112\n        }\n    }\n}\n</code></pre><p>é€šè¿‡viper.GetStringè·å–å€¼ï¼š</p><pre><code>viper.GetString(&quot;datastore.metric.host&quot;) // è¿”å› &quot;0.0.0.0&quot;\n</code></pre><ol start=\"2\">\n<li>ååºåˆ—åŒ–ã€‚</li>\n</ol><p>Viperå¯ä»¥æ”¯æŒå°†æ‰€æœ‰æˆ–ç‰¹å®šçš„å€¼è§£æåˆ°ç»“æ„ä½“ã€mapç­‰ã€‚å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‡½æ•°æ¥å®ç°ï¼š</p><ul>\n<li>Unmarshal(rawVal interface{}) error</li>\n<li>UnmarshalKey(key string, rawVal interface{}) error</li>\n</ul><p>ä¸€ä¸ªç¤ºä¾‹ï¼š</p><pre><code>type config struct {\n\tPort int\n\tName string\n\tPathMap string `mapstructure:&quot;path_map&quot;`\n}\n\nvar C config\n\nerr := viper.Unmarshal(&amp;C)\nif err != nil {\n\tt.Fatalf(&quot;unable to decode into struct, %v&quot;, err)\n}\n</code></pre><p>å¦‚æœæƒ³è¦è§£æé‚£äº›é”®æœ¬èº«å°±åŒ…å«<code>.</code>(é»˜è®¤çš„é”®åˆ†éš”ç¬¦ï¼‰çš„é…ç½®ï¼Œåˆ™éœ€è¦ä¿®æ”¹åˆ†éš”ç¬¦ï¼š</p><pre><code>v := viper.NewWithOptions(viper.KeyDelimiter(&quot;::&quot;))\n\nv.SetDefault(&quot;chart::values&quot;, map[string]interface{}{\n    &quot;ingress&quot;: map[string]interface{}{\n        &quot;annotations&quot;: map[string]interface{}{\n            &quot;traefik.frontend.rule.type&quot;:                 &quot;PathPrefix&quot;,\n            &quot;traefik.ingress.kubernetes.io/ssl-redirect&quot;: &quot;true&quot;,\n        },\n    },\n})\n\ntype config struct {\n\tChart struct{\n        Values map[string]interface{}\n    }\n}\n\nvar C config\n\nv.Unmarshal(&amp;C)\n</code></pre><p>Viperåœ¨åå°ä½¿ç”¨<code>github.com/mitchellh/mapstructure</code>æ¥è§£æå€¼ï¼Œå…¶é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨<code>mapstructure tags</code>ã€‚å½“æˆ‘ä»¬éœ€è¦å°†Viperè¯»å–çš„é…ç½®ååºåˆ—åˆ°æˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“å˜é‡ä¸­æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨mapstructure tagsã€‚</p><ol start=\"3\">\n<li>åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ã€‚</li>\n</ol><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†Viperä¸­ä¿å­˜çš„æ‰€æœ‰è®¾ç½®åºåˆ—åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>import (\n    yaml &quot;gopkg.in/yaml.v2&quot;\n    // ...\n)\n\nfunc yamlStringSettings() string {\n    c := viper.AllSettings()\n    bs, err := yaml.Marshal(c)\n    if err != nil {\n        log.Fatalf(&quot;unable to marshal config to YAML: %v&quot;, err)\n    }\n    return string(bs)\n}\n</code></pre><h2>ç°ä»£åŒ–çš„å‘½ä»¤è¡Œæ¡†æ¶ï¼šCobraå…¨è§£</h2><p>Cobraæ—¢æ˜¯ä¸€ä¸ªå¯ä»¥åˆ›å»ºå¼ºå¤§çš„ç°ä»£CLIåº”ç”¨ç¨‹åºçš„åº“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥ç”Ÿæˆåº”ç”¨å’Œå‘½ä»¤æ–‡ä»¶çš„ç¨‹åºã€‚æœ‰è®¸å¤šå¤§å‹é¡¹ç›®éƒ½æ˜¯ç”¨Cobraæ¥æ„å»ºåº”ç”¨ç¨‹åºçš„ï¼Œä¾‹å¦‚ Kubernetesã€Dockerã€etcdã€Rktã€Hugoç­‰ã€‚</p><p>Cobraå»ºç«‹åœ¨commandsã€argumentså’Œflagsç»“æ„ä¹‹ä¸Šã€‚commandsä»£è¡¨å‘½ä»¤ï¼Œargumentsä»£è¡¨éé€‰é¡¹å‚æ•°ï¼Œflagsä»£è¡¨é€‰é¡¹å‚æ•°ï¼ˆä¹Ÿå«æ ‡å¿—ï¼‰ã€‚ä¸€ä¸ªå¥½çš„åº”ç”¨ç¨‹åºåº”è¯¥æ˜¯æ˜“æ‡‚çš„ï¼Œç”¨æˆ·å¯ä»¥æ¸…æ™°åœ°çŸ¥é“å¦‚ä½•å»ä½¿ç”¨è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºé€šå¸¸éµå¾ªå¦‚ä¸‹æ¨¡å¼ï¼š<code>APPNAME VERB NOUN --ADJECTIVEæˆ–è€…APPNAME COMMAND ARG --FLAG</code>ï¼Œä¾‹å¦‚ï¼š</p><pre><code>git clone URL --bare # clone æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼ŒURLæ˜¯ä¸€ä¸ªéé€‰é¡¹å‚æ•°ï¼Œbareæ˜¯ä¸€ä¸ªé€‰é¡¹å‚æ•°\n</code></pre><p>è¿™é‡Œï¼ŒVERBä»£è¡¨åŠ¨è¯ï¼ŒNOUNä»£è¡¨åè¯ï¼ŒADJECTIVEä»£è¡¨å½¢å®¹è¯ã€‚</p><p>Cobraæä¾›äº†ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºå‘½ä»¤ï¼šCobraå‘½ä»¤å’ŒCobraåº“ã€‚Cobraå‘½ä»¤å¯ä»¥ç”Ÿæˆä¸€ä¸ªCobraå‘½ä»¤æ¨¡æ¿ï¼Œè€Œå‘½ä»¤æ¨¡æ¿ä¹Ÿæ˜¯é€šè¿‡å¼•ç”¨Cobraåº“æ¥æ„å»ºå‘½ä»¤çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨Cobraåº“æ¥åˆ›å»ºå‘½ä»¤ã€‚</p><h3>ä½¿ç”¨Cobraåº“åˆ›å»ºå‘½ä»¤</h3><p>å¦‚æœè¦ç”¨Cobraåº“ç¼–ç å®ç°ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„main.goæ–‡ä»¶å’Œä¸€ä¸ªrootCmdæ–‡ä»¶ï¼Œä¹‹åå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–å‘½ä»¤ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol>\n<li>åˆ›å»ºrootCmdã€‚</li>\n</ol><pre><code>$ mkdir -p newApp2 &amp;&amp; cd newApp2\n</code></pre><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°†rootCmdæ”¾åœ¨æ–‡ä»¶cmd/root.goä¸­ã€‚</p><pre><code>var rootCmd = &amp;cobra.Command{\n  Use:   &quot;hugo&quot;,\n  Short: &quot;Hugo is a very fast static site generator&quot;,\n  Long: `A Fast and Flexible Static Site Generator built with\n                love by spf13 and friends in Go.\n                Complete documentation is available at http://hugo.spf13.com`,\n  Run: func(cmd *cobra.Command, args []string) {\n    // Do Stuff Here\n  },\n}\n\nfunc Execute() {\n  if err := rootCmd.Execute(); err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n}\n</code></pre><p>è¿˜å¯ä»¥åœ¨init()å‡½æ•°ä¸­å®šä¹‰æ ‡å¿—å’Œå¤„ç†é…ç½®ï¼Œä¾‹å¦‚cmd/root.goã€‚</p><pre><code>import (\n  &quot;fmt&quot;\n  &quot;os&quot;\n\n  homedir &quot;github.com/mitchellh/go-homedir&quot;\n  &quot;github.com/spf13/cobra&quot;\n  &quot;github.com/spf13/viper&quot;\n)\n\nvar (\n    cfgFile     string\n\t  projectBase string\n    userLicense string\n)\n\nfunc init() {\n  cobra.OnInitialize(initConfig)\n  rootCmd.PersistentFlags().StringVar(&amp;cfgFile, &quot;config&quot;, &quot;&quot;, &quot;config file (default is $HOME/.cobra.yaml)&quot;)\n  rootCmd.PersistentFlags().StringVarP(&amp;projectBase, &quot;projectbase&quot;, &quot;b&quot;, &quot;&quot;, &quot;base project directory eg. github.com/spf13/&quot;)\n  rootCmd.PersistentFlags().StringP(&quot;author&quot;, &quot;a&quot;, &quot;YOUR NAME&quot;, &quot;Author name for copyright attribution&quot;)\n  rootCmd.PersistentFlags().StringVarP(&amp;userLicense, &quot;license&quot;, &quot;l&quot;, &quot;&quot;, &quot;Name of license for the project (can provide `licensetext` in config)&quot;)\n  rootCmd.PersistentFlags().Bool(&quot;viper&quot;, true, &quot;Use Viper for configuration&quot;)\n  viper.BindPFlag(&quot;author&quot;, rootCmd.PersistentFlags().Lookup(&quot;author&quot;))\n  viper.BindPFlag(&quot;projectbase&quot;, rootCmd.PersistentFlags().Lookup(&quot;projectbase&quot;))\n  viper.BindPFlag(&quot;useViper&quot;, rootCmd.PersistentFlags().Lookup(&quot;viper&quot;))\n  viper.SetDefault(&quot;author&quot;, &quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;)\n  viper.SetDefault(&quot;license&quot;, &quot;apache&quot;)\n}\n\nfunc initConfig() {\n  // Don't forget to read config either from cfgFile or from home directory!\n  if cfgFile != &quot;&quot; {\n    // Use config file from the flag.\n    viper.SetConfigFile(cfgFile)\n  } else {\n    // Find home directory.\n    home, err := homedir.Dir()\n    if err != nil {\n      fmt.Println(err)\n      os.Exit(1)\n    }\n\n    // Search config in home directory with name &quot;.cobra&quot; (without extension).\n    viper.AddConfigPath(home)\n    viper.SetConfigName(&quot;.cobra&quot;)\n  }\n\n  if err := viper.ReadInConfig(); err != nil {\n    fmt.Println(&quot;Can't read config:&quot;, err)\n    os.Exit(1)\n  }\n}\n</code></pre><ol start=\"2\">\n<li>åˆ›å»ºmain.goã€‚</li>\n</ol><p>æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªmainå‡½æ•°æ¥è°ƒç”¨rootCmdï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªmain.goæ–‡ä»¶ï¼Œåœ¨main.goä¸­è°ƒç”¨rootCmd.Execute()æ¥æ‰§è¡Œå‘½ä»¤ï¼š</p><pre><code>package main\n\nimport (\n  &quot;{pathToYourApp}/cmd&quot;\n)\n\nfunc main() {\n  cmd.Execute()\n}\n</code></pre><p>éœ€è¦æ³¨æ„ï¼Œmain.goä¸­ä¸å»ºè®®æ”¾å¾ˆå¤šä»£ç ï¼Œé€šå¸¸åªéœ€è¦è°ƒç”¨cmd.Execute()å³å¯ã€‚</p><ol start=\"3\">\n<li>æ·»åŠ å‘½ä»¤ã€‚</li>\n</ol><p>é™¤äº†rootCmdï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨AddCommandæ·»åŠ å…¶ä»–å‘½ä»¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠå…¶ä»–å‘½ä»¤çš„æºç æ–‡ä»¶æ”¾åœ¨cmd/ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªversionå‘½ä»¤ï¼Œå¯ä»¥åˆ›å»ºcmd/version.goæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š</p><pre><code>package cmd\n\nimport (\n  &quot;fmt&quot;\n\n  &quot;github.com/spf13/cobra&quot;\n)\n\nfunc init() {\n  rootCmd.AddCommand(versionCmd)\n}\n\nvar versionCmd = &amp;cobra.Command{\n  Use:   &quot;version&quot;,\n  Short: &quot;Print the version number of Hugo&quot;,\n  Long:  `All software has versions. This is Hugo's`,\n  Run: func(cmd *cobra.Command, args []string) {\n    fmt.Println(&quot;Hugo Static Site Generator v0.9 -- HEAD&quot;)\n  },\n}\n</code></pre><p>æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>rootCmd.AddCommand(versionCmd)</code>ç»™rootCmdå‘½ä»¤æ·»åŠ äº†ä¸€ä¸ªversionCmdå‘½ä»¤ã€‚</p><ol start=\"4\">\n<li>ç¼–è¯‘å¹¶è¿è¡Œã€‚</li>\n</ol><p>å°†main.goä¸­<code>{pathToYourApp}</code>æ›¿æ¢ä¸ºå¯¹åº”çš„è·¯å¾„ï¼Œä¾‹å¦‚æœ¬ç¤ºä¾‹ä¸­pathToYourAppä¸º<code>github.com/marmotedu/gopractise-demo/cobra/newApp2</code>ã€‚</p><pre><code>$ go mod init github.com/marmotedu/gopractise-demo/cobra/newApp2\n$ go build -v .\n$ ./newApp2 -h\nA Fast and Flexible Static Site Generator built with\nlove by spf13 and friends in Go.\nComplete documentation is available at http://hugo.spf13.com\n \nUsage:\nhugo [flags]\nhugo [command]\n \nAvailable Commands:\nhelp Help about any command\nversion Print the version number of Hugo\n \nFlags:\n-a, --author string Author name for copyright attribution (default &quot;YOUR NAME&quot;)\n--config string config file (default is $HOME/.cobra.yaml)\n-h, --help help for hugo\n-l, --license licensetext Name of license for the project (can provide licensetext in config)\n-b, --projectbase string base project directory eg. github.com/spf13/\n--viper Use Viper for configuration (default true)\n \nUse &quot;hugo [command] --help&quot; for more information about a command.\n</code></pre><p>é€šè¿‡æ­¥éª¤ä¸€ã€æ­¥éª¤äºŒã€æ­¥éª¤ä¸‰ï¼Œæˆ‘ä»¬å°±æˆåŠŸåˆ›å»ºå’Œæ·»åŠ äº†Cobraåº”ç”¨ç¨‹åºåŠå…¶å‘½ä»¤ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†æ¥è¯¦ç»†ä»‹ç»ä¸‹Cobraçš„æ ¸å¿ƒç‰¹æ€§ã€‚</p><h3>ä½¿ç”¨æ ‡å¿—</h3><p>Cobraå¯ä»¥è·ŸPflagç»“åˆä½¿ç”¨ï¼Œå®ç°å¼ºå¤§çš„æ ‡å¿—åŠŸèƒ½ã€‚ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol>\n<li>ä½¿ç”¨æŒä¹…åŒ–çš„æ ‡å¿—ã€‚</li>\n</ol><p>æ ‡å¿—å¯ä»¥æ˜¯â€œæŒä¹…çš„â€ï¼Œè¿™æ„å‘³ç€è¯¥æ ‡å¿—å¯ç”¨äºå®ƒæ‰€åˆ†é…çš„å‘½ä»¤ä»¥åŠè¯¥å‘½ä»¤ä¸‹çš„æ¯ä¸ªå­å‘½ä»¤ã€‚å¯ä»¥åœ¨rootCmdä¸Šå®šä¹‰æŒä¹…æ ‡å¿—ï¼š</p><pre><code>rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, &quot;verbose&quot;, &quot;v&quot;, false, &quot;verbose output&quot;)\n</code></pre><ol start=\"2\">\n<li>ä½¿ç”¨æœ¬åœ°æ ‡å¿—ã€‚</li>\n</ol><p>ä¹Ÿå¯ä»¥åˆ†é…ä¸€ä¸ªæœ¬åœ°æ ‡å¿—ï¼Œæœ¬åœ°æ ‡å¿—åªèƒ½åœ¨å®ƒæ‰€ç»‘å®šçš„å‘½ä»¤ä¸Šä½¿ç”¨ï¼š</p><pre><code>rootCmd.Flags().StringVarP(&amp;Source, &quot;source&quot;, &quot;s&quot;, &quot;&quot;, &quot;Source directory to read from&quot;)\n</code></pre><p><code>--source</code>æ ‡å¿—åªèƒ½åœ¨rootCmdä¸Šå¼•ç”¨ï¼Œè€Œä¸èƒ½åœ¨rootCmdçš„å­å‘½ä»¤ä¸Šå¼•ç”¨ã€‚</p><ol start=\"3\">\n<li>å°†æ ‡å¿—ç»‘å®šåˆ°Viperã€‚</li>\n</ol><p>æˆ‘ä»¬å¯ä»¥å°†æ ‡å¿—ç»‘å®šåˆ°Viperï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨viper.Get()è·å–æ ‡å¿—çš„å€¼ã€‚</p><pre><code>var author string\n\nfunc init() {\n  rootCmd.PersistentFlags().StringVar(&amp;author, &quot;author&quot;, &quot;YOUR NAME&quot;, &quot;Author name for copyright attribution&quot;)\n  viper.BindPFlag(&quot;author&quot;, rootCmd.PersistentFlags().Lookup(&quot;author&quot;))\n}\n</code></pre><ol start=\"4\">\n<li>è®¾ç½®æ ‡å¿—ä¸ºå¿…é€‰ã€‚</li>\n</ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡å¿—æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®æ ‡å¿—ä¸ºå¿…é€‰ï¼Œå½“è®¾ç½®æ ‡å¿—ä¸ºå¿…é€‰ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›æ ‡å¿—æ—¶ï¼ŒCobraä¼šæŠ¥é”™ã€‚</p><pre><code>rootCmd.Flags().StringVarP(&amp;Region, &quot;region&quot;, &quot;r&quot;, &quot;&quot;, &quot;AWS region (required)&quot;)\nrootCmd.MarkFlagRequired(&quot;region&quot;)\n</code></pre><h3>éé€‰é¡¹å‚æ•°éªŒè¯</h3><p>åœ¨å‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šä¼ å…¥éé€‰é¡¹å‚æ•°ï¼Œå¹¶ä¸”éœ€è¦å¯¹è¿™äº›éé€‰é¡¹å‚æ•°è¿›è¡ŒéªŒè¯ï¼ŒCobraæä¾›äº†æœºåˆ¶æ¥å¯¹éé€‰é¡¹å‚æ•°è¿›è¡ŒéªŒè¯ã€‚å¯ä»¥ä½¿ç”¨Commandçš„Argså­—æ®µæ¥éªŒè¯éé€‰é¡¹å‚æ•°ã€‚Cobraä¹Ÿå†…ç½®äº†ä¸€äº›éªŒè¯å‡½æ•°ï¼š</p><ul>\n<li>NoArgsï¼šå¦‚æœå­˜åœ¨ä»»ä½•éé€‰é¡¹å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>ArbitraryArgsï¼šè¯¥å‘½ä»¤å°†æ¥å—ä»»ä½•éé€‰é¡¹å‚æ•°ã€‚</li>\n<li>OnlyValidArgsï¼šå¦‚æœæœ‰ä»»ä½•éé€‰é¡¹å‚æ•°ä¸åœ¨Commandçš„ValidArgså­—æ®µä¸­ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>MinimumNArgs(int)ï¼šå¦‚æœæ²¡æœ‰è‡³å°‘Nä¸ªéé€‰é¡¹å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>MaximumNArgs(int)ï¼šå¦‚æœæœ‰å¤šäºNä¸ªéé€‰é¡¹å‚æ•°ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>ExactArgs(int)ï¼šå¦‚æœéé€‰é¡¹å‚æ•°ä¸ªæ•°ä¸ä¸ºNï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>ExactValidArgs(int)ï¼šå¦‚æœéé€‰é¡¹å‚æ•°çš„ä¸ªæ•°ä¸ä¸ºNï¼Œæˆ–è€…éé€‰é¡¹å‚æ•°ä¸åœ¨Commandçš„ValidArgså­—æ®µä¸­ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n<li>RangeArgs(min, max)ï¼šå¦‚æœéé€‰é¡¹å‚æ•°çš„ä¸ªæ•°ä¸åœ¨minå’Œmaxä¹‹é—´ï¼Œè¯¥å‘½ä»¤å°†æŠ¥é”™ã€‚</li>\n</ul><p>ä½¿ç”¨é¢„å®šä¹‰éªŒè¯å‡½æ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>var cmd = &amp;cobra.Command{\n  Short: &quot;hello&quot;,\n  Args: cobra.MinimumNArgs(1), // ä½¿ç”¨å†…ç½®çš„éªŒè¯å‡½æ•°\n  Run: func(cmd *cobra.Command, args []string) {\n    fmt.Println(&quot;Hello, World!&quot;)\n  },\n}\n</code></pre><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>var cmd = &amp;cobra.Command{\n  Short: &quot;hello&quot;,\n  // Args: cobra.MinimumNArgs(10), // ä½¿ç”¨å†…ç½®çš„éªŒè¯å‡½æ•°\n  Args: func(cmd *cobra.Command, args []string) error { // è‡ªå®šä¹‰éªŒè¯å‡½æ•°\n    if len(args) &lt; 1 {\n      return errors.New(&quot;requires at least one arg&quot;)\n    }\n    if myapp.IsValidColor(args[0]) {\n      return nil\n    }\n    return fmt.Errorf(&quot;invalid color specified: %s&quot;, args[0])\n  },\n  Run: func(cmd *cobra.Command, args []string) {\n    fmt.Println(&quot;Hello, World!&quot;)\n  },\n}\n</code></pre><h3>PreRun and PostRun Hooks</h3><p>åœ¨è¿è¡ŒRunå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€äº›é’©å­å‡½æ•°ï¼Œæ¯”å¦‚PersistentPreRunå’ŒPreRunå‡½æ•°åœ¨Runå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼ŒPersistentPostRunå’ŒPostRunåœ¨Runå‡½æ•°ä¹‹åæ‰§è¡Œã€‚å¦‚æœå­å‘½ä»¤æ²¡æœ‰æŒ‡å®š<code>Persistent*Run</code>å‡½æ•°ï¼Œåˆ™å­å‘½ä»¤å°†ä¼šç»§æ‰¿çˆ¶å‘½ä»¤çš„<code>Persistent*Run</code>å‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„è¿è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p><ol>\n<li>PersistentPreRun</li>\n<li>PreRun</li>\n<li>Run</li>\n<li>PostRun</li>\n<li>PersistentPostRun</li>\n</ol><p>æ³¨æ„ï¼Œçˆ¶çº§çš„PreRunåªä¼šåœ¨çˆ¶çº§å‘½ä»¤è¿è¡Œæ—¶è°ƒç”¨ï¼Œå­å‘½ä»¤æ˜¯ä¸ä¼šè°ƒç”¨çš„ã€‚</p><p>Cobraè¿˜æ”¯æŒå¾ˆå¤šå…¶ä»–æœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šè‡ªå®šä¹‰Helpå‘½ä»¤ï¼›å¯ä»¥è‡ªåŠ¨æ·»åŠ <code>--version</code>æ ‡å¿—ï¼Œè¾“å‡ºç¨‹åºç‰ˆæœ¬ä¿¡æ¯ï¼›å½“ç”¨æˆ·æä¾›æ— æ•ˆæ ‡å¿—æˆ–æ— æ•ˆå‘½ä»¤æ—¶ï¼ŒCobraå¯ä»¥æ‰“å°å‡ºusageä¿¡æ¯ï¼›å½“æˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤æœ‰è¯¯æ—¶ï¼ŒCobraä¼šæ ¹æ®æ³¨å†Œçš„å‘½ä»¤ï¼Œæ¨ç®—å‡ºå¯èƒ½çš„å‘½ä»¤ï¼Œç­‰ç­‰ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨å¼€å‘Goé¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Pflagæ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œé€šè¿‡Viperæ¥è§£æé…ç½®æ–‡ä»¶ï¼Œç”¨Cobraæ¥å®ç°å‘½ä»¤è¡Œæ¡†æ¶ã€‚ä½ å¯ä»¥é€šè¿‡pflag.String()ã€ pflag.StringP()ã€pflag.StringVar()ã€pflag.StringVarP()æ–¹æ³•æ¥è®¾ç½®å‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶ä½¿ç”¨Get<code>&lt;Type&gt;</code>æ¥è·å–å‚æ•°çš„å€¼ã€‚</p><p>åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Viperä»å‘½ä»¤è¡Œå‚æ•°ã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰ä½ç½®è¯»å–é…ç½®é¡¹ã€‚æœ€å¸¸ç”¨çš„æ˜¯ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–ï¼Œå¯ä»¥é€šè¿‡viper.AddConfigPathæ¥è®¾ç½®é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œé€šè¿‡viper.SetConfigFileå’Œviper.SetConfigTypeæ¥è®¾ç½®é…ç½®æ–‡ä»¶åï¼Œé€šè¿‡viper.ReadInConfigæ¥è¯»å–é…ç½®æ–‡ä»¶ã€‚è¯»å–å®Œé…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ç¨‹åºä¸­ä½¿ç”¨Get/Get<code>&lt;Type&gt;</code>æ¥è¯»å–é…ç½®é¡¹çš„å€¼ã€‚</p><p>æœ€åï¼Œä½ å¯ä»¥ä½¿ç”¨Cobraæ¥æ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œæ¡†æ¶ï¼ŒCobraå¯ä»¥å¾ˆå¥½åœ°é›†æˆPflagå’ŒViperã€‚</p><h2>è¯¾åç»ƒä¹ </h2><ol>\n<li>\n<p>ç ”ç©¶ä¸‹Cobraçš„ä»£ç ï¼Œçœ‹ä¸‹Cobraæ˜¯å¦‚ä½•è·ŸPflagå’ŒViperè¿›è¡Œé›†æˆçš„ã€‚</p>\n</li>\n<li>\n<p>æ€è€ƒä¸‹ï¼Œé™¤äº†Pflagã€Viperã€Cobraï¼Œä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿˜é‡åˆ°å“ªäº›ä¼˜ç§€çš„åŒ…ï¼Œæ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€é…ç½®æ–‡ä»¶å’Œå¯åŠ¨å‘½ä»¤è¡Œæ¡†æ¶çš„å‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</p>\n</li>\n</ol><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":306933,"user_name":"Sch0ng","can_delete":false,"product_type":"c1","uid":1145554,"ip_address":"","ucode":"73F6113931B1AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg","comment_is_top":false,"comment_ctime":1628780966,"is_pvip":false,"replies":[{"id":"111395","content":"è€å“¥ï¼Œå­¦çš„å¥½è®¤çœŸå‘€ï¼Œç»™ç‚¹ä¸ªèµï¼","user_name":"ä½œè€…å›å¤","user_name_real":"CK1.0","uid":"1167883","ctime":1629243413,"ip_address":"","comment_id":306933,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48873421222","product_id":100079601,"comment_content":"ä½¿ç”¨Pflagè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨Viperè§£æé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨Cobraå®ç°å‘½ä»¤è¡Œæ¡†æ¶ã€‚<br>å¤ç”¨ä¼˜ç§€è½®å­çœæ—¶çœåŠ›ã€‚","like_count":11,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524981,"discussion_content":"è€å“¥ï¼Œå­¦çš„å¥½è®¤çœŸå‘€ï¼Œç»™ç‚¹ä¸ªèµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629243413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304340,"user_name":"å®™æ–¯","can_delete":false,"product_type":"c1","uid":2041396,"ip_address":"","ucode":"80DF36BAD298AD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","comment_is_top":false,"comment_ctime":1627359871,"is_pvip":true,"replies":[{"id":"110217","content":"æ¯”å¦‚ï¼š.&#47;iam-apiserver -c &#47;etc&#47;iam&#47;iam-apiserver.yaml<br><br>-cæ˜¯flagã€‚<br><br>&#47;etc&#47;iam&#47;iam-apiserveræ˜¯éé€‰é¡¹å‚æ•°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CK1.0","uid":"1167883","ctime":1627597721,"ip_address":"","comment_id":304340,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31692130943","product_id":100079601,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼šflagå’Œéé€‰é¡¹å‚æ•°æ•°ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524019,"discussion_content":"æ¯”å¦‚ï¼š./iam-apiserver -c /etc/iam/iam-apiserver.yaml\n\n-cæ˜¯flagã€‚\n\n/etc/iam/iam-apiserveræ˜¯éé€‰é¡¹å‚æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627597721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1248326,"avatar":"https://static001.geekbang.org/account/avatar/00/13/0c/46/dfe32cf4.jpg","nickname":"å¤šé€‰å‚æ•°","note":"","ucode":"B2294D80AB075F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394165,"discussion_content":"iam-apiserver -c /etc/iam/iam-apiserver.yaml demo.yaml è¿™é‡Œå¤´çš„ demo.yaml æ‰æ˜¯éé€‰é¡¹å‚æ•°å§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631762391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332410,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1643217356,"is_pvip":false,"replies":[{"id":"121556","content":"6666","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1167883","ctime":1643454962,"ip_address":"","comment_id":332410,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23118053836","product_id":100079601,"comment_content":"æ€»ç»“ä¸€ä¸‹ï¼š<br>1ï¼šcobra = flag+å¯åŠ¨æµç¨‹ç®¡ç†<br>2ï¼š viperè¯»å–é…ç½®æ–‡ä»¶+flagå‚æ•° æœ€å ååºåˆ—åŒ–å‡ºæ¥ä¸€ä¸ªé…ç½®structå®ä¾‹<br>ps æœ€ç»ˆä»£ç é‡Œæ²¡æœ‰pflagåŒ…çš„äº‹","like_count":5,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548949,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643454962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302919,"user_name":"é¾æ²é¢¨","can_delete":false,"product_type":"c1","uid":1470209,"ip_address":"","ucode":"CB054020183938","user_header":"https://static001.geekbang.org/account/avatar/00/16/6f/01/7b82dd50.jpg","comment_is_top":false,"comment_ctime":1626434376,"is_pvip":false,"replies":[{"id":"109742","content":"net&#47;httpåŒ…æœ‰æä¾›ShutDownæ–¹æ³•ã€‚<br><br>ç¬¬24è®²ï¼šWeb æœåŠ¡ï¼šWeb æœåŠ¡æ ¸å¿ƒåŠŸèƒ½æœ‰å“ªäº›ï¼Œå¦‚ä½•å®ç°ï¼Ÿæœ‰è®²å¦‚ä½•å®ç°ä¼˜é›…å…³åœã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CK1.0","uid":"1167883","ctime":1626683347,"ip_address":"","comment_id":302919,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18806303560","product_id":100079601,"comment_content":"æƒ³é—®ä¸‹ï¼Œå…³äºgolangçš„é¡¹ç›®æ€ä¹ˆå®ç°ä¼˜é›…ä¸‹çº¿ï¼Ÿæ³¨å†Œä¸­å¿ƒå¯ä»¥å°†æœåŠ¡èŠ‚ç‚¹å‰”é™¤ï¼Œä½†å…³é—­æœåŠ¡æ—¶æ€ä¹ˆè®©å·²æ¥æ”¶åˆ°è¯·æ±‚å¯ä»¥åšå®Œå‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523478,"discussion_content":"net/httpåŒ…æœ‰æä¾›ShutDownæ–¹æ³•ã€‚\n\nç¬¬24è®²ï¼šWeb æœåŠ¡ï¼šWeb æœåŠ¡æ ¸å¿ƒåŠŸèƒ½æœ‰å“ªäº›ï¼Œå¦‚ä½•å®ç°ï¼Ÿæœ‰è®²å¦‚ä½•å®ç°ä¼˜é›…å…³åœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626683347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337543,"user_name":"ğŸ’A","can_delete":false,"product_type":"c1","uid":1075412,"ip_address":"","ucode":"914FFA92CA2713","user_header":"https://static001.geekbang.org/account/avatar/00/10/68/d4/c9b5d3f9.jpg","comment_is_top":false,"comment_ctime":1646883659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10236818251","product_id":100079601,"comment_content":"Pflag + Cobra ä¸å¦‚ç›´æ¥ç”¨github.com&#47;urfave&#47;cli","like_count":2},{"had_liked":false,"id":302797,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1626374352,"is_pvip":false,"replies":[{"id":"109745","content":"å¦‚æœå‚æ•°å°‘ï¼Œæ¯”å¦‚&lt; 5ä¸ªï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šã€‚<br><br>å¦‚æœå‚æ•° &gt;=5ä¸ªï¼Œæœ€å¥½åœ¨é…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¥½ç»´æŠ¤ã€‚<br><br>æ³¨æ„ï¼š5 ä¸æ˜¯æ ‡å‡†ç­”æ¡ˆï¼Œéœ€è¦ä½ æ¥å®šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CK1.0","uid":"1167883","ctime":1626683670,"ip_address":"","comment_id":302797,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10216308944","product_id":100079601,"comment_content":"å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œå…³äºä¸åŒç¯å¢ƒä¸‹è¯»å–é…ç½®æ–‡ä»¶ï¼Œè¿™å—æœ‰ä»€ä¹ˆå¥½çš„æœ€ä½³å®è·µå—ï¼Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶çš„æ–¹å¼å¥½å‘¢ï¼Œè¿˜æ˜¯é€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥åŒºåˆ†ç¯å¢ƒå¹¶è¯»å–å¯¹åº”é…ç½®æ–‡ä»¶å¥½å‘¢","like_count":2,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523426,"discussion_content":"å¦‚æœå‚æ•°å°‘ï¼Œæ¯”å¦‚&amp;lt; 5ä¸ªï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šã€‚\n\nå¦‚æœå‚æ•° &amp;gt;=5ä¸ªï¼Œæœ€å¥½åœ¨é…ç½®æ–‡ä»¶æŒ‡å®šï¼Œå¥½ç»´æŠ¤ã€‚\n\næ³¨æ„ï¼š5 ä¸æ˜¯æ ‡å‡†ç­”æ¡ˆï¼Œéœ€è¦ä½ æ¥å®šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626683670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136865,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/QNndAuVPlyJPHwhnibhonPJVt3F631CfUx13HkXicYib9mXXOfr4b6d0vKVZ48K9gc7XFWP70VmMlH9AEZsqyvCFw/132","nickname":"xavier","note":"","ucode":"F408D2F492E423","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551401,"discussion_content":"å¯ä»¥å†™åœ¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååº”ç”¨è¿è¡Œæ—¶ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šä½¿ç”¨å¯¹åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645009184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2004616,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/96/88/454e401c.jpg","nickname":"é”€æ¯first","note":"","ucode":"34685269D0CDD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411480,"discussion_content":"apollo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635938776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302665,"user_name":"Neroldy","can_delete":false,"product_type":"c1","uid":2487789,"ip_address":"","ucode":"FD6EF1AAC00FC5","user_header":"https://static001.geekbang.org/account/avatar/00/25/f5/ed/d23daf19.jpg","comment_is_top":false,"comment_ctime":1626324938,"is_pvip":false,"replies":[{"id":"109749","content":"å°±æ˜¯å¦‚æœä¸€ä¸ªæ ‡å¿—æ˜¯â€œæŒä¹…çš„â€ï¼Œé‚£ä¹ˆå­å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨çˆ¶å‘½ä»¤çš„æ ‡å¿—ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"CK1.0","uid":"1167883","ctime":1626684549,"ip_address":"","comment_id":302665,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10216259530","product_id":100079601,"comment_content":"æ ‡å¿—å¯ä»¥æ˜¯â€œæŒä¹…çš„â€ï¼Œè¿™æ„å‘³ç€è¯¥æ ‡å¿—å¯ç”¨äºå®ƒæ‰€åˆ†é…çš„å‘½ä»¤ä»¥åŠè¯¥å‘½ä»¤ä¸‹çš„æ¯ä¸ªå­å‘½ä»¤ã€‚<br>è€å¸ˆèƒ½å†å…·ä½“è®²è®²è¿™ä¸ªæ ‡å¿—çš„æŒä¹…åŒ–æ˜¯ä»€ä¹ˆæ„æ€å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523379,"discussion_content":"å°±æ˜¯å¦‚æœä¸€ä¸ªæ ‡å¿—æ˜¯â€œæŒä¹…çš„â€ï¼Œé‚£ä¹ˆå­å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨çˆ¶å‘½ä»¤çš„æ ‡å¿—ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626684549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338203,"user_name":"Geek_d9ada3","can_delete":false,"product_type":"c1","uid":2741922,"ip_address":"","ucode":"275C14ECAC4AE7","user_header":"https://static001.geekbang.org/account/avatar/00/29/d6/a2/bff28e13.jpg","comment_is_top":false,"comment_ctime":1647352322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5942319618","product_id":100079601,"comment_content":"æ„Ÿè§‰cobraå­¦çš„æœ‰ç‚¹æ²¡æœ‰å¤´ç»ªï¼Œè¦ä¹ˆæ¦‚å¿µä¸Šæ²¡å‘ç†è§£åˆ°ä½ï¼Œè¦ä¹ˆæ‰¾ä¸åˆ°å®é™…ä¾‹å­å¯ä»¥çœ‹çœ‹æ•ˆæœã€‚ å»ºè®®è¿™å—å¯ä»¥å®Œå–„ä¸°å¯Œä¸€ä¸‹ï¼ŒæŠŠæ¦‚å¿µå’Œä¾‹å­éƒ½æ•´è¯¦ç»†ç‚¹ã€‚è°¢è°¢å¤§ä½¬","like_count":2},{"had_liked":false,"id":360800,"user_name":"æˆ‘è¦å»å–å†°æ·‡æ·‹","can_delete":false,"product_type":"c1","uid":2975285,"ip_address":"ä¸Šæµ·","ucode":"C86A079796C333","user_header":"https://static001.geekbang.org/account/avatar/00/2d/66/35/c3fa51c0.jpg","comment_is_top":false,"comment_ctime":1666860696,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666860696","product_id":100079601,"comment_content":"è€å¸ˆæˆ‘æœ‰ä¸ªç–‘é—®.ä¾‹å¦‚ æˆ‘ç°åœ¨è¦åœ¨åˆ«çš„æ–¹æ³•ä¸­å¼•ç”¨yamlä¸­é…ç½®çš„å˜é‡ï¼Œä½†åœ¨ä»£ç ä¸­æˆ‘æ²¡æœ‰å‘ç°globalå­˜é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œéš¾é“åªèƒ½ 1ã€‚è‡ªå·±å£°æ˜ä¸€ä¸ªå…¨å±€äº†å­˜å‚¨ï¼Œ2 ç›´æ¥ç”¨ viper.GetString(&quot;xxx.xxx&quot;) æ–¹å¼ã€‚<br>æˆ‘åœ¨è§‚å¯Ÿä»£ç çš„æ—¶å€™ å‘ç°æ‰€æœ‰çš„åˆå§‹åŒ–ä¿¡æ¯åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ å¯åŠ¨ä¹‹åˆå¤„ç†å¥½äº†ã€‚","like_count":0},{"had_liked":false,"id":355851,"user_name":"czy","can_delete":false,"product_type":"c1","uid":2398831,"ip_address":"åŒ—äº¬","ucode":"660826F2ABA3E4","user_header":"https://static001.geekbang.org/account/avatar/00/24/9a/6f/c4490cf2.jpg","comment_is_top":false,"comment_ctime":1661785471,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661785471","product_id":100079601,"comment_content":"Viperè¯»å–é…ç½®éƒ¨åˆ†ç¬¬2ç§æ–¹æ³•ååºåˆ—åŒ–ä¸¤ä¸ªç¤ºä¾‹è§£é‡Šçš„å¾ˆä¸æ¸…æ¥šï¼Œè¿‡äºæ™¦æ¶©äº†ï¼Œä¸å¦‚ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸¤ä¸ªä¾‹å­æ˜¯å®˜æ–¹ä¸Šçš„ï¼Œå°±ç›´æ¥ç¿»è¯‘æ¬è¿‡æ¥äº†å§ï¼Ÿä¹Ÿæ²¡æœ‰åŠ ä¸€äº›è§£æã€‚","like_count":0},{"had_liked":false,"id":355394,"user_name":"é›ªå³°","can_delete":false,"product_type":"c1","uid":2425171,"ip_address":"æ±Ÿè‹","ucode":"D21CAEEAFC43ED","user_header":"https://static001.geekbang.org/account/avatar/00/25/01/53/eafa07ae.jpg","comment_is_top":false,"comment_ctime":1661331627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661331627","product_id":100079601,"comment_content":"viperåœ¨å®¹å™¨ä¸­æ— æ³•watch","like_count":0},{"had_liked":false,"id":351760,"user_name":"scorpio","can_delete":false,"product_type":"c1","uid":1265510,"ip_address":"","ucode":"183AA132ECBB27","user_header":"https://static001.geekbang.org/account/avatar/00/13/4f/66/88acb1cc.jpg","comment_is_top":false,"comment_ctime":1658158805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658158805","product_id":100079601,"comment_content":"è¿™æ®µä»£ç æœ€åä¸€è¡Œï¼Œåº”è¯¥åŠ ä¸Š VIPER_ å‰ç¼€ï¼Œå¦åˆ™è·å–ä¸åˆ°å˜é‡ã€‚<br><br>&#47;&#47; ä½¿ç”¨ç¯å¢ƒå˜é‡<br>os.Setenv(&quot;VIPER_USER_SECRET_ID&quot;, &quot;QLdywI2MrmDVjSSv6e95weNRvmteRjfKAuNV&quot;)<br>os.Setenv(&quot;VIPER_USER_SECRET_KEY&quot;, &quot;bVix2WBv0VPfrDrvlLWrhEdzjLpPCNYb&quot;)<br><br>viper.AutomaticEnv()                                             &#47;&#47; è¯»å–ç¯å¢ƒå˜é‡<br>viper.SetEnvPrefix(&quot;VIPER&quot;)                                      &#47;&#47; è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€ï¼šVIPER_ï¼Œå¦‚æœæ˜¯viperï¼Œå°†è‡ªåŠ¨è½¬å˜ä¸ºå¤§å†™ã€‚<br>viper.SetEnvKeyReplacer(strings.NewReplacer(&quot;.&quot;, &quot;_&quot;, &quot;-&quot;, &quot;_&quot;)) &#47;&#47; å°†viper.Get(key) keyå­—ç¬¦ä¸²ä¸­&#39;.&#39;å’Œ&#39;-&#39;æ›¿æ¢ä¸º&#39;_&#39;<br>viper.BindEnv(&quot;user.secret-key&quot;)<br>viper.BindEnv(&quot;user.secret-id&quot;, &quot;USER_SECRET_ID&quot;) &#47;&#47; ç»‘å®šç¯å¢ƒå˜é‡ååˆ°key","like_count":0},{"had_liked":false,"id":349579,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/e24e181e.jpg","comment_is_top":false,"comment_ctime":1656088572,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656088572","product_id":100079601,"comment_content":"å­”è€å¸ˆï¼Œæœ‰å‡ ä¸ªé—®é¢˜æƒ³è¯·æ±‚ä¸‹ï¼š<br>1ã€viper æœ‰æ²¡æœ‰åŠæ³•é…ç½®è®©å®ƒèƒ½åŒºåˆ†å¤§å°å†™çš„é…ç½® Keyï¼Ÿ<br>2ã€å¦‚æœæœ‰ä¸€é•¿ä¸²çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ä»¥ä¸‹ yml é…ç½®ï¼Œviper æœ‰æ²¡æœ‰åŠæ³•åªååºåˆ—åŒ–æˆ‘è¦å…³å¿ƒçš„å†…å±‚çš„é‚£ä¸€éƒ¨åˆ†é…ç½®ï¼ˆè¿™æ ·æˆ‘ä¸ç”¨å®šä¹‰å…¶ä»–é…ç½®é¡¹ç»“æ„ä½“å’Œå®ƒçš„å¤–å±‚ç»“æ„ä½“ï¼‰ï¼Ÿ<br>aaa:<br>  foo:<br>    bar: 123<br>    hhh: &quot;$%^&quot;<br>bbb:<br>  bar: foo<br>  hello:<br>  - world<br>  - hihihi<br>åªååºåˆ—åŒ– aaa.foo é…ç½®å­é¡¹ä¸ºä»¥ä¸‹ç»“æ„ä½“ï¼š<br>type AFoo struct {<br>    bar  int<br>    hhh string<br>}","like_count":0},{"had_liked":false,"id":342465,"user_name":"Geek_8efe79","can_delete":false,"product_type":"c1","uid":1656311,"ip_address":"","ucode":"16CE0115636F3A","user_header":"","comment_is_top":false,"comment_ctime":1650277574,"is_pvip":false,"replies":[{"id":"125525","content":"åé¢è€ƒè™‘å‡ºä¸ªè§†é¢‘è¯¾ç¨‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1167883","ctime":1651078169,"ip_address":"","comment_id":342465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650277574","product_id":100079601,"comment_content":"å…¨æ˜¯æ–‡å­—çœ‹ç€å¥½å¿ƒç´¯ï¼Œæ²¡æœ‰è§†é¢‘ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568216,"discussion_content":"åé¢è€ƒè™‘å‡ºä¸ªè§†é¢‘è¯¾ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651078169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327471,"user_name":"Struggle~honor","can_delete":false,"product_type":"c1","uid":1975831,"ip_address":"","ucode":"EBC6DFC6CF0973","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rSzzqGwHcvhwPejiaPsCY9XBX7ib7zTxJ6cUDORdhGIakX8dTPVsz6ibud5ec1FeWQGTseF2TPRECCjky5JMlHvDg/132","comment_is_top":false,"comment_ctime":1640142104,"is_pvip":false,"replies":[{"id":"119713","content":"å¦‚æœå†…éƒ¨ä¸šåŠ¡æœ‰å¥½çš„è½®å­ï¼Œæœ€å¥½ç”¨å†…éƒ¨çš„è½®å­ã€‚è¿™ä¸ªæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œè¿˜æ˜¯è¦çœ‹åœºæ™¯ã€æ–¹æ¡ˆé€‚ä¸é€‚åˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1167883","ctime":1640826550,"ip_address":"","comment_id":327471,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640142104","product_id":100079601,"comment_content":"è€å¸ˆï¼Œå¤§å‚é‡Œé¢åº”ç”¨æ„å»ºï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨è‡ªå·±å†…éƒ¨é€ çš„è½®å­ï¼Œæ›´ç¬¦åˆä¸šåŠ¡è¦æ±‚å¯¹å—ï¼Ÿ ä¹‹å‰åœ¨è…¾è®¯å®ä¹ ç”¨rainbowé…ç½®ä¸­å¿ƒæ¥å­˜æ”¾é…ç½®ï¼Œç”¨ä»–çš„sdkæ¥æ‹‰å–é…ç½®","like_count":0,"discussions":[{"author":{"id":1167883,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/0b/cdd0787a.jpg","nickname":"å­”ä»¤é£","note":"","ucode":"8363EA4BD0AAF0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542660,"discussion_content":"å¦‚æœå†…éƒ¨ä¸šåŠ¡æœ‰å¥½çš„è½®å­ï¼Œæœ€å¥½ç”¨å†…éƒ¨çš„è½®å­ã€‚è¿™ä¸ªæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œè¿˜æ˜¯è¦çœ‹åœºæ™¯ã€æ–¹æ¡ˆé€‚ä¸é€‚åˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640826550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}