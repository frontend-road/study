{"id":806865,"title":"06ï½œRAGæ£€ç´¢ï¼šæ··åˆæ£€ç´¢ä¸é‡æ’åºæŠ€æœ¯","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¸¸æ‰¬ã€‚</p><p>æˆ‘ä»¬æœ¬èŠ‚è¯¾æ­£å¼å¼€å§‹è®²è§£ <strong>RAG æ£€ç´¢æµç¨‹</strong>ã€‚å½“å‰ä¸»æµçš„ RAG æ£€ç´¢æ–¹å¼ä¸»è¦é‡‡ç”¨<strong>å‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰</strong>ï¼Œé€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦æ¥åŒ¹é…æ–‡æœ¬åˆ‡å—ã€‚è¿™ç§æ–¹æ³•åœ¨æˆ‘ä»¬ä¹‹å‰çš„è¯¾ç¨‹ä¸­å·²ç»æ·±å…¥æ¢è®¨è¿‡äº†ã€‚ç„¶è€Œï¼Œå‘é‡æ£€ç´¢å¹¶éä¸‡èƒ½ï¼Œå®ƒåœ¨æŸäº›åœºæ™¯ä¸‹æ— æ³•æ›¿ä»£ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢çš„ä¼˜åŠ¿ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“ä½ éœ€è¦ç²¾å‡†æœç´¢æŸä¸ªè®¢å• IDã€å“ç‰Œåç§°æˆ–åœ°å€ï¼Œæˆ–è€…æœç´¢ç‰¹å®šäººç‰©æˆ–ç‰©å“çš„åå­—ï¼ˆå¦‚ä¼Šéš†Â·é©¬æ–¯å…‹ã€iPhone 15ï¼‰æ—¶ï¼Œå‘é‡æ£€ç´¢çš„å‡†ç¡®æ€§å¾€å¾€ä¸å¦‚å…³é”®è¯æ£€ç´¢ã€‚æ­¤å¤–ï¼Œå½“ç”¨æˆ·è¾“å…¥çš„é—®é¢˜éå¸¸ç®€çŸ­ï¼Œä»…åŒ…å«å‡ ä¸ªå•è¯æ—¶ï¼Œæ¯”å¦‚æœç´¢ç¼©å†™è¯æˆ–çŸ­è¯­ï¼ˆå¦‚ RAGã€LLMï¼‰ï¼Œè¯­ä¹‰åŒ¹é…çš„æ•ˆæœä¹Ÿå¯èƒ½ä¸å°½ç†æƒ³ã€‚</p><p>è¿™äº›æ­£æ˜¯ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚å…³é”®è¯æ£€ç´¢ï¼ˆKeyword Searchï¼‰åœ¨å‡ ä¸ªåœºæ™¯ä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ï¼š<strong>ç²¾ç¡®åŒ¹é…</strong>ï¼Œå¦‚äº§å“åç§°ã€å§“åã€äº§å“ç¼–å·ï¼›<strong>å°‘é‡å­—ç¬¦çš„åŒ¹é…</strong>ï¼Œç”¨æˆ·ä¹ æƒ¯äºè¾“å…¥å‡ ä¸ªå…³é”®è¯ï¼Œè€Œå°‘é‡å­—ç¬¦è¿›è¡Œå‘é‡æ£€ç´¢æ—¶æ•ˆæœå¯èƒ½è¾ƒå·®ï¼›ä»¥åŠ<strong>ä½é¢‘è¯æ±‡çš„åŒ¹é…</strong>ï¼Œä½é¢‘è¯æ±‡å¾€å¾€æ‰¿è½½äº†å…³é”®æ„ä¹‰ï¼Œå¦‚åœ¨â€œä½ æƒ³è·Ÿæˆ‘å»å–å’–å•¡å—ï¼Ÿâ€è¿™å¥è¯ä¸­ï¼Œâ€œå–â€â€œå’–å•¡â€æ¯”â€œä½ â€â€œå—â€æ›´å…·é‡è¦æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/57/15/57337062d6bf564a0116412f889c4615.jpg?wh=2000x916\" alt=\"\"></p><p>åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œè™½ç„¶ä¾é å…³é”®è¯æ£€ç´¢å¯ä»¥ç²¾ç¡®æ‰¾åˆ°ä¸â€œè®¢å• 12345â€åŒ¹é…çš„ç‰¹å®šä¿¡æ¯ï¼Œä½†å®ƒæ— æ³•æä¾›ä¸è®¢å•ç›¸å…³çš„æ›´å¹¿æ³›ä¸Šä¸‹æ–‡ã€‚å¦ä¸€æ–¹é¢ï¼Œè¯­ä¹‰åŒ¹é…è™½ç„¶èƒ½å¤Ÿè¯†åˆ«â€œè®¢å•â€å’Œâ€œé…é€â€ç­‰ç›¸å…³æ¦‚å¿µï¼Œä½†åœ¨å¤„ç†å…·ä½“çš„è®¢å• ID æ—¶ï¼Œå¾€å¾€å®¹æ˜“å‡ºé”™ã€‚</p><!-- [[[read_end]]] --><p><strong>æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰</strong>é€šè¿‡ç»“åˆå…³é”®è¯æ£€ç´¢å’Œè¯­ä¹‰åŒ¹é…çš„ä¼˜åŠ¿ï¼Œå¯ä»¥é¦–å…ˆåˆ©ç”¨å…³é”®è¯æ£€ç´¢ç²¾ç¡®å®šä½åˆ°â€œè®¢å• 12345â€çš„ä¿¡æ¯ï¼Œç„¶åé€šè¿‡è¯­ä¹‰åŒ¹é…æ‰©å±•ä¸è¯¥è®¢å•ç›¸å…³çš„å…¶ä»–ä¸Šä¸‹æ–‡æˆ–å®¢æˆ·æ“ä½œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚â€œ12å¼€å¤´çš„è®¢å•ã€åŒ…è£…ç ´æŸä¸¥é‡â€ç­‰ã€‚è¿™æ ·ä¸ä»…èƒ½å¤Ÿè·å–ç²¾ç¡®çš„è®¢å•è¯¦æƒ…ï¼Œè¿˜èƒ½è·å¾—ä¸ä¹‹ç›¸å…³çš„é¢å¤–æœ‰ç”¨ä¿¡æ¯ã€‚</p><p>åœ¨ RAG æ£€ç´¢åœºæ™¯ä¸­ï¼Œé¦–è¦ç›®æ ‡æ˜¯<strong>ç¡®ä¿æœ€ç›¸å…³çš„ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨å€™é€‰åˆ—è¡¨</strong>ä¸­ã€‚å‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢å„æœ‰å…¶ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œæ··åˆæ£€ç´¢é€šè¿‡ç»“åˆè¿™å¤šç§æ£€ç´¢æŠ€æœ¯ï¼Œå¼¥è¡¥äº†å„è‡ªçš„ä¸è¶³ï¼Œæä¾›äº†ä¸€ç§æ›´åŠ å…¨é¢çš„æœç´¢æ–¹æ¡ˆã€‚</p><p>ä»…å…·å¤‡æ··åˆæ£€ç´¢çš„èƒ½åŠ›è¿˜ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ï¼Œæ£€ç´¢åˆ°çš„ç»“æœè¿˜éœ€è¦ç»è¿‡ä¼˜åŒ–æ’åºã€‚<strong>é‡æ’åºï¼ˆRerankingï¼‰</strong>çš„ç›®çš„æ˜¯å°†æ··åˆæ£€ç´¢çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œå¹¶å°†ä¸ç”¨æˆ·é—®é¢˜è¯­ä¹‰æœ€å¥‘åˆçš„ç»“æœæ’åœ¨å‰åˆ—ã€‚åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œç”±äºç¼ºä¹æœ‰æ•ˆçš„æ’åºï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœä½äºç¬¬ä¸€å’Œç¬¬å››ä½ï¼Œå°½ç®¡ä¾ç„¶å¯ä»¥è¢«æ£€ç´¢åˆ°ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœæ£€ç´¢æ–¹å¼æ›´ä¸ºç²¾ç¡®ï¼Œè¯¥ç»“æœåº”è¯¥è¢«ä¼˜å…ˆæ’åºåœ¨å‰ä¸¤ä½ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f0/e0/f07619c5f03bdf04649d97f8c0f18be0.jpg?wh=1920x770\" alt=\"å›¾ç‰‡\"></p><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é‡æ’åºæŠ€æœ¯æˆåŠŸæ‰¾åˆ°äº†ä¸é—®é¢˜è¯­ä¹‰æœ€å¥‘åˆçš„ç»“æœã€‚ç³»ç»Ÿè¯„åˆ†æ˜¾ç¤ºï¼Œâ€œè®¢å• 12345 äº 2023 å¹´ 8 æœˆ 15 æ—¥åœ¨ä¸Šæµ·ï¼Œå®¢æˆ·ä¸æ»¡æ„ã€‚â€ä¸â€œè¯¥12å¼€å¤´çš„è®¢å•å®¢æˆ·ä¸æ»¡æ„çš„åœ°æ–¹åœ¨äºåŒ…è£…ç ´æŸä¸¥é‡ã€‚â€è¿™ä¸¤ä¸ªæ–‡æ¡£å—çš„ç›¸å…³æ€§åˆ†åˆ«ä¸º 0.9 å’Œ 0.8ï¼Œæ’åºä¸ºç¬¬ä¸€å’Œç¬¬äºŒä½ã€‚</p><p><strong>é‡æ’åºæŠ€æœ¯</strong>åœ¨æ£€ç´¢ç³»ç»Ÿä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚å³ä½¿æ£€ç´¢ç®—æ³•å·²ç»èƒ½å¤Ÿæ•æ‰åˆ°æ‰€æœ‰ç›¸å…³çš„ç»“æœï¼Œé‡æ’åºè¿‡ç¨‹ä¾ç„¶ä¸å¯æˆ–ç¼ºã€‚å®ƒç¡®ä¿<strong>æœ€ç¬¦åˆç”¨æˆ·æ„å›¾å’ŒæŸ¥è¯¢è¯­ä¹‰çš„ç»“æœä¼˜å…ˆå±•ç¤º</strong>ï¼Œä»è€Œæå‡ç”¨æˆ·çš„æœç´¢ä½“éªŒå’Œç»“æœçš„å‡†ç¡®æ€§ã€‚é€šè¿‡é‡æ’åºï¼Œæ£€ç´¢ç³»ç»Ÿä¸ä»…èƒ½æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè¿˜èƒ½æ™ºèƒ½åœ°å°†æœ€é‡è¦çš„ä¿¡æ¯å‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚</p><p>æœ¬èŠ‚è¯¾å°†æ·±å…¥è®²è§£ RAG æ£€ç´¢æµç¨‹ä¸­çš„<strong>æ··åˆæ£€ç´¢ï¼ˆå¤šè·¯å¬å›ï¼‰ä¸é‡æ’åºæŠ€æœ¯</strong>ã€‚ç›¸å…³å®æˆ˜ä»£ç å·²å‘å¸ƒåœ¨ Gitee æ‰˜ç®¡é¡¹ç›®ä¸­ï¼Œä»£ç æ–‡ä»¶ä¸º <strong>rag_app_lesson6.py</strong> ã€‚</p><h2>ä¸ºä»€ä¹ˆéœ€è¦æ··åˆæ£€ç´¢ï¼Ÿ</h2><p>å¤äººäº‘ï¼šâ€œå…¼å¬åˆ™æ˜ï¼Œåä¿¡åˆ™æš—ã€‚â€æ„æ€æ˜¯ï¼Œåªæœ‰å¬å–å„æ–¹é¢çš„æ„è§ï¼Œæ‰èƒ½æ­£ç¡®è®¤è¯†äº‹ç‰©ï¼›è€Œåªç›¸ä¿¡å•ä¸€çš„è§‚ç‚¹ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ç‰‡é¢çš„é”™è¯¯ã€‚åœ¨ RAG æ£€ç´¢ä¸­ï¼Œè¿™ä¸€åŸåˆ™åŒæ ·é€‚ç”¨ã€‚é€šè¿‡åŒæ—¶ä»å¤šä¸ªä¿¡æ¯æºè·å–ä¿¡æ¯ï¼Œæˆ‘ä»¬çš„æ£€ç´¢ç»“æœå°†æ›´åŠ å…¨é¢å’Œå‡†ç¡®ã€‚</p><p>2023å¹´ï¼ŒMicrosoft Azure AI å‘å¸ƒäº†ã€ŠAzure è®¤çŸ¥æœç´¢ï¼šé€šè¿‡æ··åˆæ£€ç´¢å’Œæ’åºèƒ½åŠ›è¶…è¶Šå‘é‡æœç´¢ã€‹ä¸€æ–‡ã€‚è¿™ç¯‡æ–‡ç« å¯¹åœ¨ LLM RAG åº”ç”¨ä¸­å¼•å…¥æ··åˆæ£€ç´¢å’Œé‡æ’åºæŠ€æœ¯è¿›è¡Œäº†å…¨é¢çš„å®éªŒæ•°æ®è¯„ä¼°ï¼Œå¹¶é‡åŒ–äº†è¿™äº›æŠ€æœ¯ç»„åˆåœ¨æå‡æ–‡æ¡£å¬å›ç‡å’Œå‡†ç¡®æ€§æ–¹é¢çš„æ˜¾è‘—æ•ˆæœã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œåœ¨å¤šä¸ªæ•°æ®é›†å’Œå¤šç§æ£€ç´¢ä»»åŠ¡ä¸­ï¼Œ<strong>æ··åˆæ£€ç´¢ä¸é‡æ’åºçš„ç»„åˆå‡å–å¾—äº†æœ€ä½³è¡¨ç°</strong>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5d/95/5d35930185bfc17ccb08ae12ea5caf95.jpg?wh=1920x1387\" alt=\"å›¾ç‰‡\"></p><p>ä¸‹å›¾å±•ç¤ºäº†åœ¨ä¸åŒæ•°é‡çš„æ–‡æ¡£å—å¬å›æƒ…å†µä¸‹ï¼Œå„ç§æ£€ç´¢æ–¹å¼çš„æ•ˆæœå¯¹æ¯”ã€‚ç»“æœè¡¨æ˜ï¼Œæ··åˆæ£€ç´¢ç»“åˆé‡æ’åºçš„æ–¹æ³•æ˜¾è‘—æå‡äº†æ£€ç´¢çš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§ï¼Œè¿œè¶…å•ç‹¬ä¾èµ–å‘é‡æ£€ç´¢æˆ–å…³é”®è¯æ£€ç´¢çš„ä¼ ç»Ÿæ–¹æ³•ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3f/0e/3f84a18efd8a802fbd25e66ea3e7640e.jpg?wh=1920x1070\" alt=\"å›¾ç‰‡\"></p><h2>æ··åˆæ£€ç´¢ï¼ˆå¤šè·¯å¬å›ï¼‰</h2><p><strong>æ··åˆæ£€ç´¢</strong>ï¼Œåˆç§°<strong>èåˆæ£€ç´¢/å¤šè·¯å¬å›</strong>ï¼Œæ˜¯æŒ‡åœ¨æ£€ç´¢è¿‡ç¨‹ä¸­åŒæ—¶é‡‡ç”¨å¤šç§æ£€ç´¢æ–¹å¼ï¼Œå¹¶å°†å„ç±»æ£€ç´¢ç»“æœè¿›è¡Œèåˆï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„æ£€ç´¢ç»“æœã€‚æ··åˆæ£€ç´¢çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ä¸åŒæ£€ç´¢æ–¹å¼çš„ä¼˜ç‚¹ï¼Œå¼¥è¡¥å„è‡ªçš„ä¸è¶³ï¼Œä»è€Œæå‡æ£€ç´¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚ä¸‹å›¾å±•ç¤ºäº†æ··åˆæ£€ç´¢çš„æµç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/8d/6ef5fcc2e456d53c277dc3c728d6cd8d.jpg?wh=1920x676\" alt=\"å›¾ç‰‡\"></p><p>æ··åˆæ£€ç´¢å®é™…ä¸Šå¹¶æ²¡æœ‰ä¸¥æ ¼é™å®šå¿…é¡»åŒ…å«å“ªå‡ ç§æ£€ç´¢æ–¹å¼ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬ä»¥<strong>å‘é‡æ£€ç´¢</strong>å’Œ<strong>å…³é”®è¯æ£€ç´¢</strong>çš„ç»„åˆä¸ºä¾‹ï¼Œä½†å®é™…ä¸Šå¯ä»¥åŒ…å«å¤šç§æ£€ç´¢æ–¹å¼çš„ç»„åˆã€‚å¦‚æœæˆ‘ä»¬å°†å…¶ä»–æœç´¢ç®—æ³•ç»“åˆåœ¨ä¸€èµ·ï¼Œä¹ŸåŒæ ·å¯ä»¥ç§°ä¸ºâ€œæ··åˆæ£€ç´¢â€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†çŸ¥è¯†å›¾è°±æŠ€æœ¯ç”¨äºæ£€ç´¢å®ä½“å…³ç³»ï¼Œå¹¶ä¸å‘é‡æ£€ç´¢æŠ€æœ¯ç›¸ç»“åˆã€‚</p><p>æ›´å¤šçš„ RAG æ£€ç´¢æ–¹å¼è¿˜åŒ…æ‹¬å¤šé‡æé—®æ£€ç´¢ã€ä¸Šä¸‹æ–‡å‹ç¼©æ£€ç´¢ã€é›†æˆæ£€ç´¢ã€å¤šå‘é‡æ£€ç´¢ã€è‡ªæŸ¥è¯¢æ£€ç´¢ç­‰ï¼Œæ¯ç§æ£€ç´¢æ–¹å¼è¯´æ˜å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7e/34/7eddf214ee696b2e1f5977d72a4db134.jpg?wh=1920x884\" alt=\"å›¾ç‰‡\"></p><p>ä¸Šè¿°æ–¹æ³•å‡åŒ…å«åœ¨ LangChain çš„æ£€ç´¢å™¨æ¨¡å— langchain_community.retrievers ä¸­ï¼Œå…·ä½“è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ <a href=\"https://python.langchain.com/v0.2/api_reference/community/retrievers.html\">LangChain æ£€ç´¢å™¨ç«™ç‚¹</a>ã€‚</p><p>æ··åˆæ£€ç´¢åï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤šä¸ªæ£€ç´¢æ–¹å¼çš„æ£€ç´¢ç»“æœè¿›è¡Œç»¼åˆæ’åã€‚è¿™èŠ‚è¯¾ååŠæ®µä¼šè¯¦ç»†è®²è§£é‡æ’åºæŠ€æœ¯ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥æ’åºï¼Œç§°ä¸º<strong>é€’å½’æŠ˜å‡èåˆï¼ˆReciprocal Rank Fusion, RRFï¼‰æ’åº</strong>ã€‚RRF æ˜¯ä¸€ç§æŠŠæ¥è‡ªä¸åŒæ£€ç´¢æ–¹æ³•çš„æ’åç»“æœç»“åˆèµ·æ¥çš„æŠ€å·§ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ–‡æ¡£åœ¨ä¸åŒçš„æ£€ç´¢ç»“æœä¸­éƒ½æ’å¾—æ¯”è¾ƒé å‰ï¼Œé‚£ä¹ˆå®ƒåœ¨ç»¼åˆæ’åä¸­å°±åº”è¯¥å¾—åˆ°æ›´é«˜çš„ä½ç½®ã€‚</p><p>ç›¸æ¯”äºå¤æ‚çš„é‡æ’åºæŠ€æœ¯ï¼ŒRRF çš„æ“ä½œæ›´åŠ ç®€å•ï¼Œä¸éœ€è¦å¯¹æ¯ç§æ£€ç´¢ç»“æœè¿›è¡Œå¤æ‚çš„è°ƒæ•´æˆ–è®¡ç®—ã€‚å®ƒé€šè¿‡ç›´æ¥è€ƒè™‘æ–‡æ¡£åœ¨ä¸åŒæ–¹æ³•ä¸­çš„æ’åï¼Œå¿«é€Ÿç”Ÿæˆä¸€ä¸ªåˆç†çš„ç»¼åˆæ’åã€‚è¿™ç§æ–¹æ³•éå¸¸é€‚åˆé‚£äº›éœ€è¦å¿«é€Ÿèåˆå¤šä¸ªæ£€ç´¢ç»“æœçš„åœºæ™¯ï¼ŒçŸ­æ—¶é—´å†…å¾—åˆ°ä¸€ä¸ªæœ‰å‚è€ƒä»·å€¼çš„æ’åºã€‚</p><p>é€‰æ‹©ä½•ç§æ£€ç´¢æŠ€æœ¯ï¼Œå–å†³äºå¼€å‘è€…éœ€è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œç³»ç»Ÿçš„æ€§èƒ½è¦æ±‚ã€æ•°æ®çš„å¤æ‚æ€§ä»¥åŠç”¨æˆ·çš„æœç´¢ä¹ æƒ¯ç­‰ã€‚<strong>é’ˆå¯¹å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ£€ç´¢æŠ€æœ¯</strong>ï¼Œèƒ½å¤Ÿæœ€å¤§åŒ–åœ°æå‡RAGç³»ç»Ÿçš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p><h2>æ··åˆæ£€ç´¢æŠ€æœ¯å®æˆ˜</h2><p>åœ¨å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>rank_bm25</strong> ä½œä¸º RAG é¡¹ç›®çš„å…³é”®è¯æœç´¢æŠ€æœ¯ã€‚BM25æ˜¯ä¸€ç§å¼ºå¤§çš„å…³é”®è¯æœç´¢ç®—æ³•ï¼Œé€šè¿‡åˆ†æ<strong>è¯é¢‘ï¼ˆTFï¼‰å’Œé€†å‘æ–‡æ¡£é¢‘ç‡ï¼ˆIDFï¼‰</strong>æ¥è¯„ä¼°æ–‡æ¡£ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§ã€‚å…·ä½“æ¥è¯´ï¼ŒBM25 æ£€æŸ¥æŸ¥è¯¢è¯åœ¨æ–‡æ¡£ä¸­çš„å‡ºç°é¢‘ç‡ï¼Œä»¥åŠè¯¥è¯åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„ç¨€æœ‰ç¨‹åº¦ã€‚å¦‚æœä¸€ä¸ªè¯åœ¨ç‰¹å®šæ–‡æ¡£ä¸­é¢‘ç¹å‡ºç°ï¼Œä½†åœ¨å…¶ä»–æ–‡æ¡£ä¸­è¾ƒå°‘è§ï¼Œé‚£ä¹ˆ BM25 ä¼šå°†è¯¥æ–‡æ¡£è¯„ä¸ºé«˜åº¦ç›¸å…³ã€‚</p><p>æ­¤å¤–ï¼ŒBM25 è¿˜é€šè¿‡è°ƒæ•´æ–‡æ¡£é•¿åº¦çš„å½±å“ï¼Œé˜²æ­¢å› æ–‡æ¡£é•¿åº¦ä¸åŒè€Œå¯¼è‡´çš„è¯é¢‘åå·®ã€‚æ­£æ˜¯è¿™ç§ç»“åˆäº†è¯é¢‘å’Œæ–‡æ¡£é•¿åº¦å¹³è¡¡çš„æœºåˆ¶ï¼Œä½¿å¾— BM25 åœ¨å…³é”®è¯æœç´¢ä¸­èƒ½å¤Ÿæä¾›ç²¾å‡†çš„æ£€ç´¢ç»“æœï¼Œåœ¨ RAG é¡¹ç›®ä¸­å°¤ä¸ºæœ‰æ•ˆã€‚</p><p>æœ¬è¯¾ç¨‹ä»£ç ä¸­çš„æ³¨é‡Šå°†ä»…æ ‡æ³¨ä¸è¿™èŠ‚è¯¾éœ€è¦å­¦ä¹ å’ŒæŒæ¡çš„å†…å®¹ã€‚åŒæ—¶ï¼Œå¼€å‘ç¯å¢ƒå°†å®Œæ•´åœ°å±•ç¤ºåœ¨è¿™èŠ‚è¯¾çš„å®æˆ˜å†…å®¹ä¸­ï¼Œæ— éœ€ä¾èµ–ä¹‹å‰è¯¾ç¨‹çš„å†…å®¹æ¥è¿½æº¯é…ç½®ï¼Œå®ç°å•è¯¾æ—¶ä¸­å³å¯è¿è¡Œçš„ä¾èµ–åº“å®‰è£…å’Œä»£ç ã€‚è¿™éƒ¨åˆ†çš„ä»£ç æ–‡ä»¶ä¸º <strong>rag_app_lesson6_1.py</strong>ã€‚</p><p>ä¸‹è½½æœ¬è¯¾ç¨‹å¯¹åº”çš„ Gitee ä¸Šæ‰˜ç®¡é¡¹ç›®ï¼Œè‹¥å·²ä¸‹è½½ï¼Œåˆ™éœ€è¿›å…¥ rag_app æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ git pull å‘½ä»¤ï¼Œæ‹‰å–æœ€æ–°ä»£ç ï¼š</p><pre><code class=\"language-plain\">git clone https://gitee.com/techleadcy/rag_app.git\n</code></pre><p>åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œè‹¥å·²åˆ›å»ºåˆ™æ— éœ€é‡å¤æ‰§è¡Œï¼š</p><pre><code class=\"language-plain\">python3 -m venv rag_env\n</code></pre><p>å‘½ä»¤è¡Œä¸­æ‹‰å–ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œæ‰§è¡Œä¾èµ–åº“å®‰è£…å‘½ä»¤ï¼Œæœ¬è¯¾æ—¶å¯¹åº”çš„æ˜¯ jieba ä¸­æ–‡åˆ†è¯åº“å’Œ rank_bm25 BM25 æ£€ç´¢åº“ï¼š</p><pre><code class=\"language-plain\">source rag_env/bin/activate\npip install -U pip jieba rank_bm25 chromadb langchain langchain_community sentence-transformers dashscope unstructured pdfplumber python-docx python-pptx markdown openpyxl pandas -i https://pypi.tuna.tsinghua.edu.cn/simple \n</code></pre><p>ä»£ç ä¸­è®¾ç½®å¤§æ¨¡å‹qwen_modelï¼Œqwen_api_keyå‚æ•°ï¼Œè®¿é—®<a href=\"https://www.aliyun.com/product/bailian\">é˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡å‹æœåŠ¡å¹³å°</a>è·å¾—ã€‚</p><p>æ‰§è¡Œè¯¾ç¨‹ä»£ç ï¼š</p><pre><code class=\"language-plain\">python rag_app/rag_app_lesson6_1.py\n</code></pre><p>æœ¬è¯¾ç¨‹æ¶‰åŠçš„ä»£ç æ”¹åŠ¨å‡å·²åœ¨ <strong>rag_app_lesson6_1.py</strong> æ–‡ä»¶ä¸­æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œæ¼”ç¤ºäº†å¦‚ä½•ç»“åˆå‘é‡æ£€ç´¢ä¸ BM25 æ£€ç´¢æ¥å®ç°ä¸­æ–‡æ–‡æœ¬çš„æ£€ç´¢åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ol>\n<li>å¼•å…¥äº† rank_bm25 åº“ä¸­çš„ <strong>BM25Okapi</strong> ç±»ï¼Œç”¨äºå®ç° BM25 ç®—æ³•çš„æ£€ç´¢åŠŸèƒ½ã€‚</li>\n<li>å¼•å…¥äº† <strong>jieba</strong> åº“ï¼Œç”¨äºå¯¹ä¸­æ–‡æ–‡æœ¬è¿›è¡Œåˆ†è¯å¤„ç†ï¼Œè¿™å¯¹äº BM25 ç®—æ³•å¤„ç†ä¸­æ–‡æ–‡æœ¬èµ·å…³é”®ä½œç”¨ã€‚</li>\n<li>åœ¨ <strong>retrieval_process</strong> æ–¹æ³•ä¸­ï¼Œä» Chroma çš„ collection ä¸­æå–æ‰€æœ‰å­˜å‚¨çš„æ–‡æ¡£å†…å®¹ï¼Œå¹¶ä½¿ç”¨ jieba å¯¹è¿™äº›æ–‡æ¡£è¿›è¡Œä¸­æ–‡åˆ†è¯ï¼Œå°†åˆ†è¯ç»“æœå­˜å‚¨ä¸º <strong>tokenized_corpus</strong>ï¼Œä¸ºåç»­çš„ BM25 æ£€ç´¢åšå‡†å¤‡ã€‚</li>\n<li>åˆ©ç”¨åˆ†è¯åçš„æ–‡æ¡£é›†åˆå®ä¾‹åŒ– BM25Okapi å¯¹è±¡ï¼Œå¹¶å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ†è¯å¤„ç†ã€‚</li>\n<li>è®¡ç®—æŸ¥è¯¢è¯­å¥ä¸æ¯ä¸ªæ–‡æ¡£ä¹‹é—´çš„ BM25 ç›¸å…³æ€§å¾—åˆ† (bm25_scores)ï¼Œç„¶åé€‰æ‹©å¾—åˆ†æœ€é«˜çš„å‰ <strong>top_k</strong> ä¸ªæ–‡æ¡£ï¼Œå¹¶æå–è¿™äº›æ–‡æ¡£çš„å†…å®¹ã€‚</li>\n<li>è¿”å›åˆå¹¶åçš„å…¨éƒ¨æ£€ç´¢ç»“æœï¼ŒåŒ…å«å‘é‡æ£€ç´¢å’Œ BM25 æ£€ç´¢çš„ç»“æœã€‚</li>\n</ol><p>åœ¨æ­¤ä»£ç å®ç°ä¸­ï¼Œæ²¡æœ‰ä½¿ç”¨æ··åˆæ£€ç´¢çš„RRFï¼ˆé€’å½’æŠ˜å‡èåˆï¼‰æ’åï¼Œè¯¾ç¨‹ä¸‹åŠéƒ¨åˆ†ä¼šå¯¹æ£€ç´¢ç»“æœè¿›è¡Œè¿›ä¸€æ­¥çš„é‡æ’åºï¼Œæ‰€ä»¥è¿™èŠ‚è¯¾ç›´æ¥è¿”å›äº†å‘é‡æ£€ç´¢å’Œ BM25 æ£€ç´¢çš„ç»“æœï¼Œå¹¶æŒ‰é¡ºåºåˆå¹¶ï¼Œé›†ä¸­å±•ç¤º BM25 å…³é”®è¯æ£€ç´¢çš„ä»£ç å®æˆ˜ã€‚</p><p>å…·ä½“ä»£ç æ”¹åŠ¨å¦‚ä¸‹ï¼š</p><p>å¼•å…¥ä¾èµ–åº“ï¼š</p><pre><code class=\"language-plain\">from rank_bm25 import BM25Okapi # ä» rank_bm25 åº“ä¸­å¯¼å…¥ BM25Okapi ç±»ï¼Œç”¨äºå®ç° BM25 ç®—æ³•çš„æ£€ç´¢åŠŸèƒ½\nimport jieba # å¯¼å…¥ jieba åº“ï¼Œç”¨äºå¯¹ä¸­æ–‡æ–‡æœ¬è¿›è¡Œåˆ†è¯å¤„ç†\n</code></pre><p>retrieval_processæ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">def retrieval_process(query, collection, embedding_model=None, top_k=3):\n\n    query_embedding = embedding_model.encode(query, normalize_embeddings=True).tolist()\n    vector_results = collection.query(query_embeddings=[query_embedding], n_results=top_k)\n\n    # ä» Chroma collection ä¸­æå–æ‰€æœ‰æ–‡æ¡£\n    all_docs = collection.get()['documents']\n\n    # å¯¹æ‰€æœ‰æ–‡æ¡£è¿›è¡Œä¸­æ–‡åˆ†è¯\n    tokenized_corpus = [list(jieba.cut(doc)) for doc in all_docs]\n\n    # ä½¿ç”¨åˆ†è¯åçš„æ–‡æ¡£é›†åˆå®ä¾‹åŒ– BM25Okapiï¼Œå¯¹è¿™äº›æ–‡æ¡£è¿›è¡Œ BM25 æ£€ç´¢çš„å‡†å¤‡å·¥ä½œ\n    bm25 = BM25Okapi(tokenized_corpus)\n    # å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ†è¯å¤„ç†ï¼Œå°†åˆ†è¯ç»“æœå­˜å‚¨ä¸ºåˆ—è¡¨\n    tokenized_query = list(jieba.cut(query))\n    # è®¡ç®—æŸ¥è¯¢è¯­å¥ä¸æ¯ä¸ªæ–‡æ¡£çš„ BM25 å¾—åˆ†ï¼Œè¿”å›æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§åˆ†æ•°\n    bm25_scores = bm25.get_scores(tokenized_query)\n    # è·å– BM25 æ£€ç´¢å¾—åˆ†æœ€é«˜çš„å‰ top_k ä¸ªæ–‡æ¡£çš„ç´¢å¼•\n    bm25_top_k_indices = sorted(range(len(bm25_scores)), key=lambda i: bm25_scores[i], reverse=True)[:top_k]\n    # æ ¹æ®ç´¢å¼•æå–å¯¹åº”çš„æ–‡æ¡£å†…å®¹\n    bm25_chunks = [all_docs[i] for i in bm25_top_k_indices]\n\n    # æ‰“å° å‘é‡ æ£€ç´¢ç»“æœ\n    print(f\"æŸ¥è¯¢è¯­å¥: {query}\")\n    print(f\"å‘é‡æ£€ç´¢æœ€ç›¸ä¼¼çš„å‰ {top_k} ä¸ªæ–‡æœ¬å—:\")\n    vector_chunks = []\n    for rank, (doc_id, doc) in enumerate(zip(vector_results['ids'][0], vector_results['documents'][0])):\n        print(f\"å‘é‡æ£€ç´¢æ’å: {rank + 1}\")\n        print(f\"æ–‡æœ¬å—ID: {doc_id}\")\n        print(f\"æ–‡æœ¬å—ä¿¡æ¯:\\n{doc}\\n\")\n        vector_chunks.append(doc)\n\n    # æ‰“å° BM25 æ£€ç´¢ç»“æœ\n    print(f\"BM25 æ£€ç´¢æœ€ç›¸ä¼¼çš„å‰ {top_k} ä¸ªæ–‡æœ¬å—:\")\n    for rank, doc in enumerate(bm25_chunks):\n        print(f\"BM25 æ£€ç´¢æ’å: {rank + 1}\")\n        print(f\"æ–‡æ¡£å†…å®¹:\\n{doc}\\n\")\n\n    # åˆå¹¶ç»“æœï¼Œå°† å‘é‡ æ£€ç´¢çš„ç»“æœæ”¾åœ¨å‰é¢ï¼Œç„¶åæ˜¯ BM25 æ£€ç´¢çš„ç»“æœ\n    combined_results = vector_chunks + bm25_chunks\n\n    print(\"æ£€ç´¢è¿‡ç¨‹å®Œæˆ.\")\n    print(\"********************************************************\")\n\n    # è¿”å›åˆå¹¶åçš„å…¨éƒ¨ç»“æœï¼Œå…±2*top_kä¸ªæ–‡æ¡£å—\n    return combined_results\n</code></pre><h2>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡æ’åºæŠ€æœ¯ï¼Ÿ</h2><p>åœ¨RAGæ£€ç´¢æµç¨‹ä¸­ï¼Œé‡æ’åºæŠ€æœ¯ï¼ˆRerankingï¼‰é€šè¿‡å¯¹åˆå§‹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œæ”¹å–„æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ï¼Œä¸ºç”Ÿæˆæ¨¡å‹æä¾›æ›´ä¼˜è´¨çš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œæå‡æ•´ä½“RAGç³»ç»Ÿçš„æ•ˆæœã€‚</p><p>å°½ç®¡å‘é‡æ£€ç´¢æŠ€æœ¯èƒ½å¤Ÿä¸ºæ¯ä¸ªæ–‡æ¡£å—ç”Ÿæˆåˆæ­¥çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œä½†å¼•å…¥é‡æ’åºæ¨¡å‹ä»ç„¶è‡³å…³é‡è¦ã€‚å‘é‡æ£€ç´¢ä¸»è¦ä¾èµ–äº<strong>å…¨å±€è¯­ä¹‰ç›¸ä¼¼æ€§</strong>ï¼Œé€šè¿‡å°†æŸ¥è¯¢å’Œæ–‡æ¡£æ˜ å°„åˆ°é«˜ç»´è¯­ä¹‰ç©ºé—´ä¸­è¿›è¡ŒåŒ¹é…ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å¾€å¾€å¿½ç•¥äº†æŸ¥è¯¢ä¸æ–‡æ¡£å…·ä½“å†…å®¹ä¹‹é—´çš„ç»†ç²’åº¦äº¤äº’ã€‚</p><p>é‡æ’åºæ¨¡å‹å¤§å¤šæ˜¯<strong>åŸºäºåŒå¡”æˆ–äº¤å‰ç¼–ç æ¶æ„çš„æ¨¡å‹</strong>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥è®¡ç®—æ›´ç²¾ç¡®çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œèƒ½å¤Ÿ<strong>æ•æ‰æŸ¥è¯¢è¯ä¸æ–‡æ¡£å—ä¹‹é—´æ›´ç»†è‡´çš„ç›¸å…³æ€§</strong>ï¼Œä»è€Œåœ¨ç»†èŠ‚å±‚é¢ä¸Šæé«˜æ£€ç´¢ç²¾åº¦ã€‚å› æ­¤ï¼Œå°½ç®¡å‘é‡æ£€ç´¢æä¾›äº†æœ‰æ•ˆçš„åˆæ­¥ç­›é€‰ï¼Œé‡æ’åºæ¨¡å‹åˆ™é€šè¿‡æ›´æ·±å…¥çš„åˆ†æå’Œæ’åºï¼Œç¡®ä¿æœ€ç»ˆç»“æœåœ¨è¯­ä¹‰å’Œå†…å®¹å±‚é¢ä¸Šæ›´ç´§å¯†åœ°å¥‘åˆæŸ¥è¯¢æ„å›¾ï¼Œå®ç°äº†æ£€ç´¢è´¨é‡çš„æå‡ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨é‡æ’åºæŠ€æœ¯çš„å‡ ä¸ªä¼˜åŠ¿ï¼š</p><ol>\n<li><strong>ä¼˜åŒ–æ£€ç´¢ç»“æœ</strong></li>\n</ol><p>åœ¨ RAG ç³»ç»Ÿä¸­ï¼Œåˆå§‹çš„æ£€ç´¢ç»“æœé€šå¸¸æ¥è‡ªäºå‘é‡æœç´¢æˆ–åŸºäºå…³é”®è¯çš„æ£€ç´¢æ–¹æ³•ã€‚ç„¶è€Œï¼Œè¿™äº›åˆå§‹æ£€ç´¢ç»“æœå¯èƒ½åŒ…å«å¤§é‡çš„å†—ä½™ä¿¡æ¯æˆ–ä¸æŸ¥è¯¢ä¸å®Œå…¨ç›¸å…³çš„æ–‡æ¡£ã€‚é€šè¿‡é‡æ’åºæŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›åˆæ­¥æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œè¿›ä¸€æ­¥çš„ç­›é€‰å’Œæ’åºï¼Œå°†æœ€ç›¸å…³ã€æœ€é‡è¦çš„æ–‡æ¡£ç½®äºå‰åˆ—ã€‚</p><ol start=\"2\">\n<li><strong>å¢å¼ºä¸Šä¸‹æ–‡ç›¸å…³æ€§</strong></li>\n</ol><p>RAG ç³»ç»Ÿä¾èµ–äºæ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºç”Ÿæˆæ¨¡å‹çš„ä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œä¸Šä¸‹æ–‡çš„è´¨é‡ç›´æ¥å½±å“ç”Ÿæˆçš„ç»“æœã€‚é‡æ’åºæŠ€æœ¯é€šè¿‡é‡æ–°è¯„ä¼°æ–‡æ¡£ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§ï¼Œç¡®ä¿ç”Ÿæˆæ¨¡å‹ä¼˜å…ˆä½¿ç”¨é‚£äº›ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ï¼Œä»è€Œæé«˜äº†ç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§å’Œè¿è´¯æ€§ã€‚</p><ol start=\"3\">\n<li><strong>åº”å¯¹å¤æ‚æŸ¥è¯¢</strong></li>\n</ol><p>å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œåˆå§‹æ£€ç´¢å¯èƒ½ä¼šè¿”å›ä¸€äº›è¡¨é¢ä¸Šç›¸å…³ä½†å®é™…ä¸Šä¸å¤ªåŒ¹é…çš„æ–‡æ¡£ã€‚é‡æ’åºæŠ€æœ¯å¯ä»¥æ ¹æ®æŸ¥è¯¢çš„å¤æ‚æ€§å’Œå…·ä½“éœ€æ±‚ï¼Œå¯¹è¿™äº›ç»“æœè¿›è¡Œæ›´ç»†è‡´çš„åˆ†æå’Œæ’åºï¼Œä¼˜å…ˆå±•ç¤ºé‚£äº›èƒ½å¤Ÿæä¾›æ·±å…¥è§è§£æˆ–å…³é”®ä¿¡æ¯çš„æ–‡æ¡£ã€‚</p><h2>é‡æ’åºæ¨¡å‹ Reranking Model</h2><p>RAGæµç¨‹æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œç²—æ’å’Œç²¾æ’ã€‚ç²—æ’æ£€ç´¢æ•ˆç‡è¾ƒå¿«ï¼Œä½†æ˜¯å¬å›çš„å†…å®¹å¹¶ä¸ä¸€å®šå¼ºç›¸å…³ã€‚è€Œç²¾æ’æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤é€‚åˆåœ¨ç²—æ’çš„åŸºç¡€ä¸Šè¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ç²¾æ’çš„ä»£è¡¨å°±æ˜¯é‡æ’åºï¼ˆRerankingï¼‰ã€‚</p><p><strong>é‡æ’åºæ¨¡å‹ï¼ˆReranking Modelï¼‰</strong>æŸ¥è¯¢ä¸æ¯ä¸ªæ–‡æ¡£å—è®¡ç®—å¯¹åº”çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œå¹¶æ ¹æ®è¿™äº›åˆ†æ•°å¯¹æ–‡æ¡£è¿›è¡Œé‡æ–°æ’åºï¼Œç¡®ä¿æ–‡æ¡£æŒ‰ç…§ä»æœ€ç›¸å…³åˆ°æœ€ä¸ç›¸å…³çš„é¡ºåºæ’åˆ—ï¼Œå¹¶è¿”å›å‰top-kä¸ªç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/e0/e0b3ebbcb7f3ecd581d2ed9a0eabd9e0.jpg?wh=1920x1170\" alt=\"å›¾ç‰‡\"></p><p>ä¸åµŒå…¥æ¨¡å‹ä¸åŒï¼Œé‡æ’åºæ¨¡å‹å°†ç”¨æˆ·çš„æŸ¥è¯¢ï¼ˆQueryï¼‰å’Œæ–‡æ¡£å—ä½œä¸ºè¾“å…¥ï¼Œç›´æ¥è¾“å‡ºç›¸ä¼¼åº¦è¯„åˆ†ï¼Œè€Œéç”ŸæˆåµŒå…¥å‘é‡ã€‚ç›®å‰ï¼Œå¸‚é¢ä¸Šå¯ç”¨çš„é‡æ’åºæ¨¡å‹å¹¶ä¸å¤šï¼Œå•†ç”¨çš„æœ‰Cohereï¼Œå¼€æºçš„æœ‰BGEã€Sentenceã€Mixedbreadã€T5-Rerankerç­‰ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨æŒ‡ä»¤ï¼ˆPromptï¼‰è®©å¤§æ¨¡å‹ï¼ˆGPTã€Claudeã€é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€ç­‰ï¼‰è¿›è¡Œé‡æ’ï¼Œå¤§æ¨¡å‹æŒ‡ä»¤å‚è€ƒå¦‚ä¸‹ï¼š</p><p>ä»¥ä¸‹æ˜¯ä¸æŸ¥è¯¢ {é—®é¢˜} ç›¸å…³çš„æ–‡æ¡£å—ï¼š</p><pre><code class=\"language-plain\">[1] {æ–‡æ¡£å—1}\n[2] {æ–‡æ¡£å—2}\nï¼ˆæ›´å¤šæ–‡æ¡£å—ï¼‰\n</code></pre><p>è¯·æ ¹æ®è¿™äº›æ–‡æ¡£å—ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§è¿›è¡Œæ’åºï¼Œä»¥ â€œ1,2,3,4â€ï¼ˆæ–‡æ¡£å—æ•°å­—åŠé€—å·éš”å¼€çš„å½¢å¼ï¼‰ï¼Œè¾“å‡ºæ’åºç»“æœã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é‡æ’åºæ¨¡å‹ä¼šé¢ä¸´èµ„æºå’Œæ•ˆç‡é—®é¢˜ï¼ŒåŒ…æ‹¬<strong>è®¡ç®—èµ„æºæ¶ˆè€—é«˜</strong>ã€<strong>æ¨ç†é€Ÿåº¦æ…¢ä»¥åŠæ¨¡å‹å‚æ•°é‡å¤§</strong>ç­‰é—®é¢˜ã€‚è¿™äº›é—®é¢˜ä¸»è¦æºäºé‡æ’åºæ¨¡å‹åœ¨å¯¹å€™é€‰é¡¹è¿›è¡Œç²¾ç»†æ’åºæ—¶ï¼Œå› å…¶è¾ƒå¤§å‚æ•°é‡è€Œå¯¼è‡´çš„é«˜è®¡ç®—éœ€æ±‚å’Œå¤æ‚è€—æ—¶çš„æ¨ç†è¿‡ç¨‹ï¼Œä»è€Œå¯¹ RAG ç³»ç»Ÿçš„å“åº”æ—¶é—´å’Œæ•´ä½“æ•ˆç‡äº§ç”Ÿè´Ÿé¢å½±å“ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å®é™…èµ„æºæƒ…å†µï¼Œåœ¨ç²¾åº¦ä¸æ•ˆç‡ä¹‹é—´è¿›è¡Œå¹³è¡¡ã€‚</p><h2>é‡æ’åºæŠ€æœ¯å®æˆ˜</h2><p>åœ¨å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥è‡ªåŒ—äº¬äººå·¥æ™ºèƒ½ç ”ç©¶é™¢ BGE çš„ <strong>bge-reranker-v2-m3</strong> ä½œä¸º RAG é¡¹ç›®çš„é‡æ’åºæ¨¡å‹ï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§çš„å¼€æºå’Œå¤šè¯­è¨€çš„é‡æ’åºæ¨¡å‹ã€‚æ›´å¤šæ¨¡å‹ç›¸å…³ä¿¡æ¯å‚è€ƒï¼Œå¯è®¿é—®<a href=\"https://huggingface.co/BAAI/bge-reranker-v2-m3\"> bge-reranker-v2-m3 å®˜æ–¹ä»‹ç»ç«™ç‚¹</a>ã€‚</p><p>è¿™éƒ¨åˆ†çš„ä»£ç æ–‡ä»¶ä¸º <strong>rag_app_lesson6_2.py</strong>ã€‚ä¸‹è½½æœ¬è¯¾ç¨‹å¯¹åº”çš„ Gitee ä¸Šæ‰˜ç®¡é¡¹ç›®ï¼Œè‹¥å·²ä¸‹è½½ï¼Œåˆ™éœ€è¿›å…¥ rag_app æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ git pull å‘½ä»¤ï¼Œæ‹‰å–æœ€æ–°ä»£ç ï¼š</p><pre><code class=\"language-plain\">git clone https://gitee.com/techleadcy/rag_app.git\n</code></pre><p>åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œè‹¥å·²åˆ›å»ºåˆ™æ— éœ€é‡å¤æ‰§è¡Œï¼š</p><pre><code class=\"language-plain\">python3 -m venv rag_env\n</code></pre><p>å‘½ä»¤è¡Œä¸­æ‹‰å–ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œæ‰§è¡Œä¾èµ–åº“å®‰è£…å‘½ä»¤ï¼Œæœ¬è¯¾æ—¶å¯¹åº”çš„æ˜¯ FlagEmbedding å‘é‡æ“ä½œåº“å’Œ Peft å¤§è¯­è¨€æ¨¡å‹æ“ä½œåº“ï¼š</p><pre><code class=\"language-plain\">source rag_env/bin/activate\npip install -U pip  FlagEmbedding Peft jieba rank_bm25 chromadb langchain langchain_community sentence-transformers dashscope unstructured pdfplumber python-docx python-pptx markdown openpyxl pandas -i https://pypi.tuna.tsinghua.edu.cn/simple \n</code></pre><p>ä»£ç ä¸­è®¾ç½®å¤§æ¨¡å‹qwen_modelï¼Œqwen_api_keyå‚æ•°ï¼Œè®¿é—®<a href=\"https://www.aliyun.com/product/bailian\">é˜¿é‡Œäº‘ç™¾ç‚¼å¤§æ¨¡å‹æœåŠ¡å¹³å°</a>è·å¾—ã€‚</p><p>æ‰§è¡Œè¯¾ç¨‹ä»£ç ï¼š</p><pre><code class=\"language-plain\">python rag_app/rag_app_lesson6_2.py\n</code></pre><p>æœ¬è¯¾ç¨‹æ¶‰åŠçš„ä»£ç æ”¹åŠ¨å‡å·²åœ¨ <strong>rag_app_lesson6_2.py</strong> æ–‡ä»¶ä¸­æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ol>\n<li>å¼•å…¥ FlagEmbedding åº“ä¸­çš„ <strong>FlagReranker</strong> ç±»ï¼Œç”¨äºå¯¹åµŒå…¥ç»“æœè¿›è¡Œé‡æ–°æ’åºçš„å·¥å…·ç±»ã€‚</li>\n<li>å¢åŠ  <strong>reranking</strong> æ–¹æ³•ï¼Œå¯¹åˆå§‹æ£€ç´¢åˆ°çš„æ–‡æ¡£å—è¿›è¡Œé‡æ–°æ’åºã€‚è¯¥æ–¹æ³•åˆå§‹åŒ–äº†ä½¿ç”¨ <strong>BAAI/bge-reranker-v2-m3</strong> çš„ FlagReranker æ¨¡å‹ï¼Œå¹¶é€šè¿‡è®¡ç®—æ¯ä¸ª query ä¸ chunk çš„è¯­ä¹‰ç›¸ä¼¼æ€§å¾—åˆ†å¯¹æ–‡æ¡£å—è¿›è¡Œæ’åºã€‚æœ€åï¼Œè¿”å›æ’åå‰ top_k çš„æ–‡æ¡£å—ã€‚</li>\n<li>åœ¨ <strong>retrieval_process</strong> æ–¹æ³•ä¸­ï¼Œæ–°å¢äº†å¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ’åº reranking çš„æ­¥éª¤ï¼Œè¿”å›é‡æ’åºåçš„å‰ top_k ä¸ªæ–‡æ¡£å—ã€‚</li>\n</ol><p><strong>å…·ä½“ä»£ç æ”¹åŠ¨å¦‚ä¸‹ï¼š</strong></p><p>å¼•å…¥ä¾èµ–åº“ï¼š</p><pre><code class=\"language-plain\">from FlagEmbedding import FlagReranker # ç”¨äºå¯¹åµŒå…¥ç»“æœè¿›è¡Œé‡æ–°æ’åºçš„å·¥å…·ç±»\n</code></pre><p>å¢åŠ rerankingæ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">def reranking(query, chunks, top_k=3):\n    # åˆå§‹åŒ–é‡æ’åºæ¨¡å‹ï¼Œä½¿ç”¨BAAI/bge-reranker-v2-m3\n    reranker = FlagReranker('BAAI/bge-reranker-v2-m3', use_fp16=True)\n    # æ„é€ è¾“å…¥å¯¹ï¼Œæ¯ä¸ª query ä¸ chunk å½¢æˆä¸€å¯¹\n    input_pairs = [[query, chunk] for chunk in chunks]\n    # è®¡ç®—æ¯ä¸ª chunk ä¸ query çš„è¯­ä¹‰ç›¸ä¼¼æ€§å¾—åˆ†\n    scores = reranker.compute_score(input_pairs, normalize=True)\n    print(\"æ–‡æ¡£å—é‡æ’åºå¾—åˆ†:\", scores)\n    # å¯¹å¾—åˆ†è¿›è¡Œæ’åºå¹¶è·å–æ’åå‰ top_k çš„ chunks\n    sorted_indices = sorted(range(len(scores)), key=lambda i: scores[i], reverse=True)\n    reranking_chunks = [chunks[i] for i in sorted_indices[:top_k]]\n    # æ‰“å°å‰ä¸‰ä¸ª score å¯¹åº”çš„æ–‡æ¡£å—\n    for i in range(top_k):\n        print(f\"é‡æ’åºæ–‡æ¡£å—{i+1}: ç›¸ä¼¼åº¦å¾—åˆ†ï¼š{scores[sorted_indices[i]]}ï¼Œæ–‡æ¡£å—ä¿¡æ¯ï¼š{reranking_chunks[i]}\\n\")\n    return reranking_chunks\n\nretrieval_processæ–¹æ³•ï¼š\n    # ä½¿ç”¨é‡æ’åºæ¨¡å‹å¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œè¾“å‡ºé‡æ’åºåçš„å‰top_kæ–‡æ¡£å—\n    reranking_chunks = reranking(query,vector_chunks + bm25_chunks, top_k)\n\n    print(\"æ£€ç´¢è¿‡ç¨‹å®Œæˆ.\")\n    print(\"********************************************************\")\n\n    # è¿”å›é‡æ’åºåçš„å‰top_kä¸ªæ–‡æ¡£å—\n    return reranking_chunks\n</code></pre><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è®²è§£ RAG æ£€ç´¢æµç¨‹ï¼Œä»‹ç»äº†æ··åˆæ£€ç´¢ä¸é‡æ’åºæŠ€æœ¯ï¼Œé€šè¿‡ä»£ç å®æˆ˜å·©å›ºæ‰€å­¦çŸ¥è¯†ã€‚è¯¾ç¨‹ä»£ç å·²å…¬å¼€åœ¨Giteeä»£ç ä»“åº“ä¸­ï¼Œé“¾æ¥åœ°å€ä¸ºï¼š<a href=\"https://gitee.com/techleadcy/rag_app\">https://gitee.com/techleadcy/rag_app</a>ã€‚</p><ol>\n<li><strong>æ··åˆæ£€ç´¢æŠ€æœ¯ï¼ˆHybrid Searchï¼‰</strong></li>\n</ol><p><strong>æ··åˆæ£€ç´¢ï¼ˆå¤šè·¯å¬å›ï¼‰</strong>ï¼Œé€šè¿‡ç»“åˆå¤šç§æ£€ç´¢æ–¹å¼ï¼ˆå‘é‡æ£€ç´¢ã€å…³é”®è¯æ£€ç´¢ç­‰ï¼‰ï¼Œåˆ©ç”¨å„è‡ªçš„ä¼˜åŠ¿ï¼Œç¡®ä¿æœ€ç›¸å…³çš„ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨å€™é€‰åˆ—è¡¨ï¼Œä»¥æå‡æ£€ç´¢çš„å‡†ç¡®æ€§å’Œå…¨é¢æ€§ã€‚ç»è¿‡å®éªŒéªŒè¯ï¼Œæ··åˆæ£€ç´¢ä¸é‡æ’åºçš„ç»„åˆå–å¾—äº†æœ€ä½³è¡¨ç°ã€‚å®æˆ˜ä¸­é‡‡ç”¨ <strong>BM25</strong> ä½œä¸ºå…³é”®è¯æœç´¢æŠ€æœ¯ï¼Œç»“åˆå‘é‡æœç´¢ï¼Œè·å¾—æ··åˆæœç´¢çš„æ£€ç´¢ç»“æœã€‚</p><ol start=\"2\">\n<li><strong>é‡æ’åºæŠ€æœ¯ï¼ˆRerankingï¼‰</strong></li>\n</ol><p>é‡æ’åºæŠ€æœ¯é€šè¿‡å¯¹åˆå§‹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œè¿›ä¸€æ­¥æå‡æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ï¼Œä»è€Œä¼˜åŒ–æ•´ä½“ RAG ç³»ç»Ÿçš„æ•ˆæœã€‚ä¸åŒäºå‘é‡æ£€ç´¢ä¾èµ–å…¨å±€è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œé‡æ’åºæ¨¡å‹èƒ½å¤Ÿæ•æ‰æŸ¥è¯¢è¯ä¸æ–‡æ¡£å—ä¹‹é—´æ›´ç»†å¾®çš„ç›¸å…³æ€§ï¼Œä»è€Œæ‰¾åˆ°æœ€ç¬¦åˆæŸ¥è¯¢æ„å›¾çš„æ–‡æ¡£å—ï¼Œå®ç°æ£€ç´¢è´¨é‡çš„æå‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ <strong>bge-reranker-v2-m3</strong> ä½œä¸ºé‡æ’åºæ¨¡å‹ï¼Œå¯¹åˆå§‹æ£€ç´¢åˆ°çš„æ–‡æ¡£å—è¿›è¡Œé‡æ–°æ’åºï¼Œå¹¶è¿”å›ä¸æŸ¥è¯¢è¯­ä¹‰æœ€å¥‘åˆçš„ top_k ä¸ªæ–‡æ¡£å—ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ¬èŠ‚è¯¾ç¨‹æ¶µç›–äº†æ··åˆæ£€ç´¢æŠ€æœ¯å’Œé‡æ’åºæŠ€æœ¯ä¸¤ä¸ªå…³é”®çŸ¥è¯†ç‚¹ã€‚å¯¹åº”è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜ã€‚</p><ol>\n<li>åœ¨ä½ çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå“ªäº›æŸ¥è¯¢éœ€æ±‚æ›´é€‚åˆä½¿ç”¨æ··åˆæ£€ç´¢ï¼Ÿåœ¨å“ªäº›ç»†åˆ†åœºæ™¯ä¸­ï¼Œå…³é”®è¯æ£€ç´¢å¯èƒ½æ¯”å‘é‡æ£€ç´¢è¡¨ç°å‡ºæ›´æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Ÿ</li>\n<li>æ—¢ç„¶æåˆ°é‡æ’åºæ¨¡å‹çš„é«˜èµ„æºæ¶ˆè€—ï¼Œåˆ†äº«ä¸€ä¸‹åœ¨ä½ çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹ RAG æ£€ç´¢æ•ˆæœä¸æ•ˆç‡çš„å…·ä½“éœ€æ±‚æ˜¯ä»€ä¹ˆçº§åˆ«ï¼Ÿé’ˆå¯¹æé«˜æµç¨‹æ•ˆç‡ï¼Œä½ åœ¨ç ”å‘è¿‡ç¨‹ä¸­è€ƒè™‘äº†å“ªäº›ä¼˜åŒ–æ–¹å‘ï¼Ÿ</li>\n</ol><p>æ¬¢è¿ä½ æŠŠä½ çš„ç»éªŒå’Œæ€è€ƒåˆ†äº«åˆ°ç•™è¨€åŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":394050,"user_name":"å†°ç‚","can_delete":false,"product_type":"c1","uid":1252610,"ip_address":"å¹¿ä¸œ","ucode":"CC3AD46AB3659C","user_header":"https://static001.geekbang.org/account/avatar/00/13/1d/02/60c52ddc.jpg","comment_is_top":false,"comment_ctime":1725640081,"is_pvip":false,"replies":[{"id":143095,"content":"é¦–å…ˆï¼ŒDemoä¸­çš„æ•°æ®ä»…åšæ¼”ç¤ºï¼Œä¸èƒ½ä»¥demoçš„æ•°æ®é‡æ¥åšæ•ˆæœè¯„ä¼°ã€‚ä½¿ç”¨å°‘é‡æˆ–åå·®æ•°æ®å¯èƒ½ä¼šå¯¼è‡´è¯¯å¯¼æ€§ç»“è®ºï¼Œè¯„ä¼°æ¨¡å‹è¡¨ç°æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¶³å¤Ÿæ•°é‡ä¸”åˆ†å¸ƒç¬¦åˆå®é™…åœºæ™¯çš„æ•°æ®é›†ã€‚\n\nå…¶æ¬¡ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¼˜åŒ–é—®é¢˜ã€‚åœ¨æ··åˆæ£€ç´¢çš„åˆæ­¥é˜¶æ®µï¼Œç³»ç»Ÿå¯èƒ½å·²ç»è¾¾åˆ°äº†æŸç§å±€éƒ¨æœ€ä¼˜è§£ã€‚å¼•å…¥é‡æ’å™¨çš„ç›®çš„æ˜¯å¯¹è¿™ä¸ªå±€éƒ¨æœ€ä¼˜è§£è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ç„¶è€Œï¼Œé‡æ’å™¨æœ‰æ—¶å¯èƒ½æ— æ³•æœ‰æ•ˆçªç ´è¿™ä¸€å±€éƒ¨æœ€ä¼˜ï¼Œåè€Œä¼šåç¦»æœ€ä¼˜è§£ï¼Œè¿›å…¥â€œæ¬¡ä¼˜â€çš„è§£ç©ºé—´ï¼Œä»è€Œå¯¼è‡´ MRR å€¼ä¸‹é™ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1726060593,"ip_address":"ä¸Šæµ·","comment_id":394050,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"ç”¨bge-reranker-largeé‡æ’åå‘ç°mrrå€¼å±…ç„¶ä¸å¦‚é‡æ’å‰ç›´æ¥ä½¿ç”¨bgeå’Œbm25æ··åˆæ£€ç´¢å¾—åˆ°çš„ï¼Œä¸çŸ¥é“æ˜¯å“ªé‡Œä½¿ç”¨ä¸å½“è¿˜æ˜¯ä»€ä¹ˆåŸå› ","like_count":2,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651016,"discussion_content":"é¦–å…ˆï¼ŒDemoä¸­çš„æ•°æ®ä»…åšæ¼”ç¤ºï¼Œä¸èƒ½ä»¥demoçš„æ•°æ®é‡æ¥åšæ•ˆæœè¯„ä¼°ã€‚ä½¿ç”¨å°‘é‡æˆ–åå·®æ•°æ®å¯èƒ½ä¼šå¯¼è‡´è¯¯å¯¼æ€§ç»“è®ºï¼Œè¯„ä¼°æ¨¡å‹è¡¨ç°æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¶³å¤Ÿæ•°é‡ä¸”åˆ†å¸ƒç¬¦åˆå®é™…åœºæ™¯çš„æ•°æ®é›†ã€‚\n\nå…¶æ¬¡ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¼˜åŒ–é—®é¢˜ã€‚åœ¨æ··åˆæ£€ç´¢çš„åˆæ­¥é˜¶æ®µï¼Œç³»ç»Ÿå¯èƒ½å·²ç»è¾¾åˆ°äº†æŸç§å±€éƒ¨æœ€ä¼˜è§£ã€‚å¼•å…¥é‡æ’å™¨çš„ç›®çš„æ˜¯å¯¹è¿™ä¸ªå±€éƒ¨æœ€ä¼˜è§£è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ç„¶è€Œï¼Œé‡æ’å™¨æœ‰æ—¶å¯èƒ½æ— æ³•æœ‰æ•ˆçªç ´è¿™ä¸€å±€éƒ¨æœ€ä¼˜ï¼Œåè€Œä¼šåç¦»æœ€ä¼˜è§£ï¼Œè¿›å…¥â€œæ¬¡ä¼˜â€çš„è§£ç©ºé—´ï¼Œä»è€Œå¯¼è‡´ MRR å€¼ä¸‹é™ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726060593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1252610,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1d/02/60c52ddc.jpg","nickname":"å†°ç‚","note":"","ucode":"CC3AD46AB3659C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":651179,"discussion_content":"æ„Ÿè°¢å¸¸åšï¼Œè¿™ä¸ªè¶³å¤Ÿæ•°é‡ä¸€èˆ¬å¦‚ä½•å»è®¾ç½®ï¼Œä¸ragå¤–æŒ‚çš„çŸ¥è¯†åº“æ•°é‡æ¯”ä¸º1ï¼š100ï¼Ÿå¦å¤–ç¬¦åˆå®é™…åœºæ™¯ä¸ªäººæ„Ÿè§‰ä¹Ÿä¸æ˜¯å¾ˆå¥½å»ç•Œå®šè¾¹ç•Œã€å°±æ¯”å¦‚ä¸€ä¸ªé—®ç­”ç³»ç»Ÿï¼Œç”¨æˆ·é—®é¢˜å°±å¯èƒ½åƒå¥‡ç™¾æ€ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726412714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":651016,"ip_address":"å¹¿ä¸œ","group_id":0},"score":651179,"extra":""}]}]},{"had_liked":false,"id":394594,"user_name":"ç‹æµ·","can_delete":false,"product_type":"c1","uid":1159147,"ip_address":"è´µå·","ucode":"84347194C2061E","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/eb/8a2c26ab.jpg","comment_is_top":false,"comment_ctime":1727259842,"is_pvip":true,"replies":[{"id":143250,"content":"å¯ä»¥ã€‚RAG æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ£€ç´¢æ¨¡å¼ï¼Œå…¶ç»„ä»¶å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å’Œå®é™…å·¥ç¨‹æƒ…å†µçµæ´»é€‰æ‹©æœ€åˆé€‚çš„å®ç°æ–¹æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1727408067,"ip_address":"ä¸Šæµ·","comment_id":394594,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"æ··åˆæ£€ç´¢ä¸­çš„å…³é”®è¯æ£€ç´¢å¯ä»¥æ¢æˆ ES å®ç°å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651765,"discussion_content":"å¯ä»¥ã€‚RAG æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ£€ç´¢æ¨¡å¼ï¼Œå…¶ç»„ä»¶å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å’Œå®é™…å·¥ç¨‹æƒ…å†µçµæ´»é€‰æ‹©æœ€åˆé€‚çš„å®ç°æ–¹æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1727408067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396016,"user_name":"Grain Buds","can_delete":false,"product_type":"c1","uid":3958939,"ip_address":"åŒ—äº¬","ucode":"9133A6043B1637","user_header":"https://static001.geekbang.org/account/avatar/00/3c/68/9b/d53ebac5.jpg","comment_is_top":false,"comment_ctime":1732699365,"is_pvip":false,"replies":[{"id":143829,"content":"å†…å­˜é”™è¯¯ã€‚æŸ¥è¿è¡Œç¯å¢ƒï¼Œéœ€è¦æ›´å¤šç»†èŠ‚çš„ä¿¡æ¯ã€‚å¯ä»¥æŸ¥çœ‹æ˜¯å¦æ˜¯ç¡¬ä»¶é™åˆ¶","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1733477639,"ip_address":"ä¸Šæµ·","comment_id":396016,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"è¯·é—®ä¸ºä»€ä¹ˆè¿è¡Œapp_rag_lesson6_2.py ï¼Œåœ¨rerankingé˜¶æ®µå‘ç”ŸBus error (core dumped)","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654799,"discussion_content":"å†…å­˜é”™è¯¯ã€‚æŸ¥è¿è¡Œç¯å¢ƒï¼Œéœ€è¦æ›´å¤šç»†èŠ‚çš„ä¿¡æ¯ã€‚å¯ä»¥æŸ¥çœ‹æ˜¯å¦æ˜¯ç¡¬ä»¶é™åˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733477639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395560,"user_name":"kevin","can_delete":false,"product_type":"c1","uid":3920101,"ip_address":"å¹¿ä¸œ","ucode":"19E83C631DF25E","user_header":"https://static001.geekbang.org/account/avatar/00/3b/d0/e5/0a3ee17c.jpg","comment_is_top":false,"comment_ctime":1731236581,"is_pvip":false,"replies":[{"id":143745,"content":"è¯¾ç¨‹ä¸­å‡ºäºç®€åŒ–è¯¾ç¨‹å¤æ‚åº¦çš„ç›®æ ‡æ²¡æœ‰ä½¿ç”¨ï¼Œå®æˆ˜ä¸­æ˜¯å¯ä»¥é‡‡ç”¨çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1732267182,"ip_address":"ä¸Šæµ·","comment_id":395560,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"è€å¸ˆè¯¾ç¨‹ä¸­çš„ä»£ç ä¸ºä½•ä¸ä½¿ç”¨LangChainä¸­ï¼Œ`EnsembleRetriever`ç»„ä»¶å®ç°æ··åˆæ£€ç´¢å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654263,"discussion_content":"è¯¾ç¨‹ä¸­å‡ºäºç®€åŒ–è¯¾ç¨‹å¤æ‚åº¦çš„ç›®æ ‡æ²¡æœ‰ä½¿ç”¨ï¼Œå®æˆ˜ä¸­æ˜¯å¯ä»¥é‡‡ç”¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732267183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394816,"user_name":"xuwei","can_delete":false,"product_type":"c1","uid":1164626,"ip_address":"æ–°åŠ å¡","ucode":"07268C1743839F","user_header":"https://static001.geekbang.org/account/avatar/00/11/c5/52/63008fc7.jpg","comment_is_top":false,"comment_ctime":1728465853,"is_pvip":false,"replies":[{"id":143404,"content":"ä½ çš„ç†è§£æ˜¯å¯¹çš„ï¼Œå°†ç”¨æˆ·çš„åŸå§‹é—®é¢˜å’Œæ£€ç´¢åˆ°çš„é—®é¢˜ä¸€èµ·è¾“å…¥é‡æ’åºæ¨¡å‹ï¼Œæ ¹æ®æ¨¡å‹è¾“å‡ºçš„ç›¸å…³æ€§å¾—åˆ†ï¼Œå¯¹å€™é€‰é—®é¢˜è¿›è¡Œæ’åºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1728897472,"ip_address":"ä¸Šæµ·","comment_id":394816,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"è€å¸ˆï¼Œå’¨è¯¢ä¸‹ï¼Œæˆ‘å®é™…é¡¹ç›®ä¸­ï¼Œç”¨çš„æ˜¯é—®ç­”å¯¹ã€‚å°†é—®é¢˜embeddingå­˜å…¥å‘é‡åº“ï¼Œå¬å›ä½¿ç”¨çš„æ··åˆå¬å›ã€‚å¦‚æœç”¨bge-reranker-largeï¼Œæ˜¯å°†ç”¨æˆ·çš„åŸå§‹é—®é¢˜å’Œæ£€ç´¢å‡ºæ¥çš„é—®é¢˜æ”¾åˆ°æ¨¡å‹é‡Œåšé‡æ’å—ï¼Ÿç„¶åæ ¹æ®é‡æ’ç»“æœï¼Œæ‰¾åˆ°å¯¹åº”çš„ç­”æ¡ˆå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":652421,"discussion_content":"ä½ çš„ç†è§£æ˜¯å¯¹çš„ï¼Œå°†ç”¨æˆ·çš„åŸå§‹é—®é¢˜å’Œæ£€ç´¢åˆ°çš„é—®é¢˜ä¸€èµ·è¾“å…¥é‡æ’åºæ¨¡å‹ï¼Œæ ¹æ®æ¨¡å‹è¾“å‡ºçš„ç›¸å…³æ€§å¾—åˆ†ï¼Œå¯¹å€™é€‰é—®é¢˜è¿›è¡Œæ’åºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1728897472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394444,"user_name":"Geek_8af4ba","can_delete":false,"product_type":"c1","uid":3788548,"ip_address":"å¹¿ä¸œ","ucode":"F28AEB38539649","user_header":"","comment_is_top":false,"comment_ctime":1726817209,"is_pvip":false,"replies":[{"id":143202,"content":"æ˜¯çš„ï¼Œè¿™å¼ å›¾æœ‰è¯¯ã€‚æ„Ÿè°¢æé†’ï¼Œæˆ‘å»ä¿®æ­£äº†ğŸ™","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1726970707,"ip_address":"ä¸Šæµ·","comment_id":394444,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"ç¬¬ä¸€å¼ å›¾ï¼Œå‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢æ˜¯ä¸æ˜¯ç”»åäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651502,"discussion_content":"æ˜¯çš„ï¼Œè¿™å¼ å›¾æœ‰è¯¯ã€‚æ„Ÿè°¢æé†’ï¼Œæˆ‘å»ä¿®æ­£äº†ğŸ™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726970707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395215,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1729759583,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":2,"product_id":100804101,"comment_content":"ç¬¬6è®²æ‰“å¡~\nåœ¨LangChainä¸­ï¼Œå¯ä»¥ä½¿ç”¨`EnsembleRetriever`ç»„ä»¶å®ç°æ··åˆæ£€ç´¢ï¼Œæ”¯æŒæŒ‡å®šæ£€ç´¢å™¨åˆ—è¡¨ï¼Œå¹¶ä¸ºæ¯ä¸ªæ£€ç´¢å™¨è®¾ç½®æƒé‡ã€‚","like_count":1},{"had_liked":false,"id":396245,"user_name":"king","can_delete":false,"product_type":"c1","uid":2273754,"ip_address":"æµ™æ±Ÿ","ucode":"1E5BD0E2A789C3","user_header":"https://static001.geekbang.org/account/avatar/00/22/b1/da/5602cb4b.jpg","comment_is_top":false,"comment_ctime":1733737982,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"è€å¸ˆè¯·é—®ä¸‹åŠ è½½é‡æ’åºæ¨¡å‹æ— æ³•åŠ è½½ï¼Œæ˜¯å•¥åŸå› ï¼šhuggingface_hub.errors.LocalEntryNotFoundError: An error happened while trying to locate the file on the Hub and we cannot find the requested files in the local cache. Please check your connection and try again or make sure your Internet connection is on.\n","like_count":0}]}