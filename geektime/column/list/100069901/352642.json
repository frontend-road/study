{"id":352642,"title":"24 | è¿ç»´ï¼šå¦‚ä½•æ„å»ºé«˜å¯é çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å”èªã€‚</p><p>åœ¨ä½¿ç”¨etcdè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé¢ä¸´ç€ä¸€ç³»åˆ—é—®é¢˜ä¸é€‰æ‹©ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>etcdæ˜¯ä½¿ç”¨è™šæ‹Ÿæœºè¿˜æ˜¯å®¹å™¨éƒ¨ç½²ï¼Œå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</li>\n<li>å¦‚ä½•åŠæ—¶å‘ç°etcdé›†ç¾¤éšæ‚£é¡¹ï¼ˆæ¯”å¦‚æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼Ÿ</li>\n<li>å¦‚ä½•åŠæ—¶ç›‘æ§åŠå‘Šè­¦etcdçš„æ½œåœ¨éšæ‚£ï¼ˆæ¯”å¦‚dbå¤§å°å³å°†è¾¾åˆ°é…é¢ï¼‰ï¼Ÿ</li>\n<li>å¦‚ä½•ä¼˜é›…çš„å®šæ—¶ã€ç”šè‡³è·¨åŸå¤‡ä»½etcdæ•°æ®ï¼Ÿ</li>\n<li>å¦‚ä½•æ¨¡æ‹Ÿç£ç›˜IOç­‰å¼‚å¸¸æ¥å¤ç°Bugã€æ•…éšœï¼Ÿ</li>\n</ul><p>ä»Šå¤©ï¼Œæˆ‘å°±å’Œä½ èŠèŠå¦‚ä½•è§£å†³ä»¥ä¸Šé—®é¢˜ã€‚æˆ‘å°†é€šè¿‡ä»etcdé›†ç¾¤éƒ¨ç½²ã€é›†ç¾¤ç»„å»ºã€ç›‘æ§ä½“ç³»ã€å·¡æ£€ã€å¤‡ä»½åŠè¿˜åŸã€é«˜å¯ç”¨ã€æ··æ²Œå·¥ç¨‹ç­‰ç»´åº¦ï¼Œå¸¦ä½ äº†è§£å¦‚ä½•æ„å»ºä¸€ä¸ªé«˜å¯é çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»ã€‚</p><p>å¸Œæœ›é€šè¿‡è¿™èŠ‚è¯¾ï¼Œè®©ä½ å¯¹etcdé›†ç¾¤è¿ç»´è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°çš„ä¸€ç³»åˆ—é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆæœ‰ä¸€å®šçš„äº†è§£ï¼Œå¸®åŠ©ä½ æ„å»ºé«˜å¯é çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»ï¼ŒåŠ©åŠ›ä¸šåŠ¡æ›´å¿«ã€æ›´ç¨³åœ°è¿è¡Œã€‚</p><h2>æ•´ä½“è§£å†³æ–¹æ¡ˆ</h2><p>é‚£è¦å¦‚ä½•æ„å»ºé«˜å¯é çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»å‘¢?</p><p>æˆ‘é€šè¿‡ä¸‹é¢è¿™ä¸ªæ€ç»´è„‘å›¾ç»™ä½ æ€»ç»“äº†etcdè¿ç»´ä½“ç³»å»ºè®¾æ ¸å¿ƒè¦ç‚¹ï¼Œå®ƒç”±etcdé›†ç¾¤éƒ¨ç½²ã€æˆå‘˜ç®¡ç†ã€ç›‘æ§åŠå‘Šè­¦ä½“ç³»ã€å¤‡ä»½åŠè¿˜åŸã€å·¡æ£€ã€é«˜å¯ç”¨åŠè‡ªæ„ˆã€æ··æ²Œå·¥ç¨‹ç­‰ç»´åº¦ç»„æˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/80/c2/803b20362b21d13396ee099f413968c2.png?wh=1920*1409\" alt=\"\"></p><h2>é›†ç¾¤éƒ¨ç½²</h2><p>è¦æƒ³ä½¿ç”¨etcdé›†ç¾¤ï¼Œæˆ‘ä»¬é¢å¯¹çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆå»éƒ¨ç½²etcdé›†ç¾¤ã€‚</p><p>é¦–å…ˆæ˜¯è®¡ç®—èµ„æºçš„é€‰æ‹©ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯è®¡ç®—èµ„æºçš„äº¤ä»˜æ¼”è¿›å²ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><!-- [[[read_end]]] --><ul>\n<li>ç‰©ç†æœºï¼›</li>\n<li>è™šæ‹Ÿæœºï¼›</li>\n<li>è£¸å®¹å™¨ï¼ˆå¦‚Dockerå®ä¾‹ï¼‰ï¼›</li>\n<li>Kuberneteså®¹å™¨ç¼–æ’ã€‚</li>\n</ul><p>ç‰©ç†æœºèµ„æºäº¤ä»˜æ…¢ã€æˆæœ¬é«˜ã€æ‰©ç¼©å®¹æµç¨‹è´¹æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¤§éƒ¨åˆ†ä¸šåŠ¡å›¢é˜Ÿä¸å†è€ƒè™‘ç‰©ç†æœºï¼Œé™¤éæ˜¯è¶…å¤§è§„æ¨¡çš„ä¸Šä¸‡ä¸ªèŠ‚ç‚¹çš„Kubernetesé›†ç¾¤ï¼Œå¯¹CPUã€å†…å­˜ã€ç½‘ç»œèµ„æºæœ‰ç€æé«˜è¯‰æ±‚ã€‚</p><p>è™šæ‹Ÿæœºæ˜¯ç›®å‰å„ä¸ªäº‘å‚å•†å”®å–çš„ä¸»æµå®ä¾‹ï¼Œæ— è®ºæ˜¯åŸºäºKVMè¿˜æ˜¯Xenå®ç°ï¼Œéƒ½å…·æœ‰è‰¯å¥½çš„ç¨³å®šæ€§ã€éš”ç¦»æ€§ï¼Œæ”¯æŒæ•…éšœçƒ­è¿ç§»ï¼Œå¯å¼¹æ€§ä¼¸ç¼©ï¼Œè¢«etcdã€æ•°æ®åº“ç­‰å­˜å‚¨ä¸šåŠ¡å¤§é‡ä½¿ç”¨ã€‚</p><p>åœ¨åŸºäºç‰©ç†æœºå’Œè™šæ‹Ÿæœºçš„éƒ¨ç½²æ–¹æ¡ˆä¸­ï¼Œæˆ‘æ¨èä½ ä½¿ç”¨ansibleã€puppetç­‰è‡ªåŠ¨è¿ç»´å·¥å…·ï¼Œæ„å»ºæ ‡å‡†ã€è‡ªåŠ¨åŒ–çš„etcdé›†ç¾¤æ­å»ºã€æ‰©ç¼©å®¹æµç¨‹ã€‚åŸºäºansibleéƒ¨ç½²etcdé›†ç¾¤å¯ä»¥æ‹†åˆ†æˆä»¥ä¸‹è‹¥å¹²ä¸ªä»»åŠ¡:</p><ul>\n<li>ä¸‹è½½åŠå®‰è£…etcdäºŒè¿›åˆ¶åˆ°æŒ‡å®šç›®å½•ï¼›</li>\n<li>å°†etcdåŠ å…¥systemdç­‰æœåŠ¡ç®¡ç†ï¼›</li>\n<li>ä¸ºetcdå¢åŠ é…ç½®æ–‡ä»¶ï¼Œåˆç†è®¾ç½®ç›¸å…³å‚æ•°ï¼›</li>\n<li>ä¸ºetcdé›†ç¾¤å„ä¸ªèŠ‚ç‚¹ç”Ÿæˆç›¸å…³è¯ä¹¦ï¼Œæ„å»ºä¸€ä¸ªå®‰å…¨çš„é›†ç¾¤ï¼›</li>\n<li>ç»„å»ºé›†ç¾¤ç‰ˆï¼ˆé™æ€é…ç½®ã€åŠ¨æ€é…ç½®ï¼Œå‘ç°é›†ç¾¤å…¶ä»–èŠ‚ç‚¹ï¼‰ï¼›</li>\n<li>å¼€å¯etcdæœåŠ¡ï¼Œå¯åŠ¨etcdé›†ç¾¤ã€‚</li>\n</ul><p>è¯¦ç»†ä½ å¯ä»¥å‚è€ƒdigitalocean<a href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-and-secure-an-etcd-cluster-with-ansible-on-ubuntu-18-04\">è¿™ç¯‡åšå®¢æ–‡ç« </a>ï¼Œå®ƒä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ansibleå»éƒ¨ç½²ä¸€ä¸ªå®‰å…¨çš„etcdé›†ç¾¤ï¼Œå¹¶ç»™å‡ºäº†å¯¹åº”çš„yamlä»»åŠ¡æ–‡ä»¶ã€‚</p><p>å®¹å™¨åŒ–éƒ¨ç½²åˆ™å…·æœ‰æé€Ÿçš„äº¤ä»˜æ•ˆç‡ã€æ›´çµæ´»çš„èµ„æºæ§åˆ¶ã€æ›´ä½çš„è™šæ‹ŸåŒ–å¼€é”€ç­‰ä¸€ç³»åˆ—ä¼˜ç‚¹ã€‚è‡ªä»Dockerè¯ç”Ÿåï¼Œå®¹å™¨åŒ–éƒ¨ç½²å°±é£é¡å…¨çƒã€‚æœ‰çš„ä¸šåŠ¡ç›´æ¥ä½¿ç”¨è£¸Dockerå®¹å™¨æ¥è·‘etcdé›†ç¾¤ã€‚ç„¶è€Œè£¸Dockerå®¹å™¨ä¸å…·å¤‡è°ƒåº¦ã€æ•…éšœè‡ªæ„ˆã€å¼¹æ€§æ‰©å®¹ç­‰ç‰¹æ€§ï¼Œå­˜åœ¨è¾ƒå¤§å±€é™æ€§ã€‚</p><p>éšåä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œè¯ç”Ÿäº†ä»¥Kubernetesã€Swarmä¸ºé¦–çš„å®¹å™¨ç¼–æ’å¹³å°ï¼ŒKubernetesæˆä¸ºäº†å®¹å™¨ç¼–æ’ä¹‹æˆ˜ä¸­çš„ç‹è€…ï¼Œå¤§é‡ä¸šåŠ¡ä½¿ç”¨Kubernetesæ¥éƒ¨ç½²etcdã€ZooKeeperç­‰æœ‰çŠ¶æ€æœåŠ¡ã€‚åœ¨å¼€æºç¤¾åŒºä¸­ï¼Œä¹Ÿè¯ç”Ÿäº†è‹¥å¹²ä¸ªetcdçš„Kuberneteså®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul>\n<li>etcd-operatorï¼›</li>\n<li>bitnami etcd/statefulsetï¼›</li>\n<li>etcd-cluster-operatorï¼›</li>\n<li>openshit/cluster-etcd-operatorï¼›</li>\n<li>kubeadmã€‚</li>\n</ul><p><a href=\"https://github.com/coreos/etcd-operator\">etcd-operator</a>ç›®å‰å·²å¤„äºArchivedçŠ¶æ€ï¼Œæ— äººç»´æŠ¤ï¼ŒåŸºæœ¬åºŸå¼ƒã€‚åŒæ—¶å®ƒæ˜¯åŸºäºè£¸Podå®ç°çš„ï¼Œè¦åšå¥½å„ç§å¤‡ä»½ã€‚åœ¨éƒ¨åˆ†å¼‚å¸¸æƒ…å†µä¸‹å­˜åœ¨é›†ç¾¤å®•æœºã€æ•°æ®ä¸¢å¤±é£é™©ï¼Œæˆ‘ä»…å»ºè®®ä½ ä½¿ç”¨å®ƒçš„æ•°æ®å¤‡ä»½etcd-backup-operatorã€‚</p><p><a href=\"https://bitnami.com/stack/etcd/helm\">bitnami etcd</a>æä¾›äº†ä¸€ä¸ªhelmåŒ…ä¸€é”®éƒ¨ç½²etcdé›†ç¾¤ï¼Œæ”¯æŒå„ä¸ªäº‘å‚å•†ï¼Œæ”¯æŒä½¿ç”¨PVã€PVCæŒä¹…åŒ–å­˜å‚¨æ•°æ®ï¼Œåº•å±‚åŸºäºStatefulSetå®ç°ï¼Œè¾ƒç¨³å®šã€‚ç›®å‰ä¸å°‘å¼€æºé¡¹ç›®ä½¿ç”¨çš„æ˜¯å®ƒã€‚</p><p>ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹helmå‘½ä»¤ï¼Œå¿«é€Ÿåœ¨Kuberneteé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªetcdé›†ç¾¤ã€‚</p><pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm install my-release bitnami/etcd\n</code></pre><p><a href=\"https://github.com/improbable-eng/etcd-cluster-operator\">etcd-cluster-operator</a>å’Œopenshit/<a href=\"https://github.com/openshift/cluster-etcd-operator\">cluster-etcd-operator</a>æ¯”è¾ƒå°ä¼—ï¼Œç›®å‰starä¸å¤šï¼Œä½†æ˜¯æœ‰ç›¸åº”çš„å¼€å‘è€…ç»´æŠ¤ï¼Œä½ å¯å‚è€ƒä¸‹å®ƒä»¬çš„å®ç°æ€è·¯ï¼Œä¸etcd-operatoråŸºäºPodã€bitnami etcdåŸºäºStatefulsetå®ç°ä¸ä¸€æ ·çš„æ˜¯ï¼Œå®ƒä»¬æ˜¯åŸºäºReplicaSetå’ŒStatic Podå®ç°çš„ã€‚</p><p>æœ€åè¦å’Œä½ ä»‹ç»çš„æ˜¯<a href=\"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/setup-ha-etcd-with-kubeadm/\">kubeadm</a>ï¼Œå®ƒæ˜¯Kubernetesé›†ç¾¤ä¸­çš„etcdé«˜å¯ç”¨éƒ¨ç½²æ–¹æ¡ˆçš„æä¾›è€…ï¼Œkubeadmæ˜¯åŸºäºStatic Podéƒ¨ç½²etcdé›†ç¾¤çš„ã€‚Static Podç›¸æ¯”æ™®é€šPodæœ‰å…¶ç‰¹æ®Šæ€§ï¼Œå®ƒæ˜¯ç›´æ¥ç”±èŠ‚ç‚¹ä¸Šçš„kubeletè¿›ç¨‹æ¥ç®¡ç†ï¼Œæ— éœ€é€šè¿‡kube-apiserverã€‚</p><p>åˆ›å»ºStatic Podæ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯é…ç½®æ–‡ä»¶å’ŒHTTPã€‚kubeadmä½¿ç”¨çš„æ˜¯é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯åœ¨kubeletç›‘å¬çš„é™æ€Podç›®å½•ä¸‹ï¼ˆä¸€èˆ¬æ˜¯/etc/kubernetes/manifestsï¼‰æ”¾ç½®ç›¸åº”çš„etcd Pod YAMLæ–‡ä»¶å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/05/d7c28814d3f83ff4ef474df72b10b305.png?wh=1920*1007\" alt=\"\"></p><p>æ³¨æ„åœ¨è¿™ç§éƒ¨ç½²æ–¹å¼ä¸­ï¼Œéƒ¨ç½²etcdçš„èŠ‚ç‚¹éœ€è¦éƒ¨ç½²dockerã€kubeletã€kubeadmç»„ä»¶ï¼Œä¾èµ–è¾ƒé‡ã€‚</p><h2>é›†ç¾¤ç»„å»º</h2><p>å’Œä½ èŠå®Œetcdé›†ç¾¤éƒ¨ç½²çš„å‡ ç§æ¨¡å¼å’ŒåŸºæœ¬åŸç†åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­æœ€æ£˜æ‰‹çš„éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯é›†ç¾¤ç»„å»ºã€‚å› ä¸ºé›†ç¾¤ç»„å»ºæ¶‰åŠåˆ°etcdæˆå‘˜ç®¡ç†çš„åŸç†å’ŒèŠ‚ç‚¹å‘ç°æœºåˆ¶ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/349619\">ç‰¹åˆ«æ”¾é€</a>é‡Œï¼Œè¶…å‡¡å·²é€šè¿‡ä¸€ä¸ªè¯¡å¼‚çš„æ•…éšœæ¡ˆä¾‹ç»™ä½ ä»‹ç»äº†æˆå‘˜ç®¡ç†çš„åŸç†ï¼Œå¹¶æ·±å…¥åˆ†æäº†etcdé›†ç¾¤æ·»åŠ èŠ‚ç‚¹ã€æ–°å»ºé›†ç¾¤ã€ä»å¤‡ä»½æ¢å¤ç­‰åœºæ™¯çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ã€‚etcdç›®å‰é€šè¿‡ä¸€æ¬¡åªå…è®¸æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹çš„æ–¹å¼ï¼Œå¯å®‰å…¨çš„å®ç°åœ¨çº¿æˆå‘˜å˜æ›´ã€‚</p><p>ä½ è¦ç‰¹åˆ«æ³¨æ„ï¼Œå½“å˜æ›´é›†ç¾¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹çš„initial-cluster-stateå‚æ•°çš„å–å€¼å¯ä»¥æ˜¯newæˆ–existingã€‚</p><ul>\n<li>newï¼Œä¸€èˆ¬ç”¨äºåˆå§‹åŒ–å¯åŠ¨ä¸€ä¸ªæ–°é›†ç¾¤çš„åœºæ™¯ã€‚å½“è®¾ç½®æˆnewæ—¶ï¼Œå®ƒä¼šæ ¹æ®initial-cluster-tokenã€initial-clusterç­‰å‚æ•°ä¿¡æ¯è®¡ç®—é›†ç¾¤IDã€æˆå‘˜IDä¿¡æ¯ã€‚</li>\n<li>existingï¼Œè¡¨ç¤ºetcdèŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„é›†ç¾¤ï¼Œå®ƒä¼šæ ¹æ®peerURLsä¿¡æ¯ä»PeerèŠ‚ç‚¹è·å–å·²å­˜åœ¨çš„é›†ç¾¤IDä¿¡æ¯ï¼Œæ›´æ–°è‡ªå·±æœ¬åœ°é…ç½®ã€å¹¶å°†æœ¬èº«èŠ‚ç‚¹ä¿¡æ¯å‘å¸ƒåˆ°é›†ç¾¤ä¸­ã€‚</li>\n</ul><p>é‚£ä¹ˆå½“ä½ è¦ç»„å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„etcdé›†ç¾¤çš„æ—¶å€™ï¼Œæœ‰å“ªäº›æ–¹æ³•å‘¢?</p><p>åœ¨etcdä¸­ï¼Œæ— è®ºæ˜¯Leaderé€‰ä¸¾è¿˜æ˜¯æ—¥å¿—åŒæ­¥ï¼Œéƒ½æ¶‰åŠåˆ°ä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚å› æ­¤ç»„å»ºé›†ç¾¤çš„ç¬¬ä¸€æ­¥å¾—çŸ¥é“é›†ç¾¤æ€»æˆå‘˜æ•°ã€å„ä¸ªæˆå‘˜èŠ‚ç‚¹çš„IPåœ°å€ç­‰ä¿¡æ¯ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å‘ç°ï¼ˆDiscoveryï¼‰ã€‚ç›®å‰etcdä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è·å–ä»¥ä¸Šä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯<strong>static configuration</strong>å’Œ<strong>dynamic service discovery</strong>ã€‚</p><p><strong>static configuration</strong>æ˜¯æŒ‡é›†ç¾¤æ€»æˆå‘˜èŠ‚ç‚¹æ•°ã€æˆå‘˜èŠ‚ç‚¹çš„IPåœ°å€éƒ½æ˜¯å·²çŸ¥ã€å›ºå®šçš„ï¼Œæ ¹æ®æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„initial-cluster-stateåŸç†ï¼Œæœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•å¯åŸºäºé™æ€é…ç½®ç»„å»ºä¸€ä¸ªé›†ç¾¤ã€‚</p><ul>\n<li>æ–¹æ³•1ï¼Œä¸‰ä¸ªèŠ‚ç‚¹çš„initial-cluster-stateéƒ½é…ç½®ä¸ºnewï¼Œé™æ€å¯åŠ¨ï¼Œinitial-clusterå‚æ•°åŒ…å«ä¸‰ä¸ªèŠ‚ç‚¹ä¿¡æ¯å³å¯ï¼Œè¯¦æƒ…ä½ å¯å‚è€ƒ<a href=\"https://etcd.io/docs/v3.4.0/op-guide/clustering/\">ç¤¾åŒºæ–‡æ¡£</a>ã€‚</li>\n<li>æ–¹æ³•2ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹initial-cluster-stateè®¾ç½®ä¸ºnewï¼Œç‹¬ç«‹æˆé›†ç¾¤ï¼Œéšåç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä¸ºexistingï¼Œé€šè¿‡æ‰©å®¹çš„æ–¹å¼ï¼Œä¸æ–­åŠ å…¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ‰€ç»„æˆçš„é›†ç¾¤ä¸­ã€‚</li>\n</ul><p>å¦‚æœæˆå‘˜èŠ‚ç‚¹ä¿¡æ¯æ˜¯æœªçŸ¥çš„ï¼Œä½ å¯ä»¥é€šè¿‡<strong>dynamic service discovery</strong>æœºåˆ¶è§£å†³ã€‚</p><p>etcdç¤¾åŒºè¿˜æä¾›äº†é€šè¿‡å…¬å…±æœåŠ¡æ¥å‘ç°æˆå‘˜èŠ‚ç‚¹ä¿¡æ¯ï¼Œç»„å»ºé›†ç¾¤çš„æ–¹æ¡ˆã€‚å®ƒçš„æ ¸å¿ƒæ˜¯é›†ç¾¤å†…çš„å„ä¸ªæˆå‘˜èŠ‚ç‚¹å‘å…¬å…±æœåŠ¡æ³¨å†Œæˆå‘˜åœ°å€ç­‰ä¿¡æ¯ï¼Œå„ä¸ªèŠ‚ç‚¹é€šè¿‡å…¬å…±æœåŠ¡æ¥å‘ç°å½¼æ­¤ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://etcd.io/docs/v3.4.0/dev-internal/discovery_protocol/\">å®˜æ–¹è¯¦ç»†æ–‡æ¡£ã€‚</a></p><h2>ç›‘æ§åŠå‘Šè­¦ä½“ç³»</h2><p>å½“æˆ‘ä»¬æŠŠé›†ç¾¤éƒ¨ç½²èµ·æ¥åï¼Œåœ¨ä¸šåŠ¡å¼€å§‹ä½¿ç”¨ä¹‹å‰ï¼Œéƒ¨ç½²ç›‘æ§æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå®ƒæ˜¯æˆ‘ä»¬ä¿éšœä¸šåŠ¡ç¨³å®šæ€§ï¼Œæå‰å‘ç°é£é™©ã€éšæ‚£ç‚¹çš„é‡è¦æ ¸å¿ƒæ‰‹æ®µã€‚é‚£ä¹ˆè¦å¦‚ä½•å¿«é€Ÿç›‘æ§ä½ çš„etcdé›†ç¾¤å‘¢ï¼Ÿ</p><p>æ­£å¦‚æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/343645\">14</a>å’Œ<a href=\"https://time.geekbang.org/column/article/344621\">15</a>é‡Œå’Œä½ ä»‹ç»å»¶æ—¶ã€å†…å­˜æ—¶æ‰€æåŠçš„ï¼Œetcdæä¾›äº†ä¸°å¯Œçš„metricsæ¥å±•ç¤ºæ•´ä¸ªé›†ç¾¤çš„æ ¸å¿ƒæŒ‡æ ‡ã€å¥åº·åº¦ã€‚metricsæŒ‰æ¨¡å—å¯åˆ’åˆ†ä¸ºç£ç›˜ã€ç½‘ç»œã€MVCCäº‹åŠ¡ã€gRPC RPCã€etcdserverã€‚</p><p>ç£ç›˜ç›¸å…³çš„metricsåŠå«ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/a5/7b3df60d26f5363e36100525a44472a5.png?wh=1920*616\" alt=\"\"></p><p>ç½‘ç»œç›¸å…³çš„metricsåŠå«ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/da/32/da489a9796a016dc2yy99e101d9ab832.png?wh=1920*529\" alt=\"\"></p><p>mvccç›¸å…³çš„è¾ƒå¤šï¼Œæˆ‘åœ¨ä¸‹å›¾ä¸­åˆ—ä¸¾äº†éƒ¨åˆ†å…¶å«ä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d1/51/d17446f657b110afd874yyea87176051.png?wh=1920*564\" alt=\"\"></p><p>etcdserverç›¸å…³çš„å¦‚ä¸‹ï¼Œé›†ç¾¤æ˜¯å¦æœ‰leaderã€å †ç§¯çš„proposalæ•°ç­‰éƒ½åœ¨æ­¤æ¨¡å—ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cb/6e/cbb95c525a6748bfaee48e95ca622f6e.png?wh=1920*759\" alt=\"\"></p><p>æ›´å¤šmetricsï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹ã€‚</p><pre><code>curl 127.0.0.1:2379/metrics\n</code></pre><p>äº†è§£å¸¸è§çš„metricsåï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®PrometheusæœåŠ¡ï¼Œé‡‡é›†etcdé›†ç¾¤çš„2379ç«¯å£çš„metricsè·¯å¾„ã€‚</p><p>é‡‡é›†çš„æ–¹æ¡ˆä¸€èˆ¬æœ‰ä¸¤ç§ï¼Œ<a href=\"https://etcd.io/docs/v3.4.0/op-guide/monitoring/\">é™æ€é…ç½®</a>å’ŒåŠ¨æ€é…ç½®ã€‚</p><p>é™æ€é…ç½®æ˜¯æŒ‡æ·»åŠ å¾…ç›‘æ§çš„etcd targetåˆ°Prometheusé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>global:\n  scrape_interval: 10s\nscrape_configs:\n  - job_name: test-etcd\n    static_configs:\n    - targets:\n ['10.240.0.32:2379','10.240.0.33:2379','10.240.0.34:2379']\n</code></pre><p>é™æ€é…ç½®çš„ç¼ºç‚¹æ˜¯æ¯æ¬¡æ–°å¢é›†ç¾¤ã€æˆå‘˜å˜æ›´éƒ½éœ€è¦äººå·¥ä¿®æ”¹é…ç½®ï¼Œè€ŒåŠ¨æ€é…ç½®å°±å¯è§£å†³è¿™ä¸ªç—›ç‚¹ã€‚</p><p>åŠ¨æ€é…ç½®æ˜¯é€šè¿‡Prometheus-Operatorçš„æä¾›ServiceMonitoræœºåˆ¶å®ç°çš„ï¼Œå½“ä½ æƒ³é‡‡é›†ä¸€ä¸ªetcdå®ä¾‹æ—¶ï¼Œè‹¥etcdæœåŠ¡éƒ¨ç½²åœ¨åŒä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œä½ åªéœ€è¦é€šè¿‡Kubernetesçš„APIåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ServiceMonitorèµ„æºå³å¯ã€‚è‹¥etcdé›†ç¾¤ä¸Promehteus-Operatorä¸åœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œä½ éœ€è¦å»åˆ›å»ºã€æ›´æ–°å¯¹åº”çš„é›†ç¾¤Endpointã€‚</p><p>é‚£Prometheusæ˜¯å¦‚ä½•çŸ¥é“è¯¥é‡‡é›†å“ªäº›æœåŠ¡çš„metricsä¿¡æ¯å‘¢?</p><p>ç­”æ¡ˆServiceMonitorèµ„æºé€šè¿‡Namespaceã€Labelsæè¿°äº†å¾…é‡‡é›†å®ä¾‹å¯¹åº”çš„Service Endpointã€‚</p><pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: prometheus-prometheus-oper-kube-etcd\n  namespace: monitoring\nspec:\n  endpoints:\n  - bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token\n    port: http-metrics\n    scheme: https\n    tlsConfig:\n      caFile: /etc/prometheus/secrets/etcd-certs/ca.crt\n      certFile: /etc/prometheus/secrets/etcd-certs/client.crt\n      insecureSkipVerify: true\n      keyFile: /etc/prometheus/secrets/etcd-certs/client.key\n  jobLabel: jobLabel\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      app: prometheus-operator-kube-etcd\n      release: prometheus\n</code></pre><p>é‡‡é›†äº†metricsç›‘æ§æ•°æ®åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦åŸºäºmetricsç›‘æ§æ•°æ®å‘Šè­¦äº†ã€‚ä½ å¯ä»¥é€šè¿‡Prometheuså’Œ<a href=\"https://github.com/prometheus/alertmanager\">Alertmanager</a>ç»„ä»¶å®ç°ï¼Œé‚£ä½ åº”è¯¥ä¸ºå“ªäº›æ ¸å¿ƒæŒ‡æ ‡å‘Šè­¦å‘¢ï¼Ÿ</p><p>å½“ç„¶æ˜¯å½±å“é›†ç¾¤å¯ç”¨æ€§çš„æœ€æ ¸å¿ƒçš„metricã€‚æ¯”å¦‚æ˜¯å¦æœ‰Leaderã€Leaderåˆ‡æ¢æ¬¡æ•°ã€WALå’Œäº‹åŠ¡æ“ä½œå»¶æ—¶ã€‚etcdç¤¾åŒºæä¾›äº†ä¸€ä¸ª<a href=\"https://github.com/etcd-io/etcd/blob/v3.4.9/Documentation/op-guide/etcd3_alert.rules\">ä¸°å¯Œçš„å‘Šè­¦è§„åˆ™</a>ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹ã€‚</p><p>æœ€åï¼Œä¸ºäº†æ–¹ä¾¿ä½ æŸ¥çœ‹etcdé›†ç¾¤è¿è¡ŒçŠ¶å†µå’Œæå‡å®šä½é—®é¢˜çš„æ•ˆç‡ï¼Œä½ å¯ä»¥åŸºäºé‡‡é›†çš„metricsé…ç½®ä¸ª<a href=\"https://github.com/etcd-io/etcd/blob/v3.4.9/Documentation/op-guide/grafana.json\">grafanaå¯è§†åŒ–é¢æ¿</a>ã€‚ä¸‹é¢æˆ‘ç»™ä½ åˆ—å‡ºäº†é›†ç¾¤æ˜¯å¦æœ‰Leaderã€æ€»çš„keyæ•°ã€æ€»çš„watcheræ•°ã€å‡ºæµé‡ã€WALæŒä¹…åŒ–å»¶æ—¶çš„å¯è§†åŒ–é¢æ¿ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/9f/a3b42d1e81dd706897edf32ecbc65f9f.png?wh=848*482\" alt=\"\"><br>\n<img src=\"https://static001.geekbang.org/resource/image/d3/7d/d3bc1f984ea8b2e301471ef2923d1b7d.png?wh=1306*366\" alt=\"\"><img src=\"https://static001.geekbang.org/resource/image/yy/9f/yy73b00dd4d48d473c1d900c96dd0a9f.png?wh=1308*358\" alt=\"\"><br>\n<img src=\"https://static001.geekbang.org/resource/image/2d/25/2d28317yyc38957ae2125e460b83f825.png?wh=1282*362\" alt=\"\"><br>\n<img src=\"https://static001.geekbang.org/resource/image/9c/b9/9c471d05b1452c4f0aa8yy24c79915b9.png?wh=1268*418\" alt=\"\"></p><h2>å¤‡ä»½åŠè¿˜åŸ</h2><p>ç›‘æ§åŠå‘Šè­¦å°±ç»ªåï¼Œå°±å¯ä»¥æä¾›ç»™ä¸šåŠ¡åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨äº†å—ï¼Ÿ</p><p>å½“ç„¶ä¸è¡Œï¼Œæ•°æ®æ˜¯ä¸šåŠ¡çš„å®‰å…¨çº¢çº¿ï¼Œæ‰€ä»¥ä½ è¿˜éœ€è¦åšå¥½æœ€æ ¸å¿ƒçš„æ•°æ®å¤‡ä»½å·¥ä½œã€‚</p><p>å¦‚ä½•åšå‘¢ï¼Ÿ</p><p>ä¸»è¦æœ‰ä»¥ä¸‹æ–¹æ³•ï¼Œé¦–å…ˆæ˜¯é€šè¿‡etcdctl snapshotå‘½ä»¤è¡Œäººå·¥å¤‡ä»½ã€‚åœ¨å‘èµ·é‡è¦å˜æ›´çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¤‡ä»½ï¼Œå¹¶æŸ¥çœ‹å¿«ç…§çŠ¶æ€ã€‚</p><pre><code>ETCDCTL_API=3 etcdctl --endpoints $ENDPOINT \nsnapshot save snapshotdb\nETCDCTL_API=3 etcdctl --write-out=table snapshot status snapshotdb\n</code></pre><p>å…¶æ¬¡æ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡è¿›è¡Œå®šæ—¶å¤‡ä»½ï¼Œå»ºè®®è‡³å°‘æ¯éš”1ä¸ªå°æ—¶å¤‡ä»½ä¸€æ¬¡ã€‚</p><p>ç„¶åæ˜¯é€šè¿‡<a href=\"https://github.com/coreos/etcd-operator/blob/master/doc/user/walkthrough/backup-operator.md#:~:text=etcd%20backup%20operator%20backs%20up,storage%20such%20as%20AWS%20S3.\">etcd-backup-operator</a>è¿›è¡Œè‡ªåŠ¨åŒ–çš„å¤‡ä»½ï¼Œç±»ä¼¼ServiceMonitorï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå¤‡ä»½ä»»åŠ¡CRDå®ç°ã€‚CRDå¦‚ä¸‹ï¼š</p><pre><code>apiVersion: &quot;etcd.database.coreos.com/v1beta2&quot;\nkind: &quot;EtcdBackup&quot;\nmetadata:\n  name: example-etcd-cluster-periodic-backup\nspec:\n  etcdEndpoints: [&lt;etcd-cluster-endpoints&gt;]\n  storageType: S3\n  backupPolicy:\n    # 0 &gt; enable periodic backup\n    backupIntervalInSecond: 125\n    maxBackups: 4\n  s3:\n    # The format of &quot;path&quot; must be: &quot;&lt;s3-bucket-name&gt;/&lt;path-to-backup-file&gt;&quot;\n    # e.g: &quot;mybucket/etcd.backup&quot;\n    path: &lt;full-s3-path&gt;\n    awsSecret: &lt;aws-secret&gt;\n</code></pre><p>æœ€åä½ å¯ä»¥é€šè¿‡ç»™etcdé›†ç¾¤å¢åŠ LearnerèŠ‚ç‚¹ï¼Œå®ç°è·¨åœ°åŸŸçƒ­å¤‡ã€‚å› LearnerèŠ‚ç‚¹å±äºéæŠ•ç¥¨æˆå‘˜çš„èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒå¹¶ä¸ä¼šå½±å“ä½ é›†ç¾¤çš„æ€§èƒ½ã€‚å®ƒçš„åŸºæœ¬å·¥ä½œåŸç†æ˜¯å½“Leaderæ”¶åˆ°å†™è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé€šè¿‡Raftæ¨¡å—å°†æ—¥å¿—åŒæ­¥ç»™LearnerèŠ‚ç‚¹ã€‚ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨etcd 3.4ä¸­ç›®å‰åªæ”¯æŒ1ä¸ªLearnerèŠ‚ç‚¹ï¼Œå¹¶ä¸”åªå…è®¸ä¸²è¡Œè¯»ã€‚</p><h2>å·¡æ£€</h2><p>å®Œæˆé›†ç¾¤éƒ¨ç½²ã€äº†è§£æˆå‘˜ç®¡ç†ã€æ„å»ºå¥½ç›‘æ§åŠå‘Šè­¦ä½“ç³»å¹¶æ·»åŠ å¥½å®šæ—¶å¤‡ä»½ç­–ç•¥åï¼Œè¿™æ—¶ç»ˆäºå¯ä»¥æ”¾å¿ƒç»™ä¸šåŠ¡ä½¿ç”¨äº†ã€‚ç„¶è€Œåœ¨åç»­ä¸šåŠ¡ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å„ç±»é—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜å¾ˆå¯èƒ½æ˜¯metricsç›‘æ§æ— æ³•å‘ç°çš„ï¼Œæ¯”å¦‚å¦‚ä¸‹ï¼š</p><ul>\n<li>etcdé›†ç¾¤å› é‡å¯è¿›ç¨‹ã€èŠ‚ç‚¹ç­‰å‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼›</li>\n<li>ä¸šåŠ¡å†™å…¥å¤§ key-value å¯¼è‡´ etcd æ€§èƒ½éª¤é™ï¼›</li>\n<li>ä¸šåŠ¡å¼‚å¸¸å†™å…¥å¤§é‡keyæ•°ï¼Œç¨³å®šæ€§å­˜åœ¨éšæ‚£ï¼›</li>\n<li>ä¸šåŠ¡å°‘æ•° key å‡ºç°å†™å…¥ QPS å¼‚å¸¸ï¼Œå¯¼è‡´ etcd é›†ç¾¤å‡ºç°é™é€Ÿç­‰é”™è¯¯ï¼›</li>\n<li>é‡å¯ã€å‡çº§ etcd åï¼Œéœ€è¦äººå·¥ä»å¤šç»´åº¦æ£€æŸ¥é›†ç¾¤å¥åº·åº¦ï¼›</li>\n<li>å˜æ›´ etcd é›†ç¾¤è¿‡ç¨‹ä¸­ï¼Œæ“ä½œå¤±è¯¯å¯èƒ½ä¼šå¯¼è‡´ etcd é›†ç¾¤å‡ºç°åˆ†è£‚ï¼›</li>\n</ul><p>......</p><p>å› æ­¤ä¸ºäº†å®ç°é«˜æ•ˆæ²»ç†etcdé›†ç¾¤ï¼Œæˆ‘ä»¬å¯å°†è¿™äº›æ½œåœ¨éšæ‚£æ€»ç»“æˆä¸€ä¸ªä¸ªè‡ªåŠ¨åŒ–æ£€æŸ¥é¡¹ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>å¦‚ä½•é«˜æ•ˆç›‘æ§ etcd æ•°æ®ä¸ä¸€è‡´æ€§ï¼Ÿ</li>\n<li>å¦‚ä½•åŠæ—¶å‘ç°å¤§ key-value?</li>\n<li>å¦‚ä½•åŠæ—¶é€šè¿‡ç›‘æ§å‘ç° key æ•°å¼‚å¸¸å¢é•¿ï¼Ÿ</li>\n<li>å¦‚ä½•åŠæ—¶ç›‘æ§å¼‚å¸¸å†™å…¥ QPS?</li>\n<li>å¦‚ä½•ä»å¤šç»´åº¦çš„å¯¹é›†ç¾¤è¿›è¡Œè‡ªåŠ¨åŒ–çš„å¥åº·æ£€æµ‹ï¼Œæ›´å®‰å¿ƒå˜æ›´ï¼Ÿ</li>\n<li>......</li>\n</ul><p>å¦‚ä½•å°†è¿™äº› etcd çš„æœ€ä½³å®è·µç­–ç•¥åå“ºåˆ°ç°ç½‘å¤§è§„æ¨¡ etcd é›†ç¾¤çš„æ²»ç†ä¸­å»å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯å·¡æ£€ã€‚</p><p>å‚è€ƒServiceMonitorå’ŒEtcdBackupæœºåˆ¶ï¼Œä½ åŒæ ·å¯ä»¥é€šè¿‡CRDçš„æ–¹å¼æè¿°æ­¤å·¡æ£€ä»»åŠ¡ï¼Œç„¶åé€šè¿‡ç›¸åº”çš„Operatorå®ç°æ­¤å·¡æ£€ä»»åŠ¡ã€‚æ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§å·¡æ£€çš„YAMLæ–‡ä»¶ï¼Œå…¶å¯¹åº”çš„Operatorç»„ä»¶ä¼šå®šæ—¶ã€å¹¶å‘æ£€æŸ¥å…¶å…³è”çš„etcdé›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„keyå·®å¼‚æ•°ã€‚</p><pre><code>apiVersion: etcd.cloud.tencent.com/v1beta1\nkind: EtcdMonitor\nmetadata:  \ncreationTimestamp: &quot;2020-06-15T12:19:30Z&quot;  \ngeneration: 1  \nlabels:    \nclusterName: gz-qcloud-etcd-03    \nregion: gz    \nsource: etcd-life-cycle-operator  \nname: gz-qcloud-etcd-03-etcd-node-key-diff  \nnamespace: gz\nspec:  \nclusterId: gz-qcloud-etcd-03  \nmetricName: etcd-node-key-diff  \nmetricProviderName: cruiser  \nname: gz-qcloud-etcd-03  \nproductName: tke  \nregion: gz\nstatus:  \nrecords:  \n- endTime: &quot;2021-02-25T11:22:26Z&quot;    \nmessage: collectEtcdNodeKeyDiff,etcd cluster gz-qcloud-etcd-03,total key num is      \n122143,nodeKeyDiff is 0     \nstartTime: &quot;2021-02-25T12:39:28Z&quot;  \nupdatedAt: &quot;2021-02-25T12:39:28Z&quot;\n</code></pre><h2>é«˜å¯ç”¨åŠè‡ªæ„ˆ</h2><p>é€šè¿‡ä»¥ä¸Šæœºåˆ¶ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬å»ºè®¾å¥½ä¸€ä¸ªé«˜å¯ç”¨çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»äº†ã€‚æœ€åå†ç»™ä½ æä¾›å‡ ä¸ªé›†ç¾¤é«˜å¯ç”¨åŠè‡ªæ„ˆçš„å°å»ºè®®ï¼š</p><ul>\n<li>è‹¥etcdé›†ç¾¤æ€§èƒ½å·²æ»¡è¶³ä¸šåŠ¡è¯‰æ±‚ï¼Œå¯å®¹å¿ä¸€å®šçš„å»¶æ—¶ä¸Šå‡ï¼Œå»ºè®®ä½ å°†etcdé›†ç¾¤åšé«˜å¯ç”¨éƒ¨ç½²ï¼Œæ¯”å¦‚å¯¹3ä¸ªèŠ‚ç‚¹æ¥è¯´ï¼ŒæŠŠæ¯ä¸ªèŠ‚ç‚¹éƒ¨ç½²åœ¨ç‹¬ç«‹çš„å¯ç”¨åŒºï¼Œå¯å®¹å¿ä»»æ„ä¸€ä¸ªå¯ç”¨åŒºæ•…éšœã€‚</li>\n<li>é€æ­¥å°è¯•ä½¿ç”¨Kuberneteså®¹å™¨åŒ–éƒ¨ç½²etcdé›†ç¾¤ã€‚å½“èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œèƒ½é€šè¿‡Kubernetesçš„è‡ªæ„ˆæœºåˆ¶ï¼Œå®ç°æ•…éšœè‡ªæ„ˆã€‚</li>\n<li>è®¾ç½®åˆç†çš„db quotaå€¼ï¼Œé…ç½®åˆç†çš„å‹ç¼©ç­–ç•¥ï¼Œé¿å…é›†ç¾¤db quotaæ»¡ä»è€Œå¯¼è‡´é›†ç¾¤ä¸å¯ç”¨çš„æƒ…å†µå‘ç”Ÿã€‚</li>\n</ul><h2>æ··æ²Œå·¥ç¨‹</h2><p>åœ¨ä½¿ç”¨etcdçš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç£ç›˜ã€ç½‘ç»œã€è¿›ç¨‹å¼‚å¸¸é‡å¯ç­‰å¼‚å¸¸å¯¼è‡´çš„æ•…éšœã€‚å¦‚ä½•å¿«é€Ÿå¤ç°ç›¸å…³æ•…éšœè¿›è¡Œé—®é¢˜å®šä½å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯æ··æ²Œå·¥ç¨‹ã€‚ä¸€èˆ¬å¸¸è§çš„å¼‚å¸¸æˆ‘ä»¬å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p><ul>\n<li>ç£ç›˜IOç›¸å…³çš„ã€‚æ¯”å¦‚æ¨¡æ‹Ÿç£ç›˜IOå»¶æ—¶ä¸Šå‡ã€IOæ“ä½œæŠ¥é”™ã€‚ä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªåº•å±‚ç£ç›˜ç¡¬ä»¶å¼‚å¸¸å¯¼è‡´IOå»¶æ—¶é£™å‡ï¼Œæœ€ç»ˆè§¦å‘äº†etcdæ­»é”çš„Bugï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡æ¨¡æ‹Ÿç£ç›˜IOå»¶æ—¶ä¸Šå‡åæ¥éªŒè¯çš„ã€‚</li>\n<li>ç½‘ç»œç›¸å…³çš„ã€‚æ¯”å¦‚æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒºã€ç½‘ç»œä¸¢åŒ…ã€ç½‘ç»œå»¶æ—¶ã€åŒ…é‡å¤ç­‰ã€‚</li>\n<li>è¿›ç¨‹ç›¸å…³çš„ã€‚æ¯”å¦‚æ¨¡æ‹Ÿè¿›ç¨‹å¼‚å¸¸è¢«æ€ã€é‡å¯ç­‰ã€‚ä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªéå¸¸éš¾å®šä½å’Œå¤ç°çš„æ•°æ®ä¸ä¸€è‡´Bugï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡æ³¨å…¥è¿›ç¨‹å¼‚å¸¸é‡å¯ç­‰æ•…éšœï¼Œæœ€åæˆåŠŸå¤ç°ã€‚</li>\n<li>å‹åŠ›æµ‹è¯•ç›¸å…³çš„ã€‚æ¯”å¦‚æ¨¡æ‹ŸCPUé«˜è´Ÿè½½ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ã€‚</li>\n</ul><p>å¼€æºç¤¾åŒºåœ¨æ··æ²Œå·¥ç¨‹é¢†åŸŸè¯ç”Ÿäº†è‹¥å¹²ä¸ªä¼˜ç§€çš„æ··æ²Œå·¥ç¨‹é¡¹ç›®ï¼Œå¦‚chaos-meshã€chaos-bladeã€litmusã€‚è¿™é‡Œæˆ‘é‡ç‚¹å’Œä½ ä»‹ç»ä¸‹<a href=\"https://github.com/chaos-mesh/chaos-mesh\">chaos-mesh</a>ï¼Œå®ƒæ˜¯åŸºäºKuberneteså®ç°çš„äº‘åŸç”Ÿæ··æ²Œå·¥ç¨‹å¹³å°ï¼Œä¸‹å›¾æ˜¯å…¶æ¶æ„å›¾ï¼ˆå¼•ç”¨è‡ªç¤¾åŒºï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/a7/b87d187ea2ab60d824223662fd6033a7.png?wh=1920*1287\" alt=\"\"></p><p>ä¸ºäº†å®ç°ä»¥ä¸Šå¼‚å¸¸åœºæ™¯çš„æ•…éšœæ³¨å…¥ï¼Œchaos-meshå®šä¹‰äº†è‹¥å¹²ç§èµ„æºç±»å‹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul>\n<li>IOChaosï¼Œç”¨äºæ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„IOå»¶æ—¶å’Œè¯»å†™é”™è¯¯ç­‰ã€‚</li>\n<li>NetworkChaosï¼Œç”¨äºæ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ã€ä¸¢åŒ…ç­‰ã€‚</li>\n<li>PodChaosï¼Œç”¨äºæ¨¡æ‹Ÿä¸šåŠ¡Podå¼‚å¸¸ï¼Œæ¯”å¦‚Podè¢«æ€ã€Podå†…çš„å®¹å™¨é‡å¯ç­‰ã€‚</li>\n<li>StressChaosï¼Œç”¨äºæ¨¡æ‹ŸCPUå’Œå†…å­˜å‹åŠ›æµ‹è¯•ã€‚</li>\n</ul><p>å½“ä½ å¸Œæœ›ç»™etcd Podæ³¨å…¥ä¸€ä¸ªç£ç›˜IOå»¶æ—¶çš„æ•…éšœæ—¶ï¼Œä½ åªéœ€è¦åˆ›å»ºæ­¤YAMLæ–‡ä»¶å°±å¥½ã€‚</p><pre><code>apiVersion: chaos-mesh.org/v1alpha1\nkind: IoChaos\nmetadata:\n  name: io-delay-example\nspec:\n  action: latency\n  mode: one\n  selector:\n    labelSelectors:\n      app: etcd\n  volumePath: /var/run/etcd\n  path: '/var/run/etcd/**/*'\n  delay: '100ms'\n  percent: 50\n  duration: '400s'\n  scheduler:\n    cron: '@every 10m'\n</code></pre><h2>å°ç»“</h2><p>æœ€åæˆ‘ä»¬æ¥å°ç»“ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚</p><p>ä»Šå¤©æˆ‘é€šè¿‡ä»é›†ç¾¤éƒ¨ç½²ã€é›†ç¾¤ç»„å»ºã€ç›‘æ§åŠå‘Šè­¦ä½“ç³»ã€å¤‡ä»½ã€å·¡æ£€ã€é«˜å¯ç”¨ã€æ··æ²Œå·¥ç¨‹å‡ ä¸ªç»´åº¦ï¼Œå’Œä½ æ·±å…¥ä»‹ç»äº†å¦‚ä½•æ„å»ºä¸€ä¸ªé«˜å¯é çš„etcdé›†ç¾¤è¿ç»´ä½“ç³»ã€‚</p><p>åœ¨é›†ç¾¤éƒ¨ç½²ä¸Šï¼Œå½“ä½ çš„ä¸šåŠ¡é›†ç¾¤è§„æ¨¡éå¸¸å¤§ã€å¯¹ç¨³å®šæ€§æœ‰ç€æé«˜çš„è¦æ±‚æ—¶ï¼Œæ¨èä½¿ç”¨å¤§è§„æ ¼ã€é«˜æ€§èƒ½çš„ç‰©ç†æœºã€è™šæ‹Ÿæœºç‹¬å éƒ¨ç½²ï¼Œå¹¶ä¸”ä½¿ç”¨ansibleç­‰è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œè¿›è¡Œæ ‡å‡†åŒ–çš„æ“ä½œetcdï¼Œé¿å…äººå·¥ä¸€ä¸ªä¸ªä¿®æ”¹æ“ä½œã€‚</p><p>å¯¹å®¹å™¨åŒ–éƒ¨ç½²æ¥è¯´ï¼ŒKubernetesåœºæ™¯æ¨èä½ ä½¿ç”¨kubeadmï¼Œå…¶ä»–åœºæ™¯å¯è€ƒè™‘åˆ†æ‰¹ã€é€æ­¥ä½¿ç”¨bitnamiæä¾›çš„etcd helmåŒ…ï¼Œå®ƒæ˜¯åŸºäºstatefulsetã€PVã€PVCå®ç°çš„ï¼Œå„å¤§äº‘å‚å•†éƒ½å¹¿æ³›æ”¯æŒï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒå‰ï¼Œå¤šéªŒè¯å„ä¸ªæç«¯æƒ…å†µä¸‹çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸã€‚</p><p>åœ¨é›†ç¾¤ç»„å»ºä¸Šï¼Œå„ä¸ªèŠ‚ç‚¹éœ€è¦ä¸€å®šæœºåˆ¶å»å‘ç°é›†ç¾¤ä¸­çš„å…¶ä»–æˆå‘˜èŠ‚ç‚¹ï¼Œä¸»è¦å¯åˆ†ä¸º<strong>static configuration</strong>å’Œ<strong>dynamic service discovery</strong>ã€‚</p><p>static configurationæ˜¯æŒ‡é›†ç¾¤ä¸­å„ä¸ªæˆå‘˜èŠ‚ç‚¹ä¿¡æ¯æ˜¯å·²çŸ¥çš„ï¼Œdynamic service discoveryæ˜¯æŒ‡ä½ å¯ä»¥é€šè¿‡æœåŠ¡å‘ç°ç»„ä»¶å»æ³¨å†Œè‡ªèº«èŠ‚ç‚¹ä¿¡æ¯ã€å‘ç°é›†ç¾¤ä¸­å…¶ä»–æˆå‘˜èŠ‚ç‚¹ä¿¡æ¯ã€‚å¦å¤–æˆ‘å’Œä½ ä»‹ç»äº†é‡è¦å‚æ•°initial-cluster-stateçš„å«ä¹‰ï¼Œå®ƒä¹Ÿæ˜¯å½±å“é›†ç¾¤ç»„å»ºçš„ä¸€ä¸ªæ ¸å¿ƒå› ç´ ã€‚</p><p>åœ¨ç›‘æ§åŠå‘Šè­¦ä½“ç³»ä¸Šï¼Œæˆ‘å’Œä½ ä»‹ç»äº†etcdç½‘ç»œã€ç£ç›˜ã€etcdserverã€gRPCæ ¸å¿ƒçš„metricsã€‚é€šè¿‡ä¿®æ”¹Prometheuesé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ etcd targetï¼Œä½ å°±å¯ä»¥æ–¹ä¾¿çš„é‡‡é›†etcdçš„ç›‘æ§æ•°æ®ã€‚æˆ‘è¿˜ç»™ä½ ä»‹ç»äº†ServiceMonitoræœºåˆ¶ï¼Œä½ å¯é€šè¿‡å®ƒå®ç°åŠ¨æ€æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹å¾…ç›‘æ§çš„etcdå®ä¾‹ï¼Œçµæ´»çš„ã€é«˜æ•ˆçš„é‡‡é›†etcd Metrcisã€‚</p><p>å¤‡ä»½åŠè¿˜åŸä¸Šï¼Œé‡ç‚¹å’Œä½ ä»‹ç»äº†etcd snapshotå‘½ä»¤ï¼Œetcd-backup-operatorçš„å¤‡ä»½ä»»åŠ¡CRDæœºåˆ¶ï¼Œæ¨èä½¿ç”¨åè€…ã€‚</p><p>æœ€åæ˜¯å·¡æ£€ã€æ··æ²Œå·¥ç¨‹ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬é«˜æ•ˆæ²»ç†etcdé›†ç¾¤ï¼ŒåŠæ—¶å‘ç°æ½œåœ¨éšæ‚£ï¼Œä½æˆæœ¬ã€å¿«é€Ÿçš„å¤ç°Bugå’Œæ•…éšœç­‰ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾åˆ°è¿™é‡Œä¹Ÿå°±ç»“æŸäº†ï¼Œæœ€åæˆ‘ç»™ä½ ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ã€‚</p><p>ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›®å‰æ˜¯ä½¿ç”¨å“ªç§æ–¹å¼éƒ¨ç½²etcdé›†ç¾¤çš„å‘¢ï¼Ÿè‹¥åŸºäºKuberneteså®¹å™¨åŒ–éƒ¨ç½²çš„ï¼Œæ˜¯å¦é‡åˆ°è¿‡å®¹å™¨åŒ–åçš„ç›¸å…³é—®é¢˜ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","comments":[{"had_liked":false,"id":328516,"user_name":"å”èª","can_delete":false,"product_type":"c1","uid":1009582,"ip_address":"","ucode":"99CB061EDF35EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","comment_is_top":true,"comment_ctime":1640760511,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"9.2233721029199995e+18","product_id":100069901,"comment_content":"æœ€è¿‘æˆ‘ä»¬å¼€æºäº†ä¸€ä¸ªetcdä¸€ç«™å¼æ²»ç†å¹³å°kstone.<br>Kstone æ˜¯ä¸€ä¸ªé’ˆå¯¹ etcd çš„å…¨æ–¹ä½è¿ç»´è§£å†³æ–¹æ¡ˆï¼Œæä¾›é›†ç¾¤ç®¡ç†ï¼ˆå…³è”å·²æœ‰é›†ç¾¤ã€åˆ›å»ºæ–°é›†ç¾¤ç­‰)ã€ç›‘æ§ã€å¤‡ä»½ã€å·¡æ£€ã€æ•°æ®è¿ç§»ã€æ•°æ®å¯è§†åŒ–ã€æ™ºèƒ½è¯Šæ–­ç­‰ä¸€ç³»åˆ—ç‰¹æ€§ã€‚<br>Kstone å°†å¸®åŠ©ä½ é«˜æ•ˆç®¡ç†etcdé›†ç¾¤ï¼Œæ˜¾è‘—é™ä½è¿ç»´æˆæœ¬ã€åŠæ—¶å‘ç°æ½œåœ¨éšæ‚£ã€æå‡k8s etcdå­˜å‚¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚<br>https:&#47;&#47;github.com&#47;tkestack&#47;kstone, æ¬¢è¿å¤§å®¶starã€forkï¼Œå¹¶åŠ å…¥æˆ‘ä»¬ï¼Œæ¨åŠ¨kstoneè¶Šæ¥è¶Šå¥½ã€‚","like_count":16,"discussions":[{"author":{"id":1045107,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","nickname":"ä¹”çº³æ£®","note":"","ucode":"51EC9FAE071388","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544708,"discussion_content":"åç­‰etcd-operator ä¹Ÿå¼€æºï¼Œç›®å‰çš„å‡ æ¬¾éƒ½ä¸å¤ªå¥½ç”¨ï¼› bitnami çº¯shell å»æ§åˆ¶é›†ç¾¤çŠ¶æ€ï¼Œå¼‚å¸¸çš„æ—¶å€™ä¸å¤ªå¥½äº†è§£å½“å‰é›†ç¾¤æ•…éšœåŸå› ï¼Œå‡å¦‚æ˜¯operator å®ç°çš„è¯ï¼Œå¯ä»¥æŠ›ä¸€ä¸‹äº‹ä»¶å‡ºæ¥ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641651224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1023905,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","nickname":"po","note":"","ucode":"7DB36C278F34D7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1045107,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","nickname":"ä¹”çº³æ£®","note":"","ucode":"51EC9FAE071388","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":566721,"discussion_content":"ä¸æ˜¯æœ¬èº«å°±å·²ç»å¼€æºäº†å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650733107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":544708,"ip_address":""},"score":566721,"extra":""}]}]},{"had_liked":false,"id":286984,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1004331,"ip_address":"","ucode":"EA0C159386898E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/53/2b/94b5b872.jpg","comment_is_top":false,"comment_ctime":1617714771,"is_pvip":false,"replies":[{"id":"104907","content":"1. å‹ç¼©æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æŒ‰æ—¶é—´å‘¨æœŸæ¨¡å¼ï¼Œä¸€èˆ¬5åˆ†é’Ÿ<br>2. å¤‡ä»½æˆ‘ä»¬åŸºäºetcd-backup-operatoræ”¯æŒäº†coså¯¹è±¡å­˜å‚¨ï¼Œä¼šå®šæ—¶å¤‡ä»½åˆ°å¯¹è±¡å­˜å‚¨ä¸Šï¼Œä¸€èˆ¬åœ¨é›†ç¾¤æ­£å¸¸ï¼Œæ•°æ®å·®å¼‚ä¸å¤§çš„åœºæ™¯ä¸‹ï¼Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¤‡ä»½å³å¯ã€‚etcdèŠ‚ç‚¹æ€§èƒ½è‹¥è¾ƒå·®ï¼Œå¤‡ä»½è‹¥å½±å“åˆ°æœåŠ¡æ€§èƒ½çš„ï¼Œå¯ä¼˜å…ˆé€‰æ‹©followerèŠ‚ç‚¹å¤‡ä»½ï¼Œæˆ–è€…é€šè¿‡learnerèŠ‚ç‚¹æ¥å¤‡ä»½ï¼Œä¸è¿‡ç›®å‰ç¤¾åŒºç‰ˆlearnerèŠ‚ç‚¹å¹¶ä¸æ”¯æŒå¤‡ä»½snapshotå‘½ä»¤ï¼Œæˆ‘å°†æäº¤ä¸€ä¸ªissueå’Œpræ¥è®¨è®ºã€æ”¯æŒè¿™ä¸ªã€‚<br>3.å»ºè®®æ•æ„Ÿåœºæ™¯ã€å¤§é›†ç¾¤æœ€å¥½åˆ†å¼€éƒ¨ç½²ï¼Œä¹‹å‰æˆ‘ä»¬é‡åˆ°äº†å¤šä¸ªç£ç›˜ioå¼‚å¸¸caseå°±æ˜¯å› ä¸ºå—èŠ‚ç‚¹ä¸Šå…¶ä»–ç»„ä»¶å½±å“ã€‚<br>4.ç›®å‰æ²¡çœ‹åˆ°åˆé€‚<br><br>","user_name":"ä½œè€…å›å¤","comment_id":286984,"uid":"1009582","ip_address":"","utype":1,"ctime":1618889109,"user_name_real":"å”èª"}],"discussion_count":3,"race_medal":0,"score":"40272420435","product_id":100069901,"comment_content":"å”è€å¸ˆï¼Œåœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œæœ‰ä¸€äº›é—®é¢˜éœ€è¦å’¨è¯¢æ‚¨ä¸‹ï¼Œè¿˜æœ›æŒ‡ç‚¹ä¸‹ï¼Œå¤šè°¢è€å¸ˆ<br>1ã€ etcd auto compact æœ‰æ¨èçš„å€¼å—ï¼Ÿ<br>2ã€ etcd backup æ˜¯å¦éœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Ÿlearner èŠ‚ç‚¹ db æ–‡ä»¶æ—¶å€™å¯ä»¥å½“åšå¤‡ä»½æ–‡ä»¶æ¥ä½¿ç”¨ï¼Ÿ learner èŠ‚ç‚¹åé¢å¯ä»¥æ”¯æŒ snapshotå—ï¼Ÿ <br>3ã€ etcd æ˜¯å¦éœ€è¦å•ç‹¬éƒ¨ç½²ï¼Œä¸å…¶ä»–ç»„ä»¶åˆ†å¼€æ¥ï¼Ÿ<br>4ã€ etcd å·¡æ£€æœ‰æ²¡æœ‰å¼€æºé¡¹ç›®æ¨èï¼Ÿ","like_count":10,"discussions":[{"author":{"id":1045107,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","nickname":"ä¹”çº³æ£®","note":"","ucode":"51EC9FAE071388","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544709,"discussion_content":"kube-apiserver æœ‰ä¸ªå‚æ•° --etcd-compaction-interval é»˜è®¤å€¼æ˜¯5m ä¸­ï¼Œå‡å¦‚æ˜¯é›†ç¾¤ä½¿ç”¨çš„è¯ï¼Œå¯èƒ½å°±ä¸ç”¨é…ç½®å‹ç¼©å‚æ•°äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641651353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1045107,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","nickname":"ä¹”çº³æ£®","note":"","ucode":"51EC9FAE071388","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":569955,"discussion_content":"å»ºè®®è¿˜æ˜¯é…ç½®ä¸‹etcdå‹ç¼©å‚æ•°, ä½ å¯èƒ½ä¼šé‡åˆ°åœ¨apiserveré«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œä¼šé™·å…¥é‡å¯å¾ªç¯ï¼Œå¯¼è‡´æ— æ³•è§¦å‘compact, å¯¼è‡´dbæ»¡ï¼Œå¼•å‘æ›´ä¸¥é‡çš„æ•…éšœ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651623443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":544709,"ip_address":""},"score":569955,"extra":""}]},{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518153,"discussion_content":"1. å‹ç¼©æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æŒ‰æ—¶é—´å‘¨æœŸæ¨¡å¼ï¼Œä¸€èˆ¬5åˆ†é’Ÿ\n2. å¤‡ä»½æˆ‘ä»¬åŸºäºetcd-backup-operatoræ”¯æŒäº†coså¯¹è±¡å­˜å‚¨ï¼Œä¼šå®šæ—¶å¤‡ä»½åˆ°å¯¹è±¡å­˜å‚¨ä¸Šï¼Œä¸€èˆ¬åœ¨é›†ç¾¤æ­£å¸¸ï¼Œæ•°æ®å·®å¼‚ä¸å¤§çš„åœºæ™¯ä¸‹ï¼Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¤‡ä»½å³å¯ã€‚etcdèŠ‚ç‚¹æ€§èƒ½è‹¥è¾ƒå·®ï¼Œå¤‡ä»½è‹¥å½±å“åˆ°æœåŠ¡æ€§èƒ½çš„ï¼Œå¯ä¼˜å…ˆé€‰æ‹©followerèŠ‚ç‚¹å¤‡ä»½ï¼Œæˆ–è€…é€šè¿‡learnerèŠ‚ç‚¹æ¥å¤‡ä»½ï¼Œä¸è¿‡ç›®å‰ç¤¾åŒºç‰ˆlearnerèŠ‚ç‚¹å¹¶ä¸æ”¯æŒå¤‡ä»½snapshotå‘½ä»¤ï¼Œæˆ‘å°†æäº¤ä¸€ä¸ªissueå’Œpræ¥è®¨è®ºã€æ”¯æŒè¿™ä¸ªã€‚\n3.å»ºè®®æ•æ„Ÿåœºæ™¯ã€å¤§é›†ç¾¤æœ€å¥½åˆ†å¼€éƒ¨ç½²ï¼Œä¹‹å‰æˆ‘ä»¬é‡åˆ°äº†å¤šä¸ªç£ç›˜ioå¼‚å¸¸caseå°±æ˜¯å› ä¸ºå—èŠ‚ç‚¹ä¸Šå…¶ä»–ç»„ä»¶å½±å“ã€‚\n4.ç›®å‰æ²¡çœ‹åˆ°åˆé€‚\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618889109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284104,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1616066406,"is_pvip":false,"replies":[{"id":"103047","content":"å“ˆå“ˆï¼Œå·¡æ£€å’Œæ··æ²Œå·¥ç¨‹æå¥½äº†çš„ç¡®å¾ˆå¥½ç”¨çš„ï¼Œèƒ½å¸®åŠ©å¤§å®¶æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¿å…ä¸å¿…è¦çº¿ä¸Šé—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":284104,"uid":"1009582","ip_address":"","utype":1,"ctime":1616079527,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"23090902886","product_id":100069901,"comment_content":"kubeadméƒ¨ç½².k8sç‰ˆæœ¬å‡çº§é‡åˆ°è¿‡æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ.è¿˜å¥½æœ‰backupğŸ˜€å¤§èµ å·¡æ£€å’Œæ··æ­å·¥ç¨‹ï¼levelæœ‰æé«˜äº†","like_count":5,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517236,"discussion_content":"å“ˆå“ˆï¼Œå·¡æ£€å’Œæ··æ²Œå·¥ç¨‹æå¥½äº†çš„ç¡®å¾ˆå¥½ç”¨çš„ï¼Œèƒ½å¸®åŠ©å¤§å®¶æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¿å…ä¸å¿…è¦çº¿ä¸Šé—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616079527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315950,"user_name":"Geek_edd932","can_delete":false,"product_type":"c1","uid":2364381,"ip_address":"","ucode":"50BB32FBF32648","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1pMbwZrAl5g8ZRC5SOlz9VQOVRGN5V1rFNwsmEehicGzxMRicGj330jNfwTE1MRLaZTdSvX8R2YJVEh8DrYnMVAQ/132","comment_is_top":false,"comment_ctime":1634086299,"is_pvip":false,"replies":[{"id":"114589","content":"ä½ å¥½ï¼ŒåŸºäºä½ ä»¬ç°çŠ¶ï¼Œæˆ‘å»ºè®®åœ¨cå›­åŒºéƒ¨ç½²learnerèŠ‚ç‚¹æ›´åŠ é è°±ç‚¹ï¼Œå¼€æºç¤¾åŒºç‚¹make-mirrorè¿˜è¾¾ä¸åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚ï¼Œå­˜åœ¨å„ç§é—®é¢˜ï¼Œè¯¦ç»†å‚è€ƒè¿™ç¯‡æ–‡ç« åˆ†æã€‚<br>https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;_Ee9J7x73gM_GJ6-8MEl2w<br>å¦‚æœåŒåŸæœ‰3ä¸ªå›­åŒºï¼Œæœ€å¥½å°†etcdé›†ç¾¤éƒ¨ç½²åœ¨3ä¸ªå›­åŒºä¸­ï¼Œ2ã€2ã€1ï¼Œè¿™æ ·å°±å¯ä»¥å®¹å¿1ä¸ªå›­åŒºæ•…éšœã€‚","user_name":"ä½œè€…å›å¤","comment_id":315950,"uid":"1009582","ip_address":"","utype":1,"ctime":1634311355,"user_name_real":"å”èª"}],"discussion_count":2,"race_medal":0,"score":"10224020891","product_id":100069901,"comment_content":"å”è€å¸ˆï¼Œæˆ‘ä»¬ç”Ÿäº§ä¸Šæœ‰3å›­åŒºï¼Œåˆ†åˆ«æ˜¯ABCå›­åŒºï¼Œå…¶ä¸­ABå›­åŒºåŒåŸã€‚ABå›­åŒºåˆ°Cå›­åŒºæœ‰20-30msçš„ç½‘ç»œå»¶è¿Ÿã€‚ä¹‹å‰é›†ç¾¤éƒ¨ç½²äº†7ä¸ªèŠ‚ç‚¹ï¼Œåœ¨Aéƒ¨ç½²2èŠ‚ç‚¹ï¼Œåœ¨Béƒ¨ç½²3èŠ‚ç‚¹ï¼Œåœ¨Céƒ¨ç½²2èŠ‚ç‚¹ã€‚ç”±äºç½‘ç»œæ•…éšœç­‰åŸå› Leaderè½¬ç§»åˆ°å°‘æ•°æ´¾Cå›­åŒºï¼Œå¯¼è‡´è¯·æ±‚å»¶è¿Ÿå°†è¿‘100msï¼Œä»è€Œå½±å“ä¸šåŠ¡ã€‚<br>ç›®å‰æƒ³åœ¨ABå›­åŒºéƒ¨ç½²èŠ‚ç‚¹æ•°é‡ä¸º5çš„ä¸»ETCDé›†ç¾¤ï¼Œå…¶ä¸­Aå›­åŒº2ä¸ªèŠ‚ç‚¹ï¼ŒBå›­åŒº3ä¸ªèŠ‚ç‚¹ã€‚åœ¨Cå›­åŒºéƒ¨ç½²èŠ‚ç‚¹æ•°é‡ä¸º3çš„å¤‡ETCDé›†ç¾¤ã€‚é€šè¿‡Maker-mirrorå·¥å…·å®ç°ä¸»å¤‡ETCDé›†ç¾¤æ•°æ®åŒæ­¥ã€‚åº”ç”¨ä»ä¸»ETCDé›†ç¾¤å­˜å–æ•°æ®ï¼Œå½“ä¸»ETCDé›†ç¾¤ä¸è‚¯ç”¨æ—¶ï¼Œåˆ‡åˆ°å¤‡ETCDé›†ç¾¤å­˜å–æ•°æ®ã€‚ç”±æ­¤å®ç°ä¸‰å›­åŒºé«˜å¯ç”¨ä½å»¶è¿Ÿã€‚<br>è€å¸ˆï¼Œå¸®å¿™çœ‹çœ‹æ­¤æ–¹æ¡ˆå¯è¡Œæ€§ã€‚æ˜¯å¦æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528212,"discussion_content":"ä½ å¥½ï¼ŒåŸºäºä½ ä»¬ç°çŠ¶ï¼Œæˆ‘å»ºè®®åœ¨cå›­åŒºéƒ¨ç½²learnerèŠ‚ç‚¹æ›´åŠ é è°±ç‚¹ï¼Œå¼€æºç¤¾åŒºç‚¹make-mirrorè¿˜è¾¾ä¸åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚ï¼Œå­˜åœ¨å„ç§é—®é¢˜ï¼Œè¯¦ç»†å‚è€ƒè¿™ç¯‡æ–‡ç« åˆ†æã€‚\nhttps://mp.weixin.qq.com/s/_Ee9J7x73gM_GJ6-8MEl2w\nå¦‚æœåŒåŸæœ‰3ä¸ªå›­åŒºï¼Œæœ€å¥½å°†etcdé›†ç¾¤éƒ¨ç½²åœ¨3ä¸ªå›­åŒºä¸­ï¼Œ2ã€2ã€1ï¼Œè¿™æ ·å°±å¯ä»¥å®¹å¿1ä¸ªå›­åŒºæ•…éšœã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634311355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1131049,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJn1l43V2gtc8RfESfSyeP7NYJnqtulOywO8DGJDq9KicSqEEMD3ZuFTE1VK78WrW1HAEJXvzQCnQQ/132","nickname":"é˜¿è‘£","note":"","ucode":"817DC1A390585C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575349,"discussion_content":"å¦‚æœ Leader åˆ‡åˆ°äº† C åŒºçš„ é‚£ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå»¶è¿Ÿè¿˜æ˜¯æœ‰ï¼Œæ²¡è§£å†³å®é™…é—®é¢˜ã€‚æé—®è€…åº”è¯¥æ˜¯æƒ³æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè®¿é—®åˆ° Aæˆ–BåŒºï¼Œåªæœ‰è¿™ 2 ä¸ªåŒºæœ‰é—®é¢˜æ—¶æ­¤ä¼šåˆ‡åˆ° C åŒºï¼ˆCåŒºäº†çš„èŠ‚ç‚¹è‡ªæˆé›†ç¾¤ï¼Œæ²¡æœ‰å»¶è¿Ÿé—®é¢˜ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654764761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":528212,"ip_address":""},"score":575349,"extra":""}]}]},{"had_liked":false,"id":329464,"user_name":"æŸ æª¬ğŸ‹","can_delete":false,"product_type":"c1","uid":2882912,"ip_address":"","ucode":"B16EBB8F0D620F","user_header":"https://static001.geekbang.org/account/avatar/00/2b/fd/60/68c27acf.jpg","comment_is_top":false,"comment_ctime":1641356342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5936323638","product_id":100069901,"comment_content":"å”è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œetcdå¿…é¡»éƒ¨ç½²åœ¨ssdä¸Šé¢å—ï¼Ÿetcdå¯¹ç£ç›˜æœ€ä½çš„æ€§èƒ½è¦æ±‚ï¼ˆæ”¯æŒk8sé›†ç¾¤èƒ½å¤Ÿå¥åº·ç¨³å®šè¿è¡Œï¼‰æ˜¯å¤šå°‘å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":302603,"user_name":"ä¸æƒ³è¯´","can_delete":false,"product_type":"c1","uid":1245493,"ip_address":"","ucode":"1E27B4690B7715","user_header":"https://static001.geekbang.org/account/avatar/00/13/01/35/1c440045.jpg","comment_is_top":false,"comment_ctime":1626277144,"is_pvip":true,"replies":[{"id":"110133","content":"é›†ç¾¤è§„æ¨¡å°ï¼Œå¯ä»¥çš„ï¼Œeventæœ€å¥½ç‹¬ç«‹ä¸‹ï¼Œæ³¨æ„å…¶ä»–masterç»„ä»¶æ—¥å¿—çº§åˆ«ï¼Œä¸è¦æ‰“å°å¤§é‡æ—¥å¿—","user_name":"ä½œè€…å›å¤","comment_id":302603,"uid":"1009582","ip_address":"","utype":1,"ctime":1627367161,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"5921244440","product_id":100069901,"comment_content":"kubeadméƒ¨ç½²å †å çš„ï¼Œæ¯ä¸ªnodeæœ‰etcdå’Œmasterçš„ç»„ä»¶çš„æ–¹å¼å¯ä»¥å—ï¼Ÿæœºå™¨æ•°ä¸æ˜¯å¾ˆå¤š","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523360,"discussion_content":"é›†ç¾¤è§„æ¨¡å°ï¼Œå¯ä»¥çš„ï¼Œeventæœ€å¥½ç‹¬ç«‹ä¸‹ï¼Œæ³¨æ„å…¶ä»–masterç»„ä»¶æ—¥å¿—çº§åˆ«ï¼Œä¸è¦æ‰“å°å¤§é‡æ—¥å¿—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627367161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355474,"user_name":"hifine","can_delete":false,"product_type":"c1","uid":1565512,"ip_address":"å¹¿ä¸œ","ucode":"6DE85B30EF8DA0","user_header":"https://static001.geekbang.org/account/avatar/00/17/e3/48/510fd23d.jpg","comment_is_top":false,"comment_ctime":1661413358,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661413358","product_id":100069901,"comment_content":"è€å¸ˆï¼Œæœ‰ç©ºéº»çƒ¦å›ä¸€ä¸‹ï¼Œæˆ‘ç½‘ä¸Šæ‰¾äº†å¥½ä¹…å…³äº learner çš„è¯´æ˜ï¼ŒåŒ…æ‹¬å®˜ç½‘ï¼Œéƒ½æ²¡æœ‰ç›¸å…³æ“ä½œçš„èµ„æ–™ã€‚<br>é—®é¢˜æ˜¯è¿™æ ·ï¼š<br>æˆ‘ä»¬æœ‰ Aå’ŒBä¸¤ä¸ªåŒºï¼ŒA éƒ¨ç½²3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼ŒBåŒºä½¿ç”¨ä¸€ä¸ª learner åšç¾å¤‡ï¼Œè¯·é—®å¦‚æœAåŒºå…¨éƒ¨æ•…éšœäº†ï¼Œæˆ‘è¿™ä¸ª learner è¯¥æ€ä¹ˆæ“ä½œï¼Ÿ<br><br>æˆ‘é’ˆå¯¹ learner æ“ä½œä¸€ç›´æç¤º rpc not supported for learner é”™è¯¯ï¼š<br><br>ETCDCTL_API=3 .&#47;etcdctl --endpoints=172.168.111.129:62379 member promote ebcec9c01f280618       <br>{&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2022-08-25T14:31:06.673+0800&quot;,&quot;caller&quot;:&quot;clientv3&#47;retry_interceptor.go:62&quot;,&quot;msg&quot;:&quot;retrying of unary invoker failed&quot;,&quot;target&quot;:&quot;endpoint:&#47;&#47;client-3c29945a-de04-4bec-9ad3-48c50f3fd135&#47;172.168.111.129:62379&quot;,&quot;attempt&quot;:0,&quot;error&quot;:&quot;rpc error: code = Unavailable desc = etcdserver: rpc not supported for learner&quot;}<br>Error: etcdserver: rpc not supported for learner","like_count":0},{"had_liked":false,"id":355468,"user_name":"hifine","can_delete":false,"product_type":"c1","uid":1565512,"ip_address":"å¹¿ä¸œ","ucode":"6DE85B30EF8DA0","user_header":"https://static001.geekbang.org/account/avatar/00/17/e3/48/510fd23d.jpg","comment_is_top":false,"comment_ctime":1661409094,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661409094","product_id":100069901,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·é—®Aå’ŒBè·¨åŒºï¼ŒBåŒºéƒ¨ç½²learner, AåŒºæ•…éšœæ—¶ï¼Œlearnerè¯¥å¦‚ä½•æ“ä½œï¼Œç½‘ä¸Šèµ„æ–™å¤ªå°‘äº†ï¼Œæœè¾¹äº†éƒ½æ²¡æ‰¾åˆ°ï¼Œæˆ‘æ“ä½œlearnerä¸€ç›´æç¤º rpc not supported for learner","like_count":0},{"had_liked":false,"id":318434,"user_name":"Geek_edd932","can_delete":false,"product_type":"c1","uid":2364381,"ip_address":"","ucode":"50BB32FBF32648","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1pMbwZrAl5g8ZRC5SOlz9VQOVRGN5V1rFNwsmEehicGzxMRicGj330jNfwTE1MRLaZTdSvX8R2YJVEh8DrYnMVAQ/132","comment_is_top":false,"comment_ctime":1635299065,"is_pvip":false,"replies":[{"id":"115643","content":"ç›®å‰è¿˜æ²¡å¼€æºï¼Œåé¢è…¾è®¯äº‘ä¼šæä¾›etcdè·¨åŸå¤åˆ¶èƒ½åŠ›ã€‚","user_name":"ä½œè€…å›å¤","comment_id":318434,"uid":"1009582","ip_address":"","utype":1,"ctime":1635577235,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"1635299065","product_id":100069901,"comment_content":"å”è€å¸ˆï¼Œæˆ‘çœ‹äº†æ‚¨ä¸Šæ¬¡å‘ç»™æˆ‘çš„æ–—é±¼æ–‡ç« ï¼Œé‡Œé¢æåˆ°äº†è…¾è®¯äº‘etcdé›†ç¾¤åŒæ­¥å·¥å…·etcd-syncerï¼Œè¿™ä¸ªå·¥å…·æ˜¯å¼€æºçš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529239,"discussion_content":"ç›®å‰è¿˜æ²¡å¼€æºï¼Œåé¢è…¾è®¯äº‘ä¼šæä¾›etcdè·¨åŸå¤åˆ¶èƒ½åŠ›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635577235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306425,"user_name":"lidabai","can_delete":false,"product_type":"c1","uid":2677124,"ip_address":"","ucode":"BACB3430064469","user_header":"https://static001.geekbang.org/account/avatar/00/28/d9/84/9b03cd04.jpg","comment_is_top":false,"comment_ctime":1628559834,"is_pvip":false,"replies":[{"id":"112711","content":"etcdæ˜¯k8sé›†ç¾¤æ ¸å¿ƒæ§åˆ¶ç»„ä»¶,éƒ¨ç½²å…¶ä»–æ§åˆ¶ç»„ä»¶æ—¶å…ˆéƒ¨ç½²etcd,å¯ä»¥å‚è€ƒä¸‹k8sè¿™ä¸ªæ–‡æ¡£ https:&#47;&#47;kubernetes.io&#47;docs&#47;setup&#47;production-environment&#47;tools&#47;kubeadm&#47;setup-ha-etcd-with-kubeadm&#47;","user_name":"ä½œè€…å›å¤","comment_id":306425,"uid":"1009582","ip_address":"","utype":1,"ctime":1631057319,"user_name_real":"å”èª"}],"discussion_count":1,"race_medal":0,"score":"1628559834","product_id":100069901,"comment_content":"ç”¨kubeadmçš„æ–¹å¼éƒ¨ç½²etcdï¼Œæ˜¯å…ˆéƒ¨ç½²kubernetesé›†ç¾¤è¿˜æ˜¯å…ˆéƒ¨ç½²etcdï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524758,"discussion_content":"etcdæ˜¯k8sé›†ç¾¤æ ¸å¿ƒæ§åˆ¶ç»„ä»¶,éƒ¨ç½²å…¶ä»–æ§åˆ¶ç»„ä»¶æ—¶å…ˆéƒ¨ç½²etcd,å¯ä»¥å‚è€ƒä¸‹k8sè¿™ä¸ªæ–‡æ¡£ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/setup-ha-etcd-with-kubeadm/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631057319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285765,"user_name":"Magic Star Trace","can_delete":false,"product_type":"c1","uid":1297017,"ip_address":"","ucode":"15360D39BC32D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/79/139615aa.jpg","comment_is_top":false,"comment_ctime":1617005975,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617005975","product_id":100069901,"comment_content":"æˆ‘ä»¬çº¿ä¸Š etcd  æ˜¯ç”¨è™šæ‹Ÿæœºéƒ¨ç½²çš„ï¼Œæ²¡æœ‰åœ¨k8sé›†ç¾¤å†… èƒ½å¦å°†errorçº§åˆ«çš„æ—¥å¿— é‡å®šå‘åˆ°å…¶ä»–ç›®å½•å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":284030,"user_name":"Geek_daf51a","can_delete":false,"product_type":"c1","uid":2436607,"ip_address":"","ucode":"6FDC93EA6D6369","user_header":"","comment_is_top":false,"comment_ctime":1616045152,"is_pvip":false,"replies":[{"id":"103048","content":"å—¯ï¼Œåšå¥½å¤‡ä»½å·¥ä½œ","user_name":"ä½œè€…å›å¤","comment_id":284030,"uid":"1009582","ip_address":"","utype":1,"ctime":1616079729,"user_name_real":"å”èª"}],"discussion_count":3,"race_medal":0,"score":"1616045152","product_id":100069901,"comment_content":"è€å¸ˆæˆ‘ä»¬ç›®å‰æ˜¯é€šè¿‡bitnamiæä¾›etcd helmæ¥éƒ¨ç½²çš„ï¼Œä¸æ¨èç­‰ä¸šåŠ¡ä½¿ç”¨","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517209,"discussion_content":"å—¯ï¼Œåšå¥½å¤‡ä»½å·¥ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616079729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2906780,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/5a/9c/2acefe8e.jpg","nickname":"æ©˜é¢‚","note":"","ucode":"6FC14544E26186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579184,"discussion_content":"å¯ä»¥æœ‰å¿\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657244225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2906780,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/5a/9c/2acefe8e.jpg","nickname":"æ©˜é¢‚","note":"","ucode":"6FC14544E26186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579183,"discussion_content":"æ‚¨å¥½ Geekï¼Œ bitnami æä¾›çš„etcd helméƒ¨ç½²æ–¹å¼value.yaml ä½ ä»¬æ˜¯æ€å‘¢ä¿®æ”¹çš„ï¼Œå…¬å¸åˆšå¼€å§‹åš ï¼Œæœ‰æ²¡æœ‰èµ„æ–™æä¾›ä¸‹å“‡ è°¢è°¢å’¯\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657244199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}