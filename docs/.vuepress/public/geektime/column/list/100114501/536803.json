{"id":536803,"title":"19ï½œDaemonsetï¼šå¿ å®å¯é çš„çœ‹é—¨ç‹—","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚</p><p>ä¸Šä¸€æ¬¡è¯¾é‡Œæˆ‘ä»¬å­¦ä¹ äº†Kubernetesé‡Œçš„ä¸€ä¸ªæ–°APIå¯¹è±¡Deploymentï¼Œå®ƒä»£è¡¨äº†åœ¨çº¿ä¸šåŠ¡ï¼Œèƒ½å¤Ÿç®¡ç†å¤šä¸ªPodå‰¯æœ¬ï¼Œè®©åº”ç”¨æ°¸è¿œåœ¨çº¿ï¼Œè¿˜èƒ½å¤Ÿä»»æ„æ‰©å®¹ç¼©å®¹ã€‚</p><p>è™½ç„¶Deploymentéå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿ç»´éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ‰€æœ‰éš¾é¢˜ã€‚å› ä¸ºå’Œç®€å•çš„ç¦»çº¿ä¸šåŠ¡æ¯”èµ·æ¥ï¼Œåœ¨çº¿ä¸šåŠ¡çš„åº”ç”¨åœºæ™¯å¤ªå¤šå¤ªå¤æ‚ï¼ŒDeploymentçš„åŠŸèƒ½ç‰¹æ€§åªè¦†ç›–äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ— æ³•æ»¡è¶³å…¶ä»–åœºæ™¯çš„éœ€æ±‚ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦ä¸€ç±»ä»£è¡¨åœ¨çº¿ä¸šåŠ¡APIå¯¹è±¡ï¼š<strong>DaemonSet</strong>ï¼Œå®ƒä¼šåœ¨Kubernetesé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªPodï¼Œå°±å¥½åƒæ˜¯Linuxç³»ç»Ÿé‡Œçš„â€œå®ˆæŠ¤è¿›ç¨‹â€ï¼ˆDaemonï¼‰ã€‚</p><h2>ä¸ºä»€ä¹ˆè¦æœ‰DaemonSet</h2><p>æƒ³çŸ¥é“ä¸ºä»€ä¹ˆKubernetesä¼šå¼•å…¥DaemonSetå¯¹è±¡ï¼Œé‚£å°±å¾—çŸ¥é“Deploymentæœ‰å“ªäº›ä¸è¶³ã€‚</p><p>æˆ‘ä»¬å…ˆç®€å•å¤ä¹ ä¸€ä¸‹Deploymentï¼Œå®ƒèƒ½å¤Ÿåˆ›å»ºä»»æ„å¤šä¸ªçš„Podå®ä¾‹ï¼Œå¹¶ä¸”ç»´æŠ¤è¿™äº›Podçš„æ­£å¸¸è¿è¡Œï¼Œä¿è¯åº”ç”¨å§‹ç»ˆå¤„äºå¯ç”¨çŠ¶æ€ã€‚</p><p>ä½†æ˜¯ï¼ŒDeploymentå¹¶ä¸å…³å¿ƒè¿™äº›Podä¼šåœ¨é›†ç¾¤çš„å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œ<strong>åœ¨å®ƒçœ‹æ¥ï¼ŒPodçš„è¿è¡Œç¯å¢ƒä¸åŠŸèƒ½æ˜¯æ— å…³çš„ï¼Œåªè¦Podçš„æ•°é‡è¶³å¤Ÿï¼Œåº”ç”¨ç¨‹åºåº”è¯¥ä¼šæ­£å¸¸å·¥ä½œ</strong>ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸ªå‡è®¾å¯¹äºå¤§å¤šæ•°ä¸šåŠ¡æ¥è¯´æ˜¯æ²¡é—®é¢˜çš„ï¼Œæ¯”å¦‚Nginxã€WordPressã€MySQLï¼Œå®ƒä»¬ä¸éœ€è¦çŸ¥é“é›†ç¾¤ã€èŠ‚ç‚¹çš„ç»†èŠ‚ä¿¡æ¯ï¼Œåªè¦é…ç½®å¥½ç¯å¢ƒå˜é‡å’Œå­˜å‚¨å·ï¼Œåœ¨å“ªé‡Œâ€œè·‘â€éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€äº›ä¸šåŠ¡æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä»¬ä¸æ˜¯å®Œå…¨ç‹¬ç«‹äºç³»ç»Ÿè¿è¡Œçš„ï¼Œè€Œæ˜¯ä¸ä¸»æœºå­˜åœ¨â€œç»‘å®šâ€å…³ç³»ï¼Œå¿…é¡»è¦ä¾é™„äºèŠ‚ç‚¹æ‰èƒ½äº§ç”Ÿä»·å€¼ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul>\n<li>ç½‘ç»œåº”ç”¨ï¼ˆå¦‚kube-proxyï¼‰ï¼Œå¿…é¡»æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªPodï¼Œå¦åˆ™èŠ‚ç‚¹å°±æ— æ³•åŠ å…¥Kubernetesç½‘ç»œã€‚</li>\n<li>ç›‘æ§åº”ç”¨ï¼ˆå¦‚Prometheusï¼‰ï¼Œå¿…é¡»æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªPodç”¨æ¥ç›‘æ§èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå®æ—¶ä¸ŠæŠ¥ä¿¡æ¯ã€‚</li>\n<li>æ—¥å¿—åº”ç”¨ï¼ˆå¦‚Fluentdï¼‰ï¼Œå¿…é¡»åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªPodï¼Œæ‰èƒ½å¤Ÿæœé›†å®¹å™¨è¿è¡Œæ—¶äº§ç”Ÿçš„æ—¥å¿—æ•°æ®ã€‚</li>\n<li>å®‰å…¨åº”ç”¨ï¼ŒåŒæ ·çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æœ‰ä¸€ä¸ªPodæ¥æ‰§è¡Œå®‰å…¨å®¡è®¡ã€å…¥ä¾µæ£€æŸ¥ã€æ¼æ´æ‰«æç­‰å·¥ä½œã€‚</li>\n</ul><p>è¿™äº›ä¸šåŠ¡å¦‚æœç”¨Deploymentæ¥éƒ¨ç½²å°±ä¸å¤ªåˆé€‚äº†ï¼Œå› ä¸ºDeploymentæ‰€ç®¡ç†çš„Podæ•°é‡æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”å¯èƒ½ä¼šåœ¨é›†ç¾¤é‡Œâ€œæ¼‚ç§»â€ï¼Œä½†ï¼Œå®é™…çš„éœ€æ±‚å´æ˜¯è¦åœ¨é›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡ŒPodï¼Œä¹Ÿå°±æ˜¯è¯´Podçš„æ•°é‡ä¸èŠ‚ç‚¹æ•°é‡ä¿æŒåŒæ­¥ã€‚</p><p>æ‰€ä»¥ï¼ŒKuberneteså°±å®šä¹‰äº†æ–°çš„APIå¯¹è±¡DaemonSetï¼Œå®ƒåœ¨å½¢å¼ä¸Šå’ŒDeploymentç±»ä¼¼ï¼Œéƒ½æ˜¯ç®¡ç†æ§åˆ¶Podï¼Œä½†ç®¡ç†è°ƒåº¦ç­–ç•¥å´ä¸åŒã€‚DaemonSetçš„ç›®æ ‡æ˜¯åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªPodï¼Œå°±å¥½åƒæ˜¯ä¸ºèŠ‚ç‚¹é…ä¸Šä¸€åªâ€œçœ‹é—¨ç‹—â€ï¼Œå¿ å®åœ°â€œå®ˆæŠ¤â€ç€èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯DaemonSetåå­—çš„ç”±æ¥ã€‚</p><h2>å¦‚ä½•ä½¿ç”¨YAMLæè¿°DaemonSet</h2><p>DaemonSetå’ŒDeploymentéƒ½å±äºåœ¨çº¿ä¸šåŠ¡ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿéƒ½æ˜¯â€œappsâ€ç»„ï¼Œä½¿ç”¨å‘½ä»¤  <code>kubectl api-resources</code>  å¯ä»¥çŸ¥é“å®ƒçš„ç®€ç§°æ˜¯ <code>ds</code> ï¼ŒYAMLæ–‡ä»¶å¤´ä¿¡æ¯åº”è¯¥æ˜¯ï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n&nbsp; name: xxx-ds\n</code></pre><p>ä¸è¿‡éå¸¸å¥‡æ€ªï¼ŒKubernetesä¸æä¾›è‡ªåŠ¨åˆ›å»ºDaemonSet YAMLæ ·æ¿çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨å‘½ä»¤  <code>kubectl create</code> ç›´æ¥åˆ›å»ºå‡ºä¸€ä¸ªDaemonSetå¯¹è±¡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/7f/99b434fc4089ce23a7e54ed8b857a27f.png?wh=1190x304\" alt=\"å›¾ç‰‡\"></p><p>è¿™ä¸ªç¼ºç‚¹å¯¹äºæˆ‘ä»¬ä½¿ç”¨DaemonSetçš„ç¡®é€ æˆäº†ä¸å°çš„éº»çƒ¦ï¼Œæ¯•ç«Ÿå¦‚æœç”¨ <code>kubectl explain</code> ä¸€ä¸ªä¸ªåœ°å»æŸ¥å­—æ®µå†å»å†™YAMLå®åœ¨æ˜¯å¤ªè¾›è‹¦äº†ã€‚</p><p>ä¸è¿‡ï¼ŒKubernetesä¸ç»™æˆ‘ä»¬ç”Ÿæˆæ ·æ¿æ–‡ä»¶çš„æœºä¼šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»â€œæŠ„â€ã€‚ä½ å¯ä»¥åœ¨Kubernetesçš„å®˜ç½‘ï¼ˆ<a href=\"https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/\">https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/</a>ï¼‰ä¸Šæ‰¾åˆ°ä¸€ä»½DaemonSetçš„YAMLç¤ºä¾‹ï¼ŒæŠŠå®ƒæ‹·è´ä¸‹æ¥ï¼Œå†å»æ‰å¤šä½™çš„éƒ¨åˆ†ï¼Œå°±å¯ä»¥åšæˆè‡ªå·±çš„ä¸€ä»½æ ·æ¿æ–‡ä»¶ï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢çš„è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n&nbsp; name: redis-ds\n&nbsp; labels:\n&nbsp; &nbsp; app: redis-ds\n\nspec:\n&nbsp; selector:\n&nbsp; &nbsp; matchLabels:\n&nbsp; &nbsp; &nbsp; name: redis-ds\n\n&nbsp; template:\n&nbsp; &nbsp; metadata:\n&nbsp; &nbsp; &nbsp; labels:\n&nbsp; &nbsp; &nbsp; &nbsp; name: redis-ds\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; containers:\n&nbsp; &nbsp; &nbsp; - image: redis:5-alpine\n&nbsp; &nbsp; &nbsp; &nbsp; name: redis\n&nbsp; &nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; &nbsp; - containerPort: 6379\n</code></pre><p>è¿™ä¸ªDaemonSetå¯¹è±¡çš„åå­—æ˜¯ <code>redis-ds</code>ï¼Œé•œåƒæ˜¯ <code>redis:5-alpine</code>ï¼Œä½¿ç”¨äº†æµè¡Œçš„NoSQLæ•°æ®åº“Redisï¼ˆä½ ä¹Ÿè®¸å¯¹å®ƒå¾ˆç†Ÿæ‚‰ï¼‰ã€‚</p><p>æŠŠè¿™ä»½YAMLå’Œä¸ŠèŠ‚è¯¾é‡Œçš„Deploymentå¯¹è±¡ç®€å•å¯¹æ¯”ä¸€ä¸‹ï¼Œä½ ä¼šå‘ç°ï¼š</p><p>å‰é¢çš„ <code>kind</code>ã€<code>metadata</code> æ˜¯å¯¹è±¡ç‹¬æœ‰çš„ä¿¡æ¯ï¼Œè‡ªç„¶æ˜¯ä¸åŒçš„ï¼Œä½†ä¸‹é¢çš„ <code>spec</code> éƒ¨åˆ†ï¼ŒDaemonSetä¹Ÿæœ‰ <code>selector</code> å­—æ®µï¼ŒåŒ¹é… <code>template</code> é‡ŒPodçš„ <code>labels</code> æ ‡ç­¾ï¼Œå’ŒDeploymentå¯¹è±¡å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>å†ä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°ï¼ŒDaemonSetåœ¨ <code>spec</code> é‡Œæ²¡æœ‰ <code>replicas</code> å­—æ®µï¼Œè¿™æ˜¯å®ƒä¸Deploymentçš„ä¸€ä¸ªå…³é”®ä¸åŒç‚¹ï¼Œæ„å‘³ç€å®ƒä¸ä¼šåœ¨é›†ç¾¤é‡Œåˆ›å»ºå¤šä¸ªPodå‰¯æœ¬ï¼Œè€Œæ˜¯è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªåˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒDaemonSetä»…ä»…æ˜¯åœ¨Podçš„éƒ¨ç½²è°ƒåº¦ç­–ç•¥ä¸Šå’ŒDeploymentä¸åŒï¼Œå…¶ä»–çš„éƒ½æ˜¯ç›¸åŒçš„ï¼ŒæŸç§ç¨‹åº¦ä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠDaemonSetçœ‹åšæ˜¯Deploymentçš„ä¸€ä¸ªç‰¹ä¾‹ã€‚</p><p>æˆ‘è¿˜æ˜¯æŠŠYAMLæè¿°æ–‡ä»¶ç”»äº†ä¸€å¼ å›¾ï¼Œå¥½è®©ä½ çœ‹æ¸…æ¥šä¸Deploymentçš„å·®å¼‚ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/1c/c1dee411aa02f4ff2b8caaf0bd627a1c.jpg?wh=1920x1173\" alt=\"å›¾ç‰‡\"></p><p>äº†è§£åˆ°è¿™äº›åŒºåˆ«ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å˜é€šçš„æ–¹æ³•æ¥åˆ›å»ºDaemonSetçš„YAMLæ ·æ¿äº†ï¼Œä½ åªéœ€è¦ç”¨ <code>kubectl create</code> å…ˆåˆ›å»ºå‡ºä¸€ä¸ªDeploymentå¯¹è±¡ï¼Œç„¶åæŠŠ <code>kind</code> æ”¹æˆ <code>DaemonSet</code>ï¼Œå†åˆ é™¤ <code>spec.replicas</code> å°±è¡Œäº†ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-bash\">export out=\"--dry-run=client -o yaml\"\n\n# change \"kind\" to DaemonSet\nkubectl create deploy redis-ds --image=redis:5-alpine $out\n</code></pre><h2>å¦‚ä½•åœ¨Kubernetesé‡Œä½¿ç”¨DaemonSet</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ <code>kubectl apply</code>ï¼ŒæŠŠYAMLå‘é€ç»™Kubernetesï¼Œè®©å®ƒåˆ›å»ºDaemonSetå¯¹è±¡ï¼Œå†ç”¨ <code>kubectl get</code> æŸ¥çœ‹å¯¹è±¡çš„çŠ¶æ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/43/f3/4349f1f2aed7f4ffac017ee6064059f3.png?wh=1884x486\" alt=\"å›¾ç‰‡\"></p><p>çœ‹è¿™å¼ æˆªå›¾ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šDaemonSeté‡ŒPodè¦è¿è¡Œçš„æ•°é‡ï¼Œä½†å®ƒè‡ªå·±å°±ä¼šå»æŸ¥æ‰¾é›†ç¾¤é‡Œçš„èŠ‚ç‚¹ï¼Œåœ¨èŠ‚ç‚¹é‡Œåˆ›å»ºPodã€‚å› ä¸ºæˆ‘ä»¬çš„å®éªŒç¯å¢ƒé‡Œæœ‰ä¸€ä¸ªMasterä¸€ä¸ªWorkerï¼Œè€ŒMasteré»˜è®¤æ˜¯ä¸è·‘åº”ç”¨çš„ï¼Œæ‰€ä»¥DaemonSetå°±åªç”Ÿæˆäº†ä¸€ä¸ªPodï¼Œè¿è¡Œåœ¨äº†â€œworkerâ€èŠ‚ç‚¹ä¸Šã€‚</p><p>æš‚åœä¸€ä¸‹ï¼Œä½ å‘ç°è¿™é‡Œæœ‰ä»€ä¹ˆä¸å¯¹åŠ²äº†å—ï¼Ÿ</p><p>æŒ‰ç…§DaemonSetçš„æœ¬æ„ï¼Œåº”è¯¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªPodå®ä¾‹æ‰å¯¹ï¼Œä½†MasterèŠ‚ç‚¹å´è¢«æ’é™¤åœ¨å¤–äº†ï¼Œè¿™å°±ä¸ç¬¦åˆæˆ‘ä»¬å½“åˆçš„è®¾æƒ³äº†ã€‚</p><p>æ˜¾ç„¶ï¼ŒDaemonSetæ²¡æœ‰å°½åˆ°â€œçœ‹é—¨â€çš„èŒè´£ï¼Œå®ƒçš„è®¾è®¡ä¸Kubernetesé›†ç¾¤çš„å·¥ä½œæœºåˆ¶å‘ç”Ÿäº†å†²çªï¼Œæœ‰æ²¡æœ‰åŠæ³•è§£å†³å‘¢ï¼Ÿ</p><p>å½“ç„¶ï¼ŒKubernetesæ—©å°±æƒ³åˆ°äº†è¿™ç‚¹ï¼Œä¸ºäº†åº”å¯¹Podåœ¨æŸäº›èŠ‚ç‚¹çš„â€œè°ƒåº¦â€å’Œâ€œé©±é€â€é—®é¢˜ï¼Œå®ƒå®šä¹‰äº†ä¸¤ä¸ªæ–°çš„æ¦‚å¿µï¼š<strong>æ±¡ç‚¹</strong>ï¼ˆtaintï¼‰å’Œ<strong>å®¹å¿åº¦</strong>ï¼ˆtolerationï¼‰ã€‚</p><h2>ä»€ä¹ˆæ˜¯æ±¡ç‚¹ï¼ˆtaintï¼‰å’Œå®¹å¿åº¦ï¼ˆtolerationï¼‰</h2><p>â€œæ±¡ç‚¹â€æ˜¯KubernetesèŠ‚ç‚¹çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒçš„ä½œç”¨ä¹Ÿæ˜¯ç»™èŠ‚ç‚¹â€œè´´æ ‡ç­¾â€ï¼Œä½†ä¸ºäº†ä¸å’Œå·²æœ‰çš„ <code>labels</code> å­—æ®µæ··æ·†ï¼Œå°±æ”¹æˆäº† <code>taint</code>ã€‚</p><p>å’Œâ€œæ±¡ç‚¹â€ç›¸å¯¹çš„ï¼Œå°±æ˜¯Podçš„â€œå®¹å¿åº¦â€ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯Podèƒ½å¦â€œå®¹å¿â€æ±¡ç‚¹ã€‚</p><p>æˆ‘ä»¬æŠŠå®ƒä¿©æ”¾åœ¨ä¸€èµ·å°±æ¯”è¾ƒå¥½ç†è§£äº†ã€‚é›†ç¾¤é‡Œçš„èŠ‚ç‚¹å„å¼å„æ ·ï¼Œæœ‰çš„èŠ‚ç‚¹â€œçº¯æ´æ— ç‘•â€ï¼Œæ²¡æœ‰â€œæ±¡ç‚¹â€ï¼›è€Œæœ‰çš„èŠ‚ç‚¹å› ä¸ºæŸç§åŸå› ç²˜ä¸Šäº†â€œæ³¥å·´â€ï¼Œä¹Ÿå°±æœ‰äº†â€œæ±¡ç‚¹â€ã€‚Podä¹Ÿè„¾æ°”å„å¼‚ï¼Œæœ‰çš„â€œæ´ç™–â€å¾ˆä¸¥é‡ï¼Œä¸èƒ½å®¹å¿â€œæ±¡ç‚¹â€ï¼Œåªèƒ½æŒ‘é€‰â€œå¹²å‡€â€çš„èŠ‚ç‚¹ï¼›è€Œæœ‰çš„Podåˆ™æ¯”è¾ƒâ€œå¤§å¤§å’§å’§â€ï¼Œè¦æ±‚ä¸é‚£ä¹ˆé«˜ï¼Œå¯ä»¥é€‚å½“åœ°å®¹å¿ä¸€äº›å°â€œæ±¡ç‚¹â€ã€‚</p><p>è¿™ä¹ˆçœ‹æ¥ï¼Œâ€œæ±¡ç‚¹â€å’Œâ€œå®¹å¿åº¦â€å€’æ˜¯æœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªâ€œç›¸äº²â€çš„è¿‡ç¨‹ã€‚Podå°±æ˜¯ä¸€ä¸ªæŒ‘å‰”çš„â€œç”²æ–¹â€ï¼Œè€Œâ€œä¹™æ–¹â€å°±æ˜¯é›†ç¾¤é‡Œçš„å„ä¸ªèŠ‚ç‚¹ï¼ŒPodä¼šæ ¹æ®è‡ªå·±å¯¹â€œæ±¡ç‚¹â€çš„â€œå®¹å¿ç¨‹åº¦â€æ¥é€‰æ‹©åˆé€‚çš„ç›®æ ‡ï¼Œæ¯”å¦‚è¦æ±‚â€œä¸æŠ½çƒŸä¸å–é…’â€ï¼Œä½†å¯ä»¥â€œæ— è½¦æ— æˆ¿â€ï¼Œæœ€ç»ˆå†³å®šåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šâ€œè½æˆ·â€ã€‚</p><p>Kubernetesåœ¨åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ä¼šè‡ªåŠ¨ç»™èŠ‚ç‚¹NodeåŠ ä¸Šä¸€äº›â€œæ±¡ç‚¹â€ï¼Œæ–¹ä¾¿Podçš„è°ƒåº¦å’Œéƒ¨ç½²ã€‚<strong>ä½ å¯ä»¥ç”¨ <code>kubectl describe node</code> æ¥æŸ¥çœ‹Masterå’ŒWorkerçš„çŠ¶æ€</strong>ï¼š</p><pre><code class=\"language-bash\">kubectl describe node master\n\nName:&nbsp; &nbsp; &nbsp;master\nRoles:&nbsp; &nbsp; control-plane,master\n...\nTaints:&nbsp; &nbsp;node-role.kubernetes.io/master:NoSchedule\n...\n\nkubectl describe node worker\n\nName:&nbsp; &nbsp; &nbsp;worker\nRoles:&nbsp; &nbsp; &lt;none&gt;\n...\nTaints:&nbsp; &nbsp;&lt;none&gt;\n...\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒMasterèŠ‚ç‚¹é»˜è®¤æœ‰ä¸€ä¸ª <code>taint</code>ï¼Œåå­—æ˜¯ <code>node-role.kubernetes.io/master</code>ï¼Œå®ƒçš„æ•ˆæœæ˜¯ <code>NoSchedule</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ±¡ç‚¹ä¼šæ‹’ç»Podè°ƒåº¦åˆ°æœ¬èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè€ŒWorkerèŠ‚ç‚¹çš„ <code>taint</code> å­—æ®µåˆ™æ˜¯ç©ºçš„ã€‚</p><p>è¿™æ­£æ˜¯Masterå’ŒWorkeråœ¨Podè°ƒåº¦ç­–ç•¥ä¸Šçš„åŒºåˆ«æ‰€åœ¨ï¼Œé€šå¸¸æ¥è¯´Podéƒ½ä¸èƒ½å®¹å¿ä»»ä½•â€œæ±¡ç‚¹â€ï¼Œæ‰€ä»¥åŠ ä¸Šäº† <code>taint</code> å±æ€§çš„MasterèŠ‚ç‚¹ä¹Ÿå°±ä¼šæ— ç¼˜Podäº†ã€‚</p><p>æ˜ç™½äº†â€œæ±¡ç‚¹â€å’Œâ€œå®¹å¿åº¦â€çš„æ¦‚å¿µï¼Œä½ å°±çŸ¥é“è¯¥æ€ä¹ˆè®©DaemonSetåœ¨MasterèŠ‚ç‚¹ï¼ˆæˆ–è€…ä»»æ„å…¶ä»–èŠ‚ç‚¹ï¼‰ä¸Šè¿è¡Œäº†ï¼Œæ–¹æ³•æœ‰ä¸¤ç§ã€‚</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•</strong>æ˜¯å»æ‰MasterèŠ‚ç‚¹ä¸Šçš„ <code>taint</code>ï¼Œè®©Masterå˜å¾—å’ŒWorkerä¸€æ ·â€œçº¯æ´æ— ç‘•â€ï¼ŒDaemonSetè‡ªç„¶å°±ä¸éœ€è¦å†åŒºåˆ†Master/Workerã€‚</p><p>æ“ä½œNodeä¸Šçš„â€œæ±¡ç‚¹â€å±æ€§éœ€è¦ä½¿ç”¨å‘½ä»¤ <code>kubectl taint</code>ï¼Œç„¶åæŒ‡å®šèŠ‚ç‚¹åã€æ±¡ç‚¹åå’Œæ±¡ç‚¹çš„æ•ˆæœï¼Œå»æ‰æ±¡ç‚¹è¦é¢å¤–åŠ ä¸Šä¸€ä¸ª <code>-</code>ã€‚</p><p>æ¯”å¦‚è¦å»æ‰MasterèŠ‚ç‚¹çš„â€œNoScheduleâ€æ•ˆæœï¼Œå°±è¦ç”¨è¿™æ¡å‘½ä»¤ï¼š</p><pre><code class=\"language-plain\">kubectl taint node master node-role.kubernetes.io/master:NoSchedule-\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/e8/0e/e8e877c960e43a407ab0d95963de400e.png?wh=1920x103\" alt=\"å›¾ç‰‡\"></p><p>å› ä¸ºDaemonSetä¸€ç›´åœ¨ç›‘æ§é›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå‘½ä»¤æ‰§è¡ŒåMasterèŠ‚ç‚¹å·²ç»æ²¡æœ‰äº†â€œæ±¡ç‚¹â€ï¼Œæ‰€ä»¥å®ƒç«‹åˆ»å°±ä¼šå‘ç°å˜åŒ–ï¼Œç„¶åå°±ä¼šåœ¨MasterèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªâ€œå®ˆæŠ¤â€Podã€‚ä½ å¯ä»¥ç”¨ <code>kubectl get</code> æ¥æŸ¥çœ‹è¿™ä¸ªå˜åŠ¨æƒ…å†µï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/44/37/4440c4f05dd7718c52152ef20fc77237.png?wh=1882x422\" alt=\"å›¾ç‰‡\"></p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¿®æ”¹çš„æ˜¯Nodeçš„çŠ¶æ€ï¼Œå½±å“é¢ä¼šæ¯”è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šPodéƒ½è·‘åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿ç•™Nodeçš„â€œæ±¡ç‚¹â€ï¼Œä¸ºéœ€è¦çš„Podæ·»åŠ â€œå®¹å¿åº¦â€ï¼Œåªè®©æŸäº›Podè¿è¡Œåœ¨ä¸ªåˆ«èŠ‚ç‚¹ä¸Šï¼Œå®ç°â€œç²¾ç»†åŒ–â€è°ƒåº¦ã€‚</p><p>è¿™å°±æ˜¯<strong>ç¬¬äºŒç§æ–¹æ³•</strong>ï¼Œä¸ºPodæ·»åŠ å­—æ®µ <code>tolerations</code>ï¼Œè®©å®ƒèƒ½å¤Ÿâ€œå®¹å¿â€æŸäº›â€œæ±¡ç‚¹â€ï¼Œå°±å¯ä»¥åœ¨ä»»æ„çš„èŠ‚ç‚¹ä¸Šè¿è¡Œäº†ã€‚</p><p><code>tolerations</code> æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å¯ä»¥åˆ—å‡ºå¤šä¸ªè¢«â€œå®¹å¿â€çš„â€œæ±¡ç‚¹â€ï¼Œéœ€è¦å†™æ¸…æ¥šâ€œæ±¡ç‚¹â€çš„åå­—ã€æ•ˆæœã€‚æ¯”è¾ƒç‰¹åˆ«æ˜¯è¦ç”¨ <code>operator</code> å­—æ®µæŒ‡å®šå¦‚ä½•åŒ¹é…â€œæ±¡ç‚¹â€ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä½¿ç”¨ <code>Exists</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å­˜åœ¨è¿™ä¸ªåå­—å’Œæ•ˆæœçš„â€œæ±¡ç‚¹â€ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³è®©DaemonSeté‡Œçš„Podèƒ½å¤Ÿåœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå°±è¦å†™å‡ºè¿™æ ·çš„ä¸€ä¸ª <code>tolerations</code>ï¼Œå®¹å¿èŠ‚ç‚¹çš„ <code>node-role.kubernetes.io/master:NoSchedule</code> è¿™ä¸ªæ±¡ç‚¹ï¼š</p><pre><code class=\"language-plain\">tolerations:\n- key: node-role.kubernetes.io/master\n&nbsp; effect: NoSchedule\n&nbsp; operator: Exists\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å…ˆç”¨ <code>kubectl taint</code> å‘½ä»¤æŠŠMasterçš„â€œæ±¡ç‚¹â€åŠ ä¸Šï¼š</p><pre><code class=\"language-plain\">kubectl taint node master node-role.kubernetes.io/master:NoSchedule\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/3e/c4/3eb49484fd460e53a40fb239298077c4.png?wh=1920x103\" alt=\"å›¾ç‰‡\"></p><p>ç„¶åæˆ‘ä»¬å†é‡æ–°éƒ¨ç½²åŠ ä¸Šäº†â€œå®¹å¿åº¦â€çš„DaemonSetï¼š</p><pre><code class=\"language-plain\">kubectl apply -f ds.yml\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/20/e8/2060a08c2b5572b71780c5f5dyyedae8.png?wh=1888x542\" alt=\"å›¾ç‰‡\"></p><p>ä½ å°±ä¼šçœ‹åˆ°DaemonSetä»ç„¶æœ‰ä¸¤ä¸ªPodï¼Œåˆ†åˆ«è¿è¡Œåœ¨Masterå’ŒWorkerèŠ‚ç‚¹ä¸Šï¼Œä¸ç¬¬ä¸€ç§æ–¹æ³•çš„æ•ˆæœç›¸åŒã€‚</p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œâ€œå®¹å¿åº¦â€å¹¶ä¸æ˜¯DaemonSetç‹¬æœ‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä»å±äºPodï¼Œæ‰€ä»¥ç†è§£äº†â€œæ±¡ç‚¹â€å’Œâ€œå®¹å¿åº¦â€ä¹‹åï¼Œä½ å¯ä»¥åœ¨Job/CronJobã€Deploymenté‡Œä¸ºå®ƒä»¬ç®¡ç†çš„Podä¹ŸåŠ ä¸Š <code>tolerations</code>ï¼Œä»è€Œèƒ½å¤Ÿæ›´çµæ´»åœ°è°ƒåº¦åº”ç”¨ã€‚</p><p>è‡³äºéƒ½æœ‰å“ªäº›æ±¡ç‚¹ã€æ±¡ç‚¹æœ‰å“ªäº›æ•ˆæœæˆ‘å°±ä¸ç»†è¯´äº†ï¼ŒKuberneteså®˜ç½‘æ–‡æ¡£ï¼ˆ<a href=\"https://kubernetes.io/zh/docs/concepts/scheduling-eviction/taint-and-toleration/\">https://kubernetes.io/zh/docs/concepts/scheduling-eviction/taint-and-toleration/</a>ï¼‰ä¸Šéƒ½åˆ—çš„éå¸¸æ¸…æ¥šï¼Œåœ¨ç†è§£äº†å·¥ä½œåŸç†ä¹‹åï¼Œç›¸ä¿¡ä½ è‡ªå·±å­¦èµ·æ¥ä¹Ÿä¸ä¼šå¤ªéš¾ã€‚</p><h2>ä»€ä¹ˆæ˜¯é™æ€Pod</h2><p>DaemonSetæ˜¯åœ¨Kubernetesé‡Œè¿è¡ŒèŠ‚ç‚¹ä¸“å±Podæœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œä½†å®ƒä¸æ˜¯å”¯ä¸€çš„æ–¹å¼ï¼ŒKubernetesè¿˜æ”¯æŒå¦å¤–ä¸€ç§å«â€œ<strong>é™æ€Pod</strong>â€çš„åº”ç”¨éƒ¨ç½²æ‰‹æ®µã€‚</p><p>â€œé™æ€Podâ€éå¸¸ç‰¹æ®Šï¼Œå®ƒä¸å—Kubernetesç³»ç»Ÿçš„ç®¡æ§ï¼Œä¸ä¸apiserverã€schedulerå‘ç”Ÿå…³ç³»ï¼Œæ‰€ä»¥æ˜¯â€œé™æ€â€çš„ã€‚</p><p>ä½†æ—¢ç„¶å®ƒæ˜¯Podï¼Œä¹Ÿå¿…ç„¶ä¼šâ€œè·‘â€åœ¨å®¹å™¨è¿è¡Œæ—¶ä¸Šï¼Œä¹Ÿä¼šæœ‰YAMLæ–‡ä»¶æ¥æè¿°å®ƒï¼Œè€Œå”¯ä¸€èƒ½å¤Ÿç®¡ç†å®ƒçš„Kubernetesç»„ä»¶ä¹Ÿå°±åªæœ‰åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„kubeletäº†ã€‚</p><p>â€œé™æ€Podâ€çš„YAMLæ–‡ä»¶é»˜è®¤éƒ½å­˜æ”¾åœ¨èŠ‚ç‚¹çš„ <code>/etc/kubernetes/manifests</code> ç›®å½•ä¸‹ï¼Œå®ƒæ˜¯Kubernetesçš„ä¸“ç”¨ç›®å½•ã€‚</p><p>ä¸‹é¢çš„è¿™å¼ æˆªå›¾å°±æ˜¯MasterèŠ‚ç‚¹é‡Œç›®å½•çš„æƒ…å†µï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/c2/f5477bf666beffcaf3b8663d5a5692c2.png?wh=1842x486\" alt=\"å›¾ç‰‡\"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒKubernetesçš„4ä¸ªæ ¸å¿ƒç»„ä»¶apiserverã€etcdã€schedulerã€controller-manageråŸæ¥éƒ½ä»¥é™æ€Podçš„å½¢å¼å­˜åœ¨çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬èƒ½å¤Ÿå…ˆäºKubernetesé›†ç¾¤å¯åŠ¨çš„åŸå› ã€‚</p><p>å¦‚æœä½ æœ‰ä¸€äº›DaemonSetæ— æ³•æ»¡è¶³çš„ç‰¹æ®Šçš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨é™æ€Podï¼Œç¼–å†™ä¸€ä¸ªYAMLæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•é‡Œï¼ŒèŠ‚ç‚¹çš„kubeletä¼šå®šæœŸæ£€æŸ¥ç›®å½•é‡Œçš„æ–‡ä»¶ï¼Œå‘ç°å˜åŒ–å°±ä¼šè°ƒç”¨å®¹å™¨è¿è¡Œæ—¶åˆ›å»ºæˆ–è€…åˆ é™¤é™æ€Podã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†Kubernetesé‡Œéƒ¨ç½²åº”ç”¨ç¨‹åºçš„å¦ä¸€ç§æ–¹å¼ï¼šDaemonSetï¼Œå®ƒä¸Deploymentå¾ˆç±»ä¼¼ï¼Œå·®åˆ«åªåœ¨äºPodçš„è°ƒåº¦ç­–ç•¥ï¼Œé€‚ç”¨äºåœ¨ç³»ç»Ÿé‡Œè¿è¡ŒèŠ‚ç‚¹çš„â€œå®ˆæŠ¤è¿›ç¨‹â€ã€‚</p><p>ç®€å•å°ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ï¼š</p><ol>\n<li>DaemonSetçš„ç›®æ ‡æ˜¯ä¸ºé›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹éƒ¨ç½²å”¯ä¸€çš„Podï¼Œå¸¸ç”¨äºç›‘æ§ã€æ—¥å¿—ç­‰ä¸šåŠ¡ã€‚</li>\n<li>DaemonSetçš„YAMLæè¿°ä¸Deploymentéå¸¸æ¥è¿‘ï¼Œåªæ˜¯æ²¡æœ‰ <code>replicas</code> å­—æ®µã€‚</li>\n<li>â€œæ±¡ç‚¹â€å’Œâ€œå®¹å¿åº¦â€æ˜¯ä¸DaemonSetç›¸å…³çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼Œåˆ†åˆ«ä»å±äºNodeå’ŒPodï¼Œå…±åŒå†³å®šäº†Podçš„è°ƒåº¦ç­–ç•¥ã€‚</li>\n<li>é™æ€Podä¹Ÿå¯ä»¥å®ç°å’ŒDaemonSetåŒæ ·çš„æ•ˆæœï¼Œä½†å®ƒä¸å—Kubernetesæ§åˆ¶ï¼Œå¿…é¡»åœ¨èŠ‚ç‚¹ä¸Šçº¯æ‰‹åŠ¨éƒ¨ç½²ï¼Œåº”å½“æ…ç”¨ã€‚</li>\n</ol><h2>è¯¾ä¸‹ä½œä¸š</h2><p>æœ€åæ˜¯è¯¾ä¸‹ä½œä¸šæ—¶é—´ï¼Œç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜ï¼š</p><ol>\n<li>ä½ è§‰å¾—DaemonSetå’ŒDeploymentåœ¨ç”¨æ³•ä¸Šè¿˜æœ‰å“ªäº›ä¸åŒï¼Ÿå®ƒä»¬åˆ†åˆ«é€‚ç”¨äºå“ªäº›åœºæ™¯ï¼Ÿ</li>\n<li>ä½ è§‰å¾—åœ¨Kubernetesé‡Œåº”è¯¥å¦‚ä½•ç”¨å¥½â€œæ±¡ç‚¹â€å’Œâ€œå®¹å¿åº¦â€è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Ÿ</li>\n</ol><p>æ¬¢è¿ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œå’Œå…¶ä»–åŒå­¦ä¸€èµ·å‚ä¸è®¨è®ºã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/64/2e/64760f80fbbda9dd72c14a37826c9d2e.jpg?wh=1920x2209\" alt=\"\"></p>","neighbors":{"left":{"article_title":"18ï½œDeploymentï¼šè®©åº”ç”¨æ°¸ä¸å®•æœº","id":535209},"right":{"article_title":"20ï½œServiceï¼šå¾®æœåŠ¡æ¶æ„çš„åº”å¯¹ä¹‹é“","id":536829}},"comments":[{"had_liked":false,"id":353605,"user_name":"é±¼","can_delete":false,"product_type":"c1","uid":1348942,"ip_address":"åŒ—äº¬","ucode":"2BE14674A1018F","user_header":"https://static001.geekbang.org/account/avatar/00/14/95/4e/1112248a.jpg","comment_is_top":false,"comment_ctime":1659597234,"is_pvip":false,"replies":[{"id":"128566","content":"å·²ç»è°ƒåº¦è¿‡ï¼Œè¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šçš„podå°±ä¸ä¼šå†å…³å¿ƒtaintäº†ï¼Œå› ä¸ºtaintåªåœ¨è°ƒåº¦çš„æ—¶å€™ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¯•éªŒä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659602305,"ip_address":"åŒ—äº¬","comment_id":353605,"utype":1}],"discussion_count":4,"race_medal":0,"score":"14544499122","product_id":100114501,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®é—®å¦‚æœç»™ä¸€ä¸ªnodeåŠ ä¸Šæ±¡ç‚¹ï¼Œé‚£ä¹ˆåœ¨ä¸Šé¢è¿è¡Œçš„ä¸èƒ½å®¹å¿è¯¥æ±¡ç‚¹çš„podä¼šè‡ªåŠ¨è·‘åˆ°å…¶ä»–nodeä¸Šå—ã€‚","like_count":4,"discussions":[{"author":{"id":2314854,"avatar":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","nickname":"includestdio.h","note":"","ucode":"5027BACE9319CD","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584240,"discussion_content":"å–å†³äº effect ï¼Œå¦‚æœé…ç½®ä¸º NoSchedule æˆ–è€… PreferNoSchedule åˆ™ä¸ä¼šå½±å“å·²ç»è°ƒåº¦å®Œæˆçš„ Pod ï¼Œå¦‚æœé…ç½®ä¸º NoExecute ï¼Œåˆ™å·²è¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šçš„ Pod ä¼šè¢«é©±é€","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1660703509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582700,"discussion_content":"å·²ç»è°ƒåº¦è¿‡ï¼Œè¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šçš„podå°±ä¸ä¼šå†å…³å¿ƒtaintäº†ï¼Œå› ä¸ºtaintåªåœ¨è°ƒåº¦çš„æ—¶å€™ç”Ÿæ•ˆï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¯•éªŒä¸€ä¸‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1659602305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1625530,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","nickname":"YueShi","note":"","ucode":"8F7AFAE4641A7D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582810,"discussion_content":"å‘ç°äº†ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼Œschedulerå¥½åƒä¸ä¼šæ£€æŸ¥è¿™ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659686106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582754,"discussion_content":"å¯ä»¥æ‰‹åŠ¨è°ƒåº¦å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659659302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354708,"user_name":"æœ±é›¯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"åŒ—äº¬","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1660705677,"is_pvip":true,"replies":[{"id":"129065","content":"<br>1.apply YAMLï¼ŒæŠŠå¯¹è±¡æäº¤åˆ°apiserverè°ƒåº¦å°±ä¼šå¼€å§‹ã€‚<br><br>2.ä¼šé‡æ–°è°ƒåº¦ï¼Œåšè¯•éªŒéªŒè¯ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1660777317,"ip_address":"åŒ—äº¬","comment_id":354708,"utype":1}],"discussion_count":4,"race_medal":0,"score":"5955672973","product_id":100114501,"comment_content":"è¯·é—®è€å¸ˆï¼Œè°ƒåº¦æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å‘¢ï¼Œæˆ‘æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªpodçš„nodeåŠ ä¸Šæ±¡ç‚¹ï¼Œæ­£å¸¸è¿è½¬çš„æƒ…å†µä½ åœ¨å›ç­”é‡Œè¯´ï¼Œä¸ä¼šè·‘åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œé‚£å‡å¦‚podæ­»äº¡ï¼Œä¼šé‡æ–°æ ¹æ®æ±¡ç‚¹æƒ…å†µè¿›è¡Œè°ƒåº¦å—ï¼Œè¿˜æ˜¯æŒ‰ç…§åŸå…ˆçš„ç­–ç•¥è¿›è¡Œè°ƒåº¦å‘¢","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584339,"discussion_content":"\n1.apply YAMLï¼ŒæŠŠå¯¹è±¡æäº¤åˆ°apiserverè°ƒåº¦å°±ä¼šå¼€å§‹ã€‚\n\n2.ä¼šé‡æ–°è°ƒåº¦ï¼Œåšè¯•éªŒéªŒè¯ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660777317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"æœ±é›¯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":584522,"discussion_content":"éªŒè¯è¿‡äº† ç¡®å®å¦‚æ­¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660891920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":584339,"ip_address":"ä¸­å›½é¦™æ¸¯"},"score":584522,"extra":""},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"æœ±é›¯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":590899,"discussion_content":"é‡æ–°è°ƒåº¦åï¼Œpodè·‘åˆ°å…¶ä»–èŠ‚ç‚¹äº†å—ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666159422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":584522,"ip_address":"å››å·"},"score":590899,"extra":""},{"author":{"id":1035744,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","nickname":"æœ±é›¯","note":"","ucode":"064C45FBF6B51F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":590982,"discussion_content":"æ˜¯çš„ è·‘åˆ°å¦å¤–ä¸€å°æ— æ±¡ç‚¹çš„æœºå™¨ä¸Šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666193839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":590899,"ip_address":"åŒ—äº¬"},"score":590982,"extra":""}]}]},{"had_liked":false,"id":354404,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"åŒ—äº¬","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1660361483,"is_pvip":true,"replies":[{"id":"128925","content":"å¯èƒ½æ˜¯æ–°ç‰ˆçš„flannelæ”¹äº†ï¼Œæ³¨æ„ä¸‹ç‰ˆæœ¬å·å§ï¼Œæˆ–è€…æ‰‹åŠ¨æ”¹ä¸€ä¸‹flannelçš„YAML ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1660437870,"ip_address":"åŒ—äº¬","comment_id":354404,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5955328779","product_id":100114501,"comment_content":"è€å¸ˆï¼Œkubectl get ds -n kube-system æ‰¾ä¸åˆ° Flannel ds ï¼ŒæŸ¥çœ‹äº† kube-flannel.yml ï¼Œå‘ç°åç©ºé—´å·²ç»æ”¹åˆ° kube-flannel ã€‚æ‰€ä»¥è¦ä½¿ç”¨ kubectl get ds -n kube-flannel æŸ¥çœ‹ç½‘ç»œæ’ä»¶ Flannel ã€‚","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583836,"discussion_content":"å¯èƒ½æ˜¯æ–°ç‰ˆçš„flannelæ”¹äº†ï¼Œæ³¨æ„ä¸‹ç‰ˆæœ¬å·å§ï¼Œæˆ–è€…æ‰‹åŠ¨æ”¹ä¸€ä¸‹flannelçš„YAML ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660437870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353963,"user_name":"éƒ‘æµ·æˆ","can_delete":false,"product_type":"c1","uid":1192616,"ip_address":"ä¸Šæµ·","ucode":"B0363EA4B2C646","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg","comment_is_top":false,"comment_ctime":1659957942,"is_pvip":true,"replies":[{"id":"128757","content":"great","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1660011756,"ip_address":"ä¸Šæµ·","comment_id":353963,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5954925238","product_id":100114501,"comment_content":"Q1ï¼š1.åŸç†ä¸Šdsç›´æ¥ownæ‰€é€‰æ‹©çš„podï¼Œdeployåˆ™æ˜¯ownåˆ›å»ºçš„rsï¼Œrs own podï¼›2.åŠŸèƒ½ä¸Šdeployæ”¯æŒåœ¨çº¿ä¸šåŠ¡éƒ¨ç½²åŠŸèƒ½æ›´å¤šï¼Œæ¯”å¦‚æ»šåŠ¨æ›´æ–°å’Œå›æ»šï¼Œå¿«é€Ÿæ‰©ç¼©å‰¯æœ¬ï¼Œdsåˆ™å‰¯æœ¬æ•°åŸºæœ¬å›ºå®šï¼›3.ä½¿ç”¨ä¸Šdså¤šç”¨åœ¨æä¾›å¹³å°ä¾§çš„èƒ½åŠ›ï¼Œdeployåˆ™å¤šç”¨åœ¨æä¾›ä¸šåŠ¡ä¾§èƒ½åŠ›ï¼Œå½“ç„¶å¹³å°ä¾§ä¹Ÿç”¨å¾—å¾ˆå¤š<br><br>Q2: taintå’Œtolerenceæ˜¯å’Œè°ƒåº¦ç›¸å…³çš„æ¦‚å¿µï¼Œè°ƒåº¦å™¨è°ƒåº¦podæ˜¯ä¼šè€ƒè™‘","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583279,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660011756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353554,"user_name":"Yangjing","can_delete":false,"product_type":"c1","uid":1018061,"ip_address":"ä¸Šæµ·","ucode":"D88DFD4958D07C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/cd/2c3808ce.jpg","comment_is_top":false,"comment_ctime":1659540855,"is_pvip":true,"replies":[{"id":"128555","content":"æ„Ÿè§‰ä¸é€‚åˆï¼Œå®ƒä¸åº”è¯¥æ˜¯å®ˆæŠ¤è¿›ç¨‹ç±»å‹çš„åº”ç”¨å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659579177,"ip_address":"ä¸Šæµ·","comment_id":353554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5954508151","product_id":100114501,"comment_content":"ç±»ä¼¼ Mysql çš„é€‚åˆéƒ¨ç½²åˆ°â€œé™æ€ Podâ€ä¸Šå—ï¼Ÿ ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582652,"discussion_content":"æ„Ÿè§‰ä¸é€‚åˆï¼Œå®ƒä¸åº”è¯¥æ˜¯å®ˆæŠ¤è¿›ç¨‹ç±»å‹çš„åº”ç”¨å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659579177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353484,"user_name":"Christopher","can_delete":false,"product_type":"c1","uid":1757265,"ip_address":"åŒ—äº¬","ucode":"1AC6035DFA4ECB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","comment_is_top":false,"comment_ctime":1659496159,"is_pvip":false,"replies":[{"id":"128541","content":"è¿™å…¶ä¸­çš„å…³ç³»å°±ä¸äº†è§£äº†ï¼Œä¸è¿‡ç°åœ¨ITç•Œçš„è¶‹åŠ¿æ˜¯é¿è®³â€œmasterâ€â€œslaveâ€ï¼Œæ¯•ç«Ÿzzzqã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1181974","ctime":1659508702,"ip_address":"åŒ—äº¬","comment_id":353484,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5954463455","product_id":100114501,"comment_content":"controller-planeæ˜¯ä¸æ˜¯ä¸ºäº†å‘openshiftçœ‹é½","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582558,"discussion_content":"è¿™å…¶ä¸­çš„å…³ç³»å°±ä¸äº†è§£äº†ï¼Œä¸è¿‡ç°åœ¨ITç•Œçš„è¶‹åŠ¿æ˜¯é¿è®³â€œmasterâ€â€œslaveâ€ï¼Œæ¯•ç«Ÿzzzqã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1659508702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1117318,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","nickname":"èŠ±èŠ±å¤§è„¸çŒ«","note":"","ucode":"8ABDB3F7F4FB0F","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583229,"discussion_content":"åˆå­¦åˆ°ä¸€ä¸ªzzzqï¼ï¼ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1659964186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582558,"ip_address":"æ±Ÿè‹"},"score":583229,"extra":""}]}]},{"had_liked":false,"id":357638,"user_name":"å¤©æ•Œ","can_delete":false,"product_type":"c1","uid":1059944,"ip_address":"åŒ—äº¬","ucode":"CD29A622197197","user_header":"https://static001.geekbang.org/account/avatar/00/10/2c/68/c299bc71.jpg","comment_is_top":false,"comment_ctime":1663510947,"is_pvip":false,"replies":[{"id":"130173","content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1663557313,"ip_address":"åŒ—äº¬","comment_id":357638,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1663510947","product_id":100114501,"comment_content":"è®°å½•ä¸€ä¸ªé—®é¢˜:<br>masterèŠ‚ç‚¹çš„dsæŠ¥å¦‚ä¸‹é”™:<br>ailed to create pod sandbox: rpc error: code = Unknown desc = failed to set up sandbox container &quot;85f6cc55c5bf809f10a6af0b888944031a14c159b9fc98b297f19874c22c5646&quot; network for pod &quot;redis-ds-2zhk6&quot;: networkPlugin cni failed to set up pod &quot;redis-ds-2zhk6_default&quot; network: open &#47;run&#47;flannel&#47;subnet.env: no such file or directory<br><br>åªéœ€å°†workerèŠ‚ç‚¹çš„ &#47;run&#47;flannel&#47;subnet.env æ‹·è´åˆ° master èŠ‚ç‚¹ä¸Šçš„ &#47;run&#47;flannel&#47;subnet.env å†åˆ é™¤å½“å‰podå³å¯ã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588108,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663557313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357242,"user_name":"wuyang","can_delete":false,"product_type":"c1","uid":1044517,"ip_address":"åŒ—äº¬","ucode":"81000322FF96A7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f0/25/d3da7ca9.jpg","comment_is_top":false,"comment_ctime":1663084765,"is_pvip":true,"replies":[{"id":"130014","content":"æ³¨æ„å‘½ä»¤æœ€åè¦æœ‰ä¸ªå‡å·ï¼Œè¡¨ç¤ºå»æ‰taintï¼Œå°±æ˜¯node-role.kubernetes.io&#47;master:NoSchedule-","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1663124342,"ip_address":"åŒ—äº¬","comment_id":357242,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1663084765","product_id":100114501,"comment_content":"åˆ é™¤èŠ‚ç‚¹taintæ—¶ï¼Œè€æ˜¯æŠ¥é”™ï¼Œæœ‰æ²¡æœ‰å¤§ç¥çœ‹ä¸‹ä»€ä¹ˆé—®é¢˜<br>wuyang@master-1:~$ kubectl describe node master | grep -i Taints<br>Taints:             node-role.kubernetes.io&#47;master:NoSchedule<br>wuyang@master-1:~$ kubectl taint node master node-role.kubernetes.io&#47;master:NoSchedule-node&#47;master untainted<br>error: all resources must be specified before taint changes: untainted<br><br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587517,"discussion_content":"æ³¨æ„å‘½ä»¤æœ€åè¦æœ‰ä¸ªå‡å·ï¼Œè¡¨ç¤ºå»æ‰taintï¼Œå°±æ˜¯node-role.kubernetes.io/master:NoSchedule-","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663124342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356915,"user_name":"fd","can_delete":false,"product_type":"c1","uid":1546977,"ip_address":"åŒ—äº¬","ucode":"60C2FA6F39F3E5","user_header":"https://static001.geekbang.org/account/avatar/00/17/9a/e1/7df2ad19.jpg","comment_is_top":false,"comment_ctime":1662699255,"is_pvip":true,"replies":[{"id":"129887","content":"çœ‹æ¥æ˜¯æˆ‘æ²¡æœ‰è¡¨è¿°æ¸…æ¥šï¼ŒæŠ±æ­‰ã€‚<br><br>æ„æ€æ˜¯DaemonSetä¿è¯è¿™ä¸ªåº”ç”¨åªä¼šåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªPodï¼Œå’ŒLinuxçš„å®ˆæŠ¤è¿›ç¨‹ç±»ä¼¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1181974","ctime":1662704823,"ip_address":"åŒ—äº¬","comment_id":356915,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1662699255","product_id":100114501,"comment_content":"æ‰€ä»¥ï¼ŒKubernetes å°±å®šä¹‰äº†æ–°çš„ API å¯¹è±¡ DaemonSetï¼Œå®ƒåœ¨å½¢å¼ä¸Šå’Œ Deployment ç±»ä¼¼ï¼Œéƒ½æ˜¯ç®¡ç†æ§åˆ¶ Podï¼Œä½†ç®¡ç†è°ƒåº¦ç­–ç•¥å´ä¸åŒã€‚DaemonSet çš„ç›®æ ‡æ˜¯åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ª Podï¼Œå°±å¥½åƒæ˜¯ä¸ºèŠ‚ç‚¹é…ä¸Šä¸€åªâ€œçœ‹é—¨ç‹—â€ï¼Œå¿ å®åœ°â€œå®ˆæŠ¤â€ç€èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯ DaemonSet åå­—çš„ç”±æ¥ã€‚<br><br>===============<br>è¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ª Podï¼Œé‚£æˆ‘çš„ä¸šåŠ¡Pod å°±ä¸èƒ½è¿è¡Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šäº†ä¹ˆï¼Ÿè¿˜æ˜¯ æ„æ€æ˜¯ DaemonSet å…¶å®æ˜¯ä¿è¯æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰è¿™ä¸ªåŸºç¡€çš„Podï¼Œæ¯”å¦‚æ—¥å¿—æ”¶é›†ï¼Œç›‘æ§è¿™ç±»çš„PODï¼Œæ¯ä¸€ç±»çš„åŸºç¡€Pod ç”± DaemonSet ä¿è¯æœ‰è€Œä¸”æœ‰ä¸€ä¸ªï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587035,"discussion_content":"çœ‹æ¥æ˜¯æˆ‘æ²¡æœ‰è¡¨è¿°æ¸…æ¥šï¼ŒæŠ±æ­‰ã€‚\n\næ„æ€æ˜¯DaemonSetä¿è¯è¿™ä¸ªåº”ç”¨åªä¼šåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªPodï¼Œå’ŒLinuxçš„å®ˆæŠ¤è¿›ç¨‹ç±»ä¼¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662704824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590902,"discussion_content":"daemonSet å¯ä»¥è®¾ç½®è¿è¡Œå¤šä¸ªpodå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666159746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546977,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9a/e1/7df2ad19.jpg","nickname":"fd","note":"","ucode":"60C2FA6F39F3E5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587171,"discussion_content":"ğŸ‘ŒğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662865915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355967,"user_name":"hiDaLao","can_delete":false,"product_type":"c1","uid":2917100,"ip_address":"åŒ—äº¬","ucode":"3C2DC2A3A377E4","user_header":"https://static001.geekbang.org/account/avatar/00/2c/82/ec/99b480e8.jpg","comment_is_top":false,"comment_ctime":1661874998,"is_pvip":true,"replies":[{"id":"129559","content":"è¿™ä¸ªæ˜¯Kubernetesè‡ªå·±çš„ç®¡ç†èƒ½åŠ›ï¼Œå‘ç°èŠ‚ç‚¹çš„å†…å­˜ä¸è¶³å°±ä¼šè‡ªåŠ¨æ·»åŠ æ±¡ç‚¹ï¼Œé¿å…èŠ‚ç‚¹å‹åŠ›è¿‡å¤§ã€‚<br><br>Metrics Serverå’ŒPrometheusçš„podæ¯”è¾ƒå¤šï¼Œå®éªŒç¯å¢ƒçš„1GBå†…å­˜å¯èƒ½ä¸å¤Ÿï¼Œå¯ä»¥è°ƒæ•´åˆ°2GBã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1661912661,"ip_address":"åŒ—äº¬","comment_id":355967,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1661874998","product_id":100114501,"comment_content":"è®°å½•ä¸€ä¸ªé—®é¢˜ï¼Œå‘ç°æ–°å»ºçš„podçš„å¤„äºpendingçŠ¶æ€ï¼Œé€šè¿‡kubectl describe podå‘ç°æœ‰warningï¼š`default-scheduler  0&#47;2 nodes are available: 1 node(s) had taint {node-role.kubernetes.io&#47;master: }, that the pod didn&#39;t tolerate, 1 node(s) had taint {node.kubernetes.io&#47;memory-pressure: }, that the pod didn&#39;t tolerate.`ï¼Œå‘ç°ç”±äºä¸»ä»èŠ‚ç‚¹å„è‡ªçš„å®¹å¿åº¦å¯¼è‡´podæ— æ³•è¢«è°ƒåº¦ï¼Œä½†ä»èŠ‚ç‚¹çš„`node.kubernetes.io&#47;memory-pressure:NoSchedule`æ±¡ç‚¹ä¸€ç›´æ— æ³•å»æ‰ï¼Œåªå¥½åœ¨ä»èŠ‚ç‚¹æ¸…ç†äº†ä¸€äº›åœæ­¢çš„dockerå®¹å™¨åï¼Œå‘ç°podè¢«è°ƒåº¦åˆ°äº†ä»èŠ‚ç‚¹ï¼Œä½†æ²¡è¿‡å¤šä¹…podçš„çŠ¶æ€æœ‰å˜æˆäº†EvictedçŠ¶æ€ï¼Œæç¤ºThe node had condition: [MemoryPressure]ï¼Œç„¶åæ‰©å®¹äº†ä¸‹ä»èŠ‚ç‚¹çš„å†…å­˜ï¼Œé—®é¢˜ç»ˆäºè§£å†³ã€‚ä½†æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œä¸ºä»€ä¹ˆä»èŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨æ·»åŠ ä¸Š`node.kubernetes.io&#47;memory-pressure:NoSchedule`çš„taintä»¥åŠå†…å­˜ä¸è¶³æ—¶æ— æ³•å»æ‰è¿™ä¸ªæ±¡ç‚¹ï¼Ÿä¸ºäº†æ‰©å®¹ä»èŠ‚ç‚¹çš„å†…å­˜ï¼Œæˆ‘å°†ä»èŠ‚ç‚¹é‡å¯äº†ä¸‹ï¼Œç„¶åå†describeä»èŠ‚ç‚¹ï¼Œå‘ç°è¿™ä¸ªæ±¡ç‚¹åˆæ¶ˆå¤±äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585936,"discussion_content":"è¿™ä¸ªæ˜¯Kubernetesè‡ªå·±çš„ç®¡ç†èƒ½åŠ›ï¼Œå‘ç°èŠ‚ç‚¹çš„å†…å­˜ä¸è¶³å°±ä¼šè‡ªåŠ¨æ·»åŠ æ±¡ç‚¹ï¼Œé¿å…èŠ‚ç‚¹å‹åŠ›è¿‡å¤§ã€‚\n\nMetrics Serverå’ŒPrometheusçš„podæ¯”è¾ƒå¤šï¼Œå®éªŒç¯å¢ƒçš„1GBå†…å­˜å¯èƒ½ä¸å¤Ÿï¼Œå¯ä»¥è°ƒæ•´åˆ°2GBã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1661912661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297213,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cb/3d/b290414d.jpg","nickname":"å²æœˆé•¿","note":"","ucode":"CDD7BEC084AC51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587780,"discussion_content":"ä¹‹å‰é‡å¯è™šæ‹Ÿæœºä¹‹åï¼Œæ–°å»ºçš„ pod ä¸€ç›´ pendding ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåªèƒ½å›æ»šï¼Œç°åœ¨çœ‹äº†ä¸‹ï¼Œå‘ç°æ˜¯å’Œä½ ä¸€æ ·çš„é—®é¢˜ï¼Œæ‰©å¤§å†…å­˜åä¿®å¤äº†ååˆ†æ„Ÿè°¢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663291682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355832,"user_name":"Amark","can_delete":false,"product_type":"c1","uid":1121326,"ip_address":"åŒ—äº¬","ucode":"E5F48633654002","user_header":"https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg","comment_is_top":false,"comment_ctime":1661773304,"is_pvip":false,"replies":[{"id":"129508","content":"å¯ä»¥çš„ï¼Œä¸è¿‡æˆ‘å¯¹Kubernetesçš„å¼€å‘äº†è§£ä¸å¤ªå¤šï¼Œå› ä¸ºå¯¹goæ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1661777647,"ip_address":"åŒ—äº¬","comment_id":355832,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661773304","product_id":100114501,"comment_content":"è¯·æ•™ä¸‹è€å®ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¼€å‘ä¸€äº›å…¶ä»–ä¾èµ–podçš„APIèµ„æºï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585727,"discussion_content":"å¯ä»¥çš„ï¼Œä¸è¿‡æˆ‘å¯¹Kubernetesçš„å¼€å‘äº†è§£ä¸å¤ªå¤šï¼Œå› ä¸ºå¯¹goæ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661777647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355831,"user_name":"Amark","can_delete":false,"product_type":"c1","uid":1121326,"ip_address":"åŒ—äº¬","ucode":"E5F48633654002","user_header":"https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg","comment_is_top":false,"comment_ctime":1661772781,"is_pvip":false,"replies":[{"id":"129509","content":"ç‹¬ç«‹çš„å¯¹è±¡ç”¨é€”æ›´æ¸…æ™°ï¼Œæ›´å®¹æ˜“ä½¿ç”¨ï¼Œå¦åˆ™å°±å’Œdockerçš„å‘½ä»¤è¡Œä¸€æ ·äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1661777684,"ip_address":"åŒ—äº¬","comment_id":355831,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661772781","product_id":100114501,"comment_content":"k8sä¸ºå•¥æ²¡æœ‰é€šè¿‡å‚æ•°åŒºåˆ†deploymentè·Ÿdaemonsetï¼Œç›´æ¥å°è£…æˆä¸¤ç§èµ„æºäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585728,"discussion_content":"ç‹¬ç«‹çš„å¯¹è±¡ç”¨é€”æ›´æ¸…æ™°ï¼Œæ›´å®¹æ˜“ä½¿ç”¨ï¼Œå¦åˆ™å°±å’Œdockerçš„å‘½ä»¤è¡Œä¸€æ ·äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661777684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354064,"user_name":"è®¸é£","can_delete":false,"product_type":"c1","uid":2789963,"ip_address":"åŒ—äº¬","ucode":"2579B1A828D8BC","user_header":"https://static001.geekbang.org/account/avatar/00/2a/92/4b/1262f052.jpg","comment_is_top":false,"comment_ctime":1660053845,"is_pvip":true,"replies":[{"id":"128787","content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1660092330,"ip_address":"åŒ—äº¬","comment_id":354064,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660053845","product_id":100114501,"comment_content":"æµ‹è¯•ç»“è®ºï¼šå½“masterèŠ‚ç‚¹å»é™¤æ±¡ç‚¹æ—¶ï¼Œpodä¼šè°ƒåº¦åˆ°masterï¼›masterèŠ‚ç‚¹å¢åŠ æ±¡ç‚¹æ—¶ï¼Œpodä¸ä¼šç¦»å¼€ï¼Œæ‰‹åŠ¨åˆ é™¤åä¸ä¼šå†å¢åŠ ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583383,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660092330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353694,"user_name":"YueShi","can_delete":false,"product_type":"c1","uid":1625530,"ip_address":"åŒ—äº¬","ucode":"8F7AFAE4641A7D","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","comment_is_top":false,"comment_ctime":1659686449,"is_pvip":true,"replies":[{"id":"128607","content":"good","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659701032,"ip_address":"åŒ—äº¬","comment_id":353694,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659686449","product_id":100114501,"comment_content":"é€šä¿—æ˜“æ‡‚ï¼Œå­¦åˆ°äº†ï¼","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582846,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659701032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353522,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"ä¸Šæµ·","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1659517038,"is_pvip":true,"replies":[{"id":"128551","content":"<br>1.ä½¿ç”¨taint&#47;tolerationså’Œaffinityå°±å¯ä»¥ä»»æ„å†³å®šDaemonSetçš„è¿è¡ŒèŠ‚ç‚¹ï¼ŒDaemonSetçš„æœ¬è´¨å°±æ˜¯åœ¨ç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹ä¸Šåªè¿è¡Œä¸€ä¸ªå®ä¾‹ã€‚<br><br>2.æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚<br><br>3.ä¸éœ€è¦ï¼ŒKubernetesä¼šè‡ªåŠ¨å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1181974","ctime":1659526202,"ip_address":"ä¸Šæµ·","comment_id":353522,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659517038","product_id":100114501,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š<br>Q1ï¼šDaemonSetåœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½åˆ›å»ºå—ï¼Ÿæ˜¯å¦å¯ä»¥é™å®šèŠ‚ç‚¹ï¼Ÿ<br>æ–‡ä¸­çš„ä¾‹å­æ˜¯è¯´â€œè€Œæ˜¯è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªåˆ›å»ºå‡ºä¸€ä¸ª Pod å®ä¾‹â€ã€‚ä½†æ˜¯ï¼Œå¦‚æœé›†ç¾¤æœ‰100ä¸ªèŠ‚ç‚¹ï¼Œåªæ˜¯åä¸ªèŠ‚ç‚¹éœ€è¦æœ‰DaemonSetï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿ<br><br>Q2ï¼šå»æ‰æ±¡ç‚¹åpodè¿˜åœ¨è¿è¡Œ<br>å»æ‰æ±¡ç‚¹åï¼Œkubectl get dsï¼Œå‘ç°æ•°é‡ä»2å˜æˆ1,ã€‚ä½†æ˜¯ï¼Œkubectl get podï¼Œè¿˜æ˜¯æœ‰ä¸¤ä¸ªpodï¼Œå¤„äºè¿è¡ŒçŠ¶æ€ã€‚Masterä¸Šçš„podä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±å—ï¼Ÿ ï¼ˆéœ€è¦ç”¨å‘½ä»¤åˆ é™¤masterä¸Šçš„podå—ï¼‰<br><br>Q3ï¼šä¿®æ”¹ds.ymlåï¼Œå†æ¬¡åˆ›å»ºå‰éœ€è¦åˆ é™¤åŸæ¥çš„dså¯¹è±¡å—ï¼Ÿ<br>ä¿®æ”¹ds.ymlï¼Œå¢åŠ å®¹å¿åº¦å†…å®¹ã€‚å†æ¬¡æ‰§è¡Œâ€œkubectl apply â€“f ds.ymlâ€ä¹‹å‰ï¼Œå·²ç»å­˜åœ¨dså¯¹è±¡å’Œpodå¯¹è±¡ã€‚å†æ¬¡åˆ›å»ºdsä¹‹å‰ï¼Œéœ€è¦åˆ æ‰åŸæ¥çš„dså¯¹è±¡å’Œpodå¯¹è±¡å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582611,"discussion_content":"\n1.ä½¿ç”¨taint/tolerationså’Œaffinityå°±å¯ä»¥ä»»æ„å†³å®šDaemonSetçš„è¿è¡ŒèŠ‚ç‚¹ï¼ŒDaemonSetçš„æœ¬è´¨å°±æ˜¯åœ¨ç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹ä¸Šåªè¿è¡Œä¸€ä¸ªå®ä¾‹ã€‚\n\n2.æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚\n\n3.ä¸éœ€è¦ï¼ŒKubernetesä¼šè‡ªåŠ¨å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659526202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353498,"user_name":"è¥¿é—¨å¹ç‰›","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"åŒ—äº¬","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1659500245,"is_pvip":false,"replies":[{"id":"128543","content":"æ ‡ç­¾å¯ä»¥è´´åœ¨ä»»æ„çš„Kuberneteså¯¹è±¡ä¸Šï¼Œæ˜¯ç»™ç”¨æˆ·ç”¨æ¥æ–¹ä¾¿æŸ¥æ‰¾çš„ï¼Œä¸å®Œå…¨æ˜¯ä¸ºäº†å®¹å™¨ç¼–æ’ã€‚<br><br>ç¬¬äºŒä¸ªç†è§£æ¯”è¾ƒæ­£ç¡®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1181974","ctime":1659508796,"ip_address":"åŒ—äº¬","comment_id":353498,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659500245","product_id":100114501,"comment_content":"æ ‡ç­¾åŒ¹é… vs æ±¡ç‚¹å®¹å¿åº¦åŒ¹é…ï¼š<br>æ ‡ç­¾åŒ¹é…çš„ä½œç”¨æ˜¯å®ç° Pod å’Œ å®¹å™¨çš„åŒ¹é…ï¼Œè¿›è€Œå®ç°å¯¹å®¹å™¨çš„ç¼–æ’<br>æ±¡ç‚¹å®¹å¿åº¦çš„åŒ¹é…å®ç°çš„æ˜¯ Pod å’ŒèŠ‚ç‚¹çš„åŒ¹é…ï¼Œè¿›è€Œå¯¹ Pod è¿›è¡Œç¼–æ’<br>å¯ä»¥è¿™æ ·ç†è§£ä¸ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582560,"discussion_content":"æ ‡ç­¾å¯ä»¥è´´åœ¨ä»»æ„çš„Kuberneteså¯¹è±¡ä¸Šï¼Œæ˜¯ç»™ç”¨æˆ·ç”¨æ¥æ–¹ä¾¿æŸ¥æ‰¾çš„ï¼Œä¸å®Œå…¨æ˜¯ä¸ºäº†å®¹å™¨ç¼–æ’ã€‚\n\nç¬¬äºŒä¸ªç†è§£æ¯”è¾ƒæ­£ç¡®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659508796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353497,"user_name":"æ½œå…‰éšè€€","can_delete":false,"product_type":"c1","uid":1809457,"ip_address":"åŒ—äº¬","ucode":"8A2FDDEFCB1863","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9c/31/e4677275.jpg","comment_is_top":false,"comment_ctime":1659500179,"is_pvip":false,"replies":[{"id":"128542","content":"å½“ç„¶ä¼šè‡ªåŠ¨æ‹‰èµ·ï¼Œå’ŒDeploymentæ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659508719,"ip_address":"åŒ—äº¬","comment_id":353497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659500179","product_id":100114501,"comment_content":"è¯·é—®ä¸‹ï¼ŒDaemonSetçš„Podå¦‚æœè¢«åˆ é™¤ï¼Œæ˜¯å¦èƒ½è¢«è‡ªåŠ¨é‡å»ºï¼Œä¿æŒé«˜å¯ç”¨å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582559,"discussion_content":"å½“ç„¶ä¼šè‡ªåŠ¨æ‹‰èµ·ï¼Œå’ŒDeploymentæ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659508719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353474,"user_name":"æˆ’è´ªå—”ç—´","can_delete":false,"product_type":"c1","uid":3017168,"ip_address":"åŒ—äº¬","ucode":"D53EA3525DBD71","user_header":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","comment_is_top":false,"comment_ctime":1659491337,"is_pvip":true,"replies":[{"id":"128547","content":"æ˜¯çš„ï¼Œå› ä¸º1.24å·²ç»ä¸å†ä½¿ç”¨â€œmasterâ€äº†ï¼Œè¦æ”¹æˆâ€œcontrol-planeâ€ï¼ŒPodå¿…é¡»èƒ½å¤Ÿå®¹å¿control-planeä¸Šçš„æ‰€æœ‰æ±¡ç‚¹æ‰è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659509029,"ip_address":"åŒ—äº¬","comment_id":353474,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1659491337","product_id":100114501,"comment_content":"è€å¸ˆï¼Œæ˜¯è¿™æ ·çš„ï¼Œç”±äºæœ¬äººä½¿ç”¨çš„k8sç‰ˆæœ¬æ˜¯v1.24.0ï¼Œä½¿ç”¨kubectl describe node masterå¾—åˆ°çš„ç»“æœæ˜¯<br>Taints:             node-role.kubernetes.io&#47;control-plane:NoSchedule<br>                    node-role.kubernetes.io&#47;master:NoSchedule<br>å› ä¸ºåˆšå¼€å§‹ä¸çŸ¥é“ä½ æœ€åé‚£å¼ å›¾é‡Œè¯´çš„æ–°ç‰ˆæœ¬å·²ç»æ”¹ä¸ºcontrol-planeçš„è¿™ç§å†™æ³•äº†ï¼Œå¯¼è‡´æŒ‰ç…§æ•™ç¨‹æ“ä½œä¸‹æ¥2ç§æ–¹æ³•éƒ½ä¸èƒ½å®ç°æŠŠpodè°ƒåº¦åˆ°masterä¸Šè¿è¡Œï¼Œæ‰€ä»¥è¯·æ•™ä¸‹è€å¸ˆæ˜¯ä¸æ˜¯taintå’Œtolerationéƒ½è¦æ”¹ä¸ºcontrol-planeçš„å†™æ³•ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582564,"discussion_content":"æ˜¯çš„ï¼Œå› ä¸º1.24å·²ç»ä¸å†ä½¿ç”¨â€œmasterâ€äº†ï¼Œè¦æ”¹æˆâ€œcontrol-planeâ€ï¼ŒPodå¿…é¡»èƒ½å¤Ÿå®¹å¿control-planeä¸Šçš„æ‰€æœ‰æ±¡ç‚¹æ‰è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659509029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3017168,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg","nickname":"æˆ’è´ªå—”ç—´","note":"","ucode":"D53EA3525DBD71","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":582610,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659526100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582564,"ip_address":"æµ™æ±Ÿ"},"score":582610,"extra":""}]}]},{"had_liked":false,"id":353468,"user_name":"é˜¿å¨","can_delete":false,"product_type":"c1","uid":2080583,"ip_address":"åŒ—äº¬","ucode":"8D03CF9492D860","user_header":"https://static001.geekbang.org/account/avatar/00/1f/bf/47/c7e1633a.jpg","comment_is_top":false,"comment_ctime":1659488128,"is_pvip":true,"replies":[{"id":"128546","content":"ç”¨kubectl describeçœ‹çœ‹nodeçš„æ±¡ç‚¹çŠ¶æ€å†å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659508958,"ip_address":"åŒ—äº¬","comment_id":353468,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659488128","product_id":100114501,"comment_content":"ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š<br>[root@master yaml]# kubectl taint node master node-role.kubernetes.io&#47;master:NoSchedule-node&#47;master untainted<br>error: all resources must be specified before taint changes: untainted","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582563,"discussion_content":"ç”¨kubectl describeçœ‹çœ‹nodeçš„æ±¡ç‚¹çŠ¶æ€å†å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659508959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353461,"user_name":"Dexter","can_delete":false,"product_type":"c1","uid":2608728,"ip_address":"åŒ—äº¬","ucode":"909CABC4AC4AC9","user_header":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","comment_is_top":false,"comment_ctime":1659479825,"is_pvip":true,"replies":[{"id":"128545","content":"æ˜¯çš„ï¼Œä»¥åå°±æ²¡æœ‰masteräº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1659508904,"ip_address":"åŒ—äº¬","comment_id":353461,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659479825","product_id":100114501,"comment_content":"æ˜¨å¤©æ™šä¸Šæ­å»ºç¯å¢ƒå°±ç¢°è§äº†ç¬¬5ç‚¹","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582562,"discussion_content":"æ˜¯çš„ï¼Œä»¥åå°±æ²¡æœ‰masteräº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659508904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}