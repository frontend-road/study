{"id":442442,"title":"14 | æ„å»ºç½‘ç»œï¼šä¸€ç«™å¼å®ç°æ¨¡å‹æ­å»ºä¸è®­ç»ƒ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ–¹è¿œã€‚</p><p>å‰é¢æˆ‘ä»¬èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œæ—¢å­¦ä¹ äº†æ•°æ®éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œè¿˜ç ”ç©¶äº†æ¨¡å‹çš„ä¼˜åŒ–æ–¹æ³•ã€æŸå¤±å‡½æ•°ä»¥åŠå·ç§¯è®¡ç®—ã€‚ä½ å¯èƒ½æ„Ÿè§‰è¿™äº›çŸ¥è¯†è¿˜æœ‰äº›é›¶é›¶æ•£æ•£ï¼Œä½†å…¶å®æˆ‘ä»¬ä¸çŸ¥ä¸è§‰ä¸­ï¼Œå·²ç»æ‹¿ä¸‹äº†æ¨¡å‹è®­ç»ƒçš„å¿…å­¦å†…å®¹ã€‚</p><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸­æœŸå°ç»ƒä¹ ï¼Œæ˜¯æˆ‘ä»¬æ£€éªŒè‡ªå·±å­¦ä¹ æ•ˆæœçš„å¥½æ—¶æœºã€‚æˆ‘ä¼šå¸¦ä½ ä½¿ç”¨PyTorchæ„å»ºå’Œè®­ç»ƒä¸€ä¸ªè‡ªå·±çš„æ¨¡å‹ã€‚</p><p>å…·ä½“æˆ‘æ˜¯è¿™ä¹ˆå®‰æ’çš„ï¼Œé¦–å…ˆè®²è§£æ­å»ºç½‘ç»œå¿…å¤‡çš„åŸºç¡€æ¨¡å—â€”â€”nn.Moduleæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•è‡ªå·±æ„å»ºä¸€ä¸ªç½‘ç»œï¼Œå¹¶ä¸”è®­ç»ƒå®ƒï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ææ¸…æ¥šVGGã€Inceptioné‚£äº›ç½‘ç»œæ˜¯æ€ä¹ˆè®­ç»ƒå‡ºæ¥çš„ã€‚ç„¶åæˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•å€ŸåŠ©Torchvisionçš„æ¨¡å‹ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œæ¥è®­ç»ƒæˆ‘ä»¬è‡ªå·±çš„æ¨¡å‹ã€‚</p><h2>æ„å»ºè‡ªå·±çš„æ¨¡å‹</h2><p>è®©æˆ‘ä»¬ç›´æ¥åˆ‡å…¥ä¸»é¢˜ï¼Œä½¿ç”¨PyTorchï¼Œè‡ªå·±æ„å»ºå¹¶è®­ç»ƒä¸€ä¸ªçº¿æ€§å›å½’æ¨¡å‹ï¼Œæ¥æ‹Ÿåˆå‡ºè®­ç»ƒé›†ä¸­çš„èµ°åŠ¿åˆ†å¸ƒã€‚</p><p>æˆ‘ä»¬å…ˆéšæœºç”Ÿæˆè®­ç»ƒé›†Xä¸å¯¹åº”çš„æ ‡ç­¾Yï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">import numpy as np\nimport random\nfrom matplotlib import pyplot as plt\n\nw = 2\nb = 3\nxlim = [-10, 10]\nx_train = np.random.randint(low=xlim[0], high=xlim[1], size=30)\n\ny_train = [w * x + b + random.randint(0,2) for x in x_train]\n\nplt.plot(x_train, y_train, 'bo')\n</code></pre><!-- [[[read_end]]] --><p>ä¸Šè¿°ä»£ç ä¸­ç”Ÿæˆçš„æ•°æ®ï¼Œæ•´ç†æˆæ•£ç‚¹å›¾ä»¥åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/f2/11/f2d24e9e7ea5737a78032b686282ca11.jpg?wh=900x621\" alt=\"å›¾ç‰‡\"></p><p>ç†Ÿæ‚‰å›å½’çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„å›å½’æ¨¡å‹ä¸ºï¼š$y = wx+b$ã€‚è¿™é‡Œçš„xä¸yï¼Œå…¶å®å°±å¯¹åº”ä¸Šè¿°ä»£ç ä¸­çš„x_trainä¸y_trainï¼Œè€Œwä¸bæ­£æ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„å‚æ•°ã€‚</p><p>å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ„å»ºè¿™ä¸ªæ¨¡å‹ã€‚æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä»£ç ï¼Œå†å…·ä½“è®²è§£ã€‚</p><pre><code class=\"language-python\">import torch\nfrom torch import nn\n\nclass LinearModel(nn.Module):\n&nbsp; def __init__(self):\n&nbsp; &nbsp; super().__init__()\n&nbsp; &nbsp; self.weight = nn.Parameter(torch.randn(1))\n&nbsp; &nbsp; self.bias = nn.Parameter(torch.randn(1))\n\n&nbsp; def forward(self, input):\n&nbsp; &nbsp; return (input * self.weight) + self.bias\n</code></pre><p>é€šè¿‡ä¸Šé¢è¿™ä¸ªçº¿æ€§å›å½’æ¨¡å‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å‡ºæ„å»ºç½‘ç»œæ—¶çš„é‡è¦å‡ ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>1.<strong>å¿…é¡»ç»§æ‰¿nn.Moduleç±»</strong>ã€‚</p><p>2.<strong>é‡å†™__init__()æ–¹æ³•</strong>ã€‚é€šå¸¸æ¥è¯´è¦æŠŠæœ‰éœ€è¦å­¦ä¹ çš„å‚æ•°çš„å±‚æ”¾åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œä¾‹å¦‚ï¼Œä¾‹å­ä¸­çš„weightä¸biasï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„å·ç§¯å±‚ã€‚æˆ‘ä»¬åœ¨ä¸Šè¿°çš„__init__()ä¸­ä½¿ç”¨äº†nn.Parameter()ï¼Œå®ƒä¸»è¦çš„ä½œç”¨å°±æ˜¯ä½œä¸ºnn.Moduleä¸­å¯è®­ç»ƒçš„å‚æ•°ä½¿ç”¨ã€‚</p><p>3.<strong>forward()æ˜¯å¿…é¡»é‡å†™çš„æ–¹æ³•</strong>ã€‚çœ‹å‡½æ•°åä¹Ÿå¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯ç”¨æ¥å®šä¹‰è¿™ä¸ªæ¨¡å‹æ˜¯å¦‚ä½•è®¡ç®—è¾“å‡ºçš„ï¼Œä¹Ÿå°±æ˜¯å‰å‘ä¼ æ’­ã€‚å¯¹åº”åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œå°±æ˜¯è·å¾—æœ€ç»ˆè¾“å‡ºy=weight * x+biasçš„è®¡ç®—ç»“æœã€‚å¯¹äºä¸€äº›ä¸éœ€è¦å­¦ä¹ å‚æ•°çš„å±‚ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥æ”¾åœ¨è¿™é‡Œã€‚ä¾‹å¦‚ï¼ŒBNå±‚ï¼Œæ¿€æ´»å‡½æ•°è¿˜æœ‰Dropoutã€‚</p><h3>nn.Moduleæ¨¡å—</h3><p>nn.Moduleæ˜¯æ‰€æœ‰ç¥ç»ç½‘ç»œæ¨¡å—çš„åŸºç±»ã€‚å½“æˆ‘ä»¬è‡ªå·±è¦è®¾è®¡ä¸€ä¸ªç½‘ç»œç»“æ„çš„æ—¶å€™ï¼Œå°±è¦ç»§æ‰¿è¯¥ç±»ã€‚ä¹Ÿå°±è¯´ï¼Œå…¶å®Torchvisonä¸­çš„é‚£äº›æ¨¡å‹ï¼Œä¹Ÿéƒ½æ˜¯é€šè¿‡ç»§æ‰¿nn.Moduleæ¨¡å—æ¥æ„å»ºç½‘ç»œæ¨¡å‹çš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>æ¨¡å—æœ¬èº«æ˜¯callableçš„ï¼Œå½“è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œå°±æ˜¯æ‰§è¡Œforwardå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å‰å‘ä¼ æ’­</strong>ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ç»“åˆä»£ç ä¾‹å­ç›´è§‚æ„Ÿå—ä¸€ä¸‹ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªLinearModelçš„å®ä¾‹modelï¼Œç„¶åmodel(x)å°±ç›¸å½“äºè°ƒç”¨LinearModelä¸­çš„forwardæ–¹æ³•ã€‚</p><pre><code class=\"language-python\">model = LinearModel()\nx = torch.tensor(3)\ny = model(x)\n</code></pre><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„è¯¾ç¨‹é‡Œå·²ç»è®²è¿‡ï¼Œæ¨¡å‹æ˜¯é€šè¿‡å‰å‘ä¼ æ’­ä¸åå‘ä¼ æ’­æ¥è®¡ç®—æ¢¯åº¦ï¼Œç„¶åæ›´æ–°å‚æ•°çš„ã€‚æˆ‘æƒ³å­¦åˆ°è¿™é‡Œï¼Œåº”è¯¥æ²¡æœ‰å‡ ä¸ªäººä¼šæ„¿æ„å»å†™åå‘ä¼ æ’­å’Œæ¢¯åº¦æ›´æ–°ä¹‹ç±»çš„ä»£ç å§ã€‚</p><p>è¿™ä¸ªæ—¶å€™PyTorchçš„ä¼˜ç‚¹å°±ä½“ç°å‡ºæ¥äº†ï¼Œå½“ä½ è®­ç»ƒæ—¶ï¼ŒPyTorchçš„æ±‚å¯¼æœºåˆ¶ä¼šå¸®ä½ è‡ªåŠ¨å®Œæˆè¿™äº›ä»¤äººå¤´å¤§çš„è®¡ç®—ã€‚</p><p>é™¤äº†åˆšæ‰è®²è¿‡çš„å†…å®¹ï¼Œå…³äºåˆå§‹åŒ–æ–¹æ³•__init__ï¼Œä½ è¿˜éœ€è¦å…³æ³¨çš„æ˜¯ï¼Œ<strong>å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•æ‰å¯ä»¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¿™è¡Œä»£ç ï¼š</p><pre><code class=\"language-python\">super().__init__()\n</code></pre><p>å› ä¸ºåœ¨nn.Moduleçš„__init__()ä¸­ï¼Œä¼šåˆå§‹åŒ–ä¸€äº›æœ‰åºçš„å­—å…¸ä¸é›†åˆã€‚è¿™äº›é›†åˆç”¨æ¥å­˜å‚¨ä¸€äº›æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„ä¸­é—´å˜é‡ï¼Œå¦‚æœä¸åˆå§‹åŒ–nn.Moduleä¸­çš„è¿™äº›å‚æ•°çš„è¯ï¼Œæ¨¡å‹å°±ä¼šæŠ¥ä¸‹é¢çš„é”™è¯¯ã€‚</p><pre><code class=\"language-python\">AttributeError: cannot assign parameters before Module.__init__() call\n</code></pre><h3>æ¨¡å‹çš„è®­ç»ƒ</h3><p>æˆ‘ä»¬çš„æ¨¡å‹å®šä¹‰å¥½ä¹‹åï¼Œè¿˜æ²¡æœ‰è¢«è®­ç»ƒã€‚è¦æƒ³è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ï¼Œå°±éœ€è¦ç”¨åˆ°æŸå¤±å‡½æ•°ä¸ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™ä¸€éƒ¨åˆ†å‰é¢è¯¾é‡Œï¼ˆå¦‚æœä½ æ„Ÿè§‰é™Œç”Ÿçš„è¯ï¼Œå¯ä»¥å›é¡¾11ï½13èŠ‚è¯¾ï¼‰å·²ç»å­¦è¿‡äº†ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥äº†ã€‚</p><p>è¿™é‡Œé€‰æ‹©çš„æ˜¯MSEæŸå¤±ä¸SGDä¼˜åŒ–æ–¹æ³•ã€‚</p><pre><code class=\"language-python\">model = LinearModel()\n# å®šä¹‰ä¼˜åŒ–å™¨\noptimizer = torch.optim.SGD(model.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)\n\ny_train = torch.tensor(y_train, dtype=torch.float32)\nfor _ in range(1000):\n    input = torch.from_numpy(x_train)\n    output = model(input)\n    loss = nn.MSELoss()(output, y_train)\n    model.zero_grad()\n    loss.backward()\n    optimizer.step()\n</code></pre><p>ç»è¿‡1000ä¸ªEpochçš„è®­ç»ƒä»¥åï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºæ¨¡å‹çš„weightä¸biasï¼Œçœ‹çœ‹æ˜¯å¤šå°‘ã€‚</p><p>å¯¹äºä¸€ä¸ªæ¨¡å‹çš„<strong>å¯è®­ç»ƒ</strong>çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡named_parameters()æ¥æŸ¥çœ‹ï¼Œè¯·çœ‹ä¸‹é¢ä»£ç ã€‚</p><pre><code class=\"language-python\">for parameter in model.named_parameters():\n&nbsp; print(parameter)\n# è¾“å‡ºï¼š\n('weight', Parameter containing:\ntensor([2.0071], requires_grad=True))\n('bias', Parameter containing:\ntensor([3.1690], requires_grad=True))\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œweightæ˜¯2.0071ï¼Œbiasæ˜¯3.1690ï¼Œä½ å†å›å¤´å¯¹ä¸€ä¸‹æˆ‘ä»¬åˆ›å»ºè®­ç»ƒæ•°æ®çš„wä¸bï¼Œå®ƒä»¬æ˜¯ä¸æ˜¯ä¸€æ ·å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åˆšæ‰è¯´è¿‡ï¼Œç»§æ‰¿ä¸€ä¸ªnn.Moduleä¹‹åï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„ç½‘ç»œæ¨¡å‹ã€‚ModuleåŒæ ·å¯ä»¥ä½œä¸ºå¦å¤–ä¸€ä¸ªModuleçš„ä¸€éƒ¨åˆ†ï¼Œè¢«åŒ…å«åœ¨ç½‘ç»œä¸­ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦è®¾è®¡ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªç½‘ç»œï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/25/c6/2574b93463fd3dbd0e97661d6a06ffc6.jpg?wh=1372x689\" alt=\"\"></p><p>è§‚å¯Ÿå›¾ç‰‡å¾ˆå®¹æ˜“å°±ä¼šå‘ç°ï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸­æœ‰å¤§é‡é‡å¤çš„ç»“æ„ã€‚ä¸Šå›¾ä¸­çš„3x3ä¸2x2çš„å·ç§¯ç»„åˆï¼ŒæŒ‰ç…§æˆ‘ä»¬å¼€ç¯‡çš„è®²è§£çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸€å±‚å·ç§¯éƒ½å®šä¹‰åˆ°__init__()ï¼Œç„¶åå†åœ¨forwardä¸­å®šä¹‰å¥½æ‰§è¡Œæ–¹æ³•å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¼ªä»£ç ï¼š</p><pre><code class=\"language-python\">class CustomModel(nn.Module):\n&nbsp; def __init__(self):\n&nbsp; &nbsp; super().__init__()\n&nbsp; &nbsp; self.conv1_1 = nn.Conv2d(in_channels=1, out_channels=3, kernel_size=3, padding='same')\n&nbsp; &nbsp; self.conv1_2 = nn.Conv2d(in_channels=3, out_channels=1, kernel_size=2, padding='same')\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; self.conv_m_1 = nn.Conv2d(in_channels=1, out_channels=3, kernel_size=3, padding='same')\n&nbsp; &nbsp; self.conv_m_2 = nn.Conv2d(in_channels=3, out_channels=1, kernel_size=2, padding='same')\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; self.conv_n_1 = nn.Conv2d(in_channels=1, out_channels=3, kernel_size=3, padding='same')\n&nbsp; &nbsp; self.conv_n_2 = nn.Conv2d(in_channels=3, out_channels=1, kernel_size=2, padding='same')\n\n&nbsp; def forward(self, input):\n&nbsp; &nbsp; x = self.conv1_1(input)\n&nbsp; &nbsp; x = self.conv1_2(x)\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; x = self.conv_m_1(x)\n&nbsp; &nbsp; x = self.conv_m_2(x)\n&nbsp; &nbsp; ...&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; x = self.conv_n_1(x)\n&nbsp; &nbsp; x = self.conv_n_2(x)\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; return x\n</code></pre><p>å…¶å®è¿™éƒ¨åˆ†é‡å¤çš„ç»“æ„å®Œå…¨å¯ä»¥æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„moduleä¸­ï¼Œç„¶åï¼Œåœ¨æˆ‘ä»¬æ¨¡å‹ä¸­ç›´æ¥è°ƒç”¨è¿™éƒ¨åˆ†å³å¯ï¼Œå…·ä½“å®ç°ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-python\">class CustomLayer(nn.Module):\n  def __init__(self, input_channels, output_channels):\n    super().__init__()\n    self.conv1_1 = nn.Conv2d(in_channels=input_channels, out_channels=3, kernel_size=3, padding='same')\n    self.conv1_2 = nn.Conv2d(in_channels=3, out_channels=output_channels, kernel_size=2, padding='same')\n    \n  def forward(self, input):\n    x = self.conv1_1(input)\n    x = self.conv1_2(x)\n    return x\n    \n</code></pre><p>ç„¶åå‘¢ï¼ŒCustomModelå°±å˜æˆä¸‹é¢è¿™æ ·äº†ï¼š</p><pre><code class=\"language-python\">class CustomModel(nn.Module):\n  def __init__(self):\n    super().__init__()\n    self.layer1 = CustomLayer(1ï¼Œ1)\n    ...\n    self.layerm = CustomLayer(1ï¼Œ1)\n    ...\n    self.layern = CustomLayer(1ï¼Œ1)\n  \n  def forward(self, input):\n    x = self.layer1(input)\n    ...\n    x = self.layerm(x)\n    ...    \n    x = self.layern(x)\n    ...\n    return x\n</code></pre><p>ç†Ÿæ‚‰æ·±åº¦å­¦ä¹ çš„åŒå­¦ï¼Œä¸€å®šå¬è¿‡æ®‹å·®å—ã€Inceptionå—è¿™æ ·çš„å¤šå±‚çš„ä¸€ä¸ªç»„åˆã€‚ä½ æ²¡å¬è¿‡ä¹Ÿæ²¡å…³ç³»ï¼Œåœ¨å›¾åƒåˆ†ç±»ä¸­æˆ‘è¿˜ä¼šè®²åˆ°ã€‚è¿™é‡Œä½ åªéœ€è¦çŸ¥é“ï¼Œè¿™ç§å¤šå±‚ç»„åˆçš„ç»“æ„æ˜¯ç±»ä¼¼çš„ï¼Œå¯¹äºè¿™ç§ç»„åˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸Šé¢çš„ä»£ç çš„æ–¹å¼å®ç°ã€‚</p><h3>æ¨¡å‹ä¿å­˜ä¸åŠ è½½</h3><p>æˆ‘ä»¬è®­ç»ƒå¥½çš„æ¨¡å‹æœ€ç»ˆçš„ç›®çš„ï¼Œå°±æ˜¯è¦ä¸ºå…¶ä»–åº”ç”¨æä¾›æœåŠ¡çš„ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½ã€‚</p><p>æ¨¡å‹ä¿å­˜ä¸åŠ è½½çš„è¯æœ‰ä¸¤ç§æ–¹å¼ã€‚PyTorchæ¨¡å‹çš„åç¼€åä¸€èˆ¬æ˜¯ptæˆ–pthï¼Œè¿™éƒ½æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯ä¸€ä¸ªåç¼€åè€Œå·²ã€‚æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„å›å½’æ¨¡å‹ç»§ç»­è®²æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½ã€‚</p><h4>æ–¹å¼ä¸€ï¼šåªä¿å­˜è®­ç»ƒå¥½çš„å‚æ•°</h4><p>ç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯åªä¿å­˜è®­ç»ƒå¥½çš„å‚æ•°ã€‚ç„¶ååŠ è½½æ¨¡å‹çš„æ—¶å€™ï¼Œä½ éœ€è¦é€šè¿‡ä»£ç åŠ è½½ç½‘ç»œç»“æ„ï¼Œç„¶åå†å°†å‚æ•°èµ‹äºˆç½‘ç»œã€‚</p><p>åªä¿å­˜å‚æ•°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\">torch.save(model.state_dict(), './linear_model.pth')\n</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å‹çš„state_dictï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°è¦ä¿å­˜çš„ä½ç½®ã€‚</p><p>ä»£ç ä¸­çš„state_dictæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œåœ¨æ¨¡å‹è¢«å®šä¹‰ä¹‹åä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œå­˜å‚¨çš„æ˜¯æ¨¡å‹<strong>å¯è®­ç»ƒ</strong>çš„å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºçº¿æ€§å›å½’æ¨¡å‹çš„state_dictï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\">model.state_dict()\nè¾“å‡ºï¼šOrderedDict([('weight', tensor([[2.0071]])), ('bias', tensor([3.1690]))])\n</code></pre><p>åŠ è½½æ¨¡å‹çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\"># å…ˆå®šä¹‰ç½‘ç»œç»“æ„\nlinear_model = LinearModel()\n# åŠ è½½ä¿å­˜çš„å‚æ•°\nlinear_model.load_state_dict(torch.load('./linear_model.pth'))\nlinear_model.eval()\nfor parameter in linear_model.named_parameters():\n&nbsp; print(parameter)\nè¾“å‡ºï¼š\n('weight', Parameter containing:\ntensor([[2.0071]], requires_grad=True))\n('bias', Parameter containing:\ntensor([3.1690], requires_grad=True))\n</code></pre><p>è¿™é‡Œæœ‰ä¸ªmodel.eval()éœ€è¦ä½ æ³¨æ„ä¸€ä¸‹ï¼Œå› ä¸ºæœ‰äº›å±‚ï¼ˆä¾‹å¦‚ï¼ŒDropoutä¸BNï¼‰åœ¨è®­ç»ƒæ—¶ä¸è¯„ä¼°æ—¶çš„çŠ¶æ€æ˜¯ä¸ä¸€æ ·çš„ï¼Œå½“è¿›å…¥è¯„ä¼°æ—¶è¦æ‰§è¡Œmodel.eval()ï¼Œæ¨¡å‹æ‰èƒ½è¿›å…¥è¯„ä¼°çŠ¶æ€ã€‚è¿™é‡Œè¯´çš„è¯„ä¼°ä¸å…‰å…‰æŒ‡ä»£è¯„ä¼°æ¨¡å‹ï¼Œä¹ŸåŒ…æ‹¬æ¨¡å‹ä¸Šçº¿æ—¶å€™æ—¶çš„çŠ¶æ€ã€‚</p><h4>æ–¹å¼äºŒï¼šä¿å­˜ç½‘ç»œç»“æ„ä¸å‚æ•°</h4><p>ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼åœ¨åŠ è½½æ¨¡å‹çš„æ—¶å€™ï¼Œä¸éœ€è¦åŠ è½½ç½‘ç»œç»“æ„äº†ã€‚å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\"># ä¿å­˜æ•´ä¸ªæ¨¡å‹\ntorch.save(model, './linear_model_with_arc.pth')\n# åŠ è½½æ¨¡å‹ï¼Œä¸éœ€è¦åˆ›å»ºç½‘ç»œäº†\nlinear_model_2 = torch.load('./linear_model_with_arc.pth')\nlinear_model_2.eval()\nfor parameter in linear_model_2.named_parameters():\n&nbsp; print(parameter)\n# è¾“å‡ºï¼š\n('weight', Parameter containing:\ntensor([[2.0071]], requires_grad=True))\n('bias', Parameter containing:\ntensor([3.1690], requires_grad=True))\n</code></pre><p>è¿™æ ·æ“ä½œä»¥åï¼Œå¦‚æœä½ æˆåŠŸè¾“å‡ºäº†ç›¸åº”æ•°å€¼ï¼Œè€Œä¸”è·Ÿä¹‹å‰ä¿å­˜çš„æ¨¡å‹çš„å‚æ•°ä¸€è‡´ï¼Œå°±è¯´æ˜åŠ è½½å¯¹äº†ã€‚</p><h2>ä½¿ç”¨Torchvisonä¸­çš„æ¨¡å‹è¿›è¡Œè®­ç»ƒ</h2><p>æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒTorchvisionæä¾›äº†ä¸€äº›å°è£…å¥½çš„ç½‘ç»œç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿è¿‡æ¥ä½¿ç”¨ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰ç»†è¯´å¦‚ä½•ä½¿ç”¨å®ƒä»¬åœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™äº›ç½‘ç»œç»“æ„ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ä¸Šè®­ç»ƒæˆ‘ä»¬è‡ªå·±çš„æ¨¡å‹ã€‚</p><h3>å†è¯´å¾®è°ƒ</h3><p>å…¶å®ï¼ŒTorchvisionæä¾›çš„æ¨¡å‹æœ€å¤§çš„ä½œç”¨å°±æ˜¯å½“ä½œæˆ‘ä»¬è®­ç»ƒæ—¶çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œç”¨æ¥åŠ é€Ÿæˆ‘ä»¬æ¨¡å‹æ”¶æ•›çš„é€Ÿåº¦ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å¾®è°ƒã€‚</p><p>å¯¹äºå¾®è°ƒï¼Œæœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ä¹‹å‰è®²çš„<strong>è°ƒæ•´æœ€åå…¨è¿æ¥å±‚è¾“å‡ºçš„æ•°ç›®</strong>ã€‚Torchvisionä¸­åªæ˜¯å¯¹å„å¤§ç½‘ç»œç»“æ„çš„å¤ç°ï¼Œè€Œä¸æ˜¯å¯¹å®ƒä»¬è¿›è¡Œäº†ç»Ÿä¸€çš„å°è£…ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹å…¨è¿æ¥å±‚æ—¶ï¼Œä¸åŒçš„ç½‘ç»œæœ‰ä¸åŒçš„ä¿®æ”¹æ–¹æ³•ã€‚</p><p>ä¸è¿‡ä½ ä¹Ÿåˆ«æ‹…å¿ƒï¼Œè¿™ä¸ªä¿®æ”¹å¹¶ä¸å¤æ‚ï¼Œä½ åªéœ€è¦æ‰“å°å‡ºç½‘ç»œç»“æ„ï¼Œå°±å¯ä»¥çŸ¥é“å¦‚ä½•ä¿®æ”¹äº†ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ä»¥AlexNetä¸ºä¾‹å¸¦ä½ å°è¯•ä¸€ä¸‹å¦‚ä½•å¾®è°ƒã€‚</p><p>å‰é¢è®²Torchvisionçš„æ—¶å€™å…¶å®æåˆ°è¿‡ä¸€æ¬¡å¾®è°ƒï¼Œé‚£ä¸ªæ—¶å€™è¯´çš„æ˜¯å›ºå®šæ•´ä¸ªç½‘ç»œçš„å‚æ•°ï¼Œåªè®­ç»ƒæœ€åçš„å…¨è¿æ¥å±‚ã€‚ä»Šå¤©æˆ‘å†ç»™ä½ ä»‹ç»å¦å¤–ä¸€ç§å¾®è°ƒçš„æ–¹å¼ï¼Œé‚£å°±æ˜¯ä¿®æ”¹å…¨è¿æ¥å±‚ä¹‹åï¼Œæ•´ä¸ªç½‘ç»œéƒ½é‡æ–°å¼€å§‹è®­ç»ƒã€‚åªä¸è¿‡ï¼Œè¿™æ—¶å€™è¦ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°ä½œä¸ºåˆå§‹åŒ–çš„å‚æ•°ï¼Œè¿™ç§æ–¹å¼æ›´ä¸ºå¸¸ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Torchvisionä¸­æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚</p><p>é¦–å…ˆï¼Œå¯¼å…¥æ¨¡å‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">import torchvision.models as models\nalexnet = models.alexnet(pretrained=True)\n</code></pre><p>è¿™ä¸€æ­¥å¦‚æœä½ ä¸èƒ½â€œç§‘å­¦ä¸Šç½‘â€çš„è¯ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚ä½ å¯ä»¥å…ˆæ ¹æ®å‘½ä»¤ä¸­æç¤ºçš„urlæ‰‹åŠ¨ä¸‹è½½ï¼Œç„¶åä½¿ç”¨ä»Šå¤©è®²çš„æ¨¡å‹åŠ è½½çš„æ–¹å¼åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\">import torchvision.models as models\nalexnet = models.alexnet()\nalexnet.load_state_dict(torch.load('./model/alexnet-owt-4df8aa71.pth'))\n</code></pre><p>ä¸ºäº†éªŒè¯åŠ è½½æ˜¯å¦æˆåŠŸï¼Œæˆ‘ä»¬è®©å®ƒå¯¹ä¸‹å›¾è¿›è¡Œé¢„æµ‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/66/20/666181b44c23e9075debe0daf6126b20.jpg?wh=1920x1867\" alt=\"å›¾ç‰‡\"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">from PIL import Image\nimport torchvision\nimport torchvision.transforms as transforms\n\nim = Image.open('dog.jpg')\n\ntransform = transforms.Compose([\n&nbsp; &nbsp; transforms.RandomResizedCrop((224,224)),\n&nbsp; &nbsp; transforms.ToTensor(),\n&nbsp; &nbsp; transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\n&nbsp; &nbsp; ])\n\ninput_tensor = transform(im).unsqueeze(0)\nalexnet(input_tensor).argmax()\nè¾“å‡ºï¼š263\n</code></pre><p>è¿è¡Œäº†å‰é¢çš„ä»£ç ä¹‹åï¼Œå¯¹åº”åˆ°ImageNetçš„ç±»åˆ«æ ‡ç­¾ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œ263å¯¹åº”çš„æ˜¯Pembrokeï¼ˆæŸ¯åŸºç‹—ï¼‰ï¼Œè¿™å°±è¯æ˜æ¨¡å‹å·²ç»åŠ è½½æˆåŠŸäº†ã€‚<br>\nè¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸¤ä¸ªé‡ç‚¹ä½ è¦ç•™æ„ã€‚</p><p>é¦–å…ˆï¼Œå› ä¸ºTorchvisionä¸­æ‰€æœ‰å›¾åƒåˆ†ç±»çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå®ƒä»¬éƒ½æ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ã€‚æ‰€ä»¥ï¼Œè¾“å…¥æ•°æ®éœ€è¦æ˜¯3é€šé“çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯shapeä¸º(B, 3, H, W)çš„Tensorï¼ŒBä¸ºbatchsizeã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡å€¼ä¸º[0.485, 0.456, 0.406]ï¼Œæ ‡å‡†å·®ä¸º[0.229, 0.224, 0.225]å¯¹æ•°æ®è¿›è¡Œæ­£è§„åŒ–ã€‚</p><p>å¦å¤–ï¼Œä»ç†è®ºä¸Šè¯´ï¼Œå¤§éƒ¨åˆ†çš„ç»å…¸å·ç§¯ç¥ç»æœ€åé‡‡ç”¨å…¨è¿æ¥å±‚ï¼ˆä¹Ÿå°±æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„æ„ŸçŸ¥æœºï¼‰è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ç½‘ç»œçš„è¾“å…¥å°ºå¯¸æ˜¯å›ºå®šçš„ã€‚ä½†æ˜¯ï¼Œåœ¨Torchvisionçš„æ¨¡å‹å¯ä»¥æ¥å—ä»»æ„å°ºå¯¸çš„è¾“å…¥çš„ã€‚</p><p>è¿™æ˜¯å› ä¸ºTorchvisionå¯¹æ¨¡å‹åšäº†ä¼˜åŒ–ï¼Œæœ‰çš„ç½‘ç»œæ˜¯åœ¨æœ€åçš„å·ç§¯å±‚é‡‡ç”¨äº†å…¨å±€å¹³å‡ï¼Œæˆ–è€…é‡‡ç”¨çš„æ˜¯å…¨å·ç§¯ç½‘ç»œã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è®©ç½‘ç»œæ¥å—åœ¨æœ€å°è¾“å…¥å°ºå¯¸åŸºç¡€ä¹‹ä¸Šï¼Œä»»æ„å°ºåº¦çš„è¾“å…¥ã€‚è¿™ä¸€ç‚¹ï¼Œä½ ç°åœ¨å¯èƒ½è®¤è¯†å¾—è¿˜ä¸å¤Ÿæ¸…æ¥šï¼Œä¸è¿‡åˆ«æ‹…å¿ƒï¼Œä»¥åæˆ‘ä»¬å­¦ä¹ å®Œå›¾åƒåˆ†ç±»ç†è®ºä¹‹åï¼Œä½ ä¼šç†è§£å¾—æ›´åŠ é€å½»ã€‚</p><p>æˆ‘ä»¬å›åˆ°å¾®è°ƒè¿™ä¸ªä¸»é¢˜ã€‚æ­£å¦‚åˆšæ‰æ‰€è¯´ï¼Œè®­ç»ƒä¸€ä¸ªAlexNetéœ€è¦çš„æ•°æ®å¿…é¡»æ˜¯ä¸‰é€šé“æ•°æ®ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œæˆ‘ä½¿ç”¨äº†CIFAR-10å…¬å¼€æ•°æ®é›†ä¸¾ä¾‹ã€‚</p><p>CIFAR-10æ•°æ®é›†ä¸€å…±æœ‰60000å¼ å›¾ç‰‡æ„æˆï¼Œå…±10ä¸ªç±»åˆ«ï¼Œæ¯ä¸€ç±»åŒ…å«6000å›¾ç‰‡ã€‚æ¯å¼ å›¾ç‰‡ä¸º32x32çš„RGBå›¾ç‰‡ã€‚å…¶ä¸­50000å¼ å›¾ç‰‡ä½œä¸ºè®­ç»ƒé›†ï¼Œ10000å¼ å›¾ç‰‡ä½œä¸ºæµ‹è¯•é›†ã€‚</p><p>å¯ä»¥è¯´CIFAR-10æ˜¯éå¸¸æ¥è¿‘çœŸå®é¡¹ç›®æ•°æ®çš„æ•°æ®é›†äº†ï¼Œå› ä¸ºçœŸå®é¡¹ç›®ä¸­çš„æ•°æ®é€šå¸¸æ˜¯RGBä¸‰é€šé“æ•°æ®ï¼Œè€ŒCIFAR-10åŒæ ·æ˜¯ä¸‰é€šé“æ•°æ®ã€‚</p><p>æˆ‘ä»¬ç”¨ä¹‹å‰è®²çš„make_gridæ–¹æ³•ï¼Œå°†CIFAR-10çš„æ•°æ®æ‰“å°å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">cifar10_dataset = torchvision.datasets.CIFAR10(root='./data',\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;train=False,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform=transforms.ToTensor(),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;target_transform=None,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;download=True)\n# å–32å¼ å›¾ç‰‡çš„tensor\ntensor_dataloader = DataLoader(dataset=cifar10_dataset,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;batch_size=32)\ndata_iter = iter(tensor_dataloader)\nimg_tensor, label_tensor = data_iter.next()\nprint(img_tensor.shape)\ngrid_tensor = torchvision.utils.make_grid(img_tensor, nrow=16, padding=2)\ngrid_img = transforms.ToPILImage()(grid_tensor)\ndisplay(grid_img)\n</code></pre><p>è¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­çš„transformï¼Œæˆ‘ä¸ºäº†æ‰“å°å›¾ç‰‡åªä½¿ç”¨äº†transform.ToTensor()è¾“å‡ºå›¾ç‰‡ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/f0/f2/f0b5f4ed8c24fbb81c7b7c71a907a6f2.jpg?wh=546x546\" alt=\"\"></p><p>è¿™é‡Œæˆ‘ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªè®­ç»ƒé›†çš„æ•°æ®éƒ½æ˜¯32x32çš„ï¼Œæ‰€ä»¥ä½ ç°åœ¨çœ‹åˆ°çš„å°±æ˜¯åŸå›¾æ•ˆæœï¼Œå›¾ç‰‡å¤§å°å¹¶ä¸å½±å“å’±ä»¬çš„å­¦ä¹ ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¦åšçš„æ˜¯ä¿®æ”¹å…¨è¿æ¥å±‚ï¼Œç›´æ¥printå°±å¯ä»¥æ‰“å°å‡ºç½‘ç»œç»“æ„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">print(alexnet)\nè¾“å‡ºï¼š\nAlexNet(\n  (features): Sequential(\n    (0): Conv2d(3, 64, kernel_size=(11, 11), stride=(4, 4), padding=(2, 2))\n    (1): ReLU(inplace=True)\n    (2): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n    (3): Conv2d(64, 192, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))\n    (4): ReLU(inplace=True)\n    (5): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n    (6): Conv2d(192, 384, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (7): ReLU(inplace=True)\n    (8): Conv2d(384, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (9): ReLU(inplace=True)\n    (10): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (11): ReLU(inplace=True)\n    (12): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n  )\n  (avgpool): AdaptiveAvgPool2d(output_size=(6, 6))\n  (classifier): Sequential(\n    (0): Dropout(p=0.5, inplace=False)\n    (1): Linear(in_features=9216, out_features=4096, bias=True)\n    (2): ReLU(inplace=True)\n    (3): Dropout(p=0.5, inplace=False)\n    (4): Linear(in_features=4096, out_features=4096, bias=True)\n    (5): ReLU(inplace=True)\n    (6): Linear(in_features=4096, out_features=1000, bias=True)\n  )\n)\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åå…¨è¿æ¥å±‚è¾“å…¥æ˜¯4096ä¸ªå•å…ƒï¼Œè¾“å‡ºæ˜¯1000ä¸ªå•å…ƒï¼Œæˆ‘ä»¬è¦æŠŠå®ƒä¿®æ”¹ä¸ºè¾“å‡ºæ˜¯10ä¸ªå•å…ƒçš„å…¨è¿æ¥å±‚ï¼ˆCIFR10æœ‰10ç±»ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\"># æå–åˆ†ç±»å±‚çš„è¾“å…¥å‚æ•°\nfc_in_features = alexnet.classifier[6].in_features\n\n# ä¿®æ”¹é¢„è®­ç»ƒæ¨¡å‹çš„è¾“å‡ºåˆ†ç±»æ•°\nalexnet.classifier[6] = torch.nn.Linear(fc_in_features, 10)\nprint(alexnet)\nè¾“å‡ºï¼š\nAlexNet(\n  (features): Sequential(\n    (0): Conv2d(3, 64, kernel_size=(11, 11), stride=(4, 4), padding=(2, 2))\n    (1): ReLU(inplace=True)\n    (2): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n    (3): Conv2d(64, 192, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))\n    (4): ReLU(inplace=True)\n    (5): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n    (6): Conv2d(192, 384, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (7): ReLU(inplace=True)\n    (8): Conv2d(384, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (9): ReLU(inplace=True)\n    (10): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n    (11): ReLU(inplace=True)\n    (12): MaxPool2d(kernel_size=3, stride=2, padding=0, dilation=1, ceil_mode=False)\n  )\n  (avgpool): AdaptiveAvgPool2d(output_size=(6, 6))\n  (classifier): Sequential(\n    (0): Dropout(p=0.5, inplace=False)\n    (1): Linear(in_features=9216, out_features=4096, bias=True)\n    (2): ReLU(inplace=True)\n    (3): Dropout(p=0.5, inplace=False)\n    (4): Linear(in_features=4096, out_features=4096, bias=True)\n    (5): ReLU(inplace=True)\n    (6): Linear(in_features=4096, out_features=10, bias=True)\n  )\n)\n</code></pre><p>è¿™æ—¶ï¼Œä½ å¯ä»¥å‘ç°è¾“å‡ºå°±å˜ä¸º10ä¸ªå•å…ƒäº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨CIFAR-10ä¸Šï¼Œä½¿ç”¨AlexNetä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹è®­ç»ƒæˆ‘ä»¬è‡ªå·±çš„æ¨¡å‹äº†ã€‚é¦–å…ˆæ˜¯æ•°æ®è¯»å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">transform = transforms.Compose([\n&nbsp; &nbsp; transforms.RandomResizedCrop((224,224)),\n&nbsp; &nbsp; transforms.ToTensor(),\n&nbsp; &nbsp; transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\n&nbsp; &nbsp; ])\ncifar10_dataset = torchvision.datasets.CIFAR10(root='./data',\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;train=False,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform=transform,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;target_transform=None,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;download=True)\ndataloader = DataLoader(dataset=cifar10_dataset, # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;batch_size=32,&nbsp; &nbsp; &nbsp; &nbsp;# è¾“å‡ºçš„batchå¤§å°\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;shuffle=True,&nbsp; &nbsp; &nbsp; &nbsp;# æ•°æ®æ˜¯å¦æ‰“ä¹±\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;num_workers=2)&nbsp; &nbsp; &nbsp; # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹\n</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘æ›´æ”¹äº†transformï¼Œå¹¶ä¸”å°†å›¾ç‰‡resizeåˆ°224x224å¤§å°ã€‚è¿™ä¸ªå°ºå¯¸æ˜¯Torchvisionä¸­æ¨èçš„ä¸€ä¸ªæœ€å°è®­ç»ƒå°ºå¯¸ã€‚æ¨¡å‹å°±æ˜¯æˆ‘ä»¬ä¿®æ”¹åçš„AlexNetï¼Œä¹‹åçš„è®­ç»ƒè·Ÿæˆ‘ä»¬ä¹‹å‰è®²çš„æ˜¯ä¸€æ ·çš„ã€‚<br>\nå…ˆå®šä¹‰ä¼˜åŒ–å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">optimizer = torch.optim.SGD(alexnet.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)\n</code></pre><p>ç„¶åå¼€å§‹æ¨¡å‹è®­ç»ƒï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰åé¢çš„ä»£ç å¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™ï¼Œå®ƒè·Ÿæˆ‘ä»¬ä¹‹å‰è®²çš„ä¸€æ ·ï¼š</p><pre><code class=\"language-python\"># è®­ç»ƒ3ä¸ªEpoch\nfor epoch in range(3):\n&nbsp; &nbsp; for item in dataloader:&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; output = alexnet(item[0])\n&nbsp; &nbsp; &nbsp; &nbsp; target = item[1]\n&nbsp; &nbsp; &nbsp; &nbsp; # ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; loss = nn.CrossEntropyLoss()(output, target)\n&nbsp; &nbsp; &nbsp; &nbsp; print('Epoch {}, Loss {}'.format(epoch + 1 , loss))\n&nbsp; &nbsp; &nbsp; &nbsp; #ä»¥ä¸‹ä»£ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡äº†\n&nbsp; &nbsp; &nbsp; &nbsp; alexnet.zero_grad()\n&nbsp; &nbsp; &nbsp; &nbsp; loss.backward()\n&nbsp; &nbsp; &nbsp; &nbsp; optimizer.step()\n</code></pre><p>è¿™é‡Œç”¨åˆ°çš„å¾®è°ƒæ–¹å¼ï¼Œå°±æ˜¯æ‰€æœ‰å‚æ•°éƒ½éœ€è¦è¿›è¡Œé‡æ–°è®­ç»ƒã€‚</p><p>è€Œç¬¬ä¸€ç§æ–¹å¼ï¼ˆå›ºå®šæ•´ä¸ªç½‘ç»œçš„å‚æ•°ï¼Œåªè®­ç»ƒæœ€åçš„å…¨è¿æ¥å±‚ï¼‰ï¼Œåªéœ€è¦åœ¨è¯»å–å®Œé¢„è®­ç»ƒæ¨¡å‹ä¹‹åï¼Œå°†å…¨è¿æ¥å±‚ä¹‹å‰çš„å‚æ•°å…¨éƒ¨é”æ­»å³å¯ï¼Œä¹Ÿå°±æ˜¯è®©ä»–ä»¬æ— æ³•è®­ç»ƒï¼Œæˆ‘ä»¬æ¨¡å‹è®­ç»ƒæ—¶ï¼Œåªè®­ç»ƒå…¨è¿æ¥å±‚å°±è¡Œäº†ï¼Œå…¶ä½™ä¸€åˆ‡éƒ½ä¸å˜ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-python\">alexnet = models.alexnet()\nalexnet.load_state_dict(torch.load('./model/alexnet-owt-4df8aa71.pth'))\nfor param in alexnet.parameters():\n    param.requires_grad = False\n</code></pre><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„æ¨¡å‹å¾®è°ƒå°±è®²å®Œäº†ï¼Œä½ å¯ä»¥è‡ªå·±åŠ¨æ‰‹è¯•è¯•çœ‹ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©çš„å†…å®¹ï¼Œä¸»è¦æ˜¯å›´ç»•å¦‚ä½•è‡ªå·±æ­å»ºä¸€ä¸ªç½‘ç»œæ¨¡å‹ï¼Œæˆ‘ä»¬ä»‹ç»äº†nn.Moduleæ¨¡å—ä»¥åŠå›´ç»•å®ƒçš„ä¸€äº›æ–¹æ³•ã€‚</p><p>æ ¹æ®è¿™è®²æˆ‘åˆ†äº«ç»™ä½ çš„æ€è·¯ï¼Œä¹‹åå¦‚æœä½ æœ‰ä»€ä¹ˆæƒ³æ³•æ—¶ï¼Œå°±å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªæ¨¡å‹è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ã€‚</p><p>å…¶å®ï¼Œå®é™…çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šè‡ªå·±å»æ„å»ºä¸€ä¸ªç½‘ç»œï¼Œç»å¤§å¤šæ•°éƒ½æ˜¯ç›´æ¥ä½¿ç”¨å‰äººå·²ç»æ„å»ºå¥½çš„ä¸€äº›ç»å…¸ç½‘ç»œï¼Œä¾‹å¦‚ï¼ŒTorchvisionä¸­é‚£äº›æ¨¡å‹ã€‚å½“ä½ å»çœ‹ä¸€äº›è¿˜æ²¡æœ‰è¢«å°è£…åˆ°PyTorchçš„æ¨¡å‹çš„æ—¶å€™ï¼Œä»Šå¤©æ‰€å­¦çš„å†…å®¹å°±èƒ½å¤Ÿå¸®ä½ ç›´æ¥å€Ÿé‰´å‰äººçš„å·¥ä½œç»“æœï¼Œè®­ç»ƒå±äºè‡ªå·±çš„æ¨¡å‹ã€‚</p><p>æœ€åï¼Œæˆ‘å†ç»“åˆè‡ªå·±çš„å­¦ä¹ ç ”ç©¶ç»éªŒï¼Œç»™æœ‰å…´è¶£äº†è§£æ›´å¤šæ·±åº¦å­¦ä¹ çŸ¥è¯†çš„åŒå­¦æä¾›ä¸€äº›å­¦ä¹ çº¿ç´¢ã€‚ç›®å‰æˆ‘ä»¬åªè®²äº†å·ç§¯å±‚ï¼Œå¯¹äºä¸€ä¸ªç½‘ç»œè¿˜æœ‰å¾ˆå¤šå…¶ä½™å±‚ï¼Œæ¯”å¦‚Dropoutã€Poolingå±‚ã€BNå±‚ã€æ¿€æ´»å‡½æ•°ç­‰ã€‚Dropoutå‡½æ•°ã€Poolingå±‚ã€æ¿€æ´»å‡½æ•°ç›¸å¯¹æ¯”è¾ƒå¥½ç†è§£ï¼ŒBNå±‚å¯èƒ½ç¨å¾®å¤æ‚ä¸€äº›ã€‚</p><p>å¦å¤–ï¼Œç»†å¿ƒçš„å°ä¼™ä¼´åº”è¯¥å‘ç°äº†ï¼Œæˆ‘ä»¬åœ¨æ‰“å°AlexNetç½‘ç»œç»“æ„ä¸­çš„æ—¶å€™ï¼Œå®ƒçš„ä¸€éƒ¨åˆ†æ˜¯ä½¿ç”¨nn.Sequentialæ„å»ºçš„ã€‚<strong>nn.Sequentialæ˜¯ä¸€ç§å¿«é€Ÿæ„å»ºç½‘ç»œçš„æ–¹å¼</strong>ï¼Œæœ‰äº†è¿™èŠ‚è¯¾çš„çŸ¥è¯†ä½œå‚¨å¤‡ï¼Œå¼„æ‡‚è¿™ä¸ªæ–¹å¼ä½ ä¼šè§‰å¾—éå¸¸ç®€å•ï¼Œä¹Ÿæ¨èä½ å»çœ‹çœ‹ã€‚</p><h2>æ¯è¯¾ä¸€ç»ƒ</h2><p>è¯·ä½ è‡ªå·±æ„å»ºä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œï¼ŒåŸºäºCIFAR-10ï¼Œè®­ç»ƒä¸€ä¸ªå›¾åƒåˆ†ç±»æ¨¡å‹ã€‚å› ä¸ºè¿˜æ²¡æœ‰å­¦ä¹ å›¾åƒåˆ†ç±»åŸç†ï¼Œæ‰€ä»¥æˆ‘å…ˆå¸®ä½ å†™å¥½äº†ç½‘ç»œçš„ç»“æ„ï¼Œéœ€è¦ä½ è¡¥å…¨æ•°æ®è¯»å–ã€æŸå¤±å‡½æ•°(äº¤å‰ç†µæŸå¤±)ä¸ä¼˜åŒ–æ–¹æ³•ï¼ˆSGDï¼‰ç­‰éƒ¨åˆ†ã€‚</p><pre><code class=\"language-python\">class MyCNN(nn.Module):\n&nbsp; &nbsp; def __init__(self):\n&nbsp; &nbsp; &nbsp; &nbsp; super().__init__()\n&nbsp; &nbsp; &nbsp; &nbsp; self.conv1 = nn.Conv2d(3, 16, kernel_size=3)\n&nbsp; &nbsp; &nbsp; &nbsp; # conv1è¾“å‡ºçš„ç‰¹å¾å›¾ä¸º222x222å¤§å°\n&nbsp; &nbsp; &nbsp; &nbsp; self.fc = nn.Linear(16 * 222 * 222, 10)\n\n&nbsp; &nbsp; def forward(self, input):\n&nbsp; &nbsp; &nbsp; &nbsp; x = self.conv1(input)\n&nbsp; &nbsp; &nbsp; &nbsp; # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³\n&nbsp; &nbsp; &nbsp; &nbsp; x = x.view(x.shape[0], -1)\n&nbsp; &nbsp; &nbsp; &nbsp; x = self.fc(x)\n&nbsp; &nbsp; &nbsp; &nbsp; return x\n</code></pre><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµè®¨è®ºã€‚å¦‚æœè¿™èŠ‚è¯¾å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¨èä½ é¡ºæ‰‹åˆ†äº«ç»™æ›´å¤šçš„åŒäº‹ã€æœ‹å‹ï¼Œè·Ÿä»–ä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p>","neighbors":{"left":{"article_title":"åŠ é¤ | æœºå™¨å­¦ä¹ å…¶å®å°±é‚£ä¹ˆå‡ ä»¶äº‹","id":440393},"right":{"article_title":"15 | å¯è§†åŒ–å·¥å…·ï¼šå¦‚ä½•å®ç°è®­ç»ƒçš„å¯è§†åŒ–ç›‘æ§ï¼Ÿ","id":444252}},"comments":[{"had_liked":false,"id":321794,"user_name":"vcjmhg","can_delete":false,"product_type":"c1","uid":1526461,"ip_address":"","ucode":"B508D1E9B3F974","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/j24oyxHcpB5AMR9pMO6fITqnOFVOncnk2T1vdu1rYLfq1cN6Sj7xVrBVbCvHXUad2MpfyBcE4neBguxmjIxyiaQ/132","comment_is_top":false,"comment_ctime":1637048728,"is_pvip":false,"replies":[{"id":"117273","content":"ğŸ‘ğŸ»ğŸ‘ğŸ» ^^","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1637734497,"ip_address":"","comment_id":321794,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48881688984","product_id":100093301,"comment_content":"class MyCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>        # conv1è¾“å‡ºçš„ç‰¹å¾å›¾ä¸º222x222å¤§å°<br>        self.fc = nn.Linear(16 * 222 * 222, 10)<br><br>    def forward(self, input):<br>        x = self.conv1(input)<br>        # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³<br>        x = x.view(x.shape[0], -1)<br>        x = self.fc(x)<br>        return x<br># å°½é‡ä½¿ç”¨gpuè¿›è¡Œè®­ç»ƒ,å¦‚æœæ²¡æœ‰cpuåˆ™ä½¿ç”¨gpuæ¥è®­ç»ƒ<br>device = torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;)<br>cnn = MyCNN().to(device)<br>transform = transforms.Compose([<br>    # ä¿®æ”¹è£å‰ªå›¾ç‰‡çš„å°ºå¯¸<br>    transforms.RandomResizedCrop((224, 224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>])<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                               train=False,<br>                                               transform=transform,<br>                                               target_transform=None,<br>                                               download=True)<br>dataloader = DataLoader(dataset=cifar10_dataset,  # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°<br>                        batch_size=32,  # è¾“å‡ºçš„batchå¤§å°<br>                        shuffle=True,  # æ•°æ®æ˜¯å¦æ‰“ä¹±<br>                        num_workers=2)  # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹<br># å®šä¹‰ä¼˜åŒ–å™¨<br>optimizer = torch.optim.SGD(cnn.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br>steps = 0<br>for epoch in range(16):<br>    for item in dataloader:<br>        steps += 1<br>        output = cnn(item[0].to(device))<br>        target = item[1].to(device)<br>        # ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°<br>        loss = nn.CrossEntropyLoss()(output, target)<br>        # æ¯100æ­¥æ‰“å°ä¸€æ¬¡loss<br>        if steps % 100 == 0:<br>            print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1, loss))<br>        cnn.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br># æµ‹è¯•åˆ†ç±»ç»“æœ<br>im = Image.open(&#39;data&#47;img.png&#39;)<br>input_tensor = transform(im).unsqueeze(0)<br>result = cnn(input_tensor.to(device)).argmax()<br>print(result)<br># tensor(3, device=&#39;cuda:0&#39;)","like_count":11,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532931,"discussion_content":"ğŸ‘ğŸ»ğŸ‘ğŸ» ^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637734497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532930,"discussion_content":"^^ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637734472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338210,"user_name":"Mr_æå†²","can_delete":false,"product_type":"c1","uid":1631606,"ip_address":"","ucode":"61FAF80BA5FB0B","user_header":"https://static001.geekbang.org/account/avatar/00/18/e5/76/5d0b66aa.jpg","comment_is_top":false,"comment_ctime":1647354303,"is_pvip":true,"replies":[{"id":"123662","content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>å¦‚æœä¿è¯è¾“å…¥ä¸€æ ·ï¼Œæ­£å¸¸ä¸ä¼šè¿™æ ·çš„ã€‚<br>ä½ æ£€æŸ¥æ£€æŸ¥ä½ çš„é¢„å¤„ç†çš„resizeæ˜¯ä¸æ˜¯ä¼šéšæœºåˆ‡å‰²ã€‚<br>è¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œå¯ä»¥æŠŠä½ çš„ä»£ç å‘ç»™æˆ‘çœ‹çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1647408794,"ip_address":"","comment_id":338210,"utype":1}],"discussion_count":7,"race_medal":0,"score":"10237288895","product_id":100093301,"comment_content":"æˆ‘åœ¨ä½¿ç”¨é¢„è®­ç»ƒå¥½çš„alexnet-owt-7be5be79.pthæ¨¡å‹ï¼Œåå¤æ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç çš„æ—¶å€™<br>alexnet(input_tensor).argmax()<br>å¾—åˆ°çš„ç»“æœå¹¶ä¸æ€»æ˜¯263ï¼Œè€Œæœ‰æ—¶å€™ä¼šå¾—åˆ°151å’Œ264æˆ–è€…å…¶ä»–çš„æ•°å€¼ï¼Œè¯·é—®æˆ‘æœ€ç»ˆåº”è¯¥ç›¸ä¿¡å“ªä¸€ä¸ªé¢„æµ‹ç»“æœå‘¢ï¼Œæ˜¯è¿›è¡Œå¤šæ¬¡é¢„æµ‹å–é¢„æµ‹æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªå—ï¼Ÿè¿˜æ˜¯æœ‰åˆ«çš„ç§‘å­¦çš„æ–¹æ³•å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556526,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\nå¦‚æœä¿è¯è¾“å…¥ä¸€æ ·ï¼Œæ­£å¸¸ä¸ä¼šè¿™æ ·çš„ã€‚\nä½ æ£€æŸ¥æ£€æŸ¥ä½ çš„é¢„å¤„ç†çš„resizeæ˜¯ä¸æ˜¯ä¼šéšæœºåˆ‡å‰²ã€‚\nè¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œå¯ä»¥æŠŠä½ çš„ä»£ç å‘ç»™æˆ‘çœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647408794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237846,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e3/56/5fc6c92c.jpg","nickname":"å°ä¼Ÿ","note":"","ucode":"43235F32B7F9D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575619,"discussion_content":"RandomResizedCropå‰ªè£æ˜¯æŒ‰ç…§åƒç´ 1:1çš„å»å‰ªè£ï¼Œä¸‹è½½çš„åŸå›¾æ˜¯1920*1867æŒ‰ç…§224*224å¤§å°å‰ªè£ä¼šå‰©ä½™å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œè¯†åˆ«ä¼šå½±å“æ¯”è¾ƒå¤§ï¼Œå»ºè®®ç›´æ¥å°†åŸå›¾ä½¿ç”¨Resizeåˆ°224*224å¤§å°ï¼Œè¯†åˆ«ç‡ä¼šé«˜å¾ˆå¤šï¼Œä½†æ˜¯è¿˜æ˜¯å¶å°”ä¼šå‡ºç°è¿”å›ç»“æœæ˜¯264æˆ–è€…151çš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654958773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237846,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e3/56/5fc6c92c.jpg","nickname":"å°ä¼Ÿ","note":"","ucode":"43235F32B7F9D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575617,"discussion_content":"è¯•äº†ä¸‹RandomResizedCropï¼Œå¤§æ¦‚80%æƒ…å†µæ˜¯263ï¼Œæ¢æˆCenterCrop,æ‰‹åŠ¨ä¿®æ”¹åŸå›¾å¤§å°ä¸º224*224ï¼Œæ•ˆæœä¹Ÿä¸ç†æƒ³ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸ªæ ‡å‡†æ¨¡å‹è¯†åˆ«æœ¬èº«æ­£ç¡®çš„æ¦‚ç‡å°±ä¸é«˜å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654956608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556900,"discussion_content":"å› ä¸ºä½¿ç”¨çš„æ˜¯transforms.RandomResizedCropï¼Œä¼šéšæœºåˆ‡å‰²å†resizeã€‚\nhttps://pytorch.org/vision/main/generated/torchvision.transforms.RandomResizedCrop.html\næ¢ä¸€ä¸ªä¸éšæœºçš„resizeæ–¹æ³•å°±å¥½äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647568690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1631606,"avatar":"https://static001.geekbang.org/account/avatar/00/18/e5/76/5d0b66aa.jpg","nickname":"Mr_æå†²","note":"","ucode":"61FAF80BA5FB0B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556805,"discussion_content":"æˆ‘çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œæ¯æ¬¡æ‰§è¡Œæœ‰æ—¶å€™ä¼šä¸å¤ªä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647520630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1631606,"avatar":"https://static001.geekbang.org/account/avatar/00/18/e5/76/5d0b66aa.jpg","nickname":"Mr_æå†²","note":"","ucode":"61FAF80BA5FB0B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556804,"discussion_content":"import torch\nimport torchvision.models as models\nalexnet = models.alexnet(pretrained=True)\n\nfrom PIL import Image\nimport torchvision\nimport torchvision.transforms as transforms\nfrom urllib.request import urlopen\nfrom PIL import Image\nurl = &#39;https://static001.geekbang.org/resource/image/66/20/666181b44c23e9075debe0daf6126b20.jpg?wh=1920x1867&#39;\nim = Image.open(urlopen(url))\n\ntransform = transforms.Compose([\n    transforms.RandomResizedCrop((224,224)),\n    transforms.ToTensor(),\n    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])\n    ])\ninput_tensor = transform(im).unsqueeze(0)\nalexnet(input_tensor).argmax()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647520608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1241994,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f3/8a/776a5bef.jpg","nickname":"æœ‰é»å£","note":"","ucode":"274E9FAFE5DF73","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556612,"discussion_content":"ä½ å¥½ï¼Œè¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ æˆ‘ä¹Ÿé‡åˆ°äº†åŒæ ·çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647425642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321763,"user_name":"clee","can_delete":false,"product_type":"c1","uid":1467446,"ip_address":"","ucode":"122875102B23A8","user_header":"","comment_is_top":false,"comment_ctime":1637033684,"is_pvip":false,"replies":[{"id":"116838","content":"hiã€‚<br>CIFAR10çš„å›¾ç‰‡æ¯”è¾ƒå°ï¼ŒçŒ«å’Œç‹—ã€é¹¿å’Œé©¬æ¯”è¾ƒåƒï¼Œä¸€éƒ¨åˆ†å›¾ç‰‡é¢„æµ‹é”™è¯¯æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¯ä»¥åœ¨ä¸‹é¢å°è¯•1ä¹‹åï¼Œç”¨éªŒè¯é›†è¯„ä¼°ä¸€ä¸‹æ¨¡å‹ç²¾ç¡®ä¸å¬å›ï¼Œçœ‹çœ‹æ˜¯å¦ä¸ºä¸€ä¸ªå¯æ¥å—çš„ç»“æœï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£éƒ¨åˆ†å›¾ç‰‡åˆ†é”™æ˜¯æ²¡é—®é¢˜çš„ã€‚<br><br>å¯ä»¥åšå¦‚ä¸‹å°è¯•ï¼š<br>1. æŠŠtrain=Fasleæ”¹ä¸ºTrueã€‚æˆ‘ä¸ºäº†è®²è§£æ–¹ä¾¿ç›´æ¥ä½¿ç”¨éªŒè¯é›†è®­ç»ƒçš„ã€‚<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                               train=False,<br>                                               transform=transform,<br>                                           target_transform=None,<br>                                               download=True)<br>2. æŠŠå­¦ä¹ ç‡è°ƒå°ä¸€ç‚¹è¯•è¯•ã€‚^^","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1637050341,"ip_address":"","comment_id":321763,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10226968276","product_id":100093301,"comment_content":"è°ƒæ•´ä¹‹åï¼Œå¯ä»¥æ­£å¸¸è®­ç»ƒäº†ï¼Œä½†æ˜¯æµ‹è¯•æ•°æ®çš„æ—¶å€™æˆ‘å‘ç°æœ‰äº›å›¾ç‰‡åˆ†ç±»ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚ç‹—å’ŒçŒ«ï¼Œé¹¿å’Œé©¬å°±å®¹æ˜“åˆ†ç±»é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºæ¬ æ‹Ÿåˆå—ï¼Ÿåº”è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530346,"discussion_content":"hiã€‚\nCIFAR10çš„å›¾ç‰‡æ¯”è¾ƒå°ï¼ŒçŒ«å’Œç‹—ã€é¹¿å’Œé©¬æ¯”è¾ƒåƒï¼Œä¸€éƒ¨åˆ†å›¾ç‰‡é¢„æµ‹é”™è¯¯æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¯ä»¥åœ¨ä¸‹é¢å°è¯•1ä¹‹åï¼Œç”¨éªŒè¯é›†è¯„ä¼°ä¸€ä¸‹æ¨¡å‹ç²¾ç¡®ä¸å¬å›ï¼Œçœ‹çœ‹æ˜¯å¦ä¸ºä¸€ä¸ªå¯æ¥å—çš„ç»“æœï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£éƒ¨åˆ†å›¾ç‰‡åˆ†é”™æ˜¯æ²¡é—®é¢˜çš„ã€‚\n\nå¯ä»¥åšå¦‚ä¸‹å°è¯•ï¼š\n1. æŠŠtrain=Fasleæ”¹ä¸ºTrueã€‚æˆ‘ä¸ºäº†è®²è§£æ–¹ä¾¿ç›´æ¥ä½¿ç”¨éªŒè¯é›†è®­ç»ƒçš„ã€‚\ncifar10_dataset = torchvision.datasets.CIFAR10(root=&amp;#39;./data&amp;#39;,\n                                               train=False,\n                                               transform=transform,\n                                           target_transform=None,\n                                               download=True)\n2. æŠŠå­¦ä¹ ç‡è°ƒå°ä¸€ç‚¹è¯•è¯•ã€‚^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637050341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346346,"user_name":"äºšæ—","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1653037310,"is_pvip":false,"replies":[{"id":"126418","content":"è¿™ä¸ªåªèƒ½é€šè¿‡é¡¹ç›®æ€»ç»“äº†ã€‚<br>æ¯ä¸€ç§æŸå¤±å‡½æ•°ä¼šè§£å†³ä¸åŒçš„é—®é¢˜ï¼Œå¯ä»¥çœ‹çœ‹å›¾åƒåˆ†å‰²é‚£èŠ‚ã€‚<br>^^","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1653287964,"ip_address":"","comment_id":346346,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5948004606","product_id":100093301,"comment_content":"ç…§æŠ„æŠ„å‡ºæ¥äº†ï¼Œä½†æ˜¯å¯¹æŸå¤±å‡½æ•°é€‰å–ï¼Œä¼˜åŒ–å™¨å‚æ•°è®¾ç½®ï¼Œè¿˜æ˜¯ä¸€è„¸æ‡µ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573238,"discussion_content":"è¿™ä¸ªåªèƒ½é€šè¿‡é¡¹ç›®æ€»ç»“äº†ã€‚\næ¯ä¸€ç§æŸå¤±å‡½æ•°ä¼šè§£å†³ä¸åŒçš„é—®é¢˜ï¼Œå¯ä»¥çœ‹çœ‹å›¾åƒåˆ†å‰²é‚£èŠ‚ã€‚\n^^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653287964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345534,"user_name":"zhangting","can_delete":false,"product_type":"c1","uid":2950861,"ip_address":"","ucode":"565BB6CEE694E0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDm5eHbw1fuicJiaXercgBI48O0Idt2mHUElmZyBM4o119NkndU1SNpsv8rZzKFibj8z1FibFAdNEO3zw/132","comment_is_top":false,"comment_ctime":1652363685,"is_pvip":false,"replies":[{"id":"126122","content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>è¾“å‡º5ä¸æ˜¯æ­£ç¡®çš„å—ï¼Ÿ<br>cifar10é‡Œdogå°±æ˜¯5å•Š","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1652411232,"ip_address":"","comment_id":345534,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5947330981","product_id":100093301,"comment_content":"è€å¸ˆè¯·æ•™ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ”¹å…¨è¿æ¥åï¼Œè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ï¼Œæ€»æ˜¯è¾“å‡ºçš„æ˜¯5ã€‚è€Œæœªåšæ”¹åŠ¨å‰ï¼Œé¢„æµ‹å‡ºæ¥çš„æ˜¯263.æºç å¦‚ä¸‹ï¼š<br><br>alexnet = models.alexnet()<br>alexnet.load_state_dict(torch.load(&#39;.&#47;model&#47;alexnet-owt-7be5be79.pth&#39;)) <br><br>fc_in_features = alexnet.classifier[6].in_features<br><br>alexnet.classifier[6] = torch.nn.Linear(fc_in_features, 10)<br>print(alexnet)<br><br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br><br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,                                       <br>                                               train=False,                                       <br>                                               transform=transform,                                       <br>                                               target_transform=None,                                       <br>                                               download=False)<br>dataloader = DataLoader(dataset=cifar10_dataset, batch_size=32, shuffle=True, num_workers=4)<br><br>optimizer = torch.optim.SGD(alexnet.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>for epoch in range(3):<br>    for item in dataloader: <br>        output = alexnet(item[0])<br>        target = item[1]<br>        loss = nn.CrossEntropyLoss()(output, target)<br>        print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss))<br>        alexnet.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br>       <br>im = Image.open(&#39;dog.jpg&#39;)<br>transform = transforms.Compose([<br>    transforms.Resize((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br>input_tensor = transform(im).unsqueeze(0)<br><br>alexnet.eval()<br><br>print(alexnet(input_tensor).argmax())","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571798,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\nè¾“å‡º5ä¸æ˜¯æ­£ç¡®çš„å—ï¼Ÿ\ncifar10é‡Œdogå°±æ˜¯5å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652411232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":2950861,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDm5eHbw1fuicJiaXercgBI48O0Idt2mHUElmZyBM4o119NkndU1SNpsv8rZzKFibj8z1FibFAdNEO3zw/132","nickname":"zhangting","note":"","ucode":"565BB6CEE694E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":571801,"discussion_content":"è€å¸ˆï¼Œé‚£ä¸ºå•¥æœªåšå¾®è°ƒå‰æ˜¯263ï¼Ÿåˆå­¦è€…ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œéº»çƒ¦è€å¸ˆäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652412136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":571798,"ip_address":""},"score":571801,"extra":""},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2950861,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDm5eHbw1fuicJiaXercgBI48O0Idt2mHUElmZyBM4o119NkndU1SNpsv8rZzKFibj8z1FibFAdNEO3zw/132","nickname":"zhangting","note":"","ucode":"565BB6CEE694E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572228,"discussion_content":"ä¹‹å‰çš„æ¨¡å‹æ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ï¼ŒImageNetç‹—çš„ç±»åˆ«æ˜¯263ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652665935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":571801,"ip_address":""},"score":572228,"extra":""}]}]},{"had_liked":false,"id":344443,"user_name":"åˆ˜åˆ©","can_delete":false,"product_type":"c1","uid":1503779,"ip_address":"","ucode":"A46571E6B1C58E","user_header":"https://static001.geekbang.org/account/avatar/00/16/f2/23/bb13b3ed.jpg","comment_is_top":false,"comment_ctime":1651560077,"is_pvip":false,"replies":[{"id":"125779","content":"ä½ å¥½ï¼Œåˆ˜åˆ©ï¼Œæ„Ÿè°¢ç•™è¨€ã€‚<br>å°±åªè®­ç»ƒå…¨è¿æ¥å±‚äº†ã€‚<br>finetuneçš„æ—¶å€™ä¼šæ ¹æ®ä½ çš„åˆ†ç±»ä»»åŠ¡ï¼Œæ–°åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚(è€Œä¸æ˜¯ä½¿ç”¨åŸæ¨¡å‹çš„)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1651716473,"ip_address":"","comment_id":344443,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5946527373","product_id":100093301,"comment_content":"hiï¼Œè€å¸ˆï¼Œå¾®è°ƒçš„æ—¶å€™ï¼Œå¦‚æœè¿™æ ·å†™ï¼Œå‚æ•°éƒ½ä¸æ›´æ–°äº†ï¼Œé‚£è¿˜æœ‰å“ªéƒ¨åˆ†å‚æ•°ä¼šè¢«è®­ç»ƒå‘¢ï¼Ÿæ˜¯éœ€è¦å†æ¥ä¸€å±‚å…¨è¿æ¥å±‚ä¹ˆï¼Ÿ<br>alexnet = models.alexnet()<br>alexnet.load_state_dict(torch.load(&#39;.&#47;model&#47;alexnet-owt-4df8aa71.pth&#39;))<br>for param in alexnet.parameters(): <br>    param.requires_grad = False","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570248,"discussion_content":"ä½ å¥½ï¼Œåˆ˜åˆ©ï¼Œæ„Ÿè°¢ç•™è¨€ã€‚\nå°±åªè®­ç»ƒå…¨è¿æ¥å±‚äº†ã€‚\nfinetuneçš„æ—¶å€™ä¼šæ ¹æ®ä½ çš„åˆ†ç±»ä»»åŠ¡ï¼Œæ–°åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚(è€Œä¸æ˜¯ä½¿ç”¨åŸæ¨¡å‹çš„)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651716473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1212044,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7e/8c/f029535a.jpg","nickname":"hallo128","note":"","ucode":"3921D6E11CFCB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":580704,"discussion_content":"åªè®­ç»ƒå…¨è¿æ¥å±‚è¿™é‡Œæˆ‘ä¹Ÿæ˜¯æœ‰ç–‘é—®ï¼Œé‚£æ˜¯è¯´ä¸ç”¨å¢åŠ ä¿®æ”¹é¢„è®­ç»ƒæ¨¡å‹çš„è¾“å‡ºåˆ†ç±»æ•°äº†å—ï¼ˆalexnet.classifier[6] = torch.nn.Linear(fc_in_features, 10)ï¼‰ï¼Ÿè¿˜æ˜¯è¯´å†å›ºå®šå‚æ•°åï¼Œè‡ªå·±å†æ‰‹åŠ¨åŠ ä¸€å±‚å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658324577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":570248,"ip_address":""},"score":580704,"extra":""}]}]},{"had_liked":false,"id":321262,"user_name":"é©¬å…‹å›¾å¸ƒ","can_delete":false,"product_type":"c1","uid":1019274,"ip_address":"","ucode":"9E3879D6A55244","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","comment_is_top":false,"comment_ctime":1636728821,"is_pvip":false,"replies":[{"id":"116681","content":"ä½ å¥½ï¼Œé©¬å…‹å›¾å¸ƒï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>å¯¹ï¼Œå†…ç½®äº†Softmaxã€‚<br><br>å‡å€¼[0.485, 0.456, 0.406]ï¼Œæ ‡å‡†å·®[0.229, 0.224, 0.225]<br>æ˜¯ImageNetçš„å‡å€¼ä¸æ ‡å‡†å·®ã€‚torchvisionä¸­çš„æ¨¡å‹éƒ½æ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636806587,"ip_address":"","comment_id":321262,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5931696117","product_id":100093301,"comment_content":"æ€è€ƒï¼š<br><br>ä½¿ç”¨ `nn.CrossEntropyLoss` ä½œä¸º loss function æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ç½‘ç»œæœ€åæ·»åŠ  `nn.LogSoftmax` å’Œ `nn.nLLLos`ï¼Œå› æ­¤ä¸ç”¨å†åœ¨ fc å±‚åé¢æ‰‹åŠ¨æ·»åŠ  Softmax å±‚ï¼›<br><br>é—®é¢˜ï¼š<br><br>transform ä¸­ï¼Œæ ‡å‡†åŒ–çš„ mean å’Œ std æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨å‡å€¼ä¸º[0.485, 0.456, 0.406]ï¼Œæ ‡å‡†å·®ä¸º[0.229, 0.224, 0.225]å¯¹æ•°æ®è¿›è¡Œæ­£è§„åŒ–ï¼‰ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530253,"discussion_content":"ä½ å¥½ï¼Œé©¬å…‹å›¾å¸ƒï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\nå¯¹ï¼Œå†…ç½®äº†Softmaxã€‚\n\nå‡å€¼[0.485, 0.456, 0.406]ï¼Œæ ‡å‡†å·®[0.229, 0.224, 0.225]\næ˜¯ImageNetçš„å‡å€¼ä¸æ ‡å‡†å·®ã€‚torchvisionä¸­çš„æ¨¡å‹éƒ½æ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636806587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358837,"user_name":"æ¨æ°","can_delete":false,"product_type":"c1","uid":1131823,"ip_address":"åŒ—äº¬","ucode":"74817EA9499843","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/2f/b0b0dd74.jpg","comment_is_top":false,"comment_ctime":1664876097,"is_pvip":false,"replies":[{"id":"130615","content":"ä½ å¥½ï¼Œå› ä¸ºä½¿ç”¨äº†éšæœºå‰ªè£ã€‚<br>transforms.RandomResizedCrop((224,224))ã€‚<br>å¹¶ä¸”æ²¡æœ‰åŠ alexnet.eval()","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1665306307,"ip_address":"åŒ—äº¬","comment_id":358837,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1664876097","product_id":100093301,"comment_content":"import torchvision.models as models<br>from PIL import Image<br>import torchvision<br>import torchvision.transforms as transforms<br><br>alexnet = models.alexnet(pretrained=True)<br><br>im = Image.open(&#39;.&#47;data&#47;dog.jpg&#39;)<br><br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br><br>input_tensor = transform(im).unsqueeze(0)<br>print(alexnet(input_tensor).argmax())<br><br>ä»¥ä¸Šä»£ç è¾“å‡ºçš„ä¸ä¸€å®šæ˜¯264ï¼Œè¿™ä¸ªæ˜¯å•¥æƒ…å†µï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589769,"discussion_content":"ä½ å¥½ï¼Œå› ä¸ºä½¿ç”¨äº†éšæœºå‰ªè£ã€‚\ntransforms.RandomResizedCrop((224,224))ã€‚\nå¹¶ä¸”æ²¡æœ‰åŠ alexnet.eval()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665306307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354011,"user_name":"Geek_827444","can_delete":false,"product_type":"c1","uid":3091330,"ip_address":"åŒ—äº¬","ucode":"B205EFB4F6DC01","user_header":"","comment_is_top":false,"comment_ctime":1660014706,"is_pvip":false,"replies":[{"id":"129292","content":"æŠ±æ­‰ï¼Œå›å¤è¿Ÿäº†ã€‚<br>æˆ‘æ‰§è¡Œäº†ä½ çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰æŠ¥é”™ã€‚ä½ æç¤ºä»€ä¹ˆé”™è¯¯å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1661320358,"ip_address":"åŒ—äº¬","comment_id":354011,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660014706","product_id":100093301,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼šæˆ‘ä¸€æ­¥ä¸€æ­¥æŒ‰ç…§å’±ä»¬é‚£ä¸ªæ­¥éª¤æ¥çš„ï¼Œä¸ºä»€ä¹ˆä»£ç è¿è¡Œä¸äº†é‚£ï¼Ÿè°¢è°¢æ‚¨ï¼<br><br>import torch<br>import torch.nn as nn<br>import torch.optim as optim<br>import torchvision.models as models<br><br>import torchvision.models as models<br>alexnet = models.alexnet(pretrained=True)<br><br><br>import torchvision.transforms as transforms<br><br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485,0.456,0.406],std=[0.229,0.224,0.225])<br>])<br><br>import torchvision<br><br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,#æ³¨ï¼šè¿™é‡Œæ˜¯å­˜åœ¨\t\t\t\t\t\t\t\t\t\t\t\t\tpycharmæ–‡ä»¶å½“ä¸­çš„dataæ–‡ä»¶å¤¹é‡Œ<br>                                              train=False,<br>                                              transform=transform,<br>                                              target_transform=None,<br>                                              download=True)<br><br>from torch.utils.data import DataLoader<br><br>dataloader = DataLoader(dataset=cifar10_dataset,<br>                       batch_size=32,<br>                       shuffle=True,<br>                       num_workers=2)<br><br><br><br>fc_in_features = alexnet.classifier[6].in_features<br>alexnet.classifier[6] = torch.nn.Linear(fc_in_features,10)<br><br>optimizer = torch.optim.SGD(alexnet.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>for epoch in range(3):<br>    # â†“å®šä¹‰æ¯”å¯¹çš„å…ƒç´ <br>    for item in dataloader:<br>        output = alexnet(item[0])<br>        target = item[1]<br><br>        # â†“ä½¿ç”¨æŸå¤±å‡½æ•°<br>        loss = nn.CrossEntropyLoss()(output, target)<br>        print(&#39;Epoch{},Loss{}&#39;.format(epoch + 1, loss))<br><br>        # â†“æ›´æ–°æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å‡½æ•°<br>        alexnet.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br><br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585070,"discussion_content":"æŠ±æ­‰ï¼Œå›å¤è¿Ÿäº†ã€‚\næˆ‘æ‰§è¡Œäº†ä½ çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰æŠ¥é”™ã€‚ä½ æç¤ºä»€ä¹ˆé”™è¯¯å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661320358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353830,"user_name":"John(æ˜“ç­‹)","can_delete":false,"product_type":"c1","uid":1180202,"ip_address":"åŒ—äº¬","ucode":"BB4E58DD4B8F15","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg","comment_is_top":false,"comment_ctime":1659844770,"is_pvip":true,"replies":[{"id":"128766","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1660014421,"ip_address":"åŒ—äº¬","comment_id":353830,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659844770","product_id":100093301,"comment_content":"å·¨äººè‚©è†€@é©¬å…‹å›¾åº“<br>import torch<br>import torch.nn as nn<br>import torchvision<br>import torchvision.transforms as transforms<br>from PIL import Image<br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224, 224)), <br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>])<br><br>cifar10_train_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,train=True,transform=transform,target_transform=None)<br>train_loader = torch.utils.data.DataLoader(dataset=cifar10_train_dataset,batch_size=32,shuffle=True,num_workers=2) <br>classes = (&#39;plane&#39;, &#39;car&#39;, &#39;bird&#39;, &#39;cat&#39;, &#39;deer&#39;, &#39;dog&#39;, &#39;frog&#39;, &#39;horse&#39;, &#39;ship&#39;, &#39;truck&#39;)<br>n_total_steps = len(train_loader)<br><br>class MyCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>        self.fc = nn.Linear(16 * 222 * 222, 10)<br>        <br>    def forward(self, input):<br>        x = self.conv1(input)<br>        x = x.view(x.shape[0], -1)<br>        x = self.fc(x)<br>        return x<br>    <br>device = torch.device(&#39;cuda:0&#39; if torch.cuda.is_available() else &#39;cpu&#39;)<br>model = MyCNN().to(device)<br><br>criterion = nn.CrossEntropyLoss() <br>optimizer = torch.optim.SGD(model.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>print(&#39;Start training...&#39;)<br>for epoch in range(4):<br>    for i, (images, labels) in enumerate(train_loader):<br>        images = images.to(device)<br>        labels = labels.to(device)<br>        labels_pred = model(images)<br>        loss = criterion(labels_pred, labels)<br>        <br>        optimizer.zero_grad()<br>        loss.backward()<br>        optimizer.step<br>        <br>        if (i+1) % 100 == 0:<br>            print(f&#39;Epoch [{epoch+1}&#47;{4}], Step [{i+1:5d}&#47;{n_total_steps}], Loss={loss.item():.4f}&#39;)<br><br>print(&#39;Training complete!&#39;)<br><br>with torch.no_grad():<br>    im = Image.open(&#39;.&#47;images&#47;dog.jpg&#39;)<br>    input_tensor = transform(im).unsqueeze(0).to(device)<br>    label_pred = model(input_tensor).argmax()<br>    print(f&#39;Your label predicted: {classes[label_pred]}&#39;)","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583291,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660014422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353824,"user_name":"John(æ˜“ç­‹)","can_delete":false,"product_type":"c1","uid":1180202,"ip_address":"å¹¿ä¸œ","ucode":"BB4E58DD4B8F15","user_header":"https://static001.geekbang.org/account/avatar/00/12/02/2a/90e38b94.jpg","comment_is_top":false,"comment_ctime":1659840989,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1659840989","product_id":100093301,"comment_content":"&#47;&#47; è¿™é‡Œéœ€è¦ import DataLoader<br>from torch.utils.data import Dataset, DataLoader<br><br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#47;&#39;,<br>                                              train=False,<br>                                              transform=transforms.ToTensor(),<br>                                              target_transform=None,<br>                                              download=True)<br>tensor_dataloader = DataLoader(dataset=cifar10_dataset,                               <br>                               batch_size=32)<br>data_iter = iter(tensor_dataloader)<br>img_tensor, label_tensor = data_iter.next()<br>print(img_tensor.shape)<br>grid_tensor = torchvision.utils.make_grid(img_tensor, nrow=16, padding=2)<br>grid_img = transforms.ToPILImage()(grid_tensor)<br>display(grid_img)<br>","like_count":0,"discussions":[{"author":{"id":1074927,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcZh2daicchEpEiaQZcSesibP6DcklcSE0aejLqA97iaqJjQF3ZbO0NmIUwAIIXwqv4iaz5EYICTPfGJg/132","nickname":"rock","note":"","ucode":"D104A18BC07906","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588260,"discussion_content":"æ‰“ä¸€å‡ºæ¥çš„å°±ä¸¤è¡Œï¼Œè€å¸ˆå‘çš„å›¾æ€ä¹ˆå¾ˆå¤šè¡Œï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663638213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352528,"user_name":"Zeurd","can_delete":false,"product_type":"c1","uid":2919792,"ip_address":"é™•è¥¿","ucode":"7CE1E0F76C3313","user_header":"https://static001.geekbang.org/account/avatar/00/2c/8d/70/b0047299.jpg","comment_is_top":false,"comment_ctime":1658747345,"is_pvip":true,"replies":[{"id":"128356","content":"ä½ å¥½ï¼ŒZeurdï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚V3çš„è¯æ¯”è¾ƒç‰¹æ®Šï¼Œæœ‰ä¸¤ä¸ªè¾“å‡ºï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªå°±è¡Œã€‚<br>ä½ å¯ä»¥è¿™æ ·ä¿®æ”¹ä½ çš„ä»£ç ã€‚<br>output, _ = your_v3_model(data)<br><br>å…·ä½“ä½ å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œhttps:&#47;&#47;pytorch.org&#47;tutorials&#47;beginner&#47;finetuning_torchvision_models_tutorial.html#inception-v3<br><br>Finally, Inception v3 was first described in Rethinking the Inception Architecture for Computer Vision. This network is unique because it has two output layers when training. The second output is known as an auxiliary output and is contained in the AuxLogits part of the network. The primary output is a linear layer at the end of the network. Note, when testing we only consider the primary output. ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1659079496,"ip_address":"é™•è¥¿","comment_id":352528,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1658747345","product_id":100093301,"comment_content":"è€å¸ˆï¼Œæƒ³è¯·é—®ä¸€ä¸‹ï¼Œæˆ‘åœ¨æ¢äº†ä¸€ä¸ªæ¨¡å‹InceptionV3ï¼ŒåšæŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œä¼šæç¤ºæˆ‘argument &#39;input&#39; (position 1) must be Tensor, not InceptionOutputsè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿæˆ‘ç”¨outputé¢„æµ‹å®Œè¾“å‡ºçš„æ˜¯ä¸€ä¸ªInceptionOutPutsçš„é‡ï¼Œè€Œä¸æ˜¯Tensorå½¢å¼çš„ï¼Œå½“æˆ‘æƒ³ç”¨torch.tensoråˆä¼šæç¤ºæˆ‘ä¸æ˜¯ä¸€ç»´çš„ï¼Œä¸èƒ½è½¬åŒ–","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581942,"discussion_content":"ä½ å¥½ï¼ŒZeurdï¼Œæ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚V3çš„è¯æ¯”è¾ƒç‰¹æ®Šï¼Œæœ‰ä¸¤ä¸ªè¾“å‡ºï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªå°±è¡Œã€‚\nä½ å¯ä»¥è¿™æ ·ä¿®æ”¹ä½ çš„ä»£ç ã€‚\noutput, _ = your_v3_model(data)\n\nå…·ä½“ä½ å¯ä»¥å‚è€ƒè¿™é‡Œï¼Œhttps://pytorch.org/tutorials/beginner/finetuning_torchvision_models_tutorial.html#inception-v3\n\nFinally, Inception v3 was first described in Rethinking the Inception Architecture for Computer Vision. This network is unique because it has two output layers when training. The second output is known as an auxiliary output and is contained in the AuxLogits part of the network. The primary output is a linear layer at the end of the network. Note, when testing we only consider the primary output. ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659079496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349434,"user_name":"ä¸‡åŒ–8af10b","can_delete":false,"product_type":"c1","uid":1916746,"ip_address":"","ucode":"A5A212C8AE843E","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/4a/b1c9e5e3.jpg","comment_is_top":false,"comment_ctime":1655969256,"is_pvip":true,"replies":[{"id":"127284","content":"åº”ä¸ºä¾‹å­é‡Œæˆ‘æ‹…å¿ƒè®­ç»ƒé›†æ•°é‡å¤šï¼Œæ‰€ä»¥ç”¨çš„æµ‹è¯•é›†è¿›è¡Œè®­ç»ƒã€‚<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;, train=False, transform=transform, target_transform=None, download=True)<br><br>train=Falseäº†ï¼Œåªæœ‰10000å¼ å›¾ç‰‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1656309260,"ip_address":"","comment_id":349434,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655969256","product_id":100093301,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œä¸Šé¢çš„ä¾‹å­<br><br># è®­ç»ƒ3ä¸ªEpoch<br>for epoch in range(3): <br>for item in dataloader: <br>output = alexnet(item[0]) target = item[1] <br># ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•° loss = nn.CrossEntropyLoss()(output, target) <br>print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss)) #ä»¥ä¸‹ä»£ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡äº† alexnet.zero_grad() <br>loss.backward()<br> optimizer.step()<br><br><br>æ¯epoché‡Œé¢ä½œçš„æ¬¡æ•°æˆ‘åšäº†è®¡æ•°æ˜¯313æ¬¡backwardsï¼Œä¸ºä»€ä¹ˆä¼šæ˜¯è¿™ä¸ªæ•°å­—ï¼Œæˆ‘è®¡ç®—äº†ä»¥ä¸‹50000å¼ è®­ç»ƒé›†ï¼Œ50000&#47;32&#47;2=781.25æ¬¡æ‰å¯¹é˜¿ã€‚è¯·è€å¸ˆç‚¹æ˜æˆ‘ç®—é”™åœ¨å“ªé‡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577717,"discussion_content":"åº”ä¸ºä¾‹å­é‡Œæˆ‘æ‹…å¿ƒè®­ç»ƒé›†æ•°é‡å¤šï¼Œæ‰€ä»¥ç”¨çš„æµ‹è¯•é›†è¿›è¡Œè®­ç»ƒã€‚\ncifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;./data&#39;, train=False, transform=transform, target_transform=None, download=True)\n\ntrain=Falseäº†ï¼Œåªæœ‰10000å¼ å›¾ç‰‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656309260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344442,"user_name":"åˆ˜åˆ©","can_delete":false,"product_type":"c1","uid":1503779,"ip_address":"","ucode":"A46571E6B1C58E","user_header":"https://static001.geekbang.org/account/avatar/00/16/f2/23/bb13b3ed.jpg","comment_is_top":false,"comment_ctime":1651559981,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651559981","product_id":100093301,"comment_content":"hiï¼Œè€å¸ˆï¼Œå¾®è°ƒçš„æ—¶å€™ï¼Œ","like_count":0},{"had_liked":false,"id":341423,"user_name":"Geek_fc975d","can_delete":false,"product_type":"c1","uid":2459939,"ip_address":"","ucode":"05B6507FE4349B","user_header":"https://static001.geekbang.org/account/avatar/00/25/89/23/e71f180b.jpg","comment_is_top":false,"comment_ctime":1649594287,"is_pvip":false,"replies":[{"id":"124818","content":"ä½ å¥½ï¼Œæ„Ÿè°¢ç•™è¨€ã€‚<br>1. itemæ˜¯è¿­ä»£ä¸€æ¬¡dataloaderè¿”å›çš„æ•°æ®ï¼Œä»–åŒ…å«batch_sizeæ¡æ•°æ®æˆ–batch_sizeå¼ å›¾ç‰‡<br>2. Epochçš„è§£é‡Šåœ¨â€œåŠ é¤ | æœºå™¨å­¦ä¹ å…¶å®å°±é‚£ä¹ˆå‡ ä»¶äº‹â€<br>3. è®­ç»ƒé€Ÿåº¦å–å†³äºç¡¬ä»¶ã€‚å¯ä»¥åœ¨æ›´å¥½çš„CPUæˆ–GPUä¸Šå°è¯•è®­ç»ƒï¼Œé€Ÿåº¦ä¼šå˜å¿«çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1649744312,"ip_address":"","comment_id":341423,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649594287","product_id":100093301,"comment_content":"or epoch in range(3): for item in dataloader: output = alexnet(item[0]) target = item[1] # ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•° loss = nn.CrossEntropyLoss()(output, target) print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss)) #ä»¥ä¸‹ä»£ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡äº† alexnet.zero_grad() loss.backward() optimizer.step()<br><br>æƒ³è¯·æ•™è€å¸ˆå’Œå„ä½åŒå­¦ï¼Œè¿™ä¸ªitemæ˜¯å¤šå°‘ï¼Œ æ˜¯cifar10çš„æ€»æ•°æ®æ•°&#47;batch_sizeå—ï¼ŸåŸå…ˆæˆ‘ä»¥ä¸ºè¿™ä¸ªå€¼ç­‰äºbatch-sizeï¼Œçœ‹èµ·æ¥è¿™ä¸ªç»“æœä¸å¯¹å‘¢ã€‚<br><br>è¿˜æƒ³è¯·æ•™ä¸‹epochè¿™ä¸ªå‚æ•°æ˜¯æŒ‡ä»€ä¹ˆï¼Œ æ˜¯è¯´æŒ‰ç…§è¿™ä¸ªbatch_sizeå°†æ•´ä¸ªæ•°æ®é›†è®­ç»ƒå‡ æ¬¡å—ï¼Ÿ<br><br>æˆ‘åœ¨Jupyterä¸­è®­ç»ƒï¼Œè®­ç»ƒçš„é€Ÿåº¦è¶…çº§æ…¢ï¼Œæœ‰ä»€ä¹ˆæå‡çš„æ–¹æ³•å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561910,"discussion_content":"ä½ å¥½ï¼Œæ„Ÿè°¢ç•™è¨€ã€‚\n1. itemæ˜¯è¿­ä»£ä¸€æ¬¡dataloaderè¿”å›çš„æ•°æ®ï¼Œä»–åŒ…å«batch_sizeæ¡æ•°æ®æˆ–batch_sizeå¼ å›¾ç‰‡\n2. Epochçš„è§£é‡Šåœ¨â€œåŠ é¤ | æœºå™¨å­¦ä¹ å…¶å®å°±é‚£ä¹ˆå‡ ä»¶äº‹â€\n3. è®­ç»ƒé€Ÿåº¦å–å†³äºç¡¬ä»¶ã€‚å¯ä»¥åœ¨æ›´å¥½çš„CPUæˆ–GPUä¸Šå°è¯•è®­ç»ƒï¼Œé€Ÿåº¦ä¼šå˜å¿«çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649744312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327315,"user_name":"ç’ç’æ£’","can_delete":false,"product_type":"c1","uid":1240847,"ip_address":"","ucode":"73A0702A703F23","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIW9p3Q9OuX2kGgroDacib99YvjkichWdl54YBVicno8wNPW9gKibUNb0QPtYvTljSWFdjgXdrGPr7Q5g/132","comment_is_top":false,"comment_ctime":1640057431,"is_pvip":false,"replies":[{"id":"119120","content":"ä½ å¥½ï¼Œç’ç’æ£’ã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚<br>æŠŠPNGè½¬æˆRGBå°±å¯ä»¥ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè®­ç»ƒäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1640066199,"ip_address":"","comment_id":327315,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640057431","product_id":100093301,"comment_content":"ä½ å¥½ï¼Œè€å¸ˆï¼Œè¯·æ•™ä¸‹ï¼Œæƒ³ç”¨é¢„è®­ç»ƒçš„effientnet b0æ¥è®­ç»ƒè‡ªå·±çš„æ•°æ®ï¼Œè‡ªå·±çš„æ•°æ®æ˜¯pngçš„å›¾ç‰‡ï¼Œè¿™ä¸ªè¡Œçš„é€šå—ï¼Œæ˜¯éœ€è¦ä¿®æ”¹ä¸‹è¾“å…¥é€šé“æ•°å°±å¯ä»¥å—ï¼Œè¿˜æ˜¯è¯´ä¸èƒ½ä½¿ç”¨é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œå¯ä»¥é‡æ–°è®­ç»ƒä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540478,"discussion_content":"ä½ å¥½ï¼Œç’ç’æ£’ã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚\næŠŠPNGè½¬æˆRGBå°±å¯ä»¥ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè®­ç»ƒäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640066199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324287,"user_name":"Hité»æ˜åˆ†æ˜ğŸ©","can_delete":false,"product_type":"c1","uid":2806487,"ip_address":"","ucode":"6476C9EFB2117E","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d2/d7/7f00bea1.jpg","comment_is_top":false,"comment_ctime":1638356867,"is_pvip":false,"replies":[{"id":"117706","content":"hello.ï¼Œä½ å¥½ã€‚<br>Input type (torch.FloatTensor) æ˜¯è¯´è¾“å…¥çš„æ•°æ®åœ¨cpuä¸Šã€‚<br>weight type (torch.cuda.FloatTensor)æ˜¯è¯´æ¨¡å‹çš„æ•°æ®åœ¨gpuä¸Šã€‚<br>æ‰€ä»¥æŠ¥äº†è¿™ä¸ªé”™è¯¯ã€‚<br>çœ‹ä½ çš„ä»£ç åº”è¯¥æ˜¯æŸå¤±å‡½æ•°ä¸åœ¨GPUä¸Šã€‚<br>å¯ä»¥è¿™æ ·æ”¹ä¸€ä¸‹è¯•è¯•ã€‚<br>loss = nn.CrossEntropyLoss().to(device)(output,target)<br>æ•°æ®ã€æ¨¡å‹ã€æŸå¤±å‡½æ•°ï¼Œæœ‰GPUçš„è¯éƒ½è¦æ”¾åˆ°GPUä¸Šã€‚<br>    <br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1638408649,"ip_address":"","comment_id":324287,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1638356867","product_id":100093301,"comment_content":"<br>#æ•°æ®åŠ è½½<br><br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                       train=False,<br>                                       transform=transform,<br>                                       target_transform=None,<br>                                       download=True)<br>dataloader = DataLoader(dataset=cifar10_dataset, # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°<br>                               batch_size=32,       # è¾“å‡ºçš„batchå¤§å°<br>                               shuffle=True,       # æ•°æ®æ˜¯å¦æ‰“ä¹±<br>                               num_workers=0)      # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹<br><br><br>#å®šä¹‰æ¨¡å‹<br>class myCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3,16,kernel_size=3)<br>        self.fc = nn.Linear(16 * 222 *222 ,10)<br>        <br>    def forward(self,input):<br>        x = self.conv1(input)<br>        # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³<br>        x = x.view(x.shape[0],-1)<br>        x = self.fc(x)<br>        return x<br><br># å°½é‡ä½¿ç”¨gpuè¿›è¡Œè®­ç»ƒ,å¦‚æœæ²¡æœ‰cpuåˆ™ä½¿ç”¨gpuæ¥è®­ç»ƒ<br>device = torch.device(&quot;cuda:0&quot;if torch.cuda.is_available()else &quot;cpu&quot;)<br><br>cnn = myCNN().to(device)<br><br><br>optimizer = torch.optim.SGD(cnn.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br>steps = 0<br><br>for epoch in range(30):<br>    for item in dataloader:<br>        steps += 1<br>        output = cnn(item[0])<br>        target = item[1].to(device)<br>        loss = nn.CrossEntropyLoss()(output,target)<br>        print(&#39;Epoch{},Loss{}&#39;.format(epoch + 1 ,loss))<br>        cnn.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br>im = Image.open(&#39;data&#47;img.png&#39;)<br>input_tensor = transform(im).unsqueeze(0)<br>result = cnn(input_tensor.to(device)).argmax()<br>print(result)<br>è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘è¿è¡Œä»¥åå‡ºç°æŠ¥é”™ï¼š<br>RuntimeError: Input type (torch.FloatTensor) and weight type (torch.cuda.FloatTensor) should be the same or input should be a MKLDNN tensor and weight is a dense tensor","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535305,"discussion_content":"hello.ï¼Œä½ å¥½ã€‚\nInput type (torch.FloatTensor) æ˜¯è¯´è¾“å…¥çš„æ•°æ®åœ¨cpuä¸Šã€‚\nweight type (torch.cuda.FloatTensor)æ˜¯è¯´æ¨¡å‹çš„æ•°æ®åœ¨gpuä¸Šã€‚\næ‰€ä»¥æŠ¥äº†è¿™ä¸ªé”™è¯¯ã€‚\nçœ‹ä½ çš„ä»£ç åº”è¯¥æ˜¯æŸå¤±å‡½æ•°ä¸åœ¨GPUä¸Šã€‚\nå¯ä»¥è¿™æ ·æ”¹ä¸€ä¸‹è¯•è¯•ã€‚\nloss = nn.CrossEntropyLoss().to(device)(output,target)\næ•°æ®ã€æ¨¡å‹ã€æŸå¤±å‡½æ•°ï¼Œæœ‰GPUçš„è¯éƒ½è¦æ”¾åˆ°GPUä¸Šã€‚\n    \n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638408649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2808726,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/db/96/885df919.jpg","nickname":"Challenge And Change","note":"","ucode":"466A0FFCEF7C00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536299,"discussion_content":"output = cnn(item[0].to(device))  æ˜¯è¿™æ ·å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638755527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2806487,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/d2/d7/7f00bea1.jpg","nickname":"Hité»æ˜åˆ†æ˜ğŸ©","note":"","ucode":"6476C9EFB2117E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535413,"discussion_content":"æ‚¨å¥½ï¼Œæˆ‘ä¿®æ”¹äº†losså‡½æ•°å¥½åƒè¿˜æ˜¯æ˜¾ç¤ºä¸€æ ·çš„é”™è¯¯ï¼Œå¯èƒ½æ˜¯æˆ‘çš„è¾“å…¥æ•°æ®æ²¡æ”¾åˆ°GPUä¸Šå—ï¼Ÿæˆ‘ä¸çŸ¥é“æ€ä¹ˆå°†æ‰€æœ‰æ•°æ®éƒ½è°ƒåˆ°GPUä¸Š\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638433626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322953,"user_name":"autiplex","can_delete":false,"product_type":"c1","uid":2817246,"ip_address":"","ucode":"6D8DB528CC3A3E","user_header":"https://static001.geekbang.org/account/avatar/00/2a/fc/de/6e2cb960.jpg","comment_is_top":false,"comment_ctime":1637668457,"is_pvip":false,"replies":[{"id":"117271","content":"ä½ å¥½ã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚æˆ‘ç”¨ä½ å‘çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰å‡ºç°ä½ è¯´çš„é”™è¯¯ã€‚<br>æˆ‘æŸ¥äº†ä¸€ä¸‹ä¼¼ä¹æ˜¯å¤šè¿›ç¨‹çš„é—®é¢˜ã€‚ä½ å¯ä»¥è¿™æ ·è¯•è¯•ï¼š<br>1. num_worker è®¾ä¸º-1è¯•è¯•ã€‚<br>2. num_worker è®¾ä¸º1è¯•è¯•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"2802608","ctime":1637734158,"ip_address":"","comment_id":322953,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637668457","product_id":100093301,"comment_content":"from PIL import Image<br>from torch.utils.data import DataLoader<br>import torch<br>from torch import nn<br>import torchvision.transforms as transforms<br>import torchvision<br><br><br>#  è¯»å–æ•°æ®<br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br><br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                       train=False,<br>                                       transform=transform,<br>                                       target_transform=None,<br>                                       download=True)<br>dataloader = DataLoader(dataset=cifar10_dataset, # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°<br>                               batch_size=32,       # è¾“å‡ºçš„batchå¤§å°<br>                               shuffle=True,       # æ•°æ®æ˜¯å¦æ‰“ä¹±<br>                               num_workers=2)      # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹<br><br><br>#  ç½‘ç»œç»“æ„<br>class MyCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>        # conv1è¾“å‡ºçš„ç‰¹å¾å›¾ä¸º222x222å¤§å°<br>        self.fc = nn.Linear(16 * 222 * 222, 10)<br><br>    def forward(self, input):<br>        x = self.conv1(input)<br>        # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³<br>        x = x.view(x.shape[0], -1)<br>        x = self.fc(x)<br>        return x<br><br>cnn = MyCNN()<br>#  æŸå¤±å‡½æ•°<br>criterion = nn.CrossEntropyLoss()<br>optimizer = torch.optim.SGD(cnn.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>#  è®­ç»ƒ10ä¸ªEpoch<br>for epoch in range(10):<br>    for item in dataloader: <br>        output = cnn(item[0])<br>        target = item[1]<br>        loss = criterion(output, target)<br>        print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss))<br>        #ä»¥ä¸‹ä»£ç çš„å«ä¹‰ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡äº†<br>        cnn.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br><br>#  æµ‹è¯•ç»“æœ<br>pass<br><br>è€å¸ˆä¸Šé¢çš„ä»£ç è¿è¡Œä¼šå‘ç”Ÿä¸‹é¢çš„æŠ¥é”™ï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹è¯´æ˜¯è¦æ”¾åœ¨__name__==&#39;__main__&#39;é‡Œè¿è¡Œï¼Œæˆ‘æ²¡å¤ªæ˜ç™½<br><br>The &quot;freeze_support()&quot; line can be omitted if the program<br>        is not going to be frozen to produce an executable.<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532925,"discussion_content":"ä½ å¥½ã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚æˆ‘ç”¨ä½ å‘çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰å‡ºç°ä½ è¯´çš„é”™è¯¯ã€‚\næˆ‘æŸ¥äº†ä¸€ä¸‹ä¼¼ä¹æ˜¯å¤šè¿›ç¨‹çš„é—®é¢˜ã€‚ä½ å¯ä»¥è¿™æ ·è¯•è¯•ï¼š\n1. num_worker è®¾ä¸º-1è¯•è¯•ã€‚\n2. num_worker è®¾ä¸º1è¯•è¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637734158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321561,"user_name":"zhaobk","can_delete":false,"product_type":"c1","uid":1291596,"ip_address":"","ucode":"30BEE12D2CF020","user_header":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","comment_is_top":false,"comment_ctime":1636947451,"is_pvip":false,"replies":[{"id":"116841","content":"hiï¼Œzhaobkï¼Œä½ å¥½ã€‚è°¢è°¢ä½ çš„ç•™è¨€ã€‚<br>çœ‹ä»£ç ä¼¼ä¹æ²¡æœ‰é—®é¢˜ã€‚<br>CIFAR10çš„å›¾ç‰‡æ¯”è¾ƒå°ï¼ŒçŒ«å’Œç‹—æ¯”è¾ƒåƒï¼Œä¸€éƒ¨åˆ†å›¾ç‰‡é¢„æµ‹é”™è¯¯æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¯ä»¥æŠŠcifar10_dataset = torchvision.datasets.CIFAR10ä¸­çš„trainæ”¹ä¸ºTrueè¯•ä¸€è¯•ï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿ç›´æ¥ç”¨æµ‹è¯•é›†ä½œä¸ºè®­ç»ƒé›†äº†ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1637052933,"ip_address":"","comment_id":321561,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636947451","product_id":100093301,"comment_content":"#å›¾åƒåˆ†ç±»<br>class MyCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>        # conv1è¾“å‡ºçš„ç‰¹å¾å›¾ä¸º222x222å¤§å°<br>        self.fc = nn.Linear(16 * 222 * 222, 10)<br><br>    def forward(self, input):<br>        x = self.conv1(input)<br>        # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³<br>        x = x.view(x.shape[0], -1)<br>        x = self.fc(x)<br>        return x<br><br><br>#å®šä¹‰è¯»å–æ•°æ®æ ¼å¼ meanå’Œstdæ˜¯ImageNetçš„å‡å€¼ä¸æ ‡å‡†å·®ã€‚torchvisionä¸­çš„æ¨¡å‹éƒ½æ˜¯åœ¨ImageNetä¸Šè®­ç»ƒçš„ã€‚<br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406],<br>                         std=[0.229, 0.224, 0.225])<br>])<br>#è·å–æ•°æ®<br><br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                       train=False,<br>                                       transform=transform,<br>                                       target_transform=None,<br>                                       download=True)<br><br><br>#åŠ è½½æ•°æ®<br>dataloader = DataLoader(<br>    dataset=cifar10_dataset, # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°<br>    batch_size=32,       # è¾“å‡ºçš„batchå¤§å°<br>    shuffle=True,       # æ•°æ®æ˜¯å¦æ‰“ä¹±<br>    num_workers=0)      # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹<br><br>cnn = MyCNN()<br>#å®šä¹‰ä¼˜åŒ–å™¨<br>optimizer = torch.optim.SGD(cnn.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>for epoch in range(10):<br>    for item in dataloader:<br>        cnt+=1<br>        output = cnn(item[0])<br>        target = item[1]<br>        # ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°<br>        loss = nn.CrossEntropyLoss()(output, target)<br>        print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss))<br>        #é¦–å…ˆè¦é€šè¿‡zero_grad()å‡½æ•°æŠŠæ¢¯åº¦æ¸…é›¶<br><br>        cnn.zero_grad()<br>        # ç®—å®Œlossä¹‹åè¿›è¡Œåå‘ä¼ æ’­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹‹åæ¢¯åº¦ä¼šè®°å½•åœ¨å˜é‡ä¸­<br>        loss.backward()<br>        # ç”¨è®¡ç®—çš„æ¢¯åº¦å»åšä¼˜åŒ–<br>        optimizer.step()<br><br>im = Image.open(&#39;dog.jpg&#39;)<br>input_tensor = transform(im).unsqueeze(0)<br>print(cnn(input_tensor).argmax())<br><br>æˆ‘è®­ç»ƒå®Œlossæ€»æ˜¯åœ¨1.8~~2.0ä¹‹é—´éœ‡è¡ï¼Œæœ€åç”¨dog.jpgæµ‹è¯•å‡ºæ¥çš„åˆ†ç±»æ˜¯3ï¼Œcatã€‚è¯·é—®è€å¸ˆï¼Œæˆ‘çš„ä»£ç æœ‰é—®é¢˜ä¹ˆï¼Ÿè¿˜æ˜¯è®­ç»ƒçš„å°‘ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530318,"discussion_content":"hiï¼Œzhaobkï¼Œä½ å¥½ã€‚è°¢è°¢ä½ çš„ç•™è¨€ã€‚\nçœ‹ä»£ç ä¼¼ä¹æ²¡æœ‰é—®é¢˜ã€‚\nCIFAR10çš„å›¾ç‰‡æ¯”è¾ƒå°ï¼ŒçŒ«å’Œç‹—æ¯”è¾ƒåƒï¼Œä¸€éƒ¨åˆ†å›¾ç‰‡é¢„æµ‹é”™è¯¯æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¯ä»¥æŠŠcifar10_dataset = torchvision.datasets.CIFAR10ä¸­çš„trainæ”¹ä¸ºTrueè¯•ä¸€è¯•ï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿ç›´æ¥ç”¨æµ‹è¯•é›†ä½œä¸ºè®­ç»ƒé›†äº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637052933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321467,"user_name":"cab","can_delete":false,"product_type":"c1","uid":1983360,"ip_address":"","ucode":"E096A122C35ADE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0F94uoYZQicSOIfEfSr9gH7CTKibNBsS6d9PRDd8cy7bdTCF9jibXYtf0esGqsQAItHnElejIFovxg/132","comment_is_top":false,"comment_ctime":1636889377,"is_pvip":false,"replies":[{"id":"116770","content":"hiï¼Œcabã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚å› ä¸ºæ”¹è¿‡ä¹‹åå¯ä»¥æ¥å—ä»»æ„å°ºåº¦ï¼ˆåœ¨å¯ä»¥æ­£å¸¸å‰å‘ä¼ æ’­çš„æƒ…å†µä¸‹ï¼‰çš„è¾“å…¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636941538,"ip_address":"","comment_id":321467,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636889377","product_id":100093301,"comment_content":"è¯·é—®ä¸€ä¸‹ä¸ºä»€ä¹ˆPyTorchä¸­çš„AlexNetç½‘ç»œç»“æ„ä¸è®ºæ–‡ä¸­çš„ä¸ä¸€æ ·å‘¢ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530298,"discussion_content":"hiï¼Œcabã€‚æ„Ÿè°¢ä½ çš„ç•™è¨€ã€‚å› ä¸ºæ”¹è¿‡ä¹‹åå¯ä»¥æ¥å—ä»»æ„å°ºåº¦ï¼ˆåœ¨å¯ä»¥æ­£å¸¸å‰å‘ä¼ æ’­çš„æƒ…å†µä¸‹ï¼‰çš„è¾“å…¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636941538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321264,"user_name":"é©¬å…‹å›¾å¸ƒ","can_delete":false,"product_type":"c1","uid":1019274,"ip_address":"","ucode":"9E3879D6A55244","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","comment_is_top":false,"comment_ctime":1636729087,"is_pvip":false,"replies":[{"id":"116687","content":"hiï¼Œé©¬å…‹å›¾å¸ƒã€‚ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»^^ï¼Œå‰å®³ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636808224,"ip_address":"","comment_id":321264,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636729087","product_id":100093301,"comment_content":"ä»£ç ï¼š<br><br>import torch<br>import torch.nn as nn<br>import torchvision<br>import torchvision.transforms as transforms<br>from PIL import Image<br><br><br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224, 224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>])<br><br>cifar10_train_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;, train=True, transform=transform, target_transform=None, download=True)<br>train_loader = torch.utils.data.DataLoader(dataset=cifar10_train_dataset, batch_size=32, shuffle=True, num_workers=2)<br>classes = (&#39;plane&#39;, &#39;car&#39;, &#39;bird&#39;, &#39;cat&#39;, &#39;deer&#39;, &#39;dog&#39;, &#39;frog&#39;, &#39;horse&#39;, &#39;ship&#39;, &#39;truck&#39;)<br>n_total_steps = len(train_loader)<br><br><br>class MyCNN(nn.Module):<br>    def __init__(self):<br>        super().__init__()<br>        self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>        self.fc = nn.Linear(16 * 222 * 222, 10)<br><br>    def forward(self, input):<br>        x = self.conv1(input)<br>        x = x.view(x.shape[0], -1)<br>        x = self.fc(x)<br>        return x<br><br><br>device = torch.device(&#39;cuda:0&#39; if torch.cuda.is_available() else &#39;cpu&#39;)<br>model = MyCNN().to(device)<br><br>criterion = nn.CrossEntropyLoss()<br>optimizer = torch.optim.SGD(model.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>print(&#39;Start training...&#39;)<br>for epoch in range(4):<br>    for i, (images, labels) in enumerate(train_loader):<br>        images = images.to(device)<br>        labels = labels.to(device)<br>        labels_pred = model(images)<br>        loss = criterion(labels_pred, labels)<br><br>        optimizer.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br><br>        if (i+1) % 100 == 0:<br>            print(f&#39;Epoch [{epoch+1}&#47;{4}], Step [{i+1:5d}&#47;{n_total_steps}], Loss = {loss.item():.4f}&#39;)<br>print(&#39;Training complete!&#39;)<br><br>print(&#39;Start testing...&#39;)<br>with torch.no_grad():<br>    im = Image.open(&#39;dog.jpg&#39;)<br>    input_tensor = my_transform(im).unsqueeze(0).to(device)<br>    label_pred = model(input_tensor).argmax()<br>    print(f&#39;Your label predictedï¼š{classes[label_pred]}&#39;)<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530255,"discussion_content":"hiï¼Œé©¬å…‹å›¾å¸ƒã€‚ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»^^ï¼Œå‰å®³ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636808224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321238,"user_name":"clee","can_delete":false,"product_type":"c1","uid":1467446,"ip_address":"","ucode":"122875102B23A8","user_header":"","comment_is_top":false,"comment_ctime":1636722136,"is_pvip":false,"replies":[{"id":"116686","content":"hi, cleeã€‚<br>åŸå› æ˜¯å­¦ä¹ ç‡è®¾ç½®æœ‰ç‚¹å¤§äº†ï¼Œæˆ‘ç”¨0.0001è®­ç»ƒäº†æ˜¯okçš„ã€‚<br><br>ä½¿ç”¨optim.SGD(net.parameters())ï¼ˆ1ä¸ªæ¨¡å‹å¯¹åº”1ä¸ªä¼˜åŒ–å™¨ï¼‰åˆå§‹åŒ–çš„æ—¶å€™ã€‚<br>self.optimizer.zero_grad()ä¸self.model.zero_grad()æ˜¯ä¸€æ ·çš„ã€‚<br><br>å¦‚æœ1ä¸ªä¼˜åŒ–å™¨å¯¹åº”å¤šä¸ªæ¨¡å‹çš„æ—¶å€™ï¼Œå°±è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æäº†ã€‚å¦‚æœç›´æ¥optimizer.zero_grad()çš„è¯ï¼Œå°±ä¼šæŠŠæ‰€æœ‰æ¨¡å‹çš„æ¢¯åº¦æ¸…é›¶ã€‚<br><br>loss.backward()ä¸optimizer.step() æ˜¯ä¸åŒçš„ä½œç”¨ã€‚<br>loss.backward()æ˜¯ç®—å®Œlossä¹‹åè¿›è¡Œåå‘æ¢¯åº¦ä¼ æ’­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹‹åæ¢¯åº¦ä¼šè®°å½•åœ¨å˜é‡ä¸­ã€‚<br>optimizer.step() æ˜¯ç”¨è®¡ç®—çš„æ¢¯åº¦å»åšä¼˜åŒ–ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"2802608","ctime":1636808193,"ip_address":"","comment_id":321238,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636722136","product_id":100093301,"comment_content":"import torch<br>import torch.nn as nn<br>from torch.utils.data import DataLoader<br>from torchvision import transforms<br>import torchvision<br><br>transform = transforms.Compose([transforms.RandomResizedCrop((224,224)), <br>                                transforms.ToTensor(), <br>                                transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]) ])<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;, <br>                                               train=False, <br>                                               transform=transform, <br>                                               target_transform=None, <br>                                               download=True)<br>dataloader = DataLoader(dataset=cifar10_dataset, batch_size=32)<br>class MyCNN(nn.Module): <br>  def __init__(self): <br>    super().__init__()<br>    self.conv1 = nn.Conv2d(3, 16, kernel_size=3)<br>    self.fc = nn.Linear(16 * 222 * 222, 10)<br>  def forward(self, input):<br>    x = self.conv1(input)<br>    # è¿›å»å…¨è¿æ¥å±‚ä¹‹å‰ï¼Œå…ˆå°†ç‰¹å¾å›¾é“ºå¹³<br>    x = x.view(x.shape[0], -1)<br>    x = self.fc(x)<br>    return x<br><br>class MyCNN_Model():<br>  def __init__(self):<br>    self.learning_rate = 0.001<br>    self.epoches = 100<br>    self.model = MyCNN()<br>    self.optimizer = torch.optim.SGD(self.model.parameters(), lr=self.learning_rate, momentum=0.9)<br>    self.loss_function = nn.CrossEntropyLoss()<br><br>  def train(self):<br>    for epoch in range(self.epoches):<br>      for item in dataloader:<br>        prediction = self.model(item[0])<br>        loss = self.loss_function(prediction, item[1])<br>        self.optimizer.zero_grad()<br>        loss.backward()<br>        self.optimizer.step()<br>      print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss))<br>    torch.save(self.model.state_dict(), &#39;mycnn.pth&#39;)<br><br>ç–‘é—®ä¸€ï¼šLossè¾“å‡ºç‰¹åˆ«å¤§ï¼Œæ˜¯å“ªä¸ªå‚æ•°æ²¡æœ‰é…ç½®æ­£ç¡®å—?<br>Epoch 1, Loss 44.85285568237305<br>Epoch 2, Loss 6869.75048828125ï¼Œ<br>ç–‘é—®äºŒï¼š<br>loss.backward()ï¼Œoptimizer.step() ä¸¤è¡Œä»£ç éƒ½æ˜¯æ‰§è¡Œäº†æ–¹æ³•è€Œå·²ï¼Œæ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆæŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨å†…éƒ¨å’Œæ¨¡å‹æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„ã€‚<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530248,"discussion_content":"hi, cleeã€‚\nåŸå› æ˜¯å­¦ä¹ ç‡è®¾ç½®æœ‰ç‚¹å¤§äº†ï¼Œæˆ‘ç”¨0.0001è®­ç»ƒäº†æ˜¯okçš„ã€‚\n\nä½¿ç”¨optim.SGD(net.parameters())ï¼ˆ1ä¸ªæ¨¡å‹å¯¹åº”1ä¸ªä¼˜åŒ–å™¨ï¼‰åˆå§‹åŒ–çš„æ—¶å€™ã€‚\nself.optimizer.zero_grad()ä¸self.model.zero_grad()æ˜¯ä¸€æ ·çš„ã€‚\n\nå¦‚æœ1ä¸ªä¼˜åŒ–å™¨å¯¹åº”å¤šä¸ªæ¨¡å‹çš„æ—¶å€™ï¼Œå°±è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æäº†ã€‚å¦‚æœç›´æ¥optimizer.zero_grad()çš„è¯ï¼Œå°±ä¼šæŠŠæ‰€æœ‰æ¨¡å‹çš„æ¢¯åº¦æ¸…é›¶ã€‚\n\nloss.backward()ä¸optimizer.step() æ˜¯ä¸åŒçš„ä½œç”¨ã€‚\nloss.backward()æ˜¯ç®—å®Œlossä¹‹åè¿›è¡Œåå‘æ¢¯åº¦ä¼ æ’­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹‹åæ¢¯åº¦ä¼šè®°å½•åœ¨å˜é‡ä¸­ã€‚\noptimizer.step() æ˜¯ç”¨è®¡ç®—çš„æ¢¯åº¦å»åšä¼˜åŒ–ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636808193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531014,"discussion_content":"hiï¼Œcleeã€‚ä¸å¥½æ„æ€ï¼Œä¸Šæ¬¡çš„å›å¤æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä¿®æ”¹äº†ä¸€ä¸‹ã€‚éº»çƒ¦å†çœ‹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637205131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321195,"user_name":"Geek_8cfc4c","can_delete":false,"product_type":"c1","uid":2156103,"ip_address":"","ucode":"83EF0B576530E2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7uYZvwhrLHsJICstGXaOvUNZnyq0aO7gF0OLicMyZAZFnRiaDyvM1lGxnEDP2VUMV3m6UjiazMmSNGQ/132","comment_is_top":false,"comment_ctime":1636703529,"is_pvip":false,"replies":[{"id":"116683","content":"ä¸åº”è¯¥å•Šï¼Œä¸€æ¨¡ä¸€æ ·çš„ä»£ç å’Œæ•°æ®å—ï¼Ÿæˆ‘ä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆçº¿ç´¢ã€‚ã€‚ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636806672,"ip_address":"","comment_id":321195,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636703529","product_id":100093301,"comment_content":"æœ‰ä¸ªç¥å¥‡é—®é¢˜ï¼Œæˆ‘åœ¨macä¸Šè·‘æ¨¡å‹è®­ç»ƒlossæ„Ÿè§‰æ²¡æœ‰æ”¶æ•›çš„è¿¹è±¡<br>ç”¨linuxæœºå™¨è·‘å°±æ”¶æ•›äº†â€¦â€¦<br>ç‰ˆæœ¬å·éƒ½æ˜¯ä¸€æ ·çš„â€¦â€¦<br>è¿™å¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530243,"discussion_content":"ä¸åº”è¯¥å•Šï¼Œä¸€æ¨¡ä¸€æ ·çš„ä»£ç å’Œæ•°æ®å—ï¼Ÿæˆ‘ä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆçº¿ç´¢ã€‚ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636806672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321178,"user_name":"ç‹ç","can_delete":false,"product_type":"c1","uid":2822974,"ip_address":"","ucode":"5074BA9DD3DE88","user_header":"https://static001.geekbang.org/account/avatar/00/2b/13/3e/d028cddd.jpg","comment_is_top":false,"comment_ctime":1636699546,"is_pvip":false,"replies":[{"id":"116685","content":"ä½ å¥½ï¼Œä¸æ˜¯è¿æ°”å¥½^^ã€‚CIFAR10æ¯”è¾ƒç®€å•ï¼Œ10ä¸ªEpochåº”è¯¥å·®ä¸å¤šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636807554,"ip_address":"","comment_id":321178,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636699546","product_id":100093301,"comment_content":"from PIL import Image<br>import torchvision<br>import torchvision.transforms as transforms<br>import torch<br>from torch.utils.data import DataLoader<br><br># æ•°æ®è¯»å–<br>transform = transforms.Compose([<br>    transforms.RandomResizedCrop((224,224)),<br>    transforms.ToTensor(),<br>    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])<br>    ])<br>cifar10_dataset = torchvision.datasets.CIFAR10(root=&#39;.&#47;data&#39;,<br>                                       train=False, #ä¸‹è½½æµ‹è¯•é›†<br>                                       transform=transform,<br>                                       target_transform=None,<br>                                       download=True)<br>dataloader = DataLoader(dataset=cifar10_dataset, # ä¼ å…¥çš„æ•°æ®é›†, å¿…é¡»å‚æ•°<br>                               batch_size=32,       # è¾“å‡ºçš„batchå¤§å°<br>                               shuffle=True,       # æ•°æ®æ˜¯å¦æ‰“ä¹±<br>                               num_workers=2)   # è¿›ç¨‹æ•°, 0è¡¨ç¤ºåªæœ‰ä¸»è¿›ç¨‹<br><br># å®šä¹‰è®¡ç®—è®¾å¤‡<br>device = torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;) <br><br># å®ä¾‹åŒ–æ¨¡å‹<br>cnn = MyCNN().to(device)<br># å®šä¹‰ä¼˜åŒ–å™¨<br>optimizer = torch.optim.SGD(cnn.parameters(), lr=1e-4, weight_decay=1e-2, momentum=0.9)<br><br>steps = 0<br>for epoch in range(10):<br>    for item in dataloader: <br>        steps += 1<br>        output = cnn(item[0].to(device))<br>        target = item[1].to(device)<br>        # ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°<br>        loss = nn.CrossEntropyLoss()(output, target)<br>        <br>        if steps % 50 == 0:<br>            print(&#39;Epoch {}, Loss {}&#39;.format(epoch + 1 , loss))<br>        cnn.zero_grad()<br>        loss.backward()<br>        optimizer.step()<br><br><br># ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹é¢„æµ‹<br>im = Image.open(&#39;dog.jpg&#39;)<br>input_tensor = transform(im).unsqueeze(0)<br>cnn(input_tensor.to(device)).argmax()<br><br>è¾“å‡ºï¼štensor(5, device=&#39;cuda:0&#39;)<br><br>é¢„æµ‹ç±»åˆ«æ˜¯â€œç‹—â€ã€‚<br><br>æ˜¯è¿æ°”å¥½å—ï¼Ÿåªè®­ç»ƒäº†10 epochsï¼Œæœ€åæ˜¾ç¤ºçš„loss 1.8å·¦å³<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530237,"discussion_content":"ä½ å¥½ï¼Œä¸æ˜¯è¿æ°”å¥½^^ã€‚CIFAR10æ¯”è¾ƒç®€å•ï¼Œ10ä¸ªEpochåº”è¯¥å·®ä¸å¤šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636807554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019274,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","nickname":"é©¬å…‹å›¾å¸ƒ","note":"","ucode":"9E3879D6A55244","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414375,"discussion_content":"åŒå­¦å¥½ï¼Œä½ åœ¨æ„å»ºæ•°æ®é›†çš„æ—¶å€™ï¼Œä¼¼ä¹æ˜¯ç”¨äº† CIFAR10 çš„æµ‹è¯•é›†ä½œä¸ºè®­ç»ƒé›†ï¼Œtorchvision.datasets.CIFAR10() çš„ train å‚æ•°åº”è¯¥æ˜¯ True æ‰ä¸ºä½¿ç”¨å…¶è®­ç»ƒé›†ï¼Œå¦åˆ™ä½¿ç”¨çš„æ˜¯å…¶æµ‹è¯•é›† ^^ ä½†æ˜¯æ‹¿å®ƒæ¥è®­ç»ƒè‡ªå·±çš„æ¨¡å‹å¥½åƒä¹Ÿæ²¡å…³ç³» hhh\n\nå¦å¤–ï¼Œæˆ‘è®­ç»ƒé›†çš„ loss ä¹Ÿæ˜¯ 1.8-2.2 ä¹‹é—´ï¼Œ num_epochs ä¸º 4ï¼Œbatch_size ä¸º 32ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636729504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321148,"user_name":"Geek_8cfc4c","can_delete":false,"product_type":"c1","uid":2156103,"ip_address":"","ucode":"83EF0B576530E2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7uYZvwhrLHsJICstGXaOvUNZnyq0aO7gF0OLicMyZAZFnRiaDyvM1lGxnEDP2VUMV3m6UjiazMmSNGQ/132","comment_is_top":false,"comment_ctime":1636688742,"is_pvip":false,"replies":[{"id":"116684","content":"ä½ å¥½ï¼Œè°¢è°¢ä½ çš„ç•™è¨€ã€‚<br>å…³äºunsqueeze()ã€‚ä½ è¯´çš„å¯¹ã€‚è¿™æ˜¯æœ‰ç‚¹å¤šä½™ï¼Œç­‰æˆ‘ç»™å»æ‰ã€‚<br><br>å…³äºæ¨¡å‹ç‰ˆæœ¬ã€‚æ©ï¼Œæ˜¯çš„ï¼Œtorchvisionç‰ˆæœ¬ä¸åŒï¼Œæ¨¡å‹ä¼šé‡æ–°è®­ç»ƒã€‚<br><br>æ¨¡å‹åœ°å€åœ¨https:&#47;&#47;github.com&#47;pytorch&#47;vision&#47;blob&#47;release&#47;0.10&#47;torchvision&#47;models&#47;alexnet.py#L11<br><br>ä½ å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç‰ˆæœ¬çœ‹çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ–¹è¿œ","uid":"2802608","ctime":1636807430,"ip_address":"","comment_id":321148,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1636688742","product_id":100093301,"comment_content":"å¯¹äºæœ¬èŠ‚è¯¾æœ‰å‡ ä¸ªé—®é¢˜ä¸å¤ªæ˜ç™½è¿˜æœ›èµæ•™ ï¼ˆpytorchç‰ˆæœ¬&#39;1.10.0&#39;ï¼‰<br><br>1. æ¨¡å‹è®­ç»ƒé‚£ éƒ¨åˆ†<br>`y_train = torch.tensor(y_train, dtype=torch.float32).unsqueeze(0)`<br>unsqueezeçš„æ„ä¹‰æ˜¯å•¥å‘¢ï¼Ÿ (y_trainæœ¬æ¥sizeæ˜¯Size([30])æ­£å¥½å’Œx_trainåŒ¹é…)<br>è¿™æ ·åšåè€Œå¾—åˆ°äº†ä¸€ä¸ªwarning<br>`<br>UserWarning: Using a target size (torch.Size([1, 30])) that is different to the input size (torch.Size([30])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.<br>`<br><br>2. å†è¯´å¾®è°ƒ éƒ¨åˆ†<br>ä¸€å¼€å§‹ç›´æ¥ä¸‹è½½çš„AlexNetæ¨¡å‹(alexnet-owt-7be5be79.pth), é¢„æµ‹ç»“æœæ˜¯151<br>åæ¥ä½¿ç”¨äºæ–‡ä¸­ä¸€æ ·çš„ç‰ˆæœ¬æ‰å˜æˆ263<br><br>å› ä¸ºtorchvisionçš„ç‰ˆæœ¬ä¸åŒï¼Œé¢„è®­ç»ƒçš„æ¨¡å‹ç»“æœå°±æœ‰äº†å·®å¼‚ä¹ˆï¼Ÿ<br>å¦‚æœæ˜¯çš„è¯æˆ‘çœ‹åˆ°çš„æ ‡ç­¾åˆ—è¡¨ä¸­151æ˜¯å‰å¨ƒå¨ƒï¼ˆChihuahuaï¼‰â€¦â€¦<br><br>è°¢è°¢<br>","like_count":0,"discussions":[{"author":{"id":2802608,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK1ZkL9L7CEicI87xicpIhXAIhVdVWpJKBsD8Jpzg9iaAwFcDEhTvdRwuKItJS14mYznT2w2YQvn8QsQ/132","nickname":"æ–¹è¿œ","note":"","ucode":"248B1DE180EB4C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530233,"discussion_content":"ä½ å¥½ï¼Œè°¢è°¢ä½ çš„ç•™è¨€ã€‚\nå…³äºunsqueeze()ã€‚ä½ è¯´çš„å¯¹ã€‚è¿™æ˜¯æœ‰ç‚¹å¤šä½™ï¼Œç­‰æˆ‘ç»™å»æ‰ã€‚\n\nå…³äºæ¨¡å‹ç‰ˆæœ¬ã€‚æ©ï¼Œæ˜¯çš„ï¼Œtorchvisionç‰ˆæœ¬ä¸åŒï¼Œæ¨¡å‹ä¼šé‡æ–°è®­ç»ƒã€‚\n\næ¨¡å‹åœ°å€åœ¨https://github.com/pytorch/vision/blob/release/0.10/torchvision/models/alexnet.py#L11\n\nä½ å¯ä»¥åˆ‡æ¢ä¸åŒçš„ç‰ˆæœ¬çœ‹çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636807430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019274,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","nickname":"é©¬å…‹å›¾å¸ƒ","note":"","ucode":"9E3879D6A55244","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414380,"discussion_content":"ç¬¬ä¸€ä¸ªæˆ‘ä¹Ÿæœ‰åŒæ ·çš„ç–‘é—®ï¼›\n\nç¬¬äºŒä¸ªçš„è¯ï¼Œå¯èƒ½æ˜¯ç”±äº RandomResizedCrop() åˆ‡åˆ†çš„ä½ç½®ä¸åŒï¼Œå¯¼è‡´ AlexNet é¢„æµ‹ç»“æœæœ‰äº›å·®å¼‚ï¼Œå¤šè·‘å‡ æ¬¡å°±èƒ½å‡ºç° 263 äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636730100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1702638,"avatar":"","nickname":"GEEKBANG_9421399","note":"","ucode":"1E3E1D6D6F2901","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1019274,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/8a/ec29ca4a.jpg","nickname":"é©¬å…‹å›¾å¸ƒ","note":"","ucode":"9E3879D6A55244","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550522,"discussion_content":"ç¬¬äºŒä¸ªæˆ‘ä¹Ÿè§‰å¾—æ˜¯RandomResizedCrop()çš„åŸå› ï¼Œæˆ‘ä¸‹è½½ä¸‹æ¥çš„ç‹—ç‹—å›¾ç‰‡sizeæ˜¯(1920, 1867)ï¼Œæ„Ÿè§‰å¦‚æœCropæ‰å¤ªå¤šéƒ¨åˆ†çš„è¯ï¼Œä¼šé¢„æµ‹ä¸å‡†çš„ã€‚æˆ‘æŠŠRandomResizedCrop()æ”¹æˆäº†Resize()ï¼Œé¢„æµ‹ç»“æœå°±æ˜¯263äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644575410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":414380,"ip_address":""},"score":550522,"extra":""}]}]}]}