{"id":425093,"title":"11ï½œé¢å‘æ¥å£ç¼–ç¨‹ï¼ˆä¸‹ï¼‰ï¼šä¸€åˆ‡çš†æœåŠ¡ï¼ŒæœåŠ¡åŸºäºåè®®","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è½©è„‰åˆƒã€‚</p><p>ä¹‹å‰å¯¹æ¯”é¢å‘è¿‡ç¨‹/é¢å‘å¯¹è±¡ï¼Œè®²è§£äº†æŠ½è±¡ç¨‹åº¦æ›´é«˜çš„é¢å‘æ¥å£ç¼–ç¨‹ç†å¿µï¼Œå…ˆå®šä¹‰æ¥å£å†æ¢³ç†å¦‚ä½•é€šè¿‡æ¥å£åè®®äº¤äº’ï¼Œæœ€åå®ç°å…·ä½“æ¨¡å—ã€‚</p><p>æ ¹æ®è¿™ä¸€ç†å¿µï¼Œæˆ‘ä»¬æ¡†æ¶çš„æ ¸å¿ƒè®¾è®¡å°±æ˜¯ï¼šæ¡†æ¶ä¸»ä½“ä½œä¸ºä¸€ä¸ªæœåŠ¡å®¹å™¨ï¼Œå…¶ä»–å„ä¸ªæœåŠ¡æ¨¡å—éƒ½ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œåœ¨æœåŠ¡å®¹å™¨ä¸­æ³¨å†Œè‡ªå·±çš„æœåŠ¡å‡­è¯å’ŒæœåŠ¡æ¥å£ï¼Œé€šè¿‡æœåŠ¡å‡­è¯æ¥è·å–å…·ä½“çš„æœåŠ¡å®ä¾‹ã€‚è¿™æ ·ï¼ŒåŠŸèƒ½çš„å…·ä½“å®ç°äº¤ç»™äº†å„ä¸ªæœåŠ¡æ¨¡å—ï¼Œæˆ‘ä»¬åªéœ€è¦è§„èŒƒæœåŠ¡æä¾›è€…ä¹Ÿå°±æ˜¯æœåŠ¡å®¹å™¨ä¸­çš„æ¥å£åè®®ã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾ä¹Ÿå·²ç»å®Œæˆäº†æœåŠ¡æä¾›æ–¹æ¥å£çš„å®ç°ã€‚æ‰€ä»¥ä»Šå¤©å°±æ¥ç€å®ç°æ¡†æ¶çš„ä¸»ä½“é€»è¾‘ã€‚</p><h2>æœåŠ¡å®¹å™¨çš„å®ç°</h2><p>é¦–å…ˆæ˜¯æœåŠ¡å®¹å™¨ï¼Œå…ˆçœ‹å®ƒéœ€è¦å…·æœ‰ä»€ä¹ˆèƒ½åŠ›ã€‚åŒæ ·çš„ï¼ŒæŒ‰ç…§é¢å‘æ¥å£ç¼–ç¨‹ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘å…·ä½“å®ç°ï¼Œå…ˆæ€è€ƒæœåŠ¡å®¹å™¨çš„æ¥å£è®¾è®¡ã€‚</p><p>å°†æœåŠ¡å®¹å™¨å®ç°åœ¨ framework/container.go æ–‡ä»¶ä¸­ã€‚</p><p>æ­£å¦‚ä¹‹å‰è®¨è®ºçš„ï¼Œ<strong>ä¸€ä¸ªæœåŠ¡å®¹å™¨ä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼šä¸ºæœåŠ¡æä¾›æ³¨å†Œç»‘å®šã€æä¾›è·å–æœåŠ¡å®ä¾‹</strong>ï¼Œæ‰€ä»¥æœåŠ¡å®¹å™¨è‡³å°‘æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šæ³¨å†Œæ–¹æ³• Bindã€è·å–å®ä¾‹æ–¹æ³• Makeã€‚</p><ul>\n<li>å¯¹äºæ³¨å†Œçš„æ–¹æ³•ï¼Œç›´æ¥å°†ä¸€ä¸ªæœåŠ¡æä¾›è€…æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œå‚æ•°æ˜¯ä¹‹å‰å®šä¹‰çš„æœåŠ¡æä¾›è€…ï¼Œè¿”å›å€¼åˆ™æ˜¯erroræ˜¯å¦æ³¨å†ŒæˆåŠŸã€‚</li>\n</ul><pre><code class=\"language-go\">// Bind ç»‘å®šä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¦‚æœå…³é”®å­—å‡­è¯å·²ç»å­˜åœ¨ï¼Œä¼šè¿›è¡Œæ›¿æ¢æ“ä½œï¼Œä¸è¿”å› error\nBind(provider ServiceProvider) error\n</code></pre><!-- [[[read_end]]] --><ul>\n<li>è·å–å®ä¾‹çš„æ–¹æ³•æ˜¯ Makeï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªå…³é”®å­—å‡­è¯ï¼Œæ¥è·å–å®¹å™¨ä¸­å·²ç»å®ä¾‹åŒ–å¥½çš„æœåŠ¡ã€‚æ‰€ä»¥å‚æ•°æ˜¯ä¸€ä¸ªå…³é”®å­—å‡­è¯ stringï¼Œè¿”å›å€¼æ˜¯å®ä¾‹åŒ–å¥½çš„æœåŠ¡ interfaceå’Œæ˜¯å¦æœ‰é”™è¯¯çš„ error ä¿¡æ¯ã€‚</li>\n</ul><pre><code class=\"language-go\">// Make æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œ\nMake(key string) (interface{}, error)\n</code></pre><p>æœ‰äº†è¿™ä¸¤ä¸ªåŸºç¡€æ–¹æ³•ï¼Œå†è€ƒè™‘åœ¨æ³¨å†Œç»‘å®šåŠè·å–æœåŠ¡å®ä¾‹è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»€ä¹ˆæ–¹é¢å¯ä»¥æ‰©å±•ã€‚</p><p>é¦–å…ˆï¼Œå› ä¸ºæœ‰ç»‘å®šæ“ä½œï¼Œé‚£ä¹ˆéœ€è¦æœ‰ä¸€ä¸ªç¡®è®¤æŸä¸ªå…³é”®å­—å‡­è¯æ˜¯å¦å·²ç»ç»‘å®šçš„èƒ½åŠ›ï¼šIsBindï¼Œå‚æ•°ä¸ºå…³é”®å­—å‡­è¯ï¼Œè¿”å›ä¸º bool è¡¨ç¤ºæ˜¯å¦å·²ç»ç»‘å®šã€‚</p><p>å…¶æ¬¡ï¼ŒMake æ–¹æ³•è¿”å›å€¼ä¸­å¸¦ error ä¿¡æ¯ï¼Œå…¶å®è¿™åœ¨æ˜“ç”¨æ€§ä¸Šå¹¶ä¸å‹å¥½ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½ç¡®å®šæŸä¸ªæœåŠ¡å®¹å™¨å·²ç»è¢«æ³¨å†Œäº†ï¼Œå¹¶ä¸éœ€è¦å¤„ç†è¿™ä¸ª errorã€‚æ‰€ä»¥å¯ä»¥å¢åŠ ä¸€ä¸ª MustMake æ–¹æ³•ï¼Œå®ƒçš„å‚æ•°å’Œ Make æ–¹æ³•ä¸€æ ·ï¼Œä¸ºå…³é”®å­—å‡­è¯ï¼Œè¿”å›å€¼ä¸ºå®ä¾‹åŒ–æœåŠ¡ï¼Œä½†æ˜¯ä¸è¿”å› errorã€‚</p><p>æœ€åæˆ‘ä»¬è€ƒè™‘ Make çš„ä¸€ç§æ‹“å±•åœºæ™¯ï¼Œ<strong>æ˜¯å¦ä¼šæœ‰åœ¨è·å–æœåŠ¡å®ä¾‹çš„æ—¶å€™ï¼ŒæŒ‰ç…§ä¸åŒå‚æ•°åˆå§‹åŒ–çš„éœ€æ±‚</strong>ï¼Ÿ</p><p>ä¸ŠèŠ‚è¯¾è¯´æœåŠ¡æä¾›è€…æä¾›äº†ï¼Œåˆå§‹åŒ–æœåŠ¡å®ä¾‹æ–¹æ³•çš„èƒ½åŠ› Register å’Œè·å–åˆå§‹åŒ–æœåŠ¡å®ä¾‹å‚æ•°çš„èƒ½åŠ› Paramsã€‚ä¸€æ—¦æœåŠ¡å®ä¾‹è¢«åˆå§‹åŒ–äº†ï¼Œå®ƒå°±ä¿å­˜åœ¨æœåŠ¡å®¹å™¨ä¸­äº†ï¼Œä¸‹æ¬¡è·å–çš„æ—¶å€™ï¼Œåªéœ€è¦è·å–å·²ç»å®ä¾‹åŒ–å¥½çš„æœåŠ¡ã€‚</p><p>ä½†æ˜¯åœ¨æŸæ¬¡è·å–çš„æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰éœ€æ±‚è¦æ ¹æ®ä¸åŒå‚æ•°è·å–æ–°çš„å®ä¾‹ã€‚æ¯”å¦‚éœ€è¦æ ¹æ®ä¸åŒçš„é…ç½®ï¼Œè·å–ä¸åŒçš„ç¼“å­˜å®ä¾‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¼ é€’ä¸åŒçš„å‚æ•°ã€‚æ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ª MakeNew çš„æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°è·å–ä¸åŒå®ä¾‹ã€‚</p><p>æ•´ç†ä¸€ä¸‹æœåŠ¡å®¹å™¨çš„äº”ä¸ªæ¥å£èƒ½åŠ›ï¼Œåœ¨framework/container.goä¸­ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">// Container æ˜¯ä¸€ä¸ªæœåŠ¡å®¹å™¨ï¼Œæä¾›ç»‘å®šæœåŠ¡å’Œè·å–æœåŠ¡çš„åŠŸèƒ½\ntype Container interface {\n\t// Bind ç»‘å®šä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¦‚æœå…³é”®å­—å‡­è¯å·²ç»å­˜åœ¨ï¼Œä¼šè¿›è¡Œæ›¿æ¢æ“ä½œï¼Œè¿”å› error\n\tBind(provider ServiceProvider) error\n\t// IsBind å…³é”®å­—å‡­è¯æ˜¯å¦å·²ç»ç»‘å®šæœåŠ¡æä¾›è€…\n\tIsBind(key string) bool\n\n\t// Make æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œ\n\tMake(key string) (interface{}, error)\n\t// MustMake æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœè¿™ä¸ªå…³é”®å­—å‡­è¯æœªç»‘å®šæœåŠ¡æä¾›è€…ï¼Œé‚£ä¹ˆä¼š panicã€‚\n\t// æ‰€ä»¥åœ¨ä½¿ç”¨è¿™ä¸ªæ¥å£çš„æ—¶å€™è¯·ä¿è¯æœåŠ¡å®¹å™¨å·²ç»ä¸ºè¿™ä¸ªå…³é”®å­—å‡­è¯ç»‘å®šäº†æœåŠ¡æä¾›è€…ã€‚\n\tMustMake(key string) interface{}\n\t// MakeNew æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œåªæ˜¯è¿™ä¸ªæœåŠ¡å¹¶ä¸æ˜¯å•ä¾‹æ¨¡å¼çš„\n\t// å®ƒæ˜¯æ ¹æ®æœåŠ¡æä¾›è€…æ³¨å†Œçš„å¯åŠ¨å‡½æ•°å’Œä¼ é€’çš„ params å‚æ•°å®ä¾‹åŒ–å‡ºæ¥çš„\n\t// è¿™ä¸ªå‡½æ•°åœ¨éœ€è¦ä¸ºä¸åŒå‚æ•°å¯åŠ¨ä¸åŒå®ä¾‹çš„æ—¶å€™éå¸¸æœ‰ç”¨\n\tMakeNew(key string, params []interface{}) (interface{}, error)\n}\n</code></pre><h2>å…·ä½“å®ç°</h2><p>ç°åœ¨æ¥å£è®¾è®¡å¥½äº†ï¼Œä¸‹é¢ç»“åˆäº¤äº’æ€è€ƒä¸‹å¦‚ä½•å®ç°è¿™ä¸ªæœåŠ¡å®¹å™¨ã€‚æˆ‘ä»¬å°±å®šä¹‰ä¸€ä¸ª HadeContainer æ•°æ®ç»“æ„æ¥å®ç° Container æ¥å£ï¼Œå› ä¸ºåŠŸèƒ½æ˜¯æä¾›ç»‘å®šæœåŠ¡å’Œè·å–æœåŠ¡ï¼Œéœ€è¦æ ¹æ®å…³é”®å­—è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ Hash Map æ˜¯ç¬¦åˆéœ€æ±‚çš„ã€‚</p><p>åœ¨ HadeContainer å†…éƒ¨åº”è¯¥æœ‰ä¸€ä¸ª map[string]interface{} ç»“æ„ instancesï¼Œå…¶ä¸­ key ä¸ºå…³é”®å­—ï¼Œvalue ä¸ºå…·ä½“çš„æœåŠ¡å®ä¾‹ï¼Œè¿™æ · instances ç»“æ„å¯ä»¥å­˜å‚¨æ¯ä¸ªå…³é”®å­—å‡­è¯å¯¹åº”çš„æœåŠ¡å®ä¾‹ï¼Œåœ¨ Make ç³»åˆ—çš„æ–¹æ³•ä¸­ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªç»“æ„è·å–å¯¹åº”çš„æœåŠ¡å®ä¾‹ã€‚</p><p>åŒç†æœåŠ¡æä¾›æ–¹ä¹Ÿéœ€è¦è®¾è®¡ä¸€ä¸ª map[string]ServiceProvider æ¥å­˜å‚¨å®ƒä»¬ï¼Œè¿™æ ·åœ¨ Bind æ“ä½œçš„æ—¶å€™ï¼Œåªéœ€è¦å°†æœåŠ¡æä¾›æ–¹ç»‘å®šåˆ°æŸä¸ªå…³é”®å­—å‡­è¯ä¸Šå³å¯ã€‚</p><p>å¦å¤–è¿˜è¦å…³æ³¨ä¸€ä¸‹æ•°æ®ç»“æ„çš„å¹¶å‘æ€§ã€‚å› ä¸ºå½“ Bind çš„æ—¶å€™<strong>ä¼šå¯¹å®ä¾‹æˆ–è€…æœåŠ¡æä¾›æ–¹æœ‰ä¸€å®šçš„å˜åŠ¨ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªæœºåˆ¶æ¥ä¿è¯ HadeContianer çš„å¹¶å‘æ€§</strong>ï¼Œæ˜¯ç”¨è¯»å†™é”è¿˜æ˜¯äº’æ–¥é”å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬å°±è¦å…³æ³¨åŠŸèƒ½äº†ï¼Œè¿™ä¸ª HadeContainer æ˜¯ä¸€ä¸ªè¯»å¤šäºå†™çš„æ•°æ®ç»“æ„ï¼Œå³ Bind æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä½†æ˜¯ Make æ˜¯é¢‘ç¹çš„ã€‚æ‰€ä»¥ä½¿ç”¨è¯»å†™é”çš„æ€§èƒ½ä¼šä¼˜äºäº’æ–¥é”ã€‚</p><p>å¥½æ•´ç†ä¸€ä¸‹ï¼Œåœ¨framework/container.goä¸­ HadeContainer çš„å­—æ®µå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">// HadeContainer æ˜¯æœåŠ¡å®¹å™¨çš„å…·ä½“å®ç°\ntype HadeContainer struct {\n\tContainer // å¼ºåˆ¶è¦æ±‚ HadeContainer å®ç° Container æ¥å£\n\t// providers å­˜å‚¨æ³¨å†Œçš„æœåŠ¡æä¾›è€…ï¼Œkey ä¸ºå­—ç¬¦ä¸²å‡­è¯\n\tproviders map[string]ServiceProvider\n\t// instance å­˜å‚¨å…·ä½“çš„å®ä¾‹ï¼Œkey ä¸ºå­—ç¬¦ä¸²å‡­è¯\n\tinstances map[string]interface{}\n\t// lock ç”¨äºé”ä½å¯¹å®¹å™¨çš„å˜æ›´æ“ä½œ\n\tlock sync.RWMutex\n}\n</code></pre><p>ç„¶åå¯¹åº” HadeContainer ï¼Œæ¥å®ç° Container å®šä¹‰çš„å‡ ä¸ªæ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¯¹ providers å’Œ instances ä¸¤ä¸ª map ç»“æ„çš„ä¿®æ”¹å’Œè¯»å–ã€‚è¿™é‡Œæœ€æ ¸å¿ƒçš„ Bind æ–¹æ³•ï¼Œæˆ‘ä¼šç»“åˆä»£ç è®²å¾—æ¯”è¾ƒç»†è‡´ï¼Œä½ å¯ä»¥è®¤çœŸä½“ä¼šã€‚</p><h3>Bind æ–¹æ³•</h3><p>é¦–å…ˆå› ä¸º Bind æ–¹æ³•æ˜¯ä¸€ä¸ªå†™æ“ä½œï¼Œä¼šä¿®æ”¹ providers å’Œ instancesï¼Œæ‰€ä»¥åœ¨å‡½æ•°ä¸€å¼€å¤´ï¼Œå…ˆç»™åŠ ä¸Šä¸€ä¸ªå†™é”ï¼Œç„¶åæˆ‘ä»¬ä¿®æ”¹ providers è¿™ä¸ªå­—æ®µï¼Œå®ƒçš„ key ä¸ºå…³é”®å­—ï¼Œvalue ä¸ºæ³¨å†Œçš„ ServiceProviderã€‚</p><p>æ¥ç€è¿™é‡Œ<strong>éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦å®ä¾‹åŒ–</strong>ï¼Œå› ä¸ºå®šä¹‰çš„ ServiceProvider ä¸­çš„ IsDefer æ–¹æ³•ï¼Œæ§åˆ¶äº†å®ä¾‹åŒ–æ—¶æœºã€‚</p><p>å¦‚æœ IsDefer æ–¹æ³•æ ‡è®°è¿™ä¸ªæœåŠ¡å®ä¾‹è¦å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œå³ç­‰åˆ°ç¬¬ä¸€æ¬¡ make çš„æ—¶å€™å†å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆåœ¨ Bind æ“ä½œçš„æ—¶å€™ï¼Œå°±ä»€ä¹ˆéƒ½ä¸éœ€è¦åšï¼›è€Œå¦‚æœ IsDefer æ–¹æ³•ä¸º falseï¼Œå³æ³¨å†Œæ—¶å°±è¦å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦åœ¨ Bind å‡½æ•°ä¸­å¢åŠ å®ä¾‹åŒ–çš„æ–¹æ³•ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥å®ç°å®ä¾‹åŒ–ï¼Œæ–¹æ³•å’Œå‚æ•°å°±æ˜¯ ServiceProvider ä¸­çš„ Register å’Œ Params æ–¹æ³•ï¼Œåˆ†åˆ«å–å‡ºå®ä¾‹åŒ–æ–¹æ³•å’Œå‚æ•°è¿›è¡Œè°ƒç”¨ï¼Œå°±è·å–åˆ°äº†å…·ä½“çš„æœåŠ¡å®ä¾‹ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ä¸‹ï¼Œä¹‹å‰ä¸º ServiceProvider å®šä¹‰è¿‡ä¸€ä¸ª Boot æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†æœåŠ¡å®ä¾‹åŒ–å‰åšä¸€äº›å‡†å¤‡å·¥ä½œçš„ã€‚æ‰€ä»¥åœ¨å®ä¾‹åŒ–ä¹‹å‰ï¼Œè¦å…ˆè°ƒç”¨è¿™ä¸ª Boot æ–¹æ³•ï¼ŒåŒæ ·åœ¨framework/container.goä¸­è¿›è¡Œä¿®æ”¹ã€‚</p><pre><code class=\"language-go\">// Bind å°†æœåŠ¡å®¹å™¨å’Œå…³é”®å­—åšäº†ç»‘å®š\nfunc (hade *HadeContainer) Bind(provider ServiceProvider) error {\n\thade.lock.Lock()\n\tdefer hade.lock.Unlock()\n\tkey := provider.Name()\n\n\thade.providers[key] = provider\n\n\t// if provider is not defer\n\tif provider.IsDefer() == false {\n\t\tif err := provider.Boot(hade); err != nil {\n\t\t\treturn err\n\t\t}\n\t\t// å®ä¾‹åŒ–æ–¹æ³•\n\t\tparams := provider.Params(hade)\n\t\tmethod := provider.Register(hade)\n\t\tinstance, err := method(params...)\n\t\tif err != nil {\n\t\t\treturn errors.New(err.Error())\n\t\t}\n\t\thade.instances[key] = instance\n\t}\n\treturn nil\n}\n</code></pre><h3>Make æ–¹æ³•</h3><p>ä¸ºæœåŠ¡æä¾›æ³¨å†Œç»‘å®šçš„Bindæ–¹æ³•æˆ‘ä»¬å°±å®Œæˆäº†ï¼Œå†æ¥çœ‹æœåŠ¡å®¹å™¨çš„å¦ä¸€ä¸ªåŠŸèƒ½æä¾›è·å–æœåŠ¡å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ Make æ–¹æ³•ã€‚</p><p>å…ˆåˆ¤æ–­æŸä¸ªå…³é”®å­—æ˜¯å¦å·²ç»æ³¨å†Œäº†æœåŠ¡æä¾›è€…ï¼Œå¦‚æœæ²¡æœ‰æ³¨å†Œåˆ™åç»­ä¸èƒ½æˆåŠŸè¿”å›é”™è¯¯ï¼Œå¦‚æœå·²ç»æ³¨å†Œäº†å°±è¿›è¡Œå®ä¾‹åŒ–æ“ä½œã€‚</p><p>åŒæ—¶æ³¨æ„ä¸‹ï¼Œåœ¨ä¸Šé¢è§£é‡Šè¿‡ï¼Œä¹Ÿä¼šæœ‰æ‰©å±•éœ€æ±‚ï¼ŒæŒ‰ç…§ä¸åŒå‚æ•°å†æ¬¡åˆå§‹åŒ–æœåŠ¡çš„éœ€æ±‚ã€‚ä¹Ÿå°±æ˜¯MakeNewæ–¹æ³•ï¼Œå®ƒå’ŒMakeæ–¹æ³•åœ¨å†…éƒ¨è°ƒç”¨æœ€å¤§çš„ä¸åŒæ˜¯ä¼ é€’äº†ä¸€ä¸ªå¼ºåˆ¶åˆå§‹åŒ–çš„æ ‡è®°forceNewï¼Œå’Œåˆå§‹åŒ–éœ€è¦çš„å‚æ•°paramsã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ä¸¤ä¸ªå‡½æ•°å…±åŒçš„å†…éƒ¨å®ç°makeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦å¼ºåˆ¶åˆå§‹åŒ–å®ä¾‹ï¼Œå¦‚æœéœ€è¦å¼ºåˆ¶åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åç›´æ¥è¿”å›ã€‚è€Œä¸éœ€è¦å¼ºåˆ¶åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ¤æ–­ä¹‹å‰æ˜¯å¦å·²ç»å®ä¾‹åŒ–äº†ï¼Œå¦‚æœå·²ç»å®ä¾‹åŒ–äº†ï¼Œåˆ™è¿”å›ã€‚</p><p>æ–¹æ³•çš„å®ç°åŒæ ·åœ¨framework/container.goä¸­ï¼š</p><pre><code class=\"language-go\">// Make æ–¹å¼è°ƒç”¨å†…éƒ¨çš„ make å®ç°\nfunc (hade *HadeContainer) Make(key string) (interface{}, error) {\n\treturn hade.make(key, nil, false)\n}\n\n// MakeNew æ–¹å¼ä½¿ç”¨å†…éƒ¨çš„ make åˆå§‹åŒ–\nfunc (hade *HadeContainer) MakeNew(key string, params []interface{}) (interface{}, error) {\n\treturn hade.make(key, params, true)\n}\n\n// çœŸæ­£çš„å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡\nfunc (hade *HadeContainer) make(key string, params []interface{}, forceNew bool) (interface{}, error) {\n\thade.lock.RLock()\n\tdefer hade.lock.RUnlock()\n\t// æŸ¥è¯¢æ˜¯å¦å·²ç»æ³¨å†Œäº†è¿™ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¦‚æœæ²¡æœ‰æ³¨å†Œï¼Œåˆ™è¿”å›é”™è¯¯\n\tsp := hade.findServiceProvider(key)\n\tif sp == nil {\n\t\treturn nil, errors.New(\"contract \" + key + \" have not register\")\n\t}\n\n\tif forceNew {\n\t\treturn hade.newInstance(sp, params)\n\t}\n\n\t// ä¸éœ€è¦å¼ºåˆ¶é‡æ–°å®ä¾‹åŒ–ï¼Œå¦‚æœå®¹å™¨ä¸­å·²ç»å®ä¾‹åŒ–äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨å®¹å™¨ä¸­çš„å®ä¾‹\n\tif ins, ok := hade.instances[key]; ok {\n\t\treturn ins, nil\n\t}\n\n\t// å®¹å™¨ä¸­è¿˜æœªå®ä¾‹åŒ–ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡å®ä¾‹åŒ–\n\tinst, err := hade.newInstance(sp, nil)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\thade.instances[key] = inst\n\treturn inst, nil\n}\n</code></pre><h2>å®¹å™¨å’Œæ¡†æ¶çš„ç»“åˆ</h2><p>å®Œæˆäº†æœåŠ¡å®¹å™¨çš„æ¥å£å’Œå¯¹åº”å…·ä½“å®ç°ï¼Œä¸‹é¢å°±è¦æ€è€ƒå¦‚ä½•å°†æœåŠ¡å®¹å™¨èåˆè¿›å…¥æ¡†æ¶ä¸­ã€‚</p><p>å›é¡¾ä¸‹ hade æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ•°æ®ç»“æ„ Engine å’Œ Contextã€‚</p><ul>\n<li>Engine å°±æ˜¯åœ¨<a href=\"https://time.geekbang.org/column/article/417674\">ç¬¬ä¸€èŠ‚è¯¾</a>ä¸­å®ç°çš„ Core æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„æ˜¯æ•´ä¸ªæ¡†æ¶çš„å…¥å£ï¼Œä¹Ÿæ‰¿æ‹…äº†æ•´ä¸ªæ¡†æ¶æœ€æ ¸å¿ƒçš„è·¯ç”±ã€ä¸­é—´ä»¶ç­‰éƒ¨åˆ†ã€‚</li>\n<li>Context æ•°æ®ç»“æ„å¯¹åº”<a href=\"https://time.geekbang.org/column/article/418283\">ç¬¬äºŒè¯¾</a>ä¸­å®ç°çš„ Context æ•°æ®ç»“æ„ï¼Œå®ƒä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ª Contextï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹è¯·æ±‚æ“ä½œçš„æ–¹æ³•ã€‚</li>\n</ul><p>å¯¹åº”æ¥çœ‹æˆ‘ä»¬çš„æœåŠ¡å®¹å™¨ï¼Œå®ƒæä¾›äº†ä¸¤ç±»æ–¹æ³•ï¼Œç»‘å®šæ“ä½œå’Œè·å–æ“ä½œã€‚ç»‘å®šæ“ä½œæ˜¯å…¨å±€çš„æ“ä½œï¼Œè€Œè·å–æ“ä½œæ˜¯åœ¨å•ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨çš„ã€‚æ‰€ä»¥åœ¨å…¨å±€ï¼Œæˆ‘ä»¬ä¸ºæœåŠ¡å®¹å™¨ç»‘å®šäº†æœåŠ¡æä¾›æ–¹ï¼Œå°±èƒ½åœ¨å•ä¸ªè¯·æ±‚ä¸­è·å–è¿™ä¸ªæœåŠ¡ã€‚</p><p>é‚£ä¹ˆå¯¹åº”åˆ°æ¡†æ¶ä¸­ï¼Œå¯ä»¥<strong>å°†æœåŠ¡å®¹å™¨å­˜æ”¾åœ¨ Engine ä¸­ï¼Œå¹¶ä¸”åœ¨ Engine åˆå§‹åŒ– Context çš„æ—¶å€™ï¼Œå°†æœåŠ¡å®¹å™¨ä¼ é€’è¿›å…¥ Context</strong>ã€‚æ€è·¯å¾ˆæ¸…æ™°ï¼Œæ¥ä¸‹æ¥å°±æŒ‰éƒ¨å°±ç­å†™ã€‚</p><p>é¦–å…ˆï¼Œåœ¨æ¡†æ¶æ–‡ä»¶framework/gin/gin.go ä¸­ä¿®æ”¹ Engine çš„æ•°æ®ç»“æ„ï¼Œå¢åŠ  container å®¹å™¨ï¼Œå¹¶ä¸”åœ¨åˆå§‹åŒ– Engine çš„æ—¶å€™ï¼Œä¹ŸåŒæ—¶åˆå§‹åŒ– containerã€‚</p><pre><code class=\"language-go\">type Engine struct {\n\t// å®¹å™¨\n\tcontainer framework.Container\n    ...\n}\n\nfunc New() *Engine {\n\tdebugPrintWARNINGNew()\n\tengine := &amp;Engine{\n\t\t...\n\t\t// è¿™é‡Œæ³¨å…¥äº† container\n\t\tcontainer:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; framework.NewHadeContainer(),\n\t\t...\n\t}\n\t...\n\treturn engine\n}\n</code></pre><p>æ¥ç€ï¼Œåœ¨ Engine åˆ›å»º context çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°† engine ä¸­çš„ container å®¹å™¨æ³¨å…¥åˆ°æ¯ä¸ª context ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹ Context çš„æ•°æ®ç»“æ„ï¼Œå¢åŠ  container å®¹å™¨ã€‚åŒæ ·ä¿®æ”¹framework/gin/gin.goä¸­çš„allocateContextæ–¹æ³•ã€‚</p><pre><code class=\"language-go\">// engine åˆ›å»º context\nfunc (engine *Engine) allocateContext() *Context {\n\tv := make(Params, 0, engine.maxParams)\n\t// åœ¨åˆ†é…æ–°çš„ Context çš„æ—¶å€™ï¼Œæ³¨å…¥äº† container\n\treturn &amp;Context{engine: engine, params: &amp;v, container: engine.container}\n}\n</code></pre><p>å’Œä¿®æ”¹framework/gin/context.goä¸­çš„Contextå®šä¹‰ã€‚</p><pre><code class=\"language-go\">// Context åœ¨æ¯ä¸ªè¯·æ±‚ä¸­éƒ½æœ‰\ntype Context struct {\n\t// Context ä¸­ä¿å­˜å®¹å™¨\n\tcontainer framework.Container\n    ...\n}\n</code></pre><p>è¿™æ ·å°±å®Œæˆäº†æœåŠ¡å®¹å™¨çš„åˆ›å»ºå’Œä¼ é€’ï¼Œæ¥ä¸‹æ¥å®ŒæˆæœåŠ¡å®¹å™¨æ–¹æ³•çš„å°è£…ã€‚</p><p>æ ¹æ®ä¸Šé¢æè¿°çš„ï¼ŒEngine ä¸­è´Ÿè´£ç»‘å®šï¼ŒContext ä¸­è´Ÿè´£è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬å°† container çš„äº”ä¸ªèƒ½åŠ›æ‹†åˆ†åˆ° Engine å’Œ Context æ•°æ®ç»“æ„ä¸­ã€‚Engine å°è£… Bind å’Œ IsBind æ–¹æ³•ï¼ŒContext å°è£… Makeã€MakeNewã€MustMake æ–¹æ³•ã€‚</p><p>å°†è¿™äº›ä¸ºEngineå’ŒContext å¢åŠ çš„æ–°çš„æ–¹æ³•å•ç‹¬å­˜æ”¾åœ¨ä¸€ä¸ªæ–°çš„æ–‡ä»¶framework/gin/hade_context.goä¸­ã€‚</p><pre><code class=\"language-go\">// engine å®ç° container çš„ç»‘å®šå°è£…\nfunc (engine *Engine) Bind(provider framework.ServiceProvider) error {\n\treturn engine.container.Bind(provider)\n}\n\n// IsBind å…³é”®å­—å‡­è¯æ˜¯å¦å·²ç»ç»‘å®šæœåŠ¡æä¾›è€…\nfunc (engine *Engine) IsBind(key string) bool {\n\treturn engine.container.IsBind(key)\n}\n\n\n\n// context å®ç° container çš„å‡ ä¸ªå°è£…\n// å®ç° make çš„å°è£…\nfunc (ctx *Context) Make(key string) (interface{}, error) {\n\treturn ctx.container.Make(key)\n}\n\n// å®ç° mustMake çš„å°è£…\nfunc (ctx *Context) MustMake(key string) interface{} {\n\treturn ctx.container.MustMake(key)\n}\n\n// å®ç° makenew çš„å°è£…\nfunc (ctx *Context) MakeNew(key string, params []interface{}) (interface{}, error) {\n\treturn ctx.container.MakeNew(key, params)\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å°†æœåŠ¡å®¹å™¨å’Œæ¡†æ¶ç»“åˆäº†ï¼Œè¿˜éœ€è¦å®Œæˆåˆ›å»ºæœåŠ¡æä¾›æ–¹å¹¶åˆ›å»ºæœåŠ¡çš„é€»è¾‘ã€‚</p><h2>å¦‚ä½•åˆ›å»ºä¸€ä¸ªæœåŠ¡æä¾›æ–¹</h2><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæœåŠ¡ DemoServiceï¼Œä¸ºè¿™ä¸ªæœåŠ¡åˆ›å»ºä¸€ä¸ªæœåŠ¡æä¾›æ–¹ DemoServiceProviderï¼Œå¹¶æ³¨å…¥åˆ°æœåŠ¡å®¹å™¨ä¸­ã€‚åœ¨ä¸šåŠ¡ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç›®å½•provider/demoå­˜æ”¾è¿™ä¸ªæœåŠ¡ã€‚</p><p>å…ˆææ¸…æ¥šéœ€è¦ä¸ºè¿™ä¸ªæœåŠ¡è®¾è®¡å‡ ä¸ªæ–‡ä»¶ã€‚</p><ul>\n<li>è¦æœ‰ä¸€ä¸ªæœåŠ¡æ¥å£æ–‡ä»¶ contract.goï¼Œå­˜æ”¾æœåŠ¡çš„æ¥å£æ–‡ä»¶å’ŒæœåŠ¡å‡­è¯ã€‚</li>\n<li>éœ€è¦è®¾è®¡ä¸€ä¸ª provider.goï¼Œè¿™ä¸ªæ–‡ä»¶å­˜æ”¾æœåŠ¡æä¾›æ–¹ ServiceProvider çš„å®ç°ã€‚</li>\n<li>æœ€ååœ¨ service.go æ–‡ä»¶ä¸­å®ç°å…·ä½“çš„æœåŠ¡å®ä¾‹ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/ac/2f/ac03471e430a73a1d90d4fb5a18d4a2f.png?wh=507x411\" alt=\"\"></li>\n</ul><p>æ‰€ä»¥å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæœåŠ¡æ¥å£è¯´æ˜æ–‡ä»¶ contract.goï¼Œåœ¨æ–‡ä»¶ä¸­è¦åšä¸¤ä¸ªäº‹æƒ…ã€‚ä¸€æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡çš„å…³é”®å­—å‡­è¯ï¼Œè¿™ä¸ªå‡­è¯æ˜¯ç”¨æ¥æ³¨å†ŒæœåŠ¡åˆ°å®¹å™¨ä¸­ä½¿ç”¨çš„ï¼Œè¿™é‡Œä½¿ç”¨â€œhade:demoâ€æ¥ä½œä¸ºæœåŠ¡å®¹å™¨çš„å…³é”®å­—ã€‚</p><p>å¦å¤–åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è¦è®¾è®¡è¿™ä¸ªæœåŠ¡çš„æ¥å£ï¼ŒåŒ…æ‹¬æ¥å£æ–¹æ³•å’Œæ¥å£æ–¹æ³•ä½¿ç”¨çš„å¯¹è±¡ã€‚æ¯”å¦‚è¿™é‡Œå°±è®¾è®¡äº† demo.Service æ¥å£ï¼Œå®ƒæœ‰ä¸€ä¸ª GetFoo æ–¹æ³•ï¼Œè¿”å›äº† Foo çš„æ•°æ®ç»“æ„ã€‚</p><pre><code class=\"language-go\">package demo\n\n// Demo æœåŠ¡çš„ key\nconst Key = \"hade:demo\"\n\n// Demo æœåŠ¡çš„æ¥å£\ntype Service interface {\n\tGetFoo() Foo\n}\n\n// Demo æœåŠ¡æ¥å£å®šä¹‰çš„ä¸€ä¸ªæ•°æ®ç»“æ„\ntype Foo struct {\n\tName string\n}\n</code></pre><p>æ¥ä¸‹æ¥æ˜¯æœåŠ¡æä¾›æ–¹ DemoServiceProviderï¼Œåœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†æœåŠ¡æä¾›æ–¹ ServiceProvider éœ€è¦å®ç°çš„äº”ä¸ªèƒ½åŠ›æ–¹æ³•ï¼Œä¸€ä¸€å¯¹ç…§å®Œæˆå®šä¹‰ã€‚</p><ul>\n<li>Name æ–¹æ³•ç›´æ¥å°†æœåŠ¡å¯¹åº”çš„å­—ç¬¦ä¸²å‡­è¯è¿”å›ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯â€œhade.demo\"ã€‚</li>\n<li>Register æ–¹æ³•ï¼Œæ˜¯æ³¨å†Œåˆå§‹åŒ–æœåŠ¡å®ä¾‹çš„æ–¹æ³•ï¼Œè¿™é‡Œå…ˆæš‚å®šä¸º NewDemoServiceã€‚</li>\n<li>Params æ–¹æ³•è¡¨ç¤ºå®ä¾‹åŒ–çš„å‚æ•°ã€‚è¿™é‡Œåªå®ä¾‹åŒ–ä¸€ä¸ªå‚æ•°ï¼šcontainerï¼Œè¡¨ç¤ºæˆ‘ä»¬åœ¨ NewDemoService è¿™ä¸ªå‡½æ•°ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°containerã€‚</li>\n<li>IsDefer æ–¹æ³•è¡¨ç¤ºæ˜¯å¦å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œè¿™é‡Œè®¾ç½®ä¸º trueï¼Œå°†è¿™ä¸ªæœåŠ¡çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡ make çš„æ—¶å€™ã€‚</li>\n<li>Boot æ–¹æ³•ï¼Œè¿™é‡Œå°±ç®€å•è®¾è®¡ä¸ºä»€ä¹ˆé€»è¾‘éƒ½ä¸æ‰§è¡Œï¼Œåªæ‰“å°ä¸€è¡Œæ—¥å¿—ä¿¡æ¯ã€‚</li>\n</ul><p>åœ¨provider/demo/provider.goä¸­å®šä¹‰é€»è¾‘ï¼š</p><pre><code class=\"language-go\">// æœåŠ¡æä¾›æ–¹\ntype DemoServiceProvider struct {\n}\n\n// Name æ–¹æ³•ç›´æ¥å°†æœåŠ¡å¯¹åº”çš„å­—ç¬¦ä¸²å‡­è¯è¿”å›ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯â€œhade.demo\"\nfunc (sp *DemoServiceProvider) Name() string {\n\treturn Key\n}\n\n// Register æ–¹æ³•æ˜¯æ³¨å†Œåˆå§‹åŒ–æœåŠ¡å®ä¾‹çš„æ–¹æ³•ï¼Œè¿™é‡Œå…ˆæš‚å®šä¸º NewDemoService\nfunc (sp *DemoServiceProvider) Register(c framework.Container) framework.NewInstance {\n\treturn NewDemoService\n}\n\n// IsDefer æ–¹æ³•è¡¨ç¤ºæ˜¯å¦å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œè®¾ç½®ä¸º trueï¼Œå°†è¿™ä¸ªæœåŠ¡çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡ make çš„æ—¶å€™\nfunc (sp *DemoServiceProvider) IsDefer() bool {\n\treturn true\n}\n\n// Params æ–¹æ³•è¡¨ç¤ºå®ä¾‹åŒ–çš„å‚æ•°ã€‚æˆ‘ä»¬è¿™é‡Œåªå®ä¾‹åŒ–ä¸€ä¸ªå‚æ•°ï¼šcontainerï¼Œè¡¨ç¤ºæˆ‘ä»¬åœ¨ NewDemoService è¿™ä¸ªå‡½æ•°ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œcontainer\nfunc (sp *DemoServiceProvider) Params(c framework.Container) []interface{} {\n\treturn []interface{}{c}\n}\n\n// Boot æ–¹æ³•æˆ‘ä»¬è¿™é‡Œæˆ‘ä»¬ä»€ä¹ˆé€»è¾‘éƒ½ä¸æ‰§è¡Œ, åªæ‰“å°ä¸€è¡Œæ—¥å¿—ä¿¡æ¯\nfunc (sp *DemoServiceProvider) Boot(c framework.Container) error {\n\tfmt.Println(\"demo service boot\")\n\treturn nil\n}\n</code></pre><p>åœ¨æœ€åçš„å…·ä½“ Demo æœåŠ¡å®ç°æ–‡ä»¶ service.go ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç° demo çš„æ¥å£ã€‚åˆ›å»ºä¸€ä¸ª DemoService çš„æ•°æ®ç»“æ„ï¼Œæ¥å®ç° demo çš„æ¥å£ GetFooï¼Œå’Œæ­£å¸¸å†™ä¸€ä¸ªæœåŠ¡å®ç°æŸä¸ªæ¥å£çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚</p><pre><code class=\"language-go\">// å…·ä½“çš„æ¥å£å®ä¾‹\ntype DemoService struct {\n\t// å®ç°æ¥å£\n\tService\n\n    // å‚æ•°\n\tc framework.Container\n}\n\n// å®ç°æ¥å£\nfunc (s *DemoService) GetFoo() Foo {\n\treturn Foo{\n\t\tName: \"i am foo\",\n\t}\n}\n</code></pre><p>è¿™é‡Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œåœ¨ DemoService çš„æ•°æ®ç»“æ„ä¸­ï¼Œ<strong>ç›´æ¥åµŒå¥—æ˜¾å¼åœ°å†™äº† Service æ¥å£ï¼Œè¡¨ç¤ºè¿™ä¸ª DemoService å¿…é¡»å®ç° Service æ¥å£</strong>ã€‚è¿™æ˜¯æˆ‘ä¸ªäººçš„å°ä¹ æƒ¯ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·æ˜¾å¼å¼ºè°ƒæ¥å£å®ç°çš„ï¼Œå› ä¸ºåœ¨ Golang ä¸­ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªéœ€è¦å®ç°äº†ä¸€ä¸ªæ¥å£çš„æ–¹æ³•ï¼Œå®ƒå°±éšå¼åœ°å®ç°äº†è¿™ä¸ªæ¥å£ã€‚</p><p>ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¹ æƒ¯è¿™æ ·æ˜¾å¼å¼ºè°ƒçš„å†™æ³•ï¼Œä¹Ÿæ¨èä½ å¯ä»¥è¯•ä¸€è¯•ï¼Œæœ‰ä¸¤ä¸ªå¥½å¤„ã€‚</p><p>ç¬¬ä¸€å¯¹ IDE å‹å¥½ï¼Œæœ‰çš„ IDEæ¯”å¦‚ VS Codeï¼Œåœ¨â€œæ ¹æ®æ¥å£æŸ¥æ‰¾å…·ä½“å®ç°çš„æ•°æ®ç»“æ„â€çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¹ˆä¸€ä¸ªæ˜¾å¼æ ‡è®°ï¼Œæ˜¯å¯»æ‰¾ä¸å‡ºæ¥çš„ã€‚ç¬¬äºŒä¸ªæ›´é‡è¦çš„åŸå› æ˜¯å¯¹ç¼–è¯‘å‹å¥½ï¼Œä¸€æ—¦æ¥å£ Service å˜åŒ–äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ç°æ¥å£çš„å®ä¾‹ï¼Œå¿…é¡»è¦æœ‰å¯¹åº”å˜åŒ–ï¼Œå¦åˆ™åœ¨ç¼–è¯‘æœŸå°±ä¼šå‡ºç°é”™è¯¯äº†ã€‚</p><p>ç°åœ¨æœ‰äº†å…·ä½“çš„æ¥å£å®ç°ç»“æ„ DemoServiceï¼Œæˆ‘ä»¬åªéœ€è¦æœ€åå®ç°ä¸€ä¸ªåˆå§‹åŒ–è¿™ä¸ªæœåŠ¡å®ä¾‹çš„æ–¹æ³• NewDemoServiceã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„æ¥å£ï¼Œè¿”å›å€¼æ˜¯æœåŠ¡å®ä¾‹ã€‚è¿˜æ˜¯æŠŠè¿™ä¸ªæ–¹æ³•å­˜æ”¾åœ¨provider/demo/service.goä¸­ï¼š</p><pre><code class=\"language-go\">// åˆå§‹åŒ–å®ä¾‹çš„æ–¹æ³•\nfunc NewDemoService(params ...interface{}) (interface{}, error) {\n\t// è¿™é‡Œéœ€è¦å°†å‚æ•°å±•å¼€\n\tc := params[0].(framework.Container)\n\n\tfmt.Println(\"new demo service\")\n\t// è¿”å›å®ä¾‹\n\treturn &amp;DemoService{c: c}, nil\n}\n</code></pre><p>åˆ°è¿™é‡Œï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹çš„æœåŠ¡æä¾›æ–¹ DemoServiceã€‚ä¸‹é¢å†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæœåŠ¡æä¾›æ–¹ã€‚</p><h2>å¦‚ä½•é€šè¿‡æœåŠ¡æä¾›æ–¹åˆ›å»ºæœåŠ¡</h2><p>è¿™é‡Œå®ç°éå¸¸ç®€å•ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä¸ªæ“ä½œï¼Œç»‘å®šæœåŠ¡æä¾›æ–¹ã€è·å–æœåŠ¡ã€‚</p><p>é¦–å…ˆæ˜¯åœ¨ä¸šåŠ¡æ–‡ä»¶å¤¹çš„main.goä¸­ç»‘å®šæ“ä½œï¼Œåœ¨ main å‡½æ•°ä¸­ï¼Œå®Œæˆ engine çš„åˆ›å»ºä¹‹åï¼Œç”¨åœ¨ engine ä¸­å°è£…çš„ Bind æ–¹æ³•åšä¸€æ¬¡ç»‘å®šæ“ä½œã€‚</p><pre><code class=\"language-go\">func main() {\n\t// åˆ›å»º engine ç»“æ„\n\tcore := gin.New()\n\t// ç»‘å®šå…·ä½“çš„æœåŠ¡\n\tcore.Bind(&amp;demo.DemoServiceProvider{})\n    ...\n}\n</code></pre><p>ç„¶åå°±æ˜¯æœåŠ¡çš„è·å–äº†ã€‚åœ¨å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©è·¯ç”±/subject/list/all å¯¹åº”çš„æ§åˆ¶å™¨ SubjectListControllerï¼Œä½¿ç”¨ä¸º context å°è£…çš„ MustMake æ–¹æ³•æ¥è·å– demo æœåŠ¡å®ä¾‹ã€‚</p><p>MustMake çš„å‚æ•°ä¸º demo çš„æœåŠ¡å‡­è¯ demo.Keyï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª interface ç»“æ„ï¼Œè¿™ä¸ª interface ç»“æ„å®é™…ä¸Šæ˜¯å®ç°äº† demo.Service æ¥å£çš„ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</p><p>è€Œåœ¨æ¥å£çš„å…·ä½“è¾“å‡ºä¸­ï¼Œè¾“å‡ºçš„æ˜¯è¿™ä¸ªæ¥å£å®šä¹‰çš„GetFoo()æ–¹æ³•çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆä¼šä»æœåŠ¡å®¹å™¨ä¸­è·å–åˆ°DemoService çš„GetFoo()æ–¹æ³•çš„è¿”å›å€¼Fooç»“æ„ï¼Œå¸¦æœ‰å­—æ®µName: â€œi am fooâ€è¾“å‡ºåœ¨é¡µé¢ä¸Šã€‚</p><pre><code class=\"language-go\">// å¯¹åº”è·¯ç”± /subject/list/all\nfunc SubjectListController(c *gin.Context) {\n\t// è·å– demo æœåŠ¡å®ä¾‹\n\tdemoService := c.MustMake(demo.Key).(demo.Service)\n\n\t// è°ƒç”¨æœåŠ¡å®ä¾‹çš„æ–¹æ³•\n\tfoo := demoService.GetFoo()\n\n\t// è¾“å‡ºç»“æœ\n\tc.ISetOkStatus().IJson(foo)\n}\n</code></pre><p>æœ€åéªŒè¯ä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬è®¿é—®è¿™ä¸ªè·¯ç”± /subject/list/allï¼Œè·å–åˆ°äº† Foo æ•°æ®ç»“æ„ Json åŒ–å‡ºæ¥çš„ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼ŒéªŒè¯å®Œæ¯•ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/41/f2/41950355f4yy02446f4cd19fed3435f2.png?wh=616x188\" alt=\"å›¾ç‰‡\"></p><p>ç°åœ¨æœåŠ¡å®¹å™¨ã€æœåŠ¡æä¾›è€…çš„æ•´ä¸ªæ¡†æ¶ä¸»ä½“å°±æ­å»ºå®Œæˆäº†ã€‚</p><p>ä»Šå¤©æ‰€æœ‰çš„ä»£ç éƒ½å·²ç»ä¸Šä¼ åˆ°GitHubçš„<a href=\"https://github.com/gohade/coredemo/tree/geekbang/11\">geekbang/11</a>åˆ†æ”¯äº†ã€‚ç›®å½•æˆªå›¾å¦‚ä¸‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/20/05/2032cf8a1f4bf7e8a57ba76a2c709105.png?wh=383x1231\" alt=\"\"><img src=\"https://static001.geekbang.org/resource/image/26/fb/267b73d56814f5d0e2e2c2b941350bfb.png?wh=385x551\" alt=\"\"></p><h2>å°ç»“</h2><p>æˆ‘ä»¬åœ¨ä¸»ä½“æ¡†æ¶ä¸­å®ç°äº†æœåŠ¡å®¹å™¨ã€æœåŠ¡æä¾›è€…çš„é€»è¾‘ï¼Œç°åœ¨ï¼Œhadeæ¡†æ¶å°±åŒ…å«ä¸€ä¸ªæœåŠ¡å®¹å™¨ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šåœ¨æœåŠ¡å®¹å™¨ä¸­æ³¨å†Œã€‚å½“ä¸šåŠ¡éœ€è¦è·å–æŸä¸ªæœåŠ¡å®ä¾‹çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ä»æœåŠ¡å®¹å™¨ä¸­è·å–æœåŠ¡ã€‚</p><p>åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œä½ æ˜¯ä¸æ˜¯èƒ½æ„ŸçŸ¥åˆ°æœåŠ¡å®¹å™¨çš„æ–¹ä¾¿ä¹‹å¤„äº†ã€‚åªéœ€è¦å¾€æœåŠ¡å®¹å™¨ä¸­æ³¨å†ŒæœåŠ¡æä¾›è€…ï¼Œä¹‹åä¸ç®¡ä»»ä½•æ—¶å€™ï¼Œæƒ³è¦è·å–æŸä¸ªæœåŠ¡ï¼Œéƒ½èƒ½å¾ˆæ–¹ä¾¿åœ°ä»æœåŠ¡å®¹å™¨ä¸­ï¼Œè·å–åˆ°ç¬¦åˆæœåŠ¡æ¥å£çš„å®ä¾‹ï¼Œè€Œä¸éœ€è¦è€ƒè™‘åˆ°æœåŠ¡çš„å…·ä½“å®ç°ã€‚<strong>è¿™ç§è®¾è®¡çš„æ‹“å±•æ€§éå¸¸å¥½ï¼Œä¹‹ååœ¨å®é™…ä¸šåŠ¡ä¸­æˆ‘ä»¬åªè¦ä¿è¯æœåŠ¡åè®®ä¸å˜ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå…·ä½“çš„æŸä¸ªæœåŠ¡å®ç°è¿›è¡Œäº†å˜åŒ–</strong>ã€‚</p><p>åç»­å¼€å‘çš„æ‰€æœ‰æœåŠ¡æ¨¡å—ï¼Œæ¯”å¦‚æ—¥å¿—ã€é…ç½®ç­‰æˆ‘ä»¬éƒ½ä¼šä»¥æœåŠ¡çš„å½¢å¼è¿›è¡Œå¼€å‘ï¼Œå…ˆå®šä¹‰å¥½æœåŠ¡çš„æ¥å£ï¼Œåå®šä¹‰æœåŠ¡çš„æœåŠ¡æä¾›è€…ï¼Œæœ€åå†å®šä¹‰æœåŠ¡çš„å…·ä½“å®ä¾‹åŒ–æ–¹æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨å®ç°æœåŠ¡å®¹å™¨æ—¶ï¼Œä¸çŸ¥é“ä½ ä¼šä¸ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šæˆ‘ä»¬å°†æœåŠ¡å®¹å™¨çš„ Make ç³»åˆ—çš„æ–¹æ³•åœ¨ Context ä¸­å®ç°äº†ï¼Œä¸ºä»€ä¹ˆä¸æŠŠ Bind ç³»åˆ—æ–¹æ³•ä¹Ÿåœ¨ Context ä¸­å®ç°å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜ä½ ä¼šæ€ä¹ˆæ€è€ƒå‘¢ï¼ŸContext å…è®¸ Bind æ–¹æ³•æœ‰ä»€ä¹ˆå¥½å¤„å’Œä»€ä¹ˆä¸å¥½çš„åœ°æ–¹å‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œå¦‚æœä½ è§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"10ï½œé¢å‘æ¥å£ç¼–ç¨‹ï¼ˆä¸Šï¼‰ï¼šä¸€åˆ‡çš†æœåŠ¡ï¼ŒæœåŠ¡åŸºäºåè®®","id":424529},"right":{"article_title":"12ï½œç»“æ„ï¼šå¦‚ä½•ç³»ç»Ÿè®¾è®¡æ¡†æ¶çš„æ•´ä½“ç›®å½•ï¼Ÿ","id":425820}},"comments":[{"had_liked":false,"id":315909,"user_name":"èŠ’æœå°‘ä¾ ","can_delete":false,"product_type":"c1","uid":1350159,"ip_address":"","ucode":"98D0BBB52BB80F","user_header":"https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg","comment_is_top":false,"comment_ctime":1634042480,"is_pvip":true,"replies":[{"id":"114843","content":"æ˜¯çš„ï¼Œè¿™é‡Œæœ‰é—®é¢˜ï¼Œå•çº¯ç”¨è¯»é”æ˜¯ä¸è¡Œçš„ï¼Œåº”è¯¥ç”¨ä½ è¿™ç§åŠæ³•ï¼Œè¯»é”åŠ å†™é”çš„é€»è¾‘ï¼Œæ„Ÿè°¢æŒ‡æ­£ï¼Œæˆ‘ä¿®æ”¹ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1634694570,"ip_address":"","comment_id":315909,"utype":1}],"discussion_count":1,"race_medal":0,"score":"40288748144","product_id":100090601,"comment_content":"è€å¸ˆæˆ‘æä¸ªå¹¶å‘åœºæ™¯ä¸‹çš„æ½œåœ¨bugï¼šå¦‚æœserviceProvideræ˜¯å»¶è¿ŸåŠ è½½çš„è¯ï¼Œå¤šä¸ªè¯·æ±‚åŒæ—¶è°ƒç”¨Makeçš„æ—¶å€™ï¼Œè¿™æ—¶å€™æ˜¯è¯»é”ï¼Œæ‰€ä»¥åœ¨åé¢æ–°å»ºå‡ºæ¥å®ä¾‹åï¼Œå›å†™mapçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¹¶å‘å†™çš„æƒ…å†µã€‚https:&#47;&#47;github.com&#47;gohade&#47;coredemo&#47;blob&#47;geekbang&#47;11&#47;framework&#47;container.go#L133<br><br>æˆ‘è¿™è¾¹æœ‰ä¸€ä¸ªè§£å†³æ€è·¯ï¼Œå³é¿å…å¹¶å‘å†™mapçš„å¼‚å¸¸ï¼Œåˆå¯ä»¥ä¿è¯åç»­å¹¶å‘è°ƒç”¨Makeçš„è¯»æ€§èƒ½ã€‚ä¸çŸ¥é“è€å¸ˆè§‰å¾—æ€ä¹ˆæ ·ï¼š<br>func (w *MyContainer) Make(key string) (interface{}, error) {<br>    w.lock.RLock()<br>    &#47;&#47; ç®€å•ä½¿ç”¨è¯»é”ä¼šæœ‰å¹¶å‘å†™mapçš„å¯èƒ½<br>    &#47;&#47; defer w.lock.RUnlock()<br>    if ins := w.instances[key]; ins != nil {<br>        w.lock.RUnlock()<br>        return ins, nil<br>    }<br>    w.lock.RUnlock()<br><br>    w.lock.Lock()<br>    defer w.lock.Unlock()<br>    &#47;&#47; åŒé‡æ£€æŸ¥ï¼Œåœ¨è·å¾—å†™é”ä¹‹åï¼Œå¯èƒ½æœ‰åˆ«çš„åç¨‹å·²ç»åˆ›å»ºå®Œæˆï¼Œå¯ä»¥ç›´æ¥è¿”å›ï¼Œé¿å…å†åˆ›å»º<br>    if ins := w.instances[key]; ins != nil {<br>        return ins, nil<br>    }<br><br>    sp := w.providers[key]<br>    if sp == nil {<br>        return nil, fmt.Errorf(&quot;provider %s not bound&quot;, key)<br>    }<br><br>    params := sp.Params(w)<br>    ins, err := w.newInstance(sp, params)<br>    if err != nil {<br>        return nil, err<br>    }<br>    w.instances[key] = ins<br>    return ins, nil<br>}","like_count":10,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528198,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œæœ‰é—®é¢˜ï¼Œå•çº¯ç”¨è¯»é”æ˜¯ä¸è¡Œçš„ï¼Œåº”è¯¥ç”¨ä½ è¿™ç§åŠæ³•ï¼Œè¯»é”åŠ å†™é”çš„é€»è¾‘ï¼Œæ„Ÿè°¢æŒ‡æ­£ï¼Œæˆ‘ä¿®æ”¹ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634694570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321573,"user_name":"void","can_delete":false,"product_type":"c1","uid":1145429,"ip_address":"","ucode":"502ED161F271B3","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/55/2f4055f6.jpg","comment_is_top":false,"comment_ctime":1636951341,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27406755117","product_id":100090601,"comment_content":"1. HadeContainer ä¸ºä»€ä¹ˆè¦åµŒå¥— Containerï¼Ÿæ³¨é‡Šè¯´â€œå¼ºåˆ¶è¦æ±‚ HadeContainer å®ç° Container æ¥å£â€ï¼Œä½†æ˜¯åµŒå¥—åšä¸åˆ°å¼ºåˆ¶å®ç°å•Šã€‚ä¸‹è¾¹ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œ(ä¸è°ƒç”¨æ¥å£æ–¹æ³•çš„æƒ…å†µä¸‹):<br>type TTT interface {<br>\tGetName() string<br>}<br><br>type MyTT struct {<br>\tTTT<br>\tname string<br>}<br><br>func main() {<br>\tt := MyTT{<br>\t\tTTT:  nil,<br>\t\tname: &quot;name&quot;,<br>\t}<br>\tfmt.Println(t)<br>\t&#47;&#47; t.GetName() &#47;&#47; è°ƒç”¨æ–¹æ³•æ—¶æ‰ä¼španic<br>}<br>å¦‚æœå¸Œæœ›MyTTå¿…é¡»å®ç°TTTçš„è¯ï¼Œä½¿ç”¨ â€œvar _ Container = (*HadeContainer)(nil)â€ å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¿è¯ã€‚<br>2. Bindæ–¹æ³•78è¡Œï¼Œä¸ºä»€ä¹ˆè¦ç”¨errors.Newï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›errï¼Ÿ<br>3. makeæ–¹æ³•åŠ äº†è¯»é”ï¼Œè°ƒç”¨çš„ findServiceProvider åˆåŠ äº†è¯»é”ï¼Œå±äºé‡å¤åŠ é”ã€‚ä½†æ˜¯åè¾¹å†™mapæ²¡æœ‰åŠ å†™é”ã€‚è¿™ä¸ªé—®é¢˜åˆ«çš„åŒå­¦å·²ç»æåˆ°å¹¶ç»™å‡ºäº†æ”¹æ­£ä»£ç ","like_count":7,"discussions":[{"author":{"id":1718011,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/36/fb/b480f2ac.jpg","nickname":"äººé—´ç†æƒ³","note":"","ucode":"0D6A4C402D7CBD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576155,"discussion_content":"é—®é¢˜1 æˆ‘è§‰å¾—å¹¶ä¸æ˜¯å¼ºåˆ¶å®ç°ï¼Œå¯ä»¥ç†è§£æˆæ ‡è¯†å§ï¼Œgoé‡Œé¢åŒ¿åç»“æ„ä½“è¡¨ç¤ºç»§æ‰¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655304428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1718011,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/36/fb/b480f2ac.jpg","nickname":"äººé—´ç†æƒ³","note":"","ucode":"0D6A4C402D7CBD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570991,"discussion_content":"é—®é¢˜3ç¡®å®æ˜¯ï¼Œmakeæ–¹æ³•åŠ äº†é”ï¼ŒfindServiceProvideråˆåŠ äº†ä¸€æ¬¡é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652023368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332825,"user_name":"fursen","can_delete":false,"product_type":"c1","uid":1376959,"ip_address":"","ucode":"2EF4CBAECD7188","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/bf/4e7aec89.jpg","comment_is_top":false,"comment_ctime":1643700491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10233635083","product_id":100090601,"comment_content":"ä»€ä¹ˆæ—¶å€™æ˜¯æœ€å¼€å¿ƒçš„æ—¶å€™ï¼› å°±æ˜¯ä»£ç è·‘èµ·æ¥çš„æ—¶å€™","like_count":2},{"had_liked":false,"id":328047,"user_name":"èŒå¦»çš„è·¯é£","can_delete":false,"product_type":"c1","uid":1347387,"ip_address":"","ucode":"266E4286614CDF","user_header":"https://static001.geekbang.org/account/avatar/00/14/8f/3b/234ce259.jpg","comment_is_top":false,"comment_ctime":1640501626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5935468922","product_id":100090601,"comment_content":"å‘ç°è€å¸ˆå¾ˆå–œæ¬¢ç”¨å­—é¢é‡çš„æ–¹å¼åˆ›å»ºsliceå’Œmapè¿™äº›ï¼Œä¸ºå•¥è€å¸ˆä¸ç”¨makeçš„å½¢å¼åˆ›å»ºå‘¢ï¼Œæˆ‘çœ‹å¾ˆå¤šæºç é‡Œé¢éƒ½ä¹ æƒ¯ç”¨makeçš„å½¢å¼","like_count":1},{"had_liked":false,"id":317953,"user_name":"å®™æ–¯","can_delete":false,"product_type":"c1","uid":2041396,"ip_address":"","ucode":"80DF36BAD298AD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","comment_is_top":false,"comment_ctime":1635070218,"is_pvip":true,"replies":[{"id":"115340","content":"æ˜¯çš„ï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦å¼•å…¥å¹¶å‘é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1635203733,"ip_address":"","comment_id":317953,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930037514","product_id":100090601,"comment_content":"æ€»ç»“ï¼š<br>1 æ ¹æ®å®¹å™¨å®šä¹‰ã€ä¸ºæœåŠ¡æä¾›æ³¨å†Œç»‘å®šã€æä¾›è·å–æœåŠ¡å®ä¾‹ã€ï¼Œå®šä¹‰æ¥å£Bindï¼ŒMakeæ–¹æ³•ï¼Œå¹¶æ‰©å±•IsBindå’ŒMustMakeï¼ŒMakeNewæ¥å£è§„çº¦ã€‚<br>2 å®šä¹‰containerç»“æ„ä½“ï¼Œå¹¶å®ç°ä¸Šé¢çš„5ä¸ªè§„çº¦ï¼Œç‰¹åˆ«æ˜¯Bindå’ŒMakeå®ç°ã€‚<br>3 èå…¥æ¡†æ¶ä¸­ï¼Œå¹¶å¸Œæœ›åœ¨æ¡†æ¶ä¸­é€šè¿‡contextä½¿ç”¨ï¼Œé€šè¿‡åœ¨Engineå’ŒContextä¸­ç»´æŠ¤containerï¼Œå¹¶åœ¨containerä¸­å®šä¹‰Makeè·å–æœåŠ¡çš„æ–¹æ³•ã€‚<br>4 åˆ›å»ºæœåŠ¡è§„çº¦ï¼ˆcontractï¼‰ï¼Œç„¶åå®ç°æœåŠ¡æä¾›è€…ï¼ˆproviderï¼‰å’ŒæœåŠ¡å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼ˆserverï¼‰ã€‚<br>å¹¶ä¸”éœ€è¦å®šä¹‰æœåŠ¡ç»“æ„ä½“ï¼Œä¸”è¯¥æœåŠ¡éœ€è¦æä¾›NewInstanceç±»å‹æ–¹æ³•ï¼Œåœ¨NewInstanceç±»å‹æ–¹æ³•é‡Œæ˜¯æœåŠ¡å’ŒæœåŠ¡æä¾›è€…çœŸæ­£äº§ç”Ÿå…³è”çš„åœ°æ–¹ï¼ˆåˆå§‹åŒ–æ—¶æœåŠ¡åªå’ŒæœåŠ¡æä¾›è€…å…³è”ï¼‰ï¼Œåœ¨mainä¸­æ³¨å†Œæ˜¯æœåŠ¡æä¾›è€…ï¼Œåœ¨controlleré‡Œé€šè¿‡contextè°ƒç”¨Makeå»è·å–æœåŠ¡ã€‚<br><br>é—®é¢˜ï¼šæˆ‘ä»¬å°†æœåŠ¡å®¹å™¨çš„ Make ç³»åˆ—çš„æ–¹æ³•åœ¨ Context ä¸­å®ç°äº†ï¼Œä¸ºä»€ä¹ˆä¸æŠŠ Bind ç³»åˆ—æ–¹æ³•ä¹Ÿåœ¨ Context ä¸­å®ç°å‘¢ï¼Ÿ<br>Context å…è®¸ Bind æ–¹æ³•æœ‰ä»€ä¹ˆå¥½å¤„å’Œä»€ä¹ˆä¸å¥½çš„åœ°æ–¹å‘¢ï¼Ÿ<br>å›ç­”ï¼š<br>ä¸æ”¾Bindåˆ°contextåŸå› ï¼šæ­£å¦‚æ–‡ä¸­æåˆ°Bindæ˜¯æœåŠ¡æä¾›è€…æ³¨å†Œï¼Œå¯¹æœåŠ¡æä¾›è€…æ¥è¯´åªéœ€è¦å…¨å±€æ³¨å†Œä¸€æ¬¡å³å¯ï¼Œè‡³äºé‡Œé¢çš„æœåŠ¡æ˜¯å®ä¾‹åŒ–ä¸€æ¬¡è¿˜æ˜¯å®ä¾‹å¤šæ¬¡å’ŒæœåŠ¡æä¾›è€…æ³¨å†Œä¸€æ¬¡æ²¡å…³ç³»ï¼ŒContextæ˜¯åŸºäºè¯·æ±‚çš„å®ƒæ˜¯è´Ÿè´£è·å–æœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹å¯èƒ½æ˜¯ä½¿ç”¨å•ä¾‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¯æ¬¡è¯·æ±‚è·å¾—ä¸€ä¸ªæ–°å®ä¾‹ï¼Œå› æ­¤Bindé€šå¸¸ä¸ç”±Contxetæ§åˆ¶ï¼Œæ¯æ¬¡Bindéƒ½ä¼šè¦†ç›–ä»¥å‰ç›¸åŒçš„Providerã€‚<br><br>è‹¥Context å…è®¸ Bind æ–¹æ³•å¥½å¤„åå¤„ï¼Ÿ<br>å¥½å¤„ï¼šæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæœ‰ç‹¬ç«‹çš„æœåŠ¡æä¾›è€…ï¼ˆä½†æ²¡ä»€ä¹ˆç”¨ï¼‰ã€‚<br>åå¤„ï¼šæœ‰å¹¶å‘å†™å…¥é—®é¢˜ï¼Œéœ€è¦åŠ é”ï¼Œæ€§èƒ½é™ä½ã€‚<br>","like_count":2,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529040,"discussion_content":"æ˜¯çš„ï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦å¼•å…¥å¹¶å‘é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635203733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315897,"user_name":"èŠ’æœå°‘ä¾ ","can_delete":false,"product_type":"c1","uid":1350159,"ip_address":"","ucode":"98D0BBB52BB80F","user_header":"https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg","comment_is_top":false,"comment_ctime":1634035901,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5929003197","product_id":100090601,"comment_content":"contextæ˜¯è¯·æ±‚å±‚é¢çš„ï¼Œå¦‚æœæ¯ä¸ªä¸šåŠ¡è¯·æ±‚éƒ½èƒ½æ ¹æ®ä¸šåŠ¡å±æ€§è¿›è¡Œbindï¼Œé‚£ä¹ˆå¯¹äºå‡­è¯åç›¸åŒçš„serviceProviderï¼Œå¯èƒ½ä¼šå‡ºç°æ¯æ¬¡å–å‡ºæ¥çš„serviceProviderå®ä¾‹éƒ½ä¸ä¸€æ ·ã€‚<br>å¦ä¸€ä¸ªè§’åº¦è€ƒè™‘ï¼Œåº”è¯¥æ˜¯æ€§èƒ½å’Œå¼€é”€è€ƒè™‘ã€‚","like_count":1},{"had_liked":false,"id":355379,"user_name":"bao","can_delete":false,"product_type":"c1","uid":2836618,"ip_address":"æµ™æ±Ÿ","ucode":"61C756C4021F57","user_header":"https://static001.geekbang.org/account/avatar/00/2b/48/8a/15cce386.jpg","comment_is_top":false,"comment_ctime":1661326109,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1661326109","product_id":100090601,"comment_content":"(hade *HadeContainer) makeå‡½æ•°é‡Œï¼Œå¦‚æœforceNewå¼ºåˆ¶ï¼Œè€Œä¹‹å‰åˆæ˜¯å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œé‚£ç›´æ¥return hade.newInstance(sp, params)ï¼Œç¡®æ²¡æœ‰ä¿å­˜åœ¨hade.instancesé‡Œï¼Œæ˜¯ä¸æ˜¯æœ‰é—æ¼ï¼Ÿ","like_count":0},{"had_liked":false,"id":353355,"user_name":"Geek_6dc1bc","can_delete":false,"product_type":"c1","uid":2931065,"ip_address":"åŒ—äº¬","ucode":"8F87FDF2AE36A1","user_header":"","comment_is_top":false,"comment_ctime":1659400788,"is_pvip":true,"replies":[{"id":"128653","content":"ä¸ä¼šçš„ï¼Œæˆ‘ç†è§£ä½ å‘çš„æ–‡ç« ä¸­è¯´çš„æ˜¯contextçš„å¤ç”¨é—®é¢˜ã€‚aæºç¨‹æ‹¿contextçš„æ—¶å€™ï¼Œcontextè¿˜è¢«bä½¿ç”¨ç€ã€‚è€Œæˆ‘ä»¬è¿™ä¸ªæ¡†æ¶åº•å±‚å®é™…ä¸Šæ˜¯net&#47;httpã€‚contextæ˜¯æ¯ä¸ªè¯·æ±‚å„è‡ªä¸€ä¸ªcontextã€‚é¦–å…ˆè¿™ä¸ªcontextä¸ä¼šæœ‰é—®é¢˜ã€‚<br>å…¶æ¬¡æˆ‘ä»¬å°†å®¹å™¨ç»‘å®šåœ¨contextä¸­ï¼Œåªéœ€è¦æ§åˆ¶ä½å®¹å™¨çš„åŸå­æ€§ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰ä¿®æ”¹ï¼Œå…¶ä»–æ—¶å€™éƒ½åªæœ‰è·å–å…¶ä¸­çš„æœåŠ¡ã€‚å°±ä¸ä¼šå‡ºç°æœç”¨é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1659912260,"ip_address":"åŒ—äº¬","comment_id":353355,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1659400788","product_id":100090601,"comment_content":"å®¹å™¨ç»‘å®šåˆ°ctxä¸­ä¼šä¸ä¼šæœ‰è¿™ä¸ªæ–‡ç« ä¸­è¯´çš„ï¼šhttps:&#47;&#47;cloud.tencent.com&#47;developer&#47;news&#47;462918  ï¼Œå¤ç”¨contextå‡ºç°çš„é—®é¢˜ï¼Ÿæˆ‘çœ‹äº†ä¸‹giné‡Œé¢ä¹Ÿæ˜¯ç”¨çš„context poolçš„æœºåˆ¶æ¥ä¿è¯ä¸€ä¸ªé«˜æ€§èƒ½","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583067,"discussion_content":"ä¸ä¼šçš„ï¼Œæˆ‘ç†è§£ä½ å‘çš„æ–‡ç« ä¸­è¯´çš„æ˜¯contextçš„å¤ç”¨é—®é¢˜ã€‚aæºç¨‹æ‹¿contextçš„æ—¶å€™ï¼Œcontextè¿˜è¢«bä½¿ç”¨ç€ã€‚è€Œæˆ‘ä»¬è¿™ä¸ªæ¡†æ¶åº•å±‚å®é™…ä¸Šæ˜¯net/httpã€‚contextæ˜¯æ¯ä¸ªè¯·æ±‚å„è‡ªä¸€ä¸ªcontextã€‚é¦–å…ˆè¿™ä¸ªcontextä¸ä¼šæœ‰é—®é¢˜ã€‚\nå…¶æ¬¡æˆ‘ä»¬å°†å®¹å™¨ç»‘å®šåœ¨contextä¸­ï¼Œåªéœ€è¦æ§åˆ¶ä½å®¹å™¨çš„åŸå­æ€§ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰ä¿®æ”¹ï¼Œå…¶ä»–æ—¶å€™éƒ½åªæœ‰è·å–å…¶ä¸­çš„æœåŠ¡ã€‚å°±ä¸ä¼šå‡ºç°æœç”¨é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659912260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351324,"user_name":"é™ä¸”æ…¢ä¸”è¿œ","can_delete":false,"product_type":"c1","uid":2767251,"ip_address":"åŒ—äº¬","ucode":"4C07047F052BB4","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/93/bcafe00f.jpg","comment_is_top":false,"comment_ctime":1657700643,"is_pvip":true,"replies":[{"id":"128655","content":"å¾®æœåŠ¡æ›´å¤šæ˜¯ä»æ¶æ„å±‚é¢æ¥è¿›è¡Œåˆ†å‰²çš„ï¼Œå“ªäº›ä¸šåŠ¡åˆ’åˆ†ä¸ºä¸€ä¸ªå°çš„æœåŠ¡ã€‚<br><br>ä»æ¡†æ¶å±‚é¢ï¼Œå¦‚æœå†…éƒ¨å„ä¸ªæœåŠ¡ä¾èµ–çš„æ˜¯httpåè®®ï¼Œè¿™ä¸ªæ¡†æ¶ä¹Ÿç®—æ˜¯å¾®æœåŠ¡ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1659912459,"ip_address":"åŒ—äº¬","comment_id":351324,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1657700643","product_id":100090601,"comment_content":"è¿™ä¸ªç®—æ˜¯å¾®æœåŠ¡æ¶æ„å—","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583069,"discussion_content":"å¾®æœåŠ¡æ›´å¤šæ˜¯ä»æ¶æ„å±‚é¢æ¥è¿›è¡Œåˆ†å‰²çš„ï¼Œå“ªäº›ä¸šåŠ¡åˆ’åˆ†ä¸ºä¸€ä¸ªå°çš„æœåŠ¡ã€‚\n\nä»æ¡†æ¶å±‚é¢ï¼Œå¦‚æœå†…éƒ¨å„ä¸ªæœåŠ¡ä¾èµ–çš„æ˜¯httpåè®®ï¼Œè¿™ä¸ªæ¡†æ¶ä¹Ÿç®—æ˜¯å¾®æœåŠ¡ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659912459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"å¤§æ¯›","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580136,"discussion_content":"æ„Ÿè§‰è¯¾ç¨‹ä¸­çš„æœåŠ¡å®¹å™¨å¾ˆé€‚åˆæ‹¿æ¥å­˜æ”¾å¾®æœåŠ¡çš„å®ä¾‹ã€‚\nè¿‡å»æˆ‘åœ¨çš„é¡¹ç›®ä¸­ï¼ŒæŸä¸ªåœ°æ–¹æƒ³è¦ä½¿ç”¨å¾®æœå°±å¿…é¡»ä½¿ç”¨ç¼–ç çš„æ–¹å¼ç¡¬å†™ï¼Œå¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼å°±å¾ˆä¼˜é›…äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657904117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347964,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1654613076,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1654613076","product_id":100090601,"comment_content":"æœ‰ç‚¹springçš„æ„Ÿè§‰ï¼Œæ§åˆ¶åè½¬ï¼ŒæŠŠåŠŸèƒ½éƒ½äº¤ç»™å®¹å™¨è¿›è¡Œç®¡ç†ï¼ŒçœŸçš„æ¯”å¼•å…¥ä¸€ä¸ªåŒ…ç›´æ¥ä½¿ç”¨å¥½ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"å¤§æ¯›","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580137,"discussion_content":"çœ‹æƒ…å†µå§ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å®¹å™¨çš„éœ€æ±‚ï¼Œé‚£ç›´æ¥å®ç°å°±å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657904472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344972,"user_name":"ğŸŒ¿","can_delete":false,"product_type":"c1","uid":2066322,"ip_address":"","ucode":"5F819BBD11054E","user_header":"https://static001.geekbang.org/account/avatar/00/1f/87/92/9ac4c335.jpg","comment_is_top":false,"comment_ctime":1651907340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651907340","product_id":100090601,"comment_content":"container.goï¼ŒBindæ–¹æ³•é‡Œé¢çš„å®ä¾‹åŒ–é€»è¾‘ï¼Œå¯ä»¥è°ƒç”¨newInstanceæ–¹æ³•ã€‚è¿™æ ·å®ä¾‹åŒ–çš„é€»è¾‘ä¸ä¼šå‡ºç°åœ¨å¤šå¤„ã€‚","like_count":0},{"had_liked":false,"id":328735,"user_name":"www","can_delete":false,"product_type":"c1","uid":1898338,"ip_address":"","ucode":"ADC9BC655EA16C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f7/62/947004d0.jpg","comment_is_top":false,"comment_ctime":1640856616,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640856616","product_id":100090601,"comment_content":"çœ‹äº†å¥½å‡ éï¼Œç»ˆäºæ˜ç™½é¢å‘æ¥å£ç¼–ç¨‹çš„æ„æ€äº†ï¼ŒæœåŠ¡æä¾›è€…æ¥å£è®¾è®¡çš„å¦™å•Š","like_count":0},{"had_liked":false,"id":325281,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638889594,"is_pvip":false,"replies":[{"id":"118664","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1639609301,"ip_address":"","comment_id":325281,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1638889594","product_id":100090601,"comment_content":"åˆšåˆšé‡æ„äº†ä¸€æ‰‹ä»£ç ï¼ŒæŒ‰ç…§è‡ªå·±çš„æ€è·¯å†™äº†ä¸€äº›å¹¶å‘çš„ç²’åº¦æ§åˆ¶<br>https:&#47;&#47;github.com&#47;zzm996-zzm&#47;arms&#47;blob&#47;master&#47;framework&#47;container.go<br>ä¹‹åä¼šåœ¨è¿™ä¸ªä»“åº“è¡¥å…¨å•å…ƒæµ‹è¯•ï¼Œåˆšåˆšå‘ç°æƒ³æµ‹è¯•å¾ˆå¤šæƒ…å†µ ä½†æ˜¯æ‰‹åŠ¨æµ‹è¯•å¤ªè´¹åŠ² ","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539098,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639609301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1249290,"avatar":"https://static001.geekbang.org/account/avatar/00/13/10/0a/0eda8656.jpg","nickname":"oddminng","note":"","ucode":"DE2804C00C2765","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570335,"discussion_content":"æ£’æ£’å“’ï¼Œè§£å†³äº†æˆ‘åœ¨åˆ›å»ºä¾èµ–å…¶ä»–æœåŠ¡çš„å®ä¾‹é”å†²çªçš„é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651736221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325231,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638871018,"is_pvip":false,"replies":[{"id":"118665","content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°æœ‰å¹¶å‘é£é™©","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1639609347,"ip_address":"","comment_id":325231,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638871018","product_id":100090601,"comment_content":"Bindæ–¹æ³•æˆ‘è§‰å¾—æ˜¯å¯¹äºæ•´ä¸ªé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸè€Œè¨€çš„ï¼Œåœ¨æ•´ä¸ªå®¹å™¨ä¸­å­˜ä¸€ä»½ï¼Œæ¯”å¦‚ è¿æ¥æ± å¯¹è±¡ï¼Œå’Œé€‚åˆå•ä¾‹çš„å¯¹è±¡ï¼Œå°†Bindæ”¾åœ¨contextä¸­å°±ç›¸å½“äºé¢å‘çš„æ˜¯è¯·æ±‚çº§åˆ«ï¼Œå®è¯è¯´æ²¡å¤ªå¤§ç”¨ï¼Œè¿˜è®©containeræœ‰äº†å¹¶å‘çš„é£é™© è¿˜å¾—åšå¥½é”å¯¼è‡´æ€§èƒ½ä¹Ÿä¸‹é™","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539099,"discussion_content":"æ˜¯çš„ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°æœ‰å¹¶å‘é£é™©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639609347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317939,"user_name":"å®™æ–¯","can_delete":false,"product_type":"c1","uid":2041396,"ip_address":"","ucode":"80DF36BAD298AD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","comment_is_top":false,"comment_ctime":1635065983,"is_pvip":true,"replies":[{"id":"115342","content":"åœ¨å¾®ä¿¡ç¾¤å·²ç»å›ç­”äº†ï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€å±‚çœ‹ä¸‹ï¼Œæ²¡æœ‰paramså°±æ˜¯ç”¨providerçš„paramsäº†åšå‚æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1635203800,"ip_address":"","comment_id":317939,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1635065983","product_id":100090601,"comment_content":"ä½ å¥½ åœ¨makeæ—¶çš„æ–‡ç¨¿é‡Œï¼Œå®¹å™¨ä¸­è¿˜æœªå®ä¾‹åŒ–ï¼Œç¬¬ä¸€æ¬¡å®ä¾‹åŒ–ï¼Œinst, err := hade.newInstance(sp, nil)<br>è¿™é‡Œæ²¡æœ‰å¸¦å‚æ•°paramsï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰paramså‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529038,"discussion_content":"åœ¨å¾®ä¿¡ç¾¤å·²ç»å›ç­”äº†ï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€å±‚çœ‹ä¸‹ï¼Œæ²¡æœ‰paramså°±æ˜¯ç”¨providerçš„paramsäº†åšå‚æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635203800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1355529,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ4RzUwExiaDvvYrDK9Gic4ibmcp3AUEAKtzb9qeHLQiczVGbJ5tqpo9FUbugeCpDbciaqWCh68EicaS15w/132","nickname":"tea","note":"","ucode":"2DE418D7B91DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412071,"discussion_content":"è€å¸ˆï¼Œå¾®ä¿¡ç¾¤æ˜¯å•¥ï¼Ÿæ±‚æ‹‰è¿›ç¾¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636074292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315769,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1633976630,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1633976630","product_id":100090601,"comment_content":"åœ¨Contexté‡ŒBindå°±èƒ½å…è®¸åœ¨è¿è¡Œæ—¶å¯¹ä¸åŒçš„è¯·æ±‚ä½¿ç”¨ä¸åŒçš„æœåŠ¡ã€‚æ¯”å¦‚åœ¨Bindæ—¶è¯»å–ä¸€ä¸‹é…ç½®ï¼Œçœ‹ä¸‹è¦ç”¨çš„æœåŠ¡æ˜¯é…ç½®æˆpkgAæä¾›çš„è¿˜æ˜¯pkgBæä¾›çš„ã€‚è¿™æ ·å¯èƒ½ä¸Šä¸€ä¸ªè¯·æ±‚ç”¨çš„æ˜¯pkgAçš„æœåŠ¡ï¼Œæ”¹äº†é…ç½®åä¸‹ä¸ªè¯·æ±‚å°±ç”¨ä¸Šäº†pkgBçš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åˆ‡æ¢ä¸åŒçš„æœåŠ¡å®ç°æ—¶ä¸ç”¨é‡å¯appï¼Œç¼ºç‚¹å°±æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½è¦è¯»å–é…ç½®ä¼šæœ‰é¢å¤–çš„æ¶ˆè€—ã€‚éšç€å®¹å™¨ç¼–æ’æŠ€æœ¯çš„æµè¡Œï¼Œæ»šåŠ¨æ›´æ–°å®¹å™¨åŒ–çš„appä¹Ÿå˜å¾—å®¹æ˜“ï¼Œéœ€è¦é…ç½®çƒ­æ›´æ–°çš„åœºåˆä¹Ÿä¼šå‡å°‘å§ã€‚","like_count":0},{"had_liked":false,"id":315634,"user_name":"Panmax","can_delete":false,"product_type":"c1","uid":1004871,"ip_address":"","ucode":"9D65E3B84C5519","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/47/d217c45f.jpg","comment_is_top":false,"comment_ctime":1633931401,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633931401","product_id":100090601,"comment_content":"æ€è€ƒé¢˜ï¼šåœ¨å®ç°æœåŠ¡å®¹å™¨æ—¶ï¼Œä¸çŸ¥é“ä½ ä¼šä¸ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šæˆ‘ä»¬å°†æœåŠ¡å®¹å™¨çš„ Make ç³»åˆ—çš„æ–¹æ³•åœ¨ Context ä¸­å®ç°äº†ï¼Œä¸ºä»€ä¹ˆä¸æŠŠ Bind ç³»åˆ—æ–¹æ³•ä¹Ÿåœ¨ Context ä¸­å®ç°å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜ä½ ä¼šæ€ä¹ˆæ€è€ƒå‘¢ï¼ŸContext å…è®¸ Bind æ–¹æ³•æœ‰ä»€ä¹ˆå¥½å¤„å’Œä»€ä¹ˆä¸å¥½çš„åœ°æ–¹å‘¢ï¼Ÿ<br><br>å› ä¸º Make æ˜¯ç”¨æ¥è·å–æœåŠ¡çš„ï¼Œè·å–æœåŠ¡é€šå¸¸æ˜¯åœ¨å¤„ç†æ¯ä¸ªè¯·æ±‚æ—¶è·å–ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæœ‰æ–°çš„ Contextï¼Œæ­¤æ—¶æ˜¯åœ¨å¤„ç†å…·ä½“ä¸šåŠ¡ï¼Œä¸åº”è¯¥è®©ä¸šåŠ¡å…³å¿ƒ Engineï¼Œæ‰€ä»¥åœ¨ Context ä¸­å®ç° Make æ›´åˆé€‚ã€‚è€Œ Bind æ˜¯åœ¨æœåŠ¡å¯åŠ¨æ—¶ï¼Œæ­¤æ—¶æ²¡æœ‰æ–°çš„ Context äº§ç”Ÿï¼Œæ‰€ä»¥è®© Engine å®ç° Bind æ¥åšç»Ÿä¸€è£…é…æ›´åˆé€‚ã€‚","like_count":0}]}