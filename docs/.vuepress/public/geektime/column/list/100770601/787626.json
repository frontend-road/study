{"id":787626,"title":"16ï½œä»é›¶å¼€å§‹ï¼Œæ„å»ºä¸€ä¸ªå…·æœ‰100Må‚æ•°è§„æ¨¡çš„Transformeræ¨¡å‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹¬è¡Œã€‚</p><p>å‰ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»ç†è®ºå±‚é¢å‘ä½ ä»‹ç»äº†Transformerçš„æ¶æ„åŸç†ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€æœ‰ä»‹ç»åŸºç¡€ç†è®ºçŸ¥è¯†çš„éƒ¨åˆ†åŸºæœ¬ç»“æŸäº†ã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥å®æˆ˜ç¯èŠ‚ï¼Œå¯¹æ¨¡å‹çš„è®¾è®¡ã€æ„å»ºã€é¢„è®­ç»ƒã€å¾®è°ƒã€è¯„ä¼°ç­‰è¿›è¡Œå…¨é¢çš„ä»‹ç»ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¼šè¶Šæ¥è¶Šæœ‰æ„æ€ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹ï¼Œå¦‚ä½•ä»0åˆ°1æ„å»ºåŸºäºTransformerçš„æ¨¡å‹ã€‚</p><h2>é€‰æ‹©æ¨¡å‹æ¶æ„</h2><p>Transformeræ¶æ„è‡ªä»è¢«æå‡ºä»¥æ¥ï¼Œå·²ç»æ¼”åŒ–å‡ºå¤šç§å˜ä½“ï¼Œç”¨æ¥é€‚åº”ä¸åŒçš„ä»»åŠ¡å’Œæ€§èƒ½éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„Transformeræ¶æ„æ–¹å¼ï¼ŒåŒ…æ‹¬åŸå§‹çš„è®¾è®¡ä»¥åŠåç»­çš„ä¸€äº›åˆ›æ–°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/ba/e3b3f87c7cf8298f70f760d8eca979ba.jpg?wh=2082x964\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬ç†ŸçŸ¥çš„GPTç³»åˆ—æ¨¡å‹ï¼Œä½¿ç”¨çš„æ˜¯Decoder-onlyæ¶æ„ï¼ŒGoogleçš„Bertæ¨¡å‹ä½¿ç”¨çš„æ˜¯Encoder-onlyæ¶æ„ã€‚GPTç³»åˆ—æ¨¡å‹ä¹‹æ‰€ä»¥é€‰æ‹©ä½¿ç”¨Decoder-onlyæ¶æ„ï¼Œä¸»è¦å‡ºäºä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼š</p><ol>\n<li>GPTæ˜¯è¯­è¨€æ¨¡å‹ï¼Œæ ¹æ®ç»™å®šçš„æ–‡æœ¬é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ï¼Œè€Œè§£ç å™¨å°±æ˜¯ç”¨æ¥ç”Ÿæˆè¾“å‡ºåºåˆ—çš„ã€‚</li>\n<li>Decoder-onlyæ¨¡å‹é‡‡ç”¨è‡ªå›å½’æ–¹å¼è¿›è¡Œè®­ç»ƒï¼Œåœ¨ç”Ÿæˆæ¯ä¸€ä¸ªæ–°è¯æ—¶ï¼Œéƒ½ä¼šåˆ©ç”¨ä¹‹å‰æ‰€æœ‰å·²ç”Ÿæˆçš„è¯ä½œä¸ºä¸Šä¸‹æ–‡ã€‚è¿™ç§è‡ªå›å½’çš„ç‰¹æ€§ä½¿å¾—GPTèƒ½å¤Ÿåœ¨ç”Ÿæˆæ–‡æœ¬æ—¶ä¿æŒå†…å®¹çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§ã€‚</li>\n<li>ä¸ç¼–ç å™¨-è§£ç å™¨ç»“æ„ç›¸æ¯”ï¼ŒDecoder-onlyæ¶æ„ç®€åŒ–äº†æ¨¡å‹è®¾è®¡ï¼Œä¸“æ³¨äºè§£ç å™¨çš„èƒ½åŠ›ã€‚</li>\n</ol><!-- [[[read_end]]] --><p>å…¶ä»–åŸå› å¦‚å¹¶è¡Œæ€§ã€é•¿è·ç¦»ä¾èµ–ã€è‡ªæ³¨æ„åŠ›å°±ä¸è®²äº†ï¼Œè¿™æ˜¯Transformeræ¶æ„çš„é€šç”¨ç‰¹ç‚¹ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾å°±åŸºäºDecoder-onlyæ¶æ„æ„å»ºä¸€ä¸ªæ¨¡å‹ã€‚</p><h2>æ„å»ºæ¨¡å‹</h2><p>æ¨¡å‹è®¾è®¡æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å…ˆè®¾è®¡æ¨¡å‹å¤§æ¦‚çš„ç»“æ„ï¼Œæ¯”å¦‚å±‚æ•°ã€å¤šå¤´æ³¨æ„åŠ›å¤´æ•°ã€éšè—å±‚å±‚æ•°ç­‰ï¼Œç”šè‡³è¯æ±‡è¡¨å¤§å°éƒ½è¦æœ‰ä¸€ä¸ªé¢„ä¼°ï¼Œæ ¹æ®è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚è®¡ç®—å‡ºæ¨¡å‹çš„å‚æ•°é‡ï¼Œç„¶åæ ¹æ®Scaling Lawï¼Œè®¡ç®—å‡ºå¤§æ¦‚éœ€è¦çš„è¿ç®—é‡ï¼Œè¿›è€Œè¯„ä¼°è®­ç»ƒæˆæœ¬ã€‚</p><p>Scaling Lawsï¼Œç®€å•ç†è§£å°±æ˜¯éšç€æ¨¡å‹å¤§å°ã€æ•°æ®é›†å¤§å°å’Œç”¨äºè®­ç»ƒçš„è®¡ç®—æµ®ç‚¹æ•°çš„å¢åŠ ï¼Œæ¨¡å‹çš„æ€§èƒ½ä¼šæé«˜ã€‚å¹¶ä¸”ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œè¿™ä¸‰ä¸ªå› ç´ å¿…é¡»åŒæ—¶æ”¾å¤§ã€‚å½“ä¸å—å…¶ä»–ä¸¤ä¸ªå› ç´ çš„åˆ¶çº¦æ—¶ï¼Œæ¨¡å‹æ€§èƒ½ä¸æ¯ä¸ªå•ç‹¬çš„å› ç´ éƒ½æœ‰å¹‚å¾‹å…³ç³»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼šæµ®ç‚¹è¿ç®—é‡ï¼ˆFLOPsï¼‰Cã€æ¨¡å‹å‚æ•°Nä»¥åŠè®­ç»ƒçš„tokenæ•°Dä¹‹é—´å­˜åœ¨å…³ç³»ï¼š$C\\approx6ND$ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªå…¬å¼æˆç«‹çš„å‰ææ˜¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹åŸºäºDecoder-onlyæ¶æ„ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å‚æ•°è§„æ¨¡çš„è®¡ç®—æ–¹å¼ï¼šæ€»å‚æ•°é‡=åµŒå…¥å±‚å‚æ•°é‡+ä½ç½®ç¼–ç å‚æ•°é‡+è§£ç å™¨å±‚å‚æ•°é‡+çº¿æ€§è¾“å‡ºå±‚å‚æ•°é‡ã€‚</p><ol>\n<li><strong>åµŒå…¥å±‚å‚æ•°é‡</strong> = vocab_size * embed_size</li>\n</ol><p>vocab_sizeæ˜¯æŒ‡è¯æ±‡è¡¨çš„å¤§å°ï¼Œé¢„è®­ç»ƒæ•°æ®é›†å¤„ç†åä¼šè½¬æ¢æˆè¯æ±‡è¡¨ï¼Œvocab_sizeå°±æ˜¯è¿™ä¸ªè¯æ±‡è¡¨çš„å¤§å°ï¼›embed_sizeæ˜¯æŒ‡è¯åµŒå…¥å‘é‡çš„ç»´åº¦æ•°ï¼Œç®€å•ç†è§£å°±æ˜¯æ¯ä¸ªè¯çš„ç‰¹å¾æ•°ã€‚</p><ol start=\"2\">\n<li><strong>ä½ç½®ç¼–ç å‚æ•°é‡</strong> = embed_size</li>\n<li><strong>è§£ç å™¨å±‚å‚æ•°é‡</strong> =ï¼ˆè‡ªæ³¨æ„åŠ›æœºåˆ¶å‚æ•°é‡ + å‰å‘é¦ˆç½‘ç»œå‚æ•°é‡ï¼‰* å±‚æ•°</li>\n</ol><p>è‡ªæ³¨æ„åŠ›éƒ¨åˆ†é€šå¸¸åŒ…æ‹¬å››ä¸ªæ ¸å¿ƒç»„ä»¶çš„å‚æ•°ã€‚</p><ul>\n<li>æŸ¥è¯¢çŸ©é˜µ (Q)ï¼šembed_size * embed_size</li>\n<li>é”®çŸ©é˜µ (K)ï¼šembed_size * embed_size</li>\n<li>å€¼çŸ©é˜µ (V)ï¼šembed_size * embed_size</li>\n<li>è¾“å‡ºçº¿æ€§å˜æ¢ï¼šembed_size * embed_size</li>\n</ul><p>æ‰€ä»¥è‡ªæ³¨æ„åŠ›æœºåˆ¶å‚æ•°é‡ = 4 * embed_size * embed_sizeï¼Œå‰é¦ˆç½‘ç»œå‚æ•°é‡ = 2 * (embed_size * hidden_dim)ï¼Œhidden_dimæ˜¯æŒ‡éšè—å±‚å±‚æ•°ã€‚</p><ol start=\"4\">\n<li><strong>çº¿æ€§è¾“å‡ºå±‚å‚æ•°é‡</strong> = vocab_size * embed_size</li>\n</ol><p><strong>æ€»å‚æ•°é‡N</strong> = vocab_size * embed_size+embed_size+ï¼ˆ4 * embed_size * embed_size+2 * embed_size * hidden_dimï¼‰* å±‚æ•° + vocab_size * embed_sizeã€‚å…¬å¼å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å…ˆä¸è®¡ç®—æœ€ç»ˆç»“æœï¼Œå› ä¸ºvocab_sizeå–å†³äºè®­ç»ƒæ–‡æœ¬å¤§å°ä»¥åŠåˆ†è¯æ–¹å¼ï¼Œæ‰€ä»¥å‚æ•°é‡å…ˆæ”¾æ”¾ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸ªç®€å•çš„Transformeræ¨¡å‹ï¼Œæ¯è¡Œä»£ç éƒ½æœ‰æ³¨é‡Šï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><pre><code class=\"language-python\">import torch\nfrom torch import nn\n\n# å®šä¹‰ä¸€ä¸ªä»…åŒ…å«è§£ç å™¨çš„Transformeræ¨¡å‹\nclass TransformerDecoderModel(nn.Module):\n&nbsp; &nbsp; def __init__(self, vocab_size, embed_size, num_heads, hidden_dim, num_layers):\n&nbsp; &nbsp; &nbsp; &nbsp; super(TransformerDecoderModel, self).__init__()&nbsp; # è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–å‡½æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; # åˆ›å»ºåµŒå…¥å±‚ï¼Œå°†è¯ç´¢å¼•è½¬æ¢ä¸ºåµŒå…¥å‘é‡\n&nbsp; &nbsp; &nbsp; &nbsp; self.embed = nn.Embedding(vocab_size, embed_size)\n&nbsp; &nbsp; &nbsp; &nbsp; # åˆå§‹åŒ–ä½ç½®ç¼–ç ï¼Œæ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; self.positional_encoding = nn.Parameter(torch.randn(embed_size).unsqueeze(0))\n&nbsp; &nbsp; &nbsp; &nbsp; # å®šä¹‰ä¸€ä¸ªTransformerè§£ç å™¨å±‚\n&nbsp; &nbsp; &nbsp; &nbsp; decoder_layer = nn.TransformerDecoderLayer(d_model=embed_size, nhead=num_heads, dim_feedforward=hidden_dim)\n&nbsp; &nbsp; &nbsp; &nbsp; # å †å å¤šä¸ªè§£ç å™¨å±‚æ„æˆå®Œæ•´çš„è§£ç å™¨\n&nbsp; &nbsp; &nbsp; &nbsp; self.transformer_decoder = nn.TransformerDecoder(decoder_layer, num_layers=num_layers)\n&nbsp; &nbsp; &nbsp; &nbsp; # å®šä¹‰è¾“å‡ºå±‚ï¼Œå°†è§£ç å™¨è¾“å‡ºè½¬æ¢å›è¯æ±‡ç©ºé—´\n&nbsp; &nbsp; &nbsp; &nbsp; self.fc = nn.Linear(embed_size, vocab_size)\n\n&nbsp; &nbsp; def forward(self, src):\n&nbsp; &nbsp; &nbsp; &nbsp; # åµŒå…¥è¾“å…¥å¹¶æ·»åŠ ä½ç½®ç¼–ç \n&nbsp; &nbsp; &nbsp; &nbsp; src = self.embed(src) + self.positional_encoding\n&nbsp; &nbsp; &nbsp; &nbsp; # ç”Ÿæˆæºåºåˆ—çš„æ©ç ï¼Œç”¨äºå±è”½æœªæ¥çš„ä¿¡æ¯\n&nbsp; &nbsp; &nbsp; &nbsp; src_mask = self.generate_square_subsequent_mask(src.size(0))\n&nbsp; &nbsp; &nbsp; &nbsp; # é€šè¿‡è§£ç å™¨ä¼ é€’æºæ•°æ®å’Œæ©ç \n&nbsp; &nbsp; &nbsp; &nbsp; output = self.transformer_decoder(src, src, src_mask)\n&nbsp; &nbsp; &nbsp; &nbsp; # åº”ç”¨çº¿æ€§å±‚è¾“å‡ºæœ€ç»ˆçš„é¢„æµ‹ç»“æœ\n&nbsp; &nbsp; &nbsp; &nbsp; output = self.fc(output)\n&nbsp; &nbsp; &nbsp; &nbsp; return output\n\n&nbsp; &nbsp; def generate_square_subsequent_mask(self, sz):\n&nbsp; &nbsp; &nbsp; &nbsp; # ç”Ÿæˆä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µï¼Œç”¨äºåºåˆ—ç”Ÿæˆä¸­é®è”½æœªæ¥ä½ç½®çš„ä¿¡æ¯\n&nbsp; &nbsp; &nbsp; &nbsp; mask = (torch.triu(torch.ones(sz, sz)) == 1).transpose(0, 1)\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†æ©ç çš„éé›¶ä½ç½®è®¾ä¸ºæ— ç©·å¤§ï¼Œé›¶ä½ç½®è®¾ä¸º0\n&nbsp; &nbsp; &nbsp; &nbsp; mask = mask.float().masked_fill(mask == 0, float('-inf')).masked_fill(mask == 1, float(0.0))\n&nbsp; &nbsp; &nbsp; &nbsp; return mask\n\n</code></pre><p>__init__æ–¹æ³•ç±»ä¼¼äºJavaé‡Œç±»çš„æ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–å±æ€§ã€‚forwardæ–¹æ³•æ˜¯å‰å‘ä¼ æ’­çš„å…·ä½“å®ç°ï¼Œgenerate_square_subsequent_maskæ–¹æ³•ç”¨æ¥ç”Ÿæˆæ©ç çŸ©é˜µã€‚è¿™ä¸ªç±»ä¼šåœ¨è®­ç»ƒçš„æ—¶å€™è¿›è¡Œå®ä¾‹åŒ–ã€‚åœ¨æ­£å¼è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æ€ä¹ˆå‡†å¤‡æ•°æ®ã€‚</p><h2>å‡†å¤‡è®­ç»ƒæ•°æ®</h2><p>æœ¬æ¬¡è®­ç»ƒæˆ‘æ‰¾çš„æ˜¯ä¸€ä¸ªå…¬å¼€çš„<a href=\"https://drive.usercontent.google.com/download?id=1EdHUZIDpgcBoSqbjlfNKJ3b1t0XIUjbt&export=download&authuser=0&confirm=t&uuid=8062444c-9f4a-4d45-85b0-18c9433e2adb&at=APZUnTVIp-S0F7HyCRpkH7ILqqC3%3A1713443417964\">ä¸­æ–‡wikiæ•°æ®é›†</a>ã€‚å› ä¸ºæ˜¯è‡ªå›å½’è®­ç»ƒï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨åƒç¿»è¯‘æ¨¡å‹é‚£ç§è¯­æ–™å¯¹ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨è‡ªç„¶è¯­è¨€æ–‡æœ¬ã€‚å•æ¡æ–‡æœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class=\"language-python\">{\"id\": \"66\", \"url\": \"https://zh.wikipedia.org/wiki?curid=66\", \"title\": \"ä¿¡æ¯å­¦\", \"text\": \"ä¿¡æ¯å­¦\\n\\nä¿¡æ¯å­¦ï¼Œæ—§ç§°æƒ…æŠ¥å­¦ï¼ˆå¤–æ¥è¯­ï¼‰ï¼Œä¸»è¦æ˜¯æŒ‡ä»¥ä¿¡æ¯ä¸ºç ”ç©¶å¯¹è±¡ï¼Œåˆ©ç”¨è®¡ç®—æœºåŠå…¶ç¨‹åºè®¾è®¡ç­‰æŠ€æœ¯ä¸ºç ”ç©¶å·¥å…·æ¥åˆ†æé—®é¢˜ã€è§£å†³é—®é¢˜çš„å­¦é—®ï¼Œæ˜¯ä»¥æ‰©å±•äººç±»çš„ä¿¡æ¯åŠŸèƒ½ä¸ºä¸»è¦ç›®æ ‡çš„ä¸€é—¨ç»¼åˆæ€§å­¦ç§‘ã€‚\\n\\n\\nä½œä¸ºä¸€é—¨æ–°å‹çš„ç»¼åˆæ€§å­¦ç§‘ï¼Œä¿¡æ¯å­¦çš„ç†è®ºä¸»è¦æ˜¯å»ºç«‹åœ¨æ•°å­¦ä¸­çš„ç¦»æ•£æ•°å­¦ä¹‹ä¸Šçš„ã€‚å› ä¸ºä¿¡æ¯å­¦æ‰€ç ”ç©¶çš„å¯¹è±¡ä¿¡æ¯æœ¬èº«å³æ˜¯ç¦»æ•£ä½“ã€‚åœ¨æŸäº›ç‰¹å®šçš„æ¡ä»¶ä¸‹ï¼Œä¿¡æ¯å­¦ä¸è®¡ç®—æœºç§‘å­¦æ˜¯ç­‰ä»·çš„ã€‚\\n\"}\n</code></pre><p>ä¸éœ€è¦IDå’ŒURLè¿™äº›ï¼Œåªä¿ç•™textå­—æ®µï¼Œæ‰€ä»¥å…ˆè¿›è¡Œæ–‡æœ¬é¢„å¤„ç†ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æ–‡ä»¶ç›®å½•ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/ec/e31809bb37504c2afc08c0e76ee971ec.png?wh=578x640\" alt=\"å›¾ç‰‡\"></p><p>å¾ªç¯éå†å­ç›®å½•ï¼Œç„¶ååˆ†åˆ«è¯»å–æ¯ä¸ªæ–‡ä»¶é‡Œçš„æ–‡æœ¬ï¼Œå†ä»jsonæ ¼å¼çš„æ•°æ®é‡ŒæŠ½å–textå­—æ®µå¯¹åº”çš„æ•°æ®ï¼Œä¿å­˜æˆsentence.txtæ–‡ä»¶ã€‚æŠ½å–å®Œæˆçš„sentence.txtæ–‡ä»¶æœ‰1.2GBã€‚ä½ å¯ä»¥å‚è€ƒæˆ‘ç»™å‡ºçš„ä»£ç ã€‚</p><pre><code class=\"language-python\">import json\nimport os\n\nclass PrepareData():\n    @staticmethod\n    def prepare():\n        root_dir = 'data/wiki_zh'\n        ds = []\n        for dir_path, dir_names, file_names in os.walk(root_dir):\n            for file_name in file_names:\n                file_path = os.path.join(dir_path, file_name)\n                if \".\" in file_path:\n                    continue\n                with open(file_path, 'r') as file:\n                    for line in file:\n                        try:\n                            text = json.loads(line)[\"text\"]\n                            print(text)\n                            ds.append(text)\n                        except json.JSONDecodeError:\n                            print(\"æ ¼å¼ä¸æ­£ç¡®\")\n        print(len(ds))\n        with open('data/sentence.txt', 'w') as file:\n            for i in ds:\n                file.write(i + '\\n')\n        return ds\n\ndata_set = PrepareData.prepare()\nfor item in data_set:\n    print(item)\n\n</code></pre><p>æ•°æ®å¤„ç†å¥½ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è®­ç»ƒäº†ã€‚</p><h2>è®­ç»ƒæ¨¡å‹</h2><p>æ¨¡å‹è®­ç»ƒæ˜¯éå¸¸å¤æ‚çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æœ€æ¶ˆè€—èµ„æºçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ•°æ®é›†å¤„ç†ç±»ï¼Œå°†sentence.txté‡Œçš„å†…å®¹é€è¡Œè¯»å…¥ï¼Œä½¿ç”¨jiebaè¿›è¡Œåˆ†è¯ï¼Œè½¬åŒ–æˆè¯æ±‡è¡¨ä¿å­˜åˆ°æœ¬åœ°ã€‚</p><pre><code class=\"language-python\"># å¯¼å…¥å¿…éœ€çš„åº“\nfrom torch.utils.data import Dataset\nimport torch\nimport jieba\nimport json\n\n# å®šä¹‰TextDatasetç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªPyTorchä¸­çš„Dataset\nclass TextDataset(Dataset):\n&nbsp; &nbsp; # åˆå§‹åŒ–å‡½æ•°ï¼Œfilepathä¸ºè¾“å…¥æ–‡ä»¶è·¯å¾„\n&nbsp; &nbsp; def __init__(self, filepath):\n&nbsp; &nbsp; &nbsp; &nbsp; words = []&nbsp; # åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨æ¥å­˜å‚¨æ‰€æœ‰å•è¯\n\n&nbsp; &nbsp; &nbsp; &nbsp; # æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–æ¯ä¸€è¡Œ\n&nbsp; &nbsp; &nbsp; &nbsp; with open(filepath, 'r') as file:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for line in file:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # ä½¿ç”¨jiebaåº“è¿›è¡Œåˆ†è¯ï¼Œå¹¶å»é™¤æ¯è¡Œçš„é¦–å°¾ç©ºç™½å­—ç¬¦\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; words.extend(list(jieba.cut(line.strip())))\n\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†æ‰€æœ‰å•è¯è½¬æ¢ä¸ºä¸€ä¸ªé›†åˆæ¥å»é™¤é‡å¤ï¼Œç„¶åå†è½¬å›åˆ—è¡¨å½¢å¼ï¼Œå½¢æˆè¯æ±‡è¡¨\n&nbsp; &nbsp; &nbsp; &nbsp; self.vocab = list(set(words))\n&nbsp; &nbsp; &nbsp; &nbsp; self.vocab_size = len(self.vocab)&nbsp; # è®¡ç®—è¯æ±‡è¡¨çš„å¤§å°\n\n&nbsp; &nbsp; &nbsp; &nbsp; # åˆ›å»ºä»å•è¯åˆ°æ•´æ•°çš„æ˜ å°„å’Œä»æ•´æ•°åˆ°å•è¯çš„æ˜ å°„\n&nbsp; &nbsp; &nbsp; &nbsp; self.word_to_int = {word: i for i, word in enumerate(self.vocab)}\n&nbsp; &nbsp; &nbsp; &nbsp; self.int_to_word = {i: word for i, word in enumerate(self.vocab)}\n\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†æ˜ å°„å…³ç³»ä¿å­˜ä¸ºJSONæ–‡ä»¶\n&nbsp; &nbsp; &nbsp; &nbsp; with open('data/word_to_int.json', 'w') as f:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; json.dump(self.word_to_int, f, ensure_ascii=False, indent=4)\n&nbsp; &nbsp; &nbsp; &nbsp; with open('data/int_to_word.json', 'w') as f:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; json.dump(self.int_to_word, f, ensure_ascii=False, indent=4)\n\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†æ‰€æœ‰å•è¯è½¬æ¢ä¸ºå¯¹åº”çš„æ•´æ•°ç´¢å¼•ï¼Œå½¢æˆæ•°æ®åˆ—è¡¨\n&nbsp; &nbsp; &nbsp; &nbsp; self.data = [self.word_to_int[word] for word in words]\n\n&nbsp; &nbsp; # è¿”å›æ•°æ®é›†çš„é•¿åº¦å‡1ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºåœ¨æœºå™¨å­¦ä¹ ä¸­å¯èƒ½éœ€è¦ä½¿ç”¨å½“å‰æ•°æ®ç‚¹é¢„æµ‹ä¸‹ä¸€ä¸ªæ•°æ®ç‚¹\n&nbsp; &nbsp; def __len__(self):\n&nbsp; &nbsp; &nbsp; &nbsp; return len(self.data) - 1\n\n&nbsp; &nbsp; # æ ¹æ®ç´¢å¼•idxè¿”å›æ•°æ®ï¼Œè¿™é‡Œç”¨äºè¿”å›æ¨¡å‹è®­ç»ƒæ—¶çš„è¾“å…¥åºåˆ—å’Œç›®æ ‡è¾“å‡º\n&nbsp; &nbsp; def __getitem__(self, idx):\n&nbsp; &nbsp; &nbsp; &nbsp; # ä»æ•°æ®ä¸­æå–æœ€å¤š50ä¸ªæ•´æ•°ç´¢å¼•ä½œä¸ºè¾“å…¥åºåˆ—\n&nbsp; &nbsp; &nbsp; &nbsp; input_seq = torch.tensor(self.data[max(0, idx - 50):idx], dtype=torch.long)\n&nbsp; &nbsp; &nbsp; &nbsp; # æå–ç›®æ ‡è¾“å‡ºï¼Œå³ç´¢å¼•ä½ç½®çš„å•è¯\n&nbsp; &nbsp; &nbsp; &nbsp; target = torch.tensor(self.data[idx], dtype=torch.long)\n&nbsp; &nbsp; &nbsp; &nbsp; return input_seq, target&nbsp; # è¿”å›ä¸€ä¸ªå…ƒç»„åŒ…å«è¾“å…¥åºåˆ—å’Œç›®æ ‡è¾“å‡º\n\n</code></pre><p>é€šè¿‡ä¸‹é¢çš„ä»£ç åŠ è½½æ•°æ®é›†ï¼Œå¹¶å¤„ç†æˆDataLoaderï¼ŒDataLoaderå¯ä»¥ç†è§£æˆæ•°æ®è¿­ä»£å™¨ï¼Œå¯ä»¥ä¾¿åˆ©åœ°è¿›è¡Œæ•°æ®åŠ è½½ã€æ‰¹æ¬¡åˆ’åˆ†å’Œæ•°æ®æ‰“ä¹±ç­‰æ“ä½œã€‚</p><pre><code class=\"language-python\"># åŠ è½½æ•°æ®é›†\ndataset = TextDataset('data/sentence.txt')\ndataloader = DataLoader(dataset, batch_size=batch_size, shuffle=True, collate_fn=collate_fn, drop_last=True)\n\n</code></pre><p>åˆå§‹åŒ–æ¨¡å‹ï¼š</p><pre><code class=\"language-python\"># åˆå§‹åŒ–TransformerDecoderModelï¼Œè®¾ç½®ç‰¹å®šçš„å‚æ•°ï¼š\n# vocab_size - æ•°æ®é›†ä¸­çš„è¯æ±‡è¡¨å¤§å°\n# embed_size - åµŒå…¥å±‚çš„ç»´åº¦ï¼ˆè¿™é‡Œæ˜¯512ï¼‰\n# num_heads - å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„æ³¨æ„åŠ›å¤´æ•°ï¼ˆè¿™é‡Œæ˜¯8ï¼‰\n# hidden_dim - å˜æ¢å™¨ä¸­å‰é¦ˆç½‘ç»œæ¨¡å‹çš„ç»´åº¦ï¼ˆè¿™é‡Œæ˜¯2048ï¼‰\n# num_layers - æ¨¡å‹ä¸­çš„å±‚æ•°ï¼ˆè¿™é‡Œæ˜¯6ï¼‰\nmodel = TransformerDecoderModel(vocab_size=dataset.vocab_size, embed_size=512, num_heads=8, hidden_dim=2048, num_layers=6)\n\n# å°†æ¨¡å‹ä¼ é€åˆ°å®šä¹‰çš„è®¾å¤‡ä¸Šï¼ˆä¾‹å¦‚GPUæˆ–CPUï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œè®­ç»ƒ\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\nmodel.to(device)\n\n# åˆå§‹åŒ–ä¼˜åŒ–å™¨ï¼Œè¿™é‡Œä½¿ç”¨Adamä¼˜åŒ–å™¨ï¼Œå¹¶è®¾ç½®å­¦ä¹ ç‡\n# model.parameters() - ä»æ¨¡å‹ä¸­è·å–å‚æ•°\n# lr - å­¦ä¹ ç‡ï¼ˆè¿™é‡Œç”¨å˜é‡learning_rateè¡¨ç¤ºï¼‰\noptimizer = optim.Adam(model.parameters(), lr=learning_rate)\n\n# åˆå§‹åŒ–æŸå¤±å‡½æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº¤å‰ç†µæŸå¤±ï¼Œé€‚ç”¨äºåˆ†ç±»é—®é¢˜\ncriterion = nn.CrossEntropyLoss()\n\n</code></pre><p>å‰é¢è®²çš„è®¡ç®—å‚æ•°è§„æ¨¡çš„å‡ ä¸ªå˜é‡ï¼ŒåŸºæœ¬éƒ½åœ¨è¿™é‡Œäº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å‚æ•°é‡è®¡ç®—å…¬å¼ï¼š<strong>æ€»å‚æ•°é‡N</strong> = vocab_size * embed_size + embed_size +ï¼ˆ4 * embed_size * embed_size + 2 * embed_size * hidden_dimï¼‰* å±‚æ•° + vocab_size * embed_size</p><p>ä»£å…¥å˜é‡ï¼šN = vocab_size * 512 + 512 +ï¼ˆ4 * 512 * 512+2 * 512 * 2048ï¼‰* 6 + vocab_size * 512ï¼Œå‡è®¾vocab_size = 100000ï¼ˆ100000å…¶å®éå¸¸å°ï¼Œå‡ ä¸ªMBçš„è®­ç»ƒæ•°æ®ï¼Œè¯æ±‡é‡åŸºæœ¬å°±èƒ½è¾¾åˆ°100000äº†ï¼‰ï¼Œé‚£ä¹ˆå‚æ•°é‡N = 100000 * 512 + 512 +ï¼ˆ4 * 512 * 512 + 2 * 512 * 2048ï¼‰* 6+100000 * 512 = 121,274,880ï¼Œè¿™å·²ç»æ˜¯1.2äº¿è§„æ¨¡çš„å‚æ•°äº†ã€‚GPT-3çš„è®­ç»ƒæ•°æ®å¤§çº¦570GBï¼ŒTransformerå±‚æ•°ä¸º96ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œ1750äº¿å‚æ•°æ˜¯æ€ä¹ˆæ¥çš„ã€‚æŒ‰ç…§æˆ‘ä»¬è¿™ä¸ªè®¡ç®—æ–¹å¼ï¼Œä¸æ­¢1750äº¿äº†ï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹embed_sizeæ²¡æœ‰512ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªå•è¯ä¸ä¸€å®šéœ€è¦é‚£ä¹ˆå¤šç»´åº¦å»æè¿°ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®­ç»ƒã€‚</p><pre><code class=\"language-python\"># å°†æ¨¡å‹è®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼\nmodel.train()\n\n# å¾ªç¯éå†æ‰€æœ‰çš„è®­ç»ƒå‘¨æœŸ\nfor epoch in range(num_epochs):\n&nbsp; &nbsp; # å¾ªç¯éå†æ•°æ®åŠ è½½å™¨ä¸­çš„æ¯ä¸ªæ‰¹æ¬¡\n&nbsp; &nbsp; for i, (inputs, targets) in enumerate(dataloader):\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†è¾“å…¥æ•°æ®è½¬ç½®ï¼Œä»¥ç¬¦åˆæ¨¡å‹çš„æœŸæœ›è¾“å…¥ç»´åº¦\n&nbsp; &nbsp; &nbsp; &nbsp; inputs = inputs.t()&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; # åœ¨æ¯æ¬¡è¿­ä»£å‰æ¸…ç©ºæ¢¯åº¦\n&nbsp; &nbsp; &nbsp; &nbsp; optimizer.zero_grad()\n&nbsp; &nbsp; &nbsp; &nbsp; # å‰å‘ä¼ æ’­ï¼šè®¡ç®—æ¨¡å‹å¯¹å½“å‰æ‰¹æ¬¡çš„è¾“å‡º\n&nbsp; &nbsp; &nbsp; &nbsp; outputs = model(inputs)\n&nbsp; &nbsp; &nbsp; &nbsp; # é€‰æ‹©è¾“å‡ºçš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡ŒæŸå¤±è®¡ç®—\n&nbsp; &nbsp; &nbsp; &nbsp; outputs = outputs[-1]&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; # è®¡ç®—æŸå¤±å€¼\n&nbsp; &nbsp; &nbsp; &nbsp; loss = criterion(outputs, targets)\n&nbsp; &nbsp; &nbsp; &nbsp; # åå‘ä¼ æ’­ï¼šè®¡ç®—æŸå¤±çš„æ¢¯åº¦\n&nbsp; &nbsp; &nbsp; &nbsp; loss.backward()\n&nbsp; &nbsp; &nbsp; &nbsp; # æ›´æ–°æ¨¡å‹çš„å‚æ•°\n&nbsp; &nbsp; &nbsp; &nbsp; optimizer.step()\n&nbsp; &nbsp; &nbsp; &nbsp; # æ¯éš”50æ­¥æ‰“å°ä¸€æ¬¡å½“å‰çš„è®­ç»ƒçŠ¶æ€\n&nbsp; &nbsp; &nbsp; &nbsp; if i % 50 == 0:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(f'Epoch [{epoch + 1}/{num_epochs}], Step [{i + 1}/{len(dataloader)}], Loss: {loss.item()}')\n\n# ä¿å­˜æ¨¡å‹åˆ°æŒ‡å®šè·¯å¾„\ntorch.save(model, model_path)\nprint('æ¨¡å‹å·²ä¿å­˜åˆ°', model_path)\n\n</code></pre><p>è®­ç»ƒè¿‡ç¨‹å¤ªè¿‡äºæ¶ˆè€—èµ„æºï¼Œæˆ‘çš„æœ¬åœ°ç”¨çš„æ˜¯A10-24Gæ˜¾å¡ï¼ŒæŒ‰ç…§ä¸Šé¢è¿™ä¸ªå‚æ•°è®¾ç½®ï¼Œå‡†å¤‡äº†500Mçš„è®­ç»ƒæ–‡æœ¬ï¼Œé¢„ä¼°å¤§æ¦‚éœ€è¦1ä¸ªæœˆæ—¶é—´æ‰èƒ½è·‘å®Œï¼Œæ‰€ä»¥ä¸ºäº†å¿«é€Ÿå‡ºæ¨¡å‹ï¼Œæˆ‘åªæˆªå–äº†å…¶ä¸­ä¸€éƒ¨åˆ†è®­ç»ƒæ•°æ®ï¼Œå¤§æ¦‚10Mï¼Œç”¨äº†åŠå¤©æ—¶é—´è¿›è¡Œè®­ç»ƒã€‚</p><h2>æ¨¡å‹æµ‹è¯•</h2><p>æ¥ä¸‹æ¥åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œç„¶åå¯¹è¾“å…¥è¯­å¥è¿›è¡Œåˆ†è¯ç­‰ç­‰ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-python\"># å¯¼å…¥æ‰€éœ€åº“\nimport torch\nimport json\nimport jieba\n\ndef load_model(model_path):\n&nbsp; &nbsp; # åŠ è½½æ¨¡å‹åˆ°CPU\n&nbsp; &nbsp; model = torch.load(model_path, map_location=torch.device('cpu'))\n&nbsp; &nbsp; # è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼\n&nbsp; &nbsp; model.eval()\n&nbsp; &nbsp; return model\n\ndef load_vocab(json_file):\n&nbsp; &nbsp; \"\"\"ä»JSONæ–‡ä»¶ä¸­åŠ è½½è¯æ±‡è¡¨ã€‚\"\"\"\n&nbsp; &nbsp; # è¯»å–è¯æ±‡è¡¨æ–‡ä»¶\n&nbsp; &nbsp; with open(json_file, 'r') as f:\n&nbsp; &nbsp; &nbsp; &nbsp; vocab = json.load(f)\n&nbsp; &nbsp; return vocab\n\ndef predict(model, initial_seq, max_len=50):\n&nbsp; &nbsp; # åŠ è½½æ•°å­—åˆ°å•è¯çš„æ˜ å°„\n&nbsp; &nbsp; int_to_word = load_vocab('int_to_word.json')\n&nbsp; &nbsp; # ç¡®ä¿æ¨¡å‹å¤„äºè¯„ä¼°æ¨¡å¼\n&nbsp; &nbsp; model.eval()\n&nbsp; &nbsp; # å…³é—­æ¢¯åº¦è®¡ç®—\n&nbsp; &nbsp; with torch.no_grad():\n&nbsp; &nbsp; &nbsp; &nbsp; generated = initial_seq\n&nbsp; &nbsp; &nbsp; &nbsp; # ç”Ÿæˆæœ€å¤šmax_lenä¸ªè¯\n&nbsp; &nbsp; &nbsp; &nbsp; for _ in range(max_len):\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input_tensor = torch.tensor([generated], dtype=torch.long)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; output = model(input_tensor)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; predicted_idx = torch.argmax(output[:, -1], dim=-1).item()\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; generated.append(predicted_idx)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # å¦‚æœç”Ÿæˆç»“æŸæ ‡è®°ï¼Œåˆ™åœæ­¢ç”Ÿæˆ\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if predicted_idx == len(int_to_word) - 1:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break\n&nbsp; &nbsp; &nbsp; &nbsp; # å°†ç”Ÿæˆçš„ç´¢å¼•è½¬æ¢ä¸ºå•è¯\n&nbsp; &nbsp; &nbsp; &nbsp; return [int_to_word[str(idx)] for idx in generated]\n\ndef generate(model, input_sentence, max_len=50):\n&nbsp; &nbsp; # ä½¿ç”¨ç»“å·´åˆ†è¯å¯¹è¾“å…¥å¥å­è¿›è¡Œåˆ†è¯\n&nbsp; &nbsp; input_words = list(jieba.cut(input_sentence.strip()))\n&nbsp; &nbsp; # åŠ è½½å•è¯åˆ°æ•°å­—çš„æ˜ å°„\n&nbsp; &nbsp; word_to_int = load_vocab('word_to_int.json')\n&nbsp; &nbsp; # å°†å•è¯è½¬æ¢ä¸ºç´¢å¼•\n&nbsp; &nbsp; input_seq = [word_to_int.get(word, len(word_to_int) - 1) for word in input_words]\n&nbsp; &nbsp; # ç”Ÿæˆæ–‡æœ¬\n&nbsp; &nbsp; generated_text = predict(model, input_seq, max_len)\n&nbsp; &nbsp; # å°†ç”Ÿæˆçš„å•è¯åˆ—è¡¨åˆå¹¶ä¸ºå­—ç¬¦ä¸²\n&nbsp; &nbsp; return \"\".join(generated_text)\n\ndef main():\n&nbsp; &nbsp; # å®šä¹‰è¾“å…¥æç¤º\n&nbsp; &nbsp; prompt = \"hello\"\n&nbsp; &nbsp; # åŠ è½½æ¨¡å‹\n&nbsp; &nbsp; model = load_model('transformer_model.pth')\n&nbsp; &nbsp; # ç”Ÿæˆæ–‡æœ¬\n&nbsp; &nbsp; completion = generate(model, prompt)\n&nbsp; &nbsp; # æ‰“å°ç”Ÿæˆçš„æ–‡æœ¬\n&nbsp; &nbsp; print(\"ç”Ÿæˆæ–‡æœ¬ï¼š\", completion)\n\nif __name__ == '__main__':\n&nbsp; &nbsp; # ä¸»å‡½æ•°å…¥å£\n&nbsp; &nbsp; main()\n\n</code></pre><p>å¾—åˆ°ç»“æœï¼š</p><pre><code class=\"language-python\">ç”Ÿæˆæ–‡æœ¬ï¼š çç æ¸¯\n</code></pre><p>ç®€ç›´ä¸å¿ç›´è§†ï¼Œå› ä¸ºè®­ç»ƒæœ‰é™ï¼Œæ‰€ä»¥å¾—åˆ°è¿™ä¸ªç»“æœåœ¨æ„æ–™ä¹‹ä¸­ï¼Œä¸è¿‡åŸºæœ¬æµç¨‹éƒ½è·‘é€šäº†ã€‚æƒ³è¦æ¨¡å‹æ€§èƒ½å¥½ï¼Œæ˜¯è¦ä¸€æ­¥ä¸€æ­¥è°ƒçš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¯´å‰æè¦æœ‰å¤§é‡çš„è®¡ç®—èµ„æºçš„åŸå› ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘å¸¦ä½ æ‰‹æ•²Transformeræ¨¡å‹ï¼Œæ€»å…±åŠ èµ·æ¥ä¸åˆ°300è¡Œä»£ç ï¼Œå®é™…ä¸Šå¦‚æœä½ é˜…è¯»è¿‡GPT-2å’ŒBERTçš„æ¨¡å‹æ„å»ºä»£ç ï¼Œä½ ä¼šå‘ç°å®ƒä»¬ä¹Ÿæ²¡æœ‰å¤šå°‘è¡Œï¼Œæ‰€ä»¥æ¨¡å‹æ„å»ºæœ¬èº«å…¶å®å¹¶ä¸å¤æ‚ï¼Œæ¨¡å‹çš„æ„å»ºè¿‡ç¨‹å°±æ˜¯æ•´ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œçš„æ¶æ„è¿‡ç¨‹ï¼Œè™½ç„¶æœ‰ä¸€ç‚¹éš¾åº¦ï¼Œä½†æ˜¯æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆéš¾ï¼Œè€Œæˆ‘è®¤ä¸ºéš¾ç‚¹åœ¨äºé¢„è®­ç»ƒè¿‡ç¨‹ï¼Œæ—¢åƒè®­ç»ƒèµ„æºåˆéœ€è¦è€ƒè™‘è®­ç»ƒæ•ˆæœï¼Œå¦‚ä½•è°ƒæ•´å‚æ•°è®©è®­ç»ƒæ•ˆæœæ›´å¥½æ˜¯éš¾ç‚¹ï¼Œè¿™å’Œä¼ ç»ŸCVå°æ¨¡å‹æœ‰ç‚¹ç±»ä¼¼ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªè¯´æ˜ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5a/be/5a92e0bc261890b86d8d09c62e16b8be.png?wh=2010x724\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ˜¯ <a href=\"https://arxiv.org/abs/2005.14165\">GPT-3 è®ºæ–‡</a>é‡Œç»™å‡ºçš„ä¸åŒå‚æ•°è§„æ¨¡ä¸‹çš„è®¾ç½®ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„èµ„æºæƒ…å†µï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„è®­ç»ƒæ•°æ®é›†ä»¥åŠè®¾ç½®åˆé€‚çš„å‚æ•°ï¼Œæ¯”å¦‚embed_sizeï¼Œå¯ä»¥è°ƒå°ä¸€ç‚¹ï¼Œéšè—å±‚æ·±åº¦hidden_dimä¹Ÿå¯ä»¥é€‚å½“è°ƒå°ä¸€ç‚¹ï¼Œè®­ç»ƒä¸€ä¸ªæ¨¡å‹å®é™…è·‘ä¸€éï¼Œçœ‹çœ‹æ•ˆæœã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¿™èŠ‚è¯¾å¼€å¤´ï¼Œæˆ‘ä»¬æåˆ°è¿‡Scaling Lawä¸­çš„ä¸€ä¸ªè®¡ç®—å…¬å¼ $C\\approx 6ND$ï¼Œä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å‚æ•°é‡ï¼ˆ1.2äº¿ï¼‰å’Œè®­ç»ƒæ•°æ®é›†å¤§å°ï¼ˆ1.2GBï¼‰ï¼Œç®—ä¸€ä¸‹è®­ç»ƒè¿‡ç¨‹éœ€è¦å¤šå°‘ç®—åŠ›èµ„æºï¼Œå¦‚æœæ¢ç®—æˆA100-80Gæ˜¾å¡ï¼Œéœ€è¦å¤šå°‘å¼ ï¼Ÿæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„è®¡ç®—ç»“æœï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"15ï½œTransformeræŠ€æœ¯åŸç†ï¼šä¸ºä»€ä¹ˆè¯´Transformeræ˜¯å¤§æ¨¡å‹æ¶æ„çš„åŸºçŸ³ï¼Ÿï¼ˆä¸‹ï¼‰","id":787621},"right":{"article_title":"17ï½œæ¨¡å‹è§£å‰–ï¼šæ¢ç©¶æ¨¡å‹å†…éƒ¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ","id":790282}},"comments":[{"had_liked":false,"id":392144,"user_name":"newCheng","can_delete":false,"product_type":"c1","uid":2438860,"ip_address":"åŒ—äº¬","ucode":"E6E2819AFC6B29","user_header":"https://static001.geekbang.org/account/avatar/00/25/36/cc/f3bc7bbf.jpg","comment_is_top":false,"comment_ctime":1720077159,"is_pvip":false,"replies":[{"id":142554,"content":"è‡ªå·±é…ç½®çš„è¯ï¼Œå¯ä»¥è€ƒè™‘3090æ˜¾å¡ï¼Œ24Gæ˜¾å­˜ï¼Œäº¬ä¸œä¸ŠäºŒæ‰‹çš„7000~8000å·¦å³ï¼Œé…ä¸€ä¸ªå¥½ä¸€ç‚¹çš„ç”µæºå°±å¥½ã€‚äº‘å¹³å°çš„è¯æ¨èautodlï¼Œ3090-24Gï¼Œä¸€ä¸ªæœˆ800å¤šä¸€ç‚¹ï¼Œä¹Ÿæ¯”è¾ƒåˆ’ç®—","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1720144022,"ip_address":"æµ™æ±Ÿ","comment_id":392144,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è€å¸ˆï¼Œå¸®å¿™æ¨èä¸€å°æ·±åº¦å­¦ä¹ çš„ç”µè„‘é…ç½®å‘—ï¼Œæˆ–è€…æœ‰æ²¡æœ‰åˆé€‚çš„äº‘å¹³å°ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647525,"discussion_content":"è‡ªå·±é…ç½®çš„è¯ï¼Œå¯ä»¥è€ƒè™‘3090æ˜¾å¡ï¼Œ24Gæ˜¾å­˜ï¼Œäº¬ä¸œä¸ŠäºŒæ‰‹çš„7000~8000å·¦å³ï¼Œé…ä¸€ä¸ªå¥½ä¸€ç‚¹çš„ç”µæºå°±å¥½ã€‚äº‘å¹³å°çš„è¯æ¨èautodlï¼Œ3090-24Gï¼Œä¸€ä¸ªæœˆ800å¤šä¸€ç‚¹ï¼Œä¹Ÿæ¯”è¾ƒåˆ’ç®—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720144022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393989,"user_name":"çŸ³äº‘å‡","can_delete":false,"product_type":"c1","uid":1024195,"ip_address":"å¹¿ä¸œ","ucode":"78F1DD33EFD000","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a0/c3/c5db35df.jpg","comment_is_top":false,"comment_ctime":1725502106,"is_pvip":false,"replies":[{"id":143028,"content":"èµï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1725529800,"ip_address":"æµ™æ±Ÿ","comment_id":393989,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100770601,"comment_content":"C â‰ˆ 8.64 * 10^17 FLOPs\nA100-80Gçš„ç†è®ºå³°å€¼æ€§èƒ½æ˜¯312 TFLOPSï¼Œå³æ¯ç§’å¯ä»¥è¿›è¡Œï¼š\n312 * 10^12 = 3.12 * 10^14 FLOPs&#47;s\nç†è®ºä¸Šæœ€å¿«å®Œæˆæ—¶é—´ï¼š\næ—¶é—´ = æ€»FLOPs &#47; æ¯ç§’FLOPs\n= (8.64 * 10^17) &#47; (3.12 * 10^14)\nâ‰ˆ 2,769 ç§’\nâ‰ˆ 46 åˆ†é’Ÿ\n\næ‰€ä»¥ï¼Œç†è®ºä¸Šä½¿ç”¨ä¸€å¼ A100-80Gæ˜¾å¡ï¼Œæœ€å¿«çº¦46åˆ†é’Ÿå°±èƒ½å®Œæˆè®­ç»ƒã€‚","like_count":3,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650737,"discussion_content":"èµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1725529801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392103,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1719974687,"is_pvip":false,"replies":[{"id":142549,"content":"æ²¡é”™ï¼ŒåŠ æ²¹ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1720074427,"ip_address":"æµ™æ±Ÿ","comment_id":392103,"utype":1}],"discussion_count":1,"race_medal":2,"score":2,"product_id":100770601,"comment_content":"ç¬¬16è®²æ‰“å¡~\nè¿™é‡Œç®€å•è¡¥å……ä¸€ä¸‹GPTå’ŒBertè¿™ä¸¤ç§æ¨¡å‹çš„å·®å¼‚ï¼šGPTæ˜¯Decoder-onlyæ¶æ„ï¼Œå¹¶ä¸”é‡‡ç”¨å•å‘æ³¨æ„åŠ›æœºåˆ¶ï¼Œè¿™æ„å‘³ç€åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶ï¼Œå®ƒåªè€ƒè™‘å‰é¢çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›è€ŒBertæ˜¯Encoder-onlyæ¶æ„ï¼Œå¹¶ä¸”é‡‡ç”¨åŒå‘æ³¨æ„åŠ›æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åŒæ—¶è€ƒè™‘ä¸Šæ–‡å’Œä¸‹æ–‡çš„ä¿¡æ¯ã€‚è¿™ä¸¤ç§ç»“æ„çš„å·®åˆ«ï¼Œä¹Ÿå°±å†³å®šäº†GPTå’ŒBertæœ‰å„è‡ªæ“…é•¿çš„åº”ç”¨åœºæ™¯ï¼šGPTæ›´æ“…é•¿æ–‡æœ¬ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯â€œç»­å†™â€ï¼Œå³æ ¹æ®ä¸Šæ–‡ç”Ÿæˆä¸‹æ–‡ï¼›è€ŒBertå¯ä»¥è¢«åº”ç”¨äºæ›´å¹¿æ³›çš„NLPä»»åŠ¡ä¸­ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æã€å‘½åå®ä½“è¯†åˆ«ç­‰ã€‚","like_count":3,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647468,"discussion_content":"æ²¡é”™ï¼ŒåŠ æ²¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720074427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392847,"user_name":"å¼  Â·ä¸‡å²ï¼","can_delete":false,"product_type":"c1","uid":3923442,"ip_address":"åŒ—äº¬","ucode":"C95598C751FCC1","user_header":"https://static001.geekbang.org/account/avatar/00/3b/dd/f2/3513c633.jpg","comment_is_top":false,"comment_ctime":1721922977,"is_pvip":false,"replies":[{"id":142734,"content":"æ²¡é—®é¢˜çš„ï¼Œæ€»ç®—é‡C=2.88*10^17ï¼Œä½ å¦‚æœç”¨14769å¼ a100ï¼Œé‚£å°±æ˜¯1ç§’é’Ÿæå®šï¼Œå¦‚æœç”¨147å¼ A100ï¼Œé‚£å°±100ç§’","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1722309080,"ip_address":"æµ™æ±Ÿ","comment_id":392847,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"å‚æ•°é‡1.2äº¿ï¼Œè¦è®­ç»ƒçš„è¯å…ƒæ•°\nç†è®ºä¸Šï¼Œå¦‚æœå…‰çœ‹æ¨¡å‹çš„å†…å­˜ï¼Œä¸€å¼ a100 80gbå®Œå…¨å¯ä»¥å®¹çº³å¾—ä¸‹æ¥ï¼Œå› ä¸º120,000,000Ã—4Ã·1,024Ã·1,024=457.763671875MBï¼Œç»°ç»°æœ‰ä½™ã€‚\n\nç®—åŠ›ä¸Šæ¥çœ‹çš„è¯ï¼Œæˆ‘æ²¡å¤ªæ‡‚è¿™ä¸ªé—®æ³•ã€‚æŒ‰ç…§æˆ‘çš„ç†è§£æ¥ç®—ï¼Œ12gbçš„è®­ç»ƒæ–‡æœ¬ä¸€å…±å¤§æ¦‚800ä¸‡æ¡æ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬50ä¸ªè¯å…ƒï¼Œè¯å…ƒæ•°D=4äº¿ã€‚å†ç®—ä¸Šå‚æ•°é‡1.2äº¿ã€‚é‚£ä¹ˆæ€»çš„è®¡ç®—é‡å°±æ˜¯C=2.88*10^17ã€‚  è‹±ä¼Ÿè¾¾çš„a100 80gbçš„32ä½æµ®ç‚¹è¿ç®—çš„å³°å€¼æ˜¯19.5tflopsï¼Œä¹Ÿå°±è¯´1.95*10^13ã€‚\né‚£ä¹ˆæœ‰(2.88Ã—10^(17))Ã·(1.95Ã—10^(13))=14769.23\nä¹Ÿå°±è¯´ç­‰äº14769å¼ a100çš„ç®—åŠ›ï¼Ÿ\næ€»æ„Ÿè§‰æˆ‘ç®—çš„ä¸€ç‚¹ä¹Ÿä¸å¯¹ã€‚ã€‚ã€‚","like_count":1,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648852,"discussion_content":"æ²¡é—®é¢˜çš„ï¼Œæ€»ç®—é‡C=2.88*10^17ï¼Œä½ å¦‚æœç”¨14769å¼ a100ï¼Œé‚£å°±æ˜¯1ç§’é’Ÿæå®šï¼Œå¦‚æœç”¨147å¼ A100ï¼Œé‚£å°±100ç§’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1722309080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392500,"user_name":"å°±åœ¨è¿™å„¿ğŸ’‹","can_delete":false,"product_type":"c1","uid":1119877,"ip_address":"å¹¿ä¸œ","ucode":"36644369AB020E","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/85/b3af5d54.jpg","comment_is_top":false,"comment_ctime":1721112724,"is_pvip":false,"replies":[{"id":142693,"content":"ç›´æ¥ç”¨å°±å¯ä»¥ï¼ŒDataLoaderæ˜¯torché‡Œçš„ç±»ï¼Œä½ æƒ³çœ‹æºç çš„è¯ç›´æ¥å»çœ‹torchçš„æºç å°±è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1721389058,"ip_address":"æµ™æ±Ÿ","comment_id":392500,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è€å¸ˆ,æœ‰æ²¡æœ‰å®Œæ•´çš„ä»£ç æ–‡ä»¶å‘€,è¯¾ç¨‹é‡Œçš„ç¤ºä¾‹ä»£ç ç¼ºäº†ä¸€äº›å†…å®¹, DataLoaderçš„ collect_fnæ˜¯æ²¡æœ‰çš„","like_count":0,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648338,"discussion_content":"ç›´æ¥ç”¨å°±å¯ä»¥ï¼ŒDataLoaderæ˜¯torché‡Œçš„ç±»ï¼Œä½ æƒ³çœ‹æºç çš„è¯ç›´æ¥å»çœ‹torchçš„æºç å°±è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721389058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008257,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","nickname":"Lane","note":"","ucode":"F70459D1BBD9F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654967,"discussion_content":"+1 æˆ‘ä¹Ÿè·‘ä¸é€š\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733897225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392422,"user_name":"å¤§å®½","can_delete":false,"product_type":"c1","uid":1071011,"ip_address":"åŒ—äº¬","ucode":"12970A21E939EA","user_header":"https://static001.geekbang.org/account/avatar/00/10/57/a3/4bcf1b59.jpg","comment_is_top":false,"comment_ctime":1720876981,"is_pvip":false,"replies":[{"id":142690,"content":"å’±ä»¬è¯¾ç¨‹é‡Œéƒ½æœ‰äº†å‘€ï¼Œæ¡†æ¶æœ‰å¥½å¤šç§ï¼Œpytorchï¼ŒTensorFlowï¼Œç™¾åº¦é£æ¡¨ç­‰ç­‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1721381928,"ip_address":"æµ™æ±Ÿ","comment_id":392422,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è€å¸ˆ å¤§æ¨¡å‹è®­ç»ƒéƒ½ç”¨å“ªäº›æ¡†æ¶å‘¢ï¼Œpytorch å—ï¼Œè¿˜æœ‰å…¶ä»–å·¥å…·ä¸ ï¼Œæˆ–è€…å’±å›½å†…çš„ä¸€äº›å¤§æ¨¡å‹éƒ½ç”¨ä»€ä¹ˆæ¡†æ¶è®­ç»ƒçš„å‘¢ã€‚è€å¸ˆå¯å¦æ•´ä½“ä»‹ç»ä¸€ä¸‹ï¼Œä¸€ä¸ªæ¨¡å‹ä»è®­ç»ƒåˆ°æ¨ç† åšæˆ api éœ€è¦çš„æ­¥éª¤åŠå…¶å¯¹åº”çš„æŠ€æœ¯å·¥å…·å“ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648332,"discussion_content":"å’±ä»¬è¯¾ç¨‹é‡Œéƒ½æœ‰äº†å‘€ï¼Œæ¡†æ¶æœ‰å¥½å¤šç§ï¼Œpytorchï¼ŒTensorFlowï¼Œç™¾åº¦é£æ¡¨ç­‰ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721381928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392263,"user_name":"Lee","can_delete":false,"product_type":"c1","uid":1060230,"ip_address":"ç¦å»º","ucode":"357C3D2F33B325","user_header":"https://static001.geekbang.org/account/avatar/00/10/2d/86/07a10be2.jpg","comment_is_top":false,"comment_ctime":1720441295,"is_pvip":false,"replies":[{"id":142595,"content":"æ¨¡å‹è®­ç»ƒæ—¶é—´ä¾èµ–å‡ ä¸ªå› ç´ ï¼ŒåŒ…æ‹¬æ•°æ®é›†çš„å¤§å°ã€æ¨¡å‹çš„å¤æ‚åº¦ã€è®¡ç®—èµ„æºçš„æ€§èƒ½ç­‰ï¼Œæ²¡æœ‰é€šç”¨çš„å…¬å¼å¯ä»¥ç²¾ç¡®è®¡ç®—è®­ç»ƒæ—¶é—´ï¼Œä½ å¯ä»¥è‡ªå·±æ ¹æ®æ¯ä¸€ä¸ªepochæ—¶é—´æ¥è¯„ä¼°æ•´ä½“éœ€è¦çš„æ—¶é—´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1720604731,"ip_address":"æµ™æ±Ÿ","comment_id":392263,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è€å¸ˆ  èƒ½è¯´è¯´è®­ç»ƒæ—¶é—´æ€ä¹ˆé¢„ä¼°å—","like_count":0,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647786,"discussion_content":"æ¨¡å‹è®­ç»ƒæ—¶é—´ä¾èµ–å‡ ä¸ªå› ç´ ï¼ŒåŒ…æ‹¬æ•°æ®é›†çš„å¤§å°ã€æ¨¡å‹çš„å¤æ‚åº¦ã€è®¡ç®—èµ„æºçš„æ€§èƒ½ç­‰ï¼Œæ²¡æœ‰é€šç”¨çš„å…¬å¼å¯ä»¥ç²¾ç¡®è®¡ç®—è®­ç»ƒæ—¶é—´ï¼Œä½ å¯ä»¥è‡ªå·±æ ¹æ®æ¯ä¸€ä¸ªepochæ—¶é—´æ¥è¯„ä¼°æ•´ä½“éœ€è¦çš„æ—¶é—´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720604731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392093,"user_name":"ç¿”","can_delete":false,"product_type":"c1","uid":1952130,"ip_address":"ä¸Šæµ·","ucode":"89E97976EC2DF3","user_header":"","comment_is_top":false,"comment_ctime":1719931205,"is_pvip":false,"replies":[{"id":142532,"content":"æœ‰çš„ï¼Œå¯èƒ½å¤§å®¶è¿˜æ²¡åˆ°è¿™èŠ‚è¯¾","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1719973739,"ip_address":"æµ™æ±Ÿ","comment_id":392093,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è¯¾ç¨‹åˆ°è¿™é‡Œï¼Œæ²¡äººäº’åŠ¨äº†ï¼Œæ˜¯ä¸æ˜¯éƒ½æ‰é˜Ÿäº†ğŸ˜Ÿ","like_count":0,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647386,"discussion_content":"æœ‰çš„ï¼Œå¯èƒ½å¤§å®¶è¿˜æ²¡åˆ°è¿™èŠ‚è¯¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1719973739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":392092,"user_name":"ç¿”","can_delete":false,"product_type":"c1","uid":1952130,"ip_address":"ä¸Šæµ·","ucode":"89E97976EC2DF3","user_header":"","comment_is_top":false,"comment_ctime":1719931159,"is_pvip":false,"replies":[{"id":142526,"content":"CPUæ¯”è¾ƒæ…¢ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ŒæŠŠæ¨¡å‹ç½‘ç»œå®šä¹‰çš„ç®€å•ä¸€ç‚¹ï¼Œè®­ç»ƒæ•°æ®å°‘ä¸€ç‚¹ï¼ŒCPUå¯èƒ½ä¹Ÿå¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2083554,"ctime":1719973274,"ip_address":"æµ™æ±Ÿ","comment_id":392092,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è®­ç»ƒæ¨¡å‹å¿…é¡»è¦ç”¨æ˜¾å¡å—ï¼Œè·‘ä¸€ä¸¢ä¸¢æµ‹è¯•æ•°æ®ï¼Œç”¨ cpu ä¸è¡Œå—","like_count":0,"discussions":[{"author":{"id":2083554,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZP8e2vqiaACFaDxruOzUTPbPv2uRUTp9UuEg98Ib9aYddjZK2kastqf0B14Ec7uXx7CCSXr0fhAA/132","nickname":"Geek_cf2545","note":"","ucode":"B69DF1E734FBA2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647380,"discussion_content":"CPUæ¯”è¾ƒæ…¢ï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼ŒæŠŠæ¨¡å‹ç½‘ç»œå®šä¹‰çš„ç®€å•ä¸€ç‚¹ï¼Œè®­ç»ƒæ•°æ®å°‘ä¸€ç‚¹ï¼ŒCPUå¯èƒ½ä¹Ÿå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1719973274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396634,"user_name":"Geek_f80ce5","can_delete":false,"product_type":"c1","uid":2360052,"ip_address":"åŒ—äº¬","ucode":"8A6FE741BE5F07","user_header":"","comment_is_top":false,"comment_ctime":1735172327,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100770601,"comment_content":"è¿™ä¸ªæºä»£ç æœ‰å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":396267,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"åŒ—äº¬","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1733816028,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100770601,"comment_content":"collate_fnåº”è¯¥æ€ä¹ˆå®ç°å‘¢","like_count":0},{"had_liked":false,"id":396266,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"åŒ—äº¬","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1733813930,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100770601,"comment_content":"ä»£ç ç¼ºå¤±çš„åœ°æ–¹å‘¢","like_count":0},{"had_liked":false,"id":396200,"user_name":"Geek_4d9162","can_delete":false,"product_type":"c1","uid":4039257,"ip_address":"æ²³åŒ—","ucode":"9415AF51BF6371","user_header":"","comment_is_top":false,"comment_ctime":1733539305,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100770601,"comment_content":"è€å¸ˆ  æ±‚åŠ©ï¼Œä¸­æ–‡ wiki æ•°æ®é›†ä¸‹è½½é¡µé¢æ‰“ä¸å¼€ï¼Œ èƒ½å¦ä¸Šä¼ ä¸€ä¸ªé˜¿é‡Œäº‘ç›˜æˆ–è€…è…¾è®¯äº‘ç›˜çš„ï¼Œç™¾åº¦ç½‘ç›˜ä¸‹è½½å¤ªæ…¢äº†ã€‚","like_count":0}]}