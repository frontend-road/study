{"id":369519,"title":"22 | Catalystç‰©ç†è®¡åˆ’ï¼šä½ çš„SQLè¯­å¥æ˜¯æ€ä¹ˆè¢«ä¼˜åŒ–çš„ï¼ˆä¸‹ï¼‰ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬è¯´äº†ï¼ŒCatalystä¼˜åŒ–å™¨çš„é€»è¾‘ä¼˜åŒ–è¿‡ç¨‹åŒ…å«ä¸¤ä¸ªç¯èŠ‚ï¼šé€»è¾‘è®¡åˆ’è§£æå’Œé€»è¾‘è®¡åˆ’ä¼˜åŒ–ã€‚é€»è¾‘ä¼˜åŒ–çš„æœ€ç»ˆç›®çš„å°±æ˜¯è¦æŠŠUnresolved Logical Planä»æ¬¡ä¼˜çš„Analyzed Logical Planæœ€ç»ˆå˜èº«ä¸ºæ‰§è¡Œé«˜æ•ˆçš„Optimized Logical Planã€‚</p><p>ä½†æ˜¯ï¼Œé€»è¾‘ä¼˜åŒ–çš„æ¯ä¸€æ­¥ä»…ä»…æ˜¯ä»é€»è¾‘ä¸Šè¡¨æ˜Spark SQLéœ€è¦â€œåšä»€ä¹ˆâ€ï¼Œå¹¶æ²¡æœ‰ä»æ‰§è¡Œå±‚é¢è¯´æ˜å…·ä½“è¯¥â€œæ€ä¹ˆåšâ€ã€‚å› æ­¤ï¼Œä¸ºäº†æŠŠé€»è¾‘è®¡åˆ’äº¤ä»˜æ‰§è¡Œï¼ŒCatalystè¿˜éœ€è¦æŠŠOptimized Logical Planè½¬æ¢ä¸ºç‰©ç†è®¡åˆ’ã€‚ç‰©ç†è®¡åˆ’æ¯”é€»è¾‘è®¡åˆ’æ›´å…·ä½“ï¼Œå®ƒæ˜ç¡®äº¤ä»£äº†Spark SQLçš„æ¯ä¸€æ­¥å…·ä½“è¯¥æ€ä¹ˆæ‰§è¡Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/53/fd/534dd788609386c14d9e977866301dfd.jpg?wh=4629*1104?wh=4629*1104\" alt=\"\" title=\"ç‰©ç†è®¡åˆ’é˜¶æ®µ\"></p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç»§ç»­è¿½éšå°Qçš„è„šæ­¥ï¼Œçœ‹çœ‹å®ƒç»è¿‡Catalystçš„ç‰©ç†ä¼˜åŒ–é˜¶æ®µä¹‹åï¼Œè¿˜ä¼šå‘ç”Ÿå“ªäº›å˜åŒ–ã€‚</p><h2>ä¼˜åŒ–Spark Plan</h2><p>ç‰©ç†é˜¶æ®µçš„ä¼˜åŒ–æ˜¯ä»é€»è¾‘ä¼˜åŒ–é˜¶æ®µè¾“å‡ºçš„Optimized Logical Planå¼€å§‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹å°Qçš„åŸå§‹æŸ¥è¯¢å’ŒOptimized Logical Planã€‚</p><pre><code>\nval userFile: String = _\nval usersDf = spark.read.parquet(userFile)\nusersDf.printSchema\n/**\nroot\n|-- userId: integer (nullable = true)\n|-- name: string (nullable = true)\n|-- age: integer (nullable = true)\n|-- gender: string (nullable = true)\n|-- email: string (nullable = true)\n*/\nval users = usersDf\n.select(&quot;name&quot;, &quot;age&quot;, &quot;userId&quot;)\n.filter($&quot;age&quot; &lt; 30)\n.filter($&quot;gender&quot;.isin(&quot;M&quot;))\n\nval txFile: String = _\nval txDf = spark.read.parquet(txFile)\ntxDf.printSchema\n/**\nroot\n|-- txId: integer (nullable = true)\n|-- userId: integer (nullable = true)\n|-- price: float (nullable = true)\n|-- volume: integer (nullable = true)\n*/\n\nval result = txDF.select(&quot;price&quot;, &quot;volume&quot;, &quot;userId&quot;)\n.join(users, Seq(&quot;userId&quot;), &quot;inner&quot;)\n.groupBy(col(&quot;name&quot;), col(&quot;age&quot;)).agg(sum(col(&quot;price&quot;) * col(&quot;volume&quot;)).alias(&quot;revenue&quot;))\n\nresult.write.parquet(&quot;_&quot;)\n\n</code></pre><p>ä¸¤è¡¨å…³è”çš„æŸ¥è¯¢è¯­å¥ç»è¿‡è½¬æ¢ä¹‹åï¼Œå¾—åˆ°çš„Optimized Logical Planå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ³¨æ„ï¼Œåœ¨é€»è¾‘è®¡åˆ’çš„æ ¹èŠ‚ç‚¹ï¼Œå‡ºç°äº†â€œJoin Innerâ€å­—æ ·ï¼ŒCatalystä¼˜åŒ–å™¨æ˜ç¡®äº†è¿™ä¸€æ­¥éœ€è¦åšå†…å…³è”ã€‚ä½†æ˜¯ï¼Œæ€ä¹ˆåšå†…å…³è”ï¼Œä½¿ç”¨å“ªç§Joinç­–ç•¥æ¥è¿›è¡Œå…³è”ï¼ŒCatalystå¹¶æ²¡æœ‰äº¤ä»£æ¸…æ¥šã€‚å› æ­¤ï¼Œé€»è¾‘è®¡åˆ’æœ¬èº«ä¸å…·å¤‡å¯æ“ä½œæ€§ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/72/df/7223829502eeeca0fbfb721c6a3b61df.png?wh=1338*390\" alt=\"\" title=\"å°Qå˜èº«ï¼šOptimized Logical Plan\"></p><p><strong>ä¸ºäº†è®©æŸ¥è¯¢è®¡åˆ’ï¼ˆQuery Planï¼‰å˜å¾—å¯æ“ä½œã€å¯æ‰§è¡Œï¼ŒCatalystçš„ç‰©ç†ä¼˜åŒ–é˜¶æ®µï¼ˆPhysical Planningï¼‰å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç¯èŠ‚ï¼šä¼˜åŒ–Spark Planå’Œç”ŸæˆPhysical Planã€‚</strong></p><ul>\n<li>åœ¨ä¼˜åŒ–Spark Plançš„è¿‡ç¨‹ä¸­ï¼ŒCatalyståŸºäºæ—¢å®šçš„ä¼˜åŒ–ç­–ç•¥ï¼ˆStrategiesï¼‰ï¼ŒæŠŠé€»è¾‘è®¡åˆ’ä¸­çš„å…³ç³»æ“ä½œç¬¦ä¸€ä¸€æ˜ å°„æˆç‰©ç†æ“ä½œç¬¦ï¼Œç”ŸæˆSpark Planã€‚</li>\n<li>åœ¨ç”ŸæˆPhysical Planè¿‡ç¨‹ä¸­ï¼ŒCatalystå†åŸºäºäº‹å…ˆå®šä¹‰çš„Preparation Rulesï¼Œå¯¹Spark Planåšè¿›ä¸€æ­¥çš„å®Œå–„ã€ç”Ÿæˆå¯æ‰§è¡Œçš„Physical Planã€‚</li>\n</ul><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ä¼˜åŒ–Spark Plançš„è¿‡ç¨‹ä¸­ï¼ŒCatalystéƒ½æœ‰å“ªäº›æ—¢å®šçš„ä¼˜åŒ–ç­–ç•¥å‘¢ï¼Ÿä»æ•°é‡ä¸Šæ¥è¯´ï¼ŒCatalystæœ‰14ç±»ä¼˜åŒ–ç­–ç•¥ï¼Œå…¶ä¸­æœ‰6ç±»å’Œæµè®¡ç®—æœ‰å…³ï¼Œå‰©ä¸‹çš„8ç±»é€‚ç”¨äºæ‰€æœ‰çš„è®¡ç®—åœºæ™¯ï¼Œå¦‚æ‰¹å¤„ç†ã€æ•°æ®åˆ†æã€æœºå™¨å­¦ä¹ å’Œå›¾è®¡ç®—ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æµè®¡ç®—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€äº†è§£è¿™8ç±»ä¼˜åŒ–ç­–ç•¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/51/56/51ca111dfb9ebd60e2443c86e9b0cb56.jpeg?wh=1920*1080\" alt=\"\" title=\"Catalystç‰©ç†ä¼˜åŒ–é˜¶æ®µçš„14ä¸ªä¼˜åŒ–ç­–ç•¥\"></p><p>æ‰€æœ‰ä¼˜åŒ–ç­–ç•¥åœ¨è½¬æ¢æ–¹å¼ä¸Šéƒ½å¤§åŒå°å¼‚ï¼Œéƒ½æ˜¯ä½¿ç”¨åŸºäºæ¨¡å¼åŒ¹é…çš„åå‡½æ•°ï¼ˆPartial Functionsï¼‰ï¼ŒæŠŠé€»è¾‘è®¡åˆ’ä¸­çš„æ“ä½œç¬¦å¹³è¡Œæ˜ å°„ä¸ºSpark Planä¸­çš„ç‰©ç†ç®—å­ã€‚æ¯”å¦‚ï¼ŒBasicOperatorsç­–ç•¥ç›´æ¥æŠŠProjectã€Filterã€Sortç­‰é€»è¾‘æ“ä½œç¬¦å¹³è¡Œåœ°æ˜ å°„ä¸ºç‰©ç†æ“ä½œç¬¦ã€‚å…¶ä»–ç­–ç•¥çš„ä¼˜åŒ–è¿‡ç¨‹ä¹Ÿç±»ä¼¼ï¼Œå› æ­¤ï¼Œåœ¨ä¼˜åŒ–Spark Planè¿™ä¸€ç¯èŠ‚ï¼Œå’±ä»¬åªè¦æŠ“ä½ä¸€ä¸ªâ€œå…¸å‹â€ç­–ç•¥ï¼ŒæŒæ¡å®ƒçš„è½¬æ¢è¿‡ç¨‹å³å¯ã€‚</p><p>é‚£æˆ‘ä»¬è¯¥æŠ“è°åšâ€œå…¸å‹â€å‘¢ï¼Ÿæˆ‘è§‰å¾—ï¼Œ<strong>è¿™ä¸ªâ€œå…¸å‹â€è‡³å°‘è¦æ»¡è¶³ä¸¤ä¸ªæ ‡å‡†ï¼šä¸€ï¼Œå®ƒè¦åœ¨æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯ä¸­éå¸¸æ™®éï¼›äºŒï¼Œå®ƒçš„å–èˆå¯¹äºæ‰§è¡Œæ€§èƒ½çš„å½±å“æœ€ä¸ºå…³é”®ã€‚</strong>ä»¥è¿™ä¸¤ä¸ªæ ‡å‡†å»é´é€‰ä¸Šé¢çš„8ç±»ç­–ç•¥ï¼Œæˆ‘ä»¬åˆ†åˆ†é’Ÿå°±èƒ½é”å®šJoinSelectionã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥JoinSelectionä¸ºä¾‹ï¼Œè¯¦ç»†è®²è§£è¿™ä¸€ç¯èŠ‚çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚</p><p>å¦‚æœç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬JoinSelectionçš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œå°±æ˜¯ç»“åˆå¤šæ–¹é¢çš„ä¿¡æ¯ï¼Œæ¥å†³å®šåœ¨ç‰©ç†ä¼˜åŒ–é˜¶æ®µé‡‡ç”¨å“ªç§Joinç­–ç•¥ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒCatalystéƒ½æœ‰å“ªäº›Joinç­–ç•¥ï¼Ÿ</p><h3>Catalystéƒ½æœ‰å“ªäº›Joinç­–ç•¥ï¼Ÿ</h3><p>ç»“åˆJoinsçš„å®ç°æœºåˆ¶å’Œæ•°æ®çš„åˆ†å‘æ–¹å¼ï¼ŒCatalyståœ¨è¿è¡Œæ—¶æ€»å…±æ”¯æŒ5ç§Joinç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯Broadcast Hash Joinï¼ˆBHJï¼‰ã€Shuffle Sort Merge Joinï¼ˆSMJï¼‰ã€Shuffle Hash Joinï¼ˆSHJï¼‰ã€Broadcast Nested Loop Joinï¼ˆBNLJï¼‰å’ŒShuffle Cartesian Product Joinï¼ˆCPJï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/39/fb/39642808b292abb0b5b37ea69bfb19fb.jpeg?wh=1657*808\" alt=\"\" title=\"5ç§Joinç­–ç•¥åŠå…¶å«ä¹‰\"></p><p>é€šè¿‡ä¸Šè¡¨ä¸­5ç§Joinç­–ç•¥çš„å«ä¹‰ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå®ƒä»¬æ˜¯æ¥è‡ª2ç§æ•°æ®åˆ†å‘æ–¹å¼ï¼ˆå¹¿æ’­å’ŒShuffleï¼‰ä¸3ç§Joinå®ç°æœºåˆ¶ï¼ˆHash Joinsã€Sort Merge Joinså’ŒNested Loop Joinsï¼‰çš„æ’åˆ—ç»„åˆã€‚é‚£ä¹ˆï¼Œåœ¨JoinSelectionçš„ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼ŒCatalystä¼šåŸºäºä»€ä¹ˆé€»è¾‘ï¼Œä¼˜å…ˆé€‰æ‹©å“ªç§Joinç­–ç•¥å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/48/e9bf1720ac13289a9e49e0f33a334548.jpg?wh=1989*1149\" alt=\"\" title=\"æ•°æ®åˆ†å‘æ–¹å¼ä¸Joinå®ç°æœºåˆ¶çš„æ’åˆ—ç»„åˆ\"></p><h3>JoinSelectionå¦‚ä½•å†³å®šé€‰æ‹©å“ªä¸€ç§Joinç­–ç•¥ï¼Ÿ</h3><p>é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œ<strong>Catalystæ€»ä¼šå°è¯•ä¼˜å…ˆé€‰æ‹©æ‰§è¡Œæ•ˆç‡æœ€é«˜çš„ç­–ç•¥ã€‚</strong>å…·ä½“æ¥è¯´ï¼Œåœ¨é€‰æ‹©joinç­–ç•¥çš„æ—¶å€™ï¼ŒJoinSelectionä¼šå…ˆåˆ¤æ–­å½“å‰æŸ¥è¯¢æ˜¯å¦æ»¡è¶³BHJæ‰€è¦æ±‚çš„å…ˆå†³æ¡ä»¶ï¼šå¦‚æœæ»¡è¶³å°±ç«‹å³é€‰ä¸­BHJï¼›å¦‚æœä¸æ»¡è¶³ï¼Œå°±ç»§ç»­åˆ¤æ–­å½“å‰æŸ¥è¯¢æ˜¯å¦æ»¡è¶³SMJçš„å…ˆå†³æ¡ä»¶ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€ç»ˆé€‰æ— å¯é€‰ï¼Œç”¨CPJæ¥å…œåº•ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™5ç§Joinç­–ç•¥éƒ½éœ€è¦æ»¡è¶³å“ªäº›å…ˆå†³æ¡ä»¶å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼ŒJoinSelectionåšå†³ç­–æ—¶éƒ½è¦ä¾èµ–å“ªäº›ä¿¡æ¯å‘¢ï¼Ÿ</p><p>æ€»çš„æ¥è¯´ï¼Œ<strong>è¿™äº›ä¿¡æ¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯â€œæ¡ä»¶å‹â€ä¿¡æ¯ï¼Œç”¨æ¥åˆ¤å†³5å¤§Joinç­–ç•¥çš„å…ˆå†³æ¡ä»¶ã€‚ç¬¬äºŒç±»æ˜¯â€œæŒ‡ä»¤å‹â€ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å¼€å‘è€…æä¾›çš„Join Hintsã€‚</strong></p><p>æˆ‘ä»¬å…ˆæ¥è¯´â€œæ¡ä»¶å‹â€ä¿¡æ¯ï¼Œå®ƒåŒ…å«ä¸¤ç§ã€‚ç¬¬ä¸€ç§æ˜¯Joinç±»å‹ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦ç­‰å€¼ã€è¿æ¥å½¢å¼ç­‰ï¼Œè¿™ç§ä¿¡æ¯çš„æ¥æºæ˜¯æŸ¥è¯¢è¯­å¥æœ¬èº«ã€‚ç¬¬äºŒç§æ˜¯å†…è¡¨å°ºå¯¸ï¼Œè¿™äº›ä¿¡æ¯çš„æ¥æºå°±æ¯”è¾ƒå¹¿æ³›äº†ï¼Œå¯ä»¥æ˜¯Hiveè¡¨ä¹‹ä¸Šçš„ANALYZE TABLEè¯­å¥ï¼Œä¹Ÿå¯ä»¥æ˜¯Sparkå¯¹äºParquetã€ORCã€CSVç­‰æºæ–‡ä»¶çš„å°ºå¯¸é¢„ä¼°ï¼Œç”šè‡³æ˜¯æ¥è‡ªAQEçš„åŠ¨æ€ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>5å¤§Joinç­–ç•¥å¯¹äºè¿™äº›ä¿¡æ¯çš„è¦æ±‚ï¼Œæˆ‘éƒ½æ•´ç†åˆ°äº†ä¸‹é¢çš„è¡¨æ ¼é‡Œï¼Œä½ å¯ä»¥çœ‹ä¸€çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/aa/99f3e75bbc090dfb162c0b241515ddaa.jpeg?wh=1920*871\" alt=\"\" title=\"5ç§Joinç­–ç•¥çš„å…ˆå†³æ¡ä»¶\"></p><p>æŒ‡ä»¤å‹ä¿¡æ¯ä¹Ÿå°±æ˜¯Join Hintsï¼Œå®ƒçš„ç§ç±»éå¸¸ä¸°å¯Œï¼Œå®ƒå…è®¸æˆ‘ä»¬æŠŠä¸ªäººæ„å¿—å‡Œé©¾äºSpark SQLä¹‹ä¸Šã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å°Qçš„æŸ¥è¯¢è¯­å¥åšäº†å¦‚ä¸‹çš„è°ƒæ•´ï¼ŒJoinSelectionåœ¨åšJoinç­–ç•¥é€‰æ‹©çš„æ—¶å€™å°±ä¼šä¼˜å…ˆå°Šé‡æˆ‘ä»¬çš„æ„æ„¿ï¼Œè·³è¿‡SMJå»é€‰æ‹©æ’åºæ›´ä½çš„SHJã€‚å…·ä½“çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>val result = txDF.select(&quot;price&quot;, &quot;volume&quot;, &quot;userId&quot;)\n.join(users.hint(&quot;shuffle_hash&quot;), Seq(&quot;userId&quot;), &quot;inner&quot;)\n.groupBy(col(&quot;name&quot;), col(&quot;age&quot;)).agg(sum(col(&quot;price&quot;) * \ncol(&quot;volume&quot;)).alias(&quot;revenue&quot;))\n</code></pre><p>ç†Ÿæ‚‰äº†JoinSelectioné€‰æ‹©Joinç­–ç•¥çš„é€»è¾‘ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹å°Qæ˜¯æ€ä¹ˆé€‰æ‹©çš„ã€‚å°Qæ˜¯å…¸å‹çš„æ˜Ÿå‹æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯äº‹å®è¡¨ä¸ç»´åº¦è¡¨ä¹‹é—´çš„æ•°æ®å…³è”ï¼Œå…¶ä¸­ç»´è¡¨è¿˜å¸¦è¿‡æ»¤æ¡ä»¶ã€‚åœ¨å†³å®šé‡‡ç”¨å“ªç§Joinç­–ç•¥çš„æ—¶å€™ï¼ŒJoinSelectionä¼˜å…ˆå°è¯•åˆ¤æ–­å°Qæ˜¯å¦æ»¡è¶³BHJçš„å…ˆå†³æ¡ä»¶ã€‚</p><p>æ˜¾ç„¶ï¼Œå°Qæ˜¯ç­‰å€¼çš„Inner Joinï¼Œå› æ­¤è¡¨æ ¼ä¸­BHJé‚£ä¸€è¡Œçš„å‰ä¸¤ä¸ªæ¡ä»¶å°Qéƒ½æ»¡è¶³ã€‚ä½†æ˜¯ï¼Œå†…è¡¨userså°ºå¯¸è¾ƒå¤§ï¼Œè¶…å‡ºäº†å¹¿æ’­é˜ˆå€¼çš„é»˜è®¤å€¼10MBï¼Œä¸æ»¡è¶³BHJçš„ç¬¬ä¸‰ä¸ªæ¡ä»¶ã€‚å› æ­¤ï¼ŒJoinSelectionä¸å¾—ä¸å¿ç—›å‰²çˆ±ã€æ”¾å¼ƒBHJç­–ç•¥ï¼Œåªå¥½é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ²¿ç€è¡¨æ ¼ç»§ç»­å‘ä¸‹ï¼Œå°è¯•åˆ¤æ–­å°Qæ˜¯å¦æ»¡è¶³SMJçš„å…ˆå†³æ¡ä»¶ã€‚</p><p>SMJçš„å…ˆå†³æ¡ä»¶å¾ˆå®½æ¾ï¼ŒæŸ¥è¯¢è¯­å¥åªè¦æ˜¯ç­‰å€¼Joinå°±å¯ä»¥ã€‚å°Qè‡ªç„¶æ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„ï¼Œå› æ­¤JoinSelectionæœ€ç»ˆç»™å°Qé€‰å®šçš„Joinç­–ç•¥å°±æ˜¯SMJã€‚ä¸‹å›¾æ˜¯å°Qä¼˜åŒ–è¿‡åçš„Spark Planï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢è®¡åˆ’çš„æ ¹èŠ‚ç‚¹æ­£æ˜¯SMJã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/73/a5/7312de5cf3yy06d6bc252c5923f163a5.png?wh=1920*658\" alt=\"\" title=\"å°Qå†å˜èº«ï¼šSpark Plan\"></p><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†Catalystéƒ½æœ‰å“ªäº›Joinç­–ç•¥ï¼ŒJoinSelectionå¦‚ä½•å¯¹ä¸åŒçš„Joinç­–ç•¥åšé€‰æ‹©ã€‚å°Qä¹Ÿä»Optimized Logical Planæ‘‡èº«ä¸€å˜ï¼Œè½¬æ¢æˆäº†Spark Planï¼Œä¹Ÿæ˜ç¡®äº†åœ¨è¿è¡Œæ—¶é‡‡ç”¨SMJæ¥åšå…³è”è®¡ç®—ã€‚ä¸è¿‡ï¼Œå³ä½¿å°Qåœ¨Spark Planä¸­å·²ç»æ˜ç¡®äº†æ¯ä¸€æ­¥è¯¥â€œæ€ä¹ˆåšâ€ï¼Œä½†æ˜¯ï¼ŒSparkè¿˜æ˜¯åšä¸åˆ°æŠŠè¿™æ ·çš„æŸ¥è¯¢è®¡åˆ’è½¬åŒ–æˆå¯æ‰§è¡Œçš„åˆ†å¸ƒå¼ä»»åŠ¡ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><h2>ç”ŸæˆPhysical Plan</h2><p>åŸæ¥ï¼ŒShuffle Sort Merge Joinçš„è®¡ç®—éœ€è¦ä¸¤ä¸ªå…ˆå†³æ¡ä»¶ï¼šShuffleå’Œæ’åºã€‚è€ŒSpark Planä¸­å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šä»¥å“ªä¸ªå­—æ®µä¸ºåŸºå‡†è¿›è¡ŒShuffleï¼Œä»¥åŠæŒ‰ç…§å“ªä¸ªå­—æ®µå»åšæ’åºã€‚</p><p>å› æ­¤ï¼ŒCatalystéœ€è¦å¯¹Spark Planåšè¿›ä¸€æ­¥çš„è½¬æ¢ï¼Œç”Ÿæˆå¯æ“ä½œã€å¯æ‰§è¡Œçš„Physical Planã€‚å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬ç»“åˆCatalystç‰©ç†ä¼˜åŒ–é˜¶æ®µçš„æµç¨‹å›¾æ¥è¯¦ç»†è®²è®²ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/53/fd/534dd788609386c14d9e977866301dfd.jpg?wh=4629*1104?wh=4629*1104\" alt=\"\" title=\"ç‰©ç†è®¡åˆ’é˜¶æ®µ\"></p><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»Spark Planåˆ°Physical Plançš„è½¬æ¢ï¼Œéœ€è¦å‡ ç»„å«åšPreparation Rulesçš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™åšå®ˆæœ€åä¸€ç­å²—ï¼Œè´Ÿè´£ç”ŸæˆPhysical Planã€‚é‚£ä¹ˆï¼Œè¿™äº›è§„åˆ™éƒ½æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬éƒ½åšäº†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/18/f7/187a85d53d585c5b3656353e3304fdf7.jpeg?wh=1857*923\" alt=\"\" title=\"Preparation Rules\"></p><p>Preparation Rulesæœ‰6ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ä½œç”¨åˆ°Spark Planä¹‹ä¸Šå°±ä¼šç”ŸæˆPhysical Planï¼Œè€ŒPhysical Planæœ€ç»ˆä¼šç”±Tungstenè½¬åŒ–ä¸ºç”¨äºè®¡ç®—RDDçš„åˆ†å¸ƒå¼ä»»åŠ¡ã€‚</p><p>å°Qçš„æŸ¥è¯¢è¯­å¥å¾ˆå…¸å‹ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå¹¶ä¸æ¶‰åŠå­æŸ¥è¯¢ï¼Œæ›´ä¸å­˜åœ¨Python UDFã€‚å› æ­¤ï¼Œåœ¨å°Qçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç”¨åˆ°å­æŸ¥è¯¢ã€æ•°æ®å¤ç”¨æˆ–æ˜¯Python UDFä¹‹ç±»çš„è§„åˆ™ï¼Œåªæœ‰EnsureRequirementså’ŒCollapseCodegenStagesè¿™ä¸¤ç»„è§„åˆ™ä¼šç”¨åˆ°å°Qçš„Physical Planè½¬åŒ–ä¸­ã€‚</p><p>å®é™…ä¸Šï¼Œå®ƒä»¬ä¹Ÿæ˜¯ç»“æ„åŒ–æŸ¥è¯¢ä¸­æœ€å¸¸è§ã€æœ€å¸¸ç”¨çš„ä¸¤ç»„è§„åˆ™ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å…ˆæ¥é‡ç‚¹è¯´è¯´EnsureRequirementsè§„åˆ™çš„å«ä¹‰å’Œä½œç”¨ã€‚è‡³äºCollapseCodegenStagesè§„åˆ™ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯Tungstençš„WSCGåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è¯¦ç»†è¯´ã€‚</p><h3>EnsureRequirementsè§„åˆ™</h3><p>EnsureRequirementsç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œç¡®ä¿æ»¡è¶³å‰ææ¡ä»¶â€ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¯¹äºæ‰§è¡Œè®¡åˆ’ä¸­çš„æ¯ä¸€ä¸ªæ“ä½œç¬¦èŠ‚ç‚¹ï¼Œéƒ½æœ‰4ä¸ªå±æ€§ç”¨æ¥åˆ†åˆ«æè¿°æ•°æ®è¾“å…¥å’Œè¾“å‡ºçš„åˆ†å¸ƒçŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/yf/f8cae1364372a2a8c034a5ab00850yyf.jpeg?wh=1313*546\" alt=\"\" title=\"æè¿°è¾“å…¥ã€è¾“å‡ºè¦æ±‚çš„4ä¸ªå±æ€§\"></p><p>EnsureRequirementsè§„åˆ™è¦æ±‚ï¼Œå­èŠ‚ç‚¹çš„è¾“å‡ºæ•°æ®è¦æ»¡è¶³çˆ¶èŠ‚ç‚¹çš„è¾“å…¥è¦æ±‚ã€‚è¿™åˆæ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/05/00/05467eecb3c983d4fc4a3db8a0e7e600.jpg?wh=2298*1764\" alt=\"\" title=\"Projectæ²¡æœ‰æ»¡è¶³SortMergeJoinçš„Requirements\"></p><p>æˆ‘ä»¬ä»¥å°Qçš„Spark Planæ ‘å½¢ç»“æ„å›¾ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼šå›¾ä¸­å·¦å³ä¸¤ä¸ªåˆ†æ”¯åˆ†åˆ«è¡¨ç¤ºæ‰«æå’Œå¤„ç†usersè¡¨å’Œtransactionsè¡¨ã€‚åœ¨æ ‘çš„æœ€é¡¶ç«¯ï¼Œæ ¹èŠ‚ç‚¹SortMergeJoinæœ‰ä¸¤ä¸ªProjectå­èŠ‚ç‚¹ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨æ¥è¡¨ç¤ºusersè¡¨å’Œtransactionsè¡¨ä¸Šçš„æŠ•å½±æ•°æ®ã€‚è¿™ä¸¤ä¸ªProjectçš„outputPartitioningå±æ€§å’ŒoutputOrderingå±æ€§åˆ†åˆ«æ˜¯Unknowå’ŒNoneã€‚å› æ­¤ï¼Œå®ƒä»¬è¾“å‡ºçš„æ•°æ®æ²¡æœ‰æŒ‰ç…§ä»»ä½•åˆ—è¿›è¡ŒShuffleæˆ–æ˜¯æ’åºã€‚</p><p>ä½†æ˜¯ï¼ŒSortMergeJoinå¯¹äºè¾“å…¥æ•°æ®çš„è¦æ±‚å¾ˆæ˜ç¡®ï¼šæŒ‰ç…§userIdåˆ†æˆ200ä¸ªåˆ†åŒºä¸”æ’å¥½åºï¼Œè€Œè¿™ä¸¤ä¸ªProjectå­èŠ‚ç‚¹çš„è¾“å‡ºæ˜¾ç„¶å¹¶æ²¡æœ‰æ»¡è¶³çˆ¶èŠ‚ç‚¹SortMergeJoinçš„è¦æ±‚ã€‚è¿™ä¸ªæ—¶å€™ï¼Œ<strong>EnsureRequirementsè§„åˆ™å°±è¦ä»‹å…¥äº†ï¼Œå®ƒé€šè¿‡æ·»åŠ å¿…è¦çš„æ“ä½œç¬¦ï¼Œå¦‚Shuffleå’Œæ’åºï¼Œæ¥ä¿è¯SortMergeJoinèŠ‚ç‚¹å¯¹äºè¾“å…¥æ•°æ®çš„è¦æ±‚ä¸€å®šè¦å¾—åˆ°æ»¡è¶³</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/15/a8c45d1d6ecb6a120205252e21b1b715.jpg?wh=2223*1725\" alt=\"\" title=\"EnsureRequirementsè§„åˆ™æ·»åŠ Exchangeå’ŒSortæ“ä½œ\"></p><p>åœ¨ä¸¤ä¸ªProjectèŠ‚ç‚¹ä¹‹åï¼ŒEnsureRequirementsè§„åˆ™åˆ†åˆ«æ·»åŠ äº†Exchangeå’ŒSortèŠ‚ç‚¹ã€‚å…¶ä¸­ExchangeèŠ‚ç‚¹ä»£è¡¨Shuffleæ“ä½œï¼Œç”¨æ¥æ»¡è¶³SortMergeJoinå¯¹äºæ•°æ®åˆ†å¸ƒçš„è¦æ±‚ï¼›Sortè¡¨ç¤ºæ’åºï¼Œç”¨äºæ»¡è¶³SortMergeJoinå¯¹äºæ•°æ®æœ‰åºçš„è¦æ±‚ã€‚</p><p>æ·»åŠ äº†å¿…éœ€çš„èŠ‚ç‚¹ä¹‹åï¼Œå°Qçš„Physical Planå·²ç»ç›¸å½“å…·ä½“äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒSparkå¯ä»¥é€šè¿‡è°ƒç”¨Physical Plançš„doExecuteæ–¹æ³•ï¼ŒæŠŠç»“æ„åŒ–æŸ¥è¯¢çš„è®¡ç®—ç»“æœï¼Œè½¬æ¢æˆRDD[InternalRow]ï¼Œè¿™é‡Œçš„InternalRowï¼Œå°±æ˜¯Tungstenè®¾è®¡çš„å®šåˆ¶åŒ–äºŒè¿›åˆ¶æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªç»“æ„æˆ‘ä»¬åœ¨å†…å­˜è§†è§’ï¼ˆä¸€ï¼‰æœ‰è¿‡è¯¦ç»†çš„è®²è§£ï¼Œä½ å¯ä»¥ç¿»å›å»çœ‹çœ‹ã€‚é€šè¿‡è°ƒç”¨RDD[InternalRow]ä¹‹ä¸Šçš„Actionç®—å­ï¼ŒSparkå°±å¯ä»¥è§¦å‘Physical Planä»å¤´è‡³å°¾ä¾åºæ‰§è¡Œã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å°Qåˆå‘ç”Ÿäº†å“ªäº›å˜åŒ–ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/65/33/656e29b2d25549488087fc1a4af8cd33.png?wh=1920*963\" alt=\"\" title=\"å°Qå†å˜èº«ï¼šPhysical Plan\"></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹åˆ°EnsureRequirementsè§„åˆ™åœ¨ä¸¤ä¸ªåˆ†æ”¯çš„é¡¶ç«¯åˆ†åˆ«æ·»åŠ äº†Exchangeå’ŒSortæ“ä½œï¼Œæ¥æ»¡è¶³æ ¹èŠ‚ç‚¹SortMergeJoinçš„è®¡ç®—éœ€è¦ã€‚å…¶æ¬¡ï¼Œå¦‚æœä½ ä»”ç»†è§‚å¯Ÿçš„è¯ï¼Œä¼šå‘ç°Physical Planä¸­å¤šäº†å¾ˆå¤šæ˜Ÿå·â€œ<code>*</code>â€ï¼Œè¿™äº›æ˜Ÿå·çš„åé¢è¿˜å¸¦ç€æ‹¬å·å’Œæ•°å­—ï¼Œå¦‚å›¾ä¸­çš„â€œ<code>*ï¼ˆ3ï¼‰</code>â€ã€â€œ<code>*ï¼ˆ1ï¼‰</code>â€ã€‚è¿™ç§æ˜Ÿå·â€œ<code>*</code>â€æ ‡è®°è¡¨ç¤ºçš„å°±æ˜¯WSCGï¼Œåé¢çš„æ•°å­—ä»£è¡¨Stageç¼–å·ã€‚å› æ­¤ï¼Œæ‹¬å·ä¸­æ•°å­—ç›¸åŒçš„æ“ä½œï¼Œæœ€ç»ˆéƒ½ä¼šè¢«æåˆæˆä¸€ä»½â€œæ‰‹å†™ä»£ç â€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸‹ä¸€è®²è¦è¯´çš„Tungstençš„WSCGã€‚</p><p>è‡³æ­¤ï¼Œå°Qä»ä¸€ä¸ªä¸è€ƒè™‘æ‰§è¡Œæ•ˆç‡çš„â€œå›é€†å°‘å¹´â€ï¼Œå°±æˆé•¿ä¸ºäº†ä¸€åæ‰§è¡Œé«˜æ•ˆçš„â€œä¸“ä¸šäººå£«â€ï¼ŒCatalystè¿™ä½äººç”Ÿå¯¼å¸ˆåœ¨å…¶ä¸­çš„ä½œç”¨åŠŸä¸å¯æ²¡ã€‚</p><h2>å°ç»“</h2><p>ä¸ºäº†æŠŠé€»è¾‘è®¡åˆ’è½¬æ¢ä¸ºå¯ä»¥äº¤ä»˜æ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ï¼ŒSpark SQLç‰©ç†ä¼˜åŒ–é˜¶æ®µåŒ…å«ä¸¤ä¸ªç¯èŠ‚ï¼šä¼˜åŒ–Spark Planå’Œç”ŸæˆPhysical Planã€‚</p><p>åœ¨ä¼˜åŒ–Spark Planè¿™ä¸ªç¯èŠ‚ï¼ŒCatalyståŸºäºæ—¢å®šçš„ç­–ç•¥æŠŠé€»è¾‘è®¡åˆ’å¹³è¡Œæ˜ å°„ä¸ºSpark Planã€‚ç­–ç•¥å¾ˆå¤šï¼Œæˆ‘ä»¬é‡ç‚¹æŒæ¡JoinSelectionç­–ç•¥å°±å¯ä»¥ï¼Œå®ƒè¢«ç”¨æ¥åœ¨è¿è¡Œæ—¶é€‰æ‹©æœ€ä½³çš„Joinç­–ç•¥ã€‚JoinSelectionæŒ‰ç…§BHJ &gt; SMJ &gt; SHJ &gt; BNLJ &gt; CPJçš„é¡ºåºï¼Œä¾æ¬¡åˆ¤æ–­æŸ¥è¯¢è¯­å¥æ˜¯å¦æ»¡è¶³æ¯ä¸€ç§Joinç­–ç•¥çš„å…ˆå†³æ¡ä»¶è¿›è¡Œâ€œæ‹©ä¼˜å½•å–â€ã€‚</p><p>å¦‚æœå¼€å‘è€…ä¸æ»¡è¶³äºJoinSelectioné»˜è®¤çš„é€‰æ‹©é¡ºåºï¼Œä¹Ÿå°±æ˜¯BHJ &gt; SMJ &gt; SHJ &gt; BNLJ &gt; CPJï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨SQLæˆ–æ˜¯DSLè¯­å¥ä¸­å¼•å…¥Join hintsï¼Œæ¥æ˜ç¡®åœ°æŒ‡å®šJoinç­–ç•¥ï¼Œä»è€ŒæŠŠè‡ªå·±çš„æ„æ„¿å‡Œé©¾äºCatalystä¹‹ä¸Šã€‚ä¸è¿‡ï¼Œéœ€è¦æˆ‘ä»¬æ³¨æ„çš„æ˜¯ï¼Œè¦æƒ³è®©æŒ‡å®šçš„Joinç­–ç•¥åœ¨è¿è¡Œæ—¶ç”Ÿæ•ˆï¼ŒæŸ¥è¯¢è¯­å¥ä¹Ÿå¿…é¡»è¦æ»¡è¶³å…¶å…ˆå†³æ¡ä»¶æ‰è¡Œã€‚</p><p>åœ¨ç”ŸæˆPhysical Planè¿™ä¸ªç¯èŠ‚ï¼ŒCatalyståŸºäºæ—¢å®šçš„å‡ ç»„Preparation Rulesï¼ŒæŠŠä¼˜åŒ–è¿‡åçš„Spark Planè½¬æ¢æˆå¯ä»¥äº¤ä»˜æ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯Physical Planã€‚åœ¨è¿™äº›æ—¢å®šçš„Preparation Ruleså½“ä¸­ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡EnsureRequirementsè§„åˆ™ã€‚</p><p>EnsureRequirementsç”¨æ¥ç¡®ä¿æ¯ä¸€ä¸ªæ“ä½œç¬¦çš„è¾“å…¥æ¡ä»¶éƒ½èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œåœ¨å¿…è¦çš„æ—¶å€™ï¼Œä¼šæŠŠå¿…éœ€çš„æ“ä½œç¬¦å¼ºè¡Œæ’å…¥åˆ°Physical Planä¸­ã€‚æ¯”å¦‚å¯¹äºShuffle Sort Merge Joinæ¥è¯´ï¼Œè¿™ä¸ªæ“ä½œç¬¦å¯¹äºå­èŠ‚ç‚¹çš„æ•°æ®åˆ†å¸ƒå’Œé¡ºåºéƒ½æ˜¯æœ‰æ˜ç¡®è¦æ±‚çš„ï¼Œå› æ­¤ï¼Œåœ¨å­èŠ‚ç‚¹ä¹‹ä¸Šï¼ŒEnsureRequirementsä¼šå¼•å…¥æ–°çš„æ“ä½œç¬¦å¦‚Exchangeå’ŒSortã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><p>3ç§Joinå®ç°æ–¹å¼å’Œ2ç§ç½‘ç»œåˆ†å‘æ¨¡å¼ï¼Œæ˜æ˜åº”è¯¥æœ‰6ç§Joinç­–ç•¥ï¼Œä¸ºä»€ä¹ˆCatalystæ²¡æœ‰æ”¯æŒBroadcast Sort Merge Joinç­–ç•¥ï¼Ÿ</p><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":297007,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1623278322,"is_pvip":false,"replies":[{"id":"107963","content":"å¥½é—®é¢˜~ è€å¼Ÿè§‚å¯Ÿçš„å¾ˆç»†è‡´ï¼Œè¿™é‡Œç¡®å®æ˜¯æœ‰ä¸ªæœ‰æ„æ€çš„ä¼˜åŒ–ï¼Œä½ è¦ä¸é—®ï¼Œæˆ‘è¿˜çœŸå¿˜äº†~<br><br>è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯å‘ç”Ÿåœ¨spark-shellé‡Œé¢ï¼Œæˆ–è€…æ˜¯ä½ åœ¨RDDä¸Šè°ƒç”¨take(n)ï¼Œfirstï¼›æˆ–æ˜¯åœ¨DataFrameä¸Šè°ƒç”¨showï¼Œè¿™äº›æƒ…å†µä¸‹ã€‚<br><br>ä¸ç®¡æ˜¯å“ªç§APIæˆ–æ˜¯å“ªç§è°ƒç”¨ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æ•°æ®æ¢ç´¢ï¼Œåªæ‰“å°ç»“æœé›†çš„ä¸€ä¸ªéå¸¸å°çš„å­é›†ã€‚å¯¹äºè¿™ç§Actionè¯·æ±‚ï¼ŒSparkå†…éƒ¨æœ‰ä¸ªä¼˜åŒ–æœºåˆ¶ï¼Œæˆ–è€…æˆ‘æ¥åé—®ä½ ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœä½ æ˜¯Sparkï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿä½ ä¼šæŠŠå…¨é‡ç»“æœé›†éƒ½è®¡ç®—å‡ºæ¥ï¼Œç„¶åä»ä¸­éšæœºæŒ‘å‡ºä¸€äº›å­é›†æ•°æ®è¿”å›å—ï¼Ÿè¿™ç¡®å®æ˜¯ä¸ªæ–¹é¢ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•å¤ªæ…¢äº†ï¼Œæˆ–è€…æ˜¯å¤ªæµªè´¹èµ„æºäº†ï¼Œæ²¡å¿…è¦ã€‚æ¯•ç«Ÿï¼Œç”¨æˆ·æƒ³è¦çš„ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªå­é›†ã€‚<br><br>ç›´æ¥è¯´ç»“è®ºå§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSparkä¼šâ€œå·æ‡’â€~ æ€ä¹ˆå·å‘¢ï¼Ÿå®ƒä¼šå°è¯•ç”¨å¤šä¸ªJobå»åšè¿™ä¸ªäº‹æƒ…ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ç”¨åœ¨DataFrameå»showæ•°æ®ï¼Œé»˜è®¤æ‰“å°20è¡Œã€‚é‚£ä¹ˆï¼ŒSparkçš„ç¬¬ä¸€ä¸ªJobï¼Œæ˜¯åªè¯»å–å¹¶è®¡ç®—æºæ•°æ®çš„æŸä¸€ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œç„¶åå°è¯•è®¡ç®—æœ€ç»ˆçš„æ•°æ®ç»“æœï¼Œçœ‹çœ‹æœ€ç»ˆèƒ½ä¸èƒ½showå‡ºæ¥20æ¡ã€‚ç”±äºè®¡ç®—è¿‡ç¨‹ä¸­æœ‰èšåˆã€è¿‡æ»¤ï¼Œæ‰€ä»¥å“ªæ€•ä½ ä¸€ä¸ªåˆ†ç‰‡æœ‰ä¸Šä¸‡æ¡è®°å½•ï¼Œåˆ°æœ€åï¼Œä½ è¿˜çœŸä¸ä¸€å®šèƒ½å‰©ä¸‹20æ¡ã€‚æ‰€ä»¥ï¼ŒSparkå‘ç°è‡ªå·±ç¬¬ä¸€æ¬¡å°è¯•å¤±è´¥äº†ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªJobæ²¡æœ‰è¾¾åˆ°é¢„æœŸã€‚<br><br>æ¥ä¸‹æ¥ï¼Œè¿™ä¸ªå®¶ä¼™å°±æƒ³ï¼šä¸€ä¸ªåˆ†ç‰‡ä¸è¡Œï¼Œæˆ‘å°±ç”¨ä¸¤ä¸ªã€‚äºæ˜¯ï¼Œå®ƒåˆè¯•äº†ä¸€æ¬¡ï¼Œå‘ç°ï¼Œç»“æœé›†è¿˜æ˜¯å‡‘ä¸å¤Ÿ20æ¡ã€‚Sparkå¿ƒæƒ³ï¼šéº»è›‹ï¼Œå±…ç„¶è¿˜ä¸å¤Ÿï¼Œé‚£æˆ‘å†è¯•ä¸€æ¬¡ï¼Œè¿™æ¬¡ç”¨4ä¸ªç”šè‡³æ˜¯8ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œæˆ‘å°±ä¸ä¿¡æˆ‘å‡‘ä¸å¤Ÿã€‚å› æ­¤ï¼ŒSparkä¼šä¸€ç‚¹ä¸€ç‚¹åœ°å»è¯•ï¼Œç›´åˆ°ç»“æœé›†å¤§äºç­‰äº20æ¡ï¼Œå®ƒå°±ä¸å†è¯•äº†ï¼Œå› ä¸ºå·²ç»å®Œæˆä»»åŠ¡äº†ï¼šç»™ç”¨æˆ·è¾“å‡º20æ¡ç»“æœã€‚<br><br>ä½ çœ‹åˆ°çš„å¤šä¸ªJobï¼Œå°±æ˜¯Sparkåœ¨ä¸åœåœ°å°è¯•åŒä¸€ä¸ªäº‹æƒ…ï¼Œåªä¸è¿‡æœ‰äº›å¤±è´¥äº†ï¼Œæœ‰äº›æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œå¤±è´¥çš„é‚£äº›Jobï¼Œå®ƒä¸æ‰¿è®¤å®ƒå¤±è´¥äº†ï¼Œç»™æ ‡è®°æˆskippedä¹‹ç±»çš„â€”â€”ç®€ç›´æ˜¯æ— è€»ï¼Œå“ˆå“ˆå“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1623402357,"ip_address":"","comment_id":297007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"143357199090","product_id":100073401,"comment_content":"è€å¸ˆçœ‹åˆ°æ‚¨çš„å›å¤è¯´ä¸€ä¸ªactionå¯¹åº”ä¸€ä¸ªjobï¼Œå¯æ˜¯æˆ‘çœ‹Spark UIé‡Œï¼Œç»å¸¸ä¸€ä¸ªactionè¢«æ‹†åˆ†æˆäº†ä¸¤ä¸‰ä¸ªç›¸åŒçš„job(taskæ•°é‡å¯èƒ½ä¼šæœ‰ä¸åŒ)ï¼Œå¹¶ä¸”æœ‰æ—¶å€™å¥½å¤šjobè¿˜æ˜¯å¯ä»¥skipçš„ã€‚è¿™åˆæ¶‰åŠäº†Sparkçš„å“ªäº›ä¼˜åŒ–æœºåˆ¶å‘¢ï¼Ÿ","like_count":34,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521679,"discussion_content":"å¥½é—®é¢˜~ è€å¼Ÿè§‚å¯Ÿçš„å¾ˆç»†è‡´ï¼Œè¿™é‡Œç¡®å®æ˜¯æœ‰ä¸ªæœ‰æ„æ€çš„ä¼˜åŒ–ï¼Œä½ è¦ä¸é—®ï¼Œæˆ‘è¿˜çœŸå¿˜äº†~\n\nè¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯å‘ç”Ÿåœ¨spark-shellé‡Œé¢ï¼Œæˆ–è€…æ˜¯ä½ åœ¨RDDä¸Šè°ƒç”¨take(n)ï¼Œfirstï¼›æˆ–æ˜¯åœ¨DataFrameä¸Šè°ƒç”¨showï¼Œè¿™äº›æƒ…å†µä¸‹ã€‚\n\nä¸ç®¡æ˜¯å“ªç§APIæˆ–æ˜¯å“ªç§è°ƒç”¨ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æ•°æ®æ¢ç´¢ï¼Œåªæ‰“å°ç»“æœé›†çš„ä¸€ä¸ªéå¸¸å°çš„å­é›†ã€‚å¯¹äºè¿™ç§Actionè¯·æ±‚ï¼ŒSparkå†…éƒ¨æœ‰ä¸ªä¼˜åŒ–æœºåˆ¶ï¼Œæˆ–è€…æˆ‘æ¥åé—®ä½ ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœä½ æ˜¯Sparkï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿä½ ä¼šæŠŠå…¨é‡ç»“æœé›†éƒ½è®¡ç®—å‡ºæ¥ï¼Œç„¶åä»ä¸­éšæœºæŒ‘å‡ºä¸€äº›å­é›†æ•°æ®è¿”å›å—ï¼Ÿè¿™ç¡®å®æ˜¯ä¸ªæ–¹é¢ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•å¤ªæ…¢äº†ï¼Œæˆ–è€…æ˜¯å¤ªæµªè´¹èµ„æºäº†ï¼Œæ²¡å¿…è¦ã€‚æ¯•ç«Ÿï¼Œç”¨æˆ·æƒ³è¦çš„ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªå­é›†ã€‚\n\nç›´æ¥è¯´ç»“è®ºå§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSparkä¼šâ€œå·æ‡’â€~ æ€ä¹ˆå·å‘¢ï¼Ÿå®ƒä¼šå°è¯•ç”¨å¤šä¸ªJobå»åšè¿™ä¸ªäº‹æƒ…ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ç”¨åœ¨DataFrameå»showæ•°æ®ï¼Œé»˜è®¤æ‰“å°20è¡Œã€‚é‚£ä¹ˆï¼ŒSparkçš„ç¬¬ä¸€ä¸ªJobï¼Œæ˜¯åªè¯»å–å¹¶è®¡ç®—æºæ•°æ®çš„æŸä¸€ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œç„¶åå°è¯•è®¡ç®—æœ€ç»ˆçš„æ•°æ®ç»“æœï¼Œçœ‹çœ‹æœ€ç»ˆèƒ½ä¸èƒ½showå‡ºæ¥20æ¡ã€‚ç”±äºè®¡ç®—è¿‡ç¨‹ä¸­æœ‰èšåˆã€è¿‡æ»¤ï¼Œæ‰€ä»¥å“ªæ€•ä½ ä¸€ä¸ªåˆ†ç‰‡æœ‰ä¸Šä¸‡æ¡è®°å½•ï¼Œåˆ°æœ€åï¼Œä½ è¿˜çœŸä¸ä¸€å®šèƒ½å‰©ä¸‹20æ¡ã€‚æ‰€ä»¥ï¼ŒSparkå‘ç°è‡ªå·±ç¬¬ä¸€æ¬¡å°è¯•å¤±è´¥äº†ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªJobæ²¡æœ‰è¾¾åˆ°é¢„æœŸã€‚\n\næ¥ä¸‹æ¥ï¼Œè¿™ä¸ªå®¶ä¼™å°±æƒ³ï¼šä¸€ä¸ªåˆ†ç‰‡ä¸è¡Œï¼Œæˆ‘å°±ç”¨ä¸¤ä¸ªã€‚äºæ˜¯ï¼Œå®ƒåˆè¯•äº†ä¸€æ¬¡ï¼Œå‘ç°ï¼Œç»“æœé›†è¿˜æ˜¯å‡‘ä¸å¤Ÿ20æ¡ã€‚Sparkå¿ƒæƒ³ï¼šéº»è›‹ï¼Œå±…ç„¶è¿˜ä¸å¤Ÿï¼Œé‚£æˆ‘å†è¯•ä¸€æ¬¡ï¼Œè¿™æ¬¡ç”¨4ä¸ªç”šè‡³æ˜¯8ä¸ªæ•°æ®åˆ†ç‰‡ï¼Œæˆ‘å°±ä¸ä¿¡æˆ‘å‡‘ä¸å¤Ÿã€‚å› æ­¤ï¼ŒSparkä¼šä¸€ç‚¹ä¸€ç‚¹åœ°å»è¯•ï¼Œç›´åˆ°ç»“æœé›†å¤§äºç­‰äº20æ¡ï¼Œå®ƒå°±ä¸å†è¯•äº†ï¼Œå› ä¸ºå·²ç»å®Œæˆä»»åŠ¡äº†ï¼šç»™ç”¨æˆ·è¾“å‡º20æ¡ç»“æœã€‚\n\nä½ çœ‹åˆ°çš„å¤šä¸ªJobï¼Œå°±æ˜¯Sparkåœ¨ä¸åœåœ°å°è¯•åŒä¸€ä¸ªäº‹æƒ…ï¼Œåªä¸è¿‡æœ‰äº›å¤±è´¥äº†ï¼Œæœ‰äº›æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œå¤±è´¥çš„é‚£äº›Jobï¼Œå®ƒä¸æ‰¿è®¤å®ƒå¤±è´¥äº†ï¼Œç»™æ ‡è®°æˆskippedä¹‹ç±»çš„â€”â€”ç®€ç›´æ˜¯æ— è€»ï¼Œå“ˆå“ˆå“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623402357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291098,"user_name":"kingcall","can_delete":false,"product_type":"c1","uid":1056982,"ip_address":"","ucode":"508884DC684B5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","comment_is_top":false,"comment_ctime":1620023057,"is_pvip":false,"replies":[{"id":"105480","content":"æ ‡å‡†ç­”æ¡ˆäº†ï¼Œæ»¡åˆ†ğŸ’¯~<br><br>å…³äºSMJå’ŒCPJçš„åˆ†æä¹Ÿå¾ˆåˆ°ä½ï¼Œå¯¹äºéç­‰å€¼Joinï¼Œå¦‚æœéè¦ç”¨SMJæ¥å®ç°è¡Œä¸è¡Œï¼Ÿå…¶å®ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚<br><br>ä½†å¦‚æœç»†æƒ³çš„è¯ï¼Œä½ ä¼šå‘ç°ï¼Œå¯¹äºéç­‰å€¼Joinæ¥è¯´ï¼Œå³ä¾¿ä½ æ‰“ç®—å°è¯•ç”¨SMJå»å®ç°ï¼Œæœ€ç»ˆå®ç°ä¸‹æ¥ä½ å‘ç°ç®—æ³•çš„å¤æ‚åº¦ï¼Œå’Œä½ ä½¿ç”¨Nested Loop JoinåŒå±‚forå¾ªç¯çš„ç®—æ³•æ˜¯ç­‰ä»·çš„ã€‚è€ŒSMJè¿˜æœ‰é¢å¤–çš„æ’åºå¼€é”€ï¼Œå› æ­¤é‡Œå¤–é‡Œç®—ä¸‹æ¥ï¼Œè¿˜ä¸å¦‚ç›´æ¥ç”¨NLJä¹Ÿå°±æ˜¯CPJæ¥å®ç°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620116006,"ip_address":"","comment_id":291098,"utype":1}],"discussion_count":4,"race_medal":0,"score":"35979761425","product_id":100073401,"comment_content":"å›ç­”é—®é¢˜ï¼š<br>ä¸ªäººè®¤ä¸ºæ²¡æœ‰å¿…è¦ï¼šå› ä¸ºè¢«å¹¿æ’­å‡ºå»çš„æ•°æ®é›†åˆéƒ½å¾ˆå°ï¼Œå¯ä»¥é€šè¿‡Hash æˆ–è€… Nested Loop æ¥å®ç°ï¼Œè€Œè¿™äºŒè€…ä¹‹é—´çš„åŒºåˆ«åœ¨äº<br>1. Hash ä¸»è¦é€‚ç”¨äºç­‰å€¼å…³è”<br>2. Nested Loop å°±å¯ä»¥ç”¨æ¥å®ç°ç¬›å¡å°”ç§¯æˆ–è€…æ˜¯ä¸ç­‰å€¼å…³è”<br>æé—®ï¼š<br>Sort Merge ä¸ªäººè®¤ä¸ºæ˜¯åœ¨å¤§æ•°æ®é‡ä¸‹å‚¬ç”Ÿå‡ºæ¥çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æƒ³ä¸é€šä¸ºä»€ä¹ˆåœ¨å¤§æ•°é‡çš„æƒ…å†µä¸‹ï¼Œ&gt; æˆ–è€…æ˜¯&lt; çš„è¿™ç§å…³è”ä¸ºä»€ä¹ˆä¼šé€€åŒ–æˆCartesianProductï¼Œè€Œä¸æ˜¯SortMergeJoin<br>å› ä¸ºæˆ‘è§‰å¾—è¿™ä¸ªæ—¶å€™ä½¿ç”¨SortMergeJoinè¿˜æ˜¯æ¯”CartesianProductå¥½çš„ï¼Œé™¤éæ˜¯!= è¿™æ ·çš„å…³è”ä½¿ç”¨CartesianProductï¼Œå½“ç„¶spark å¯èƒ½æ˜¯è€ƒè™‘åˆ°äº†æ’åºçš„æˆæœ¬<br>","like_count":8,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519373,"discussion_content":"æ ‡å‡†ç­”æ¡ˆäº†ï¼Œæ»¡åˆ†ğŸ’¯~\n\nå…³äºSMJå’ŒCPJçš„åˆ†æä¹Ÿå¾ˆåˆ°ä½ï¼Œå¯¹äºéç­‰å€¼Joinï¼Œå¦‚æœéè¦ç”¨SMJæ¥å®ç°è¡Œä¸è¡Œï¼Ÿå…¶å®ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚\n\nä½†å¦‚æœç»†æƒ³çš„è¯ï¼Œä½ ä¼šå‘ç°ï¼Œå¯¹äºéç­‰å€¼Joinæ¥è¯´ï¼Œå³ä¾¿ä½ æ‰“ç®—å°è¯•ç”¨SMJå»å®ç°ï¼Œæœ€ç»ˆå®ç°ä¸‹æ¥ä½ å‘ç°ç®—æ³•çš„å¤æ‚åº¦ï¼Œå’Œä½ ä½¿ç”¨Nested Loop JoinåŒå±‚forå¾ªç¯çš„ç®—æ³•æ˜¯ç­‰ä»·çš„ã€‚è€ŒSMJè¿˜æœ‰é¢å¤–çš„æ’åºå¼€é”€ï¼Œå› æ­¤é‡Œå¤–é‡Œç®—ä¸‹æ¥ï¼Œè¿˜ä¸å¦‚ç›´æ¥ç”¨NLJä¹Ÿå°±æ˜¯CPJæ¥å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620116006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","nickname":"aof","note":"","ucode":"5815D63C4926BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372219,"discussion_content":"å¤§äºæˆ–å°äºçš„è¿æ¥æƒ…å†µä¸‹ï¼Œå…¶å®æ’åºåè€Œå˜æ…¢äº†ï¼Œè¿˜æ˜¯CPJæ›´å¿«ä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620227446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1062864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","nickname":"aof","note":"","ucode":"5815D63C4926BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375925,"discussion_content":"åŒæ„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621870021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372219,"ip_address":""},"score":375925,"extra":""},{"author":{"id":1756909,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87rib33lhErnnkEsdfOJUDlDgHDs9Nic88FHU8s2feX6preYqR46TDsOMW7Eib6ddUyr0A/132","nickname":"æˆ‘çˆ±æé’±","note":"","ucode":"CBB1DF3ACE1026","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","nickname":"aof","note":"","ucode":"5815D63C4926BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570697,"discussion_content":"é”™ï¼éç­‰å€¼è¿æ¥ï¼Œé¡ºåºè¯»åœ¨æœ‰æ’åºçš„å½“ç„¶ä¼šåŠ é€Ÿï¼â€œè¿˜æ˜¯CPJæ›´å¿«ä¸€äº›â€æ˜¯èƒ¡è¯´å…«é“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651882589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372219,"ip_address":""},"score":570697,"extra":""}]}]},{"had_liked":false,"id":291131,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1620041687,"is_pvip":false,"replies":[{"id":"105490","content":"ç¬¬ä¸€ä¸ªï¼Œä¸åŒJoinå®ç°æœºåˆ¶çš„ç®—æ³•å¤æ‚åº¦åˆ†æå¾—æ²¡é—®é¢˜~<br><br>ç¬¬äºŒä¸ªï¼Œä¸¤ç§å®ç°æ–¹æ³•çš„å¤æ‚åº¦è®¡ç®—ä¹Ÿæ²¡é—®é¢˜~ <br><br>æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œé¢˜æ²¡è¯»æ‡‚~ [å…æ‚²] å’±ä»¬æ˜¯æƒ³é—®ï¼šä¸ºä»€ä¹ˆSpark SQLåœ¨6ç§Joinç­–ç•¥ä¸­ï¼Œåªæ”¯æŒæœ¬è®²ä¸­æåˆ°çš„5ç§ï¼Œè€Œæ²¡æœ‰å®ç°Broadcast SMJï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620121166,"ip_address":"","comment_id":291131,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14504943575","product_id":100073401,"comment_content":"ä¸€ã€ä»åŸç†å’Œå¤æ‚åº¦çœ‹(å‡è®¾å•èŠ‚ç‚¹å¤§è¡¨è§„æ¨¡m,å°è¡¨è§„æ¨¡n)<br>1ã€æ•°æ®åˆ†å‘:<br>      broadcastæŠŠæ•´ä¸ªå°è¡¨å‘é€åˆ°å¤§è¡¨æ•°æ®æ‰€åœ¨èŠ‚ç‚¹;<br>      shuffleå¤§å°è¡¨æŒ‰ç…§åŒæ ·çš„åˆ†åŒºæ–¹å¼ã€æ•°è¿›è¡Œæ•°æ®é‡æ–°          åˆ’åˆ†ã€‚<br>2ã€joinå®ç°<br>    hash joinå°è¡¨å»ºç«‹hashè¡¨ï¼Œå¤§è¡¨éå†;(æ—¶é—´å¤æ‚åº¦ä¸ºæ„å»ºhashè¡¨æ—¶é—´O(n)+å¤§å°è¡¨æ¯”è¾ƒæ—¶é—´O(m)*O(1)ï¼Œç©ºé—´å¤æ‚ä¾èµ–hash map)<br>    sort merge join å…ˆæ’åºï¼Œç„¶åé‡‡ç”¨MergeSortä¸­åˆå¹¶æ“ä½œè¿›è¡Œæ¯”è¾ƒ;(æ—¶é—´å¤æ‚åº¦ä¸º æ’åºæ—¶é—´max{O(m*lgm),O(n*lgn)} + å¤§å°è¡¨æ¯”è¾ƒæ—¶é—´O(m+n)ï¼Œå…¶å®æ—¶ç©ºå¤æ‚åº¦ä¾èµ–å…·ä½“æ’åºç®—æ³•ã€‚ã€‚ã€‚)<br>    nested loop joinå¤§å°è¡¨åŒå±‚forå¾ªç¯ä¾æ¬¡æ¯”è¾ƒã€‚O(mn)<br><br>äºŒã€BSMJåˆ†æ(å°è¡¨æ€»è§„æ¨¡N)<br>1.å®ç°<br>   1.1å°è¡¨å…ˆbroadcastï¼Œæ‰€æœ‰èŠ‚ç‚¹å†åˆ†åˆ«è¿›è¡Œæ’åºã€åˆå¹¶ã€‚<br>   1.2å°è¡¨å…ˆæ’åºå†broadcastï¼Œæœ€åä¸¤è¡¨è¿›è¡Œåˆå¹¶ã€‚<br>2.åŸå› <br>   2.1å…ˆbroadcastï¼Œå†æ’åºï¼Œæœ€åæ—¶ç›¸æ¯”BNLJå¤šäº†æ¯ä¸ªèŠ‚ç‚¹çš„O(N*lgN)å°è¡¨æ’åºè€—æ—¶;æœ€å¥½æ—¶max{O(N*lgN)ï¼ŒO(m*lgm)}+O(M+N)ä¸è§å¾—å°±ä¸€å®šæ¯”O(Mn)æ•ˆæœå¥½ã€‚<br>   2.2å¦‚æœå…ˆæ’åºï¼Œé‚£driverç«¯å°±éœ€è¦æ’åºè€—æ—¶O(N*lgN)ï¼Œdriverææœ‰å¯èƒ½æ˜¯æ•´ä¸ªé›†ç¾¤çš„ç“¶é¢ˆã€‚<br><br>ç£Šå“¥çœ‹çœ‹å“ªé‡Œæœ‰é—®é¢˜æ²¡","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519382,"discussion_content":"ç¬¬ä¸€ä¸ªï¼Œä¸åŒJoinå®ç°æœºåˆ¶çš„ç®—æ³•å¤æ‚åº¦åˆ†æå¾—æ²¡é—®é¢˜~\n\nç¬¬äºŒä¸ªï¼Œä¸¤ç§å®ç°æ–¹æ³•çš„å¤æ‚åº¦è®¡ç®—ä¹Ÿæ²¡é—®é¢˜~ \n\næœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œé¢˜æ²¡è¯»æ‡‚~ [å…æ‚²] å’±ä»¬æ˜¯æƒ³é—®ï¼šä¸ºä»€ä¹ˆSpark SQLåœ¨6ç§Joinç­–ç•¥ä¸­ï¼Œåªæ”¯æŒæœ¬è®²ä¸­æåˆ°çš„5ç§ï¼Œè€Œæ²¡æœ‰å®ç°Broadcast SMJï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620121166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303610,"user_name":"é‡‘è§’å¤§ç‹","can_delete":false,"product_type":"c1","uid":1259375,"ip_address":"","ucode":"DFBA85FB2FD0B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/6f/b3337e6d.jpg","comment_is_top":false,"comment_ctime":1626873138,"is_pvip":false,"replies":[{"id":"110174","content":"+-å¹¶æ²¡æœ‰ç‰¹æ®Šå«ä¹‰å“ˆï¼Œä¸»è¦å…³æ³¨æ•°å­—å’Œ*å·ã€‚åŒä¸€ä¸ªæ•°å­—çš„operatorsä»£è¡¨åŒä¸€ä¸ªStageï¼Œ*å·è¡¨ç¤ºé‡‡ç”¨äº†WSCGæ¥åšä»£ç ç”Ÿæˆã€‚+-æ›´å¤šçš„æ˜¯ä¸ºäº†ç¾è§‚ï¼Œç”¨äºæ–¹ä¾¿å±•ç¤ºç¼©è¿›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1627481184,"ip_address":"","comment_id":303610,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10216807730","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®Physical Plan ä¸­èŠ‚ç‚¹å‰çš„&quot;+-&quot;å·æœ‰å•¥ç‰¹æ®Šå«ä¹‰å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523756,"discussion_content":"+-å¹¶æ²¡æœ‰ç‰¹æ®Šå«ä¹‰å“ˆï¼Œä¸»è¦å…³æ³¨æ•°å­—å’Œ*å·ã€‚åŒä¸€ä¸ªæ•°å­—çš„operatorsä»£è¡¨åŒä¸€ä¸ªStageï¼Œ*å·è¡¨ç¤ºé‡‡ç”¨äº†WSCGæ¥åšä»£ç ç”Ÿæˆã€‚+-æ›´å¤šçš„æ˜¯ä¸ºäº†ç¾è§‚ï¼Œç”¨äºæ–¹ä¾¿å±•ç¤ºç¼©è¿›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627481184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313505,"user_name":"Hiway","can_delete":false,"product_type":"c1","uid":1169895,"ip_address":"","ucode":"3E97C70A04018C","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","comment_is_top":false,"comment_ctime":1632470672,"is_pvip":false,"replies":[{"id":"113592","content":"å¥½é—®é¢˜~<br><br>ShuffledHashJoinç¡®å®å’Œå¹¿æ’­æ²¡æœ‰æ¯›çº¿å…³ç³»ï¼Œä½ çš„ç†è§£æ˜¯å¯¹çš„~ è¿™é‡Œå…¶å®æŒºå‘çš„ï¼ŒautoBroadcastJoinThresholdè¿™ä¸ªé˜ˆå€¼æ”¾åœ¨canBuildLocalHashMapè¿™é‡Œï¼Œå¤ªå®¹æ˜“è®©äººäº§ç”Ÿå›°æƒ‘äº†ã€‚<br><br>æˆ‘è¯´è¯´æˆ‘çš„ç†è§£ï¼Œé¦–å…ˆï¼ŒShuffledHashJoinçš„å‰æï¼Œç¡®å®éœ€è¦ä¿è¯canBuildLocalHashMapè¿™ä¸ªæ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶çš„æœ¬è´¨å«ä¹‰ï¼Œæ˜¯æ¯ä¸€ä¸ªPartitionéƒ½å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆå“ˆå¸Œè¡¨çš„åˆ›å»ºï¼Œä»è€Œä¸å½±å“Hash Joinçš„è®¡ç®—é€»è¾‘ï¼ˆå…ˆBuildã€å†Probeï¼‰ã€‚<br><br>æ‰€ä»¥ï¼Œè¿™é‡ŒcanBuildLocalHashMapé™åˆ¶æ˜¯éœ€è¦é‡åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªé‡åŒ–ï¼Œæ¥é™åˆ¶æ•°æ®çš„æ•´ä½“å¤§å°ï¼Œä»è€Œæ»¡è¶³åˆšåˆšè¯´çš„é‚£ä¸ªå¯ä»¥buildå“ˆå¸Œè¡¨çš„å‰ææ¡ä»¶ã€‚<br><br>å…¶å®ï¼Œå®Œå…¨å¯ä»¥å•ç‹¬å®šä¹‰ã€å‘½åä¸€ä¸ªé…ç½®é¡¹ï¼Œæ¥ä¸“é—¨ç®¡è¿™ä¸ªäº‹å„¿ï¼Œä½†æ˜¯Sparkç¤¾åŒºå¤ç”¨äº†autoBroadcastJoinThresholdè¿™ä¸ªé…ç½®é¡¹ï¼Œéš¾å…è®©äººå®¹æ˜“äº§ç”Ÿè¯¯è§£ã€‚å…¶å®ä½ å¯ä»¥çœ‹åˆ°ï¼Œspark.sql.autoBroadcastJoinThreshold*spark.sql.shuffle.partitionsï¼Œè¿™ä¸ªä¹˜ç§¯ï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹äºæ•´ä½“æ•°æ®é›†å¤§å°çš„ä¸€ä¸ªé™åˆ¶ã€‚è€Œè¿™ä¸ªä¹˜ç§¯ï¼Œå®Œå…¨å¯ä»¥æœ‰å•ç‹¬çš„é…ç½®é¡¹æ¥æŒ‡å®šï¼Œæ¯”å¦‚ï¼šsinglePartitionSizeLimitç­‰ç­‰ï¼Œï¼ˆè¿™ä¸ªé…ç½®é¡¹æ˜¯æˆ‘çç¼–çš„ï¼Œæ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹ï¼Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹è¯´æ˜ï¼‰<br><br>å®é™…ä¸Šï¼Œå³ä¾¿æ»¡è¶³æ€»æ•°æ®é‡å°äºspark.sql.autoBroadcastJoinThreshold*spark.sql.shuffle.partitionsï¼ŒShuffledHashJoinåœ¨è¿è¡Œæ—¶ä¹Ÿæœ‰å¯èƒ½æŠ¥é”™ï¼Œå› ä¸ºè¿™æ˜¯æ€»é‡çš„é™åˆ¶ï¼Œä¸€æ—¦æŸäº›Partitionå‡ºç°å€¾æ–œã€æ’‘çˆ†å†…å­˜çš„æƒ…å†µï¼ŒShuffledHashJoinç…§æ ·failã€‚<br><br>ä»¥ä¸Šï¼Œå°±æ˜¯æˆ‘å¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£~ åç»­åœ¨è¯„è®ºåŒºå¯ä»¥ç»§ç»­è®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632558635,"ip_address":"","comment_id":313505,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5927437968","product_id":100073401,"comment_content":"è€å¸ˆä½ å¥½ï¼Œåœ¨2.4.3ä¸­ä½¿ç”¨ShuffledHashJoinçš„å‰ç½®æ¡ä»¶æœ‰ä¸€ä¸ªcanBuildLocalHashMapï¼Œå…¶è¦æ±‚å°±æ˜¯æ•°æ®å¤§å°è¦å°äºspark.sql.autoBroadcastJoinThreshold*spark.sql.shuffle.partitionsï¼Œæˆ‘æƒ³è¯·æ•™ä¸€ä¸‹è¿™é‡Œä¸ºä»€ä¹ˆéœ€è¦å°äºBroadcastçš„å¤§å°*sqlshuffleçš„åˆ†åŒºæ•°å‘¢ï¼Ÿä»ShuffledHashJoinçš„é€»è¾‘æ¥çœ‹ï¼Œåº”è¯¥ä¸æ¶‰åŠåˆ°Broadcastå‘€","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527373,"discussion_content":"å¥½é—®é¢˜~\n\nShuffledHashJoinç¡®å®å’Œå¹¿æ’­æ²¡æœ‰æ¯›çº¿å…³ç³»ï¼Œä½ çš„ç†è§£æ˜¯å¯¹çš„~ è¿™é‡Œå…¶å®æŒºå‘çš„ï¼ŒautoBroadcastJoinThresholdè¿™ä¸ªé˜ˆå€¼æ”¾åœ¨canBuildLocalHashMapè¿™é‡Œï¼Œå¤ªå®¹æ˜“è®©äººäº§ç”Ÿå›°æƒ‘äº†ã€‚\n\næˆ‘è¯´è¯´æˆ‘çš„ç†è§£ï¼Œé¦–å…ˆï¼ŒShuffledHashJoinçš„å‰æï¼Œç¡®å®éœ€è¦ä¿è¯canBuildLocalHashMapè¿™ä¸ªæ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶çš„æœ¬è´¨å«ä¹‰ï¼Œæ˜¯æ¯ä¸€ä¸ªPartitionéƒ½å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆå“ˆå¸Œè¡¨çš„åˆ›å»ºï¼Œä»è€Œä¸å½±å“Hash Joinçš„è®¡ç®—é€»è¾‘ï¼ˆå…ˆBuildã€å†Probeï¼‰ã€‚\n\næ‰€ä»¥ï¼Œè¿™é‡ŒcanBuildLocalHashMapé™åˆ¶æ˜¯éœ€è¦é‡åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªé‡åŒ–ï¼Œæ¥é™åˆ¶æ•°æ®çš„æ•´ä½“å¤§å°ï¼Œä»è€Œæ»¡è¶³åˆšåˆšè¯´çš„é‚£ä¸ªå¯ä»¥buildå“ˆå¸Œè¡¨çš„å‰ææ¡ä»¶ã€‚\n\nå…¶å®ï¼Œå®Œå…¨å¯ä»¥å•ç‹¬å®šä¹‰ã€å‘½åä¸€ä¸ªé…ç½®é¡¹ï¼Œæ¥ä¸“é—¨ç®¡è¿™ä¸ªäº‹å„¿ï¼Œä½†æ˜¯Sparkç¤¾åŒºå¤ç”¨äº†autoBroadcastJoinThresholdè¿™ä¸ªé…ç½®é¡¹ï¼Œéš¾å…è®©äººå®¹æ˜“äº§ç”Ÿè¯¯è§£ã€‚å…¶å®ä½ å¯ä»¥çœ‹åˆ°ï¼Œspark.sql.autoBroadcastJoinThreshold*spark.sql.shuffle.partitionsï¼Œè¿™ä¸ªä¹˜ç§¯ï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹äºæ•´ä½“æ•°æ®é›†å¤§å°çš„ä¸€ä¸ªé™åˆ¶ã€‚è€Œè¿™ä¸ªä¹˜ç§¯ï¼Œå®Œå…¨å¯ä»¥æœ‰å•ç‹¬çš„é…ç½®é¡¹æ¥æŒ‡å®šï¼Œæ¯”å¦‚ï¼šsinglePartitionSizeLimitç­‰ç­‰ï¼Œï¼ˆè¿™ä¸ªé…ç½®é¡¹æ˜¯æˆ‘çç¼–çš„ï¼Œæ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹ï¼Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹è¯´æ˜ï¼‰\n\nå®é™…ä¸Šï¼Œå³ä¾¿æ»¡è¶³æ€»æ•°æ®é‡å°äºspark.sql.autoBroadcastJoinThreshold*spark.sql.shuffle.partitionsï¼ŒShuffledHashJoinåœ¨è¿è¡Œæ—¶ä¹Ÿæœ‰å¯èƒ½æŠ¥é”™ï¼Œå› ä¸ºè¿™æ˜¯æ€»é‡çš„é™åˆ¶ï¼Œä¸€æ—¦æŸäº›Partitionå‡ºç°å€¾æ–œã€æ’‘çˆ†å†…å­˜çš„æƒ…å†µï¼ŒShuffledHashJoinç…§æ ·failã€‚\n\nä»¥ä¸Šï¼Œå°±æ˜¯æˆ‘å¯¹è¿™ä¸ªé—®é¢˜çš„ç†è§£~ åç»­åœ¨è¯„è®ºåŒºå¯ä»¥ç»§ç»­è®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632558635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1418226,"avatar":"https://static001.geekbang.org/account/avatar/00/15/a3/f2/ab8c5183.jpg","nickname":"Sampson","note":"","ucode":"BA78CA29A6D898","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549771,"discussion_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œæˆ‘æƒ³å°±ç€è¿™ä¸ªé—®é¢˜ï¼Œå†è¯·æ•™ä¸‹ï¼Œå‚æ•° spark.sql.autoBroadcastJoinThreshold æ˜¯æŒ‡çš„æ¯ä¸ªåˆ†åŒºçš„æ•°æ®å°äºç­‰äºè¿™ä¸ªé˜€å€¼æ‰å¹¿æ’­å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644231600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1169895,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","nickname":"Hiway","note":"","ucode":"3E97C70A04018C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407890,"discussion_content":"ååˆ†æ„Ÿè°¢è€å¸ˆï¼Œæˆ‘è‡ªå·±éƒ½å¿˜è®°äº†æˆ‘é—®äº†è¿™ä¸ªé—®é¢˜ï¼Œéš”äº†åŠä¸ªæœˆäºŒåˆ·è¿™ä¸ªè¯¾ç¨‹çš„æ—¶å€™æ‰çœ‹åˆ°æˆ‘è‡ªå·±çš„é—®é¢˜ã€‚ç»™æå®¢æ—¶é—´æä¸ªå»ºè®®ï¼Œè¿™ç§è€å¸ˆå›å¤äº†è¯¾ç¨‹è¯„è®ºçš„æƒ…å†µèƒ½ä¸èƒ½åœ¨ä¸ªäººä¿¡æ¯é‚£æ˜¾ç¤ºä¸ªçº¢ç‚¹ä»€ä¹ˆçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635145255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291362,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1620227265,"is_pvip":false,"replies":[{"id":"105533","content":"æ­£è§£ï¼Œæ»¡åˆ† ğŸ’¯ ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620265852,"ip_address":"","comment_id":291362,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5915194561","product_id":100073401,"comment_content":"broadcastå¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ’åºæ²¡å•¥å¿…è¦å§ï¼Œå› ä¸ºæœ¬èº«è¢«å¹¿æ’­çš„æ•°æ®é›†å°±æ¯”è¾ƒå°ï¼Œhash joinå’ŒNLJå®Œå…¨å¤Ÿç”¨äº†ã€‚è€Œä¸”SMJæœ¬èº«å°±æ˜¯é’ˆå¯¹å¤§è¡¨å…³è”å¤§è¡¨è®¾è®¡çš„joinç®—æ³•","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519449,"discussion_content":"æ­£è§£ï¼Œæ»¡åˆ† ğŸ’¯ ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620265852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358657,"user_name":"travi","can_delete":false,"product_type":"c1","uid":1078362,"ip_address":"å¹¿ä¸œ","ucode":"B9EDFC8A1F3BF2","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/5a/b6934700.jpg","comment_is_top":false,"comment_ctime":1664521432,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664521432","product_id":100073401,"comment_content":"è¯·é—®ï¼šdf.explain()å±•ç¤ºçš„æ˜¯Physical Plan, æ–‡ä¸­çš„Spark Planæ˜¯é€šè¿‡ä»€ä¹ˆå·¥å…·å±•ç¤ºå‡ºæ¥çš„å‘¢","like_count":0},{"had_liked":false,"id":352964,"user_name":"Sampson","can_delete":false,"product_type":"c1","uid":1418226,"ip_address":"é™•è¥¿","ucode":"BA78CA29A6D898","user_header":"https://static001.geekbang.org/account/avatar/00/15/a3/f2/ab8c5183.jpg","comment_is_top":false,"comment_ctime":1659057496,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1659057496","product_id":100073401,"comment_content":"ç£Šå“¥ï¼Œè¿™é‡Œæœ‰ä¸ªç–‘é—®è¯·æ•™ä¸‹ï¼Œåœ¨ä¸Šä¸€å¼ Catalysté€»è¾‘è®¡åˆ’ä¸­é€»è¾‘è®¡åˆ’ä¼˜åŒ–é˜¶æ®µä¸»è¦ä¾èµ–AQE ç­‰3é¡¹ï¼Œé‚£ä¹ˆAQE ä¸­çš„joinç­–ç•¥è°ƒæ•´å’Œè¿™é‡Œçš„ç‰©ç†è®¡åˆ’ä¸­ç”ŸæˆSpark plan ä¸­joinç­–ç•¥çš„é€‰æ‹©æœ‰ä»€ä¹ˆå¼‚åŒå— ï¼Ÿè¿˜æ˜¯è¯´é’ˆå¯¹çš„ç‚¹ä¸åŒ ï¼Ÿ","like_count":0},{"had_liked":false,"id":330373,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1641956786,"is_pvip":false,"replies":[{"id":"120666","content":"è¿™é‡Œçš„jobï¼Œå…¶å®å°±æ˜¯stageï¼Œä¸€ä¸ªqueryæ‰æ˜¯ä¸€ä¸ªjobï¼Œæˆ‘è§‰å¾—åº”è¯¥æ˜¯spark uiçš„bugï¼Œè€å¼Ÿå¯ä»¥ç»™ç¤¾åŒºæä¸ªticketï¼Œå“ˆå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1642243397,"ip_address":"","comment_id":330373,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641956786","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ æƒ³é—®ä¸€ä¸‹æˆ‘æœ‰ä¸ª hive sql åªæ˜¯æ‰§è¡Œäº†ä¸€ä¸ª insert overwrite select a join b çš„æ“ä½œï¼Œspark æ—¥å¿—å´æœ‰6ä¸ªjobï¼Œç‚¹è¿›äºŒçº§é“¾æ¥ååœ¨dag visualizationä¸­å¯ä»¥çœ‹åˆ°ï¼š<br>job0ï¼šWSCGç„¶åsort; <br>job1ï¼šWSCGç„¶åexchangeï¼›<br>job2ï¼šexchange =&gt; WSCG =&gt; exchange<br>job3ï¼šexchange =&gt; hash aggregate =&gt;sort<br>job4ï¼šparallelize<br>job5:  parallelize<br>æˆ‘æƒ³è¯·æ•™ä¸€ä¸‹ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šjobå‘¢ï¼Ÿå¦å¤–åœ¨sqlé¡µé¢æ˜¾ç¤ºçš„æ˜¯completed queriesï¼Œè¿™ä¸ªqueryåˆæ˜¯ä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿå’Œjobæ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿè°¢è°¢è€å¸ˆ~","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546230,"discussion_content":"è¿™é‡Œçš„jobï¼Œå…¶å®å°±æ˜¯stageï¼Œä¸€ä¸ªqueryæ‰æ˜¯ä¸€ä¸ªjobï¼Œæˆ‘è§‰å¾—åº”è¯¥æ˜¯spark uiçš„bugï¼Œè€å¼Ÿå¯ä»¥ç»™ç¤¾åŒºæä¸ªticketï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642243397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320373,"user_name":"Hiway","can_delete":false,"product_type":"c1","uid":1169895,"ip_address":"","ucode":"3E97C70A04018C","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","comment_is_top":false,"comment_ctime":1636281651,"is_pvip":false,"replies":[{"id":"116288","content":"ä½ è¯´çš„å¯¹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé€»è¾‘é˜¶æ®µçš„ä¼˜åŒ–ï¼ŒåŸºäºå¯å‘å¼çš„è§„åˆ™ï¼›è€Œç‰©ç†é˜¶æ®µçš„ä¼˜åŒ–ï¼Œå…¶å®åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åƒä½ è¯´çš„ï¼Œç›´æ¥æŠŠé€»è¾‘æ“ä½œç¬¦ï¼Œæ˜ å°„ä¸ºç‰©ç†æ“ä½œç¬¦ï¼Œæ¯”å¦‚åƒProjectï¼ˆSelectï¼‰ã€Filterï¼ˆWhereï¼‰ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç›´æ¥æ˜ å°„ï¼Œæ˜¯å› ä¸ºè¿™ç±»æ“ä½œæ²¡ä»€ä¹ˆå¥½ä¼˜åŒ–çš„ï¼›<br><br>ä½†æ˜¯ï¼Œå¦ä¸€ç±»å°±ä¸åŒäº†ï¼Œå°±æ˜¯è¯¾ç¨‹ä¸­åˆ—å‡ºçš„é‚£äº›ï¼Œä¼˜åŒ–ç©ºé—´æ¯”è¾ƒå¤§ï¼Œä¼˜åŒ–è¿‡åï¼Œæ€§èƒ½ä¼šæœ‰è¾ƒå¤§æ”¶ç›Šçš„é‚£ä¸€ç±»ç­–ç•¥ï¼ˆStrategiesï¼‰ã€‚<br><br>å…¶å®æ€ä¹ˆç§°å‘¼æ²¡é‚£ä¹ˆé‡è¦å“ˆï¼Œé‡è¦çš„æ˜¯ï¼Œå¤§å®¶åªè¦ç†è§£è¿™ä¸ªä¼˜åŒ–è¿‡ç¨‹ï¼Œç„¶åèƒ½æœ‰çš„æ”¾çŸ¢åœ°åšä¼˜åŒ–å°±å¥½~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1636435659,"ip_address":"","comment_id":320373,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1636281651","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæˆ‘è§‰å¾—ä¼˜åŒ–Spark Joinè¿™ä¸€æ­¥å«æˆä¼˜åŒ–ä¸å¤ªå¥½ï¼Œå®é™…ä¸Šè¿™ä¸€æ­¥æ˜¯æ ¹æ®é€»è¾‘è®¡åˆ’ä¸­çš„å…³ç³»æ“ä½œç¬¦ä¸€ä¸€æ˜ å°„æˆç‰©ç†æ“ä½œç¬¦ï¼Œç”Ÿæˆ Spark Planã€‚æˆ‘è¯»äº†æºç å‘ç°å…¶å®spark planå°±æ˜¯physical planã€‚è¿™ä¸¤æ­¥ç†è§£ä¸ºæ ¹æ®ç­–ç•¥Strategiesç”Ÿæˆspark planï¼Œå’Œæ ¹æ®Rulesä¼˜åŒ–spark planæ›´å½¢è±¡ä¸€ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529971,"discussion_content":"ä½ è¯´çš„å¯¹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé€»è¾‘é˜¶æ®µçš„ä¼˜åŒ–ï¼ŒåŸºäºå¯å‘å¼çš„è§„åˆ™ï¼›è€Œç‰©ç†é˜¶æ®µçš„ä¼˜åŒ–ï¼Œå…¶å®åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åƒä½ è¯´çš„ï¼Œç›´æ¥æŠŠé€»è¾‘æ“ä½œç¬¦ï¼Œæ˜ å°„ä¸ºç‰©ç†æ“ä½œç¬¦ï¼Œæ¯”å¦‚åƒProjectï¼ˆSelectï¼‰ã€Filterï¼ˆWhereï¼‰ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç›´æ¥æ˜ å°„ï¼Œæ˜¯å› ä¸ºè¿™ç±»æ“ä½œæ²¡ä»€ä¹ˆå¥½ä¼˜åŒ–çš„ï¼›\n\nä½†æ˜¯ï¼Œå¦ä¸€ç±»å°±ä¸åŒäº†ï¼Œå°±æ˜¯è¯¾ç¨‹ä¸­åˆ—å‡ºçš„é‚£äº›ï¼Œä¼˜åŒ–ç©ºé—´æ¯”è¾ƒå¤§ï¼Œä¼˜åŒ–è¿‡åï¼Œæ€§èƒ½ä¼šæœ‰è¾ƒå¤§æ”¶ç›Šçš„é‚£ä¸€ç±»ç­–ç•¥ï¼ˆStrategiesï¼‰ã€‚\n\nå…¶å®æ€ä¹ˆç§°å‘¼æ²¡é‚£ä¹ˆé‡è¦å“ˆï¼Œé‡è¦çš„æ˜¯ï¼Œå¤§å®¶åªè¦ç†è§£è¿™ä¸ªä¼˜åŒ–è¿‡ç¨‹ï¼Œç„¶åèƒ½æœ‰çš„æ”¾çŸ¢åœ°åšä¼˜åŒ–å°±å¥½~","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636435659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1169895,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","nickname":"Hiway","note":"","ucode":"3E97C70A04018C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":531434,"discussion_content":"æ˜ç™½äº†ï¼Œå…¶å®ç¬¬ä¸€æ­¥ä¹Ÿæ˜¯æœ‰ä¼˜åŒ–çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637310895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":529971,"ip_address":""},"score":531434,"extra":"{\"user_type\":1}"}]}]},{"had_liked":false,"id":302049,"user_name":"é™ˆå¨æ´‹","can_delete":false,"product_type":"c1","uid":2264679,"ip_address":"","ucode":"DCF84B4D3A7354","user_header":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","comment_is_top":false,"comment_ctime":1626055002,"is_pvip":false,"replies":[{"id":"109466","content":"æ„Ÿè°¢è€å¼Ÿæé†’~ è¿™é‡Œæ¼äº†ä¸€ä¸ªå­—ï¼Œåº”è¯¥æ˜¯æ“ä½œã€‚<br><br>â€œæ‹¬å·ä¸­æ•°å­—ç›¸åŒçš„æ“ä½œâ€ï¼Œæˆ‘è®©ç¼–è¾‘å¸®å¿™æ”¹ä¸‹~ ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1626250835,"ip_address":"","comment_id":302049,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1626055002","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæ—©ä¸Šå¥½ï¼~<br><br>æœ¬æ–‡ä¸­å‡ºç°ä¸€å¥ï¼šâ€œæ‹¬å·ä¸­æ•°å­—ç›¸åŒçš„æ“â€ï¼Œè¿™é‡Œçš„â€œæ“â€ï¼Œæ˜¯å€¼çš„æ„æ€å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523159,"discussion_content":"æ„Ÿè°¢è€å¼Ÿæé†’~ è¿™é‡Œæ¼äº†ä¸€ä¸ªå­—ï¼Œåº”è¯¥æ˜¯æ“ä½œã€‚\n\nâ€œæ‹¬å·ä¸­æ•°å­—ç›¸åŒçš„æ“ä½œâ€ï¼Œæˆ‘è®©ç¼–è¾‘å¸®å¿™æ”¹ä¸‹~ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626250835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2264679,"avatar":"https://static001.geekbang.org/account/avatar/00/22/8e/67/afb412fb.jpg","nickname":"é™ˆå¨æ´‹","note":"","ucode":"DCF84B4D3A7354","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384160,"discussion_content":"å“ˆå“ˆï¼Œç£Šå“¥è¯·åƒé¥­å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626407556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296346,"user_name":"å°äººç‰©","can_delete":false,"product_type":"c1","uid":1101200,"ip_address":"","ucode":"51989AA20FF34A","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/90/af47197b.jpg","comment_is_top":false,"comment_ctime":1622909221,"is_pvip":false,"replies":[{"id":"107688","content":"å…ˆè¯´ä¸€ä¸ªåº”ç”¨ä¸­çš„jobæ•°é‡ï¼Œè¿™ä¸ªå…¶å®ä¸éœ€è¦å»æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæˆ–æ˜¯Spark UIä¸­çš„DAGï¼Œä»…ä»ä»£ç å°±èƒ½çœ‹å¾—å‡ºæ¥ã€‚æ¯ä¸ªActionéƒ½å¯¹åº”ç€ä¸€ä¸ªJobã€‚ä¸è®ºä½ æœ‰å¤šå°‘SQLã€SQLæœ‰å¤šå¤æ‚ï¼Œå¦‚æœæœ€ååªæœ‰ä¸€ä¸ªactionï¼Œæ¯”å¦‚æŠŠæŸ¥è¯¢ç»“æœä¿å­˜åˆ°HDFSï¼Œé‚£ä¹ˆå…¶å®æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªJobã€‚<br><br>å†æ¥è¯´Stageä¹‹é—´å¹¶è¡Œè®¡ç®—çš„é—®é¢˜ï¼Œåœ¨ä¸€ä¸ªJobå†…éƒ¨ï¼Œå³ä¾¿ä¸¤ä¸ªStageæ²¡æœ‰ä¾èµ–å…³ç³»ï¼ŒSparkåœ¨åšä»»åŠ¡è°ƒåº¦çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šè¿˜æ˜¯æŒ‰ç…§ä¸²è¡Œçš„æ¨¡å¼æ¥è°ƒåº¦ä»»åŠ¡çš„ï¼Œè¿™ä¸ªè·Ÿä»»åŠ¡çš„å¹¶è¡Œæ‰§è¡Œæ˜¯ä¸¤ç äº‹ã€‚æ¢å¥è¯è¯´ï¼ŒStageçš„è°ƒåº¦æ˜¯ä¸²è¡Œçš„ï¼Œä½†æ˜¯ï¼ŒStageå†…éƒ¨çš„ä»»åŠ¡ï¼Œæ˜¯åˆ†å¸ƒå¼å¹¶è¡Œæ‰§è¡Œçš„ã€‚<br><br>Stageä¹‹é—´çš„å¹¶è¡Œæ‰§è¡Œï¼Œå¾€å¾€æŒ‡çš„æ˜¯å­˜åœ¨äºä¸åŒJobä¹‹ä¸­çš„Stagesã€‚æ¯”å¦‚ï¼ŒJob1çš„Stage1ï¼Œå’ŒJob2çš„Stage1ï¼Œä»–ä»¬ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„æ‰§è¡Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±æ•´ä¸ªé›†ç¾¤æ¥è¯´ï¼Œä»–ä»¬ä¹‹é—´æ˜¯å­˜åœ¨ç«äº‰å…³ç³»çš„ã€‚ä¸è¿‡ï¼Œå¼€å‘è€…å¯ä»¥ç»™ä¸åŒçš„JobæŒ‡å®šè°ƒåº¦é˜Ÿåˆ—ï¼Œæ¯ä¸ªè°ƒåº¦é˜Ÿåˆ—å¯ä»¥å¯¹èµ„æºè¿›è¡Œé™åˆ¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªJobã€ä»¥åŠå…¶ä¸­çš„Stageï¼Œèƒ½å¤Ÿè·å–åˆ°çš„æ‰§è¡Œèµ„æºï¼Œå°±å¯ä»¥è¢«é‡åŒ–åœ°é™åˆ¶èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯æŠŠèµ„æºæ¶ˆè€—ï¼Œé™åˆ¶åœ¨â€œç¬¼å­â€é‡Œ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1623054204,"ip_address":"","comment_id":296346,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1622909221","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜æƒ³è¯·æ•™ï¼š<br>1ï¼Œèƒ½å¦é€šè¿‡æŸ¥çœ‹ç‰©ç†æ‰§è¡Œè®¡åˆ’åˆ¤æ–­å“ªäº›stageå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶è¡Œæ‰§è¡Œæ˜¯å¦æœ‰å¯¹åº”çš„è§¦å‘å‰ç½®æ¡ä»¶ï¼Ÿ<br>2ï¼Œèƒ½å¦é€šè¿‡æŸ¥çœ‹ç‰©ç†æ‰§è¡Œè®¡åˆ’åˆ¤æ–­è¯¥sqlä¼šç”Ÿæˆçš„jobæ•°ï¼Œå¦‚æœå¯ä»¥è¯¥å¦‚ä½•å»é˜…è¯»å¾—åˆ°åº”è¯¥æœ‰å‡ ä¸ªjobï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521405,"discussion_content":"å…ˆè¯´ä¸€ä¸ªåº”ç”¨ä¸­çš„jobæ•°é‡ï¼Œè¿™ä¸ªå…¶å®ä¸éœ€è¦å»æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæˆ–æ˜¯Spark UIä¸­çš„DAGï¼Œä»…ä»ä»£ç å°±èƒ½çœ‹å¾—å‡ºæ¥ã€‚æ¯ä¸ªActionéƒ½å¯¹åº”ç€ä¸€ä¸ªJobã€‚ä¸è®ºä½ æœ‰å¤šå°‘SQLã€SQLæœ‰å¤šå¤æ‚ï¼Œå¦‚æœæœ€ååªæœ‰ä¸€ä¸ªactionï¼Œæ¯”å¦‚æŠŠæŸ¥è¯¢ç»“æœä¿å­˜åˆ°HDFSï¼Œé‚£ä¹ˆå…¶å®æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªJobã€‚\n\nå†æ¥è¯´Stageä¹‹é—´å¹¶è¡Œè®¡ç®—çš„é—®é¢˜ï¼Œåœ¨ä¸€ä¸ªJobå†…éƒ¨ï¼Œå³ä¾¿ä¸¤ä¸ªStageæ²¡æœ‰ä¾èµ–å…³ç³»ï¼ŒSparkåœ¨åšä»»åŠ¡è°ƒåº¦çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šè¿˜æ˜¯æŒ‰ç…§ä¸²è¡Œçš„æ¨¡å¼æ¥è°ƒåº¦ä»»åŠ¡çš„ï¼Œè¿™ä¸ªè·Ÿä»»åŠ¡çš„å¹¶è¡Œæ‰§è¡Œæ˜¯ä¸¤ç äº‹ã€‚æ¢å¥è¯è¯´ï¼ŒStageçš„è°ƒåº¦æ˜¯ä¸²è¡Œçš„ï¼Œä½†æ˜¯ï¼ŒStageå†…éƒ¨çš„ä»»åŠ¡ï¼Œæ˜¯åˆ†å¸ƒå¼å¹¶è¡Œæ‰§è¡Œçš„ã€‚\n\nStageä¹‹é—´çš„å¹¶è¡Œæ‰§è¡Œï¼Œå¾€å¾€æŒ‡çš„æ˜¯å­˜åœ¨äºä¸åŒJobä¹‹ä¸­çš„Stagesã€‚æ¯”å¦‚ï¼ŒJob1çš„Stage1ï¼Œå’ŒJob2çš„Stage1ï¼Œä»–ä»¬ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„æ‰§è¡Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±æ•´ä¸ªé›†ç¾¤æ¥è¯´ï¼Œä»–ä»¬ä¹‹é—´æ˜¯å­˜åœ¨ç«äº‰å…³ç³»çš„ã€‚ä¸è¿‡ï¼Œå¼€å‘è€…å¯ä»¥ç»™ä¸åŒçš„JobæŒ‡å®šè°ƒåº¦é˜Ÿåˆ—ï¼Œæ¯ä¸ªè°ƒåº¦é˜Ÿåˆ—å¯ä»¥å¯¹èµ„æºè¿›è¡Œé™åˆ¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªJobã€ä»¥åŠå…¶ä¸­çš„Stageï¼Œèƒ½å¤Ÿè·å–åˆ°çš„æ‰§è¡Œèµ„æºï¼Œå°±å¯ä»¥è¢«é‡åŒ–åœ°é™åˆ¶èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯æŠŠèµ„æºæ¶ˆè€—ï¼Œé™åˆ¶åœ¨â€œç¬¼å­â€é‡Œ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623054204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2703669,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/mib2Rr1TIUNS8rA25GeZlNSYp7JzeODolia9PrXqXFrkslE2q6MU4GKZG5dhEHx2qITqVhodhOLt10UbicZ4pVt3g/132","nickname":"ç½—å›½å¯Œ","note":"","ucode":"E3E4F5128BD809","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387493,"discussion_content":"è²Œä¼¼ä¸åŒjobçš„Stageæ˜¯ä¸ä¼šåŒåçš„å§ï¼Ÿå¦‚æœæœ‰ä¸¤ä¸ªjobï¼Œæœ‰ä¸€ä¸ªé‡Œé¢æœ‰stage 0ï¼Œå¦ä¸€ä¸ªjobæœ€æ—©æ‰§è¡Œçš„stage ä¹Ÿåº”è¯¥æ˜¯ä»1å¼€å§‹çš„å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628214810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101200,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cd/90/af47197b.jpg","nickname":"å°äººç‰©","note":"","ucode":"51989AA20FF34A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378250,"discussion_content":"è°¢è°¢è€å¸ˆï¼Œspark sqlåœ¨å“ªå„¿å¯ä»¥æŸ¥åˆ°è¿™ä¸ªè¯­å¥æˆ–ç®—å­æ˜¯actionè¿˜æ˜¯trasformationå‘¢ï¼Ÿä¾‹å¦‚sumï¼ˆï¼‰ï¼Œselect","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623124729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1101200,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cd/90/af47197b.jpg","nickname":"å°äººç‰©","note":"","ucode":"51989AA20FF34A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378828,"discussion_content":"RDDçš„APIï¼Œè¿™é‡Œæœ‰ç®—å­å…¨é›†ï¼šhttps://spark.apache.org/docs/latest/rdd-programming-guide.html#transformations\né‡Œé¢å›Šæ‹¬äº†æ‰€æœ‰çš„Transformationå’ŒActionç®—å­ã€‚\n\nSpark SQLçš„è¯ï¼Œæ¯”å¦‚SQLæŸ¥è¯¢è¯­å¥ï¼Œæˆ–æ˜¯DSLæŸ¥è¯¢è¯­è¨€ï¼Œå…¶å®å¹¶æ²¡æœ‰Transformationå’ŒActionçš„æ¦‚å¿µï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯ä¸€ç§æè¿°è¯­è¨€ï¼Œæ‰€æœ‰çš„æ“ä½œåœ¨Sparkçœ‹æ¥éƒ½æ˜¯è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯Transformationsï¼Œæ¯”å¦‚ä½ è¯´çš„sumã€selectã€groupbyï¼Œç­‰ç­‰è¿™äº›ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯å„ç§è½¬æ¢ã€‚SQLä¹Ÿå¥½ã€DataFrameä¹Ÿå¥½ï¼Œè¿™äº›æŸ¥è¯¢è¯­å¥åªæœ‰ç»è¿‡Spark SQLä¼˜åŒ–ï¼ˆå…¶ä¸­åŒ…æ‹¬Catalystå’ŒTungstenï¼‰ï¼Œæœ€ç»ˆè½¬åŒ–æˆRDDå»æ‰§è¡Œï¼Œæ‰çœŸçš„æ˜¯è§¦å‘è¿è¡Œæ—¶çš„æ‰§è¡Œã€‚Transformationå’ŒActionåŸæ¥ç‰¹æŒ‡çš„ï¼Œå°±æ˜¯RDD APIï¼Œåªä¸è¿‡åæ¥é™¤äº†Spark SQLï¼Œå¤§å®¶ä¹Ÿæ²¡æœ‰ç‰¹åˆ«åŒºåˆ†~ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623422315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":378250,"ip_address":""},"score":378828,"extra":""}]}]},{"had_liked":false,"id":293834,"user_name":"kris37","can_delete":false,"product_type":"c1","uid":1179297,"ip_address":"","ucode":"65555B42CFF0A1","user_header":"","comment_is_top":false,"comment_ctime":1621571895,"is_pvip":true,"replies":[{"id":"106656","content":"ä»æºç çœ‹æ˜¯æ”¯æŒçš„~ <br><br>Spark branch: master<br>æ–‡ä»¶ï¼šorg.apache.spark.sql.execution.joins.ShuffledHashJoinExec.scalaï¼›<br>LOCï¼šline 82-131","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621726055,"ip_address":"","comment_id":293834,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1621571895","product_id":100073401,"comment_content":"shuffle hash join æ¡ä»¶å¹¶ä¸æ”¯æŒ full outer join ï¼ˆä¸çŸ¥é“Spark3æ˜¯å¦æœ‰æ”¯æŒ full outer join çš„hash join å®ç°ï¼ŒFBæä¾›çš„PRï¼Ÿï¼‰ï¼Œè¿™å—è€å¸ˆè¦ä¿®æ”¹ä¸‹è¡¨æ ¼ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520386,"discussion_content":"ä»æºç çœ‹æ˜¯æ”¯æŒçš„~ \n\nSpark branch: master\næ–‡ä»¶ï¼šorg.apache.spark.sql.execution.joins.ShuffledHashJoinExec.scalaï¼›\nLOCï¼šline 82-131","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621726055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179297,"avatar":"","nickname":"kris37","note":"","ucode":"65555B42CFF0A1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375702,"discussion_content":"é‚£çœ‹æ¥facebookçš„prå·²åˆå…¥äº† å¤šè°¢è€å¸ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621822362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291196,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1620111294,"is_pvip":false,"replies":[{"id":"105485","content":"ç¬¬ä¸€é¢˜å¯ä»¥å‚è€ƒkingcallåŒå­¦çš„ç­”æ¡ˆå“ˆ~<br><br>åé¢çš„æé—®æ˜¯ä¸ªå¥½é—®é¢˜ã€‚é€»è¾‘ä¼˜åŒ–ã€ç‰©ç†ä¼˜åŒ–ã€Tungstenä¼˜åŒ–ï¼Œæ˜¯Spark SQLæ™ºèƒ½å¤§è„‘çš„â€œä¸‰æ‹›ä¸€å¥—â€ï¼Œè¿™3éƒ¨åˆ†å°±æ˜¯åœ¨è®²ï¼Œä¸€ä»½ä»£ç ï¼ˆDataFrameã€Datasetã€SQLï¼‰æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¢«ä¼˜åŒ–ã€æœ€ç»ˆè¢«èåˆæˆä¸€ä»½â€œæ‰‹å†™ä»£ç â€ï¼Œç„¶åäº¤ä»˜DAGScheduleråšåˆ†å¸ƒå¼æ‰§è¡Œã€‚åœ¨æ¥ä¸‹æ¥çš„23è®²ï¼Œå’±ä»¬é‡ç‚¹å…³æ³¨Tungstenä¼˜åŒ–ç¯èŠ‚ï¼Œä¹Ÿä¼šç€é‡è§£é‡Šâ€œæ‰‹å†™ä»£ç â€å’Œâ€œRDDè¿­ä»£å™¨åµŒå¥—â€ä¹‹é—´çš„æœ¬è´¨åŒºåˆ«ï¼Œæ•¬è¯·æœŸå¾…å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620117317,"ip_address":"","comment_id":291196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620111294","product_id":100073401,"comment_content":"æ²¡å¿…è¦å®ç° BSMJï¼Œ Shuffle æ’åºçš„ç›®çš„æ˜¯ä¸ºäº†å°†åŒä¸ª partition çš„æ•°æ®æ±‡é›†åˆ°ä¸€èµ·å‘é€ï¼Œè€Œ Broadcast æœ¬èº«å°±æ˜¯å¯¹æ•°æ®çš„å…¨é‡å‘é€ï¼Œå¹¶ä¸éœ€è¦åŒºåˆ†æ•°æ®å½’å±äºå“ªä¸ª partitionã€‚<br><br>æé—®ï¼šè€å¸ˆè¯´ Tungsten çš„ WSCG ä¼šå°†åŒä¸ª stage å†…çš„æ“ä½œæåˆæˆä¸€ä¸ªæ‰‹å†™ä»£ç ï¼Œæ„æ€æ˜¯æŒ‡ä½ åˆæˆä¸€ä¸ªå‡½æ•°æ“ä½œä¹ˆï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè·Ÿ DAGScheduler ä¸­çš„å‡½æ•°åˆå¹¶æœ‰ä»€ä¹ˆåŒºåˆ«ä¸ï¼Œæ¯•ç«Ÿ Spark SQL æœ€åä¹Ÿæ˜¯è½¬åŒ–ä¸º Spark Core æ‰§è¡Œçš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519397,"discussion_content":"ç¬¬ä¸€é¢˜å¯ä»¥å‚è€ƒkingcallåŒå­¦çš„ç­”æ¡ˆå“ˆ~\n\nåé¢çš„æé—®æ˜¯ä¸ªå¥½é—®é¢˜ã€‚é€»è¾‘ä¼˜åŒ–ã€ç‰©ç†ä¼˜åŒ–ã€Tungstenä¼˜åŒ–ï¼Œæ˜¯Spark SQLæ™ºèƒ½å¤§è„‘çš„â€œä¸‰æ‹›ä¸€å¥—â€ï¼Œè¿™3éƒ¨åˆ†å°±æ˜¯åœ¨è®²ï¼Œä¸€ä»½ä»£ç ï¼ˆDataFrameã€Datasetã€SQLï¼‰æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¢«ä¼˜åŒ–ã€æœ€ç»ˆè¢«èåˆæˆä¸€ä»½â€œæ‰‹å†™ä»£ç â€ï¼Œç„¶åäº¤ä»˜DAGScheduleråšåˆ†å¸ƒå¼æ‰§è¡Œã€‚åœ¨æ¥ä¸‹æ¥çš„23è®²ï¼Œå’±ä»¬é‡ç‚¹å…³æ³¨Tungstenä¼˜åŒ–ç¯èŠ‚ï¼Œä¹Ÿä¼šç€é‡è§£é‡Šâ€œæ‰‹å†™ä»£ç â€å’Œâ€œRDDè¿­ä»£å™¨åµŒå¥—â€ä¹‹é—´çš„æœ¬è´¨åŒºåˆ«ï¼Œæ•¬è¯·æœŸå¾…å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620117317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291192,"user_name":"jerry guo","can_delete":false,"product_type":"c1","uid":1267753,"ip_address":"","ucode":"179943AFCB93F8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo2GMhevabZrjINs2TKvIeGC7TJkicNlLvqTticuM5KL8ZN80OC2CnrsUyzPcZXO4uptj4Q1S4jT2lQ/132","comment_is_top":false,"comment_ctime":1620110082,"is_pvip":true,"replies":[{"id":"105483","content":"è¶…å‡ºå¹¿æ’­é˜ˆå€¼çš„å¤§è¡¨ï¼Œç¡®å®æ— æ³•å¹¿æ’­ï¼Œä¸è¿‡ï¼Œå’±ä»¬çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºå¯ä»¥å¹¿æ’­çš„å°è¡¨ï¼Œä¸ºä»€ä¹ˆSparkç¤¾åŒºæ²¡æœ‰å°†Broadcastå’ŒSMJç»“åˆåˆ°ä¸€èµ·~<br><br>å¯ä»¥å‚è€ƒKingcallåŒå­¦çš„ç­”æ¡ˆå“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620116682,"ip_address":"","comment_id":291192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620110082","product_id":100073401,"comment_content":"Sort Merger Joiné€‚ç”¨äºå¤§è¡¨ï¼Œå¤§è¡¨æ— æ³•broadcastï¼Œæ‰€ä»¥æ²¡æœ‰broadcast sort merge joinã€‚<br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519396,"discussion_content":"è¶…å‡ºå¹¿æ’­é˜ˆå€¼çš„å¤§è¡¨ï¼Œç¡®å®æ— æ³•å¹¿æ’­ï¼Œä¸è¿‡ï¼Œå’±ä»¬çš„é—®é¢˜æ˜¯ï¼Œå¯¹äºå¯ä»¥å¹¿æ’­çš„å°è¡¨ï¼Œä¸ºä»€ä¹ˆSparkç¤¾åŒºæ²¡æœ‰å°†Broadcastå’ŒSMJç»“åˆåˆ°ä¸€èµ·~\n\nå¯ä»¥å‚è€ƒKingcallåŒå­¦çš„ç­”æ¡ˆå“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620116682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291072,"user_name":"Zå®‡é”¤é”¤","can_delete":false,"product_type":"c1","uid":2188142,"ip_address":"","ucode":"7DB36E986A7A51","user_header":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","comment_is_top":false,"comment_ctime":1620008083,"is_pvip":true,"replies":[{"id":"105479","content":"å‰é¢è¯´çš„æ²¡é”™ï¼ŒBroadcastæ˜¯æ•°æ®åˆ†å‘æ–¹å¼ï¼ŒSMJæ˜¯Joinå®ç°æœºåˆ¶ã€‚<br><br>ä¸è¿‡ï¼Œåé¢çš„ä¸å¤ªå¯¹ã€‚Sparkç¤¾åŒºä¹‹æ‰€ä»¥æ²¡æœ‰æŠŠBroadcastå’ŒSMJç»“åˆåœ¨ä¸€èµ·ï¼Œå…¶å®æ ¸å¿ƒåŸå› å¾ˆç®€å•ï¼šæ²¡å¿…è¦ã€‚<br><br>å› ä¸ºï¼Œåœ¨Broadcastçš„æœºåˆ¶ä¸‹ï¼Œæ¯ä¸ªExecutorséƒ½æœ‰ç»´è¡¨çš„å…¨é‡æ•°æ®ï¼Œä¸”ç»´è¡¨è¶³å¤Ÿå°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨Hash Joinçš„å®ç°æœºåˆ¶ï¼Œè¿œæ¯”SMJçš„æœºåˆ¶çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHash Joinä¸å­˜åœ¨ç¨³å®šæ€§é—®é¢˜ï¼Œè€Œå®ƒçš„æ€§èƒ½åˆæ›´å¥½ï¼Œå› æ­¤ï¼ŒSparkç¤¾åŒºæ²¡æœ‰å¿…è¦å†å»å®ç°SMJçš„å®ç°æœºåˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620115595,"ip_address":"","comment_id":291072,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1620008083","product_id":100073401,"comment_content":"Broadcast Sort Merger Joinä¸­BroadcastæŒ‡çš„æ˜¯æ•°æ®åˆ†å‘çš„æ–¹å¼ï¼ŒSMBæŒ‡çš„æ˜¯Joinå®ç°æœºåˆ¶ã€‚<br>Sort Merge Joinçš„åŸç†æ˜¯å°†ä¸¤å¼ è¡¨çš„æ•°æ®æŒ‰ç…§ç›¸åŒçš„åˆ†åŒºç®—æ³•ï¼Œåˆ†å‘åˆ°å„ä¸ªExecutorä¸Šã€‚å¦‚æœä½¿ç”¨Broadcastä¼ è¾“ï¼Œè¢«å¹¿æ’­çš„è¡¨ä¼šå…ˆåœ¨Executorç«¯è¿›è¡Œæ•°æ®çš„æ‹†åˆ†ï¼Œæ‹†åˆ†å®Œæˆä»¥åï¼Œæ‰€æœ‰çš„åˆ†åŒºä¼šè¢«Collectåˆ°Driverç«¯ï¼Œå†å‘æ¯ä¸€ä¸ªExecutoråˆ†å‘å®Œæ•´æ•°æ®ã€‚è¿™ä½¿è¢«å¹¿æ’­çš„è¡¨æ•°æ®å³ä¾¿æ‹†åˆ†äº†ï¼Œè¿˜æ˜¯è¢«èšåˆåˆ†å‘ï¼Œæµªè´¹æ—¶é—´ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519361,"discussion_content":"å‰é¢è¯´çš„æ²¡é”™ï¼ŒBroadcastæ˜¯æ•°æ®åˆ†å‘æ–¹å¼ï¼ŒSMJæ˜¯Joinå®ç°æœºåˆ¶ã€‚\n\nä¸è¿‡ï¼Œåé¢çš„ä¸å¤ªå¯¹ã€‚Sparkç¤¾åŒºä¹‹æ‰€ä»¥æ²¡æœ‰æŠŠBroadcastå’ŒSMJç»“åˆåœ¨ä¸€èµ·ï¼Œå…¶å®æ ¸å¿ƒåŸå› å¾ˆç®€å•ï¼šæ²¡å¿…è¦ã€‚\n\nå› ä¸ºï¼Œåœ¨Broadcastçš„æœºåˆ¶ä¸‹ï¼Œæ¯ä¸ªExecutorséƒ½æœ‰ç»´è¡¨çš„å…¨é‡æ•°æ®ï¼Œä¸”ç»´è¡¨è¶³å¤Ÿå°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨Hash Joinçš„å®ç°æœºåˆ¶ï¼Œè¿œæ¯”SMJçš„æœºåˆ¶çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHash Joinä¸å­˜åœ¨ç¨³å®šæ€§é—®é¢˜ï¼Œè€Œå®ƒçš„æ€§èƒ½åˆæ›´å¥½ï¼Œå› æ­¤ï¼ŒSparkç¤¾åŒºæ²¡æœ‰å¿…è¦å†å»å®ç°SMJçš„å®ç°æœºåˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620115595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2188142,"avatar":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","nickname":"Zå®‡é”¤é”¤","note":"","ucode":"7DB36E986A7A51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372534,"discussion_content":"æ˜¯çš„ã€‚æˆ‘æƒ³åäº†ã€‚æˆ‘æƒ³çš„æ˜¯å…ˆæŠŠè¡¨æ•°æ®shuffleåˆ°ä¸åŒExecutorä¸Šï¼ŒDriverå†ä»Executorä¸Šæ”¶é›†æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620369604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2188142,"avatar":"https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg","nickname":"Zå®‡é”¤é”¤","note":"","ucode":"7DB36E986A7A51","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372530,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620368579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}